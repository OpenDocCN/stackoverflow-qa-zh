# StackOverflow 问答 000685000-000685999

# java - 是否有可序列化的标准闭包接口？

> ID：685000
> 
> 赞同：1
> 
> 时间：2009-03-26T09:03:26.580
> 
> 标签：java, serialization, closures

如果没有，也许你可以告诉我为什么。

当我的类被序列化时，我得到 NotSerializableException。

在类内部，我将这个匿名类传递给一个方法：

```
new org.apache.commons.collections.Closure() {
   ...
}; 
```

**这个问题仍然没有答案。我想知道是否有实现 Serializable 的标准 Closure 接口**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T09:11:03.050

类中的所有引用也必须是 Serializable 类型，甚至是 Closure 类型。是接口吗？它必须扩展 java.io.Serializable 接口。

IE：

```
interface Closure extends java.io.Serializable {
    ...
}

class YourClass implements java.io.Serializable {
    private Closure closure;
    ...
    public void setClosure(Closure closure) {
        this.closure = closure;
    }
}
...
    private static void main(String[] args) {
        YourClass y = new YourClass();
        y.setClosure(new Closure() {
            ...
        });
        ... 
```

编辑，澄清。:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T11:00:13.320

您在这里的主要问题是嵌套类没有标准化的序列形式。另请注意，如果您在实例方法中，外部类对象也将被序列化（通过未指定名称的字段）。

如果您不关心您的代码是否在完全随机的点停止工作，您可能需要考虑一个普通的本地类来代替（或除此之外）和匿名内部类。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-30T20:17:00.403

> 是否有可序列化的标准闭包接口？

我猜不会。

# c - 使用 C 对 bmp 文件进行运行长度编码中的平台相关问题

> ID：685002
> 
> 赞同：0
> 
> 时间：2009-03-26T09:04:15.297
> 
> 标签：c, encoding, ubuntu, fedora, run-length-encoding

我编写了一个程序，它打开一个 bmp 文件并将其视为字符文件并对其执行运行长度编码。它生成一个有效的压缩编码文件，我再次读取该文件以执行解码。

当我制作应用程序时，我使用的是 Fedora，它运行得非常好。现在我在 ubuntu 上运行它，它拒绝工作。

知道有什么问题吗？我担心它与编码有关。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-03T22:39:33.443

我首先建议使用源代码调试器来查找问题。

可能的原因包括在不同的系统上使用不同的编译器，这可能会做不同的事情，例如打包结构（例如，BITMAPFILEHEADER）。您还可能在两个系统上拥有不同的 CPU 架构（64 位与 32 位）。

您还可以使用十六进制编辑器（例如 XVI32）来检查由您的程序的两个版本生成的 BMP 文件之间的差异。

# sql-server-2008 - SQL Server 2008 Management Studio 代码段

> ID：685011
> 
> 赞同：4
> 
> 时间：2009-03-26T09:08:44.990
> 
> 标签：sql-server-2008, code-snippets, ssms

SQL Server 2008 Management Studio 中是否有片段功能？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-26T09:10:05.393

不，但您可以使用模板。使用它们，您可以获得类似的结果。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-09-22T19:33:45.027

[SSMS 工具包 - Microsoft SQL Server Management Studio 的插件](http://www.ssmstoolspack.com)- 具有此功能。

# c# - 我们如何在不使用 DAO 和 JRO 的情况下在 VB.NET 或 C#.NET 中压缩访问数据库

> ID：685012
> 
> 赞同：0
> 
> 时间：2009-03-26T09:09:42.150
> 
> 标签：c#, vb.net, ms-access

我正在使用 Access 数据库。现在我使用 DAO 压缩数据库，有时使用 JRO。但是对于这两者，我们添加了 COM 引用。

我不想为压缩添加 COM 引用。

有没有其他方法可以在不使用 COM 参考（对于 DAO 和 JRO）的情况下压缩访问数据库。

需要帮助。谢谢。

西瓦库玛

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T10:41:58.880

您还可以尝试使用 Jet Compact 实用程序：http: [//support.microsoft.com/kb/295334](http://support.microsoft.com/kb/295334)

此实用程序有一个 UI，但也可以使用命令行开关调用：

```
jetcomp.exe -src:"C:\input.mdb" -dest:"output.mdb" 
```

要获取可用开关的完整列表：

```
jetcomp.exe -? 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T19:13:45.757

如果用户在他们的机器上安装了 Access，您可以使用命令行语法。

类似于：MSACCESS.EXE /compact

它可能有助于理解为什么您不想包含 COM 参考以更恰当地回答。

进一步阅读：[访问命令行参考](http://support.microsoft.com/kb/209207)

# .net - .NET 的最佳 Twitter API 包装器/库是什么？

> ID：685015
> 
> 赞同：53
> 
> 时间：2009-03-26T09:12:46.213
> 
> 标签：.net, api, twitter

我正在寻找一种以编程方式为 .NET 应用程序生成 twitter 提要的方法。关于 twitter api 的良好包装器以简化工作的任何建议？

波阿斯

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-26T09:18:49.850

[Microsoft.Owin.Security.Twitter用于身份验证 + 带有](https://www.nuget.org/packages/Microsoft.Owin.Security.Twitter/)[HttpClient](https://www.nuget.org/packages/Microsoft.Net.Http/)和[Json.NET](https://www.nuget.org/packages/Newtonsoft.Json/)的自定义 C# 代码

就像是：

```
using (var client = new HttpClient())
{
    client.BaseAddress = new Uri("https://api.twitter.com/1.1/");
    client.DefaultRequestHeaders.Authorization = authValue;
    var response = await client.GetAsync("search/tweets.json");

    if (response.IsSuccessStatusCode)
    {
        var json = await response.Content.ReadAsStringAsync();
        var tweets = JsonConvert.DeserializeObject<Tweets>(json);
    }
} 
```

好读：

*   [使用 OAuth 扩展 HttpClient 以访问 Twitter](https://docs.microsoft.com/en-us/archive/blogs/henrikn/extending-httpclient-with-oauth-to-access-twitter)（2012 年 2 月）
*   [从 .NET 客户端调用 Web API (C#)](https://docs.microsoft.com/en-us/aspnet/web-api/overview/advanced/calling-a-web-api-from-a-net-client)
*   官方文档：[OAuth API](https://developer.twitter.com/en/docs/authentication/overview)、[REST API](https://developer.twitter.com/en/docs)、[Streaming API](https://developer.twitter.com/en/docs)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-07-13T19:13:33.190

[TweetSharp](https://www.nuget.org/packages/TweetSharp/)看起来也应该是一个不错的选择。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-26T09:20:49.797

codeplex 上有一个 linq to twitter 项目：

[http://www.codeplex.com/LinqToTwitter](http://www.codeplex.com/LinqToTwitter)

除了[Yedda 图书馆](http://devblog.yedda.com/index.php/2007/05/16/twitter-c-library/)，您还可以阅读 Pedro Santos 的[博客](http://psantos-blog.zi-yu.com/?p=197)，了解他的经历。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-03-26T21:15:10.643

[这](https://dev.twitter.com/docs/twitter-libraries)是 twitter 网站上列出的所有库的列表。

[这](https://dev.twitter.com/docs/api)是 Twitter 的 REST API 文档的链接。

[这](https://dev.twitter.com/docs/streaming-apis)是 Twitters Streaming API 文档的链接

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2011-12-21T08:42:18.193

您可以在 Twitter 的开发人员网站上找到 .NET Twitter 库的更新列表：

**[Twitter 开发人员：Twitter 库（用于 .NET）](https://dev.twitter.com/docs/twitter-libraries#dotnet)**

*   Andrew Arnott 的 DotNetOpenAuth – OpenID、OAuth 和 InfoCard 库
*   Daniel Crena 的 Hammock – 支持 OAuth 身份验证的 HTTP API 客户端。
*   Joe Mayo 的 LINQ to Twitter – Twitter API 的 LINQ 提供程序
*   Chris 的 OAuth-Dot-Net – 用于客户端和提供者的 OAuth 库
*   Daniel Crenna 和 Jason Diller 的 TweetSharp – 使用 Hammock 构建的 Twitter API 库
*   DigitallyBorn 的 Twitterizer – Twitter API 库（需要 .NET > 3.5）
*   Duane Roelands 的 TwitterVB – 一个 VB.NET Twitter API 库

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-04-08T19:46:28.950

所有好的答案，LinqToTwitter 好。另请查看我的帖子，解释从 C#/LINQ 使用 Twitter API 的基础知识，包括了解速率限制。（理解这一点很重要）。

[http://stuff.seans.com/2009/04/04/a-simple-net-twitter-api-wrapper-using-linq/](http://stuff.seans.com/2009/04/04/a-simple-net-twitter-api-wrapper-using-linq/)

即将推出 - 我的代码版本，可根据您的速率限制自动调整请求速度。（默认情况下为 100/小时，如果您或您的网站被“列入白名单”，则为 20,000/小时）。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-09-29T17:47:35.427

Twitterizer 看起来值得一看 - 它现在甚至是开源的...... [http://www.twitterizer.net/](http://www.twitterizer.net/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-26T09:31:35.047

您还可以查看[Twitteroo](http://rareedge.com/twitteroo/blog/2007/02/10/twitteroo-13-released/)。但耶达更好。我有一个爱好 Twitter 客户端项目，它看起来像 Google Talk（名为 jata）。如果您有兴趣，可以在 codeplex[中](http://www.codeplex.com/jata)找到它。

# language-agnostic - 设计一个网络应用程序

> ID：685025
> 
> 赞同：2
> 
> 时间：2009-03-26T09:17:33.597
> 
> 标签：language-agnostic, networking

问题：

我需要设计一个可以处理网络故障并在发生故障时切换到另一个网络的网络应用程序。

假设我正在使用三个以太网连接和一个无线连接。在特定时刻，仅使用一个连接。

我应该如何设计我的系统，以便它可以在出现故障时切换到另一个网络。

我知道这是一个非常广泛的问题，但任何指针都会有所帮助！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T09:28:17.020

我通常会确保网络上有路由并在主机上运行一个（或多个）路由协议实例。这样，网络故障（大部分）对应用程序来说是透明的，因为主机操作系统负责以正确的方式发送数据包。

在开源方面，我在 zebra 和 quagga 方面有很好的经验，至少在 linux 机器上是这样。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T09:24:20.883

为此创建一个域模型，描述网络元素，您希望能够检测和处理的故障类型，并证明它有效。然后插入网络代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T09:25:37.557

对连接进行一类轮询。如果轮询超时触发切换以太网设置。对于无线，将 wifi 设置设置为自动连接，然后启用/禁用 wificard。

（但我不知道你如何切换以太网连接）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T09:40:33.230

我要做的第一件事是寻找能够提供网络断开事件的 API。我还想办法检查网络连接的状态。

这些会因操作系统和使用的语言而异，因此您可能希望在您的应用程序中对其进行抽象。

例子：

```
RegisterDisconnectionEvent(DisconnectionHandler);

function DisconnectionHandler()
{
   FindActiveNetworkConnection();
   // do something else...
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-30T05:46:26.647

一种原始的方法是寻找网络断开事件。您的顺序是：注册/轮询网络连接状态更改。维护所有活动网络连接的列表。使用第一个可用的网络连接（或者，您可以根据接口带宽对其进行排序，并使用带宽最高的网络连接）。当您检测到断开连接时，请使用下一个活动连接。

但是，如果对您的应用程序的功能有影响，根据您使用的网络连接，您会更好，让路由协议为您完成这项工作，或者在您的应用程序中使用跟踪应用程序。此跟踪应用程序将跟踪所有可用接口上的网络路径（通过 ping、traceroute 等各种方法），以查看哪个接口可以到达最终目的地，并使用适当的网络接口。

此外，您不仅可以监控网络接口的状态变化，还可以监控输入/输出错误，并相应地更改您的选择。这将帮助您在任何给定时间点使用最有效的网络。但这需要与切换网络连接引起的流失平衡。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-10-10T13:09:05.440

如果您控制所有涉及的主机，[多路径 TCP](http://www.multipath-tcp.org/)将探测您的所有连接并自动选择一个有效的连接；如果多个连接正在工作，它将在它们之间进行负载平衡。

如果您不控制端点，则别无选择，只能在应用程序中进行探测。 [Mosh](https://mosh.mit.edu/)是一个非常优雅的应用程序示例。

你没有提到你的应用程序是做什么的；也许可以重新设计您的协议，以便它同时使用所有可用的连接，就像 BitTorrent 一样，因此不关心某些链接在任何给定时间关闭？

# c# - 在 c# msbuild 任务中检索具有相同名称的多个项目元数据

> ID：685027
> 
> 赞同：1
> 
> 时间：2009-03-26T09:18:43.797
> 
> 标签：c#, msbuild, msbuild-task

如何在 ac# msbuild 任务中获取具有相同名称的多个项目元数据，例如，如果我有：

```
 <ItemGroup>    
   <Assemblies Include = "S:\SVN\SomeDirectory\src\">
     <excludeAssembly>AssemblyName_1</excludeAssembly>
     <excludeAssembly>AssemblyName_2</excludeAssembly>
     <excludeAssembly>AssemblyName_3</excludeAssembly>
     <excludeAssembly>AssemblyName_4</excludeAssembly>
   </Assemblies>
 </ItemGroup> 
```

`<excludeAssembly>`如果通常使用以下方法，我将如何获得所有元数据的列表：

```
var itemData = itemTask.GetMetadata("excludeAssembly") 
```

获取单个元数据值。我需要获取`<excludeAssembly>`值列表

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T13:46:08.070

元数据与项目不同，一个项目可以有不同的元数据，但元数据只有一个值。

在 Microsoft.Build.Engine 程序集 ( *BuildItem.EvaluateAllItemMetadata(...)* ) 上使用反射器，您会看到项目的元数据存储在字典中，因此对于给定的元数据名称，您只能有一个值。

在您的情况下，一种解决方法是使用元数据作为项目的名称，如下所示：

```
<ItemGroup>    
  <Assemblies Include = "S:\SVN\SomeDirectory\src\">
    <excludeAssembly>exludeAssemblySet</excludeAssembly>
  </Assemblies>
</ItemGroup>

<ItemGroup>
  <exludeAssemblySet Include="AssemblyName_1"/>
  <exludeAssemblySet Include="AssemblyName_2"/>
  <exludeAssemblySet Include="AssemblyName_3"/>
  <exludeAssemblySet Include="AssemblyName_4"/>
</ItemGroup>

// Approximative syntax, I don't know what you want to do
var itemData = itemTask.GetMetadata("excludeAssembly");
BuildItemGroup excludeAssemblies = project.GetEvaluatedItemsByName(itemData); 
```

# mysql - 如何在不使用视图的情况下自动计算表中的列

> ID：685029
> 
> 赞同：3
> 
> 时间：2009-03-26T09:19:06.167
> 
> 标签：mysql

例如，我有下表：

```
CREATE TABLE `test` (
  `total_results` int(10) unsigned NOT NULL,
  `num_results_as_expected` unsigned int(10) NOT NULL,
) ; 
```

我想在不使用 VIEW 的情况下向表中添加另一列来添加百分比：

```
(num_results_as_expected/total_results)*100 
```

这可能不使用视图吗？

*   澄清。我知道可以使用 select 语句，但我想在 CREATE TABLE 语句中添加它，以便访问该表的任何人都可以使用该列。

*   澄清2：触发是正确的方法吗？这实际上将在列中存储重复信息。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T09:23:41.883

创建一个常规列 + 添加“插入前”触发器，该触发器将在每次插入操作时使用计算出的值更新其值。前任。：

```
create trigger update_result before insert on test for each row
begin set new.result = (num_results_as_expected/total_results)*100; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T09:21:17.440

```
select (num_results_as_expected/total_results)*100 as percentage from test 
```

因此，要获取包括新列在内的所有列：

```
select total results, num_results_as_expected, (num_results_as_expected/total_results)*100 as percentage from test 
```

这可以防止您存储任何额外的内容，当获取数据时，额外的列会神奇地出现。

# sql-server - 有没有一种简单的方法在调试期间将 MSSQL 2005 数据库重置为预定义状态？

> ID：685031
> 
> 赞同：1
> 
> 时间：2009-03-26T09:19:43.297
> 
> 标签：sql-server, sql-server-2005

我经常发现自己处于以下情况：

1.  客户报告其数据库中的数据损坏。
2.  我们调查问题，有时通过尝试和错误。
3.  我们尝试通过使用我们的应用程序或产品随附的一两个修复工具来解决问题。（只有在糟糕的情况下，我们才会编写修复脚本来单独解决特定问题）
4.  我们会向客户或客户服务部门发送分步程序来修复问题。

所有步骤（除了第一个）都会导致客户数据库的更改。但至关重要的是，特别是在第 4 步中，一切都与原始数据库一起工作。

目前，我们确保只使用它的副本，并且在每次测试之前我们切换回一个新的副本。当涉及一次性流程时，这变得非常烦人。（只能做一次的事情，比如创建一个特定的发票，处理一个特定的交付，......）

当然，这是一个非常缓慢的过程，尤其是对于大型数据库。我已经尝试过备份功能，但这似乎比复制 .mdf 文件还要慢。

有什么方法可以快速恢复在预定义检查点之后所做的任何更改？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T09:28:33.260

看看“快照”，因为它们可能是您所追求的：

[http://www.simple-talk.com/sql/database-administration/sql-server-2005-snapshots/](http://www.simple-talk.com/sql/database-administration/sql-server-2005-snapshots/) [http://msdn.microsoft.com/en-us/library/ms175876.aspx](http://msdn.microsoft.com/en-us/library/ms175876.aspx)

实际上，唯一的其他选择是复制您正在操作的特定表，然后恢复这些表（通过 SELECT INTO 复制原始表，操作，删除旧表，重命名副本）。

# logging - Microsoft Logging 应用程序块和多线程

> ID：685039
> 
> 赞同：2
> 
> 时间：2009-03-26T09:21:25.490
> 
> 标签：logging

我是 Logging 应用程序块 (4.1) 的新手。有没有人编写过一个应用程序，它使用来自多个线程的 Logging 应用程序块？我之所以问，是因为 Logger 是一个静态类，并且例如可能从多个线程写入同一个日志文件。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T10:08:04.117

日志记录应用程序块是线程安全的，这意味着您可以从多个线程调用它的公共方法，而无需自己进行任何同步。库进行自己的同步。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T10:05:15.090

我不太清楚你为什么担心这可能会发生。只要您为日志消息提供一个类别，就应该将它们写入为该类别配置的相应日志文件。此操作是线程安全的。

或者你说的是通过线程将同一类别的日志消息写入不同的文件？例如线程 1 -> mylog-1.log；线程 2 -> mylog-2.log

# wcf - 在 IIS 中显式启动 WCF 服务

> ID：685041
> 
> 赞同：0
> 
> 时间：2009-03-26T09:22:34.600
> 
> 标签：wcf, iis

我有一个启动时间很长的 WCF 服务（大量数据从 Oracle 提取到 RAM 中）。它每天凌晨 4 点回收，这很好，但我想在凌晨 4:30 明确启动它，这样第一个用户（使用 Silverlight 客户端）就不必等待服务在第二天早上启动。

这样做的最佳方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T09:26:14.263

让您自己的泵启动客户端应用程序在回收后立即启动如何？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-28T18:09:04.113

您可能想要查看[Windows Server AppFabric](http://msdn.microsoft.com/en-us/windowsserver/ee695849.aspx)。它提供的开箱即用功能之一是为您[自动激活服务](http://msdn.microsoft.com/en-us/library/ee677261.aspx)。

# python - 从 Python 中的“with”块中产生是否安全（为什么）？

> ID：685046
> 
> 赞同：50
> 
> 时间：2009-03-26T09:24:56.963
> 
> 标签：python, resources, coroutine

协程和资源获取的结合似乎会产生一些意想不到的（或不直观的）后果。

基本问题是这样的事情是否有效：

```
def coroutine():
    with open(path, 'r') as fh:
        for line in fh:
            yield line 
```

它确实如此。（你可以测试一下！）

更深层次的担忧是，`with`它应该是 的替代品`finally`，您可以确保在块的末尾释放资源。协程可以在块内暂停和恢复执行，那么*冲突*是**如何解决的呢？**`with`

 **例如，如果您在协程尚未返回时打开一个在协程内部和外部都具有读/写功能的文件：

```
def coroutine():
    with open('test.txt', 'rw+') as fh:
        for line in fh:
            yield line

a = coroutine()
assert a.next() # Open the filehandle inside the coroutine first.
with open('test.txt', 'rw+') as fh: # Then open it outside.
    for line in fh:
        print 'Outside coroutine: %r' % repr(line)
assert a.next() # Can we still use it? 
```

### 更新

在前面的示例中，我打算进行写锁定文件句柄争用，但由于大多数操作系统为每个进程分配文件句柄，因此不会出现争用。（感谢@Miles 指出这个例子并没有多大意义。）这是我修改后的例子，它显示了一个真正的死锁情况：

```
import threading

lock = threading.Lock()

def coroutine():
    with lock:
        yield 'spam'
        yield 'eggs'

generator = coroutine()
assert generator.next()
with lock: # Deadlock!
    print 'Outside the coroutine got the lock'
assert generator.next() 
```

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-26T10:12:08.520

我真的不明白你在问什么冲突，也不明白这个例子的问题：对同一个文件有两个共存的独立句柄很好。

我不知道我在回答您的问题时了解到的一件事是生成器上有一个新的 close() 方法：

> `close()`在生成器内引发一个新`GeneratorExit`异常以终止迭代。在接收到这个异常时，生成器的代码必须是 raise`GeneratorExit`或`StopIteration`.
> 
> `close()`当生成器被垃圾收集时调用，因此这意味着生成器的代码在生成器被销毁之前有最后一次运行的机会。这最后的机会意味着`try...finally`生成器中的语句现在可以保证工作；该`finally`子句现在总是有机会运行。这似乎是一些语言琐事，但使用生成器`try...finally`实际上是实现`with`PEP 343 描述的语句所必需的。
> 
> [http://docs.python.org/whatsnew/2.5.html#pep-342-new-generator-features](http://docs.python.org/whatsnew/2.5.html#pep-342-new-generator-features)

这样就可以处理`with`在生成器中使用语句但它在中间产生但从不返回的情况 - 上下文管理器的`__exit__`方法将在生成器被垃圾收集时调用。

* * *

**编辑**：

关于文件句柄问题：我有时会忘记存在不类似于 POSIX 的平台。:)

就锁而言，我认为 Rafał Dowgird 说的“你只需要注意，生成器就像任何其他拥有资源的对象一样”是一针见血。我认为该`with`声明在这里并不那么重要，因为此函数存在相同的死锁问题：

```
def coroutine():
    lock.acquire()
    yield 'spam'
    yield 'eggs'
    lock.release()

generator = coroutine()
generator.next()
lock.acquire() # whoops! 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-26T10:44:15.073

我不认为有真正的冲突。您只需要知道生成器就像任何其他拥有资源的对象一样，因此创建者有责任确保它正确完成（并避免与对象所拥有的资源发生冲突/死锁）。我在这里看到的唯一（次要）问题是生成器没有实现上下文管理协议（至少从 Python 2.5 开始），所以你不能只是：

```
with coroutine() as cr:
  doSomething(cr) 
```

但必须：

```
cr = coroutine()
try:
  doSomething(cr)
finally:
  cr.close() 
```

垃圾收集器`close()`无论如何都会做，但依赖它来释放资源是不好的做法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T10:44:54.543

因为`yield`可以执行任意代码，所以我会非常警惕对 yield 语句持有锁。但是，您可以通过许多其他方式获得类似的效果，包括调用可能已被覆盖或以其他方式修改的方法或函数。

然而，生成器总是（几乎总是）“关闭”，或者通过显式`close()`调用，或者只是通过垃圾收集。关闭生成器会在生成器内引发`GeneratorExit`异常，因此会运行 finally 子句、语句清理等。您可以捕获异常，但必须抛出或退出函数（即抛出`StopIteration`异常），而不是 yield。在您编写的情况下，依靠垃圾收集器关闭生成器可能是一种不好的做法，因为这可能会比您想要的更晚发生，并且如果有人调用 sys._exit()，那么您的清理可能根本不会发生.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2018-01-19T15:03:36.820

对于 TLDR，这样看：

```
with Context():
    yield 1
    pass  # explicitly do nothing *after* yield
# exit context after explicitly doing nothing 
```

`Context`完成后`pass`结束（即什么都不做），完成`pass`后执行`yield`（即恢复执行）。因此，控制后的`with`结束*在*恢复`yield`。

TLDR：释放控制`with`时，上下文保持不变。`yield`

* * *

实际上，这里只有两个相关的规则：

1.  什么时候`with`释放它的资源？

    它在其块完成后*立即执行**一次。*前者意味着它不会在a*期间*释放，因为这可能会发生多次。后者意味着它会在完成*后*释放。**`yield` *`yield`***

****   什么时候`yield`完成？

    将`yield`其视为反向调用：控制权传递给调用者，而不是传递给被调用者。类似地，`yield`当控制权返回给它时完成，就像调用返回控制权一样。*** 

 ***请注意，两者`with`都`yield`在这里按预期工作！a 的`with lock`目的是保护资源，并且在`yield`. 您始终可以显式释放此保护：

```
def safe_generator():
  while True:
    with lock():
      # keep lock for critical operation
      result = protected_operation()
    # release lock before releasing control
    yield result 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T10:19:42.963

那将是我期望的工作方式。是的，块在完成之前不会释放它的资源，所以从这个意义上说，资源已经逃脱了它的词法嵌套。但是，这与尝试在 with 块中使用相同资源的函数调用没有什么不同 - 在块尚未终止的情况下*，*无论出于*何种*原因，都没有任何帮助。它并不是特定于生成器的任何东西。

不过，可能值得担心的一件事是如果生成器*永远不会*恢复，那么它的行为。我原以为该`with`块会像`finally`块一样工作并在终止时调用该`__exit__`部分，但事实并非如此。

# c# - RuntimeCallableWrapper

> ID：685051
> 
> 赞同：1
> 
> 时间：2009-03-26T09:26:34.683
> 
> 标签：c#, interop

我有一个 COM 组件，想从 C# 访问。我在我的 C# 程序中创建了一个接口，并想用它的 CoClass 访问该组件。当我创建一个对象时，它给了我 __ComObject，它是一个 RuntimeCallabelWrapper。

我想知道它何时返回我一个对象并为我创建一个 MethodTable，然后当我将此接口转换为另一个接口以调用其他接口的方法时，我添加第二个接口的方法或为此创建一个新的 MethodTable？下面是代码：

```
[Guid("169D0491-E149-4BB3-932E-A42C4F8D3478")]
[InterfaceType(ComInterfaceType.InterfaceIsDual)]
interface IInventory
{
    void Buy(int quantity, float rate);
    void Sell(int quantity, float rate);
    int GetStock();
}

[Guid("8B08A7ED-8D46-41B2-B8D9-35F4CF37F75B")]
[InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]
interface IAccount
{
    void Credit(double amount);
    void Debit(double amount);
    double GetBalance();
}

[Guid("F8E3E05A-CAFA-4CBD-BC42-DF9328729B01")]
[ComImport]
class Trader{}

public static void Main(string[] args)
{
    IInventory inv = (IInventory) new Trader(); // this gives me RCW
    inv.Buy(qty, 150);

    IAccount acc = (IAccount) inv;   // ?
    Console.WriteLine("Current balance: {0}", acc.GetBalance());
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T09:32:34.327

IInventory 和 IAccount 彼此完全无关（除了它们都是从 IUnknown 继承的）并且您不能从一个转换到另一个。除非类 Trader 没有实现它们，否则你也不能转换它。

# sql - 比较两个 SQL Server 数据库（模式和数据）的最佳工具是什么？

> ID：685053
> 
> 赞同：212
> 
> 时间：2009-03-26T09:28:11.810
> 
> 标签：sql, sql-server, database, compare

我也想比较两个 SQL Server 数据库，包括模式（表结构）和表中的数据。什么是最好的工具来做到这一点？

* * *

## 回答 #1

> 赞同：241
> 
> 时间：2009-03-26T09:34:14.790

**我使用最新版本Microsoft Visual Studio 2015**社区版（免费）或专业/高级/终极版中内置的架构和数据比较功能。奇迹般有效！

![图像](https://i.stack.imgur.com/IODeF.png)

[http://channel9.msdn.com/Events/Visual-Studio/Launch-2013/VS108](http://channel9.msdn.com/Events/Visual-Studio/Launch-2013/VS108)

**Red-Gate 的 SQL 数据比较工具**是我的第二种选择：

[![图像](https://i.stack.imgur.com/hHI5m.png)](https://i.stack.imgur.com/hHI5m.png)
[（来源：[spaanjaars.com](http://imar.spaanjaars.com/Images/Articles/NLayer45/Part10/Figure10-5_Red_Gate_SQL_Compare_Results.png)）]

*   [http://www.red-gate.com/products/sql-development/sql-compare/](http://www.red-gate.com/products/sql-development/sql-compare/)
*   [http://www.red-gate.com/products/sql-development/sql-data-compare/](http://www.red-gate.com/products/sql-development/sql-data-compare/)

* * *

## 回答 #2

> 赞同：135
> 
> 时间：2009-03-26T14:19:12.653

我喜欢[Open DBDiff](https://github.com/OpenDBDiff/OpenDBDiff)。

虽然不是最完整的工具，但它工作得很好，它是免费的，而且非常易于使用。

* * *

## 回答 #3

> 赞同：87
> 
> 时间：2009-03-26T09:31:23.017

我正在使用 Red-Gate 的软件： [http ://www.red-gate.com](http://www.red-gate.com/)

* * *

## 回答 #4

> 赞同：72
> 
> 时间：2011-07-11T14:08:42.113

**[http://www.simego.com/Products/SQL-Admin-Studio](http://www.simego.com/Products/SQL-Admin-Studio)的**SQL Admin Studio**现在是免费的，可以让您管理 SQL 数据库、**SQL 比较和同步**、**数据比较和同步**等等。还支持 SQL Azure 和一些 MySQL 支持。**

 **[更新：是的，我是上述程序的作者，因为它现在是免费的，我只是想与社区分享]

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2009-03-26T13:57:24.143

我偏爱[AdeptSQL](http://www.adeptsql.com/)。它干净直观，而且它没有一个让我在许多类似程序中吓到我的功能。您按下一个巨大的按钮，它会自动同步所有内容，而无需请假。如果您想同步更改，您必须自己做，我喜欢这样。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2012-11-28T09:02:09.910

[http://www.codeproject.com/Articles/205011/SQL-Server-Database-Comparison-Tool](http://www.codeproject.com/Articles/205011/SQL-Server-Database-Comparison-Tool)提供了一个带有源代码的工具

这应该提供灵活性，因为代码是可用的。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-03-26T12:17:53.150

[dbghost](http://www.innovartis.co.uk/)是我迄今为止使用过的最好的。我见过的最好的功能之一是它会生成 SQL 代码，以根据您保留在源代码控制中的 SQL 以及数据库在数据库版本之间进行切换。简单易用。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-03-26T09:38:12.330

我以前用过 SQL Delta ( [http://www.sqldelta.com/](http://www.sqldelta.com/) )，真的很好。但是不是免费的，不确定价格与 Red-Gates 相比如何

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2012-01-18T09:59:29.860

试试 DBComparer，它免费且快速：

[http://dbcomparer.com/](http://dbcomparer.com/)

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-04-08T21:52:06.447

Database Workbench 也可以做到

[http://www.upscene.com/products.dbw.index.php](http://www.upscene.com/products.dbw.index.php)

> 跨数据库开发
> 
> 使用模式比较和迁移工具比较测试和部署的数据库，将现有数据库迁移到不同的数据库系统。

您也可以使用数据库比较器

[http://www.clevercomponents.com/products/dbcomparer/dbcomparer.asp](http://www.clevercomponents.com/products/dbcomparer/dbcomparer.asp)

我将它用于 Firebird，效果很好。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2010-04-09T11:24:56.857

试试[dbForge Data Compare for SQL Server](http://www.devart.com/dbforge/sql/)。它可以比较和同步任何数据库，甚至是非常大的数据库。快速、简单、始终提供正确的结果。在您的数据库上尝试并评论产品。

我们可以向您推荐一个可靠的 SQL 比较工具，它可以将您的 SQL Server 数据库中的表数据的比较和同步速度提高 3 倍。它是 SQL Server 的[dbForge 数据比较和 SQL Server](http://www.devart.com/dbforge/sql/datacompare/)的[dbForge 架构比较](http://www.devart.com/dbforge/sql/schemacompare/)

主要优点：

*   大型数据库的更快比较和同步
*   支持本机 SQL Server 备份
*   表、列和模式的自定义映射
*   调整比较和同步的多个选项
*   生成比较和同步报告

加上 30 天免费试用和无风险购买以及 30 天退款保证。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-03-26T09:36:47.153

我们正在使用内部开发的解决方案，该解决方案基本上是一个过程，其中包含您想要包含在比较中的参数（SP、完整 SP 代码、表结构、默认值、索引、触发器等）

根据您的需求和预算，这可能也是适合您的好方法。

它也很容易开发，然后我们只需将程序的输出重定向到文本文件并在文件之间进行文本比较。

关于它的一件好事是它可以将输出保存在源代码管理中。

/乙

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-03-26T10:15:53.427

我用过 Red Gate 的工具，它们很棒。但是，如果您不能花任何钱，您可以尝试[Open DBDiff](http://opendbiff.codeplex.com/)来比较模式。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-03-24T09:31:57.803

如果您使用 MSSQL，我肯定会选择 AdeptSQL。这是我尝试过的最不好看但最有才华的数据库比较工具。它可以比较结构和数据。它告诉您哪些表存在于一个 db 上但不存在于另一个 db，比较常见的结构和数据，它可以生成脚本来同步两者。它不是免费的，但有 30 天的试用期（据我所知）

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2012-05-15T14:17:30.520

我试过[OpenDiff Tool](http://www.ginktage.com/2012/04/open-dbdiff-for-sql-server-2008/)。伟大的工具，免费且易于使用。

# algorithm - 设计一个栈使得 getMinimum( ) 应该是 O(1)

> ID：685060
> 
> 赞同：123
> 
> 时间：2009-03-26T09:29:17.827
> 
> 标签：algorithm, language-agnostic, data-structures, stack

这是一道面试题。

> 您需要设计一个包含整数值的堆栈，以便`getMinimum()`函数应返回堆栈中的最小元素。
> 
> 例如：
> 
> > 情况1
> > 
> > 5 ← 前
> > 1
> > 4
> > 6
> > 2
> > 
> > 当 getMinimum() 被调用时，它应该返回 1，这是堆栈中的最小元素。
> > 
> > 案例#2
> > 
> > `stack.pop()`
> > `stack.pop()`
> > 
> > 注意： 5 和 1 都从堆栈中弹出。所以在此之后，堆栈看起来像
> > 
> > 4 ← 前
> > 6
> > 2
> > 
> > 当`getMinimum()`被调用时，它应该返回 2，这是堆栈中的最小值。
> 
> **约束：**
> 
> 1.  getMinimum 应该返回 O(1) 中的最小值
> 2.  设计时还必须考虑空间限制，如果您使用额外的空间，它应该是恒定的空间。

* * *

## 回答 #1

> 赞同：182
> 
> 时间：2009-03-26T09:34:37.377

编辑：这使“恒定空间”约束失败 - 它基本上使所需空间增加了一倍。我非常怀疑是否有一种解决方案*不能*做到这一点，而不会破坏某处的运行时复杂性（例如，使 push/pop O(n)）。请注意，这不会改变所需空间的*复杂性*，例如，如果您有一个具有 O(n) 空间要求的堆栈，这仍然是 O(n)，只是具有不同的常数因子。

**非常数空间解**

保留“堆栈中所有值的最小值”的“重复”堆栈。当您弹出主堆栈时，也弹出最小堆栈。当您推送主堆栈时，推送新元素或当前最小值，以较低者为准。`getMinimum()`然后被实施为`minStack.peek()`.

因此，使用您的示例，我们将拥有：

```
Real stack        Min stack

5  --> TOP        1
1                 1
4                 2
6                 2
2                 2 
```

弹出两次后，您得到：

```
Real stack        Min stack

4                 2
6                 2
2                 2 
```

如果这不是足够的信息，请告诉我。摸起来很简单，但一开始可能会有点头疼:)

（当然，缺点是它使空间需求增加了一倍。执行时间并没有显着受到影响 - 即它仍然是相同的复杂性。）

编辑：有一个变体稍微复杂一些，但总体上具有更好的空间。我们仍然有最小堆栈，但只有当我们从主堆栈弹出的值等于最小堆栈上的值时，我们才会从它弹出。只有当被压入主堆栈的值小于*或等于*当前最小值时，我们才会*压入最小堆栈。*这允许重复的最小值。仍然只是一个偷看操作。例如，获取原始版本并再次推送 1，我们会得到：*`getMinimum()`*

 *```
Real stack        Min stack

1  --> TOP        1
5                 1
1                 2
4                 
6                 
2 
```

因为 1 == 1，所以从上面的两个堆栈中弹出，留下：

```
Real stack        Min stack

5  --> TOP        1
1                 2
4                 
6                 
2 
```

再次弹出*仅从*主堆栈中弹出，因为 5 > 1：

```
Real stack        Min stack

1                 1
4                 2
6                 
2 
```

再次弹出会弹出两个堆栈，因为 1 == 1：

```
Real stack        Min stack

4                 2
6                 
2 
```

这最终会得到相同的最坏情况空间复杂度（原始堆栈的两倍），但如果我们很少获得“新的最小值或相等”，则空间使用会更好。

编辑：这是皮特邪恶计划的实现。我没有彻底测试过，但我*认为*没关系:)

```
using System.Collections.Generic;

public class FastMinStack<T>
{
    private readonly Stack<T> stack = new Stack<T>();
    // Could pass this in to the constructor
    private readonly IComparer<T> comparer = Comparer<T>.Default;

    private T currentMin;

    public T Minimum
    {
        get { return currentMin; }
    }

    public void Push(T element)
    {
        if (stack.Count == 0 ||
            comparer.Compare(element, currentMin) <= 0)
        {
            stack.Push(currentMin);
            stack.Push(element);
            currentMin = element;
        }
        else
        {
            stack.Push(element);
        }
    }

    public T Pop()
    {
        T ret = stack.Pop();
        if (comparer.Compare(ret, currentMin) == 0)
        {
            currentMin = stack.Pop();
        }
        return ret;
    }
} 
```

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2009-03-26T09:33:19.613

添加一个字段来保存最小值并在 Pop() 和 Push() 期间对其进行更新。这样 getMinimum() 将是 O(1)，但 Pop() 和 Push() 将不得不做更多的工作。

如果弹出最小值，Pop() 将是 O(n)，否则它们仍然是 O(1)。当根据 Stack 实现调整 Push() 的大小时，O(n) 变为 O(n)。

这是一个快速实现

```
public sealed class MinStack {
    private int MinimumValue;
    private readonly Stack<int> Stack = new Stack<int>();

    public int GetMinimum() {
        if (IsEmpty) {
            throw new InvalidOperationException("Stack is empty");
        }
        return MinimumValue;
    }

    public int Pop() {
        var value = Stack.Pop();
        if (value == MinimumValue) {
            MinimumValue = Stack.Min();
        }
        return value;
    }

    public void Push(int value) {
        if (IsEmpty || value < MinimumValue) {
            MinimumValue = value;
        }
        Stack.Push(value);
    }

    private bool IsEmpty { get { return Stack.Count() == 0; } }
} 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-03-26T23:32:28.007

```
public class StackWithMin {
    int min;
    int size;
    int[] data = new int[1024];

    public void push ( int val ) {
        if ( size == 0 ) {
            data[size] = val;
            min = val;
        } else if ( val < min) {
            data[size] = 2 * val - min;
            min = val;

            assert (data[size] < min); 
        } else {
            data[size] = val;
        }

        ++size;

        // check size and grow array
    }

    public int getMin () {
        return min;
    }

    public int pop () {
        --size;

        int val = data[size];

        if ( ( size > 0 ) && ( val < min ) ) {
            int prevMin = min;
            min += min - val;
            return prevMin;
        } else {
            return val;
        }
    }

    public boolean isEmpty () {
        return size == 0;
    }

    public static void main (String...args) {
        StackWithMin stack = new StackWithMin();

        for ( String arg: args ) 
            stack.push( Integer.parseInt( arg ) );

        while ( ! stack.isEmpty() ) {
            int min = stack.getMin();
            int val = stack.pop();

            System.out.println( val + " " + min );
        }

        System.out.println();
    }

} 
```

它显式存储当前最小值，如果最小值发生变化，而不是推送值，它会推送新最小值的另一侧相同差异的值（如果 min = 7 并且您推送 5，它会推送 3（5- |7-5| = 3) 并将 min 设置为 5；如果在 min 为 5 时弹出 3，它会看到弹出的值小于 min，因此反转过程以获取新 min 的 7，然后返回前一个分钟）。由于任何不会导致当前最小值发生变化的值都大于当前最小值，因此您可以使用一些东西来区分更改最小值的值和不更改最小值的值。

在使用固定大小整数的语言中，您从值的表示中借用了一些空间，因此它可能下溢并且断言将失败。但除此之外，它是恒定的额外空间，所有操作仍然是 O(1)。

相反，基于链表的堆栈还有其他可以借用的地方，例如在 C 中是 next 指针的最低有效位，或者在 Java 中是链表中对象的类型。对于 Java，这确实意味着与连续堆栈相比使用了更多空间，因为每个链接都有对象开销：

```
public class LinkedStackWithMin {
    private static class Link {
        final int value;
        final Link next;

        Link ( int value, Link next ) {
            this.value = value;
            this.next = next;
        }

        int pop ( LinkedStackWithMin stack ) {
            stack.top = next;
            return value;
        }
    }

    private static class MinLink extends Link {
        MinLink ( int value, Link next ) {
            super( value, next );
        }

        int pop ( LinkedStackWithMin stack ) {
            stack.top = next;
            int prevMin = stack.min;
            stack.min = value;
            return prevMin;
        }
    }

    Link top;
    int min;

    public LinkedStackWithMin () {
    }

    public void push ( int val ) {
        if ( ( top == null ) || ( val < min ) ) {
            top = new MinLink(min, top);
            min = val;
        } else {
            top = new Link(val, top);
        }
    }

    public int pop () {
        return top.pop(this);
    }

    public int getMin () {
        return min;
    }

    public boolean isEmpty () {
        return top == null;
    } 
```

在 C 中，开销不存在，您可以借用下一个指针的 lsb：

```
typedef struct _stack_link stack_with_min;

typedef struct _stack_link stack_link;

struct _stack_link {
    size_t  next;
    int     value;
};

stack_link* get_next ( stack_link* link ) 
{
    return ( stack_link * )( link -> next & ~ ( size_t ) 1 );
}

bool is_min ( stack_link* link )
{
    return ( link -> next & 1 ) ! = 0;
}

void push ( stack_with_min* stack, int value )
{
    stack_link *link = malloc ( sizeof( stack_link ) );

    link -> next = ( size_t ) stack -> next;

    if ( (stack -> next == 0) || ( value == stack -> value ) ) {
        link -> value = stack -> value;
        link -> next |= 1; // mark as min
    } else {
        link -> value = value;
    }

    stack -> next = link;
}

etc.; 
```

然而，这些都不是真正的 O(1)。它们在实践中不需要更多空间，因为它们利用了这些语言中数字、对象或指针的表示形式中的漏洞。但是使用更紧凑表示的理论机器将需要在每种情况下向该表示添加额外的位。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2015-07-21T23:28:42.943

我找到了一个满足所有提到的约束（恒定时间操作）和**恒定额外空间**的解决方案。

这个想法是存储最小值和输入数字之间的差异，如果不再是最小值，则更新最小值。

代码如下：

```
public class MinStack {
    long min;
    Stack<Long> stack;

    public MinStack(){
        stack = new Stack<>();
    }

    public void push(int x) {
        if (stack.isEmpty()) {
            stack.push(0L);
            min = x;
        } else {
            stack.push(x - min); //Could be negative if min value needs to change
            if (x < min) min = x;
        }
    }

    public int pop() {
        if (stack.isEmpty()) return;

        long pop = stack.pop();

        if (pop < 0) {
            long ret = min
            min = min - pop; //If negative, increase the min value
            return (int)ret;
        }
        return (int)(pop + min);

    }

    public int top() {
        long top = stack.peek();
        if (top < 0) {
            return (int)min;
        } else {
           return (int)(top + min);
        }
    }

    public int getMin() {
        return (int)min;
    }
} 
```

归功于：[https ://leetcode.com/discuss/15679/share-my-java-solution-with-only-one-stack](https://leetcode.com/discuss/15679/share-my-java-solution-with-only-one-stack)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-03-26T09:34:38.453

那么， 和 的运行时约束是`push`什么`pop`？如果它们不需要保持不变，那么只需计算这两个操作中的最小值（使它们成为*O* ( *n* )）。否则，我看不出如何通过不断增加的空间来做到这一点。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2019-05-04T22:05:30.033

假设我们将要处理的堆栈是这样的：

```
6 , minvalue=2
2 , minvalue=2
5 , minvalue=3
3 , minvalue=3
9 , minvalue=7
7 , minvalue=7
8 , minvalue=8 
```

在上面的表示中，堆栈仅由左值构建，右值的 [minvalue] 仅用于说明目的，将存储在一个变量中。

实际的*问题*是当最小值的值被删除时：在这一点上，我们如何知道下一个最小元素是什么而不迭代堆栈。

例如，在我们的堆栈中，当 6 被弹出时，我们知道这不是最小元素，因为最小元素是 2，所以我们可以安全地删除它而无需更新我们的最小值。

但是当我们弹出 2 时，我们可以看到最小值现在是 2，如果它被弹出，那么我们需要将最小值更新为 3。

要点1：

现在，如果您仔细观察，我们需要从这个特定状态 [2 , minvalue=2] 生成 minvalue=3。
或者如果你在堆栈中更深，我们需要从这个特定状态 [3，minvalue=3] 生成 minvalue=7，
或者如果你在堆栈中更深入，那么我们需要从这个特定状态 [7，最小值=7]

您是否注意到以上三种情况的共同点？我们需要生成的值取决于两个相等的变量。正确的。
为什么会发生这种情况，因为当我们推送一些小于当前最小值的元素时，我们基本上会将那个元素推送到堆栈中，并在最小值中更新相同的数字。

要点2：

因此，我们基本上将相同数字的副本存储一次在堆栈中，一次存储在 minvalue 变量中。
我们需要专注于避免这种重复并将一些有用的数据存储在堆栈或最小值中以生成先前的最小值，如上面的 CASES 所示。

让我们关注当要存储在 push 中的值小于最小值时，我们应该在堆栈中存储什么。让我们将此变量命名为 y，因此现在我们的堆栈将如下所示：

```
6 , minvalue=2
y1 , minvalue=2
5 , minvalue=3
y2 , minvalue=3
9 , minvalue=7
y3 , minvalue=7
8 , minvalue=8 
```

我已将它们重命名为 y1,y2,y3 以避免混淆它们都将具有相同的值。

要点3：

现在让我们尝试在 y1、y2 和 y3 上找到一些约束。你还记得我们在执行 pop() 时究竟何时需要更新最小值，只有当我们弹出等于最小值的元素时。
如果我们弹出大于最小值的东西，那么我们不必更新最小值。
所以要触发minvalue的更新，y1,y2&y3应该小于对应的minvalue。[我们避免相等以避免重复[Point2]]
，因此约束是[ y < minValue ]。

现在让我们回过头来填充 y，我们需要在 push 的时候生成一些值并放入 y，记住。
让我们将推送的值设为小于 prevMinvalue 的 x，并将实际推送到堆栈中的值设为 y。
所以一件事是显而易见的，newMinValue=x，并且 y < newMinvalue。

现在我们需要在 prevMinvalue 和 x(newMinvalue) 的帮助下计算 y（记住 y 可以是任何小于 newMinValue(x) 的数字，所以我们需要找到一些可以满足我们约束的数字）。

```
Let's do the math:
    x < prevMinvalue [Given]
    x - prevMinvalue < 0 
    x - prevMinValue + x < 0 + x [Add x on both side]
    2*x - prevMinValue < x      
this is the y which we were looking for less than x(newMinValue).
y = 2*x - prevMinValue. 'or' y = 2*newMinValue - prevMinValue 'or' y = 2*curMinValue - prevMinValue [taking curMinValue=newMinValue]. 
```

因此，在推送 x 时，如果它小于 prevMinvalue，那么我们推送 y[2*x-prevMinValue] 并更新 newMinValue = x 。

在弹出时，如果堆栈包含的内容少于 minValue，那么这就是我们更新 minValue 的触发器。我们必须从 curMinValue 和 y 计算 prevMinValue。
  y = 2*curMinValue - prevMinValue [证明]
  prevMinValue = 2*curMinvalue - y 。

2*curMinValue - y 是我们现在需要更新为 prevMinValue 的数字。

下面共享相同逻辑的代码，时间复杂度为 O(1)，空间复杂度为 O(1)。

```
// C++ program to implement a stack that supports 
// getMinimum() in O(1) time and O(1) extra space. 
#include <bits/stdc++.h> 
using namespace std; 

// A user defined stack that supports getMin() in 
// addition to push() and pop() 
struct MyStack 
{ 
    stack<int> s; 
    int minEle; 

    // Prints minimum element of MyStack 
    void getMin() 
    { 
        if (s.empty()) 
            cout << "Stack is empty\n"; 

        // variable minEle stores the minimum element 
        // in the stack. 
        else
            cout <<"Minimum Element in the stack is: "
                 << minEle << "\n"; 
    } 

    // Prints top element of MyStack 
    void peek() 
    { 
        if (s.empty()) 
        { 
            cout << "Stack is empty "; 
            return; 
        } 

        int t = s.top(); // Top element. 

        cout << "Top Most Element is: "; 

        // If t < minEle means minEle stores 
        // value of t. 
        (t < minEle)? cout << minEle: cout << t; 
    } 

    // Remove the top element from MyStack 
    void pop() 
    { 
        if (s.empty()) 
        { 
            cout << "Stack is empty\n"; 
            return; 
        } 

        cout << "Top Most Element Removed: "; 
        int t = s.top(); 
        s.pop(); 

        // Minimum will change as the minimum element 
        // of the stack is being removed. 
        if (t < minEle) 
        { 
            cout << minEle << "\n"; 
            minEle = 2*minEle - t; 
        } 

        else
            cout << t << "\n"; 
    } 

    // Removes top element from MyStack 
    void push(int x) 
    { 
        // Insert new number into the stack 
        if (s.empty()) 
        { 
            minEle = x; 
            s.push(x); 
            cout <<  "Number Inserted: " << x << "\n"; 
            return; 
        } 

        // If new number is less than minEle 
        if (x < minEle) 
        { 
            s.push(2*x - minEle); 
            minEle = x; 
        } 

        else
           s.push(x); 

        cout <<  "Number Inserted: " << x << "\n"; 
    } 
}; 

// Driver Code 
int main() 
{ 
    MyStack s; 
    s.push(3); 
    s.push(5); 
    s.getMin(); 
    s.push(2); 
    s.push(1); 
    s.getMin(); 
    s.pop(); 
    s.getMin(); 
    s.pop(); 
    s.peek(); 

    return 0; 
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-01-13T04:02:43.713

我们**可以**在 O(n) 时间和 O(1) 空间复杂度内做到这一点，如下所示：

```
class MinStackOptimized:
  def __init__(self):
      self.stack = []
      self.min = None

  def push(self, x): 
      if not self.stack:
          # stack is empty therefore directly add
          self.stack.append(x)
          self.min = x 
      else:
          """
          Directly add (x-self.min) to the stack. This also ensures anytime we have a 
          negative number on the stack is when x was less than existing minimum
          recorded thus far.
          """
          self.stack.append(x-self.min)
          if x < self.min:
              # Update x to new min
              self.min = x 

  def pop(self):
      x = self.stack.pop()
      if x < 0:
          """ 
          if popped element was negative therefore this was the minimum
          element, whose actual value is in self.min but stored value is what
          contributes to get the next min. (this is one of the trick we use to ensure
          we are able to get old minimum once current minimum gets popped proof is given
          below in pop method), value stored during push was:
          (x - self.old_min) and self.min = x therefore we need to backtrack
          these steps self.min(current) - stack_value(x) actually implies to
              x (self.min) - (x - self.old_min)
          which therefore gives old_min back and therefore can now be set
          back as current self.min.
          """
          self.min = self.min - x 

  def top(self):
      x = self.stack[-1]
      if x < 0:
          """ 
          As discussed above anytime there is a negative value on stack, this
          is the min value so far and therefore actual value is in self.min,
          current stack value is just for getting the next min at the time
          this gets popped.
          """
          return self.min
      else:
          """ 
          if top element of the stack was positive then it's simple, it was
          not the minimum at the time of pushing it and therefore what we did
          was x(actual) - self.min(min element at current stage) let's say `y`
          therefore we just need to reverse the process to get the actual
          value. Therefore self.min + y, which would translate to
              self.min + x(actual) - self.min, thereby giving x(actual) back
          as desired.
          """
          return x + self.min

  def getMin(self):
      # Always self.min variable holds the minimum so for so easy peezy.
      return self.min 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-26T10:43:35.357

这是我的实现版本。

```
结构 MyStack {
    整数元素；
    int *CurrentMiniAddress;
 };

 无效推送（整数值）
 {
    // 创建你的结构并填充值
    MyStack S = new MyStack();
    S->元素=值；

    如果（堆栈。空（））
    {    
        // 由于栈是空的，所以将 CurrentMiniAddress 指向自身
        S->CurrentMiniAddress = S;

    }
    别的
    {
         // 栈不为空

         // 获取顶部元素。没有流行音乐（）
         MyStack *TopElement = Stack.Top();

         // 记住 TOP 元素总是指向
         //整个堆栈中的最小元素
         if (S->element CurrentMiniAddress->element)
         {
            // 如果当前值是整个栈中的最小值
            // 然后 S 指向它自己
            S->CurrentMiniAddress = S;
         }
             别的
             {
                 // 所以这不是整个堆栈中的最小值
                 // 不用担心，TOP 持有最小元素
                 S->CurrentMiniAddress = TopElement->CurrentMiniAddress;
             }

    }
        堆栈。添加（S）；
 }

 无效流行（）
 {
     if(!Stack.Empty())
     {
        堆栈.Pop();
     }  
 }

 int GetMinimum(堆栈 &stack)
 {
       如果（！stack.Empty（））
       {
            MyStack *Top = stack.top();
            // 顶部总是指向最小值x
            返回顶部->CurrentMiniAddress->元素；
        }
 }

```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-12-24T00:56:48.330

这是我的代码，它以 O(1) 运行。我之前发布的代码在弹出最小元素时出现问题。我修改了我的代码。这个使用另一个 Stack 来维护当前推送元素上方的堆栈中存在的最小元素。

```
 class StackDemo
{
    int[] stk = new int[100];
    int top;
    public StackDemo()
    {
        top = -1;
    }
    public void Push(int value)
    {
        if (top == 100)
            Console.WriteLine("Stack Overflow");
        else
            stk[++top] = value;
    }
    public bool IsEmpty()
    {
        if (top == -1)
            return true;
        else
            return false;
    }
    public int Pop()
    {
        if (IsEmpty())
        {
            Console.WriteLine("Stack Underflow");
            return 0;
        }
        else
            return stk[top--];
    }
    public void Display()
    {
        for (int i = top; i >= 0; i--)
            Console.WriteLine(stk[i]);
    }
}
class MinStack : StackDemo
{
    int top;
    int[] stack = new int[100];
    StackDemo s1; int min;
    public MinStack()
    {
        top = -1;
        s1 = new StackDemo();
    }
    public void PushElement(int value)
    {
        s1.Push(value);
        if (top == 100)
            Console.WriteLine("Stack Overflow");
        if (top == -1)
        {
            stack[++top] = value;
            stack[++top] = value;   
        }
        else
        {
            //  stack[++top]=value;
            int ele = PopElement();
            stack[++top] = ele;
            int a = MininmumElement(min, value);
              stack[++top] = min;

                stack[++top] = value;
                stack[++top] = a;

        }
    }
    public int PopElement()
    {

        if (top == -1)
            return 1000;
        else
        {
            min = stack[top--];
            return stack[top--];
        }

    }
    public int PopfromStack()
    {
        if (top == -1)
            return 1000;
        else
        {
            s1.Pop();
            return PopElement();
        }
    }
    public int MininmumElement(int a,int b)
    {
        if (a > b)
            return b;
        else
            return a;
    }
    public int StackTop()
    {
        return stack[top];
    }
    public void DisplayMinStack()
    {
        for (int i = top; i >= 0; i--)
            Console.WriteLine(stack[i]);
    }
}
class Program
{
    static void Main(string[] args)
    {
        MinStack ms = new MinStack();
        ms.PushElement(15);
        ms.PushElement(2);
        ms.PushElement(1);
        ms.PushElement(13);
        ms.PushElement(5);
        ms.PushElement(21);
        Console.WriteLine("Min Stack");
        ms.DisplayMinStack();
        Console.WriteLine("Minimum Element:"+ms.StackTop());
        ms.PopfromStack();
        ms.PopfromStack();
        ms.PopfromStack();
        ms.PopfromStack();

        Console.WriteLine("Min Stack");
        ms.DisplayMinStack();
        Console.WriteLine("Minimum Element:" + ms.StackTop());
        Thread.Sleep(1000000);
    }
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-04-12T02:49:07.060

我使用了另一种堆栈。这是实现。

```
//
//  main.cpp
//  Eighth
//
//  Created by chaitanya on 4/11/13.
//  Copyright (c) 2013 cbilgika. All rights reserved.
//

#include <iostream>
#include <limits>
using namespace std;
struct stack
{
    int num;
    int minnum;
}a[100];

void push(int n,int m,int &top)
{

    top++;
    if (top>=100) {
        cout<<"Stack Full";
        cout<<endl;
    }
    else{
        a[top].num = n;
        a[top].minnum = m;
    }

}

void pop(int &top)
{
    if (top<0) {
        cout<<"Stack Empty";
        cout<<endl;
    }
    else{
       top--; 
    }

}
void print(int &top)
{
    cout<<"Stack: "<<endl;
    for (int j = 0; j<=top ; j++) {
        cout<<"("<<a[j].num<<","<<a[j].minnum<<")"<<endl;
    }
}

void get_min(int &top)
{
    if (top < 0)
    {
        cout<<"Empty Stack";
    }
    else{
        cout<<"Minimum element is: "<<a[top].minnum;
    }
    cout<<endl;
}

int main()
{

    int top = -1,min = numeric_limits<int>::min(),num;
    cout<<"Enter the list to push (-1 to stop): ";
    cin>>num;
    while (num!=-1) {
        if (top == -1) {
            min = num;
            push(num, min, top);
        }
        else{
            if (num < min) {
                min = num;
            }
            push(num, min, top);
        }
        cin>>num;
    }
    print(top);
    get_min(top);
    return 0;
} 
```

输出：

```
Enter the list to push (-1 to stop): 5
1
4
6
2
-1
Stack: 
(5,5)
(1,1)
(4,1)
(6,1)
(2,1)
Minimum element is: 1 
```

尝试一下。我认为它回答了这个问题。每对的第二个元素给出插入该元素时看到的最小值。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-01-24T11:08:50.800

```
public class MinStack<E>{

    private final LinkedList<E> mainStack = new LinkedList<E>();
    private final LinkedList<E> minStack = new LinkedList<E>();
    private final Comparator<E> comparator;

    public MinStack(Comparator<E> comparator) 
    {
        this.comparator = comparator;
    }

    /**
     * Pushes an element onto the stack.
     *
     *
     * @param e the element to push
     */
    public void push(E e) {
        mainStack.push(e);
        if(minStack.isEmpty())
        {
            minStack.push(e);
        }
        else if(comparator.compare(e, minStack.peek())<=0)
        {
            minStack.push(e);
        }
        else
        {
            minStack.push(minStack.peek());
        }
    }

    /**
     * Pops an element from the stack.
     *
     *
     * @throws NoSuchElementException if this stack is empty
     */
    public E pop() {
       minStack.pop();
       return  mainStack.pop();
    }

    /**
     * Returns but not remove smallest element from the stack. Return null if stack is empty.
     *
     */
    public E getMinimum()
    {
        return minStack.peek();
    }

    @Override
    public String toString() {
        StringBuilder sb = new StringBuilder();
        sb.append("Main stack{");
        for (E e : mainStack) {         
            sb.append(e.toString()).append(",");
        }
        sb.append("}");

        sb.append(" Min stack{");
        for (E e : minStack) {          
            sb.append(e.toString()).append(",");
        }
        sb.append("}");

        sb.append(" Minimum = ").append(getMinimum());
        return sb.toString();
    }

    public static void main(String[] args) {
        MinStack<Integer> st = new MinStack<Integer>(Comparators.INTEGERS);

        st.push(2);
        Assert.assertTrue("2 is min in stack {2}", st.getMinimum().equals(2));
        System.out.println(st);

        st.push(6);
        Assert.assertTrue("2 is min in stack {2,6}", st.getMinimum().equals(2));
        System.out.println(st);

        st.push(4);
        Assert.assertTrue("2 is min in stack {2,6,4}", st.getMinimum().equals(2));
        System.out.println(st);

        st.push(1);
        Assert.assertTrue("1 is min in stack {2,6,4,1}", st.getMinimum().equals(1));
        System.out.println(st);

        st.push(5);
        Assert.assertTrue("1 is min in stack {2,6,4,1,5}", st.getMinimum().equals(1));
        System.out.println(st);

        st.pop();
        Assert.assertTrue("1 is min in stack {2,6,4,1}", st.getMinimum().equals(1));
        System.out.println(st);

        st.pop();
        Assert.assertTrue("2 is min in stack {2,6,4}", st.getMinimum().equals(2));
        System.out.println(st);

        st.pop();
        Assert.assertTrue("2 is min in stack {2,6}", st.getMinimum().equals(2));
        System.out.println(st);

        st.pop();
        Assert.assertTrue("2 is min in stack {2}", st.getMinimum().equals(2));
        System.out.println(st);

        st.pop();
        Assert.assertTrue("null is min in stack {}", st.getMinimum()==null);
        System.out.println(st);
    }
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-09-11T05:28:59.267

我在此处发布完整代码以在给定堆栈中查找最小值和最大值。

时间复杂度将是 O(1)..

```
package com.java.util.collection.advance.datastructure;

/**
 * 
 * @author vsinha
 *
 */
public abstract interface Stack<E> {

    /**
     * Placing a data item on the top of the stack is called pushing it
     * @param element
     * 
     */
    public abstract void push(E element);

    /**
     * Removing it from the top of the stack is called popping it
     * @return the top element
     */
    public abstract E pop();

    /**
     * Get it top element from the stack and it 
     * but the item is not removed from the stack, which remains unchanged
     * @return the top element
     */
    public abstract E peek();

    /**
     * Get the current size of the stack.
     * @return
     */
    public abstract int size();

    /**
     * Check whether stack is empty of not.
     * @return true if stack is empty, false if stack is not empty
     */
    public abstract boolean empty();

}

package com.java.util.collection.advance.datastructure;

@SuppressWarnings("hiding")
public abstract interface MinMaxStack<Integer> extends Stack<Integer> {

    public abstract int min();

    public abstract int max();

}

package com.java.util.collection.advance.datastructure;

import java.util.Arrays;

/**
 * 
 * @author vsinha
 *
 * @param <E>
 */
public class MyStack<E> implements Stack<E> {

    private E[] elements =null;
    private int size = 0;
    private int top = -1;
    private final static int DEFAULT_INTIAL_CAPACITY = 10;

    public MyStack(){
        // If you don't specify the size of stack. By default, Stack size will be 10
        this(DEFAULT_INTIAL_CAPACITY);
    }

    @SuppressWarnings("unchecked")
    public MyStack(int intialCapacity){
        if(intialCapacity <=0){
            throw new IllegalArgumentException("initial capacity can't be negative or zero");
        }
        // Can't create generic type array
        elements =(E[]) new Object[intialCapacity];
    }

    @Override
    public void push(E element) {
        ensureCapacity();
        elements[++top] = element;
        ++size;
    }

    @Override
    public E pop() {
        E element = null;
        if(!empty()) {
            element=elements[top];
            // Nullify the reference
            elements[top] =null;
            --top;
            --size;
        }
        return element;
    }

    @Override
    public E peek() {
        E element = null;
        if(!empty()) {
            element=elements[top];
        }
        return element;
    }

    @Override
    public int size() {
        return size;
    }

    @Override
    public boolean empty() {
        return size == 0;
    }

    /**
     * Increases the capacity of this <tt>Stack by double of its current length</tt> instance, 
     * if stack is full 
     */
    private void ensureCapacity() {
        if(size != elements.length) {
            // Don't do anything. Stack has space.
        } else{
            elements = Arrays.copyOf(elements, size *2);
        }
    }

    @Override
    public String toString() {
        return "MyStack [elements=" + Arrays.toString(elements) + ", size="
                + size + ", top=" + top + "]";
    }

}

package com.java.util.collection.advance.datastructure;

/**
 * Time complexity will be O(1) to find min and max in a given stack.
 * @author vsinha
 *
 */
public class MinMaxStackFinder extends MyStack<Integer> implements MinMaxStack<Integer> {

    private MyStack<Integer> minStack;

    private MyStack<Integer> maxStack;

    public MinMaxStackFinder (int intialCapacity){
        super(intialCapacity);
        minStack =new MyStack<Integer>();
        maxStack =new MyStack<Integer>();

    }
    public void push(Integer element) {
        // Current element is lesser or equal than min() value, Push the current element in min stack also.
        if(!minStack.empty()) {
            if(min() >= element) {
                minStack.push(element);
            }
        } else{
            minStack.push(element);
        }
        // Current element is greater or equal than max() value, Push the current element in max stack also.
        if(!maxStack.empty()) {
            if(max() <= element) {
                maxStack.push(element);
            }
        } else{
            maxStack.push(element);
        }
        super.push(element);
    }

    public Integer pop(){
        Integer curr = super.pop();
        if(curr !=null) {
            if(min() == curr) {
                minStack.pop();
            } 

            if(max() == curr){
                maxStack.pop();
            }
        }
        return curr;
    }

    @Override
    public int min() {
        return minStack.peek();
    }

    @Override
    public int max() {
        return maxStack.peek();
    }

    @Override
    public String toString() {
        return super.toString()+"\nMinMaxStackFinder [minStack=" + minStack + "\n maxStack="
                + maxStack + "]" ;
    }

}

// You can use the below program to execute it.

package com.java.util.collection.advance.datastructure;

import java.util.Random;

public class MinMaxStackFinderApp {

    public static void main(String[] args) {
        MinMaxStack<Integer> stack =new MinMaxStackFinder(10);
        Random random =new Random();
        for(int i =0; i< 10; i++){
            stack.push(random.nextInt(100));
        }
        System.out.println(stack);
        System.out.println("MAX :"+stack.max());
        System.out.println("MIN :"+stack.min());

        stack.pop();
        stack.pop();
        stack.pop();
        stack.pop();
        stack.pop();

        System.out.println(stack);
        System.out.println("MAX :"+stack.max());
        System.out.println("MIN :"+stack.min());
    }
} 
```

如果您遇到任何问题，请告诉我

谢谢， 维卡什

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-08-21T05:54:58.023

```
class MyStackImplementation{
    private final int capacity = 4;
    int min;
    int arr[] = new int[capacity];
    int top = -1;

    public void push ( int val ) {
        top++;
        if(top <= capacity-1){
            if(top == 0){
                min = val;
                arr[top] = val;
            }
            else if(val < min){
                arr[top] = arr[top]+min;
                min = arr[top]-min;
                arr[top] = arr[top]-min;
            }
            else {
                arr[top] = val;
            }
            System.out.println("element is pushed");
        }
        else System.out.println("stack is full");
    }

    public void pop () {
        top--;
        if(top > -1){ 
            min = arr[top];
        }
        else {min=0; System.out.println("stack is under flow");}
    }

    public int min(){
        return min;
    }

    public boolean isEmpty () {
        return top == 0;
    }

    public static void main(String...s){
        MyStackImplementation msi = new MyStackImplementation();
        msi.push(1);
        msi.push(4);
        msi.push(2);
        msi.push(10);
        System.out.println(msi.min);
        msi.pop();
        msi.pop();
        msi.pop();
        msi.pop();
        msi.pop();
        System.out.println(msi.min);
    }
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2016-04-20T13:43:23.167

[这是Jon Skeet 的回答](https://stackoverflow.com/a/685074/65732)中解释的 PHP 实现，它是在 O(1) 中获得最大堆栈的稍微更好的空间复杂度实现。

```
<?php

/**
 * An ordinary stack implementation.
 *
 * In real life we could just extend the built-in "SplStack" class.
 */
class BaseIntegerStack
{
    /**
     * Stack main storage.
     *
     * @var array
     */
    private $storage = [];

    // ------------------------------------------------------------------------
    // Public API
    // ------------------------------------------------------------------------

    /**
     * Pushes to stack.
     *
     * @param  int $value New item.
     *
     * @return bool
     */
    public function push($value)
    {
        return is_integer($value)
            ? (bool) array_push($this->storage, $value)
            : false;
    }

    /**
     * Pops an element off the stack.
     *
     * @return int
     */
    public function pop()
    {
        return array_pop($this->storage);
    }

    /**
     * See what's on top of the stack.
     *
     * @return int|bool
     */
    public function top()
    {
        return empty($this->storage)
            ? false
            : end($this->storage);
    }

    // ------------------------------------------------------------------------
    // Magic methods
    // ------------------------------------------------------------------------

    /**
     * String representation of the stack.
     *
     * @return string
     */
    public function __toString()
    {
        return implode('|', $this->storage);
    }
} // End of BaseIntegerStack class

/**
 * The stack implementation with getMax() method in O(1).
 */
class Stack extends BaseIntegerStack
{
    /**
     * Internal stack to keep track of main stack max values.
     *
     * @var BaseIntegerStack
     */
    private $maxStack;

    /**
     * Stack class constructor.
     *
     * Dependencies are injected.
     *
     * @param BaseIntegerStack $stack Internal stack.
     *
     * @return void
     */
    public function __construct(BaseIntegerStack $stack)
    {
        $this->maxStack = $stack;
    }

    // ------------------------------------------------------------------------
    // Public API
    // ------------------------------------------------------------------------

    /**
     * Prepends an item into the stack maintaining max values.
     *
     * @param  int $value New item to push to the stack.
     *
     * @return bool
     */
    public function push($value)
    {
        if ($this->isNewMax($value)) {
            $this->maxStack->push($value);
        }

        parent::push($value);
    }

    /**
     * Pops an element off the stack maintaining max values.
     *
     * @return int
     */
    public function pop()
    {
        $popped = parent::pop();

        if ($popped == $this->maxStack->top()) {
            $this->maxStack->pop();
        }

        return $popped;
    }

    /**
     * Finds the maximum of stack in O(1).
     *
     * @return int
     * @see push()
     */
    public function getMax()
    {
        return $this->maxStack->top();
    }

    // ------------------------------------------------------------------------
    // Internal helpers
    // ------------------------------------------------------------------------

    /**
     * Checks that passing value is a new stack max or not.
     *
     * @param  int $new New integer to check.
     *
     * @return boolean
     */
    private function isNewMax($new)
    {
        return empty($this->maxStack) OR $new > $this->maxStack->top();
    }

} // End of Stack class

// ------------------------------------------------------------------------
// Stack Consumption and Test
// ------------------------------------------------------------------------
$stack = new Stack(
    new BaseIntegerStack
);

$stack->push(9);
$stack->push(4);
$stack->push(237);
$stack->push(5);
$stack->push(556);
$stack->push(15);

print "Stack: $stack\n";
print "Max: {$stack->getMax()}\n\n";

print "Pop: {$stack->pop()}\n";
print "Pop: {$stack->pop()}\n\n";

print "Stack: $stack\n";
print "Max: {$stack->getMax()}\n\n";

print "Pop: {$stack->pop()}\n";
print "Pop: {$stack->pop()}\n\n";

print "Stack: $stack\n";
print "Max: {$stack->getMax()}\n";

// Here's the sample output:
//
// Stack: 9|4|237|5|556|15
// Max: 556
//
// Pop: 15
// Pop: 556
//
// Stack: 9|4|237|5
// Max: 237
//
// Pop: 5
// Pop: 237
//
// Stack: 9|4
// Max: 9 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-05-21T04:22:08.163

```
class FastStack {

    private static class StackNode {
        private Integer data;
        private StackNode nextMin;

        public StackNode(Integer data) {
            this.data = data;
        }

        public Integer getData() {
            return data;
        }

        public void setData(Integer data) {
            this.data = data;
        }

        public StackNode getNextMin() {
            return nextMin;
        }

        public void setNextMin(StackNode nextMin) {
            this.nextMin = nextMin;
        }

    }

    private LinkedList<StackNode> stack = new LinkedList<>();

    private StackNode currentMin = null;

    public void push(Integer item) {
        StackNode node = new StackNode(item);
        if (currentMin == null) {
            currentMin = node;
            node.setNextMin(null);
        } else if (item < currentMin.getData()) {
            StackNode oldMinNode = currentMin;
            node.setNextMin(oldMinNode);
            currentMin = node;
        }

        stack.addFirst(node);
    }

    public Integer pop() {
        if (stack.isEmpty()) {
            throw new EmptyStackException();
        }
        StackNode node = stack.peek();
        if (currentMin == node) {
            currentMin = node.getNextMin();
        }
        stack.removeFirst();
        return node.getData();
    }

    public Integer getMinimum() {
        if (stack.isEmpty()) {
            throw new NoSuchElementException("Stack is empty");
        }
        return currentMin.getData();
    }
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-09-17T14:41:37.097

这是我的代码，它以 O(1) 运行。在这里，我使用了向量对，其中包含推送的值，还包含直到推送的值的最小值。

这是我的 C++ 实现版本。

```
vector<pair<int,int> >A;
int sz=0; // to keep track of the size of vector

class MinStack
{
public:
    MinStack()
    {
        A.clear();
        sz=0;
    }

    void push(int x)
    {
        int mn=(sz==0)?x: min(A[sz-1].second,x); //find the minimum value upto this pushed value
        A.push_back(make_pair(x,mn));
        sz++; // increment the size
    }

    void pop()
    {
        if(sz==0) return;
        A.pop_back(); // pop the last inserted element
        sz--;  // decrement size
    }

    int top()
    {
        if(sz==0)   return -1;  // if stack empty return -1
        return A[sz-1].first;  // return the top element
    }

    int getMin()
    {
        if(sz==0) return -1;
        return A[sz-1].second; // return the minimum value at sz-1 
    }
}; 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2016-09-28T03:10:17.253

```
 **The task can be acheived by creating two stacks:**

import java.util.Stack;
    /*
     * 
     * Find min in stack using O(n) Space Complexity
     */
    public class DeleteMinFromStack {

        void createStack(Stack<Integer> primary, Stack<Integer> minStack, int[] arr) {
    /* Create main Stack and in parallel create the stack which contains the minimum seen so far while creating main Stack */
            primary.push(arr[0]);
            minStack.push(arr[0]);

            for (int i = 1; i < arr.length; i++) {
                primary.push(arr[i]);
                if (arr[i] <= minStack.peek())// Condition to check to push the value in minimum stack only when this urrent value is less than value seen at top of this stack */
                    minStack.push(arr[i]);
            }

        }

        int findMin(Stack<Integer> secStack) {
            return secStack.peek();
        }

        public static void main(String args[]) {

            Stack<Integer> primaryStack = new Stack<Integer>();
            Stack<Integer> minStack = new Stack<Integer>();

            DeleteMinFromStack deleteMinFromStack = new DeleteMinFromStack();

            int[] arr = { 5, 5, 6, 8, 13, 1, 11, 6, 12 };
            deleteMinFromStack.createStack(primaryStack, minStack, arr);
            int mimElement = deleteMinFromStack.findMin(primaryStack, minStack);
    /** This check for algorithm when the main Stack Shrinks by size say i as in loop below */
            for (int i = 0; i < 2; i++) {
                primaryStack.pop();
            }

            System.out.println(" Minimum element is " + mimElement);
        }

    }
/*
here in have tried to add for loop wherin the main tack can be shrinked/expaned so we can check the algorithm */ 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-10-08T03:49:20.190

一种在用户设计对象堆栈中找到最小值的实用实现，名为：School

Stack 将根据分配给特定地区学校的排名将学校存储在 Stack 中，例如，findMin() 给出了我们获得最大入学申请数量的学校，而这又由使用与上一季学校相关的排名的比较器。

```
The Code for same is below:

   package com.practical;

import java.util.Collections;
import java.util.Iterator;
import java.util.LinkedList;
import java.util.List;
import java.util.Stack;

public class CognitaStack {

    public School findMin(Stack<School> stack, Stack<School> minStack) {

        if (!stack.empty() && !minStack.isEmpty())
            return (School) minStack.peek();
        return null;
    }

    public School removeSchool(Stack<School> stack, Stack<School> minStack) {

        if (stack.isEmpty())
            return null;
        School temp = stack.peek();
        if (temp != null) {
            // if(temp.compare(stack.peek(), minStack.peek())<0){
            stack.pop();
            minStack.pop();
            // }

            // stack.pop();
        }
        return stack.peek();
    }

    public static void main(String args[]) {

        Stack<School> stack = new Stack<School>();
        Stack<School> minStack = new Stack<School>();

        List<School> lst = new LinkedList<School>();

        School s1 = new School("Polam School", "London", 3);
        School s2 = new School("AKELEY WOOD SENIOR SCHOOL", "BUCKINGHAM", 4);
        School s3 = new School("QUINTON HOUSE SCHOOL", "NORTHAMPTON", 2);
        School s4 = new School("OAKLEIGH HOUSE SCHOOL", " SWANSEA", 5);
        School s5 = new School("OAKLEIGH-OAK HIGH SCHOOL", "Devon", 1);
        School s6 = new School("BritishInter2", "Devon", 7);

        lst.add(s1);
        lst.add(s2);
        lst.add(s3);
        lst.add(s4);
        lst.add(s5);
        lst.add(s6);

        Iterator<School> itr = lst.iterator();
        while (itr.hasNext()) {
            School temp = itr.next();
            if ((minStack.isEmpty()) || (temp.compare(temp, minStack.peek()) < 0)) { // minStack.peek().equals(temp)
                stack.push(temp);
                minStack.push(temp);
            } else {
                minStack.push(minStack.peek());
                stack.push(temp);
            }

        }

        CognitaStack cogStack = new CognitaStack();
        System.out.println(" Minimum in Stack is " + cogStack.findMin(stack, minStack).name);
        cogStack.removeSchool(stack, minStack);
        cogStack.removeSchool(stack, minStack);

        System.out.println(" Minimum in Stack is "
                + ((cogStack.findMin(stack, minStack) != null) ? cogStack.findMin(stack, minStack).name : "Empty"));
    }

} 
```

学校对象如下：

```
package com.practical;

import java.util.Comparator;

public class School implements Comparator<School> {

    String name;
    String location;
    int rank;

    public School(String name, String location, int rank) {
        super();
        this.name = name;
        this.location = location;
        this.rank = rank;
    }

    @Override
    public int hashCode() {
        final int prime = 31;
        int result = 1;
        result = prime * result + ((location == null) ? 0 : location.hashCode());
        result = prime * result + ((name == null) ? 0 : name.hashCode());
        result = prime * result + rank;
        return result;
    }

    @Override
    public boolean equals(Object obj) {
        if (this == obj)
            return true;
        if (obj == null)
            return false;
        if (getClass() != obj.getClass())
            return false;
        School other = (School) obj;
        if (location == null) {
            if (other.location != null)
                return false;
        } else if (!location.equals(other.location))
            return false;
        if (name == null) {
            if (other.name != null)
                return false;
        } else if (!name.equals(other.name))
            return false;
        if (rank != other.rank)
            return false;
        return true;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getLocation() {
        return location;
    }

    public void setLocation(String location) {
        this.location = location;
    }

    public int getRank() {
        return rank;
    }

    public void setRank(int rank) {
        this.rank = rank;
    }

    public int compare(School o1, School o2) {
        // TODO Auto-generated method stub
        return o1.rank - o2.rank;
    }

}

class SchoolComparator implements Comparator<School> {

    public int compare(School o1, School o2) {
        return o1.rank - o2.rank;
    }

} 
```

该示例涵盖以下内容： 1\. 用户定义对象的堆栈实现，这里是学校 2\. 使用要比较的对象的所有字段实现 hashcode() 和 equals() 方法 3\. 我们的场景的实际实现rqeuire 获取堆栈包含操作的顺序为 O(1)

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2017-01-04T16:30:24.267

这是 Jon Skeets [Answer](https://stackoverflow.com/a/685074/5920706)的 C++ 实现。它可能不是实现它的最佳方式，但它完全符合它的预期。

```
class Stack {
private:
    struct stack_node {
        int val;
        stack_node *next;
    };
    stack_node *top;
    stack_node *min_top;
public:
    Stack() {
        top = nullptr;
        min_top = nullptr;
    }    
    void push(int num) {
        stack_node *new_node = nullptr;
        new_node = new stack_node;
        new_node->val = num;

        if (is_empty()) {
            top = new_node;
            new_node->next = nullptr;

            min_top = new_node;
            new_node->next = nullptr;
        } else {
            new_node->next = top;
            top = new_node;

            if (new_node->val <= min_top->val) {
                new_node->next = min_top;
                min_top = new_node;
            }
        }
    }

    void pop(int &num) {
        stack_node *tmp_node = nullptr;
        stack_node *min_tmp = nullptr;

        if (is_empty()) {
            std::cout << "It's empty\n";
        } else {
            num = top->val;
            if (top->val == min_top->val) {
                min_tmp = min_top->next;
                delete min_top;
                min_top = min_tmp;
            }
            tmp_node = top->next;
            delete top;
            top = tmp_node;
        }
    }

    bool is_empty() const {
        return !top;
    }

    void get_min(int &item) {
        item = min_top->val;
    }
}; 
```

这是课程的驱动程序

```
int main() {
    int pop, min_el;
    Stack my_stack;

    my_stack.push(4);
    my_stack.push(6);
    my_stack.push(88);
    my_stack.push(1);
    my_stack.push(234);
    my_stack.push(2);

    my_stack.get_min(min_el);
    cout << "Min: " << min_el << endl;

    my_stack.pop(pop);
    cout << "Popped stock element: " << pop << endl;

    my_stack.pop(pop);
    cout << "Popped stock element: " << pop << endl;

    my_stack.pop(pop);
    cout << "Popped stock element: " << pop << endl;

    my_stack.get_min(min_el);
    cout << "Min: " << min_el << endl;

    return 0;
} 
```

输出：

```
Min: 1
Popped stock element: 2
Popped stock element: 234
Popped stock element: 1
Min: 4 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-02-23T05:41:55.887

您可以扩展您的原始堆栈类，然后将最小跟踪添加到它。让原始父类照常处理其他所有事情。

```
public class StackWithMin extends Stack<Integer> {  

    private Stack<Integer> min;

    public StackWithMin() {
        min = new Stack<>();
    }

    public void push(int num) {
        if (super.isEmpty()) {
            min.push(num);
        } else if (num <= min.peek()) {
            min.push(num);
        }
        super.push(num);
    }

    public int min() {
        return min.peek();
    }

    public Integer pop() {
        if (super.peek() == min.peek()) {
            min.pop();
        }
        return super.pop();
    }   
} 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2017-02-26T09:06:02.627

我认为您可以在堆栈实现中简单地使用 LinkedList 。

第一次推送一个值时，你把这个值作为链表头。

那么每次push一个值，如果新值<head.data，做一个prepand操作（也就是说head变成了新值）

如果没有，则进行追加操作。

当你做一个 pop() 时，你检查是否 min == linkedlist.head.data，如果是，那么 head=head.next；

这是我的代码。

```
public class Stack {

int[] elements;
int top;
Linkedlists min;

public Stack(int n) {
    elements = new int[n];
    top = 0;
    min = new Linkedlists();
}

public void realloc(int n) {
    int[] tab = new int[n];
    for (int i = 0; i < top; i++) {
        tab[i] = elements[i];
    }

    elements = tab;
}

public void push(int x) {
    if (top == elements.length) {
        realloc(elements.length * 2);
    }
    if (top == 0) {
        min.pre(x);
    } else if (x < min.head.data) {
        min.pre(x);
    } else {
        min.app(x);
    }
    elements[top++] = x;
}

public int pop() {

    int x = elements[--top];
    if (top == 0) {

    }
    if (this.getMin() == x) {
        min.head = min.head.next;
    }
    elements[top] = 0;
    if (4 * top < elements.length) {
        realloc((elements.length + 1) / 2);
    }

    return x;
}

public void display() {
    for (Object x : elements) {
        System.out.print(x + " ");
    }

}

public int getMin() {
    if (top == 0) {
        return 0;
    }
    return this.min.head.data;
}

public static void main(String[] args) {
    Stack stack = new Stack(4);
    stack.push(2);
    stack.push(3);
    stack.push(1);
    stack.push(4);
    stack.push(5);
    stack.pop();
    stack.pop();
    stack.pop();
    stack.push(1);
    stack.pop();
    stack.pop();
    stack.pop();
    stack.push(2);
    System.out.println(stack.getMin());
    stack.display();

}

 } 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2017-09-23T16:24:26.313

这是我在 java 中使用喜欢列表的解决方案。

```
class Stack{
    int min;
    Node top;
    static class Node{
        private int data;
        private Node next;
        private int min;

        Node(int data, int min){
           this.data = data;
           this.min = min;
           this.next = null; 
    }
}

  void push(int data){
        Node temp;
        if(top == null){
            temp = new Node(data,data);
            top = temp;
            top.min = data;
        }
        if(top.min > data){
            temp = new Node(data,data);
            temp.next = top;
            top = temp;
        } else {
            temp = new Node(data, top.min);
            temp.next = top;
            top = temp;
        }
  }

  void pop(){
    if(top != null){
        top = top.next;
    }
  }

  int min(){
    return top.min;
  } 
```

}

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2018-01-09T03:56:17.840

```
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;

namespace Solution 
{
    public class MinStack
    {
        public MinStack()
        {
            MainStack=new Stack<int>();
            Min=new Stack<int>();
        }

        static Stack<int> MainStack;
        static Stack<int> Min;

        public void Push(int item)
        {
            MainStack.Push(item);

            if(Min.Count==0 || item<Min.Peek())
                Min.Push(item);
        }

        public void Pop()
        {
            if(Min.Peek()==MainStack.Peek())
                Min.Pop();
            MainStack.Pop();
        }
        public int Peek()
        {
            return MainStack.Peek();
        }

        public int GetMin()
        {
            if(Min.Count==0)
                throw new System.InvalidOperationException("Stack Empty"); 
            return Min.Peek();
        }
    }
} 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2018-04-30T12:45:50.843

在这里看到了一个绝妙的解决方案： [https ://www.geeksforgeeks.org/design-a-stack-that-supports-getmin-in-o1-time-and-o1-extra-space/](https://www.geeksforgeeks.org/design-a-stack-that-supports-getmin-in-o1-time-and-o1-extra-space/)

Bellow是我按照算法编写的python代码：

```
class Node:
    def __init__(self, value):
        self.value = value
        self.next = None

class MinStack:
    def __init__(self):
        self.head = None
        self.min = float('inf')

    # @param x, an integer
    def push(self, x):
        if self.head == None:
            self.head = Node(x)
            self.min = x
        else:
            if x >= self.min:
                n = Node(x)
                n.next = self.head
                self.head = n
            else:
                v = 2 * x - self.min
                n = Node(v)
                n.next = self.head
                self.head = n
                self.min = x

    # @return nothing
    def pop(self):
        if self.head:
            if self.head.value < self.min:
                self.min = self.min * 2 - self.head.value
            self.head = self.head.next

    # @return an integer
    def top(self):
        if self.head:
            if self.head.value < self.min:
                self.min = self.min * 2 - self.head.value
                return self.min
            else:
                return self.head.value
        else:
            return -1

    # @return an integer
    def getMin(self):
        if self.head:
            return self.min
        else:
            return -1 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2018-08-16T09:12:24.050

从 Stack 中获取最小元素。我们必须使用两个堆栈。即堆栈 s1 和堆栈 s2。

1.  最初，两个堆栈都是空的，因此向两个堆栈添加元素

---------------------递归调用步骤 2 到 4------------------------

2.  如果新元素添加到堆栈 s1。然后从堆栈 s2 中弹出元素

3.  将新元素与 s2 进行比较。哪个更小，推到s2。

4.  从堆栈 s2 中弹出（包含最小元素）

**代码如下：**

```
package Stack;
import java.util.Stack;
public class  getMin 
{  

        Stack<Integer> s1= new Stack<Integer>();
        Stack<Integer> s2 = new Stack<Integer>();

        void push(int x)
        {
            if(s1.isEmpty() || s2.isEmpty())

            {
                 s1.push(x);
                 s2.push(x);
            }
            else
            {

               s1\. push(x);
                int y = (Integer) s2.pop();
                s2.push(y);
                if(x < y)
                    s2.push(x);
                        }
        }
        public Integer pop()
        {
            int x;
            x=(Integer) s1.pop();
            s2.pop();
            return x;

        }
    public  int getmin()
        {
            int x1;
            x1= (Integer)s2.pop();
            s2.push(x1);
            return x1;
        }

    public static void main(String[] args) {
        getMin s = new getMin();
            s.push(10);
            s.push(20);
            s.push(30);
            System.out.println(s.getmin());
            s.push(1);
            System.out.println(s.getmin());
        }

} 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2021-03-28T08:15:01.547

我有更好的解决方案，使用 O(1) 时间且没有额外空间，您需要将元素作为字符串推送为 <original_value,minimum_value>。例如找到这个字符串堆栈。

|-1,-1 |

| 1,1 |

| 2,2 |

| 5,3 |

| 3,3 |

* * *

现在，您总是可以通过使用 peek 并检查给定实例的最小值来找到当前实例的最小值。这是没有额外空间的 O(1) 时间

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2012-10-12T08:39:47.130

我认为只有推送操作受到影响，就足够了。我的实现包括一堆节点。每个节点都包含数据项以及当时的最小值。每次完成推送操作时都会更新此最小值。

以下是一些理解要点：

*   我使用链表实现了堆栈。

*   指针顶部始终指向最后推送的项目。当堆栈顶部没有项目时为 NULL。

*   当一个项目被推入时，分配一个新节点，该节点有一个指向前一个堆栈的下一个指针，并且更新顶部以指向这个新节点。

与普通堆栈实现的唯一区别在于，在推送期间它会更新新节点的成员 min。

请查看以 C++ 实现的代码以进行演示。

```
/*
 *  Implementation of Stack that can give minimum in O(1) time all the time
 *  This solution uses same data structure for minimum variable, it could be implemented using pointers but that will be more space consuming
 */

#include <iostream>
using namespace std;

typedef struct stackLLNodeType stackLLNode;

struct stackLLNodeType {
    int item;
    int min;
    stackLLNode *next;
};

class DynamicStack {
private:
    int stackSize;
    stackLLNode *top;

public:
    DynamicStack();
    ~DynamicStack();
    void push(int x);
    int pop();
    int getMin();
    int size() { return stackSize; }
};

void pushOperation(DynamicStack& p_stackObj, int item);
void popOperation(DynamicStack& p_stackObj);

int main () {
    DynamicStack stackObj;

    pushOperation(stackObj, 3);
    pushOperation(stackObj, 1);
    pushOperation(stackObj, 2);
    popOperation(stackObj);
    popOperation(stackObj);
    popOperation(stackObj);
    popOperation(stackObj);
    pushOperation(stackObj, 4);
    pushOperation(stackObj, 7);
    pushOperation(stackObj, 6);
    popOperation(stackObj);
    popOperation(stackObj);
    popOperation(stackObj);
    popOperation(stackObj);

    return 0;
}

DynamicStack::DynamicStack() {
    // initialization
    stackSize = 0;
    top = NULL;
}

DynamicStack::~DynamicStack() {
    stackLLNode* tmp;
    // chain memory deallocation to avoid memory leak
    while (top) {
        tmp = top;
        top = top->next;
        delete tmp;
    }
}

void DynamicStack::push(int x) {
    // allocate memory for new node assign to top
    if (top==NULL) {
        top = new stackLLNode;
        top->item = x;
        top->next = NULL;
        top->min = top->item;
    }
    else {
        // allocation of memory
        stackLLNode *tmp = new stackLLNode;
        // assign the new item
        tmp->item = x;
        tmp->next = top;

        // store the minimum so that it does not get lost after pop operation of later minimum
        if (x < top->min)
            tmp->min = x;
        else
            tmp->min = top->min;

        // update top to new node
        top = tmp;
    }
    stackSize++;
}

int DynamicStack::pop() {
    // check if stack is empty
    if (top == NULL)
        return -1;

    stackLLNode* tmp = top;
    int curItem = top->item;
    top = top->next;
    delete tmp;
    stackSize--;
    return curItem;
}

int DynamicStack::getMin() {
    if (top == NULL)
        return -1;
    return top->min;
}
void pushOperation(DynamicStack& p_stackObj, int item) {
    cout<<"Just pushed: "<<item<<endl;
    p_stackObj.push(item);
    cout<<"Current stack min: "<<p_stackObj.getMin()<<endl;
    cout<<"Current stack size: "<<p_stackObj.size()<<endl<<endl;
}

void popOperation(DynamicStack& p_stackObj) {
    int popItem = -1;
    if ((popItem = p_stackObj.pop()) == -1 )
        cout<<"Cannot pop. Stack is empty."<<endl;
    else {
        cout<<"Just popped: "<<popItem<<endl;
        if (p_stackObj.getMin() == -1)
            cout<<"No minimum. Stack is empty."<<endl;
        else
            cout<<"Current stack min: "<<p_stackObj.getMin()<<endl;
        cout<<"Current stack size: "<<p_stackObj.size()<<endl<<endl;
    }
} 
```

程序的输出如下所示：

```
Just pushed: 3
Current stack min: 3
Current stack size: 1

Just pushed: 1
Current stack min: 1
Current stack size: 2

Just pushed: 2
Current stack min: 1
Current stack size: 3

Just popped: 2
Current stack min: 1
Current stack size: 2

Just popped: 1
Current stack min: 3
Current stack size: 1

Just popped: 3
No minimum. Stack is empty.
Current stack size: 0

Cannot pop. Stack is empty.
Just pushed: 4
Current stack min: 4
Current stack size: 1

Just pushed: 7
Current stack min: 4
Current stack size: 2

Just pushed: 6
Current stack min: 4
Current stack size: 3

Just popped: 6
Current stack min: 4
Current stack size: 2

Just popped: 7
Current stack min: 4
Current stack size: 1

Just popped: 4
No minimum. Stack is empty.
Current stack size: 0

Cannot pop. Stack is empty. 
```

* * *

## 回答 #28

> 赞同：-1
> 
> 时间：2014-09-23T08:08:17.237

```
#include<stdio.h>
struct stack
{
    int data;
    int mindata;
}a[100];

void push(int *tos,int input)
{
    if (*tos > 100)
    {
        printf("overflow");
        return;
    }
    (*tos)++;
    a[(*tos)].data=input;
    if (0 == *tos)
        a[*tos].mindata=input;
    else if (a[*tos -1].mindata < input)
        a[*tos].mindata=a[*tos -1].mindata;
    else
        a[*tos].mindata=input;
}

int pop(int * tos)
{
    if (*tos <= -1)
    {
        printf("underflow");
        return -1;
    }
    return(a[(*tos)--].data);
}
void display(int tos)
{
    while (tos > -1)
    {
        printf("%d:%d\t",a[tos].data,a[tos].mindata);
        tos--;
    }    
}

int min(int tos)
{
   return(a[tos].mindata);
}
int main()
{
int tos=-1,x,choice;
while(1)
{
    printf("press 1-push,2-pop,3-mindata,4-display,5-exit ");
    scanf("%d",&choice);
    switch(choice)
    {
    case 1: printf("enter data to push");
            scanf("%d",&x);
            push(&tos,x);
            break;
    case 2: printf("the poped out data=%d ",pop(&tos));
            break;
    case 3: printf("The min peeped data:%d",min(tos));
            break;
    case 4: printf("The elements of stack \n");
            display(tos);
            break;
    default: exit(0);
}
} 
```

* * *

## 回答 #29

> 赞同：-1
> 
> 时间：2014-10-09T04:27:25.330

我在[这里找到了这个解决方案](http://leetcode.com/2010/11/stack-that-supports-push-pop-and-getmin.html)

```
struct StackGetMin {
  void push(int x) {
    elements.push(x);
    if (minStack.empty() || x <= minStack.top())
      minStack.push(x);
  }
  bool pop() {
    if (elements.empty()) return false;
    if (elements.top() == minStack.top())
      minStack.pop();
    elements.pop();
    return true;
  }
  bool getMin(int &min) {
    if (minStack.empty()) {
      return false;
    } else {
      min = minStack.top();
      return true;
    }
  }
  stack<int> elements;
  stack<int> minStack;
}; 
```

* * *

## 回答 #30

> 赞同：-1
> 
> 时间：2015-03-13T16:11:04.717

```
struct Node {
    let data: Int
    init(_ d:Int){
        data = d
    }
}

struct Stack {
    private var backingStore = [Node]()
    private var minArray = [Int]()

    mutating func push(n:Node) {
        backingStore.append(n)
        minArray.append(n.data)
        minArray.sort(>)
        minArray
    }

    mutating func pop() -> Node? {
        if(backingStore.isEmpty){
            return nil
        }

        let n = backingStore.removeLast()

        var found = false
        minArray = minArray.filter{
            if (!found && $0 == n.data) {
                found = true
                return false
            }
            return true
        }
        return n
    }

    func min() -> Int? {
        return minArray.last
    }
} 
```

* * *

## 回答 #31

> 赞同：-1
> 
> 时间：2015-05-30T03:53:01.947

```
public interface IMinStack<T extends Comparable<T>> {
  public void push(T val);
  public T pop();
  public T minValue();
  public int size();
} 
```

* * *

```
import java.util.Stack;

public class MinStack<T extends Comparable<T>> implements IMinStack<T> {
  private Stack<T> stack = new Stack<T>();
  private Stack<T> minStack = new Stack<T>();

  @Override
  public void push(T val) {
    stack.push(val);
    if (minStack.isEmpty() || val.compareTo(minStack.peek()) < 0)
        minStack.push(val);
  }

  @Override
  public T pop() {
    T val = stack.pop();
    if ((false == minStack.isEmpty())
            && val.compareTo(minStack.peek()) == 0)
        minStack.pop();
    return val;
  }

  @Override
  public T minValue() {
    return minStack.peek();
  }

  @Override
  public int size() {
    return stack.size();
  }
} 
```

# cocoa - 如何在启动 Cocoa 应用程序期间显示启动画面？

> ID：685062
> 
> 赞同：9
> 
> 时间：2009-03-26T09:30:37.903
> 
> 标签：cocoa, splash-screen

我想在基于 Cocoa 的应用程序启动时向用户显示启动画面（图片）。这怎么可能？

* * *

首先非常感谢。因为我的应用程序运行了一段时间，所以我想在应用程序运行之前显示一个飞溅。现在，如果我在里面显示一个带有图像的窗口，之后如何运行该应用程序？如何确保应用程序在启动画面显示后运行？如何获得序列？

* * *

首先非常感谢。我在applicationWillFinishLaunching方法中使用orderFront显示窗口，然后在applicationDidFinishLaunching中隐藏它：使用orderOut，现在我发现mainWindow不显示并且应用程序终止，为什么？如何解决这个问题？谢谢！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-26T16:42:39.253

尽管彼得的回答最终是正确的（您*应该*重写您的应用程序以更快地启动），但有时这不是一个实际的选择。例如，稍后在应用程序中加载代码可能需要很长时间（例如数据采集应用程序），迫使它在启动时加载。如果您决定要显示初始屏幕，最简单的方法是在应用程序委托的`applicationWillFinishLaunching:`方法中显示它。在您的应用程序 MainMenu.nib 中创建一个启动窗口，并向引用该窗口的应用程序委托添加一个出口。然后，您可以将窗口放在屏幕上`applicationWillFinishLaunching:`并将其隐藏`applicationDidFinishLaunching:`. 请注意，主线程的 NSRunLoop 在此期间不会迭代，因此如果您想更新启动屏幕（带有状态、进度条等），您需要自己管理这些重绘事件。

再次，认真思考是否需要长时间的启动。如果是这样，显示*带有进度指示器*的初始屏幕是您欠用户的最低限度。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-26T11:15:34.313

你为什么讨厌你的用户？

说真的，不要这样做。不要让您的用户等待使用您的应用程序。而是让您的应用程序快速启动。

（以防万一您坚持要答案：显示一个包含图像的窗口，然后在您觉得用户等待的时间足够长时隐藏该窗口。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T14:36:06.233

只需放置一个带有图像的窗口并在完成启动初始化后将其关闭。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-03-29T17:06:09.857

上面巴里的回答似乎不适用于基于文档的应用程序。在其中显示启动窗口`applicationWillFinishLaunching:`会干扰应用程序的启动顺序，因此不会创建文档窗口。我在[这里](http://wtholliday.org/SplashTest.zip)上传了一个示例项目。在`applicationWillFinishLaunching:`，注释掉，`[_splashWindow orderFront:self ]`文档窗口就会出现。

# language-agnostic - 实现游程编码

> ID：685070
> 
> 赞同：3
> 
> 时间：2009-03-26T09:33:29.223
> 
> 标签：language-agnostic, compression, run-length-encoding

我编写了一个程序来执行运行长度编码。在典型情况下，如果文本是

```
AAAAAABBCDEEEEGGHJ 
```

运行长度编码将使它

```
A6B2C1D1E4G2H1J1 
```

但它为每个非重复字符添加了额外的 1。由于我正在使用它压缩 BMP 文件，因此我想放置一个标记“$”来表示重复字符的出现（假设图像文件具有大量重复文本）。

所以它看起来像

```
$A6$B2CD$E4$G2HJ 
```

对于当前示例，它的长度是相同的，但 BMP 文件存在显着差异。现在我的问题在于解码。碰巧一些 BMP 文件具有模式，`$<char><num>`即`$I9`在原始文件中，所以在压缩文件中也包含相同的文本。`$I9`，但是在解码后它会将其视为重复的 I 重复 9 次！所以它会产生错误的输出。我想知道的是我可以使用哪个符号来标记重复字符（运行）的开始，这样它就不会与原始来源冲突。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-26T09:40:59.860

为什么不`$`将原始文件`$$`中的每个都编码为压缩文件中的每个？

和/或使用其他一些字符代替`$`- 在 bmp 文件中使用不多的字符。

另请注意，BMP 格式具有“内置”RLE 压缩 - 看[这里](http://www.fileformat.info/format/bmp/egff.htm)，靠近页面底部 - 在“图像数据和压缩”下。

我不知道你用你的程序做什么，或者它只是为了学习，但是如果你使用“官方”的bmp方法，你的压缩图像在查看之前不需要解压缩。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T09:44:47.323

AAAAAABBCDEEEEGGHJ$IIIIIIIII ==> $A6$B2CD$E4$G2HJ$$I9

If the repeat character occurs in the data, try inserting an extra repeat character in the encoded data. Then if the decoder sees a double repeat character it can insert the actual repeat character

$A6$B2CD$E4$G2HJ$$I9 ==> AAAAAABBCDEEEEGGHJ$IIIIIIIII

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T10:33:25.333

大多数程序为了表示某些字符需要按字面意思处理，是因为它们具有定义的转义序列。

例如，在[正则表达式](http://en.wikipedia.org/wiki/Regular_expressions)中，以下是特殊定义的字符，通常具有含义：

```
^[].*+{}()$ 
```

是的，你有趣的美元符号字符就在那里，它通常意味着*end of line*。

因此，使用正则表达式的程序员必须做的是让这些字符按字面意思解释，他们需要将这些字符表示为转义序列。例如，要将 $ 解释*为*$*而*不是*end of line*，程序员使用*\$*，这是转义序列。(1)

在您的情况下，您可以将文字美元符号作为*\$* .(2)存储到压缩文件中

1.  注意：[grep](http://unixhelp.ed.ac.uk/CGI/man-cgi?grep)颠倒了这个逻辑。

2.  当您在 BMP 文件中运行*$时，上述将**$*存储为*$$*的解决方案会变得令人困惑。

 ** * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T10:49:31.973

如果您能够在开始压缩之前扫描整个输入，您可以选择输入中频率最低的值作为转义值。例如，给定这个输入：

```
AAAABBCCCCDDEEEEEEEFFG 
```

您可以选择“G”作为转义值（如果它是符号集的一部分，甚至可以选择“H”）并采用编码流的第一个字符是转义值的约定。所以上面的字符串可能编码为：

```
GGA4BBGC4DDGE7FFGG 
```

甚至更好：

```
HHA4BBHC4DDHE7FFG 
```

请注意，对两个相同值的“运行”进行编码是没有意义的，因为“压缩”版本（例如 HD2）比未压缩版本（DD）长。

希望有帮助！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T09:43:19.090

如果我理解正确，问题是 $ 既是标记重复的符号，也可以是“BMP”值？

如果是这样，您可以做的是标记一个双 $ ('$$') 字符以表示不应将 '$' 字符视为重复，而应将其视为单个 '$'。这当然意味着“$”的编码成本很高（需要两个符号而不是 1 个），但可以解决您的问题。

如果您想要运行 '$' 字符，则需要将其编码为： $$$5 - 表示 '$' 运行 '$$'=$, '5' - 5 次。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-01-17T07:53:20.300

老实说，如果有人想用基于文本的 RLE 压缩二进制数据，我真的不确定他们会拥有什么。BMP 不是文本。

现在，由于在 之后只读取一个字节`$`，并且它被解释为从 0 到 9 的 ascii 数字，因此该过程的运行长度范围为 0 到 9，这意味着在新的需要写入运行长度标志。毕竟，您无法区分`$I34`运行长度为 34 和`$I3`+用于重复 3 后面的`4`文字。`4`

如果同样的字节被解释为*二进制*值，它可以包含从 0 到*255*的值，从而在效率上产生*巨大*差异。

至于`$`符号本身的转义，我建议要么总是将其视为至少 1 ( `$$1`) 的重复，或者更好的是，以不同的方式对整个事物进行编码，运行长度值的顺序和数据交换，所以代码变为`$<length><data>`；那么您可以使用`$0`特殊符号来表示“只是`$`”。当解压并遇到 a 之后的 0 时`$`，不要继续阅读第三个字节。运行长度 0 无论如何都不应该出现在压缩数据中，因此可以赋予它特殊的含义，但是如果将数据字节放在第一位，这是没有用的，因为这样它仍然与正常重复的长度相同。

# spidermonkey - 安装 Spidermonkey 的先决条件

> ID：685076
> 
> 赞同：0
> 
> 时间：2009-03-26T09:34:40.887
> 
> 标签：spidermonkey

考虑到在 linux 机器上没有安装 Mozilla 相关引擎。成功安装 Spidermonkey 需要哪些特定的库或引擎？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T09:59:07.630

前段时间自己构建了 Spidermonkey，我认为除了标准的 clib 和一些 posix 的东西，比如 JS URI Objects 之外，实际上没有其他依赖项。

有[Mozilla Linux Build Prerequisites](https://developer.mozilla.org/en/Linux_Build_Prerequisites "Mozilla Linux 构建先决条件")，如果你想将它构建为 mozilla 树的一部分，尽管 Spidermonkey 的实际依赖关系要少得多。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T09:25:29.063

我认为它不需要成为 Mozilla 的一部分。我正在一台资源非常有限的机器上工作，这就是为什么我想知道需要哪些库才能将 Spidermonkey 编译为库。我想制作一个使用 Spidermonkey 来实现其 Javascript 功能的 C 应用程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-04-14T23:27:18.900

如果您的机器运行 Ubuntu，您可以尝试使用 Launchpad Developers PPA 的 Spidermonkey 包。您可以检查此类列表的包构建依赖项。

```
 sudo apt-add-repository ppa:launchpad/ppa
   sudo apt-get update
   sudo apt-get install spidermonkey-bin 
```

# c# - 如何动态访问 XAML 中的元素名称？

> ID：685077
> 
> 赞同：15
> 
> 时间：2009-03-26T09:35:03.337
> 
> 标签：c#, wpf, xaml

我有一个用户填写的 XAML 输入表单。

我想验证这个表格。

我在一个集合中有字段信息，我想循环并检查每个字段。

但是，当字段位于字符串中时，我如何访问字段的名称，**例如当 fieldInformation.FieldName = "CompanyName" 我想检查 "Field_CompanyName.Text" 时。**

伪代码：

```
foreach (var fieldInformation in _fieldInformations)
{
    if (Field_{&fieldInformation.FieldName}.Text.Length > 2)
    {
        ErrorMessage.Text = String.Format("The length of {0} is too long, please correct.", fieldInformation.FieldName);
        entryIsValid = false;
    }
} 
```

**XAML：**

```
<StackPanel Orientation="Horizontal" Margin="10 10 10 0">
    <TextBlock Width="150" Text="Customer ID:"/>
    <TextBox x:Name="Field_CustomerID" Width="150" MaxLength="5" Text=""/>
</StackPanel>
<StackPanel Orientation="Horizontal" Margin="10 10 10 0">
    <TextBlock Width="150" Text="Company Name:"/>
    <TextBox x:Name="Field_CompanyName" Width="150" MaxLength="40" Text=""/>
</StackPanel>
<StackPanel Orientation="Horizontal" Margin="10 10 10 0">
    <TextBlock Width="150"  Text="Contact Name:"/>
    <TextBox x:Name="Field_ContactName" Width="150" MaxLength="30" Text=""/>
</StackPanel> 
```

**代码隐藏：**

```
_fieldInformations.Add(new FieldInformation { FieldName = "CustomerID", FieldSize = 5 });
_fieldInformations.Add(new FieldInformation { FieldName = "CompanyName", FieldSize = 40 });
_fieldInformations.Add(new FieldInformation { FieldName = "ContactName", FieldSize = 30 }); 
```

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-03-26T09:48:45.627

这不只是文件后面代码中的 FindName 调用，还是我遗漏了什么？

```
TextBox fieldTB = (TextBox)this.FindName("Field_CompanyName"); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-26T16:30:42.030

此外，如果您愿意从后面的代码中添加 UI 元素，则必须使用`RegisterName("Field_CompanyName", some_instance)`方法调用，因为`FindName`默认情况下仅适用于 XAML 中声明的元素。

# flash - 非游戏的 Flash 广告网络

> ID：685080
> 
> 赞同：2
> 
> 时间：2009-03-26T09:36:25.610
> 
> 标签：flash, ads

我正在寻找一个 Flash 广告网络，它为我的 Flash 应用程序提供预加载广告，就像[MochiAds](http://www.mochiads.com)一样，*但*严格来说，我的 Flash 应用程序不是游戏，因此没有资格在 MochiAds 注册。有没有类似的网络可以为我提供这样的服务？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-25T15:45:21.957

NewGrounds API 用于在其门户中发布的任何内容，无论是应用程序、游戏还是卡通片。

# ruby-on-rails - Rails 中的分页和表格排序

> ID：685081
> 
> 赞同：0
> 
> 时间：2009-03-26T09:36:27.810
> 
> 标签：ruby-on-rails, sorting

我正在使用 will_paginate 和排序助手进行分页和排序。但是当我在第 2 页或第 3 页或第一页以外的任何其他页面上排序时，我面临一个问题。它重定向到第一页并仅对第一页进行排序。请帮助我如何对所有记录进行排序并返回到我所在的页面。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T10:53:28.063

您需要返回页面（2 或 3）的原因是什么？记录会改变位置和可能的页面，所以你不会在同一个地方找到它们。

那么，当您再次调用该操作时，为什么不只更改 :order 值（例如从 'firstname DESC' 到 'lastname DESC）？

```
# people_controller.rb
def index
  @people = People.search(params[:my_order], params[:page])
end

# models/people.rb
def self.search(my_order, page)
  paginate :per_page => 10, :page => page,
           :conditions => ['job like ?', "Driver"],
           :order => "%#{my_order}%"
end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-02-17T02:13:52.047

我对此有更强大的解决方案：[https ://github.com/mynameisrufus/sorted](https://github.com/mynameisrufus/sorted)

# vb.net - 无法访问已处置的对象 .NET

> ID：685082
> 
> 赞同：1
> 
> 时间：2009-03-26T09:36:32.973
> 
> 标签：vb.net

我在 .NET 中有一个 Windows 窗体，它将作为实现某些目标的向导。这包含 3 个步骤：Step1、Step2、Step3。

每个步骤实际上又是一个用户控件。主窗体包含一个显示当前步骤的面板。当我在步骤之间进行更改时：

1）通过调用其 Dispose() 方法来处理当前用户控件。
2) 清除主窗体面板
3) 初始化下一步的用户控件并将其添加到主面板

现在，问题是，第一步的用户控件包含一个用户控件。当我切换到另一个步骤并返回到步骤 1 时，我收到以下错误：

```
"Cannot access disposed object." 
```

因为在实际显示另一个步骤之前，我必须先处理用户控件。当我回到第 1 步并尝试在第 1 步打开用户控件时，会出现上述错误。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T09:54:04.477

Everything in the Controls collection of a Control is disposed when the control is disposed. So if you need to reuse those user controls, you'll need to remove them from the parent user control before disposing it.

You don't actually have to dispose the user control before displaying the next one. You can just remove it from the main form and put the new one on the main form when the step changes. Keep your user controls in a list or a dictionary and dispose them all when the main form is closing.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T09:54:05.630

为什么需要处置用户控件？通常，当表单关闭时，它会为您处理掉所有的子控件。

当你对一个对象调用 dispose 时，你实际上是在告诉它离开......你不再想要它了。你无法改变主意——一旦处理完毕，它就消失了。不要再尝试使用它了。

通常，您不会直接在对象上调用 dispose；您应该使用“使用”模式来避免在再次需要对象之前将其丢弃，并确保在使用完对象后将其丢弃。

# iphone - iphone模拟器使用多点触控问题

> ID：685086
> 
> 赞同：41
> 
> 时间：2009-03-26T09:37:59.383
> 
> 标签：iphone, multi-touch

我知道在 iphone 模拟器中使用多点触控输入，使用鼠标时按住 OPT 键。将看到两个虚拟的指尖。移动鼠标进行捏合和捏合。我的问题是在模拟器中，这两个指尖只会一直在中心重叠，如果我只想移动一个手指，另一个手指固定在一个点上，而不是一起移动两个指尖如何在 iphone 模拟器中实现这一点？在其他我希望这两个虚拟手指可以在屏幕上的任何位置重叠，但不仅仅是中心

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2009-04-26T19:02:49.643

如果您按下 Shift-Option，它们也会以静态距离*一起移动。*

# c# - 动态“WHERE”，例如对内存对象的查询

> ID：685089
> 
> 赞同：1
> 
> 时间：2009-03-26T09:38:32.860
> 
> 标签：c#, .net, linq

允许用户对像这样定义的对象定义类似 WHERE 的约束的最佳方法是什么：

```
Collection<object[]> data
Collection<string> columnNames 
```

其中 object[] 是单行。

我正在考虑动态创建一个强类型包装器并仅使用 Dynamic LINQ 但也许有一个更简单的解决方案？

DataSet 并不是一个真正的选择，因为集合相当大（40,000 多条记录），我不想在每次运行查询时创建 DataTable 并填充它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T09:45:59.690

What kind of queries do you need to run? If it's just equality, that's relatively easy:

```
public static IEnumerable<object[]> WhereEqual(
    this IEnumerable<object[]> source,
    Collection<string> columnNames,
    string column,
    object value)
{
    int columnIndex = columnNames.IndexOf(column);
    if (columnIndex == -1)
    {
        throw new ArgumentException();
    }
    return source.Where(row => Object.Equals(row[columnIndex], value);
} 
```

If you need something more complicated, please give us an example of what you'd *like* to be able to write.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T13:09:09.983

如果我明白你的意思：你想支持用户在外部编写 where 子句 - 我的意思是用户是真正的用户而不是开发人员，所以你寻求 uicontrol 的解决方案，代码 where 条件桥。我只是因为你提到了dlinq。

* * *

因此，如果我是正确的，您真正想做的是：

*   让用户能够使用列名
*   提供描述布尔函数的能力（将作为 where 标准）
*   动态组合查询并运行

对于这个任务，让我提议：来自 System.Workflow.Activities.Rules 命名空间的规则。对于规则，有几个设计器可用，更不用说 Visual Studio 附带的那些（对于网络，这是另一个问题，但也有几个）。我将从[没有工作流的规则](http://cgeers.wordpress.com/2008/01/26/using-rules-outside-of-a-workflow/)开始，然后检查 msdn 中的示例。这是一个非常灵活和可定制的引擎。

另一件事：LINQ 与此问题有关，因为返回 IQueryable 的函数可以推迟查询执行，您可以预先定义查询，并且在代码的另一部分中，可以根据用户的条件扩展返回的可查询对象（然后可以粘贴使用扩展方法）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T09:46:53.527

When just using `object`, LINQ isn't really going to help you very much... is it worth the pain? And Dynamic LINQ is certainly overkill. What is the expected way of using this? I can think of a few ways of adding basic `Where` operations.... but I'm not sure how helpful it would be.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T10:26:15.977

在您的项目中嵌入[IronPython 之](http://www.codeplex.com/Wiki/View.aspx?ProjectName=IronPython)类的东西怎么样？我们使用它来允许用户在沙箱中定义自己的表达式（过滤器和其他）。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-26T10:17:20.177

我正在考虑这样的事情：

((col1 = "abc") 或 (col2 = "xyz")) 和 (col3 = "123")

最终，使用 % 通配符支持 LIKE 运算符会很好。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-26T22:05:36.263

谢谢大家-我终于找到了。它称为 NQuery，可从 CodePlex 获得。在其文档中，甚至还有一个示例，其中包含与我的结构的绑定 - 列名列表 + 对象 [] 列表。加上功能齐全的 SQL 查询引擎。

刚刚好。

# ruby-on-rails - Rails 控制台：多次运行 Ruby 文件

> ID：685093
> 
> 赞同：10
> 
> 时间：2009-03-26T09:39:51.250
> 
> 标签：ruby-on-rails, ruby, command-line, console

Rails 提供了一个非常有用的控制台（'script/console'）。

我编写了一个 ruby​​ 文件并使用`require foo.rb`.

它第一次运行良好，但第二次和下一次`require foo.rb`不运行我的脚本（`require`不重新加载它）。

你有什么提示/技巧吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-26T11:41:39.537

**require**用于加载扩展 - 因此代码将执行一次，以使扩展出现在您的环境中，但后续 requires 不会做任何事情，因为工作已经完成。

**另一方面， load 每次都加载并执行代码**。****

 **如前所述，如果您只想运行脚本并且需要 Rails 环境，请考虑使用 script/runner

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T10:15:43.770

您可能应该尝试在脚本中加载您的 Rails 环境或使用 rake。还可以考虑使用脚本/运行器。

[这](http://shifteleven.com/articles/2006/10/08/loading-your-rails-environment-into-a-script)是一个在脚本中使用 rails 环境的旧且可能已过时的示例。一个更新和详细的版本[在这里](http://paulbarry.com/articles/2008/04/19/importing-data-with-rails)。

[堆栈溢出答案](https://stackoverflow.com/questions/529651/how-can-i-set-the-rails-environment-for-my-somewhat-stand-alone-ruby-script)

# wcf - WCF 客户端无法与在另一台机器上运行的服务协商安全访问

> ID：685095
> 
> 赞同：0
> 
> 时间：2009-03-26T09:40:14.463
> 
> 标签：wcf

我正在尝试使用绑定“wsDualHttpBinding”来托管 WCF 服务。当我从同一台机器运行我的客户端和服务（托管在 IIS 中）时，它工作正常。但是，当我在另一台机器上托管服务时，我的客户端无法注册服务。以下错误即将到来...

> [System.ServiceModel.Security.SecurityNegotiationEception] 调用者未经服务验证。内部异常：由于身份验证失败，无法满足对安全令牌的请求。

尝试从另一个工作组中的不同机器运行时出现以下错误

> “客户端无法在配置的时间内完成安全协商（00:00:00）”

在 IIS6.0 中，我关闭了集成身份验证并允许匿名访问。

我的服务的 Web.Config 如下：

* * *

```
<system.serviceModel>
    <diagnostics>
        <messageLogging logMalformedMessages="true" logMessagesAtServiceLevel="true" logMessagesAtTransportLevel="true"/>
    </diagnostics>
    <bindings>
        <wsDualHttpBinding>
            <binding name="StatTickerHttpBinding" bypassProxyOnLocal="false" useDefaultWebProxy="true" receiveTimeout="23:59:59">
                <reliableSession ordered="true" inactivityTimeout="00:30:00"/>
            </binding>
        </wsDualHttpBinding>
    </bindings>
    <services>
        <service name="StatTickerService" behaviorConfiguration="ServiceBehavior">
            <!-- Service Endpoints -->
            <endpoint address="" binding="wsDualHttpBinding" bindingConfiguration="StatTickerHttpBinding" contract="IBroadCastService">
                <!-- 
              Upon deployment, the following identity element should be removed or replaced to reflect the 
              identity under which the deployed service runs.  If removed, WCF will infer an appropriate identity 
              automatically.

                    <identity>
                        <dns value="localhost"/>
                    </identity> -->
            </endpoint>
            <endpoint address="mex" binding="mexHttpBinding" contract="IMetadataExchange"/>
        </service>
    </services>
    <behaviors>
        <serviceBehaviors>
            <behavior name="ServiceBehavior">
                <!-- To avoid disclosing metadata information, set the value below to false and remove the metadata endpoint above before deployment -->
                <serviceMetadata httpGetEnabled="true"/>
                <!-- To receive exception details in faults for debugging purposes, set the value below to true.  Set to false before deployment to avoid disclosing exception information -->
                <serviceDebug includeExceptionDetailInFaults="false"/>
            </behavior>
        </serviceBehaviors>
    </behaviors>
</system.serviceModel> 
```

* * *

我的客户端 App.Config 如下...

* * *

```
<system.serviceModel>
    <bindings>
        <wsDualHttpBinding>
            <binding name="WSDualHttpBinding_StatTickerBroadcastService" 
                closeTimeout="00:01:00" openTimeout="00:01:00" receiveTimeout="00:10:00" sendTimeout="00:01:00" 
                bypassProxyOnLocal="false" transactionFlow="false" hostNameComparisonMode="StrongWildcard" 
                maxBufferPoolSize="524288" maxReceivedMessageSize="65536" 
                messageEncoding="Text" textEncoding="utf-8" useDefaultWebProxy="true">
                <readerQuotas maxDepth="32" maxStringContentLength="8192" maxArrayLength="16384" 
                    maxBytesPerRead="4096" maxNameTableCharCount="16384"/>
                <reliableSession ordered="true" inactivityTimeout="00:30:00"/>
                <security mode="Message">
                    <message clientCredentialType="Windows" negotiateServiceCredential="true" algorithmSuite="Default"/>
                </security>
            </binding>
        </wsDualHttpBinding>
    </bindings>
    <client>
        <endpoint address="http://192.168.100.77/TPS.StatTicker.WCFservice/Service.svc" binding="wsDualHttpBinding" 
            bindingConfiguration="WSDualHttpBinding_StatTickerBroadcastService" 
            contract="BroadcastGateway.StatTickerBroadcastService" 
            name="WSDualHttpBinding_StatTickerBroadcastService">
            <identity>
                <servicePrincipalName value="host/192.168.100.77"/>
            </identity>
        </endpoint>
    </client>
</system.serviceModel> 
```

* * *

客户端配置是使用 svcutil 完成的。

在过去的 4 天里，我搜索并尝试了谷歌中给出的所有解决方案，但没有运气。请紧急帮忙。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-13T20:52:31.750

如果我理解您的问题，听起来您在授权方面遇到了问题。

这就是我认为你正在尝试做的事情：

*   用户连接到 Web 服务
*   用户使用 Windows 身份验证 (kerberos) 进行身份验证
*   网络服务器模拟用户
*   Webserver 通过 WCF 连接到后端
*   Web 服务器使用用户的凭据（kerberos）向后端进行身份验证
*   后端接受凭据并提供数据

需要发生的是您的后端必须信任您的 Web 服务器代表您执行操作，称为委托。这是由域控制的，而不是自由给出的。

如果两台机器在同一个域上，域控制器必须将 Web 服务器配置为能够为用户委派。没有这个，网络上的任何机器都不会信任您代表用户行事的 Web 服务器。如果这一切都发生在同一台机器上，它会进行自己的委托。

如果两台机器都在一个工作组中，我不知道你会做什么。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T09:43:26.297

我认为您需要在服务器的 web.config 中指定“无”安全性。否则它将默认坚持使用身份验证机制。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-15T00:14:50.493

尝试这个：

```
<identity>
    <servicePrincipalName value=""/>
</identity> 
```

# ruby-on-rails - Rails 中的外键问题

> ID：685102
> 
> 赞同：3
> 
> 时间：2009-03-26T09:42:59.620
> 
> 标签：ruby-on-rails, ruby, foreign-keys

我花了一段时间才找到这个错误，但我终于找到了*原因*。我正在使用 Rails 框架对纸牌游戏进行建模。目前我的数据库看起来（大部分）是这样的：

```
cards     cards_games     games      
-----     -----------     -----
id        id              id
c_type    card_id         ...
value     game_id         other_stuff 
```

Rails ActiveRecord card.rb 和 game.rb 目前看起来像这样

```
#card.rb
class Card < ActiveRecord::Base
  has_and_belongs_to_many :player
  has_and_belongs_to_many :game
  has_and_belongs_to_many :cardsInPlay, :class_name => "Rule"
end 
```

* * *

```
#game.rb
class Game < ActiveRecord::Base
  has_and_belongs_to_many :cards
  has_many :players
  has_one :rules, :class_name => Rule
end 
```

当我尝试运行一个游戏并且有多个游戏（超过 1 个）时，我收到错误

```
ActiveRecord::StatementInvalid in GameController#start_game
# example
Mysql::Error: Duplicate entry '31' for key 1: INSERT INTO `cards_games` (`card_id`, `id`, `game_id`) VALUES (31, 31, 7) 
```

每次操作失败时，cardid == id。我认为这与 Rails 如何将数据插入数据库有关。由于没有 cardgames 对象，我认为它只是将 card_id 拉入 id 并将其插入数据库。这工作正常，直到您有两个游戏使用同一张卡片，这违反了卡片游戏的主键约束。由于对数据库非常熟悉，我对这个问题的第一个解决方案是尝试通过删除 id 并将 cardid 和 gameid 作为主键来强制 rails 遵循这种关系的“真实”定义。它不起作用，因为迁移似乎无法处理具有两个主键的问题（尽管 Rails API 说可以这样做......很奇怪）。另一个解决方案是省略“id” INSERT INTO 语句中的列，并让数据库处理自动增量。不幸的是，我也不知道该怎么做。

那么，是否有另一种解决方法呢？有一些我不知道的漂亮的 Rails 技巧吗？或者这种结构在 Rails 中是不可能的？这真的很令人沮丧，因为我*知道*出了什么问题，而且我*知道*有几种方法可以修复它，但是由于 Rail 框架的限制，我无法做到。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-06-09T15:51:20.640

`has_and_belongs_to_many`表示一个连接表，它不能有一个`id`主键列。将您的迁移更改为

```
create_table :cards_games, :id => false do ... 
```

正如马特指出的那样。如果只有从两列中创建一个键才能睡得更好，请在它们上创建一个唯一索引：

```
add_index :cards_games, [ :card_id, :game_id ], :unique => true 
```

此外，您的命名偏离了 Rails 约定，会使您的代码更难阅读。

`has_and_belongs_to_many`在查看类的实例时定义 1:M 关系。因此`Card`，您应该使用：

```
has_and_belongs_to_many :players
has_and_belongs_to_many :games 
```

注意复数“玩家”和“游戏”。同样在`Game`：

```
has_one :rule 
```

这也会让你放弃不必要`:class_name => Rule`的 .

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-04T22:35:07.677

要删除 ID 列，只需不要一开始就创建它。

```
 create_table :cards_rules, :id => false do ... 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-04T22:18:34.823

请参阅 Dr. Nis 复合主键

[http://compositekeys.rubyforge.org/](http://compositekeys.rubyforge.org/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T10:34:05.020

我在破解后找到了解决方案。我发现您可以在迁移中使用“执行”功能。这非常有用，让我可以为这个问题拼凑出一个不优雅的解决方案。如果有人有更优雅、更像 Rails 的解决方案，请告诉我。这是迁移形式的解决方案：

```
class Make < ActiveRecord::Migration
  def self.up
    drop_table :cards_games
    create_table :cards_games do |t|
      t.column :card_id, :integer, :null => false
      t.column :game_id, :integer, :null => false
    end
    execute "ALTER TABLE cards_games DROP COLUMN id"
    execute "ALTER TABLE cards_games ADD PRIMARY KEY (card_id, game_id)"

    drop_table :cards_players
    create_table :cards_players do |t|
      t.column :card_id, :integer, :null => false
      t.column :player_id, :integer, :null => false
    end
    execute "ALTER TABLE cards_players DROP COLUMN id"
    execute "ALTER TABLE cards_players ADD PRIMARY KEY (card_id, player_id)"

    drop_table :cards_rules
    create_table :cards_rules do |t|
      t.column :card_id, :integer, :null => false
      t.column :rule_id, :integer, :null => false
    end
    execute "ALTER TABLE cards_rules DROP COLUMN id"
    execute "ALTER TABLE cards_rules ADD PRIMARY KEY (card_id, rule_id)"
  end

  def self.down
    drop_table :cards_games
    create_table :cards_games do |t|
      t.column :card_id, :integer
      t.column :game_id, :integer
    end

    drop_table :cards_players
    create_table :cards_players do |t|
      t.column :card_id, :integer
      t.column :player_id, :integer
    end

    drop_table :cards_rules
    create_table :cards_rules do |t|
      t.column :card_id, :integer
      t.column :rule_id, :integer
    end
  end
end 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T10:38:40.237

你可能想看看这个[foreign_key_migrations 插件](http://github.com/harukizaemon/foreign_key_migrations/tree/master)

# sql-server - 翻译 SQL 以与 Oracle 一起使用

> ID：685106
> 
> 赞同：3
> 
> 时间：2009-03-26T09:43:45.000
> 
> 标签：sql-server, oracle

我有 2 个 Oracle 问题

1.  如何翻译此 SQL Server 语句以在 Oracle 上工作？

    ```
     Create table MyCount(Line int identity(1,1)) 
    ```

2.  用于在 Orace 数据库中存储图片的 SQL Server 图像类型的等效项是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T09:59:02.047

1：您必须创建一个序列和一个触发器

```
 CREATE SEQUENCE MyCountIdSeq;
 CREATE TABLE MyCount (
     Line INTEGER NOT NULL,
     ...
 );
 CREATE TRIGGER MyCountInsTrg BEFORE INSERT ON MyCount FOR EACH ROW AS
 BEGIN
     SELECT MyCountIdSeq.NEXTVAL INTO :new.Line
 END;
 / 
```

2：斑点。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-26T10:10:18.027

如果您管理插入，则不需要为此使用触发器：

```
CREATE SEQUENCE seq;

CREATE TABLE mycount
(
   line NUMBER(10,0)
); 
```

然后，插入一个值：

```
INSERT INTO mycount(line) VALUES (seq.nextval); 
```

对于图像，您可以使用[BLOB](http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/sql_elements001.htm#sthref168)存储任何二进制数据或使用[BFILE](http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/sql_elements001.htm#sthref164)或多或少地作为 BLOB 进行管理，但数据存储在文件系统上，例如`jpg`文件。

参考：

*   [创建序列参考](http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/statements_6014.htm#i2154127)。
*   [创建表引用](http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/statements_7002.htm#i2095331)。
*   [Oracle® 数据库应用程序开发人员指南 - 大对象](http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14249/toc.htm)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2018-02-18T15:58:56.130

我们的工具可以为您解答这些问题。我说的是 Oracle SQL Developer。

首先 - 它有一个创建表向导 - 并且 12/18c 数据库支持身份列的本机实现。

[![在此处输入图像描述](https://i.stack.imgur.com/EDvJG.png)](https://i.stack.imgur.com/EDvJG.png)

还有你的新表 DDL

```
CREATE TABLE MYCOUNT 
(
  LINE INT GENERATED ALWAYS AS IDENTITY NOT NULL 
); 
```

此外，我们还有一个转换器——它可以获取 SQL Server 位并将它们转换为等效的 Oracle 位。有一个成熟的迁移向导将捕获和转换您的整个数据模型。

但是对于一次性，您可以使用 Scratchpad。它位于“工具”、“迁移”菜单下。

在这里，它获取您的代码并为您提供可以在任何 Oracle 数据库中使用的东西。

[![在此处输入图像描述](https://i.stack.imgur.com/qowNW.png)](https://i.stack.imgur.com/qowNW.png)

如果您使用的是该版本的 Oracle，请务必使用 12/18c 中的身份功能。需要维护的数据库对象更少。

# sql - 如何一次删除所有 ms-access 表中的数据？

> ID：685112
> 
> 赞同：8
> 
> 时间：2009-03-26T09:46:11.127
> 
> 标签：sql, ms-access

MS-Access 中有没有办法一次删除所有表中的数据。我们在access中运行一个数据库，每个月保存数据，然后删除access中的所有数据。但它需要从很多表中删除数据。没有更简单/更容易的方法吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-26T09:55:24.193

你为什么不保留一个空的数据库副本。在月底，保存现有数据库，然后将空数据库复制到其位置。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-26T15:00:59.543

克雷格的回答简单而明智。如果您真的想要一个编程解决方案，以下 VBA 脚本将清除每个表中的所有数据，不包括隐藏表。它需要启用 DAO - 在 Visual Basic 编辑器中，转到工具 -> 参考，然后勾选 Microsoft DAO 3.6 对象库，然后确定：

```
Public Sub TruncateTables()
'Majority of code taken from a data dictionary script I can no longer source nor find the author

On Error GoTo Error_TruncateTables

Dim DB As DAO.Database
Dim TDF As DAO.TableDef
Dim strSQL_DELETE As String

Set DB = CurrentDb()

    For Each TDF In DB.TableDefs
        If Left(TDF.Name, 4) <> "MSys" Then
            strSQL_DELETE = "DELETE FROM " & TDF.Name & ";"
            DB.Execute strSQL_DELETE
        End If
    Next

MsgBox "Tables have been truncated", vbInformation, "TABLES TRUNCATED"
DB.Close

Exit_Error_TruncateTables:
    Set TDF = Nothing
    Set DB = Nothing
    Exit Sub

Error_TruncateTables:
    Select Case Err.Number
        Case 3376
            Resume Next 'Ignore error if table not found
         Case 3270 'Property Not Found
            Resume Next
        Case Else
            MsgBox Err.Number & ": " & Err.Description
            Resume Exit_Error_TruncateTables
    End Select
End Sub 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2014-09-30T01:48:09.973

Alistair 给出了很好的答案，尽管它需要更新。旧的 if 语句会导致错误，并且旧的动态字符串不适用于名称包含空格的表。它将像“人员信息”这样的名称视为“人员”。如果您希望某些表保留其数据，我已经更新了代码，并且使向 if 语句添加异常变得更容易一些。

```
 Public Sub TruncateTables()
    'Majority of code taken from a data dictionary script I can no longer source nor find the author

    On Error GoTo Error_TruncateTables

    Dim DB As DAO.Database
    Dim TDF As DAO.TableDef
    Dim strSQL_DELETE As String

    Set DB = CurrentDb()

        For Each TDF In DB.TableDefs
            If Not (TDF.Name Like "MSys*" Or TDF.Name Like "~*" Or Len(TDF.Connect) > 0) Then
                'This will prevent system, temporary and linked tables from being cleared
                strSQL_DELETE = "DELETE FROM " & "[" & TDF.Name & "]"
                DB.Execute strSQL_DELETE
            End If
        Next

    MsgBox "Tables have been truncated", vbInformation, "TABLES TRUNCATED"
    DB.Close

    Exit_Error_TruncateTables:
        Set TDF = Nothing
        Set DB = Nothing
        Exit Sub

    Error_TruncateTables:
        Select Case Err.Number
            Case 3376
                Resume Next 'Ignore error if table not found
             Case 3270 'Property Not Found
                Resume Next
            Case Else
                MsgBox Err.Number & ": " & Err.Description
                Resume Exit_Error_TruncateTables
        End Select
    End Sub 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T09:55:28.077

由于这是一个重复的操作，因此最好编写一个简单的 SQL 脚本来执行此操作。

```
DELETE FROM <table1>;
DELETE FROM <table2>;
...
DELETE FROM <tablen>; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-01-08T14:40:49.380

突出显示所有 ROWS，然后按键盘上的 Delete 键。如果访问正在做那件事，它不会让你进入底部，然后进入一个单元格并单击 ctrl+向下箭头。要突出显示所有行，请突出显示顶行，然后滚动到底行并在选择底行时按住 shift 键。所有行都应突出显示。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-02-24T19:41:10.553

这将删除除系统表之外的所有表中的所有数据

```
Dim T As TableDef
DoCmd.SetWarnings False
For Each T In CurrentDb.TableDefs
    If T.Name Like "d2s_*" Then
        DoCmd.RunSQL "DELETE * FROM " & T.Name
    End If
Next T
DoCmd.SetWarnings True 
```

另一种方法：（基于[Christopher Duke](https://stackoverflow.com/users/4977999)的建议）

```
Dim T As TableDef
DoCmd.SetWarnings False
For Each T In CurrentDb.TableDefs
    If Not Left(T.Name, 4) = "MSys" Then
        DoCmd.RunSQL "DELETE * FROM [" & T.Name & "]"
    End If
Next T
DoCmd.SetWarnings True 
```

# internet-explorer - BHO - 从工作线程附加事件处理程序

> ID：685116
> 
> 赞同：0
> 
> 时间：2009-03-26T09:46:47.007
> 
> 标签：internet-explorer, com, bho

在 DISPID_DOCUMENTCOMPLETE 上，如果我从工作线程为 DOM 中的特定元素附加 onclick 处理程序，那么在单击它时不会触发该事件，可能是什么原因？如果我从主线程附加事件处理程序，这工作正常，但我想异步做事。

我正在使用 CoMarshalInterThreadInterfaceInStream 和 CoGetInterfaceAndReleaseStream 在线程之间传递 IID_IWebBrowser2 指针。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T10:17:30.270

你的工作线程在做什么，事件处理程序的线程模型是什么？如果线程模型是 STA，那么工作线程需要周期性地泵送消息，或者如果它正在等待同步，那么它应该使用这些`CoWaitFor...`函数来确保处理 COM 消息。或者，您可以聚合免费的线程编组器，但要确保您的对象是线程安全的，并且不会调用任何其他 COM 接口，如果这样做可能会给您带来线程模型错误。

可能，Web 浏览器控件与 MTA 不兼容，因此您将无法将其放置在其中。在任何情况下，MTA 都与用户界面线程不兼容，因此排除了这种情况。

# java - 3 层应用程序的 Java 和 J2EE 代码示例

> ID：685119
> 
> 赞同：3
> 
> 时间：2009-03-26T09:47:12.043
> 
> 标签：java, jakarta-ee

您是否知道有一个网站提供 3 层应用程序（通常的数据访问层、业务层和 UI 层）的示例源代码教程？

简单、易读、直观的源代码。也欢迎适用于代码的最佳实践。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T10:32:19.003

看看[Appfuse](http://appfuse.org)，它是 java web 应用程序的快速入门，提供了不同的框架：Tapestry、Spring MVC / Struts2 /JSF + Hibernate / Hibatis。它基于 Maven 构建，为您完成所有基本配置......我想到的为数不多的“现实”示例之一......

另一个是[来自 sun 的 Petstore 应用程序](http://java.sun.com/developer/technicalArticles/J2EE/petstore/)，在 Google 上寻找“petstore 下载”，你可以找到看起来很有趣的东西（反正对我来说，我没看过 :-)，比如这个[春天的 petstore](http://code.google.com/p/spring-petstore/)，“一个带有 DWR、Spring 和 Hibernate 的基于 Ajax 的应用程序"...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T09:54:05.443

是的，看一下[Spring MVC 一步一步的](http://static.springframework.org/docs/Spring-MVC-step-by-step/)例子。很清楚。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-29T20:35:59.370

我知道的示例应用程序如下：

*   Sun著名的[Java Pet Store 。](http://java.sun.com/developer/releases/petstore/)在我下载的版本中，它使用了广泛的 Java EE 技术，但没有使用任何现代 MVC 框架。
*   在 Spring 项目中，您有几个应用程序：JPetStore、Pet Clinic 等等。所有都带有弹簧下载。
*   Seam 框架有一个[酒店预订应用程序](http://docs.jboss.org/seam/latest/reference/en-US/html/tutorial.html)
*   您还可以查看 3 层开源应用程序，例如[Liferay](http://www.liferay.com/)，但请记住它们可能非常大。我不熟悉我可以推荐的任何东西，所以请谷歌搜索 CRM/ERP/Protals 等。（sourceforge 和freshmeat.net 也可能是很好的来源）
*   尽管它由 CMS 而不是数据库支持，但[Artifactory](http://sourceforge.net/projects/artifactory/)也可以作为一个很好的例子。

希望这些帮助。

# c - 如何使用预处理器识别 Linux 上的 64 位构建？

> ID：685124
> 
> 赞同：4
> 
> 时间：2009-03-26T09:51:43.267
> 
> 标签：c, linux, build, 64-bit

我即将将 Windows 32 位应用程序移植到 64 位，但以后可能会决定将整个应用程序移植到 Linux。

代码包含的部分取决于应用程序可用的内存量（这取决于我是在创建 32 位还是 64 位版本），而应保留编译 32 位版本代码的能力以供向后使用兼容性。

在 Windows 上，我可以简单地将相应的代码部分包装到预处理器语句中，以确保编译正确版本的代码。

不幸的是我在Linux平台上编程的经验很少，所以出现了问题：

如何识别 Linux 平台上的 64 位版本？

是否有任何（最好是非编译器特定的）预处理器定义我可以检查这个？

提前致谢！

\比约恩

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-26T23:09:42.897

假设您正在为 IA32（32 位）和 amd64（AMD64 / x86-64 / EM64T / Intel 64 的非安腾 64 位目标）使用最新的 GNU GCC 编译器，因为很少有人需要不同的 Linux 编译器（英特尔和 PGI）。

有编译器行开关（您可以在 Makefile 中将其添加到 CFLAGS）-m64 / -m32 来控制构建目标。

对于条件 C 代码：

```
#if defined(__LP64__) || defined(_LP64)
#define BUILD_64   1
#endif 
```

或者

```
#include <limits.h>
#if ( __WORDSIZE == 64 )
#define BUILD_64   1
#endif 
```

虽然第一个是 GCC 特定的，但第二个更便携，但在我想不到的一些奇怪的环境中可能不正确。

目前，两者都应该适用于 IA-32 / x86 (x86-32) 和 x86-64 / amd64 环境。我认为它们**也可能**适用于 IA-64（安腾）。

另请参阅 Andreas Jaeger 在 GCC 开发者峰会上发表的题为“[移植到 64 位 GNU/Linux 系统](ftp://gcc.gnu.org/pub/gcc/summit/2003/Porting%20to%2064%20bit.pdf)”的论文，其中更详细地描述了 64 位 Linux 环境。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-26T09:55:53.427

根据[GCC 手册](http://gcc.gnu.org/onlinedocs/cpp/Common-Predefined-Macros.html#Common-Predefined-Macros)：

> `__LP64__`
> 
> `_LP64`
> 
> 如果（且仅当）编译是针对 long int 和 pointer 都使用 64 位且 int 使用 32 位的目标时，这些宏被定义为值为 1。

这就是你需要的，对吧？

另外，你可以试试

```
#define __64BIT (__SIZEOF_POINTER__ == 8) 
```

# c# - 在 C# 中以独占模式打开文件

> ID：685135
> 
> 赞同：21
> 
> 时间：2009-03-26T09:56:27.777
> 
> 标签：c#, file, io

我想以独占模式打开一个文件进行读取，如果该文件已经被其他进程/线程打开，我想收到一个异常。我尝试了以下代码，但不起作用，即使我打开了 foo.txt，我仍然可以到达 Console.WriteLine 语句。有任何想法吗？

```
static void Main(string[] args)
{
    using (Stream iStream = File.Open("c:\\software\\code.txt", FileMode.Open,
    FileAccess.Read, FileShare.None))
    {
        Console.WriteLine ("I am here");
    }

    return;
} 
```

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-03-26T10:10:15.063

你正在做的是正确的事情。可能您只是在错误地测试它。您应该使用**在文件打开时锁定文件**的程序打开它。记事本不行。您可以运行您的应用程序两次以查看：

```
static void Main(string[] args)
{
    // Make sure test.txt exists before running. Run this app twice to see.
    File.Open("test.txt", FileMode.Open, FileAccess.Read, FileShare.None);
    Console.ReadKey();
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-26T12:52:29.367

通过编写一个简单的控制台模式程序来测试它，该程序打开文件然后等待：

```
static void Main(string args[])
{
    using (FileStream f = File.Open("c:\\software\\code.txt", FileMode.Open, FileAccess.Read, FileShare.None))
    {
        Console.Write("File is open. Press Enter when done.");
        Console.ReadLine();
    }
} 
```

从命令行（或 Visual Studio 的另一个实例）运行该程序，然后运行您的程序。这样，您可以使用不同的 FileMode 和 FileShare 值来确保您的程序在所有情况下都能正确响应。

而且，不，您不必先检查文件是否打开。如果文件已经打开，您的代码应该抛出异常。所以你所要做的就是处理那个异常。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-26T10:28:36.080

你所做的是正确的。

如果您需要已经打开的所有文件，那么有一种方法可以通过 NtQuerySystemInformation 查看

您可以从[http://www.codeproject.com/KB/shell/OpenedFileFinder.aspx得到想法](http://www.codeproject.com/KB/shell/OpenedFileFinder.aspx)

它获取在目录中打开的所有文件..无论是否打开都可以扩展为单个文件...

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-26T10:08:02.743

我建议使用该`FileAccess.ReadWrite`成员，因为某些文件可能已经打开，但允许您`Read`访问该文件。但是，我猜想在非异常情况下，所有打开`Read/Write`访问的文件都不允许您的代码访问`Write`该文件。

当然（正如 Mehrdad 已经解释过的），如果您使用记事本等编辑器打开文件作为测试，您将无法限制访问，因为记事本根本不会锁定文件。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-26T10:11:46.103

FileShare.None 仅在另一个进程也打开了文件而不允许共享以供读取时才有效。

记事本和 Visual Studio 等程序不会锁定文本文件。

# iphone - iPhone：还有其他方式可以让您获得 First Responder 身份吗？

> ID：685142
> 
> 赞同：0
> 
> 时间：2009-03-26T10:02:55.797
> 
> 标签：iphone

问题：如果你有一个很大的表单，里面有很多带有数字键盘的文本输入字段，你不想告诉每个文本字段

```
[myTextField1 resignFirstResponder];
[myTextField2 resignFirstResponder]; 
```

相反，最好只告诉例如一个不可见的背景按钮，只要用户在任何文本字段之外进行选项卡，它就是第一响应者。

就像在 JavaScript 中一样，当你给一个元素 focus() 时，所有其他元素都会失去它。我如何在 UIKit 中做到这一点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-26T10:06:57.473

```
[button becomeFirstResponder]; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-09-28T22:18:46.013

1.  在你的头文件中，粘贴这个： -`(IBAction)backgroundClicked:(id)sender;`
2.  在你的实现文件中，粘贴这个：

    ```
    (IBAction) backgroundClicked:(id)sender
    {
        [nameField resignFirstResponder];
        [numberField resignFirstResponder];
    } 
    ```

3.  在 InterfaceBuilder 中，创建一个覆盖整个视图的按钮。

4.  选择按钮后，单击布局 > 置于底层
5.  控制从按钮拖动到 File's Owner 并选择名为：backgroundClicked 的插座。

# debugging - 如何在没有调试器的情况下从核心文件中打印变量

> ID：685144
> 
> 赞同：1
> 
> 时间：2009-03-26T10:04:04.077
> 
> 标签：debugging

是否可以在不使用任何调试器（如 gdb 或 dbx）的情况下从核心文件中打印变量的值

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T10:15:42.507

不。

您将需要一个程序来查看核心文件和可执行文件中的调试信息。如果它让你高兴，你可以说这个程序不是调试器：p

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T11:16:08.057

好吧，当然可以。

是否存在执行此操作的程序是另一个问题，大多数人会很乐意在调试器中加载 coredump。但是，如果 GDB 编写得足够模块化，则完全可以只使用图像加载器和符号查找组件，并避免用户界面、断点、运行调试（等等）代码。

有什么意义呢？:)

# version-control - 完全手动 Mercurial 合并

> ID：685151
> 
> 赞同：19
> 
> 时间：2009-03-26T10:08:46.640
> 
> 标签：version-control, mercurial, merge

有什么方法可以完全手动控制 Mercurial 中的合并过程？

我希望能够选择文件合并的方向，即使是没有冲突的文件。那可能吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-02T05:02:35.870

在合并配置中关闭“预合并”。然后一切都算作冲突，您可以为每个文件更改选择“左”或“右”。

```
[merge-tools]
mymergetool.premerge = False 
```

来自[Mercurial wiki 上的 MergeToolConfiguration](http://www.selenic.com/mercurial/wiki/index.cgi/MergeToolConfiguration)。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-06-25T20:37:36.527

以这种方式编辑您的配置文件：

```
[ui]
merge = kdiff3

[merge-tools]
kdiff3.premerge = false
kdiff3.args=--L1 base --L2 local --L3 other $base $local $other -o $output 
```

默认情况下，它将`--auto`参数放在 kdiff3 上，因此 kdiff3 自动合并。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T10:17:17.010

总是在工作目录的父版本和另一个版本之间执行合并，默认情况下是您存储库中的另一个头。

如果你想合并到另一个“方向”，你可以通过检查一个特定的修订来改变你的工作目录中的哪个分支：

```
hg update -r [rev] 
```

要查看存储库中有哪些头，请运行以下命令：

```
hg heads 
```

或者，如果您正在使用，`fetch`您可以使用`--switch-parent`选项在另一个方向合并：

```
hg fetch --switch-parent 
```

您不能逐个文件更改合并的方向，因为 Mercurial 使用影响整个存储库的变更集，而不是通过跟踪对单个文件（如 CVS）的更改。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2018-02-05T15:01:37.350

在 KDiff3 的情况下，添加选项至关重要`--qall`（请参阅[http://kdiff3.sourceforge.net/doc/documentation.html](http://kdiff3.sourceforge.net/doc/documentation.html)）。没有这个键会自动合并一些冲突（比如“*合并*”菜单中的“*自动解决简单冲突*” ）。因此更合适的命令行是：

 *```
[ui]
merge = kdiff3

[merge-tools]
kdiff3.premerge = False
kdiff3.args=$base $local $other -o $output --L1 base --L2 local --L3 other --qall 
```

# c# - C#：隐式运算符和扩展方法

> ID：685156
> 
> 赞同：14
> 
> 时间：2009-03-26T10:12:01.237
> 
> 标签：c#, operator-overloading, extension-methods

我正在尝试创建一个`PredicateBuilder<T>`包装 an并`Expression<Func<T, bool>>`提供一些方法来轻松构建具有各种方法的表达式的类。我认为如果我可以直接使用它会很酷，并且认为这可以通过有一个方法来完成。`And``Or``PredicateBuilder<T>``Expression<Func<T, bool>>``implicit operator`

类的精简版如下所示：

```
class PredicateBuilder<T>
{
    public Expression<Func<T, bool>> Predicate { get; protected set; }

    public PredicateBuilder(bool initialPredicate)
    {
        Predicate = initialPredicate 
            ? (Expression<Func<T, bool>>) (x => true) 
            : x => false;
    }

    public static implicit operator Expression<Func<T, bool>>(
        PredicateBuilder<T> expressionBuilder)
    {
        return expressionBuilder.Predicate;
    }
} 
```

然后，作为一个测试，我在一个静态类中有这个扩展方法：

```
public static void PrintExpression<T>(this Expression<Func<T, bool>> expression)
{
    Console.WriteLine(expression);
} 
```

在我的脑海中，我应该能够做到这些：

```
var p = new PredicateBuilder<int>(true);

p.PrintExpression();
PredicateExtensions.PrintExpression(p); 
```

但是，它们都不起作用。对于第一个，没有找到扩展方法。第二个，它说

> 无法从用法中推断出方法“ExtravagantExpressions.PredicateHelper.PrintExpression(System.Linq.Expressions.Expression>)”的类型参数。尝试明确指定类型参数。

所以我尝试了以下方法，它有效：

```
PredicateExtensions.PrintExpression<int>(p); 
```

当然，这也有效：

```
((Expression<Func<int, bool>>) p).PrintExpression(); 
```

但是，是的......为什么其他人不工作？我是否误解了这`implicit operator`件事的工作原理？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-26T10:48:20.400

这并不特定于扩展方法。除非有关于目标类型的线索，否则 C# 不会将对象隐式转换为另一种类型。假设如下：

```
class A {
    public static implicit operator B(A obj) { ... }
    public static implicit operator C(A obj) { ... }
}

class B {
    public void Foo() { ... }
}

class C {
    public void Foo() { ... }
} 
```

您希望在以下语句中调用哪种方法？

```
new A().Foo(); // B.Foo? C.Foo? 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T10:16:27.870

不，您没有，但是 C# 编译器的类型推导功能不足以理解您的代码，尤其是它不考虑隐式运算符。你必须坚持`Expression<Func<T,bool>>`——为什么不直接在表达式上使用像`Or`,这样的扩展方法呢？`And`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T10:31:30.707

正如 Anton 所说，如果您将扩展方法直接放在`Expression<Func<...>>`它上面可能会起作用。

更多解释......没有什么特别聪明的，但想法是你没有`PredicateBuilder`创建实例的类。相反，您只有纯静态的构建块：

```
public static class Predicates
{
    public static Expression<Func<T, bool>> True<T>()
    {
        return x => true;
    }

    public static Expression<Func<T, bool>> False<T>()
    {
        return x => false;
    }

    public static Expression<Func<T, bool>> And<T>(
        this Expression<Func<T, bool>> left,
        Expression<Func<T, bool>> right)
    {
        return ... // returns equivalent of (left && right)
    }
} 
```

这两个函数扮演你的构造函数的角色，`True`你可能会有类似的原始比较等，然后运算符会让你将两个表达式连接在一起。`False``PredicateBuilder(bool)``And`

但是，您将失去使用操作符符号的能力，而您可以将其与包装对象一起使用，而您必须使用方法名称。我一直在玩同样的方法，而我总是回到的是我希望能够定义扩展运算符。C# 团队显然将这些用于 3.0（以及扩展属性），但它们的优先级较低，因为它们在 Linq 的总体目标中没有发挥作用。

# delphi - Office 2007 样式 UI 功能区：DevExpress 还是 TMS？

> ID：685160
> 
> 赞同：5
> 
> 时间：2009-03-26T10:13:12.310
> 
> 标签：delphi, user-interface, office-2007, ribbon

谁为这个特定组件提供了更好的解决方案？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-26T13:12:17.870

我们一直在使用两者。正如我所看到的，每个解决方案都有它的优点和缺点。

**开发快递**

1.  响应式（如快速）组件。
2.  遵守微软标准。
3.  干净的代码。
4.  很好的支持
5.  昂贵的。

**经颅磁刺激**

1.  不像 DevExpress 那样敏捷（快速）。
2.  看看代码，清理东西不会有什么坏处。
3.  很好的支持。
4.  便宜。

简而言之，TMS 在发布新组件方面总是非常快（他们在 DevExpress 发布之前几个月就有了功能区），但在我看来是以牺牲代码质量为代价的。
我们一直对这两个包裹感到满意。不过，对于我们最新的项目，我们正在切换到 DevExpress。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T10:44:11.783

我使用 DevExpress 效果很好 - 良好的支持、良好的主题、运行良好。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T10:38:27.897

你没有写关于你的delphi版本的东西。

在 delphi 2009 中集成了功能区控件。也许您应该升级到 d2009 以利用泛型和其他新的语言特性。

但是集成的功能区不如 tms/devExpress 组件强大。

在 DevExpress，您有 60 天退款保证。

tms便宜很多。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T04:42:44.343

我们正在使用 TMS 组件。

在我们寻找的时候（我最近没有检查过 DevExpress），他们是唯一支持功能区组的人（添加额外的功能区页面，其标题会出现在标题栏中）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T11:55:30.923

我也是 DevExpress 版本的快乐用户。他们的支持非常好，我会推荐他们。但我没有使用 TMS 的经验。他们的产品和支持可能一样好甚至更好:-)

* * *

## 回答 #6

> 赞同：-4
> 
> 时间：2009-03-27T05:03:02.003

Devexpress components are very intrusive, and make your .exe bigger than TMS does. Also, Devexpress are more complicated to use than TMS.

So I think that I would choose TMS without any doubt.

# nhibernate - 将 nHibernate 与 st_geometry 一起使用

> ID：685161
> 
> 赞同：1
> 
> 时间：2009-03-26T10:14:03.273
> 
> 标签：nhibernate, esri

有没有人知道将 nHibernate 与包含 ESRI 的 st_geometry 列的数据库表一起使用的方法？

这正确地阻止了我们在应用程序中使用 nHibernate。

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T10:20:59.047

对于 Nhibernate GIS 操作，请使用[NTS NetTopologySuite。](http://sourceforge.net/projects/nts)它有接口 IGeometry ， IPoint 等。

您可以使用这些库操作空间数据结构

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T10:29:23.737

您可以使用[NHibernate.Spatial](http://www.codeplex.com/NHibernateSpatial)来处理这些列。我成功地将 nHibernate.Spatial 与 SQL Server 2008 和几何/地理列一起使用。

nHibernate.Spatial 也使用 GeoAPI 和 NTS NetTopologySuite，正如 Cherian 在上一个答案中所述。

# hosting - 共享虚拟主机可以占用多少流量？

> ID：685162
> 
> 赞同：10
> 
> 时间：2009-03-26T10:14:13.930
> 
> 标签：hosting, web-hosting, shared-hosting

我有一个便宜的[Reliablesite.net](http://reliablesite.net)共享主机计划（每月 5 美元）。

我一直在制作一个小网站，我想在几周内开始推广，我打算通过使用我已经拥有的共享计划托管它来进行路试。

我的问题是我不知道我应该在什么时候转向集群托管/专用托管。

### 问题

*   共享托管计划可以处理哪些页面浏览量/天？
*   标准共享数据库服务器可以采取什么措施而不会阻塞或我从托管服务提供商处收到粗鲁的电子邮件？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-26T10:37:01.597

根据我的经验，像 Reliablesite.com 这样的共享托管环境每天可以吸引大约 10-20 000 个独立用户，或每天 100-200 000 次浏览量。该数字可能会有所不同，具体取决于您的站点。为了优化，重要的是减少数据库查询的数量（我保持每页渲染最多 6-7 个），并且在编程时要小心。使用 ASP.NET MVC 为我带来了不错的性能改进，但编写好的 webforms 应用程序也可以很好地执行。如果您使用的是其他技术堆栈，例如 PHP/MySQL，我不知道数字。
当您超过这些数字时，您将从 google adsense 获得足够的资金来使用 VPS 或专用计划。

只是添加一些关于页面渲染/数据库查询性能的内容：使用多个结果集存储过程或查询是减少数据库请求数量的好方法！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-26T10:25:11.593

流量通常不是共享主机的问题。您可能遇到的唯一问题是 RAM 和 CPU 限制。但是，如果您的应用程序编写正确，它可以在这些限制下正常运行。

提示：

*   用于调试和优化 Web 应用程序的用户内存分析器
*   使用 CDN 存储媒体文件

如果您需要一些数字，使用 CDN 存储媒体文件的正确编写的 Web 应用程序可以在共享主机上每天处理至少 10k 的唯一访问者。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T10:20:25.413

最好向您的提供者询问这些问题。每个提供商都会有所不同。

一般来说，提供者可以处理请求，但一旦达到某个阈值，他们就会简单地关闭您的站点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T10:24:48.863

它还取决于您选择的带宽量。您期望有多少流量。我的博客在共享主机中，曾经 4k 是我一天中的最大值，我感觉性能有任何差异。不要担心，除非您的网站出现在 digg 的首页或一些高流量网站链接到您的网站。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-22T21:50:57.677

我在共享主机上使用 mysql 已经有一段时间了，主要是在每天最多访问 300 次的信息网站上。我发现，主机几乎不能同时支持网站上超过 3 或 4 人，而不会几乎崩溃。

从理论上讲，如果您的用户一次都来一两个，我认为与大多数服务共享主机可以有效地支持大约每小时 60 个用户。这相当于一天内大约有 1500 个用户。然而，这是极不可能的，因为很多用户往往在一天中的某些时间在线，而且您还必须考虑到共享服务器由于服务器上其他人的滥用而变得马虎的事实。

我从可靠的消息来源听说，一些每月 40-50 美元的 vps 托管支持每月 500,000 次点击。我不确定网站配置是什么，我怀疑这些网站运行了许多动态数据库查询，或者可能只是静态的。

共享主机上常见的另一件事是将文件管理器与数据库主机分开。有时您的文件会很好地出现在网上，但运行您的实际网站的数据库会由于邻居的滥用而严重滞后。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-10T10:14:37.497

我建议确保您的应用程序已准备好应对大量流量，即使您使用的是超级网络服务器，但您的应用程序编写得不好，您也会失去潜在客户。可以对现有 Web 应用程序进行的一些最简单的优化是减少数据库连接的数量，因此请阅读缓存和部分缓存。

# javascript - 为什么我的 TinyMCE 隐藏文本区域出现问题？

> ID：685175
> 
> 赞同：9
> 
> 时间：2009-03-26T10:18:00.677
> 
> 标签：javascript, dom, tinymce, dhtml

我`textarea`在一个网页上大约有 7 个，它们都是使用 TinyMCE 的富文本编辑器。然而，在页面加载时，只有其中 1 个是可见的，其余的则隐藏起来。用户可以单击“显示”链接，该链接将一一显示剩余的文本区域。

但是，我有一个奇怪的问题。所有的`textarea`s 都是这样设置的：

```
<textarea cols="40" rows="20"></textarea> 
```

但是，只有`textarea`在页面加载时显示的是我想要的完整尺寸。当我展示它们时，剩余`textarea`的 s 真的很小。所以我在想也许它们没有被渲染，因为它们在页面加载时被隐藏了。

我该如何补救？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-26T11:08:10.103

尝试将一些 CSS 添加到隐藏的文本区域。

例如，使用

```
<textarea cols="40" rows="20" style="width: 40em; height: 20em"></textarea> 
```

我想我遇到了这个问题，TinyMCE 的 CSS 覆盖了一些默认的 CSS 行为。我最终不得不“重新覆盖”它，并最终编辑了 TinyMCE 的 css 页面。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-08-14T11:31:20.763

我认为这是一个 MCE 错误，或者至少是 MCE 缺乏的一个功能。

因为我想在 CSS 中设置输入框的样式，而不是在 HTML 中（糟糕），所以我尝试了

```
visibility: hidden; 
```

代替

```
display: none; 
```

一切都重新开始了。

我相信后者会导致元素不占用空间，这会导致检测元素宽度和高度的 MCE 代码出错。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-09-16T21:42:36.883

当使用 jQuery 加载 TinyMCE 时，这个问题可以这样解决：

1- 在您的文本区域中，在内联样式属性中指定高度：

```
<textarea style="height:200px;" class="tinymce" name="myfield"></textarea> 
```

2-在实例化 TinyMCE 编辑器时添加回调函数。例如**tinymceLoaded**

```
$('textarea.tinymce').tinymce({
    // Location of TinyMCE script
    script_url : 'PATH_TO_TINYMCE.js',

    // General options ...
    // Theme options...

    // callback function
    init_instance_callback : "tinymceLoaded"
}); 
```

3- 在 tinymceLoaded 函数中设置编辑器的高度：

```
function tinymceLoaded(inst){
    // get the desired height of the editor
    var height = $('#' + inst.editorId).height(); 

    // when the editor is hidden, the height calculated is 0
    // Lets use the inline style text to solve this problem
    if(height == 0){
        height = $('#' + inst.editorId).css('height'); // 200px
        height = height.replace(/[^0-9]/g, "");    // remove all non-numeric characters to isolate the '200'
    }

    // set the height of the hidden TinyMCE editor
    $('#' + inst.editorId + '_ifr').css({height: height + 'px'});
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T11:11:15.930

如果没有关于您的实际设置以及如何执行各种显示/隐藏功能的更多细节，很难给出明确的答案。不过，我可以提出一些一般性的想法：

*   当您不在页面加载时隐藏它们时它们是否正确呈现？这将为错误发生的时间点给出明确的答案。
*   当您切换文本区域的视图时，您可以同时明确设置行/列属性吗？
*   您可以使用 css（可能使用 !important）来设置 textarea 的宽度和高度，而不是测试它是否有效果吗？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-03-12T16:45:23.150

当我们将 div 置于可见时，从[TinyMCE 内部的隐藏 div 未显示为启用](https://stackoverflow.com/questions/826020/tinymce-inside-hidden-div-are-not-displayed-as-enabled-when-we-put-the-div-visib)，用户的[slolife](https://stackoverflow.com/users/698/slolife)回答帮助了我：

取消隐藏包含的 div 后尝试调用 tinyMCE.init(...)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-07-15T11:11:17.583

我遇到了同样的问题，即转换为 TinyMCE 编辑器的隐藏文本区域控件的高度太小。设置`visibility`为`none`工作，但在其位置留下了一个很大的空白空间。

以下解决方案对我来说效果很好：

*   不要在页面加载时隐藏你的 textarea 控件
*   相反，将所有 TinyMCE 的初始化配置设置如下：

```
tinyMCE.init({
        ...
        init_instance_callback ：“onInstanceInit”
});

```

*   在您的`onInstanceInit`函数中，动态隐藏初始化的 TinyMCE 编辑器
*   如果你之后显示这个编辑器，高度将再次正常，就像它从未隐藏过一样

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-02-20T19:51:13.593

如果您使用 TinyMCE 的生产版本，您可能忘记复制 tinymce.min.js 需要的文件夹。您需要在 tinymce.min.js 文件所在的文件夹中包含文件夹**langs** **、** plugins **、** skins**和**theme 。

 *** * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-11-20T11:39:06.277

隐藏的另一个原因是当您从 dom 中删除元素时初始化 tinymce。您需要先从该元素中删除 tinymce，这样您在初始化新的 tinymce 元素时会避免出现奇怪的行为。

例如：

`removeElementWithTinymce = function(elementToRemove){ var parent = elementToRemove.parentNode; tinymce.remove(elementToRemove.getAttribute('id')); parent.removeChild(elementToRemove); };`

就是这样。

# opengl - opengl旋转问题

> ID：685176
> 
> 赞同：1
> 
> 时间：2009-03-26T10:18:19.270
> 
> 标签：opengl, translation, rotation, axis

谁能告诉我如何让我的模型在自己的中心旋转而不是默认的（0,0,0）轴？

而且我的旋转似乎只是向左和向右而不是 360 度..

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-26T10:32:16.850

如果要围绕其中心旋转对象，首先必须将其平移到原点，然后旋转并将其平移回来。由于变换矩阵从右到左影响您的向量，因此您必须以相反的顺序对这些步骤进行编码。

这是一些伪代码，因为我不知道 OpenGL 例程：

```
PushMatrix();
LoadIdentity();  // Start with a fresh matrix
Translate();     // Move your object to its final destination
Rotate();        // Apply rotations
Draw();          // Draw your object using coordinates relative to the object center
PopMatrix(); 
```

这些矩阵得到应用：

```
v_t = (I * T * R) * v = (I * (T * (R * v))) 
```

所以顺序是：旋转，平移。

* * *

**编辑：**对上述等式的解释。

变换旋转、缩放和平移会影响*模型视图矩阵*。模型的每个 3D 点（向量）都乘以该矩阵以得到其在 3D 空间中的最终点，然后乘以*投影矩阵*以接收 2D 点（在 2D 屏幕上）。

忽略投影的东西，模型视图矩阵转换的点是：

```
v_t = MV * v 
```

意思是原点`v`，乘以模型视图矩阵`MV`。

在上面的代码中，我们`MV`由单位矩阵`I`、平移`T`和旋转构造`R`：

```
MV = I * T * R 
```

将所有内容放在一起，您会看到您的点`v`首先受到旋转的影响`R`，然后是平移`T`，因此您的点在平移之前先旋转，就像我们希望的那样：

```
v_t = MV * v = (I * T * R) * v = T * (R * v) 
```

在 Translate() 之前调用 Rotate() 将导致：

```
v_t = (I * R * T) * v = R * (T * v) 
```

这会很糟糕：翻译到 3D 中的某个点，然后围绕原点旋转，导致模型出现一些奇怪的失真。

# gettext - gettext 有什么好的介绍和资源吗？

> ID：685184
> 
> 赞同：1
> 
> 时间：2009-03-26T10:22:10.057
> 
> 标签：gettext

我正在研究翻译框架，并且一直在考虑 gettext。因为它据说相当不错，而且很多项目都在使用它。现在我阅读了官方手册的一部分，但它很烂。我有点知道它现在是如何工作的，但我不知道从哪里开始。

特别是我的项目跨越 C++、Lua 和 Javascript，所以我希望能够用一个工具来统一 i18n，但我也没有运气找到 gettext 对 Lua 或 Javascript 的良好支持，它们是否支持，有有人用这些gettext吗？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T10:26:41.590

这个[教程](http://oriya.sarovar.org/docs/gettext_single.html)怎么样？另一个[例子](http://www.onlamp.com/pub/a/php/2002/06/13/php.html)是在 O'Reilly。

# iphone - +40k 记录的 iphone sdk sqlite 查找性能

> ID：685185
> 
> 赞同：3
> 
> 时间：2009-03-26T10:22:52.987
> 
> 标签：iphone, database, performance, sqlite

完成这件事的最佳方法是什么：

我在 sqlite 中有一个包含 +40k 记录（电视节目标题）的巨大表，我想对这个表进行实时查找。例如，如果用户搜索节目，当用户输入搜索词时，我会在每次击键后阅读 sqlite 并过滤记录（如谷歌搜索建议）。

我的性能基准是 100 毫秒。我想到的一些事情是：创建索引，将数据拆分为多个表。

但是，我真的很感谢任何建议在尽可能快的时间内实现这一点，这样我就可以避免任何 ui 刷新延迟 - 从已经做过类似事情的编码人员那里获得反馈真是太棒了。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T19:41:43.473

要做的事情：

1.  适当地索引字段。
2.  在初始查询中将自己限制为仅 10-15 条记录——这应该足以填充表视图的顶部。
3.  如果您不需要排序，请不要。如果确实需要排序，请对索引字段进行排序。
4.  在 SQLite 中做尽可能多的事情，而不是你自己的代码。
5.  整体上尽量少做。

你可能会发现我所拥有的：只要你不做任何愚蠢的事情，SQLite 和 iPhone 实际上就具有惊人的能力。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T11:12:15.007

牢记“感知性能”——在按下键后立即进行查找可能会有些昂贵。但是，用户按下一个键需要多少毫秒？在用户在几百毫秒内没有输入任何内容之前，您可能不会更新结果列表。（对于真正快速的用户，也许在他还在打字的时候每 X 百毫秒更新一次）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T01:32:21.087

How do you know the performance will be bad? 40k rows is not that much, even for an iPhone... try it on the phone before you optimize.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T10:38:18.957

避免进行任何连接，尝试使用分页，以便将返回的数据量保持在最低限度。也许您应该尝试将整个内容加载到内存中，然后排序并进行二进制搜索？如果它只是一个节目标题列表，它会适合吗？

# asp.net-mvc - ASP.NET MVC 视图 - 显示基于授权的内容

> ID：685186
> 
> 赞同：2
> 
> 时间：2009-03-26T10:22:56.280
> 
> 标签：asp.net-mvc

对不起，如果你发现我在问愚蠢的问题。但我是 asp.net 的新手，我遇到了一个问题：

我正在写一个简单的博客来学习asp.mvc，如果用户登录，我想在博客标题旁边显示一个编辑链接。目前我必须将currentUser对象添加到Model并检查IsLogged属性来决定我是否应该显示编辑链接。问题是如果没有登录用户，我必须创建一个假的 currentUser 插入到其他模型中以使其工作。要问的是还有其他优雅的方法可以做到这一点。例如，我们可以在 Controller 中使用 [Authorize] 属性来允许或不允许访问 Action。有没有类似的申请View的方式？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T11:07:49.650

如果您使用 Forms 身份验证，则此属性已存在于**Request**对象中：

**Request.IsAuthenticated**

在您看来，您可以通过以下方式解决您的问题：

```
<%  if(this.Request.IsAuthenticated)
    {
%>
    <%= Html.ActionLink("Edit", url - to - action) %>
<%  }
%> 
```

但我认为你真正的问题是检查当前用户是否可以编辑当前博客。在这种情况下，您可以对**ViewPage**对象执行扩展方法**CanEdit**：

 **```
<%  if(this.CanEdit(this.User))
    {
%>
    <%= Html.ActionLink("Edit", url - to - action) %>
<%  }
%> 
```

扩展看起来像这样：

```
public static class ViewExtensions
{
    public static bool CanEdit(ViewPage view, MyUser user)
    {
        bool retour = false;

        if(principal != null)
        {
            // get your blog from the view
            Blog blog = view.ViewData["myBlog"];
            // check if the principal is the owner
            retour = (blog.Owner.Id == user.Id);
        }
        return retour;
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T10:30:58.820

使*模型*本身`IsLoggedIn`的布尔属性。这样，您可以拥有equal to when is 。您的视图会检查并且永远不会调用任何内容，如果它是. 这样一来，就绕过去了。*`CurrentUser``null``IsLoggedIn``false``IsLoggedIn``CurrentUser``false``NullReferenceException`*

 *您也可以完全丢弃该`IsLoggedIn`属性并检查用户是否直接使用`CurrentUser != null`.

# asp.net-mvc - 一个字，这样做的 ASP.NET (MVC) 路由崩溃

> ID：685193
> 
> 赞同：4
> 
> 时间：2009-03-26T10:23:48.367
> 
> 标签：asp.net-mvc, asp.net-routing

我读到了一个字符串/单词，它导致路由崩溃，但我不记得它是哪个单词/字符串组合。

例子：

> [Microsoft Logging 应用程序块和多线程](https://stackoverflow.com/questions/685039/microsoft-logging-application-block-and-multi-threading)- 有效
> 
> [Microsoft Logging 应用程序块和多线程](https://stackoverflow.com/questions/685039/hello)- 有效
> 
> [Microsoft Logging 应用程序块和多线程](https://stackoverflow.com/questions/685039/random-random-hello)- 有效
> 
> [Microsoft Logging 应用程序块和多线程](https://stackoverflow.com/questions/685039/banana)- 崩溃！

不，这不是香蕉，而是一个单词/字符串，因此路由在使用路由系统的每个应用程序中都崩溃了。

我想我记得这是一个已知问题，但我不记得在哪里可以找到它。也许我在stackoverflow上的评论中读到了它。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T11:06:43.303

除了 TFD 的回答（“con”）之外，它看起来几乎是任何 MSDOS 保留设备名称（在 MSDN 上的[基本命名约定下列出）。](http://msdn.microsoft.com/en-us/library/aa365247.aspx)

我得到一个 HTTP 404 而不是一个错误 =)

基本上是以下摘录中的列表：

> 不要使用以下保留的设备名称作为文件名：
> 
> > CON、PRN、AUX、NUL、COM1、COM2、COM3、COM4、COM5、COM6、COM7、COM8、COM9、LPT1、LPT2、LPT3、LPT4、LPT5、LPT6、LPT7、LPT8 和 LPT9

* * *

## 回答 #2

> 赞同：-4
> 
> 时间：2009-03-26T10:45:56.270

我不知道，但这听起来像雪崩，如果你只是在电脑屏幕上看到病毒的图像，你就会发现它，然后你就完蛋了。我认为能够在元宇宙中四处进行剑战会很酷，所以也许值得冒险。

# winforms - 关闭 AxWindowsMediaPlayer 的表单时出现 AccessViolation 异常

> ID：685199
> 
> 赞同：3
> 
> 时间：2009-03-26T10:28:21.663
> 
> 标签：winforms, .net-3.5, activex, windows-media-player, wmp

我有`AxWMPLib.AxWindowsMediaPlayer`一个表格。当我关闭表单时，我得到“试图读取或写入受保护的内存。这通常表明其他内存已损坏。” 例外。可以隐藏表单，但不能关闭。当组件从表单中删除时，一切都很好。

这是 Winforms .Net3.5。

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-05-26T20:42:32.757

这发生在我身上，它是在按键期间关闭表单时发生的。

如果 WMP 控件有要处理的关键事件，似乎 WMP 控件会导致问题。

Form.KeyPreview = True 的示例

```
Sub Form_KeyDown(e As KeyEventArgs)
 AxWindowsMediaPlayer1.Dispose()
End Sub 
```

导致访问冲突。

```
Sub Form_KeyDown(e As KeyEventArgs)
 e.Handled = True
 AxWindowsMediaPlayer1.Dispose()
End Sub 
```

干净利落地关闭，因为按键被阻止到达 WMP 控件。

当表单关闭时会发生同样的事情，因为将处置控件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-09-09T23:11:21.083

有时在 .NET 应用程序中使用 ActiveX 对象时，有必要在退出时强制进行垃圾回收。我通常在 Form_Closing 中使用：

```
GC.WaitForPendingFinalizers()
GC.Collect() 
```

此外，如果您为对象设置了任何事件处理程序，您将需要显式断开它们。我在很多情况下发现 ActiveX 对象在垃圾箱中仍然保持活动状态，并且即使在它们被释放后也会尝试调用事件处理程序。

在尝试处理对象之前确保播放已停止也可能是值得的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T10:32:20.873

当父窗体关闭时，ActiveX 对象可能对以正确的顺序关闭有一些敏感的依赖关系，否则它们可能会继续存在直到 gc 运行 - 尝试通过接口查找控件以查找它们可能必须执行的任何方法关闭或销毁对象并调用它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-01-14T09:55:35.700

我想我有它：

```
private void Form1_FormClosing(object sender, FormClosingEventArgs e)
{
    axWindowsMediaPlayer1.close();
} 
```

只是在文档[http://msdn.microsoft.com/en-us/library/windows/desktop/dd562388(v=vs.85).aspx](http://msdn.microsoft.com/en-us/library/windows/desktop/dd562388(v=vs.85).aspx)上找到了该方法， 我想我会试一试。现在似乎好多了。

# sqlite - 如何获取列名列表

> ID：685206
> 
> 赞同：62
> 
> 时间：2009-03-26T10:30:20.270
> 
> 标签：sqlite

是否可以像这样获得包含表的所有列名的行？

```
|id|foo|bar|age|street|address| 
```

我不喜欢用`Pragma table_info(bla)`。

* * *

## 回答 #1

> 赞同：95
> 
> 时间：2009-03-26T10:32:29.253

```
SELECT sql FROM sqlite_master
WHERE tbl_name = 'table_name' AND type = 'table' 
```

然后用 Reg Exp 解析这个值（这很容易），它看起来类似于：`[(.*?)]`

或者，您可以使用：

```
PRAGMA table_info(table_name) 
```

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2015-01-26T14:50:08.347

如果您使用 SQLite 的命令行 shell，那么`.headers on`在执行查询之前。您只需在给定会话中执行一次。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2018-10-31T11:19:08.100

是的，您可以使用以下命令实现此目的：

```
sqlite> .headers on
sqlite> .mode column 
```

在您的表上选择的结果将如下所示：

```
id          foo         bar         age         street      address
----------  ----------  ----------  ----------  ----------  ----------
1           val1        val2        val3        val4        val5
2           val6        val7        val8        val9        val10 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2019-08-26T12:40:42.787

您可以在 sqlite 中使用 pragma 相关的命令，如下所示

```
pragma table_info("table_name")
--Alternatively
select * from pragma_table_info("table_name") 
```

如果您需要类似的列名`id|foo|bar|age|street|address`，基本上您的答案在下面的查询中。

```
select group_concat(name,'|') from pragma_table_info("table_name") 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2011-12-08T12:03:03.053

这有助于 HTML5 SQLite：

```
tx.executeSql('SELECT name, sql FROM sqlite_master WHERE type="table" AND name = "your_table_name";', [], function (tx, results) {
  var columnParts = results.rows.item(0).sql.replace(/^[^\(]+\(([^\)]+)\)/g, '$1').split(','); ///// RegEx
  var columnNames = [];
  for(i in columnParts) {
    if(typeof columnParts[i] === 'string')
      columnNames.push(columnParts[i].split(" ")[0]);
  }
  console.log(columnNames);
  ///// Your code which uses the columnNames;
}); 
```

您可以在您的语言中重用正则表达式来获取列名。

较短的替代方案：

```
tx.executeSql('SELECT name, sql FROM sqlite_master WHERE type="table" AND name = "your_table_name";', [], function (tx, results) {
  var columnNames = results.rows.item(0).sql.replace(/^[^\(]+\(([^\)]+)\)/g, '$1').replace(/ [^,]+/g, '').split(',');
  console.log(columnNames);
  ///// Your code which uses the columnNames;
}); 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2019-02-01T13:40:02.180

使用递归查询。给定

```
create table t (a int, b int, c int); 
```

跑：

```
with recursive
  a (cid, name) as (select cid, name from pragma_table_info('t')),
  b (cid, name) as (
    select cid, '|' || name || '|' from a where cid = 0
    union all
    select a.cid, b.name || a.name || '|' from a join b on a.cid = b.cid + 1
  )
select name
from b
order by cid desc
limit 1; 
```

或者，只需使用`group_concat`：

```
select '|' || group_concat(name, '|') || '|' from pragma_table_info('t') 
```

两者都产生：

```
|a|b|c| 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-06-25T12:34:06.947

PHP 中的查询结果集提供了几个函数来实现：

```
 numCols() 
    columnName(int $column_number ) 
```

例子

```
 $db = new SQLIte3('mysqlite.db');
    $table = 'mytable';

    $tableCol = getColName($db, $table);

    for ($i=0; $i<count($tableCol); $i++){
        echo "Column $i = ".$tableCol[$i]."\n";
    }           

    function getColName($db, $table){
        $qry = "SELECT * FROM $table LIMIT 1";
        $result = $db->query($qry);
        $nCols = $result->numCols();
        for ($i = 0; $i < $ncols; $i++) {
            $colName[$i] = $result->columnName($i);
        }
        return $colName;
    } 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-11-09T21:03:41.460

使用@Tarkus 的回答，这是我在 R 中使用的正则表达式：

```
getColNames <- function(conn, tableName) {
    x <- dbGetQuery( conn, paste0("SELECT sql FROM sqlite_master WHERE tbl_name = '",tableName,"' AND type = 'table'") )[1,1]
    x <- str_split(x,"\\n")[[1]][-1]
    x <- sub("[()]","",x)
    res <- gsub( '"',"",str_extract( x[1], '".+"' ) )
    x <- x[-1]
    x <- x[-length(x)]
    res <- c( res, gsub( "\\t", "", str_extract( x, "\\t[0-9a-zA-Z_]+" ) ) )
    res
} 
```

代码有些草率，但似乎可以工作。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-10-10T15:27:13.533

```
$<?
$db = sqlite_open('mysqlitedb');
$cols = sqlite_fetch_column_types('form name'$db, SQLITE_ASSOC);
foreach ($cols as $column => $type) {
  echo "Column: $column  Type: $type\n";
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-05-13T11:23:53.527

试试这个 sqlite 表模式解析器，我实现了 sqlite 表解析器来解析 PHP 中的表定义。

它返回完整的定义（唯一、主键、类型、精度、非空、引用、表约束......等）

[https://github.com/maghead/sqlite-parser](https://github.com/maghead/sqlite-parser)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-10-27T18:22:04.993

获取最近执行的 SELECT 的列名的最简单方法是使用游标的`description`属性。一个 Python 示例：

```
print_me = "("
for description in cursor.description:
    print_me += description[0] + ", "
print(print_me[0:-2] + ')')
# Example output: (inp, output, reason, cond_cnt, loop_likely) 
```

# ruby-on-rails - Rails: Nested namespaced resource route

> ID：685213
> 
> 赞同：4
> 
> 时间：2009-03-26T10:32:38.487
> 
> 标签：ruby-on-rails, routing

```
map.resources :users
map.namespace :formulator do |formulator|
    formulator.resources :submissions
end 
```

I want to have submissions be a nested resource of users, but I'm not sure how to since it's namespaced.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T21:13:45.920

Have you tried anything like:

```
 map.resources :users
 map.namespace :formulator do |formulator|
   formulator.resources :submissions
   map.resources :users, :has_many => :submissions
 end 
```

or this

```
 map.resources :users
 map.namespace :formulator do |formulator|
   formulator.resources :submissions
 end
 map.resources :users, :has_many => :submissions 
```

If not, try running `rake routes` afterwards to see what it routes are generated.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T21:30:11.873

You should be able to do this:

```
map.resources :users, :has_many => :submissions 
```

Which will give you routes like this:

```
 users GET    /users(.:format)                               {:action=>"index", :controller=>"users"}
                     POST   /users(.:format)                               {:action=>"create", :controller=>"users"}
            new_user GET    /users/new(.:format)                           {:action=>"new", :controller=>"users"}
           edit_user GET    /users/:id/edit(.:format)                      {:action=>"edit", :controller=>"users"}
                user GET    /users/:id(.:format)                           {:action=>"show", :controller=>"users"}
                     PUT    /users/:id(.:format)                           {:action=>"update", :controller=>"users"}
                     DELETE /users/:id(.:format)                           {:action=>"destroy", :controller=>"users"}
    user_submissions GET    /users/:user_id/submissions(.:format)          {:action=>"index", :controller=>"submissions"}
                     POST   /users/:user_id/submissions(.:format)          {:action=>"create", :controller=>"submissions"}
 new_user_submission GET    /users/:user_id/submissions/new(.:format)      {:action=>"new", :controller=>"submissions"}
edit_user_submission GET    /users/:user_id/submissions/:id/edit(.:format) {:action=>"edit", :controller=>"submissions"}
     user_submission GET    /users/:user_id/submissions/:id(.:format)      {:action=>"show", :controller=>"submissions"}
                     PUT    /users/:user_id/submissions/:id(.:format)      {:action=>"update", :controller=>"submissions"}
                     DELETE /users/:user_id/submissions/:id(.:format)      {:action=>"destroy", :controller=>"submissions"} 
```

# asp.net-mvc - Rhino UnitOfWorkApplication + Castle 自动事务管理应用程序不会在请求结束时自动刷新

> ID：685218
> 
> 赞同：1
> 
> 时间：2009-03-26T10:34:01.247
> 
> 标签：asp.net-mvc, nhibernate, flush, rhino-commons, unitofworkapplication

我正在构建基于 UnitOfWorkApplication 的 ASP.Net MVC 应用程序，并且我想使用 Castle ATM 设施。目前我在请求结束时刷新会话有问题。我的服务类（在我的控制器操作方法中调用）如下所示：

```
[Transactional]
public class UserAdminService : IUserAdminService
{

    [Transaction(TransactionMode.Requires)]
    public User CreateNewUser(string username, string password, string firstName, string lastName)
    {
        var u = new User(username)
                    {
                        PasswordHash = GetPasswordHash(password),
                        FirstName = firstName,
                        LastName = lastName
                    };
        userRepo.Save(u);
        //UnitOfWork.CurrentSession.Flush();
        return u;
    } 
```

当我取消注释“UnitOfWork.CurrentSession.Flush();” 行一切正常 - 新用户保留在数据库中。但是，如果我不明确刷新会话，则不会保留任何内容。

UnitOfWorkApplication + ATM 应该在请求结束时刷新更改 AFAIK - 对吗？有没有人建议我应该在没有明确 session.Flush() 调用的情况下尝试使其工作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T11:31:16.553

我刚刚注册了 RhinoTransactionFacility 而不是原来的 Castle ATM 设施 + DefaultTransactionManager 并且一切都开始工作了。

# python - pygtk 应用程序中的单独线程

> ID：685224
> 
> 赞同：4
> 
> 时间：2009-03-26T10:36:01.927
> 
> 标签：python, multithreading, pygtk

我在线程化我的 pyGTK 应用程序时遇到了一些问题。我给线程一些时间来完成它的任务，如果有问题我只是继续但警告用户。但是，一旦我继续，这个线程就会停止，直到 gtk.main_quit 被调用。这让我很困惑。

相关代码：

```
class MTP_Connection(threading.Thread):
    def __init__(self, HOME_DIR, username):
        self.filename = HOME_DIR + "mtp-dump_" + username
        threading.Thread.__init__(self)

    def run(self):
        #test run
        for i in range(1, 10):
            time.sleep(1)
            print i 
```

…………………………………………………………………………………………

```
start_time = time.time()
conn = MTP_Connection(self.HOME_DIR, self.username)
conn.start()
progress_bar = ProgressBar(self.tree.get_widget("progressbar"),
                           update_speed=100, pulse_mode=True)
while conn.isAlive():
    while gtk.events_pending():
        gtk.main_iteration()
    if time.time() - start_time > 5:
        self.write_info("problems closing connection.")
        break
#after this the program continues normally, but my conn thread stops 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-26T14:31:59.863

首先，不要子类化`threading.Thread`，使用`Thread(target=callable).start()`.

其次，您明显阻塞的原因可能是它`gtk.main_iteration`接受了一个参数`block`，默认为，因此当没有要迭代的事件时`True`，您的调用实际上会阻塞。`gtk.main_iteration`可以通过以下方式解决：

```
gtk.main_iteration(block=False) 
```

但是，没有真正的解释为什么你会使用这个被破解的循环而不是实际的 gtk 主循环。如果您已经在主循环中运行它，那么我建议您做错事。如果您给我们更多细节和/或完整示例，我可以扩展您的选择。

第三，这只是后来才出现的：始终始终*始终* ***确保***您已调用`gtk.gdk.threads_init`任何带有线程的 pygtk 应用程序。GTK+ 在运行线程时有不同的代码路径，它需要知道使用这些。

我写[了一篇关于 pygtk 和线程的小文章，](http://unpythonic.blogspot.com/2007/08/using-threads-in-pygtk.html)它为您提供了一个小的抽象，因此您永远不必担心这些事情。该帖子还包括一个进度条示例。

# visual-studio - Visual Studio C++ 中的最佳实践

> ID：685228
> 
> 赞同：2
> 
> 时间：2009-03-26T10:38:22.950
> 
> 标签：visual-studio, visual-c++

Visual Studio 似乎想将类构造器代码和事件处理代码放在 .h 文件中。我只参与过小型 1 人项目，想知道一般行业标准是什么。

对于 Visual C++ 应用程序项目，将在 .h 文件中放入什么代码？我习惯了在 .h 文件中声明你的类并在 .cpp 文件中编码的模式经典 C++ 方式。这仍然适用于 Visual Studio 应用程序吗？

我有很强的 C 背景，这可以解释我对此的偏好。VSC++ 编译器似乎并不介意。

简而言之：应该将什么放入哪种类型的文件中？

TIA 结束

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T10:42:23.860

如果您正在使用 MFC 并且正在讨论生成的代码，那么最好不要理会它。

如果您正在尝试进行“正常”C++ 开发，请在标题中尽可能少地放置，因为这意味着客户端代码不依赖于太多的实现细节。您可以逃脱的事情在一定程度上取决于模板的使用，以及您的性能预算可以支持多少间接性。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T10:43:22.597

没有被广泛接受的行业标准。通过将（短）函数定义放在头文件中，您可以让编译器有更好的机会内联代码。好处是它可以使代码运行得更快（尽管这些函数要简短）。但是，这样做的代价是向包含该标头的客户端公开更多代码，使您（或您的同事）在更改实现时重新编译更多文件。

您还必须考虑反对您的工具的成本。由于 VC++ 的向导坚持将函数放在标题中，因此如果您不同意，则必须每次都移动它们。

我会说，这确实是特定于项目的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T10:40:51.230

> 对于 Visual C++ 应用程序项目，将在 .h 文件中放入什么代码？我习惯了在 .h 文件中声明你的类并在 .cpp 文件中编码的模式经典 C++ 方式。这仍然适用于 Visual Studio 应用程序吗？

短：是 长：取决于人或语言。在 c++ 中，标头用于声明，cpp 用于编码。对于 C#，您有一个文件（或者如果您使用接口，则为 2 个）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T10:53:10.637

这可能看起来微不足道，但请记住：标头在几个地方被#included。（包括头文件在内的头文件使事情变得更加复杂。）任何时候你改变一个头文件，很多文件都会被再次编译。在头文件中保留尽可能少的频繁更改代码可以减少依赖文件的重新编译。

另一件事：一个整洁的头文件让您快速了解类/表单必须提供的内容。

# ant - 如何将 ant 路径（使用 refId=.. 访问）“扩展”到路径中除某些文件之外的所有文件？

> ID：685237
> 
> 赞同：3
> 
> 时间：2009-03-26T10:41:18.777
> 
> 标签：ant

我正在尝试让 ant4eclipse 工作，并且我已经使用了一点 ant，但在简单的脚本语言之上并没有太多。我们的 Eclipse 项目中有多个源文件夹，因此 ant4eclipse 文档中的示例需要修改：

目前我有以下内容：

```
<target name="build">

  <!-- resolve the eclipse output location -->
  <getOutputpath property="classes.dir" workspace="${workspace}" projectName="${project.name}" />

  <!-- init output location -->
  <delete dir="${classes.dir}" />
  <mkdir dir="${classes.dir}" />

  <!-- resolve the eclipse source location -->
  <getSourcepath pathId="source.path" project="." allowMultipleFolders='true'/>

  <!-- read the eclipse classpath -->
  <getEclipseClasspath pathId="build.classpath" 
                          workspace="${workspace}" projectName="${project.name}" />

  <!-- compile -->
  <javac destdir="${classes.dir}" classpathref="build.classpath" verbose="false" encoding="iso-8859-1">
    <src refid="source.path" />
    </javac>

  <!-- copy resources from src to bin -->
  <copy todir="${classes.dir}" preservelastmodified="true">
    <fileset refid="source.path">
        <include name="**/*"/>
        <!--
        patternset refid="not.java.files"/>
        -->
    </fileset>
  </copy>
</target> 
```

该任务成功运行，但我无法正常工作 - 它也应该复制所有非 java 文件以模拟 eclipse 的行为。

所以，我有一个名为 source.path 的 pathId ，它包含多个目录，我需要以某种方式将其按摩到复制任务之类的东西中。我尝试过无效的嵌套，以及其他一些疯狂的猜测。

我该怎么做 - 在此先感谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-10-03T21:31:41.390

您可能会考虑使用[`pathconvert`](http://ant.apache.org/manual/Tasks/pathconvert.html)来构建`fileset includes`可以使用的模式。

```
<pathconvert pathsep="/**/*," refid="source.path" property="my_fileset_pattern">
    <filtermapper>
        <replacestring from="${basedir}/" to="" />
    </filtermapper>
</pathconvert> 
```

这将填充`${my_fileset_pattern}`一个字符串，如：

```
1/**/*,2/**/*,3 
```

if`source.path`由 basedir 下的三个目录 1、2 和 3 组成。我们使用`pathsep`插入通配符，稍后将扩展到完整的文件集。

该属性现在可用于生成所有文件的文件集。请注意，需要一个额外的尾随`/**/*`来展开集合中的最后一个目录。此时可以应用排除。

```
<fileset dir="." id="my_fileset" includes="${my_fileset_pattern}/**/*">
    <exclude name="**/*.java" />
</fileset> 
```

然后所有非 java 文件的副本变为：

```
<copy todir="${classes.dir}" preservelastmodified="true">
    <fileset refid="my_fileset" />
</copy> 
```

这将复制源文件而不是保留`todir`. 如果需要，`flatten`可以将复制任务的属性设置为将所有源文件直接复制到`todir`.

请注意，此处的 pathconvert 示例适用于 unix 文件系统，而不是 windows。如果需要一些可移植的东西，那么`file.separator`应该使用该属性来构建模式：

```
<property name="wildcard" value="${file.separator}**${file.separator}*" />
<pathconvert pathsep="${wildcard}," refid="source.path" property="my_fileset">
... 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T12:22:33.700

您可以使用[ant-contrib](http://ant-contrib.sourceforge.net)库中的[`foreach`](http://ant-contrib.sourceforge.net/tasks/tasks/foreach.html)任务：

```
<target name="build">
    ...

    <!-- copy resources from src to bin -->
    <foreach target="copy.resources" param="resource.dir">
        <path refid="source.path"/>
    </foreach>
</target>

<target name="copy.resources">
    <copy todir="${classes.dir}" preservelastmodified="true">
        <fileset dir="${resource.dir}" exclude="**/*.java">
    </copy>
</target> 
```

如果您`source.path`也包含文件路径，那么您可以执行[`if`](http://ant-contrib.sourceforge.net/tasks/tasks/if.html)任务（也来自 ant-contrib）以防止尝试复制文件路径的文件，例如

```
<target name="copy.resources">
    <if>
        <available file="${classes.dir}" type="dir"/>
        <then>
            <copy todir="${classes.dir}" preservelastmodified="true">
                <fileset dir="${resource.dir}" exclude="**/*.java">
            </copy>
        </then>
    </if>
</target> 
```

# python - Python中的层次结构/享元/实例化问题

> ID：685253
> 
> 赞同：0
> 
> 时间：2009-03-26T10:45:11.327
> 
> 标签：python, design-patterns

这是我要解决的问题，（我已经简化了实际问题，但这应该为您提供所有相关信息）。我有这样的层次结构：

```
1.A
1.B
1.C
2.A
3.D
4.B
5.F 
```

（这很难说明——每个数字都是父级，每个字母都是子级）。

1.  创建“字母”对象的实例是昂贵的（IO、数据库成本等），所以应该只做一次。

2.  层次结构需要易于导航。

3.  层次结构中的子级只需要一个父级。

4.  应该可以直接从层次结构中的对象修改字母对象的内容。

5.  需要有一个包含所有“字母”对象（并且仅包含层次结构中的那些）的中央存储。

6.  'letter' 和 'number' 对象需要可以从构造函数创建（例如 Letter(**kwargs) ）。

7.  当一个字母从层次结构中更改时，所有其他字母都将遵循相同的更改，这是完全可以接受的。

希望这不是太抽象来说明问题。

解决这个问题的最佳方法是什么？（然后我会发布我的解决方案）

这是一个示例脚本：

```
one = Number('one')
a = Letter('a')
one.addChild(a)
two = Number('two')
a = Letter('a')
two.addChild(a)

for child in one:
    child.method1()
for child in two:
    print '%s' % child.method2() 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T11:34:52.050

一种基本方法将使用内置数据类型。如果我明白了，该`Letter`对象应该由具有`dict`缓存的工厂创建，以保留以前生成的`Letter`对象。工厂将为`Letter`每个键创建一个对象。

对象可以是包含对象的`Number`子类`list`，`Letter`因此`append()`可用于添加子类。A`list`易于导航。

缓存工厂的粗略轮廓：

```
>>> class Letters(object):
...     def __init__(self):
...         self.cache = {}
...     def create(self, v):
...         l = self.cache.get(v, None)
...         if l:
...             return l
...         l = self.cache[v] = Letter(v)
...         return l
>>> factory=Letters()
>>> factory.cache
{}
>>> factory.create('a')
<__main__.Letter object at 0x00EF2950>
>>> factory.create('a')
<__main__.Letter object at 0x00EF2950>
>>> 
```

为了满足要求 6（构造函数），这里有一个更人为的例子，使用`__new__`, 缓存构造函数。这类似于[配方 413717：缓存对象创建](http://code.activestate.com/recipes/413717/)。

```
class Letter(object):
    cache = {}

    def __new__(cls, v):
        o = cls.cache.get(v, None)
        if o:
            return o
        else:
            o = cls.cache[v] = object.__new__(cls)
            return o

    def __init__(self, v):
        self.v = v
        self.refcount = 0

    def addAsChild(self, chain):
        if self.refcount > 0:
            return False
        self.refcount += 1
        chain.append(self)
        return True 
```

测试缓存功能

```
>>> l1 = Letter('a')
>>> l2 = Letter('a')
>>> l1 is l2
True
>>> 
```

为了强制执行单亲，您需要一个`Letter`对象（不是`Number`）的方法 - 带有一个引用计数器。当调用执行加法时，如果计数器大于零，它将拒绝加法。

```
l1.addAsChild(num4) 
```

# asp.net - 使用类库从 web.config/app.config 获取配置设置

> ID：685259
> 
> 赞同：14
> 
> 时间：2009-03-26T10:48:09.743
> 
> 标签：asp.net, vb.net, .net-3.5

3.5 中的配置设置让我抓狂......救命！;)

我有一个类库（名为 ADI），它需要使用它的项目中的一些配置设置（如连接字符串、文件系统位置等）。

我想在我的 Windows 窗体/Web 项目 App.Config 或 Web.Config 中定义这些设置，就像其他设置一样。

这是我的 Windows 窗体应用程序的 app.config 的一部分：

```
<applicationSettings>
    <PhotoImportRobot.My.MySettings>
      <setting name="ADIImageRoot" serializeAs="String">
        <value>C:\DataTemp\ADI\Original\</value>
      </setting>
      <setting name="ADIImageVariantsRoot" serializeAs="String">
        <value>C:\DataTemp\ADI\Variants\</value>
      </setting>
    </PhotoImportRobot.My.MySettings>
</applicationSettings> 
```

我如何从我的类库中访问它？

我试过这个：

```
System.Configuration.ConfigurationManager.AppSettings("ADIImageVariantsRoot") 
```

该怎么办？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-26T11:05:08.423

如果您不关注结构化设置，则 appSettings 部分仅采用键值对：

```
<appSettings>
  <add key="ADIImageRoot" value="C:\DataTemp\ADI\Original\" />
  <add key="ADIImageVariantsRoot" value="C:\DataTemp\ADI\Variants\" />
</appSettings> 
```

这将使您能够通过 AppSettings 字典访问它们：

```
ConfigurationManager.AppSettings["ADIImageVariantsRoot"] 
```

如你所料。

或者，如果您需要更多的配置结构（即不仅仅是字符串或设置集合），您可以考虑使用自己的配置部分，使用[ConfigurationSection](http://msdn.microsoft.com/en-us/library/system.configuration.configurationsection.aspx)及其相关部分。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T11:07:25.830

您似乎正在使用 Visual Studio 中内置的设置内容。这会生成一个与文件相关的包装类，在您的情况下称为`MySettings`.

因此，您可以编写类似`MySettings.Instance.ADIImageVariantsRoot`. （如果您单击项目工具箱中的显示所有文件，它将显示 .settings.cs 文件，您可以看到所有血腥细节）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-01-11T12:52:08.787

添加引用`System.web;` 添加名称空间和用户

```
using System.Web.Configuration;    

String webConfigValue;
            webConfigValue = WebConfigurationManager.AppSettings["employeeDB"].ToString(); 
```

读取网络配置值

```
<appSettings>
        <add key="employeeDB" value="Data Source=servername;Initial Catalog=employee;Persist Security Info=True;User ID=userid;Password=password;"/>        
</appSettings> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-02-11T00:12:34.587

对于 ApplicationSettings，您应该使用：

```
[YourNamespace].Properties.Settings.Default.[YourSettingName] 
```

这提供了对您的设置的强类型引用，如果 web.config 文件中未定义默认值，则返回默认值。对于 AppSettings，您应该使用：

```
System.Web.Configuration.WebConfigurationManager.AppSettings 
```

# eclipse - 在 Eclipse 中是否有 ctrl-click 到资源包？

> ID：685262
> 
> 赞同：2
> 
> 时间：2009-03-26T10:48:32.677
> 
> 标签：eclipse, eclipse-plugin

如果我在 Eclipse 中打开了 Java 源文件，我希望能够单击资源包键以打开相关行中的资源包进行编辑。例如，如果我有一个捆绑`Bundle_en.properties`：

```
key1=Value One
key2=Value Two 
```

和一个源文件：

```
ResourceBundle bundle = ResourceBundle.getBundle("Bundle", Locale.ENGLISH);
String value = bundle.getString("key1"); 
```

我希望能够`"key1"`在源文件中按住 ctrl 单击它并打开属性文件并突出显示 key1。在现实世界的场景中，我将有十几个属性文件，每个属性文件包含从 20 个不同类访问的数百个键。任何指针表示赞赏。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-07T07:51:51.233

我很惊讶你不能***按 CTRL+单击***变量。

我在 Eclipse *3.4.1中对此进行了测试*

1）创建一个包含：

```
private static final String FOO = "bar"; 
```

2）右键单击 FOO 并选择 Source -> Externalize Strings

3) 选择默认值，您将得到一个messages.properties 文件和一个Messages 类，其中包含将FOO 链接到messages.properties 中的值的ResourceBundle 引用代码。

创建 FOO 后将如下所示：

```
static final String FOO=Messages.getString("Utils.0"); //$NON-NLS-1$ 
```

当我***CTRL+单击***“Utils.0”时，它会将我直接带到资源包中的属性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T11:26:03.320

我不确定 Eclipse 是否*直接*提供此功能。

**[但是，您应该能够使用像Babel](http://www.eclipse.org/babel)**这样的 Eclipse 工具来测试与您的插件相关联的语言包。

看看[JBoss 是如何做到](http://www.jboss.org/community/docs/DOC-13256/diff%3Bjsessionid=7CE0025933D15C5F218E9FAC35DF4684?secondVersionNumber=4)的。

[![](https://i.stack.imgur.com/4jaPz.png)](https://i.stack.imgur.com/4jaPz.png)
[（来源：[jboss.org](http://www.jboss.org/community/servlet/JiveServlet/downloadImage/102-13256-4-1130/JBDS-pseudo.png)）]

# reflection - Eclipse RCP：ClassNotFoundException 或如何让其他包加载我的类

> ID：685269
> 
> 赞同：1
> 
> 时间：2009-03-26T10:49:52.017
> 
> 标签：reflection, eclipse-plugin, eclipse-rcp

详细信息：我正在尝试使用 Jalapeno 框架将我的 RCP 应用程序与 Cache 数据库连接起来。建立连接后，我试图从表中获取所有数据，就像在 Jalapeno 手册中一样：

```
if (objManager==null) return;
DBClass cortege = null;
try {
Iterator terms = objManager.openByQuery(DBClass.class, null, null);
System.out.println("terms ok");
while (terms.hasNext()){
    System.out.println("has next");
    cortege = (DBClass)terms.next();
} 
```

这段代码编译、运行和抛出异常

```
java.lang.RuntimeException: myPluginId.views.DBClass
at com.intersys.objects.POJOIterator.next(POJOIterator.java:75)
   ...skip...
   Caused by: java.lang.ClassNotFoundException: myPlugin.views.DBClass
    at java.net.URLClassLoader$1.run(Unknown Source)
    at java.security.AccessController.doPrivileged(Native Method)
    at java.net.URLClassLoader.findClass(Unknown Source)
    at java.lang.ClassLoader.loadClass(Unknown Source)
    at sun.misc.Launcher$AppClassLoader.loadClass(Unknown Source)
    at java.lang.ClassLoader.loadClass(Unknown Source)
    at org.eclipse.core.runtime.internal.adaptor.ContextFinder.loadClass(ContextFinder.java:129)
    at java.lang.ClassLoader.loadClass(Unknown Source)
    at java.lang.ClassLoader.loadClassInternal(Unknown Source)
    at java.lang.Class.forName0(Native Method)
    at java.lang.Class.forName(Unknown Source)
    at com.jalapeno.runtime.ObjectCopierToPojo.detach(ObjectCopierToPojo.java:76)
    at com.jalapeno.runtime.ObjectCopierToPojo.findPojo(ObjectCopierToPojo.java:472)
    at com.intersys.classes.CacheRootObject.detach(CacheRootObject.java:255)
    at com.intersys.classes.Persistent.detach(Persistent.java:567)
    at com.intersys.objects.POJOIterator.next(POJOIterator.java:59) 
```

在 terms.next();

我根本无法得到它... DBClass 类的实例刚刚创建，但无法加载类。 **然后我尝试将此代码放在简单的 java 应用程序（不是 eclipse rcp）中，一切正常。**所以我认为某些 Eclipse 部分会阻止类加载。

我也尝试在调用 terms.next() 之前加载类；

```
Bundle b = Platform.getBundle("myPluginId");
try {
b.loadClass("DBClass");
} catch (ClassNotFoundException e) {
System.out.println("no class");
e.printStackTrace();
} 
```

...并得到同样的错误。无法加载类。那么，这是一个已知问题吗？有解决办法吗？

### 更新

经过一些研究更新问题：

如何让 Jalapeno 插件从我的插件加载类？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T12:02:49.067

您可能想尝试好友类加载。有关 Eclipse 类加载的更多信息，Alex Blewitt 在[此处](http://www.eclipsezone.com/articles/eclipse-vms/)编写了 Eclipse 中类加载系统的出色概述。它已有几年历史，但在大多数情况下，它仍然具有相关性。

伙伴类加载的要点是这样的：

*   插件声明它需要帮助加载类。它通过声明其“伙伴插件”来做到这一点

*   好友插件声明其好友政策

*   当常规加载机制失败时，Eclipse 会尝试使用您指定的伙伴类加载策略。

所以在你的情况下，试着把：

```
Eclipse-BuddyPolicy: registered 
```

在 Jalapeno 插件的 manifest.mf 文件中

并输入：

```
Eclipse-RegisterBuddy: id.of.jalepeno.plugin 
```

在插件的 manifest.mf 中

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T11:05:13.463

我不确定，但也许你必须导出类所在的包。

在 MANIFEST "Runtime" 中选择并添加所有包

# java - 使用 ServletOutputStream 在 Java servlet 中写入非常大的文件而不会出现内存问题

> ID：685271
> 
> 赞同：40
> 
> 时间：2009-03-26T10:52:01.077
> 
> 标签：java, servlets, stream, websphere

我正在使用 IBM Websphere Application Server v6 和 Java 1.4，并尝试将大型 CSV 文件写入 CSV 文件以`ServletOutputStream`供用户下载。目前文件大小在 50-750MB 之间。

较小的文件不会造成太大的问题，但是对于较大的文件，它似乎被写入堆中，然后导致 OutOfMemory 错误并关闭整个服务器。

这些文件只能通过 HTTPS 提供给经过身份验证的用户，这就是为什么我通过 Servlet 为它们提供服务，而不是仅仅将它们粘贴在 Apache 中。

我正在使用的代码是（在此周围删除了一些绒毛）：

```
 resp.setHeader("Content-length", "" + fileLength);
    resp.setContentType("application/vnd.ms-excel");
    resp.setHeader("Content-Disposition","attachment; filename=\"export.csv\"");

    FileInputStream inputStream = null;

    try
    {
        inputStream = new FileInputStream(path);
        byte[] buffer = new byte[1024];
        int bytesRead = 0;

        do
        {
            bytesRead = inputStream.read(buffer, offset, buffer.length);
            resp.getOutputStream().write(buffer, 0, bytesRead);
        }
        while (bytesRead == buffer.length);

        resp.getOutputStream().flush();
    }
    finally
    {
        if(inputStream != null)
            inputStream.close();
    } 
```

这`FileInputStream`似乎不会导致问题，就像我写入另一个文件或只是完全删除写入内存使用似乎不是问题一样。

我在想的是，`resp.getOutputStream().write`它被存储在内存中，直到数据可以发送到客户端。所以整个文件可能会被读取并存储在`resp.getOutputStream()`导致我的内存问题和崩溃中！

我尝试过缓冲这些流，也尝试过使用 Channels from `java.nio`，但似乎都没有对我的内存问题产生任何影响。我还刷新了`OutputStream`循环的每次迭代和循环之后，这没有帮助。

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2010-06-16T12:09:02.957

默认情况下，一般的 servletcontainer 本身每 ~2KB 刷新一次流。当从同一个源顺序流式传输数据时，您`flush()`真的不需要显式调用at 。例如，在 Tomcat（和 Websphere！）中，这可配置为HTTP 连接器的属性。`OutputStream``HttpServletResponse``bufferSize`

如果事先不知道内容长度（根据[Servlet API 规范](https://jakarta.ee/specifications/servlet/4.0/apidocs/javax/servlet/http/HttpServlet.html#doGet-javax.servlet.http.HttpServletRequest-javax.servlet.http.HttpServletResponse-)！）并且客户端支持 HTTP 1.1，那么一般的 servletcontainer 也只是以[块的形式流式传输数据。](https://en.wikipedia.org/wiki/Chunked_transfer_encoding)

问题症状至少表明 servletcontainer 在刷新之前正在缓冲内存中的整个流。这可能意味着内容长度标头未设置和/或 servletcontainer 不支持分块编码和/或客户端不支持分块编码（即它使用 HTTP 1.0）。

要修复一个或另一个，只需预先设置内容长度：

```
response.setContentLengthLong(new File(path).length()); 
```

或者当您还没有使用 Servlet 3.1 时：

```
response.setHeader("Content-Length", String.valueOf(new File(path).length())); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T11:44:53.837

对`flush`输出流有效。

真的，我想评论一下，您应该使用三参数形式的写入，因为缓冲区不一定是完全读取的（特别是在文件末尾（！））。除非您希望您的服务器意外死亡，否则尝试/最终将是有序的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T15:32:02.827

我使用了一个包装输出流的类，以使其在其他上下文中可重用。它在更快地将数据传输到浏览器方面对我来说效果很好，但我还没有研究内存影响。（请原谅我过时的 m_ 变量命名）

```
import java.io.IOException;
import java.io.OutputStream;

public class AutoFlushOutputStream extends OutputStream {

    protected long m_count = 0;
    protected long m_limit = 4096; 
    protected OutputStream m_out;

    public AutoFlushOutputStream(OutputStream out) {
        m_out = out;
    }

    public AutoFlushOutputStream(OutputStream out, long limit) {
        m_out = out;
        m_limit = limit;
    }

    public void write(int b) throws IOException {

        if (m_out != null) {
            m_out.write(b);
            m_count++;
            if (m_limit > 0 && m_count >= m_limit) {
                m_out.flush();
                m_count = 0;
            }
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-30T18:42:34.957

我也不确定`flush()`on`ServletOutputStream`在这种情况下是否有效，但`ServletResponse.flushBuffer()`应该将响应发送给客户端（至少按照 2.3 servlet 规范）。

`ServletResponse.setBufferSize()`听起来也很有希望。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-06-16T10:20:41.713

所以，按照你的场景，你不应该在那个while循环中（每次迭代）而不是在它之外刷新（ing）吗？我会尝试这样做，不过缓冲区要大一点。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-06-21T16:17:06.150

1.  如果 close() 运算符中的字段不为空， Kevin 的班级应该关闭该`m_out`字段，我们不想泄漏东西，是吗？

2.  除了`ServletOutputStream.flush()`操作员之外，该`HttpServletResponse.flushBuffer()`操作还可以刷新缓冲区。但是，关于这些操作是否有任何影响，或者 http 内容长度支持是否受到干扰，这似乎是一个特定于实现的细节。请记住，指定内容长度是 HTTP 1.0 上的一个选项，因此如果您刷新内容，则内容应该只是流出。但我没有看到

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-06-24T10:17:38.317

while 条件不起作用，您需要在使用前检查 -1。并且请为输出流使用一个临时变量，它更易于阅读并且可以安全地重复调用 getOutputStream()。

```
OutputStream outStream = resp.getOutputStream();
while(true) {
    int bytesRead = inputStream.read(buffer);
    if (bytesRead < 0)
      break;
    outStream.write(buffer, 0, bytesRead);
}
inputStream.close();
out.close(); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-26T14:08:51.307

与您的内存问题无关，while循环应该是：

```
while(bytesRead > 0); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-04-25T07:20:38.043

你的代码有一个无限循环。

```
do
{
    bytesRead = inputStream.read(buffer, offset, buffer.length);
    resp.getOutputStream().write(buffer, 0, bytesRead);
}
while (bytesRead == buffer.length); 
```

**offset**在整个循环中具有相同的值，因此如果最初**offset = 0**，它将在每次迭代中保持不变，这将导致无限循环并导致 OOM 错误。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2015-07-07T11:20:10.533

默认情况下，IBM websphere 应用程序服务器对 servlet 使用异步数据传输。这意味着它缓冲响应。如果您遇到大数据和 OutOfMemory 异常的问题，请尝试更改 WAS 上的设置以使用同步模式。

[将 WebSphere Application Server WebContainer 设置为同步方式](http://www-01.ibm.com/support/docview.wss?uid=swg21317658)

您还必须注意加载块并刷新它们。从大文件加载的示例。

```
ServletOutputStream os = response.getOutputStream();
FileInputStream fis = new FileInputStream(file);
            try {
                int buffSize = 1024;
                byte[] buffer = new byte[buffSize];
                int len;
                while ((len = fis.read(buffer)) != -1) {
                    os.write(buffer, 0, len);
                    os.flush();
                    response.flushBuffer();
                }
            } finally {
                os.close();
            } 
```

# ruby-on-rails - 你如何使用 will_paginate？

> ID：685279
> 
> 赞同：2
> 
> 时间：2009-03-26T10:54:39.933
> 
> 标签：ruby-on-rails, pagination

假设我有一组对象包含在`@set`. 这些对象中的每一个都有一个描述方法，它将返回一些我想在各个页面上显示的文本。我如何使用它`will_paginate`来分页？

到目前为止，我看到的示例如下：

```
@articles = Article.paginate :page => params[:page] 
```

看起来他们指的是所有文章对象。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T12:15:42.530

假设您的模型被调用`SomeObject`，`will_paginate`语法类似于 ActiveRecord 的`.find()`：

```
@set = SomeObject.paginate(:page       => params[:page],
                           :per_page   => 20,
                           :order      => 'created_at DESC',
                           :conditions => { :foo => 'bar' }) 
```

检查[文档](http://github.com/mislav/will_paginate/blob/8888651be8d6656bdf2378731d91a8badbaa2556/README.rdoc)以获取更多信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T11:16:09.023

要在活动记录中进行调用，您只需使用 .paginate 而不是 .find 并传递必要的参数，gem 有很好的文档说明如何使用它。安装文档和使用示例在自述文件中。这些示例可能没有使用您的@set，但您以相同的方式使用它。

编辑：显然这些链接是错误的，will_paginate 的 github 存储库有那个 wiki 和自述文件。在 github 上搜索它，因为我目前似乎有史诗链接失败。

# winforms - 如何加快 .NET winforms 渲染

> ID：685282
> 
> 赞同：9
> 
> 时间：2009-03-26T10:56:59.020
> 
> 标签：winforms, performance, rendering

我有一系列表格并在它们之间导航。

每个表单都有一组控件，我从 SQLite 数据库加载属性，这是一个漫长的（大约 1 秒）操作，不会给用户最好的感觉，因为表单是逐渐绘制的。

我不太介意延迟，但我希望在加载所有数据时绘制表单。我想避免使用新线程，因为这会导致跨线程操作问题。

除了通过缓存加载的数据来加速整个应用程序之外，还有什么好的解决方案吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-26T11:24:01.907

有一种简单的方法可以加快许多控件的感知性能，尤其是数据密集型控件，如列表视图、列表框、组合框等。

在填充它们之前调用 BeginUpdate() 方法，完成后调用 EndUpdate()。这将禁用控件的重绘，直到您用数据填充它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T11:30:15.183

对不起。这就是线程的用途。“跨线程操作问题”定义明确，并且有处理它们的通用模式。只需将线程交互的地方减少到最低限度（在这种情况下，它将是一个地方——在加载数据之后），它就变得微不足道了。

还有一些类使 winforms 应用程序中的多线程变得更加容易，因为它们抽象了线程之间的交互。[BackgroundWorker](http://fernandof.wordpress.com/2007/04/04/implementing-multi-threading-in-winforms-using-the-backgroundworker-class/) （链接到有关它的博客文章）将为您在另一个线程上执行工作，并通过在 UI 线程上触发事件来通知您何时完成。您可以获得多线程的好处而没有任何陷阱。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T11:29:48.427

我发现加载 Winform 控件（如组合框和列表框）在指向视图而不是表本身时加载速度要快得多，特别是如果您可以将视图限制为与必须查看的控件相比更精简整张桌子。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-07-11T13:04:21.340

这个链接有一些很好的解决方案，据我认为 BackgroundWorker 进程应该有帮助。 [http://devcomponents.com/blog/?p=361](http://devcomponents.com/blog/?p=361)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T10:59:25.210

回到 VB 时代，我使用 LockWindowUpdate API。由于这需要一个窗口句柄，它应该也可以用于 WinForms。虽然，从未尝试过。

# visual-studio - 在 Interdev 中为 ASP 页面创建 Web 项目

> ID：685283
> 
> 赞同：1
> 
> 时间：2009-03-26T10:57:12.937
> 
> 标签：visual-studio, asp-classic

如何在 Visual Interdev 中为 ASP 页面创建 Web 项目。我需要调试 ASP 页面。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T11:05:41.527

我记得上次我尝试设置它时遇到了几个问题。这与使用的 DLL 版本有关。我不得不用更新的版本替换几个。我需要重新安装，所以当我发现时会更新这个

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T20:50:51.793

您可以通过在 Visual Studio 2005 或 Visual Studio 2008 SP1（不适用于普通 VStudio 2008）中打开您的网站来调试经典 ASP 页面。

您必须手动附加到 dllhost 进程才能启动调试会话。

# linux - sem_post() 因有效信号量而失败

> ID：685284
> 
> 赞同：1
> 
> 时间：2009-03-26T10:57:46.447
> 
> 标签：linux, semaphore

我有一个带有信号量的队列。尽管信号量本身是有效的，但在某些时候所有调用`sem_post()`总是返回“无效参数”错误

信号量是 C++ 对象的私有成员，它永远不会被删除，它也可以在 gdb 中检查。我`sem_getvalue()`在 - 值读取之前添加了`sem_post()`OK 然后它失败了`sem_post()`。有什么问题？

```
CThreadQueue::CThreadQueue(int MaxSize) :
    _MaxSize(MaxSize)
{
    sem_init(&_TaskCount, 0, 0)

    pthread_mutex_init(&_Mutex, 0);
    pthread_create(&_Thread, NULL, CThreadQueue::StartThread, this);
}

CThreadQueue::~CThreadQueue()
{
    pthread_kill(_Thread, SIGKILL);
    sem_destroy(&_TaskCount);
}

int CThreadQueue::AddTask(CThreadTask Task)
{
    pthread_mutex_lock(&_Mutex);
    _Queue.push_back(TempTask);
    sem_post(&_TaskCount)
    pthread_mutex_unlock(&_Mutex);

    return 0;
}

void *CThreadQueue::StartThread(void *Obj)
{
    ((CThreadQueue*)Obj)->RunThread();
    return NULL;
}

//runs in a separate thread
void CThreadQueue::RunThread()
{
    CThreadQueue::CTask Task;

    while(1) {
        sem_wait(&_TaskCount);
        pthread_mutex_lock(&_Mutex);

        Task = _Queue.front();
        _Queue.pop_front();

        pthread_mutex_unlock(&_Mutex);

        if (Task.Callee != NULL)
            Task.Callee->CallBackFunc(NULL, Task.CallParam);
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T12:26:03.613

有什么问题？任何数量的东西。其他东西可能正在破坏信号量或覆盖用于存储它的内存或指向它的指针。另一种可能性是您调用 sem_post() 太多次并且计数器溢出。代码示例会有所帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-03-30T18:10:54.790

我们遇到了同样的问题，经过很长时间弄清楚可能发生的情况后，我们发现问题的发生是因为信号量是在一个字节对齐更改为 1 的结构内定义的（在本例中使用 pragma pack(1 ) 指令)。

Linux 上的 POSIX 信号量实现使用 futex 系统调用。根据 futex 手册页，当“未定义操作或页面对齐错误”时返回 EINVAL。

在我们的例子中，要么删除 pragma pack(1) 指令，要么将信号量定义为结构的第一个元素，解决了这个问题。

# c# - 更改位置文件夹？

> ID：685285
> 
> 赞同：-1
> 
> 时间：2009-03-26T10:58:01.297
> 
> 标签：c#, .net, wpf

我只有几天时间在 WPF 中展示一个关于音乐播放器的演示，但我遇到了一个问题，我现在无法解决。我需要知道如何在音乐播放器运行时更​​改位置文件夹，我有 3 个位置文件夹：

1.  D/：早上；
2.  D/：下午；
3.  D/：夜晚；

在每个文件夹中都有不同类型的歌曲。这个音乐播放器每天从早上 8 点到晚上 10 点不间断地使用，所以在早上（早上 8 点）运行应用程序时，它会自动下载文件夹“Morning”，但是当时间是中午时，它会更改位置文件夹并传入文件夹“下午”（大约 6p 将传递到文件夹“夜晚”），此时我被卡住了，我不知道如何完成这一步，我不知道如何组织我的代码以使音乐播放器发生变化位置文件夹并以自动方式下载新歌曲。请问您有什么想法可以启发我的思想并继续完成这个演示吗？对不起我的困惑；非常感谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T14:47:59.480

Honsa 有正确的想法，但这是一个稍微干净的实现：

```
public static string GetFolderForTime(DateTime time)
{
  if (time.Hour > 8 && time.Hour < 10)
    return @"D:\Morning\";
  if (time.Hour > 10 && time.Hour < 18)
    return @"D:\Afternoon\";
  return @"D:\Night\";
} 
```

这样，如果需要，您可以传入与当前时间不同的时间，尽管通常您会使用 DateTime.Now。

另外，请注意函数的名称描述了它的作用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T13:58:48.880

静态公共字符串 GetWorkingFolder() { if(System.DateTime.Now.Hour > 1 && System.DateTime.Now.Hour < 12) return @"D:\Morning"; else if (System.DateTime.Now.Hour > 11 && System.DateTime.Now.Hour < 18) return @"D:\Afternoon"; 否则返回@"D:\Evening"; }

将返回一个取决于当前 pc 时间（当然可以更改）的差异字符串，然后可以将其解析到目录中或直接用于任何加载方法正在拾取各种“曲调”

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-26T14:37:51.003

试试这个。每次一首歌曲结束时，在它加载一首新歌曲之前，只需调用一个执行此操作的函数：

```
 // The string returned is the path
    public string TimeOfDay()
    {
        // How you define 
        if(System.DateTime.Now.Hour >= 8 && System.DateTime.Now.Hour < 10)
            return @"D:\Morning\";
        else if(System.DateTime.Now.Hour >= 10 && System.DateTime.Now.Hour < 18)
            return @"D:\Afternoon\";
        else
            return @"D:\Night\";
    } 
```

如果返回的路径与您已有的路径不同，则您更改并从新路径播放歌曲。

# algorithm - 求一个数的平方根的算法？

> ID：685286
> 
> 赞同：3
> 
> 时间：2009-03-26T10:59:02.213
> 
> 标签：algorithm, language-agnostic

我知道这个问题的唯一算法是牛顿法（做一个猜测，然后改进它直到它足够好）。

任何其他想法（使用您喜欢的任何语言）？

PS：当然我没有任何用例，我只是出于学术原因研究它。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-26T11:01:13.927

总是有[John Carmack 方法](http://www.codemaestro.com/reviews/9)，它是 Newton 方法的高效变体。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-26T11:06:31.650

有几个可以在[这里](http://mathworld.wolfram.com/SquareRootAlgorithms.html)找到。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-02-24T03:47:24.313

您可能需要检查[计算平方根的方法中的](https://en.wikipedia.org/wiki/Methods_of_computing_square_roots#Approximations_that_depend_on_IEEE_representation)算法。

这是牛顿法的快速`C`日志基础实现：`2`

```
double sqrt(const double x)  
{
  union
  {
    int i;
    double x;
  } u;

  u.x = x;
  u.i = (1<<29) + (u.i >> 1) - (1<<22); 
  return u.x;
} 
```

# enterprise-library - Entlib 记录器的模板设置

> ID：685287
> 
> 赞同：1
> 
> 时间：2009-03-26T10:59:10.263
> 
> 标签：enterprise-library

我不得不从 log4net 转移到 entlib 记录器。我知道你在想什么？:)

无论如何，我正在尝试更改记录器的默认模板以摆脱无用的信息 - 例如优先级等。但我的日志仍然有它 - 所有这些值在日志中都是 null 或默认（值类型）创建的条目。这是模板：

```
 <add template="Timestamp: {timestamp}{tab}Category: {category}{tab}Severity: {severity}{newline}
Process Id: {processId}{tab}Thread Id: {win32ThreadId}{newline}
Message: {message}"
      type="Microsoft.Practices.EnterpriseLibrary.Logging.Formatters.TextFormatter, Microsoft.Practices.EnterpriseLibrary.Logging, Version=4.1.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"
      name="Text Formatter" /> 
```

我仍然收到事件 ID、标题、机器、优先级和进程名称。任何帮助，将不胜感激。

* * *

有没有办法使用数字而不是时间戳来命名旧的翻转日志文件并指定最大翻转计数 - 就像在 log4net 中一样？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T11:02:17.650

在配置文件 (app.config) 中有一个元素格式化程序。您可以更改它（最好使用配置工具）。我的一个看起来像这样：

```
<add 
 template="{timestamp}  {machine}:{processId}:{threadName}({win32ThreadId}) {message}"
    type="Microsoft.Practices.EnterpriseLibrary.Logging.Formatters.TextFormatter, Microsoft.Practices.EnterpriseLibrary.Logging, Version=4.1.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"
    name="LogFileFormatter" /> 
```

# security - 安全地实现会话状态和“让我保持登录”功能

> ID：685298
> 
> 赞同：8
> 
> 时间：2009-03-26T11:03:23.000
> 
> 标签：security, session, session-state

我想提高有关会话管理的当前应用程序的安全性，并且我希望用户在他们明确注销之前一直登录。

如何安全地实现这一点？

将会话信息保存在数据库中，例如 sessionid、ip、useragent？

请提供要求，可能是数据库布局、注意事项、提示和技巧。

注意：我知道像 asp.NET、rails、codeigniter 等框架已经解决了这个问题，但这不是一个选择。实际上它是一个经典的asp应用程序。但我认为这个问题与特定语言无关。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-26T11:11:25.197

阅读[改进的持久登录 Cookie 最佳实践](http://jaspan.com/improved_persistent_login_cookie_best_practice)（文章和评论）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T11:16:39.100

*您应该知道，除非您使用 https，否则这样的系统是不安全的。*

这很简单：

1.  用户登录。
2.  服务器向用户发送一个过期日期在很远的将来的 cookie。
3.  如果需要，可以记录用户的 IP。
4.  用户请求另一个页面。
5.  服务器检查 cookie（可能是与 cookie 一起存储的 IP），查看用户是否已登录，并为页面提供服务。

## 一些安全注意事项：

如上所述，除非您使用 https，否则没有安全的方法。

如果您使用共享主机，请尝试找出您的 cookie 的存储位置。它们通常位于 /tmp 目录中，每个用户都可以访问并通过该目录窃取您的 cookie。

跟踪 IP，如果您知道计算机永远不会更改它。

不要在 cookie 中存储任何信息。只需在此处存储一个随机数并将属于它的信息存储在数据库中的服务器上。（当然，偏好颜色等非敏感信息可以存储在 cookie 中。）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T11:06:56.003

创建一个 2030 年之类的荒谬到期的 cookie。如果您需要会话状态，请在 cookie 中保留会话 ID（如果安全性优先，则加密）并将其映射到数据库中的表。IP/UserAgent 等往往是元数据，cookie 是会话的关键。

# java - 有没有办法覆盖 Java 中的类变量？

> ID：685300
> 
> 赞同：173
> 
> 时间：2009-03-26T11:04:02.063
> 
> 标签：java, inheritance, overriding

```
class Dad
{
    protected static String me = "dad";

    public void printMe()
    {
        System.out.println(me);
    }
}

class Son extends Dad
{
    protected static String me = "son";
}

public void doIt()
{
    new Son().printMe();
} 
```

函数 doIt 将打印“dad”。有没有办法让它打印“儿子”？

* * *

## 回答 #1

> 赞同：102
> 
> 时间：2009-11-06T11:10:12.393

简而言之，不，没有办法覆盖类变量。

您不会覆盖 Java 中的类变量，而是隐藏它们。覆盖是实例方法。隐藏不同于覆盖。

在您给出的示例中，通过在 Son 类中声明名为“me”的类变量，您隐藏了它将从其超类 Dad 继承的具有相同名称的类变量“me”。以这种方式隐藏变量不会影响超类 Dad 中类变量“me”的值。

对于你问题的第二部分，如何让它打印“儿子”，我会通过构造函数设置值。尽管下面的代码与您的原始问题有很大的不同，但我会这样写；

```
public class Person {
    private String name;

    public Person(String name) {
        this.name = name;
    }

    public void printName() {
        System.out.println(name);
    }
} 
```

[JLS 在第8.3 节 - 字段声明](http://docs.oracle.com/javase/specs/jls/se7/html/jls-8.html#jls-8.3)中提供了更多关于隐藏的详细信息

* * *

## 回答 #2

> 赞同：73
> 
> 时间：2015-02-01T14:33:46.997

是的。但就变量而言，它被覆盖（为变量赋予新值。为函数赋予新定义是覆盖）。只是不要声明变量，而是在构造函数或静态块中初始化（更改）。

在父类的块中使用时，该值将得到体现

如果变量是静态的，则在初始化期间使用静态块更改值，

```
class Son extends Dad {
    static { 
       me = "son"; 
    }
} 
```

否则在构造函数中发生变化。

您也可以稍后在任何块中更改该值。它将反映在超类中

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2009-03-26T11:09:54.233

是的，只需覆盖该`printMe()`方法：

```
class Son extends Dad {
        public static final String me = "son";

        @Override
        public void printMe() {
                System.out.println(me);
        }
} 
```

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2011-07-08T17:08:02.900

您可以创建一个 getter，然后覆盖该 getter。如果您要覆盖的变量是其自身的子类，则它特别有用。想象一下你的超类有一个`Object`成员，但在你的子类中，它现在被更多地定义为一个`Integer`.

```
class Dad
{
        private static final String me = "dad";

        protected String getMe() {
            return me;
        }

        public void printMe()
        {
                System.out.println(getMe());
        }
}

class Son extends Dad
{
        private static final String me = "son";

        @Override
        protected String getMe() {
            return me;
        }
}

public void doIt()
{
        new Son().printMe(); //Prints "son"
} 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2014-04-14T01:34:32.997

如果您要覆盖它，我看不出保持此静态的正当理由。我建议使用抽象（参见示例代码）。：

```
 public interface Person {
        public abstract String getName();
       //this will be different for each person, so no need to make it concrete
        public abstract void setName(String name);
    } 
```

现在我们可以添加爸爸了：

```
public class Dad implements Person {

    private String name;

    public Dad(String name) {
        setName(name);
    }

    @Override
    public final String getName() {
    return name;
    }

    @Override
    public final void setName(String name) {
        this.name = name;
    }
} 
```

儿子：

```
public class Son implements Person {

    private String name;

    public Son(String name) {
        setName(name);
    }

    @Override
    public final String getName() {
        return name;
    }

    @Override
    public final void setName(String name) {
        this.name = name;
    }
} 
```

爸爸遇到了一位漂亮的女士：

```
public class StepMom implements Person {

    private String name;

    public StepMom(String name) {
        setName(name);
    }

    @Override
    public final String getName() {
        return name;
    }

    @Override
    public final void setName(String name) {
        this.name = name;
    }
} 
```

看起来我们有一个家庭，让我们告诉全世界他们的名字：

```
public class ConsoleGUI {

    public static void main(String[] args) {
        List<Person> family = new ArrayList<Person>();
        family.add(new Son("Tommy"));
        family.add(new StepMom("Nancy"));
        family.add(new Dad("Dad"));
        for (Person person : family) {
            //using the getName vs printName lets the caller, in this case the
            //ConsoleGUI determine versus being forced to output through the console. 
            System.out.print(person.getName() + " ");
            System.err.print(person.getName() + " ");
            JOptionPane.showMessageDialog(null, person.getName());
    }
} 
```

}

System.out 输出：Tommy Nancy Dad
System.err 同上（只是有红色字体）
JOption 输出：
Tommy *then*
Nancy *then*
Dad

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-03-26T11:17:14.993

这看起来像一个设计缺陷。

删除 static 关键字并设置变量，例如在构造函数中。这样，Son 只是在他的构造函数中将变量设置为不同的值。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2013-07-15T03:11:47.333

虽然类变量确实可能只隐藏在子类中，而不是被覆盖，但仍然可以在不覆盖`printMe ()`子类的情况下做你想做的事情，反射是你的朋友。在下面的代码中，为了清楚起见，我省略了异常处理。请注意，在这种情况下，声明`me`为`protected`似乎没有多大意义，因为它将隐藏在子类中......

```
class Dad
  {
    static String me = "dad";

    public void printMe ()
      {
        java.lang.reflect.Field field = this.getClass ().getDeclaredField ("me");
        System.out.println (field.get (null));
      }
  } 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2013-10-18T17:53:51.100

```
class Dad
{
    protected static String me = "dad";

    public void printMe()
    {
        System.out.println(me);
    }
}

class Son extends Dad
{
    protected static String _me = me = "son";
}

public void doIt()
{
    new Son().printMe();
} 
```

...将打印“儿子”。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-04-17T03:06:47.087

它确实打印了“爸爸”，因为该字段没有被覆盖而是隐藏了。有三种方法可以让它打印“儿子”：

方法一：覆盖 printMe

```
class Dad
{
    protected static String me = "dad";

    public void printMe()
    {
        System.out.println(me);
    }
}

class Son extends Dad
{
    protected static String me = "son";

    @override
    public void printMe()
    {
        System.out.println(me);
    }
}

public void doIt()
{
    new Son().printMe();
} 
```

方法二：不隐藏字段，在构造函数中初始化

```
class Dad
{
    protected static String me = "dad";

    public void printMe()
    {
        System.out.println(me);
    }
}

class Son extends Dad
{
    public Son()
    {
        me = "son";
    }
}

public void doIt()
{
    new Son().printMe();
} 
```

方法三：使用静态值在构造函数中初始化一个字段

```
class Dad
{
    private static String meInit = "Dad";

    protected String me;

    public Dad() 
    {
       me = meInit;
    }

    public void printMe()
    {
        System.out.println(me);
    }
}

class Son extends Dad
{
    private static String meInit = "son";

    public Son()
    {
        me = meInit;
    }

}

public void doIt()
{
    new Son().printMe();
} 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2017-01-06T12:58:44.020

[https://docs.oracle.com/javase/tutorial/java/IandI/hidevariables.html](https://docs.oracle.com/javase/tutorial/java/IandI/hidevariables.html)

它被称为隐藏字段

*从上面的链接*

> 在一个类中，与超类中的字段同名的字段会隐藏超类的字段，即使它们的类型不同。在子类中，超类中的字段不能通过其简单名称来引用。相反，必须通过 super 访问该字段，这将在下一节中介绍。一般来说，我们不建议隐藏字段，因为它会使代码难以阅读。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2018-08-14T16:44:08.313

变量不参与覆盖。只有方法可以。方法调用是在运行时解决的，也就是说，调用方法的决定是在运行时做出的，但变量仅在编译时决定。因此，该变量被调用，其引用用于调用而不是运行时对象。

看看下面的片段：

```
package com.demo;

class Bike {
  int max_speed = 90;
  public void disp_speed() {
    System.out.println("Inside bike");
 }
}

public class Honda_bikes extends Bike {
  int max_speed = 150;
  public void disp_speed() {
    System.out.println("Inside Honda");
}

public static void main(String[] args) {
    Honda_bikes obj1 = new Honda_bikes();
    Bike obj2 = new Honda_bikes();
    Bike obj3 = new Bike();

    obj1.disp_speed();
    obj2.disp_speed();
    obj3.disp_speed();

    System.out.println("Max_Speed = " + obj1.max_speed);
    System.out.println("Max_Speed = " + obj2.max_speed);
    System.out.println("Max_Speed = " + obj3.max_speed);
  }

} 
```

运行代码时，控制台会显示：

```
Inside Honda
Inside Honda
Inside bike

Max_Speed = 150
Max_Speed = 90
Max_Speed = 90 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-03-26T11:10:49.737

仅通过覆盖`printMe()`：

```
class Son extends Dad 
{
    public void printMe() 
    {
        System.out.println("son");
    }
} 
```

`me`方法中的引用`Dad.printMe`隐式指向静态字段`Dad.me`，因此您正在以一种或另一种方式`printMe`更改`Son`...

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-03-26T11:19:56.360

您不能覆盖类中的变量。您只能覆盖方法。你应该保持变量私有，否则你会遇到很多问题。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2018-05-05T16:21:18.623

不。类变量（也适用于实例变量）在 Java 中不表现出覆盖特性，因为类变量是根据调用对象的类型调用的。在层次结构中添加了一个类（人类）以使其更加清晰。所以现在我们有

儿子延伸爸爸延伸人类

在下面的代码中，我们尝试遍历 Human、Dad 和 Son 对象的数组，但它在所有情况下都会打印 Human 类的值，因为调用对象的类型是 Human。

```
 class Human
{
    static String me = "human";

    public void printMe()
    {
        System.out.println(me);
    }
}
class Dad extends Human
{
    static String me = "dad";

}

class Son extends Dad
{
    static String me = "son";
}

public class ClassVariables {
    public static void main(String[] abc)   {
        Human[] humans = new Human[3];
        humans[0] = new Human();
        humans[1] = new Dad();
        humans[2] = new Son();
        for(Human human: humans)   {
            System.out.println(human.me);        // prints human for all objects
        }
    }
} 
```

将打印

*   人类
*   人类
*   人类

> 所以没有覆盖类变量。

如果我们想从其父类的引用变量访问实际对象的类变量，我们需要通过将父引用（人类对象）转换为它的类型来显式地告诉编译器。

```
 System.out.println(((Dad)humans[1]).me);        // prints dad

    System.out.println(((Son)humans[2]).me);        // prints son 
```

将打印

*   爸爸
*   儿子

关于这个问题的一部分：-正如已经建议的那样，覆盖 Son 类中的 printMe() 方法，然后调用

```
Son().printMe(); 
```

爸爸的类变量“me”将被隐藏，因为“me”（在 Son 类中）最近的声明（来自 Son 类 printme() 方法）将获得优先权。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2019-10-08T02:50:14.070

只需在子类构造函数中调用 super.variable

```
public abstract class Beverage {

int cost;

int getCost() {

    return cost;

}

}`

public class Coffee extends Beverage {

int cost = 10;
Coffee(){
    super.cost = cost;
}

}`

public class Driver {

public static void main(String[] args) {

    Beverage coffee = new Coffee();

    System.out.println(coffee.getCost());

}

} 
```

输出为 10。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2012-07-17T12:24:36.090

当然使用私有属性，getter 和 setter 将是推荐的做法，但我测试了以下，它的工作原理......见代码中的评论

```
class Dad
{
    protected static String me = "dad";

    public void printMe()
    {
        System.out.println(me);
    }
}

class Son extends Dad
{
    protected static String me = "son";

    /* 
    Adding Method printMe() to this class, outputs son 
    even though Attribute me from class Dad can apparently not be overridden
    */

    public void printMe()
    {
        System.out.println(me);
    }
}

class Tester
{
    public static void main(String[] arg)
    {
        new Son().printMe();
    }
} 
```

Sooo ...我只是重新定义了继承规则还是让 Oracle 陷入了棘手的境地？对我来说，protected static String me 显然被覆盖了，正如你在执行这个程序时看到的那样。此外，为什么属性不应该被覆盖对我来说没有任何意义。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2015-06-10T14:47:00.783

当您可以轻松地在子类中重新分配变量时，为什么要覆盖变量。

我遵循这种模式来解决语言设计问题。假设您的框架中有一个重要的服务类，需要在多个派生应用程序中以不同的方式使用。在这种情况下，配置超类逻辑的最佳方法是重新分配其“定义”变量。

```
public interface ExtensibleService{
void init();
}

public class WeightyLogicService implements ExtensibleService{
    private String directoryPath="c:\hello";

    public void doLogic(){
         //never forget to call init() before invocation or build safeguards
         init();
       //some logic goes here
   }

   public void init(){}    

}

public class WeightyLogicService_myAdaptation extends WeightyLogicService {
   @Override
   public void init(){
    directoryPath="c:\my_hello";
   }

} 
```

# flash - 如何加载测试 Flash 应用程序

> ID：685311
> 
> 赞同：4
> 
> 时间：2009-03-26T11:06:46.563
> 
> 标签：flash, load-testing

有谁知道用于压力测试闪存应用程序的好工具（商业或免费）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-29T11:51:04.733

您可以使用[Microsoft Web Application Stress Tool](http://www.microsoft.com/downloads/details.aspx?FamilyID=e2c0585a-062a-439e-a67d-75a89aa36495&displaylang=en#Overview)或[Borland SilkPerformer](http://www.borland.com/us/products/silk/silkperformer/index.html)来做到这一点。

您可能想看看 Adob​​e 如何进行[压力测试](http://www.adobe.com/special/under_the_hood/report3/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T13:49:15.160

[Flash Selenium](http://code.google.com/p/flash-selenium/)可能是您正在寻找的。它更多地用于单元和验收测试，而不是压力测试。我认为对于压力测试，您希望使用[JMeter](http://jakarta.apache.org/jmeter/)并模拟来自 Flash 应用程序的服务器调用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T15:43:55.230

如果您可以让 Flash Selenium 工作（正如 Michael Glenn 建议的那样），我还建议您查看我的公司 BrowserMob，它提供[使用真实浏览器的负载测试](http://browsermob.com)。这些浏览器由 Selenium 提供支持，因为它们是真正的浏览器，所以运行 Flash 的方式与您期望的完全一样。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-10-02T18:00:16.403

[AppLoader](http://www.nrgglobal.com/apploader)是独立于协议的。您的企业中使用的每个应用程序都没有单独的测试许可证。因为 AppLoader 查看屏幕上的位图，所以它可用于测试从 GUI 前端可访问的所有应用程序。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-04-16T06:51:21.483

我在[http://www.cloudpuncher.com/index.shtml找到了一个非常好的服务](http://www.cloudpuncher.com/index.shtml)

# sql - 跨多个数据库的相关搜索结果

> ID：685317
> 
> 赞同：1
> 
> 时间：2009-03-26T11:08:19.680
> 
> 标签：sql, database

我有三个数据库，其中都有几个网页的内容。搜索所有三个并将最相关的网页放在搜索结果顶部的最佳方法是什么？

我能想到的唯一方法是按字数分解内容和/或创建一组复杂的搜索规则，以使一个内容优先于另一个内容。这可能比它的价值更麻烦，但我想知道是否有人知道可以帮助我的方法或产品。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T11:16:37.553

如果您使用的是 MS SQL Server，那么全文搜索可以为您返回排名。我没有使用它，因此您需要查看文档或在线查看详细信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T11:23:19.113

为了进一步支持 Ivans 回答上面的 Lucene 是要走的路。你没有提到你在什么平台上，所以我会指出你也可以使用这个的.NET端口。

如果你确实使用 Lucene，我建议你看看 Manning 的一本非常好的书。

在填充索引时，您有几个选择。对于初学者，您可以将所有文本转储到索引中，并允许引擎对其进行搜索。但是，我建议将固定字段添加到您的索引中，这将允许您支持诸如分区搜索或仅针对这些字段的搜索。

为了解释，假设您有一个网站字段。然后，您可以通过将索引搜索限制为在该字段中具有该网站的那些文档来分区您的索引。

另一个过程是从您的文档中提取兴趣点，并允许在不搜索整个索引条目的情况下搜索这些兴趣点。由于 lucene 引擎编写得非常好，因此您的里程可能会有所不同，因此它可能只会让您将搜索收集到更多逻辑单元中，从而帮助您解决问题。

我自己已经完成了这项工作，它有助于回答有关搜索和索引的确切内容的管理问题。

！

# c# - 如何在 C# 中创建一个属性类？

> ID：685318
> 
> 赞同：0
> 
> 时间：2009-03-26T11:08:28.230
> 
> 标签：c#, dictionary, hashtable

我想创建一个具有两个属性的类，例如`key`& `value`。

我想要一种方法，它会给我一个`value`基于`key`.

那么代码是什么？我知道`Hashtable`但是如何在 C# 中实现它？我可以有一个`string`作为钥匙吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T11:11:43.947

看`Dictionary<TKey, TValue>`课：http: [//msdn.microsoft.com/en-us/library/xfhwa508.aspx](http://msdn.microsoft.com/en-us/library/xfhwa508.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-26T11:13:06.067

这是实现这一点的最佳方法（我使用 Int32 作为存储类型的示例）：

```
Dictionary<String,Int32> dictionary = new Dictionary<String,Int32>
{
    // this just loads up the list with
    // some dummy data - notice that the
    // key is a string and the value is an int
    { "one", 1 },
    { "two", 2 },
    { "three", 3 },
}; 
```

现在您可以像这样从 Dictionary<,> 中获取值：

```
dictionary["one"]; // returns 1
dictionary["two"]; // returns 2 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T11:12:37.330

A`Dictionary<string, T>`会做你想做的一切。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T11:12:26.487

采用`Dictionary<string, TypeOfYourVAlue>`

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-26T11:14:58.247

[字典（TKey，TValue）类](http://msdn.microsoft.com/en-us/library/xfhwa508.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-26T11:34:01.727

还有更多的实现。[HashSet](http://msdn.microsoft.com/en-us/library/bb397728.aspx)是为集合操作而设计的，而KeyedCollection[是](http://msdn.microsoft.com/en-us/library/ms132438(VS.80).aspx)一个易于序列化的哈希表。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-26T18:57:37.947

... 还有`System.Collections.Specialized.NameValueCollection`，大致相当于`Dictionary<string,string>`，但允许在同一个键值下存储多个字符串值。引用 MSDN 文档：

> 此类可用于标题、查询字符串和表单数据。

# git - Git pull错误：无法创建临时sha1文件名

> ID：685319
> 
> 赞同：39
> 
> 时间：2009-03-26T11:08:40.960
> 
> 标签：git

我有一个小型 git repo 设置，唯一真正的目的是能够在多台机器（工作、家庭、笔记本电脑）上进行本地开发。因此，我有一个分支，一旦我离开计算机，我就提交/推送，一旦我在下一个坐下就拉。工作正常，到现在为止。现在，当我打开我的“实时测试”机器时，我得到以下信息：

```
remote: Counting objects: 38, done.
remote: Compressiremote: ng objects: 100% (20/20), done.
remote: Total 20 (delta 17), reused 0 (delta 0)
error: unable to create temporary sha1 filename .git/objects/ed: File exists

fatal: failed to write object
fatal: unpack-objects failed 
```

在网上搜索，我能找到的唯一真正的答案如下：[http](http://marc.info/?l=git&m=122720741928774&w=2) ://marc.info/?l=git&m=122720741928774&w =2 这基本上表明这是一个虚假的错误，是最重要的，因此什么也没说关于真正的问题。

我该从哪里找出问题所在？

编辑：删除本地副本并重新克隆

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-03-26T11:48:02.377

“ [Re: Bug? git svn fetch:”unable to create temporary sha1 filename /home/andres/git/public/crystal.g](http://marc.info/?l=git&m=122273422010414&w=2)中提到过：

> 重新[打包](http://www.kernel.org/pub/software/scm/git/docs/git-repack.html)存储库后，问题就消失了。确实比较奇怪。

你试过重新包装吗？

> `git-repack`用于将当前不在“包”中的所有对象组合成一个包。它还可用于将现有包重新组织成一个更有效的包。
> 包是对象的集合，单独压缩，应用了增量压缩，存储在单个文件中，并带有关联的索引文件。
> 包用于减少镜像系统、备份引擎、磁盘存储等的负载。

您是否尝试升级到最新版本的 Git ？

您[可以运行不同](http://web.archive.org/web/20090219000020/http://blog.felipebalbi.com/?p=39)的命令来“清理”您的存储库，从最安全到更激进的命令：

```
$ git-prune
$ git-gc --aggressive
$ git-repack
$ git-repack -a
$ git-prune-packed 
```

* * *

正如“ [Git 垃圾收集似乎无法完全正常工作](https://stackoverflow.com/a/28563637/6309)”中所述，a[`git gc --aggressive`](http://git-scm.com/docs/git-gc)本身是不够的。

最有效的组合是添加[`git repack`](http://git-scm.com/docs/git-repack)，而且[`git prune`](http://git-scm.com/docs/git-prune)：

```
git gc
git repack -Ad      # kills in-pack garbage
git prune           # kills loose garbage 
```

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-03-28T02:36:31.533

对于它的价值，当我遇到这个问题时 - 但是在提交时 - 我尝试了`git-repack`and `git-gc`，但都没有成功。我收到了一个权限被拒绝错误，这导致我`chown`将整个 repo 递归到我期望的用户，然后我可以毫无问题地提交/推送/拉取。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2010-05-26T11:42:17.587

当多个用户提交到同一个存储库时，我已经看到此错误，导致由于[ssh 和 umask导致组写入权限问题](http://moserei.de/index.php/58/shared-git-repo-ssh-umask-problems/comment-page-1)

`sharedrepository=true`您可以通过在 config 的 [core] 部分中设置来使新文件保留 g+w 模式：

```
cd /my/shared/repo.git
git repo-config core.sharedRepository true

# (might also need to "chmod -R g+wX ." for each 
# user that owns files in .git/objects) 
```

**编辑：**

此方法仅适用于已经存在的 repos。您可以在创建存储库时立即完成：`git --bare init --shared`.

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-06-04T13:16:36.933

我们遇到了用户 1 先前提交的相同问题，因此 objects/ed 目录由用户 1 创建并拥有。因为用户 1 的默认权限不允许用户 2 写入，所以用户 2 无法提交。

git 根据需要将这些目录创建为某种哈希桶，因此它们很可能由几个不同的人拥有，根据他们的 umask 具有不同的权限。

我们解决了这个问题，首先 chgrping 同一组拥有的所有目录，然后使用 g+w 对它们进行 chmodding，使它们可以组写入，最后正确设置每个人的 umask，以便所有新创建的存储桶也可以组写入。

这是因为我们使用 ssh:// URLs 从 git 签出 - 我假设如果我们使用 git 网络协议，它不会发生，因为 git 守护进程将具有一致的文件所有权。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2010-09-24T13:21:44.613

就我而言，我在尝试推动时遇到了这个问题。

```
dieter@dieter-dellD620-arch sugarcrmclient [master] git push origin
Counting objects: 16, done.
Delta compression using up to 2 threads.
Compressing objects: 100% (10/10), done.
Writing objects: 100% (12/12), 3.91 KiB, done.
Total 12 (delta 1), reused 11 (delta 1)
error: unable to create temporary sha1 filename ./objects/7a: File exists

fatal: failed to write object
error: unpack failed: unpacker exited with error code
To gitosis@tiktak.kangaroot.net:sugarcrmclient.git
 ! [remote rejected] master -> master (n/a (unpacker error))
 ! [remote rejected] web -> web (n/a (unpacker error))
error: failed to push some refs to 'gitosis@tiktak.kangaroot.net:sugarcrmclient.git' 
```

这不是权限问题。git gc、git gc --agrressive、git repack 或 git prune 本地没有帮助。请注意错误如何说“解包器错误”，我认为这是关键，因为它暗示它在另一边。所以我去了（裸）存储库并在那里做了一个 git gc 。然后我可以很好地推动。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2012-05-17T10:23:52.177

我在使用时遇到了这个问题`git push`

然后我运行`git gc`，它工作。

来自 git-gc(1) 手册页：

git-gc - 清理不必要的文件并优化本地存储库

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2011-11-04T14:19:40.207

我遇到了这个问题，感觉我已经尝试了上述所有方法。我以前见过这种情况，这是由于不同用户之间的权限推送到 repo，但在这种情况下，每个人都在同一个用户下推送，只是为了很好的衡量，我（在 repo 上）将所有内容都分配给了正确的用户并分组和 chmodded u+w 和 g+w 以获得良好的度量。我还在`error: unable to create temporary sha1 filename ./objects/9a`。

我刚刚做了更多的调查，似乎确实存在权限问题：在推送之前，在 repo（这是托管在服务器上的裸 repo）上，对象中的所有文件都具有`-rw-rw-r--`set 权限，这是你所期望的。它们都归同一个用户和组所有。推送失败后，我可以使用 grep 查找权限设置为的文件`-r--r--r--`，即任何人都不可写，并使用 bash 命令显示它们的位置`find . -perm 444 | xargs ls -l`。这样做会给我以下信息：

```
-r--r--r-- 1 ourusername ourgroupname    730 Nov  4 15:02 ./objects/46/346f550340bc0d3fec24ea42b25999161f8c7a
-r--r--r-- 1 ourusername ourgroupname    177 Nov  4 15:02 ./objects/4c/664ebbfad568de6101a52c01f5117654945d6d
-r--r--r-- 1 ourusername ourgroupname    730 Nov  4 14:36 ./objects/9e/3f572366da9fb319331dfd924ae35cf9fd00ae
-r--r--r-- 1 ourusername ourgroupname    175 Nov  4 14:36 ./objects/aa/f42d7ed706f1d2e4a0aa1c5eb184e17e917204 
```

这些都是最近更改的文件（发布时间为 11 月 4 日 15:08）。因此，看起来 git 正在更新/替换文件（给它们一个新的时间戳），更改过程中的权限，然后抱怨权限。我完全不知道这里发生了什么:(

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-24T06:37:57.377

我的问题是权限问题

我去了目录然后 cp -R repo repo_copy

然后一切都恢复了。

然后我去删除 repo 和权限被拒绝，检查 perms 并确定已经更改了足够的 perms，我正在运行的用户没有写访问权限......

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-06-20T17:57:11.757

如果其他人得到这个错误，我在跨越 windows-linux 鸿沟时遇到过它。似乎如果换行格式转换为 windows，您仍然可以在某些情况下提交，但 git 然后转换为 linux 格式。

因此，如果新行是唯一的更改，那么我们现在连续有两个相同的提交。由于提交哈希是从提交文件数据生成的，并且每个都具有相同的数据，因此它们最终具有相同的哈希。至少在我的情况下，这就是“文件存在”所表示的。Git 搞得一头雾水。

我通过在`git reset --hard`本地和中央仓库上修复它。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-11-01T18:45:52.073

就个人而言，我在做 git push origin master 时遇到了这个问题。我的解决方案是：在我的服务器上，我在包含我的存储库的目录中使用 root 登录并递归执行：

```
chown -hR MyGitUser MyRepo 
```

一切正常

我只有一个 git 用户，其他人通过发布他们的公钥与 ssh 连接。如果您配置多个 git 用户，则必须为每个用户执行相同的操作。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-05-18T09:27:51.770

尝试了一些解决方案，但最终意识到我们的 git 服务器的磁盘已经没有可用空间了。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-26T15:50:37.493

我曾经看到过这个错误并将其跟踪到权限问题。我找不到它是如何引起的，但不知何故 git 作为一个组运行，该组对某些对象目录没有写权限。

我在代码中没有看到任何明显的原因，并假设这是一个 OS X 权限问题，可能是由于一些草率的制作或安装造成的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-12-14T19:54:47.363

我遇到了类似的错误，这不是权限问题（我是存储库的唯一用户），并且 gc/repack 技术都不起作用。最终，我只是将旧的远程存储库移到一边并推送了一个新存储库。幸运的是，它很小。

利亚姆

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-01-28T17:21:36.203

应该注意的是，您需要修复您推送到的存储库的权限，而不仅仅是您的工作。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-03-03T15:16:14.223

更改用户组+权限对我有用。我注意到一些用户的提交在不同的组下。将所有更改为同一组可解决此问题。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2011-03-16T22:40:59.127

在 sshfs 上工作时出现这样的错误。它在卸载然后再次安装共享后自行修复。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2012-06-19T01:28:03.953

尝试在heroku上部署时遇到了这个问题。原来我有一个将文件写入 tmp/ 目录的 gem，heroku 不喜欢这样。把文件拿出来，瞧，问题解决了。看到这个：[https ://devcenter.heroku.com/articles/read-only-filesystem](https://devcenter.heroku.com/articles/read-only-filesystem)

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2013-06-23T23:02:17.390

我最近遇到了这个问题，我在这个线程上尝试了一切，但没有运气。我的 VPS 上还有大量磁盘空间，但事实证明，由于没有清理部署文件夹，我已经超过了 inode 限制（可能是由于我在处理之前包含了 100 个文件的 JS 库）。

我删除了大量旧部署，一切正常。

我意识到这有点极端，但如果所有其他方法都失败了，请记住这一点。

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2011-06-22T09:49:03.333

在 linux 服务器上工作到本地 mac - 我尝试了上面的一些建议，但没有成功。重新启动，然后它工作。

它不是一个真正合适的解决方案，但我认为它可能会帮助那里的人。

# macos - TextMate 项目中的同名文件

> ID：685349
> 
> 赞同：2
> 
> 时间：2009-03-26T11:17:45.150
> 
> 标签：macos, textmate

关于 TextMate 困扰我的几件事之一是很难区分项目中共享相同名称的文件，例如：

[替代文字 http://img530.imageshack.us/img530/6791/bild1r.png](http://img530.imageshack.us/img530/6791/bild1r.png)

在这种情况下，右侧的文件位于项目相对路径 model/realtimemodel.py 中，而另一个文件包含该代码的单元测试。当然，您可以命令单击标题栏中的名称以查看目录列表，但感觉不是最理想的。我想要的是类似的东西：

[替代文字 http://img240.imageshack.us/img240/1783/bild3.png](http://img240.imageshack.us/img240/1783/bild3.png)

这可以让您快速一目了然地了解您正在处理的文件。有没有人见过任何使这成为可能的插件或捆绑包？

编辑：[这是](http://ticket.macromates.com/show?ticket_id=B3D5CCFC)Macromates 跟踪器中请求此功能的票证（尽管我更喜欢项目相对路径）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T12:00:48.773

这是一个开始：[http ://snipplr.com/view/11490/textmate-command-snippet--show-document-path-in-window-title/](http://snipplr.com/view/11490/textmate-command-snippet--show-document-path-in-window-title/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T12:27:58.973

我认为[vasi](https://stackoverflow.com/users/68780/vasi)的解决方案是最接近您想要的解决方案（为他 +1） ，所以即使可以，也无济于事。

我已经搜索了一个默认键（比如 Finder 中的那个，*_FXShowPosixPathInTitle*可以用

```
defaults write com.apple.finder _FXShowPosixPathInTitle -bool YES) 
```

但没有。这是Textmate[的可用键列表。](http://manual.macromates.com/en/expert_preferences.html)

也许您可以在某处编写功能请求，因为它非常有用且实施起来并不难。

# python - 使用 python 查询 wmi & win32.client 对象

> ID：685351
> 
> 赞同：2
> 
> 时间：2009-03-26T11:18:44.210
> 
> 标签：python, winapi

有人可以通过 wmi 和 win32.client 对象进行查询吗？

每当我尝试通过 win32.client 对象查询时，我都会收到此错误：

> *错误：“”对象没有属性“用户名”*

不过，我知道（wmic 类“Win32_ComputerSystem”、wmiexplorer 等）某些属性属于我要查询的对象：

```
import win32com.client
...
strComputer = "."
objWMIService = win32com.client.Dispatch("WbemScripting.SWbemLocator")
objSWbemServices = objWMIService.ConnectServer(strComputer,"root/cimv2")
colItems = objSWbemServices.ExecQuery("Select * from Win32_ComputerSystem")
for objItem in colItems:{
    print objItem.UserName    #Error: '' object has no attribute 'UserName'
}
... 
```

当我对 wmi 对象运行查询时 - 一切都很好：

```
import wmi
...
c = wmi.WMI()
for objItem in c.query(colItems):{
    print objItem.UserName  # this works now
}
... 
```

是什么导致了这个“无属性”错误？这可能是我的操作系统问题吗？运行winXP pro，2002版，sp2。或者这是因为我正在研究的 python 2.4 版本？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-10-17T17:41:19.333

要了解 WMI 查询结果中的“键”和“值”，可以使用“Properties_”

```
from win32com.client import Dispatch, GetObject import win32con
server = Dispatch("WbemScripting.SWbemLocator")
c = server.ConnectServer("localhost", "root\\cimv2") 
p = c.ExecQuery("Select * from Win32_OperatingSystem")

for i in w.p[0].Properties_:
    print i.Name, " = ", i.Value 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-03-01T20:15:58.647

尝试以这种方式访问​​ colItems 的属性：

```
对于 colItems[o].Properties_ 中的 objItem：
    打印 objItem.Name，objItem.Value

```

在其他情况下，您可能更喜欢使用

```
代表（objItem.Value） 

```

和

```
代表（objItem.Value） 

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T12:52:24.360

你为什么做这个？

```
for objItem in colItems:{
    print objItem.UserName    #Error: '' object has no attribute 'UserName'
} 
```

是什么让您认为结果列将是结果对象的属性？

试试这个来调试问题。

```
for objItem in colItems:{
    print dir(objItem)
} 
```

它有什么实际属性？也许列是由数字标识的？也许你应该这样做`objItem[0]`？

* * *

**编辑**

**是什么导致类“Win32_ComputerSystem”中的属性发生变化？？**

没有什么。属性不变。这门课不是你想的那样。

这是另一个调试帮助。

```
colItems = objSWbemServices.ExecQuery("Select * from Win32_ComputerSystem")
print type(colItems)
print dir(colItems) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-30T08:10:49.933

好的，这是另一段代码（来自[http://win32com.goermezer.de/content/view/211/189/](http://win32com.goermezer.de/content/view/211/189/)）：

```
import win32com.client
strComputer = "."
objWMIService = win32com.client.Dispatch("WbemScripting.SWbemLocator")
objSWbemServices = objWMIService.ConnectServer(strComputer,"root\cimv2")
colItems = objSWbemServices.ExecQuery("Select * from Win32_Environment")
for objItem in colItems:{
    print "Caption: ", objItem.Caption
    print "Description: ", objItem.Description
    print "Install Date: ", objItem.InstallDate
    print "Name: ", objItem.Name
    print "Status: ", objItem.Status
    print "System Variable: ", objItem.SystemVariable
    print "User Name: ", objItem.UserName
    print "Variable Value: ", objItem.VariableValue
} 
```

再次显示相同的错误：

```
Caption: Error: '' object has no attribute 'Caption' 
```

怎么了？为什么类与 ExecQuery 中指定的类不同？我的意思是，如果有人说“从 Win32_ComputerSystem 中选择 *”，它如何查询与 Win32_ComputerSystem 不同的类？

顺便说一句，我正在通过 spyce 2.0.3 服务器运行 python 2.4 代码。

ps我发现括号{}是正确解释python代码块的一种方法-否则会引发“预期缩进块”错误

# php - c 文件不是从 tsmarty2c.php 命令生成的

> ID：685363
> 
> 赞同：0
> 
> 时间：2009-03-26T11:24:49.953
> 
> 标签：php, internationalization, smarty, gettext

我正在使用 smarty gettext 插件来国际化 windows 上的 smarty 模板。但是当我运行命令 tsmarty2c.php 时，创建了 c 文件但字符串不在文件中。C 文件为空。

我正在使用 PHP 5.2.9 和 smarty gettext 插件版本是 v 1.1。感谢任何帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T11:42:07.713

它在标准输出上打印 C 代码。

你必须像这样使用它：

```
./tsmarty2c.php «template_file» > smarty.c 
```

# wpf - WPF：绑定 - 对象未更新

> ID：685366
> 
> 赞同：2
> 
> 时间：2009-03-26T11:27:23.643
> 
> 标签：wpf, data-binding

我有一个在窗口中设置为 DataContext 的对象。我在窗口中有绑定到对象属性的文本框。然而，在更新对象的属性之前似乎存在延迟。

```
<TextBox x:Name="txtPropertyOne" Text="{Binding Path=PropertyOne,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"  /> 
```

如果我更改了几个文本框中的值，然后快速尝试访问它们映射到的属性，有时会出现未反映在对象属性中的更改。我认为这是 PropertyChanged UpdateSourceTrigger 应该处理的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T11:46:03.210

> 如果我更改了几个文本框中的值，然后快速尝试访问它们映射到的属性

我可以用两种方式解释这句话：

1.  您正在尝试访问后台线程上的值。在这种情况下，您可能会在 UI 线程有机会执行其操作之前访问属性。
2.  您在 UI 线程上使用单独的消息来检查值。绑定以低于`Send`和的优先级更新`Normal`。因此，如果您的消息是优先级的`Send`，或者`Normal`它将在任何待处理的绑定更新之前被处理。

如果这不能回答您的问题，请澄清“快速尝试访问属性”的意思。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T11:52:45.190

WPF 数据绑定的基本规则很简单：

*   目标属性必须是依赖属性，您已经正确，它绑定到 TextBox 的 Text 属性。
*   源属性可以是 CLR 对象（任何派生的 WPF 的 DependencyObject 除外），但该对象必须使用或实现其自己的 INotifyPropertyChanged。

您是否已经在对象上实现了 INotifyPropertyChanged？

# regex - 如何使用正则表达式检查 UTC 格式的日期？

> ID：685377
> 
> 赞同：2
> 
> 时间：2009-03-26T11:32:11.793
> 
> 标签：regex, actionscript-3, datetime

如您所知，格式如下：

```
"YYYY-MM-DDTHH:NN:SS.ZZZ+XX:XX"  (i.e. "2009-03-24T16:24:32.057+01:00") 
```

我必须在 ActionScript3 类中执行此操作，但任何来源都将不胜感激，谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T11:37:20.640

```
\d{4}-[0-1]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-6]\d.\d{3}\+\d\d:\d\d 
```

或者类似的东西？

在 reg.ex 之后，对有效范围的更多检查可能会更好。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-05-09T16:00:39.870

Java 正则表达式，经过测试可以读取如下日期`"2001-12-15T07:30:40Z"`：

```
"^\\d{4}-[0-1][0-3]-[0-3]\\d{1}T[0-2]\\d{1}:[0-5]\\d{1}:[0-5]\\d{1}Z$" 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T12:31:26.547

看看这个相关的问题：

[Actionscript 3 - 将 yyyy-mm-dd hh:mm:ss 解析为 Date 对象的最快方法？](https://stackoverflow.com/questions/3163/actionscript-3-fastest-way-to-parse-yyyy-mm-dd-hhmmss-to-a-date-object)

接受的答案提供了一种将 UTC 时间字符串解析为`Date`对象的方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-07-24T11:20:31.603

遵循正则表达式非常适合任何 UTC 日期格式

```
"^(-?(?:[1-9][0-9]*)?[0-9]{4})-(1[0-2]|0[1-9])-(3[01]|0[1-9]|[12][0-9])T(2[0-3]|[01][0-9]):([0-5][0-9]):([0-5][0-9])(\\.[0-9]+)?(Z)?$" 
```

参考：[https ://www.regexpal.com/94925](https://www.regexpal.com/94925)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T11:37:39.487

正则表达式应该是这样的：

```
\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.\d{3}\+\d{2}:\d{2} 
```

# c# - 如何从包含通配符的目录路径中获取 c# 中的文件列表？

> ID：685378
> 
> 赞同：4
> 
> 时间：2009-03-26T11:32:13.103
> 
> 标签：c#, glob

给定路径 c:\someFolder\**\*.exe。如何使用此目录路径获取文件列表。我知道可以使用`Directory.GetFiles(directoryPath)`，但这仅在 directoryPath 中没有通配符时才有效。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T11:35:12.330

请参阅：[如何在 C# 中实现 glob](https://stackoverflow.com/questions/398518/how-to-implement-glob-in-c)

# sql - Oracle SQL*Loader 获取 CDATA 值

> ID：685381
> 
> 赞同：1
> 
> 时间：2009-03-26T11:33:09.653
> 
> 标签：sql, xml, oracle, loader, sql-loader

有人知道该怎么做吗？我知道有一种更好的方法可以在不使用 SQL*Loader 的情况下将 XML 数据加载到 Oracle，但我只是好奇如何使用它来完成。我已经有一个可以将 XML 数据加载到数据库的代码，但是，如果 XML 文件具有包含 CDATA 的值，它将不会运行...

**下面是控制文件代码，如果值不是 CDATA...**

```
LOAD DATA  
INFILE FRATS.xml "str '</ROW>'"  
APPEND  
INTO TABLE "FRATERNITIES"  
(  
    DUMMY FILLER TERMINATED BY "<ROW>",  
    THE_CODE SEQUENCE (MAX, 1),  
    DUMMY2 FILLER TERMINATED BY "</COLUMN>",  
    STORE_NN_KJ ENCLOSED BY '<COLUMN NAME="THE_NAME">' AND '</COLUMN>',  
    STAFF_COUNT ENCLOSED BY '<COLUMN NAME="THE_COUNT">' AND '</COLUMN>'  
) 
```

**这是 XML 文件：**
`<?xml version='1.0' encoding='MS932' ?>
<RESULTS>
<ROW>
<COLUMN NAME="THE_CODE">777</COLUMN>
<COLUMN NAME="THE_NAME">CharlieOscarDelta</COLUMN>
<COLUMN NAME="THE_COUNT">24</COLUMN>
</ROW>
</RESULTS>`

**这是带有 CDATA 值的 XML 文件。我的控制文件不会与它一起运行...：**
`<?xml version='1.0' encoding='MS932' ?>
<RESULTS>
<ROW>
<COLUMN NAME="THE_CODE"><![CDATA[777]]></COLUMN>
<COLUMN NAME="THE_NAME"><![CDATA[CharlieOscarDelta]]></COLUMN>
<COLUMN NAME="THE_COUNT"><![CDATA[24]]></COLUMN>
</ROW>
</RESULTS>`

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T18:55:08.530

你有没有尝试过

```
STORE_NN_KJ "substr(substr(:STORE_NN_KJ,instr(:STORE_NN_KJ,'<![CDATA[')+9),0,instr(substr(:STORE_NN_KJ,instr(:STORE_NN_KJ,'<![CDATA[')+9),']]>'))" ENCLOSED BY '<COLUMN NAME="THE_NAME">' AND '</COLUMN>' 
```

*编辑* 看起来我忘记了）..试试这个..

# wpf - WPF - 哪些内置控件实现了 ICommandSource？

> ID：685385
> 
> 赞同：0
> 
> 时间：2009-03-26T11:34:38.743
> 
> 标签：wpf, command

这是一个非常简单的问题，不是吗？

我只是在一个实现 ICommandSource 的控件的平面列表之后，..认为它会很有用，毫无疑问有人有这种信息。

提前致谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T11:39:20.527

根据反射器：`ButtonBase`、`MenuItem`和`Hyperlink`（`InputBinding`不是控制）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T11:44:26.880

试试这个代码片段：

```
 Assembly assem = Assembly.LoadFrom(@"C:\Program Files (x86)\Reference Assemblies\Microsoft\Framework\v3.0\PresentationFramework.dll");
        foreach (Type t in assem.GetTypes())
        {
            Type interfaceType = t.GetInterface("ICommandSource");
            if (interfaceType != null)
                Console.WriteLine(t.ToString());
        } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-02T17:12:50.650

如果您想扩展这个太短的列表，[这是一个很好的建议。](http://blogs.microsoft.co.il/blogs/tomershamam/archive/2009/04/14/wpf-commands-everywhere.aspx)

# flash - 您可以在 Flash 10 中播放 S3 签名的 url FLV 视频吗？

> ID：685395
> 
> 赞同：0
> 
> 时间：2009-03-26T11:37:11.467
> 
> 标签：flash, amazon-s3, flv, signature

我想将 FLV 视频从 S3 服务器加载到我的 Flash 应用程序中。原始文件需要受到保护（即权限设置为仅对经过身份验证的用户只读），因此将使用签名的 url 调用视频文件...我已设法将未签名的 url FLV 加载和播放到 Flash 应用程序中。

1）在潜水之前我应该​​注意什么问题？
2) 我需要使用 AS3 S3 库来生成签名吗？
3) 我可以在应用程序加载时（例如从 PHP）生成 1 个签名并将其发送到 Flash 以与它加载的每个 FLV 文件一起使用吗？
4) 图像和音频也将被加载到 Flash 应用程序中，并且也需要受到保护。

谢谢斯蒂芬

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T13:34:01.657

是的，您可以在 Flash 中播放签名的 url 没问题...

通过阅读，我设法回答了几个我自己的问题 -

1）是的很多！
2) 从 Flash 中对 url 进行签名不是一个好主意，因为密钥需要在 SWF 中或从 PHP 加载，因此这里可能存在安全风险。最好在服务器上调用 PHP 方法来生成签名的 url 并将文件返回到 Flash/返回文件的路径（sendAndLoad？）。但这似乎是一个可以以某种方式绕过的额外步骤！
3）仍然不确定这一点，但我认为签名过程涉及使用文件的路径，因此每个 url 的每个签名都是唯一的 - 这是正确的吗？

有人对此有进一步的建议吗？斯蒂芬

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-02T11:22:26.203

显然，我已经花费了无数个小时为我的网站尝试使用 MP3 文件。回答：

1）不要太复杂的任务。（尽管我的 Gazillion 小时）

2) 不要在 Flash 中对 URL 进行签名。使用托管 PHP 文件，您可以向该文件发出 AJAX 请求以获取签名 URL。为此，您的 S3 存储桶的目录结构必须具有一致的模式，使得文件位置在给定一些输入的情况下可以通过编程确定。

我不认为这是一个可以绕过的过程。URL 签名只能在服务器端完成，而不能在客户端完成。如果您想查看我的 AJAX 示例代码，请告诉我。我把它贴在这里给你

3）签名过程至少使用三个变量来创建签名 - 时间戳、文件位置（bucket/folder/floder/file）、S3 Secret Key。因此，对文件的每个请求都应具有单独的签名。签名 URL 的有效期应该非常有限（比如 10 秒）。能在这 10 秒内找到 URL 的用户应该能够下载该文件。

仅具有随时间戳而变化的签名可能会破坏（如果不是完全的话）具有签名 URL 的整个目的。

要签署 URL，请使用以下脚本。它就像魅力一样，如果我按时拿到它，我会节省很多时间。另请参阅下面的第 5 点以获得额外的安全性。

[http://www.richardpeacock.com/blog/2010/07/amazon-aws-s3-query-string-authentication-php](http://www.richardpeacock.com/blog/2010/07/amazon-aws-s3-query-string-authentication-php)

4) 出于某种原因，FLASH 播放器不播放 MP3 文件的签名 S3 URL。我认为（GUESS）一旦读取了 URL 中的 .mp3 扩展名，他们就会忽略 URL 的一部分。因此，播放器会忽略 URL 的查询字符串部分，并且无法读取文件。不过，他们在我的 S3 Bucker 中播放可公开复制的文件。我一直在为我的网站使用silverlight，而我非常绝望地使用了FLASH解决方案。如果那是受保护的 FLV 文件也无法播放的原因。在这种情况下，您将不得不将整个文件代理给您的客户端，仅使用 URL。我试图避免的解决方案。

5) 为进一步保护您的 URL，请使用以下链接中的一种或多种方法对其进行混淆。它们非常简单。

[http://www.pc-help.org/obscure.htm](http://www.pc-help.org/obscure.htm)

6) 此外，您的安全方法必须是在 URL 过期之前在浏览器上开始播放文件。到期时间段必须足够短以防止在到期前检测 URL，并且必须足够长以提供 enuf 延迟以开始播放。这或多或少是使用自过期 URL 进行合理安全流式传输的关键。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-02T12:04:43.673

回答您的具体问题

您需要注意的问题：我的第一个答案中的第4点；

需要 Amazon S3 库吗？：是的，但不是真的，我第一个答案中的第 3 点，链接中的脚本可以在不参考文档的情况下使用，但您需要了解亚马逊的签名方法

只需使用 1 个签名？：不推荐，无法使用签名的所有目的，可能不会，因为我认为签名强制使用文件路径和名称

音频和图像保护：所有保护都是合理的（假设您的最终用户没有时间或知识限制并且可以编写代码）。

图像：使用 Javascript 禁用右键单击，音频：可以通过一些修补来下载流，这会使您复杂化。

通过禁用 JavaScript 或从 JS Scratchpad / 控制台冲 JS 代码，当然可以下载图像。因此，即使检测 JS 是否启用也无助于保护图像。

# asp.net - VB.NET 中的强类型存储过程解析

> ID：685398
> 
> 赞同：1
> 
> 时间：2009-03-26T11:38:22.043
> 
> 标签：asp.net, vb.net, sql-server-2008

目前，我们`App_Code`通过返回所有数据库中的所有存储过程并将正确的参数类型和名称添加到一个`SqlCommand`对象，然后在一个巨大的类中返回它来生成类。这意味着我们可以做一些事情，比如`MyCmd.cmd.Parameters("MyParam").Value = "whatever"`当我们想要`SqlCommand`为存储过程传递参数时，不必在每次调用时都添加参数及其相关数据类型。这也意味着我们必须查找每个存储过程的公开参数，因为它们只是字符串。

从长远来看，对于您要在存储过程中处理的每个参数，您必须这样做：

```
cmd.Parameters.Add(New System.Data.SqlClient.SqlParameter("@Param", 3, 10, 1, False, CType(0, Byte), CType(0, Byte), "", System.Data.DataRowVersion.Current, Nothing)) 
```

这确实是不可取的，因为这意味着 Intranet/Internet 应用程序会爆发成数以亿计的代码行来完成非常简单的任务。

我们正在考虑以这样一种方式对其进行重构，以便我们可以`MyDatabase.MySproc.MyParam("value")`通过使其成为强类型来做类似的事情。不幸的是，这意味着我们的`App_Code`文件夹将是原来的两倍，因为需要大量的代码。

我写了一个简短的例子来说明我的意思：

```
Public Class MyProc

    Dim cmd As SqlCommand

    Public Sub New()
      ' uses the ConfigurationManager to get the connection string for a certain DB'
      Dim cmd As New SqlCommand("MyProc", GetSqlConnection())
    End Sub

    Public Sub Param1(ByVal param As String)
      cmd.Parameters.Add(New System.Data.SqlClient.SqlParameter("@Param1", 3, 10, 1, False, CType(0, Byte), CType(0, Byte), "", System.Data.DataRowVersion.Current, Nothing))
      cmd.Parameters("Param1").Value = param
    End Sub

    Public Sub Param2(ByVal param As String)
      cmd.Parameters.Add(New System.Data.SqlClient.SqlParameter("@Param2", 22, 7000, 1, False, CType(0, Byte), CType(0, Byte), "", System.Data.DataRowVersion.Current, Nothing))
      cmd.Parameters("Param1").Value = param
    End Sub

    Public Sub Param3(ByVal param As String)
      cmd.Parameters.Add(New System.Data.SqlClient.SqlParameter("@Param3", 3, 1, 1, False, CType(0, Byte), CType(0, Byte), "", System.Data.DataRowVersion.Current, Nothing))
      cmd.Parameters("Param3").Value = param
    End Sub

    Public Function GetReturnValue() As String
      cmd.Parameters.Add(New System.Data.SqlClient.SqlParameter("@RETURN_VALUE", 8, 0, 6, False, CType(0, Byte), CType(0, Byte), "", System.Data.DataRowVersion.Current, Nothing))
      Return cmd.Parameters("RETURN_VALUE").Value
    End Function
  End Class 
```

有没有我们不知道的替代方法？我确信这是许多开发跨/内联网应用程序的企业中的常见问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T11:45:38.017

为什么不使用 LINQ to SQL？即使您不想使用查询的东西，它也可以为您生成调用存储过程的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T11:56:50.780

或者[SubSonic](http://subsonicproject.com/)，它生成一个非常好的`SPs`静态类，其中每个 sproc 都是一个可调用函数并返回（我相信） a `DataTable`。

# entity-framework - 以“错误”的方向铸造实体框架实体

> ID：685403
> 
> 赞同：0
> 
> 时间：2009-03-26T11:41:12.457
> 
> 标签：entity-framework, inheritance

我正在使用实体框架，并且有一个带有基本实体（我们称之为客户）和派生实体的继承结构，我们称之为 AccountCustomer。不同之处在于 AccountCustomer 具有存储在数据库中单独表中的额外详细信息（例如付款条件等），因此在实体中具有额外属性。

我想允许用户将特定客户“提升”为 AccountCustomer。我需要保持相同的主键（用户可见的复合键并用作客户参考）。

目前我的感觉是调用存储过程在 Accounts 表中创建附加记录是唯一的方法，但到目前为止我们还没有绕过实体框架，所以如果可能的话，我们宁愿避免这种技术。

有没有人关注实体框架的解决方案？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T11:50:58.113

这是“请不要这样做”的场景之一。

您正在严格地根据表格而不是面向对象的术语来考虑这一点。

特定客户是特定客户。他是什么样的人永远不会改变。现在，他的状态可能会改变，或者他可能会获得额外的 AccountProperties，但他永远不会从一种事物（客户）转变为另一种事物（帐户客户）。它在概念上根本没有意义（普通水果不会变成苹果，是吗？不！它从一个具有一种状态的苹果开始，并以一个具有新状态的苹果结束），而且它肯定是在 .NET 面向对象编程中是不可能的......这将使得它在像 EF 这样的 ORM 中是不可能的。

因此，请考虑一种合理的方式来概念化这一点，这将导致以面向对象的术语表达这一点的合理方式，这将导致合理的 EF 解决方案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-06-04T15:18:25.607

I have solved this by a work-around.

*   Load all the related navigation properties of the base class, including itself

`var customer = db.Customers.Include("whatever dependince you have").FirstOrDefault(u=>u.UserId == userId);` //you can repeat this for all of your includes

*   Cache the navigation properties to local variables i.e. `var profile = customer.Profile;`
*   Delete the base class by `db.Customer.Remove(customer);`
*   Create the derrived class `var accountCustomer = new AccountCustomer();`
*   Set all of its properties and navigation properties from the base class i.e.

`accountCustomer.UserId = customer.UserId;`

`accountCustomer.Profile = profile; // do the same for all of the properties and navigation properties from the base class`

*   Add the new class back to the db

`this.Entry<T>(accountCustomer).State = EntityState.Added;`

*   Call `db.SaveChanges()`

That's it!

# c# - 如果异常是从 Microsoft 的代码中抛出的，我如何找出最初导致异常的原因？

> ID：685407
> 
> 赞同：4
> 
> 时间：2009-03-26T11:42:39.520
> 
> 标签：c#, .net, exception, datagridview, dockpanel

我有两个包含`DataGridView`s 的控件，位于`DockPanel`. 如果一个处于编辑模式并且我切换窗格，我会`NullReferenceException`从`DataGridView`'s`EndEdit()`方法中得到一个抛出。堆栈跟踪不会比这更深，并且异常不包含更多信息。

我已经在反射器中查看了该方法，但我看不到任何明显为空的东西。我怀疑问题实际上出在我的代码中，但是异常是从 Microsoft 的代码中重新抛出的，并且正在重置堆栈跟踪。如何找出最初导致异常的原因？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T11:44:58.297

如果您怀疑 MS 代码中存在错误，您可以从符号服务器下载调试符号，加载它们并在调试时跟踪它？[像这样](http://blogs.msdn.com/sburke/archive/2008/01/16/configuring-visual-studio-to-debug-net-framework-source-code.aspx)。

请注意，这些符号受各种许可证之一的约束。如果（例如）您从事“单一”贡献等工作，这可能会影响您。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T11:45:04.787

您是否查看过 InnerException 属性？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T12:11:56.097

按照说明设置 MS[符号服务器](http://msdn.microsoft.com/en-us/library/b8ttk8zy.aspx)和[源服务器](http://blogs.msdn.com/sburke/archive/2008/01/16/configuring-visual-studio-to-debug-net-framework-source-code.aspx)¹。将调试器设置为在抛出 NullReferenceException 时中断。然后，您将获得用于调试的完整源代码，或者至少获得完整的堆栈跟踪。

¹请注意，列出的 QFE 包含在 SP1 中。

# java - Java 中的泛型类（类型安全）相互依赖

> ID：685408
> 
> 赞同：1
> 
> 时间：2009-03-26T11:42:48.567
> 
> 标签：java, generics, types

我想创建一个抽象集合类（称为 Space）和一个抽象元素类（称为 Atom）。两者的实例必须相互了解（准确键入）。那就是问题所在。

```
abstract class Space<A extends Atom>{
  // ...
}

abstract class Atom<S extends Space>{
  // ...
} 
```

不好：

“A extends Atom”是指任何 Atom，但不是强类型的

“S 扩展空间”表示任何空间，但不是强类型空间

通过以下尝试，我也无法达到完整的类型安全：

```
abstract class Space<A extends Atom<? extends Space>>
abstract class Atom<S extends Space<? extends Atom>>

abstract class Space<S, A extends Atom<S extends Space<A>>>
abstract class Atom<A, S extends Space<A extends Atom<S>>>

and so on ... 
```

**请记住，这两个类是抽象的，我希望任何可能的两个子类都根据彼此进行类型化。** 这意味着，以下示例中的类 SomeSpace 和 SomeAtom 必须对彼此有很强的“类型知识”：

```
class SomeSpace extends Space<SomeAtom>
class SomeAtom extends Atom<SomeSpace> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T14:58:46.337

这对我有用，尽管我对所有这些通用约束感到非常困惑。这意味着我不能保证它会做它应该做的事情：

```
interface ISpace<S extends ISpace<S, A>, A extends IAtom<S, A>> {
        List<? extends IAtom<S, A>> getList(); //// CHANGED
}

interface IAtom<S extends ISpace<S, A>, A extends IAtom<S, A>> {
        S getSpace();
}

abstract class Space<S extends Space<S, A>, A extends Atom<S, A>>
                implements ISpace<S, A> {

        private final List<Atom<S, A>> atoms = new LinkedList<Atom<S, A>>(); ////CHANGED

        public Space() {
        }
        public Space<S, A> getSpace() {
                return this;
        }
        @Override
        public List<Atom<S, A>> getList() {  //// CHANGED
                return atoms;
        }
}

abstract class Atom<S extends Space<S, A>, A extends Atom<S, A>>
                implements IAtom<S, A> {

        private final S space;

        public Atom(S someSpace) {
                this.space = someSpace;
                space.getList().add(this);
        }

        @Override
        public S getSpace() {
                return space;
        }

        public Atom<S, A> getAtom() {
                return this;
        }
}

class Space1 extends Space<Space1, Atom1> {
        public Space1() {
        }
}

class Atom1 extends Atom<Space1, Atom1> {
        public Atom1(Space1 someSpace) {
                super(someSpace);
        }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T11:49:57.803

```
abstract class Space<S extends Space<S,A>, A extends Atom <A, S>> {}
abstract class Atom <A extends Atom <A,S>, S extends Space<S, A>> {} 
```

或者，我猜，如果你愿意

```
abstract class Space<S extends Space<S,A>, A extends Atom<S, A>> {}
abstract class Atom <S extends Space<S,A>, A extends Atom<S, A>> {} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T14:02:30.697

我不会尝试用泛型解决这个问题。相反，提供一个始终创建匹配对象的工厂。

```
class UniverseFactory {
    public Space getSpace();
    public Atom getAtom();
} 
```

然后，您可以在您的实现中执行类型检查，以确保仅使用匹配的对象。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T11:49:20.597

使 Java 中的参数化类型完全了解其实际具体类型的唯一方法是在构造时传入类型参数：

```
public Foo<T>(class<T> klass, // other parameters 
```

元答案是循环类型依赖是有问题的，并表明需要重新审视您的设计。通常，更好的解决方案是对第三种类型进行分层依赖：

```
public class SomeAtom extends Atom<Something>
public class SomeSpace extends Space<Something> 
```

元元答案是“类型安全”有其局限性，无论是什么语言：[http ://www.kdgregory.com/index.php?page=java.generics.cpp](http://www.kdgregory.com/index.php?page=java.generics.cpp)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T12:02:22.733

谢谢你，“Tom Hawtin - tackline”，我已经采纳了你的答案，它很合适。此外，以下代码演示了更改列表类型参数的（有点奇怪）必要性（如果您需要原子列表）

```
interface ISpace<S extends ISpace<S, A>, A extends IAtom<S, A>> {
    List<IAtom<? extends S, ? extends A>> getList();
}
interface IAtom<S extends ISpace<S, A>, A extends IAtom<S, A>> {
    S getSpace();
}

abstract class Space<S extends Space<S, A>, A extends Atom<S, A>>
    implements ISpace<S, A> {

    private final List<IAtom<? extends S, ? extends A>> atoms =
            new LinkedList<IAtom<? extends S, ? extends A>>();

    public Space() {
    }

    @Override
    public List<IAtom<? extends S, ? extends A>> getList() {
        return atoms;
    }
}

abstract class Atom<S extends Space<S, A>, A extends Atom<S, A>>
    implements IAtom<S, A> {

    private final S space;

    public Atom(S someSpace) {
        this.space = someSpace;

/// THIS WILL NOT WORK WITHOUT THOSE STRANGE LIST TYPE PARAMETERS
        space.getList().add(this);
    }

    @Override
    public S getSpace() {
        return space;
    }
}

class Space1 extends Space<Space1, Atom1> {
    public Space1() {
    }
}

class Atom1 extends Atom<Space1, Atom1> {
    public Atom1(Space1 someSpace) {
        super(someSpace);
    }
} 
```

整个事情背后的想法是：我需要安全地知道其容器类型的元素对象和安全地知道其元素类型的容器对象。

# sql - SQL如何让每个教授的两个最好的学生？

> ID：685419
> 
> 赞同：2
> 
> 时间：2009-03-26T11:46:39.947
> 
> 标签：sql, tsql

我有一个包含 3 个字段的表格，如下所示：

```
ProfessorID    StudentID    Mark
P1             S1              9
P1             S2              8
P1             S3             10
P2             S1              7
P2             S2              2
P2             S3              4
P3             S4              5
P4             S1              6 
```

一个教授可以教很多学生，反之亦然，一个学生可以向很多教授学习。当一个学生向教授学习时，他会得到他的分数。

我的问题是显示教授至少 2 名学生的教授名单，以及从这些教授那里获得最高分的 2 名学生。例如，该表的查询结果为：

```
ProfessorID    StudentID    Mark
P1             S1              9
P1             S3             10
P2             S1              7
P2             S3              4 
```

我尝试了一些解决方案，但它们不能正常**工作**。

我怎样才能正确地做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T12:34:32.767

```
declare  @table table (ProfessorID nvarchar(2), StudentID nvarchar(2),Mark int)

insert into @table
select 'P1', 'S1', 9
union all
select 'P1', 'S2', 8
union all
select 'P1', 'S3', 10
union all
select 'P2', 'S1', 7
union all
select 'P2', 'S2', 2
union all
select 'P2', 'S3', 4
union all
select 'P3', 'S4', 5
union all
select 'P4', 'S1', 6

select *
from @table o
where o.StudentID IN (select top 2 s.StudentID from @table s where s.ProfessorId = o.ProfessorId order by Mark DESC)
and o.ProfessorID IN (select p.ProfessorID from @table p group by p.ProfessorID having count(*) >= 2)
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T12:30:07.130

假设您希望在 SQL 2005（或 2008）中使用它，这也可以

```
select *
from
(
select *
    ,rank() over  (partition by professorid order by mark desc) as ranking
    ,(select count(distinct studentid) 
        from marks m2 
        where m2.professorid = m1.professorid 
        group by professorid
        ) as students
from marks m1
) subs
where ranking < 3
and students > 2 
```

-Edoode

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T12:37:36.610

我刚醒来......但这里是：

```
select *
FROM 
   (select professorID, count(distinct studentID) as studentsTaught
    FROM table
    ) s
WHERE s.studentsTaught = 2
UNION ALL    
SELECT top 2 *
FROM table
WHERE professorID IN (select professorID
                      FROM (
                            select professorID, count(distinct studentID) as studentsTaught
                            FROM table
                            ) s
                      )
WHERE s.studentsTaught = 2
ORDER BY mark 
```

应该工作......基本上你正在查询教授并将它们计为子查询，然后从该子查询中选择有 2 个学生的人。对于他们的学生，您必须联合他们并找到相同的教授，但 ORDER BY 足以获得两个最好的学生。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-26T12:05:30.590

```
SELECT ProfessorID, StudentID, MAX(Mark)
FROM table
GROUP BY ProfessorID, StudentID 
```

# firebird - 查找旧版 firebird/Interbase 数据库密码

> ID：685420
> 
> 赞同：4
> 
> 时间：2009-03-26T11:46:43.863
> 
> 标签：firebird, legacy, brute-force, interbase, forgot-password

我有一个客户有一个旧的不存在的应用程序；他与提出申请的公司有问题，他们不会透露他的数据库密码。他意识到他（当时）签署了一份合同，其中说他是在“租用”该应用程序，他们无权透露任何内容。这位客户发现他并不是唯一一个与该公司有同样问题的人。他是一名牙医，使用相同旧应用程序的其他牙医在尝试购买新软件并试图将他们的患者迁移到新系统时遇到了同样的问题。

无论哪种情况，他都想打开他的小火鸟数据库，这样我们至少可以将一些数据提取到我们的 SQL Server 中。我尝试使用默认的“masterkey”（实际上，由于 8 个字符的限制，“masterke”）无济于事。

现在我知道他可以合法化并试图强迫公司发布他的信息，但我想用捷径做。有人知道可以暴力破解/破解旧版 Firebird 密码的应用程序吗？

谢谢。

编辑：旧版软件是“STOMA-W”，我什至在互联网上都找不到。他们位于西班牙的阿斯图里亚斯。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-26T12:18:07.313

Firebird （还）没有将密码存储在数据库文件中。
考虑到这一点，将数据库文件移动到另一个已知 sysdba 密码的服务器。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-08-13T10:37:29.887

旧的 Interbase 和 Firebird 有硬编码的后门密码，您可能想尝试一下：

> 用户：政治通过：正确

[http://www.theregister.co.uk/2001/01/12/borland_interbase_backdoor_exposed](http://www.theregister.co.uk/2001/01/12/borland_interbase_backdoor_exposed)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-05-10T11:36:00.610

如果**不是 SYSDBA 帐户，您可以为使用**[FlameRobin](http://www.flamerobin.org/)的用户重置忘记的密码。在 localhost 上注册数据库服务器后，使用上下文菜单中的*Manage users...功能：*

[![使用火焰罗宾进入用户管理](https://i.stack.imgur.com/WSnxt.png)](https://i.stack.imgur.com/WSnxt.png)

在这里，您可以获得一个用户列表，其中包含删除或查看/修改属性的选项。如果单击属性图标，则进入此对话框，您只需输入两次新密码：

[![在此处输入图像描述](https://i.stack.imgur.com/7ezPs.png)](https://i.stack.imgur.com/7ezPs.png)

还有与 InterBase/Firebird SDK 一起打包的 IBConsole。它具有类似的功能。

# python - PyUnit: stop after first failing test?

> ID：685424
> 
> 赞同：18
> 
> 时间：2009-03-26T11:48:21.300
> 
> 标签：python, unit-testing

I'm using the following code in my testing framework:

```
testModules = ["test_foo", "test_bar"]

suite = unittest.TestLoader().loadTestsFromNames(testModules)
runner = unittest.TextTestRunner(sys.stdout, verbosity=2)
results = runner.run(suite)
return results.wasSuccessful() 
```

Is there a way to make the reporting (`runner.run`?) abort after the first failure to prevent excessive verbosity?

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2018-07-26T06:29:11.280

Nine years after the question was asked, this is still one of the top search results for "python unit test fail early" and, as I discovered when looking at the other search results, these answers are no longer correct for more recent versions of the unittest module.

The documentation for the unittest module [https://docs.python.org/3/library/unittest.html#command-line-options](https://docs.python.org/3/library/unittest.html#command-line-options) and [https://docs.python.org/2.7/library/unittest.html#command-line-options](https://docs.python.org/2.7/library/unittest.html#command-line-options) show that there is an argument, failfast=True, that can be added to unittest.main, or equivalently a command line option, -f, or --failfast, to stop the test run on the first error or failure. This option was added in version 2.7\. Using that option is a lot easier than the previously-necessary workarounds suggested in the other answers.

That is, simply change your

```
unittest.main() 
```

to

```
unittest.main(failfast=True) 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-26T12:12:55.517

It's a feature. If you want to override this, you'll need to subclass `TestCase` and/or `TestSuite` classes and override logic in the `run()` method.

P.S.: I think you have to subclass `unittest.TestCase` and override method `run()` in your class:

```
def run(self, result=None):
    if result is None: result = self.defaultTestResult()
    result.startTest(self)
    testMethod = getattr(self, self._testMethodName)
    try:
        try:
            self.setUp()
        except KeyboardInterrupt:
            raise
        except:
            result.addError(self, self._exc_info())
            return

        ok = False
        try:
            testMethod()
            ok = True
        except self.failureException:
            result.addFailure(self, self._exc_info())
            result.stop()
        except KeyboardInterrupt:
            raise
        except:
            result.addError(self, self._exc_info())
            result.stop()

        try:
            self.tearDown()
        except KeyboardInterrupt:
            raise
        except:
            result.addError(self, self._exc_info())
            ok = False
        if ok: result.addSuccess(self)
    finally:
        result.stopTest(self) 
```

(I've added two `result.stop()` calls to the default `run` definition).

Then you'll have to modify all your testcases to make them subclasses of this new class, instead of `unittest.TestCase`.

***WARNING***: I didn't test this code. :)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-27T15:44:25.643

Based on Eugene's guidance, I've come up with the following:

```
class TestCase(unittest.TestCase):  
    def run(self, result=None):
        if result.failures or result.errors:
            print "aborted"
        else:
            super(TestCase, self).run(result) 
```

While this works fairly well, it's a bit annoying that each individual test module has to define whether it wants to use this custom class or the default one (a command-line switch, similar to `py.test`'s `--exitfirst`, would be ideal)...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-07-13T07:36:25.710

Building on AnC's answer, this is what I'm using...

```
def aborting_run(self, result=None):
    if result.failures or result.errors:
        print "aborted"
    else:
        original_run(self, result)
original_run = unittest.TestCase.run
unittest.TestCase.run = aborting_run 
```

# iphone - Skpsmtpmessage：我应该为 gmail 使用哪个服务器

> ID：685428
> 
> 赞同：1
> 
> 时间：2009-03-26T11:49:54.167
> 
> 标签：iphone, email

我得到了这个项目“skpsmtpmessage”，我尝试先发送邮件。所以我把所有的邮件ID都改成了gmail id。但是重播主机是个问题。我试过 smtp.gmail.com、smtp.google.com、smtp.googletalk.com。但是当我运行我的程序时，我收到“无法连接服务器”的错误

我应该为 gmail 使用哪个中继主机。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T12:24:16.877

Gmail 的正确 SMTP 服务器是`smtp.gmail.com`，但我不知道如何进一步帮助您，这个问题很模糊。

您还可以查看在 iPhone 上使用 Gmail 的[配置说明](https://mail.google.com/support/bin/answer.py?answer=77702)，看看您是否在另一个参数上犯了错误。

# jquery - JQuery 选项卡式页面内容 - 只有第一页显示 sIFR（IE + Safari/PC 和 Safari/Mac）

> ID：685432
> 
> 赞同：0
> 
> 时间：2009-03-26T11:51:27.627
> 
> 标签：jquery, jquery-ui, sifr

我一直在想办法解决这个问题...

Firefox(PC/Mac) 一切正常，但 Safari (PC/mac) 和 3 个版本的 IE(6,7,8) 无法正常运行 - 请继续阅读...

上下文：我有一个带有 3 个备用内容的小选项卡式内容区域 - 它们每个都有 siFR 标题，具有完全相同的标记。我正在使用简单的 jQuery show() 和 hide()，第一个内容设置为默认显示。

问题：现在奇怪的是，在 IE6、7 + 8 和 PC 上的 safari 中，sIFR 是在默认内容上呈现的，而不是在其他选项卡式内容中呈现。

问题：这听起来对任何人来说都很熟悉吗？任何人都可以解释可能导致这种情况的原因吗？

非常感激任何的帮助！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T12:20:46.137

根据[这个讨论](http://discuss.joyent.com/viewtopic.php?id=23434)，sIFR 不会替换未显示的元素（即隐藏选项卡中的文本）。

解决方案是在选项卡更改时执行调用`sIFR.replace(...)`。

* * *

[jQuery UI 文档](http://docs.jquery.com/UI/API/1.7/Tabs#Why_does...)中提供了另一种解决方案。

# apache-flex - 设置尚未初始化的弹性控件的选择的最佳方法

> ID：685434
> 
> 赞同：1
> 
> 时间：2009-03-26T11:52:04.957
> 
> 标签：apache-flex, datagrid, controls, selection, asynchronous

为了说明 Q。我真的会过度简化示例（实际上代码更加复杂）。

假设您有一个 flex 控件，它下面包含一个数据网格。就像是

```
<mx:DataGrid id="grid" dataProvider="{document.items}">
    <mx:columns>
        <mx:DataGridColumn headerText="Column 1" dataField="@name"/>
        <mx:DataGridColumn headerText="Column 2" dataField="@value"/>
    </mx:columns>
</mx:DataGrid> 
```

其中 document 是一个模型对象，包含一些数据。您在控件上提供了一个选择设置器，因为客户端不想知道有关底层数据模型的任何信息：

```
public function set selectedItem(title:String):Allocation
{
   grid.selectedItem  = null;

   for each(var o:Object in grid.dataProvider)
   {
      var t:String = o.@title;
      if( t == title )
      {
         grid.selectedItem = o;
         return;
      }
   }
} 
```

到目前为止，一切都很好。如果预先填充了 document.items，则选择将正常工作。然而。如果您在应用程序*启动*时已经知道选择应该是什么 - 它已经（例如）在 URL 上传递，该怎么办？所以，在 flex 中你可能有类似的东西

```
// Initialising now...
mycontrol.document = this.document; // give the control the document

// Fetch titles
new FetchTitlesEvent().dispatch(); // cairngorm-style event

// Set the selection 
mycontrol.selectedItem = Application.application.parameters.title; 
```

**哎呀**。因为 FetchTitlesEvent 是异步操作的，当时 mycontrol.selectedItem 是无法工作的。不知何故，我们需要（重新）触发该代码以设置控件上的选择。现在，我有几种方法可以做到这一点，但都有代码气味：

1) 在获取完成后，在 FetchTitlesCommand 中执行此操作 - 这会污染需要知道这一点的视图（或视图*s ）的命令。*感觉就像一场等待发生的维护噩梦，这意味着视图完全绑定到命令，并且这些命令不可重用。布莱赫。

2）当它完成时从事件中回调（或者做一些复合命令，从 FetchTitlesEvent 开始，以一个新命令结束来做集合）。对我来说似乎很脆弱 - 维护者如何知道需要*哪些*回调？它仍然将 UI 控制知识绑定到命令中。坏事。

3）有某种计时器，等待事件队列静止几秒钟。骇客骇客。

4）在控制中进行。绑定到 document.items 上 mycontrol 中的 collectionevents，监视更改。一旦与选择匹配的行到达，选择它并停止监视更改。- 控制感觉是做这件事的正确地方 - 收集事件有时会引发令人兴奋的 CHANGE 或 REFRESH 事件 - 似乎是一个昂贵的监视器

我非常倾向于（4）。flex-ers 之前是否使用过任何其他选项来解决这个问题 - 特别是是否有任何我可能使用的库编入代码，因为它必须是一个相当通用的问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T14:44:42.453

您可以将`selectedItem`控件的属性设置为 Bindable Object 变量：

```
<mx:Script>
    <![CDATA[
        [Bindable]
        private var mySelectedItem:Object;
    ]]>
</mx:Script>

<mx:DataGrid id="grid" dataProvider="{document.items}" selectedItem="{mySelectedItem}">
    <mx:columns>
        <mx:DataGridColumn headerText="Column 1" dataField="@name"/>
        <mx:DataGridColumn headerText="Column 2" dataField="@value"/>
    </mx:columns>
</mx:DataGrid> 
```

这样就可以随时设置或重置 selectedItem，控件会根据 Object 更新 selectedItem。例如，您可以在初始化事件、创建完成事件或任何其他函数中设置处理程序。设置变量时，您可能需要在控件上调用 validateNow()，如果在初始化期间设置变量，则可能需要在控件的 creationComplete 上调用。

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" initialize="initializeHandler();">
    <mx:Script>
        <![CDATA[
            [Bindable]
            private var mySelectedItem:Object;

            private function initializeHandler():void
            {
                mySelectedItem = getSelectedItem(); // your logic to determine the initial item to select
            }

            ....

            private function grid_creationCompleteHandler():void
            {
                grid.validateNow();
            }
        ]]>
    </mx:Script>

    <mx:DataGrid id="grid" dataProvider="{document.items}" selectedItem="{mySelectedItem}" creationComplete="grid_creationCompleteHandler();">
        <mx:columns>
            <mx:DataGridColumn headerText="Column 1" dataField="@name"/>
            <mx:DataGridColumn headerText="Column 2" dataField="@value"/>
        </mx:columns>
    </mx:DataGrid>
</mx:Application> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T12:44:08.547

如果我正确理解您的问题，正确的方法是使用 creationComplete 事件。flex 中的所有 UI 对象都会广播一个 creationComplete 事件，让您知道一切何时完成并准备就绪。您可以在网格本身上侦听 creationComplete 事件，也可以在应用程序上侦听它，因为它不会广播，直到它的所有子项（即一切）都被创建为止。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T02:22:17.610

尝试使用 ChangeWatcher

```
var cw:ChangeWatcher = ChangeWather.watch(this, ["document","items"], 
function(e:Event):void
{
    //check to see if the data we want to select has arrived

    //once we've selected the data, we don't need this handler anymore
    cw.unwatch();
}); 
```

请原谅任何语法错误，我面前没有 FB。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T12:55:36.427

不幸的是，这不是一个创建完成的问题——问题不是控件的初始化，而是*数据*的初始化。由于它是异步的，因此您不知道它最终何时到达。

# linux - 由 Bash 脚本调用的已执行程序的跟踪

> ID：685435
> 
> 赞同：26
> 
> 时间：2009-03-26T11:52:13.820
> 
> 标签：linux, bash, scripting

脚本行为不端。我需要知道谁调用了那个脚本，谁调用了调用脚本，等等，只需要修改行为不端的脚本。

这类似于堆栈跟踪，但我对单个 bash 脚本中的函数调用调用堆栈*不感兴趣。*相反，我需要由我的脚本启动的已执行程序/脚本链。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-09-17T11:22:45.303

我几天前写的一个简单的脚本...

```
# FILE       : sctrace.sh
# LICENSE    : GPL v2.0 (only)
# PURPOSE    : print the recursive callers' list for a script
#              (sort of a process backtrace)
# USAGE      : [in a script] source sctrace.sh
#
# TESTED ON  :
# - Linux, x86 32-bit, Bash 3.2.39(1)-release

# REFERENCES:
# [1]: http://tldp.org/LDP/abs/html/internalvariables.html#PROCCID
# [2]: http://linux.die.net/man/5/proc
# [3]: http://linux.about.com/library/cmd/blcmdl1_tac.htm

#! /bin/bash

TRACE=""
CP=$$ # PID of the script itself [1]

while true # safe because "all starts with init..."
do
        CMDLINE=$(cat /proc/$CP/cmdline)
        PP=$(grep PPid /proc/$CP/status | awk '{ print $2; }') # [2]
        TRACE="$TRACE [$CP]:$CMDLINE\n"
        if [ "$CP" == "1" ]; then # we reach 'init' [PID 1] => backtrace end
                break
        fi
        CP=$PP
done
echo "Backtrace of '$0'"
echo -en "$TRACE" | tac | grep -n ":" # using tac to "print in reverse" [3] 
```

...和一个简单的测试。

![测试](https://i275.photobucket.com/albums/jj308/rejectedx/sctrace-example.png)

我希望你喜欢它。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2014-03-24T18:37:59.173

您可以使用 Bash 调试器[http://bashdb.sourceforge.net/](http://bashdb.sourceforge.net/)

或者，正如前面评论中提到的，`caller`内置 bash。见：[http ://wiki.bash-hackers.org/commands/builtin/caller](http://wiki.bash-hackers.org/commands/builtin/caller)

```
i=0; while caller $i ;do ((i++)) ;done 
```

或作为 bash 函数：

```
dump_stack(){
    local i=0
    local line_no
    local function_name
    local file_name
    while caller $i ;do ((i++)) ;done | while read line_no function_name file_name;do echo -e "\t$file_name:$line_no\t$function_name" ;done >&2
} 
```

另一种方法是更改​​ PS4 并启用 xtrace：

```
PS4='+$(date "+%F %T") ${FUNCNAME[0]}() $BASH_SOURCE:${BASH_LINENO[0]}+ '
set -o xtrace    # Comment this line to disable tracing. 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-26T14:42:52.253

```
~$ help caller
caller: caller [EXPR]
    Returns the context of the current subroutine call.

    Without EXPR, returns "$line $filename".  With EXPR,
    returns "$line $subroutine $filename"; this extra information
    can be used to provide a stack trace.

    The value of EXPR indicates how many call frames to go back before the
    current one; the top frame is frame 0. 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-26T12:04:03.183

既然你说你可以编辑脚本本身，只需输入：

```
ps -ef >/tmp/bash_stack_trace.$$ 
```

在其中，发生问题的地方。

这将在您的目录中创建许多文件`tmp`，显示发生时的整个进程列表。

然后，您可以通过检查此输出来确定哪个进程调用了哪个其他进程。这可以手动完成，也可以使用类似的东西自动完成`awk`，因为输出是常规的 -​​ 您只需使用这些`PID`和`PPID`列来计算您感兴趣的所有流程之间的关系。

您需要密切注意文件，因为每个进程都会获得一个文件，因此可能必须对其进行管理。由于这仅应在调试期间完成，因此大多数情况下该行将被注释掉（前面带有`#`），因此不会创建文件。

要清理它们，您可以简单地执行以下操作：

```
rm /tmp/bash_stack_trace.* 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-09-18T13:47:24.113

**更新：** 下面的代码应该可以工作。现在我有了一个[更新的答案](https://stackoverflow.com/a/17734099/520567)，它有一个更新的代码版本，允许在堆栈跟踪中插入一条消息。

IIRC我当时只是找不到这个答案来更新它。但是现在决定的代码最好保存在 git 中，所以上面的最新版本应该在这个[gist](https://gist.github.com/akostadinov/33bb2606afe1b334169dfbf202991d36)中。

**下面的原始代码更正答案：**

在某处还有另一个答案，但这里有一个函数用于获取堆栈跟踪，例如在 java 编程语言中使用的意义。您调用该函数，它将堆栈跟踪放入变量 $STACK。它显示导致`get_stack`被调用的代码点。这对于单个 shell 来源多个脚本片段和嵌套的复杂执行非常有用。

```
function get_stack () {
   STACK=""
   # to avoid noise we start with 1 to skip get_stack caller
   local i
   local stack_size=${#FUNCNAME[@]}
   for (( i=1; i<$stack_size ; i++ )); do
      local func="${FUNCNAME[$i]}"
      [ x$func = x ] && func=MAIN
      local linen="${BASH_LINENO[(( i - 1 ))]}"
      local src="${BASH_SOURCE[$i]}"
      [ x"$src" = x ] && src=non_file_source

      STACK+=$'\n'"   "$func" "$src" "$linen
   done
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-26T13:39:33.327

在脚本中添加 pstree -p -u `whoami` >>output 可能会为您提供所需的信息。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-04-30T14:59:23.057

最简单的脚本返回所有调用者的堆栈跟踪：

```
i=0; while caller $i ;do ((i++)) ;done 
```

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2009-03-26T15:24:09.817

你可以尝试类似的东西

```
strace -f -e execve script.sh 
```

# c# - 如何在 C# 中使用 & 运算符？代码的翻译是否正确？

> ID：685436
> 
> 赞同：3
> 
> 时间：2009-03-26T11:52:17.187
> 
> 标签：c#, operators, bitwise-operators, conditional-statements

C++ 中的“if(arg2 & 1)”行（arg2 是 DWORD）等于 C#（arg2 是 Uint32）中的“if(arg2 & 1==0)”，对吗？

我正在尝试将函数从 C++ 转换为 C#，但出现错误：

```
Operator '&' cannot be applied to operands of type 'uint' and 'bool' 
```

如果您能在整个函数中进一步了解任何其他错误，我也将不胜感激。

C++

```
DWORD Func_X_4(DWORD arg1, DWORD arg2, DWORD arg3)
{
LARGE_INTEGER result = {1, 0};
LARGE_INTEGER temp1 = {0};
LARGE_INTEGER temp2 = {0};
LARGE_INTEGER temp3 = {0};
LARGE_INTEGER temp4 = {0};
for(int x = 0; x < 32; ++x)
{
    if(arg2 & 1)
    {
        temp1.LowPart = arg3;
        temp1.HighPart = 0;
        temp2.QuadPart = temp1.QuadPart * result.QuadPart;
        temp3.LowPart = arg1;
        temp3.HighPart = 0;
        temp4.QuadPart = temp2.QuadPart % temp3.QuadPart;
        result.QuadPart = temp4.QuadPart;
    }
    arg2 >>= 1;
    temp1.LowPart = arg3;
    temp1.HighPart = 0;
    temp1.QuadPart *= temp1.QuadPart;
    temp2.LowPart = arg1;
    temp2.HighPart = 0;
    temp3.QuadPart = temp1.QuadPart % temp2.QuadPart;
    arg3 = temp3.LowPart;
    if(!arg2)
        break;
}
return result.LowPart;
} 
```

转换为 C#

LARGE_INTEGER 结构：

```
[StructLayout(LayoutKind.Explicit, Size = 8)]
public struct LARGE_INTEGER
{
    [FieldOffset(0)]
    public Int64 QuadPart;
    [FieldOffset(0)]
    public UInt32 LowPart;
    [FieldOffset(4)]
    public Int32 HighPart;
} 
```

功能：

```
public static UInt32 X4(UInt32 arg1, UInt32 arg2, UInt32 arg3)
    {
        LARGE_INTEGER result = new LARGE_INTEGER();
        result.LowPart = 1;
        result.HighPart = 0;
        LARGE_INTEGER temp1 = new LARGE_INTEGER();
        LARGE_INTEGER temp2 = new LARGE_INTEGER();
        LARGE_INTEGER temp3 = new LARGE_INTEGER();
        LARGE_INTEGER temp4 = new LARGE_INTEGER();
        for (int x = 0; x < 32; ++x)
        {
            if (arg1 & 1 ==0)
            {
                temp1.LowPart = arg3;
                temp1.HighPart = 0;
                temp2.QuadPart = temp1.QuadPart * result.QuadPart;
                temp3.LowPart = arg1;
                temp3.HighPart = 0;
                temp4.QuadPart = temp2.QuadPart % temp3.QuadPart;
                result.QuadPart = temp4.QuadPart;
            }
            arg2 >>= 1;
            temp1.LowPart = arg3;
            temp1.HighPart = 0;
            temp1.QuadPart *= temp1.QuadPart;
            temp2.LowPart = arg1;
            temp2.HighPart = 0;
            temp3.QuadPart = temp1.QuadPart % temp2.QuadPart;
            arg3 = temp3.LowPart;
            if (arg2==0)
                break;
        }
        return result.LowPart;
    } 
```

这是我还不确定的：

1.  C++ 中的 DWORD 是 C# 中的 UInt32 还是 Int32？
2.  if(integer & integer) 表示 if(integer and integer ==0)？//这是我上面描述的错误所在的地方。
3.  if(!integer) 表示 if(integer != 0)？
4.  为什么运算符 & 不能在 C# 中逻辑使用，这意味着它需要一个布尔值？
5.  "LARGE_INTEGER 结果 = {1, 0}" 表示 result.lowpart 为 1 且 result.highpart 为 0 或 result.Quadpart = 1？

提前致谢！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-26T11:54:27.963

你写的地方：

如果 (arg1 & arg2==0)

编译器理解：

```
if (arg1 & (arg2==0)) 
```

你应该写：

```
if ((arg1 & arg2) == 0) 
```

这是应该将 C++ 语句转换为 C# 的方式：

```
if (arg2 & 1) // C++ (arg2 is DWORD)
if ((arg2 & 1) != 0) // C# (arg2 is Uint32) 
```

或者，以更通用的方式：

```
if (Flags & FlagToCheck) // C++
if ((Flags & FlagToCheck) != 0) // C# 
```

* * *

在 C/C++ 中，0 为假，其他一切为真。

1.  您应该检查 DWORD 的定义，它应该是 (unsigned int)，在 C# 中是 UInt32
2.  if (integer & integer)，在 C/C++ 中的意思是“如果按位和两个整数之间的结果不为 0”（0 为假，其他一切为真）。
3.  if (!integer) 表示 if (integer == 0) （同样，0 为假，其他一切为真）
4.  在 C# 中，就像在 Java 中一样，我认为布尔值和数字是两个不同的东西，你只能在“if”语句中使用布尔值，如果你使用 int 则没有隐式转换：它不会编译。
5.  我会把这个留给别人，我需要测试以确保...

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-26T11:57:44.773

1.  `DWORD`在`uint32_t`C++ 中，因此`UInt32`在 C# 中。
2.  `if(a & b)`转换为`if((a & b) != 0)`. `!=`被评估，`&`因此`&`表达式需要括号括起来。
3.  `if(x)`转换为`if(x != 0)`
4.  `&`在 C# 中是“按位与”，就像在 C++ 中一样。
5.  取决于您的 C++ 结构。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T12:12:23.037

5 - 这意味着两者。因为 LowPart 和 HighPart 只是进入 QuadPart 内存的“窗口”，所以当 result.LowPart == 1 且 Result.HighPart == 0 时，result.QuadPart 将等于 1。

# c++ - “多重定义”C++编译器错误

> ID：685439
> 
> 赞同：15
> 
> 时间：2009-03-26T11:53:37.340
> 
> 标签：c++, linker

我似乎无法在我的一门课程中摆脱这些看似随机的编译错误。我收到大约 4 个错误，例如：

```
multiple definition of `draw_line(float, float, float, float)' 
```

和

```
multiple definition of `near_far_clip(float, float, float*, float*, float*, float*, float*, float*)' 
```

在方法中间标记的。

我也一直`multiple definition of `stack'`处于另一种方法的中间。`stack`是完全不同文件中的全局变量。我收到错误的文件中甚至都没有提到它。

我尝试将容易出错的文件分成 .h 和 .cpp 文件（最初只是一个 .cpp），但没有任何关于错误的改变......

我没有重复的方法。我只有一个lines.h，并且开头`#include`有一个子句。`#ifndef`所有这些错误都出现在 .cpp 文件中。

有什么想法吗？

好吧，我得到了代码：

*   [线.cpp](http://code.bulix.org/wrmmiw-70109)
*   [ThreeD.cpp](http://code.bulix.org/l2milw-70110)
*   [3D.h](http://code.bulix.org/e50rga-70111)
*   [生成文件](http://code.bulix.org/3ctuqy-70112)

lines.cpp 是我从导师那里收到的转换后的 .c 文件。我包含了 makefile 以防万一，因为我总是遇到问题。我还准确地注释了文件中错误标记的位置，但它们看起来很随机，所以我不知道它是否特别重要。我放弃了 .h 文件，因为它没有解决任何问题或提供帮助。我相信没有它会更容易找到错误。

这是请求的[main.cpp 文件](http://code.bulix.org/9img79-70113)（没有 .h）。

* * *

我重新制作了lines.h文件，因为我仍然收到：

```
multiple definition of `draw_line(float, float, float, float)' 
```

和

```
multiple definition of `near_far_clip(float, float, float*, float*, float*, float*, float*, float*)' 
```

lines.cpp 文件中的错误，但该`multiple definition of `stack'`错误现在位于 ThreeD.cpp 文件中的随机位置（并且现在由注释标记）。**更新：**此错误已得到修复，文件已修改为显示：

*   [线.h](http://code.bulix.org/pl0ha3-70114)
*   [线.cpp](http://code.bulix.org/en2iiq-70124)
*   [ThreeD.cpp](http://code.bulix.org/ec1l4c-70125)
*   [3D.h](http://code.bulix.org/cm691a-70117)

我搞砸了一些全局变量 extern 的标签，但它似乎没有影响任何东西。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-03-26T12:02:34.887

您可能会在头文件中包含函数定义。包括`inline`关键字，这样它们就不会被每个目标文件导出。或者，将函数放在它们自己的`.cpp`文件中。

对于全局变量，您需要`extern`在头文件中使用关键字。否则，每个目标文件都会导出自己的变量，并且链接器会混淆哪个是正确的使用。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-03-26T13:13:52.577

为什么要在 ThreeD.cpp 中 #includelines.cpp？这是非常不寻常的。

你的makefile 需要lines.o，所以你要编译lines.cpp。在lines.cpp 中定义的任何内容都将在lines.o 和ThreeD.o 中。

在lines.cpp 中有一个有趣的评论：

```
Don't forget to put declarations in your .h files. 
```

我认为讲师希望您将lines.cpp 分解为.h 和.cpp。

摘自lines.cpp：

```
/* These go in your .h file or in lines.h */
/*

Line drawing header.

*/

void draw_line(float, float, float, float);
int near_far_clip(float, float, float *, float *, float *, float *,
                  float *, float *); 
```

我怀疑这两个声明是应该在lines.h 中的唯一内容。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-26T12:02:07.210

请发布一些代码片段。也许你在类声明和外部定义你的方法？

```
class X {
    void foo();    // No definition, just declaration
    void bar() {}  // Declaration + definition
};

void X::foo() {}    // First Definition, OK
void X::bar() {}    // Already defined, ERROR 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-26T12:05:21.353

检查包括拼写错误的警卫。
检查您的制作选项，也许有人编译成多个目标文件。
尝试排除部分文件和代码，直到找不到错误原因。

**已编辑：**
修复包含 *.cpp 文件。它们应该是链接的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-26T12:22:43.370

如前所述 - 没有足够的信息在这里正确诊断。

但是，如果`draw_line`et al 是在头文件中而不是在源 (cpp) 文件中定义的，那么您可能有一些在头文件中被声明为内联的方法，而这些方法实际上并没有正确内联。在这种情况下，每个包含头文件的 .cpp 文件都将生成自己的`draw_line`函数定义，并在链接时生成警告。

如果您使用来自已被遗忘或删除的系统标头的#defined INLINE 宏，并且无论出于何种原因，INLINE 都被预处理为空，则可能会发生这种情况。

例如：

```
//Lines.h

#define GCCC //Note the typo

#if defined(GCC)
#define INLINE inline
#elif defined (MSVC)
#define INLINE __inline
#else

#define INLINE //Due to the typo, INLINE will be turned into nothing
#endif

INLINE void draw_line(float x1, float y1, float x2, float y2)
{
   //Draw the line
}

//File1.cpp
#include "lines.h" //will define draw_line

//File2.cpp
#include "lines.h" //will also define draw_line 
```

并且链接 File1.cpp 和 File2.cpp 会产生多个声明错误

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2016-08-15T15:13:15.570

```
#ifndef THREED_H_
#define THREED_H_
#endif /* THREED_H_ */ 
```

删除或评论这些行，这对我有用

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-26T12:02:07.507

多个定义错误是链接器错误，但如果没有更多信息，就很难诊断它们。检查同一个文件在链接器命令中没有出现两次，并且你的头文件只包含声明，没有定义。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-26T12:02:09.597

没有看到代码真的没有帮助你。编译器清楚地声称与您相反（至少有一个重复的定义）*。*

尝试用一个最小的例子重现错误。您是否尝试过在命令行中在 Eclipse 之外编译代码？结果是什么？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-09T02:46:55.197

*嗨，我在这里看到的基本规则适用于 ll。我将解释这些错误是如何工作的，以及这些错误是如何发生的：让我们举一个* **“制作全局变量”的例子**

**不要混淆头文件，对于 cpp 文件。标头仅用于允许多个文件项目在链接之前具有通用接口。**

1.列表项

您应该在标题中提供有关全局变量的信息：

外部 int Var_Global;

2.  项目清单

    ```
    while keeping the Actual code in the
    cpp :

    int Var_Global; 
    ```

并确保您 1\. 包含标题，以及 2\. 链接代码。

链接代码一次，并且只有一次，并且只有一个数据副本，但是您可以整天包含标题，这告诉其他代码在链接时会有数据副本。

我看到很多人将代码放在头文件中，虽然这在某些情况下可能有效，但这是一个坏习惯，迟早会导致问题。

问候，

普拉尚塔

# google-app-engine - smtp 将标头作为内容发送

> ID：685443
> 
> 赞同：0
> 
> 时间：2009-03-26T11:54:30.677
> 
> 标签：google-app-engine, smtp

我正在使用远程 smtp 服务器（来自我的主机公司）并从本地计算机发送电子邮件。（谷歌应用程序开发服务器）但是我收到的电子邮件没有收到很好的电子邮件，而是包含标题的电子邮件，就好像它知道电子邮件的内容一样可以做些什么来改变它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T12:52:25.843

我的猜测是您的主题中有换行符（\r\n 或回车 - 换行符）。而且，您的邮件程序不会删除主题中的换行符。

如果您在主题中添加了换行符，并且您的应用程序没有删除它，您只需将所有后续标题移到正文中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T12:01:32.063

根据 SMTP RFC 发送电子邮件：[https ://www.rfc-editor.org/rfc/rfc5321](https://www.rfc-editor.org/rfc/rfc5321)

获取内容中的标头听起来像是您发送了两次，或者确实以您的邮件客户端无法理解的方式将标头与内容分开。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T12:01:47.027

检查您在另一层电子邮件中没有包装您发送的内容。

也许查看当前（真实/外部）标题，看看是否提供任何线索。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-03T14:05:56.647

你能告诉我们你的代码吗？你没有说你正在使用哪个 App Engine 运行时；我将假设 Python。App Engine 邮件 API 不允许您直接设置邮件标头。您可以[在此处](http://code.google.com/appengine/docs/python/mail/emailmessagefields.html)设置属性列表。

# command-line - 通过 SAS autoexec (Base SAS) 在应用程序工具栏上创建图标

> ID：685454
> 
> 赞同：1
> 
> 时间：2009-03-26T11:58:39.107
> 
> 标签：command-line, sas

我想知道是否可以（如果可以）通过 SAS 脚本将按钮添加到 SAS 应用程序工具栏。

例如，我有一个通过命令行提交“signoff”的按钮，并希望通过我们共享的 autoexec 将其分发给团队的其他成员。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T13:04:56.327

将包含新工具栏项目的目录保存在每个人都可以访问的地方。在您的 autoexec 中，为包含已保存目录的文件夹创建一个 libname。然后在 autoexec 文件中使用此命令（将 libname 和工具栏名称替换为您的具体详细信息）：

```
dm "toolload bar <libname>.profile.<name_of_toolbar>"; 
```

# c# - 提高性能 Linq to Sql Compact Edition

> ID：685456
> 
> 赞同：1
> 
> 时间：2009-03-26T12:00:27.573
> 
> 标签：c#, performance, linq-to-sql, optimization, sql-server-ce

我正在编写一个 WPF 客户端应用程序，使用带有 Sql Compact 版本的 Linq to Sql。db 相对较小 (3MB) 并且是只读的。

底线是性能不如我希望的那么好，我正在寻找提高性能的技巧和实用方法。

更多事实：该模式包含大约十几个实体，它们之间具有广泛的关系。

分析应用程序发现查询运行得非常快，但构建 c# 实体是花费最多时间的过程（可能长达 8 秒）。大多数情况下，我相信是因为我们使用了 LoadWith，而 DataContext 别无选择，只能在内存中构建对象图。

如果需要，我可以提供更多信息。

编辑：

1.  正如我提到的，数据库是只读的，因此 DataContext 不跟踪更改。
2.  我们正在对重复查询使用静态查询。问题是当应用程序初始化时，我们将许多对象预取到内存中作为缓存。

谢谢你的帮助。

爱丽儿

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T12:07:03.253

好吧，您可能会发现使用延迟加载（而不是急切加载）可能有助于提高性能（即避免使用 LoadWith），因为实体不需要为关系链分配内存（或对象图的深度加载）相反，它们将按需填充。

但是，您需要专注于您的设计以支持这一点（否则，您将简单地将性能瓶颈转移到针对 SQL CE 数据库执行的 SQL 语句方面变得过于“喋喋不休”。

DataContext 在跟踪更改时也可能开始膨胀（内存）。您可能需要考虑如何使用数据上下文的方法（例如，您可以将它们附加到新上下文，前提是原始上下文已被释放）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T13:16:49.247

一个非常简单的解决方案是使用静态声明的编译 linq 查询。这当然不是那么实用，但它会提高性能，因为表达式树只需要在编译时构建一次，而不是在每次调用查询执行时动态创建。

这可能会有所帮助：

[http://msmvps.com/blogs/omar/archive/2008/10/27/solving-common-problems-with-compiled-queries-in-linq-to-sql-for-high-demand-asp-net-网站.aspx](http://msmvps.com/blogs/omar/archive/2008/10/27/solving-common-problems-with-compiled-queries-in-linq-to-sql-for-high-demand-asp-net-websites.aspx)

# dns - 编程中的非英语域名问题

> ID：685468
> 
> 赞同：9
> 
> 时间：2009-03-26T12:02:41.453
> 
> 标签：dns, naming, non-english

我想大多数编程代码都是用英语编写的。但我很好奇人们如何处理这里的命名问题。许多编程是在某些业务领域内完成的，通常对某些程序、项目使用完善的术语。

例如，我来自丹麦，我经常使用的东西有一个叫做“indblikskode”的术语，可以翻译成“洞察代码”。那么，我是否在 C# 代码中使用“string indblikskode = ...”行来处理与此相关的一些 Web 服务？还是我尝试使用翻译，例如“insightcode”？我所从事的业务在其语言中甚至不一致，例如使用术语“organisatorisk enhed”（组织单位），但经常使用缩写“OU”，这显然是英语的缩写。

其他人如何处理这个命名问题，同时保持一致和理智（从代码中的简单变量名称到数据库表，再到服务器名称）？

重复：

*   [标识符和注释应该始终使用英语还是应用程序和开发人员的母语？](https://stackoverflow.com/questions/440052)
*   [您是否使用其他语言而不是英语？](https://stackoverflow.com/questions/250824)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-26T12:07:21.223

我只能为自己说话，但在命名类和变量时，我总是将术语翻译成英文，这也是我们不成文的最佳编码实践之一。你永远不知道什么时候你可能需要将开发工作交给更便宜的国外劳动力或城里的专家外籍顾问。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T13:03:14.397

类和函数的非英语命名的问题是，你总是会以 macaronic pidgin 结尾。关键字是英文的，命名约定（例如 getter/setter）也是英文的，设计模式的标准名称也是如此。

你最终会得到类似的东西：

```
OrganisatoriskEnhedFactory::getInstance()->getIndblikskode(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T12:07:50.520

在瑞士（德国方面，即苏黎世）工作并在德国生活了一段时间，我可以告诉你，我还没有看到代码不是英文的环境。当然，该应用程序很可能是德语（但许多专业环境都是说英语的），但代码（我见过）几乎都是英语。

很难用其他语言编写代码。一方面，API（几乎）都是英文的。例如，Java 使用 JavaBeans 命名，因此无论如何您都必须使用 set 和 get，而“getGeburtstag”只是与“getDateOfBirth”没有完全相同的环。

其他国家可能会有所不同，因为这是我在日耳曼国家的经验。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T12:12:29.480

我们通常使用既定的英语术语（我们的业务领域*通常*有英语术语），但如果我找不到合适的术语，我也可以使用芬兰语。哎呀，即使我们在代码中的注释也是混合语言的......

当然，明智的做法很大程度上取决于源代码是否会在建筑物外使用。在一个小商店里，这没什么大不了的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T12:16:00.173

我在奥地利的一家公司工作（所以我们说的是德语），我们正在用英语编程（变量名、域对象、GUI）。让它有点麻烦，因为你必须找到英文翻译，你必须在发布程序之前翻译 GUI。我不确定所有的名字是否真的正确。

相比之下，在我工作的前公司，我的程序是严格用德语编写的。这非常好（尽管德语单词往往比英语单词长）。几年后，该公司想在美国使用相同的程序，所以说英语的程序员不得不使用相同的代码库。在这之后，一切都变得非常不一致-变量，数据库字段..两种语言（说英语的团队成员不会说德语）。

我的经验是，在应用程序的早期（当你用英文编写程序时，你不得不这样做）处理国际化比较容易，因为本地化一个 10000 LOC 的应用程序并没有什么好玩的。用另一种语言写作的优势在于，您可以立即看到哪些是本地化的，哪些不是本地化的——尽管您必须考虑到这一点。

对于无法翻译的词：我们还没有体验过 - 尽管找到“社区内交付”的英文短语（这是欧盟的事情）是一些工作。但如果发生这种情况，我很确定我们会使用德语单词。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-26T12:39:50.647

我在德国生活和工作，但只写英文代码。它使事情变得更容易。如果您想提出问题或发布有关您的工作的教程，您可以在网上发布您的代码。

此外，代码对我来说看起来更“专业”。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-26T12:57:39.183

[在这里](https://stackoverflow.com/questions/440052/should-identifiers-and-comments-be-always-in-english-or-in-the-native-language-of)查看我的问题和答案。

基本上它取决于您的组织和应用程序。如果您的公司、开发人员和客户都说相同的母语，并且您希望它保持这种状态，那么让每个人都成为兼职翻译将适得其反。纯粹假设的未来优势会导致相当大的生产力损失。雅尼。

如果它是一家大型国际公司，或者如果有具体的国际扩张计划或在海外完成一些工作，那当然是另一回事了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-26T13:08:46.677

我现在也在德国生活和工作，除了一些旧的德语评论外，我们主要使用英语。我认为非英语评论通常是非常糟糕的主意，因为您必须花时间尝试理解它（并正确理解）。虽然德语和英语都不是我的母语，但用非英语编写的代码似乎很奇怪。

你永远不会知道第二天谁会处理你的代码。所以你应该使用通用的 IT 语言。

PS 由于我不喜欢在我的开发环境中使用非英语语言，当我拒绝我的电脑安装德文 Windows、德文 Office 和德文 Visual Studio 时，我让当地管理员非常生气。我花了好几个小时才下载英文版。

虽然我认为安装一个语言包或只是为了学习术语而安装相同软件的不同副本是一件好事。法语的 SQL Management Studio 让我非常兴奋，就像我尝试将 Skype 切换到西班牙语时一样。

# .net - 使用 RSA 加密的加密数据大小 (RSACryptoServiceProvider)

> ID：685470
> 
> 赞同：3
> 
> 时间：2009-03-26T12:03:42.963
> 
> 标签：.net, encryption, cryptography, rsa

我需要在我正在进行的一个项目中使用一些加密机制。我正在探索 RSA 加密并编写了一些示例程序来学习。

我了解 RSA 加密的块大小为 16 个字节。因此，我将字符串“12345678”作为以下函数的输入：

```
公共静态字符串加密（字符串输入）{
    var byteConverter = new UnicodeEncoding ();

    RSACryptoServiceProvider cruptoEngine = new RSACryptoServiceProvider();
    byte[] output = cruptoEngine.Encrypt (byteConverter.GetBytes (input), false);
    返回 BytesToString（输出）；//BytesToString() 将字节转换为十六进制字符串
}

```

现在我得到的加密字符串是 128 个字节（256 个十六进制字符）。这个字符串对我来说太大了。我有点希望如果我提供 16 字节的纯数据，我会得到 16 字节的加密数据。难道我做错了什么？这是应该发生的事情吗？我可以以某种方式缩短加密数据吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-27T07:17:42.693

你误会了。RSA 不是块密码，所以你不能真正谈论它的块大小。

RSA 加密的输出将具有与 RSA 模数相同的长度。您没有在代码中指定任何 RSA 密钥，因此运行时将（据我记得）使用默认密钥。该密钥显然具有 1024 位模数，它解释了输出长度。

您可能想改为研究 AES 加密。由于许多原因，您通常应该只使用 RSA 来加密密钥，然后使用 AES 或类似的对称密码算法来加密您的实际文本。

AES 是块大小为 16 字节的块密码，因此（取决于您使用的填充以及传输初始化向量的方式）将 16 字节的纯数据加密为 16 字节的加密数据。

# .net - dataset.readxml(string) 是同步的吗？

> ID：685474
> 
> 赞同：0
> 
> 时间：2009-03-26T12:04:24.337
> 
> 标签：.net, windows-services, startup

我之所以这么问是因为我创建了一个 Windows 服务，而且似乎在重负载下（在我的情况下，当 Windows 启动时）在我手动对其进行处理之前，xml 中的数据没有被加载。检查该数据集中的特定数据表中有多少行。

数据集有一个模式。

伪代码将是：

```
dataset.readxml("c:\myfile.xml")
if dataset.datatable1.rowcount is 1 
    do something
else
    do something else 
```

在我的情况下，即使有一行，它也会到达 else 情况。

如果我之后手动启动服务，因为 else case 停止它，一切正常。

* * *

如果它是同步的，什么会导致这种行为？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T12:12:31.103

.NET 类中的异步方法遵循 BeginSomeAction() / EndSomeAction() 模式，所以我猜 ReadXml() 是同步的。根据[文档](http://msdn.microsoft.com/en-us/library/system.data.dataset_members.aspx)，DataSet 没有 BeginReadXml。

编辑：快速浏览实现表明同步读取，所以除非我错过了什么，否则它支持我的猜测。

# java - 如何将 .Net 应用程序连接到 JMX 代理？

> ID：685486
> 
> 赞同：3
> 
> 时间：2009-03-26T12:07:53.720
> 
> 标签：java, .net, interop, jmx

我需要将我的 .Net 应用程序连接到其他人的 JMX 代理。我读到这根本不是完成的事情，我应该使用肥皂或其他任何东西。由于这不会发生，是否有任何库或互操作技术可以帮助我？我只对调用远程操作或返回字符串结果等简单的事情感兴趣。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T13:02:53.663

.NET 确实不是用于与 JMX 对话的技术。JMX 是一个内置标准，它是 Java 的一部分，但非常特定于在 Java 中运行。我假设您无法控制您尝试使用的应用程序，因为您表示您正在尝试使用其他人的 JMX 代理。

在这种情况下，您可能需要考虑使用 Java 编写您的应用程序或其中的一部分。这是访问 JMX 的最佳方式。如果这不是一个选项，您确实可以考虑一些事情：

1) 检查您正在连接的应用程序是否可以将数据公开为 JMX 以外的其他内容。允许通过 Web 服务访问相同的数据通常并不难。

2) 编写一个与 JMX 服务器对话并公开 Web 服务的小型 Java 包装器。这允许您查询反过来通过 JMX 的 Web 服务。

3) JMX 必须使用其他代理来允许它与不同的技术进行通信。您可以使用 SNMP 代理之类的东西并使用 .NET 中的 SNMP 陷阱。更多信息可以在这里找到：http: [//java.sun.com/javase/6/docs/technotes/guides/management/snmp.html](http://java.sun.com/javase/6/docs/technotes/guides/management/snmp.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-05T16:22:14.690

如果您启动 HtmlAdaptorServer - 您可以使用 URL 来使用标准 HTTP 调用来调用 JMX 方法。

作为系统管理任务的一部分，我过去曾从 Perl 完成此操作。如果 JMX 接口发生很大变化，它就不漂亮并且无法维护。但是..如果你需要一个快速而肮脏的黑客 - 就是这样！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-02-27T16:10:54.713

[Java 管理扩展 (JMX) 代理](http://jcp.org/en/jsr/detail?id=262)的Web 服务连接器和参考实现[ws-jmx-connector](https://ws-jmx-connector.dev.java.net/)将是我的选择。JSR 262 将为跨平台/跨语言的企业集成项目提供新的机会，但不幸的是，开发速度已经放缓。

它只需要一些 SOAP 调用来调用 JMX 管理接口的所有操作，IIRC 甚至包括回调/通知。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-04-16T13:32:16.267

你可以用[IKVM](http://www.ikvm.net/)做到这一点。它是 .Net CLR 编译器的 Java 字节码，与 JMX 一起工作得很好。

# vba - Excel VBA 宏

> ID：685487
> 
> 赞同：1
> 
> 时间：2009-03-26T12:08:47.507
> 
> 标签：vba, excel

列表：-“问题表”（工作表）。

我有一个 Excel 表，它代表每天大小不同的问题列表（行）（例如更多或更少的行）；每一行都被分配了一个名称；分配的名称始终在“问题表”的同一列“M”中；一个单独的作业名称不一定每天都出现，也可能在某一天出现多次（不止一行）；

我已经有一个宏，它可以创建作业名称的唯一列表（工作表），其中出现在问题表 M 列中的每个名称都在“唯一列表”工作表中记录一次；相同的宏为每个唯一出现的分配名称创建一个新工作表（在同一工作簿中）。分配名称会自动记录在新的个人工作表选项卡中。

必需：- 将检查主“问题表”的 M 列的宏；对于问题表 M 列中出现特定作业名称的每一行/问题，将作业名称与同名的工作表匹配，然后将整行的详细信息从“问题表”复制并粘贴到第一个现有工作簿中正确（相同的指定名称）工作表的空白行。必须对问题表中的每一行重复此例程。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T23:25:56.337

如果订单无关紧要，这可能是您最好的选择

```
Sub x()
    Dim rngProbs As Range
    With ThisWorkbook.Worksheets("Problem Sheet")
        Set rngProbs = .Range("M1", .Range("M1").End(xlDown))
    End With

    Dim r As Range

    For Each r In rngProbs
        r.EntireRow.Copy
        ThisWorkbook.Worksheets(r.Text).Rows(1).EntireRow.Insert
    Next r

End Sub 
```

# python - 在 python 3.0 中处理文件属性

> ID：685488
> 
> 赞同：1
> 
> 时间：2009-03-26T12:09:36.960
> 
> 标签：python, windows, python-3.x

我目前正在用 python 3 开发一个应用程序，我需要能够隐藏某些文件而不让人们看到。我发现了一些使用 win32api 和 win32con 的地方，但它们似乎在 python 3 中不存在。

有谁知道这是否可能无需回滚或用 C++ 编写我自己的属性库

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T12:40:05.357

您需要适用于 Windows 的[pywin32](http://sourceforge.net/project/showfiles.php?group_id=78018&package_id=79063&release_id=661475) Python 扩展。最近为 Python 3 发布。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T12:28:01.690

您可以使用[ctypes](http://docs.python.org/library/ctypes.html)直接访问 kernel32.dll 中的函数。

您正在寻找的功能是`windll.kernel32.SetFileAttributesA`

# flex3 - flex 3 组件加载顺序

> ID：685495
> 
> 赞同：0
> 
> 时间：2009-03-26T12:11:50.340
> 
> 标签：flex3, components

我有一个自定义组件（AS3 组件），它包含在我的 main.mxml 中。问题是加载时间比主页长大约 2 秒。它有一个导致延迟的数据库调用。

我该如何解决这个问题，以便我的自定义组件与我的 main.mxml 文件同时加载和显示

这是我的组件包括；

```
<comp:InputFieldGenerator> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T12:20:21.910

如果您正在等待某个异步操作（例如 RemoteObject 调用）完成，您可以将“主页”包装在一个容器中，将其初始可见性设置为 false，并且仅在您的操作完成时翻转它。你也可以在你的 main.mxml 中使用状态来达到同样的效果。

# iphone - NSOperation 中的 UIAlertView 在 iPhone 中不是模态的

> ID：685500
> 
> 赞同：0
> 
> 时间：2009-03-26T12:12:23.223
> 
> 标签：iphone, objective-c, multithreading, user-interface

所以我正在尝试创建一个尝试连接到 WWW 的检查。当它失败时，它需要在应用程序放弃并退出之前重试几次。每次重试时，用户都会收到带有重试或取消选项的 UIAlertView。

所以这就是问题所在。

我在 NSOperationQueue 中有一系列操作，所有操作都应该失败且没有连接。我正在使用 NSoperation 队列，以便 UI 不会锁定并且数据正在后台处理。

在 NSInvocationOperation 中，我的方法将点击 [AlertView show]，但这并不是真正的模态。

然后我的操作返回并继续通过 NSOperations 链，因为似乎没有办法用错误值返回它们以停止额外的处理。最终 UI 赶上来，显示模态 AlertView，但我不知道发生了什么。

我相信这是一个普遍的要求。任何想法如何实现这一目标？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T13:12:24.953

如果我理解正确，您想要 UIAlertView 的模态版本，但仅在调用线程/NSOperation 中是模态的？这有几个问题：

*   您可能应该只从主线程调用接口操作（使用 performSelectorOnMainThread 很容易解决：）
*   模态对话框实际上并不是操作系统的一部分；您需要以编程方式解决此问题。

# c# - LINQ - 用一个我认为 LINQ 应该能够解决的例子帮助我掌握它！

> ID：685507
> 
> 赞同：4
> 
> 时间：2009-03-26T12:15:12.297
> 
> 标签：c#, linq

我正在尝试使用 LINQ to objects，因为我可以看到它的强大功能。幸运的是，我有一个我认为 LINQ 应该能够解决的问题。

这是问题（细节是一个例子）；

```
public class SchoolClass
{
    public int ID;
    public string Name;
    public string Teacher;
    public string RoomName;

    public string Student_Name;
    public int Student_Age;
} 
```

从示例中可以看出，ClassName、Teacher 和Room 以及Students 之间存在一对多的关系，即一个班级可能有很多学生。

如果我们有一个列表，是否可以使用 LINQ 创建一个列表，但只有一个实例 ID、名称、教师、房间名称以及 Student_Name 和年龄的 ArrayList？

制作这个：

```
public class Students
{
    public string Student_Name;
    public int Student_Age;
}

public class SchoolClass
{
    public int ID;
    public string Name;
    public string Teacher;
    public string RoomName;

    public ArrayList Students;
} 
```

本质上，使用 LINQ 将列表清理为更合乎逻辑的结构？

为这个例子提供一些背景知识。DataGrid 使用第二个结构来生成主-子关系。如上所示，我们将 SchoolClass 和 StudentInformation 存储在类中。如果能够将我们的初始列表转换为数据网格可以使用的结构，那将是很好的使用 LINQ。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-26T12:23:12.357

我将其更改`ArrayList`为`List<Students>`, 并且：

```
 List<SourceData> source = new List<SourceData>();
    //...your data here ;-p
    var classes = (from row in source
                  group row by new {
                          row.ID, row.Name,
                          row.Teacher, row.RoomName }
                      into grp
                      select new SchoolClass
                      {
                          ID = grp.Key.ID,
                          Name = grp.Key.Name,
                          Teacher = grp.Key.Teacher,
                          RoomName = grp.Key.RoomName,
                          Students = new List<Students>(
                              from row in grp
                              select new Students
                              {
                                  Student_Age = row.Student_Age,
                                  Student_Name = row.Student_Name
                              })
                      }).ToList(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T12:26:43.517

如果我正确理解这一点，我会认为实现 SchoolClass 类的最佳方法是创建一个 Student 类（如果您正在使用它，可能是一个 LINQ-to-SQL 实体）并拥有一个通用的学生类型的列表，类似于以下内容：

```
public class SchoolClass
{    
    public int ID;    
    public string Name;    
    public string Teacher;    
    public string RoomName;    
    public List<Student> Students;
} 
```

然后可以使用 linq 查询填充学生列表，但如果没有更多信息，我不确定具体如何。

希望这是一些帮助。

# .net - ODP.NET 是可再分发的吗？

> ID：685511
> 
> 赞同：3
> 
> 时间：2009-03-26T12:16:03.870
> 
> 标签：.net, oracle, licensing, odp.net

Oracle ODP.NET 库是否可再分发？如在，我可以简单地在我的应用程序中包含 Oracle.DataAccess.dll 并引用它而不进入任何合法的热水？OTN 上 ODAC 的下载许可证是相当难以理解的法律术语，无法明确我是否可以直接包含 dll。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-02-22T10:35:53.097

Oracle 现在发布了一个“redist 包”。它被称为“带有 xcopy 的 ODAC（Oracle 数据访问组件）”。这包括 ODP 驱动程序、即时客户端以及所需的所有支持非托管 DLL。

[http://www.oracle.com/technetwork/database/windows/downloads/index-101290.html](http://www.oracle.com/technetwork/database/windows/downloads/index-101290.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T12:19:35.563

您要分发的是[Oracle Instant Client](http://www.oracle.com/technology/tech/oci/instantclient/index.html)。这是一个可免费分发的 Oracle 组件，其中包含客户端应用程序所需的文件，仅此而已。

就我个人而言，我从来没有将它与 ODP.NET 一起使用，但[在 Oracle 网站上有一篇关于使用 Instant Client 和 ODP.NET 的文章](http://www.oracle.com/technology/oramag/oracle/08-nov/o68odpnet.html)。我已经将 Instant Client 用于 Java 和 Perl 应用程序，没有任何问题。

# sql - 您将如何在 SQL 脚本中强制执行 DRY（不要重复自己）？

> ID：685512
> 
> 赞同：4
> 
> 时间：2009-03-26T12:16:04.963
> 
> 标签：sql, oracle, dry

我正在使用包含一些更新的脚本更改数据库（oracle），如下所示：

```
UPDATE customer
SET status = REPLACE(status,   'X_Y',   'xy')
WHERE status LIKE '%X_Y%'
 AND category_id IN
  (SELECT id
   FROM category
   WHERE code = 'ABC');

UPDATE customer
SET status = REPLACE(status,   'X_Z',   'xz')
WHERE status LIKE '%X_Z%'
 AND category_id IN
  (SELECT id
   FROM category
   WHERE code = 'ABC');

-- More updates looking the same... 
```

在这种情况下，您将如何执行 DRY（不要重复自己）？

我对解决以下两个反复出现的问题特别感兴趣：

*   定义一个仅可从此脚本中获得的函数以提取子查询`SELECT id FROM category WHERE code = 'ABC'`

*   创建一组替换规则（可能类似于`{"X_Y": "yx", "X_Z": "xz", ...}`流行的编程语言），然后在其上迭代单个更新查询。

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T12:42:50.827

我会将其简化为单个查询：

```
UPDATE customer
SET status = REPLACE(REPLACE(status, 'X_Y', 'xy'), 'X_Z', 'xz')
WHERE status REGEXP_LIKE 'X_[YZ]'
 AND category_id IN
  (SELECT id
   FROM category
   WHERE code = 'ABC'); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T12:32:43.330

首先，请记住，脚本与编程不是一回事，您不必**遵守**DRY 原则。像这样的脚本通常是一次性的，而不是要长期维护的程序。

但是您可以使用 PL/SQL 来执行此操作：

```
declare
   type str_tab is table of varchar2(30) index by binary_integer;
   from_tab str_tab;
   to_tab str_tab;
begin
   from_tab(1) := 'X_Y';
   from_tab(2) := 'X_Z';
   to_tab(1) := 'xy';
   to_tab(2) := 'xz';

   for i in 1..from_tab.count loop

      UPDATE customer
      SET status = REPLACE(status,   from_tab(i),   to_tab(i))
      WHERE status LIKE '%' || from_tab(i) || '%'
       AND category_id IN
        (SELECT id
         FROM category
         WHERE code = 'ABC');

   end loop;
end; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T13:06:49.037

非常简单，除非我遗漏了什么。

```
UPDATE customer
SET status = REPLACE(REPLACE(status,'X_Y','xy'),'X_Z','xz')
WHERE ( status LIKE '%X_Y%' Or status LIKE '%X_Z%')
  AND category_id IN
     (SELECT id
      FROM category
      WHERE code = 'ABC'); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T12:44:16.657

编写一个带参数的脚本并多次调用它。（我假设您使用 SQLPlus 来运行脚本。）

replace_in_status.sql：

```
UPDATE customer
SET status = REPLACE(status,   UPPER('&1'),   '&2')
WHERE status LIKE '%' ||UPPER('&1')|| '%'
 AND category_id IN
  (SELECT id
   FROM category
   WHERE code = 'ABC'); 
```

调用脚本：

```
@replace_in_status X_Y xy
@replace_in_status X_Z xz 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-26T15:57:16.837

好的，在这里从臀部射击，放轻松我的语法:-)

这样的方法是否有帮助：

```
DECLARE
  v_sql1   VARCHAR2(1000);
  v_sql2   VARCHAR2(2000);
  TYPE T_Rules IS RECORD (srch  VARCHAR2(100),  repl(VARCHAR2(100));
  TYPE T_RuleTab IS TABLE OF T_Rules INDEX BY BINARY_INTEGER;
  v_rules T_RuleTab;

  FUNCTION get_subquery RETURN VARCHAR2 IS
  BEGIN
    RETURN '(SELECT id FROM category WHERE code = ''ABC'')';
  END;

BEGIN
  v_sql1 := 'UPDATE customer SET status = REPLACE('':1'','':2'') WHERE status LIKE ''%:1%'' AND category_id IN ';
  v_rules(1).srch := ('X_Y'); v_rules(1).repl := 'yx';
  v_rules(2).srch := ('X_Z'); v_rules(2).repl := 'xz';

  FOR i IN 1..v_rules.COUNT LOOP
    v_sql2 := v_sql1||get_subquery();
    EXECUTE IMMEDIATE v_sql2 USING v_rules(i).srch, v_rules(i).repl;
  END LOOP;
END; 
```

您可以将 PL/SQL 表替换为真实表并在其上运行光标，但这满足了您的第二个要求。

显然，在 get_subquery 上还有一些工作要做，这是您的第一个要求；-)

**编辑**

当！忘了提到您需要小心 WHERE 子句中的替换字符串 - 下划线是 Oracle 中与通配符匹配的单个字符...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-26T15:29:07.543

soulmerge 建议的解决方案是最简单的，因此也是最好的解决方案 - 您只需嵌套调用“替换”即可。我只想添加条件

```
status like '%tagada%' 
```

没用。如果未找到搜索的字符串，replace() 不会改变状态，因此您可以安全地将其应用于所有行。而且由于您搜索丢失在另一个字符串中间的字符串的条件不能使用您拥有的任何索引，因此它作为过滤条件是无用的。您唯一的过滤条件是 category_id 上的条件......这带来了一点证明为什么 Soulmerge 的解决方案是最好的：迭代所有更改是一个坏主意。假设 category_id 上的过滤器具有中等选择性，Oracle 很可能会选择扫描表。当您可以一次完成所有更改时，您真的要每次都扫描表吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-26T12:36:31.137

我已经看到了一些方法：

1.  使用字符串缓冲区使用 PL/SQL 或在您的编程语言中动态组装 sql。
2.  使用 IBATIS 之类的框架，它可以让您重用和扩展存储在 XML 文件中的 SQL 片段。
3.  使用 ORM 框架通过使用对象而不是直接使用 SQL 来规避这个问题。

根据您的语言和手头的问题，使用框架可能是最好的方法，然后将其扩展为您想要它做的事情。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-26T12:32:37.327

根据脚本的重要性，我会：

1.  只需复制粘贴和修改，或
2.  用另一种编程语言编写脚本，以更好地解决重复问题。

对于替换规则，您可以创建一个临时表并用这些替换规则填充它，然后与该表连接。

如果子查询始终相同，则您也通过使用连接解决了第一个问题。

# silverlight - 在 Silverlight DataGrid 中显示动态数据结构

> ID：685513
> 
> 赞同：2
> 
> 时间：2009-03-26T12:17:39.310
> 
> 标签：silverlight, datagrid

我有一个这样的数据结构：

```
MyDataStructure{
  string Name{get;set}
  string Title{get;set;}
  IDictionary<string, bool> Values{get;set;}
} 
```

我想在显示的数据网格类型中显示此结构数组中的项目

姓名 | 标题 | {值[0].名称} | {值[1].名称} | ... | {值[N].Name}

有什么建议么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-03T11:53:28.223

我认为您可以从问题中找到一些东西（[这里](https://stackoverflow.com/questions/681495/array-binding-xaml-by-position-silverlight-on-datagrid)）我几天前遇到了同样的问题。简而言之，我发现只有两个解决方案：

*   使用反射将您的字典“转换”为运行时生成的类，其属性取自字典本身（将采用属性名称，例如来自键值）

*   使用动态语言（例如 IronPython）来做之前描述的相同的事情，但以更简单的方式（我还没有测试过）

我现在不知道这是否会在 SL3 中修复。现在似乎无法使用“位置”进行绑定。

如果您发现任何其他解决方案被广泛接受:)

乔治奥

# java - JLabel 中的多行文本

> ID：685521
> 
> 赞同：84
> 
> 时间：2009-03-26T12:20:59.193
> 
> 标签：java, swing, jlabel

如何使 JLabel 的文本延伸到另一行？

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2009-03-26T12:49:24.180

您可以通过将 HTML 放入代码中来做到这一点，因此：

```
JFrame frame = new JFrame();
frame.setLayout(new GridLayout());
JLabel label = new JLabel("<html>First line<br>Second line</html>");
frame.add(label);
frame.pack();
frame.setVisible(true); 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2012-05-07T22:32:03.070

如果您希望 jLabel Text 自动调整大小，例如在可拉伸的 gridbaglayout 中，只需将其文本放在 html 标签中，如下所示：

```
JLabel label = new JLabel("<html>First line and maybe second line</html>"); 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2015-11-05T19:52:59.547

我已将 JTextArea 用于多行 JLabels。

```
JTextArea textarea = new JTextArea ("1\n2\n3\n"+"4\n"); 
```

[http://docs.oracle.com/javase/7/docs/api/javax/swing/JTextArea.html](http://docs.oracle.com/javase/7/docs/api/javax/swing/JTextArea.html)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2012-12-23T05:30:18.657

`<html></html>`在标签内键入内容（即“文本”属性字段） 。因此，您可以使用`<br>`or`<P>`插入换行符。

例如：

```
String labelContent = "<html>Twinkle, twinkle, little star,<BR>How I wonder what you are.<BR>Up above the world so high,<BR>Like a diamond in the sky.</html>"; 
```

它将显示如下：

闪烁，闪烁，小星星，
我多么想知道你是什么。
高高在上，
犹如天上的钻石。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2013-10-01T16:00:00.990

您还可以使用SwingX[库中的](https://swingx.java.net/)[JXLabel](http://javadoc.geotoolkit.org/external/swingx/org/jdesktop/swingx/JXLabel.html)。

```
JXLabel multiline = new JXLabel("this is a \nMultiline Text");
multiline.setLineWrap(true); 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2020-01-25T16:05:26.427

这太可怕了。所有这些答案都建议添加到标签文本的开头，并且在 JLabel 的 Java 11（或更早版本）文档中没有一个词表明如果标签的文本恰好以`<html>`. 谁说这在任何地方都有效并且永远有效？而且你可以得到很大的惊喜，将任意文本包装在其中并将其交给 html 布局引擎。

我赞成建议 JTextArea 的答案。但我会注意到 JTextArea 不是替代品。默认情况下，它会扩展以填充行，这不是 JLabel 的行为方式。我还没有想出解决方案。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2016-06-29T12:05:37.987

在我的情况下，将文本拆分为每一行就足够了`\n`，然后`JLabel`为每一行创建一个：

```
JPanel panel = new JPanel(new GridLayout(0,1));
String[] lines = message.split("\n");
for (String line : lines) {
    JLabel label = new JLabel(line);
    panel.add(label);
} 
```

我在上面用过`JOptionPane.showMessageDialog`

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-06-04T12:52:13.447

您可以使用`JTextArea`和删除编辑功能来获取普通的只读多行文本。

```
JTextArea textArea = new JTextArea("line\nline\nline");
textArea.setEditable(false); 
```

[`JTextArea`](https://docs.oracle.com/javase/7/docs/api/javax/swing/JTextArea.html)

[`setEditable`](https://docs.oracle.com/javase/7/docs/api/java/awt/TextComponent.html#setEditable(boolean))

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-04-28T10:35:31.880

可以在 HTML中[使用（基本）CSS 。](https://stackoverflow.com/questions/5766175/word-wrap-in-jbuttons/5767825#5767825)

* * *

这个问题是从[Multiline JLabels - Java](https://stackoverflow.com/questions/1377181/multiline-jlabels-java)链接的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-11-05T14:46:05.283

```
String labelText ="<html>Name :"+name+"<br>Surname :"+surname+"<br>Gender :"+gender+"</html>";
JLabel label=new JLabel(labelText);
label.setVisible(true);
label.setBounds(10, 10,300, 100);
dialog.add(label); 
```

* * *

## 回答 #11

> 赞同：-11
> 
> 时间：2013-07-09T08:20:35.160

为什么你要给出复杂的东西......你可以通过放置“\ n”而不是html标签来做到这一点

# java - 使用私有静态方法

> ID：685522
> 
> 赞同：39
> 
> 时间：2009-03-26T12:21:26.137
> 
> 标签：java, oop, coding-style, static-methods

您如何看待使用**私有静态方法**？

就个人而言，我更喜欢使用*静态*私有方法而不*是非静态*方法，只要它不需要访问任何实例字段。

但我听说这种做法违反了 OOP 原则。

编辑：我想从风格的角度来看，而不是性能。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-03-26T12:44:32.227

一个`private static`方法本身并不违反 OOP，但是当你在一个不需要（也不能*）访问实例字段的类上有很多这些方法时，你不是在以 OO 方式编程，因为“对象”意味着状态+对该状态一起定义的操作。如果它们不需要任何状态，为什么要将这些方法放在该类上？

(*) = 原则上，由于 Java 中的类级别可见性，类上的静态方法*可以*访问该类对象的实例字段，例如：

```
class Test
{
  int field = 123;

  private static void accessInstance(Test test)
  {
    System.out.println(test.field);
  }
} 
```

当然，您需要自己传递对实例（`this`指针）的引用，但实际上您是在模仿实例方法。只是为了完整性而提到这一点。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-03-26T16:06:20.357

如上所述，私有静态方法对于组织重用逻辑和减少/消除重复代码通常很有用。我很惊讶在这个讨论中我没有注意到任何关于性能的提及。来自 Renaud Waldura 的“决赛的最后一句话”：

（注意，私有静态方法是隐式最终的）

“由于 final 方法只在声明类中实现，因此无需动态调度对 final 方法的调用，而可以使用静态调用。编译器可以直接调用该方法，完全绕过通常的虚拟方法调用过程。因此，最终方法也是由即时编译器或类似优化工具内联的候选方法。（请记住，私有/静态方法已经是最终方法，因此始终考虑进行此优化。）

查看整篇论文： [http ://renaud.waldura.com/doc/java/final-keyword.shtml](http://renaud.waldura.com/doc/java/final-keyword.shtml)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-26T12:38:47.233

private 或 public 没有区别 - 静态方法是可以的，但如果你发现你一直在使用它们（当然，不访问任何实例字段的实例方法基本上是用于此目的的静态方法），那么您可能需要重新考虑设计。这并不总是可能的，但大多数时候方法应该与它们操作的数据一起存在 - 这是 OOP 的基本思想。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-26T12:37:39.873

我不一定认为您正在做的事情有任何真正的问题，但我的第一个问题是，如果该方法不需要访问任何实例字段，那么它首先在该类中做了什么？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T12:37:45.223

这是一个品味问题，但我制作的方法不会对对象内的静态状态做出反应。这样，如果静态函数需要类似的功能，我就不必重写代码。排序函数就是这种情况的一个很好的例子。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-26T12:41:53.810

我倾向于不使用私有静态方法。我确实使用公共静态方法并将它们分组到 Util 类中以促进重用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-26T13:28:07.380

例如，私有静态方法可以对其类的私有静态成员进行操作。这可以用来封装和统一某些特定类的操作。

在我看来，使用静态方法的主要缺点是放弃了覆盖的可能性。由于 Java 中的类不像 Smalltalk 中的类，因此您不能覆盖静态方法。

由于您的问题与私有静态方法有关，因此无论如何都无法覆盖。

我倾向于仅在实用程序类（如 java.lang.Math）或单例模式等模式的情况下使用静态方法。所有这些都需要比私有更高的可见性，因为它们代表了他们的班级向其他人提供的服务。

最后的想法：如果您有一个或多个私有静态方法，请考虑将它们提取到专用的实用程序类并将它们公开。更好的是，让它们成为实例方法并使用单例模式。

# memory - 最小化 ADO.NET 数据集的内存占用？

> ID：685524
> 
> 赞同：2
> 
> 时间：2009-03-26T12:22:19.613
> 
> 标签：memory, ado.net, dataset

给定一个大量使用 DataSet 的遗留系统，并且很少或根本不可能用业务对象或其他更有效的数据结构替换它们：

是否有任何技术可以减少 DataSet 的内存占用？

我正在考虑设置初始容量（已知时）、删除限制等，但我对 DataSets 的经验很少，也不知道哪些特定选项可供我使用，或者它们中的任何一个是否重要。

更新：

我知道长期重构的可能性，但我正在寻找快速修复给定存储在 DataSet 中的一组 DataTable 对象，即已知哪些属性会影响内存开销。

由于数据在内部存储的方式，设置初始容量可能是一种方法，因为这将防止对象在仅添加一行时分配任意大量的内存。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T12:58:44.267

不幸的是，这对您有帮助，但在相同情况下它可以提供很大帮助。

如果您在数据集中存储大量相同的字符串，例如城镇名称，请查看仅对每个不同字符串使用单个字符串对象。

例如

```
Directory <string, string> towns = new Directory <string, string>();
foreach(var row in datatable)
{
    if (towns.contains(row.town))
    {
       row.town = towns[row.town]
    }
    else
    {
       towns[row.town] = row.town;
    }
} 
```

然后 GC 可以回收大部分重复的字符串，但这仅在数据集长期存在的情况下才有效。

您可能希望在 rowCreated 事件中执行此操作，以便一开始就不会创建所有重复的字符串对象。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T12:38:25.737

1.  如果你使用 VS2005+，你可以实例化 DataTable 对象，而不是整个 DataSet。2003年，如果实例化DataTable，默认自带DataSet。2005 年及之后，您只得到 DataTable。

2.  查看您的数据访问层以填充数据集或数据表。最常见的情况是有太多数据通过。使您的查询更具体。

3.  确保您使用的代码在传递数据集时不会做一些愚蠢的事情，例如复制数据集。确保您使用 .Select 语句或 DataViews 进行过滤和排序，而不是制作副本。

DataSet 没有很多快速的“优化”。如果您遇到内存问题，请使用第 2 项和第 3 项。无论您使用哪种类型的数据传输对象，都会出现这种情况。

并擅长数据集。如果你不熟悉它们，你可以做一些愚蠢的事情，比如任何事情。然后，您将撰写有关它们如何糟糕的文章，这些文章实际上是关于您对它们知之甚少的文章。它们真的非常有用且易于维护。几个提示：

*   使用类型化的数据集。它们将为您节省大量编码并且它们被输入，这有助于简单的验证。
*   如果您使用的是类型化的 DS，请确保不要修改生成的代码文件。如果您使用的是 VS2005+，您可以将任何自定义业务对象行为放在 DS 的部分类中（而不是 .designer 代码文件）。
*   在您发现自己循环遍历 DataRow 对象的任何地方使用 DataView 和 .Select。
*   寻找一个好的代码生成工具，并构建一个合理的数据访问框架，用于从 DS 中填充和更新。问题之一是，有时，设计人员将 DS 的设计直接与数据库中的表联系起来，使得设计对数据结构的更改变得脆弱。如果您必须这样做，请构建或使用代码生成器从数据库构建您的数据访问层，例如 CodeSmith。首先查看一些用于生成存储过程和数据访问类的 CodeSmith 模板。
*   请记住，在与某人谈论“对象”与“数据集”时，这种情况下的对象是 DataRow，而不是 DataSet。并且由于部分类，您可以将行为放在“对象”上，为喜欢编写代码的人获得“对象”的 95% 的好处。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T13:01:22.157

您可以尝试让您的表和行在文件背后的代码中实现接口。然后随着时间的推移更改您的代码以使用这些接口，而不是直接使用表/行。

一旦您的大部分代码只使用接口，您就可以使用代码生成来创建实现这些接口的 C# 类，而不会产生行/表的开销。

但是，仅迁移到 64 位并购买更多内存可能会更便宜...

# windows - 关闭以任何首选语言连接在 LAN 中的远程计算机

> ID：685528
> 
> 赞同：2
> 
> 时间：2009-03-26T12:23:05.570
> 
> 标签：windows, language-agnostic

我想关闭远程 Windows 计算机（例如连接在 LAN 中的 Windows 计算机。）我尝试了很多，但找不到解决方案。有谁知道如何关闭远程计算机？任何语言都可以。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-26T12:33:14.390

假设是一个windows盒子。

在 VB.NET 或 c# 中

```
Process.Start("shutdown","-s -m \\Machine"); 
```

应该做的伎俩。

请参阅
[http://msdn.microsoft.com/en-us/library/system.diagnostics.process.start.aspx](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.start.aspx)
[http://www.ss64.com/nt/shutdown.html](http://www.ss64.com/nt/shutdown.html)

编辑：注意 -`shutdown.exe`仅在 Windows 2003 之前的资源工具包中可用

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-26T12:34:48.100

您可以连接到域中的任何计算机并使用WMI 类 Win32_OperatingSystem的[Win32Shutdown](http://msdn.microsoft.com/en-us/library/aa394058.aspx)方法将其关闭。在 .NET 中，您可以通过[System.Management](http://msdn.microsoft.com/en-us/library/system.management.aspx)命名空间访问 WMI。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T12:33:09.897

通过用于启动进程的原语（如 Process.Start() 或 CreateProcess()）调用*shutdown -s -m \\computername命令。*

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T12:36:03.090

不确定此代码示例是否有效，但它[说明了如何使用 WMI 远程关闭计算机。](http://www.csharpfriends.com/Forums/ShowPost.aspx?PostID=36953)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-26T12:46:38.307

如果远程计算机是 Windows 机器，您可以使用 WMI（Windows 管理规范）。

[http://msdn.microsoft.com/en-us/library/aa394582.aspx](http://msdn.microsoft.com/en-us/library/aa394582.aspx)

使用 Win32_OperatingSystem 类的 Reboot() 方法。例如，您可以使用 Windows 脚本、C#、VB .net

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-26T12:48:28.193

1.  通过 SSH 连接到主机
2.  user@domain:~$ sudo shutdown -h now

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-27T19:29:19.860

从一个 linux 盒子 [ `net rpc shutdown`]

或调用[initialSystemShutdown](http://www.google.com/search?hl=en&q=site%3Amsdn.microsoft.com%20initiateSystemShutdown)

# javascript - jQuery click(fn) 不适用于输入元素

> ID：685529
> 
> 赞同：1
> 
> 时间：2009-03-26T12:23:10.140
> 
> 标签：javascript, jquery, event-handling

我想使用 jQuery 来检测对一堆单选按钮的点击。它们都被分配了一个 CSS 类 foobar 来检测它们。容易，对吧？不过，这段代码不起作用：

```
$("input.foobar").click(function ()
{ 
    alert(this.id);
}
); 
```

上面的代码有什么问题？

`this.id`真的返回当前单选按钮的 id 吗？

**编辑：**页面上的 HTML 真的很无聊（不验证），所以也许这就是问题所在......

**编辑 2：** HTML 被搞得一团糟。将不得不顺其自然并修复解决方法。愿 HTML 诸神原谅我！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T12:27:06.573

```
$("input.foobar").change(function () {
    alert(this.id);
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T12:29:26.740

您的代码基本上没有任何问题，它应该可以工作。但也许 html 会有所帮助，以了解问题所在。

并回答你的第二个问题，是的，'this.id' 是有效的 javascript。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T12:30:16.177

尝试

```
$("input.foobar").change(function () 
```

而不是`.click(function ()`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T12:30:47.580

您的代码示例没有任何问题，它按我的预期工作：

```
<input type="radio" class="foobar" id="x1" />
<input type="radio" class="foobar" id="x2" />
<input type="radio" class="foobar" id="x3" /> 
```

单击收音机会显示带有收音机 ID 的警报框。您是否真的单击了框，而不是一些周围的文本或标签元素？

# algorithm - 在不使用列表的情况下置换二叉树

> ID：685532
> 
> 赞同：2
> 
> 时间：2009-03-26T12:24:24.413
> 
> 标签：algorithm, binary-tree, permutation

我需要找到一种算法来生成二叉树的所有可能排列，并且需要在不使用列表的情况下这样做（这是因为树本身带有无法转换为列表的语义和约束）。我找到了一种适用于高度为 3 或以下的树的算法，但是每当我达到更高的高度时，我会在每个添加的高度中丢失一组可能的排列。

每个节点都携带有关其原始状态的信息，以便一个节点可以确定是否已针对该节点尝试了所有可能的排列。此外，该节点携带有关天气的信息，它是否已被“交换”，即它是否已经看到它的子树的所有可能排列。树是左居中的，这意味着右节点应该总是（除了在某些情况下我不需要为这个算法介绍）是叶节点，而左节点总是叶节点或分支。

我现在使用的算法可以这样描述：

```
if the left child node has been swapped
      swap my right node with the left child nodes right node
      set the left child node as 'unswapped'
  if the current node is back to its original state
      swap my right node with the lowest left nodes' right node
      swap the lowest left nodes two childnodes
      set my left node as 'unswapped'
      set my left chilnode to use this as it's original state
      set this node as swapped
      return null
  return this; 
else if the left child has not been swapped
  if the result of trying to permute left child is null
     return the permutation of this node
  else 
     return the permutation of the left child node
if this node has a left node and a right node that are both leaves
   swap them
   set this node to be 'swapped' 
```

算法的期望行为是这样的：

```
 branch
             /    |
       branch     3
         /   |
   branch    2
   /     |
  0      1

            branch
             /    |
       branch     3
         /   |
   branch    2        
   /     |
  1      0           <-- first swap

            branch
             /    |
       branch     3
         /   |
   branch    1         <-- second swap
   /     |
  2      0

            branch
             /    |
       branch     3
         /   |
   branch    1         
   /     |
  0      2   <-- third swap

            branch
             /    |
       branch     3
         /   |
   branch    0   <-- fourth swap        
   /     |
  1      2 
```

等等...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T13:42:25.177

该结构完全不适合排列，但是由于您知道它是左中心的，因此您可以做出一些假设来帮助您。

我尝试以与您类似的方式工作，但我总是发现您只有一个二进制信息（交换或不交换）是不够的。对于四片叶子，你有四片！(24) 种可能的组合，但您实际上只有三个分支（3 位，8 种可能的组合）来存储交换的状态信息。您根本没有地方存储这些信息。

但是也许您可以编写一个遍历树并使用叶子数来确定需要多少交换的遍历器，然后系统地遍历这些交换，而不是将其留给树本身。

就像是

```
For each permutation
   Encode the permutation as a series of swaps from the original
   Run these swaps on the original tree
   Do whatever processing is needed on the swapped tree 
```

这可能不适合您的应用程序，但您还没有详细说明为什么需要按照您的方式进行操作。你现在这样做的方式根本行不通，因为阶乘（排列的数量）比指数（你拥有的“交换”位的数量）增长得更快。如果你有 8 片叶子，那么你将有 7 个分支和 8 片叶子，总共 15 位。8个叶子有40320个排列，15位的可能组合只有32768个。从数学上讲，您根本无法表示排列。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T13:34:35.460

列出树中所有项目的列表，使用生成方式构建所有可能的顺序（参见 Knuth Vol 4），然后将它们重新映射到树结构有什么问题？

# python - python在linux上将microsoft office docs转换为纯文本

> ID：685533
> 
> 赞同：11
> 
> 时间：2009-03-26T12:24:44.130
> 
> 标签：python, linux, ms-office

关于使用 python 在 linux 上将 .doc、.ppt 和 .xls 转换为纯文本的方法的任何建议？真的任何转换方法都是有用的。我已经研究过使用 Open Office，但是我想要一个不需要安装 Open Office 的解决方案。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-26T22:57:39.213

我会选择命令行解决方案（然后使用[Python 子进程模块](http://docs.python.org/library/subprocess.html)从 Python 运行工具）。

msword ( **catdoc** )、excel ( **xls2csv** ) 和 ppt ( **catppt** ) 的转换器可以在此处找到（以源代码形式）：http: [//vitus.wagner.pp.ru/software/catdoc/](http://vitus.wagner.pp.ru/software/catdoc/)。

无法真正评论 catppt 的有用性，但 catdoc 和 xls2csv 工作得很好！

但请务必先搜索您的发行版存储库......例如在 ubuntu 上，catdoc 只是一个快速的 apt-get away。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-26T12:32:11.367

您可以[通过 Python API 访问 OpenOffice](http://wiki.services.openoffice.org/wiki/Python)。

尝试以此为基础：[http ://wiki.services.openoffice.org/wiki/Odt2txt.py](http://wiki.services.openoffice.org/wiki/Odt2txt.py)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-26T12:27:42.593

将 Microsoft Office 文档转换为 HTML 或其他格式的常用工具是 mswordview，它已被重命名为[vwWare](http://wvware.sourceforge.net/)。

如果您正在寻找命令行工具，他们实际上建议使用 AbiWord 来执行转换：

```
AbiWord --to=txt 
```

如果您正在寻找库，请从[wvWare 概览页面](http://wvware.sourceforge.net/wvWare.html)开始。他们还维护[了一个阅读 MS Office 文档的库和工具的列表](http://wvware.sourceforge.net/wvInfo.html)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-26T12:36:45.083

在命令行中，[antiword](http://www.winfield.demon.nl/)或[wv](http://wvware.sourceforge.net/)非常适合 .doc 文件。（不是 Python 解决方案，但它们易于安装且速度快。）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-02-11T20:36:52.293

这里同样的问题。下面是我使用 catdoc 将 dir 'docs/' 中的所有 doc 文件转换为 dir 'txts/' 的简单脚本。希望它会帮助某人：

```
#!/usr/bin/env python 
# -*- coding: utf-8 -*-

import glob, re, os
f = glob.glob('docs/*.doc') + glob.glob('docs/*.DOC')

outDir = 'txts'
if not os.path.exists(outDir):
    os.makedirs(outDir)
for i in f:
    os.system("catdoc -w '%s' > '%s'" %
              (i, outDir + '/' + re.sub(r'.*/([^.]+)\.doc', r'\1.txt', i,
                                   flags=re.IGNORECASE))) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-26T12:31:10.853

对于处理 Excel 电子表格[xlwt](http://pypi.python.org/pypi/xlwt)很好。但这对文件没有`.doc`帮助`.ppt`。

（您可能还听说过 PyExcelerator。xlwt 是它的一个分支，并且维护得更好，所以我认为使用 xlwt 会更好。）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-26T12:56:01.700

我在使用 XSLT 将基于 XML 的办公文件处理成过去可用的东西方面取得了一些成功。它不一定是基于 python 的解决方案，但它确实完成了工作。

# sql-server - 用户定义的函数替换 WHERE col IN(...)

> ID：685542
> 
> 赞同：1
> 
> 时间：2009-03-26T12:26:48.977
> 
> 标签：sql-server, tsql, optimization

我创建了一个用户定义的函数，以通过包含“WHERE col IN (...)”的查询来获得性能，例如这种情况：

```
SELECT myCol1, myCol2
FROM myTable
WHERE myCol3 IN (100, 200, 300, ..., 4900, 5000); 
```

查询是从 Web 应用程序生成的，并且在某些情况下要复杂得多。函数定义如下所示：

```
CREATE FUNCTION [dbo].[udf_CSVtoIntTable]
(
  @CSV VARCHAR(MAX),
  @Delimiter CHAR(1) = ','
)
RETURNS 
@Result TABLE 
(
    [Value] INT
)
AS
BEGIN

  DECLARE @CurrStartPos SMALLINT;
  SET @CurrStartPos = 1;
  DECLARE @CurrEndPos SMALLINT;
  SET @CurrEndPos = 1;
  DECLARE @TotalLength SMALLINT;

  -- Remove space, tab, linefeed, carrier return
  SET @CSV = REPLACE(@CSV, ' ', '');
  SET @CSV = REPLACE(@CSV, CHAR(9), '');
  SET @CSV = REPLACE(@CSV, CHAR(10), '');
  SET @CSV = REPLACE(@CSV, CHAR(13), '');

  -- Add extra delimiter if needed
  IF NOT RIGHT(@CSV, 1) = @Delimiter
    SET @CSV = @CSV + @Delimiter;

  -- Get total string length 
  SET @TotalLength = LEN(@CSV);

  WHILE @CurrStartPos < @TotalLength
  BEGIN

    SET @CurrEndPos = CHARINDEX(@Delimiter, @CSV, @CurrStartPos);

    INSERT INTO @Result
    VALUES (CAST(SUBSTRING(@CSV, @CurrStartPos, @CurrEndPos - @CurrStartPos) AS INT));

    SET @CurrStartPos = @CurrEndPos + 1;

  END

    RETURN 

END 
```

该函数旨在像这样使用（或作为 INNER JOIN）：

```
SELECT myCol1, myCol2
FROM myTable
WHERE myCol3 IN (
    SELECT [Value] 
    FROM dbo.udf_CSVtoIntTable('100, 200, 300, ..., 4900, 5000', ','); 
```

有没有人对我的功能有一些优化想法或在我的情况下提高性能的其他方法？有什么我错过的缺点吗？

我正在使用 MS SQL Server 2005 Std 和 .NET 2.0 框架。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T12:32:24.893

我不确定性能是否会提高，但我会将它用作内部连接并远离内部选择语句。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T12:53:58.087

在 WHERE 子句或（更糟糕的）子查询中使用 UDF 是自找麻烦。优化器有时会做对，但经常会出错，并为查询中的每一行评估一次函数，这是您不想要的。

如果您的参数是静态的（它们似乎是）并且您可以发出多语句批处理，我会将 UDF 的结果加载到表变量中，然后对表变量使用连接来进行过滤。这应该更可靠地工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T13:54:17.410

该循环会破坏性能！

创建一个这样的表：

```
CREATE TABLE Numbers
(
    Number  int   not null primary key
) 
```

具有包含值 1 到 8000 左右的行并使用此函数：

```
CREATE FUNCTION [dbo].[FN_ListAllToNumberTable]
(
     @SplitOn  char(1)       --REQUIRED, the character to split the @List string on
    ,@List     varchar(8000) --REQUIRED, the list to split apart
)
RETURNS
@ParsedList table
(
    RowNumber int
   ,ListValue varchar(500)
)
AS
BEGIN

/*
DESCRIPTION: Takes the given @List string and splits it apart based on the given @SplitOn character.
             A table is returned, one row per split item, with a columns named "RowNumber" and "ListValue".
             This function workes for fixed or variable lenght items.
             Empty and null items will be included in the results set.

PARAMETERS:
    @List      varchar(8000) --REQUIRED, the list to split apart
    @SplitOn   char(1)       --OPTIONAL, the character to split the @List string on, defaults to a comma ","

RETURN VALUES:
  a table, one row per item in the list, with a column name "ListValue"

TEST WITH:
----------
SELECT * FROM dbo.FN_ListAllToNumTable(',','1,12,123,1234,54321,6,A,*,|||,,,,B')

DECLARE @InputList  varchar(200)
SET @InputList='17;184;75;495'
SELECT
    'well formed list',LEFT(@InputList,40) AS InputList,h.Name
    FROM Employee  h
        INNER JOIN dbo.FN_ListAllToNumTable(';',@InputList) dt ON h.EmployeeID=dt.ListValue
    WHERE dt.ListValue IS NOT NULL

SET @InputList='17;;;184;75;495;;;'
SELECT
    'poorly formed list join',LEFT(@InputList,40) AS InputList,h.Name
    FROM Employee  h
        INNER JOIN dbo.FN_ListAllToNumTable(';',@InputList) dt ON h.EmployeeID=dt.ListValue

SELECT
    'poorly formed list',LEFT(@InputList,40) AS InputList, ListValue
    FROM dbo.FN_ListAllToNumTable(';',@InputList)

**/

/*this will return empty rows, and row numbers*/
INSERT INTO @ParsedList
        (RowNumber,ListValue)
    SELECT
        ROW_NUMBER() OVER(ORDER BY number) AS RowNumber
            ,LTRIM(RTRIM(SUBSTRING(ListValue, number+1, CHARINDEX(@SplitOn, ListValue, number+1)-number - 1))) AS ListValue
        FROM (
                 SELECT @SplitOn + @List + @SplitOn AS ListValue
             ) AS InnerQuery
            INNER JOIN Numbers n ON n.Number < LEN(InnerQuery.ListValue)
        WHERE SUBSTRING(ListValue, number, 1) = @SplitOn

RETURN

END /*Function FN_ListAllToNumTable*/ 
```

我有其他版本不返回空行或空行，只返回项目而不是行号等。查看标题注释以了解如何将其用作 JOIN 的一部分，这比在where 子句。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-16T10:34:33.763

CLR 解决方案没有给我很好的性能，所以我将使用递归查询。所以这里是我将使用的 SP 的定义（主要基于 Erland Sommarskogs 的例子）：

```
CREATE FUNCTION [dbo].[priudf_CSVtoIntTable]
(
  @CSV VARCHAR(MAX),
  @Delimiter CHAR(1) = ','
)
RETURNS 
@Result TABLE 
(
    [Value] INT
)
AS
BEGIN

  -- Remove space, tab, linefeed, carrier return
  SET @CSV = REPLACE(@CSV, ' ', '');
  SET @CSV = REPLACE(@CSV, CHAR(9), '');
  SET @CSV = REPLACE(@CSV, CHAR(10), '');
  SET @CSV = REPLACE(@CSV, CHAR(13), '');

  WITH csvtbl(start, stop) AS 
  (
    SELECT  start = CONVERT(BIGINT, 1),
            stop = CHARINDEX(@Delimiter, @CSV + @Delimiter)
    UNION ALL
    SELECT  start = stop + 1,
            stop = CHARINDEX(@Delimiter, @CSV + @Delimiter, stop + 1)
    FROM csvtbl
    WHERE stop > 0
  )
  INSERT INTO @Result
  SELECT CAST(SUBSTRING(@CSV, start, CASE WHEN stop > 0 THEN stop - start ELSE 0 END) AS INT) AS [Value]
  FROM   csvtbl
  WHERE  stop > 0
  OPTION (MAXRECURSION 1000)

  RETURN 
END 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T11:13:54.793

感谢您的意见，我不得不承认在我开始工作之前我做了一些糟糕的研究。我发现[Erland Sommarskog](http://www.sommarskog.se/arrays-in-sql-2005.html)在他的网页上写了很多这个问题，在您的回复和阅读他的页面后，我决定尝试制作一个 CLR 来解决这个问题。

我尝试了递归查询，这导致了良好的性能，但无论如何我都会尝试 CLR 函数。

# javascript - 帮助 jQuery UI 对话框

> ID：685560
> 
> 赞同：0
> 
> 时间：2009-03-26T12:31:36.313
> 
> 标签：javascript, jquery, jquery-ui, jquery-ui-dialog

我正在使用 jQuery UI.Dialog。我有一个小问题，当我单击链接以显示对话框时，#Test 中的文本消失了，并且显示了模态叠加层，但未显示实际的模态框。

使用 FireBug 创建了对话框，但具有 Display:None，因此未显示。此外，如果我在 firebug 中将其更改为 Display:Block，则会显示对话框，但它位于我页面的左侧......有什么建议吗？

我的代码很简单：

```
<head>
<link href="Vader/jquery-ui-1.7.1.custom.css" rel="stylesheet" type="text/css">
<script src="javascripts/jquery.js" type="text/javascript"></script>
<script src="javascripts/ui.core.js" type="text/javascript"></script>
<script src="javascripts/ui.draggable.js" type="text/javascript"></script>
<script src="javascripts/ui.resizable.js" type="text/javascript"></script>              
<script src="javascripts/ui.dialog.js" type="text/javascript"></script>     
    <script type='text/javascript'>
    $(function() {
        $("a").click(function(){
            $('#Test').css('display','inline');
            $("#Test").dialog({modal: true});
        });
    });
</script>
</head>
<body>
    <a href="#">Test</a>
    <div id="Test" title="Test Title">Bla bla bla</div>
</body> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T06:11:10.997

您可能要添加点击是 e.preventDefault(); 所以它不会尝试加载可能刷新页面的#。

```
 $("a").click(function(e){
        e.preventDefault();
        $('#Test').css('display','inline');
        $("#Test").dialog({modal: true});
    }); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T13:02:22.120

我的猜测是它没有拾取你的css文件，你确认它确实是吗？

据我所知，您的代码没有任何问题，以下测试适用于我的沙箱文件

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<!-- Above Doctype should provide S mode in Moz, Safari, Opera, IE8 and A (almost standards) in IE6/7 -->
<head>
  <meta http-equiv="Content-Type" content="application/text+html;utf-8"/>

  <title>Sandbox</title>
  <link type="text/css" href="http://jqueryui.com/latest/themes/base/ui.all.css" rel="stylesheet" />

<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script type="text/javascript">
    google.load("jquery", "1.3.2");
    google.load("jqueryui", "1.7.0");
</script>
<script type="text/javascript">

      $(document).ready(function() {
        $("a").click(function(){
            $('#Test').css('display','inline');
            $("#Test").dialog({modal: true});
        });

    });
</script>
</head>
<body>
    <div id="container">
        <a href="#">Test</a>
        <div id="Test" title="Test Title">Bla bla bla</div>
    </div>
</body>

</html> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T13:04:19.293

<A> 不是块级结构，这可能会引起一些麻烦。

尝试将其包装在 DIV 中，然后在对话框中创建该 div。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T13:04:21.260

我遇到了同样的问题，结果发现没有找到 CSS 文件。使用 firebug 加载 css 文件。您可能会发现 Firebug 中显示的是“404 Not found”。

# asp.net-mvc - 如何在 MVC 中排除此语法 [Bind(Exclude = "ID")] 中的另一个属性

> ID：685561
> 
> 赞同：6
> 
> 时间：2009-03-26T12:31:46.203
> 
> 标签：asp.net-mvc

由于我已经排除了“ID”，我该如何排除另一个属性？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-26T12:34:21.690

Exclude 采用逗号分隔的属性列表。解析时它还会修剪输入，以便您可以使用空格使其更具可读性。

例子：

```
[Bind(Exclude="ID, Name")] 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T12:35:02.687

[绑定(Exclude="ID,Second")]

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T12:35:29.127

尝试用逗号分隔要排除的属性，例如

```
[Bind(Exclude="ID,Name")] 
```

# visual-studio-2005 - 格式化数字的总和

> ID：685566
> 
> 赞同：0
> 
> 时间：2009-03-26T12:32:58.293
> 
> 标签：visual-studio-2005, reporting, service

关于 2005 年报告服务：我想总结一项措施的领域。如果我将 0.234 + 0.441 相加并将总和格式化为点后的 2 位数字，它将给出 0.7。因为我以相同的方式格式化字段本身，所以它显示 0.2+0.4=0.7。它说我必须通过每次添加舍入字段来求和。我发现在数字之后将数字四舍五入到几位数字的唯一方法是通过 format/FormatNumber 并且报告服务不接受 format(sum(format(number)) - 还有其他功能吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T13:18:46.700

Math.Round 函数应该做你需要的，给它四舍五入的数字和你想要的小数位数（我认为这里是 2），并返回一个双精度（或小数等，具体取决于传入的内容）。

然后对四舍五入的值求和。

# visual-studio-2008 - 使用 NAnt 使用 .Net 2.0/.Net 3.5 构建 VS2008 项目

> ID：685571
> 
> 赞同：0
> 
> 时间：2009-03-26T12:33:53.780
> 
> 标签：visual-studio-2008, .net-3.5, .net-2.0, nant

我正在尝试编写一个构建文件来构建一个简单的 C# 解决方案，但它失败并出现错误：*Unknown task or datatype*。

我的解决方案是用 VS2008 编写的，但针对 .Net 2.0（如果有帮助，我将使用 Vista）。

我已经看到了另一个问题[running-builds-using-net-3-5-msbuild-and-nantcontrib](https://stackoverflow.com/questions/626774/running-builds-using-net-3-5-msbuild-and-nantcontrib)并尝试了建议的解决方案并对我的 NAnt.exe.config 文件进行了更改。

我尝试将解决方案属性更改为目标 .net 3.5（并相应地更改构建文件，但没有成功）。

谁能建议我可能遗漏的任何东西？

我的构建文件如下：

```
<?xml version="1.0"?>
    <project name="HelloWorld" default="build" basedir=".">
    <description>Builds the HelloWorld project.</description>
    <target name="build" description="compiles the source code">
        <echo>Building Hello World</echo>
        <property name="nant.settings.currentframework" value="net-2.0" />
        <msbuild project="HelloWorld.sln">
            <property name="Configuration" value="debug" />
        </msbuild>
    </target>
</project> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-01T11:34:29.947

ms build 是 Nantcontrib 库中的一项任务。您必须将其下载到您的构建工具可以访问的位置，然后在 msbuild 任务之前使用 LoadTask：

```
<loadtasks assembly="c:\foo\NAnt.Contrib.Tasks.dll" /> 
```

一旦你这样做，它应该可以正常工作。

# windows - Windows 中 Ruby 的 GUI 编辑器

> ID：685572
> 
> 赞同：2
> 
> 时间：2009-03-26T12:34:17.663
> 
> 标签：windows, ruby, editor

我正在使用 Ruby 开发一个 Windows 应用程序。Ruby 最好的 GUI 编辑器是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-26T15:07:31.383

我想你们误解了他的问题。我认为他不是在询问 IDE。我宁愿认为他是在寻求一种“可视化”开发 GUI 应用程序的方法。那里有很多好的 Ruby IDE（我个人使用 Eclipse），但我认为没有用于 ruby​​ 的 GUI 设计工具。你要做的就是选择一个小部件库（我使用 wxruby）并在手边编写代码。周围也有很多小部件库，如 fxruby、qtruby 等。希望对您有所帮助。对不起，如果是我误解了这个问题。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-26T19:29:13.520

如果您要的是 GUI 设计器而不是 IDE。然后 wxWidgets( [wxRuby](http://wxruby.rubyforge.org/wiki/wiki.pl) ) 有[wxFormBuilder](http://wxformbuilder.org/)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-26T12:44:04.677

好吧，有 Netbeans 6.5、Notepad++、带有 Ruby Dev 的 Eclipse。工具包插件，OpenKomodo...

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-26T12:36:30.250

IMO [e](http://www.e-texteditor.com/)是 Windows 上最好的编辑器。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-26T12:40:05.343

如果你正在研究 ruby​​，去吧，买一个 mac。使用文本伴侣。

哦，很好的改装。但请允许我解释一下。

Ruby 的创造者 Matz 一直在与 Apple 合作，以使 Ruby 更紧密地与他们的操作系统技术相结合。

并非最不重要的是，优雅存在于哲学中，两者兼而有之。并非没有，Matz 自己使用 Mac，DHH 和大多数其他 Ruby 开发人员也是如此。

如果您仍然需要 Windows 上的 Ruby 编辑器，请使用[Komodo Edit](http://www.activestate.com/komodo_edit/)或[Scite](http://scintilla.sourceforge.net/SciTEDoc.html)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-26T12:37:12.883

我对 JetBrains 的 RubyMine 有很好的体验。它现在是免费的，你也可以得到一些很好的重构和语法高亮。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-02T13:23:36.750

Netbeans 6.5 的 Ruby 版本是我迄今为止使用过的最好的版本，而且我几乎都尝试过（Komodo，各种 Eclipse 插件/Ruby 特定版本，如 RadRails，e 的 beta 版本（现在可能可以使用，但我认为它没有调试器，这对我来说很关键），ArachnoRuby，其他一些我不记得了）。

我发现选择特定于 Ruby 的 Netbeans 版本很重要——使用为 Rails 项目的一些混乱设置而制作的全功能版本，至少在 6.1 左右之前。

只需从此处选择 Ruby 下的下载：http: [//www.netbeans.org/downloads/index.html](http://www.netbeans.org/downloads/index.html)

我不确定对速度的抱怨是什么。启动可能需要一段时间，但谁在乎呢？- 大多数大型 IDE 都可以。编辑代码时肯定没有问题，所以唯一的抱怨可能是在调试期间。除了 Netbeans，我只设法在 Komodo 4.2 和 ArachnoRuby 中进行调试。在单步执行代码时，Netbeans 肯定比 Komodo 4.2 快得多。我不记得为什么我解雇了 ArachnoRuby——可能是因为 Netbeans 是免费的并且为我工作，或者因为我最终添加了 Python 模块（我认为你必须购买 ArachnoPython 作为单独的编辑器）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-05-20T07:34:43.670

您可以使用 visualruby 创建 Windows GUI：

[http://www.visualruby.net](http://www.visualruby.net)

网站上有很多示例和视频。我希望有人查看此解决方案并对此帖子发表评论。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-26T12:45:00.837

[在http://www.netbeans.org/features/ruby/index.html](http://www.netbeans.org/features/ruby/index.html)查看 Netbeans

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-26T12:48:46.850

[ArachnoRuby](http://www.ruby-ide.com/ruby/ruby_ide_and_ruby_editor.php)很好用。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-26T12:49:50.310

如果您是 Eclipse 的粉丝，那么[RDT](http://rubyeclipse.sourceforge.net/)曾经是您的必经之路。我不确定您是否可以将它用于标准的 Eclipse 安装。但是，它是作为[Aptana RadRails](http://www.aptana.com/rails)的一部分积极开发的。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-05-28T06:01:20.900

[Farawla](http://www.getfarawla.com)代码编辑器。

免责声明：我建造了它。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-03-30T15:30:33.467

如果您的意思是要求 GUI 编辑器创建 GUI，那么这取决于您决定在 Ruby 中使用哪个 GUI 库。

如果您选择 WxRuby，您可以使用 XRC 文件将您的 ruby​​ 代码与 GUI 格式分开。

XRC 文件是存储所有 WxWidget 参数的 XML 文件，这些文件是跨平台的：WxRuby、WxPython...等。

您可以使用像“Dialogblocks”这样的 XRC 编辑器来直观地创建您的 GUI - 在垂直或水平 boxsizers 中添加您的元素并获得正确的 x、y 位置和宽度和高度。

然后，您可以加载此 XRC 文件以在 .rb 或 .rbw 文件中创建 WxRuby 对象，并在需要的地方添加回调。

如果您确实选择使用 WxRuby，我建议您也使用 ruby​​ 线程，因为 WxRuby 喜欢时不时地受到 CPU 的关注——同时您的后端脚本正在运行。

# visual-studio - 安装后更改 Visual Studio 安装文件夹

> ID：685575
> 
> 赞同：11
> 
> 时间：2009-03-26T12:34:43.093
> 
> 标签：visual-studio

我安装了 Visual Studio 的分区上的空间不足。将安装复制到另一个分区是否安全？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2013-01-07T18:55:23.870

您可以将文件移动到新位置（手动），然后使用 Junction ( [http://technet.microsoft.com/en-us/sysinternals/bb896768.aspx](http://technet.microsoft.com/en-us/sysinternals/bb896768.aspx) ) 创建一个返回链接。我在 2012 年做到了这一点，它似乎对我有用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-26T12:39:19.323

如果没有尝试过，我敢打赌这是不可能的。

安装文件夹通常存储在许多地方，例如配置文件和注册表。移动后，所有这些引用仍将指向旧的现在无效的位置。而且，更糟糕的是，移动文件夹还会破坏任何安装/卸载/更新例程，这意味着您将无法再安装补丁和服务包。

结论：最好卸载 Visual Studio 并将其移动到新位置。与您最终会导致的头痛相比，它只需要很短的时间。

（或者，如果您不喜欢这样做，您当然仍然可以将新分区挂载到程序文件夹以增加磁盘空间或获得更大的硬盘驱动器）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-09-08T11:57:01.250

我尝试通过安装程序修复或修改它（添加删除程序），因为我将它移动到另一个分区。但没什么，它会因奇怪的错误报告而崩溃。
卸载并重新安装似乎是唯一的选择，但这也不起作用......

我使用了一个 USB 记忆棒，给它旧的 HDD 标签，并像这里描述的那样做了一个连接：
[https ://superuser.com/questions/484061/how-to-create-an-ntfs-junction](https://superuser.com/questions/484061/how-to-create-an-ntfs-junction)

```
mklink /J <new directory to be linked> <target directory>

D:\>mklink /J "Program Files\Microsoft Visual Studio 11.0" "K:\Program Files\Mic
rosoft Visual Studio 11.0" 
```

不幸的是，这不起作用，因为 VS 仍然抱怨其他丢失的文件，但它至少让你卸载它。

编辑：如果您尝试重新安装 VS，它不会让您选择不同的文件夹，请查看此处接受的答案：[如何更改 Visual Studio 2012 安装目录？](https://stackoverflow.com/questions/10068991/how-to-change-vs11-install-directory)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T13:17:28.480

不，这不适用于任何较新版本的 Visual Studio。如果是 2003 年之前，你可能有机会。

# windows - 在 Windows 上查找当前活动的语言

> ID：685580
> 
> 赞同：3
> 
> 时间：2009-03-26T12:36:08.567
> 
> 标签：windows, vb.net, powershell

查找出现在 Windows 语言栏上的当前活动语言的可能解决方案是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T13:03:54.317

`CultureInfo.CurrentCulture`. 这包含有关语言和文化的信息。如果您只想要语言名称，请尝试`CultureInfo.CurrentCulture.ThreeLetterISOLanguageName`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T14:01:20.310

您应该将[Win32 中的多语言 API](http://msdn.microsoft.com/en-us/library/dd319074(VS.85).aspx)作为起点。从文档中可以看出哪个调用会为您提供您想要的东西并不完全明显，但我认为答案可能在于与进程和线程或首选语言相关的调用。您可能需要做一些实验来查看哪些调用给出了匹配语言栏选择的预期结果。

我怀疑最好的尝试是[GetThreadUILanguage](http://msdn.microsoft.com/en-us/library/dd318129(VS.85).aspx)。

# python - 使用 Python comtypes 库向 Excel 添加查询表时出现问题

> ID：685589
> 
> 赞同：5
> 
> 时间：2009-03-26T12:37:53.147
> 
> 标签：python, excel, vba, com, comtypes

我正在尝试使用 Python comtypes 库在 excel 电子表格中创建一个 QueryTable，但得到一个相当无信息的错误......

在 vba 中（在工作簿中的模块中），以下代码可以正常工作：

```
Sub CreateQuery()
    Dim con As ADODB.Connection
    Dim rs As ADODB.Recordset
    Dim ws As Worksheet
    Dim qt As QueryTable

    Set ws = ActiveWorkbook.Sheets(1)

    Set con = New ADODB.Connection
    con.Open ("Provider=Microsoft.Jet.OLEDB.4.0;Data Source=C:\Path\to\Db.mdb;")

    Set rs = New ADODB.Recordset
    rs.Open "Select * from [tbl Base Data];", con

    Set qt = ws.QueryTables.Add(rs, ws.Range("A1"))
    qt.Refresh
End Sub 
```

但是下面的 Python 代码：

```
import sys
import comtypes.client as client

def create_querytable():
    constring = "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=C:\\Path\\to\\Db.mdb"
    conn = client.CreateObject("ADODB.Connection", dynamic = True)
    rs = client.CreateObject("ADODB.Recordset", dynamic = True)

    SQL = "Select * from [tbl Base Data];"

    conn.Open(constring)
    rs.Open(SQL, conn)
    excel = client.CreateObject("Excel.Application", dynamic = True)
    excel.Visible = True
    ws = excel.Workbooks.Add().Sheets(1)
    qt = ws.QueryTables.Add(rs, ws.Range["A1"])
    qt.Refresh()
    rs.Close()
    conn.Close() 
```

抛出无用的错误消息：

```
Traceback (most recent call last):
  File "<pyshell#34>", line 1, in <module>
    create_querytable()
  File "C:/Documents and Settings/cvmne250/Desktop/temp.py", line 17, in create_querytable
    qt = ws.QueryTables.Add(rs, ws.Range["A1"])
  File "G:\ISA\SPSS\comtypes\lib\comtypes\client\lazybind.py", line 160, in caller
  File "G:\ISA\SPSS\comtypes\lib\comtypes\automation.py", line 628, in _invoke
COMError: (-2147352567, 'Exception occurred.', (None, None, None, 0, None)) 
```

关于这里发生了什么的任何想法？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T17:23:07.050

我简化了您的代码，这应该可以正常工作（我将在下面解释更改）：

```
def create_querytable2():
    constring = "OLEDB;Provider=Microsoft.Jet.OLEDB.4.0;Data Source=C:\path\to\db.mdb;"
    SQL = "Select * from tblName;"
    excel = client.CreateObject("Excel.Application", dynamic=True)
    excel.Visible = True
    ws = excel.Workbooks.Add().Worksheets(1)
    ws.QueryTables.Add(constring, ws.Range["A1"], SQL).Refresh() 
```

QueryTables.Add() 函数可以为您创建 Connection 和 Recordset 对象，从而简化了很多事情......您只需在连接字符串（“OLEDB”部分）中添加它的连接类型。

让 Excel 完成大部分工作似乎可以解决您的问题 :)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T13:05:30.257

看起来您的错误在这一行：

```
qt = ws.QueryTables.Add(rs, ws.Range["A1"]) 
```

我认为您的问题是您正在使用 python 语法在 VBA 集合中查找值。尝试将方括号更改为括号。

IE

```
qt = ws.QueryTables.Add(rs, ws.Range("A1")) 
```

原因是在 VBA 中，当您像这样调用 Collection 时`Range("A1")`，实际上是在调用它的默认方法`Range.Item("A1")`. 基本上，VBA 集合不会转换为 python 字典。

我从这个[论坛帖子](http://mail.python.org/pipermail/python-list/2001-December/116793.html)中得到这个，以及我对 VBA 的经验。

* * *

由于评论而编辑：

> 不幸的是，我两种都试过了：正如你的链接中所指出的，它们有时不会做同样的事情，但我的直觉是，'['更有可能是我想要的。——马文

你知道是否`comtypes.client.CreateObject`工作相同`win32com.client.Dispatch`吗？您可以尝试使用 win32com 包创建您的 com 对象，看看是否会有所不同。

# oop - 为什么要在构造函数中初始化成员变量？

> ID：685600
> 
> 赞同：5
> 
> 时间：2009-03-26T12:40:12.067
> 
> 标签：oop, initialization, declaration

当我第一次开始使用面向对象的编程语言时，我被教导了以下规则：

> 在类中声明字段时，先不要初始化它。在构造函数中执行此操作。

C# 中的一个示例：

```
public class Test
{
    private List<String> l;

    public Test()
    {
        l = new List<String>();
    }
} 
```

但是当最近有人问我为什么要这样做时，我想不出一个理由。我不太熟悉 C#（或其他编程语言，就此而言，因为我相信这可以在所有 OO 语言中完成）的内部工作原理。

那么为什么*这样*做呢？是安全吗？特性？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-26T12:44:53.067

*   如果您有多个构造函数，您可能希望将一个字段初始化为不同的值

*   当您在构造函数中初始化字段时，不会混淆它何时相对于构造函数的其余部分进行初始化。对于单个类，这可能看起来微不足道，但当您有一个继承层次结构时，构造函数代码在每个级别运行并访问超类字段时，情况就不那么重要了。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-26T12:43:29.233

C# 编译器将采用您内联执行的任何非静态成员初始化并将其移动到您的构造函数中。换句话说：

```
class Test
{
    Object o = new Object();
} 
```

被编译成这样：

```
class Test
{
    Object o;

    public Test()
    {
        this.o = new Object();
    }
} 
```

我不确定其他语言的编译器如何处理这个问题，但就 C# 而言，这是一个风格问题，你可以随意做任何你想做的事情。 **请注意，静态字段的处理方式不同：** [阅读本文以获取更多信息](http://www.yoda.arachsys.com/csharp/beforefieldinit.html)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T12:49:24.413

这样做的一个原因是它将所有初始化代码放在一个地方，方便其他人阅读您的课程。话虽如此，我并没有真正这样做有两个主要原因。(1) 我使用 TDD/单元测试来定义我的类的行为。如果您想知道无参数构造函数的作用，您应该真正阅读我在无参数构造函数上构建的测试。(2) 对于 C# 3.0，我通常使用自动属性和内联初始化以及无参数构造函数来实例化对象。这更加灵活，它将属性的定义放在代码使用的地方。这将覆盖构造函数中的任何初始化，所以我很少放在那里。当然，这只适用于 C#。

前任。（共 2 个）

```
 var foo = new Foo { Bar = "baz" };

  public class Foo
  {
       public string Bar { get; set; }

       public Foo() { }
  } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T12:46:15.983

有时构造函数具有用于初始化内部变量的参数。例如数组的大小

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T12:50:18.343

我还没有听到不提供两种选择的令人信服的理由。我怀疑真正的原因与从解析的角度简化语言结构有关。在解析赋值语句需要 75% 的语言语法规则的 C 派生语言中尤其如此。在我看来，允许它并定义它如何精确地工作会很好。我同意[Michael](https://stackoverflow.com/questions/685600/why-declare-at-first-by-only-initialse-in-the-constructor/685617#685617)关于插入继承和多个构造函数时复杂性增加的评论，但仅仅因为您添加了一个功能并不意味着您必须使用它。我会投票支持两者，即使我的投票并没有真正加起来。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-26T13:31:05.093

我总是喜欢把类想象成对象的工厂，把构造函数想象成生产线上的最后一站。类中声明的字段是描述对象的蓝图，但是在通过调用构造函数对此类对象进行排序之前，蓝图不会被实现为对象......另外，正如有人指出的那样，在您的构造函数将提高可读性，并且它将提供初始化的动态性（它可能不是您正在处理的无参数构造函数）。

此外，在某些语言中，构造函数可用于将对象重置为原始状态，这就是为什么必须在构造函数中实例化对象的原因。

# c++ - 关于 C/C++ 堆栈分配

> ID：685601
> 
> 赞同：7
> 
> 时间：2009-03-26T12:40:31.580
> 
> 标签：c++, c, memory-management, stack, heap-memory

在学习 C++（和 C）时，我对堆栈分配的工作有一些特别的疑问，我找不到解决方案：

1.  堆栈分配是否隐式调用 malloc/free 函数？如果不; 它如何确保堆栈分配和堆分配之间没有冲突？

2.  如是; C++ 中的堆栈分配是否也隐式调用 new/delete？如是; 重载类的新运算符会影响其堆栈分配吗？

它在 VC++ 中产生了令人困惑的结果；但由于 VC++ 并不完全符合标准（或者我听说过），我决定我最好在这里问...

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-03-26T12:44:37.687

堆栈分配不使用 malloc/free 之类的东西。它使用一块称为程序堆栈的内存，它只是一段连续的内存。

有一个特殊的寄存器存储栈顶。当在堆栈上创建新对象时，顶部会升高，从而增加堆栈，当对象被释放（超出范围）时，顶部会降低，从而减少堆栈。

如果您尝试在堆栈上分配一个太大的对象或进行太深的递归，则顶部将超出堆栈的最大允许大小，这称为堆栈溢出。

注意：堆栈增长的实际方向（增加或减少地址）[会因系统而异](https://stackoverflow.com/questions/664744/what-is-the-direction-of-stack-growth-in-most-modern-systems)，但无论实际方向如何，总体思路都是相同的。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-03-26T12:42:25.400

第一个问题的答案是否定的。堆栈根本不是从堆中分配的。

您应该首先阅读[堆栈和堆是什么以及在哪里](https://stackoverflow.com/questions/79923/what-and-where-are-the-stack-and-heap)以了解基本概念。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-26T12:47:09.647

堆栈分配通常根据 alloca() 或由编译器隐式完成。一个做得好的 alloca() 只需要很少的指令，完成后没有成本（甚至不需要）释放它。

您可以将指向由 alloca() 分配的内存的指针传递给任何其他需要指针的函数/方法。你绝不能返回由 alloca() 分配的指针。

以下是使用堆栈分配的一些[优点](http://www.gnu.org/software/libtool/manual/libc/Advantages-of-Alloca.html)和[缺点。](http://www.gnu.org/software/libtool/manual/libc/Disadvantages-of-Alloca.html#Disadvantages-of-Alloca)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-26T13:31:49.897

这里有一个很好的问题：

> “它如何确保堆栈分配和堆分配之间没有冲突？”

几乎所有 C/C++ 实现中都有一个连续的地址空间，因此堆栈和堆分配的内存必须在该空间中共存。

尽管每次堆栈增长和收缩都不是通过单独的堆分配来完成的，但您仍然可以将堆栈视为从堆分配的单个大内存块。如果堆栈超出该块的边界，那么我们就会出现堆栈溢出（醒目的名字......有人应该在它之后命名一个网站）。

在多线程程序中，每次线程启动时，都必须为其分配一个新的堆栈，而当一个线程死亡时，堆栈可以被释放。`malloc`并且使用与/公开的相同的堆管理来分配这些全栈块是有意义的`free`。

所以 - 非常近似地说 - 您可以将堆栈视为一种在堆中共存的对象。当一个线程启动时，一个完整的堆栈被`malloc`一次性全部 -ed，然后它被子分配，然后它`free`一次性得到 -d。

在 Windows 上，您可以（如果您喜欢危险地生活）[自己调用相同的虚拟内存 API](http://www.codeproject.com/KB/cpp/StackShrink.aspx?fid=253775&df=90&mpp=25&noise=3&sort=Position&view=Quick&select=1341672)来了解堆栈并强制释放其中的虚拟页面。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-26T12:55:28.580

在 C 和 C++ 中，有两种类型的内存分配“自动”，其中对象是在函数调用的生命周期内创建的，以及“动态”，其中一些内存由运行时提供的函数分配。

在绝大多数运行时实现中，自动对象是使用创建线程时操作系统提供的连续堆栈分配的。堆栈通常从高值地址开始，并按对象的大小递减。动态分配（C 中的 malloc，C++ 中的 new）使用操作系统请求的其他一些内存。由于操作系统知道堆栈正在使用的地址，它不会为动态请求分配相同的地址。由于动态区域是无序的，所以通常称为堆。

所以“堆栈”分配不是 malloc/free。C++ 中的自动对象调用构造函数和析构函数，但不调用 new 或 delete，因为 new 和 delete 也有管理动态内存的代码。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-26T12:44:21.527

不，堆栈分配不调用 malloc/free。整个堆栈空间在程序开始时分配。在进入每个函数时，堆栈指针被推进到足以在堆栈上为“堆栈帧”留出空间，这将是堆栈分配的变量所在的位置。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-26T14:09:49.637

Kepp 记住，“堆栈分配”是一个实现细节。不能保证堆栈用于自动存储。例如，传说中的 IBM 大型机没有（尽管有人告诉我他们更现代的机器有）。

# wcf - 使用 Wcf 流式传输图像文件

> ID：685603
> 
> 赞同：5
> 
> 时间：2009-03-26T12:41:33.810
> 
> 标签：wcf, streaming, wcf-client

我想通过 Wcf 将大图像发送到服务器。我可以将其作为字节 [] 传递。我该怎么做。什么是 MTOM...我在哪里可以找到示例...？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T12:53:44.887

MTOM 只是一种优化的消息编码格式。它代表消息传输优化机制，并以字节而不是尖括号（又名 XML）的形式传输。[这](http://www.codeproject.com/Articles/632101/Mtom-Encoding-in-WCF)是使用 WCF 使用 MTOM 的基本介绍。

[如果您想使用流式传输，这个小示例](http://blog.joachim.at/?p=33)应该可以帮助您入门，如果您想传输大文件，这是一个不错的选择。

# sql-server - SQL Server 代码审查和最佳实践的资源

> ID：685608
> 
> 赞同：9
> 
> 时间：2009-03-26T12:42:43.730
> 
> 标签：sql-server, coding-style

T-SQL 编码标准有什么好的资源吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T12:53:45.760

看看这个优秀的资源：

[改进 SQL Server 数据库的 SSW 规则](http://www.ssw.com.au/ssw/Standards/Rules/RulesToBetterSQLServerDatabases.aspx)

这也很好，尽管自文章发布于 2001 年以来，一些建议可能已经改变）：

[SQL Server TSQL 编码约定、最佳实践和编程指南](http://www.sql-server-performance.com/articles/dev/sql_best_practices_p1.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T12:56:58.250

我是 ASP.NET 应用程序的开发人员，我的经理要求我将我的 SQL 语句提交给 DBA 以供审查。我所做的是将应用程序中使用的所有 SQL 合并到一个模块文件中。（带有只读字符串的 VB .NET 模块）

仅举几个任务，即兴发挥。

1.  所有 SQL 语句都必须使用参数化查询。这是一个很好的做法。使用参数（即 Oracle 中的绑定变量）时，无法进行 SQL 注入。一些人报告了使用绑定变量的显着性能提升。对于 Oracle 来说尤其如此。不确定 MS SQL

例如使用 "SELECT username FROM user WHERE userid = @userid" 而不是 Dim sql as String = "SELECT username FROM user WHERE userid = {0}" sql = String.Format(sql, userid)

2.  不应使用“SELECT *”。列必须明确命名。

3.  应尽可能使用 JOINS 而不是 NESTED QUERIES。

4.  减少 VIEWS 的使用，因为这会影响性能。（这是有争议的）我的经理走极端禁止使用视图。我们将开发性能和可扩展性比代码可读性更重要的东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T13:03:19.687

对于 SQL 编码标准，最好的办法是搜索其他人编写的内容。有几个资源包含各种人发布的标准。您不太可能找到一个完全适合您的组织的产品。另外，有些人的标准是恕我直言是完全错误的。最好的办法是通读您找到的文档并提取有意义并适合您的组织的概念和规则。一些标准可能是矫枉过正的，比如如何缩进代码。这取决于您希望标准有多严格。这里有一些例子：

[http://www.nyx.net/~bwunder/dbChangeControl/standard.htm](http://www.nyx.net/~bwunder/dbChangeControl/standard.htm)

[http://www.SQLAuthority.com](http://www.SQLAuthority.com)

[http://www.SQLserverPortal.com](http://www.SQLserverPortal.com)

您必须四处查看链接二和三，因为我手边没有确切的 URL。还可以查看上面 Mitch Wheat 发布的链接。这些只是一些示例，但您可以通过搜索找到更多。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-28T18:09:40.760

我在多个组织中为 SQL Server 做出了贡献或实施了编码实践。您可以花几天时间研究其他人所做的事情，但您可能会使用碎片，但我发现每个环境都是完全独特的。

在高层次上......我建议尽可能将功能与形式分开。我是什么意思？有一些最佳实践可以针对您的特定环境和应用程序进行测试和记录，例如何时在大型查询上使用临时表、无锁、动态 sql 使用、查询提示、配置。这些可能完全取决于硬件和使用情况。然后还有其他更多基于意见的标准：命名约定、模式的使用、过程、视图、功能、版本控制等。后一组可能会变得非常政治化——真的是政治化的。从小处着手也是一个好主意——一次实施一点。

在外部供应商上，我发现在对性能产生影响之前进行影响是不切实际的（例如：导致大量表扫描的显式查询提示）。然后提供数据并让他们修补它是最有效的。如果有某种服务合同，我看不出您如何执行实践。请注意，他们可能正在为多个版本和/或平台编写代码，并希望代码尽可能灵活。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-03-26T12:45:58.183

我建议从 codeplex.com 下载并安装示例数据库 AdventureWorks

[http://www.codeplex.com/MSFTDBProdSamples](http://www.codeplex.com/MSFTDBProdSamples)

它是由 Microsoft 员工创建的，具有非常好的设计，可以作为示例（a la Best Practices）。

我还建议阅读这本书：

[专业的 Microsoft SQL Server 2008 管理](https://rads.stackoverflow.com/amzn/click/com/0470247967)

[专业的 Microsoft SQL Server 2008 管理 http://ecx.images-amazon.com/images/I/519z8XkHJyL._BO2,204,203,200_PIsitb-sticker-arrow-click,TopRight,35,-76_AA240_SH20_OU01_.jpg](http://ecx.images-amazon.com/images/I/519z8XkHJyL._BO2,204,203,200_PIsitb-sticker-arrow-click,TopRight,35,-76_AA240_SH20_OU01_.jpg)

# java - 扩展 jog4j RollingFileAppender rollOver() 访问级别的问题

> ID：685619
> 
> 赞同：1
> 
> 时间：2009-03-26T12:45:26.360
> 
> 标签：java, logging, log4j, access-modifiers

我正在尝试扩展 RollingFileAppender，以便即使没有消息进入日志系统，它也会旋转。通常，当消息到达并进行时间检查以触发旋转时，会调用 rollOver 方法。

我的 RollingFileAppender 版本将每 x 秒调用一次 rollOver，这样即使没有消息到达，我也可以保证轮换。

现在我的问题是 RollingFileAppender rollOver 的访问级别修饰符没有修饰符。因此，我不能像我希望的那样每隔 x 秒调用一次。

```
 /**
     Rollover the current file to a new file.
  */
  void rollOver() throws IOException { 
```

现在查看代码，我不明白为什么它不需要修改器，我决定将该类放入我的包中并调用 rollOver。

现在这感觉很脏，如果我想调用翻转，我还有其他选择吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T14:39:49.343

你当然可以使用反射来做到这一点。

从主干或标签 1.2.15 中提取的源代码：[svn at apache](http://svn.apache.org/viewvc/logging/log4j/tags/v1_2_15/src/main/java/org/apache/log4j/RollingFileAppender.java?view=markup)

```
public // synchronization not necessary since doAppend is alreasy synched
void rollOver() {
  File target;
  ... 
```

我们谈论的是同一件事吗：log4j-1.2.15？

# php - 用于表单密集型应用程序的 PHP 框架

> ID：685623
> 
> 赞同：8
> 
> 时间：2009-03-26T12:46:41.177
> 
> 标签：php, forms, frameworks

我正在为正在从 Access 迁移到 PHP 的应用程序寻找一个易于学习的 php 框架。该应用程序有很多表单（有时每页 50 多个字段），并且很多字段是相互依赖的（即，您更改一个字段，它会更新一些其他字段或选项）。

有什么好的php框架吗？我更喜欢它非常简单，因为：

*   开发人员没有那么有经验
*   该数据库是从 Access 迁移而来的，并且在设计时并未考虑 OOP，它基本上是按功能划分的表的集合，因此我可能不需要任何 ORM（至少目前如此）。

最重要的是表单设计和字段关联的易用性（例如：两个列表框，其中第二个的值取决于第一个的选定值） - 我知道大多数 ajax 库对此都有一些支持，但我想它开箱即用。

* * *

编辑：作为澄清，最重要的不是 ajax 漂亮的东西，尽管它很重要。重要的是创建基于数据库的表单的**直接方法。**db 在设计时没有考虑到 ORM，所以我不需要在 ORM 层上使用花哨的表关联来进行级联删除等。如果 ORM 层没有妨碍并简化实现，那没关系，但我怀疑这将永远是真的。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-26T13:09:55.770

我刚刚使用 codeIgniter 做了一个类似但更简单的应用程序，它有一个非常好的[表单助手](http://codeigniter.com/user_guide/helpers/form_helper.html)

代码示例：

```
form_hidden('userName', 'johndoe');
// Would produce: <input type="hidden" name="username" value="johndoe" />

form_input('username', @$_POST['userName'])
// Would produce an input populated with a variable  from the post array 
```

您可以使用数组等进行各种操作：

```
$js = 'id="shirts" onChange="some_function();"';

echo form_dropdown('shirts', $options, 'large', $js); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-26T13:17:01.353

虽然我肯定会在优秀且易于学习的[CodeIgniter](http://codeigniter.com/)背后添加我的支持，但我担心到目前为止每个人都在这个问题上错过了房间里的大象。

老实说，对于没有太多经验的开发人员来说，我认为*任何*框架都不会让每个页面包含 50 多个表单的应用程序更简单或更容易。特别是增加了对下拉依赖项的 ajax 就绪支持的要求。

话虽如此，如果您正在寻找功能和灵活性，我会选择 Zend。如果您正在寻找直接的简单性，我会选择 CodeIgniter。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-26T13:08:33.730

[Code Igniter](http://codeigniter.com)有一些非常好的关于表单的文档，并为您处理了很多复杂性。

表单验证类记录在这里：[http ://codeigniter.com/user_guide/libraries/form_validation.html](http://codeigniter.com/user_guide/libraries/form_validation.html)

还有一个表单助手类，它使创建表单变得非常容易。

[http://codeigniter.com/user_guide/helpers/form_helper.html](http://codeigniter.com/user_guide/helpers/form_helper.html)

这肯定比从头开始构建 Web 应用程序更容易！

[![](https://i.stack.imgur.com/Zo1Hz.jpg)](https://i.stack.imgur.com/Zo1Hz.jpg)
[（来源：[codeigniter.com](http://codeigniter.com/user_guide/images/ci_logo_flame.jpg)）]

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-26T13:33:04.310

我是 symfony 的忠实粉丝，它的表单助手对表单有很好的支持。查看文档以获取表格：

[http://www.symfony-project.org/book/1_2/10-Forms](http://www.symfony-project.org/book/1_2/10-Forms)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-26T12:54:10.613

看看[Zend Framework](http://framework.zend.com)，特别是[Zend_Form](http://framework.zend.com/manual/en/zend.form.html)。

它是企业级的，有优秀的初学者到高级教程以及“官方”培训课程，而且是免费的。

您可能还想查看[CodeIgniter](http://codeigniter.com/)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-07-28T14:09:43.803

毫无疑问，最好的是[Zebra_Form，一个 jQuery 增强的 PHP 库，用于创建和验证 HTML 表单](http://stefangabos.ro/php-libraries/zebra-form/)：提供服务器端和客户端验证（客户端验证使用 jQuery 1.5.2+ 完成）并且有很多可以开箱即用的预定义规则；可以轻松添加自定义验证规则（包括基于 AJAX）；集成了跨站脚本 (XSS) 预防机制，可自动从提交的数据中去除潜在的恶意代码，还具有防止跨站请求伪造 (CSRF) 攻击的功能；它可以防止自动垃圾邮件发布，开箱即用，并且通过使用蜜罐不依赖 CAPTCHA；表单的布局可以使用模板自动或手动生成；易学、成熟、不断完善；

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-01-26T09:11:28.033

哇，这个问题太过时了！无论如何，我也认为[Symfony (SF) 是 PHP 的最佳通用框架](http://symfony.com/)，但是在 SF 2.0+ 中，表单确实很复杂（因此很复杂），我不认为 Symfony 是表单密集型的好选择应用程序，除非它的要求非常具体。意识到你需要什么是很重要的：如果它是代码的重用（在这种情况下是表单），SF 真的很好，而且他们的方法与 Java EE 项目中采用的方法非常相似。但是，如果您想要快速获得结果，我会寻找其他地方，也许是 Javascript 框架。

如果您想直接使用 JavaScript，请查看[jQuery Form Framework 项目](http://www.jformer.com/)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-03-08T18:10:08.803

撇开通用框架不谈，对于以 UI 为中心的应用程序，我推荐[ATK UI](https://github.com/atk4/ui)。它在 MIT 许可下相对较新（2017 年发布）。这就是为什么它是 OP 的好选择：

*   专为不懂 HTML/CSS 的人设计。
*   创建一个表单只需要几行 PHP 代码。
*   与数据库一起使用或不使用（取决于您）。
*   处理各种类型，甚至通过扩展名上传文件。
*   与 SemanticUI 集成，完全响应。

安装：在[www.agiletoolkit.org](https://www.agiletoolkit.org/)或通过`composer require atk4/ui`.

句法：

```
 <?php

 $app = new \atk4\ui\App();
 $app->initLayout('Centered');
 $form = $app->add('Form');

 $form->addField('name');
 $form->addField('date', null, ['type'=>'date']);

 $form->onSubmit(function($form){ 
    return 'Hello, '.$name;
}); 
```

不需要其他任何东西，只需安装任何东西或复制资产，它就可以工作。如果您愿意，可以与 WP、Laravel 和其他一些全栈框架集成。

# c# - 在 C# 中的另一个类中声明的类

> ID：685629
> 
> 赞同：48
> 
> 时间：2009-03-26T12:48:37.723
> 
> 标签：c#, oop, class

我正在处理一些遗留代码并且遇到了一些我不确定的东西。我们有一个`class y`在另一个内部声明的`class x`。`Class y`只在里面使用过，`class x`但我的问题是你为什么不创建一个单独的类文件并放在`class y`里面而不是在里面声明它`class x`？这不是违反 OOP 还是只是风格问题，因为它只在此类内部使用过。我正在重构其中的一些代码，我的第一反应是分离`class y`到它自己的文件中。

```
namespace Library
{
   public class x
   {
      // methods, properties, local members of class x

      class y
      {
         // methods, properties, local members of class y
      }
   }
} 
```

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2009-03-26T12:51:17.717

您创建了一个内部类，因为它只在类 x 的范围内使用，并且它在逻辑上适合类 x 的分解/架构。

类 y 也可能知道类 x 的实现细节，这些细节不应该为公众所知。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-03-26T12:52:21.567

这具有权限含义。顶级“y 类”将是“内部”——然而，这里的“y”是“x”私有的。这种方法有助于实现细节（例如缓存行等）。同样，`y`可以访问`x`.

泛型也有影响。`x<T>.y`是泛型的“T”，继承自外部类。您可以在此处看到这一点，其中`Bar`充分使用了`T`- 并注意任何静态字段的`Bar`范围都是- `T`。

```
class Foo<T> {
    void Test(T value) {
        Bar bar = new Bar();
        bar.Value = value;
    }
    class Bar {
        public T Value { get; set; }
    }
} 
```

人们经常错误地认为他们需要定义`Bar`为`Bar<T>`- 现在（有效地）*双重*通用 - 即`Foo<TOld, T>`- `TOld`（现在不可用）`T`来自哪里`Foo<T>`。所以不要那样做！或者，如果您**希望**它具有双重通用性，请选择不同的名称。幸运的是，编译器会警告您这...

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-26T12:55:52.557

由于您给出的确切原因，此代码很好 - “类 y 仅在类 x 内使用”。这些是[嵌套类型](http://msdn.microsoft.com/en-us/library/ms229027.aspx)，使用它们的准则之一是嵌套类型应该与其声明类型紧密耦合，并且不能用作通用类型。这样嵌套类就无法访问其他类，但仍然允许您遵循面向对象的原则。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-26T12:53:50.003

我认为没关系，只要包含的类仅用作实用程序即可。例如，我使用这种构造来定义私有方法的复杂返回类型。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-26T12:54:12.843

我刚刚浏览了我正在更新的代码（我最初编写的）并删除了所有嵌套类。不幸的是，我最初在定义它的类之外使用了嵌套类。将嵌套类移出对我产生了巨大的影响，因为我最初的设计很糟糕。

如果 Y 只在 X 中使用并且永远不会在 X 之外使用，我会说保留它

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-26T13:24:49.667

让我给你一个使用嵌套类的例子，它可能会阐明这种架构何时是合适的。我最近需要通过从数据表中提取选定的列并“旋转”它们以使行变为列，反之亦然，从而生成一个 HTML 表。在我的例子中，有两个基本操作：旋转数据并生成一些相当复杂的输出（我不只是显示数据：每个数据列/表行都受制于提取标题、生成图像标签、设置链接的操作，等等，因此使用 SQL Pivot 也不是很正确）。

在最初尝试创建一个类来完成整个事情之后，我意识到大部分数据/方法分为三个不同的部分：标题处理、行处理和数据透视。因此，我决定更好的方法是将“标题”和“行”的逻辑封装到单独的嵌套类中。这使我能够分离每行保存的数据并非常干净地对数据透视操作进行编程（为数据表中的每一列调用单独的行对象）。在枢轴操作结束时，我通过调用标头对象生成输出，然后依次调用每个行对象将其输出生成回主类。

单独的类是不合适的，因为 A) 嵌套类确实需要来自主类的一些数据，并且 B) 处理非常具体，在其他地方没有用。由于诸如“列”和“行”之类的术语会因您谈论的是数据还是 HTML 输出而有所不同，因此仅仅对一个大类进行编程就会变得更加混乱。此外，这是一项不寻常的工作，因为我在业务类中生成 HTML，因此我想将纯业务逻辑与 UI 生成分开。最后，嵌套类提供了封装和数据共享的完美平衡。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-26T13:51:55.497

你仍然可以将你的类 y 重构到另一个文件中，但是使用一个 parial 类。这样做的好处是每个文件仍然有一个类，并且没有将声明移到类 x 之外的重构麻烦。

例如，您可以有一个代码文件：xycs，它看起来像

```
partial class X
{
    class Y
    {
        //implementation goes here
    }
} 
```

# .net - ADO.NET 实体框架 - LINQ 到多个 dbms

> ID：685635
> 
> 赞同：0
> 
> 时间：2009-03-26T12:51:05.800
> 
> 标签：.net, sql-server, linq, entity-framework

是否可以创建一个“实体”，它将是位于两个不同表中、两个不同数据库中、两台不同机器上，甚至可能使用两个不同 dbms 中的表之间关系的抽象？

例如，如果我在一台机器上有一个 SQL Server 数据库来存储我的所有客户，而我在另一台机器上有一个 Oracle 数据库来存储我的所有订单，是否可以将它包装在一个实体中，然后在一个LINQ表达式，好像他们在一起？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T12:58:20.947

哇，这将是最终的 n 层解决方案！

据我所知不是。除非您创建一个视图并将 EF 绑定到该视图，否则它将是只读的（显然）？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T12:58:02.913

您可以为每个文件使用具有不同命名空间的多个 dbml 文件（如 Myproject.Data.Customer、Myproject.Data.Orders 等）。

我认为通过这种方式，您可以使用驻留在不同机器上的多个数据库。为不同的数据库使用不同的命名空间提供了非常好的隔离，它将帮助您将每个数据库层分开，并且您可以让单独的人员/团队独立地在每一层上工作。

您可以将所有这些放在单个层/命名空间中，但这会使事情变得更加复杂和难以维护。

# java - 从 Java 执行的 Windows 进程未终止

> ID：685641
> 
> 赞同：9
> 
> 时间：2009-03-26T12:52:29.150
> 
> 标签：java, windows

我正在使用 Java 在 Windows 上创建一个进程。我的问题是这个过程不会终止。这是一个示例程序：

```
import java.io.IOException;

public class Test {

/**
 * @param args
 * @throws IOException
 * @throws InterruptedException
 */
public static void main(String[] args) throws IOException,
        InterruptedException {
    Process process = Runtime.getRuntime().exec("cmd /c dir");
    process.waitFor();
    }
} 
```

由于我无法理解的原因，这个程序永远不会完成。如果将“cmd /c dir”替换为 ipconfig 以及其他内容，则这是正确的。

我可以看到使用 ProcessExplorer，java 创建了 cmd 进程。这个样本显然是一个简化；在我的原始程序中，我发现如果我在一段时间后调用 process.destroy() 并检查 cmd 进程输出，则命令执行成功。

我已经尝试过使用 Java 1.5 和 1.6 的各种版本。我的操作系统是 Windows XP Pro，SP 2。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-26T12:57:10.403

可能您只需要读取进程的 stdout 和 stderr，否则它会因为其输出缓冲区已满而挂起。如果您将 stderr 重定向到 stdout，这是最简单的，只是为了安全起见：

```
public static void main(String[] args) throws IOException,
                InterruptedException {
        String[] cmd = new String[] { "cmd.exe", "/C", "dir", "2>&1" };
        Process process = Runtime.getRuntime().exec(cmd);
        InputStream stdout = process.getInputStream();
        while( stdout.read() >= 0 ) { ; }
        process.waitFor();
    }
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-26T12:57:50.417

有关说明，请参阅此[链接](http://www.javaworld.com/javaworld/jw-12-2000/jw-1229-traps.html?page=2)。

您需要读取输入流。此外，java 进程不像 dos shell 那样工作。您需要自己传递参数：

```
String[] cmd = new String[3];
cmd[0] = "cmd.exe" ;
cmd[1] = "/C" ;
cmd[2] = "dir";
Runtime rt = Runtime.getRuntime();
Process proc = rt.exec(cmd); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T13:10:25.673

您应该尝试使用`ProcessBuilder`如下所示的。不知道有什么不同，但这为我们解决了很多问题。

```
ProcessBuilder pb = new ProcessBuilder(CMD, ARG1, ARG2);  
Process p = pb.start(); 
```

# asp.net - 为jQuery寻找一个好的datagrid插件

> ID：685664
> 
> 赞同：8
> 
> 时间：2009-03-26T12:59:53.890
> 
> 标签：asp.net, jquery

我需要让我的用户维护一些帐户和住宿。每个帐户可以 1 到多个住宿，每个住宿仅链接到 1 个帐户。

我希望能够让用户编辑帐户详细信息。在同一页面上，我想列出链接到该帐户的住宿，并允许用户将更多住宿链接到该帐户，双击住宿以编辑其详细信息，也可以取消链接住宿。

我认为这非常适合为住宿提供数据网格，以及可能为数据网格添加更多住宿的查找字段。谁能推荐一个 jQuery 数据网格？

编辑：环顾四周，发现以下内容。

*   jqGrid
*   弹性网格
*   英格丽德

到目前为止我最喜欢的看起来像 jqGrid

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-26T13:21:15.117

我现在正在使用 jqGrid。我比 Flexigrid 更喜欢它，原因如下：

*   支持[树、子网格和其他向下钻取功能](http://trirand.com/jqgrid/jqgrid.html)
*   行内和弹出式表单编辑的许多选项。
*   多个主题可供选择，[支持](http://www.trirand.com/jqgrid35/jqgrid.html)即将到来的 RSN 的 jQuery UI 主题。
*   有实际的[文档](http://www.secondpersonplural.ca/jqgriddocs/index.htm)
*   对我来说，自定义做一些网格都没有“开箱即用”的事情对我来说非常容易

更新：我写[了一篇更详细的关于它的优点和缺点的短文](http://blogs.teamb.com/craigstuntz/2009/04/14/38200/ "将 jqGrid 与 ASP.NET MVC 一起使用：简介")，但重点是 ASP.NET MVC。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-26T13:02:15.350

[Flexigrid](http://code.google.com/p/flexigrid/)是最好的。极力推荐。

这是->[样本](http://www.sanderkorvemaker.nl/test/flexigrid/)

另一种选择是[jqGrid](http://www.trirand.com/blog/)。这是 -> [DEMO](http://www.trirand.com/jqgrid/jqgrid.html)。还有更多有趣的功能。但在我看来它看起来很丑。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-10-27T17:09:08.883

下面的 Jquery 网格很棒，您不必为网格中定义的字段创建添加、编辑表单。

[http://www.jtable.org/](http://www.jtable.org/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-07-15T18:31:17.493

只是添加一个注释，试试[http://www.jqwidgets.com/](http://www.jqwidgets.com/)，他们也有很好的控制。

# php - 使用 imap_open 在 PHP5 中连接到 Exchange 2007 服务器时出现问题

> ID：685665
> 
> 赞同：4
> 
> 时间：2009-03-26T13:00:25.963
> 
> 标签：php, exchange-server-2007, imap-open

当我尝试在 PHP5 中通过 IMAP 连接到 Exchange 2007 服务器时，我收到以下错误消息。

```
Kerberos error: No credentials cache found (try running kinit) for smtp.domain01.net 
```

我想知道是否有人找到解决此问题的方法？

相关信息： [http ://bugs.php.net/bug.php?id=33500](http://bugs.php.net/bug.php?id=33500)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-10-10T05:31:59.773

只是偶然发现了这个问题，并认为我会回答这个问题，因为没有其他人有。以下页面就如何解决问题给出了非常直接和准确的答案：[http ://forums.kayako.com/threads/fix-kerberos-error-on-email-parser.29626/](http://forums.kayako.com/threads/fix-kerberos-error-on-email-parser.29626/)

基本上这里发生的事情（根据[http://social.technet.microsoft.com/Forums/en-US/exchangesvradmin/thread/43aef3d6-3e91-4e41-a788-ae073393ad37/](http://social.technet.microsoft.com/Forums/en-US/exchangesvradmin/thread/43aef3d6-3e91-4e41-a788-ae073393ad37/)）是 Microsoft Exchange 2007 广播格式错误的 Kerberos 令牌，这会导致 PHP IMAP 驱动程序终止流。其他一些消息来源声称这是[一个 PHP 错误](https://bugs.php.net/bug.php?id=33500)，总之解决方案需要您在禁用 Kerberos 的情况下重新编译 PHP-IMAP 扩展。这将强制 PHP IMAP 使用纯文本身份验证并解决您的问题。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-13T16:25:24.140

默认情况下，Exchange 确实启用了 IMAP 协议。即使是这样，IMAP 的 Exchange 实现也可能真的是 IMAP，也可能不是。也就是说，[这个 Technet 线程](http://social.technet.microsoft.com/Forums/en-US/exchangesvrtransport/thread/1a84a06a-f1c8-40b4-ace8-1e264f218aa1)可能适用于您的情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-09-08T02:54:35.710

我知道这是一个旧问题，但是在多年没有问题之后最近几次遇到这个问题之后，其他原因是我们的原因。原来 Exchange 服务器只需要重新启动 IMAP 服务！

很多网站的共识与上述答案相同，但我真的不想走重新编译 PHP 的道路。对我来说，这个问题似乎与 Kerberos 或 PHP 问题无关，只是一个简单的身份验证问题。可能该服务需要重新启动，因为它正在发送格式错误的令牌......希望其他人会发现这很有帮助。

# python - 在 Python 中，如何获取列表并将其减少为重复列表？

> ID：685671
> 
> 赞同：0
> 
> 时间：2009-03-26T13:01:52.357
> 
> 标签：python

我有一个应该是唯一的字符串列表。我希望能够快速检查重复项。具体来说，我希望能够获取原始列表并生成一个包含任何重复项的新列表。我不在乎这些项目重复了多少次，因此如果有两个重复项，则不必有两次单词。

不幸的是，我想不出一种不笨拙的方法来做到这一点。有什么建议么？

编辑：感谢您的回答，我想我会澄清一下。我不关心为了它自己而拥有一个独特的列表。我正在根据文本文件生成列表，我想知道重复项是什么，以便我可以进入文本文件并在出现时删除它们。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-26T13:06:04.703

此代码应该可以工作：

```
duplicates = set()
found = set()
for item in source:
    if item in found:
        duplicates.add(item)
    else:
        found.add(item) 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-26T13:12:03.767

`groupby`来自[itertools](http://docs.python.org/library/itertools.html)可能在这里有用：

```
 from itertools import groupby
duplicated=[k for (k,g) in groupby(sorted(l)) if len(list(g)) > 1] 
```

基本上，您使用它来查找多次出现的元素......

注意。需要调用 to `sorted`，因为`groupby`只有在对输入进行排序时才能正常工作。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-26T13:08:43.870

这将在一行中创建列表：

```
L = [1, 2, 3, 3, 4, 4, 4]
L_dup = set([i for i in L if L.count(i) > 1]) 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-26T13:09:41.543

绝对不是最快的方法，但它似乎可以解决问题：

```
>>> lst = [23, 32, 23, None]
>>> set(i for i in lst if lst.count(i) > 1)
{23} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-04-22T01:49:19.540

这是一个简单的 1-liner：

```
>>> l = ['a', 'a', 3, 'r', 'r', 's', 's', 2, 3, 't', 'y', 'a', 'w', 'r']
>>> [v for i, v in enumerate(l) if l[i:].count(v) > 1 and l[:i].count(v) == 0]
['a', 3, 'r', 's'] 
```

`enumerate`返回一个索引列表，我们用它来拼接我们的输入列表，以确定循环中当前索引之前是否有任何重复项以及我们是否已经在后面找到了重复项。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-26T13:13:36.337

如果您不关心重复项的顺序：

```
a = [1, 2, 3, 4, 5, 4, 6, 4, 7, 8, 8]
b = sorted(a)
duplicates = set([x for x, y in zip(b[:-1], b[1:]) if x == y]) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-26T23:10:18.900

就个人而言，我认为这是实现 O(n) 性能的最简单方法。类似于 vartec 的解决方案，但不需要`import`担心 Python 版本依赖项：

```
def getDuplicates(iterable):
    d = {}
    for i in iterable:
        d[i] = d.get(i, 0) + 1
    return [i for i in d if d[i] > 1] 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-09T15:06:01.707

基于 'set' 的解决方案有一个小缺点，即它们仅适用于可散列对象。

另一方面，基于 itertools.groupby 的解决方案适用于所有可比较的对象（例如：字典和列表）。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-03-26T13:29:55.237

编辑：好的，因为您只想要重复项，所以不起作用。

## 使用 python > 2.4 ：

您已经设置，只需执行以下操作：

```
my_filtered_list = list(set(mylist)) 
```

Set 是一种本质上没有重复的数据结构。

## 使用较旧的 Python 版本：

```
my_filtered_list = list(dict.fromkeys(mylist).keys()) 
```

字典将唯一键映射到值。我们使用“唯一”特征来消除重复。

# sql - 将数据迁移到同一文件组中的其他文件对空文件的性能影响

> ID：685677
> 
> 赞同：4
> 
> 时间：2009-03-26T13:02:37.940
> 
> 标签：sql, sql-server-2005, sqlperformance

我们目前有一个位于 15000 RPM 驱动器上的数据库，它只是一个日志数据库，我们希望将其移动到 10000 RPM 驱动器上。虽然我们可以轻松地分离数据库、移动文件并重新附加，但这会导致我们试图避免的轻微中断。

所以我们正在考虑使用`DBCC ShrinkFile with EMPTYFILE`. 我们将在 10000 RPM 驱动器上创建比 15000 RPM 驱动器上的现有文件稍大的数据和事务文件，然后执行`DBCC ShrinkFile with EMPTYFILE`迁移数据。

这会产生什么样的影响？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-29T23:12:42.707

我试过这个，运气好坏参半。我有一些文件无法清空的实例，因为它是主文件组中的主文件，但我也有一些实例可以完全正常工作。

但是，它在工作时确实在数据库中持有巨大的锁。如果您尝试在运行最终用户查询的实时生产系统上执行此操作，请忘记它。他们会遇到问题，因为这需要一段时间。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T14:55:50.210

为什么不使用日志传送。在 10.000 rpm 磁盘上创建新数据库。设置从 15K RPM 的 db 到 10k RPM 的 DB 的日志传送。当两个数据库不同步时，停止日志传送并切换到 15K RPM 的数据库。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-30T22:45:40.113

这是连接到 SAN 的系统，还是直接连接的存储？如果它是 SAN，则将 SAN 端迁移到新的 RAID 组，并且服务器永远不会知道发生了变化。

# bitmap - 如何以编程方式检测位图是否具有 Alpha 通道？

> ID：685684
> 
> 赞同：2
> 
> 时间：2009-03-26T13:04:18.373
> 
> 标签：bitmap, alpha

作为主体。最好使用 C 代码。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-08-22T17:15:54.473

=========MFC++版本

```
private: static Boolean __gc* BitmapHasAlpha(BitmapData __gc* bmpData)
{
    if ((bmpData->PixelFormat != PixelFormat::Format32bppArgb) && (bmpData->PixelFormat != PixelFormat::Format32bppRgb))
    {
        return false;
    }
    for (Int32 __gc* i = 0; (i < bmpData->Height); i++)
    {
        Int32 __gc* num2 = (i * bmpData->Stride);
        for (Int32 __gc* j = 3; (j < (bmpData->Width * 4)); j += 4)
        {
            Byte __gc** numPtr = *static_cast<__box Byte __gc***>(((bmpData->Scan0->ToPointer() + num2) + j));
            if (numPtr[0] != 0)
            {
                return true;
            }
        }
    }
    return false;
} 
```

=========C#版本

```
private static unsafe bool BitmapHasAlpha(BitmapData bmpData)
    {
        if ((bmpData.PixelFormat != PixelFormat.Format32bppArgb) && (bmpData.PixelFormat != PixelFormat.Format32bppRgb))
        {
            return false;
        }
        for (int i = 0; i < bmpData.Height; i++)
        {
            int num2 = i * bmpData.Stride;
            for (int j = 3; j < (bmpData.Width * 4); j += 4)
            {
                byte* numPtr = ((byte*)bmpData.Scan0.ToPointer()) + num2 + j;
                if (numPtr[0] != 0)
                {
                    return true;
                }
            }
        }
        return false;
    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T13:14:46.787

使用 ::GetDIBits，如[#333559 所述](https://stackoverflow.com/questions/333559/c-win32-how-to-get-the-alpha-channel-from-an-hbitmap)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T13:22:42.993

在那个答案上，不清楚如何处理 GetDiBits()：

GetDIBits(hDC, hBmp, 0, 1, (void**) &bits, &bmi, DIB_RGB_COLORS);

bits[3] == 左上角像素的 alpha；

bits[3] 是否应该针对零进行测试？如何处理该值？谢谢，

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-28T10:21:52.930

我已经实现了一个原型，但它不能正常工作，所以代码中可能有问题。我在这里分享它，希望我们可以一起修复它：

```
BOOL HasAlphaChannel( HBITMAP hBmp )
{
   HDC hDC = CreateCompatibleDC( NULL );
   BITMAPINFO bmi; 
   void * bits;
   unsigned long ul; 
   BOOL bAlphaChannel = FALSE;

   memset( &bmi, 0, sizeof( BITMAPINFO ) ); 
   bmi.bmiHeader.biSize = sizeof( BITMAPINFOHEADER );  

   GetDIBits( hDC, hBmp, 0, 1, NULL, &bmi, DIB_RGB_COLORS ); 

   bits = malloc( bmi.bmiHeader.biSizeImage );

   // this is returning zero wich means error (why???) 
   GetDIBits( hDC, hBmp, 0, bmi.bmiHeader.biHeight, &bits, &bmi, DIB_RGB_COLORS ); 

   for( ul = 0; ul < bmi.bmiHeader.biSizeImage; ul += 4 )
      if( ( ( char * ) bits )[ ul + 3 ] != 0 )
         bAlphaChannel = TRUE;    

   free( bits );

   DeleteDC( hDC );

   return bAlphaChannel;
} 
```

谢谢！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-01-03T03:44:24.343

使用**GetDIBits(hdc, hbmp, 0, 1, NULL, &bmi, DIB_RGB_COLORS)**。

然后看看**bmi.bmiHeader.biBitCount**的值是否为**32**那么它有 alpha 通道，否则它没有 alpha。

# html - 如何更改嵌套列表项的 CSS 样式？

> ID：685687
> 
> 赞同：0
> 
> 时间：2009-03-26T13:04:41.430
> 
> 标签：html, css

我有一种样式用于在容器`<a>`中的列表项中设置元素样式。`#navigation`这工作正常。

```
#navigation li a {
  text-decoration:none;
  background:#bfe5ff;
  color:#045e9f;
  width:125px;
  height:35px;
  padding-top:11px;
  display:block;
  float:left;
  margin-left:2px;
  text-align:center;
  font-size:18px;
  font-weight:bold;
} 
```

现在在某些`<li>`s 中，我正在插入`<div>`s。在这些我再次使用列表，但它应该在样式上有所不同或没有样式。

当我放入`<li>`s 时，它们的样式与外部`<li>`元素匹配，但不应该。

我正在尝试使用这个：

```
#newnavigation li a { 
  font-size:12px;
  margin-left:20px;
} 
```

但它不起作用 - 它应用了“外部”样式。

这是我的标记：

```
<ul id="navigation"> 
  <li><a href="index.html">Home</a></li> 
  <li><a href="about.html">About</a></li> 
  <li><a href="contact.html">Contact</a></li> 
  <li class="browse">
    <a href="#">Browse</a>
    <div id="browsecontainer">
      <h3>Browse By Category</h3>
      <li><a href="#"></a></li>
    </div>
  </li>
</ul> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T13:18:50.817

您的 css 以 #id newnavigation 为目标，但您的 ul #id 是导航 尝试以下操作：

```
<ul id="navigation"> 
  <li><a href="index.html">Home</a></li> 
  <li><a href="about.html">About</a></li> 
  <li><a href="contact.html">Contact</a></li> 
  <li class="browse">
    <a href="#">Browse</a>
    <div id="browsecontainer">
      <h3>Browse By Category</h3>
      <ul id="newnavigation">
          <li><a href="#">First category</a></li>
      </ul>
    </div>
  </li>
</ul> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T13:29:39.123

它将继续应用外部样式——即 CSS 中的“C”，级联。您的新样式被正确挑选，但如果我正确阅读问题，您是否试图消除其他“继承”样式，如背景颜色？

如果您希望不应用外部样式，那么您要么需要使用与外部模式不匹配的元素（即不是 li，此处不实用），要么覆盖您不想要的样式应用。如果您真的只想将这些样式应用于外部 li 元素集，那么可以考虑在外部 li 元素上使用 CSS 类并将您不希望直接继承的格式应用到该类。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T13:26:03.157

要选择内部项目，只需嵌套它们：

```
/** Matches outer *AND* inner LIs */
#navigation li {
}

/** Matches inner LIs only (li within li within #navigation) */
#navigation li li {
} 
```

或者，要匹配锚点：

```
#navigation li a {}
#navigation li li a {} 
```

在内部样式中，您将从继承自外部样式的样式集开始，因此您可能希望通过覆盖它们来“撤消”某些设置以满足您的需要。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T13:26:47.523

请注意，您的标记无效。要插入新项目，您还应该插入新列表，即：

```
<ul id="newnavigation>
  <li>
    <div>
      <ul>
        <li></li>
      </ul>
    </div>
  </li>
</ul> 
```

当您的样式、Javascript 等出现问题时，[验证您的标记](http://validator.w3.org/#validate_by_input)总是一件好事。

话虽如此，要仅匹配内部 LI，您需要的 CSS 规则是：

```
#newnavigation li ul li{
  // stuff here
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T13:18:26.217

我猜它是这样的？

```
<ul id="navigation">
    <li><a href="#">link</a></li>
    <li><ul id="newnavigation"><li><a href="#">link</a></li></ul></li>
</ul> 
```

我复制并粘贴了您的样式，效果很好。到底是什么不工作？

更新：

我的猜测不太对。在您显示的代码中，没有 id="newnavigation" 来匹配 #newnavigation css 选择器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-17T03:51:23.100

您还可以使用子选择器，例如：#navigation > li

所以只有外部的 li 是样式化的。

请注意，IE6 及以下版本不支持子选择器。

# python - 这种语法用于实例化类有什么特别的原因吗？

> ID：685713
> 
> 赞同：0
> 
> 时间：2009-03-26T13:10:05.473
> 
> 标签：python, ruby, constructor

我想知道是否有人知道为什么以下语言使用这些语法来启动课程的特定原因（除了纯粹的风格）？

Python：

```
class MyClass:
    def __init__(self):

x = MyClass() 
```

红宝石：

```
class AnotherClass
    def initialize()
    end
end

x = AnotherClass.new() 
```

我不明白为什么用于构造函数的语法和用于实际获取类实例的语法如此不同。当然，我知道这并没有真正的区别，但是，例如，在 ruby​​ 中，使构造函数“new()”有什么问题？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T13:20:56.803

当您创建一个类的对象时，您所做的不仅仅是初始化它。您正在为它分配内存，然后初始化它，然后返回它。

另请注意，在 Ruby 中，`new()`是类方法，`initialize()`而是实例方法。如果您只是覆盖`new()`，则必须先创建对象，然后对该对象进行操作，然后返回它，而不是在更简单的`initialize()`地方引用`self`，因为该对象已经由内置`new()` (或者在 Ruby 中，不要`self`暗示它）。

在 Objective-C 中，您实际上可以更清楚地看到发生了什么（但更冗长），因为您需要分别进行分配和初始化，因为 Objective-C 无法将参数列表从分配方法传递给初始化方法：

```
[[MyClass alloc] initWithFoo: 1 bar: 2]; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-26T13:13:51.423

实际上，在 Python 中，构造函数是[`__new__()`](http://docs.python.org/reference/datamodel.html#object.__new__)，而[`__init__()`](http://docs.python.org/reference/datamodel.html#object.__init__)实例初始化程序是。

`__new__()`它创建对象实例，然后将其作为第一个参数（通常命名为）以及所有其余参数传递给。`cls``klass``__init__()``self``__new__`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T13:21:36.100

这很有用，因为在 Python 中，构造函数只是另一个函数。例如，我已经这样做了几次：

```
def ClassThatShouldntBeDirectlyInstantiated():
    return _classThatShouldntBeDirectlyInstantiated()

class _classThatShouldntBeDirectlyInstantiated(object):
    ... 
```

当然，这是一个人为的例子，但你明白了。本质上，大多数使用你的类的人可能会认为 ClassThatShouldntBeDirectlyInstantiated 是你的类，没有必要让他们有其他想法。以这种方式做事，您所要做的就是将工厂函数记录为它实例化的类，而不会混淆使用该类的任何人。

在像 C# 或 Java 这样的语言中，我有时会觉得创建这样的类很烦人，因为很难确定应该使用构造函数还是某些工厂函数。我不确定Ruby中是否也是这种情况。

# c# - Web 服务返回具有空字段的对象

> ID：685716
> 
> 赞同：4
> 
> 时间：2009-03-26T13:11:15.610
> 
> 标签：c#, .net, wcf, web-services

以前从未见过这个。

```
WebService.Implementation imp = new WebService.Implementation();
WebService.ImplementationRequest req = new WebService.ImplementationRequest();
return imp.GetValue(req); 
```

imp 返回的对象不为空。正如预期的那样，它正在返回一个 ImplementationResponse。但是该对象中的所有字段都是空的。这不是预期的。目前，WebService 只返回一些恒定的虚拟数据。我们已经在另一个开发者的机器上测试过，效果很好。

我想我还应该注意，如果我将 null 传递给 GetValue 方法，WebService 应该抛出异常。它没有。不适合我。

知道我的环境有什么问题可以使 WebService 返回一个对象，但使该对象中的每个值都为 null 吗？当它应该抛出异常时，以某种方式“神奇地”返回这个神秘物体？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-26T13:28:47.567

当生成的代码与 Web 服务返回的 xml 之间存在差异时，通常会发生这种情况，因此无法对其进行反序列化。

再次抓取 wsdl，重新生成所有代理类并重试。确保您发送正确的虚拟数据。

更新：

这曾经经常发生在我身上，因为 Web 服务不是由我的团队管理的，而且我们不会收到任何关于服务更改的通知。我们最终截获了 Web 服务管道中的肥皂消息以进行调试。[这](http://msdn.microsoft.com/en-us/magazine/cc164007.aspx)是一个很好的资源，可以帮助您上路。

您无需更改管道中的任何内容，只需获取肥皂消息并保存它们，以便稍后进行调试。大多数情况下，结果只是合同的变化。其他时候我们没有合同，所以如果没有收到信封就无法知道变化。

无论如何，即使这不是你的问题，我认为这是一件好事。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T13:17:11.603

是否标有 <DataMember()> 属性的字段，否则它们不会序列化？

```
<DataMember()> _
Public Property SomeField() As String
    Get
        Return m_strSomeField
    End Get
    Private Set(ByVal value As String)
        m_strSomeField= value
    End Set
End Property 
```

此外，考虑使用跟踪查看器来分析客户端和服务器之间发送的消息。有关信息，请参阅：

[https://stackoverflow.com/questions/560370/handling-wcf-proxy-null-return-issue](https://stackoverflow.com/questions/560370/handling-wcf-proxy-null-return-issue)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T13:20:43.357

> 我想我还应该注意，如果我将 null 传递给 GetValue 方法，WebService 应该抛出异常

你没有在这里传递 null ，你传递了一个请求对象。

此外，您需要能够调试到 Web 服务以查看那里发生了什么。我假设您正在内部实现此功能，因为您可以将其设置为恒定的虚拟值。

# asp.net - 在标题之后添加 Gridview 行

> ID：685717
> 
> 赞同：5
> 
> 时间：2009-03-26T13:11:17.780
> 
> 标签：asp.net, gridview, dynamic, row, add

我正在尝试向 Gridview 添加新的标题行。此行应出现在原始标题行下方。

据我所知，我有两个活动可供选择：

1.) Gridview_RowDataBound 2.) Gridview_RowCreated

选项 1 不是一个选项，因为网格没有绑定每个回发的数据。选项 2 无法按预期工作。我可以添加该行，但它是在 HeaderRow 之前添加的，因为在此事件中尚未添加 HeaderRow 本身......

请帮忙，谢谢！

代码：（InnerTable 属性由自定义 gridview 公开）

```
 Private Sub GridView1_RowDataBound(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.GridViewRowEventArgs) Handles GridView1.RowDataBound
    If e.Row.RowType = DataControlRowType.Header Then
        Dim r As New GridViewRow(-1, -1, DataControlRowType.Header, DataControlRowState.Normal)

        For Each c As DataControlField In CType(sender, GridView).Columns
            Dim nc As New TableCell
            nc.Text = c.AccessibleHeaderText
            nc.BackColor = Drawing.Color.Cornsilk
            r.Cells.Add(nc)
        Next

        Dim t As Table = GridView1.InnerTable
        t.Controls.Add(r)
    End If
End Sub 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T16:06:49.327

既然这是自定义的 GridView，为什么不考虑重写 CreateChildControls 方法呢？

即（对不起，C#）：

```
protected override void CreateChildControls()
{
    base.CreateChildControls();

    if (HeaderRow != null)
    {
        GridViewRow header = CreateRow(-1, -1, DataControlRowType.Header, DataControlRowState.Normal);
        for (int i = 0; i < Columns.Count; i++)
        {
            TableCell cell = new TableCell();
            cell.Text = Columns[i].AccessibleHeaderText;
            cell.ForeColor = System.Drawing.Color.Black;
            cell.BackColor = System.Drawing.Color.Cornsilk;
            header.Cells.Add(cell);
        }

        Table table = (Table)Controls[0];
        table.Rows.AddAt(1, header);
    }
} 
```

**更新** 正如 Ropstah 所提到的，上面的代码片段不适用于分页。我将代码移到 PrepareControlHierarchy 中，现在它可以优雅地进行分页、选择和排序。

```
protected override void PrepareControlHierarchy()
{
    if (ShowHeader && HeaderRow != null)
    {
        GridViewRow header = CreateRow(-1, -1, DataControlRowType.Header, DataControlRowState.Normal);
        for (int i = 0; i < Columns.Count; i++)
        {
            TableCell cell = new TableCell();
            cell.Text = Columns[i].AccessibleHeaderText;
            cell.ForeColor = System.Drawing.Color.Black;
            cell.BackColor = System.Drawing.Color.Cornsilk;
            header.Cells.Add(cell);
        }

        Table table = (Table)Controls[0];
        table.Rows.AddAt(1, header);
    }

    //it seems that this call works at the beginning just as well
    //but I prefer it here, since base does some style manipulation on existing columns
    base.PrepareControlHierarchy();
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-03-10T22:46:19.963

干得好伙计们，我使用你的技术对启用 AJAX 的网格视图进行分组，我搜索了很长时间。干杯。

```
protected override void PrepareControlHierarchy()
{
    if (GroupColumns)
    {
        #region Group Column

        Table table = (Table)Controls[0];

        string lastValue = string.Empty;
        foreach (GridViewRow gvr in this.Rows)
        {
            string currentValue = gvr.Cells[GroupColumnIndex].Text;

            if (lastValue.CompareTo(currentValue) != 0)
            {
                // there's been a change in value in the sorted column
                int rowIndex = table.Rows.GetRowIndex(gvr);

                // Add a new sort header row
                GridViewRow sortRow = new GridViewRow(rowIndex, rowIndex, DataControlRowType.DataRow, DataControlRowState.Normal);

                TableCell sortCell = new TableCell();
                TableCell blankCell = new TableCell();

                sortCell.ColumnSpan = this.Columns.Count - 1;
                sortCell.Text = string.Format("{0}", currentValue);

                blankCell.CssClass = "group_header_row";
                sortCell.CssClass = "group_header_row";

                // Add sortCell to sortRow, and sortRow to gridTable
                sortRow.Cells.Add(blankCell);
                sortRow.Cells.Add(sortCell);
                table.Controls.AddAt(rowIndex, sortRow);

                // Update lastValue
                lastValue = currentValue;
            }
        }

        #endregion
    }

    HideColumns();

    base.PrepareControlHierarchy();
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T13:45:44.933

将行添加到 InnerTable 时试试这个：

```
t.Controls.AddAt(1, r) 
```

这是我做的一个快速的基本测试，它似乎工作正常：

```
Protected Sub gridview_DataBound(ByVal sender As Object, ByVal e As System.EventArgs) Handles gridview.DataBound
    Dim g As GridView = CType(sender, GridView)

    Dim r As New GridViewRow(0, -1, DataControlRowType.Header, DataControlRowState.Normal)
    Dim th As New TableHeaderCell()
    th.ColumnSpan = g.Columns.Count
    th.Text = "This is my new header"
    r.Cells.Add(th)

    Dim t As Table = CType(g.Controls(0), Table)
    t.Rows.AddAt(1, r)
End Sub 
```

# python - 如何编译 Python 1.0

> ID：685732
> 
> 赞同：2
> 
> 时间：2009-03-26T13:16:07.503
> 
> 标签：python, installation, legacy

出于某种不正当的原因，我想尝试 Python 1.0。我将如何编译它，或者更确切地说，可以使用当前编译器干净编译的早期版本是什么？

我使用的是 Mac OS X 10.5，虽然只是出于好奇（关于语言如何变化），所以在 Linux 虚拟机中编译也是可能的。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-26T13:21:13.153

Python 1.0.1 使用 GCC 4.3.2 在 Ubuntu 8.10 下完美编译。它也应该在 Leopard 下编译。

[在此处](https://legacy.python.org/download/releases/src/python1.0.1.tar.gz)下载源代码，并按通常的方式编译：

```
./configure
make 
```

**更新：**我测试了它，它也在 Leopard 下编译。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-27T02:00:58.897

时光倒流，我通过 Google Groups 的存档从 alt.sources 中提取了 0.9.1p1 源。那是 18 岁以上的代码！

我做了一些更改（记录在 README.reconstructed 中）以使其在我的 OS 10.4 机器上编译。[源代码](http://www.dalkescientific.com/writings/diary/archive/2009/03/27/python_0_9_1p1.html)供您欣赏。我还向 python.org 维护者发送了电子邮件，看看他们是否想要一份它的副本。

它编译不干净。有一些警告，主要是因为缺少原型。但它确实有效。

# c# - C#：无法从 ulong 转换为字节

> ID：685738
> 
> 赞同：2
> 
> 时间：2009-03-26T13:17:26.983
> 
> 标签：c#, byte, long-integer, unsigned

奇怪我怎么能在 C++ 中做到这一点，但在 C# 中却不行。

为了清楚起见，我将在 C++ 中粘贴这两个函数，然后在 C# 中粘贴，并在 C# 代码中用注释“//error”标记有问题的行。这两个函数所做的是对参数进行编码，然后将其添加到名为 byte1seeds 的全局变量中。

这些是 C++ 中的函数

```
//Global var:

unsigned char byte1seeds[3];

unsigned long GenerateValue( unsigned long * Ptr )
{
unsigned long val = *Ptr;
for( int i = 0; i < 32; i++ )
    val = (((((((((((val >> 2)^val) >> 2)^val) >> 1)^val) >> 1)^val) >> 1)^val)&1)|((((val&1) << 31)|(val >> 1))&0xFFFFFFFE);
return ( *Ptr = val );
}

void SetupCountByte( unsigned long seed )
{
if( seed == 0 ) seed = 0x9ABFB3B6;
unsigned long mut = seed;
unsigned long mut1 = GenerateValue( &mut );
unsigned long mut2 = GenerateValue( &mut );
unsigned long mut3 = GenerateValue( &mut );
GenerateValue( &mut );
unsigned char byte1 = (mut&0xFF)^(mut3&0xFF);
unsigned char byte2 = (mut1&0xFF)^(mut2&0xFF);
if( !byte1 ) byte1 = 1;
if( !byte2 ) byte2 = 1;
byte1seeds[0] = byte1^byte2;
byte1seeds[1] = byte2;
byte1seeds[2] = byte1;
} 
```

现在是 C# 代码：

我更改了函数 GenerateValue。它没有将指针作为参数，而是有一个 ulong 参数。

要调用它并更改我使用的两个值：

1.  ulong mut1 = GenerateValue(mut);
2.  穆特=穆特1；

这是翻译后的函数（有问题的行用“//error”标记）；

```
//Global var:
public static byte[] byte1seeds = new byte[3];

public static ulong GenerateValue(ulong val)
{
    for( int i = 0; i < 32; i++ )
        val = (((((((((((val >> 2)^val) >> 2)^val) >> 1)^val) >> 1)^val) >> 1)^val)&1)|((((val&1) << 31)|(val >> 1))&0xFFFFFFFE);
    return val ;
}

public static void SetupCountByte( uint seed )
{
    if( seed == 0 ) seed = 0x9ABFB3B6;
    ulong mut = seed;
    ulong mut1 = GenerateValue(mut);
    mut = mut1;
    ulong mut2 = GenerateValue(mut);
    mut = mut2;
    ulong mut3 = GenerateValue(mut);
    mut = mut3;
    mut = GenerateValue(mut);
    byte byte1 = (mut & 0xFF) ^ (mut3 & 0xFF); //error
    byte byte2 = (mut1 & 0xFF) ^ (mut2 & 0xFF); //error
    if( byte1 != 0 )
        byte1 = 1;
    if( byte2 != 0 )
        byte2 = 1;
    byte1seeds[0] = byte1^byte2; //error
    byte1seeds[1] = byte2;
    byte1seeds[2] = byte1;
} 
```

错误是：

无法将类型“ulong”隐式转换为“byte”。存在显式转换（您是否缺少演员表？）

编辑：有问题的第 3 行的错误是：

无法将类型“int”隐式转换为“byte”。存在显式转换（您是否缺少演员表？）

问题来了：如何解决这些错误？

提前致谢！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-26T13:19:53.110

添加一个`(byte)`来投射它。由于您可能会丢失精度，因此您必须告诉编译器该值将适合一个字节，即

```
byte byte1 = (byte)((mut & 0xFF) ^ (mut3 & 0xFF));
byte byte2 = (byte)((mut1 & 0xFF) ^ (mut2 & 0xFF)); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T13:20:36.680

你可能会丢失信息。除非您明确告诉他这样做，否则编译器不允许这种操作。所以尝试这样的事情：

```
byte result = ((byte)mut & 0xFF) ^ ((byte)mut3 & 0xFF); 
```

这样，所有变量都被显式转换，结果将是一个字节。或者你可以这样做：

```
byte result = (byte)((mut & 0xFF) ^ (mut3 & 0xFF)); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T14:04:34.250

## 症状

以下代码在 C++ 中编译，但被 C# 编译器拒绝，第三行报告类型不兼容。

```
ulong mut = 5;
ulong mut3 = 6;
byte foo = (mut & 0xFF) ^ (mut3 & 0xFF); 
```

## 解释

表达式`(mut & 0xFF) ^ (mut3 & 0xFF)`是 type 的`ulong`，不能分配给 type 的变量`byte`。

变量`mut`是一个`ulong`。所有的重载都`&`要求操作数类型对称，所以在表达式`(mut & 0xFF)`中，值`0xFF`被提升为`ulong`，并且操作的结果具有类型`ulong`。

虽然类似的过程也确实给第二个子表达式 type `ulong`，但这是偶然的，因为在更大的表达式中， expression具有 type`A ^ B`的事实会导致 expression被提升。`A``ulong``B`

因此，表达式`(mut & 0xFF) ^ (mut3 & 0xFF)`是类型的`ulong`，需要显式转换才能将其分配给类型的变量`byte`。

## 解决方案

在赋值之前显式地对整个表达式进行类型转换。

## 评论

人们关闭警告而不是考虑它们，因为大多数 C+ 库都充满了缺陷。如果你重新打开警告，你会得到这么多，试图通过它们是无用的，即使在混乱的某个地方会有一个注释，说明“需要潜在的有损隐式类型转换”。

如果您阅读 C# 语言规范，特别是有关运算符的内容，您将学到很多有用的东西。例如，此代码将失败：

```
byte b = 0xF0 | 0x0E; //b should contain 0xFE 
```

但这些会成功：

```
byte b1 = (byte)(0xF0 | 0x0E); //typecast fixes it
byte b2 = 0xF0;
b2 |= 0x0E; //reflexive operator typed by target variable 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T13:20:48.973

“存在显式转换”表示您需要进行显式转换。在这种情况下，这将是这样的：

```
byte byte1 = (byte) ( (mut & 0xFF) ^ (mut3 & 0xFF) );
byte byte2 = (byte) ( (mut1 & 0xFF) ^ (mut2 & 0xFF) ); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-26T13:35:06.660

有一篇[MSDN 知识库文章](http://support.microsoft.com/kb/304696)深入解释了显式向下转换的必要性。错误消息中的“存在显式转换”一词旨在提示您必须使用强制转换显式转换数据类型。在您的具体情况下，它看起来像这样：

```
byte byte1 = (byte) ( (mut & 0xFF) ^ (mut3 & 0xFF) ); 
```

# xaml - 如何在 XAML 元素中使用 StringFormat？

> ID：685743
> 
> 赞同：57
> 
> 时间：2009-03-26T13:19:06.217
> 
> 标签：xaml, string-formatting

我深入了解与订单绑定的元素的 XAML 堆栈。

订单日期显示为例如“12/31/2008 12:00:00 AM”。

**我希望它显示为例如“31.12.2008”。**

我怎样才能做到这一点？我已经看到[其他 stackoverflow 问题](https://stackoverflow.com/questions/447035/what-is-the-wpf-xaml-data-binding-equivalent-of-string-format)提到了 StringFormat，但它们以我无法开始工作的方式使用多重绑定。

这是我想要的那种语法（这是伪代码），只需在需要的地方指定 StringFormat ，这可能以某种方式吗？

```
<StackPanel>
    <ListView ItemsSource="{Binding Orders}">
        <ListView.View>
            <GridView>
                <GridViewColumn 
                    Header="Order ID" 
                    DisplayMemberBinding="{Binding Path=OrderID}"
                    StringFormat="{}{1:dd.MM.yyyy}"/>
                <GridViewColumn 
                    Header="Order Date" 
                    DisplayMemberBinding="{Binding Path=OrderDate}"/>
            </GridView>
        </ListView.View>
    </ListView>
</StackPanel> 
```

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2009-03-26T13:31:07.310

我没有测试过，但我认为这应该有效：

```
<GridViewColumn
    Header="Order Date"
    DisplayMemberBinding=
        "{Binding Path=OrderDate, StringFormat='{}{0:dd.MM.yyyy}'}"/> 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2010-09-25T15:09:10.650

通常，您可以查找关联的`*StringFormat`依赖项属性。例如，所有[ContentControl](https://docs.microsoft.com/en-us/dotnet/api/system.windows.controls.contentcontrol?view=net-5.0)实现（例如 Label 和 Tooltip）都具有[ContentStringFormat 依赖属性](https://docs.microsoft.com/en-us/dotnet/api/system.windows.controls.contentcontrol.contentstringformat?view=net-5.0)：

```
<Label
    Content="{Binding Path=DateAsked}"
    ContentStringFormat="{}{0:yyyy/MM/dd HH:mm:ss}" /> 
```

在您的情况下，虽然[GridViewColumn](https://docs.microsoft.com/en-us/dotnet/api/system.windows.controls.gridviewcolumn?view=net-5.0)具有[HeaderStringFormat 依赖属性](https://docs.microsoft.com/en-us/dotnet/api/system.windows.controls.gridviewcolumn.headerstringformat?view=net-5.0)，`Header`但没有类似的`DisplayMemberBinding`，因此您将需要 .NET 3.5 SP1（使用[Visual Studio 2008 SP1](https://web.archive.org/web/20110605222632/http://www.microsoft.com:80/downloads/en/details.aspx?FamilyID=FBEE1648-7106-44A7-9649-6D9F6D58056E)获取）或更好地使用新的[BindingBase.StringFormat属性](https://docs.microsoft.com/en-us/dotnet/api/system.windows.data.bindingbase.stringformat?view=net-5.0)：

```
<GridViewColumn 
    Header="Order ID"
    DisplayMemberBinding="{Binding Path=OrderID, StringFormat='{}{0:dd.MM.yyyy}'}"
/> 
```

[博客文章Trying out Binding.StringFormat](https://web.archive.org/web/20160307210655/http://blogs.msdn.com:80/b/mikehillberg/archive/2008/05/29/trying-out-binding-stringformat.aspx)中有更多示例。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-26T13:24:59.197

XAML

```
<UserControl.Resources>
    <myNamespace:DateTimeConverter x:Key="DateTimeConverter" />
</UserControl.Resources>

<GridViewColumn 
DisplayMemberBinding=="{Binding Path=OrderDate, Converter={StaticResource DateTimeConverter}}" 
/> 
```

C＃

```
public class DateTimeConverter : IValueConverter
{
    public object Convert(object value,
                       Type targetType,
                       object parameter,
                       CultureInfo culture)
    {
        if (value != null)
        {
            return ((DateTime)value).ToString("dd.MM.yyyy");
        }
        else
        {
            return String.Empty;
        }
    }

    public object ConvertBack(object value,
                              Type targetType,
                              object parameter,
                              CultureInfo culture)
    {
        return DateTime.Parse(value.ToString());
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-07-25T09:04:16.993

如果要本地化日期格式，可以将其包含在 .resx 文件中。您必须按照本指南设置您的应用程序进行本地化：[https](https://developer.xamarin.com/guides/xamarin-forms/advanced/localization/) ://developer.xamarin.com/guides/xamarin-forms/advanced/localization/ 。

resx 条目：

```
<data name="DateFormat" xml:space="preserve">
    <value>{0:dddd d MMMM H&#x3a;mm}</value>
</data> 
```

然后在您的内容页面中包含 resx 文件的位置

```
xmlns:il8n="clr-namespace:MyProject.Localization;assembly=MyProject" 
```

然后你可以像这样在你的绑定中使用它：

```
<Label
    Text = "{Binding Time, StringFormat={il8n:Translate DateFormat}}" 
```

# for-loop - 在 for 循环中使用“else”的 Pythonic 方法

> ID：685758
> 
> 赞同：14
> 
> 时间：2009-03-26T13:22:32.197
> 
> 标签：for-loop, python

我几乎没有注意到一个在 for 循环中使用 else 的 python 程序。

我最近用它在退出时根据循环变量条件执行一个动作；因为它在范围内。

在 for 循环中使用 else 的 Pythonic 方式是什么？有什么值得注意的用例吗？

而且，是的。我不喜欢使用 break 语句。我宁愿将循环条件设置为复杂。如果我不喜欢使用 break 语句，我能否从中获得任何好处。

值得注意的是，自语言诞生以来，for 循环就有一个 else，这是有史以来的第一个版本。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-26T14:56:44.983

还有什么比 PyPy 更符合 Python 风格的呢？

看看我从 ctypes_configure/configure.py 的第 284 行开始发现了什么：

```
 for i in range(0, info['size'] - csize + 1, info['align']):
        if layout[i:i+csize] == [None] * csize:
            layout_addfield(layout, i, ctype, '_alignment')
            break
    else:
        raise AssertionError("unenforceable alignment %d" % (
            info['align'],)) 
```

在这里，从 pypy/annotation/annrpython.py ( [clicky](http://codespeak.net/pypy/dist/pypy/annotation/annrpython.py) )中的第 425 行开始

```
if cell.is_constant():
    return Constant(cell.const)
else:
    for v in known_variables:
        if self.bindings[v] is cell:
            return v
    else:
        raise CannotSimplify 
```

在 pypy/annotation/binaryop.py 中，从第 751 行开始：

```
def is_((pbc1, pbc2)):
    thistype = pairtype(SomePBC, SomePBC)
    s = super(thistype, pair(pbc1, pbc2)).is_()
    if not s.is_constant():
        if not pbc1.can_be_None or not pbc2.can_be_None:
            for desc in pbc1.descriptions:
                if desc in pbc2.descriptions:
                    break
            else:
                s.const = False    # no common desc in the two sets
    return s 
```

pypy/annotation/classdef.py 中的非单行代码，从第 176 行开始：

```
def add_source_for_attribute(self, attr, source):
    """Adds information about a constant source for an attribute.
    """
    for cdef in self.getmro():
        if attr in cdef.attrs:
            # the Attribute() exists already for this class (or a parent)
            attrdef = cdef.attrs[attr]
            s_prev_value = attrdef.s_value
            attrdef.add_constant_source(self, source)
            # we should reflow from all the reader's position,
            # but as an optimization we try to see if the attribute
            # has really been generalized
            if attrdef.s_value != s_prev_value:
                attrdef.mutated(cdef) # reflow from all read positions
            return
    else:
        # remember the source in self.attr_sources
        sources = self.attr_sources.setdefault(attr, [])
        sources.append(source)
        # register the source in any Attribute found in subclasses,
        # to restore invariant (III)
        # NB. add_constant_source() may discover new subdefs but the
        #     right thing will happen to them because self.attr_sources
        #     was already updated
        if not source.instance_level:
            for subdef in self.getallsubdefs():
                if attr in subdef.attrs:
                    attrdef = subdef.attrs[attr]
                    s_prev_value = attrdef.s_value
                    attrdef.add_constant_source(self, source)
                    if attrdef.s_value != s_prev_value:
                        attrdef.mutated(subdef) # reflow from all read positions 
```

稍后在同一个文件中，从第 307 行开始，一个带有启发性注释的示例：

```
def generalize_attr(self, attr, s_value=None):
    # if the attribute exists in a superclass, generalize there,
    # as imposed by invariant (I)
    for clsdef in self.getmro():
        if attr in clsdef.attrs:
            clsdef._generalize_attr(attr, s_value)
            break
    else:
        self._generalize_attr(attr, s_value) 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-26T13:32:16.200

如果你有一个 for 循环，你实际上没有任何条件语句。因此，如果您想中止，那么 break 是您的选择，然后可以完美地处理您不满意的情况。

```
for fruit in basket:
   if fruit.kind in ['Orange', 'Apple']:
       fruit.eat()
       break
else:
   print 'The basket contains no desirable fruit' 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-12-30T16:03:08.313

基本上，它简化了任何使用布尔标志的循环，如下所示：

```
found = False                # <-- initialize boolean
for divisor in range(2, n):
    if n % divisor == 0:
        found = True         # <-- update boolean
        break  # optional, but continuing would be a waste of time

if found:                    # <-- check boolean
    print n, "is composite"
else:
    print n, "is prime" 
```

并允许您跳过标志的管理：

```
for divisor in range(2, n):
    if n % divisor == 0:
        print n, "is composite"
        break
else:
    print n, "is prime" 
```

请注意，当您找到除数时，已经有一个自然的地方可以执行代码 - 就在`break`. 这里唯一的新功能是当您尝试所有除数但未找到任何除数时执行代码的地方。

*这仅有助于结合`break`*. 如果您不能中断，您仍然需要布尔值（例如，因为您正在寻找最后一场比赛，或者必须并行跟踪多个条件）。

哦，顺便说一句，这也适用于 while 循环。

## 任何/所有

现在，如果循环的唯一目的是一个是或否的答案，你可以用生成器或生成器表达式生成布尔值的`any()`/函数将它写得更短：`all()`

```
if any(n % divisor == 0 
       for divisor in range(2, n)):
    print n, "is composite"
else:
    print n, "is prime" 
```

注意优雅！代码是你想说的1：1！

[这与带有 a 的循环一样有效`break`，因为该`any()`函数是短路的，只运行生成器表达式直到它 yield `True`。事实上，它通常比循环更快。更简单的 Python 代码往往很少听到。]

如果您有其他副作用 - 例如，如果您想找到除数，这不太可行。您仍然可以（ab）使用 Python 中非 0 值为真这一事实：

```
divisor = any(d for d in range(2, n) if n % d == 0)
if divisor:
    print n, "is divisible by", divisor
else:
    print n, "is prime" 
```

但是正如您所看到的，这越来越不稳定-如果 0 是可能的除数值，则将不起作用...

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-26T13:36:16.313

如果不使用`break`，块对and语句`else`没有好处。下面两个例子是等价的：`for``while`

```
for x in range(10):
  pass
else:
  print "else"

for x in range(10):
  pass
print "else" 
```

`else`使用with `for`or的唯一原因`while`是如果循环正常终止，则在循环之后执行某些操作，这意味着没有明确的`break`.

经过一番思考，我终于想出了一个可能有用的案例：

```
def commit_changes(directory):
    for file in directory:
        if file_is_modified(file):
            break
    else:
        # No changes
        return False

    # Something has been changed
    send_directory_to_server()
    return True 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-30T07:46:48.057

也许最好的答案来自官方 Python 教程：

[break 和 continue 语句，以及循环上的 else 子句](http://docs.python.org/tutorial/controlflow.html#break-and-continue-statements-and-else-clauses-on-loops)：

> *循环语句可能有一个 else 子句；它在循环因列表用尽而终止时（使用 for）或条件变为假（使用 while）时执行，但在循环由 break 语句终止时不执行*

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-12-31T20:15:58.793

有人向我介绍了一个很棒的习惯用法，您可以在其中使用带有迭代器的 //`for`方案来节省时间和 LOC。手头的示例是为不完全合格的路径搜索候选者。如果您想查看原始上下文，请查看[原始问题](https://stackoverflow.com/a/18988504/691859)。`break``else`

```
def match(path, actual):
    path = path.strip('/').split('/')
    actual = iter(actual.strip('/').split('/'))
    for pathitem in path:
        for item in actual:
            if pathitem == item:
                break
        else:
            return False
    return True 
```

在这里使用`for`/`else`如此出色的原因在于避免在周围杂乱无章的布尔值的优雅。如果没有`else`，但希望实现相同数量的短路，它可能会这样写：

```
def match(path, actual):
    path = path.strip('/').split('/')
    actual = iter(actual.strip('/').split('/'))
    failed = True
    for pathitem in path:
        failed = True
        for item in actual:
            if pathitem == item:
                failed = False
                break
        if failed:
            break
    return not failed 
```

我认为使用`else`使它更优雅，更明显。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2022-02-03T17:05:36.300

循环子句的一个用例`else`是打破嵌套循环：

```
while True:
    for item in iterable:
        if condition:
            break
        suite
    else:
        continue
    break 
```

它避免了重复条件：

```
while not condition:
    for item in iterable:
        if condition:
            break
        suite 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-03-26T13:39:31.300

干得好：

```
a = ('y','a','y')
for x in a:
  print x,
else:
  print '!' 
```

是为了守车。

编辑：

```
# What happens if we add the ! to a list?

def side_effect(your_list):
  your_list.extend('!')
  for x in your_list:
    print x,

claimant = ['A',' ','g','u','r','u']
side_effect(claimant)
print claimant[-1]

# oh no, claimant now ends with a '!' 
```

编辑：

```
a = (("this","is"),("a","contrived","example"),("of","the","caboose","idiom"))
for b in a:
  for c in b:
    print c,
    if "is" == c:
      break
  else:
    print 
```

# assembly - EMMS指令执行时间？

> ID：685761
> 
> 赞同：2
> 
> 时间：2009-03-26T13:23:01.027
> 
> 标签：assembly, x86, mmx

我正在阅读*The Art of Assembly: The MMX Instruction Set"*，在执行了一些 MMX 指令后，`EMMS`需要执行该指令来重置 FPU。它指出 EMMS 指令很慢。

但是，当我分析`EMMS`执行时间以查看它有多慢时（[`RDTSC`](https://en.wikipedia.org/wiki/Time_Stamp_Counter)用于计算时钟周期），它似乎在 0 个周期内执行。

这是怎么回事？我是不是在某个地方犯了错误，还是 Art Of Assembly 已经过时了？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-01T18:07:33.663

它在古老的 Pentium MMX 上很慢，但在更现代的处理器上却非常快。

尽管如此，MMX 今天基本上已经过时了。使用 SSE2，与 FPU 进行多路复用不会有任何问题。

此外，RDTSC 指令可以与其他指令并行执行，这解释了您的测量 - CPU 只是在同一时钟周期内同时开始执行 RDTSC 和 EMMS ......如果您想测量一段代码所花费的时间，您必须针对代码对两个 RDTSC 进行序列化 - 通常使用 CPUID 指令。由于您使用的序列化指令本身需要 CPU 周期，因此您还必须测量在您编写的测量装置之间没有代码的情况下它需要多少个周期。

最后一点是，即使在 Pentium MMX 上，EMMS 指令本身也很快完成 - 这是之后的第一条 FPU 指令，它得到了令人讨厌的延迟......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-01T18:19:35.890

您需要一个序列化指令，例如 CPUID，以确保 RDTSC 不会乱序执行。[你可以在这里](http://en.wikipedia.org/wiki/Time_Stamp_Counter)阅读更多。

# function - 如何将参数传递给变量引用的函数

> ID：685762
> 
> 赞同：6
> 
> 时间：2009-03-26T13:23:18.843
> 
> 标签：function, powershell, reference, arguments

我有一个函数 'foo' 和一个引用它的变量 '$foo'。

```
function foo
{
    param($value)
    $value + 5
}

$foo = foo
$foo 
```

我可以在没有 args 的情况下调用 $foo，但是如何传递参数？这不起作用：

```
$foo 5
$foo(5) 
```

实际上目标是编写这样的代码：

```
function bar {
  param($callback)
  $callback 5
}

bar(foo) 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-26T13:52:20.270

问题是当你这样做

> $foo = 富

您将函数的结果放在变量 $foo 中，而不是函数本身！

试试这个 ：

> $foo = 获取内容功能：\foo

像这样称呼它

> & $富 5

希望能帮助到你 ！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T14:55:53.393

使用脚本块。

```
# f.ps1

$foo = 
{
    param($value)
    $value + 5
}

function bar 
{
  param($callback)
  & $callback 5
}

bar($foo) 
```

运行它：

```
> ./f.ps1
10 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T13:27:33.667

**编辑**第一次误读问题

您需要做的是使用 & 运算符

```
& $foo 5 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T14:32:59.877

$foo = foo 5

# java - 有人对 Eclipse GMF 有任何经验吗？

> ID：685763
> 
> 赞同：7
> 
> 时间：2009-03-26T13:23:24.100
> 
> 标签：java, modeling, eclipse-gmf

我刚刚开始玩[Eclipse GMF](http://www.eclipse.org/modeling/gmf/)。

*   有人用过这个框架吗？
*   您使用它有什么好的或不好的经历吗？
*   您可以建议任何图形建模的替代方案吗？
*   **编辑：**有什么好的例子？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-28T05:07:41.903

**有人用过这个框架吗？**是的，我现在正在使用它。它可以工作，但通常需要对图形进行大量编码。我目前正在努力利用构建在 GMF 之上的 IBM RSA/RSM UML editparts/figures/nodes 等。

**你使用它有什么好的或坏的经历？** 回顾我最初对 GMF/EMF/GEF 等的研究，我可以肯定地说，研究这些例子。您必须从示例而不是文档中学习一些重要的模式。我还推荐一本新书（[Eclipse Modeling Project: A Domain-Specific Language (DSL)](https://rads.stackoverflow.com/amzn/click/com/0321534077)) 特定于 Eclipse 中的 GMF 建模。我翻阅了它，它似乎是一些更基本概念的缺失手册。这本书之所以好的原因在于，它侧重于通过将 UML/模型限制在特定领域并提供仅允许创建有效模型的工具来使 UML/模型有用的关键。在线文档并不多，API 只能告诉你这么多。注意由于调用 setBounds() 或其他 set 方法引起的重绘/绘制循环，它会使 eclipse 实例崩溃，不好玩。哦，是的，API 分为 Eclipse 帮助文档版本或**根本不包括在内。**

**您可以建议任何图形建模的替代方案吗？** 考虑使用自定义图像和图标而不是完整形状生成的 UML 配置文件。在 UML 图形对象和 UML 配置文件之上构建一个非常好的图像/图标编辑器需要大约 2 个小时。IBM RSM 工具 UML Profile 工具项目可以快速完成这项工作。您可以使用受限的 UML 配置文件（通过 Eclipse 插件或 OCL）做很多事情。进入 GMF 土地是一个数量级以上的努力增加，从 1 到 10 小时没有问题。

考虑一下纯 DSL（领域特定语言）工具。谷歌会提供一个很好的列表。据我所知，使用 GMF 的主要原因是 eclipse 集成和利用现有的 ecore/UML 模型，这就是我使用 GMF 的原因。

问问自己我需要简单的模型，还是需要一个工具来创建这个模型的实例。如果只有 1-5 位专家用户，则可能不需要时尚的工具。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T14:22:19.617

TOPCASED[项目](http://topcased.org)使用 GMF。它为 UML 和其他图表提供了各种图形编辑器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-09-06T08:40:12.063

使用 GMF，大部分编辑器代码都是为您生成的，但主要的复杂性在于必须对其进行修改。

作为最近的替代品，您可以尝试[Graphiti](http://www.eclipse.org/graphiti/)和[Spray](http://code.google.com/a/eclipselabs.org/p/spray/)。[这是](https://www.duo.uio.no/bitstream/handle/10852/9000/refsdal.pdf)GMF 和 Graphiti 之间的[比较。](http://www.slideshare.net/koentsje/graphiti-and-gmf-compared)

# ruby-on-rails - has_many ：通过关联

> ID：685765
> 
> 赞同：1
> 
> 时间：2009-03-26T13:23:40.307
> 
> 标签：ruby-on-rails, ruby, associations

是否有可能建立某种关联：

**用户型号：**

```
has_many :goods, :through => :assignments
has_many :goods_want, :through => :assignments, :source => :good, :conditions => "assignments.type = 1" 
```

**在控制台中测试**

```
u = User.first
u.goods_want << Good.first
u.save 
```

正在记录：

```
INSERT INTO `assignments` (`good_id`, `updated_at`, `type`, `profile_id`, `created_at`) VALUES(1, '2009-03-26 09:36:11', NULL, 1, '2009-03-26 09:36:11') 
```

那么有没有什么漂亮的方法可以使这种关联不仅从数据库中获取记录，而且可以写入数据库？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T16:48:46.727

你为什么不创建一个作业？

```
a = Assignment.new
a.type = 1
a.good = Good.first
a.user = User.first
a.save 
```

# javascript - 优化jQuery代码

> ID：685770
> 
> 赞同：3
> 
> 时间：2009-03-26T13:25:18.417
> 
> 标签：javascript, jquery, html, css, optimization

我编写了这个 jQuery 代码，该代码在图像上带有一些链接的叠加层中淡入淡出。我发现当我添加 10 张这样的图像时，速度非常慢。我真的很感激一些关于如何使这段代码更快的提示和技巧。

如果您对我的 HTML 和 CSS 有一些提示，那就太好了；）

jQuery代码

```
$(document).ready(function() {
var div = $(".thumb").find("div");
div.fadeTo(0, 0);
div.css("display","block");
$(".thumb").hover(
  function () {
      $(this).children(".download").fadeTo("fast", 1);
      $(this).children(".hud").fadeTo("fast", 0.7);
  }, 
  function () {
      div.fadeTo("fast", 0);
  }
);
}); 
```

所有代码

```
<style type="text/css">
a:active {
    outline:none;
}
:focus {
    -moz-outline-style:none;
}
img {
    border: none;
}
#backgrounds {
    font: 82.5% "Lucida Grande", Lucida, Verdana, sans-serif;
    margin: 50px 0 0 0;
    padding: 0;
    width: 585px;
}
.thumb {
    margin: 5px;
    position: relative;
    float: left;
}
.thumb img {
    background: #fff;
    border: solid 1px #ccc;
    padding: 4px;
}
.thumb div {
    display: none;
}
.thumb .download {
    color: #fff;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 999;
    padding: 0 10px;
}
.thumb .download h3 {
    font-size: 14px;
    margin-bottom: 10px;
    margin-top: 13px;
    text-align: center;
}
.thumb .download a {
    font-size: 11px;
    color: #fff;
    text-decoration: none;
    font-weight: bold;
    line-height: 16px;
}
.thumb .download a:hover {
    text-decoration: underline;
}
.thumb .download .left, .thumb .download .right {
    width: 44%;
    margin: 0;
    padding: 4px;
}
.thumb .download .left {
    float: left;
    text-align: right;
}
.thumb .download .right {
    float: right;
    text-align: left;
}
.thumb img, .thumb .hud {
    -webkit-border-radius: 5px;
    -moz-border-radius: 5px;
    border-radius: 5px;
}
.thumb .hud {
    width: 100%;
    height: 110px;
    position: absolute;
    top: 0;
    left: 0;
    background: #000;
}
</style>

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>

<script type="text/javascript">
$(document).ready(function() {
var div = $(".thumb").find("div");
div.fadeTo(0, 0);
div.css("display","block");
$(".thumb").hover(
  function () {
      $(this).children(".download").fadeTo("fast", 1);
      $(this).children(".hud").fadeTo("fast", 0.7);
  }, 
  function () {
      div.fadeTo("fast", 0);
  }
);
});
</script>

<div id="backgrounds">

<div class="thumb">
    <div class="download">
    <h3>Download wallpaper</h3>
    <p class="left">
    <a href="1024x768.jpg">1024x768</a>
    <a href="1280x800.jpg">1280x800</a>
    <a href="1280x1024.jpg">1280x1024</a>
    </p>
    <p class="right">
    <a href="1440x900.jpg">1440x900</a>
    <a href="1680x1050.jpg">1680x1050</a>
    <a href="1920x1200.jpg">1920x1200</a>
    </p>
    </div>
    <div class="hud"></div>
    <img alt="image" src="thumb.jpg"/>
</div>

</div> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T14:14:55.707

通过简单地更改悬停（..）中的以下内容，我得到了更好的响应：

```
 function () {
    $(".download", this).fadeTo("fast", 1);
    $(".hud", this).fadeTo("fast", 0.7);
  }, 
  function () {
    $(".download, .hud", this).fadeTo("fast", 0);
  } 
```

最大的区别在于仅将悬停效果应用于事件目标，无需重新应用于页面上的所有 div。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T13:51:17.853

我已将您的代码放入测试页面，老实说，即使有 30 个左右的 .thumb div 看起来也不错 - 当然响应速度足以从我的最终使用。将鼠标滑过一堆意味着我必须等待翻转效果通过它们，这需要一段时间才能到达我实际停止的那个，但鉴于你肯定这就是你想要的'重新使用“悬停”而不是“点击”（这肯定会消除任何速度问题）。

我没有在我的测试页面中使用实际图像，只是获取替代文本，所以我目前最好的猜测是确保您加载的所有图像都尽可能小文件大小。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T14:40:47.907

**预选更多**

预选 div 做得很好。尝试这种方式，以便它预先选择元素的淡入淡出，而不是在悬停时进行：

```
 $().ready(function() {
    var div = $(".thumb").find("div");
    div.fadeTo(0, 0);
    div.css("display","block");

    $(".thumb").each(function() {

      var download = $(this).children(".download");
      var hud = $(this).children(".hud");

      $(this).hover(
        function () {
            download.fadeTo("fast", 1);
            hud.fadeTo("fast", 0.7);
        }, 
        function () {
            div.fadeTo("fast", 0);
        }
      );

    });

  }); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-03T19:19:34.220

尝试删除 :focus { -moz-outline-style:none; 看看会发生什么

# .net - .NET ComboBox 自动完成在斜杠上失败

> ID：685771
> 
> 赞同：2
> 
> 时间：2009-03-26T13:25:43.157
> 
> 标签：.net, combobox, autocomplete

.NET ComboBox 自动完成不会完全自动完成，显示文本包含斜线。它只完成到斜线，留下 SelectedIndex == -1 和 SelectedValue == null。

无论您的 autocompletesource 是否设置为 ListItems 而不是 FileSystem 或 URL，这种行为都会愚蠢地持续存在。

是否有任何解决方法不涉及仅丢弃 ComboBox 类并编写“MyComboBox”类？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T13:36:40.917

看起来 MS 很清楚这种行为。我怀疑你已经在他们的文档页面上看到了注释，如果没有的话，链接在[这里](http://msdn.microsoft.com/en-us/library/system.windows.forms.combobox.autocompletemode.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2020-10-13T13:42:15.027

@hal9000 我也在寻找修复方法，我在 msdn 网站上找到了 Paul Cull 的一段代码：

```
Private Sub cbCode_Validating(sender As Object, e As 
System.ComponentModel.CancelEventArgs) Handles cbCode.Validating

Dim s As String

If cbCode.SelectedIndex = -1 And cbCode.Text <> "" Then
' Let's see if it ends with a slash
 s = cbCode.Text
 If s.EndsWith("\") Or s.EndsWith("/") Then cbCode.SelectedIndex = cbCode.FindString(s)
End If

End Sub 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-03-30T18:10:27.843

我能找到的最简单的解决方案是从[syncfusion.com](https://www.syncfusion.com)下载syncfusion 的免费社区winforms 控件包并使用他们的sfCombobox。他们的自动完成功能正常工作。微软应该真正解决这个问题，尽管它很痛苦。

# wcf - 为 WCF 生成客户端回调服务接口

> ID：685773
> 
> 赞同：0
> 
> 时间：2009-03-26T13:26:01.130
> 
> 标签：wcf

你好

我正在尝试遵循以下文章[http://msdn.microsoft.com/en-us/library/ms731064.aspx](http://msdn.microsoft.com/en-us/library/ms731064.aspx)，但我似乎无法生成客户端回调接口。我正在使用 VS 2008。

不知道是什么原因造成的，因为我尝试过的两篇单独的文章给出了相同的概率。

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-03-29T09:06:01.280

就我而言，我忘记在 ServiceContract 属性中添加 CallBackContract 命名参数。例如：

```
[ServiceContract(Namespace = "http://Microsoft.ServiceModel.Samples",SessionMode=SessionMode.Required,
CallbackContract=typeof(ICalculatorDuplexCallback))] 
```

我知道这篇文章已经提交了大约 3 年，但对于那些仍然有同样问题的人。

# php - 如何组合从下拉列表中选择的日期/时间以在 MySQL 查询中使用？

> ID：685778
> 
> 赞同：1
> 
> 时间：2009-03-26T13:26:22.500
> 
> 标签：php, mysql, arrays, date, drop-down-menu

我有两组四个下拉菜单 - startDate、startMonth、startYear、startTime（如 24.00）和 endDate/Time 相同 - 供用户选择开始日期/时间和结束日期/时间，但不知道如何使用 javascript 或最好是 php(5) 将所选值转换为日期时间格式以在记录集查询中使用。

我知道我需要将所选内容组合成数组，例如：

```
//start and end Date/Time arrays from dropdowns - year,month,day and time without seconds 
$startDT=$sYear.$sMonth.$sDay.' '.$sTime.':00';
$endDT =$eYear.$eMonth.$eDay.' '$eTime.':00'; 
```

但是我在哪里以及如何使用这些，以便我可以在 MySQL 中使用它们，例如：

```
SELECT *
FROM availability
BETWEEN '%startDT%' AND '%endDT%' 
```

答案可能很简单，但经过大量抓头、拉头发和过量咖啡因后，我就是无法解决……称之为金发时刻！我希望有人可以帮助这个自杀的新手 php。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T13:28:33.527

将您的数据组合成一个字符串并使用[strtotime()](http://is.php.net/manual/en/function.strtotime.php)将其转换为 unixtime。然后将该 unixtime 数据保存到您的数据库中。

# c# - DataTable问题列的ADO.Net DataType

> ID：685789
> 
> 赞同：1
> 
> 时间：2009-03-26T13:28:52.120
> 
> 标签：c#, sql, ado.net, datatable, types

我的问题是如何为特殊 SQL 类型的列分配 DataType 值，例如 uniqueidentifier/nvarchar/datetime/varbinary(max)——我没有找到 .NET 数据类型和这 4 种 SQL 列数据类型之间的映射？

这是一个示例，它显示我们需要为 DataTable 的每一列分配 DataType（此示例将 .NET 类型映射到 SQL 列数据类型）。

[http://msdn.microsoft.com/en-us/library/system.data.datatable.aspx](http://msdn.microsoft.com/en-us/library/system.data.datatable.aspx)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-26T13:32:21.770

假设您正在谈论 DataColumn 类的 DataType 属性，这就是您映射类型的方式：

*   唯一标识符 - 指导
*   nvarchar - 字符串
*   日期时间 - 日期时间
*   varbinary(max) - 字节[]

您可以在此处找到完整的映射列表：

[http://msdn.microsoft.com/en-us/library/ms131092.aspx](http://msdn.microsoft.com/en-us/library/ms131092.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T13:35:11.310

您可能还想阅读这个 msdn 页面：http:
[//msdn.microsoft.com/en-us/library/system.data.datacolumn.datatype.aspx](http://msdn.microsoft.com/en-us/library/system.data.datacolumn.datatype.aspx)

# windows - 更改分辨率时如何保留其他应用程序窗口的大小和位置？（例如，以非桌面分辨率来回全屏游戏）

> ID：685798
> 
> 赞同：0
> 
> 时间：2009-03-26T13:31:13.473
> 
> 标签：windows, opengl, direct3d

当他们在 Windows 中全屏显示时，有没有人注意到使用 D3D 或 OpenGL 的应用程序的这种奇怪行为？它仅适用于应用程序进入全屏然后切换回窗口或终止时。他们要么洗牌其他应用程序的窗口位置（当我在单显示器机器上），或者当我在多显示器机器上时将所有其他应用程序窗口移动到另一个屏幕。

如果没有没有显示这两个异常的应用程序，我会认为这是理所当然的。那么，我的问题是，在编写应用程序以缓解这两个问题时，究竟需要注意什么？另外，我不确定这个问题是否存在于 Windows 以外的其他平台上？

我对此的主要设置是 OpenGL/C++，但我认为这适用于您拥有的任何设置，因为它似乎是需要处理的平台 API。

* * *

**编辑**：好的，这是对我的观察的更多说明。即使在与桌面相同的分辨率下，问题仍然存在。因此，它似乎与分辨率切换无关，因为我见过应用程序/游戏，即使它们与桌面的分辨率不同，当它们切换回来时，桌面上的窗口也会恢复到以前的状态全屏应用程序已运行。

* * *

**edit2**：看起来这是一个分辨率开关问题，Windows（至少是 XP）似乎不记得应用程序窗口的位置和大小（在多显示器设置的情况下）。看起来唯一的解决方案是我在对问题的回答中提供的解决方案——即使它看起来像是操作系统应该提供的东西，至少作为一个或两个 API 调用。我仍然不相信这是唯一的解决方案，一定有一种简单的方法可以优雅、轻松地恢复，不是吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T01:28:23.033

Shouldn't you be using `ChangedDisplaySettingsEx(..., CDS_FULLSCREEN, NULL)`? That will tell the system the resolution swap is temporary.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T13:36:36.830

我不能说我 100% 确定您遇到的情况。但是，我的猜测是因为大多数 D3D/OpenGL 游戏在启动/关闭时会因为性能原因而改变机器的分辨率。

您看到的那些不会改变窗口的可能不会改变分辨率，因为它们可能能够在您当前的设置下运行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T16:56:54.150

嗯，我已经对此进行了更多研究 - 看起来在更改分辨率后恢复所有正在运行的窗口大小和位置没有默认回退，因此必须在应用程序中完成（至少在 XP 中）。

因此，为了从其他分辨率（例如全屏游戏）优雅地返回，我需要使用 EnumWindows 和适当的回调获取所有正在运行的应用程序 hWnd，并通过 GetWindowRect 将每个窗口 RECT 结构存储在列表中。

当切换回桌面分辨率时，我会再次使用 EnumWindows，但使用不同的回调设置每个正在运行的应用程序窗口的位置和大小，使用 SetWindowPos，使用我在切换到全屏之前保存的 RECT 列表。

当然，也有一些问题，比如只能通过 EnumWindows 等看到你获得一个窗口 hwnd。操作系统不提供这样的功能似乎很奇怪，即使只有 API。我想知道其他操作系统如何处理这个问题，如果他们处理它的话。

# java - 我应该使用什么数据结构来跟踪最近使用的项目？

> ID：685811
> 
> 赞同：3
> 
> 时间：2009-03-26T13:33:30.923
> 
> 标签：java, algorithm, data-structures

我需要一个有界队列之类的东西，我只能在其中插入 10 个元素。新元素应覆盖最后插入的元素。 **应该只有 n 个不同的元素**

顺便说一句，我正在寻找 Java 中的建议。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T13:36:33.147

ITYM 一种 LRU 算法的实现。

*   [如何使用 LinkedHashMap 设置简单的 LRU 缓存](http://java-planet.blogspot.com/2005/08/how-to-set-up-simple-lru-cache-using.html)

*   [带有过期时间的简单 LRU 缓存](http://www.codeproject.com/KB/java/lru.aspx)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-26T13:49:58.153

这是队列数据结构的经典应用。大小为 10 的堆栈将跟踪您添加到其中的*前*10 个元素，而大小为 10 的队列将跟踪最近的 10 个元素。如果您正在寻找“最近的项目”列表，正如您的问题标题所建议的那样，那么队列就是要走的路。

**编辑：**这是一个示例，用于可视化目的：

假设您要跟踪最近的 4 个项目，并按以下顺序访问 8 个项目：

> 四十二

以下是您的数据结构随着时间推移的样子：

```
access  item      queue          stack
  1      F     [ F . . . ]    [ . . . F ]
  2      O     [ O F . . ]    [ . . O F ]
  3      R     [ R O F . ]    [ . R O F ]
  4      T     [ T R O F ]    [ T R O F ]
  5      Y     [ Y T R O ]    [ Y R O F ]
  6      T     [ T Y T R ]    [ T R O F ]
  7      W     [ W T Y T ]    [ W R O F ]
  8      O     [ O W T Y ]    [ O R O F ] 
```

从堆栈中移除顶部元素会移除最近添加的项目，而不是最旧的项目。

从队列中删除一个元素会删除最旧的项目，因此您的队列将自动保存最新的项目。

**编辑：**感谢[Adam Jaskiewicz](https://stackoverflow.com/users/35322/adam-jaskiewicz)，这里有一些关于[Java 队列实现的](http://java.sun.com/javase/6/docs/api/java/util/Queue.html)文档。

# sql - 对 ODBC 连接表 VBA 运行查询

> ID：685815
> 
> 赞同：0
> 
> 时间：2009-03-26T13:34:47.520
> 
> 标签：sql, ms-access, vba, odbc

我已经在 Access 中通过 ODBC 连接了一个表（读数），当我单击它时会很快打开。

但是，当我尝试在 VBA 中运行它时，它会锁定并且从不显示任何内容：

```
Dim strSql As String
strSql = "SELECT readings.ids " & _
         "INTO ids_temp " & _
         "FROM readings " & _
         "WHERE readings.ids > 1234;"  //This is id in middle of list
DoCmd.SetWarnings False
DoCmd.RunSQL strSql
DoCmd.SetWarnings True 
```

由于某种原因，这会使整个系统崩溃。有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T12:26:47.677

而不是使用 DoCmd，t 通常由现有连接处理以创建一个 Command 对象，该对象接受 SQL 语句以与 Command.Execute 方法一起使用。

阅读 DoCmd 的文档，它似乎主要用于从 Access UI 菜单执行宏。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T23:29:38.393

您的数据库在本地是否有 ids_temp 表？如果 ids_temp 表是链接表，它将删除该表，因为选择到 CREATES NEW TABLE。如果要添加到表中，请尝试 INSERT INTO 命令。您可以在插入数据之前清理表。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-28T17:04:53.677

所以这个错误实际上是我的错，我使用的 id 导致查询返回大约 600 万个结果。但是，这种方法实际上效果很好，我只是创建表格并将不同表格上的列表框链接到表格，然后我只显示表格。我在两者之间做了一些关闭和更新，但总的来说它似乎运作良好。谢谢您的帮助

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-27T03:45:56.307

让我说 DoCmd.RunSQL 永远不可取，尤其是在 SetWarnings 关闭的情况下，因为您不知道结果是否符合您的预期。你已经告诉 VBA 不要报告错误，所以你永远不知道是否所有的记录都被插入了。

用我的 SQLRun() 函数替换 DoCmd.RunSQL 非常容易，这里发布：

> [如何从 Access VBA 中的更新查询提示中获取值？](https://stackoverflow.com/questions/343396/acess-vba-to-get-value-from-update-query-prompt/348453#348453)

# sql-server - 用于 SSRS 的 Neodynamic Barcode Professional

> ID：685818
> 
> 赞同：1
> 
> 时间：2009-03-26T13:35:11.887
> 
> 标签：sql-server, reporting-services, neodynamic

我们的应用程序需要能够将条形码呈现为可通过 Internet 访问的 PDF 文档。我们的技术堆栈包括 SQL Server Reporting Services，因此我们希望利用它及其呈现为 PDF 的能力；但是，我们无法让它以`FREE3OF9.ttf`任何一致的方式嵌入条形码字体。

我已经审查了[这个问题](https://stackoverflow.com/questions/19437/custom-font-in-sql-server-2005-reporting-services)，但想知道是否有人使用过 Neodynamic 产品，特别是他们的 SSRS 产品，以及他们是否对此感到满意。如果有人有除 Neodynamic 之外的任何其他解决方案，用于通过 SSRS 将条形码呈现为 PDF，我也想听听这些。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T13:45:32.923

之前没用过SRSS，但是写过条码生成软件。如果您正在寻找替代方案，那么编写自己的替代方案并不太难。

您可以在线找到有关条码编码的所有信息。我使用了[Code 128](http://en.wikipedia.org/wiki/Code_128)，并在我的源代码中简单地创建了一个值表。渲染条码只需根据表格中的信息绘制实心的黑白条，因此您无需担心嵌入字体。

看起来您想使用 Reporting Services，所以这可能没有帮助。不管怎样，祝你好运！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-04-15T18:48:42.603

我在工作中使用它并且喜欢它，它非常易于使用并且有许多不同的条形码选项。我最近创建了一个图像轮廓的条形码，非常酷。该工具易于使用，就像在报告中添加图像一样，您可以选择填充条形码的字段，选择条形码样式，然后就完成了。

# oop - 策略设计模式的确切定义是什么？

> ID：685826
> 
> 赞同：6
> 
> 时间：2009-03-26T13:37:19.510
> 
> 标签：oop, design-patterns, strategy-pattern

我与某人就战略模式的真正含义发生了一场极客之争，我需要一位专家来解决这个问题。

我们都同意策略模式允许在运行时交换类的内容（例如行为），同时保持相同的接口。然而，她的论点是“为了使 [算法] 成为一种策略，你必须得到相同的结果”。我的论点是，交换“算法”或类的逻辑可能意味着覆盖操作的结果不同，但它仍然符合策略模式的目的、意图（和分类）。

她带有注释的代码示例：

* * *

根据您的定义，一个类的任何子类都是一种策略。它们具有相同的方法定义（签名），因此可以互换。

```
Interface Strategy
{
    DoArithmatic(int[] a)
}

Class A : Strategy
public int DoArithmatic(int[]a)
{
     int temp = 0;
     for(int i =0; i< a.length; i++)
          temp += a[i]
}

Class B : Strategy
public int DoArithmaticB(int[]a)
{
     int temp = 0;
     for(int i =a.length -1; i>-1; i--)
          temp += a[i]
}

Class C : Strategy
public int DoArithmatic(int[]a)
{
     int temp = 0;
     for(int i =0; i< a.length; i++)
          temp -= a;
}

int[] a = { 1,2,3 }
ClassA.DoArithmatic(a) = 6
ClassB.DoArithmatic(a) = 6
ClassC.DoArithmatic(a) = -6//This one is not interchangeable 
```

前两个是策略。因为对于任何输入，他们都会给你完全相同的答案。最后一个不是。仅仅因为它给你一个 int 并不能使它成为一种策略。他们必须“做”同样的事情。

您不能仅仅为了使它们成为一种策略而使用“更高”的抽象术语。

这些都做“数学”，但他们并不是都以不同的方式做“相同”的事情。这就是战略的本质。

那么，谁是对的？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-26T13:42:38.640

您先生是正确的，您的同事需要阅读 GoF。

“策略模式让算法独立于使用它们的客户而变化。”

看：

[http://www.dofactory.com/Patterns/PatternStrategy.aspx](http://www.dofactory.com/Patterns/PatternStrategy.aspx)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-26T13:54:15.087

从技术上讲，策略可以为所欲为。

只有当“外部环境”规定了一些无法在编程界面中捕获的固定且可重复的行为（称它们为“理想的属性”）时，您才需要注意您的策略是真正可替代的 à la Liskov这些理想的属性。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-26T13:45:07.340

我支持你的意见。只要可以在相同的上下文中使用不同的策略，它们就可以做非常不同的事情。

例如，如果您想访问树中的每个节点，有效的策略可能是：

*   深度优先搜索预订
*   DFS 后订单
*   BFS
*   随机的
*   ...

所有策略都会以不同的顺序访问节点，但目标（访问每个节点）是相同的。因此，如果顺序无关紧要，任何一种策略都适合您的需求。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-26T13:54:09.283

FWIW，[维基百科的文章](http://en.wikipedia.org/wiki/Strategy_pattern)同意你的观点，从未听说过她的立场。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-26T14:01:34.320

> 前两个是策略。因为对于任何输入，他们都会给你完全相同的答案。最后一个不是。只是因为它给了你一个 int 并不能使它成为一种策略。他们必须“做”同样的事情。

他们必须做同样的事情，但这并不意味着他们给出完全相同的结果。来自 GoF 的激励示例是不同的布局算法或不同的寄存器分配算法之一。这些策略具有相同的目标——在页面上布局文本和图像块，或将虚拟寄存器分配给硬件寄存器——但它们不必创建完全相同的结果。

因此，如果`Strategy`您示例中的目标是对输入进行*任何*算术运算，那么每个示例都是该目标的策略。如果目标是对传递的数组求和，`DoArithmatic`则会被调用`CalculateSum`，最后一个示例将不符合策略约定，因此违反[LSP](http://en.wikipedia.org/wiki/Liskov_substitution_principle)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-26T13:53:38.770

根据“Head first Design Patterns”（[参见此处](http://books.google.com/books?id=LjJcCnNf92kC&printsec=frontcover&dq=head+first+design+paters#PPA24,M1)）第 24 页

“策略模式定义了一系列算法，
封装了每个算法，并使它们可以互换。
策略让算法独立于
使用它的客户而变化。”

所以先生，您是正确的，至少根据定义模式的人来说，但他们知道什么。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-26T13:55:06.223

你是。该策略的重点是替换算法。它们是否提供相同的结果是所需行为的副产品。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-26T14:29:07.403

我认为更正确的说法是策略是否必须在确定性上相同的问题超出了策略模式定义的范围。

如果一个函数对于给定的输入总是返回相同的结果，那么它是确定性的。如果两个函数是确定性的，并且它们总是为相同的输入返回相同的值，那么它们在确定性上是等价的。它们可能有也可能没有相同的副作用；如果他们这样做了，那么他们就是完全等价的。

通常情况并非如此。让我们考虑一个似乎需要确定性等价的例子：排序。您可能会认为，如果两个比较器实现无法为相同的输入返回相同的结果，那么其中至少一个肯定是有问题的，但情况不一定如此。

排序顺序因国家/地区而异。有些地方对重音不敏感。有些人把 McDuck 和 MacDuck 放在一起，等等。这些是策略，这是策略模式的完美应用，而且这些策略肯定*不是*确定性等价的。

你赢了。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-26T13:46:05.183

我也不得不同意。一个很好的例子是定价计算器策略。您可以有不同的策略来计算发票的最终金额，具体取决于项目数量、客户类型、运输目的地等几个变量。这些策略中的每一个肯定会返回不同的结果，并且仍然会被考虑策略模式。

# sql-server - 如何获取表存储信息

> ID：685828
> 
> 赞同：5
> 
> 时间：2009-03-26T13:38:09.977
> 
> 标签：sql-server, sql-server-2005, sql-server-2008

**SQL Server 版本**：带 SP3 和 2008 的 SQL Server 2005

是否有内置的 SQL Server 存储过程可以检索以下信息？或者 DMV（动态管理视图）也会很棒。

我主要对如何专门找出表的**FILEGROUP**数据感兴趣。但是，如果有一个存储过程会返回所有以下结果，那就更好了。

![替代文字](https://farm4.static.flickr.com/3418/3387609076_af538b3386_o.png)

顺便说一句，是否有任何文档显示了如何检索 SQL Server UI 显示的数据的一对一匹配？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-26T14:27:45.503

系统存储过程 sp_help 可能是一个很好的起点。

例如：

```
exec sp_help 'schema.TableName' 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T13:42:46.550

这将向您展示各种优点：

```
-- Script to analyze table space usage using the
-- output from the sp_spaceused stored procedure
-- Works with SQL 7.0, 2000, and 2005

set nocount on

print 'Show Size, Space Used, Unused Space, Type, and Name of all database files'

select
    [FileSizeMB]    =
        convert(numeric(10,2),sum(round(a.size/128.,2))),
        [UsedSpaceMB]   =
        convert(numeric(10,2),sum(round(fileproperty( a.name,'SpaceUsed')/128.,2))) ,
        [UnusedSpaceMB] =
        convert(numeric(10,2),sum(round((a.size-fileproperty( a.name,'SpaceUsed'))/128.,2))) ,
    [Type] =
        case when a.groupid is null then '' when a.groupid = 0 then 'Log' else 'Data' end,
    [DBFileName]    = isnull(a.name,'*** Total for all files ***')
from
    sysfiles a
group by
    groupid,
    a.name
    with rollup
having
    a.groupid is null or
    a.name is not null
order by
    case when a.groupid is null then 99 when a.groupid = 0 then 0 else 1 end,
    a.groupid,
    case when a.name is null then 99 else 0 end,
    a.name

create table #TABLE_SPACE_WORK
(
    TABLE_NAME  sysname     not null ,
    TABLE_ROWS  numeric(18,0)   not null ,
    RESERVED    varchar(50)     not null ,
    DATA        varchar(50)     not null ,
    INDEX_SIZE  varchar(50)     not null ,
    UNUSED      varchar(50)     not null ,
)

create table #TABLE_SPACE_USED
(
    Seq     int     not null    
    identity(1,1)   primary key clustered,
    TABLE_NAME  sysname     not null ,
    TABLE_ROWS  numeric(18,0)   not null ,
    RESERVED    varchar(50)     not null ,
    DATA        varchar(50)     not null ,
    INDEX_SIZE  varchar(50)     not null ,
    UNUSED      varchar(50)     not null ,
)

create table #TABLE_SPACE
(
    Seq     int     not null
    identity(1,1)   primary key clustered,
    TABLE_NAME  SYSNAME     not null ,
    TABLE_ROWS  int     not null ,
    RESERVED    int     not null ,
    DATA        int     not null ,
    INDEX_SIZE  int     not null ,
    UNUSED      int     not null ,
    USED_MB             numeric(18,4)   not null,
    USED_GB             numeric(18,4)   not null,
    AVERAGE_BYTES_PER_ROW       numeric(18,5)   null,
    AVERAGE_DATA_BYTES_PER_ROW  numeric(18,5)   null,
    AVERAGE_INDEX_BYTES_PER_ROW numeric(18,5)   null,
    AVERAGE_UNUSED_BYTES_PER_ROW    numeric(18,5)   null,
)

declare @fetch_status int

declare @proc   varchar(200)
select  @proc   = rtrim(db_name())+'.dbo.sp_spaceused'

declare Cur_Cursor cursor local
for
select
    TABLE_NAME  = 
    rtrim(TABLE_SCHEMA)+'.'+rtrim(TABLE_NAME)
from
    INFORMATION_SCHEMA.TABLES 
where
    TABLE_TYPE  = 'BASE TABLE'
order by
    1

open Cur_Cursor

declare @TABLE_NAME     varchar(200)

select @fetch_status = 0

while @fetch_status = 0
    begin

    fetch next from Cur_Cursor
    into
        @TABLE_NAME

    select @fetch_status = @@fetch_status

    if @fetch_status <> 0
        begin
        continue
        end

    truncate table #TABLE_SPACE_WORK

    insert into #TABLE_SPACE_WORK
        (
        TABLE_NAME,
        TABLE_ROWS,
        RESERVED,
        DATA,
        INDEX_SIZE,
        UNUSED
        )
    exec @proc @objname = 
        @TABLE_NAME ,@updateusage = 'true'

    -- Needed to work with SQL 7
    update #TABLE_SPACE_WORK
    set
        TABLE_NAME = @TABLE_NAME

    insert into #TABLE_SPACE_USED
        (
        TABLE_NAME,
        TABLE_ROWS,
        RESERVED,
        DATA,
        INDEX_SIZE,
        UNUSED
        )
    select
        TABLE_NAME,
        TABLE_ROWS,
        RESERVED,
        DATA,
        INDEX_SIZE,
        UNUSED
    from
        #TABLE_SPACE_WORK

    end     --While end

close Cur_Cursor

deallocate Cur_Cursor

insert into #TABLE_SPACE
    (
    TABLE_NAME,
    TABLE_ROWS,
    RESERVED,
    DATA,
    INDEX_SIZE,
    UNUSED,
    USED_MB,
    USED_GB,
    AVERAGE_BYTES_PER_ROW,
    AVERAGE_DATA_BYTES_PER_ROW,
    AVERAGE_INDEX_BYTES_PER_ROW,
    AVERAGE_UNUSED_BYTES_PER_ROW

    )
select
    TABLE_NAME,
    TABLE_ROWS,
    RESERVED,
    DATA,
    INDEX_SIZE,
    UNUSED,
    USED_MB         =
        round(convert(numeric(25,10),RESERVED)/
        convert(numeric(25,10),1024),4),
    USED_GB         =
        round(convert(numeric(25,10),RESERVED)/
        convert(numeric(25,10),1024*1024),4),
    AVERAGE_BYTES_PER_ROW   =
        case
        when TABLE_ROWS <> 0
        then round(
        (1024.000000*convert(numeric(25,10),RESERVED))/
        convert(numeric(25,10),TABLE_ROWS),5)
        else null
        end,
    AVERAGE_DATA_BYTES_PER_ROW  =
        case
        when TABLE_ROWS <> 0
        then round(
        (1024.000000*convert(numeric(25,10),DATA))/
        convert(numeric(25,10),TABLE_ROWS),5)
        else null
        end,
    AVERAGE_INDEX_BYTES_PER_ROW =
        case
        when TABLE_ROWS <> 0
        then round(
        (1024.000000*convert(numeric(25,10),INDEX_SIZE))/
        convert(numeric(25,10),TABLE_ROWS),5)
        else null
        end,
    AVERAGE_UNUSED_BYTES_PER_ROW    =
        case
        when TABLE_ROWS <> 0
        then round(
        (1024.000000*convert(numeric(25,10),UNUSED))/
        convert(numeric(25,10),TABLE_ROWS),5)
        else null
        end
from
    (
    select
        TABLE_NAME,
        TABLE_ROWS,
        RESERVED    = 
        convert(int,rtrim(replace(RESERVED,'KB',''))),
        DATA        = 
        convert(int,rtrim(replace(DATA,'KB',''))),
        INDEX_SIZE  = 
        convert(int,rtrim(replace(INDEX_SIZE,'KB',''))),
        UNUSED      = 
        convert(int,rtrim(replace(UNUSED,'KB','')))
    from
        #TABLE_SPACE_USED aa
    ) a
order by
    TABLE_NAME

print 'Show results in descending order by size in MB'

select * from #TABLE_SPACE order by USED_MB desc
go

drop table #TABLE_SPACE_WORK
drop table #TABLE_SPACE_USED 
drop table #TABLE_SPACE 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T13:55:20.777

找到了解决方案。

与使用 UI 查找表 FILEGROUP 信息相比，输入它似乎需要更长的时间。

[通过文件组中的列表](http://database.ittoolbox.com/groups/technical-functional/sql-server-l/list-tables-in-filegroups-314039)找到：

```
declare @objectid bigint
set @objectid = object_id('table_name')
exec sp_objectfilegroup @objectid 
```

我变得懒得输入这三行，所以最终创建了另一个使用表名的存储过程。

```
create procedure spTableFileGroup
    @TableName sysname
as
begin
    if exists(  select 1 
                from    INFORMATION_SCHEMA.TABLES T 
                where T.TABLE_NAME = @TableName) begin
        declare @objectid bigint
        set @objectid = object_id(@TableName)
        exec sp_objectfilegroup @objectid
    end
    else begin
        print 'There is no table named "' + @TableName + '"'
    end
end
GO 
```

**用法**

```
exec spTableFileGroup 'table_name'
GO 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T13:41:24.040

查看用于文件组的 DBCC showfilestats 或 sp_spaceused。

[在博客上](http://www.keyboardface.com/archives/2007/06/12/mssql-table-size-for-all-tables/)找到了一个脚本。这列出了表格及其大小。为了更加用户友好（管理视图，您可以在数据库上使用鼠标右键生成报告）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-26T14:16:23.537

表 FILEGROUP 由它的聚集索引决定。您可以使用此查询来查找文件组：

```
SELECT *
FROM
sys.tables AS tbl
INNER JOIN sys.indexes AS idx ON idx.object_id = tbl.object_id and idx.index_id < 2
LEFT OUTER JOIN sys.data_spaces AS dsidx ON dsidx.data_space_id = idx.data_space_id 
```

关于您的第二个问题，我认为没有任何文档，但是，您可以在 SSMS 中查看详细信息时使用 SQL 分析器。这将向您显示确切的查询。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-11-06T15:10:10.680

这可能会奏效->

```
use Your_database_name
GO

SELECT  FG.*, MF.* FROM sys.filegroups FG INNER JOIN sys.master_files
MF on MF.data_space_id = FG.data_space_id WHERE database_id = db_id() 
```

# iphone - 应用安装问题

> ID：685831
> 
> 赞同：0
> 
> 时间：2009-03-26T13:38:58.790
> 
> 标签：iphone

我正在尝试在 iTouch 上安装应用程序。但是我面临一个问题，例如每个新应用程序都安装在以前的应用程序上，因此以前的应用程序正在消失。:(

有没有人知道如何删除这个错误。配置文件或证书是否有任何问题。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T14:01:12.057

我将版本号添加到我的反向 URL 标识符（在 target->properties 中）并使用通配符配置文件。

这样，我的 beta 测试人员可以保留我的应用程序的旧版本进行回归测试。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T14:11:56.043

简单地更改版本号并不能解决问题。它仍然会替换旧安装，因为设备认为它是较新版本。（这是真的）

**更改 ID**会使设备认为它是不同的应用程序。这样**就行了**。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-26T13:44:12.443

当且仅当它们的 ID 相同时，新应用程序才会替换旧应用程序。您确定要为您的应用使用唯一标识符吗？

# java - OpenVMS 上的 Java？

> ID：685836
> 
> 赞同：6
> 
> 时间：2009-03-26T13:39:58.177
> 
> 标签：java, eclipse, openvms, vms

我们在 OpenVMS Alpha 和 Integrity 服务器上运行批处理文件。到目前为止，它们都是用 COBOL 编写的。正如您可以想象的那样，无法维持该过程的原因有很多。

同时，我们拥有一支使用 Eclipse 并且非常了解 Java 的开发人员团队。是否可以将 Eclipse 与 OpenVMS 一起使用？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T14:14:46.130

也许是因为我没有跟上 COBOL，但我不确定你为什么确信你必须放弃它。我意识到这不是“in”的事情，但如果你已经有一个庞大的代码库，我会在切换到另一种语言之前至少三思。如果缺少开发人员，我认为您不会很快用完。

也就是说，谷歌搜索 Eclipse 和 OpenVMS 给出了这个链接： [http](http://www.sdtimes.com/SearchResult/32973) ://www.sdtimes.com/SearchResult/32973 所以看起来你仍然可以从[eCube](http://www.ecubesystems.com/index.html)获得 Eclipse for OpenVMS 。如果我没看错那篇文章，HP 似乎希望您按照 NetBeans 的指示进行操作。就个人而言，我仍在使用 Emacs（目前还没有做任何 Java），所以不做推荐；我只是想指出，除了 Eclipse，还有其他开发 Java 的方法。

我没有在 Sun 的网站上找到适用于 VMS 的 Java（如果你找到了，请随时纠正我），但看起来你可以从 HP/Compaq 获得 JDK：http: [//www.compaq.com/java /download/ovms/1.5.0/index.html](http://www.compaq.com/java/download/ovms/1.5.0/index.html)

编辑：我的意思是，但忘了说：假设您在 VMS 端使用 JVM，您应该能够在另一个平台上使用 Eclipse 进行开发，并将字节码复制到 Alphas。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-04T15:17:11.657

根据经验，如果您决定用 Java 重写批处理，我建议您使用第三方批处理框架，例如[Spring Batch](http://static.springframework.org/spring-batch/)，而不是“自己开发”。

使用框架还会限制您在标准内工作，并且应该提供非功能性需求，例如可重运行性、事务和错误处理。

我们使用本土框架（重新）构建了从各种技术到 Java 的许多批处理流程，我发现我们最终会花时间修复/优化框架，而不仅仅是关注业务逻辑。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-07T19:52:53.750

谈到这方面的一些经验，我建议在您的 Windows/Linux/Mac 桌面上使用 Eclipse 进行开发，并将代码推送到 OpenVMS 以进行测试/部署。Eclipse 不能在 OpenVMS 上运行，因为它的 GUI 有一些特定于平台的组件。

一些警告：

*   确保您在桌面上使用与 OpenVMS 上相同的 JVM 版本。
*   当使用本质上区分大小写的 Java .class 文件时，OpenVMS 中的不区分大小写可能会成为一个问题。将所有内容打包在 .jar 中并以这种方式部署。
*   .jar 文件的属性必须正确设置，否则 OpenVMS JVM 无法打开它们。以下命令应该可以解决问题： `SET FILE *.jar /ATTR=(RFM:STMLF,RAT:CR)`
*   HP 提供“快速”JVM 和“经典”JVM。除非您的内存需求变化很大，否则请使用快速 VM。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T13:45:02.737

暂时不要离开 Cobol - 打电话[给正在考虑切换到现代世界的 cobol 程序员](https://stackoverflow.com/questions/312499/a-cobol-programmer-thinking-about-switching-to-the-modern-world)并进行交易：你教他 Java，他会保留你的遗产。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-04T13:59:08.913

Shell 脚本和 java 通常不是很好的组合。您可能需要考虑在 VMS 服务器上安装 JVM，并使用一种更好地处理这种情况的 JVM 托管语言 - jython、jruby 或 groovy 可能是可以考虑的候选者。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-04T19:48:05.267

Eclipse 依赖于似乎尚未移植到 OpenVMS 的本机 Java 扩展。不过不要放弃。Java 在 OpenVMS 上运行（根据 Google 搜索至少为 1.5）。

*NetBeans 有一个仅适用*于 OpenVMS的 Java 版本。在[NetBeans 下载页面](http://www.netbeans.org/downloads/ "NetBeans 下载页面")上，为平台选择 OS Independent Zip 选项。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-04T21:18:44.970

您是否在 OpenVMS 系统上运行批处理文件？如果是这样，HP 使 Java 可用于 OpenVMS，而不是 SUN；您将不得不查看他们的网站。您可以在 windows/linux 机器上开发您的 java 代码并在您的 VMS 系统上进行测试；您必须了解不能在 Java 的 VMS 实现上使用的本机扩展。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2021-06-10T13:18:22.567

我意识到这个问题已经相当老了，但我很震惊没有人提到这本书涵盖 OpenVMS 上的 Java。

[https://www.theminimumyouneedtoknow.com/java_book.html](https://www.theminimumyouneedtoknow.com/java_book.html)

在 OpenVMS 源上使用 x86 编辑器时真正重要的是您的文件传输软件。OpenVMS（和许多其他基于 ASCII 的中端平台）使用即使大多数 PC 开发人员说 LineFeed 回车，数据文件通常以其他顺序存储它。

您可以在此处阅读更多相关信息： [https ://www.logikalsolutions.com/wordpress/information-technology/most-text-editors-get-tabs-wrong/](https://www.logikalsolutions.com/wordpress/information-technology/most-text-editors-get-tabs-wrong/)

您的文件传输软件将需要执行文本模式文件传输更改行尾字符，**或者**您的编辑器需要使用并尊重更好的系统行尾字符。我*认为*Eclipse 中有一些东西（通过插件）来处理这个问题。Notepadqq声称有东西。

**请注意：**他们使用 Eclipse 进行开发，而不仅仅是编辑。

这意味着他们正在他们自己的基于 PC 的 Eclipse 世界中运行和调试，而这并不是它在 OpenVMS 上的工作方式。他们将需要一个终端进入 VMS 系统，它需要是一个**真正的 VT-100**终端仿真器，而不是毫无价值的免费东西。你可以在这里阅读更多关于它的信息：

[https://www.logikalsolutions.com/wordpress/information-technology/diamond-edt-keypad-support/](https://www.logikalsolutions.com/wordpress/information-technology/diamond-edt-keypad-support/)

和这里

[https://www.logikalsolutions.com/wordpress/information-technology/xterm-and-vt-emulation/](https://www.logikalsolutions.com/wordpress/information-technology/xterm-and-vt-emulation/)

根据您的系统的使用年限，您可能已经安装并运行了[Pathworks 。](https://en.wikipedia.org/wiki/Pathworks)然后系统管理员可以为每个用户创建一个目录，他们可以将其作为网络驱动器映射到 PC。这使 PC 用户可以像使用任何其他网络磁盘一样使用该目录，并且通常可以将其配置为处理文本文件的行结束问题。

他们无法使用 Eclipse 在 OpenVMS 上进行*开发。*他们可以编辑文件然后在 OpenVMS 上进行测试，但他们无法在 IDE 中开发，我怀疑这是他们真正想要做的。

OpenVMS 唯一存在的 GUI 是[DECWindows](https://vmssoftware.com/products/decwindows-motif/)。您必须在 VAXStation 或 DS 型号 Alpha 工作站上运行它。我从来没有听说过 Eclipse 被移植到它上面。在 OpenVMS 到 x86 的最新端口中，没有 GUI。它是一个仅限服务器的操作系统。

是的，我在这个平台上呆了二十年，甚至为此写了[这本书](https://www.theminimumyouneedtoknow.com/app_book.html)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-06-07T20:22:41.793

是的，有一个版本`Eclipse`支持`OpenVMS`称为`NXTware Remote`. 它支持*Java*和*COBOL*语言以及*Fortran*、*Basic*和*Pascal*。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-10-11T13:06:39.190

您可以使用几乎任何编辑器（包括 Eclipse）来编辑 OpenVMS 文件 - 只需使用 Samba 使 OpenVMS 目录和文件对网络上的桌面可见。如果您为 OpenVMS 安装 Java，那么您就会有人使用 Eclipse，并在 OpenVMS 上编译和运行。

至于放弃 Cobol - 为什么？仍然有很多公司在运营它，而且肯定会持续数十年。

# subsonic - 亚音速忽略列

> ID：685844
> 
> 赞同：0
> 
> 时间：2009-03-26T13:41:56.847
> 
> 标签：subsonic

SubSonic 有没有办法更新表格的某些列？

例如

```
Dal.Users users = new Dal.Users();

users.UserId = user.id;
users.Email = user.email;
users.FirstName = user.firstName;
users.LanguageId = user.languageId;
users.LastName = user.lastName;
users.Password = user.password;
users.UserName = user.userName;
users.Data = user.data;

users.IsNew = (user.id == -1);

users.Save() 
```

例如是否可以注释掉行***users.Password = user.password;*** 这样该字段就不会被更新（但也不会在数据库中设置为空）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T18:50:32.537

你用的是什么版本？最新的（2.1）仅更新数据库中更改的列。实际上，我曾经使用过的每个版本都从未将字段设置为 null 如果没有指定，那么肯定会发生其他事情。

# sql - 在 Oracle 的一个 ExecuteScalar 中运行多个命令

> ID：685850
> 
> 赞同：6
> 
> 时间：2009-03-26T13:42:58.793
> 
> 标签：sql, oracle, executescalar, ora-00911

我有一批 sql 语句，例如...

插入.... ; 插入.... ; 删除 .........;

ETC

当我尝试对 oracle 执行它们时，它给了我[这个](http://ora-00911.ora-code.com/)错误（ORA-00911 无效字符）

现在我可以理解这是因为语句之间的分号，我在 SQL Server 上尝试过它并且它工作但在 Oracle 中到目前为止没有运气。

有没有办法通过使用 ExecuteScalar 或其他函数对 oracle 运行多个语句？

* * *

**重复**：[如何使用 .NET 执行多个 Oracle SQL 语句](https://stackoverflow.com/questions/528676/how-can-i-execute-multiple-oracle-sql-statements-with-net)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-26T14:00:57.690

尝试用`BEGIN..END`

```
BEGIN insert into.... ; insert into.... ; delete .........; END; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T14:58:48.393

尝试 BEGIN END 对我不起作用。

我所做的是创建一个新方法，给定一个连接（我尝试最小化我打开的连接），它使用 ; 拆分语句。作为分隔符并单独运行每个分隔符

```
 private void ExecuteSql(string statements, IDbConnection conn)
    {
        IDbCommand cmd = conn.CreateCommand();
        string[] commands = statements.Split(new string[] { ";\r\n", "; ", ";\t", ";\n" }, StringSplitOptions.RemoveEmptyEntries);
        foreach (string c in commands)
        {
            cmd.CommandText = c;
            cmd.CommandType = CommandType.Text;
            cmd.ExecuteNonQuery();
        }

        cmd.Dispose();
    } 
```

[在佩特罗斯](https://stackoverflow.com/users/2812/petros)告诉我这件事后，我的灵感来自[这篇文章](https://stackoverflow.com/questions/680605/how-to-provide-a-sql-command-line-interface-like-osql-to-a-mssql-database-via-w/680772#680772)

PS您可能需要根据您的需要进行更改，在我的情况下，我需要打开连接，并在调用者发生某些事情时相应地关闭。

# sql - MySQL日期查询问题

> ID：685851
> 
> 赞同：2
> 
> 时间：2009-03-26T13:43:14.550
> 
> 标签：sql, mysql

我对 MySQL 日期和查询有疑问。

**首先**：

```
SELECT * FROM post WHERE DATE(Post_Date)="2009-03-25" 
```

返回 0 个结果

```
SELECT * FROM post WHERE Post_Date="2009-03-25" 
```

返回 71 个结果

```
SELECT * FROM post WHERE Post_Date>="2009-03-25" 
```

返回 379 个结果

我知道返回 71 个结果的第二个查询仅匹配带有`2009-03-25 00:00:00`as 的帖子，`Post_Date`第三个查询显示了所有内容。但是为什么第一个查询 SHOW 0 RESULTS?? 请帮忙！我检查了 MySQL cnf 并将其`date_format`设置为`%Y-%m-%d`

**第二**：

```
SELECT * FROM post WHERE DATE(Post_Date)="2009-03-25" 
```

在 WINDOWS 上返回结果！

```
SELECT * FROM post WHERE DATE(Post_Date)="2009-03-25" 
```

在 Linux 中没有结果！

任何指示都会有所帮助！是否需要更改配置文件才能使其在 Linux 中工作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T13:48:14.007

诊断步骤：在每个系统上运行查询 SELECT DATE('2009-03-25 08:30:00')。结果可能会告诉你发生了什么。（可能是版本问题。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T14:06:10.253

不知道你的第一部分今天会发生什么，但至于第二部分：你是否检查以确保 Windows 和 Linux 上的服务器在各自的数据库中具有相同的数据？如果您确定它们是，您可能需要检查 Linux 数据库是否给出了该年或年月的任何结果，而不仅仅是特定的年月日。

# php - 如何在 PHP / MySQL 中对用户进行身份验证？

> ID：685855
> 
> 赞同：8
> 
> 时间：2009-03-26T13:43:40.510
> 
> 标签：php, authentication

所以最近我学会了如何正确地将用户名和密码添加到数据库中。我的数据库是usersys，存储用户信息的表叫userdb。该表有两列 - 用户名（主要）、密码。

注册表工作得很好，将用户输入正确地输入数据库，并检查用户的用户名是否已经在数据库中。

话虽如此，我问是否有人可以帮助我创建登录脚本。到目前为止，这就是我所拥有的：

```
$username = $_POST['username'];
$password = $_POST['password'];
$displayname = $_POST['username'];
$displayname = strtolower($displayname);
$displayname = ucfirst($displayname);           
echo "Your username: " . $displayname . "<br />";

mysql_connect("localhost", "root", "******") or die(mysql_error());
echo "Connected to MySQL<br />";

mysql_select_db("usersys") or die(mysql_error());
echo "Connected to Database <br />";

$lcusername = strtolower($username);
$esclcusername = mysql_real_escape_string($lcusername);
$escpassword = mysql_real_escape_string($password);

$result = mysql_query("SELECT * FROM userdb WHERE username='$esclcusername' AND     password='$escpassword'") or die(mysql_error());
$row = mysql_fetch_array( $result );
$validateUser = $row['username'];
$validatePass = $row['password']; 
```

POST 数据来自上一个登录页面。我希望此脚本检查表 (userdb) 并找到用户从前一个表单输入的用户名的行，并验证输入的密码是否与 userdb 表中该行中设置的用户名密码匹配。

我还想要某种方法来检查输入的用户名是否存在，如果在表中找不到输入的用户名，则告诉用户输入的用户名不存在。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-26T14:03:08.480

这不是对这个问题的直接答案，而是一个很好的增值。在存储到数据库之前，您应该使用 MYSQL SHA1 函数对密码进行加密。

```
$user = $_POST['userid'];
$pwd = $_POST['password'];
$insert_sql = "INSERT into USER(userid, password) VALUES($user, SHA1($pwd))";

$select_sql = "SELECT * FROM USER WHERE userid=$user AND password=SHA1($pwd))"; 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-26T13:45:23.000

您可以使用会话。会话是全局变量，设置后会在用户浏览网站时与用户保持一致。

由于您正在学习 PHP，请在官方网站上[尝试本教程。](http://is.php.net/manual/en/session.examples.basic.php)

但是理论上你会做的是当用户名和密码匹配时，你设置一个会话变量

```
$_SESSION["auth"] = true;
$_SESSION["user_id"] = $row["user_id"]; 
```

然后检查用户是否已通过身份验证。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-26T13:56:05.393

一种方法（免责声明：不一定是最佳实践）：

```
$result = mysql_query("SELECT id FROM userdb WHERE username='$esclcusername' AND  password='$escpassword'") or die(mysql_error());
$row = mysql_fetch_array( $result );
$id = (int)$row['id'];
if($id > 0) {
    //log in the user
    session_start();
    $_SESSION['userId'] = $id;
    $_SESSION['username'] = $displayname;
} 
```

...以及在需要身份验证的页面上：

```
session_start();
if(!isset($_SESSION['userId'])) {
    die('You need to be logged in!!!');
} else {
    echo 'Welcome ' . $_SESSION['username'];
} 
```

阅读有关 PHP[会话](http://php.net/session)的更多信息。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-02-13T05:24:44.743

我喜欢在任何登录 POST 中同时使用`$_SESSION`和检查。`MYSQL`这应该有助于开始一些事情。

```
$username = mysql_real_escape_string($_POST[username]);
$password = strip_tags($_POST[password]);
$password = sha1($password);

if(isset($username) && isset($password) && !empty($username) && !empty($password))
{
$sql = mysql_query("SELECT * FROM users_column WHERE username = '$username' AND password = '$password'");

//Check the number of users against database
//with the given criteria.  We're looking for 1 so 
//adding > 0 (greater than zero does the trick). 
$num_rows = mysql_num_rows($sql);
if($num_rows > 0){

//Lets grab and create a variable from the DB to register
//the user's session with.
$gid = mysql_query("SELECT * FROM users_column WHERE username = '$username' AND password = '$password'");
$row = mysql_fetch_assoc($gid);
$uid = $row[userid];

// This is where we register the session.
$_SESSION[valid_user] = $uid;

//Send the user to the member page.  The userid is what the 
//session include runs against.
header('Location: memberpage.php?userid='.$userid);
}

//If it doesn't check out -- throw an error.
else
{
echo 'Invalid Login Information';
}
} 
```

注意：您需要启动页面文件`session_start()`并创建一个单独的会话检查，包括说明，`session_start()`然后您的进度，例如`if($_SESSION[valid_user] != $userid)`做某事。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-11-09T16:14:41.693

如果在验证用户时使用 SESSION 变量，我同意这个想法。

验证用户的简单方法如下

```
//connect the mysql_db
$mysql_connect()
$mysql_select_db() 

//reading from mysql table
$res="SELECT * FROM table WHERE name=$username AND password=$password";
$val=mysql_query($res);

//authentication
$count=mysql_num_rows($val);
if($count==1)
//authenticate the user
else
through an error 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-26T13:56:58.497

您可以使用 select 语句从 MySQL 中检索指定用户名的密码。如果您有一个空的结果集，那么您在表中没有用户名。

如果您需要在多个 php 页面中对用户进行身份验证，那么一种选择应该是使用会话（[http://www.php.net/manual/en/function.session-start.php](http://www.php.net/manual/en/function.session-start.php)）。

另外，我认为您应该考虑安全性，即防止 SQL 注入：

```
$variable = mysql_real_escape_string($_POST['variable']) 
```

并避免“死亡”（处理错误并从脚本返回用户友好的消息）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-26T14:01:12.777

我还会考虑不在您的数据库中存储密码。使用 MD5 或 SHA1 的一种方法是在数据库级别添加安全层的一种方法。

有关详细信息，请参阅[http://php.net/md5](http://php.net/md5)或[http://php.net/sha1](http://php.net/sha1)。

# c# - 对于 Windows 开发人员来说，存在什么样的轮询服务器模式？

> ID：685859
> 
> 赞同：0
> 
> 时间：2009-03-26T13:45:00.943
> 
> 标签：c#, .net, performance, scalability, polling

轮询服务器似乎是某些类型的企业应用程序出现的主题，尤其是社交网络 Web 应用程序。

根据我的阅读，Unix 端的人们使用 memcache，每秒可以给你几千个请求。

由于我们没有 memcache 替代方案，Windows 开发人员有哪些选择？（我没有时间在那个级别学习 Unix）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T13:56:39.823

我不能保证 memcached 实际上适合您的问题，但让它在 Windows 服务器上运行应该不会太难。查看[用于 Win32](http://jehiah.cz/projects/memcached-win32/)的 memcached 以获得良好的起点。如果您的问题大到需要 memcached，那么移植它或使端口工作的努力可能不应该吓倒您。

# javascript - 从 RSS 提要开发小部件的最佳方法是什么？

> ID：685862
> 
> 赞同：1
> 
> 时间：2009-03-26T13:45:07.637
> 
> 标签：javascript, jquery, html, flash

从 RSS 提要开发小部件的最佳方法是什么

1.  在所有网站和浏览器中统一呈现

2.  哪个可以轻松嵌入其他网站而不会遇到任何问题？

我尝试了以下方法，但每个方法都有自己的问题

**使用 Javascript**：当将此类小部件嵌入其他网站时，此小部件的样式与网站的样式重叠。因此，它不会在所有网站中统一呈现。

**使用 html/IFrame**：由于 iframe 嵌入在其他网站上，我无法根据内容使用 javascript 动态设置 iframe 的大小（不允许跨域脚本）。因为滚动条进入图片.哪个不好？并且没有用户会嵌入小部件。

那么关于如何开发一个在所有网站上均匀呈现而没有任何问题的小部件的任何指南/建议？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T14:19:55.307

风格问题在两者中更容易解决。如果您使用 Javascript 进行渲染，您可以注入您自己的仅适用于您的小部件的 CSS 规则。例如，您可以在小部件的外部 DIV 上放置一个 ID，并通过该 ID 确定所有规则的范围：

```
#widget *  { 
  font-family: Verdana;
  text-size: 12px;
}

#widget a:link {
  color: blue;
  text-decoration: underline; 
  cursor: pointer;
} 
```

等等。

要解决框架大小调整问题，您需要在要嵌入的页面的服务器上托管一些代码，以及一些非常巧妙的脚本来促进框架通信层。

# python - python 2.6+ (win32) 上的 mysqldb

> ID：685869
> 
> 赞同：10
> 
> 时间：2009-03-26T13:45:56.183
> 
> 标签：python, mysql

我目前正在使用 python 2.6，我想使用 win32 mysqldb 模块。不幸的是，它似乎需要 2.5 版本的 Python。有什么办法可以摆脱版本号中的这种不匹配并使用 python 2.6 安装 mysqldb 吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-26T16:50:17.490

有用于 python 2.6 的 mysqldb 版本，它们只是在官方网站上不可用。我花了一段时间（不幸的是我失去了链接），但你可以搜索谷歌并找到为 windows x64 和 x32 编译和发布 mysqldb 2.6 版本的人。

编辑：

[http://sourceforge.net/forum/forum.php?thread_id=3108914&forum_id=70460](http://sourceforge.net/forum/forum.php?thread_id=3108914&forum_id=70460)

[http://sourceforge.net/forum/forum.php?thread_id=2316047&forum_id=70460](http://sourceforge.net/forum/forum.php?thread_id=2316047&forum_id=70460)

那个fourm有一个链接到python 2.6的mysqldb版本

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-10-21T19:42:56.020

这个有 2.6 的 32 和 64 版本：http:
[//www.codegood.com/archives/4](http://www.codegood.com/archives/4)

# php - mysql_data_seek pdo 等效项

> ID：685871
> 
> 赞同：4
> 
> 时间：2009-03-26T13:46:06.430
> 
> 标签：php, mysql, pdo

哪个相当于使用 pdo 对象的 mysql_data_seek？你可以给我一个例子吗？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-04-03T12:35:18.977

通常的答案是：您的数据是否直接在数组中查找`PDOStatement::fetchAll`......但是如果查询获取大量数据（！），则它是错误的。

有2个真正的解决方案，

**1)**如果数据库允许使用 ，`PDO::FETCH_ORI_ABS`或者`PDO::FETCH_ORI_REL`，例如，

```
$result = $sth->fetch(PDO::FETCH_ASSOC, PDO::FETCH_ORI_ABS, 973); 
```

（编辑）但是，正如@ChoiZ 评论的那样，有一个[PDO-MySQL 限制](https://stackoverflow.com/a/12064438/287948)：“MySQL 不支持[游标](http://dev.mysql.com/doc/refman/5.0/en/cursors.html)”（*外部*存储程序）“并且驱动程序无法为您模拟它们”......稍后尝试或使用 MySQL 的分支，像 MariaDB。

**2）**使用数据库解决方案（一种分页）。例子：

```
SELECT a, b FROM table LIMIT 1, 973 
```

# python - 为什么 setuptools 有时会删除然后重新安装完全相同的 egg？

> ID：685874
> 
> 赞同：3
> 
> 时间：2009-03-26T13:47:05.993
> 
> 标签：python, setuptools

我正在尝试在已经存在相同鸡蛋的计算机上安装鸡蛋。为什么它会删除鸡蛋然后重新安装它？我从带有选项的脚本调用easy_install：

```
['-v', '-m', '-f', 'R:/OPTIONS/Stephen/python_eggs', 'mypkg==1.0_r2009_03_12'] 
```

在运行 easy_install 命令时观察到：

```
Searching for mypkg==1.0-r2009-03-12
Best match: calyon 1.0-r2009-03-12
Processing calyon-1.0_r2009_03_12-py2.4-win32.egg
Removing d:\devtools\python24\lib\site-packages\mypkg-1.0_r2009_03_12-py2.4-win32.egg
Copying mypkg-1.0_r2009_03_12-py2.4-win32.egg to d:\devtools\python24\lib\site-packages 
```

这是什么原因造成的？为什么有时鸡蛋会被移除并重新安装，而有时会保留鸡蛋？我已经在我自己的 PC 上看到过几次这种情况，但我不确定如何始终如一地重现这种行为。

我正在使用 setuptools 0.6c9

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-31T23:19:16.013

这是我猜测正在发生的事情……这是根据您对症状的描述的猜测。

假设在您的示例中 mypkg 和 calyon 相同，则在您的末尾使用 -r2009-03-12 不是 setuptools 的预期格式（发布后标签的标准格式没有连字符 YYYYMMDD），因此它不能确保当前版本是最新的。查看下面的链接并确保您的版本控制正确。

此外，我相信 easy_install 在 easy-install.pth 文件中管理其版本信息。你的 easy-install.pth 文件对你的包有什么看法？

[http://peak.telecommunity.com/DevCenter/setuptools#specifying-your-project-s-version](http://peak.telecommunity.com/DevCenter/setuptools#specifying-your-project-s-version) [http://peak.telecommunity.com/DevCenter/setuptools#tagging-and-daily-build-or-snapshot-releases](http://peak.telecommunity.com/DevCenter/setuptools#tagging-and-daily-build-or-snapshot-releases)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T18:41:41.270

它可能会出现在[错误列表中](http://bugs.python.org/setuptools/)，否则最好报告它。

# database - 最佳优化主键查询的大型数据库

> ID：685882
> 
> 赞同：2
> 
> 时间：2009-03-26T13:51:13.970
> 
> 标签：database, performance, database-design

假设您有一个非常大的数据库，为了简化，假设它由一个主表组成，您将使用一个（并且只有一个）主键字段 - 进行查找`pk`。

鉴于所有查找基本上都将是`SELECT * FROM table_name WHERE pk=someKeyValue`，优化此数据库以获得最快查找的最佳方法是什么？

**编辑：**只是更多的细节 - `INSERT`s 和`UPDATE`s 将非常不频繁，所以我不介意牺牲那里的性能以获得更好的查找性能。

此外，似乎集群是要走的路。你有什么例子说明我可以用这种方法提高性能吗？这到底是如何完成的（在任何类型的数据库上）？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T13:59:43.997

如果主键是集群的，那么你将不会更快。

如果它不是集群的，并且表中的列数相对较少，那么理论上您可以创建一个覆盖索引来加快查询速度。但这否定了拥有非集群主键会给您带来的任何插入/更新性能增强。

如果您的主键是一个不断增加的字段（例如 SQL Server 标识，或从 Oracle 中的序列生成），那么集群主键无论如何都没有缺点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T13:57:17.777

您可以做的一件事是使主键聚集在一起，这会导致实际数据在磁盘上进行物理排序，从而加快查询速度。

这也意味着插入速度较慢，但​​如果您选择的频率比插入频率高得多，这应该不是问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T14:55:21.943

如果你使用 MySQL，你可以做一些额外的事情（除了调整你的缓存值）。表引擎可能是一个因素；例如，MyISAM 被广泛认为在 SELECT 上比 InnoDB 更快。如果这个表主要是一个查找表，并且您使用的是 MySQL，那么这可能是一件好事。（平均而言，InnoDB 相当不错；它在写入方面比 MyISAM 更好，而且，InnoDB 永远不需要修复。）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-28T05:53:37.783

我必须在上面提出的所有内容中再添加两个选项（我喜欢 dwc 的回答）。如果你的表真的很大，你应该考虑分区。

首先，水平分区（特别是如果 I/O 是数据库中的瓶颈）。您创建多个文件组并将它们定位在不同的硬盘驱动器上。然后，创建 Partition Function、Partition Scheme 来划分你的表并将你的表的某些部分放在不同的 HD 上（例如第 1-499999 行到 F: 驱动器，500000-999999 到 G: 驱动器，等等）。

二是垂直分区。如果您在大多数查询中选择列集（而不是 *），这将起作用。在这种情况下，将表中的列分为两组：第一，所有查询中需要的字段；第二，你很少需要的字段。创建两个具有相同主键的表。当您需要两个表中的列时，在主键上使用 JOIN。

（此答案适用于 SQL Server 2005/2008。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T13:53:51.700

如果您的所有查询都将基于 PK，则通过在 PK 上设置索引不会获得任何额外的好处，因为它应该已经被索引了。

编辑：我建议的唯一其他可能的事情是查看规范化您的表格（如果这甚至是一种选择或必要性）。通过将项目拆分到其他表中，您可以细化在每个查询中被拉回的内容，并且仅在需要时使用连接提取较少使用的项目。

基于“具有单个表的非常大的数据库”的有限描述，如果不查看您实际存储在字段中的数据类型，就很难找到任何简单而明显的优化方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-26T14:43:24.873

*   如果您的 PK 顺序与插入顺序（即时间或 id/自动增量）匹配，则将其设为集群。这将减少插入时的磁盘和缓存抖动，从而将更多资源用于查找。
*   考虑将表格上的页面大小调整为记录大小的精确倍数。这需要对特定数据库软件有深入的了解，以了解详细信息如何，以及记录/索引开销等。
*   如果可行，请对所有列使用固定大小而不是可变大小。
*   考虑将索引和/或事务日志文件放在单独的卷上。
*   安装软件和硬件可以使用的尽可能多的 RAM。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-27T01:56:29.610

如果您使用的是 Oracle，那么我建议您对三种方法进行基准测试：

1.  具有主键索引的堆表
2.  索引组织表
3.  单表哈希集群

1 代表了一种非常普通的方法——实际上它是最小的公分母，但可能意味着 5 次以上的逻辑读取来获取每一行，如果没有完全缓存，其中一个可能是对表的物理读取。

2 将通过避免探测到单独的表段来为您节省其中一个逻辑读取，但可能不会为您节省物理读取，因为 IOT 段将比单独的索引更大且更难缓存。

3 可能会通过单个逻辑读取为您获取行，但除非您缓存了整个表，否则可能会转换为物理读取。

强烈建议进行基准测试。

# asp.net - 网络服务请求

> ID：685894
> 
> 赞同：0
> 
> 时间：2009-03-26T13:54:17.240
> 
> 标签：asp.net, web-services

我正在构建一个使用外部 Web 服务的网站。我已将外部服务的 WSDL 添加为对我的站点的引用。当我在外部服务中调用 Web 方法时，如何查看作为请求发送的 SOAP 信封的内容？

`XML Parse Exception`当我拨打网络服务电话时，我得到了一个。所以我想查看作为请求发送的 SOAP 信封的内容。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T14:16:36.140

SO上有一个类似的问题：[.NET Log Soap Request on Client](https://stackoverflow.com/questions/149851/-net-log-soap-request-on-client)。

推荐的工具有：

*   [提琴手](http://www.fiddlertool.com/)
*   [肥皂界面](http://www.soapui.org/)

# workflow - 如何将控制权交给调用方法

> ID：685896
> 
> 赞同：2
> 
> 时间：2009-03-26T13:54:32.573
> 
> 标签：workflow, inversion-of-control

假设我有一个带有`Execute`方法的 Task 对象。这个方法有一个到几个步骤，每个步骤都需要用户点击一个“继续”按钮，例如当`Execute`被调用时，任务告诉它的容器（在这种情况下是一个 Windows 窗体）显示一个介绍性消息，并等待一个按钮单击，然后继续步骤 2，通知用户正在发生的事情并执行一些工作。

我不希望控制器必须知道任务中的步骤，无论是隐式地，例如调用`Execute(Steps.ShowIntro)`等，`Execute(Steps.PerformTask)`还是显式地，使用多个 Execute 方法，例如`ExecuteIntro()`，`ExecuteTask()`等。

目前我正在使用 Phase 枚举来确定单击 Continue 按钮时要执行的操作：

```
show phase 1 intro.
set current_phase = PhaseOne.
on continue_button click
    switch current_phase
        case PhaseOne:
            show phase 1 'Now doing:' message.
            execute phase 1 task.
            show phase 2 intro.
            set phase to PhaseTwo.
        case PhaseTwo:
            show phase 2 'Now doing:' message.
            execute phase 2 task.
            show phase 3 intro.
            set phase to PhaseThree. 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T14:05:31.893

为什么不简单地使用 Execute 方法实现与步骤一样多的类，并将这些类的实例放入队列中。

通过按“继续”，您将使用 Execute 获取该类的另一个实例并调用它。

```
class Task
    method execute()
        foreach task in queue execute task
    method addSubTask( task )
        add task to queue 

class ShowIntroSubTask extends Task
class ExecuteIntroSubTask extends Task 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T14:09:29.277

Mykola 的回答听起来不错，但如果您想要一个替代方案，请考虑传入一个`ConfirmContinuation`回调，它`Execute`可以根据需要使用（例如，在步骤转换中）。如果您想保持抽象，只需将其命名为类似`NextStep`并将语义留给容器即可。

# visual-studio - “在对象浏览器中查看”的快捷键

> ID：685897
> 
> 赞同：17
> 
> 时间：2009-03-26T13:54:40.937
> 
> 标签：visual-studio, keyboard-shortcuts

有谁知道在对象浏览器中是否有用于查看所选对象（在文本编辑器中）的快捷键？

我确定有一个，但我找不到它，或者任何似乎在键绑定对话框中起作用的东西。

例如：

字符串测试 = string.empty;

```
if (string.isnullorempty(test))
{                          ^ caret here
    ...
} 
```

按下键会将对象浏览器打开到 System.String

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2013-11-26T12:10:10.953

这将导航到对象浏览器中的正确类。

`Shift`++ `Alt`，`F12`然后右键单击结果并选择浏览定义

或者

`Ctrl`++ ，然后在搜索框中输入`Alt`名称`J`

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-27T22:51:39.640

`F12`将转到源（如果有的话），或者如果它在引用的程序集中，则转到对象浏览器。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-26T14:01:13.947

使用 Ctrl-Alt-J。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T19:49:16.787

是的，这是 CTRL + ALT + J

这是参考：[对象浏览器快捷键，Visual C++ 6.0 默认快捷键选项](http://msdn.microsoft.com/en-us/library/ztdfwss8.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-01-24T12:44:06.180

我发现使用单个快捷方式执行此操作的唯一方法是通过 ReSharper 和定义。

编辑器上下文菜单。codewindow.navigate.resharper_navigatetoobjectbrowser 作为 alt +shift + j （或你想要的）。也许有一种方法可以创建代码，将其链接到函数并在此窗口中添加快捷方式，而无需安装 ReSharper，或者打开一张到 Visual Studio teem 的票

[捷径](https://i.stack.imgur.com/O3DLT.png)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-04-15T12:04:19.250

它曾经是 Ctrl + LeftMouseClick 您要搜索的内容（大约 2015 年），但在 VS 2019 中不再起作用。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2011-01-09T16:13:36.530

当您按 F12 时，Resharper 会导航到对象浏览器中的类

# c# - 从 ASP.Net 页面运行工具的最佳方式

> ID：685899
> 
> 赞同：3
> 
> 时间：2009-03-26T13:55:03.803
> 
> 标签：c#, asp.net, executable

我有一个想要从内部站点运行的开发人员工具。它扫描项目的源代码并将信息存储在数据库中。我希望用户能够访问该站点，选择他们的项目，然后点击运行。

我不希望将代码上传到站点，因为项目可能很大。我希望能够在他们的机器上本地运行我的程序集。是否有捷径可寻？

编辑：我应该注意，暂时，这需要在 VS2005 中完成。
编辑 2：我正在寻找与[TrendMicro 的 Housecall](http://housecall.trendmicro.com/)类似的功能。我希望扫描在本地运行，但结果要显示在网页中

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T13:59:35.307

您可以使用 ClickOnce 项目 (winform/wpf) - 本质上是一个常规客户端应用程序，通过 Web 服务器部署。在客户端，它可以做任何它需要的事情。VS2005/VS2008 将此（用于 winform/wpf）作为“发布” - 并导致浏览器（或至少某些浏览器；-p）识别的“.application”文件。

您**也许**可以对 Silverlight 做同样的事情，但它有一个更严格的沙箱等。它还需要让 Web 服务器代表它完成所有的数据库工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T13:59:27.007

> 我希望能够在他们的机器上本地运行我的程序集

听起来您希望他们下载该工具并从本地计算机上运行它，这对您有用吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T14:07:41.903

任何代码都可以扫描给定位置和权限的文件。如果一个网站在另一台机器上打开一个 exe 并允许它运行并访问 Web 服务器上包含的文件，则需要非常低的安全级别，这意味着整个系统实际上是完全开放的，容易受到攻击。如果您的系统完全位于防火墙后面并因此免受外部干扰，那么您希望更多地查看权限而不是代码。

要在机器上运行 exe，请尝试以下记事本示例，尽管您可能还必须使用指定的目录

ProcessStartInfo psi = new ProcessStartInfo("notepad.exe");
psi.WindowStyle = ProcessWindowStyle.Hidden;

进程 p = new Process(); p.EnableRaisingEvents = true; p.Exited += new EventHandler(ExitHandlerToKillProcess); p.StartInfo = psi; p.Start();

完成后不要忘记终止进程。或者使用javascript。无论哪种方式，请注意安全权限并记住这样做的风险。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T14:10:01.117

我可能会编写某种命令行工具或服务来处理和提取项目数据。然后我会使用一个页面来更新/注册 Web 服务器和命令行工具都可以访问的项目。然后在指定时间手动或通过 cron 或类似机制将数据提取到您的数据库中。一旦你有了这个，你只需使用网站来显示最后的提取时间和提取的数据。

如果项目/最终用户位于不同的子网等，那么您将需要最终用户运行该工具，然后让它将数据发布到数据库中。

# oracle - PL/SQL：在 CURSOR 内更新，但有些数据为 NULL

> ID：685902
> 
> 赞同：0
> 
> 时间：2009-03-26T13:55:29.200
> 
> 标签：oracle, plsql

我仍在学习一些 PL/SQL 的差异，所以这可能是一个简单的问题，但是......这里有。

我有一个光标，它可以抓取一堆具有多个字段的记录。然后，我在游标结果的 LOOP 中运行两个单独的 SELECT 语句，以获取一些距离并计算这些距离。这些工作完美。

当我用新值更新表格时，我的问题是有四个特定标准。

```
update work
        set kilometers = calc_kilo,
            kilo_test = test_kilo                                  
        where lc = rm.lc
        AND ld = rm.ld
        AND le = rm.le
        AND lf = rm.lf
        AND code = rm.code
        AND lcode = rm.lcode
        and user_id = username; 
```

我的问题是这很少更新，因为 rm.lf 和 rm.le 在数据库中有 NULL 值。我该如何解决这个问题，并创建正确的更新。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T14:10:57.650

如果我对您的理解正确，您想与 匹配`lf`，`rm.lf`包括当它们都为空时？如果这就是你想要的，那么这将做到：

```
...
AND (lf = rm.lf 
  OR (lf IS NULL AND rm.lf IS NULL)
)
... 
```

它正在比较 and 的值，`lf`如果`rm.lf`其中一个为 null，则返回 false，因此`OR`如果它们都为 null，则条件返回 true。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T17:52:31.053

> 我有一个光标，它可以抓取一堆具有多个字段的记录。然后，我在游标结果的 LOOP 中运行两个单独的 SELECT 语句，以获取一些距离并计算这些距离。这些工作完美。
> 
> 当我用新值更新表格时，我的问题是有四个特定标准。

我首先要看的是不使用游标来读取数据，然后进行计算，然后执行更新。在 99% 的情况下，只需运行一步即可完成所有这些操作的更新会更快、更容易

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T01:15:25.350

```
update work 
        set kilometers = calc_kilo, 
            kilo_test = test_kilo                                   
        where lc = rm.lc 
        AND ld = rm.ld 
        AND NVL(le,'x') = NVL(rm.le,'x') 
        AND NVL(lf,'x') = NVL(rm.lf,'x') 
        AND code = rm.code 
        AND lcode = rm.lcode 
        and user_id = username; 
```

# delphi - 如何在 DUnit 中使用 FastMM 启用内存泄漏跟踪？

> ID：685904
> 
> 赞同：13
> 
> 时间：2009-03-26T13:55:56.017
> 
> 标签：delphi, memory-leaks, fastmm, dunit

在 GUI 测试运行器中，用于内存泄漏检查的菜单项处于非活动状态（灰显）。是否有一个我还没有找到的特殊开关来激活它们？

使用 DUnit 9.4（来自 Delphi 2009 或来自 sourceforge Subversion 存储库）和 FastMM4.92

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-26T14:17:56.933

您必须使用 FASTMM 和 ManualLeakReportingControl 指令构建您的 DUnit GUI-testrunner。这将启用内存泄漏项（查看 GUITestRunner.pas）。

# c++ - 如何进行带偏差的浮点舍入（始终向上或向下舍入）？

> ID：685907
> 
> 赞同：7
> 
> 时间：2009-03-26T13:56:18.857
> 
> 标签：c++, floating-point, rounding

我想用偏差来舍入浮点数，要么总是向下，要么总是向上。代码中有一个特定点我需要这个，程序的其余部分应该像往常一样四舍五入到最接近的值。

例如，我想四舍五入到最接近的 1/10 倍数。最接近 7/10 的浮点数约为 0.69999998807，但最接近 8/10 的浮点数约为 0.80000001192。当我对数字进行四舍五入时，这是我得到的两个结果。我宁愿让它们以同样的方式四舍五入。7/10 应四舍五入为 0.70000004768，8/10 应四舍五入为 0.80000001192。

在这个例子中，我总是向上取整，但我有一些地方我想总是向下取整。幸运的是，我只在这些地方处理积极的价值观。

我用来四舍五入的线是`floor(val * 100 + 0.5) / 100`. 我正在用 C++ 编程。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-26T15:28:04.830

我认为实现这一点的最佳方法是依靠以下事实：根据 IEEE 754 浮点标准，浮点位的整数表示按字典顺序排列为 2 补码整数。

即你可以简单地添加一个ulp（最后一个单位）来获得下一个浮点表示（如果它更小，它总是会比你的阈值略大，因为圆形误差最多为1/2 ulp）

例如

```
 float floatValue = 7.f/10;
 std::cout << std::setprecision(20) << floatValue << std::endl;
 int asInt = *(int*)&floatValue;
 asInt += 1;
 floatValue = *(float*)&asInt;
 std::cout << floatValue << std::endl; 
```

打印（在我的系统上）

```
 0.69999998807907104492
 0.70000004768371582031 
```

`floor`要知道何时需要添加一个ulp ，您必须依赖`floor`

```
 if (std::floor(floatValue * 100.) != std::floor(floatValue * 100\. + 0.5)) {
    int asInt = *(int*)&floatValue;
    asInt += 1;
    floatValue = *(float*)&asInt;
 } 
```

将正确地将 0.69.. 转换为 0.70.. 但不理会 0.80..。

`100.`请注意，在应用之前，浮点数通过与乘法提升为双精度`floor`。

如果你不这样做，你就有可能陷入这样的境地

```
 7.f/10.f * 100.f 
```

（精度有限）浮点表示将是 70.00...

# asp.net - 波浪号未在 ASP.NET 2.0 的 HyperLinkColumn 中解析

> ID：685908
> 
> 赞同：0
> 
> 时间：2009-03-26T13:56:21.603
> 
> 标签：asp.net, hyperlink, tilde

我有一个最初部署到 Windows 2000 服务器上的 .Net 1.1 框架的 ASP.NET 应用程序，我现在正在使用 2.0.50727 的 Windows 2008 服务器上使用它。我们使用波浪号 (~) 来解析应用程序的许多区域中的绝对路径，它适用于诸如 asp:hyperlink 控件（带有 run-at server 标签）之类的东西，但适用于使用 HyperLinkColumns 创建的绑定数据网格控件基于从我们的数据库返回的 ID 值的链接，波浪号被写入页面。

这段代码：

```
HyperLinkColumn oLink = new HyperLinkColumn();
oLink.DataNavigateUrlField = "IdField";
oLink.DataNavigateUrlFormatString = "~/Here{0}.aspx"; 
```

正在将其转储到页面：

```
<a href="~/Here171201.aspx"> 
```

IIS 或 .NET Framework 版本之间的哪些变化可能导致此功能不再起作用？Tilde 肯定在 1.1 中解决了 - 我在我们组织的十几个 1.1 Framework 服务器上部署了完全相同的代码。不幸的是，设置 DataNavigateUrlFormatString 的类没有访问页面的权限，所以我必须做一些事情来插入 Page.ResolveUrl 工作...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T14:05:04.000

我不知道有什么变化，但我不使用 HyperLinkColumns（我更喜欢 Template 列提供的控件），所以我没有寻找任何变化。

作为众所周知的创可贴的一种可能性是改变这条线：

```
oLink.DataNavigateUrlFormatString = "~/Here{0}.aspx"; 
```

对此：

```
oLink.DataNavigateUrlFormatString = Page.ResolveUrl("~/Here{0}.aspx"); 
```

如果没记错的话，在转到母版页并使用用户控件中的“~”时会出现一些问题，但我已经有一段时间没有读到类似的东西了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T14:24:32.003

我不认为 Datagrid 的 HyperlinkColumn 会自动将 URL 解析为绝对路径。IIRC，该`DataNavigateUrlFormatString`属性仅在内部调用`String.Format()`提供的格式。您确定这在 .NET 1.1 上可以正常工作吗？IIRC，.NET 1.1 没有基于波浪号的自动 URL 解析。

在我看来，您应该使用 Stephen 提出的解决方案（`Page.ResolveUrl`手动调用。）

# linq - LINQ 冲突检测：设置 UpdateCheck 属性

> ID：685930
> 
> 赞同：3
> 
> 时间：2009-03-26T14:01:22.667
> 
> 标签：linq, .net-3.5, conflict, updatecheck

我最近一直在阅读 LINQ 以开始实现它，关于它如何生成困扰我的 UPDATE 查询有一件特别的事情。

使用 SQLMetal 或对象关系设计器自动创建实体代码，显然所有表的所有字段都将获得属性**UpdateCheck.Always**，这意味着对于每个 UPDATE 和 DELETE 查询，我将得到如下 SQL 语句：

```
UPDATE table SET a = 'a' WHERE a='x' AND b='x' ... AND z='x', ad infinitum 
```

现在，称我为纯粹主义者，但这对我来说似乎非常低效，而且无论如何感觉都是个坏主意，即使它不是低效的。我知道获取将由集群主键完成，所以这并不慢，但 SQL 仍然需要检查之后的每个字段以确保它匹配。

当然，在一些非常敏感的应用程序中，这样的东西可能很有用，但对于典型的 Web 应用程序（想想 Stack Overflow），似乎**UpdateCheck.WhenChanged**将是更合适的默认值，我个人更喜欢**UpdateCheck.Never**，因为LINQ 只会更新已更改的实际字段，而不是所有字段，并且在大多数实际情况下，无论如何，编辑某些内容的第二个人都会获胜。

这确实意味着，如果两个人设法在读取该行和触发 UPDATE 之间的一小段时间内编辑同一行的同一字段，那么将不会触发所发现的冲突。但实际上这是非常罕见的情况。当两个人更改相同的东西时，我们可能要提防的一件事不会被这个抓住，因为他们不会在完全相同的时间点击提交，所以在第二个 DataContext 时不会发生冲突读取并更新记录（除非在显示页面时 DataContext 保持打开状态并存储在 Session 中，或者其他一些非常糟糕的想法）。

但是，尽管这种情况很少见，但如果发生这种情况，我真的不想时不时地在我的代码中出现异常。

所以我的第一个问题是，我相信这个有错吗？（同样，对于“典型的”网络应用程序，而不是银行应用程序）我是否错过了为什么将 UpdateCheck.Always 作为默认设置是一个理智的想法的一些原因？

我的第二个问题是，我可以文明地改变这一点吗？有没有办法告诉 SQLMetal 或 ORD 设置哪个 UpdateCheck 属性？
我试图避免我必须记住运行一个工具的情况，我将不得不使用一些正则表达式并直接编辑文件中的所有属性，因为很明显，在某些时候我们会运行SQLMetal 在数据库更新后，我们不会运行这个工具，而且我们所有的代码都会以非常微妙的方式中断，我们在 dev 中测试时可能不会发现。

有什么建议么？
战争故事非常受欢迎，我很想从其他人的经验中学习。

非常感谢你！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T14:11:27.400

好吧，回答第一个问题 - 我同意你的看法。我不是这种“内置”乐观并发的忠实拥护者，特别是如果您有时间戳列或任何在更新发生后不能保证相同的字段。

为了解决第二个问题——我不知道有什么方法可以覆盖 SqlMetal 的默认方法（UpdateCheck = Always），我们最终编写了一个工具，为适当的列设置 UpdateCheck = Never。我们使用批处理文件来调用 SqlMetal，然后运行该工具）。

哦，虽然我想到了 - 发现 SqlMetal 还对关系进行建模以将外键设置为 null 而不是“在 Null 上删除”（特别是对于连接表），这也是一种享受。我们也必须使用相同的后期生成工具来适当地设置这些。

# javascript - FlexiGrid - 在代码中设置网格的宽度

> ID：685931
> 
> 赞同：2
> 
> 时间：2009-03-26T14:01:32.290
> 
> 标签：javascript, jquery, flexigrid

我正在为一个新应用程序尝试[Flexigrid](http://code.google.com/p/flexigrid/) - 我对它印象深刻，但我找不到在代码中设置宽度的方法。

这样做的主要原因是让 GRID（而不是网格内的列）与窗口大小完全对齐。我知道，这对水平调整大小是一种嘲弄，但这就是我必须做的！

仅供参考，我的设置如下：

```
$(document).ready(function() {
    $("#flex1").flexigrid
    (
    {
        url: '<%= ResolveUrl("~/Data.ashx") %>?filter=none',
        dataType: 'json',
        colModel: [
        { display: '', name: 'view', width: 20, sortable: true, align: 'center' },
        { display: 'Street', name: 'Street', width: 260, sortable: true, align: 'left' },
        { display: 'Town', name: 'Town', width: 200, sortable: true, align: 'left' },
        { display: '', name:'Actions', width:30, sortable: false, align: 'center' }
        ],
        sortname: "Street",
        sortorder: "asc",
        usepager: true,
        title: 'Streets',
        useRp: true,
        rp: 15,
        showTableToggleBtn: false,
        width: 800,
        height: 200
    }
    );
}); 
```

但以下功能不起作用：

```
function ResizeGrid() {
    $('#flex1').flexOptions({ width:1000 }).flexReload();
} 
```

它会导致网格刷新，但仅此而已。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-26T14:06:23.340

尽管在发布此之前大约 20 分钟在谷歌上没有运气，墨菲定律意味着我在之后尝试了另一个快速搜索并找到了答案。

原来“宽度”应该设置为“自动”（注意引号很重要）。

```
$("#flex1").flexigrid
(
{
    url: '<%= ResolveUrl("~/Data.ashx") %>?filter=none',
    dataType: 'json',
    colModel: [
    { display: '', name: 'view', width: 20, sortable: true, align: 'center' },
    { display: 'Street', name: 'Street', width: 260, sortable: true, align: 'left' },
    { display: 'Town', name: 'Town', width: 200, sortable: true, align: 'left' },
    { display: '', name:'Actions', width:30, sortable: false, align: 'center' }
    ],
    sortname: "Street",
    sortorder: "asc",
    usepager: true,
    title: 'Streets',
    useRp: true,
    rp: 15,
    showTableToggleBtn: false,
    width: 'auto',
    height: 200
}
); 
```

我会把这篇文章留给其他有这个问题的人。

# c# - C# 是否清理 C++ 分配的内存？

> ID：685934
> 
> 赞同：9
> 
> 时间：2009-03-26T14:01:54.473
> 
> 标签：c#, c++, com, interop

我有一个带有以下签名的假设 COM 对象

```
void MemAlloc(ref double[] test, int membercount) 
```

其中内存是在 C++ 中使用 new/malloc 分配的。一旦这是在 C# 中，使用 RCW，我如何确保正确释放内存？我认为 .NET 很难释放，考虑到在 C++ 中，您需要知道它是否分配有 new/malloc/mm_malloc，然后才能正确释放它。那么，清理我的 C++ 分配数组的合适方法是什么？谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-26T14:06:40.017

我相信您应该将 CoTaskMemAlloc() 用于要从托管端显式释放的内存。一旦内存不再可访问，CLR 将负责释放内存。如果你想明确地释放它，你可以使用托管 Marshal.CoTaskFree() 例程。

一般来说，interop marshaler 和 CLR 遵守 COM 释放内存的约定；接收者负责释放内存。因此，如果内存返回给托管调用者，CLR/Interop 封送拆收器通常会负责释放在本机调用中分配的内存。

来自[Interop Marshaler](https://msdn.microsoft.com/en-us/library/zah6xy75.aspx) (msdn) 的内存管理：

> 互操作封送拆收器始终尝试释放由非托管代码分配的内存。此行为符合 COM 内存管理规则，但不同于管理本机 C++ 的规则。
> 
> 如果您在使用平台调用时预期本机 C++ 行为（无内存释放），则会出现混淆，这会自动为指针释放内存。例如，从 C++ DLL 调用以下非托管方法不会自动释放任何内存。
> 
> 运行时总是使用 CoTaskMemFree 方法来释放内存。如果您正在使用的内存不是通过 CoTaskMemAlloc 方法分配的，您必须使用 IntPtr 并使用适当的方法手动释放内存。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-26T14:05:41.923

将它包装在实现 IDisposable 的对象中，并确保 C# 包装器被释放。

[这是我写](http://www.atalasoft.com/cs/blogs/stevehawley/archive/2006/09/21/10887.aspx)的关于实现 IDisposable 的简单方法的博客。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T15:43:19.163

[.NET 2.0 Interoperbility Recipes](http://books.google.com/books?id=ZDin4axsYoEC&pg=PA61&lpg=PA61&dq=free+unmanaged+memory+from+C%23+new+malloc&source=bl&ots=x45dBdMwW_&sig=tcGP8xicG9EtDdIHKTbCrjq4_2Y&hl=en&ei=WKDLSZSeCoHwsAPRl9GqCg&sa=X&oi=book_result&resnum=9&ct=result#PPA62,M1)这本书看起来很方便。它似乎同意 Arnshea 关于 CoTaskMemFree 的说法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T14:15:24.083

我几乎 100% 确定 CLR 不会自动释放分配给测试的内存（如果是 PInvoke，我会 100% 确定）。原因是，CLR 是如何首先知道您用于分配内存的？即它没有。

编写此函数的更安全的方法如下

```
void MemAlloc(ref IntPtr arrayPtr, int membercount) 
```

接到回电后，您可以执行以下操作。

```
var count = GetTheCount();
var arrayPtr = IntPtr.Zero;
obj.MemAlloc(ref arrayPtr, count);
byte[] test = MarshalThePtrToByteArray(arrayPtr, count);
Marshal.FreeCoTaskMem(arrayPtr); 
```

这是 MarashalThePtrToByteArray 的快速而肮脏的实现

```
byte[] MarashalThePtrToByteArray(IntPtr ptr, int count) {
  byte[] arr = new byte[count];
  for ( int i = 0; i < count; i++ ) {
    arr[i] = (byte)Marshal.PtrToStructure(ptr, typeof(byte));
    ptr = new IntPtr(IntPtr.ToInt64() + Marshal.SizeOf(typeof(byte)));
  }
  return arr;
} 
```

# php - 重新启动浏览器时会话不存在

> ID：685937
> 
> 赞同：0
> 
> 时间：2009-03-26T14:02:59.167
> 
> 标签：php, cookies

我登录我的系统并以这种方式设置 cookie：

```
setcookie("hello",true,time()+3600); 
```

然后我查看 Firefox 的 cookie 管理器，发现我的 cookie 已设置。

当我重新启动浏览器并重新启动时，我在 cookie 管理器中看到 cookie 就在那里，但是这段代码：

```
if(isset($_COOKIE['hello'])){

            echo "yes"; exit;} 
```

我没有看到任何将我重定向到登录表单的内容。有谁知道发生了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T14:11:48.100

虽然一个普通的 cookie，比如你的 'hello' cookie，在浏览器重启后仍然可以保存，而会话 cookie 则不会。

听起来您正在使用会话 cookie 进行登录，因此当您在重新启动后点击该页面时，您需要再次登录。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T14:12:20.237

一些事情要尝试：

1.  显式将 的`path`属性设置为`setcookie`，`/`以便 cookie 在整个域中可用。
2.  不要检查 isset，而是尝试在一个空的 PHP 文件中执行 a `print_r`of 。`$_COOKIE`
3.  的`value`部分`setcookie`需要一个字符串，而不是布尔值。我想现在`hello`它被设置为`1`，尽管这对于它是否在重新启动中幸存下来并不重要，或者我只是认为我会指出它。
4.  您是否将浏览器设置为在退出时删除 cookie？例如，在 Firefox 中，您可以转到工具 -> 选项 -> 隐私，并且有一个选项显示“退出 Firefox 时始终清除我的私人数据”。如果您设置了此设置，则您拥有的任何 cookie 将在您关闭浏览器时被删除。
5.  您是否在重新启动*之前*检查了从 PHP 对 cookie 的访问？你说在 Cookie Manager 前后都可以看到，但是在 PHP 中前后能看到吗？

# tfs - TFS 提供的默认构建质量是什么意思？

> ID：685940
> 
> 赞同：2
> 
> 时间：2009-03-26T14:04:40.707
> 
> 标签：tfs, default

有一组默认的构建质量：

*   初步测试通过
*   实验室测试通过
*   准备部署
*   准备好进行初始测试
*   被拒绝
*   发布
*   UAT 通过
*   在调查中

我不太确定每个条目的含义。我缺乏这方面的经验（另外，我不是母语人士）。在某处是否有对这些值的解释？我也对相关资源感兴趣，请随时添加链接。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T15:10:59.270

这些是 TFS 提供的默认构建质量。除非您的组织的发布过程包含与这些品质相对应的步骤，否则它们可能对您没有任何意义。

可能有帮助的资源：

*   [如何：设置构建质量](http://msdn.microsoft.com/en-us/library/ms181734(VS.80).aspx)
*   [如何：创建构建质量状态](http://msdn.microsoft.com/en-us/library/ms181735(VS.80).aspx)
*   [了解 Team Foundation 构建浏览器](http://msdn.microsoft.com/en-us/library/ms181730(VS.80).aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T15:34:02.430

这些只是构建系统中的字符串，因此请随意删除它们并添加对您的团队更有用的新字符串。

正如[Ryan 所说](https://stackoverflow.com/questions/685940/what-is-the-meaning-of-the-default-build-qualities-provided-by-tfs/686197#686197)，以下链接中对默认值给出了一些简短的描述：

[http://msdn.microsoft.com/en-us/library/ms181734(VS.80).aspx](http://msdn.microsoft.com/en-us/library/ms181734(VS.80).aspx)

# windows - 保存和恢复应用程序窗口状态

> ID：685948
> 
> 赞同：3
> 
> 时间：2009-03-26T14:06:42.373
> 
> 标签：windows, windows-xp, development-environment, session

我在编程时有很多会话状态——shell 窗口、ide、虚拟机、Web 浏览器。当会话结束时，即注销或重新启动时，这一切都会丢失。

有没有办法在 MS Windows XP 上保存桌面状态并在以后恢复？理想情况下，该解决方案将允许保存多个会话并允许恢复任何一个会话。

我不是要求保留应用程序状态（尽管那会很好）——只是应用程序正在运行以及它的窗口在哪里的事实。这在大多数 X-Windows 系统中是微不足道的，但我找不到在 MS Windows 上执行此操作的方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-17T20:43:04.263

有一个应用程序可以做到这一点 - [Twinsplay](http://www.twinsplay.com)。它可以保存和加载多个窗口会话。

它还为您提供“分屏”功能。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T14:17:09.930

简单的方法是休眠而不是注销/关闭 Windows。这会将整个 Windows 会话保存到磁盘上，一旦再次打开机器，您就可以继续工作。

您也可以使用[远程桌面连接](http://en.wikipedia.org/wiki/Remote_Desktop_Services#Remote_Desktop_Connection)。它具有多会话支持模式，可以将这些会话保存在内存中（但如果重新启动机器，它们会丢失）。

我不知道 Windows ifself 提供了任何其他选项 - 也许有提供此功能的第三方软件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T14:59:48.890

看看[Microsoft 的 Virtual Desktop Manager](http://www.microsoft.com/windowsxp/Downloads/powertoys/Xppowertoys.mspx)。

它管理多达四个不同的桌面，如果计算机处于[休眠状态](http://www.microsoft.com/windowsxp/using/setup/learnmore/tips/magyar1.mspx)，所有信息都会保留。

你可以在[这里](http://www.microsoft.com/windowsxp/Downloads/powertoys/Xppowertoys.mspx)找到它。

# c++ - 如何检查客户端是否通过 C++ 中的 Winsock 断开连接？

> ID：685951
> 
> 赞同：15
> 
> 时间：2009-03-26T14:07:56.877
> 
> 标签：c++, winsock

如何检查客户端是否通过 C++ 中的 Winsock 断开连接？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-26T14:16:01.943

[Beej 的网络编程指南](http://beej.us/guide/bgnet/)

如果您在阻塞模式下调用 recv 并返回读取 0 字节，则套接字已断开连接，否则它等待接收字节。

查看此[常见问题解答 2.12](http://tangentsoft.net/wskfaq/newbie.html)

[此](http://www.codeguru.com/forum/archive/index.php/t-363683.html)页面上的选择示例。

```
int nRet;

if(( nRet = select( 0, &fdread, NULL, NULL, NULL )) == SOCKET_ERROR )
{
    // Error condition
    // Check WSAGetLastError
}

if( nRet > 0 )
{
    // select() will return value 1 because i m using only one socket
    // At this point, it should be checked whether the
    // socket is part of a set.

    if( FD_ISSET( s, &fdread ))
    {
        // A read event has occurred on socket s
    }
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-26T14:17:37.150

您只能通过尝试发送数据来判断 TCP 套接字是否“断开连接”。这是因为协议的设计使得它应该允许对等点之间的临时中断。因此，如果您从 A 通过 R1 通过 R2 通过 R3 连接到 B 并发送数据一段时间然后停止发送，您可以拔下 R2-> R3（例如）并且 A 和 B 都不会注意到（或关心）。如果您随后插入 R2->R4 和 R4->R3，然后尝试在 A 和 B 之间发送数据，那么事情将“正常工作”，而您永远不会知道。但是，如果您尝试在 R2->R3 断开连接时发送数据，那么您（最终，在所有 TCP 级别重试之后）会收到错误消息。

现在，某些操作系统可能会提醒您您的本地网络适配器当前未连接，您可以使用它来表示“我不再连接到我的对等设备”，但我不建议这样做。

如果让您的对等方知道连接何时“断开”很重要，那么要么使用应用程序级别的“ping”消息偶尔在对等方之间发送数据，要么使用 TCP 保持连接。就我个人而言，我会去 ping 消息...

**编辑：**当然，所有这些都假设您想知道您是否仍然可以在连接上发送数据，毕竟，当客户端不再发送时您会被告知，因为您的读取将返回 0 字节并且您知道它何时断开连接它的发送方，因为您的写入将失败；您还知道何时关闭您自己的连接端的发送或接收端......

我想我应该坚持“定义断开连接”的初始直觉反应；）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T14:22:21.883

有几种不同的方法，但最常见的是检查发送或接收命令的结果：

```
 nReadBytes = recv(sd, ReadBuffer, BufferSize, 0);
 if (nReadBytes == SOCKET_ERROR)
 {
     //error
 }
 nSendBytes = send(sd, WriteBuffer, BufferSize, 0);
 if (nSendBytes == SOCKET_ERROR)
 {
     //error
 } 
```

更多示例（包括客户端和服务器的错误检查）：

[http://tangentsoft.net/wskfaq/examples/basics/](http://tangentsoft.net/wskfaq/examples/basics/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-11-26T20:22:39.607

如果 send() 或 recv() 的结果是 SOCKET_ERROR 并且 WSAGetLastError() 返回 WSAECONNRESET 客户端已断开连接。
来自 MSDN：

> WSAECONNRESET
> 
> 对等方重置连接。
> 
> 现有连接被远程主机强行关闭。如果远程主机上的对等应用程序突然停止，主机重新启动，主机或远程网络接口被禁用，或者远程主机使用硬关闭，这通常会导致（有关远程主机上 SO_LINGER 选项的更多信息，请参阅 setsockopt插座）。如果在一个或多个操作正在进行时，由于保活活动检测到故障而导致连接中断，则也可能导致此错误。正在进行的操作因 WSAENETRESET 而失败。后续操作因 WSAECONNRESET 而失败。

这也适用于非阻塞套接字。

```
int r = recv(sock, NULL, 0, 0);
if(r == SOCKET_ERROR && WSAGetLastError() == WSAECONNRESET){
    //client has disconnected!
} 
```

# c# - 循环最佳实践

> ID：685953
> 
> 赞同：1
> 
> 时间：2009-03-26T14:08:30.667
> 
> 标签：c#, break, continue

我有一个非常大的循环，可以循环 1000 行。如果找到魔法值 1，我将退出循环。如果没有找到魔法值 1 但找到了魔法值 2，则循环需要跳到开头。现在我正在使用一个开关，一些ifs和一个goto。我读过 goto 不是最好的方法。有没有更好的方法来完成这项工作？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-26T14:10:44.547

要退出循环，您可以使用[break](http://msdn.microsoft.com/en-us/library/adbctzc4(VS.80).aspx)语句，要进入下一条记录，您可以使用[continue](http://msdn.microsoft.com/en-us/library/923ahwt1(VS.80).aspx)语句。

```
for(int i = 0; i < 1000; i++)
{
    if(magicValue1)
       break;
    if(magicValue2)
       continue;
} 
```

**我不宽恕使用 GOTO 语句我只是指出一个可能的用例**

您可以使用**goto jump 语句来启动/退出循环，但是除非您使用****嵌套循环**，否则我会远离此选项。我认为 goto 语句仍然可以用于优化、干净退出等。但总的来说，最好谨慎使用**它**。

```
for(int i = 0; i < 100; i++)
{ 
  start:

  for(int i = 0; i < 10; i++)
  {
     if(magicValue1)
       goto end;
    if(magicValue2)
       goto start;
  }
}
end : 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-26T14:11:45.573

这个怎么样：

```
for(int i = 0; i < 1000; i++) {
    if(values[i] == MAGIC_VALUE_1) {
        break;
    } else if(values[i] == MAGIC_VALUE_2) {
        i = 0;
    }
} 
```

如果“跳到开头”是指“跳过这条记录并处理下一条”，请替换`i = 0`为`continue`.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-26T14:21:02.167

没有的`while`变体`break`：

```
bool continue = true; int i = 0;
while (i < 1000 && continue){
    if(values[i] == MAGIC_VALUE_1) {
        continue=false;
    } else if(values[i] == MAGIC_VALUE_2) {
        i = 0;
    }
    i++;
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-26T14:48:52.163

我还不能发表评论（1个代表点）

但这不是更好吗：

```
for (int i = 0; i < 1000; i++)
{
    if (magicValue1)
    {
       break;
    }
    else if (magicValue2)
    {
       dosomething();
       i=0;
    }
} 
```

而且我不确定“重新开始搜索”是什么意思。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-26T14:28:56.577

我用#2 的情况表示你不想在#2 的情况下执行（即跳过）循环体，而不是你想将循环重置为 0。（如果我有，请参阅代码注释落后。）

这个建议可能会引起争议，因为 for 循环中不太常规的条件可以说在自我记录规模上很低，但如果这不打扰你，我认为你想要的一种简洁的写法是：

```
 for (int i= 0; i<values.Length && values[i]!= MAGIC_1; i++)
        {
            if (values[i] == MAGIC_2)
            {
                // Don't do the loop body for this case but continue on looping
                continue;
                // If you want to reset the loop to zero instead of skip the 2 case,
                // comment-out the continue; and un-comment the line below:
                // i=0;
            }
            // Do long loop body here
        } 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-26T15:29:03.503

请注意，如果在 MagicValue 为 2 时将计数器设置回 0，并且您的代码从不更改值，则您可能会处于无限循环中。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-26T17:03:35.273

更复杂的可能是：

我们定义了 2 种扩展方法。

```
public static class Extensions
{
   public static bool isMagic_1(this int i)
   {
         return i == 1;
   }

   public static bool isMagic_2(this int i)
   {
         return i == 2;
   }
} 
```

现在你可以这样做：

```
 for(int i = 0; i < 1000; i++)
  {
     if(i.isMagic_1())
       break;
     if(i.isMagic_2())
       continue;
  } 
```

希望这可以帮助！

# c# - .Net 数值类型初始化标识符列表

> ID：685962
> 
> 赞同：6
> 
> 时间：2009-03-26T14:11:30.940
> 
> 标签：c#, .net, vb.net

我正在寻找 C# 和 VB.Net 的列表数字类型初始化标识符。

例如：

```
Dim x = 1D 'Decimal'
Dim y = 1.0 'initializes to float' 
```

这是列表：

标识符不区分大小写

**VB.Net**

```
Int32 = 1，我
双倍 = 1.0, R, 1.0e5
小数 = D
单 = F, !
Int16 = S
UInt64 = L, UL

```

**C＃**

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-26T14:17:53.080

## C＃

[C# 规范的第 1.8 节](http://msdn.microsoft.com/en-us/library/aa664812(VS.71).aspx)包括这些值。

> 整数类型后缀：U u L l UL Ul uL ul LU Lu lU lu 之一
> 
> 实型后缀：F f D d M m 之一

[第 2.4.4.2 节](http://msdn.microsoft.com/en-us/library/aa664674(VS.71).aspx)对整数类型进行了详细说明：

> 整数文字的类型确定如下：
> 
> *   如果字面量没有后缀，则它具有可以表示其值的第一种类型：int、uint、long、ulong。
> *   如果文字以 U 或 u 为后缀，则它具有可以表示其值的第一种类型：uint、ulong。
> *   如果文字以 L 或 l 为后缀，则它具有可以表示其值的第一种类型：long、ulong。
> *   如果文字以 UL、Ul、uL、ul、LU、Lu、lU 或 lu 为后缀，则为 ulong 类型。

[第 2.4.4.3 节](http://msdn.microsoft.com/en-us/library/aa691085(VS.71).aspx)对 Real 类型进行了详细说明：

> 如果未指定实数类型后缀，则实数字面量的类型为 double。否则，实数类型后缀决定实数字面量的类型，如下：
> 
> *   以 F 或 f 为后缀的实数是 float 类型。例如，文字 1f、1.5f、1e10f 和 123.456F 都是 float 类型。
> *   以 D 或 d 为后缀的实数是 double 类型。例如，文字 1d、1.5d、1e10d 和 123.456D 都是 double 类型。
> *   以 M 或 m 为后缀的实数是十进制类型。例如，文字 1m、1.5m、1e10m 和 123.456M 都是十进制类型。该文字通过取精确值转换为十进制值，并在必要时使用银行四舍五入四舍五入到最接近的可表示值（第 4.1.7 节）。除非值被四舍五入或值为零（在后一种情况下，符号和比例将为 0），否则文字中明显的任何比例都会被保留。因此，文字 2.900m 将被解析为符号 0、系数 2900 和小数位数 3 的小数。

## VB

同样，VB 规范包含[整数](http://msdn.microsoft.com/en-us/library/aa711649(VS.71).aspx)和[浮点](http://msdn.microsoft.com/en-us/library/aa711650(VS.71).aspx)文字的详细信息。

对于整数：

> ShortCharacter ::= S IntegerCharacter ::
> = I
> LongCharacter ::= L

对于浮点数：

> SingleCharacter ::= F DoubleCharacter ::
> = R
> DecimalCharacter ::= D

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T14:27:02.747

就个人而言，我并不总是使用标识符，这正是这里提出的原因（记忆）。C# 编译器的一个有趣特性是它实际上将以下内容编译为相同的内容：

```
static void Foo()
{
    var x = 100F;
    Console.WriteLine(x);
}
static void Bar()
{
    var x = (float)100; // compiled as "ldc.r4 100" - **not** a cast
    Console.WriteLine(x);
} 
```

我发现第二个版本更具可读性。所以我使用这种方法。AFAIK 唯一一次它做任何不同的事情是使用带有尾随零的小数 - 即

```
static void Foo()
{
    var x = 100.00M;
    Console.WriteLine(x);
}
static void Bar()
{
    var x = (decimal)100.00; // compiled as 100M - extended .00 precision lost
    Console.WriteLine(x);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T14:24:05.297

在VB中你应该有

选项严格开启

```
Dim x as Decimal = 1D 'Decimal'
Dim y as Double = 1.0 'initializes to double'
Dim z as Integer = 1 'integer 
```

# html - 这是一个错误吗？P 元素的边距超出了包含 div

> ID：685967
> 
> 赞同：3
> 
> 时间：2009-03-26T14:12:39.863
> 
> 标签：html, css, firefox

我在 Ubuntu 上使用 Firefox3（我在 SO 中发现了一个错误：-D）预期的行为是看不到 DIV 之间的任何边距，而显示了一个边距，源自 P 边距。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
   <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
   <style>
        p{
            background-color: transparent;
            margin: 10px;
            color: white;
        }
        div{
            background-color: black;
            margin:0;
            width: 300px;
        }
   </style>
</head>
<body>
   <div>
        <p>aaaaaaaaaaa</p>
        <p>bbbbbbbbbbb</p>
        <p>ccccccccccc</p>
   </div> 
   <div>
        <p>aaaaaaaaaaa</p>
        <p>bbbbbbbbbbb</p>
        <p>ccccccccccc</p>
   </div> 
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-26T14:25:07.587

这是在 CSS 盒子模型中定义的行为：

> **8.3.1 折叠边距**
> 
> 在本说明书中，表达折叠边距意味着两个或多个框（可能彼此相邻或嵌套）的相邻边距（没有填充或边框区域将它们分开）组合形成单个边距。
> 
> 在 CSS2 中，水平边距永远不会塌陷。
> 
> 某些框之间的垂直边距可能会折叠：
> 
> *   正常流程中两个或多个相邻的块框垂直边距折叠。生成的边距宽度是相邻边距宽度的最大值。在负边距的情况下，从正相邻边距的最大值​​中减去负相邻边距的绝对最大值。如果没有正边距，则从零中减去负相邻边距的绝对最大值。
> *   浮动框和任何其他框之间的垂直边距不会折叠。
> *   绝对和相对定位框的边距不会塌陷。

[http://www.w3.org/TR/CSS2/box.html](http://www.w3.org/TR/CSS2/box.html)

这背后的基本原理可能是，如果您在某物上设置（垂直）边距，您只想确保在该元素的边框或填充与下一个元素的边框或填充之间至少留有这么多空间（例如两段）。

如果希望div 中包含边距（即让div 展开），则需要在div 的顶部和底部设置一些填充或边框。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T14:24:53.967

我刚刚在 Windows 上使用 FF 进行了检查，并且 p 元素按应有的方式包含在内，而不是在 div 之外。它在 IE7 上看起来也不错。

尝试在所有元素上设置边框，看看会发生什么。

抱歉，我无法提供更多帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T14:34:52.850

正如[Simon Lehmann 所写](https://stackoverflow.com/questions/685967/is-it-a-bug-margins-of-p-element-go-outside-the-containig-div/686015#686015)，这是正确的行为。看起来您正在寻找的是`p{padding:100px;}`.

# asp.net - 确定 ASP.NET 站点的“活动”用户计数

> ID：685968
> 
> 赞同：5
> 
> 时间：2009-03-26T14:12:57.473
> 
> 标签：asp.net, statistics, web-traffic

在 ASP.NET 站点上，有哪些技术可用于跟踪在任何给定时间点登录到站点的用户数量？

因此，例如，我可以生成一个显示如下内容的报告：

```
 10:00am  11:00am  12:00pm  1:00pm  2:00pm ....
 3/25      25      32       45      40      37
 3/26      31      38       50      57      40
 3/27      28      37       46      35      20
 etc. 
```

编辑：不，我们没有使用 ASP.NET 成员资格提供程序，它使用基于本地/hacky 会话的方法来确定用户是否处于“登录”状态。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-26T14:24:48.553

网站是否让用户登录？如果是这样，那么您可以在每次用户请求新页面时更新用户表中的“上次访问”字段，然后每隔一小时，只需执行一个 SQL 查询，该查询会获取在最后一次访问中具有“上次访问”时间戳的每个人15 分钟左右（假设当前在站点上）。

如果你没有人登录，你可以很容易地通过 IP 地址而不是用户名来登录。但是，使用这种方法，您可能会遇到一些代理问题（即，来自同一公司网络的多个用户可能都来自一个 IP 地址，因此在您的总数中他们只计为一个用户），但这应该是最小的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T14:23:37.747

这种类型取决于您的网站。如果您使用 ASP.Net Membership Providers 有一个方法：`Membership.GetNumberOfUsersOnline()`它可以告诉您有多少登录用户。我相信也有性能计数器。登录用户的概念是在过去 x 分钟内做了某事的用户，其中 x 是可配置的。

如果您想了解有多少活动，您还可以使用性能计数器来跟踪传入的请求。

# 编辑

就像您知道 SQL ASP Membership 提供程序通过在数据库中的字段上记录活动日期来实现这一点一样。它只是在 x 分钟内查询所有活动。

我添加了一个客户端轮询功能，它每 2 分钟访问一次我们的服务器，因此当用户坐在页面上时，即使没有活动，我也知道他们在那里。这也让我强制用户退出系统，提供了传递其他系统消息的方法。不错。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-12-16T20:55:17.133

在 Global.asax

```
protected void Application_Start(object sender, EventArgs e)
        {
            Application["SessionCount"] = 0;
        }

        protected void Session_Start(object sender, EventArgs e)
        {
            Application.Lock();
            Application["SessionCount"] = Convert.ToInt32(Application["SessionCount"]) + 1;
            Application.UnLock();
        }

        protected void Session_End(object sender, EventArgs e)
        {
            Application.Lock();
            Application["SessionCount"] = Convert.ToInt32(Application["SessionCount"]) - 1;
            Application.UnLock();
        } 
```

在你想要的页面上获取 Application["SessionCount"]

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-05-27T13:59:48.670

如果使用 SQL Server 进行会话存储（即`<sessionState>`web.config 中的模式为“SQLServer”），则不能使用依赖`Session_End`于**global.asax**的解决方案，因为该方法永远不会被调用。

但是，假设**SQL 代理**正在正确运行**DeleteExpiredSessions**作业（安装 SQL 状态时它应该是默认的），您可以对 Session Db 运行以下 SQL：

```
SELECT COUNT(SessionId) FROM ASPStateTempSessions 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-26T15:20:10.827

我认为我过去使用的是 Global.asax 函数，主要以 Session_Start 和 Session_End 为中心，随着开始增加计数，然后由于会话超时而结束有点棘手。如果您不太关心计数的准确性，那么您可以在这里停下来。

如果不是，那么您可能会结合使用 javascript onUnload 事件和某种 ajax 请求来使会话无效并减去用户。该事件必须查看用户是实际离开该页面还是只是转到站点上的另一个页面。

无论如何，从那里开始。我记得与 ASP 站点有关，因此肯定有一些关于此方法的信息。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-26T15:30:19.427

ASP.NET 性能对象中有*活动会话的***性能监视器**统计信息，您可以跟踪所有实例或单个应用程序。**您可以通过Admin Tools** → **Performance**或以编程方式通过**WMI**访问这些统计信息。

 *******一个非常基本的 PowerShell 脚本，用于获取此类计数器的总数：

```
(Get-WmiObject Win32_PerfRawData_ASPNET_ASPNETApplications SessionsActive).SessionsActive 
```

过滤器应该能够获取特定站点的统计信息。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-26T18:15:18.533

首先将会话超时设置为 1 分钟。

创建一个没有 HTML 内容的简单 heartbeat.aspx 页面，只需以下 javascript 代码：

```
<html>
  <head>
  <script language="javascript">
  function reloadPage()
  {
    window.navigate("heartbeat.aspx");
  }
  </script>
  </head>
<body onload="window. setTimeout(‘reloadPage()’, 30000)">
</body>
</html> 
```

这将每 30 秒重新请求一次并保持会话处于活动状态。

将 heatbeat.aspx 页面放在一个隐藏的框架中。

要获取用户计数，只需使用 Global.asax 中的 Session_Start 和 Session_End 事件中的静态计数器来获取会话计数。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-26T18:22:18.827

如果您使用 InProc 会话状态，您可以在 global.asax 中这样做

```
Sub Application_Start(ByVal sender As Object, ByVal e As EventArgs)
    Application("ActiveSessionCount") = 0
End Sub

Sub Session_Start(ByVal sender As Object, ByVal e As EventArgs)
    Application("ActiveSessionCount") += 1
End Sub

Sub Session_End(ByVal sender As Object, ByVal e As EventArgs)
    Application("ActiveSessionCount") -= 1
End Sub 
```

访问 Web 表单上的值同样简单

```
Dim Count as Integer = Application("ActiveSessionCount") 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-11-26T19:41:58.230

```
public class ActiveUsers
{
    private static List<LastUserActivity> users;
    private static object syncroot = new object();
    private static DateTime lastPruned;

    public static int SessionLength = 20;

    static ActiveUsers()
    {
        users = new List<LastUserActivity>();
        lastPruned = DateTime.UtcNow;
    }

    public void RecordUserActivity(int userId)
    {
        lock (syncroot)
        {
            var user = users.FirstOrDefault(x => x.UserId == userId);
            if (user == null)
            {
                user = new LastUserActivity() { UserId = userId };
                users.Add(user);
            }
            user.UtcTime = DateTime.UtcNow;

            if (lastPruned.AddMinutes(5) < DateTime.UtcNow)
            {
                Prune();
                lastPruned = DateTime.UtcNow;
            }
        }
    }

    private static void Prune()
    {
        users.RemoveAll(x => x.UtcTime.AddMinutes(SessionLength) < DateTime.UtcNow);
    }

    public int GetActiveUsers()
    {
        return users.Count;
    }
}
public class LastUserActivity
{
    public int UserId { get; set; }
    public DateTime UtcTime { get; set; }
} 
```

`ActiveUsers`在`global.asax`（例如，BeginRequest、AcquireRequestState）中添加对方法的调用。

# asp.net-mvc - 使用同一个 ASP.NET MVC 应用托管多个域？

> ID：685973
> 
> 赞同：6
> 
> 时间：2009-03-26T14:14:13.790
> 
> 标签：asp.net-mvc, shared-hosting, multiple-domains

我想用同一个 ASP.NET MVC 应用程序托管多个网站（都具有不同的域 - 不是子域）。我需要应用程序根据域采取不同的行动，但我仍然希望同一个应用程序为所有域提供服务。我不想要域转发或重定向，我实际上希望所有域都能够自行运行，但由同一个 MVC 应用程序提供服务。我该怎么做呢？还值得注意的是，我与 GoDaddy 共享托管。

提前致谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T14:30:32.753

这应该可以通过 IIS 使用绑定设置中的主机头字段来实现。您可以为应用程序添加任意数量的不同主机头。只要该域以某种方式进入该特定端口（http 或 https 或自定义）上的该主机，就会使用该应用程序。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-06-09T04:46:29.740

[ASP.NET MVC 域路由](http://blog.maartenballiauw.be/post/2009/05/20/ASPNET-MVC-Domain-Routing.aspx)演示了一种基于用于访问您的站点的域名来控制 ASP.Net MVC 应用程序行为的可能方法。

# c# - 在 C# 中关闭 ftp 流时出错

> ID：685976
> 
> 赞同：1
> 
> 时间：2009-03-26T14:15:05.863
> 
> 标签：c#, ftp

我正在尝试取消下载操作。我的情况如下：

当用户单击取消下载按钮时，此操作会在下载函数中引发异常，如下所示：

```
 try
        {
            reqFTP = (FtpWebRequest)FtpWebRequest.Create(new Uri("ftp://" + uri + "/" + fileName));
            reqFTP.Method = WebRequestMethods.Ftp.DownloadFile;
            reqFTP.UseBinary = true;
            reqFTP.Credentials = new NetworkCredential(ftpUserID, ftpPassword);
            reqFTP.UsePassive = true;

            response = (FtpWebResponse)reqFTP.GetResponse();
            ftpStream = response.GetResponseStream();
            _isItOutputStream = true;
            string dataLengthString = response.Headers["Content-Length"];
            int dataLength = 0;
            if (dataLengthString != null)
            {
                dataLength = Convert.ToInt32(dataLengthString);
            }

            long cl = response.ContentLength;
            int bufferSize = 4048;
            int readCount;
            byte[] buffer = new byte[bufferSize];
            readCount = ftpStream.Read(buffer, 0, bufferSize);
            outputStream = new FileStream(filePath + "\\" + fileName, FileMode.Create);
            bool first = true;
            while (readCount > 0)
            {
                outputStream.Write(buffer, 0, readCount);
                _actualDownloaded += readCount;
                if (this.InvokeRequired)
                {
                    ProgressBarDel _progressDel = new ProgressBarDel(ProgressBar);
                    this.Invoke(_progressDel, new object[] { _actualDownloaded, first });
                }
                first = false;
                readCount = ftpStream.Read(buffer, 0, bufferSize);
            }
            ftpStream.Close();
            outputStream.Close();
            response.Close();
            _isItOutputStream = false;
            return true;
        }
        catch (Exception ee)
        {
            _downloadException = ee.Message;
            if (response != null)
            {

                outputStream.Close();
                ftpStream.Close();
                response.Close();
            }
            return false;
        } 
```

在`ftpStream.Close()`抛出异常的“”行中...

异常文本是：

> 远程服务器返回错误：（450）文件不可用（例如，文件忙）

它在哪里打开一个文件以下载我写的“ `outputStream = new FileStream(filePath + "\\" + fileName, FileMode.Create);`”如果用户执行以下操作，我不会关闭此流并按顺序关闭响应：下载->取消下载->下载->取消下载->下载

如果发生这种情况，应用程序将挂起。我不知道如何关闭流和响应，所以我可以停止下载然后删除创建的文件以便再次下载。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T14:30:14.610

似乎导致您执行的行是下面的行，这是由于 FTP 服务器找不到您想要的文件。这种情况很容易再次发生，因此可能值得在该单独的行周围放置一个 try/catch 块，或者在它生成的特定异常上使用 catch。

```
ftpStream = response.GetResponseStream(); 
```

目前在您的 catch 块中，您正在使用 outputStream.Close() 但如果上面的行发生异常，则 outputStream 将为空。至少您应该更改在 catch 块中关闭对象的顺序并检查它们是否为空。

```
if(response != null) {
    response.Close();
}

if(ftpStream != null) {
    ftpStream.Close();
}

if(outputStream != null) {
    outputStream.Close();
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T14:31:22.750

好的，首先，将您的关闭放在 finally 块中。

因此，请确保您的代码是这样的，以确保流无论如何都会关闭。

```
try
{
   //Your existing logic
   //Don't need to close the streams/etc
}
catch
{
   //Just do what you need to with the exception
}
finally
{
   //This is always called
   if (response != null)
      response.Close();
   if(outputStream != null)
      outputStream.Close();
   if(ftpStream != null)
      ftpStream.Close();
} 
```

将此行包装在 try catch 中

```
ftpStream = response.GetResponseStream(); 
```

只要调用了那些关闭调用，这应该没问题，您的取消逻辑在哪​​里？我希望在用户单击按钮时看到设置的循环标志。例如

```
while (readCount > 0 && !_shouldExit)
{
   outputStream.Write(buffer, 0, readCount);
  _actualDownloaded += readCount;
  if (this.InvokeRequired)
  {
    ProgressBarDel _progressDel = new ProgressBarDel(ProgressBar);
    this.Invoke(_progressDel, new object[] { _actualDownloaded, first });
  }
  first = false;
  readCount = ftpStream.Read(buffer, 0, bufferSize);
} 
```

# xaml - 如何将 XAML 右对齐代码放入样式中？

> ID：685977
> 
> 赞同：7
> 
> 时间：2009-03-26T14:15:08.420
> 
> 标签：xaml

右对齐 DataGridTextColumn 需要 5 行，这使我的 XAML 膨胀。

**如何** **将这个“右对齐代码块”放入样式**中并从属性中调用它，例如 class="rightAlignDataGridTextColumn"。

```
<toolkit:DataGridTextColumn Header="Order Date" Width="Auto"
       Binding="{Binding OrderDate, StringFormat='{}{0:dd.MM.yyyy}'}" 
       IsReadOnly="False">
    <toolkit:DataGridTextColumn.ElementStyle>
        <Style TargetType="TextBlock">
            <Setter Property="TextAlignment" Value="Right" />
        </Style>
    </toolkit:DataGridTextColumn.ElementStyle>
</toolkit:DataGridTextColumn>

<toolkit:DataGridTextColumn Header="Required Date" Width="Auto"
       Binding="{Binding RequiredDate, StringFormat='{}{0:dd.MM.yyyy}'}" 
       IsReadOnly="False">
    <toolkit:DataGridTextColumn.ElementStyle>
        <Style TargetType="TextBlock">
            <Setter Property="TextAlignment" Value="Right" />
        </Style>
    </toolkit:DataGridTextColumn.ElementStyle>
</toolkit:DataGridTextColumn>

<toolkit:DataGridTextColumn Header="Shipped Date" Width="Auto"
       Binding="{Binding ShippedDate, StringFormat='{}{0:dd.MM.yyyy}'}" 
       IsReadOnly="False">
    <toolkit:DataGridTextColumn.ElementStyle>
        <Style TargetType="TextBlock">
            <Setter Property="TextAlignment" Value="Right" />
        </Style>
    </toolkit:DataGridTextColumn.ElementStyle>
</toolkit:DataGridTextColumn> 
```

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-26T14:23:48.900

在 ResourceDictionary 中声明样式，如下所示：

```
<Window.Resources>
    <Style x:Key="RightAlignStyle" TargetType="{x:Type TextBlock}">
        <Setter Property="TextAlignment" Value="Right" />
    </Style>
</Window.Resources> 
```

`DataGridTextColumn`然后在每个元素上引用此样式：

```
<toolkit:DataGridTextColumn ElementStyle="{StaticResource RightAlignStyle}" ... > 
```

# c# - 加速 SqlDataSource 的提示？

> ID：685980
> 
> 赞同：1
> 
> 时间：2009-03-26T14:15:57.203
> 
> 标签：c#, asp.net, sql-server, tsql, sqldatasource

我在一个页面上有两个 SqlDataSource 控件。一个加载高级数据，另一个根据您选择的高级项目加载更多详细信息。这是拥有超过 900,000 条记录的大型搜索的一部分，我正在寻找加快搜索速度的方法。无论是我可以添加到 SqlDataSource 的选项，我可以对 sql 查询执行的操作，还是使用诸如 ObjectDataSource 之类的替代方案。

我将 DataSourceMode 更改为 DataReader，因为我听说它更快并且使用更少的内存。我还注意到分页真的很慢。

我正在从我的这个网站[http://mosesofegypt.net/post/2008/02/Building-a-grouping-Grid-with-GridView-and-ASPNET-AJAX-toolkit-CollapsiblePanel.aspx](http://mosesofegypt.net/post/2008/02/Building-a-grouping-Grid-with-GridView-and-ASPNET-AJAX-toolkit-CollapsiblePanel.aspx)执行以下操作，但显然我的数据超过 900,000 条记录，我不确定如何将分页添加到第二个 gridview，因为现在，它只在顶级 gridview

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T14:18:35.870

我认为您的数据源控件本身不需要成为任何优化的目标。它只会处理您从中获得的数据（意味着您应该优化您的 SQL）或在将其发送到 SQL 之前放入其中的数据（意味着您应该优化您的应用程序代码）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T14:19:13.137

1.  我将从在 asp.net 中为您的数据进行服务器端分页开始。
2.  我会确保索引您的数据库表以获得最佳性能。还可以使用查询分析器查看查询性能中的痛点。
3.  如果您正在搜索，我建议您使用 SQL 服务器提供的全文索引。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T15:07:23.023

当我过去必须跟踪大量数据时，我发现最好不要使用默认分页，而是覆盖以一次仅从数据库收集 10 或 20 行。您确实需要一个体面的索引过程，以便代码知道它正在显示哪 10 行或 20 行左右，但它确实加快了速度。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-10-25T19:10:27.177

就个人而言，我会考虑使用 ObjectDataSource，并进行自定义分页。4GuysFromRolla.com 有一些关于如何进行自定义分页的重要提示。

一旦开始达到大量记录，SQLDataSource 中的默认分页非常慢/性能差。

原因？每次刷新数据的调用（更改页面、编辑记录等）都会再次获取所有数据……然后客户端会显示您实际所在的页面。

使用自定义分页和 ObjectDataSource...，您现在只能检索您真正需要的较小的记录子集。

# c# - C# 中的 TCPClient 与 Socket

> ID：685995
> 
> 赞同：59
> 
> 时间：2009-03-26T14:19:51.233
> 
> 标签：c#, .net, sockets, network-programming

我没有看到太多用处`TCPClient`，但有很多`Socket`? 它们之间的主要区别是什么，你什么时候使用它们？

我知道 .NET`Socket`是在 WINSOCK 之上编写的，并且`TCPClient`是类的包装器`Socket`。因此，这`TCPClient`是链条的上游，并且可能效率低下。如果我错了，请纠正我。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-03-26T14:22:31.600

使用 TcpClient 和 TcpListener 只是意味着少了几行代码。正如您所说，它只是 Socket 类的包装器，因此它们之间没有性能差异，这纯粹是一种样式选择。

**更新：**自从发布此答案以来，.Net 源代码已经可用。它确实表明[TcpClient是](https://referencesource.microsoft.com/#System/net/System/Net/Sockets/TCPClient.cs)[Socket](https://referencesource.microsoft.com/#System/net/System/Net/Sockets/Socket.cs)类的一个非常轻量级的包装器，它本身就是原生[WinSock2 API](https://docs.microsoft.com/en-us/windows/win32/api/_winsock/) *之上的一个包装器。

*   在 Windows 上。.Net Standard/Core 等在其他平台上会有所不同。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-26T14:29:13.457

此外，您可以直接从`TCPClient`对象访问套接字，它位于属性下`Client`- 因此没有性能差异。

# php - PHP 的 RSS 提要消费

> ID：685997
> 
> 赞同：2
> 
> 时间：2009-03-26T14:19:58.923
> 
> 标签：php, rss

我希望将一些博客提要聚合到现有的基于 PHP 的网站中。有大量使用 RSS 提要的免费 PHP 库。但我想我会放弃我的需求，看看我是否可以将尝试的数量减少到一个受欢迎的数量。

1) 我希望将来自多达 3 个不同 RSS 提要的一些热门项目聚合到一个流中以供消费。

2）此外，我可能想汇总来自不同网站的匹配某个“标签”的故事。

3）我希望它每天作为一个计时作业运行并更新一些静态 html 包含文件，因为提要不需要不断更新。

4) 我还希望将提要写入几个不同的静态 html 包括的可能性。这样我就可以有一个主要新闻部分，然后在右侧可能有一个与文章或其他内容的特定标签匹配的标注部分。

那么，您最喜欢的库/代码片段是什么来完成其中的一些。

谢谢，托德

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T14:31:34.683

雅虎管道是聚合提要的绝佳方式。

还有添加规则以执行操作的功能，例如删除重复条目或过滤匹配特定条件的项目。

对于实际解析提要，类库[Simple Pie](http://simplepie.org/)非常棒。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T14:40:27.470

在我使用过的每个项目中，[SimplePie对我来说都表现得非常好。](http://www.simplepie.org)

在您的情况下，它是一个很好的匹配，因为它符合您的 2 个要求：

1）你可以给它一组提要，它将被视为一个组合提要

2）它具有内置缓存

对于仅提取与标签匹配的项目，这取决于启用此功能的网站所有者（例如 flickr 和 YouTube）。否则，您将不得不使用普通提要并自行决定保留哪些项目。

关于更新与某些类别匹配的静态 html 文件，这也是您需要自己编写代码的内容。这应该不难，SimplePie 将使解析提要变得非常容易。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T14:37:59.177

你可能会检查出[合群](http://gregarius.net/)的。它存储到数据库中，然后您可以根据需要对其进行操作。另外，您应该能够直接集成到它以加快速度。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T15:30:24.483

它与您描述的不*完全一样，但您可以使用*[MagpieRSS](http://magpierss.sourceforge.net/)做到这一点。

此外，这也不是您所要求的，您可能想查看[Planet](http://planetplanet.org) - 它是用 Python 编写的。

# javascript - 在加载（和内部）javascript Modalbox 时执行 javascript 代码

> ID：685998
> 
> 赞同：1
> 
> 时间：2009-03-26T14:20:28.797
> 
> 标签：javascript, ajax, prototypejs, scriptaculous, autocomplete

我真正想做的是让我的 script.aculo.us 自动完成器在我的表单加载到 Modalbox 对象中时工作。

当然，我在独立加载表单时尝试了我的自动完成程序，它可以按预期工作。作为参考，这是我加载该功能的 JS 代码：

```
Event.observe(window, 'load', function() { 
new Ajax.Autocompleter("gl_name", "autocomplete_choices", "<? echo WEB_ROOT . $page_name; ?>?action=ajax_autocomplete", {
    paramName: "value",
    minChars: 2,
    indicator: 'indicator1',
    afterUpdateElement: getSelectionIdGL
    });
}); 
```

然后我的 Autocompleter div 和指示器出现在我的 html 正文的末尾：

```
<span id="indicator1" style="display: none">
    <img src="/images/spinner.gif" alt="Working..." />
</span>
<div id="autocomplete_choices" class="autocomplete"></div> 
```

我还用 evalScripts 调用了 Modalbox()：true。

所以我基本上知道我的问题出在哪里：我希望在加载表单时创建我的自动完成程序，但是在编写脚本时已经加载了“窗口”对象，因为它与调用页面基本上是同一个窗口。

也就是说，老实说，我看不出它会真正触发哪个事件。我什至不知道这是否真的可能，但我当然希望它是。

所以..就是这样。我不知道还有什么要补充的。如果您需要对我的问题进行任何澄清，请不要犹豫。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T14:32:41.077

好的，看来我毕竟能够回答我自己的问题。

我将我的 Autocompleter 创建包含在一个函数中：

```
makeAutocompleters = function() {

new Ajax.Autocompleter("ass_name", "autocomplete_choices", "<? echo WEB_ROOT . $page_name; ?>?action=ajax_autocomplete", {
    paramName: "value",
    minChars: 2,
    indicator: 'indicator1',
    afterUpdateElement: getSelectionIdAss
    });
} 
```

然后在我的 ModalBox() 调用中，我添加了“afterLoad”回调参数：

```
onclick="Modalbox.show(this.href, {title: this.title, width: 470, evalScripts: true, afterLoad: function() { makeAutocompleters(); }}); return false;" 
```

然后它起作用了：D

因此，对于遇到相同问题的其他任何人来说，就是这样。

马修

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T14:34:04.773

你知道 modalbox 的[回调函数](http://code.google.com/p/modalbox/wiki/CallBacks)吗？您可以使用**afterLoad**来创建自动完成器。************************