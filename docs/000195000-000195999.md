# StackOverflow 问答 000195000-000195999

# testing - 什么是代码覆盖率，你如何衡量它？

> ID：195008
> 
> 赞同：334
> 
> 时间：2008-10-12T02:35:18.480
> 
> 标签：testing, computer-science, code-coverage

什么是代码覆盖率，你如何衡量它？

我被问到这个关于我们自动化测试代码覆盖率的问题。似乎在自动化工具之外，它更像是艺术而不是科学。是否有任何关于如何使用代码覆盖率的真实示例？

* * *

## 回答 #1

> 赞同：293
> 
> 时间：2008-10-12T02:54:43.887

代码覆盖率是对在运行自动化测试时执行了多少行/块/弧的代码的度量。

代码覆盖率是通过使用专门的工具来检测二进制文件以添加跟踪调用并针对检测的产品运行全套自动化测试来收集的。一个好的工具不仅可以为您提供已执行代码的百分比，还可以让您深入研究数据并准确查看在特定测试期间执行了哪些代码行。

我们的团队使用[Magellan](http://research.microsoft.com/displayArticle.aspx?id=707) - 一套内部代码覆盖工具。如果您是 .NET 商店，Visual Studio 已集成工具来收集代码覆盖率。您还可以滚动一些自定义工具，如[本文](http://msdn.microsoft.com/en-us/magazine/cc163981.aspx)所述。

如果您是 C++ 商店，英特尔有一些可在 Windows 和 Linux 上运行的[工具](http://www.intel.com/software/products/compilers/docs/fmac/doc_files/source/extfile/optaps_for/common/optaps_pgo_covr.htm)，尽管我没有使用过它们。我还听说有 GCC 的 gcov 工具，但我对此一无所知，无法给您链接。

至于我们如何使用它——代码覆盖率是我们每个里程碑的退出标准之一。我们实际上有三个代码覆盖率指标——单元测试覆盖率（来自开发团队）、场景测试（来自测试团队）和组合覆盖率。

顺便说一句，虽然代码覆盖率是衡量您正在进行多少测试的好指标，但它不一定是衡量您测试产品的好坏的好指标。您应该使用其他指标以及代码覆盖率来确保质量。

* * *

## 回答 #2

> 赞同：260
> 
> 时间：2008-10-12T03:11:42.073

代码覆盖率基本上告诉您有多少代码被测试覆盖。例如，如果你有 90% 的代码覆盖率，这意味着 10% 的代码没有被测试覆盖。

我知道你可能会想，如果覆盖了 90% 的代码，那就足够了，但你必须换个角度看。是什么阻止您获得 100% 的代码覆盖率？

一个很好的例子是：

```
if(customer.IsOldCustomer()) 
{
}
else 
{
} 
```

现在，在上面的代码中，有两个路径/分支。如果您总是点击“YES”分支，则您没有覆盖“else”部分，它将显示在代码覆盖率结果中。这很好，因为现在您知道没有涵盖的内容，您可以编写一个测试来涵盖“其他”部分。如果没有代码覆盖，你就只是坐在定时炸弹上，等待爆炸。

[NCover](http://www.ncover.com/)是衡量代码覆盖率的好工具。

* * *

## 回答 #3

> 赞同：73
> 
> 时间：2008-10-12T03:24:38.117

请记住，拥有“100% 代码覆盖率”并不意味着所有内容都经过了完全测试——虽然这意味着每一行代码都经过了测试，但这并不意味着它们在每种（常见）情况下都经过了测试。

我会使用代码覆盖来突出显示我可能应该为其编写测试的代码。例如，如果任何代码覆盖工具显示 myImportantFunction() 在运行我当前的单元测试时没有执行，它们可能应该得到改进。

基本上，100% 的代码覆盖率并不意味着您的代码是完美的。使用它作为编写更全面（单元）测试的指南。

* * *

## 回答 #4

> 赞同：62
> 
> 时间：2013-10-28T07:53:33.660

补充许多以前的答案的几点：

代码覆盖率意味着您的测试集覆盖源代码的程度。即测试用例集涵盖的源代码到什么程度。

如上面的答案所述，有各种覆盖标准，如路径、条件、函数、语句等。但要覆盖的其他标准是

1.  条件覆盖：所有布尔表达式都被评估为真和假。
2.  决策覆盖：不只是布尔表达式被评估一次真假，而是覆盖所有后续的 if-elseif-else 主体。
3.  循环覆盖率：意思是，每个可能的循环是否被执行一次、多次和零次。此外，如果我们假设最大限制，那么，如果可行，测试最大限制时间，并且比最大限制时间多一倍。
4.  进入和退出覆盖率：测试所有可能的调用及其返回值。
5.  参数值覆盖率 (PVC)。检查是否测试了参数的所有可能值。例如，字符串通常可以是以下任何一种：a) null，b) 空，c) 空格（空格、制表符、换行符），d) 有效字符串，e) 无效字符串，f) 单字节字符串，g ) 双字节字符串。未能测试每个可能的参数值可能会留下错误。仅测试其中一个可能会导致 100% 的代码覆盖率，因为覆盖了每一行，但由于仅测试了七个选项中的一个，这意味着只有 14.2% 的参数值覆盖率。
6.  继承覆盖：如果是面向对象的源，当返回基类引用的派生对象时，覆盖评估，如果返回兄弟对象，则应测试。

注意：静态代码分析会发现是否有任何无法访问的代码或挂起的代码，即未被任何其他函数调用覆盖的代码。以及其他静态覆盖。即使静态代码分析报告 100% 的代码被覆盖，如果所有可能的代码覆盖率都被测试过，它也不会给出关于你的测试集的报告。

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2008-10-12T03:59:00.963

代码覆盖率在前面的答案中已经得到了很好的解释。所以这更像是对问题第二部分的回答。

我们使用了三种工具来确定代码覆盖率。

1.  [JTest](http://www.parasoft.com/jsp/products/home.jsp?product=Jtest) - 基于 JUnit 构建的专有工具。（它也会生成单元测试。）
2.  [Cobertura](http://cobertura.sourceforge.net/) - 一个开源代码覆盖工具，可以很容易地与 JUnit 测试结合以生成报告。
3.  [Emma](http://emma.sourceforge.net/) - 另一个 - 我们用于与单元测试略有不同的目的。它已用于在最终用户访问 Web 应用程序时生成覆盖率报告。这与 Web 测试工具（例如：Canoo）相结合可以为您提供非常有用的覆盖率报告，告诉您在典型的最终用户使用期间覆盖了多少代码。

我们使用这些工具来

*   审查开发人员编写了良好的单元测试
*   确保在黑盒测试期间遍历所有代码

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-10-12T02:47:05.120

代码覆盖率只是对被测试代码的度量。有多种覆盖率标准可以衡量，但通常是程序中的各种路径、条件、函数和语句构成了总覆盖率。代码覆盖率指标只是执行这些覆盖率标准的测试的百分比。

至于我如何跟踪项目的单元测试覆盖率，我使用静态代码分析工具来跟踪。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-10-12T11:56:19.800

对于 Perl，有我经常在我的模块上使用的优秀的[Devel::Cover](http://search.cpan.org/perldoc?Devel::Cover)模块。

如果构建和安装由 Module::Build 管理，您可以简单地运行`./Build testcover`以获得一个漂亮的 HTML 站点，该站点告诉您每个子、行和条件的覆盖率，漂亮的颜色可以很容易地看到哪个代码路径没有被覆盖。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-05-14T06:53:17.407

在前面的答案中，代码覆盖率已经得到很好的解释。`iOS`如果您在平台上工作，我只是添加一些与工具相关的知识`OSX`，Xcode 提供了测试和监控代码覆盖率的工具。

参考链接：

[https://developer.apple.com/library/archive/documentation/DeveloperTools/Conceptual/testing_with_xcode/chapters/07-code_coverage.html](https://developer.apple.com/library/archive/documentation/DeveloperTools/Conceptual/testing_with_xcode/chapters/07-code_coverage.html)

[https://medium.com/zendesk-engineering/code-coverage-and-xcode-6b2fb8756a51](https://medium.com/zendesk-engineering/code-coverage-and-xcode-6b2fb8756a51)

两者都是学习和探索 Xcode 代码覆盖率的有用链接。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-02-21T17:25:05.890

**对于 PHP，你应该看看 Sebastian Bergmann 的 Github**

> 为 PHP 代码覆盖率信息提供收集、处理和呈现功能。

[https://github.com/sebastianbergmann/php-code-coverage](https://github.com/sebastianbergmann/php-code-coverage)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-06-06T00:54:18.423

代码覆盖率测试的目的是弄清楚有多少代码正在被测试。代码覆盖率工具生成一份报告，显示已运行了多少应用程序代码。代码覆盖率以百分比来衡量，越接近 100% 越好。这是一个白盒测试的例子。以下是一些用于代码覆盖测试的开源工具：

1.  [Simplecov](https://github.com/simplecov-ruby/simplecov) - 对于 Ruby
2.  [Coverlet](https://github.com/coverlet-coverage/coverlet) - 适用于 .NET
3.  [Cobertura](https://cobertura.github.io/cobertura/) - 用于 Java
4.  [Coverage.py](https://github.com/nedbat/coveragepy) - 对于 Python
5.  [Jest](https://github.com/facebook/jest) - 用于 JavaScript

# string - 如何拆分多个连接词？

> ID：195010
> 
> 赞同：52
> 
> 时间：2008-10-12T02:37:19.897
> 
> 标签：string, nlp

我有一个包含 1000 个左右条目的数组，示例如下：

```
wickedweather
liquidweather
driveourtrucks
gocompact
slimprojector 
```

我希望能够将这些拆分为各自的单词，例如：

```
wicked weather
liquid weather
drive our trucks
go compact
slim projector 
```

我希望正则表达式可以解决问题。但是，由于没有边界可以停止，也没有任何类型的大写可以键入，我在想，可能需要某种对字典的引用？

我想它可以手工完成，但是为什么 - 当它可以用代码完成时！=) 但这让我很难过。有任何想法吗？

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2009-01-26T23:10:31.063

维特[比算法](http://en.wikipedia.org/wiki/Viterbi_algorithm)要快得多。它计算与上述 Dmitry 答案中的递归搜索相同的分数，但在 O(n) 时间内。（德米特里的搜索需要指数级的时间；维特比通过动态规划来完成。）

```
import re
from collections import Counter

def viterbi_segment(text):
    probs, lasts = [1.0], [0]
    for i in range(1, len(text) + 1):
        prob_k, k = max((probs[j] * word_prob(text[j:i]), j)
                        for j in range(max(0, i - max_word_length), i))
        probs.append(prob_k)
        lasts.append(k)
    words = []
    i = len(text)
    while 0 < i:
        words.append(text[lasts[i]:i])
        i = lasts[i]
    words.reverse()
    return words, probs[-1]

def word_prob(word): return dictionary[word] / total
def words(text): return re.findall('[a-z]+', text.lower()) 
dictionary = Counter(words(open('big.txt').read()))
max_word_length = max(map(len, dictionary))
total = float(sum(dictionary.values())) 
```

测试它：

```
>>> viterbi_segment('wickedweather')
(['wicked', 'weather'], 5.1518198982768158e-10)
>>> ' '.join(viterbi_segment('itseasyformetosplitlongruntogetherblocks')[0])
'its easy for me to split long run together blocks' 
```

为了实用，您可能需要一些改进：

*   添加概率的对数，不要乘以概率。这避免了浮点下溢。
*   您的输入通常会使用不在您的语料库中的单词。必须为这些子字符串分配非零概率作为单词，否则您最终将没有解决方案或错误的解决方案。（对于上面的指数搜索算法也是如此。）这个概率必须从语料库单词的概率中提取出来，并合理地分布在所有其他候选词中：一般主题在统计语言模型中被称为平滑。（不过，你可以通过一些非常粗略的技巧来逃避。）这就是 O(n) Viterbi 算法击败搜索算法的地方，因为考虑非语料库单词会破坏分支因子。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2008-10-12T02:50:14.863

人类能做到吗？

```
远方袋
远侧袋
背袋
远侧袋

```

您不仅必须使用字典，还可能必须使用统计方法来找出最有可能的内容（或者，上帝保佑，您选择的人类语言的实际 HMM ......）

对于如何进行可能有用的统计，我请您咨询 Peter Norvig 博士，他***用 21 行代码***解决了一个不同但相关的拼写检查问题：http : [//norvig.com/spell-correct.html](http://norvig.com/spell-correct.html)

（他确实通过将每个 for 循环折叠成一行来作弊......但仍然如此）。

***更新***这卡在我的脑海里，所以我今天不得不生它。此代码与 Robert Gamble 描述的代码进行了类似的拆分，但随后它根据提供的字典文件中的词频对结果进行排序（现在预计该文件通常是代表您的域或英语的一些文本。我使用了 big来自 Norvig 的 .txt，上面链接，并为它添加了字典，以覆盖缺失的单词）。

除非频率差异很大，否则两个词的组合在大多数情况下会胜过三个词的组合。

* * *

**我在我的博客上发布了这段代码，并做了一些小的改动**

[http://squarecog.wordpress.com/2008/10/19/splitting-words-joined-into-a-single-string/](http://squarecog.wordpress.com/2008/10/19/splitting-words-joined-into-a-single-string/) 还写了一些关于这段代码中的下溢错误。我很想静静地修复它，但认为这可能会帮助一些以前没有看过日志技巧的人： http: [//squarecog.wordpress.com/2009/01/10/dealing-with-underflow-in-joint-probability-calculations/](http://squarecog.wordpress.com/2009/01/10/dealing-with-underflow-in-joint-probability-calculations/)

* * *

输出你的话，加上我自己的话——注意“orcore”会发生什么：

```
perl splitwords.pl big.txt 单词
answerveal：2种可能性
 - 回答小牛肉
 - 回答ve al

邪恶的天气：4种可能性
 - 恶劣的天气
 - 邪恶的我们在她
 - 邪恶的天气
 - 邪恶的我们在她

液态天气：6种可能性
 - 液态天气
 - 我们对她的液体
 - li quid 天气
 - 我对她说我们
 - li qu id 天气
 - li qu id we at her

driveourtrucks: 1 种可能性
 - 驾驶我们的卡车

gocompact：1 种可能性
 - 紧凑

超薄投影仪：2 种可能性
 - 超薄投影仪
 - 苗条的项目或

orcore：3种可能性
 - 或核心
 - 或核心
 - 兽人矿石

```

代码：

```
#!/usr/bin/env perl

use strict;
use warnings;

sub find_matches($);
sub find_matches_rec($\@\@);
sub find_word_seq_score(@);
sub get_word_stats($);
sub print_results($@);
sub Usage();

our(%DICT,$TOTAL);
{
  my( $dict_file, $word_file ) = @ARGV;
  ($dict_file && $word_file) or die(Usage);

  {
    my $DICT;
    ($DICT, $TOTAL) = get_word_stats($dict_file);
    %DICT = %$DICT;
  }

  {
    open( my $WORDS, '<', $word_file ) or die "unable to open $word_file\n";

    foreach my $word (<$WORDS>) {
      chomp $word;
      my $arr = find_matches($word);

      local $_;
      # Schwartzian Transform
      my @sorted_arr =
        map  { $_->[0] }
        sort { $b->[1] <=> $a->[1] }
        map  {
          [ $_, find_word_seq_score(@$_) ]
        }
        @$arr;

      print_results( $word, @sorted_arr );
    }

    close $WORDS;
  }
}

sub find_matches($){
    my( $string ) = @_;

    my @found_parses;
    my @words;
    find_matches_rec( $string, @words, @found_parses );

    return  @found_parses if wantarray;
    return \@found_parses;
}

sub find_matches_rec($\@\@){
    my( $string, $words_sofar, $found_parses ) = @_;
    my $length = length $string;

    unless( $length ){
      push @$found_parses, $words_sofar;

      return @$found_parses if wantarray;
      return  $found_parses;
    }

    foreach my $i ( 2..$length ){
      my $prefix = substr($string, 0, $i);
      my $suffix = substr($string, $i, $length-$i);

      if( exists $DICT{$prefix} ){
        my @words = ( @$words_sofar, $prefix );
        find_matches_rec( $suffix, @words, @$found_parses );
      }
    }

    return @$found_parses if wantarray;
    return  $found_parses;
}

## Just a simple joint probability
## assumes independence between words, which is obviously untrue
## that's why this is broken out -- feel free to add better brains
sub find_word_seq_score(@){
    my( @words ) = @_;
    local $_;

    my $score = 1;
    foreach ( @words ){
        $score = $score * $DICT{$_} / $TOTAL;
    }

    return $score;
}

sub get_word_stats($){
    my ($filename) = @_;

    open(my $DICT, '<', $filename) or die "unable to open $filename\n";

    local $/= undef;
    local $_;
    my %dict;
    my $total = 0;

    while ( <$DICT> ){
      foreach ( split(/\b/, $_) ) {
        $dict{$_} += 1;
        $total++;
      }
    }

    close $DICT;

    return (\%dict, $total);
}

sub print_results($@){
    #( 'word', [qw'test one'], [qw'test two'], ... )
    my ($word,  @combos) = @_;
    local $_;
    my $possible = scalar @combos;

    print "$word: $possible possibilities\n";
    foreach (@combos) {
      print ' -  ', join(' ', @$_), "\n";
    }
    print "\n";
}

sub Usage(){
    return "$0 /path/to/dictionary /path/to/your_words";
} 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2019-09-19T11:46:00.827

点安装wordninja

```
>>> import wordninja
>>> wordninja.split('bettergood')
['better', 'good'] 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-12T04:12:28.130

在这里工作的最佳工具是递归，而不是正则表达式。基本思想是从字符串的开头开始寻找一个单词，然后取出字符串的其余部分并寻找另一个单词，依此类推，直到到达字符串的末尾。递归解决方案是自然的，因为当字符串的给定剩余部分无法分解为一组单词时，需要进行回溯。下面的解决方案使用字典来确定什么是单词并在找到它们时打印出解决方案（一些字符串可以分解为多个可能的单词集，例如 wickedweather 可以被解析为“wicked we at her”）。如果您只想要一组单词，则需要确定选择最佳组的规则，

```
#!/usr/bin/perl

use strict;

my $WORD_FILE = '/usr/share/dict/words'; #Change as needed
my %words; # Hash of words in dictionary

# Open dictionary, load words into hash
open(WORDS, $WORD_FILE) or die "Failed to open dictionary: $!\n";
while (<WORDS>) {
  chomp;
  $words{lc($_)} = 1;
}
close(WORDS);

# Read one line at a time from stdin, break into words
while (<>) {
  chomp;
  my @words;
  find_words(lc($_));
}

sub find_words {
  # Print every way $string can be parsed into whole words
  my $string = shift;
  my @words = @_;
  my $length = length $string;

  foreach my $i ( 1 .. $length ) {
    my $word = substr $string, 0, $i;
    my $remainder = substr $string, $i, $length - $i;
    # Some dictionaries contain each letter as a word
    next if ($i == 1 && ($word ne "a" && $word ne "i"));

    if (defined($words{$word})) {
      push @words, $word;
      if ($remainder eq "") {
        print join(' ', @words), "\n";
        return;
      } else {
        find_words($remainder, @words);
      }
      pop @words;
    }
  }

  return;
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-12T02:40:14.743

我认为您认为这不是正则表达式的真正工作是正确的。我会使用字典的想法来解决这个问题——在字典中查找最长的前缀。当你找到它时，把它剪掉，然后对剩余的绳子做同样的事情。

上述方法存在歧义，例如“drivereallyfast”会先找到“driver”，然后“eallyfast”会出现问题。因此，如果遇到这种情况，您还必须进行一些回溯。或者，由于您没有那么多要拆分的字符串，因此只需手动执行自动拆分失败的字符串。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2018-03-23T00:16:35.323

这与称为*标识符拆分*或*标识符名称标记化*的问题有关。在 OP 的情况下，输入似乎是普通单词的串联；在标识符拆分中，输入是源代码中的类名、函数名或其他标识符，问题更难。我意识到这是一个老问题，OP 要么解决了他们的问题，要么继续前进，但如果其他人在寻找标识符拆分器时遇到这个问题（就像我不久前一样），我想提供[Spiral](https://github.com/casics/spiral) ( “*标识符拆分器：一个库*”）。它是用 Python 编写的，但带有一个命令行实用程序，可以读取标识符文件（每行一个）并拆分每个标识符。

拆分标识符看似困难。程序员在命名事物时通常使用缩写、首字母缩略词和单词片段，而且他们并不总是使用一致的约定。即使在标识符确实遵循某些约定（例如驼峰式大小写）时，也会出现歧义。

[Spiral](https://github.com/casics/spiral)实现了许多标识符拆分算法，包括一种称为 Ronin 的新算法。它使用从挖掘源代码存储库中获得的各种启发式规则、英语词典和令牌频率表。Ronin 可以对不使用驼峰式或其他命名约定的标识符进行拆分，包括拆分`J2SEProjectTypeProfiler`为 [ `J2SE`, `Project`, `Type`, `Profiler`] 等情况，这需要读者识别`J2SE`为一个单元。以下是 Ronin 可以拆分的更多示例：

```
# spiral mStartCData nonnegativedecimaltype getUtf8Octets GPSmodule savefileas nbrOfbugs
mStartCData: ['m', 'Start', 'C', 'Data']
nonnegativedecimaltype: ['nonnegative', 'decimal', 'type']
getUtf8Octets: ['get', 'Utf8', 'Octets']
GPSmodule: ['GPS', 'module']
savefileas: ['save', 'file', 'as']
nbrOfbugs: ['nbr', 'Of', 'bugs'] 
```

使用 OP 问题中的示例：

```
# spiral wickedweather liquidweather  driveourtrucks gocompact slimprojector
wickedweather: ['wicked', 'weather']
liquidweather: ['liquid', 'weather']
driveourtrucks: ['driveourtrucks']
gocompact: ['go', 'compact']
slimprojector: ['slim', 'projector'] 
```

如您所见，它并不完美。值得注意的是，Ronin 有许多参数，调整它们也可以进行拆分`driveourtrucks`，但代价是程序标识符的性能恶化。

更多信息可以在[Spiral 的 GitHub 存储库中](https://github.com/casics/spiral)找到。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-12T02:41:20.013

好吧，问题本身并不能仅用正则表达式来解决。一个解决方案（可能不是最好的）是获取字典并为字典中的每个工作与列表中的每个单词进行正则表达式匹配，只要成功就添加空格。当然，这不会非常快，但它会很容易编程并且比手工操作更快。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-12T02:41:31.137

需要基于字典的解决方案。如果你有一个有限的字典可以出现，这可能会稍微简化，否则形成其他单词前缀的单词将是一个问题。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-01-16T05:34:37.890

有一个 python 包发布了 Santhosh thottingal，叫做 mlmorph，可用于形态分析。

[https://pypi.org/project/mlmorph/](https://pypi.org/project/mlmorph/)

例子：

```
from mlmorph import Analyser
analyser = Analyser()
analyser.analyse("കേരളത്തിന്റെ") 
```

给

```
[('കേരളം&lt;np><genitive>', 179)] 
```

他还写了一篇关于该主题的博客[https://thottingal.in/blog/2017/11/26/towards-a-malayalam-morphology-analysisr/](https://thottingal.in/blog/2017/11/26/towards-a-malayalam-morphology-analyser/)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-08-30T21:59:24.967

一个简单的 Python 解决方案：安装[wordsegment](https://github.com/grantjenks/python-wordsegment)包：`pip install wordsegment`.

```
$ echo thisisatest | python -m wordsegment
this is a test 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2020-04-11T15:19:53.677

如果是驼峰式，这将起作用。JavaScript！！！

```
function spinalCase(str) {
  let lowercase = str.trim()
  let regEx = /\W+|(?=[A-Z])|_/g
  let result = lowercase.split(regEx).join("-").toLowerCase()

  return result;
}

spinalCase("AllThe-small Things"); 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2020-10-20T16:50:38.103

一种解决方案可能是递归（同样可以转换为动态编程）：

```
static List<String> wordBreak(
    String input,
    Set<String> dictionary
) {

  List<List<String>> result = new ArrayList<>();
  List<String> r = new ArrayList<>();

  helper(input, dictionary, result, "", 0, new Stack<>());

  for (List<String> strings : result) {
    String s = String.join(" ", strings);
    r.add(s);
  }

  return r;
}

static void helper(
    final String input,
    final Set<String> dictionary,
    final List<List<String>> result,
    String state,
    int index,
    Stack<String> stack
) {

  if (index == input.length()) {

    // add the last word
    stack.push(state);

    for (String s : stack) {
      if (!dictionary.contains(s)) {
        return;
      }
    }

    result.add((List<String>) stack.clone());

    return;
  }

  if (dictionary.contains(state)) {
    // bifurcate
    stack.push(state);
    helper(input, dictionary, result, "" + input.charAt(index),
           index + 1, stack);

    String pop = stack.pop();
    String s = stack.pop();

    helper(input, dictionary, result, s + pop.charAt(0),
           index + 1, stack);

  }
  else {
    helper(input, dictionary, result, state + input.charAt(index),
           index + 1, stack);
  }

  return;
} 
```

另一种可能的解决方案是使用`Tries`数据结构。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2021-06-23T07:48:33.540

```
output :-
['better', 'good'] ['coffee', 'shop']
['coffee', 'shop']

    pip install wordninja
import wordninja
n=wordninja.split('bettergood')
m=wordninja.split("coffeeshop")
print(n,m)

list=['hello','coffee','shop','better','good']
mat='coffeeshop'
expected=[]
for i in list:
    if i in mat:
        expected.append(i)
print(expected) 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2021-11-29T23:09:15.107

所以我在这个答案上花了大约 2 天的时间，因为我需要它来完成我自己的 NLP 工作。我的答案来自[Darius Bacon 的](https://stackoverflow.com/users/27024/darius-bacon)答案，它本身来自[Viterbi algorithm](https://en.wikipedia.org/wiki/Viterbi_algorithm)。我还将它抽象为获取消息中的每个单词，尝试拆分它，然后重新组合消息。我扩展了 Darius 的代码以使其可调试。我还换掉了对“big.txt”的需求，并使用了[wordfreq](https://pypi.org/project/wordfreq/)图书馆代替。一些评论强调需要对不存在的词使用非零词频。我发现使用任何高于零的频率都会导致“itseasyformetosplitlongruntogetherblocks”被拆分为“itseasyformetosplitlongruntogether blocks”。该算法通常倾向于过度拆分或拆分各种测试消息，具体取决于您如何组合词频以及如何处理丢失的词频。我进行了许多调整，直到它表现良好。我的解决方案对缺失词使用 0.0 频率。它还增加了对单词长度的奖励（否则它倾向于将单词拆分为字符）。我尝试了许多长度奖励，似乎最适合我的测试用例的是`word_frequency * (e ** word_length)`. 还有评论警告不要将词频相乘。我尝试使用调和平均值添加它们，并使用 1-freq 而不是 0.00001 形式。他们都倾向于过度拆分测试用例。简单地将词频相乘效果最好。我把我的调试打印语句留在了那里，以便其他人更容易继续调整。最后，有一种特殊情况，如果您的整个消息是一个不存在的单词，例如“Slagle's”，那么该函数会将单词拆分为单个字母。就我而言，我不希望这样，所以我在最后有一个特殊的 return 语句来在这些情况下返回原始消息。

```
import numpy as np
from wordfreq import get_frequency_dict

word_prob = get_frequency_dict(lang='en', wordlist='large')
max_word_len = max(map(len, word_prob))  # 34

def viterbi_segment(text, debug=False):
    probs, lasts = [1.0], [0]
    for i in range(1, len(text) + 1):
        new_probs = []
        for j in range(max(0, i - max_word_len), i):
            substring = text[j:i]
            length_reward = np.exp(len(substring))
            freq = word_prob.get(substring, 0) * length_reward
            compounded_prob = probs[j] * freq
            new_probs.append((compounded_prob, j))

            if debug:
                print(f'[{j}:{i}] = "{text[lasts[j]:j]} & {substring}" = ({probs[j]:.8f} & {freq:.8f}) = {compounded_prob:.8f}')

        prob_k, k = max(new_probs)  # max of a touple is the max across the first elements, which is the max of the compounded probabilities
        probs.append(prob_k)
        lasts.append(k)

        if debug:
            print(f'i = {i}, prob_k = {prob_k:.8f}, k = {k}, ({text[k:i]})\n')

    # when text is a word that doesn't exist, the algorithm breaks it into individual letters.
    # in that case, return the original word instead
    if len(set(lasts)) == len(text):
        return text

    words = []
    k = len(text)
    while 0 < k:
        word = text[lasts[k]:k]
        words.append(word)
        k = lasts[k]
    words.reverse()
    return ' '.join(words)

def split_message(message):
  new_message = ' '.join(viterbi_segment(wordmash, debug=False) for wordmash in message.split())
  return new_message

messages = [
    'tosplit',
    'split',
    'driveourtrucks',
    "Slagle's",
    "Slagle's wickedweather liquidweather driveourtrucks gocompact slimprojector",
    'itseasyformetosplitlongruntogetherblocks',
]

for message in messages:
    print(f'{message}')
    new_message = split_message(message)
    print(f'{new_message}\n') 
```

```
tosplit
to split

split
split

driveourtrucks
drive our trucks

Slagle's
Slagle's

Slagle's wickedweather liquidweather driveourtrucks gocompact slimprojector
Slagle's wicked weather liquid weather drive our trucks go compact slim projector

itseasyformetosplitlongruntogetherblocks
its easy for me to split long run together blocks 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-12T02:49:03.213

我可能会因此而被贬低，但**让秘书去做**。

与手动处理相比，您在字典解决方案上花费的时间更多。此外，您不可能对解决方案有 100% 的信心，因此无论如何您仍然必须手动关注它。

# java - 使用 JavaDoc 记录 Java 枚举的最佳方法是什么？

> ID：195020
> 
> 赞同：50
> 
> 时间：2008-10-12T02:46:54.933
> 
> 标签：java, enums, javadoc

我刚刚开始在我自己的项目中使用 Java 的枚举（我必须在工作中使用 JDK 1.4），我对使用 JavaDoc 进行枚举的最佳实践感到困惑。

我发现这种方法有效，但生成的代码有点不完善：

```
/**
* Doc for enum
*/
public enum Something {
/**
* First thing
*/
FIRST_THING,
/**
* Second thing
*/
SECOND_THING;
//could continue with more
} 
```

有没有什么办法可以在自己的行上分解枚举声明而不用逗号链接它们，或者这是使用 JavaDoc 进行枚举的最佳方法？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-10-12T03:58:53.197

要回答问题的第一部分，您必须用逗号分隔每个枚举值。据我所知，这是没有办法的。

就我个人而言，我对您呈现代码的方式没有任何问题。似乎是向我记录枚举的一种完全合理的方式。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-12T04:42:57.897

正如 Mike 所提到的，您必须用逗号分隔枚举值，并且它们必须是枚举声明中列出的第一件事（实例变量、常量、构造函数和方法可能紧随其后）。

我认为记录枚举的最佳方式类似于常规类：枚举类型获取对整个枚举的功能和角色的描述（“ `Something values are used to indicate which mode of operation a client wishes...`”），并且每个枚举值获取其用途和功能的 Javadoc 描述（“ `FIRST_THING indicates that the operation should evaluate the first argument first..`”）。

如果枚举值描述很短，您可能希望将它们放在一行中`/** Evaluate first argument first. */`，但我建议将每个枚举值保留在自己的行中。大多数 IDE 可以配置为自动以这种方式格式化它们。

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2008-10-12T04:16:01.710

有一个google代码搜索在线工具——http: [//www.google.com/codesearch](http://www.google.com/codesearch)

[我尝试通过执行“lang:java public enum”之](http://www.google.com/codesearch#search&q=lang:java+public+enum)类的操作来查找内容

[Sun 的一个例子](http://www.google.com/codesearch#search&q=public+enum+lang:java+show:C2YXOCVDRYM:BdNY19GPXpI:C2YXOCVDRYM)

# php - 使用前端控制器和标头是在 PHP 中模拟响应的最佳方式吗？

> ID：195036
> 
> 赞同：1
> 
> 时间：2008-10-12T03:03:55.333
> 
> 标签：php, controller

最近我一直在为一些个人项目研究 PHP 框架，看起来它们中的大多数都使用前端控制器来模拟响应。控制器从请求中获取参数，并根据逻辑发送适当的标头来重新路由。这就是“回应”。这是在 PHP 中执行此操作的最佳方法，还是有其他关于如何处理重新路由和响应的理论？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-12T03:14:34.283

前端控制器非常适合 Web 环境，允许您将所有请求汇集到您的应用程序。由于 HTTP 是无状态的，从某种意义上说，用户可能会无意中偶然发现应用程序的某些部分（即，点击随机 URL），前端控制器允许您确定应用程序的入口点，并做出适当的响应。

**编辑**：作为对评论的回应，我认为混淆可能是java比PHP有更多的结构，这可能会使整个事情过于复杂？最终 PHP 可以提供从请求到响应的非常基本的交互：

```
switch($_GET['page']) {
  case "one";
      print "page one!";
      break;
  default:
      print "default page";
      break;
} 
```

从那里您可以将各种事物分层到前端控制器，将请求对象向下传递到过滤器链到页面控制器，该控制器重新路由到适当的模型，该模型通过您的数据库抽象层抓取数据，过滤它，备份到控制器，并且转到构建适当响应的视图，同时触发随机事件挂钩。最终由您（作为开发人员）选择您正在寻找的复杂性/分离级别。这是 PHP 的美与恶 :)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T04:23:01.103

我认为您将 Http 响应与您查看的框架中的响应对象混淆了。前端控制器是您的应用程序的网关 - 所有（http）请求都通过它，并路由到适当的控制器/动作。处理请求不一定会导致返回响应（通常请求只是为了向服务器发送信息），但是所有请求都将通过前端控制器。

请求对象通常用于封装环境和http请求参数，并提供API来检索它们。它的补充，即响应对象，通常用于封装生成http响应的过程，包括生成头。

还有其他处理请求和路由的方法，它们不是 PHP 独有的（前端控制器也不是），例如页面控制器，或者根本不使用 MVC 结构。

# jquery - 使用 jQuery，您如何模拟在 $.ajax 调用中选择多个选项的选择的表单序列化？

> ID：195058
> 
> 赞同：5
> 
> 时间：2008-10-12T03:31:57.510
> 
> 标签：jquery

下面是我的 $.ajax 调用，如何在数据部分中放置一个选择（多个）选定值？

```
$.ajax({
    type: "post",
    url: "http://myServer" ,
    dataType: "text",
    data: {
        'service' : 'myService',
        'program' : 'myProgram',
        'start' : start,
        'end' : end ,
        },
    success: function(request) {
      result.innerHTML = request ;
    }   // End success
  }); // End ajax method 
```

**编辑**我应该包括我了解如何使用此代码循环选择选定的选项：

```
$('#userid option').each(function(i) {
 if (this.selected == true) { 
```

但我如何将它融入我的数据：部分？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-12T03:40:54.387

使用数组怎么样？

```
data: {
    ...
    'select' : ['value1', 'value2', 'value3'],
    ...
}, 
```

**编辑**：啊抱歉，这是代码，有几点需要注意：

```
'select' : $('#myselectbox').serializeArray(), 
```

但是，为了使 serializeArray() 工作，所有表单元素都必须具有 name 属性。上面的值`'select'`将是一个对象数组，其中包含所选元素的名称和值。

```
'select' : [
    { 'name' : 'box', 'value' : 1 },
    { 'name' : 'box', 'value' : 2 }
], 
```

产生上述结果的选择框将是：

```
<select multiple="true" name="box" id="myselectbox">
   <option value="1" name="option1" selected="selected">One</option>
   <option value="2" name="option2" selected="selected">Two</option>
   <option value="3" name="option3">Three</option>
</select> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-12T23:19:32.090

感谢@Owen 的回答，我得到了这段代码。

对于 id="mySelect" multiple="true" 的选择框

```
 var mySelections = [];
    $('#mySelect option').each(function(i) {
        if (this.selected == true) {
            mySelections.push(this.value);
        }
    });

    $.ajax({
      type: "post",
      url: "http://myServer" ,
      dataType: "text",
      data: {
        'service' : 'myService',
        'program' : 'myProgram',
        'selected' : mySelections
        },
      success: function(request) {
        result.innerHTML = request ;
      }
    }); // End ajax method 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-02-04T11:37:48.333

表示选择的多个选项的集合的正确方法是使用**数组**，即使用 [] 后缀命名 SELECT 标记。
问题是 jQuery 方法 serialize() 没有正确处理它。
对于这样的 SELECT，事实上：

```
<选择名称="a[]">
    <option value="5">5</option>
    <option value="six">6</option>
    <option value="7">7</option>
</选择>

```

serialize 发送这个数组： a[]=0&a[]=1&a[]=2 由 PHP 以这种方式接收：

```
[a] => 数组
    (
        [0] => 0
        [1] => 1
        [2] => 2
    )

```

失去真实价值的地方。

# c# - 如何以编程方式运行 NUnit

> ID：195061
> 
> 赞同：18
> 
> 时间：2008-10-12T03:35:38.517
> 
> 标签：c#, .net, nunit, assembly.load

我有一些引用 NUnit 并使用单个测试方法创建单个测试类的程序集。我能够获得该程序集的文件系统路径（例如“C:...\test.dll”）。我想以编程方式使用 NUnit 来针对这个程序集运行。

到目前为止，我有：

```
var runner = new SimpleTestRunner();
runner.Load(path);
var result = runner.Run(NullListener.NULL); 
```

但是，调用 runner.Load(path) 会引发 FileNotFound 异常。我可以通过堆栈跟踪看到问题在于 NUnit 在堆栈中调用 Assembly.Load(path) 。如果我将路径更改为“Test，Version=1.0.0.0，Culture=neutral，PublicKeyToken=null”，那么我仍然会收到相同的错误。

我已向 AppDomain.Current.AssemblyResolve 添加了一个事件处理程序，以查看是否可以手动解析此类型，但我的处理程序永远不会被调用。

让 Assembly.Load(...) 工作的秘诀是什么？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-01-16T10:58:50.597

如果要在*控制台模式下*打开，请添加**nunit-console-runner.dll**引用并使用：

```
NUnit.ConsoleRunner.Runner.Main(new string[]
   {
      System.Reflection.Assembly.GetExecutingAssembly().Location, 
   }); 
```

如果要以*gui 模式*打开，请添加**nunit-gui-runner.dll**引用并使用：

```
NUnit.Gui.AppEntry.Main(new string[]
   {
      System.Reflection.Assembly.GetExecutingAssembly().Location, 
      "/run"
   }); 
```

这是最好的方法，因为您不必指定任何路径。

另一种选择是将 NUnit 运行器集成到 Visual Studio 调试器输出中：

```
public static void Main()
{
    var assembly = Assembly.GetExecutingAssembly().FullName;
    new TextUI (new DebugTextWriter()).Execute(new[] { assembly, "-wait" });
}

public class DebugTextWriter : StreamWriter
{
    public DebugTextWriter()
        : base(new DebugOutStream(), Encoding.Unicode, 1024)
    {
        this.AutoFlush = true;
    }

    class DebugOutStream : Stream
    {
        public override void Write(byte[] buffer, int offset, int count)
        {
            Debug.Write(Encoding.Unicode.GetString(buffer, offset, count));
        }

        public override bool CanRead { get { return false; } }
        public override bool CanSeek { get { return false; } }
        public override bool CanWrite { get { return true; } }
        public override void Flush() { Debug.Flush(); }
        public override long Length { get { throw new InvalidOperationException(); } }
        public override int Read(byte[] buffer, int offset, int count) { throw new InvalidOperationException(); }
        public override long Seek(long offset, SeekOrigin origin) { throw new InvalidOperationException(); }
        public override void SetLength(long value) { throw new InvalidOperationException(); }
        public override long Position
        {
            get { throw new InvalidOperationException(); }
            set { throw new InvalidOperationException(); }
        }
    };
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-12T03:47:55.073

“让 Assembly.Load 工作的秘诀是什么？”

System.Reflection.Assembly.Load 接受一个包含程序集名称的字符串，而不是文件的路径。

如果要从文件中加载程序集，请使用：

```
Assembly a = System.Reflection.Assembly.LoadFrom(pathToFileOnDisk); 
```

（LoadFrom 实际上在内部使用 Assembly.Load）

顺便说一句，你有什么理由不能使用[NUnit-Console 命令行工具](http://www.nunit.org/index.php?p=consoleCommandLine&r=2.2.4)，而只是将它传递给你的测试程序集的路径？然后，您可以使用 System.Diagnostics.Process 从您的客户端应用程序中运行它，可能更简单？

# java - 在 Java 中检测无法访问的主机的最快方法是什么？

> ID：195070
> 
> 赞同：12
> 
> 时间：2008-10-12T03:53:09.120
> 
> 标签：java, networking, sockets

我想要`boolean isReachable(String host, int port)`在以下条件下通过以下 JUnit 测试的最快、最准确的函数。超时值由 JUnit 测试本身指定，并且可能被视为“无法访问”。

**请注意：**所有答案必须与平台无关。这意味着这`InetAddress.isReachable(int timeout)`不起作用，因为它依赖端口`7`在 Windows 上执行 ping（ICMP ping 在 Windows 上是一个未记录的功能），并且此端口在此设置中被阻止。

局域网设置：

*   `thisMachine`( `192.168.0.100`)
*   `otherMachine`( `192.168.0.200`)
*   **没有**机器被调用`noMachine`或没有 IP `192.168.0.222`（总是无法访问）
*   两台机器都在端口上运行 Apache Tomcat `8080`；所有其他端口都无法访问（包括 port `7`）
*   `example.com`( `208.77.188.166`) 在端口上运行网络服务器，`80`并且仅当 LAN 连接到 Internet 时才可访问

有时，LAN 与 Internet 断开连接，在这种情况下，只能访问由 IP 地址调用的本地计算机（所有其他计算机都无法访问；没有 DNS）。

**所有测试都在`thisMachine`.**

```
@Test(timeout=1600) // ~320ms per call (should be possible to do better)
public void testLocalhost() {
    // We can always reach ourselves.
    assertTrue(isReachable("localhost", 8080));
    assertTrue(isReachable("127.0.0.1", 8080));
    assertTrue(isReachable("thisMachine", 8080)); // Even if there's no DNS!
    assertTrue(isReachable("192.168.0.100", 8080));

    assertFalse(isReachable("localhost", 80)); // Nothing on that port.
}

@Test(timeout=5500) // ~1867ms per call (should be able to do better)
public void testLAN() {
    assertTrue(isReachable("192.168.0.200", 8080)); // Always connected to the LAN.
    assertFalse(isReachable("192.168.0.222", 8080)); // No such a machine.
    assertFalse(isReachable("noMachine", 8080)); // No such machine.
} 
```

以下测试仅在 LAN与 Internet**断开连接时运行。**

```
@Test(timeout=5600) // ~1867ms per call (reasonable?)
public void testNoDNS() {
    assertFalse(isReachable("otherMachine", 8080)); // No DNS.
    assertFalse(isReachable("example.com", 80)); // No DNS & no Internet.
    assertFalse(isReachable("208.77.188.166", 80)); // No Internet.
} 
```

以下测试仅在 LAN**连接**到 Internet 时运行。

```
@Test(timeout=5600) // ~1867ms per call (reasonable?)
public void testHaveDNS() {
    assertTrue(isReachable("otherMachine", 8080)); // DNS resolves local names.
    assertTrue(isReachable("example.com", 80)); // DNS available.
    assertTrue(isReachable("208.77.188.166", 80)); // Internet available.
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-14T10:24:20.733

Firstly you need to recognise that you have *potentially* conflicting requirements; IP sockets are not time deterministic. The quickest you can ever detect unreachability is after your elapsed timeout. You can only detect reachability quicker.

Assuming reachability/isReachable is your real objective, you should just use a straightforward non-blocking socket IO as shown in the [Java Ping](http://java.sun.com/j2se/1.4.2/docs/guide/nio/example/Ping.java) simulator, the example connects to the time service but would work equally well on 8080.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T07:08:40.177

如果您想测试是否可以连接到 Web 服务器，您还可以根据主机名和端口号创建一个[URL ，并使用它来创建一个](http://java.sun.com/j2se/1.4.2/docs/api/java/net/URL.html)[URLConnection检查](http://java.sun.com/j2se/1.4.2/docs/api/java/net/URLConnection.html)[连接方法](http://java.sun.com/j2se/1.4.2/docs/api/java/net/URLConnection.html#connect())的结果（包括异常）应该告诉您是否网络服务器是可访问的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-15T16:52:48.280

如果您需要在很短的时间内对大量主机执行此操作，我会考虑使用[fping](http://fping.sourceforge.net/)之类的工具来代替 - shell out 来执行它并在输出返回时解析输出。fping 一次运行大量并行查询，所以理论上你可以在一分钟内检查几千台主机（我认为限制是 4096？）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-12T04:08:23.567

不确定这有多实用。

怎么样做相当于traceroute（windows上的tracert），一旦你成功了，你就可以继续了。

在企业网络中，我看到 ICMP(ping) 被管理员阻止但通常，tracert 仍然有效。如果您能找到一种快速的方法来完成 tracert 的工作，那应该可以解决问题吗？

祝你好运！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-04-29T04:23:07.747

主机可用性的速率确定步骤不在您自己的代码中，而是在 netlag 中。您必须等待主机响应，这可能需要一些时间。如果您的程序在等待响应时阻塞，则可能是一个问题。我通过将每个主机创建为一个对象来解决这个问题，每个主机都有自己的线程方法来检查可用性。在我自己的情况下，我跟踪了 40 个主机。我的主程序每 20 秒循环一次由 40 个机器对象组成的数组，并在每个对象上调用适当的方法来检查可用性。由于每个机器对象都会产生自己的线程来执行此操作，因此所有 40 台机器都会同时被询问，并且每台机器的响应时间（最多 500 毫秒）都不是问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-12T03:54:20.710

我最近的解决方案取决于在执行连接时使用具有 3000 毫秒超时的`TimedSocket`（[源代码）。](http://www.javaworld.com/jw-09-1999/jw-09-timeout.html)

时间：

*   1406 毫秒：`testLocalHost()`
*   5280 毫秒：`testLAN()`

甚至无法让这些正常工作：

*   `testNoDNS()`
*   `testHaveDNS()`

# php - PHP 应用程序可能存在循环依赖问题

> ID：195072
> 
> 赞同：7
> 
> 时间：2008-10-12T03:57:57.877
> 
> 标签：php, oop, dependencies, instantiation, circular-dependency

我遇到了我认为是我的 PHP 应用程序的循环依赖问题。如果这不正确，请告诉我。情况如下：

两个类，LogManager 和 DBSession。

DBSession 用于与数据库交互，LogManager 用于记录到文件。两者都在我的应用程序中广泛使用。创建 DBSession 实例时，必须通过构造函数参数为其提供 LogManager 实例。这是因为 DBSession 有时会将信息记录到文件中，并且会使用 LogManager 实例来执行此操作。

现在，我想扩展 LogManager 以便它也可以记录到数据库表，而不是文本文件。当然，我更喜欢重用现有的类，但我很快意识到这带来了一个有趣的情况。

DBSession 已经需要一个 LogManager 实例来构建。如果我想在 LogManager 中重用 DBSession 类，它现在需要一个 DBSession 实例。我怎样才能满足这两个要求？显然，我的方法一定有问题。

你会建议我如何解决这个问题？

提前谢谢各位。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-12T04:11:16.057

不要扩展 LogManager，让它成为一个聚合类型。并延迟选择要登录的位置，即：

```
$logManager = new LogManager();
$dbSession = new DbSession($logManager);
$logManager->add(new FileLog($filename) );
$logManager->add(new DBLog($dbSession) ); 
```

当然，FileLog 和 DBLog 共享一个通用接口。这是观察者模式的一个应用，其中 add() 是“订阅”操作，FileLog/DBLog 是日志事件的观察者。（通过这种方式，您还可以在许多地方保存日志。）

**欧文编辑**：调整为 php 语法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-12T04:11:25.167

其中一个对象实际上并不需要另一个：您猜对了，它是 DBSession。修改该对象，以便记录器可以在构造后附加到它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-12T04:14:28.640

为什么需要 LogManager 对象来创建 DbSession 对象，如果它只是有时写入文件？仅在需要时才延迟加载它。另外，在我看来，两者都应该相互独立。每个都可以在需要时实例化另一个。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T04:02:57.603

也许你可以应用一些模式，比如[单例模式](http://en.wikipedia.org/wiki/Singleton_pattern)，以确保你只有一个 LogManager 类的实例。

# objective-c - 是否可以在 Objective-C 中将 -init 方法设为私有？

> ID：195078
> 
> 赞同：152
> 
> 时间：2008-10-12T04:07:40.543
> 
> 标签：objective-c

我需要`-init`在 Objective-C 中隐藏（私有化）我的类的方法。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：358
> 
> 时间：2011-04-24T19:49:30.643

* * *

## 回答 #2

> 赞同：101
> 
> 时间：2014-12-29T17:08:15.107

Apple 已开始在其头文件中使用以下内容来禁用 init 构造函数：

```
- (instancetype)init NS_UNAVAILABLE; 
```

这在 Xcode 中正确显示为编译器错误。具体来说，这是在他们的几个 HealthKit 头文件中设置的（HKUnit 就是其中之一）。

* * *

## 回答 #3

> 赞同：89
> 
> 时间：2008-10-12T08:04:50.813

像 Smalltalk 一样，Objective-C 没有“私有”与“公共”方法的概念。任何消息都可以随时发送到任何对象。

`NSInternalInconsistencyException`如果您的`-init`方法被调用，您可以做的是抛出一个：

```
- (id)init {
    [self release];
    @throw [NSException exceptionWithName:NSInternalInconsistencyException
                                   reason:@"-init is not a valid initializer for the class Foo"
                                 userInfo:nil];
    return nil;
} 
```

另一种选择——在实践中可能要好得多——是尽可能`-init`为你的班级做一些有意义的事情。

如果您尝试这样做是因为您试图“确保”使用单例对象，请不要打扰。具体来说，不要为创建单例的“覆盖`+allocWithZone:`, `-init`, `-retain`, ”方法而烦恼。`-release`它几乎总是不必要的，只是增加了复杂性，并没有真正的显着优势。

相反，只需编写代码，使您的`+sharedWhatever`方法是访问单例的方式，并将其记录为在标题中获取单例实例的方式。在绝大多数情况下，这应该是您所需要的。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2017-08-11T07:58:58.923

您可以使用 . 声明任何方法不可用`NS_UNAVAILABLE`。

所以你可以把这些行放在你的@interface下面

```
- (instancetype)init NS_UNAVAILABLE;
+ (instancetype)new NS_UNAVAILABLE; 
```

* * *

更好地在您的前缀标头中定义一个宏

```
#define NO_INIT \
- (instancetype)init NS_UNAVAILABLE; \
+ (instancetype)new NS_UNAVAILABLE; 
```

和

```
@interface YourClass : NSObject
NO_INIT

// Your properties and messages

@end 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-12T05:47:27.097

如果您在谈论默认的 -init 方法，那么您不能。它是从 NSObject 继承的，每个类都会响应它而不会发出警告。

您可以创建一个新方法，例如 -initMyClass，并将其置于 Matt 建议的私有类别中。然后定义默认的 -init 方法以在调用时引发异常，或者（更好地）使用一些默认值调用您的私有 -initMyClass 。

人们似乎想要隐藏 init 的主要原因之一是[单例对象](http://developer.apple.com/documentation/Cocoa/Conceptual/CocoaFundamentals/CocoaObjects/chapter_3_section_10.html)。如果是这种情况，那么您不需要隐藏-init，只需返回单例对象（或者如果它尚不存在则创建它）。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-05-22T03:27:51.280

把它放在头文件中

```
- (id)init UNAVAILABLE_ATTRIBUTE; 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-12T04:43:52.137

这取决于您所说的“私有化”是什么意思。在 Objective-C 中，调用对象的方法可能更好地描述为向该对象发送消息。语言中没有任何内容禁止客户端调用对象上的任何给定方法。你能做的最好的就是不在头文件中声明方法。如果客户端仍然调用具有正确签名的“私有”方法，它仍将在运行时执行。

也就是说，在 Objective-C 中创建私有方法的最常见方法是在实现文件中创建一个[Category](http://developer.apple.com/documentation/Cocoa/Conceptual/ObjectiveC/Articles/chapter_4_section_1.html)，并在其中声明所有“隐藏”方法。请记住，这不会真正阻止调用`init`运行，但如果有人试图这样做，编译器会发出警告。

我的班级.m

```
@interface MyClass (PrivateMethods)
- (NSString*) init;
@end

@implementation MyClass

- (NSString*) init
{
    // code...
}

@end 
```

MacRumors.com 上有一个关于这个主题的不错的[帖子。](http://forums.macrumors.com/showthread.php?t=470056)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-12-08T13:48:39.840

那么为什么你不能让它“私有/不可见”的问题是因为init方法被发送到id（因为alloc返回一个id）而不是YourClass

请注意，从编译器（检查器）的角度来看，一个 id 可能会响应任何曾经键入的内容（它无法在运行时检查真正进入 id 的内容），因此只有在无处可隐藏时才可以隐藏 init（公开 = in标头）使用方法 init，而不是编译器知道，id 无法响应 init，因为任何地方都没有 init（在您的源代码中，所有库等...）

所以你不能禁止用户通过 init 并被编译器破坏......但你可以做的是通过调用 init 来阻止用户获取真实实例

只需实现 init，它返回 nil 并有一个（私有/不可见）初始化程序，该初始化程序的名称其他人不会得到（如 initOnce、initWithSpecial ...）

```
static SomeClass * SInstance = nil;

- (id)init
{
    // possibly throw smth. here
    return nil;
}

- (id)initOnce
{
    self = [super init];
    if (self) {
        return self;
    }
    return nil;
}

+ (SomeClass *) shared 
{
    if (nil == SInstance) {
        SInstance = [[SomeClass alloc] initOnce];
    }
    return SInstance;
} 
```

注意：有人可以这样做

```
SomeClass * c = [[SomeClass alloc] initOnce]; 
```

它实际上会返回一个新实例，但是如果我们项目中的 initOnce 不会在任何地方公开（在标头中）声明，它会生成一个警告（id 可能没有响应......）并且无论如何使用它的人都需要确切地知道真正的初始化程序是 initOnce

我们可以进一步防止这种情况，但没有必要

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-05-14T02:23:10.823

我不得不提到，放置断言和引发异常以隐藏子类中的方法对于善意的人来说是一个令人讨厌的陷阱。

我建议使用[Jano 在他的第一个示例中解释的](https://stackoverflow.com/a/5772821/2400328)`__unavailable`方法。

方法可以在子类中被覆盖。这意味着如果超类中的方法使用的方法只是在子类中引发异常，则它可能无法按预期工作。换句话说，你刚刚打破了过去的工作。初始化方法也是如此。这是这种相当常见的实现的示例：

```
- (SuperClass *)initWithParameters:(Type1 *)arg1 optional:(Type2 *)arg2
{
    ...bla bla...
    return self;
}

- (SuperClass *)initWithLessParameters:(Type1 *)arg1
{
    self = [self initWithParameters:arg1 optional:DEFAULT_ARG2];
    return self;
} 
```

想象一下，如果我在子类中这样做，-initWithLessParameters 会发生什么：

```
- (SubClass *)initWithParameters:(Type1 *)arg1 optional:(Type2 *)arg2
{
    [self release];
    [super doesNotRecognizeSelector:_cmd];
    return nil;
} 
```

这意味着您应该倾向于使用私有（隐藏）方法，尤其是在初始化方法中，除非您打算覆盖这些方法。但是，这是另一个话题，因为您并不总是可以完全控制超类的实现。（这让我质疑使用 __attribute((objc_designated_initializer)) 作为不好的做法，尽管我没有深入使用它。）

它还意味着您可以在必须在子类中覆盖的方法中使用断言和异常。（“抽象”方法，如[在 Objective-C 中创建抽象类](https://stackoverflow.com/questions/1034373/creating-an-abstract-class-in-objective-c)）

而且，不要忘记 +new 类方法。

# c# - 是否有通过电子邮件发送每日 C# 提示和技巧的网站？

> ID：195096
> 
> 赞同：8
> 
> 时间：2008-10-12T04:26:08.897
> 
> 标签：c#, newsletter

我从 www.sqlservercentral.com 订阅了我喜欢的时事通讯，因为每天我都会收到一封电子邮件摘要，其中包含一些有趣的标题和 SQL Server 文章的摘要，这些文章已经在网络上出现。这是一次学习一些新东西的好方法。

C#有这样的东西吗？

（如果你最喜欢的已经上架了，你能投票给它，让我看看最受欢迎的吗？谢谢！）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-12T04:51:14.370

除了[codeproject](http://www.codeproject.com/)，我相信还有其他站点，例如[C# Corner](http://www.c-sharpcorner.com/)，[C# help](http://www.csharphelp.com/)也可以这样做。

我发现更多有用的（不特定于 C#）：

[视觉工作室杂志](http://visualstudiomagazine.com/)

[多布博士的](http://www.ddj.com/newsletters/)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-12T06:53:46.540

你有没有考虑过订阅博客？您通常可以获得比每日订阅电子邮件更好的内容，如果您愿意，甚至可以通过评论成为讨论的一部分。[CodingBetter.com](http://codebetter.com/Default.aspx)和[Los](http://www.lostechies.com/) Techies通常有助于了解更多有关交易和 C# 的信息。如果您正在寻找更多是其他来源的集合的东西，[Scott Gu](http://weblogs.asp.net/Scottgu/)会定期列出一个链接列表，这些链接除了有用的浏览文章外，还可以提供非常丰富的信息。

祝你好运，

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-12T04:43:41.437

查看[wwww.codeproject.com](http://wwww.codeproject.com "www.codeproject.com")他们有很多文章和各种新闻通讯。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-12T10:40:44.197

您应该尝试[dotnetkicks.com](http://www.dotnetkicks.com/)，它提供了最相关的 .net 博客 (imho) 的漂亮 rss 提要。如果您希望通过电子邮件将 RSS-Feed 发送给您，请尝试[feedblitz](http://www.feedblitz.com/)或[xfruits](http://xfruits.com/)

# python - 在 Grails 与 Django 中运行 Web 应用程序

> ID：195101
> 
> 赞同：5
> 
> 时间：2008-10-12T04:36:49.203
> 
> 标签：python, django, grails, groovy, web-applications

我目前正处于 Web 应用程序的规划阶段，我发现自己正试图决定使用 Grails 还是 Django。从运营角度：

1.  哪个生态系统更易于维护（迁移、备份、灾难恢复等）？如果使用 grails，它可能是典型的 linux 上的 tomcat + mysql。如果是 django，它将是 linux 上的 apache + mysql。

2.  django 或 grails 是否有更好的廉价灵活托管选择？最初它可能是低带宽要求。我不确定所需的确切规格，但从我一直在阅读的内容来看，django 所需的服务器资源（甚至 256MB 服务器也可以）似乎比 grails 少得多。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-12T06:23:56.257

您可以在 256 兆内存中运行 grails。社区的许多成员都在这样做。话虽如此，我会说在任何一个平台上，您都需要比这更多的内存来确保您的性能。但我也可能建议查看 www.linode.com。您可以以非常合理的成本获得高质量的托管服务，并且为 grails 添加一点内存不会超出您的预算。此外，如果您对基于云的解决方案感兴趣，Morph 正在托管 grails 应用程序。 [http://developer.mor.ph/grails](http://developer.mor.ph/grails)

我喜欢 Django，但我选择 grails 是因为平台的成熟度和 Java 在库和框架方面的质量。事实上，我认为它们都是很好的解决方案，但你不能否认你的选择对于 grails 来说要大得多。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-13T22:44:52.253

使用 Java 托管，您不需要使用 apache 或 nginx 做所有愚蠢的技巧。Jetty 本身可以托管您需要的一切，这就是 www.mor.ph 的人所做的，他们发现它非常快。

这种方式的内存使用量非常小，我在 RapidXen 的 256MB Ubuntu 服务器上托管我的，所以每月大约 10 美元。

我尝试在 Django 中进行开发，虽然它可以更快地运行所有脚本（如引导程序或测试用例），但我认为它的设计并不好

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-13T13:34:41.630

我认为从运营的角度来看，事情将足够接近，您可以根据其他标准做出决定。如果您负担得起至少 256 MB RAM 的虚拟专用服务器，您将能够部署 Grails 应用程序。如果成本看起来很多，请查看 Sun。他们确实在根据他们的产品堆栈推动托管解决方案，并且有一些很棒的交易可用。我通过 Ostatic 从 Layered Tech 免费托管了一年。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-11-23T20:29:02.403

您可以在 EATJ 上廉价地托管 Grails 应用程序：http: [//smithnicholas.wordpress.com/2010/09/20/deploying-your-grails-application-on-eatj/](http://smithnicholas.wordpress.com/2010/09/20/deploying-your-grails-application-on-eatj/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-12T05:46:45.460

我认为 python 的托管要求往往较低（即 grails 需要 jvm，而大多数 el-cheapo 主机不提供 jvm，因为它们通常提供 python 支持）。加上谷歌应用引擎支持 django（在某种程度上）。

但如果你有面团，恕我直言，圣杯会好得多。

# python - 在 Vista 中以管理员身份运行已编译的 python (py2exe)

> ID：195109
> 
> 赞同：8
> 
> 时间：2008-10-12T04:46:16.627
> 
> 标签：python, windows-vista, permissions, py2exe

是否可以在 Vista 中以管理员身份以编程方式运行已编译的 Python（通过 py2exe 编译）？

更多说明：
我在 Vista 中编写了一个修改 windows 主机文件 (c:\Windows\system32\drivers\etc\hosts) 的程序，除非您右键单击并运行为即使用户具有管理员权限，管理员也是如此，不像在 XP 中，如果用户具有管理权限，它将运行，所以我需要一种以编程方式将其提升到正确权限的方法。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-09-18T16:15:43.213

按照`Python2x\Lib\site-packages\py2exe\samples\user_access_control`刚刚添加`uac_info="requireAdministrator"`到控制台或 Windows 字典的示例：

```
windows = [{
    'script': "admin.py",
    'uac_info': "requireAdministrator",
},] 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-12T08:55:22.693

您的意思是您希望 Windows 在程序运行时提示提升吗？这是通过将 UAC 清单添加到 EXE 的资源来控制的。[此博客条目](http://blogs.msdn.com/shawnfa/archive/2006/04/06/568563.aspx)介绍了如何创建清单以及如何将其编译为 .RES 文件。

我不知道 py2exe 用于嵌入自定义 .RES 文件的工具有哪些，因此您可能需要使用 Platform SDK 中的 MT.EXE 工具将清单嵌入您的程序中。MT.EXE 不需要 .RES 文件；它可以直接合并 .manifest 文件。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-12T22:17:44.150

跟进 Roger Lipscombe 的评论，我在 py2exe 中使用了一个清单文件，但对我在做什么没有任何真正的了解。所以这*可能*有效：

```
# in setup.py
# manifest copied from http://blogs.msdn.com/shawnfa/archive/2006/04/06/568563.aspx
manifest = '''
<assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">
       <asmv3:trustInfo xmlns:asmv3="urn:schemas-microsoft-com:asm.v3">
         <asmv3:security>
           <asmv3:requestedPrivileges>
             <asmv3:requestedExecutionLevel
               level="asInvoker"
               uiAccess="false" />
           </asmv3:requestedPrivileges>
         </asmv3:security>
       </asmv3:trustInfo>
     </assembly>
'''

setup(name='MyApp',
      #...
      windows=[ { #...
                  'other_resources':[(24, 1, manifest)],
                 }]
     ) 
```

你可能需要做一些摆弄虽然..

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-06-15T20:20:13.867

在这里可以找到 pyinstaller 的最佳解决方案：[Request UAC elevation from within a Python script?](https://stackoverflow.com/questions/130763/request-uac-elevation-from-within-a-python-script/41930586#41930586)

对 exe 清单文件的任何操作都不会起作用。使用 if else 语句在 python 代码中处理 uac

# c# - C#中的自定义按钮：如何删除悬停背景？

> ID：195114
> 
> 赞同：9
> 
> 时间：2008-10-12T04:56:27.527
> 
> 标签：c#, .net, winforms, button

我正在尝试使用 Visual Studio 2005 为我的表单（具有 FormBorderStyle = none）做一个自定义按钮。我在一个链接到该按钮的 ImageList 中有我的 3 个状态按钮图像。

```
this.btnClose.AutoSize = false;
this.btnClose.BackColor = System.Drawing.Color.Transparent;
this.btnClose.BackgroundImageLayout = System.Windows.Forms.ImageLayout.Center;
this.btnClose.FlatAppearance.BorderSize = 0;
this.btnClose.FlatStyle = System.Windows.Forms.FlatStyle.Flat;
this.btnClose.ForeColor = System.Drawing.Color.Transparent;
this.btnClose.ImageKey = "Disabled";
this.btnClose.ImageList = this.imageList1;
this.btnClose.Location = new System.Drawing.Point(368, -5);
this.btnClose.Margin = new System.Windows.Forms.Padding(0);
this.btnClose.Name = "btnClose";
this.btnClose.Size = new System.Drawing.Size(31, 31);
this.btnClose.TabIndex = 0;
this.btnClose.UseVisualStyleBackColor = false;
this.btnClose.MouseLeave += new System.EventHandler(this.btnClose_MouseLeave);
this.btnClose.Click += new System.EventHandler(this.btnClose_Click);
this.btnClose.MouseDown += new System.Windows.Forms.MouseEventHandler(this.btnClose_MouseDown);
this.btnClose.MouseHover += new System.EventHandler(this.btnClose_MouseHover);

private void btnClose_MouseHover(object sender, EventArgs e)
{
    btnClose.ImageKey = "enabled";
}

private void btnClose_MouseDown(object sender, MouseEventArgs e)
{
    btnClose.ImageKey = "down";
}

private void btnClose_MouseLeave(object sender, EventArgs e)
{
    btnClose.ImageKey = "disabled";
} 
```

一切正常，但有一个问题。每当我移动鼠标悬停按钮时，我都会得到一个非常烦人的灰色背景。

我怎样才能删除它？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2010-06-01T15:27:54.133

```
btnClose.FlatAppearance.MouseOverBackColor = System.Drawing.Color.Transparent; 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-12T05:17:01.557

灰色背景是由于“System.Windows.Forms.FlatStyle.Flat”的设置，这是默认行为，因为它需要在悬停时突出显示按钮。为了消除这种情况，您可能必须编写一个自定义按钮类，从原始按钮继承并进行一些自定义绘画来实现这一点。

顺便说一句，您应该在 MouseHover 中设置，而不是在 MouseHover 中设置“启用”。MouseEnter 和 MouseLeave 是一对指示鼠标是否在按钮内，并且每次进入/退出都会触发一次。每当鼠标在按钮内移动时，MouseHover 就会触发，这会创建不必要的“启用”重复设置。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-12T22:10:48.983

我已经使用标签而不是按钮解决了这个问题。

```
// 
// imageListButtons
// 
this.imageListButtons.ImageStream = ((System.Windows.Forms.ImageListStreamer)(resources.GetObject("imageListButtons.ImageStream")));
this.imageListButtons.TransparentColor = System.Drawing.Color.Transparent;
this.imageListButtons.Images.SetKeyName(0, "close_normal");
this.imageListButtons.Images.SetKeyName(1, "close_hover");
// 
// lblClose
// 
this.lblClose.Anchor = ((System.Windows.Forms.AnchorStyles)((System.Windows.Forms.AnchorStyles.Top | System.Windows.Forms.AnchorStyles.Right)));
this.lblClose.BackColor = System.Drawing.Color.Transparent;
this.lblClose.ImageKey = "close_normal";
this.lblClose.ImageList = this.imageListButtons;
this.lblClose.Location = new System.Drawing.Point(381, 7);
this.lblClose.Margin = new System.Windows.Forms.Padding(0);
this.lblClose.Name = "lblClose";
this.lblClose.Size = new System.Drawing.Size(12, 12);
this.lblClose.TabIndex = 0;
this.lblClose.MouseLeave += new System.EventHandler(this.lblClose_MouseLeave);
this.lblClose.MouseClick += new System.Windows.Forms.MouseEventHandler(this.lblClose_MouseClick);
this.lblClose.MouseEnter += new System.EventHandler(this.lblClose_MouseEnter);

private void lblClose_MouseEnter(object sender, EventArgs e)
{
    lblClose.ImageKey = "close_hover";
}

private void lblClose_MouseLeave(object sender, EventArgs e)
{
    lblClose.ImageKey = "close_normal";
}

private void lblClose_MouseClick(object sender, MouseEventArgs e)
{
    this.Close();
} 
```

PS：请注意，我现在使用的是两个状态按钮，而不是三个。这是有意的（我知道我仍然可以使用三个）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-12-20T23:32:28.703

创建下面给出的鼠标输入事件。

```
private void forAllButtons_MouseEnter(object sender, EventArgs e)
{
    Button b = (Button)sender;
    b.FlatAppearance.MouseOverBackColor = System.Drawing.Color.Transparent;
} 
```

然后将此事件分配给所有按钮。

快乐编程:)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-09-23T01:34:57.870

我有一个建议。创建您自己的从 Button 派生的按钮类。然后覆盖其中的 MouseEnter 事件。只需删除用于调用基本实现的代码。

```
base.OnMouseEnter(e) 
```

PS：您将无法在派生类之外使用 MouseEnter 事件（例如使用此控件的项目）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-03-12T12:58:28.390

嗨，您只需使用这两行代码轻松地将这些更改应用于您的按钮。

1.  将按钮的 FlatStyle 设置为 Flat

    ```
    this.btnClose.FlatStyle = FlatStyle.Flat; 
    ```

2.  将按钮的 MouseOverBackColor 设置为透明

    ```
    this.btnClose.FlatAppearance.MouseOverBackColor = Color.Transparent; 
    ```

希望这会有所帮助。谢谢

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-05-08T16:36:26.840

您还可以通过取消选择按钮属性>常用> IsHitTestVisible中的IsHitTestVisible选项来停止更改按钮的颜色也许这也可以帮助...

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2017-09-03T23:41:31.127

要解决此问题，请将 MouseOverBackColor 设置为透明以去除灰色背景。

# python - 有没有比 python 的 Decimal 更快的替代品？

> ID：195116
> 
> 赞同：17
> 
> 时间：2008-10-12T05:03:05.843
> 
> 标签：python, python-decimal

有谁知道python中更快的十进制实现？

如下例所示，标准库的十进制模块比`float`.

```
from  timeit import Timer

def run(val, the_class):
    test = the_class(1)
    for c in xrange(10000):
        d = the_class(val)
        d + test
        d - test
        d * test
        d / test
        d ** test
        str(d)
        abs(d)    

if __name__ == "__main__":
    a = Timer("run(123.345, float)", "from decimal_benchmark import run")
    print "FLOAT", a.timeit(1)
    a = Timer("run('123.345', Decimal)", "from decimal_benchmark import run; from decimal import Decimal")
    print "DECIMAL", a.timeit(1) 
```

*输出：*

```
FLOAT 0.040635041427
DECIMAL 3.39666790146 
```

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2011-11-19T08:47:41.700

您可以尝试[cdecimal](http://www.bytereef.org/mpdecimal/index.html)：

```
from cdecimal import Decimal 
```

从 Python 3.3 开始，cdecimal 实现现在是标准库模块的内置实现`decimal`，因此您无需安装任何东西。只需使用`decimal`.

对于 Python 2.7，安装`cdecimal`和使用它而不是`decimal`应该提供类似于 Python 3 默认获得的加速。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-12T05:11:37.947

[GMP](http://gmplib.org)库是最好的任意精度数学库之一，在 GMPY 上有一个Python[绑定](http://www.aleax.it/gmpy.html)。我会尝试这种方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-12T05:55:38.843

您应该将*Decimal*与*Long Integer*性能进行比较，而不是浮点。如今，浮点主要是硬件。*Decimal*用于**十进制精度**，而*Floating Point*用于更广泛的范围。使用*十进制*包进行货币计算。

引用*十进制*包手册：

> 十进制数可以精确表示。相反，像 1.1 这样的数字在二进制浮点中没有精确的表示。最终用户通常不会期望 1.1 显示为 1.1000000000000001，因为它使用二进制浮点数。
> 
> 精确性延续到算术上。在十进制浮点中，“0.1 + 0.1 + 0.1 - 0.3”正好等于零。在二进制浮点中，结果为 5.5511151231257827e-017。虽然接近于零，但差异会阻止可靠的相等性测试，并且差异会累积。出于这个原因，在具有严格等式不变量的会计应用程序中，十进制将是首选。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-06-25T12:33:07.310

使用[cDecimal](http://www.bytereef.org/mpdecimal/index.html)。

将以下内容添加到您的基准测试中：

```
a = Timer("run('123.345', Decimal)", "import sys; import cdecimal; sys.modules['decimal'] = cdecimal; from decimal_benchmark import run; from decimal import Decimal")
print "CDECIMAL", a.timeit(1) 
```

我的结果是：

```
FLOAT 0.0257983528473
DECIMAL 2.45782495288
CDECIMAL 0.0687125069413 
```

（Python 2.7.6/32、Win7/64、AMD 速龙 II 2.1GHz）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-12-14T10:04:14.223

python Decimal 非常慢，可以使用 float 或 Decimal cDecimal 的更快实现。

# c# - 如何在实体框架中设置 SQL Server 2008 的登录信息？

> ID：195117
> 
> 赞同：0
> 
> 时间：2008-10-12T05:03:12.567
> 
> 标签：c#, .net, entity-framework, sql-server-2008, connection-string

好的，我仍在学习使用实体框架的技巧，并且遇到了另一个小问题。

当我从 SQL Server 2008 数据库创建实体模型时，它会警告我将登录信息保存在配置文件的连接字符串中。最初我并不担心，所以我把它留在了那里，但现在我想开始考虑部署。因此，如果我遵循该建议并且不在连接字符串中包含登录信息，那么我以后还能如何设置该信息以便它可以登录到数据库服务器？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-12T05:09:56.533

看一下这个：

*   [安全注意事项（实体框架）](http://msdn.microsoft.com/en-us/library/cc716760.aspx)
*   [加密与 SQL Server 的连接](http://technet.microsoft.com/en-us/library/ms189067.aspx)
*   [使用受保护的配置加密配置信息](http://msdn.microsoft.com/en-us/library/53tyfkaw.aspx)

# ajax - 跨平台丰富的用户界面开发有哪些可用的选项？

> ID：195133
> 
> 赞同：3
> 
> 时间：2008-10-12T05:31:43.930
> 
> 标签：ajax, user-interface, real-time, dashboard

这种 ui 框架/工具包的一些要求（限制）是：

*   没有单一供应商锁定
*   实时数据可视化能力
*   良好的初始小部件
*   良好的仪表板功能
*   跨平台
*   良好的开发/调试环境
*   无闪光灯

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-12T07:00:33.780

很遗憾您不能/不会使用 Flash。否则我真的可以推荐 Adob​​e AIR。它有一个很好的编辑器（基于 Eclipse 构建的 Flex Builder），一个很好的组件框架，有许多开箱即用的组件，图表组件集，与许多不同协议通信的能力（你可以编写自己的协议实现），跨平台，在 AIR 运行时而不是在浏览器、文件 IO 中运行，...

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-12T07:28:08.640

如果没有仔细考虑，我不会忽略 Flex/Air (Flash)，但这里有一些我遇到的其他问题：

*   [wxWidgets](http://www.wxwidgets.org/)
*   [GTK+](http://www.gtk.org/)
*   [Qt](http://trolltech.com/)

还有一个[slashdot 帖子](http://ask.slashdot.org/article.pl?sid=00/06/02/025232&mode=thread)，其中包含一些我没听说过的 takeits 的链接。我将在这里添加他们的建议：

*   [GLUI](http://www.cs.unc.edu/~rademach/glui/)，一个基于 OpenGL 的 GUI
*   [Whisper](http://www.halcyon.com/www3/jesjones/Whisper/Home.html) , Mac/Windows 应用程序框架
*   [WxWindows](http://web.ukonline.co.uk/julian.smart/wxwin/) , 一个支持 Windows 3.1/95/98/NT, 和带有 GTK/Motif/Lesstif 的 Unix 和 MacOS 的框架
*   [YAAF](http://www.pandawave.com/yaaf1.html)，Yet another Application Framework，为 Macintosh OS、Windows 95 和 Windows NT 以及 X Windows 提供支持
*   [CPLAT](http://www.ksoft.net/cp_home.htm)，用于开发 MacOS 和 Windows（即将推出 Linux）应用程序的框架
*   Ardi 的[Carbonless Copies 技术](http://ftp.ardi.com/cc/faq.html/)，这是对大部分 MacOS API 的可移植重写

一般信息：

*   [GUI 工具包/框架页面](http://www.geocities.com/SiliconValley/Vista/7184/guitool.html#free_toolkit)
*   [PIGUI 常见问题页面](http://www.zeta.org.au/~rosko/pigui.htm)
*   [C++ 用户日志 PIGUI 页面](http://www.cuj.com/link/subject21.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-12T08:00:20.480

我可能会推荐 Mozilla XUL，但它有一些缺点：

*   没有真正好的开发/调试环境（尽管有工具和调试器；它们是可变的）
*   您被锁定在供应商中，但它是 Mozilla。

虽然它非常易于使用，并且允许您将 Web Javascript 技能重用于富客户端应用程序。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T07:38:50.147

当然还有Java。它满足您对 AFAICS 的所有要求。大量的自定义图表控件，您很难为 GTK/WxWindows/$other_small_userbase_framework 找到这些控件。

如果你不喜欢 Swing（它已经走了很长一段路——Metal 已经死了，SystemDefault L&F 万岁！），有像 SWT 甚至是用于 java（QTJambi）的 QT 绑定之类的选项。

对于 C 或 C++ go QT，它的 API 非常好。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-12T09:05:07.680

对于 RCA，请查看[Eclipse RCP](http://wiki.eclipse.org/index.php/Rich_Client_Platform)。对于 RIA，您可能对[OpenLaszlo](http://www.openlaszlo.org/)感兴趣。它是一个富互联网平台，可以编译为 Flash 和 DHTML。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-12T09:05:31.703

[http://www.gnustep.org/](http://www.gnustep.org/)

> “GNUstep 是一个用于桌面应用程序开发的跨平台、面向对象的框架。基于最初由 NeXT（现为 Apple）创建的 OpenStep 规范，GNUstep 使开发人员能够通过使用大量可重用软件组件库来快速构建复杂的软件。”

可移植到：*Windows、基于 BSD 的系统、基于 Linux 的系统、HP/UX、、Solaris、Sparc、GNUstep Solaris 10 U2 vmware 设备、OpenSolaris 等。*

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-20T21:13:23.963

我最近在这里做了一个非常完整的列表：http: [//commadot.com/ria-frameworks/](http://commadot.com/ria-frameworks/)

ExtJS 可能是我最喜欢的，我们在工作中使用它。我认为它满足你的清单。否则，该页面上还有许多其他可能性。

# javascript - 是否可以对在浏览器中运行的 JavaScript 进行沙箱处理？

> ID：195149
> 
> 赞同：158
> 
> 时间：2008-10-12T06:17:40.280
> 
> 标签：javascript, browser, sandbox

我想知道是否可以对在浏览器中运行的 JavaScript 进行沙箱处理，以防止访问 HTML 页面中运行的 JavaScript 代码通常可用的功能。

例如，假设我想为最终用户提供一个 JavaScript API，让他们定义在“有趣事件”发生时运行的事件处理程序，但我不希望这些用户访问`window`对象的属性和函数。我能做到吗？

在最简单的情况下，假设我想阻止用户调用`alert`. 我能想到的几种方法是：

*   `window.alert`在全球范围内重新定义。我认为这不是一种有效的方法，因为页面中运行的其他代码（即，不是由用户在其事件处理程序中编写的东西）可能想要使用`alert`.
*   将事件处理程序代码发送到服务器进行处理。我不确定将代码发送到服务器进行处理是正确的方法，因为事件处理程序需要在页面的上下文中运行。

服务器处理用户定义的函数然后生成要在客户端执行的回调的解决方案也许可行？即使这种方法有效，是否有更好的方法来解决这个问题？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-10-12T07:35:28.843

[Google Caja](https://github.com/google/caja) is a source-to-source translator that "allows you to put untrusted third-party HTML and JavaScript inline in your page and still be secure."

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-10-12T20:56:33.547

看看[Douglas Crockford 的 ADsafe](http://www.adsafe.org/)：

> ADsafe 可以安全地将访客代码（例如第三方脚本广告或小部件）放在任何网页上。ADsafe 定义了一个足够强大的 JavaScript 子集，允许访客代码执行有价值的交互，同时防止恶意或意外损坏或入侵。ADsafe 子集可以通过 JSLint 等工具进行机械验证，因此无需人工检查即可检查访客代码的安全性。ADsafe 子集还强制执行良好的编码实践，增加来宾代码正确运行的可能性。

[您可以通过查看项目 GitHub 存储库](https://github.com/douglascrockford/ADsafe)`template.html`中的和`template.js`文件来查看如何使用 ADsafe 的示例。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-06-21T20:39:46.457

我创建了一个名为[jsandbox](https://github.com/eligrey/jsandbox)的沙盒库，它使用网络工作者对评估代码进行沙盒处理。它还有一个输入方法，用于显式提供它无法获得的沙盒代码数据。

以下是 API 的示例：

```
jsandbox
    .eval({
      code    : "x=1;Math.round(Math.pow(input, ++x))",
      input   : 36.565010597564445,
      callback: function(n) {
          console.log("number: ", n); // number: 1337
      }
  }).eval({
      code   : "][];.]\\ (*# ($(! ~",
      onerror: function(ex) {
          console.log("syntax error: ", ex); // syntax error: [error object]
      }
  }).eval({
      code    : '"foo"+input',
      input   : "bar",
      callback: function(str) {
          console.log("string: ", str); // string: foobar
      }
  }).eval({
      code    : "({q:1, w:2})",
      callback: function(obj) {
          console.log("object: ", obj); // object: object q=1 w=2
      }
  }).eval({
      code    : "[1, 2, 3].concat(input)",
      input   : [4, 5, 6],
      callback: function(arr) {
          console.log("array: ", arr); // array: [1, 2, 3, 4, 5, 6]
      }
  }).eval({
      code    : "function x(z){this.y=z;};new x(input)",
      input   : 4,
      callback: function(x) {
          console.log("new x: ", x); // new x: object y=4
      }
  }); 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2016-05-11T06:34:16.517

[RyanOHara 的网络工作者沙箱代码](https://stackoverflow.com/questions/195149/is-it-possible-to-sandbox-javascript-running-in-the-browser/24562400#24562400)的改进版本，在**单个文件**中（不需要额外的`eval.js`文件）。

```
function safeEval(untrustedCode)
{
    return new Promise(function (resolve, reject)
        {
            var blobURL = URL.createObjectURL(new Blob([
                "(",
                function ()
                {
                    var _postMessage = postMessage;
                    var _addEventListener = addEventListener;

                    (function (obj)
                    {
                        "use strict";

                        var current = obj;
                        var keepProperties =
                        [
                            // Required
                            'Object', 'Function', 'Infinity', 'NaN', 'undefined', 'caches', 'TEMPORARY', 'PERSISTENT',
                            // Optional, but trivial to get back
                            'Array', 'Boolean', 'Number', 'String', 'Symbol',
                            // Optional
                            'Map', 'Math', 'Set',
                        ];

                        do
                        {
                            Object.getOwnPropertyNames(current).forEach(function (name)
                            {
                                if (keepProperties.indexOf(name) === -1)
                                {
                                    delete current[name];
                                }
                            });

                            current = Object.getPrototypeOf(current);
                        }
                        while (current !== Object.prototype)
                            ;

                    })(this);

                    _addEventListener("message", function (e)
                    {
                        var f = new Function("", "return (" + e.data + "\n);");
                        _postMessage(f());
                    });
                }.toString(),
                ")()"],
                {type: "application/javascript"}));

                var worker = new Worker(blobURL);

                URL.revokeObjectURL(blobURL);

                worker.onmessage = function (evt)
                {
                    worker.terminate();
                    resolve(evt.data);
                };

                worker.onerror = function (evt)
                {
                    reject(new Error(evt.message));
                };

                worker.postMessage(untrustedCode);

                setTimeout(function ()
                {
                    worker.terminate();
                    reject(new Error('The worker timed out.'));
                }, 1000);
        });
} 
```

测试它：

[https://jsfiddle.net/kp0cq6yw/](https://jsfiddle.net/kp0cq6yw/)

```
var promise = safeEval("1+2+3");

promise.then(function (result) {
                 alert(result);
             }); 
```

它应该输出`6`（在 Chrome 和 Firefox 中测试）。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2014-09-18T15:10:02.533

正如其他响应中提到的，将代码放入沙盒 iframe 中（无需将其发送到服务器端）并与消息通信就足够了。

我建议看一下我创建的[一个小型库](https://github.com/asvd/jailed)，主要是因为需要为不受信任的代码提供一些 API，就像问题中描述的那样：有机会将特定的函数集直接导出到沙箱中不受信任的代码运行。还有一个演示在沙箱中执行用户提交的代码：

[http://asvd.github.io/jailed/demos/web/console/](http://asvd.github.io/jailed/demos/web/console/)

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2014-07-03T20:01:48.640

我认为[js.js](https://github.com/jterrace/js.js)在这里值得一提。它是用 JavaScript 编写的 JavaScript 解释器。

它比原生 JavaScript 慢大约 200 倍，但它的本质使它成为一个完美的沙盒环境。另一个缺点是它的大小 - 几乎 600 KB，在某些情况下对于台式机来说可能是可以接受的，但对于移动设备来说则不行。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-10-12T07:25:44.043

All the browser vendors and the HTML5 specification are working towards an actual sandbox property to allow sandboxed iframes -- but it's still limited to iframe granularity.

In general, no degree of regular expressions, etc. can safely sanitise arbitrary user provided JavaScript as it degenerates to the halting problem :-/

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-08-11T13:44:30.017

与内置浏览器实现的封闭版本相比，独立的 JavaScript 解释器更有可能产生健壮的沙箱。

Ryan[已经提到](https://stackoverflow.com/a/24562400/120398) [过 js.js](https://github.com/jterrace/js.js)，但更新的项目是[JS-Interpreter](https://github.com/NeilFraser/JS-Interpreter)。[该文档](https://neil.fraser.name/software/JS-Interpreter/docs.html)涵盖了如何向解释器公开各种功能，但其范围非常有限。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-03-06T03:39:32.943

一种丑陋的方式，但也许这对你有用：

我获取了所有全局变量并在沙盒范围内重新定义了它们，同时我添加了严格模式，因此它们无法使用匿名函数获取全局对象。

```
function construct(constructor, args) {
  function F() {
      return constructor.apply(this, args);
  }
  F.prototype = constructor.prototype;
  return new F();
}
// Sanboxer
function sandboxcode(string, inject) {
  "use strict";
  var globals = [];
  for (var i in window) {
    // <--REMOVE THIS CONDITION
    if (i != "console")
    // REMOVE THIS CONDITION -->
    globals.push(i);
  }
  globals.push('"use strict";\n'+string);
  return construct(Function, globals).apply(inject ? inject : {});
}
sandboxcode('console.log( this, window, top , self, parent, this["jQuery"], (function(){return this;}()));');
// => Object {} undefined undefined undefined undefined undefined undefined
console.log("return of this", sandboxcode('return this;', {window:"sanboxed code"}));
// => Object {window: "sanboxed code"} 
```

[https://gist.github.com/alejandrolechuga/9381781](https://gist.github.com/alejandrolechuga/9381781)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-08-07T09:46:08.013

截至 2019 年，[vm2](https://www.npmjs.com/package/vm2)看起来是*在 Node.js*中运行 JavaScript 的最流行和最经常更新的解决方案。我不知道前端解决方案。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-05-20T14:44:11.827

使用[NISP](https://github.com/ysmood/nisp)，您将能够进行沙盒评估。

尽管您编写的表达式并不完全是 JavaScript 代码，但您将编写[S-expressions](https://en.wikipedia.org/wiki/S-expression)。它非常适合不需要大量编程的简单[DSL 。](https://en.wikipedia.org/wiki/Domain-specific_language)

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2008-10-12T09:32:36.220

1.  Suppose you have code to execute:

    ```
     var sCode = "alert(document)"; 
    ```

    Now, suppose you want to execute it in a sandbox:

    ```
     new Function("window", "with(window){" + sCode + "}")({}); 
    ```

    These two lines when executed will fail, because "alert" function is not available from the "sandbox"

2.  And now you want to expose a member of window object with your functionality:

    ```
     new Function("window", "with(window){" + sCode + "}")({
         'alert':function(sString){document.title = sString}
     }); 
    ```

* * *

Indeed you can add quotes escaping and make other polishing, but I guess the idea is clear.

* * *

## 回答 #13

> 赞同：-4
> 
> 时间：2008-10-12T06:44:04.690

这个用户 JavaScript 代码来自哪里？

对于用户将代码嵌入到您的页面然后从他们的浏览器调用它（请参阅[Greasemonkey](https://en.wikipedia.org/wiki/Greasemonkey)），您无能为力。这只是浏览器所做的事情。

但是，如果您将脚本存储在数据库中，然后检索它并对其进行 eval()，那么您可以在脚本运行之前对其进行清理。

删除所有窗口的代码示例。和文件。参考：

```
 eval(
  unsafeUserScript
    .replace(/\/\/.+\n|\/\*.*\*\/, '') // Clear all comments
    .replace(/\s(window|document)\s*[\;\)\.]/, '') // Removes window. Or window; or window)
 ) 
```

这试图阻止执行以下操作（未测试）：

```
window.location = 'http://example.com';
var w = window; 
```

您必须对不安全的用户脚本应用很多限制。不幸的是，没有任何可用于 JavaScript 的“沙盒容器”。

* * *

## 回答 #14

> 赞同：-5
> 
> 时间：2009-05-20T14:10:09.137

我一直在研究一个简单的 JavaScript 沙箱，让用户为我的网站构建小程序。尽管在允许 DOM 访问方面我仍然面临一些挑战（parentNode 只是不会让我保持安全 =/），但我的方法只是用一些有用/无害的成员重新定义 window 对象，然后 eval() 用户将此重新定义的窗口作为默认范围的代码。

我的“核心”代码是这样的......（我没有完全展示它;）

```
function Sandbox(parent){

    this.scope = {
        window: {
            alert: function(str){
                alert("Overriden Alert: " + str);
            },
            prompt: function(message, defaultValue){
                return prompt("Overriden Prompt:" + message, defaultValue);
            },
            document: null,
            .
            .
            .
            .
        }
    };

    this.execute = function(codestring){

        // Here some code sanitizing, please

        with (this.scope) {
            with (window) {
                eval(codestring);
            }
        }
    };
} 
```

因此，我可以实例化一个沙盒并使用它的*execute()*函数来运行代码。此外，eval 代码中所有新声明的变量最终都将绑定到 execute() 范围，因此不会出现名称冲突或与现有代码混淆。

尽管全局对象仍然可以访问，但那些对沙盒代码仍然未知的对象必须在 Sandbox::scope 对象中定义为代理。

* * *

## 回答 #15

> 赞同：-6
> 
> 时间：2008-10-12T06:26:01.213

您可以将用户的代码包装在一个函数中，该函数将禁止对象重新定义为参数——然后`undefined`在调用这些对象时：

```
(function (alert) {

alert ("uh oh!"); // User code

}) (); 
```

当然，聪明的攻击者可以通过检查 JavaScript DOM 并找到一个包含对窗口的引用的非覆盖对象来绕过这个问题。

* * *

[另一个想法是使用JSLint](http://www.jslint.com/)之类的工具扫描用户的代码。确保将其设置为没有预设变量（或：只有您想要的变量），然后如果设置或访问了任何全局变量，则不要使用用户的脚本。同样，它可能容易受到 DOM 遍历的影响——用户可以使用字面量构造的对象可能具有对可以访问以逃避沙箱的 window 对象的隐式引用。

# apache-flex - 如何从 SWFLoader 中的 SWF 向父 Flex 应用程序引发事件？

> ID：195150
> 
> 赞同：2
> 
> 时间：2008-10-12T06:18:47.593
> 
> 标签：apache-flex, event-handling, events, swfloader

如何从加载到 Flex 应用程序（使用 SWFLoader）的 SWF 文件中引发事件？

我希望能够检测到

```
a) when a button is pressed
b) when the animation ends 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-12T06:55:39.063

你需要做两件事：

1.  从加载的 swf 调度一个事件。如果您从嵌套视图发送事件，请确保事件冒泡。冒泡可以通过事件的气泡属性来设置。
2.  从您的主应用程序监听事件。我认为您应该能够在 SWFLoader 实例的 content 属性上执行此操作。

    ```
    mySWFLoader.content.addEventListener("myEvent", myEventHandler); 
    ```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-12T20:22:19.403

我采取了一种更懒惰的方法来在 Flash 中引发事件

## 柔性：

```
<mx:SWFLoader  source="homeanimations/tired.swf"  id="swfTired" complete="swfTiredLoaded(event)" />

private function swfTiredLoaded(event:Event): void {
     mySWFLoader.content.addEventListener("continueClicked", continueClickedHandler);
} 
```

## 闪光：

```
dispatchEvent(new Event("continueClicked", true, true)); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-05-10T11:38:17.133

我相信这是因为您将创建两个单独的自定义事件类，一个在 Flash 中，另一个在 Flex 中。Flex 可能无法理解从 Flash 调度一个 EV_NOTIFY.ANIMATION_ENDED，因为它有自己的 EV_NOTIFY.ANIMATION_ENDED 版本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-12T08:55:51.613

As an adjunct to the answer by Christophe Herreman, and in case you were wondering, here is a way of making your own events...

```
package yourpackage.events
{
    import flash.events.Event;

    [Event(name="EV_Notify", type="yourpackage.events.EV_Notify")]
    public class EV_Notify extends Event
    {
        public function EV_Notify(bubbles:Boolean=true, cancelable:Boolean=false)
        {
            super("EV_Notify", bubbles, cancelable);
        }

    }
} 
```

I have taken the liberty of setting the default value of `bubbles` to true and passing the custom event type to the super constructor by default, so you can then just say...

```
dispatchEvent(new EV_Notify()); 
```

In your particular case I doubt there are times when you would not want your event to bubble.

The prefix `EV_` on the name is my own convention for events so I can easily find them in the code completion popups, you'll obviously pick your own name.

For the two cases you cite you can either have two events and listen for both of them, or add a property to the event which says what just happened, which is the approach which is taken by controls like `Alert`...

```
package yourpackage.events
{
    import flash.events.Event;

    [Event(name="EV_Notify", type="yourpackage.events.EV_Notify")]
    public class EV_Notify extends Event
    {
        public static var BUTTON_PRESSED:int = 1;
        public static var ANIMATION_ENDED:int = 2;

        public var whatHappened:int;

        public function EV_Notify(whatHappened:int, bubbles:Boolean=true, cancelable:Boolean=false)
        {
            this.whatHappened = whatHappened;
            super("EV_Notify", bubbles, cancelable);
        }

    }
} 
```

then you call it as follows...

```
dispatchEvent(new EV_Notify(EV_NOTIFY.ANIMATION_ENDED)); 
```

you can then inspect the whatHappened field in your event handler.

```
private function handleNotify(ev:EV_Notify):void
{
    if (ev.whatHappened == EV_Notify.ANIMATION_ENDED)
    {
        // do something
    }
    else if (ev.whatHappened == EV_Notify.BUTTON_PRESSED)
    {
        // do something else
    }
    etc...
} 
```

HTH

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-30T12:43:42.277

我无法使用最后一种方法（使用 Flash CS4 和 Flex 3）。我将 dispatchEvent 调用放在 Flash 动画的最后一帧中，但无法在 Flex 中获取。

我使用了一个计数器变量并递增，直到我使用 ENTER_FRAME 事件达到已知的最后一帧编号 - 我可以使用几乎相同的代码来获取它。

如果我可以选择这个，那为什么我不能选择自定义事件呢？

# wpf - 如何使用 WPF 数据绑定处理外键？

> ID：195151
> 
> 赞同：2
> 
> 时间：2008-10-12T06:20:59.883
> 
> 标签：wpf, data-binding

我在 WPF 中有一个 ListView，它数据绑定到我从数据库中提取的基本表。ListView 的代码如下：

```
<ListView Canvas.Left="402" Canvas.Top="480" Height="78" ItemsSource="{Binding}" Name="lsvViewEditCardPrint" Width="419">
   <ListView.View>
      <GridView>
         <GridViewColumn DisplayMemberBinding="{Binding Path=IdCst}">Set</GridViewColumn>
         <GridViewColumn DisplayMemberBinding="{Binding Path=Language}">Language</GridViewColumn>
         <GridViewColumn DisplayMemberBinding="{Binding Path=Number}">Number</GridViewColumn>
         <GridViewColumn DisplayMemberBinding="{Binding Path=IdArt}">Artwork</GridViewColumn>
      </GridView>
   </ListView.View>
</ListView> 
```

IdCst 列是单独表的外键，我想显示该表中的实际名称字段，而不仅仅是 Id。有谁知道如何设置数据绑定，或者是否有一个事件，例如 OnItemDataBound，我可以拦截以修改显示？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-12T07:07:07.933

这篇博[文](http://almosteric.wordpress.com/2008/06/24/databinding-to-foreign-keys-in-wpf/)可能会有所帮助：

> ...我假设外键应该绑定到“SelectedValue”属性，并且有一个 ItemSource 可以绑定到我的事实表，以便填充下拉列表。
> 
> 此时我的下拉菜单有效，但组合框中不会出现任何内容。我终于注意到了一个“SelectedItemPath”属性——我认为这将是下拉列表中与我的外键关联的字段的名称。果然，就是这样。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-13T15:36:58.573

我会在您的基础类中添加一个新属性：

```
Public ReadOnly Property NameCst() as String
    Get
        Return Names.LookupName(Me.IdCst)
    End Get
End Property 
```

或类似的东西。请注意，您可能必须在“NameCst”的 .IdCst 设置器中包含 Notify Property Changed 事件。

另一种方法是编写一个 ValueConverter 来进行查找，但这对于如此简单的事情来说是相当沉重的。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-23T18:48:45.517

嘘！

我查看了此处的示例，从此处的其他帖子中挖掘了一些参考资料，并找到了答案... IValueConverter ... 一个可与 WPF 一起使用的接口，它将在绑定点转换值。一开始组装起来有点棘手，但并不难。

第一步是创建一个实现 IValueConverter 接口的简单查找或转换器类。对于我的解决方案，我这样做了：

```
Namespace TCRConverters

   Public Class SetIdToNameConverter
      Implements IValueConverter

      Public Function Convert(ByVal value As Object, ByVal targetType As System.Type, ByVal parameter As Object, ByVal culture As System.Globalization.CultureInfo) As Object Implements System.Windows.Data.IValueConverter.Convert
         Dim taCardSet As New TCRTableAdapters.CardSetTableAdapter
         Return taCardSet.GetDataById(DirectCast(value, Integer)).Item(0).Name
      End Function

      Public Function ConvertBack(ByVal value As Object, ByVal targetType As System.Type, ByVal parameter As Object, ByVal culture As System.Globalization.CultureInfo) As Object Implements System.Windows.Data.IValueConverter.ConvertBack
         Return Nothing
      End Function

   End Class

End Namespace 
```

*注意：我没有使用 ConvertBack 方法，但接口需要它。*

从那里，您需要在 XAML 标头部分中添加对命名空间的引用：

```
<Window x:Class="Main" Loaded="Main_Loaded"
    // Standard references here...
    xmlns:c="clr-namespace:TCR_Editor.TCRConverters"
    Title="TCR Editor" Height="728" Width="1135" Name="Main"> 
```

然后在你的 Windows.Resources 部分，你可以引用转换器，在我的例子中，我创建了一个对 CollectionViewSource 的静态引用，它将存储数据：

```
<Window.Resources>
   <CollectionViewSource Source="{Binding Source={x:Static Application.Current}, Path=CardDetails}" x:Key="CardDetails">         
   </CollectionViewSource>

   <c:SetIdToNameConverter x:Key="SetConverter"/>      
</Window.Resources> 
```

最后，在作为初始问题一部分的 ListView 中，添加转换器引用：

```
<ListView Canvas.Left="402" Canvas.Top="480" Height="78" ItemsSource="{Binding}" Name="lsvViewEditCardPrint" Width="419">
   <ListView.View>
      <GridView>
         <GridViewColumn DisplayMemberBinding="{Binding Path=IdCst, Converter={StaticResource SetConverter}}">Set</GridViewColumn>
         // Other Columns here...
      </GridView>
   </ListView.View>
</ListView> 
```

所以现在最重要的是，当我触发具有 Card Id 的事件时，我需要做的就是重置 CollectionViewSource ...

```
DirectCast(Me.FindResource("CardDetails"), CollectionViewSource).Source = taCardDetails.GetDataById(CardId) 
```

... WPF 的所有绑定元素完成其余的工作！

好处是我可以轻松创建其他转换器，将它们添加到应用程序中其他地方的各种 DataTemplates 或列中，一旦我将所有数据放入 WPF 应用程序本身，就可以在不进入数据库的情况下进行转换.

# ruby - 使用用户输入下载网站正文

> ID：195158
> 
> 赞同：1
> 
> 时间：2008-10-12T06:52:07.760
> 
> 标签：ruby, shoes

我想使用鞋子来下载用户在 edit_line 中输入的网站正文。我怎样才能使这项工作？谁能帮助解释为什么下面的代码不起作用？它只是弹出一个新窗口，并不会从输入的文本中下载该站点....

到目前为止，这是我的代码：

```
Shoes.app do
  stack (:left => 175, :top => 200) do
    para "Enter a url:"
    flow do
      @url = edit_line
      button "OK" do

    window do
        stack do
         title "Searching site", :size => 16
          @status = para "One moment..."
          # Search site for query and print body
            download @url.text do |site|
              @status.text = "Body: " + site.response.body.inspect
            end
         end
       end
     end
   end
 end
 end 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-12T23:33:09.690

没关系 - 我想通了。我只是没有弹出到新窗口，它会下载并打印正文。:)

# visual-studio-2008 - 如何停止 Visual Studio Express SP1 安装检测不存在的旧版本

> ID：195169
> 
> 赞同：3
> 
> 时间：2008-10-12T07:02:38.193
> 
> 标签：visual-studio-2008, installation

我之前没有在我的电脑上安装过 Visual Studio。但是，当我尝试安装 Visual Studio 2008 Express SP1 时，我收到一条错误消息

“安装程序检测到此计算机不符合安装此软件的要求。必须满足这些要求才能安装 Microsoft Visual C++ 2008 Express Edition with SP1 - ENU”

要求和软件先决条件 Visual Studios 2008 Service Pack 1 在系统上检测到 Microsoft Visual Studio 2008 的早期版本，必须更新到 SP1 才能继续安装。请访问 Microsoft Update 将所有其他版本的 Visual Studio 2008 更新到 SP1，然后安装 Visual Studio 2008 Express SP1。

我不确定为什么会收到此消息，因为我之前没有安装过 VS2008。我尝试运行 VS2008 补丁删除工具，但它显示“Visual Studio 2008 Service Pack 准备不适用”。我已经应用了 Microsoft Update 中的所有补丁，但仍然出现相同的错误。有什么想法可能是错的吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-09-28T04:14:52.650

请使用以下 url 指令帮助....并在几分钟内获得解决方案...我遇到了同样的问题并在几分钟内解决了

[http://www.openspan.com/Community/index.php/component/kb/article/why_do_i_get_an_error_installing_the_microsoft_visual_studio_2008_sp1_isolated_shell.html](http://www.openspan.com/Community/index.php/component/kb/article/why_do_i_get_an_error_installing_the_microsoft_visual_studio_2008_sp1_isolated_shell.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T01:29:26.243

“我之前没有安装过VS2008”

也许您应该在尝试安装服务包之前安装 VS2008。

如果有滑流下载（带有 SP1 的 VS2008），那么安装速度最快。我不知道是否有滑流版本，但即使有，看起来你也没有下载它。

“在系统上检测到早期版本的 Microsoft Visual Studio 2008，必须更新到 SP1 才能继续安装。”

那是因为 Microsoft 检测到您必须先将 VS2008 更新到 SP1，然后才能将 VS2008 更新到 SP1。微软的检测逻辑在Microsoft Update中最为著名，其中Microsoft Update必须先下载一个updater到updater的更新，然后updater更新才会开始更新。如果你需要侦探，你应该依靠福尔摩斯或常识，而不是微软。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-12T07:20:11.823

也许有一个由程序或其他东西放置的注册表项。运行注册表清理程序（在备份注册表后）并重试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T20:16:18.663

查看安装/卸载应用程序。标记 Windows 更新并寻找 Visual Studio ...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-01-01T11:13:21.340

我在尝试安装“Microsoft Visual C++ 2008 Express Edition with SP1”时遇到了同样的问题...

经过多次不同的尝试，解决方案是删除名为

[HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\DevDiv\VS]

请注意，在执行此操作之前我没有安装任何 Visual Studio。如果你有的话，我不建议这样做。并记住始终对已删除的密钥进行备份。

另一种方法是尝试在以下键下将“SP”和“SPIndex”的值从 0 更改为 1：[HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\DevDiv\VS\Servicing\9.0] [HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\ Microsoft\DevDiv\VS\Servicing\9.0\VSR\1033]

但我没有尝试过，也不知道需要/检查哪些键。

# mysql - 当运行 UPDATE ... datetime = NOW(); 所有更新的行都会有相同的日期/时间吗？

> ID：195173
> 
> 赞同：51
> 
> 时间：2008-10-12T07:08:15.233
> 
> 标签：mysql, sql, datetime, sql-update

当您运行类似于以下内容时：

```
UPDATE table SET datetime = NOW(); 
```

在具有 1 000 000 000 条记录的表上，查询需要 10 秒才能运行，所有行的时间是否完全相同（分钟和秒）还是不同的时间？换句话说，是查询开始的时间还是每行更新的时间？

我正在运行 MySQL，但我认为这适用于所有数据库。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-10-12T07:14:12.537

[http://dev.mysql.com/doc/refman/5.0/en/date-and-time-functions.html#function_now](http://dev.mysql.com/doc/refman/5.0/en/date-and-time-functions.html#function_now)

> “NOW() 返回一个常数时间，指示语句开始执行的时间。（在存储的例程或触发器中，NOW() 返回例程或触发语句开始执行的时间。）这不同于SYSDATE() 的行为，它返回从 MySQL 5.0.13 开始执行的确切时间。"

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2016-07-04T13:51:12.490

分配`NOW()`给一个变量，然后用变量更新日期时间：

```
update_date_time=now() 
```

现在像这样更新

```
UPDATE table SET datetime =update_date_time; 
```

根据您的要求更正语法

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T07:12:38.767

它们应该具有相同的时间，更新应该是原子的，这意味着无论执行多长时间，该操作都应该像所有操作同时完成一样发生。

如果您遇到不同的行为，是时候更换另一个 DBMS。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-07-20T22:35:50.420

sqlite的答案是

```
update TABLE set mydatetime = datetime('now'); 
```

以防其他人正在寻找它。

# ruby-on-rails - 使用 Ruby on Rails 构建用户 ID/密码功能？矫枉过正？

> ID：195175
> 
> 赞同：0
> 
> 时间：2008-10-12T07:09:59.597
> 
> 标签：ruby-on-rails, passwords, userid

我是这个社区的新手，但我正在一个网站上工作，该网站需要在进入时执行用户/密码/注册检查，这将在注册的情况下检查数据库或写入数据库。我有使用 XHTML 和 CSS 的经验，并且刚刚发现了 RoR。老实说，我对如何仅使用 XHTML 实现我的目标知之甚少，所以我决定学习 Ruby，在黑暗中试一试。我想知道是否有一种更简单的语言，或更直接的修复，我应该实施。有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-12T09:19:07.370

我建议查看[Restful Authentication](http://github.com/technoweenie/restful-authentication/tree/master)。

此外，对于一般的良好代码示例，请查看[Altered Beast](http://github.com/technoweenie/altered_beast/tree)。这是一个用 Ruby on Rails 构建的论坛，它使用 Restful 身份验证。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-12T07:12:20.497

您是否正在寻找有关如何在 Rails 中实现用户身份验证的信息？你可以试试[`acts_as_authenticated`](http://wiki.rubyonrails.org/rails/pages/Acts_as_authenticated)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-13T02:19:44.753

查看名为[Agile Web Development with rails](http://pragprog.com/titles/rails3/agile-web-development-with-rails-third-edition)的书。它有两部分，一个是创建应用程序的逐步演练，另一个是关于 rails 的参考部分。我最近开始了一份合同工作，在没有任何经验的情况下选择了 RoR 作为我的框架。这本书是教我 Ruby on Rails 的巨大资源。它还专门教授如何实施您正在谈论的授权。

# open-source - 如何通过脚本更新 Zimbra 中的联系人？

> ID：195177
> 
> 赞同：3
> 
> 时间：2008-10-12T07:12:02.980
> 
> 标签：open-source, scripting, sysadmin, zimbra

我有一个 Zimbra 安装，我需要以编程方式更新其中的联系人。似乎它的 REST 接口仅用于添加新联系人，但我需要更新现有联系人。有没有办法，工具或其他东西，开源，可以做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-12T17:07:36.973

好吧，我有一个问题的答案：您可以使用“zmmailbox”命令。在 Zimbra 系统用户下，可以修改邮箱中的内容。由于几乎所有内容都存储在 Zimbra 邮箱中，因此可以编辑联系人。我现在需要找到一种方法来使用它：

```
box$ zmmailbox help contact

  autoComplete(ac)             [opts] {query}
    -v/--verbose                 verbose output

  autoCompleteGal(acg)         [opts] {query}
    -v/--verbose                 verbose output

  createContact(cct)           [opts] [attr1 value1 [attr2 value2...]]
    -i/--ignore                  ignore unknown contact attrs
    -f/--folder <arg>            folder-path-or-id
    -T/--tags <arg>              list of tag ids/names

  deleteContact(dct)           {contact-ids}

  flagContact(fct)             {contact-ids} [0|1*]

  getAllContacts(gact)         [opts] [attr1 [attr2...]]
    -f/--folder <arg>            folder-path-or-id
    -v/--verbose                 verbose output

  getContacts(gct)             [opts] {contact-ids} [attr1 [attr2...]]
    -v/--verbose                 verbose output

  modifyContactAttrs(mcta)     [opts] {contact-id} [attr1 value1 [attr2 value2...]]
    -i/--ignore                  ignore unknown contact attrs
    -r/--replace                 replace contact (default is to merge)

  moveContact(mct)             {contact-ids} {dest-folder-path}

  tagContact(tct)              {contact-ids} {tag-name} [0|1*] 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-12-21T02:31:38.887

You can send SOAP to ZCS, the details are in soap.txt (located under /opt/zimbra/docs). To modify a contact see ModifyContactRequest. You'll need to authenticate first using AuthRequest. Tons of good Zimbra developer information is here: [http://www.zimbra.com/forums/developers/](http://www.zimbra.com/forums/developers/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-15T13:20:50.767

Zimbra 中实际上还有一个 SOAP 接口，但从我通过阅读[zimbra.com/forums](http://www.zimbra.com/forums/)上的论坛了解到的情况来看，由于某种原因，他们“不能”（？！）正确记录它，也不能生成任何 WSDL 文件; 因此我从未使用过它。

显然，必须研究 Zimbra 的 Java 源代码才能看到可用的内容。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T02:25:42.247

如果您最近安装了 Zimbra，您应该能够在 /opt/zimbra/docs 中找到 SOAP 文档。我自己还没有尝试过使用它……对我来说它仍然是希腊语。

马特

# unit-testing - 快速犀牛帮助

> ID：195189
> 
> 赞同：0
> 
> 时间：2008-10-12T07:21:22.680
> 
> 标签：unit-testing, tdd, rhino-mocks

有人可以看看这段代码并告诉我是否有任何明显的原因它不应该工作？当在我的代码中调用 service.getResponse 时，模拟框架只返回 null，而不是我指定的对象。

```
 [Test]
    public void Get_All_Milestones()
    {
        var mockRepo = new MockRepository();
        var service = mockRepo.DynamicMock<IRestfulService>();
        var request = new RestRequestObject
        {
            Password = "testpw!",
            UserName = "user",
            SecureMode = true,
            Url = "www.updatelog.com/",
            Command = String.Format("projects/{0}/milestones/list", 123456),
            Method = "POST"
        };
        var response = new RestResponseObject
                           {
                               StatusCode = 200,
                               ErrorsExist = false,
                               Response =
                                   "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<milestones type=\"array\">\n  <milestone>\n    <completed type=\"boolean\">false</completed>\n    <created-on type=\"datetime\">2008-10-02T17:37:51Z</created-on>\n    <creator-id type=\"integer\">3028235</creator-id>\n    <deadline type=\"date\">2008-10-20</deadline>\n    <id type=\"integer\">7553836</id>\n    <project-id type=\"integer\">123456</project-id>\n    <responsible-party-id type=\"integer\">3028295</responsible-party-id>\n    <responsible-party-type>Person</responsible-party-type>\n    <title>Atb2 Editor Substantially Done</title>\n    <wants-notification type=\"boolean\">true</wants-notification>\n  </milestone>\n</milestones>\n"
                           };
        using(mockRepo.Record())
        {
            Expect
                .Call(service.GetResponse(request))
                .Return(response);
        }
        using(mockRepo.Playback())
        {
            var dal = new DataAccess(service);
            var result = dal.GetMilestones(123456);

            Assert.IsNotNull(result, "The result should not be null.");
            Assert.AreNotEqual(0, result.Count, "There should be exactly one item in this list.");
            Assert.AreEqual(123456, result[0].ProjectId, "The project ids don't match.");
            Assert.AreEqual(7553836, result[0].Id, "The ids don't match.");
        }

        mockRepo.VerifyAll();

    } 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-12T08:22:06.037

如果输入数据与预期不匹配，则动态模拟将返回 null，因此我的猜测是您的代码正在调用 service.GetResponse() 并为 RestRequestObject 使用不同的值，或者 RestRequestObject 的相等性无法按预期工作到。

我想我会尝试用严格的模拟替换动态模拟，并查看 Rhino Mocks 返回的错误。

# c++ - 静态类成员上未解析的外部符号

> ID：195207
> 
> 赞同：147
> 
> 时间：2008-10-12T07:45:06.517
> 
> 标签：c++, class, static, members

很简单地说：

我有一个主要由静态公共成员组成的类，因此我可以将仍然必须从其他类/函数调用的类似函数组合在一起。

无论如何，我在我的类公共范围内定义了两个静态 unsigned char 变量，当我尝试在同一个类的构造函数中修改这些值时，我在编译时收到“未解析的外部符号”错误。

```
class test 
{
public:
    static unsigned char X;
    static unsigned char Y;

    ...

    test();
};

test::test() 
{
    X = 1;
    Y = 2;
} 
```

我是 C++ 新手，所以请放轻松。为什么我不能这样做？

* * *

## 回答 #1

> 赞同：166
> 
> 时间：2008-10-12T07:49:10.860

如果您使用的是**C++ 17**，则可以只使用说明`inline`符（请参阅[https://stackoverflow.com/a/11711082/55721](https://stackoverflow.com/a/11711082/55721)）

* * *

如果使用旧版本的 C++ 标准，则必须添加定义以匹配 X 和 Y 的声明

```
unsigned char test::X;
unsigned char test::Y; 
```

某处。您可能还想初始化一个静态成员

```
unsigned char test::X = 4; 
```

再一次，您在定义中（通常在 CXX 文件中）而不是在声明中（通常在 .H 文件中）执行此操作

* * *

## 回答 #2

> 赞同：72
> 
> 时间：2008-10-12T08:26:29.757

类声明中的静态数据成员声明不是它们的定义。要定义它们，您应该在`.CPP`文件中执行此操作以避免重复符号。

您可以声明和定义的唯一数据是整型静态常量。（的值`enums`也可以用作常数值）

您可能希望将代码重写为：

```
class test {
public:
  const static unsigned char X = 1;
  const static unsigned char Y = 2;
  ...
  test();
};

test::test() {
} 
```

如果您希望能够修改静态变量（换句话说，当不适合将它们声明为 const 时），您可以通过以下方式将代码分隔`.H`开来：`.CPP`

。H ：

```
class test {
public:

  static unsigned char X;
  static unsigned char Y;

  ...

  test();
}; 
```

.CPP：

```
unsigned char test::X = 1;
unsigned char test::Y = 2;

test::test()
{
  // constructor is empty.
  // We don't initialize static data member here, 
  // because static data initialization will happen on every constructor call.
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2018-09-18T23:35:41.177

就我而言，我在 .h 文件中声明了一个静态变量，例如

```
//myClass.h
class myClass
{
static int m_nMyVar;
static void myFunc();
} 
```

在 myClass.cpp 中，我尝试使用这个 m_nMyVar。它得到了 LINK 错误，如：

错误 LNK2001: unresolved external symbol "public: static class... 链接错误相关的 cpp 文件如下所示：

```
//myClass.cpp
void myClass::myFunc()
{
myClass::m_nMyVar = 123; //I tried to use this m_nMyVar here and got link error
} 
```

所以我在 myClass.cpp 顶部添加以下代码

```
//myClass.cpp
int myClass::m_nMyVar; //it seems redefine m_nMyVar, but it works well
void myClass::myFunc()
{
myClass::m_nMyVar = 123; //I tried to use this m_nMyVar here and got link error
} 
```

然后LNK2001就没了。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2018-05-04T07:37:40.833

由于这是我在搜索“具有静态 const 成员的未解决的外部”时似乎出现的第一个 SO 线程，因此我将在此处留下另一个提示来解决未解决的外部问题：

对我来说，我忘记了标记我的类定义`__declspec(dllexport)`，当从另一个类（在该类的 dll 边界之外）调用时，我当然得到了我未解决的外部错误。
不过，当您将内部帮助程序类更改为可从其他地方访问的帮助程序类时，很容易忘记，因此，如果您正在处理动态链接的项目，您不妨也检查一下。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2021-04-17T12:59:58.763

当我们在一个类中声明一个静态变量时，它被该类的所有对象共享。因为静态变量仅在它们从未被构造函数初始化时才被初始化。相反，静态变量应该只在类外部使用范围解析运算符 (::) 显式初始化一次。

在下面的示例中，静态变量 counter 是 Demo 类的成员。请注意它是如何在初始值 = 0 的类外部显式初始化的。

```
#include <iostream>
#include <string>
using namespace std;
class Demo{
   int var;
   static int counter;

   public:
   Demo(int var):var(var){
      cout<<"Counter = "<<counter<<endl;
      counter++;
   }
};
int Demo::counter = 0;                 //static variable initialisation
int main()
{
   Demo d(2), d1(10),d3(1);
}

Output:
Count = 0
Count = 1
Count = 2 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-02-10T13:23:04.580

就我而言，我使用了错误的链接。
它是托管的 c++ (cli)，但具有本机导出功能。我已将导出函数的库的 dll 添加到链接器 -> 输入 -> 程序集链接资源中。但是本机 c++ 链接需要 .lib 文件才能正确“查看”cpp 中的实现，所以对我来说，帮助将 .lib 文件添加到链接器 -> 输入 -> 附加依赖项。
[通常托管代码不使用 dll 导出和导入，它使用引用，但这是独特的情况。]

# .net - File.Move not working properly for UNC paths

> ID：195208
> 
> 赞同：6
> 
> 时间：2008-10-12T07:47:09.787
> 
> 标签：.net, unc

I'm attempting to use File.Move to move a file from one UNC location to another. This blows up if the UNC path for the destination happens to be the local machine (error: Access to the path is denied). Example `File.Move(@"\\someServer\path\file.txt", @"\\blah2\somewhere\file.txt")`. This assumes there's a network share out there somewhere named \\someServer and my local machine name is blah2\. Change \\blah2 to C:\ and all is good.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-12T08:23:20.963

Maybe it's a typo, but shouldn't it be `@"\\blah2\somewhere\file.txt"`, i.e. with two backslashes?

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T08:22:30.840

Shouldn't the server name in your unc path start with two slashes?
eg @"\\someServer\path\file.txt"

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T12:25:41.583

对于 Windows 文件共享，写入访问权限需要在一个额外的位置（ACL 除外）指定权限 - 在共享权限中。如果您使用的是 C$ 之类的管理共享，则已启用写入访问权限，但如果您使用已为此明确设置的共享，请确保在“共享权限”下启用“更改”选项。

请注意，您通常可以通过检查计算机管理 -> 事件查看器下的安全事件日志来解决权限错误，可能还有关于它如何失败的其他详细信息。在管理工具 -> 本地安全策略 -> 本地策略 -> 审计策略下启用对登录失败的审计也可以在事件日志中提供更多详细信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-05-29T03:27:09.963

File.Move 目标路径不接受 UNC 路径

[http://support.microsoft.com/KB/112744](http://support.microsoft.com/KB/112744)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-12T11:58:47.487

我似乎无法重现该错误。也许它与权限有关？您可以使用 UNC 地址移动到本地计算机上的任何位置，还是它们都抛出异常？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-02-04T05:27:09.857

我遇到了同样的问题，并且文件被另一个程序（Windows资源管理器）锁定，在我的情况下，我使用解锁器解锁了文件。这发生在我使用 UNC 路径访问文件时，File.Move 方法可以通过本地路径正常访问它。

在我看来，通过 UNC/本地路径手动重命名文件时我没有得到这种行为。

# ajax - 与 POST 请求相比，使用 GET 请求有什么优势？

> ID：195212
> 
> 赞同：31
> 
> 时间：2008-10-12T07:51:05.660
> 
> 标签：ajax, http, http-post, protocols, http-get

过去我的几个 ajax 应用程序使用 GET 请求，但现在我开始使用 POST 请求。POST 请求似乎更安全一些，而且绝对更友好/漂亮。因此，我想知道是否有任何理由我应该使用 GET 请求。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-10-12T07:58:33.757

我通常这样设置问题：**请求后有什么重要的变化吗？**（尽管有记录等）。如果是，它应该是一个 POST 请求，如果不是，它应该是一个 GET 请求。

我很高兴您将 POST 请求称为“稍微”更安全，因为它们几乎就是这样；伪造用户对页面的 POST 请求是微不足道的。但是，将其设为 POST 请求可防止 Web 加速器或重新加载意外重新触发操作。

作为 AJAX，还有一个注意事项：如果您要返回支持回调的 JSON，请非常小心，不要将任何您不希望其他网站看到的敏感数据放入其中。维基百科在这些方面存在一个漏洞，用户反 CSRF 令牌通过他们的 JSON API 被泄露。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-11-22T01:43:00.113

然而，所有优点，在回答这个问题时，GET 请求在某些情况下比 POST 请求更有用：

1.  他们可以加入书签
2.  它们可以被缓存
3.  他们更快
4.  他们已经知道后果（假设他们不更改数据），因此多次访问它们不是问题。

为了子孙后代，使用博客注释更新此评论：此处的第 3 点，全部归功于 Omar AL Zabir（引用的[博客文章](http://omaralzabir.com/atlas_2__http_post_is_slower_and_it_s_default_in_atlas/)的作者）：

> “Atlas 默认为所有 AJAX 调用进行 HTTP POST。Http POST 比 Http GET 更昂贵。它通过网络传输更多字节，从而占用宝贵的网络时间，并且还使 ASP.NET 在服务器端进行额外处理。所以，你应该尽可能使用Http Get。但是，Http Get不允许你将对象作为参数传递。你只能传递数字，字符串和日期。当你进行Http Get调用时，Atlas会构建一个编码的url并让对该网址的点击。因此，您不能传递太多使网址变得大于 2048 个字符的内容。据我所知，这就是任何网址的最大长度。
> 
> http post 的另一个坏处是，它实际上是 2 个调用。第一个浏览器发送 http post headers 和服务器回复“HTTP 100 Continue”。当浏览器收到此消息时，它会发送实际的正文。”

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-10-12T07:57:52.997

您应该在执行没有副作用的请求时使用 GET，例如仅获取一些信息。该请求可以：

*   重复没有任何问题 - 如果浏览器检测到错误，它可以静默重试
*   让浏览器缓存其结果
*   被代理缓存

这些东西都很好。任何只检索数据（尤其是公共数据）的东西都应该是 GET。如果需要，服务器应发送合理的 Last-Modified: 和 Expires: 标头以允许缓存。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-11-20T03:54:56.133

还有一个没有人提到的区别。

GET 请求在 URL 字符串中传递，因此受到通常取决于浏览器的长度限制。[似乎大多数都在 2000 个字符左右。](https://stackoverflow.com/questions/417142/what-is-the-maximum-length-of-a-url-in-different-browsers?rq=1)

POST 请求可以大得多——实际上并没有限制。因此，如果您需要从 Web 服务器请求数据并且您正在传递大量参数信息，那么 POST 请求可能是唯一的选择。

因此，如前所述，GET 请求实际上是用于请求数据（无副作用），而 POST 请求通常用于将数据传输回服务器以进行存储（有副作用）。例如，使用 POST 上传文件。GET 检索文件。

曾经有一段时间，我相信 IE 的 GET URL 字符串非常短。一些应用程序（如 Lotus notes）使用大量随机字符来表示文档 ID。我不喜欢使用另一种生成随机字符串的产品，因此页面 URL 每次都是唯一的。随机字符串是巨大的......它并不总是与内存中的 IE6 一起使用。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-12T07:54:14.127

这可能会帮助您决定在哪里使用 GET 以及在哪里使用 POST：

[URI、可寻址性以及 HTTP GET 和 POST 的使用](http://www.w3.org/2001/tag/doc/whenToUseGet.html)。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-12T07:58:52.090

POST 请求与 GET 一样不安全。主要区别在于 POST 用于修改服务器应用程序的状态，而 GET 只向它请求数据。

当您使用干净、“宁静”的 URL 时，差异很重要，其中 URL 本身指定资源，并且不同的方法会在服务器端触发不同的操作。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-12T07:57:30.390

也许最重要的是，GET 可以在 url 历史记录中添加书签/查看，并且可以使用 Google 进行搜索。

POST 在您不*希望*事件被收藏或作为 URL 输入的情况下很重要 - 否则您（或 Google 抓取您的 URL）最终可能会意外地执行诸如从系统中删除用户之类的操作。

# xslt - 如何检查 XSLT 中是否存在标签？

> ID：195240
> 
> 赞同：9
> 
> 时间：2008-10-12T08:39:07.407
> 
> 标签：xslt, tags

我有以下模板

```
<h2>one</h2>
<xsl:apply-templates select="one"/>
<h2>two</h2>
<xsl:apply-templates select="two"/>
<h2>three</h2>
<xsl:apply-templates select="three"/> 
```

如果相应模板至少有一个成员，我只想显示标题（一、二、三）。我该如何检查？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-12T08:55:35.657

```
<xsl:if test="one">
  <h2>one</h2>
  <xsl:apply-templates select="one"/>
</xsl:if>
<!-- etc --> 
```

或者，您可以创建一个命名模板，

```
<xsl:template name="WriteWithHeader">
   <xsl:param name="header"/>
   <xsl:param name="data"/>
   <xsl:if test="$data">
      <h2><xsl:value-of select="$header"/></h2>
      <xsl:apply-templates select="$data"/>
   </xsl:if>
</xsl:template> 
```

然后调用为：

```
 <xsl:call-template name="WriteWithHeader">
    <xsl:with-param name="header" select="'one'"/>
    <xsl:with-param name="data" select="one"/>
  </xsl:call-template> 
```

但老实说，这对我来说似乎更多的工作......只有在绘制标题很复杂时才有用......对于一个简单的`<h2>...</h2>`我很想把它留在内联。

如果标题标题始终是节点名称，您可以通过删除“$header”参数来简化模板，并改用：

```
<xsl:value-of select="name($header[1])"/> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-17T14:15:24.930

我喜欢练习 XSL 的*功能*方面，这导致我进行以下实现：

```
<?xml version="1.0" encoding="UTF-8"?> 
```

```
<!-- test data inlined -->
<test>
    <one>Content 1</one>
    <two>Content 2</two>
    <three>Content 3</three>
    <four/>
    <special>I'm special!</special>
</test>

<!-- any root since take test content from stylesheet -->
<xsl:template match="/">
    <html>
        <head>
            <title>Header/Content Widget</title>
        </head>
        <body>
            <xsl:apply-templates select="document('')//test/*" mode="header-content-widget"/>
        </body>
    </html>
</xsl:template>

<!-- default action for header-content -widget is apply header then content views -->
<xsl:template match="*" mode="header-content-widget">
    <xsl:apply-templates select="." mode="header-view"/>
    <xsl:apply-templates select="." mode="content-view"/>
</xsl:template>

<!-- default header-view places element name in <h2> tag -->
<xsl:template match="*" mode="header-view">
    <h2><xsl:value-of select="name()"/></h2>
</xsl:template>

<!-- default header-view when no text content is no-op -->
<xsl:template match="*[not(text())]" mode="header-view"/>

<!-- default content-view is to apply-templates -->
<xsl:template match="*" mode="content-view">
    <xsl:apply-templates/>
</xsl:template>

<!-- special content handling -->
<xsl:template match="special" mode="content-view">
    <strong><xsl:apply-templates/></strong>
</xsl:template> 
```

一旦进入*正文，**测试*元素中包含的所有元素都应用了*header-content-widget*（按文档顺序）。

默认的*header-content-widget*模板（匹配“*”）首先应用*header-view*，然后将*content-view*应用到当前元素。

默认的*header-view*模板将当前元素的*名称*放在 h2 标记中。默认*内容视图*应用通用处理规则。

当*[not(text())]*谓词判断没有内容时，不会出现该元素的输出。

一种*特殊*情况很容易处理。

# javascript - 我可以关闭 HTML 的抗锯齿功能吗 元素？

> ID：195262
> 
> 赞同：97
> 
> 时间：2008-10-12T09:07:06.477
> 
> 标签：javascript, html, canvas, antialiasing

我正在玩[`<canvas>`](http://developer.mozilla.org/en/HTML/Canvas)元素，画线等。

我注意到我的对角线是抗锯齿的。对于我正在做的事情，我更喜欢锯齿状的外观 - 有没有办法关闭这个功能？

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2010-07-19T09:34:04.773

在坐标上画`1-pixel`线，如`ctx.lineTo(10.5, 10.5)`. 在该点上绘制一条单像素线`(10, 10)`意味着`1`该位置的该像素从`9.5`到`10.5`导致在画布上绘制两条线。

如果您有很多单像素线，则不必总是将其添加`0.5`到要绘制的实际坐标中的一个好技巧是在开始时添加到`ctx.translate(0.5, 0.5)`整个画布。

* * *

## 回答 #2

> 赞同：71
> 
> 时间：2008-10-12T14:52:11.520

对于图像，现在有.[`context.imageSmoothingEnabled`](http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#dom-context-2d-imagesmoothingenabled)`= false`

但是，没有任何东西可以明确控制线条绘制。您可能需要使用and来绘制自己的线条（[很难](http://en.wikipedia.org/wiki/Bresenham%27s_line_algorithm)）。`getImageData``putImageData`

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2011-04-15T11:41:31.623

它可以在 Mozilla Firefox 中完成。将此添加到您的代码中：

```
contextXYZ.mozImageSmoothingEnabled = false; 
```

在 Opera 中，它目前是一个功能请求，但希望很快就会添加。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2017-01-09T21:47:15.237

# 它必须抗锯齿矢量图形

正确绘制涉及非整数坐标 (0.4, 0.4) 的矢量图形**需要**抗锯齿，除了极少数客户端之外，所有这些都需要。

当给定非整数坐标时，画布有两个选项：

*   **抗锯齿**- 根据整数坐标与非整数坐标的距离（即舍入误差）绘制坐标周围的像素。
*   **Round** - 对非整数坐标应用一些舍入函数（例如，1.4 将变为 1）。

后面的策略将适用于静态图形，尽管对于小图形（半径为 2 的圆）曲线将显示清晰的台阶而不是平滑的曲线。

真正的问题是当图形被平移（移动）时——一个像素和另一个像素之间的跳跃（1.6 => 2, 1.4 => 1）意味着形状的原点可能会相对于父容器跳跃（不断移动上/下和左/右 1 个像素）。

# 一些技巧

**提示 #1**：您可以通过缩放画布（例如按 x）软化（或硬化）抗锯齿，然后自己将倒数比例 (1/x) 应用于几何图形（不使用画布）。

比较（无缩放）：

[![几个长方形](https://i.stack.imgur.com/127jr.png)](https://i.stack.imgur.com/127jr.png)

与（画布比例：0.75；手动比例：1.33）：

[![具有更柔和边缘的相同矩形](https://i.stack.imgur.com/ccjt2.png)](https://i.stack.imgur.com/ccjt2.png)

和（画布比例：1.33；手动比例：0.75）：

[![具有较暗边缘的相同矩形](https://i.stack.imgur.com/fWWBp.png)](https://i.stack.imgur.com/fWWBp.png)

**提示#2**：如果你真的想要一个锯齿状的外观，试着画几次每个形状（不要擦除）。每次绘制时，抗锯齿像素都会变暗。

比较。绘制一次后：

[![几条路](https://i.stack.imgur.com/P96ie.png)](https://i.stack.imgur.com/P96ie.png)

画三次后：

[![相同的路径但更暗且没有可见的抗锯齿。](https://i.stack.imgur.com/eICmM.png)](https://i.stack.imgur.com/eICmM.png)

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2014-03-21T16:55:48.430

我会使用自定义线算法（例如 Bresenham 的线算法）绘制所有内容。看看这个 javascript 实现： http: [//members.chello.at/easyfilter/canvas.html](http://members.chello.at/easyfilter/canvas.html)

我认为这肯定会解决您的问题。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2015-09-26T14:31:47.710

我想补充一点，我在缩小图像并在画布上绘图时遇到了麻烦，它仍在使用平滑，即使在放大时没有使用。

我用这个解决了：

```
function setpixelated(context){
    context['imageSmoothingEnabled'] = false;       /* standard */
    context['mozImageSmoothingEnabled'] = false;    /* Firefox */
    context['oImageSmoothingEnabled'] = false;      /* Opera */
    context['webkitImageSmoothingEnabled'] = false; /* Safari */
    context['msImageSmoothingEnabled'] = false;     /* IE */
} 
```

你可以像这样使用这个函数：

```
var canvas = document.getElementById('mycanvas')
setpixelated(canvas.getContext('2d')) 
```

也许这对某人有用。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2014-03-30T14:18:47.997

```
ctx.translate(0.5, 0.5);
ctx.lineWidth = .5; 
```

有了这个组合，我可以画出漂亮的 1px 细线。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2020-12-23T08:09:07.390

尝试类似的东西`canvas { image-rendering: pixelated; }`。

如果您只想使一行不抗锯齿，这可能不起作用。

```
const canvas = document.querySelector("canvas");
const ctx = canvas.getContext("2d");

ctx.fillRect(4, 4, 2, 2);
```

```
canvas {
  image-rendering: pixelated;
  width: 100px;
  height: 100px; /* Scale 10x */
}
```

```
<html>
  <head></head>
  <body>
    <canvas width="10" height="10">Canvas unsupported</canvas>
  </body>
</html>
```

不过，我还没有在许多浏览器上测试过这个。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2017-10-02T19:58:01.167

注意一个非常有限的技巧。如果要创建 2 色图像，您可以使用颜色 #010101 在颜色 #000000 的背景上绘制您想要的任何形状。完成此操作后，您可以测试 imageData.data[] 中的每个像素并设置为 0xFF 任何值不是 0x00 ：

```
imageData = context2d.getImageData (0, 0, g.width, g.height);
for (i = 0; i != imageData.data.length; i ++) {
    if (imageData.data[i] != 0x00)
        imageData.data[i] = 0xFF;
}
context2d.putImageData (imageData, 0, 0); 
```

结果将是非抗锯齿的黑白图片。这不会是完美的，因为会发生一些抗锯齿，但这种抗锯齿将非常有限，形状的颜色非常类似于背景的颜色。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2021-06-02T07:37:13.930

添加这个：

```
image-rendering: pixelated; image-rendering: crisp-edges; 
```

canvas 元素的 style 属性有助于在画布上绘制清晰的像素。通过这篇精彩的文章发现：

[https://developer.mozilla.org/en-US/docs/Games/Techniques/Crisp_pixel_art_look](https://developer.mozilla.org/en-US/docs/Games/Techniques/Crisp_pixel_art_look)

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2021-07-14T05:16:18.563

`filter`我发现了一种更好的方法来使用上下文的属性在路径/形状渲染上禁用抗锯齿：

## 魔法/ TL；DR：

```
ctx = canvas.getContext('2d');

// make canvas context render without antialiasing
ctx.filter = "url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxmaWx0ZXIgaWQ9ImZpbHRlciIgeD0iMCIgeT0iMCIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIj48ZmVDb21wb25lbnRUcmFuc2Zlcj48ZmVGdW5jUiB0eXBlPSJpZGVudGl0eSIvPjxmZUZ1bmNHIHR5cGU9ImlkZW50aXR5Ii8+PGZlRnVuY0IgdHlwZT0iaWRlbnRpdHkiLz48ZmVGdW5jQSB0eXBlPSJkaXNjcmV0ZSIgdGFibGVWYWx1ZXM9IjAgMSIvPjwvZmVDb21wb25lbnRUcmFuc2Zlcj48L2ZpbHRlcj48L3N2Zz4=#filter)"; 
```

* * *

## 揭秘：

数据 url 是对包含单个过滤器的 SVG 的引用：

```
<svg xmlns="http://www.w3.org/2000/svg">
    <filter id="filter" x="0" y="0" width="100%" height="100%" color-interpolation-filters="sRGB">
        <feComponentTransfer>
            <feFuncR type="identity"/>
            <feFuncG type="identity"/>
            <feFuncB type="identity"/>
            <feFuncA type="discrete" tableValues="0 1"/>
        </feComponentTransfer>
    </filter>
</svg> 
```

然后在 url 的最后是一个 id 引用`#filter`：

```
"url(data:image/svg+...Zz4=#filter)"; 
```

SVG 滤镜在 Alpha 通道上使用离散变换，在渲染时仅选择完全透明或在 50% 边界上完全不透明。如果需要，可以对其进行调整以添加*一些*抗锯齿，例如：

```
...
<feFuncA type="discrete" tableValues="0 0 0.25 0.75 1"/>
... 
```

* * *

## 缺点/注释/陷阱

注意，我没有用图像测试这个方法，但我可以假设它会影响图像的半透明部分。我也可以猜测它可能不会阻止不同颜色边界的图像上的抗锯齿。它不是“最近的颜色”解决方案，而是二元透明度解决方案。它似乎最适合路径/形状渲染，因为 alpha 是唯一使用路径抗锯齿的通道。

此外，至少使用`lineWidth`1 是安全的。较细的线条变得稀疏或可能经常完全消失。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2021-10-26T06:54:12.470

虽然我们在 2D 上下文中仍然没有适当的`shapeSmoothingEnabled`或`shapeSmoothingQuality`选项（我会提倡这一点并希望它在不久的将来实现），但由于[SVGFilters](https://developer.mozilla.org/en-US/docs/Web/SVG/Element/filter)[`.filter`](https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/filter) ，我们现在有方法来近似“无抗锯齿”行为，可以通过其属性应用于上下文。

因此，需要明确的是，它本身不会停用抗锯齿，但在实现和性能方面都提供了一种廉价的方式*（？，[它*应该*是硬件加速的，这*应该*比 CPU 上的自制 Bresenham 更好])*以便在绘制时移除所有半透明像素，但它也可能会创建一些像素块，并且可能无法保留原始输入颜色。

为此，我们可以使用[`<feComponentTransfer>`](https://developer.mozilla.org/en-US/docs/Web/SVG/Element/feComponentTransfer)节点仅抓取完全不透明的像素。

```
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
ctx.fillStyle = "#ABEDBE";
ctx.fillRect(0,0,canvas.width,canvas.height);
ctx.fillStyle = "black";
ctx.font = "14px sans-serif";
ctx.textAlign = "center";

// first without filter
ctx.fillText("no filter", 60, 20);
drawArc();
drawTriangle();
// then with filter
ctx.setTransform(1, 0, 0, 1, 120, 0);
ctx.filter = "url(#remove-alpha)";
// and do the same ops
ctx.fillText("no alpha", 60, 20);
drawArc();
drawTriangle();

// to remove the filter
ctx.filter = "none";

function drawArc() {
  ctx.beginPath();
  ctx.arc(60, 80, 50, 0, Math.PI * 2);
  ctx.stroke();
}

function drawTriangle() {
  ctx.beginPath();
  ctx.moveTo(60, 150);
  ctx.lineTo(110, 230);
  ctx.lineTo(10, 230);
  ctx.closePath();
  ctx.stroke();
}
// unrelated
// simply to show a zoomed-in version
const zoomed = document.getElementById("zoomed");
const zCtx = zoomed.getContext("2d");
zCtx.imageSmoothingEnabled = false;
canvas.onmousemove = function drawToZoommed(e) {
  const
    x = e.pageX - this.offsetLeft,
    y = e.pageY - this.offsetTop,
    w = this.width,
    h = this.height;

  zCtx.clearRect(0,0,w,h);
  zCtx.drawImage(this, x-w/6,y-h/6,w, h, 0,0,w*3, h*3);
}
```

```
<svg width="0" height="0" style="position:absolute;z-index:-1;">
  <defs>
    <filter id="remove-alpha" x="0" y="0" width="100%" height="100%">
      <feComponentTransfer>
        <feFuncA type="discrete" tableValues="0 1"></feFuncA>
      </feComponentTransfer>
      </filter>
  </defs>
</svg>

<canvas id="canvas" width="250" height="250" ></canvas>
<canvas id="zoomed" width="250" height="250" ></canvas>
```

对于那些不喜欢`<svg>`在他们的 DOM 中添加元素，并且生活在不久的将来（或带有实验标志）的人，我们正在开发的 CanvasFilter 接口应该允许在没有 DOM 的情况下执行此操作（所以从工人也是）：

```
if (!("CanvasFilter" in globalThis)) {
  throw new Error("Not Supported", "Please enable experimental web platform features, or wait a bit");
}

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
ctx.fillStyle = "#ABEDBE";
ctx.fillRect(0,0,canvas.width,canvas.height);
ctx.fillStyle = "black";
ctx.font = "14px sans-serif";
ctx.textAlign = "center";

// first without filter
ctx.fillText("no filter", 60, 20);
drawArc();
drawTriangle();
// then with filter
ctx.setTransform(1, 0, 0, 1, 120, 0);
ctx.filter = new CanvasFilter([
  {
    filter: "componentTransfer",
    funcA: {
      type: "discrete",
      tableValues: [ 0, 1 ]
    }
  }
]);
// and do the same ops
ctx.fillText("no alpha", 60, 20);
drawArc();
drawTriangle();

// to remove the filter
ctx.filter = "none";

function drawArc() {
  ctx.beginPath();
  ctx.arc(60, 80, 50, 0, Math.PI * 2);
  ctx.stroke();
}

function drawTriangle() {
  ctx.beginPath();
  ctx.moveTo(60, 150);
  ctx.lineTo(110, 230);
  ctx.lineTo(10, 230);
  ctx.closePath();
  ctx.stroke();
}
// unrelated
// simply to show a zoomed-in version
const zoomed = document.getElementById("zoomed");
const zCtx = zoomed.getContext("2d");
zCtx.imageSmoothingEnabled = false;
canvas.onmousemove = function drawToZoommed(e) {
  const
    x = e.pageX - this.offsetLeft,
    y = e.pageY - this.offsetTop,
    w = this.width,
    h = this.height;

  zCtx.clearRect(0,0,w,h);
  zCtx.drawImage(this, x-w/6,y-h/6,w, h, 0,0,w*3, h*3);
};
```

```
<canvas id="canvas" width="250" height="250" ></canvas>
<canvas id="zoomed" width="250" height="250" ></canvas>
```

或者您也可以将 SVG 保存为外部文件并将`filter`属性设置为`path/to/svg_file.svg#remove-alpha`.

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2020-03-18T01:53:54.180

对于那些仍在寻找答案的人。这是我的解决方案。

假设图像是 1 通道灰度。我刚刚在 ctx.stroke() 之后设置了阈值。

```
ctx.beginPath();
ctx.moveTo(some_x, some_y);
ctx.lineTo(some_x, some_y);
...
ctx.closePath();
ctx.fill();
ctx.stroke();

let image = ctx.getImageData(0, 0, ctx.canvas.width, ctx.canvas.height)
for(let x=0; x < ctx.canvas.width; x++) {
  for(let y=0; y < ctx.canvas.height; y++) {
    if(image.data[x*image.height + y] < 128) {
      image.data[x*image.height + y] = 0;
    } else {
      image.data[x*image.height + y] = 255;
    }
  }
} 
```

如果您的图像通道是 3 或 4。您需要修改数组索引，例如

```
x*image.height*number_channel + y*number_channel + channel 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2020-03-23T03:25:25.930

这是 Bresenham 算法在 JavaScript 中的基本实现。它基于这篇维基百科文章中描述的整数算术版本：[https ://en.wikipedia.org/wiki/Bresenham%27s_line_algorithm](https://en.wikipedia.org/wiki/Bresenham%27s_line_algorithm)

```
 function range(f=0, l) {
        var list = [];
        const lower = Math.min(f, l);
        const higher = Math.max(f, l);
        for (var i = lower; i <= higher; i++) {
            list.push(i);
        }
        return list;
    }

    //Don't ask me.
    //https://en.wikipedia.org/wiki/Bresenham%27s_line_algorithm
    function bresenhamLinePoints(start, end) {

        let points = [];

        if(start.x === end.x) {
            return range(f=start.y, l=end.y)
                        .map(yIdx => {
                            return {x: start.x, y: yIdx};
                        });
        } else if (start.y === end.y) {
            return range(f=start.x, l=end.x)
                        .map(xIdx => {
                            return {x: xIdx, y: start.y};
                        });
        }

        let dx = Math.abs(end.x - start.x);
        let sx = start.x < end.x ? 1 : -1;
        let dy = -1*Math.abs(end.y - start.y);
        let sy = start.y < end.y ? 1 : - 1;
        let err = dx + dy;

        let currX = start.x;
        let currY = start.y;

        while(true) {
            points.push({x: currX, y: currY});
            if(currX === end.x && currY === end.y) break;
            let e2 = 2*err;
            if (e2 >= dy) {
                err += dy;
                currX += sx;
            }
            if(e2 <= dx) {
                err += dx;
                currY += sy;
            }
        }

        return points;

    } 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-10-22T18:11:31.063

**关于 StashOfCode 的回答只有两个注释：**

1.  它仅适用于灰度、不透明的画布（用白色填充矩形，然后用黑色绘制，反之亦然）
2.  当线条很细时它可能会失败（~1px 线宽）

**最好这样做：**

用 描边和填充`#FFFFFF`，然后执行以下操作：

```
imageData.data[i] = (imageData.data[i] >> 7) * 0xFF 
```

这解决了宽度为 1px 的线条。

除此之外，StashOfCode 的解决方案是完美的，因为它不需要编写自己的光栅化函数（不仅要考虑线条，还要考虑贝塞尔曲线、圆弧、带孔的填充多边形等......）

# c# - Use Windows API from C# to set primary monitor

> ID：195267
> 
> 赞同：8
> 
> 时间：2008-10-12T09:12:11.753
> 
> 标签：c#, windows, sdk

I'm trying to use the Windows API to set the primary monitor. It doesn't seem to work - my screen just flicks and nothing happens.

```
 public const int DM_ORIENTATION = 0x00000001;
public const int DM_PAPERSIZE = 0x00000002;
public const int DM_PAPERLENGTH = 0x00000004;
public const int DM_PAPERWIDTH = 0x00000008;
public const int DM_SCALE = 0x00000010;
public const int DM_POSITION = 0x00000020;
public const int DM_NUP = 0x00000040;
public const int DM_DISPLAYORIENTATION = 0x00000080;
public const int DM_COPIES = 0x00000100;
public const int DM_DEFAULTSOURCE = 0x00000200;
public const int DM_PRINTQUALITY = 0x00000400;
public const int DM_COLOR = 0x00000800;
public const int DM_DUPLEX = 0x00001000;
public const int DM_YRESOLUTION = 0x00002000;
public const int DM_TTOPTION = 0x00004000;
public const int DM_COLLATE = 0x00008000;
public const int DM_FORMNAME = 0x00010000;
public const int DM_LOGPIXELS = 0x00020000;
public const int DM_BITSPERPEL = 0x00040000;
public const int DM_PELSWIDTH = 0x00080000;
public const int DM_PELSHEIGHT = 0x00100000;
public const int DM_DISPLAYFLAGS = 0x00200000;
public const int DM_DISPLAYFREQUENCY = 0x00400000;
public const int DM_ICMMETHOD = 0x00800000;
public const int DM_ICMINTENT = 0x01000000;
public const int DM_MEDIATYPE = 0x02000000;
public const int DM_DITHERTYPE = 0x04000000;
public const int DM_PANNINGWIDTH = 0x08000000;
public const int DM_PANNINGHEIGHT = 0x10000000;
public const int DM_DISPLAYFIXEDOUTPUT = 0x20000000;

public const int ENUM_CURRENT_SETTINGS = -1;
public const int CDS_UPDATEREGISTRY = 0x01;
public const int CDS_TEST = 0x02;
public const int CDS_SET_PRIMARY = 0x00000010;

public const long DISP_CHANGE_SUCCESSFUL = 0;
public const long DISP_CHANGE_RESTART = 1;
public const long DISP_CHANGE_FAILED = -1;
public const long DISP_CHANGE_BADMODE = -2;
public const long DISP_CHANGE_NOTUPDATED = -3;
public const long DISP_CHANGE_BADFLAGS = -4;
public const long DISP_CHANGE_BADPARAM = -5;
public const long DISP_CHANGE_BADDUALVIEW = -6;

    public static void SetPrimary(Screen screen)
{
  DISPLAY_DEVICE d = new DISPLAY_DEVICE();
  DEVMODE dm = new DEVMODE();
  d.cb = Marshal.SizeOf(d);
  uint deviceID = 1;
  User_32.EnumDisplayDevices(null, deviceID, ref  d, 0); // 
  User_32.EnumDisplaySettings(d.DeviceName, 0, ref dm);
  dm.dmPelsWidth = 2560;
  dm.dmPelsHeight = 1600;
  dm.dmPositionX = screen.Bounds.Right;
  dm.dmFields = DM_POSITION | DM_PELSWIDTH | DM_PELSHEIGHT;
  User_32.ChangeDisplaySettingsEx(d.DeviceName, ref dm, IntPtr.Zero, CDS_SET_PRIMARY, IntPtr.Zero);
} 
```

I call the method like this:

```
SetPrimary(Screen.AllScreens[1]) 
```

Any ideas?

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2016-05-01T16:14:58.453

以下是基于 ADbailey 解决方案的完整代码：

```
public class MonitorChanger
{
    public static void SetAsPrimaryMonitor(uint id)
    {
        var device = new DISPLAY_DEVICE();
        var deviceMode = new DEVMODE();
        device.cb = Marshal.SizeOf(device);

        NativeMethods.EnumDisplayDevices(null, id, ref device, 0);
        NativeMethods.EnumDisplaySettings(device.DeviceName, -1, ref deviceMode);
        var offsetx = deviceMode.dmPosition.x;
        var offsety = deviceMode.dmPosition.y;
        deviceMode.dmPosition.x = 0;
        deviceMode.dmPosition.y = 0;

        NativeMethods.ChangeDisplaySettingsEx(
            device.DeviceName,
            ref deviceMode,
            (IntPtr)null,
            (ChangeDisplaySettingsFlags.CDS_SET_PRIMARY | ChangeDisplaySettingsFlags.CDS_UPDATEREGISTRY | ChangeDisplaySettingsFlags.CDS_NORESET),
            IntPtr.Zero);

        device = new DISPLAY_DEVICE();
        device.cb = Marshal.SizeOf(device);

        // Update remaining devices
        for (uint otherid = 0; NativeMethods.EnumDisplayDevices(null, otherid, ref device, 0); otherid++)
        {
            if (device.StateFlags.HasFlag(DisplayDeviceStateFlags.AttachedToDesktop) && otherid != id)
            {
                device.cb = Marshal.SizeOf(device);
                var otherDeviceMode = new DEVMODE();

                NativeMethods.EnumDisplaySettings(device.DeviceName, -1, ref otherDeviceMode);

                otherDeviceMode.dmPosition.x -= offsetx;
                otherDeviceMode.dmPosition.y -= offsety;

                NativeMethods.ChangeDisplaySettingsEx(
                    device.DeviceName,
                    ref otherDeviceMode,
                    (IntPtr)null,
                    (ChangeDisplaySettingsFlags.CDS_UPDATEREGISTRY | ChangeDisplaySettingsFlags.CDS_NORESET),
                    IntPtr.Zero);

            }

            device.cb = Marshal.SizeOf(device);
        }

        // Apply settings
        NativeMethods.ChangeDisplaySettingsEx(null, IntPtr.Zero, (IntPtr)null, ChangeDisplaySettingsFlags.CDS_NONE, (IntPtr)null);
    }
}

[StructLayout(LayoutKind.Explicit, CharSet = CharSet.Ansi)]
public struct DEVMODE
{
    public const int CCHDEVICENAME = 32;
    public const int CCHFORMNAME = 32;

    [MarshalAs(UnmanagedType.ByValTStr, SizeConst = CCHDEVICENAME)]
    [System.Runtime.InteropServices.FieldOffset(0)]
    public string dmDeviceName;
    [System.Runtime.InteropServices.FieldOffset(32)]
    public Int16 dmSpecVersion;
    [System.Runtime.InteropServices.FieldOffset(34)]
    public Int16 dmDriverVersion;
    [System.Runtime.InteropServices.FieldOffset(36)]
    public Int16 dmSize;
    [System.Runtime.InteropServices.FieldOffset(38)]
    public Int16 dmDriverExtra;
    [System.Runtime.InteropServices.FieldOffset(40)]
    public UInt32 dmFields;

    [System.Runtime.InteropServices.FieldOffset(44)]
    Int16 dmOrientation;
    [System.Runtime.InteropServices.FieldOffset(46)]
    Int16 dmPaperSize;
    [System.Runtime.InteropServices.FieldOffset(48)]
    Int16 dmPaperLength;
    [System.Runtime.InteropServices.FieldOffset(50)]
    Int16 dmPaperWidth;
    [System.Runtime.InteropServices.FieldOffset(52)]
    Int16 dmScale;
    [System.Runtime.InteropServices.FieldOffset(54)]
    Int16 dmCopies;
    [System.Runtime.InteropServices.FieldOffset(56)]
    Int16 dmDefaultSource;
    [System.Runtime.InteropServices.FieldOffset(58)]
    Int16 dmPrintQuality;

    [System.Runtime.InteropServices.FieldOffset(44)]
    public POINTL dmPosition;
    [System.Runtime.InteropServices.FieldOffset(52)]
    public Int32 dmDisplayOrientation;
    [System.Runtime.InteropServices.FieldOffset(56)]
    public Int32 dmDisplayFixedOutput;

    [System.Runtime.InteropServices.FieldOffset(60)]
    public short dmColor; // See note below!
    [System.Runtime.InteropServices.FieldOffset(62)]
    public short dmDuplex; // See note below!
    [System.Runtime.InteropServices.FieldOffset(64)]
    public short dmYResolution;
    [System.Runtime.InteropServices.FieldOffset(66)]
    public short dmTTOption;
    [System.Runtime.InteropServices.FieldOffset(68)]
    public short dmCollate; // See note below!
    [System.Runtime.InteropServices.FieldOffset(72)]
    [MarshalAs(UnmanagedType.ByValTStr, SizeConst = CCHFORMNAME)]
    public string dmFormName;
    [System.Runtime.InteropServices.FieldOffset(102)]
    public Int16 dmLogPixels;
    [System.Runtime.InteropServices.FieldOffset(104)]
    public Int32 dmBitsPerPel;
    [System.Runtime.InteropServices.FieldOffset(108)]
    public Int32 dmPelsWidth;
    [System.Runtime.InteropServices.FieldOffset(112)]
    public Int32 dmPelsHeight;
    [System.Runtime.InteropServices.FieldOffset(116)]
    public Int32 dmDisplayFlags;
    [System.Runtime.InteropServices.FieldOffset(116)]
    public Int32 dmNup;
    [System.Runtime.InteropServices.FieldOffset(120)]
    public Int32 dmDisplayFrequency;
}

public enum DISP_CHANGE : int
{
    Successful = 0,
    Restart = 1,
    Failed = -1,
    BadMode = -2,
    NotUpdated = -3,
    BadFlags = -4,
    BadParam = -5,
    BadDualView = -6
}

[StructLayout(LayoutKind.Sequential, CharSet = CharSet.Ansi)]
public struct DISPLAY_DEVICE
{
    [MarshalAs(UnmanagedType.U4)]
    public int cb;
    [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 32)]
    public string DeviceName;
    [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 128)]
    public string DeviceString;
    [MarshalAs(UnmanagedType.U4)]
    public DisplayDeviceStateFlags StateFlags;
    [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 128)]
    public string DeviceID;
    [MarshalAs(UnmanagedType.ByValTStr, SizeConst = 128)]
    public string DeviceKey;
}

[Flags()]
public enum DisplayDeviceStateFlags : int
{
    /// <summary>The device is part of the desktop.</summary>
    AttachedToDesktop = 0x1,
    MultiDriver = 0x2,
    /// <summary>The device is part of the desktop.</summary>
    PrimaryDevice = 0x4,
    /// <summary>Represents a pseudo device used to mirror application drawing for remoting or other purposes.</summary>
    MirroringDriver = 0x8,
    /// <summary>The device is VGA compatible.</summary>
    VGACompatible = 0x10,
    /// <summary>The device is removable; it cannot be the primary display.</summary>
    Removable = 0x20,
    /// <summary>The device has more display modes than its output devices support.</summary>
    ModesPruned = 0x8000000,
    Remote = 0x4000000,
    Disconnect = 0x2000000,
}

[Flags()]
public enum ChangeDisplaySettingsFlags : uint
{
    CDS_NONE = 0,
    CDS_UPDATEREGISTRY = 0x00000001,
    CDS_TEST = 0x00000002,
    CDS_FULLSCREEN = 0x00000004,
    CDS_GLOBAL = 0x00000008,
    CDS_SET_PRIMARY = 0x00000010,
    CDS_VIDEOPARAMETERS = 0x00000020,
    CDS_ENABLE_UNSAFE_MODES = 0x00000100,
    CDS_DISABLE_UNSAFE_MODES = 0x00000200,
    CDS_RESET = 0x40000000,
    CDS_RESET_EX = 0x20000000,
    CDS_NORESET = 0x10000000
}

public class NativeMethods
{
    [DllImport("user32.dll")]
    public static extern DISP_CHANGE ChangeDisplaySettingsEx(string lpszDeviceName, ref DEVMODE lpDevMode, IntPtr hwnd, ChangeDisplaySettingsFlags dwflags, IntPtr lParam);

    [DllImport("user32.dll")]
    // A signature for ChangeDisplaySettingsEx with a DEVMODE struct as the second parameter won't allow you to pass in IntPtr.Zero, so create an overload
    public static extern DISP_CHANGE ChangeDisplaySettingsEx(string lpszDeviceName, IntPtr lpDevMode, IntPtr hwnd, ChangeDisplaySettingsFlags dwflags, IntPtr lParam);

    [DllImport("user32.dll")]
    public static extern bool EnumDisplayDevices(string lpDevice, uint iDevNum, ref DISPLAY_DEVICE lpDisplayDevice, uint dwFlags);

    [DllImport("user32.dll")]
    public static extern bool EnumDisplaySettings(string deviceName, int modeNum, ref DEVMODE devMode);
}

[StructLayout(LayoutKind.Sequential)]
public struct POINTL
{
    public int x;
    public int y;
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2014-04-13T14:49:41.067

我遇到了完全相同的问题，无论是从 C# 还是在按照此处的建议在 C++ 中尝试之后。我最终发现微软文档没有明确说明的是设置主监视器的请求将被忽略（但操作报告为成功！）除非您还将监视器的位置设置为 (0, 0 ) 在 DEVMODE 结构上。当然，这意味着您还需要移动其他显示器的位置，以使它们相对于新的主显示器保持在同一位置。根据文档（[http://msdn.microsoft.com/en-us/library/windows/desktop/dd183413%28v=vs.85%29.aspx](http://msdn.microsoft.com/en-us/library/windows/desktop/dd183413%28v=vs.85%29.aspx)），使用 CDS_NORESET 标志为每个显示器调用 ChangeDisplaySettingsEx，然后创建一个最终通话，一切都为空。

以下代码对我有用：

```
 public static void SetAsPrimaryMonitor(uint id)
    {
        var device = new DISPLAY_DEVICE();
        var deviceMode = new DEVMODE();
        device.cb = Marshal.SizeOf(device);

        NativeMethods.EnumDisplayDevices(null, id, ref device, 0);
        NativeMethods.EnumDisplaySettings(device.DeviceName, -1, ref deviceMode);
        var offsetx = deviceMode.dmPosition.x;
        var offsety = deviceMode.dmPosition.y;
        deviceMode.dmPosition.x = 0;
        deviceMode.dmPosition.y = 0;

        NativeMethods.ChangeDisplaySettingsEx(
            device.DeviceName, 
            ref deviceMode, 
            (IntPtr)null, 
            (ChangeDisplaySettingsFlags.CDS_SET_PRIMARY | ChangeDisplaySettingsFlags.CDS_UPDATEREGISTRY | ChangeDisplaySettingsFlags.CDS_NORESET), 
            IntPtr.Zero);

        device = new DISPLAY_DEVICE();
        device.cb = Marshal.SizeOf(device);

        // Update remaining devices
        for (uint otherid = 0; NativeMethods.EnumDisplayDevices(null, otherid, ref device, 0); otherid++)
        {
            if (device.StateFlags.HasFlag(DisplayDeviceStateFlags.AttachedToDesktop) && otherid != id)
            {
                device.cb = Marshal.SizeOf(device);
                var otherDeviceMode = new DEVMODE();

                NativeMethods.EnumDisplaySettings(device.DeviceName, -1, ref otherDeviceMode);

                otherDeviceMode.dmPosition.x -= offsetx;
                otherDeviceMode.dmPosition.y -= offsety;

                NativeMethods.ChangeDisplaySettingsEx(
                    device.DeviceName,
                    ref otherDeviceMode,
                    (IntPtr)null,
                    (ChangeDisplaySettingsFlags.CDS_UPDATEREGISTRY | ChangeDisplaySettingsFlags.CDS_NORESET),
                    IntPtr.Zero);

            }

            device.cb = Marshal.SizeOf(device);
        }

        // Apply settings
        NativeMethods.ChangeDisplaySettingsEx(null, IntPtr.Zero, (IntPtr)null, ChangeDisplaySettingsFlags.CDS_NONE, (IntPtr)null);
    } 
```

请注意，使用 DEVMODE 结构作为第二个参数的 ChangeDisplaySettingsEx 签名显然不允许您传入 IntPtr.Zero。为同一个外部调用创建两个不同的签名，即

```
 [DllImport("user32.dll")]
    public static extern DISP_CHANGE ChangeDisplaySettingsEx(string lpszDeviceName, ref DEVMODE lpDevMode, IntPtr hwnd, ChangeDisplaySettingsFlags dwflags, IntPtr lParam);

    [DllImport("user32.dll")]
    public static extern DISP_CHANGE ChangeDisplaySettingsEx(string lpszDeviceName, IntPtr lpDevMode, IntPtr hwnd, ChangeDisplaySettingsFlags dwflags, IntPtr lParam); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-12T14:38:39.457

根据[ChangeDisplaySettingsEx 的文档](http://msdn.microsoft.com/en-us/library/ms533235(VS.85).aspx)，“dmSize 成员必须初始化为 DEVMODE 结构的大小（以字节为单位）。” 此外，[EnumDisplaySettings 文档](http://msdn.microsoft.com/en-us/library/ms533265(VS.85).aspx)指出，“在调用 EnumDisplaySettings 之前，将 dmSize 成员设置为 sizeof(DEVMODE)，并将 dmDriverExtra 成员设置为指示可用于接收私有驱动程序数据的额外空间的大小（以字节为单位）”。我没有在问题中给出的代码示例中看到这种情况；这就是它可能失败的原因之一。

此外，您可能在 DEVMODE 和 DISPLAY_DEVICE 结构的定义中存在错误，这些错误未包含在问题中。[Roger Lipscombe 建议](https://stackoverflow.com/questions/195267/use-windows-api-from-c-to-set-primary-monitor#195272)首先从 C/C++ 开始工作，这是排除此类问题的绝佳方法。

最后，检查 ChangeDisplaySettingsEx 的返回值，看看它是否提供了关于它为什么会失败的线索。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-12T10:34:49.387

我无法真正帮助您解决 winapi 的问题，但如果您使用的是 Nvidia 卡，您可以查看[NVcontrolPanel Api 文档](http://developer.download.nvidia.com/SDK/9.5/Samples/DEMOS/common/src/NvCpl/docs/NVControlPanel_API.pdf) ，然后您可以使用`rundll32.exe NvCpl.dll,dtcfg primary 2` 希望对您有所帮助的辅助输出作为主要输出。

# javascript - 专业的基于 jQuery 的 Combobox 控件？

> ID：195270
> 
> 赞同：86
> 
> 时间：2008-10-12T09:18:53.423
> 
> 标签：javascript, jquery, combobox, controls

有没有基于 jQuery 库的**专业**Combobox 控件（带有自动提示的下拉列表）？

它应该能够处理**大型数据集**并具有一些**蒙皮**选项。多**列结果列表**也很棒。我正在使用 ASP.NET，但如果我必须为它编写一个包装器，这不是问题。

![替代文字](https://i.stack.imgur.com/ilhvD.png)

*我已经在使用第三方控件，但我遇到了两个供应商控件之间的一些兼容性问题。好吧，我想摆脱这种依赖。*

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-02-02T15:59:06.417

这是一个看起来很有前途的。这是一个真正的组合 - 你会看到你输入的内容。有一个我在其他地方没有见过的很酷的功能：分页结果。

[弹性盒](http://www.codeplex.com/flexbox)

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2011-04-10T02:42:56.850

任何寻找 jquery“组合框”的人似乎都被定向到这个问题。我的帖子是为来到此页面的人们寻找“传统”组合框，而不是原始问题的答案。上述解决方案都专注于使用输入作为过滤和自动完成现有选择值的手段。（非常适合大型数据集）

如果您正在寻找传统的组合框，它只是“键入内容或从这些预定义的值中选择”（不，我们不会在您键入时隐藏不匹配的组合框），您可以需要做的是

```
<select id="combo4" style="width: 200px;"
            onchange="$('input#text4').val($(this).val());">
    <option>option 1</option>
    <option>option 2</option>
    <option>option 3</option>
</select>
<input id="text4"
       style="margin-left: -203px; width: 180px; height: 1.2em; border: 0;" /> 
```

请参阅 [http://bit.wisestamp.com/uncategorized/htmljquery-editable-combo-2/](http://bit.wisestamp.com/uncategorized/htmljquery-editable-combo-2/)

应该很容易将它包装到一个转换现有选择标签的插件中，尽管我还没有看到这样做。

PS：我看到的“jQuery Editable Combobox”的主要问题是它仍然是一个选择列表，而且你可以开始输入新的东西并不明显。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2008-10-13T02:12:09.010

不幸的是，我见过的最好的东西是[jquery.combobox](http://web.archive.org/web/20130430100104/http://jquery.sanchezsalvador.com/page/jquerycombobox.aspx)，但它看起来并不是我真正想在我的 Web 应用程序中使用的东西。我认为此控件存在一些可用性问题，但作为用户，我认为我不知道要开始输入下拉列表以变成文本框。

我更喜欢[Combo Dropdown Box](http://simpletutorials.com/?path=tutorials/javascript/jquery/ddcombobox)，但它仍然有一些我想要的功能，而且它仍处于 alpha 阶段。除了它是 alpha 之外，我唯一不喜欢的想法是，一旦我在组合框中键入，原来的下拉列表项就会消失。但是，也许有一个设置......或者它可以很容易地添加。

这是我所知道的仅有的两个选项。祝您搜索顺利。我很想知道您是否找到了一个，或者第二种选择是否适合您。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2010-04-13T11:45:18.750

sexy-combo 项目的一个新分支现已推出，看起来很有希望：[http ://code.google.com/p/ufd/](http://code.google.com/p/ufd/)

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2009-01-08T04:55:19.343

[对于大型数据集， JQuery UI Autocomplete](http://docs.jquery.com/UI/Autocomplete)怎么样，它基本上是 Jorn Zaeferrer 的[Autocomplete 插件](http://bassistance.de/jquery-plugins/jquery-plugin-autocomplete/)的“官方”版本？

我还编写了一个直接的[JQuery 组合框](http://jonathan.tang.name/code/jquery_combobox)插件，它从用户那里得到了很好的反馈。但是，它显然*不适*用于大型数据集；我认为，如果您想要根据用户类型修剪列表的内容，最好使用 Jorn 的自动完成插件。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-04-09T18:36:56.507

另一个不错的插件是[性感组合](http://plugins.jquery.com/project/SexyCombo)

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-02-19T23:45:59.793

这也是有希望的：

simpletutorials.com 上[的 JQuery 下拉组合框](http://simpletutorials.com/?path=tutorials/javascript/jquery/ddcombobox)

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2009-03-28T14:07:32.620

一个官方的 jQuery UI ComboBox/Autocomplete 组件正在制作中...（之前是 jQuery UI 1.5.x 的测试版），请参阅[jQuery UI Wiki](http://jqueryui.pbwiki.com/SelectComboboxAutocomplete)

更新：

自动完成功能现在是 jQuery UI 的核心功能，[请参阅文档](http://jqueryui.com/demos/autocomplete/)。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2013-04-04T22:29:42.077

如果不需要多列，[选择](http://harvesthq.github.com/chosen/)是另一个不错的选择。麻省理工学院许可

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2010-01-27T18:27:28.323

我找到了另一个：[http ://code.google.com/p/jquery-jec/](http://code.google.com/p/jquery-jec/)

似乎也是一个不错的选择。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2010-06-16T00:06:29.227

我正在寻找相同的。到目前为止，我最喜欢的是 ExtJs 的这个——除了我没有用大列表测试过它：www.sencha.com/deploy/dev/examples/form/combos.html

这是另一个真正（！）快速的：http: [//jsearchdropdown.sourceforge.net/](http://jsearchdropdown.sourceforge.net/)

例如，SexyCombo 的效果非常棒，但是对于较长的列表来说会变慢。SexyCombo 民间 UFD 快得多，但对于非常大的列表，初始化时间仍然很慢。此外，我有时会得到一些小东西！“闪烁”。但我想在不久的将来会有一些更新。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2011-06-23T18:46:16.350

性感组合已被弃用。Unobtrusive Fast-Filter Dropdown 项目中存在进一步的发展。看起来很有希望，因为我有类似的要求。

[https://code.google.com/p/ufd/](https://code.google.com/p/ufd/)

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2014-02-12T19:43:34.203

我喜欢[select2](http://ivaynberg.github.io/select2/)，它功能丰富、美观且活跃。特别喜欢[变音符号](http://en.wikipedia.org/wiki/Diacritic)搜索功能。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-03-28T14:01:09.533

你为什么不试试[http://jqueryajax.codeplex.com/](http://jqueryajax.codeplex.com/)。它是包含多列下拉菜单的 ASP.NET 控件的集合。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-09-29T03:41:41.353

Activewidgets 有一个非常漂亮的。不知道它在大型数据集上的表现如何。 [http://www.activewidgets.com/ui.combo/](http://www.activewidgets.com/ui.combo/)

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2010-01-26T21:00:22.393

我有同样的问题，所以我最终自己制作了。

它具有内置的模板系统，因此您可以使结果看起来像您想要的任何东西。适用于所有主要浏览器并接受数组和 json 对象。 [http://code.google.com/p/custom-combobox/](http://code.google.com/p/custom-combobox/)

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2010-08-11T23:32:19.060

这是一个非常酷的：[http](http://www.xnodesystems.com/) : //www.xnodesystems.com/ 动态列表字段不仅具有自动完成功能，而且还能够进行验证。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2011-12-30T12:38:42.643

我试过[http://jqueryui.com/demos/autocomplete/#combobox](http://jqueryui.com/demos/autocomplete/#combobox)，面临的问题是：

*   跨浏览器渲染
*   无法提交自定义值

结果，我对其进行了一些调整，它在 ASP.NET MVC 中对我来说效果很好。我的 CSS 和小部件脚本版本可以在这里找到[http://saplin.blogspot.com/2011/12/html-combobox-control-and-aspnet-mvc.html](http://saplin.blogspot.com/2011/12/html-combobox-control-and-aspnet-mvc.html)

也有将 MVC 模型绑定到自定义值的示例。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2012-03-10T02:58:43.607

[http://www.erichynds.com/jquery/jquery-ui-multiselect-widget/](http://www.erichynds.com/jquery/jquery-ui-multiselect-widget/)

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2013-05-02T15:36:05.173

试试这个：

[http://www.jqwidgets.com/jquery-widgets-demo/demos/jqxcombobox/index.htm](http://www.jqwidgets.com/jquery-widgets-demo/demos/jqxcombobox/index.htm)

非常好，包括本地化在内的许多功能。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2013-11-13T12:58:56.780

强烈推荐 Twitter Typeahead：

[http://twitter.github.io/typeahead.js/](http://twitter.github.io/typeahead.js/)

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2010-12-14T05:41:16.413

所有你需要的东西 [http://jquerycomboboxtmpl.codeplex.com/](http://jquerycomboboxtmpl.codeplex.com/)

模板下拉菜单

# apache-flex - Connect to self-signed HTTPS web services from Flex

> ID：195275
> 
> 赞同：8
> 
> 时间：2008-10-12T09:28:51.453
> 
> 标签：apache-flex, actionscript-3, web-services, https, self-signed

In my project I need to connect to an intra-net web service but we need SSL connection between the two machines. Because this is an intra-net site the certificate of the web service might be a self-signed certificate. The web service and the web page that loads my Flex application resides on the same web server (tomcat) so when I load the web page of the application with HTTPS I been asked to confirm the certificate, I confirm it but this confirmation does not apply on the Flex application (on Internet Explorer and Firefox). I tried Google's Chrome and it actually asked me twice for confirmation, one for the web page and one for the connection to the web service so it worked great.

Is there a way to tell Flash player to accept also self-signed certificates of is it entirely concern the browser and Adobe guys can't do nothing about it? In other words, is there a way to connect to a self-signed certificates HTTPS web services from Adobe Flex???

Thanks.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-12T09:49:16.983

When I put on my security hat the answer would be I hope not. I don't want browser plugins to bypass my browser security settings. I'd consider that a vulnerability.

There might be a way for standalone Air applications, but in browser Flash should honor browser settings.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T09:56:43.503

In your company, you could create your own root CA, add its certificate to all machines that will access the intranet, and then have the CA issue your web service a certificate. The certificate will no longer be self-signed. The two main issues are: (1) managing the private key of your CA, (2) distributing the CA's root certificate to client PCs.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-19T16:43:30.187

您需要下载证书并将其安装在 IE 和 Firefox 上。

在 IE 上安装证书：

[http://www.markwilson.co.uk/blog/2008/11/trusting-a-self-signed-certificate-in-windows.htm](http://www.markwilson.co.uk/blog/2008/11/trusting-a-self-signed-certificate-in-windows.htm)

要在 FF 上安装证书：

转到工具-> 选项，然后单击加密选项卡。单击“查看证书”，然后单击“导入”。

根据我的经验，证书必须经过验证或安装在浏览器中才能使 Flash 正常工作。证书还需要有一个有效的主机名，但如果您需要这样做以进行测试，您只需编辑客户端的主机文件即可。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-01-20T15:43:48.493

好吧，flash 播放器应该只使用浏览器来建立连接并完成它。我们这里有类似的设置。我们使用自制证书，并通过 HTTPS 与 AMF 通道通信。我的猜测是，虽然我们的设置不同，因为我们通过 HTTPS 通道加载 Flash 应用程序本身，所以它是从 HTTPS 到同一个 HTTPS 服务器的。也许你可以试试？这是我们的 Tomcat 服务器的设置：

[Tomcat 服务器/客户端自签名 SSL 证书](https://stackoverflow.com/questions/1180397/tomcat-server-client-self-signed-ssl-certificate)

# apache - mod_rewrite 问题

> ID：195286
> 
> 赞同：0
> 
> 时间：2008-10-12T09:44:30.470
> 
> 标签：apache, mod-rewrite

我正在尝试实现以下 mod_rewrite 规则：

host.com/developer/ => host.com/developer/index.py
host.com/developer/branchX => host.com/developer/index.py?branch=branchX
host.com/developer/branchX/commitY => host.com/developer/index.py?branch=branchX&commit=commitY

目前，适当的配置部分如下所示：

```
 Options FollowSymLinks
  AllowOverride None
  RewriteEngine on
  RewriteRule ^([^/]+)$                   /$1/index.py                          [L]
  RewriteRule ^([^/]+)/([^/]+)            /$1/index.py?branch=$2                [L]
  RewriteRule ^([^/]+)/([^/]+)/([^/]+)$   /$1/index.py?branch=$2&commit=$3      [L] 
```

但是，在最初重写 URL 之后，会发生内部重定向，并且 URL 再次被重写，从而破坏了它。该过程重复多次，最终导致 500 错误。日志（时间戳和 perdir 部分已删除）：

```
[..initial] (3) strip per-dir prefix: /home/www/host.com/master/a -> master/a
[..initial] (3) applying pattern '^([^/]+)$' to uri 'master/a'
[..initial] (3) strip per-dir prefix: /home/www/host.com/master/a -> master/a
[..initial] (3)  applying pattern '^([^/]+)/([^/]+)' to uri 'master/a'
[..initial] (2) rewrite 'master/a' -> '/master/index.py?branch=a'
[..initial] (3) split uri=/master/index.py?branch=a -> uri=/master/index.py, args=branch=a
[..initial] (1) internal redirect with /master/index.py [INTERNAL REDIRECT]
[..initial/redir#1] (3) strip per-dir prefix: /home/www/host.com/master/index.py -> master/index.py
[..initial/redir#1] (3) applying pattern '^([^/]+)$' to uri 'master/index.py'
[..initial/redir#1] (3) strip per-dir prefix: /home/www/host.com/master/index.py -> master/index.py
[..initial/redir#1] (3) applying pattern '^([^/]+)/([^/]+)' to uri 'master/index.py'
[..initial/redir#1] (2) rewrite 'master/index.py' -> '/master/index.py?branch=index.py'
[..initial/redir#1] (3) split uri=/master/index.py?branch=index.py -> uri=/master/index.py, args=branch=index.py 
```

如何修复我的规则以防止无休止的内部重定向？谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-12T10:21:21.990

问题是您要重写的 url 在下一次传递中匹配。L 指定最后一条规则，但仅针对此规则的执行，在某些情况下（在本例中为内部重定向）再次处理 URL。解决方案是添加一个 RewriteCond 以防止循环，如下所示：

```
RewriteEngine on
RewriteCond %{REQUEST_URI}              !index\.py
RewriteRule ^([^/]+)$                   /$1/index.py                          [L]
RewriteCond %{REQUEST_URI}              !index\.py
RewriteRule ^([^/]+)/([^/]+)            /$1/index.py?branch=$2                [L]
RewriteCond %{REQUEST_URI}              !index\.py
RewriteRule ^([^/]+)/([^/]+)/([^/]+)$   /$1/index.py?branch=$2&commit=$3      [L] 
```

# php - 交换字符串中的每一对字符

> ID：195287
> 
> 赞同：4
> 
> 时间：2008-10-12T09:45:39.847
> 
> 标签：php, string

我想获得字符串交换字符对的所有排列。例如：

基本字符串：`abcd`

组合：

1.  `bacd`
2.  `acbd`
3.  `abdc`

等等

### 编辑

我只想交换彼此相邻的字母。就像第一和第二，第二和第三，但不是第三和第六。

最好的方法是什么？

### 编辑

只是为了好玩：有三四个解决方案，有人可以发布一个速度测试，以便我们比较哪个最快？

### 速度测试

我对 nickf 的代码和我的代码进行了速度测试，结果是我的 nickf 以四个字母（0.08 和 0.06 10K 次）击败了 nickf，但 nickf 以 10 个字母击败了它（nick 的 0.24 和我的 0.37）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-12T10:00:34.090

编辑：Markdown 今天讨厌我……

```
$input = "abcd";
$len = strlen($input);
$output = array();

for ($i = 0; $i < $len - 1; ++$i) {
    $output[] = substr($input, 0, $i)
              . substr($input, $i + 1, 1)
              . substr($input, $i, 1)
              . substr($input, $i + 2);
}
print_r($output); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T10:24:23.823

nickf 提出了漂亮的解决方案，谢谢，我想出了不那么漂亮：

```
 $arr=array(0=>'a',1=>'b',2=>'c',3=>'d');
  for($i=0;$i<count($arr)-1;$i++){
  $swapped="";
  //Make normal before swapped
  for($z=0;$z<$i;$z++){
   $swapped.=$arr[$z];
  }
  //Create swapped
  $i1=$i+1;
  $swapped.=$arr[$i1].$arr[$i];

  //Make normal after swapped.     
  for($y=$z+2;$y<count($arr);$y++){
  $swapped.=$arr[$y];

  }
$arrayswapped[$i]=$swapped;
}
var_dump($arrayswapped); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T10:25:35.100

谷歌的快速搜索给了我：

[http://cogo.wordpress.com/2008/01/08/string-permutation-in-php/](http://cogo.wordpress.com/2008/01/08/string-permutation-in-php/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-12T10:49:54.270

如何仅使用以下内容：

```
function swap($s, $i)
{
  $t = $s[$i];
  $s[$i] = $s[$i+1];
  $s[$i+1] = $t;

  return $s;
}

$s = "abcd";
$l = strlen($s);
for ($i=0; $i<$l-1; ++$i)
{
  print swap($s,$i)."\n";
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-12T17:28:39.707

这是一个稍微快一点的解决方案，因为它不会过度使用 substr()。

```
function swapcharpairs($input = "abcd") {
  $pre = "";
  $a="";
  $b = $input[0];
  $post = substr($input, 1);
  while($post!='') {
    $pre.=$a;
    $a=$b;
    $b=$post[0];
    $post=substr($post,1);
    $swaps[] = $pre.$b.$a.$post;
  };
  return $swaps;
}

print_R(swapcharpairs()); 
```

# asp.net - ASP.NET OleDbConnection 问题

> ID：195288
> 
> 赞同：0
> 
> 时间：2008-10-12T09:47:16.503
> 
> 标签：asp.net, vb.net, repeater, paging, oledbconnection

我正在一个 ASP.NET 网站上工作，我正在使用一个 asp:repeater 并通过 VB.NET 代码隐藏文件完成分页。我在数据库连接方面遇到了问题。据我所知，分页正在工作，但我无法确定数据。

该数据库是 Microsoft Access 数据库。应该访问数据库的函数是：

```
Dim pagedData As New PagedDataSource

Sub Page_Load(ByVal obj As Object, ByVal e As EventArgs)
    doPaging()
End Sub

Function getTheData() As DataTable
    Dim DS As New DataSet()
    Dim strConnect As New OleDbConnection("Provider = Microsoft.Jet.OLEDB.4.0;Data Source=App_Data/ArtDatabase.mdb")
    Dim objOleDBAdapter As New OleDbDataAdapter("SELECT ArtID, FileLocation, Title, UserName, ArtDate FROM Art ORDER BY Art.ArtDate DESC", strConnect)
    objOleDBAdapter.Fill(DS, "Art")

    Return DS.Tables("Art").Copy
End Function

Sub doPaging()
    pagedData.DataSource = getTheData().DefaultView
    pagedData.AllowPaging = True
    pagedData.PageSize = 2

    Try
        pagedData.CurrentPageIndex = Int32.Parse(Request.QueryString("Page")).ToString()
    Catch ex As Exception
        pagedData.CurrentPageIndex = 0
    End Try

    btnPrev.Visible = (Not pagedData.IsFirstPage)
    btnNext.Visible = (Not pagedData.IsLastPage)

    pageNumber.Text = (pagedData.CurrentPageIndex + 1) & " of " & pagedData.PageCount

    ArtRepeater.DataSource = pagedData
    ArtRepeater.DataBind()
End Sub 
```

ASP.NET 是：

```
<asp:Repeater ID="ArtRepeater" runat="server">
    <HeaderTemplate>
        <h2>Items in Selected Category:</h2>
    </HeaderTemplate>  
    <ItemTemplate>
        <li>
            <asp:HyperLink runat="server" ID="HyperLink"
                NavigateUrl='<%# Eval("ArtID", "ArtPiece.aspx?ArtID={0}") %>'>
                <img src="<%# Eval("FileLocation") %>"
                    alt="<%# DataBinder.Eval(Container.DataItem, "Title") %>t"/> <br />
                <%# DataBinder.Eval(Container.DataItem, "Title") %>
            </asp:HyperLink>
        </li>
    </ItemTemplate>
</asp:Repeater> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-12T10:10:33.710

如果您需要有关连接字符串的帮助，此站点是终极资源！

[http://www.connectionstrings.com/](http://www.connectionstrings.com/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-13T01:38:26.257

您是手动创建连接字符串吗？如果是这样……不要那样做！使用服务器资源管理器创建连接。然后突出显示它并转到“属性”窗口，您将看到它使用的连接字符串。

此外，使用服务器资源管理器可以让您浏览您的表格，甚至打开它们来查看您的数据。至少这可以确定您的数据是否可以访问。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T14:24:20.797

问题解决了！现在考虑到它是多么简单，我几乎要把我的头撞到墙上。这是Page_Load，我将其更改为以下内容：

```
Protected Sub Page_Load1(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
    doPaging()
End Sub 
```

瞧，它有效！

另外，对于连接字符串，我最终使用了：

提供者=Microsoft.Jet.OLEDB.4.0；数据源=|DataDirectory|\ArtDatabase.mdb

效果很好。

感谢您的帮助和输入家伙！

# visual-studio-2008 - 禁用 Visual Studio 对看起来像 xml 的非 xml 文件的验证？

> ID：195293
> 
> 赞同：13
> 
> 时间：2008-10-12T09:58:55.653
> 
> 标签：visual-studio-2008

我在 Visual Studio 2008 项目中有一堆 Velocity 模板文件，问题是尽管扩展名是`.vm`代替`.xml`或类似的 Visual Studio 认为它们包含的 HTML 必须符合 XML 命名标准并生成错误（不仅仅是甚至警告）每次编译。

如何告诉 Visual Studio 忽略这些“错误”的 XML 文件？我愿意关闭所有对 XML 的验证，但我也没有找到这样的选项。

**更新**，错误不会停止构建，它们只会淹没大约 20 个验证错误背后的真正错误。我似乎记得在 VS 2005 中关闭验证的选项，但在 VS 2008 中找不到任何此类选项。

我接受添加`##`到文件的开头作为答案，即使它很难看，它也能解决问题。谢谢尼尔！

**更新 2**我以为我在 Marc 之前尝试过你的答案，但发现它没有被正确记住。但是现在我再次尝试它确实工作得很好，并且比在每个文件中添加评论更干净。重新奖励接受的答案。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-12T10:20:48.057

Xml 错误通常仅在文件打开时显示。

You can normally disable it by not opening it into the xml editor; the errors don't normally stop a build - they just look like they do. Right click -> Open With... Source (Text) Editor (or HTML if you prefer) (and set as default).

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-12T10:19:38.483

我在 vm 文件的第一行添加了一条注释，这样文件就不会以 < 开头，并且 VS 不会认为它是 xml 文件。

只需将## 添加为每个文件的第一行，然后关闭并重新打开它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T10:03:59.387

您是否尝试过：右键单击 .VM 文件，选择属性。在那里您可以更改构建操作，您可能希望将其设置为内容或无。

# javascript - WebTextEdit ClientSideEvent Javascript - Can't Eval

> ID：195302
> 
> 赞同：0
> 
> 时间：2008-10-12T10:13:29.947
> 
> 标签：javascript, webtextedit

WebtextEdit ClientSideEvent execute javascript statement on mousemove event. I can successfully change the style of another object type on this WebTextEdit ClientSide MouseMove event:

```
document.getElementById("Object2").style.backgroundColor = '#F0F5F7'; 
```

But when I want to change the style of the WebTextEdit control:

```
document.getElementById("WebTextEdit1").style.backgroundColor = '#F0F5F7'; 
```

Then nothing happens.

When I execute the script on the same WebTextEdit Clientside for another object which is not a WebtextEdit:

```
Object2.style.border='1px solid #FFE6A0'; 
```

Then it works. But when I want to change the WebtextEdit Clientside style:

```
WebTextEdit1.style.border='1px solid #FFE6A0'; 
```

Then I get Error:

```
Can't Eval WebTextEdit1.style.border='1px solid #FFE6A0'; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T22:35:52.400

可能标识符“WebTextEdit1”不正确。请检查您的来源是否有错字。

# serial-port - 检查串口是否在监听

> ID：195304
> 
> 赞同：6
> 
> 时间：2008-10-12T10:15:19.007
> 
> 标签：serial-port, arduino

我有一个通过串口使用 Python 脚本发送和接收指令的 Arduino。

Arduino 处于一个按钮状态，当它被按下时，它会通过串口向 Python 脚本发送一条消息并等待响应。（通过`Serial.available()`）。它工作得很好。

但是，如果 Python 脚本由于某种原因崩溃（理想情况下它将在后台运行，因此无法轻松检查），Arduino 将永远等待并且即使在脚本重新启动时也不可用。

有没有办法让我的 Arduino 检查串口上是否有东西在监听？（如果没有，用闪光灯等提醒我）或者这不是串行的工作方式吗？最坏的情况我想我可以使用超时，尽管这并不理想。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-12T10:46:23.873

通过使用 DSR/DTR 引脚，您检测对方是否有东西在监听的能力有限。

当您在运行脚本的机器上打开串行端口时，它应该提升其 DTR 引脚（或者您应该能够说服它这样做：用于驱动 COM 端口的库的文档应该告诉您如何操作） .

然后，在您的 Arduino 上，您可以定期检查其 DSR 引脚（假设带握手的空调制解调器接线，其中 PC DTR 引脚连接到 Arduino 上的 DSR+CD），并在任何情况下处理“无人连接”场景你认为合适的方式。

这种方法的一个问题是您的 PC 脚本在崩溃/停止响应时可能不会关闭串行端口，从而使 DTR 引脚处于启用状态，就好像一切正​​常。此外，由于串行线路上的错误，您的脚本可能会错过来自 Arduino 的消息。

出于这个原因，您应该*始终*在您的接收例程中实现超时：即使有一方在另一端监听，也不能保证它已经收到您的消息（或者它的响应会完好无损地到达您）。

如果发生超时，至少重新发送一次消息（假设引发了 DSR）会使您的协议更加可靠。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-29T20:19:43.547

Arduino 不使用 DSR 线或任何其他握手线，所以你不能按照你的建议去做。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-12T11:29:23.457

我同意 mdb 的观点，即超时是必要的，但还要补充一点，您可能希望实现简单的质询/响应系统，该系统会定期检查是否有人在听。（我喜欢 ircd 的乒乓类比）。

# asp.net - Button generated for each item in an XSLT file runat server

> ID：195317
> 
> 赞同：0
> 
> 时间：2008-10-12T10:34:01.323
> 
> 标签：asp.net, vb.net, xslt

I am tryiing to create an "add to cart" button for each item that is displayed by an XSLT file. The button must be run at server (VB) and I need to pass parameters into the onlick, so that the requested item is added to the cart. Is this possible, and if so, how should I go about it?

When I try

```
<asp:Button id="Button123"
   Text="Add to Cart"
   CommandName="AddToCart"
   CommandArgument="123"
   OnCommand="CommandBtn_Click" 
   runat="server"/> 
```

I get "'asp' is an undeclared namespace"

I've also tried

```
<asp>
   <xsl:attribute name="Button">id="BtnAddToCart"</xsl:attribute>
   <xsl:attribute name="text">Add to cart</xsl:attribute>
   <xsl:attribute name="CommandName">AddToCart</xsl:attribute>
   <xsl:attribute name="CommandArgument">123</xsl:attribute>
   <xsl:attribute name="Command">CommandBtn_Click</xsl:attribute>
   <xsl:attribute name="runat">server"</xsl:attribute>
</asp> 
```

Which doesn't give any errors, but doesn't do anything at all

I need to use XSLT directly for displaying my products, as it is for an assignment, although what I am trying to do here is beyond the scope of the assignment.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-12T11:49:16.443

XSLT 几乎可以生成任何你想要的东西——但你需要先知道你想要生成什么。

在 ASP.Net 中，我建议使用 CommandArgument 和 OnCommand 事件来执行此操作。

```
<asp:Button id="Button123"
       Text="Add to Cart"
       CommandName="AddToCart"
       CommandArgument="123"
       OnCommand="CommandBtn_Click" 
       runat="server"/> 
```

然后单个事件处理程序可以处理所有按钮事件。

看到我不知道您的输入 XML 是什么样子，很难猜测您如何在 XSLT 中生成它，但您可能会充分利用属性值模板，如下所示：

```
<xsl:for-each select="Item">
  ...
  <asp:Button id="Button{@Id}"
       Text="Add To Cart"
       CommandName="AddToCart"
       CommandArgument="{@Id}"
       OnCommand="CommandBtn_Click" 
       runat="server"/>
</xsl:foreach> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T17:32:18.280

为什么不将 XmlDataSource 与 GridView 或 Repeater 一起使用，哪个更合适，并使用模板生成绑定到 Xml 元素的适当属性的自定义按钮？如果需要，您仍然可以使用 XSLT 来转换数据（排序、提取子集、选择属性等）。

# java - 为什么 Class.newInstance() 是“邪恶的”？

> ID：195321
> 
> 赞同：100
> 
> 时间：2008-10-12T10:40:12.497
> 
> 标签：java, constructor, runtime, instantiation

[Ryan Delucchi](https://stackoverflow.com/users/9931/ryan-delucchi)[在](https://stackoverflow.com/questions/194698/how-to-load-a-jar-file-at-runtime#194712)评论 #3 中对[Tom Hawtin](https://stackoverflow.com/users/4725/tom-hawtin-tackline)的回答提问：

> 为什么 Class.newInstance() “邪恶”？

这是对代码示例的响应：

```
// Avoid Class.newInstance, for it is evil.
Constructor<? extends Runnable> ctor = runClass.getConstructor();
Runnable doRun = ctor.newInstance(); 
```

那么，为什么它是邪恶的？

* * *

## 回答 #1

> 赞同：85
> 
> 时间：2008-10-12T10:43:31.913

Java API 文档解释了原因（[http://java.sun.com/javase/6/docs/api/java/lang/Class.html#newInstance()](http://java.sun.com/javase/6/docs/api/java/lang/Class.html#newInstance())）：

> 请注意，此方法传播由 nullary 构造函数引发的任何异常，包括已检查的异常。使用此方法可以有效地绕过编译器执行的编译时异常检查。该`Constructor.newInstance`方法通过将构造函数抛出的任何异常包装在 (checked) 中来避免此问题`InvocationTargetException`。

换句话说，它可以打败检查异常系统。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-10-13T03:46:53.843

还有一个原因：

现代 IDE 允许您找到类的用法 - 如果您和您的 IDE 知道哪些代码正在使用您计划更改的类，那么它在重构期间会有所帮助。

当您不显式使用构造函数，而是使用 Class.newInstance() 时，您可能会在重构期间找不到该用法，并且此问题在您编译时不会表现出来。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2018-10-26T18:33:31.397

我不知道为什么没有人为此提供一个简单的基于示例的解释，`Constructor::newInstance`例如，因为*finally* `Class::newInstance`自 java-9 以来已被弃用。

假设你有这个非常简单的类（不管它坏了）：

```
static class Foo {
    public Foo() throws IOException {
        throw new IOException();
    }
} 
```

你尝试通过反射创建它的一个实例。首先`Class::newInstance`：

```
 Class<Foo> clazz = ...

    try {
        clazz.newInstance();
    } catch (InstantiationException e) {
        // handle 1
    } catch (IllegalAccessException e) {
        // handle 2
    } 
```

调用这将导致`IOException`被抛出 - 问题是您的代码不处理它，`handle 1`也`handle 2`不会捕获它。

相比之下，通过 a 进行操作时`Constructor`：

```
 Constructor<Foo> constructor = null;
    try {
        constructor = clazz.getConstructor();
    } catch (NoSuchMethodException e) {
        e.printStackTrace();
    }

    try {
        Foo foo = constructor.newInstance();
    } catch (InstantiationException e) {
        e.printStackTrace();
    } catch (IllegalAccessException e) {
        e.printStackTrace();
    } catch (InvocationTargetException e) {
        System.out.println("handle 3 called");
        e.printStackTrace();
    } 
```

该句柄 3 将被调用，因此您将处理它。

有效地`Class::newInstance`绕过了异常处理——你真的不想要。

# c++ - 用 C++ 读取文本文件最优雅的方法是什么？

> ID：195323
> 
> 赞同：65
> 
> 时间：2008-10-12T10:40:15.833
> 
> 标签：c++, text, file-io

我想`std::string`用 c++ 将文本文件的全部内容读取到对象中。

使用 Python，我可以编写：

```
text = open("text.txt", "rt").read() 
```

它非常简单优雅。我讨厌丑陋的东西，所以我想知道 - 用 C++ 读取文本文件的最优雅的方法是什么？谢谢。

* * *

## 回答 #1

> 赞同：135
> 
> 时间：2008-10-12T11:06:34.907

有很多方法，你选择最适合你的。

读入 char*：

```
ifstream file ("file.txt", ios::in|ios::binary|ios::ate);
if (file.is_open())
{
    file.seekg(0, ios::end);
    size = file.tellg();
    char *contents = new char [size];
    file.seekg (0, ios::beg);
    file.read (contents, size);
    file.close();
    //... do something with it
    delete [] contents;
} 
```

进入 std::string：

```
std::ifstream in("file.txt");
std::string contents((std::istreambuf_iterator<char>(in)), 
    std::istreambuf_iterator<char>()); 
```

进入向量<char>：

```
std::ifstream in("file.txt");
std::vector<char> contents((std::istreambuf_iterator<char>(in)),
    std::istreambuf_iterator<char>()); 
```

进入字符串，使用 stringstream：

```
std::ifstream in("file.txt");
std::stringstream buffer;
buffer << in.rdbuf();
std::string contents(buffer.str()); 
```

file.txt 只是一个示例，对于二进制文件也一切正常，只要确保在 ifstream 构造函数中使用 ios::binary 即可。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-12T14:36:49.460

关于这个主题还有[另一个线程。](https://stackoverflow.com/questions/116038/what-is-the-best-way-to-slurp-a-file-into-a-stdstring-in-c)

我从这个线程的解决方案（都是单行）：

好的（见米兰的第二个解决方案）：

```
string str((istreambuf_iterator<char>(ifs)), istreambuf_iterator<char>()); 
```

和快速：

```
string str(static_cast<stringstream const&>(stringstream() << ifs.rdbuf()).str()); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-12T11:06:02.257

您似乎将优雅称为“小代码”的明确属性。这当然在某种程度上是主观的。有人会说省略所有错误处理不是很优雅。有人会说，您立即理解的清晰紧凑的代码是优雅的。

编写您自己的读取文件内容的单行函数/方法，但在表面下使其严格和安全，您将涵盖优雅的两个方面。

祝一切顺利

/罗伯特

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-09-23T11:41:07.353

但请注意，一个 c++ 字符串（或更具体的：一个 STL 字符串）与能够保存任意长度字符串的 C 字符串一样小——当然不是！

查看成员 max_size() ，它为您提供字符串可能包含的最大字符数。这是一个实现定义的数字，可能无法在不同平台之间移植。Visual Studio 为字符串提供大约 4gigs 的值，其他的可能只给你 64k，而在 64 位平台上它可能会给你一些非常大的东西！这取决于，当然通常你会在达到 4gig 限制之前很长时间因为内存耗尽而遇到 bad_alloc-exception ......

顺便说一句：max_size() 也是其他 STL 容器的成员！它将为您提供该容器（理论上）能够容纳的某种类型的元素（您为其实例化容器）的最大数量。

所以，如果你从一个未知来源的文件中读取，你应该：
- 检查它的大小并确保它小于 max_size()
- 捕获并处理 bad_alloc-exceptions

还有一点：你为什么热衷于将文件读入字符串？我希望通过增量解析或其他方式来进一步处理它，对吗？因此，与其将其读入字符串，不如将其读入字符串流（基本上只是字符串的一些语法糖）并进行处理。但是您也可以直接从文件中进行处理。因为如果正确编程，字符串流可以无缝地替换为文件流，即文件本身。或者也可以通过任何其他输入流，它们都共享相同的成员和运算符，因此可以无缝互换！

对于处理本身：编译器还可以实现很多自动化！例如。假设您要标记字符串。定义适当的模板时，以下操作：
- 从文件（或字符串或任何其他输入流）读取- 标记
内容
- 将所有找到的标记推入 STL 容器
- 按字母顺序对标记进行排序
- 删除任何双精度值
都可以（！！）在一行（！）C++ 代码中实现（撇开模板本身和错误处理不谈）！这只是函数 std::copy() 的一次调用！只需谷歌搜索“令牌迭代器”，您就会明白我的意思。所以在我看来，这比仅仅从文件中读取更“优雅”......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-12T14:24:11.467

我喜欢 Milan 的 char* 方式，但使用 std::string。

```
 #include <iostream>
#include <string>
#include <fstream>
#include <cstdlib>
using namespace std;

string& getfile(const string& filename, string& buffer) {
    ifstream in(filename.c_str(), ios_base::binary | ios_base::ate);
    in.exceptions(ios_base::badbit | ios_base::failbit | ios_base::eofbit);
    buffer.resize(in.tellg());
    in.seekg(0, ios_base::beg);
    in.read(&buffer[0], buffer.size());
    return buffer;
}

int main(int argc, char* argv[]) {
    if (argc != 2) {
        cerr << "Usage: this_executable file_to_read\n";
        return EXIT_FAILURE;
    }
    string buffer;
    cout << getfile(argv[1], buffer).size() << "\n";
} 
```

（有或没有 ios_base::binary，取决于您是否要转换换行符。您也可以将 getfile 更改为只返回一个字符串，这样您就不必传入缓冲区字符串。然后，测试看看是否编译器在返回时优化复制。）

但是，这可能看起来会好一些（而且会慢很多）：

```
 #include <iostream>
#include <string>
#include <fstream>
#include <cstdlib>
using namespace std;

string getfile(const string& filename) {
    ifstream in(filename.c_str(), ios_base::binary);
    in.exceptions(ios_base::badbit | ios_base::failbit | ios_base::eofbit);
    return string(istreambuf_iterator<char>(in), istreambuf_iterator<char>());
}

int main(int argc, char* argv[]) {
    if (argc != 2) {
        cerr << "Usage: this_executable file_to_read\n";
        return EXIT_FAILURE;
    }
    cout << getfile(argv[1]).size() << "\n";
} 
```

# database-design - 如何处理长期运行的系统的旧的、过时的数据库数据？

> ID：195332
> 
> 赞同：9
> 
> 时间：2008-10-12T10:46:46.213
> 
> 标签：database-design

程序员处理很少使用但不能简单删除的数据的可能性是什么，因为至少报告仍然需要它？

我想到的一些例子：

*   大学年长的折扣资助类型
*   未使用的货币（例如意大利里拉）
*   消失国家的名称（例如奥匈帝国、苏联）

一些部分解决方案是活动标志、活动周期、可视化优先级，但它们中的每一个都意味着逐案决策，并且很难知道哪些类型的实体需要这种特殊处理。

可能有针对此问题的设计模式。

**结论：（**基于到目前为止的答案）

*   如果旧数据使大型数据库上的日常工作变得困难，那么分区将很有帮助。Oracle 关于这个主题的描述在[这里](http://download.oracle.com/docs/cd/B19306_01/server.102/b14231/partiti.htm)。

*   从设计者的角度来看，[渐变维度](http://en.wikipedia.org/wiki/Slowly_changing_dimension)的分类法提供了一些背景信息。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-12T12:01:10.227

对于大多数查询中未使用的旧数据，最好的解决方案是通过区分陈旧数据和当前数据的键（例如 date、currency_id 或类似的东西）对表进行分区。然后，您可以将过时的数据放在单独的表、数据库甚至服务器中（取决于您运行的配置）。

这样做的缺点是您的应用程序必须具有分区意识才能知道在哪里可以找到数据（尽管有一些抽象有助于处理分片和分区）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-12T12:26:28.523

对于任何生命周期有限的实体，只需在其定义中添加一个时间组件。例如，您的意大利里拉可以建模为：

```
CREATE TABLE Currency (CurrencyID NUMBER, CurrencyStartDate DATETIME, CurrentEndDate DATETIME) 
```

然后，您可以从与当前活动相关的任何应用程序功能中排除过期货币，并仍然保持历史数据的关系。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T12:09:28.870

在某些情况下，我使用适当的只读权限集复制了旧数据和旧程序。因此，用户可以查看旧数据并使用旧程序进行报告。然后你可以自由地推进你认为合适的现代程序，删除列或表，迁移一些数据等。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T12:09:37.637

您确实必须逐案处理，因为它是定义过时记录何时相关或不相关的业务规则。例如，在某些历史报告中，包括对苏联的销售是有意义的，在其他情况下，您可以省略它。

一般模式是在记录上有一个“相关的从/到”数据时间字段。在这种情况下，历史报告可以包括与该期间相关的类型。（一个更简单的解决方案是记录上的布尔“过时”标志，但由于这并不表示它何时相关，因此对历史报告没有帮助。）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-12T12:16:26.717

这是标准的渐变维度问题。您有带有状态和/或日期范围的 SCD。

> “他们每个人都意味着逐案决定，很难知道哪些类型的实体需要这种特殊处理”

是的。对于那个很抱歉。你必须分析你的数据并思考。没有简单的方法来解决这个问题的思考部分。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-12T15:24:33.950

我建议将业务系统和报告系统分开。拥有一个用于操作*在线*系统的数据库和另一个用于报告的数据库。（可以是数据仓库，或简单的*其他*数据库）取决于您需要报告系统的多功能性。

定期将数据从操作系统转移到报告系统。（频率取决于系统的性质）。所有历史报告都将基于报告数据库。在线数据库也将包含报告，但不包含（非常）历史报告。

是的。您需要维护表格上的日期或标志以确定项目是否已*过期*。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-12T10:49:33.600

一种解决方案可能是（假设引用过时数据的记录是最旧的）：**归档**这些记录并删除旧的引用数据。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-12T12:10:05.153

除了 Eran 所说的分区之外，您还可以通过 LastModified 列或类似的列来部分自动化决定将什么放入存档分区的过程。然后通过基于 LastModified < -1y 左右的简单分区，系统应该了解陈旧数据本身。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-12T14:34:03.023

商业 DBMS（Informix、DB2，可能是 Oracle，...）具有分区或分段功能，因此您可以将不同的数据放在不同的片段中，并且查询优化器将忽略它知道不需要的片段。您有时可以使用这些将不常用的数据放置到仅用于旧数据的存储区域中。这样做的好处是系统处理放置（好的，系统加上 DBA），而应用程序完全没有注意到它。

任何需要更改报告应用程序的方案都注定会破坏至少其中一些应用程序。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-31T09:55:45.213

我发现了一个类似的问题：[实现软删除的最佳方法是什么？](https://stackoverflow.com/questions/68323/what-is-the-best-way-to-implement-soft-deletion)处理活动标志解决方案。

这是另一个关于活动标志[的“活动”标志吗？](https://stackoverflow.com/questions/102278/active-flag-or-not)对于 mysql 和 postgresql。

基于这两个问题，活动标志和/或表分区是该问题最常见的解决方案。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-31T10:08:37.980

您还可以更新旧数据。例如，您可以将意大利里拉金额转换为欧元金额。但这确实是一个个案决定。您最了解您的系统和要求。

# ruby-on-rails - 如何使用“link_to”和“current_page”使用 RSpec 测试 Rails 插件？

> ID：195334
> 
> 赞同：4
> 
> 时间：2008-10-12T10:47:52.747
> 
> 标签：ruby-on-rails, plugins, rspec

我正在编写一个在视图中构建菜单的 Rails 插件。我正在使用`link_to`构建链接并在当前页面上`current_page?`进行设置。`class="active"`

我已经`include`d`ActionView::Helpers::UrlHelper`所以我可以使用`link_to`.

为了`current_page?`在视图中工作，我必须继承当前类（显然`ActionView::Base`）并且它工作得很好。不幸的是，这完全破坏了 RSpec 的测试。

我打电话`link_to`是`current_page?`这样的：

```
def menu(options = {}, &block)
  carte = my_menu.new(self)
  yield carte
  carte.to_s unless carte.empty?
end

class my_menu
  include ActionView::Helpers::TagHelper
  include ActionView::Helpers::UrlHelper

  def initialize(base)
    @base = base
  end

  def link
    @base.link_to(name, url_options, html_options)
    @base.current_page?(url_options)
  end
end 
```

我得到了 RSpec 的这个错误：Undefined method `link_to' for #< Spec::Rails::Example::RailsExampleGroup::Subclass_1:0x24afa90>

有什么线索吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-12T16:41:12.267

```
include ActionView::Helpers::UrlHelper 
```

在您的规范中应该可以解决问题。或者在你的 spec_helper.rb 中。我认为这基本上是默认情况下视图规范所做的。

# javascript - Internet Explorer 调试模式 - 是否有快速启用/禁用它的方法？

> ID：195335
> 
> 赞同：1
> 
> 时间：2008-10-12T10:48:08.220
> 
> 标签：javascript, debugging, internet-explorer

我使用 Internet Explorer（以及其他浏览器）进行网站调试，但我的问题在于 Internet Explorer，因为它是我通常用于常规浏览的浏览器。

为了调试，您需要在高级选项中打开调试模式。好的。它已打开。但我遇到的一个非常烦人的问题是，似乎 30% 的网站都有 JavaScript 错误，并且处于调试模式的 Internet Explorer 会导致弹出窗口。现在 Stack Overflow 也是如此，我现在花了很多时间。每次我编辑我都会得到一个 JavaScript 错误小狗。

我想这可以归结为：有没有办法快速启用和禁用调试模式，例如 Hokey 或加载项，所以您不必进入高级选项来启用和禁用？

我应该提到我主要做[ASP.NET](http://en.wikipedia.org/wiki/ASP.NET)开发和使用 Visual Studio。我已经在某些场景和非 Internet Explorer 相关问题上使用了 Firefox/ [Firebug](http://en.wikipedia.org/wiki/Firebug_%28software%29)。我并不是真的想改变我的工作或如何做，主要是寻找手头问题的解决方案。即使是不涉及使用其他浏览器/调试器的解决方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-12T11:05:07.487

我能想到的最快方法是编写一个小实用程序来：

*   关闭所有 IE 窗口
*   切换 REG_SZ 注册表值 HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Main\Disable Script Debugger（从“是”到“否”，反之亦然）
*   可选择重启 IE

据我所知，即使使用 IE 插件，也无法在不重新启动的情况下让 IE 识别更改的注册表值。

顺便说一句，除非 IE/VS 集成对您很重要，否则您可能需要研究 Firefox 和[Firebug](http://getfirebug.com/)的组合以进行 Javascript 调试：我发现它总体上要好得多，并且可以轻松地启用或禁用调试，无论是交互方式或基于每个站点。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-12T12:45:33.243

我推荐使用 Firefox + [IE Tab](https://addons.mozilla.org/en-US/firefox/addon/1419)，它可以让您轻松快速地更改用于需要 IE 的网站的渲染引擎。这样，您的大部分浏览都可以在非 IE 选项卡中完成，并且您可以避免调试弹出窗口。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T11:17:40.503

看看[调试栏](http://www.debugbar.com/)。它免费供个人使用，并且有 60 天的商业试用期。它的工作原理有点像 Firefox 的 fireug，但显然使用起来会很花钱。

# asp.net - ASP.NET、XSLT 和动态控件

> ID：195340
> 
> 赞同：0
> 
> 时间：2008-10-12T10:55:31.077
> 
> 标签：asp.net, xml, xslt

我希望使用 xml 和 xsl 在 asp.net 页面上生成控件。

我目前有一个包含 xml 控件的 asp.net 内容页面。加载页面时，将加载一个 xml 文件并提取所需元素并将其设置为 xml 控件的 DocumentContent，并将 xml 控件的 TransformSource 设置为适当的 xsl 文件。

在 xsl 文件中，我希望使用模板根据 xml 的内容创建 asp.net 控件。是否有一种简单的方法可以使用内容页面上的 xml 控件来执行此操作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-13T02:12:30.167

在您的 XSL 中注册一个命名空间，以便您可以将 .NET 服务器端标记放入其中。针对您的 XML 运行您的 XSL 转换。通过 Page.ParseControls() 运行转换的结果。这将为您提供一个很好的控制层次结构。将该函数的输出添加到您的控件集合（或占位符的控件集合）中，您就可以开始了。

在 .NET 中使用动态控件有很多注意事项，所以要小心。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-12T21:17:57.403

生成的 transform 输出不会被解析为作为控件集添加到页面中。而是将生成的输出发送到响应。因此，您不能将转换应用于将生成新控件的 XML 控件。

可能有一种方法可以创建转换结果并调用一些可以应用于页面但不能满足您的“简单”要求的解析。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-12T21:40:23.053

我不知道有什么*简单*的方法可以做到这一点，但是有一些系统可以即时生成 aspnet 标记，然后将其从内存流（或类似的）发送到 aspnet 运行时。

我认为 umbraco 使用类似的系统，但最初的构建器机制可能比 aspnet 控件低一点。使用 httpmodule 或其他在请求管道中较早命中的东西可能可以实现。

# mysql - 选择数据库时在哪里可以找到好的参考？

> ID：195353
> 
> 赞同：4
> 
> 时间：2008-10-12T11:10:06.477
> 
> 标签：mysql, sql-server, postgresql

我和另外两个人正在大学里做一个项目。

在该项目中，我们正在制作 MMORPG 的原型。

我们决定使用 PostgreSQL 作为我们的数据库。我们考虑的其他数据库是 MS SQL-server 和 MySQL。有人有一个很好的参考来证明我们的选择是正确的吗？（最好是去年写的）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-12T12:26:17.383

最近有人向我推荐了[wikivs.com：MySQL 与 PostgreSQL——](http://www.wikivs.com/wiki/MySQL_vs_PostgreSQL)这是对这两者的非常详细的比较，可能对你有所帮助。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-12T12:04:39.673

MySQL 和 PostgreSQL 之间最常被提及的区别在于您的读/写比率。如果你读的比写的多，MySQL 通常会更快；但是，如果您对表进行大量重度更新，就像其他线程必须读取的频率一样，那么 MySQL 中的默认锁定并不是最好的，而 PostgreSQL 在性能方面可能是更好的选择。

IOW，PostgreSQL 在数据库写入方面可以更好地扩展。

这就是为什么人们通常说 MySQL 最适合 webapps，而 PostgreSQL 更“企业”。

当然，图片没那么简单：

*   MySQL 上的 InnoDB 表具有非常不同的性能行为
*   在 PostgreSQL 更好的锁超过 MySQL 的负载级别，平台的其他部分可能是瓶颈。
*   PostgreSQL 确实更符合标准，因此以后更容易替换。

最后，选择有很多变数，无论你走哪条路，你都会发现一些重要的问题使它成为正确的选择。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T11:45:59.073

选择团队中有人在生产中使用过的实际经验。所有数据库都存在频繁用户意识到的问题。

我不能足够强调团队中的某个人需要使用它的生产经验。不要将它用于他们的家庭作业，或者保存他们的 CD 列表。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T12:16:50.790

所有这些数据库都有其优点和缺点。哪个更好取决于：

您的团队体验
您的确切要求
您当前的环境，例如，您的应用程序是用什么编写的并将被托管在什么平台上？

SQL 服务器的主要问题是成本，除非您使用具有性能限制的 express 版本，但它非常易于使用并且具有许多好的工具。

在以下位置有不同 sql 版本的比较：http: [//www.microsoft.com/sql/prodinfo/features/compare-features.mspx](http://www.microsoft.com/sql/prodinfo/features/compare-features.mspx)

然后，您可以将它们与 MySQL 和 PostGre 进行比较。

如果此比较的目的是为您的文章提供理论性的比较，那么您可以参考网页（例如 microsoft 链接）并比较性能、成本等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-12T12:35:27.770

Postgresql 有一个[案例研究](http://www.postgresql.org/about/casestudies/)页面，您可以引用和链接到该页面。

真的，以上任何一项都对你有用。我个人喜欢 PostgreSQL。它相对于 MSSQL 的一个坚实优势（即使假设您可以“免费”获得它）是 PostgreSQL 是非专有的。如果您要在项目中引入依赖项（并且重新发明 RDBMS 会很疯狂），您不希望它成为一个黑匣子。

# handler - 什么是处理程序？

> ID：195357
> 
> 赞同：91
> 
> 时间：2008-10-12T11:14:56.297
> 
> 标签：handler, terminology

我正在尝试学习一些与编程相关的术语，并且我经常遇到“处理程序”这个词。谁能解释一下它的含义以及何时使用它？

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2008-10-12T11:26:32.560

处理程序是一种例程/功能/方法，专门用于某种类型的数据或专注于某些特殊任务。

例子：

*   事件处理程序 - 接收和消化来自周围系统（例如 OS 或 GUI）的事件和信号。

*   内存处理程序 - 在内存上执行某些特殊任务。

*   文件输入处理程序 - 接收文件输入并对数据执行特殊任务的函数，当然这一切都取决于上下文。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-12T12:23:35.253

与特定事件相关联并由其触发的代码，例如传入消息、抛出的异常、发送到进程的信号、网络 I/O 请求完成或用户界面元素上的鼠标单击。这是一个非常笼统的术语。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-12T11:53:22.363

我认为这是一个非常笼统的术语，没有“硬”的定义。含义是高度上下文相关的，因一般代码设计而异。

对我来说，它通常意味着一些从内核调用的代码，应该做一些事情并返回。该“内部”部分可以有多个“处理程序”可用，并选择调用哪一个。

在某些情况下，您定义一些 API 以使这些处理程序大部分可互换，因此调用者可以从表中选择一个并使用相同的代码来调用它们中的任何一个。OOP 在这里有很大帮助。

# eclipse - 在哪里可以找到 Eclipse JavaServer Faces 配置编辑器面板？

> ID：195359
> 
> 赞同：2
> 
> 时间：2008-10-12T11:18:54.790
> 
> 标签：eclipse, editor, palette

在运行[Eclipse JavaServer Faces 工具](http://www.linuxtopia.org/online_books/eclipse_documentation/eclipse_javaserver_faces_tooling_user_guide/topic/org.eclipse.jst.jsf.doc.user/html/gettingstarted/wpe/eclipse_jsf_user_wpe_getting_started.html)的备忘单“创建导航规则”时，它显示“从调色板中选择页面控件并...”。但是这个“调色板”在哪里？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-12T11:21:44.270

事实证明，至少在[Ganymede](http://en.wikipedia.org/wiki/Eclipse_%28software%29#Releases)中，在 JavaServer Faces 配置编辑器选项卡的右侧边框上有一个微妙的左箭头。单击显示调色板。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-11-20T15:22:55.087

以防万一有人现在很难找到它，我添加了一个屏幕截图，显示了它的确切位置：

[调色板图像](http://i.stack.imgur.com/o63WS.png)

# javascript - 在前置标签中插入换行符（IE、Javascript）

> ID：195363
> 
> 赞同：14
> 
> 时间：2008-10-12T11:24:29.317
> 
> 标签：javascript, html, internet-explorer, pre

在 IE 中，当我将文本插入`<pre>`标签时，会忽略换行符：

```
<pre id="putItHere"></pre>

<script>
function putText() {
   document.getElementById("putItHere").innerHTML = "first line\nsecond line";
}
</script> 
```

使用`\r\n`而不是平原`\n`是行不通的。

`<br/>`确实有效，但在 FF 中插入了一个额外的空白行，这对我的目的来说是不可接受的。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-12T11:46:31.503

这些关于 Internet Explorer 的 innerHTML 行为的[quirksmode.org 错误报告和评论可能会有所帮助：](http://www.quirksmode.org/bugreports/archives/2004/11/innerhtml_and_t.html)

" *IE 将**HTML 规范化**应用于分配给 innerHTML 属性的数据。这会导致在应该保留格式的元素中不正确地显示空白，例如 <pre> 和 <textarea>。* "

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-12T11:49:46.367

这在IE中有效吗？

```
document.getElementById("putItHere")
    .appendChild(document.createTextNode("first line\nsecond line")); 
```

我用 Firefox 测试了它，它可以工作。:-)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-12T16:05:49.603

解决方法可以在已接受答案中链接到的页面中找到。为了便于使用，这里是：

```
if (elem.tagName == "PRE" && "outerHTML" in elem)
{
    elem.outerHTML = "<PRE>" + str + "</PRE>";
}
else
{
    elem.innerHTML = str;
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-12T11:33:59.097

`<br/>`应该在所有浏览器中只输出一行。当然也删除 \n ，代码应该是：

```
document.getElementById("putItHere").innerHTML = "first line<br/>second line"; 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-12T12:04:55.493

标签内的内容`<pre>`不应被视为 HTML。

事实上，`<pre>`标签的意义在于它确实显示了格式化的文本。

使用 innerText 属性是修改`<pre>`标签内容的正确方法。

```
document.getElementById("putItHere").innerText = "first line\nsecond line"; 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-03-10T17:12:45.293

IE9不像它的前辈那样[标准化空白。](http://blogs.msdn.com/b/ie/archive/2010/09/13/interoperable-html-parsing-in-ie9.aspx)

您应该测试支持而不是针对任何特定的浏览器。例如..

```
var t = document.createElement(elem.tagName);
t.innerHTML = "\n";

if( t.innerHTML === "\n" ){
    elem.innerHTML = str;
}
else if("outerHTML" in elem)
{
    elem.outerHTML = "<"+elem.tagName+">" + str + "</"+elem.tagName+">";
}
else {
    // fallback of your choice, probably do the first one.
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-12T12:12:35.460

我估计这个。

我发现 IE 正在使用 \r\n 而 Fx(others) 正在使用 \n

```
var newline;
if ( document.all ) newline = '\r\n';
else newline = '\n';

var data = 'firstline' + newline + 'second line';
document.getElementById("putItHere").appendChild(document.createTextNode(data)); 
```

对于我曾经制作的 TinyMCE（所见即所得编辑器）插件，我最终使用了 BR i 编辑模式并在提交等时对其进行了清理。

此代码循环遍历 PRE 元素内的所有 BR 元素，并将 BR 替换为换行符。

请注意，代码依赖于 TinyMCE API，但可以使用标准 Javascript 轻松编写。

清理：

```
 var br = ed.dom.select('pre br');
        for (var i = 0; i < br.length; i++) {
          var nlChar;
          if (tinymce.isIE)
            nlChar = '\r\n';
          else
            nlChar = '\n';

          var nl = ed.getDoc().createTextNode(nlChar);
          ed.dom.insertAfter(nl, br[i]);
          ed.dom.remove(br[i]);
        } 
```

祝你好运！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-05T14:23:34.933

我发现 innerHTML 在应用于元素之前已被处理，因此 <br> 成为换行符并删除了多个空格。

例如，要保留原始文本，您必须使用 nodeValue；

```
document.getElementById('pre_id').firstChild.nodeValue='    white space \r\n ad new line'; 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-04-27T10:32:11.550

如果您不想使用 outerHTML，您也可以对 IE 执行以下操作，前提是额外的 pre 标签不是问题：

```
 if(isIE)
     document.getElementById("putItHere").innerHTML = "<pre>" + content+"</pre>";
 else
     document.getElementById("putItHere").innerHTML = content; 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-12-06T15:13:00.993

这是对 Edward Wilde 答案的一个非常小的调整，它保留了 <pre> 标签上的属性。

```
if (elem.tagName == "PRE" && "outerHTML" in elem) {
    var outer = elem.outerHTML;
    elem.outerHTML = outer.substring(0, outer.indexOf('>') + 1) + str + "</PRE>";
}
else {
    elem.innerHTML = str;
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-05T04:14:01.960

```
if (typeof div2.innerText == 'undefined')
    div2.innerHTML = value;
else
    div2.innerText = value; 
```

这对我有用。

# c# - 数据集 ReadXmlSchema 错误

> ID：195368
> 
> 赞同：1
> 
> 时间：2008-10-12T11:29:30.697
> 
> 标签：c#, .net, asp.net, dataset, xmldocument

这怎么可能是真的

```
XmlDocument d = BuildReportXML(schema);
DataSet ds = new DataSet();
ds.ReadXmlSchema(schema);
ds.ReadXml(new XmlNodeReader(d)); 
```

架构是我在开始设置数据之前应用到 XmlDocument 的架构位置，以确保所有列的类型都正确。然后我将模式设置为 DataSet，并将文档读入其中。当我这样做时，它会抛出“输入字符串的格式不正确”。我在 Xml 中有一些十进制变量，我认为这是错误。所有的信息显然都是正确的格式，否则 XmlDocument 会有错误。我能做些什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-24T20:45:46.140

XML 文档是否包含双精度空值？这可能是个问题！

我还记得读过关于与根元素、元素和属性使用相同的名称导致问题。不确定它是否在某些服务包中得到修复。所以尝试使所有这些名称不同！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T12:06:17.220

FxCop 建议始终设置数据集的区域设置。例如：

```
ds.Locale = CultureInfo.InvariantCulture; 
```

会不会是您的 DataSet 的语言环境与您正在阅读的 Xml 不匹配？

# postgresql - 交易，什么时候应该被丢弃和回滚

> ID：195377
> 
> 赞同：3
> 
> 时间：2008-10-12T11:38:32.347
> 
> 标签：postgresql, transactions, autocommit

我正在尝试调试应用程序（在 PostgreSQL 下）并遇到以下错误：“当前事务已中止，命令被忽略”。

据我所知，“事务”只是一个与底层数据库连接相关的概念。

如果连接具有自动提交“false”，您可以通过相同的语句执行查询，只要它没有失败。在这种情况下，您应该回滚。

如果自动提交为“真”，那么只要您的所有查询都被认为是原子的，这并不重要。

使用 auto commit false，即使是一个简单的 PostgreSQL，我也会收到上述错误

```
select * from foo 
```

失败了，这让我问，在哪个 SQLException(s) 下是一个被认为无效的“事务”，应该回滚还是不用于另一个查询？

> 使用 MacOS 10.5、Java 1.5.0_16、PostgreSQL 8.3 和 JDBC 驱动程序 8.1-407.jdbc3

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-12T11:48:06.213

该错误意味着事务中发送的查询之一失败，因此其余查询将被忽略，直到当前事务结束（这将自动回滚）。对 PostgreSQL 而言，事务已经失败，并且在错误发生后无论如何都会回滚，但有一个异常。你必须采取适当的措施，其中之一

1.  放弃声明并重新开始。
2.  在事务中使用[SAVEPOINT](http://www.postgresql.org/docs/8.3/interactive/sql-savepoint.html)能够及时回到那个时间点并尝试另一条路径。（这是个例外）

启用[查询日志记录](http://www.databasejournal.com/features/postgresql/article.php/3323561)以查看哪个查询是失败的以及原因。

无论如何，您的问题的确切答案是任何 SQLException 都应该意味着在发送事务结束命令时发生回滚，即发出 COMMIT 或 ROLLBACK（或 END）时。这就是它的工作原理，如果你使用保存点，你仍然会受到相同规则的约束，你只能回到你保存的地方并尝试其他东西。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-12T14:27:23.630

这似乎是大多数其他 DBMS 不共享的 PostgreSQL 的特征行为。通常（在 PostgreSQL 之外），您可以让一个操作因错误而失败，然后在同一个事务中，可以尝试将成功的替代操作，以补偿错误。一个例子：考虑一个合并（插入/更新）操作。如果您尝试 INSERT 新记录但发现它已经存在，您可以切换到更改现有记录的 UPDATE 操作。这在所有主要的 DBMS 中都可以正常工作。我不确定它在 PostgreSQL 中是否不起作用，但我在其他地方以及在这个问题中看到的描述表明，当尝试的 INSERT 意味着事务中的任何进一步活动也注定要失败时。这充其量是严厉的，最坏的情况是“无法使用”。

# javascript - 限制网页上显示的字符串长度

> ID：195408
> 
> 赞同：2
> 
> 时间：2008-10-12T12:12:57.020
> 
> 标签：javascript, css, string, dhtml

我正在寻找一种技术（javascript、CSS 等等？？？），它可以让我控制显示的字符串的数量。该字符串是搜索的结果（因此最初不知道）。一个简单的字符计数方法是微不足道的，但不可接受，因为它需要处理成比例的字体。换句话说，如果我想限制为 70 像素，那么下面的示例显示了不同的字符数（9 和 15），两者的测量值相同：-

欢迎 M...
嗨 Iain 如果我...

如果您查看 Yahoo 搜索结果，他们能够限制标题字符串的长度并在长字符串的末尾添加省略号以表示更多。（尝试站点：loot.com 无线+键盘+和+鼠标查看雅虎实现此功能的示例）

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-12T12:16:07.467

也许 CSS 属性`overflow: hidden;`可以帮助你，结合`width`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T12:32:44.377

使用固定宽度的跨度，overflow-x:hidden 和 white-space:nowrap 将是一个开始。

在跨浏览器场景中获取省略号将很困难。IE 有 text-overflow:elipsis 但这是非标准的。这在 Opera 中使用 -o-text-overflow 进行了模拟。然而Mozilla没有这个。雅虎 Javascript API 处理这个问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-12T12:35:08.880

Yahoo 在服务器端执行此操作，在 HTML 中返回截断和省略号（'...'）。大概这是在字符数上完成的，如果那不是您的选择，那么服务器端就出局了。

除了`overflow: hidden`我不确定 CSS 是否可以在这里为您提供帮助之外。您可以使用 Javascript 测量包含元素的宽度，并据此截断文本。这可以结合使用，`overflow:hidden;`因此文本元素不会突然调整大小，但您可能必须提取文本并将临时元素添加到页面某处以进行测量。根据要截断的元素数量，这可能效果不佳。

另一个稍微有点 hacky 的选项是测量包含字母 ' `W`' 的元素的宽度，然后进行字符计数并截断 if `(char_count * width_of_w) > desired_width`。

您可以使用`text-wrap: none;`停止文本换行到新行，虽然这是一个 CSS3 属性并且我上次检查的只有 IE 支持（想象一下当我发现它时我的震惊！）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-20T04:09:10.223

对于跨浏览器的纯 CSS 解决方案，请查看 Hedger Wang 的 text-overflow:ellipsis 原型，这里：

[http://www.hedgerwow.com/360/dhtml/text_overflow/demo2.php](http://www.hedgerwow.com/360/dhtml/text_overflow/demo2.php)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-01-22T10:36:08.937

> 在 CSS 中：.class-name{ 宽度：5em; 空白：nowrap；文本溢出：省略号；}
> 
> 希望它可以帮助你。

# database - 如何登录Oracle数据库？

> ID：195410
> 
> 赞同：6
> 
> 时间：2008-10-12T12:13:30.297
> 
> 标签：database, oracle, logging

我对 Oracle 数据库中常用的日志记录方法很感兴趣。我们的方法如下：

我们为要记录的表创建一个日志表。日志表包含原始表的所有列以及一些特殊字段，包括时间戳、修改类型（插入、更新、删除）、修改器的 id。原始表上的触发器为每次插入和删除创建一个日志行，并为修改创建两行。日志行包含更改原始数据之前和之后的数据。

虽然使用这种方法可以及时挖掘记录的状态，但它有一些缺点：

*   在原始表中引入新列不会自动涉及日志修改。
*   日志修改影响日志表和触发器，容易搞砸。
*   不能以直接的方式确定特定过去时间的记录状态。
*   ...

还有哪些可能？可以使用什么样的工具来解决这个问题？

我只知道[log4plsql](http://log4plsql.sourceforge.net/)。这个工具的优点/缺点是什么？

编辑：根据布赖恩的回答，我发现以下[参考资料](http://www.oracle-base.com/articles/10g/Auditing_10gR2.php)解释了标准和细粒度审计。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-13T03:20:47.767

听起来您正在“审核”之后。Oracle 有一个称为细粒度审计 (FGA) 的内置特性。简而言之，您可以审核所有内容或特定条件。真正酷的是您可以“审核”选择以及交易。开始审计的简单命令：

```
audit UPDATE on SCOTT.EMP by access; 
```

将其视为选择语句的“触发器”。例如，您创建策略：

```
begin
   dbms_fga.add_policy (
      object_schema=>'BANK',
      object_name=>'ACCOUNTS',
      policy_name=>'ACCOUNTS_ACCESS'
  );
end; 
```

定义策略后，当用户以通常的方式查询表时，如下所示：

```
select * from bank.accounts; 
```

审计跟踪记录此操作。您可以通过发出以下命令查看轨迹：

```
select timestamp, 
   db_user,
   os_user,
   object_schema,
   object_name,
   sql_text
from dba_fga_audit_trail;

TIMESTAMP DB_USER OS_USER OBJECT_ OBJECT_N SQL_TEXT
--------- ------- ------- ------- -------- ----------------------
22-OCT-08 BANK    ananda  BANK    ACCOUNTS select * from accounts 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T01:09:03.880

从您的描述来看，我想知道您真正需要的不是日志记录机制，而是某个表的某种历史值。如果是这种情况，那么您最好使用某种临时数据库设计（使用 VALID_FROM 和 VALID_TO 字段）。[您可以使用Oracle LogMiner](http://download.oracle.com/docs/cd/B19306_01/server.102/b14215/logminer.htm)工具跟踪数据库中的更改。

至于您的场景，我宁愿将更改数据存储在这种模式中：

```
+----------------------------------------------------------------------------+
| Column Name         | Function                                             |
+----------------------------------------------------------------------------+
| Id                  | PRIMARY_KEY value of the SOURCE table                |
| TimeStamp           | Time stamp of the action                             |
| User                | User who make the action                             |
| ActionType          | INSERT, UPDATE, or DELETE                            |
| OldValues           | All fields value from source table, seperated by '|' |
| Newvalues           | All fields value from source table, seperated by '|' |
+----------------------------------------------------------------------------+ 
```

使用这种类型的日志记录表，您可以轻松确定：

*   特定记录的历史更改操作（使用 ID）
*   某个时间点的特定记录状态

当然，这种日志记录不能轻易确定特定时间点表的所有有效值。为此，您需要将表设计更改为[Temporal Database Design](http://en.wikipedia.org/wiki/Temporal_database)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-31T15:16:09.793

在类似的问题（[如何在没有性能和可扩展性问题的情况下审核数据库活动？](https://stackoverflow.com/questions/67557/how-to-audit-database-activity-without-performance-and-scalability-issues)）中，接受的答案提到使用网络流量嗅探器监视数据库流量是一种有趣的替代方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-13T00:04:53.403

log4plsql 是完全不同的东西，它用于记录来自 PL/SQL 的调试信息

对于你想要的，你需要。

1.  设置触发器
2.  围绕表设置 PL/SQL 接口，CRUD 操作通过该接口进行，该接口确保更新日志表。
3.  在应用层设置接口，就像 PL/SQL 接口一样，只是更高。
4.  Oracle 11g 包含版本化表，但我根本没有使用过，所以不能发表真正的评论。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-13T12:25:15.700

如果您只是想知道最近的数据是什么样的，您可以使用 Oracle 的闪回查询功能来查询过去特定时间的数据。过去多长时间取决于您拥有多少磁盘空间以及有多少数据库活动。该解决方案的优点是会自动添加新列。缺点是您不能闪回查询过去的 ddl 操作。

# c# - .NET 中的 TransactionScope 错误？更多信息？

> ID：195420
> 
> 赞同：24
> 
> 时间：2008-10-12T12:20:55.460
> 
> 标签：c#, .net, transactions

我已经读过（或者可能从同事那里听说过），在 .NET 中，TransactionScope 可以达到其超时，然后 VoteCommit（与 VoteRollback 相对）。这是准确的还是传闻？我无法在网络上找到谈论这个问题的信息（如果它是一个问题），所以我想知道是否有人对此有任何直接经验并且可以提供一些启示？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2010-08-19T23:46:34.130

Marc Gravell 描述的行为在 .Net 4.0 中已更改。它现在将抛出 InvalidOperationException，而不是自动提交操作。所以在 4.0 中你不再需要使用 Explicit Unbind。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-10-12T12:25:28.540

如果您的意思是与 SQL Server 相关，那么您可以在连接字符串中修复一个问题；[在此处](https://stackoverflow.com/questions/189534/net-transactionscope-class-and-t-sql-tran-commit-and-rollback#190332)查看我的回复，或在[此处查看](http://weblogs.asp.net/ryangaraygay/archive/2008/04/14/issue-with-system-transactions-sqlconnection-and-timeout.aspx)完整的详细信息。

简短的版本是：确保您`Transaction Binding=Explicit Unbind;`在连接字符串中有。

它实际上并没有进行投票提交——事务（和任何早期操作）已经回滚，但是任何后续操作（仍在 内部`TransactionScope`）都可以在 nul 事务中执行，即自动提交。

# lucene - 如何获取 Lucene 索引中文档子集的热门词条？

> ID：195434
> 
> 赞同：7
> 
> 时间：2008-10-12T12:34:36.820
> 
> 标签：lucene

我知道它可以在 Lucene 索引中获取最热门的术语，但是有没有办法根据 Lucene 索引的子集来获取最热门的术语？

即特定日期范围内的文档索引中的顶级术语是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-22T01:04:36.070

理想情况下，在某处会有一个实用程序来执行此操作，但我不知道有一个。但是，以合理有效的方式“手动”完成此操作并不难。我假设您已经有一个`Query`和/或`Filter`对象，您可以使用它来定义感兴趣的子集。

首先，在您的索引子集中的所有文档 ID 的内存中构建一个列表。您可以使用`IndexSearcher.search(Query, Filter, HitCollector)`它非常快速地执行此操作；该`HitCollector` [文档](http://lucene.apache.org/java/2_4_0/api/org/apache/lucene/search/HitCollector.html)包含一个看起来应该可以工作的示例，或者您可以使用其他一些容器来存储您的文档 ID。

接下来，初始化一个空的 HashMap（或其他）以将术语映射到总频率，并通过`IndexReader.getTermFreqVector`为每个文档和感兴趣的字段调用其中一种方法来填充映射。三参数形式似乎更简单，但任何一个都应该没问题。对于三参数形式，您将创建`TermVectorMapper`who`map`方法检查是否`term`在地图中，`frequency`如果不在则将其与现有值相关联，如果是则添加`frequency`到现有值。确保在此过程`TermVectorMapper`中的所有调用中使用相同的对象`getTermFreqVector`，而不是为循环中的每个文档实例化一个新对象。`isIgnoringPositions()`您还可以通过覆盖和来加快速度`isIgnoringOffsets()`；你的对象应该`true`为这两个返回。看起来像你的`TermVectorMapper`也可能被迫定义一种`setExpectations`方法，但不需要做任何事情。

构建地图后，只需按频率降序对地图项目进行排序，然后读出您喜欢的许多热门术语。如果您事先知道需要多少项，您可能更喜欢使用某种奇特的基于堆的算法来在线性时间内找到前*k*个项目，而不是使用 O( *n* log *n* ) 排序。我想普通的旧类型在实践中会很快。但这取决于你。

如果您愿意，可以通过直接`HitCollector`调用来组合前两个阶段。`getTermFreqVector`这当然应该产生同样正确的结果，并且直观地看起来它会更简单更好，但文档似乎警告说这样做可能比两遍方法慢很多（与 HitCollector 示例在同一页面上以上）。或者我可能误解了他们的警告。如果你觉得雄心勃勃，你可以尝试两种方式，比较，让我们知道。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-10-26T01:23:35.740

计算 TermVectors 会起作用，但如果有很多文档要迭代，就会很慢。另请注意，如果您通过顶级术语表示 docFreq，则不要使用 TermFreqVector 中的计数，只需将术语计算为二进制即可。

或者，您可以迭代诸如方面计数之类的术语。对每个术语使用[缓存过滤器；](http://lucene.apache.org/java/3_4_0/api/core/org/apache/lucene/search/CachingWrapperFilter.html)他们的[BitSet](http://lucene.apache.org/java/3_4_0/api/core/org/apache/lucene/search/DocIdSet.html)可用于快速交叉点计数。

# jsp - 从自定义源加载 JSP 页面

> ID：195437
> 
> 赞同：3
> 
> 时间：2008-10-12T12:36:50.607
> 
> 标签：jsp, servlets

是否可以在 Web 应用程序之外执行 JSP 页面并捕获其输出？具体来说，在我的情况下，仍然存在一个普通的 Web 应用程序，但它不是从其类路径加载 JSP 页面，而是从任意源加载。似乎我不能简单地获取 RequestDispatcher 并将其指向磁盘上的 JSP 文件。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-12T13:46:40.263

我认为你最好使用像速度这样的模板引擎。这为动态内容提供了一个干净的基础架构，这明显不同于您所要求的 jsp/servlet 内容。

也就是说，我已经看到应用程序将 jsps 复制到其部署的目录中，以便容器获取并翻译它们。如果您这样做，请注意这会限制您未来的选择：

*   你依赖于你的应用程序被“爆炸”——例如它不能直接从 WAR 存档中运行（这可能会限制你的部署选项）
*   如果您不禁用 scriptlet（如果您确实禁用了，但它会有点困难......），让 jsps 在运行时可编辑可能会打开安全漏洞。禁用 scriptlet 会禁止在 jsps 中使用真正的 Java 代码，那么您将仅限于标记库。
*   您将需要一个运行时可用的 Java 编译器，而您可能不希望在生产系统中拥有它——例如，您不能在部署之前预编译您的 jsps。您还需要在生产系统的运行时支付通常的 jsp-translation-penalty。

用于禁用脚本的 web.xml 配置：

```
<jsp-config>
    <jsp-property-group>
        <url-pattern>*.jsp</url-pattern>
        <scripting-invalid>true</scripting-invalid>
    </jsp-property-group>
</jsp-config> 
```

我希望这个 web.xml 片段能够通过，预览没有正确显示它......

*更新*：试图使 xml-snippet 正确显示。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-12T12:46:20.590

如果我错了，请纠正我，但我认为你的意思是你想要捕获 HTML ......而不是 JSP。JSP 在 servlet 引擎（Web 应用服务器）上处理（到 JAVA 文件），在 HTML 被格式化并通过 Web 服务器（与 Web APP 服务器不同）提供给请求者之后。您无法让 RequestDispatcher 从磁盘直接处理 JSP，因为它尚未被 Web 应用服务器处理。现在，应该可以捕获 JSP 的输出（在 HTML 中），但我以前从未这样做过。可能有一些精巧的 API 比我能解决的知识更丰富，但 HTTP 通常在端口 80 上完成，所以我猜一个人可以读/写 TCPIP 套接字上的端口 80。在此之上可能还有一些事情要做，但至少这是开始研究的一些点。
抱歉，我无法提供更多细节，但见鬼……在这一点上，这对我来说都是理论。

# .net - 使用 ASP.NET MVC 的页面上可以有两个表单吗？

> ID：195439
> 
> 赞同：3
> 
> 时间：2008-10-12T12:39:03.880
> 
> 标签：.net, asp.net-mvc

使用 Web 表单 我知道一个页面上只能有一个 ASP.NET 表单。我已经完成了一些实现，其中我使用 Javascript 将其他表单添加到页面以支持诸如登录控件之类的内容（回发到 Logon.aspx 而不是当前页面）。我想知道每页的单个表单是否仍然存在于 ASP.NET MVC 中，或者是否已取消此限制。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-12T12:41:30.177

您可能希望在 MVC 代码中使用常规 HTML 表单，其中 action 属性指向适当的控制器操作。因此，您可以在页面上拥有任意数量的表单。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T13:22:07.910

使用 ASP.NET MVC，您实际上可以使用任何您想要的表示层。默认视图引擎 ASP.NET Web 表单具有与一种服务器端表单 ( `runat="server"`) 相同的限制，但无论是否使用 MVC，您始终可以使用仅限客户端的表单。

对于仅限客户端的表单（即，没有`runat='server'`，因此被解析为不透明`LiteralControl`解析而不是`HtmlForm`控件的一部分），您不能包含任何需要在服务器端表单中的服务器端控件。

Web窗体的标记（通常在 中**）**调用`<%= code blocks %>`MVC 框架的 API（如`<%= Html.Button() %>`

 *** * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-12T20:50:42.203

您可以拥有尽可能多的 Html 表单，只要您认为有**责任**使用。

# vb.net - 我应该在 VB .NET 中使用“我的”命名空间做什么？

> ID：195450
> 
> 赞同：15
> 
> 时间：2008-10-12T12:48:27.137
> 
> 标签：vb.net

我正在考虑为 VB.NET 构建一个框架，并使用 My 命名空间将其插入 VB 似乎是一个合理的想法。“我的”是干什么用的？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-13T01:32:10.200

据我了解，My 的目的是成为某些常见但难以找到或难以使用的 API 任务的简单快捷方式。您可能不应该将您的框架完全包含在 My. （一方面，使用你的框架的 C# 人可能会不高兴。）

相反，您应该将其设计为普通框架。完成后，列出人们可能希望使用您的框架完成的一些常见任务。看看其中任何一个在 My 下是否有用，尤其是在有可以以多种方式使用的类或方法的情况下，但它们有一个或两个真正常见的用法可以用 My 缩写。

本文展示了如何扩展 My，并在末尾有一节描述了一些要遵循的设计准则： [通过自定义 My 命名空间来简化常见任务](http://msdn.microsoft.com/en-us/magazine/cc188706.aspx#S10)

至于您的主要问题，在 VB .NET 中编码时，我会尽可能多地使用 My 。它将许多操作减少到一行代码。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-12T12:58:47.757

我真的很喜欢 VB.NET 中的“我的”命名空间，而且我总是在我的 WindowsForms 应用程序中使用它，因为它非常直观。

我主要使用这些类别：

*   My.Computer：主要用于文件系统和网络目的
*   My.Application：版本号，当前目录
*   My.Resources：以强类型方式访问驻留在资源文件中的应用程序使用的资源。
*   My.Settings：非常方便

我认为，如果您的框架的 My 扩展非常适合，那么许多 VB.NET 程序员都会喜欢它们。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-14T13:46:41.417

我在我的 VB.NET 项目中使用了 My，对此我并不感到内疚。我主要是 C# 人，但在我将公司转换为 C# 之前，我们是一家 VB 商店。在我看来，My 命名空间是一个很好的语法糖。就像我不尴尬地使用 C# 的合并运算符和其他糖一样，我也不尴尬地使用 VB 的糖。（在一定程度上；我不会使用 .NET 仍然公开的经典 VB 函数。）

也就是说，**永远不要**在该名称空间中放置任何东西。它是 Microsoft 的命名空间，就像您不会在 System 或 Microsoft 下放置任何东西一样，也不要在 My 下放置任何东西。它会在以后引起混乱——如果不是对你，那么对维护你的代码的其他人来说也是如此。为您自己的代码创建自己的命名空间。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-12T13:03:22.397

我们确实在一些代码中使用它，但犹豫不决。确实，这`My`通常有助于使代码更具可读性。例如，`Environment.SpecialFolder`枚举奇怪地缺少一个`Temp`成员，而`My.Computer.FileSystem.SpecialDirectories`有一个（`Path.GetTempPath()`也可以，但与其他特殊文件夹相比很难直观）。

但这`My`仅在这种情况下是有益的，因为现有的 API 设计不佳，而不是因为`My`本质上更好。像 JAGregory 一样，我强烈建议尽可能避免扩展`My`——或任何其他类型的全局命名空间、变量等。这个想法不适合干净的 OOP 架构。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-12T13:16:25.363

我从不使用 My 命名空间（我是 C# 开发人员），但我的 VB 同事也不使用。我发现我的成员没有必要，因为在很多情况下，它们对我来说是违反直觉的，例如，在我看来，打开文件与 IO（因此 System.IO.File）有关，而不是与我的计算机（我的.计算机.文件系统）。他们似乎总是如此分散和聚集在一起。

这只是对所有语言已经可用的功能的重新推出。当我为 .NET 开发时，我不喜欢依赖 Microsoft.VisualBasic.dll - 我总是更喜欢 System.*。

然后，它总是有点有限。当 VB 开发人员在 My 命名空间中找不到某些东西时，我看到 VB 开发人员在他们的应用程序中遇到困难，因为他们无法想象您可以在 System 命名空间中使用某些东西。这当然不是 My 命名空间本身的问题。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-12T12:53:50.683

我主要使用 C# 和 Boo，但是当我使用 VB.NET 时，我经常使用我的命名空间。我看不出有任何理由不简化编码。它仍然保留了它的可读性。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-12T12:55:07.577

我只是从用户的角度使用它，我从来没有插入任何东西。我认为 My 命名空间是一些高度可靠的、平台提供的全局帮助机制。官方认可的捷径，真的。看到外部用户或第三方代码，我可能会感到惊讶。

因此，我鼓励 vb 框架定义自己的适当命名的命名空间，而不是锁定现有的 My 命名空间。这样的框架不应该有那种“全球性”的感觉。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-12T12:58:57.723

到目前为止从未使用过它，尽管我也从未真正研究过它。

我不建议您自己将任何内容放入 My 命名空间中，如果它是一个非 VB 框架，则将其布置得更清楚。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-12T13:31:00.687

爱我的！任何能帮助我更快完成工作，并为我不必编写的解决方案提供代码的东西，那就更好了！

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-26T14:37:05.903

在 VB.NET 中编程时，我经常使用 My.Settings 和 My.Computer。我特别喜欢 My.Settings 作为在适当时使用 ConfigurationManager.AppSettings 的替代方法。

我同意 John Rudy 关于使用 My. 它是语法糖，让生活更具可读性。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-12T14:33:40.997

我不经常使用它。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-12T14:40:51.310

> 我正在考虑为 VB.NET 构建一个框架，并使用 My 命名空间将其插入 VB 似乎是一个合理的想法。是吗？

如果合适，一定要使用它。由于您没有提供有关您的框架的任何进一步信息，因此很难说。我不会将通用的东西放入`My`名称空间（例如`My.Computer`东西），因为将它放在那里并没有任何优势。但是，以应用程序为中心的助手很适合。

# java - 如何在java中获取鼠标中键？

> ID：195451
> 
> 赞同：0
> 
> 时间：2008-10-12T12:48:36.590
> 
> 标签：java, events, mouse

我`public boolean mouseDown(Event ev, int x, int y)`用来检测鼠标的点击。
我可以区分鼠标右键（ev.metaDown() 为真）和左键和中键。

如何区分左侧按钮和中间按钮？或者如果mouseDown不可能，我应该使用什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-12T13:04:16.217

[mouseDown](http://docs.oracle.com/javase/7/docs/api/java/awt/Component.html#mouseDown%28java.awt.Event,%20int,%20int%29)已弃用。MouseEvent 可以访问您所需要的一切。[获取按钮](http://java.sun.com/javase/6/docs/api/java/awt/event/MouseEvent.html#getButton())。跟踪按钮 3。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-06T21:32:26.103

尝试使用[ALT_MASK](http://java.sun.com/javase/6/docs/api/java/awt/Event.html#ALT_MASK)：

> 此标志表示事件发生时 Alt 键已按下。对于鼠标事件，此标志表示按下或释放鼠标中键。

所以你的代码可能是：

```
if (ev.modifiers & Event.ALT_MASK != 0) {
    // middle button was pressed
} 
```

当然，所有这一切都是假设您首先有*充分*的理由使用 mouseDown，因为它已被弃用。您应该（可能）改用[processMouseEvent](http://java.sun.com/javase/6/docs/api/java/awt/Component.html#processMouseEvent(java.awt.event.MouseEvent))，它为您提供了一个 MouseEvent 来玩。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-12T12:53:56.767

这可能会做到：

[http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/SwingUtilities.html#isMiddleMouseButton(java.awt.event.MouseEvent)](http://java.sun.com/j2se/1.5.0/docs/api/javax/swing/SwingUtilities.html#isMiddleMouseButton(java.awt.event.MouseEvent))

自己没试过。

# .net - 受密码保护的 .NET ClickOnce 部署？

> ID：195454
> 
> 赞同：11
> 
> 时间：2008-10-12T12:50:10.627
> 
> 标签：.net, winforms, security, deployment, clickonce

如何**使用密码保护 ClickOnce 部署的应用程序**？我是否必须更改 Web 的 IIS 设置，还是有办法以编程方式进行？我正在使用 Visual Studio 2005 (.NET 2.0)。

如果我必须使用 Web 凭据，是否还可以自动更新应用程序？

如果您能提供一些示例代码或管理 IIS 的详细说明，那就太好了。

谢谢！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-18T14:26:12.833

我自己在这篇 MSDN 文章中找到了一个可能的解决方案：[ClickOnce 部署和安全性](http://msdn.microsoft.com/en-us/library/76e4d2xw.aspx)。

## ASP.NET 基于表单的身份验证

如果要控制每个用户可以访问哪些部署，则不应启用对部署在 Web 服务器上的 ClickOnce 应用程序的**匿名访问。**相反，您将允许用户基于用户身份访问您已安装的部署（使用 Windows NT 身份验证）。

如果您部署到没有 Windows NT 身份验证的环境，解决方案可能是尝试使用**ASP.NET 基于表单的身份验证**来对用户进行身份验证。但是，ClickOnce 不支持基于表单的身份验证，因为它使用持久性 cookie。这些存在安全风险，因为它们驻留在 Internet Explorer 缓存中并且可能被黑客入侵。因此，如果您正在部署 ClickOnce 应用程序，则不支持除 Windows NT 身份验证之外的任何身份验证方案。

## 传递参数

如果您必须将参数传递到 ClickOnce 应用程序，则会出现额外的安全考虑。ClickOnce 使开发人员能够向通过 Web 部署的应用程序提供查询字符串。查询字符串在用于启动应用程序的 URL 末尾采用一系列名称-值对的形式：

```
http://servername.adatum.com/WindowsApp1.application?username=joeuser 
```

默认情况下，查询字符串参数被禁用。要启用它们，**必须在应用程序的部署清单中设置属性 trustUrlParameters**。可以从 Visual Studio 和 MageUI.exe 设置此值。有关如何启用传递查询字符串的详细步骤，请参阅如何：在 ClickOnce 应用程序中检索查询字符串信息。

如果不检查参数以确保它们是安全的，则永远不应将通过查询字符串检索到的参数传递给数据库或命令行。不安全参数是包含数据库或命令行转义字符的参数，这些字符可能允许恶意用户操纵您的应用程序执行任意命令。

*注意：查询字符串参数是在启动时将参数传递给 ClickOnce 应用程序的唯一方法。您不能从命令行将参数传递给 ClickOnce 应用程序。*

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T13:05:16.103

我不确定它是否可以完成。我可能是错的，但我认为这不会奏效。除此之外，即使您的用户输入他们的凭据来获取 .application，运行时也会进行单独的下载，为此它需要匿名访问。

如果您非常想保护客户端，您可能必须想出一种不同的部署方式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-05-26T20:06:41.933

我见过的唯一解决方案是：[单击一次表单验证](http://www.codeproject.com/KB/web-security/ClickOnceFormsAuth.aspx)

We've run into the same problem with trying to secure an application. The one problem with the solution above that I've noticed is that the cookie information is in the URL, which means if someone theoretically intercepted the URL, they could use it to also download the application. Other than that, it seems like a viable solution.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-13T06:30:13.063

ClickOnce 安装程序只是位于您的 Web 服务器上的几个安装程序文件，对吗？因此，您可以对这些文件实施某种目录安全性。我相信你可以在几个不同的层面上做到这一点；例如 IIS 权限或（如果您的用户在您的域中）NTFS 权限。

此外，应该能够以编程方式设置 IIS 权限（实际上是什么？）。

# c# - 如何从 C# 或 F# 访问 IMetaDataEmit 和其他 MetaData COM 接口？

> ID：195455
> 
> 赞同：1
> 
> 时间：2008-10-12T12:50:58.397
> 
> 标签：c#, com, f#, com-interop

我正在用 F# 编写编译器，我希望能够在 .net 运行时访问[非托管元数据 COM 接口](http://msdn.microsoft.com/en-us/library/ms404384.aspx)。在任何人提到它之前，*Reflection.Emit 不适合我的目的*，我也不想使用元数据 COM 接口以外的任何其他方法。

我已经导入了 mscoree.tlb，但它似乎没有包含我需要的接口。

我感兴趣的接口包括[IMetaDataEmit](http://msdn.microsoft.com/en-us/library/ms230877.aspx)。任何与此相关的示例代码都会非常有用，尽管到目前为止我还没有找到。

C# 示例会很好，因为我可以轻松地将它们转换为 F#。

提前感谢任何可以帮助我解决这个相当神秘的查询的人！

**更新：**我现在已经通过使用接口 GUID 编写显式 COM 引用来进行排序！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-03T22:50:54.323

我希望您找到了[mdbg 示例](http://www.microsoft.com/downloads/details.aspx?familyid=38449a42-6b7a-4e28-80ce-c55645ab1310&displaylang=en)，其中包含用于包装您需要的接口的源代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-24T02:29:14.073

这里的一种选择是创建您自己的项目并将这些接口（使用它们在 cor.h 中的定义）编译到类型库中，然后您可以将其 tlbimp 到托管程序集中。我意识到将 C 标头代码转换为 IDL 会非常繁琐，但是这可能会通过一些文本处理脚本来自动化（或部分自动化）。

# windows - 单元测试一个检查互联网连接的模块

> ID：195460
> 
> 赞同：2
> 
> 时间：2008-10-12T12:54:35.033
> 
> 标签：windows, unit-testing, networking, nlm

我有一个 C# 模块负责获取 Windows Vista 机器上“连接到互联网”的网络适配器列表。该模块使用“[网络列表管理器 API](http://msdn.microsoft.com/en-us/library/aa370803(VS.85).aspx) ”（或 NLM API）遍历所有网络连接并返回所有 IsConnectedToInternet 值为 true 的连接。

我收到了一些关于在这个[SO question中实施这个模块的建议](https://stackoverflow.com/questions/38864/how-do-you-find-out-which-nic-is-connected-to-the-internet)

为了测试这个模块，我决定编写一个帮助程序，它基于另一个逻辑返回互联网连接的接口列表，因此这将是对原始模块逻辑的一种“现实检查”。请注意，对于测试助手，我愿意使用可能被认为对生产代码不利的检测方法（例如，依赖一些可用的互联网资源，如“Google”——以防它关闭、被我们的内部防火墙阻止等）。与部署的产品库相比，修复测试相对容易）。

我选择的另一种检测方法是尝试使用 TcpClient 连接到“www.google.com:80”。我的问题：当我有多个连接的适配器（例如无线和 LAN）时，其中一个的检测方法失败，并出现错误“在已连接的套接字上发出连接请求”。

我的问题是三个方面：

1.  一般来说，您将如何测试这样的模块？您是否支持以不同的方式做同样的事情并比较结果的想法，或者这是一种矫枉过正的做法，我应该依赖系统的 API？我在这里的主要问题是，很难预先配置系统，以便我提前知道预期的结果。

2.  你会建议什么替代逻辑？上述问题中建议的一件事是查看路由表 - 是否将每个具有目的地为 0.0.0.0 的路由条目的适配器视为“已连接到 Internet”？其他建议？

3.  你明白为什么我在当前的测试逻辑中得到“已经连接”的错误吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-12T13:40:40.387

我只能回答你关于单元测试的问题。

用您自己的话来说，您正在测试的代码是“一个 C# 模块，负责获取 Windows Vista 机器上‘连接到互联网’的网络适配器列表。该模块使用‘网络列表管理器 API’（或 NLM API）迭代所有网络连接并返回所有 IsConnectedToInternet 值为 true 的连接。”

如果我正在编写这个模块，我会首先使用 NLM API 的接口，将其命名为...NLMAPIService。现在，对于真实的代码，创建一个实现 NLMAPIService 并适配真实 NLM API 的 Adapter。

为了测试，创建一个实现 NLMAPIService 的 FakeNLMAPI 类，并将其所有数据保存在内存中的某个地方，或者在 XML 文件中，或其他任何地方。您的模块仅在 NLMAPIService 上调用方法，因此您不必根据是否正在测试更改任何“真实”代码。

因此，在您的测试设置方法中，您可以实例化 FakeNLMAPI 并将其传递给您的模块，并在生产中实例化您的 NLM API 适配器。

我将假设您可以实例化和修改表示网络连接的对象。如果没有，您可以按照相同的模式来伪造实际的网络连接对象。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-12T13:42:24.220

依赖注入是处理此类问题的一种非常方便的模式。不是简单地在代码中直接使用 NLM API 组件，而是定义一个接口和一个实现它并充当 NLM API 代理的类。在构造函数中将此类的实例传递给您的模块并让您的模块使用它。在您的单元测试中，使用返回已知信息的模拟对象而不是真正的代理对象——它甚至不必引用 NLM API——来用于测试模块的逻辑。当然，您的代理类也需要一些测试，但其中的逻辑要简单得多——可能只是一些数据封送处理。您可能能够说服自己它的正确性，或者，如果不是，则对其进行一些手动测试以确保其正常工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-12T13:22:45.740

UnitTests 不应访问外部资源。为了对您的方法进行单元测试，我将删除网络列表管理器 API。

您仍然需要一个验收测试层。在该测试环境中，您应该复制您希望在您的环境中支持的各种配置，设置您自己的虚拟主机、路由器、机器配置。验收测试应该使用像 Fitnesse 这样的工具在用户体验级别进行。

# java - 在字符串方法参数上同步java中的io操作？

> ID：195468
> 
> 赞同：2
> 
> 时间：2008-10-12T13:03:59.897
> 
> 标签：java, multithreading, synchronization, io

基本上，我有一个具有 2 种方法的类：一种将对象序列化为 XML 文件，另一种用于从 XML 读取对象。这是恢复对象的方法中同步部分的示例：

```
 public T restore(String from) throws Exception {
     // variables declaration
        synchronized (from) {
            try {
                decoder = new XMLDecoder(new BufferedInputStream(
                        new FileInputStream(from)));
                restoredItem = decoder.readObject();
                decoder.close();
            } catch (Exception e) {
                logger.warning("file not found or smth: " + from);
                throw new Exception(e);
            }
        }
    // try to cast it
    } 
```

序列化对象时采用类似的方法。现在，当我创建一个单元测试时，它依次创建 10 个线程，每个线程尝试序列化并立即读取布尔值或字符串，它会失败，表明发生 ClassCastExceptions。这让我觉得我弄错了序列化（在单线程环境中一切正常）。如果你一直和我在一起:)，这里有两个问题我需要你的帮助：

1.  对传递给方法的字符串参数进行同步是否有意义（考虑到 java 中有一个字符串池）？顺便说一句，我尝试在 XMLSerializer 类本身上进行同步，结果保持不变。
2.  如何正确同步单个文件的 io 操作？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-12T18:10:49.153

1\. 是的，可以在字符串上同步，但是您需要在字符串上同步。[intern()](http://java.sun.com/javase/6/docs/api/java/lang/String.html#intern())以便始终获得相同的对象

```
StringBuffer sb = new StringBuffer(); sb.append("a").append("b");
String a = new String(sb.toString());
String b = new String(sb.toString());
a == b; //false
a.equals(b); //true
a.intern() == b.intern(); //true 
```

由于您想在同一台监视器上同步，因此您需要 intern()。

2\. 您可能不想在 String 上同步，因为它可能会在其他地方同步，在您的代码内部、在第 3 方或在 JRE 中。如果我想保持同步，我会做的是创建一个 ID 类（它可能只包含字符串），覆盖 equals() 和 hashcode() 以匹配，把它放在一个 WeakHashMap 中，同时作为键和值（请参阅 IdentityHashMap 了解原因）并仅使用地图中的我 .get() (sync map{ syncKey = map.get(new ID(from)); if syncKey==null create and put new key} sync{syncKey} ）。

3\. 再说一次，我会放弃所有同步并使用 java.util.concurrent.locks.Lock 代替，在与上述相同的设置中，只是将锁附加到 ID。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-12T13:16:12.230

鉴于您的代码的某些部分丢失了，我敢打赌，问题在于在字符串上同步。您不能随意假设字符串是池化的（这会破坏您的同步方案）。

最好的方法是添加一个将键（字符串）与其实际同步对象相关联的映射。

除此之外，我建议使用多线程测试，看看是什么导致它失败。例如，如果你让所有线程只存储字符串值（而不是字符串或 beooleans），测试是否仍然失败？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-12T14:13:12.927

这种方法存在许多问题。

1.  除非您调用了 String.intern，否则您的 from 字符串可能与您正在调用的另一个字符串不同。依赖内部 java 字符串缓存的行为不是很健壮。

2.  您没有在 finally 块中正确处理您的 XMLDecoder，在该调用期间引发的任何异常都会泄漏与该 FileInputStream 关​​联的文件描述。

3.  您不需要将 e 包装在另一个 Exception(e) 中，您只需抛出 e，因为您已声明封闭方法也会抛出 Exception

4.  捕获/抛出异常是一种代码异味。是的，它是 IOException 的超类，可能会引发任何 XML 解码异常，但它也是一堆您可能不想捕获的其他东西的超类，例如 NullPointerException。

要回答您的问题，如何序列化对共享文件的访问以确保其不被多个线程使用，这很棘手。FileChannel.lock() 在 JVM 中不起作用，它们只是锁定文件不被机器中的其他进程修改。

我的方法是从此类中剥离任何锁定并将其包装在了解代码线程问题的东西中。

我也不会传递一个字符串作为文件名，而是一个文件，它使您能够使用 File.createTempFile(2) 在写入 xml 的事物和读取 xml 的事物之间创建不透明的文件名。

最后，您是要同步对共享文件的访问，还是在检测到对同一文件的多个访问时失败？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-12T17:05:51.720

一个 String 不能很好地制作一个好的互斥体，但可以用来创建一个：[Java：在 ID 上同步](http://illegalargumentexception.blogspot.com/2008/04/java-synchronizing-on-transient-id.html)。

# c# - C# 检查 COM（串行）端口是否已打开

> ID：195483
> 
> 赞同：23
> 
> 时间：2008-10-12T13:24:38.313
> 
> 标签：c#, .net, serial-port

是否有一种简单的方法可以以编程方式检查串行 COM 端口是否已打开/正在使用？

通常我会使用：

```
try
{
    // open port
}
catch (Exception ex)
{
    // handle the exception
} 
```

但是，我想以编程方式进行检查，以便我可以尝试使用另一个 COM 端口或类似的端口。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-12T13:38:59.233

前段时间我需要类似的东西来搜索设备。

我获得了可用 COM 端口的列表，然后简单地遍历它们，如果它没有引发异常，我尝试与设备通信。有点粗糙但工作。

```
var portNames = SerialPort.GetPortNames();

foreach(var port in portNames) {
    //Try for every portName and break on the first working
} 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2011-02-19T17:57:14.547

我是这样做的：

```
 [DllImport("kernel32.dll", CharSet = CharSet.Auto, SetLastError = true)]
    internal static extern SafeFileHandle CreateFile(string lpFileName, int dwDesiredAccess, int dwShareMode, IntPtr securityAttrs, int dwCreationDisposition, int dwFlagsAndAttributes, IntPtr hTemplateFile); 
```

然后稍后

```
 int dwFlagsAndAttributes = 0x40000000;

        var portName = "COM5";

        var isValid = SerialPort.GetPortNames().Any(x => string.Compare(x, portName, true) == 0);
        if (!isValid)
            throw new System.IO.IOException(string.Format("{0} port was not found", portName));

        //Borrowed from Microsoft's Serial Port Open Method :)
        SafeFileHandle hFile = CreateFile(@"\\.\" + portName, -1073741824, 0, IntPtr.Zero, 3, dwFlagsAndAttributes, IntPtr.Zero);
        if (hFile.IsInvalid)
            throw new System.IO.IOException(string.Format("{0} port is already open", portName));

        hFile.Close();

        using (var serialPort = new SerialPort(portName, 115200, Parity.None, 8, StopBits.One))
        {
            serialPort.Open();
        } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2020-08-07T17:33:32.180

`SerialPort.GetPortNames();`对于因为没有定位而无法使用的人`.net framework`（比如在我的情况下，我使用的是 .Net Core 而不是 .Net Framework），这就是我最终要做的事情：

在命令提示符下，如果您键入 mode，您会得到如下内容：

[![在此处输入图像描述](https://i.stack.imgur.com/sE7VW.png)](https://i.stack.imgur.com/sE7VW.png)

mode 是一个可执行文件，位于`C:\Windows\System32\mode.com`. 只需使用如下正则表达式解析该可执行文件的结果：

```
// Code that answers the question

var proc = new Process
{
    StartInfo = new ProcessStartInfo
    {
        FileName = @"C:\Windows\System32\mode.com",
        UseShellExecute = false,
        RedirectStandardOutput = true,
        CreateNoWindow = true
    }
};

proc.Start();
proc.WaitForExit(4000); // wait up to 4 seconds. It usually takes less than a second

// get ports being used
var output = proc.StandardOutput.ReadToEnd(); 
```

现在，如果您想解析输出，我就是这样做的：

```
List<string> comPortsBeingUsed = new List<string>();
Regex.Replace(output, @"(?xi) status [\s\w]+? (COM\d) \b ", regexCapture =>
{
    comPortsBeingUsed.Add(regexCapture.Groups[1].Value);
    return null;
});

foreach(var item in comPortsBeingUsed)
{
    Console.WriteLine($"COM port {item} is in use");
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2021-02-23T09:31:50.520

我想打开下一个可用端口并这样做。请注意，它不是针对 WPF 而是针对 Windows 窗体的。我用可用的 com 端口填充了一个组合框。然后我尝试打开第一个。如果失败，我从组合框中选择下一个可用项目。如果选择的索引最终没有改变，则没有可用的备用 com 端口，我们会显示一条消息。

```
private void GetPortNames()
{
    comboBoxComPort.Items.Clear();
    foreach (string s in SerialPort.GetPortNames())
    {
        comboBoxComPort.Items.Add(s);
    }
    comboBoxComPort.SelectedIndex = 0;
}

private void OpenSerialPort()
{
    try
    {
        serialPort1.PortName = comboBoxComPort.SelectedItem.ToString();
        serialPort1.Open();
    }
    catch (Exception ex)
    {
        int SelectedIndex = comboBoxComPort.SelectedIndex;
        if (comboBoxComPort.SelectedIndex >= comboBoxComPort.Items.Count - 1)
        {
            comboBoxComPort.SelectedIndex = 0;
        }
        else
        {
            comboBoxComPort.SelectedIndex++;
        }
        if (comboBoxComPort.SelectedIndex == SelectedIndex)
        {
            buttonOpenClose.Text = "Open Port";
            MessageBox.Show("Error accessing port." + Environment.NewLine + ex.Message, "Port Error!!!", MessageBoxButtons.OK);
        }
        else
        {
            OpenSerialPort();
        }
    }

    if (serialPort1.IsOpen)
    {
        StartAsyncSerialReading();
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-12T13:39:11.823

[SerialPort 类](http://msdn.microsoft.com/en-us/library/system.io.ports.serialport.aspx)有一个[*Open*](http://msdn.microsoft.com/en-us/library/system.io.ports.serialport.open.aspx)方法，它会抛出一些异常。上面的参考资料包含详细的例子。

另请参见[IsOpen](http://msdn.microsoft.com/en-us/library/system.io.ports.serialport.isopen.aspx)属性。

一个简单的测试：

```
using System;
using System.IO.Ports;
using System.Collections.Generic;
using System.Text;

namespace SerPort1
{
class Program
{
    static private SerialPort MyPort;
    static void Main(string[] args)
    {
        MyPort = new SerialPort("COM1");
        OpenMyPort();
        Console.WriteLine("BaudRate {0}", MyPort.BaudRate);
        OpenMyPort();
        MyPort.Close();
        Console.ReadLine();
    }

    private static void OpenMyPort()
    {
        try
        {
            MyPort.Open();
        }
        catch (Exception ex)
        {
            Console.WriteLine("Error opening my port: {0}", ex.Message);
        }
    }
  }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-01-23T13:43:32.563

分享对我有用的东西（一个简单的辅助方法）：

```
private string portName { get; set; } = string.Empty;

    /// <summary>
    /// Returns SerialPort Port State (Open / Closed)
    /// </summary>
    /// <returns></returns>
    internal bool HasOpenPort()
    {
        bool portState = false;

        if (portName != string.Empty)
        {
            using (SerialPort serialPort = new SerialPort(portName))
            {
                foreach (var itm in SerialPort.GetPortNames())
                {
                    if (itm.Contains(serialPort.PortName))
                    {
                        if (serialPort.IsOpen) { portState = true; }
                        else { portState = false; }
                    }
                }
            }
        }

        else { System.Windows.Forms.MessageBox.Show("Error: No Port Specified."); }

        return portState;
} 
```

**注意：**
- 对于更高级的技术，我建议使用[ManagementObjectSearcher 类](https://docs.microsoft.com/en-us/dotnet/api/system.management.managementobjectsearcher?view=netframework-4.8)。
更多信息[在这里](https://docs.microsoft.com/en-us/dotnet/api/system.management.managementobjectsearcher?view=netframework-4.8)。
- 对于 Arduino 设备，我会让端口保持打开状态。
- 如果您需要捕获异常，建议使用 Try Catch 块。
- 另请查看：“TimeoutException”
- 有关如何在[此处](https://docs.microsoft.com/en-us/dotnet/api/system.io.ports.serialport.open?view=netframework-4.7.2)获取 SerialPort（打开）异常的更多信息。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-04-02T07:45:03.167

```
 public void MobileMessages(string ComNo, string MobileMessage, string MobileNo)
    {
        if (SerialPort.IsOpen )
            SerialPort.Close();
        try
        {
            SerialPort.PortName = ComNo;
            SerialPort.BaudRate = 9600;
            SerialPort.Parity = Parity.None;
            SerialPort.StopBits = StopBits.One;
            SerialPort.DataBits = 8;
            SerialPort.Handshake = Handshake.RequestToSend;
            SerialPort.DtrEnable = true;
            SerialPort.RtsEnable = true;
            SerialPort.NewLine = Constants.vbCrLf;
            string message;
            message = MobileMessage;

            SerialPort.Open();
            if (SerialPort.IsOpen  )
            {
                SerialPort.Write("AT" + Constants.vbCrLf);
                SerialPort.Write("AT+CMGF=1" + Constants.vbCrLf);
                SerialPort.Write("AT+CMGS=" + Strings.Chr(34) + MobileNo + Strings.Chr(34) + Constants.vbCrLf);
                SerialPort.Write(message + Strings.Chr(26));
            }
            else
                ("Port not available");
            SerialPort.Close();
            System.Threading.Thread.Sleep(5000);
        }
        catch (Exception ex)
        {

                message.show("The port " + ComNo + " does not exist, change port no ");
        }
    } 
```

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-11-29T14:52:58.147

您可以尝试以下代码来检查端口是否已打开。我假设您不知道具体要检查哪个端口。

```
foreach (var portName in Serial.GetPortNames()
{
  SerialPort port = new SerialPort(portName);
  if (port.IsOpen){
    /** do something **/
  }
  else {
    /** do something **/
  }
} 
```

# vim - 为什么像 Vim 和 Emacs 这样的旧编辑器在界面中暴露了 File 和 Buffer 之间的区别？

> ID：195485
> 
> 赞同：12
> 
> 时间：2008-10-12T13:27:09.070
> 
> 标签：vim, emacs, editor

我的问题有意义吗？使用 Vim 或 Emacs，您会了解到该接口公开了代码在缓冲区中对您正在编辑的文件状态的表示，该文件是您可以填充缓冲区或写入缓冲区的磁盘存储。所有这些事情程序员都会知道，但是当只是编辑文本时，为什么会暴露出来？任何较新的编辑器只会告诉您“这是一个文件。编辑它。”

是的，我理解*技术*含义，但这不是我的问题。这是一个问题，即使这样做是否是个好主意。Vim 和 Emacs 是我们今天常用的两个最古老的编辑器，它们也有这种行为。我知道没有新的编辑器能做到这一点。编辑什么时候停止这样做，为什么？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-10-12T14:44:46.683

对于初学者，Emacs 使用了大量与任何文件无关的缓冲区。每当您打开目录、阅读邮件、打开终端、编译程序、启动交互式 Python 会话或连接到数据库时，您都会得到一个缓冲区。因此，Emacs 的基本工作单元是缓冲区而不是文件，同样的逻辑也适用于 Vim。

*仅*编辑文件的新应用程序没有区别，因为每个屏幕、窗口或选项卡都直接代表一个文件。Emacs 和 Vim 等功能更强大的应用程序在这方面要灵活得多。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-12T16:32:09.917

好的，这是我奇怪的哲学答案：

因为编辑器中的缓冲区与您正在处理的实际具体事物之间的**后期绑定为编辑环境提供了更大的灵活性和功能。**

认为这已经过时了吗？一个想法回归的地方是在*浏览器*中，标签和网页之间没有 1-1 的对应关系。相反，在每个选项卡内，您可以在多个页面之间前后导航。没有人会尝试为 Web 制作 MDI 类型的界面，其中每个页面都有自己的内部窗口。这将是不可能的繁琐使用。它只是无法*扩展*。

就个人而言，我认为现在 IDE 变得太复杂了，文档和缓冲区之间的静态绑定是造成这种情况的原因之一。我希望在他们转向类似浏览器的选项卡式缓冲区模型时会在某个时候取得突破，其中：

a）您将能够在同一个缓冲区/选项卡中的多个文件之间建立超链接（并且会有一个后退按钮等）

b) 通用缓冲区将能够保存任何*类型*的数据：源代码、命令行、动态生成的图形输出、项目大纲等。

换句话说，大部分 Vim / Emacs 模型，除了经过调整以更符合浏览器正在做出的发现。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-12T14:32:36.083

因为多个缓冲区可以向您显示同一文件的不同视图。我不知道其他编辑器，但 Emacs 确实如此。你到底是什么意思与老？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T15:55:01.427

当应用程序开始被那些不想用不相关的细节困扰自己的非极客们大量使用时。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-12T13:36:14.403

我认为新编辑放弃这样做的原因是你所说的，它是一种抽象，只会妨碍你。此外，大多数现代编辑器都具有无限撤消功能，因此“缓冲区”的概念是隐含的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-12T14:21:13.173

我想我只是一个老顽固（在顽固的 vim 阵营中），但我使用的其他编辑包，如 MS Word 或 Open Office，保留了我正在编辑的文件副本和最后保存的版本。这绝对是无价之宝——我不希望编辑践踏我的最后一个好版本，直到我准备好这样做。确实，有很大的机会（比如千分之一）我将使用正在编辑的缓冲区创建一个新文件。

另一方面，通过读取多个文件（同一文件的多个副本或多个不同文件的副本）来创建文件映像的能力也很有用。其他文件中也有类似的设施。

所以，我可能会漏掉重点——我不知道您指的是哪些编辑器消除了区别。但我认为所有编辑器都会保留您正在编辑的文件副本与保存到磁盘的最后一个版本之间的区别。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-10-12T16:02:38.163

因为这些编辑器的开发人员并不关心向用户隐藏实现细节。

# c++ - C++ 中的 I18N 资源

> ID：195497
> 
> 赞同：16
> 
> 时间：2008-10-12T13:40:48.607
> 
> 标签：c++, internationalization

我正在玩 c++ 中的语言环境和 I18N 的东西，并且一直在寻找真实世界的例子。我在他的[书中](http://www.josuttis.com/libbook/)通读了 Josuttis 关于 I18N 的章节（C++11 的第 2 版将于 2012 年 4 月发布），发现它很有用，但没有可供借鉴的真实世界示例我不知道我是否遵循最佳实践正在犯初学者错误。StackOverflow 可以为我在网络上和印刷品上提供哪些资源来用 C++ 做 I18N 的东西？

还有哪些可用于 C++ 的库使 i18n 更容易？标准库中没有什么需要？乍一看，标准库中似乎不存在 UTF8 支持。

编辑：

在做了更多阅读之后，似乎 C 和 C++ 都是 Unicode“不可知论者”。似乎还需要使用第三方库来处理以 Unicode/UTF8/16/32 编码的数据。关键在于标准库本身只考虑 ISO 8859 和相关字符页面，这些页面会根据您的语言环境设置而变化。这意味着我可能想将 ICU 库用于字符串，而不是`std::string`使用`std::wstring`.

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-12T14:14:27.947

您已经被指向[GNU gettext](http://www.gnu.org/software/gettext/)，它允许您在运行时用本地化版本替换文字字符串 - 本地化的一个方面（这是在您完成国际化之后发生的事情，当有人实际使用您的国际化代码时语言环境）。您还被指向了[Boost](http://www.boost.org/)（特别是[Boost.Locale](http://www.boost.org/doc/libs/1_61_0/libs/locale/doc/html/index.html)）库；对于与 C++ 相关的任何事情，这通常是一个很好的答案。

您可能会看到的另一个地方是[ICU](http://www.icu-project.org/)（Unicode 的国际组件）项目。作为数据源，您可以将[CLDR](http://unicode.org/cldr/)（通用区域设置数据存储库）视为有关不同区域设置的信息源；Unicode 网站也有很多关于不同文化其他方面的信息，因为它涉及多种语言。

作为目前的最后一个资源，一个相当专业的资源，有[奥尔森时区数据库](http://en.wikipedia.org/wiki/tz_database)，它每年都会更新多次，以跟踪不同国家如何改变他们关于何时在冬季和夏季之间改变的规则（夏令时和标准）时间。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-12T14:51:18.760

看看[wxWidgets](http://wxwidgets.org/)的国际化示例。[它具有gettext](http://www.gnu.org/software/gettext/)中使用的翻译机制的非 gnu 实现（前面提到过）。您甚至可以在商业应用程序中使用它，因为 wxWidgets 许可证允许您这样做。

如果您只是在寻找一种将应用程序国际化的方法，那么 gettext 就是起点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T13:42:12.940

看看[GNU gettext](http://www.gnu.org/software/gettext/manual/gettext.html)

知道您使用的是哪个 C++ 库会很有趣，因为一些 GUI 库已经提供 i18n 支持。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T13:52:37.630

我第二个 GNU gettext。然而，如果你使用 Qt（如果你想用 C++ 做 GUI，机会很大），Qt 有它自己的 gettext 版本和一个很好的翻译工具（Qt Linguist），它使事情变得更容易，也可以使用从非 GUI 应用程序无需开销。我们甚至在服务中也有它。

然而，关于 C++ 缺乏什么，我想到的是：

*   完全支持有关数字、日期或货币的区域设置。请记住，语言环境的不同不仅仅是小数分隔符，包括排序，这让我想到了第二点：
*   C++ 本身没有支持有序参数的格式函数（因为在另一种语言中，词序可能与您的语言不同）。您可以为此使用 boost::format 。Qt 当然也支持它。

还要看看你必须为自己做什么，即使这些事情得到支持。例如，.NET 带有一个完整的可供使用的语言环境列表。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-12T15:06:10.633

对于 UTF-8 支持，请查看[UTF-8 CPP](http://utfcpp.sourceforge.net/)库。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2009-11-15T20:40:14.507

You do not need libraries to accomplish this task. See the MS guide for Satellite DLLs [here](http://support.microsoft.com/kb/188659).

If you specify to use Unicode in the project settings and use Unicode String functions (instead of char) then the standard use of Satellite DLLs to hold locale specific data (dialog boxes, Strings etc) will be enough.

Windows itself will take care of finding the correct resource so long as the DLL is correctly named. The suffixs needed for the satellite DLLs are [here](http://www.microsoft.com/globaldev/reference/winxp/langtla.mspx) .

# asp.net - 将请求切换到特定于请求域的内容

> ID：195504
> 
> 赞同：0
> 
> 时间：2008-10-12T13:49:18.933
> 
> 标签：asp.net, apache, iis

假设我的网络服务器上有几个网站，所有网站都是一个域下的应用程序。我如何注册其他域以指向同一个 Web 服务器，并将请求重定向到，例如链接到请求域的网站？

我知道我必须有一个根站点，我猜我可能必须在这个根站点的请求管道中做一些巫术，并将更改的请求发送到相关的子站点。

例如，我希望*acme.net*和*ajax.net*都指向与*root.net*相同的地址。当浏览器请求*acme.net*时，应该提供*acme.root.net*或*root.net/acme*的内容，但用户仍必须在其地址栏中看到*acme.net*

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-12T13:58:16.607

在 Apache 上，您可以执行以下操作：

```
NameVirtualHost *:80

<VirtualHost *:80>
   ServerName acme.net
   DocumentRoot C:/www/
</VirtualHost>

<VirtualHost *:80>
   ServerName acme.root.net
   DocumentRoot C:/www/
</VirtualHost> 
```

我希望它对你有用。

# winforms - RichTextBox 和下划线颜色

> ID：195507
> 
> 赞同：7
> 
> 时间：2008-10-12T13:54:56.987
> 
> 标签：winforms, colors, pinvoke, richtextbox, underline

有什么办法可以改变 a 中下划线的颜色`RichTextBox`吗？我已经尝试过[了，](http://geekswithblogs.net/pvidler/archive/2003/10/15/188.aspx)但它似乎不起作用。有人知道这些枚举值是从哪里来的吗？没有看到任何文档。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-12T13:59:45.840

枚举值是将消息传递给控件时的标准窗口值。文章没有提到的一件事是，您需要在其中选择一个文本`RichTextBox`才能对其应用格式，所以也许这就是缺少的。

# c# - 如何获取 Windows 中可用 COM 接口的列表

> ID：195508
> 
> 赞同：4
> 
> 时间：2008-10-12T13:55:32.180
> 
> 标签：c#, com, com-interop

有没有办法在 Windows 机器上获取已注册的 COM 接口列表，带有 GUID？

在有人认为这与编程无关之前，我需要这些数据以便在 F#（或 C#）中为 tlbimp 未公开的接口引用 COM 接口。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2020-07-16T13:37:14.013

多年来，该领域已经有许多应用程序。

*   [COMView](https://www.japheth.de/COMView.html)
*   [Embarcadero 的 TypeLibrary Explorer](http://docs.embarcadero.com/products/rad_studio/delphiAndcpp2009/HelpUpdate2/EN/html/devcommon/inspecttypelib_xml.html)
*   [类型库查看器和转换工具 (Microsoft)](https://docs.microsoft.com/en-us/windows/win32/com/type-library-viewers-and-conversion-tools)
*   [PxPlus 类型库浏览器](https://manual.pvxplus.com/PXPLUS/PxPlus%20User%20Guide/External%20Components/PxPlus%20Type%20Library%20Browser/Overview.htm)

我最近使用了 COMView。仍然有效。

# javascript - Javascript 是密码学的合适平台吗？或者，可以吗？

> ID：195509
> 
> 赞同：5
> 
> 时间：2008-10-12T13:55:48.950
> 
> 标签：javascript, security, language-agnostic, cryptography

很久以前，我注意到 Wikipedia 链接到不同哈希函数的[Javascript 实现](http://pajhome.org.uk/crypt/md5/)。还发现了[Clipperz Crypto](http://www.clipperz.com/open_source/javascript_crypto_library)。甚至 Mozilla 在 Firefox 中实现了一个[加密对象](http://developer.mozilla.org/en/JavaScript_crypto)。

那么，*Javascript 是一个合适的密码学平台吗？或者，可以吗？*
或者，我想.. 在 POST 之前散列数据有什么目的或好处吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-12T14:32:27.973

Javascript 中有一些散列函数的用途，例如验证验证码客户端（通过将会话中的散列与输入中的计算散列进行比较）。显然，用途是有限的，因为它几乎只在客户端运行（并且您不能信任客户端输入），但潜力是存在的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T14:16:28.690

您可以使用 JavaScript 加密数据；但是我不确定这些好处。因为如果您使用的是 bas64，则需要将加密密钥发送给客户端，如果有人可以拦截加密信息，他/她可能也可以拦截加密密钥。

您永远不应该使用它来替换 SSL 证书。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T20:10:22.877

您永远无法将 javascript 用作传输安全数据的安全平台...

但是可以在客户端制作 md5 或其他类型的加密，这为您提供了一种相当安全的验证方式，您可以在服务器端进行测试！-)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-10-06T17:25:12.650

这些博客文章描述了 JavaScript 中密码学的重要用途：

为了安全地识别自己：

[http://digitalbazaar.com/2010/08/07/webid/](http://digitalbazaar.com/2010/08/07/webid/)

通过网站为带有嵌入式服务器的本地主机应用程序提供安全接口：

[http://digitalbazaar.com/2010/07/20/javascript-tls-1/](http://digitalbazaar.com/2010/07/20/javascript-tls-1/)

[http://digitalbazaar.com/2010/07/20/javascript-tls-2/](http://digitalbazaar.com/2010/07/20/javascript-tls-2/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-12T14:09:09.190

我不明白为什么不能使用 javascript 实现加密功能。

然而..密码学是一个资源密集型的过程。

与编译代码相比，Javascript 是 slooooooow。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-13T22:19:05.127

我可以看到至少一种用途：如果您要发送客户端加密数据，然后根据用户在本地输入的密钥/密码在 JavaScript 中对其进行解密。这以您最初在服务器上加密数据时使用的共享密钥或已知密码为前提。此外，这些函数经常被恶意和/或混淆的 JavaScript 使用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-18T10:41:30.167

答案取决于你想做什么。

如果您想在客户端、离线、持久的 Web 应用程序上使用密码术，那么可以。例如，您是否想使用 HTML 5 规范“globalStorage()”加密存储在嵌入式数据库中的所有数据。然后使用 javascript 加密，因为您可能没有连接来处理服务器端的所有加密。

如果不使用久经考验的方法

# internet-explorer - 来自 IE 的历史数据

> ID：195510
> 
> 赞同：0
> 
> 时间：2008-10-12T13:56:36.577
> 
> 标签：internet-explorer

Internet Explorer 在哪里存储历史数据，即访问过的 URL 列表？我正在使用 Windows XP SP3 和 IE7。基本上，我想阅读 URL 列表并对访问页面的频率进行一些统计。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-12T14:00:47.770

Internet Explorer 似乎将其历史记录保存在 C:\Documents and Settings\USERNAME\Local Settings\History\History.IE5 下的隐藏目录中。请注意，此路径中的某些目录也标记为隐藏或系统。历史记录的格式是不透明的，但[CodeProject](http://www.codeproject.com/KB/system/IECache.aspx)中有可以解码内容的代码。您还可以在 HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\TypedURLs 下找到键入的 URL 列表。

更简单的替代方法可能是在 IE 和 Internet 之间设置 HTTP 代理，然后检查代理的日志。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T02:36:40.757

正确的方法是 CoCreate(CLSID_CUrlHistory, IID_IUrlHistoryStg) 并调用[IUrlHistoryStg::EnumUrls()](http://msdn.microsoft.com/en-us/library/aa767720(VS.85).aspx)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T14:01:20.127

它存储在注册表中：

HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\TypedURLs

# terminology - 什么是意大利面条代码？

> ID：195520
> 
> 赞同：32
> 
> 时间：2008-10-12T14:04:49.447
> 
> 标签：terminology, anti-patterns

你能发布一个真实的，过度的意大利面条代码的简短示例，可能会说明它的作用吗？你能告诉我一个小调试器的噩梦吗？

我不是说[IOCCC](http://www0.us.ioccc.org/main.html)代码，那是科幻小说。我的意思是发生在你身上的现实生活中的例子......

### 更新

重点已经从“发布一些意大利面条代码”变为“究竟什么是*意大利*面条代码？”。从历史的角度来看，目前的选择似乎是：

*   大量使用计算 goto 的旧 Fortran 代码
*   使用 ALTER 语句的旧 Cobol 代码

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-11-28T13:35:57.660

对我来说，一个更**现代**的意大利面条代码示例是当您有 20 个 dll 并且每个 DLL 以一种或另一种方式相互引用时。您的依赖关系图看起来像一个巨大的 blob，并且您的代码到处乱跳，没有真正的顺序。一切都是相互依赖的。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2010-07-28T13:49:12.937

我不会把这个从我的脑海中拉出来。这就是我必须使用的，尽管是简化的。假设基本上你有一个需要枚举的程序：

```
enum {
   a, b, c;
} myenum; 
```

但相反，我们拥有的是

```
HashTable t;
t["a"] = 0;
t["b"] = 1;
t["c"] = 2; 
```

但是当然，没有一个哈希表的实现是足够好的，所以有一个哈希表的本地实现，它包含的代码比普通的开源实现多出大约 10 倍，只有一半的功能和双倍的错误数量。HashTable 实际上是定义为虚拟的，并且有一个工厂 HashTableFactory 来创建 HashTables 的实例，但是对于模式 HashTableFactory 也是虚拟的。为了防止虚拟类的无限级联，有一个函数

```
HashTableFactory *makeHashTableFactor(); 
```

*因此，在代码需要myenum*的任何地方，它都会引用 HashTable 和 HashTableFactory 的实例，以防您想要制作更多的 HashTable。但是等等，这还不是全部！这不是哈希表的初始化方式，而是通过编写读取 XML 的代码来完成的：

```
<enum>
  <item name="a" value="0"/>
  <item name="b" value="1"/>
  <item name="c" value="2"/>
</enum> 
```

并插入到哈希表中。但是代码是“优化的”，因此它不会读取 ascii 文件 myenum.xml，而是有一个编译时脚本生成：

```
const char* myenumXML = [13, 32, 53 ....]; 
```

从 myenum.xml 和哈希表由一个函数初始化：

```
void xmlToHashTable(char *xml, HashTable *h, HashTableFactory *f); 
```

这就是所谓的：

```
HashTableFactory *factory = makeHashTableFactory();
HashTable *t = facotry.make();
xmlToHashTable(myenumXML, t, f); 
```

好的，所以我们有很多代码来获取枚举结构。它基本上用在一个函数中：

```
void printStuff(int c) {
   switch (c) {
   case a: print("a");
   case b: print("b");
   case c: print("c");
   }
} 
```

这在以下情况下被调用：

```
void stuff(char* str) {
   int c = charToEnum(str);
   printStuff(c);
} 
```

所以我们实际上拥有的是

```
void stuff(char *str) {
   printf(str);
} 
```

我们已经设法生成了数千行代码（私有的新代码、错误代码、复杂代码、哈希表的实现以及 xml 读取器和写入器）来代替上述 3。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-11-28T13:47:51.147

还有[馄饨代码](http://en.wikipedia.org/wiki/Spaghetti_code#Ravioli_code)，这是相反的。漂亮的小块功能，干净的界面整齐地包裹着丰富的内容，所有这些都坐落在一个漂亮的框架酱汁中。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-10-12T14:36:56.997

从 Linux SCSI 驱动程序（应保持匿名以保护有罪者）：

```
wait_nomsg:
        if ((inb(tmport) & 0x04) != 0) {
                goto wait_nomsg;
        }
        outb(1, 0x80);
        udelay(100);
        for (n = 0; n < 0x30000; n++) {
                if ((inb(tmport) & 0x80) != 0) {        /* bsy ? */
                        goto wait_io;
                }
        }
        goto TCM_SYNC;
wait_io:
        for (n = 0; n < 0x30000; n++) {
                if ((inb(tmport) & 0x81) == 0x0081) {
                        goto wait_io1;
                }
        }
        goto TCM_SYNC;
wait_io1:
        inb(0x80);
        val |= 0x8003;          /* io,cd,db7  */
        outw(val, tmport);
        inb(0x80);
        val &= 0x00bf;          /* no sel     */
        outw(val, tmport);
        outb(2, 0x80);
TCM_SYNC:
/* ... */
small_id:
        m = 1;
        m <<= k;
        if ((m & assignid_map) == 0) {
                goto G2Q_QUIN;
        }
        if (k > 0) {
                k--;
                goto small_id;
        }
G2Q5:                   /* srch from max acceptable ID#  */
        k = i;                  /* max acceptable ID#            */
G2Q_LP:
        m = 1;
        m <<= k;
        if ((m & assignid_map) == 0) {
                goto G2Q_QUIN;
        }
        if (k > 0) {
                k--;
                goto G2Q_LP;
        }
G2Q_QUIN:               /* k=binID#,       */ 
```

我是如何找到这颗宝石的？

```
find /usr/src/linux -type f -name \*.c | 
while read f
do 
    echo -n "$f "
    sed -n 's/^.*goto *\([^;]*\);.*/\1/p' $f | sort -u | wc -l
done | 
sort +1rn |
head 
```

输出是一系列行，列出了按不同标签的 goto 数量排序的文件，如下所示：

```
kernel/fork.c 31
fs/namei.c 35
drivers/infiniband/hw/mthca/mthca_main.c 36
fs/cifs/cifssmb.c 45
fs/ntfs/super.c 47 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-10-12T15:57:01.297

真正的意大利面条代码是在 COBOL 中完成的，并使用了 ALTER 语句。

这是一个[例子](http://baetzler.de/humor/cobol.html)，虽然列出了“幽默”，但我见过这种事情。几乎因为注意到任何带有 Alter 语句的程序显然处于犯罪状态而被解雇。我拒绝“维护”那个程序，替换它比理解它更快。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-03-05T14:32:43.470

别忘了提到面向对象的意大利面条。这是你尝试使用书中所有设计模式的时候，即使它们没有意义。这导致了概念级别的意大利面条代码，这比经典的基于 goto 的意大利面条代码更不利于质量。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-10-12T14:12:50.773

你已经要求它，你会得到它：

这是播放蓝色多瑙河华尔兹的 DOS .com 文件的来源。可执行文件的大小仅为 176 字节。代码被重新用作数据，反之亦然。

```
.286
.model tiny

g4 equ 55-48           ; removed note-decoding !
a4 equ 57-48           ; now: storing midi-notes for octaves 0..2 and convert
h4 equ 59-48           ; to 4..6 with a simple add 48.

c5 equ 60-48
d5 equ 62-48
e5 equ 64-48
g5 equ 67-48
h5 equ 71-48

c6 equ 72-48
d6 equ 74-48
e6 equ 76-48
g6 equ 79-48           ; = 00011111b

pp  equ 0              ;  c4 is not used in the walz, using it as play-pause.
EOM equ 1              ; c#4 is also available... End Of Music
                       ; warning: experts only beyond this point !

pau1 equ 00100000b     ; bitfield definitions for note-compression
pau2 equ 01000000b     ; you can or a pau to each note!
pau3 equ 01100000b

;rep1 equ 01000000b    ; rep1 is history (only used once).
;rep3 equ 11000000b    ; rep3 was never used.

rep2 equ 10000000b     ; or a rep2 to a note to play it 3 times.

drumsize equ 5

.code
org 100h

start:
                mov  ah,9
                mov  dx,offset msg
                int  21h                    ; print our headerstring

                mov  dx,0330h               ; gus midi megaem -port
                mov  si,offset music_code   ; start of music data

mainloop:

    ; get new note (melody)

                xor  bp,bp                  ; bp= repeat-counter

                lodsb                       ; get a new note
                cmp  al, EOM                ; check for end
                jne  continue
                ret

continue:
                jns  no_rep2                ; check for rep2-Bit
                inc  bp
                inc  bp                     ; "build" repeat-counter

no_rep2:
                push ax                     ; save the note for pause

    ; "convert" to midi-note

                and  al,00011111b
                jz   skip_pp                ; check pp, keep it 0
                add  al,48                  ; fix-up oktave

skip_pp:
                xchg ax,bx                  ; bl= midi-note

play_again:
                mov  cl,3
                push cx                     ; patch program (3= piano)
                push 0c8h                   ; program change, channel 9

    ; wait (cx:dx) times

                mov  ah,86h                 ; wait a little bit
                int  15h

    ; prepare drums

                dec  di                     ; get the current drum
                jns  no_drum_underflow
                mov  di,drumsize

no_drum_underflow:

    ; play drum

                push dx                     ; volume drum
                push [word ptr drumtrk+di]  ; note   drum
                mov  al,99h
                push ax                     ; play channel 10

    ; play melody

                push dx                     ; volume melody
                push bx                     ; note   melody

                dec  ax                     ; replaces dec al :)

                push ax                     ; play channel 9

    ; send data to midi-port

                mov  cl,8                   ; we have to send 8 bytes

play_loop:
                pop  ax                     ; get the midi event
                out  dx,al                  ; and send it
                loop play_loop

    ; repeat "bp" times

                dec  bp                     ; repeat the note
                jns  play_again

    ; check and "play" pause

                xor  bx,bx                  ; clear the note, so we can hear
                                            ; a pause
    ; decode pause value

                pop  ax
                test al,01100000b
                jz   mainloop               ; no pause, get next note

    ; decrement pause value and save on stack

                sub  al,20h
                push ax
                jmp  play_again             ; and play next drum

; don't change the order of the following data, it is heavily crosslinked !
music_code      db pp or rep2

                db g4 or rep2 or pau1
                db h4 or pau1, d5 or pau1, d5 or pau3
                db d6 or pau1, d6 or pau3, h5 or pau1, h5 or pau3

                db g4 or rep2 or pau1
                db h4 or pau1, d5 or pau1, d5 or pau3
                db d6 or pau1, d6 or pau3, c6 or pau1, c6 or pau3

                db a4 or rep2 or pau1
                db c5 or pau1, e5 or pau1, e5 or pau3
                db e6 or pau1, e6 or pau3, c6 or pau1, c6 or pau3

                db a4 or rep2 or pau1
                db c5 or pau1, e5 or pau1, e5 or pau3
                db e6 or pau1, e6 or pau3, h5 or pau1, h5 or pau3

                db g4 or rep2 or pau1
                db h4 or pau1, g5 or pau1, g5 or pau3
                db g6 or pau1, g6 or pau3, d6 or pau1, d6 or pau3

                db g4 or rep2 or pau1
                db h4 or pau1, g5 or pau1, g5 or pau3
                db g6 or pau1, g6 or pau3, e6 or pau1, e6 or pau3

                db a4 or rep2 or pau1
                db c5 or pau1, e5 or pau1, e5 or pau3, pp or pau3
                db c5 or pau1, e5 or pau1, h5 or pau3, pp or pau3, d5 or pau1

                db h4 or pau1, h4 or pau3
                db a4 or pau1, e5 or pau3
                db d5 or pau1, g4 or pau2

;                db g4 or rep1 or pau1
; replace this last "rep1"-note with two (equal-sounding) notes
                db g4
                db g4 or pau1

msg             db EOM, 'Docking Station',10,'doj&sub'
drumtrk         db 36, 42, 38, 42, 38, 59  ; reversed order to save some bytes !

end start 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2013-02-21T09:29:58.230

简单来说，意大利面条代码是任何编程语言中的任何代码，其中不可能跟踪下一个执行帖子，或者至少难以确定下一个点在响应一个动作时的位置。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2008-10-12T14:07:05.357

**真正**的意大利面条代码需要大量的非本地 goto。遗憾的是，使用大多数现代语言这是不可能的。

编辑：有些人建议使用例外和 longjmp 作为 GOTO 的替代品。但这些*远非*有限和结构化，因为它们只允许您返回调用堆栈。Real GOTO 允许您跳转到程序中的*任何*位置*，*这是创建真正意大利面所必需的。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-10-13T17:00:06.207

这是我前段时间写的一个 MIDI 解析器。这是一个快速而肮脏的概念证明，但是，我要为它的丑陋承担责任：4 级嵌套条件加上可怕的多重返回。此代码旨在比较 2 个 MIDI 事件，以便在写入文件时按优先级对它们进行排序。尽管它很丑，但它完成了体面的工作。

```
internal class EventContainerComparer : IComparer {

    int IComparer.Compare(object a, object b) {
        MIDIEventContainer evt1 = (MIDIEventContainer) a;
        MIDIEventContainer evt2 = (MIDIEventContainer) b;

        ChannelEvent chanEvt1;
        ChannelEvent chanEvt2;

        if (evt1.AbsoluteTime < evt2.AbsoluteTime) {
            return -1;
        } else if (evt1.AbsoluteTime > evt2.AbsoluteTime) {
            return 1;
        } else {    
            // a iguar valor de AbsoluteTime, los channelEvent tienen prioridad
            if(evt1.MidiEvent is ChannelEvent && evt2.MidiEvent is MetaEvent) {
                return -1;
            } else if(evt1.MidiEvent is MetaEvent && evt2.MidiEvent is ChannelEvent){
                return 1;
            //  si ambos son channelEvent, dar prioridad a NoteOn == 0 sobre NoteOn > 0
            } else if(evt1.MidiEvent is ChannelEvent && evt2.MidiEvent is ChannelEvent) {

                chanEvt1 = (ChannelEvent) evt1.MidiEvent;
                chanEvt2 = (ChannelEvent) evt2.MidiEvent;

                // si ambos son NoteOn
                if( chanEvt1.EventType == ChannelEventType.NoteOn 
                    && chanEvt2.EventType == ChannelEventType.NoteOn){

                    //  chanEvt1 en NoteOn(0) y el 2 es NoteOn(>0)
                    if(chanEvt1.Arg1 == 0 && chanEvt2.Arg1 > 0) {
                        return -1;
                    //  chanEvt1 en NoteOn(0) y el 2 es NoteOn(>0)
                    } else if(chanEvt2.Arg1 == 0 && chanEvt1.Arg1 > 0) {
                        return 1;
                    } else {
                        return 0;
                    }
                // son 2 ChannelEvent, pero no son los 2 NoteOn, el orden es indistinto
                } else {
                    return 0;
                }
            //  son 2 MetaEvent, el orden es indistinto
            } else {
                return 0;
            }
        }
    }
} 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-11-28T13:27:51.280

这是[达夫的设备](http://en.wikipedia.org/wiki/Duff's_device)，来自马特对[这个问题](https://stackoverflow.com/questions/324896/hilarious-or-not-so-hilarious-code-optimizations)的回答：

```
int n = (count + 7) / 8;
switch (count % 8) {
case 0: do { *to = *from++;
case 7:      *to = *from++;
case 6:      *to = *from++;
case 5:      *to = *from++;
case 4:      *to = *from++;
case 3:      *to = *from++;
case 2:      *to = *from++;
case 1:      *to = *from++;
           } while (--n > 0);
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-12T17:37:52.373

意大利面条代码：意大利面条代码起源于 60 年代初，作为某些意大利面食的替代配方，意大利面条代码是由一位试图自动化创建万无一失的主菜的餐馆企业家制作的。由于缺乏时间来完成设计，工程师/厨师偷工减料，这在早期的配方中引入了问题。为了补救一个坏掉的好主意，随着配方失控，各种香料很快被添加到混合物中。结果是一堆冗长、曲折但可能很美味的文本，后来成为全世界开发人员所珍视的做法。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-11-05T22:09:31.457

你看过 Flex/Bison 扫描器和生成器生成的代码吗？过多的标签和预处理器指令。

绝对不可能理解里面是什么......而且绝对不可能遵循程序的流程。

这绝对是意大利面条代码。

# c++ - __REQUIRED_RCNDR_H_VERSION__

> ID：195524
> 
> 赞同：0
> 
> 时间：2008-10-12T14:07:47.880
> 
> 标签：c++, visual-c++, idl

我从 IDL 创建一个头文件。IDL 文件已在 Visual C++ 2005 中编译。生成的头文件包含 #define **REQUIRED_RPCNDR_H_VERSION** 475 。

我试图在 Visual Studio 2003 中使用这个头文件，其中 rpcndr.h 包含

{

#define **RPCNDR_H_VERSION** ( 450 ) // 和

#if ( **RPCNDR_H_VERSION** < **REQUIRED_RPCNDR_H_VERSION** )

```
 #error incorrect <rpcndr.h> version. Use the header that matches with the MIDL compiler.
#endif 
```

}

由于 450<475 ，我得到一个编译时错误。有什么办法可以在 Visual Studio 2003 中使用头文件。我需要更改 idl 文件的编译设置吗？

PS：我只需要在 Visual C++ 2005 中编译 idl 文件。（我没有选择在 VS 2003 中编译它）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-12T17:38:40.017

如果您的 2003 和 2005 配置使用相同版本的 Windows SDK，那么您可能不走运（和/或只需要破解它并希望它能正常工作）。但是，通常，如果它们使用相同版本的 SDK 实用程序和标头，您可以使它们兼容。

我没有任何特定于这个问题的信息，但我过去也遇到过类似的问题，我通过将两个版本的 VS 指向相同的更高版本的 SDK 来解决。

# c# - Bidi 关联和 NHibernate 映射

> ID：195528
> 
> 赞同：1
> 
> 时间：2008-10-12T14:10:32.290
> 
> 标签：c#, nhibernate, linq-to-nhibernate

我有 BidiParent 和 BidiChildList 类，它们以双向父子关系链接父母和孩子。如果一个孩子的父母被例如服务层更新，旧的和新的父母的孩子列表会自动更新以反映变化。同样，如果通过例如添加新孩子来更新父母的孩子列表，则孩子的父母会自动改变，就像旧父母的孩子列表一样。我想尝试建立一个“智能”域模型。

显然，第一个问题是：这甚至是个好主意吗？

第二个问题是：是否可以告诉 NHibernate 访问和修改*字段*_Children 或 _Parent，但考虑*属性*Children 或 Parent 与该字段完全同义？NHibernate 应该加载和保存内部字段，但 HQL 或 LINQ 查询应该使用公共属性？

```
public class BidiParent<C, P> { ... }

public class BidiChildList<C, P> : IList<C> { ... }

public class Parent {
    public string Name { get; set; }
    public IList<Child> Children {
        get { return ChildrenBidi; }
        set { ChildrenBidi.Set(value); }
    }
    private BidiChildList<Child, Parent> ChildrenBidi {
        get { return BidiChildList.Create(this, p => p._Children, c => c._Parent, (c, p) => c._Parent = p); }
    }
    internal IList<Child> _Children = new List<Child>();
}

public class Child {
    public string Name { get; set; }
    public Parent Parent {
        get { return ParentBidi.Get(); }
        set { ParentBidi.Set(value); }
    }
    private BidiParent<Child, Parent> ParentBidi {
        get { return BidiParent.Create(this, p => p._Children, () => _Parent, p => _Parent = p); }
    }
    internal Parent _Parent = null;
}

[Test]
public void MultilevelConstruction_Succeeds() {
    var p = new Parent {
        Name = "Bob",
        Children = new List<Child> {
            new Child { Name = "Kate" },
            new Child { Name = "Billy" }
        }
    };
    Assert.AreEqual(2, p.Children.Count);
    Assert.AreEqual("Kate", p.Children[0].Name);
    Assert.AreEqual("Billy", p.Children[1].Name);
    Assert.AreSame(p, p.Children[0].Parent);
    Assert.AreSame(p, p.Children[1].Parent);
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-12T20:22:09.840

回答我自己的问题：我需要使用命名策略，如[docs](http://www.hibernate.org/hib_docs/nhibernate/1.2/reference/en/html/mapping.html)中所述。RTFM 对吗？

```
<class name="Parent">
    <property name="Name" />
    <bag name="Children" access="field.pascalcase-underscore">
        <key />
        <one-to-many class="Child" />
    </bag>
</class>
<class name="Child">
    <property name="Name" />
    <many-to-one name="Parent" access="field.pascalcase-underscore" />
</class> 
```

# sql-server - 什么是 SQL“伪列”？

> ID：195530
> 
> 赞同：7
> 
> 时间：2008-10-12T14:12:43.050
> 
> 标签：sql-server, tsql

我不小心编码`SELECT $FOO..`并得到错误“无效的伪列“$ FOO”。

我找不到他们的任何文件。这是我应该知道的吗？

编辑：这是一个 MS SQL Server 特定的问题。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-01-19T14:29:39.773

伪列是具有特殊属性的实际列的符号别名，例如，$IDENTITY 是分配了 IDENTITY 的列的别名，$ROWGUID 是分配了 ROWGUIDCOL 的列的别名。它用于内部管道脚本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-01-19T14:35:43.490

我不知道为什么大多数答案都是 Oracle 特定的问题是关于 SQL Server 的！

除了 RobsonROX 的回答之外，另一个使用它们的例子是在语句的`output`子句中`merge`。`$action`指示该行是插入还是删除。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-12-22T10:13:43.310

伪列的行为类似于表列，但实际上并不存储在表中。您可以从伪列中进行选择，但不能插入、更新或删除它们的值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-12T14:24:10.423

伪列是在特殊情况下可用的虚拟列。在 Oracle 数据库中，有一个 ROWNUM 伪列可以为您提供行号。据我所知，SQL 服务器实际上并不支持伪列，但存在引用伪列的错误和存储过程，可能用于 Oracle 迁移。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-12T14:43:13.690

伪列的一个示例是 Informix 中的 ROWID。它是一个 32 位数字，可用于比任何其他方式更快地找到数据页（需要注意，例如表没有碎片），因为它基本上是数据的页地址。你可以做`SELECT * FROM SomeTable`，但它不会出现；你可以这样做`SELECT ROWID, * FROM SomeTable`，它会显示在你的数据中。因为它实际上并未存储在磁盘上（您不会在磁盘上看到带有数据的 ROWID，尽管 ROWID 会告诉您在磁盘上的何处查找数据），所以它是一个伪列。可能还有其他与表格相关的伪列——它们往往同样有些深奥。

它们也可以称为*隐藏列*，特别是如果它们（与伪列相反）实际存储在数据库中，但未被选择`*`；您必须专门请求该列才能看到它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-12T14:21:15.437

一个简单的谷歌搜索从甲骨文的参考中提出了[这一点：](http://www.lorentzcenter.nl/awcourse/oracle/server.920/a96540/sql_elements6a.htm)

> 伪列的行为类似于表列，但实际上并不存储在表中。您可以从伪列中进行选择，但不能插入、更新或删除它们的值。

我认为你得到的错误仅仅是因为没有列 $FOO，所以查询解析器测试是否有一个名为 $FOO 的伪列作为后备。而且由于没有名为“$FOO”的伪列（并且没有其他后备），您会收到错误“无效的伪列 $FOO”。不过，这是一个猜测。我不是数据库方面的专家。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-06-29T10:16:49.217

伪列是假列。任何表都将支持与其自己的列相同的伪列，严格来说它们是函数：1.SYSDATE；2.ROWNUM; 3.ROWID；4.NEXTVAL；5.曲线；6.级别；

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-02-18T01:59:12.647

假设我们有一个情况，两个表中的列数不相同，我们需要应用 UNION，那么通常我们会借助伪列来执行 UNION 操作。

从 Table1 中选择 Col1、Col2、Col3、Col4、Col5 UNION 从 Table2 中选择 Col1、Col2、Col3，Null 作为 Col4，Null 作为 Col5

# c# - ASP.NET 照片 API（Shutterfly 等）

> ID：195532
> 
> 赞同：2
> 
> 时间：2008-10-12T14:13:01.537
> 
> 标签：c#, asp.net, photos

我有一个包含我所有照片的网站，我希望人们能够通过第三方服务（Shutterfly 等）点击我的照片并订购打印件等。有没有人有任何在 C#、ASP.NET 中执行此操作的最佳实践或代码示例？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-12T14:40:36.520

我不知道这些信息是否仍然是最新的，但这里是[对 Shutterfly API 的描述](http://www.cs.hmc.edu/~ben/c4p_API_v2.html)。API 似乎包含在一个简单的**HTTP 表单帖子中，其中嵌入了名称-值对**。

例子：

```
<form action="http://www.shutterfly.com/c4p/UpdateCart.jsp" method="post">
<input type="hidden" name="addim" value="1">
<input type="hidden" name="protocol" value="SFP,100">
<input type="hidden" name="pid" value="C4P">
<input type="hidden" name="puid" value="AFFL">
<input type="hidden" name="imnum" value="1">
<input type="hidden" name="imraw-1" value="http://images.partner.com/foo/12345.jpg">
<input type="hidden" name="imrawheight-1" value="1800">
<input type="hidden" name="imrawwidth-1" value="1200">
<input type="hidden" name="imthumb-1" value="http://images.partner.com/foo/12345_thumb.jpg">
<input type="hidden" name="imthumbheight-1" value="150">
<input type="hidden" name="imthumbwidth-1" value="100">
<input type="hidden" name="returl" value="http://www.partner.com/alice">
<input type="submit" value="Submit">
</form> 
```

为它编写一些 C# 包装器应该不是一项艰巨的任务。

# python - 在生产中，Apache + mod_wsgi 还是 Nginx + mod_wsgi？

> ID：195534
> 
> 赞同：68
> 
> 时间：2008-10-12T14:14:19.833
> 
> 标签：python, apache, nginx, mod-wsgi

什么用于大中型 python WSGI 应用程序，Apache + mod_wsgi 或 Nginx + mod_wsgi？

哪种组合需要更多的内存和 CPU 时间？
哪个更快？
哪个以比另一个更稳定而闻名？

我也在考虑使用 CherryPy 的 WSGI 服务器，但我听说它不太适合负载非常高的应用程序，您对此了解多少？

***注意****：我没有使用任何 Python Web 框架，我只是从头开始编写整个东西。*
***注意'****：也欢迎其他建议。*

* * *

## 回答 #1

> 赞同：77
> 
> 时间：2009-06-24T12:26:01.277

对于 nginx/mod_wsgi，请确保您阅读：

[http://blog.dscpl.com.au/2009/05/blocking-requests-and-nginx-version-of.html](http://blog.dscpl.com.au/2009/05/blocking-requests-and-nginx-version-of.html)

由于 nginx 在底层是一个事件驱动系统，它具有不利于阻塞应用程序的行为特征，例如基于 WSGI 的应用程序。更糟糕的情况是使用多进程 nginx 配置，即使某些 nginx 工作进程可能处于空闲状态，您也可以看到用户请求被阻止。Apache/mod_wsgi 没有这个问题，因为 Apache 进程只有在它拥有实际处理请求的资源时才会接受请求。Apache/mod_wsgi 将因此提供更可预测和更可靠的行为。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-01-03T13:04:18.580

nginx mod_wsgi 的作者[在此邮件列表消息中](http://osdir.com/ml/web.nginx.english/2008-05/msg00451.html)解释了与 Apache mod_wsgi 的一些差异。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-10-13T02:44:24.547

主要区别在于 nginx 是为在更小的内存空间中处理大量连接而构建的。这使得它非常适合执行类似彗星的连接的应用程序，这些连接可以有许多空闲的打开连接。这也使它的内存占用空间更小。

从原始性能的角度来看，nginx 更快，但并没有那么快，我将其作为决定因素。

Apache 在可用模块方面具有优势，而且它几乎是标准的。您使用的任何网络主机都会安装它，并且大多数技术人员都会非常熟悉它。

此外，如果您使用 mod_wsgi，它就是您的 wsgi 服务器，因此您甚至不需要cherrypy。

除此之外，我能给出的最好建议是尝试在两者下设置您的应用程序并进行一些基准测试，因为无论任何人告诉您什么，您的里程都可能会有所不同。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-12T20:45:41.120

CherryPy 的网络服务器要做的一件事是它是一个纯 Python 网络服务器 (AFAIK)，它可能会或可能不会使您的部署更容易。另外，如果您只是将服务器用于 WSGI 和静态内容，我可以看到使用它的好处。

（无耻插件警告：我写了我要提到的WSGI代码）

[Kamaelia](http://www.kamaelia.org/Home)将在下一个版本中支持 WSGI。很酷的一点是，您可能既可以使用预制的，也可以使用现有的 HTTP 和 WSGI 代码构建自己的。

（结束无耻插件）

话虽如此，鉴于当前的选项，我个人可能会选择 CherryPy，因为它似乎是最简单的配置，而且我对 Python 代码的理解比对 C 代码的理解要多。

不过，您最好尝试一下它们中的每一种，看看每种方法的优缺点对于您的特定应用程序有什么好处。

# java - 您将如何在 Java Web 环境中实现 RSS 提要？

> ID：195537
> 
> 赞同：3
> 
> 时间：2008-10-12T14:15:36.337
> 
> 标签：java, servlets, rss

我正在为协作平台实现 RSS 提要。假设有数千个不同的协作室，用户可以在其中共享信息，每个协作室都需要发布包含新闻、更改等的 RSS 提要……

使用普通 servlet（即[http://www.site.com/RSSServlet/?id=roomID](http://www.site.com/RSSServlet/?id=roomID)）的成本很高，每次 RSS 客户端调用 servlet 时（对于每个注册到RSS 提要上千个房间之一）这将触发整个 servlet 生命周期，这是昂贵的。

另一方面，在磁盘上为数千个房间中的每一个都保留一个静态 XML 文件也很昂贵，就硬盘空间和 IO 操作而言......

另一个限制 - 使用现有框架可能不是一种选择......

那么，您将如何在 Java 环境中实现 RSS 提要？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-14T17:16:49.887

您说对您的 servlet 的新 http 请求“将触发整个 servlet 生命周期”，正如 Alexander 已经指出的那样，这并不完全正确。它只会触发对您的`doGet()`or`doPost()`方法的另一个方法调用。

我认为您的意思是，如果您有一个`doGet`/`doPost`方法，其中包含从头开始构建 RSS 提要所需数据的代码，那么每个请求都会一遍又一遍地触发这种数据获取。

如果这是您关心的问题，并且您正在排除静态内容，只需修改您的 Servlet `doGet`/`doPost`方法以缓存您将返回的 RSS 内容，以便处理每个请求并不意味着重新获取所有数据。

例如

```
public void doGet(HttpServletRequest request, HttpServletResponse response) {
    //build the objects you need for the RSS response
    Room room = getRoom(request.getParameter("roomid"));
    //loadData();
    //moreMethodCalls();
    out.println( createRssContent(...) );
} 
```

变成

```
Map rssCache;

public void doGet(HttpServletRequest request, HttpServletResponse response) {

    //Map is initialized in the init() method or somewhere else    
    String roomId = request.getParameter("roomid");

    String rssDocument = rssCache.get(roomId);
    if (rssDocument == null) {

        //build the objects you need for the RSS response
        Room room = getRoom(roomId);
        //loadData();
        //moreMethodCalls();
        rssDocument = createRssContent(...);
        rssCache.put(roomId, rssDocument);
    }
    out.println( rssDocument );
} 
```

如果您只想将项目存储在“缓存”中一段时间​​，您可以使用十几种不同的缓存框架中的一种，但这里的想法是您不会重建 RSS 响应所需的整个对象图每个http请求。如果我正在阅读您的原始问题，那么我认为这就是您希望实现的目标。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-12T14:44:18.073

你应该试试[ROME](https://rome.dev.java.net/)框架。它非常适合 RSS。

# c# - 在 .NET 中派生 COM 接口

> ID：195548
> 
> 赞同：6
> 
> 时间：2008-10-12T14:28:27.683
> 
> 标签：c#, c++, .net, interface, com

由于我无法控制的公司限制，我有以下情况：

定义以下接口的 COM 库（没有 CoClass，只有接口）：

```
[
    object,
    uuid(xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx),
    dual,
    nonextensible,
    helpstring("IService Interface"),
    pointer_default(unique)
]
IService : IDispatch
{
  HRESULT DoSomething();
}

[
    object,
    uuid(xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx),
    dual,
    nonextensible,
    helpstring("IProvider Interface"),
    pointer_default(unique)
]
IServiceProvider : IDispatch
{
  HRESULT Init( IDispatch *sink, VARIANT_BOOL * result );
  HRESULT GetService( LONG serviceIndicator, IService ** result );
};

[
    uuid(xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx),
    version(1.0),
]
library ServiceLibrary
{
    importlib("stdole2.tlb");

   interface IService;
   interface IServiceProvider;
}; 
```

我有一个 COM（用 C++ 编写），它实现了这两个接口并为我们的应用程序提供了上述服务。一切都很好，我想。

我正在尝试在.NET（C#）中 构建一个新`IProvider`的。`IService`

我为 COM 库构建了一个主互操作程序集，并实现了以下 C#：

```
[ComVisible( true )]
[Guid( "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx" )]
public interface INewService : IService
{
   //  adds a couple new properties
}

[ComVisible( true )]
[Guid( "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx" )]
public class NewService : INewService
{
   //  implement interface
}

[ComVisible( true )]
[Guid( "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx" )]
public interface INewProvider : IServiceProvider
{
   //  adds nothing, just implements
}

[ComVisible( true )]
[Guid( "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx" )]
public class NewProvider : INewProvider
{
   //  implement interface
} 
```

当我尝试将其滑入现有运行时时，我能够`NewProvider`从 COM (C++) 和`QueryInterface`IServiceProvider 创建对象。当我尝试调用 IServiceProvider 上的方法时，`System.ExecutionEngineException`会抛出 a。

我能找到的唯一另一件事是查看由#import 创建的.tlh 文件，它显示了旧的COM IExistingProvider 类正确地表明它是从IServiceProvider 派生的。然而，.NET 类显示了 IDispatch 的基础。我不确定这是否是一个标志、指示、有用的东西，或者别的什么。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-12T19:21:35.923

*名称IServiceProvider*可能有问题。检查您是否尚未导入具有相同名称的接口。

当我使用您的 IDL 创建 COM 接口库，然后尝试从另一个客户端导入它时，我收到警告：

```
Warning 65  warning C4192: automatically excluding 'IServiceProvider' while importing type library 'ServiceLibrary.dll' 
```

否则，您可以尝试将其重命名为 IServiceProvider2。这就是我所做的，一切正常。我正在使用 Visual Studio 2008。

如果此代码在您的机器上正常运行（它在我的机器上运行良好），那么问题可能出在您的实现中。

身份证：

```
import "oaidl.idl";

[
    object,
    uuid(9219CC5B-31CC-4868-A1DE-E18300F73C43),
    dual,
    nonextensible,
    helpstring("IService Interface"),
    pointer_default(unique)
]
interface IService : IDispatch
{
  HRESULT DoSomething(void);
}

[
    object,
    uuid(9219CC5B-31CC-4868-A1DE-E18300F73C44),
    dual,
    nonextensible,
    helpstring("IProvider Interface"),
    pointer_default(unique)
]
interface IServiceProvider2 : IDispatch
{
  HRESULT Init( IDispatch *sink, VARIANT_BOOL * result );
  HRESULT GetService( LONG serviceIndicator, IService ** result );
};

[
    uuid(9219CC5B-31CC-4868-A1DE-E18300F73C45),
    version(1.0),
]
library ServiceLibrary
{
    importlib("stdole2.tlb");

    interface IService;
    interface IServiceProvider2;
}; 
```

C＃：

```
using System.Runtime.InteropServices;
using System.Windows.Forms;
using ServiceLibrary;
using IServiceProvider=ServiceLibrary.IServiceProvider2;

namespace COMInterfaceTester
{
    [ComVisible(true)]
    [Guid("2B9D06B9-EB59-435e-B3FF-B891C63108B2")]
    public interface INewService : IService
    {
        string ServiceName { get; }
    }

    [ComVisible(true)]
    [Guid("2B9D06B9-EB59-435e-B3FF-B891C63108B3")]
    public class NewService : INewService
    {
        public string _name;

        public NewService(string name)
        {
            _name = name;
        }

        //  implement interface
        #region IService Members

        public void DoSomething()
        {
            MessageBox.Show("NewService.DoSomething");
        }

        #endregion

        public string ServiceName
        {
            get { return _name; }
        }
    }

    [ComVisible(true)]
    [Guid("2B9D06B9-EB59-435e-B3FF-B891C63108B4")]
    public interface INewProvider : IServiceProvider
    {
        //  adds nothing, just implements
    }

    [ComVisible(true)]
    [Guid("2B9D06B9-EB59-435e-B3FF-B891C63108B5")]
    public class NewProvider : INewProvider
    {
        //  implement interface
        public void Init(object sink, ref bool result)
        {
            MessageBox.Show("NewProvider.Init");
        }

        public void GetService(int serviceIndicator, ref IService result)
        {
            result = new NewService("FooBar");
            MessageBox.Show("NewProvider.GetService");
        }
    }
} 
```

C++ 客户端：

```
#include "stdafx.h"
#include <iostream>
#include <atlbase.h>
#import "COMInterfaceTester.tlb" raw_interfaces_only
#import "ServiceLibrary.dll" raw_interfaces_only

using std::cout;

int _tmain(int argc, _TCHAR* argv[])
{
    CoInitialize(NULL);   //Initialize all COM Components
    COMInterfaceTester::INewProviderPtr pNewProvider(__uuidof(COMInterfaceTester::NewProvider));
    ServiceLibrary::IServiceProvider2 *pNewProviderPtr;

    HRESULT hr = pNewProvider.QueryInterface(__uuidof(ServiceLibrary::IServiceProvider2), (void**)&pNewProviderPtr);

    if(SUCCEEDED(hr))
    {       
        VARIANT_BOOL result = VARIANT_FALSE;
        int *p = NULL;

        hr = pNewProviderPtr->Init((IDispatch*)p, &result);

        if (FAILED(hr))
        {
            cout << "Failed to call Init";
        }

        ServiceLibrary::IService *pService = NULL;
        hr = pNewProviderPtr->GetService(0, &pService);

        if (FAILED(hr))
        {
            cout << "Failed to call GetService";
        }
        else
        {
            COMInterfaceTester::INewService* pNewService = NULL;
            hr = pService->QueryInterface(__uuidof(COMInterfaceTester::INewService), (void**)&pNewService);

            if (SUCCEEDED(hr))
            {
                CComBSTR serviceName;
                pNewService->get_ServiceName(&serviceName); 

                if (serviceName == "FooBar")
                {
                    pService->DoSomething();
                }
                else
                    cout << "Unexpected service";

                pNewService->Release();

            }

            pService->Release();
        }

        pNewProviderPtr->Release();
    }
    else
        cout << "Failed to query for IServiceProvider2";

    pNewProvider.Release();
    CoUninitialize ();   //DeInitialize all COM Components

} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T19:04:45.380

您可能必须在您的类上指定其他属性才能正确编组。我会[在这里](http://msdn.microsoft.com/en-us/library/d4w8x20h(VS.71).aspx)查看可用的属性，如果你还没有这样做的话，也许可以看看[这个教程。](http://www.codeproject.com/KB/COM/cominterop.aspx)

# apache-flex - Flex - 在画布中布置文本

> ID：195549
> 
> 赞同：1
> 
> 时间：2008-10-12T14:28:56.997
> 
> 标签：apache-flex, actionscript-3, mxml

这是我一直遇到的一个问题：

我有很多情况需要使用样式容器显示一些文本，如下所示：

```
<mx:Canvas>
     <mx:Text text="{text}" left="5" verticalCenter="0" right="5" />    
</mx:Canvas> 
```

如您所见 - 文本受画布左右边距的约束，我没有为文本控件指定高度，因为我希望它在向其添加文本时垂直增长。原因是 - 如果有一行文本，我希望它显示在画布的中心，但如果有两三行文本，我希望文本控件显示那两三行文本。

然而，不断发生的是它只会显示一行文本——无论我在它或容器上调用多少次 invalidateSize()。我该怎么办？

CAVEAT：画布的高度和宽度由实例化它的组件设置（这都包含在自定义组件中）所以我不能显式设置文本控件的宽度或高度......

注意：好的，也许这很容易解决，因为当我输入这个问题时，我想通了 - 但是，这是一个回答一个简单问题的机会！？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-12T14:47:39.843

如果您希望 Text 组件为您自动换行，则它需要一个宽度。如果你使用了一个带有换行符的字符串，它会像你预期的那样增长而没有宽度。对你来说，使用：

**编辑：**好的，您希望它以不同大小的画布为中心。那么你就可以：

```
<mx:HBox 
    width="500"
    paddingLeft="5"
    paddingRight="5">
    <mx:Spacer width="100%" />
    <mx:Text 
        width="100%"
        text="{text}" />
    <mx:Spacer width="100%" />
</mx:HBox> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T14:39:04.777

看一下 TextArea 组件。

# com - 是否有列出从 DLL 导出的方法的工具？

> ID：195571
> 
> 赞同：5
> 
> 时间：2008-10-12T14:49:03.413
> 
> 标签：com, dll

正如问题所述 - 是否有一个很好的工具可以列出非托管 DLL 导出的方法？我也希望它列出 COM 方法和接口。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-12T14:53:40.427

对于 DLL，请使用 Dependency Viewer ( [depends.exe](http://technet.microsoft.com/en-us/library/cc738370.aspx) )。

对于 COM 对象，使用[oleview.exe](http://www.microsoft.com/downloads/details.aspx?familyid=5233b70d-d9b2-4cb5-aeb6-45664be858b6&displaylang=en)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T14:53:13.297

查看[Dependency Walker](http://www.dependencywalker.com/)以获取从 DLL 导出的非托管函数的列表。

您无法轻松获取从 DLL 导出的所有 COM 类列表。您需要做的就是通过注册表找到所有引用相关 DLL 的对象。DLL 通过在注册表中注册来宣传它们的类...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-17T08:46:36.263

作为应用程序打包程序，我们使用监视（或转储）注册信息的实用程序 - WiseComCapture.exe - 这是 Wise Package Studio 的一部分，但它不是免费的。它会吐出一个包含所有注册信息的 .reg 文件。

用谷歌闲逛可能会“暴露”它

# css - 是否可以设置仅在查看链接网页时显示的链接样式？

> ID：195578
> 
> 赞同：1
> 
> 时间：2008-10-12T14:54:22.703
> 
> 标签：css, hyperlink, visited

我遇到了这样的问题（这是 html/css 菜单）：

网店 | 另一个eshop | 另一个网店

客户希望它像这样工作：

用户访问网站，点击 Eshop。Eshop 变为带有红色框轮廓的红色。用户决定访问另一个eshop，所以eshop会恢复正常颜色，没有红框轮廓，另一个eshop会再次做红色轮廓的把戏。

我知道有 A:visited 但我不希望所有访问过的菜单链接都是红色的并带有红色框轮廓。

感谢任何帮助:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-12T15:31:19.100

与乔·斯科拉（Joe Skora）所写的相同，但更具体：

```
.red {
    outline-color:red;
    outline-width:10px;
} 
```

现在您可以在 click-event-handler 中使用 Javascript（在此示例中使用[jQuery ）：](http://jquery.com)

```
$('.red').removeClass('red'); // removes class red from all items with class red
$(this).addClass('red'); // adds class red to the clicked item 
```

另一种方法是使用伪选择器:target。
有关它的信息：[www.thinkvitamin.com](http://www.thinkvitamin.com/features/css/stay-on-target)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-13T22:59:43.487

您可以使用纯 CSS 和 HTML 来做到这一点。我们常用的一种方法是为每个导航项设置一个匹配的 ID 和类选择器。

这样做的好处是您不必修改每个页面的**菜单代码，您可以修改****页面本身**，除非一切都是完全动态的，否则您已经在这样做了。

它是这样工作的：

```
<!-- ... head, etc ... -->
<body>

<ul class="nav">
    <li><a href="home.html" class="nav-home">Home</a></li>
    <li><a href="art.html" class="nav-art">Art</a></li>
    <li><a href="contact.html" class="nav-contact">Contact</a></li>
</ul>

<!-- ... more page ... -->

</body> 
```

然后你像这样设置一些 CSS：

```
#NAV-HOME .nav-home,
#NAV-ART .nav-art,
#NAV-CONTACT .nav-contact { color:red; } 
```

要更改“当前”菜单项，您只需将相应的 ID 分配给文档结构中较高的元素即可。通常我将它添加到 <body> 标记中。

要突出显示“艺术”页面，您所要做的就是：

```
<!-- The "Art" item will stand out. -->
<body id="NAV-ART">

<ul class="nav">
    <li><a href="home.html" class="nav-home">Home</a></li>
    <li><a href="art.html" class="nav-art">Art</a></li>
    <li><a href="contact.html" class="nav-contact">Contact</a></li>
</ul>

<!-- ... more page ... -->

</body> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T14:59:02.897

您可以使用 CSS 类来做到这一点。例如，一个*选定*的类可以识别当前商店，改变颜色和轮廓。然后，您可以通过从菜单项中添加/删除类来更改选择。

看看[这里](http://www.seoconsultants.com/css/menus/tutorial/)，它介绍了有关构建 CSS 菜单的教程。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T15:32:12.627

基本上，它不能单独使用 CSS 完成，必须进行一些脚本（服务器或客户端，最好是服务器）。正如其他人所建议的那样，将“选定”类（或类似的东西）添加到活动链接，并在 CSS 中为其定义样式。

例如，链接：

```
 <a href="#">Eshop</a> | <a href="#" class="selected">Another eshop</a> | <a href="#">Another eshop</a> 
```

款式：

```
.selected {
     font-weight:bold;
     color:#efefef;
} 
```

链接将使用 PHP 动态生成，例如：

```
 <?php
 foreach(array('eshop' => '#','another eshop' => '#','yet another eshop' => '#') as $title => $url) {
      echo '<a href="' . $url . '"' 
           . ($url == $_SERVER['REQUEST_URI'] ? ' class="selected"' : null) 
           . '>' . $title . '</a>'; 
 } 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-14T16:57:11.347

**如果您在***同一个*浏览器窗口中移动到新页面， *Zack Mulgrew*和*Bobby Jack*都有很好的答案。

如果你是在新窗口中打开eshop链接，单靠css是无能为力的，*gs*除了选择类名（*红色*）外，还有一个合理的答案。

它是哪一个？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-12T15:19:27.923

据我所知，您只能通过为每个页面生成不同的代码（为当前页面设置不同的类）或在页面加载后使用 JavaScript 更改菜单来做到这一点。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-13T22:35:32.600

你可以像这样使用和属性选择器......

```
a[href^="http:\\www.EShop"]:visted { color: red; } 
```

通过这样做，您是在说任何具有以 http:\Eshop.com 开头的 href 并已访问过的链接都应用此样式。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-13T23:09:01.143

这取决于你的页面是如何构建的，但经典的 CSS 是在正文和每个导航链接上都有一个 id，所以你可能会有类似的东西：

*eshop.html*

```
<body id="eshop">
  <ul>
    <li><a href="" id="link-eshop">Eshop</a></li>
    <li><a href="" id="link-aeshop">Another eshop</a></li>
    <li><a href="" id="link-eshop-three">Another eshop</a></li>
  </ul>
</body> 
```

和相应的CSS：

```
#eshop #link-eshop, #aeshop, #link-aeshop, #eshop-three #link-eshop-three
{
    color: red;
    outline: 1px solid red;
} 
```

导航是一致的；只有正文上的 id 会随着页面的变化而变化。

# lua - '尝试索引upvalue'是什么意思

> ID：195582
> 
> 赞同：13
> 
> 时间：2008-10-12T15:02:01.173
> 
> 标签：lua, upvalue

我正在 Lua 中进行第一步编程，并在运行脚本时出现此错误：

```
attempt to index upvalue 'base' (a function value) 
```

这可能是由于我还没有掌握一些非常基本的东西，但是在谷歌搜索时我找不到任何关于它的好信息。有人可以向我解释这是什么意思吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-12T15:24:35.887

在这种情况下，它看起来`base`是一个函数，但您正试图像表一样索引它（例如`base[5]`或`base.somefield`）。

'upvalue' 部分只是告诉你什么类型的变量`base`，在这种情况下是一个 upvalue（又名外部局部变量）。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2017-03-19T18:17:47.770

# 一个“本地”太多了？

正如[Mike F](https://stackoverflow.com/a/195599/6286781)所解释的，“upvalue”是一个外部局部变量。当一个变量`local`在前向声明中声明，然后在初始化时`local` **再次声明时，通常会发生此错误。**这使前向声明的变量的值为`nil`。此代码段演示了**不**该做什么：

```
 local foo -- a forward declaration 

 local function useFoo()
      print( foo.bar )  -- foo is an upvalue and this will produce the error in question
                        -- not only is foo.bar == nil at this point, but so is foo
 end

 local function f()

     -- one LOCAL too many coming up...

     local foo = {}   -- this is a **new** foo with function scope

     foo.bar = "Hi!"

     -- the local foo has been initialized to a table
     -- the upvalue (external local variable) foo declared above is not
     -- initialized

     useFoo()
 end 

 f() 
```

在这种情况下，删除`local`前面的`foo`when it is initialized in`f()`修复示例，即

```
foo = {}
foo.bar = "Hi!" 
```

现在对 useFoo() 的调用将产生所需的输出

> 你好！

# java - 序列化 java.lang.Locale

> ID：195587
> 
> 赞同：3
> 
> 时间：2008-10-12T15:06:43.613
> 
> 标签：java, serialization, locale

有一个类可以很好地序列化为带有 XMLEncoder 的 xml 中的所有变量。除了拥有*java.util.Locale*的那个。可能是什么诀窍？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-12T16:57:25.170

问题是 java.util.Locale 不是[bean](http://java.sun.com/javase/technologies/desktop/javabeans/docs/spec.html)。来自[XMLEncoder](http://java.sun.com/javase/6/docs/api/index.html?java/beans/XMLEncoder.html)文档：

> XMLEncoder 类是 ObjectOutputStream 的补充替代品，可用于生成 **JavaBean**的文本表示，就像 ObjectOutputStream 可用于创建可序列化对象的二进制表示一样。

但是，API 允许您使用 PersistenceDelegates 来序列化非 bean 类型：

样品豆：

```
public class MyBean implements Serializable {

    private static final long serialVersionUID = 1L;

    private Locale locale;
    private String foo;

    public MyBean() {
    }

    public Locale getLocale() {
        return locale;
    }

    public void setLocale(Locale locale) {
        this.locale = locale;
    }

    public String getFoo() {
        return foo;
    }

    public void setFoo(String foo) {
        this.foo = foo;
    }

} 
```

序列化包含 Locale 类型的数据图：

```
public class MyBeanTest {

    public static void main(String[] args) throws Exception {
        // quick and dirty test

        MyBean c = new MyBean();
        c.setLocale(Locale.CHINA);
        c.setFoo("foo");

        ByteArrayOutputStream outputStream = new ByteArrayOutputStream();
        XMLEncoder encoder = new XMLEncoder(outputStream);
        encoder.setPersistenceDelegate(Locale.class, new PersistenceDelegate() {
            protected Expression instantiate(Object oldInstance, Encoder out) {
                Locale l = (Locale) oldInstance;
                return new Expression(oldInstance, oldInstance.getClass(),
                        "new", new Object[] { l.getLanguage(), l.getCountry(),
                                l.getVariant() });
            }
        });
        encoder.writeObject(c);
        encoder.flush();
        encoder.close();

        System.out.println(outputStream.toString("UTF-8"));

        ByteArrayInputStream bain = new ByteArrayInputStream(outputStream
                .toByteArray());
        XMLDecoder decoder = new XMLDecoder(bain);

        c = (MyBean) decoder.readObject();

        System.out.println("===================");
        System.out.println(c.getLocale());
        System.out.println(c.getFoo());
    }

} 
```

这是描述在反序列化时如何实例化对象的代码部分 - 它将构造函数参数设置为三个字符串值：

```
 new PersistenceDelegate() {
        protected Expression instantiate(Object oldInstance, Encoder out) {
            Locale l = (Locale) oldInstance;
            return new Expression(oldInstance, oldInstance.getClass(),
                    "new", new Object[] { l.getLanguage(), l.getCountry(),
                            l.getVariant() });
        }
    } 
```

阅读Philip Milne 的[Using XMLEncoder了解更多信息。](http://java.sun.com/products/jfc/tsc/articles/persistence4/)

All this aside, it might be smarter to store the locale information in textual form and use it to look up the appropriate Locale object whenever it is needed. That way you don't need special case code when serializing your object and make it more portable.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-12T16:14:50.653

对不起，你不是说*java.util.Locale*吗？javadocs 说*java.util.Locale*实现了*Serializable ，因此使用**lang*包中的*Locale*类应该没有问题。

 *# windows - 在路径上定位文件

> ID：195590
> 
> 赞同：16
> 
> 时间：2008-10-12T15:12:50.667
> 
> 标签：windows

除了从根文件夹执行 dir filename.exe /s 之外，有人知道如何确定 PATH 环境变量指定的文件夹之一中文件的位置吗？

我知道这超出了编程问题的范围，但这对于与部署相关的问题很有用，我还需要检查可执行文件的依赖关系。:-)

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-10-12T15:17:44.387

您可以使用目录`where.exe`中的实用程序`C:\Windows\System32`。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-13T12:50:23.840

对于基于 WindowsNT 的系统：

```
for %i in (file) do @echo %~dp$PATH:i 
```

替换`file`为您要查找的文件的名称。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-12T20:29:04.587

如果要在 API 级别定位文件，可以使用[PathFindOnPath](http://msdn.microsoft.com/en-us/library/bb773594(VS.85).aspx)。如果您想在系统或当前用户路径之外的其他位置进行搜索，它还有一个额外的好处是能够指定其他目录。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T15:39:42.657

在 Windows 上我会说使用`%WINDIR%\system32\where.exe`

您的问题标题没有指定窗口，所以我想有些人可能会发现这个问题与他们心中的 posix OS 相同（比如我自己）。

这个 php 片段可能对他们有帮助：

```
<?php
function Find( $file )
{
    foreach( explode( ':', $_ENV( 'PATH' ) ) as $dir )
    {
        $command = sprintf( 'find -L %s -name "%s" -print', $dir, $file );
        $output  = array();
        $result  = -1;
        exec( $command, $output, $result );

        if ( count( $output ) == 1 )
        {
            return( $output[ 0 ] );
        }
    }
    return null;
}
?> 
```

这是我在多台服务器上运行的稍微更改的生产代码。（即，为了简洁起见，从 OO 上下文中取出并留下一些卫生和错误检查。）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-01-30T21:37:24.650

在 Windows 上使用 PowerShell...

```
Function Get-ENVPathFolders {
#.Synopsis Split $env:Path into an array
#.Notes 
#  - Handle 1) folders ending in a backslash 2) double-quoted folders 3) folders with semicolons 4) folders with spaces 5) double-semicolons i.e. blanks
#  - Example path: 'C:\WINDOWS\;"C:\Path with semicolon; in the middle";"E:\Path with semicolon at the end;";;C:\Program Files;
#  - 2018/01/30 by Chad@ChadsTech.net - Created
$NewPath = @()
$env:Path.ToString().TrimEnd(';') -split '(?=["])' | ForEach-Object { #remove a trailing semicolon from the path then split it into an array using a double-quote as the delimeter keeping the delimeter
    If ($_ -eq '";') { # throw away a blank line
    } ElseIf ($_.ToString().StartsWith('";')) { # if line starts with "; remove the "; and any trailing backslash
        $NewPath += ($_.ToString().TrimStart('";')).TrimEnd('\')
    } ElseIf ($_.ToString().StartsWith('"')) {  # if line starts with " remove the " and any trailing backslash
        $NewPath += ($_.ToString().TrimStart('"')).TrimEnd('\') #$_ + '"'
    } Else {                                    # split by semicolon and remove any trailing backslash
        $_.ToString().Split(';') | ForEach-Object { If ($_.Length -gt 0) { $NewPath += $_.TrimEnd('\') } }
    }
}
Return $NewPath
}

$myFile = 'desktop.ini'
Get-ENVPathFolders | ForEach-Object { If (Test-Path -Path $_\$myFile) { Write-Output "Found [$_\$myFile]" } } 
```

我还在[http://blogs.catapultsystems.com/chsimmons/archive/2018/01/30/parse-envpath-with-powershell上写了一些详细信息的答案](http://blogs.catapultsystems.com/chsimmons/archive/2018/01/30/parse-envpath-with-powershell)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-12T16:17:30.927

除了“which”（MS Windows）和“where”（unix/linux）实用程序之外，我还编写了自己的实用程序，我称之为“findinpath”。除了查找将要执行**的**可执行文件外，如果将其交给命令行解释器 (CLI)，它将查找所有匹配项，返回路径搜索顺序，以便您找到路径顺序问题。此外，我的实用程序不仅返回可执行文件，还返回任何文件规范匹配，以捕捉所需文件实际上不是可执行的那些时间。

我还添加了一个非常漂亮的功能；-s 标志告诉它不仅搜索系统路径，还搜索系统磁盘上的所有内容，排除已知的用户目录。我发现此功能在系统管理任务中非常有用...

这是“用法”输出：

```
usage: findinpath [ -p <path> | -path <path> ] | [ -s | -system ] <file>
   or  findinpath [ -h | -help ]

where: <file> may be any file spec, including wild cards

       -h or -help returns this text

       -p or -path uses the specified path instead of the PATH environment variable.

       -s or -system searches the system disk, skipping /d /l/ /nfs and /users 
```

编写这样的实用程序并不难，我将把它作为练习留给读者。或者，如果在这里被问到，我会发布我的脚本——它在“bash”中。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-10-12T15:58:46.190

只是为了好玩，这是一个单行 powershell 实现

```
 function PSwhere($file) { $env:Path.Split(";") | ? { test-path $_\$file* } } 
```

# .net - 为什么在 MessageBox.Show 中使用所有者窗口？

> ID：195593
> 
> 赞同：24
> 
> 时间：2008-10-12T15:15:24.483
> 
> 标签：.net, winforms

MessageBox.Show 具有 MessageBox.Show(ownerWindow, .... ) 之类的形式。

通过分配所有者窗口我可以获得什么？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-12T15:39:54.840

消息框是一种模态窗体，这意味着它的父窗口被禁用，直到消息框被关闭。

如果调用不带所有者标识符的 Show() 重载，则通常会自动选择父表单。我在文档中找不到任何描述如何选择该表单的内容，但我的经验是，如果消息框显示在 GUI 线程（即主线程或消息泵线程）内，则该线程被选为父线程。

其他线程可能会创建没有父窗体的消息框。这可能是一个糟糕的情况，因为它可能位于活动窗口的后面，并且用户在关闭程序之前甚至都不知道它在那里。为避免这种情况，您可以将应用程序主窗口的句柄传递给 Show 方法，该方法将在消息框期间禁用该窗口。

* * *

**补充：**我一直在考虑这个，现在我不太确定。您在下面给出的反射器片段让我认为线程可能无关紧要。（我确实说过我在文档中找不到任何东西！）

我必须回去查看代码以确保，但我认为我以前在主窗体后面丢失的消息框实际上可能是自定义消息框窗体，在这种情况下我的经验是错误的，你永远不必提供父表单参数。

对困惑感到抱歉。

我现在的建议是永远不要提供这个参数，除非你需要除了活动窗口之外的东西作为主窗体。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-12T15:24:45.683

设置所有者会导致在消息框打开时禁用所有者。

如果您没有设置所有者，那么用户可以在消息框打开时单击其他内容甚至关闭所有者，然后当消息框关闭并且调用 MessageBox.Show 后的代码运行您的程序时，您的程序可以在未知状态 - 或者如果所有者已关闭，您现在正在一个不再存在的窗口内运行代码，并且对 WinForms 或 WPF（或就此而言，WinAPI 和任何其他框架）的方法的任何调用都可能导致崩溃。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-08-11T18:28:36.717

根据测试和[其他答案](https://stackoverflow.com/a/195614/429091)[`MessageBox.Show()`](http://msdn.microsoft.com/en-us/library/system.windows.forms.messagebox.show%28v=vs.110%29)，.net 将自动选择与您的呼叫在同一线程中的当前焦点窗口。要获得正确的行为，您*必须*确保`MessageBox`从与此窗口相同的线程中显示*，并将*逻辑上与之关联的窗口指定`MessageBox`为其`owner`. A `MessageBox`only modal-ly 阻止输入到`Form`启动它的线程上的其他 s。这可能与如何`MessageBox`使自己成为模态的（也许它会拦截针对当前线程的消息，并且只允许某些消息通过自身以外的窗口？）。模态阻塞输入的效果是用户将无法聚焦这些窗口或其中的任何控件，并且尝试这样做会产生“叮”的声音。此外，如果没有指定所有者，`MessageBox`则会自动选择当前线程上的活动窗口。如果当前活动窗口来自不同的线程（或不同的应用程序！），则`MessageBox`将没有所有者。这意味着它有自己的任务栏条目：它表现为自己独特的窗口。用户可以在您的应用程序中启动其他窗口（即使用户无法与它们交互）。您可能会遇到程序停止响应用户输入而用户感到困惑的情况，因为用户在显示对话框后以某种方式打开了应用程序的主窗口。但是，如果所有者设置正确，则尝试抬起主窗口将导致`MessageBox`抬起并闪烁。

为了使这一切与子窗口很好地工作，请确保每个子窗口都有其[`Owner`](http://msdn.microsoft.com/en-us/library/system.windows.forms.form.owner%28v=vs.110%29)属性集。如果您调用，这将自动发生[`ShowDialog()`](http://msdn.microsoft.com/en-us/library/system.windows.forms.form.showdialog(v=vs.110))（这使您的自定义`Form`模式（并在*您*传递给`owner`的相同情况下传递其参数））。`owner``MessageBox.Show()`

现在，大多数 winforms 编码都包括将代码直接写入`Form`子类内的事件处理程序中。在编写 winforms 事件处理程序时，您可以假设很多事情。首先，您永远不应该`this.Invoke()`在 GUI 事件处理程序中调用 to 作为顶级语句，因为此类处理程序*总是*`Form`在与创建子类的线程相同的线程上运行。其次，对于*许多*（但不是全部）这些处理程序，您可以假设它们`Form`具有焦点（因此会被自动选择`MessageBox.Show()`为其所有者）。例如，在按钮的 Click 事件处理程序（可能`button1_Click`称为`PerformClick()``Button`是不好的做法）。但是，[`Timer.Tick`](http://msdn.microsoft.com/en-us/library/system.windows.forms.timer.tick%28v=vs.110%29)即使您的表单没有聚焦，也可能会发生。因此，在 的情况下`Timer.Tick`，[不需要`Invoke()`（就像任何其他 winforms 事件处理程序一样）](https://stackoverflow.com/a/4532859/429091)但**需要**指定`owner`. 后一种情况更难引起注意，因为开发人员必须让他们的应用程序不聚焦才能注意到在这种情况下显示的对话框的行为与他们的应用程序聚焦时的行为略有不同。因此，请**指定`owner`何时需要使用`Invoke()` *，或者*在窗口未聚焦时是否可以触发事件。**该准则适用于调用`MessageBox.Show()`和`Form.ShowDialog()`。

*我在这里讨论的大部分内容都是在阅读其他答案时[弄乱的结果。](https://bitbucket.org/binki/unparentedmessagebox)*

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T21:44:47.240

事实证明，窗口所有权不是传递的。在你有表单、生成表单、生成 MessageBox 的情况下，MessageBox.Show 需要使用 ownerWindow 参数。原始窗体应设置为 MessageBox 的所有者窗口。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-08-27T19:28:42.763

调用`MessageBox.Show(frmMain,"a message","a title")`将表单与 frmMain 主表单本身一起添加`TextDialog` 到应用程序的表单集合中。`Application.OpenForms()`关闭消息框后它仍然存在。

当我调用`btnOK_Click()`并设置断点时，我刚刚发现了其中的 14 个。

当我打电话`frmMain.Close()`关闭主窗体时，什么也没发生。在所有 14 个 Application.OpenForms 都关闭之前，frmMain 不会关闭，否则您必须调用`Application.Exit()`.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-12T15:18:15.353

如果我没记错的话，这会阻止所有者窗口到 Focus()，直到消息框关闭。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-12T15:40:11.750

使用 Net Reflector，我刚刚在 Messagebox.Show 中找到了这段代码：

```
else if (owner == IntPtr.Zero)
    owner = UnsafeNativeMethods.GetActiveWindow(); 
```

因此，如果您没有嵌套所有权（ window--(owns)-->window--(owns)->messageBox），则省略 ownerWindow 会设置您通常选择的所有者。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-05-27T14:56:02.280

该文档似乎暗示所有者参数的唯一目的是如果您指定 MB_HELP，则消息框知道它应该将 WM_HELP 消息发送到哪个窗口。

[http://msdn.microsoft.com/en-us/library/ms645505%28VS.85%29.aspx](http://msdn.microsoft.com/en-us/library/ms645505%28VS.85%29.aspx)

* * *

哦，刚刚意识到 OP 是关于 .net 的——我给出了关于 winapi 的答案——对不起！

# c# - 在 SQL Server 2005 数据库中存储 ac# DateTimeOffset 值

> ID：195606
> 
> 赞同：5
> 
> 时间：2008-10-12T15:34:27.800
> 
> 标签：c#, sql-server-2005, datetimeoffset

我想将 aac# DateTimeOffset 值存储在 SQL Server 2005 数据库中。

Sql 2008 将此作为内置类型，但 SQL Server 2005 没有。

DateTimeOffset 结构有一个 DateTime 值，我将它存储为 DateTime，一个 Offset 属性（TimeSpan 类型）。由于这是相对于 UTC 的时区，因此推测它通常是整数小时或半小时。

有关如何最好地将其存储在 SQL Server 2005 数据库中的建议？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-12T15:42:16.350

假设偏移量是几个小时或半小时并不是一个好主意——周围肯定有四分之一小时的时区。

使用毫秒作为偏移量可能是最灵活的，但我认为分钟更容易阅读。如果您要查看数据库中的“原始”数据，则更容易理解值 60 = 1 小时而不是 3600000。我无法想象您真的需要几分之一分钟作为偏移量。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-14T22:44:46.697

将所有 DateTimeOffset 标准化为一个公共偏移量，最好是 UTC。然后像往常一样存储 DateTime 。提取后恢复偏移量，它应该是一个常数。这不会保留原始偏移量，但无论如何偏移量对于时区来说都是模棱两可的。

如果您确实需要知道日期/时间的来源，那么您需要存储一些时区信息。这是因为一个简单的偏移量不能明确表示时间的起源。请参阅（有些令人困惑的）关于[在 DateTime、DateTimeOffset 和 TimeZoneInfo 之间选择](http://msdn.microsoft.com/en-us/library/bb384267.aspx)的 MSDN 文档。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T15:36:34.693

将日期时间存储为日期时间，将偏移量存储为毫秒（bigint）

# python - 在 Python 中从列表中弹出元素的时间复杂度是多少？

> ID：195625
> 
> 赞同：60
> 
> 时间：2008-10-12T15:58:59.077
> 
> 标签：python

我想知道 Python 中列表对象的 pop 方法的时间复杂度是多少（特别是在 CPython 中）。list.pop(N) 的 N 值也会影响复杂性吗？

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2008-10-12T18:47:42.433

是的，弹出Python 列表的*最后一个元素是 O(1)，弹出**任意*元素是 O(N)（因为必须移动列表的整个其余部分）。

这是一篇关于如何存储和操作 Python 列表的精彩文章：http: [//effbot.org/zone/python-list.htm](http://effbot.org/zone/python-list.htm)

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2008-10-12T16:15:39.403

`Pop()`最后一个元素应该是 O(1) 因为你只需要返回数组中最后一个元素引用的元素并更新最后一个元素的索引。我希望`pop()`任意元素为 O(N) 并且平均需要 N/2 次操作，因为您需要将任何元素移动到要在指针数组中向上删除一个位置的元素之外。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2017-09-10T01:58:11.323

简短的答案是看这里：[https ://wiki.python.org/moin/TimeComplexity](https://wiki.python.org/moin/TimeComplexity)

没有参数来弹出它的 O(1)

使用 pop 的参数：

*   平均时间复杂度 O(k)（k 表示作为 pop 参数传入的数字
*   摊销的最坏情况时间复杂度 O(k)
*   最坏情况时间复杂度 O(n)

**平均时间复杂度：**

*   任何时候输入一个值，该操作的时间复杂度都是 O(n - k)。

*   例如，如果您有一个包含 9 个项目的列表，则从列表末尾删除是 9 个操作，从列表开头删除是 1 个操作（删除第 0 个索引并将所有其他元素移动到其当前索引 - 1 )

*   由于列表中间元素的 n - k 是 k 次操作，因此平均值可以缩短为 O(k)。

*   另一种思考方式是假设每个索引都从您的 9 项列表中删除一次。那将是总共 45 次操作。(9+8+7+6+5+4+3+2+1 = 45)

*   45 等于 O(nk) 并且由于弹出操作发生了 O(n) 次，因此您将 nk 除以 n 得到 O(k)

**摊销的最坏情况时间复杂度**

*   想象一下，您再次有一个包含 9 个项目的列表。想象一下，您正在删除列表中的每一项，并且发生了最坏的情况，并且您每次都删除了列表中的第一项。

*   由于列表每次缩小 1，因此总操作数每次从 9 减少到 1。

*   9 + 8 + 7 + 6 + 5 + 4 + 3 + 2 + 1 = 45。45 等于 O(nk)。由于您进行了 9 次操作并且 9 是 O(n) 来计算摊销的最坏情况，因此您执行 O(nk) / O(n) 等于 O(k)

*   说明平均和摊销的最坏情况时间复杂度的 O(n) 也是正确的。请注意 O(k) 大约为 O(1/2n) 并且删除常数等于 O(n)

**最坏情况时间复杂度**

*   与摊销的最坏情况时间复杂度不同，您不考虑数据结构的状态，只考虑任何单个操作的最坏情况。
*   在这种情况下，最坏的情况是您必须从列表中删除第一项，即 O(n) 时间。

[以下是我写的内容，以防万一有帮助：](https://repl.it/KtNW/1)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2018-07-28T23:58:11.903

L.pop(-1) 应该是 O(1)，L.pop(0) 应该是 O(n)

请参见以下示例：

```
from timeit import timeit
if __name__ == "__main__":
    L = range(100000)
    print timeit("L.pop(0)",  setup="from __main__ import L", number=10000)
    L = range(100000)
    print timeit("L.pop(-1)", setup="from __main__ import L", number=10000)

>>> 0.291752411828
>>> 0.00161794329896 
```

# python - 每次重新加载python模块时如何避免计算

> ID：195626
> 
> 赞同：6
> 
> 时间：2008-10-12T15:59:48.170
> 
> 标签：python, nltk

我有一个使用巨大字典全局变量的 python 模块，目前我将计算代码放在顶部，每次第一次导入或重新加载模块需要超过一分钟，这是完全不可接受的。如何将计算结果保存在某处，以便下次导入/重新加载不必计算它？我尝试了 cPickle，但从文件（1.3M）加载字典变量的时间与计算时间大致相同。

要提供有关我的问题的更多信息，

```
FD = FreqDist(word for word in brown.words()) # this line of code takes 1 min 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-12T20:12:25.073

只是为了澄清：模块主体中的代码*不会*在每次导入模块时执行 - 它只运行一次，之后未来的导入会找到已经创建的模块，而不是重新创建它。查看 sys.modules 以查看缓存模块的列表。

但是，如果您的问题是程序运行后第一次导入所需的时间，您可能需要使用 python dict 以外的其他方法。可能最好使用磁盘形式，例如 sqlite 数据库，dbm 模块之一。

对于界面的最小更改，搁置模块可能是您的最佳选择 - 这在 dbm 模块之间放置了一个非常透明的界面，使它们像任意 python dict 一样，允许存储任何可挑选的值。这是一个例子：

```
# Create dict with a million items:
import shelve
d = shelve.open('path/to/my_persistant_dict')
d.update(('key%d' % x, x) for x in xrange(1000000))
d.close() 
```

然后在下一个过程中，使用它。应该不会有很大的延迟，因为仅对磁盘表单上请求的键执行查找，因此不必将所有内容加载到内存中：

```
>>> d = shelve.open('path/to/my_persistant_dict')
>>> print d['key99999']
99999 
```

它比真正的字典要慢一些，如果**您**执行需要所有键的操作（例如尝试打印它），仍然需要很长时间才能加载，但可能会解决您的问题。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-12T17:29:46.163

在第一次使用时计算您的全局变量。

```
class Proxy:
    @property
    def global_name(self):
        # calculate your global var here, enable cache if needed
        ...

_proxy_object = Proxy()
GLOBAL_NAME = _proxy_object.global_name 
```

或者更好的是，通过特殊的数据对象访问必要的数据。

```
class Data:
    GLOBAL_NAME = property(...)

data = Data() 
```

例子：

```
from some_module import data

print(data.GLOBAL_NAME) 
```

请参阅[Django 设置](http://docs.djangoproject.com/en/dev/topics/settings/)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-12T16:14:43.523

我假设您已将 dict 文字粘贴到源代码中，这需要一分钟吗？我不知道如何解决这个问题，但你可能会避免在*导入*时实例化这个字典......你可以在第一次实际使用它时懒惰地实例化它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-12T17:38:20.500

您可以尝试使用[marshal](http://en.wikipedia.org/wiki/All_You_Zombies%E2%80%94)模块而不是 c?Pickle one；它可能会更快。python使用该模块以二进制格式存储值。请特别注意以下段落，以查看 marshal 是否符合您的需求：

> 并非所有 Python 对象类型都受支持；通常，只有值与 Python 的特定调用无关的对象才能被此模块写入和读取。支持以下类型：无、整数、长整数、浮点数、字符串、Unicode 对象、元组、列表、集合、字典和代码对象，应理解，元组、列表和字典仅支持 long因为其中包含的价值观本身是受支持的；并且不应该编写递归列表和字典（它们会导致无限循环）。

为了安全起见，在解组 dict 之前，请确保解组 dict 的 Python 版本与执行编组的 Python 版本相同，因为不能保证向后兼容性。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-06T01:56:12.390

如果“搁置”解决方案太慢或太繁琐，还有其他可能性：

*   [推](http://pypi.python.org/pypi/shove)
*   [杜鲁斯](http://www.mems-exchange.org/software/durus/)
*   [佐佩数据库](http://www.zope.org)
*   [pyTables](http://www.pytables.org/)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-07-26T15:28:23.640

`shelve`使用大型数据集变得非常慢。我一直在非常成功地使用[redis](http://streamhacker.com/2009/05/20/building-a-nltk-freqdist-on-redis/) ，并围绕它编写了一个[FreqDist 包装器。](http://bitbucket.org/japerk/nltk-extras/src/tip/probability.py)它非常快，并且可以同时访问。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-12T17:04:20.910

您可以使用[搁板](http://www.python.org/doc/2.5.2/lib/module-shelve.html)将数据存储在磁盘上，而不是将整个数据加载到内存中。所以启动时间会非常快，但代价是访问时间会变慢。

Shelve 也会腌制 dict 值，但不会在启动时对所有项目进行（取消）腌制，而只会在每个项目本身的访问时进行。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-12T22:31:37.210

一些有助于加快进口的事情：

1.  在运行 python 时，您可以尝试使用 -OO 标志运行 python。这将进行一些优化，以减少模块的导入时间。
2.  是否有任何理由不能将字典分解为可以更快加载的单独模块中的较小字典？
3.  作为最后的手段，您可以异步进行计算，这样它们就不会延迟您的程序，直到它需要结果。或者，如果您想利用多核架构，甚至可以将字典放在单独的进程中并使用 IPC 来回传递数据。

话虽如此，我同意您在第一次导入模块后不应该遇到任何延迟。以下是其他一些一般性想法：

1.  您是否在函数中导入模块？如果是这样，这*可能*会导致性能问题，因为它必须在每次遇到 import 语句时检查并查看模块是否已加载。
2.  你的程序是多线程的吗？我曾见过在多线程应用程序中导入模块时执行代码会导致一些不稳定和应用程序不稳定的情况（最明显的是 cgitb 模块）。
3.  如果这是一个全局变量，请注意全局变量查找时间可能比局部变量查找时间长得多。在这种情况下，如果您在同一上下文中多次使用字典，则可以通过将字典绑定到局部变量来显着提高性能。

话虽如此，在没有更多背景信息的情况下给你任何具体建议有点困难。更具体地说，您在哪里导入它？计算是什么？

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-14T13:07:08.347

1.  将计算密集型部分分解为单独的模块。然后至少在重新加载时，您不必等待。

2.  尝试使用协议 2 转储数据结构。尝试的命令是`cPickle.dump(FD, protocol=2)`. 从文档字符串中`cPickle.Pickler`：

    > ```
    > Protocol 0 is the
    > only protocol that can be written to a file opened in text
    > mode and read back successfully.  When using a protocol higher
    > than 0, make sure the file is opened in binary mode, both when
    > pickling and unpickling. 
    > ```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-02-06T16:28:31.870

我正在经历同样的问题......搁置，数据库等......对于这类问题来说都太慢了。您需要接受一次打击，将其插入到 Redis 等内存键/值存储中。它只会存在于内存中（警告它可能会占用大量内存，因此您可能需要一个专用的盒子）。您永远不必重新加载它，您只需在内存中查找密钥

```
r = Redis()
r.set(key, word)

word = r.get(key) 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-12T17:54:36.753

扩展延迟计算的想法，为什么不把 dict 变成一个根据需要提供（和缓存）元素的类呢？

您还可以使用 psyco 来加快整体执行速度……

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-12T18:08:54.853

*或者*您可以只使用数据库来存储值？查看 SQLObject，这使得将内容存储到数据库变得非常容易。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-10T18:06:13.157

对于这个问题，还有另一个非常明显的解决方案。重新加载代码时，原始范围仍然可用。

所以......做这样的事情将确保这段代码只执行一次。

```
try:
    FD
except NameError:
    FD = FreqDist(word for word in brown.words()) 
```

# css - 如何使用 CSS 更改输入按钮图像

> ID：195632
> 
> 赞同：190
> 
> 时间：2008-10-12T16:04:13.700
> 
> 标签：css, input-button-image

所以，我可以使用图像创建一个输入按钮

```
<INPUT type="image" src="/images/Btn.PNG" value=""> 
```

但是，我无法使用 CSS 获得相同的行为。例如，我试过

```
<INPUT type="image" class="myButton" value=""> 
```

其中“myButton”在 CSS 文件中定义为

```
.myButton {
    background:url(/images/Btn.PNG) no-repeat;
    cursor:pointer;
    width: 200px;
    height: 100px;
    border: none;
} 
```

如果这就是我想做的全部，我可以使用原始样式，但我想更改按钮在悬停时的外观（使用`myButton:hover`类）。我知道这些链接很好，因为我已经能够将它们加载为页面其他部分的背景图像（仅作为检查）。我在网上找到了如何使用 JavaScript 的示例，但我正在寻找 CSS 解决方案。

如果有区别，我正在使用 Firefox 3.0.3。

* * *

## 回答 #1

> 赞同：121
> 
> 时间：2008-10-12T16:10:18.913

如果您想使用 CSS 设置按钮样式，请将其设为 type="submit" 按钮而不是 type="image"。type="image" 需要一个 SRC，你不能在 CSS 中设置它。

请注意，Safari 不会让您以您正在寻找的方式设置任何按钮的样式。如果您需要 Safari 支持，则需要放置图像并具有提交表单的 onclick 功能。

* * *

## 回答 #2

> 赞同：115
> 
> 时间：2008-10-12T16:14:13.603

您可以使用`<button>`标签。对于提交，只需添加`type="submit"`. 然后，当您希望按钮显示为图形时，请使用背景图像。

像这样：

```
<button type="submit" style="border: 0; background: transparent">
 <img src="https://i.imgur.com/tXLqhgC.png" width="90" height="90" alt="submit" />
</button>
```

[更多信息](http://htmldog.com/reference/htmltags/button/)

* * *

## 回答 #3

> 赞同：76
> 
> 时间：2009-07-28T10:54:51.123

```
div.myButton input {
  background: url(https://i.imgur.com/tXLqhgC.png) no-repeat;
  background-size: 90px;
  width: 90px;
  height: 90px;
  cursor: pointer;
  border: none;
}
```

```
<div class="myButton">
  <INPUT type="submit" name="" value="">
</div>
```

这在任何地方都可以使用，即使在 Safari 中也是如此。

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2008-10-12T16:12:31.217

这篇关于[提交按钮的 CSS 图像替换的](http://www.ampsoft.net/webdesign-l/image-button.html)文章可能会有所帮助。

*“使用此方法，您将在样式表处于活动状态时获得可点击的图像，并在样式表关闭时获得标准按钮。诀窍是将图像替换方法应用于按钮标记并将其用作提交按钮，而不是“

_*

CSS 代码：

```
#replacement-1 {
  width: 100px;
  height: 55px;
  margin: 0;
  padding: 0;
  border: 0;
  background: transparent url(image.gif) no-repeat center top;
  text-indent: -1000em;
  cursor: pointer; /* hand-shaped cursor */
  cursor: hand; /* for IE 5.x */
}

#replacement-2 {
  width: 100px;
  height: 55px;
  padding: 55px 0 0;
  margin: 0;
  border: 0;
  background: transparent url(image.gif) no-repeat center top;
  overflow: hidden;
  cursor: pointer; /* hand-shaped cursor */
  cursor: hand; /* for IE 5.x */
}
form>#replacement-2 { /* For non-IE browsers*/
  height: 0px;
} 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2011-02-03T02:38:40.767

这是一个更简单的解决方案，但没有额外的周围 div：

```
<input type="submit" value="Submit"> 
```

CSS 使用基本的图像替换技术。对于奖励积分，它使用图像精灵显示：

```
<style>
    input[type="submit"] {
        border: 0;
        background: url('sprite.png') no-repeat -40px left;
        text-indent: -9999em;
        line-height:3000;
        width: 50px;
        height: 20px;
    }
</style> 
```

来源： [http ://work.arounds.org/issue/21/using-css-sprites-with-input-type-submit-buttons/](http://work.arounds.org/issue/21/using-css-sprites-with-input-type-submit-buttons/)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-02-11T16:09:11.607

这是在 Internet Explorer 上对我有用的方法，对 Philoye 的解决方案进行了轻微修改。

```
>#divbutton
{
    position:relative;
    top:-64px;
    left:210px;
    background: transparent url("../../images/login_go.png") no-repeat;
    line-height:3000;
    width:33px;
    height:32px;
    border:none;
    cursor:pointer;
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-04-01T17:56:43.463

您可以使用*blank.gif*（单像素透明图像）作为标签中的目标：

```
<input type="image" src="img/blank.gif" class="button"> 
```

然后在 CSS 中设置背景样式：

```
.button {border:0;background:transparent url("../img/button.png") no-repeat 0 0;}
.button:hover {background:transparent url("../img/button-hover.png") no-repeat 0 0;} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-04-15T20:59:41.317

先前答案的变体：

我发现需要设置不透明度，当然这适用于 Internet Explorer 6 及更高版本。Internet Explorer 8 中的 line-height 解决方案存在问题，即按钮没有响应。有了这个，你也会得到一个手形光标！

```
<div id="myButton">
    <input id="myInputButton" type="submit" name="" value="">
</div>

#myButton {
    background: url("form_send_button.gif") no-repeat;
    width: 62px;
    height: 24px;
}

#myInputButton {
    background: url("form_send_button.gif") no-repeat;
    opacity: 0;
    -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";
    filter: alpha(opacity=0);
    width: 67px;
    height: 26px;
    cursor: pointer;
    cursor: hand;
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-04-23T19:14:00.547

我认为以下是最好的解决方案：

CSS：

```
.edit-button {
    background-image: url(edit.png);
    background-size: 100%;
    background-repeat: no-repeat;
    width: 24px;
    height: 24px;
} 
```

HTML：

```
<input class="edit-button" type="image" src="transparent.png" /> 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-11-20T20:10:37.850

我没有 JavaScript 和图像的解决方案是这样的：

***HTML：***

```
<input type=Submit class=continue_shopping_2
       name=Register title="Confirm Your Data!"
       value="confirm your data"> 
```

***CSS：***

```
.continue_shopping_2: hover {
    background-color: #FF9933;
    text-decoration: none;
    color: #FFFFFF;
}

.continue_shopping_2 {
    padding: 0 0 3px 0;
    cursor: pointer;
    background-color: #EC5500;
    display: block;
    text-align: center;
    margin-top: 8px;
    width: 174px;
    height: 21px;
    border-radius: 5px;
    border-width: 1px;
    border-style: solid;
    border-color: #919191;
    font-family: Verdana;
    font-size: 13px;
    font-style: normal;
    line-height: normal;
    font-weight: bold;
    color: #FFFFFF;
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-25T19:40:52.283

也许您也可以只导入一个 .js 文件并在 JavaScript 中替换图像。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-03-11T12:19:41.130

假设您无法更改输入类型，甚至无法更改*src*。你*只有*CSS 可以玩。

如果你知道你想要的高度，并且你有一个你想要使用的背景图片的 URL，那么你很幸运。

将高度设置为零并将填充顶部设置为您想要的高度。这会将原始图像推到视线之外，为您提供一个非常干净的空间来显示您的 CSS 背景图像。

它适用于 Chrome。我不知道它是否适用于 Internet Explorer。几乎没有什么聪明的事情，所以可能不会。

```
#daft {
  height: 0;
  padding-top: 100px;
  width: 100px;
  background-image: url(clever.jpg);
}
```

```
<input type="image" src="daft.jpg" id="daft">
```

# .net - 如何将所有者窗口传递给不同线程上的 MessageBox.Show？

> ID：195635
> 
> 赞同：2
> 
> 时间：2008-10-12T16:09:53.127
> 
> 标签：.net

我正在尝试找出消息框（ownerWindow，...）。

使用反射器，我看到 ownerWindow 默认为线程的 ActiveWindow。

所以我唯一需要 ownerWindow 参数的时候是从另一个线程调用 Show。

但是，当我尝试这个时，我得到一个跨线程异常。

```
 private void button1_Click( object sender, EventArgs e ) {
        new Thread( () => MessageBox.Show( this, "Test" ) ).Start();
    } 
```

所以看起来我唯一需要明确声明所有者窗口的时候，我不能使用它！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-12T16:13:11.920

您必须执行 BeginInvoke 来编组对 UI 线程的调用。

下面的代码是一个简单的示例，您可以如何做到这一点。我还没有编译它，所以它可能有错误，但它可能会给你一些指示。

```
private delegate void ThreadExecuteDelegate(object args);

public void StartThread
{
   Thread thread = new Thread(new ParameterizedThreadStart(ThreadExecute));
   thread.Start((IWin32Window)this);
}

private void ThreadExecute(object args)
{
    if(this.InvokeRequired)
    {
        this.BeginInvoke(new ThreadExecuteDelegate(ThreadExecute), args);
        return;
    }   

    IWin32Window window = (IWin32Window)args;
    MessageBox.Show(window, "Hello world");
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T21:19:20.960

测试交叉线程的是 Control.Handle getter。

添加以下代码可以解决问题。

```
 public class Win32Window :IWin32Window {
        IntPtr handle;
        public Win32Window( IWin32Window window ) {
            this.handle = window.Handle;
        }

        IntPtr IWin32Window.Handle {
            get { return handle; }
        }
    }

    private void button1_Click( object sender, EventArgs e ) {
        IWin32Window window = new Win32Window( this );
        new Thread( () => MessageBox.Show( window, "Test" ) ).Start();
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-12T16:23:04.067

如果您不想费心在线程间显式编组调用，请使用[BackgroundWorker](http://msdn.microsoft.com/en-us/library/8xs8549b.aspx)和`ReportProgress`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-12T16:38:51.773

您可能想查看[Win32 Window Hierarchy and Styles](http://msdn.microsoft.com/en-us/library/ms997562.aspx)以了解所有者窗口和父窗口之间的区别。ActiveWindows 并不总是需要拥有消息框，我曾研究过 ActiveWindow 不一定是 MessageBox 所有者的应用程序。

此外，根据 win32 窗口规则，控件层次结构不能在不同线程上创建控件，这就是为什么您需要将对 MessageBox.Show 的调用编组到父窗口的线程。

# java - 我可以使用哪些库将 POJO 绑定到 TDD 的外部文件而无需太多开销？

> ID：195639
> 
> 赞同：1
> 
> 时间：2008-10-12T16:13:01.327
> 
> 标签：java, binding, pojo

我需要一种将 POJO 对象绑定到外部实体的方法，该实体可以是 XML、YAML、结构化文本或任何易于编写和维护的东西，以便为单元测试和 TDD 创建 Mock 数据。以下是我尝试过的一些库，但它们的主要问题是我被困在 Java 1.4 上（至少 3 个月以上）。我想了解我可以使用什么，尽可能低的开销和前期设置（例如使用模式或 DTD），并且没有复杂的 XML。这是我真正喜欢的库（但显然不适用于 1.4 或不支持构造函数 - 你必须有设置器）：

**RE-JAXB（或真正简单的 Java XML 绑定）**

[http://jvalentino.blogspot.com/2008/07/in-response-to-easyest-java-xml-binding.html](http://jvalentino.blogspot.com/2008/07/in-response-to-easiest-java-xml-binding.html) [http://sourceforge.net/projects/rejaxb/](http://sourceforge.net/projects/rejaxb/)[](http://sourceforge.net/projects/rejaxb/)

无缝绑定这个：

```
<item>
    <title>Astronauts' Dirty Laundry</title>
    <link>http://liftoff.msfc.nasa.gov/news/2003/news-laundry.asp</link>
    <description>Compared to earlier spacecraft, the International Space
    Station has many luxuries, but laundry facilities are not one of them.
    Instead, astronauts have other options.</description>
    <pubDate>Tue, 20 May 2003 08:56:02 GMT</pubDate>
    <guid>http://liftoff.msfc.nasa.gov/2003/05/20.html#item570</guid>
</item> 
```

对此：

```
@ClassXmlNodeName("item")
public class Item {
 private String title;
 private String link;
 private String description;
     private String pubDate;
     private String guid;

     //getters and settings go here... 
} 
```

使用：

```
Rss rss = new Rss();
XmlBinderFactory.newInstance().bind(rss, new File("Rss2Test.xml")); 
```

问题：它依赖于注解，所以对 Java 1.4 没有好处

**yaml** [http://jyaml.sourceforge.net/](http://jyaml.sourceforge.net/)

无缝绑定：

```
--- !user
name: Felipe Coury
password: felipe
modules: 
   - !module
     id: 1
     name: Main Menu
     admin: !user
    name: Admin
    password: password 
```

对此：

```
public class User {
    private String name;
    private String password;
    private List modules;
}

public class Module {
    private int id;
    private String name;
    private User admin;
} 
```

使用：

```
YamlReader reader = new YamlReader(new FileReader("example.yaml"));
reader.getConfig().setClassTag("user", User.class);
reader.getConfig().setClassTag("module", Module.class);
User user = (User) reader.read(User.class); 
```

问题：它不适用于构造函数（因此对不可变对象没有好处）。我必须更改我的对象或编写自定义代码来处理 YAML 解析。

请记住，我想尽可能避免 - 编写数据描述符，我想要一些“正常工作”的东西。

你有什么建议吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-12T16:44:38.453

如果要填充的对象是简单的 bean，那么查看 apache common 的 BeanUtils 类可能是个好主意。populate() 方法可能适合所描述的情况。一般来说，像 Spring 这样的依赖注入框架可能非常有用，但这可能无法解决当前的问题。对于 xml 形式的输入，jibx 可能是一个不错的选择，jaxb 1.0 也是如此。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-12T17:57:28.637

只需使用 XStream（对于 XML 或者您可以尝试使用 JSON）。

但...

伙计，我无法避免认为将测试数据放在单元测试本身之外会导致您无法阅读测试。阅读测试用例时需要查看两个文件，您将丢失重构工具（更改属性名称时）。Jay Fields 可以比我更好地解释它：

[http://blog.jayfields.com/2007/06/testing-inline-setup.html](http://blog.jayfields.com/2007/06/testing-inline-setup.html)

亲切的问候

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-12T23:01:11.423

你可以试试Java1.4平台默认添加的XMLEncoder/XMLDecoder

这是我使用它的方式。

```
import java.beans.XMLEncoder;
import java.beans.XMLDecoder;
import java.io.BufferedInputStream;
import java.io.BufferedOutputStream;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;

public class ToXml {

    /**
     * Write an object to a file in XML format.
     * @param o - The object to serialize.
     * @param file - The file where to write the object.
     */
    public static void writeObject( Object o, String file  ) {
       XMLEncoder e = null;
       try {

           e = new XMLEncoder( new BufferedOutputStream( new FileOutputStream(file)));

           e.writeObject(o);

       }catch( IOException ioe ) {
           throw new RuntimeException( ioe );
       }finally{
           if( e != null ) {
               e.close();
           }
       }
    }

    /**
     * Read a xml serialized object from the specified file.
     * @param file - The file where the serialized xml version of the object is.
     * @return  The object represented by the xmlfile.
     */
    public static Object readObject( String file ){
       XMLDecoder d = null;
       try {

           d = new XMLDecoder( new BufferedInputStream( new FileInputStream(file)));

           return  d.readObject();

       }catch( IOException ioe ) {
           throw new RuntimeException( ioe );
       }finally{
           if( d != null ) {
               d.close();
           }
       }
    } 
```

}

这很容易，很简单，在核心库中。

你只需要编写加载机制。

我有这个摇摆应用程序，它可以在 5 到 10 秒内从远程 EJB 加载数据。我所做的是像这样将上一个会话存储在 XML 中，当应用程序加载时，它会在不到 1 秒的时间内获得上一个会话的所有数据。

当用户开始使用应用程序时，后台线程会获取自上次会话以来已更改的那些元素。

# windows - Windows 无法在本地计算机上启动 Apache2 - 问题

> ID：195641
> 
> 赞同：71
> 
> 时间：2008-10-12T16:13:14.680
> 
> 标签：windows, windows-xp, apache2

在安装 Apache2 期间，我在 cmd 窗口中收到以下消息：

> 安装Apache2.2服务 Apache2.2服务安装成功。测试 httpd.conf....
> 
> 必须先纠正此处报告的错误，然后才能启动服务。httpd.exe：无法可靠地确定服务器的完全限定域名，使用 192.168.1.3 作为 ServerName (OS 10048) 通常只允许使用每个套接字地址（协议/网络地址/端口）。: make_sock: 无法绑定到地址 0.0.0.0:80 没有可用的监听套接字，正在关闭 无法打开日志 请注意上面的错误或消息，然后按 键退出。24...

安装后一切看起来都很好，但事实并非如此。如果我尝试启动服务，则会收到以下消息：

> Windows 无法在本地计算机上启动 Apache2。有关详细信息，请查看系统事件日志。如果这是一项非 Micorsoft 服务，请联系服务供应商，并参阅特定于服务的错误代码 1。

Apache2版本是2.2.9

有没有人有同样的问题，或者可以帮助我。

* * *

## 回答 #1

> 赞同：139
> 
> 时间：2008-10-12T16:21:55.303

还有一些其他程序在监听 80 端口，通常的嫌疑人是

1.  Skype（监听端口 80）
2.  NOD32（将 Apache 添加到 IMON 例外列表以允许 apache 绑定）
3.  其他一些杀毒软件（同上）

纠正它的方法是关闭使用端口 80 的程序，或者将其配置为使用不同的端口，或者使用 httpd.conf 中的 Listen 指令将 Apache 配置为侦听不同的端口。在防病毒的情况下，配置防病毒以允许 Apache 绑定到您选择的端口。

诊断哪个应用程序（如果有）绑定到端口 80 的方法是使用这些选项运行 netstat，在本地 IP 地址（第二列）旁边查找 :80 并找到 PID（最后一列）。然后，在任务管理器上，您可以找到哪个进程具有您在上一步中获得的 PID。（您可能需要在任务管理器上添加 PID 列）

C:\Users\vinko>netstat -ao -p tcp

```
Conexiones activas

  Proto  Dirección local          Dirección remota        Estado           PID
  TCP    127.0.0.1:1110         127.0.0.1:51373        TIME_WAIT       0
  TCP    127.0.0.1:1110         127.0.0.1:51379        TIME_WAIT       0
  TCP    127.0.0.1:1110         127.0.0.1:51381        ESTABLISHED     388
  TCP    127.0.0.1:1110         127.0.0.1:51382        TIME_WAIT       0
  TCP    127.0.0.1:1110         127.0.0.1:51479        TIME_WAIT       0
  TCP    127.0.0.1:1110         127.0.0.1:51481        TIME_WAIT       0
  TCP    127.0.0.1:1110         127.0.0.1:51483        TIME_WAIT       0
  TCP    127.0.0.1:1110         127.0.0.1:51485        ESTABLISHED     388
  TCP    127.0.0.1:1110         127.0.0.1:51487        TIME_WAIT       0
  TCP    127.0.0.1:1110         127.0.0.1:51489        ESTABLISHED     388
  TCP    127.0.0.1:51381        127.0.0.1:1110         ESTABLISHED     5168
  TCP    127.0.0.1:51485        127.0.0.1:1110         ESTABLISHED     5168
  TCP    127.0.0.1:51489        127.0.0.1:1110         ESTABLISHED     5168
  TCP    127.0.0.1:59264        127.0.0.1:59265        ESTABLISHED     5168
  TCP    127.0.0.1:59265        127.0.0.1:59264        ESTABLISHED     5168
  TCP    127.0.0.1:59268        127.0.0.1:59269        ESTABLISHED     5168
  TCP    127.0.0.1:59269        127.0.0.1:59268        ESTABLISHED     5168
  TCP    192.168.1.34:51278     192.168.1.33:445       ESTABLISHED     4
  TCP    192.168.1.34:51383     67.199.15.132:80       ESTABLISHED     388
  TCP    192.168.1.34:51486     66.102.9.18:80         ESTABLISHED     388
  TCP    192.168.1.34:51490     74.125.4.20:80         ESTABLISHED     388 
```

如果您想禁用 Skype 监听端口 80 和 443，您可以点击链接[http://www.mydigitallife.info/disable-skype-from-using-opening-and-listening-on-port-80-and -443-on-local-computer/](http://www.mydigitallife.info/disable-skype-from-using-opening-and-listening-on-port-80-and-443-on-local-computer/)

* * *

## 回答 #2

> 赞同：111
> 
> 时间：2011-12-18T03:11:44.150

我希望这可以帮助其他人解决此错误。

**从命令行运行 httpd.exe**以获得对问题的准确描述。

我有相同的错误消息，结果是未配置的 ServerRoot 路径。即使在运行 setup_xampp.bat 之后，httpd.conf 的路径也错误。

我的 error.log 是空的，并且启动服务不会提供信息丰富的错误消息。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-06-24T07:01:06.333

解决此问题的更好方法是更改​​ Apache2\conf\httpd.conf 中的端口号。更改端口号为 fallows::: Listen 8888 和 ServerName machinename:8888 。更改端口号后重新启动Apache服务器。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-10T14:34:08.433

我有同样的问题。我检查了 netstat，其他进程正在运行，防火墙并更改了 httpd.conf，停止了防病毒，但我所有的努力都是徒劳的。:(

所以最后的解决方案是停止 IIS。它奏效了:)

我猜 IIS 和 apache 不能一起工作。如果有人知道任何解决方法，请告诉我们。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2015-04-27T15:45:25.563

正如 Tim 所说，从命令行运行 httpd.exe。PostgreSQL 的路径发生了变化，端口 80 上没有运行其他任何东西，我在文件中没有看到任何内容`error.log`。

设置好基础后，我会克隆我的引导驱动器/分区，这样我就不必花费三天的时间来安装和重新调整所有内容。轮到我重新安装了我的 WAPP 堆栈并为 PostgreSQL 使用了非常具体的名称/版本。**除非您从命令行运行该命令，否则 Windows 不会返回特定的错误消息。**

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-07-11T04:09:31.593

按照这个步骤，它会正常工作。转到**控制面板**->**程序和功能**->单击打开**和关闭Windows功能**->查看**是否选中了IIS**如果选中，请取消选中**IIS**并重新启动计算机。之后打开服务查看**Web部署代理**服务状态如果它已启动，请停止。如果未启动，请手动启动**WampAppache 和 WampSqlID 。**它对我有用。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2013-08-15T16:44:05.047

你好我今天也遇到这个问题。并且事件查看器中的日志错误如下 Apache 服务命名报告了以下错误：

> > > 1.Wrapper php-cgi.exe 无法访问：(720005)Access is denied.
> > > 
> > > 2.apache服务监视器：请求的操作失败

这是实际的访问问题。所以流动的解决方案是帮助我更改 php-cgi.exe 安全属性

*   ***不继承父母的许可...***

*   ***请添加所有人用户***

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-01-10T05:48:35.447

如果 appache 和 IIS 同时运行，那么就有可能挂起 apache 服务，，，，

当我一次停止所有 IIS 网站然后重新启动 apache 服务时，它对我有用.... Jai ...

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-03-27T04:29:35.637

Windows Vista Home Premium 操作系统问题：解决问题的最简单方法是更改​​ Apache2\conf\httpd.conf 中的端口号。

在以下行中更改端口号。'Listen' 从 80 到 8888 和 'ServerName' 机器名（例如：localhost）从 80 到 8888。保存然后关闭。打开 Apache Service Monitor 并重新启动服务或转到计算机管理 > 服务并找到 Apache 2.2 并启动或重新启动。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-07-13T09:13:23.183

从控制面板中删除 apache 并从 Program Files 中删除 apache 文件夹并重新启动机器，然后再次安装 apache。这将解决问题；如果没有，请执行以下操作：安装 IIS 如果未安装，则启动 IIS 并停止它...使用服务启动 apache 服务...享受 apache。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-03-01T15:02:31.117

我遇到过两次这个问题。使用此页面上的标记答案解决了第一个问题（谢谢）。然而，第二次证明有点困难。

我发现在我的 httpd-vhosts.conf 文件中，我在将文档根分配给域名时犯了一个错误。解决这个问题解决了我的问题。非常值得检查（甚至恢复为空白副本）您的 httpd-vhosts.conf 文件是否有任何错误和拼写错误。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-03-13T06:00:01.257

如果您使用的是 windows 操作系统并且认为 skype 不是嫌疑人，那么您可能需要检查任务管理器并检查“显示所有用户的进程”并确保没有 httpd.exe 条目。否则，结束其进程。这解决了我的问题。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-08-26T05:37:46.880

是的，我不得不将端口 :80 更改为 :90，因为端口 :80 正被其他一些系统资源占用。

可以看到Apache2.2\logs文件夹下的日志

谢谢，

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2013-11-23T21:26:29.840

始终仔细检查 httpd.conf 以查看文档根目录是否正确指向现有文件夹

```
#if you have c:\your-main-folder\www\
DocumentRoot "c:/your-main-folder/www/" 

#if you have c:\your-main-folder\www\sub-folder\
DocumentRoot "c:/your-main-folder/www/sub-folder/" 
```

`DocumentRoot`指向驱动器中必须存在的文件夹。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2014-03-08T09:33:07.583

我遇到过同样的问题。当我重新启动我的 wamp 时，它变成黄色图标但不是绿色。在服务中，我停止所有 sql server 服务。之后它对我有用..

*   二认为应该小心。1 ) 端口应该不同 2 ) 停止那些可以在端口 80 上的服务

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2019-12-08T05:22:34.383

我遇到了同样的问题，在我的情况下，我需要在 httpd.conf 中添加模块
文件不完整，关键字不正确（如 LoadModule ）
转到命令行，转到**C:\Apache24\bin**

C:\Apache24\bin **> httpd.exe**

从上面命令的输出中可以知道错误的原因

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-09-10T16:53:14.190

谢谢你们的帮助。我发现了另一个罪魁祸首。最近 SimplifyMedia 添加了照片共享选项。显然它也使用端口 80 并阻止 Apache 启动。我希望这可以帮助某人。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2010-05-10T19:59:29.233

我也来了同样的问题。解决方案是转到添加或删除程序，然后单击打开或关闭 Windows 功能。关闭 IIS。即关闭“互联网信息服务”和“互联网信息服务可移动网络核心”。我选择了其余的功能都开启了。计算机将要求重新启动系统。重新启动您的计算机，然后安装 apache http 服务器。我得到了它。服务器成功运行...

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2016-05-29T00:54:56.400

对我来说，这是将文档根目录 (in `httpd.conf`) 设置为一个不存在的目录的结果（我刚刚清空了以前项目的 htdocs）。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-06-14T02:55:35.173

Windows 10 - 管理员帐户

我需要在 Windows 服务中将帐户切换为管理员类型帐户

```
httpd.exe -k install 
```

未能添加具有足够用户权限的设置。

# regex - 这组正则表达式是否完全防止跨站点脚本？

> ID：195648
> 
> 赞同：6
> 
> 时间：2008-10-12T16:16:40.633
> 
> 标签：regex, security, xss

下面的代码无法捕捉到的危险示例是什么？

编辑：在一些评论之后，我添加了另一行，评论如下。请参阅 Vinko 在 David Grant 的回答中的评论。到目前为止，只有 Vinko 回答了这个问题，该问题要求提供可以忽略此功能的具体示例。Vinko 提供了一个，但我已经编辑了代码来关闭这个漏洞。如果你们中的其他人能想到另一个具体的例子，你会得到我的投票！

```
public static string strip_dangerous_tags(string text_with_tags)
{
    string s = Regex.Replace(text_with_tags, @"<script", "<scrSAFEipt", RegexOptions.IgnoreCase);
    s = Regex.Replace(s, @"</script", "</scrSAFEipt", RegexOptions.IgnoreCase);
    s = Regex.Replace(s, @"<object", "</objSAFEct", RegexOptions.IgnoreCase);
    s = Regex.Replace(s, @"</object", "</obSAFEct", RegexOptions.IgnoreCase);
    // ADDED AFTER THIS QUESTION WAS POSTED
    s = Regex.Replace(s, @"javascript", "javaSAFEscript", RegexOptions.IgnoreCase);

    s = Regex.Replace(s, @"onabort", "onSAFEabort", RegexOptions.IgnoreCase);
    s = Regex.Replace(s, @"onblur", "onSAFEblur", RegexOptions.IgnoreCase);
    s = Regex.Replace(s, @"onchange", "onSAFEchange", RegexOptions.IgnoreCase);
    s = Regex.Replace(s, @"onclick", "onSAFEclick", RegexOptions.IgnoreCase);
    s = Regex.Replace(s, @"ondblclick", "onSAFEdblclick", RegexOptions.IgnoreCase);
    s = Regex.Replace(s, @"onerror", "onSAFEerror", RegexOptions.IgnoreCase);
    s = Regex.Replace(s, @"onfocus", "onSAFEfocus", RegexOptions.IgnoreCase);

    s = Regex.Replace(s, @"onkeydown", "onSAFEkeydown", RegexOptions.IgnoreCase);
    s = Regex.Replace(s, @"onkeypress", "onSAFEkeypress", RegexOptions.IgnoreCase);
    s = Regex.Replace(s, @"onkeyup", "onSAFEkeyup", RegexOptions.IgnoreCase);

    s = Regex.Replace(s, @"onload", "onSAFEload", RegexOptions.IgnoreCase);

    s = Regex.Replace(s, @"onmousedown", "onSAFEmousedown", RegexOptions.IgnoreCase);
    s = Regex.Replace(s, @"onmousemove", "onSAFEmousemove", RegexOptions.IgnoreCase);
    s = Regex.Replace(s, @"onmouseout", "onSAFEmouseout", RegexOptions.IgnoreCase);
    s = Regex.Replace(s, @"onmouseup", "onSAFEmouseup", RegexOptions.IgnoreCase);
    s = Regex.Replace(s, @"onmouseup", "onSAFEmouseup", RegexOptions.IgnoreCase);

    s = Regex.Replace(s, @"onreset", "onSAFEresetK", RegexOptions.IgnoreCase);
    s = Regex.Replace(s, @"onresize", "onSAFEresize", RegexOptions.IgnoreCase);
    s = Regex.Replace(s, @"onselect", "onSAFEselect", RegexOptions.IgnoreCase);
    s = Regex.Replace(s, @"onsubmit", "onSAFEsubmit", RegexOptions.IgnoreCase);
    s = Regex.Replace(s, @"onunload", "onSAFEunload", RegexOptions.IgnoreCase);

    return s;
} 
```

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-10-12T17:04:36.637

## 永远不够——白名单，不要黑名单

例如，`javascript:`伪 URL 可能会被 HTML 实体混淆，您已经忘记了，并且在 IE 中`<embed>`存在危险的 CSS 属性，例如`behavior`和。`expression`

逃避过滤的方法有[无数种](http://ha.ckers.org/xss.html)，这种方法注定会失败。即使您今天发现并阻止了所有可能的漏洞利用，未来也可能会添加新的不安全元素和属性。

只有两种保护 HTML 的好方法：

*   `<`通过将 every替换为.将其转换为文本`&lt;`。
    如果您想允许用户输入格式化文本，您可以使用自己的标记（例如，像 SO 那样的降价）。

*   将 HTML 解析为 DOM，检查每个元素和属性并删除所有未列入白名单的内容。
    您还需要检查允许属性的内容，例如`href`（确保 URL 使用安全协议，阻止所有未知协议）。
    清理 DOM 后，从中生成新的有效 HTML。永远不要像处理文本一样处理 HTML，因为无效的标记、评论、实体等很容易欺骗您的过滤器。

还要确保您的页面声明其编码，因为存在利用浏览器自动检测错误编码的漏洞。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-12T16:40:19.493

你最好把所有都`<`变成`&lt;`和全部`>`变成`&gt;`，然后将可接受的标签转换回来。换句话说，白名单，不要黑名单。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-12T16:35:00.673

正如大卫所展示的那样，仅使用一些正则表达式来保护您并没有简单的方法，您总是可以忘记一些东西，例如 javascript: 在您的情况下。您最好在输出时转义 HTML 实体。有很多关于执行此操作的最佳方法的讨论，具体取决于您实际需要允许的内容，但可以**肯定的是您的功能还不够**。

[Jeff 在这里](http://www.codinghorror.com/blog/archives/001167.html)谈了一点。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-12T16:27:56.273

```
<a href="javascript:document.writeln('on' + 'unload' + ' and more malicious stuff here...');">example</a> 
```

每当您可以在文档中写入字符串时，都会打开一扇大门。

有无数地方可以将恶意内容注入 HTML/JavaScript。出于这个原因，Facebook 最初不允许在他们的应用程序平台中使用 JavaScript。他们的解决方案是稍后实现一个标记/脚本编译器，允许他们认真过滤掉坏东西。

如前所述，将一些标签和属性列入白名单，并去掉其他所有内容。不要将一些已知的恶意属性列入黑名单并允许其他所有内容。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-12T16:37:32.243

虽然我不能提供一个具体的例子来说明为什么不这样做，但我会继续直截了当地说不。这更多的是原则。正则表达式是一个了不起的工具，但它们只能用于某些问题。它们非常适合数据匹配和搜索。

然而，它们并不是一个很好的安全工具。弄乱正则表达式并使其仅部分正确太容易了。黑客可以在结构不佳甚至结构良好的正则表达式中找到很多回旋余地。我会尝试另一种方法来防止跨站点脚本。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-13T15:55:27.943

查看[http://ha.ckers.org/xss.html](http://ha.ckers.org/xss.html)上的 XSS 备忘单，这不是一个完整的列表，而是一个好的开始。

想到的一个是 <img src="http://badsite.com/javascriptfile" />

您还忘记了 onmouseover 和样式标签。

最简单的事情就是**实体转义**。如果向量一开始就无法正确渲染，那么不完整的黑名单就无关紧要了。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-09T23:32:14.777

作为通过此攻击的示例：

```
 <div style="color: expression('alert(4)')"> 
```

无耻插件：Caja 项目定义了 HTML 元素和属性的白名单，以便它可以控制 HTML 中的脚本如何以及何时执行。

[请参阅http://code.google.com/p/google-caja/](http://code.google.com/p/google-caja/)上的项目，白名单是[http://code.google.com/p/google-caja/source/browse/#svn](http://code.google.com/p/google-caja/source/browse/#svn/trunk/src/com/google/caja/lang/html) 中的 JSON 文件 [/trunk/src/com/google/caja/lang/html](http://code.google.com/p/google-caja/source/browse/#svn/trunk/src/com/google/caja/lang/html) 和 [http://code.google.com/p/google-caja/source/browse/#svn/trunk/src/com/google/caja/lang/ css](http://code.google.com/p/google-caja/source/browse/#svn/trunk/src/com/google/caja/lang/css)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2012-08-03T18:02:54.893

我仍然没有弄清楚为什么开发人员想要通过正则表达式替换将错误的输入转化为好的输入。除非您的网站是博客并且需要允许嵌入 html 或 javascript 或任何其他类型的代码，否则请拒绝错误输入并返回错误。俗话说垃圾进垃圾出，你为什么要吸收一大堆热气腾腾的便便，让它可以食用呢？

如果您的网站没有国际化，为什么要接受任何 unicode？

如果您的网站只做 POST，为什么要接受任何 URL 编码的值？

为什么接受任何十六进制？为什么接受 html 实体？什么用户输入' '或'"' ?

至于正则表达式，可以使用它们，但是，您不必为完整的攻击字符串编写单独的正则表达式。只需几个构造良好的正则表达式模式，您就可以拒绝许多不同的攻击签名：

```
patterns.put("xssAttack1", Pattern.compile("<script",Pattern.CASE_INSENSITIVE) );
patterns.put("xssAttack2", Pattern.compile("SRC=",Pattern.CASE_INSENSITIVE) );
patterns.put("xssAttack3", Pattern.compile("pt:al",Pattern.CASE_INSENSITIVE) );
patterns.put("xssAttack4", Pattern.compile("xss",Pattern.CASE_INSENSITIVE) );

<FRAMESET><FRAME SRC="javascript:alert('XSS');"></FRAMESET>
<DIV STYLE="width: expression(alert('XSS'));">
<LINK REL="stylesheet" HREF="javascript:alert('XSS');">
<IMG SRC="jav   ascript:alert('XSS');">    // hmtl allows embedded tabs...
<IMG SRC="jav&#x0A;ascript:alert('XSS');"> // hmtl allows embedded newline...
<IMG SRC="jav&#x0D;ascript:alert('XSS');"> // hmtl allows embedded carriage return... 
```

请注意，我的模式不是完整的攻击签名，仅足以检测该值是否是恶意的。用户不太可能输入 'SRC=' 或 'pt:al' 这允许我的正则表达式模式检测包含任何这些令牌的未知攻击。

许多开发人员会告诉您，您无法使用黑名单保护网站。由于攻击集是无限的，这基本上是正确的，但是，如果您使用基于令牌构建的黑名单解析整个请求（参数、参数值、标头、cookie），您将能够弄清楚什么是攻击什么是有效的。请记住，攻击者很可能会通过工具对您进行霰弹枪攻击。如果你已经适当地强化了你的服务器，他将不知道你正在运行什么环境，并且必须用漏洞列表来爆破你。如果他足够缠扰你，请将攻击者或他的 IP 放在隔离列表中。如果他有一个带有 50k 漏洞的工具可以攻击你的网站，如果每次违规将他的id或ip隔离30分钟，他需要多长时间？诚然，如果攻击者使用僵尸网络进行多路攻击，仍然存在风险。您的网站最终仍然是一个更难破解的金块。

现在已经检查了恶意内容的整个请求，您现在可以使用白名单类型检查对长度、引用/逻辑、命名来确定请求的有效性

不要忘记实施某种 CSRF 保护。也许是一个蜂蜜令牌，并检查先前请求中的用户代理字符串以查看它是否已更改。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-12T17:11:28.963

空白让你变得脆弱。[读这个](http://lookout.net/2008/08/26/advisory-attack-of-the-mongolian-space-evaders-and-other-medieval-xss-vectors/)。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-12T16:53:22.947

对白名单的另一次投票。但看起来你正在以错误的方式解决这个问题。*我*这样做的方式是将 HTML 解析为标签树。如果你正在解析的标签在白名单中，给它一个树节点，然后解析。它的属性也是如此。

丢弃的属性只是被丢弃。其他一切都是 HTML 转义的文字内容。

这条路线的好处是因为您有效地重新生成了所有标记，这都是完全有效的标记！（当人们留下评论并且他们搞砸了验证/设计时，我讨厌它。）

**关于“我不能列入白名单”（段落）**：黑名单是一种需要大量维护的方法。您必须密切关注新的漏洞并确保您的安全。是个*可怜*的存在。***只要做对一次，你就再也不需要碰它了。***

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-13T16:39:13.020

从不同的角度来看，当有人想要在他们提交的内容中添加“javascript”或“functionload”或“visionblurred”时会发生什么？由于多种原因，这可能在大多数地方发生……据我了解，这些将成为“javaSAFEscript”、“functionSAFEload”和“visionSAFEblurred”（！！）。

如果这可能适用于您，并且您坚持使用黑名单方法，请务必使用完全匹配的正则表达式以避免惹恼用户。换句话说，在安全性和可用性之间处于最佳状态，尽可能少地妥协。

# open-source - 有没有开源网站？

> ID：195651
> 
> 赞同：3
> 
> 时间：2008-10-12T16:20:35.413
> 
> 标签：open-source

听说桌面应用程序的代码已经开源了，请问有没有开源的网站呢？我想我没有听说过。如果没有，有什么原因吗？

这将具有不必等待 Web 开发团队包含新功能的优势。此外，这将确保更多的人看到代码，从而确保更少的错误数量。当然，黑客攻击很容易。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-12T16:27:22.000

粘贴箱：http : [//pastebin.com/](http://pastebin.com/)

Wikipedia et al 背后的 wiki：[http ://www.mediawiki.org/wiki/MediaWiki](http://www.mediawiki.org/wiki/MediaWiki)

GrailsCrowd：[http ://grailscrowd.com/](http://grailscrowd.com/)

Slashcode【斜线点引擎】：[http ://www.slashcode.com/](http://www.slashcode.com/)

没有那么多人这样做的原因是因为有人很容易在不进行任何有用更改的情况下设置您网站的完整克隆。好的，这对于真正的“开源”代码是严格允许的，但这并不完全符合事物的精神（IMO），如果该网站变得适度流行，将会有*很多*无用的克隆。该网站将变得基本上一文不值。

这些是开源的网站。有大量的 Web 应用程序软件是开源的 [其中一些很糟糕]

*   WordPress
*   墨水类型
*   Joomla
*   osCommerce
*   禅车
*   德鲁巴

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-12T16:28:42.170

在此处查看 reddit.com 的源代码：http: [//code.reddit.com/](http://code.reddit.com/)。我确实认为建立网站时会考虑利润，因为他们发布源代码将允许模仿网站并稀释他们的市场份额。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-12T16:28:56.177

[PHP.net](http://www.php.net/source.php?url=/index.php)是开源的。地狱，如果您愿意，您可以查看[他们网站的副本。](http://cvs.php.net/viewvc.cgi/phpweb/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-12T16:29:53.663

slashdot 的代码（斜线）不是开源的吗？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-12T17:14:41.700

Wikipedia/Mediawiki 在多个层面上都是开源的。MediaWiki（运行维基百科的软件）是开源的，接受投稿，维基百科的内容也是开源的，所有人都可以编辑。

还有已开源多年 的 LiveJournal ( [http://www.livejournal.com )。](http://www.livejournal.com)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-12T17:35:56.760

许多答案都解决了竞争方面的问题，但这实际上同样适用于所有 FOSS 项目，无论是否基于 Web。网站的显着特点是，总的来说，软件的用户无法访问任何形式的代码 - 源代码或二进制文件 - 因此典型的 FOSS 要求您将源代码提供给任何接收二进制文件的人变得几乎毫无意义。我认为这是将 FOSS 许可证与网站一起广泛使用的主要障碍。

（最近有人尝试开发专门解决这个问题的以网络为中心的 FOSS 许可证，但还没有真正流行起来。）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-12T16:54:16.283

phpbb.org django joomla dotnetnuke

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-12T17:07:14.773

SugarCRM OSCommerce DotNetNuke Mambo

有相当多的软件是开源的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-12T17:13:14.887

squeaksource.com 上所有基于海边的系统

# linux - 如何使用 gnu cp 命令将文件复制到多个目录

> ID：195655
> 
> 赞同：217
> 
> 时间：2008-10-12T16:21:56.363
> 
> 标签：linux, bash, shell

是否可以使用 cp 命令将单个文件复制到多个目录？

我尝试了以下，但没有奏效：

```
cp file1 /foo/ /bar/
cp file1 {/foo/,/bar} 
```

我知道可以使用 for 循环或查找。但是可以使用 gnu cp 命令吗？

* * *

## 回答 #1

> 赞同：596
> 
> 时间：2008-10-12T20:15:42.897

你不能单独做到这一点，`cp`但你可以`cp`结合`xargs`：

```
echo dir1 dir2 dir3 | xargs -n 1 cp file1 
```

将复制`file1`到`dir1`、`dir2`和`dir3`。 `xargs`将调用`cp`3 次来执行此操作，有关详细信息，请参阅手册页`xargs`。

* * *

## 回答 #2

> 赞同：111
> 
> 时间：2008-10-12T16:28:07.677

不，`cp`可以复制多个来源，但只能复制到一个目标。您需要安排`cp`多次调用 - 每个目的地一次 - 对于您想要做的事情；正如您所说，使用循环或其他工具。

* * *

## 回答 #3

> 赞同：79
> 
> 时间：2011-01-26T10:34:51.040

通配符也适用于罗伯茨代码

```
echo ./fs*/* | xargs -n 1 cp test 
```

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2012-01-30T21:46:14.070

我会使用`cat`并`tee`基于我在[https://superuser.com/questions/32630/parallel-file-copy-from-single-source-to-multiple-targets](https://superuser.com/questions/32630/parallel-file-copy-from-single-source-to-multiple-targets)上看到的答案，而不是`cp`.

例如：

```
cat inputfile | tee outfile1 outfile2 > /dev/null 
```

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2011-08-08T21:40:27.617

据我所知，您可以使用以下内容：

```
ls | xargs -n 1 cp -i file.dat 
```

command的`-i`选项意味着你会被询问是否用. 虽然它不是一个完全自动的解决方案，但它对我来说很有效。`cp``file.dat`

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2017-01-02T20:36:29.440

这些答案似乎都比显而易见的要复杂：

```
for i in /foo /bar; do cp "$file1" "$i"; done 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2014-01-31T09:55:47.817

`ls -db di*/subdir | xargs -n 1 cp File`

`-b`如果**目录名称中有空格，**否则它将被 xargs 破坏为不同的项目，回显版本有这个问题

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2016-06-21T15:26:55.293

不使用 cp 本身，但是...

在将大量 Gopro 素材从（慢速）SD 卡复制到三个（慢速）USB 驱动器的情况下，我想到了这一点。我只想读取一次数据，因为它需要很长时间。我希望它是递归的。

```
$ tar cf - src | tee >( cd dest1 ; tar xf - ) >( cd dest2 ; tar xf - ) | ( cd dest3 ; tar xf - ) 
```

（如果你想要更多的输出，你可以添加更多的 >() 部分。）

我没有对此进行基准测试，但它肯定比 cp-in-a-loop（或一堆并行 cp 调用）快得多。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2014-03-31T01:25:22.460

如果您想在没有分叉命令的情况下执行此操作：

`tee <inputfile file2 file3 file4 ... >/dev/null`

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2017-08-01T17:19:32.657

`xargs`要在 Mac OS 上使用通配符复制到目录，唯一对我有用的解决**方案**是：

```
find ./fs*/* -type d -print0 | xargs -0 -n 1 cp test 
```

`test`要复制的文件在哪里
以及`./fs*/*`要复制到的目录

问题是 xargs 将空格视为一个新参数，使用`-d`or更改分隔符的解决方案`-E`不幸在 Mac OS 上无法正常工作。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2014-06-01T22:10:13.573

基本上等同于 xargs 答案，但如果您想要并行执行：

```
parallel -q cp file1 ::: /foo/ /bar/ 
```

因此，例如，将 file1 复制到当前文件夹的所有子目录中（包括递归）：

```
parallel -q cp file1 ::: `find -mindepth 1 -type d` 
```

注意：这可能只为非常特定的用例传达任何明显的速度提升，例如，如果每个目标目录都是不同的磁盘。

它在功能上也类似于 xargs 的“-P”参数。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-09-03T17:46:32.490

另一种方法是使用 cat 和 tee 如下：

```
cat <source file> | tee <destination file 1> | tee <destination file 2> [...] > <last destination file> 
```

我认为这将是非常低效的，因为这项工作将被分成几个进程（每个目标一个），并且硬盘驱动器将同时在盘片的不同部分写入多个文件。但是，如果您想将文件写入几个不同的驱动器，这种方法可能会非常有效（因为所有副本都可能同时发生）。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-08-05T17:07:39.517

你不能。

我曾多次发现我可以使用此功能，因此我制作了自己的工具来为我执行此操作。

[http://github.com/ddavison/branch](http://github.com/ddavison/branch)

很简单——
`branch myfile dir1 dir2 dir3`

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-04-05T11:53:31.250

```
ls -d */ | xargs -iA cp file.txt A 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-03-21T22:18:46.943

假设您要复制`fileName.txt`到当前工作目录中的所有子目录。

1.  通过获取所有子目录名称`ls`并将它们保存到一些临时文件中，例如，`allFolders.txt`

    ```
    ls > allFolders.txt 
    ```

2.  打印列表并将其传递给 command `xargs`。

    ```
    cat allFolders.txt | xargs -n 1 cp fileName.txt 
    ```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-08-31T18:50:49.327

使用 bash 脚本

```
DESTINATIONPATH[0]="xxx/yyy"
DESTINATIONPATH[1]="aaa/bbb"
                ..
DESTINATIONPATH[5]="MainLine/USER"
NumberOfDestinations=6

for (( i=0; i<NumberOfDestinations; i++))
    do
        cp  SourcePath/fileName.ext ${DESTINATIONPATH[$i]}

    done
exit 
```

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2013-10-08T23:34:57.967

如果您想将多个文件夹复制到多个文件夹，可以执行以下操作：

回声 dir1 dir2 dir3 | xargs -n 1 cp -r /path/toyourdir/{subdir1,subdir2,subdir3}

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2019-06-27T12:42:39.507

如果您的所有目标目录都与路径表达式匹配——就像它们都是子目录一样`path/to`——那么只需与这样`find`的组合使用：`cp`

```
find ./path/to/* -type d -exec cp [file name] {} \; 
```

就是这样。

* * *

## 回答 #19

> 赞同：-2
> 
> 时间：2014-01-30T14:27:00.957

如果您需要明确将文件复制到哪些文件夹中，您可以将 find 与一个或多个 grep 结合使用。例如，要替换任何子文件夹中出现的 favicon.ico，您可以使用：

```
find . | grep favicon\.ico | xargs -n 1 cp -f /root/favicon.ico 
```

* * *

## 回答 #20

> 赞同：-3
> 
> 时间：2012-12-11T02:38:35.437

这将复制到直接子目录，如果您想更深入，请调整`-maxdepth`参数。

```
find . -mindepth 1 -maxdepth 1 -type d| xargs -n 1 cp -i index.html 
```

如果您不想复制到所有目录，希望您可以过滤您不感兴趣的目录。示例复制到以开头的所有文件夹`a`

```
find . -mindepth 1 -maxdepth 1 -type d| grep \/a |xargs -n 1 cp -i index.html 
```

如果复制到任意/不相交的目录集，您将需要 Robert Gamble 的建议。

* * *

## 回答 #21

> 赞同：-3
> 
> 时间：2014-11-08T03:11:55.653

我喜欢将文件复制到多个目录中： `cp file1 /foo/; cp file1 /bar/; cp file1 /foo2/; cp file1 /bar2/` 并将目录复制到其他目录中： `cp -r dir1/ /foo/; cp -r dir1/ /bar/; cp -r dir1/ /foo2/; cp -r dir1/ /bar2/`

我知道这就像发出几个命令，但是当我想输入 1 行并走开一会儿时，它对我来说效果很好。

* * *

## 回答 #22

> 赞同：-4
> 
> 时间：2013-05-08T21:36:23.470

例如，如果您位于目标文件夹的父目录中，您可以执行以下操作：

对于 i in $(ls); 做 cp 源文件 $i; 完毕

# compatibility - 我可以使用 oracle berkeley db java edition 的 c 实现（python bsddb）创建的 bdb（berkeley db）文件吗？

> ID：195657
> 
> 赞同：4
> 
> 时间：2008-10-12T16:23:31.163
> 
> 标签：compatibility, berkeley-db, language-interoperability

我有一个由 C 实现（python bsddb 模块）创建的 berkeley db 文件（*.bdb）。是否可以通过 Berkeley Db 的纯 Java 实现来读取此文件？我尝试使用 berkeley db java edition (je) 阅读它，但不能。je 抛出一个异常，说它无法检测到 berkeley 数据库。berkeley db 文件是否不能跨不同的实现互操作？如果是这样，为什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-12T17:27:25.827

不。

根据[Berkeley DB Java 版常见问题解答](http://www.oracle.com/technetwork/database/berkeleydb/je-faq-096044.html#CanaBerkeleyDBdatabasebeusedbyBerkeleyDBJavaEdition)，Berkeley DB 和 Berkeley DB Java 版彼此不兼容，因为它们具有不同的文件布局结构。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-03-08T14:58:50.297

请注意，共有三种不同的产品

1.  Berkeley DB——C 实现
2.  伯克利数据库 Java 版
3.  伯克利数据库 XML

见，[维基百科](http://en.wikipedia.org/wiki/Berkeley_DB#Editions)

确实，“Berkeley DB”和“Berkeley DB Java 版”具有不同的（即不兼容的）文件格式。但是，“Berkeley DB”产品确实通过 JNI 提供了 Java API。因此，可以从 Java 访问由 C 实现编写的数据文件，但不能使用“Berkeley DB Java 版”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-12T17:08:35.630

我没有研究过明确的答案，但我有同样的经历。Java API 根本检测不到使用 pythons bdb 创建的数据库，也可以使用 cli utils 访问该数据库。反过来也是如此。

# javascript - 如何防止 iframe 加载事件？

> ID：195667
> 
> 赞同：0
> 
> 时间：2008-10-12T16:31:32.037
> 
> 标签：javascript, iframe

我的 aspx 页面上有一个 iframe 和几个表格。现在，当页面加载时，这些表是隐藏的。iframe 用于将文件上传到数据库。根据事件的结果，我必须在我的主页上显示一个特定的表格（这些表格基本上有“重试”，“下一步”按钮......取决于文件是否上传，我必须显示相应的按钮） .

现在我在 iframe 的“onload”事件上有一个 JavaScript，我将这些表隐藏在其中。当控件在事件发生后返回时，我会显示一个特定的表格。但随后 iframe 再次加载并且表格被隐藏。任何人都可以帮我解决这个问题。我不希望 iframe 第二次加载。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-17T19:06:44.373

嗯，你说你在 aspx 页面上，我想 iframe 会回发，所以为此它重新加载页面。如果您无法避免回发，则必须在回发之前在主页上设置一个标志，并在加载时检查...

...就像是：

```
mainpage.waitTillPostBack =  true
YourFunctionCausingPostBack();

..

onload=function(){
if(!mainpage.waitTillPostBack){
hideTables();
}
mainpage.waitTillPostBack = false;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-12T16:40:04.173

我不确定你的问题是什么，但也许你的方法应该有点不同。尝试将代码放入 iframe 中，这将调用父级的函数。这些函数将显示正确的表格：

```
<!-- in the main page --->
function showTable1() {}

<!-- in the iframe -->
window.onload = function () {
    parent.showTable1();
} 
```

这将使您的 iframe 远离主页面进行大量控制。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-12T16:41:45.573

我没有从您的问题中获得足够的细节来确定是否可以防止 iframe 的第二次加载。但我建议使用 javascript 变量来检查 iframe 是否被第二次加载，在这种情况下跳过隐藏表格的逻辑，

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-12T17:00:36.457

这是我的代码

function initUpload() { //alert("IFrame 加载"); _divFrame = document.getElementById('divFrame'); _divUploadMessage = document.getElementById('divUploadMessage'); _divUploadProgress = document.getElementById('divUploadProgress'); _ifrFile = document.getElementById('ifrFile'); _tbRetry = document.getElementById('tbRetry'); _tbNext=document.getElementById('tblNext');

```
 _tbRetry.style.display='none';
         _tbNext.style.display='none';

        var btnUpload = _ifrFile.contentWindow.document.getElementById('btnUpload');

        btnUpload.onclick = function(event)
        {
            var myFile = _ifrFile.contentWindow.document.getElementById('myFile');

            //Baisic validation
            _divUploadMessage.style.display = 'none';

            if (myFile.value.length == 0)
            {
                _divUploadMessage.innerHTML = '<span style=\"color:#ff0000\">Please select a file.</span>';
                _divUploadMessage.style.display = '';
                myFile.focus();
                return;
            }

            var regExp = /^(([a-zA-Z]:)|(\\{2}\w+)\$?)(\\(\w[\w].*))(.doc|.txt|.xls|.docx |.xlsx)$/;

            if (!regExp.test(myFile.value)) //Somehow the expression does not work in Opera
            {
                _divUploadMessage.innerHTML = '<span style=\"color:#ff0000\">Invalid file type. Only supports doc, txt, xls.</span>';
                _divUploadMessage.style.display = '';
                myFile.focus();
                return;
            }

            _ifrFile.contentWindow.document.getElementById('Upload').submit();
            _divFrame.style.display = 'none';

        }
    } 
```

函数 UploadComplete(message, isError) { alert(message); //警报(isError);

```
 clearUploadProgress();

        if (_UploadProgressTimer)
        {
            clearTimeout(_UploadProgressTimer);
        }

        _divUploadProgress.style.display = 'none';
        _divUploadMessage.style.display = 'none';
        _divFrame.style.display = 'none';
        _tbNext.style.display='';

        if (message.length)
        {
            var color = (isError) ?  '#008000' : '#ff0000';

            _divUploadMessage.innerHTML = '<span style=\"color:' + color + '\;font-weight:bold">' + message + '</span>';
            _divUploadMessage.style.display = '';
            _tbNext.style.display='';
             _tbRetry.style.display='none';

        }
    } 
```

tblRetry 和 tblNext 是我想根据事件结果显示的表。

# c++ - 你如何在 C++ 中模拟使用 RAII 的类

> ID：195682
> 
> 赞同：9
> 
> 时间：2008-10-12T16:47:18.463
> 
> 标签：c++, unit-testing, mocking

这是我的问题，我想模拟一个在初始化时创建线程并在销毁时关闭它的类。我的模拟类没有理由实际创建和关闭线程。但是，为了模拟一个类，我继承了它。当我创建模拟类的新实例时，会调用基类构造函数，从而创建线程。当我的模拟对象被销毁时，基类析构函数被调用，试图关闭线程。

如何在不必处理实际资源的情况下模拟 RAII 类？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-12T17:34:37.543

相反，您创建了一个描述类型的接口，并让真实类和模拟类都继承自该接口。所以如果你有：

```
class RAIIClass {
 public:
  RAIIClass(Foo* f);
  ~RAIIClass();
  bool DoOperation();

 private:
  ...
}; 
```

你会做一个像这样的界面：

```
class MockableInterface {
 public:
  MockableInterface(Foo* f);
  virtual ~MockableInterface();
  virtual bool DoOperation() = 0;
}; 
```

然后从那里走。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-12T17:35:55.370

首先，您的类可能为它们的使用而设计得很好，但为测试而设计得不好，这不一定是不合理的事情。并非一切都容易测试。

大概您想使用另一个函数或类来使用您要模拟的类（否则解决方案是微不足道的）。让我们称前者为“用户”，后者为“Mocked”。以下是一些可能性：

1.  更改 User 以使用 Mocked 的抽象版本（您可以选择使用哪种抽象：继承、回调、模板等......）。
2.  为您的测试代码编译不同版本的 Mocked（例如，在编译测试时 #def out the RAII code）。
3.  让 Mocked 接受构造函数标志以关闭其行为。我个人会避免这样做。
4.  只是吸收分配资源的成本。
5.  跳过测试。

如果您不能修改 User 或 Mocked，最后两个可能是您唯一的办法。如果您可以修改 User 并且您认为设计可测试的代码很重要，那么您应该在其他任何选项之前探索第一个选项。请注意，在使代码通用/灵活和保持简单之间可以进行权衡，这两者都是令人钦佩的品质。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-13T02:50:01.650

pimpl 成语可能也适合你。创建您的 Thread 类，并在其下方引入具体实现。如果您输入正确的#defines 和#ifdefs，您的实现可能会在您启用单元测试时发生变化，这意味着您可以根据您要完成的任务在真实实现和模拟实现之间切换。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-12T21:22:07.707

我使用的一种技术是使用某种形式的装饰器。您的最终代码有一个方法，该方法在堆栈上创建其实例，然后调用相同的方法，但在一个成员上，该成员是指向您的基类的指针。当该调用返回时，您的方法返回销毁您创建的实例。

在测试时，您交换一个不创建任何线程的模拟，而只是转发到您要测试的方法。

```
class Base{
 protected:
  Base* decorated;
 public:
  virtual void method(void)=0;
};
class Final: public Base{
  void method(void) { Thread athread; decorated->method(); } // I expect Final to do something with athread
};
class TestBase: public Base{
  void method(void) { decorated->method(); }
}; 
```

# php - require_once 可以与符号链接一起使用吗？

> ID：195684
> 
> 赞同：4
> 
> 时间：2008-10-12T16:49:29.333
> 
> 标签：php, linux, lamp

在 CentOS LAMP 机器上，尝试让 require_once 在 PHP5 中的脚本中工作。如果要包含的文件不在符号链接目录中，它可以正常工作，但如果要包含的文件位于通过符号链接找到的目录中，则无法找到它。

这是 require_once 和符号链接的限制吗？

编辑 - 感谢您的输入，所有。我认为阅读这些内容后很可能是权限问题

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-12T17:26:35.127

据我所知， require_once 可以很好地使用符号链接。我在 WordPress MU 安装中使用 include_once 和一些符号链接，它工作得很好——我无法想象为什么 require_once 在这方面的功能与 include_once 不同。

你有没有机会设置[open_basedir](http://php.net/manual/en/ini.core.php#ini.open-basedir)限制？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-12T18:12:26.030

Can't you do something like the following?

```
 if (is_link($path))
   {
      $path = readlink($path);
   }
   require_once($path); 

```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T17:25:14.427

据我所知没有。权限是否与您不使用符号链接时相同？

# c - 将 char 字符串转换为其基础数据类型

> ID：195688
> 
> 赞同：2
> 
> 时间：2008-10-12T16:54:06.547
> 
> 标签：c, types

我有一个字符串（char*），我需要找到它的底层数据类型，例如 int、float、double、short、long，或者只是一个包含带或不带数字的字母的字符数组（如 SQL 中的 varchar）。例如：

```
 char* str1 = "12312"
    char* str2 = "231.342"
    char* str3 = "234234243234"
    char* str4 = "4323434.2432342"
    char* str5 = "i contain only alphabets" 
```

**给定这些字符串，我需要找到第一个字符串的类型为 int 并将其类型转换为 int，依此类推**：

```
int no1 = atoi(str1)
float no2 = atof(str2)
long no3 = atol(str3)
double no4 = strtod(str4)
char* varchar1 = strdup(str5) 
```

* * *

再澄清一点...

我有一个字符串，它的内容可以是字母和/或数字和/或特殊字符。现在，我能够解析字符串和

1.  确定它是否仅包含数字，
    在这里我根据最佳拟合将字符串转换为 short 或 int 或 long。（**我怎么知道字符串是否可以转换为短整数或长整数？**）
2.  只有字母，将其保留为字符串。
3.  带一个小数点的数字。
    在这里我需要将字符串转换为浮点数或双精度数（**这里有同样的问题**）
4.  其他。将其保留为字符串

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-12T17:25:11.743

首先，检查问题是否尚未为您解决。可能是您用于将字符串转换为数字的库函数已经完成了您需要的检查。

如果做不到这一点，您将需要对字符串进行一些模式匹配，这就是正则表达式的用途！

例如，如果字符串与正则表达式匹配：

`[+-]?\d+`

然后你就知道它是一个 int 还是一个 long。将其转换为 long，然后检查其大小。如果您的 long 可以适合 int，请将其转换为 int。

您可以对浮点数和双精度数执行相同的操作，尽管正则表达式有点复杂。

注意一些尴尬的情况，比如空字符串、一个小数点、数字太大而不能长，等等。您还需要决定是否允许使用指数表示法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T17:53:01.077

尝试使用 sscanf 将其变为 long。如果失败，请尝试使用 sscanf 将其变为双精度。如果失败，它是一个字符串。您可以使用 %n 转换来判断是否所有输入都已成功使用。`<limits.h>`和中的常量`<float.h>`可以帮助您确定数字结果是否适合您平台上更窄的类型。如果这不是家庭作业，那么您的目标类型可能是外部定义的——例如通过数据库模式——而后一个注释是无关紧要的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T18:46:05.683

在 C（不是 C++）中，我将使用 strtod/strol 和 <limits.h> 和 <float.h> 中的最大值的组合：

```
#include <stdlib.h>
#include <stdio.h>
#include <limits.h>
#include <float.h>

/*    Now, we know the following values:
      INT_MAX, INT_MIN, SHRT_MAX, SHRT_MIN, CHAR_MAX, CHAR_MIN, etc.    */

typedef union tagMyUnion
{
   char TChar_ ; short TShort_ ; long TLong_ ; double TDouble_ ;
} MyUnion ;

typedef enum tagMyEnum
{
   TChar, TShort, TLong, TDouble, TNaN
} MyEnum ;

void whatIsTheValue(const char * string_, MyEnum * enum_, MyUnion * union_)
{
   char * endptr ;
   long lValue ;
   double dValue ;

   *enum_ = TNaN ;

   /* integer value */
   lValue = strtol(string_, &endptr, 10) ;

   if(*endptr == 0) /* It is an integer value ! */
   {
      if((lValue >= CHAR_MIN) && (lValue <= CHAR_MAX)) /* is it a char ? */
      {
         *enum_ = TChar ;
         union_->TChar_ = (char) lValue ;
      }
      else if((lValue >= SHRT_MIN) && (lValue <= SHRT_MAX)) /* is it a short ? */
      {
         *enum_ = TShort ;
         union_->TShort_ = (short) lValue ;
      }
      else if((lValue >= LONG_MIN) && (lValue <= LONG_MAX)) /* is it a long ? */
      {
         *enum_ = TLong ;
         union_->TLong_ = (long) lValue ;
      }

      return ;
   }

   /* real value */
   dValue = strtod(string_, &endptr) ;

   if(*endptr == 0) /* It is an real value ! */
   {
      if((dValue >= -DBL_MAX) && (dValue <= DBL_MAX)) /* is it a double ? */
      {
         *enum_ = TDouble ;
         union_->TDouble_ = (double) dValue ;
      }

      return ;
   }

   return ;
}

void studyValue(const char * string_)
{
   MyEnum enum_ ;
   MyUnion union_ ;

   whatIsTheValue(string_, &enum_, &union_) ;

   switch(enum_)
   {
      case TChar    : printf("It is a char : %li\n", (long) union_.TChar_) ; break ;
      case TShort   : printf("It is a short : %li\n", (long) union_.TShort_) ; break ;
      case TLong    : printf("It is a long : %li\n", (long) union_.TLong_) ; break ;
      case TDouble  : printf("It is a double : %f\n", (double) union_.TDouble_) ; break ;
      case TNaN     : printf("It is a not a number : %s\n", string_) ; break ;
      default       : printf("I really don't know : %s\n", string_) ; break ;
   }
}

int main(int argc, char **argv)
{
   studyValue("25") ;
   studyValue("-25") ;
   studyValue("30000") ;
   studyValue("-30000") ;
   studyValue("300000") ;
   studyValue("-300000") ;
   studyValue("25.5") ;
   studyValue("-25.5") ;
   studyValue("25555555.55555555") ;
   studyValue("-25555555.55555555") ;
   studyValue("Hello World") ;
   studyValue("555-55-55") ;

   return 0;
} 
```

结果如下：

```
[25] is a char : 25
[-25] is a char : -25
[30000] is a short : 30000
[-30000] is a short : -30000
[300000] is a long : 300000
[-300000] is a long : -300000
[25.5] is a double : 25.500000
[-25.5] is a double : -25.500000
[25555555.55555555] is a double : 25555555.555556
[-25555555.55555555] is a double : -25555555.555556
[Hello World] is a not a number
[555-55-55] is a not a number 
```

对不起我生锈的C。

:-)

因此，实质上，您在调用 whatIsTheValue 之后，通过 MyEnum 枚举检索类型，然后根据此枚举中的值，从联合 MyUnion 检索正确的值，正确键入。

请注意，查找数字是双精度数还是浮点数有点复杂，因为差异似乎在于精度，即您的数字可以用双精度数还是浮点数表示。大多数“十进制实数”数字不能完全表示为双精度数，我不会打扰。

还要注意，有一个问题，因为 25.0 既可以是实数，也可以是整数。我比较“dValue == (double)(long)dValue”，我想你应该知道是否是一个整数，再一次，没有考虑到计算机使用的二进制实数通常会出现的精度问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-12T18:10:31.743

首先，您应该决定要识别哪些表示。例如，0xBAC0 是用十六进制表示的无符号短整数吗？010（八进制）和 1E-2（0,01）也是如此。

一旦决定了表示，就可以使用正则表达式来确定一般形式。例如：

*   **`-?\d*.\d*([eE]?[+-]?\d*.\d*)?`**是一个浮点数（几乎，它接受奇怪的东西，比如`.e-.`你应该定义最适合你的正则表达式）
*   **`-?\d+`**是一个整数
*   **`0x[0-9A-Fa-f]+`**是一个十六进制常数

等等。如果您不使用正则表达式库，则必须从头开始为这些表示编写一个小型解析器。

现在您可以将其转换为可能的最大类型（例如`long long`对于整数，对于浮点指针使用双精度），然后使用其中的值`limits.h`来查看该值是否适合较小的类型。

例如，如果整数小于`SHRT_MAX`你可以假设它是一个`short`.

您可能还必须做出任意决定，例如 54321 只能是 an`unsigned short`但 12345 可能是 a`signed short`或 an `unsigned short`。

# c++ - 为什么 waveOutWrite() 会在调试堆中导致异常？

> ID：195696
> 
> 赞同：13
> 
> 时间：2008-10-12T16:59:55.240
> 
> 标签：c++, windows, audio, waveoutwrite

在研究这个问题时，我在网上发现了多次提到以下场景，总是在编程论坛上作为未回答的问题。我希望在这里发布这个至少可以用来记录我的发现。

首先，症状：在运行使用 waveOutWrite() 输出 PCM 音频的标准代码时，有时在调试器下运行时会出现以下情况：

```
 ntdll.dll!_DbgBreakPoint@0()   
 ntdll.dll!_RtlpBreakPointHeap@4()  + 0x28 bytes    
 ntdll.dll!_RtlpValidateHeapEntry@12()  + 0x113 bytes   
 ntdll.dll!_RtlDebugGetUserInfoHeap@20()  + 0x96 bytes  
 ntdll.dll!_RtlGetUserInfoHeap@20()  + 0x32743 bytes    
 kernel32.dll!_GlobalHandle@4()  + 0x3a bytes   
 wdmaud.drv!_waveCompleteHeader@4()  + 0x40 bytes   
 wdmaud.drv!_waveThread@4()  + 0x9c bytes   
 kernel32.dll!_BaseThreadStart@8()  + 0x37 bytes 
```

虽然明显的怀疑是代码中其他地方的堆损坏，但我发现情况并非如此。此外，我能够使用以下代码重现此问题（这是基于对话框的 MFC 应用程序的一部分：）

```
void CwaveoutDlg::OnBnClickedButton1()
{
    WAVEFORMATEX wfx;
    wfx.nSamplesPerSec = 44100; /* sample rate */
    wfx.wBitsPerSample = 16; /* sample size */
    wfx.nChannels = 2;
    wfx.cbSize = 0; /* size of _extra_ info */
    wfx.wFormatTag = WAVE_FORMAT_PCM;
    wfx.nBlockAlign = (wfx.wBitsPerSample >> 3) * wfx.nChannels;
    wfx.nAvgBytesPerSec = wfx.nBlockAlign * wfx.nSamplesPerSec;

    waveOutOpen(&hWaveOut, 
                WAVE_MAPPER, 
                &wfx,  
                (DWORD_PTR)m_hWnd, 
                0,
                CALLBACK_WINDOW );

    ZeroMemory(&header, sizeof(header));
    header.dwBufferLength = 4608;
    header.lpData = (LPSTR)GlobalLock(GlobalAlloc(GMEM_MOVEABLE | GMEM_SHARE | GMEM_ZEROINIT, 4608));

    waveOutPrepareHeader(hWaveOut, &header, sizeof(header));
    waveOutWrite(hWaveOut, &header, sizeof(header));
}

afx_msg LRESULT CwaveoutDlg::OnWOMDone(WPARAM wParam, LPARAM lParam)
{
    HWAVEOUT dev = (HWAVEOUT)wParam;
    WAVEHDR *hdr = (WAVEHDR*)lParam;
    waveOutUnprepareHeader(dev, hdr, sizeof(WAVEHDR));
    GlobalFree(GlobalHandle(hdr->lpData));
    ZeroMemory(hdr, sizeof(*hdr));
    hdr->dwBufferLength = 4608;
    hdr->lpData = (LPSTR)GlobalLock(GlobalAlloc(GMEM_MOVEABLE | GMEM_SHARE | GMEM_ZEROINIT, 4608));
    waveOutPrepareHeader(hWaveOut, &header, sizeof(WAVEHDR));
    waveOutWrite(hWaveOut, hdr, sizeof(WAVEHDR));
    return 0;
 } 
```

在任何人对此发表评论之前，是的 - 示例代码播放未初始化的内存。不要在扬声器完全打开的情况下尝试此操作。

一些调试揭示了以下信息： waveOutPrepareHeader() 用一个指针填充 header.reserved，该指针指向一个似乎包含至少两个指针作为其前两个成员的结构。第一个指针设置为 NULL。调用 waveOutWrite() 后，该指针被设置为分配在全局堆上的指针。在伪代码中，它看起来像这样：

```
struct Undocumented { void *p1, *p2; } /* This might have more members */

MMRESULT waveOutPrepareHeader( handle, LPWAVEHDR hdr, ...) {
    hdr->reserved = (Undocumented*)calloc(sizeof(Undocumented));
    /* Do more stuff... */
}

MMRESULT waveOutWrite( handle, LPWAVEHDR hdr, ...) {

    /* The following assignment fails rarely, causing the problem: */
    hdr->reserved->p1 = malloc( /* chunk of private data */ );
    /* Probably more code to initiate playback */
} 
```

通常，标头由 wdmaud.dll 的内部函数 waveCompleteHeader() 返回给应用程序。waveCompleteHeader() 尝试通过调用 GlobalHandle()/GlobalUnlock() 和朋友来释放由 waveOutWrite() 分配的指针。有时，GlobalHandle() 会爆炸，如上所示。

现在，GlobalHandle() 炸弹的原因并不是因为堆损坏，正如我一开始所怀疑的那样 - 这是因为 waveOutWrite() 在没有将内部结构中的第一个指针设置为有效指针的情况下返回。我怀疑它在返回之前释放了该指针指向的内存，但我还没有反汇编它。

这似乎仅在波形播放系统缓冲区不足时发生，这就是为什么我使用单个标头来重现它的原因。

在这一点上，我有一个很好的理由反对这是我的应用程序中的一个错误——毕竟，我的应用程序甚至没有运行。有没有人见过这个？

我在 Windows XP SP2 上看到了这个。声卡来自SigmaTel，驱动版本为5.10.0.4995。

笔记：

为了防止将来出现混淆，我想指出，问题在于使用 malloc()/free() 来管理正在播放的缓冲区的答案是完全错误的。您会注意到我更改了上面的代码以反映建议，以防止更多人犯同样的错误——这没有什么区别。waveCompleteHeader() 释放的缓冲区不是包含 PCM 数据的缓冲区，释放 PCM 缓冲区的责任在于应用程序，并且不要求以任何特定方式分配它。

此外，我确保我使用的所有 waveOut API 调用都不会失败。

我目前假设这要么是 Windows 中的错误，要么是音频驱动程序中的错误。反对意见总是受欢迎的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-05T02:37:38.107

> 现在，GlobalHandle() 炸弹的原因并不是因为堆损坏，正如我一开始所怀疑的那样 - 这是因为 waveOutWrite() 在没有将内部结构中的第一个指针设置为有效指针的情况下返回。我怀疑它在返回之前释放了该指针指向的内存，但我还没有反汇编它。

我可以在我的系统上使用您的代码重现这一点。我看到了类似于 Johannes 报道的情况。在调用 WaveOutWrite 之后，hdr->reserved 通常保存一个指向已分配内存的指针（其中似乎包含 unicode 中的 wave out 设备名称等）。

但偶尔，从 WaveOutWrite() 返回后，指向的字节`hdr->reserved`被设置为 0。这通常是该指针的最低有效字节。中的其余字节`hdr->reserved`都可以，并且它通常指向的内存块仍被分配且未损坏。

它可能正在被另一个线程破坏——我可以在调用 WaveOutWrite() 后立即使用条件断点捕获更改。并且系统调试断点发生在另一个线程中，而不是消息处理程序中。

但是，如果我使用回调函数而不是 Windows 消息泵，则无法导致系统调试断点发生。（`fdwOpen = CALLBACK_FUNCTION`在 WaveOutOpen() 中）当我这样做时，我的 OnWOMDone 处理程序由不同的线程调用 - 可能是另一个负责损坏的线程。

所以我认为在 Windows 或驱动程序中存在一个错误，但我认为您可以通过使用回调函数而不是 Windows 消息泵来处理 WOM_DONE 来解决。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-31T15:06:29.067

您并不孤单： http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID= [100589](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=100589)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T15:28:35.820

我看到了同样的问题，并自己做了一些分析：

waveOutWrite() 分配（即 GlobalAlloc）一个指向 354 字节堆区域的指针，并将其正确存储在 header.reserved 指向的数据区域中。

但是当这个堆区域再次被释放时（根据你的分析，在 waveCompleteHeader() 中；我自己没有 wdmaud.drv 的符号），指针的最低有效字节已设置为零，因此无效指针（虽然堆还没有损坏）。换句话说，发生的事情是这样的：

*   (BYTE *) (header.reserved) = 0

所以我有一点不同意你的说法：waveOutWrite() 首先存储一个有效的指针；指针只会在稍后从另一个线程中损坏。可能是同一线程 (mxdmessage) 稍后尝试释放此堆区域，但我还没有找到存储零字节的点。

这种情况并不经常发生，并且之前已经成功分配和释放了相同的堆区域（相同的地址）。我非常确信这是系统代码中某处的错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-14T01:56:04.800

不确定这个特殊问题，但您是否考虑过使用更高级别的跨平台音频库？Windows 音频编程有很多怪癖，这些库可以为您省去很多麻烦。

示例包括[PortAudio](http://portaudio.com)、[RtAudio](http://www.music.mcgill.ca/~gary/rtaudio/)和[SDL](http://www.libsdl.org/)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-17T14:48:49.450

我要做的第一件事是检查 waveOutX 函数的返回值。如果其中任何一个失败了——考虑到你描述的场景，这并不是不合理的——并且你继续进行，那么事情开始出错也就不足为奇了。我的猜测是 waveOutWrite 在某个时候返回 MMSYSERR_NOMEM。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-30T16:32:26.663

使用应用程序验证器来找出发生了什么，如果你做了一些可疑的事情，它会更早地发现它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-31T15:45:19.627

[查看Wine 的源代码](http://winehq.org/download/#source)可能会有所帮助，尽管 Wine 可能已经修复了任何错误，而且 Wine 也可能存在其他错误。相关文件是 dlls/winmm/winmm.c、dlls/winmm/lolvldrv.c，可能还有其他文件。祝你好运！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-08-20T02:47:25.853

不允许从回调中调用 winmm 函数这一事实又如何呢？MSDN 没有提到关于窗口消息的这种限制，但是窗口消息的使用类似于回调函数。可能在内部，它被实现为来自驱动程序的回调函数，并且该回调执行 SendMessage。在内部，waveout 必须维护使用 waveOutWrite 编写的标题的链接列表；所以，我猜是：

```
hdr->reserved = (Undocumented*)calloc(sizeof(Undocumented)); 
```

设置链表的上一个/下一个指针或类似的东西。如果您编写更多缓冲区，那么如果您检查指针并且如果它们中的任何一个指向另一个，那么我的猜测很可能是正确的。

网络上的多个来源提到您不需要重复地取消准备/准备相同的标题。如果您在原始示例中注释掉 Prepare/unprepare 标头，那么它似乎可以正常工作，没有任何问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-03-18T10:42:33.813

我通过轮询声音播放和延迟解决了这个问题：

```
WAVEHDR header = { buffer, sizeof(buffer), 0, 0, 0, 0, 0, 0 };
waveOutPrepareHeader(hWaveOut, &header, sizeof(WAVEHDR));
waveOutWrite(hWaveOut, &header, sizeof(WAVEHDR));
/*
* wait a while for the block to play then start trying
* to unprepare the header. this will fail until the block has
* played.
*/
while (waveOutUnprepareHeader(hWaveOut,&header,sizeof(WAVEHDR)) == WAVERR_STILLPLAYING) 
Sleep(100);
waveOutClose(hWaveOut); 
```

[在 Windows 中使用 waveOut 接口播放音频](https://www.planet-source-code.com/vb/scripts/ShowCode.asp?txtCodeId=4422&lngWId=3)

# f# - 如何在 F# 中使用 LINQ to XML 提取特定标签？

> ID：195697
> 
> 赞同：7
> 
> 时间：2008-10-12T17:00:19.967
> 
> 标签：f#, linq-to-xml

我有一个 XML 文件，我在 F# 中打开它，如下所示：

```
let Bookmarks(xmlFile:string) = 
    let xml = XDocument.Load(xmlFile) 
```

获得 XDocument 后，我​​需要使用 LINQ to XML 对其进行导航并提取所有特定标签。我的部分解决方案是：

```
let xname (tag:string) = XName.Get(tag)
let tagUrl (tag:XElement) = let attribute = tag.Attribute(xname "href")
                            attribute.Value
let Bookmarks(xmlFile:string) = 
    let xml = XDocument.Load(xmlFile)
    xml.Elements <| xname "A" |> Seq.map(tagUrl) 
```

如何从 XML 文件中提取特定标签？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-12T19:12:23.057

```
#light
open System
open System.Xml.Linq

let xname s = XName.Get(s)
let bookmarks (xmlFile : string) = 
    let xd = XDocument.Load xmlFile
    xd.Descendants <| xname "bookmark" 
```

这将找到“书签”的所有后代元素。如果您只想要直接后代，请使用 Elements 方法 (xd.Root.Elements <| xname "whatever")。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-12T19:03:30.937

警告：我以前从未做过 linq-to-xml，但是查看有关该主题的其他帖子，这个片段有一些 F# 代码可以编译并执行*某些*操作，因此它可以帮助您入门：

```
open System.IO
open System.Xml
open System.Xml.Linq 

let xmlStr = @"<?xml version='1.0' encoding='UTF-8'?>
<doc>
    <blah>Blah</blah>
    <a href='urn:foo' />
    <yadda>
        <blah>Blah</blah>
        <a href='urn:bar' />
    </yadda>
</doc>"

let xns = XNamespace.op_Implicit ""
let a = xns + "a"
let reader = new StringReader(xmlStr)
let xdoc = XDocument.Load(reader)
let aElements = [for x in xdoc.Root.Elements() do
                 if x.Name = a then
                     yield x]
let href = xns + "href"
aElements |> List.iter (fun e -> printfn "%A" (e.Attribute(href))) 
```

# scripting - 创建“Europanto”类型通用脚本语言的障碍是什么？

> ID：195709
> 
> 赞同：6
> 
> 时间：2008-10-12T17:08:14.133
> 
> 标签：scripting, language-design

本周在几种脚本语言之间来回切换后，我发现自己在想它们有多相似。然而，我一直在寻求谷歌（或现在的 SO）来记住诸如“instanceof”和“endswith”的本地等价物是什么，或者声明接口的正确语法等细节。

这让我想起了（人类）语言[Europonto](http://en.wikipedia.org/wiki/Europanto)。只需选择一些模糊的英语语法和一些模糊的浪漫/日耳曼语/斯拉夫语词汇，一切都很好！

那么如果我们尝试用脚本语言做同样的事情会发生什么。今天想要 Python 风格的缩进块吗？美好的！想使用原型对象吗？好的！只记得某些库函数的 PHP 名称怎么拼写？没问题！

无论如何，这是疯狂而疯狂的想法。既然我们需要一个承认具体答案的问题，让我们像这样收紧它：

在创建允许 [Python、Ruby、PHP、Perl、shell 和 JavaScript] 的所有本机语法和库函数的脚本语言时，最重要的冲突是什么，这样您就可以在语言之间自由混合代码块和函数名称?

假设任何特定的结构都应该在语句级别保持一致。所以我们允许：

```
foreach( $foo as $bar )
{
   if $foo == 2:
      print "hi"
} 
```

但不是，说，

```
foreach( $foo as $bar )
{
   if $foo == 2:
      print "hi"
   endif
end 
```

冲突可能包括：解析器歧义；名称冲突；对象或函数或闭包的语义冲突；等等。我猜这个范围将是一个巨大的问题，但你告诉我。

我将从一开始就将其作为“社区 wiki”开始，因此，如果您认为这是一个有趣的问题，但又想让它更加严谨，请随时进行编辑。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-12T17:12:09.117

我建议主要问题是识别每个语句的语法应该是什么。

无论如何，重点是什么？几乎所有的脚本语言都具有执行相同功能的功能，这就是为什么人们倾向于掌握一种他们一贯使用的语言并坚持使用它的原因。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T18:54:34.120

The main difficulty would to be to allow people maintain it. With a well defined language you can only `print` a certain way and do `sys.argv` a certain way. once you allow multiple syntaxes there is no sane way to search for all the `sys.argv` in the code base you have.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T21:20:39.200

在**语法**级别上，我能看到的唯一问题是检测哪个块具有哪种语法，然后将它们分开并用特定的解析器解析它们。当然，给定非常小的陈述，关于它是哪种语言可能存在歧义，您可能会争辩说这并不重要，但可能是这种情况，在不同的语言中，相同的字符串会做不同的事情，所以这*可能*成为一个微妙的问题。

在**API**级别上，您将有许多不同的方法来做同样的事情，但方式或子集略有不同。因此，例如，您可能无法`string.startsWith()`在 PHP 中执行 Java，因此您会做一些不同的事情，或者无法执行 PHP `strstr()`（从找到的针头到末尾返回字符串的一部分）并且您会实现一些东西对此有所不同，甚至对问题有不同的看法。然后你必须拥有*所有*这些不同的 API 方法来做同样的事情，这将是一个巨大的 API 来实现、支持和（上帝保佑）学习。

在**湿件**级别，除非您了解大量语言及其细微差别，否则其他人编写的代码将完全不可读。我认为从最小的细节学习单一的编程语言已经足够困难了，因此创造这种科学怪人的野兽根本不切实际。我可以想到一个例外，它被用作一种算法描述语言，它已经在世界各地的大学中使用，教师采用他喜欢的某种语言，并使代码对人类来说尽可能易读，而无需实现一个解析器。

作为旁注，我认为这种系统可以通过*以某种方式利用.NET的CLR来***实现**，在其中你有大量不同的语言，每种语言都编译为相同的字节码并访问相同的变量和东西。*您需要做*的就是将代码拆分为不同语言的集群，然后在各自的编译器上分别编译它们，然后合并字节码，并*以某种方式*确保它们在提及相同名称时都指向相同的变量和函数不同的语言。

 **** * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-12T17:21:19.147

我已经开始看到语法只是语言的一个属性。他们中的大多数在我看来都像 C。语言的目的（面向对象、强类型等）又是另外一回事。它开始看起来语法不是最重要的方面。

我去阅读了维基百科条目......

> Europanto 是一个语言笑话，呈现为一种带有大杂烩词汇的“建构语言”

“大杂烩”听起来就像 Perl 向我描述的那样！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-12T17:36:16.977

我[在 Ruby 中找到了关于闭包的相当详细的讨论](http://innig.net/software/ruby/closures-in-ruby.rb)。听起来让 Ruby 的行为与 JavaScript 或 Python 共存需要某种丑陋的消歧。

如果有人将 Perl 添加到要涵盖的语言列表中，我认为它的词法范围规则会带来一个相关的问题吗？

# c++ - 设计：大型存档文件编辑器，文件映射

> ID：195714
> 
> 赞同：2
> 
> 时间：2008-10-12T17:11:56.573
> 
> 标签：c++, visual-studio, winapi, file-io

我正在用本机和托管 C++ 为 4GB+ 的大型*存档文件*（见下文）编写一个编辑器。

为了访问文件，我像任何理智的人一样使用*文件映射（见下文）。*这对于读取数据非常有用，但是在实际编辑存档时会出现问题。文件映射不允许在访问文件时调整文件大小，所以我不知道当用户想要在文件中插入新数据时我应该如何进行（这将超过文件的原始大小，当它被映射时。）

我应该每次都重新映射整个事情吗？那肯定会很慢。但是，我希望通过独占文件访问来保持编辑器的实时性，因为这大大简化了编程，并且不会让文件在被修改时被其他应用程序搞砸。我不想在编辑器上花费永恒的时间；它只是我正在从事的实际项目的一个简单的开发工具。

所以我想听听你们是如何处理类似情况的，还有哪些其他存档软件，尤其是其他游戏可以解决这个问题？

澄清：

*   这不是文本文件，我正在编写特定的二进制*存档文件格式*。我的意思是在目录中包含许多其他文件的大文件。出于多种原因，自定义存档文件在游戏使用中非常常见。对于我的格式，我的目标是与[Valve Software 的 GCF 格式](http://www.wunderboy.org/docs/gcfformat.php)类似（但更简单）的结构- 我本来会使用 GCF 格式，但不幸的是，尽管有很多很棒的实现，但该格式没有编辑器用于阅读它们，例如[HLLib](http://nemesis.thewavelength.net/index.php?p=35)。

*   访问文件必须快速，因为它旨在存储游戏资源。所以它不是数据库。数据库文件将包含在其中，以及 GFX、SFX 等文件。

*   这里所说的“文件映射”是 Windows 平台上的一种特定技术，它允许通过创建部分文件的“视图”来直接访问大文件，请参见此处：http: [//msdn.microsoft.com/en-us /library/aa366556(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa366556(VS.85).aspx) - 这种技术允许最小的延迟和内存使用，并且是访问任何大文件的明智之举。所以这并不*意味着*将整个 4GB 文件读入内存，恰恰相反。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-12T17:38:17.147

“编辑软件”是什么意思？如果这是一个文本文件，在编写自己的之前，您是否尝试过现有的生产质量编辑器？如果是存储二进制数据的文件，您是否考虑过使用 RDBMS 并使用 SQL 语句操作其内容？

如果您绝对必须从头开始编写此内容，我不确定映射是否正确。映射一个巨大的文件会给你机器的VM系统带来很大的压力，除非整个文件有很多编辑操作，否则它的效率可能会落后于简单的读/写方案。更糟糕的是，正如您所说，您在扩展文件时遇到问题。

相反，维护文件数据的缓冲区窗口，用户可以修改这些数据。当用户决定保存文件时，依次遍历文件和已编辑的缓冲区以创建新的文件图像。如果您有磁盘空间，则更容易写入新文件（尤其是在缓冲区大小发生变化的情况下），否则在用新内容覆盖之前，您需要巧妙地预读现有数据。

或者，您可以记录编辑操作。当用户决定保存文件时，对日志进行拓扑排序并在现有文件上播放以创建新文件。

对于独占文件访问，请使用操作系统的文件锁定或实施应用程序级锁定（如果只有您的编辑器会接触这些文件）。依赖 mmap 的独占访问限制了您的实现选择。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-12T17:46:35.240

映射文件是为了实际访问数据而创建的，但我认为您需要另一个表示文件结构的抽象。有多种方法可以做到这一点，但考虑将文件表示为“范围”序列。

从文件开始是一个单一的范围，相当于整个映射。如果用户随后开始编辑文件，您将在编辑点将单个范围一分为二，并插入一个包含用户已插入数据的新范围。修改和删除也会通过创建或修改这些范围来修改您的文件视图。

也许您可以检查其中一个开源编辑器的源代码——有很多可供选择，但找到一个足够简单的将是一个挑战。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T18:12:01.400

这个问题没有简单的答案——我找了很长时间，但徒劳无功。您必须修改文件的大小，然后重新映射它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T23:03:37.427

我所做的是关闭视图句柄和 FileMapping 句柄，设置文件大小然后重新打开映射/视图句柄。

```
// Open memory mapped file    
HANDLE FileHandle = ::CreateFileW(file_name, GENERIC_READ | GENERIC_WRITE, 0, NULL, OPEN_EXISTING, 0, NULL);
size_t Size = ::GetFileSize(FileHandle, 0);
HANDLE MappingHandle = ::CreateFileMapping(FileHandle, NULL, PAGE_READWRITE, 0, Size, NULL);
void* ViewHandle = ::MapViewOfFile(MappingHandle, FILE_MAP_ALL_ACCESS, 0, 0, Size);

...

// increase size of file
UnmapViewOfFile(ViewHandle);
CloseHandle(MappingHandle);

Size += 1024;

LARGE_INTEGER offset;
offset.QuadPart = Size;

LARGE_INTEGER newpos;
SetFilePointerEx(FileHandle, offset, &newpos, FILE_BEGIN);
SetEndOfFile(FileHandle);

MappingHandle = ::CreateFileMapping(FileHandle, NULL, PAGE_READWRITE, 0, Size, NULL);
ViewHandle = ::MapViewOfFile(MappingHandle, FILE_MAP_ALL_ACCESS, 0, 0, Size); 
```

上面的代码没有错误检查并且不处理 64 位大小，但这并不难修复。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-31T13:03:32.027

映射对远程系统上的文件有一个基本问题。

在过去美好的 DOS 时代，有一个很好的编辑器，叫做 Norton Editor（ne.com .. 这是文件名，不是网站）。它可以加载任何大小的文件（我们说的是 640kb RAM 和 20 GB 硬盘，如果有的话）。

它过去只加载部分文件，巧妙地管理文件长搜索和按需加载

恕我直言，应该使用这种方法。

如果适当地隐藏在文件读写层下，它可能会非常透明。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-20T15:44:02.850

我会在构建时从片段构建大文件。您让您的编辑器在通常的文件系统中处理普通的平面文件（适当时带有子目录等）。然后，您有一个编译步骤，将所有这些部分收集到您的*存档*文件格式中。

# security - 如何在不擦除操作系统的情况下在 Mac OS X 系统上获得 root 访问权限？

> ID：195717
> 
> 赞同：3
> 
> 时间：2008-10-12T17:13:53.653
> 
> 标签：security, macos, root

我父亲最近去世了，我继承了他的 Mac。我很想把它用在我自己的生活中，但我不想把它的大脑擦掉，这样我就可以重新配置它以在我的网络中使用等等。他的旧文件对我来说在历史上很重要——我相信你可以理解我保留它们的愿望。

我可以登录，因为在他通过之前我在机器上有一个帐户，但仅此而已。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-12T17:18:05.970

诚挚的哀悼。

试试这个：[Mac OS X - 重置忘记的帐户密码](http://kb.wisc.edu/helpdesk/page.php?id=3853)

该链接显示了从 Mac OS X 安装 DVD 启动并使用其重置密码功能重置管理员帐户密码的演练。

这里有更多信息：[Mac OS X：更改或重置帐户密码](http://support.apple.com/kb/HT1274)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-25T21:10:04.753

如果您不想对 mac 进行任何更改，一个名为[Target Disk Mode](http://support.apple.com/kb/HT1661)的鲜为人知的功能可能会使其变得更容易。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-12T17:18:58.540

如果您的帐户是管理员帐户。您可以打开 Terminal.app 并输入

```
sudo passwd root 
```

系统将提示您输入新的 root 密码。

如果您没有管理员权限，您可以使用 osx 安装光盘重置 root 密码。说明在[这里](http://www.askdavetaylor.com/how_do_i_reset_my_mac_os_x_admin_root_password.html)。

编辑：[Node](https://stackoverflow.com/users/7190/node)的[链接](http://kb.wisc.edu/helpdesk/page.php?id=3853)更好。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-12T17:24:01.590

如果没有设置打开固件密码，可以尝试在开机时按apple-s进入单用户模式。然后你应该能够做任何你想做的事情，因为你将成为 root。

请参阅[此苹果支持文档](http://support.apple.com/kb/HT1492)。

我建议使用此功能使您的普通用户帐户可以读取您父亲的所有文件，然后备份他的所有文件并重新安装。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-25T21:01:58.187

使用 BSD 或 Linux CD 启动计算机并挂载文件系统。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-08-26T18:29:11.347

如果机器运行 leopard 或更高版本，您实际上可以通过简单地删除一个文件来强制任何 mac 创建一个新的管理员帐户。

*   只需启动进入单用户模式，（启动时按住`command`+ ）`s`

*   进入单用户模式后，使用`mount -uw /`

*   然后输入`rm /var/db/.AppleSetupDone`

*   重新启动机器。

    这是通过删除检查来实现的，`.AppleSetupDone`因此它会欺骗 Mac 在启动时重播设置助手。

* * *

**否则**，您可以通过再次启动进入单用户模式来执行与旧 Mac 非常相似的操作，除了这次输入以下内容（逐行）

```
mount -uw /
cd /private/var/db/netinfo
mv local.nidb local.old
rm ../.AppleSetupDone
exit 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-01-21T05:08:56.780

FWIW

假设您的帐户具有管理员权限，请启动机器并输入您的密码；然后使用 Finder 导航到他的用户文件夹（/Users/ *name-he-used-on-the-mac*）；他的子文件夹会有一个小的红色锁定符号。

您可以在查找器中复制/粘贴它们（系统将提示您输入密码），或者

您可以打开终端并同上它们：

```
 sudo ditto <his files> <directory where you want the copies> 
```

届时将提示*您*输入密码。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-12T17:17:37.950

如果您可以访问有问题的文件，那么首先要做的就是备份它们......

# ruby-on-rails - 你如何在 Rails 中处理相对时间？

> ID：195740
> 
> 赞同：222
> 
> 时间：2008-10-12T17:29:56.040
> 
> 标签：ruby-on-rails, ruby

我正在编写一个 Rails 应用程序，但似乎找不到如何计算相对时间，即如果给定某个 Time 类，它可以计算“30 秒前”或“2 天前”或者如果它超过一个月“2008 年 9 月 1 日”等

* * *

## 回答 #1

> 赞同：374
> 
> 时间：2008-10-12T19:18:38.207

听起来您正在寻找来自 ActiveSupport 的[`time_ago_in_words`](http://apidock.com/rails/ActionView/Helpers/DateHelper/time_ago_in_words)方法（或[`distance_of_time_in_words`](http://apidock.com/rails/ActionView/Helpers/DateHelper/distance_of_time_in_words)）。像这样称呼它：

```
<%= time_ago_in_words(timestamp) %> 
```

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2008-10-12T19:29:42.710

我已经写了这个，但是必须检查提到的现有方法，看看它们是否更好。

```
module PrettyDate
  def to_pretty
    a = (Time.now-self).to_i

    case a
      when 0 then 'just now'
      when 1 then 'a second ago'
      when 2..59 then a.to_s+' seconds ago' 
      when 60..119 then 'a minute ago' #120 = 2 minutes
      when 120..3540 then (a/60).to_i.to_s+' minutes ago'
      when 3541..7100 then 'an hour ago' # 3600 = 1 hour
      when 7101..82800 then ((a+99)/3600).to_i.to_s+' hours ago' 
      when 82801..172000 then 'a day ago' # 86400 = 1 day
      when 172001..518400 then ((a+800)/(60*60*24)).to_i.to_s+' days ago'
      when 518400..1036800 then 'a week ago'
      else ((a+180000)/(60*60*24*7)).to_i.to_s+' weeks ago'
    end
  end
end

Time.send :include, PrettyDate 
```

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2013-09-14T05:28:05.523

只是为了澄清 Andrew Marshall 使用**time_ago_in_words**
的解决方案（对于 Rails 3.0 和 Rails 4.0）

如果你在视野中

```
<%= time_ago_in_words(Date.today - 1) %> 
```

如果您在控制器中

```
include ActionView::Helpers::DateHelper
def index
  @sexy_date = time_ago_in_words(Date.today - 1)
end 
```

默认情况下，控制器没有导入模块[**ActionView::Helpers::DateHelper**](http://api.rubyonrails.org/classes/ActionView/Helpers/DateHelper.html)。

注意将助手导入控制器不是“轨道方式”。助手用于帮助视图。time_ago_in_words方法被决定为**MVC**三元组**中的****视图**实体。（我不同意，但在罗马时......）

 *** * *

## 回答 #4

> 赞同：20
> 
> 时间：2008-10-12T18:50:28.530

What about

```
30.seconds.ago
2.days.ago 
```

Or something else you were shooting for?

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-10-12T17:31:45.380

您可以使用算术运算符来计算相对时间。

```
Time.now - 2.days 
```

2天前给你。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2008-10-12T18:09:35.570

Something like this would work.

```
def relative_time(start_time)
  diff_seconds = Time.now - start_time
  case diff_seconds
    when 0 .. 59
      puts "#{diff_seconds} seconds ago"
    when 60 .. (3600-1)
      puts "#{diff_seconds/60} minutes ago"
    when 3600 .. (3600*24-1)
      puts "#{diff_seconds/3600} hours ago"
    when (3600*24) .. (3600*24*30) 
      puts "#{diff_seconds/(3600*24)} days ago"
    else
      puts start_time.strftime("%m/%d/%Y")
  end
end 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2014-02-01T07:35:55.717

由于这里的大多数答案建议**time_ago_in_words**。

而不是使用：

```
<%= time_ago_in_words(comment.created_at) %> 
```

在 Rails 中，更喜欢：

```
<abbr class="timeago" title="<%= comment.created_at.getutc.iso8601 %>">
  <%= comment.created_at.to_s %>
</abbr> 
```

连同一个 jQuery 库[http://timeago.yarp.com/](http://timeago.yarp.com/)，代码：

```
$("abbr.timeago").timeago(); 
```

主要优势：缓存

[http://rails-bestpractices.com/posts/2012/02/10/not-use-time_ago_in_words/](http://rails-bestpractices.com/posts/2012/02/10/not-use-time_ago_in_words/)

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2013-04-24T01:47:35.693

看看这里的实例方法：

[http://apidock.com/rails/Time](http://apidock.com/rails/Time)

这有一些有用的方法，例如昨天、明天、开始的一周、前等。

例子：

```
Time.now.yesterday
Time.now.ago(2.days).end_of_day
Time.now.next_month.beginning_of_month 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2018-02-22T15:50:27.010

如果你正在构建一个 Rails 应用程序，你应该使用

```
Time.zone.now
Time.zone.today
Time.zone.yesterday 
```

这会在您配置 Rails 应用程序的时区中为您提供时间或日期。

例如，如果您将应用程序配置为使用 UTC，`Time.zone.now`则将始终采用 UTC 时间（例如，它不会受到英国夏令时变化的影响）。

计算相对时间很容易，例如

```
Time.zone.now - 10.minute
Time.zone.today.days_ago(5) 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-07-16T02:47:47.420

我已经为 Rails ActiveRecord 对象编写了一个 gem。该示例使用 created_at，但它也适用于 updated_at 或具有 ActiveSupport::TimeWithZone 类的任何内容。

只需 gem install 并在您的 TimeWithZone 实例上调用“漂亮”方法。

[https://github.com/brettshollenberger/hublot](https://github.com/brettshollenberger/hublot)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-10-23T15:22:34.520

另一种方法是从后端卸载一些逻辑并让浏览器通过使用 Javascript 插件来完成这项工作，例如：

[jQuery time ago](https://github.com/rmm5t/jquery-timeago)或它的[Rails Gem 改编](https://github.com/jgraichen/rails-timeago)

# linux - linux上的共享库问题

> ID：195741
> 
> 赞同：4
> 
> 时间：2008-10-12T17:30:09.860
> 
> 标签：linux, gcc, shared-libraries

我正在尝试在 linux 系统上编译/链接一个**非常**旧的软件，但由于某种原因，我无法与安装在我的系统上的共享库链接。

我从链接器收到以下错误：

```
/usr/bin/ld: cannot find -lXaw 
```

但是，lib 本身已安装。如果我跑

```
ldconfig -v | grep libXaw 
```

我得到（除其他外）这个打击：

```
libXaw.so.7 -> libXaw7.so.7.0.0 
```

该库及其链接位于 /usr/lib 顺便说一句。所以没什么特别的。

所以图书馆就在那里，ldconfig 找到了它。什么会导致 ld 在链接时找不到库？正如您可能已经猜到的那样，我对共享库的东西很陌生。

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-12T17:40:53.677

从字面上看，链接器可能正在寻找“libXaw.so”。是在 /usr/lib 中吗？如果没有，您可以尝试将其添加为 libXaw7.so.7.0.0 中的另一个软链接。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-11T15:56:39.993

顺便说一句，符号链接的原因是在多个版本的情况下选择要链接的默认版本，请记住库的名称已集成到二进制文件中。（你可以用 ldd 看到）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-12T18:28:31.553

-L 库目录是否被覆盖，而不是在 /usr/lib 中查找？

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-12T17:54:44.397

要链接它，您需要 .a 文件，而不是 .so 文件，它是运行时库。共享对象仅对已经链接到库的非共享部分的程序有用。这通常分布在“.a”文件中。

# c# - 我无法通过 Internet 连接到我的服务器

> ID：195742
> 
> 赞同：1
> 
> 时间：2008-10-12T17:30:53.633
> 
> 标签：c#, networking, sockets

我可以在本地计算机上运行服务器并在同一台计算机上连接到它，但是当我尝试通过 Internet 从另一台计算机连接到它时，我的服务器上没有活动迹象，也没有来自服务器的响应在我正在测试它的计算机上。我试过 XP 和 Vista，关闭防火墙，打开端口，以管理员身份运行；没有任何工作。:(

**这是我用来接受传入连接的代码：**

```
 int port = 3326;
Socket socket = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
            try
            {
                TcpListener listener = new TcpListener(new IPEndPoint(IPAddress.Any, port));
                listener.Start();
                Console.WriteLine("Server established\nListening on Port: {0}\n", port);
                while (true)
                {
                    socket = listener.AcceptSocket();
                    socket.SetSocketOption(SocketOptionLevel.Socket, SocketOptionName.SendTimeout, outime);
                    socket.SetSocketOption(SocketOptionLevel.Socket, SocketOptionName.KeepAlive, true);
                    socket.DontFragment = true;
                    NewConnection pxy = new NewConnection(socket);
                    Thread client = new Thread(new ThreadStart(pxy.Start));
                    client.IsBackground = true;
                    client.Start();
                }
}
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-12T17:35:28.507

我认为问题出在您的路由器上，而不是您的计算机上。当数据包来自 Internet 时，它应该被路由到特定的服务器。您必须配置路由器以将端口上的流量重定向`3326`到您的服务器。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-12T17:57:41.803

你可能有东西阻塞了更高的连接。尝试从 LAN 上的另一台主机连接。如果你能做到这一点，那么操作系统本身就不会为连接设置防火墙。

如果您或您的 ISP 运行 NAT 路由器，那么您的计算机可能没有可公开访问的地址，在这种情况下，无法直接连接到它。

如果没有 NAT 路由器，某些东西可能仍会阻止上游连接。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-12T18:35:09.357

**我是认真的：**许多 ISP 积极*阻止*您将家庭连接用作 Web 服务器。您可能想在投入太多时间之前给他们打电话。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-12T17:33:17.233

如果您尝试在家中托管，您的 ISP 可能会限制您。

# visual-studio-2008 - 在 VS2008 上的单元测试运行期间复制的隐藏文件夹

> ID：195744
> 
> 赞同：0
> 
> 时间：2008-10-12T17:32:06.330
> 
> 标签：visual-studio-2008, unit-testing

我发现在运行 VS2008 单元测试时，隐藏的 .svn 颠覆文件夹被复制到单元测试创​​建的 Out 文件夹下。这是因为我在单元测试中将 Resources 文件夹标记为“要部署的其他文件和文件夹”。有人知道您是否可以将文件夹（在本例中为 .svn 文件夹）标记为排除项？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T09:18:29.110

You only can include single files or whole folders. The problem is that the deployment takes time. The less files are copied, the faster start you tests.

Alternatively you can run your tests in the solutions out folder, by disabling "deployment". But I wouldn't do it. Or you can try to copy it yourself, for instance in a method marked with [AssemblyInitialize]. You get a TestContext, which has the property TestDeploymentDir. If you don't really have to optimize it, don't do it.

# php - 使用 PHP DOM 删除 XML 元素的问题

> ID：195764
> 
> 赞同：2
> 
> 时间：2008-10-12T17:42:13.737
> 
> 标签：php, xml, dom

这是我正在处理的 XML 文件：

```
<list>
    <activity>swimming</activity>
    <activity>running</activity>
    <activity>soccer</activity>
</list> 
```

index.php，显示带有复选框的活动列表的页面，删除选中活动的按钮和添加新活动的字段：

```
<html>
<head></head>
<body>
<?php
    $xmldoc = new DOMDocument();
    $xmldoc->load('sample.xml', LIBXML_NOBLANKS);

    $count = 0;

    $activities = $xmldoc->firstChild->firstChild;
    //prints the list of activities, with checkboxes on the left for each item
    //the $count variable is the id to each entry
    if($activities!=null){
        echo '<form name=\'erase\' action=\'delete.php\' method=\'post\'>' . "\n";
        while($activities!=null){
            $count++;
            echo "    <input type=\"checkbox\" name=\"activity[]\" value=\"$count\"/>";
            echo ' '.$activities->textContent.'<br/>'."\n";
            $activities = $activities->nextSibling;
        }
        echo '    <input type=\'submit\' value=\'erase selected\'>';
        echo '</form>';
    }
?>
//section used for inserting new entries. this feature is working as expected.
<form name='input' action='insert.php' method='post'>
    insert activity:
    <input type='text name='activity'/>
    <input type='submit' value='send'/>
    <br/>
</form>
</body>
</html> 
```

delete.php，它没有按预期工作：

```
<?php
    $xmldoc = new DOMDocument();
    $xmldoc->load('sample.xml', LIBXML_NOBLANKS);

    $atvID = $_POST['activity'];

    foreach($atvID as $id){
        $delnode = $xmldoc->getElementsByTagName('activity');
        $xmldoc->firstChild->removeChild($delnode->item($id));
    }

    $xmldoc->save('sample.xml');
?> 
```

我已经使用硬编码的任意 id 测试了没有循环的删除例程，并且它有效。我还测试了 $atvID 数组，它正确打印了选定的 ID 号。当它在循环内时，它输出的错误如下：

> 可捕获的致命错误：传递给 DOMNode::removeChild() 的参数 1 必须是 DOMNode 的实例，在第 9 行的 /directorypath/delete.php 中给出了 null

我的代码有什么问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-12T17:52:54.527

DOMNodeList 项从 0 开始索引；您需要在输出步骤中将 $count++ 移动到 while 循环的末尾。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-13T20:39:52.300

除了将 $count++ 移到 while 循环的末尾之外，最好让 delete.php 检查以确保 $_POST['activity'] 是数字并在指定范围内，以确保有您的页面上没有生成致命错误消息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-15T01:23:14.537

DOMNodeLists 的棘手之处在于它们不是数组。如果删除节点，列表将重新索引。如果用户选择多个要删除的项目，这将导致您的代码中断。如果您选择了游泳和跑步，游泳和足球将被删除。

您可能希望首先为每个活动提供一个可以搜索的唯一标识符，例如一个名为“id”的属性（这可能不是真正的 ID。DOM 的 getElementByID() 仅适用于具有 DTD 的 XML，例如一个 HTML 页面。我猜你不想去那里。）

您可能会将您的 XML 更新为如下所示。

```
<list>
    <activity name="swimming">swimming</activity>
    <activity name="running">running</activity>
    <activity name="soccer">soccer</activity>
</list> 
```

您将使用这些名称属性而不是 $count 作为复选框内的值。

然后，您可以使用 xPath 在 foreach 中查找要删除的项目。

```
$xpath = new DOMXPath($xmldoc);
$xmldoc->firstChild->removeChild($xpath->query("/list/activity[@name='$id']")->item(0)); 
```

希望这有助于您入门。

# javascript - 寻找 JavaScript 月份选择器

> ID：195768
> 
> 赞同：49
> 
> 时间：2008-10-12T17:46:47.580
> 
> 标签：javascript, jquery

我正在寻找一个 JavaScript 月份选择工具。我已经在网站上使用 jQuery，所以如果它是一个 jQuery 插件，那会很合适。我也愿意接受其他选择。

基本上，我追求的是[jQuery UI Date Picker](http://docs.jquery.com/UI/Datepicker)的简化版本。我不关心月份中的哪一天，只关心月份和年份。使用日期选择器控件感觉像是矫枉过正和杂耍。我知道我可以只使用一对选择框，但感觉很混乱，然后我还需要一个确认按钮。

我正在设想一个由两行六列或三行四列组成的网格，用于月份选择，以及顶部的当前和未来年份。（也许能够列出几年？我看不出有人需要提前一两年以上，所以如果我能列出当前和未来两年，那就太好了。）

它实际上只是 DatePicker 的简化版本。这样的事情存在吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2010-07-27T21:37:48.227

来自[这个等效问题的](https://stackoverflow.com/questions/2208480/jquery-date-picker-to-show-month-year-only)[Ben Koehler](https://stackoverflow.com/users/11996/ben-koehler)提供了一个运行良好的 jquery ui hack。为方便起见，此处引用，所有功劳都是他的。

[此解决方案的 JSFiddle](http://jsfiddle.net/yLjDH/)

-- 这是一个 hack（用整个 .html 文件更新）：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.1/jquery.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/jquery-ui.min.js"></script>
    <link rel="stylesheet" type="text/css" media="screen" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.2/themes/base/jquery-ui.css">
<script type="text/javascript">
$(function() {
    $('.date-picker').datepicker( {
        changeMonth: true,
        changeYear: true,
        showButtonPanel: true,
        dateFormat: 'MM yy',
        onClose: function(dateText, inst) { 
            var month = $("#ui-datepicker-div .ui-datepicker-month :selected").val();
            var year = $("#ui-datepicker-div .ui-datepicker-year :selected").val();
            $(this).datepicker('setDate', new Date(year, month, 1));
        }
    });
});
</script>
<style>
.ui-datepicker-calendar {
    display: none;
    }
</style>
</head>
<body>
    <label for="startDate">Date :</label>
    <input name="startDate" id="startDate" class="date-picker" />
</body>
</html> 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2013-10-15T19:04:12.910

对于*仍然*期待这一点的任何人（就像我一样），这里有一个漂亮、易于使用、兼容 jQuery UI、有据可查、经过测试的替代方案：

![月份选择器示例](https://i.stack.imgur.com/o8h3F.gif)

它的默认用法很简单，如下所示：

```
$("input[type='month']").MonthPicker(); 
```

*   [GitHub](https://github.com/KidSysco/jquery-ui-month-picker)
*   [摆弄示例和测试](http://jsfiddle.net/kidsysco/JeZap/)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2012-11-12T05:06:52.730

[在lucianocosta.info](https://github.com/lucianocosta/jquery.mtz.monthpicker)上找到一个。它看起来很不错：

![月份选择器在行动](https://i.stack.imgur.com/WOmmC.png)

2016 年 2 月 13 日更新：有效的链接

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-12T21:03:26.093

不久前我在一个程序中使用了[这个脚本。](http://www.mattkruse.com/javascript/calendarpopup/)虽然它很古老，但它适用于所有浏览器。如果您看不起“月份选择日历”，我相信这就是您正在寻找的。那里的示例在新窗口（ew）中打开了日历，但 1 设置（如第二个示例）使其显示 ala jQuery。祝你好运。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-09-16T16:03:59.940

随意看看我自己的 jQuery 插件：

[![月份选择器屏幕截图](https://i.stack.imgur.com/6FSWA.png)](https://i.stack.imgur.com/6FSWA.png)

便于使用 ：

```
$("#myTextInput").Monthpicker(); 
```

目前还没有很多选项，但您可以将输入绑定到一个受限制的月份范围。

还有一些事件提供了一种编码两个月选择器（开始和结束日期）之间相互依赖关系的方法

你可以在这里找到一个现场演示：[Codepen](http://codepen.io/VincentCharpentier/full/WQrozB)

您可以自由地从 Github 获取源代码并随意更改：[Github 存储库](https://github.com/VincentCharpentier/Simple-MonthPicker)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-12T21:23:05.163

前几天我刚选了一个日期选择器。我发现了另外两个有趣的例子，它们*可能会对*你有所帮助，但我不确定在不显示日历的情况下你将如何做到这一点。大多数“日期选择器”只是假设您要查看日历。您最好寻找一个自定义下拉列表，其中包含一些您可以配置的自定义按钮。

以下是我看过的：

[http://www.kelvinluck.com/assets/jquery/datePicker/v2/demo/index.html](http://www.kelvinluck.com/assets/jquery/datePicker/v2/demo/index.html)

我最终使用了这个：http: [//jqueryui.com/demos/datepicker/](http://jqueryui.com/demos/datepicker/)

如果您对 JQuery 有任何好处，那么您可能会想出一个不错的小项目。

# python - 熟悉 SQLAlchemy 的最简单方法/最佳教程是什么？

> ID：195771
> 
> 赞同：3
> 
> 时间：2008-10-12T17:49:09.230
> 
> 标签：python, sqlalchemy

开始使用 SQLAlchemy 的最佳资源/教程是什么？也许是一些简单的一步一步的东西，比如创建一个简单的表格并使用它并从那里开始。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-12T18:00:02.593

就个人而言，我会买[这本书](http://oreilly.com/catalog/9780596516147/)并在一周左右的时间里把它塞进脑袋里。

我已经尝试在工作中处理 SQLAlchemy 而没有先了解细节。我遇到了困难，因为我发现在线文档稀疏而神秘（“*阅读源代码以获取更多信息......* ”）。SA 还提供了几个抽象级别，您可以在这些抽象级别上工作，我不相信我曾经在正确的级别上工作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-12T21:00:05.163

可能是[SQLAlchemy ORM 教程](http://www.sqlalchemy.org/docs/04/ormtutorial.html "SQLAlchemy ORM 教程")？我从它开始。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-06T06:32:56.957

[使用 SQLAlchemy](http://www.ibm.com/developerworks/aix/library/au-sqlalchemy/) (IBM developerWorks)

# c - 如何在 C 中初始化一个相当复杂的 char 数组？

> ID：195794
> 
> 赞同：0
> 
> 时间：2008-10-12T18:10:01.713
> 
> 标签：c, arrays, visual-c++, initialization

假设 Visual C/C++ 6，我有一个包含 22399 个元素的复杂数据结构，如下所示：

```
{
{ "(SAME", "AS", "U+4E18)", "HILLOCK", "OR", "MOUND"},
{ "TO", "LICK;", {1, 1, 0}, "TASTE,", "A", "MAT,", "BAMBOO", "BARK"},
{ "(J)", "NON-STANDARD", "FORM", "OF", "U+559C", ",", {1, 1, 0}, "LIKE,", "LOVE,", "ENJOY;", {1, 1, 4}, "JOYFUL", "THING"},
{ "(AN", "ANCIENT", {1, 2, 2}, {1, 2, 3}, "U+4E94)", "FIVE"}, 
...
} 
```

声明这一点的最佳方式是什么？我试过像

```
char * abbrevs3[22399][] = { ... }; 
```

和

```
char * abbrevs3[22399][][] = { ... }; 
```

但编译抱怨一些慢性的东西。

**编辑**：数据是某些 Unihan 字符描述的数据库。我一直在探索各种压缩数据的方法。就目前而言，您有 22399 个条目，每个条目可能包含不同数量的字符串，或 { abbrev marker, line where last seen, element of that line where last seen } 的三元组。

顺便说一下 Greg 的说法，我可能需要让每一行包含相同数量的元素，即使其中一些是空字符串。是这样吗？

**编辑#2**：我突然想到三元组中的一些数值超出了 char 的限制。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-12T18:33:34.367

我会考虑以 XML 或其他结构化形式存储数据，然后读取和解析它，而不是在代码中进行初始化。您在初始化时付出的代价将不仅仅在于易于理解和增加代码的可维护性。我还考虑设计一个特定的数据结构来保存每个条目。

[编辑] 下面的示例尝试复制您的后续描述：

```
enum EntryType { string = 0, triple = 1 };

typedef struct {
   enum EntryType entry_type;
   union {
      char** string;
      int[3] *triple;
   }
} Entry;

typedef struct {
   Entry *entries;
} Abbreviation;

Abbreviation *abbrevs3;

abbrevs3 = parseAbbreviationData("path-to-abbreviations/abbrevs.xml"); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-12T18:15:57.427

在 C 中，声明数组时只能省略第*一个维度：*

```
char * abbrevs3[][22399] = { ... }; 
```

这是因为编译器想知道每个“行”有多大，以便正确布置“列”。我将尺寸放在引号中，因为您可以自由地以任何您希望的方式解释尺寸，但这是二维数组的通常约定。

也就是说，尚不清楚您的数据结构实际上是什么或您尝试将其初始化为什么。您的示例数据似乎没有任何模式。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-13T17:49:22.380

我刚刚阅读了您的新帖子并重新阅读了原始帖子，我想我只是完全理解了这里的目标。抱歉拖了这么久，我有点慢。

为了解释这个问题，在原始示例的第 4 行：

```
{ "(AN", "ANCIENT", {1, 2, 2}, {1, 2, 3}, "U+4E94)", "FIVE"}, 
```

您希望将三元组转换为对先前使用的字符串的引用，以尝试压缩数据。那行变成：

```
{ "(AN", "ANCIENT", "FORM", "OF", "U+4E94)", "FIVE"}, 
```

如果目标是压缩，我认为您不会在这里看到太多收益。自引用三元组各有 3 个字节，但被替换的字符串总共只有 8 个字节，计算空终止符，并且您在这一行只保存 2 个字节。那是为了使用字符。由于您的结构如此之大，以至于您将需要使用 int 进行引用，因此您的三元组实际上是 12 个字节，这甚至更糟。在这种情况下，您只能通过替换 12 个或更多 ascii 字符的单词来节省空间。

如果我在这里完全偏离基础，请随意忽略我，但我认为对空格进行标记然后删除重复单词的方法只是一种穷人的[Huffman 压缩](http://en.wikipedia.org/wiki/Huffman_coding)。Huffman 其中字母表是[最长公共子串](http://en.wikipedia.org/wiki/Longest_common_substring_problem)的列表，或者其他一些标准的文本压缩方法可能会很好地解决这个问题。

如果由于某种原因这不是一个选项，我想我会得到您数据中所有唯一单词的列表并将其用作查找表。然后将所有字符串作为索引列表存储到该表中。您必须使用两个表格，但最终它可能会更简单，并且可以节省您现在用作“缩写标记”的前导 1 所使用的空间。基本上，您的缩写标记将成为单个索引而不是三元组。

所以，

```
const char * words[] = {
    "hello", "world", "goodbye", "cruel"
    };

const int strings[] = {
    { 0, 1 },
    { 2, 3, 1 }
    }; 
```

如果你的字符串不是大致均匀的长度，你仍然会失去很多空间。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T19:03:34.413

我认为这里的问题是您是否可以静态声明 C 样式字符串的多维数组，其中每行有不同数量的字符串。所以，像这样：

```
const char * arr[][3] =
    {
    {"bla", "bla", "bla"},
    {"bla", "bla" }
    }; 
```

在某些语言中，这被称为“锯齿状数组”。在 C 和 C++ 中，您可以这样做，尽管编译器会希望分配空间来存储所有行，就好像它们的长度相同，因此您最终不会初始化第二个数组的第三项。当我在 gcc 上对此进行测试时，该数组中的第三项设置为 NULL，但我不知道您是否可以指望它。

我认为您无法让编译器接受声明为 {1,2,3} 的数组作为 C 样式字符串。即使确实如此，并且您将它们视为字符串，您也会遇到问题，因为它们不是以空值终止的。

我同意其他海报，更好的方法可能是将这些数据存储在 XML、yaml 中，或者可能存储在您从中获取它们的数据库中，并在那里访问它们。如果您确实需要在源文件中静态创建这些，则最好声明一个对您的数据有意义的结构并初始化这些结构的数组。就像是：

```
typedef struct
{
  const char * somestring;
  const char * someotherstring;
  const unsigned int triple[3];
} Abbreviation;

const Abbreviation abb[] =
  {
    {"First Thing", "Second String", {1,2,3} },
    {"Other Thing", "Some String", {4,5,6} }
  }; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-14T01:20:44.637

原始数据大约为 1.7MB，它来自其他 2 个文件，一个来自我的雇主，另一个（Unihan.txt，大约 30MB）来自 Unicode Consortium。使用字典查找技术，使用前 128 个最长和最频繁出现的单词的字典，仅将数据大小降低到 1.5MB。我可以通过更智能的单词检测来改进这一点，目前这只是空间上的 VBScript Split()。

我没有任何关于使用准霍夫曼方法得到多小的数据，但我的猜测是它略小于 1MB。我希望将所有这些都放在二进制文件中，而不是作为一个单独的文件（尽管其他人可能会说不好的做法等）。然而，就目前而言，这一切都变得有点太难了，至少在 C 中。如果我可以弄清楚如何在 Euphoria 中创建 BSTR 的变体数组...

**编辑**：我使用了关于标准 UCN 的字典查找，并且由于字形描述的重复性而效果很好。Unihan 的问题在于你最终得到了对字形*含义*的描述；`"VULGAR FRACTION ONE QUARTER"`和之间有定性（和定量！）差异`"A KIND OF PUNISHMENT IN HAN DYNASTY, NAME OF CHESSMEN IN CHINESE CHESS GAME(SIMPLIFIED FORM, A VARIANT U+7F75) TO CURSE; TO REVILE; TO ABUSE, TO SCOLD"`

因此，从字典查找转向一些更强大的“压缩”技术。

（在有人说“那么 1.7MB 有什么大不了？”之前，我来自一个 16K RAM 很多的时代。无论如何我都有空间限制。）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-13T15:09:46.540

传奇似乎还没有结束。我最终把所有东西都变成了一个参差不齐的`int`. 但是这样就失去了三元组背后的自我参照机制所依赖的项目的概念。

我现在正在考虑使用[Euphoria](http://rapideuphoria.com)而不是 C，因为它对不规则数组的出色支持。可以使用 Euphoria 构建标准 DLL，一旦我弄清楚如何交回 BSTR 的变体数组并编写 Typelib ...

请注意，我想我可以坚持使用 C 并将三元组存储为一行中的三个整数，并将字符串存储为转换为整数的指针。这将节省我对最初构建自引用字典的 VBScript 的相当大的重写。

# c++ - switch case vs if else

> ID：195802
> 
> 赞同：13
> 
> 时间：2008-10-12T18:12:27.357
> 
> 标签：c++, c, if-statement, compilation, switch-statement

I was wondering if there was any difference in the way the following code was compiled into assembly. I've heard that switch-case is more efficient than if else, but in this example I am not quite sure if that would be the case.

```
if(x==1){
...
}else if(x==2){
...
}else{
...
} 
```

and

```
switch(x){
 case 1:
 ...
 break;

 case 2:
 ...
 break;

 default:
 ...
} 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-12T18:24:07.833

A compiler will sometimes turn a switch into a jump-table, if the entries are contiguous (or nearly so). Or it could theoretically use a binary search to find the case instead of a linear series of tests, which would be faster if you had a large number of cases.

On the other hand, there's nothing stopping the compiler from doing the same optimisations on the same code converted into if/else.

So on a good compiler, switch can be faster in some cases. On a very good compiler, they'd be the same.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-12T18:18:34.130

In *this* specific case, the `switch` can be turned into a jump table. The `if` statement (if you write your `=` as `==` :-P) could still do the same thing if the compiler could tell that `x` isn't changing between the `if` clauses (which is usually the case, unless `x` is `volatile` or something).

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-13T03:45:01.523

还要注意，如果您知道某些情况比其他情况更有可能发生，那么 if/else 结构会更有效。

# .net - Visual Inheritance or a User Control?

> ID：195804
> 
> 赞同：5
> 
> 时间：2008-10-12T18:13:38.493
> 
> 标签：.net, user-controls, visual-inheritance

I have several forms in a .net windows app that have a common set of textboxes and other user input controls,each form has the same look and feel, but each form needs to load and save to different database tables.

Would it be better to place the controls on a base form, and inherit from it or to create a user control to drop on each form?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-12T18:20:00.430

I usually prefer UserControls as they are more flexible - you can use them in the context of a form, or in any other visual context to display or modify data. I've had several cases where I had to change my UI design from a separate dialog to edit something to an inline control inside the main form or something like that.

Other than that, I'd say it's a matter of taste.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-12T18:20:20.167

It depends. Composite model (using User Control) is cleaner, but the control cannot be aware of the calling form, so you have to pass the logic in as events. That sometimes can lead to duplicate logic.

With inheritance, you can implement common code at the base class with some override at the subclass form and implement flexible interplay. But that requires all implementers of the subclass to be aware of the base class source code, which can get chaotic.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-03-05T13:42:38.033

取决于其更简单使用与事件相关的用户控件背后的逻辑。如果有共同的任务，您可以使用基类 Server Control。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-12T20:10:26.027

我根据情况使用这两种方法。如果您有一块功能性的 LOGIC 想要直接放入未修改的表单中，那么我认为 UserControls 是合适的。但是，如果您只是想在多个表单中复制和扩展一个通用 UI，那么视觉继承可能是更好的选择。

# erlang - 是否可以使用 Erlang、Mnesia 和 Yaws 开发强大的网络搜索引擎？

> ID：195809
> 
> 赞同：6
> 
> 时间：2008-10-12T18:17:29.767
> 
> 标签：erlang, search-engine, web-crawler, mnesia, yaws

我正在考虑使用 Erlang、Mnesia 和 Yaws 开发一个网络搜索引擎。是否有可能使用这些软件制作一个功能强大且速度最快的网络搜索引擎？它需要什么来实现这一点，我该如何开始？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2010-10-23T14:17:35.323

Erlang 可以制作出当今最强大的网络爬虫。让我带你了解我的简单爬虫。

步骤 1\. 我创建了一个简单的并行模块，我称之为*mapreduce*

```
-模块（mapreduce）。
-出口（[计算/2]）。
%%================================================== ======================
%% 使用示例
%% 模块 = 字符串
%% 功能 = 代币
%% List_of_arg_lists = [["file\r\nfile","\r\n"],["muzaaya_joshua","_"]]
%% Ans = [["file","file"],["muzaaya","joshua"]]
%% 两个进程正在完成的工作
%% 即没有。产生的进程数 = 长度（List_of_arg_lists）

计算（{模块，功能}，List_of_arg_lists）->
    S = 自我（），
    参考 = erlang:make_ref(),
    PJob = fun(Arg_list) -> erlang:apply(Module,Function,Arg_list) end,
    Spawn_job = fun(Arg_list) ->
                    spawn(fun() -> 执行(S,Ref,PJob,Arg_list) end)
                结尾，
    列表：foreach（Spawn_job，List_of_arg_lists），
    收集（长度（List_of_arg_lists），参考，[]）。

聚集（0，_，L）-> L；
聚集（N，参考，L）->
    收到
        {Ref,{'EXIT',_}} -> 聚集(N-1,Ref,L);
        {Ref, Result} -> 聚集(N-1, Ref, [Result|L])
    结尾。

执行（父级，Ref，Fun，Arg）->
    家长！{Ref,(catch Fun(Arg))}。

```

步骤 2\. **HTTP 客户端**

通常使用`inets httpc module`内置于 erlang 或`[ibrowse](https://github.com/cmullaparthi/ibrowse)`. 但是，对于内存管理和速度（尽可能降低内存占用），优秀的 erlang 程序员会选择使用`[curl](http://curl.haxx.se/docs/manual.html)`. 通过应用`[os:cmd/1](http://www.erlang.org/doc/man/os.html#cmd-1)`which 需要 curl 命令行，可以将输出直接输入到 erlang 调用函数中。然而，最好让 curl 将其输出放入文件中，然后我们的应用程序有另一个线程（进程）来读取和解析这些文件

```
命令： curl "http://www.erlang.org" -o "/downloaded_sites/erlang/file1.html"

在 Erlang

os:cmd("curl \"http://www.erlang.org\" -o \"/downloaded_sites/erlang/file1.html\"")。

```

所以你可以产生许多进程。您记得在执行该命令时转义 URL 以及输出文件路径。另一方面，有一个进程，它的工作是监视下载页面的目录。它读取并解析这些页面，然后它可能会在解析后删除或保存在不同的位置，甚至更好的是，使用`zip module`

```
文件夹检查（）->
    spawn(fun() -> check_and_report() end),
    行。

-定义（CHECK_INTERVAL，5）。

check_and_report()->
    %% 避免使用
    %% 文件库：list_dir/1
    %% 如果文件很多，内存！！！
    case os:cmd("ls | wc -l") of
        “0\n” -> 好的；
        “0” -> 好的；
        _ -> ?MODULE:new_files_found()
    结尾，
    睡眠（定时器：秒（？CHECK_INTERVAL）），
    %% 继续检查
    检查和报告（）。

new_files_found()->
    %% 通知我们的解析器选择文件
    %% 一旦它解析一个文件，它必须
    %% 删除或保存一些
    ％％ 还有什么地方
    gen_server:cast(?MODULE,files_detected)。

```

步骤 3\. **html 解析器。**
最好用这个`[mochiweb's html parser and XPATH](http://ppolv.wordpress.com/2008/05/09/fun-with-mochiwebs-html-parser-and-xpath/)`。这将帮助您解析和获取所有您喜欢的 HTML 标签，提取内容，然后一切顺利。下面的例子，我只关注标记中 的`Keywords`,`description`和`title`

**在 shell 中进行模块测试...很棒的结果！！！**

```
2> spider_bot:parse_url("http://erlang.org")。
[[[],[],
  {“关键字”，
   "erlang, 函数式, 编程, 容错, 分布式, 多平台, 便携, 软件, 多核, smp, 并发"},
  {"description","开源erlang官网"}],
 {title,"erlang编程语言，官网"}]

```

```
3> spider_bot:parse_url("http://facebook.com")。
[[{“描述”，
   “ facebook 是一种社交工具，可以将人们与朋友以及在他们周围工作、学习和生活的其他人联系起来。人们使用 facebook 来与朋友保持联系，上传无限数量的照片，发布链接
 和视频，并详细了解他们遇到的人。"},
  {"机器人","noodp,noydir"},
    [],[],[],[]],
 {title,"不兼容的浏览器 | facebook"}]

```

```
4> spider_bot:parse_url("http://python.org")。
[[{“描述”，
   " python 的主页，一种解释性的、交互式的、面向对象的、可扩展的\n 编程语言。它提供了清晰性和\n 多功能性的非凡组合，并且免费且
全面移植。"},
  {“关键字”，
   "python 编程语言面向对象的网络免费源"},
  []]，
 {title,"python 编程语言-官网"}]

```

```
5> spider_bot:parse_url("http://www.house.gov/")。
[[[],[],[],
  {“描述”，
   "美国众议院主页"},
  {“描述”，
   "美国众议院主页"},
  [],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[],[] ,[],[],[],
  [],[],[]|...],
 {title,"美国众议院，第 111 届国会，第 2 届会议"}]

```

您现在可以意识到，我们可以根据它们的关键字对页面进行索引，以及一个很好的页面重访计划。另一个挑战是如何制作一个爬虫（可以在整个网络上移动，从一个域到另一个域的东西），但是这个很容易。它可以通过为 href 标签解析 Html 文件来实现。使 HTML Parser 提取所有 href 标记，然后您可能需要一些正则表达式来获取给定域下的链接。

**运行爬虫**

```
7> spider_connect:conn2("http://erlang.org")。        

        链接：["http://www.erlang.org/index.html",
                "http://www.erlang.org/rss.xml",
                "http://erlang.org/index.html","http://erlang.org/about.html",
                "http://erlang.org/download.html",
                "http://erlang.org/links.html","http://erlang.org/faq.html",
                "http://erlang.org/eep.html",
                "http://erlang.org/starting.html",
                "http://erlang.org/doc.html",
                "http://erlang.org/examples.html",
                "http://erlang.org/user.html",
                "http://erlang.org/mirrors.html",
                "http://www.pragprog.com/titles/jaerlang/programming-erlang",
                "http://oreilly.com/catalog/9780596518189",
                "http://erlang.org/download.html",
                "http://www.erlang-factory.com/conference/ErlangUserConference2010/speakers",
                "http://erlang.org/download/otp_src_R14B.readme",
                "http://erlang.org/download.html",
                "https://www.erlang-factory.com/conference/ErlangUserConference2010/register",
                "http://www.erlang-factory.com/conference/ErlangUserConference2010/submit_talk",
                "http://www.erlang.org/workshop/2010/",
                "http://erlangcamp.com","http://manning.com/logan",
                "http://erlangcamp.com","http://twitter.com/erlangcamp",
                "http://www.erlang-factory.com/conference/London2010/speakers/joearmstrong/",
                "http://www.erlang-factory.com/conference/London2010/speakers/RobertVirding/",
                "http://www.erlang-factory.com/conference/London2010/speakers/MartinOdersky/",
                "http://www.erlang-factory.com/",
                "http://erlang.org/download/otp_src_R14A.readme",
                "http://erlang.org/download.html",
                "http://www.erlang-factory.com/conference/London2010",
                "http://github.com/erlang/otp",
                "http://erlang.org/download.html",
                "http://erlang.org/doc/man/erl_nif.html",
                "http://github.com/erlang/otp",
                "http://erlang.org/download.html",
                "http://www.erlang-factory.com/conference/ErlangUserConference2009",
                "http://erlang.org/doc/efficiency_guide/drivers.html",
                "http://erlang.org/download.html",
                "http://erlang.org/workshop/2009/index.html",
                "http://groups.google.com/group/erlang-programming",
                "http://www.erlang.org/eeps/eep-0010.html",
                "http://erlang.org/download/otp_src_R13B.readme",
                "http://erlang.org/download.html",
                "http://oreilly.com/catalog/9780596518189",
                "http://www.erlang-factory.com",
                "http://www.manning.com/logan",
                "http://www.erlang.se/euc/08/index.html",
                "http://erlang.org/download/otp_src_R12B-5.readme",
                "http://erlang.org/download.html",
                "http://erlang.org/workshop/2008/index.html",
                "http://www.erlang-exchange.com",
                "http://erlang.org/doc/highlights.html",
                "http://www.erlang.se/euc/07/",
                "http://www.erlang.se/workshop/2007/",
                "http://erlang.org/eep.html",
                "http://erlang.org/download/otp_src_R11B-5.readme",
                "http://pragmaticprogrammer.com/titles/jaerlang/index.html",
                "http://erlang.org/project/test_server",
                "http://erlang.org/download-stats/",
                "http://erlang.org/user.html#smtp_client-1.0",
                "http://erlang.org/user.html#xmlrpc-1.13",
                "http://erlang.org/EPLICENSE",
                "http://erlang.org/project/megaco/",
                "http://www.erlang-consulting.com/training_fs.html",
                "http://erlang.org/old_news.html"]
行

```

***存储：***是搜索引擎最重要的概念之一。将搜索引擎数据存储在 MySQL、Oracle、MS SQL 等 RDBMS 中是一个大错误。此类系统非常复杂，与它们交互的应用程序采用启发式算法。这将我们带到了**[Key-Value Stores](http://cattell.net/datastores/Datastores.pdf)**，其中我最好的两个是**`[Couch Base Server](http://www.couchbase.com/)`**和**`[Riak](http://basho.com/)`**。这些都是很棒的云文件系统。另一个重要参数是缓存。缓存是使用 say 实现`**[Memcached](http://memcached.org/)**`的，上面提到的其他两个存储系统都支持它。搜索引擎的存储系统应该是`schemaless DBMS`，其重点是`Availability rather than Consistency`。从这里阅读更多关于搜索引擎的信息： [http ://en.wikipedia.org/wiki/Web_search_engine](http://en.wikipedia.org/wiki/Web_search_engine)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-12T18:38:33.560

据我所知[Powerset](http://www.powerset.com)的自然语言处理搜索引擎是使用 erlang 开发的。

您是否将[couchdb](http://incubator.apache.org/couchdb/)（也是用 erlang 编写的）视为一种可能的工具来帮助您解决一些问题？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-12T11:34:28.603

我会推荐 CouchDB 而不是 Mnesia。

*   Mnesia 没有 Map-Reduce，CouchDB 有（更正 - 见评论）
*   Mnesia 是静态类型的，CouchDB 是文档数据库（而页面是文档，即在我看来更适合信息模型）
*   [Mnesia 的主要目的是成为一个内存驻留的数据库](http://www.erlang.org/faq/mnesia.html)

YAWS 很不错。您还应该考虑 MochiWeb。

Erlang 不会出错

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-17T19:34:53.553

在['rdbms' contrib](http://jungerl.cvs.sourceforge.net/viewvc/jungerl/jungerl/lib/rdbms/src/)中，有一个 Porter Stemming Algorithm 的实现。它从未集成到“rdbms”中，所以它基本上只是坐在那里。我们在内部使用过它，而且效果很好，至少对于不是很大的数据集（我还没有在大量数据上测试过）。

相关模块有：

```
rdbms_wsearch.erl
rdbms_wsearch_idx.erl
rdbms_wsearch_porter.erl 
```

当然还有[Disco Map-Reduce 框架](http://discoproject.org/)。

你是否能制造出最快的引擎，我不能说。*更快*的搜索引擎有市场吗？我从来没有遇到过谷歌等速度的问题。但是，增加我找到问题的好答案的机会的搜索工具会让我感兴趣。

# iphone - Test Driven Design for iPhone Native apps

> ID：195820
> 
> 赞同：16
> 
> 时间：2008-10-12T18:25:06.490
> 
> 标签：iphone, objective-c, ruby, tdd

I'm experimenting with the iPhone SDK and doing some TDD ala Dr. Nic's rbiPhoneTest project. I'm wondering how many, if any, have been successful using this or any other testing framework for iPhone/Cocoa? More important, I'd like to know how to best assert a proprietary binary request/response protocol. The idea is to send a binary request over the network and receive a binary response. Requests and responses are created using byte and'ing and or'ing. I'm using the golden copy pattern to test my request. Here's what I have so far. Don't laugh as I'm new to btoh Objective C and Ruby:

```
require File.dirname(__FILE__) + '/test_helper'
require 'fileutils'
require 'io'

require "MyModel.bundle"
OSX::ns_import :MyModel

module MyTestExtensions
  def is_absolute_path(path)
    return /^\/.*/.match(path)
  end

  def parent_directory(file)
    dir = file
    if(! is_absolute_path(dir))
      dir = File.expand_path(dir)
    end
    dir = File.dirname(dir)
    assert is_absolute_path(dir), "Expecting an absolute path with #{dir}"
    return dir
  end

  def assert_NSData_contains_bytes_from_file(file, data)
    assert_not_nil data, "Data should not be nil."
    assert data.bytes, "data should have bytes"
    data.length.times { |i|
      expected = file.getc
      assert_not_nil expected, "Expected only #{i} bytes. Actual data contains more."
      actual = data.bytes.int8_at(i)
      assert_equal expected, actual, "Bytes should be equal at offset #{i} expected #{expected.chr} but was #{actual.chr}"
    }
    expected = file.getc
    raise AssertionFailedError, "Expecting #{expected.chr} at offset #{data.length}" unless expected == nil
  end

end

class TestMyModel < Test::Unit::TestCase
include OSX
include MyTestExtensions

  def this_files_dir
    return parent_directory(__FILE__)
  end

  def setup
    @expectedReq = File.new("#{this_files_dir}/ExpectedMyReq")
    # @expectedReq = File.new("#{this_files_dir}/hello.txt")
    assert File.exist?("#{this_files_dir}/ExpectedMyReq"), "The file [#{@expectedReq.path}] should exist."
  end

  def test_my_model_class_exists
    MyModel
  end

  def test_can_init_instance
    assert MyModel.instancesRespondToSelector(:init), "MyModel Should define :init"
  end

  def test_my_model_can_request_my_data
    myModel = MyModel.alloc.init
    data = myModel.requestMyData 'Some query text'
    assert_NSData_contains_bytes_from_file @expectedReq, data
  end

end 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-12T18:43:22.443

I don’t know much about Ruby or binary protocols, but if You’re interested in unit testing on iPhone, You might want to check out the [Google Toolbox for Mac](http://code.google.com/p/google-toolbox-for-mac/). I am having great success testing my OpenGL ES application with it.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-10T12:44:40.083

Cliff，从长远来看，您最好将时间投资于纯 ObjC TDD 工具。我已经成功地在 fmdb-migration-manager 中使用了我自己的 rbiphonetest 库，但它的用处可能仅限于库等。即使那样，毫无疑问会有足够的“在 Cocoa 中工作但在 UIKit 中失败”的场景使 rbiphonetest 的使用变得可疑。希望有一天 RubyCocoa 可以针对英特尔 UIKit 库构建，然后我认为它将非常有用和强大。

# linux - 将 memcache 与单服务器应用程序一起使用的最佳方式是什么？

> ID：195829
> 
> 赞同：6
> 
> 时间：2008-10-12T18:41:23.943
> 
> 标签：linux, caching, memcached, lamp

对于单服务器 LAMP 站点（通常负载很高），使用 memcache 的最佳方式是什么？

在与应用程序相同的服务器上运行 memcache 守护进程是否有意义，或者这只会从 MySQL 中占用宝贵的内存，从而导致净性能损失。在这种情况下使用 memcache 是否有意义 - 或者是始终为 memcache 提供专用服务器的最佳解决方案？

我很欣赏需要在之前和之后分析网站才能真正回答这个问题，但我不想在现阶段在现场网站上这样做。尤其是当外面的人肯定知道他们头顶上的答案时。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-12T18:43:28.200

通常，建议（参见[memcached 页面](http://www.danga.com/memcached/)中的*What about shared memory？*）是在与 Web 服务器相同的机器上运行 memcached，前提是 Web 应用程序是 CPU 密集型的（memcached 不是），而 memcached 是 memory-重（大多数 Web 应用程序不是，至少相比之下）。

因此，如果您的 Web 服务器有足够的内存，最好在其上运行 memcached。YMMV。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T17:44:06.073

memcached 的另一个选项 - 根据您正在缓存的信息的规模，是在 APC 中缓存。您应该运行它（或类似的操作码缓存）以帮助加速 PHP 页面交付，所以如果您正在缓存从几个到一百个或更小的地方（我有几个大约 15KB ，一次有 70 多个）变量，您可能会发现将它们存储在 APC 中会带来一些好处。

我有一个缓存一些数据库查找的站点，还缓存一个解析后的 config.ini 文件——在我的（繁忙的）站点上，我每天将节省数百万潜在的数据库命中。

# exception - 编写自定义异常类时应该考虑哪些因素？

> ID：195834
> 
> 赞同：7
> 
> 时间：2008-10-12T18:44:34.377
> 
> 标签：exception, oop

**自定义异常类**何时最有价值？
是否存在应该或不应该使用它们的情况？有什么好处？

**相关问题：**

1.  **[抛出异常的性能注意事项](https://stackoverflow.com/questions/6891/performance-considerations-for-throwing-exceptions)**
2.  **[您是为特定问题编写例外还是一般例外？](https://stackoverflow.com/questions/21652/do-you-write-exceptions-for-specific-issues-or-general-exceptions)**

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-12T22:21:34.140

### 要问自己的问题：

1.  谁会抓住它？如果没有，那么您实际上并不需要自定义异常。
2.  你会把它扔到哪里？是否有足够的上下文可用，或者您是否需要在异常对最终捕获器有用之前多次捕获并重新抛出？
3.  你为什么扔它？因为你发现了一个异常，需要附加额外的信息？因为您在某些数据中遇到了不可恢复的错误，并且需要将具体情况传达回客户端代码？因为你喜欢`throw`东西？
4.  有什么例外？不是什么原因造成的，而是**从捕手的角度来看是**什么？他们可以修复并重试吗？他们不应该*重*试的东西？他们应该通知用户什么？他们应该附加上下文信息然后重新抛出的东西？*什么*决定了您需要传递的信息（如果有的话）...

### 戒律：

1.  不要将时间浪费在永远不会被捕获的自定义异常上。
2.  不要“加倍”异常：每个自定义异常类型都应该有一个明确定义的案例，它可以而且应该被捕获；不匹配的异常应该被分解为它们自己的自定义类型（而不是强制捕获器将条件逻辑构建到单个`catch()`子句中）。
3.  除非您有*充分*的理由不这样做，否则始终允许从先前捕获的异常中附加内部异常/数据。失去上下文很少有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T18:52:36.340

我是一个极简主义者，只有在调用代码必须明确地对发生的特定条件做出反应时才会创建自定义异常。对于所有其他情况，我将使用最合适的 .NET 库异常。例如 ArgumentNullException、InvalidOperationException

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T18:56:49.577

**当您需要以某种方式将一个异常与其他异常区分开来时。** 就是这样，真的。当然，您也可以创建一个使用枚举来区分其原因的异常类。

当您想要传递额外信息时，这真的很容易看到异常。传递该信息的唯一原因是您希望以后能够获取该信息，因此您需要知道类型，以便您可以从该类型而不是其他类型中检索信息。

在 C++ 中，也许还有其他一些语言，你也可以 typedef 一个异常。这将允许类型区分，并可能在未来转换为自定义类。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T19:06:29.837

正如[Wheelie](https://stackoverflow.com/questions/195834/what-factors-should-be-taken-into-consideration-when-writing-a-custom-exception#195843)所说，首先寻找适当的框架异常，并且仅在您真正计划捕获它们的地方使用异常（尤其是自定义异常）。

我使用了一个包含 UserMessage 属性的自定义异常类，这样我就可以在可能的情况下以简单的语言将问题传播给用户。

如果您使用的是 .NET，请查看[Designing Custom Exceptions](http://msdn.microsoft.com/en-us/library/ms229064(VS.80).aspx)。有趣的是，该文档[更改了其](http://msdn.microsoft.com/en-us/library/ms229007(VS.80).aspx)关于使用 ApplicationException 的建议：

> 如果您正在设计需要创建自己的异常的应用程序，建议您从 Exception 类派生自定义异常。最初认为自定义异常应该从 ApplicationException 类派生；然而，在实践中，这并没有增加显着的价值。有关详细信息，请参阅处理异常的最佳实践。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-12T19:30:27.543

不久前，我写了一篇关于[何时抛出不同类型的异常以及何时创建新异常类型](http://gregbeech.com/blogs/tech/archive/2007/06/05/why-do-we-have-different-types-of-exception.aspx)的博客文章。它不是那么长，但可能太长了，无法粘贴到这里，所以请原谅我只是链接。它应该涵盖您关于为什么存在不同异常类型以及如何知道是否需要创建自定义异常类型的问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-12T20:32:44.890

我使用自定义异常的主要原因是封装了多个提供程序：SqlDataAccess 层外的 SqlException 泄漏，NetworkDataAccess 层外的 SocketException 使得调用代码依赖于您的实现细节。最好将它们包装成 DataAccessException 或其他东西。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-12T20:59:14.167

我认为简单的答案是“在没有现有异常充分表达异常情况时创建自定义异常。”

我还应用了第二条规则：“仅当您希望开发人员能够处理异常时才创建自​​定义异常。” 如果您不认为异常是可恢复的条件，那么创建新异常是没有意义的。在这种情况下抛出 InvalidOperationException 更有效。

编辑：最后写了一篇关于这个主题的博客文章：http: [//blogs.msdn.com/jaredpar/archive/2008/10/20/custom-exceptions-when-should-you-create-them.aspx](http://blogs.msdn.com/jaredpar/archive/2008/10/20/custom-exceptions-when-should-you-create-them.aspx)

# continuous-integration - CruiseControl [.Net] 与 TeamCity 的持续集成？

> ID：195835
> 
> 赞同：117
> 
> 时间：2008-10-12T18:45:18.400
> 
> 标签：continuous-integration, build-automation, cruisecontrol.net, teamcity, cruisecontrol

根据实际经验，我想问一下您认为哪种自动化构建环境更好。我打算做一些.Net 和一些Java 开发，所以我想要一个支持这两个平台的工具。

我一直在阅读并发现了用于 stackoverflow 开发的[CruiseControl.NET](http://www.cruisecontrolnet.org)和[TeamCity](http://www.jetbrains.com/teamcity/index.html)，它支持在不同的操作系统平台上基于不同的编程语言构建代理。那么，如果您在这两个方面都有一些实践经验，您更喜欢哪一个，为什么？

目前，我最感兴趣的是该工具的易用性和管理性，更不用说 CC 是开源的，而且当你有很多项目要运行时，TC 在某些时候会受到许可（因为，我少量项目需要它）。

此外，如果有其他工具可以满足上述要求，并且您认为值得推荐 - 请随时将其包含在讨论中。

* * *

## 回答 #1

> 赞同：111
> 
> 时间：2008-10-13T00:49:36.167

自从产生 Cruise Control（java 版本）以来，我一直在使用持续集成工具。我在某个时候几乎尝试了所有这些。在 TeamCity 中，我从未像现在这样快乐。它的设置非常简单，并且仍然提供强大的功能。显示构建时间、单元测试计数、通过率等的构建统计页面非常好。TeamCity 的项目主页也很有价值。对于简单的 .NET 项目，您只需告诉 TeamCity 解决方案在哪里以及哪些程序集有测试，这就是它所需要的（源代码控制位置除外）。我们还使用了一些复杂的 MSBuild 脚本并完成了构建链接。我还经历了两次 TeamCity 升级，而且它们都很轻松。

CruiseControl.NET 也运行良好。设置起来比较棘手，但它的历史更长，因此很容易在网上找到解决方案。由于 CruiseControl.NET 是开源的，您还可以选择添加或更改任何您喜欢的内容。自 CruiseControl.NET 发布以来，我一直在使用它，并为 cc.tray 编写了一些早期代码（幸好由更了解的人重新编写）。

来自 ThoughtWorks 的 Cruise 看起来也很不错，但我没有看到一个令人信服的理由让我转换。如果我要开始一个新项目，我可能会尝试一下，但是 TeamCity 做得很好，让简单的事情变得简单，同时让复杂的事情变得轻松。

编辑：几周前我们刚刚升级到 TeamCity 5.0，这是另一个轻松的升级。它让我们可以利用改进的代码覆盖能力和 GIT 支持。我们现在也在使用已经存在一段时间的个人构建和预测试提交功能。我只是想我应该更新答案以表明 TeamCity 不断改进并且仍然易于使用。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-04-08T14:33:53.647

我曾经/我是 CC.NET 的忠实粉丝。我们目前在 CruiseControl 中有 5 个项目，并且效果很好。手动编写配置文件可能会很痛苦，但没关系。

*但是*。

在[Kona：持续集成和更好的单元测试](http://blog.wekeroad.com/mvc-storefront/kona-2)截屏之后（关于 TeamCity 的前 1/3），我也会检查 TeamCity。我喜欢集成的单元测试仪表板和配置界面。

我认为**每个人都**应该在选择 CC.NET 或 TeamCity 之前观看此视频。

ps：希望网上也有有价值的CC.NET视频。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-03-12T12:43:53.250

到目前为止，我最喜欢的 CI 服务器是 Hudson。易于设置和维护，有很多漂亮的图表可以向开发人员和非开发人员展示趋势，而且是免费的。

我目前在一个项目中使用 TeamCity，我通常对它感到满意，但它生成的许多图表并不是特别有用，而且它的配置比 Hudson 更复杂。

也就是说，TeamCity 功能强大，可免费用于多种用途，并且有一个杀手级功能：远程运行。您可以直接从 IDEA 或 Eclipse 中“预先提交”您的签入，在 TeamCity 服务器上运行一个或多个构建配置，并且仅在构建成功时才提交更改（例如，编译并且所有测试都通过）。

鉴于您可以在几个小时内让 TeamCity 和 Hudson 都启动并运行，可能值得同时抓住这两个并运行它们，以及您能想到的任何其他（例如 CruiseControl）。如果你不能让 CI 服务器快速进行并排比较，那么至少你有一个易于安装和/或配置的数据点。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-10-12T19:48:50.547

我已经在不同的项目中成功地使用了它们。从设置和管理的角度来看，Team City 更容易处理。您不必像使用 CC 一样修改 .config 文件，而且设置起来轻而易举。由于您没有很多项目，我会推荐 Team City 而不是 CC，直到您达到 Team City 成本 $$ 的程度。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-10-16T18:09:28.360

我用过 CC.net 和 TeamCity。我的任务是为我的组织（5 个开发人员）设置和安装 TeamCity。我们的组织使用了一些不常见的实践和工具（至少对于我们这种规模的组织而言），例如用于源代码控制的 Perforce 和在异构操作系统上运行的多个构建代理，这导致了一些初始设置问题。但是，通过电子邮件提供的支持在一切设置方面绝对是一流的。我在几分钟内就收到了我愚蠢问题的答案。

该界面直观且响应迅速，并且功能丰富。该产品感觉非常昂贵。配置很简单，Web 界面足够智能，可以自行更新，无需重新启动代理或服务器服务，甚至无需刷新页面。

我觉得我们正在使用该产品的几乎所有高级功能，并且到目前为止还没有发现任何错误。Ndepend 集成，嵌套的 NAnt 脚本，Perforce 版本标签，你说的，我们正在做。

我向任何正在寻找持续集成服务器或任何构建服务器的人强烈推荐 TeamCity。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-12T19:45:53.627

不想向您扔替代工具:-)

Hudson 是一个很棒的开源替代品，我使用过 CC 和 CC.net，我承认我确实认为它们是很棒的工具。我正在考虑切换到 hudson，因为它看起来更容易设置和维护。

[https://hudson.dev.java.net/](https://hudson.dev.java.net/)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-21T08:11:13.790

确保您决定的系统可以扩展到您需要它处理的项目数量......

我使用 CruiseControl.Net，但我不建议将它用于构建大量项目......我有一个（可能有点奇怪）的安排，我有许多 C++ 静态库，我将它们组合成应用程序。每个库都依赖于其他库，并且应用程序会引入一组库并进行构建。每个库都有一个测试套件。每个应用程序都有一个测试套件。我为 5 个编译器和（Windows）平台的变体构建。

我发现的第一件事是 CC.Net 的项目触发器并不是您真正需要的，并且多触发器不能很好地与项目触发器配合使用。项目触发器的工作方式（他们使用远程连接到存储项目的服务器（即使它是由同一 CC.Net 实例管理的项目），然后从该服务器中拉出所有项目并按顺序搜索列表正在寻找您感兴趣的项目...）意味着它们不能很好地扩展。一旦你完成了一定数量的项目，你会发现 CC.Net 正在为你的构建机器占用大部分 CPU。

当然，它是开源的，所以你可以修复它……而且，我相信它对于少量的非相互依赖的项目来说没问题。

有关我遇到的问题和 CC.Net 的一些补丁的更多详细信息，请参见此处[http://www.lenholgate.com/archives/cat_ccnet.html](http://www.lenholgate.com/archives/cat_ccnet.html)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-12T18:53:44.497

我最近设置了 cc .net。这是一个很棒的应用程序，但确实需要一点耐心。您将在记事本中编辑配置文件很多:)

它已经有一段时间了，所以它得到了很好的支持，你通常可以找到以前做过你想做的事情的人。Web 界面也是 .net，这对我们来说是一个加分项，因为我们是 Microsoft 商店。

我没有使用过 TeamCity，但我听说过很多关于它的建议，而且它看起来很漂亮。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-13T00:02:56.307

在我以前的公司期间，我有在 Linux 上设置和运行 CruiseControl（Java 版本）的经验。就像大多数人建议的那样，设置它并不是最简单的事情。您需要了解它的框架才能提出可行/可管理的配置。然而，一旦你通过了那个坎，我觉得 CruiseControl 非常灵活，可以让你做不同的事情来适应不同的场景。

此外，CruiseControl 文档，它的[wiki 页面](http://cruisecontrolnet.org/projects/ccnet/wiki/Wiki)也有一些有用的信息。

我没有使用 TeamCity 的直接经验。虽然它的预测试提交功能看起来很有趣。

您可能会看到的另一个 CC 工具是Atlassian 的[Bamboo](http://www.atlassian.com/software/bamboo/)。设置起来更容易，界面也更好。不过，它不像 CruiseControl 提供的那样灵活。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-12T19:39:46.777

您可能要考虑的第三种选择：Thoughtworks 的 Cruise。它建立在 CruiseControl 之上，但提供了更多功能、更简单的设置等。不是免费的（或开源的）。

[http://studios.thoughtworks.com/cruise-continuous-integration](http://studios.thoughtworks.com/cruise-continuous-integration)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-05-22T11:18:27.743

在过去的 1 年半中，我一直在使用 Teamcity，并获得了很棒的体验。我已经集成了许多 .Net 和 Java 项目，并使用了 MSBuild、M​​aven 等工具。我发现 Teamcity 的设置和使用非常简单。我还设法让 CI 运行在一些 sql 项目中，这有点像噩梦，如果使用其他 CI 工具可能会更糟。
最近升级到无痛的 Teamcity 8.0.6。Teamcity 还提供了一个[REST API](http://confluence.jetbrains.com/display/TCD8/REST+API)，这对于某些场景非常有用。如果您使用 powershell 进行自动化构建，[GitHub 上提供了许多 Psake/Teamcity 集成脚本](https://github.com/JamesKovacs/psake/wiki/How-can-I-integrate-psake-with-Team-City?)

# html - What are the main differences between XHTML and HTML?

> ID：195840
> 
> 赞同：47
> 
> 时间：2008-10-12T18:49:58.390
> 
> 标签：html, xhtml

What are the main differences between XHTML and HTML? Which one is better in your opinion, and why? Do most browsers support both?

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-12T18:58:32.490

**XHTML** is based on **XML**, and thus requires the source to be well-formed. Since XHTML is more strict than HTML, less pre-processing is needed by the rendering engine.

XHTML should be served as application/xhtml+xml for you to take advantage of the benefits, otherwise XHTML will be treated as ordinary HTML. Serving it as 'application/xhtml+xml' is not common on the web due to Internet Explorer, which cannot handle XHTML.

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-10-12T19:45:50.117

这可能是我读过的关于每个人的差异和相对优点的最好的文章：

## [HTML 与 XHTML](http://www.webstandards.org/learn/articles/askw3c/oct2003/)

*我们应该使用哪一个，HTML 还是 XHTML，为什么？*

[WHATWG wiki](http://wiki.whatwg.org/wiki/HtmlVsXhtml)上也有一个相当技术性的比较。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-12T18:55:26.943

The Extensible Hypertext Markup Language, or XHTML, is a markup language that has the same depth of expression as HTML, but also conforms to XML syntax.

XHTML is "the modern version of HTML 4".

More info : [wikipedia](http://en.wikipedia.org/wiki/XHTML) and [W3C](http://www.w3.org/MarkUp/)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-10-12T22:01:05.943

不同之处在于 XHTML 基于 XML，而 HTML 基于 SGML。

浏览器使用 SGML 解析器处理以内容类型发送的内容`text/html`，使用 XML 解析器处理`application/xhtml+xml`.

使用 SGML 解析器时，即使在文件中遇到语法错误，浏览器也会继续解析。这就是为什么很多人在向浏览器发送看起来像 XML 的文件时认为他们正在使用 XHTML。这实际上是一个错误，因为这会在浏览器中触发许多解析错误并减慢渲染过程。

使用 XML 解析器时，浏览器会在遇到语法错误时停止解析并显示 XML 错误。当然，这仅适用于具有用于 HTML 内容的 XML 解析器的浏览器，而对于仅下载文件而不显示它的 Internet Explorer 则不然。

那你该怎么办？

如果您需要 XML 强加的语法检查和严格的结构，您应该使用 XHTML。您应该记住，您必须以错误的内容类型将 XHTML 内容发送到 Internet Explorer，并隐含所有问题。您还应该记住，只要文件中有无效内容，您的文档就会中断，因此您必须非常小心地清理任何用户输入。

您应该将 HTML 用于其他任何事情。HTML 可以正常工作，并且是当今受到极大支持的标准。甚至下一个标准 HTML 5 也定义了基于 SGML 的语法，因此这将持续下去。

请记住，无论您选择哪种格式，验证输出始终是检测语法错误的好主意。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-12T19:10:30.250

这不是关于哪个更好。HTML 仍在继续发展，HTML5 也正在开发中（尽管已经有很多年了：））并提供了一些新元素，以便更轻松地管理网页中的多媒体等新技术。

另一方面，XHTML 是关于 XML 的严格性，我们应该说保持干净。如果您保持 HTML 文档格式正确（关闭每个打开的元素，将内容嵌套在树形中），您将充分利用 XHTML/XML 世界，并且仍然可以使用 HTML 格式，将您的文档声明为是 HTML，但仍然保持它们“干净”（格式良好）。我认为我们不应该宣布它们中的每一个都“更好”。它们可以共存。这只是关于我们以正确的方式做事。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-12T20:14:00.140

如前所述，XHTML 应该（理论上）是有效的 XML。理论上（但实际上并非如此）不符合标准的 XHTML 不应由浏览器呈现。

使用一个比另一个几乎没有优势，所以写你个人喜欢的任何一个 - 只要你一直这样做。将成为未来 Web 标准的 HTML5 将同时支持 XHTML 和 HTML 4.01 样式的标签（之前通过可选的“XML 序列化”），而 XHTML2 看起来将在没有供应商积极参与的情况下几乎死气沉沉支持它。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-12T20:03:28.147

总结：使用 HTML。

有[很多不同](http://wiki.whatwg.org/wiki/HTML_vs._XHTML)之处，许多聪明人（知道他们在说什么：D）[已经](http://www.sitepoint.com/forums/showthread.php?t=393445) [总结了](http://webkit.org/blog/68/understanding-html-xml-and-xhtml/)[大部分](http://hixie.ch/advocacy/xhtml) 的利弊。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-12T18:57:32.400

An example of a difference is the break tag.

```
<br> 
```

is proper HTML, but in XHTML where the elements need to validate as XML, you must self-close the tag:

```
<br /> 
```

# c++ - 捕获在 Windows 上显示动画系统光标的哪一步

> ID：195842
> 
> 赞同：4
> 
> 时间：2008-10-12T18:50:56.827
> 
> 标签：c++, winapi

我想尽可能准确地将 Windows 操作系统上的系统光标捕获为位图。据我所知，为此提供的 API 是 GetCursorInfo、DrawIconEx。

简单的动作链是：

*   使用 GetCursorInfo 获取光标
*   使用 DrawIconEx 在内存 DC 中绘制光标。

这是代码的大致外观。

```
CURSORINFO  CursorInfo;

(VOID)memset(&CursorInfo, 0, sizeof(CursorInfo));
CursorInfo.cbSize = sizeof(CursorInfo);

if (GetCursorInfo(&CursorInfo) &&
    CursorInfo.hCursor)
{
    // ... create here the memory DC, memory bitmap

    boError |= !DrawIconEx(hCursorDC,   // device context
        0,              // xLeft
        0,              // yTop
        CursorInfo.hCursor,     // cursor handle
        0,              // width, use system default
        0,              // height, use system default
        0,              // step of animated cursor !!!!!!!!!
        NULL,               // flicker free brush, don't use it now
        DI_MASK | DI_DEFAULTSIZE);  // flags

    // ... do whatever we want with the cursor in our memory DC
} 
```

现在，任何人都知道我如何获得正在绘制动画光标的哪一步（我需要可以传递给 DrawIconEx 的 istepIfAniCur 参数的值......）？目前，上面的代码显然总是只渲染动画光标的第一步。

我怀疑这不容易做到，但无论如何都值得一问。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-30T21:45:08.953

不幸的是，我不认为有一个 Windows API 可以公开光标动画的当前帧。我假设这就是您所追求的：在您制作快照时光标的外观。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-13T06:46:01.330

我怀疑你错过了一步。

您需要创建一个位图以选择到您的设备上下文中，否则您的位图只是一个像素。

请参阅 MSDN 文档中的 CreateCompatibleBitmap：

```
HBITMAP CreateCompatibleBitmap(
  HDC hdc, // 处理 DC
  int nWidth, // 位图的宽度，以像素为单位
  int nHeight // 位图的高度，以像素为单位
);

```

使用 DrawIconEx，UINT istepIfAniCur 参数允许您选择要绘制的帧（如果它是动画光标）。

它在您的评论中说：

```
0, // 动画光标的步长 

```

# c# - 在 UserSettings 中保存 XML 数据

> ID：195844
> 
> 赞同：4
> 
> 时间：2008-10-12T18:53:24.140
> 
> 标签：c#, .net, xml, app-config

我正在尝试在 .NET Winforms 项目的 UserSettings (Properties.Settings.Default.UserSettings) 中保存一些 XML 数据。是否有可能这样做或者将这些数据保存在单独的文件中会更好？

感谢您的回答！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-13T20:40:57.853

您可以将 XML 文档的字符串表示形式存储在 String 类型的设置中。要保存文档，请将其加载到 XmlDocument 中并将设置设置为 XmlDocument.OuterXml 属性的值。要检索它，请创建一个新的 XmlDocument 并使用其 LoadXml 方法将字符串解析为 XML 文档。

这通常是个坏主意。并不是因为将 XML 文档作为文本存储在另一个 XML 文档中存在任何本质上的错误——没有。但是您通过 UserSettings 属性访问的大多数设置都是单个值。您正在引入一种操作模式，其中单个设置现在可以包含任意数量的实际设置。这不是大多数阅读您的代码的人所期望的。

与许多给代码带来难闻气味的事情一样，这在您的特定实现中可能完全没问题。我可以想象我会这样做的情况。但在大多数情况下，我不会。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-12T19:02:44.400

在以前的项目中，我有类似的想法，但决定将 xml 文件分开。

xml 文件可以是嵌入式资源，它们的文件名可以在设置文件中引用。

我认为这是一个更清洁的解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-22T11:54:36.833

感谢您的回答。作为结论，我决定将这些内容提取到另一个 xml 文件中，该文件存储在资源中。

# winapi - 如何找到 Outlook .pst 文件的完整路径？

> ID：195849
> 
> 赞同：5
> 
> 时间：2008-10-12T18:57:17.220
> 
> 标签：winapi, vba, outlook, registry, pst

有没有办法通过 API 调用或注册表项以编程方式查找当前用户的 Outlook .pst 文件的位置？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-13T12:09:40.193

使用[Outlook Redemption](http://www.dimastr.com/redemption/)，您可以使用集合迭代 VBA 中的消息存储`RDOStores`，可通过`RDOSession.Stores`属性访问。

我正在研究在开箱即用的 VBA 中做类似事情的可能性......

编辑：

显然，PST 的路径编码在 StoreId 字符串中。谷歌出现了[这个](http://www.devnewsgroups.net/group/microsoft.public.office.developer.outlook.vba/topic42609.aspx)：

```
Sub PstFiles()
  Dim f As MAPIFolder

  For Each f In Session.Folders
    Debug.Print f.StoreID
    Debug.Print GetPathFromStoreID(f.StoreID)
  Next f
End Sub

Public Function GetPathFromStoreID(sStoreID As String) As String
  On Error Resume Next
  Dim i As Long
  Dim lPos As Long
  Dim sRes As String

  For i = 1 To Len(sStoreID) Step 2
    sRes = sRes & Chr("&h" & Mid$(sStoreID, i, 2))
  Next

  sRes = Replace(sRes, Chr(0), vbNullString)
  lPos = InStr(sRes, ":\")

  If lPos Then
    GetPathFromStoreID = Right$(sRes, (Len(sRes)) - (lPos - 2))
  End If
End Function 
```

刚刚测试，按设计工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-12T19:17:08.443

路径应该在以下某处：

> [HKEY_CURRENT_USER\Software\Microsoft\Windows NT\CurrentVersion\Windows 消息子系统\Profiles\Outlook]

也许这有点帮助。

# c++ - 自旋锁与信号量

> ID：195853
> 
> 赞同：127
> 
> 时间：2008-10-12T18:58:38.373
> 
> 标签：c++, c, linux, unix, operating-system

信号量和自旋锁之间的基本区别是什么？

我们什么时候会在自旋锁上使用信号量？

* * *

## 回答 #1

> 赞同：148
> 
> 时间：2013-06-20T18:54:22.177

自旋锁和信号量主要有四点不同：

**1\. 它们是什么***自旋锁*
是锁的 一种可能实现，即通过忙等待（“自旋”）实现的锁。信号量是锁的一般化（或者，反过来，锁是信号量的特殊情况）。通常，*但不一定*，自旋锁仅在一个进程内有效，而信号量也可用于在不同进程之间进行同步。

 **锁用于互斥，即**一次一个**线程可以获取锁并继续执行代码的“关键部分”。通常，这意味着修改由多个线程共享的某些数据的代码。*信号量*
有 一个计数器，它允许自己被**一个或多个**线程获取，这取决于您发布给它的值，并且（在某些实现中）取决于它的最大允许值是多少。

 ***到目前为止，可以将锁视为最大值为 1 的信号量的特殊情况。

**2\. 它们**
的作用 如上所述，自旋锁是一种锁，因此是一种互斥（严格的 1 对 1）机制。它通过重复查询和/或修改内存位置来工作，通常以原子方式。这意味着获取自旋锁是一个“忙碌”的操作，可能会长时间（可能永远！）消耗 CPU 周期，而它实际上是“什么都没有”。
这种方法的主要动机是上下文切换的开销相当于旋转几百（或几千）次，因此如果可以通过燃烧几个旋转周期来获得锁，那么总体上很可能是更高效。此外，对于实时应用程序，阻塞并等待调度程序在未来某个遥远的时间返回它们可能是不可接受的。

相比之下，信号量要么根本不旋转，要么只旋转很短的时间（作为避免系统调用开销的优化）。如果无法获取信号量，它会阻塞，将 CPU 时间让给准备好运行的不同线程。这当然可能意味着在您的线程再次被调度之前要经过几毫秒，但如果这没有问题（通常不是），那么它可能是一种非常有效的、节省 CPU 的方法。

**3\. 它们在拥塞情况下的行为**
一个常见的误解是自旋锁或无锁算法“通常更快”，或者它们只对“非常短的任务”有用（理想情况下，不应将同步对象保持更长时间）绝对必要，永远）。
一个重要的区别是不同方法*在出现拥塞*时的行为方式。

一个设计良好的系统通常拥塞很低或没有拥塞（这意味着并非所有线程都试图同时获取锁）。例如，通常*不会*编写获取锁的代码，然后从网络加载半兆字节的 zip 压缩数据，解码和解析数据，最后修改共享引用（将数据附加到容器等）在释放锁之前。相反，获取锁只是为了访问*共享资源*。
由于这意味着在临界区之外的工作比在临界区内部的工作要多得多，因此线程在临界区内部的可能性自然相对较低，因此很少有线程同时竞争锁。当然，有时两个线程会尝试同时获取锁（如果这*不能*发生，你就不需要锁了！），但这是一个例外而不是“健康”系统中的规则.

在这种情况下，自旋锁的性能*大大*优于信号量，因为如果没有锁拥塞，获取自旋锁的开销只有几十个周期，而上下文切换需要数百/数千个周期，而丢失则需要 10-2000 万个周期。时间片的剩余部分。

另一方面，考虑到高度拥塞，或者如果锁被持有很长时间（有时你就是忍不住！），自旋锁将消耗大量的 CPU 周期而一无所获。
在这种情况下，信号量（或互斥量）是更好的选择，因为它允许不同的线程在此期间运行*有用的任务。*或者，如果没有其他线程可以做有用的事情，它允许操作系统降低 CPU 并减少热量/节约能源。

此外，在单核系统上，自旋锁在锁拥塞的情况下效率很低，因为自旋线程将浪费其全部时间等待不可能发生的状态更改（直到释放线程被调度，这*是*'在等待线程运行时*不会发生！）。*因此，给定*任何*数量的争用，在最好的情况下获取锁大约需要 1 1/2 时间片（假设释放线程是下一个被调度的线程），这不是很好的行为。

**4\. 它们是如何实现**
的 现在，信号量通常会`sys_futex`在 Linux 下封装（可选地带有一个在几次尝试后退出的自旋锁）。
自旋锁通常使用原子操作实现，而不使用操作系统提供的任何东西。在过去，这意味着使用编译器内在函数或不可移植的汇编指令。同时，C++11 和 C11 都将原子操作作为语言的一部分，因此除了编写可证明正确的无锁代码的一般困难之外，现在可以在完全可移植且（几乎）中实现无锁代码无痛方式。

* * *

## 回答 #2

> 赞同：77
> 
> 时间：2008-10-12T19:06:02.727

很简单，信号量是“产生”同步对象，自旋锁是“忙等待”对象。（信号量还有一点点需要同步多个线程，这与保护代码区域免受单个线程影响的互斥锁、守卫、监视器或临界区不同）

您会在更多情况下使用信号量，但在您将要锁定很短时间的地方使用自旋锁 - 锁定是有成本的，特别是如果您锁定很多。在这种情况下，在等待受保护资源被解锁的同时进行一段时间的自旋锁定会更有效。显然，如果旋转时间过长，性能会受到影响。

通常，如果您旋转的时间超过线程量子，那么您应该使用信号量。

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2008-10-12T19:53:01.663

除了 Yoav Aviram 和 gbjbaanb 所说的，另一个关键点过去是你永远不会在单 CPU 机器上使用自旋锁，而信号量在这样的机器上是有意义的。如今，您经常很难找到没有多核、超线程或同等功能的机器，但在您只有一个 CPU 的情况下，您应该使用信号量。（我相信原因很明显。如果单个 CPU 正忙于等待其他东西释放自旋锁，但它在唯一的 CPU 上运行，则在当前进程或线程被抢占之前，锁不太可能被释放操作系统，这可能需要一段时间，并且在抢占发生之前不会发生任何有用的事情。）

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2011-11-17T03:15:38.567

来自 Rubinni 的 Linux 设备驱动程序

> 与信号量不同，自旋锁可用于不能休眠的代码，例如中断处理程序

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2010-06-21T18:47:29.507

我不是内核专家，但这里有几点：

如果在编译内核时启用了内核抢占，即使单处理器机器也可以使用自旋锁。如果禁用内核抢占，则自旋锁（可能）扩展为*void*语句。

另外，当我们尝试比较信号量和自旋锁时，我相信信号量是指内核中使用的信号量，而不是用于 IPC（用户空间）的信号量。

基本上，如果临界区很小（小于睡眠/唤醒的开销）并且临界区不调用任何可以睡眠的东西，则应使用自旋锁！如果临界区较大并且可以休眠，则应使用信号量。

拉曼查洛特拉。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-10-12T19:18:32.450

自旋锁是指使用机器相关的汇编指令（例如测试和设置）实现线程间锁定。它被称为自旋锁，因为线程只是在循环中等待（“自旋”）重复检查直到锁可用（忙等待）。自旋锁被用作互斥锁的替代品，互斥锁是操作系统（不是 CPU）提供的一种工具，因为自旋锁在短时间内锁定时性能更好。

Semaphor是操作系统为IPC提供的一种工具，因此它的主要目的是进程间通信。作为操作系统提供的工具，它的性能将不如用于头间锁定的自旋锁（尽管可能）。信号量更适合锁定更长的时间。

也就是说 - 在组装中实现 splinlocks 很棘手，而且不便携。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2011-11-15T10:02:05.997

我想补充一下我的观察，更笼统，而不是非常特定于 Linux。

根据内存架构和处理器功能，您可能需要自旋锁才能在多核或多处理器系统上实现信号量，因为在这样的系统中，当两个或多个线程/进程需要时，可能会出现竞争条件获取信号量。

是的，如果您的内存架构通过一个内核/处理器延迟所有其他访问来提供对内存部分的锁定，并且如果您的处理器提供测试和设置，您可以实现一个没有自旋锁的信号量（但非常小心！ ）。

然而，由于设计了简单/便宜的多核系统（我在嵌入式系统中工作），并非所有内存架构都支持这种多核/多处理器功能，只有测试和设置或等效。那么一个实现可能如下：

*   获取自旋锁（忙于等待）
*   尝试获取信号量
*   释放自旋锁
*   如果没有成功获取信号量，则暂停当前线程，直到信号量被释放；否则继续关键部分

释放信号量需要按如下方式实现：

*   获得自旋锁
*   释放信号量
*   释放自旋锁

是的，对于操作系统级别的简单二进制信号量，可以仅使用自旋锁作为替代。但前提是要保护的代码段非常小。

如前所述，如果您实现自己的操作系统，请务必小心。调试此类错误很有趣（我认为，很多人不同意），但大多非常乏味和困难。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-05-21T07:18:03.193

“互斥锁”（或“互斥锁”）是两个或多个异步进程可以用来保留共享资源以供独占使用的信号。第一个获得“互斥体”所有权的进程也获得了共享资源的所有权。其他进程必须等待第一个进程释放它对“互斥体”的所有权，然后才能尝试获取它。

内核中最常见的锁定原语是自旋锁。自旋锁是一种非常简单的单持有人锁。如果进程尝试获取自旋锁但它不可用，则该进程将继续尝试（自旋），直到它可以获取锁。这种简单性创建了一个小而快速的锁。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-06-21T05:59:03.810

当且仅当您非常确定您的预期结果将在线程的执行切片时间到期之前很快发生时，才使用自旋锁。

示例：在设备驱动模块中，驱动程序在硬件寄存器 R0 中写入“0”，现在它需要等待该 R0 寄存器变为 1。H/W 读取 R0 并做一些工作并在 R0 中写入“1”。这通常很快（以微秒为单位）。现在旋转比睡觉并被硬件打断要好得多。当然，在旋转时，需要注意硬件故障情况！

用户应用程序绝对没有理由旋转。这没有意义。您将旋转以使某些事件发生，并且该事件需要由另一个用户级应用程序完成，而该应用程序永远不能保证在快速时间范围内发生。所以，我根本不会在用户模式下旋转。我最好在用户模式下 sleep() 或 mutexlock() 或 semaphore lock()。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-06-24T11:20:56.593

自旋[锁和信号量有什么区别？](https://unix.stackexchange.com/questions/5214/what-is-the-difference-between-spin-locks-and-semaphores/5222#5222)通过[Maciej Piechotka](https://unix.stackexchange.com/users/305/maciej-piechotka)：

> 两者都管理有限的资源。我将首先描述二进制信号量（互斥锁）和自旋锁之间的区别。
> 
> [自旋锁](http://en.wikipedia.org/wiki/Spin_lock)执行繁忙的等待 - 即它保持循环运行：
> 
> ```
> 而（try_acquire_resource（））；
>  ...  
> 释放（）;
> ```
> 
> 它执行非常轻量级的锁定/解锁，但如果锁定线程将被其他尝试访问相同资源的线程抢占，第二个线程将简单地尝试获取资源，直到它用完 CPU 配额。
> 另一方面，互斥锁的行为更像：
> 
> ```
> 如果（！try_lock（））{
>     add_to_waiting_queue ();
>     等待（）;
> }
> ...
> 进程 *p = get_next_process_from_waiting_queue ();
> p->唤醒（）；
> 
> ```
> 
> 因此，如果线程将尝试获取阻塞的资源，它将被挂起，直到它可用为止。锁定/解锁要繁重得多，但等待是“免费的”和“公平的”。
> 
> [信号量](http://en.wikipedia.org/wiki/Semaphore_%28programming%29)是一个允许多次使用（从初始化中知道）次数的锁——例如，允许 3 个线程同时持有资源，但不能更多。例如，它用于生产者/消费者问题或一般用于队列：
> 
> ```
> P(resources_sem)
> 资源 = 资源.pop()
> ...
> resources.push(资源)
> V(resources_sem)
> 
> ```

[信号量，互斥锁和自旋锁之间的区别？](http://kothamasusatish.blogspot.in/2013/03/difference-between-semaphore-mutex.html)

[在 Linux 中锁定](http://staff.ustc.edu.cn/~james/em2005/5.pdf)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-05-15T16:31:44.290

自旋锁只能由一个进程持有，而信号量可以由一个或多个进程持有。自旋锁等待，直到进程释放锁，然后获取锁。信号量是睡眠锁，即等待并进入睡眠状态。

# testing - 编写质量测试

> ID：195856
> 
> 赞同：15
> 
> 时间：2008-10-12T19:02:20.643
> 
> 标签：testing

我们知道，在衡量测试代码的质量时，代码覆盖率是一个糟糕的指标。我们也知道测试语言/框架是浪费时间。

另一方面，我们可以使用哪些指标来识别质量测试？您是否有任何最佳实践或经验法则可以帮助您识别和编写更高质量的测试？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-13T11:53:29.040

1.  确保您的测试彼此独立。测试不应依赖于其他测试的执行或结果。
2.  确保每个测试都有明确定义的进入标准、测试步骤和退出标准。
3.  设置需求验证可追溯性矩阵 (RVTM)。每个测试都应验证一个或多个要求。此外，每个要求都应通过至少一个测试进行验证。
4.  确保您的测试是可识别的。建立一个简单的命名或标签约定并坚持下去。记录缺陷时参考测试标识符。
5.  像对待代码一样对待你的测试。拥有一个反映您的软件开发过程的测试件开发过程。测试应该有同行评审、版本控制、变更控制程序等。
6.  对测试进行分类和组织。根据需要轻松查找和运行测试或测试套件。
7.  使您的测试尽可能简洁。这使它们更易于运行和自动化。运行大量的小测试比运行一个大的测试要好。
8.  当测试失败时，可以很容易地了解测试失败的*原因*。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-12T19:39:20.177

确保编写测试简单快捷。然后写很多。

我发现很难提前预测哪些测试将是现在或很长一段时间内最终失败的测试。我倾向于采取散弹枪的方法，如果我能想到的话，我会尝试解决极端情况。

另外，不要害怕编写更大的测试来测试一堆东西。当然，如果该测试失败，可能需要更长的时间才能找出问题所在，但通常只有在您开始将事情粘合在一起时才会出现问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-12T19:08:02.393

编写测试来验证基本功能和软件意图的各个用例。然后编写测试来检查边缘情况并验证预期的异常。

换句话说，从客户的角度编写好的单元测试，而忘记测试代码的指标。没有指标会告诉您测试代码是否良好，只有功能正常的软件会告诉您测试代码何时良好。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-14T16:08:29.557

我认为用例证明对于获得最佳测试覆盖率非常有用。如果您在用例方面拥有您的功能，则可以轻松地将其转换为不同的测试场景，以涵盖正面、负面和异常。用例还说明了前提条件和数据准备（如果有），这在编写测试用例时非常方便。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-12T19:14:15.673

我的经验法则：

1.  在您的测试计划中涵盖更简单的测试用例（不要冒险让最常用的功能未经测试）
2.  跟踪每个测试用例附近的相应需求
3.  正如[乔尔](http://www.joelonsoftware.com/articles/fog0000000043.html)所说，有一个单独的团队进行测试

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-12T19:21:11.853

我不同意代码覆盖率不是一个有用的指标。如果您没有 100% 的代码覆盖率，那至少表明需要更多测试的领域。

不过，总的来说，一旦您获得了足够的语句覆盖率，下一个合乎逻辑的地方就是编写测试，这些测试要么旨在直接验证编写代码所要满足的要求，要么旨在强调边缘情况。这些都不会自然而然地脱离您可以轻松直接测量的任何东西。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-01-11T23:33:30.667

有两种验证测试质量的好方法

## 1.[代码审查](http://en.wikipedia.org/wiki/Code_review)

通过代码审查可以验证@Patrick Cuff 在他的回答中定义的重要步骤[https://stackoverflow.com/a/197332/516167](https://stackoverflow.com/a/197332/516167)

> 代码审查是对计算机源代码的系统检查（通常称为同行审查）。它旨在发现并修复在初始开发阶段忽略的错误，**从而提高**软件的**整体质量**和开发人员的技能。

## 2.[突变测试](http://en.wikipedia.org/wiki/Mutation_testing)

第二个更便宜 - 这是测量测试质量的自动化工作。

> 突变测试（或突变分析或程序突变）用于设计新的软件测试和**评估现有软件测试的质量**。

相关问题

*   [如何保证junit测试的质量？](https://stackoverflow.com/questions/5143518/how-to-ensure-quality-of-junit-tests?lq=1)

# html - HTML 页面中的多个表单发布到自身

> ID：195872
> 
> 赞同：3
> 
> 时间：2008-10-12T19:14:05.360
> 
> 标签：html

我需要在同一个网页中有多个表单，所有表单都发布到自身，然后根据表单类型执行不同的操作。

实现这一目标的最佳方法是什么？

更具体地说，该页面显示了事件的详细信息，其中包含一个订阅表单（一个下拉框）和一个允许他们取消订阅的每个订阅者的表单（它只是一个按钮）。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-12T19:17:31.157

给你一些想法：

1.  每个表单中的隐藏字段

    `<input type="hidden" name="formname" value="firstForm" />`

2.  或将操作 url 设置为包含查询字符串

    `<form action="mypage.php?formtype=firstForm" ...>`

3.  命名按钮，以便您知道单击了哪个按钮。

    `<input type="submit" name="firstForm" value="Submit" />` 然后检查 firstForm (et al) 是否已返回

编辑：SO 上的代码采样似乎不适用于 HTML。（令人担忧）它不是转义形式，所以我已经减少了例子（对不起，我希望你明白我在说什么！）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-12T19:17:35.260

您可以为每个包含表单的表单设置一个隐藏的输入。然后，当页面处理时，您可以知道提交了哪个表单。

还是我误解了你的问题？

# svn - 将二进制文件提交到 SVN

> ID：195886
> 
> 赞同：9
> 
> 时间：2008-10-12T19:22:46.980
> 
> 标签：svn, tags

我搜索了一下，但没有找到满意的答案，所以我想听听您对此的看法。

我有几个工具，我必须不时更新和部署到几台服务器。源代码在 SVN 存储库中进行管理。

为了省去通过 ftp 或类似方式将二进制文件复制到生产服务器的麻烦（我无法在服务器上构建项目），我正在考虑在存储库中创建一个区域来提交它们。然后，只要我需要它们，我就可以简单地从 svn 服务器检索最新版本的可执行文件。

由于我不一定要在每次处理源代码时都更新/提交二进制文件，因此我不会将二进制文件的文件夹创建为我的项目的子文件夹。提交二进制文件将（并且应该）是一个单独的、有意识的行为。

```
--- trunk
    --- project1
    --- project2
--- built
    --- project1
    --- project2 
```

据我所知，这个设置应该没有问题。我真正想要的是给源版本和二进制文件一个单独的标签，以便能够一次检索属于一起的所有内容。

```
--- tags/project1/release2/ 
         includes files from 
--- trunk/project1/ revision 487 and
--- built/project1/ revision 488 
```

我所追求的是可能的，我将如何实现它？我应该改用其他方法来解决这个问题吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-12T19:29:11.757

您的设置没有什么奇怪的（当我需要保留确切的位时，我正在使用构建工具和构建工件做类似的事情。）您想要的布局绝对是可能的 - 在中“包含”其他分支或标签的特定版本你的 tags/project1/release2，你需要做的就是在 tags/project1/release2 上设置[svn:externals 属性](http://svnbook.red-bean.com/en/1.5/svn.advanced.externals.html)，引用你想要引入的源和修订的 URL，然后你就设置好了。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-12T19:41:21.953

虽然我不能直接回答你的问题，但我会告诉你另一种方法。

我们有一个用于二进制发布的单独文件服务器，其备份策略类似于 SVN 服务器的备份策略，并且每个项目都有一个目录，其中包含属于该项目但不在 SVN 中的任何内容，包括发布目录。二进制版本的整个历史都存储在这个目录中，因此您可以从任何地方（当然，从我们的网络中）获取二进制文件，而不需要 SVN，即将它复制到某个生产服务器，发送给客户或下载在虚拟机中测试。无需结帐或重建。

我发现这个设置比将二进制文件提交到 SVN 更容易管理。如果您需要具有特定版本的精确二进制文件，它就在那里，前提是该版本已提供给客户端（但是，为什么您需要一个从未见过阳光的二进制文件？）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-12T19:28:09.187

我相信这是通过使用“外部”来处理的。但是，有一些陷阱，我还没有找到让我感到舒服的东西。我使用我的源库执行您的建议，但我仍然手动执行。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T20:07:38.187

虽然从技术上讲，这种方法可以正常工作，但我个人不会使用 SVN 来存储这样的二进制文件。

我有两个原因。最初我认为 SVN 紧随 CVS 之后并没有存储二进制差异，事实证明我错了。好歹：

0）“技术上”您不需要存储生成的文件，因为它们可以在必要时重新构建。显然这在现实生活中是不切实际的，但恕我直言，您仍然应该考虑“我如何为生成的东西构建缓存”。
SVN 并不真正适合这种使用模式。这本身并不是一个真正的观点，但我想要传达的是“在 SVN 中放置一些东西意味着你关心它并想要存档它”——如果你不这样做，恕我直言，你不应该传达这个暗示或其他方式的信息

1）这很烦人。如果有人检查你的 repo 的顶部，他们也会得到所有的二进制文件。如果你有超过一两个兆，这将使人们不得不无缘无故地等待这些东西（并耗尽他们的磁盘空间）。这可以通过设置一个单独的存储库来解决，但是一旦你这样做了，恕我直言，你不妨只设置一个单独的网络服务器。

2) SVN 旨在永久保存您的所有文件。[从存储库中完全删除东西是非常痛苦和耗时的](http://subversion.tigris.org/faq.html#removal)，这使得存储不需要存储的东西变得有问题。

我建议您只使用 Web 服务器来存储您的二进制文件。（SVN毕竟是一个网络服务器**）。在服务器上保留尽可能多的旧二进制文件并进行备份，但是一旦不再需要旧的无用二进制文件，您就可以删除它们。

** 是的，我知道它使用 DAV，因此它不仅仅是一个普通的旧网络服务器，而是从部署到生产机器的角度来看，这个过程是“我使用 http 从[http://blah](http://blah)下载一些文件”，所以它也可能是一个。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-12T19:27:19.610

不确定为什么不想将二进制文件放在 trunk/project1/binaries 树下？也就是说，没有什么可以阻止你让树看起来像这样：

*   树干
    *   项目1
    *   项目2
*   建成
    *   项目1
    *   项目2
*   标签
    *   项目1
    *   `<tag id`>
        *   `<code as usual`>
        *   二进制文件

# code-metrics - 代码度量的魅力是什么？

> ID：195887
> 
> 赞同：86
> 
> 时间：2008-10-12T19:23:37.837
> 
> 标签：code-metrics

我最近在 SO 上看到了许多与“代码指标”相关的问题，我想知道它的魅力是什么？以下是一些最近的例子：

*   [哪些代码指标让你相信提供的代码很糟糕](https://stackoverflow.com/questions/187289/what-code-metrics-convince-you-that-provided-code-is-crappy)
*   [代码行数何时是一个有用的指标](https://stackoverflow.com/questions/184071/when-if-ever-is-number-of-lines-of-code-a-useful-metric)
*   [编写质量测试](https://stackoverflow.com/questions/195856/writing-quality-tests)

不过，在我看来，没有任何指标可以替代代码审查：

*   某些指标有时可能表明需要审查的地方，并且
*   短期内指标的根本变化可能表明需要审查的地方

但是我想不出一个单独的指标本身总是指示“好”或“坏”代码 - 总是有例外和测量无法看到的事情的原因。

从我忽略的代码指标中是否有一些神奇的见解？懒惰的程序员/经理是否在寻找不阅读代码的借口？人们是否会看到巨大的遗留代码库并寻找起点？这是怎么回事？

> 注意：我已经在答案和评论中针对特定线程提出了其中一些问题，但没有得到任何回复，所以我认为我应该向整个社区提问，因为我可能遗漏了一些东西。运行一个指标批处理作业并且实际上不必再次阅读其他人的代码（或我自己的）会很好，我只是认为它不实用！

编辑：如果不是所有正在讨论的指标，我对大多数指标都很熟悉，我只是不认为它们的意义是孤立的，也不是任意的质量标准。

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2008-10-12T19:49:51.827

这个线程中的答案有点奇怪，因为他们谈到：

*   “团队”，如上述指标的“唯一受益者”；
*   “指标”，就像它们本身意味着什么一样。

1/ 指标不是针对*一个*人群，而是针对*三个*人群：

*   开发人员：他们关心关于代码静态分析的*瞬时* **静态代码指标**（圈复杂度、注释质量、行数……）
*   项目负责人：他们关心来自单元测试、代码覆盖率、持续集成测试的*日常* **实时代码指标**
*   业务发起人（他们总是被遗忘，但他们是利益相关者，是为开发买单的人）：他们关心*每周* 关于架构设计、安全性、依赖关系的**全球代码指标......**

当然，所有这三个群体都可以观察和分析所有这些指标，但每种指标都旨在为每个特定群体更好地使用。

2/ 指标本身就代表了代码的***快照***，这意味着……什么都没有！

正是这些指标的组合以及这些不同分析级别的组合可能表明代码“好”或“坏”，但更重要的是***，这些指标的趋势***是重要的。

这是那些将赋予真正附加值的指标的*重复*，因为它们将帮助业务经理/项目负责人/开发人员在不同的可能代码修复中***确定优先级***

* * *

换句话说，您关于“指标的魅力”的问题可能指的是：

*   “漂亮”的代码（尽管它总是在旁观者的眼中）
*   “好”代码（有效，并且可以证明它有效）

因此，例如，一个圈复杂度为 9 的函数可以被定义为“美丽的”，而不是一个圈复杂度为 42 的长卷积函数。

但是，如果：

*   后一个函数具有*稳定*的复杂性，*加上*95% 的代码覆盖率，
*   而前者的复杂性*越来越高，**而且*覆盖率... 0%，

有人可能会争辩说：

*   后者代表一个“*好*”的代码（它可以工作，它很稳定，如果需要更改，可以检查修改后是否仍然有效），
*   前者是一个“*糟糕*”的代码（它仍然需要添加一些案例和条件来覆盖它必须做的所有事情，并且没有简单的方法来进行一些回归测试）

* * *

所以，总结一下：

> 一个单一的指标，它本身总是表明 [...]

：不多，只是代码可能更“漂亮”，这本身并不意味着很多......

> 从我忽略的代码指标中是否有一些神奇的见解？

只有指标的*组合*和*趋势*才能提供您所追求的真正“神奇洞察力”。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-10-12T19:51:39.967

一个月前，我有一个项目，我作为一个人的工作来测量圈复杂度。那是我第一次接触这些指标。

我收到的第一份报告令人震惊。几乎我所有的功能都没有通过测试，即使是（恕我直言）非常简单的功能。我通过将逻辑子任务移动到子例程中来解决复杂性问题，即使它们只被调用一次。

对于另一半例程，我作为一名程序员的自豪感开始了，我尝试以它们相同的方式重写它们，只是更简单，更易读。这很奏效，我能够最大限度地降低客户的复杂性阈值。

最后，我几乎总能想出更好的解决方案和更简洁的代码。性能并没有因此受到影响（相信我——我对此很偏执，我经常检查编译器输出的反汇编）。

**如果您将指标用作改进代码的理由/动机，我认为指标是一件好事。不过，知道何时停止并请求违反指标的授权是很重要的。**

指标是指导和帮助，而不是目的本身。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2010-07-27T17:06:02.757

我用过的最好的指标是[CRAP 分数](http://www.artima.com/weblogs/viewpost.jsp?thread=215899)。

基本上，它是一种将加权圈复杂度与自动测试覆盖率进行比较的算法。该算法如下所示：`CRAP(m) = comp(m)^2 * (1 – cov(m)/100)^3 + comp(m)` 其中 comp(m) 是方法 m 的圈复杂度，cov(m) 是自动化测试提供的测试代码覆盖率。

上述文章的作者（请去阅读它......这非常值得你花时间）建议最高 CRAP 分数为 30，其分解方式如下：

```
Method’s Cyclomatic Complexity        % of coverage required to be
                                      below CRAPpy threshold
------------------------------        --------------------------------
0 – 5                                   0%
10                                     42%
15                                     57%
20                                     71%
25                                     80%
30                                    100%
31+                                   No amount of testing will keep methods
                                      this complex out of CRAP territory. 
```

正如您很快看到的那样，该指标奖励编写不复杂的代码以及良好的测试覆盖率（如果您正在编写单元测试，并且您应该并且没有测量覆盖率......好吧，您可能会喜欢随风而行以及）。;-)

对于我的大多数开发团队，我非常努力地使 CRAP 分数低于 8，但如果他们有正当理由证明增加的复杂性是可以接受的，只要他们通过足够的测试覆盖了复杂性。（编写复杂的代码总是很难测试......这个指标的一种隐藏的好处）。

大多数人一开始发现很难编写能够通过 CRAP 分数的代码。但随着时间的推移，他们编写了更好的代码，问题更少的代码，以及更容易调试的代码。在任何指标中，这是关注最少且收益最大的指标。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-10-12T21:36:57.897

对我来说，识别不良代码的最重要的指标是圈复杂度。我项目中的几乎所有方法都低于 CC 10，并且在 CC 超过 30 的旧方法中总是会发现错误。高 CC 通常表示：

*   匆忙编写的代码（即没有时间找到一个优雅的解决方案，而不是因为问题需要一个复杂的解决方案）
*   未经测试的代码（没有人为这种野兽编写测试）
*   多次修补和修复的代码（即充斥着 ifs 和 todo 注释）
*   重构的主要目标

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-10-12T19:42:15.727

好的代码审查不能代替好的静态分析工具，当然也不能代替好的单元测试，现在单元测试没有验收测试是不行的……

代码度量是放入工具箱的另一个工具，它们本身并不是解决方案，它们只是一个可以适当使用的工具（当然还有你工具箱中的所有其他工具！）。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-12T19:31:07.260

人们被以机械方式理解和描述代码的理念所吸引。如果属实，请考虑对效率和生产力的影响！

我同意“代码质量”的衡量标准与“优秀散文”的衡量标准一样合理。然而，这并不意味着指标是无用的，只是可能被滥用了。

例如，某些指标的*极端*值*指出了*可能出现的问题。1000 行长的方法*可能*无法维护。具有零单元测试代码覆盖率的代码*可能*比具有大量测试的类似代码具有更多错误。在发布之前添加到项目中的不是第三方库的代码的大幅跳跃*可能*会引起额外的关注。

我认为如果我们使用指标作为建议——一个危险信号——也许它们会很有用。问题是当人们开始用 SLOC 来衡量生产力或用测试线的百分比来衡量质量时。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-10-12T19:31:50.083

我高度主观的观点是，代码度量表达了对能够量化本质上无法量化的事物的不可抗拒的制度魅力。

在某种程度上，至少在心理上是有道理的——你怎么能对你无法评估或理解的事情做出决定？最终，当然，除非您对该主题很了解（并且至少与您要评估的内容一样好）或询问知识渊博的人，否则您无法评估质量，这当然只会让问题回归一步。

从这个意义上说，也许一个合理的类比是通过 SAT 分数来评估大学入学者，这是不公平的，并且会遗漏各种细微之处，但是如果您需要量化，就必须做点什么。

并不是说我认为这是一个很好的衡量标准，只是我可以看到它的直觉性不可抗拒性。而且，正如您所指出的，可能有一些合理的指标（很多 500+ 行方法，高复杂性 - 可能很糟糕）。不过，我从来没有去过一个买这个的地方。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-11-22T14:50:37.543

我相信一个代码指标。

我正在开发一个大系统。当我遇到一个新需求时，我开始着手编写代码。当我完成并解决了错误后，我将其签入版本控制系统。该系统会进行比较，并计算我所做的所有更改。

**这个数字越小越好。**

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-10-12T19:31:25.123

指标和自动化测试并不意味着要替代完整的代码审查。

他们只是加快速度。使用自动检查器，可以很容易地查看您忘记遵循哪些约定，您正在使用指定的包和方法等。您可以在不占用其他人时间的情况下查看可以修复的内容。

经理们也喜欢衡量他们，因为他们觉得他们得到了一个关于生产力的准确数字（尽管通常情况并非如此）并且他们应该能够更好地处理人们。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-10-12T19:32:19.100

测量仅在以下情况下才有用：

*   该团队开发了它们
*   团队同意他们
*   它们被用于识别特定区域

一般来说，任何不适合的指标都会受到团队优化的影响。您想测量代码行数吗？天哪，看看他们能写多少！你想测量代码覆盖率，天哪，看我覆盖那个代码！

我认为指标对于识别趋势很有用，事实上，我已经看到了一些有用的指标，例如绘制构建中断的时间、代码流失（整个项目中更改的代码行数）和其他东西。但是如果团队没有提出他们，或者他们不同意或不理解他们，那么你很可能会受到伤害。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2011-08-18T12:58:34.140

[这是来自stan4j](http://stan4j.com/)的一些复杂性指标。

一个eclipse类结构分析工具。

我喜欢这个工具和指标。我将指标视为统计数据、指标、警告消息。有时由于某些方法或某些类确实有一些复杂的逻辑使它们变得复杂，应该做的是密切关注它们，检查它们是否需要重构它们或仔细检查它们，由于通常他们很容易出错。我也用它作为分析工具来学习源代码，因为我喜欢从复杂到简单的学习。实际上它包括其他一些指标，如 Robert C. Martin Metrics、Chidamber & Kemerer Metrics、Count Metrics 但我最喜欢这个

**复杂性指标**

**圈复杂度度量**

**圈复杂度 (CC)** 方法的圈复杂度是方法的控制流图中的决策点数加一。决策点出现在 if/for/while 语句、case/catch 子句和类似的源代码元素中，其中控制流不仅仅是线性的。单个（源代码）语句引入的（字节代码）决策点的数量可能会有所不同，这取决于例如布尔表达式的复杂性。一个方法的圈复杂度值越高，测试该方法控制流图的所有分支所需的测试用例就越多。

**平均圈复杂度** 圈复杂度指标在应用程序、库、包树或包的所有方法上的平均值。

**Fat Metrics** 人工制品的脂肪量度是人工制品的适当依赖图中的边数。依赖图类型取决于度量变量和选择的工件：

**Fat** 应用程序、库或包树的 Fat 度量是其子树依赖图的边数。此图包含包树层次结构中的所有工件的子项，因此也包括叶包。（要在合成视图中查看适当的图表，必须禁用结构资源管理器的平面包切换。如果所选工件是库，则必须启用显示库切换，否则必须禁用。）

包的 Fat 度量是其单元依赖图的边数。该图包含包的所有顶级类。

一个类的 Fat 度量是它的成员图的边数。该图包含该类的所有字段、方法和成员类。（此图和 Fat 值仅在使用 Level of Detail 成员而不是 Class 执行代码分析时可用。）

**Fat for Library Dependencies (Fat - Libraries)** 应用程序的 Fat for Library Dependencies 度量是其库依赖图的边数。此图包含应用程序的所有库。（要在合成视图中查看适当的图表，必须启用结构浏览器的显示库切换。）

**Fat for Flat Package Dependencies (Fat - Packages)** 应用程序的 Fat for Flat Package Dependencies 度量是其平面包依赖图的边数。该图包含应用程序的所有包。（要在合成视图中查看适当的图表，必须启用结构资源管理器的平面包切换，并且必须禁用显示库切换。）

一个库的 Fat for Flat Package Dependencies 度量是它的平面包依赖图的边数。该图包含库的所有包。（要在合成视图中查看适当的图表，必须启用结构浏览器的平面包和显示库切换。）

**Fat for Top Level Class Dependencies (Fat - Units)** 应用程序或库的 Fat for Top Level Class Dependencies 度量是其单元依赖图的边数。该图包含应用程序或库的所有顶级类。（对于合理的应用程序，它太大而无法可视化，因此无法在组合视图中显示。单元依赖关系图可能仅显示为包。）

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-10-12T19:33:00.643

度量标准可能有助于确定项目的改进或降级，并且肯定可以发现样式和约定违规，但没有什么可以替代同行代码审查。没有它们，您不可能知道代码的质量。

哦……这假设您的代码审查中至少有一个参与者有线索。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-10-12T19:37:06.890

我同意你的观点，代码指标不应该代替代码审查，但我相信它们应该补充代码审查。我认为这又回到了那句老话“你无法改进你无法衡量的东西”。代码度量可以为开发团队提供可量化的“代码气味”或可能需要进一步调查的模式。大多数静态分析工具中捕获的指标通常是在我们领域的短暂历史中的研究过程中确定的具有重要意义的指标。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-10-12T19:42:57.690

指标不能代替代码审查，但要便宜得多。它们比什么都重要。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-10-12T21:02:36.670

部分答案是，一些代码指标可以让您快速、初步地回答以下问题：这段代码是什么样的？

甚至“代码行”也可以让您了解您正在查看的代码库的大小。

正如另一个答案中提到的，指标的趋势为您提供了最多的信息。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-10-12T22:58:01.133

指标本身并不是特别有趣。重要的是你对他们所做的事情。

例如，如果您正在测量每行代码的评论数，您认为什么是好的值？谁知道？或者更重要的是，每个人都有自己的看法。

现在，如果您收集了足够的信息，以便能够将每行代码的注释数量与解决错误所需的时间或发现的归因于编码的错误数量相关联，那么您可能会开始找到一个经验上有用的数字.

在软件中使用度量和在任何其他过程中使用任何其他性能度量之间没有区别——首先测量，然后分析，然后改进过程。如果你所做的只是测量，那你就是在浪费时间。

编辑：回应 Steven A. Lowe 的评论 - 这是绝对正确的。在任何数据分析中，都必须小心区分因果关系和单纯的相关性。根据适用性选择指标很重要。尝试衡量咖啡消费量和归因代码质量是没有意义的（尽管我确信有些人已经尝试过；-)）

但在找到关系（因果关系或非因果关系）之前，您必须拥有数据。

要收集的数据的选择基于您希望验证或改进的过程。例如，如果您尝试分析代码审查程序的成功（使用您自己的“成功”定义，减少错误或减少编码错误，或缩短周转时间等），那么您选择衡量的指标错误的总比率和审查代码中的错误率。

所以在你收集数据之前，你必须知道你想用它做什么。如果指标是手段，目的是什么？

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-11-22T15:22:13.907

我不认为指标的微小变化是有意义的：复杂度为 20 的函数不一定比复杂度为 30 的函数更干净。但运行指标以寻找较大的差异是值得的。

有一次我调查了几十个项目，其中一个项目的最大复杂度值约为 6,000，而其他所有项目的最大复杂度值约为 100 或更低。这就像棒球棒一样击中了我的头。显然，该项目正在进行一些不寻常的，并且可能是坏事。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-10-12T21:40:02.070

我们是程序员。我们喜欢数字。

另外，您要做什么，而不是描述代码库的大小，因为“代码行数无关紧要”？

举个愚蠢的例子，150 行代码库和 1.5 亿行代码库之间肯定存在差异。这不是一个很难得到的数字。

# java - java连接到jabber

> ID：195911
> 
> 赞同：0
> 
> 时间：2008-10-12T19:37:17.497
> 
> 标签：java, sockets, stream, xmpp

我需要使用什么类型的流通过 tcp 套接字向 jabber 写入连接请求消息。我正在写一个 xml 格式的字符串。它应该与默认套接字流或数据输出流一起使用，但它没有。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-12T22:24:39.440

使用[Smack](http://www.igniterealtime.org/projects/smack/index.jsp)客户端库连接到 Jabber 服务器，例如 OpenFire。它使用起来非常简单，您可以在几行代码中连接和发送/接收消息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T20:00:22.133

您可能想尝试 Openfire（以前称为 Wildfire）。它使用唯一被广泛采用的即时消息传递开放协议 XMPP（也称为 Jabber）。

看看[这里](http://www.igniterealtime.org/projects/openfire/index.jsp)或[这里的来源](http://www.igniterealtime.org/downloads/source.jsp)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-12T20:06:15.880

Jabber 是一个非常全面的协议，所以我不认为它真的类似于打开流。另一方面，它是一个非常受支持的协议，因此您可以选择库来提供帮助。这是[jabber.org](http://www.jabber.org/web/Libraries#Java)上相关信息的链接。

# wix - 卸载 WiX 时删除文件

> ID：195919
> 
> 赞同：89
> 
> 时间：2008-10-12T19:41:29.113
> 
> 标签：wix, installation, windows-installer, custom-action

卸载我的应用程序时，我想配置[Wix设置以删除](http://en.wikipedia.org/wiki/WiX)**原始安装后**添加的所有文件。似乎卸载程序仅删除了最初从 MSI 文件安装的目录和文件，而将后来添加的所有其他内容保留在应用程序文件夹中。换句话说，我想在卸载时清除目录。我怎么做？

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2008-10-12T21:38:42.043

使用带有 On=" **uninstall " 的**[RemoveFile 元素](http://wixtoolset.org/documentation/manual/v3/xsd/wix/removefile.html)。这是一个例子：

 **```
<Directory Id="CommonAppDataFolder" Name="CommonAppDataFolder">
  <Directory Id="MyAppFolder" Name="My">
    <Component Id="MyAppFolder" Guid="*">
      <CreateFolder />
      <RemoveFile Id="PurgeAppFolder" Name="*.*" On="uninstall" />
    </Component>
  </Directory>
</Directory> 
```

**更新**

> 它没有 100% 有效。它删除了文件，但是没有删除任何附加目录（安装后创建的目录）。对此有什么想法吗？– 普里贝罗

不幸的是，Windows Installer 不支持删除带有子目录的目录。在这种情况下，您必须诉诸自定义操作。或者，如果您知道子文件夹是什么，请创建一堆 RemoveFolder 和 RemoveFile 元素。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2012-05-07T06:20:33.780

在 WiX 中使用[**`RemoveFolderEx`**](http://wix.sourceforge.net/manual-wix3/util_xsd_removefolderex.htm)Util 扩展中的元素。
使用这种方法，所有子目录也被删除（而不是直接[使用`RemoveFile`element](https://stackoverflow.com/a/196149/572834)）。此元素将临时行添加到MSI 数据库中`RemoveFile`的`RemoveFolder`表。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-11-06T21:39:41.177

为此，我只是创建了一个在卸载时调用的自定义操作。

WiX 代码将如下所示：

```
<Binary Id="InstallUtil" src="InstallUtilLib.dll" />

<CustomAction Id="DIRCA_TARGETDIR" Return="check" Execute="firstSequence" Property="TARGETDIR" Value="[ProgramFilesFolder][Manufacturer]\[ProductName]" />
<CustomAction Id="Uninstall" BinaryKey="InstallUtil" DllEntry="ManagedInstall" Execute="deferred" />
<CustomAction Id="UninstallSetProp" Property="Uninstall" Value="/installtype=notransaction /action=uninstall /LogFile= /targetDir=&quot;[TARGETDIR]\Bin&quot; &quot;[#InstallerCustomActionsDLL]&quot; &quot;[#InstallerCustomActionsDLLCONFIG]&quot;" />

<Directory Id="BinFolder" Name="Bin" >
    <Component Id="InstallerCustomActions" Guid="*">
        <File Id="InstallerCustomActionsDLL" Name="SetupCA.dll" LongName="InstallerCustomActions.dll" src="InstallerCustomActions.dll" Vital="yes" KeyPath="yes" DiskId="1" Compressed="no" />
        <File Id="InstallerCustomActionsDLLCONFIG" Name="SetupCA.con" LongName="InstallerCustomActions.dll.Config" src="InstallerCustomActions.dll.Config" Vital="yes" DiskId="1" />
    </Component>
</Directory>

<Feature Id="Complete" Level="1" ConfigurableDirectory="TARGETDIR">
    <ComponentRef Id="InstallerCustomActions" />
</Feature>

<InstallExecuteSequence>
    <Custom Action="UninstallSetProp" After="MsiUnpublishAssemblies">$InstallerCustomActions=2</Custom>
    <Custom Action="Uninstall" After="UninstallSetProp">$InstallerCustomActions=2</Custom>
</InstallExecuteSequence> 
```

InstallerCustomActions.DLL 中 OnBeforeUninstall 方法的代码将如下所示（在 VB 中）。

```
Protected Overrides Sub OnBeforeUninstall(ByVal savedState As System.Collections.IDictionary)
    MyBase.OnBeforeUninstall(savedState)

    Try
        Dim CommonAppData As String = Me.Context.Parameters("CommonAppData")
        If CommonAppData.StartsWith("\") And Not CommonAppData.StartsWith("\\") Then
            CommonAppData = "\" + CommonAppData
        End If
        Dim targetDir As String = Me.Context.Parameters("targetDir")
        If targetDir.StartsWith("\") And Not targetDir.StartsWith("\\") Then
            targetDir = "\" + targetDir
        End If

        DeleteFile("<filename.extension>", targetDir) 'delete from bin directory
        DeleteDirectory("*.*", "<DirectoryName>") 'delete any extra directories created by program
    Catch
    End Try
End Sub

Private Sub DeleteFile(ByVal searchPattern As String, ByVal deleteDir As String)
    Try
        For Each fileName As String In Directory.GetFiles(deleteDir, searchPattern)
            File.Delete(fileName)
        Next
    Catch
    End Try
End Sub

Private Sub DeleteDirectory(ByVal searchPattern As String, ByVal deleteDir As String)
    Try
        For Each dirName As String In Directory.GetDirectories(deleteDir, searchPattern)
            Directory.Delete(dirName)
        Next
    Catch
    End Try
End Sub 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2013-07-07T15:37:38.990

这是@tronda 建议的变体。我正在删除在卸载期间由另一个自定义操作创建的文件“install.log”：

```
<Product>
    <CustomAction Id="Cleanup_logfile" Directory="INSTALLFOLDER"
    ExeCommand="cmd /C &quot;del install.log&quot;"
    Execute="deferred" Return="ignore" HideTarget="no" Impersonate="no" />

    <InstallExecuteSequence>
      <Custom Action="Cleanup_logfile" Before="RemoveFiles" >
        REMOVE="ALL"
      </Custom>
    </InstallExecuteSequence>
</Product> 
```

据我了解，我不能使用“RemoveFile”，因为该文件是在安装后创建的，而不是组件组的一部分。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2015-11-16T13:16:55.667

[对于@Pavel](https://stackoverflow.com/a/196149/2069294)的建议，这将是一个更完整的答案，对我来说它 100% 有效：

```
<Fragment Id="FolderUninstall">
    <?define RegDir="SYSTEM\ControlSet001\services\[Manufacturer]:[ProductName]"?>
    <?define RegValueName="InstallDir"?>
    <Property Id="INSTALLFOLDER">
        <RegistrySearch Root="HKLM" Key="$(var.RegDir)" Type="raw" 
                  Id="APPLICATIONFOLDER_REGSEARCH" Name="$(var.RegValueName)" />
    </Property>

    <DirectoryRef Id='INSTALLFOLDER'>
        <Component Id="UninstallFolder" Guid="*">
            <CreateFolder Directory="INSTALLFOLDER"/>
            <util:RemoveFolderEx Property="INSTALLFOLDER" On="uninstall"/>
            <RemoveFolder Id="INSTALLFOLDER" On="uninstall"/>
            <RegistryValue Root="HKLM" Key="$(var.RegDir)" Name="$(var.RegValueName)" 
                    Type="string" Value="[INSTALLFOLDER]" KeyPath="yes"/>
        </Component>
    </DirectoryRef>
</Fragment> 
```

并且，在产品元素下：

```
<Feature Id="Uninstall">
    <ComponentRef Id="UninstallFolder" Primary="yes"/>
</Feature> 
```

此方法使用要在卸载时删除的文件夹的所需路径设置注册表值。最后，从系统中删除 INSTALLFOLDER 和注册表文件夹。请注意，注册表的路径可以位于其他配置单元和其他位置。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2010-02-02T12:47:31.973

不是 WIX 专家，但可能的（更简单的？）解决方案是运行作为WIX 内置扩展的一部分的[安静执行自定义操作？](http://wix.sourceforge.net/manual-wix3/qtexec.htm)

可以使用 /S 和 /Q 选项 运行[rmdir MS DOS 命令。](http://www.computerhope.com/rmdirhlp.htm)

```
<Binary Id="CommandPrompt" SourceFile="C:\Windows\System32\cmd.exe" /> 
```

完成这项工作的自定义操作很简单：

```
<CustomAction Id="DeleteFolder" BinaryKey="CommandPrompt" 
              ExeCommand='/c rmdir /S /Q "[CommonAppDataFolder]MyAppFolder\PurgeAppFolder"' 
              Execute="immediate" Return="check" /> 
```

然后你必须修改 InstallExecuteSequence 作为记录的许多地方。

**更新：** 这种方法有问题。最终改为制作自定义任务，但仍然认为这是一个可行的解决方案，但没有让细节起作用。

# javascript - 如何使用 JavaScript 更改元素的类？

> ID：195951
> 
> 赞同：3153
> 
> 时间：2008-10-12T20:06:43.663
> 
> 标签：javascript, html, dom

如何更改 HTML 元素的类以响应`onclick`使用 JavaScript 的事件或任何其他事件？

* * *

## 回答 #1

> 赞同：4323
> 
> 时间：2008-10-12T20:45:36.347

## 用于更改类的现代 HTML5 技术

现代浏览器添加了[**classList**](https://developer.mozilla.org/en-US/docs/DOM/element.classList)，它提供了一些方法，可以更轻松地操作类，而无需库：

```
document.getElementById("MyElement").classList.add('MyClass');

document.getElementById("MyElement").classList.remove('MyClass');

if ( document.getElementById("MyElement").classList.contains('MyClass') )

document.getElementById("MyElement").classList.toggle('MyClass'); 
```

不幸的是，这些在 v10 之前的 Internet Explorer 中不起作用，尽管有一个[shim](http://en.wikipedia.org/wiki/Shim_(computing))可以为 IE8 和 IE9 添加对它的支持，可以从[这个页面](https://developer.mozilla.org/en-US/docs/DOM/element.classList)获得。不过，它得到了越来越多的[支持](http://caniuse.com/#feat=classlist)。

## 简单的跨浏览器解决方案

选择元素的标准 JavaScript 方式是 using [`document.getElementById("Id")`](https://developer.mozilla.org/en-US/docs/DOM/document.getElementById)，这就是以下示例所使用的方式 - 您当然可以通过其他方式获取元素，并且在正确的情况下可以简单地使用`this`- 但是，对此进行详细说明超出了范围的答案。

### 要更改元素的所有类：

要将所有现有类替换为一个或多个新类，请设置 className 属性：

```
document.getElementById("MyElement").className = "MyClass"; 
```

（您可以使用空格分隔的列表来应用多个类。）

### 向元素添加附加类：

要将类添加到元素，而不删除/影响现有值，请附加一个空格和新的类名，如下所示：

```
document.getElementById("MyElement").className += " MyClass"; 
```

### 从元素中删除一个类：

要将单个类删除到元素，而不影响其他潜在类，需要简单的正则表达式替换：

```
document.getElementById("MyElement").className =
   document.getElementById("MyElement").className.replace
      ( /(?:^|\s)MyClass(?!\S)/g , '' )
/* Code wrapped for readability - above is all one statement */ 
```

这个正则表达式的解释如下：

```
(?:^|\s) # Match the start of the string or any single whitespace character

MyClass  # The literal text for the classname to remove

(?!\S)   # Negative lookahead to verify the above is the whole classname
         # Ensures there is no non-space character following
         # (i.e. must be the end of the string or space) 
```

该`g`标志告诉替换根据需要重复，以防类名已被多次添加。

### 要检查一个类是否已经应用于一个元素：

上面用于删除类的相同正则表达式也可以用作检查特定类是否存在：

```
if ( document.getElementById("MyElement").className.match(/(?:^|\s)MyClass(?!\S)/) ) 
```

### 将这些操作分配给 onclick 事件：

虽然可以直接在 HTML 事件属性（例如`onclick="this.className+=' MyClass'"`）中编写 JavaScript，但不建议这样做。尤其是在较大的应用程序中，通过将 HTML 标记与 JavaScript 交互逻辑分离来实现更可维护的代码。

实现这一点的第一步是创建一个函数，并在 onclick 属性中调用该函数，例如：

```
<script type="text/javascript">
    function changeClass(){
        // Code examples from above
    }
</script>
...
<button onclick="changeClass()">My Button</button> 
```

[*（脚本标签中不需要此代码，这只是为了简化示例，将 JavaScript 包含在不同的文件中可能更合适。）*]

第二步是将 onclick 事件从 HTML 移到 JavaScript 中，例如使用[addEventListener](https://developer.mozilla.org/en-US/docs/DOM/element.addEventListener)

```
<script type="text/javascript">
    function changeClass(){
        // Code examples from above
    }

    window.onload = function(){
        document.getElementById("MyElement").addEventListener( 'click', changeClass);
    }
</script>
...
<button id="MyElement">My Button</button> 
```

（请注意，window.onload 部分是必需的，以便在 HTML 完成加载*后*执行该函数的内容- 没有这个，在调用 JavaScript 代码时 MyElement 可能不存在，因此该行将失败。）

## JavaScript 框架和库

上面的代码都是标准的 JavaScript，但是，通常的做法是使用框架或库来简化常见任务，并从编写代码时可能不会想到的固定错误和边缘情况中受益。

虽然有些人认为添加一个大约 50 KB 的框架来简单地更改一个类是过度的，但如果您正在做大量的 JavaScript 工作或任何可能具有不寻常的跨浏览器行为的事情，那么值得考虑。

*（非常粗略地说，库是为特定任务设计的一组工具，而框架通常包含多个库并执行一套完整的职责。）*

上面的示例已在下面使用[jQuery](http://jquery.com)进行了复制，这可能是最常用的 JavaScript 库（尽管还有其他值得研究的库）。

（注意`$`这里是 jQuery 对象。）

### 使用 jQuery 更改类：

```
$('#MyElement').addClass('MyClass');

$('#MyElement').removeClass('MyClass');

if ( $('#MyElement').hasClass('MyClass') ) 
```

此外，jQuery 提供了一个快捷方式来添加一个不适用的类，或者删除一个适用的类：

```
$('#MyElement').toggleClass('MyClass'); 
```

### 使用 jQuery 将函数分配给单击事件：

```
$('#MyElement').click(changeClass); 
```

或者，不需要 id：

```
$(':button:contains(My Button)').click(changeClass); 
```

* * *

## 回答 #2

> 赞同：461
> 
> 时间：2011-08-05T17:44:12.403

你也可以这样做：

```
document.getElementById('id').classList.add('class');
document.getElementById('id').classList.remove('class'); 
```

并切换一个类（如果存在则删除，否则添加它）：

```
document.getElementById('id').classList.toggle('class'); 
```

* * *

## 回答 #3

> 赞同：137
> 
> 时间：2011-05-28T07:32:53.030

在我的一个不使用 jQuery 的旧项目中，我构建了以下函数来添加、删除和检查元素是否具有类：

```
function hasClass(ele, cls) {
    return ele.className.match(new RegExp('(\\s|^)' + cls + '(\\s|$)'));
}

function addClass(ele, cls) {
    if (!hasClass(ele, cls))
        ele.className += " " + cls;
}

function removeClass(ele, cls) {
    if (hasClass(ele, cls)) {
        var reg = new RegExp('(\\s|^)' + cls + '(\\s|$)');
        ele.className = ele.className.replace(reg, ' ');
    }
} 
```

因此，例如，如果我想`onclick`向按钮添加一些类，我可以使用它：

```
<script type="text/javascript">
    function changeClass(btn, cls) {
        if(!hasClass(btn, cls)) {
            addClass(btn, cls);
        }
    }
</script>
...
<button onclick="changeClass(this, "someClass")">My Button</button> 
```

现在可以肯定的是，使用 jQuery 会更好。

* * *

## 回答 #4

> 赞同：92
> 
> 时间：2008-10-12T20:33:06.183

你可以`node.className`这样使用：

```
document.getElementById('foo').className = 'bar'; 
```

根据[PPK](http://quirksmode.org/dom/w3c_html.html) ，这应该在[Internet Explorer 5.5](https://en.wikipedia.org/wiki/Internet_Explorer_5#Versions)及更高版本中工作。

* * *

## 回答 #5

> 赞同：57
> 
> 时间：2012-01-05T19:14:01.220

哇，很惊讶这里有这么多矫枉过正的答案......

```
<div class="firstClass" onclick="this.className='secondClass'"> 
```

* * *

## 回答 #6

> 赞同：56
> 
> 时间：2011-09-20T15:26:08.343

使用纯 JavaScript 代码：

```
function hasClass(ele, cls) {
    return ele.className.match(new RegExp('(\\s|^)' + cls + '(\\s|$)'));
}

function addClass(ele, cls) {
    if (!this.hasClass(ele, cls)) ele.className += " " + cls;
}

function removeClass(ele, cls) {
    if (hasClass(ele, cls)) {
        var reg = new RegExp('(\\s|^)' + cls + '(\\s|$)');
        ele.className = ele.className.replace(reg, ' ');
    }
}

function replaceClass(ele, oldClass, newClass){
    if(hasClass(ele, oldClass)){
        removeClass(ele, oldClass);
        addClass(ele, newClass);
    }
    return;
}

function toggleClass(ele, cls1, cls2){
    if(hasClass(ele, cls1)){
        replaceClass(ele, cls1, cls2);
    }else if(hasClass(ele, cls2)){
        replaceClass(ele, cls2, cls1);
    }else{
        addClass(ele, cls1);
    }
} 
```

* * *

## 回答 #7

> 赞同：38
> 
> 时间：2011-12-08T09:36:57.080

这对我有用：

```
function setCSS(eleID) {
    var currTabElem = document.getElementById(eleID);

    currTabElem.setAttribute("class", "some_class_name");
    currTabElem.setAttribute("className", "some_class_name");
} 
```

* * *

## 回答 #8

> 赞同：26
> 
> 时间：2013-04-11T10:13:36.747

您也可以扩展 HTMLElement 对象，以添加方法来添加、删除、切换和检查类 ( [gist](https://gist.github.com/Maksims/5356227) )：

```
HTMLElement = typeof(HTMLElement) != 'undefiend' ? HTMLElement : Element;

HTMLElement.prototype.addClass = function(string) {
  if (!(string instanceof Array)) {
    string = string.split(' ');
  }
  for(var i = 0, len = string.length; i < len; ++i) {
    if (string[i] && !new RegExp('(\\s+|^)' + string[i] + '(\\s+|$)').test(this.className)) {
      this.className = this.className.trim() + ' ' + string[i];
    }
  }
}

HTMLElement.prototype.removeClass = function(string) {
  if (!(string instanceof Array)) {
    string = string.split(' ');
  }
  for(var i = 0, len = string.length; i < len; ++i) {
    this.className = this.className.replace(new RegExp('(\\s+|^)' + string[i] + '(\\s+|$)'), ' ').trim();
  }
}

HTMLElement.prototype.toggleClass = function(string) {
  if (string) {
    if (new RegExp('(\\s+|^)' + string + '(\\s+|$)').test(this.className)) {
      this.className = this.className.replace(new RegExp('(\\s+|^)' + string + '(\\s+|$)'), ' ').trim();
    } else {
      this.className = this.className.trim() + ' ' + string;
    }
  }
}

HTMLElement.prototype.hasClass = function(string) {
  return string && new RegExp('(\\s+|^)' + string + '(\\s+|$)').test(this.className);
} 
```

然后像这样使用（单击将添加或删除类）：

```
document.getElementById('yourElementId').onclick = function() {
  this.toggleClass('active');
} 
```

这是[演示](http://jsfiddle.net/5QMgR/)。

* * *

## 回答 #9

> 赞同：23
> 
> 时间：2011-11-26T21:04:12.050

只是添加来自另一个流行框架的信息，谷歌闭包，查看他们的[dom/classes](http://closure-library.googlecode.com/svn/docs/closure_goog_dom_classes.js.html)类：

```
goog.dom.classes.add(element, var_args)

goog.dom.classes.addRemove(element, classesToRemove, classesToAdd)

goog.dom.classes.remove(element, var_args) 
```

选择元素的一种方法是使用带有 CSS 3 选择器的[goog.dom.query ：](http://closure-library.googlecode.com/svn/docs/closure_third_party_closure_goog_dojo_dom_query.js.html)

```
var myElement = goog.dom.query("#MyElement")[0]; 
```

* * *

## 回答 #10

> 赞同：20
> 
> 时间：2012-05-02T04:59:17.043

对以前的正则表达式的一些小注释和调整：

如果类列表中的类名不止一次，您需要在全局范围内执行此操作。而且，您可能希望从类列表的末尾去除空格并将多个空格转换为一个空格，以防止出现空格。如果使用类名的唯一代码使用下面的正则表达式并在添加之前删除名称，那么这些事情都不会成为问题。但。好吧，谁知道谁可能会在班级名单上大吃一惊。

此正则表达式不区分大小写，因此在代码用于不关心类名大小写的浏览器之前，类名中的错误可能会出现。

```
var s = "testing   one   four  one  two";
var cls = "one";
var rg          = new RegExp("(^|\\s+)" + cls + "(\\s+|$)", 'ig');
alert("[" + s.replace(rg, ' ') + "]");
var cls = "test";
var rg          = new RegExp("(^|\\s+)" + cls + "(\\s+|$)", 'ig');
alert("[" + s.replace(rg, ' ') + "]");
var cls = "testing";
var rg          = new RegExp("(^|\\s+)" + cls + "(\\s+|$)", 'ig');
alert("[" + s.replace(rg, ' ') + "]");
var cls = "tWo";
var rg          = new RegExp("(^|\\s+)" + cls + "(\\s+|$)", 'ig');
alert("[" + s.replace(rg, ' ') + "]"); 
```

* * *

## 回答 #11

> 赞同：20
> 
> 时间：2021-09-05T04:50:25.137

# 可能的 4 种操作：添加、删除、检查和切换

让我们看看每个动作的多种方式。

## 1.[添加类](https://www.tutorialstonight.com/javascript-add-class.php)

**方法1：**在现代浏览器中添加类的最佳方法是使用`classList.add()`元素方法。

*   **案例1**：添加单个类

    ```
    function addClass() {
      let element = document.getElementById('id1');

      // adding class
      element.classList.add('beautify');
    } 
    ```

*   **案例2**：添加多个类

    `add()`在方法中通过逗号添加多个类

    ```
    function addClass() {
      let element = document.getElementById('id1');

      // adding multiple class
      element.classList.add('class1', 'class2', 'class3');
    } 
    ```

**方法 2** - 您还可以使用`className`属性向 HTML 元素添加类。

*   **案例 1**：覆盖预先存在的类 当您为`className`属性分配一个新类时，它会覆盖以前的类。

    ```
    function addClass() {
      let element = document.getElementById('id1');

      // adding multiple class
      element.className = 'beautify';
    } 
    ```

*   **案例2**：添加类而不覆盖使用`+=`类的运算符不覆盖以前的类。还要在新课前添加一个额外的空间。

    ```
    function addClass() {
      let element = document.getElementById('id1');

      // adding single multiple class
      element.className += ' beautify';
      // adding multiple classes
      element.className += ' class1 class2 class3';
    } 
    ```

* * *

## 2.[删除类](https://www.tutorialstonight.com/javascript-remove-class.php)

**方法 1** - 从元素中删除类的最佳方法是`classList.remove()`方法。

*   **案例1**：删除单个类

    只需传递要从方法中的元素中删除的类名。

    ```
    function removeClass() {
      let element = document.getElementById('id1');

      // removing class
      element.classList.remove('beautify');
    } 
    ```

*   **案例2**：删除多个类

    传递多个用逗号分隔的类。

    ```
    function removeClass() {
      let element = document.getElementById('id1');

      // removing class
      element.classList.remove('class1', 'class2', 'class3');
    } 
    ```

**方法 2** - 您也可以使用`className`方法删除类。

*   **案例 1**：删除单个类 如果元素只有 1 个类并且您想删除它，那么只需为该`className`方法分配一个空字符串。

    ```
    function removeClass() {
      let element = document.getElementById('id1');

      // removing class
      element.className = '';
    } 
    ```

*   **案例2**：删除多个类如果元素有多个类，首先使用`className`属性从元素中获取所有类，然后使用replace方法并用空字符串替换所需的类，最后将其分配给元素的`className`属性。

    ```
    function removeClass() {
      let element = document.getElementById('id1');

      // removing class
      element.className = element.className.replace('class1', '');
    } 
    ```

* * *

## 3.检查类

要检查元素中是否存在类，您可以简单地使用**`classList.contains()`**方法。如果类存在则返回`true`，否则返回 false。

```
function checkClass() {
  let element = document.getElementById('id1');

  // checking class
  if(element.contains('beautify') {
      alert('Yes! class exists');
  }
} 
```

* * *

## 4.切换类

切换类使用**`classList.toggle()`**方法。

```
function toggleClass() {
    let element = document.getElementById('id1');

    // toggle class
    element.toggle('beautify');
} 
```

参考：[今晚教程](https://www.tutorialstonight.com/)

* * *

## 回答 #12

> 赞同：19
> 
> 时间：2011-05-28T07:19:25.137

[在ASP.NET](http://en.wikipedia.org/wiki/ASP.NET)中使用 JavaScript 更改元素的 CSS 类：

```
Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load
    If Not Page.IsPostBack Then
        lbSave.Attributes.Add("onmouseover", "this.className = 'LinkButtonStyle1'")
        lbSave.Attributes.Add("onmouseout", "this.className = 'LinkButtonStyle'")
        lbCancel.Attributes.Add("onmouseover", "this.className = 'LinkButtonStyle1'")
        lbCancel.Attributes.Add("onmouseout", "this.className = 'LinkButtonStyle'")
    End If
End Sub 
```

* * *

## 回答 #13

> 赞同：17
> 
> 时间：2012-05-05T02:46:22.807

我会使用 jQuery 并编写如下内容：

```
jQuery(function($) {
    $("#some-element").click(function() {
        $(this).toggleClass("clicked");
    });
}); 
```

**此代码添加了一个在单击 id some-element**的元素时要调用的函数。如果它还不是元素的一部分，则该函数将**clicked**附加到元素的 class 属性，如果它在那里，则将其删除。

是的，您确实需要在页面中添加对 jQuery 库的引用才能使用此代码，但至少您可以确信该库中的大多数功能几乎可以在所有现代浏览器上运行，并且可以节省您的时间实现你自己的代码来做同样的事情。

* * *

## 回答 #14

> 赞同：16
> 
> 时间：2009-12-08T22:15:12.453

线

```
document.getElementById("MyElement").className = document.getElementById("MyElement").className.replace(/\bMyClass\b/','') 
```

应该：

```
document.getElementById("MyElement").className = document.getElementById("MyElement").className.replace('/\bMyClass\b/',''); 
```

* * *

## 回答 #15

> 赞同：15
> 
> 时间：2015-11-04T17:57:07.750

# 在支持 Internet Explorer 6 的原生 JavaScript 中更改元素的类

您可以尝试使用 node`attributes`属性来保持与旧浏览器的兼容性，甚至 Internet Explorer 6：

```
function getClassNode(element) {
  for (var i = element.attributes.length; i--;)
    if (element.attributes[i].nodeName === 'class')
      return element.attributes[i];
}

function removeClass(classNode, className) {
  var index, classList = classNode.value.split(' ');
  if ((index = classList.indexOf(className)) > -1) {
    classList.splice(index, 1);
    classNode.value = classList.join(' ');
  }
}

function hasClass(classNode, className) {
  return classNode.value.indexOf(className) > -1;
}

function addClass(classNode, className) {
  if (!hasClass(classNode, className))
    classNode.value += ' ' + className;
}

document.getElementById('message').addEventListener('click', function() {
  var classNode = getClassNode(this);
  var className = hasClass(classNode, 'red') && 'blue' || 'red';

  removeClass(classNode, 'red');
  removeClass(classNode, 'blue');

  addClass(classNode, className);
})
```

```
.red {
  color: red;
}
.red:before {
  content: 'I am red! ';
}
.red:after {
  content: ' again';
}
.blue {
  color: blue;
}
.blue:before {
  content: 'I am blue! '
}
```

```
<span id="message" class="">Click me</span>
```

* * *

## 回答 #16

> 赞同：12
> 
> 时间：2012-10-17T12:21:20.180

这是我的版本，可以正常工作：

```
function addHTMLClass(item, classname) {
    var obj = item
    if (typeof item=="string") {
        obj = document.getElementById(item)
    }
    obj.className += " " + classname
}

function removeHTMLClass(item, classname) {
    var obj = item
    if (typeof item=="string") {
        obj = document.getElementById(item)
    }
    var classes = ""+obj.className
    while (classes.indexOf(classname)>-1) {
        classes = classes.replace (classname, "")
    }
    obj.className = classes
} 
```

用法：

```
<tr onmouseover='addHTMLClass(this,"clsSelected")'
onmouseout='removeHTMLClass(this,"clsSelected")' > 
```

* * *

## 回答 #17

> 赞同：12
> 
> 时间：2015-10-28T07:00:21.423

这是一个toggleClass，用于切换/添加/删除元素上的类：

```
// If newState is provided add/remove theClass accordingly, otherwise toggle theClass
function toggleClass(elem, theClass, newState) {
    var matchRegExp = new RegExp('(?:^|\\s)' + theClass + '(?!\\S)', 'g');
    var add=(arguments.length>2 ? newState : (elem.className.match(matchRegExp) == null));

    elem.className=elem.className.replace(matchRegExp, ''); // clear all
    if (add) elem.className += ' ' + theClass;
} 
```

请参阅[JSFiddle](https://jsfiddle.net/dLuhp9se/)。

[另请参阅我在此处](https://stackoverflow.com/a/42941303/460084)动态创建新类的答案。

* * *

## 回答 #18

> 赞同：10
> 
> 时间：2014-01-18T09:28:05.560

我在我的代码中使用了以下 vanilla JavaScript 函数。它们使用正则表达式，`indexOf`但不需要在正则表达式中引用特殊字符。

```
function addClass(el, cn) {
    var c0 = (" " + el.className + " ").replace(/\s+/g, " "),
        c1 = (" " + cn + " ").replace(/\s+/g, " ");
    if (c0.indexOf(c1) < 0) {
        el.className = (c0 + c1).replace(/\s+/g, " ").replace(/^ | $/g, "");
    }
}

function delClass(el, cn) {
    var c0 = (" " + el.className + " ").replace(/\s+/g, " "),
        c1 = (" " + cn + " ").replace(/\s+/g, " ");
    if (c0.indexOf(c1) >= 0) {
        el.className = c0.replace(c1, " ").replace(/\s+/g, " ").replace(/^ | $/g, "");
    }
} 
```

您还可以在现代浏览器中使用[element.classList 。](https://developer.mozilla.org/en-US/docs/Web/API/Element.classList)

* * *

## 回答 #19

> 赞同：7
> 
> 时间：2020-05-03T23:05:38.597

OP 问题是*如何使用 JavaScript 更改元素的类？*

**现代浏览器允许你用一行 JavaScript**做到这一点：

`document.getElementById('id').classList.replace('span1', 'span2')`

该`classList`属性提供了一个具有[多种方法](https://developer.mozilla.org/en-US/docs/Web/API/DOMTokenList)的 DOMTokenList 。*您可以使用add()*、*remove()*或*replace()*等简单操作对元素的 classList 进行操作。*或者像使用keys()*、*values()*和*entries()*的对象或 Map 一样获得非常复杂和操作类。

[Peter Boughton 的回答](https://stackoverflow.com/questions/195951/how-can-i-change-an-elements-class-with-javascript/196038#196038)很好，但现在已经有十多年的历史了。所有现代浏览器现在都支持 DOMTokenList - 请参阅[https://caniuse.com/#search=classList](https://caniuse.com/#search=classList)，甚至[Internet Explorer 11](https://en.wikipedia.org/wiki/Internet_Explorer_11#Internet_Explorer_11)也支持一些 DOMTokenList 方法。

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2019-04-14T10:51:42.480

尝试：

```
element.className='second' 
```

```
function change(box) { box.className='second' }
```

```
.first  { width:  70px; height:  70px; background: #ff0                 }
.second { width: 150px; height: 150px; background: #f00; transition: 1s }
```

```
<div onclick="change(this)" class="first">Click me</div>
```

* * *

## 回答 #21

> 赞同：5
> 
> 时间：2019-08-22T18:28:29.037

* * *

# 选项。

这是一个小样式与 classList 示例，可让您了解可用的选项以及如何使用`classList`它们来做您想做的事情。

# [`style`](https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/style)对比[`classList`](https://developer.mozilla.org/en-US/docs/Web/API/Element/classList)

`style`和之间的区别在于`classList`，`style`您正在添加元素的样式属性，但`classList`有点控制元素的类（`add`, `remove`, `toggle`, `contain`），我将向您展示如何使用`add`and`remove`方法，因为那些是流行的。

* * *

## 样式示例

如果您想将`margin-top` 属性添加到元素中，您可以这样做：

```
// Get the Element
const el = document.querySelector('#element');

// Add CSS property 
el.style.margintop = "0px"
el.style.margintop = "25px" // This would add a 25px to the top of the element. 
```

* * *

## 类列表示例

假设我们有一个`<div class="class-a class-b">`，在这种情况下，我们已经将 2 个类添加到我们的 div 元素中，`class-a`并且`class-b`我们想要控制哪些类**`remove`**和哪些类**`add`**。这是`classList`变得方便的地方。

### 消除`class-b`

```
// Get the Element
const el = document.querySelector('#element');

// Remove class-b style from the element
el.classList.remove("class-b") 
```

### 添加`class-c`

```
// Get the Element
const el = document.querySelector('#element');

// Add class-b style from the element
el.classList.add("class-c") 
```

* * *

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2021-09-10T11:57:28.117

对于 IE v6-9（`classList`不支持并且您不想使用 polyfills）：

```
var elem = document.getElementById('some-id');

// don't forget the extra space before the class name
var classList = elem.getAttribute('class') + ' other-class-name';

elem.setAttribute('class', classList); 
```

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2017-05-29T13:29:53.203

好的，我认为在这种情况下你应该使用 jQuery 或者用纯 JavaScript 编写你自己的方法。我的偏好是添加我自己的方法，而不是在我出于其他原因不需要的情况下将所有 jQuery 注入我的应用程序。

我想做一些类似下面的事情作为我的 JavaScript 框架的方法来添加一些处理添加类、删除类等的功能。与 jQuery 类似，这在 IE9+ 中得到完全支持。我的代码也是用 ES6 编写的，所以你需要确保你的浏览器支持它或者你使用[Babel](https://en.wikipedia.org/wiki/Babel_(transcompiler))之类的东西，否则需要在你的代码中使用 ES5 语法。也是这样，我们通过 ID 查找元素，这意味着元素需要有一个 ID 才能被选择：

```
// Simple JavaScript utilities for class management in ES6
var classUtil = {

  addClass: (id, cl) => {
    document.getElementById(id).classList.add(cl);
  },

  removeClass: (id, cl) => {
    document.getElementById(id).classList.remove(cl);
  },

  hasClass: (id, cl) => {
    return document.getElementById(id).classList.contains(cl);
  },

  toggleClass: (id, cl) => {
    document.getElementById(id).classList.toggle(cl);
  }

} 
```

你可以简单地使用它们，如下所示。想象一下，您的元素的 id 为“id”，类为“class”。确保将它们作为字符串传递。您可以使用该实用程序，如下所示：

```
classUtil.addClass('myId', 'myClass');
classUtil.removeClass('myId', 'myClass');
classUtil.hasClass('myId', 'myClass');
classUtil.toggleClass('myId', 'myClass'); 
```

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2018-09-21T09:23:12.163

## `classList`DOM API：

添加和删​​除类的一种非常方便的方式是`classList`DOM API。该 API 允许我们选择特定 DOM 元素的所有类，以便使用 JavaScript 修改列表。例如：

```
const el = document.getElementById("main");
console.log(el.classList);
```

```
<div class="content wrapper animated" id="main"></div>
```

我们可以在日志中观察到，我们返回的对象不仅包含元素的类，还包含许多辅助方法和属性。该对象继承自接口**DOMTokenList**，该接口在 DOM 中用于表示一组空格分隔的标记（如类）。

## 例子：

```
const el = document.getElementById('container');

function addClass () {
    el.classList.add('newclass');
}

function replaceClass () {
    el.classList.replace('foo', 'newFoo');
}

function removeClass () {
    el.classList.remove('bar');
}
```

```
button{
  margin: 20px;
}

.foo{
  color: red;
}

.newFoo {
  color: blue;
}

.bar{
  background-color: powderblue;
}

.newclass{
  border: 2px solid green;
}
```

```
<div class="foo bar" id="container">
  "Sed ut perspiciatis unde omnis
  iste natus error sit voluptatem accusantium doloremque laudantium,
  totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et
  quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam
  voluptatem quia voluptas
 </div>

<button onclick="addClass()">AddClass</button>

<button onclick="replaceClass()">ReplaceClass</button>

<button onclick="removeClass()">removeClass</button>
```

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2019-02-06T14:02:57.737

是的，有很多方法可以做到这一点。在 ES6 语法中我们可以轻松实现。使用此代码切换添加和删除类。

```
const tabs=document.querySelectorAll('.menu li');

for(let tab of tabs){

  tab.onclick = function(){

    let activetab = document.querySelectorAll('li.active');

    activetab[0].classList.remove('active')

    tab.classList.add('active');
  }

}
```

```
body {
    padding: 20px;
    font-family: sans-serif;
}

ul {
    margin: 20px 0;
    list-style: none;
}

li {
    background: #dfdfdf;
    padding: 10px;
    margin: 6px 0;
    cursor: pointer;
}

li.active {
    background: #2794c7;
    font-weight: bold;
    color: #ffffff;
}
```

```
<i>Please click an item:</i>

<ul class="menu">
  <li class="active"><span>Three</span></li>
  <li><span>Two</span></li>
  <li><span>One</span></li>
</ul>
```

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2015-03-20T02:35:01.757

只是想我会把这个扔进去：

```
function inArray(val, ary){
  for(var i=0,l=ary.length; i<l; i++){
    if(ary[i] === val){
      return true;
    }
  }
  return false;
}
function removeClassName(classNameS, fromElement){
  var x = classNameS.split(/\s/), s = fromElement.className.split(/\s/), r = [];
  for(var i=0,l=s.length; i<l; i++){
    if(!iA(s[i], x))r.push(s[i]);
  }
  fromElement.className = r.join(' ');
}
function addClassName(classNameS, toElement){
  var s = toElement.className.split(/\s/);
  s.push(c); toElement.className = s.join(' ');
} 
```

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2017-04-21T02:50:51.827

`myElement.classList="new-class"`除非您需要维护其他现有类，否则只需使用这些`classList.add, .remove`方法即可。

```
var doc = document;
var divOne = doc.getElementById("one");
var goButton = doc.getElementById("go");

goButton.addEventListener("click", function() {
  divOne.classList="blue";
});
```

```
div{
  min-height: 48px;
  min-width: 48px;
}
.bordered{
  border: 1px solid black;
}
.green{
  background: green;
}
.blue{
  background: blue;
}
```

```
<button id="go">Change Class</button>

<div id="one" class="bordered green">

</div>
```

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2019-02-22T10:22:35.077

**TL;博士：**

```
document.getElementById('id').className = 'class' 
```

*或者*

```
document.getElementById('id').classList.add('class');
document.getElementById('id').classList.remove('class'); 
```

***就是这样。***

而且，如果您真的想知道原因并进行自我教育，那么我建议您阅读[Peter Boughton 的回答](https://stackoverflow.com/a/196038/1804013)。这是完美的。

**笔记：**

这可以通过（*[文档](https://developer.mozilla.org/en-US/docs/Web/API/Document)*或*[事件](https://developer.mozilla.org/en-US/docs/Web/API/Event/target)*）：

*   `getElementById()`
*   `getElementsByClassName()`
*   `querySelector()`
*   `querySelectorAll()`

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2019-09-04T15:32:07.673

```
function classed(el, class_name, add_class) {
  const re = new RegExp("(?:^|\\s)" + class_name + "(?!\\S)", "g");
  if (add_class && !el.className.match(re)) el.className += " " + class_name
  else if (!add_class) el.className = el.className.replace(re, '');
} 
```

使用[Peter Boughton 的回答](https://stackoverflow.com/questions/195951/how-can-i-change-an-elements-class-with-javascript/196038#196038)，这里有一个简单的跨浏览器函数来添加和删除类。

添加类：

```
classed(document.getElementById("denis"), "active", true) 
```

删除类：

```
classed(document.getElementById("denis"), "active", false) 
```

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2020-03-20T12:25:24.857

JavaScript 中有一个属性**className**可以更改 HTML 元素的类名。现有的类值将替换为您在 className 中分配的新值。

```
<!DOCTYPE html>
<html>
<head>
<title>How can I change the class of an HTML element in JavaScript?</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body>
<h1 align="center"><i class="fa fa-home" id="icon"></i></h1><br />

<center><button id="change-class">Change Class</button></center>

<script>
var change_class = document.getElementById("change-class");
change_class.onclick = function()
{
    var icon=document.getElementById("icon");
    icon.className = "fa fa-gear";
}
</script>
</body>
</html> 
```

Credit -*[如何在 JavaScript 中更改 HTML 元素的类名](https://jaischool.com/javascript-lang/how-to-change-class-name-of-an-html-element-in-javascript.html)*

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2021-03-26T13:43:16.790

简单地说，可以对元素执行 3 种不同的操作：

1.  [添加一个新类](https://www.tutorialstonight.com/javascript-add-class.php)
2.  删除旧类
3.  切换类（如果类是然后删除它；如果类不是然后添加）

但是在这里，您只对添加新类和删除旧类感兴趣。

**有两种方法可以做到这一点：**

1.  **使用元素的 classList 属性的 add 和 remove 方法**。`element.classList.add(class_name)`与`element.classList.remove(old_class_name)`. 它将添加新类并删除旧类。

    **完整代码**

    ```
    function changeClass() {
        const element = document.getElementById("id1");
        element.classList.add("new-class");
        element.classList.remove("old-class");
    }
    ```

    ```
    .old-class { background: lightpink }
    .new-class { background: lightgreen }
    ```

    ```
    <div class="old-class" id="id1">My div element.</div>
    <button onclick="changeClass()">Change class</button>
    ```

2.  **使用元素的 className 属性**。`element.className = new_class`. 这将替换元素的所有旧类。

    ```
    function changeClass() {
        const element = document.getElementById("id1");
        element.className = "new-class";
    }
    ```

    ```
    .old-class { background: lightpink }
    .new-class { background: lightgreen }
    ```

    ```
    <div class="old-class" id="id1">My div element.</div>
    <button onclick="changeClass()">Change class</button>
    ```

* * *

## 回答 #32

> 赞同：-5
> 
> 时间：2014-04-06T06:10:14.023

这是一个简单的jQuery代码来做到这一点：

```
$(".class1").click(function(argument) {
    $(".parentclass").removeClass("classtoremove");
    setTimeout(function (argument) {
        $(".parentclass").addClass("classtoadd");
    }, 100);
}); 
```

这里，

*   Class1 是事件的侦听器。
*   父类是承载您要更改的类的类
*   Classtoremove 是您拥有的旧课程。
*   要添加的类是您要添加的新类。
*   100 是更改类的超时延迟。

* * *

## 回答 #33

> 赞同：-27
> 
> 时间：2008-10-12T20:12:16.787

这对于像 jQuery 这样的库来说是最简单的：

```
<input type="button" onClick="javascript:test_byid();" value="id='second'" />

<script>
function test_byid()
{
    $("#second").toggleClass("highlight");
}
</script> 
```

* * *

## 回答 #34

> 赞同：-69
> 
> 时间：2008-10-12T20:16:33.817

无意冒犯，但动态更改类是不明智的，因为它会迫使 CSS 解释器重新计算整个网页的视觉呈现。

原因是 CSS 解释器几乎不可能知道是否可以更改任何继承或级联，因此简短的回答是：

永远不要即时更改 className ！-)

但通常您只需要更改一两个属性，这很容易实现：

```
function highlight(elm){
    elm.style.backgroundColor ="#345";
    elm.style.color = "#fff";
} 
```

# language-agnostic - Generating random number excluding range

> ID：195956
> 
> 赞同：6
> 
> 时间：2008-10-12T20:09:46.403
> 
> 标签：language-agnostic, random

How do you generate a random number within a range while excluding certain range(s). Eg. range 1-10 but not in 2-4 or 7. Solutions I've used so far:

*   Generate a random an test if it is within the dis-allowed range. Based on result either output the number or try again.
*   Map allowed ranges to a uniform range. Get a random between 1 and 6 and then map back (ie. 6 becomes 10).
*   Create allowed ranges (1-1,5-6,8-10). Randomly choose a range (optionally use weights) and a number in chosen range.

What is your solution?

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-12T20:11:48.490

**(b) Use the single range and map to allowed values.**

(a) Is slower and running time is non-deterministic because you have to wait until you get a number in the right range. If you were to skip a large range, you'd be hosed.

(c) Is more complex than (b); don't add complexity if it isn't required.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T20:12:38.427

It would depend on how many/big the exclusion ranges are. Testing for dis-allowed range (your option 1) would work fine for small sets; no need to complicate the solution to an easy problem. Solution 3 would work better for more numerous exclusion sets. Solution 2 is the most work, but probably the most correct theoretical solution.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T20:13:07.300

I generally use the technique described by bullet number two above, especially if the set of allowable numbers is reasonably small. From a statistical standpoint, it's way to easy to either ruin the randomness of the results or skew the results away from a flat distribution.

It has the added advantage of allowing a single pick (like dealing cards or picking bingo balls) ... you simply remove the already selected values from the map.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T20:16:22.583

Map them to the total of the ranges you expect. then distribute them between the ranges.

E.g. if you need a random between 0..10 and 100..110

Generate a random-number between 20\. The lower 10 get assigned to the 0..10 range, the rest to the other interval (or something like that - I may be off by one.. Interval arithmetic is one of these things that I never get right on the first try).

The reason behind this is that you often deal with non perfect random generators. These start to behave strange if you distribute successive random-number variables over several dimensions (e.g. first choose a random interval, then choose a random inside the chosen interval). That can lead to a very obvious non-random behavior.

If you start with a better random number generator that gets it's data from true random sources you may end up wasting precious random bits. If you do it just once every second it may not be a problem. If you do it to often though you program might get stalled because the pure random sources have to catch up with your random-bit consume.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-12T20:16:04.597

It sounds like your algorithm can benefit from a slight redesign that will make creating the random numbers implicit rather than explicitly finding them using a random number generator.

For instance if you want to get a random series of the numbers from 1 to 10, its better to start from an ordered series, mix it in some fashion for instance via swapping (there was a question about this I think) and take the numbers one after the other.

# html - 验证网页

> ID：195973
> 
> 赞同：1
> 
> 时间：2008-10-12T20:15:56.000
> 
> 标签：html, css, validation, xhtml

我已经开发网站几年了，我几乎从不检查我的页面是否是有效的 HTML 和 CSS。我的检查是使用诸如 browsershots.org 之类的网站并检查它在所有不同浏览器中的外观。但是最近我一直在上大学课程，教授希望我们验证我们上交的每一件事。这让我开始思考。

我应该关心我的页面是否有效吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-12T20:26:59.207

[是的，因为这里已经提到](https://stackoverflow.com/questions/170827/do-you-validate-your-websites)的原因。

我知道您不一定在谈论商业网站，但无论如何都表现得像您一样好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-12T20:21:11.293

只是检查您的网页在不同浏览器中看起来是否良好现在似乎可以工作，但在未来网络浏览器将发生变化，您的页面可能不再看起来正确。但是，如果您的页面是有效的 HTML 和 CSS，那么较新的浏览器将来应该可以正确显示它们。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-12T20:23:23.630

您可以（并且应该）验证您的 CSS/HTML

*   [CSS 验证](http://jigsaw.w3.org/css-validator/)
*   [HTML 验证](http://validator.w3.org/)

除了获得更好的成绩外，一些项目/行业还需要出于各种目的进行验证。如果您对这些领域的未来职业感兴趣，不妨现在开始 :)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-12T20:26:14.060

是的，标准是您在不断变化的世界中的防御。仅仅因为您的网站可以使用这种网络浏览器，如果您不符合标准，则不能保证您会很好地使用下一个浏览器。老实说，网络浏览器通常会在网站的生命周期内多次更新。

作为一个勤奋的开发人员，我相信您会随着浏览器的更新而重新测试，但是在更新和您测试（修复）之间存在一个窗口。:-)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-12T20:17:10.850

是的。否则，您的老师可能会降低您的成绩。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-12T20:21:50.670

我发现验证是一个原则问题，而不是要求的问题。当我们现在仍然只测试流行的浏览器时，将 IE 视为缺乏标准兼容性是非常虚伪的。

始终检查您的页面是否有效。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-12T20:22:24.583

嗯，这几乎是圣战之地。如果您在使用 CSS 时遇到问题，请确保您的 HTML 和 CSS 验证是一个非常好的诊断步骤。如果您的 HTML 非常糟糕，它有时会导致可访问性问题。否则，没有任何实际理由担心它。

但是，在工作中小心并为自己的工艺感到自豪，那是另一回事。如果您的页面通过验证，它就像一颗小金星，您会在几秒钟内获得一种温暖的模糊感。这是一个最佳实践。

如果你喜欢以绝对正确的方式做事，那么当然，关心它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-12T20:25:44.607

在我看来，网页验证是一件复杂的事情。一方面，您有 W3C 推荐 - 那就是：*推荐*- 可能会或可能不会（可能不会）在所有浏览器中同等呈现。另一方面，您的 CSS/HTML 调整和技巧使每个页面呈现像素完美，但很可能无法使用 W3C 验证器进行验证。

在现实生活中，这是一个妥协的世界。我个人尝试两者都做 - 验证错误最少，但主要强调它实际上在广泛使用的浏览器中看起来不错。

但是，在学术生活中，我认为教授要求 100% 符合 W3C 标准是完全公平的。然而，它是我们所拥有的最接近 HTML/XHTML 规范的规范，而这正是学术界人士最终感兴趣的——理论。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-12T20:26:29.397

我总是验证我的网页，我建议您也这样做，但许多大型公司网站不会也无法验证，因为网站在所有系统上看起来完全相同的重要性需要打破规则。

一般来说，有效的网站即使在奇怪的配置（如手机）上也能帮助你的页面看起来很好，所以你至少应该尝试让它验证。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-12T20:38:30.307

验证以确保您没有犯错误。如果验证器抱怨您必须为浏览器兼容性添加一些内容，您可能会忽略它。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-12T20:48:59.053

绝对地！您的网站应该是有效的！有效的 HTML/CSS 更有可能在 10 年后的未来浏览器中工作！

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-13T12:04:14.010

正如 Eric 所说，许多大型网站都没有验证，但是，如果您从一个在 Firefox、Safari/Chrome 或 Opera 中完美运行的验证网站开始，那么它很可能是正确的或大部分是正确的其他 3 个，只需要稍作调整即可使它们正确。

然后，您可以处理基于 Trident 的浏览器（如 IE）可能需要的任何 hack。对于大多数普通网站来说，在 IE7 和 IE6 中运行所需的 hack 仍然有效。

一旦你到了那个时候，就很容易调试任何问题，然后开始进行任何无法验证的调整/修改。

如果您可以使用服务器端编程，或者在客户端使用 JavaScript，那么很容易确定正在使用哪种浏览器（假设它正在发送正确的用户代理）和 PHP，然后您可以在常规之上加载特定样式表每个浏览器的样式表。IE6 和 7 有 HTML hack，不需要任何额外的工作来为它们加载特定的样式表，但是 Gecko、Webkit 或 Presto 浏览器（Firefox、Safari/Chrome 或 Opera）没有任何可用的东西，所以另一种方法是这些浏览器特有的任何东西都需要。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-17T18:22:46.100

我认为验证您的页面是一件好事，但是围绕这一点有一些神话。

首先，您可能不想使用 XHTML，因为您总是不正确地将它提供给浏览器。坚持使用 HTML 4.0 Strict。

其次，拥有有效的页面很好，也很有用，但不要因此而自责，也不要验证其他人的页面——有些人真的很喜欢这个，而且它只会让人觉得很卑鄙。

最后，尝试“填充”页面中的文本，这样你的行就不会太长。它与验证无关，但有助于人类阅读您的 HTML。

# c - 如何从 C 宏的值生成 char 字符串？

> ID：195975
> 
> 赞同：55
> 
> 时间：2008-10-12T20:16:05.190
> 
> 标签：c, c-preprocessor, dry

例如，如何避免两次写入'func_name'？

```
#ifndef TEST_FUN
#  define TEST_FUN func_name
#  define TEST_FUN_NAME "func_name"
#endif 
```

我想遵循[单点真理](http://en.wikipedia.org/wiki/Single_Point_of_Truth)规则。

C预处理器版本：

```
$ cpp --version
cpp (GCC) 4.1.2 20070626 (Red Hat 4.1.2-14) 
```

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2008-10-12T20:35:11.890

[害羞的人](https://stackoverflow.com/users/9611/shoosh)^*给了你[答案](https://stackoverflow.com/a/195980/15168)的萌芽，但只是萌芽。在 C 预处理器中将值转换为字符串的基本技术确实是通过 '#' 运算符，但建议解决方案的简单音译会产生编译错误：

```
#define TEST_FUNC test_func
#define TEST_FUNC_NAME #TEST_FUNC

#include <stdio.h>
int main(void)
{
    puts(TEST_FUNC_NAME);
    return(0);
} 
```

语法错误出现在“puts()”行 - 问题是源代码中的“杂散#”。

在 C 标准的第 6.10.3.2 节“# 运算符”中，它说：

> 类函数宏的替换列表中的每个 # 预处理标记应后跟一个参数，作为替换列表中的下一个预处理标记。

问题是您可以将宏参数转换为字符串——但您不能转换不是宏参数的随机项。

所以，要达到你想要的效果，你肯定需要做一些额外的工作。

```
#define FUNCTION_NAME(name) #name
#define TEST_FUNC_NAME  FUNCTION_NAME(test_func)

#include <stdio.h>

int main(void)
{
    puts(TEST_FUNC_NAME);
    return(0);
} 
```

我不完全清楚您计划如何使用宏，以及您计划如何完全避免重复。这个稍微复杂一点的例子可能会提供更多信息。使用与 STR_VALUE 等效的宏是获得所需结果所必需的惯用语。

```
#define STR_VALUE(arg)      #arg
#define FUNCTION_NAME(name) STR_VALUE(name)

#define TEST_FUNC      test_func
#define TEST_FUNC_NAME FUNCTION_NAME(TEST_FUNC)

#include <stdio.h>

static void TEST_FUNC(void)
{
    printf("In function %s\n", TEST_FUNC_NAME);
}

int main(void)
{
    puts(TEST_FUNC_NAME);
    TEST_FUNC();
    return(0);
} 
```

* * *

^(* 在第一次写这个答案的时候，[shoosh](https://stackoverflow.com/users/9611/shoosh)的名字使用了“害羞”作为名字的一部分。)

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-10-12T21:10:34.830

@Jonathan Leffler：谢谢。您的解决方案有效。

一个完整的工作示例：

```
/** compile-time dispatch 

   $ gcc -Wall -DTEST_FUN=another_func macro_sub.c -o macro_sub && ./macro_sub
*/
#include <stdio.h>

#define QUOTE(name) #name
#define STR(macro) QUOTE(macro)

#ifndef TEST_FUN
#  define TEST_FUN some_func
#endif

#define TEST_FUN_NAME STR(TEST_FUN)

void some_func(void)
{
  printf("some_func() called\n");
}

void another_func(void)
{
  printf("do something else\n");
}

int main(void)
{
  TEST_FUN();
  printf("TEST_FUN_NAME=%s\n", TEST_FUN_NAME);
  return 0;
} 
```

例子：

```
$ gcc -Wall -DTEST_FUN=another_func macro_sub.c -o macro_sub && ./macro_sub
do something else
TEST_FUN_NAME=another_func 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-12T20:27:18.163

```
#include <stdio.h>

#define QUOTEME(x) #x

#ifndef TEST_FUN
#  define TEST_FUN func_name
#  define TEST_FUN_NAME QUOTEME(TEST_FUN)
#endif

int main(void)
{
    puts(TEST_FUN_NAME);
    return 0;
} 
```

参考：维基百科的[C 预处理器](http://en.wikipedia.org/wiki/C_preprocessor#Quoting_macro_arguments)页面

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-12T20:19:07.820

`#define TEST_FUN_NAME #FUNC_NAME`

看[这里](http://en.wikipedia.org/wiki/C_preprocessor#Indirectly_quoting_macro_arguments)

# html - 在有效的 XHTML 中实现制表位的最佳方法是什么？

> ID：195991
> 
> 赞同：9
> 
> 时间：2008-10-12T20:23:40.057
> 
> 标签：html, css

为了解释，想象一个简单的地址。写在带有换行符的 HTML 段落中，它会像这样：

```
Street: Example Street 1
City: Vienna
Zip Code: 1010
Country: Austria 
```

大多数时候这完全没问题，但有时我必须实现以下输出：

```
Street:   Example Street 1
City:     Vienna
Zip Code: 1010
Country:  Austria 
```

到目前为止我的想法：

1.  应该是有效的 XHTML 并且可以在所有主流浏览器中正常工作或降级
2.  强烈建议以语义正确的方式使用标签
3.  因为第二点：我希望有比表格更好的解决方案
4.  问题不仅限于地址 - 在其他情况下也很有用

你如何实现这个输出（使用 HTML 和/或 CSS）？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-12T20:29:52.790

我认为您将“桌子不好”的概念发挥到了极致。

*   纯粹用于布局的表格（当其他元素更具语义时）是不好的。
*   表格数据的表格很好。他们是为此目的而设计的！

您所拥有的内容非常适合行和列的概念，带有标题 ( `<th>`) 和数据 ( `<td>`) – 基于语义，而不仅仅是布局。

如果您想让它更明确地表明它是一个地址，请使用[adr Microformat](http://microformats.org/wiki/adr)或添加`<caption>`.

错误的做法：

*   `<dl>`：“1010”不是“邮政编码”的定义。`<th>`反过来，它更有意义，但关系与→一样清晰`<td>`，它不依赖 CSS，并且无论用户的字体大小如何都看起来很完美。
    如果您使用*即使在 lynx 中*`<th>`也会完美呈现！没有 CSS 技巧的地址看起来很奇怪。*`<dl>`*
**   HTML 的`<address>`元素可能不适用于此，因为它*仅*用于页面作者/维护者的联系信息。它还只允许内联内容，因此您会丢失地址的结构。*

 ** * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-12T20:40:37.777

我发现定义列表比这里的表格更有意义。以特定宽度向左浮动，`dt`并使其在左侧清晰。如果标签或数据要换行，您将不得不做一些后元素浮动清除技巧来完成这项工作，但听起来您不需要这样做。（无论如何，我认为这是值得的；另外，做一次，你就不必再做一次了。）

`:after`如果您不介意刷掉 IE6，您甚至可以使用自动添加冒号。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-12T21:29:18.943

不要听人们说这是表格数据。仅仅因为某些东西已经按行呈现，它并不能使它成为一个表格！

这是使用`dl`,`dt`和`dd`标签的好地方。这与它们最初的用途*有点延伸，但它仍然比表格、跨度或 div 更有意义。*

```
<dl>
    <dt>Street</dt>
    <dd>Example Street 1</dd>
    <dt>City</dt>
    <dd>Vienna</dd>
    <dt>Zip Code</dt>
    <dd>1010</dd>
    <dt>Country</dt>
    <dd>Austria</dd>
</dl> 
```

和CSS：

```
dt {
    width: 150px;
    float: left;
    clear: left
}
dd {
    float: left;
} 
```

这是相当基本的 CSS - 它可能无法承受很多情况（例如：两个`dd`连续的，一个非常长的`dt`），但它是一个开始。查看 的`inline-block`属性，也许您可​​以在 . 上设置 a of`dt`而不是使用`float`ing 。`left-margin``150px``dd`

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-12T20:28:24.290

桌子是要走的路。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-13T19:17:03.827

正如其他人所提到的，浮动元素是这里的方法。

这将是我的解决方案：

```
<p class="details">
    <span class="label">Street:</span>
    Some Street or other.
    <br />

    <span class="label">City:</span>
    A City.
    <br />
</p> 
```

使用如下所示的 CSS：

```
p.details {
    padding-left: 200px;
}

p.details span.label {
    float: left;
    clear: left;
    width: 200px;
    margin-left: -200px;
} 
```

因为正文不是浮动的，这避免了文本很长并且需要换行的任何问题；它会阻止浮动元素变宽然后在标签下方浮动。这意味着当此文本是多行时，也不需要特殊情况，例如，如果您想要一个多行地址。

同样，如果标签数据需要覆盖多行，此方法也适用，因为下一个标签会清除前一个浮点数。

在那里有换行符意味着它也会很好地降级，并且看起来就像你在不使用 CSS 时所期望的那样。

此方法非常适用于布局表单，其中`<label>`使用元素而不是跨度，并且可以在 CSS 中选择段落作为 a 的子段落`<form>`。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-12T20:57:26.433

不需要表格（并不是说表格在这种情况下真的不合适）。我一直在做这种事情。

```
<div class=DetailsRow>
  <div class=DetailsLabel>Street</div>
  <div class=DetailsContent>123 Main Street</div>
</div>
<div class=DetailsRow>
  <div class=DetailsLabel>City</div>
  <div class=DetailsContent>Vienna</div>
</div>
  ...etc 
```

和

```
div.DetailsRow
{
clear:both;
}

div.DetailsLabel
{
float:left;
width:100px;
color:gray;
}

div.DetailsContent
{
float:left;
width:400px;
} 
```

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2010-07-26T13:44:11.203

或者你可以抛弃所有理智（和语义）并使用 CSS 重新创建表（在 Firefox 和 Chrome 中测试）：

```
<html>
<head>
<title>abusing divs</title>
<style type="text/css">
div.details {
    display: table;
}
div.details > div {
    display: table-row;
}
div.details > div > div {
    display: table-cell;
    padding-left: 0.25em;
    padding-right: 0.25em;
}
</style>
</head>
<body>
<div class="details">
    <div>
        <div>Street</div>
        <div>123 Main Street</div>
    </div>
    <div>
        <div>City</div>
        <div>Vienna</div>
    </div>
    <div>
        <div>This is a very very loooong label</div>
        <div>...</div>
    </div>
</div>
</body>
</html> 
```

只是在开玩笑。****************