# StackOverflow 问答 000237000-000237999

# unit-testing - 单元测试的投资回报率有确凿的证据吗？

> ID：237000
> 
> 赞同：129
> 
> 时间：2008-10-25T20:59:10.300
> 
> 标签：unit-testing, tdd

单元测试对我来说听起来很棒，但我不确定我是否应该花时间真正学习它，除非我能说服其他人认为它具有重要价值。我必须说服其他程序员，更重要的是，说服管理中的 bean-counters，所有花在学习测试框架、编写测试、更新测试等的额外时间都会为自己付出代价，然后是一些。

有什么证据？有没有人真的用两个独立的团队开发过相同的软件，一个使用单元测试，另一个不使用，并比较结果？我对此表示怀疑。我是否应该用“在互联网上查找它，每个人都在谈论它，所以它一定是正确的做法”来证明它的合理性？

让外行相信单元测试值得付出努力的确凿证据在哪里？

* * *

## 回答 #1

> 赞同：99
> 
> 时间：2008-10-25T21:46:58.160

是的。这是NCST 的 Boby George 和 Laurie Williams 以及Nagappan 等人的[另一个研究的](http://research.microsoft.com/en-us/groups/ese/nagappan_tdd.pdf)[链接。](http://collaboration.csc.ncsu.edu/laurie/Papers/TDDpaperv8.pdf)我敢肯定还有更多。威廉姆斯博士关于测试的[出版物](http://collaboration.csc.ncsu.edu/laurie/publications.html#Testing)可能为找到它们提供了一个很好的起点。

[编辑] 上述两篇论文专门引用了 TDD，并显示采用 TDD 后初始开发时间增加了 15-35%，但预发布缺陷减少了 40-90%。如果看不到全文，建议用[谷歌学术](http://scholar.google.com)看看能不能找到公开的版本。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-10-25T22:03:54.180

“我必须说服其他程序员，更重要的是，说服管理中的 bean-counters，所有花费在学习测试框架、编写测试、更新测试等的额外时间都会为自己付出代价，然后再花一些时间。 "

为什么？

为什么不只是安静而谨慎地去做。您不必一次完成所有操作。你可以用小块做这个。

框架学习只需要很少的时间。

只写一个测试，只需要很少的时间。

如果没有单元测试，你所拥有的只是对你的软件有一些信心。通过一次单元测试，您仍然有信心，并证明至少通过了一项测试。

这就是它所需要的。没有人需要知道你在做什么。去做就对了。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-10-25T21:21:12.313

我对此采取了不同的方法：

你有什么保证你的代码是正确的？或者当您的团队中有人更改 func1() 时，它不会破坏假设 X？如果没有单元测试让你保持“诚实”，我不确定你是否有足够的把握。

保持测试更新的概念很有趣。测试本身不需要经常改变。与生产代码相比，我得到了 3 倍的测试代码，而且测试代码几乎没有*改变*。然而，正是它让我晚上睡得很好，让我告诉客户我有信心在不破坏系统的情况下实现 Y 功能。

也许在学术界有证据，但我从来没有在商业世界的任何地方工作过，任何人都会为这样的测试付费。然而，我可以告诉你，它对我来说效果很好，很快就习惯了测试框架，编写测试让我**真正**思考了我的需求和设计，这比我在团队中工作时所做的要多得多没有写测试。

这是它为自己付出代价的地方：1）您对自己的代码有信心，2）您比其他方式更早地发现问题。您不会让 QA 人员说“嘿，您没有费心检查 xyz() 函数的边界，是吗？ **他**没有找到那个错误，因为**您**在一个月前发现了它。这对他，对你好，对公司好，对客户好。

显然这是轶事，但它对我产生了奇迹。不确定我是否可以为您提供电子表格，但我的客户很高兴，这就是最终目标。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-10-25T21:11:38.263

我们已经用确凿的证据证明，没有单元测试也可以编写蹩脚的软件。我相信甚至有证据表明单元测试是糟糕的软件。但这不是重点。

单元测试或测试驱动开发 (TDD) 是一种设计技术，而不是测试技术。编写测试驱动的代码看起来与非测试驱动的代码完全不同。

尽管这不是您的问题，但我想知道这是否真的是最简单的方法来回答可能被问错的问题（并带来可能会受到其他报告质疑的证据）。即使您为您的案件找到了确凿的证据——其他人也可能找到反对的确凿证据。

决定技术人员应该如何工作是豆类计数器的业务吗？他们是否在所有情况下都提供最便宜的工具，因为他们认为您不需要更昂贵的工具？

这个论点要么基于信任（敏捷团队的基本价值观之一）获胜，要么基于获胜方的角色权力而失败。即使 TDD 支持者基于角色权力获胜，我也会将其视为失败。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-10-20T06:58:41.567

更多关于 TDD 而不是严格的单元测试，这里是[通过测试驱动开发实现质量改进的链接：四个工业团队的结果和经验](https://www.microsoft.com/en-us/research/wp-content/uploads/2009/10/Realizing-Quality-Improvement-Through-Test-Driven-Development-Results-and-Experiences-of-Four-Industrial-Teams-nagappan_tdd.pdf)论文，由 Nagappan、E. Michael Maximilien、Thirumalesh Bhat 和 Laurie Williams 撰写。微软[经验软件工程与测量](https://www.microsoft.com/en-us/research/group/empirical-software-engineering-group-ese/)(ESM) 小组发表的论文，已在此处提及。

该团队发现，TDD 团队生成的代码（就缺陷密度而言）比非 TDD 团队好 60% 到 90%。*然而*，TDD 团队完成项目的时间要长 15% 到 35%。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2015-08-17T00:13:53.127

如果您也对反对单元测试的证据感兴趣，这里有一篇经过充分研究和深思熟虑的文章：

[为什么大多数单元测试都是浪费 James O Coplien（精益和敏捷大师）](http://www.rbcs-us.com/documents/Why-Most-Unit-Testing-is-Waste.pdf)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-10-27T19:48:59.380

这是一本关于一个从内部改变公司的人的精彩而有趣的读物。它不仅限于 TDD。[http://jamesshore.com/Change-Diary/](http://jamesshore.com/Change-Diary/)请注意，他很长一段时间都没有说服“bean counters”，而是采取了“游击战术”。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2016-11-13T20:27:50.653

只是为了向这些答案添加更多信息，有两个元分析资源可能有助于弄清楚生产力和质量对学术和行业背景的影响：

# 客座编辑的介绍：TDD——无畏编程的艺术 [[链接](https://www.computer.org/csdl/mags/so/2007/03/s3024.html)]

> 所有研究人员似乎都同意 TDD 鼓励更好的任务重点和测试覆盖率。更多测试这一事实并不一定意味着软件质量会更好，但程序员对测试设计的关注度增加仍然令人鼓舞。如果我们将测试视为对大量潜在行为进行抽样，那么更多的测试意味着更彻底的样本。如果每个测试都可以找到其他测试都找不到的重要问题，那么这些测试很有用，特别是如果您可以廉价地运行它们。
> 
> 表 1\. 测试驱动开发的部分实证研究总结：行业参与者*
> 
> [![https://www.computer.org/cms/Computer.org/dl/mags/so/2007/03/figures/s3024t1.gif](https://i.stack.imgur.com/F7yHI.gif)](https://i.stack.imgur.com/F7yHI.gif)
> 
> 表 2\. TDD 实证研究的摘要：学术参与者*
> 
> [![在此处输入图像描述](https://i.stack.imgur.com/6U4ul.gif)](https://i.stack.imgur.com/6U4ul.gif)

# 测试驱动开发对外部质量和生产力的影响：荟萃分析 [[链接](http://dl.acm.org/citation.cfm?id=2498849)]

抽象的：

> 本文对 27 项研究进行了系统的元分析，这些研究调查了测试驱动开发 (TDD) 对外部代码质量和生产力的影响。
> 
> 结果表明，总体而言，TDD 对质量的积极影响很小，但对生产力的影响很小甚至没有明显影响。然而，亚组分析发现，与学术研究相比，工业研究的质量提高和生产率下降要大得多。在 TDD 和对照组的过程之间的测试工作量差异显着的研究中发现了更大的生产力下降。当测试努力的差异很大时，学术研究中的质量也有较大的提高；然而，由于缺乏数据，无法就工业研究得出结论。
> 
> 最后，研究了开发人员经验和任务规模作为调节变量的影响，发现任务规模与质量改进幅度之间存在统计学上显着的正相关关系。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-10-25T21:03:59.930

有统计数据证明，修复单元/集成测试中发现的错误比在实时系统上修复的成本要低很多倍（它们基于监控数千个现实生活项目）。

*编辑*：例如，正如所指出的，“[代码完成](http://cc2e.com/)”一书报告了此类研究（第 20.3 段，“质量技术的相对有效性”）。但咨询领域的私人研究也证明了这一点。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-10-25T21:29:15.170

嗯，有一些大公司要求你使用单元测试，但如果你是一家小公司，为什么要模仿大公司呢？

对我来说，当我多年前开始进行单元测试时（今天我们主要使用[行为](http://video.google.com/videoplay?docid=8135690990081075324)模型），那是因为我无法在一个应用程序中控制所有路径。

我习惯于首先编程和 REPL，所以当我得到单元测试（每个函数一个测试）时，就像将 REPL 带回了非常容易编译的语言。它给我写的每一行代码带来了乐趣。我觉得上帝。我喜欢它。我不需要报告来告诉我我开始更快地编写更好的代码。我的老板不需要报告就可以注意到，因为我们在做疯狂的事情时突然从未错过最后期限。我的老板不需要报告来注意到“普通”错误的数量从（很多）下降到几乎为零，因为编写非生产性代码这种非常奇怪的事情。

正如另一位海报已经写的那样，您不使用 TDD 来测试（验证）。您编写它来捕获规范，即您的单元（对象、模块、函数、类、服务器、集群）工作的行为。

在许多公司中，有很多失败和成功的案例切换到不同的软件开发模型。

每当我有新东西要写时，我就开始使用它。有句老话对我来说翻译成英文有点困难，但是：

> 从简单到你没有注意到你做了的事情开始。马拉松训练时，从步行 9 米开始，然后跑 1 米，重复。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-10T14:04:32.807

我确实有一组数据点 - 从单元测试卖给我的经验。

很多个月前，我是一名刚毕业的学生，​​正在从事一个大型 VB6 项目，并且有机会编写大量存储过程代码。在我编写的子系统中，它约占整个代码库的 1/4——大约 50K 左右的 13,000 LOC。

我为存储过程编写了一组单元测试，但是如果没有像 Rational Robot 这样的工具，对 VB6 UI 代码进行单元测试是不可行的；至少那时不是。

QA 对这件作品的统计是，整个子系统产生了大约 40 或 50 个缺陷，其中***两个***来自存储过程。这是*每 6,500 行代码中有一个缺陷，*而整段代码中每 1,000-1,200 行有 1 个缺陷。还要记住，大约 2/3 的 VB6 代码是用于错误处理和日志记录的样板代码，在所有过程中都是相同的。

无需过多的手动操作，您就可以将缺陷率至少提高一个数量级归因于单元测试。

# sql-server - 忘记 SQL Server 密码

> ID：237006
> 
> 赞同：18
> 
> 时间：2008-10-25T21:05:49.037
> 
> 标签：sql-server, sql-server-2005

我前段时间安装了 SQL Server 2005，但忘记了我在安装过程中设置的管理员密码。我现在如何连接到 SQL Server？

**编辑：**我想我只允许 Sql Server 身份验证。使用集成安全登录也不起作用。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-10-25T21:21:22.500

尝试在命令提示符下运行以下命令（假设您的服务器名称是**SQLEXPRESS**）：

```
osql -E -S .\SQLEXPRESS
exec sp_password @new='changeme', @loginame='sa'
go
alter login sa enable
go
exit 
```

完成这些步骤后，尝试使用用户名**sa**和密码**changeme**登录。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-06-02T09:05:51.063

您无需为任何重置工具付费即可执行此操作。以单用户模式启动实例，您可以创建一个具有 sysadmin 权限的新登录名/

请参阅此[Pinal Dave 链接](http://blog.sqlauthority.com/2009/02/10/sql-server-start-sql-server-instance-in-single-user-mode/)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-25T18:00:56.640

非常感谢**牛神**

它工作正常。我已经使用 Windows 身份验证模式登录到 SQL Server。然后打开了一个新的查询窗口。在那里，我通过按 F5 键入了这两个命令。

首先运行 **exec sp_password @new='changeme', @loginame='sa'**

然后 **更改 login sa enable**

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-02-06T07:55:51.450

如果没有其他具有 sysadmin 权限的用户，但`sa`应该使用`-m`单用户模式选项重新启动 SQL Server。然后您可以连接到此 SQL Server 实例，并且您可以添加其他具有 sysadmin 角色的用户或执行`exec sp_password`.

Pinal Dave 在这里解释 - [http://blog.sqlauthority.com/2009/02/10/sql-server-start-sql-server-instance-in-single-user-mode/](http://blog.sqlauthority.com/2009/02/10/sql-server-start-sql-server-instance-in-single-user-mode/) - 如何`-m`使用**SQL Server 配置管理器**添加：右键单击服务器服务，转到高级选项卡并`-m;`在启动参数中添加（注意分号）。

另一种方法是在服务中停止 SQL Server 实例并从命令行手动运行它，**如下**所示：

> "C:\Program Files\Microsoft SQL Server\MSSQL10.SQLEXPRESS\MSSQL\Binn\sqlservr.exe" -m -sSQLEXPRESS

我必须为 SQL Server 2008 这样做，因为它没有出现在 SQL Server 2008 R2 配置管理器中。可以在服务属性中找到执行命令行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-25T21:07:11.000

除非您将其设置为仅接受 SQL Server 身份验证，否则您可以使用域和/或计算机的管理员用户以集成安全性登录。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-09-23T08:10:26.447

要使这些步骤生效，您需要成为安装 SQL Server 的机器的管理员。

*   从配置管理器停止 SQL Server
*   以单用户模式启动 SQL Server
*   将此`-mSQLCMD`命令添加为启动参数之一，方法是右键单击服务并进入启动参数部分，如下面的屏幕截图所示，然后启动 SQL Server

    [![在此处输入图像描述](https://i.stack.imgur.com/Rcz6o.png)](https://i.stack.imgur.com/Rcz6o.png)

*   现在从 SQLCMD（以管理员身份打开命令提示符）连接到 SQLSERVER，如下所示：

    ```
    sqlcmd -s servername\instancename 
    ```

    并运行以下命令：

    ```
    USE [master]
    GO
    CREATE LOGIN [BUILTIN\Administrators] FROM WINDOWS WITH DEFAULT_DATABASE=[master]
    GO
    EXEC master..sp_addsrvrolemember @loginame = N'BUILTIN\Administrators', @rolename = N'sysadmin'
    GO 
    ```

    上面的命令将所有本地用户添加为系统管理员。您可以更改此设置并添加一个喜欢的用户，或者您可以创建另一个用户 sysadmin 并删除`BUILTIN\Administrators`

*   完成后，您现在需要停止 SQL Server 并删除`-mSQLCMD`参数并重新启动 SQL Server

**参考：**
[帮助：我丢失了 sa 密码，没有人拥有系统管理员 (SysAdmin) 权限。我应该怎么办？](https://sqlserver-help.com/2012/02/08/help-i-lost-sa-password-and-no-one-has-system-administrator-sysadmin-permission-what-should-i-do/)

# time - 是否有时区信息的中央存储库

> ID：237023
> 
> 赞同：8
> 
> 时间：2008-10-25T21:20:40.210
> 
> 标签：time, timezone

我知道系统在不同级别使用自己的时区数据库。

是否存在所有 timezeone 和 DST 信息所在的中心位置，从而使程序员可以轻松地将更新写入其时区数据源？

例如，人们是否为每种可能的组合规定了时区？例如，墨西哥领土内的岛屿不遵循 DST，因此它们每个都必须与三个大陆时区不同（应使用 DST 日期范围进行描述）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-25T21:22:55.913

我所知道的最好的数据库是[tz 数据库](http://www.twinsun.com/tz/tz-link.htm)，也称为 Olson 数据库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-05T23:25:19.463

[从ftp://ftp.iana.org/tz/releases](ftp://ftp.iana.org/tz/releases) — [ftp://elsie.nci.nih.gov/pub](ftp://elsie.nci.nih.gov/pub) — 或网络上的许多其他来源获取时区数据库。这些将输入联合国 ISO 代码和英文国家/城市名称

然后从[http://www.unicode.org/cldr/翻译它们](http://www.unicode.org/cldr/)

例如

*   法语 [http://unicode.org/cldr/data/common/main/fr.xml](http://unicode.org/cldr/data/common/main/fr.xml)
*   西班牙语 [http://unicode.org/cldr/data/common/main/es.xml](http://unicode.org/cldr/data/common/main/es.xml)

# c++ - C++ 中的继承

> ID：237027
> 
> 赞同：6
> 
> 时间：2008-10-25T21:21:38.087
> 
> 标签：c++, oop, inheritance

这是我的问题：我在 .h 文件中定义了一个虚拟方法，我想在从基类继承的类中调用它。可悲的是，派生类中的方法没有被调用。有没有更好的方法来实现我正在尝试做的事情？

```
#ifndef ofxBASE_SND_OBJ
#define ofxBASE_SND_OBJ

#include "ofConstants.h"

class ofxBaseSndObj {

public:

    virtual string getType(){}

    string key;

};

#endif 
```

这是我的嗡嗡声课

```
#ifndef OFXSO_BUZZ
#define OFXSO_BUZZ

#include "ofxBaseSndObj.h"

class ofxSOBuzz : public ofxBaseSndObj
{
public:
    string getType();
};

#endif 
```

ofxSOBuzz.cpp

```
string ofxSOBuzz::getType()
{
    string s = string("ofxSOBuzz");
    printf(" ********* returning string type %s", s.c_str()); // doesn't get called!
    return s;
} 
```

然后在另一个类中，我尝试这样称呼它：

```
string ofxSndObj::createFilter(ofxBaseSndObj obj)
{
    string str = obj.getType();
    if(str.compare("ofxSOBuzz") == 0)
    {
        printf(" all is well ");
    }
} 
```

在上面的方法中，我需要能够传入多种对象中的一种，这些对象都扩展了 ofxBaseSndObj 对象。任何建议或指示将不胜感激。谢谢！

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-25T21:25:22.370

更改此行：

```
string ofxSndObj::createFilter(ofxBaseSndObj obj) 
```

到

```
string ofxSndObj::createFilter(ofxBaseSndObj& obj) 
```

您正在做的是按值传递（传递副本）。

这意味着您正在将对象复制到函数中。因为函数不知道你实际传递的是什么类型，所以它只传递函数声明中定义的类型，因此它会复制基类（这被称为[切片](http://www.cs.ualberta.ca/~hoover/Courses/201/201-New-Notes/lectures/section/slice.htm)问题）。

解决方案是通过引用传递。

如果您不希望函数修改对象（也许这就是您按值传递的原因，因此它无法更改原始对象），则传递一个 const 引用。

```
class ofxBaseSndObj
{
    public:
        virtual string getType()  const;
        // If the method does not change the object mark it const

        string key;

};

string ofxSndObj::createFilter(ofxBaseSndObj const& obj)
{
    // allowed to call this if getType() is a const
    string str = obj.getType();

    if(str.compare("ofxSOBuzz") == 0)
    {
        printf(" all is well ");
    }
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-25T21:24:11.967

您需要将实例作为指向对象的**指针**（或引用）传递给 createFilter。您是[按值传递的](http://cplus.about.com/od/glossar1/g/passbyvaldefn.htm)，这会导致编译器将您用作参数的派生对象复制到基类的实例中。当它这样做时，您会失去它最初是派生类型的事实。

正如所写的那样，您的代码实际上不应编译，因为 ofxBaseSndObj::getType 的声明不返回任何内容。你的意思是这是一个抽象方法还是返回一个空字符串？

如果您将其设为抽象方法，那么编译器会抱怨尝试在您的 ofxSndObj::createFilter 方法中实例化抽象类。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-25T21:27:47.810

这个问题在 C++中称为[“切片” 。](http://www.cs.ualberta.ca/~hoover/Courses/201/201-New-Notes/lectures/section/slice.htm)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-25T21:40:20.077

将复制构造函数和 operator= 设为私有是防止此错误再次发生的有效方法。

例如：

```
class ofxBaseSndObj {
public:
    virtual string getType(){}
    string key;

private:
    ofxBaseSndObj(const ofxBaseSndObj& rhs);
    ofxBaseSndObj& operator=(const ofxBaseSndObj& rhs);
}; 
```

如果没有其他充分的理由，您应该使用 C++ 内置的 RTTI。然后，您可以使用 typeid 运算符。如果默认情况下未打开，请查看您的编译器文档以将其打开。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-25T22:39:10.690

其他人已经解决了切片问题。然后你问*好吧，让我说，我知道我需要做一些事情来确定基类型，但是有没有比进行枚举查找来确定继承对象的类型更优雅的事情？*

查询和切换对象的类型是一个糟糕的设计，它错过了 OO 方法的要点。

代替

```
string ofxSndObj::createFilter(ofxBaseSndObj& obj)
{
    string str = obj.getType();
    if(str.compare("ofxSOBuzz") == 0)
    {
        // do ofxSOBuzz - specific thing
    }
    else if(str.compare("some other derived class") == 0)
    {
        // do stuff for other derived classes
    }
       // etc...
} 
```

使有趣的行为成为虚函数：

```
class ofxBaseSndObj {

public:
    // get rid of getType()
    virtual void HelpCreateFilter() = 0;
};

string ofxSndObj::createFilter(ofxBaseSndObj& obj)
{
    // Let the derived class do it's own specialized work.
    // This function doesn't need to know what it is.
    obj.HelpCreateFilter();
    // rest of filter creation
} 
```

为什么这个比原版好？因为`ofxSndObj::createFilter`如果xBaseSndObj的未来派生类被添加到系统中，不需要修改。您的版本需要为每个新的派生类扩展。如果不清楚，请尝试发布更多代码 - 我无法从您的代码或类名中看出这些函数应该做什么。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-25T21:41:22.790

您可以使用 dynamic_cast 或 type_id

# .net - .NET 4.0 的确认功能？

> ID：237041
> 
> 赞同：0
> 
> 时间：2008-10-25T21:28:20.007
> 
> 标签：.net, .net-4.0

有谁知道 .NET 4.0 中会有什么？

我[在 codeplex 上](https://mef.svn.codeplex.com/svn/src/ComponentModel/System/Tuple.cs)找到了元组：

```
....
// NOTE : this is a TEMPORARY and a very minimalistic implementation of Tuple'2, 
// as defined in http://devdiv/sites/docs/NetFX4/CLR/Specs/Base Class Libraries/Tuple Spec.docx
// We will remove this after we move to v4 and Tuple is actually in there
public struct Tuple<TFirst, TSecond>
.... 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-25T21:32:46.130

[并行扩展](http://blogs.msdn.com/pfxteam/archive/2008/10/10/8994927.aspx)

[WCF/WF 改进](http://blogs.msdn.com/wenlong/archive/2008/09/07/net-4-0-wf-wcf-and-oslo.aspx)

我预计 BigInteger 也会回来。我真的很想看到一堆 F# 不可变集合也成为“.NET 专有”的一部分——这根本不会让我感到惊讶。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-25T21:57:00.167

我从[Anders Hejlsberg 的 JAOO talk中看到了](http://jaoo.blip.tv/file/1317881/)*动态*关键字在 C# 4.0 中的用法。它允许以后期绑定方式调用方法，这将在 COM 互操作场景中真正有所帮助。

用法：

```
// Instead of this:
object calc = GetCalculator();
Type calcType = calc.GetType();
object res = calcType.InvokeMember("Add", 
    BindingFlags.InvokeMethod, null,
    new int[] { 10, 20 });
int sum = Convert.ToInt32(res);

// you can write this:
dynamic calc = GetCalculator();
int sum = calc.Add(10, 20); 
```

[静态和动态 http://img266.imageshack.us/img266/9469/dynamicxf4.png](http://img266.imageshack.us/img266/9469/dynamicxf4.png)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-25T23:04:55.600

[Glenn Block](http://blogs.msdn.com/gblock/)在最近的[Herding Code](http://herdingcode.com/)剧集中证实， [MEF](http://www.codeplex.com/MEF)将成为 .NET 4.0 的一部分。

# silverlight - Silverlight 如何确定程序集是“Silverlight”？

> ID：237044
> 
> 赞同：11
> 
> 时间：2008-10-25T21:29:37.117
> 
> 标签：silverlight, f#, reference

我正在尝试从 F# 编译代码以在 Silverlight 中使用。我编译：

--noframework --cliroot "C:\program Files\Microsoft Silverlight\2.0.31005.0" --standalone

这会生成一个引用 SL 框架的独立程序集。但是当我尝试添加对生成的程序集的引用时，我收到了这个错误：

> 您只能将项目引用添加到解决方案中的其他 Silverlight 项目。

VS 插件在做什么来确定这不是 Silverlight 程序集？这是清单：

```
// Metadata version: v2.0.50727
.assembly extern mscorlib
{
  .publickeytoken = (7C EC 85 D7 BE A7 79 8E )                         // |.....y.
  .ver 2:0:5:0
}
.assembly FSSLLibrary1
{

  // --- The following custom attribute is added automatically, do not uncomment -------
  //  .custom instance void [mscorlib]System.Diagnostics.DebuggableAttribute::.ctor(valuetype [mscorlib]System.Diagnostics.DebuggableAttribute/DebuggingModes) = ( 01 00 01 01 00 00 00 00 ) 

  .hash algorithm 0x00008004
  .ver 0:0:0:0
}
.module 'F#-Module-FSSLLibrary1'
// MVID: {49038883-5D18-7281-A745-038383880349}
.imagebase 0x00400000
.file alignment 0x00000200
.stackreserve 0x00100000
.subsystem 0x0003       // WINDOWS_CUI
.corflags 0x00000001    //  ILONLY
// Image base: 0x04120000 
```

我不明白它不喜欢什么；它是纯可验证的 IL。我比较了一个 SL“类库”程序集，它看起来是一样的。唯一的区别是一些属性，但我删除了这些属性，VS 仍然让我引用 DLL。我什至将无法验证的 IL 添加到“SL 库”DLL 中，它仍然被加载。

有什么建议么？

*更新：*我做了一些探索，这似乎不是重要的清单。它不喜欢 FSharp 库中 IL 中的某些内容。它们是可验证的，但其中的某些东西引发了拒绝。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-28T22:27:05.613

**回答！**

显然问题在于，当您添加对 bin\Release 或 bin\Debug 的引用时，Visual Studio（或 Silverlight 项目系统）决定尝试引用该项目。无论出于何种原因，这都会失败。

如果您将 F# 输出 DLL 复制到另一个位置，则引用会正常进行。（当然，这将是文件参考，而不是项目参考。）

然后设置依赖项，以便首先构建 F# 库，然后您可以使用文件引用来获取 F# 生成的二进制文件。

*更新：*一个更明显的问题。如果我打开优化代码，则会收到此错误：

```
C:\test\SilverlightApplication1\FSC(0,0): error FS0193: internal error: the module/namespace 'System' from compilation unit 'mscorlib' did not contain the namespace, module or type 'MarshalByRefObject' 
```

如果我关闭优化代码，这就会消失，一切正常。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-22T12:13:39.120

Visual Studio 使用 Microsoft.VisualStudio.Silverlight.SLUtil 类型中的 IsSilverlightAssembly() 函数来检查是否可以设置引用。

David Betz 有一篇不错的博客文章，描述了[此处](http://www.netfxharmonics.com/2008/12/Reusing-NET-Assemblies-in-Silverlight)的详细信息。

# java - 调整 JFrame 大小时会调用哪些方法？

> ID：237050
> 
> 赞同：5
> 
> 时间：2008-10-25T21:35:33.673
> 
> 标签：java, swing

我正在使用 JFrame，其中 BorderLayout 的 CENTER 部分由环绕 JPanel 的 JScrollPane 占据。我发现当我启动实际导致 JPanel 显示的操作时，显示不会改变。但是当我调整 JFrame 的大小时，新的 JScrollPane 现在神奇地出现了。

那么当你调整 JFrame 的大小时会调用哪些方法呢？如果我知道，那么我可以在代码中调用它，而不必为了查看操作结果而调整框架大小。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-25T21:52:20.287

自从我完成摇摆以来已经有一点点了，但是从记忆中，在面板上调用 validate() 应该可以解决问题。这将导致它及其子项计算其布局，这是做出滚动条决定的时候。如果这不起作用，请尝试在框架的内容窗格上调用 validate。这有点昂贵，但如果正在考虑其他组件，则可能需要。

# .net - 如何使用 .NET Framework 2.0 重新分发 Windows 映像组件？

> ID：237052
> 
> 赞同：1
> 
> 时间：2008-10-25T21:35:54.780
> 
> 标签：.net, winforms, photo, wic

我有一个 .NET Framework 2.0 应用程序并想使用 Windows 映像组件。由于我的应用程序是一个 WinForms 应用程序，并且将通过 MSI 安装程序重新分发给用户，因此我试图找出最好的方法来做到这一点。

我看到了几个选项： 1) 跳过 .NET 2.0 并在包含 Windows 映像组件的 .NET 3.0 上构建 2) 找出一种在我的安装程序中包含 WIC 组件的方法

想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-11T19:12:02.550

WIC 内置于 Windows Vista 中，因此您无需为 Vista 机器分发它。对于 XP，它可以从 Microsoft[下载](http://www.microsoft.com/downloads/details.aspx?familyid=8E011506-6307-445B-B950-215DEF45DDD8&displaylang=en)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T03:22:33.160

我对 WIC 不熟悉，但您可以将引用上的 Copy Local 属性设置为 true 吗？我会假设您在创建 MSI 时可以使用所需的程序集。

我的解决方案可能只是建立在较新的框架上。我相信如果需要，可以设置 MSI 来安装它。

# java - Java：用随机字符串替换字符串的最简单方法

> ID：237058
> 
> 赞同：2
> 
> 时间：2008-10-25T21:39:59.797
> 
> 标签：java, regex, replace

字符串将由某些符号（例如 ax、bx、dx、c、acc）和数字组成。

例如：ax 5 5 dx 3 acc c ax bx

我想用同一集合的另一个符号（随机）替换一个或所有符号。即，将 {ax,bx,dx,c,acc} 之一替换为 {ax,bx,dx,c,acc} 之一。

替换示例：acc 5 5 dx 3 acc c ax bx 或 c 5 5 dx 3 acc c ax ax

有没有办法用正则表达式做到这一点？在 Java 中？如果是这样，我应该使用哪些方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-25T23:19:43.947

我认为这是从包含它们的超集的字符串中替换特定符号集的最干净的解决方案。appendreplacement 是这个方法的关键。一个重要的警告：不要在元素列表中包含任何未转义的美元字符 ($)。使用 "\$" 转义它们，最终使用
.replaceall("\$","\\$"); 在将每个字符串添加到列表之前。另请参阅对 $ 符号有疑问的[javadoc 。](http://java.sun.com/j2se/1.5.0/docs/api/java/util/regex/Matcher.html#appendReplacement(java.lang.StringBuffer,%20java.lang.String))

```
import java.util.*;
import java.util.regex.Pattern;
import java.util.regex.Matcher;

public class ReplaceTokens {
public static void main(String[] args) {
    List<String> elements = Arrays.asList("ax", "bx", "dx", "c", "acc");
    final String patternStr = join(elements, "|"); //build string "ax|bx|dx|c|acc" 
    Pattern p = Pattern.compile(patternStr);
    Matcher m = p.matcher("ax 5 5 dx 3 acc c ax bx");
    StringBuffer sb = new StringBuffer();
    Random rand = new Random();
    while (m.find()){
        String randomSymbol = elements.get(rand.nextInt(elements.size()));
        m.appendReplacement(sb,randomSymbol);
    }
    m.appendTail(sb);
    System.out.println(sb);
}

/**
 * this method is only needed to generate the string ax|bx|dx|c|acc in a clean way....
 * @see org.apache.commons.lang.StringUtils.join    for a more common alternative...
 */
public static String join(List<String> s, String delimiter) {
    if (s.isEmpty()) return "";
    Iterator<String> iter = s.iterator();
    StringBuffer buffer = new StringBuffer(iter.next());
    while (iter.hasNext()) buffer.append(delimiter).append(iter.next());
    return buffer.toString();
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-25T22:02:52.480

回答第一个问题：没有。

由于您正在执行随机替换，因此正则表达式不会帮助您，正则表达式的任何内容都不是随机的。* 由于您的字符串在一个数组中，因此您不需要使用任何模式匹配来查找它们，因此再次不需要正则表达式。

**编辑：问题已被编辑，因此不再说字符串在数组中。在这种情况下，假设它们都在一个大字符串中，您可以构建一个正则表达式来查找要替换的部分，如其他答案所示。*

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-25T22:10:02.123

使用[Random](http://java.sun.com/j2se/1.4.2/docs/api/java/util/Random.html)类生成一个随机 int 来选择符号的索引。

```
 String text = "ax 5 5 dx 3 acc c ax bx";
    System.out.println("Original: " + text);
    String[] tokens = text.split(" ");
    List<Integer> symbols = new ArrayList<Integer>();
    for(int i=0; i<tokens.length; i++) {
        try {
            Integer.parseInt(tokens[i]);
        } catch (Exception e) {
            symbols.add(i);
        }
    }
    Random rand = new Random();
    // this is the part you can do multiple times
    int source = symbols.get((rand.nextInt(symbols.size())));
    int target = symbols.get((rand.nextInt(symbols.size())));
    tokens[target] = tokens[source];

    String result = tokens[0];
    for(int i=1; i<tokens.length; i++) {
        result = result + " " + tokens[i];
    }
    System.out.println("Result: " + result); 
```

[在将](http://hivemind.apache.org/hivemind1/hivemind/apidocs/org/apache/hivemind/util/StringUtils.html)令牌重新组合在一起*之前*，根据需要进行尽可能多的替换。

这里有两个部分可能看起来很棘手。首先，try catch 来识别那些不是整数的标记。我建议您将该部分提取到它自己的方法中，因为它可以工作，但它有点 hacky。

第二个是我设置`source`和`target`变量的地方。我在那里做的是随机选择一个非数字符号的*索引。*一旦我有两个随机索引，我可以在下一行交换它们。

另一种方法是，在将原始字符串拆分为数组后，从随机选择的符号中构建一个新字符串。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-25T22:15:17.183

1.  是的，这可以通过正则表达式来完成。可能不是很漂亮，不是没有一两个循环
2.  是的，这可以在 Java 中实现。
3.  请参阅[Random](http://java.sun.com/j2se/1.4.2/docs/api/java/util/Random.html)，[正则表达式](http://java.sun.com/j2se/1.4.2/docs/api/java/util/regex)包
4.  该实现留给学生作为练习。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-26T01:42:08.777

谢谢一群人。这就是我想出的。看看你能不能想出一个更有效的方法。

```
private final String[] symbolsPossible = {"ax","bx","cx","dx","foo"};
private boolean exists;
private final String mutate(String s)
{
String[] tokens=s.split(" ");
for(int j=0; j<tokens.length; j++)
if(Math.random()<.1) //10% chance of mutation per token
{
//checking to see if the token is a supported symbol
exists=false;
for(int i=0; i<symbolsPossible.length; i++)
    if(tokens[j].equals(symbolsPossible[i]))
       exists=true;
if(exists)
    tokens[j]=symbolsPossible[(int)Math.random()*symbolsPossible.length];
}
StringBuffer result=new StringBuffer();
for(String t:tokens)
    result.append(t);
return result;
} 
```

# java - 在 Java 中使用正则表达式提取值

> ID：237061
> 
> 赞同：193
> 
> 时间：2008-10-25T21:42:24.097
> 
> 标签：java, regex

我有几个粗略的字符串：

```
[some text] [some number] [some more text] 
```

我想使用 Java Regex 类提取 [some number] 中的文本。

我大致知道我想使用什么正则表达式（尽管欢迎所有建议）。我真正感兴趣的是 Java 调用来获取正则表达式字符串并将其用于源数据以生成 [某个数字] 的值。

编辑：我应该补充一点，我只对一个[某个数字]（基本上是第一个实例）感兴趣。源字符串很短，我不会寻找多次出现的 [some number]。

* * *

## 回答 #1

> 赞同：348
> 
> 时间：2008-10-25T21:47:26.100

完整示例：

```
private static final Pattern p = Pattern.compile("^([a-zA-Z]+)([0-9]+)(.*)");
public static void main(String[] args) {
    // create matcher for pattern p and given string
    Matcher m = p.matcher("Testing123Testing");

    // if an occurrence if a pattern was found in a given string...
    if (m.find()) {
        // ...then you can use group() methods.
        System.out.println(m.group(0)); // whole matched expression
        System.out.println(m.group(1)); // first expression from round brackets (Testing)
        System.out.println(m.group(2)); // second one (123)
        System.out.println(m.group(3)); // third one (Testing)
    }
} 
```

由于您正在寻找第一个数字，您可以使用这样的正则表达式：

```
^\D+(\d+).* 
```

并将`m.group(1)`返回您的第一个数字。请注意，带符号的数字可以包含减号：

```
^\D+(-?\d+).* 
```

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2011-11-14T01:06:43.147

```
import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class Regex1 {
    public static void main(String[]args) {
        Pattern p = Pattern.compile("\\d+");
        Matcher m = p.matcher("hello1234goodboy789very2345");
        while(m.find()) {
            System.out.println(m.group());
        }
    }
} 
```

输出：

```
1234
789
2345 
```

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2008-10-25T21:57:17.280

艾伦基本上有java代码，所以你可以使用它。*但是，仅当*您的数字仅以单词字符流开头时，他的表达式才匹配。

```
"(\\d+)" 
```

应该能够找到第一个数字字符串。如果您确定它将是第一个数字字符串，则无需指定它之前的内容。同样，除非您愿意，否则指定它之后的内容是没有用的。如果您只需要该号码，并且确定它将是一个或多个数字的第一个字符串，那么这就是您所需要的。

如果您希望它被空格抵消，那么指定它会更加明显

```
"\\s+(\\d+)\\s+" 
```

可能会更好。

如果您需要所有三个部分，则可以这样做：

```
"(\\D+)(\\d+)(.*)" 
```

**编辑**Alllain 和 Jack 给出的表达式建议您需要指定一些非数字子集才能捕获*数字*。如果您告诉您正在寻找的正则表达式引擎，`\d`那么它将忽略数字之前的所有内容。如果 J 或 A 的表达式*符合*您的模式，则整个匹配*等于**输入字符串*。而且没有理由指定它。如果没有完全忽略它，它可能会减慢干净的比赛。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2012-02-20T00:08:44.820

除了[Pattern](http://docs.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html)之外，Java [String](http://docs.oracle.com/javase/7/docs/api/java/lang/String.html#split%28java.lang.String,%20int%29)类还有几个可以使用正则表达式的方法，在您的情况下，代码将是：

```
"ab123abc".replaceFirst("\\D*(\\d*).*", "$1") 
```

其中`\\D`是一个非数字字符。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-10-25T21:54:54.697

在 Java 1.4 及更高版本中：

```
String input = "...";
Matcher matcher = Pattern.compile("[^0-9]+([0-9]+)[^0-9]+").matcher(input);
if (matcher.find()) {
    String someNumberStr = matcher.group(1);
    // if you need this to be an int:
    int someNumberInt = Integer.parseInt(someNumberStr);
} 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2012-12-17T14:32:28.183

该函数从字符串中收集所有匹配的序列。在此示例中，它从字符串中获取所有电子邮件地址。

```
static final String EMAIL_PATTERN = "[_A-Za-z0-9-\\+]+(\\.[_A-Za-z0-9-]+)*@"
        + "[A-Za-z0-9-]+(\\.[A-Za-z0-9]+)*(\\.[A-Za-z]{2,})";

public List<String> getAllEmails(String message) {      
    List<String> result = null;
    Matcher matcher = Pattern.compile(EMAIL_PATTERN).matcher(message);

    if (matcher.find()) {
        result = new ArrayList<String>();
        result.add(matcher.group());

        while (matcher.find()) {
            result.add(matcher.group());
        }
    }

    return result;
} 
```

因为`message = "adf@gmail.com, <another@osiem.osiem>>>> lalala@aaa.pl"`它将创建 3 个元素的列表。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-04-05T14:10:59.783

尝试做这样的事情：

```
Pattern p = Pattern.compile("^.+(\\d+).+");
Matcher m = p.matcher("Testing123Testing");

if (m.find()) {
    System.out.println(m.group(1));
} 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2015-06-23T22:01:26.237

## 简单的解决方案

```
// Regexplanation:
// ^       beginning of line
// \\D+    1+ non-digit characters
// (\\d+)  1+ digit characters in a capture group
// .*      0+ any character
String regexStr = "^\\D+(\\d+).*";

// Compile the regex String into a Pattern
Pattern p = Pattern.compile(regexStr);

// Create a matcher with the input String
Matcher m = p.matcher(inputStr);

// If we find a match
if (m.find()) {
    // Get the String from the first capture group
    String someDigits = m.group(1);
    // ...do something with someDigits
} 
```

## Util 类中的解决方案

```
public class MyUtil {
    private static Pattern pattern = Pattern.compile("^\\D+(\\d+).*");
    private static Matcher matcher = pattern.matcher("");

    // Assumptions: inputStr is a non-null String
    public static String extractFirstNumber(String inputStr){
        // Reset the matcher with a new input String
        matcher.reset(inputStr);

        // Check if there's a match
        if(matcher.find()){
            // Return the number (in the first capture group)
            return matcher.group(1);
        }else{
            // Return some default value, if there is no match
            return null;
        }
    }
}

...

// Use the util function and print out the result
String firstNum = MyUtil.extractFirstNumber("Testing4234Things");
System.out.println(firstNum); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-05-24T03:37:54.063

看你可以使用 StringTokenizer

```
String str = "as:"+123+"as:"+234+"as:"+345;
StringTokenizer st = new StringTokenizer(str,"as:");

while(st.hasMoreTokens())
{
  String k = st.nextToken();    // you will get first numeric data i.e 123
  int kk = Integer.parseInt(k);
  System.out.println("k string token in integer        " + kk);

  String k1 = st.nextToken();   //  you will get second numeric data i.e 234
  int kk1 = Integer.parseInt(k1);
  System.out.println("new string k1 token in integer   :" + kk1);

  String k2 = st.nextToken();   //  you will get third numeric data i.e 345
  int kk2 = Integer.parseInt(k2);
  System.out.println("k2 string token is in integer   : " + kk2);
} 
```

由于我们将这些数字数据放入三个不同的变量中，我们可以在代码中的任何位置使用这些数据（以供进一步使用）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-01-13T23:22:41.463

`[^\\d]*([0-9]+[\\s]*[.,]{0,1}[\\s]*[0-9]*).*`我认为它会处理带有小数部分的数字怎么样。我包括了空格并`,`作为可能的分隔符包括在内。我试图从包括浮点数的字符串中取出数字，并考虑到用户可能会犯错误并在输入数字时包含空格。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-04-11T10:23:51.553

有时您可以使用 java.lang.String 中提供的简单 .split("REGEXP") 方法。例如：

```
String input = "first,second,third";

//To retrieve 'first' 
input.split(",")[0] 
//second
input.split(",")[1]
//third
input.split(",")[2] 
```

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2014-04-11T10:32:13.043

如果您正在从文件中读取，那么这可以帮助您

```
 try{
             InputStream inputStream = (InputStream) mnpMainBean.getUploadedBulk().getInputStream();
             BufferedReader br = new BufferedReader(new InputStreamReader(inputStream));
             String line;
             //Ref:03
             while ((line = br.readLine()) != null) {
                if (line.matches("[A-Z],\\d,(\\d*,){2}(\\s*\\d*\\|\\d*:)+")) {
                     String[] splitRecord = line.split(",");
                     //do something
                 }
                 else{
                     br.close();
                     //error
                     return;
                 }
             }
                br.close();

             }
         }
         catch (IOException  ioExpception){
             logger.logDebug("Exception " + ioExpception.getStackTrace());
         } 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2016-08-22T09:47:44.220

```
Pattern p = Pattern.compile("(\\D+)(\\d+)(.*)");
Matcher m = p.matcher("this is your number:1234 thank you");
if (m.find()) {
    String someNumberStr = m.group(2);
    int someNumberInt = Integer.parseInt(someNumberStr);
} 
```

# visual-studio - 如何在VS2008中添加SqlMetal构建步骤？

> ID：237063
> 
> 赞同：0
> 
> 时间：2008-10-25T21:45:10.753
> 
> 标签：visual-studio, visual-studio-2008, linq-to-sql, build-process, sqlmetal

我创建了一个单行批处理文件来运行 SqlMetal 为我的数据库重新生成 LINQ to SQL DataContext；这很好用。

*Refresh_DataContext.bat*：

```
"C:\Program Files\Microsoft SDKs\Windows\v6.0A\Bin\sqlmetal.exe" 
     /server:.\sqlexpress /database:MyDatabaseName 
     /code:"%~dp0\DataContext.vb" /context:DataContext 
     /views /functions /sprocs /pluralize 
```

到目前为止，我可以通过在资源管理器中打开封闭文件夹并运行批处理文件来运行它，我还将它添加到工具菜单 ( `Tools/External Tools.../Add`) 中。

现在我想在构建时（在某些配置中）运行这个批处理文件。我该怎么做呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-26T00:03:35.653

您似乎正在寻找的内容可以在项目属性下的“预构建事件命令行”下找到。单击“构建事件”选项卡，您将有一点空间可以在命令行中输入您想要的内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-23T03:47:28.113

嗬！当然。Web 应用程序项目具有构建前和构建后事件；网站项目没有。

# c++ - C++ 嵌套类让我发疯

> ID：237064
> 
> 赞同：12
> 
> 时间：2008-10-25T21:45:16.400
> 
> 标签：c++, class, nested

我正在尝试编译这段非常简单的代码

```
class myList
{
public:
    std::vector<std::string> vec;
    class Items
    {
    public:
        void Add(std::string str)
        {
            myList::vec.push_back(str);
        };
    }items;
};

int main()
{
    myList newList;
    newList.items.Add("A");
} 
```

在不创建更多需要或过于复杂的东西的情况下，我能做些什么来完成这项工作......

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-25T21:52:43.657

添加几个构造函数和一个指向父类的指针。

```
#include <string>
#include <vector>
class myList
{
public:
    std::vector<std::string> vec;
    myList(): items(this) {} // Added
    class Items
    {
    public:
        Items(myList *ml): self(ml) {}  // Added
        void Add(std::string str)
        {
                self->vec.push_back(str); // Changed
        };
        myList *self; //Added
    }items;
};

int main()
{
    myList newList;
    newList.items.Add("A");
} 
```

您需要 myList() 构造函数，因此它将自身的实例注册到内部类成员变量的实例中。然后，您需要 Items 构造函数来存储指向外部 myList 类实例的指针。最后在 Add 方法中，您需要在存储的 myList 实例中引用 vec。

正如 Catskul 指出的那样，Item 构造函数实际上不能对它接收到的 myList 指针做任何事情。我还想说，虽然这个答案更接近于最初的意图，但 steveth45 的答案更接近于你在真实程序中想要做的事情。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-25T21:52:55.730

这样你就不会直接暴露你的班级成员。你的例子似乎有点过度架构。为什么将 std::vector 放入一个类中，然后将其公开？

```
class myList
{
private:
    std::vector<std::string> vec;
public:
    void Add(std::string str)
    {
        vec.push_back(str);
    };
};

int main()
{
    myList newList;
    newList.Add("A");
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-25T21:58:54.190

与 Java 不同，C++ 中的内部对象无法访问外部“this”指针……如果您考虑一下，可能存在没有可引用的情况。

Richard Quirk 的解决方案是您可以在 C++ 中获得的最接近的解决方案

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-25T21:53:13.717

内部类仅按名称相关。你不能像那样引用基类中的向量。

您要么需要将向量移动到内部类中，要么存储对它的引用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-12-28T22:46:17.670

虽然这篇文章已经有几年了，但我*也许*可以添加一些有用的东西。虽然我会说原始帖子中的类设计看起来不太好，但有时让嵌入式类能够访问包含类是很有用的。这可以很容易地完成，而无需存储额外的指针。下面是一个例子。它应该可以工作，因为我从一些现有代码中获取它并更改了一些名称。关键是 EmbeddorOf 宏。奇迹般有效。

/////////////////.h 文件 /////////////////////

```
struct IReferenceCounted
{
    virtual unsigned long AddRef() = 0;
    virtual unsigned long Release() = 0;
};

struct IFoo : public IReferenceCounted
{
};

class Foo : public IFoo
{
public:
    static IFoo* Create();
    static IFoo* Create(IReferenceCounted* outer, IReferenceCounted** inner);

private:
    Foo();
    Foo(IReferenceCounted* outer);
    ~Foo();

    // IReferenceCounted

    unsigned long AddRef();
    unsigned long Release();

private:
    struct EIReferenceCounted : IReferenceCounted
    {
        // IReferenceCounted

        unsigned long AddRef();
        unsigned long Release();
    } _inner;

    unsigned long _refs;
    IReferenceCounted* _outer;
}; 
```

////////////// .cpp 文件 ///////////////

```
#include <stdio.h>
#include <stddef.h>
#include "Foo.h"

#define EmbeddorOf(class, member, this) \
    (class *) ((char *) this - offsetof(class, member))

// Foo

Foo::Foo() : _refs(1), _outer(&this->_inner)
{
}

Foo::Foo(IReferenceCounted* outer) : _refs(1), _outer(outer)
{
}

Foo::~Foo()
{
    printf("Foo::~Foo()\n");
}

IFoo* Foo::Create()
{
    return new Foo();
}

IFoo* Foo::Create(IReferenceCounted* outer, IReferenceCounted** inner)
{
    Foo* foo = new Foo(outer);
    *inner = &foo->_inner;
    return (IFoo*) foo;
}

// IReferenceCounted

unsigned long Foo::AddRef()
{
    printf("Foo::AddRef()\n");
    return this->_outer->AddRef();
}

unsigned long Foo::Release()
{
    printf("Foo::Release()\n");
    return this->_outer->Release();
}

// Inner IReferenceCounted

unsigned long Foo::EIReferenceCounted::AddRef()
{
    Foo* pThis = EmbeddorOf(Foo, _inner, this);
    return ++pThis->_refs;
}

unsigned long Foo::EIReferenceCounted::Release()
{
    Foo* pThis = EmbeddorOf(Foo, _inner, this);
    unsigned long refs = --pThis->_refs;
    if (refs == 0)
        {

        // Artifically increment so that we won't try to destroy multiple
        // times in the event that our destructor causes AddRef()'s or
        // Releases().

        pThis->_refs = 1;
        delete pThis;
        }
    return refs;
} 
```

缺口

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-02T11:37:45.787

您可以通过以下构造来简化它：

```
typedef std::vector<std::string> myList; 
```

真的为什么不直接使用 STL 向量呢？通过这种方式，您可以获得所有标准算法与数据一起使用。

# windows - 简单的手动启动用户说明，以防 Windows CD 无法自动启动

> ID：237066
> 
> 赞同：0
> 
> 时间：2008-10-25T21:46:46.553
> 
> 标签：windows, cd

我们的 CD 会自动启动，但有时客户会禁用它（通过 CD 刻录机等）。

作为备份，我们在 CD 背面包含说明（如下）。我正在尝试为 Windows XP 及更高版本找到更好的说明。（适用于 Windows 98 及更高版本）

**当前的**

如果它没有自动启动：重复说明（上面）一次。如果再次失败：

1.  点击**开始**| **我的电脑** 或双击Windows® 桌面上的**我的电脑。**
2.  双击 CD 驱动器。看起来像：OurCompany CD (D:)
3.  CD 内容通常在右侧列出。
4.  双击列表中的**开始**。

但是我的电脑选项并不总是在桌面上，当它出现时，客户很难找到它。而且Vista没有标记开始按钮

**选择**

点击“开始” | “运行” 在“打开：”前面的框中输入：d:start（其中“d”是您的 CD-ROM 的驱动器号。

这里的问题是有些人不知道他们的 CD ROM 驱动器号是什么。

有更好的建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-25T21:53:09.927

一种方法可能是：在您的 CD 上制作一个图标，然后让用户查找该图标。

使图标突出，以便于查找并告诉他们双击图标。

在 start.exe 上也使用相同的图标。

您也可以将其他所有内容都移到 CD 上它自己的文件夹中，只在 CD 的根目录上留下 autorun.inf 和 start.exe。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-26T00:08:29.637

好吧，Windows+E 键将打开 Windows 资源管理器。您可以要求他们按下该组合键，这至少可以让他们获得资源管理器窗口，而无需转到桌面...

# sql-server - 为什么SSRS基于的存储过程在几秒钟内返回结果时会报告超时？

> ID：237069
> 
> 赞同：2
> 
> 时间：2008-10-25T21:49:27.797
> 
> 标签：sql-server, stored-procedures, reporting-services, timeout

我有一个呈现从存储过程返回的数据的报告。使用分析器，我可以从报告服务中捕获对存储过程的调用。

报告失败，说明报告超时，但我可以从 SSMS 执行存储过程，它会在五到六秒内返回数据。

请注意，在示例测试运行中，只有两行返回到报告中以进行渲染，尽管在存储过程中它可能已经处理了数千甚至数百万条记录，以便整理传递回报告服务的结果。

我知道存储过程可以进行更多优化，但我不明白为什么当从 SSMS 执行似乎只需要几秒钟时 SSRS 会超时。

另一个问题也浮出水面。如果我重新创建存储过程，报表将再次完美呈现。这很好，除非在短时间内报告再次开始超时。

超时的返回似乎与添加到报告运行的主表中的新数据有关。在我正在测试的示例中，仅插入 100 条新记录就足以搞砸报告。

我更正确地想象它不是根本原因的报告。从 SSRS 执行时，导致超时的是存储过程。

一旦再次超时，我目前最好的解决方法是重新创建存储过程。这似乎不是一个理想的解决方案。

该问题似乎也只发生在我们的生产环境中。我们的测试和开发平台似乎没有出现同样的问题。尽管开发和测试的记录量与生产量不同。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-25T22:10:37.877

正如您所描述的，问题似乎来自存储过程中某些部分的执行计划的变化。查看使用的表保留了哪些统计信息以及添加新行如何影响它们。

> 如果您在列范围的末尾添加很多行（考虑添加自动编号或时间戳），该列的直方图将很快过时。您可以通过执行 UPDATE STATISTICS 语句从 T-SQL 强制立即更新。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-01-13T11:05:47.340

我也遇到过这个问题，即 SPROC 需要几秒钟才能运行，但 SSRS 只是超时。

根据我自己的经验，我发现有几种不同的方法可以解决这个问题。

1.  是参数嗅探！当您的存储过程从 SSRS 执行时，它会“嗅出”您的参数以查看您的 SPROC 是如何使用它们的。SQL Server 随后将根据其发现生成一个执行计划。这在您第一次执行 SPROC 时很好，但您不希望它在每次运行报表时都这样做。因此，我在 SPROC 的顶部声明了一组新变量，它们仅存储在查询中传递的参数并在整个查询中使用这些新参数。

例子：

```
CREATE PROCEDURE [dbo].[usp_REPORT_ITD001]
@StartDate DATETIME,
@EndDate DATETIME,
@ReportTab INT
AS

-- Deter parameter sniffing
DECLARE @snf_StartDate DATETIME = @StartDate
DECLARE @snf_EndDate DATETIME = @EndDate
DECLARE @snf_ReportTab INT = @ReportTab 
```

...这意味着当您的 SPORC 由 SSRS 执行时，它只会查看查询中的前几行以获取传递的参数，而不是整个查询。这大大减少了 SSRS 中的执行时间。

1.  如果您的 SPROC 有很多被声明为变量 ( `DECLARE @MyTable AS TABLE`) 的临时表，那么在生成报告时这些临时表在服务器上（就内存而言）是非常密集的。通过使用散列临时表 ( `SELECT MyCol1, MyCol2 INTO #MyTable`)，SQL Server 会将您的临时表存储在服务器上的 TempDB 中，而不是系统内存中，从而减少报告生成的密集度。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-28T13:06:14.027

有时在存储过程的 CREATE 语句中添加 WITH RECOMPILE 选项会有所帮助。这在过程探索的记录数量以原始执行计划不是最优的方式发生变化的情况下是有效的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T19:24:29.210

基本上到目前为止，我所做的只是进一步优化存储过程，它似乎至少暂时解决了这个问题。

我仍然想知道从 SSMS 和 SSRS 调用 sproc 之间有什么区别。

# python - 如何获取文件创建和修改日期/时间

> ID：237079
> 
> 赞同：1174
> 
> 时间：2008-10-25T21:54:56.553
> 
> 标签：python, file

我有一个脚本需要根据文件创建和修改日期做一些事情，但它必须在 Linux 和 Windows 上运行。

在 Python中获取文件创建和修改*日期/时间*的最佳跨平台方法是什么？

* * *

## 回答 #1

> 赞同：806
> 
> 时间：2016-09-14T23:51:54.443

以跨平台的方式获取某种修改日期很容易 - 只需调用，您将获得文件最后修改时间的 Unix 时间戳。[`os.path.getmtime(*path*)`](https://docs.python.org/library/os.path.html#os.path.getmtime)`path`

另一方面，获取文件*创建日期是繁琐且依赖于平台的，甚至在三大操作系统之间也有所不同：*

*   在**Windows**上，文件`ctime`（记录在[https://msdn.microsoft.com/en-us/library/14h5k7ff.aspx](https://msdn.microsoft.com/en-us/library/14h5k7ff.aspx)中）存储其创建日期。您可以在 Python 中[`os.path.getctime()`](https://docs.python.org/library/os.path.html#os.path.getctime)通过[`.st_ctime`](https://docs.python.org/3/library/os.html#os.stat_result.st_ctime)调用[`os.stat()`](https://docs.python.org/3/library/os.html#os.stat). 这在 Unix 上*不起作用*，在 Unix 上`ctime` [是最后一次更改文件的属性*或*内容](http://www.linux-faqs.info/general/difference-between-mtime-ctime-and-atime)。
*   在**Mac**以及其他一些基于 Unix 的操作系统上，您可以使用[`.st_birthtime`](https://docs.python.org/3/library/os.html#os.stat_result.st_birthtime)调用结果的属性`os.stat()`。
*   在**Linux 上**，这目前是不可能的，至少在没有为 Python 编写 C 扩展的情况下是不可能的。尽管一些 Linux 常用的文件系统[确实存储了创建日期](https://unix.stackexchange.com/questions/7562/what-file-systems-on-linux-store-the-creation-time)（例如，`ext4`将它们存储在 中`st_crtime`），但 Linux 内核[没有提供访问它们的方法](https://unix.stackexchange.com/questions/91197/how-to-find-creation-date-of-file)；`stat()`特别是，它从C 中的调用返回的结构，从最新的内核版本开始，[不包含任何创建日期字段](https://github.com/torvalds/linux/blob/v4.8-rc6/include/linux/stat.h)。您还可以看到，该标识符`st_crtime`目前在[Python 源代码](https://github.com/python/cpython/search?utf8=%E2%9C%93&q=st_crtime)中的任何地方都没有。至少，如果您在 上`ext4`，数据*会*附加到文件系统中的 inode 上，但没有方便的访问方式。

    `mtime`Linux 上的下一个最好的事情是通过结果[`os.path.getmtime()`](https://docs.python.org/library/os.path.html#os.path.getmtime)的属性或[`.st_mtime`](https://docs.python.org/3/library/os.html#os.stat_result.st_mtime)属性访问文件的`os.stat()`. 这将为您提供上次修改文件内容的时间，这对于某些用例可能已经足够了。

将所有这些放在一起，跨平台代码应该看起来像这样......

```
import os
import platform

def creation_date(path_to_file):
    """
    Try to get the date that a file was created, falling back to when it was
    last modified if that isn't possible.
    See http://stackoverflow.com/a/39501288/1709587 for explanation.
    """
    if platform.system() == 'Windows':
        return os.path.getctime(path_to_file)
    else:
        stat = os.stat(path_to_file)
        try:
            return stat.st_birthtime
        except AttributeError:
            # We're probably on Linux. No easy way to get creation dates here,
            # so we'll settle for when its content was last modified.
            return stat.st_mtime 
```

* * *

## 回答 #2

> 赞同：752
> 
> 时间：2008-10-25T22:00:54.527

你有几个选择。一方面，您可以使用[`os.path.getmtime`](https://docs.python.org/library/os.path.html#os.path.getmtime)and[`os.path.getctime`](https://docs.python.org/library/os.path.html#os.path.getctime)函数：

```
import os.path, time
print("last modified: %s" % time.ctime(os.path.getmtime(file)))
print("created: %s" % time.ctime(os.path.getctime(file))) 
```

您的另一个选择是使用[`os.stat`](https://docs.python.org/library/os.html#os.stat)：

```
import os, time
(mode, ino, dev, nlink, uid, gid, size, atime, mtime, ctime) = os.stat(file)
print("last modified: %s" % time.ctime(mtime)) 
```

**注意**：`ctime()`不是指 *nix 系统上的创建时间，而是指最后一次*inode*[数据](https://en.wikipedia.org/wiki/Inode)更改的时间。（感谢[kojiro](https://stackoverflow.com/questions/237079/how-to-get-file-creation-modification-date-times#comment9847709_237084)通过提供指向有趣博客文章的链接，在评论中更清楚地说明了这一事实。）

* * *

## 回答 #3

> 赞同：415
> 
> 时间：2009-10-06T14:51:26.437

为此使用的最佳函数是[os.path.getmtime()](http://docs.python.org/library/os.path.html#os.path.getmtime)。在内部，这只是使用`os.stat(filename).st_mtime`.

datetime 模块是处理时间戳的最佳选择，因此您可以将修改日期作为`datetime`对象获取，如下所示：

```
import os
import datetime
def modification_date(filename):
    t = os.path.getmtime(filename)
    return datetime.datetime.fromtimestamp(t) 
```

使用示例：

```
>>> d = modification_date('/var/log/syslog')
>>> print d
2009-10-06 10:50:01
>>> print repr(d)
datetime.datetime(2009, 10, 6, 10, 50, 1) 
```

* * *

## 回答 #4

> 赞同：145
> 
> 时间：2018-10-17T15:05:36.947

在 Python 3.4 及更高版本中，您可以使用面向对象的[pathlib 模块](https://docs.python.org/3/library/pathlib.html)接口，该接口包含大部分 os 模块的包装器。这是获取文件统计信息的示例。

```
>>> import pathlib
>>> fname = pathlib.Path('test.py')
>>> assert fname.exists(), f'No such file: {fname}'  # check that the file exists
>>> print(fname.stat())
os.stat_result(st_mode=33206, st_ino=5066549581564298, st_dev=573948050, st_nlink=1, st_uid=0, st_gid=0, st_size=413, st_atime=1523480272, st_mtime=1539787740, st_ctime=1523480272) 
```

有关`os.stat_result`包含内容的更多信息，请参阅[文档](https://docs.python.org/3/library/os.html#os.stat_result)。对于您想要的修改时间`fname.stat().st_mtime`：

```
>>> import datetime
>>> mtime = datetime.datetime.fromtimestamp(fname.stat().st_mtime, tz=datetime.timezone.utc)
>>> print(mtime)
datetime.datetime(2018, 10, 17, 10, 49, 0, 249980) 
```

如果你想在 Windows 上创建时间，或者在 Unix 上最近的元数据更改，你可以使用`fname.stat().st_ctime`：

```
>>> ctime = datetime.datetime.fromtimestamp(fname.stat().st_ctime, tz=datetime.timezone.utc)
>>> print(ctime)
datetime.datetime(2018, 4, 11, 16, 57, 52, 151953) 
```

[本文](https://realpython.com/python-pathlib/)有更多有用的信息和 pathlib 模块的示例。

* * *

## 回答 #5

> 赞同：48
> 
> 时间：2008-10-25T21:58:01.913

[操作系统统计](https://docs.python.org/2/library/stat.html#module-stat)

在较新的代码中，您可能应该使用[os.path.getmtime()](http://docs.python.org/library/os.path.html#os.path.getmtime)（[谢谢，Christian Oudard](https://stackoverflow.com/questions/237079/how-to-get-file-creation-and-modification-date-times/237082#comment1381307_237082)）。

*但请注意，它返回time_t*的浮点值，带有小数秒（如果您的操作系统支持它）。

* * *

## 回答 #6

> 赞同：46
> 
> 时间：2008-10-25T22:05:20.260

获取 mod 时间有两种方法，os.path.getmtime() 或 os.stat()，但 ctime 跨平台不可靠（见下文）。

### [os.path.getmtime()](http://www.python.org/doc/2.5.2/lib/module-os.path.html)

**getmtime** ( *path* )
*返回上次修改路径的时间。返回值是一个数字，给出自纪元以来的秒数（参见时间模块）。如果文件不存在或不可访问，则引发 os.error。版本 1.5.2 中的新功能。在 2.3 版更改: 如果 os.stat_float_times() 返回 True，则结果为浮点数。*

### [os.stat()](http://www.python.org/doc/2.5.2/lib/os-file-dir.html)

**stat** ( *path* )
*在给定路径上执行 stat() 系统调用。返回值是一个对象，其属性对应于stat结构的成员，即：st_mode（保护位），st_ino（inode编号），st_dev（设备），st_nlink（硬链接数），st_uid（所有者的用户ID） )、st_gid（所有者的组 ID）、st_size（文件大小，以字节为单位）、st_atime（最近访问时间）、**st_mtime**（最近内容修改时间）、**st_ctime**（平台相关；最近元数据更改时间在 Unix 上，或在 Windows 上创建时间）*：

```
>>> import os
>>> statinfo = os.stat('somefile.txt')
>>> statinfo
(33188, 422511L, 769L, 1, 1032, 100, 926L, 1105022698,1105022732, 1105022732)
>>> statinfo.st_size
926L
>>> 
```

在上面的示例中，您将使用 statinfo.st_mtime 或 statinfo.st_ctime 分别获取 mtime 和 ctime。

* * *

## 回答 #7

> 赞同：45
> 
> 时间：2018-12-03T02:59:34.050

```
import os, time, datetime

file = "somefile.txt"
print(file)

print("Modified")
print(os.stat(file)[-2])
print(os.stat(file).st_mtime)
print(os.path.getmtime(file))

print()

print("Created")
print(os.stat(file)[-1])
print(os.stat(file).st_ctime)
print(os.path.getctime(file))

print()

modified = os.path.getmtime(file)
print("Date modified: "+time.ctime(modified))
print("Date modified:",datetime.datetime.fromtimestamp(modified))
year,month,day,hour,minute,second=time.localtime(modified)[:-3]
print("Date modified: %02d/%02d/%d %02d:%02d:%02d"%(day,month,year,hour,minute,second))

print()

created = os.path.getctime(file)
print("Date created: "+time.ctime(created))
print("Date created:",datetime.datetime.fromtimestamp(created))
year,month,day,hour,minute,second=time.localtime(created)[:-3]
print("Date created: %02d/%02d/%d %02d:%02d:%02d"%(day,month,year,hour,minute,second)) 
```

印刷

```
somefile.txt
Modified
1429613446
1429613446.0
1429613446.0

Created
1517491049
1517491049.28306
1517491049.28306

Date modified: Tue Apr 21 11:50:46 2015
Date modified: 2015-04-21 11:50:46
Date modified: 21/04/2015 11:50:46

Date created: Thu Feb  1 13:17:29 2018
Date created: 2018-02-01 13:17:29.283060
Date created: 01/02/2018 13:17:29 
```

注意：Linux 上文件的 ctime 与 Windows 上的略有不同。
Windows 用户将其称为“创建时间”。
Linux 用户将他们称为“更改时间”。

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2008-10-25T22:06:37.200

`os.stat`返回具有`st_mtime`和`st_ctime`属性的命名元组。修改时间`st_mtime`在两个平台上；不幸的是，在 Windows 上，`ctime`意味着“创建时间”，而在 POSIX 上，它意味着“更改时间”。我不知道有什么方法可以在 POSIX 平台上获得创建时间。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2019-05-27T22:36:04.307

可能值得看一下[`crtime`](https://github.com/kootenpv/crtime)实现跨平台访问文件创建时间的库。

```
from crtime import get_crtimes_in_dir

for fname, date in get_crtimes_in_dir(".", raise_on_error=True, as_epoch=False):
    print(fname, date)
    # file_a.py Mon Mar 18 20:51:18 CET 2019 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-25T22:07:44.607

```
>>> import os
>>> os.stat('feedparser.py').st_mtime
1136961142.0
>>> os.stat('feedparser.py').st_ctime
1222664012.233
>>> 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-02-11T00:13:15.313

如果以下符号链接不重要，也可以使用`os.lstat`内置的。

```
>>> os.lstat("2048.py")
posix.stat_result(st_mode=33188, st_ino=4172202, st_dev=16777218L, st_nlink=1, st_uid=501, st_gid=20, st_size=2078, st_atime=1423378041, st_mtime=1423377552, st_ctime=1423377553)
>>> os.lstat("2048.py").st_atime
1423378041.0 
```

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2008-12-14T23:39:46.203

`os.stat`确实包括创建时间。`os.stat()`对于包含时间的元素，没有 st_anything 的定义。

所以试试这个：

`os.stat('feedparser.py')[8]`

将其与您在 ls -lah 中的文件上的创建日期进行比较

他们应该是一样的。

# ruby-on-rails - 如何验证 Markdown？

> ID：237085
> 
> 赞同：7
> 
> 时间：2008-10-25T22:01:14.247
> 
> 标签：ruby-on-rails, ruby, markdown

使用无效语法编写[Markdown内容是可能的。](http://en.wikipedia.org/wiki/Markdown)无效意味着[BlueCloth](http://www.deveiate.org/projects/BlueCloth)库无法解析内容并引发异常。Rails 中的`markdown`帮助程序不会捕获任何 BlueCloth 异常，因此无法呈现完整页面（而是呈现 500 Server Error 页面）。

在我的例子中，允许用户编写 Markdown 内容并将其保存到数据库中。如果有人使用了无效语法，则该内容的所有连续呈现尝试都会失败（状态代码 500 - 内部服务器错误）。

你如何解决这个问题？是否可以在保存到数据库之前在模型级别验证 Markdown 语法？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-25T23:32:05.437

您应该编写自己的验证方法，在该方法中初始化 BlueCloth 对象，并尝试调用`to_html`捕获任何异常的方法。如果捕获异常，则验证失败，否则应该没问题。

在您的模型中：

```
protected:

def validate
  bc = BlueCloth.new(your_markdown_string_attribute)
  begin
    bc.to_html
  rescue
    errors.add(:your_markdown_string_attribute, 'has invalid markdown syntax')
  end
end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T10:37:26.347

我做了一些研究并决定使用[RDiscount](http://github.com/rtomayko/rdiscount/tree/master)而不是 BlueCloth。RDiscount 似乎比 BlueCloth 更快、更可靠。

在 Rails 环境中集成 RDiscount 很容易。包括以下内容`environment.rb`，您就可以开始使用了：

```
begin
  require "rdiscount"
  BlueCloth = RDiscount
rescue LoadError
  # BlueCloth is still the our fallback,
  # if RDiscount is not available
  require 'bluecloth'
end 
```

（使用 Rails 2.2.0 测试）

# visual-studio-2008 - 如何获得 Visual Studio 2008 SP1 的投标？

> ID：237091
> 
> 赞同：11
> 
> 时间：2008-10-25T22:04:13.880
> 
> 标签：visual-studio-2008, sql-server-2008, sql-server-express, bids

我目前使用 Visual Studio 2008 SP1，并且一直在将旧项目迁移到 VS2008，但现有的 SSIS 和 SSRS (2005) 项目与 VS2008 不兼容。将这些 BIDS 项目作为单独的解决方案进行维护是一件痛苦的事情。

我一直在考虑升级到 SQL2008，但是因为我们的开发、测试和生产平台都是 SQL2005 企业版，我不喜欢我的本地环境偏离当前标准的想法。尽管想要 VS2008 的投标。

我刚刚安装了带有所有位的 Sql Express 2008 并且我发生了一些事情... Sql Express 2008 是否只是安装了我需要的所有 BIDS 位而不需要我升级我的本地版本的 Sql Server？

这是为 VS2008 安装 BIDS 的可行方法还是我遗漏了什么？

**更新**

我只是有一个想法...为什么不直接从完整的 SQL Server 2008 安装工具，因为我可以访问它。

Express 2008 中的工具和完整的 Sql Server 2008 之间的工具之间存在哪些差异仍然是个问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-25T22:10:36.317

SQL Server 2005 的 BIDS 基于 Visual Studio 2005。AFAIK 它不会直接安装到 VS2008 中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-26T09:39:43.283

至于 BIDS 2008 版本，我认为没有。

虽然 SQL Server Enterprise（开发）和 Standard 支持的功能有所不同，但 BIDS 应该相同。

正如 NXC 上面评论的那样，我认为 SQL Server Express 不包括 BIDS。在[MSDN](http://msdn.microsoft.com/en-us/library/cc645993.aspx)中也是如此。但是您可以更好地看到它:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T09:26:25.057

根据我的经验，您可以在您的机器上同时安装 BIDS 2008 和 BIDS 2005，只需从 SQL Server 2008 安装向导的客户端工具部分中选择它。您不需要安装新的 SQL Server 实例（就像使用 Express 一样）或升级现有实例。

AFAIK 你不能用 BIDS 2008 来定位 SS 2005。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-31T00:33:35.137

这似乎工作正常，但我确实遇到了一点障碍，至少在 SSRS 中是这样。我似乎无法从 BIDS 2008 部署到 SSRS 2005。似乎在 2005 年至 2008 年间 RDL 发生了一些重大变化。

因此，在我们将 SS2008 安装到我们的服务器之前，我们似乎一直在维护两种解决方案——一种用于应用程序，另一种用于应用程序的任何 BIDS 开发。

请注意，SSIS 项目也是如此。VS2008 中的 BIDS 不适用于 SQL2005 :(

# c# - 使用自己的 PowerShell CmdLets 向我的 C# Windows 服务发送管理命令

> ID：237096
> 
> 赞同：9
> 
> 时间：2008-10-25T22:09:18.380
> 
> 标签：c#, powershell, cmdlets

我有一个运行服务的 C# Windows 应用程序。我想利用 PowerShell 来提供命令行管理界面来管理我正在运行的服务。

从我的角度来看，我正在尝试提供与 Exchange 2007 相同的管理界面。

您对如何启动/设计管理 cmdlet 以“连接”到正在运行的服务以查询或发送管理命令有任何建议或示例代码吗？

如何从 powershell 命令行访问服务的内部运行时状态？例如，我想实现一个名为 Get-ConnectionsInfo 的 cmdlet，以了解执行该 cmdlet 时我的 Windows 服务使用了多少出站连接。

一个实际的例子或一个例子的网络链接将非常受欢迎。

谢谢，罗伯特

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-26T09:25:51.760

一个解决方案是让您的 Windows 服务通过 WCF 公开一个管理界面。您的 PowerShell 命令将使用此 WCF 服务来提取信息并使 Windows 服务执行操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-03T03:45:54.510

这里的关键是首先编写一个您可以从 .Net 访问的 API，然后您可以轻松地将对该 API 的调用封装到一个 DLL 中，该 DLL 公开作为 PowerShell cmdlet 的类。如果您希望某人能够远程管理您的服务，那么我认为最好的办法可能是创建执行此操作的 Web 服务或 WCF 服务，然后您可以将其包装在 PowerShell 中。如果您查看 codeplex，您会发现一些管理基于 Web 的远程服务的示例，例如 GoGrid 和 SQL Data Services，它们将为您提供一些示例代码以帮助您入门。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-26T11:08:17.933

我想到了另一种公开 Windows 服务内部状态的方法。您可以通过 WMI 公开信息，这些信息可以从 PowerShell 或您的 PowerShell 命令中使用。

我不确定您是否能够告诉您的服务通过 WMI 执行操作，但您至少能够退出状态。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-26T11:56:45.887

第三种选择可能是使 Windows 服务成为[PowerShell 内容提供者](http://msdn.microsoft.com/en-us/library/cc136039(VS.85).aspx)。但是我从来没有自己制作过，所以我不确定它们是否适合托管在 Windows 服务中，因为该服务可能不会一直运行。

# javascript - 如何检查数组是否包含 JavaScript 中的值？

> ID：237104
> 
> 赞同：4574
> 
> 时间：2008-10-25T22:14:40.913
> 
> 标签：javascript, arrays, algorithm, time-complexity, javascript-objects

找出 JavaScript 数组是否包含值的最简洁有效的方法是什么？

这是我知道的唯一方法：

```
function contains(a, obj) {
    for (var i = 0; i < a.length; i++) {
        if (a[i] === obj) {
            return true;
        }
    }
    return false;
} 
```

有没有更好更简洁的方法来实现这一点？

* * *

## 回答 #1

> 赞同：5026
> 
> 时间：2009-09-24T19:35:24.250

现代浏览器有[`Array#includes`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/includes#Browser_compatibility)，它*正是*这样做的，并且得到了除 IE 之外的所有人[的广泛支持](https://kangax.github.io/compat-table/es2016plus/#test-Array.prototype.includes)：

```
console.log(['joe', 'jane', 'mary'].includes('jane')); //true
```

您也可以使用[`Array#indexOf`](https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Array/indexOf)，它不那么直接，但对于过时的浏览器不需要 polyfill。

```
console.log(['joe', 'jane', 'mary'].indexOf('jane') >= 0); //true
```

* * *

许多框架也提供了类似的方法：

*   jQuery：[`$.inArray(value, array, [fromIndex])`](http://api.jquery.com/jquery.inarray/)
*   Underscore.js：（[`_.contains(array, value)`](http://underscorejs.org/#contains)也别名为`_.include`and `_.includes`）
*   道场工具包：[`dojo.indexOf(array, value, [fromIndex, findLast])`](http://dojotoolkit.org/reference-guide/dojo/indexOf.html)
*   原型：[`array.indexOf(value)`](http://api.prototypejs.org/language/Array/prototype/indexOf/)
*   Moo工具：[`array.indexOf(value)`](https://mootools.net/core/docs/1.6.0/Types/Array#Array:indexOf)
*   MochiKit：[`findValue(array, value)`](http://mochi.github.io/mochikit/doc/html/MochiKit/Base.html#fn-findvalue)
*   微软阿贾克斯：[`array.indexOf(value)`](http://www.asp.net/ajaxlibrary/Reference.Array-indexOf-Function.ashx)
*   分机：[`Ext.Array.contains(array, value)`](http://docs.sencha.com/extjs/4.0.0/#/api/Ext.Array-method-contains)
*   Lodash：（[`_.includes(array, value, [from])`](https://lodash.com/docs#includes)是`_.contains`4.0.0 之前的版本）
*   拉姆达：[`R.includes(value, array)`](https://ramdajs.com/docs/#includes)

请注意，一些框架将其实现为一个函数，而另一些框架则将该函数添加到数组原型中。

* * *

## 回答 #2

> 赞同：480
> 
> 时间：2008-10-25T23:10:22.610

**2019 年更新：此答案来自 2008 年（11 岁！），与现代 JS 使用无关。承诺的性能改进是基于当时在浏览器中完成的基准测试。它可能与现代 JS 执行上下文无关。如果您需要一个简单的解决方案，请寻找其他答案。如果您需要最佳性能，请在相关执行环境中为自己进行基准测试。**

正如其他人所说，通过数组进行迭代可能是最好的方式，但[已经证明](http://blogs.oracle.com/greimer/entry/best_way_to_code_a)递减`while`循环是 JavaScript 中最快的迭代方式。所以你可能想重写你的代码如下：

```
function contains(a, obj) {
    var i = a.length;
    while (i--) {
       if (a[i] === obj) {
           return true;
       }
    }
    return false;
} 
```

当然，你也可以扩展 Array 原型：

```
Array.prototype.contains = function(obj) {
    var i = this.length;
    while (i--) {
        if (this[i] === obj) {
            return true;
        }
    }
    return false;
} 
```

现在您可以简单地使用以下内容：

```
alert([1, 2, 3].contains(2)); // => true
alert([1, 2, 3].contains('2')); // => false 
```

* * *

## 回答 #3

> 赞同：233
> 
> 时间：2008-10-25T22:49:53.367

[`indexOf`](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Array/indexOf)也许吧，但它是“ECMA-262 标准的 JavaScript 扩展；因此它可能不会出现在该标准的其他实现中。”

例子：

```
[1, 2, 3].indexOf(1) => 0
["foo", "bar", "baz"].indexOf("bar") => 1
[1, 2, 3].indexOf(4) => -1 
```

AFAICS [Microsoft 没有*为此*](http://msdn.microsoft.com/en-us/library/k4h76zbx%5C%28VS.85%5C%29.aspx)[提供](http://soledadpenades.com/2007/05/17/arrayindexof-in-internet-explorer/)[某种替代方案](http://msdn.microsoft.com/en-us/library/k4h76zbx%5C%28VS.85%5C%29.aspx)，但`indexOf`如果您愿意，您[可以](http://google.com/search?q=indexof%20internet%20explorer)在 Internet Explorer（以及其他不支持）。

* * *

## 回答 #4

> 赞同：187
> 
> 时间：2014-07-18T14:36:31.877

最重要的答案假定原始类型，但如果你想知道一个数组是否包含一个具有某种特征的**对象，** [Array.prototype.some()](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/some)是一个优雅的解决方案：

```
const items = [ {a: '1'}, {a: '2'}, {a: '3'} ]

items.some(item => item.a === '3')  // returns true
items.some(item => item.a === '4')  // returns false 
```

它的好处是一旦找到元素就会中止迭代，这样就可以避免不必要的迭代周期。

此外，它非常适合`if`语句，因为它返回一个布尔值：

```
if (items.some(item => item.a === '3')) {
  // do something
} 
```

* 正如 jamess 在评论中指出的那样，在 2018 年 9 月给出这个答案时，`Array.prototype.some()`完全支持：[caniuse.com 支持表](http://kangax.github.io/compat-table/es5/#test-Array_methods_Array.prototype.some_a_href=_https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/some_title=_MDN_documentation_img_src=_../mdn.png_alt=_MDN_(Mozilla_Development_Network)_logo_width=_15_height=_13_/_/a_nbsp;)

* * *

## 回答 #5

> 赞同：186
> 
> 时间：2015-01-01T01:40:39.387

ECMAScript 7 引入了[`Array.prototype.includes`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/includes).

它可以这样使用：

```
[1, 2, 3].includes(2); // true
[1, 2, 3].includes(4); // false 
```

它还接受可选的第二个参数`fromIndex`：

```
[1, 2, 3].includes(3, 3); // false
[1, 2, 3].includes(3, -1); // true 
```

与`indexOf`使用[Strict Equality Comparison](http://www.ecma-international.org/ecma-262/6.0/#sec-strict-equality-comparison)的不同，`includes`使用[SameValueZero](http://www.ecma-international.org/ecma-262/6.0/#sec-samevaluezero)相等算法进行比较。这意味着您可以检测数组是否包含`NaN`：

```
[1, 2, NaN].includes(NaN); // true 
```

也不同于`indexOf`,`includes`不会跳过缺失的索引：

```
new Array(5).includes(undefined); // true 
```

目前它仍然是一个草稿，但可以通过[polyfill](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/includes#Polyfill)使其适用于所有浏览器。

* * *

## 回答 #6

> 赞同：121
> 
> 时间：2012-03-24T04:59:59.917

假设您已经定义了一个这样的数组：

```
const array = [1, 2, 3, 4] 
```

以下是检查是否有a的三种方法`3`。它们都返回`true`或`false`。

### Native Array 方法（自 ES2016 起）（[兼容性表](https://caniuse.com/#feat=array-includes)）

```
array.includes(3) // true 
```

### 作为自定义 Array 方法（ES2016 之前）

```
// Prefixing the method with '_' to avoid name clashes
Object.defineProperty(Array.prototype, '_includes', { value: function (v) { return this.indexOf(v) !== -1 }})
array._includes(3) // true 
```

### 简单的功能

```
const includes = (a, v) => a.indexOf(v) !== -1
includes(array, 3) // true 
```

* * *

## 回答 #7

> 赞同：83
> 
> 时间：2008-10-27T00:38:57.563

这是一个与[JavaScript 1.6 兼容](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Objects/Array/indexOf)的实现`Array.indexOf`：

```
if (!Array.indexOf) {
    Array.indexOf = [].indexOf ?
        function(arr, obj, from) {
            return arr.indexOf(obj, from);
        } :
        function(arr, obj, from) { // (for IE6)
            var l = arr.length,
                i = from ? parseInt((1 * from) + (from < 0 ? l : 0), 10) : 0;
            i = i < 0 ? 0 : i;
            for (; i < l; i++) {
                if (i in arr && arr[i] === obj) {
                    return i;
                }
            }
            return -1;
        };
} 
```

* * *

## 回答 #8

> 赞同：59
> 
> 时间：2013-09-13T17:32:04.823

采用：

```
function isInArray(array, search)
{
    return array.indexOf(search) >= 0;
}

// Usage
if(isInArray(my_array, "my_value"))
{
    //...
} 
```

* * *

## 回答 #9

> 赞同：55
> 
> 时间：2009-08-27T16:45:59.520

扩展 JavaScript`Array`对象是一个非常糟糕的主意，因为您将新属性（您的自定义方法）引入`for-in`可能会破坏现有脚本的循环中。几年前，[Prototype](http://en.wikipedia.org/wiki/Prototype_JavaScript_Framework)库的作者不得不重新设计他们的库实现以删除这种东西。

如果您不需要担心与页面上运行的其他 JavaScript 的兼容性，那就去吧，否则，我会推荐更笨拙但更安全的独立函数解决方案。

* * *

## 回答 #10

> 赞同：40
> 
> 时间：2020-01-07T11:51:40.297

## 表现

今天 2020.01.07 我在 Chrome v78.0.0、Safari v13.0.4 和 Firefox v71.0.0 上对 MacOs HighSierra 10.13.6 进行了 15 种选定解决方案的测试。结论

*   基于`JSON`,`Set`并且令人惊讶的是`find`(K,N,O) 的解决方案在所有浏览器上都是最慢的
*   es6 `includes`(F) 仅在 chrome 上速度很快
*   基于`for`(C,D) 和`indexOf`(G,H) 的解决方案在小型和大型阵列上的所有浏览器上都非常快，因此它们可能是有效解决方案的最佳选择
*   循环期间索引减少的解决方案，(B) 速度较慢可能是因为[CPU 缓存的工作](https://stackoverflow.com/questions/1950878/c-for-loop-indexing-is-forward-indexing-faster-in-new-cpus)方式。
*   当搜索的元素位于数组长度的 66% 位置时，我还对大数组进行了测试，基于`for`(C,D,E) 的解决方案给出了类似的结果（~630 ops/sec - 但 safari 和 firefox 上的 E 为 10-比 C 和 D 慢 20%）

## 结果

[![在此处输入图像描述](https://i.stack.imgur.com/YPIG1.png)](https://i.stack.imgur.com/YPIG1.png)

## 细节

我执行 2 个测试用例：对于具有 10 个元素的数组和具有 100 万个元素的数组。在这两种情况下，我们都将搜索到的元素放在数组中间。

```
let log = (name,f) => console.log(`${name}: 3-${f(arr,'s10')}  's7'-${f(arr,'s7')}  6-${f(arr,6)} 's3'-${f(arr,'s3')}`)

let arr = [1,2,3,4,5,'s6','s7','s8','s9','s10'];
//arr = new Array(1000000).fill(123); arr[500000]=7;

function A(a, val) {
    var i = -1;
    var n = a.length;
    while (i++<n) {
       if (a[i] === val) {
           return true;
       }
    }
    return false;
}

function B(a, val) {
    var i = a.length;
    while (i--) {
       if (a[i] === val) {
           return true;
       }
    }
    return false;
}

function C(a, val) {
    for (var i = 0; i < a.length; i++) {
        if (a[i] === val) return true;
    }
    return false;
}

function D(a,val)
{
    var len = a.length;
    for(var i = 0 ; i < len;i++)
    {
        if(a[i] === val) return true;
    }
    return false;
} 

function E(a, val){  
  var n = a.length-1;
  var t = n/2;
  for (var i = 0; i <= t; i++) {
        if (a[i] === val || a[n-i] === val) return true;
  }
  return false;
}

function F(a,val) {
	return a.includes(val);
}

function G(a,val) {
	return a.indexOf(val)>=0;
}

function H(a,val) {
	return !!~a.indexOf(val);
}

function I(a, val) {
  return a.findIndex(x=> x==val)>=0;
}

function J(a,val) {
	return a.some(x=> x===val);
}

function K(a, val) {
  const s = JSON.stringify(val);
  return a.some(x => JSON.stringify(x) === s);
}

function L(a,val) {
	return !a.every(x=> x!==val);
}

function M(a, val) {
  return !!a.find(x=> x==val);
}

function N(a,val) {
	return a.filter(x=>x===val).length > 0;
}

function O(a, val) {
  return new Set(a).has(val);
}

log('A',A);
log('B',B);
log('C',C);
log('D',D);
log('E',E);
log('F',F);
log('G',G);
log('H',H);
log('I',I);
log('J',J);
log('K',K);
log('L',L);
log('M',M);
log('N',N);
log('O',O);
```

```
This shippet only presents functions used in performance tests - it not perform tests itself!
```

**小数组 - 10 个元素**

您可以在您的机器上执行测试[这里](https://jsperf.com/array-exist-element/1)

[![在此处输入图像描述](https://i.stack.imgur.com/gDDCp.png)](https://i.stack.imgur.com/gDDCp.png)

**大数组 - 1.000.000 个元素**

您可以在您的机器上执行测试[这里](https://jsperf.com/array-big-exist-element/1)

[![在此处输入图像描述](https://i.stack.imgur.com/cTL3s.png)](https://i.stack.imgur.com/cTL3s.png)

* * *

## 回答 #11

> 赞同：35
> 
> 时间：2015-01-07T12:49:43.560

单线：

```
function contains(arr, x) {
    return arr.filter(function(elem) { return elem == x }).length > 0;
} 
```

* * *

## 回答 #12

> 赞同：34
> 
> 时间：2009-12-23T15:59:59.953

开箱即用，如果您多次多次进行此调用，则使用~~关联数组~~和 Map 使用散列函数进行查找会效率更高。

[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Map)

* * *

## 回答 #13

> 赞同：28
> 
> 时间：2014-06-15T01:15:33.440

我使用以下内容：

```
Array.prototype.contains = function (v) {
    return this.indexOf(v) > -1;
}

var a = [ 'foo', 'bar' ];

a.contains('foo'); // true
a.contains('fox'); // false 
```

* * *

## 回答 #14

> 赞同：24
> 
> 时间：2014-09-12T16:55:36.463

```
function contains(a, obj) {
    return a.some(function(element){return element == obj;})
} 
```

[Array.prototype.some()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/some)在第 5 版中被添加到 ECMA-262 标准中

* * *

## 回答 #15

> 赞同：20
> 
> 时间：2008-10-25T22:44:57.730

如果您使用 JavaScript 1.6 或更高版本（Firefox 1.5 或更高版本），则可以使用[Array.indexOf](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Objects/Array/indexOf)。否则，我认为您最终会得到类似于原始代码的内容。

* * *

## 回答 #16

> 赞同：19
> 
> 时间：2015-05-19T20:23:07.807

**希望更快的双向`indexOf`/`lastIndexOf`替代方案**

## 2015

虽然新方法[包含](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/includes)非常好，但目前支持基本上为零。

很长时间以来，我一直在想办法替换缓慢的 indexOf/lastIndexOf 函数。

已经找到了一种高效的方法，查看最重要的答案。从那些我选择了`contains`@Damir Zekic 发布的函数中，它应该是最快的。但它也指出，基准是从 2008 年开始的，因此已经过时。

我也更喜欢`while`，`for`但不是出于特定原因，我结束了用 for 循环编写函数。也可以使用`while --`.

如果我在执行过程中检查数组的两侧，我很好奇迭代是否会慢得多。显然没有，所以这个函数比投票最多的函数快两倍左右。显然它也比原生的更快。这是在现实世界环境中，您永远不知道您正在搜索的值是在数组的开头还是结尾。

当您知道您刚刚推送了一个带有值的数组时，使用 lastIndexOf 可能仍然是最好的解决方案，但是如果您必须遍历大数组并且结果可能无处不在，这可能是使事情变得更快的可靠解决方案。

**双向 indexOf/lastIndexOf**

```
function bidirectionalIndexOf(a, b, c, d, e){
  for(c=a.length,d=c*1; c--; ){
    if(a[c]==b) return c; //or this[c]===b
    if(a[e=d-1-c]==b) return e; //or a[e=d-1-c]===b
  }
  return -1
}

//Usage
bidirectionalIndexOf(array,'value'); 
```

### 性能测试

[http://jsperf.com/bidirectionalindexof](http://jsperf.com/bidirectionalindexof)

作为测试，我创建了一个包含 100k 条目的数组。

三个查询：在数组的开头、中间和结尾。

我希望你也觉得这很有趣并测试性能。

注意：如您所见，我稍微修改了函数以`contains`反映 indexOf 和 lastIndexOf 输出（基本上`true`使用`index`and ）。那不应该伤害它。`false``-1`

### 数组原型变体

```
Object.defineProperty(Array.prototype,'bidirectionalIndexOf',{value:function(b,c,d,e){
  for(c=this.length,d=c*1; c--; ){
    if(this[c]==b) return c; //or this[c]===b
    if(this[e=d-1-c] == b) return e; //or this[e=d-1-c]===b
  }
  return -1
},writable:false, enumerable:false});

// Usage
array.bidirectionalIndexOf('value'); 
```

该函数也可以很容易地修改为返回真或假，甚至返回对象、字符串或其他任何东西。

这是`while`变体：

```
function bidirectionalIndexOf(a, b, c, d){
  c=a.length; d=c-1;
  while(c--){
    if(b===a[c]) return c;
    if(b===a[d-c]) return d-c;
  }
  return c
}

// Usage
bidirectionalIndexOf(array,'value'); 
```

### 这怎么可能？

我认为在数组中获取反射索引的简单计算非常简单，它比执行实际循环迭代快两倍。

这是一个复杂的示例，每次迭代执行三项检查，但这只有通过更长的计算才能实现，这会导致代码变慢。

[http://jsperf.com/bidirectionalindexof/2](http://jsperf.com/bidirectionalindexof/2)

* * *

## 回答 #17

> 赞同：17
> 
> 时间：2012-06-27T12:32:05.340

```
function inArray(elem,array)
{
    var len = array.length;
    for(var i = 0 ; i < len;i++)
    {
        if(array[i] == elem){return i;}
    }
    return -1;
} 
```

如果找到则返回数组索引，如果未找到则返回 -1

* * *

## 回答 #18

> 赞同：17
> 
> 时间：2014-09-10T12:12:52.847

我们使用这个片段（适用于对象、数组、字符串）：

```
/*
 * @function
 * @name Object.prototype.inArray
 * @description Extend Object prototype within inArray function
 *
 * @param {mix}    needle       - Search-able needle
 * @param {bool}   searchInKey  - Search needle in keys?
 *
 */
Object.defineProperty(Object.prototype, 'inArray',{
    value: function(needle, searchInKey){

        var object = this;

        if( Object.prototype.toString.call(needle) === '[object Object]' || 
            Object.prototype.toString.call(needle) === '[object Array]'){
            needle = JSON.stringify(needle);
        }

        return Object.keys(object).some(function(key){

            var value = object[key];

            if( Object.prototype.toString.call(value) === '[object Object]' || 
                Object.prototype.toString.call(value) === '[object Array]'){
                value = JSON.stringify(value);
            }

            if(searchInKey){
                if(value === needle || key === needle){
                return true;
                }
            }else{
                if(value === needle){
                    return true;
                }
            }
        });
    },
    writable: true,
    configurable: true,
    enumerable: false
}); 
```

**用法：**

```
var a = {one: "first", two: "second", foo: {three: "third"}};
a.inArray("first");          //true
a.inArray("foo");            //false
a.inArray("foo", true);      //true - search by keys
a.inArray({three: "third"}); //true

var b = ["one", "two", "three", "four", {foo: 'val'}];
b.inArray("one");         //true
b.inArray('foo');         //false
b.inArray({foo: 'val'})   //true
b.inArray("{foo: 'val'}") //false

var c = "String";
c.inArray("S");        //true
c.inArray("s");        //false
c.inArray("2", true);  //true
c.inArray("20", true); //false 
```

* * *

## 回答 #19

> 赞同：16
> 
> 时间：2011-02-05T18:02:43.090

如果您反复检查数组中是否存在对象，您可能应该查看

1.  [通过在数组中进行插入排序来](http://en.wikipedia.org/wiki/Insertion_sort)保持数组始终排序（将新对象放在正确的位置）
2.  将对象更新为删除+排序插入操作和
3.  在[您](http://en.wikipedia.org/wiki/Binary_search_algorithm)的`contains(a, obj)`.

* * *

## 回答 #20

> 赞同：16
> 
> 时间：2017-01-25T00:22:34.863

适用于所有现代浏览器的解决方案：

```
function contains(arr, obj) {
  const stringifiedObj = JSON.stringify(obj); // Cache our object to not call `JSON.stringify` on every iteration
  return arr.some(item => JSON.stringify(item) === stringifiedObj);
} 
```

用法：

```
contains([{a: 1}, {a: 2}], {a: 1}); // true 
```

IE6+解决方案：

```
function contains(arr, obj) {
  var stringifiedObj = JSON.stringify(obj)
  return arr.some(function (item) {
    return JSON.stringify(item) === stringifiedObj;
  });
}

// .some polyfill, not needed for IE9+
if (!('some' in Array.prototype)) {
  Array.prototype.some = function (tester, that /*opt*/) {
    for (var i = 0, n = this.length; i < n; i++) {
      if (i in this && tester.call(that, this[i], i, this)) return true;
    } return false;
  };
} 
```

用法：

```
contains([{a: 1}, {a: 2}], {a: 1}); // true 
```

# 为什么要使用`JSON.stringify`？

`Array.indexOf`并且`Array.includes`（以及此处的大多数答案）仅按参考而不是按价值进行比较。

```
[{a: 1}, {a: 2}].includes({a: 1});
// false, because {a: 1} is a new object 
```

# 奖金

未优化的 ES6 单行：

```
[{a: 1}, {a: 2}].some(item => JSON.stringify(item) === JSON.stringify({a: 1));
// true 
```

* * *

注意：如果键的顺序相同，按值比较对象会更好，所以为了安全起见，您可以先使用如下包对键进行排序：[https ://www.npmjs.com/package/sort-keys](https://www.npmjs.com/package/sort-keys)

* * *

`contains`使用性能优化更新了功能。感谢[itinance](https://stackoverflow.com/users/1397160/itinance)指出。

* * *

## 回答 #21

> 赞同：12
> 
> 时间：2015-10-21T10:57:15.843

使用 lodash 的[一些](https://lodash.com/docs#some)功能。

它简洁，准确，并具有出色的跨平台支持。

接受的答案甚至不符合要求。

*要求：*推荐最简洁有效的方法来判断一个 JavaScript 数组是否包含一个对象。

**接受的答案：**

```
$.inArray({'b': 2}, [{'a': 1}, {'b': 2}])
> -1 
```

**我的建议：**

```
_.some([{'a': 1}, {'b': 2}], {'b': 2})
> true 
```

笔记：

$.inArray 可以很好地确定*标*量值是否存在于标量数组中...

```
$.inArray(2, [1,2])
> 1 
```

...但问题显然要求一种有效的方法来确定*对象*是否包含在数组中。

为了同时处理标量和对象，您可以这样做：

```
(_.isObject(item)) ? _.some(ary, item) : (_.indexOf(ary, item) > -1) 
```

* * *

## 回答 #22

> 赞同：10
> 
> 时间：2012-04-22T05:17:01.463

虽然`array.indexOf(x)!=-1`这是最简洁的方法（并且已经被非 Internet Explorer 浏览器支持了十多年......），但它不是 O(1)，而是 O(N)，这很糟糕。如果您的数组不会改变，您可以将数组转换为哈希表，然后执行`table[x]!==undefined`or `===undefined`：

```
Array.prototype.toTable = function() {
    var t = {};
    this.forEach(function(x){t[x]=true});
    return t;
} 
```

演示：

```
var toRemove = [2,4].toTable();
[1,2,3,4,5].filter(function(x){return toRemove[x]===undefined}) 
```

（不幸的是，虽然您可以创建一个 Array.prototype.contains 来“冻结”一个数组并将一个哈希表存储在 this._cache 中的两行中，但如果您选择稍后编辑您的数组，这将给出错误的结果。JavaScript 没有足够的钩子来让你保持这种状态，不像 Python 例如。）

* * *

## 回答 #23

> 赞同：10
> 
> 时间：2014-05-29T16:55:25.180

ECMAScript 6 在 find 上有一个优雅的提议。

> find 方法对数组中存在的每个元素执行一次回调函数，直到找到一个回调函数返回真值。如果找到这样的元素，find 立即返回该元素的值。否则，find 返回 undefined。回调仅针对已分配值的数组索引调用；对于已被删除或从未被赋值的索引，它不会被调用。

这是[MDN 文档](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/find)。

查找功能是这样工作的。

```
function isPrime(element, index, array) {
    var start = 2;
    while (start <= Math.sqrt(element)) {
        if (element % start++ < 1) return false;
    }
    return (element > 1);
}

console.log( [4, 6, 8, 12].find(isPrime) ); // Undefined, not found
console.log( [4, 5, 8, 12].find(isPrime) ); // 5 
```

您可以通过[定义函数](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/find#Polyfill)在 ECMAScript 5 及以下版本中使用它。

```
if (!Array.prototype.find) {
  Object.defineProperty(Array.prototype, 'find', {
    enumerable: false,
    configurable: true,
    writable: true,
    value: function(predicate) {
      if (this == null) {
        throw new TypeError('Array.prototype.find called on null or undefined');
      }
      if (typeof predicate !== 'function') {
        throw new TypeError('predicate must be a function');
      }
      var list = Object(this);
      var length = list.length >>> 0;
      var thisArg = arguments[1];
      var value;

      for (var i = 0; i < length; i++) {
        if (i in list) {
          value = list[i];
          if (predicate.call(thisArg, value, i, list)) {
            return value;
          }
        }
      }
      return undefined;
    }
  });
} 
```

* * *

## 回答 #24

> 赞同：10
> 
> 时间：2015-11-16T12:26:09.610

可以使用具有“has()”方法的[Set ：](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Set)

```
function contains(arr, obj) {
      var proxy = new Set(arr);
      if (proxy.has(obj))
        return true;
      else
        return false;
    }

    var arr = ['Happy', 'New', 'Year'];
    console.log(contains(arr, 'Happy'));
```

* * *

## 回答 #25

> 赞同：10
> 
> 时间：2019-10-11T17:38:31.267

此要求的简单解决方案是使用`find()`

如果您有如下对象数组，

```
var users = [{id: "101", name: "Choose one..."},
{id: "102", name: "shilpa"},
{id: "103", name: "anita"},
{id: "104", name: "admin"},
{id: "105", name: "user"}]; 
```

然后您可以检查具有您的值的对象是否已经存在：

```
let data = users.find(object => object['id'] === '104'); 
```

如果数据为空，则没有管理员，否则它将返回现有对象，例如：

```
{id: "104", name: "admin"} 
```

然后您可以在数组中找到该对象的索引并使用代码替换该对象：

```
let indexToUpdate = users.indexOf(data);
let newObject = {id: "104", name: "customer"};
users[indexToUpdate] = newObject;//your new object
console.log(users); 
```

您将获得如下价值：

```
[{id: "101", name: "Choose one..."},
{id: "102", name: "shilpa"},
{id: "103", name: "anita"},
{id: "104", name: "customer"},
{id: "105", name: "user"}]; 
```

* * *

## 回答 #26

> 赞同：8
> 
> 时间：2013-10-06T12:25:35.487

采用：

```
var myArray = ['yellow', 'orange', 'red'] ;

alert(!!~myArray.indexOf('red')); //true 
```

[演示](http://jsfiddle.net/An5jQ/)

要确切了解此时`tilde` `~`该做什么，请参阅此问题*[波浪号在表达式之前有什么作用？](https://stackoverflow.com/questions/12299665/what-does-a-tilde-do-when-it-precedes-an-expression)*.

* * *

## 回答 #27

> 赞同：7
> 
> 时间：2017-07-02T11:31:12.463

好的，你可以**优化你的**代码来得到结果！

有很多方法可以做到这一点，更干净，更好，但我只是想得到你的模式并将其应用于 using `JSON.stringify`，只需在你的情况下做这样的事情：

```
function contains(a, obj) {
    for (var i = 0; i < a.length; i++) {
        if (JSON.stringify(a[i]) === JSON.stringify(obj)) {
            return true;
        }
    }
    return false;
} 
```

* * *

## 回答 #28

> 赞同：7
> 
> 时间：2019-04-07T13:42:50.477

惊讶于这个问题仍然没有添加最新的语法，增加了我的 2 美分。

假设我们有一个对象数组 arrObj，我们想在其中搜索 obj。

数组.原型。**indexOf** -> （返回**index 或 -1**）通常用于查找数组中元素的索引。这也可以用于搜索对象，但仅在您传递对同一对象的引用时才有效。

```
let obj = { name: 'Sumer', age: 36 };
let arrObj = [obj, { name: 'Kishor', age: 46 }, { name: 'Rupen', age: 26 }];

console.log(arrObj.indexOf(obj));// 0
console.log(arrObj.indexOf({ name: 'Sumer', age: 36 })); //-1

console.log([1, 3, 5, 2].indexOf(2)); //3 
```

数组.原型。**包括**-> （返回**true**或**false**）

```
console.log(arrObj.includes(obj));  //true
console.log(arrObj.includes({ name: 'Sumer', age: 36 })); //false

console.log([1, 3, 5, 2].includes(2)); //true 
```

数组.原型。**find** ->（接受回调，返回第一个在 CB 中返回 true 的**值/对象）。**

```
console.log(arrObj.find(e => e.age > 40));  //{ name: 'Kishor', age: 46 }
console.log(arrObj.find(e => e.age > 40)); //{ name: 'Kishor', age: 46 }

console.log([1, 3, 5, 2].find(e => e > 2)); //3 
```

数组.原型。**findIndex** ->（接受回调，返回CB 中返回 true 的第一个值/对象的**索引）。**

```
console.log(arrObj.findIndex(e => e.age > 40));  //1
console.log(arrObj.findIndex(e => e.age > 40)); //1

console.log([1, 3, 5, 2].findIndex(e => e > 2)); //1 
```

由于 find 和 findIndex 接受回调，我们可以通过创造性地设置 true 条件从数组中获取任何对象（即使我们没有引用）。

* * *

## 回答 #29

> 赞同：6
> 
> 时间：2016-01-09T06:38:43.947

绝不是最好的，但我只是在发挥创造力并添加到曲目中。

### 不要使用这个

```
Object.defineProperty(Array.prototype, 'exists', {
  value: function(element, index) {

    var index = index || 0

    return index === this.length ? -1 : this[index] === element ? index : this.exists(element, ++index)
  }
})

// Outputs 1
console.log(['one', 'two'].exists('two'));

// Outputs -1
console.log(['one', 'two'].exists('three'));

console.log(['one', 'two', 'three', 'four'].exists('four'));
```

* * *

## 回答 #30

> 赞同：6
> 
> 时间：2017-12-05T11:16:14.543

它有一个参数：一组对象数。数组中的每个对象都有两个整数属性，分别用 x 和 y 表示。该函数必须返回数组中满足的所有此类对象的计数`numbers.x == numbers.y`

```
var numbers = [ { x: 1, y: 1 },
                { x: 2, y: 3 },
                { x: 3, y: 3 },
                { x: 3, y: 4 },
                { x: 4, y: 5 } ];
var count = 0; 
var n = numbers.length;
for (var i =0;i<n;i++)
{
  if(numbers[i].x==numbers[i].y)
    {count+=1;}
}

alert(count);
```

* * *

## 回答 #31

> 赞同：6
> 
> 时间：2018-12-15T10:27:24.820

```
 function countArray(originalArray) {

    	var compressed = [];
    	// make a copy of the input array
    	var copyArray = originalArray.slice(0);

    	// first loop goes over every element
    	for (var i = 0; i < originalArray.length; i++) {

    		var count = 0;	
    		// loop over every element in the copy and see if it's the same
    		for (var w = 0; w < copyArray.length; w++) {
    			if (originalArray[i] == copyArray[w]) {
    				// increase amount of times duplicate is found
    				count++;
    				// sets item to undefined
    				delete copyArray[w];
    			}
    		}

    		if (count > 0) {
    			var a = new Object();
    			a.value = originalArray[i];
    			a.count = count;
    			compressed.push(a);
    		}
    	}

    	return compressed;
    };

    // It should go something like this:

    var testArray = new Array("dog", "dog", "cat", "buffalo", "wolf", "cat", "tiger", "cat");
    var newArray = countArray(testArray);
    console.log(newArray);
```

* * *

## 回答 #32

> 赞同：6
> 
> 时间：2020-06-08T10:21:39.073

使用`Array.prototype.includes`例如：

```
const fruits = ['coconut', 'banana', 'apple']

const doesFruitsHaveCoconut = fruits.includes('coconut')// true

console.log(doesFruitsHaveCoconut)
```

也许从 MDN 阅读此文档：[https ://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/includes](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/includes)

* * *

## 回答 #33

> 赞同：5
> 
> 时间：2009-08-27T17:10:53.293

下面是[Prototype 的做法](http://github.com/sstephenson/prototype/blob/f405b2c510e09b55d08c926a9e1a5c2e2d0a1834/src/lang/array.js#L286-302)：

```
/**
 *  Array#indexOf(item[, offset = 0]) -> Number
 *  - item (?): A value that may or may not be in the array.
 *  - offset (Number): The number of initial items to skip before beginning the
 *      search.
 *
 *  Returns the position of the first occurrence of `item` within the array &mdash; or
 *  `-1` if `item` doesn't exist in the array.
**/
function indexOf(item, i) {
  i || (i = 0);
  var length = this.length;
  if (i < 0) i = length + i;
  for (; i < length; i++)
    if (this[i] === item) return i;
  return -1;
} 
```

另请参阅[此处](http://github.com/sstephenson/prototype/blob/f405b2c510e09b55d08c926a9e1a5c2e2d0a1834/src/lang/array.js#L364-365)了解他们如何连接它。

* * *

## 回答 #34

> 赞同：5
> 
> 时间：2016-01-10T10:06:46.780

你也可以使用这个技巧：

```
var arrayContains = function(object) {
  return (serverList.filter(function(currentObject) {
    if (currentObject === object) {
      return currentObject
    }
    else {
      return false;
    }
  }).length > 0) ? true : false
} 
```

* * *

## 回答 #35

> 赞同：5
> 
> 时间：2017-08-18T04:20:33.347

1.  要么使用`Array.indexOf(Object)`.
2.  使用 ECMA 7 可以使用`Array.includes(Object)`.
3.  使用 ECMA 6，您可以使用`Array.find(FunctionName)`where`FunctionName`是用户定义的函数来搜索数组中的对象。

    希望这可以帮助！

* * *

## 回答 #36

> 赞同：5
> 
> 时间：2020-04-24T08:26:33.280

**使用 indexOf()**

您可以使用 indexOf() 方法检查给定值或元素是否存在于数组中。indexOf() 方法如果找到则返回数组内元素的索引，如果未找到则返回 -1。让我们看一下下面的例子：

```
var fruits = ["Apple", "Banana", "Mango", "Orange", "Papaya"];
var a = "Mango";
checkArray(a, fruits);

function checkArray(a, fruits) {
  // Check if a value exists in the fruits array
  if (fruits.indexOf(a) !== -1) {
    return document.write("true");
  } else {
    return document.write("false");
  }
}
```

**使用 include() 方法**

ES6 引入了 includes() 方法来非常容易地执行此任务。但是，此方法仅返回 true 或 false 而不是索引号：

```
var fruits = ["Apple", "Banana", "Mango", "Orange", "Papaya"];
alert(fruits.includes("Banana")); // Outputs: true
alert(fruits.includes("Coconut")); // Outputs: false
alert(fruits.includes("Orange")); // Outputs: true
alert(fruits.includes("Cherry")); // Outputs: false
```

[如需进一步参考，请在此处](https://www.tutorialrepublic.com/faq/how-to-check-if-a-value-exists-in-an-array-in-javascript.php)结帐

* * *

## 回答 #37

> 赞同：4
> 
> 时间：2012-01-06T13:43:14.063

采用：

```
Array.prototype.contains = function(x){
  var retVal = -1;

  // x is a primitive type
  if(["string","number"].indexOf(typeof x)>=0 ){ retVal = this.indexOf(x);}

  // x is a function
  else if(typeof x =="function") for(var ix in this){
    if((this[ix]+"")==(x+"")) retVal = ix;
  }

  //x is an object...
  else {
    var sx=JSON.stringify(x);
    for(var ix in this){
      if(typeof this[ix] =="object" && JSON.stringify(this[ix])==sx) retVal = ix;
    }
  }

  //Return False if -1 else number if numeric otherwise string
  return (retVal === -1)?false : ( isNaN(+retVal) ? retVal : +retVal);
} 
```

我知道这不是最好的方法，但由于没有原生的 IComparable 方式来在对象之间进行交互，我想这与比较数组中的两个实体一样接近。此外，扩展 Array 对象可能不是明智之举，但有时也可以（如果您知道它并进行权衡）。

* * *

## 回答 #38

> 赞同：4
> 
> 时间：2017-06-19T00:41:49.077

或者这个解决方案：

```
Array.prototype.includes = function (object) {
  return !!+~this.indexOf(object);
}; 
```

* * *

## 回答 #39

> 赞同：4
> 
> 时间：2018-01-25T04:03:51.293

如果您使用的是 ES6，您可以使用一组：

```
function arrayHas( array, element ) {
    const s = new Set(array);
    return s.has(element)
} 
```

这应该比任何其他方法都更高效

* * *

## 回答 #40

> 赞同：4
> 
> 时间：2018-06-26T10:03:01.150

我建议使用下划线库，因为它返回值并支持所有浏览器。

[下划线](https://underscorejs.org/)

```
 var findValue = _.find(array, function(item) {
    return item.id == obj.id;
 }); 
```

* * *

## 回答 #41

> 赞同：4
> 
> 时间：2020-01-26T17:21:23.063

**将唯一项目添加到另一个列表**

```
searchResults: [
                {
                    name: 'Hello',
                    artist: 'Selana',
                    album: 'Riga',
                    id: 1,
                },
                {
                    name: 'Hello;s',
                    artist: 'Selana G',
                    album: 'Riga1',
                    id: 2,
                },
                {
                    name: 'Hello2',
                    artist: 'Selana',
                    album: 'Riga11',
                    id: 3,
                }
            ],
            playlistTracks: [
              {
                name: 'Hello',
                artist: 'Mamunuus',
                album: 'Riga',
                id: 4,
              },
              {
                name: 'Hello;s',
                artist: 'Mamunuus G',
                album: 'Riga1',
                id: 2,
              },
              {
                name: 'Hello2',
                artist: 'Mamunuus New',
                album: 'Riga11',
                id: 3,
              }
            ],
            playlistName: "New PlayListTrack",
        };
    }

    // Adding an unique track in the playList
    addTrack = track => {
      if(playlistTracks.find(savedTrack => savedTrack.id === track.id)) {
        return;
      }
      playlistTracks.push(track);

      this.setState({
        playlistTracks
      })
    }; 
```

* * *

## 回答 #42

> 赞同：3
> 
> 时间：2013-03-12T05:44:52.173

正如其他人提到的，您可以使用`Array.indexOf`，但并非在所有浏览器中都可用。这是来自[https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/indexOf](https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/indexOf)的代码，以使其在旧浏览器中的工作方式相同。

> indexOf 是 ECMA-262 标准的最新补充；因此，它可能不会出现在所有浏览器中。您可以通过在脚本开头插入以下代码来解决此问题，从而允许在本机不支持它的实现中使用 indexOf。该算法正是 ECMA-262 第 5 版中指定的算法，假设 Object、TypeError、Number、Math.floor、Math.abs 和 Math.max 具有其原始值。

```
if (!Array.prototype.indexOf) {
    Array.prototype.indexOf = function (searchElement /*, fromIndex */ ) {
        "use strict";
        if (this == null) {
            throw new TypeError();
        }
        var t = Object(this);
        var len = t.length >>> 0;
        if (len === 0) {
            return -1;
        }
        var n = 0;
        if (arguments.length > 1) {
            n = Number(arguments[1]);
            if (n != n) { // shortcut for verifying if it's NaN
                n = 0;
            } else if (n != 0 && n != Infinity && n != -Infinity) {
                n = (n > 0 || -1) * Math.floor(Math.abs(n));
            }
        }
        if (n >= len) {
            return -1;
        }
        var k = n >= 0 ? n : Math.max(len - Math.abs(n), 0);
        for (; k < len; k++) {
            if (k in t && t[k] === searchElement) {
                return k;
            }
        }
        return -1;
    }
} 
```

* * *

## 回答 #43

> 赞同：3
> 
> 时间：2017-08-02T11:57:35.613

使用 idnexOf() 是一个很好的解决方案，但您应该隐藏嵌入式实现 indexOf() 函数，该函数使用 ~ 运算符返回 -1：

```
function include(arr,obj) { 
    return !!(~arr.indexOf(obj)); 
} 
```

* * *

## 回答 #44

> 赞同：3
> 
> 时间：2017-09-05T04:34:58.117

我正在做一个项目，我需要一个像 python`set`这样的功能来删除所有重复值并返回一个新列表，所以我写了这个函数可能对某人有用

```
function set(arr) {
    var res = [];
    for (var i = 0; i < arr.length; i++) {
        if (res.indexOf(arr[i]) === -1) {
            res.push(arr[i]);
        }
    }
    return res;
} 
```

* * *

## 回答 #45

> 赞同：3
> 
> 时间：2018-10-29T16:42:27.880

除了其他人所说的之外，如果您没有要在数组中搜索的对象的引用，那么您可以执行类似的操作。

```
let array = [1, 2, 3, 4, {"key": "value"}];

array.some((element) => JSON.stringify(element) === JSON.stringify({"key": "value"})) // true

array.some((element) => JSON.stringify(element) === JSON.stringify({})) // true 
```

如果任何元素与给定条件匹配，则 Array.some 返回 true，如果没有任何元素与给定条件匹配，则返回 false。

* * *

## 回答 #46

> 赞同：3
> 
> 时间：2020-01-23T08:54:28.007

`Object.keys`用于获取对象的所有属性名称并过滤与指定字符串完全或部分匹配的所有值。

```
function filterByValue(array, string) {
  return array.filter(o =>
    Object.keys(o).some(k => o[k].toLowerCase().includes(string.toLowerCase())));
}

const arrayOfObject = [{
  name: 'Paul',
  country: 'Canada',
}, {
  name: 'Lea',
  country: 'Italy',
}, {
  name: 'John',
  country: 'Italy'
}];

console.log(filterByValue(arrayOfObject, 'lea')); // [{name: 'Lea', country: 'Italy'}]
console.log(filterByValue(arrayOfObject, 'ita')); // [{name: 'Lea', country: 'Italy'}, {name: 'John', country: 'Italy'}]
```

您还可以按特定键进行过滤，例如。

```
Object.keys(o).some(k => o.country.toLowerCase().includes(string.toLowerCase()))); 
```

现在您可以在过滤后检查数组计数以检查值是否包含。

希望它有帮助。

* * *

## 回答 #47

> 赞同：3
> 
> 时间：2020-05-24T09:48:16.717

这可能是一个**详细而简单**的解决方案。

```
//plain array
var arr = ['a', 'b', 'c'];
var check = arr.includes('a');
console.log(check); //returns true
if (check)
{
   // value exists in array
   //write some codes
}

// array with objects
var arr = [
      {x:'a', y:'b'},
      {x:'p', y:'q'}
  ];

// if you want to check if x:'p' exists in arr
var check = arr.filter(function (elm){
    if (elm.x == 'p')
    {
       return elm; // returns length = 1 (object exists in array)
    }
});

// or y:'q' exists in arr
var check = arr.filter(function (elm){
    if (elm.y == 'q')
    {
       return elm; // returns length = 1 (object exists in array)
    }
});

// if you want to check, if the entire object {x:'p', y:'q'} exists in arr
var check = arr.filter(function (elm){
    if (elm.x == 'p' && elm.y == 'q')
    {
       return elm; // returns length = 1 (object exists in array)
    }
});

// in all cases
console.log(check.length); // returns 1

if (check.length > 0)
{
   // returns true
   // object exists in array
   //write some codes
} 
```

* * *

## 回答 #48

> 赞同：2
> 
> 时间：2012-11-23T16:44:57.963

类似的事情：通过“搜索 lambda”查找第一个元素：

```
Array.prototype.find = function(search_lambda) {
  return this[this.map(search_lambda).indexOf(true)];
}; 
```

用法：

```
[1,3,4,5,8,3,5].find(function(item) { return item % 2 == 0 })
=> 4 
```

在咖啡脚本中相同：

```
Array.prototype.find = (search_lambda) -> @[@map(search_lambda).indexOf(true)] 
```

* * *

## 回答 #49

> 赞同：2
> 
> 时间：2013-07-03T16:26:33.260

我查看了提交的答案，发现它们仅在您通过参考搜索对象时适用。带有参考对象比较的简单线性搜索。

但是假设您没有对对象的引用，您将如何在数组中找到正确的对象？您将不得不对每个对象进行线性和深度比较。想象一下，如果列表太大，并且其中的对象非常大，包含大量文本。性能随着数组中元素的数量和大小而急剧下降。

您可以对对象进行字符串化并将它们放入本机哈希表中，但是您将有数据冗余记住这些键，因为 JavaScript 将它们保留为“for i in obj”，并且您只想检查对象是否存在，即，你有钥匙。

我考虑了一段时间来构建一个 JSON Schema 验证器，我为本地哈希表设计了一个简单的包装器，类似于唯一的哈希表实现，但有一些优化异常，我留给本地哈希表处理。它只需要性能基准测试......所有细节和代码都可以在我的博客上找到： http: [//stamat.wordpress.com/javascript-quickly-find-very-large-objects-in-a-large-array/](http://stamat.wordpress.com/javascript-quickly-find-very-large-objects-in-a-large-array/) 我将很快发布基准测试结果。

完整的解决方案是这样工作的：

```
var a = {'a':1,
 'b':{'c':[1,2,[3,45],4,5],
 'd':{'q':1, 'b':{'q':1, 'b':8},'c':4},
 'u':'lol'},
 'e':2};

 var b = {'a':1, 
 'b':{'c':[2,3,[1]],
 'd':{'q':3,'b':{'b':3}}},
 'e':2};

 var c = "Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.";

 var hc = new HashCache([{a:3, b:2, c:5}, {a:15, b:2, c:'foo'}]); //init

 hc.put({a:1, b:1});
 hc.put({b:1, a:1});
 hc.put(true);
 hc.put('true');
 hc.put(a);
 hc.put(c);
 hc.put(d);
 console.log(hc.exists('true'));
 console.log(hc.exists(a));
 console.log(hc.exists(c));
 console.log(hc.exists({b:1, a:1}));
 hc.remove(a);
 console.log(hc.exists(c)); 
```

* * *

## 回答 #50

> 赞同：2
> 
> 时间：2021-12-17T06:45:52.197

检查数组 JavaScript 中是否存在值的最佳默认方法是`some()`

**Array.prototype.some()**

该`some()`方法测试数组中的至少一个元素是否通过了提供的函数实现的测试。如果在数组中找到所提供函数为其返回 true 的元素，则返回 true；否则返回false。它不会修改数组。

```
const array = [1, 2, 3, 4, 5];

// checks whether an element is even
const even = (element) => element % 2 === 0;

console.log(array.some(even));
// expected output: true 
```

该`some`方法是**浏览器兼容性中最好的一种** [![浏览器兼容性](https://i.stack.imgur.com/uDTp4.png)](https://i.stack.imgur.com/uDTp4.png)

更多文档[Array.prototype.some() - JavaScript | MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/some)

您也可以使用其他两种方法是`find()`和`includes()`。使用这些方法，您可以获得结果，但不是最好的。

[Array.prototype.find() - JavaScript | MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/find)

[Array.prototype.includes() - JavaScript | MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/includes)

* * *

## 回答 #51

> 赞同：1
> 
> 时间：2018-10-10T07:48:52.000

> 简单的解决方案：ES6 Features " **includes** " 方法

```
let arr = [1, 2, 3, 2, 3, 2, 3, 4];

  arr.includes(2) // true

  arr.includes(93) // false 
```

* * *

## 回答 #52

> 赞同：1
> 
> 时间：2021-07-23T13:55:57.157

使用正则表达式：

```
console.log(new RegExp('26242').test(['23525', '26242', '25272'].join(''))) // true 
```

* * *

## 回答 #53

> 赞同：1
> 
> 时间：2021-12-31T15:03:45.423

有几个选项可以做到这一点，包括`includes`, `some`, `find`, `findIndex`。

```
const array = [1, 2, 3, 4, 5, 6, 7];

console.log(array.includes(3));
//includes() determines whether an array includes a certain value among its entries

console.log(array.some(x => x === 3)); 
//some() tests if at least one element in the array passes the test implemented by the provided function

console.log(array.find(x => x === 3) ? true : false);
//find() returns the value of the first element in the provided array that satisfies the provided testing function

console.log(array.findIndex(x => x === 3) > -1 ? true : false);
//findIndex() returns the index of the first element in the array that satisfies the provided testing function, else returning -1.
```

* * *

## 回答 #54

> 赞同：0
> 
> 时间：2020-12-14T17:33:14.037

您可以使用 findIndex 函数来检查数组是否具有特定值。

```
arrObj.findIndex(obj => obj === comparedValue) !== -1; 
```

如果 arrObj 包含 compareValue，则返回 true，否则返回 false。

* * *

## 回答 #55

> 赞同：-4
> 
> 时间：2011-05-10T19:14:40.343

字面上地：

（使用 Firefox v3.6，`for-in`注意事项如前所述（但是，下面的使用可能支持`for-in`此目的！也就是说，枚举实际上通过属性索引存在的数组元素（但是，特别是，数组`length`属性未在财产`for-in`清单！）。）。）

（拖放以下完整 URI 以进行即时模式浏览器测试。）

### JavaScript：

```
 function ObjInRA(ra){var has=false; for(i in ra){has=true; break;} return has;}

  function check(ra){
      return ['There is ',ObjInRA(ra)?'an':'NO',' object in [',ra,'].'].join('')
  }
  alert([
            check([{}]), check([]), check([,2,3]),
            check(['']), '\t (a null string)', check([,,,])
        ].join('\n')); 
```

显示：

```
There is an object in [[object Object]].
There is NO object in [].
There is an object in [,2,3].
There is an object in [].
     (a null string)
There is NO object in [,,]. 
```

皱纹：如果寻找“特定”对象，请考虑：

JavaScript：`alert({}!={}); alert({}!=={});`

因此：

### JavaScript：

```
 obj = {prop:"value"}; 
 ra1 = [obj]; 
 ra2 = [{prop:"value"}];
 alert(ra1[0] == obj); 
 alert(ra2[0] == obj); 
```

通常`ra2`被认为是“包含”`obj`作为文字实体`{prop:"value"}`。

一个非常粗略、基本、幼稚（如代码需要资格增强）的解决方案：

### JavaScript：

```
 obj={prop:"value"};   ra2=[{prop:"value"}];
  alert(
    ra2 . toSource() . indexOf( obj.toSource().match(/^.(.*).$/)[1] ) != -1 ?
      'found' :
      'missing' ); 
```

请参阅参考：*[在 JavaScript 数组中搜索对象](https://stackoverflow.com/questions/3624741/searching-for-objects-in-javascript-arrays/5750179#5750179)*。

* * *

## 回答 #56

> 赞同：-9
> 
> 时间：2010-08-04T14:05:17.590

只是另一种选择

```
// usage: if ( ['a','b','c','d'].contains('b') ) { ... }
Array.prototype.contains = function(value){
    for (var key in this)
        if (this[key] === value) return true;
    return false;
} 
```

请小心，因为使用自定义方法重载 javascript 数组对象可能会破坏其他 javascript 的行为，从而导致意外行为。

# c - 在 Delphi 中从 C DLL 获取字符串返回值

> ID：237106
> 
> 赞同：4
> 
> 时间：2008-10-25T22:15:50.783
> 
> 标签：c, delphi, dll

我有一个用 C 编写的遗留 DLL，其中包含一个返回字符串的函数，我需要从 Delphi 访问这个函数。我拥有的关于 DLL 的唯一信息是用于访问函数的 VB 声明：

公共声明函数 DecryptStr Lib "strlib" (Str As String) As String

我尝试了以下但没有成功：

宣言：

```
function DecryptStr(s: PChar): PChar; cdecl; external 'strlib.dll'; 
```

用法：

```
var
  p1, p2 : pchar;
begin
  GetMem( p1, 255 );
  StrPCopy( p2, 'some string to decrypt' );
  p1 := DecryptStr( p2 );
end; 
```

这始终使 DLL 因访问冲突而崩溃。我不知所措。

有什么建议么 ？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-26T07:26:42.497

考虑重写您的测试代码，如下所示：

```
var
  p1, p2 : pchar;
begin
  GetMem( p1, 255 ); // initialize
  GetMem( p2, 255 );
  StrPLCopy( p2, 'some string to decrypt', 255 ); // prevent buffer overrun
  StrPLCopy( p1, DecryptStr( p2 ), 255); // make a copy since dll will free its internal buffer
end; 
```

如果调用 DecryptStr 仍然失败，请仔细阅读[http://support.microsoft.com/kb/187912](http://support.microsoft.com/kb/187912)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-26T06:24:13.887

p2 未初始化。StrPCopy 将字符串复制到随机内存位置。最有可能的调用约定是stdcall。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-26T00:15:01.013

我在这里猜，但你确定它是 cdecl 吗？如果 VB 声明没有提到它，我会假设它实际上是一个 STDCALL 函数（STDCALL 在 Windows 上很常见，因为几乎所有的原生 API 都使用它）。调用一个调用约定的函数，就好像它是另一个调用约定的函数一样，真的会弄乱堆栈，通常会导致崩溃。

此外，请务必检查字符串是 ANSI (LPSTR/LPCSTR) 还是 UNICODE (LPWSTR/LPCWSTR)。我不知道VB或Delphi，所以我不知道每个人默认使用什么。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-27T10:22:46.043

正如 Jozz 所说，在您的示例中从未初始化 p2 （您将字符串复制到的位置）。

试试这个。

```
var
  p1, p2 : pchar;
begin
  GetMem( p2, 255 ); // allocate memory for 'some string...'
  StrPCopy( p2, 'some string to decrypt' );
  p1 := DecryptStr( p2 );
end; 
```

此外，您通过调用 Getmem(p1,...) 分配的内存将被泄露，因为 p1 被 DecryptStr 的函数返回覆盖。

但是，我有点担心 DecryptStr 到底返回了什么，以及谁拥有 p1 指向的内存。如果它返回指向由 DLL 分配的内存的指针，则需要小心如何释放该内存。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-26T00:39:54.193

我同意 CesarB，尝试使用 stdcall 指令将其声明为：

```
function DecryptStr(s: PChar): PChar; stdcall; external 'strlib.dll'; 
```

如果它不起作用，请在此处发布 VB 声明。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-26T17:20:55.700

在这种情况下，最好的方法是调试您的程序并在执行回调之前和之后检查堆栈。怎么知道，它甚至可能是外部 DLL 中的错误？

这样你会很容易地看到如何纠正这个问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-26T17:25:29.747

用 Borland C 或 C++Builder 编写的 dll 是否有意与 Delphi 一起使用？在这种情况下，它可以使用 pascal 指令进行编译。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-27T10:53:44.420

字符串必须“初始化”的建议似乎是正确的。这是因为 C 将要求传入的字符串以空值结尾。检查文本末尾之后的缓冲区中的字符是否为空 (#0)。

为什么你认为传入的字符串正好是 255 个字符长？您需要为 p1 中的字符分配 Length(p1) + 1 个字节，最后分配一个 #0 字符。

此外，您的代码示例似乎对 p1 和 p2 的使用感到困惑。看起来 p1 是传递给您分配的 C DLL 的缓冲区，而 p2 是 DLL 分配的返回字符串。但随后代码将是（注意使用 p1 和 p2）

```
var
  p1, p2 : pchar;
begin
  GetMem( p1, 255 );
  StrPCopy( p1, 'some string to decrypt' );
  p2 := DecryptStr( p1 );
end; 
```

更好的变量名称将帮助您更清楚地说明这一点。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-03-18T12:55:08.750

我放弃了我的解决方案，因为我对此感到很困惑，并且在任何答案中都没有找到它。

C++ 函数如下所示：

```
int  __stdcall DoSomething(char * _name); 
```

为了让它在 Delphi 中工作，我声明了以下函数

```
function DoSomething(name: PAnsiChar): integer; stdcall; external 'somedll.dll'; 
```

然后当我拨打电话时，我有一个如下所示的函数：

```
var s: PAnsiChar;
begin
  GetMem(s, 255);
  DoSomething(s);
  // s now contains the value returned from the C DLL
end; 
```

我曾尝试使用 PChar 而不是 PAnsiChar 但我得到的只是垃圾。此外，如果我在 Delphi 中声明函数并将参数设置为*var*，当我尝试读取它时会出现异常。

希望这对任何人都有帮助..

# ruby-on-rails - 使用 Ruby on Rails 发送邮件的最简单方法

> ID：237107
> 
> 赞同：10
> 
> 时间：2008-10-25T22:17:04.340
> 
> 标签：ruby-on-rails, ruby, email

使用 Ruby on Rails 发送邮件的最简单方法是什么？有没有办法通过 ruby​​ 直接发送邮件并跳过所有 Rails 模型和复杂性，就像 php 的 mail() 函数一样？

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-26T00:08:41.900

*普通旧 ruby*​​ 中最简单的方法是使用 net/smtp。然而，rails 有它自己的内置邮件设施，因为发送邮件是很常见的事情。在 Rails 中做到这一点的最好方法是使用[Mailer 模型](http://api.rubyonrails.com/classes/ActionMailer/Base.html)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-21T19:56:56.370

确保将所有 example.com 替换为实际值：

```
require 'net/smtp'
Net::SMTP.start('smtp.example.com', 25) do |smtp|
  smtp.send_message "Subject: testing from ruby", 'from-address@example.com', ['to-address1@example.com', 'to-address2@example.com']
end 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-26T13:57:14.863

还有[TMail](http://tmail.rubyforge.org/)。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-18T00:24:19.197

另一个出色的解决方案是名为[pony](https://github.com/benprew/pony)的 gem 。它与 php 的 mail() 函数完全一样。简单易行。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-25T22:26:15.287

是的，请查看 ruby​​ 文档... [http://ruby-doc.org/stdlib/](http://ruby-doc.org/stdlib/)

您要查看的包是 net/smtp

还有

[http://www.rfc20.org/rubymail/（ruby](http://www.rfc20.org/rubymail/)邮件），它很流行，让它更容易一些

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-09T04:35:21.063

我担心如果您不想使用 ActionMailer，那么您可能只是没有得到 Rails。ActionMailer 使发送带有良好模板之类的电子邮件变得非常容易，您真的应该研究一下。

# c# - 执行顺序方法的最佳方法是什么？

> ID：237112
> 
> 赞同：4
> 
> 时间：2008-10-25T22:24:31.827
> 
> 标签：c#, exception, delegates

处理一个必须每秒钟运行一组顺序方法的项目`x`。现在，我将方法包含在另一个“父方法”中，然后依次调用它们。

```
class DoTheseThings()
{
    DoThis();
    NowDoThat();
    NowDoThis();
    MoreWork();
    AndImSpent();
} 
```

在执行下一步之前，每个方法都必须成功运行且不引发异常。`while`所以现在我用and包装了这些方法中的每一个`try..catch`，然后`catch`再次执行该方法。

```
while( !hadError )
{
    try
    {
         DoThis();
    }
    catch(Exception doThisException )
    {
         hadError = true;
    }

} 
```

这看起来很臭，而且不是很干。有没有更好的方法来做到这一点，所以我不会在相同的方法中包装任何新功能。某种委托集合不是实现这一点的正确方法吗？

有没有更“合适”的解决方案？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-25T22:38:04.373

```
Action[] work=new Action[]{new Action(DoThis),   new Action(NowDoThat),    
    new Action(NowDoThis),    new Action(MoreWork),    new Action(AndImSpent)};
int current =0;
while(current!=work.Length)
{
   try
   {
      work[current]();
      current++;
   }
   catch(Exception ex)
   {
      // log the error or whatever
      // maybe sleep a while to not kill the processors if a successful execution depends on time elapsed  
   }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-25T22:39:22.750

> 某种委托集合不是实现这一点的正确方法吗？

委托是解决此问题的一种可能方法。

只需创建一个委托，例如：

> 公共代表无效 WorkDelegate();

并将它们放在可以迭代的arraylist中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-26T01:01:38.190

我个人的宗教信仰是你不应该捕获 System.Exception，或者更准确地说，你应该只捕获你知道如何处理的异常。

话虽如此，我将假设您调用的每个方法都在做不同的事情，并且可能导致抛出不同的异常。这意味着您可能需要为每种方法使用不同的处理程序。

如果您也遵循我的宗教信仰，并且第二个陈述是正确的，那么您就不会不必要地重复代码。除非您有其他要求，否则我对改进代码的建议是：

1）将try-catch放在每个方法中，而不是围绕每个方法调用。

2）让每个方法中的捕获只捕获您知道的异常。

[http://blogs.msdn.com/fxcop/archive/2006/06/14/631923.aspx](http://blogs.msdn.com/fxcop/archive/2006/06/14/631923.aspx) [http://blogs.msdn.com/oldnewthing/archive/2005/01/14/352949.aspx](http://blogs.msdn.com/oldnewthing/archive/2005/01/14/352949.aspx) [http:// www.joelonsoftware.com/articles/Wrong.html](http://www.joelonsoftware.com/articles/Wrong.html)

HTH ...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-25T23:29:23.787

你的例子看起来不错..它是一个干燥的例子，但会做得很好！！实际上，如果此方法执行数据库访问..您可以使用事务来确保完整性...

如果您处理多线程程序的共享变量..使用同步更清洁..编码中最重要的是您编写正确的代码...错误更少..并且可以正确完成任务..

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-26T00:14:36.020

```
public void DoTheseThings()
{
    SafelyDoEach( new Action[]{
        DoThis,
        NowDoThat,
        NowDoThis,
        MoreWork,
        AndImSpent
    })
}

public void SafelyDoEach( params Action[] actions )
{
    try
    {
        foreach( var a in actions )
            a();
    }
    catch( Exception doThisException )
    {
        // blindly swallowing every exception like this is a terrible idea
        // you should really only be swallowing a specific MyAbortedException type
        return;
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-25T22:31:24.140

发生错误的原因是什么？

如果这是一个资源问题，例如访问连接或对象之类的东西，那么您可能需要考虑使用监视器、信号量或只是锁定。

```
lock (resource) 
{
    Dosomething(resource);
} 
```

这样，如果先前的方法正在访问资源，那么您可以等到它释放资源才能继续。

理想情况下，您不必在每次失败时都运行循环来执行某些操作。它完全失败了，你想知道这个问题并解决它。有一个循环总是不停地尝试不是去这里的正确方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-25T22:44:20.960

我会按照 Ovidiu Pacurar 的建议去做，只是我会使用`foreach`循环并将数组索引的处理留给编译器。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-26T00:10:11.083

简单的委托方法：

```
Action<Action> tryForever = (action) => { 
   bool success;
   do {
     try {
       action();
       success = true;
     } catch (Exception) {
       // should probably log or something here...
     }
   } while (!success);
};

void DoEverything() {
   tryForever(DoThis);
   tryForever(NowDoThat);
   tryForever(NowDoThis);
   tryForever(MoreWork);
   tryForever(AndImSpent);
} 
```

堆栈方法：

```
void DoEverything() {
  Stack<Action> thingsToDo = new Stack<Action>(
    new Action[] { 
      DoThis, NowDoThat, NowDoThis, MoreWork, AndImSpent 
    }
  );

  Action action;
  while ((action = thingsToDo.Pop()) != null) {
     bool success;
     do {
       try {
         action();
         success = true;
       } catch (Exception) {
       }
     } while (!success);
  } 
```

# java - 对于流行的 Java 库，“附加源代码”可以更容易吗？

> ID：237118
> 
> 赞同：2
> 
> 时间：2008-10-25T22:28:42.570
> 
> 标签：java, debugging, ide, maven-2

当我的调试器进入某个没有相应源的类文件时，我遇到了这个障碍。找到它通常很困难：

*   您必须搜索托管相应项目的站点，并找到它的“下载源”页面（例如，上次我搜索 JPA API，我花了几个小时才获得源）。或者，您可能需要从修订控制中检查它。

*   您需要知道您正在使用的确切版本。否则调试器可能会进入注释和空行:)

*   打包源代码没有约定——一些项目将它包含在 jar 本身中；有些提供单独的 zip 文件；其他人将其放在`src/`zip 中的子文件夹中。

我知道 Maven 能够从其存储库下载源代码，并在生成 IDE 配置文件时将其包含在 src 路径中。但是 Maven 的 repo 在内容方面太差了——很少有库实际上上传了它们的源代码。

当它可以变得简单时，为什么它会如此复杂？我们可以有一些中央存储库，它将类文件（或其哈希）与编译它的源文件（或指向它的链接）相关联。也许是一个相当大的回购，但结构非常简单。IDE 插件可以查询它以自动获取所需的内容。

小伙伴们有没有同样的经历呢？

您如何获得要附加的来源？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-09-19T22:20:42.727

m2eclipse和 IDEA 都会下载任何依赖项的源代码和 javadocs [。](https://docs.sonatype.org/display/M2ECLIPSE/Resolving+artifact+sources)m2eclipse 源可以通过右键单击一个依赖项（或整个项目，如果你想要所有源）并单击 Maven->Download Sources 来下载。

![下载源截图](https://docs.sonatype.org/download/attachments/1999044/DownloadSources.png)

在较新版本的 m2eclipse 上，您还可以通过转到 Window->Preferences...->Maven，然后选择“Download Artifact Sources”选项来自动下载源代码。当您在依赖 jar 中打开当前没有可用源的类型时，Maven 将在后台下载源并在后台更新源附件。

![Maven 偏好截图](https://docs.sonatype.org/download/attachments/1999027/maven-settings.png)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T10:53:37.293

我自己还没有看到令人满意的解决方案。

我倾向于在没有 Maven 的情况下推出自己的 repo（Maven 很好，但它不会点击我）。我运行类似于 BSD 端口系统的东西，即一个包含少量 Ant 构建文件的大型结构化树。这些构建文件要么检查项目的源代码，从树中的其他位置提取其依赖项并构建它（这些是用于我想要构建的项目 - 即我的）或从其他地方提取二进制文件（可能是外部源或我自己的二进制存储库）。

该系统可以很容易地扩展以提取 src jar，但我现在手动执行此操作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-08T16:27:53.990

[如果您使用 M2eclipse ( http://m2eclipse.sonatype.org](http://m2eclipse.sonatype.org) )，这一切都是自动完成的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-25T22:45:53.470

它可能很复杂，但值得一开始的努力。

我这样做的方式如下：在我的项目目录中，我有三个主要目录，

*   src（我自己的）
*   库
*   suppl (sources / javadocs 当不存在源时)

我为每个库添加了一个 zip 文件，其中包含源代码。在 intellij 中，这不仅给了我调试器的超能力，还给了我 javadocs。

你是对的，获取资源是一种痛苦。有时源代码在 lib 的 .jar 文件中提供，有时作为单独的下载（我最喜欢），有时我必须创建一个单独的 cvs/svn 目录，我可以在其中签出源代码。我通常需要以我喜欢的方式重新包装它们，即使以 zip 的形式提供。

我对 Maven 持怀疑态度。我只是不喜欢将关于选择库的决定交给程序。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-26T00:27:52.470

我们做一些类似于安德烈亚斯的事情。我们的 lib 目录具有进一步分类的子目录。一个这样的子目录是 source 或 debug，它具有我们要调试的所有 jar 的源 JAR/ZIP。做一次，你就很好了。我们为 jar 和源 jar 使用 IVY 存储库。

# vb.net - 访问部分类的另一半的成员

> ID：237123
> 
> 赞同：1
> 
> 时间：2008-10-25T22:32:13.997
> 
> 标签：vb.net, visual-studio-2008, linq-to-sql, partial-classes, sqlmetal

我只是在学习使用 VB.NET 和 VS2008 中的部分类。具体来说，我正在尝试扩展由 SqlMetal 自动创建的 LINQ to SQL 类。

自动生成的类如下所示：

```
Partial Public Class DataContext
    Inherits System.Data.Linq.DataContext

 ...

<Table(Name:="dbo.Concessions")>  _
Partial Public Class Concession

 ...

     <Column(Storage:="_Country", DbType:="Char(2)")>  _
   Public Property Country() As String
          ...
    End Property

 ...

End Class 
```

在一个单独的文件中，这就是我想要做的：

```
Partial Public Class DataContext

    Partial Public Class Concession

        Public Function Foo() as String
            Return DoSomeProcessing(Me.Country)
        End Function

    End Class

End Class 
```

`Me.Country`...但我在' '和消息下得到蓝色锯齿**`'Country' is not a member of 'DataContext.Concession'`**。分部类的两半都在同一个命名空间中。

那么如何从我的部分类的一半访问自动生成的部分类的一半的属性？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-25T22:35:55.627

除非 VB.NET 在其 LINQ to SQL 文件中从 C# 生成不同的东西，否则 DB 表的类不在 DataContext 类中，就在它旁边。

所以当部分类的另一半是真正的 MyNamespace.Concession 时，**你有类****MyNamespace.DataContext.Concession**

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-03-14T04:34:48.193

（这与 VB.NET 相关 - 可能与 C# 项目不同）

我通过配置 Linq-to-SQL 模型属性将我的实体放在它们自己的命名空间中。

例如 MyCo.MyProj.Business.Entities

然后我也在那里添加非 Linq 业务实体，所以它们都在同一个命名空间中。

但是，当尝试进行上述部分类添加时，我发现部分类（即您生成的类，而不是自动生成的 LINQ 类）必须与 Linq-to-SQL 模型在同一个项目中。否则，在类视图和对象查看器中，您会看到两个单独的类 - 看似在同一个命名空间中，但实际上并非如此。不确定这是一个错误还是我做错了什么。

但是，无论如何，将部分类文件放在与模型相同的项目中。

# mashup - craigslist 混搭如何获取数据？

> ID：237124
> 
> 赞同：29
> 
> 时间：2008-10-25T22:32:43.107
> 
> 标签：mashup, aggregators

我正在对内容聚合器进行一些研究工作，我很好奇当前的一些 craigslist 聚合器如何将数据获取到他们的混搭中。

例如，www.housingmaps.com 和现已关闭的 www.chicagocrime.org

如果有可以参考的网址就完美了！

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-28T23:42:10.907

对于[AdRavage.com](http://AdRavage.com)，我结合使用 Magpie RSS（提取从搜索返回的数据）和自定义屏幕抓取类来正确填充构建搜索时使用的城市/类别信息。

例如，要提取类别，您可以：

```
//scrape category data
$h = new http();
$h->dir = "../cache/"; 
$url = "http://craigslist.org/";

if (!$h->fetch($url, 300)) {
  echo "<h2>There is a problem with the http request!</h2>";      
  exit();
}

//we need to get all category abbreviations (data looks like: <option value="ccc">community)
preg_match_all ("/<option value=\"(.*)\">([^`]*?)\n/", $h->body, $categoryTemp);

$catNames = $categoryTemp['2']; 

//return the array of abreviations
if(sizeof($catNames) > 0)   
    return $catNames;   
else
    return $emptyArray = array(); 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2011-12-11T16:31:31.643

除了抓取（并被阻止）、使用框架或 Google 搜索之外，另一种方法是使用*数据代理*或*数据交换*服务。

[3taps](http://3taps.com/)是一项测试服务，它为包括 Craigslist 在内的许多服务提供开发人员 API。他们的团队还构建[了 Craiggers](http://craiggers.com/)来演示此 API 的用例。创始人 Greg Kidd 告诉我，3taps 从非 Craigslist 来源收集 Craigslist 数据，这些数据已经被索引和缓存，因此不会对 Craigslist 造成任何压力。还列出了其他 3taps 数据源，但[这些统计数据](http://3taps.com/data)不清楚它们当前是否受支持。他们的目标是使[数据交换民主化](http://www.readwriteweb.com/archives/3taps_wants_to_democratize_the_exchange_of_data.php)。

[80legs](http://80legs.com/)是一种爬行服务，它提供了一个不太实时但可能更全面的选项。他们的数据转储式服务包括数百个网站的[抓取包，包括亚马逊、Facebook 和 Zillow（我目前不相信 Craigslist）。](http://80legs.com/use-crawl-package.html)他们较新的努力[Datafiniti](https://www.datafiniti.net/)正在为此类数据提供搜索引擎。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-01-27T07:05:51.307

craigslist 的任何抓取解决方案的问题在于，它们会自动阻止任何“过多”访问它们的 IP 地址——这通常意味着一天超过几百次。因此，一旦您的工具受到任何形式的欢迎，它就会被关闭。

这就是为什么仅有的 craigslist 搜索网站使用框架（如 searchtempest.com 和 crazedlist.org）或谷歌（如 allofcraigs.com）。

3taps 所做的是从“野外”的第三方来源收集 craigslist 列表——例如 Google 和 Bing 缓存。

编辑：这个答案不再是最新的。大多数包含 craigslist 结果的分类搜索引擎现在都使用 Google 自定义搜索或 Yahoo 或 Bing 的类似解决方案。SearchTempest 两者都使用。Allofcraigs 现在是 adhuntr 并使用 Google。Crazedlist 已关闭。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-02-02T15:37:08.890

另一种选择是使用 YQL 或 Yahoo 管道来收集结果。

[Craiglook](http://craiglook.com)和 HousingMaps 正在使用它们来收集结果

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-12-13T20:04:41.180

我从 eBay、Craigslist 和 Zillow 等网站收集了大量数据。每个来源都需要不同的方法来聚合数据。

对于 Craigslist，我使用 RSS 提要获取数据。我只想要特定城市中特定类别的特定数据，而 RSS 提要对我来说效果很好。如果您试图获取所有数据，并且过度使用 RSS 提要，那么 Craigslist 可能会禁止您。此外，您将无法从 Craigslist 提要中获取所有数据，因为提要显示大部分数据，但不是全部。如果您的可靠性不需要达到 100%，那么 RSS 是最简单的方法。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-25T22:33:25.070

我猜屏幕抓取

我认为目前还没有 craigslist API。我认为他们不会发布一个 ..

所以唯一的方法是抓取数据..你可以使用 cURL 库和 heave regex 来抓取你想要的页面数据

如果你看到一个链接..访问页面..抓取新页面获取数据并显示或存储它

等等..

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-01-21T23:00:43.187

我刚做了一个：

[http://cdn.javascriptmvc.com/videos/jobs/craigslist.js](http://cdn.javascriptmvc.com/videos/jobs/craigslist.js)

这会产生：

[http://cdn.javascriptmvc.com/videos/jobs/craigslist.html](http://cdn.javascriptmvc.com/videos/jobs/craigslist.html)

必须在犀牛中运行。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-23T01:27:01.173

在继续研究这个领域的同时，我发现了一个很棒的网站，它部分地做了我感兴趣的事情：

[疯狂清单](http://crazedlist.org)

它使用客户端浏览器的HTTPReferer，这很有趣但并不理想。该网站的作者还声称已在 CL 上打勾，我理解。它还给出了与我的需求相似的业务需求的清晰示例，以及我对这个主题感兴趣的原因。

# python - 为什么 Python 代码使用 len() 函数而不是长度方法？

> ID：237128
> 
> 赞同：226
> 
> 时间：2008-10-25T22:37:03.223
> 
> 标签：python, function, oop, methods, string-length

我知道python有一个`len()`用于确定字符串大小的函数，但我想知道为什么它不是字符串对象的方法。

## **更新**

好吧，我意识到我大错特错了。`__len__()`实际上是一个字符串对象的方法。在 Python 中使用字符串对象上的 len 函数来查看面向对象的代码似乎很奇怪。`__len__`此外，将其视为名称而不是 len也很奇怪。

* * *

## 回答 #1

> 赞同：193
> 
> 时间：2008-10-25T22:51:19.217

字符串确实有一个长度方法：`__len__()`

Python 中的协议是在具有长度的对象上实现此方法并使用内置[`len()`](http://www.python.org/doc/2.5.2/lib/built-in-funcs.html#l2h-45)函数为您调用它，类似于您实现`__iter__()`和使用内置`iter()`函数的方式（或在后面调用该方法你的场景）在可迭代的对象上。

有关更多信息，请参阅[模拟容器类型](http://www.python.org/doc/2.5.2/ref/sequence-types.html)。

这是关于 Python 协议主题的好读物：[Python and the Principle of Least Astonishment](http://lucumr.pocoo.org/2011/7/9/python-and-pola/)

* * *

## 回答 #2

> 赞同：103
> 
> 时间：2008-10-26T01:11:08.340

吉姆对[这个问题](https://stackoverflow.com/questions/83983/why-isnt-the-len-function-inherited-by-dictionaries-and-lists-in-python)的回答可能会有所帮助；我在这里复制它。引用 Guido van Rossum 的话：

> 首先，出于 HCI 的原因，我选择了 len(x) 而不是 x.len()（def __len__() 来得晚得多）。实际上有两个相互交织的原因，都是 HCI：
> 
> (a) 对于某些运算，前缀符号比后缀读起来更好——前缀（和中缀！）运算在数学中有着悠久的传统，它喜欢视觉帮助数学家思考问题的符号。比较我们将像 x*(a+b) 这样的公式重写为 x*a + x*b 的简单性与使用原始 OO 表示法做同样事情的笨拙。
> 
> (b) 当我读到 len(x) 的代码时，我知道它是在询问某物的长度。这告诉我两件事：结果是一个整数，而参数是某种容器。相反，当我阅读 x.len() 时，我必须已经知道 x 是某种实现接口或继承自具有标准 len() 的类的容器。当一个没有实现映射的类有一个 get() 或 keys() 方法，或者不是文件的东西有一个 write() 方法时，我们偶尔会感到困惑。
> 
> 以另一种方式说同样的话，我将“len”视为内置操作。我不想失去那个。/…/

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2008-10-25T22:49:54.163

有一个`len`方法：

```
>>> a = 'a string of some length'
>>> a.__len__()
23
>>> a.__len__
<method-wrapper '__len__' of str object at 0x02005650> 
```

* * *

## 回答 #4

> 赞同：36
> 
> 时间：2014-04-21T07:19:39.380

Python 是一种实用的编程语言，`len()`作为函数而不是 , 等的方法的`str`原因`list`是`dict`实用的。

`len()`内置函数直接处理内置类型：CPython 实现`len()`实际上返回[C 结构](http://hg.python.org/cpython/file/8c8315bac6a8/Include/object.h#l111)中的字段值，该`ob_size`字段表示内存中任何可变大小的内置对象。这比调用方法**要**快得多——不需要进行属性查找。获取集合中项目的数量是一种常见的操作，并且对于诸如 , 等基本和多样化的类型必须有效地工作。[`PyVarObject`](http://hg.python.org/cpython/file/8c8315bac6a8/Include/object.h#l111)**`str``list``array.array`**

 **但是，为了提高一致性，当应用于`len(o)`用户定义的类型时，Python 调用`o.__len__()`作为后备。 `__len__`，以及[Python 数据模型](https://docs.python.org/3.4/reference/datamodel.html)`__abs__`中记录的所有其他特殊方法，可以轻松创建行为类似于内置函数的对象，从而实现我们称之为“Pythonic”的富有表现力和高度一致的 API。

通过实现特殊方法，您的对象可以支持迭代、重载中缀运算符、管理**`with`**块中的上下文等。您可以将数据模型视为一种将 Python 语言本身用作框架的方式，您可以在其中无缝集成您创建的对象。

第二个原因，得到 Guido van Rossum 这样的引用的支持[，](http://effbot.org/pyfaq/why-does-python-use-methods-for-some-functionality-e-g-list-index-but-functions-for-other-e-g-len-list.htm)是它`len(s)`比`s.len()`.

该表示法`len(s)`与带有前缀表示法的一元运算符一致，例如`abs(n)`. `len()`比 更经常使用`abs()`，而且它应该很容易编写。

可能还有一个历史原因：在 Python 之前的 ABC 语言中（并且在其设计中非常有影响力），有一个一元运算符写成`#s`which 表示`len(s)`.

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-10-25T22:38:58.227

```
met% python -c 'import this' | grep 'only one'
There should be one-- and preferably only one --obvious way to do it. 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2017-02-28T03:06:58.460

这里有一些很好的答案，所以在我给出自己的答案之前，我想强调一些我在这里读过的宝石（不是红宝石双关语）。

*   Python 不是纯粹的 OOP 语言——它是一种通用的多范式语言，允许程序员使用他们最熟悉的范式和/或最适合他们解决方案的范式。
*   Python具有一流的功能，因此`len`实际上是一个对象。另一方面，Ruby 没有一流的功能。所以`len`函数对象有它自己的方法，你可以通过运行来检查`dir(len)`。

如果您不喜欢它在您自己的代码中的工作方式，那么使用您喜欢的方法重新实现容器对您来说是微不足道的（参见下面的示例）。

```
>>> class List(list):
...     def len(self):
...         return len(self)
...
>>> class Dict(dict):
...     def len(self):
...         return len(self)
...
>>> class Tuple(tuple):
...     def len(self):
...         return len(self)
...
>>> class Set(set):
...     def len(self):
...         return len(self)
...
>>> my_list = List([1,2,3,4,5,6,7,8,9,'A','B','C','D','E','F'])
>>> my_dict = Dict({'key': 'value', 'site': 'stackoverflow'})
>>> my_set = Set({1,2,3,4,5,6,7,8,9,'A','B','C','D','E','F'})
>>> my_tuple = Tuple((1,2,3,4,5,6,7,8,9,'A','B','C','D','E','F'))
>>> my_containers = Tuple((my_list, my_dict, my_set, my_tuple))
>>>
>>> for container in my_containers:
...     print container.len()
...
15
2
15
15 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2019-12-02T19:40:07.543

这里的其他答案缺少一些东西：该`len`函数检查该`__len__`方法是否返回一个非负数`int`。这是一个函数的事实`len`意味着类不能覆盖此行为以避免检查。因此，`len(obj)`提供了`obj.len()`无法达到的安全级别。

例子：

```
>>> class A:
...     def __len__(self):
...         return 'foo'
...
>>> len(A())
Traceback (most recent call last):
  File "<pyshell#8>", line 1, in <module>
    len(A())
TypeError: 'str' object cannot be interpreted as an integer
>>> class B:
...     def __len__(self):
...         return -1
... 
>>> len(B())
Traceback (most recent call last):
  File "<pyshell#13>", line 1, in <module>
    len(B())
ValueError: __len__() should return >= 0 
```

当然，可以`len`通过将函数重新分配为全局变量来“覆盖”该函数，但是这样做的代码比覆盖类中方法的代码更明显可疑。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2013-01-04T23:44:59.463

你也可以说

```
>> x = 'test'
>> len(x)
4 
```

使用 Python 2.7.3。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2008-10-26T01:50:18.153

它没有？

```
>>> "abc".__len__()
3 
```

# java - 如何创建自定义 JPanel 扩展并从 NetBeans 调色板使用它？

> ID：237131
> 
> 赞同：2
> 
> 时间：2008-10-25T22:38:14.187
> 
> 标签：java, swing, netbeans

我已经编写了一个`JPanel`扩展，并且希望能够在 NetBeans 设计器中使用它。该组件只是添加了一些自定义绘画，并继续作为容器在每次使用时进行自定义。

除了标准属性之外，我还有要公开的属性，并且我希望在构建 GUI 时能够看到使用`JPanel`的自定义方法。`paintComponent()`理想情况下，我还想将一个图标与该组件相关联，以便我的同事可以轻松识别它。

实现这一目标的最佳方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-28T08:26:44.310

我在 NetBeans 中使用重写的绘制方法制作了 JPanel 组件：

```
@Override
public void paint(Graphics g) {
    super.paint(g);
    Graphics2D g2 = (Graphics2D) g;
    ...
    //draw elements      
    ...
} 
```

它具有一些可通过 NetBeans 属性窗口访问的自定义属性。

```
public int getResolutionX() {
    return resolutionX;
}

public void setResolutionX(int resolutionX) {
    this.resolutionX = resolutionX;
}

public int getResolutionY() {
    return resolutionY;
}

public void setResolutionY(int resolutionY) {
    this.resolutionY = resolutionY;
} 
```

我使用：工具->调色板->Swing/AWT 组件将它放在我的调色板中。

当我在另一个容器中进行拖放时，它甚至具有我在重写的绘制方法中绘制的相同外观。我没有将图标与它相关联。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-26T10:57:30.153

[http://www.netbeans.org](http://www.netbeans.org)搜索马蒂斯。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-06-27T21:27:01.233

您可以将自定义组件添加到 matisse GUI 调色板。

1.  构建您的项目，以便您要使用的类文件是 jar 文件的一部分
2.  打开一个具有表单的 java 类，然后切换到设计模式。3、右键单击调色板，选择“调色板管理器”。
3.  选择“从 jar 添加”按钮以选择您的 jar。
4.  选择您制作的课程，并将其添加到您的调色板中。

现在您的面板已为 netbeans 所知，您可以将它拖到新面板中。

# java - 接口的骨架实现中的抽象方法

> ID：237140
> 
> 赞同：2
> 
> 时间：2008-10-25T22:43:12.243
> 
> 标签：java, interface, abstract-class

我正在重新阅读 Effective Java (2nd edition) item 18, [prefer interfaces to abstract classes](http://my.safaribooksonline.com/9780137150021/ch04lev1sec6)。在该项目中，Josh Bloch 提供了`Map.Entry<K,V>`接口的骨架实现示例：

```
// Skeletal Implementation
public abstract class AbstractMapEntry<K,V>
        implements Map.Entry<K,V> {
    // Primitive operations
    public abstract K getKey();
    public abstract V getValue();

 // ... remainder omitted
} 
```

这个例子有两个问题：

1.  为什么这里将 getKey 和 getValue 显式声明为抽象方法？它们是[Map.Entry](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Map.Entry.html)接口的一部分，所以我看不出抽象类中冗余声明的原因。
2.  为什么要使用将这些原始方法（正如 Bloch 先生所说的那样）保留为抽象的习语？为什么不这样做：

    // 骨架实现 public abstract class AbstractMapEntry implements Map.Entry { private K key; 私人V值；

    ```
     // Primitive operations
        public K getKey() {return key;}
        public V getValue() {return value;}

     // ... remainder omitted 
    ```

    }

这样做的好处是每个子类不必定义自己的字段集，并且仍然可以通过其访问器访问键和值。如果子类确实需要为访问器定义自己的行为，它可以直接实现 Map.Entry 接口。另一个缺点是在骨架实现提供的 equals 方法中，抽象访问器被调用：

```
// Implements the general contract of Map.Entry.equals
@Override public boolean equals(Object o) {
    if (o == this)
        return true;
    if (! (o instanceof Map.Entry))
        return false;
    Map.Entry<?,?> arg = (Map.Entry) o;
    return equals(getKey(),   arg.getKey()) &&
           equals(getValue(), arg.getValue());
} 
```

Bloch 警告不要从为继承而设计的类中调用可覆盖的方法（第 17 项），因为它会使超类容易受到子类所做更改的影响。也许这是一个见仁见智的问题，但我希望确定这个故事是否还有更多内容，因为布洛赫在书中并没有真正详细说明这一点。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-04T00:01:08.157

1.  我想说它有助于强调具体类要处理的内容，而不是让编译器告诉你（或者你必须比较两者以查看缺少的内容）。一种自我记录的代码。但这当然不是必需的，据我所知，它更像是一种风格。
2.  返回这些值比简单的 getter 和设置更重要的逻辑。我在标准 JDK(1.5) 中发现的每个类都至少在其中一种方法上做了一些不简单的事情，所以我猜他认为这样的实现太天真了，它会鼓励子类使用它而不是仔细考虑自己的问题。

关于 equals 的问题，如果抽象类实现它们，什么都不会改变，因为这个问题是 overridable**的**。在这种情况下，我会说 equals 正在尝试仔细实施以预期实施。由于协方差问题（超类会认为它等于子类，但子类不会认为它等于超类），通常不应实现 equals 以在其自身与其子类之间返回 true（尽管有很多这样做） ，所以无论你做什么，这种类型的 equals 实现都很棘手。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-12-13T07:18:31.690

> Bloch 警告不要从为继承而设计的类中调用可覆盖的方法（第 17 项），因为它会使超类容易受到子类所做更改的影响

他警告在构造函数中调用可覆盖的方法，而不是在其他方法中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-03T23:38:39.420

1.  我看不出任何理由

2.  允许实现定义键和值的存储方式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-25T23:26:21.283

`AbstractMapEntry#getKey`和`getValue`是抽象的（即未实现）的一个原因是它`Map.Entry`是`Map`. 使用嵌套类/接口是 Java 实现组合的方式。组合的想法是组合部分不是一流的概念。相反，组合部分只有在包含在整体中时才有意义。在这种情况下，组合部分是`Map.Entry`，组合的根对象是`Map`。显然表达的概念是a`Map`有很多`Map.Entry`s。

`AbstractMapEntry#getKey`因此， and的语义`getValue`本质上将取决于`Map`我们正在讨论的实现。您编写的一个普通的旧 getter 实现将适用于`HashMap`. 它不适用于`ConcurrentHashMap`需要线程安全的东西。这很可能是`ConcurrentHashMap`实施`getKey`并`getValue`制作防御性副本。（建议自己检查源代码）。

另一个不实现的原因`getKey`是实现`getValue`的字符`Map`完全不同，从不应该属于的字符（即`Properties`）到完全不同的宇宙`Map`（例如`Provider`，`TabularDataSupport`）。

总之，*没有*实现`AbstractMapEntry#getKey`and `getValue`，因为 API 设计的黄金法则：

> 如有疑问，请忽略（请参阅[此处](http://www.artima.com/intv/blochP.html)）

# .net - 如何确定 radioButton.Checked 是否以编程方式或通过鼠标单击设置？

> ID：237145
> 
> 赞同：2
> 
> 时间：2008-10-25T22:46:38.837
> 
> 标签：.net, winforms

我的 Windows 窗体上有一个单选按钮。如何确定 CheckChanged 事件是否由于用户单击或选择单选按钮而发生，与以编程方式设置事件

```
this.radioButtonAdd.Checked = true; 
```

我希望一些代码根据用户是单击按钮还是我自己引发事件来采取不同的操作。

或者，也许更好的问题是当用户点击和代码中的状态发生变化时如何处理事件。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-25T22:53:33.173

如果有内置方法，那么我不知道。

处理它的一种方法是在代码进行更改以告知事件处理程序时设置一个全局标志。例如，进行更改的代码可能如下所示：

```
savedFlag = modifyingProgrammatically;
modifyingProgrammatically = true;
this.radioButtonAdd.Checked = true;
modifingProgrammatically = savedFlag; 
```

在您的事件处理程序中：

```
if(modifyingProgramatically) {
    // The event was raised by an assignment within the code.
} else {
    // The event was raised by a user action.
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-25T23:24:40.520

我想我找到了一个很好的答案。

所有 Windows 窗体控件都有一个名为“Tag”的属性。它的值可以是任何对象。

因此，如果我想进行任何程序更改，我可以执行以下操作：

```
radioButton.Tag = "ignore"
radioButton.Checked = true 
```

然后在事件处理程序中：

```
private void radioButton_CheckedChanged(object sender, EventArgs e)
{
    if (radioButton.Checked)
    {
        // Tag will be null in cases where the user clicks
        if (this.radioButtonAdd.Tag == null)
        {
            // do something
        }
        else
        { 
            // swallow action
            // reset Tag
            this.radioButtonAdd.Tag = null;
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-26T04:14:32.213

您还可以执行一些操作，例如更改 MouseDown 上单选按钮的标志字段值，然后恢复 MouseClick 上的标志值。由于 CheckedChanged 事件在两者之间触发，它可以在 MouseClick 事件恢复之前使用该标志，您不必担心重置其状态。

如果您将字段用作标志（对您正在处理的应用程序了解不多），您可能仍然需要解决线程问题，但是这样的事情应该可以工作：

```
 private bool _mouseEvent;
    private void radioButton1_CheckedChanged(object sender, EventArgs e)
    {
        if (_mouseEvent)
            MessageBox.Show("Changed by mouse click.");
        else
            MessageBox.Show("Changed from code.");
    }

    private void radioButton1_MouseClick(object sender, MouseEventArgs e)
    {
        _mouseEvent = false;
    }

    private void radioButton1_MouseDown(object sender, MouseEventArgs e)
    {
        _mouseEvent = true;
    }

    private void button1_Click(object sender, EventArgs e)
    {
        // This simulates a change from code vs. a change from
        // a mouse click.
        if (radioButton1.Checked)
            radioButton2.Checked = true;
        else
            radioButton1.Checked = true;
    } 
```

或者，您可以分离“仅鼠标单击”应用程序逻辑，以便它由不同的事件（如 MouseClick）触发。

希望这可以帮助。

# c# - 我想了解更多关于 LinkedList

> ID：237151
> 
> 赞同：2
> 
> 时间：2008-10-25T22:51:58.950
> 
> 标签：c#, linked-list

我正在学习 c# ，并且我达到了 LinkedList<T> 类型，但我仍然需要了解更多信息，比如我应该什么时候使用它，如何创建一个，如何使用它。我只是想要信息。

如果有人知道关于这个主题的一篇好文章，或者如果你能给我一些解释的例子，比如如何创建，如何添加和删除，以及如何处理节点和元素。

提前致谢。我真的很喜欢在这里提问，所有专业人士都会回答和帮助。

[编辑] 更改了对 LinkedList<T> 的引用，而不是“数组链表”。我认为这是基于上下文的含义。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-25T23:20:39.780

您可以在 MSDN 上找到有关[LinkedList<T>](http://msdn.microsoft.com/en-us/library/he2s3bh7.aspx)的更多信息，包括如何创建和使用的示例。 [维基百科](http://en.wikipedia.org/wiki/Linked_list)有一篇关于链表的合理文章，包括它们的历史、用法和一些实现细节。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-25T23:50:30.157

Linked 是一个集合，用于存储相同类型的值序列，这是一项频繁的任务，例如表示在红绿灯处等待的汽车队列。

有许多不同的集合类型，如链表、数组、映射、集合等。何时使用取决于它们的属性，例如：

*   你需要某种类型的订购吗？
*   容器是关联的，像字典一样存储键值对吗？
*   您可以将相同的元素存储两次吗？
*   性能指标 - 例如插入、删除、查找元素的速度有多快？这通常以 Big-O 表示法给出，告诉您所需的时间如何随集合中元素的数量而变化。
*   内存占用和布局。由于好/坏的局部性，这也会影响性能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2017-11-22T14:52:23.770

这个集合类实现了一个双向链表。它允许您快速确定集合中指定项目的直接兄弟。从集合中删除一个项目会自动调整它的大小，以便它不会留下任何间隙。

有关 LinkedList 类的更多信息，请查看MSDN 上的[LinkedList](https://msdn.microsoft.com/en-us/library/he2s3bh7.aspx?f=255&MSPPError=-2147217396)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-25T23:20:40.060

你知道什么是标准链表吗？它就像其中之一（双重链接），但使用 .NET 泛型让您可以轻松地在其中存储任何类型。

老实说，我不使用它，我更喜欢更基本的列表或字典。

有关链接列表的更多信息，请查看[wikipedia](http://en.wikipedia.org/wiki/Linked_list)。至于泛型，这里和 MSDN 上有大量文章。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-25T23:22:49.730

链接列表是集合..它们可以用作数组的替代品..它们可以动态增长并具有特殊的辅助方法，可以帮助开发或更快地解决问题..尝试查看其方法和属性以了解更多信息。

linklist 是一个泛型集合.. 意思是可以用来声明类型安全声明..

# email - 使用 TLS 将 Windows 脚本写入电子邮件

> ID：237154
> 
> 赞同：2
> 
> 时间：2008-10-25T22:53:52.003
> 
> 标签：email, ssl, blat

我正在尝试制作一个 SVN 提交后脚本，用于备份到 Gmail 驱动器。Blat 似乎不支持 TLS。Windows 上是否有可以通过 TLS 发送电子邮件的优秀脚本程序？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-25T23:10:00.440

我不知道其他邮件发件人，但[stunnel](http://www.stunnel.org/)能够接受纯文本连接并通过 SSL 连接对其进行隧道传输。您可以让它在 localhost:25 上侦听并与 smtps 服务器 (tcp/465) 建立 SSL 连接。我曾在 WebDAV 客户端不支持 SSL 的类似情况下使用它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T02:46:18.257

布拉特人说 stunnel 是 tls 支持的最佳选择，但我发现 gmail 不需要 tls 来发送邮件。现在，数据可能没有加密，但我一直通过我的帐户（仅发送到其他 gmail 帐户）作为自动化过程发送电子邮件，并且效果很好。如果您需要它，请告诉我，我将放入命令行参数。

# python - 多个鼠标指针？

> ID：237155
> 
> 赞同：17
> 
> 时间：2008-10-25T22:54:43.843
> 
> 标签：python, user-interface, mouse, multi-user

有没有办法分别接受来自多个鼠标的输入？我对制作多用户应用程序很感兴趣，我认为如果我可以让 2 个或更多用户拿着无线鼠标，每个用户都使用单独的鼠标箭头单独与应用程序交互，那会很棒。

这是我应该尝试将其外包给其他应用程序/驱动程序/os_magic吗？或者有没有我可以用来完成这个的库？语言不是什么*大不了*的事，但 C、C++ 和 Python 更可取。

谢谢 ：）

编辑：

找到了这个用于 linux 的多指针工具包（它实际上是一个多指针 x 服务器）： [http ://wearables.unisa.edu.au/mpx/](http://wearables.unisa.edu.au/mpx/)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-04T18:14:04.850

你可以试试[Microsoft Windows MultiPoint Software Development Kit 1.1](http://www.microsoft.com/downloads/details.aspx?familyid=F851122A-4925-4788-BC39-409644CE0F9B&displaylang=en)

或新的 [Microsoft Windows MultiPoint 软件开发工具包 1.5](http://www.microsoft.com/downloads/details.aspx?FamilyID=0eb18c26-5e02-4c90-ae46-06662818f817&displaylang=en)

和主要的[Microsoft Multipoint](http://www.microsoft.com/multipoint/mouse-sdk/)站点

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-25T23:06:20.653

是的。我知道至少有一个程序可以做到这一点，[KidPad](http://www.cs.umd.edu/hcil/kiddesign/introduction.shtml)。我认为它是用 Java 编写的，由现在爱荷华大学的[Juan Pablo Hourcade开发。](http://www.cs.uiowa.edu/~hourcade/)你得问他是如何实施的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-22T01:06:27.097

[http://code.google.com/p/pymultimouse/](http://code.google.com/p/pymultimouse/)是一个使用 Windows 原始输入的库，它在 2 只鼠标的测试中工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-25T23:25:04.017

您可以将 DirectInput 与 C/C++ 一起使用（可能还有其他语言的绑定）。您使用[`IDirectInput8::EnumDevices()`](http://msdn.microsoft.com/en-us/library/bb205950(VS.85).aspx)（使用 DX8；相同的功能，其他版本的 DirectX 中的不同界面）来获取所有连接设备的列表。然后，您创建设备并轮询它们[`IDirectInputDevice8::Poll()`](http://msdn.microsoft.com/en-us/library/bb205975(VS.85).aspx)。这几乎肯定适用于任意数量的鼠标、键盘和其他输入设备。MSDN 在这方面有很好的文档。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-26T02:35:35.457

我有一种模糊的感觉，BeOS 曾经让一个鼠标和键盘配对，并有单独的活动窗口和输入。哇……那是很久以前的事了。我认为“配对”编程会非常有趣。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-11T10:40:11.927

在这里查看我的答案（避免使用 JNI 的东西）：[如何在 Java 中处理多个鼠标输入？](https://stackoverflow.com/questions/262125/java-multiple-mouse-inputs#263886)

# gmail - 如何将 Gmail 驱动器分配给驱动器号？

> ID：237157
> 
> 赞同：-2
> 
> 时间：2008-10-25T22:55:59.643
> 
> 标签：gmail

我想为 GMail 驱动器分配一个驱动器号，以便我可以编写一些输出脚本。他们有什么技巧可以让它工作吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-25T23:20:29.483

GMail Drive 不再工作（很好）——谷歌在 Gmail 中设置了速率限制，以防止这种（滥用）Gmail 的使用。这就像通过与卢旺达的不良卫星连接连接到硬盘驱动器*。

你可以看看亚马逊的 S3，它是一种廉价的网络托管数据存储服务；然后从 S3 的角度再次问这个问题。

*顺便说一句，这就是我每周在工作中处理的事情。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-11T13:27:20.637

我为此使用了 SMEStorage 服务，效果非常好。我注册的 GMail 包使您可以将 GMail 用作存储云，而且效果非常好。您还可以使用一些 Windows 工具。我正在使用付费版本，它为我提供了虚拟（命名空间）驱动器、同步和 shell 工具以及 MS Office 和 Open Office 集成。如果注册 Lifetime Cloud 套餐（我就是这样做的），您最多可以使用 10 个 GMail 帐户。

# java - 检查字符串是否代表Java中的整数的最佳方法是什么？

> ID：237159
> 
> 赞同：243
> 
> 时间：2008-10-25T22:58:49.263
> 
> 标签：java, string, int

我通常使用以下成语来检查字符串是否可以转换为整数。

```
public boolean isInteger( String input ) {
    try {
        Integer.parseInt( input );
        return true;
    }
    catch( Exception e ) {
        return false;
    }
} 
```

只是我，还是这看起来有点骇人听闻？有什么更好的方法？

* * *

请参阅我的答案（使用基准，基于[CodingWithSpike](https://stackoverflow.com/users/28278/codingwithspike)的[早期答案](https://stackoverflow.com/a/237321/1288)），了解为什么我改变了立场并接受了[Jonas Klemming](https://stackoverflow.com/a/237204/1288)对这个问题的回答。我认为这个原始代码将被大多数人使用，因为它实现起来更快，更易于维护，但是当提供非整数数据时，它的速度要慢几个数量级。

* * *

## 回答 #1

> 赞同：184
> 
> 时间：2008-10-25T23:32:46.463

如果您不担心潜在的溢出问题，此函数的执行速度将比使用`Integer.parseInt()`.

```
public static boolean isInteger(String str) {
    if (str == null) {
        return false;
    }
    int length = str.length();
    if (length == 0) {
        return false;
    }
    int i = 0;
    if (str.charAt(0) == '-') {
        if (length == 1) {
            return false;
        }
        i = 1;
    }
    for (; i < length; i++) {
        char c = str.charAt(i);
        if (c < '0' || c > '9') {
            return false;
        }
    }
    return true;
} 
```

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2008-10-25T23:03:34.667

你有它，但你应该只 catch `NumberFormatException`。

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2008-10-26T01:18:04.880

做了一个快速的基准测试。异常实际上并没有那么昂贵，除非您开始弹出多个方法并且 JVM 必须做很多工作才能使执行堆栈到位。当保持相同的方法时，他们的表现并不差。

```
 public void RunTests()
 {
     String str = "1234567890";

     long startTime = System.currentTimeMillis();
     for(int i = 0; i < 100000; i++)
         IsInt_ByException(str);
     long endTime = System.currentTimeMillis();
     System.out.print("ByException: ");
     System.out.println(endTime - startTime);

     startTime = System.currentTimeMillis();
     for(int i = 0; i < 100000; i++)
         IsInt_ByRegex(str);
     endTime = System.currentTimeMillis();
     System.out.print("ByRegex: ");
     System.out.println(endTime - startTime);

     startTime = System.currentTimeMillis();
     for(int i = 0; i < 100000; i++)
         IsInt_ByJonas(str);
     endTime = System.currentTimeMillis();
     System.out.print("ByJonas: ");
     System.out.println(endTime - startTime);
 }

 private boolean IsInt_ByException(String str)
 {
     try
     {
         Integer.parseInt(str);
         return true;
     }
     catch(NumberFormatException nfe)
     {
         return false;
     }
 }

 private boolean IsInt_ByRegex(String str)
 {
     return str.matches("^-?\\d+$");
 }

 public boolean IsInt_ByJonas(String str)
 {
     if (str == null) {
             return false;
     }
     int length = str.length();
     if (length == 0) {
             return false;
     }
     int i = 0;
     if (str.charAt(0) == '-') {
             if (length == 1) {
                     return false;
             }
             i = 1;
     }
     for (; i < length; i++) {
             char c = str.charAt(i);
             if (c <= '/' || c >= ':') {
                     return false;
             }
     }
     return true;
 } 
```

输出：

> 例外：31
> 
> ByRegex：453（注意：每次都重新编译模式）
> 
> 由乔纳斯：16

我同意 Jonas K 的解决方案也是最强大的。看起来他赢了:)

* * *

## 回答 #4

> 赞同：38
> 
> 时间：2008-10-27T10:03:38.423

```
org.apache.commons.lang.StringUtils.isNumeric 
```

尽管 Java 的标准库确实缺少这样的实用功能

我认为 Apache Commons 是每个 Java 程序员的“必备”

太糟糕了，它还没有移植到 Java5

* * *

## 回答 #5

> 赞同：37
> 
> 时间：2011-09-06T17:55:15.970

由于有可能人们仍然访问这里并且在基准测试之后会对 Regex 产生偏见......所以我将提供基准的更新版本，以及 Regex 的编译版本。与之前的基准测试相反，这表明 Regex 解决方案实际上具有始终如一的良好性能。

复制自 Bill the Lizard 并更新为编译版本：

```
private final Pattern pattern = Pattern.compile("^-?\\d+$");

public void runTests() {
    String big_int = "1234567890";
    String non_int = "1234XY7890";

    long startTime = System.currentTimeMillis();
    for(int i = 0; i < 100000; i++)
            IsInt_ByException(big_int);
    long endTime = System.currentTimeMillis();
    System.out.print("ByException - integer data: ");
    System.out.println(endTime - startTime);

    startTime = System.currentTimeMillis();
    for(int i = 0; i < 100000; i++)
            IsInt_ByException(non_int);
    endTime = System.currentTimeMillis();
    System.out.print("ByException - non-integer data: ");
    System.out.println(endTime - startTime);

    startTime = System.currentTimeMillis();
    for(int i = 0; i < 100000; i++)
            IsInt_ByRegex(big_int);
    endTime = System.currentTimeMillis();
    System.out.print("\nByRegex - integer data: ");
    System.out.println(endTime - startTime);

    startTime = System.currentTimeMillis();
    for(int i = 0; i < 100000; i++)
            IsInt_ByRegex(non_int);
    endTime = System.currentTimeMillis();
    System.out.print("ByRegex - non-integer data: ");
    System.out.println(endTime - startTime);

    startTime = System.currentTimeMillis();
    for (int i = 0; i < 100000; i++)
            IsInt_ByCompiledRegex(big_int);
    endTime = System.currentTimeMillis();
    System.out.print("\nByCompiledRegex - integer data: ");
    System.out.println(endTime - startTime);

    startTime = System.currentTimeMillis();
    for (int i = 0; i < 100000; i++)
            IsInt_ByCompiledRegex(non_int);
    endTime = System.currentTimeMillis();
    System.out.print("ByCompiledRegex - non-integer data: ");
    System.out.println(endTime - startTime);

    startTime = System.currentTimeMillis();
    for(int i = 0; i < 100000; i++)
            IsInt_ByJonas(big_int);
    endTime = System.currentTimeMillis();
    System.out.print("\nByJonas - integer data: ");
    System.out.println(endTime - startTime);

    startTime = System.currentTimeMillis();
    for(int i = 0; i < 100000; i++)
            IsInt_ByJonas(non_int);
    endTime = System.currentTimeMillis();
    System.out.print("ByJonas - non-integer data: ");
    System.out.println(endTime - startTime);
}

private boolean IsInt_ByException(String str)
{
    try
    {
        Integer.parseInt(str);
        return true;
    }
    catch(NumberFormatException nfe)
    {
        return false;
    }
}

private boolean IsInt_ByRegex(String str)
{
    return str.matches("^-?\\d+$");
}

private boolean IsInt_ByCompiledRegex(String str) {
    return pattern.matcher(str).find();
}

public boolean IsInt_ByJonas(String str)
{
    if (str == null) {
            return false;
    }
    int length = str.length();
    if (length == 0) {
            return false;
    }
    int i = 0;
    if (str.charAt(0) == '-') {
            if (length == 1) {
                    return false;
            }
            i = 1;
    }
    for (; i < length; i++) {
            char c = str.charAt(i);
            if (c <= '/' || c >= ':') {
                    return false;
            }
    }
    return true;
} 
```

结果：

```
ByException - integer data: 45
ByException - non-integer data: 465

ByRegex - integer data: 272
ByRegex - non-integer data: 131

ByCompiledRegex - integer data: 45
ByCompiledRegex - non-integer data: 26

ByJonas - integer data: 8
ByJonas - non-integer data: 2 
```

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2008-10-26T07:26:01.377

它部分取决于“可以转换为整数”的含义。

如果您的意思是“可以在 Java 中转换为 int”，那么 Jonas 的回答是一个好的开始，但还没有完成这项工作。例如，它将通过 999999999999999999999999999999。我会在方法的末尾从您自己的问题中添加正常的 try/catch 调用。

逐个字符的检查将有效地拒绝“根本不是整数”的情况，而让“它是一个整数但 Java 无法处理”的情况被较慢的异常路由捕获。您*也可以*手动执行此操作，但会*复杂*得多。

* * *

## 回答 #7

> 赞同：20
> 
> 时间：2008-10-26T11:27:00.297

只有一条关于正则表达式的评论。此处提供的每个示例都是错误的！如果您想使用正则表达式，请不要忘记编译模式需要很多时间。这：

```
str.matches("^-?\\d+$") 
```

还有这个：

```
Pattern.matches("-?\\d+", input); 
```

在每个方法调用中导致模式编译。要正确使用它，请遵循：

```
import java.util.regex.Pattern;

/**
 * @author Rastislav Komara
 */
public class NaturalNumberChecker {
    public static final Pattern PATTERN = Pattern.compile("^\\d+$");

    boolean isNaturalNumber(CharSequence input) {
        return input != null && PATTERN.matcher(input).matches();
    }
} 
```

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2016-01-07T09:14:31.537

有番石榴版本：

```
import com.google.common.primitives.Ints;

Integer intValue = Ints.tryParse(stringValue); 
```

如果解析字符串失败，它将返回 null 而不是抛出异常。

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2008-10-26T13:13:46.837

我从 rally25rs answer 复制了代码，并为非整数数据添加了一些测试。不可否认，结果有利于 Jonas Klemming 发布的方法。当你有整数数据时，我最初发布的 Exception 方法的结果非常好，但当你没有整数数据时它们是最差的，而 RegEx 解决方案的结果（我敢打赌很多人都在使用）*一直*很糟糕。有关已编译的正则表达式示例，请参见[Felipe 的答案](https://stackoverflow.com/a/7324087/1288)，这要快得多。

```
public void runTests()
{
    String big_int = "1234567890";
    String non_int = "1234XY7890";

    long startTime = System.currentTimeMillis();
    for(int i = 0; i < 100000; i++)
        IsInt_ByException(big_int);
    long endTime = System.currentTimeMillis();
    System.out.print("ByException - integer data: ");
    System.out.println(endTime - startTime);

    startTime = System.currentTimeMillis();
    for(int i = 0; i < 100000; i++)
        IsInt_ByException(non_int);
    endTime = System.currentTimeMillis();
    System.out.print("ByException - non-integer data: ");
    System.out.println(endTime - startTime);

    startTime = System.currentTimeMillis();
    for(int i = 0; i < 100000; i++)
        IsInt_ByRegex(big_int);
    endTime = System.currentTimeMillis();
    System.out.print("\nByRegex - integer data: ");
    System.out.println(endTime - startTime);

    startTime = System.currentTimeMillis();
    for(int i = 0; i < 100000; i++)
        IsInt_ByRegex(non_int);
    endTime = System.currentTimeMillis();
    System.out.print("ByRegex - non-integer data: ");
    System.out.println(endTime - startTime);

    startTime = System.currentTimeMillis();
    for(int i = 0; i < 100000; i++)
        IsInt_ByJonas(big_int);
    endTime = System.currentTimeMillis();
    System.out.print("\nByJonas - integer data: ");
    System.out.println(endTime - startTime);

    startTime = System.currentTimeMillis();
    for(int i = 0; i < 100000; i++)
        IsInt_ByJonas(non_int);
    endTime = System.currentTimeMillis();
    System.out.print("ByJonas - non-integer data: ");
    System.out.println(endTime - startTime);
}

private boolean IsInt_ByException(String str)
{
    try
    {
        Integer.parseInt(str);
        return true;
    }
    catch(NumberFormatException nfe)
    {
        return false;
    }
}

private boolean IsInt_ByRegex(String str)
{
    return str.matches("^-?\\d+$");
}

public boolean IsInt_ByJonas(String str)
{
    if (str == null) {
            return false;
    }
    int length = str.length();
    if (length == 0) {
            return false;
    }
    int i = 0;
    if (str.charAt(0) == '-') {
            if (length == 1) {
                    return false;
            }
            i = 1;
    }
    for (; i < length; i++) {
            char c = str.charAt(i);
            if (c <= '/' || c >= ':') {
                    return false;
            }
    }
    return true;
} 
```

结果：

```
ByException - integer data: 47
ByException - non-integer data: 547

ByRegex - integer data: 390
ByRegex - non-integer data: 313

ByJonas - integer data: 0
ByJonas - non-integer data: 16 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2008-10-25T23:04:46.897

这更短，但更短不一定更好（并且它不会捕获超出范围的整数值，[正如 danatel 的评论中所指出的那样](https://stackoverflow.com/questions/237159/whats-the-best-way-to-check-to-see-if-a-string-represents-an-integer-in-java#237161)）：

```
input.matches("^-?\\d+$"); 
```

就个人而言，由于实现是在辅助方法中隐藏起来的，并且正确性胜过长度，所以我会选择你所拥有的东西（减去捕获基`Exception`类而不是`NumberFormatException`）。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2012-12-13T21:41:50.603

您可以使用字符串类的matches 方法。[0-9] 表示它可以是所有值，+ 表示它必须至少有一个字符长，* 表示它可以是零个或多个字符长。

```
boolean isNumeric = yourString.matches("[0-9]+"); // 1 or more characters long, numbers only
boolean isNumeric = yourString.matches("[0-9]*"); // 0 or more characters long, numbers only 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-10-25T23:03:12.890

怎么样：

```
return Pattern.matches("-?\\d+", input); 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2017-03-23T19:54:18.570

这是 Jonas Klemming 答案的 Java 8 变体：

```
public static boolean isInteger(String str) {
    return str != null && str.length() > 0 &&
         IntStream.range(0, str.length()).allMatch(i -> i == 0 && (str.charAt(i) == '-' || str.charAt(i) == '+')
                  || Character.isDigit(str.charAt(i)));
} 
```

测试代码：

```
public static void main(String[] args) throws NoSuchAlgorithmException, UnsupportedEncodingException {
    Arrays.asList("1231231", "-1232312312", "+12313123131", "qwqe123123211", "2", "0000000001111", "", "123-", "++123",
            "123-23", null, "+-123").forEach(s -> {
        System.out.printf("%15s %s%n", s, isInteger(s));
    });
} 
```

测试代码的结果：

```
 1231231 true
    -1232312312 true
   +12313123131 true
  qwqe123123211 false
              2 true
  0000000001111 true
                false
           123- false
          ++123 false
         123-23 false
           null false
          +-123 false 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-10-26T05:27:50.133

您还可以使用[Scanner](https://docs.oracle.com/javase/8/docs/api/java/util/Scanner.html)类，并使用[hasNextInt()](https://docs.oracle.com/javase/8/docs/api/java/util/Scanner.html#hasNextInt--) - 这也允许您测试其他类型，例如浮点数等。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2013-07-26T06:12:10.180

您只需检查**NumberFormatException**：-

```
 String value="123";
 try  
 {  
    int s=Integer.parseInt(any_int_val);
    // do something when integer values comes 
 }  
 catch(NumberFormatException nfe)  
 {  
          // do something when string values comes 
 } 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2014-03-18T02:19:39.860

如果您的字符串数组包含纯整数和字符串，下面的代码应该可以工作。你只需要看第一个字符。例如 ["4","44","abc","77","bond"]

```
if (Character.isDigit(string.charAt(0))) {
    //Do something with int
} 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2016-04-22T00:08:27.547

另外一个选项：

```
private boolean isNumber(String s) {
    boolean isNumber = true;
    for (char c : s.toCharArray()) {
        isNumber = isNumber && Character.isDigit(c);
    }
    return isNumber;
} 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2014-02-25T11:15:18.553

你可以试试 apache utils

```
NumberUtils.isCreatable(myText) 
```

[在此处查看 javadoc](http://commons.apache.org/proper/commons-lang/javadocs/api-release/org/apache/commons/lang3/math/NumberUtils.html#isCreatable-java.lang.String-)

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2017-08-25T01:59:48.557

如果要检查字符串是否表示适合 int 类型的整数，我对 jonas 的答案做了一些修改，以便表示大于 Integer.MAX_VALUE 或小于 Integer.MIN_VALUE 的整数的字符串现在将返回错误的。例如：“3147483647”将返回 false，因为 3147483647 大于 2147483647，同样，“-2147483649”也将返回 false，因为 -2147483649 小于 -2147483648。

```
public static boolean isInt(String s) {
  if(s == null) {
    return false;
  }
  s = s.trim(); //Don't get tricked by whitespaces.
  int len = s.length();
  if(len == 0) {
    return false;
  }
  //The bottom limit of an int is -2147483648 which is 11 chars long.
  //[note that the upper limit (2147483647) is only 10 chars long]
  //Thus any string with more than 11 chars, even if represents a valid integer, 
  //it won't fit in an int.
  if(len > 11) {
    return false;
  }
  char c = s.charAt(0);
  int i = 0;
  //I don't mind the plus sign, so "+13" will return true.
  if(c == '-' || c == '+') {
    //A single "+" or "-" is not a valid integer.
    if(len == 1) {
      return false;
    }
    i = 1;
  }
  //Check if all chars are digits
  for(; i < len; i++) {
    c = s.charAt(i);
    if(c < '0' || c > '9') {
      return false;
    }
  }
  //If we reached this point then we know for sure that the string has at
  //most 11 chars and that they're all digits (the first one might be a '+'
  // or '-' thought).
  //Now we just need to check, for 10 and 11 chars long strings, if the numbers
  //represented by the them don't surpass the limits.
  c = s.charAt(0);
  char l;
  String limit;
  if(len == 10 && c != '-' && c != '+') {
    limit = "2147483647";
    //Now we are going to compare each char of the string with the char in
    //the limit string that has the same index, so if the string is "ABC" and
    //the limit string is "DEF" then we are gonna compare A to D, B to E and so on.
    //c is the current string's char and l is the corresponding limit's char
    //Note that the loop only continues if c == l. Now imagine that our string
    //is "2150000000", 2 == 2 (next), 1 == 1 (next), 5 > 4 as you can see,
    //because 5 > 4 we can guarantee that the string will represent a bigger integer.
    //Similarly, if our string was "2139999999", when we find out that 3 < 4,
    //we can also guarantee that the integer represented will fit in an int.
    for(i = 0; i < len; i++) {
      c = s.charAt(i);
      l = limit.charAt(i);
      if(c > l) {
        return false;
      }
      if(c < l) {
        return true;
      }
    }
  }
  c = s.charAt(0);
  if(len == 11) {
    //If the first char is neither '+' nor '-' then 11 digits represent a 
    //bigger integer than 2147483647 (10 digits).
    if(c != '+' && c != '-') {
      return false;
    }
    limit = (c == '-') ? "-2147483648" : "+2147483647";
    //Here we're applying the same logic that we applied in the previous case
    //ignoring the first char.
    for(i = 1; i < len; i++) {
      c = s.charAt(i);
      l = limit.charAt(i);
      if(c > l) {
        return false;
      }
      if(c < l) {
        return true;
      }
    }
  }
  //The string passed all tests, so it must represent a number that fits
  //in an int...
  return true;
} 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2012-05-02T08:33:41.197

您可能还需要考虑用例：

如果大多数时候您希望数字有效，那么捕获异常只会在尝试转换无效数字时导致性能开销。而调用某些`isInteger()`方法然后使用转换*总是*`Integer.parseInt()`会导致有效数字的性能开销 - 字符串被解析两次，一次通过检查，一次通过转换。

 ** * *

## 回答 #21

> 赞同：1
> 
> 时间：2014-07-31T22:12:06.103

这是对**Jonas**代码的修改，它检查字符串是否在要转换为整数的范围内。

```
public static boolean isInteger(String str) {
    if (str == null) {
        return false;
    }
    int length = str.length();
    int i = 0;

    // set the length and value for highest positive int or lowest negative int
    int maxlength = 10;
    String maxnum = String.valueOf(Integer.MAX_VALUE);
    if (str.charAt(0) == '-') { 
        maxlength = 11;
        i = 1;
        maxnum = String.valueOf(Integer.MIN_VALUE);
    }  

    // verify digit length does not exceed int range
    if (length > maxlength) { 
        return false; 
    }

    // verify that all characters are numbers
    if (maxlength == 11 && length == 1) {
        return false;
    }
    for (int num = i; num < length; num++) {
        char c = str.charAt(num);
        if (c < '0' || c > '9') {
            return false;
        }
    }

    // verify that number value is within int range
    if (length == maxlength) {
        for (; i < length; i++) {
            if (str.charAt(i) < maxnum.charAt(i)) {
                return true;
            }
            else if (str.charAt(i) > maxnum.charAt(i)) {
                return false;
            }
        }
    }
    return true;
} 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2015-04-22T23:16:42.330

我相信遇到异常的风险为零，因为正如您在下面看到的那样，您始终可以安全地解析`int`而`String`不是相反。

所以：

1.  您**检查**字符串中的每个字符槽是否至少匹配字符**{"0","1","2","3","4","5","6","7", "8","9"}**。

    ```
    if(aString.substring(j, j+1).equals(String.valueOf(i))) 
    ```

2.  您将在插槽中遇到的所有时间都与上述字符**相加。**

    ```
    digits++; 
    ```

3.  最后，您**检查**您遇到整数作为字符的次数是否等于给定字符串的长度。

    ```
    if(digits == aString.length()) 
    ```

在实践中，我们有：

```
 String aString = "1234224245";
    int digits = 0;//count how many digits you encountered
    for(int j=0;j<aString.length();j++){
        for(int i=0;i<=9;i++){
            if(aString.substring(j, j+1).equals(String.valueOf(i)))
                    digits++;
        }
    }
    if(digits == aString.length()){
        System.out.println("It's an integer!!");
        }
    else{
        System.out.println("It's not an integer!!");
    }

    String anotherString = "1234f22a4245";
    int anotherDigits = 0;//count how many digits you encountered
    for(int j=0;j<anotherString.length();j++){
        for(int i=0;i<=9;i++){
            if(anotherString.substring(j, j+1).equals(String.valueOf(i)))
                    anotherDigits++;
        }
    }
    if(anotherDigits == anotherString.length()){
        System.out.println("It's an integer!!");
        }
    else{
        System.out.println("It's not an integer!!");
    } 
```

结果是：

> 是整数！！
> 
> 不是整数！！

同样，您可以验证 a`String`是 a`float`还是 a`double`但在这些情况下您只需要遇到**一个 。**（点）在字符串中，当然检查是否 `digits == (aString.length()-1)`

> 同样，在这里遇到解析异常的风险为零，但是如果您打算解析一个已知包含数字的字符串（比如说**int**数据类型），您必须首先检查它是否适合该数据类型。否则你必须施放它。

我希望我有所帮助

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2015-07-08T12:32:03.883

如果您使用的是 Android API，您可以使用：

```
TextUtils.isDigitsOnly(str); 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-10-25T23:12:38.643

你所做的工作，但你可能不应该总是这样检查。抛出异常应该保留用于“异常”情况（尽管这可能适合您的情况），并且在性能方面非常昂贵。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2012-03-30T03:29:19.200

这仅适用于正整数。

```
public static boolean isInt(String str) {
    if (str != null && str.length() != 0) {
        for (int i = 0; i < str.length(); i++) {
            if (!Character.isDigit(str.charAt(i))) return false;
        }
    }
    return true;        
} 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2014-12-19T08:58:57.680

这对我有用。只是为了识别一个字符串是一个原始的还是一个数字。

```
private boolean isPrimitive(String value){
        boolean status=true;
        if(value.length()<1)
            return false;
        for(int i = 0;i<value.length();i++){
            char c=value.charAt(i);
            if(Character.isDigit(c) || c=='.'){

            }else{
                status=false;
                break;
            }
        }
        return status;
    } 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2015-03-29T13:39:13.167

要检查所有 int 字符，您可以简单地使用双重否定。

if (!searchString.matches("[^0-9]+$")) ...

[^0-9]+$ 检查是否有任何不是整数的字符，因此如果为真则测试失败。只是不是那样，你会真正成功。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2016-11-01T10:54:56.837

我在这里看到了很多答案，但他们中的大多数都能够确定字符串是否为数字，但他们无法检查数字是否在整数范围内......

因此，我的目的是这样的：

```
public static boolean isInteger(String str) {
    if (str == null || str.isEmpty()) {
        return false;
    }
    try {
        long value = Long.valueOf(str);
        return value >= -2147483648 && value <= 2147483647;
    } catch (Exception ex) {
        return false;
    }
} 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2018-06-30T17:02:31.160

**当解释比表现更重要时**

我注意到许多讨论集中在某些解决方案的效率上，但没有关于*为什么*字符串不是整数的讨论。此外，每个人似乎都认为数字“2.00”不等于“2”。从数学和人性上讲，它们*是*平等的（尽管计算机科学说它们不是，而且有充分的理由）。这就是为什么上面的“Integer.parseInt”解决方案很弱（取决于您的要求）。

无论如何，为了让软件更智能、更人性化，我们需要创建像我们一样思考并解释失败*原因的软件。*在这种情况下：

```
public static boolean isIntegerFromDecimalString(String possibleInteger) {
possibleInteger = possibleInteger.trim();
try {
    // Integer parsing works great for "regular" integers like 42 or 13.
    int num = Integer.parseInt(possibleInteger);
    System.out.println("The possibleInteger="+possibleInteger+" is a pure integer.");
    return true;
} catch (NumberFormatException e) {
    if (possibleInteger.equals(".")) {
        System.out.println("The possibleInteger=" + possibleInteger + " is NOT an integer because it is only a decimal point.");
        return false;
    } else if (possibleInteger.startsWith(".") && possibleInteger.matches("\\.[0-9]*")) {
        if (possibleInteger.matches("\\.[0]*")) {
            System.out.println("The possibleInteger=" + possibleInteger + " is an integer because it starts with a decimal point and afterwards is all zeros.");
            return true;
        } else {
            System.out.println("The possibleInteger=" + possibleInteger + " is NOT an integer because it starts with a decimal point and afterwards is not all zeros.");
            return false;
        }
    } else if (possibleInteger.endsWith(".")  && possibleInteger.matches("[0-9]*\\.")) {
        System.out.println("The possibleInteger="+possibleInteger+" is an impure integer (ends with decimal point).");
        return true;
    } else if (possibleInteger.contains(".")) {
        String[] partsOfPossibleInteger = possibleInteger.split("\\.");
        if (partsOfPossibleInteger.length == 2) {
            //System.out.println("The possibleInteger=" + possibleInteger + " is split into '" + partsOfPossibleInteger[0] + "' and '" + partsOfPossibleInteger[1] + "'.");
            if (partsOfPossibleInteger[0].matches("[0-9]*")) {
                if (partsOfPossibleInteger[1].matches("[0]*")) {
                    System.out.println("The possibleInteger="+possibleInteger+" is an impure integer (ends with all zeros after the decimal point).");
                    return true;
                } else if (partsOfPossibleInteger[1].matches("[0-9]*")) {
                    System.out.println("The possibleInteger=" + possibleInteger + " is NOT an integer because it the numbers after the decimal point (" + 
                                partsOfPossibleInteger[1] + ") are not all zeros.");
                    return false;
                } else {
                    System.out.println("The possibleInteger=" + possibleInteger + " is NOT an integer because it the 'numbers' after the decimal point (" + 
                            partsOfPossibleInteger[1] + ") are not all numeric digits.");
                    return false;
                }
            } else {
                System.out.println("The possibleInteger=" + possibleInteger + " is NOT an integer because it the 'number' before the decimal point (" + 
                        partsOfPossibleInteger[0] + ") is not a number.");
                return false;
            }
        } else {
            System.out.println("The possibleInteger="+possibleInteger+" is NOT an integer because it has a strange number of decimal-period separated parts (" +
                    partsOfPossibleInteger.length + ").");
            return false;
        }
    } // else
    System.out.println("The possibleInteger='"+possibleInteger+"' is NOT an integer, even though it has no decimal point.");
    return false;
}
} 
```

测试代码：

```
String[] testData = {"0", "0.", "0.0", ".000", "2", "2.", "2.0", "2.0000", "3.14159", ".0001", ".", "$4.0", "3E24", "6.0221409e+23"};
int i = 0;
for (String possibleInteger : testData ) {
    System.out.println("");
    System.out.println(i + ". possibleInteger='" + possibleInteger +"' isIntegerFromDecimalString=" + isIntegerFromDecimalString(possibleInteger));
    i++;
} 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2019-07-05T12:42:21.887

我不喜欢使用正则表达式的方法，因为正则表达式无法检查范围（`Integer.MIN_VALUE`, `Integer.MAX_VALUE`）。

如果您在大多数情况下期望 int 值，而不是 int 是不常见的，那么我建议使用带有`Integer.valueOf`或`Integer.parseInt`带有`NumberFormatException`捕获的版本。这种方法的优点 - 您的代码具有良好的可读性：

```
public static boolean isInt(String s) {
  try {
    Integer.parseInt(s);
    return true;
  } catch (NumberFormatException nfe) {
    return false;
  }
} 
```

如果您需要检查 String 是否为整数，并且关心性能，那么最好的方法是使用 java jdk 实现`Integer.parseInt`，但几乎没有修改（用 return false 替换 throw）：

**此功能具有良好的性能和保证正确的结果：**

```
 public static boolean isInt(String s) {
    int radix = 10;

    if (s == null) {
        return false;
    }

    if (radix < Character.MIN_RADIX) {
        return false;
    }

    if (radix > Character.MAX_RADIX) {
        return false;
    }

    int result = 0;
    boolean negative = false;
    int i = 0, len = s.length();
    int limit = -Integer.MAX_VALUE;
    int multmin;
    int digit;

    if (len > 0) {
        char firstChar = s.charAt(0);
        if (firstChar < '0') { // Possible leading "+" or "-"
            if (firstChar == '-') {
                negative = true;
                limit = Integer.MIN_VALUE;
            } else if (firstChar != '+')
                return false;

            if (len == 1) // Cannot have lone "+" or "-"
                return false;
            i++;
        }
        multmin = limit / radix;
        while (i < len) {
            // Accumulating negatively avoids surprises near MAX_VALUE
            digit = Character.digit(s.charAt(i++), radix);
            if (digit < 0) {
                return false;
            }
            if (result < multmin) {
                return false;
            }
            result *= radix;
            if (result < limit + digit) {
                return false;
            }
            result -= digit;
        }
    } else {
        return false;
    }
    return true;
} 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2020-06-22T17:17:31.420

你可以：

1.  检查字符串是否为数字
2.  检查它是否不会太长而被解析为`long`
3.  检查结果`long`值是否小到可以用`int`

（假设您出于某种原因必须自己实现：您可能应该先看看`com.google.common.primitives.Ints.tryParse(String)`这是否足以满足您的目的（如[另一个答案中所建议的那样](https://stackoverflow.com/a/34651222/1725151)）。）

```
// Credit to Rastislav Komara’s answer: https://stackoverflow.com/a/237895/1725151
private static final Pattern nonZero = Pattern.compile("^-?[1-9]\\d*$");

// See if `str` can be parsed as an `int` (does not trim)
// Strings like `0023` are rejected (leading zeros).
public static boolean parsableAsInt(@Nonnull String str) {
    if (str.isEmpty()) {
        return false;
    }
    if (str.equals("0")) {
        return true;
    }
    if (canParseAsLong(str)) {
        long value = Long.valueOf(str);
        if (value >= Integer.MIN_VALUE && value <= Integer.MAX_VALUE) {
            return true;
        }
    }
    return false;
}

private static boolean canParseAsLong(String str) {
    final int intMaxLength = 11;
    return str.length() <= intMaxLength && nonZero.matcher(str).matches();
} 
```

此方法也可以转换为返回`Optional<Integer>`，这样您就不必在客户端代码中解析字符串两次（一次是检查是否可能，第二次是“真正地”解析）。例如：

```
if (canParseAsLong(str)) {
    long value = Long.valueOf(str);
    if (value >= Integer.MIN_VALUE && value <= Integer.MAX_VALUE) {
        return Optional.of((int) value);
    }
} 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2020-07-28T21:28:18.773

对@Jonas K anwser 进行了一点改进，此功能将排除单个运算符，例如`"*"`.

```
public boolean isInteger(String str) {
    // null pointer
    if (str == null) {
        return false;
    }
    int len = str.length();
    // empty string
    if (len == 0) {
        return false;
    }
    // one digit, cannot begin with 0
    if (len == 1) {
        char c = str.charAt(0);
        if ((c < '1') || (c > '9')) {
            return false;
        }
    }

    for (int i = 0; i < len; i++) {
        char c = str.charAt(i);
        // check positive, negative sign
        if (i == 0) {
            if (c == '-' || c == '+') {
                continue;
            }
        }
        // check each character matches [0-9]
        if ((c < '0') || (c > '9')) {
            return false;
        }
    }
    return true;
} 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2020-09-27T14:15:12.413

我最近（今天）需要找到一个快速的方法来做到这一点，当然当肩膀上的猴子（良心）醒来时我会使用异常方法来缓解，所以它把我带到了这个熟悉的老兔子洞；没有异常并没有那么昂贵，事实上有时异常更快（旧的 AIX 多处理器系统），但不管它是否优雅，所以我做了一些年轻的我从未做过的事情，令我惊讶的是，这里也没有人做过（如果有人做过，我道歉错过了我真的没有找到）：所以我认为我们都错过了什么；看看 JRE 是如何实现它的，是的，他们抛出了一个异常，但我们总是可以跳过那部分。

10 年前年轻的我会觉得这在他之下，但话又说回来，他又是一个大嘴炫耀的人，气质差，有上帝情结，所以就是这样。

我把它放在这里是为了将来来这里的任何人的利益。这是我发现的：

```
public static int parseInt(String s, int radix) throws NumberFormatException
{
    /*
     * WARNING: This method may be invoked early during VM initialization
     * before IntegerCache is initialized. Care must be taken to not use
     * the valueOf method.
     */

    if (s == null) {
        throw new NumberFormatException("null");
    }

    if (radix < Character.MIN_RADIX) {
        throw new NumberFormatException("radix " + radix +
                                        " less than Character.MIN_RADIX");
    }

    if (radix > Character.MAX_RADIX) {
        throw new NumberFormatException("radix " + radix +
                                        " greater than Character.MAX_RADIX");
    }

    int result = 0;
    boolean negative = false;
    int i = 0, len = s.length();
    int limit = -Integer.MAX_VALUE;
    int multmin;
    int digit;

    if (len > 0) {
        char firstChar = s.charAt(0);
        if (firstChar < '0') { // Possible leading "+" or "-"
            if (firstChar == '-') {
                negative = true;
                limit = Integer.MIN_VALUE;
            } else if (firstChar != '+')
                throw NumberFormatException.forInputString(s);

            if (len == 1) // Cannot have lone "+" or "-"
                throw NumberFormatException.forInputString(s);
            i++;
        }
        multmin = limit / radix;
        while (i < len) {
            // Accumulating negatively avoids surprises near MAX_VALUE
            digit = Character.digit(s.charAt(i++),radix);
            if (digit < 0) {
                throw NumberFormatException.forInputString(s);
            }
            if (result < multmin) {
                throw NumberFormatException.forInputString(s);
            }
            result *= radix;
            if (result < limit + digit) {
                throw NumberFormatException.forInputString(s);
            }
            result -= digit;
        }
    } else {
        throw NumberFormatException.forInputString(s);
    }
    return negative ? result : -result;
} 
```

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2020-11-05T09:16:48.887

这里有几个答案说尝试解析为整数并捕获 NumberFormatException 但你不应该这样做。

这种方式会创建异常对象并在每次调用它时生成一个堆栈跟踪，它不是一个整数。

Java 8 的更好方法是使用流：

```
boolean isInteger = returnValue.chars().allMatch(Character::isDigit); 
```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2020-12-12T07:26:29.260

对于**kotlin**，`isDigitsOnly()` *（对于 Java 也是`TextUtils.isDigitsOnly()`*如此*）*`String`总是返回 false 它前面有一个负号，尽管字符的其余部分只是数字。例如 -

```
/** For kotlin*/
var str = "-123" 
str.isDigitsOnly()  //Result will be false 

/** For Java */
String str = "-123"
TextUtils.isDigitsOnly(str) //Result will be also false 
```

所以我通过这个快速修复 -

```
 var isDigit=str.matches("-?\\d+(\\.\\d+)?".toRegex()) 
/** Result will be true for now*/ 
```

* * *

## 回答 #36

> 赞同：-1
> 
> 时间：2008-10-26T08:07:15.367

```
Number number;
try {
    number = NumberFormat.getInstance().parse("123");
} catch (ParseException e) {
    //not a number - do recovery.
    e.printStackTrace();
}
//use number 
```

* * *

## 回答 #37

> 赞同：-1
> 
> 时间：2014-05-13T11:30:21.030

对于那些在提出问题多年后像我一样来到这里的读者，对于这个问题，我有一个更通用的解决方案。

```
/**
 * Checks, if the string represents a number.
 *
 * @param string the string
 * @return true, if the string is a number
 */
public static boolean isANumber(final String string) {
    if (string != null) {
        final int length = string.length();
        if (length != 0) {
            int i = 0;
            if (string.charAt(0) == '-') {
                if (length == 1) {
                    return false;
                }
                i++;
            }
            for (; i < length; i++) {
                final char c = string.charAt(i);
                if ((c <= PERIOD) || ((c >= COLON))) {
                    final String strC = Character.toString(c).toUpperCase();
                    final boolean isExponent = strC.equals("E");
                    final boolean isPeriod = (c == PERIOD);
                    final boolean isPlus = (c == PLUS);

                    if (!isExponent && !isPeriod && !isPlus) {
                        return false;
                    }
                }
            }
            return true;
        }
    }
    return false;
} 
```

* * *

## 回答 #38

> 赞同：-1
> 
> 时间：2015-07-04T07:30:31.383

发现这可能会有所帮助：

```
public static boolean isInteger(String self) {
    try {
        Integer.valueOf(self.trim());
        return true;
    } catch (NumberFormatException nfe) {
        return false;
    }
} 
```

* * *

## 回答 #39

> 赞同：-1
> 
> 时间：2016-04-11T05:05:08.860

```
public class HelloWorld{

    static boolean validateIP(String s){
        String[] value = s.split("\\.");
        if(value.length!=4) return false;
        int[] v = new int[4];
        for(int i=0;i<4;i++){
            for(int j=0;j<value[i].length();j++){
                if(!Character.isDigit(value[i].charAt(j))) 
                 return false;
            }
            v[i]=Integer.parseInt(value[i]);
            if(!(v[i]>=0 && v[i]<=255)) return false;
        }
        return true;
    }

    public static void main(String[] argv){
        String test = "12.23.8.9j";
        if(validateIP(test)){
            System.out.println(""+test);
        }
    }
} 
```

* * *

## 回答 #40

> 赞同：-3
> 
> 时间：2008-10-26T00:11:57.853

```
Integer.valueOf(string); 
```

大多数时候为我工作！

# objective-c - 在 Cocoa 中通过 NSURLRequest/NSURLConnection 接收 HTTP 标头

> ID：237164
> 
> 赞同：21
> 
> 时间：2008-10-25T23:04:08.753
> 
> 标签：objective-c, iphone, cocoa, macos

我一直在研究如何通过使用 NSURLConnection 发出的请求来接收 HTTP 标头。通常，使用以下简单内容发出请求：

```
 NSURLConnection *connection = [[NSURLConnection alloc]
    initWithRequest:request
        delegate:self]; 
```

我个人在 Apple 丰富的文档中发现接收响应标头的唯一方法是通过使用以下 NSURLConnection 类方法的同步调用：

```
+ (NSData *)sendSynchronousRequest:(NSURLRequest *)request returningResponse:(NSURLResponse **)response error:(NSError **)error 
```

在这里我可以很容易地引用一个 NSURLResponse 类型的响应对象。这里的问题是我还没有准备好通过移动设备发出同步请求，尤其是对于像 EDGE 这样具有高延迟的网络。是否可以使用 NSURLConnection 的默认异步行为获得类似的结果？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-10-25T23:23:49.913

在您的连接委托中，添加该`-connection:didReceiveResponse:`方法。如果您正在执行标准 HTTP 请求，则传入的 NSURLResponse 对象实际上将是一个 NSHTTPURLResponse 对象，并响应`-allHeaderFields`消息。这应该是您正在寻找的。

# c# - 生成 Linq 数据上下文

> ID：237175
> 
> 赞同：1
> 
> 时间：2008-10-25T23:10:17.087
> 
> 标签：c#, sql

有谁知道 Linq 的 DataContext 生成器是否存在 API？我反映了 SqlMetal.exe，但每个类都标记为内部。我想生成一个像 sqlmetal 一样的 datacontext .cs，但是来自我自己的程序集。

谢谢！詹姆士

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-25T23:24:20.507

SqlMetal 中的所有类都是内部的，因为它们是为构建 LINQ to SQL 模式的类而设计的。如果您想从自己的程序集中生成自己的类，则需要编写自己的生成器。

有几种方法可以解决这个问题：

1.  使用模板引擎
2.  使用 CodeDom

我一直在使用 CodeDom 编写自己的 ORM，至少可以说很棘手。你需要写很多代码来生成一点。

除了反映其他实现和对各种类使用 MSDN 参考之外，我发现使用 CodeDom 的好例子并不多。

# iphone - 如何从 UIViewController 中删除 UINavigationBar？

> ID：237196
> 
> 赞同：5
> 
> 时间：2008-10-25T23:29:19.653
> 
> 标签：iphone, cocoa-touch

我正在试验 iPhone 的 NavBar 示例项目。当我在默认视图中点击表中的一行时，一个新视图会滑入（到目前为止一切都很好）。我想删除滑入的新视图顶部的 UINavigationBar 栏。我该怎么做？

编辑：我的意思是“UINavigationBar”。感谢大家的回应！

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-25T23:36:20.263

您是指状态栏（显示时间和电池状态的位置）还是 UINavigationBar（标题和后退按钮所在的位置）？

*   要隐藏状态栏， `[UIApplication sharedApplication].statusBarHidden = YES;` 请在您的`-applicationDidFinishLaunching:`方法中使用。

*   要隐藏 UINavigationBar，您需要使用`navigationBarHidden`UINavigationController 的属性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-25T23:32:18.120

```
[[UIApplication sharedApplication]setHidesStatusBar:YES]; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-25T23:35:09.470

您可以通过在 UIApplication (sharedApplication) 上调用 setHidesStatusBar 以编程方式隐藏它，也可以在 plist 中设置它。检查 CrashLanding 的 plist。

# iphone - 从 OpenGL 视图显示视图控制器

> ID：237198
> 
> 赞同：3
> 
> 时间：2008-10-25T23:30:22.023
> 
> 标签：iphone, cocoa-touch, opengl

我创建了一个基于 OpenGL 视图的 iPhone 应用程序。现在我想展示一个“设置”表单。由于我的代码在 UIView 中运行，因此我没有 pushViewController。如何在屏幕上显示视图控制器？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-26T01:17:18.577

您可以通过以下两种方式之一执行此操作：

*   您可以创建一个新的视图层次结构，然后在您想要显示首选项时将其添加为 UIWindow 的子视图。完成首选项后，您可以对其进行动画处理，然后将其作为子视图删除。

*   您可以切换到基于 UINavigationController/UIVIewController 的层次结构，并将当前的 OpenGL/UIView 连接到 UIViewController 的视图出口。然后，您可以使用所有基于 UINavigationController 的常规导航内容。

# c# - 使用 LINQ 查询 DataColumnCollection

> ID：237201
> 
> 赞同：82
> 
> 时间：2008-10-25T23:32:13.157
> 
> 标签：c#, linq, datatable, asqueryable, datacolumncollection

我正在尝试对 DataTable 的 Columns 属性执行简单的 LINQ 查询：

```
from c in myDataTable.Columns.AsQueryable()
    select c.ColumnName 
```

但是，我得到的是：

> 找不到源类型“System.Linq.IQueryable”的查询模式的实现。未找到“选择”。考虑明确指定范围变量“c”的类型。

如何让 DataColumnCollection 与 LINQ 配合使用？

* * *

## 回答 #1

> 赞同：138
> 
> 时间：2008-10-26T00:00:54.847

怎么样：

```
var x = from c in dt.Columns.Cast<DataColumn>()
        select c.ColumnName; 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2012-04-03T15:09:44.197

您还可以使用：

```
var x = from DataColumn c in myDataTable.Columns
        select c.ColumnName 
```

它将有效地执行与 Dave 的代码相同的操作：根据[`Enumerable.Cast<TResult> Method`](http://msdn.microsoft.com/en-us/library/bb341406.aspx)MSDN 文章，“在查询表达式中，显式类型化的迭代变量转换为对 Cast(IEnumerable) 的调用”。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2018-03-15T14:59:23.893

使用 Linq 方法语法：

```
var x = myDataTable.Columns.Cast<DataColumn>().Select(c => c.ColumnName); 
```

# iphone - 在没有选择器或 UI 的情况下访问地址簿

> ID：237203
> 
> 赞同：3
> 
> 时间：2008-10-25T23:32:22.067
> 
> 标签：iphone

我在某处读到 Aurora Feint 设法在不使用选择器的情况下访问地址簿。是否可以遍历所有记录？Aurora Feint 在 AppStore 上可用，所以我假设他们使用的 SDK 没有私有框架。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-26T00:49:32.427

可以使用非常标准的 AB* 函数在 iPhone 通讯录上进行操作。这包括遍历地址簿中的现有联系人以及联系人的每个属性。不是最容易使用的 API，但有可用的示例。

# python - 任何用于解析 apache 配置文件的 python 库？

> ID：237209
> 
> 赞同：12
> 
> 时间：2008-10-25T23:36:52.960
> 
> 标签：python, parsing, apache-config

任何用于解析 apache 配置文件的 python 库，或者如果不是 python，任何人都知道其他语言（perl、php、java、c#）中的这种东西？因为我将能够在 python 中重写它们。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-03-15T22:27:46.260

我确实在这里找到了一个有趣的 Apache Config 解析器：[http ://www.poldylicious.de/node/25](http://www.poldylicious.de/node/25)

提到的 Apache Config Parser 没有记录，但它确实有效。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-26T05:12:34.983

Red Hat 的新兴技术小组有[Augeas](http://augeas.net/)（用 C 语言编写，但可以使用 Python 绑定），这是一个通用的系统配置工具，带有用于读取和写入几种不同配置文件格式的“镜头”。我会考虑调查 Apache 镜头的可用性。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2017-05-10T12:04:13.173

截至 2016 年有一个使用 pyparsing 编写的新库：

[https://pypi.python.org/pypi/parse_apache_configs/](https://pypi.python.org/pypi/parse_apache_configs/)

有一些粗糙的边缘，但允许我添加指令并保存到新文件。

来源[https://github.com/alextricity25/parse_apache_configs](https://github.com/alextricity25/parse_apache_configs)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-25T23:50:12.327

我所知道的不存在 Python 库，但这里有一个 perl 库： [http ://packages.debian.org/sid/libapache-configfile-perl](http://packages.debian.org/sid/libapache-configfile-perl)

```
Package: libapache-configfile-perl
Priority: optional
Section: interpreters
Installed-Size: 124
Maintainer: Michael Alan Dorman
Version: 1.18-1
Depends: perl (>= 5.6.0-16)
Description: Parse an Apache style httpd.conf configuration file

This module parses the Apache httpd.conf, or any
compatible config file, and provides methods for
you to access the values from the config file. 
```

如果您确实用 Python 重写了它，请更新您的帖子以在 PyPI 上提及您的包的名称！:)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-05-16T11:18:05.873

还发布了一个新的解析器。

*   [http://pypi.python.org/pypi/apache_conf_parser/](http://pypi.python.org/pypi/apache_conf_parser/)

它仍然缺乏文档，但是很容易理解。

* * *

例子

```
import apache_conf_parser
import pprint

DEFAULT_VHOST = '/etc/apache2/sites-available/000-default.conf'

vhost_default = apache_conf_parser.ApacheConfParser(DEFAULT_VHOST)

print vhost_default.nodes
print vhost_default.nodes[0].body.nodes

pprint.pprint( 
    {
        i.name: [i.arguments for i in vhost_default.nodes[0].body.nodes]
    }
) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-26T04:04:52.327

我认为 ZConfig 曾经附带一个用于解析 Apache 配置文件的模式；它似乎不再存在，但它围绕解析这些类型的文件并将配置转换为 Python 对象。快速浏览一下文档表明，设置与您想要解析和验证的任何 Apache 选项相对应的 ZConfig 模式并不难。

[http://pypi.python.org/pypi/ZConfig/2.6.0](http://pypi.python.org/pypi/ZConfig/2.6.0)

# python - 您如何以编程方式重新排序 ATFolder 子类的子类？

> ID：237211
> 
> 赞同：6
> 
> 时间：2008-10-25T23:41:52.453
> 
> 标签：python, plone, zope, archetypes

我有 Plone 产品，它使用自定义文件夹类型来包含一组自定义内容对象。文件夹类型是通过继承 BaseFolder 创建的，它有一个带有几个文本字段的模式。目前，当自定义对象添加到自定义文件夹时，对象按其 ID 的字母顺序排序。如何覆盖此行为并允许我的用户手动对自定义文件夹进行排序，例如通过“内容”视图？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-27T16:13:39.300

最快的解决方案：来自 ATFolder 而不是 BaseFolder 的子类。这为您提供了所有“正常”重新排序和其他常见的 plone 文件夹功能（我怀疑您也想要）。

如果您想更有选择性，请查看 Products/ATContentTypes/content/base.py：ATCTOrderedFolder 和 OrderedBaseFolder。

# c# - Silverlight 2 和大画布？

> ID：237218
> 
> 赞同：1
> 
> 时间：2008-10-25T23:51:39.127
> 
> 标签：c#, silverlight, silverlight-2.0

我正在开发一个使用多个大型画布控件（跨越数千像素）的应用程序，这些控件相互分层。画布控件本身是完全不可见的，但每个都包含许多控件，主要是图像。

我的问题是，是否有推荐的画布最大尺寸，还是纯粹是内存问题？此外，我们是否最好将 Canvas 大小设置为 (0, 0) 并利用我们可以愉快地在画布边界之外渲染控件的事实？

谢谢，

G

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-14T17:19:56.287

注意：Silverlight 画布的最大尺寸为 32767 点。这是因为 UIElements 的大小不像 WPF 中那样存储为浮点数，而是以 32 位的数量存储，其中 16 位形成大小的整数，16 位形成它的浮点部分。因此，请确保您的画布不会比这更大，也不会更大。

您需要使其更大的解决方案是自己进行滚动并自己定位对象。实际上，您正在重新创建画布。这在 WPF 术语中称为虚拟化。

内存消耗不会因画布大小而变大，而仅取决于控件的数量和这些控件的累积内存大小。但是，如果您将拥有大量 WPF 对象，则布局阶段确实需要相当长的时间来处理更多（例如，超过 1000 个）对象。如果这将是一个问题，您需要自己重新编写代码并缓存相同类型的未使用 WPF 对象（因为 WPF 对象创建也很慢）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-27T21:32:11.747

根据我对内部结构的理解`Canvas`，它应该不需要额外的内存来变大。

对于非零尺寸，我想到的第一件事`Canvas`是它允许一个人相对于四个角中的任何一个将物品放在上面，这在调整容器大小时会有所帮助。

# algorithm - 图轴的刻度线算法

> ID：237220
> 
> 赞同：27
> 
> 时间：2008-10-25T23:54:35.860
> 
> 标签：algorithm, optimization, paint

我正在寻找一种算法，该算法将刻度线放置在轴上，给定要显示的范围，要在其中显示的宽度以及用于测量刻度线的字符串宽度的函数。

例如，假设我需要在 1e-6 和 5e-6 之间显示以及以像素为单位显示的宽度，算法将确定我应该在 1e-6、2e-6、3e-6 处放置刻度线（例如） 、4e-6 和 5e-6。给定一个较小的宽度，它可能决定最佳位置仅在偶数位置，即 2e-6 和 4e-6 （因为放置更多的刻度会导致它们重叠）。

智能算法将优先考虑 10、5 和 2 倍数的刻度线。此外，智能算法将在零附近对称。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2018-04-19T01:09:49.963

由于我不喜欢迄今为止找到的任何解决方案，因此我实施了自己的解决方案。它在 C# 中，但可以很容易地翻译成任何其他语言。

它基本上从可能的步骤列表中选择显示所有值的最小步骤，**而不会在边缘留下任何值**，让您轻松选择要使用的可能步骤（无需编辑丑陋的`if-else if`块），并支持任何范围的价值观。我使用 C#`Tuple`返回三个值只是为了快速简单的演示。

```
private static Tuple<decimal, decimal, decimal> GetScaleDetails(decimal min, decimal max)
{
    // Minimal increment to avoid round extreme values to be on the edge of the chart
    decimal epsilon = (max - min) / 1e6m;
    max += epsilon;
    min -= epsilon;
    decimal range = max - min;

    // Target number of values to be displayed on the Y axis (it may be less)
    int stepCount = 20;
    // First approximation
    decimal roughStep = range / (stepCount - 1);

    // Set best step for the range
    decimal[] goodNormalizedSteps = { 1, 1.5m, 2, 2.5m, 5, 7.5m, 10 }; // keep the 10 at the end
    // Or use these if you prefer:  { 1, 2, 5, 10 };

    // Normalize rough step to find the normalized one that fits best
    decimal stepPower = (decimal)Math.Pow(10, -Math.Floor(Math.Log10((double)Math.Abs(roughStep))));
    var normalizedStep = roughStep * stepPower;
    var goodNormalizedStep = goodNormalizedSteps.First(n => n >= normalizedStep);
    decimal step = goodNormalizedStep / stepPower;

    // Determine the scale limits based on the chosen step.
    decimal scaleMax = Math.Ceiling(max / step) * step;
    decimal scaleMin = Math.Floor(min / step) * step;

    return new Tuple<decimal, decimal, decimal>(scaleMin, scaleMax, step);
}

static void Main()
{
    // Dummy code to show a usage example.
    var minimumValue = data.Min();
    var maximumValue = data.Max();
    var results = GetScaleDetails(minimumValue, maximumValue);
    chart.YAxis.MinValue = results.Item1;
    chart.YAxis.MaxValue = results.Item2;
    chart.YAxis.Step = results.Item3;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-27T04:09:01.600

取关于零的最长线段（或整个图表，如果零不在范围内） - 例如，如果您在 [-5, 1] 范围内有一些东西，则取 [-5,0]。

计算出该段的大致长度，以刻度为单位。这只是将长度除以刻度的宽度。所以假设该方法说我们可以在 -5 到 0 之间放置 11 个刻度。这是我们的上限。对于较短的一面，我们将只在较长的一面反映结果。

现在尝试输入尽可能多（最多 11 个）的记号，这样每个记号的标记形式为 i*10*10^n、i*5*10^n、i*2*10^n，其中n 是整数，i 是刻度的索引。现在这是一个优化问题——我们想要最大化我们可以放入的刻度数，同时最小化最后一个刻度和结果结束之间的距离。因此，为获得尽可能多的滴答声分配一个分数，小于我们的上限，并为使最后一个滴答声接近 n 分配一个分数——您必须在这里进行实验。

在上面的例子中，尝试 n = 1。我们得到 1 个滴答声（在 i=0 时）。n = 2 给了我们 1 个滴答声，我们离下限更远，所以我们知道我们必须走另一条路。n = 0 在每个整数点上给我们 6 个刻度。n = -1 给了我们 12 个刻度（0, -0.5, ..., -5.0）。n = -2 给了我们 24 个刻度，依此类推。评分算法会给他们每个分数 - 越高意味着更好的方法。

对 i * 5 * 10^n 和 i*2*10^n 再次执行此操作，并选择得分最高的那个。

（作为一个示例评分算法，假设分数是到最后一个滴答声的距离乘以最大滴答声减去所需数量。这可能很糟糕，但它可以作为一个不错的起点）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-27T05:43:05.780

我一直在使用 jQuery [flot](https://github.com/flot/flot/blob/master/API.md)图形库。它是开源的，并且可以很好地生成轴/刻度线。我建议查看它的代码并从中汲取一些想法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-03-04T08:19:51.793

这个简单的算法产生的间隔是 1、2 或 5 乘以 10 的幂的倍数。并且轴范围被划分为至少 5 个间隔。代码示例采用 java 语言：

```
protected double calculateInterval(double range) {
    double x = Math.pow(10.0, Math.floor(Math.log10(range)));
    if (range / x >= 5)
        return x;
    else if (range / (x / 2.0) >= 5)
        return x / 2.0;
    else
        return x / 5.0;
} 
```

这是一个替代方案，至少 10 个间隔：

```
protected double calculateInterval(double range) {
    double x = Math.pow(10.0, Math.floor(Math.log10(range)));
    if (range / (x / 2.0) >= 10)
        return x / 2.0;
    else if (range / (x / 5.0) >= 10)
        return x / 5.0;
    else
        return x / 10.0;
} 
```

# web-services - 通过代理调用 WSE Web 服务

> ID：237221
> 
> 赞同：1
> 
> 时间：2008-10-25T23:54:39.230
> 
> 标签：web-services, proxy, wse

我正在使用 Web Services Enhancements 3.0 从使用 Visual Studio 2005 用 C# 编写的 ASP.NET 应用程序调用 Web 服务。

如果我将网络连接设置更改为使用特定的 SOCKS5 代理，我可以在 Internet Explorer 中调用 Web 服务，但是从 .ASPX 页面我收到一条错误消息，告诉我应该使用代理。

您知道如何配置 Web 服务客户端以使用代理吗？

谢谢

PS：

将以下内容添加到 Web.config 不起作用：

```
<system.net>
  <defaultProxy>
    <proxy proxyaddress="http://theproxy:8080" bypassonlocal="True" />
  </defaultProxy>
</system.net> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-19T10:24:08.973

您需要将 defaultProxy 元素的“启用”属性设置为“真”以使其工作：

```
<system.net>
  <defaultProxy **enabled="true"**>
    <proxy proxyaddress="http://theproxy:8080" bypassonlocal="True" />
  </defaultProxy>
</system.net> 
```

这应该有效。

# c# - 在 C# 中干燥对象实例化

> ID：237222
> 
> 赞同：1
> 
> 时间：2008-10-25T23:55:03.410
> 
> 标签：c#, .net

这段代码：

```
public class WidgetPlatform
{
    public Widget LeftmostWidget { get; set; }
    public Widget RightmostWidget { get; set; }

    public String GetWidgetNames()
    {
        return LeftmostWidget.Name + " " + RightmostWidget.Name;
    }
} 
```

不包含任何值得担心的重复，但它不是特别健壮。因为小部件没有进行空检查，所以我们为错误留下了一个空缺。我们可以做一个空检查，但这感觉像是工作。这是我真正想要的：

```
public class WidgetPlatform
{
    [Required]
    public Widget LeftmostWidget { get; set; }

    [Required]
    public Widget RightmostWidget { get; set; }

    public String GetWidgetNames()
    {
        return LeftmostWidget.Name + " " + RightmostWidget.Name;
    }
} 
```

理想情况下，如果在没有设置 Widget 的情况下实例化对象，则会导致编译错误（最好的错误类型），但这似乎是一项艰巨的任务。有没有办法使这种语法至少在实例化时引发错误？如果所有经过 null 检查的对象都从同一类型继承，但没有多重继承，那么有一种（相对）明显的方法可以通过反射来实现，这会很快变得丑陋。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-26T00:17:11.960

构造函数有什么问题？

```
public class WidgetPlatform
{
    public Widget LeftmostWidget { get; set; }
    public Widget RightmostWidget { get; set; }

    public WidgetPlatform()
    {
        this.LeftMostWidget = new Widget();
        this.RightMostWidget = new Widget();
    }

    public WidgetPlatform(Widget left, Widget right)
    {
        if(left == null || right == null)
            throw new ArgumentNullException("Eeep!");

        this.LeftMostWidget = left;
        this.RightMostWidget = right;
    }

    public String GetWidgetNames()
    {
        return LeftmostWidget.Name + " " + RightmostWidget.Name;
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-26T03:30:41.227

```
public class WidgetPlatform
{
     public Widget LeftWidget
     {
         get;
         private set;
     }

     public Widget RightWidget
     {
         get;
         private set;
     }

     WidgetPlatForm(Widget w1, Widget w2)
     {
         if (w1 == null || w2 == null)
             throw new ArgumentException();

         this.LeftWidget = w1;
         this.RightWidget = w2;          
     }

     // Etc
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-26T02:58:05.740

有一种观点认为最好封装你的构造函数，似乎在这里比较合适。参考：

[http://www.amazon.com/Emergent-Design-Evolutionary-Professional-Development/dp/0321509366](https://rads.stackoverflow.com/amzn/click/com/0321509366)

你可能会考虑：

```
public class WidgetPlatform
    {
        /// <summary>
        /// Hide the constructor.
        /// </summary>
        private WidgetPlatform(Widget left, Widget right)
        {
            this.LeftmostWidget = left;
            this.RightmostWidget = right;
        }

        public Widget LeftmostWidget
        {
            get;
            private set;
        }

        public Widget RightmostWidget
        {
            get;
            private set;
        }

        public static WidgetPlatform GetInstance(Widget left, Widget right)
        {
            return new WidgetPlatform(left, right);
        }
    } 
```

在 GetInstance 中，您可以检查是否为空，并决定如何处理它，或者不...此时您有很多选择。

希望有帮助...

# sql - SQL - 表设计 - DateCreated 和 DateUpdated 列

> ID：237225
> 
> 赞同：6
> 
> 时间：2008-10-26T00:02:49.837
> 
> 标签：sql, timestamp, insert-update

对于我的应用程序有几个实体类，User、Customer、Post 等

我即将设计数据库，我想存储创建和更新实体的日期。这就是棘手的地方。当然，一种选择是为每个实体表添加 created_timestamp 和 update_timestamp 列，但这不是多余的吗？

**另一种可能性是创建一个存储此信息的日志表，并且可以使其包含对任何**实体的更新的跟踪。

有什么想法吗？我倾向于实施后者。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-26T02:26:53.227

我能想到的单一日志表用于所有表的方法有两个主要问题：

1.  日志表的设计（可能）会限制所有其他表的设计。日志表很可能有一个名为 TableName 的列，然后是另一个名为 PKValue 的列（它将存储您正在记录的记录的主键值）。如果您的某些表具有复合主键（即多于一列），那么您的日志表的设计必须考虑到这一点（可能通过具有 PKValue1、PKValue2 等列）。
2.  如果这是某种 Web 应用程序，那么触发器中可用的用户身份将是应用程序的帐户，而不是 Web 应用程序用户的 ID（这很可能是您真正想要存储在 CreatedBy 中的内容）场地）。这只会帮助您区分由您的 Web 应用程序代码创建的记录和以其他方式创建的记录。

CreatedDate 和 ModifiedDate 列并不是多余的，因为它们是在每个表中定义的。我会坚持这种方法，并在每个表上放置插入和更新触发器以填充这些列。如果我还需要记录进行更改的最终用户，我会跳过触发器并从我的应用程序代码中填充时间戳和用户字段。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-26T00:06:18.580

我用“日志”或“事件”表做后者。以我的经验，“更新”的时间戳很快就会变得令人沮丧，因为很多时候你发现自己处于一个你想要的不仅仅是最新的更新时间的修复中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-26T00:05:42.217

您需要多久在表示层中包含创建/更新的时间戳？如果答案不仅仅是“很长时间一次”，我认为在每个表中都有这些列会更好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-26T01:07:00.363

在我几年前参与的一个项目中，我们实现了更新我们所谓的审计表的触发器（它存储了有关所做更改的基本信息，每个表一个审计表）。这包括修改日期（和最后修改日期）。

它们仅应用于关键表（而不是连接或引用数据表）。

这消除了许多必须考虑 LastCreated 和 LastModified 字段的正常挫败感，但引入了保持触发器最新的烦恼。

最后，触发器/审计表设计运行良好，我们只需要在 ETL（！）之前删除并重新应用触发器即可。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-26T12:23:35.287

它适用于我从事的基于网络的 CMS。创建日期和最后更新日期将显示在大多数页面上，并且会有最后创建（和更新）页面的列表。管理界面也将使用此信息。

# python - 在 django 中使用 Context 时如何禁用 HTML 编码

> ID：237235
> 
> 赞同：17
> 
> 时间：2008-10-26T00:09:08.187
> 
> 标签：python, django, django-templates

在我的 django 应用程序中，我使用模板来构建电子邮件正文，其中一个参数是 url，请注意 url 中有两个由 & 号分隔的参数。

```
t = loader.get_template("sometemplate")
c = Context({
   'foo': 'bar',
   'url': 'http://127.0.0.1/test?a=1&b=2',
})
print t.render(c) 
```

渲染后会产生：`http://127.0.0.1/test?a=1&amp;amp;b=2`

请注意，与号是 HTML 编码为“&”。解决该问题的一种方法是将每个参数分别传递给我的模板并在模板中构造 url，但是我想避免这样做。

有没有办法禁用上下文参数的 HTML 编码，或者至少避免对 & 符号进行编码？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-26T00:13:28.067

要为单个变量关闭它，请使用`mark_safe`：

```
from django.utils.safestring import mark_safe

t = loader.get_template("sometemplate")
c = Context({
   'foo': 'bar',
   'url': mark_safe('http://127.0.0.1/test?a=1&b=2'),
})
print t.render(c) 
```

或者，要完全关闭 Python 代码的自动转义，请[在初始化 a 时](http://docs.djangoproject.com/en/dev/howto/custom-template-tags/#auto-escaping-considerations)[使用该`autoescape``Context`](http://docs.djangoproject.com/en/dev/howto/custom-template-tags/#auto-escaping-considerations)参数：

```
c = Context({
   'foo': 'bar',
   'url': 'http://127.0.0.1/test?a=1&b=2',
}, autoescape=False) 
```

文档的[如何关闭 [Automatic HTML escaping]](http://docs.djangoproject.com/en/dev/topics/templates/#how-to-turn-it-off)部分涵盖了一些模板内选项，如果您愿意的话。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-26T02:59:43.630

或者只使用模板中的“安全”过滤器。

另外，我怎么强调熟悉 Django 文档的重要性都不为过。许多像这样的常见问题都有容易找到的答案和解释（[比如这个](http://docs.djangoproject.com/en/dev/topics/templates/#id2)），通读文档并了解一切是如何工作的，将大大减少你需要花费的时间问“为什么这样做那”并增加您花费在构建以您想要的方式工作的东西的时间。

# asp.net-mvc - ASP.NET MVC 帐户控制器使用指南？

> ID：237249
> 
> 赞同：10
> 
> 时间：2008-10-26T00:17:41.710
> 
> 标签：asp.net-mvc

我正在查看 MVC 帐户控制器，它似乎来自 ASP.NET 网络表单。有没有关于如何使用它的好的背景信息？

您可以将其映射到用户数据库表还是滚动您自己的用户管理更好？

你如何在 MVC 中使用它来限制登录用户可以查看的页面？你必须自己滚动所有这些吗？

Web 上的哪些资源可以帮助理解 ASP.NET 成员资格？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-26T01:28:56.107

> 我正在查看 MVC 帐户控制器....它似乎来自 asp.net？

[Scott Guthrie 在他关于ASP.NET MVC Preview 4](http://weblogs.asp.net/scottgu/archive/2008/07/14/asp-net-mvc-preview-4-release-part-1.aspx)的博客文章中很好地解释了这一点。他基本上说 MVC 示例中的帐户控制器使用 ASP.NET 成员资格提供程序，因此您可以使用其中任何一个。（我认为您可以在 Internet 上找到有关 ASP.NET 成员资格提供程序的更多信息。）如果您不想实现/使用其中之一，那么修改应用程序以使用您自己的用户管理可能是最好的选择。

> 你如何在 MVC 中使用它来限制登录用户可以查看的页面？你必须自己滚动所有这些吗？

您可以将`Authorize`属性添加到控制器类或操作方法。（与上述相同的[来源](http://weblogs.asp.net/scottgu/archive/2008/07/14/asp-net-mvc-preview-4-release-part-1.aspx)。）

```
// Only logged in users can access this controller.
[Authorize]
public class SomeController : Controller
{
    #region Not really important for this example. :]
    // Maybe rather use a BLL service here instead of the repository from the DAL, but this example is already more verbose than required.
    private IStuffRepository stuffRepository;

    public SomeController(IStuffRepository stuffRepository)
    {
        if (null == stuffRepository)
        {
            throw new ArgumentNullException("stuffRepository");
        }

        this.stuffRepository = stuffRepository;
    }
    #endregion

    // The authorize attribute is inherited - only logged in users can use the index action.
    public ActionResult Index()
    {
        return View();
    }

    // Moderators can flag stuff.
    [Authorize(Roles="Moderator")]
    public ActionResult Flag(int id)
    {
        this.stuffRepository.Flag(id);
        return RedirectToAction("Index");
    }

    // Admins ans SysOps can delete stuff.
    [Authorize(Roles="Admin,SysOp")]
    public ActionResult Delete(int id)
    {
        this.stuffRepository.Delete(id);
        return RedirectToAction("Index");
    }

    // Only joed can change the objects stuff. ;)
    // (This is probably bullshit, of course, but I could not make any better example. I blame the fact it is late at night. :))
    [Authorize(Users="COMPANY\\joed")]
    public ActionResult ChangeId(int oldId, int newId)
    {
        this.stuffRepository.ChangeId(oldId, newId);
        return RedirectToAction("Index");
    }
} 
```

# javascript - 在 jQuery 中如何处理 oncut、oncopy 和 onpaste？

> ID：237254
> 
> 赞同：65
> 
> 时间：2008-10-26T00:21:09.457
> 
> 标签：javascript, jquery, event-handling, webkit

[jQuery 文档](http://docs.jquery.com/Events/bind#typedatafn)说该库内置支持以下事件：blur、focus、load、resize、scroll、unload、click、dblclick、mousedown、mouseup、mousemove、mouseover、mouseout、mouseenter、mouseleave、change、select、提交、keydown、keypress、keyup 和错误。

我需要处理剪切、复制和粘贴事件。如何最好地做到这一点？FWIW，我只需要担心 WebKit（我很幸运！）。

更新：我正在类似仪表板的环境中开发“小部件”。它使用 WebKit，因此（就我的目的而言）是否支持这些事件真的很重要，看起来确实如此。

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2008-10-27T00:11:37.853

[`.on()`](http://api.jquery.com/on/)您可以使用和[`off()`](http://api.jquery.com/off)方法添加和删除任何类型的事件

试试这个，例如

```
jQuery(document).on('paste', function(e){ alert('pasting!') }); 
```

jQuery 实际上对于你分配的事件类型是否被浏览器支持是相当无所谓的，所以你可以为元素（和通用对象）分配任意事件类型，例如：

```
jQuery('p').on('foobar2000', function(e){ alert(e.type); }); 
```

如果是自定义事件类型，您必须[`.trigger()`](http://api.jquery.com/trigger)在代码中“手动”使用它们，如下所示：

```
jQuery('p').trigger('foobar2000'); 
```

整齐吧？

此外，要以跨浏览器兼容的方式处理专有/自定义 DOM 事件，您可能需要使用/编写“jQuery 事件插件”...~~[jquery.event.wheel.js](http://plugins.jquery.com/files/jquery.event.wheel.js.txt)~~Brandon Aaron 的[鼠标滚轮插件](https://github.com/brandonaaron/jquery-mousewheel)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-10-26T01:06:52.953

Javascript 中提供了各种剪贴板事件，但支持参差不齐。QuicksMode.org 有一个[兼容性网格](http://www.quirksmode.org/dom/events/cutcopypaste.html)和[测试页面](http://www.quirksmode.org/dom/events/tests/cutcopypaste.html)。这些事件不通过 jQuery 公开，因此您必须扩展库或使用本机 Javascript 事件。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-27T19:37:49.980

Mozilla 支持“输入”事件，我无法找到有用的文档。至少，我知道它会在粘贴时触发。

```
 this.addEventListener('input',
    function(){//stuff here},
    false
   ); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-09-02T16:07:19.107

作为 jQuery 1.7，您可以使用**bind(...)**和**unbind(...)**方法分别附加和删除处理程序。

以下是对齐您的问题的示例：

```
$('#someElementId').bind('paste', function(){return false;}); 
```

- 这将阻止任何从剪贴板粘贴到元素主体的尝试。您还可以使用**cut**、**copy**和其他作为事件类型（请参阅下面的链接）

```
$('#someElementId').bind('copy', function(){return alert('Hey fella! Do not forget about copyrights!');}); 
```

因此，在其他情况下，当您想要删除这些处理程序时，您可以使用**unbind()**方法：

```
$('#someElementId').unbind('copy'); 
```

这里有一些有用的链接：

*   [绑定（）](http://api.jquery.com/bind/)
*   [解绑（）](http://api.jquery.com/unbind/)
*   [事件类型的完整列表](http://api.jquery.com/category/events/)

# internet-explorer - 如何在 VB6 中使 Internet Explorer 不可见地打开？

> ID：237268
> 
> 赞同：3
> 
> 时间：2008-10-26T00:30:32.883
> 
> 标签：internet-explorer, vb6

这样做：

`Shell ("C:\Program Files\Internet Explorer\iexplore.exe -embedding http://www.websiteurl.com")`

不能按我的需要工作，因为我本质上需要它才能重定向并提示用户下载文件。有任何想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-27T10:17:20.093

Internet Explorer 公开了一个您可以使用的 COM 可访问接口。如果你真的必须。我建议不要使用它——它相对较慢、容易出错、繁琐且资源密集。

更优雅地解决您的问题的是使用`WinHTTPRequest`. 在您的项目中，引用“Microsoft WinHTTP Services，版本 5.1”，然后像这样继续：

```
Dim HttpRequest As New WinHttp.WinHttpRequest
Dim TargetUrl As String
Dim TargetFile As String
Dim FileNum As Integer

TargetFile = "C:\foo.doc"

TargetUrl = "http://www.websiteurl.com"
HttpRequest.Open Method:="GET", Url:=TargetUrl, Async:=False
HttpRequest.Send

If HttpRequest.Status = 302 Then

  TargetUrl = HttpRequest.GetResponseHeader("Location")
  HttpRequest.Open Method:="GET", Url:=TargetUrl, Async:=False
  HttpRequest.Send

  If HttpRequest.Status = "200" Then

    FileNum = FreeFile
    Open TargetFile For Binary As #FileNum
    Put #FileNum, 1, HttpRequest.ResponseBody
    Close FileNum 

    Debug.Print "Successfully witten " & TargetFile
  Else
    Debug.Print "Download failed. Received HTTP status: " & HttpRequest.Status
  End If
Else
  Debug.Print "Expected Redirect. Received HTTP status: " & HttpRequest.Status
End If 
```

硬编码`"C:\foo.doc"`当然没有多大意义。我会使用服务器在响应标头中提供的文件名（`"Content-Type"`或`"Content-Disposition"`，取决于您的期望）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T00:37:08.003

你可以做几件事。

*   使用外部程序`wget`来获取文件而不是 IE。您可以使用 cygnus 工具在[http://www.cygwin.com](http://www.cygwin.com)免费获得 wget 。它是 GPL，所以请注意您是否有商业产品。

*   编写一个小的 .NET 程序，它使用 HttpWebRequest 类来获取文件并将外壳发送到该程序而不是 IE。我不认为你会对 IE 本身有很大的运气。用史蒂夫·乔布斯的话说，这听起来像是“一袋受伤”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-26T00:38:38.047

如果您只想下载文件，则可以使用[URLDownloadToFile](http://vbnet.mvps.org/index.html?code/internet/urldownloadtofile.htm)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-28T18:15:50.503

[除了 Glomek 建议的URLDownloadToFile](http://vbnet.mvps.org/index.html?code/internet/urldownloadtofile.htm) API 调用之外的另一个选择是使用VB6 中内置的[AsyncRead方法。](http://visualstudiomagazine.com/columns/article.aspx?editorialsid=2560)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-26T12:34:49.130

Internet Explorer 界面通过 WebBrowser 控件（包含在 %systemroot%\system32\shlwapi.dll 中）暴露给 ActiveX。虽然它可能不是很优雅，但您可以轻松地将控件放置在表单可见区域之外的某个位置。

该控件使用起来非常简单。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-27T08:51:48.270

您最好的选择是使用一些 .NET http 对象创建单独的下载应用程序以下载文件。我会推荐 WebClient。

如果你真的要坚持使用 VB6，我相信你可以使用一些基本的套接字工作来直接下载文件。

# ant - 使用 ant 构建项目时，您都运行的自定义目标是什么？

> ID：237269
> 
> 赞同：2
> 
> 时间：2008-10-26T00:34:05.403
> 
> 标签：ant, build-process, cvs, report

我正在考虑运行此自定义目标以了解有关我的项目构建状态的更多信息 - jalopy - jdepend - cvs tagdiff 报告 - NoUnit 的自定义任务 - 生成 UML 图。ESS模型

你有什么看法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-27T17:18:53.457

I think that it's a great idea and use it myself. That way I'll never forget to run it.

I also keep the reports for a decent amount of time and eventually create a spreadsheet of "progress".

In your main ant task - call another task to do "whatever"

and JDepend.xml ...

```
<target name="statsAll">
    <!-- master file that describes where everything is -->
    <property file="./ant/ant-global.properties" prefix="ant-global" />
    <tstamp>
          <format property="gen.time" pattern="yyyyMMdd_hh"/>
    </tstamp>
    <echo message="LOG:./ant/logs/jdepend.${version.FILETAG}.${gen.time}.rpt"/>
    <!-- generate stats to see if we're improving -->
    <jdepend 
        outputfile="./ant/logs/jdepend.${version.FILETAG}.${gen.time}.rpt" >
  <exclude name="java.*"/>
  <exclude name="javax.*"/>
    <classespath>
    <pathelement location="./jar" />
      </classespath>
      <classpath location="./jar" />
    </jdepend>
</target>

<target name="doJDepend" depends="getVersion,statsAll">
    <echo message="FTP'ing report"/>
    <ftp verbose="yes" passive="yes" depends="yes"
        remotedir="/videojet/metrics" server="xxxxx"
        userid="xxxx" password="xxxxx"
        binary="no"
        systemTypeKey="UNIX">
        <fileset dir="./ant/logs/" casesensitive="no">
          <include name="**/jdepend.${version.FILETAG}*.rpt"/>
          <exclude name="**/*.txt"/>
        </fileset>
    </ftp>
</target> 
```

[Magic build machine](http://www.codinghorror.com/blog/archives/000149.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T18:23:14.670

I second the 'good idea' part, although for a project of reasonable size you might want to make it part of an automated build, like one of the CI Servers (Bamboo, Contiuum).

You might also consider a code coverage tool to see how your test coverage is going.

This will ensure the reports get run on a regular basis, could give you somewhere to publish them and won't slow down the developer's quick turnaround development cycle.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T22:03:42.383

我也认为一些关于你的项目的报告是个好主意。我的 ant-build-script ( [Antiplate](http://antiplate.origo.ethz.ch/) ) 模板项目目前有以下报告：Junitreport、emma-report、PMD、CPD 和 Checkstyle。我正在考虑包括一个 JDepend 报告。

在工作中，我们使用这些模板并将 Hudson 用作连续集成系统。Hudson 为这些报告创建了精美的图表，以及度量如何随着构建而变化。

# c# - 如何在 C# 中找到对象的所有公共字段？

> ID：237275
> 
> 赞同：20
> 
> 时间：2008-10-26T00:39:15.317
> 
> 标签：c#, object, field, public

我正在构建一个方法来获取一个 ArrayList（可能是满的对象），然后列出 ArrayList 中每个对象的所有字段（及其值）。

目前我的代码如下：

```
public static void ListArrayListMembers(ArrayList list)
    {
        foreach (Object obj in list)
        {
            Type type = obj.GetType();
            string field = type.GetFields().ToString();
            Console.WriteLine(field);

        }
    } 
```

当然，我理解这段代码的直接问题：如果它有效，它只会在 ArrayList 中为每个对象打印一个字段。我稍后会解决这个问题 - 现在我只是好奇如何获取与对象关联的所有公共字段。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-10-26T00:42:03.983

```
foreach (Object obj in list) {
    Type type = obj.GetType();

    foreach (var f in type.GetFields().Where(f => f.IsPublic)) {
        Console.WriteLine(
            String.Format("Name: {0} Value: {1}", f.Name, f.GetValue(obj));
    }                           
} 
```

请注意，此代码需要 .NET 3.5 才能工作；-)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-26T01:09:15.723

您可以使用 BindingFlags 获取直接在类中声明的所有对象字段：

```
GetFields(BindingFlags.Public | BindingFlags.Instance | BindingFlags.DeclaredOnly) 
```

和所有对象字段，包括继承：

```
GetFields(BindingFlags.Public | BindingFlags.Instance) 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-26T00:54:50.153

```
public static void ListArrayListMembers(ArrayList list)
{
    foreach (Object obj in list)
    {
        Type type = obj.GetType();
        Console.WriteLine("{0} -- ", type.Name);
        Console.WriteLine(" Properties: ");
        foreach (PropertyInfo prop in type.GetProperties())
        {
            Console.WriteLine("\t{0} {1} = {2}", prop.PropertyType.Name, 
                prop.Name, prop.GetValue(obj, null));
        }
        Console.WriteLine(" Fields: ");
        foreach (FieldInfo field in type.GetFields())
        {
            Console.WriteLine("\t{0} {1} = {2}", field.FieldType.Name, 
                field.Name, field.GetValue(obj));
        }
    }
} 
```

我想提一下，不需要在字段中查找 IsPublic，因为 type.GetFields() 正如[MSDN](http://msdn.microsoft.com/en-us/library/ch9714z3.aspx)所定义的那样：

返回值 - 类型：System.Reflection.FieldInfo[]

FieldInfo 对象数组，表示为当前类型定义的所有**公共字段。**

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-26T10:09:02.810

当然，另一个问题是“你为什么有公共领域？” - 属性更可取。作为抽象，请注意反射不是唯一的选择：类型也可以在运行时即时公开其属性（例如无类型`DataTable`/如何`DataView`将列公开为属性）。

为了支持这一点（同时也支持简单对象），您将使用`TypeDescriptor`：

```
 foreach(PropertyDescriptor prop in TypeDescriptor.GetProperties(obj))
        {
            Console.WriteLine("{0}={1}", prop.Name, prop.GetValue(obj));
        } 
```

这也允许许多可扩展性选项 - 例如，大大[加快反射速度](http://www.codeproject.com/KB/cs/HyperPropertyDescriptor.aspx)（无需更改任何代码）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-26T00:56:53.753

```
 static void ListArrayListMembers(ArrayList list)
    {
        foreach (object obj in list)
        {
            Type type = obj.GetType();
            foreach (FieldInfo field in type.GetFields(BindingFlags.Public))
            {
                Console.WriteLine(field.Name + " = " + field.GetValue(obj).ToString());
            }
        }
    } 
```

# .net - Outlook 的邮件帐户设置存储在哪里以及如何阅读它们？

> ID：237277
> 
> 赞同：2
> 
> 时间：2008-10-26T00:40:30.260
> 
> 标签：.net, outlook

如果 Outlook 安装在 PC 上，我需要使用 .NET 读取邮件帐户设置，但不使用 Outlook 对象模型。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-26T12:32:25.143

此[线程](http://www.techspot.com/vb/all/windows/t-8927-Outlook-2003-Accounts-File.html)包括可能有用的 Outlook 注册表项的注释。

# algorithm - 节水小便池的最优算法设计是什么？

> ID：237282
> 
> 赞同：12
> 
> 时间：2008-10-26T00:45:55.367
> 
> 标签：algorithm

在工作中，我们有一个令人讨厌的公用小便池。没有冲洗手柄。相反，它有一个运动传感器，当你站在它前面时有时会触发，有时不会。当它触发时，一个水箱会充满，当它充满时用于冲洗小便池。

在我之前的多次旅行中，我一直在思考盒子使用什么算法来确定何时打开以及什么是最佳算法，在节约用水的同时仍然保持相对愉快的小便池体验。

一旦人们有机会分享他们的想法，我将分享我的答案。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-26T01:13:08.853

```
OnUserEnter()
{
   if (UsersDetected == 0)
   {
      FirstDetectionTime = Now();
   }
   UsersDetected++;
   CurrentlyInUse = true;
}

OnUserExit()
{
  CurrentlyInUse = false;
  if (UsersDetected >= MaxUsersBetweenFlushes || 
         Now() - FirstDetectionTime > StinkInterval)
  {
     Flush();
  }
}

OnTimer()
{
   if (!CurrentlyInUse && 
          UsersDetected > 0 && 
          Now() - FirstDetectionTime > StinkInterval)
   {
      Flush();
   }
}

Flush()
{
   FlushTheUrinal();
   UsersDetected = 0;
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-26T01:06:03.577

你怎么知道它真的不是一个将视频传送到地下室监视器的摄像机，当米尔顿看到你离开小便池时，他触发冲水？

/我戴上他的锡箔帽

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-04T16:54:43.980

最好的节水算法是没有把手和传感器损坏的小便池。

这似乎是我们小便池大部分时间的状态，所以我认为它必须被有意设计成这样，以节省宝贵的饮用水。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-26T00:50:04.047

我会在感觉上触发，但使用缓慢的填充，希望在它实际冲洗时，其他人已经有了斜线。这种方法可以最大限度地减少臭气滞留，偶尔会跳过冲洗周期。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-04T17:04:14.477

我们学校的“并行处理”（又名“多用户”）小便池每次总是在休息铃响之前触发完全冲水，当然在“休息结束”铃响后不久。非常简单有效。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-26T02:48:51.483

冒着听起来鲁德式的风险，我认为最好的解决方案是手柄。但这不是问题。我会假设机制非常简单。有人在它前面移动，开始计数。当计数完成时，小便池被“填满”。当人离开时，扣动扳机，传感器关闭任意时间（我认为它不需要或不需要任何关于冲洗/水箱加注行为的意识）。

这是我想太多了吗？

# c++ - 您在哪里找到有用的模板？

> ID：237285
> 
> 赞同：15
> 
> 时间：2008-10-26T00:49:33.517
> 
> 标签：c++, templates, metaprogramming, generic-programming

在我的工作场所，我们倾向于使用 **iostream**、**string**、**vector**、**map**和一两种奇数**算法**。实际上，我们还没有发现很多情况下模板技术是解决问题的最佳方案。

我在这里寻找的是想法和可选的示例代码，这些代码展示了您如何使用模板技术为您在现实生活中遇到的问题创建新的解决方案。

作为贿赂，期待您的回答获得赞成票。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-26T00:56:05.487

**模板的一般信息：**

当您需要使用相同的代码但对不同的数据类型进行操作时，模板很有用，其中类型在编译时是已知的。当你有任何类型的容器对象时。

一个非常常见的用法是用于几乎所有类型的数据结构。例如：单链表、双链表、树、尝试、哈希表...

另一个非常常见的用法是排序算法。

使用模板的主要优点之一是您可以删除代码重复。代码重复是编程时应该避免的最重要的事情之一。

您可以将函数 Max 实现为宏或模板，但模板实现将是类型安全的，因此更好。

**现在到很酷的东西：**

另请参阅[模板元编程](http://en.wikipedia.org/wiki/Template_metaprogramming)，这是一种在编译时而不是在运行时预先评估代码的方法。模板元编程只有不可变的变量，因此它的变量不能改变。因为这个模板元编程可以被看作是一种函数式编程。

查看来自 Wikipedia 的模板元编程示例。**它展示了如何在编译时**使用模板来执行代码。因此在运行时你有一个预先计算好的常数。

```
template <int N>
struct Factorial 
{
    enum { value = N * Factorial<N - 1>::value };
};

template <>
struct Factorial<0> 
{
    enum { value = 1 };
};

// Factorial<4>::value == 24
// Factorial<0>::value == 1
void foo()
{
    int x = Factorial<4>::value; // == 24
    int y = Factorial<0>::value; // == 1
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-26T01:33:23.070

我使用了很多模板代码，主要是在 Boost 和 STL 中，但我很少需要*编写*任何模板代码。

几年前，其中一个例外是在一个操作 Windows PE 格式 EXE 文件的程序中。该公司希望添加 64 位支持，但`ExeFile`我编写的用于处理文件的类仅适用于 32 位。操作 64 位版本所需的代码本质上是相同的，但它需要使用不同的地址类型（64 位而不是 32 位），这导致另外两个数据结构也不同。

基于 STL 使用单个模板同时支持`std::string`和`std::wstring`，我决定尝试制作`ExeFile`一个模板，使用不同的数据结构和地址类型作为参数。有两个地方我仍然必须使用`#ifdef WIN64`线条（处理要求略有不同），但这并不难做到。我们现在在该程序中获得了完整的 32 位和 64 位支持，并且使用模板意味着我们所做的每一个修改都会自动应用于这两个版本。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-26T11:13:44.787

我确实使用模板来创建自己的代码的一个地方是实现如 Andrei Alexandrescu 在 Modern C++ Design 中所描述的策略类。目前我正在开发一个项目，其中包含一组与 BEA\h\h\h Oracle 的 Tuxedo TP 监视器交互的类。

Tuxedo 提供的一种工具是事务持久队列，因此我有一个与队列交互的类 TpQueue：

```
class TpQueue {
public:
   void enqueue(...)
   void dequeue(...)
   ...
} 
```

然而，由于队列是事务性的，我需要决定我想要什么事务行为；这可以在 TpQueue 类之外单独完成，但我认为如果每个 TpQueue 实例都有自己的事务策略，它会更加明确且不易出错。所以我有一组 TransactionPolicy 类，例如：

```
class OwnTransaction {
public:
   begin(...)  // Suspend any open transaction and start a new one
   commit(..)  // Commit my transaction and resume any suspended one
   abort(...)
}

class SharedTransaction {
public:
   begin(...)  // Join the currently active transaction or start a new one if there isn't one
   ...
} 
```

并且 TpQueue 类被重写为

```
template <typename TXNPOLICY = SharedTransaction>
class TpQueue : public TXNPOLICY {
   ...
} 
```

所以在 TpQueue 中，我可以根据需要调用 begin()、abort()、commit()，但可以根据我声明实例的方式更改行为：

```
TpQueue<SharedTransaction> queue1 ;
TpQueue<OwnTransaction> queue2 ; 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-26T12:39:55.657

我使用模板（在 Boost.Fusion 的帮助下）为我正在开发的超图库实现类型安全的整数。我有一个（超）边 ID 和一个顶点 ID，它们都是整数。使用模板，顶点和超边 ID 变成了不同的类型，并且在预期使用另一种时会产生编译时错误。为我省去了很多在运行时调试时会遇到的麻烦。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-26T13:04:51.287

这是一个真实项目的例子。我有这样的吸气剂功能：

```
bool getValue(wxString key, wxString& value);
bool getValue(wxString key, int& value);
bool getValue(wxString key, double& value);
bool getValue(wxString key, bool& value);
bool getValue(wxString key, StorageGranularity& value);
bool getValue(wxString key, std::vector<wxString>& value); 
```

然后是具有“默认”值的变体。如果存在则返回 key 的值，如果不存在则返回默认值。模板使我不必自己创建 6 个新函数。

```
template <typename T>
T get(wxString key, const T& defaultValue)
{
    T temp;
    if (getValue(key, temp))
        return temp;
    else
        return defaultValue;
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-26T01:48:02.120

我经常使用的模板是大量的容器类、boost 智能指针、[范围保护](http://www.ddj.com/cpp/184403758)、一些 STL 算法。

我编写模板的场景：

*   定制容器
*   内存管理，在 void * 分配器之上实现类型安全和 CTor/DTor 调用
*   不同类型的重载的通用实现，例如

    bool ContainsNan(float * , int) bool ContainsNan(double *, int)

两者都只是调用（本地，隐藏）辅助函数

```
template <typename T>
bool ContainsNanT<T>(T * values, int len) { ... actual code goes here } ; 
```

与类型无关的特定算法，只要类型具有某些属性，例如二进制序列化。

```
template <typename T>
void BinStream::Serialize(T & value) { ... }

// to make a type serializable, you need to implement
void SerializeElement(BinStream & strean, Foo & element);
void DeserializeElement(BinStream & stream, Foo & element) 
```

与虚函数不同，模板允许进行更多优化。

* * *

通常，模板允许为多种类型实现一个概念或算法，并且在编译时已经解决了差异。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-26T12:00:00.230

我们使用 COM 并接受一个指向对象的指针，该对象可以直接实现另一个接口，也可以通过 [ `IServiceProvider`]( [http://msdn.microsoft.com/en-us/library/cc678965(VS.85).aspx)](http://msdn.microsoft.com/en-us/library/cc678965(VS.85).aspx))这提示了我来创建这个类似演员的帮助函数。

```
// Get interface either via QueryInterface of via QueryService
template <class IFace>
CComPtr<IFace> GetIFace(IUnknown* unk)
{
    CComQIPtr<IFace> ret = unk; // Try QueryInterface
    if (ret == NULL) { // Fallback to QueryService
        if(CComQIPtr<IServiceProvider> ser = unk)
            ser->QueryService(__uuidof(IFace), __uuidof(IFace), (void**)&ret);
    }
    return ret;
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-26T02:22:11.193

我使用模板来指定函数对象类型。我经常编写将函数对象作为参数的代码——要集成的函数、要优化的函数等——我发现模板比继承更方便。所以我的代码接收一个函数对象——比如一个积分器或优化器——有一个模板参数来指定它操作的函数对象的种类。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-26T12:14:18.767

除了显而易见的原因（例如通过对不同数据类型进行操作来防止代码重复）之外，还有一种非常酷的模式，称为基于策略的设计。我问了一个关于[政策与战略](https://stackoverflow.com/questions/231318/a-strategy-against-policy-and-a-policy-against-strategy)的问题。

现在，这个功能有什么好看的。考虑您正在编写一个供其他人使用的界面。你知道你的接口会被使用，因为它是它自己域中的一个模块。但你还不知道人们将如何使用它。基于策略的设计增强了您的代码以供将来重用；它使您独立于特定实现所依赖的数据类型。代码只是“啜饮”。:-)

特质本身就是一个绝妙的主意。他们可以将特定的行为、数据和类型数据附加到模型中。特征允许对所有这三个字段进行完全参数化。最好的是，它是使代码可重用的一种非常好的方法。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-26T15:10:29.817

我曾经看过以下代码：

```
void doSomethingGeneric1(SomeClass * c, SomeClass & d)
{
   // three lines of code
   callFunctionGeneric1(c) ;
   // three lines of code
} 
```

重复十次：

```
void doSomethingGeneric2(SomeClass * c, SomeClass & d)
void doSomethingGeneric3(SomeClass * c, SomeClass & d)
void doSomethingGeneric4(SomeClass * c, SomeClass & d)
// Etc 
```

每个函数都有相同的 6 行代码复制/粘贴，并且每次调用另一个具有相同数字后缀的函数 callFunctionGenericX。

没有办法完全重构整个事情。所以我将重构保留在本地。

我以这种方式更改了代码（从内存中）：

```
template<typename T>
void doSomethingGenericAnything(SomeClass * c, SomeClass & d, T t)
{
   // three lines of code
   t(c) ;
   // three lines of code
} 
```

并修改了现有代码：

```
void doSomethingGeneric1(SomeClass * c, SomeClass & d)
{
   doSomethingGenericAnything(c, d, callFunctionGeneric1) ;
}

void doSomethingGeneric2(SomeClass * c, SomeClass & d)
{
   doSomethingGenericAnything(c, d, callFunctionGeneric2) ;
} 
```

等等。

这有点劫持模板的东西，但最后，我想它比使用类型定义的函数指针或使用宏要好。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-27T14:31:03.170

已经提到您可以使用模板作为策略类来*做某事*。我经常使用这个。

我还使用它们，在属性映射的帮助下（[有关此的更多信息，请参见 boost 站点](http://www.boost.org/doc/libs/1_36_0/libs/property_map/property_map.html)），以便以通用方式访问数据。这使您有机会更改存储数据的方式，而无需更改检索数据的方式。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-29T05:08:21.887

我个人使用过奇怪重复的模板模式作为执行某种形式的自上而下设计和自下而上实现的手段。一个示例是通用处理程序的规范，其中在编译时对派生类型强制执行对表单和接口的某些要求。它看起来像这样：

```
template <class Derived>
struct handler_base : Derived {
  void pre_call() {
    // do any universal pre_call handling here
    static_cast<Derived *>(this)->pre_call();
  };

  void post_call(typename Derived::result_type & result) {
    static_cast<Derived *>(this)->post_call(result);
    // do any universal post_call handling here
  };

  typename Derived::result_type
  operator() (typename Derived::arg_pack const & args) {
    pre_call();
    typename Derived::result_type temp = static_cast<Derived *>(this)->eval(args);
    post_call(temp);
    return temp;
  }; 
```

};

然后可以使用这样的东西来确保您的处理程序从该模板派生并强制执行自上而下的设计，然后允许自下而上的自定义：

```
struct my_handler : handler_base<my_handler> {
  typedef int result_type; // required to compile
  typedef tuple<int, int> arg_pack; // required to compile
  void pre_call(); // required to compile
  void post_call(int &); // required to compile
  int eval(arg_pack const &); // required to compile
}; 
```

然后，这允许您拥有仅处理 handler_base<> 派生类型的通用多态函数：

```
template <class T, class Arg0, class Arg1>
typename T::result_type
invoke(handler_base<T> & handler, Arg0 const & arg0, Arg1 const & arg1) {
  return handler(make_tuple(arg0, arg1));
}; 
```

# configuration - Vim 配置行号着色

> ID：237289
> 
> 赞同：106
> 
> 时间：2008-10-26T00:52:52.793
> 
> 标签：configuration, syntax-highlighting, vim

我正在寻找一种方法来配置 Vim 中用于行号的颜色（如`:set nu`：）。大多数平台上的默认值似乎是黄色的（也用于一些突出显示的标记）。我想将*行*号涂成暗灰色；附近的某处`#555`。不过我并不挑剔，任何柔和的颜色都可以接受。

* * *

## 回答 #1

> 赞同：162
> 
> 时间：2008-10-26T00:55:03.240

尝试：

```
help hl-LineNr 
```

我通过以下方式找到了这个：

```
help 'number' 
```

这是获取`'number'`选项帮助的方法，而不是`:number`命令。

要实际更改显示的颜色：

```
:highlight LineNr ctermfg=grey 
```

这会将字符终端上 LineNr 的前景色更改为灰色。如果你使用 gVim，你可以：

```
:highlight LineNr guifg=#050505 
```

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2015-08-20T20:53:58.177

要永久更改行号，请将以下内容添加到您的`.vimrc`

`highlight LineNr term=bold cterm=NONE ctermfg=DarkGrey ctermbg=NONE gui=NONE guifg=DarkGrey guibg=NONE`

当然，您可以将`ctermfg`and更改为`guifg`您想要的任何颜色。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2012-09-10T00:17:58.503

在 MacVim（以 Vim 7.3 为核心）中，我发现`CursorLineNr`可以工作：

`hi CursorLineNr guifg=#050505`

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2016-05-08T17:45:27.230

我不喜欢所选配色方案提供的颜色，所以我以这种方式修改了行号的颜色：

```
colorscheme trivial256    " for light background
hi LineNr       term=bold cterm=bold ctermfg=2 guifg=Grey guibg=Grey90 
```

# c# - 是否有任何带有 C# 代码完成插件的 emacs 或 vim 编辑器？

> ID：237291
> 
> 赞同：1
> 
> 时间：2008-10-26T00:54:25.690
> 
> 标签：c#, vim, emacs, editor

如果它同时提供可供选择的方法列表和潜在输入参数列表，那就太好了。这是为 powershell 完成的，我很好奇是否为 emacs 或 vim 实现了任何类似的功能？

澄清：

与我一起工作的一位开发人员希望在不运行 Visual Studio 的情况下使用 vim 或 emacs 来降低开销。本质上，他希望能够编写测试，在 emacs 或 vim 中编辑代码，然后只需运行 NANT 脚本来编译代码并运行测试。他想要的 Visual Studio 的唯一功能是代码完成。其余的他在 98-99% 的时间里都可以不用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T03:54:00.773

您可以为 Visual Studio 使用 vim 编辑器模拟器。

[http://www.viemu.com/](http://www.viemu.com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-04-06T19:55:31.390

[OmniSharp](https://github.com/nosami/Omnisharp)在 vi​​m 中为 C# 提供上下文智能感知。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-26T12:32:40.320

我还没有遇到过基于用户环境提供的 API 的“知识”提供代码完成建议的 emacs 模式。对于很多人来说，这是一个阻止他们在使用丰富/大型/笨拙（根据需要删除）API 时尝试使用 Emacs 或 VIM 的问题。

但是我想知道这在日常工作中会出现多少问题。我一直在使用带有[C# 模式](http://www.emacswiki.org/emacs-en/CSharpMode)的 Emacs来编写大量 C# 代码。我也倾向于运行 dabbrev-mode 或 pabbrev-mode，它倾向于处理我倾向于使用的更常见的函数和变量名。让我永远感到羞耻的是，我不得不承认我倾向于在 MSDN 网站上打开一个浏览器来查找其余部分——那些我不经常使用的 API，以至于我记不住。您的同事可能想要研究的另一个潜在帮手是[冰柱](http://www.emacswiki.org/cgi-bin/wiki/Icicles)，这也可能是朝着正确方向迈出的一步。然而，这些库都不会提供像 Visual Studio IDE 那样的完整支持。在使用更高效的编辑器时，我会将此视为权衡的一部分。

顺便说一句，如果您的同事在一个团队中工作，并且从事同一项目的其他成员正在使用 Visual Studio，则 MSBuild 可能会提供比 Nant 更好的在 VS 之外构建的解决方案，因为 MSBuild 读取 VS 使用的相同解决方案和项目文件（事实上​​ VS2008 中的很多构建工作都是由 MSBuild 处理的）。语法与 Nant 相距不远，并且添加了社区任务（这为您提供了 NUnit 集成等），它将确保每个人都使用非常相似的机制来构建可执行文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-11-19T09:34:24.247

对于 emacs 和 C#，您可以查看此工具：[http ://code.google.com/p/idebridge/](http://code.google.com/p/idebridge/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-27T05:58:40.070

我在 C# 中看到的最远的完成是在[这个博客上](http://blogs.msdn.com/dotnetinterop/archive/tags/emacs/default.aspx)，特别是在[这篇文章](http://blogs.msdn.com/dotnetinterop/archive/2008/04/22/c-code-completion-in-emacs-csde-now-has-a-csdeshell.aspx)中。（包括上下文和其他 Emacs 帖子的博客链接。）

如果你能忍受哑巴补全，你也许可以用标签和标签补全来滚动你自己的。

[关于同一问题的先前堆栈。](https://stackoverflow.com/questions/8607/any-good-way-to-use-emacs-for-c-development)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-03T19:37:42.247

您的源代码应通过 CEDET 框架处理：[http ://cedet.sourceforge.net/](http://cedet.sourceforge.net/)

然后使用与 cedet 捆绑的示例 UI，或者尝试以下两种中的任何一种： - company-mode：[http](http://nschum.de/src/emacs/company-mode) ://nschum.de/src/emacs/company-mode -completion -ui：[http://www.dr- qubit.org/emacs.php](http://www.dr-qubit.org/emacs.php)

两者都支持 CEDET 作为完成搜索后端。

阿帕！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-26T01:36:25.187

中的一些建议[C、C++ 和 JAVA 的 Emacs 中的 Eclipse 样式函数完成？](https://stackoverflow.com/questions/129257/eclipse-sytle-function-completions-in-emacs-for-c-c-and-java)可能与emacs有关。

不是 c# 特定的，但仍然如此。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-26T17:44:11.987

我发现[http://code.google.com/p/csense](http://code.google.com/p/csense)这是一个 emacs c# intellisense/code sense。我从这篇博客文章[http://osdir.com/ml/emacs.sources/2007-11/msg00018.html](http://osdir.com/ml/emacs.sources/2007-11/msg00018.html)中找到了它，这可能与我正在寻找的答案很接近。

进一步查看后，它自 2007 年 11 月以来一直没有更新，对我来说似乎已经过时了。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-08-03T08:20:32.800

对于 Vim，您可以安装[insenvim](http://insenvim.sourceforge.net/)。它支持 C# 代码完成。下载插件后，您可以安装安装文件或通过以下步骤手动安装：

1.  将文件 cs_vis.vim 复制到 $VIM\vimfiles\ftplugin 目录中。
2.  将文件 csft.dll 复制到 $VIM_INTELLISENSE 目录中。
3.  将 CSVimHelper.dll,reg.bat 复制到您的 $VIM_INTELLISENSE 目录。
4.  运行 reg.bat 来注册 dll。您需要在路径中设置目录 gacutil.exe。您需要最新版本的 .NET SDK。

# .net - .NET 微框架 SDK 与 VS 2008

> ID：237299
> 
> 赞同：2
> 
> 时间：2008-10-26T01:02:43.037
> 
> 标签：.net, visual-studio-2008, embedded, .net-micro-framework

我正在尝试使用 .NET Micro Framework 开始开发，但似乎遇到了障碍。我使用的是 Visual Studio 2008，它不会让我安装 SDK，因为我没有 Visual Studio 2005。我从[这个](http://www.microsoft.com/downloads/details.aspx?FamilyId=EB0EF2A6-03E2-402C-89A4-A636BD0080C5&displaylang=en)链接下载了 SDK。

我知道这不是一个真正的编程问题，但它肯定会阻碍我入门。感谢您的帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-26T03:40:04.810

您需要 .NET Microframework 3.0 Beta 才能在 Visual Studio 2008 中工作（据我所知）：

[http://connect.microsoft.com/netmf/](http://connect.microsoft.com/netmf/)

# sql - 如何使用 SQL 计算唯一记录并获取表中这些唯一记录的数量？

> ID：237302
> 
> 赞同：15
> 
> 时间：2008-10-26T01:06:17.820
> 
> 标签：sql, count, unique, numbers, records

想象一下我有这样的表：

**id:产品:shop_id**

1：篮球：41

2：足球：41

3：火箭：45

4：汽车：86

5：平面：86

现在，这是一个大型互联网商城的例子，其中有商店向一个客户销售，因此客户可以从每个商店中选择更多产品并在一个篮子中购买。

但是，我不确定是否有任何 SQL 语法可以让我简单地获取唯一的 shop_ids 和客户购物篮中这些商店产品的总数。所以我会得到类似的东西：

41 号店有 2 件商品

购买 45 件商品

店铺 86 两款产品

我可以进行 SQL 查询以通过表舀出某种 ['shop_id']['number_of_products'] 数组变量来存储所有产品的 shop_id，然后“使它们唯一” - 向上计算我必须削减多少次还有一个 shop_id 有一些剩余，但这似乎是很多无用的脚本。

如果你有什么好主意，请告诉我。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-10-26T01:08:05.210

这正是聚合函数的用途。您为表中的每组行制作一行输出。按 shop_id 对它们进行分组并计算每组中有多少行。

```
select shop_id, count(1) from TABLE_NAME
  group by shop_id 
```

# javascript - 原型与类

> ID：237307
> 
> 赞同：10
> 
> 时间：2008-10-26T01:08:54.273
> 
> 标签：javascript, oop, prototype

Steve Yegge 最近发表了一篇关于他所谓的通用设计模式的[有趣博客文章。](http://steve-yegge.blogspot.com/2008/10/universal-design-pattern.html)在那里，他详细介绍了使用原型作为建模工具，而不是类。与继承相比，我喜欢这种引入更少耦合的方式。但这也是通过类实现类而不是继承来实现的类的东西。有没有其他人有使用原型的成功案例，并且可以帮助解释与类相比，使用原型在哪些方面具有优势。我想它归结为静态建模与动态建模，但更多示例将非常受欢迎。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-26T02:50:32.463

一个有趣的地方是，使基于原型的语言成为面向对象的语言很容易，但很难让一种面向对象的语言基于原型的行为。

*   Alex Arnell 的[inheritance.js](http://code.google.com/p/inheritance/)是一段简短而甜蜜的代码，它使JavaScript 成为面向对象的行为，并具有对父“类”的访问权限。
*   这是 John Resig 针对同一问题的解决方案之一：http: [//ejohn.org/blog/simple-javascript-inheritance/](http://ejohn.org/blog/simple-javascript-inheritance/)。
*   [Programming in Lua 的第 16 章](http://www.lua.org/pil/16.html)描述了 Lua 中的面向对象。具体来说，[第 16.2 节](http://www.lua.org/pil/16.2.html)给出了一个很好的继承示例。

除了您提到的组合与继承之外，作为原型的 OO 会是什么样子并不完全清楚。

原型语言使复杂的继承行为变得容易。您可以实现[多重继承](http://www.lua.org/pil/16.3.html)、[类似 mixin](http://en.wikipedia.org/wiki/Mixin)的行为，或者只是从一个对象中挑选您想要添加到另一个对象的内容。

[维基百科的文章](http://en.wikipedia.org/wiki/Prototype-based_programming)提到：“基于原型编程的倡导者经常争辩说，基于类的语言鼓励一种首先关注分类和类之间关系的开发模型。相比之下，基于原型的编程被视为鼓励程序员专注于一些示例的行为，然后才担心将这些对象分类为原型对象，这些原型对象后来以类似于类的方式使用。”

这并不是说原型范式各有利弊。如果 OO 更具限制性，那是因为它选择这样做。如果您不小心，我可以看到所有这些灵活性可能会给您带来麻烦。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-26T01:17:46.987

原型是继承的一种形式，只是对象直接从其他对象继承属性和行为，而不是从继承自其他类的类中获取属性和行为。

例如，查看[基于原型的语言](http://en.wikipedia.org/wiki/Prototype-based_programming)（例如 JavaScript）中的任何面向对象的代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-20T03:52:43.050

对于那些感兴趣的人来说，[NewtonScript](http://en.wikipedia.org/wiki/Newtonscript)是（是）一种双重语言：你有原型，你有类。您可以选择是继承自一个类、继承自原型还是继承自两者。

# java - Java：VM 如何在 32 位处理器上处理 64 位“long”

> ID：237309
> 
> 赞同：10
> 
> 时间：2008-10-26T01:09:17.317
> 
> 标签：java, 64-bit, jvm, 32-bit

### JVM 如何在 32 位处理器上处理 64 位的原始“long”？

在多核 32 位机器上可以并行使用多核吗？
32 位机器上的 64 位操作要慢多少？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-26T01:13:31.300

它可以使用多个内核来运行不同的线程，但它不会将它们并行用于 64 位计算。一个 64 位的长度基本上存储为两个 32 位的整数。为了添加它们，需要两个加法，跟踪进位位。乘法有点像将两个两位数相乘，除了每个数字的基数为 2^32 而不是基数 10。其他算术运算依此类推。

关于速度的编辑：我只能猜测速度差异。加法需要两次加法而不是一次，而乘法（我认为）需要四次乘法而不是一次。但是，我怀疑如果所有内容都可以保存在寄存器中，那么计算的实际时间将与两次读取和两次写入内存所需的时间相形见绌，所以我的猜测是大多数人的两倍操作。我想这将取决于处理器、特定的 JVM 实现、月相等。除非您进行大量的数字运算，否则我不会担心。大多数程序大部分时间都在等待与磁盘或网络之间的 IO。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-26T01:25:43.880

来自[TalkingTree](http://www.talkingtree.com/blog/index.cfm/2007/8/29/CF8-Performance-64-bit)和[Java HotSpot FAQ](http://java.sun.com/docs/hotspot/HotSpotFAQ.html#64bit_performance)：

> 通常，与在 32 位 VM 上运行相同的应用程序相比，能够处理大量内存的好处是 64 位 VM 的性能损失很小。这是因为系统中的每个本机指针占用 8 个字节而不是 4 个字节。这些额外数据的加载会影响内存使用，这取决于在执行期间加载了多少指针，这会导致执行速度稍慢你的 Java 程序。
> 好消息是，在 AMD64 和 EM64T 平台以 64 位模式运行时，Java VM 获得了一些额外的寄存器，可用于生成更高效的本机指令序列。这些额外的寄存器将性能提高到在比较 32 位和 64 位执行速度时通常根本没有性能损失的程度。
> 
> **将在 64 位平台上运行的应用程序与在 SPARC 上运行的 32 位平台进行比较，当您迁移到 64 位 VM 时，性能差异大约会下降 10-20%**。在 AMD64 和 EM64T 平台上，此差异范围为 0-15%，具体取决于访问应用程序执行的指针数量。

# iphone - 如何更改模态 UIViewController 的动画样式？

> ID：237310
> 
> 赞同：69
> 
> 时间：2008-10-26T01:09:31.980
> 
> 标签：iphone, cocoa-touch

我目前正在显示这样的 UIViewController：

```
[[self navigationController] presentModalViewController:modalViewController animated:YES]; 
```

并像这样隐藏它：

```
[self.navigationController dismissModalViewControllerAnimated:YES]; 
```

动画是“从底部向上滑动”......然后向下滑动。如何更改动画样式？我可以让它淡入/淡出吗？

干杯!

* * *

## 回答 #1

> 赞同：194
> 
> 时间：2010-01-05T14:43:52.050

对于 iPhone 3.0+，基本的淡入淡出是最容易做到的：

```
modalViewController.modalTransitionStyle = UIModalTransitionStyleCrossDissolve;
[[self navigationController] presentModalViewController:modalViewController
                                               animated:YES]; 
```

* * *

## 回答 #2

> 赞同：60
> 
> 时间：2008-10-26T01:46:43.357

Marcus Zarra 在 SDK 邮件列表上发布了一个很好的解决方案：

```
UIViewController *controller = [[[MyViewController alloc] init] autorelease];
UIViewAnimationTransition trans = UIViewAnimationTransitionCurlUp;
[UIView beginAnimations: nil context: nil];
[UIView setAnimationTransition: trans forView: [self window] cache: YES];
[navController presentModalViewController: controller animated: NO];
[UIView commitAnimations]; 
```

有翻转和卷页的过渡。如果您设置为淡入淡出，可以尝试调整新视图的 alpha：

```
UIViewController *controller = [[[MyViewController alloc] init] autorelease];
controller.view.alpha = 0.0;
[navController presentModalViewController: controller animated: NO];
[UIView beginAnimations: nil context: nil];
controller.view.alpha = 1.0;
[UIView commitAnimations]; 
```

但是，您可能想要的是交叉淡入淡出，或者至少是淡入淡出。当 UINavigationController 切换到新视图时，它会删除旧视图。对于这种效果，您最好向现有的 UIViewController 添加一个新视图并随着时间的推移淡化其 alpha。

注意：如果您不在您的应用程序中，委托 [self window] 将不起作用。使用 self.view.window ，感谢 user412500 的帖子指出了这一点。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2010-10-08T16:28:08.940

要在 iOS 4 中更新 alpha 淡入淡出：

```
modalController.view.alpha = 0.0;
[self.view.window.rootViewController presentModalViewController:modalController animated:NO];
[UIView animateWithDuration:0.5
                 animations:^{modalController.view.alpha = 1.0;}]; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-09-02T23:41:05.683

应该是`[self.view.window]`为了让代码工作

（至少在 ios 3.2 中是这样的）

# .net - .net/exchange：动态添加电子邮件地址？

> ID：237311
> 
> 赞同：0
> 
> 时间：2008-10-26T01:10:46.470
> 
> 标签：.net, asp.net, email, exchange-server

我正在构建一个 .NET 应用程序，我想在用户创建帐户时为他们动态添加电子邮件地址，以便他们可以将自己的东西通过电子邮件发送到他们的帐户并在应用程序中查看。

电子邮件地址类似于 [account_name]@[site.com]。

是否有一个很好的参考 URL 来解释如何做到这一点？我在 ASP.NET/Exchange 环境中，但我愿意阅读有关其他邮件服务器的文章。

显然这是一个很难回答的问题！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T03:34:15.057

这篇 Microsoft 知识库文章介绍了如何使用 DirectoryServices 创建新的 Exchange 用户和邮箱：

[http://support.microsoft.com/kb/313114](http://support.microsoft.com/kb/313114)

希望有帮助！

# jquery - 如何更改 JQuery UI 对话框的可调整大小句柄的背景颜色？

> ID：237322
> 
> 赞同：0
> 
> 时间：2008-10-26T01:18:10.933
> 
> 标签：jquery, css

你会认为这很容易，但请继续阅读。我可以更改与可调整大小的 JQuery 对话框相关的许多样式，但不能更改句柄。下面的代码隔离了问题。为什么手柄会完全消失？在 ui.resizable.js 中一定有一些我在干扰的逻辑，但我没有看到它。

```
<script type="text/javascript" language="JavaScript" src="jquery126.js"></script>
<script type="text/javascript" language="JavaScript" src="ui/ui.core.js"></script>
<script type="text/javascript" language="JavaScript" src="ui/ui.dialog.js"></script>
<script type="text/javascript" language="JavaScript" src="ui/ui.resizable.js"></script>
<script type="text/javascript" language="JavaScript" src="ui/ui.draggable.js"></script>

<script>
  $(document).ready(foo);
  function foo() {
    $("#dlg").dialog()
  }
</script>

<style type="text/css">
  .ui-resizable-n {
    background: green;
  }
</style>
<div id=dlg title="my title">this is<br>my text</div> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T12:26:13.627

我能够让它工作。我找不到与我的 css 冲突的代码行，但是当我添加与定位和大小相关的 css 时，一切正常。必须有一些逻辑说，“除非程序员提供了自己的，否则使用默认的 css”。所以，虽然我以为我在附加信息，但我在某种程度上交换了信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-26T02:17:45.057

我相信可调整大小边框的背景设置为图像，在 CSS 堆叠中位于背景之上。尝试设置：

```
.ui-resizable-n{
  background-image:none;
  background-color:green;
} 
```

# c# - 在 C# 中可以进行元编程吗？

> ID：237326
> 
> 赞同：39
> 
> 时间：2008-10-26T01:21:33.483
> 
> 标签：c#, metaprogramming

特别是，是否有可能**在编译时在 c# 中执行类似于此 c++ 代码的代码**？

```
template <int N>
struct Factorial 
{
    enum { value = N * Factorial<N - 1>::value };
};

template <>
struct Factorial<0> 
{
    enum { value = 1 };
};

// Factorial<4>::value == 24
// Factorial<0>::value == 1
void foo()
{
    int x = Factorial<4>::value; // == 24
    int y = Factorial<0>::value; // == 1
} 
```

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-10-26T06:14:14.080

不，C# 语言不直接支持这种复杂性的元编程。但是，就像[@littlegeek](https://stackoverflow.com/questions/237326/is-metaprogramming-possible-in-c#237644)所说，Visual Studio 中包含的[文本模板转换工具包](http://www.hanselman.com/blog/T4TextTemplateTransformationToolkitCodeGenerationBestKeptVisualStudioSecret.aspx)将允许您实现任何复杂性的代码生成。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2012-02-22T10:42:50.610

在 .NET 中可以进行元编程（参见编译器编译器、正则表达式、代码 DOM、反射等），但 C# 不能进行*模板*元编程，因为它没有那种语言特性。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-02-26T18:19:38.550

大多数人坚持尝试从他们最喜欢的语言内部进行元编程。如果语言不能很好地支持元编程，那就不行了。其他答案观察到 C# 没有。

解决此问题的一种方法是使用 [程序转换工具从语言](http://www.semdesigns.com/products/DMS/ProgramTransformation.html?Home=DMSToolkit)*外部*进行元编程。这样的工具可以解析源代码，并对其进行任意转换（这就是元编程所做的），然后吐出修改后的程序。

如果您有一个可以解析任意语言的通用程序转换系统，那么您可以使用/使用您喜欢的任何语言进行元编程。请参阅我们的[DMS Software Reengineering Toolkit](http://www.semanticdesigns.com/Products/DMS/DMSToolkit.html)了解此类工具，该工具具有适用于 C、C++、Java、C#、COBOL、PHP 和许多其他编程语言的强大前端，并已用于所有这些语言的元编程。

DMS 之所以成功，是因为它提供了一种常规方法和支持基础设施，可以完全访问作为 AST 的程序结构，并且在大多数情况下，附加数据，如符号表、类型信息、控制和数据流分析，都是执行复杂程序操作所必需的。

编辑（回应评论）：可以应用 DMS 在 C# 上实现 OP 的任务。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-11T14:42:18.147

在处理 Java 或 .Net 语言时谈论编译时必须小心。在这些语言中，由于“编译时间”（JIT）可以在“运行时间”之后推迟，因此您可以执行比 C++ 更强大的元编程（广义上的反射）；）

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-10-26T01:25:43.443

不，元编程在 C# 中是不可能的。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-26T14:39:14.340

.NET 泛型和 C++ 模板之间的本质区别在于泛型在运行时是专用的。模板在编译时展开。泛型的动态行为使诸如 Linq、表达式树、Type.MakeGenericType()、语言独立性和代码重用之类的东西成为可能。

但是这是有代价的，例如，您不能对泛型类型参数的值使用运算符。您不能在 C# 中编写 std::complex 类。并且没有编译时元编程。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-26T03:54:19.417

在**非常**有限的程度上，C# 可以解释为元编程。但实际上它只不过是重载决议。将其称为元编程是一个真正的延伸。

例子：

```
static string SomeFunc<T>(T value) {
    return "Generic";
}
static string SomeFunc(int value) {
    return "Non-Generic";
}

static void Example() {
    SomeFunc(42);           // Non-Generic
    SomeFunc((object)42);   // Generic
} 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-01-03T16:33:32.947

这将是可能的。观看 Anders Hejlsberg 的 [The Future of C#](http://channel9.msdn.com/pdc2008/TL16/)演讲。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-11-12T09:00:41.223

不是按照您要求的方式，但是您可以使用一些旧的 C++ 技巧来生成静态指定特征的类：

```
abstract class Integer
{
    public abstract int Get { get; }
}

public class One : Integer { public override int Get { return 1; } } }
public class Two : Integer { public override int Get { return 2; } } }
public class Three : Integer { public override int Get { return 3; } } }

public class FixedStorage<T, N> where N : Integer, new()
{
    T[] storage;
    public FixedStorage()
    {
        storage = new T[new N().Get];
    }
    public T Get(int i)
    {
        return storage[i];
    }
} 
```

使用它，您可以定义空间类：

```
public class Vector3 : FixedStorage<float, Three> {}
public class Vector2 : FixedStorage<float, Two> {}
public class GridCell : FixedStorage<int, Two> {} 
```

我在一个有很多子类的库中使用这种技术，其中添加一个新的数据成员需要很多样板文件。

# sql - Oracle：如何 UPSERT（更新或插入表？）

> ID：237327
> 
> 赞同：318
> 
> 时间：2008-10-26T01:24:06.677
> 
> 标签：sql, oracle, merge, upsert

UPSERT 操作更新或插入表中的行，具体取决于表是否已有与数据匹配的行：

```
if table t has a row exists that has key X:
    update t set mystuff... where mykey=X
else
    insert into t mystuff... 
```

由于 Oracle 没有特定的 UPSERT 语句，那么最好的方法是什么？

* * *

## 回答 #1

> 赞同：222
> 
> 时间：2008-10-26T01:24:17.597

[MERGE 语句](http://docs.oracle.com/cd/B28359_01/server.111/b28286/statements_9016.htm#SQLRF01606) 合并两个表之间的数据。使用 DUAL 允许我们使用此命令。请注意，这不受并发访问的保护。

```
create or replace
procedure ups(xa number)
as
begin
    merge into mergetest m using dual on (a = xa)
         when not matched then insert (a,b) values (xa,1)
             when matched then update set b = b+1;
end ups;
/
drop table mergetest;
create table mergetest(a number, b number);
call ups(10);
call ups(10);
call ups(20);
select * from mergetest;

A                      B
---------------------- ----------------------
10                     2
20                     1 
```

* * *

## 回答 #2

> 赞同：117
> 
> 时间：2010-04-22T16:00:39.017

上面的 PL/SQL 中的双重示例很棒，因为我想做类似的事情，但我想要它在客户端......所以这是我用来直接从某些 C# 发送类似语句的 SQL

```
MERGE INTO Employee USING dual ON ( "id"=2097153 )
WHEN MATCHED THEN UPDATE SET "last"="smith" , "name"="john"
WHEN NOT MATCHED THEN INSERT ("id","last","name") 
    VALUES ( 2097153,"smith", "john" ) 
```

但是，从 C# 的角度来看，这比进行更新并查看受影响的行是否为 0 以及如果是则执行插入要慢。

* * *

## 回答 #3

> 赞同：68
> 
> 时间：2008-10-27T11:12:13.790

MERGE 的替代方法（“老式方式”）：

```
begin
   insert into t (mykey, mystuff) 
      values ('X', 123);
exception
   when dup_val_on_index then
      update t 
      set    mystuff = 123 
      where  mykey = 'X';
end; 
```

* * *

## 回答 #4

> 赞同：52
> 
> 时间：2008-10-28T14:37:32.563

没有异常检查的另一种选择：

```
UPDATE tablename
    SET val1 = in_val1,
        val2 = in_val2
    WHERE val3 = in_val3;

IF ( sql%rowcount = 0 )
    THEN
    INSERT INTO tablename
        VALUES (in_val1, in_val2, in_val3);
END IF; 
```

* * *

## 回答 #5

> 赞同：33
> 
> 时间：2014-01-23T14:02:31.263

1.  如果不存在则插入
2.  更新：

```

插入 mytable (id1, t1)
  选择 11, 'x1' 从双
  不存在的地方（从 mytble 中选择 id1，其中 id1 = 11）；

更新 mytable SET t1 = 'x1' WHERE id1 = 11;

```

* * *

## 回答 #6

> 赞同：27
> 
> 时间：2014-04-01T05:45:57.957

正如 Tim Sylvester 的评论中所指出的那样，到目前为止**，在并发访问面前给出的答案都不是安全的，并且会在发生比赛时引发异常。**为了解决这个问题，插入/更新组合必须包含在某种循环语句中，以便在出现异常时重试整个事情。

例如，下面是如何将 Grommit 的代码包装在一个循环中以使其在并发运行时安全：

```
PROCEDURE MyProc (
 ...
) IS
BEGIN
 LOOP
  BEGIN
    MERGE INTO Employee USING dual ON ( "id"=2097153 )
      WHEN MATCHED THEN UPDATE SET "last"="smith" , "name"="john"
      WHEN NOT MATCHED THEN INSERT ("id","last","name") 
        VALUES ( 2097153,"smith", "john" );
    EXIT; -- success? -> exit loop
  EXCEPTION
    WHEN NO_DATA_FOUND THEN -- the entry was concurrently deleted
      NULL; -- exception? -> no op, i.e. continue looping
    WHEN DUP_VAL_ON_INDEX THEN -- an entry was concurrently inserted
      NULL; -- exception? -> no op, i.e. continue looping
  END;
 END LOOP;
END; 
```

注意 在`SERIALIZABLE`我不推荐顺便说一句的事务模式下，您可能会遇到 [ORA-08177: can't serialize access for this transaction](https://stackoverflow.com/questions/19923171/how-to-make-merge-serializable/) exceptions 而不是。

* * *

## 回答 #7

> 赞同：25
> 
> 时间：2012-12-25T15:36:00.977

我想要 Grommit 答案，但它需要欺骗值。我找到了可能出现一次的解决方案：[http ://forums.devshed.com/showpost.php?p=1182653&postcount=2](http://forums.devshed.com/showpost.php?p=1182653&postcount=2)

```
MERGE INTO KBS.NUFUS_MUHTARLIK B
USING (
    SELECT '028-01' CILT, '25' SAYFA, '6' KUTUK, '46603404838' MERNIS_NO
    FROM DUAL
) E
ON (B.MERNIS_NO = E.MERNIS_NO)
WHEN MATCHED THEN
    UPDATE SET B.CILT = E.CILT, B.SAYFA = E.SAYFA, B.KUTUK = E.KUTUK
WHEN NOT MATCHED THEN
    INSERT (  CILT,   SAYFA,   KUTUK,   MERNIS_NO)
    VALUES (E.CILT, E.SAYFA, E.KUTUK, E.MERNIS_NO); 
```

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2015-01-12T16:48:00.030

多年来我一直在使用第一个代码示例。注意未找到而不是计数。

```
UPDATE tablename SET val1 = in_val1, val2 = in_val2
    WHERE val3 = in_val3;
IF ( sql%notfound ) THEN
    INSERT INTO tablename
        VALUES (in_val1, in_val2, in_val3);
END IF; 
```

下面的代码可能是新的和改进的代码

```
MERGE INTO tablename USING dual ON ( val3 = in_val3 )
WHEN MATCHED THEN UPDATE SET val1 = in_val1, val2 = in_val2
WHEN NOT MATCHED THEN INSERT 
    VALUES (in_val1, in_val2, in_val3) 
```

在第一个示例中，更新执行索引查找。为了更新正确的行，它必须这样做。Oracle 打开一个隐式游标，我们使用它来包装相应的插入，因此我们知道插入只会在键不存在时发生。但是插入是一个独立的命令，它必须进行第二次查找。我不知道合并命令的内部工作原理，但由于该命令是一个单元，Oracle 可以通过单个索引查找执行正确的插入或更新。

I think merge is better when you do have some processing to be done that means taking data from some tables and updating a table, possibly inserting or deleting rows. But for the single row case, you may consider the first case since the syntax is more common.

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2011-11-25T23:19:47.770

关于建议的两种解决方案的说明：

1）插入，如果异常则更新，

或者

2) 更新，如果 sql%rowcount = 0 然后插入

是先插入还是先更新的问题也取决于应用程序。您是否期待更多插入或更多更新？最有可能成功的应该先走。

如果你选错了，你会得到一堆不必要的索引读取。没什么大不了的，但仍然需要考虑。

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2011-03-15T03:34:15.540

试试这个，

```
insert into b_building_property (
  select
    'AREA_IN_COMMON_USE_DOUBLE','Area in Common Use','DOUBLE', null, 9000, 9
  from dual
)
minus
(
  select * from b_building_property where id = 9
)
; 
```

* * *

## 回答 #11

> 赞同：-7
> 
> 时间：2010-02-10T01:24:03.153

来自[http://www.praetoriate.com/oracle_tips_upserts.htm](http://www.praetoriate.com/oracle_tips_upserts.htm)：

“在 Oracle9i 中，UPSERT 可以在一条语句中完成这项任务：”

```
INSERT
FIRST WHEN
   credit_limit >=100000
THEN INTO
   rich_customers
VALUES(cust_id,cust_credit_limit)
   INTO customers
ELSE
   INTO customers SELECT * FROM new_customers; 
```

# assembly - 为您的游戏或应用程序创建补丁需要哪些知识？

> ID：237331
> 
> 赞同：3
> 
> 时间：2008-10-26T01:26:13.520
> 
> 标签：assembly, binary, patch

我一直很困惑软件供应商如何发布他们的应用程序或游戏，然后提供一组不同的可执行文件来改变之前构建的行为。这是怎么做到的？原始应用程序和补丁是否必须遵守某种规则？还是补丁会爬入原始可执行文件并更改其程序集信息？这需要二进制文件到字节级别的知识吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-26T01:35:41.817

我见过的主要方法有两种。许多程序由许多在运行时动态加载的较小部分组成，通常这些文件只是简单地替换为较新的版本。由于更新通常只影响相对少量的这些文件，因此补丁可能是整个应用程序的一小部分。另一种方法，我见过用于较大的单体应用程序，是使用一种“二进制差异”来实际更改可执行代码。这种方法的一个缺点是，在无需执行每次增量更新的情况下，更难以支持从几个修订版之前的版本升级到新版本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-26T01:30:49.877

我怀疑大多数时候，“补丁”只是一些替换文件。

但是，可以比较两个二进制文件，确定它们的差异，并创建一组编辑命令，将一个更改为另一个。例如，Unix 实用程序“diff”可以对文本文件执行此操作。

# asp.net - 部分页面缓存是否存在于 asp.net 之外？

> ID：237338
> 
> 赞同：1
> 
> 时间：2008-10-26T01:31:27.550
> 
> 标签：asp.net, caching

我在 ASP.NET 中使用部分页面缓存。我发现它对大容量网站特别有用，我只需要缓存页面的某些部分。

其他网络应用平台有这种技术吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-26T01:37:45.963

它通常被称为“片段缓存”，它被嵌入到大多数 Web 框架中。

导轨：[http ://api.rubyonrails.com/classes/ActionController/Caching/Fragments.html](http://api.rubyonrails.com/classes/ActionController/Caching/Fragments.html)

Django：[http ://docs.djangoproject.com/en/dev/topics/cache/#template-fragment-caching](http://docs.djangoproject.com/en/dev/topics/cache/#template-fragment-caching)

Merb： http: [//merbivore.com/documentation/current/doc/rdoc/merb-cache/index.html](http://merbivore.com/documentation/current/doc/rdoc/merb-cache/index.html)

Zend：http: [//zendframework.com/manual/en/zend.cache.frontends.html#zend.cache.frontends.output](http://zendframework.com/manual/en/zend.cache.frontends.html#zend.cache.frontends.output)

CakePHP：[http ://book.cakephp.org/view/156/Caching](http://book.cakephp.org/view/156/Caching)

# netbeans6.1 - Netbeans 6.1 (!5.5.1) - 关闭 - 红色波浪下划线 - 如何？

> ID：237342
> 
> 赞同：1
> 
> 时间：2008-10-26T01:33:42.820
> 
> 标签：netbeans6.1

如何关闭 Netbeans 中的波浪形红色下划线？我不想在打字时被打断，并被告知半行代码是错误的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-29T09:38:52.307

答案在这里[Netbeans - 关闭 - 红色波浪下划线 - 如何？](https://stackoverflow.com/questions/236733/netbeans-turn-off-wavy-red-underlines-how)似乎更准确……（尽管 Mac 版本的 Netbeans 5.6.1 似乎没有“高级”菜单）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-26T03:28:34.133

工具 -> 选项 -> 字体和颜色

在语言列表中选择“所有语言”。在类别列表中选择“错误”。在右侧，在“效果”列表中选择“无”，然后单击“确定”。

# javascript - 如何在 setTimeout 调用中解决 Var 超出范围的问题

> ID：237350
> 
> 赞同：12
> 
> 时间：2008-10-26T01:43:00.400
> 
> 标签：javascript, scope

我正在尝试从 setInterval 回调中调用 setTimeout：

```
function callback()
{
   //assign myVar
   var myVar = document.getElementById("givenID");
   //...
   //now wait 2 secs then call some code that uses myVAr
   setTimeout("myVar.innerHTML = 'TEST'", 2000);
}

setInterval("callback();", 10000); 
```

setInterval 按预期工作，但 setTimeout 调用失败。我想这个问题与我引用一个不在范围内的变量（myVar）有关。

解决这个问题的最佳方法是什么？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-10-26T02:13:39.183

这是闭包的完美候选者：

```
setInterval(
    function ()
    {
       var myVar = document.getElementById("givenID");
       setTimeout(
          function()
          {
              // myVar is available because the inner closure 
              // gets the outer closures scope
              myVar.innerHTML = "Junk";
          },2000);
    }, 10000); 
```

您的问题与范围相关，这可以解决这个问题。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2011-07-30T15:40:42.433

我有一个类似的问题。问题是我试图通过 setTimeout() 从自身内部调用一个方法。像这样的东西，对我不起作用：

```
function myObject() {

   this.egoist = function() {
      setTimeout( 'this.egoist()', 200 );
   }

}

myObject001 = new myObject();
myObject001.egoist(); 
```

以下也不起作用：

```
... setTimeout( egoist, 200 );
... setTimeout( egoist(), 200 );
... setTimeout( this.egoist, 200 );
... setTimeout( this.egoist(), 200 );
... setTimeout( function() { this.egoist() }, 200 ); 
```

解决方案是使用 with() 语句，如下所示：

```
function myObject() {

   this.egoist = function() {
      with (this) { setTimeout( function() { egoist() }, 200 );}
   }

}

myObject001 = new myObject();
myObject001.egoist(); 
```

当然，这是一个无限循环，但我在这里要表达的观点不同。

希望这可以帮助 ：）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-26T02:13:37.217

作为最佳实践，尽量不要使用字符串作为参数`setTimeout`，`setInterval`因为这会调用`eval`......使用以下形式也可能使这个问题更容易理解/调试：

```
setInterval(function () {
    // do stuff
    // ...
    // now wait 2 secs then call someFunction
    setTimeout(someFunction, 2000);
}, 10000); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-26T01:57:59.463

在 Firefox 中运行它并检查工具 | 错误控制台。如果 setTimeout 失败，它可能会告诉你为什么。

另外，尝试用`"someFunction();"`（`"alert('hi')"`无分号）替换，看看是否有效。如果是这样，问题就会大大缩小。

# wpf - WPF 是否有一种简单的方法来显示一系列可导航的图像？

> ID：237364
> 
> 赞同：1
> 
> 时间：2008-10-26T01:52:28.553
> 
> 标签：wpf, controls, ui-design

我正在制作我的第一个 WPF 应用程序，其目的是从一些数据中生成 6 张图像。理想情况下，我想将它们显示在窗口中，带有很少的“前进”和“后退”按钮，以及我们在图像堆栈中的位置的文本指示器。有点像“迷你 Windows 照片库”。

我认为这样做的方法可能是对样式进行某种自定义`ListView`，但也有可能`Frame`与自定义 WPF 页面或其他东西一起使用？我不知道，似乎应该有一种规范的方式来做到这一点。

我目前最好的方法是`ListView`按照我的一本 WPF 书籍的指南进行自定义。如果有人已经这样做了，或者如果有更好的方法，请告诉我！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-01T01:43:19.470

您可能想查看来自 Vertigo的[Slide.Show 项目。](http://www.vertigo.com/slideshow.aspx)他们将其源代码作为 WPF 演示应用程序发布。该应用程序是一个不错的图像查看器，您可以从中借鉴概念。（微软要求 Vertigo 为 WPF 创建技术演示）

# .net - .NET 中您最喜欢的功能是什么？

> ID：237365
> 
> 赞同：4
> 
> 时间：2008-10-26T01:52:29.613
> 
> 标签：.net, asp.net, favorites

.NET 中有很多功能。一些语言相关，其他将与框架本身相关并且具有访问/执行/执行 xyz 的能力。所以为了好玩，我想知道*社区*最喜欢的**.NET 或 ASP.NET**功能包括哪些？

***这是一个社区 wiki 问题，因为它主要用于投票目的，以查看对.NET**的各个方面有什么样的响应*

 **具体来说，尝试包括一些关于它的东西，比如代码示例。

示例类别和主题：

*   DLR
*   林克
*   表达式
*   WPF
*   泛型
*   WCF

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-26T01:54:59.750

泛型。非常适合不滚动您自己的容器类。从 C# 2.0 开始可用。

```
public T Remove<T>(T item) {
  foreach (T t in this.list) {
    if (t.equals(item)) {
      list.delete(t);
      return t;
    }
  }
  return null;
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-26T02:39:10.487

**反思**。让我们面对现实吧：没有反射，.NET 只是 C 的追求者。或者，如果我们想大方一点，想要成为 Java 的人——但 Java 有反射，否则闻起来有点像 Pascal 想要成为的人，所以让我们避免这种争论，而只是接受 .NET 非常希望成为一个可移植的汇编程序有足够的元数据使 VB 工作。

我听说人们声称您应该避免使用反射，因为它会减慢您的程序速度并使静态分析工具的生活变得困难......坦率地说，这是一大堆肥料。函数会减慢 C 的速度，但谁会编写没有函数的 C 代码？宏使 C 的静态分析变得困难，但没有宏，C 什么都不是！因此，我敦促您*发疯*——如果反射让您的生活更轻松，请使用它。哎呀，滥用它。根据您的意愿弯曲*您选择的 .NET 语言*并向它展示谁是老板 - 使用 Reflection 作为您可信赖*的意志弯曲橡木俱乐部*。然后啜饮你的冰茶，凝视你的双手，相信没有人敢说你不是工具的主人。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-26T04:18:20.820

我认为 .NET 中有很多很棒的功能，但我投票支持使该平台成为目前最佳软件技术选择之一的幕后因素：

*   **垃圾收集**- 幸福地不知道何时必须释放对象的内存是一个很好的礼物。在其他语言 (C++) 中，如果您自己不清理，则会出现内存泄漏和蓝屏。

*   **即时编译**- 编译器在使用前优化每个方法，删除冗余或未优化的代码。

*   **AppDomains** - 当 .NET 应用程序死掉时，它不会破坏您的系统。

*   **并行执行**和**XCopy 部署**- 不再有 DLL 地狱。纳夫说。

*   **平台抽象**- 该框架隐藏了本机 Win32 Api 的许多版本控制细节。

*   **语言中立**- 无论是 VB.NET、C# 还是您喜欢的任何语言，都是 MSIL。能够在 VB.NET 中继承 C# 类非常酷。

*   **互操作性**- 能够调用旧版 Win32 API、与 COM+ 互操作等

其他：

*   如前所述，反射是杀手。
*   Xml 配置支持远远优于 Java 的属性文件语法。

我真的必须选择一个吗？

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-26T08:47:01.103

代表；我喜欢编写函数式代码的能力，没有 F# 的痛苦，也喜欢 C++ 的无类型函数指针。再加上非常好的 lambda 语法 (C#)，以及对捕获的编译器支持，它们非常棒！我更喜欢 C# 捕获而不是 java 捕获，因为值可以以任何一种方式流动（捕获的是变量，而不是值）。

举个简单的例子——这不是有多痛苦吗？

```
string name = // something interesting
var item = list.Find(x => x.Name == name && x.Status == Status.Open); 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-26T03:11:34.713

[Linq To SQL](http://msdn.microsoft.com/en-us/library/bb386976.aspx)和[ADO.NET 实体框架](http://msdn.microsoft.com/en-us/library/aa697427(VS.80).aspx)，精彩的功能......

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-24T13:29:01.123

垃圾收集器。一段时间后，你认为这是理所当然的。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-26T03:43:15.617

ASP.NET 状态管理和 WebForms。

WebForms 之所以名声不好，主要是因为很多人没有正确使用它们，也不了解应该如何使用状态。

正确使用时，在不需要的地方禁用 ViewState，在应该完成时重新填充数据等 WebForms 使 Web 开发比使用 PHP 或 ASP 时容易得多。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-24T14:06:54.947

没有特别的顺序

反射
Linq
Lambda

见鬼，在某些情况下，我将所有三个组合在一个语句中。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-24T14:10:34.330

**代码隐藏**文件

..从经典 ASP 时代（和 php？）迈出一大步

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-25T12:05:56.463

泛型和表达式树

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-24T13:22:24.240

属性（Java：注释）。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-26T03:38:09.887

我真的没有任何我会称之为“最喜欢”的语言功能。我的意思是我喜欢泛型，我喜欢 LINQ 以及其他许多东西，但它们都是对在其他语言中效果更好的东西的半生不熟的模仿。

示例：泛型很棒，但远不如 C++ 模板强大或有用。示例 2：LINQ 扩展方法很棒，但远不如 ruby​​ 中的开放类 + 普通旧方法强大或有用。

等等等等。

老实说，我最喜欢 .NET 的地方在于它的*速度*和*部署模型*。能够使用所有这些半生不熟但仍然很棒的功能比根本无法使用它们要好得多，因为运行时速度非常慢（例如 ruby​​），或者因为除非他们使用完全相同，否则没有人可以加载您的 dll带有某些标志的疯狂编译器在发布模式下的变体（例如 C++）

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-26T04:06:18.690

ADO.NET，特别是与 DataAdapter 一起使用的强类型数据集。它使与数据库和存储过程交互的代码管理变得轻而易举。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-20T11:22:40.350

**Windows Communication Foundation (WCF)**是我最喜欢的 .NET 功能。这是从普通 Web 服务向前迈出的一大步。它还包含越来越流行的 REST 设计。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-20T10:48:02.837

*   LINQ
*   事实上，一切都归于 IL，这意味着您可以在它之上实现任何语言，并以很少的成本获得诸如泛型和 LINQ 之类的东西
*   WF - 我知道它很复杂，而且不是最好的实现，但如果你花时间使用它，你会发现它确实可以很好地达到它的目标目的。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-12-11T10:13:17.033

**GDI+**

图形过去很难做到。使用 GDI+，它变得无痛。而且里面有很多功能。Matrix、Path、Transparency、SmoothingMode 之类的东西很棒，而且玩起来很有趣。

如果这还不够，您还可以使用 DirectDraw 或 Direct3D。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-12-24T13:28:53.073

组合：委托 + 匿名方法 + Lambda 表达式

# php - 为什么 PHP PDO DSN 是 MySQL 与 PostgreSQL 的不同格式？

> ID：237367
> 
> 赞同：35
> 
> 时间：2008-10-26T01:52:54.810
> 
> 标签：php, mysql, postgresql, pdo

当我使用 PDO 连接到 MySQL 数据库时，我需要连接的方式是：

```
$pdoConnection = new PDO("mysql:host=hostname;dbname=databasename",user,password); 
```

但是，对于 PostgreSQL，DSN 更标准（IMO）：

```
$pdoConnection = new PDO("pgsql:host=hostname;dbname=databasename;user=username;password=thepassword"); 
```

MySQL不能使用单个字符串有什么原因吗？或者这仅仅是因为我使用的版本（PHP 5.2、MySQL 5.0、PostgreSQL 8.1）？

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2009-08-22T00:28:06.630

作为实现这两者的人，我可以告诉你，原因是通过将字符串按原样传递给 postgres（和 ODBC），这些数据库的 PDO 驱动程序代码不需要更新，因为底层库添加了新功能.

由于 MySQL 没有自己的连接字符串解析代码，我们发明了一种将数据传递到底层 MySQL 函数调用的机制，这些函数调用具有非常特定的 API 和固定参数。

没有意外；这是非常刻意的。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2020-06-26T04:05:59.727

这已在 PHP 7.4 中得到解决，如[新特性](https://www.php.net/manual/en/migration74.new-features.php)中所示。

我已经在本地确认我们可以写：

```
$dbh = new PDO('mysql:host=localhost;dbname=my_db;charset=utf8mb4;user=root;password=') 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-05-25T11:52:48.317

是的，这种 API 不一致是一个主要的烦恼。

作为一种解决方法，我使用查询字符串语法将实际的 DSN 字符串与可选的用户名和密码打包在一起——然后像这样解析和构造：

```
parse_str($connection_string, $params);

$pdo = new PDO($params['dsn'], @$params['username'], @$params['password']); 
```

所以对于 PostgreSQL，使用`$connection_string`类似：

```
dsn=pgsql:host=localhost;dbname=test;user=root;password=root 
```

对于 MySQL，使用如下字符串：

```
dsn=mysql:host=localhost;dbname=testdb&username=root&password=root 
```

有点蹩脚，但它很简单并且有效。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-11-25T17:19:56.280

这个问题已经有 10 多年的历史了，但是每次我创建一个使用 PDO 的新项目时，我仍然会在这里结束......我在这里写我的解决方案，以便下次我可以省去自己的麻烦：P

```
class MyPDO extends PDO {
    public function __construct($dsn, $options = null) {
        $user=null;
        $pass=null;

        if (preg_match("/user=([^;]*)/", $dsn, $matches)) {
            $user=$matches[1];
        }
        if (preg_match("/password=([^;]*)/", $dsn, $matches)) {
            $pass=$matches[1];
        }

        parent::__construct($dsn, $user, $pass, $options);
    }
} 
```

# c++ - “std::size_t”在 C++ 中有意义吗？

> ID：237370
> 
> 赞同：63
> 
> 时间：2008-10-26T01:55:05.383
> 
> 标签：c++, size-t

在我继承的一些代码中，我看到经常使用`size_t`命名`std`空间限定符。例如：

```
std::size_t n = sizeof( long ); 
```

当然，它编译并运行良好。但这对我来说似乎是一种不好的做法（也许是从 C 继承而来的？）。

这不是`size_t`内置在 C++ 中并因此位于全局命名空间中吗？`size_t`是否需要在 C++中使用头文件？

问这个问题的另一种方法是，以下程序（*没有*包含）是否可以在所有 C++ 编译器上编译*？*

```
size_t foo()
{
    return sizeof( long );
} 
```

* * *

## 回答 #1

> 赞同：135
> 
> 时间：2008-11-12T04:18:55.753

stackoverflow 人群中似乎对此感到困惑

`::size_t`在向后兼容标头中定义`stddef.h`。它从一开始就是其中的`ANSI/ISO C`一部分`ISO C++`。每个 C++ 实现都必须附带`stddef.h`（兼容性），`cstddef`并且只有后者定义`std::size_t`而不一定`::size_t`。请参阅 C++ 标准的附录 D。

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2008-10-26T02:21:18.853

C++ 标准的第 17.4.1.2 节第 4 段指出：

“然而，在 C++ 标准库中，声明和定义（在 C 中定义为宏的名称除外）在命名空间 std 的命名空间范围 (3.3.5) 内。”

这包括在模式*cname*的标题中找到的项目，包括定义 size_t的*cstddef 。*

所以 std::size_t 实际上是正确的。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-26T11:12:02.200

例如，您可以`size_t`通过包含`<stddef.h>`而不是`<cstddef>`. 我看不到任何明显的好处，并且该功能已被弃用。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-26T02:18:27.130

size_t 没有内置在 C++ 中。并且默认情况下没有定义。这个不能用 GCC 编译：

```
int main(int argc, char** argv) {
size_t size;
} 
```

也就是说， size_t 是 POSIX 的一部分，如果你只使用基本的东西，比如`<cstdlib>`，你最终可能会定义它。

您可能会争辩说 std::size_t 是 size_t 的 C++ 等价物。正如布赖恩所指出的，std:: 被用作命名空间以避免设置不适合所有人的全局变量。它就像 std::string 一样，也可以在根命名空间中定义。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-08-06T10:23:48.810

```
std::size_t n = sizeof( long ); 
```

实际上，您还没有问过上面的具体做法是什么。使用 size_t，使用 std 命名空间进行限定，...

正如 C++ 标准所说（18.1）， size_t 是标准 header 中定义的类型。我建议放弃关于可能从 C 语言继承的任何想法和印象。C++ 是一种独立且不同的语言，最好这样考虑。它有自己的标准库，并且 C++ 标准库的所有元素都在命名空间 std 中定义。但是，可以在 C++ 程序中使用 C 标准库的元素。

我会考虑将其列为肮脏的黑客。C++ 标准规定标头的内容是相同的或基于 C 标准库中的相应标头，但在许多情况下，已应用更改。换句话说，它不是将 C 头文件直接复制和粘贴到 C++ 头文件中。

size_t 不是 C++ 中的内置类型。它是一种定义类型，用于指定使用哪种整数类型作为 sizeof() 运算符的返回类型，因为 sizeof() 的实际返回类型是实现定义的，所以 C++ 标准通过定义 size_t 来统一。

> 以下程序（不包含）是否可以在所有 C++ 编译器上编译？
> 
> ```
> size_t foo()
> {
>     return sizeof( long );
> } 
> ```

C++ 标准说（1.4）：

*库中定义的名称具有命名空间范围（7.3）。AC ++ 翻译单元 (2.1) 通过包含适当的标准库头 (16.2) 来获得对这些名称的访问。*

size_t 是在 std 命名空间中定义的名称，因此在这种情况下，使用此名称的每个程序都应包含相应的标头。

接下来，3.7.3章节说：

*However, referring to std, std::bad_alloc, and std::size_t is ill-formed unless the name has been declared by including the appropriate header.*

Given that, program using size_t but not including header is ill-formed.

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-26T01:57:14.020

有时其他库会定义自己的 size_t。例如升压。std::size_t 指定您肯定想要 c++ 标准。

size_t 是一个 c++ 标准类型，它在命名空间 std 中定义。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-16T04:30:09.183

GNU 编译器头文件包含类似

```
typedef long int __PTRDIFF_TYPE__;
typedef unsigned long int __SIZE_TYPE__;
```

然后 stddef.h 包含类似

```
typedef __PTRDIFF_TYPE__ ptrdiff_t;
typedef __SIZE_TYPE__ size_t;
```

最后 cstddef 文件包含类似

```
#include <stddef.h>

命名空间标准{

  使用 ::ptrdiff_t;
  使用 ::size_t;

}

```

我认为这应该说清楚。只要您包含 <cstddef> ，您就可以使用 size_t 或 std::size_t 因为 size_t 在 std 命名空间之外进行了类型定义，然后被包含在内。实际上你有

```
typedef long int ptrdiff_t;
typedef unsigned long int size_t;

命名空间标准{

  使用 ::ptrdiff_t;
  使用 ::size_t;

}

```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-05-11T22:48:22.393

我认为澄清已经足够清楚了。这`std::size_t`在 C++ 中很有意义，并且`::size_t`（至少）在 C 中很有意义。

然而，一个问题仍然存在。即是否可以安全地假设`::size_t`并且`std::size_t`兼容？

从纯粹的类型安全的角度来看，它们不一定相同，除非在某处定义它们必须相同。

我认为很多人都在使用 la 的东西：

```
----
// a.hpp 
#include <string>

void Foo( const std::string & name, size_t value );

-----
// a.cpp
#include "a.hpp"

using namespace std;

void Foo( const string & name, size_t value ) 
{
  ...
} 
```

所以在标题中你肯定`::size_t`会在你将使用的源文件中使用 while `std::size_t`。所以他们一定是兼容的，对吧？否则你会得到一个编译器错误。

/迈克尔·S。

# algorithm - photoshop抠图滤镜是如何实现的？

> ID：237372
> 
> 赞同：8
> 
> 时间：2008-10-26T01:56:36.237
> 
> 标签：algorithm, language-agnostic, image-processing, reverse-engineering, photoshop

Photoshop 有很多很酷的[艺术滤镜](http://alanwho.com/photoshop/photoshop-artistic-filters/)，我很想了解底层算法。

一种特别有趣的算法是 Cutout 过滤器（上面链接中的第 2 号）。

它具有三个可调参数，层数、边缘简单性和边缘保真度。级别数似乎驱动了一个简单的后处理算法，但其他滑块在技术上所做的事情让我难以理解。

我认为他们正在做一些与 Vornoi 图或 k-means 分区相关的事情，但是在维基百科上四处寻找并没有导致任何明显映射到 Photoshop 正在做的事情，特别是考虑到过滤器自身渲染的速度。

是否有任何关于 Photoshop 滤镜技术描述的来源？或者，您对如何实现此特定过滤器有任何想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-26T04:57:33.470

边缘检测通常是 Sobel 或 Canny 滤波器，然后边缘通过链码连接在一起。
查看[OpenCV](http://opencv.willowgarage.com/wiki/)库之类的详细信息

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-03T23:09:53.087

你看到这个[帖子](http://www.imagemagick.org/discourse-server/viewtopic.php?f=1&t=6050)了吗。它解释了如何使用[ImageMagic](http://www.imagemagick.org/)获得相同的结果，并且 IM 是[开源](http://www.imagemagick.org/script/license.php)的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-26T19:05:07.323

我不确定它可能是某种细胞着色，但它看起来也像一个内核大小非常大的中值滤波器，或者被应用了多次。

边缘简单性/保真度可能是有助于根据与当前像素的颜色差异决定是否考虑相邻像素（或落在内核内的像素）的选项。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2020-08-29T13:45:44.820

非常老的问题，但也许有人在寻找答案，也许这会有所帮助。Opencv 的 findcontours 和 approxPolyDP 函数可以做到这一点。但是我们需要在主进程之前准备好图像。第一的; 用 k-means 找到最常用的 N 种颜色。例如找到 8 种颜色。找到每种颜色的轮廓，然后一一计算所有颜色的轮廓面积（我们将有 N = 8 层）。之后，在 approxPolyDP 之后为从最大的 ContourArea 到更小的每种颜色绘制填充轮廓，并使用其预先计算的颜色。我的另一个建议是在计算轮廓区域时消除非常小的轮廓。

Photoshop抠图效果参数；Number Of Levels=K-Means-找出最常用的N种颜色。Edge Simplicity=我猜高斯模糊或其他去除噪声滤波器，如双边滤波器或具有边缘保留的均值偏移滤波器将对此步骤有用。此步骤可以在 K-Means 之后和找到轮廓之前执行。Edge fidelity=openCV 的 approxPolyDP epsilon 参数。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-26T02:56:17.863

也许不完全是您想要的，但如果您想了解过滤器的工作原理，您可以查看 GIMP 的源代码。我不能说 GIMP 是否具有您提到的等效剪切过滤器，但如果您真的对这个领域感兴趣，那么值得一看。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-28T02:28:07.093

级别数似乎类似于单元格着色的完成方式，这就是我在这种情况下实现该部分的方式：您只需获取图像的直方图并将其划分为“级别数”数量的部分然后计算每个部分的平均值。然后直方图中的每种颜色将使用该平均值而不是其原始颜色。

其他两个参数需要更多思考，但“边缘简单”似乎引爆了形状建立起来的段数。或者更确切地说：应用于一些粗略的图像分割算法的细化次数。保真度滑块似乎做了类似的事情；它可能控制着什么时候应该进行改进的某种阈值。

[这可能会有所帮助](http://www.upatras.gr/ieee/skodras/pubs/ans-c22.pdf)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-03T19:31:33.847

有一个简单的解决方案，理论上会产生类似于该过滤器的东西。某种程度上类似于 Ismael C 的建议。

Edge *Simplicity*控制窗口大小。也许窗口应该加权。

但与常规窗口过滤器不同的是，这个过滤器只会从该窗口中获取固定大小的随机像素部分。该部分的大小由*Fidelity*参数控制。

将像素颜色设置为样本的中值。

鉴于我们有一些后处理算法，它会在之后应用。

开始了！

如果您实施，请报告结果。

PS。我真的怀疑是否使用了分段。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-03T19:48:02.730

我想这可能是一些阈值、边缘检测（Sobel/Canny/Roberts/whatever）和后处理。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-09-20T14:57:32.903

通过修补它，我发现：

*   这是确定性的
*   它不做任何基于像素的后处理来达到最终效果
*   它可能不使用任何类型的基于像素的边缘检测，它似乎更适用于区域而不是边缘。
*   它计算要绘制的闭合多边形的形状（一些多边形边缘可能与图像边缘重叠）。
*   当多边形的边缘已知时，包围在边缘中的每个区域（不一定属于一个多边形）的颜色用该区域覆盖的原始图像像素的平均颜色着色。
*   多边形的边缘可以与自身相交。 *特别是对于高边缘的简单性可见。*
*   随着“线条简单性”的下降，多边形边的数量会增加，但多边形的数量也会增加。
*   边缘保真度影响线多边形边缘计数，但不影响多边形计数
*   高保真度 (=3) 导致单个多边形同时具有非常长和非常短的边缘，低保真度 (=1) 导致单个多边形具有大致相似长度的所有边缘
*   高边缘简单性和低边缘保真度似乎更喜欢锚定在图像边缘的多边形，即使以理智为代价。

总而言之，它看起来像是 Adob​​e Illustrator 的简化版 Live Trace 算法，它使用多边形而不是曲线。

... 或者可能不是。

# class - 如何在 UML 类图中最好地可视化“权限矩阵”？

> ID：237373
> 
> 赞同：3
> 
> 时间：2008-10-26T01:57:05.550
> 
> 标签：class, permissions, uml, diagram, oop

为了简单起见：

有一个基于权限的系统，具有不同类型的用户级别和操作（想想：UNIX 文件系统权限）

在 UML 中将其可视化的最佳方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T03:53:19.277

我通常有代表用户、角色和权限的类。用户属于角色并且角色被授予权限。访问其他对象需要权限。在 UML 中，我假设您将 Role 建模为抽象基类，并具有多个不同的实现，每个角色一个。

通常，我将 Permission 建模为包含可读、可写、可删除业务实体类集的对象（可能包含属性排除或包含）。每个角色，然后有一个权限。该权限允许或拒绝访问一个或多个其他类。默认情况下，权限被拒绝，并且仅当类在请求的操作的适当集合中时才允许访问。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-26T02:26:12.027

我喜欢认为一个文件系统对象有许多标准方法，每个方法都有一个关联的权限。

通常感兴趣的方法/权限有 9 种：（用户、组、其他）*（读取、写入、执行）的组合。此外，还有 Sticky 和 ​​SetUID 等选项。

一个文件系统对象与一个用户和一个组相关联。一个用户与任意数量的组相关联。

当前用户与任意数量的组相关联。

以上是非常标准的类图。文件系统对象、用户、组、关联。并且文件系统对象有一堆属性和9个规范方法。

什么是允许的约束没有一个整洁的图表。它是一组规则表达式。首先是使用哪个权限集（用户、组或其他），然后是该集中的哪个权限（读、写或执行）。

我想，你可以用一组具体对象（Unix 有用户、组、其他）定义一类用户，以及用一组具体对象（Unix 有读、写、执行）定义一类操作。然后，您可以使用两种关联来定义权限：一种与用户类关联，一种与操作类关联。

我认为只列出完整的集合方法来复杂地绘制用户类实例和操作类实例的组合更容易。

# c# - 使用 LINQ 查询获取索引值的集合

> ID：237377
> 
> 赞同：17
> 
> 时间：2008-10-26T02:00:17.120
> 
> 标签：c#, .net, arrays, linq, indexof

有一个更好的方法吗？

```
string[] s = {"zero", "one", "two", "three", "four", "five"};

var x = 
s
.Select((a,i) => new {Value = a, Index = i})
.Where(b => b.Value.StartsWith("t"))
.Select(c => c.Index); 
```

即我正在寻找一种更有效或更优雅的方式来获取符合条件的项目的位置。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-10-26T07:15:57.077

您可以轻松添加自己的扩展方法：

```
public static IEnumerable<int> IndexesWhere<T>(this IEnumerable<T> source, Func<T, bool> predicate)
{
    int index=0;
    foreach (T element in source)
    {
        if (predicate(element))
        {
            yield return index;
        }
        index++;
    }
} 
```

然后将其用于：

```
string[] s = {"zero", "one", "two", "three", "four", "five"};
var x = s.IndexesWhere(t => t.StartsWith("t")); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-26T03:10:09.943

如果您只是将示例用作学习 LINQ 的一种方式，请忽略此帖子。

* * *

我不清楚 LINQ 实际上是做到这一点的最佳方式。下面的代码似乎更有效，因为不需要创建新的匿名类型。当然，您的示例可能是人为的，并且该技术可能在不同的上下文中更有用，例如在可以利用值索引的数据结构中，但是下面的代码相当简单，可以理解（没有想过需要）并且可以说更有效。

```
string[] s = {"zero", "one", "two", "three", "four", "five"};
List<int> matchingIndices = new List<int>();

for (int i = 0; i < s.Length; ++i) 
{
   if (s[i].StartWith("t"))
   {
      matchingIndices.Add(i);
   }
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-26T02:03:08.080

对我来说似乎很好。您可以通过将选择更改为：

```
.Select((Value, Index) => new {Value, Index}) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-16T13:53:52.333

Collection List 中还有一个 FindIndex 方法，您可以为其创建一个删除方法，该方法可以从集合中返回索引。您可以参考 msdn [http://msdn.microsoft.com/en-us/library/x1xzf2ca.aspx](http://msdn.microsoft.com/en-us/library/x1xzf2ca.aspx)中的以下链接。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-24T03:12:28.130

这个怎么样？它类似于原始海报，但我首先选择索引，然后构建一个符合条件的集合。

```
var x = s.Select((a, i) => i).Where(i => s[i].StartsWith("t")); 
```

这比其他一些答案效率低一点，因为列表完全迭代了两次。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-10-20T00:07:21.097

我和一位同事讨论了这个有趣的问题，起初我认为 JonSkeet 的解决方案很棒，但我的同事指出了一个问题，即如果函数是 的扩展`IEnumerable<T>`，那么它可以在集合实现它的地方使用。

使用数组，可以肯定地说生成的顺序`foreach`将受到尊重（即`foreach`从第一个到最后一个迭代），但其他集合（列表、字典等）不一定是这种情况，其中*不一定*`foreach`反映“进入顺序”。然而，功能就在那里，它可能会产生误导。

 *最后，我得到了类似于 tvanfosson 的答案，但作为数组的扩展方法：

```
public static int[] GetIndexes<T>(this T[]source, Func<T, bool> predicate)
{
    List<int> matchingIndexes = new List<int>();

    for (int i = 0; i < source.Length; ++i) 
    {
        if (predicate(source[i]))
        {
            matchingIndexes.Add(i);
        }
    }
    return matchingIndexes.ToArray();
} 
```

希望`List.ToArray`能尊重最后一次手术的顺序……

# svn - 如何根据新的 SVN 配置重置 svn 属性？

> ID：237382
> 
> 赞同：3
> 
> 时间：2008-10-26T02:09:07.757
> 
> 标签：svn, automatic-properties

最近我对我的本地 svn 配置文件进行了一些更改。主要是我更正了大约 15 种不同文件类型的 svn:mime-type 属性。现在我需要根据这个新配置重置所有以前签入的文件。SVN 似乎只为 ADDs 和 IMPORTs 触发 auto-prop。那么如何在不单独指定新的 mime 类型的情况下做到这一点呢？

谢谢！

*   dt

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-26T02:42:57.157

没有办法让 svn 开箱即用。svn_apply_autoprops.py脚本应该会有所帮助[。](http://svn.apache.org/repos/asf/subversion/trunk/contrib/client-side/svn_apply_autoprops.py)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-26T05:27:49.197

谢谢克劳伦斯！有效！

对于其他人仅供参考，我追踪了这个脚本的来源，我发现了更多的客户端脚本： [http ://subversion.tigris.org/tools_contrib.html](http://subversion.tigris.org/tools_contrib.html)

# vim - 如何在光标所在的位置插入换行符而不进入 Vim 中的插入模式？

> ID：237383
> 
> 赞同：95
> 
> 时间：2008-10-26T02:09:44.667
> 
> 标签：vim, performance, text-editor

是否可以在光标位于 Vim 的位置插入换行符而不进入插入模式？这是一个示例（`[x]`表示光标处于打开状态`x`）：

```
if (some_condition) {[ ]return; } 
```

有时，我可能想输入更多代码。所以我会按`i`进入插入模式，按`Enter`插入换行符，然后删除多余的空间。接下来，我将进入正常模式并将光标定位在右大括号之前，然后执行相同的操作以使其在自己的行上。

我已经这样做了一段时间，但肯定有更好的方法吗？

* * *

## 回答 #1

> 赞同：114
> 
> 时间：2008-10-26T02:11:57.330

对于您给出的示例，您可以使用`r``Enter`Enter 替换单个字符（空格）。然后，`f``space``.`向前移动到下一个空格并重复上一个命令。

根据您的自动缩进设置，上述可能会或可能不会正确缩进 return 语句。如果不是，则使用`s``Enter``Tab``Esc`换行符替换空格，缩进该行并退出插入模式。您必须用不同的命令替换第二个空格，这样您就不能使用“。” 在这种情况下。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-26T02:53:16.683

以下是如何创建一个宏，当您在*非*插入模式下按“g”时在光标处插入换行符：

在 vim 中，输入：

```
:map g i[Ctrl+V][Enter][Ctrl+V][Esc][Enter] 
```

在哪里：

*   [Ctrl+V] 表示*按住 Ctrl 键并按 'v'*
*   [Enter] 表示*按 Enter 键*
*   [Esc] 表示*按 Esc 键*

在您按下最后的 Enter 之前，您将在 vim 窗口的底部看到以下内容：

```
:map g i^M^[ 
```

**解释：**

[Ctrl+V] 表示“引用以下字符”——它允许您在命令中嵌入换行符和转义符。

因此，您将“g”键映射到序列：

```
i [进入] [退出]
```

这是 vim*在光标前插入换行符，然后退出插入模式*。

**调整：**

*   您可以将“g”替换为尚未链接到您使用的命令的任何字符。
*   在命令中添加更多内容，*例如* `f}i^M^[O` -- 这将**找到 }**并插入**另一个****换行符**，然后退出插入模式并打开一个空行供您**输入**更多代码。
*******   您可以将该命令添加到您的 .vimrc 或 .exrc 文件中以使其永久化。只需从开头省略冒号，因此命令以“map”开头******

 ******享受！

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-06-02T21:24:30.040

通过按 Ctrl+Enter 在光标处换行的简单映射：

> `:nmap <c-cr> i<cr><Esc>`

基本上进入“插入”模式，插入换行符并返回正常模式。

把它放在你的 .vimrc 文件中以备将来使用。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-26T04:00:14.130

如果您通常将单行块扩展为三行，请尝试替换。将左括号更改为括号/返回，将右括号更改为返回/括号。

用括号/返回替换括号的命令如下所示：

```
:s/{/{\r/ 
```

由于您想经常使用它，您可以将完整序列映射到未使用的击键，如下所示：

```
:map <F7> :s/{/{\r/ ^M :s/}/\r}/ ^M 
```

在序列中看到**^M的地方，键入****[Ctrl-V]**，然后按**enter**。

现在，将光标放在采样行的任意位置，按映射键，然后添加回车。

查看`:help map-which-keys`有关选择未使用的按键进行映射的建议。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2016-11-14T21:28:15.930

假设您可以映射`K`到其他东西（选择您喜欢的其他键），并且使用标记`'`作为临时标记可以，为什么不这样做呢？

```
:nmap K m'a<CR><Esc>`' 
```

现在在正常模式下按 K 在您希望发生换行符的字符上将分割该行并将光标留在原处。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-26T03:23:25.640

`autoindent`如果在启用（或任何其他缩进辅助）时将一行分成两部分，Vim 将自动删除光标右侧的任何空格。

如果您不想使用这些设置中的任何一个，请使用**而**`s`不是`i`为了用新文本替换空白而不是插入。（如果有多个空格，请将光标放在最左边并使用。）**`cw`**

 *** * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-03-03T22:51:47.657

基本上，当您拆分一行时，您要么只想插入回车，要么如果您在空格上，请将其替换为回车。那么，为什么要满足于其中一个呢？这是我对 K 的映射：

```
"Have K split lines the way J joins lines
nnoremap <expr>K getline('.')[col('.')-1]==' ' ? "r<CR>" : "i<CR><Esc>" 
```

我使用三元运算符将两个动作浓缩为一个键映射。分解它，`<expr>`意味着键映射的输出可以是动态的，在这种情况下取​​决于条件`getline('.')[col('.')-1]==' '`，这是询问 vim 光标下的字符是否是空格的冗长方式。最后，熟悉的三元运算符`? :`要么用换行符 ( ) 替换空格，`r<CR>`要么插入一个新的 ( `i<CR><Esc>`)

现在你有一个可爱的姐妹键映射到`J`命令。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-06-02T04:22:51.173

`o` `ESC`命令会为你做这件事。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-07-30T04:53:54.797

在你的 vimrc 中设置这个键映射

```
:map <C-m> i<CR><Esc>h 
```

如果要在 vim 中使用它，请按 Ctrl+m。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-04-23T10:13:07.880

恕我直言，内置映射`gs`不是有用的映射（让 vim 进入睡眠状态），可以使用它进行拆分：

```
nmap gs i<CR><ESC> 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-08-20T19:54:30.100

在[Vrapper 中](http://vrapper.sourceforge.net/home/)，您可以使用 gql 来拆分行而不进入插入模式，但可能并不总是保持缩进。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-03-25T00:51:57.713

实际上，您需要以下组合操作：

1.  按下`v`进入可视模式
2.  选择要拆分的行
3.  按下`:`进入命令模式
4.  `s/\s/\r/g`
5.  完毕

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-05-01T00:57:13.853

如果您有输入：

```
aaa bbb ccc ddd 
```

并想输出

```
aaa
bbb
ccc
ddd 
```

你可以使用命令

```
f r<ENTER>;.;. 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-12-14T15:26:51.023

我发现这是我期望的相反行为的最忠实的实现`J`

```
nnoremap S i<cr><esc>^mwgk:silent! s/\v +$//<cr>:noh<cr>`w 
```

它在光标处执行简单的新行，如果有任何存在，则处理前一行的任何尾随空格，然后将光标返回到正确的位置。

`i` `<cr>` `<esc>`- 这是建议的最常见解决方案之一，它不会删除光标下的非空白字符，但也会留下尾随空白

`^mw`- 转到新行的开头并在下面创建一个标记`w`

`gk`- 上一行

`:silent! s/\v +$//``<cr>`- 正则表达式替换行尾的任何空格

`:noh``<cr>`- 清除任何搜索突出显示正则表达式可能已打开

``w`- 返回下面的标记`w`

基本上结合了两者的优点`r``<esc>``<cr>`和`i``<cr>``<esc>`

注意：我有这个绑定，`S`它可能会覆盖一个有用的键，但它是同义词，`cc`因为我不像拆分那样经常使用它，所以我可以覆盖它。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2008-10-26T03:54:07.310

此映射将分解您拥有的任何单行函数。只需将光标放在行上并在正常模式下按“g”：

```
:map g ^f{malr<CR>`a%hr<CR>`a 
```

这假设您在左大括号之后有一个空格，在右大括号之前有一个空格。看看这是否适合你。

# ruby-on-rails - 如何解释内存使用数据？

> ID：237405
> 
> 赞同：4
> 
> 时间：2008-10-26T02:27:30.073
> 
> 标签：ruby-on-rails, memory-management, vps

有人可以用实际的方式解释这一点吗？示例表示一个使用 Nginx 和 3 个 Mongrel 集群的低流量 Rails 站点的使用情况。我问是因为我的目标是了解页面缓存，想知道这些数字是否对该过程有重要意义。谢谢你。很棒的网站！

```
me@vps:~$ free -m
                   total       used       free     shared    buffers     cached
Mem:           512        506            6             0          15           103
-/+ buffers/cache:       387        124
Swap:         1023        113        910 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-26T10:42:15.507

物理内存全部用完。为什么？因为它在那里，所以系统应该使用它。

您还会注意到系统正在使用 113M 的交换空间。坏的？好的？这取决于。

另请参阅有 103M 的缓存磁盘；这意味着系统已经决定最好缓存 103M 的磁盘并将这 113M 换出；也许您有一些进程正在使用未使用的内存，因此被分页到磁盘。

正如另一张海报所说，您应该使用其他工具来查看发生了什么：

1.  您的看法：网站在您使用时是否正常运行？
2.  基准测试：您的客户看到的响应时间是多少？
3.  更细粒度的诊断：
    1.  顶部：您可以实时查看哪些进程正在使用内存和 CPU
    2.  vmstat：它产生这种输出：

```
alex@armitage:~$ vmstat 1
procs -----------memory---------- ---swap-- -----io---- -system-- ----cpu-- --
 rb swpd 免费 buff 缓存 si so bi bo in cs us sy id wa
 2 1 71184 156520 92524 316488 1 5 12 23 362 250 13 6 80 1
 0 0 71184 156340 92528 316508 0 0 0 1 291 608 10 1 89 0
 0 0 71184 156364 92528 316508 0 0 0 0 308 674 9 2 89 0
 0 0 71184 156364 92532 316504 0 0 0 72 295 723 9 0 91 0
 1 0 71184 150892 92532 316508 0 0 0 0 370 722 38 0 62 0
 0 0 71184 163060 92532 316508 0 0 0 0 303 611 17 2 81 0

```

这将向您显示交换是否对您造成伤害（si 上的高数字，所以）并且更容易看到随时间变化的性能统计数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T04:03:29.053

通过我的阅读，您几乎使用了所有内存，有 6 M 可用空间，并且将进入大约 10% 的交换空间。一个更有用的工具是使用 top 或 ps 来查看每个单独的 mongrel 在 RAM 中使用了多少。因为您要进行交换，所以您可能会遇到更多的减速。您可能会发现只有 2 个 mongrel 而不是 3 个实际上可能响应更快，因为它可能不会进入交换内存。

页面缓存肯定会在响应时间上有所帮助，所以如果您的页面是可缓存的（例如，它们没有个人用户独有的内容），我会说一定要检查一下

# git - 将现有的 Git 存储库推送到 Github 只会发送大约一半的提交？

> ID：237408
> 
> 赞同：9
> 
> 时间：2008-10-26T02:31:10.300
> 
> 标签：git, version-control, github

我有一个本地 Git 存储库，我已经在其中开发了几天：到目前为止，它有 18 个提交。今晚，我创建了一个私人 Github 存储库，我希望将其推送到；然而，当我这样做时，它最终只将 18 个提交中的 8 个推送到 Github。我删除了 Github repo 并重试，结果相同。

关于为什么会发生这种情况的任何想法？我以前做过这个程序，但没有成功几次，所以我有点难过。

**更新**：这个 repo 中只有 master 分支，并且一直存在。只是为了解决一些已发布的答案......

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-11-09T20:13:26.857

我查看了有问题的存储库，这是发生了什么：

*   在某些时候，rpj 执行了`git checkout [commit id]`. 这将 HEAD 指向一个松散的提交，而不是一个公认的分支。我相信这就是 CesarB 所指的“悬空 HEAD”问题。
*   Not realizing this problem, he went on making changing and committing them, which bumped HEAD up every time. However, HEAD was just pointing at a dangling chain of commits, not at a recognized branch.
*   When he went to push his changes, git pushed everything up to the top of master, which was only about halfway through the current tree he was on.
*   Confusion ensued

This diagram should make it more clear:

```
 -- D -- E -- F
                /             ^
   A -- B -- C -              |
   ^         ^               HEAD
   |         |
 remote    master 
```

When he tried to push his changes, only `A` through `C` were pushed and `remote` moved up to `C`. He couldn't get commits `D` through `F` to push because they aren't referenced by a known branch.

Here's what you see when you're in this state:

```
$ git branch
* (no branch)
master 
```

The solution is to move `master` up to `F` in the dangling chain of commits. Here's how I did it.

*   Create a legitimate branch for the current state:

    `git checkout -b tmp`

    *   The `tmp` branch is now pointing at commit `F` in the diagram above
*   Fast-forward `master` to `tmp`

    `git checkout master`

    `git merge tmp`

    *   `master` is now pointing at commit `F`.
*   Throw away your temporary branch

    `git branch -d tmp`

*   You can happily push to the remote repository and it should send all of your changes.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-09T21:25:14.963

From Git 1.7.3 onwards, you can do this with one simple command:

```
git checkout -B master 
```

The `-b` switch means “create branch here before checking it out” and `-B` is the unconditional version of that, “even if the branch already exists – in that case, move it here before checking it out”.

* * *

A very simple approach for fixing this sort of problem is to just delete the `master` branch and recreate it. After all, branches in git are merely names for commits and the `master` branch is nothing special.

So assuming that the current commit is the one you want `master` to be, you simply do

```
git branch -D master 
```

to delete the existing `master` branch, then do

```
git checkout -b master 
```

to a) create a new branch called `master` that points to the current commit and b) update `HEAD` to point to the `master` branch. After that, `HEAD` will be attached to `master` and therefore `master` will move forward whenever you commit.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-26T03:57:07.070

检查您是否推送了正确的分支，并且这些分支实际上具有您认为它们具有的内容。特别是，检查您是否没有分离的 HEAD，如果不是故意这样做可能会非常混乱。

最简单的检查方法是使用`gitk --all`，它以图形方式显示所有分支、HEAD 等。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-26T02:35:27.157

我想我要做的第一件事是`git fsck`在您的本地存储库上运行，以确保一切正常。

我以前从未见过这个问题，我想不出可能出了什么问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-09T20:17:25.367

I don't have the reputation to comment directly on CesarB's earlier answer, but `gitk --all` doesn't work in this case because it only lists out known branches.

`gitk HEAD` shows this problem, but it's not entirely clear. The smoking gun is that `master` shows up down the commit tree rather than at the most recent commit.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-26T21:26:15.830

因此，事实证明： .git/refs/heads/master 中的提交哈希不正确， .git/logs/refs/heads/master 中的信息不完整；我的意思是它只包含在 .git/refs/heads/master 中指定的提交哈希。

一旦我（手动）修复了这些文件，并将它们推回 Github，一切就又恢复了。我仍然**不知道**在这种状态下发生了什么，但我很高兴我至少找到了解决办法。

如果有人想知道：修复 .git/refs/heads/master，我只是用最新的提交哈希 (HEAD) 替换了该文件的内容，修复 .git/logs/refs/heads/master，我只是将 .git/logs/HEAD 的内容复制到 .git/logs/refs/heads/master 中。简单的...不是。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-30T15:38:37.287

I've had this same problem twice, and finally figured out what I was doing that was causing it. In the process of editing an old commit with `git rebase -i`, instead of calling `git commit --amend`, I was calling `git commit -a` by force of habit, immediately followed by `git rebase --continue`, of course. Someone else might be able to explain what's going on behind the scenes, but it seems that the result is the detached HEAD problem.

# windows - 为什么有些安装程序需要在运行程序之前重新启动计算机？

> ID：237414
> 
> 赞同：9
> 
> 时间：2008-10-26T02:41:39.687
> 
> 标签：windows, installation, reboot

我对部署桌面应用程序还很陌生，所以这是我第一次为我的软件构建安装程序。目前，我在安装后第一次运行我的软件时，它会崩溃。之后，它运行良好。我仍在调试此问题，但我注意到在安装后和运行软件之前立即重新启动似乎可以解决此崩溃问题。

一些安装程序要求您在运行软件之前重新启动的常见原因是什么？

另外，为什么有些安装程序需要在完成安装之前重新启动？

提前致谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-26T02:45:19.633

通常，安装和运行之间的重新启动是因为您要替换锁定的系统 DLL。安装程序会设置一个运行一次的注册表项，在引导期间复制 DLL，然后再被 Windows 锁定，然后您的应用程序可以使用您设置的新 DLL。

一般来说，这是非常不鼓励的。除了 Windows 本身之外，应该没有任何理由在安装后需要重新启动。

我建议返回调试器以了解有关应用程序崩溃原因的更多详细信息。希望您的代码中有足够的跟踪可用以允许这种类型的调试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T02:44:35.580

通常，仅当安装程序需要替换操作系统当前正在使用（并锁定）的文件时，才需要重新启动。有时安装程序会在重启以防万一时出错，但这比以前少了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-27T02:05:32.973

我们有一个我维护的安装程序案例，仅由于 UAC 和特权提升，我们需要强制重新启动 vista。设置完成后，我们需要触发一个程序作为*当前*用户上下文，而不是提升的 Vista 上下文。

在您的情况下，我怀疑某些文件没有正确注册，您只需要坚持调试；）

# linq - LINQ to SQL -

> ID：237415
> 
> 赞同：5
> 
> 时间：2008-10-26T02:41:46.800
> 
> 标签：linq, linq-to-sql

我正在尝试使用 LINQ 将记录插入到子表中，并且收到“指定的强制转换无效”错误，该错误与所涉及的键有关。堆栈跟踪是：

> 消息：指定的强制转换无效。
> 
> 类型：System.InvalidCastException 源：System.Data.Linq TargetSite：布尔型 TryCreateKeyFromValues(System.Object[], V ByRef) HelpLink：null 堆栈：在 System.Data.Linq.IdentityManager.StandardIdentityManager.SingleKeyManager`2.TryCreateKeyFromValues(Object[] values, V& v) at System.Data.Linq.IdentityManager.StandardIdentityManager.IdentityCache`2.Find(Object[] keyValues) at System.Data.Linq.IdentityManager.StandardIdentityManager.Find(MetaType type, Object[] keyValues) at System.Data.Linq.CommonDataServices.GetCachedObject(MetaType type, Object[] keyValues) at System.Data.Linq.ChangeProcessor.GetOtherItem(MetaAssociation assoc, Object instance) 在 System.Data.Linq.ChangeProcessor.BuildEdgeMaps() 在 System.Data.Linq.ChangeProcessor.SubmitChanges(ConflictMode failureMode) 在 System.Data.Linq.DataContext .SubmitChanges(ConflictMode failureMode) 在 System.Data.Linq.DataContext.SubmitChanges()
> 
> （……）

以下代码引发了此错误：

```
 ResponseDataContext db = new ResponseDataContext(m_ConnectionString);
 CodebookVersion codebookVersion = db.CodebookVersions.Single(cv => cv.VersionTag == m_CodebookVersionTag);
 ResponseCode rc = new ResponseCode()
    {
       SurveyQuestionName = "Q11",
       Code = 3,
       Description = "Yet another code"
    };
 codebookVersion.ResponseCodes.Add(rc);
 db.SubmitChanges(); //exception gets thrown here 
```

有问题的表在它们两者之间具有 FK 关系。
父表的列称为“id”，是 PK，类型为：INT NOT NULL IDENTITY
子表的列称为“responseCodeTableId”，类型为：INT NOT NULL。

codebookVersion（父类）映射到表 tblResponseCodeTable
responseCode（childClass）映射到表 tblResponseCode

如果我直接执行 SQL，它可以工作。例如

```
INSERT INTO tblResponseCode 
(responseCodeTableId, surveyQuestionName, code, description)
VALUES (13683, 'Q11', 3, 'Yet another code') 
```

对同一类的更新工作正常。例如

```
codebookVersion.ResponseCodes[0].Description = "BlahBlahBlah";
db.SubmitChanges(); //no exception - change is committed to db 
```

我在 .Add() 操作之后检查了变量 rc，它确实收到了正确的 responseCodeTableId，正如我所期望的那样，因为我将它添加到该集合中。

```
tblResponseCodeTable's full definition:
COLUMN_NAME TYPE_NAME
id                  int identity
responseCodeTableId int
surveyQuestionName  nvarchar
code                smallint
description         nvarchar
dtCreate            smalldatetime 
```

dtCreate 的默认值为 GetDate()。

我能想到的唯一有用的信息是没有针对数据库尝试过 SQL，因此 LINQ 在尝试之前就崩溃了（因此错误不是 SqlException）。我已经分析并验证了没有尝试在数据库上执行任何语句。

当您与非 PK 字段有关系时，我已经阅读并看到了问题，但这不适合我的情况。

任何人都可以为我阐明这种情况吗？我在这里错过了什么非常明显的事情？

非常感谢。
保罗普威特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T04:32:23.177

由于没有调用数据库，我认为您必须查看 linq 到 sql 正在使用的映射。协会长什么样？父类和子类都应该有一个关联。看一下两个类之间的 linq to sql 关联。关联应该有一个 ThisKey 属性。我认为，失败的演员试图转换 ThisKey 指向的属性的值。据我所知，当有多个键并且第一个键的类型与 ThisKey 指向的类型不匹配时，可能会出现问题。我不确定 linq 如何确定第一个键是什么。从外观上看，您只有一个键和一个外键，所以这不应该是问题，但是如果您使用它，设计者会很有创意。我几乎猜到了，

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T03:24:45.013

发布父表的架构。

如果你看这里，其他人有你的问题。 [http://forums.microsoft.com/msdn/ShowPost.aspx?PostID=3493504&SiteID=1](http://forums.microsoft.com/msdn/ShowPost.aspx?PostID=3493504&SiteID=1)

Linq2SQL 似乎无法将某些外键映射到某些主键。一个人有一个决议，但我认为你已经映射到一个 IDENTITY 列。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-04T00:00:13.447

这是这个[错误](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=351358)的一个例子吗？如果是这样，现在测试版已经发布，请尝试在 .NET 4.0 中运行您的代码。

如果像我一样，您还没有准备好开始使用测试版，您也许可以解决这个问题。问题似乎是 LINQ 不能正确支持在非主键字段上定义的关系。但是，术语“主键”并不是指在 SQL 表上定义的主键，而是在 LINQ 设计器中定义的主键。

如果将表拖到设计器中，Visual Studio 会自动检查数据库中定义的主键并将相应的类字段标记为“主键”。然而，这些不需要彼此对应。您可以删除 Visual Studio 为您选择的键，然后选择另一个字段（或一组字段）。当然，您需要确保这是合乎逻辑的（您应该在数据库中对您选择的字段有唯一的约束）。

因此，我使用备用键有 2 个相互关联的表/类。父表有 2 个键：定义为 int 的代理主键和定义为字符串的替代自然键。在 LINQ 设计器中，我使用备用键定义了关联，每当尝试更新子对象上的关联字段时，我都会遇到 InvalidCastException。为了解决这个问题，我进入 LINQ 设计器，选择 int，然后将主键属性从 True 更改为 False。然后我选择了字符串，并将它的主键属性设置为 True。重新编译，重新测试，InvalidCastException 消失了。

查看您的屏幕截图，您似乎可以通过将 ResponseCode 上的 LINQ 主键从 ResponseCode.ID 更改为 ResponseCode.ResponseCodeTableID 来解决您的问题

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-16T17:52:50.177

我们有一个类似的问题，由使用非整数键引起。详细信息和修补程序编号在这里：[https ://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=351358](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=351358)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-26T03:38:36.407

是的，我读过那篇文章和其他文章，但似乎总是有人链接到一个具有独特约束的领域。或者在这个人的情况下（听起来和我的一模一样），他没有得到解决方案。

这是父表：

```
tblResponseTable definition (which maps to CodebookVersion)
COLUMN_NAME TYPE_NAME
id  int identity
versionTag  nvarchar
responseVersionTag  nvarchar 
```

versionTag 确实有一个独特的约束，但这在我在 LINQ-to-SQL 的东西中可以看到的任何地方都没有表示 - 而且因为没有任何东西进入数据库......仍然卡住了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-26T02:45:48.243

```
ResponseCode rc = new ResponseCode()
    {
       SurveyQuestionName = "Q11",
       Code = 3,
       Description = "Yet another code"
    }; 
```

和：

```
INSERT INTO tblResponseCode 
(responseCodeTableId, surveyQuestionName, code, description)
VALUES (13683, 'Q11', 3, 'Yet another code') 
```

不一样，你没有传入外键引用。现在，我在 LINQ2SQL 上是个大人物，但我敢打赌 LINQ2SQL 不够聪明，无法为你做到这一点，它希望它作为匿名字典的第一个参数，并试图将字符串转换为整数.

只是一些想法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-26T02:47:07.117

这个块：

```
codebookVersion.ResponseCodes.Add(rc);
db.SubmitChanges(); //exception gets thrown here 
```

您可以尝试`InsertOnSubmit`代替`Add`吗？IE

```
codebookVersion.ResponseCodes.InsertOnSubmit(rc); 
```

如果我没记错的话，我认为`Add`这并不意味着用于插入记录。InsertOnSubmit 是要使用的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-26T03:16:06.217

试图缩小罪魁祸首。

您是否尝试过将匿名字典替换为以下内容：

```
ResponseCode rc = new ResponseCode();

rc.SurveyQuestName = "Q11";
rc.Code = 3;
rc.Description = "Yet Another Code"; 
```

我还没有真正使用 .NET 3.5（日常工作仍然是 2.0），所以我想知道使用匿名字典传递数据是否存在问题（这些案例与 SQL 列不匹配）一）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-18T19:21:22.073

在您的对象图中某处存在转换错误，底层数据模型（或 Linq To SQL 模型）已更改。这通常类似于 NVARCHAR(1) -> CHAR 当它应该是 STRING 时，或类似的东西。

寻找这个错误并不好玩，希望您的对象模型很小。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-03T19:55:41.620

您可能需要检查数据库表中在插入新记录时由 db 服务器设置的任何字段是否反映在 Linq to SQL 图表中。如果您在 Linq to SQL 图上选择一个字段并查看其属性，您将看到一个名为“自动生成值”的字段，如果设置为 true，将确保所有新记录都采用数据库中指定的默认值。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-26T14:10:47.097

迈克，我听到了。但无论我在哪里看，一切看起来都是正确的。我检查并重新检查了 ResponseTableId 是一个 int 并且 Id 是一个 int。它们在设计器中是这样定义的，当我查看生成的代码时，一切似乎都井然有序。

我已经检查了这些关联。他们来了：

```
[Table(Name="dbo.tblResponseCode")]
public partial class ResponseCode : ...
    ...
   [Association(Name="CodebookVersion_tblResponseCode", Storage="_CodebookVersion", ThisKey="ResponseCodeTableId", OtherKey="Id", IsForeignKey=true)]
   public CodebookVersion CodebookVersion
   {
      ...
   }

[Table(Name="dbo.tblResponseCodeTable")]
    public partial class CodebookVersion : ...
    ...
   [Association(Name="CodebookVersion_tblResponseCode", Storage="_ResponseCodes", ThisKey="Id", OtherKey="ResponseCodeTableId")]
   public EntitySet<ResponseCode> ResponseCodes
   {
      ...
   } 
```

以及该关联的屏幕截图，以防万一：
![设计师](https://test.cmiresearch.com/images/designer.gif)

还有什么想法吗？

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-26T14:59:43.053

```
ResponseCode rc = new ResponseCode()
{
   CodebookVersion = codebookVersion,
   SurveyQuestionName = "Q11",
   Code = 3,
   Description = "Yet another code"
};
db.ResponseCodes.InsertOnSubmit(rc);
db.SubmitChanges(); 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-23T23:23:18.083

我遇到了一个非常相似的问题。我会把你链接到我冗长的帖子：[http ://forums.asp.net/p/1223080/2763049.aspx](http://forums.asp.net/p/1223080/2763049.aspx)

我也会提供一个解决方案，只是一个猜测......

```
 ResponseDataContext db = new ResponseDataContext(m_ConnectionString);
    CodebookVersion codebookVersion = db.CodebookVersions.Single(cv => cv.VersionTag == m_CodebookVersionTag); 
    ResponseCode rc = new ResponseCode()
    {   
        ResponseCodeTableId = codebookVersion.Id,   
        SurveyQuestionName = "Q11",   
        Code = 3,   
        Description = "Yet another code"
    };
    db.ResponseCodes.InsertOnSubmit(rc);
    db.SubmitChanges(); 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-03T20:20:22.553

LINQ to SQL 已被弃用，仅供参考 - [http://blogs.msdn.com/adonet/archive/2008/10/29/update-on-linq-to-sql-and-linq-to-entities-roadmap.aspx](http://blogs.msdn.com/adonet/archive/2008/10/29/update-on-linq-to-sql-and-linq-to-entities-roadmap.aspx) .

# jquery - 除了“flora”，在哪里可以找到 JQuery UI 主题？

> ID：237418
> 
> 赞同：3
> 
> 时间：2008-10-26T02:43:19.217
> 
> 标签：jquery, css, themes

是否有 JQuery UI 主题的存储库？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-26T02:57:59.327

啊，有[http://ui.jquery.com/themeroller](http://ui.jquery.com/themeroller)

# ruby-on-rails - Rails 生成器 m.directory 返回无法将 nil 转换为 String

> ID：237423
> 
> 赞同：0
> 
> 时间：2008-10-26T02:44:50.790
> 
> 标签：ruby-on-rails, ruby, generator

我已经编写了这个生成器代码，但是当我在清单中调用 m.directory 时它返回“无法将 nil 转换为字符串”。有谁知道发生了什么？

```
class AuthGenerator < Rails::Generator::NamedBase
  attr_reader :user_class_name
  def initialize(runtime_args, runtime_options={})
    @user_class_name="User"
    @controller_class_name="AccountController"
    @user_class_file_name="#{@user_class_name}.rb"
    @controller_class_file_name="#{@controller_class_name}.rb"
  end

  def manifest
    record do |m|
      m.class_collisions @controller_class_name, @user_class

      puts @user_class_name
      m.directory File.join('app/models', @user_class_name)

    end
  end 
```

结尾

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T16:54:38.890

它在哪里窒息？请发布完整的错误。[您可以在此处](http://api.rubyonrails.org/classes/Rails/Generator/Commands/Create.html#M001866)查看该`directory`方法的来源。

另外，你可能只是想要

```
m.directory File.join('app/models') 
```

为生成的代码创建一个 app/models/user 目录不是标准的——除非你打算使用命名空间，但它看起来不像。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-06T01:24:00.800

您的初始化方法需要调用 super。

# c++ - 您在 C++ 中看到的最酷的元编程示例是什么？

> ID：237425
> 
> 赞同：14
> 
> 时间：2008-10-26T02:45:37.043
> 
> 标签：c++, templates, metaprogramming, template-meta-programming

您在 C++ 中看到的最酷的元编程示例是什么？
您在 C++ 中看到过哪些元编程的实际用途？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-26T03:13:11.370

就个人而言，我认为[Boost.Spirit](http://www.boost.org/doc/libs/release/libs/spirit/doc/html/index.html)是元编程的一个非常了不起的例子。它是一个完整的解析器生成器，可让您使用 C++ 语法表达语法。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-10-26T03:47:48.853

元编程最实际的用途是将运行时错误转化为编译时错误。

示例：让我们调用接口 IFoo。我的一个程序处理了一个 COM 对象，该对象具有多个 IFoo 路径（非常复杂的继承层次结构）。不幸的是，底层的 COM 对象实现没有意识到它们有多个到 IFoo 的路径。他们认为它总是最左边的那个。所以在他们的代码中，下面的模式很常见

```
 void SomeMethod(IFoo* pFoo) {
        CFooImpl *p = (CFooImpl)pFoo;
   } 
```

第二个 IFoo 虽然导致生成的“p”指针完全无效（多重继承很危险）。

The long term solution was to have the COM object owner fix this issue. Short term though I needed to make sure that I always returned the correct IFoo. I could guarantee that I had the appropriate IFoo by using a QI and avoiding any implicit casts to IFoo. So I created a new CComPtr<> implementation and added the following override to the equal method.

```
template <typename T>
CComPtr<T>& operator=(const T* pT)  { 
// CComPTr Assign logic
}
template <>
CComPtr<IFoo> operator=<IFoo>(const IFoo* pT) {
  COMPILE_ERROR();
} 
```

This quickly revealed every single place I implicitly casted to IFoo.

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2011-07-26T12:25:22.003

Not of practical usage (except maybe for compiler testing), but [metatrace](http://gitorious.org/metatrace) is a Whitted-Style (i.e. recursive and deterministic) ray tracer which generates images like those at compilation time:

![metatrace example](https://i.stack.imgur.com/A9USq.png)

Some more complex parts [of the code](http://gitorious.org/metatrace/metatrace/trees/master/src) can be seen in [fixp.hh](http://gitorious.org/metatrace/metatrace/blobs/master/src/fixp.hh), which has an implementation of fixed-point sqrt using the Heron method, or [sphere.hh](http://gitorious.org/metatrace/metatrace/blobs/master/src/sphere.hh) which shows ray/sphere-intersection calculation.

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-10-26T03:52:36.173

[Blitz++](https://github.com/blitzpp/blitz) does some impressive things with templates (for instance, a single readable line of code can be turned into a set of loops over a multidimensional array, automatically optimized for the best traversal order).

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-26T02:54:16.260

最酷的元编程示例：欺骗编译器计算素数列表。不是很实用，但令人印象深刻。

一种实际用途是编译时断言语句，即如果布尔条件不成立，则会导致编译错误。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-10-26T14:09:35.633

[Loki](http://loki-lib.sourceforge.net/) written by [Andrei Alexandrescu](http://en.wikipedia.org/wiki/Andrei_Alexandrescu)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-26T04:27:27.010

I would have to say Boost.Lambda, Boost.Function, and Boost.Bind and the way that they all work seamlessly together. They provide a really slick interface and make functional programming about as easy as possible in a language that wasn't really built for it.

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-26T03:28:45.707

luabind 是一个非常酷的实用示例，一个非常好的绑定 dsl，用于将 C++ 类绑定到 lua

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-10-26T21:44:11.483

[BOOST_FOREACH](http://www.boost.org/doc/libs/release/doc/html/foreach.html)

Static assertion (boosts version [here](http://www.boost.org/doc/libs/release/doc/html/boost_staticassert.html))

(Note: builtin support for range-based for loops and static assertions is introduced in C++11)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-26T05:17:45.363

I posed a question not to long ago: [C++ Runtime Knowledge of Classes](https://stackoverflow.com/questions/77817/c-runtime-knowledge-of-classes "C++ Runtime Knowledge of Classes") and the answer I got back from a StackOverflow user "Denice" was a URL to a website [Meatspace: C++ runtime class registration](http://meat.net/2006/03/cpp-runtime-class-registration/ "Runtime Class Registration").

I think that is a really cool way to use templates and instantiate objects that are all derived from a base class, so that when I have 10 C++ files, they can all just add the AUTO_REGISTER_BASE() at the bottom, and when everything is all done and linked, only those classes/files that made it would be registered, so at runtime you can switch between the different classes that are available, and those that are not available are not registered and thus can't accidently be called.

There are many different OS dependant ways to do event notification (select(), kqueue(), /dev/epoll, Solaris has it's own thing, poll()), and I needed a way to have all of the class files exist in the directory, but depending on what OS the Makefile was run, it would only compile certain ones. I needed a way to know at runtime which ones were available, and have a way for the programmer using the library to select their preference, however if it was unavailable to just use the one that made the most logical sense for the platform (they each have weights assigned to them).

The code above helped me accomplish this goal, with some hefty modifications, but it helped me none-the-less!

# python - python属性和继承

> ID：237432
> 
> 赞同：60
> 
> 时间：2008-10-26T02:49:09.750
> 
> 标签：python, inheritance, properties, polymorphism

我有一个带有属性的基类（get 方法），我想在子类中覆盖该属性。我的第一个想法是这样的：

```
class Foo(object):
    def _get_age(self):
        return 11

    age = property(_get_age)

class Bar(Foo):
    def _get_age(self):
        return 44 
```

这不起作用（子类 bar.age 返回 11）。我找到了一个有效的 lambda 表达式解决方案：

```
age = property(lambda self: self._get_age()) 
```

那么这是使用属性并在子类中覆盖它们的正确解决方案，还是有其他首选方法可以做到这一点？

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-10-26T10:50:15.660

我只是更喜欢重复`property()`以及`@classmethod`在覆盖类方法时重复装饰器。

虽然这看起来非常冗长，但至少对于 Python 标准而言，您可能会注意到：

1）对于只读属性，`property`可以用作装饰器：

```
class Foo(object):
    @property
    def age(self):
        return 11

class Bar(Foo):
    @property
    def age(self):
        return 44 
```

2) 在 Python 2.6 中，[properties 增加了一对方法](http://docs.python.org/library/functions.html#property) `setter`，`deleter`可用于将快捷方式应用于通用属性，该快捷方式已可用于只读属性：

```
class C(object):
    @property
    def x(self):
        return self._x

    @x.setter
    def x(self, value):
        self._x = value 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2013-01-16T00:55:18.477

我不同意选择的答案是允许覆盖属性方法的理想方式。如果您希望 getter 和 setter 被覆盖，那么您可以使用 lambda 提供对 self 的访问，例如`lambda self: self.<property func>`.

这（至少）适用于 Python 2.4 到 3.6 版本。

如果有人知道如何通过使用属性作为装饰器而不是直接调用 property() 来做到这一点，我想听听！

例子：

```
class Foo(object):
    def _get_meow(self):
        return self._meow + ' from a Foo'
    def _set_meow(self, value):
        self._meow = value
    meow = property(fget=lambda self: self._get_meow(),
                    fset=lambda self, value: self._set_meow(value)) 
```

这样，可以轻松执行覆盖：

```
class Bar(Foo):
    def _get_meow(self):
        return super(Bar, self)._get_meow() + ', altered by a Bar' 
```

以便：

```
>>> foo = Foo()
>>> bar = Bar()
>>> foo.meow, bar.meow = "meow", "meow"
>>> foo.meow
"meow from a Foo"
>>> bar.meow
"meow from a Foo, altered by a Bar" 
```

我在[geek at play](http://www.kylev.com/2004/10/13/fun-with-python-properties/ "天哪，它是古老的！")上发现了这一点。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-11-14T22:52:52.063

另一种方法来做到这一点，而无需创建任何额外的类。我添加了一个 set 方法来显示如果你只覆盖两者之一，你会做什么：

```
class Foo(object):
    def _get_age(self):
        return 11

    def _set_age(self, age):
        self._age = age

    age = property(_get_age, _set_age)

class Bar(Foo):
    def _get_age(self):
        return 44

    age = property(_get_age, Foo._set_age) 
```

这是一个非常人为的例子，但你应该明白这个想法。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-26T03:07:11.727

是的，这就是这样做的方法；属性声明在父类的定义执行时执行，这意味着它只能“看到”父类中存在的方法的版本。因此，当您在子类上重新定义这些方法中的一个或多个时，您需要使用子类的方法版本重新声明该属性。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2020-01-04T19:45:14.097

可能的解决方法可能如下所示：

```
class Foo:
    def __init__(self, age):
        self.age = age

    @property
    def age(self):
        print('Foo: getting age')
        return self._age

    @age.setter
    def age(self, value):
        print('Foo: setting age')
        self._age = value

class Bar(Foo):
    def __init__(self, age):
        self.age = age

    @property
    def age(self):
        return super().age

    @age.setter
    def age(self, value):
        super(Bar, Bar).age.__set__(self, value)

if __name__ == '__main__':
    f = Foo(11)
    print(f.age)
    b = Bar(44)
    print(b.age) 
```

它打印

```
Foo: setting age
Foo: getting age
11
Foo: setting age
Foo: getting age
44 
```

从 David Beazley 和 Brian K. Jones 的“Python Cookbook”中得到这个想法。在 Debian GNU/Linux 9.11 (stretch) 上使用 Python 3.5.3

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-26T03:01:04.127

我同意您的解决方案，这似乎是一种即时模板方法。 [本文](http://www.artima.com/forums/flat.jsp?forum=122&thread=153649)处理您的问题并提供准确的解决方案。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-26T03:17:07.573

像这样的东西会起作用

```
class HackedProperty(object):
    def __init__(self, f):
        self.f = f
    def __get__(self, inst, owner):    
        return getattr(inst, self.f.__name__)()

class Foo(object):
    def _get_age(self):
        return 11
    age = HackedProperty(_get_age)

class Bar(Foo):
    def _get_age(self):
        return 44

print Bar().age
print Foo().age 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-05-20T21:11:55.917

与[@mr-b](https://stackoverflow.com/a/14349742/4522780])相同，但带有装饰器。

```
class Foo(object):
    def _get_meow(self):
        return self._meow + ' from a Foo'
    def _set_meow(self, value):
        self._meow = value
    @property
    def meow(self):
        return self._get_meow()
    @meow.setter
    def meow(self, value):
        self._set_meow(value) 
```

这样，可以轻松执行覆盖：

```
class Bar(Foo):
    def _get_meow(self):
        return super(Bar, self)._get_meow() + ', altered by a Bar' 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-06-02T15:52:52.433

我在子类的父类中设置属性时遇到了问题。以下解决方法扩展了父级的属性，但通过直接调用父级的 _set_age 方法来实现。起皱应该总是正确的。虽然它有点 javathonic。

```
import threading

class Foo(object):
    def __init__(self):
        self._age = 0

    def _get_age(self):
        return self._age

    def _set_age(self, age):
        self._age = age

    age = property(_get_age, _set_age)

class ThreadsafeFoo(Foo):

    def __init__(self):
        super(ThreadsafeFoo, self).__init__()
        self.__lock = threading.Lock()
        self.wrinkled = False

    def _get_age(self):
        with self.__lock:
             return super(ThreadsafeFoo, self).age

    def _set_age(self, value):
        with self.__lock:
            self.wrinkled = True if value > 40 else False
            super(ThreadsafeFoo, self)._set_age(value)

    age = property(_get_age, _set_age) 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-05-16T16:29:46.597

我认为[Vladimir Zolotykh](https://stackoverflow.com/users/4422949/vladimir-zolotykh)的[答案](https://stackoverflow.com/questions/237432/python-properties-and-inheritance#answer-59594225)几乎是最佳的。 对于我的理解，一个更好的变体可能是调用超类的构造函数。 导致以下代码：

```
class Foo:
    def __init__(self, age):
        self.age = age

    @property
    def age(self):
        print("Foo: getting age")
        return self._age

    @age.setter
    def age(self, value):
        print("Foo: setting age")
        self._age = value

class Bar(Foo):
    def __init__(self, age):
        super().__init__(age)

if __name__ == "__main__":
    a = Foo(11)
    print(a.age)
    b = Bar(44)
    print(b.age) 
```

使用此解决方案，无需重新实现子类的属性。只需告诉子类，它应该通过使用构造函数表现得像超类。

上面的行导致以下输出

```
Foo: setting age
Foo: getting age
11
Foo: setting age
Foo: getting age
44 
```

用python3。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2019-08-23T03:51:40.017

```
class Foo:
    # Template method
    @property
    def age(self):
        return self.dothis()
    # Hook method of TM is accessor method of property at here
    def dothis(self):
        return 11
class Bar(Foo):
    def dothis(self):
        return 44 
```

与 Nizam Mohamed 相同，仅提及使用模板方法和属性的[样式指南2.13.4](https://google.github.io/styleguide/pyguide.html?showone=Comments#Comments)

# asp.net-mvc - 使用通用通配符重定向到控制器（但使用不同的主控器）

> ID：237440
> 
> 赞同：3
> 
> 时间：2008-10-26T02:57:57.970
> 
> 标签：asp.net-mvc, redirect, routing, master-pages

我有一个问题，我想以不同的方式显示视图（不同的母版页），具体取决于它的来源，但不知道从哪里开始......

我有几条路线可以捕获包含不同结构的各种不同类型的 url。

在下面的代码片段中，我有一个产品路线，然后我有一个合作伙伴站点路线，它也可以转到产品页面，但是假设这个合作伙伴是百事可乐，他们希望他们的品牌在母版页上，而不是我们自己的默认样式。假设我去[products/cola.htm](http://mysite.com/products/cola.htm)。[这应该与Partners/pepsi/products/cola.htm](http://mysite.com/partners/pepsi/products/cola.htm)相同的 url ，并且 PartnerRedirect 将能够通过翻译 url 通配符（在本例中为“products/cola.htm”）基于通配符处理 url ) 到控制器动作中，并转发用户，（但只需更改视图中的母版页）。

```
routes.MapRoute(
    "Product",
    "products/{product}.htm",
    new { controller = "Product", action = "ShowProduct" }
);

routes.MapRoute(
    "ProductReview",
    "products/{product}/reviews.htm",
    new { controller = "Product", action = "ShowProductReview" }
);

routes.MapRoute(
    "Partner",
    "partners/{partner}/{*wildcard}",
    new { controller = "Partners", action = "PartnerRedirect" }
); 
```

这可能吗？如果是这样，怎么办？

提前谢谢了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-27T03:42:26.943

在您的合作伙伴控制器中，您为什么不设置一个 cookie 来指示您要显示哪个合作伙伴，然后重定向到路由的通配符部分。这样，您可以为所有后续页面视图显示相同的合作伙伴布局。

我不知道这是否是您正在寻找的，但它可能是一种选择。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-12T10:33:43.963

我有同样的问题

```
public class FriViewPage : ViewPage
{
    public override string MasterPageFile
    {
        get
        {
            return "~/Views/Shared/Site.Master"; // base.MasterPageFile;
        }
        set
        {
            if (ViewData["agent"].ToString() == "steve")
                base.MasterPageFile = "~/Views/Shared/Site.Master";
            else
                base.MasterPageFile = "~/Views/Shared/Site2.Master";
        }
    }
} 
```

然后只需确保所有视图都继承自 FriViewPage 而不是 ViewPage

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-27T08:57:40.707

这可能是魔鬼的工作，但您可以在合作伙伴视图的代码隐藏中放置一些代码来查看 URL，然后以编程方式在其中设置母版页？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-27T14:15:24.420

我不确定如何以编程方式更改母版页，因为我从未这样做过，但我确信这是可能的（它可能只是 Page 上的一个属性）。

这可能值得作为另一个问题提出。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-12T10:35:06.817

Acutally MasterPageFile getter 似乎永远不会被调用

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-13T02:49:51.377

您可以通过在呈现之前修改 ViewResult 来更改 MasterPage。例如，一个控制器动作可以做：

```
public ActionResult TestMP(int? id)
{
    ViewData["Title"] = "MasterPage Test Page";
    ViewData["Message"] = "Welcome to ASP.NET MVC!";
    ViewResult result = View("Index");
    if (id.HasValue)
    {
        result.MasterName = "Site2";
    }
    return result;
} 
```

您可以使用操作过滤器来完成同样的事情，以获得更通用的解决方案。

# java - 在Java中做'is'的最简单方法是什么？

> ID：237464
> 
> 赞同：6
> 
> 时间：2008-10-26T03:18:15.153
> 
> 标签：java, typechecking

许多语言都可以检查对象是否属于某种类型（包括父子类），使用“is”实现并像这样使用：

```
if(obj is MyType) 
```

或者稍微繁琐一点，您可以在其他语言中使用“as”关键字进行软类型转换并查看结果是否为空。

我已经有好几年没用过 Java 了，现在我正在恢复使用它的速度，但是 Java 肯定有一种方法可以轻松地做到这一点，而无需深入研究反射 API？

提前感谢您的回答。我已经在这里和其他地方进行了搜索，但是所涉及的关键字非常通用，即使我确定这有一个简单的答案，谷歌搜索也很困难。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-26T03:19:11.703

```
if (objectReference instanceof type){
    //Your code goes here
} 
```

更多信息[在这里](http://www.java2s.com/Tutorial/Java/0060__Operators/TheinstanceofKeyword.htm)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-26T13:24:03.243

您只能`instanceof`与类文字一起使用：即：

```
Class type = String.class;

if (myObj instanceof String) // will compile

if (myObj instanceof type) //will not compile 
```

另一种方法是使用该方法`Class.isInstance`

```
if (type.isInstance(myObj)) // will compile 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-26T03:22:53.660

`obj instanceof TargetType`返回 true 以防万一`TargetType`在包含 的类型层次结构中`obj`。

参见[Sun 的教程](http://java.sun.com/docs/books/tutorial/java/nutsandbolts/op2.html)

# windows - 与 Windows XP/win32 进行串行通信的基本示例

> ID：237487
> 
> 赞同：8
> 
> 时间：2008-10-26T03:39:35.873
> 
> 标签：windows, winapi, serial-port

我正在使用需要通过串行通信的外围设备。我可以使用超级终端向它发送命令，但现在我需要编写程序让我在没有超级终端的情况下执行此操作。有人可以将我指向一个网站和/或向我展示一个示例 hello world 程序来帮助我入门吗？我搜索了许多网站，这些网站给了我不可编译的/古老的 VC6 代码。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-26T03:41:18.740

为了与串行端口连接，您打开一个具有特殊文件名“COM1”到“COM9”之一的文件。对于编号较大的串口，特殊文件名以\\?\开头，在C/C++代码中必须转义为“\\\\?\\COM10”等。

[http://msdn.microsoft.com/en-us/library/ms810467.aspx](http://msdn.microsoft.com/en-us/library/ms810467.aspx)有一个关于使用串口的非常好的教程。请注意，您应该使用 Windows 文件 I/O 函数，例如`CreateFile()`、`ReadFile()`和`WriteFile()`. 我不确定是否可以使用标准 I/O 函数，例如`fopen()`、`fread()`和`fwrite()`.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-26T03:47:04.970

Microsoft 提供了一篇文章，其中包含描述如何在 Win32 下执行此操作[的示例代码。](http://msdn.microsoft.com/en-us/library/ms810467.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-26T05:46:22.467

[提升：asio](http://www.boost.org/doc/libs/1_36_0/doc/html/boost_asio/reference.html)可能会提供帮助，因为最近添加了串行设备。

公平的警告；串口文档很*轻*，大概是因为它很新（它是在 asio 1.1.1 中添加的，它包含在 boost 1.36 中）。

但是，恕我直言，通过 asio 工作是比使用原始 Win32 API 更好的解决方案。为什么？它将更易于阅读和维护（它是更高级别的 API），并且它是跨平台的（除非您需要指定特定于操作系统的设备名称）。

[Boost - 用户](http://www.nabble.com/Boost---Users-f14206.html)和asio.user邮件列表非常活跃和友好，如果您遇到[困难](http://dir.gmane.org/gmane.comp.lib.boost.asio.user)应该能够帮助您。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T11:46:55.463

如果使用 .NET 2.0，请参阅 System.IO.Ports，[这篇文章](http://msmvps.com/blogs/coad/archive/2005/03/23/SerialPort-_2800_RS_2D00_232-Serial-COM-Port_2900_-in-C_2300_-.NET.aspx)应该会有所帮助。如果直接Win32，那么[亚当的答案](https://stackoverflow.com/questions/237487/serial-communication-with-windows-xp-win32#237491)是最好的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-26T03:51:51.480

如果您发现 VC6 太古老，我相信您也会发现大量 C# 示例代码。我认为还有一堆“免费”的串行/COM 端口包装器，但我只是在编写 RS232 设备控制器软件时自己编写的。

谷歌 C# 和串口或 rs232

我得到了这些：

[http://msdn.microsoft.com/en-us/library/system.io.ports.serialport.aspx](http://msdn.microsoft.com/en-us/library/system.io.ports.serialport.aspx)

[http://msmvps.com/blogs/coad/archive/2005/03/23/SerialPort-_2800_RS_2D00_232-Serial-COM-Port_2900_-in-C_2300_-.NET.aspx](http://msmvps.com/blogs/coad/archive/2005/03/23/SerialPort-_2800_RS_2D00_232-Serial-COM-Port_2900_-in-C_2300_-.NET.aspx)

使用谷歌搜索找到合适的代码应该没有问题。

# linux - 您如何处理 apache 中共享服务器的带宽计费？

> ID：237502
> 
> 赞同：3
> 
> 时间：2008-10-26T03:48:54.107
> 
> 标签：linux, apache, sysadmin, bandwidth

您有哪些解决方案可以在 apache 的共享环境中为您的虚拟主机处理带宽计费？如果您使用日志解析，当日志变得非常大时，您的解决方案是否可以很好地扩展？有人为此使用任何类型的模块吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T06:39:53.310

Apache 1.x 和 2.x 存在某些模块，它们允许您设置传输量的最大值，其中大多数使用 Apache 生成的记分板文件进行跟踪（当 mod_status 启用并启用 ExtendedStatus 时）。我在寻找时仍然收藏的一个是[mod_curb](http://www.steve.org.uk/Software/mod_curb/ "mod_curb")，但它并不完整，目前看来只能在服务器范围内工作，而不适用于单个虚拟主机。

Apache 模块可以设置为出站过滤器，因此您可以编写一个位于链末端的装扮模块，并使用 APR 提供的数据将所有传出数据包相加，然后将其添加到计数器中那个特定的域/子域。之后，您可以选择如何处理数据。

对于具体示例，请查看 Apache 提供的 mod_deflate，了解它如何位于链的末端并压缩除服务器发送的标头之外的所有内容。这应该给你一个好的开始。

至于基于日志的处理，存在的日志越多，它的速度就越慢。这只是野兽的本性。当我们使用基于日志的解决方案时，我们有一个每 15 分钟运行一次的自定义 perl 脚本。最终解析需要超过 15 分钟，而且由于我们在一段时间后有适当的锁定，这些日志处理 perl 脚本中的多个现在正在运行，所有这些都在相互等待。我们最终通过一个简单的 tail -F 调用重写了它，然后让 perl 解析每一个进来的请求，虽然效率不高，但它确实有效。这样做的好处是，我们现在能够近乎实时地更新流量统计数据，以便客户端在超出限制时尽快更新。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T07:30:28.653

你可以走穷人的路线，使用 Webalizer 或 Awstats。这两个都可以让您了解基于访问日志的流量，并且可以在每个虚拟主机的基础上完成。就 Awstats 而言，我知道一旦你开始每天处理 10GB 以上的流量，它就会开始消耗资源。你总是可以很好的，但是你会在下周得到你的数据，而不是在你真正需要的时候。在过去使用 Webalizer 时，我不得不使用一些骇客来让它处理大型访问日志，方法是将日志分块成它可以管理的更小的部分。它没有提供与我所做的一样多的有用指标，但我也从来不需要从中保存服务器:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-26T08:17:00.167

如果虚拟主机没有自己的IP，没有比解析日志文件更简单的方法了。只需使用[mod_logio](http://httpd.apache.org/docs/2.2/mod/mod_logio.html)来计算实际传输的字节数。mod_logio 正确处理断开的连接、压缩数据等。您应该能够使用[管道日志实时解析日志](http://httpd.apache.org/docs/2.2/logs.html#piped)。使用[BufferedLogs](http://httpd.apache.org/docs/2.2/mod/mod_log_config.html#bufferedlogs)进一步扩展（只需检查解析器在正确缓冲时是否处理断行）。解析器应该定期（比如每分钟）在某处保存数据，只是避免锁定问题，因为解析不能减慢 httpd 的速度。如果 httpd 连接在服务器状态下花费时间处于 L 状态，那么您太慢了。获得数字后，您可以进一步求和，然后将数据保存到计费系统。

如果您也将计费日志另存为文件，您可以更正并仔细检查实时流量计算。如果您启动 httpd，您最终可能会丢失一些行。但通常丢失几百个请求是可以接受的，因为它在高容量站点上的价值不到几秒钟。

有些模块会尝试处理和限制带宽，例如 mod_cband 和 mod_bw。但是当您在多台机器上拥有相同的虚拟主机时，它们就不起作用了。我想他们会在较小的规模上正常工作。

如果每个虚拟主机都有 IP，则可以尝试基于 IP 的方法，例如将防火墙日志提供给流量计算器。简单的方法是使用[iptables](http://www.google.com/search?q=bandwidth+iptables)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-26T05:58:46.293

虽然我们使用 IIS 而不是 apache，但我们确实使用日志文件分析来进行带宽计费（和带宽分析/分析）。我们使用自定义应用程序以一小时为增量加载日志文件中收集的数据，并根据任何所需的通知或带宽过度使用采取行动。

日志文件加载器作为低优先级进程运行，以免中断服务器的操作。即使在具有大量站点的高使用率服务器上，处理时间也不到 15 分钟，因此我们不认为这种方法的可扩展性是一个问题。

可能有更好的方法可以做到这一点，但这完全可以满足我们的需要。我期待着查看其他回复。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-24T04:10:54.790

那么 mod_cband 会很棒，除了当我使用它时，max_connections（每个客户端组合的整体总值）决定向上爬行，直到它达到我设置的最大值。当它确实达到最高值时，它只会停留在那里，让我的所有客户都收到一个恒定的“503 服务暂时不可用”错误。

例如，我设置“CbandSpeed 1000Mbps 500 1200”，服务器连接在大约 8 小时内爬升到 1200，然后停留在那里。此时，我在 mod_cband 状态窗口中计算远程客户端下的连接总数，我看到大约 50 个。我还使用了 ps aux，我看到大约相同数量（~50）的打开 http 进程，即正常，除了由于 503 错误，根本没有人可以访问该站点。

有什么想法可能是错的，或者可以解决这个问题吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-11-30T23:08:08.910

使用 mod_cband 可以轻松实现。我们重写了模块以修复一些错误，在重新启动时提供真正的冗余并合并 FTP 和邮件统计信息。

[http://www.howtoforge.com/mod_cband_apache2_bandwidth_quota_throttling](http://www.howtoforge.com/mod_cband_apache2_bandwidth_quota_throttling)

# wpf - URI 的 WPF 数据绑定/验证？

> ID：237539
> 
> 赞同：0
> 
> 时间：2008-10-26T04:13:39.953
> 
> 标签：wpf, validation

`Text`我当前的设置将my 的属性绑定`TextBox`到某个`Uri`对象。我很想使用 WPF 的内置验证来检测无效的 URI，然后从那里继续。但这似乎不起作用？

我想如果我输入例如“aaaa”作为 URI，它会抛出异常。因此，触发我当前的设置，它应该检测如下异常：

```
<TextBox Grid.Column="1" Name="txtHouseListFile" DockPanel.Dock="Right" Margin="3">
    <TextBox.Text>
        <Binding Source="{StaticResource Settings}" Path="Default.HouseListFile" Mode="TwoWay">
            <Binding.ValidationRules>
                <ExceptionValidationRule />
            </Binding.ValidationRules>
        </Binding>  
    </TextBox.Text>
</TextBox> 
```

然后我想我可以检查各种验证属性，像这样吗？

```
Validation.GetHasError(this.txtHouseListFile) 
```

但是，这似乎行不通。也许它在尝试转换时不会抛出异常？或者也许我的设置有误？对任何一个的更正都会很棒。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-29T18:43:05.550

您可以尝试创建我们自己的 ValidationRule（继承自 ValidationRule）。在此类中，覆盖 Validate(...) 并尝试创建一个 URI 对象并捕获异常。在 catch 中，只需将 e.Message 设置为异常消息即可。

（我不太确定您的绑定源是什么。它是 URI 对象还是字符串？）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-01T01:36:39.343

好的，我想我知道发生了什么。绑定不知道如何将字符串转换为 URI 对象（因为文本框*Text*属性是字符串）。你需要一个转换器来帮助他。

试试这个：创建一个转换器类（从 IValueConverter 继承）：

*   使用 Uri 构造函数将字符串转换为 Uri
*   将 Uri 转换为字符串（使用多个 getter 之一）

将转换器放入绑定中。然后，converver 将在 Uri 构造函数中抛出异常，而您的 ExceptionValidationRule 将捕获它。

[看这里](http://learnwpf.com/Posts/Post.aspx?postId=05229e33-fcd4-44d5-9982-a002f2250a64)了解如何使用转换器。

# c++ - Getting base name of the source file at compile time

> ID：237542
> 
> 赞同：16
> 
> 时间：2008-10-26T04:15:34.833
> 
> 标签：c++, c, makefile, macros, compiler-construction

I'm using GCC; __FILE__ returns the current source file's entire path and name: `/path/to/file.cpp`. Is there a way to get just the file's name `file.cpp` (without its path) at compile time? Is it possible to do this in a portable way? Can template meta programming be applied to strings?

I am using this in an error logging macro. I really do not want my source's full path making its way into the executable.

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-26T05:53:40.377

If you're using a `make` program, you should be able to munge the filename beforehand and pass it as a macro to `gcc` to be used in your program. For example, in your `makefile`, change the line:

```
file.o: file.c
    gcc -c -o file.o src/file.c 
```

to:

```
file.o: src/file.c
    gcc "-DMYFILE=\"`basename $<`\"" -c -o file.o src/file.c 
```

This will allow you to use `MYFILE` in your code instead of `__FILE__`.

The use of `basename` of the source file `$<` means you can use it in generalized rules such as `.c.o`. The following code illustrates how it works. First, a `makefile`:

```
mainprog: main.o makefile
    gcc -o mainprog main.o

main.o: src/main.c makefile
    gcc "-DMYFILE=\"`basename $<`\"" -c -o main.o src/main.c 
```

Then a file in a subdirectory, `src/main.c`:

```
#include <stdio.h>

int main (int argc, char *argv[]) {
    printf ("file = %s\n", MYFILE);
    return 0;
} 
```

Finally, a transcript showing it running:

```
pax:~$ mainprog
file = main.c 
```

Note the `file =` line which contains *only* the base name of the file, not the directory name as well.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-26T04:29:54.820

I don't know of a direct way. You could use:

```
#line 1 "filename.c" 
```

at the top of the source file to set the value of `__FILE__`, but I'm not sure that that's much better than hard coding it. or just using a #define to create your own macro.

Another option might be to pass the name from your Makefile using -D and $(shell basename $<)

Edit: If you use a #define or the -D option, you should create your own new name and not try to redefine `__FILE__`.

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-26T20:02:37.947

Consider this simple source code:

```
#include <stdio.h>
int main(void)
{
    puts(__FILE__);
    return(0);
} 
```

On Solaris, with GCC 4.3.1, if I compile this using:

```
gcc -o x x.c && ./x 
```

the output is '`x.c`' If I compile it using:

```
gcc -o x $PWD/x.c && ./x 
```

then __FILE__ maps to the full path ('`/work1/jleffler/tmp/x.c`'). If I compile it using:

```
gcc -o x ../tmp/x.c && ./x 
```

then __FILE__ maps to '`../tmp/x.c`'.

So, basically, __FILE__ is the pathname of the source file. If you build with the name you want to see in the object, all is well.

If that is impossible (for whatever reason), then you will have to get into the fixes suggested by other people.

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-03-04T01:48:55.097

Since you tagged CMake, here's a neat solution to add to your CMakeLists.txt: (copied from [http://www.cmake.org/pipermail/cmake/2011-December/048281.html](http://www.cmake.org/pipermail/cmake/2011-December/048281.html) ). (Note : some compilers don't support per-file COMPILE_DEFINITIONS ! but it works with gcc)

```
set(SRCS a/a.cpp b/b.cpp c/c.cpp d/d.cpp)

foreach(f IN LISTS SRCS)
 get_filename_component(b ${f} NAME)
 set_source_files_properties(${f} PROPERTIES
  COMPILE_DEFINITIONS "MYSRCNAME=${b}")
endforeach()

add_executable(foo ${SRCS}) 
```

Note : For my application I needed to escape the filename string like this:

```
COMPILE_DEFINITIONS "MYSRCNAME=\"${b}\"") 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-26T05:52:26.463

What does your error logging macro do? I would presume at some point the macro eventually calls a function of some kind in order to do the logging, why not have the called function strip off the path component at runtime?

```
#define LOG(message) _log(__FILE__, message)

void _log(file, message)
{
  #ifndef DEBUG
  strippath(file); // in some suitable way
  #endif

  cerr << "Log: " << file << ": " << message; // or whatever
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-26T04:25:27.043

You might be able to do it with template metaprogramming, but there's no built-in way to do it.

EDIT: Hm, correction. According to [one page I just saw](http://coding.derkeiler.com/Archive/C_CPP/comp.lang.c/2006-02/msg00698.html), GCC uses the path that it's given for the file. If it's given the full name, it'll embed it; if it's only given a relative one, it'll only embed that. I haven't tried it myself though.

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-26T20:09:46.047

Taking the idea from Glomek, it can be automated like this:

Source file x.c

```
#line 1 MY_FILE_NAME
#include <stdio.h>

int main(void)
{
    puts(__FILE__);
    return(0);
} 
```

Compilation line (beware the single quotes outside the double quotes):

```
gcc -DMY_FILE_NAME='"abcd.c"' -o x x.c 
```

The output is '`abcd.c`'.

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-20T16:31:13.300

You can assign `__FILE__` to a string, and then call _splitpath() to rip the pieces out of it. This might be a Windows/MSVC-only solution, honestly I don't know.

I know you were looking for a compile-time solution and this is a run-time solution, but I figured since you were using the filename to do (presumably run-time) error logging, this could be a simple straightforward way to get you what you need.

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-01-26T11:05:31.533

It is easy with cmake.

`DefineRelativeFilePaths.cmake`

```
function (cmake_define_relative_file_paths SOURCES)
  foreach (SOURCE IN LISTS SOURCES)
    file (
      RELATIVE_PATH RELATIVE_SOURCE_PATH
      ${PROJECT_SOURCE_DIR} ${SOURCE}
    )

    set_source_files_properties (
      ${SOURCE} PROPERTIES
      COMPILE_DEFINITIONS __RELATIVE_FILE_PATH__="${RELATIVE_SOURCE_PATH}"
    )
  endforeach ()
endfunction () 
```

Somewhere in `CMakeLists.txt`

```
set (SOURCES ${SOURCES}
  "${CMAKE_CURRENT_SOURCE_DIR}/common.c"
  "${CMAKE_CURRENT_SOURCE_DIR}/main.c"
)

include (DefineRelativeFilePaths)
cmake_define_relative_file_paths ("${SOURCES}") 
```

`cmake .. && make clean && make VERBOSE=1`

```
cc ... -D__RELATIVE_FILE_PATH__="src/main.c" ... -c src/main.c 
```

That's it. Now you can make pretty log messages.

```
#define ..._LOG_HEADER(target) \
  fprintf(target, "%s %s:%u - ", __func__, __RELATIVE_FILE_PATH__, __LINE__); 
```

> func src/main.c:22 - my error

PS It is better to declear in `config.h.in` -> `config.h`

```
#ifndef __RELATIVE_FILE_PATH__
#define __RELATIVE_FILE_PATH__ __FILE__
#endif 
```

So your linter wan't provide rain of errors.

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-09-28T18:35:12.280

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-26T16:53:11.763

You can take __FILE__ and the strip off the part of path you don't want (programatically). If basedir satisfies your needs, then fine. Otherwise, get source dir root from your build system, and the rest should be doable.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-02-12T09:24:30.913

Just got the same issue; found a different resolution, just thought I'd share it:

In a header file included in all my other files:

```
static char * file_bname = NULL;
#define __STRIPPED_FILE__   (file_bname ?: (file_bname = basename(__FILE__))) 
```

Hope this is useful to someone else as well :)

# php - 谷歌浏览器和流式 HTTP 连接？

> ID：237553
> 
> 赞同：3
> 
> 时间：2008-10-26T04:22:49.017
> 
> 标签：php, ajax, http, google-chrome, streaming

遇到此金块时，Google chrome 的行为与其他浏览器不同：

```
<?php
while (true) {
    echo "<script type='text/javascript'>\n";
    echo "alert('hello');\n";
    echo "</script>";
    flush();

    sleep(5);
}
?> 
```

在做任何事情之前，它似乎正在等待连接终止。

除了轮询我如何在谷歌浏览器中做类似的事情？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-09-24T03:10:47.133

我有一个类似的问题，并通过在每次刷新之前添加一个 HTML 标记（在我的情况下为 <br />）来解决它。

我的猜测是 Chrome 会等待*正在显示*的元素在触发重新渲染之前关闭。不过，这只是一个猜测。

它似乎不需要 1024 字节——我想当它工作时我会只有不到 512 字节。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-26T08:29:28.283

某些浏览器需要在呈现可用数据之前下载一定数量的字节。我记得上次我尝试做你正在做的事情时，我最终不得不转储 300 个空格以确保浏览器会打扰它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-26T05:30:43.090

我希望我现在可以访问 Chrome 来测试一些想法。您是否尝试过添加一些 HTML`</script>`并查看它是否以增量方式呈现？我想它会，如果是这样，那将证明 Chrome 不想在`<script>`页面加载时在元素中运行 javascript。当然，渲染标记可能会触发您的脚本运行。如果没有，您可以尝试将 javascript 作为外部文件包含在内，看看这是否会影响执行时间。

我认为浏览器通常在开始执行 javascript 时根据规范有一些余地，尤其是在页面加载时。如果没有轮询，可能无法以完全跨浏览器的方式执行此操作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-26T16:50:41.300

**您是否与 Chrome 开发人员交谈过？你打开了一个关于那个的错误吗？**恕我直言，最好的解决方案是让 Chrome 的行为与其他浏览器一样，而不是为其提供解决方法。

好的，实际上您可能需要一个短期的解决方法。但是想象一下，每个浏览器在各个方面的行为都不同，比如 HTTP、HTML、CSS 处理……这将不是一个令人愉快的地方！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-25T16:46:46.510

流正在工作。无眼睑的答案是解决方案。

print "2048 点[BR>\n";

[ = <

顺便说一句，看看用户代理。Safari 也需要很多字节。我认为是 1024。Firefox 不需要那么多字节。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-28T07:48:46.877

```
<?php
$i = 0;
while (true) {
    if($i == 0) {
        echo "<html><body>";
    }
    echo "<script type='text/javascript'>\n";
        echo "alert('hello');\n";
    echo "</script>";
    if($i == 0 ) {
        $padstr = str_pad("",2048,"&nbsp;");
        echo $padstr;
        echo "</body></html>";
    }
    flush();

    sleep(5);
    $i = $i + 1;
}
?> 
```

第一次发送至少 2048 字节的数据。那么它会正常工作。并确保将脚本标签保留在正文标签中。奇怪的是，在我的情况下，如果我添加 1024 个字节，它就起作用了。希望这可以帮助你

上述程序在谷歌浏览器中运行良好。

# java - Java Vector Field（私人成员）累加器不存储我的奶牛！

> ID：237561
> 
> 赞同：1
> 
> 时间：2008-10-26T04:27:52.360
> 
> 标签：java, vector, field

编辑：这段代码很好。我在我的伪代码中不存在的某个地方发现了一个逻辑错误。我将其归咎于我缺乏 Java 经验。

在下面的**伪代码**中，我试图解析显示的 XML。也许是一个愚蠢的例子，但我的代码太大/太具体，任何人都无法从看到它并从发布的答案中学习得到任何真正的价值。所以，这更有趣，希望其他人和我一样可以从答案中学习。

我是 Java 新手，但我是一位经验丰富的 C++ 程序员，这让我相信我的问题在于我对 Java 语言的理解。

问题：当解析器完成时，我的向量充满了未初始化的奶牛。我创建了具有默认容量的奶牛向量（如果它类似于 C++ STL 向量，则不应该影响它的“大小”）。当我在解析后打印出 Cow Vector 的内容时，它给出了正确的 Vector 大小，但所有值似乎从未设置过。

信息：我已经使用其他没有 Vector*字段*的解析器成功完成了此操作，但在这种情况下，我想使用 Vector 来累积 Cow 属性。

MoreInfo：我不能使用泛型（Vector< Cow >）所以请不要指向我那里。:)

提前致谢。

```
<pluralcow>
        <cow>
            <color>black</color>
            <age>1</age>
        </cow>
        <cow>
            <color>brown</color>
            <age>2</age>
        </cow>
        <cow>
            <color>blue</color>
            <age>3</age>
        </cow>
</pluralcow>

public class Handler extends DefaultHandler{
    // vector to store all the cow knowledge
    private Vector  m_CowVec;

    // temp variable to store cow knowledge until
    // we're ready to add it to the vector
    private Cow     m_WorkingCow;

    // flags to indicate when to look at char data
    private boolean m_bColor;
    private boolean m_bAge;

    public void startElement(...tag...)
    {
        if(tag == pluralcow){   // rule: there is only 1 pluralcow tag in the doc
                // I happen to magically know how many cows there are here.             
                m_CowVec = new Vector(numcows);
        }else if(tag == cow ){  // rule: multiple cow tags exist
            m_WorkingCow = new Cow();
        }else if(tag == color){ // rule: single color within cow
            m_bColor = true;
        }else if(tag == age){   // rule: single age within cow
            m_bAge = true;
        }
    }

    public void characters(...chars...)
    {
        if(m_bColor){
            m_WorkingCow.setColor(chars);   
        }else if(m_bAge){
            m_WorkingCow.setAge(chars);
        }
    }

    public void endElement(...tag...)
    {
        if(tag == pluralcow){
            // that's all the cows
        }else if(tag == cow ){
            m_CowVec.addElement(m_WorkingCow);      
        }else if(tag == color){
            m_bColor = false;
        }else if(tag == age){
            m_bAge = false;
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-26T09:11:19.353

当你说Cows未初始化时，String属性是否初始化为null？还是空字符串？

我知道你提到这是伪代码，但我只是想指出一些潜在的问题：

```
public void startElement(...tag...)
    {
        if(tag == pluralcow){   // rule: there is only 1 pluralcow tag in the doc
                // I happen to magically know how many cows there are here.                     
                m_CowVec = new Vector(numcows);
        }else if(tag == cow ){  // rule: multiple cow tags exist
                m_WorkingCow = new Cow();
        }else if(tag == color){ // rule: single color within cow
                m_bColor = true;
        }else if(tag == age){   // rule: single age within cow
                m_bAge = true;
        }
    } 
```

你真的应该在这里使用 tag.equals(...) 而不是 tag == ... 。

```
public void characters(...chars...)
{
    if(m_bColor){
            m_WorkingCow.setColor(chars);   
    }else if(m_bAge){
            m_WorkingCow.setAge(chars);
    }
} 
```

我假设您知道这一点，但实际上这个方法是使用带有开始和结束索引的字符缓冲区调用的。

另请注意，对于单个文本块，可以多次调用 characters(...)，在每次调用中返回小块：http: [//java.sun.com/j2se/1.4.2/docs/api/org/xml /sax/ContentHandler.html#characters(char[],%20int,%20int)](http://java.sun.com/j2se/1.4.2/docs/api/org/xml/sax/ContentHandler.html#characters(char[],%20int,%20int))

> “...SAX 解析器可以在单个块中返回所有连续的字符数据，或者它们可以将其拆分为多个块...”

我怀疑你会在你提供的简单示例中遇到这个问题，但你也提到这是一个更复杂问题的简化版本。如果在您的原始问题中，您的 XML 包含大型文本块，则需要考虑这一点。

最后，正如其他人所提到的，如果可以，最好考虑使用 XML 编组库（例如，JAXB、Castor、JIBX、XMLBeans、XStream 等等）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T05:11:24.690

代码对我来说看起来不错。我说在每个函数的开头设置断点并在调试器中观察它或添加一些打印语句。我的直觉告诉我要么`characters()`没有被调用`setColor()`，要么`setAge()`不能正常工作，但这只是一个猜测。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-26T05:17:34.710

我不得不说我不是这个设计的忠实粉丝。但是，您确定您的角色曾经被调用过吗？（也许一些 system.outs 会有所帮助）。如果它从未被调用，你最终会得到一头未初始化的牛。

另外，我不会尝试像这样自己实现 XML 解析器，因为您需要更加健壮地应对验证问题。

您可以使用 SAX 或 DOM4J，甚至更好的是，使用 Apache digester。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-26T06:55:47.507

此外，如果我有一个模式，我将使用 JaxB 或其他代码生成器来加快 XML 接口代码的开发。代码生成器隐藏了直接使用 SAX 或 DOM4J 的许多复杂性。

# java - java.lang.Exception 与滚动您自己的异常

> ID：237585
> 
> 赞同：26
> 
> 时间：2008-10-26T04:56:56.717
> 
> 标签：java, exception, class, packaging

什么时候你会创建自己的异常类而不是使用 java.lang.Exception？（一直？只有在包外使用？只有在必须包含高级逻辑的情况下？等等......）

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-26T05:00:26.663

我认为您需要问自己一个稍微不同的问题“创建新异常给我或使用我的代码的开发人员带来什么好处？” 实际上，它为您或其他人提供的唯一优势是处理异常的能力。这似乎是一个显而易见的答案，但实际上并非如此。您应该只处理可以合理恢复的异常。如果您抛出的异常是一个真正致命的错误，为什么要给开发人员一个错误处理它的机会？

更深入的讨论：[自定义例外：您应该何时创建它们？](http://blogs.msdn.com/jaredpar/archive/2008/10/20/custom-exceptions-when-should-you-create-them.aspx)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-26T11:24:39.523

原因一：

需要捕捉特定的东西。如果调用代码需要处理特定的异常情况，需要区分自己的Exception，而Java区分不同类型的异常，所以需要自己编写。

基本上，如果有人必须写：

```
catch(ExistingException e) {
  if({condition}) {
    { some stuff here}
  }
  else {
    { different stuff here}
  }
} 
```

你可能想写一个特定的扩展；catch 异常匹配比条件更清楚，恕我直言。

请记住：您的新异常**可以是**RuntimeException 的子类

原因二：

API 整合。如果您编写一个接口并且您有多个实现，那么它们可能会调用不同的 API 并抛出一大堆不同的非运行时异常：

```
interface MyInterface {
  void methodA();
}

class MyImplA {
  void methodA() throws SQLException { ... }
}

class MyImplB {
  void methodA() throws IOException { ... }
} 
```

您真的希望 MyInterface.methodA 抛出 SQLException 和 IOException 吗？也许然后将可能的异常包装在自定义异常中是有意义的。这又可能是一个 RuntimeException。甚至 RuntimeException 本身......

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-26T12:06:47.550

我相信：

```
catch (Exception e) {
   ...
} 
```

... 是应该避免的反模式。您可能希望在应用程序的某处集中广泛捕获，以记录错误并防止整个应用程序终止 - 但将它们分散在任意位置是不好的。

为什么：

```
try {
   if(myShape.isHidden()) {
      throw new Exception();
   }
   // More logic
} catch (Exception e) {
   MyApp.notify("Can't munge a hidden shape");
} 
```

所以你试试这个，由于编码错误，myShape 为空。当运行时尝试取消对 myShape 的引用时，会引发 NullPointerException。此代码报告一个隐藏的形状，它应该报告一个空指针。

要么创建你自己的异常，要么在 API 中找到一个适当的特殊异常。扩展 Exception 或 RuntimeException 并不是很麻烦。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-26T05:01:24.913

当我想以与其他人不同的方式对待我的异常时。如果我想抓住我的并传播其他人的，或者如果我想抓住别人的并传播我的，或者如果我想抓住两者但以不同的方式对待他们，那么我将为我的异常定义一个单独的类。如果我想对它们一视同仁，要么传播两者，要么捕获两者（并且对捕获的异常做同样的事情），我将使用标准类。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-26T07:36:27.173

如果语言运行时或库存在现有异常，请使用它 ELSE 创建您自己的，做好记录，这应该适用于 99% 的情况。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-26T17:38:33.387

软件捕捉意义。

几乎没有理由抛出现有异常：JVM 已经为您做到了。您的异常版本并不准确，并且抛出“异常”也没有意义。

`DataFormatException`由于您编写的解析算法，您可能有一个。然而，这种情况很少见。

当您的程序遇到异常情况时，它几乎总是您的程序独有的。为什么将您的异常情况强制适应现有异常？如果它对您的程序来说是独一无二的，那么......嗯......它是独一无二的。以这种方式命名。

但是，不要为每个唯一消息提供唯一的异常类。一个异常*类*可以有许多变体消息和支持细节。

翻译成 Java 的 Python 经验法则是在包级别定义任何唯一的异常。[在 Python 中，他们建议在“模块”级别出现异常，这并不能准确地转换为 Java。]

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-26T06:11:49.403

总是从使用常见的异常类开始，然后当需要特别处理它时，改变它。

1.  第一次创建方法时，让异常通过。

2.  如果有必须处理的异常，则可以只在 throws 中定义这些异常，或者包装到某个运行时异常或包装自己的 throws 异常。在许多情况下，我更喜欢运行时异常。除非从 API 的角度来看需要，否则应避免定义 throws 定义。

3.  稍后，当某个调用者似乎需要对异常进行特定处理时，请返回并为其创建新异常。

关键是在知道需要什么之前避免做额外的工作。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-26T14:50:18.313

如果某个对象/类/方法有问题，我无法想象专门抛出 java.lang.Exception 。它太通用了——如果你不打算创建自己的异常类，在我看来，API 中至少应该有一个更具体的异常类型。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-26T11:27:39.470

当异常与 API 相关时，我会使用 Java API 中的异常。但是，如果出现我自己的 API 独有的异常情况，那么我将为它创建一个异常。例如，如果我有一个 Range 对象，它具有两个属性 min 和 max 以及不变量 min <= max，那么我将创建一个异常 InvalidRangeException。

当我编写代码时，这很有帮助，因为我知道异常是否源于我违反了我自己的条件之一或它来自 Java API 的某些东西。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-10-26T05:16:07.987

在大多数情况下，创建自己的异常类是没有意义的。

新手程序员倾向于创建自己的异常类，以便他们可以使用更能指示错误类型的名称。因此，您会发现 FTPInitializationException、DAOFactoryException 等类，即使此类异常的处理方式与标准异常的处理方式不同。这显然是一种应该避免的反模式。

# sql - SQL Server 2005：按视图包装表 - 优点和缺点

> ID：237601
> 
> 赞同：8
> 
> 时间：2008-10-26T05:14:33.857
> 
> 标签：sql, sql-server, database, refactoring

## 背景

我正在研究一个遗留的小型企业自动化系统（库存、销售、采购等），它有一个由 SQL Server 2005 托管的数据库和一堆客户端应用程序。主客户端（所有用户使用）是一个 MS Access 2003 应用程序 (ADP)，其他客户端包括各种 VB/VBA 应用程序，如 Excel 插件和命令行实用程序。

除了大约 60 个表（大部分在 3NF 中）之外，该数据库还包含大约 200 个视图、大约 170 个 UDF（主要是标量和表值内联的 UDF）和大约 50 个存储过程。正如您可能已经猜到的那样，所谓的“业务逻辑”的一部分被封装在大量 T-SQL 代码中（因此被所有客户端共享）。

总的来说，系统的代码（包括 T-SQL 代码）组织得不是很好，可以说是非常抗重构。特别是，大多数表的模式都需要各种重构，小（如列重命名）和大（如规范化）。

FWIW，我有相当长且体面的应用程序开发经验（C/C++、Java、VB 等等），但我不是 DBA。所以，如果这个问题对你来说看起来很傻，现在你知道为什么会这样了。:-)

## 问题

在考虑重构所有这些混乱（当然是以和平方式）时，我提出了以下想法：

1.  对于每个表，创建一个“包装器”视图，其中 (a) 包含该表的所有列；(b) 在某些情况下，有一些基于表的“真实”列的额外计算列。

    这种附加计算列的一个典型（尽管很简单）示例是从产品的正常价格和折扣得出的产品销售价格。

2.  重新组织所有代码（T-SQL 和 VB/VBA 客户端代码），以便只有“包装器”视图直接引用表。

    因此，例如，即使应用程序或存储过程需要从表中插入/更新/删除记录，他们也会针对相应的“表包装器”视图执行此操作，而不是直接针对表。

所以，本质上这是关于**通过视图将所有表与系统的其余部分隔离开来**。

这种方法似乎提供了很多好处，尤其是从可维护性的角度来看。例如：

*   当要重命名表列时，无需一次重写所有受影响的客户端代码即可完成。

*   实现派生属性更容易（比使用计算列更容易）。

*   您可以有效地为列名设置别名。

显然，所有这些好处都必须付出一定的代价，但我不确定我是否看到了所有的陷阱。

有人在实践中尝试过这种方法吗？主要的陷阱是什么？

一个明显的缺点是维护“包装”视图与其对应表同步的成本（表中的新列也必须添加到视图中；从表中删除的列也必须从视图中删除；等等.)。但是这个价格对于使整个代码库更具弹性来说似乎很小而且很公平。

有谁知道其他更强大的缺点？

例如，使用所有这些“包装器”视图而不是表很可能会产生一些不利的性能影响，但这种影响是否足以让人担心呢？此外，在使用 ADODB 时，很容易得到一个不可更新的记录集，即使它仅基于几个连接的表；那么，“包装”视图是否会使事情变得更糟？等等等等...

任何评论（尤其是分享的真实经验）将不胜感激。

谢谢！

* * *

PS我踩到了以下讨论“包装器”视图概念的旧文章：

[大视野神话](http://www.craigsmullins.com/cnr_0299b.htm)

文章建议避免上述方法。但是......我真的没有在文章中看到任何反对这个想法的充分理由。恰恰相反，在创建视图的充分理由列表中，几乎每个项目都正是为什么为每个表创建“包装器”视图如此诱人的原因（尤其是在遗留系统中，作为重构过程的一部分） ）。

这篇文章真的很旧（1999 年），所以无论当时的理由是什么，现在都可能不再是好的（反之亦然）。听到最近考虑甚至尝试过这个想法的人使用最新版本的 SQL Server 和 MS Access 会很有趣......

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-26T05:19:07.920

在设计数据库时，我更喜欢以下内容：

*   代码不能直接访问表（但可以从存储过程、视图和函数中访问）
*   包含所有列的每个表的基本视图
*   每个表的扩展视图，包括查找列（类型、状态等）
*   所有更新的存储过程
*   任何复杂查询的功能

这允许 DBA 直接使用表（添加列、清理内容、注入数据等）而不会干扰代码库，并且它将代码库与对表所做的任何更改（临时或其他）隔离开来

以这种方式做事可能会有性能损失，但到目前为止它们并不显着 - 绝缘层的好处已经多次挽救生命

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-26T09:59:17.417

您不会注意到单表视图的任何性能影响；在为使用这些视图的任何代码构建执行计划时，SQL Server 将使用基础表。我建议您对这些视图进行模式绑定，以避免在不更改视图的情况下意外更改基础表（想想可怜的下一个人。）

> 当要重命名表列时

根据我的经验，这种情况很少发生。添加列、删除列、更改索引和更改数据类型是您将运行的常用更改表脚本。

> 实现派生属性更容易（比使用计算列更容易）。

我会对此提出异议。将计算放入列定义和将其放入视图定义有什么区别？此外，您将看到将其移动到视图而不是计算列中的性能损失。唯一真正的优点是在视图中*更改*计算比更改表更容易（由于索引和数据页。）

> 您可以有效地为列名设置别名。

这才是拥有观点的真正原因；别名表和列，并组合多个表。在我过去的几份工作中，最佳实践是在我需要对数据进行非规范化的地方使用视图（如您已经指出的那样，查找等。）

像往常一样，对 DBA 问题最真实的回答是“这取决于” - 取决于您的情况、技能等。在您的情况下，重构“一切”无论如何都会破坏所有应用程序。如果您确实正确修复了基表，则不需要您尝试从视图中获取的间接信息，并且只会为将来的任何更改加倍您的架构维护。我会说跳过包装器视图，修复表和存储过程（它们已经提供了足够的信息隐藏），你会没事的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-26T05:47:34.570

我同意[Steven 的评论](https://stackoverflow.com/questions/237601/sql-server-2005-wrapping-tables-by-views-pros-and-cons#237607)——主要是因为您使用的是 Access。在重新设计此数据库时，关注 Access 的优缺点非常重要。我去过那里，使用 Access 前端/SQL Server 后端（尽管它不是 ADP 项目）。

我要补充一点，视图可以很好地确保数据不会在项目中的 Access 表单之外更改。缺点是所有更新都需要存储过程——如果您还没有这些，那么也必须创建它们。

# objective-c - Obj-C -> 增加一个数字（并在 Cocoa 标签上显示步骤）

> ID：237621
> 
> 赞同：3
> 
> 时间：2008-10-26T05:37:31.797
> 
> 标签：objective-c, cocoa, increment

我是 Objective-C 的新手，所以可能有一个简单的解决方案。

我想要一个数字增加，但每次迭代都显示在标签上。（例如，它显示 1, 2, 3, 4, 5... 以一定的时间间隔显示）。

我试过：

```
#import "testNums.h"

@implementation testNums
- (IBAction)start:(id)sender {
    int i;
    for(i = 0; i < 10; ++i)
    {
        [outputNum setIntValue:i];
        sleep(1);
    }
}
@end 
```

它所做的只是等待 9 秒（显然已冻结），然后在文本框中显示 9。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-26T07:14:51.837

要允许运行循环在消息之间运行，请使用`NSTimer`或延迟执行。这是后者：

```
- (IBAction) start:(id)sender {
    [self performSelector:@selector(updateTextFieldWithNumber:) withObject:[NSNumber numberWithInt:0] afterDelay:1.0];
}

- (void) updateTextFieldWithNumber:(NSNumber *)num {
    int i = [num intValue];
    [outputField setIntValue:i];
    if (i < 10)
        [self performSelector:@selector(updateTextFieldWithNumber:) withObject:[NSNumber numberWithInt:++i] afterDelay:1.0];
} 
```

这是一种基于计时器的解决方案。您可能会发现它更容易遵循。您可以从文本字段设置文本字段的值：

```
@interface TestNums: NSObject
{
    IBOutlet NSTextField *outputField;
    NSTimer *timer;
    int currentNumber;
}

@end

@implementation TestNums

- (IBAction) start:(id)sender {
    timer = [[NSTimer scheduledTimerWithTimeInterval:1.0
        target:self
        selector:@selector(updateTextField:)
        userInfo:nil
        repeats:YES] retain];

    //Set the field's value immediately to 0
    currentNumber = 0;
    [outputField setIntValue:currentNumber];
}

- (void) updateTextField:(NSTimer *)timer {
    [outputField setIntValue:++currentNumber];
}

@end 
```

这是一个更好（更清洁）的基于计时器的解决方案，使用属性。您需要将文本字段绑定到 Interface Builder 中的属性（选择字段，按 ⌘4，选择您的对象，然后输入`currentNumber`作为要绑定的键）。

```
@interface TestNums: NSObject
{
    //NOTE: No outlet this time.
    NSTimer *timer;
    int currentNumber;
}

@property int currentNumber;

@end

@implementation TestNums

@synthesize currentNumber;

- (IBAction) start:(id)sender {
    timer = [[NSTimer scheduledTimerWithTimeInterval:1.0
        target:self
        selector:@selector(updateTextField:)
        userInfo:nil
        repeats:YES] retain];

    //Set the field's value immediately to 0
    self.currentNumber = 0;
}

- (void) updateTextField:(NSTimer *)timer {
    self.currentNumber = ++currentNumber;
}

@end 
```

基于属性的解决方案至少有两个优点：

1.  您的对象不需要知道文本字段。（它是一个模型对象，与作为文本字段的视图对象分开。）
2.  要添加更多文本字段，您只需在 IB 中创建并绑定它们。您不必向 TestNums 类添加任何代码。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-26T05:47:25.053

是的，因为那是你告诉它要做的。在主运行循环可以自由显示图形之前，图形不会真正更新。你需要使用`NSTimer`或一些这样的方法来做你想做的事。

一个更好的问题可能是你为什么要这样做？

# php - 如何在 PHP 中链接文件？

> ID：237631
> 
> 赞同：2
> 
> 时间：2008-10-26T05:49:25.300
> 
> 标签：php

我有两个需要链接的 PHP 文件。如何使用 PHP 将文件链接在一起？我想要的效果是让用户单击一个按钮，在页面上处理一些信息，然后根据用户单击的按钮将结果显示在不同的页面中。谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-26T05:55:24.413

听起来您可能想要一个 HTML 表单：

```
<form method="post" action="other_file.php">
    <input name="foo" type="..."... /> ...
</form> 
```

然后`$_POST["foo"]`将在 other_file.php 中包含该输入的值。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-26T10:31:53.873

我对您的问题的解释与其他人不同。

在我看来，您想创建一个带有两个按钮的页面并执行您现有的两个 PHP 文件之一，具体取决于按下哪个按钮。

如果这是正确的，那么这里有一个简单的框架来实现这一点。在此示例中，page_1.php 和 page_2.php 是您现有的两个 PHP 文件。

请注意，如果您正在做很多这样的事情，您可能想要阅读 MVC（模型-视图-控制器）模式和/或尝试一些可用的流行 PHP 框架。这超出了这个问题的范围，但基本上这两件事都会为您构建代码提供良好的基础，以便事情保持可管理性并且不会变得一团糟。

```
<?php

if ($_SERVER['REQUEST_METHOD'] == 'POST') {
    switch ($_POST['command']) {
    case 'show_file_1':
        include 'file_1.php';
        break;
    case 'show_file_2':
        include 'file_2.php';
        break;
    }   
    exit;
}   

?>
<form method="POST">
    <button name="command" value="show_file_1">Show file 1</button>
    <button name="command" value="show_file_2">Show file 2</button>
</form> 
```

注意：我只包含了相关的 HTML 和 PHP 来说明这一点。显然，您将添加`<html>`,`<head>`和`<body>`标签，并且可能会稍微调整和模块化 PHP，具体取决于您要添加的内容。

更新：我还应该补充一点，如果您现有的任何一个 PHP 文件包含向自己发布的表单，您可能希望将其更改`include`为重定向。那是：

```
include 'file_1.php'; 
```

会成为：

```
header('Location: http://mysite.com/file_1.php'); 
```

如果不了解现有文件的性质，很难知道要推荐什么。

编辑：我以这种方式回复 OP 的第二个帖子，因为我没有足够的声誉来发表评论。您在哪个行号收到意外`;`错误？如果我不得不猜测，我会说检查你在and行的末尾使用的是`:`（冒号）而不是（分号） 。`;``case 'show_file_1'``case 'show_file_2'`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-26T07:06:52.867

在 PHP 最基本的设置中，您可以使用两个独立的文件：一个生成表单，第二个处理响应。您还可以使用一个文件来处理此问题，该文件检查表单是否已发布。

```
 if (isset($_POST['foo'])) { ... } 
```

或者

```
 if ($_SERVER['REQUEST_METHOD'] == 'POST') { ... } 
```

一旦超出了这个级别，就必须有更简洁的方法来构建脚本，以便将逻辑和接口分开，但我从问题中猜测你还没有。

# c# - 从 Web 浏览器控件中检索选定的文本

> ID：237675
> 
> 赞同：0
> 
> 时间：2008-10-26T07:00:20.633
> 
> 标签：c#, wpf, text, webbrowser-control, selected

这是我想做的事情：

从我使用网络浏览器控件拉出的网页中选择文本。在仍然选择此文本时单击按钮后，我希望弹出一个消息框，显示用户突出显示的文本。如何让这个功能在我的 wpf 应用程序中工作？

我认为我使用 mshtml 走在正确的轨道上，但我收到一条错误消息：

> 对 COM 组件的调用已返回错误 HRESULT E_FAIL。

即使我在文档上尝试一些小的操作（例如更改标题），也会发生此错误。

代码如下：

```
IHTMLDocument2 doc = (IHTMLDocument2)this.webBookText.Document;
doc.title = "l"; 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-26T08:02:50.617

好吧，对于初学者来说，它[`WebBrowser`](http://msdn.microsoft.com/en-us/library/system.windows.forms.webbrowser.aspx)比 mshtml 使用起来要简单得多（请注意，您仍然可以`WebBrowser`在 WPF 中托管）——这肯定会让您更轻松地完成简单的事情：

```
webBook.Document.Title = "foo"; 
```

但是，我看不到任何可以让您非常轻松地使用选择的东西......

您可以使用 获取选定*元素*，`.Document.ActiveElement`但这是整个元素，而不是选定部分。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-26T22:25:11.687

发现错误是因为这不在我的表单类中

# asp.net - ASP.NET MVC Beta Ajax 升级问题

> ID：237691
> 
> 赞同：4
> 
> 时间：2008-10-26T07:27:51.497
> 
> 标签：asp.net, asp.net-mvc, ajax

我一直在等待某个时间来将我的 Asp.net Preview 4 项目带入鼻烟，完全跳过 Preview 5 只是因为我知道我会遇到一些问题。

无论如何，这是问题和困境。

我在网站上有几个区域，我有一个 ajax 更新类型面板，它使用此处找到的这种技术从视图呈现内容。[带有 ASP.NET MVC 的 AJAX 面板](http://www.singingeels.com/Articles/AJAX_Panels_with_ASPNET_MVC.aspx)

这在预览版 4 中运行良好，但现在在测试版中我不断得到这个..

```
Sys.ArgumentNullException: Value cannot be null Parameter name eventObject 
```

它一直让我发疯...

我的代码看起来像这样

```
<% using (this.Ajax.BeginForm("ReportOne", "Reports", null, new AjaxOptions { UpdateTargetId = "panel1" }, new { id = "panelOneForm" })) { }  %>
<div class="panel" id="panel1"><img src="/Content/ajax-loader.gif" /></div>
<script type="text/javascript">
  $get("panelOneForm").onsubmit();
 </script> 
```

所以基本上它所做的就是强制在表单上提交，它使用来自视图 ReportOne 的内容更新 panel1。

我错过了什么？为什么我会收到此错误？他们为什么要去改变事情？我喜欢 MVC，但这让我抓狂。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-03T15:11:46.060

不幸的是，仅仅调用 submit() 不会触发 onsubmit 事件，因此 MVC Ajax 脚本不会运行。当**浏览器**为您调用 onsubmit() 时（因为用户点击了提交按钮），它实际上提供了一个名为*event*的参数（您可以查看 Ajax 助手输出的 Html 即可看到）。

因此，当您手动调用 onsubmit() 时，您需要提供此参数（因为 MVC Ajax 代码需要它）。因此，您可以做的是创建一个“假”事件参数，并将其传递给 onsubmit：

```
<% using (this.Ajax.BeginForm("ReportOne", "Reports", null, new AjaxOptions { UpdateTargetId = "panel1" }, new { id = "panelOneForm" })) { }  %>
<div class="panel" id="panel1"><img src="/Content/ajax-loader.gif" /></div>
<script type="text/javascript">
  $get("panelOneForm").onsubmit({ preventDefault: function() {} });
</script> 
```

重要的部分是**{ preventDefault: function() {} }**部分，它创建一个 JSON 对象，该对象具有一个名为“preventDefault”的方法，该方法什么都不做。这是 MVC Ajax 脚本对事件对象所做的唯一事情，因此应该可以正常工作。

*如果 MVC Ajax 代码有一个简单地忽略空事件参数的检查（ wink* @Eilon :P），也许更长期的解决方法是

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-27T00:35:49.427

我相信调用 someFormElement.onsubmit() 只是调用为该事件注册的事件处理程序。要正确提交表单，您应该调用 someFormElement.submit() （不带“on”前缀）。

我认为我们没有改变 ASP.NET MVC Preview 4 和 ASP.NET MVC Beta 之间的 AJAX 助手的行为。

谢谢，艾隆

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T16:21:33.810

有一些与此问题相关的恼人问题。希望这里有人可以帮助我。

```
 var event = new Object();
function refreshInformation(){
document.forms['MyForm'].onsubmit({preventDefault: function(){} });
} 
```

这是我当前的代码，它可以很好地更新表单。问题是“var 事件”会破坏所有其他 javascript 事件，例如，如果我有这个：

```
 <img src="myimg.gif" onmouseover="showmousepos(event)" /> 
```

它不是发送到函数的鼠标事件，而是我必须声明以使 onsubmit 正常运行的“var 事件”。

仅使用时

```
onsubmit({preventDefault: function(){} }
```

没有“var事件”我得到

```
Sys.ArgumentNullException: Value cannot be null Parameter name eventObject
```

我也尝试过使用

```
submit()
```

这做了一个完整的回发，完全忽略了 ajaxform 的东西......至少在我的解决方案中。

嗯......我意识到这可能有点令人困惑，但如果有人理解这个问题，如果你也有一个解决方案，那就太好了。=)如果您需要有关该问题的更多信息，请询问，我将尝试详细说明。

# python - 如何解析文件列表以仅获取 Python 中的文件名？

> ID：237699
> 
> 赞同：5
> 
> 时间：2008-10-26T07:42:17.443
> 
> 标签：python, parsing, scripting, ftp, ftplib

因此，假设我正在使用 Python 的[ftplib](http://www.python.org/doc/2.5.2/lib/module-ftplib.html)从 FTP 服务器检索日志文件列表。我将如何解析该文件列表以仅获取列表中的文件名（最后一列）？有关示例输出，请参见上面的链接。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-26T07:55:46.700

使用 retrlines() 可能不是最好的主意，因为它只是打印到控制台，所以你必须做一些棘手的事情才能得到那个输出。一个可能更好的选择是使用 nlst() 方法，它准确地返回你想要的：文件名列表。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-26T09:09:11.963

## 这个最佳答案

您可能想要使用`ftp.nlst()`而不是`ftp.retrlines()`. 它会给你你想要的。

如果不能，请阅读以下内容：

## 系统管理员进程的生成器

在他现在著名的评论，[系统程序员的生成器技巧简介](http://www.dabeaz.com/generators/Generators.pdf)中，David M. Beazley 给出了很多答案，用 wuick 和可重用的代码来回答这种数据问题。

例如：

```
# empty list that will receive all the log entry
log = [] 
# we pass a callback function bypass the print_line that would be called by retrlines
# we do that only because we cannot use something better than retrlines
ftp.retrlines('LIST', callback=log.append)
# we use rsplit because it more efficient in our case if we have a big file
files = (line.rsplit(None, 1)[1] for line in log)
# get you file list
files_list = list(files) 
```

为什么我们不立即生成列表？

嗯，这是因为这样做为您提供了很大的灵活性：您可以在将文件转换为之前应用任何中间生成器来过滤文件`files_list`：就像管道一样，添加一行，添加一个不会过热的进程（因为它是生成器）。如果你摆脱`retrlines`它，它仍然可以更好地工作，因为你甚至一次都不存储列表。

编辑：好吧，我阅读了对另一个答案的评论，它说如果名称中有任何空格，这将不起作用。

很酷，这将说明为什么这种方法很方便。如果你想在这个过程中改变一些东西，你只需改变一行。交换 ：

```
files = (line.rsplit(None, 1)[1] for line in log) 
```

和

```
# join split the line, get all the item from the field 8 then join them
files = (' '.join(line.split()[8:]) for line in log) 
```

好的，这在这里可能并不明显，但是对于大型批处理脚本来说，这很好:-)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-26T07:59:52.260

顺便说一下，如果您由于某种原因无法使用 retrlines() ，那么一种稍微不太理想的方法是将函数作为第二个参数传递给 retrlines(); 它将为列表中的每个项目调用。所以像这样的东西（假设你有一个名为'ftp'的FTP对象）也可以工作：

```
filenames = []
ftp.retrlines('LIST', lambda line: filenames.append(line.split()[-1])) 
```

列表“文件名”将是文件名列表。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-26T08:00:33.320

由于输出中的每个文件名都从同一列开始，因此您所要做的就是获取第一行上点的位置：

> `drwxrwsr-x 5 ftp-usr pdmaint 1536 Mar 20 09:48 .`

然后使用该点的位置作为起始索引将文件名从其他行中分割出来。

由于点是该行的最后一个字符，因此可以使用该行的长度减去 1 作为索引。所以最终的代码是这样的：

```
lines = ftp.retrlines('LIST')
lines = lines.split("\n") # This should split the string into an array of lines

filename_index = len(lines[0]) - 1
files = []

for line in lines:
    files.append(line[filename_index:]) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-26T08:15:24.273

**ftplib.FTP.nlst()**有什么理由不适合你吗？我刚刚检查过，它只返回给定目录中文件的名称。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-06-24T23:17:14.247

如果 FTP 服务器支持该`MLSD`命令，请参阅[该](https://stackoverflow.com/questions/2867217/how-to-delete-files-with-a-python-script-from-a-ftp-server-which-are-older-than-7/3114477#3114477)答案中的“单目录案例”部分。

使用该类的一个实例（例如`ftpd`），在正确的文件夹中使用连接的实例`FTPDirectory`调用其方法，然后您可以：`.getdata``ftplib.FTP`

```
directory_filenames= [ftpfile.name for ftpfile in ftpd.files] 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-26T07:52:53.787

我相信它应该对你有用。

```
file_name_list = [' '.join(each_file.split()).split()[-1] for each_file_detail in file_list_from_log] 
```

注释 -

1.  在这里，我假设您想要程序中的数据（作为列表），而不是控制台上。

2.  each_file_detail 是程序正在生成的每一行。

3.  ' '.join(each_file.split())

用 1 个空格替换多个空格。

# c - system() 复制失败，而 cmd 复制有效

> ID：237703
> 
> 赞同：1
> 
> 时间：2008-10-26T07:51:31.823
> 
> 标签：c, copy, system, command, escaping

在 cmd.exe 中，我可以执行命令“copy c:\hello.txt c:\hello2.txt”，它运行良好。但是在我的 C 程序中，我运行了这段代码并得到了以下错误：

```
#include <iostream>

using namespace std;

int main()
{
    system("copy c:\hello.txt c:\hello2.txt");
    system("pause");

    return 0;
} 
```

输出：系统找不到指定的文件。

有人知道这里发生了什么吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-26T07:56:58.617

在 C 字符串内部（以及许多其他使用相同转义规则的语言），`\`应该是`\\`因为它是转义字符。它允许您以普通文本输入不可打印的字符，例如：

*   制表符`\t`。
*   回车符`\r`。
*   换行符`\n`。
*   其他的我不会详细介绍。

由于`\`用作转义字符，我们需要一种将*实际* `'\'`值放入字符串的方法。这是用序列完成的`\\`。

因此，您的行应该是：

```
system("copy c:\\hello.txt c:\\hello2.txt"); 
```

这有时会导致以下命令出现模糊错误：

```
FILE *fh = fopen ("c:\text.dat", "w"); 
```

其中`\t`实际上是`tab`字符，您要打开的文件是：

            `c``:``TAB``e``x``t``.``d``a``t`.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-11-27T14:22:19.790

或者，所有 Windows 函数都支持 Unix 风格的斜杠

```
system("copy c:/hello.txt c:/hello2.txt"); 
```

有些人更喜欢这个，因为它更容易发现一个奇怪的'\'。
但如果您在消息中显示此路径，可能会使 Windows 用户感到困惑。

# php - Web 服务器设置可以覆盖 .htaccess 文件吗？

> ID：237707
> 
> 赞同：0
> 
> 时间：2008-10-26T07:59:35.567
> 
> 标签：php, download

我已经建立了一个网站。在该网站上有使用 php 脚本下载文件的部分。我们公司有两个 ISP 连接。一个 ISP 允许下载文件，但其他 ISP 阻止它。

我以为这是浏览器问题，但在尝试方法后，我得出结论，这是 ISP 问题。我对吗。请帮帮我。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-26T09:43:03.550

从技术上讲，覆盖 .htaccess 的不是网络服务器，而是相反，并且某些设置确实可能不允许在服务器配置的 htaccess 中被覆盖。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-26T09:38:14.933

**Web 服务器**配置可能会阻止某些文件的扩展名下载。

# c# - 德尔福到 .NET + C#

> ID：237715
> 
> 赞同：3
> 
> 时间：2008-10-26T08:07:28.640
> 
> 标签：c#, .net, delphi

我已经成为 Delphi (D7) 开发人员很多时候了，我一直想知道 .NET + C# 的东西。我的意思不是“Delphi for .NET”或“Oxygene”技术/插件，而是干净的.NET/C#。

它与德尔福有什么不同？还有一些其他问题...

*   Mono/SharpDevelop（我应该知道的其他任何东西？）是否与非免费 Visual Studio 一样强大？
*   在部署方面，它是如何工作的？程序集 + 框架 + 可执行文件？
*   框架（最新的 3.5？）类似于 Java 世界的 JVM，对吗？它是否负责支持/使用多核或 Windows 特定优化等技术？
*   C# 与 Object Pascal 有一些相似之处，应该不会太难适应吧？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-26T08:19:26.883

关于第一点：您是否尝试过（免费）[VIsual Studio Express Edition](http://www.microsoft.com/Express/)？对于很多事情，这是完全有能力的。你只是没有得到那么多的帮助者/设计者，也没有插件支持（对于 IDE 扩展）。

关于第二个：排除一些[讨厌的技巧](http://www.yoda.arachsys.com/csharp/faq/#framework.required)，你不能从 .NET 创建一个纯本机可执行文件；它*严重依赖*于本地机器上可用的框架。程序集只是 IL 的一个包，可以（通常）包含在 dll 中，或者引导到加载程序集入口点的 exe 中；但在这种情况下，exe 只是一个简单的加载程序加上一个常规程序集。

实际上，CLR 更像是 JVM。“框架”实际上只是 BCL 的等价物。主要的 MS 框架+CLR 肯定有一些 Windows 特定的优化，但其他运行时/框架（[compact](http://msdn.microsoft.com/en-us/netframework/aa497273.aspx)、[micro](http://msdn.microsoft.com/en-us/embedded/bb278106.aspx)、[Silverlight](http://silverlight.net/)、[Mono](http://www.mono-project.com/)）会有不同的优化。

重新多核 - 你有完整的线程支持（你自己做） - 但主要的*自动*多核支持（希望）将在 .NET 4.0 中使用“[并行扩展](http://msdn.microsoft.com/en-us/concurrency/default.aspx)”工作。

回复最后一点：确实应该很熟悉。实际上，如果您想进行一些比较，“[反射器](http://www.red-gate.com/products/reflector/)”（免费）可以获取已编译的程序集并向您显示 C# 或 delphi（或其他一些）中的代码。

[更新重新问题]

IL = 中级语言；.NET 不会编译为本机 CPU 指令，而是编译为在运行时成为 CPU 指令的中间内容（逐个方法编译为“即时”（JIT））。这意味着 JIT 编译器可以为本地机器优化相同的 IL。[您可以使用NGen](http://msdn.microsoft.com/en-us/library/6t9t5wcf(VS.80).aspx)提前完成此操作。

CLR = 公共语言运行时；本质上是虚拟机

BCL = 基类库；这组课程共享了我的许多应用程序

重新部署：首先，在客户端安装.NET框架；-p

之后 - 各种选择。在最简单的层面上，您可以将 exe/etc 复制到本地机器上并运行。例如，我使用“robocopy”将代码推送到网络服务器。

对于复杂客户端应用程序的完整本地安装，msi 是一个选项（完整的 VS IDE 将帮助您）。

对于简单的客户端，您可以使用[ClickOnce](http://msdn.microsoft.com/en-us/library/t71a733d(VS.80).aspx) - 它将应用程序打包成一个签名包，提供自我更新等功能，并允许您声明您需要什么安全性（完全信任等）。Express Edition 允许您创作 ClickOnce 包。ClickOnce 甚至可以在用户无法安装应用程序的锁定客户端上使用，因为该应用程序是隔离的和沙盒的。

最后，您可以在网络共享上运行 .NET 应用程序，但存在一些安全隐患：“代码访问安全”层不会给予网络共享“完全信任”（尽管最近对此进行了一些更改，以便映射（F：等）共享是受信任的）。因此，您需要在每个客户端使用 CASPOL 来信任代码。ClickOnce 会更容易；-p

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-26T08:57:21.037

作为对 Marc 回答的补充，这些是我从 D6 过渡到 C# 期间的小惊喜：

*   更好的 OOP，没有全局变量（“var MainForm: TMainForm”等）
*   一切都是强类型的（一般来说，你可以没有指针类型）
*   对于 Windows 窗体，“文本 .dfm 文件”（此处为 YourForm.Designer.cs）实际上是 C# 代码，而不是自定义语言的资源描述。（不过，这在 WPF 和 XAML 中发生了巨大变化。）
*   自定义值类型（“结构”）是可能的（例如，您可以有一个“复杂”类型，其行为就像一个整数或单个，存在于堆栈中）
*   运算符重载

还有一些不愉快的小惊喜：

*   没有类似 Delphi 的类引用（“xxx 类”，例如“类型 TControlClass：TControl 类”）
*   没有索引属性（不过你可以用嵌套类来伪造它）

好吧，这就是我现在能想到的，几年后。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-05-25T16:14:35.693

Delphi 是由编写 C# 的同一个人编写的，因此该语言的整体结构不会是最艰难的过渡。您还必须记住，C# 类似于 C，而 Delphi 是 Pascal。在使用 C# 之后，我尝试查看 Delphi，这是一个非常艰难的过渡。首先没有垃圾收集，其次像@Alan 所说的全局变量很难。你确实有 C# 的继承，但你不需要将 Form 声明为 TForm 等的变量。第三，部署是一个巨大的痛苦。使用 .Net 和 GAC，您实际上只需构建您的解决方案，然后就可以了。第四，这是对 Delphi 持续支持的更大担忧。它现在在第三家公司。我认为将 Delphi 与 C# 相反的方式会容易得多。

# c++ - 是否可以编写一个像 next_permutation 这样的函数，但它只置换 r 值，而不是 n？

> ID：237716
> 
> 赞同：2
> 
> 时间：2008-10-26T08:08:02.073
> 
> 标签：c++, algorithm

std::next_permutation（和 std::prev_permutation）置换`[first, last)`给定范围内的所有值，总共 n！排列（假设所有元素都是唯一的）。

是否可以编写这样的函数：

```
template<class Iter>
bool next_permutation(Iter first, Iter last, Iter choice_last); 
```

这会置换 range 中的元素，`[first, last)`但只选择 range 中的元素`[first, choice_last)`。即我们可能有 20 个元素，并且想要遍历它们中 10 个选项的所有排列，20 P 10 个选项与 20 P 20 个选项。

*   Iter 对我来说是一个随机访问迭代器，但如果它可以实现为双向迭代器，那就太好了！
*   需要的外部内存越少越好，但对我来说这并不重要。
*   每次迭代中选择的元素被输入到序列的第一个元素。

*这样的功能可以实现吗？有谁知道任何现有的实现？*

这基本上是我正在做的事情来解决这个问题。也欢迎就如何改进这一点提出建议。

*   从一个元素向量开始，我想访问从中选择的元素的每个排列`V`( ) 。`N``R``R <= N`
*   用值构建一个`I`长度向量，作为元素的索引`R``{ 0, 1, 2, ... R - 1 }``V`
*   在每次迭代中，构建一个带有值`C`的长度向量`R``{ V[I[0]], V[I[1]], ... V[I[R - 1]] }`
*   对`C`.
*   如果可以的话，应用一个函数来排列元素`I`并再次迭代。

该函数如下所示：

```
bool NextPermutationIndices(std::vector<int> &I, int N)
{
    const int R = I.size();
    for (int i = R - 1; ; --i) {
        if (I[i] < N - R + i) {
            ++I[i];
            return true;
        }

        if (i == 0)
            return false;

        if (I[i] > I[i-1] + 1) {
            ++I[i-1];
            for (int j = i; j < R; ++j)
                I[j] = I[j-1] + 1;
            return true;
        }
    }
} 
```

由于所有可能的错误，该函数非常复杂，并且使用它的所有内容都比可能需要的复杂。

* * *

***编辑：***

事实证明，这比我想象的要容易得多**。**从[这里](http://photon.poly.edu/~hbr/boost/combinations.html)，我能够找到我需要的许多精确算法（组合、排列等）的精确实现。

```
template<class BidirectionalIterator>
bool next_partial_permutation(BidirectionalIterator first,
                              BidirectionalIterator middle,
                              BidirectionalIterator last)
{
    std::reverse(middle, last);
    return std::next_permutation(first, last);
} 
```

另外，那里有一种以类似方式工作的组合算法。但是，实现起来要复杂得多。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-26T09:25:14.630

为了迭代 nPk 排列，我之前使用了[这篇旧 CUJ 文章](http://www.ddj.com/cpp/184401912)`for_each_permutation()`中介绍的算法。它使用了来自 Knuth 的一个很好的算法，它可以在原地旋转元素，最后让它们保持原来的顺序。因此，它满足您的无外部存储器要求。它也适用于双向迭代器。它不符合您的外观要求。但是，我认为这是一个胜利——我不喜欢有状态的 API。`next_permutation()`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T08:38:06.847

Java 组合生成器的源代码位于**[http://www.merriampark.com/comb.htm](http://www.merriampark.com/comb.htm)**。去掉 Java 惯用语，它几乎正是您正在寻找的东西，它被实现为一个生成器，以限制您的内存使用。

* * *

这个问题来自被称为**组合**数学的数学领域，它是**离散数学**的一部分。离散数学对计算机科学从业者来说至关重要，因为它几乎涵盖了我们日常使用的所有数学（如逻辑、算法、计数、关系、图论等）。我强烈推荐[*离散和组合数学：应用介绍*](https://rads.stackoverflow.com/amzn/click/com/0201726343)或 [*离散数学及其应用*](https://rads.stackoverflow.com/amzn/click/com/0071244743)，如果你负担得起的话。

（注意：这个问题与“[分组算法](https://stackoverflow.com/questions/199677/algorithm-for-grouping)”有关，但并不完全重复，因为这个问题要求在一般情况下解决它。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-26T09:49:32.210

算法简化是将其分为两个单独的步骤。

*   从原始数据中生成所有可能的 R 元素选择列表。
*   对于这些选择中的每一个，创建所选元素的所有可能排列。

通过交错这些操作，您可以避免分配中间列表。

通过跳过未选择的项目，可以在双向迭代器上实现选择。生成所有选择，例如通过排列一系列`R`1 和`(N-R)`0。这将需要 O(N) 额外的内存，但使您能够就地置换原始序列。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-26T21:54:33.823

对于它的价值，这是一个有效的实现。

它要求上面选择的元素按排序顺序开始。它仅在序列中没有重复元素时才有效（如果有，它会丢失一些排列，并且不会以正确的排列结束）。它也可能缺少一些边缘情况，因为我没有真正彻底测试它，因为我没有实际使用它的计划。

[这种方式相对于这个答案的](https://stackoverflow.com/questions/237716/is-it-possible-to-write-a-function-like-nextpermutation-but-that-only-permutes#237779)一个好处是，这种方式不会按字典顺序访问排列，这可能（但可能不）很重要。有时使用 boost::bind 创建一个函子来传递给 for_each 也是一种痛苦。

```
template<class Iter>
bool next_choice_permutation(Iter first, Iter choice, Iter last)
{
    if (first == choice)
        return false;

    Iter i = choice;
    --i;
    if (*i < *choice) {
        std::rotate(i, choice, last);
        return true;
    }

    while (i != first) {
        Iter j = i;
        ++j;
        std::rotate(i, j, last);
        --i;
        --j;
        for (; j != last; ++j) {
            if (*i < *j)
                break;
        }
        if (j != last) {
            std::iter_swap(i, j);
            return true;
        }
    }
    std::rotate(first, ++Iter(first), last);
    return false;
} 
```

# ruby-on-rails - 如何使用 Windows 开始使用 Ruby on Rails

> ID：237725
> 
> 赞同：4
> 
> 时间：2008-10-26T08:22:14.273
> 
> 标签：ruby-on-rails, windows, ruby

我已经尝试下载 Rails 包并将其安装在 Windows 上，但不知道如何使其工作。

我对这种组合有一些经验：

*   PHP 4.x + 5.x (Windows)
*   LIGHTTPD (Windows)
*   连接到 Firebird 数据库 (Windows)

有人可以启发我吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-27T19:58:03.790

我已经按照 RoR[网站](http://www.rubyonrails.org/down)上的说明在 Windows 上启动并运行 Rails 。转述：

1.  [从这里](http://rubyforge.org/frs/?group_id=167)下载 Ruby Windows 安装程序。我推荐[这个](http://rubyforge.org/frs/download.php/29263/ruby186-26.exe)。
2.  执行 .exe [ruby186-26.exe]
3.  验证您的 Windows 环境变量现在在 PATH 变量中包含 C:\ruby\bin。（我的电脑 -> 属性 -> 高级 -> 环境变量）。如果它不存在，请添加它。
4.  [从这里](http://rubyforge.org/frs/download.php/43986/rubygems-1.3.0.zip)下载 Ruby Gems 。
5.  将 zip [rubygems-1.3.0.zip] 解压缩到一个临时目录。
6.  打开命令窗口并 cd 到临时目录。
7.  `ruby setup.rb`在命令窗口中输入并回车。
8.  之后从命令窗口类型`gem install rails`
9.  繁荣！你的窗户上有栏杆。

我听说过关于 Instant Rails 的好消息，但我避免了它。我强烈推荐[RadRails](http://www.radrails.org) for Eclipse。我在 Windows 中使用 RadRails 连接到 MySQL 数据库进行所有 RoR 开发。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-26T08:29:01.717

尝试一下[Instant Rails](http://instantrails.rubyforge.org/wiki/wiki.pl)，它已经有一段时间没有更新了。或者尝试本教程并自己安装所有内容：http: [//beans.seartipy.com/2008/06/09/setting-up-rails-development-environment-on-windows-vistaxp/](http://beans.seartipy.com/2008/06/09/setting-up-rails-development-environment-on-windows-vistaxp/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-26T12:46:29.810

如果您真的刚开始并且对您下载的内容没有特别的附件，请尝试获取内置 Ruby 和 Rails 的最新[Netbeans (v6.1)](http://www.netbeans.org/download)。它的安装和运行非常简单。（双击安装）。然后，一旦你完成了“文件 > 新项目 > Ruby > Ruby On Rails 应用程序”，按 F6，你将看到你的第一个 Rails 应用程序的起始页。

为了掌握这一切，我建议[Sang Shin 的免费 Ruby On Rails 课程](http://www.javapassion.com/rubyonrails/)。它已经运行了一段时间，但它是免费的，可以动手操作，有一些优秀的材料，并且涵盖了很多内容。我正在这样做并且也学到了很多关于 Rails 和 Ruby 的知识。

高温高压

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-26T20:17:47.153

我使用[Heroku](http://heroku.com/)这是 我所有 Rails 开发的[注册页面](http://heroku.com/beta)

您无需安装或设置任何东西，您就可以快速启动并运行。

[此外，这是在 Vista 上设置 Instant Rails](http://www.adeoressi.com/2007/12/25/ruby-on-rails-a-vista-dev-environment/)的一个很好的教程：

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-11-11T16:16:22.370

如果可能，您真的应该考虑只使用 VMWare 安装虚拟机。您仍然可以开始使用 Windows，但是您可能会在想要使用的各种软件包上遇到很多问题。我也来自 Windows...现在我将自己切换到 Mac 并且再也没有回头...

关键是，Ruby 在任何 POSIX 上运行得比在 Windows 上好得多，所以最好不要尝试强制任何假设在一个平台上正常工作的东西在另一个平台上正常工作。实际上，您永远不会考虑在 Windows 中托管一个 Rails 应用程序（同样，我怀疑您是否也应该考虑在 Windows 中托管一个 PHP 应用程序……这样做只是在付出更多的代价来伤害自己的脚……）

另一种可能性是尝试在 USB 内存/硬盘驱动器上安装 Ubuntu，并在您想玩 Rails 时使用它启动，虽然有点问题，但性能更好。

建议作为初学者 IDE 的 NetBeans 很好。虽然如果你从一本好书开始（实用的 Rails 书第 3 版是一个不错的选择，即使参考资料太有用了，你也永远不会放下那本书）。另外， [Rails Guide](http://guides.rubyonrails.org)是您不容错过的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-28T19:48:59.143

这些是我见过的在 Windows 上设置 rails 的最佳教程。

Xp：[http](http://www.buildingwebapps.com/articles/6467-setting-up-rails-on-windows-xp)
://www.buildingwebapps.com/articles/6467-setting-up-rails-on-windows-xp Vista：[http ://www.buildingwebapps.com/articles/6491-setting-up-rails-on -windows-vista](http://www.buildingwebapps.com/articles/6491-setting-up-rails-on-windows-vista)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-20T16:38:14.617

我昨天刚用过[这个教程](http://www.michaelwales.com/ruby-on-rails/installing-ruby-on-rails-on-windows-vista)，效果很好。但是您需要在安装 Ruby 之后和安装 Rails 之前自己安装[RubyGems 。](http://rubyforge.org/frs/?group_id=126)我发现[本指南](http://www.rubygems.org/read/chapter/3)对 RubyGems 安装很有帮助。

我无法使用环境变量来设置 http 代理；相反，我必须在安装 gem 时将其作为参数传递给 CL (-p [myproxy].[mysite]:[port])

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-11-11T18:21:17.810

派对迟到了，但你可以试试这个教程吗？

[Rails 和 MySQL 入门](http://blog.mmediasys.com/2009/07/06/getting-started-with-rails-and-sqlite3/)

两个观察：

1.  `--source http://gems.rubyinstaller.org`不再需要。从命令中删除该部分
2.  [从此处](http://rubyinstaller.org)为 1.9.1 或 1.8.6 安装最新的 RC1

希望有帮助

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-12-19T05:18:15.067

这是一些帮助我在 Windows 中进行一般 RoR 开发的工具

TextMate 类编辑器：[http](http://www.e-texteditor.com/) ://www.e-texteditor.com/ 多标签 SSH 客户端：[http](http://www.vandyke.com/products/securecrt/index.html) ://www.vandyke.com/products/securecrt/index.html 全功能 UNIX shell（包括 git）：[http ://code.google.com/p/msysgit/](http://code.google.com/p/msysgit/)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-02-27T05:49:53.407

我刚刚按照[本教程](http://allaboutruby.wordpress.com/2009/07/20/installing-rails-on-windows-3-years-later/)进行操作，第一次效果很好，并提供了遇到常见错误时应采取的步骤。我强烈推荐它。这是我经历过的最好的教程之一。我是一个 ASP .NET 人，我没有遇到任何问题。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-02-27T15:21:03.137

我的建议是从微框架开始。像[辛纳屈](http://www.sinatrarb.com/)这样的东西。之后您可以移至 Rails / Merb。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-01-18T14:02:48.953

结帐[Rails Windows 安装程序](http://railsinstaller.org/)

它安装：

*   红宝石 1.8.7-p330
*   导轨 3.0.3
*   Git 1.7.3.1
*   Sqlite 3.7.3
*   开发套件

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-08-01T12:55:31.220

[Rubystack](http://bitnami.org/stack/rubystack) is a free, all-in-one installer for Windows that installs Apache, MySQL, Ruby, Rails and all other third-party libraries typically used on a development environment (such as Imagemagick). We include PHP as well, but no lighttpd

# python - 夏令时更改会影响保存和加载 icalendar 文件的结果？

> ID：237731
> 
> 赞同：2
> 
> 时间：2008-10-26T08:26:31.613
> 
> 标签：python, unit-testing, icalendar

在夏令时切换后，我有一些单元测试今天开始失败。

我们使用[iCalendar python 模块](http://codespeak.net/icalendar/)来加载和保存 ics 文件。

以下脚本是我们测试的简化版本。截至今天早上，该脚本在“夏天”运行良好，在“冬天”运行失败。可以通过手动设置时钟来重现故障。这是脚本的输出：

```
[root@ana icalendar]# date 10250855
Sat Oct 25 08:55:00 CEST 2008
[root@ana icalendar]# python dst.py
DTSTART should represent datetime.datetime(2015, 4, 4, 8, 0, tzinfo=tzfile('/usr/share/zoneinfo/Europe/Brussels')) Brussels time
DTSTART should represent datetime.datetime(2015, 4, 4, 6, 0, tzinfo=<icalendar.prop.UTC object at 0x956b5cc>) UTC
DTSTART represents datetime.datetime(2015, 4, 4, 6, 0, tzinfo=<icalendar.prop.UTC object at 0x956b5cc>) Brussels time
[root@ana icalendar]# date 10260855
Sun Oct 26 08:55:00 CET 2008
[root@ana icalendar]# python dst.py
DTSTART should represent datetime.datetime(2015, 4, 4, 8, 0, tzinfo=tzfile('/usr/share/zoneinfo/Europe/Brussels')) Brussels time
DTSTART should represent datetime.datetime(2015, 4, 4, 6, 0, tzinfo=<icalendar.prop.UTC object at 0x96615cc>) UTC
DTSTART represents datetime.datetime(2015, 4, 4, 7, 0, tzinfo=<icalendar.prop.UTC object at 0x96615cc>) Brussels time
Traceback (most recent call last):
  File "dst.py", line 58, in <module>
    start.dt, startUTCExpected)
AssertionError: calendar's datetime.datetime(2015, 4, 4, 7, 0, tzinfo=<icalendar.prop.UTC object at 0x96615cc>) != expected datetime.datetime(2015, 4, 4, 6, 0, tzinfo=<icalendar.prop.UTC object at 0x96615cc>) 
```

这是[整个脚本](https://thomas.apestaart.org/thomas/trac/browser/tests/icalendar/dst.py)。

所以，问题： - 为什么我的当前时间（以及我所在的夏令时的哪一部分）会影响时间戳的加载/保存/解析？我希望它不会。- 如果它是一个错误，你将如何对这种错误进行单元测试？显然，我不希望我的单元测试重置计算机上的时钟。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T09:31:08.427

没有查看您的代码（以及引用的测试运行脚本，我的大脑现在无法理解），我注意到您尝试获取与您所在的时区不同的时间。（将 DST 视为另一个时区，而不是当前时区的 +-1 小时）。这可能（取决于你如何做）导致时间的增加或减少。（就像您的飞行一样，您一次开始并在开始之前到达您的位置，所有时间都是当地时间）

# code-reuse - 程序员如何实践代码重用

> ID：237733
> 
> 赞同：13
> 
> 时间：2008-10-26T08:28:30.173
> 
> 标签：code-reuse

我一直是一个糟糕的程序员，因为我正在做复制和粘贴。一个例子是，每次我连接到数据库并检索记录集时，我都会复制以前的代码并进行编辑，复制设置 datagridview 的代码并进行编辑。我知道短语代码重用，但我没有实际使用它。我如何利用代码重用，这样我就不必复制和粘贴数据库代码和 datagridview 代码。，

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-26T09:11:18.403

代码重用的本质是对一个通用的操作进行参数化，使其能够接受各种输入。

以谦虚`printf`为例。想象一下，如果你没有`printf`，只有拥有`write`，或类似的东西：

```
//convert theInt to a string and write it out.
char c[24];
itoa(theInt, c, 10);
puts(c); 
```

现在这很糟糕，每次都必须写，实际上有点麻烦。所以一些聪明的程序员决定他厌倦了这个并写了一个更好的函数，一举将东西打印到标准输出。

```
printf("%d", theInt); 
```

你不需要像`printf`它的可变参数和格式字符串那样花哨。即使只是一个简单的例程，例如：

```
void print_int(int theInt)
{
    char c[24];
    itoa(theInt, c, 10);
    puts(c);
} 
```

会做的伎俩镍。这样，如果您想更改`print_int`为始终打印到 stderr，您可以将其更新为：

```
void print_int(int theInt)
{
    fprintf(stderr, "%d", theInt);
} 
```

你所有的整数现在都会神奇地打印到标准错误中。

您甚至可以将该函数和您编写的其他函数捆绑到一个库中，该库只是您可以加载到程序中的代码集合。

遵循代码重用的做法是您甚至可以连接数据库的原因：有人创建了一些代码来将记录存储在磁盘上，然后对其进行了重新设计，直到其他人可以使用它，然后决定将其称为数据库。

图书馆不会神奇地出现。它们是由程序员创建的，目的是让他们的生活更轻松，让他们更快地工作。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-26T08:31:22.993

将代码放入例程中，并在您希望执行该代码时调用该例程。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-26T08:56:19.040

查看 Martin Fowler 的关于[重构的](http://en.wikipedia.org/wiki/Refactoring)[书](http://martinfowler.com/books.html#refactoring)，或众多与重构相关的 Internet 资源（也在 stackoverflow 上），了解如何改进有重复气味的代码。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-26T08:31:42.367

首先，创建一个具有可重用函数的库。它们可以与不同的应用程序链接。它节省了大量时间并鼓励重用。

还要确保该库经过单元测试和记录。所以很容易找到正确的类/函数/变量/常量。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-26T13:57:18.530

好的经验法则是，如果您使用相同的部分 3 次，显然可以将其概括，而不是使其成为过程/函数/库。

然而，随着我年龄的增长，以及作为一名专业开发人员的经验越来越丰富，我更倾向于认为代码重用并不总是最好的想法，原因有两个：

1.  很难预测未来的需求，因此很难定义 API，以便您下次真正使用它们。它可能会花费你两倍的时间——一旦你让它更通用，那么第二次你无论如何都要重写它。在我看来，尤其是最近的 Java 项目很容易出现这种情况，它们似乎总是在框架中被重写，只是为了更“更容易集成”或将来的任何东西。

2.  在一个更大的组织（我是其中的成员）中，如果您必须依赖一些外部团队（内部或第三方），您可能会遇到问题。你的未来取决于他们的资金和资源。所以使用外国代码或库可能是一个很大的负担。以类似的方式，如果您将一段代码分享给其他团队，他们可以期望您会维护它。

但是请注意，这些更像是商业原因，因此在开源中，可重用几乎总是一件好事。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-27T08:41:12.037

要获得代码重用，您需要成为...的大师

1.  给事物起名字来抓住它们的本质。这真的很重要
2.  确保它只做一件事。这真的回到了第一点，如果你不能从本质上去命名它，那么它往往做得太多了。
3.  将事物定位在合乎逻辑的地方。这又回到了能够很好地命名事物并捕捉其本质......
4.  将其与基于中心概念的事物组合在一起。与上述相同，但说法不同:-)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-26T12:23:46.970

我认为回答你的问题的最好方法是为你的重要功能创建一个单独的程序集。这样你可以创建扩展方法或修改帮助程序本身。想想这个函数。

ExportToExcel（列出日期，字符串文件名）

此方法可用于您未来的 excel 导出功能，所以为什么不将其存储在您自己的辅助程序集中。我这样您只需添加对这些程序集的引用。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-09-16T05:13:55.620

首先要注意的是，通过使用复制和粘贴，您正在重用代码——尽管不是以最有效的方式。您已经认识到以前提出过解决方案的情况。

在考虑代码重用时，您需要注意两个主要范围。首先，项目内的代码重用，其次，项目之间的代码重用。

您可以在项目中复制和粘贴一段代码这一事实应该表明您正在查看的这段代码在其他地方很有用。是时候把它变成一个函数，并让它在项目中可用。理想情况下，您应该用新函数替换该代码的所有出现，以便 (a) 减少冗余代码并 (b) 确保该代码块中的任何错误只需要在一个函数中修复，而不是在多个函数中修复。

第二个范围，跨项目的代码重用，需要更多的组织才能获得最大的收益。这个问题已在其他几个 SO 问题中得到解决，例如。[这里](https://stackoverflow.com/questions/237946/how-do-i-index-and-make-available-reusable-code)和[这里](https://stackoverflow.com/questions/145720/what-techniques-do-you-use-to-maximise-code-reuse)。

一个好的开始是将可能跨项目重用的代码组织到尽可能独立的源文件中。最大限度地减少所需的支持、项目特定的代码，因为这将使在新项目中重用整个文件变得更加容易。这意味着最小化项目特定数据类型的使用，最小化项目特定全局变量的使用等。

这可能意味着创建包含您知道在您的环境中有用的功能的实用程序文件。例如。如果您经常开发依赖数据库的项目，则使用常见的数据库功能。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-26T08:33:07.420

对于您给出的示例，适当的解决方案是编写一个函数，该函数将您在粘贴块时编辑的任何内容作为参数，然后使用适当的数据作为参数调用该函数。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-26T08:50:40.677

这在某种程度上取决于您使用的编程语言。在大多数语言中，您可以

1.  编写一个函数，将其参数化以允许变化
2.  编写一个函数对象，使用成员来保存不同的数据
3.  开发实现更复杂变体的（函数对象？）类的层次结构
4.  在 C++ 中，您还可以开发模板以在编译时生成各种函数或类

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-26T08:53:57.313

尝试养成使用其他人的函数和库的习惯。

您通常会发现您的特定问题有一个经过充分测试的优雅解决方案。

即使您找到的解决方案并不完美，您也可能会通过查看其他人如何解决问题来深入了解该问题。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-26T09:27:04.720

我将在两个层面上做到这一点。首先在一个类或命名空间中，将在该范围内重用的代码段放在一个单独的方法中，并确保它被调用。

其次是类似于您所描述的情况。这是一个很好的候选者，可以放入可以更广泛地重用的库或帮助器/实用程序类中。

重要的是要评估您正在做的每件事，是否可以将其提供给其他人以供重用。这应该是我们大多数人都没有意识到的编程的基本方法。

请注意，任何要重用的东西都需要更详细地记录在案。它的命名约定是不同的，所有参数、返回结果和所需的任何约束/限制/先决条件都应该清楚地记录在案（在代码或帮助文件中）。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-26T12:29:35.850

简单：每当您发现自己在复制粘贴代码时，*立即*将其取出（即，不要在您已经 CP 多次编写代码之后再这样做）到一个新函数中。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-26T12:39:20.510

根据项目的大小可以改变答案。

对于**较小**的项目，我建议设置一个 DatabaseHelper 类来完成所有数据库访问。它只是打开/关闭连接和执行数据库代码的包装器。然后在更高级别上，您可以只编写将执行的 DBCommands。

类似的技术*可以*用于更大的项目，但需要一些额外的工作，需要添加接口、DI，以及抽象出您需要了解的有关数据库的内容。

您也可以尝试查看 ORM、DAAB 或[模式和实践组](http://msdn.microsoft.com/en-us/practices/bb190351.aspx#RR)

至于如何预防ole C&P？- 当你写你的代码时，你需要定期检查它，如果你有类似的代码块，只有一个或两个参数不同，这总是一个很好的重构为自己的方法的候选者。

现在对于我的伪代码示例：

```
Function GetCustomer(ID) as Customer
   Dim CMD as New DBCmd("SQL or Stored Proc")
   CMD.Paramaters.Add("CustID",DBType,Length).Value = ID
   Dim DHelper as New DatabaseHelper
   DR = DHelper.GetReader(CMD)
   Dim RtnCust as New Customer(Dx)
   Return RtnCust
End Function

Class DataHelper
  Public Function GetDataTable(cmd) as DataTable
    Write the DB access code stuff here.
    GetConnectionString
    OpenConnection
    Do DB Operation
    Close Connection
  End Function
  Public Function GetDataReader(cmd) as DataReader
  Public Function GetDataSet(cmd) as DataSet
  ... And So on ...
End Class 
```

# java - Java 比较器

> ID：237745
> 
> 赞同：8
> 
> 时间：2008-10-26T08:40:16.173
> 
> 标签：java, comparison

有谁知道Java中的某种比较器工厂，有一个

```
public Comparator getComparatorForClass(Class clazz) {} 
```

它会为 String、Double、Integer 之类的东西返回比较器，但会有一个

```
public void addComparatorForClass(Class clazz, Comparator comparator) {} 
```

对于任意类型。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-26T08:47:58.340

代替：

```
factory.getComparatorForClass(x.getClass()).compare(x, y) 
```

你可以简单地实现`Comparable`和编写：

```
x.compareTo(y) 
```

字符串、原始包装器和标准集合已经实现`Comparable`。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-26T08:53:02.823

使用[`CompareToBuilder`](https://commons.apache.org/proper/commons-lang/javadocs/api-3.4/org/apache/commons/lang3/builder/CompareToBuilder.html)Commons Lang。

> 协助实现 Comparable.compareTo(Object) 方法。
> 
> 要使用这个类，编写代码如下：
> 
> ```
> public class MyClass {
>   String field1;
>   int field2;
>   boolean field3;
> 
>   ...
> 
>   public int compareTo(Object o) {
>     MyClass myClass = (MyClass) o;
>     return new CompareToBuilder()
>       .appendSuper(super.compareTo(o)
>       .append(this.field1, myClass.field1)
>       .append(this.field2, myClass.field2)
>       .append(this.field3, myClass.field3)
>       .toComparison();
>   }
> } 
> ```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-26T08:48:06.080

我不知道有什么类似的事情。如果你真的需要这样的东西，自己实现一个应该不会太难。

但是，您能否详细说明为什么需要这样的东西？通常不应该有类的“默认”比较器。如果这个类有某种自然顺序，你真的应该让它实现`java.lang.Comparable`，并实现`Comparable#compareTo(Object) : int`。

[http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Comparable.html](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Comparable.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-26T12:27:12.907

比较器需要扩展..这是基于可重用代码实现..在这些方法中，您可以自定义数据比较..实现很简单..只需实现 Comparator 接口..覆盖它的 compareto 方法和放置比较代码..并返回您认为在值方面更大的..

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-03-26T00:05:55.357

Java 中不存在默认比较器。但是，如果您正在使用例如自定义搜索器进行编码，它打算使用比较器而不是 Comparable 类派生类型的 compareTo() 方法，您可以编写一个静态内部比较器类作为默认比较器，只需实现compare() 方法通过调用 compareTo()。

例子：

类 Searcher> { 私有 Comparator 比较器；

```
Searcher(Comparator<T> comparator) {
    this.comparator = comparator;
}

Searcher() {
    this(new DefaultComparator<T>());
}

int search(...) {
    ...
}

private static class DefaultComparator<E extends Comparable<E>> 
        implements Comparator<E> {
    public int compare(E o1, E o2) {
        return o1.compareTo(o2);
    }
} 
```

# visual-studio-2008 - 在 Visual Studio 2008 中自定义位置栏

> ID：237748
> 
> 赞同：3
> 
> 时间：2008-10-26T08:42:38.553
> 
> 标签：visual-studio-2008, customization

有没有人成功地为 VS 2008 定制 Places Bar？我从 VS 2005 的自定义没有转移到 2008（很明显），而且无论我对注册表做什么，我都无法让我的自定义位置出现在“打开”对话框中。我已阅读并应用了相关的 MS 知识库文章，但无济于事。

这曾经在 VS 2005 上运行良好，所以很可能是 VS 2008 的错误，但我尝试相同的方法可能是错误的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-28T13:42:02.943

一些意见：

VS2008 现在使用通用文件对话框。使用 Powertoys TweakUK，我能够将所有位置设置为“无”，并且 VS2008 的“打开文件”对话框变为空。

不幸的是，VS2008 忽略了用户定义的位置或目录，而是显示默认位置：'Desktop'、'standard_project_folder'、'My Computer'。

使用 Sysinternals RegMon，我看到注册表项 [HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\comdlg32\PlacesBar] 在 ctrl+o 上被读取...尽管此处定义的位置仍然被忽略。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-02T15:28:59.307

VS2005 和 VS2008（无论如何是 sp1）都仍然使用以下注册表项结构

**因此，对于 vs2008，创建这些 reg 路径。**

> HKCU/Software/Microsoft/VisualStudio/9.0/Open Find/Places/UserDefinedPlaces/Place0/Path = (一些路径
> 
> HKCU/Software/Microsoft/VisualStudio/9.0/Open Find/Places/UserDefinedPlaces/Place1/Path = (另一个路径)

**VS2008 示例：**

> HKCU/Software/Microsoft/VisualStudio/9.0/打开 Find/Places/UserDefinedPlaces/Place0/Path = "C:\Dev"
> 
> HKCU/Software/Microsoft/VisualStudio/9.0/打开 Find/Places/UserDefinedPlaces/Place1/Path = "C:\Staging"

**重要笔记：**

*   **每次编辑这些键时，您似乎都必须重新启动 Visual Studio**
*   VS2005 = 8.0 / VS2008 = 9.0
*   Path 是一个字符串值 (REG_SZ)，其中包含要添加到位置栏的路径
*   桌面和我的电脑似乎是预定义的并且始终存在？
*   我不知道您是否最多可以拥有 5 个以上的位置（通用对话框）
*   建议创建一个简单的 .REG 文件，可以编辑并单击以更改这些

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-06-07T14:42:42.127

如果您只想更改“我的项目”的位置，您可以按照这篇文章的答案中针对 VS 的描述设置路径：http: [//social.msdn.microsoft.com/Forums/en-US/vssetup/线程/861733cd-e337-4fce-9570-1a1d43cd64ac/](http://social.msdn.microsoft.com/Forums/en-US/vssetup/thread/861733cd-e337-4fce-9570-1a1d43cd64ac/)

我刚刚为 VS2005 和 VS2008 做了这个，它工作正常。

# php - php 执行可执行文件（写入串行端口）并冻结

> ID：237757
> 
> 赞同：-1
> 
> 时间：2008-10-26T08:54:15.847
> 
> 标签：php, windows-xp, serial-port

我有一个 php 脚本，它正在执行一个写入串行端口的可执行文件。但是，每次运行

```
系统（“c:\Untitled1.exe”）
```

它只是打开一个cmd窗口并冻结。

有人知道如何解决这个问题吗？或者是否有更简单的方法让 PHP 直接写入串口？（我已经尝试过这两个： http: [//blogs.vinuthomas.com/2007/04/09/php-and-serial-ports/](http://blogs.vinuthomas.com/2007/04/09/php-and-serial-ports/)他们不适合我）

PS我在Windows XP

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T10:23:21.847

当您运行“Untitled1.exe”时会发生什么 - 它是否在 php 环境之外工作？

我建议坚持使用加载的扩展方法 - 这是实现这一点的更好方法。

如果这两种方法都不起作用，那么问题可能出在其他地方 - 与权限或配置有关。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-26T09:43:19.367

AFAIK`system()`调用会阻止执行，直到程序完成。也许使用`popen()`,可以解决这个问题`fread()`。`pclose()`

有关详细信息，请参阅[http://php.net/manual/en/function.popen.php](http://php.net/manual/en/function.popen.php)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-26T17:02:20.653

我相信win32下的诀窍是从php运行start.exe /B来执行和忘记。：） 试一试！

您可以通过 cmd 运行它来获取 start.exe 的帮助： start /?

# c# - 如何在 .Net 中以我想要使用 OleDB 的格式从 CSV 导入值？

> ID：237763
> 
> 赞同：3
> 
> 时间：2008-10-26T09:03:08.997
> 
> 标签：c#, .net, csv, oledb, data-access

我有一个 CSV 文件，其中有一列包含看起来像整数的字符串。也就是说，它们应该作为字符串处理，但由于它们是数字，它们似乎是作为整数导入的（去掉前导零）。

示例数据：

*   0000000000079
*   0000999000012
*   0001002000005
*   0004100000007

我看到的问题是最后一个示例数据点以 DBNull.Value 的形式出现。我假设这是因为 OleDB 将该列视为整数（数据点也没有前导零）并且 0004100000007 大于最大整数值。

有没有办法说“列 [0] 是一个字符串，不要把它读成整数”？读取数据时？

我目前使用的代码是：

```
OleDbConnection dbConn = new OleDbConnection(SourceConnectionString);
OleDbCommand dbCommand = new OleDbCommand("SELECT * FROM test.csv", dbConn);
dbConn.Open();
OleDbDataReader dbReader = dbCommand.ExecuteReader();

while (dbReader.Read())
{
    if (dbReader[0] != DBNull.Value)
    {
         // do some work
    }
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-26T10:18:05.477

当您需要将列读取为字符串时，请尝试在阅读器中使用 GetString() 方法：

```
string myStringValue = reader.GetString(0); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-05T11:02:23.647

Do you have control of the export process? If so can data be exported to CSV with quotes around the string items?

If this is a one of job then just import the file into a predfined SQL table using Integration Services, but I suspect this will be a recurring task.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T12:56:19.823

有一个 Schema.ini 文件需要用于指定有关文件的信息。它包括字段类型和长度，是否有列标题以及字段分隔符是什么。

这是关于它的 MSDN 信息。
[http://msdn.microsoft.com/en-us/library/ms709353.aspx](http://msdn.microsoft.com/en-us/library/ms709353.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-26T09:10:02.617

您是否尝试过使用此[CSV 阅读器](http://www.codeproject.com/KB/database/CsvReader.aspx)？它通常是非常受尊重的。也许试一试...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-04-17T17:43:51.753

I'm no expert but do you cope with fixed file format ? [http://csharptutorial.com/blog/exclusive-how-to-export-a-datatable-to-a-fixed-file-format-the-easy-way-using-odbc-or-jet-engine/](http://csharptutorial.com/blog/exclusive-how-to-export-a-datatable-to-a-fixed-file-format-the-easy-way-using-odbc-or-jet-engine/)

# php - 有没有更好的方法来更改 PHP 中的 DOMElement->tagName 属性？

> ID：237786
> 
> 赞同：4
> 
> 时间：2008-10-26T09:31:23.590
> 
> 标签：php, dom

我刚刚为我的 MVC 框架构建了一个文本框控件，在完成整个文档之前，我在从 ServerTag 继承的所有内容（又从 DOMElement 继承）上调用 PreRender。

我发现更改 DOMElement 派生对象的 tagName 的唯一方法是用一个新的替换它，其中所有属性都与旧的同步。

这就是代码中的样子：

```
protected function PreRenderTextarea( WebPage $sender )
{
    $textarea = $sender->createElement( 'textarea' );
    foreach( $this->attributes as $attribute )
    {
        if ( $attribute->name == 'value' )
        {
            $textarea->nodeValue = $attribute->value;
        }
        else
        {
            $textarea->setAttribute( $attribute->name, $attribute->value );
        }
    }
    $this->parentNode->replaceChild( $textarea, $this );
}

public function OnPreRender( WebPage $sender )
{
    parent::OnPreRender();
    $this->setAttribute( 'value', $this->Value );

    switch( $this->Mode )
    {
        case 'normal' : 
            $this->setAttribute( 'type', 'text' ); 
            break;
        case 'password' : 
            $this->setAttribute( 'type', 'password' ); 
            break;
        case 'multiline' : 
            $this->PreRenderTextarea( $sender ); 
            return; 
            break;
    }
} 
```

这真的是唯一的方法吗？这种方式具有相当不利的副作用，即使控件背后的所有逻辑都归零。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-29T11:13:34.177

是的，您必须这样做——原因是您不仅要更改单个属性 ( `tagName`) 的值，而且实际上是将整个元素从一种类型更改为另一种类型。`tagName`（或`nodeName`）和等属性 `nodeType`在 DOM 中是只读的，并在您创建元素时设置。

因此，创建一个新元素并完全按照您所做的那样移动旧元素，使用`DOMNode::replaceChild`, 是正确的操作。

我不确定您所说的“使控件背后的所有逻辑无效的不良副作用”是什么意思——如果您澄清一下，我也许可以在那里为您提供指导。

听起来您可能不希望 ServerTag 从 DOMElement 继承，而是您可能希望通过其他模式（例如组合）链接这两个对象（即，ServerTag“具有”DOMElement 而不是“是”DOMElement）所以您只是替换与您的 ServerTag Textbox 对象关联的 DOMElement 对象。

或者更长远的猜测是您可能会遇到仅复制属性的问题（即`textarea`具有必需的属性，例如`rows`and `cols`，`input`但没有）。

# portal - 您推荐哪些门户以获取最新的编程技术

> ID：237789
> 
> 赞同：3
> 
> 时间：2008-10-26T09:34:22.053
> 
> 标签：portal

对于我所在的地区，我从

*   万维网
*   代码.google.com
*   www.webmasterworld.com

你强烈推荐其他什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-26T09:49:02.040

对于任何 .NET，您都无法通过 Scott Gu 的[博客](http://weblogs.asp.net/Scottgu/)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-26T11:14:46.580

如果您想了解程序员博客圈中正在发生的事情，特别是对于 Java 程序员，但不仅限于 Java，[DZone非常好。](http://www.dzone.com)我最喜欢他们的是每月的电子邮件通讯，其中包含当月的热门链接，这让我回来了，尤其是当我那个月没有太多时间拖延的时候。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-26T09:46:25.087

如果您对 Linux 感兴趣： [http ://www.linux.com/feature](http://www.linux.com/feature)

[A List Apart](http://www.alistapart.com/)有一些优秀的网络文章

如果您想跟上浏览器的步伐，[Web Browsers News and Reviews](http://www.favbrowser.com/)可能会有所帮助。

最后，javascript 专家[PPK经常有一些有趣的链接和博客文章。](http://www.quirksmode.org/elsewhere/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-26T10:05:33.503

如果您从事 .NET 开发，以下是推荐的博客列表：

*   [http://haacked.com](http://haacked.com)
*   [http://weblogs.asp.net/scottgu/](http://weblogs.asp.net/scottgu/)
*   [http://weblogs.asp.net/fredriknormen/](http://weblogs.asp.net/fredriknormen/)
*   [http://www.nikhilk.net](http://www.nikhilk.net)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-26T10:30:54.233

对于 PHP 相关的东西[PHP Planet](http://www.planet-php.net/)和 PostgreSQL [Planet PostgreSQL](http://www.planetpostgresql.org/)。如果你对 PostgreSQL 感兴趣，[depesz](http://www.depesz.com/)有一个非常不错的博客，里面有很多关于即将发布的版本、性能调整等的信息。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-26T10:27:38.217

[Ayende](http://ayende.com)（[Rhino Mocks](http://ayende.com/projects/rhino-mocks.aspx)的创建者）的博客非常适合阅读。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-26T11:01:46.043

忘了提到 www.codeproject.com 也是获取最新消息的好地方。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-26T11:06:49.340

另请查看：http: [//www.infoq.com/](http://www.infoq.com/)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-26T11:09:42.033

[我在http://www.4guysfromrolla.com/](http://www.4guysfromrolla.com/)找到了很多有用的信息

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-26T11:29:05.677

[http://www.dotnetkicks.com](http://www.dotnetkicks.com) (dnk)

dnk 是一个专注于 .net 的社区网站，你希望成为一个 .net digg，并且在某些方面很可能激发了一些关于令人钦佩的 stackoverflow 的想法。

上面的一些博客非常好，我订阅了其中很多，但是对于最新的更新，它的聚合和集体排名很难击败 dnk。您会在那里找到以上所有内容，但也有一些非常有趣的博客奇观。

# .net - WCF 绑定 - 太多了！我该如何选择？

> ID：237794
> 
> 赞同：16
> 
> 时间：2008-10-26T09:41:49.370
> 
> 标签：.net, wcf, wcf-binding

我们有一个[R 服务器](http://www.r-project.org) （R 是一种用于统计分析的编程语言），它基本上接受一个脚本和一个 csv 文件，处理一些数据并以文本形式返回结果。

我需要在 R 服务器上编写一个服务，以便 .net 客户端（可以是 .Net Windows Forms 或 ASP.Net）可以连接到 R 服务器，提交脚本和 CSV 文件，然后取回结果。

我对可用的许多不同绑定感到困惑，并且网络上的信息似乎很少/分散关于选择哪个绑定。

另外，最好是在 IIS 中运行该服务，还是作为单独的“命令行”类型的侦听器服务（后者与 IIS 相比看起来很难看，我不知道如果他们可以在 IIS 中运行它，为什么有人会选择这样做)?

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-26T09:53:37.803

就个人而言，我会推荐最简单的绑定，以满足您的需求。我已经完成了很多 WCF（有些非常复杂），而且我从来没有使用过 BasicHttpBinding 以外的任何东西；这也允许与非 .NET 客户端最大可能的兼容性，并允许您使用诸如 MTOM 之类的东西来进行有效的二进制传输。

重新托管；IIS 确实是最简单的客户端/服务器设置；两个特别的优势：

*   易于配置 SSL（即您只需配置 IIS，WCF 将使用它）
*   易于负载平衡（只需对您的网络场进行负载平衡）

（我*相信*在 BasicHttpProfile 上运行的 WCF 也可以利用您的 IIS 压缩 [GZip/Deflate] 设置，但不要引用我的话......）

如果（例如）您想要一个长时间运行的有状态服务器，您可以选择使用独立主机（通常通过 Windows 服务）。IIS 有这种回收应用程序池的习惯（通过设计），如果您将某些内容保存在内存中，那就不好了！另一个例子是您希望它已经运行以获得快速的“首次命中”性能（而不是等待 IIS/ASP.NET 启动）。涵盖这两种情况的示例可能是托管 WF（工作流）服务器。

再次; 如果您不需要这种复杂性，请选择最简单的选项：在 IIS 中托管。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-26T10:02:29.703

确实有很多选择。

**捆绑**

WCF 提供的绑定是一组用于常见方案的协议。它指定传输、消息和安全信息。

选择绑定时，您需要从中找出您需要的功能。例如，您可能需要一种方法

*   验证客户端，因为您不希望每个人都能够使用您的服务。
*   数据可能需要加密。
*   该服务需要与来自其他平台的客户端互操作。
*   消息的开销正在成为一个问题。

如果您知道客户端始终来自 dot net，则可以使用 net tcp 绑定，这比 basicHttpbinding 更快。但是，basicHttpBinding 是一个可互操作的协议，即使是 php 或 java 客户端也可以毫无问题地与之通信。

定义自己对服务的需求，然后寻找现有的绑定来满足你的需求，如果没有任何现有的绑定，你可以创建自己的绑定，称为自定义绑定，它可以将不同绑定的特性组合在一起来实现目标。

**托管**

IIS 更具可扩展性。如果您的服务不需要在长期运行的守护进程（Windows 服务或控制台应用程序）中托管的状态，则选择 IIS，因为它很容易为您的服务启用压缩和加密。

**更多关于绑定**

如果您希望在浏览器中调用您的服务，即 javascript WebHttpBinding 是一个很好的 dot net 为您定义的服务。您可以利用 enbableWebScript 使服务理解 JavaScript 的 JSON。

**可用性**

如果一个特定的绑定不能满足所有的要求，您可以在不同的端点以不同的绑定公开每个服务。例如主机/soap 主机/nettcp 主机/json

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-28T23:50:41.433

我建议参考 Juval Lowy 的《Programming WCF Services》一书。

他通过一个决策图表来帮助您决定使用哪个绑定。你也可以在这里找到他关于绑定的文章

[http://www.code-magazine.com/article.aspx?quickid=0605051&page=3](http://www.code-magazine.com/article.aspx?quickid=0605051&page=3)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-02-22T11:22:22.043

摘自 wros 的 WCF4 一书“所有这些内置绑定都建立在适用于特定场景的标准之上，但如果您选择了错误或效率较低的绑定，它们也可以使用。那么，您如何选择适合您的?

如果您需要与非 WCF 应用程序交互，这是最明显的决定。如果您的服务要与 WCF 客户端通信，那么您可以使用前缀为“net”的绑定。请记住，您可以为使用不同绑定的同一服务定义多个端点。这允许您利用 WCF 客户端的性能优化，但仍提供对 ASMX 服务和 WS-* 标准的支持。这些提供了许多客户利用的进一步的安全性和其他功能。

For example, if you want to establish a WCF to WCF communication, choosing a NetTcpBinding with a binary encoding akes the communication four or five time faster tan a BasicHttpBinding with text encoding.

These WCF-provided bindings should cover most cases that you need:however, if you need to change or créate an entirely ne binding, WCF allows you do this very simply"

# c++ - 用户定义的文字为 C++ 添加了哪些新功能？

> ID：237804
> 
> 赞同：144
> 
> 时间：2008-10-26T09:53:29.613
> 
> 标签：c++, c++11, user-defined-literals

[C++11](http://en.wikipedia.org/wiki/C%2B%2B11)引入了[用户定义的文字](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2007/n2378.pdf)，这将允许基于现有文字（`int`, `hex`, `string`, `float`）引入新的文字语法，以便任何类型都能够有文字表示。

**例子：**

```
// imaginary numbers
std::complex<long double> operator "" _i(long double d) // cooked form
{ 
    return std::complex<long double>(0, d); 
}
auto val = 3.14_i; // val = complex<long double>(0, 3.14)

// binary values
int operator "" _B(const char*); // raw form
int answer = 101010_B; // answer = 42

// std::string
std::string operator "" _s(const char* str, size_t /*length*/) 
{ 
    return std::string(str); 
}

auto hi = "hello"_s + " world"; // + works, "hello"_s is a string not a pointer

// units
assert(1_kg == 2.2_lb); // give or take 0.00462262 pounds 
```

乍一看，这看起来很酷，但我想知道它到底有多适用，当我尝试考虑使用后缀`_AD`并`_BC`创建日期时，我发现由于操作员的顺序而存在问题。`1974/01/06_AD`将首先评估`1974/01`（作为plain `int`s），然后才评估（`06_AD`更不用说八月和九月必须在没有`0`八进制原因的情况下编写）。这可以通过使用语法来解决，`1974-1/6_AD`以便运算符评估顺序有效，但它很笨重。

所以我的问题归结为这个，你觉得这个功能会证明自己的合理性吗？您还想定义哪些其他文字以使您的 C++ 代码更具可读性？

* * *

更新语法以适应 2011 年 6 月的最终草案

* * *

## 回答 #1

> 赞同：195
> 
> 时间：2008-10-26T14:17:30.703

乍一看，它似乎是简单的语法糖。

但是当深入研究时，我们发现它不仅仅是语法糖，因为**它扩展了 C++ 用户的选项来创建行为与不同的内置类型完全相同的用户定义类型。**在此，这个小小的“奖励”是对 C++ 的一个非常有趣的 C++11 补充。

## 我们真的需要在 C++ 中使用它吗？

我在过去几年编写的代码中几乎没有看到任何用途，但仅仅因为我没有在 C++ 中使用它并不意味着它对*其他 C++ 开发人员*没有兴趣。

我们曾在 C++（我猜也是 C）中使用编译器定义的文字，将整数输入为短整数或长整数，将实数输入为浮点数或双精度数（甚至长双精度数），将字符串输入为普通字符或宽字符.

**在 C++ 中，我们有可能创建自己的类型**（即类），而可能没有开销（内联等）。我们有可能将运算符添加到它们的类型中，让它们表现得像类似的内置类型，这使 C++ 开发人员能够像将它们添加到语言本身一样自然地使用矩阵和复数。我们甚至可以添加强制转换运算符（这通常是一个坏主意，但有时，它只是正确的解决方案）。

**我们仍然错过了让用户类型表现为内置类型的一件事：用户定义的文字。**

所以，我想这是语言的自然演变，但要尽可能完整：“*如果你想创建一个类型，并且希望它尽可能地像内置类型一样表现，这里有工具。 ……* ”

我猜这与 .NET 将每个基元都设为结构（包括布尔值、整数等）并让所有结构派生自 Object 的决定非常相似。仅此一项决定就使 .NET 在处理原语时远远超出了 Java 的范围，无论 Java 将在其规范中添加多少装箱/拆箱 hack。

## 你真的需要在 C++ 中使用它吗？

这个问题是**你**来回答的。不是 Bjarne Stroustrup。不是赫伯萨特。不是 C++ 标准委员会的任何成员。这就是为什么**您可以在 C++ 中进行选择的**原因，它们不会将有用的符号单独限制为内置类型。

如果**您**需要它，那么它是一个受欢迎的补充。如果**你**不这样做，那么......不要使用它。它不会花费你任何东西。

欢迎使用 C++，这是一种可选功能的语言。

## 臃肿？？？给我看看你的情结！！！

臃肿和复杂（双关语）是有区别的。

就像 Niels 在[用户定义的文字添加到 C++ 中的哪些新功能？](https://stackoverflow.com/questions/237804/user-defined-literals-in-c0x-a-much-needed-addition-or-making-c-even-more-bloat#237821)，能够编写复数是“最近”添加到 C 和 C++ 的两个特性之一：

```
// C89:
MyComplex z1 = { 1, 2 } ;

// C99: You'll note I is a macro, which can lead
// to very interesting situations...
double complex z1 = 1 + 2*I;

// C++:
std::complex<double> z1(1, 2) ;

// C++11: You'll note that "i" won't ever bother
// you elsewhere
std::complex<double> z1 = 1 + 2_i ; 
```

现在，C99“双复数”类型和 C++“std::complex”类型都可以使用运算符重载进行乘法、加法、减法等。

但是在 C99 中，他们只是添加了另一种类型作为内置类型，以及内置的运算符重载支持。他们添加了另一个内置的文字功能。

在 C++ 中，他们只是使用了该语言的现有特性，看到字面特性是该语言的自然演变，因此添加了它。

在 C 中，如果您需要对另一种类型进行相同的符号增强，那么在游说将您的量子波函数（或 3D 点，或您在工作领域中使用的任何基本类型）添加到C 标准作为内置类型成功。

在 C++11 中，你可以自己做：

```
Point p = 25_x + 13_y + 3_z ; // 3D point 
```

**是不是臃肿？不**，需求是存在的，正如 C 和 C++ 复合体都需要一种方法来表示它们的字面复合值所示。

**是不是设计错了？不**，它的设计与其他所有 C++ 功能一样，并考虑到了可扩展性。

**它仅用于符号目的吗？不**，因为它甚至可以为您的代码添加类型安全性。

例如，让我们想象一个面向 CSS 的代码：

```
css::Font::Size p0 = 12_pt ;       // Ok
css::Font::Size p1 = 50_percent ;  // Ok
css::Font::Size p2 = 15_px ;       // Ok
css::Font::Size p3 = 10_em ;       // Ok
css::Font::Size p4 = 15 ;         // ERROR : Won't compile ! 
```

然后很容易对值的分配强制执行强类型。

## 是不是很危险？

好问题。这些函数可以命名空间吗？如果是，那么大奖！

无论如何，**就像所有事情一样，如果工具使用不当，您可能会自杀**。C很强大，如果你误用C枪，你可以把你的头打掉。C++ 有 C 枪，还有手术刀、泰瑟枪以及工具包中的任何其他工具。你可以滥用手术刀，让自己流血致死。或者你可以构建非常优雅和健壮的代码。

那么，就像每个 C++ 特性一样，你真的需要它吗？这是在 C++ 中使用它之前必须回答的问题。如果你不这样做，它不会花费你任何东西。但是，如果您确实需要它，至少该语言不会让您失望。

## 日期示例？

在我看来，您的错误是您正在混合运算符：

```
1974/01/06AD
    ^  ^  ^ 
```

这是无法避免的，因为 / 作为运算符，编译器必须解释它。而且，AFAIK，这是一件好事。

为了找到您的问题的解决方案，我会以其他方式编写文字。例如：

```
"1974-01-06"_AD ;   // ISO-like notation
"06/01/1974"_AD ;   // french-date-like notation
"jan 06 1974"_AD ;  // US-date-like notation
19740106_AD ;       // integer-date-like notation 
```

就个人而言，我会选择整数和 ISO 日期，但这取决于您的需要。这就是让用户定义自己的文字名称的全部意义所在。

* * *

## 回答 #2

> 赞同：72
> 
> 时间：2011-10-26T17:41:55.843

在这种情况下，使用用户定义的文字而不是构造函数调用有优势：

```
#include <bitset>
#include <iostream>

template<char... Bits>
  struct checkbits
  {
    static const bool valid = false;
  };

template<char High, char... Bits>
  struct checkbits<High, Bits...>
  {
    static const bool valid = (High == '0' || High == '1')
                   && checkbits<Bits...>::valid;
  };

template<char High>
  struct checkbits<High>
  {
    static const bool valid = (High == '0' || High == '1');
  };

template<char... Bits>
  inline constexpr std::bitset<sizeof...(Bits)>
  operator"" _bits() noexcept
  {
    static_assert(checkbits<Bits...>::valid, "invalid digit in binary string");
    return std::bitset<sizeof...(Bits)>((char []){Bits..., '\0'});
  }

int
main()
{
  auto bits = 0101010101010101010101010101010101010101010101010101010101010101_bits;
  std::cout << bits << std::endl;
  std::cout << "size = " << bits.size() << std::endl;
  std::cout << "count = " << bits.count() << std::endl;
  std::cout << "value = " << bits.to_ullong() << std::endl;

  //  This triggers the static_assert at compile time.
  auto badbits = 2101010101010101010101010101010101010101010101010101010101010101_bits;

  //  This throws at run time.
  std::bitset<64> badbits2("2101010101010101010101010101010101010101010101010101010101010101_bits");
} 
```

优点是将运行时异常转换为编译时错误。您不能将静态断言添加到采用字符串的位集 ctor（至少不能没有字符串模板参数）。

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2008-10-26T10:16:31.733

这对数学代码非常有用。在我看来，我可以看到以下运算符的用途：

deg 表示度数。这使得书写绝对角度更加直观。

```
double operator ""_deg(long double d)
{ 
    // returns radians
    return d*M_PI/180; 
} 
```

它还可以用于各种定点表示（在 DSP 和图形领域仍在使用）。

```
int operator ""_fix(long double d)
{ 
    // returns d as a 1.15.16 fixed point number
    return (int)(d*65536.0f); 
} 
```

这些看起来像是如何使用它的好例子。它们有助于使代码中的常量更具可读性。它也是使代码不可读的另一种工具，但我们已经有太多工具滥用，再多一个也不会造成太大伤害。

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2008-10-26T18:20:03.473

UDL 是命名空间的（并且可以通过使用声明/指令导入，但您不能显式命名一个像 一样的文字`3.14std::i`），这意味着（希望）不会有大量冲突。

它们实际上可以被模板化（和 constexpr'd）这一事实意味着您可以使用 UDL 做一些非常强大的事情。Bigint 作者会非常高兴，因为他们终于可以拥有任意大的常量，在编译时计算（通过 constexpr 或模板）。

我很遗憾我们不会在标准中看到几个有用的文字（从它的外观来看），比如`s`for`std::string`和`i`for 虚数单位。

UDL 节省的编码时间实际上并不多，但可读性会大大提高，并且越来越多的计算可以转移到编译时以加快执行速度。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2013-09-09T00:10:00.650

[Bjarne Stroustrup 在这个C++11 演讲](http://channel9.msdn.com/Events/GoingNative/GoingNative-2012/Keynote-Bjarne-Stroustrup-Cpp11-Style?format=smooth)中谈到了 UDL ，在关于类型丰富的接口的第一部分，大约 20 分钟。

他对 UDL 的基本论证采用三段论的形式：

1.  “琐碎”类型，即内置的原始类型，只能捕获琐碎的类型错误。具有更丰富类型的接口允许类型系统捕获更多种类的错误。

2.  富类型代码可以捕获的类型错误对实际代码有影响。（他举了火星气候轨道飞行器的例子，由于一个重要常数的尺寸错误而臭名昭著地失败了）。

3.  在实际代码中，很少使用单位。人们不使用它们，因为产生丰富类型的运行时计算或内存开销过于昂贵，而且使用预先存在的 C++ 模板化单元代码在符号上是如此丑陋，以至于没有人使用它。（根据经验，没有人使用它，即使这些库已经存在了十年）。

4.  因此，为了让工程师在实际代码中使用单元，我们需要一种设备，它 (1) 不会产生运行时开销并且 (2) 在符号上是可以接受的。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2010-10-29T11:19:42.753

让我添加一点上下文。对于我们的工作，用户定义的文字是非常需要的。我们致力于 MDE（模型驱动工程）。我们想在 C++ 中定义模型和元模型。我们实际上实现了从 Ecore 到 C++ ( [EMF4CPP](http://WWW.Catedrasaes.org/trac/wiki/EMF4CPP) ) 的映射。

当能够将模型元素定义为 C++ 中的类时，问题就出现了。我们正在采用将元模型（Ecore）转换为带有参数的模板的方法。模板的参数是类型和类的结构特征。例如，具有两个 int 属性的类将类似于：

```
typedef ::ecore::Class< Attribute<int>, Attribute<int> > MyClass; 
```

然而，事实证明，模型或元模型中的每个元素通常都有一个名称。我们想写：

```
typedef ::ecore::Class< "MyClass", Attribute< "x", int>, Attribute<"y", int> > MyClass; 
```

但是，C++ 和 C++0x 都不允许这样做，因为字符串被禁止作为模板的参数。您可以逐个字符地编写名称 char，但这无疑是一团糟。使用适当的用户定义文字，我们可以编写类似的东西。假设我们使用“_n”来识别模型元素名称（我不使用确切的语法，只是为了提出一个想法）：

```
typedef ::ecore::Class< MyClass_n, Attribute< x_n, int>, Attribute<y_n, int> > MyClass; 
```

最后，将这些定义作为模板有助于我们设计用于遍历模型元素、模型转换等的算法，这些算法非常有效，因为类型信息、标识、转换等是由编译器在编译时确定的。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2016-07-02T19:04:30.620

支持编译时维度检查是唯一需要的理由。

```
auto force = 2_N; 
auto dx = 2_m; 
auto energy = force * dx; 

assert(energy == 4_J); 
```

参见例如[PhysUnits-CT-Cpp11](https://github.com/martinmoene/PhysUnits-CT-Cpp11)，一个小型 C++11、C++14 仅标头库，用于编译时维度分析和单位/数量操作和转换。比[Boost.Units](http://www.boost.org/doc/libs/1_61_0/doc/html/boost_units.html)更简单，支持诸如 m、g、s 之类的[单位符号文字，以及诸如 m、k、M 之类的](https://en.wikipedia.org/wiki/International_System_of_Units#Units_and_prefixes)[公制前缀](http://en.wikipedia.org/wiki/Metric_prefix)，仅依赖于标准 C++ 库、仅 SI、维度的整数幂。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-10-26T10:31:52.857

嗯...我还没有想过这个功能。您的样本经过深思熟虑，当然很有趣。C++ 与现在一样非常强大，但不幸的是，您阅读的代码片段中使用的语法有时过于复杂。可读性是，如果不是全部，那么至少很多。并且这样的功能将旨在提高可读性。如果我举你的最后一个例子

```
assert(1_kg == 2.2_lb); // give or take 0.00462262 pounds 
```

......我想知道你今天会如何表达。你会有一个 KG 和一个 LB 类，你会比较隐式对象：

```
assert(KG(1.0f) == LB(2.2f)); 
```

那也可以。对于具有更长名称或类型的类型，您不希望有这样一个很好的构造函数来编写适配器，它可能是动态隐式对象创建和初始化的一个很好的补充。另一方面，您也可以使用方法创建和初始化对象。

但我同意尼尔斯关于数学的观点。例如，C 和 C++ 三角函数需要以弧度输入。我认为虽然是度数，所以像 Nils 发布的非常短的隐式转换非常好。

最终，它将成为语法糖，但它会对可读性产生轻微影响。而且写一些表达式也可能更容易（sin（180.0deg）比sin（deg（180.0））更容易写。然后会有人滥用这个概念。但是，语言滥用的人应该使用非常严格的语言，而不是像 C++ 那样富有表现力的语言。

啊，我的帖子基本上什么都没说，除了：会好的，影响不会太大。我们不要担心。:-)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-26T10:03:09.483

我从来不需要或想要这个功能（但这可能是[Blub](http://www.paulgraham.com/avg.html)效果）。我的下意识反应是它很蹩脚，并且可能会吸引那些认为对于任何可以远程解释为添加的操作重载 operator+ 很酷的人。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-26T19:44:30.433

C++ 通常对所使用的语法非常严格——除了预处理器之外，您没有太多可以用来定义自定义语法/语法的东西。例如，我们可以重载现有的操作符，但我们不能定义新的操作符——IMO 这非常符合 C++ 的精神。

我不介意更多定制源代码的一些方法 - 但是选择的点对我来说似乎很孤立，这让我最困惑。

即使是预期用途也可能使阅读源代码变得更加困难：单个字母可能会产生影响深远的副作用，而这些副作用绝对无法从上下文中识别出来。由于 u、l 和 f 对称，大多数开发人员会选择单个字母。

这也可能将范围界定变成一个问题，在全局命名空间中使用单个字母可能会被认为是不好的做法，并且本应更容易混合库的工具（命名空间和描述性标识符）可能会破坏其目的。

我看到与“auto”相结合的一些优点，也与诸如[boost units](http://www.boost.org/doc/libs/1_36_0/doc/html/boost_units.html)之类的单元库相结合，但不足以值得这个附加。

然而，我想知道我们想出了什么聪明的主意。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2015-08-27T13:24:22.490

我将用户文字用于二进制字符串，如下所示：

```
 "asd\0\0\0\1"_b 
```

使用`std::string(str, n)`构造函数，这样`\0`就不会将字符串切成两半。（该项目对各种文件格式做了很多工作。）

当我放弃`std::string`支持`std::vector`.

* * *

## 回答 #12

> 赞同：-5
> 
> 时间：2008-10-26T11:14:53.317

那个东西的线路噪音很大。读起来也很可怕。

让我知道，他们是否通过任何类型的示例来推理新的语法添加？例如，他们是否有几个已经使用 C++0x 的程序？

对我来说，这部分：

```
auto val = 3.14_i 
```

**不证明这部分是合理的：**

```
std::complex<double> operator ""_i(long double d) // cooked form
{ 
    return std::complex(0, d);
} 
```

即使您在其他 1000 行中使用 i 语法也不行。如果你写，你可能还会写 10000 行其他的东西。尤其是当你仍然可能在任何地方都写这个时：

```
std::complex<double> val = 3.14i 
```

'auto' -keyword 可能是合理的，只是也许。但是让我们只考虑 C++，因为在这方面它比 C++0x 更好。

```
std::complex<double> val = std::complex(0, 3.14); 
```

就像……就这么简单。甚至认为如果您在任何地方都使用它，所有的标准括号和尖括号都是蹩脚的。我没有开始猜测 C++0x 中有什么语法可以将 std::complex 转换为复杂。

```
complex = std::complex<double>; 
```

这可能是直截了当的事情，但我不相信它在 C++0x 中那么简单。

```
typedef std::complex<double> complex;

complex val = std::complex(0, 3.14); 
```

也许？>:)

无论如何，重点是：写 3.14i 而不是 std::complex(0, 3.14); 除了少数超级特殊情况外，总体上不会为您节省太多时间。

# .net - .NET SslStream 没有正确关闭 TLS 连接

> ID：237807
> 
> 赞同：29
> 
> 时间：2008-10-26T09:59:03.767
> 
> 标签：.net, ssl, sslstream

.NET 的类在关闭连接之前`SslStream`不会发送警报。`close_notify`

如何`close_notify`手动发送警报？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2014-03-25T06:15:07.427

谢谢这个问题。它为我指明了正确的方向，即 .Net 中存在一个我不经常想到的错误。

我在编写 FTPS 服务器的实现过程中遇到了这个问题，Filezilla（或可能是 GnuTLS）客户端抱怨“gnutls_record_recv 中的 GnuTLS 错误 -110：TLS 连接未正确终止”。我认为这是 SslStream 实现中的一个非常重要的缺点。

所以我最终写了一个包装器，它在关闭流之前发送这个警报：

```
public class FixedSslStream : SslStream {
    public FixedSslStream(Stream innerStream)
        : base(innerStream) {
    }
    public FixedSslStream(Stream innerStream, bool leaveInnerStreamOpen)
        : base(innerStream, leaveInnerStreamOpen) {
    }
    public FixedSslStream(Stream innerStream, bool leaveInnerStreamOpen, RemoteCertificateValidationCallback userCertificateValidationCallback)
        : base(innerStream, leaveInnerStreamOpen, userCertificateValidationCallback) {
    }
    public FixedSslStream(Stream innerStream, bool leaveInnerStreamOpen, RemoteCertificateValidationCallback userCertificateValidationCallback, LocalCertificateSelectionCallback userCertificateSelectionCallback)
        : base(innerStream, leaveInnerStreamOpen, userCertificateValidationCallback, userCertificateSelectionCallback) {
    }
    public FixedSslStream(Stream innerStream, bool leaveInnerStreamOpen, RemoteCertificateValidationCallback userCertificateValidationCallback, LocalCertificateSelectionCallback userCertificateSelectionCallback, EncryptionPolicy encryptionPolicy)
        : base(innerStream, leaveInnerStreamOpen, userCertificateValidationCallback, userCertificateSelectionCallback, encryptionPolicy) {
    }
    public override void Close() {
        try {
            SslDirectCall.CloseNotify(this);
        } finally {
            base.Close();
        }
    }
} 
```

下面的代码是为了让它工作（这个代码要求程序集是“不安全的”）：

```
public unsafe static class SslDirectCall {
    public static void CloseNotify(SslStream sslStream) {
        if (sslStream.IsAuthenticated) {
            bool isServer = sslStream.IsServer;

            byte[] result;
            int resultSz;
            var asmbSystem = typeof(System.Net.Authorization).Assembly;

            int SCHANNEL_SHUTDOWN = 1;
            var workArray = BitConverter.GetBytes(SCHANNEL_SHUTDOWN);

            var sslstate = ReflectUtil.GetField(sslStream, "_SslState");
            var context = ReflectUtil.GetProperty(sslstate, "Context");

            var securityContext = ReflectUtil.GetField(context, "m_SecurityContext");
            var securityContextHandleOriginal = ReflectUtil.GetField(securityContext, "_handle");
            NativeApi.SSPIHandle securityContextHandle = default(NativeApi.SSPIHandle);
            securityContextHandle.HandleHi = (IntPtr)ReflectUtil.GetField(securityContextHandleOriginal, "HandleHi");
            securityContextHandle.HandleLo = (IntPtr)ReflectUtil.GetField(securityContextHandleOriginal, "HandleLo");

            var credentialsHandle = ReflectUtil.GetField(context, "m_CredentialsHandle");
            var credentialsHandleHandleOriginal = ReflectUtil.GetField(credentialsHandle, "_handle");
            NativeApi.SSPIHandle credentialsHandleHandle = default(NativeApi.SSPIHandle);
            credentialsHandleHandle.HandleHi = (IntPtr)ReflectUtil.GetField(credentialsHandleHandleOriginal, "HandleHi");
            credentialsHandleHandle.HandleLo = (IntPtr)ReflectUtil.GetField(credentialsHandleHandleOriginal, "HandleLo");

            int bufferSize = 1;
            NativeApi.SecurityBufferDescriptor securityBufferDescriptor = new NativeApi.SecurityBufferDescriptor(bufferSize);
            NativeApi.SecurityBufferStruct[] unmanagedBuffer = new NativeApi.SecurityBufferStruct[bufferSize];

            fixed (NativeApi.SecurityBufferStruct* ptr = unmanagedBuffer)
            fixed (void* workArrayPtr = workArray) {
                securityBufferDescriptor.UnmanagedPointer = (void*)ptr;

                unmanagedBuffer[0].token = (IntPtr)workArrayPtr;
                unmanagedBuffer[0].count = workArray.Length;
                unmanagedBuffer[0].type = NativeApi.BufferType.Token;

                NativeApi.SecurityStatus status;
                status = (NativeApi.SecurityStatus)NativeApi.ApplyControlToken(ref securityContextHandle, securityBufferDescriptor);
                if (status == NativeApi.SecurityStatus.OK) {
                    unmanagedBuffer[0].token = IntPtr.Zero;
                    unmanagedBuffer[0].count = 0;
                    unmanagedBuffer[0].type = NativeApi.BufferType.Token;

                    NativeApi.SSPIHandle contextHandleOut = default(NativeApi.SSPIHandle);
                    NativeApi.ContextFlags outflags = NativeApi.ContextFlags.Zero;
                    long ts = 0;

                    var inflags = NativeApi.ContextFlags.SequenceDetect |
                                NativeApi.ContextFlags.ReplayDetect |
                                NativeApi.ContextFlags.Confidentiality |
                                NativeApi.ContextFlags.AcceptExtendedError |
                                NativeApi.ContextFlags.AllocateMemory |
                                NativeApi.ContextFlags.InitStream;

                    if (isServer) {
                        status = (NativeApi.SecurityStatus)NativeApi.AcceptSecurityContext(ref credentialsHandleHandle, ref securityContextHandle, null,
                            inflags, NativeApi.Endianness.Native, ref contextHandleOut, securityBufferDescriptor, ref outflags, out ts);
                    } else {
                        status = (NativeApi.SecurityStatus)NativeApi.InitializeSecurityContextW(ref credentialsHandleHandle, ref securityContextHandle, null,
                            inflags, 0, NativeApi.Endianness.Native, null, 0, ref contextHandleOut, securityBufferDescriptor, ref outflags, out ts);
                    }
                    if (status == NativeApi.SecurityStatus.OK) {
                        byte[] resultArr = new byte[unmanagedBuffer[0].count];
                        Marshal.Copy(unmanagedBuffer[0].token, resultArr, 0, resultArr.Length);
                        Marshal.FreeCoTaskMem(unmanagedBuffer[0].token);
                        result = resultArr;
                        resultSz = resultArr.Length;
                    } else {
                        throw new InvalidOperationException(string.Format("AcceptSecurityContext/InitializeSecurityContextW returned [{0}] during CloseNotify.", status));
                    }
                } else {
                    throw new InvalidOperationException(string.Format("ApplyControlToken returned [{0}] during CloseNotify.", status));
                }
            }

            var innerStream = (Stream)ReflectUtil.GetProperty(sslstate, "InnerStream");
            innerStream.Write(result, 0, resultSz);
        }
    }
} 
```

使用的 Windows API：

```
public unsafe static class NativeApi {
    internal enum BufferType {
        Empty,
        Data,
        Token,
        Parameters,
        Missing,
        Extra,
        Trailer,
        Header,
        Padding = 9,
        Stream,
        ChannelBindings = 14,
        TargetHost = 16,
        ReadOnlyFlag = -2147483648,
        ReadOnlyWithChecksum = 268435456
    }

    [StructLayout(LayoutKind.Sequential, Pack = 1)]
    internal struct SSPIHandle {
        public IntPtr HandleHi;
        public IntPtr HandleLo;
        public bool IsZero {
            get {
                return this.HandleHi == IntPtr.Zero && this.HandleLo == IntPtr.Zero;
            }
        }
        [ReliabilityContract(Consistency.WillNotCorruptState, Cer.Success)]
        internal void SetToInvalid() {
            this.HandleHi = IntPtr.Zero;
            this.HandleLo = IntPtr.Zero;
        }
        public override string ToString() {
            return this.HandleHi.ToString("x") + ":" + this.HandleLo.ToString("x");
        }
    }
    [StructLayout(LayoutKind.Sequential)]
    internal class SecurityBufferDescriptor {
        public readonly int Version;
        public readonly int Count;
        public unsafe void* UnmanagedPointer;
        public SecurityBufferDescriptor(int count) {
            this.Version = 0;
            this.Count = count;
            this.UnmanagedPointer = null;
        }
    }

    [StructLayout(LayoutKind.Sequential)]
    internal struct SecurityBufferStruct {
        public int count;
        public BufferType type;
        public IntPtr token;
        public static readonly int Size = sizeof(SecurityBufferStruct);
    }

    internal enum SecurityStatus {
        OK,
        ContinueNeeded = 590610,
        CompleteNeeded,
        CompAndContinue,
        ContextExpired = 590615,
        CredentialsNeeded = 590624,
        Renegotiate,
        OutOfMemory = -2146893056,
        InvalidHandle,
        Unsupported,
        TargetUnknown,
        InternalError,
        PackageNotFound,
        NotOwner,
        CannotInstall,
        InvalidToken,
        CannotPack,
        QopNotSupported,
        NoImpersonation,
        LogonDenied,
        UnknownCredentials,
        NoCredentials,
        MessageAltered,
        OutOfSequence,
        NoAuthenticatingAuthority,
        IncompleteMessage = -2146893032,
        IncompleteCredentials = -2146893024,
        BufferNotEnough,
        WrongPrincipal,
        TimeSkew = -2146893020,
        UntrustedRoot,
        IllegalMessage,
        CertUnknown,
        CertExpired,
        AlgorithmMismatch = -2146893007,
        SecurityQosFailed,
        SmartcardLogonRequired = -2146892994,
        UnsupportedPreauth = -2146892989,
        BadBinding = -2146892986
    }
    [Flags]
    internal enum ContextFlags {
        Zero = 0,
        Delegate = 1,
        MutualAuth = 2,
        ReplayDetect = 4,
        SequenceDetect = 8,
        Confidentiality = 16,
        UseSessionKey = 32,
        AllocateMemory = 256,
        Connection = 2048,
        InitExtendedError = 16384,
        AcceptExtendedError = 32768,
        InitStream = 32768,
        AcceptStream = 65536,
        InitIntegrity = 65536,
        AcceptIntegrity = 131072,
        InitManualCredValidation = 524288,
        InitUseSuppliedCreds = 128,
        InitIdentify = 131072,
        AcceptIdentify = 524288,
        ProxyBindings = 67108864,
        AllowMissingBindings = 268435456,
        UnverifiedTargetName = 536870912
    }
    internal enum Endianness {
        Network,
        Native = 16
    }

    [ReliabilityContract(Consistency.WillNotCorruptState, Cer.MayFail)]
    [DllImport("secur32.dll", ExactSpelling = true, SetLastError = true)]
    internal static extern int ApplyControlToken(ref SSPIHandle contextHandle, [In] [Out] SecurityBufferDescriptor outputBuffer);

    [ReliabilityContract(Consistency.WillNotCorruptState, Cer.MayFail)]
    [DllImport("secur32.dll", ExactSpelling = true, SetLastError = true)]
    internal unsafe static extern int AcceptSecurityContext(ref SSPIHandle credentialHandle, ref SSPIHandle contextHandle, [In] SecurityBufferDescriptor inputBuffer, [In] ContextFlags inFlags, [In] Endianness endianness, ref SSPIHandle outContextPtr, [In] [Out] SecurityBufferDescriptor outputBuffer, [In] [Out] ref ContextFlags attributes, out long timeStamp);

    [ReliabilityContract(Consistency.WillNotCorruptState, Cer.MayFail)]
    [DllImport("secur32.dll", ExactSpelling = true, SetLastError = true)]
    internal unsafe static extern int InitializeSecurityContextW(ref SSPIHandle credentialHandle, ref SSPIHandle contextHandle, [In] byte* targetName, [In] ContextFlags inFlags, [In] int reservedI, [In] Endianness endianness, [In] SecurityBufferDescriptor inputBuffer, [In] int reservedII, ref SSPIHandle outContextPtr, [In] [Out] SecurityBufferDescriptor outputBuffer, [In] [Out] ref ContextFlags attributes, out long timeStamp);
} 
```

反射实用程序：

```
public static class ReflectUtil {
    public static object GetField(object obj, string fieldName) {
        var tp = obj.GetType();
        var info = GetAllFields(tp)
            .Where(f => f.Name == fieldName).Single();
        return info.GetValue(obj);
    }
    public static void SetField(object obj, string fieldName, object value) {
        var tp = obj.GetType();
        var info = GetAllFields(tp)
            .Where(f => f.Name == fieldName).Single();
        info.SetValue(obj, value);
    }
    public static object GetStaticField(Assembly assembly, string typeName, string fieldName) {
        var tp = assembly.GetType(typeName);
        var info = GetAllFields(tp)
            .Where(f => f.IsStatic)
            .Where(f => f.Name == fieldName).Single();
        return info.GetValue(null);
    }

    public static object GetProperty(object obj, string propertyName) {
        var tp = obj.GetType();
        var info = GetAllProperties(tp)
            .Where(f => f.Name == propertyName).Single();
        return info.GetValue(obj, null);
    }
    public static object CallMethod(object obj, string methodName, params object[] prm) {
        var tp = obj.GetType();
        var info = GetAllMethods(tp)
            .Where(f => f.Name == methodName && f.GetParameters().Length == prm.Length).Single();
        object rez = info.Invoke(obj, prm);
        return rez;
    }
    public static object NewInstance(Assembly assembly, string typeName, params object[] prm) {
        var tp = assembly.GetType(typeName);
        var info = tp.GetConstructors()
            .Where(f => f.GetParameters().Length == prm.Length).Single();
        object rez = info.Invoke(prm);
        return rez;
    }
    public static object InvokeStaticMethod(Assembly assembly, string typeName, string methodName, params object[] prm) {
        var tp = assembly.GetType(typeName);
        var info = GetAllMethods(tp)
            .Where(f => f.IsStatic)
            .Where(f => f.Name == methodName && f.GetParameters().Length == prm.Length).Single();
        object rez = info.Invoke(null, prm);
        return rez;
    }
    public static object GetEnumValue(Assembly assembly, string typeName, int value) {
        var tp = assembly.GetType(typeName);
        object rez = Enum.ToObject(tp, value);
        return rez;
    }

    private static IEnumerable<FieldInfo> GetAllFields(Type t) {
        if (t == null)
            return Enumerable.Empty<FieldInfo>();

        BindingFlags flags = BindingFlags.Public | BindingFlags.NonPublic |
                             BindingFlags.Static | BindingFlags.Instance |
                             BindingFlags.DeclaredOnly;
        return t.GetFields(flags).Concat(GetAllFields(t.BaseType));
    }
    private static IEnumerable<PropertyInfo> GetAllProperties(Type t) {
        if (t == null)
            return Enumerable.Empty<PropertyInfo>();

        BindingFlags flags = BindingFlags.Public | BindingFlags.NonPublic |
                             BindingFlags.Static | BindingFlags.Instance |
                             BindingFlags.DeclaredOnly;
        return t.GetProperties(flags).Concat(GetAllProperties(t.BaseType));
    }
    private static IEnumerable<MethodInfo> GetAllMethods(Type t) {
        if (t == null)
            return Enumerable.Empty<MethodInfo>();

        BindingFlags flags = BindingFlags.Public | BindingFlags.NonPublic |
                             BindingFlags.Static | BindingFlags.Instance |
                             BindingFlags.DeclaredOnly;
        return t.GetMethods(flags).Concat(GetAllMethods(t.BaseType));
    }
} 
```

我在编写与非托管环境的可靠交互方面没有经验，所以我希望有人可以看看并解决问题（也许让它“安全”）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-26T15:21:28.953

这是 .NET 使用底层安全 API 的一个错误。请注意我提出的另一个关于无法选择特定密码套件的问题 - 他们真的搞砸了这个 API 包装器......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-10T12:50:03.853

作为记录，至少在 .NET 2.0 中的 SslStream 似乎也没有响应来自另一方的 close_notify。这意味着正确调用 OpenSSL 的 SSL_Shutdown()，即两次 - 一次启动关闭，再次等待响应 - 将挂起第二次调用。

# mysql - MySQL 加密列

> ID：237816
> 
> 赞同：12
> 
> 时间：2008-10-26T10:06:12.177
> 
> 标签：mysql, security, encryption

假设表中的每一行都有与一个特定用户有关的数据。用户拥有访问系统的密码。

如何使用 InnoDB 加密一列数据，以便除了数据的用户之外没有其他人可以读取数据？我正在考虑使用 MySQL 加密函数之一（比如 AES）和基于从用户密码计算的哈希值的密钥。

有没有人对我如何做到这一点有任何指示？我在正确的轨道上吗？

以下答案之一

> 修改用户密码的问题涉及通过新密码重新加密用户密钥，这比重新加密可能任意大的大量用户数据要简单得多。用户密钥在系统中用户数据的整个生命周期内保持不变。

这有什么帮助？假设密码是pass1。并且有一堆使用由此生成的密钥加密的记录。如果用户现在将密码重置为 pass2，我无法解密使用 pass1 加密的数据。在用户完全忘记密码的情况下，他所有的加密数据都将丢失。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-26T10:34:16.160

我不知道用用户的密码哈希加密数据是否有意义，*特别是*如果你将哈希本身保存在数据库中。在这种情况下，任何可以访问加密数据的人也可以访问密码哈希并解密数据。

另一种方法是使用特定于应用程序的密钥与一些特定于用户的数据一起加密数据。但是，接下来您将面临另一个问题：如何安全地存储应用程序密钥。对于这个问题，我不知道一个简单的答案，但是如果您担心数据库数据可能会受到损害，而不是源代码本身，例如，如果您的数据库存储在异地（想想亚马逊 S3）。

如果您在数据库中仅保留密码的哈希值，使用用户密码对应用程序密钥进行加盐会有所帮助，但可能会引入另一个安全漏洞：您必须在应用程序会话中以明文形式保存用户密码。

至于技术方案，很简单，有[示例代码](http://dev.mysql.com/doc/refman/5.0/en/encryption-functions.html#function_aes-encrypt)。您可以对其进行如下修改，以使用密码哈希加盐的应用程序密码加密数据：

```
INSERT INTO secure_table VALUES (
  1,
  AES_ENCRYPT(
    'plain text data',
    CONCAT(@application_password, @user_password))
); 
```

无论如何，您都必须将应用程序密码存储在某个地方，因此我认为没有一种简单的方法可以提供完美的安全性。

我能想到的另一种方法是向用户询问可以用作加密密钥的短 PIN。PIN 不会存储在数据库中，*但*您每次访问他们的数据时都需要向用户询问。

当然你要考虑的是加密的可行性。如果不解密，您将无法索引或搜索它。有限的数据集（例如信用卡号）可能需要它，但我不会走得太远。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-27T18:32:31.717

澄清问题中提到的答案之一：“用户/应用程序密钥”是随机生成的私钥，用于加密数据。私钥永远不会改变（除非它被泄露）。您使用密码加密和存储私钥。由于私钥比数据小得多，因此更改密码要便宜得多：您只需使用旧密码解密私钥并使用新密码重新加密即可。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-06-10T00:24:41.110

对于非用户特定（全局）的数据，您可以使用对称和非对称密码的组合。您可以有一个`extra password`所有用户都必须输入的字段，这样即使一个用户更改了自己的密码，全局数据仍可用于具有不同密码的其他用户。

`extra password`可以与`salt-like string`源代码中的另一个进行按位异或。一起，它可以形成对称密钥来解密`private key`存储在数据库中的密钥（永远不会改变）。`private key`使用 解密后`extra password`，私钥可以解密`read`数据库中的所有数据。私钥可以存储为会话变量。

`public key`顾名思义，可以作为纯文本字符串驻留在数据库中。当您需要`write`数据库时，使用公钥加密数据。

您可以定期为用户提供一个新的`extra password`并重新加密 static `private key`，然后是 xor'ing with `salt-like string`。

如果数据是特定于用户的数据并且不用于其他用户，则可以使用不带额外密码字段的用户密码来加密私钥。管理员可以拥有特定用户的另一份私钥副本，可以使用他的密码对其进行解密。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-26T10:49:59.313

我认为这不是最好的方法，除非你强制用户永远不能更改他们的密码，或者你有办法在用户每次更改他/她的密码时重新加密所有内容。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-26T11:10:49.113

您可以存储另一个密钥来加密/解密在创建新用户时可能生成的用户特定数据。我们称这个新的密钥用户密钥。此用户密钥也应在数据库中加密，最直接的方法是通过用户密码或包含密码的任何其他数据（例如密码和创建/修改时间等）对其进行加密。

我会在用户会话中保留解密的用户密钥，以便在会话中的任何所需时间访问用户的数据。

修改用户密码的问题涉及通过新密码重新加密用户密钥，这比重新加密可能任意大的大量用户数据要简单得多。用户密钥在系统中用户数据的整个生命周期内保持不变。

当然，只有在登录时通过将实际用户密码发送到服务器来执行身份验证时才能使用此方法，因为数据库只希望包含密码的哈希值。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-27T00:12:40.377

> 假设密码是pass1。并且有一堆使用由此生成的密钥加密的记录。如果用户现在将密码重置为 pass2，我无法解密使用 pass1 加密的数据

密钥需要以可逆方式加密，以便可以使用 pass1 解密并使用 pass2 重新加密。

总结一下：

存储在数据库中的是：单向加密密码（用于密码检查），其他数据的加密密钥，使用明文密码进行可逆加密（或者无论如何，密码以与存储方式不同的方式加密在数据库中）和其他数据，使用明文加密密钥进行可逆加密。

每当您需要其他数据时，您必须拥有明确的（或与数据库中存储的密码不同的加密）密码，读取加密密钥，使用密码对其进行解密，然后使用该密码来解密其他数据。

更改密码时，使用旧密码解密加密密钥，使用新密码加密并存储。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-28T07:09:17.360

如果您需要在没有用户交互的情况下访问数据（例如用于数据库迁移），您将没有解密密钥。

# javascript - 如何将 AsciiMathML 嵌入 Google 协作平台？

> ID：237822
> 
> 赞同：2
> 
> 时间：2008-10-26T10:17:08.893
> 
> 标签：javascript, math, mathml, google-sites

我们需要通过[AsciiMathML](http://www1.chapman.edu/~jipsen/asciimath.html)将数学公式嵌入[Google 站点](http://sites.google.com)页面（研究团队的内部 wiki）。我受制于 Google 协作平台的限制。

知道怎么做吗？

（ps：我终于找到了一个[不太实用的解决](http://blog.vermorel.com/?p=91)方法，但仍然会感谢更好的想法）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-02-20T21:38:11.230

我曾经使用[texify.com](http://www.texify.com/)，但它们不再可用。现在我使用[Google Infographics Mathematical Formulas](http://code.google.com/apis/chart/infographics/docs/formulas.html)，它具有更多功能*并且*（IMO）更有可能在未来继续提供。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T14:00:34.093

我有同样的问题，但发现 texify: [http://www.texify.com/](http://www.texify.com/)作为一个完整的解决方案。Texify 是一个在线 tex 编辑器渲染 gif，而不是 AsciiMathML，但我发现它很快就掌握了窍门。只需将生成的 html 代码添加到您在 Google 协作平台中的源代码中，或从 GUI 插入图片。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-05T11:59:38.477

我不知道这是否是您可以接受的解决方案，但您可以在 Google Pages 上上传您自己的 HTML（或任何其他类型）文件。所以建议的解决方案是：用必要的 JS 标签手动编写 HTML 页面并将它们上传到 Google Pages。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-03T08:48:05.210

我认为您不能为此目的使用手动编辑的 HTML。谷歌网站去掉了 HTML 中的所有“嵌入”语句。一种解决方案是使用您的 AsciiMathML 构建一个 google 小工具，然后将该小工具插入到站点中。一个聪明的解决方案是搜索现有的满足您的目的的谷歌小工具;-)祝你好运！

# java-me - 如何覆盖 J2ME 波兰语二进制文件中的类？

> ID：237828
> 
> 赞同：0
> 
> 时间：2008-10-26T10:25:09.393
> 
> 标签：java-me, j2mepolish

我正在使用来自 J2ME Polish 的 UI 组件。我在代码中发现了一个简单的错误，并想快速修复它，但在下载包中找不到任何构建脚本，尽管包含源代码。

该问题无法通过扩展类来解决，因为它涉及具有私有访问权限的成员。

我应该如何修复它？我应该简单地用 Javac 编译有问题的类还是应该尝试在他们的存储库中找到构建脚本？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T12:47:59.230

J2MEPolish UI 库没有二进制代码，因为这些类也在您的应用程序编译期间进行了预处理。这就是为什么 J2MEPolish UI 部分也没有构建脚本的原因 - 生成的二进制文件，如果它编译，将没有任何意义 :)

如果您直接使用此 UI 类（不涉及波兰魔法），我建议将其复制到您自己的项目中，在那里进行更改，您应该会没事的。

但是有一个小问题。我不是 100% 确定，但是波兰语构建过程应该如下：首先你的类被预处理，然后波兰语类将被预处理。如果您复制到项目中的 UI 组件将保留在同一个 java 包中，则您的更改可能会被有缺陷的波兰实现覆盖。您可以通过运行应用程序或查看构建目录中的最终 java 代码来检查它。

如果发生覆盖问题，那么您有两个选择 - 将项目中的 UI 类移动到不同的包中（我 99% 确定如果您直接使用它应该没问题）或者您需要修改波兰构建过程，以便它将首先预处理波兰语类，您可以覆盖它所做的更改。

/亚努斯西姆

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-04-20T15:04:48.987

我知道这个问题已经得到回答和接受，但更简单的方法是使用他们的内置属性（对于任何通过魔法搜索引擎来到这里的人）

```
polish.client.source=/projecthome/j2me-polish-source 
```

这只是与安装程序一起打包的源代码的副本。您可以将其复制到您自己的源代码树中，从而获得更改的版本历史记录。

虽然 JaanusSiim 的方法可能有效，但我不推荐它，因为在您自己的源代码树中包含 de.enough.** 包会变得令人困惑，我通常`src`为我的个人源代码和`src-j2mepolish`他们的源文件创建一个，这是非常明确的添加到标准版本。

# apache-flex - Flex 无法反序列化仅包含属性的 Web 服务元素

> ID：237832
> 
> 赞同：0
> 
> 时间：2008-10-26T10:27:27.687
> 
> 标签：apache-flex, web-services, actionscript, serialization

我看到一个非常奇怪的问题，即 Flex 使用的 .NET Web 服务。

我有一个非常简单的类，除了具有 [XmlAttribute('xxx')] 属性的属性之外什么都没有。

```
public class OrderAddress
{
    public OrderAddress() {}

    [XmlAttribute("firstName")]
    public string FirstName { get; set; }

    [XmlAttribute("lastName")]
    public string LastName { get; set; }

    [XmlAttribute("company")]
    public string Company { get; set; }        

    [XmlAttribute("address1")]
    public string Address1 { get; set; }

    ... (more properties)
} 
```

问题是在 Flex 中，当这个对象被反序列化时，调试器中的每个字段都为空。OrderAddress 类的实例不为空，只是所有字段。我 100% 确定我的 Web 服务代理层是最新的，并且 100% 肯定有数据通过网络传输，如[Fiddler](http://fiddlertool.com)所示。

非常非常奇怪的是，如果我将这些属性之一更改为序列化为元素（而不是 XmlAttribute）并仅重新编译我的 C# web 服务，那么 Flex 可以立即识别数据。如果我添加一个完全未使用的字段 - 就像`public string Foo = "foo";`那样，它也会突然起作用。

我有点记得以前看到过类似的东西，但不记得我是否成功修复它。

对我来说是凌晨 3 点 30 分，我需要推迟我的核心故障排除，但把它扔在这里，以防任何人阅读它。代码在一个模块中，我知道有时会导致一些奇怪 - 但这似乎很奇怪。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-04-08T14:25:18.830

经过三天的努力，我终于发现这个 XML 属性是我的问题的原因。与您的稍有不同，我的类除了 XML 属性之外还有一个对象数组。Flex 能够生成代理，甚至可以正确获取属性（它被视为属性），但它无法将 XML 元素（从 Web 服务返回）反序列化为对象数组。删除该属性后，一切正常……所以，这是“以元素为中心的 XML 序列化”。但是，有没有办法解决它？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-26T10:57:47.470

以元素为中心的 XML 是 XML 序列化中更具互操作性的格式。这就是新的 WCF DataContract 序列化程序将每个属性序列化为元素而不是属性的原因。对我来说，属性是元素的描述符，而不是元素的数据。

# c# - WinForms的服务器和客户端之间的通信

> ID：237836
> 
> 赞同：3
> 
> 时间：2008-10-26T10:31:51.687
> 
> 标签：c#, .net, networking

我有 50 多台自助服务终端式计算机，我希望能够从一台计算机按需而不是间隔地获取状态更新。就请求状态的计算机而言，这些计算机位于 LAN 上。

我研究了 WCF，但看起来我需要安装 IIS，而且我宁愿不在 50 多个 Windows XP 机器上安装 IIS——所以我认为除非可以让 WinForm 托管 Web 服务，否则我认为这会消除使用 Web 服务？

我还使用 System.Net.Sockets 进行了研究，甚至得到了一个几乎没有功能的原型，但是我觉得我不够熟练，无法使它成为一个坚固可靠的系统。鉴于这条道路，我需要了解更多关于套接字编程和线程的知识。

这些机器运行的是 .NET 3.5 SP1，因此我在 .NET 版本中具有完全的灵活性，但我想坚持使用 C#。

实现这一点的最佳方法是什么？我应该咬紧牙关多学习 Sockets 还是 .NET 有更好的方法来处理这个问题？

编辑：我打算进行双向沟通，直到我意识到我所需要的只是一种双向沟通。

编辑 2：我避免使用传统的服务器/客户端并采用相反的方式，因为我想避免消耗过多的带宽并且不确定我在谈论什么样的开销。我还希望能够更好地控制各个信息亭。看了之后，我想我仍然可以使用 WCF 并通过 IP 连接（我不知道我可以通过 IP 连接，我想我必须添加 50 个 Web 服务或其他东西）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-26T10:38:37.680

WCF 不必托管在 IIS 中，它可以托管在您的 Winform 中，作为控制台应用程序或 Windows 服务。你可以让每台电脑在winform里面托管自己的服务，在自己的电脑上写一个程序调用每台电脑的服务来获取状态信息。

另一种方法是在您自己的计算机上托管一个服务，并让 50 多台计算机在其状态更新后调用该服务，您可以使用该服务的数据库来持久化网络中每个节点的状态数据. 此选项更易于维护和扩展。

PS WCF 旨在取代 .net 远程处理，替代方案可以是 net.tcp 绑定或 net.pipe

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-26T10:57:44.880

除非您计划将其扩展到数千个客户端，否则我认为 WCF 性能甚至不会是一个边缘问题。您可以轻松地从 Windows 服务或 Winforms 应用程序托管 WCF 服务，并且一旦您掌握了关键概念，您会发现使用 WCF 工作将相当简单。

我已经为大约 100-150 个客户部署了类似的东西，并取得了巨大的成功。

网络上有很多资源可以帮助您入门 - 这里有一个可以帮助您：

[http://msdn.microsoft.com/en-us/library/aa480190.aspx](http://msdn.microsoft.com/en-us/library/aa480190.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-26T11:17:16.853

无论您在中央服务器上使用 Web 服务还是 WCF，您只需要在服务器上（而不是在 50 多个客户端上）安装和配置 IIS。

您尝试做的事情有点不清楚，但是如果客户端需要调用服务器（例如，获取服务器状态），那么他们只需调用服务器上运行的 web 服务上的方法。

相反，如果您需要让服务器不时调用客户端，那么您需要让每个客户端在每次客户端启动时调用服务器 Web 服务上的登录方法。登录方法将从客户端获取委托方法作为参数。当服务器需要来自客户端的信息时，它会调用这个委托。

为每个客户端设置自己的 Web 服务将代表传统（一个服务器，多个客户端）客户端/服务器架构的反转，并且正如您已经注意到的那样，这是不切实际的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-26T11:38:36.250

不要使用远程处理。

如果您想要健壮性和可伸缩性，您最终会排除一切，但基本上是无状态的远程过程调用。由于这正是 Web 服务的能力，而且 Web 服务更简单、更容易构建，因此远程处理本质上是一种毫无意义的技术。

带有远程代表的回调在性能/可靠性禁止列表中，所以如果您正在考虑使用远程处理，请再想一想。

使用网络服务。

我知道你不想投票，但我认为你不需要。既然你说你的所有单元都在一个网段上，那么我建议使用 UDP 广播更改通知，本质上是设置一个脏标志，并允许应用程序按需（重新）获取。它仍然不可靠，但是因为它是广播的，所以它很容易而且非常快。

正如其他人所说，您不需要 IIS，您可以自托管。有关如何执行此操作的详细信息，请参阅[ServiceHost 类。](http://msdn.microsoft.com/en-us/library/system.servicemodel.servicehost.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-26T10:40:48.503

我建议使用 .NET Remoting。它很容易实现，不需要任何其他东西。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-26T10:46:03.343

对我来说，最好学习网络……或者手动的套接字通信方式……Web服务太慢了，因为它包含元数据……

您的客户端和服务器可以转换为多线程应用程序。只是模仿请求和响应架构。实现这样的网络应用程序很容易..

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-26T10:46:49.397

如果您只需要状态更新，您可以使用更简单的解决方案，例如简单的 tcp 服务器/客户端消息传递或像 orrsella 所说的那样，远程处理。WCF 在这里有点矫枉过正。

不过需要注意的是，如果您所有的 50 多个信息亭都通过互联网连接，那么您可能需要使用 VPN 或在每个信息亭上都有一个开放端口（这是一个安全风险），以便您的服务器可以从每个信息亭检索状态更新。

我们有类似的情况，但状态会定期发送到我们的服务器，所以我们只有 1 个端口来保护/保护。更新频率可配置以适应较慢的客户端。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-10-14T10:02:34.587

作为一个拥有超过 500 多个客户并不断发展的人：

消息队列是要走的路。

我们已经从内部开发的 TCP 服务器和客户端转向 WCF 轮询并最终使用消息队列。这是通过 Internet 与客户端和服务器之间获取数据的唯一有保证的方式。作为奖励，这些解决方案中的许多都有一个广泛的框架，使得实现发布-订阅、单向发送、点对点发送、请求-回复变得微不足道。其中一些使用 WCF 是可能的，但它会涉及哭泣、喊叫、呜咽和漫长的夜晚，更不用说几加仑的咖啡了。

一些重要的评论：

让进程轮询客户端而不是相反 = 坏主意.. 它根本不可扩展，当进程需要太长时间才能完成时，您很快就会遇到麻烦.. 更不用说必须处理所有ip地址（您是否可以访问所需端口上的所有客户端？当ip更改等时会发生什么......）

我们所做的：客户端定期向中央消息队列发送状态更新（您可以轻松地在 UI 中实现实时更新），它还在自己的队列上侦听 GetStatusRequest 消息。如果它收到这个，它会回答（有一个超时）..这样，我们可以随时查看所有客户端的总体状态，并在需要时获取特定客户端的特定状态。

关于带宽：信息亭通常显示图像/视频等。1Kb 或更少的状态消息不会是大开销。

我不能强调你目前的设计将有一个非常密集的开发周期并且不会很好地扩展或扩展（相信我，我们已经吸取了这个教训）。除此之外，为这类东西构建一个好的客户端/服务器协议是一项艰巨的工作，如果你犯了设计错误，之后将完全没用（迁移协议并不容易）

我们已经在 ActiveMQ 之上构建了我们的解决方案（使用 NMS 库 c#），并且目前正在为我们的内部工作扩展简单服务总线。

我们仅将 WCF 用于我们的 winforms 应用程序和集中式服务之间的通信

# iis - 如何仅使用 2 个虚拟目录托管多个 Web 应用程序

> ID：237843
> 
> 赞同：1
> 
> 时间：2008-10-26T10:35:56.767
> 
> 标签：iis, virtual-directory

我的共享主机只允许我创建 2 个虚拟目录。我想托管多个 webapps ......比如说一个 asp.net mvc 博客、一个论坛、一个个人网站等......

没有其他方法可以做到这一点吗？我不能只是简单地将博客文件夹 ftp 到我的虚拟目录之一，然后在线访问它吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-28T16:10:25.187

对于 ASP.NET Web 应用程序，通常每个应用程序都位于其自己的虚拟目录中，该目录用作应用程序的起点。

从技术上讲，您可以通过以下两种方式之一在同一应用程序起点上“搭载”两个应用程序：

1.  将每个应用程序的所有文件放在同一目录（以及相应的子目录）中

如果你没有任何重叠的文件，你可以摆脱这个。当然，您可能不会使用默认或索引页面等文件。无论如何，这会很混乱。

2.  将每个应用程序的所有非二进制文件放在适当的子目录中，将二进制文件放在主虚拟的 \bin 目录中。

只有当每个应用程序的二进制文件不按名称重叠并且程序集之间没有命名空间歧义冲突（两个不同的程序集按文件名，但具有相同的命名空间）时，您才能执行此操作。如果您尝试搭载两个不同的应用程序，则后者发生的可能性要小得多。

我看到后一种解决方案的一个大问题是应用程序中使用应用程序根引用的任何部分都会中断。当某些代码尝试根据应用程序根引用解析对某些资源（如图像）的引用时，例如

```
~/images/logo.gif 
```

~ 将被解析到虚拟目录，但不包括应用程序所在的附加（非虚拟和非应用程序起点）子目录。所以代替这个：

```
/vd1/app1/images/logo.gif 
```

你最终会得到这个：

```
/vd1/images/logo.gif 
```

显然，那是行不通的。

所以......如果你可以将它们都放在同一个虚拟目录中，你不会破坏任何一个应用程序，但是，你必须检查文件冲突等。如果没有单独的应用程序起点，可能的命名空间冲突将是不可避免的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-26T11:46:43.473

您不能将每个应用程序放在任何一个虚拟目录中的单独子目录中。例如，如果您有[http://server.com/vd1](http://server.com/vd1)，您可以像[http://server.com/vd1/app1](http://server.com/vd1/app1)、[http://server.com/vd1/app2](http://server.com/vd1/app2)等那样对其进行分区。

# python - 为 wxPython 格式化 dict.items()

> ID：237859
> 
> 赞同：3
> 
> 时间：2008-10-26T10:50:34.053
> 
> 标签：python, dictionary, wxpython

我在 wxPython 中有一个文本框，它接受 dictionary.items() 的输出，并在将项目添加到字典时将其显示给用户。但是，原始数据非常难看，看起来像

```
[(u'BC',45)
(u'CHM',25)
(u'CPM',30)] 
```

我知道 dictionary.items() 是一个元组列表，但我似乎无法弄清楚如何制作一个与 wxPython 的 SetValue() 方法兼容的好格式。

我试过遍历列表和元组。如果我使用*打印*语句，则输出很好。但是当我用 SetValue() 替换*print*语句时，它似乎只得到每个元组的最后一个值，而不是元组中的两个项目。

我也尝试过创建一个字符串并将该字符串传递给 SetValue() 但同样，我只能在元组中获取一个项目或另一个，而不是两者。

有什么建议么？

* * *

**编辑：**是的，我将 dictionary.items() 的结果传递给 wxPython 应用程序中的文本字段。而不是像上面那样的结果，我只是在寻找类似的东西：

```
BC 45
CHM 25
CMP 30 
```

没什么特别的，只是简单地从每个元组中提取每个值并制作一个可视化列表。

我尝试制作一个字符串格式并将其传递给 SetValue() 但它被挂在元组中的两个值上。它将双重打印每个字符串并将整数加在一起，或者它只是返回整数，这取决于我如何格式化它。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-26T18:59:14.830

没有内置的字典方法可以返回您想要的结果。

但是，您可以通过创建一个格式化字典的辅助函数来实现您的目标，例如：

```
def getNiceDictRepr(aDict):
    return '\n'.join('%s %s' % t for t in aDict.iteritems()) 
```

这将产生您想要的确切输出：

```
>>> myDict = dict([(u'BC',45), (u'CHM',25), (u'CPM',30)])
>>> print getNiceDictRepr(myDict)
BC 45
CHM 25
CPM 30 
```

然后，在您的应用程序代码中，您可以通过将其传递给它来使用它`SetValue`：

```
self.textCtrl.SetValue(getNiceDictRepr(myDict)) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-26T11:02:06.323

也许[漂亮的打印](http://www.python.org/doc/2.5.2/lib/module-pprint.html)模块会有所帮助：

```
>>> import pprint
>>> pprint.pformat({ "my key": "my value"})
"{'my key': 'my value'}"
>>> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-18T03:57:39.453

我想出了一种“更好”的格式化输出的方法。像往常一样，我试图用更优雅的方法将其消灭。

```
for key, value in sorted(self.dict.items()):
    self.current_list.WriteText(key + " " + str(self.dict[key]) + "\n") 
```

这种方式还按字母顺序对字典进行排序，这在识别已选择或使用的项目时有很大帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-26T12:10:39.710

```
text_for_display = '\n'.join(item + u' ' + unicode(value) for item, value in my_dictionary.items()) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-26T12:17:42.020

使用 % 格式（在 C 中称为 sprintf），例如：

```
"%10s - %d" % dict.items()[0] 
```

*格式字符串中的% 转换规范*的数量应该匹配元组长度，在 dict.items() 的情况下，2\. 字符串格式化操作符的结果是一个字符串，所以使用它作为 SetValue() 的参数是没有问题的. 要将整个 dict 转换为字符串：

```
'\n'.join(("%10s - %d" % t) for t in dict.items()) 
```

格式转换类型在[doc](http://www.python.org/doc/2.5.2/lib/typesseq-strings.html)中指定。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-26T13:16:30.093

该数据似乎更好地显示为表格/网格。

# python - 重构游戏的“命中”值

> ID：237876
> 
> 赞同：1
> 
> 时间：2008-10-26T11:08:32.393
> 
> 标签：python, refactoring

我正在制作游戏，其中一种方法根据技能值计算角色的基本命中数。该方法目前单独计算每个值，因为每个技能都可以在短距离、中距离和长距离上使用。

我最初认为我可以将技能组合成一个元组并对其进行迭代，动态创建每个命中数。但我不知道这是否真的可能，因为我目前将每个命中数分配给它自己的变量。

我还考虑为每个范围创建一个方法，并将元组作为参数传递。我可以使用结果值创建一个新的元组或列表，然后将它们分配给各个变量，但我不知道这样做会比这样做更好，只是它看起来不会那么复制和粘贴.

这是我目前拥有的：

```
 def calcBaseHitNumbers(self, dict):
        """Calculate character's base hit numbers depending on skill level."""

        self.skill_dict = dict

        self.rifle = self.skill_dict.get('CRM', 0)
        self.pistol = self.skill_dict.get('PST', 0)
        self.big_gun = self.skill_dict.get('LCG', 0)
        self.heavy_weapon = self.skill_dict.get('HW', 0)
        self.bow = self.skill_dict.get('LB', 0)
        #self.skill_tuple = (self.rifle, self.pistol, self.big_gun, self.heavy_weapon,
        #    self.bow)

#---Short range
##        for skill in self.skill_tuple:
##            self.base_hit_short = skill * 0.6
        self.charAttribs.bhCRM_short = self.rifle * 0.6
        self.charAttribs.bhPST_short = self.pistol * 0.6
        self.charAttribs.bhHW_short = self.heavy_weapon * 0.6
        self.charAttribs.bhLCG_short = self.big_gun * 0.6
        self.charAttribs.bhLB_short = self.bow * 0.6
#---Med range
        self.charAttribs.bhCRM_med = self.rifle * 0.3
        self.charAttribs.bhPST_med = self.pistol * 0.3
        self.charAttribs.bhHW_med = self.heavy_weapon * 0.3
        self.charAttribs.bhLCG_med = self.big_gun * 0.3
        self.charAttribs.bhLB_med = self.bow * 0.3
#---Long range
        self.charAttribs.bhCRM_long = self.rifle * 0.1
        self.charAttribs.bhPST_long = self.pistol * 0.1
        self.charAttribs.bhHW_long = self.heavy_weapon * 0.1
        self.charAttribs.bhLCG_long = self.big_gun * 0.1
        self.charAttribs.bhLB_long = self.bow * 0.1 
```

您将如何重构它以使其更具动态性？

* * *

**编辑：**我想我想做的是这样的：有一个元组（就像我注释掉的那个）并迭代它 3 次，每次根据每个特定的修饰符创建一个新值（对于每个技能）范围。然后将结果值自动分配给它各自的变量。

在我看来，这是有道理的。但是当我真正尝试编码时，我迷路了。我认为问题在于这是我编写的第一个“真正的”程序。我之前所做的只是小脚本。

这只是我程序的 0.1 版本，所以现在重构它并不重要。但是，手动执行此操作似乎非常不符合 Pythonic，我还想“面向未来”以防万一事情发生变化。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-26T11:42:26.163

感觉就像你真正想要的是一个代表武器的类，具有处理基础值和使用各种修饰符计算命中值的属性。这是一个简单的例子：

```
SHORT_RANGE = 'S'
MEDIUM_RANGE = 'M'
LONG_RANGE = 'L'
SHORT_RANGE_MODIFIER = 0.6
MEDIUM_RANGE_MODIFIER = 0.3
LONG_RANGE_MODIFIER = 0.1

class Weapon(object):
    def __init__(self, code_name, full_name, base_hit_value,
                 short_range_modifier=None, medium_range_modifier=None,
                 long_range_modifier=None):
        self.code_name, self.full_name = code_name, full_name
        self.base_hit_value = base_hit_value
        self.range_modifiers = {
            SHORT_RANGE: short_range_modifier or SHORT_RANGE_MODIFIER,
            MEDIUM_RANGE: medium_range_modifier or MEDIUM_RANGE_MODIFIER,
            LONG_RANGE: long_range_modifier or LONG_RANGE_MODIFIER,
        }

    def hit_value(self, range, modifier=1):
        return self.base_hit_value * self.range_modifiers[range] * modifier 
```

从那里，您可以在 Character 对象中创建 Weapon 实例，如下所示：

```
 self.rifle = Weapon('CRM', 'rifle', 5)
    self.pistol = Weapon('PST', 'pistol', 10) 
```

然后，如果角色在短距离内开枪：

```
 hit_value = self.pistol.hit_value(SHORT_RANGE) 
```

hit_value() 方法的额外参数可用于传递特定于字符或情境的修改。

当然，除此之外的下一步是将武器直接建模为武器的子类（可能分解为特定类型的武器，如枪、弓、手榴弹等，每个都有自己的基本值）并添加一个库存类来表示角色携带的武器。

所有这些都是相当标准的、无聊的面向对象的设计过程，但在很多情况下，这种类型的思维会让你快速起步并提供至少一点基本的灵活性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T11:39:29.587

让我们看看我是否理解你的情况：每种武器都有自己不同的生命值，所以步枪可能有 1，重型武器可能有 2，等等。然后每个角色都有一个短、中、长值乘以生命值武器。

您应该考虑使用策略设计。那就是创建一个具有生命值属性的武器超类。为步枪、手枪、弓等创建子类武器。我确信武器之间的差异不仅仅是生命值。

然后角色根据您的游戏玩法拥有一种或多种武器。计算特定武器的生命值很简单

```
current_weapon * self.medium 
```

如果您决定稍后添加更多武器，那么您不必编辑您的角色代码，因为您的角色可以处理任何武器。

在伪 Python 中

```
class Weapon
    hit = 1
    #other properties of weapon

class Rifle(Weapon)
    #other properties of Rifle

class Pistol(Weapon)
    #other properties of Pistol

class Character
   weapon = Rifle()
   long=0.6
   def calcHit()
      return self.long*weapon.hit

john = Character()
john.weapon= Rifle()
john.calcHit 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-26T11:35:07.303

@Vinko：也许制作calcBaseHitNumbers，在内部进行“如果不是self.calculatedBase：”检查，如果之前已经完成，则无需操作。也就是说，我看不到预先计算这些信息的迫切需要。但我不是 Python 性能专家。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-26T11:39:38.650

你指的是什么动态感？可能会发生什么变化 - 技能的数量，或权重因素，范围的数量（短，中，长）或所有这些？

之后（例如） bhPST_* 值会发生什么 - 它们是否合并为一个数字？

突显出来的一件事是，技能列表是硬连线在代码中的——我倾向于用一种方法替换 bh 变量

所以（请考虑到我不知道关于 Python 的第一件事 :)）

```
def bh_short(self, key)
  skill = self.skill_dict.get(key, 0)
  return skill * 0.6 
```

现在，您可以保留有助于生命值的技能列表并迭代调用 bh_short 等。

可能还将范围（long med short）传递给函数，或返回所有三个值 - 这完全取决于您接下来要使用计算的生命值做什么。

基本上，我们需要更多关于使用上下文的信息

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-27T05:14:52.530

我会有一个用于角色属性的类（所以你在角色类中没有一堆东西）和一个用于武器属性的类：

```
class WeaponAttribute(object):

    short_mod = 0.6
    med_mod = 0.3
    long_mod = 0.1

    def __init__(self, base):
        self.base = base

    @property
    def short(self):
        return self.base * self.short_mod

    @property
    def med(self):
        return self.base * self.med_mod

    @property
    def long(self):
        return self.base * self.long_mod

class CharacterAttributes(object):

    def __init__(self, attributes):
        for weapon, base in attributes.items():
            setattr(self, weapon, WeaponAttribute(base)) 
```

在字符类中有一个`CharacterAttributes`对象并像这样使用它：

```
# Initialise
self.charAttribs = CharacterAttributes(self.skill_dict)
# Get some values
print self.charAttribs.CRM.short
print self.charAttribs.PST.med
print self.charAttribs.LCG.long 
```

# c++ - 如何在OpenGL（使用GLUT）上绘制一个像圆锥体一样的填充信封？

> ID：237899
> 
> 赞同：4
> 
> 时间：2008-10-26T11:32:27.853
> 
> 标签：c++, opengl, glut, freeglut

我正在使用freeglut进行opengl渲染...

我需要绘制一个看起来像锥形（2D）的信封，必须填充一些颜色并应用一些透明度。

freeglut 工具包是否配备了这样的内置功能来绘制填充几何图形（或一些技巧）？或者是否有其他一些对填充几何图形具有内置支持的 api..

**编辑1：** 只是为了澄清2D锥体......包络是飞机在拦截期间（敌机）覆盖区域的图形解释......类似于圆形的扇区......我应该提到扇区反而..

和 glutSolidCone 对我没有帮助，因为我想绘制一个圆形的填充扇区......我已经完成了......剩下要做的就是用一些颜色填充它......如何在 opengl 中用颜色填充几何图形？

**Edit2：** 发布到这个问题的所有答案都可以在某种程度上解决我的问题。但我肯定想知道如何用某种颜色填充几何图形。假设我想绘制一个抛物线的包络线......在这种情况下，将没有默认的 glut 函数来实际绘制一个填充的抛物线（或者有没有？）......所以概括这个问题......如何以某种纯色绘制自定义几何图形？

**Edit3：** mstrobl 发布的答案适用于 GL_TRIANGLES 但对于这样的代码：

```
glBegin(GL_LINE_STRIP);

glColor3f(0.0, 0.0, 1.0);
    glVertex3f(0.0, 0.0, 0.0);
glColor3f(0.0, 0.0, 1.0);
    glVertex3f(200.0, 0.0, 0.0);
glColor3f(0.0, 0.0, 1.0);
    glVertex3f(200.0, 200.0, 0.0);
glColor3f(0.0, 0.0, 1.0);
    glVertex3f(0.0, 200.0, 0.0);
glColor3f(0.0, 0.0, 1.0);
    glVertex3f(0.0, 0.0, 0.0);

glEnd(); 
```

它画了一个正方形...只画了一个有线正方形...我需要用蓝色填充它。

反正要做吗？

如果我为闭合曲线放置一些绘图命令......就像一个馅饼......我需要用颜色填充它有没有办法让它成为可能......

我不知道 GL_TRIANGLES 怎么可能……但是对于任何闭合曲线如何做呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-26T12:24:01.960

我不确定您所说的“信封”是什么意思，但锥体是 glut 具有的原语：

```
glutSolidCone(radius, height, number_of_slices, number_of_stacks) 
```

用颜色填充它的最简单方法是用颜色绘制它。因为你想让它有点透明，你也需要一个 alpha 值：

```
glColor4f(float red, float green, float blue, float alpha)
// rgb and alpha run from 0.0f to 1.0f; in the example here alpha of 1.0 will
// mean no transparency, 0.0 total transparency. Call before drawing. 
```

要进行半透明渲染，必须启用混合。并且您必须设置要使用的混合功能。您想要做的可能会通过以下方式实现。如果您想了解更多信息，请给我留言，我会寻找一些好的指示。但是这里是你的设置：

```
glEnable(GL_BLEND);
glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA); 
```

在进行任何绘图操作之前调用它，可能在程序初始化时。:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-26T12:40:32.397

我记得有一个子程序。不过自己动手也不是什么难事。

但我不明白 2D 的东西。2D圆锥？不就是一个三角形吗？

无论如何，这是在opengl中绘制圆锥的算法

首先取一个圆圈，将其均匀细分，以获得大量边缘。现在选择圆心，从边缘到圆心制作三角形。然后在圆上选择一个点并从边缘到该点制作三角形。

大小形状和方向取决于您用于生成圆和两个点的值。每一步都相当简单，不应该给你带来麻烦。

首先只是细分一个标量值。从 [0-2] 范围开始。取中点 ((start+end)/2) 并用它分割范围。将值存储为对。例如，细分一次应该给你： [(0,1), (1,2)] 递归执行几次，然后计算这些点在圆上的位置。简单的三角函数，只记得在继续之前将值与 π 相乘。在此之后，您有一定数量的边缘。2^n 其中 n 是细分的数量。然后你可以简单地把它们变成三角形，给它们一个顶点。因此，三角形的数量最终为：2^(n+1)。（这些数量有助于了解您是否使用固定大小的数组进行操作。

**编辑：**你真正想要的是一个馅饼。（对不起双关语）

渲染同样简单。您可以再次只使用三角形。只需选择标量范围[-0.25 - 0.25]，细分，投影为圆形，生成一组三角形。

标量 - 圆投影很简单： x=cos(v*pi) *r, y=sin(v* pi)*r 其中 (x,y) 是生成的顶点，r 是半径，三角函数适用于辐射，而不是度数。（如果他们使用度数，请将 pi 替换为 180）

使用顶点缓冲区或列表自己渲染它。

编辑：关于着色问题。glColor4f，如果您希望几何图形的某些部分因颜色而异，您可以为顶点缓冲区本身中的每个顶点指定一种颜色。我现在不知道所有的 API 调用来做这件事，但是 opengl 中的 API 参考是很容易理解的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-27T12:43:29.893

既然你重新澄清了你的问题来要求一个馅饼：使用opengl原语也有一种简单的方法来绘制它：

您将使用 gluSolidSphere() 绘制一个实心球体。但是，由于您只想绘制其中的一部分，因此您只需将不需要的部分剪掉：

```
void glClipPlane(GLenum plane, const GLdouble * equation); 
```

平面是 GL_CLIPPLANE0 到 GL_CLIPPLANEn 并且方程是正常形式的平面方程（a *x + b* y + c*z + d = 0 意味着方程将保持值`{ a, b, c, d }`。请注意，这些是双精度数而不是浮点数。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-28T15:53:35.047

关于颜色的编辑：

OpenGL实际上是一个状态机。这意味着绘制时使用当前材质和/或颜色位置。由于您可能不会使用材料，因此暂时忽略它。你想要颜色。

```
glColor3f(float r, float g, float b) // draw with r/g/b color and alpha of 1
glColor4f(float r, float g, float b, float alpha) 
```

在执行 glColorXX 调用后，这将影响您绘制的任何顶点的颜色、渲染的任何几何体的颜色——无论是 glu 的还是您自己的。如果您绘制带有顶点的面并在 glVertex3f/glVertex2f 调用之间更改颜色，则颜色会被插值。

试试这个：

```
glBegin(GL_TRIANGLES);
glColor3f(0.0, 0.0, 1.0);
glVertex3f(-3.0, 0.0, 0.0);
glColor3f(0.0, 1.0, 0.0);
glVertex3f(0.0, 3.0, 0.0);
glColor3f(1.0, 0.0, 0.0);
glVertex3f(3.0, 0.0, 0.0);
glEnd(); 
```

但是我已经指出了 glColor4f，所以我假设您想在每个顶点的基础上设置颜色。并且您想使用显示列表进行渲染。

就像您可以显示顶点列表一样，您也可以让它们具有颜色列表：您需要做的就是启用颜色列表并告诉 opengl 列表所在的位置。当然，它们需要与顶点列表具有相同的装备（相同的顺序）。

如果你有

```
glEnableClientState(GL_VERTEX_ARRAY);   
glVertexPointer(3, GL_FLOAT, 0, vertices_);
glDisableClientState(GL_VERTEX_ARRAY); 
```

您应该以这种方式添加颜色。它们不必是浮动的；事实上，你告诉它应该是什么格式。对于每个通道 1 个字节和 4 个通道（R、G、B 和 A）的颜色列表，请使用：

```
glEnableClientState(GL_VERTEX_ARRAY);   
glEnableClientState(GL_COLOR_ARRAY);
glVertexPointer(3, GL_FLOAT, 0, vertices_);
glColorPointer(4, GL_UNSIGNED_BYTE, 0, colors_);
glDisableClientState(GL_COLOR_ARRAY);
glDisableClientState(GL_VERTEX_ARRAY); 
```

编辑：忘记添加，然后您必须通过调用[glDrawElements](http://www.opengl.org/documentation/specs/man_pages/hardcopy/GL/html/gl/drawelements.html)告诉 OpenGL 要绘制哪些元素。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-29T14:10:23.850

在 Edit3 上：我理解你的问题的方式是你想让 OpenGL 绘制边框并且它们之间的任何东西都应该用颜色填充。

你的想法是对的，但一条线就是这样 - 一条线，它没有任何区域。

但是，您可以让这些线相互连接以定义一个多边形。这将在每个顶点的基础上填充多边形的区域。调整您的代码：

```
glBegin(GL_POLYGON);

glColor3f(0.0, 0.0, 1.0);
    glVertex3f(0.0, 0.0, 0.0);
glColor3f(0.0, 0.0, 1.0);
    glVertex3f(200.0, 0.0, 0.0);
glColor3f(0.0, 0.0, 1.0);
    glVertex3f(200.0, 200.0, 0.0);
glColor3f(0.0, 0.0, 1.0);
    glVertex3f(0.0, 200.0, 0.0);
glColor3f(0.0, 0.0, 1.0);
    glVertex3f(0.0, 0.0, 0.0);

glEnd(); 
```

但是请注意，以这种方式绘制多边形有两个限制：

*   多边形必须是凸的。
*   这是一个缓慢的操作。

但我假设你只是想完成工作，这会做到的。对于未来，您可能会考虑只对多边形进行三角剖分。

# c# - .NET 版本之间的差异（主要是 c#）

> ID：237908
> 
> 赞同：3
> 
> 时间：2008-10-26T11:42:31.140
> 
> 标签：c#, .net, versions

最近有人要求我推荐一个 .NET 框架版本，以便在 XP 机器的（基于 GUI 的）项目中使用。

谁能解释所有 .NET 版本之间的区别？

或者，

有没有人很好地参考了一个详细说明（简要）差异的网站？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-26T11:58:49.703

Jon Skeet 的*C# In Depth*一书中有一节详细描述了 .NET 的版本。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-26T11:56:46.230

**不**使用最新版本的唯一原因是它会使部署复杂化。

.NET 2.0 是通过 Windows 更新自动安装的，因此您可以在部署应用程序时将其安装在目标计算机上。.NET 3.5 尚未自动推送，因此您需要将框架与您的应用程序一起分发。这可能会在不久的将来改变。

如果您不关心部署，请选择最新版本。您以 .NET 3.5 框架为目标这一事实并不意味着您必须使用所有新技术。例如，您仍然可以使用 Windows 窗体而不是 WPF，但这是另一个问题。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-26T11:44:34.333

简短的回答是视情况而定。

.NET 2.0 是您应该考虑的最旧版本。

.NET 3.0 是从 2.0 升级的简单途径，与从 1.1 到 2.0 的重大更改不同。然而，它更像是功能的横向扩展，您不会看到图形选项的巨大变化。

如果您对更复杂的 gui（例如 sliverlight）感兴趣，则应该查看 .NET 3.5。它提供了更多新技术和选项，包括 WPF、Expression 中的新 IDE 等等。 [http://www.asp.net](http://www.asp.net)不会是一个糟糕的开始。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-26T11:45:59.993

此页面适用于更改列表：

[http://en.wikipedia.org/wiki/Microsoft_.NET](http://en.wikipedia.org/wiki/Microsoft_.NET)

正如有人已经提到的，.NET 2.0 是您需要查看的**最低版本。**诸如泛型之类的东西使它成为必须的。

.NET 3.5 是您应该考虑的另一个版本。这取决于你想如何设计你的项目，.NET 2.0 是非常以开发人员为中心的，而 .net 3.5 在设计人员和开发人员之间有很好的划分。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-26T12:04:05.903

这并不重要。.NET 2.0、3.0 和 3.5 都使用完全相同的 CLR 和基类。每个版本只是添加了一组新程序集。对于 GUI 开发，如果您使用 Windows 窗体，则可以使用 2.0，而 WPF 则需要 3.0。由于它们在其他方面基本相同，因此没有充分的理由不只安装 3.5 SP1。

# c# - RedirectStandardOutput 是缓冲行而不是瞬时的？

> ID：237914
> 
> 赞同：0
> 
> 时间：2008-10-26T11:46:47.887
> 
> 标签：c#, monitoring, stdout

好的，我正在尝试使用 Tail 来监视日志文件，但是我无法以编程方式获得与使用相同参数通过 cmd 提示符手动运行它时相同的行为。

通过 cmd 提示符运行时，它会**立即**显示新行。不过，以编程方式，在“缓冲区”释放所有行之前，我必须等待日志文件中大约**75 多个新**行。

这是我现在拥有的代码。

```
private const string tailExecutable = @"C:\tail.exe";
private const string logFile = @"C:\test.log";

private static void ReadStdOut()
{
    var psi = new ProcessStartInfo
    {
        FileName = tailExecutable,
        Arguments = String.Format("-f \"{0}\"", logFile),
        UseShellExecute = false,
        RedirectStandardOutput = true
    };

    // Running same exe -args through cmd.exe 
    // works perfectly, but not programmatically.
    Console.WriteLine("{0} {1}", psi.FileName, psi.Arguments);

    var tail = new Process();
    tail.StartInfo = psi;
    tail.OutputDataReceived += tail_OutputDataReceived;
    tail.Start();
    tail.BeginOutputReadLine();
}

static void tail_OutputDataReceived(object sender, DataReceivedEventArgs e)
{
    Console.WriteLine(e.Data);
} 
```

我之前使用过 OutputDataReceived 事件，但从未遇到过这些缓冲/垃圾邮件问题。

我现在很困惑。

## ***编辑***

我[在 CodeProject 上找到了这个 wintail 项目，](http://www.codeproject.com/KB/cs/wintail.aspx)并且将切换到该项目，因为缓冲区使这个解决方案太慢了。

感谢您的回答。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-26T12:30:28.437

Process.StandardOutput，当重定向时，默认为一个带有 4096 字节缓冲区的 StreamReader，所以答案是肯定的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T12:27:48.880

在大多数语言和操作系统中，标准流通常是缓冲的，但错误流不是。

尝试使用： `System.Console.Error`

# iphone - 将多个视图添加到选项卡控制器内的视图控制器

> ID：237921
> 
> 赞同：1
> 
> 时间：2008-10-26T11:56:39.053
> 
> 标签：iphone, objective-c, cocoa-touch

我有一个 tabview 控制器，我在每个选项卡中添加了一个 UIViewController。我想在 UIViewController 中有多个 UIView。

所以在 UIViewController 类的实现中我添加了 [self.view addSubView:uiview1] 和 [self.view addSubView:uiview2]。问题是当我运行应用程序时，它在加载时崩溃。

但是，如果我只使用了一个 UIView 并且做了： self.view = UIView1 那会很好用。

有谁知道是什么导致了这个问题？或者，如果我做的事情根本上是错误的？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-26T17:05:21.207

假设您以编程方式执行此操作，您应该在视图控制器的 loadView 方法中创建视图。所以你必须这样做：

```
self.view = [[[UIView alloc] initWithFrame:someFrame] autorelease]; 
```

在你这样做之前：

```
[self.view addSubview:uiview1];
[self.view addSubview:uiview2]; 
```

否则，self.view 将为零。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T12:45:14.540

没有理由在 UIViewController 的主视图成员变量中不能有多个视图。但是，您的问题中有很多问题没有得到解答：

*   你是如何获得 view1 和 view2 的？
*   它们是您的 XIB 文件中的出口（您是在使用 XIB 文件，还是在代码中创建所有内容），还是在代码中创建它们？
*   您在 UIViewController 子类中的哪个位置将它们添加到您的视图成员变量中？
*   崩溃时打印到控制台的消息是什么？

# xml - 如何将 xsd 转换为人类可读的文档？

> ID：237938
> 
> 赞同：46
> 
> 时间：2008-10-26T12:11:56.480
> 
> 标签：xml, xsd

我们有一些基于 XML 的接口，这些接口在 XSD 模式中有很好的记录。这些接口现在将公开可用，我们希望为它们创建参考文档。

有没有工具可以自动将 XSD 文件转换成更易读的格式？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-27T04:22:42.370

[xs3p](http://xml.fiforms.org/xs3p/)可能会做你想做的事（另请参阅[他们的 SourceForce 页面](https://sourceforge.net/projects/xs3p/)）。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2010-02-01T12:16:20.763

将其插入 XSD 的顶部

```
<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="xs3p.xsl"?> 
```

然后您可以使用网络浏览器直接查看 XSD 文件。Web 浏览器使用指定的 XSLT 转换为 HTML。

您*不需要*XSL 处理器，但是像 xs3p 这样的样式表不会使用这种方法生成链接。我使用 Firefox 网络浏览器，IE8 似乎对此毫无用处。

我试过这些 xsl 样式表： [https://sourceforge.net/projects/xs3p/files/xs3p-1.1.3.zip/download](https://sourceforge.net/projects/xs3p/files/xs3p-1.1.3.zip/download) [http://crism.maden.org/consulting/pub/xsl/xsd2html.xsl](http://crism.maden.org/consulting/pub/xsl/xsd2html.xsl)

我想我更喜欢xs3p。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-26T19:20:27.130

[oXygen](http://www.oxygenxml.com)有非常好的[XSD 模式文档工具](http://www.oxygenxml.com/xml_schema_documentation.html)，允许通过选项和附加 CSS 文件轻松自定义。

我以前没有使用过它，但[FlexDoc/XML](http://www.flexdoc.xyz/flexdoc-xml/)是一个 XML 文档工具，带有一个名为[XSDDoc](http://www.flexdoc.xyz/flexdoc-xml/xsddoc/)的 XSD 文档组件，看起来很有趣。

当然，正如其他答案中所指出的那样，XSD 只是一个 XML 文件，因此可以编写自定义 XSLT 来生成您喜欢的任何文档输出。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-27T02:36:51.193

您不想使用通用工具来记录您的模式的可能性很大。模式文档工具（我最熟悉 XML Spy 中的那个）旨在使模式可读。根据您的描述，这听起来并不是您真正想要的；您想要的是使用架构中的信息作为软件文档的基础。

当我需要这样做时，我采用的方法是设计看起来与我需要文档一样的 HTML，然后找出我需要抓取模式中的哪些信息来填充它。使用它作为模板，使用 XSLT 从模式中提取相关信息非常简单。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-27T04:10:14.687

过去，我使用在 Freshmeat.net 上找到的名为[xsddoc](http://xframe.sourceforge.net/xsddoc/index.html)的工具生成了文档。刚才查看它（以获取直接链接），我发现它已被其开发人员用一个名为[xnsdoc](http://www.buldocs.com/xnsdoc/)的工具取代。较新的版本可供开源项目免费使用，但如果您将其用于商业产品，您可能需要获得许可。如果在“xsddoc”横幅下发布的最后一个版本适合您的目的，那么您可以使用那个版本。

它生成的文档具有 Javadoc 的外观和感觉，并允许对样式表等进行某种程度的控制。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-26T15:00:02.117

XSLT 脚本可以完成这项工作。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-09-23T07:07:11.137

如果您准备好深入研究[Sandcastle](http://sandcastle.codeplex.com/)的复杂性，我强烈推荐[XML Schema Documenter](http://xsddoc.codeplex.com/)，它是出色的[Sandcastle Help File Builder](http://shfb.codeplex.com/)的插件。

可能的输出与 Sandcastle 相同：网站、HTML 帮助 (CHM) 文件、[MS Help 2](http://en.wikipedia.org/wiki/Microsoft_Help_2)内容、[MS Help Viewer 1](http://en.wikipedia.org/wiki/Microsoft_Help_System) ...

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2008-10-26T12:59:18.583

[将它（或提前编写）转换为docbook](http://www.docbook.org/)格式应该不难。

# code-reuse - 如何索引和提供可重用代码？

> ID：237946
> 
> 赞同：6
> 
> 时间：2008-10-26T12:20:11.203
> 
> 标签：code-reuse

我有许多包含代码片段、伪代码算法、类、模板、SQL 示例等的小文件，我显然不能将所有这些都放入库中。我需要一种实用的方法来索引所有这些，并且能够使该索引可供其他人使用。

1.  这样的索引必须包含什么才能使搜索变得最容易？
2.  网络上有没有这样的存储库？（所以我可以测试他们使用的技术。）
3.  是否有任何已经编写的应用程序可以实现这一点，我可以看看？

可能重复：[https ://stackoverflow.com/q/90300/15161](https://stackoverflow.com/q/90300/15161)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-26T12:36:00.737

如果您正在使用 .NET / Visual Studio，您可以考虑将它们添加为[代码片段](http://msdn.microsoft.com/en-us/vs2005/aa718338.aspx)

[Code Keep](http://www.codekeep.net/)是 CodeSnippets 的一个非常好的在线存储库，并且有 VS2008 的插件

我们在工作中所做的是创建了一个供开发人员使用的通用帐户，因此每个人都可以在一个通用登录名下提交到 codekeep，然后可以检索其他人的代码片段。

此外，在您的开发网络上创建开发人员 wiki 可能也是值得的。老手可以在某个地方留下有关您经常使用的模式和片段的文档，新团队成员可以寻求帮助。我们在内部使用[TRAC](http://trac.edgewall.org/)作为一个多合一的 WIKI / 问题管理 / SVN 集成，它可以很好地完成工作

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-26T12:50:35.043

搜索 StackOverflow 的另一个类似结果：[存储代码片段的最佳应用程序](https://stackoverflow.com/questions/212634/best-application-for-storing-code-snippets)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-26T12:44:44.087

您可能想尝试[refactormycode.com](http://refactormycode.com)或为其设置自己的 wiki。在这里，wiki 实际上听起来像是一个很好的应用程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-26T14:53:51.737

我发现管理源代码的唯一方法是在源代码控制存储库中。这包括模板和伪代码算法。它与您的其他代码有何不同？我熟悉可以在[此处托管的](https://www.freepository.com/)[cvs](http://ximbiot.com/cvs/wiki/)（设置 cvs 服务器也不是一项复杂的任务），您可以使用[cvsearch搜索存储库并使用](http://cvssearch.sourceforge.net/)[cvs Web 客户端](http://sourceforge.net/projects/cvswebclient/)浏览它。 我并不是说 cvs 是一个最好的选择，只是另一个可以满足你所有需要的选择。

代码片段不是一个好的选择，恕我直言。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-26T15:59:21.043

[您可以使用Copernic](http://www.copernic.com/en/products/desktop-search/home/download.html)、[Windows Live Search](http://www.microsoft.com/windows/products/winfamily/desktopsearch/choose/windowssearch4.mspx?tab=Install%20It)或[Google Desktop](http://desktop.google.com/index.html?ignua=1)等工具对硬盘驱动器进行全文索引。然后，每当您想要执行特定操作的代码片段时，只需搜索相关关键字即可。

# wpf - WPF BitmapImage 宽度/高度始终为 1？

> ID：237959
> 
> 赞同：3
> 
> 时间：2008-10-26T12:32:22.693
> 
> 标签：wpf, bitmapimage

我不明白...

```
BitmapImage img = new BitmapImage(myUri);
Console.WriteLine("Width: {0}, Height: {1}", img.Width, img.Height); 
```

输出：“宽度：1，高度：1”。

我已经尝试过 PixelWidth/PixelHeight，我尝试过使用`BeginInit`/手动创建它`EndInit`并且还设置`PreservePixelFormat`...没有任何效果。

（除了，更奇怪的是：这都是用户单击按钮并下载一些图像的过程的一部分。好吧，*第二*次单击该按钮时，它*确实*具有非 1 宽度/高度。）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-26T15:20:08.940

用户第一次单击按钮时，位图还没有下载——所以你对它做的任何事情都会导致垃圾结果（除了显示它，因为 Image 控件知道如何处理它）。

您可以处理 BitmapImage.DownloadCompleted 事件以了解位图何时可用。

# java - 如何使用 @Configurable 和 readResolve() 来注入我的依赖项

> ID：237966
> 
> 赞同：1
> 
> 时间：2008-10-26T12:38:46.753
> 
> 标签：java, spring, serialization

我为我的应用程序开发的框架非常依赖于动态生成的域对象。我最近开始使用 Spring WebFlow，现在需要能够序列化将保留在流范围内的域对象。

我做了一些研究，发现我可以使用`writeReplace()`and `readResolve()`。唯一的问题是我需要在 Spring 上下文中查找工厂。我尝试`@Configurable(preConstruction = true)`与 BeanFactoryAware 标记接口结合使用。

但`beanFactory`总是`null`当我尝试在我的`createEntity()`方法中使用它时。既不调用默认构造函数，也不`setBeanFactory()`调用注入器。

有没有人试过这个或类似的东西？我在下面包括了相关的课程。

在此先感谢，布赖恩

```
/*
 *  Copyright 2008 Brian Thomas Matthews Limited.
 *  All rights reserved, worldwide.
 *
 *  This software and all information contained herein is the property of
 *  Brian Thomas Matthews Limited. Any dissemination, disclosure, use, or
 *  reproduction of this material for any reason inconsistent with the
 *  express purpose for which it has been disclosed is strictly forbidden.
 */

package com.btmatthews.dmf.domain.impl.cglib;

import java.io.InvalidObjectException;
import java.io.ObjectStreamException;
import java.io.Serializable;
import java.lang.reflect.InvocationTargetException;
import java.util.HashMap;
import java.util.Map;

import org.apache.commons.beanutils.PropertyUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.BeanFactory;
import org.springframework.beans.factory.BeanFactoryAware;
import org.springframework.beans.factory.annotation.Configurable;
import org.springframework.util.StringUtils;

import com.btmatthews.dmf.domain.IEntity;
import com.btmatthews.dmf.domain.IEntityFactory;
import com.btmatthews.dmf.domain.IEntityID;
import com.btmatthews.dmf.spring.IEntityDefinitionBean;

/**
 * This class represents the serialized form of a domain object implemented
 * using CGLib. The readResolve() method recreates the actual domain object
 * after it has been deserialized into Serializable. You must define
 * &lt;spring-configured/&gt; in the application context.
 * 
 * @param <S>
 *            The interface that defines the properties of the base domain
 *            object.
 * @param <T>
 *            The interface that defines the properties of the derived domain
 *            object.
 * @author <a href="mailto:brian@btmatthews.com">Brian Matthews</a>
 * @version 1.0
 */
@Configurable(preConstruction = true)
public final class SerializedCGLibEntity<S extends IEntity<S>, T extends S>
    implements Serializable, BeanFactoryAware
{
    /**
     * Used for logging.
     */
    private static final Logger LOG = LoggerFactory
        .getLogger(SerializedCGLibEntity.class);

    /**
     * The serialization version number.
     */
    private static final long serialVersionUID = 3830830321957878319L;

    /**
     * The application context. Note this is not serialized.
     */
    private transient BeanFactory beanFactory;

    /**
     * The domain object name.
     */
    private String entityName;

    /**
     * The domain object identifier.
     */
    private IEntityID<S> entityId;

    /**
     * The domain object version number.
     */
    private long entityVersion;

    /**
     * The attributes of the domain object.
     */
    private HashMap<?, ?> entityAttributes;

    /**
     * The default constructor.
     */
    public SerializedCGLibEntity()
    {
        SerializedCGLibEntity.LOG
            .debug("Initializing with default constructor");
    }

    /**
     * Initialise with the attributes to be serialised.
     * 
     * @param name
     *            The entity name.
     * @param id
     *            The domain object identifier.
     * @param version
     *            The entity version.
     * @param attributes
     *            The entity attributes.
     */
    public SerializedCGLibEntity(final String name, final IEntityID<S> id,
        final long version, final HashMap<?, ?> attributes)
    {
        SerializedCGLibEntity.LOG
            .debug("Initializing with parameterized constructor");

        this.entityName = name;
        this.entityId = id;
        this.entityVersion = version;
        this.entityAttributes = attributes;
    }

    /**
     * Inject the bean factory.
     * 
     * @param factory
     *            The bean factory.
     */
    public void setBeanFactory(final BeanFactory factory)
    {
        SerializedCGLibEntity.LOG.debug("Injected bean factory");

        this.beanFactory = factory;
    }

    /**
     * Called after deserialisation. The corresponding entity factory is
     * retrieved from the bean application context and BeanUtils methods are
     * used to initialise the object.
     * 
     * @return The initialised domain object.
     * @throws ObjectStreamException
     *             If there was a problem creating or initialising the domain
     *             object.
     */
    public Object readResolve()
        throws ObjectStreamException
    {
        SerializedCGLibEntity.LOG.debug("Transforming deserialized object");

        final T entity = this.createEntity();
        entity.setId(this.entityId);
        try
        {
            PropertyUtils.setSimpleProperty(entity, "version",
            this.entityVersion);
            for (Map.Entry<?, ?> entry : this.entityAttributes.entrySet())
            {
                PropertyUtils.setSimpleProperty(entity, entry.getKey()
                    .toString(), entry.getValue());
            }
        }
        catch (IllegalAccessException e)
        {
            throw new InvalidObjectException(e.getMessage());
        }
        catch (InvocationTargetException e)
        {
            throw new InvalidObjectException(e.getMessage());
        }
        catch (NoSuchMethodException e)
        {
            throw new InvalidObjectException(e.getMessage());
        }
        return entity;
    }

    /**
     * Lookup the entity factory in the application context and create an
     * instance of the entity. The entity factory is located by getting the
     * entity definition bean and using the factory registered with it or
     * getting the entity factory. The name used for the definition bean lookup
     * is ${entityName}Definition while ${entityName} is used for the factory
     * lookup.
     * 
     * @return The domain object instance.
     * @throws ObjectStreamException
     *             If the entity definition bean or entity factory were not
     *             available.
     */
    @SuppressWarnings("unchecked")
    private T createEntity()
        throws ObjectStreamException
    {
        SerializedCGLibEntity.LOG.debug("Getting domain object factory");

        // Try to use the entity definition bean

        final IEntityDefinitionBean<S, T> entityDefinition = (IEntityDefinitionBean<S, T>)this.beanFactory
            .getBean(StringUtils.uncapitalize(this.entityName) + "Definition",
                IEntityDefinitionBean.class);

        if (entityDefinition != null)
        {
            final IEntityFactory<S, T> entityFactory = entityDefinition
                .getFactory();
            if (entityFactory != null)
            {
                 SerializedCGLibEntity.LOG
                    .debug("Domain object factory obtained via enity definition bean");

                 return entityFactory.create();
            }
        }

        // Try to use the entity factory

        final IEntityFactory<S, T> entityFactory = (IEntityFactory<S, T>)this.beanFactory
            .getBean(StringUtils.uncapitalize(this.entityName) + "Factory",
                IEntityFactory.class);

        if (entityFactory != null)
        {
            SerializedCGLibEntity.LOG
                .debug("Domain object factory obtained via direct look-up");

            return entityFactory.create();
        }

        // Neither worked!

        SerializedCGLibEntity.LOG.warn("Cannot find domain object factory");

        throw new InvalidObjectException(
            "No entity definition or factory found for " + this.entityName);
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T20:41:38.027

你用的是弹簧的`ApplicationContext`，还是`BeanFactory`？如果你正在使用`ApplicationContext`，你可以实现 ApplicationContextAware 而不是 spring 将为你提供应用程序上下文。我以前从未使用过弹簧`BeanFactory`，但我使用过`ApplicationContext`并且它有效。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-01T10:39:42.457

您确定您的 Configurable 类已通过使用 ApsectJ 编译器或运行时编织对其进行正确编织。

您还需要在配置文件中指定将 bean 标记为原型的属性。类似于以下内容：

`<aop:spring-configured />`
`<bean class="package.name.SerializedCGLibEntity" scope="prototype">`
`<property name="beanFactory" value="whateverValue"/>`
`</bean>`

# mysql - 全文搜索相关性是用什么来衡量的？

> ID：237970
> 
> 赞同：15
> 
> 时间：2008-10-26T12:40:48.340
> 
> 标签：mysql, performance, relevance, full-text-search

我正在制作一个测验系统，当测验制作者将问题插入问题库时，我将检查数据库中是否存在重复/非常相似的问题。

测试 MySQL 的[MATCH() ... AGAINST()](http://dev.mysql.com/doc/refman/5.0/en/fulltext-search.html#function_match)，当我针对 100% 相似的字符串进行测试时，我得到的最高相关性是 30+。

那么相关性究竟是什么？引用[手册](http://dev.mysql.com/doc/refman/5.0/en/fulltext-natural-language.html)：

> 相关性值是非负浮点数。零相关性意味着没有相似性。相关性是根据行中的单词数、该行中的唯一单词数、集合中的单词总数以及包含特定单词的文档（行）数来计算的。

我的问题是如果字符串重复，如何测试相关性值。如果它是 100% 重复的，请防止它被插入到问题库中。但如果只是如此相似，提示测验者验证，插入与否。那么我该怎么做呢？100% 相同字符串的 30+ 不是百分比，所以我很难过。

提前致谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-26T14:31:16.510

文本检索系统的基本数据结构是[倒排索引](http://en.wikipedia.org/wiki/Inverted_index)。这本质上是在文档集合中找到的单词列表以及它们出现的文档列表。它还可以包含有关每个文档出现的元数据，例如单词出现的次数。

可以通过对搜索词进行匹配来查询包含这些词的文档。为了确定相关性，对命中计算称为[余弦排名的启发式方法。](http://www.stanford.edu/class/cs276a/handouts/lecture7.ppt)这通过为 n 个搜索词中的每一个构建具有一个分量的 n 维向量来工作。如果需要，您还可以对搜索词进行加权。这个向量在 n 维空间中给出了一个与您的搜索词相对应的点。

可以从倒排索引构造基于每个文档中的加权出现的相似向量，其中向量中的每个轴对应于每个搜索词的轴。如果你计算这些向量的点积，你会得到它们之间夹角的余弦值。1.0 等价于 cos (0)，假设向量从原点占据一条公共线。向量越接近，角度越小，余弦越接近 1.0。

[如果您按余弦对搜索结果进行排序（或像mg](http://www.nzdl.org/html/mg.html)那样将它们放入优先级队列中），您将获得最相关的结果。更聪明的相关性算法倾向于调整搜索词的权重，使点积偏向具有高相关性的词。

如果您想深入了解一下，Bell[和](http://www.cosc.canterbury.ac.nz/tim.bell/)Moffet[的《](http://www.cs.mu.oz.au/~alistair/)[管理千兆字节](https://rads.stackoverflow.com/amzn/click/com/1558605703)》讨论了文本检索系统的内部架构。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-26T15:47:28.447

andygeers 走在正确的轨道上：这些数字除了彼此之间的关系之外没有任何经验意义，并且不能单独用于确定什么是“精确匹配”或不是“精确匹配”。你需要自己确定。即使除了全文搜索排名的限制之外，还有一个悬而未决的问题，即您认为什么才能构成“完全匹配”。（仅实际文本或 soundex 匹配是否计算在内？同义词（例如，“couch”与“sofa”）是否计为匹配或不同？是否应该尝试弥补拼写错误？等等）

如果我需要执行这样的检查，我将只获取全文搜索返回的排名最高的条目，删除任何指定的停用词，规范化空格，转换为小写，进行比较，然后将其保留，直到遇到一个需要进一步完善的案例。这实际上并没有那么*多*额外的工作——如果你指定你的应用程序使用的语言，你可能会在这里找到可以用十几行代码编写规范化函数的人。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-26T13:11:58.590

我不知道您正在使用的 MySQL 函数的细节，但我想这些数字可能没有绝对意义——它们只是被设计用于与同一函数产生的其他值进行比较。要检查绝对匹配，您可以选择文本本身并手动比较。

# asp.net-mvc - ASP.Net MVC - 重定向到路由提供重定向循环

> ID：237977
> 
> 赞同：5
> 
> 时间：2008-10-26T12:48:50.960
> 
> 标签：asp.net-mvc, url-redirection

这可能是那些简单的问题之一。我试图在用户成功通过身份验证后重定向用户，或者将他们返回到登录页面。但是成功页面在不同的路线上，我无法让重定向工作..

这是我在 Globals.asax 中的路线：

```
routes.MapRoute( _
    "Default", _
    "{controller}/{action}/{id}", _
    New With {.controller = "Login", .action = "Index", .id = ""} _
    )
routes.MapRoute( _
    "Stuff", _
    "{controller}/{action}/{id}", _
    New With {.controller = "Stuff", .action = "Index", .id = ""} _
    ) 
```

我有 2 个控制器：`LoginController.vb`和`StuffController.vb`. 该`Views/Login/Index.aspx`文件包含一个带有代码的简单表单：

```
<form method="post" action="/Login/Authenticate"> 
```

`LoginController`包含以下代码：

```
Function Authenticate() As RedirectToRouteResult
    ' authentication code commented out  ;o)

    Return RedirectToRoute("Stuff")
End Function 
```

StuffController 包含以下内容：

```
Function Index()
    ' show stuff..

    Return View()    ' return /Views/Stuff/Index.aspx
End Function 
```

这是我到目前为止所尝试的：

*   功能验证（）
*   函数 Authenticate() As ActionResult()
*   函数 Authenticate() As RedirectToRouteResult()

所有这些都会导致浏览器中的重定向循环超时。我错过了什么？！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2010-11-29T09:51:37.253

正确答案很好，但是：

*   如果您想将控制器/动作名称从 Staff/Index 更改为其他名称怎么办？

- 那么您不仅需要更改 global.asax 中的值，还需要更改使用该技术的所有地方的值。

我的建议：

```
return RedirectToRoute("Stuff", (RouteTable.Routes["Stuff"] as Route).Defaults); 
```

现在，在这种情况下，您不会传递相应的 Stuff/Index 控制器/动作的名称。这将使您轻松管理更改。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-26T13:06:03.827

会不会是您的 Stuff 路由与默认路由的格式完全相同，所以当您调用

```
Return RedirectToRoute("Stuff"); 
```

结果 url 的格式为：{controller}/{action}/{id}，例如再次登录/验证，因为您在登录控制器的验证操作中。

尝试

```
RedirectToAction("Index", "Stuff"); 
```

希望有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-26T12:54:46.533

我看不到您在哪里设置身份验证 cookie 或将用户标记为已通过任何方式进行身份验证。是在您省略的代码中吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-26T10:27:17.213

尝试

```
routes.MapRoute( _    
"Stuff", _
"",_  
New With {.controller = "Stuff", .action = "Index", .id = ""} _    
) 
```

# c++ - 什么是 std::safe_string？

> ID：237978
> 
> 赞同：7
> 
> 时间：2008-10-26T12:50:01.910
> 
> 标签：c++, string

我的一个问题的[答案](https://stackoverflow.com/questions/61278/quick-and-dirty-way-to-profile-your-code#231614)包括以下代码行：

```
label = std::safe_string(name); // label is a std::string 
```

意图似乎是一个字符串文字的包装器（所以大概没有分配发生）。我从来没有听说过`safe_string`，显然也没有[谷歌](http://www.google.com/search?q=%22std%3A%3Asafe_string%22)（我也无法在 98 标准中找到它）。

有谁知道这是关于什么的？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-26T13:52:22.547

在搜索[谷歌代码搜索](http://www.google.com/codesearch)后（我应该首先想到这个......）我发现了这个：

```
//tools-cgi.cpp
string safe_string (const char * s)
{
    return (s != NULL) ? s : "";
} 
```

它将`NULL`s 转换为零长度字符串。尽管这不是标准的，但它可能是答案中提到的特定 STL 实现中的某种扩展。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-26T13:35:23.470

没有标准的安全字符串。您在该回答者的响应中看到的 safe_string 来自一个看起来像私有 STL 扩展实用程序库的东西。

[谷歌搜索“slext/stringext.h”](http://www.google.com/search?q=stlext%2Fstringext.h)，你会在另一个论坛的帖子中看到相同的库。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-26T13:15:18.927

没有这样的事情`std::safe_string`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-26T14:50:56.470

它不是 C++ 标准的一部分（但也许应该是？）

我一直在使用相同类型的辅助函数来避免 std::string 抛出带有 NULL char * 字符串的异常。但它更像是：

```
// defined somewhere else as ""
extern const char * const g_strEmptyString ;

inline const char * safe_string(const char * p)
{
   return (p) ? (p) : (g_strEmptyString) ;
} 
```

没有开销，并且当我向它提供一个可能为 NULL 的 char * 字符串时 std::string 不会崩溃，但在这种特殊情况下，它应该表现为一个空字符串。

# configuration - 如何在 Firefox 3 中自动更改某些网站的 url

> ID：237981
> 
> 赞同：0
> 
> 时间：2008-10-26T12:51:27.117
> 
> 标签：configuration, firefox-3

我希望一些特定的网址（例如“springer.com”）自动转换为“springer.com.proxy1.mycollege.edu”。第二个 url 通过我的大学图书馆网关将我带到 springer 站点；我能够访问一些原本会受到限制的部分。

有没有办法在firefox 3中自动转换上面的url？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-26T13:25:42.820

可以使用您的主机文件来欺骗 Firefox 在正确的位置寻找 springer.com。

[http://en.wikipedia.org/wiki/Hosts_file](http://en.wikipedia.org/wiki/Hosts_file)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-26T14:19:46.610

您可以使用 Greasemonkey 来完成此类任务。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-26T14:43:09.980

解决您的问题的一种方法是运行像[Squid](http://www.squid-cache.org/)这样的 Web 代理，针对您的校园 LDAP 目录配置身份验证，并使用[代理自动配置](http://en.wikipedia.org/wiki/Proxy_auto-config)文件使浏览器通过您的代理。

# eclipse - 在eclipse中存储代码片段

> ID：237987
> 
> 赞同：66
> 
> 时间：2008-10-26T13:03:39.823
> 
> 标签：eclipse, code-snippets

在使用 vi 和 gvim 20 年后，我最近半转换为 Eclipse。我对 gvim 怀念的一件事是，我可以将一堆不同的代码片段剪切到命名缓冲区中，并在执行诸如重复常见习语之类的事情时随意粘贴它们。例如我有它所以`"ap`会粘贴

```
DatabaseHandle handle = null;
try
{
  handle = DatabaseConnectionPool.newHandle(); 
```

然后`"bp`粘贴

```
 handle.commit();
}
finally
{
  handle.rollback();
  DatabaseConnectionPool.returnHandle(handle);
} 
```

我可以在一天中一遍又一遍地重复它们。在回答另一个问题时，有人提到您可以在 Eclipse 中“管理代码片段”，但没有提及如何。所以现在我要问：如何在 Eclipse 中管理代码片段？

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2008-10-26T14:03:03.383

您可能希望将这两个片段存储到[代码模板](http://waynebeaton.wordpress.com/2006/02/27/code-template-expansion-in-eclipse/)中，如[本教程](http://web.archive.org/web/20140208040332/http://www.java-tips.org/other-api-tips/eclipse/how-to-add-your-own-code-template-in-eclipse.html)中所述。

并且不要忘记在[剪贴簿](http://www.eclipsezone.com/eclipse/forums/t61137.html)中快速执行任何类型的 java 代码片段的可能性（不完全是您想要的，但它有时会派上用场）

[Newtopian](https://stackoverflow.com/users/25812/newtopian)补充说（在评论中）

> 事实上，通过在其中添加变量和制表位，模板变得更加强大，因此您上面的示例将变为**`dbHandle ctrl+space`**. 它会从两个部分复制片段并将光标放在中间。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2011-06-12T11:31:55.600

Eclipse 还提供了与 VonC 所描述的模板特性非常相似的东西，称为（你相信吗）片段。窗口 > 显示视图 > 片段。

要添加新的片段类别： 在片段窗口中右键单击并单击自定义... 单击新建 > 新类别。必要时输入类别名称（例如“Java”）。单击应用。选择您选择的类别后，单击新建 > 新项目。输入您的代码段。

要使用片段，请将光标放在要插入片段的位置，然后双击片段窗口中的片段。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-11-07T21:31:02.337

我最近遇到了[Snip2Code](http://marketplace.eclipse.org/node/478177)插件。它完成了工作，我可以快速收集和搜索片段。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2015-11-02T19:14:35.770

一张图值一千字，那这张呢？

[![在此处输入图像描述](https://i.stack.imgur.com/n9ovW.png)](https://i.stack.imgur.com/n9ovW.png)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-09-25T12:29:30.610

问题很旧，但答案的链接较旧；）

这是一个很好的教程： [http ://www.dansshorts.com/post/creating-snippets-in-eclipse](http://www.dansshorts.com/post/creating-snippets-in-eclipse)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-09-16T14:49:05.217

我在一些 IDE 中使用了片段，例如 Dreamweaver 和 Homesite，一个旧的 Coldfusion IDE。我还在 MySQL Workbench 中使用了很多片段——我在其中输入了很多 SQL，在那里非常方便。

我现在使用**Eclipse Java EE IDE for Web Developers Version Indigo Release并在****Window|Show View|Other...|General|Snippets** 中找到了片段面板。我能够操纵它并弄清楚如何将我想要的代码添加为片段以及如何有效地使用它。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-03-30T14:01:46.770

使用 Eclipse Snipmatch（Eclipse for Java Developers Package 的一部分）。

*   适用于 Java 代码片段，但也适用于任何其他语言，如 HTML、ABABP、PHP 等。
*   您可以将编辑器中的任何代码片段直接转换为代码模板。突出显示您要转换为片段的代码，上下文菜单“创建片段”，填写表格并完成。
*   片段可以通过 Git 存储库与您的团队成员共享

手册： [https ://www.eclipse.org/recommenders/manual/#snipmatch](https://www.eclipse.org/recommenders/manual/#snipmatch)

安装： [https ://marketplace.eclipse.org/content/snipmatch](https://marketplace.eclipse.org/content/snipmatch)

# direct3d - 顶点和丢失的设备

> ID：237988
> 
> 赞同：1
> 
> 时间：2008-10-26T13:04:21.803
> 
> 标签：direct3d

在 Direct3D 应用程序（托管）中，是否应该在每次丢失设备时重新创建顶点缓冲区？

我正在开发的应用程序是一个 windows CAD 应用程序。不是游戏。我想我可以在我的 3D 模型更改时生成顶点缓冲区。但是当我丢失我的设备时我应该重做还是可以重用旧设备的顶点缓冲区？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-26T13:16:04.417

如果您必须重新创建顶点缓冲区，取决于您在哪个池中创建了它们。

驻留在 D3DPOOL_MANAGED 池中的顶点缓冲区将由 directx 自动重新创建。系统内存中的缓冲区不会丢失，因此您也不必重新创建这些缓冲区。

只有完全驻留在显存中的缓冲区需要重新创建，因为每次松开设备时显存的内容都会丢失。

我建议您只对所有静态对象使用托管池。这会稍微增加内存需求，但您不必关心令人讨厌的细节，例如视频内存不足、缓冲区娱乐丢失等。**************