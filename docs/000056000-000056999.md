# StackOverflow 问答 000056000-000056999

# .net - .NET 序列化类设计问题

> ID：56005
> 
> 赞同：3
> 
> 时间：2008-09-11T08:15:50.090
> 
> 标签：.net, serialization, class-design

我们有一个相当大的对象图，需要以许多不同的方式（模式）进行序列化和反序列化。在某些模式下，我们希望对某些属性进行反序列化，而在某些模式下则不需要。在未来的模式中，属性的选项可能比 yes 或 no 更多。现在的问题是我们如何实现这些模式。

**方法 A（使用反序列化构造函数和 ISerializable.GetObjectData）：**

如果我们让图的每个对象使用反序列化构造函数来序列化自己，我们会为所有不同的反序列化模式获得很多开关。然而，这种方法的优点是所有反序列化逻辑都在一个位置，如果我们添加新属性，我们只需要修改 ISerializable.GetObjectData 和反序列化构造函数。另一个优点是对象可能会考虑可能公开暴露的内部状态。最重要的缺点是我们数据对象本身需要了解所有可能的序列化模式。如果我们需要一个新模式，我们需要修改数据对象。

**方法 B（反序列化工厂类/方法）：**

另一种方法是为在外部进行序列化和反序列化的每种模式（例如 GraphSerializer.SerializeObjectTypeX(ObjectTypeX objectToSerialze)）设置某种反序列化工厂类/方法。这里的优点是，每当我们想要一个新模式时，我们只需添加一个新模式工厂类/方法和我们的数据对象不会因为引入的所有序列化模式而变得混乱。这里的主要缺点是我必须为所有不同的模式一遍又一遍地编写相同的序列化代码。如果两种模式只是在一两个属性，但我必须再次为整个图实现完整的逻辑。当我向数据对象添加新属性时，我需要更新所有工厂类。

所以我想知道是否有更好的方法来解决这个恕我直言的一般问题。甚至是 .NET 中的最佳实践？或者，也许我只是从错误的角度看待整个事情？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-13T07:57:54.157

为每种模式创建单独的序列化程序类（a-la XmlSerializer），继承或封装以避免重复。使用属性上的属性来标记它们是否以及如何在特定模式下序列化

# python - Python 中的单引号与双引号

> ID：56011
> 
> 赞同：718
> 
> 时间：2008-09-11T08:18:55.293
> 
> 标签：python, coding-style

根据文档，它们几乎可以互换。是否有文体上的理由使用一个而不是另一个？

* * *

## 回答 #1

> 赞同：525
> 
> 时间：2008-09-11T10:06:49.557

我喜欢在用于插值或自然语言消息的字符串周围使用双引号，为类似符号的小字符串使用单引号，但如果字符串包含引号或我忘记了，则会违反规则。我对文档字符串使用三重双引号，对正则表达式使用原始字符串文字，即使它们不是必需的。

例如：

```
LIGHT_MESSAGES = {
    'English': "There are %(number_of_lights)s lights.",
    'Pirate':  "Arr! Thar be %(number_of_lights)s lights."
}

def lights_message(language, number_of_lights):
    """Return a language-appropriate string reporting the light count."""
    return LIGHT_MESSAGES[language] % locals()

def is_pirate(message):
    """Return True if the given message sounds piratical."""
    return re.search(r"(?i)(arr|avast|yohoho)!", message) is not None 
```

* * *

## 回答 #2

> 赞同：96
> 
> 时间：2008-09-27T18:07:24.383

[在https://docs.python.org/2.0/ref/strings.html](https://docs.python.org/2.0/ref/strings.html)引用官方文档：

> 用简单的英语：字符串文字可以用匹配的单引号 (') 或双引号 (") 括起来。

所以没有区别。相反，人们会告诉您选择与上下文匹配的任何样式，*并保持一致*。我会同意 - 补充说，试图为这类事情提出“约定”是没有意义的，因为你最终只会让任何新人感到困惑。

* * *

## 回答 #3

> 赞同：90
> 
> 时间：2008-09-11T08:55:17.513

我以前更喜欢`'`，尤其是`'''docstrings'''`，因为我发现`"""this creates some fluff"""`。此外，`'`可以在没有`Shift`瑞士德语键盘上的键的情况下键入。

此后，我改为使用三引号`"""docstrings"""`，以符合[PEP 257](http://www.python.org/dev/peps/pep-0257/)。

* * *

## 回答 #4

> 赞同：44
> 
> 时间：2008-09-11T10:21:35.013

我和威尔在一起：

*   文本的双引号
*   任何行为类似于标识符的单引号
*   正则表达式的双引号原始字符串文字
*   文档字符串的三重双引号

即使这意味着很多逃避，我也会坚持下去。

由于引号，我从单引号标识符中获得最大价值。其余的做法只是为了给那些单引号标识符一些站立空间。

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2008-09-11T08:33:56.007

如果您拥有的字符串包含一个，那么您应该使用另一个。例如`"You're able to do this"`， 或`'He said "Hi!"'`。除此之外，您应该尽可能保持一致（在模块内、包内、项目内、组织内）。

如果您的代码将被使用 C/C++ 的人阅读（或者如果您在这些语言和 Python 之间切换），那么使用`''`单字符字符串和`""`更长的字符串可能有助于简化转换。（同样适用于其他不可互换的语言）。

我在野外看到的 Python 代码倾向于支持`"`，`'`但只是轻微的。一个例外是比我所看到`"""these"""`的更常见。`'''these'''`

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2009-07-30T20:35:28.783

三重引用的评论是这个问题的一个有趣的子主题。[PEP 257 为文档字符串指定三引号](http://www.python.org/dev/peps/pep-0257/)。我使用 Google 代码搜索进行了快速检查，发现[Python](http://www.google.com/codesearch?hl=en&lr=&q=lang%3Apython+%22%22%22)中的三重双引号的流行程度大约是[三重单引号](http://www.google.com/codesearch?hl=en&lr=&q=lang%3Apython+%27%27%27)的 10 倍——在谷歌索引代码中出现了 130 万次和 13.1 万次。因此，在多行情况下，如果您的代码使用三重双引号，人们可能会更熟悉它。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2011-09-22T12:35:44.613

```
"If you're going to use apostrophes, 
       ^

you'll definitely want to use double quotes".
   ^ 
```

出于这个简单的原因，我总是在外面使用双引号。*总是*

说到绒毛，如果您将不得不使用转义字符来表示撇号，那么用 ' 简化您的字符串文字有什么好处？读小说会冒犯程序员吗？我无法想象高中英语课对你来说是多么痛苦！

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2011-01-23T21:45:13.693

Python 使用类似这样的引号：

```
mystringliteral1="this is a string with 'quotes'"
mystringliteral2='this is a string with "quotes"'
mystringliteral3="""this is a string with "quotes" and more 'quotes'"""
mystringliteral4='''this is a string with 'quotes' and more "quotes"'''
mystringliteral5='this is a string with \"quotes\"'
mystringliteral6='this is a string with \042quotes\042'
mystringliteral6='this is a string with \047quotes\047'

print mystringliteral1
print mystringliteral2
print mystringliteral3
print mystringliteral4
print mystringliteral5
print mystringliteral6 
```

这给出了以下输出：

```
this is a string with 'quotes'
this is a string with "quotes"
this is a string with "quotes" and more 'quotes'
this is a string with 'quotes' and more "quotes"
this is a string with "quotes"
this is a string with 'quotes' 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-11T08:40:23.603

我一般使用双引号，但不是出于任何特定原因 - 可能只是出于 Java 的习惯。

我猜你也更有可能想要在内联文字字符串中使用撇号，而不是想要双引号。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-28T03:35:24.220

我个人坚持其中一个。没关系。为任何一个引用提供你自己的意思只是在你合作时混淆其他人。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-19T19:34:38.713

这可能是一种风格偏好。我刚刚检查了 PEP 8 并没有看到任何提及单引号和双引号的内容。

我更喜欢单引号，因为它只有一次击键而不是两次。也就是说，我不必混合 shift 键来制作单引号。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2010-07-05T12:51:06.700

> 在 Perl 中，当您有一个不需要插入变量或转义字符（如 \n、\t、\r 等）的字符串时，您希望使用单引号。

PHP 与 Perl 有相同的区别：单引号中的内容不会被解释（甚至 \n 也不会被转换），而双引号可以包含变量以打印出它们的值。

恐怕Python没有。从技术上看，Python 中没有 $ 标记（或类似符号）将名称/文本与变量分开。毕竟，这两个特性都使 Python 更具可读性，更少混乱。单引号和双引号在 Python 中可以互换使用。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-03-10T06:25:35.893

我选择使用双引号，因为它们更容易看到。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-07-22T19:50:28.183

我只是使用当时我喜欢的任何东西；可以随心所欲地在两者之间切换很方便！

当然，在引用引号字符时，两者之间的切换毕竟可能不是那么异想天开……

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-11T08:25:09.070

您团队的品味或项目的编码指南。

例如，如果您处于多语言环境中，您可能希望鼓励对其他语言使用的字符串使用相同类型的引号。否则，我个人最喜欢 '

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-11T08:28:43.663

据我所知没有。虽然如果你看一些代码，“”通常用于文本字符串（我猜'在文本中比“更常见），并且''出现在hashkeys之类的东西中。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-04-16T22:32:10.697

我的目标是尽量减少像素和惊喜。我通常更喜欢`'`最小化像素，但`"`如果字符串有撇号，则再次最小化像素。然而，对于文档字符串，我更喜欢`"""`它，`'''`因为后者是非标准的、不常见的，因此令人惊讶。如果现在我有一堆`"`按上述逻辑使用的字符串，但也有一个可以逃脱的字符串`'`，我可能仍会使用`"`它来保持一致性，只是为了尽量减少意外。

或许以下列方式思考像素最小化理念会有所帮助。你宁愿英文字符看起来像`A B C`还是`AA BB CC`？后一种选择浪费了 50% 的非空像素。

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2010-07-05T13:06:13.793

我使用双引号是因为多年来我在除 Bash 之外的大多数语言（C++、Java、VB……）中都使用双引号，因为我也在普通文本中使用双引号，并且因为我使用的是（修改后的）非英语键盘，其中两个字符都需要 shift 键。

* * *

## 回答 #19

> 赞同：-4
> 
> 时间：2010-01-19T04:30:29.947

`'`=`"`

`/`= `\`=`\\`

例子 ：

```
f = open('c:\word.txt', 'r')
f = open("c:\word.txt", "r")
f = open("c:/word.txt", "r")
f = open("c:\\\word.txt", "r") 
```

结果是一样的

=>> 不，它们不一样。单个反斜杠将转义字符。你只是碰巧在那个例子中走运了，因为`\k`and`\w`不是有效的转义，比如`\t`or `\n`or `\\`or`\"`

如果您想使用单个反斜杠（并将它们解释为这样），那么您需要使用“原始”字符串。您可以通过`r`在字符串前面放置一个 ' '来做到这一点

```
im_raw = r'c:\temp.txt'
non_raw = 'c:\\temp.txt'
another_way = 'c:/temp.txt' 
```

就 Windows 中的路径而言，正斜杠的解释方式相同。显然，字符串本身是不同的。不过，我不能保证它们在外部设备上以这种方式处理。

# .net - 跨平台.Net？

> ID：56013
> 
> 赞同：6
> 
> 时间：2008-09-11T08:20:29.110
> 
> 标签：.net, cross-platform

如果您要编写一个在本地运行并调用 Web 服务的 GUI 应用程序，作为跨平台，您可以使用 .Net 来完成，您会推荐哪些工具？

我正在考虑使用 Java，因为它与 C# 相似，因此相对容易上手，然后我可以使用 JVM。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-11T08:21:49.140

你应该熟悉[Mono 项目](http://www.mono-project.com/Main_Page)和[MonoDevelop](http://www.monodevelop.com/Main_Page)；这些项目的明确目的是允许在各种平台上构建和运行 .NET 代码，包括 Windows、Linux 和 Mac OSX。

由于 Mono 是对 .NET 的重新实现，因此它总是落后于 Microsoft.NET，但它们对 .NET 2.0 和一些 .NET 3.x 功能有很好的覆盖。请注意，Mono 执行 .NET 二进制文件，因此只要 Mono 支持您的程序功能，您就可以将您在 Windows 上编译的应用程序 EXE 并在 Linux/Mono 上运行而无需重新编译。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2012-02-02T23:20:05.790

跨平台 .NET 开发的另一个相对较新的选择是使用开源 Eto.Forms 框架，它允许您拥有一个针对每个平台的本机工具包的 UI 代码库。

对于 Windows，它使用 WinForms 或 WPF，对于 Linux，它使用 GTK#，对于 OS X，它使用 MonoMac/Cocoa。

还有一些移动端口（iOS/Android）正在开发中。

[https://github.com/picoe/Eto](https://github.com/picoe/Eto)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-11T08:26:22.467

您最好使用一些跨平台工具包来编写它。很可能您将无法使用出色的视觉设计器（实际上这取决于您选择的工具包），但是手工编写 UI 并不是那么困难。HTML 人一直都在这样做，这在非 MS 世界中也很常见。

**一些带有 .NET 绑定的跨平台 UI 工具包**

*   [**GTK#**](http://www.mono-project.com/GtkSharp)（Mono 开发的事实标准， [MonoDevelop IDE](http://www.monodevelop.com/Main_Page)具有使用此工具包的内置表单设计器）
*   [**wxNET**](http://wxnet.sourceforge.net/)（基于 wxWindows，相当成熟，但你必须手动构建你的 UI）
*   [**Qyoto**](http://www.qyoto.org/)（基于 QT，它可能比 wxWindows 更好，但如果您的应用程序没有开源许可证，您可能需要 Trolltech 的商业许可证）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-11T10:45:25.237

一条忠告。跨平台编程就像跨浏览器编程一样，肯定要做的一件事是在您想要支持的所有平台上进行测试、测试和测试。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-11T08:22:28.390

[Mono](http://www.mono-project.com)是目前唯一的选择。它在[这些平台](http://www.mono-project.com/Supported_Platforms)上运行。并且会有问题，不一定是巨大的，但仍然存在。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-11T08:21:52.243

查看[Mono 项目](http://www.mono-project.com/)

还可以查看用于富 Internet 应用程序的[Silverlight](http://silverlight.net)或[Flash 。](http://www.adobe.com/products/flash/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-11T10:26:40.523

如前所述，[Mono 项目](http://www.mono-project.com/)是您最好的选择，因为它有社区支持。

如果您使用的是 Visual Basic，那么[REALbasic](http://www.realsoftware.com/products/realbasic/index.php)也值得一看，因为它具有创建本机可执行文件的交叉编译器。他们有一个试用版，你也可以[下载](http://www.realsoftware.com/download)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-11T10:31:27.563

我最近在 Linux 上编写了一个小 C# GUI 应用程序，使用 mono 编译和运行。我发现我必须使用“gmcs”编译器才能访问现代 C# 和 .Net 功能（mono 1.9 附带了几个不同的编译器）。

而且在编译.exe文件时，我发现我必须添加“-target:winexe”开关才能使应用程序在Windows上运行，而不会在应用程序后面弹出命令行。

我还没有弄清楚如何编译一个 .Net 应用程序，它在 Windows 上可以从网络驱动器运行，而不需要在 PC 上进行特殊的 .Net 安全配置。（我认为这是 .Net 应用程序的普遍问题，但我仍在学习。）

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-09-11T10:48:00.083

老实说，我会评估您的客户群和您现有的技能。如果你有一个 50/50 的分割，甚至 70/30 的 Windows 与非 Windows 的分割，你可能会更好地使用 Java 或其他一些跨平台工具包。

Mono 是一个不错的平台（请参阅[大约一周前提出的这个 SO 问题](https://stackoverflow.com/questions/42627/best-practices-for-portable-c)），但如果您正在做任何重要的事情，我会使用专为它设计的工具包。

顺便说一句，如果你想看看 .NET GUI 应用程序在 Mono 上的样子，这是我在 Mono 上运行 NUnit GUI 时所做的一篇文章：

[http://www.cornetdesign.com/2006/07/nunit-gui-running-green-on-monolinux.html](http://www.cornetdesign.com/2006/07/nunit-gui-running-green-on-monolinux.html)

# svn - 防止 Subversion 中的文件大小写问题

> ID：56022
> 
> 赞同：3
> 
> 时间：2008-09-11T08:23:02.287
> 
> 标签：svn, tortoisesvn

我们在 Windows 上使用 Subversion 时遇到了问题。一个开发人员提交了一个文件`foo.Data.sql`，后来另一个开发人员提交了一个名为`foo.data.sql`. 自然，这会在 Windows 客户端（我们环境中的所有客户端都是 Windows）上引起问题，因为文件在 Subversion 中区分大小写，但在 Windows 中不区分大小写。

我们设法通过直接删除存储库中的一个文件来解决此问题，但我仍有两个问题：

1.  开发人员如何使用 Windows 客户端执行此操作？他是否有无效的工作副本，或者客户端（TortoiseSVN）中是否存在错误？
2.  我们如何防止此类更改进入存储库（即是否有人编写了一个钩子脚本来执行文件大小写问题的完整性检查）？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-11T08:38:12.017

肯定有一个检查大小写敏感性的钩子脚本——Sourceforge 将它作为他们的选项之一。一个快速的谷歌出现：[http](http://www.subversionary.org/howto/using-check-case-insensitive-py-on-windows) ://www.subversionary.org/howto/using-check-case-insensitive-py-on-windows和[http://svn.apache.org/repos/asf/subversion/trunk/ contrib/hook-scripts/case-insensitive.py](http://svn.apache.org/repos/asf/subversion/trunk/contrib/hook-scripts/case-insensitive.py)

如果用户 1 添加了 foo.data.sql 并且用户 2 在从用户 1 获取更新之前添加了 foo.Data.sql，则该问题将出现在 Windows 平台上。

希望有帮助:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-11T08:44:32.173

在 Windows 上，文件不区分大小写，但会保留大小写。您可以重命名文件，更改大小写，Windows 将保留更改。当 Subversion 尝试创建第二个文件时，就会出现问题。Windows 报告该文件已存在。

如果您想将两个文件合并为一个副本，而不是删除存储库中的文件，您可以重命名存储库中的坏文件（即附加一个后缀，如“.temp”），更新客户端，合并到好的文件，然后删除坏的文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T08:32:54.853

1个；这是可能的，因为这两个文件来自两个开发人员。一种是使用不同的情况重命名或创建文件，并且在提交期间没有意识到这将是添加而不是提交更改。

2；检查[TortoiseSVN 常见问题](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-rename.html#tsvn-dug-renameincase)

# ruby-on-rails - 如何在yaml中表示一个空字段

> ID：56037
> 
> 赞同：7
> 
> 时间：2008-09-11T08:32:21.830
> 
> 标签：ruby-on-rails, yaml

我正在使用轨道上的固定装置，我希望其中一个固定装置字段为空白。

例子：

```
two:
name: test
path: - I want this blank but not to act as a group heading.
test: 4 
```

`path:`但是，如果没有它作为组标题，我不知道如何留空。有人知道该怎么做吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-11T13:26:18.113

YAML 文件基于缩进。一旦你真正拥有正确的缩进，它就会以与兄弟相同的级别读取所有内容。

```
 two:
  name: test
  path: 
  test: 4 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T08:44:58.803

谷歌[说](http://groups.google.com/group/ruby-talk-google/browse_thread/thread/f8b1635528665a85)以下应该有效：

```
path: \"\" 
```

# java - Stuts2 Tiles Tomcat suspected of changing UTF-8 to?

> ID：56045
> 
> 赞同：1
> 
> 时间：2008-09-11T08:39:22.403
> 
> 标签：java, utf-8, internationalization, struts2, tiles

I'm having some internationalisation woes:

My UTF-8 string fields are being rendered in the browser as ???? after being returned from the database.

After retrieval from the database using Hibernate, the String fields are presented correctly on inspection using the eclipse debugger.

However Struts2/Tiles is rendering these strings as ???? in the HTML sent to the browser.

The charset directive is present in the HTML header:

Perhaps I need to add something to my struts2 or tiles configurations?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T00:45:27.157

OMG - it turns out that the cause was a total WTF?

all our tile responses were being served by a homegrown servlet that was ignoring the

`<%@ page contentType="text/html; charset=UTF-8" %>`

directive (and who know what else).

`TilesDispatchExtensionServlet` : bloody architecture astronauts, i shake my fist at ye.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T11:54:19.613

Try setting the lang attribute on the <html/> element.

HTML example:

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="ja"> 

```

XHTML example:

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja"> 

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T14:05:28.127

You could try something like this.

It's taken from sun's page on [Character Sets and Encodings](http://java.sun.com/j2ee/1.4/docs/tutorial/doc/WebI18N5.html). I think this has to be the very first line in your jsp.

```
<%@ page contentType="text/html; charset=UTF-8" %> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-22T01:52:21.900

You need to use a filter. See:

[http://wiki.apache.org/tomcat/Tomcat/UTF-8](http://wiki.apache.org/tomcat/Tomcat/UTF-8)

# c++ - 停止系统进入“待机”

> ID：56046
> 
> 赞同：4
> 
> 时间：2008-09-11T08:40:03.027
> 
> 标签：c++, winapi, standards, standby

`standby`如何在我的应用程序运行时停止主机进入模式？

有没有`win32 api`要求这样做？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-11T08:57:51.143

有两种 API，具体取决于 Windows 的版本。

XP,2000, 2003:

[http://msdn.microsoft.com/en-us/library/aa373247(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa373247(VS.85).aspx)

响应 PBT_APMQUERYSUSPEND。

远景，2008：

[http://msdn.microsoft.com/en-us/library/aa373208(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa373208(VS.85).aspx)

阻止计算机进入睡眠状态的原因可能有很多。例如，观看视频、播放音乐、编译长时间运行的构建、下载大文件等。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-11T08:50:45.730

这篇文章[http://www.codeguru.com/cpp/wp/system/messagehandling/article.php/c6907](http://www.codeguru.com/cpp/w-p/system/messagehandling/article.php/c6907)提供了如何从 C++ 执行此操作的演示（认为他的文章的框架好像您想从 Java 执行，并提供 Java 包装器）。

zip 文件中的实际代码位于[http://www.codeguru.com/dbfiles/get_file/standbydetectdemo_src.zip?id=6907&lbl=STANDBYDETECTDEMO_SRC_ZIP&ds=20040406](http://www.codeguru.com/dbfiles/get_file/standbydetectdemo_src.zip?id=6907&lbl=STANDBYDETECTDEMO_SRC_ZIP&ds=20040406)及其 C++ 部分位于 com/ha/common/windows/备用探测器。

希望它能为您提供足够的入门方向。

# vim - 在 Vim 中插入时间戳的最佳方法？

> ID：56052
> 
> 赞同：97
> 
> 时间：2008-09-11T08:41:56.547
> 
> 标签：vim, vi

EditPad Lite 有一个很好的功能（`CTRL`- `E`，`CTRL`- `I`），它可以在您的代码中插入一个时间戳，例如“2008-09-11 10:34:53”。

在 Vim 中获得此功能的最佳方法是什么？

（我通过 SSH 在 Linux 服务器上使用 Vim 6.1。在当前情况下，我们中的许多人共享一个登录名，所以如果有另一种内置方法来获取时间戳，我不想在主目录中创建缩写。 )

* * *

## 回答 #1

> 赞同：122
> 
> 时间：2008-09-12T10:13:57.647

要使其跨平台工作，只需将以下内容放入您的`vimrc`:

```
nmap <F3> i<C-R>=strftime("%Y-%m-%d %a %I:%M %p")<CR><Esc>
imap <F3> <C-R>=strftime("%Y-%m-%d %a %I:%M %p")<CR> 
```

现在你可以随时在 Vi/Vim 中按 F3 键，你会得到一个时间戳，就像`2016-01-25 Mo 12:44`插入到光标处一样。

有关可用参数的完整描述，请查看[C 函数 strftime() 的文档](http://www.cplusplus.com/reference/ctime/strftime/)。

* * *

## 回答 #2

> 赞同：92
> 
> 时间：2008-09-11T08:45:50.843

[http://kenno.wordpress.com/2006/08/03/vim-tip-insert-time-stamp/](http://kenno.wordpress.com/2006/08/03/vim-tip-insert-time-stamp/)

试了一下，它在我的mac上工作：

```
:r! date 
```

产生：

```
Thu Sep 11 10:47:30 CEST 2008 
```

这：

```
:r! date "+\%Y-\%m-\%d \%H:\%M:\%S" 
```

产生：

```
2008-09-11 10:50:56 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2011-10-06T22:19:12.863

为什么大家都在用`:r!`？`!!date`从命令模式中找到一个空行并键入。节省击键！

[nb 这会将当前行通过管道传输到标准输入，然后用命令输出替换该行；因此“查找空行”部分。]

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-11T08:48:17.237

:r！日期

然后，如果您想要完全相同的格式，则可以将格式添加到 date 命令（man date），并将其添加为 vim 别名

:r！日期+"\%Y-\%m-\%d\%H:\%M:\%S"

这会产生您在示例中显示的格式（shell 中的日期不使用 \%，而只是 %，vim 将 % 替换为当前文件的名称，因此您需要对其进行转义）。

您可以在 .vimrc 中添加一个映射，以便它自动放置命令，例如，每次按 F3 时：

```
:map <F3> :r! date +"\%Y-\%m-\%d \%H:\%M:\%S"<cr> 
```

（从上面编辑：））（编辑：将文本部分更改为代码，以便

```
<F3> 
```

可以显示）

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2010-06-05T04:26:18.380

作为@Swaroop C H 答案的扩展，

```
^R=strftime("%FT%T%z") 
```

是一种更紧凑的形式，它也将打印时区（实际上是与 UTC 的差异，采用符合 ISO-8601 的形式）。

如果您出于某种原因更喜欢使用外部工具，

```
:r !date --rfc-3339=s 
```

将为您提供完整的 RFC-3339 兼容时间戳；使用`ns`而不是`s`类似 Spock 的精度，并通过管道`tr ' ' T`使用大写 T 而不是日期和时间之间的空格。

此外，您可能会发现知道这一点很有用

```
:source somefile.vim 
```

将从中读取命令`somefile.vim`：这样您可以设置一组自定义映射等，然后在您在该帐户上使用 vim 时加载它。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2014-03-22T13:28:55.973

来自[Vim 维基](http://vim.wikia.com/wiki/Insert_current_date_or_time)。

我使用它而不是移动我的手来按下 F 键：

```
:iab <expr> tds strftime("%F %b %T") 
```

现在在插入模式下，它只需输入 tds，只要我按下空格键或返回，我就会得到日期并继续输入。

我把它`%b`放在那里，因为我喜欢看到月份的名字。这`%F`给了我一些按日期排序的东西。我可能会将其更改`%Y%m%d`为单位之间没有字符。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-11T08:51:26.557

对于 unix 时间戳：

```
:r！日期 +\%s

```

如果你经常使用它，你也可以将此命令映射到 VIM 中的一个键（例如 F12）：

把它放在你的 .vimrc 中：

```
 map  <F12> :r! date +\%s<cr> 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2014-07-19T11:44:38.887

### Unix，使用：

```
!!date 
```

### 窗户，使用：

```
!!date /t 
```

### 更多细节：见[Insert_current_date_or_time](http://vim.wikia.com/wiki/Insert_current_date_or_time)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-09-04T13:06:56.780

我想要一个自定义命令`:Date`（不是键映射）在当前光标位置插入日期。

不幸的是，像这样直接`r!date`的命令会导致换行。所以最后我想出了以下几点：

```
command Date execute "normal i<C-R>=strftime('%F %T')<CR><ESC>" 
```

它在光标位置添加日期/时间字符串而不添加任何新行（更改为`normal a`在光标位置之后添加）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-07-04T08:55:46.460

先前答案未包含的另一种快速方法：type-

！！日期

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-02-03T04:00:13.600

我在 Eterm 中使用 vi 的原因是 strftime() 在 vi​​ 中不可用。

苦苦挣扎，终于得出了这个结论：

```
map T :r! date +"\%m/\%d/\%Y \%H:\%M" <CR>"kkddo<CR> 
```

结果：02/02/2021 16:45

出于某种原因，单独添加日期时间会导致日期时间*上方*有一个空白行，并且光标设置*在*日期时间行上。

|  |  |
| --- | --- |
| 日期 +"[等]" <CR> | 输入日期时间 |
| “kk | 向上移动两行 |
| dd | 删除日期时间上方的行 |
| o <CR> | 在时间下方打开一行并添加回车（换行） |

**奖金：**

vi 不读取 ~/.vimrc，它读取 ~/.exrc

此外，这也是它在 vim/.vimrc 中的样子：

```
map T  "=strftime("%m/%d/%y %H:%M")<CR>po<CR> 
```

# sql - DELETE 语句在 SQL Server 上挂起，原因不明

> ID：56070
> 
> 赞同：10
> 
> 时间：2008-09-11T08:51:39.550
> 
> 标签：sql, sql-server, sql-server-2005

**编辑**：已解决，桌子上有一个带循环的触发器（请阅读下面我自己的答案）。

* * *

我们有一个简单的删除语句，如下所示：

```
DELETE FROM tablename WHERE pk = 12345 
```

这只是挂起，没有超时，没有任何东西。

我们查看了执行计划，它包含对相关表的许多查找，以确保没有外键会导致删除，但我们已经验证了这些其他表中没有任何行引用该特定行。

此时没有其他用户连接到数据库。

我们已经针对它运行了 DBCC CHECKDB，它报告了 0 个错误。

查看查询挂起时的结果*`sp_who`*，*`sp_lock`*我注意到我的 spid 有很多 PAG 和 KEY 锁，以及偶尔的 TAB 锁。

该表有 1.777.621 行，是的，pk 是主键，所以它是基于索引的单行删除。执行计划中没有表扫描，虽然我注意到它包含一些说*Table Spool (Eager Spool)*的东西，但是说 Estimated number of rows 1。这实际上是变相的表扫描吗？它只说它查看主键列。

在表上尝试了 DBCC DBREINDEX 和 UPDATE STATISTICS。两者都在合理的时间内完成。

不幸的是，此特定表上有大量索引。它是我们系统中的核心表，包含大量列和引用，包括传出和传入。确切的数字是 48 个索引 + 主键聚集索引。

我们还应该看什么？

还要注意这个表以前没有这个问题，今天突然出现这个问题。我们还有许多具有相同表设置的数据库（客户数据库的副本），它们的行为与预期一样，只是这个有问题。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-11T09:51:37.397

缺少的一条信息是您要从中删除数据的表上的索引数。由于 SQL Server 使用主键作为每个索引中的指针，因此对主索引的任何更改都需要更新每个索引。不过，除非我们谈论的数字很大，否则这应该不是问题。

根据您的描述，我猜测这是数据库中的主表，被 FK 关系中的许多其他表引用。这将解释大量锁，因为它会检查其余表的引用。而且，如果您打开了级联删除，这可能会导致表中的删除需要深入检查多个表。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-11T09:30:05.950

尝试在该表上重新创建索引，并尝试重新生成统计信息。

[DBCC 重新索引](http://msdn.microsoft.com/en-us/library/aa258828(SQL.80).aspx)

[更新统计](http://msdn.microsoft.com/en-us/library/aa260645(SQL.80).aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T12:38:56.417

好吧，这很尴尬。

一位同事不久前向该表添加了一个触发器，该触发器有一个错误。尽管他已经修复了错误，但从未为该表重新创建触发器。

所以服务器实际上什么也没做，它只是做了很多次。

那好吧...

感谢所有阅读本文并思考问题的人的眼球。

我将接受约瑟夫的回答，因为他是最接近的，并且间接地谈到了级联删除的问题。

# c# - Merging two Collection

> ID：56078
> 
> 赞同：9
> 
> 时间：2008-09-11T08:57:17.853
> 
> 标签：c#, collections

I got a Function that returns a `Collection<string>`, and that calls itself recursively to eventually return one big `Collection<string>`.

Now, i just wonder what the best approach to merge the lists? `Collection.CopyTo()` only copies to string[], and using a `foreach()` loop feels like being inefficient. However, since I also want to filter out duplicates, I feel like i'll end up with a foreach that calls `Contains()` on the `Collection`.

I wonder, is there a more efficient way to have a recursive function that returns a list of strings without duplicates? I don't have to use a `Collection`, it can be pretty much any suitable data type.

Only exclusion, I'm bound to Visual Studio 2005 and .net 3.0, so no LINQ.

**Edit:** To clarify: The Function takes a user out of Active Directory, looks at the Direct Reports of the user, and then recursively looks at the direct reports of every user. So the end result is a List of all users that are in the "command chain" of a given user.Since this is executed quite often and at the moment takes 20 Seconds for some users, i'm looking for ways to improve it. Caching the result for 24 Hours is also on my list btw., but I want to see how to improve it before applying caching.

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-11T09:06:44.990

If you're using List<> you can use .AddRange to add one list to the other list.

Or you can use yield return to combine lists on the fly like this:

```
public IEnumerable<string> Combine(IEnumerable<string> col1, IEnumerable<string> col2)
{
    foreach(string item in col1)
        yield return item;

    foreach(string item in col2)
        yield return item;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T09:03:29.943

I think [`HashSet<T>`](http://msdn.microsoft.com/en-us/library/bb359438.aspx) is a great help.

> The `HashSet<T>` class provides high performance set operations. A set is a collection that contains no duplicate elements, and whose elements are in no particular order.

Just add items to it and then use CopyTo.

* * *

**Update**: `HashSet<T>` is in .Net 3.5

Maybe you can use [`Dictionary<TKey, TValue>`](http://msdn.microsoft.com/en-us/library/xfhwa508.aspx). Setting a duplicate key to a dictionary will not raise an exception.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T09:13:14.367

You might want to take a look at [Iesi.Collections](http://www.codeproject.com/KB/recipes/sets.aspx) and [Extended Generic Iesi.Collections](http://www.codeproject.com/KB/recipes/GenericISet.aspx?display=Print) (because the first edition was made in 1.1 when there were no generics yet).

Extended Iesi has an ISet class which acts exactly as a HashSet: it enforces unique members and does not allow duplicates.

The nifty thing about Iesi is that it has set operators instead of methods for merging collections, so you have the choice between a union (|), intersection (&), XOR (^) and so forth.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T09:16:40.490

Can you pass the Collection into you method by refernce so that you can just add items to it, that way you dont have to return anything. This is what it might look like if you did it in c#.

```
class Program
{
    static void Main(string[] args)
    {
        Collection<string> myitems = new Collection<string>();
        myMthod(ref myitems);
        Console.WriteLine(myitems.Count.ToString());
        Console.ReadLine();
    }

    static void myMthod(ref Collection<string> myitems)
    {
        myitems.Add("string");
        if(myitems.Count <5)
            myMthod(ref myitems);
    }
} 
```

As Stated by @Zooba Passing by ref is not necessary here, if you passing by value it will also work.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-11T11:49:33.540

As far as merging goes:

> I wonder, is there a more efficient way to have a recursive function that returns a list of strings without duplicates? I don't have to use a Collection, it can be pretty much any suitable data type.

Your function assembles a return value, right? You're splitting the supplied list in half, invoking self again (twice) and then merging those results.

During the merge step, why not just check before you add each string to the result? If it's already there, skip it.

Assuming you're working with sorted lists of course.

# ruby - ruby 有真正的多线程吗？

> ID：56087
> 
> 赞同：299
> 
> 时间：2008-09-11T09:01:36.003
> 
> 标签：ruby, multithreading, concurrency

我知道 ruby​​ 使用[绿色线程的“合作”线程](http://en.wikipedia.org/wiki/Green_threads)。如何在我的应用程序中创建真正的“操作系统级”线程以利用多个 cpu 内核进行处理？

* * *

## 回答 #1

> 赞同：615
> 
> 时间：2008-09-11T22:25:12.903

**更新了 Jörg 2011 年 9 月的评论**

您似乎在这里混淆了两个*非常*不同的东西：Ruby 编程语言和 Ruby 编程语言的一种特定实现的特定线程模型。目前大约有 11 种不同的 Ruby 编程语言实现，具有*非常*不同和独特的线程模型。

（不幸的是，这 11 个实现中只有两个实际上已准备好用于生产，但到今年年底，这个数字可能会上升到四个或五个。）（**更新**：现在是 5 个：MRI、JRuby、YARV（解释器Ruby 1.9)、Rubinius 和 IronRuby)。

1.  第一个实现实际上没有名字，这使得引用它很尴尬，而且真的很烦人和令人困惑。它最常被称为“Ruby”，这比没有名字更令人讨厌和困惑，因为它会导致 Ruby 编程语言的特性和特定的 Ruby 实现之间无休止的混淆。

    它有时也称为“MRI”（代表“Matz 的 Ruby 实现”）、CRuby 或 MatzRuby。

    [MRI 在其解释器中将 Ruby 线程实现为绿色线程](http://RedMine.Ruby-Lang.Org/repositories/annotate/ruby-18/ext/thread/thread.c)。不幸的是，它不允许并行调度这些线程，它们一次只能运行一个线程。

    但是，任何数量的 C 线程（POSIX 线程等）都可以与 Ruby 线程并行运行，因此外部 C 库或创建自己的线程的 MRI C 扩展仍然可以并行运行。

2.  第二个实现是[YARV](http://WWW.AtDot.Net/yarv/)（“Yet Another Ruby VM”的缩写）。[YARV 将 Ruby 线程实现为 POSIX 或 Windows NT 线程](http://RedMine.Ruby-Lang.Org/repositories/annotate/ruby-19/thread.c)，但是，它使用全局解释器锁 (GIL) 来确保在任何时候实际上只能调度一个 Ruby 线程。

    与 MRI 一样，C 线程实际上*可以*与 Ruby 线程并行运行。

    将来，GIL*可能*会分解成更细粒度的锁，从而允许越来越多的代码实际并行运行，但这还很遥远，甚至还没有*计划*。

3.  [JRuby](http://JRuby.Org/) [将 Ruby 线程实现为 Native Threads](http://www.restlessprogrammer.com/2013/02/multi-threading-in-jruby.html)，其中 JVM 的“Native Threads”显然意味着“JVM Threads”。JRuby 没有对它们施加额外的锁定。因此，这些线程是否可以真正并行运行取决于 JVM：一些 JVM 将 JVM 线程实现为 OS 线程，而另一些则实现为绿色线程。（从 JDK 1.3 开始，Sun/Oracle 的主流 JVM 只使用 OS 线程）

4.  [XRuby](http://XRuby.GoogleCode.Com/)还将[Ruby 线程实现为 JVM 线程](http://Code.Google.Com/p/xruby/source/browse/trunk/src/com/xruby/runtime/builtin/RubyThread.java#21)。**更新**：XRuby 已经死了。

5.  [IronRuby](http://IronRuby.Net/) [将 Ruby 线程实现为 Native Threads](http://IronRuby.RubyForge.Org/svn/trunk/src/IronRuby.Libraries/Builtins/ThreadOps.cs)，其中 CLR 中的“Native Threads”显然意味着“CLR Threads”。IronRuby 没有对它们施加额外的锁定，因此，它们应该并行运行，只要您的 CLR 支持。

6.  [Ruby.NET](http://RubyDotNetCompiler.GoogleCode.Com/)还将[Ruby 线程实现为 CLR 线程](http://Code.Google.Com/p/rubydotnetcompiler/source/browse/trunk/src/RubyRuntime/Built-in%20Classes/Thread.cs#21)。**更新：** Ruby.NET 已经死了。

7.  [Rubinius](http://Rubini.us/) [在其虚拟机中将 Ruby 线程实现为绿色线程](https://GitHub.Com/EvanPhx/Rubinius/tree/master/kernel/core/thread.rb#L9)。更准确地说：Rubinius VM 导出了一个非常轻量级、非常灵活的并发/并行/非本地控制流构造，称为“[任务](https://GitHub.Com/EvanPhx/Rubinius/tree/cpp/vm/builtin/task.cpp)”，以及所有其他并发构造（本讨论中的线程，还有[Continuations](https://GitHub.Com/EvanPhx/Rubinius/tree/master/kernel/core/continuation.rb#L45)、[Actor](https://GitHub.Com/EvanPhx/Rubinius/tree/master/lib/actor.rb#L31)和其他东西) 在纯 Ruby 中使用 Tasks 实现。

    但是，Rubinius 不能（当前）并行调度线程，但补充说这并不是什么大问题：Rubinius 已经可以在一个 Rubinius 进程[中并行运行多个 POSIX 线程中的多个 VM 实例。](https://GitHub.Com/EvanPhx/Rubinius/tree/master/kernel/core/vm.rb#L5)由于线程实际上是在 Ruby 中实现的，因此它们可以像任何其他 Ruby 对象一样被序列化并发送到不同 POSIX 线程中的不同 VM。（这与 BEAM [Erlang](http://Erlang.Org/) VM 用于 SMP 并发的模型相同。它已经[为 Rubinius Actors 实现了](https://GitHub.Com/EvanPhx/Rubinius/tree/master/lib/vmactor.rb)。）

    **更新**：此答案中有关 Rubinius 的信息是关于 Shotgun VM 的，它不再存在。“新”C++ VM 不使用跨多个 VM 调度的绿色线程（即 Erlang/BEAM 样式），它使用具有多个本机操作系统线程模型的更传统的单个 VM，就像 CLR、Mono 所采用的模型一样，以及几乎每个 JVM。

8.  [MacRuby](http://MacRuby.Org/)最初是作为 YARV 在 Objective-C 运行时和 CoreFoundation 和 Cocoa 框架之上的一个端口。它现在与 YARV 明显不同，但 AFAIK 目前仍[与 YARV 共享相同的线程模型](http://MacRuby.Org/trac/browser/MacRuby/trunk/thread.c?annotate=blame)。 **更新：** MacRuby 依赖于苹果垃圾收集器，该垃圾收集器已被声明为已弃用，并将在以后的 MacOSX 版本中删除，MacRuby 是不死的。

9.  [Cardinal](https://github.com/parrot/cardinal)是[Parrot 虚拟机](http://ParrotCode.Org/)的 Ruby 实现。它还没有实现线程，但是，当它实现时，它可能会将它们实现为[Parrot Threads](http://SVN.Perl.Org/viewvc/parrot/trunk/src/thread.c?view=annotate)。**更新**：红衣主教似乎非常不活跃/死了。

10.  [MagLev](http://MagLev.GemStone.Com/)是[GemStone/S Smalltalk VM](http://GemStone.Com/products/smalltalk/)的 Ruby 实现。我不知道 GemStone/S 使用什么线程模型，MagLev 使用什么线程模型，或者即使线程已经实现（可能还没有）。

11.  [HotRuby](http://HotRuby.Yukoba.Jp/)本身*并不是*一个完整的 Ruby 实现。它是 JavaScript 中 YARV 字节码 VM 的实现。HotRuby 不支持线程（还没有？），当它支持时，它们将无法并行运行，因为 JavaScript 不支持真正的并行性。不过，HotRuby 有一个 ActionScript 版本，而且 ActionScript 可能实际上支持并行性。**更新**：HotRuby 已经死了。

不幸的是，这 11 个 Ruby 实现中只有两个实际上是生产就绪的：MRI 和 JRuby。

所以，如果你想要真正的并行线程，JRuby 目前是你唯一的选择——这并不是一个坏的选择：JRuby 实际上比 MRI 更快，并且可以说更稳定。

否则，“经典” Ruby 解决方案是使用进程而不是线程来实现并行性。Ruby 核心库包含带有 [方法的](http://Ruby-Doc.Org/core/classes/Process.html#M003179)[`Process`模块](http://Ruby-Doc.Org/core/classes/Process.html)，这使得分叉另一个 Ruby 进程变得非常容易。此外，Ruby 标准库包含 [分布式 Ruby (dRuby / dRb)](http://Ruby-Doc.Org/stdlib/libdoc/drb/rdoc/)库，它允许 Ruby 代码在多个进程中轻松分布，不仅在同一台机器上，而且在网络上。[`Process.fork`](http://Ruby-Doc.Org/core/classes/Process.html#M003179)

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-09-11T09:05:37.833

Ruby 1.8 只有绿色线程，没有办法创建真正的“OS 级”线程。但是，ruby 1.9 将有一个新特性，称为纤维，它允许您创建实际的操作系统级线程。不幸的是，Ruby 1.9 仍处于测试阶段，计划在几个月内稳定下来。

另一种选择是使用 JRuby。JRuby 将线程实现为操作系统级别的线程，其中没有“绿色线程”。JRuby的最新版本是1.1.4，相当于Ruby 1.8

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2014-02-03T16:00:41.660

这取决于实现：

*   MRI没有，YARV更接近。
*   JRuby 和 MacRuby 都有。

Ruby 有[闭](http://en.wikipedia.org/wiki/Closure_%28computer_programming%29)包`Blocks`,`lambdas`和`Procs`. 为了充分利用 JRuby 中的闭包和多核，[Java 的执行](http://blog.bitmelt.com/2013/05/concurrent-tasks-in-jruby.html)器就派上用场了；对于 MacRuby，我喜欢[GCD 的 queues](http://seanlilmateus.github.io/blog/2012/05/31/getting-started-with-grand-central-dispatch-in-macruby-and-rubymotion/)。

请注意，能够创建*真正的“操作系统级”线程*并不意味着您可以使用多个 cpu 内核进行并行处理。看看下面的例子。

这是使用 Ruby 2.1.0[使用 3 个线程的简单 Ruby 程序的输出：](https://gist.github.com/user454322/8785580)

```
(jalcazar@mac ~)$ ps -M 69877
USER     PID   TT   %CPU STAT PRI     STIME     UTIME COMMAND
jalcazar 69877 s002    0.0 S    31T   0:00.01   0:00.04 /Users/jalcazar/.rvm/rubies/ruby-2.1.0/bin/ruby threads.rb
   69877         0.0 S    31T   0:00.01   0:00.00 
   69877        33.4 S    31T   0:00.01   0:08.73 
   69877        43.1 S    31T   0:00.01   0:08.73 
   69877        22.8 R    31T   0:00.01   0:08.65 
```

正如您在此处看到的，有四个操作系统线程，但是只有一个有状态的线程`R`正在运行。这是由于 Ruby 线程实现方式的限制。

* * *

相同的程序，现在使用 JRuby。您可以看到三个带有 state 的线程`R`，这意味着它们是并行运行的。

```
(jalcazar@mac ~)$ ps -M 72286
USER     PID   TT   %CPU STAT PRI     STIME     UTIME COMMAND
jalcazar 72286 s002    0.0 S    31T   0:00.01   0:00.01 /Library/Java/JavaVirtualMachines/jdk1.7.0_25.jdk/Contents/Home/bin/java -Djdk.home= -Djruby.home=/Users/jalcazar/.rvm/rubies/jruby-1.7.10 -Djruby.script=jruby -Djruby.shell=/bin/sh -Djffi.boot.library.path=/Users/jalcazar/.rvm/rubies/jruby-1.7.10/lib/jni:/Users/jalcazar/.rvm/rubies/jruby-1.7.10/lib/jni/Darwin -Xss2048k -Dsun.java.command=org.jruby.Main -cp  -Xbootclasspath/a:/Users/jalcazar/.rvm/rubies/jruby-1.7.10/lib/jruby.jar -Xmx1924M -XX:PermSize=992m -Dfile.encoding=UTF-8 org/jruby/Main threads.rb
   72286         0.0 S    31T   0:00.00   0:00.00 
   72286         0.0 S    33T   0:00.00   0:00.00 
   72286         0.0 S    31T   0:00.09   0:02.34 
   72286         7.9 S    31T   0:00.15   0:04.63 
   72286         0.0 S    31T   0:00.00   0:00.00 
   72286         0.0 S    31T   0:00.00   0:00.00 
   72286         0.0 S    31T   0:00.00   0:00.00 
   72286         0.0 S    31T   0:00.04   0:01.68 
   72286         0.0 S    31T   0:00.03   0:01.54 
   72286         0.0 S    31T   0:00.00   0:00.00 
   72286         0.0 S    31T   0:00.01   0:00.01 
   72286         0.0 S    31T   0:00.00   0:00.01 
   72286         0.0 S    31T   0:00.00   0:00.03 
   72286        74.2 R    31T   0:09.21   0:37.73 
   72286        72.4 R    31T   0:09.24   0:37.71 
   72286        74.7 R    31T   0:09.24   0:37.80 
```

* * *

相同的程序，现在使用 MacRuby。还有三个线程并行运行。这是因为[MacRuby 线程是 POSIX 线程](https://github.com/MacRuby/MacRuby/wiki/Why-MacRuby%3F#2-thread-support)（*真正的“操作系统级”线程*）并且[没有 GVL](http://vimeo.com/67731482#t=19m47s)

```
(jalcazar@mac ~)$ ps -M 38293
USER     PID   TT   %CPU STAT PRI     STIME     UTIME COMMAND
jalcazar 38293 s002    0.0 R     0T   0:00.02   0:00.10 /Users/jalcazar/.rvm/rubies/macruby-0.12/usr/bin/macruby threads.rb
   38293         0.0 S    33T   0:00.00   0:00.00 
   38293       100.0 R    31T   0:00.04   0:21.92 
   38293       100.0 R    31T   0:00.04   0:21.95 
   38293       100.0 R    31T   0:00.04   0:21.99 
```

* * *

再一次，同样的程序，但现在有了旧的 MRI。由于此实现使用绿色线程，因此仅显示一个线程

```
(jalcazar@mac ~)$ ps -M 70032
USER     PID   TT   %CPU STAT PRI     STIME     UTIME COMMAND
jalcazar 70032 s002  100.0 R    31T   0:00.08   0:26.62 /Users/jalcazar/.rvm/rubies/ruby-1.8.7-p374/bin/ruby threads.rb 
```

如果您对 Ruby 多线程感兴趣，您可能会发现我的报告*[使用 fork 处理程序调试并行程序](https://modprobe.files.wordpress.com/2015/09/jalcazar_pmam20151.pdf)*很有趣。
对于 Ruby 内部结构的更一般的概述，*[Ruby Under a Microscope](http://shop.oreilly.com/product/9781593275273.do)*是一本不错的读物。
此外， Omniref 中的[Ruby 线程和 C 中的全局解释器锁在](https://www.omniref.com/ruby/2.2.0.preview1/files/thread_pthread.h#annotation=4057266&line=38)源代码中解释了为什么 Ruby 线程不能并行运行。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-11T11:57:27.797

使用[drb](http://chadfowler.com/ruby/drb.html)怎么样？它不是真正的多线程，而是多个进程之间的通信，但您现在可以在 1.8 中使用它，而且摩擦力相当低。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-02-22T23:07:52.480

我会让“系统监视器”回答这个问题。在这两种情况下，我都在 i7（4 个超线程核心）机器上运行 8 个 Ruby 线程执行相同的代码（下面，它计算素数）......第一次运行是：

jruby 1.5.6 (ruby 1.8.7 patchlevel 249) (2014-02-03 6586) (OpenJDK 64-Bit Server VM 1.7.0_75) [amd64-java]

第二个是：

红宝石 2.1.2p95 (2014-05-08) [x86_64-linux-gnu]

有趣的是，JRuby 线程的 CPU 更高，但解释型 Rub​​y 的完成时间略短。从图中很难看出，但第二次（解释为 Ruby）运行使用了大约 1/2 的 CPU（没有超线程？）

![在此处输入图像描述](https://i.stack.imgur.com/haINx.png)

```
def eratosthenes(n)
  nums = [nil, nil, *2..n]
  (2..Math.sqrt(n)).each do |i|
    (i**2..n).step(i){|m| nums[m] = nil}  if nums[i]
  end
  nums.compact
end

MAX_PRIME=10000000
THREADS=8
threads = []

1.upto(THREADS) do |num|
  puts "Starting thread #{num}"
  threads[num]=Thread.new { eratosthenes MAX_PRIME }
end

1.upto(THREADS) do |num|
    threads[num].join
end 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-11T18:50:51.407

如果您使用 MRI，那么您可以在 C 中编写线程代码作为扩展或使用 ruby​​-inline gem。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-11T19:10:36.257

如果您真的需要 Ruby 中的并行性来实现生产级系统（不能使用 beta 版），那么流程可能是更好的选择。
但是，绝对值得首先尝试 JRuby 下的线程。

此外，如果您对 Ruby 下线程的未来感兴趣，您可能会发现这篇[文章](http://www.infoq.com/news/2007/05/ruby-threading-futures)很有用。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-01-01T00:24:29.403

这是关于 Rinda 的一些信息，它是 Linda 的 Ruby 实现（并行处理和分布式计算范式）[http://charmalloc.blogspot.com/2009/12/linda-tuples-rinda-drb-parallel.html](http://charmalloc.blogspot.com/2009/12/linda-tuples-rinda-drb-parallel.html)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-05-08T14:26:53.483

因为无法编辑那个答案，所以在这里添加一个新的回复。

**更新(2017-05-08)**

这篇文章很老了，信息不符合当前（2017）的步伐，以下是一些补充：

12.  [Opal](https://github.com/opal/opal)是一个 Ruby 到 JavaScript 源代码到源代码的编译器。它还有一个 Ruby corelib 的实现，它目前非常活跃，并且存在大量（前端）框架在它上面工作。并准备好生产。因为基于javascript，它不支持并行线程。

13.  [truffleruby](https://github.com/graalvm/truffleruby)是 Ruby 编程语言的高性能实现。TruffleRuby 由 Oracle Labs 在 GraalVM 上构建，是 JRuby 的一个分支，将它与来自 Rubinius 项目的代码相结合，还包含来自 Ruby、MRI 的标准实现的代码，仍然是实时开发，而不是生产就绪。这个版本的 ruby​​ 似乎是为性能而生的，我不知道是否支持并行线程，但我认为应该。

# svn - Subversion 合并历史可视化

> ID：56090
> 
> 赞同：16
> 
> 时间：2008-09-11T09:02:49.727
> 
> 标签：svn, merge, visualization

是否有任何实用程序可以绘制颠覆 repo 的合并历史的图片 - 我们总是使用（相当）一致的日志消息提交合并，并且能够自动将此信息提取到单个图片中会很方便显示何时发生了哪些分支，以及合并的状态是什么。

我只是对一个信息工具感兴趣，而不是帮助实际执行合并的东西。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-03-11T16:48:14.993

我为此使用[SmartSVN](https://www.smartsvn.com/features/)；我有一个非常快速且易于使用的修订图，它可以将 svm:mergeinfo 显示为分支之间的颜色编码链接和箭头。在查看大尺寸的源代码树时很难被击败

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-11T09:06:21.730

TortoiseSVN 可以显示[修订图](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-revgraph.html)- 分支\合并历史等的可视化表示。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-12-14T15:23:40.373

你可以看看这里使用的一些可视化技术，如果你正在开发自己的系统，可以从中获得灵感，一些不错的想法。

[RaphaelJS Github Vis](http://raphaeljs.com/github/impact.html) [代码群](http://vis.cs.ucdavis.edu/~ogawa/codeswarm/)

可能你已经知道一些了！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-10-21T15:04:07.907

[svn mergeinfo](http://svnbook.red-bean.com/nightly/en/svn.ref.svn.c.mergeinfo.html)命令提供了两个分支之间合并的ASCII 艺术图。您还可以要求它以列表格式为您提供已经合并或需要合并的修订。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2008-09-11T09:44:30.500

我认为 Tortoise svn[**还不**](http://svn.haxx.se/tsvnusers/archive-2008-05/0149.shtml)支持版本树。

到目前为止，Clearcase explorer 是我遇到的最好的。

# c++ - 指向 C++ 类方法的指针

> ID：56091
> 
> 赞同：3
> 
> 时间：2008-09-11T09:03:13.737
> 
> 标签：c++

在重构一些遗留 C++ 代码时，我发现我可以通过以某种方式定义一个变量来删除一些代码重复，该变量可以指向任何共享相同签名的类方法。经过一番挖掘，我发现我可以执行以下操作：

```
class MyClass
{
protected:
    bool CaseMethod1( int abc, const std::string& str )
    {
        cout << "case 1:" << str;
        return true;
    }

    bool CaseMethod2( int abc, const std::string& str )
    {
        cout << "case 2:" << str;
        return true;
    }

    bool CaseMethod3( int abc, const std::string& str )
    {
        cout << "case 3:" << str;
        return true;
    }

public:
    bool TestSwitch( int num )
    {   
        bool ( MyClass::*CaseMethod )( int, const std::string& );

        switch ( num )
        {
            case 1: CaseMethod = &MyClass::CaseMethod1;
                    break;
            case 2: CaseMethod = &MyClass::CaseMethod2;
                    break;
            case 3: CaseMethod = &MyClass::CaseMethod3;
                    break;
        }

        ...

        bool res = CaseMethod( 999, "hello world" );

        ...

        reurn res;
    }
}; 
```

我的问题是 -**这是解决这个问题的正确方法吗？** 我应该考虑*Boost*提供的任何东西吗？

编辑...

好的，我的错误 - 我应该这样调用该方法：

```
bool res = ( (*this).*CaseMethod )( 999, "Hello World" ); 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-11T09:18:24.153

你有一个指向成员函数的指针。它会解决你的问题。我很惊讶您的“TestSwitch”函数可以编译，因为调用语法与您所期望的略有不同。它应该是：

```
bool res = (this->*CaseMethod)( 999, "hello world" ); 
```

但是，您可能会发现 boost::function 和 boost::bind 的组合使事情变得更容易一些，因为您可以避免奇怪的调用语法。

```
boost::function<bool(int,std::string)> f=
    boost::bind(&MyClass::CaseMethod1,this,_1,_2); 
```

当然，这会将它绑定到当前`this`指针：`this`如果您愿意，可以将成员函数的指针设为显式的第三个参数：

```
boost::function<bool(MyClass*,int,std::string)> f=
    boost::bind(&MyClass::CaseMethod1,_1,_2,_3); 
```

另一种选择可能是使用虚函数和派生类，但这可能需要对代码进行重大更改。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-11T16:29:59.077

您还可以构建一个查找（如果您的键范围是合理的），以便您最终编写：

```
this->*Methods[num]( 999, "hello world" ); 
```

这也删除了开关，并使清理更有价值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T09:11:34.543

您当然可以这样做，尽管 CaseMethod 调用不正确（它是指向成员函数的指针，因此您必须指定应该调用该方法的对象）。正确的调用如下所示：

```
bool res = this->*CaseMethod( 999, "hello world" ); 
```

另一方面，我建议[boost::mem_fn](http://www.boost.org/doc/libs/1_36_0/libs/bind/mem_fn.html) - 你搞砸的机会更少。;)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T09:50:29.020

我看不出您的调用与仅在 switch 语句中调用该方法之间的区别。

不，没有语义或可读性差异。

我看到的唯一区别是您正在使用指向方法的指针，因此禁止编译器内联它或优化对该方法的任何调用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-11T17:04:45.950

如果没有更广泛的背景，很难找出正确的答案，但我在这里总结了三种可能性：

*   保持正常的 switch 语句，无需执行任何操作。这是最可能的解决方案

*   正如@Simon 所说，将指向成员函数的指针与数组一起使用，或者可以与映射一起使用。对于包含大量案例的案例语句，这可能会更快。

*   将类拆分为多个类，每个类携带一个函数来调用，并使用虚函数。这可能是最好的解决方案，购买它需要一些认真的重构。考虑 GoF 模式，例如 State 或 Visitor 等。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-11T09:30:20.583

您在这里给出的本地化示例本质上没有任何问题，但是如果您在更广泛的上下文中使用类方法指针，例如在它们作为指针的类之外或在结合复杂的继承树。编译器通常管理方法指针的方式与“普通”指针不同（因为除了代码入口点之外还有额外的信息），因此对你可以用它们做什么有很多限制。

如果您只是按照您描述的方式保留简单的指针，那么您会没事的，但是在更复杂的用途之前，您可能想看看更通用的仿函数系统，例如[boost::bind](http://www.boost.org/doc/libs/1_36_0/libs/bind/bind.html#with_member_pointers)。这些可以接受指向几乎任何可调用代码指针的指针，并且如果需要还可以绑定实例化函数参数。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-12T12:17:06.787

还有其他可用的方法，例如使用抽象基类或专门的模板函数。

我将描述基类的想法。

您可以定义一个抽象基类

```
class Base { virtual bool Method(int i, const string& s) = 0; }; 
```

然后将您的每个案例编写为子类，例如

```
class Case1 : public Base { virtual bool Method(..) { /* implement */; } }; 
```

在某些时候，您将获得指示要执行哪个测试的“num”变量。你可以编写一个工厂函数来获取这个 num（我称之为 which_case），并返回一个指向 Base 的指针，然后从该指针调用 Method。

```
Base* CreateBase(int which_num) { /* metacode: return new Case[which_num]; */ }
// ... later, when you want to actually call your method ...
Base* base = CreateBase(23);
base->Method(999, "hello world!");
delete base;  // Or use a scoped pointer. 
```

顺便说一句，这个应用程序让我希望 C++ 支持静态虚函数，或者像“类型”这样的内置类型 - 但它没有。

# asp.net - 从颠覆（ASP.NET 项目）中删除 web.config

> ID：56096
> 
> 赞同：4
> 
> 时间：2008-09-11T09:06:06.520
> 
> 标签：asp.net, svn, web-config

我有一个使用 Subversion 和 VisualSVN 进行源代码控制的项目。由于服务器和开发人员计算机上的 web.config 版本不同，我希望该文件保留在计算机上，但被 Subversion 忽略。我将它添加到 svn:ignore 但它仍然存在（并且仍然有一个红色感叹号，因为我们没有提交它）。

如何在不从文件系统中删除它的情况下安全地从 Subversion 中删除它

谢谢， 阿丁

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-11T10:27:02.943

您必须同时执行删除和忽略操作

*   首先备份您的本地文件（如@ibz 所说）
*   然后从存储库中删除 web.config。
*   然后将 web.config 复制回同一文件夹
*   最后使用 svn:ignore 以便 subversion 不会尝试再次将其添加到存储库

因为我使用 tortoisesvn 我不能真正告诉你必须使用哪些 svn 命令，但是使用 tortoisesvn 它将是：

*   做备份
*   右键单击源代码控制下文件夹上的 web.config，选择 TortoiseSVN | 删除
*   右键单击源代码控制下文件夹上的 web.config，选择 SVN Commit => 之后您会注意到该文件实际上已从文件系统中删除
*   上移并右键单击源代码管理下的文件夹，选择 TortoiseSVN | 特性
*   在属性窗口上单击新建 + 属性名称“svn:ignore”；属性值“web.config”。接受更改
*   提交更改

在我的 .net 项目中，我使用 svn:ignore: bin, obj, *.suo, *.user 包含以下排除项

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-11T21:26:07.633

理想情况下，您也应该在 SVN 中维护服务器的 web.config 副本的版本。我们通常将生产 web.config 重命名为 web.config.prod（每个环境的副本）并让构建工具选择正确的文件并将其重命名为 web.config，同时打包部署。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T09:40:33.757

```
svn rm --force web.config
svn commit 
```

在执行此操作之前请小心备份您的本地副本（web.config），因为它将被删除。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-21T17:22:29.057

我已经使用 nant 和 ccnet 解决了这个问题。以下 nant 构建脚本将 web.test.config 文件替换为本地 web.config 文件；

```
<?xml version="1.0"?>
    <project name="Project1" default="build">
      <target name="init" depends="clean" />
      <target name="clean" />
      <target name="checkout"/>
      <target name="compile"/>
      <target name="deploy"/>
      <target name="test"/>
      <target name="inspect"/>
      <target name="build" depends="init, checkout">
        <call target="compile" />
        <call target="inspect" />
        <call target="test" />
        <call target="deploy" />
      </target>

      <copy file="..\TestDeployments\Project1\Project1.Solution\Project1.Web.UI\web.Test.config" 
          tofile="..\TestDeployments\Project1\Project1.Solution\Project1.Web.UI\web.config" 
          overwrite="true" 
       />
       <delete file="..\TestDeployments\Project1\Project1.Solution\Project1.Web.UI\web.Test.config" />

    </project> 
```

[NAnt 复制任务](http://nant.sourceforge.net/release/latest/help/tasks/copy.html)

# c# - 在 C# 中解析 html 的最佳方法是什么？

> ID：56107
> 
> 赞同：66
> 
> 时间：2008-09-11T09:16:40.473
> 
> 标签：c#, .net, html, parsing, html-content-extraction

我正在寻找一种库/方法来解析具有比通用 xml 解析库更多的 html 特定功能的 html 文件。

* * *

## 回答 #1

> 赞同：137
> 
> 时间：2008-09-19T08:05:44.167

[Html Agility Pack](https://html-agility-pack.net)

> This is an agile HTML parser that builds a read/write DOM and supports plain XPATH or XSLT (you actually don't HAVE to understand XPATH nor XSLT to use it, don't worry...). It is a .NET code library that allows you to parse "out of the web" HTML files. The parser is very tolerant with "real world" malformed HTML. The object model is very similar to what proposes System.Xml, but for HTML documents (or streams).

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-09-11T10:35:12.453

您可以使用 TidyNet.Tidy 将 HTML 转换为 XHTML，然后使用 XML 解析器。

另一种选择是使用内置引擎 mshtml：

```
using mshtml;
...
object[] oPageText = { html };
HTMLDocument doc = new HTMLDocumentClass();
IHTMLDocument2 doc2 = (IHTMLDocument2)doc;
doc2.write(oPageText); 
```

这允许您使用类似 javascript 的函数，例如 getElementById()

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-12-18T04:51:32.453

我发现了一个名为 Fizzler 的项目，它采用 jQuery/Sizzler 方法来选择 HTML 元素。它基于 HTML 敏捷包。它目前处于测试阶段，仅支持 CSS 选择器的一个子集，但在讨厌的 XPath 上使用 CSS 选择器非常酷且令人耳目一新。

[http://code.google.com/p/fizzler/](http://code.google.com/p/fizzler/)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-11T14:08:20.663

您可以做很多事情而不必对第 3 方产品和 mshtml（即互操作）发疯。使用 System.Windows.Forms.WebBrowser。从那里，您可以在 HtmlDocument 上执行“GetElementById”或在 HtmlElements 上执行“GetElementsByTagName”等操作。如果您想实际与浏览器交互（例如模拟按钮点击），您可以使用一点反射（imo 比 Interop 更邪恶）来做到这一点：

```
var wb = new WebBrowser() 
```

...告诉浏览器导航（与这个问题相切）。然后在 Document_Completed 事件上，您可以模拟这样的点击。

```
var doc = wb.Browser.Document
var elem = doc.GetElementById(elementId);
object obj = elem.DomElement;
System.Reflection.MethodInfo mi = obj.GetType().GetMethod("click");
mi.Invoke(obj, new object[0]); 
```

你可以做类似的反思来提交表格等。

享受。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-03-08T22:11:01.893

我编写了一些提供“LINQ to HTML”功能的代码。我想我会在这里分享它。它基于 Majestic 12。它采用 Majestic-12 结果并生成 LINQ XML 元素。此时，您可以针对 HTML 使用所有 LINQ to XML 工具。举个例子：

```
 IEnumerable<XNode> auctionNodes = Majestic12ToXml.Majestic12ToXml.ConvertNodesToXml(byteArrayOfAuctionHtml);

        foreach (XElement anchorTag in auctionNodes.OfType<XElement>().DescendantsAndSelf("a")) {

            if (anchorTag.Attribute("href") == null)
                continue;

            Console.WriteLine(anchorTag.Attribute("href").Value);
        } 
```

我想使用 Majestic-12，因为我知道它有很多关于 HTML 的内置知识，可以在野外找到。但我发现，将 Majestic-12 结果映射到 LINQ 将接受的东西，因为 XML 需要额外的工作。我包含的代码做了很多清理工作，但是当您使用它时，您会发现页面被拒绝。您需要修复代码以解决该问题。当抛出异常时，检查 exception.Data["source"] 因为它可能设置为导致异常的 HTML 标记。以一种好的方式处理 HTML 有时并非易事......

所以现在期望值实际上很低，这里是代码:)

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Majestic12;
using System.IO;
using System.Xml.Linq;
using System.Diagnostics;
using System.Text.RegularExpressions;

namespace Majestic12ToXml {
public class Majestic12ToXml {

    static public IEnumerable<XNode> ConvertNodesToXml(byte[] htmlAsBytes) {

        HTMLparser parser = OpenParser();
        parser.Init(htmlAsBytes);

        XElement currentNode = new XElement("document");

        HTMLchunk m12chunk = null;

        int xmlnsAttributeIndex = 0;
        string originalHtml = "";

        while ((m12chunk = parser.ParseNext()) != null) {

            try {

                Debug.Assert(!m12chunk.bHashMode);  // popular default for Majestic-12 setting

                XNode newNode = null;
                XElement newNodesParent = null;

                switch (m12chunk.oType) {
                    case HTMLchunkType.OpenTag:

                        // Tags are added as a child to the current tag, 
                        // except when the new tag implies the closure of 
                        // some number of ancestor tags.

                        newNode = ParseTagNode(m12chunk, originalHtml, ref xmlnsAttributeIndex);

                        if (newNode != null) {
                            currentNode = FindParentOfNewNode(m12chunk, originalHtml, currentNode);

                            newNodesParent = currentNode;

                            newNodesParent.Add(newNode);

                            currentNode = newNode as XElement;
                        }

                        break;

                    case HTMLchunkType.CloseTag:

                        if (m12chunk.bEndClosure) {

                            newNode = ParseTagNode(m12chunk, originalHtml, ref xmlnsAttributeIndex);

                            if (newNode != null) {
                                currentNode = FindParentOfNewNode(m12chunk, originalHtml, currentNode);

                                newNodesParent = currentNode;
                                newNodesParent.Add(newNode);
                            }
                        }
                        else {
                            XElement nodeToClose = currentNode;

                            string m12chunkCleanedTag = CleanupTagName(m12chunk.sTag, originalHtml);

                            while (nodeToClose != null && nodeToClose.Name.LocalName != m12chunkCleanedTag)
                                nodeToClose = nodeToClose.Parent;

                            if (nodeToClose != null)
                                currentNode = nodeToClose.Parent;

                            Debug.Assert(currentNode != null);
                        }

                        break;

                    case HTMLchunkType.Script:

                        newNode = new XElement("script", "REMOVED");
                        newNodesParent = currentNode;
                        newNodesParent.Add(newNode);
                        break;

                    case HTMLchunkType.Comment:

                        newNodesParent = currentNode;

                        if (m12chunk.sTag == "!--")
                            newNode = new XComment(m12chunk.oHTML);
                        else if (m12chunk.sTag == "![CDATA[")
                            newNode = new XCData(m12chunk.oHTML);
                        else
                            throw new Exception("Unrecognized comment sTag");

                        newNodesParent.Add(newNode);

                        break;

                    case HTMLchunkType.Text:

                        currentNode.Add(m12chunk.oHTML);
                        break;

                    default:
                        break;
                }
            }
            catch (Exception e) {
                var wrappedE = new Exception("Error using Majestic12.HTMLChunk, reason: " + e.Message, e);

                // the original html is copied for tracing/debugging purposes
                originalHtml = new string(htmlAsBytes.Skip(m12chunk.iChunkOffset)
                    .Take(m12chunk.iChunkLength)
                    .Select(B => (char)B).ToArray()); 

                wrappedE.Data.Add("source", originalHtml);

                throw wrappedE;
            }
        }

        while (currentNode.Parent != null)
            currentNode = currentNode.Parent;

        return currentNode.Nodes();
    }

    static XElement FindParentOfNewNode(Majestic12.HTMLchunk m12chunk, string originalHtml, XElement nextPotentialParent) {

        string m12chunkCleanedTag = CleanupTagName(m12chunk.sTag, originalHtml);

        XElement discoveredParent = null;

        // Get a list of all ancestors
        List<XElement> ancestors = new List<XElement>();
        XElement ancestor = nextPotentialParent;
        while (ancestor != null) {
            ancestors.Add(ancestor);
            ancestor = ancestor.Parent;
        }

        // Check if the new tag implies a previous tag was closed.
        if ("form" == m12chunkCleanedTag) {

            discoveredParent = ancestors
                .Where(XE => m12chunkCleanedTag == XE.Name)
                .Take(1)
                .Select(XE => XE.Parent)
                .FirstOrDefault();
        }
        else if ("td" == m12chunkCleanedTag) {

            discoveredParent = ancestors
                .TakeWhile(XE => "tr" != XE.Name)
                .Where(XE => m12chunkCleanedTag == XE.Name)
                .Take(1)
                .Select(XE => XE.Parent)
                .FirstOrDefault();
        }
        else if ("tr" == m12chunkCleanedTag) {

            discoveredParent = ancestors
                .TakeWhile(XE => !("table" == XE.Name
                                    || "thead" == XE.Name
                                    || "tbody" == XE.Name
                                    || "tfoot" == XE.Name))
                .Where(XE => m12chunkCleanedTag == XE.Name)
                .Take(1)
                .Select(XE => XE.Parent)
                .FirstOrDefault();
        }
        else if ("thead" == m12chunkCleanedTag
                  || "tbody" == m12chunkCleanedTag
                  || "tfoot" == m12chunkCleanedTag) {

            discoveredParent = ancestors
                .TakeWhile(XE => "table" != XE.Name)
                .Where(XE => m12chunkCleanedTag == XE.Name)
                .Take(1)
                .Select(XE => XE.Parent)
                .FirstOrDefault();
        }

        return discoveredParent ?? nextPotentialParent;
    }

    static string CleanupTagName(string originalName, string originalHtml) {

        string tagName = originalName;

        tagName = tagName.TrimStart(new char[] { '?' });  // for nodes <?xml >

        if (tagName.Contains(':'))
            tagName = tagName.Substring(tagName.LastIndexOf(':') + 1);

        return tagName;
    }

    static readonly Regex _startsAsNumeric = new Regex(@"^[0-9]", RegexOptions.Compiled);

    static bool TryCleanupAttributeName(string originalName, ref int xmlnsIndex, out string result) {

        result = null;
        string attributeName = originalName;

        if (string.IsNullOrEmpty(originalName))
            return false;

        if (_startsAsNumeric.IsMatch(originalName))
            return false;

        //
        // transform xmlns attributes so they don't actually create any XML namespaces
        //
        if (attributeName.ToLower().Equals("xmlns")) {

            attributeName = "xmlns_" + xmlnsIndex.ToString(); ;
            xmlnsIndex++;
        }
        else {
            if (attributeName.ToLower().StartsWith("xmlns:")) {
                attributeName = "xmlns_" + attributeName.Substring("xmlns:".Length);
            }   

            //
            // trim trailing \"
            //
            attributeName = attributeName.TrimEnd(new char[] { '\"' });

            attributeName = attributeName.Replace(":", "_");
        }

        result = attributeName;

        return true;
    }

    static Regex _weirdTag = new Regex(@"^<!\[.*\]>$");       // matches "<![if !supportEmptyParas]>"
    static Regex _aspnetPrecompiled = new Regex(@"^<%.*%>$"); // matches "<%@ ... %>"
    static Regex _shortHtmlComment = new Regex(@"^<!-.*->$"); // matches "<!-Extra_Images->"

    static XElement ParseTagNode(Majestic12.HTMLchunk m12chunk, string originalHtml, ref int xmlnsIndex) {

        if (string.IsNullOrEmpty(m12chunk.sTag)) {

            if (m12chunk.sParams.Length > 0 && m12chunk.sParams[0].ToLower().Equals("doctype"))
                return new XElement("doctype");

            if (_weirdTag.IsMatch(originalHtml))
                return new XElement("REMOVED_weirdBlockParenthesisTag");

            if (_aspnetPrecompiled.IsMatch(originalHtml))
                return new XElement("REMOVED_ASPNET_PrecompiledDirective");

            if (_shortHtmlComment.IsMatch(originalHtml))
                return new XElement("REMOVED_ShortHtmlComment");

            // Nodes like "<br <br>" will end up with a m12chunk.sTag==""...  We discard these nodes.
            return null;
        }

        string tagName = CleanupTagName(m12chunk.sTag, originalHtml);

        XElement result = new XElement(tagName);

        List<XAttribute> attributes = new List<XAttribute>();

        for (int i = 0; i < m12chunk.iParams; i++) {

            if (m12chunk.sParams[i] == "<!--") {

                // an HTML comment was embedded within a tag.  This comment and its contents
                // will be interpreted as attributes by Majestic-12... skip this attributes
                for (; i < m12chunk.iParams; i++) {

                    if (m12chunk.sTag == "--" || m12chunk.sTag == "-->")
                        break;
                }

                continue;
            }

            if (m12chunk.sParams[i] == "?" && string.IsNullOrEmpty(m12chunk.sValues[i]))
                continue;

            string attributeName = m12chunk.sParams[i];

            if (!TryCleanupAttributeName(attributeName, ref xmlnsIndex, out attributeName))
                continue;

            attributes.Add(new XAttribute(attributeName, m12chunk.sValues[i]));
        }

        // If attributes are duplicated with different values, we complain.
        // If attributes are duplicated with the same value, we remove all but 1.
        var duplicatedAttributes = attributes.GroupBy(A => A.Name).Where(G => G.Count() > 1);

        foreach (var duplicatedAttribute in duplicatedAttributes) {

            if (duplicatedAttribute.GroupBy(DA => DA.Value).Count() > 1)
                throw new Exception("Attribute value was given different values");

            attributes.RemoveAll(A => A.Name == duplicatedAttribute.Key);
            attributes.Add(duplicatedAttribute.First());
        }

        result.Add(attributes);

        return result;
    }

    static HTMLparser OpenParser() {
        HTMLparser oP = new HTMLparser();

        // The code+comments in this function are from the Majestic-12 sample documentation.

        // ...

        // This is optional, but if you want high performance then you may
        // want to set chunk hash mode to FALSE. This would result in tag params
        // being added to string arrays in HTMLchunk object called sParams and sValues, with number
        // of actual params being in iParams. See code below for details.
        //
        // When TRUE (and its default) tag params will be added to hashtable HTMLchunk (object).oParams
        oP.SetChunkHashMode(false);

        // if you set this to true then original parsed HTML for given chunk will be kept - 
        // this will reduce performance somewhat, but may be desireable in some cases where
        // reconstruction of HTML may be necessary
        oP.bKeepRawHTML = false;

        // if set to true (it is false by default), then entities will be decoded: this is essential
        // if you want to get strings that contain final representation of the data in HTML, however
        // you should be aware that if you want to use such strings into output HTML string then you will
        // need to do Entity encoding or same string may fail later
        oP.bDecodeEntities = true;

        // we have option to keep most entities as is - only replace stuff like &nbsp; 
        // this is called Mini Entities mode - it is handy when HTML will need
        // to be re-created after it was parsed, though in this case really
        // entities should not be parsed at all
        oP.bDecodeMiniEntities = true;

        if (!oP.bDecodeEntities && oP.bDecodeMiniEntities)
            oP.InitMiniEntities();

        // if set to true, then in case of Comments and SCRIPT tags the data set to oHTML will be
        // extracted BETWEEN those tags, rather than include complete RAW HTML that includes tags too
        // this only works if auto extraction is enabled
        oP.bAutoExtractBetweenTagsOnly = true;

        // if true then comments will be extracted automatically
        oP.bAutoKeepComments = true;

        // if true then scripts will be extracted automatically: 
        oP.bAutoKeepScripts = true;

        // if this option is true then whitespace before start of tag will be compressed to single
        // space character in string: " ", if false then full whitespace before tag will be returned (slower)
        // you may only want to set it to false if you want exact whitespace between tags, otherwise it is just
        // a waste of CPU cycles
        oP.bCompressWhiteSpaceBeforeTag = true;

        // if true (default) then tags with attributes marked as CLOSED (/ at the end) will be automatically
        // forced to be considered as open tags - this is no good for XML parsing, but I keep it for backwards
        // compatibility for my stuff as it makes it easier to avoid checking for same tag which is both closed
        // or open
        oP.bAutoMarkClosedTagsWithParamsAsOpen = false;

        return oP;
    }
}
} 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-09-19T08:11:52.530

The Html Agility Pack has been mentioned before - if you are going for speed, you might also want to check out [the Majestic-12 HTML parser](http://www.majestic12.co.uk/projects/html_parser.php). Its handling is rather clunky, but it delivers a really fast parsing experience.

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-11T11:12:13.427

我认为@Erlend 的使用`HTMLDocument`是**最好**的方法。但是，使用这个简单的库我也很幸运：

[阅读器](http://code.msdn.microsoft.com/SgmlReader)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-06-05T16:26:10.203

没有 3rd 方库，可以在 Console 和 Asp.net 上运行的 WebBrowser 类解决方案

```
using System;
using System.Collections.Generic;
using System.Text;
using System.Windows.Forms;
using System.Threading;

class ParseHTML
{
    public ParseHTML() { }
    private string ReturnString;

    public string doParsing(string html)
    {
        Thread t = new Thread(TParseMain);
        t.ApartmentState = ApartmentState.STA;
        t.Start((object)html);
        t.Join();
        return ReturnString;
    }

    private void TParseMain(object html)
    {
        WebBrowser wbc = new WebBrowser();
        wbc.DocumentText = "feces of a dummy";        //;magic words        
        HtmlDocument doc = wbc.Document.OpenNew(true);
        doc.Write((string)html);
        this.ReturnString = doc.Body.InnerHtml + " do here something";
        return;
    }
} 
```

用法：

```
string myhtml = "<HTML><BODY>This is a new HTML document.</BODY></HTML>";
Console.WriteLine("before:" + myhtml);
myhtml = (new ParseHTML()).doParsing(myhtml);
Console.WriteLine("after:" + myhtml); 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-11T09:47:26.593

解析 HTML 的问题在于它不是一门精确的科学。如果您要解析的是 XHTML，那么事情会容易得多（正如您提到的，您可以使用通用的 XML 解析器）。因为 HTML 不一定是格式良好的 XML，所以在解析它时会遇到很多问题。它几乎需要在逐个站点的基础上完成。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-19T08:03:00.583

I've used [ZetaHtmlTidy](http://www.codeproject.com/KB/cs/ZetaHtmlTidy.aspx) in the past to load random websites and then hit against various parts of the content with xpath (eg /html/body//p[@class='textblock']). It worked well but there were some exceptional sites that it had problems with, so I don't know if it's the absolute best solution.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-11T09:39:18.737

您可以使用 HTML DTD 和通用 XML 解析库。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-01-03T09:04:29.013

根据您的需要，您可能会选择功能更丰富的库。我尝试了大多数/所有建议的解决方案，但最突出的是 Html Agility Pack。它是一个非常宽容和灵活的解析器。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-11-12T14:53:50.937

如果您需要查看 JS 对页面的影响，请使用 WatiN [并且您已准备好启动浏览器]

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-03-22T20:29:03.597

试试这个脚本。

[http://www.biterscripting.com/SS_URLs.html](http://www.biterscripting.com/SS_URLs.html)

当我将它与这个网址一起使用时，

```
script SS_URLs.txt URL("http://stackoverflow.com/questions/56107/what-is-the-best-way-to-parse-html-in-c") 
```

它向我显示了该线程页面上的所有链接。

```
http://sstatic.net/so/all.css
http://sstatic.net/so/favicon.ico
http://sstatic.net/so/apple-touch-icon.png
.
.
. 
```

您可以修改该脚本以检查图像、变量等。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-12-19T18:13:53.373

我在 C# 中编写了一些用于解析 HTML 标签的类。如果它们满足您的特定需求，它们就很好而且简单。

您可以阅读有关它们的文章并在[http://www.blackbeltcoder.com/Articles/strings/parsing-html-tags-in-c](http://www.blackbeltcoder.com/Articles/strings/parsing-html-tags-in-c)下载源代码。

[在http://www.blackbeltcoder.com/Articles/strings/a-text-parsing-helper-class](http://www.blackbeltcoder.com/Articles/strings/a-text-parsing-helper-class)上还有一篇关于通用解析助手类的文章。

# .net - WCF、ASP.NET 成员资格提供程序和身份验证服务

> ID：56112
> 
> 赞同：13
> 
> 时间：2008-09-11T09:18:49.503
> 
> 标签：.net, wcf, web-services

我编写了一个与 WCF 服务 (BasicHttpBinding) 通信的 Silverlight 2 应用程序。托管 Silverlight 内容的站点使用 ASP.NET 成员资格提供程序进行保护。我可以使用 WCF 服务中的 HttpContext.Current.User.Identity.Name 访问当前用户，并且我已经打开了 AspNetCompatibilityRequirementsMode。

我现在想使用完全相同的 Web 服务编写一个 Windows 应用程序。为了处理身份验证，我启用了[身份验证服务](http://msdn.microsoft.com/en-us/library/bb386582.aspx)，并且可以调用“登录”来对我的用户进行身份验证......好吧，一切都很好......但是我怎么能在我的其他服务客户端上设置那个身份验证 cookie？！

两种服务都托管在同一个域上

*   MyDataService.svc <- 处理我的数据的那个
*   AuthenticationService.svc <- Windows 应用程序必须调用以进行身份​​验证的那个。

我不想为 Windows 客户端创建新服务，或者使用其他绑定...

客户端应用程序服务是另一种选择，但所有示例都仅限于展示如何获取用户、角色和他的个人资料......但是一旦我们使用客户端应用程序服务进行身份验证，就应该有一种方法来获取该身份验证 cookie回调到同一服务器时附加到我的服务客户端。

根据同事的意见，解决方案是添加一个 wsHttpBinding 端点，但我希望我能解决这个问题......

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-11T21:59:47.800

我终于找到了一种方法来完成这项工作。对于身份验证，我使用“ [WCF 身份验证服务](http://msdn.microsoft.com/en-us/library/bb386582.aspx)”。验证服务时会尝试设置验证 cookie。我需要从响应中获取此 cookie，并将其添加到对同一台机器上的其他 Web 服务发出的任何其他请求中。执行此操作的代码如下所示：

```
var authService = new AuthService.AuthenticationServiceClient();
var diveService = new DiveLogService.DiveLogServiceClient();

string cookieHeader = "";
using (OperationContextScope scope = new OperationContextScope(authService.InnerChannel))
{
    HttpRequestMessageProperty requestProperty = new HttpRequestMessageProperty();
    OperationContext.Current.OutgoingMessageProperties[HttpRequestMessageProperty.Name] = requestProperty;
    bool isGood = authService.Login("jonas", "jonas", string.Empty, true);
    MessageProperties properties = OperationContext.Current.IncomingMessageProperties;
    HttpResponseMessageProperty responseProperty = (HttpResponseMessageProperty)properties[HttpResponseMessageProperty.Name];
    cookieHeader = responseProperty.Headers[HttpResponseHeader.SetCookie];                
}

using (OperationContextScope scope = new OperationContextScope(diveService.InnerChannel))
{
    HttpRequestMessageProperty httpRequest = new HttpRequestMessageProperty();
    OperationContext.Current.OutgoingMessageProperties.Add(HttpRequestMessageProperty.Name, httpRequest);
    httpRequest.Headers.Add(HttpRequestHeader.Cookie, cookieHeader);
    var res = diveService.GetDives();
} 
```

如您所见，我有两个服务客户端，一个用于身份验证服务，一个用于我实际要使用的服务。第一个块将调用 Login 方法，并从响应中获取身份验证 cookie。第二个块将在调用“GetDives”服务方法之前将标头添加到请求中。

我对这段代码一点也不满意，我认为更好的选择可能是使用“Web Reference”而不是“Service Reference”并使用 .NET 2.0 堆栈。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-11T20:21:41.233

Web 服务（例如由 WCF 创建的那些）通常最好以“无状态”方式使用，因此对 Web 服务的每次调用都重新开始。这简化了服务器代码，因为不需要调用客户端状态的“会话”。它还简化了客户端代码，因为不需要保留票证、cookie 或其他假设服务器状态的东西。

以所描述的方式创建两个服务会引入有状态。客户端要么是“经过身份验证”，要么是“未经过身份验证”，MyDataService.svc 必须找出哪个。

*碰巧的是，当成员资格提供程序用于对服务的每次*调用进行身份验证时，我发现 WCF 运行良好。因此，在给出的示例中，您希望将成员资格提供程序身份验证 gubbins 添加到 MyDataService 的服务配置中，并且根本没有单独的身份验证服务。

[有关详细信息，请参阅此处](http://msdn.microsoft.com/en-us/library/ms731049.aspx)的 MSDN 文章。

[这对我来说非常有吸引力，因为我很懒，这完全是声明性的。我只是将我的 MembershipProvider 的正确配置条目分散在应用程序的 app.config 中，并且！答对了！对服务中每个合约的所有调用都经过身份验证。]

公平地说，这不会特别快。如果您将 SQL Server 用于身份验证数据库，那么每个服务调用至少会有一个，也许是两个存储过程调用。在许多情况下（特别是对于 HTTP 绑定）服务调用本身的开销会更大；如果没有，请考虑滚动您自己的缓存身份验证请求的成员资格提供程序的实现。

这*没有*提供的一件事是提供“登录”功能的能力。为此，您可以提供一个（经过身份验证的！）服务合约，它什么都不做（除了在身份验证失败时引发错误），或者您可以使用原始引用文章中描述的成员资格提供程序服务。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-09T04:15:16.783

在客户端上修改服务的 <binding> 标记（在 <system.serviceModel> 内）以包含：allowCookies="true"

应用程序现在应该保留 cookie 并使用它。您会注意到 IsLoggedIn 现在在您登录后返回 true —— 如果您不允许使用 cookie，它会返回 false。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T09:51:03.493

可以将许多额外代码隐藏在自定义消息检查器和行为后面，因此您无需自己修补 OperationContextScope。

稍后我将尝试模拟某些内容并将其发送给您。

--larsw

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T18:45:23.210

您应该看一下 System.Net 中的[CookieContainer](http://msdn.microsoft.com/en-us/library/system.net.cookiecontainer.aspx)对象。此对象允许非浏览器客户端挂在 cookie 上。这是我的团队上次遇到该问题时使用的方法。

这是一篇关于如何使用它[的简短文章。](http://www.justskins.com/forums/session-state-and-winforms-consuming-a-web-service-9763.html)那里可能有更好的，但这应该让你开始。

我们为当前的一组 WCF 服务和 Silverlight 2 应用程序采用了无状态路线。可以让 Silverlight 2 与绑定了 TransportWithMessageCredential 安全性的服务一起使用，尽管它在 Silverlight 端需要一些自定义安全代码。结果是任何应用程序都可以通过在消息头中设置用户名和密码来访问服务。这可以在自定义 IRequestChannel 实现中完成一次，因此开发人员无需担心自己设置值。尽管 WCF 确实为开发人员提供了一种简单的方法来做到这一点，我相信它是 serviceProxy.Security.Username 和 serviceProxy.Security.Password 或同样简单的东西。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T20:43:18.353

当我使用客户端应用程序服务对 Web 服务进行身份验证时，我写了这个。它使用消息检查器插入 cookie 标头。有一个带有文档和演示项目的 word 文件。虽然它不完全是你在做什么，但它非常接近。你可以从[这里](http://www.baileysc.com/releases/clientappservicesdemo.zip)下载。

# actionscript-3 - 三角三角 (ActionScript 3)

> ID：56118
> 
> 赞同：7
> 
> 时间：2008-09-11T09:22:45.187
> 
> 标签：actionscript-3, trigonometry, hypotenuse

我正在尝试在 ActionScript 3 中编写一个公式，该公式将以度为单位给出 var "z"（请参见下图），然后我将其转换为弧度。

我已经知道变量“x”和“y”的值。使用三角函数，我如何计算斜边的长度以及 var z 的可变角度？AS3 或伪代码中的解决方案将非常有帮助。谢谢。

![三角形](https://i.stack.imgur.com/B0nfz.jpg)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-11T19:08:16.997

你需要的是这样的：

```
var h:Number = Math.sqrt(x*x + y*y);
var z:Number = Math.atan2(y, x); 
```

这应该给你以弧度表示的角度，你可能需要交换 x/y 并可能添加或删除 90 度，但它应该可以解决问题！（请注意，当您使用 atan2 时，您甚至不需要**h**来获取**z ）**

我使用乘法而不是 Math.pow() 只是因为 Math 很慢，你可以这样做：

```
var h:Number = Math.sqrt(Math.pow(x, 2) + Math.pow(y, 2)); 
```

它应该是完全一样的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-11T09:27:37.610

z 相当于 180 - yH 的角度。或者：

```
180 - arctan(x/y) //Degrees
pi - arctan(x/y) //radians 
```

此外，如果 actionscript 的数学库有它，请使用 arctan2，它同时采用 x 和 y 并正确处理符号。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T10:40:39.710

您想要的角度与与 y 和 h 之间的角度相同。

让我们称之为和`a`之间的角度，您想要的角度实际上是或 取决于您的单位（度或弧度）。`y``h``180 - a``PI - a`

现在几何告诉我们：

```
cos(a) = y/h
sin(a) = x/h
tan(a) = x/y 
```

使用 tan()，我们得到：

```
a = arctan(x/y) 
```

当我们正在寻找 180 - a 时，您应该计算：

```
180 -  arctan(x/y) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-11T09:31:41.670

@Patrick 所说的，斜边也是`sqrt(x^2 + y^2)`.

# c# - C# 中的 IPC 机制 - 用法和最佳实践

> ID：56121
> 
> 赞同：55
> 
> 时间：2008-09-11T09:24:22.873
> 
> 标签：c#, .net, ipc

前段时间我在 Win32 代码中使用过 IPC - 关键部分、事件和信号量。

.NET 环境中的场景如何？是否有任何教程解释所有可用选项以及何时使用以及为什么？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-09-11T09:34:50.150

Microsoft 在 IPC 中的最新产品是[Windows Communication Foundation](http://en.wikipedia.org/wiki/Windows_Communication_Foundation)。实际上底层并没有什么新东西（tcp、upd、命名管道等），但是 WCF 极大地简化了 IPC 开发。

有用的资源：

*   在 Dobb 博士的门户上[与 WCF 进行进程间通信](http://www.ddj.com/windows/196802111)
*   [.NET Framework 3.5 中的 WCF 通信选项](http://www.infoq.com/news/2008/01/wcf-comm-options)

当然还有[WCF 上的 MSDN](http://msdn.microsoft.com/en-us/netframework/aa663324.aspx)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2011-09-27T16:36:06.430

除了显而易见的（WCF）之外，还有一个用于 C#/CLR 的 ZeroMQ 绑定非​​常好：

[http://www.zeromq.org/bindings:clr](http://www.zeromq.org/bindings:clr)

使用比 WCF 少得多的代码和配置执行面向消息的 IPC、发布/订阅和各种其他策略。

如果您需要低延迟通信，它也至少比其他任何东西都快一个数量级并且延迟更少。

关于信号量、锁、互斥锁等。如果您通过交流而不是通过共享进行交流，那么您将比传统范例更轻松。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-11T10:00:31.023

我倾向于使用命名管道或 Unix 套接字（取决于我是针对 MS.NET 还是 Mono——我有一个将其抽象出来的类），因为它易于使用、可移植，并且允许我轻松地与非托管代码进行互操作. 也就是说，如果您只处理托管代码，请使用 WCF 或远程处理——后者如果您需要 Mono 支持，因为他们的 WCF 支持根本不存在。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2012-01-03T13:18:42.533

如果您需要在机器域上使用而不是通过网络通信，我建议您使用内存映射文件。请参阅以下链接。

[http://techmikael.blogspot.com/2010/02/blazing-fast-ipc-in-net-4-wcf-vs.html](http://techmikael.blogspot.com/2010/02/blazing-fast-ipc-in-net-4-wcf-vs.html)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-11T09:38:24.463

还有 .NET Remoting，我觉得它很酷，但我想他们现在已经过时了，因为他们有 WCF。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-11T10:40:28.277

听起来您好像对同步技术而不是通信感兴趣。如果是这样，您可能想从[这里](http://msdn.microsoft.com/en-us/library/ms228964.aspx)开始，或者可能是这个更[简洁的概述](http://marekblog.wordpress.com/2007/02/05/net-framework-synchronization-primitives/)。

# 64-bit - 我可以在 32 位机器上运行 64 位 VMware 映像吗？

> ID：56124
> 
> 赞同：90
> 
> 时间：2008-09-11T09:26:25.240
> 
> 标签：64-bit, vmware, virtualization, virtual-machine

我可以在 32 位机器上运行 64 位 VMware 映像吗？

我已经用谷歌搜索了这个，但似乎没有一个决定性的答案。

我知道它必须完全模拟并且会像狗一样运行 - 但性能缓慢不一定是问题，因为我只是对在 64 位平台上测试我的一些后台服务代码感兴趣。

* * *

## 回答 #1

> 赞同：124
> 
> 时间：2008-09-11T10:10:18.677

检查工作站的最简单方法是从 VMware 网站下载[VMware Processor Check for 64-Bit Compatibility](http://downloads.vmware.com/d/details/processor_check_5_5_dt/dCpiQGhkYmRAZQ==)工具。

您不能在 32 位处理器上运行 64 位 VM 会话。但是，如果您有 64 位处理器但安装了 32 位主机操作系统并且您的处理器支持正确的扩展，则可以运行 64 位 VM 会话。上面链接的工具会告诉您是否有。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-09-11T11:42:16.693

如果你有 32 位硬件，不，你不能运行 64 位客户操作系统。[“VMware 软件不会为物理上不存在的不同硬件模拟指令集”](http://en.wikipedia.org/wiki/VMware#Core_product_design)。

但是，QEMU*可以*模拟 64 位处理器，因此您可以转换 VMWare 机器并使用它运行它

从[这篇 2008 年的博客文章（由archive.org 镜像）](http://web.archive.org/web/20080529004826/http://blog.xwings.net/?p=47)：

> ```
> $ cd /path/to/vmware/guestos
> $ for i in \`ls *[0-9].vmdk\`; do qemu-img convert -f vmdk $i -O raw {i/vmdk/raw};done
> $ cat *.raw >> guestos.img 
> ```
> 
> 要运行它，
> 
> ```
> qemu -m 256 -hda guestos.img 
> ```
> 
> 不足之处？我们大多数人在没有为虚拟磁盘预分配空间的情况下运行 VMware。因此，当我们从 VMware 转换到 QEMU 时，原始文件将是预分配的总空间。我仍在使用`-f qcow`格式测试它是否可以解决问题。如：
> 
> ```
> for i in `ls *[0-9].vmdk`; do qemu-img convert -f vmdk $i -O qcow ${i/vmdk/qcow}; done && cat *.qcow >> debian.img 
> ```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2011-09-17T10:18:00.273

是的，如果您有 64 位处理器，则可以从 32 位操作系统在 VMWare 中运行 64 位操作系统。

我有一个运行 Windows XP Professional 2002 的旧 Intel [Core 2 Duo](http://en.wikipedia.org/wiki/Intel_Core#Core_2_Duo)，我让它工作。

首先，查看您的 CPU 是否能够运行 64 位操作系统。在 VMware 站点上搜索“处理器检查 64 位兼容性”。运行程序。

如果它说您的处理器有能力，请重新启动计算机并进入 BIOS 并查看您是否具有“虚拟化”并能够启用它。我能够在这台旧笔记本电脑上的 VMware 下运行[Windows Server 2008 R2。](http://en.wikipedia.org/wiki/Windows_Server_2008)

我希望这个对你有用！

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-11T10:50:34.057

如果您的硬件仅为 32 位，则不会。如果您有 64 位硬件和 32 位操作系统，那么也许可以。有关详细信息，请参阅*[64 位客户机操作系统的硬件和固件要求](http://kb.vmware.com/selfservice/dynamickc.do?externalId=1901&sliceId=1&command=show&forward=nonthreadedKC&kcId=1901)*。它与一个与多个处理器无关。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-11T13:43:18.603

它归结为您机器中的CPU是否具有VT位（虚拟化），并且BIOS使您可以将其打开。例如，我的笔记本电脑是*[Core 2 Duo](http://en.wikipedia.org/wiki/Intel_Core#Core_2_Duo)*，它能够使用它。但是，我的 BIOS 无法打开它。

请注意，我读过打开此功能会使正常操作速度降低 10-12%，这就是它通常关闭的原因。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-11T09:32:01.420

老实说，出于多种原因，我对此表示怀疑，但最重要的是，有些指令在 32 位模式下是允许的，但在 64 位模式下是不允许的。具体来说，用于在 64 位模式下对某些指令和寄存器进行编码的 REX 前缀是 0x4f:0x40 形式的字节，但在 32 位模式下，相同的字节是具有固定操作数的 INC 或 DEC。
因此，任何以 REX 为前缀的 64 位指令都将被解释为 INC 或 DEC，并且不会让 VMM 有机会模拟 64 位指令（例如通过发出未定义的操作码异常信号）。

唯一可行的方法是在每条指令之后使用陷阱异常返回到 VMM，以便它可以查看是否需要特殊的 64 位处理。我根本看不到这种情况发生。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-11T09:53:35.113

威睿？不可以。但是，[QEMU](http://en.wikipedia.org/wiki/QEMU)有一个可以使用的 x86_64 系统目标。您可能无法直接使用 VMware 映像（IIRC，没有转换工具），但您可以自己安装操作系统等并在其中工作。QEMU 可能有点像一个 PITA 来启动和运行，但它往往工作得很好。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-05-07T23:09:18.303

VMware 不允许您在 32 位主机上运行 64 位来宾。您只需阅读文档即可找到答案。

如果你真的想这样做，你可以使用 QEMU，我推荐一个 Linux 主机，但它会很慢（我的意思是慢）。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-11T10:33:50.350

是的你可以。我有一个在 Windows XP 32 位的 VMware 中运行的 64 位 Debian。只要您将 Guest 设置为使用两个处理器，它就可以正常工作。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-11-08T22:33:20.140

如果您的处理器是 64 位并且启用了虚拟化技术 (VT) 扩展（可以在 BIOS 中将其关闭），则可以。你不能在 32 位处理器上做到这一点。

要在 Linux 下检查这一点，您只需查看*/proc/cpuinfo*文件。只需寻找适当的标志（英特尔处理器的**vmx**或AMD 处理器的**svm ）**

```
egrep '(vmx|svm)' /proc/cpuinfo 
```

要在 Windows 下检查这一点，您需要使用像 CPU-Z 这样的程序，它将显示您的处理器架构和支持的扩展。

# c++ - MFC IE 嵌入式网络浏览器古怪

> ID：56145
> 
> 赞同：5
> 
> 时间：2008-09-11T09:41:53.720
> 
> 标签：c++, internet-explorer, mfc, dialog

我有这个嵌入 Internet Explorer Web 浏览器控件的无模式 MFC 对话框。

该控件直接来自`CWnd`Visual Studio 生成的 ActiveX 包装器，我将其映射到`CDialog`仅使用`DDX_Control(pDX, IDC_EXPLORER, m_explorer);`.

我有2个问题。

### 问题 1：

由于没有模式，我使用 new/Create()，然后使用 DestroyWindow()/delete（在 PostNcDestroy 中）随意启动和停止对话框。

当 IE 控件开始加载 Flash 视频（常规的 YouTube 内容）时，麻烦就开始了：当一个关闭，从而破坏对话框时，视频仍然加载！直到完全缓存。即使父对话框已通过 PostNcDestroy 并且所有内存都已释放，Flash ActiveX 线程仍会徘徊并继续运行。

该怎么办？您如何真正“杀死”该子 Web 控件及其所有线程？

### 问题2：

Web 浏览器控件覆盖对话框的整个区域。我无法截获任何`OnMouseMove()`- 在父对话框或 Web 浏览器映射类中！是什么赋予了？

谢谢！

* * *

“清理”

在 PostNcDestroy() 中“删除这个”——当然是调用基本函数。应该更多吗？什么？对话不应该优雅地照顾它的孩子吗？

我试图在 Web 控件上显式调用 DestroyWindow，或者向他发送/发布消息，例如 WM_DESTROY、WM_CLOSE，甚至 WM_QUIT——但没有——同样的交易。

问题2：

不，就像缩进一样，控件占用了所有空间并且它在顶部，所以我猜任何鼠标操作都不会被“下方”传输:)？但是为什么不调用他自己的 OnMouseMove 呢？因为它直接来自CWnd？我迷路了...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-17T20:38:17.133

问题 1) 在销毁窗口之前尝试 myBrowser.navigate("about:blank")。

# windows - 在 Subversion 存储库中存储文件权限

> ID：56149
> 
> 赞同：41
> 
> 时间：2008-09-11T09:45:37.613
> 
> 标签：windows, svn, file-permissions

您如何将文件权限存储在存储库中？一些文件需要只读以阻止第三方程序破坏它，但在签出存储库后，它们被设置为读写。

我在 google 上找到了[一篇 2005 年的博客文章，](http://mamchenkov.net/wordpress/2005/04/27/subversion-and-file-permissions/)其中指出 Subversion 不存储文件权限。列出了补丁和钩子脚本（只有一个 url 仍然存在）。三年后，Subversion 是否仍然不存储文件权限，并且挂钩是解决此问题的唯一方法吗？（我从来没有做过钩子，而是使用了 Subversion 原生的东西。）

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-09-11T11:25:17.140

SVN 确实具有将元数据（[属性](http://svnbook.red-bean.com/en/1.0/ch07s02.html)）与文件一起存储的能力。属性基本上只是键/值对，但是有一些特殊的键，例如 'svn:executable'，如果文件存在此属性，Subversion 将在检出文件时为该文件设置文件系统的可执行位。虽然我知道这并不完全是您正在寻找的东西，但它可能就足够了（对我来说）。

行尾 (svn:eol-style) 和 mime 类型 (svn:mime-type) 还有其他属性。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-11T11:23:52.493

在 SVN 中没有本地存储文件权限的方法。

asvn和[该博客文章中的补丁似乎](http://svn.collab.net/repos/svn/branches/meta-data-versioning/)[都已](http://svn.apache.org/repos/asf/subversion/trunk/contrib/client-side/asvn)启动（并托管在官方 SVN 存储库中），这是一件好事，但我认为他们不会很快在核心版本中进行此类元数据处理。

SVN 有能力专门处理[符号链接](http://svnbook.red-bean.com/en/1.4/svn.tour.cycle.html#svn.tour.cycle.edit)和[可执行文件](http://svnbook.red-bean.com/en/1.4/svn.advanced.props.file-portability.html#svn.advanced.props.special.executable)很长一段时间，但在 Win32 上都不能正常工作。我不会为另一个这样的非便携式功能屏住呼吸（尽管在已经存在的元数据系统之上实现它不会太难。）

我会考虑编写一个 shell 脚本来手动调整文件权限，然后将其放入存储库中。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-11T10:23:29.503

一种可能的解决方案是编写一个脚本，将其与其余代码一起签入，并作为构建过程的第一步运行。

此脚本运行您的代码库副本并设置某些文件的读取权限。

理想情况下，脚本会从一个简单的输入文件中读取文件列表。这将使其他开发人员易于维护并且易于理解哪些文件被标记为只读。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-02-24T03:13:08.180

因为这在之前的回复中还没有完全说明。我讨厌复活僵尸线程。

由于为 SVN 添加权限支持必须适应多种操作系统和权限类型、NFS、POSIX、ARWED 和 RACF

这会使 SVN 臃肿，可能与 NFS 和 POSIX 等冲突的权限类型发生冲突，或者打开可能的漏洞利用/安全漏洞。

有几种解决方法。pre-commit、post-commit、start-commit 是比较常用的，并且是 Subversion 系统的一部分。但是将允许您使用您喜欢的任何编程语言来控制权限。

我实现的系统就是我所说的打包程序，它验证工作副本的提交文件，然后解析一个元数据文件，其中列出了文件/文件夹所需的默认权限，以及您也希望对它们进行的任何更改。

```
Owner, Group, Folders, Files
default: <user> www-user 750 640
/path/to/file: <user> non-www 770 770
/path/to/file2: <user> <user> 700 700 
```

您还可以对此进行扩展并允许自动移动、重命名、按类型标记修订，如 alpha、beta、候选发布、发布

至于支持客户签出您的存储库文件，并附有权限。您最好考虑创建软件包的安装程序并将其作为资源提供。

想象一下人们将他们的存储库设置为其中设置了 root:www-user 4777 权限的可执行文件

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-06-11T02:13:57.053

[这](http://svn.apache.org/repos/asf/subversion/trunk/contrib/client-side/asvn)是正确处理 unix 样式文件权限的 SVN 补丁的更新链接。我已经在 fedora12 上进行了测试，并且似乎可以按预期工作：

如果我需要正确处理权限，我只是将其保存在 /usr/bin/asvn 并使用 asvn 而不是 svn 命令。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-11-21T15:25:23.290

许多答案都表明 svn 不存储文件权限。这可能是真的，但我可以通过以下步骤解决没有执行权限问题的 dll 文件：

1.  chmod 755 badpermission.dll
2.  mv badpermission.dll ../
3.  svn更新
4.  svn rm badpermission.dll
5.  svn commit badpermission.dll -m "删除 dll 以修复权限"
6.  mv ../badpermission.dll 。
7.  svn 添加 badpermission.dll
8.  svn commit badpermission.dll -m "重新添加 dll 以修复权限"
9.  rm badpermission.dll
10.  svn更新
11.  badpermission.dll 以执行权限返回

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-11T11:28:54.087

@morechilli：

我之前的帖子中的 asvn 包装器和 OP 帖子中的博客似乎符合您的建议。尽管它将权限存储在相应文件的存储库属性中，而不是单个外部文件。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-07-17T18:54:20.890

我建议使用 mtree 实用程序生成权限映射（FreeBSD 默认有它），将映射存储在存储库中，并且如上所述，运行一个脚本，作为第一步从映射恢复正确的文件权限构建过程。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-11T10:08:44.123

锁定不能解决这个问题。锁定会阻止其他人编辑文件。这是一个第三方应用程序，它作为构建过程的一部分运行，它试图写入文件 - 更改它 - 这会破坏构建过程。因此，我们需要阻止程序更改文件，这只是将文件标记为只读。我们希望将这些信息保存在存储库中，并通过签入、分支等进行传递。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-11T10:28:44.810

格雷厄姆，`svn`不存储权限。您唯一的选择是将调用包装`svn`在脚本中。该脚本应`svn`使用其参数调用，然后设置权限。根据您的环境，您可能需要调用您的脚本`svn`并调整您的脚本`PATH`以确保它被调用。

我非常喜欢 morechilli 将文件和权限列表签入存储库本身的想法。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-11T11:12:34.267

我们创建了一个批处理文件来为我们执行此操作。虽然更喜欢颠覆的实际支持......

* * *

## 回答 #12

> 赞同：-6
> 
> 时间：2008-09-11T09:49:11.597

考虑使用[`svn lock`](http://svnbook.red-bean.com/nightly/en/svn.advanced.locking.html)禁止其他人写入文件。

# defensive-programming - 测试用例和断言语句

> ID：56168
> 
> 赞同：12
> 
> 时间：2008-09-11T09:53:28.203
> 
> 标签：defensive-programming

[这个问题](https://stackoverflow.com/questions/17181/test-cases-vs-assertion-statement)中的代码让我想到

```
assert(value>0); //Precondition
if (value>0)
{
  //Doit
} 
```

我从不写 if 语句。断言就足够了/你*能做*的。“早崩溃，经常崩溃”

[CodeComplete](https://rads.stackoverflow.com/amzn/click/com/0735619670)状态：

*   断言语句使应用程序正确
*   if-test 使应用程序健壮

我不认为您通过更正无效的输入值或跳过代码使应用程序更健壮：

```
assert(value >= 0 );  //Precondition
assert(value <= 90);  //Precondition
if(value < 0)         //Just in case
  value = 0;
if (value > 90)       //Just in case
  value = 90;
//Doit 
```

这些更正基于您对外部世界所做的假设。只有调用者知道你的函数的“有效输入值”是什么，他必须在调用你的函数之前检查它的有效性。

套用[CodeComplete的话：“当我们](https://rads.stackoverflow.com/amzn/click/com/0735619670)*不完全*依赖断言时，现实世界的程序会*变得*过于混乱。”

 *问题：我是不是错了，固执，愚蠢，太不防备......

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-11T09:58:39.890

只信任断言的问题在于它们可能在生产环境中被关闭。引用维基百科的文章：

> 大多数语言都允许全局启用或禁用断言，有时甚至是独立的。断言通常在开发过程中启用，在最终测试和发布给客户时禁用。不检查断言避免了评估断言的成本，同时假设断言没有副作用，在正常条件下仍然产生相同的结果。在异常情况下，禁用断言检查可能意味着本应中止的程序将继续运行。这有时是可取的。 [维基百科](http://en.wikipedia.org/wiki/Assertion_(computing))

因此，如果您的代码的正确性依赖于 Asserts 的存在，您可能会遇到严重的问题。当然，如果代码在测试期间工作，它应该在生产期间工作......现在输入第二个处理代码并且只是要解决一个小问题的人......

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-11T10:51:35.800

使用断言来验证您控制的输入：私有方法等。

使用 if 语句来验证您无法控制的输入：为用户使用而设计的公共接口、用户输入测试等。

使用内置的断言测试您的应用程序。然后在没有断言的情况下进行部署。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-11T09:59:01.263

在某些情况下，断言在构建发布时被禁用。您可能无法控制这一点（否则，您可以使用断言进行构建），因此这样做可能是个好主意。

“纠正”输入值的问题是调用者不会得到他们期望的结果，这可能导致程序的完全不同部分出现问题甚至崩溃，使调试成为一场噩梦。

我通常在 if 语句中抛出一个异常来接管断言的角色，以防它们被禁用

```
assert(value>0);
if(value<=0) throw new ArgumentOutOfRangeException("value");
//do stuff 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-11T10:09:10.100

I would disagree with this statement:

> Only the caller knows what "a valid input value" is for your function, and he must check its validity before he calls your function.

Caller might *think* that he know that input value is correct. Only method author knows how it suppose to work. Programmer's best goal is to make client to fall into "[pit of success](http://blogs.msdn.com/brada/archive/2003/10/02/50420.aspx)". You should decide what behavior is more appropriate in given case. In some cases incorrect input values can be forgivable, in other you should throw exception\return error.

As for Asserts, I'd repeat other commenters, assert is a *debug* time check for code author, not code clients.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-11T09:59:31.697

如果我没记错的话

前提条件定义了函数输出的定义条件。如果你让你的函数处理错误条件，你的函数是为这些条件定义的，你不需要断言语句。

所以我同意。通常你不需要两者。

正如 Rik 评论的那样，如果您在已发布的代码中删除断言，这可能会导致问题。通常我不这样做，除非在性能关键的地方。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-11T10:06:35.613

Don't forget that most languages allow you to turn off assertions... Personally, if I was prepared to write if tests to protect against **all** ranges of invalid input, I wouldn't bother with the assertion in the first place.

If, on the other hand you don't write logic to handle all cases (possibly because it's not sensible to try and continue with invalid input) then I would be using the assertion statement and going for the "fail early" approach.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-11T10:44:31.543

我应该说我知道断言（此处）在生产代码中消失的事实。

如果 if 语句实际上纠正了生产代码中的无效输入数据，这意味着断言在调试代码测试期间从未发生过，这意味着您编写的代码从未执行过。

对我来说，这是一个 OR 情况：

（引用 Andrew）“防止所有范围的无效输入，我一开始就不会为断言而烦恼。” -> 编写一个 if 测试。

（引用 aku）“可以原谅不正确的输入值”-> 写一个断言。

两个都*受不了*

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-11T10:08:10.773

For internal functions, ones that only you will use, use **asserts** only. The asserts will help catch bugs during your testing, but won't hamper performance in production.

Check inputs that originate externally with **if-conditions**. By externally, that's anywhere outside the code that you/your team control and test.

Optionally, you can have **both**. This would be for external facing functions where integration testing is going to be done before production.

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-09-11T10:00:18.827

断言的一个问题是它们可以（并且通常会）从代码中编译出来，因此您需要添加两面墙，以防编译器丢弃它们。

# windows-vista - 如何以编程方式获取 Vista 版本？

> ID：56195
> 
> 赞同：5
> 
> 时间：2008-09-11T10:09:19.770
> 
> 标签：windows-vista

如何以编程方式获取 Vista 版本，即 Home Basic、Home Premium、Business 或 Ultimate？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-11T10:11:20.950

MSDN 给出了广泛的答案：

[获取系统版本](http://msdn.microsoft.com/en-us/library/ms724429%28VS.85%29.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T10:50:37.253

```
[Environment.OSVersion][1] 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-18T14:54:45.250

杰出的！这也正是我所需要的。谢谢阿库。

edg: Environment.OSVersion 包含一个版本字符串，但这通常不能提供足够的信息来区分版本（也适用于 XP Home/XP Pro）。此外，该字符串存在本地化的风险，因此对其进行匹配不一定有效。

# c# - WMI - 直接访问 Win32_OperatingSystem 的单例实例

> ID：56208
> 
> 赞同：3
> 
> 时间：2008-09-11T10:19:44.333
> 
> 标签：c#, windows-vista, windows-xp, wmi

我无法直接访问通过 WMI 公开的**Win32_OperatingSystem**管理类。

它是一个单例类，我很确定“Win32_OperatingSystem=@”是获取单例实例的正确路径语法。

调用 InvokeMethod 会产生问题底部列出的异常，访问 ClassPath 属性（注释行）也是如此。

我究竟做错了什么？

[我知道我可以使用 ManagementObjectSearcher/ObjectQuery 来返回 Win32_OperatingSystem 的集合（它只包含一个），但因为我知道它是一个单例，所以我想直接访问它。]

* * *

```
ManagementScope cimv2 = InitScope(string.Format(@"\\{0}\root\cimv2", this.Name));

ManagementObject os = new ManagementObject(
    cimv2,
    new ManagementPath("Win32_OperatingSystem=@"),
    new ObjectGetOptions());

//ManagementPath p = os.ClassPath;

os.InvokeMethod("Reboot", null); 
```

* * *

System.Management.ManagementException 在 System.Management.ManagementObject.Initialize(Boolean getObject) 处的 System.Management.ManagementException.ThrowWithExtendedInfo(ManagementStatus errorCode) 处被捕获 Message="Invalid object path" Source="System.Management" StackTrace： Management.ManagementBaseObject.get_wbemObject() 在 System.Management.ManagementObject.get_ClassPath() 在 System.Management.ManagementObject.GetMethodParameters(String methodName, ManagementBaseObject& inParameters, IWbemClassObjectFreeThreaded& inParametersClass, IWbemClassObjectFreeThreaded& outParametersClass) 在 System.Management.ManagementObject.InvokeMethod(String methodName,对象 [] 参数）

* * *

感谢您的回复。

**尼克**- 我不知道该怎么做 :)

**Uros - 因为**[这个](http://msdn.microsoft.com/en-us/library/aa394239.aspx)MSDN 页面，我的印象是这是一个单例类。此外，在 WBEMTest 实用程序中打开该类会显示[此](http://img247.imageshack.us/img247/5686/64933271au3.png).

* * *

实例对话框在这些字段中显示：“1 个对象”和“最大批次：1”并列出“Win32_OperatingSystem=@”

ManagementScope 被验证为工作，所以我不知道发生了什么。我是 WMI 新手，但这似乎是最简单的用例之一！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-15T19:03:42.010

Win32_OperatingSystem 不是单例类 - 如果您检查它的限定符，您会发现没有为它定义单例限定符，因此您必须使用 ManagementObjectSearcher.Get() 或 ManagementClass.GetInstances() 即使只有该类的一个实例。Win32_OperatingSystem 的关键属性是 Name，所以有一个选项可以直接获取实例，使用

```
ManagementObject OS = new ManagementObject(@"Win32_OperatingSystem.Name='OSname'") 
```

但根据我的经验， OSName 总是类似于：

"Microsoft Windows XP Professional|C:\WINDOWS|\Device\Harddisk0\Partition1"

所以使用 ManagementObjectSearcher 可能是最简单的解决方案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-18T07:26:49.960

我刚刚尝试了这个运行良好的简单应用程序

```
using System;
using System.Management;

namespace WmiPlay
{
    class Program
    {
        static void Main(string[] args)
        {
            try
            {
                ManagementScope cimv2 = new ManagementScope(@"\\.\root\cimv2");
                ManagementObject os = new ManagementObject(cimv2, new ManagementPath("Win32_OperatingSystem=@"), new ObjectGetOptions());
                Console.Out.WriteLine(os);
            }
            catch (Exception ex)
            {
                Console.Error.WriteLine(ex);
            }
        }
    }
} 
```

看看这对你有用吗？我确实在 Visual Studio 中运行过它，我通常在 Vista x64 下以管理员身份运行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T22:30:20.457

我不是 100% 确定答案，但是您是否尝试过使用反射器查看 ManagementObjectSearcher 的功能？它可能会给你一些关于你做错了什么的线索。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T14:52:51.060

我可能会构造一个查询来获取 Primary = true 的实例。我有一段时间没有使用 Win32_OperatingSystem，但我似乎记得获得了多个实例，而当前启动的那个实例的 Primary 等于 true。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T17:34:35.370

> 邓肯写道：
> 
> 实例对话框显示：“1 个对象”和“最大批次：1”在这些字段中并 > 列出“Win32_OperatingSystem=@”

它确实看起来应该可以工作。您可以使用另一个单例类测试您的代码，例如：

"Win32_WmiSetting=@"

看看你是否仍然得到异常。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-16T14:40:10.123

哇，世界在变。抱歉，我不知道您使用的是 Vista。[正如您在此处](http://img390.imageshack.us/img390/871/image1jq9.png)所见，Windows XP 中的情况有所不同。那么，当您单击“实例”按钮时会发生什么？

# language-agnostic - 语言不可知的洗牌卡组问题

> ID：56215
> 
> 赞同：9
> 
> 时间：2008-09-11T10:27:15.327
> 
> 标签：language-agnostic

不久前，我在接受采访，这需要解决两个非常有趣的问题。我很好奇您将如何处理解决方案。

问题1：

**除电流外的所有产品**

编写一个函数，将长度为 len、input 和 index 的两个整数数组作为输入，并生成第三个数组 result，这样：result[i] = input 中除 input[index[i]] 之外的所有内容的乘积

例如，如果使用 len=4、input={2,3,4,5} 和 index={1,3,2,0} 调用函数，则结果将设置为 {40,24,30 ,60}。

重要提示：您的算法必须在线性时间内运行。

问题 2：（主题在 Jeff 的一篇文章中）

**均匀洗牌**

1.  设计（在 C++ 或 C# 中）类 Deck 来表示有序的一副牌，其中一副牌包含 52 张牌，分为 13 个等级（A、2、3、4、5、6、7、8、9、 10、J、Q、K) 的四种花色：黑桃 (?)、红心 (?)、方块 (?) 和梅花 (?)。

2.  基于这个类，设计并实现一种有效的算法来洗牌。牌必须均匀洗牌，也就是说，原始牌组中的每张牌必须有相同的概率最终出现在洗牌牌组中的任何可能位置。该算法应该在类 Deck 的方法 shuffle() 中实现： void shuffle()

3.  你的算法的复杂度是多少（作为一副牌中卡片数量 n 的函数）？

4.  解释你将如何测试你的方法是否均匀地洗牌（黑盒测试）。

PS 我有两个小时来编写解决方案

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-11T11:05:28.997

第一个问题：

```
int countZeroes (int[] vec) {
int ret = 0;
foreach(int i in vec) if (i == 0) ret++;

return ret;
}

int[] mysticCalc(int[] values, int[] indexes) {
    int zeroes = countZeroes(values); 
    int[] retval = new int[values.length];
    int product = 1;

    if (zeroes >= 2) { // 2 or more zeroes, all results will be 0
        for (int i = 0; i > values.length; i++) {
            retval[i] = 0;      
        }
        return retval;
    }
    foreach (int i in values) {
        if (i != 0) product *= i; // we have at most 1 zero, dont include in product;
    }
    int indexcounter = 0;
    foreach(int idx in indexes) {
        if (zeroes == 1 && values[idx] != 0) {  // One zero on other index. Our value will be 0
            retval[indexcounter] = 0;
        }
        else if (zeroes == 1) { // One zero on this index. result is product
            retval[indexcounter] = product;
        }
        else { // No zeros. Return product/value at index
            retval[indexcounter] = product / values[idx];
        }
        indexcouter++;
    }   
    return retval;
} 
```

在最坏的情况下，该程序将单步执行 3 个向量。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T10:34:04.813

对于第一个，首先计算 input 全部内容的乘积，然后对于 index 的每个元素，将计算得到的乘积除以 input[index[i]]，以填充您的结果数组。

当然，我必须假设输入没有零。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T11:11:30.823

# C 中除电流以外的所有内容的乘积

```
void product_except_current(int input[], int index[], int out[], 
                            int len) {
  int prod = 1, nzeros = 0, izero = -1;

  for (int i = 0; i < len; ++i) 
    if ((out[i] = input[index[i]]) != 0)
      // compute product of non-zero elements 
      prod *= out[i]; // ignore possible overflow problem
    else {
      if (++nzeros == 2) 
         // if number of zeros greater than 1 then out[i] = 0 for all i
         break; 
      izero = i; // save index of zero-valued element
    }

  //  
  for (int i = 0; i < len; ++i)  
    out[i] = nzeros ? 0 : prod / out[i];                               

  if (nzeros == 1)
    out[izero] = prod; // the only non-zero-valued element
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T11:18:26.203

Tnilsson，很好的解决方案（因为我以完全相同的方式完成了它：P）。

我看不到任何其他方式可以在线性时间内做到这一点。有人吗？因为招聘经理告诉我，这个解决方案不够强大。

我们是否缺少一些超级复杂的，在一条返回线中完成所有事情的解决方案？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-11T13:40:37.953

第一个问题的 C#3 中的线性时间解决方案是：-

```
IEnumerable<int> ProductExcept(List<int> l, List<int> indexes) {
    if (l.Count(i => i == 0) == 1) {
        int singleZeroProd = l.Aggregate(1, (x, y) => y != 0 ? x * y : x);
        return from i in indexes select l[i] == 0 ? singleZeroProd : 0;
    } else {
        int prod = l.Aggregate(1, (x, y) => x * y);
        return from i in indexes select prod == 0 ? 0 : prod / l[i];
    }
} 
```

**编辑：**考虑到一个零！我的上一个解决方案在我工作时花了我 2 分钟，所以我感觉还不错:-)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-11T15:42:28.143

这是 C# 中第二个带有测试方法的答案。Shuffle 在我看来是 O(n)。

**编辑：**看过Fisher-Yates shuffle后，我发现我在不知道的情况下重新发明了该算法:-)但是很明显。我实现了 Durstenfeld 方法，它使我们从 O(n^2) -> O(n) 开始，非常聪明！

```
public enum CardValue { A, Two, Three, Four, Five, Six, Seven, Eight, Nine, Ten, J, Q, K }
public enum Suit { Spades, Hearts, Diamonds, Clubs }

public class Card {
    public Card(CardValue value, Suit suit) {
        Value = value;
        Suit = suit;
    }

    public CardValue Value { get; private set; }
    public Suit Suit { get; private set; }
}

public class Deck : IEnumerable<Card> {
    public Deck() {
        initialiseDeck();
        Shuffle();
    }

    private Card[] cards = new Card[52];

    private void initialiseDeck() {
        for (int i = 0; i < 4; ++i) {
            for (int j = 0; j < 13; ++j) {
                cards[i * 13 + j] = new Card((CardValue)j, (Suit)i);
            }
        }
    }

    public void Shuffle() {
        Random random = new Random();

        for (int i = 0; i < 52; ++i) {
            int j = random.Next(51 - i);
            // Swap the cards.
            Card temp = cards[51 - i];
            cards[51 - i] = cards[j];
            cards[j] = temp;
        }
    }

    public IEnumerator<Card> GetEnumerator() {
        foreach (Card c in cards) yield return c;
    }

    System.Collections.IEnumerator System.Collections.IEnumerable.GetEnumerator() {
        foreach (Card c in cards) yield return c;
    }
}

class Program {
    static void Main(string[] args) {
        foreach (Card c in new Deck()) {
            Console.WriteLine("{0} of {1}", c.Value, c.Suit);
        }

        Console.ReadKey(true);
    }
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-15T03:16:55.510

在哈斯克尔：

```
import Array

problem1 input index = [(left!i) * (right!(i+1)) | i <- index]
  where left  = scanWith scanl
        right = scanWith scanr
        scanWith scan = listArray (0, length input) (scan (*) 1 input) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-11T10:38:26.550

Vaibhav，不幸的是，我们不得不假设输入表中可能有一个 0。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-11T11:22:52.823

**第二个问题。**

```
 public static void shuffle (int[] array) 
    {
        Random rng = new Random();   // i.e., java.util.Random.
        int n = array.length;        // The number of items left to shuffle (loop invariant).
        while (n > 1) 
        {
            int k = rng.nextInt(n);  // 0 <= k < n.
            n--;                     // n is now the last pertinent index;
            int temp = array[n];     // swap array[n] with array[k] (does nothing if k == n).
            array[n] = array[k];
            array[k] = temp;
        }
    } 
```

[这是关于Fisher-Yates](http://en.wikipedia.org/wiki/Fisher-Yates_shuffle) shuffle的维基百科文章的复制/粘贴。O(n) 复杂度

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-11T11:32:55.047

Tnilsson，我同意 YXJuLnphcnQ 解决方案可以说更快，但想法是一样的。我忘了补充，在第一个问题中语言是可选的，在第二个问题中也是可选的。

你是对的，计算为零，并且同一循环中的产品更好。也许就是这样。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-11T11:39:12.487

Tnilsson，我也使用了 Fisher-Yates shuffle :)。我对测试部分很感兴趣：）

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-11T12:09:29.357

# Shuffle card deck evenly in C++

```
#include <algorithm>

class Deck {
  // each card is 8-bit: 4-bit for suit, 4-bit for value
  // suits and values are extracted using bit-magic
  char cards[52];
  public:
  // ...
  void shuffle() {
    std::random_shuffle(cards, cards + 52);
  }
  // ...
}; 
```

Complexity: Linear in N. Exactly 51 swaps are performed. See [http://www.sgi.com/tech/stl/random_shuffle.html](http://www.sgi.com/tech/stl/random_shuffle.html)

**Testing**:

```
 // ...
  int main() {
    typedef std::map<std::pair<size_t, Deck::value_type>, size_t> Map;
    Map freqs;    
    Deck d;
    const size_t ntests = 100000;

    // compute frequencies of events: card at position
    for (size_t i = 0; i < ntests; ++i) {
      d.shuffle();
      size_t pos = 0;
      for(Deck::const_iterator j = d.begin(); j != d.end(); ++j, ++pos) 
        ++freqs[std::make_pair(pos, *j)]; 
    }

    // if Deck.shuffle() is correct then all frequencies must be similar
    for (Map::const_iterator j = freqs.begin(); j != freqs.end(); ++j)
      std::cout << "pos=" << j->first.first << " card=" << j->first.second 
                << " freq=" << j->second << std::endl;    
  } 
```

As usual, one test is not sufficient.

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-11T13:04:07.730

Trilsson made a separate topic about the testing part of the question

[How to test randomness (case in point - Shuffling)](https://stackoverflow.com/questions/56411/how-to-test-randomness-case-in-point-shuffling)

very good idea Trilsson:)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-11T13:15:31.320

YXJuLnphcnQ, that's the way I did it too. It's the most obvious.

But the fact is, that if you write an algorithm, that just shuffles all the cards in the collection one position to the right every time you call sort() it would pass the test, even though the output is not random.

# c# - 创建由数据库驱动的对象以填充 Treeview - 非常慢

> ID：56224
> 
> 赞同：2
> 
> 时间：2008-09-11T10:33:54.173
> 
> 标签：c#, dictionary, object, clone, icloneable

我有一个从数据库中读取表的应用程序。

我发出 SQL 查询以获取结果集，基于从结果中收集的唯一字符串值，我使用 case/switch 语句生成某些对象（它们继承 TreeNode BTW）。这些创建的对象被分流到 Dictionary 对象中以供以后使用。

在生成这些对象时，我使用结果集中的一些值通过 setter 填充对象中的值。

我查询 Dictionary 以返回特定对象类型并使用它来填充树视图。但是，不可能从 Dictionary 对象的树视图中填充 2 个相同类型的对象（您会遇到运行时错误 - 目前我无法理解，这与引用同一对象有关）。所以我要做的是使用 memberwiseClone 并实现 IClonable 来解决这个问题。

我这样做对吗？有没有更好的方法 - 因为我认为这导致我的程序在这一点上真的很慢。至少我认为它有点笨拙——来自比我了解更多的人的任何建议——非常感谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-11T10:57:40.870

您使用外部字典是否有原因？我会在查询数据时直接填充树。

如果确实需要字典，则可以将树节点的 .Tag 属性设置为指向字典中的数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T11:25:28.933

要添加到[@Brad](https://stackoverflow.com/questions/56224/creating-objects-driven-by-the-database-to-populate-a-treeview-very-slow-c#56264)，只需根据需要填充树。这意味着挂钩到树节点的展开事件。这类似于处理网络共享时 Windows 资源管理器的功能。

树中每个实际的树节点应该有 1 个`TreeNode`对象 - 不要尝试重用这些东西。您可以使用 Tag 属性将它们与您的数据相关联（这是推荐的方法），或者您可以将`TreeNode`其本身子类化（这是 Java 方法，但在 .NET 中使用较少）。

（克隆方法的使用通常暗示您（a）做错了什么，或者（b）需要分解您的域模型以将可变对象与不可变对象分开。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-10-02T20:09:54.343

have you considered using a Virtual Tree view which only loads the nodes the user actually wants to look at - i've had good success with the component from www.infralution.com

# svn - 如何确定目录中最新的 SVN 修订号？

> ID：56227
> 
> 赞同：34
> 
> 时间：2008-09-11T10:35:02.767
> 
> 标签：svn, build-automation

我想开始用最新的 SVN 修订号标记我部署的二进制文件。

但是，因为 SVN 是基于文件的而不是基于目录/项目的，所以我需要扫描所有目录和子目录的文件以确定最高修订号。

在根目录上使用`svn info`不起作用（它只报告该目录的版本，而不是子目录中的文件）：

我想知道是否有使用该`svn`命令的快捷方式来执行此操作。否则，任何人都可以建议一个简单的网络高效脚本（如果它根本没有命中远程服务器，我会更喜欢）？

我也知道另一种方法*是*使用`svn:keywords`. 这行得通（我在其他项目中使用过），但我厌倦了处理确保文件脏和处理不可避免的合并冲突。

**回答**`svn up`我发现我的问题在于在调用`svn info`根目录之前没有做正确的事情：

```
$ svn info
Path: .
...
Last Changed Author: fak
Last Changed Rev: 713
Last Changed Date: 2008-08-29 00:40:53 +0300 (Fri, 29 Aug 2008)

$ svn up
At revision 721.

$ svn info
Path: .
...
Revision: 721
Last Changed Author: reuben
Last Changed Rev: 721
Last Changed Date: 2008-08-31 22:55:22 +0300 (Sun, 31 Aug 2008) 
```

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-11T10:43:00.050

单程。查看代码时，请查看 svn 输出的最后一行：

```
$ svn up
...stuff...
Updated to revision 66593. 
```

更直接的方法：

```
$ svn info
Path: .
URL: https://svn.example.com/svn/myproject/trunk
Repository Root: https://svn.example.com/svn/
Repository UUID: d2a7a951-c712-0410-832a-9abccabd3052
Revision: 66593
Node Kind: directory
Schedule: normal
Last Changed Author: bnguyen
Last Changed Rev: 66591
Last Changed Date: 2008-09-11 18:25:27 +1000 (Thu, 11 Sep 2008) 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-10-30T11:44:17.467

[`svnversion`](http://svnbook.red-bean.com/en/1.7/svn.ref.svnversion.re.html)似乎是最干净的方法：

```
svnversion -c /path/to/your-projects-local-working-copy/. | sed -e 's/[MS]//g' -e 's/^[[:digit:]]*://' 
```

上面的命令将从输出中清除任何 M 和 S 字母（表示本地修改或切换），以及较小的修订号，以防`svnversion`返回一个范围而不是仅一个修订号（有关更多信息，请参阅[文档](http://svnbook.red-bean.com/en/1.1/re57.html)）。如果您不想过滤输出，请取出管道和该`sed`命令的一部分。

如果您想使用`svn info`，您还需要使用“递归”( `-R`) 参数从所有子目录中获取信息。由于输出然后变成一个长列表，您需要进行一些过滤以从所有最高的版本中获取最后更改的修订号：

```
svn info -R /path/to/your-projects-local-working-copy/. | awk '/^Last Changed Rev:/ {print $NF}' | sort -n | tail -n 1 
```

该命令的作用是获取包含 string 的所有行`"Last Changed Rev"`，然后从每一行中删除除最后一个字段（即修订号）之外的所有内容，然后对这些行进行数字排序并删除除最后一行之外的所有内容，结果仅在最高修订号中。例如，如果您运行的是 Windows，我相信您也可以在 PowerShell 中轻松完成此操作。

只是要清楚一点：上述方法为您提供了本地工作副本所代表的存储库中路径的递归最后更改修订号，*对于该本地工作副本，*而无需访问服务器。因此，如果有人在您的 last 之后将此路径中的某些内容更新到存储库服务器上`svn update`，它将不会反映在此输出中。

如果您想要的是*服务器上*此路径的最后更改版本，您可以执行以下操作：

```
svn info /path/to/your-projects-local-working-copy/.@HEAD | awk '/^Last Changed Rev:/ {print $NF}' 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-30T13:59:21.440

[这个问题](https://stackoverflow.com/questions/110175/how-to-access-the-current-subversion-build-number#112674)的重复。正如我在那里发布的那样，`svnversion`命令是你的朋友。无需解析输出，无需先更新，即可完成工作。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-11T10:54:47.900

我不知道您是否使用 MSBuild(Visual Studio) 来构建二进制文件。但如果你愿意：Subverion 和 MSBuild 之间可能通过 [MSBuild 社区任务项目建立联系](http://msbuildtasks.tigris.org/)

这是我们构建脚本的一部分：我们的 (C#) 应用程序获取包含的 svn 修订号：

```
 <SvnVersion LocalPath="$(MSBuildProjectDirectory)" ToolPath="installationpath\of\subversion\bin">
     <Output TaskParameter="Revision" PropertyName="Revision" />
  </SvnVersion>
  <Message Text="Version: $(Major).$(Minor).$(Build).$(Revision)"/>
...
    AssemblyVersion="$(Major).$(Minor).$(Build).$(Revision)"
     AssemblyFileVersion="$(Major).$(Minor).$(Build).$(Revision)" 
```

简

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-11T11:00:00.413

@Charles Miller 和 @Troels Arvin 提供的答案是正确的 - 您可以使用`svn update`or的输出`svn info`，但正如您所暗示的，后者仅在存储库是最新的情况下才有效。再说一次，如果您的源代码树的一部分与另一部分位于不同的修订版上，我不确定*任何修订号对您有什么价值。*在我看来，这听起来真的像是你应该在一棵同质树上工作。我建议在运行 info 之前进行更新（或者如果您已经为您的构建进行了更新，那么您就是黄金）或使用`svn info URL-to-source`.

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-30T14:00:19.520

有一个随 Subversion 一起分发的程序，称为[svnversion](http://svnbook.red-bean.com/en/1.1/re57.html)，它完全可以满足您的需求。这就是我们标记网站的方式。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-12-02T16:36:28.873

如果您只想要提交的最新更改的修订号，并且使用没有 grep/awk/xargs 的 Windows，这里是运行的基本命令（命令行）：

```
X:\trunk>svn info -r COMMITTED | for /F "tokens=2" %r in ('findstr /R "^Revision"') DO @echo %r
67000 
```

`svn info -r COMMITTED`将为您提供对当前所在目录的最新提交更改：

```
X:\Trunk>svn info -r COMMITTED
Path: trunk
URL: https://svn.example.com/svn/myproject/trunk
Repository Root: https://svn.example.com/svn/
Repository UUID: d2a7a951-c712-0410-832a-9abccabd3052
Revision: 67400
Node Kind: directory
Last Changed Author: example
Last Changed Rev: 67400
Last Changed Date: 2008-09-11 18:25:27 +1000 (Thu, 11 Sep 2008) 
```

for 循环运行`findstr`以定位输出的 Revision 部分`svn info`。输出将是（你不会看到这个）：

```
Revision: 67000 
```

然后拆分[令牌](http://ss64.com/nt/for_cmd.html)，并返回第二个，以被`echo`淘汰：

```
67000 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-11T10:43:47.597

“svn info”将显示工作副本的修订号（参见“svn info”输出中的“Revision”行）。您的构建系统可能允许您将“svn info”输出的相关部分放置在将反映在您的应用程序中的某个位置。例如，您可以指定在构建时，应创建一个临时（未版本化）文件，其中包含“svn info”的输出；然后在编译时包含此文件。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-01-16T21:46:29.170

对我来说，找出主干/分支的最新修订号的最佳方法是从远程 URL 获取它。重要的是不要使用工作目录，因为它可能已过时。这是一个带有批处理的片段（我非常讨厌;-)）：

```
@for /f "tokens=4" %%f in ('svn info %SVNURL% ^|find "Last Changed Rev:"') do set lastPathRev=%%f

echo trunk rev no: %lastPathRev% 
```

不过，我有一个问题，将这个数字作为临时版本硬编码到包含 $Rev:$ 的源中。问题是 $Rev:$ 包含文件 rev。不。因此，如果中继版本号大于版本文件的版本号，我需要“人为”修改此文件并提交它以获得正确的临时版本（=中继版本）。这是一个窗格！有人有更好的主意吗？非常感谢

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-10-24T20:17:33.760

这很荒谬，但`svn info`或`svnversion`不会考虑子目录；这是一个名为“混合修订”的功能——我称之为折磨。我只需要找到实时代码库的最新“修订版”，下面的破解方式对我有用 - 运行可能需要一段时间：

```
repo_root# find ./ | xargs -l svn info  | grep 'Revision: ' | sort
...
Revision: 86
Revision: 86
Revision: 89
Revision: 90
root@fairware:/home/stage_vancity# 
```

# python - 用于 Python 的 XML 编写工具

> ID：56229
> 
> 赞同：35
> 
> 时间：2008-09-11T10:35:37.163
> 
> 标签：python, xml, xhtml

我目前正在尝试 ElementTree，它看起来不错，它可以转义 HTML 实体等等。我是否错过了一些我从未听说过的真正美妙的东西？

这类似于我实际在做的事情：

```
import xml.etree.ElementTree as ET
root = ET.Element('html')
head = ET.SubElement(root,'head')
script = ET.SubElement(head,'script')
script.set('type','text/javascript')
script.text = "var a = 'I love &aacute; letters'"
body = ET.SubElement(root,'body')
h1 = ET.SubElement(body,'h1')
h1.text = "And I like the fact that 3 > 1"
tree = ET.ElementTree(root)
tree.write('foo.xhtml')

# more foo.xhtml
<html><head><script type="text/javascript">var a = 'I love &amp;aacute;
letters'</script></head><body><h1>And I like the fact that 3 &gt; 1</h1>
</body></html> 
```

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-09-11T11:04:15.503

另一种方法是使用来自 lxml 的[E Factory](http://codespeak.net/lxml/tutorial.html#the-e-factory)构建器（在[Elementtree](http://effbot.org/zone/element-builder.htm)中也可用）

```
>>> from lxml import etree

>>> from lxml.builder import E

>>> def CLASS(*args): # class is a reserved word in Python
...     return {"class":' '.join(args)}

>>> html = page = (
...   E.html(       # create an Element called "html"
...     E.head(
...       E.title("This is a sample document")
...     ),
...     E.body(
...       E.h1("Hello!", CLASS("title")),
...       E.p("This is a paragraph with ", E.b("bold"), " text in it!"),
...       E.p("This is another paragraph, with a", "\n      ",
...         E.a("link", href="http://www.python.org"), "."),
...       E.p("Here are some reserved characters: <spam&egg>."),
...       etree.XML("<p>And finally an embedded XHTML fragment.</p>"),
...     )
...   )
... )

>>> print(etree.tostring(page, pretty_print=True))
<html>
  <head>
    <title>This is a sample document</title>
  </head>
  <body>
    <h1 class="title">Hello!</h1>
    <p>This is a paragraph with <b>bold</b> text in it!</p>
    <p>This is another paragraph, with a
      <a href="http://www.python.org">link</a>.</p>
    <p>Here are some reservered characters: &lt;spam&amp;egg&gt;.</p>
    <p>And finally an embedded XHTML fragment.</p>
  </body>
</html> 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2010-06-23T04:16:17.863

总是有[SimpleXMLWriter](http://effbot.org/zone/xml-writer.htm)，它是 ElementTree 工具包的一部分。界面非常简单。

这是一个例子：

```
from elementtree.SimpleXMLWriter import XMLWriter
import sys

w = XMLWriter(sys.stdout)
html = w.start("html")

w.start("head")
w.element("title", "my document")
w.element("meta", name="generator", value="my application 1.0")
w.end()

w.start("body")
w.element("h1", "this is a heading")
w.element("p", "this is a paragraph")

w.start("p")
w.data("this is ")
w.element("b", "bold")
w.data(" and ")
w.element("i", "italic")
w.data(".")
w.end("p")

w.close(html) 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-11T12:53:06.977

我假设您实际上是在创建 XML DOM 树，因为您想验证进入该文件的内容是否是有效的 XML，否则您只需将静态字符串写入文件。如果验证您的输出确实是您的目标，那么我建议

```
from xml.dom.minidom import parseString

doc = parseString("""<html>
    <head>
        <script type="text/javascript">
            var a = 'I love &amp;aacute; letters'
        </script>
    </head>
    <body>
        <h1>And I like the fact that 3 &gt; 1</h1>
    </body>
    </html>""")

with open("foo.xhtml", "w") as f:
    f.write( doc.toxml() ) 
```

这使您只需编写要输出的 XML，验证它是否正确（因为 parseString 会在无效时引发异常）并使您的代码看起来更好。

大概您不只是每次都编写相同的静态 XML 并且想要一些替换。在这种情况下，我会有像

```
var a = '%(message)s' 
```

然后使用 % 运算符进行替换，例如

```
</html>""" % {"message": "I love &amp;aacute; letters"}) 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2011-08-14T22:09:27.390

[https://github.com/galvez/xmlwitch](https://github.com/galvez/xmlwitch)：

```
import xmlwitch
xml = xmlwitch.Builder(version='1.0', encoding='utf-8')
with xml.feed(xmlns='http://www.w3.org/2005/Atom'):
    xml.title('Example Feed')
    xml.updated('2003-12-13T18:30:02Z')
    with xml.author:
        xml.name('John Doe')
    xml.id('urn:uuid:60a76c80-d399-11d9-b93C-0003939e0af6')
    with xml.entry:
        xml.title('Atom-Powered Robots Run Amok')
        xml.id('urn:uuid:1225c695-cfb8-4ebb-aaaa-80da344efa6a')
        xml.updated('2003-12-13T18:30:02Z')
        xml.summary('Some text.')
print(xml) 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-11T10:55:44.013

你真的不想要这样的东西：

```
html(head(script(type='text/javascript', content='var a = ...')),
body(h1('And I like the fact that 3 < 1'), p('just some paragraph')) 
```

我想我在某个地方看到过类似的东西。这将是美妙的。

**编辑：**实际上，我今天去写了一个图书馆来做到*这一点*：[magictree](http://pypi.python.org/pypi/magictree)

你可以像这样使用它：

```
from magictree import html, head, script, body, h1, p
root = html(
         head(
           script('''var a = 'I love &amp;aacute; letters''', 
                  type='text/javascript')),
         body(
           h1('And I like the fact that 3 > 1')))

# root is a plain Element object, like those created with ET.Element...
# so you can write it out using ElementTree :)
tree = ET.ElementTree(root)
tree.write('foo.xhtml') 
```

神奇之处`magictree`在于导入的工作方式：`Element`工厂是在需要时创建的。看看[源代码](http://code.google.com/p/pymagictree/source/browse/trunk/magictree.py)，它[基于对另一个 StackOverflow 问题的回答](https://stackoverflow.com/questions/2447353/getattr-on-a-module)。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-15T11:00:37.663

我最终使用 saxutils.escape(str) 生成有效的 XML 字符串，然后使用 Eli 的方法对其进行验证，以确保我没有错过任何标签

```
from xml.sax import saxutils
from xml.dom.minidom import parseString
from xml.parsers.expat import ExpatError

xml = '''<?xml version="1.0" encoding="%s"?>\n
<contents title="%s" crawl_date="%s" in_text_date="%s" 
url="%s">\n<main_post>%s</main_post>\n</contents>''' %
(self.encoding, saxutils.escape(title), saxutils.escape(time), 
saxutils.escape(date), saxutils.escape(url), saxutils.escape(contents))
try:
    minidoc = parseString(xml)
catch ExpatError:
    print "Invalid xml" 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2013-11-01T14:36:08.380

对于现在遇到这种情况的任何人，实际上有一种方法可以隐藏在 Python 的标准库中的[xml.sax.utils.XMLGenerator](http://docs.python.org/2.7/library/xml.sax.utils.html)中。这是它的一个例子：

```
>>> from xml.sax.saxutils import XMLGenerator
>>> import StringIO
>>> w = XMLGenerator(out, 'utf-8')
>>> w.startDocument()
>>> w.startElement("test", {'bar': 'baz'})
>>> w.characters("Foo")
>>> w.endElement("test")
>>> w.endDocument()
>>> print out.getvalue()
<?xml version="1.0" encoding="utf-8"?>
<test bar="baz">Foo</test> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-12T07:48:15.343

试试[http://uche.ogbuji.net/tech/4suite/amara](http://uche.ogbuji.net/tech/4suite/amara)。它非常完整，并且有一套直接的访问工具。正常的 Unicode 支持等。

```
#
#Output the XML entry
#
def genFileOLD(out,label,term,idval):
    filename=entryTime() + ".html"
    writer=MarkupWriter(out, indent=u"yes")
    writer.startDocument()
    #Test element and attribute writing
    ans=namespace=u'http://www.w3.org/2005/Atom'
    xns=namespace=u'http://www.w3.org/1999/xhtml'
    writer.startElement(u'entry',
       ans,
       extraNss={u'x':u'http://www.w3.org/1999/xhtml' ,
                 u'dc':u'http://purl.org/dc/elements/1.1'})
    #u'a':u'http://www.w3.org/2005/Atom',
    #writer.attribute(u'xml:lang',unicode("en-UK"))

    writer.simpleElement(u'title',ans,content=unicode(label))
    #writer.simpleElement(u'a:subtitle',ans,content=u' ')
    id=unicode("http://www.dpawson.co.uk/nodesets/"+afn.split(".")[0])
    writer.simpleElement(u'id',ans,content=id)
    writer.simpleElement(u'updated',ans,content=unicode(dtime()))
    writer.startElement(u'author',ans)
    writer.simpleElement(u'name',ans,content=u'Dave ')
    writer.simpleElement(u'uri',ans,
      content=u'http://www.dpawson.co.uk/nodesets/'+afn+".xml")
    writer.endElement(u'author')
    writer.startElement(u'category', ans)
    if (prompt):
        label=unicode(raw_input("Enter label "))
    writer.attribute(u'label',unicode(label))
    if (prompt):
        term = unicode(raw_input("Enter term to use "))
    writer.attribute(u'term', unicode(term))
    writer.endElement(u'category')
    writer.simpleElement(u'rights',ans,content=u'\u00A9 Dave 2005-2008')
    writer.startElement(u'link',ans)
    writer.attribute(u'href',
         unicode("http://www.dpawson.co.uk/nodesets/entries/"+afn+".html"))
    writer.attribute(u'rel',unicode("alternate"))
    writer.endElement(u'link')
    writer.startElement(u'published', ans)
    dt=dtime()
    dtu=unicode(dt)
    writer.text(dtu)
    writer.endElement(u'published')
    writer.simpleElement(u'summary',ans,content=unicode(label))
    writer.startElement(u'content',ans)
    writer.attribute(u'type',unicode("xhtml"))
    writer.startElement(u'div',xns)
    writer.simpleElement(u'h3',xns,content=unicode(label))
    writer.endElement(u'div')
    writer.endElement(u'content')
    writer.endElement(u'entry') 
```

# wcf - 关于 WCF 服务配置文件的问题

> ID：56249
> 
> 赞同：18
> 
> 时间：2008-09-11T10:49:46.677
> 
> 标签：wcf, configuration, configuration-files

据我所见，在 IIS 中托管 WCF 服务时会忽略该标记。我知道在自托管时这是必需的，但在 IIS 下运行时这是否有害甚至使用？

前任。

```
<system.serviceModel>
  <service blah blah blah>
    <host>
      <baseAddresses>
        <add baseAddress="http://localhost/blah" />
      </baseAddresses>
    </host>
   </service>
</system.serviceModel> 
```

从我所见，您可以从一台机器上获取描述服务的配置文件，然后在完全不同的机器上使用它，它工作正常。看起来 IIS 似乎完全忽略了这一部分。

谢谢，凯尔

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-09-11T11:21:15.870

正如您已经猜到的，在 IIS 中托管时，baseAddresses 元素会被完全忽略。服务的基地址由放置 wcf 服务的网站和虚拟目录决定。

即使在自托管时，也不需要 baseAddresses。这只是一种方便，避免您必须为每个端点输入完整地址。如果存在，端点可以具有相对地址（即相对于基地址）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-10-21T08:24:49.373

自托管所需的基地址。IIS/WAS 主机忽略基地址。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-12-16T20:47:23.630

根据以下链接中的 MSDN Microsoft 文档，在注释部分的页面中间状态，“托管在 Internet 信息服务 (IIS) 或 Windows 进程激活服务 (WAS) 下的服务使用虚拟目录作为它们的基地址。”

[http://msdn.microsoft.com/en-us/library/ee358768(v=vs.110).aspx](http://msdn.microsoft.com/en-us/library/ee358768(v=vs.110).aspx)

# visual-studio-2008 - 将 .rptproj 从 VS2005 转换为 VS2008

> ID：56256
> 
> 赞同：6
> 
> 时间：2008-09-11T10:53:15.813
> 
> 标签：visual-studio-2008, reporting-services

我有了全新的 VS2008，并决定从 VS2005 转换我的主要解决方案。其中一个项目是 SQL2005 报告服务项目。现在我已经转换了，我无法在 VS2008 中加载它。有没有办法解决？

我的问题是我的解决方案是混合的，其中有网站库和报告。将其分开会破坏解决方案实体的逻辑。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-11T11:27:17.743

Visual Studio 2008 不支持 2005 商业智能项目，所以如果您还没有这样做，请不要卸载 2005 商业智能！您可以继续在 VS2005 中独立维护这些项目。

SQL Server 2008 商业智能将与 VS2008 集成，因此您将需要它并升级到您现有的报告项目以在 VS2008 中使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T05:11:43.570

要获得 BI2008，您必须安装 MSSQL2008。完成后，您可能会发现项目将加载。如果没有，请创建一个新的报表项目并将现有的 RDL 文件添加到其中。

# asp.net - 对整个网站使用 Silverlight？

> ID：56266
> 
> 赞同：10
> 
> 时间：2008-09-11T10:59:08.590
> 
> 标签：asp.net, silverlight, architecture

我们需要建立一个管理门户网站来支持我们的客户端/服务器应用程序。由于我们是一家 .Net 商店，因此显而易见的传统方式是在 ASP.Net 中进行。但是 Silverlight 2 将在我们发布日期之前的一段时间内推出测试版。我们是否应该考虑使用支持 WCF 后端的 silverlight 来构建整个网站？

门户的主要功能将是：用户、组和权限配置；用户配置文件设置配置；支持应用程序所需的文件的文件上传和下载。

我认为采用这种方法的主要原因是我们对 WPF 和 WCF 有很好的经验，但在 ASP.Net 方面的经验很少。无论哪种方式，我们都必须学习 ASP.Net 或 Silverlight，而学习 Silverlight 似乎是我们当前技能的更自然的延伸。

StackOverflowers 的体验中是否有什么大的禁忌？有哪些大的积极因素？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-11T11:27:37.727

我建议不要建立一个纯 Silverlight 站点。

Silverlight 面临与 Flash 相同的问题：不直观的书签、打印问题、可访问性问题、无法使用后退按钮等等。

此外，您将要求您的用户安装 Silverlight 或至少能够安装它。

在受控环境（例如，在大公司或医疗保健机构）或移动设备上，情况可能并非如此。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-11T12:03:19.200

我肯定会选择完整的 Silverlight 应用程序，特别是如果您有 WPF 的良好经验。您将能够重用您从 WPF 获得的知识，并且应该能够相当快地掌握 Silverlight。我从 Beta 1 开始就一直在使用 Silverlight，目前的 Beta 2 质量可靠。我想可以肯定地假设 RTW 版本指日可待。

Pilf 有一些有效的观点，特别是在印刷方面。为此，我可能会在服务器端使用 SQL Reporting Services 或其他一些报告框架，然后弹出一个带有可打印报告的新窗口。对于链接和书签，问题与任何其他 AJAX 应用程序没有什么不同。我今天写了一篇关于如何在Silverlight[中提供深度链接和后退导航的博文。](http://jonas.follesoe.no/BackAndForwardNavigationInSilverlight2UsingASPNETAJAX.aspx)

Silverlight 还具有出色的可访问性支持所需的所有挂钩，因为 WPF 的 UI 自动化 API 被引入 Silverlight。我不知道屏幕阅读器供应商是否已经赶上了。Silverlight 中的样式/模板支持可以轻松地为视障用户提供高对比度的皮肤（如果这是一个问题）。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-11T12:01:41.827

取决于你的目标。如果管理门户是应用程序的一部分，并且只能在安装了您的应用程序的计算机上使用，那么完全使用 Silverlight（甚至 WPF）有很多优势。

但是，如果您可以看到将在随机 PC 或随机人上使用它的场景，那么功能齐全的 HTML/Javascript 版本是绝对必要的。

一些原因是：

*   大多数人没有silverlight，如果他们必须下载并安装它，您将获得大量的咒骂。一些安装了它的人将其禁用（连同闪光灯，有时甚至是图像）以避免分心并加快浏览速度。
*   当 HTML 站点失败时，用户会收到错误页面并重新加载。当 silverlight 失败时，它可能会挂起或崩溃。
*   HTML 是用户和网络浏览器所期望的：返回和刷新按钮按预期工作，超链接和表单按预期工作。
*   在偏远地区和移动设备中，慢速互联网仍然很常见。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-11T12:05:43.407

到目前为止，我同意大家所说的，我认为这个针对 Flash 的流程图也适用于 Silverlight。

![在此处输入图像描述](https://i.stack.imgur.com/pnxmn.jpg)

*[图片来源](http://www.thegooglecache.com/rants-and-raves/should-i-make-a-flash-site-flash-website-flowchart/)*

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-11T11:41:38.300

听起来您的问题是您需要一个富客户端管理应用程序。为什么不使用点击一次？

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-17T15:30:32.517

关于远程和管理员的话题，另一位发帖人表示，如果管理员的连接速度较慢，那么这是支持 HTML 的论据。我认为根据信息的类型，使用 Silverlight 可能更有效。如果您有一个使用服务器端数据绑定填充的 ASP.NET 数据网格，则可以下载大量标记和视图状态数据。即使您使用在 ViewState 上较轻的 DataGrid 的替代品，您仍然需要下载大量 HTML。

在 Silverlight 中，一旦您关闭 XAP（它可能会比相应的 HTML 小），XAP 就会被缓存，因此您不应该每次都有这样的成本，您将只是检索数据本身。

再举一个例子，假设您的一个表单上有一堆下拉列表，它们在列表中都有相同的值。在 Silverlight 中，您可以一次获取这些值并将它们绑定到所有的 dorpdowns，在 HTML 中您必须每次都重复它们。

这将在 ASP.NET 中使用客户端数据绑定变得更好，它遵循与 Silverlight 和 WPF 非常相似的数据绑定模型。

总的来说，我还认为您需要为 Silverlight 实现编写更少的代码，这可以提高生产力并降低维护成本。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-11T11:01:21.940

一路ASP。当文本不能做你想做的事情时，你应该只使用silverlight/flash等——例如显示视频。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-11T12:37:20.117

为您的网站使用插件会使其速度变慢，并且需要用户安装插件。例如，Silverlight 排除了所有 Linux 用户。此外，由于 Silverlight 是相当新的，如果不尽快启动，微软将如何致力于保持该平台的活力也无法确定。

我会坚持使用带有服务器端脚本的普通旧 HTML。

此外，对于公共网站：Flash 和 Silverlight 不能被任何搜索引擎索引，所以如果您想要任何访问者，那么祝您编写大量元数据好运。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-17T14:03:57.077

Silverlight 对于面向内部的门户是一个不错的选择，就像如果您已经评估了您的项目并决定继续使用 Web 门户，那么对于面向公众的门户也是如此。您可以自由地将 Silverlight 组件集成到现有 ASP.NET 应用程序（即“丰富的岛屿”）方法中，但如果您有能力从头开始构建新项目，请不要将完全的 Silverlight 解决方案视为有效的解决方案选择使用传统 ASP.NET 门户的位置。Silverlight 现在是 RTW，所以如果这个决定仍然在桌面上，你知道你将不必处理未来的重大变化。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-11T11:31:09.183

完全使用 Flash/Silverlight 开发网站有一些[缺点](https://stackoverflow.com/questions/56266/using-silverlight-for-an-entire-website#56302)，但如果这些缺点对您来说无关紧要或不会产生影响，那么没有什么能阻止您。选择您认为更能满足您需求的任何工具。我不会因为缺点而推迟纯粹在 Silverlight 中创建网站，因为它为用户体验带来了更多的积极因素。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-11T12:05:16.357

之前的评论已经解决了在这样的网站上使用 Silverlight 的大部分缺点，我同意。如果您决心进行富客户端风格的开发并且您的受众很小（仅适用于管理员），那么我可能会推荐 WPF 而不是 Silverlight，因为它目前提供了更丰富的工具和控件集。

如果您坚持使用 ASP.NET，您是否看过动态数据 - 它非常适合轻松构建后端管理站点。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-11T12:30:24.643

我在微软看过“Silverlight only”网站，它们令人印象深刻。但同样，演示是为了充分发挥 Silverlight 的潜力。当您需要不同的东西时，您可能会不走运。除了安装/查看方式之外，我看不到 Silverlight 之类的 Flash。但是与 Visual Studio 可以通过 .NET 提供的功能相比，Flash/ActionScript 后端确实很*糟糕*

问问自己为什么要使用 Silverlight？花哨的效果或编程模型？

# c# - Context.User 在 Global.asax.Application_AuthenticateRequest 中分配后失去角色

> ID：56271
> 
> 赞同：3
> 
> 时间：2008-09-11T11:06:31.973
> 
> 标签：c#, .net, asp.net, forms-authentication, roles

我在我的 asp.net (3.5) 应用程序中使用表单身份验证。我还使用角色来定义哪些用户可以访问应用程序的哪些子目录。因此，我的 web.config 文件的相关部分如下所示：

```
<system.web>
  <authentication mode="Forms">
    <forms loginUrl="Default.aspx" path="/" protection="All" timeout="360" name="MyAppName" cookieless="UseCookies"  />      
  </authentication>
  <authorization >
    <allow users="*"/>
  </authorization>
</system.web>

<location path="Admin">
  <system.web>
    <authorization>
      <allow roles="Admin"/>
      <deny users="*"/>
    </authorization>
  </system.web>
</location> 
```

根据我所阅读的内容，这应该确保唯一能够访问 Admin 目录的用户将是已经过身份验证并分配了 Admin 角色的用户。

用户身份验证、保存身份验证票证和其他相关问题都可以正常工作。如果我从 web.config 文件中删除标签，一切正常。当我尝试强制只有具有 Admin 角色的用户才能访问 Admin 目录时，问题就出现了。

基于此[MS 知识库文章](http://support.microsoft.com/kb/311495)以及提供相同信息的其他网页，我已将以下代码添加到我的 Global.asax 文件中：

```
protected void Application_AuthenticateRequest(Object sender, EventArgs e) {
    if (HttpContext.Current.User != null) {
        if (Request.IsAuthenticated == true) {    
            // Debug#1            
            FormsAuthenticationTicket ticket = FormsAuthentication.Decrypt(Context.Request.Cookies[FormsAuthentication.FormsCookieName].Value);
            // In this case, ticket.UserData = "Admin"                
            string[] roles = new string[1] { ticket.UserData }; 
            FormsIdentity id = new FormsIdentity(ticket);
            Context.User = new System.Security.Principal.GenericPrincipal(id, roles);
            // Debug#2
        }
    }
} 
```

但是，当我尝试登录时，我无法访问 Admin 文件夹（重定向到登录页面）。

尝试调试问题时，如果我单步执行请求，如果我在上面标记为 Debug#1 的行处执行 Context.User.IsInRole("Admin")，它会返回 false。如果我在 Debug#2 行执行相同的语句，它等于 true。因此，至少就 Global.asax 而言，角色已正确分配。

在 Global.asax 之后，执行直接跳转到 Login 页面（因为缺少角色会导致 admin 文件夹中的页面加载被拒绝）。但是，当我在登录的 Page_Load 的第一行执行相同的语句时，它返回 false。因此，在 Global.asax 中的 Application_AuthenticateRequest 和受限目录中 WebForm 的初始加载之后的某个地方，角色信息正在丢失，导致身份验证失败（注意：在 Page_Load 中，正确的身份验证票证仍然分配给 Context.User.Id - 只有角色正在丢失）。

我做错了什么，我怎样才能让它正常工作？

* * *

**更新：我输入了[下面的解决方案](https://stackoverflow.com/questions/56271/contextuser-losing-roles-after-being-assigned-in-globalasaxapplicationauthentic#57040)**

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-11T16:23:11.433

**这是问题和解决方案**：

在开发的早期，我进入了网站菜单并单击了 Asp.net 配置。这导致将以下行添加到 web.config 中：

```
<system.web>
  <roleManager enabled="true" />
</system.web> 
```

从那时起，该应用程序假定我通过 Asp.net 站点管理器而不是通过 FormsAuthentication 角色来扮演角色。因此，尽管实际的身份验证和角色逻辑设置正确，但仍会反复失败。

从 web.config 中删除此行后，一切正常。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T13:18:13.607

这只是一个随机的镜头，但是您是否因为管理员的授权顺序而被阻止？也许您应该尝试切换您的全部拒绝和您的全部管理员。

以防万一它被拒绝覆盖。

（我在这里有代码示例，但它们没有出现。

# asp.net - 将 ASPX 导出为 HTML

> ID：56279
> 
> 赞同：5
> 
> 时间：2008-09-11T11:15:54.213
> 
> 标签：asp.net, html, screen-scraping

我们正在构建一个 CMS。该站点将由用户在 aspx 页面中构建和管理，但我们希望创建一个 HTML 的静态站点。我们现在使用的方法是使用我在[此处](http://forums.asp.net/p/931180/1092188.aspx#1092188)找到的代码，该代码重载了 Aspx 页面中的 Render 方法并将 HTML 字符串写入文件。这适用于单个页面，但我们的 CMS 的问题是，我们希望从一开始就自动为站点创建一些 HTML 页面，甚至在创建者编辑系统中的任何内容之前。有谁知道有什么方法可以做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-15T19:58:40.180

通过使用 Server.Ecxcute 方法，我似乎找到了解决问题的方法。

我发现一篇[文章](http://odetocode.com/articles/162.aspx)证明了它的使用：

```
TextWriter textWriter = new StringWriter();
Server.Execute("myOtherPage.aspx", textWriter); 
```

然后我在 textWriter 上做了一些操作，并将其插入到一个 html 文件中。瞧！有用！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-11T11:18:53.783

调用`Render`方法还是很简单的。只需创建页面的一个实例，`WebContext`连同`WebRequest`对象一起创建一个存根，然后调用`Render`页面的方法。然后，您可以自由地对结果做任何您想做的事情。

或者，编写一个小脚本`curl`或`wget`脚本来下载和存储您想要静态化的任何页面。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-11T11:23:05.570

您可以使用 wget（一个命令行工具）递归地查询每个页面并将它们保存到 html 文件中。它将更新生成的 html 中的所有必要链接以引用 .html 文件而不是 .aspx。这样，您可以像使用服务器生成的页面一样对所有站点进行编码（更易于测试），然后将其转换为静态页面。

如果仅出于性能原因需要静态 HTML，我的首选是使用 ASP.Net 输出缓存。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-11T11:28:35.367

我建议您以非常简单的方式执行此操作，并且不要在代码中执行此操作。它将允许您的 CMS 代码执行 CMS 代码应该执行的操作，并使其尽可能简单。

使用[HTTrack](http://www.httrack.com/)等产品。它称自己为“网站复印机”。它抓取一个站点并创建 html 输出。它快速且免费。你可以让它以你认为最好的频率运行。

它将您的 HTML 输出需求与您的 CMS 设计和实施分离。它降低了复杂性，并为您在输出 HTML 的方式上提供了一些灵活性，而不会在 CMS 代码中引入故障点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-11T12:21:37.987

@ckarras：我宁愿不使用外部工具，因为我希望以编程方式而不是手动创建 HTML 页面。

@jttraino：我没有需要输出站点的时间间隔-用户创建新站点时必须发生 uotput。

@Frank Krueger：我真的不明白如何使用 WebContext 和 WebRequest 创建我的页面实例。

[我在searchdotnet](http://www.searchdotnet.com)中搜索了“wget” ，并找到了[一篇](http://forums.asp.net/p/540670/540744.aspx#540744)关于名为 WebClient 的 .net 类的帖子。如果我使用 DownloadString() 方法，它似乎可以做我想做的事——从特定的 url 获取字符串。问题是因为我们的 CMS 需要登录，当该方法试图到达页面时，它被抛出到登录页面，因此返回 login.aspx HTML...

关于我如何从这里继续的任何想法？

# git - 你能在 git 中查看聚合变更集吗？如果是这样，怎么做？

> ID：56296
> 
> 赞同：8
> 
> 时间：2008-09-11T11:24:53.660
> 
> 标签：git, diff

在 Subversion 中，您可以指定一系列版本来获取一系列提交的聚合视图。这在git中可能吗？如果是这样，怎么做？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-11T11:37:09.717

您可以使用 .. (and ...) 运算符传递修订范围。

```
git diff 6d0918...HEAD 
```

除了给出（缩写的）SHA 哈希值，您还可以表示相对于分支和标签的修订：

```
git diff HEAD~4 # shows the diff from the last four commits to the current one 
```

[查看git-rev-parse 手册页](http://www.kernel.org/pub/software/scm/git/docs/git-rev-parse.html)中的“指定修订”一章

# sybase - 如何在sybase中将字符串转换为日期

> ID：56303
> 
> 赞同：17
> 
> 时间：2008-09-11T11:27:45.200
> 
> 标签：sybase, type-conversion

我需要在 sybase where 子句中指定日期值。例如：

```
select * 
from data
where dateVal < [THE DATE] 
```

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-11T11:29:40.123

使用转换函数，例如：

```
select * from data 
where dateVal < convert(datetime, '01/01/2008', 103) 
```

转换样式 (103) 确定要使用的日期格式。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-05T19:28:33.310

以下是关于日期可以使用的不同格式的一个很好的参考：

[http://infocenter.sybase.com/help/index.jsp?topic=/com.sybase.infocenter.dc38151.1510/html/iqrefbb/Convert.htm](http://infocenter.sybase.com/help/index.jsp?topic=/com.sybase.infocenter.dc38151.1510/html/iqrefbb/Convert.htm)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-16T16:57:51.557

有几种方法可以做到这一点，但请注意您的 DB **date_format 选项**和**date_order 选项**设置可能会影响传入格式：

```
Select 
   cast('2008-09-16' as date)
   convert(date,'16/09/2008',103)
   date('2008-09-16')
from dummy; 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2012-02-09T03:04:34.073

102 是经验法则，转换 (varchar, creat_tms, 102) > '2011'

# c# - ReSharper 代码清理/重新格式化代码功能与版本控制系统

> ID：56313
> 
> 赞同：8
> 
> 时间：2008-09-11T11:32:16.513
> 
> 标签：c#, version-control, resharper

ReSharper 代码清理功能（启用“[重新排序成员](http://www.jetbrains.com/resharper/features/code_formatting.html#Reordering_Type_Members_C#_only)”和“[重新格式化代码](http://www.jetbrains.com/resharper/features/code_formatting.html#Code_Style_Configuration_and_Sharing)”）真的很棒。您使用 XML 定义布局模板，然后一个简单的组合键根据您在模板中设置的规则重新组织整个源文件（或文件夹/项目/解决方案）。

无论如何，您认为这可能是关于 VCS（如 subversion、cvs、git 等）的问题吗？是否有可能导致许多不希望的冲突？

谢谢你。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-11T11:44:21.603

是的，它肯定会引起问题。除了创建必须手动解决的冲突之外，当您签入已重新格式化的文件时，VCS 会注意到几乎每一行都已更改。这会让你或队友很难回顾历史，看看什么时候发生了变化。

也就是说，如果每个人都以相同的方式自动格式化他们的代码（即，您将该 XML 模板分发给团队），那么它可能会运行良好。只有当不是每个人都在做同样的事情时，问题才会真正出现。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-11T12:12:18.540

我正在等待一个 IDE 或一个编辑器，它总是使用一些基线格式规则保存源代码，但允许每个开发人员以他们自己喜欢的格式显示和编辑代码。这样我就可以把我的大括号放在下一行的开头，而不是放在所有异教徒似乎都认为的当前行的末尾。

我的猜测是我会等很长时间。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-09T12:49:27.973

*   只需重新格式化整个解决方案一次
*   并确保每个开发人员都在使用 Resharper
*   并确保格式选项是共享和版本化的（代码样式共享选项）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-11T11:33:38.913

它肯定会导致冲突，所以如果有人并行处理它们，我会确保你不会重新格式化整个文件。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-11T22:56:10.240

您可以使用[StyleCop](http://code.msdn.microsoft.com/sourceanalysis)强制执行一套全面的标准，这几乎迫使每个人都使用相同的布局样式。然后，您需要做的就是开发与此匹配的 ReSharper 代码样式规范，并将其分发给团队。

我仍在等待[其他人执行此操作](https://stackoverflow.com/questions/57859/is-there-a-standard-resharper-code-style-definition-that-matches-all-the-stylec)，并等待 JetBrains 清除所有不完全支持的琐碎细节，以便让 ReSharper 基本上保证完全符合 StyleCop。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-11T11:45:12.597

它肯定会引起冲突。

如果您想在多用户环境中使用它，那么 Resharper 的配置需要将您的代码格式化为一组在您的组织中强制执行的标准，无论用户是否使用 Resharper。

这样您就可以使用该工具来确保您自己的代码符合标准，而不是将您的偏好应用于整个代码库。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-11T11:59:36.900

我同意之前的答案，即冲突是可能的，甚至是可能的。

如果您打算重新格式化代码，那么至少要确保不要将重新格式化签入与更改实际代码功能的签入混为一谈。通过这种方式，人们可以跳过过去的简单重新格式化的签到。确保每个人都知道即将进行重新格式化也是一个好主意，这样如果他们在该领域有正在进行的工作，他们就可以反对。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-02T14:18:54.147

我们正在努力在源代码级别使用重构。我们称之为 Xmerge，它现在是[Plastic](http://www.plasticscm.com)的一部分。这只是第一种方法，因为我们正在研究更高级的解决方案。[在这里](http://codicesoftware.blogspot.com/2008/08/xmerge-tool-to-handle-refactors.html)检查。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-03-23T13:51:06.897

编写一个脚本来检查源代码控制历史中的每个版本，应用代码清理，然后将其签入新存储库可能是一个好主意。然后将该存储库用于您将来的所有工作。

# d - 现实世界中的 D 编程语言？

> ID：56315
> 
> 赞同：139
> 
> 时间：2008-09-11T11:33:05.887
> 
> 标签：d

有没有人将 D 用于现实世界的应用程序？如果是这样，你用它做什么？我似乎在网上找不到任何用 D 写的大的东西。

尽管缺乏知名的大用户，但 D 对我来说似乎是一种很有前途的语言，而且根据[TIOBE](http://www.tiobe.com/index.php/content/paperinfo/tpci/index.html)的说法，它相当流行。

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2008-09-16T16:05:24.757

我在 D 从事生物信息学工作。对我而言，D 的关键在于它采用非常冷静的方法进行权衡，并承认收益递减原则。

与严格遵守零开销原则的 C++ 不同，D 允许使用可能具有较小性能/空间成本的特性，如果它们使语言更可用的话。这些包括垃圾收集、每个类的监视器对象、运行时类型信息等。

与 Ruby、Python、PHP 等不同，D 试图几乎与 C 一样快，即使它比脚本语言更不动态且编程难度稍大一些。
结果是当开发时间和执行时间同等重要时，这是一种最佳语言，在我的领域中大部分时间都是如此。

同样，D 对安全性与灵活性采取了非常冷静的方法。它假定程序员基本上知道他们在做什么，但确实会犯错误。

与 C 和 C++ 不同，它假定您不想在代码中的任何地方使用指针、不安全强制转换、手动内存管理等，因为它们容易出错，并且假定您不想筛选 multi -page 模板错误消息，当您只是为了使用可调整大小的数组而搞砸时。

与 Java 和其他束缚​​和纪律语言不同，D 假设有时指针、不安全强制转换、手动内存管理等是必要的邪恶，并假设您足够聪明，无需编写即可处理真正的模板、运算符重载等混淆代码。它还假设您可能会搞砸并越界访问数组，但程序员最清楚在任何给定情况下应该在安全性和速度之间做出什么权衡。因此，数组是否进行边界检查只是由编译器开关确定。

* * *

## 回答 #2

> 赞同：78
> 
> 时间：2008-09-16T14:46:45.333

我正在使用 D 进行计算机图形学领域的研究工作。我和其他人已经根据使用 D 完成的工作在我们的领域发表了论文。我认为它绝对可以用于性能很重要的中小型研究项目。它非常适合研究工作，因为无论如何您通常都是从头开始，因此您无需担心与太多遗留代码集成。

另一个流行的使用领域似乎是 Web 服务。希望其他人可以评论谁在这个领域，但我也认为这个想法是性能通常真的很重要，所以你想要一种编译到金属的语言。服务通常是相当小的、独立的进程，因此与大量遗留 C++ 代码的互操作并不是真正必要或有用的。这样D就可以进门了。

我认为 D 将继续以这种方式获得草根追随者——在较小的项目上，无论出于何种原因，这些项目都可以放弃 C++ 的传统，以获得一种使用起来更愉快、或许也更有生产力的编程语言。

但是，除非有大量的草根用户，否则我怀疑大企业用户不会有太多的障碍。

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2008-09-16T22:03:37.017

我知道一家小型公司已将邮件服务器产品推向市场。他们至少有 2 个人在该项目上全职工作。

此外，IT 业务的主要参与者有几名员工在较大的内部项目中使用 D。

此外，据我所知，有一家公司正在寻求风险投资，有几名（至少 4 名）小公司的员工部分或全职使用 D，并且至少有一对（包括我）积极寻求咨询市场的机会。

我可能遗漏了一些我应该知道的，可能还有一些我没有听说过的，但这仍然存在，因为以上或多或少是我通过社区认识的。

我目前收入的一小部分来自 D.

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2008-09-16T15:03:49.880

我使用 D 进行 Web 开发，与 C/C++ 相比，它的效率要高得多。当然，有很多基于 ruby​​/php/python 的框架。但是，如果您想开发一些独特的东西，而且必须与 C 一样快，并且几乎像使用许多脚本语言一样易于编程，那么 D 是一个不错的选择。

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2008-09-16T14:56:57.727

我将 D 用于循环中的硬件 (HIL) 测试环境。这适用于汽车领域的软件测试。这里可以使用 D，因为作为一种系统编程语言，它可以用于实时程序（Linux 实时扩展 RTAI-LXRT 中的 IRQ 处理程序）。

随着 SWT/JFace 的持续移植，我计划在 D 中做更多的工作，而我以前会在 Java 中完成。

* * *

## 回答 #6

> 赞同：22
> 
> 时间：2013-10-11T23:48:52.520

[Facebook](http://forum.dlang.org/thread/l37h5s%242gd8%241@digitalmars.com)宣布他们从今天开始在生产中使用它。

* * *

## 回答 #7

> 赞同：20
> 
> 时间：2008-09-16T15:48:25.500

我在关于编译时代码翻译的研究中使用 D。高级模板与元组和 mixins 相结合使代码翻译更加容易，并且允许在编译期间完成代码翻译，而无需单独的工具。

有一些物理学家使用 D 来通过 D 中的元编程来增强他们的程序的例子。

[视频](http://video.google.com/videoplay?docid=1440222849043528221&hl=en)- 会议谈话，找不到物理学家使用的源站点。

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2011-04-06T13:42:28.030

我们的整个（高流量）网络基础设施仅基于 D1 和 tango。我们是柏林一家年轻的创业公司：[sociomantic.com](https://www.sociomantic.com/)

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2008-09-16T18:50:15.047

我目前的工作任务是将 C# 翻译成 D 的系统。这是开发软件系统的营利项目的一部分。

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2008-09-16T14:53:18.453

好吧，我和其他人一样用 D 写了几篇研究论文。

[http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D.announce&artnum=13337](http://www.digitalmars.com/pnews/read.php?server=news.digitalmars.com&group=digitalmars.D.announce&artnum=13337)

[http://www.digitalmars.com/webnews/newsgroups.php?art_group=digitalmars.D.announce&article_id=9466](http://www.digitalmars.com/webnews/newsgroups.php?art_group=digitalmars.D.announce&article_id=9466)。

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2008-09-16T17:10:28.453

[ABA Games](http://www.asahi-net.or.jp/~cs8k-cyu/index_e.html "ABA游戏")发布的许多游戏都是用 D 1.x 编写的，尽管我认为控制台端口必须用 C++ 重写。

我已经用 D 编写了很多游戏原型，但我不确定这是否符合“真实世界”的条件，因为我是为了自己的利益而编写它们并且从未发布过任何一个。

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2012-01-19T16:46:52.470

我编写了（我仍在维护和开发）一个软件，用于将测试仪协议从各种硬件测试站转换为标准化的输出格式，以实现可追溯性和类似的东西。

总共超过 5k 行代码，使用 D 1.x 和 Phobos 库编写。

D 非常容易学习，并且忽略一些陷阱（在 Phobos 库中）是编程的真正乐趣。

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2012-12-10T14:38:23.953

我使用的是版本的第二个标准 D2。我编写了实时应用程序（例如 3D 引擎）。

这种语言每天都变得越来越强大。在我看来，D 非常实用，所有的嵌入式特性，尤其是元编程范式，使它远远超过 C++。语法更清晰，您可以通过*filter*或*reduce*等函数使用*函数式编程*的优势，并且最重要的功能之一：您可以使用所有 C 库。

 **绝对是我最喜欢的语言，而且我很确定它会成为一种广泛使用的语言。

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2013-02-14T17:24:59.013

似乎[Remedy Games](http://remedygames.com/)有一个庞大的 D2 代码库用于他们的游戏（参见Manu Evans[与游戏引擎一起使用 D](http://dconf.org/talks/evans_1.html) - DConf 2013）。

他们是一家大公司，知道一家大公司在使用 D 是非常好的。

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2008-09-17T09:50:11.717

我在开发全局优化算法的研究项目中使用了 D。我将其应用于训练神经网络的问题。是否要将此称为“现实世界”取决于您。

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2008-09-19T06:04:42.663

我写了一个在 OS X 上构建 DGCC 的包装脚本

[http://github.com/davecheney/make-gdc-apple/tree/master](http://github.com/davecheney/make-gdc-apple/tree/master)

我很想听听其他 DMD 程序员的意见

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2008-09-11T12:48:58.263

我想我们可以读到这个问题缺乏直接答案的情况，那就是没有多少/任何活跃的 stackoverflow 响应者正在使用 D。我也对它在 TIOBE 列表中的排名水平感到有点惊讶，你链接到。

话虽如此，Walter Bright 已经在这门语言上工作了很多年，我认为他有很多“追随者”，他们记得他在 90 年代使用 Zortech C++ 编译器做得多么出色。我还注意到，该语言现在似乎倾向于功能方向。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2014-05-31T18:30:41.553

D的官网列举了目前正在使用D的组织。

> [http://dlang.org/orgs-using-d.html](http://dlang.org/orgs-using-d.html)

[D wiki](http://wiki.dlang.org/Current_D_Use)还提供了组织列表，但它已经过时了。

请仔细观看**[DConf 的](http://www.dconf.org)**演讲。

*   [DConf 2013](http://dconf.org/2013)
*   [DConf 2014](http://dconf.org/2014)

几乎所有的人都为某家公司工作，他们在工作中使用 D。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2014-05-30T15:36:08.053

我正在启动一个项目，将我们的一些内部工具从 Perl 重写为 D。我选择了 D，因为我对该语言的设计理念感到非常兴奋。我已经编程很长时间了，使用过很多语言，从汇编程序到高级（主要是 C）再到脚本语言（主要是 Perl），而 D 是我多年来一直热衷于学习的第一门语言.

我决定转向编译语言有一个主要原因——安全性。在功能上，Perl 非常适合我使用的工具集，但它不安全——任何可以运行脚本的人也可以读取、复制和创建他们自己的工具修改版本。（他们确实这样做了。）我知道有一些迂回的方法可以解决这个问题（有点），但老实说，我一天中没有足够的时间来管理所有这些并且仍然完成我的主要工作。

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2014-03-03T12:37:50.487

我用 ldmd2 在 D 中启动了一个光线追踪渲染器。

[http://palaes.rudanium.org/SubSpace/render.php](http://palaes.rudanium.org/SubSpace/render.php)

# c - 在 Windows 和 Linux 控制台中将屏幕点重置为屏幕顶部

> ID：56324
> 
> 赞同：2
> 
> 时间：2008-09-11T11:39:15.030
> 
> 标签：c, console

我有一个用 C 语言编写的在 Linux 和 Windows 下运行并在控制台上显示输出的小例程。我没有以任何形式的诅咒或类似的方式进行链接。

目前我使用清除屏幕

```
#ifdef __WIN32
  system( "cls" );
#else
  system( "clear" );
#endif 
```

然后我有一堆 printf 语句来更新状态。我想要的只是将屏幕指针重置为 0,0，这样我就可以覆盖我的 printfs。我宁愿避免编译更多的扩展，特别是因为我正在为 2 个不同的操作系统编写代码。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-11T11:50:31.417

对于类 Unix 平台，通常的方法是使用[curses](http://en.wikipedia.org/wiki/Curses_(programming_library))库。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T11:43:21.650

看起来我可能已经找到了一种特定于 Windows 的方法[SetConsoleCursorPosition](http://msdn.microsoft.com/en-us/library/ms686025(VS.85).aspx)

Ansi 转义序列 \033[0;0H for Linux - 只需将其打印到控制台即可。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-19T01:12:13.753

是的，对于 unix 平台，curses（或 ncurses，这些天）是要走的路。并且有些版本可以在 Windows 下运行，因此您可以在两个系统上以相同的方式进行操作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-08T17:45:54.797

对于 Windows - 您可以使用 ANSI 转义字符。

[http://www.lexipixel.com/news/star_dot_star/using_ansi_escape_sequences.htm](http://www.lexipixel.com/news/star_dot_star/using_ansi_escape_sequences.htm)

[http://www.robvanderwoude.com/ansi.html](http://www.robvanderwoude.com/ansi.html)

```
printf "\x[0;0H" 
```

以前需要先加载 Ansi.sys，然后才能执行此操作，但值得一试。

添加 ANSI 支持的说明 [http://www.windowsnetworking.com/kbase/WindowsTips/WindowsXP/UserTips/CommandPrompt/CommandInterpreterAnsiSupport.html](http://www.windowsnetworking.com/kbase/WindowsTips/WindowsXP/UserTips/CommandPrompt/CommandInterpreterAnsiSupport.html) 注意：Ansi.sys 仅适用于 command.com。您不能将其与 cmd.exe 一起使用

# tfs - Team System 在结帐时获取最新版本

> ID：56325
> 
> 赞同：4
> 
> 时间：2008-09-11T11:39:15.780
> 
> 标签：tfs

我们曾经使用 SourceSafe，我喜欢它的一件事是，当您签出文件时，它会自动为您提供最新版本。

现在我们使用 Team System 2005，但它不能以这种方式工作 - 在开始处理已签出的文件之前，您必须“获取最新版本”。

有没有办法将 Team System (2005) 配置为在签出文件时自动获取最新版本？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-11T11:42:08.457

有人为此编写了一个 Visual Studio 插件：

[http://blogs.microsoft.co.il/blogs/srlteam/archive/2007/03/24/TFS-GetLatest-version-on-check_2D00_out-Add_2D00_In.aspx](http://blogs.microsoft.co.il/blogs/srlteam/archive/2007/03/24/TFS-GetLatest-version-on-check_2D00_out-Add_2D00_In.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T12:51:22.253

你确定你想要那个吗？

这意味着当您签出一个文件时，它将与您的其余文件不同步。在您更新所有文件之前，您的项目可能无法正常构建或运行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T18:26:19.467

@Vaibhav：非常感谢！

@Jay Bazuzi：我明白你在说什么，但对我来说，如果开发人员正在处理一个文件，那么它是该文件的最新版本非常重要。否则签入会带来很多问题。如果由于某种原因，由于获取了最新版本，项目无法编译，那么一定要获取整个项目的最新版本。对于我们团队的工作方式——经常签到——这很好。如果您做出了想要保留的更改 - 搁置它们。

# sql - 如何跨表执行简单的单语句 SQL 搜索？

> ID：56334
> 
> 赞同：2
> 
> 时间：2008-09-11T11:43:11.853
> 
> 标签：sql, search

假设存在两个表：`users`和`groups`。

**如何提供“简单搜索”，其中用户输入文本并且结果包含名称中包含文本的用户和组？**

搜索结果必须区分这两种类型。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-11T11:43:24.227

诀窍是将 a`UNION`与文字字符串组合以确定返回的“对象”的类型。在大多数 (?) 情况下，UNION ALL 会更有效，除非子查询中需要重复，否则应该使用 UNION ALL。以下模式应该足够了：

```
 SELECT "group" type, name
   FROM groups
  WHERE name LIKE "%$text%"
UNION ALL
 SELECT "user" type, name
   FROM users
  WHERE name LIKE "%$text%" 
```

**注意**：我自己添加了答案，因为我昨天遇到了这个问题，找不到好的解决方案，并使用了这种方法。如果有人有更好的方法，请随时添加。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T11:49:39.453

如果您使用“UNION ALL”，则数据库不会尝试删除重复项 - 无论如何，两个查询之间不会有重复项（因为第一列不同），因此 UNION ALL 会更快。
（我假设您在要删除的每个查询中没有重复项）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T12:14:52.340

使用 LIKE 会导致许多问题，因为当 LIKE 比较器以 % 开头时，每次都需要进行一次表扫描。这迫使 SQL 检查每一行，并通过您用于比较的字符串逐字节地工作。虽然这在您开始时可能很好，但它很快就会导致扩展问题。

处理此问题的更好方法是使用全文搜索。虽然这将是一个更复杂的选项，但它会为非常大的数据库提供更好的结果。然后，您可以使用 Bobby Jack 为您提供的示例的功能版本，将`UNION ALL`两个结果集放在一起并显示结果。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T12:31:02.207

我会建议另一个补充

```
 SELECT "group" type, name
   FROM groups
  WHERE UPPER(name) LIKE UPPER("%$text%")
UNION ALL
 SELECT "user" type, name
   FROM users
  WHERE UPPER(name) LIKE UPPER("%$text%") 
```

您可以先将 $text 转换为大写，或者只在查询中执行此操作。这样您就可以进行不区分大小写的搜索。

# c++ - 我可以在 System C（或 Plain Vanilla C++）的运行时设置数据断点吗？

> ID：56340
> 
> 赞同：0
> 
> 时间：2008-09-11T11:45:27.230
> 
> 标签：c++, linux, debugging

我在 system-C 中有一个类，其中包含一些数据成员：

```
long double x[8]; 
```

我在这样的构造中初始化它：

```
for (i = 0; i < 8; ++i) {
    x[i] = 0;
} 
```

但是我第一次在我的代码中使用它时，那里有垃圾。

由于系统的构建方式，我无法轻松连接调试器。是否有任何方法可以在代码中设置数据断点，以便它告诉我变量在代码中实际更改的位置，但无需连接调试器？

编辑：@Prakash：实际上，这是*问题*中的错字，但在我的代码中没有……谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-11T11:49:09.873

当然，这将是垃圾！

代码应该是

```
for (i = 0; i < 8; ++i) {
    x[i] = 0;
} 
```

编辑：哎呀，对不起低估了;）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T11:52:34.343

只需使用[printk/syslog](http://linux.die.net/man/2/syslog)。

这是老式的，但超级简单。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T12:47:14.103

@坦率

实际上，这让我可以将调试打印记录到文件中。我正在寻找的东西可以让我在变量发生变化时打印一些东西，而无需我明确地寻找变量。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-11T12:58:32.267

[条件断点](http://blogs.msdn.com/saraford/archive/2008/06/17/did-you-know-you-can-set-conditional-breakpoints-239.aspx)怎么样？您可以尝试各种条件，例如第一个元素值为零或非零等？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-11T13:07:58.797

这是假设我可以轻松连接调试器。重点是我只有一个库，但链接它的可执行文件并不容易获得。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T18:27:21.453

您可以尝试启动第二个旋转的线程，寻找变量的变化：

```
 #include <pthread.h>

void *ThreadProc(void *arg)
{
  volatile long double *x = (volatile long double *)arg;
  while(1)
  {
    for(int i = 0; i < 8; i++)
    {
      if(x[i] != 0)
      {
        __asm__ __volatile__ ("int 3");  // breakpoint (x86)
      }
  }

  return 0;  // Never reached, but placate the compiler
}
...
pthread_t threadID;
pthread_create(&threadID, NULL, ThreadProc, &x[0]); 
```

只要任何 x 值不为零，这都会向您的应用程序发出 SIGTRAP 信号。

# c# - 解析字符串的最佳方法是什么？

> ID：56342
> 
> 赞同：6
> 
> 时间：2008-09-11T11:47:03.903
> 
> 标签：c#, email, parsing, projects-and-solutions

我们有一个场景需要我们解析大量电子邮件（纯文本），每个电子邮件“类型”都是针对不同平台运行的脚本的结果。有些是制表符分隔的，有些是空格分隔的，有些是我们还不知道的。

我们将来也需要支持更多的“格式”。

我们是否使用以下方法寻求解决方案：

*   正则表达式
*   简单的字符串搜索（使用 string.IndexOf 等）
*   莱克斯/雅克
*   其他

整体解决方案将在 C# 2.0（希望是 3.5）中开发

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-11T11:52:07.807

正则表达式。

正则表达式几乎可以解决世界和平以外的所有问题。好吧，也许世界和平也是如此。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-11T12:14:38.970

您所说的三个解决方案都涵盖了非常不同的需求。

**手动解析**（简单的文本搜索）是最灵活和适应性最强的，但是，由于所需的解析更加复杂，它很快就变成了真正的麻烦。

**正则表达式**是一个中间地带，可能是你最好的选择。它们功能强大且灵活，因为您可以自己从调用不同正则表达式的代码中添加更多逻辑。这里的主要缺点是速度。

**Lex/Yacc**实际上只适用于非常复杂、可预测的语法，并且缺乏很多编译后的灵活性。您不能在中间解析中轻松更改解析器，实际上您可以，但它太重了，您最好使用正则表达式。

我知道这是一个陈词滥调的**答案**，这一切都归结为您的确切需求，但根据您所说的，我个人可能会选择一袋正则表达式。

作为**替代方案**，正如 Vaibhav 指出的那样，如果您可能会出现几种不同的情况，并且您可以轻松检测到哪种情况即将到来，您可以制作一个插件系统来选择正确的算法，而这些算法都可能非常不同，一种在尖锐的情况下使用 Lex/Yacc，另一种在更简单的情况下使用 IndexOf 和正则表达式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T11:53:22.733

无论您使用哪种类型的字符串解析，您都可能应该拥有一个可插拔系统。因此，该系统根据电子邮件的类型调用正确的“插件”来解析它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T12:28:49.203

您必须将解决方案设计为可更新的，以便在出现未知情况时处理它们。为解析器创建一个接口，其中不仅包含用于解析电子邮件并以标准格式返回结果的方法，还包含用于检查电子邮件以确定解析器是否会执行的方法。

在您的配置中，确定您希望使用的解析器类型，设置其配置选项，以及确定解析器是否起作用的标识符的配置。通过程序集限定名称命名解析器，以便即使没有指向它们的程序集的静态链接，也可以在运行时实例化类型。

标识符也可以实现一个接口，因此您可以创建不同的类型来检查不同的事物。例如，您可以创建一个正则表达式标识符，用于解析电子邮件以查找特定模式。确保为标识符提供尽可能多的信息，以便它可以根据地址和电子邮件内容等做出决定。

当您已知的解析器无法处理作业时，请创建一个新的 DLL，该 DLL 具有实现解析器和标识符接口的类型，这些接口可以处理该作业并将它们放在您的 bin 目录中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-11T12:36:41.617

这取决于你在解析什么。对于 Regex 无法处理的任何内容，我一直在使用[ANTLR](http://antlr.org)。在你第一次进入递归下降解析之前，我会研究它们是如何工作的，然后再尝试使用这样的框架。如果您订阅了 MSDN 杂志，请查看 2008 年 2 月的问题，那里有一篇关于从头开始编写的文章。

一旦你理解了，学习 ANTLR 就会容易很多。还有其他框架，但 ANTLR 似乎拥有最多的社区支持和公共文档。作者还发表了[The Definitive ANTLR Reference: Building Domain-Specific Languages](https://rads.stackoverflow.com/amzn/click/com/0978739256)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-11T11:52:25.903

正则表达式可能是你最好的选择、尝试和证明。另外可以编译正则表达式。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-11T12:21:19.173

最好的选择是 RegEx，因为它提供了比任何其他选项更大程度的灵活性。

虽然您可以`IndexOf`用来处理某些事情，但您可能很快就会发现自己编写的代码如下所示：

> `if(s.IndexOf("search1")>-1 || s.IndexOf("search2")>-1 ||...`

这可以在一个 RegEx 语句中处理。此外，还有很多地方，例如[RegExLib.com](http://regexlib.com)，您可以在其中找到共享正则表达式来解决问题的人。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-11T12:48:29.233

@Coincoin 已经覆盖了基础；我只想补充一点，使用正则表达式特别容易得到难以阅读、难以维护的代码。正则表达式是一种功能强大且非常紧凑的语言，所以它经常这样。

在正则表达式中使用空格和注释可以大大简化正则表达式的维护。Eric Gunnerson 让我想到了这个想法。这是[一个例子](http://blogs.msdn.com/ericgu/archive/2006/01/27/518554.aspx)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-06T06:22:49.447

使用 PCRE。所有其他答案都只是第二好。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-09-11T11:55:12.857

您提供的信息很少，我会选择正则表达式。

但是你想要解析什么样的信息以及你想要做什么可能会改变对 Lex/Yacc 的决定。

但看起来您已经下定决心使用字符串搜索 :)

# java - C ++（stl）与Java中的迭代器，有概念上的区别吗？

> ID：56347
> 
> 赞同：32
> 
> 时间：2008-09-11T11:50:24.490
> 
> 标签：java, c++, iterator, iteration

在离开一段时间并试图清除旧瓜后，我将返回 C++。

在 Java 中，Iterator 是具有以下方法的容器的接口`hasNext()`：`next()`和`remove()`. 存在`hasNext()`意味着它具有被遍历的容器**的限制的概念。**

```
//with an Iterator
Iterator<String> iter = trees.iterator();
while (iter.hasNext()) 
{
    System.out.println(iter.next());
} 
```

在 C++ 标准模板库中，迭代器似乎表示支持的数据类型或类`operator++`，`operator==`但没有内置**限制的概念，因此在前进到下一项之前需要进行比较。**在正常情况下，用户必须通过比较两个迭代器来检查限制，第二个迭代器是容器端。

```
vector<int> vec;
vector<int>::iterator iter;

// Add some elements to vector
v.push_back(1);
v.push_back(4);
v.push_back(8);

for (iter= v.begin(); iter != v.end(); iter++)
{
    cout << *i << " "; //Should output 1 4 8
} 
```

这里有趣的部分是，在 C++ 中，指针是指向数组的迭代器。STL 采用现有的东西并围绕它建立约定。

我错过了任何进一步的微妙之处吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-11T12:29:48.810

也许更理论一点。在数学上，C++ 中的集合可以描述为迭代器的半开区间，即一个迭代器指向集合的开头，一个迭代器指向最后一个元素的*后面。*

这个约定开辟了许多可能性。算法在 C++ 中的工作方式，它们都可以应用于更大集合的子序列。要使这样的事情在 Java 中工作，您必须围绕返回不同迭代器的现有集合创建一个包装器。

Frank 已经提到了迭代器的另一个重要方面。迭代器有不同的概念。Java 迭代器对应于 C++ 的输入迭代器，即它们是只读的迭代器，一次只能递增一步，不能倒退。

在另一个极端，你有完全对​​应于 C++ 的随机访问迭代器概念的 C 指针。

总而言之，C++ 提供了比 C 指针或 Java 迭代器更丰富、更纯粹的概念，可以应用于更广泛的任务。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-09-11T12:05:12.083

是的，存在很大的概念差异。C++ 使用不同的迭代器“类”。有些用于随机访问（与 Java 不同），有些用于前向访问（如 java）。甚至其他人也用于写入数据（例如，与 一起使用`transform`）。

[请参阅C++ 文档](http://en.cppreference.com/w/cpp/iterator)中的迭代器概念：

*   输入迭代器
*   输出迭代器
*   前向迭代器
*   双向迭代器
*   随机访问迭代器

与 Java/C# 的微不足道的迭代器相比，这些迭代器更加有趣和强大。希望这些约定将使用 C++0x 的[概念](http://en.wikipedia.org/wiki/C%2B%2B0x#Concepts)进行编码。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-02T08:58:34.707

如前所述，Java 和 C# 迭代器描述了混合的位置（状态）和范围（值），而 C++ 迭代器将位置和范围的概念分开。C++ 迭代器分别代表“我现在在哪里”与“我可以去哪里？”。

**Java 和 C# 迭代器不能被复制。您无法恢复以前的位置。常见的 C++ 迭代器可以。**

考虑[这个例子](http://codepad.org/5D2xR6EV)：

```
// for each element in vec
for(iter a = vec.begin(); a != vec.end(); ++a){
  // critical step!  We will revisit 'a' later.
  iter cur = a; 
  unsigned i = 0;
  // print 3 elements
  for(; cur != vec.end() && i < 3; ++cur, ++i){
      cout << *cur << " ";
  }
  cout << "\n";
} 
```

单击上面的链接以查看程序输出。

这个相当愚蠢的循环遍历一个序列（仅使用前向迭代器语义），将 3 个元素的每个连续子序列恰好打印一次（最后还有几个较短的子序列）。但是假设有 N 个元素，并且每行有 M 个元素而不是 3 个，这个算法仍然是 O(N*M) 迭代器增量和 O(1) 空间。

Java 风格的迭代器缺乏独立存储位置的能力。你要么

*   失去 O(1) 空间，在迭代时使用（例如）大小为 M 的数组来存储历史记录
*   将需要遍历列表 N 次，使得 O(N^2+N*M) 时间
*   或者使用带有 GetAt 成员函数的具体 Array 类型，失去通用性和使用链表容器类型的能力。

由于在这个例子中只使用了前向迭代机制，我能够毫无问题地交换一个[列表](http://codepad.org/aRsFuoA4)。这对于创作通用算法至关重要，例如搜索、延迟初始化和评估、排序等。

无法保留状态最接近于 C++ STL 输入迭代器，在该迭代器上构建的算法很少。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-11T12:23:54.377

指向数组元素的指针确实是数组的迭代器。

正如您所说，在 Java 中，迭代器比 C++ 更了解底层容器。C++ 迭代器是通用的，一*对*迭代器可以表示任何范围：这可以是容器的子范围，也可以是多个容器的范围（参见[http://www.justsoftwaresolutions.co.uk/articles/pair_iterators.pdf](http://www.justsoftwaresolutions.co.uk/articles/pair_iterators.pdf)或[http://www.boost.org/doc/libs/1_36_0/libs/iterator/doc/zip_iterator.html](http://www.boost.org/doc/libs/1_36_0/libs/iterator/doc/zip_iterator.html)）甚至是一系列数字（参见[http://www.boost.org/doc/libs/1_36_0 /libs/iterator/doc/counting_iterator.html](http://www.boost.org/doc/libs/1_36_0/libs/iterator/doc/counting_iterator.html) )

迭代器类别标识了您可以使用给定的迭代器做什么和不能做什么。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-11T15:01:01.847

对我来说，根本区别在于 Java 迭代器指向项目之间，而 C++ STL 迭代器指向项目。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-12T10:48:59.277

C++ 迭代器是指针概念的概括；它们使其适用于更广泛的情况。这意味着它们可以用来做诸如定义任意范围之类的事情。

Java 迭代器是相对愚蠢的枚举器（虽然没有 C# 的那么糟糕；至少 Java 有 ListIterator 并且可以用来改变集合）。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-04-29T21:18:40.073

关于这些差异有很多很好的答案，但我觉得 Java 迭代器最让我烦恼的事情没有得到强调——你不能多次读取当前值。这在很多场景中都非常有用，尤其是在合并迭代器时。

在 c++ 中，您有一种方法可以推进迭代器并读取当前值。读取它的值不会推进迭代；所以你可以多次阅读。这对于 Java 迭代器是不可能的，我最终创建了执行此操作的包装器。

附注：创建包装器的一种简单方法是使用现有的包装器——来自 Guava的[PeekingIterator 。](http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/collect/PeekingIterator.html)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-11T12:20:26.337

迭代器仅等效于按顺序迭代数组内容的简单情况下的指针。迭代器可以从任意数量的其他来源提供对象：来自数据库、来自文件、来自网络、来自其他一些计算等。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-11T12:41:53.413

C++ 库（以前称为 STL 的部分）迭代器旨在与指针兼容。Java，没有指针算法，可以自由地对程序员更友好。

在 C++ 中，您最终不得不使用一对迭代器。在 Java 中，您可以使用迭代器或集合。迭代器应该是算法和数据结构之间的粘合剂。为 1.5+ 编写的代码很少需要提及迭代器，除非它正在实现特定的算法或数据结构（大多数程序员不需要这样做）。随着 Java 的动态多态性子集等更容易处理。

# c# - ASP.Net 上的预编译和启动时间

> ID：56357
> 
> 赞同：5
> 
> 时间：2008-09-11T11:53:53.233
> 
> 标签：c#, asp.net, compilation, startup, aspnet-compiler

我正在 ASP.Net 2.0 中开发一个（相对较小的）网站。在交付可执行文件之前，我还在使用 nAnt 对我的项目进行一些简单的调整。在当前状态下，该网站是使用“预编译”的

> `aspnet_compiler.exe -nologo -v ${Appname} -u ${target}`

我注意到，在重新启动 IIS 池后（在空闲关闭或回收之后），应用程序最多需要 20 秒才能重新联机（并且达到 Application_start）。

当我直接在 Visual Studio 中调试时（启动需要 2 秒），我没有遇到同样的问题，所以我想知道 aspnet_compiler 是否真的是个好主意。

我在 MSDN 上找不到太多。您如何编译您的网站以进行生产？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-11T11:56:57.767

确保：

1.  您正在使用 Web 应用程序项目而不是 Web 站点项目，这将导致您的代码的预编译二进制文件
2.  您已在 web.config 文件中关闭了调试代码生成 - 我猜如果这与您使用 aspnet_compiler 时不同，代码可能会被重新编译

如果您尝试过这些，您也许可以尝试在您的程序集上运行 ngen 从而节省 JIT 时间？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-11T12:38:21.237

为了最终的响应，不要让你的应用程序被关闭。

第一种方法是确保它非常受欢迎，以便始终有人使用它。

或者，可以使用从其他地方获取一个很小的保活页面作为计划活动来保持您的网站“热”。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-11T12:19:48.443

如果您的网站被编译为可更新，您将在虚拟目录中看到一堆 .ASPX 文件。这些必须在启动时编译。这样您就可以进入并更改 Web UI 本身。这是网站和 Web 应用程序的默认设置。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T12:00:11.657

确保这是在 web.config 中设置的`<compilation debug=false>`。就我而言，我还有一个批处理文件，它在提供给用户之前对所有主要页面发出获取请求（页面加载模拟）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-04-06T21:32:26.277

关键是确保 IIS 应用程序池永远不会关闭。这是实际托管代码的地方。将“空闲超时”（在高级设置下）设置为非常高的值，例如 1440 分钟（24 小时），以确保只要有人每天访问您的网站一次，它就不会关闭。

每当您部署新代码时，或者如果在没有任何流量的情况下超过了这个空闲超时时间，您仍然会有 JIT 时间。

[配置 IIS 7.x 空闲超时](http://technet.microsoft.com/en-us/library/cc771956%28v=ws.10%29.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-11T12:05:24.610

@西蒙：

*   该项目是一个 Web 应用程序。网站然后启动速度较慢（我不知道它有一个发病率，除了不同的代码组织）？
*   我检查了，当我在调用 aspnet_compiler 后编辑 web.config 时，我没有触摸调试值（但是，如果我不触摸 web.config，我会检查网站启动速度是否更快，只是为了当然）

（我肯定会看看 ngen，我不知道那个工具。）

# ruby - 纯 Ruby 项目的目录布局

> ID：56362
> 
> 赞同：22
> 
> 时间：2008-09-11T11:58:06.000
> 
> 标签：ruby, code-formatting

我开始学习红宝石。我也是一名日常的 C++ 开发人员。对于 C++ 项目，我通常使用以下目录结构

```
/
 -/bin <- built binaries
 -/build <- build time temporary object (eg. .obj, cmake intermediates)
 -/doc <- manuals and/or Doxygen docs
 -/src
 --/module-1
 --/module-2
 -- non module specific sources, like main.cpp
 - IDE project files (.sln), etc. 
```

你会建议 Ruby（非 Rails、非 Merb）的什么目录布局来保持它的干净、简单和可维护？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2011-08-15T02:00:43.053

截至 2011 年，使用[珠宝商](https://github.com/technicalpickles/jeweler)而不是 newgem 是很常见的，因为后者实际上已被废弃。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-15T13:41:54.313

Bundler 包含生成 gem 所需的基础设施：

```
$ bundle gem --coc --mit --test=minitest --exe spider
Creating gem 'spider'...
MIT License enabled in config
Code of conduct enabled in config
      create  spider/Gemfile
      create  spider/lib/spider.rb
      create  spider/lib/spider/version.rb
      create  spider/spider.gemspec
      create  spider/Rakefile
      create  spider/README.md
      create  spider/bin/console
      create  spider/bin/setup
      create  spider/.gitignore
      create  spider/.travis.yml
      create  spider/test/test_helper.rb
      create  spider/test/spider_test.rb
      create  spider/LICENSE.txt
      create  spider/CODE_OF_CONDUCT.md
      create  spider/exe/spider
Initializing git repo in /Users/francois/Projects/spider
Gem 'spider' was successfully created. For more information on making a RubyGem visit https://bundler.io/guides/creating_gem.html 
```

然后，在 lib/ 中，根据需要创建模块：

```
lib/
  spider/
    base.rb
  crawler/
    base.rb
  spider.rb
    require "spider/base"
    require "crawler/base" 
```

[阅读bundle gem](https://bundler.io/man/bundle-gem.1.html)的手册页以获取有关`--coc`,`--exe`和`--mit`选项的详细信息。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2012-12-24T09:23:29.497

一个标准的 Ruby 项目的核心结构基本上是：

```
 lib/
    foo.rb
    foo/
  share/
    foo/
  test/
    helper.rb
    test_foo.rb
  HISTORY.md (or CHANGELOG.md)
  LICENSE.txt
  README.md
  foo.gemspec 
```

很少见，`share/`有时被称为`data/`。它用于通用的非 ruby​​ 文件。大多数项目不需要它，但即使他们做了很多次，一切都只是保留在 中`lib/`，尽管这可能不是最佳实践。

如果使用 BDD 而不是 TDD，则`test/`可能会调用该目录，但您也可能会看到是否使用了 Cucumber，或者是否使用了 QED。`spec/``features/``demo/`

这些天`foo.gemspec`可能只是`.gemspec`——尤其是如果它不是手动维护的。

如果您的项目具有命令行可执行文件，则添加：

```
 bin/
    foo
  man/
    foo.1
    foo.1.md or foo.1.ronn 
```

此外，大多数 Ruby 项目都有：

```
 Gemfile
  Rakefile 
```

用于使用`Gemfile`Bundler，`Rakefile`用于 Rake 构建工具。但如果您想使用不同的工具，还有其他选择。

其他一些不常见的文件：

```
 VERSION
  MANIFEST 
```

该`VERSION`文件仅包含当前版本号。并且`MANIFEST`(or `Manifest.txt`) 包含要包含在项目包文件（例如 gem 包）中的文件列表。

您可能还会看到什么，但用法是零星的：

```
 config/
  doc/ (or docs/)
  script/
  log/
  pkg/
  task/ (or tasks/)
  vendor/
  web/ (or site/) 
```

其中`config/`包含各种配置文件；`doc/`包含生成的文档，例如 RDoc，或有时手动维护的文档；`script/`包含项目使用的 shell 脚本；`log/`包含生成的项目日志，例如测试覆盖率报告；`pkg/`保存生成的包文件，例如`foo-1.0.0.gem`；`task/`可以保存各种任务文件，例如`foo.rake`或`foo.watchr`; `vendor/`包含其他项目的副本，例如 git 子模块；最后`web/`包含项目的网站文件。

然后是一些也比较常见的工具专用文件：

```
 .document
  .gitignore
  .yardopts
  .travis.yml 
```

它们是不言自明的。

最后，我要补充一点，我个人添加了一个`.index`文件和一个`var/`目录来构建该文件（搜索“Rubyworks Indexer”以获得更多信息）并且通常有一个`work`目录，例如：

```
 work/
    NOTES.md
    consider/
    reference/
    sandbox/ 
```

只是用于开发目的的废料场。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-11T12:46:05.807

@Dentharg ：您[的](https://stackoverflow.com/users/5731/dentharg)“包含一个以包含所有子部分”是一种常见模式。像任何东西一样，它有它的优点（很容易得到你想要的东西）和它的缺点（许多包含会污染命名空间并且你无法控制它们）。您的模式如下所示：

```
- src/
    some_ruby_file.rb:
      require 'spider'
      Spider.do_something

+ doc/

- lib/
  - spider/
      spider.rb:
        $: << File.expand_path(File.dirname(__FILE__))
        module Spider
          # anything that needs to be done before including submodules
        end

        require 'spider/some_helper'
        require 'spider/some/other_helper'
        ... 
```

我可能会推荐这个来允许更多的控制：

```
- src/
    some_ruby_file.rb:
      require 'spider'
      Spider.include_all
      Spider.do_something

+ doc/

- lib
  - spider/
      spider.rb:
        $: << File.expand_path(File.dirname(__FILE__))
        module Spider
          def self.include_all
            require 'spider/some_helper'
            require 'spider/some/other_helper'
            ...
          end
        end 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-11T12:07:21.390

为什么不使用相同的布局？通常你不需要构建，因为没有编译步骤，但其余的对我来说似乎没问题。

我不确定你所说的模块是什么意思，但如果它只是一个类，则不需要单独的文件夹，如果有多个文件，你通常会编写一个 module-1.rb 文件（在名称级别作为module-1 文件夹），它只需要 module-1/ 中的所有内容。

哦，我建议将[Rake](http://rake.rubyforge.org/)用于管理任务（而不是 make）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T12:03:37.753

我会坚持类似于您熟悉的内容：在您自己的项目目录中成为陌生人是没有意义的。:-)

我一直拥有的典型东西是 lib|src、bin、test。

（我不喜欢这些怪物生成器：我想做一个新项目的第一件事就是写下一些代码，而不是编写自述文件、文档等！）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T12:44:59.113

所以我选择了newgem。我删除了所有不必要的 RubyForge/gem 东西（锄头、设置等），创建了 git 存储库，将项目导入 NetBeans。一切都花了 20 分钟，一切都是绿色的。这甚至给了我规范文件的基本 rake 任务。

谢谢你们。

# unit-testing - Why is a method call shown as not covered when the code within the method is covered with emma?

> ID：56373
> 
> 赞同：3
> 
> 时间：2008-09-11T12:05:25.123
> 
> 标签：unit-testing, junit, code-coverage, emma

I am writing a unit test to check that a private method will close a stream.

The unit test calls methodB and the variable something is null

The unit test doesn't mock the class on test

The private method is within a public method that I am calling.

Using emma in eclipse (via the eclemma plugin) the method call is displayed as not being covered even though the code within the method is

e.g

```
public methodA(){

    if (something==null) {
        methodB(); //Not displayed as covered
    }
}

private methodB(){
    lineCoveredByTest; //displayed as covered
} 
```

Why would the method call not be highlighted as being covered?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T14:01:51.010

我发现 EMMA 的 eclipse 插件有很多 bug，并且和你描述的有类似的经历。最好单独使用 EMMA（如果需要，通过 ANT）。确保始终重新生成 EMMA 生成的元数据文件，以避免合并混淆（我怀疑这是 eclipse 插件的问题）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T15:07:52.347

我假设当您说“单元测试调用`methodB()`”时，您的意思不是直接和通过`methodA()`。

那么，是否有可能`methodB()`在其他地方被调用，或者被另一个单元测试调用`methodC()`？

# .net - .NET 中的非泛型集合是否已过时？

> ID：56375
> 
> 赞同：26
> 
> 时间：2008-09-11T12:05:59.850
> 
> 标签：.net, generics, collections

换一种说法：

是否有充分的理由选择松散类型的集合而不是类型安全的集合（HashTable 与 Dictionary）？它们仍然只是为了兼容性吗？

据我了解，泛型集合不仅是类型安全的，而且它们的性能更好。

* * *

这是一篇关于该主题的综合文章：[使用 C# 2.0 对数据结构进行广泛检查](http://msdn.microsoft.com/en-us/library/ms364091%28VS.80%29.aspx)。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-11T12:09:30.513

非泛型集合非常过时，已从 Silverlight 和 Live Mesh 中使用的 CoreCLR 中删除。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-11T13:24:21.173

COM 可见性也存在问题 - COM 互操作不能与泛型一起使用

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-09-11T12:10:00.447

今后只应使用通用集合。避免对集合中的类型进行装箱/拆箱还有一个好处。这是低效的，特别是当您有一组值类型在存储在集合中时转换为 System.Object 时，因此将值存储在堆而不是调用堆栈上。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-11T12:19:07.727

关于使用非泛型集合来存储异构的东西集合，您总是可以使用 List<object> 来完成同样的事情。仅出于这个原因，我想说几乎没有理由再接触非通用集合。

例外情况是保持与用其他语言编写的系统的兼容性，或者与以前版本的 .NET 框架保持兼容性，但如果你问我，这是一个非常“前卫”的情况。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-11T12:30:49.540

我可以告诉你，集合的 XAML 序列化依赖于它们实现 IList 或 IDictionary，因此非泛型集合将在未来一段时间内与我们同在。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-11T12:09:50.340

在某些情况下，您可能需要存储未知类型的对象或多种不同类型的对象，但如果您确实知道要存储的对象的类型，那么我看不出不使用通用版本的理由。

编辑：正如评论的那样，您可以使用`List<Object>`- doh！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-11T12:21:07.130

我不会跳起来说它已经过时或将很快被删除。确实应该避免使用非泛型集合，除非你有理由**不**使用泛型版本。数以千计的遗留（不是那么遗留）代码仍然在（并且将持续数年）支持非泛型集合，如 ArrayLists。由于这些是 .NET 1.0 和 1.1 中*唯一*的集合，因此它全年都被广泛使用（和滥用）。

我仍然偶尔需要与用 .NET 1.1 编写的返回 IList 对象的旧 O/R 映射器进行交互。我有一个方法可以转换为泛型 List<>，虽然效率不高，但就是这样。

如果您需要将不同的对象存储在同一个数组中（奇怪但可能），您**将**需要一个非泛型集合。装箱和拆箱的罚款无论如何都是你必须支付的。

如果您觉得必须使用它们，请不要害怕使用它们。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-11T12:08:14.400

是的，据我了解，它们只是为了与现有产品兼容。您应该始终使用类型安全的版本（即使用 System.Collections.Generic 而不是 System.Collections）。

[http://msdn.microsoft.com/en-us/library/ms379564.aspx](http://msdn.microsoft.com/en-us/library/ms379564.aspx)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-12-31T12:33:54.053

快到 2022 年了，我不得不编写一个 COM Visible Non-Generic 集合类，供一个用 VB6 编写的大型前端商用程序使用——非泛型集合类的这种消费者的主要示例。所以我认为这些类型的类的需求不会很快消失，因为那里仍然有很多活动的 VB6 代码。

同时，使用 ArrayList 和 IList 来支持自定义集合类，并在处理它们之前检查各个项目是否属于您期望的类型，例如

[ComVisible(true)] 公共类 MyNonGenericCollection : ArrayList, IList { private ArrayList myList = new ArrayList();

...

```
public int Add(object myItem)
{
    if (!(myItem is MyItemClass))
        throw new ArgumentException(nameof(myItem));

    // code to add to the ArrayList 
```

}

# c++ - 自动检查我的应用程序的新版本

> ID：56391
> 
> 赞同：23
> 
> 时间：2008-09-11T12:17:50.820
> 
> 标签：c++, qt

为了满足客户的功能要求，我希望我的应用程序在 Internet 可用时检查我们的网站是否有新版本可用。

问题是我不知道在服务器端必须做什么。

我可以想象我的应用程序（使用 Qt 在 C++ 中开发）必须向服务器发送请求（HTTP ？），但是什么会响应这个请求呢？为了通过防火墙，我想我必须使用端口 80 ？它是否正确 ？

或者，对于这样的功能，我是否必须要求我们的网络管理员打开一个特定的端口号，我将通过该端口号进行通信？

* * *

@ [pilif](https://stackoverflow.com/questions/56391/automatically-checking-for-a-new-version-of-my-application/56418#56418)：感谢您的详细回答。对我来说还有一些不清楚的地方：

> 像
> 
> `http://www.example.com/update?version=1.2.4`
> 
> 然后你可以返回你想要的任何东西，也可能是新版本安装程序的下载 URL。

我该如何退货？它将是一个 php 或 asp 页面（我对 PHP 或 ASP 一无所知，我不得不承认）？我怎样才能解码`?version=1.2.4`零件以便相应地返回一些东西？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-09-11T12:29:19.823

我绝对建议您对您的网站进行简单的 HTTP 请求。其他一切都注定要失败。

我会向您网站上包含本地应用程序版本的特定页面发出 HTTP GET 请求。

像

```
http://www.example.com/update?version=1.2.4 
```

然后你可以返回你想要的任何东西，也可能是新版本安装程序的下载 URL。

为什么不把最新版本的静态文件放到服务器上，让客户端决定呢？因为您可能希望（或需要）控制该过程。也许 1.2 将来不会与服务器兼容，因此您希望服务器强制更新到 1.3，但是从 1.2.4 更新到 1.2.6 可能并不重要，因此您可能希望向客户端显示可选更新。

或者您想对已安装的基础进行细分。

管他呢。通常，我了解到最好在服务器上保留尽可能多的智能，因为服务器是您最终控制的对象。

这里有一些该领域的经验，这里有一个小的预览，可以（并且将 - 相信我）出错：

*   您的应用程序将被各种个人防火墙应用程序阻止发出 HTTP 请求。
*   相当大比例的用户没有实际进行更新过程所需的权限。
*   即使您的用户允许旧版本通过他们的个人防火墙，该工具也会抱怨，因为 .EXE 已更改，并会建议用户不要允许新的 exe 连接（用户通常在此处遵守其安全工具的意愿） .
*   在托管环境中，您将因从 Web 加载可执行内容然后实际执行它而被枪杀（不一定按此顺序）。

所以为了尽量降低伤害，

*   无法连接到更新服务器时静默失败
*   在更新之前，请确保您对安装目录具有写入权限，如果您没有，或者根本不更新，则警告用户。
*   为管理员提供关闭自动更新的方法。

做你将要做的事情并不有趣——尤其是当你与我不得不多次处理的非技术倾向的用户打交道时。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-09-11T12:40:23.980

Pilif 的回答很好，我对此也有很多经验，但我想补充一点：

请记住，如果您启动 yourapp.exe，那么“更新程序”将尝试用最新版本覆盖 yourapp.exe。根据您的操作系统和编程环境（您提到过 C++/QT，我没有这方面的经验），您将**无法**覆盖*yourapp.exe*，因为它将被使用。

我所做的是创建一个启动器。我有一个 MyAppLauncher.exe，它使用配置文件（xml，非常简单）来启动“真正的 exe”。如果存在新版本，Launcher 可以更新“真正的 exe”，因为它没有被使用，然后重新启动新版本。

只要记住这一点，你就会很安全。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-11T12:48:11.387

马丁，

你当然是完全正确的。但我会随安装程序一起提供启动器。或者只是下载安装程序，启动它并尽快退出。原因是启动器中的错误。您永远都不会希望依赖于无法更新（或忘记包含在初始 drop 中）的组件。

因此，我在应用程序更新过程中分发的有效负载只是标准安装程序，但没有任何重要的 UI。一旦客户端检查了安装程序是否有机会成功运行，并且一旦下载了更新程序，它就会运行它并自行退出。

然后更新程序运行，将其有效负载安装到原始安装目录中并重新启动（希望已更新）应用程序。

仍然：这个过程很麻烦，当您的应用程序具有广泛的使用重点时，您最好在 Windows 平台上实现自动更新功能之前三思而后行。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-11T16:06:49.880

在 php 中，事情很简单：

```
<?php
    if (version_compare($_GET['version'], "1.4.0") < 0){
        echo "http://www.example.com/update.exe";
    }else{
        echo "no update";
    }
?> 
```

当然，如果您可以扩展它，那么当前可用的版本不会在脚本中硬编码，但这只是为了说明这一点。

在您的应用程序中，您将拥有以下伪代码：

```
result = makeHTTPRequest("http://www.example.com/update?version=" + getExeVersion());
if result != "no update" then
    updater = downloadUpdater(result);
    ShellExecute(updater);
    ExitApplication;
end; 
```

随意扩展“协议”，通过指定 PHP 脚本可以返回的内容来告诉客户端它是否是重要的、强制性的更新。

或者您可以添加一些文本以显示给用户 - 可能包含一些有关更改内容的信息。

你的可能性是无限的。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-13T14:37:34.133

我的 Qt 应用程序只是使用 QHttp 从我的网站上读取包含最新版本号的微小 XML 文件。如果这大于当前版本号，则可以选择转到下载页面。非常简单。工作正常。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-11T13:32:50.593

我同意@Martin 和@Pilif 的回答，但补充一下；

考虑让您的最终用户决定他们是否要在此处实际安装更新，或者延迟安装更新，直到他们完成使用该程序。

我不知道您的应用程序的用途/功能，但是当用户需要在那里执行特定的操作时会启动许多应用程序 - 没有什么比启动应用程序然后被告知它找到了一个新版本更烦人了，而您必须等待它下载，关闭应用程序并重新启动。如果您的程序有其他可能更新的资源（参考文件、数据库等），问题会变得更糟。

我们有一个在大约 400 家商店运行的 EPOS 系统，最初我们认为让程序发现更新并下载它们会很棒（使用包含与您上面的建议非常相似的版本号的文件）......好主意. 直到所有商店在大约同一时间（上午 8 点 45 分到 8 点 50 分）启动他们的系统，并且我们的服务器被击中，为 400 台远程服务器提供 20+Mb 的下载，然后更新本地软件并导致重新开始。混乱 - 没有人能够交易大约 10 分钟。

不用说，这导致我们随后关闭了“检查更新”功能并重新设计它以允许商店将更新“延迟”到当天晚些时候。:-)

编辑：如果 ADOBE 中的任何人正在阅读 - 看在上帝的份上，为什么当我只想启动阅读文档时，该死的杂技阅读器会坚持尝试下载更新和废话？是不是开始时不够慢，而且不够臃肿，因为每次我想阅读 PDF 时都不会浪费我生命中的 20-30 秒来寻找更新？
**他们不使用自己的软件吗？？！！！** :-)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-11T12:26:45.277

在服务器上，您可能只有一个简单的文件“latestversion.txt”，其中包含最新版本的版本号（可能还有下载 URL）。然后，客户端只需使用简单的 HTTP 请求（是的，到端口 80）读取此文件以检索[http://your.web.site/latestversion.txt](http://your.web.site/latestversion.txt)，然后您可以对其进行解析以获取版本号。这样您就不需要任何花哨的服务器代码 --- 您只需将一个简单的文件添加到您现有的网站。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-11T13:54:27.483

如果您将文件保存在 example.com 上的更新目录中，则此 PHP 脚本应根据前面提到的请求为您下载它们。（您的更新将是 yourprogram.1.2.4.exe

```
$version = $_GET['version'];    
$filename = "yourprogram" . $version . ".exe";
$filesize = filesize($filename);
header("Pragma: public");
header("Expires: 0");
header("Cache-Control: post-check=0, pre-check=0");
header("Content-type: application-download");
header('Content-Length: ' . $filesize);
header('Content-Disposition: attachment; filename="' . basename($filename).'"');
header("Content-Transfer-Encoding: binary"); 
```

这会使您的网络浏览器认为它正在下载应用程序。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-11T12:24:53.470

[实现这一点的最简单方法是使用libcurl](http://curl.haxx.se/libcurl/)之类的库触发 HTTP 请求，并使其下载包含在线版本以及新版本在线可用的 ini 或 xml 文件。

解析 xml 文件后，您可以确定是否需要新版本，并使用 libcurl 下载新版本并安装它。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-11T12:25:02.410

只需在您的服务器上放置一个 (XML) 文件，其中包含最新版本的版本号，以及下载新版本的 URL。然后，您的应用程序可以请求 XML 文件，查看版本是否与自己的版本不同，并采取相应的措施。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-11T12:26:08.477

我认为服务器上的简单 XML 文件仅用于版本检查就足够了。

然后，您只需要服务器上的 ftp 帐户和构建系统，该系统能够在构建新版本后通过 ftp 发送文件。该构建系统甚至可以将安装文件/压缩文件直接放在您的网站上！

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-11T12:27:37.737

如果你想保持它非常基本，只需将 version.txt 上传到网络服务器，其中包含一个整数版本号。根据您下载的最新 version.txt 下载检查，然后只需下载 msi 或安装包并运行它。

更高级的版本是使用 rss、xml 或类似的。最好使用第三方库来解析 rss，如果您愿意，您可以包含向用户显示的有关更改的信息。

基本上你只需要简单的下载功能。

这两种解决方案都只需要您访问从客户端传出的端口 80。这通常不需要对防火墙或网络（在客户端）进行任何更改，您只需要拥有一个面向 Internet 的 Web 服务器（Web 托管、托管或您自己的服务器——所有这些都可以在这里工作）。

有几个可用的商业自动更新解决方案。我会将这些建议留给其他回答者，因为我只有在 .net 方面使用 Click-Once 和 Updater Application Block 的经验（后者不再继续）。

# xml - 对齐 SVG 中的文本

> ID：56402
> 
> 赞同：70
> 
> 时间：2008-09-11T12:24:24.157
> 
> 标签：xml, svg

我正在尝试使用混合行和简短的文本片段（通常是两个或三个单词）来制作 SVG XML 文档。我遇到的主要问题是让文本与线段对齐。

对于水平对齐，我可以`text-anchor`使用`left`,`middle`或`right`。我找不到垂直对齐的等价物；`alignment-baseline`似乎没有这样做，所以目前我正在`dy="0.5ex"`用作中心对齐的工具。

是否有适当的方式与文本的垂直中心或顶部对齐？

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2008-09-16T14:57:13.937

事实证明，您不需要明确的文本路径。Firefox 3 仅部分支持垂直对齐标签（[请参阅此线程](http://groups.google.com/group/mozilla.dev.tech.svg/browse_thread/thread/1be0c56cfbfb3053?fwc=1)）。似乎主导基线仅在作为样式应用时才有效，而 text-anchor 可以是样式或标签属性的一部分。

```
<path d="M10, 20 L17, 20"
      style="fill:none; color:black; stroke:black; stroke-width:1.00"/>
<text fill="black" font-family="sans-serif" font-size="16"
      x="27" y="20" style="dominant-baseline: central;">
  Vertical
</text>

<path d="M60, 40 L60, 47"
      style="fill:none; color:red; stroke:red; stroke-width:1.00"/>
<text fill="red" font-family="sans-serif" font-size="16"
      x="60" y="70" style="text-anchor: middle;">
  Horizontal
</text>

<path d="M60, 90 L60, 97"
      style="fill:none; color:blue; stroke:blue; stroke-width:1.00"/>
<text fill="blue" font-family="sans-serif" font-size="16"
      x="60" y="97" style="text-anchor: middle; dominant-baseline: hanging;">
  Bit of Both
</text> 
```

这适用于 Firefox。不幸的是，Inkscape 似乎没有处理主导基线（或者至少不是以相同的方式）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-05-15T14:25:49.127

这种效果确实可以通过设置`alignment-baseline`为`central`或来实现`middle`。

# math - 如何测试随机性（例如 - 洗牌）

> ID：56411
> 
> 赞同：44
> 
> 时间：2008-09-11T12:27:22.293
> 
> 标签：math, theory, random, puzzle

首先，这个问题是从[这个](https://stackoverflow.com/questions/56215/interesting-interview-questions#56291)问题中删除的。我这样做是因为我认为这部分比一个较长问题的子部分更大。如有冒犯，请见谅。

假设您有一个生成随机性的算法。现在你如何测试它？或者更直接地说——假设你有一个洗牌的算法，你如何测试它是一个完全随机的算法？

为这个问题添加一些理论 - 一副纸牌可以在 52 中洗牌！（52阶乘）不同的方式。拿一副牌，用手洗牌，写下所有牌的顺序。你得到那个洗牌的概率是多少？答案：1 / 52！。

洗牌后，你依次得到每种花色的 A、K、Q、J ……的机会是多少？回答 1 / 52！

因此，只需洗牌一次并查看结果，您绝对不会获得任何关于洗牌算法随机性的信息。两次，你有更多的信息，三个甚至更多......

您将如何黑盒测试洗牌算法的随机性？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-09-11T12:45:04.717

统计数据。测试 RNG 的事实标准是[Diehard 套件](https://web.archive.org/web/20150103230339/http://stat.fsu.edu/pub/diehard/)（最初可在[http://stat.fsu.edu/pub/diehard](http://stat.fsu.edu/pub/diehard)获得）。或者，[Ent 程序](ftp://ftp.fourmilab.ch/web/random/index.html)提供更易于解释但不太全面的测试。

至于改组算法，请使用众所周知的算法，例如[Fisher-Yates](http://en.wikipedia.org/wiki/Knuth_shuffle)（又名“Knuth Shuffle”）。只要底层 RNG 是一致随机的，洗牌将是一致随机的。如果您使用的是 Java，则此算法在标准库中可用（请参阅[Collections.shuffle](http://java.sun.com/javase/6/docs/api/java/util/Collections.html#shuffle(java.util.List))）。

对于大多数应用程序来说这可能无关紧要，但请注意，大多数 RNG 没有提供足够的自由度来生成 52 张牌的所有可能排列（[在此处](http://blog.uncommons.org/2008/04/10/a-java-programmers-guide-to-random-numbers-part-3-seeding/)解释）。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-11T13:50:23.937

这是您可以执行的一项简单检查。它使用生成的随机数来估计 Pi。这不是随机性的证明，但糟糕的 RNG 通常在这方面表现不佳（它们会返回 2.5 或 3.8 而不是 ~3.14）。

理想情况下，这只是您将运行以检查随机性的众多测试之一。

您可以检查的其他内容是输出的[标准偏差](http://en.wikipedia.org/wiki/Standard_deviation)。在 0..n 范围内均匀分布的一组值的预期标准偏差接近 n/sqrt(12)。

```
/**
 * This is a rudimentary check to ensure that the output of a given RNG
 * is approximately uniformly distributed.  If the RNG output is not
 * uniformly distributed, this method will return a poor estimate for the
 * value of pi.
 * @param rng The RNG to test.
 * @param iterations The number of random points to generate for use in the
 * calculation.  This value needs to be sufficiently large in order to
 * produce a reasonably accurate result (assuming the RNG is uniform).
 * Less than 10,000 is not particularly useful.  100,000 should be sufficient.
 * @return An approximation of pi generated using the provided RNG.
 */
public static double calculateMonteCarloValueForPi(Random rng,
                                                   int iterations)
{
    // Assumes a quadrant of a circle of radius 1, bounded by a box with
    // sides of length 1\.  The area of the square is therefore 1 square unit
    // and the area of the quadrant is (pi * r^2) / 4.
    int totalInsideQuadrant = 0;
    // Generate the specified number of random points and count how many fall
    // within the quadrant and how many do not.  We expect the number of points
    // in the quadrant (expressed as a fraction of the total number of points)
    // to be pi/4\.  Therefore pi = 4 * ratio.
    for (int i = 0; i < iterations; i++)
    {
        double x = rng.nextDouble();
        double y = rng.nextDouble();
        if (isInQuadrant(x, y))
        {
            ++totalInsideQuadrant;
        }
    }
    // From these figures we can deduce an approximate value for Pi.
    return 4 * ((double) totalInsideQuadrant / iterations);
}

/**
 * Uses Pythagoras' theorem to determine whether the specified coordinates
 * fall within the area of the quadrant of a circle of radius 1 that is
 * centered on the origin.
 * @param x The x-coordinate of the point (must be between 0 and 1).
 * @param y The y-coordinate of the point (must be between 0 and 1).
 * @return True if the point is within the quadrant, false otherwise.
 */
private static boolean isInQuadrant(double x, double y)
{
    double distance = Math.sqrt((x * x) + (y * y));
    return distance <= 1;
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-11T12:49:16.313

首先，不可能确定某个有限输出是否“真正随机”，因为正如您所指出的，[任何输出都是可能的](http://www.virtualp.us/Dilbert-Oct_25_001.jpg)。

可以做的是获取一系列输出，并根据更可能的情况检查该序列的各种测量值。您可以得出一种生成算法做得很好的置信度分数。

例如，您可以检查 10 种不同 shuffle 的输出。为每张牌分配一个 0-51 的数字，并在洗牌过程中取第 6 位牌的平均值。收敛平均值为 25.5，因此您会惊讶地看到这里的值为 1。您可以使用中心极限定理来估计给定位置的每个平均值的可能性。

但我们不应该止步于此！因为这个算法可能会被一个只在两个随机播放之间交替的系统所愚弄，这两个随机播放被设计为在每个位置给出 25.5 的精确平均值。我们怎样才能做得更好？

我们期望在每个位置，在不同的洗牌中都有一个均匀的分布（任何给定卡片的可能性相等）。因此，在 10 次洗牌中，我们可以尝试验证选择“看起来一致”。这基本上只是原始问题的简化版本。您可以检查标准偏差是否合理、最小值是否合理以及最大值是否合理。您还可以检查其他值，例如最接近的两张卡片（通过我们分配的数字）是否也有意义。

但是我们也不能像这样无限地添加各种测量值，因为如果有足够的统计数据，任何特定的洗牌都将由于某种原因显得极不可能（例如，这是极少数出现 X、Y、Z 牌的洗牌之一命令）。所以最大的问题是：哪一组测量是正确的？在这里我不得不承认我不知道最好的答案。但是，如果您考虑到某个应用程序，您可以选择一组好的属性/测量值来测试，并使用它们——这似乎是密码学家处理事情的方式。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-11T12:51:45.217

有很多关于测试随机性的理论。对于洗牌算法的一个非常简单的测试，你可以做很多洗牌，然后运行卡方检验，每张牌出现在任何位置的概率是一致的。但这并不能测试连续卡不相关，因此您还需要对此进行测试。

Knuth 的计算机编程艺术第 2 卷提供了许多测试，您可以在第 3.3.2 节（经验测试）和 3.3.4（频谱测试）及其背后的理论中使用这些测试。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-11T12:32:52.827

测试随机性的唯一方法是编写一个程序，尝试为正在测试的数据建立一个预测模型，然后使用该模型尝试预测未来的数据，然后显示其预测的不确定性或熵随着时间的推移趋于最大值（即均匀分布）。当然，您总是不确定您的模型是否已捕获所有必要的上下文；给定一个模型，总是有可能构建第二个模型，该模型生成的非随机数据在第一个模型看来是随机的。但是只要你接受冥王星的轨道对洗牌算法的结果影响不大，那么你应该能够满足自己，它的结果是可以接受的随机性。

当然，如果你这样做，你也可以使用你的模型来*生成*你想要的数据。如果你这样做，那么你又回到了第一方。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-11T12:29:58.717

洗牌很多，然后记录结果（如果我没看错的话）。我记得看到过“随机数生成器”的比较。他们只是一遍又一遍地测试它，然后绘制结果。

如果它真的是随机的，那么图形将大部分是均匀的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-11T12:47:01.450

我没有完全关注你的问题。你说

> 假设您有一个生成随机性的算法。现在你如何测试它？

你什么意思？如果您假设可以生成随机性，则无需对其进行测试。

一旦你有一个好的随机数生成器，创建一个随机排列就很容易（例如，调用你的卡片 1-52。生成 52 个随机数，将每个随机数按顺序分配给一张卡片，然后根据你的 52 个随机数进行排序）。您不会通过生成排列来破坏好 RNG 的随机性。

困难的问题是您是否可以信任您的RNG。 [这是](http://csrc.nist.gov/groups/ST/toolkit/rng/index.html)一个示例链接，供人们在特定上下文中讨论该问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-11T12:57:31.160

测试52！可能性当然是不可能的。相反，尝试在较小数量的牌上洗牌，比如 3、5 和 10。然后你可以测试数十亿次洗牌，并使用直方图和卡方统计检验来证明每个排列都是一个“偶数”数次。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-11T13:18:55.900

到目前为止还没有代码，因此我从[我](https://stackoverflow.com/questions/56215#56379)对原始问题的回答中复制粘贴了一个测试部分。

```
 // ...
  int main() {
    typedef std::map<std::pair<size_t, Deck::value_type>, size_t> Map;
    Map freqs;    
    Deck d;
    const size_t ntests = 100000;

    // compute frequencies of events: card at position
    for (size_t i = 0; i < ntests; ++i) {
      d.shuffle();
      size_t pos = 0;
      for(Deck::const_iterator j = d.begin(); j != d.end(); ++j, ++pos) 
        ++freqs[std::make_pair(pos, *j)]; 
    }

    // if Deck.shuffle() is correct then all frequencies must be similar
    for (Map::const_iterator j = freqs.begin(); j != freqs.end(); ++j)
      std::cout << "pos=" << j->first.first << " card=" << j->first.second 
                << " freq=" << j->second << std::endl;    
  } 
```

此代码不测试底层伪随机数生成器的随机性。测试 PRNG 随机性是一个完整的科学分支。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-10-05T20:10:03.817

为了快速测试，您可以随时尝试压缩它。一旦它不压缩，您就可以进行其他测试。

我已经更努力地尝试了，但它拒绝为洗牌工作。所有的测试都失败了。它也很乏味，它不会让你指定你想要的值的范围或类似的东西。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-09-11T14:43:50.733

自己考虑一下，我会做的是：

设置（伪代码）

```
// A card has a Number 0-51 and a position 0-51
int[][] StatMatrix = new int[52][52]; // Assume all are set to 0 as starting values
ShuffleCards();
ForEach (card in Cards) {
   StatMatrix[Card.Position][Card.Number]++;
} 
```

这给了我们一个 52x52 的矩阵，表示一张牌在某个位置结束的次数。重复多次（我会从 1000 开始，但比我更擅长统计的人可能会给出更好的数字）。

分析矩阵

如果我们有完美的随机性并且无限次地进行洗牌，那么对于每张牌和每个位置，牌在该位置结束的次数与任何其他牌相同。用不同的方式说同样的话：

```
statMatrix[position][card] / numberOfShuffle = 1/52. 
```

所以我会计算我们离这个数字有多远。

# python - 有人用大博做大中型项目吗？

> ID：56417
> 
> 赞同：21
> 
> 时间：2008-09-11T12:29:09.013
> 
> 标签：python, erp, dabo

我们正处于一个新的 ERP-ish 客户端-服务器应用程序的开始，该应用程序是作为 Python 富客户端开发的。我们目前正在评估 Dabo 作为我们的主要框架，它看起来非常漂亮且易于使用，但我想知道，有没有人将它用于大中型项目？
谢谢你的时间！

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-19T23:55:08.023

我是 Dabo 框架的作者之一。我们的一个用户向我指出了您收到的极其否定的答案，所以我认为我最好插话并在第一个回复中澄清一些不正确的假设。

Dabo 在 Python 社区中确实很有名气。我在最近 4 个美国 PyCons 中的 3 个上展示了它，我们有数百名用户订阅了我们的电子邮件列表。我们的网站（[http://dabodev.com](http://dabodev.com)）没有出现任何服务中断；我不知道为什么第一响应者声称有麻烦。通过我们的电子邮件列表提供支持，我们以快速有效地帮助人们而自豪。许多新手问题帮助我们找出我们的文档缺乏的地方，所以我们强烈鼓励新手提问！

Dabo 已经存在 4 年了。距离 0.9 版本还有几天的时间这一事实更多地反映了我的合作伙伴 Paul McNett 相当保守的版本编号，而不是框架中的任何不稳定性。我知道自 2006 年以来一直在生产的 Dabo 应用程序；自 2004 年以来，我一直将它用于我自己的项目。无论您对发布编号重视什么，我们都处于修订版 4522 中，不断地在为框架添加越来越多的东西；重构和简化一些旧代码，是的，清理一些错误。

请注册我们的免费电子邮件支持列表：

[http://leafe.com/mailman/listinfo/dabo-users](http://leafe.com/mailman/listinfo/dabo-users)

...并在那里提出您对 Dabo 的任何问题。还没有多少人发现 Stack Overflow，所以我不希望在这里得到非常明智的答案。那里有几个经常使用 Dabo 的贡献者，他们通常非常乐意提供他们的意见和帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-19T15:56:41.187

我根本没有 Dabo 经验，但是这个问题在很长一段时间内都排在首位，所以我决定试一试：

## 框架选择

## 假设：

1.  大中型项目：我们说的是一个由 20 多人组成的团队，在第一阶段工作了大约一年。对于客户来说，这通常是一项昂贵且非常重要的工作。
2.  该项目将拥有大量用户（大约一百个），因此性能至关重要
3.  这是一个 ERP 项目，因此该应用程序将处理大量信息
4.  你在你的团队中没有之前的大博经验

## 注意事项：

1.  我现在无法打开 Dabo 项目站点。似乎有一些服务器问题。仅此一项就让我在将其用于大型项目时三思而后行。
2.  它不是一个众所周知的框架。在 Google 中输入 Dabo 几乎不会返回任何有用的结果，它没有维基百科页面，总而言之，它非常晦涩难懂。这意味着当您遇到问题（并且您将遇到问题）时，您将几乎无处可去。您的问题在 SO 上 8 天没有得到解答，仅此一项就让我重新考虑。如果您的项目基于您以前没有经验的晦涩技术 - 这是一个巨大的风险。
3.  您的团队中没有人知道该框架。这意味着您必须学习它才能获得任何结果，并且掌握它需要相当多的时间。您必须将这段时间考虑到您的项目计划中。你真的需要吗？
4.  这个框架给了你什么你自己做不到的？很多时候，我的团队尝试使用一些第三方组件或工具，却发现构建自定义组件或工具比处理第三方问题和限制要快。现在有很多很棒的工具可供人们使用，没有它们我们会迷失方向——但你必须仔细考虑这个工具是否是其中之一
5.  大博项目版本为0.84。你知道他们是否在这个阶段花时间优化他们的代码以提高性能？您是否进行了任何测试以查看它是否能够维持您在 NFR 中的负载。

希望有帮助:)祝你的项目好运

# c++ - 升级显卡时会导致帧速率降低的原因是什么？

> ID：56424
> 
> 赞同：3
> 
> 时间：2008-09-11T12:31:09.790
> 
> 标签：c++, hardware, directx

我们有一个两屏 DirectX 应用程序，之前使用 NVIDIA 8400GS (256MB) 以一致的 60 FPS（显示器同步速率）运行。但是，当我们将显卡换成 512 MB RAM 时，帧速率很难达到 40 FPS 以上。（它之所以这么高，是因为我们使用了三重缓冲。）这两张卡来自同一制造商 (PNY)。所有其他条件都相同，这是一个 Windows XP Embedded 应用程序，我们从每张卡的新图像开始。驱动程序版本号为 169.21。

应用程序都是 2D 的。IE 只是一堆纹理四边形和一大堆预渲染图形（因此需要升级卡的内存）。我们还拥有 CPU 动态解码的压缩动画 - 这涉及纹理锁定。锁定需要永远，但我也尝试使用单独的系统内存纹理供 CPU 更新，然后使用设备的 UpdateTexture 方法更新渲染的纹理。性能上没有总体差异。

尽管我已经阅读了我在 Internet 上可以找到的有关 DirectX 性能的所有常见问题解答，但这仍然是我第一次从事 DirectX 项目，因此您所拥有的任何神秘知识都会很有用。:)

当我谈到这个主题时，还有一件事；在交换链上调用 Present 时，无论我在当前参数 (PresentationInterval) 和调用本身的标志中都使用 D3DPRESENT_DONOTWAIT 的事实，DirectX 似乎都在等待当前完成。因为这是一个双屏应用程序，所以这是一个问题，因为两个监视器似乎没有同步锁定，我正在通过线程池运行 Present 调用来解决它。造成这种情况的根本原因是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T07:10:25.970

这些卡是否完全相同（都是 GeForce 8400GS），只是内存大小不同？不同的内存大小经常会出现略微不同的时钟频率（即您的卡有更多内存可能会使用更慢的内存！）。

所以首先要检查的是 GPU 核心和内存时钟频率，使用类似[GPU-Z 的](http://www.techpowerup.com/gpuz/)东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T13:06:04.307

看看是不是表面锁定问题很简单，只要注释掉贴图更新，看看帧率是否恢复到60hz。不幸的是，写入锁定的表面并更新资源会杀死性能，总是如此。你在使用纹理贴图吗？我知道 DX9 添加了 mipmap 的自动生成，可能会占用大量时间来生成这些。如果您每帧不断锁定相同的资源，您还可以尝试创建一个纹理池，有点像三重缓冲，除了纹理。您将让渲染器使用一个纹理，并在下一次更新时选择池中未用于渲染的下一个可用纹理。当然，除非您的内存受限或您仅对动画纹理进行了区分。

# windows - 是否有任何资源可以成为 Cygwin “超级用户”？

> ID：56427
> 
> 赞同：11
> 
> 时间：2008-09-11T12:32:47.197
> 
> 标签：windows, unix, cygwin

我已经对其进行了配置，但我想从中获得更多...也许 Cygwin 不是正确的工具，但我喜欢它如何在 Windows 中提供类似 *nix 的环境。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-11T12:50:41.007

如果您已经阅读了[Cygwin 用户指南](http://cygwin.com/cygwin-ug-net/)，请查看提高[Cygwin 生产力的十个步骤](http://www.weiqigao.com/blog/2006/08/14/ten_steps_to_higher_cygwin_productivity.html)。

此外，如果您在 Cygwin 中使用诸如 bash 之类的 shell，并且您熟悉 Emacs，请考虑改用[Eshell](http://www.gnu.org/software/emacs/manual/html_mono/eshell.html)（Emacs shell）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-11T12:46:57.317

我发现 Cygwin 过去非常有用。FWIW，但最近我回避了它，转而支持以下内容：

1.  [XAMPP](http://www.apachefriends.org/en/xampp-windows.html)
2.  [Unixutils](http://unxutils.sourceforge.net/)

我更喜欢这些工具。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-11T12:40:00.250

我自己对这个问题很感兴趣。我已经使用[Cygwin 设置指南](https://code.google.com/archive/p/jessies/wikis/CygwinSetup.wiki)进行设置，但它并没有让你一路走好。不过，我从中学到的一件事是，它建议将 setup.exe 保留在 Cygwin 的目录中，以便您可以快速添加软件包，因为 apt-get 在 Cygwin 中显然不能很好地工作。这篇文章还谈到了 cyg-get 作为替代方案。

# foxpro - Foxpro App and removable drives problem

> ID：56430
> 
> 赞同：0
> 
> 时间：2008-09-11T12:36:25.610
> 
> 标签：foxpro, visual-foxpro, removable-storage

I have a foxpro app, that contains hard coded path for icons and bitmaps. That's how foxpro does it and there is no way around it. And this works fine, except that when a removable drive has been used but is not connected, and when is connected windows assigns the same letter as hard coded path, when opening any form that contains such path, the following error message apears (**FROM WINDOWS**, not fox):

Windows-No disk Exception Processing Message c0000012 Parameters .....

Any help please Nelson Marmol

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-11T13:06:46.460

Nelson:

"That's how foxpro does it and there is no way around it"?

I'm using FOX since FoxPro 2.5 to Visual FoxPro 9, and you are NEVER forced in any way to hard-code a path, you can use SET PATH TO (sYourPath), you can embed the icons and bitmaps in your EXE / APP file and therefore there's no need of including this resources externally.

You say that you have a "Foxpro App": which version? Old MS-DOS FoxPro o Visual FoxPro? If you're using VFP 8+, you can use SYS(2450, 1):

```
Specifies how an application searches for data and resources such as functions, procedures, executable files, and so on. 

You can use SYS(2450) to specify that Visual FoxPro searches within an application for a specific procedure or user-defined function (UDF) before it searches along the SET DEFAULT and SET PATH locations. Setting SYS(2450) can help improve performance for applications that run on a local or wide area network.

SYS(2450 [, 0 | 1 ])

Parameters
0 
Search along path and default locations before searching in the application. (Default)

1 
Search within the application for the specified procedure or UDF before searching the path and default locations. 
```

One quick workaround could be assign another letter to your USB via the Disk Manager.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-06T03:20:41.513

如果其他人遇到此问题，您通常可以在“属性”窗口中为 Icon 属性键入类似的内容以强制对其进行评估，这可能会阻止路径自动填充：

**="图标.ico"**

而不仅仅是**icon.ico**。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-25T13:16:53.623

不，我们没有分发表格或应用程序的任何内容......它是一个 exe。我忘了提到 EXE 是用**KONXIZE 1.0 压缩和混淆的。**

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-11T13:23:02.317

I agree with @PabloG - it's been over a decade since I worked with FoxPro (Dos & Windows) but even back in FPW2.6 you could determine where your app was running 'from', set absolute or relative search paths and even bundle your resources straight into the "compiled" (heh) exe. All of our resources lived in a specific subfolder within the app folder, the database files in another subfolder also below the app folder. We used relative paths for everything as I recall.

Can you give us a bit more information about the problem?

If you think it would be helpful I could try and dig out some of our FPW2.6 code where we're doing this kind of thing. :-)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T14:15:52.080

在我看来，您正在向客户分发表格/报告/标签等。如果您构建一个 EXE，那么您不应该遇到“路径”问题，因为 VFP 会将资源（在本例中为图标）嵌入到 exe 中，并且知道如何在运行时提取它。

彼得森

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-11T14:42:37.930

这是 VFP8，如果我没有正确地解释自己，我很抱歉。另外我认为“没有办法解决它”可能听起来很糟糕。我的意思是表格中的属性“ **ICON** ”。由于我们将每个组件类型分隔在文件夹中（表单、报告、菜单、图标等），如果您尝试使路径相对，下次编辑文件时，foxpro 将包含完整路径。这个问题最近开始出现，我们发现我们的客户开始使用外部 USB 驱动器作为备份手段。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-19T19:54:28.453

假设您的应用程序可以在运行时确定图标文件的路径，那么在表单的加载事件中，您可以使用以下方式设置图标：

```
THIS.Icon=<path to file> 
```

# c# - 从 DataGridView 中的枚举创建下拉列表选项

> ID：56443
> 
> 赞同：18
> 
> 时间：2008-09-11T12:42:55.767
> 
> 标签：c#, .net, winforms, user-interface, .net-2.0

我目前有一个类，我正在尝试创建一个简单的 GUI 来创建此类的集合。这个类的大部分属性都是字符串。但是，我希望用户能够设置的属性之一是枚举。因此，我希望用户界面有一个此枚举的下拉列表，以限制用户输入无效的值。目前，我正在获取对象的初始列表，将它们添加到 DataTable 并将我的 DataGridView 的 DataSource 设置到表中。效果很好，甚至为一个布尔属性创建了一个复选框列。但是，我不知道如何将枚举列变成下拉列表。我正在使用 C# 和 .NET 2.0。

另外，我尝试将 DataGridView 的 DataSource 分配给我的对象列表，但是当我这样做时，它对枚举没有帮助，我无法在 DataGridView 中创建新行，但我绝对不是绑定使用 DataTable 作为我的数据源，这只是我半工作的选项。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-09-11T13:04:26.260

我不知道这是否适用于 DataGridView 列，但它适用于 ComboBoxes：

```
comboBox1.DataSource = Enum.GetValues(typeof(MyEnum)); 
```

和：

```
MyEnum value = (MyEnum)comboBox1.SelectedValue; 
```

更新：它也适用于 DataGridView 列，只需记住设置值类型。

```
DataGridViewComboBoxColumn col = new DataGridViewComboBoxColumn();
col.Name = "My Enum Column";
col.DataSource = Enum.GetValues(typeof(MyEnum));
col.ValueType = typeof(MyEnum);
dataGridView1.Columns.Add(col); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-11T14:01:09.497

或者，如果您需要对枚举器值进行一些过滤，您可以循环`Enum.GetValues(typeof(EnumeratorName))`并添加您想要使用的值：

```
dataGridViewComboBoxColumn.Items.Add(EnumeratorValue) 
```

顺便说一句，您可以将 DataGridView 的 DataSource 设置为 BindingSource 对象，而不是使用 DataTable，而将 BindingSource 对象的 DataSource 设置为 a `BindingList<Your Class>`，您可以通过将 an 传递`IList`给构造函数来填充该对象。

实际上，我很想从任何人那里知道这是否比在您还没有 DataTable 的情况下使用 DataTable 更可取（即它是从数据库调用返回的）。

# jquery - ASP.Net MVC, AJAX, and progressive enhancement

> ID：56445
> 
> 赞同：6
> 
> 时间：2008-09-11T12:43:54.453
> 
> 标签：jquery, asp.net-mvc, ajax

I am looking for a reliable technique for adding Ajax to a working ASP.NET MVC application. I want to use jQuery, and understand how to use the AJAX functionality from jQuery.

What I need to know is how I should write my controller so that I can run the site without JavaScript, but at the same time make AJAX calls possible without the need for a separate view, separate controller, or any kind of route hack. My goal is to have a working application enhanced when JavaScript is enabled without the need to duplicate or recreate elements of the app.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-11T12:51:03.377

Typically you would create your site so that it works without JavaScript being enabled. Then you would add the [unobtrusive JavaScript](http://en.wikipedia.org/wiki/Unobtrusive_JavaScript) needed to enhance your site with Ajax e.g. adding event handlers for links, form submits, etc. to make GET / POST requests and update your UI accordingly.

The only changes you would need in your MVC app would be to handle the Ajax requests and return the data as JSON, XML, etc.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-11T04:53:01.710

在您的控制器（从 Controller 派生）中，您可以调用 Request.IsMvcAjaxRequest() 来检查请求是普通 POST 还是 AJAX 请求。如果请求是从 AjaxForm 提交或 AsyncHyperlink 创建的，则情况会如此。javascript 可以使 Ajax 表单可见，同时隐藏标准表单。

# .net - .Net arrays with lower bound > 0

> ID：56446
> 
> 赞同：13
> 
> 时间：2008-09-11T12:44:49.303
> 
> 标签：.net, arrays

Although perhaps a bizare thing to want to do, I need to create an Array in .Net with a lower bound > 0\. This at first seems to be possible, using:

```
Array.CreateInstance(typeof(Object), new int[] {2}, new int[] {9}); 
```

Produces the desired results (an array of objects with a lower bound set to 9). However the created array instance can no longer be passed to other methods expecting `Object[]` giving me an error saying that:

`System.Object[*]` can not be cast into a `System.Object[]`. What is this difference in array types and how can I overcome this?

Edit: test code =

```
Object x = Array.CreateInstance(typeof(Object), new int[] {2}, new int[] {9});
Object[] y = (Object[])x; 
```

Which fails with: "Unable to cast object of type 'System.Object[*]' to type 'System.Object[]'."

I would also like to note that this approach **DOES** work when using multiple dimensions:

```
Object x = Array.CreateInstance(typeof(Object), new int[] {2,2}, new int[] {9,9});
Object[,] y = (Object[,])x; 
```

Which works fine.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-11T13:09:40.180

The reason why you can't cast from one to the other is that this is evil.

Lets say you create an array of object[5..9] and you pass it to a function F as an object[].

How would the function knows that this is a 5..9 ? F is expecting a general array but it's getting a constrained one. You could say it's possible for it to know, but this is still unexpected and people don't want to make all sort of boundary checks everytime they want to use a simple array.

An array is the simplest structure in programming, making it too complicated makes it unsusable. You probably need another structure.

What you chould do is a class that is a constrained collection that mimics the behaviour you want. That way, all users of that class will know what to expect.

```
class ConstrainedArray<T> : IEnumerable<T> where T : new()
{
    public ConstrainedArray(int min, int max)
    {
        array = new T[max - min];
    }

    public T this [int index]
    {
        get { return array[index - Min]; }
        set { array[index - Min] = value; }
    }

    public int Min {get; private set;}
    public int Max {get; private set;}

    T[] array;

    public IEnumerator<T> GetEnumerator()
    {
        return array.GetEnumarator();
    }

    System.Collections.IEnumerator System.Collections.IEnumerable.GetEnumerator()
    {
        return array.GetEnumarator();
    }

} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T12:48:43.443

I'm not sure about why that can't be passed as Object[], but wouldn't be easy if you just create a real class to wrap an array and handle your "weird logic" in there?

You'd get the benefits of using a real reference object were you could add "intelligence" to your class.

Edit: How are you casting your Array, could you post some more code? Thanks.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T13:32:36.147

只需将您的下限存储在一个 const 偏移整数中，然后从您的源作为索引返回的任何值中减去该值。

另外：这是一个旧的 VB6 功能。我认为可能有一个属性可以帮助支持它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-09-07T04:56:06.630

.NET CLR 区分两种内部数组对象格式：*SZ 数组*和*MZ 数组*。MZ 数组可以是多维的，并将它们的下限存储在对象中。

造成这种差异的原因有两个：

1.  一维数组的高效代码生成要求没有下限。有一个下限是非常罕见的。我们不希望在常见情况下为这个很少使用的功能牺牲显着的性能。
2.  大多数代码需要下限为零的数组。我们当然不想通过检查下限或调整循环边界来污染我们所有的代码。

通过为 SZ 数组创建单独的 CLR 类型来解决这些问题。这是几乎所有实际出现的数组都在使用的类型。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-08-14T20:11:50.047

知道这是老问题，但要充分解释它。

如果类型（在本例中为下界 > 0 的一维数组）不能由类型化代码创建，那么简单的反射类型实例就不能被类型化代码使用。

您注意到的已经在文档中：

[https://docs.microsoft.com/en-us/dotnet/framework/reflection-and-codedom/specifying-fully-qualified-type-names](https://docs.microsoft.com/en-us/dotnet/framework/reflection-and-codedom/specifying-fully-qualified-type-names)

> 请注意，从运行时的角度来看，MyArray[] != MyArray[*]，但对于多维数组，这两种表示法是等价的。也就是说，Type.GetType("MyArray [,]") == Type.GetType("MyArray[*,*]") 计算结果为真。

在 c#/vb/... 中，您可以将该反射数组保留在对象中，作为对象传递，并仅使用反射来访问它的项目。

-

现在你问“为什么会有 LowerBound？”，好吧，COM 对象不是 .NET，它可以用旧的 VB6 编写，实际上数组对象的 LowerBound 设置为 1（或者任何 VB6 有这样的自由或诅咒，取决于你问谁）。要访问此类对象的第一个元素，您实际上需要使用“comObject(1)”而不是“comObject(0)”。因此，检查下限的原因是当您执行此类对象的枚举以知道从哪里开始枚举时，因为 COM 对象中的元素函数期望第一个元素具有 LowerBound 值，而不是零（0），因此支持是合理的在这种情况下同样的逻辑。想象一下，您在 0 处获取第一个元素的元素值，并使用一些 Com 对象将索引值为 1 甚至索引值为 2001 的元素实例传递给方法，

简而言之：它主要用于遗留支持！

# objective-c - 在gdb中调试Objective-C时向对象发送消息，没有符号

> ID：56472
> 
> 赞同：11
> 
> 时间：2008-09-11T12:53:42.573
> 
> 标签：objective-c, debugging, macos, gdb, reversing

我正在尝试向 gdb 中的 Objective-C 对象发送消息。

```
(gdb) p $esi
$2 = (void *) 0x1268160
(gdb) po $esi
<NSArray: 0x1359c0>
(gdb) po [$esi count]
Target does not respond to this message selector. 
```

我无法向它发送任何消息。我错过了什么吗？我真的需要符号或其他东西吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-15T06:54:05.183

如果您必须覆盖 gdb 并在对象不允许您的情况下向它发送消息，您可以使用 performSelector：

```
(gdb) print (int)[receivedData count]
Target does not respond to this message selector.

(gdb) print (int)[receivedData performSelector:@selector(count) ]
2008-09-15 00:46:35.854 Executable[1008:20b] *** -[NSConcreteMutableData count]:
unrecognized selector sent to instance 0x105f2e0 
```

如果需要传递参数，请使用 withObject：

```
(gdb) print (int)[receivedData performSelector:@selector(count) withObject:myObject ] 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T18:27:46.937

你有可能需要投`$esi`吗？

```
p (NSUInteger)[(NSArray *)$esi count] 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-12T11:02:27.933

@[约翰·卡尔斯贝克]

然后它抱怨缺少符号。

```
(gdb) p (NSUInteger)[(NSObject*)$esi retainCount]
No symbol table is loaded.  Use the "file" command.
(gdb) p [(NSArray *)$esi count]
No symbol "NSArray" in current context. 
```

我尝试为 Foundation 加载符号：

```
(gdb) add-symbol-file /System/Library/Frameworks/Foundation.framework/Foundation 
add symbol table from file "/System/Library/Frameworks/Foundation.framework/Foundation"? (y or n) y
Reading symbols from /System/Library/Frameworks/Foundation.framework/Foundation...done. 
```

但仍然没有运气：

```
(gdb) p [(NSArray *)$esi count]
No symbol "NSArray" in current context. 
```

无论如何，我不认为强制转换是解决这个问题的方法，你不应该知道它是什么类型的对象，就可以向它发送消息。奇怪的是，我发现了一个 NSCFArray，我可以毫无问题地将消息发送到：

```
(gdb) p $eax
$11 = 367589056
(gdb) po $eax
<NSCFArray 0x15e8f6c0>(
    file://localhost/Users/ask/Documents/composing-fractals.pdf
)

(gdb) p (int)[$eax retainCount]
$12 = 1 
```

所以我想我正在调查的对象有问题……或者什么。

谢谢你的帮助！

# c# - 如何在 C# 中与 Windows Media Player 交互

> ID：56478
> 
> 赞同：9
> 
> 时间：2008-09-11T13:02:32.367
> 
> 标签：c#, windows, media, wmp

我正在寻找一种与独立完整版 Windows Media Player 交互的方法。
大多数情况下，我需要知道当前播放曲目的路径。

iTunes SDK 使这变得非常容易，但不幸的是，Windows Media Player 确实没有任何方法可以做到这一点，至少在 .Net(C#) 中没有任何大量使用 pinvoke 的情况，我对此不太满意。

谢谢

只是为了澄清：我不想在我的应用程序中嵌入 Windows Media Player 的新实例，而是控制/读取由用户单独启动的 Windows Media Player 的“真实”完整版本

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-11T13:09:23.347

只需添加对 wmp.dll (\windows\system32\wmp.dll) 的引用

```
using WMPLib; 
```

然后你可以实例化一个媒体播放器

```
var Player = new WindowsMediaPlayer();
// Load a playlist or file and then get the title 
var title = Player.controls.currentItem.name; 
```

有关详细信息，请参阅[以编程方式创建 Windows Media Player 控件](http://msdn.microsoft.com/en-us/library/bb262248(VS.85).aspx)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-19T04:47:17.883

对于 Windows Media Player 的远程处理，您可以使用 IWMPRemoteMediaServices 接口来控制独立的 Windows Media Player。并且您应该能够从 WMP 播放器对象中读取您想要的所有信息，例如标题或文件名。不幸的是，SDK 中没有 C# 示例代码。您可以从这里获取文件：http: [//d.hatena.ne.jp/punidama/20080227](http://d.hatena.ne.jp/punidama/20080227)查找文件 WmpRemote.zip 最初来自这里：http: [//blogs.msdn.com/ericgu/archive/2005 /06/22/431783.aspx](http://blogs.msdn.com/ericgu/archive/2005/06/22/431783.aspx)

然后你必须转换到 WindowsMediaPlayer 对象： RemotedWindowsMediaPlayer rm = new RemotedWindowsMediaPlayer(); WMPLib.WindowsMediaPlayer myPlayer = this.GetOcx() as WMPLib.WindowsMediaPlayer;

你去吧..

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-11T13:08:26.377

我有这个[https://social.msdn.microsoft.com/Forums/vstudio/en-US/dbd43d7e-f3a6-4087-be06-df17e76b635d/windows-media-player-remoting-in-c?forum=clr](https://social.msdn.microsoft.com/Forums/vstudio/en-US/dbd43d7e-f3a6-4087-be06-df17e76b635d/windows-media-player-remoting-in-c?forum=clr)书签，但无论如何都没有测试过。只是指向正确方向的指针。这不是官方的，需要进行一些挖掘，但是您应该在 Windows Media Player 周围获得一个相当简单的包装器（它仍将在后台使用 PInvoke - 但您不会看到它）。

希望有帮助。

哦，我误会了。我以为您在谈论控制当前正在运行的 Windows Media Player 实例。如果您自己托管 Windows Media Player，那么 WMPLib 无疑是更好的解决方案。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T13:17:24.937

我在与 Windows Media Player 交互方面看到的最佳信息是Stephen Toub 撰写的这篇[文章。](http://blogs.msdn.com/toub/archive/2007/09/22/fun-with-dvr-ms.aspx)

他列出了一整套播放 dvr-ms 文件的不同方式（尽管它们的格式并不重要）。您可能感兴趣的一点是关于使用 Media Player ActiveX 控件，您可以通过右键单击并添加 Windows Media Player ActiveX COM 控件将其添加到 Visual Studio 工具箱中。然后，您可以将播放器嵌入到您的应用中，并访问媒体播放器的各种属性，例如 url：

```
WMPplayer.URL = stringPathToFile; 
```

这个解决方案可能不是您想要的，因为它正在启动一个新的媒体播放器实例（据我所知），但它可能会为您指明正确的方向。

# javascript - .NET MVC 会给我需要的 HTML/CSS/JS 分离吗？

> ID：56479
> 
> 赞同：7
> 
> 时间：2008-09-11T13:02:52.507
> 
> 标签：javascript, html, css, asp.net-mvc

我正在与我的 ASP.NET 开发团队合作，尝试在呈现页面时创建“更好” *（即更干净）的 HTML。*目前，.NET 倾向于将 JavaScript 转储到页面中，使其成为表单控件的强制性要求，并且在 JS 不可用时不允许表单工作。在某些情况下，我们正在努力克服这个问题，而不必在开发时间估计中增加一个显着的块。

我以前使用过 MVC——通过 Java 中的 Struts——发现在这种情况下，我能够完全按照我想要的方式保留 HTML 页面。*（这个观点基于我通常事先开发的“最佳情况”静态 HTML，然后交给 Java 程序员来填补漏洞。）*

效果非常好，我们能够从我所见过的 CMS 中生成一些“最好的”网页。.NET MVC 能否为我提供所需的分离，或者将宝贵的开发时间用于测试它会是一种虚假的经济吗？

如果 .NET MVC 不能为我提供这种对分离的细粒度控制，那么任何关于 .NET 编码实践、库等的建议都可能非常有用。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-11T13:07:47.003

ASP.NET MVC 框架会给你一个更熟悉的分离。因为在 MVC 框架中没有视图状态等，所以您不必担心 JavaScript 会被转储到您的页面中。您看到的唯一 JavaScript 调用将是您手动添加的调用。

在大多数情况下，您可以像在不同的框架中那样分离 HTML / CSS / JS。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-11T13:05:30.610

取决于您要使用的视图引擎。是的。

但是您可以通过查看堆栈溢出的页面源来轻松检查这一点。它不是禅宗花园，但很干净。

更多说明：

页面的呈现由视图引擎完成。您可以使用标准视图引擎或现有的，如 nVelocity 或 Brail，就像使用单轨一样。 [http://www.chadmyers.com/Blog/archive/2007/11/28/testing-scottgu-alternate-view-engines-with-asp.net-mvc-nvelocity.aspx](http://www.chadmyers.com/Blog/archive/2007/11/28/testing-scottgu-alternate-view-engines-with-asp.net-mvc-nvelocity.aspx)

由于视图引擎负责创建 HTML，结果取决于您的选择。但是大多数视图引擎在这方面都比普通的 ASP.Net 更好

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T13:54:06.500

@Wrestlevania 说：

> .NET 编码实践、库等的任何建议，这可能真的很有帮助。

在 ASP.Net 中编码时，我尝试保持高水平的分离。我发现如果我避免使用 asp 控件并尽可能多地使用基本的 html 元素，我可以避免 ASP.Net 倾向于在我的页面中注入额外的 CSS 或 JS 的任何情况。例如，使用 span 代替 asp:literal，使用 button 代替 asp:button 等。

我使用的唯一 ASP 控件是转发器，它用于创建表。我需要的任何类似于 asp 控件的功能，我要么在 javascript 中实现自己，要么使用 jquery 之类的框架。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-12T07:02:07.857

Asp.Net MVC 将帮助您保持 html/css/js 分离，因为它将提供更少的功能，这些功能会阻止您将它们分开。

例如，Html 助手通常只返回：Html。从那时起，您可以自由选择只保留与类属性相关的所有样式信息。

还可以考虑研究一下您通常使用 jQuery 之类的库所遵循的做法。这是一个很好的例子，说明如何通过基于元素类型、类和 id 之类的元素在页面加载时将事件处理行为应用于元素，从而将脚本化功能完全保留在 js 中而不受 html 影响。

# c++ - 无法从 C 应用程序访问 C++ DLL 中的变量

> ID：56500
> 
> 赞同：8
> 
> 时间：2008-09-11T13:15:18.810
> 
> 标签：c++, c, interop, name-decoration

我坚持修复旧版 Visual C++ 6 应用程序。在我放的 C++ DLL 源代码中

```
extern "C" _declspec(dllexport) char* MyNewVariable = 0; 
```

这导致 MyNewVariable 出现在导出表中（很好地未装饰）（如 dumpbin /exports blah.dll 所示）。但是，我不知道如何声明变量以便可以在 C 源文件中访问它。我尝试了各种各样的东西，包括

```
_declspec(dllimport) char* MyNewVariable; 
```

但这只是给了我一个链接器错误：

未解析的外部符号“__declspec(dllimport) char * MyNewVariable”(__imp_?MyNewVariable@@3PADA)

```
extern "C" _declspec(dllimport) char* MyNewVariable; 
```

正如托尼（Tony）所建议的（正如我之前尝试过的那样）会产生不同的预期装饰，但仍未将其删除：

未解析的外部符号 __imp__MyNewVariable

如何编写声明以便可以从 C 应用程序访问 C++ DLL 变量？

* * *

## 答案

正如 botismarius 和其他人（非常感谢所有人）所确定的，我需要链接到 DLL 的 .lib。为了防止名称被破坏，我需要在没有装饰器的情况下（在 C 源代码中）声明它，这意味着我需要使用 .lib 文件。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-11T13:22:07.170

您必须链接到编译 DLL 后生成的 lib。在项目的链接器选项中，您必须添加该`.lib`文件。是的，您还应该将变量声明为：

```
extern "C" { declspec(dllimport) char MyNewVariable; } 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-11T13:20:37.003

extern "C" 是您删除装饰的方式 - 它应该可以使用：

extern "C" declspec(dllimport) char MyNewVariable;

或者如果你想要一个可以被 C++ 或 C 使用的头文件（带有 /TC 开关）

```
#ifdef __cplusplus
extern "C" {
#endif
declspec(dllimport) char MyNewVariable;
#ifdef __cplusplus
}
#endif 
```

当然，链接到由执行导出的 dll 生成的导入库。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-11T13:34:55.113

我不确定是谁降低了botismarius，因为他是对的。原因是生成的 .lib 是导入库，它可以很容易地简单地声明外部变量/函数`__declspec(dllimport)`并使用它。导入库只是自动化必要的`LoadLibrary()`和`GetProcAddress()`调用。没有它，您需要手动调用它们。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T13:36:46.217

他们都是对的。错误消息描述的事实`__imp_?MyNewVariable@@3PADA`意味着它正在寻找修饰名称，因此 extern "C" 是必要的。但是，与导入库链接**也是**必要的，否则您将得到一个不同的链接错误。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-11T13:40:44.443

@Graeme：你也是对的。我认为 OP 正在使用的“C”编译器不是强制执行 C99 标准，而是编译为 C++，从而破坏了名称。真正的 C 编译器不会理解`extern "C"`关键字的“C”部分。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-11T16:37:08.823

在**dll 源代码**中，您应该具有此实现，以便 .lib 文件*导出*符号：

```
extern "C" _declspec(dllexport) char* MyNewVariable = 0; 
```

c 客户端应使用带有此声明的**标头**，以便客户端代码将*导入*符号：

```
extern "C" _declspec(dllimport) char* MyNewVariable; 
```

如果在 dll 源代码中添加了#include-ed，此标头将导致编译错误，因此通常将其放在仅用于导出函数且仅由客户端使用的导出标头中。

如果需要，您还可以创建一个“通用”标头，该标头可以包含在如下所示的任何位置：

```
#ifdef __cplusplus
extern "C" {
#endif
#ifdef dll_source_file
#define EXPORTED declspec(dllexport) 
#else
#define EXPORTED declspec(dllimport) 
#endif dll_source_file
#ifdef __cplusplus
}
#endif

EXPORTED char* MyNewVariable; 
```

那么dll源代码是这样的：

```
#define dll_source_code 
#include "universal_header.h"

EXPORTED char* MyNewVariable = 0; 
```

客户端看起来像这样：

```
#include "universal_header.h"
...
MyNewVariable = "Hello, world"; 
```

如果你经常这样做，顶部的怪物#ifdef 可以进入 export_magic.h 并且universal_header.h 变为：

```
#include "export_magic.h"

EXPORTED char *MyNewVariable; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-11T14:17:44.790

我在 Windows 中编程时从未使用过 _declspec(dllimport)。您应该能够简单地声明

```
extern "C" char* MyNewVariable; 
```

并链接到编译 DLL 时创建的 .libb。

# c# - 类型之间有什么区别吗？并且可以为空 ?

> ID：56518
> 
> 赞同：52
> 
> 时间：2008-09-11T13:25:20.563
> 
> 标签：c#, .net, nullable

在 C# 中，可为空的原始类型（即`bool?`）只是它们相应`Nullable<T>`类型的别名，还是两者之间有区别？

* * *

## 回答 #1

> 赞同：67
> 
> 时间：2008-09-11T13:36:33.017

如果您使用[Ildasm](http://msdn.microsoft.com/en-us/library/f7dy01k1%28v=vs.100%29.aspx)查看 IL ，您会发现它们都编译为`Nullable<bool>`.

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-09-11T13:29:48.027

`bool? b = null`和之间没有区别`Nullable<bool> b = null`。这`?`只是 C# 编译器语法糖。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-09-11T13:31:10.130

访问布尔值？您需要执行以下操作：

```
bool? myValue = true;
bool hasValue = false;

if (myValue.HasValue && myValue.Value)
{
  hasValue = true;
} 
```

请注意，您不能只做：

```
if (myValue)
{
  hasValue = true;
} 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2013-01-30T17:28:27.200

我很惊讶还没有人去寻找源代码（C# 规范）。从 §4.1.10 可空类型：

> 可空类型写作 T?，其中 T 是基础类型。此语法是 System.Nullable<T> 的简写，两种形式可以互换使用。

所以，不，这两种形式没有任何区别。（假设您没有`Nullable<T>`在您使用的任何命名空间中调用任何其他类型。）

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-11T13:26:42.573

A`Nullable<T>`是一个结构，由一个T和一个指示T是否有效的位标志组成。A`Nullable<bool>`具有三个可能的值：真、假和空。

**编辑：**啊，我错过了这样一个事实，即“bool”之后的问号实际上是类型名称的一部分，而不是您提出问题的指示:)。那么，您的问题的答案是“是的，C#`bool?`只是`Nullable<bool>`”的别名。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-11T13:28:26.407

A`bool`是一种值类型，因此它不能包含 NULL 值。如果你用 包装任何值类型`Nullable<>`，它将赋予它这种能力。此外，对值的访问方法通过附加属性`HasValue`和`Value`.

但问题是：`Nullable<bool>`和`bool?`是别名。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-11T13:36:35.637

不，没有区别。总之：

System.Boolean -> 有效值：真​​、假

bool -> System.Boolean 的别名

Nullable<bool> -> 有效值：真​​、假、空

布尔？-> Nullable<bool> 的别名

希望这可以帮助。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-11T13:27:56.987

Null 原语只是包装在 Nullable 中的常规原语。任何相反的表现都只是编译器和语法糖。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-01-07T16:55:39.140

没有不同。看看这里：http: [//msdn.microsoft.com/en-us/library/1t3y8s4s.aspx](http://msdn.microsoft.com/en-us/library/1t3y8s4s.aspx)

“语法 T? 是 Nullable 的简写，其中 T 是值类型。这两种形式可以互换。”

# c# - Windows 窗体设计器因具有可为空属性的控件而感到不安

> ID：56521
> 
> 赞同：2
> 
> 时间：2008-09-11T13:26:47.860
> 
> 标签：c#, winforms, nullable

我在 C# .NET 中有一个“数字文本框”，它只不过是文本框的派生，添加了一些逻辑来防止用户输入任何非数字内容。作为其中的一部分，我添加了一个类型为`double?`（或`Nullable<double>`）的 Value 属性。支持用户不输入任何内容的情况是可以为空的。

该控件在运行时工作正常，但 Windows 窗体设计器似乎不太喜欢处理它。当控件添加到窗体时，InitializeComponent() 中会生成以下代码行：

```
this.numericTextBox1.Value = 1; 
```

记住“价值”是类型`Nullable<double>`。每当我尝试在设计器中重新打开表单时，都会生成以下警告：

```
Object of type 'System.Int32' cannot be converted to type 'System.Nullable`1[System.Double]'. 
```

因此，在我手动删除该行并重建之前，无法在设计器中查看该表单——之后，只要我保存任何更改，它就会重新生成。恼人的。

有什么建议么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-11T13:34:28.577

或者，如果您根本不希望设计器添加任何代码...将其添加到属性中。

```
[DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)] 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-10-04T14:35:46.543

Visual Studio 2008 中似乎存在问题。您应该创建自定义 CodeDomSerializer 来解决它：

```
public class CategoricalDataPointCodeDomSerializer : CodeDomSerializer
{
    public override object Deserialize(IDesignerSerializationManager manager, object codeObject)
    {
        CodeStatementCollection collection = codeObject as CodeStatementCollection;

        if (collection != null)
        {
            foreach (CodeStatement statement in collection)
            {
                CodeAssignStatement codeAssignment = statement as CodeAssignStatement;

                if (codeAssignment != null)
                {
                    CodePropertyReferenceExpression properyRef = codeAssignment.Left as CodePropertyReferenceExpression;
                    CodePrimitiveExpression primitiveExpression = codeAssignment.Right as CodePrimitiveExpression;

                    if (properyRef != null && properyRef.PropertyName == "Value" && primitiveExpression != null && primitiveExpression.Value != null)
                    {
                        primitiveExpression.Value = Convert.ToDouble(primitiveExpression.Value);
                        break;
                    }
                }
            }
        }

        return base.Deserialize(manager, codeObject);
    }
} 
```

然后你应该通过在你的类上使用[DesignerSerializer](http://msdn.microsoft.com/en-us/library/system.componentmodel.design.serialization.designerserializerattribute.aspx)属性来应用它。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-11T13:32:11.297

[将该属性上的DefaultValue 属性](http://msdn.microsoft.com/en-us/library/system.componentmodel.defaultvalueattribute(VS.80).aspx)设置为 new Nullable(1) 是否有帮助？

```
[DefaultValue(new Nullable<double>(1))]  
public double? Value ... 
```

# svn - 从稍微过时的 Subversion 存储库备份中恢复

> ID：56543
> 
> 赞同：7
> 
> 时间：2008-09-11T13:38:17.287
> 
> 标签：svn, version-control, backup, sysadmin

不久前遇到的一个问题，我从来没有找到一个好的解决方案...

假设您有一个从修订版 7500 的 subversion 签出的工作副本，并且保存当前存储库的磁盘死了。例如，您已经获得了版本 7450 的存储库备份。恢复存储库备份很容易，但是任何尝试使用工作副本来处理它都会产生错误，指出版本 7500 不存在于存储库中。

签入一个巨大的修订以使存储库的内容与工作副本的内容相匹配并使工作副本恢复到功能状态的最佳方法是什么？

（理想情况下，我想要一些比检查一个全新的工作副本然后手动复制所有文件更容易的东西 - 我认为当时工作副本用于配置管理服务器，所以拥有它真的很痛苦检查干净的工作副本）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-11T13:41:59.777

您可以在某处查看 rev.7450 副本，然后导出您的 7500 副本（以删除 .svn 文件夹）。将导出的副本（最新副本）拖到 7450 副本上。所有新文件都应该简单地覆盖旧文件，使 .svn 文件夹保持不变。

Subversion 会假设你刚刚对 7450 做了一些更改，下一次签入会将它设置为 7451。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-11T13:39:15.290

重新签出到不同的文件夹，然后使用差异程序创建补丁。将补丁应用到您的新工作副本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T13:51:16.930

如果您确定目录中有最新版本，请执行以下操作：

1.  从存储库中删除项目
2.  从您的副本中删除 SVN 引用
3.  将您的代码作为新副本签入。
4.  查看您刚刚签入的代码

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-20T22:38:35.547

您可以通过加载带有一堆空修订的转储文件来填充缺少的修订号。在[How can I change the revision number of a repository 中](https://stackoverflow.com/questions/435638/how-can-i-change-the-revision-number-of-a-repository-in-tortoise-svn/435692#435692)有讨论如何执行此操作的答案。以这种方式加载除一个修订之外的所有修订，然后您可以在最后一个巨大修订中签入所有更改。

# php - activerecord 作为模型，这是个好主意吗？

> ID：56546
> 
> 赞同：7
> 
> 时间：2008-09-11T13:40:04.880
> 
> 标签：php, model-view-controller, activerecord

最近由于 Rails 的流行，很多人开始使用 activerecord 作为模型。然而，在我听说 Rails 之前（我的同龄人小组不喜欢开源东西，我们在一所 .NET 学校接受过教育……），在我做最后一年的项目时，我发现了这个模型的定义

> 该模型代表企业数据以及管理对这些数据的访问和更新的业务规则。模型通常用作模拟真实世界过程的软件，因此在定义模型时应用简单的真实世界建模技术。

它并没有说模型应该像 activerecord 那样表示一个表。而且通常在一个事务中，一个人可能必须查询一些不相关的表，然后操作来自不同表的数据......所以如果使用 activerecord 作为模型，那么任何一个都必须将所有逻辑代码塞进控制器（这是在某些 php 框架中有点流行），这使得测试或破解 activerecord 模型变得困难，因此它不仅对它映射到的表执行数据库操作，而且还对其他相关表执行数据库操作......

那么，滥用（恕我直言）activerecord 作为 MVC 架构模式中的模型有什么好处呢？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-11T13:50:52.810

Martin Fowler 在 Patterns of Enterprise Application Architecture 中描述了这种模式以及其他两种模式或架构。这些模式适用于不同的情况和不同程度的复杂性。

如果你只想简单的东西，你可以使用事务脚本。这是您在许多旧的 ASP 和 PHP 页面中看到的架构，其中单个脚本包含业务逻辑、数据访问逻辑和表示逻辑。当事情变得更复杂时，这很快就会崩溃。

您可以做的下一件事是在演示文稿和模型之间添加一些分离。这是活动记录。该模型仍然与数据库相关联，但您拥有更多的灵活性，因为您可以在视图/页面/任何内容之间重用您的模型/数据访问。它没有它应有的灵活，但取决于您的数据访问解决方案，它可以足够灵活。.Net 中的 CSLA 等框架有很多方面来自这种模式（我认为 Entity Framework 看起来也有点像这样）。它仍然可以处理很多复杂性而不会变得不可维护。

下一步是分离数据访问层和模型。这通常需要一个好的 OR 映射器或大量工作。所以不是每个人都想走这条路。许多诸如领域驱动设计之类的方法都采用了这种方法。

所以这都是上下文的问题。你需要什么，什么是最好的解决方案。我什至有时仍将事务脚本用于简单的一次性代码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-11-24T03:00:01.270

我多次说过，使用 Active Record（或几乎相同的 ORM）作为业务模型并不是一个好主意。让我解释：

PHP 是开源的、免费的（以及所有长篇故事……）这一事实为它提供了一个庞大的开发人员社区，他们将代码倒入论坛、GitHub 等网站、Google 代码等。您可能认为这是一件好事，但有时它往往不是“那么好”。例如，假设您正面临一个项目，并且您希望使用 ORM 框架来解决用 PHP 编写的问题，那么……您将有很多[选项可供选择](http://en.wikipedia.org/wiki/List_of_object-relational_mapping_software)：

*   教义
*   推进
*   QCodo
*   麻木
*   红豆

这样的例子不胜枚举。定期创建新项目。所以想象一下，你已经构建了一个完整的框架，甚至是一个基于该框架的源代码生成器。但是您没有安排商务课程，因为毕竟“为什么要再次编写相同的课程？”。随着时间的推移，一个新的 ORM 框架发布了，您想切换到新的 ORM，但是您必须使用直接引用您的数据模型来修改几乎每个客户端应用程序。

归根结底，Active Record 和 ORM 应该位于应用程序的数据层中，如果将它们与表示层混合使用，您可能会遇到像我刚刚放置的这个示例一样的问题。

听听@Mendelt 的话：阅读 Martin Fowler。他发表了许多关于 OO 设计的书籍和文章，并发表了一些关于该主题的好材料。此外，您可能想查看[Anti-Patterns](http://www.antipatterns.com/)，更具体地说是[Vendor Lock In](http://www.antipatterns.com/vendorlockin.htm)，当我们使我们的应用程序依赖于 3rd 方工具时会发生这种情况。最后，我写了[这篇](http://davidcondemarin.blogspot.com/2010/11/using-orm-classes-as-business-models.html)博客文章，谈到了同样的问题，所以如果你愿意，请查看。

希望我的回答对你有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T14:09:08.947

在 MVC 中使用 Rails ActiveRecord 作为模型的好处在于它为您提供了自动 ORM（对象关系映射器）和在模型之间创建关联的简单方法。正如您所指出的，有时可能缺少 MVC。

因此，对于涉及许多模型的复杂事务，我建议在控制器和模型之间使用 Presenter（[Rails Presenter Pattern](http://blog.jayfields.com/2007/03/rails-presenter-pattern.html)）。Presenter 将聚合您的模型和事务逻辑，并保持易于测试。您肯定希望努力将所有业务逻辑保留在您的模型或演示器中，并保留在您的控制器（[Skinny Controller、Fat Model](http://weblog.jamisbuck.org/2006/10/18/skinny-controller-fat-model)）之外。

# c# - 如何使用 LINQ to SQL 执行 CROSS JOIN？

> ID：56547
> 
> 赞同：133
> 
> 时间：2008-09-11T13:40:19.203
> 
> 标签：c#, linq, linq-to-sql, cross-join

如何使用 LINQ to SQL 执行 CROSS JOIN？

* * *

## 回答 #1

> 赞同：168
> 
> 时间：2008-09-11T14:00:40.963

交叉连接只是两组的笛卡尔积。它没有明确的连接运算符。

```
var combo = from p in people
            来自汽车中的c
            选择新的
            {
                p.姓名，
                c.制作，
                c.型号，
                c.颜色
            };

```

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2012-07-09T13:13:15.657

与 Linq 扩展方法`SelectMany`（lambda 语法）相同：

```
var names = new string[] { "Ana", "Raz", "John" };
var numbers = new int[] { 1, 2, 3 };
var newList=names.SelectMany(
    x => numbers,
    (y, z) => { return y + z + " test "; });
foreach (var item in newList)
{
    Console.WriteLine(item);
} 
```

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2009-03-24T20:43:21.047

根据史蒂夫的回答，最简单的表达方式是：

```
var combo = from Person in people
            from Car    in cars
            select new {Person, Car}; 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2013-09-21T21:37:16.980

A`Tuple`是笛卡尔积的好类型：

```
public static IEnumerable<Tuple<T1, T2>> CrossJoin<T1, T2>(IEnumerable<T1> sequence1, IEnumerable<T2> sequence2)
{
    return sequence1.SelectMany(t1 => sequence2.Select(t2 => Tuple.Create(t1, t2)));
} 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2016-03-18T16:45:15.083

扩展方法：

```
public static IEnumerable<Tuple<T1, T2>> CrossJoin<T1, T2>(this IEnumerable<T1> sequence1, IEnumerable<T2> sequence2)
{
    return sequence1.SelectMany(t1 => sequence2.Select(t2 => Tuple.Create(t1, t2)));
} 
```

并使用如下：

```
vals1.CrossJoin(vals2) 
```

# macos - 在 Mac OS X 下使用外部“windows”键盘

> ID：56553
> 
> 赞同：31
> 
> 时间：2008-09-11T13:42:34.237
> 
> 标签：macos, keyboard, ergonomics

我用的是 MacBook，但我有一个普通的键盘。

问题是这些键并不完全是一对一的映射。一件事是 APPLE 和 ALT 键。它们映射到 WIN 和 ALT，但它们通常在物理上是颠倒的，所以如果你想在相同的布局中使用它们，你必须在操作系统中颠倒它们。功能键的工作方式也不同。外部的 Fx = MacBook 键盘上的 Fn + Fx。然后是所有的插入、删除、键。

所以，问题是，你如何解决这个问题？现在我在“系统偏好设置”面板上重新映射了所有我想要的东西，但是当我拔下外接键盘时，一切都搞砸了。有没有办法只为外部键重新映射键？某些型号的键盘可以存储它自己的映射而不需要操作系统？我是唯一一个为此烦恼的人吗？

（我想避免购买外接mac键盘，因为我想尝试其中一种符合人体工程学的型号，据我所知，没有mac符合人体工程学的型号）

更新：感谢您的回复，我解决了这个问题。

要为不同的键盘设置控制键，您必须转到系统偏好设置/修改键，然后下拉菜单选择键盘允许您选择一个特定的键盘并设置这些键。拔掉/插入后似乎可以工作

@Matthew Schinckel 的建议似乎适用于其余问题（功能键，...）。我还没有尝试过，因为命令键是我最大的抱怨。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-09-11T15:48:28.083

在 OS X 10.5 中，它们允许您为不同的键盘设置不同的键盘设置。这在大多数情况下都有效。我遇到了通过 PS2 插入 USB 的非常旧的键盘的问题，但除此之外它工作正常。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-11T16:05:57.900

我最好的方法是从 Logitech 下载适用于 OSX 的 Logitech Control Center。搜索 LCCKCHR.rsrc 的安装程序包。将此文件放入 ~/Library/Keyboard Layouts 或 /Library/Keyboard Layouts。注销并重新登录，您会在“输入”下的“国际系统偏好设置”中看到更多选项。检查您想要的键盘布局。

尽管此键盘布局适用于罗技键盘，但它适用于大多数键盘（尤其是国际用户）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-11T15:42:59.470

您创建自己的自定义键盘映射，然后可以与键盘语言菜单一起使用。因此，当您插入键盘时，只需切换到您的自定义布局。OS X 从 10.2 开始支持这一点，Apple 有关于如何生成自己的自定义地图的文档。

[http://developer.apple.com/technotes/tn2002/tn2056.html](http://developer.apple.com/technotes/tn2002/tn2056.html)

这不是我自己尝试过的东西，只是读过一两次。看起来它可能会完成这项工作。我只是复制一个尽可能接近你想要的映射，然后从那里自定义它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T15:13:44.593

您可以调查 DoubleCommand，它可能会满足您的需求。

有一个实验版本允许为不同的键盘提供不同的属性。

# regex - 字符前未转义的反斜杠的正确正则表达式是什么？

> ID：56554
> 
> 赞同：11
> 
> 时间：2008-09-11T13:42:35.157
> 
> 标签：regex

假设我想表示`\q`（或任何其他特定的“反斜杠转义字符”）。也就是说，我想匹配`\q`但不匹配`\\q`，因为后者是一个反斜杠转义的反斜杠，后跟一个`q`. 然而`\\\q`会匹配，因为它是一个反斜杠转义的反斜杠，后跟一个反斜杠转义的`q`. （嗯，它会匹配`\q`结尾的，而不是`\\`开头的。）

我知道我需要一个消极的向后看，但他们总是把我的头打成结，特别是因为反斜杠本身必须在正则表达式中转义。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-11T14:25:06.177

更新：我的新的和改进的 Perl 正则表达式，支持超过 3 个反斜杠：

```
/(?<!\\) # 前面没有一个反斜杠
  (?>\\\\)* # 偶数个反斜杠
  \\q # 后跟一个 \q
  /X;
```

或者如果您的正则表达式库不支持扩展语法。

```
/(?<!\\)(?>\\\\)*\\q/
```

我的测试程序的输出：

```
q 不匹配
\q 匹配
\\q 不匹配
\\\q 匹配
\\\\q 不匹配
\\\\\q 匹配
```

旧版本

```
/(?:(?<!\\)|(?<=\\\\))\\q/
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-11T15:12:47.077

[Leon Timmermans](https://stackoverflow.com/a/56671/6761181)得到了我想要的东西。我会为以后来这里的人添加一个小改进：

```
/(?<!\\)(?:\\\\)*\\q/ 
```

`?:`组开头的附加项`(\\\\)`使其不保存到任何匹配数据中。我无法想象我想要保存文本的场景。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T13:52:04.667

[现在你有两个问题](http://www.codinghorror.com/blog/archives/001016.html)。

只需编写一个简单的解析器。如果正则表达式现在把你的头打结了，那就等一个月。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-11T14:24:01.093

最好的解决方案是进行自己的字符串解析，因为正则表达式并不真正支持您正在尝试做的事情。（代表@Frank Krueger，如果你这样做，我只是重复他的建议）

但是，我确实对排除性正则表达式进行了尝试。这将匹配所有不符合您的“\”标准的字符串，后跟一个字符。

```
(?:[\\][\\])(?!(([\\](?![\\])[a-zA-Z]))) 
```

# .net - 在 C++/CLI 中转换 char* 和 System::String 的最佳方法是什么

> ID：56561
> 
> 赞同：45
> 
> 时间：2008-09-11T13:45:30.827
> 
> 标签：.net, string, c++-cli

在 C++/CLI 中从 char* 转换为 System::string 并返回的批准方法是什么？我在 Google 上找到了一些对 marshal_to<> 模板化函数的引用，但似乎此功能从未适用于 Visual Studio 2005（并且不在 Visual Studio 2008 中，AFAIK）。我还在[Stan Lippman 的博客](http://blogs.msdn.com/slippman/archive/2004/06/02/147090.aspx)上看到了一些代码，但它是 2004 年的。我还看到了 Marshal::StringToHGlobalAnsi()。有没有一种被认为是“最佳实践”的方法？

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2008-09-11T14:57:34.743

System::String 有一个接受 char* 的构造函数：

```
 using namespace system;
 const char* charstr = "Hello, world!";
 String^ clistr = gcnew String(charstr);
 Console::WriteLine(clistr); 
```

找回一个 char* 有点困难，但还不错：

```
 IntPtr p = Marshal::StringToHGlobalAnsi(clistr);
 char *pNewCharStr = static_cast<char*>(p.ToPointer());
 cout << pNewCharStr << endl;
 Marshal::FreeHGlobal(p); 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-11T14:34:28.433

这里有一个很好的概述（为 VS2008 添加了这个编组支持）： http: [//www.codeproject.com/KB/mcpp/OrcasMarshalAs.aspx](http://www.codeproject.com/KB/mcpp/OrcasMarshalAs.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T13:58:17.210

我们所做的是创建一个 C++\CLI 对象，该对象将字符串保存在未编辑的代码中，并会给出该项目的管理副本。转换代码看起来很像 Stan 在他的博客上的代码（我记不清了）（如果你使用他的代码，请确保更新它以使用 delete[]），但我们确保析构函数会处理释放所有对象的未管理元素。这有点夸大其词，但是当我们绑定到遗留 C++ 代码模块时，我们没有泄漏。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-06-01T17:14:19.477

我创建了一些辅助方法。我需要这样做才能从旧的 Qt 库迁移到 CLI String。如果有人可以补充这一点并告诉我是否似乎有内存泄漏以及我能做些什么来解决它，我将不胜感激。

```
void MarshalString (  String ^ s, wstring& os ) {
    using namespace Runtime::InteropServices;
    const wchar_t* char = (const wchar_t*)(Marshal::StringToHGlobalUni(s)).ToPointer();
    os = char;
}
QString SystemStringToQt( System::String^ str)
{
    wstring t;
    MarshalString(str, t);
    QString r = QString::fromUcs2((const ushort*)t.c_str());
    return r;
} 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2013-05-25T17:00:01.130

另一个链接到可能方法的摘要：

[http://support.microsoft.com/?kbid=311259](http://support.microsoft.com/?kbid=311259)

# php - 在 PHP 中执行与日期时间相关的操作

> ID：56568
> 
> 赞同：7
> 
> 时间：2008-09-11T13:48:27.873
> 
> 标签：php, sql, postgresql, datetime

您如何实际执行日期时间操作，例如添加日期，查找差异，找出间隔中不包括周末的天数？我个人开始将其中一些操作传递给我的 postgresql dbms，因为通常我只需要发出一条 sql 语句即可获得答案，但是，要以 PHP 方式进行，我必须编写更多代码，这意味着更多机会发生错误...

PHP 中是否有任何库以不需要大量代码的方式执行日期时间操作？在“给定两个日期，两个日期之间有多少个工作日？在 SQL 或 $pet_lang' 中实现，通过这个查询来解决？

```
SELECT  COUNT(*) AS total_days
FROM    (SELECT date '2008-8-26' + generate_series(0,
          (date '2008-9-1' - date '2008-8-26')) AS all_days) AS calendar
WHERE   EXTRACT(isodow FROM all_days) < 6; 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-11T13:55:16.717

虽然对于大多数日期时间操作，我通常会转换为 Unixtime 并对 Unixtime 整数执行加减法等，但您可能需要查看 Zend 框架 Zend_Date 类。

这有很多你描述的功能。尽管 Zend 被标榜为一个“框架”，但它作为一个类库工作得非常好，可以从中挑选元素。我们通常将其包含在项目中，然后在需要时将其拉入。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-11T16:23:04.943

[`PEAR::Date`](https://pear.php.net/package/Date)看起来它可能有一些有用的功能。

[`PEAR::Calendar`](https://pear.php.net/package/Calendar)也可能有用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-11T21:32:47.240

strtotime() 很有用，但如果您不只是使用它来转换格式化的日期/时间字符串，它确实会不时弹出一些奇怪的行为。

像“+1 个月”或“-3 天”这样的东西有时不能给你你期望它输出的东西。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-14T13:39:41.900

PHP5+ 的 DateTime 对象很有用，因为它可以感知闰时间和夏令时，但它需要一些扩展才能真正解决问题。我写了以下内容来解决类似的问题。find_WeekdaysFromThisTo() 方法是蛮力的，但如果您的时间跨度小于 2 年，它的工作速度相当快。

```
$tryme = new Extended_DateTime('2007-8-26');
$newer = new Extended_DateTime('2008-9-1');

print 'Weekdays From '.$tryme->format('Y-m-d').' To '.$newer->format('Y-m-d').': '.$tryme -> find_WeekdaysFromThisTo($newer) ."\n";
/*  Output:  Weekdays From 2007-08-26 To 2008-09-01: 265  */
print 'All Days From '.$tryme->format('Y-m-d').' To '.$newer->format('Y-m-d').': '.$tryme -> find_AllDaysFromThisTo($newer) ."\n";
/*  Output:  All Days From 2007-08-26 To 2008-09-01: 371   */
$timefrom = $tryme->find_TimeFromThisTo($newer);
print 'Between '.$tryme->format('Y-m-d').' and '.$newer->format('Y-m-d').' there are '.
      $timefrom['years'].' years, '.$timefrom['months'].' months, and '.$timefrom['days'].
      ' days.'."\n";
/*  Output: Between 2007-08-26 and 2008-09-01 there are 1 years, 0 months, and 5 days. */

class Extended_DateTime extends DateTime {

    public function find_TimeFromThisTo($newer) {
        $timefrom = array('years'=>0,'months'=>0,'days'=>0);

        // Clone because we're using modify(), which will destroy the object that was passed in by reference
        $testnewer = clone $newer;

        $timefrom['years'] = $this->find_YearsFromThisTo($testnewer);
        $mod = '-'.$timefrom['years'].' years';
        $testnewer -> modify($mod);

        $timefrom['months'] = $this->find_MonthsFromThisTo($testnewer);
        $mod = '-'.$timefrom['months'].' months';
        $testnewer -> modify($mod);

        $timefrom['days'] = $this->find_AllDaysFromThisTo($testnewer);
        return $timefrom;
    } // end function find_TimeFromThisTo

    public function find_YearsFromThisTo($newer) {
        /*
        If the passed is:
        not an object, not of class DateTime or one of its children,
        or not larger (after) $this
        return false
        */
        if (!is_object($newer) || !($newer instanceof DateTime) || $newer->format('U') < $this->format('U'))
            return FALSE;
        $count = 0;

        // Clone because we're using modify(), which will destroy the object that was passed in by reference
        $testnewer = clone $newer;

        $testnewer -> modify ('-1 year');
        while ( $this->format('U') < $testnewer->format('U')) {
            $count ++;
            $testnewer -> modify ('-1 year');
        }
        return $count;
    } // end function find_YearsFromThisTo

    public function find_MonthsFromThisTo($newer) {
        /*
        If the passed is:
        not an object, not of class DateTime or one of its children,
        or not larger (after) $this
        return false
        */
        if (!is_object($newer) || !($newer instanceof DateTime) || $newer->format('U') < $this->format('U'))
            return FALSE;

        $count = 0;
        // Clone because we're using modify(), which will destroy the object that was passed in by reference
        $testnewer = clone $newer;
        $testnewer -> modify ('-1 month');

        while ( $this->format('U') < $testnewer->format('U')) {
            $count ++;
            $testnewer -> modify ('-1 month');
        }
        return $count;
    } // end function find_MonthsFromThisTo

    public function find_AllDaysFromThisTo($newer) {
        /*
        If the passed is:
        not an object, not of class DateTime or one of its children,
        or not larger (after) $this
        return false
        */
        if (!is_object($newer) || !($newer instanceof DateTime) || $newer->format('U') < $this->format('U'))
            return FALSE;

        $count = 0;
        // Clone because we're using modify(), which will destroy the object that was passed in by reference
        $testnewer = clone $newer;
        $testnewer -> modify ('-1 day');

        while ( $this->format('U') < $testnewer->format('U')) {
            $count ++;
            $testnewer -> modify ('-1 day');
        }
        return $count;
    } // end function find_AllDaysFromThisTo

    public function find_WeekdaysFromThisTo($newer) {
        /*
        If the passed is:
        not an object, not of class DateTime or one of its children,
        or not larger (after) $this
        return false
        */
        if (!is_object($newer) || !($newer instanceof DateTime) || $newer->format('U') < $this->format('U'))
            return FALSE;

        $count = 0;

        // Clone because we're using modify(), which will destroy the object that was passed in by reference
        $testnewer = clone $newer;
        $testnewer -> modify ('-1 day');

        while ( $this->format('U') < $testnewer->format('U')) {
            // If the calculated day is not Sunday or Saturday, count this day
            if ($testnewer->format('w') != '0' && $testnewer->format('w') != '6')
                $count ++;
            $testnewer -> modify ('-1 day');
        }
        return $count;
    } // end function find_WeekdaysFromThisTo

    public function set_Day($newday) {
        if (is_int($newday) && $newday > 0 && $newday < 32 && checkdate($this->format('m'),$newday,$this->format('Y')))
            $this->setDate($this->format('Y'),$this->format('m'),$newday);
    } // end function set_Day

    public function set_Month($newmonth) {
        if (is_int($newmonth) && $newmonth > 0 && $newmonth < 13)
            $this->setDate($this->format('Y'),$newmonth,$this->format('d'));
    } // end function set_Month

    public function set_Year($newyear) {
        if (is_int($newyear) && $newyear > 0)
            $this->setDate($newyear,$this->format('m'),$this->format('d'));
    } // end function set_Year
} // end class Extended_DateTime 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-01-06T14:20:14.190

要添加日期，您可以使用从 php 5.3.0 开始的方法**DateTime::add**（*向 DateTime 对象添加天、月、年、小时、分钟和秒的数量）。*

要找出两个日期之间的差异，可以使用**DateTime::diff**方法；但似乎没有一种方法可以计算两个日期之间的工作日。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-11T13:58:35.960

最简单的方法是使用时间戳，表示自 2008 年 1 月 1 日以来的秒数。使用时间戳类型，您可以执行以下操作...

```
now = time();
tomorrow = now + 24 * 60 * 60; // 24 hours * 60 minutes * 60 seconds 
```

在 php 网页上查看[time()](http://us2.php.net/manual/en/function.time.php)、[date()](http://us2.php.net/manual/en/function.date.php)和[mktime()的文档。](http://us2.php.net/manual/en/function.mktime.php)这是我最常使用的三种方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-11T15:33:37.417

您可以使用[strtotime](http://php.net/strtotime)、[mktime](http://php.net/mktime)和[date](http://php.net/date)的组合来进行算术运算

这是一个使用组合 todo 一些算术的示例[http://rushi.wordpress.com/2008/04/13/php-print-out-age-of-date-in-words/](http://rushi.wordpress.com/2008/04/13/php-print-out-age-of-date-in-words/)我将在这里重现代码为简单起见

```
if ($timestamp_diff < (60*60*24*7)) {
   echo floor($timestamp_diff/60/60/24)." Days";
} elseif ($timestamp_diff > (60*60*24*7*4)) {
   echo floor($timestamp_diff/60/60/24/7)." Weeks";
} else {
   $total_months = $months = floor($timestamp_diff/60/60/24/30);
   if($months >= 12) {
      $months = ($total_months % 12);
      $years&nbsp; = ($total_months - $months)/12;
      echo $years . " Years ";
   }
   if($months > 0)
      echo $months . " Months";
}
?> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-11T15:39:58.540

@Rushi我个人不喜欢 strtotime() ..我不知道为什么，但我今天早上发现将像这样的字符串 '2008-09-11 9:5 AM' 传递给 strtotime 会返回错误...

我认为您提供的代码不能解决示例问题'给定两个日期，两个日期之间有多少个工作日？在 SQL 或 $pet_lang' 中实现，我没有考虑是否有公共假期列表......

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-12T09:22:57.173

如果您查看[http://php.net/date](http://php.net/date)，您会发现一些使用`mktime()`来执行操作的示例。

一个简单的例子是锻炼明天的日期。您可以通过简单地将 1 添加到 day 值来做到这一点，`mktime()`如下所示：

```
$tomorrow = date("Y-m-d", mktime(0, 0, 0, date("m"), date("d") + 1, date("Y"))); 
```

因此，在这里，您将收到 YYYY-MM-DD 格式的日期，其中包含明天的日期。您也可以通过简单地将“+”替换为“-”来减去天数。`mktime()`让生活变得更轻松，并且使您不必进行嵌套 if 语句和其他此类麻烦的编码。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-12T10:13:39.563

您可以获得两个日期之间的天数，如下所示：

```
$days = (strtotime("2008-09-10") - strtotime("2008-09-12")) / (60 * 60 * 24); 
```

您可以制作类似的功能（我的工作计算机中没有安装 php，所以我不能保证语法 100% 正确）

```
function isWorkDay($date)
{
 // check if workday and return true if so
}

function numberOfWorkDays($startdate, $enddate)
{
  $workdays = 0;
  $tmp = strtotime($startdate);
  $end = strtotime($enddate);
  while($tmp <= $end)
  {
    if ( isWorkDay( date("Y-m-d",$tmp) ) ) $workdays++;
    $tmp += 60*60*24;
  }
  return $workdays;
} 
```

如果你不喜欢 strtotime 并且你总是有相同格式的日期，你可以使用 explode 函数，比如

```
list($year, $month, day) = explode("-", $date); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-13T17:09:10.913

我强烈建议在进行日期计算时使用 PHP 5.2 的[DateTime 对象](http://us2.php.net/datetime)，而不是使用 UNIX 时间戳。当您使用返回 UNIX 时间戳的 PHP 日期函数时，您可以使用的范围非常有限（例如 1970 年之前没有）。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2011-07-11T04:43:30.850

要获得工作日/假期，postgresql CTE ftw - 请参阅[http://osssmb.wordpress.com/2009/12/02/business-days-working-days-sql-for-postgres-2/](http://osssmb.wordpress.com/2009/12/02/business-days-working-days-sql-for-postgres-2/)

# internationalization - 不要重复自己 vs 国际化

> ID：56574
> 
> 赞同：12
> 
> 时间：2008-09-11T13:50:00.020
> 
> 标签：internationalization

[不久前，我正在阅读关于“在脚本内容中重用字​​符串](http://www.w3.org/International/articles/text-reuse/)”的 W3C 文章，其中包含一些关于国际化的有用建议，但让我觉得与消除重复代码的 DRY（不要重复自己）原则不一致.

以他们为例，我们可能有一些这样的代码......

```
print "The printer is ";
if (printer.working) {
    print "on.\n";
} else {
    print "off.\n";
}

print "The stapler is ";
if (stapler.working) {
    print "on.\n";
} else {
    print "off.\n";
} 
```

我的直觉是大致如下消除重复......

```
report-state(printer, "printer");
report-state(stapler, "stapler");

function report-state(name, object) {
    print "The "+name+" is ";
    if (object.working) {
        print "on\n";
    } else {
        print "off\n";
    }
} 
```

...但是如果我们需要将其本地化为西班牙语，这样做会导致代码出现困难，因为在这两种情况下，“on”这个词显然是不同的。

所以，我想我的问题是，其他开发人员如何平衡 DRY 原则和他们的代码国际化？

我的一部分想争辩说，国际化是那些极端编程“<a href="http://www.extremeprogramming.org/rules/early.html" rel="noreferrer">你不需要它”的情况之一。然而，另一方面，考虑到 DRY 原则的重构应该通过使其易于实现所需的功能来平衡这一点，而不是像这里那样更难。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-11T14:02:44.453

我会尝试在语言资源中保留完整的句子。正如您所说，您可能需要在不同的上下文中使用不同的单词。但更大的问题是不同语言的句子顺序可能不同。因此，从单词中构建字符串可能会导致问题。

只是存储

```
The printer is on
The printer is off
The stapler is on
The stapler is off 
```

在每种语言的语言资源中。与试图找出所有单个单词将在您的应用程序中弹出的位置相比，这里的重复与其说是令人头疼的维护问题。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-19T16:48:33.137

100% 同意门德尔特。

这不仅是维护问题，还可能是语言问题。在所有拉丁语言中，主语的性别、数量和大小写都会影响其他元素。罗马尼亚语示例

```
 The printer is on: Imprimanta este pornită // feminine
  The printer is off: Imprimanta este oprită
  The stapler is on: Perforatorul este pornit // masculine
  The stapler is off: Perforatorul este oprit 
```

另见[http://www.mihai-nita.net/article.php?artID=20060430a](http://www.mihai-nita.net/article.php?artID=20060430a)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-11T14:12:39.670

我同意 Mendelt Siebenga 的观点，他说你应该在你的语言资源文件中保留整个句子或短语。语法上的差异总是会阻止您跨语言进行单个单词替换。与第一个示例相比，这仍然会导致更少的重复代码，因为您只需要检查对象类型及其状态，然后从语言资源中打印适当的消息。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-13T22:14:59.823

我们尽量不通过程序操作来创建消息字符串，因为 loc. 团队看不到他们。

地点。团队实际上更喜欢单独但几乎重复的消息。但是，它们将接受参数化消息。

例如，“%(appliance)% 是 %(on_or_off)%。”

参数可能会崩溃，但至少对于 loc 团队来说，它什么时候可以工作，什么时候不可以更明显。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-11T14:18:29.237

我想这取决于您要达到的语言质量水平。

通过尽量减少处理这些真实语言字符串的代码重复，您只是将自己暴露于不同语言的语法和结构中的另一层逻辑。生成代码将涉及大量工作，这些代码仍然保留语言的原始结构，同时最大限度地减少重复。

您必须决定哪种方法更适合解决特定问题；重复自己的代码，或试图成为多面手并适应无数语言规则的代码（无疑是维护的噩梦）。

当然，您可以采取中间立场，尽量减少代码重复，但放弃令人满意的语法口才。以 Ultima Online 为例——当它被本地化时，一个以前写着“一堆 329 个金币”的字符串变成了“一堆金币：329”。不是很好，但是一个相当合理的解决方案，很容易本地化。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-11T13:59:17.377

我建议使用 CMS 而不是在文本值中硬编码来涵盖本地化。

# asp.net - 您可以使用 1 个 NHibernate Session 查询同一服务器上的不同数据库吗？

> ID：56589
> 
> 赞同：1
> 
> 时间：2008-09-11T13:53:31.573
> 
> 标签：asp.net, nhibernate

是否必须为每个数据库创建一个新的`SessionFactor`y 和对象？`Session`我有一个用于我的应用程序数据的数据存储，以及一个用于我的员工安全的单独数据存储，用于验证用户。我是否必须为调用 2 个不同的数据库创建一个新的 SessionFactory 和 Session 对象？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-11T14:48:07.697

好的，所以这不会直接回答您的问题，但它可能会提供有关为什么您应该为每个数据存储创建多个会话对象的见解。

[本文](http://www.codeproject.com/KB/architecture/NHibernateBestPractices.aspx)解释了如何为所需的每种类型的 Session 实现线程安全的惰性单例，这样每个数据存储区只有一个会话，但它在整个应用程序中共享。所以最多你只会有 2 个会话对象。

但是，要直接回答您的问题，您将需要每个数据库 1 个会话对象。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-07-16T14:21:49.520

# 一般情况

一般情况下的答案是否定的，您至少需要针对一般情况进行不同的会话。

您可以通过使用以打开的连接作为参数的重载来使用单个会话工厂`OpenSession`，从而允许您为需要它的会话切换数据库。

这有一些缺点，例如在事务后缺少连接自动释放、禁用二级缓存……在我看来，最好有两个会话工厂，而不是在会话打开时提供自己的连接。

# 数据库特定案例

根据您使用的数据库服务器，您可以使用单个连接字符串通过 NHibernate 访问两者。如果您可以使用单个连接字符串，那么您可以使用单个会话工厂并使用相同的会话来访问在两个数据库之间拆分的实体。

## 最简单的情况

使用 SQL Server，您可以将两个数据库放在同一个 SQL Server 上。在这种情况下，您可以使用单个连接字符串并调整映射`catalog`上的属性，`<class>`以告知要在哪个数据库中找到该表。（`schema`也可以通过附加一个点来使用。它在 NHibernate 中可用的时间更长，所以对于旧版本，您可能只有`schema`.）

当然，连接凭据必须对访问这两个数据库都有效。

## 其他案例

仍然使用 SQL Server，如果第二个数据库在另一台服务器上，则可以使用链接服务器。您将再次调整`catalog`需要它的类上的属性以指定适当的`linkedServerName.DbName`.

也许其他数据库可能有类似的解决方案。

# oracle - Oracle 列别名中的双引号

> ID：56591
> 
> 赞同：5
> 
> 时间：2008-09-11T13:53:57.093
> 
> 标签：oracle, alias, quotes

好的，这是一个晦涩的问题，但希望有人可以帮助我解决这个问题。

我正在开发的系统构建了一个动态 SQL 字符串，用于在存储过程中执行，并且动态 SQL 的一部分定义了列别名，它们本身实际上是从另一个用户生成的数据表中检索的值。

因此，例如，字符串可能看起来像：

```
SELECT table1.Col1 AS "This is an alias" FROM table1 
```

这工作正常。但是，用于别名的值可能包含双引号字符，这会破坏外引号。我认为我可能会以某种方式在别名中转义双引号，但我没有运气弄清楚如何这样做。反斜杠不起作用，连续使用两个双引号会导致此错误；

```
SQL Error: ORA-03001: unimplemented feature
03001\. 00000 -  "unimplemented feature"
*Cause:    This feature is not implemented. 
```

有没有人有过这个问题的经验？为任何人的任何见解而欢呼。

ps 别名周围需要引号，因为它们可以包含空格。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-11T14:39:39.200

你可以在代码中用双引号代替另一个字符而不是双引号吗？

像这样的东西：

```
SELECT table1.Col1 AS "This is |not| an alias" FROM table1 
```

然后只需替换 | 和 ”。

我知道这是一个 hack，但我想不出更好的解决方案......无论如何，你正在做的是一个 hack。“不错”的方法是分别选择值和列名并将它们关联到您的代码中。那会让事情变得更干净。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-02-02T07:50:30.560

使用 Oracle 引号运算符：

```
select q'#someone's quote#' from dual; 
```

'#' 可以替换为任何字符

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T14:10:21.190

当我运行这个：

```
select 'test"columnname"' from dual 
```

Oracle 返回这个（注意 Oracle 生成的列名）：

```
'TESTCOLUMNNAME'
--------------------------------
test"columnname 
```

Oracle 的列名不包含我的双引号这一事实告诉我，Oracle 可能无法代表这一点。

据我所知，最好的选择是在使用列名之前从数据中去除双引号。可悲的是，这也需要您在*选择*这些列时执行相同的过滤，但我没有看到其他方式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T18:29:44.707

一个可能富有成果的调查领域是研究引用方法。

**我的 $quotedString = $dbh->quote( $string );**

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-09-23T07:43:39.127

试试这个，两个单引号实际上在输出中看起来像一个双引号：
`select 1 as "University ''John Smith''" from dual;`

# xml - 如何使用 XSL 转义 XML 内容以安全地将其输出为 JSON？

> ID：56611
> 
> 赞同：5
> 
> 时间：2008-09-11T13:59:37.393
> 
> 标签：xml, json, xslt, escaping

如何使用 XSL 转义 XML 内容以安全地将其输出为 JSON？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-11T14:09:23.813

对不起，我自己在谷歌上找到了答案（字面意思）：

[http://code.google.com/p/xml2json-xslt/](http://code.google.com/p/xml2json-xslt/)

# html - IE7 是否有“开发者模式”或像 Firefox/Chrome/Safari 这样的插件？

> ID：56615
> 
> 赞同：45
> 
> 时间：2008-09-11T14:01:34.797
> 
> 标签：html, css, browser, internet-explorer-7

> **可能重复：**
> [在 IE7 中调试 JavaScript](https://stackoverflow.com/questions/361635/debugging-javascript-in-ie7)

Firefox 有 Web Developer 插件和 Firebug 用于解决 html/css/javascript 问题。Google Chrome 和 Safari 具有非常相似的控制台和“检查元素”的右键单击选项。

IE7 是否有类似的解决布局/html/css 问题的方法？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-09-11T14:03:20.347

是 - Internet Explorer 开发人员工具栏

[下载详情：Internet Explorer 开发者工具栏](http://www.microsoft.com/downloads/en/details.aspx?familyid=95E06CBE-4940-4218-B75D-B8856FCED535&displaylang=en)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-09-16T15:33:33.827

您还可以使用[Firebug Lite](http://getfirebug.com/lite.html)，它适用于 IE、Opera 和 Safari。

这是一个 Javascript 实现，您可以使用一个简单的书签来加载它。

由于SO不允许Javascript，这里是书签源代码（只需复制粘贴到您的浏览器位置栏（在执行随机javascript之前始终确保它是安全的（无论如何检查第一个链接）））

```
javascript:var%20firebug=document.createElement('script');firebug.setAttribute('src','http://getfirebug.com/releases/lite/1.2/firebug-lite-compressed.js');document.body.appendChild(firebug);(function(){if(window.firebug.version){firebug.init();}else{setTimeout(arguments.callee);}})();void(firebug); 
```

Firebug Lite 支持 Firebug的[所有基本命令](http://getfirebug.com/console.html)。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-11T14:09:27.727

我也使用过[Debug Bar](http://www.debugbar.com/)。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-11T14:03:24.950

查看[IE Developer 工具栏](http://www.microsoft.com/en-us/download/details.aspx?id=18359)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-11T14:02:57.150

[网页开发助手](http://projects.nikhilk.net/WebDevHelper/)

*Web Development Helper 是 Internet Explorer 的免费浏览器扩展，它为 Web 开发人员提供了一组工具和实用程序，尤其是。Ajax 和 ASP.NET 开发人员。该工具提供了诸如 DOM 检查器、HTTP 跟踪工具、脚本诊断和即时窗口等功能。Web Development Helper 适用于 IE6+，需要在机器上安装 .NET Framework 2.0 或更高版本。安装后，可以使用工具 | 激活该工具。Web 开发助手命令。您还可以自定义浏览器的工具栏，为该命令添加一个按钮，以方便频繁使用。单击菜单命令或浏览器按钮会显示工具的控制台窗口和命令集。页面功能：DOM 检查器允许查看所有元素、选定元素或与 ID 或 CSS 类匹配的元素，他们的属性和风格。捕获当前页面的屏幕截图。查看页面信息，例如元数据、标签和链接资源。*…………

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-09-14T15:55:09.297

不幸的是，微软似乎已经停止了它，工具栏页面现在只是说“我们很抱歉，找不到您请求的页面。”

我认为是因为它内置于 8 中，因此他们已将其删除以供下载，并且不会为帮助我们开发人员而烦恼，这些开发人员被迫让我们的项目在他们更古老的浏览器中运行:'(

在任何人说之前，IE8 兼容模式！= IE7

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-11T14:03:42.390

您可以获得一个[工具栏](http://www.microsoft.com/downloads/details.aspx?FamilyID=e59c3964-672d-4511-bb3e-2d5e1db91038&displaylang=en)，但它仍然与 Firefox 不匹配，尤其是对于 javascript 调试。

IE8 将是一个巨大的发展进步。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-04-26T14:29:57.193

以下是专门针对IE7的，其他版本大概类似。

这是微软开发工具的新链接。（截至 2011 年 4 月 26 日） [IE 开发工具](http://www.microsoft.com/downloads/en/details.aspx?FamilyID=95e06cbe-4940-4218-b75d-b8856fced535)

安装后，您将需要启用工具栏。

要启用，请单击`Tools | Manage Add-Ons | Enable or Disable Add-ons`, 以启用插件。

要将图标添加到 IE 工具栏，请右键单击`IE menu | Customize Command Bar | Add or Remove Commands`. 添加“<（箭头）>”图标。

希望有帮助。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-22T08:47:36.770

也可以用IE watch，有点像萤火虫，但需要购买。这是一个 30 天试用版。

* * *

## 回答 #10

> 赞同：-8
> 
> 时间：2008-09-11T14:05:10.017

实际上，IE 开发人员最好的附加组件是[Fiddler](http://www.fiddlertool.com/fiddler/version.asp)。它具有其他浏览器拥有的许多功能。

# sql-server - 如何清除 SQL Server 事务日志？

> ID：56628
> 
> 赞同：638
> 
> 时间：2008-09-11T14:08:11.523
> 
> 标签：sql-server, transaction-log

我不是 SQL 专家，每次我需要做一些超出基础的事情时，我都会想起这样一个事实。我有一个规模不大的测试数据库，但事务日志肯定是。如何清除事务日志？

* * *

## 回答 #1

> 赞同：832
> 
> 时间：2013-08-17T18:38:59.043

确实应该为遇到意外增长而您不希望再次发生的情况保留使日志文件更小的情况。如果日志文件将再次增长到相同的大小，则暂时缩小它并不能完成很多工作。现在，根据您的数据库的恢复目标，这些是您应该采取的行动。

# 首先，进行完整备份

永远不要对数据库进行任何更改，除非确保在出现问题时可以恢复它。

# 如果您关心时间点恢复

（通过时间点恢复，我的意思是您关心能够恢复到除完整备份或差异备份之外的任何内容。）

大概您的数据库处于`FULL`恢复模式。如果不是，请确保它是：

```
ALTER DATABASE testdb SET RECOVERY FULL; 
```

即使您定期进行完整备份，日志文件也会不断增长，直到您执行*日志*备份 - 这是为了保护您，而不是不必要地占用您的磁盘空间。根据您的恢复目标，您应该非常频繁地执行这些日志备份。例如，如果您的业务规则规定您可以承受在发生灾难时丢失不超过 15 分钟的数据，那么您应该有一个每 15 分钟备份一次日志的作业。这是一个脚本，它将根据当前时间生成带时间戳的文件名（但您也可以使用维护计划等执行此操作，只是不要在维护计划中选择任何收缩选项，它们很糟糕）。

```
DECLARE @path NVARCHAR(255) = N'\\backup_share\log\testdb_' 
  + CONVERT(CHAR(8), GETDATE(), 112) + '_'
  + REPLACE(CONVERT(CHAR(8), GETDATE(), 108),':','')
  + '.trn';

BACKUP LOG foo TO DISK = @path WITH INIT, COMPRESSION; 
```

请注意，它`\\backup_share\`应该在代表不同底层存储设备的不同机器上。将它们备份到同一台机器（或使用相同底层磁盘的另一台机器，或同一物理主机上的不同 VM）并不能真正帮助您，因为如果机器发生故障，您就丢失了数据库*及其*备份。根据您的网络基础设施，在本地备份然后将它们转移到幕后的不同位置可能更有意义；在任何一种情况下，您都希望尽快将它们从主数据库机器上移除。

现在，一旦您运行了常规日志备份，将日志文件缩小到比现在被炸毁的任何东西更合理的东西应该是合理的。这并不*意味着*一遍`SHRINKFILE`又一遍地运行直到日志文件达到 1 MB - 即使您经常备份日志，它仍然需要容纳可能发生的任何并发事务的总和。日志文件自动增长事件代价高昂，因为 SQL Server 必须将文件归零（与启用即时文件初始化时的数据文件不同），并且用户事务必须在发生这种情况时等待。您希望尽可能少地执行这种增长-收缩-增长-收缩例程，并且您当然不想让您的用户为此付费。

请注意，您可能需要两次备份日志才能进行缩减（感谢 Robert）。

因此，您需要为您的日志文件提供一个实用的大小。如果您不了解更多有关您的系统的信息，这里没有人可以告诉您那是什么，但是如果您经常缩小日志文件并且它又一直在增长，那么一个好的水印可能比它的最大水印高 10-50% . 假设达到 200 MB，并且您希望任何后续自动增长事件为 50 MB，那么您可以通过以下方式调整日志文件大小：

```
USE [master];
GO
ALTER DATABASE Test1 
  MODIFY FILE
  (NAME = yourdb_log, SIZE = 200MB, FILEGROWTH = 50MB);
GO 
```

请注意，如果日志文件当前 > 200 MB，您可能需要先运行：

```
USE yourdb;
GO
DBCC SHRINKFILE(yourdb_log, 200);
GO 
```

# 如果您不关心时间点恢复

如果这是一个测试数据库，并且您不关心时间点恢复，那么您应该确保您的数据库处于`SIMPLE`恢复模式。

```
ALTER DATABASE testdb SET RECOVERY SIMPLE; 
```

将数据库置于`SIMPLE`恢复模式将确保 SQL Server 重新使用部分日志文件（基本上逐步淘汰非活动事务），而不是增长以保留*所有*事务的记录（就像`FULL`在备份日志之前恢复所做的那样）。`CHECKPOINT`events 将有助于控制日志并确保它不需要增长，除非您在`CHECKPOINT`s 之间生成大量 t-log 活动。

接下来，您应该绝对确保此日志增长确实是由于异常事件（例如，年度春季大扫除或重建最大索引），而不是由于正常的日常使用。如果您将日志文件缩小到小得离谱的大小，而 SQL Server 只需要再次增大它以适应您的正常活动，那么您得到了什么？您是否能够利用您只是暂时释放的磁盘空间？如果您需要立即修复，则可以运行以下命令：

```
USE yourdb;
GO
CHECKPOINT;
GO
CHECKPOINT; -- run twice to ensure file wrap-around
GO
DBCC SHRINKFILE(yourdb_log, 200); -- unit is set in MBs
GO 
```

否则，设置适当的大小和增长率。根据时间点恢复案例中的示例，您可以使用相同的代码和逻辑来确定合适的文件大小并设置合理的自动增长参数。

# 有些事情你不想做

*   **使用选项备份日志，`TRUNCATE_ONLY`然后`SHRINKFILE`**。一方面，此`TRUNCATE_ONLY`选项已被弃用，并且在当前版本的 SQL Server 中不再可用。其次，如果您处于`FULL`恢复模式，这将破坏您的日志链并需要新的完整备份。

*   **分离数据库，删除日志文件，然后重新附加**. 我无法强调这有多危险。您的数据库可能无法备份，可能会出现可疑情况，您可能必须恢复到备份（如果有的话）等等。

*   **使用“收缩数据库”选项**。`DBCC SHRINKDATABASE`并且执行相同操作的维护计划选项是个坏主意，尤其是当您真的只需要解决日志问题时。`DBCC SHRINKFILE`使用或`ALTER DATABASE ... MODIFY FILE`（上面的示例）定位您要调整的文件并独立调整它。

*   **将日志文件缩小到 1 MB**。这看起来很诱人，因为，嘿，SQL Server 会让我在某些情况下这样做，并查看它释放的所有空间！除非您的数据库是只读的（而且您应该使用 标记它`ALTER DATABASE`），否则这绝对会导致许多不必要的增长事件，因为无论恢复模型如何，日志都必须容纳当前事务。暂时释放该空间有什么意义，以便 SQL Server 可以缓慢而痛苦地收回它？

*   **创建第二个日志文件**。这将为已填满磁盘的驱动器提供暂时的缓解，但这就像试图用创可贴修复被刺破的肺一样。您应该直接处理有问题的日志文件，而不是仅仅添加另一个潜在问题。除了将某些事务日志活动重定向到不同的驱动器之外，第二个日志文件实际上对您没有任何作用（与第二个数据文件不同），因为一次只能使用其中一个文件。[Paul Randal 还解释了为什么多个日志文件会在以后给您带来麻烦](http://www.sqlskills.com/blogs/paul/multiple-log-files-and-why-theyre-bad/)。

# 主动

与其将日志文件缩小到很小的数量并让它自己以很小的速率不断自动增长，不如将其设置为相当大的大小（可以容纳最大并发事务集的总和）并设置一个合理的自动增长设置为后备，因此它不必多次增长以满足单个事务，因此在正常业务操作期间它相对很少需要增长。

这里最糟糕的设置是 1 MB 增长或 10% 增长。有趣的是，这些是 SQL Server 的默认值（我曾抱怨并[要求更改无济于事](https://web.archive.org/web/20140108204835/http://connect.microsoft.com:80/SQLServer/feedback/details/415343)）——数据文件为 1 MB，日志文件为 10%。前者在当今时代太小了，后者每次都会导致越来越长的事件（例如，您的日志文件是 500 MB，第一次增长是 50 MB，下一个增长是 55 MB，下一个增长是 60.5 MB ，等等等等 - 在慢速 I/O 上，相信我，你会真正注意到这条曲线）。

# 进一步阅读

请不要停在这里；虽然您看到的关于缩减日志文件的许多建议本质上都是不好的，甚至可能是灾难性的，但有些人更关心数据完整性而不是释放磁盘空间。

[我在 2009 年写的一篇博文，当时我看到了一些“这里是如何缩小日志文件”的帖子](https://sqlblog.org/2009/07/27/oh-the-horror-please-stop-telling-people-they-should-shrink-their-log-files)。

[Brent Ozar 四年前写的一篇博文，指向多个资源，以回应 SQL Server Magazine 的一篇不应该*发表*的文章](http://www.brentozar.com/archive/2009/08/stop-shrinking-your-database-files-seriously-now/)。

[Paul Randal 的博客文章解释了为什么 t-log 维护很重要](http://www.sqlskills.com/blogs/paul/importance-of-proper-transaction-log-size-management/)以及[为什么不应该缩小数据文件](http://www.sqlskills.com/blogs/paul/why-you-should-not-shrink-your-data-files/)。

[Mike Walsh 也有一个很好的答案，涵盖了其中一些方面，包括您可能无法立即缩小日志文件的原因](https://dba.stackexchange.com/questions/29829/why-does-the-transaction-log-keep-growing-or-run-out-of-space)。

* * *

## 回答 #2

> 赞同：237
> 
> 时间：2011-10-31T10:51:12.487

```
-- DON'T FORGET TO BACKUP THE DB :D (Check [here][1]) 

USE AdventureWorks2008R2;
GO
-- Truncate the log by changing the database recovery model to SIMPLE.
ALTER DATABASE AdventureWorks2008R2
SET RECOVERY SIMPLE;
GO
-- Shrink the truncated log file to 1 MB.
DBCC SHRINKFILE (AdventureWorks2008R2_Log, 1);
GO
-- Reset the database recovery model.
ALTER DATABASE AdventureWorks2008R2
SET RECOVERY FULL;
GO 
```

来自：*[DBCC SHRINKFILE (Transact-SQL)](http://msdn.microsoft.com/en-us/library/ms189493.aspx)*

您可能需要先备份。

* * *

## 回答 #3

> 赞同：190
> 
> 时间：2009-01-19T20:31:50.693

**免责声明：**请仔细阅读下面的评论，我假设您已经阅读了接受的答案。正如我将近 5 年前所说：

> 如果有人对这不是适当或最佳解决方案的情况有任何意见要添加，请在下面发表评论

* * *

*   右键单击数据库名称。

*   选择任务→收缩→数据库

*   然后点击`OK`！

我通常打开包含数据库文件的 Windows 资源管理器目录，因此我可以立即看到效果。

*我真的很惊讶这能奏效！通常我以前使用过 DBCC，但我只是尝试过它并没有缩小任何东西，所以我尝试了 GUI（2005 年）并且效果很好 - 在 10 秒内释放了 17 GB*

在完全恢复模式下，这可能不起作用，因此您必须先备份日志，或者更改为简单恢复，然后收缩文件。[为此感谢@onupdatecascade]

--

PS：我很欣赏一些人对此危险的评论，但在我的环境中，我自己没有任何问题，特别是因为我总是先做完整备份。因此，在继续之前，请考虑您的环境是什么，以及这如何影响您的备份策略和工作安全性。我所做的只是向人们指出微软提供的一项功能！

* * *

## 回答 #4

> 赞同：56
> 
> 时间：2013-03-18T12:16:45.517

下面是一个收缩事务日志的脚本，但我绝对建议在收缩之前备份事务日志。

如果您只是缩小文件，您将丢失大量数据，这些数据可能会在发生灾难时成为救生员。事务日志包含许多有用的数据，可以使用第三方事务日志阅读器读取（可以手动读取，但需要付出极大的努力）。

在进行时间点恢复时，事务日志也是必须的，所以不要只是扔掉它，而是要确保事先备份它。

以下是人们使用存储在事务日志中的数据来完成恢复的几篇文章：

*   *[如何在 SQL Server 2008 中查看事务日志](https://stackoverflow.com/questions/4507509)*

*   *[在 SQL Server 2008 中读取日志文件 (*.LDF)](https://stackoverflow.com/questions/9767054)*

```
USE DATABASE_NAME;
GO

ALTER DATABASE DATABASE_NAME
SET RECOVERY SIMPLE;
GO
--First parameter is log file name and second is size in MB
DBCC SHRINKFILE (DATABASE_NAME_Log, 1);

ALTER DATABASE DATABASE_NAME
SET RECOVERY FULL;
GO 
```

执行上述命令时，您可能会收到如下所示的错误

> “无法收缩日志文件（日志文件名），因为位于文件末尾的逻辑日志文件正在使用中”</p>

这意味着 TLOG 正在使用中。在这种情况下，请尝试连续多次执行此操作，或找到减少数据库活动的方法。

* * *

## 回答 #5

> 赞同：33
> 
> 时间：2008-09-11T14:16:31.877

这是一种简单且**非常不雅**且有**潜在危险** 的方式。

1.  备份数据库
2.  分离数据库
3.  重命名日志文件
4.  附加数据库
5.  将重新创建新的日志文件
6.  删除重命名的日志文件。

我猜你没有做日志备份。（这会截断日志）。我的建议是将恢复模式从[full](http://msdn.microsoft.com/en-us/library/ms190217.aspx)更改为[simple](http://msdn.microsoft.com/en-us/library/ms191164.aspx)。这将防止日志膨胀。

* * *

## 回答 #6

> 赞同：30
> 
> 时间：2008-09-15T14:31:27.220

如果您不使用事务日志进行恢复（即您只进行完整备份），您可以将恢复模式设置为“简单”，事务日志将很快缩小并且不再填满。

如果您使用的是 SQL 7 或 2000，您可以在数据库选项选项卡中启用“truncate log on checkpoint”。这具有相同的效果。

显然不建议在生产环境中这样做，因为您将无法恢复到某个时间点。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2009-02-06T22:26:43.057

不推荐使用 John 推荐的这种技术，因为无法保证数据库在没有日志文件的情况下会附加。将数据库从完整更改为简单，强制检查点并等待几分钟。SQL Server 将清除日志，然后您可以使用 DBCC SHRINKFILE 将其缩小。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2013-01-31T15:02:35.337

到目前为止，这里的大多数答案都是假设您实际上不需要事务日志文件，但是如果您的数据库正在使用`FULL`恢复模式，并且您希望保留备份以防需要恢复数据库，则*不要*截断或删除以许多这些答案所建议的方式记录文件。

删除日志文件（通过截断、丢弃、擦除等）会破坏您的备份链，并且会阻止您恢复到自上次完整、差异或事务日志备份以来的任何时间点，直到下一次完整备份或进行差异备份。

来自[微软的文章`BACKUP`](http://msdn.microsoft.com/en-us/library/ms186865%28v=sql.90%29.aspx)

> 我们建议您永远不要使用 NO_LOG 或 TRUNCATE_ONLY 手动截断事务日志，因为这会破坏日志链。在下一次完整或差异数据库备份之前，数据库不会受到介质故障的保护。仅在非常特殊的情况下使用手动日志截断，并立即创建数据备份。

为避免这种情况，请在缩小日志文件之前将其备份**到磁盘。**语法看起来像这样：

```
BACKUP LOG MyDatabaseName 
TO DISK='C:\DatabaseBackups\MyDatabaseName_backup_2013_01_31_095212_8797154.trn'

DBCC SHRINKFILE (N'MyDatabaseName_Log', 200) 
```

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2015-06-10T11:41:04.310

SQL Server 事务日志需要妥善维护，以防止其不必要的增长。这意味着足够频繁地运行事务日志备份。如果不这样做，您将面临事务日志变满并开始增长的风险。

除了这个问题的答案，我建议阅读和理解事务日志常见的神话。这些读数可能有助于理解事务日志并决定使用什么技术来“清除”它：

来自*[10 个最重要的 SQL Server 事务日志神话](http://www.sqlshack.com/10-important-sql-server-transaction-log-myths/)*：

> 误解：我的 SQL Server 太忙了。我不想进行 SQL Server 事务日志备份
> 
> SQL Server 中最大的性能密集型操作之一是联机事务日志文件的自动增长事件。由于不经常进行事务日志备份，在线事务日志将变满并且必须增长。默认增长大小为 10%。数据库越忙，如果不创建事务日志备份，则联机事务日志增长得越快 创建 SQL Server 事务日志备份不会阻止联机事务日志，但自动增长事件会。它可以阻止在线事务日志中的所有活动

从*[交易日志神话](http://blog.sqlxdetails.com/transaction-log-myths/)*：

> > 误区：定期收缩日志是一种很好的维护实践
> 
> 错误的。日志增长非常昂贵，因为新块必须清零。该数据库上的所有写入活动都会停止，直到归零完成，如果您的磁盘写入速度很慢或自动增长大小很大，那么该暂停可能会很大并且用户会注意到。这就是你想要避免增长的原因之一。如果你收缩日志，它会再次增长，你只是在不必要的收缩和增长游戏上浪费磁盘操作

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2010-05-24T15:50:36.783

使用`DBCC ShrinkFile ({logicalLogName}, TRUNCATEONLY)`命令。如果这是一个测试数据库并且您正在尝试保存/回收空间，这将有所帮助。

请记住，虽然 TX 日志确实有一种最小/稳定状态大小，但它们会长大。根据您的恢复模式，您可能无法缩小日志 - 如果在 FULL 并且您没有发出 TX 日志备份，则无法缩小日志 - 它将永远增长。如果您不需要 TX 日志备份，请将您的恢复模式切换为*Simple*。

请记住，在任何情况下都不要删除日志 (LDF) 文件！您几乎会立即发生数据库损坏。煮熟！完毕！丢失数据！如果“未修复”，主 MDF 文件可能会永久损坏。

永远不要删除事务日志——你会丢失数据！*您的部分数据在 TX 日志中（无论恢复模式如何）...如果您分离并“重命名”有效删除*部分数据库的 TX 日志文件。

对于那些已删除 TX 日志的用户，您可能需要运行一些 checkdb 命令并在丢失更多数据之前修复损坏。

查看 Paul Randal 关于这个主题的博客文章，*[不好的建议](http://sqlskills.com/BLOGS/PAUL/category/Bad-Advice.aspx#p4)*。

此外，通常不要在 MDF 文件上使用 shrinkfile，因为它会严重分割您的数据。查看他的“坏建议”部分了解更多信息（“为什么不应该缩小数据文件”）

查看 Paul 的网站 - 他涵盖了这些问题。上个月，他在他的*Myth A Day*系列中讨论了许多这些问题。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-09-23T16:41:23.010

根据我在大多数 SQL Server 上的经验，没有事务日志的备份。完全备份或差异备份是常见的做法，但事务日志备份确实很少见。因此事务日志文件永远增长（直到磁盘已满）。在这种情况下，**恢复模式**应设置为“**简单**”。不要忘记修改系统数据库“model”和“tempdb”。

数据库“tempdb”的备份没有意义，因此该数据库的恢复模式应该始终是“简单”的。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-06-12T04:39:57.473

首先检查数据库恢复模式。默认情况下，SQL Server Express Edition 为简单恢复模型创建一个数据库（如果我没记错的话）。

带有 Truncate_Only 的备份日志 DatabaseName：

```
DBCC ShrinkFile(yourLogical_LogFileName, 50) 
```

SP_helpfile 将为您提供逻辑日志文件名。

参考：

*[从 SQL Server 数据库中的完整事务日志中恢复](https://support.microsoft.com/en-us/help/873235/recover-from-a-full-transaction-log-in-a-sql-server-database)*

如果您的数据库处于完全恢复模式并且不进行 TL 备份，则将其更改为 SIMPLE。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2018-02-02T15:15:55.027

它发生在我的数据库日志文件为 28 GB 的地方。

你能做些什么来减少这种情况？实际上，日志文件是 SQL 服务器在事务发生时保留的那些文件数据。对于要处理的事务，SQL 服务器会为其分配页面。但交易完成后，这些都不是突然放出来的，希望有可能有同样的交易来。这占据了空间。

第1步：首先在数据库查询explored checkpoint中运行这个命令

步骤2：右键单击数据库任务>备份选择备份类型为事务日志添加目标地址和文件名以保留备份数据（.bak）

再次重复此步骤，此时给出另一个文件名

[![在此处输入图像描述](https://i.stack.imgur.com/ELNLW.png)](https://i.stack.imgur.com/ELNLW.png)

第 3 步：现在转到数据库 右键单击​​数据库

任务>收缩>文件选择文件类型作为日志收缩操作作为释放未使用的空间

[![在此处输入图像描述](https://i.stack.imgur.com/qwPKt.png)](https://i.stack.imgur.com/qwPKt.png)

第4步：

在 SQL 2014 中正常检查您的日志文件，这可以在以下位置找到

C:\Program Files\Microsoft SQL Server\MSSQL12.MSSQL2014EXPRESS\MSSQL\DATA

就我而言，它从 28 GB 减少到 1 MB

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-09-14T18:44:25.780

**要截断日志文件：**

*   备份数据库
*   通过使用企业管理器或通过执行分离数据库：*Sp_DetachDB [DBName]*
*   删除事务日志文件。（或重命名文件，以防万一）
*   *使用： Sp_AttachDB [DBName]*再次重新附加数据库
**   附加数据库后，将创建一个新的事务日志文件。*

 ***缩小日志文件：**

*   带有 No_Log 的备份日志 [DBName]
*   通过以下任一方式收缩数据库：

    使用企业管理器：- 右键单击​​数据库，所有任务，收缩数据库，文件，选择日志文件，确定。

    使用 T-SQL :- *Dbcc Shrinkfile ([Log_Logical_Name])*

您可以通过运行 sp_helpdb 或通过在企业管理器中查看数据库的属性来找到日志文件的逻辑名称。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2011-06-17T14:52:07.633

1.  备份 MDB 文件。
2.  停止 SQL 服务
3.  重命名日志文件
4.  启动服务

（系统将创建一个新的日志文件。）

删除或移动重命名的日志文件。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2014-12-10T16:38:10.970

数据库→右键单击*属性*→文件→添加另一个具有不同名称的日志文件，并将路径设置为与具有不同文件名的旧日志文件相同。

数据库自动选取新创建的日志文件。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2011-01-03T12:58:22.527

试试这个：

```
USE DatabaseName

GO

DBCC SHRINKFILE( TransactionLogName, 1)

BACKUP LOG DatabaseName WITH TRUNCATE_ONLY

DBCC SHRINKFILE( TransactionLogName, 1)

GO 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2020-01-03T00:56:56.877

略微更新的答案，适用于 MSSQL 2017，并使用 SQL 服务器管理工​​作室。我主要从这些说明[https://www.sqlshack.com/sql-server-transaction-log-backup-truncate-and-shrink-operations/](https://www.sqlshack.com/sql-server-transaction-log-backup-truncate-and-shrink-operations/)

我最近有一个数据库备份，所以我备份了事务日志。然后我再次备份它以备不时之需。最后我缩小了日志文件，从 20G 到 7MB，更符合我的数据大小。我认为自从 2 年前安装以来，事务日志就没有被备份过。所以把这个任务放在了家务日历上。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2010-12-01T08:12:56.053

1.  备份数据库
2.  分离数据库
3.  重命名日志文件
4.  附加数据库（同时附加删除重命名的.ldf（日志文件）。选择它并按删除按钮删除）
5.  将重新创建新的日志文件
6.  删除重命名的日志文件。

这将起作用，但建议先备份您的数据库。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2018-10-17T03:22:28.407

其他一些答案对我不起作用：数据库在线时无法创建检查点，因为事务日志已满（多么讽刺）。但是，将数据库设置为紧急模式后，我能够缩小日志文件：

```
alter database <database_name> set emergency;
use <database_name>;
checkpoint;
checkpoint;
alter database <database_name> set online;
dbcc shrinkfile(<database_name>_log, 200); 
```

* * *

## 回答 #21

> 赞同：-2
> 
> 时间：2011-01-11T10:20:17.640

数据库事务日志**缩小到最小大小**：

1.  备份：事务日志
2.  收缩文件：事务日志
3.  备份：事务日志
4.  收缩文件：事务日志

我对几个数据库进行了测试：**这个序列有效**。

它通常**缩小到 2MB**。

或通过脚本：

```
DECLARE @DB_Name nvarchar(255);
DECLARE @DB_LogFileName nvarchar(255);
SET @DB_Name = '<Database Name>';               --Input Variable
SET @DB_LogFileName = '<LogFileEntryName>';         --Input Variable
EXEC 
(
'USE ['+@DB_Name+']; '+
'BACKUP LOG ['+@DB_Name+'] WITH TRUNCATE_ONLY ' +
'DBCC SHRINKFILE( '''+@DB_LogFileName+''', 2) ' +
'BACKUP LOG ['+@DB_Name+'] WITH TRUNCATE_ONLY ' +
'DBCC SHRINKFILE( '''+@DB_LogFileName+''', 2)'
)
GO 
```

# javascript - 如何获得像 slashdot 的评论过滤菜单这样的固定位置菜单

> ID：56630
> 
> 赞同：3
> 
> 时间：2008-09-11T14:09:01.737
> 
> 标签：javascript, css

Slashdot 有一个小部件，可让您调整评论阈值以过滤掉修改后的评论。如果您滚动到页面顶部，它将在一个位置，并且当您向下滚动时，在某个点，它的原始主页即将滚动离开页面，它将切换到固定位置，并停留在您的屏幕上. （要查看示例，请单击[此处](http://news.slashdot.org/news/08/09/10/2257242.shtml)。）

我的问题是，如何实现向上滚动时将菜单放在一个位置并在用户向下滚动时切换到固定位置的相同效果？我知道这将涉及 CSS 和 javascript 的组合。我不一定要寻找工作代码的完整示例，但我的代码需要经过哪些步骤？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-11T14:51:27.207

好吧，我想通了。我会把它贴在这里，以防它帮助其他人。这个解决方案使用原型和一个内部库，它为我提供了 registerEvent、getElementX 和 getElementY 函数，这些函数可以按照您的想法进行。

```
var MenuManager = Class.create({
    initialize: function initialize(menuElt) {
        this.menu = $(menuElt);
        this.homePosn = { x: getElementX(this.menu), y: getElementY(this.menu) };
        registerEvent(document, 'scroll', this.handleScroll.bind(this));
        this.handleScroll();
    },
    handleScroll: function handleScroll() {
        this.scrollOffset = document.viewport.getScrollOffsets().top;
        if (this.scrollOffset > this.homePosn.y) {
            this.menu.style.position = 'fixed';
            this.menu.style.top = 0;
            this.menu.style.left = this.homePosn.x;
        } else {
            this.menu.style.position = 'absolute';
            this.menu.style.top = null;
            this.menu.style.left = null;
        }
    }
}); 
```

只需使用菜单的 id 调用构造函数，该类将从那里获取它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-24T12:26:38.173

感谢您分享此代码的努力。我做了一些小的改动，使它与当前版本的 Prototype 一起工作。

```
var TableHeaderManager = Class.create({
    initialize: function initialize(headerElt) {
        this.tableHeader = $(headerElt);
        this.homePosn = { x: this.tableHeader.cumulativeOffset()[0], y: this.tableHeader.cumulativeOffset()[1] };
        Event.observe(window, 'scroll', this.handleScroll.bind(this));
        this.handleScroll();
    },
    handleScroll: function handleScroll() {
        this.scrollOffset = document.viewport.getScrollOffsets().top;
        if (this.scrollOffset > this.homePosn.y) {
            this.tableHeader.style.position = 'fixed';
            this.tableHeader.style.top = 0;
            this.tableHeader.style.left = this.homePosn.x;
        } else {
            this.tableHeader.style.position = 'absolute';
            this.tableHeader.style.top = null;
            this.tableHeader.style.left = null;
        }
    }
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-02-09T15:23:19.920

对于一个演示，但不是基于上面的代码结帐：

[固定浮动元素](https://stackoverflow.com/questions/2352896/fixing-tabs-to-the-top-of-the-page-but-underneath-the-header)

# .net - 如何从 prtime 转换为 .net datetime

> ID：56638
> 
> 赞同：0
> 
> 时间：2008-09-11T14:11:35.257
> 
> 标签：.net, firefox, datetime

我想将[PRTime](http://developer.mozilla.org/en/docs/PRTime)格式的数字（一个 64 位整数，表示自 1970 年 1 月 1 日协调世界时 (UTC) 午夜 (00:00:00) 以来的微秒数）转换为`DateTime`.

请注意，这与通常的“自 1970 年 1 月 1 日以来的毫秒数”略有不同

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-11T14:26:12.977

```
Dim prTimeInMillis as UInt64
prTimeInMillis = prTime/1000

dim prDateTime as new DateTime(1970, 1, 1)
prDateTime = prDateTime.AddMilliseconds(prTimeInMillis) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T14:49:48.443

DateTime 有一个构造函数，它采用 Ticks（100 纳秒）。

因此，将您的 prTime 乘以 10 并将其添加到代表 Epoch 时间的刻度数上，您就有了转换。

```
private static DateTime epoch = new DateTime(1970, 1, 1);
private static DateTime ConvertPrTime(long time)
{
    return new DateTime(epoch.Ticks + (time*10), DateTimeKind.Utc);
} 
```

# c# - 加载程序锁定错误

> ID：56642
> 
> 赞同：98
> 
> 时间：2008-09-11T14:12:42.040
> 
> 标签：c#, loaderlock

我正在通过用 C# 编写代码来构建 C++ dll。

我得到一个错误，说

> 检测到 LoaderLock 消息：尝试在 OS Loader 锁内进行托管执行。不要尝试在 DllMain 或图像初始化函数中运行托管代码，因为这样做会导致应用程序挂起。

我尝试搜索此错误的确切含义，但我正在绘制毫无意义的文章，主要是说这只是一个警告，我应该在 Visual Studio 中将其关闭。其他解决方案似乎是由于 iTunes，或者使用 DirectX 编程时出现的这个问题。我的问题与这两个都没有关系。

谁能解释一下，这实际上意味着什么？

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2010-11-04T08:04:27.303

you need to go to menu Debug -> Exceptions, open the Managed Debugging Assistants, find LoaderLock and uncheck

![http://goo.gl/TGAHV](https://i.stack.imgur.com/eRNGy.png)

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2008-09-11T14:18:36.723

加载器锁的一般思想：系统在DllMain中运行代码在一个锁内（如同步锁）。因此，在 DllMain 中运行重要的代码是“要求死锁”，如此[处](https://devblogs.microsoft.com/oldnewthing/20040128-00/?p=40853)所述。

问题是，你为什么要在 DllMain 中运行代码？此代码在 DllMain 的上下文中运行是否至关重要，或者您是否可以生成一个新线程并在其中运行代码，而不是等待代码在 DllMain 中完成执行？

我认为托管代码的问题在于，运行托管代码可能涉及加载 CLR 等，并且不知道那里会发生什么会导致死锁......我不会听从“禁用此警告”的建议“如果我是你，因为大多数情况下你会发现你的应用程序在某些情况下会意外挂起。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2016-03-20T23:29:12.470

### .NET 4.0 和更多最新框架的更新

这是 .Net 2.0 时提出的一个老问题，当时对混合模式 DLL 的支持存在严重的初始化问题，容易出现随机死锁。从 .Net 4.0 开始，混合模式 DLL 的初始化发生了变化。现在有两个独立的初始化阶段：

1.  本机初始化，在 DLL 的入口点调用，包括本机 C++ 运行时设置和 DllMain 方法的执行。
2.  托管初始化，由系统加载程序自动执行。

由于第 2 步是在 Loader Lock 之外执行的，因此没有死锁。详细信息在[混合程序集的初始化中](https://msdn.microsoft.com/en-us/library/ms173266.aspx)进行了描述。

为了确保您的混合模式程序集可以从本机可执行文件加载，您唯一需要检查的是 DllMain 方法是否被声明为本机代码。`#pragma unmanaged`可以在这里提供帮助：

```
#pragma unmanaged

BOOL APIENTRY DllMain(HMODULE hModule,
    DWORD  ul_reason_for_call,
    LPVOID lpReserved
    )
{
    ... // your implementation here
} 
```

同样重要的是，DllMain 可能直接或间接调用的任何代码也是非托管的。限制 DllMain 使用的功能类型是有意义的，因此您可以跟踪从 DllMain 可访问的所有代码，并确保所有代码都使用`#pragma unmanaged`.

如果编译器检测到 DllMain 未声明为非托管，编译器会通过警告 C4747 来帮助您：

```
1>  Generating Code...
1>E:\src\mixedmodedll\dllmain.cpp : warning C4747: Calling managed 'DllMain': Managed code may not be run under loader lock, including the DLL entrypoint and calls reached from the DLL entrypoint 
```

但是，如果 DllMain 间接调用一些其他托管函数，编译器不会生成任何警告，因此您需要确保永远不会发生，否则您的应用程序可能会随机死锁。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-07-18T06:37:09.540

按 ctr d+e 然后展开 Managed Debugging Assistants 节点。然后取消选中LoaderLock。

希望这会帮助你。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2018-05-19T10:44:27.030

温馨提示**VS2017用户**需要禁用“**异常助手**”而不是“**异常助手**”（VS2017之前）以防止加载器锁定错误，设置路径为*Debug->Exception*。刚刚遇到这个问题并浪费了2个小时寻找解决方案......

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2015-07-09T15:41:58.463

我最近在创建用本机代码编写的 COM-Object 实例时遇到了这个错误：

```
m_ComObject = Activator.CreateInstance(Type.GetTypeFromProgID("Fancy.McDancy")); 
```

这导致了所描述的错误。“检测到 LoaderLock”- 抛出异常。

我通过在一个额外的线程中创建对象实例克服了这个错误：

```
ThreadStart threadRef = new ThreadStart(delegate { m_ComObject = Activator.CreateInstance(Type.GetTypeFromProgID("Fancy.McDancy")); });
Thread myThread = new Thread(threadRef);

myThread.Start();
myThread.Join(); // for synchronization 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2016-07-15T13:10:59.143

我正在构建一个 C++ CLR DLL (MSVS2015)，它必须调用非托管 DLL 并定义非托管代码。我使用#pragma managed 和#pragma unmanaged 来控制给定代码区域的模式。

就我而言，我只是将#pragma unmanaged 放在我的 DllMain() 前面，这就解决了问题。它似乎在想我想要一个 DllMain() 的托管版本。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-07-13T00:18:46.637

出现此问题的原因是 Visual Studio 中的调试器运行在一个或多个 DLL 文件中使用 Microsoft 基础类 8.0 版的托管应用程序的方式。

仔细阅读： http: [//msdn.microsoft.com/en-us/library/aa290048 (vs.71).aspx](http://msdn.microsoft.com/en-us/library/aa290048(vs.71).aspx)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2018-10-22T18:11:19.660

我的 Visual Studio 2017 实例中的设置路径是 Debug -> Windows -> Exception Settings 。例外设置“窗口”显示在底部选项卡组中（而不是单独的窗口），我花了一段时间才注意到它。搜索“装载机”。

# windows - 如何检测重启后 Windows 服务器是否可用？

> ID：56644
> 
> 赞同：5
> 
> 时间：2008-09-11T14:14:59.837
> 
> 标签：windows, sysadmin, reboot

我想使用任务计划程序或类似工具自动执行 Windows 2000+ 服务器重新启动过程，以远程重新启动服务器并等待它重新启动。我可以发出`shutdown`或`psshutdown`远程重启，但我想要的东西比`sleep`等待它回来更好。我需要在`n`几分钟内验证它是否重新上线或抛出错误。

通过“重新上线”，我想验证的不仅仅是它可以被 ping 通，还可能是它的 RFC 服务正在响应或其他一些确定的生命体征。

我更喜欢 NT 脚本方法，但我不排除编写自定义工具来执行此操作。

有任何想法吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-29T12:11:41.023

在研究了一段时间后，我想出了以下 VBScript。随意评论/改进。

```
'
' Remotely reboot a server and
' wait for server to come back up.
'
' Usage:  cscript /nologo /E:VBScript RebootWait.vbs <Server Name>
'
' Shawn Poulson, 2008.09.11
'

'
' Get server name from command line
'
If WScript.Arguments.Count <> 1 Then
   ShowUsage()
   WScript.Quit(1)
End If

ServerName = WScript.Arguments(0)

'
' Verify server is currently up
'
WScript.StdOut.WriteLine Now & ": Verify server '" & ServerName & "' is currently up..."
If Not IsAvailable(ServerName) Then
   WScript.StdOut.WriteLine "Error: Server is down.  Reboot aborted!"
   WScript.Quit(1)
End If
WScript.StdOut.WriteLine Now & ": Server is up."

'
' Reboot server
'
WScript.StdOut.WriteLine Now & ": Rebooting server '" & ServerName & "'..."
RebootStatus = RebootServer(ServerName)
If RebootStatus < 0 Then
   WScript.StdOut.WriteLine "Error: Reboot returned error " & RebootStatus
   WScript.Quit(1)
End If
WScript.StdOut.WriteLine Now & ": Reboot command was successful"

'
' Wait for server to come down
'
WScript.StdOut.Write Now & ": Waiting for server '" & ServerName & "' to go down..."
WaitCount = 0
Do While IsAvailable(ServerName)
   WaitCount = WaitCount + 1
   If WaitCount > 60 Then ' 5 min timeout
      WScript.StdOut.WriteLine "Error: Timeout waiting for server to come down!"
      WScript.Quit(1)
   End If
   WScript.StdOut.Write(".")
   WScript.Sleep(5000)
Loop
WScript.StdOut.WriteLine "Success!"
WScript.StdOut.WriteLine Now & ": Server is down."

'
' Wait for server to come back up
'
WScript.StdOut.Write Now & ": Waiting for server '" & ServerName & "' to come back up..."
WaitCount = 0
Do While Not IsAvailable(ServerName)
   WaitCount = WaitCount + 1
   If WaitCount > 240 Then ' 20 min timeout
      WScript.StdOut.WriteLine "Error: Timeout waiting for server to come back up!"
      WScript.Quit(1)
   End If
   WScript.StdOut.Write(".")
   WScript.Sleep(5000)
Loop
WScript.StdOut.WriteLine "Success!"
WScript.StdOut.WriteLine Now & ": Server is back up after reboot."

'
' Success!
'
WScript.Quit(0)

Sub ShowUsage()
   WScript.Echo "Usage: " & WScript.ScriptName & " <Server name>"
End Sub

' Returns:
' 1 = Successfully issued reboot command
' -2 = Could not reach server
' -3 = Reboot command failed
Function RebootServer(ServerName)
   Dim OpSystem
   On Error Resume Next
   For Each OpSystem in GetObject("winmgmts:{(Shutdown)}!\\" & ServerName & "\root\CIMV2").ExecQuery("select * from Win32_OperatingSystem where Primary=true")
      On Error GoTo 0

      If IsObject(OpSystem) Then
         ' Invoke forced reboot
         If OpSystem.Win32Shutdown(6, 0) = 0 Then
            ' Success
            RebootServer = 1
         Else
            ' Command failed
            RebootServer = -3
         End If

      Else
         RebootServer = -2

      End If
   Next
End Function

' Return True if available
Function IsAvailable(ServerName)
   ' Use Windows RPC service state as vital sign
   IsAvailable = (GetServiceState(ServerName, "RpcSs") = "Running")
End Function

' Return one of:
'  Stopped, Start Pending, Stop Pending,
'  Running, Continue Pending, Pause Pending,
'  Paused, Unknown
Function GetServiceState(ServerName, ServiceName)
   Dim Service
   On Error Resume Next
   Set Service = GetObject("winmgmts:\\" & ServerName & "\root\CIMV2:Win32_Service='" & ServiceName & "'")
   On Error GoTo 0
   If IsObject(Service) Then GetServiceState = Service.State
End Function 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-11T14:18:16.613

您的远程重启脚本可以启动服务器，等待 n 分钟，然后查询您的 RFC 服务。您也可以让服务器上的本地脚本执行相同的操作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-11T14:21:57.917

您可以使用[psservice](http://technet.microsoft.com/en-us/sysinternals/default.aspx)来查询 RFC 或 Print Spooler 服务的状态。后台处理程序通常是最后启动的服务之一。您可以使用如下语法：

```
psservice \\someothermachine query spooler 
```

一旦服务运行，这将返回类似的内容。

```
SERVICE_NAME：后台处理程序                                                                             
DISPLAY_NAME：打印后台处理程序                                                                       
管理所有本地和网络打印队列并控制所有打印作业。如果此服务停止
ped，本地机器上的打印将不可用。如果此服务被禁用，任何服务
明确依赖它的将无法启动。                                                  
        组 : 后台处理程序组                                                          
        类型：110 WIN32_OWN_PROCESS INTERACTIVE_PROCESS                             
        状态 : 4 正在运行                                                            
                               (STOPPABLE,NOT_PAUSABLE,ACCEPTS_SHUTDOWN)                          
        WIN32_EXIT_CODE：0 (0x0)                                                              
        SERVICE_EXIT_CODE：0 (0x0)                                                              
        检查点：0x0                                                                   
        等待提示：0x0                                                                   
```

如果另一台机器还没有准备好，你会得到类似的东西

```
无法连接到 \\someothermachine:                                                                  
RPC 服务器不可用。
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T15:37:08.827

使用 VBScript (WSH)，您可以使用 .state 属性对其进行检查。此脚本显示该属性在不同的应用程序中使用，但应该有助于说明这个想法：

[http://www.robvanderwoude.com/vbstech_proc_service.html](http://www.robvanderwoude.com/vbstech_proc_service.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-11T14:23:50.877

您可以轮询一些核心服务以查看它是否已启动：

```
sc "\\server_name" query EventSystem 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-11T14:24:57.037

使用[nmap](http://nmap.org/download.html)获取机器上开放服务的列表并解析结果以确保您需要的服务处于活动状态。确保您*不需要*的东西*不*处于活动状态也很有用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-11T14:41:11.583

这里的关键是我需要编写脚本。有没有更简洁的方法从`psservice`/中提取服务状态`sc query`？我可以将它通过管道传输到`findstr "RUNNING"`，但必须有更好的方法。

# objective-c - 洗牌 NSMutableArray 的最佳方法是什么？

> ID：56648
> 
> 赞同：191
> 
> 时间：2008-09-11T14:16:43.530
> 
> 标签：objective-c, cocoa, shuffle

如果你有一个`NSMutableArray`，你如何随机打乱元素？

（我对此有自己的答案，发布在下面，但我是 Cocoa 的新手，我很想知道是否有更好的方法。）

* * *

更新：正如@Mukesh 所指出的，从 iOS 10+ 和 macOS 10.12+ 开始，有一种`-[NSMutableArray shuffledArray]`方法可用于随机播放。有关详细信息，请参阅[https://developer.apple.com/documentation/foundation/nsarray/1640855-shuffledarray?language=objc](https://developer.apple.com/documentation/foundation/nsarray/1640855-shuffledarray?language=objc)。（但请注意，这会创建一个新数组，而不是在原地打乱元素。）

* * *

## 回答 #1

> 赞同：352
> 
> 时间：2008-09-11T14:20:06.423

我通过向 NSMutableArray 添加一个类别来解决这个问题。

**编辑：**由于 Ladd 的回答，删除了不必要的方法。

**编辑：**更改`(arc4random() % nElements)`为`arc4random_uniform(nElements)`感谢 Gregory Goltsov 的回答以及 miho 和 blahdiblah 的评论

**编辑：**循环改进，感谢 Ron 的评论

**编辑：**添加检查数组不为空，感谢 Mahesh Agrawal 的评论

```
//  NSMutableArray_Shuffling.h

#if TARGET_OS_IPHONE
#import <UIKit/UIKit.h>
#else
#include <Cocoa/Cocoa.h>
#endif

// This category enhances NSMutableArray by providing
// methods to randomly shuffle the elements.
@interface NSMutableArray (Shuffling)
- (void)shuffle;
@end

//  NSMutableArray_Shuffling.m

#import "NSMutableArray_Shuffling.h"

@implementation NSMutableArray (Shuffling)

- (void)shuffle
{
    NSUInteger count = [self count];
    if (count <= 1) return;
    for (NSUInteger i = 0; i < count - 1; ++i) {
        NSInteger remainingCount = count - i;
        NSInteger exchangeIndex = i + arc4random_uniform((u_int32_t )remainingCount);
        [self exchangeObjectAtIndex:i withObjectAtIndex:exchangeIndex];
    }
}

@end 
```

* * *

## 回答 #2

> 赞同：74
> 
> 时间：2008-09-11T21:03:24.333

您不需要 swapObjectAtIndex 方法。[exchangeObjectAtIndex:withObjectAtIndex:](https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSMutableArray_Class/Reference/Reference.html#//apple_ref/occ/instm/NSMutableArray/exchangeObjectAtIndex:withObjectAtIndex:)已经存在。

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2012-06-03T22:34:41.383

由于我还不能发表评论，我想我会做出一个完整的回应。我以多种方式修改了 Kristopher Johnson 对我的项目的实现（确实试图使其尽可能简洁），其中之一是`arc4random_uniform()`因为它避免了[模偏差](https://stackoverflow.com/a/7082580/1226722)。

```
// NSMutableArray+Shuffling.h
#import <Foundation/Foundation.h>

/** This category enhances NSMutableArray by providing methods to randomly
 * shuffle the elements using the Fisher-Yates algorithm.
 */
@interface NSMutableArray (Shuffling)
- (void)shuffle;
@end

// NSMutableArray+Shuffling.m
#import "NSMutableArray+Shuffling.h"

@implementation NSMutableArray (Shuffling)

- (void)shuffle
{
    NSUInteger count = [self count];
    for (uint i = 0; i < count - 1; ++i)
    {
        // Select a random element between i and end of array to swap with.
        int nElements = count - i;
        int n = arc4random_uniform(nElements) + i;
        [self exchangeObjectAtIndex:i withObjectAtIndex:n];
    }
}

@end 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2016-11-15T15:38:37.080

如果你 import `GameplayKit`，有一个`shuffled`API：

[https://developer.apple.com/reference/foundation/nsarray/1640855-shuffled](https://developer.apple.com/reference/foundation/nsarray/1640855-shuffled)

```
let shuffledArray = array.shuffled() 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2015-11-21T07:13:33.197

稍微改进和简洁的解决方案（与最佳答案相比）。

该算法是相同的并且在文献中被描述为“ [Fisher-Yates shuffle](https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle) ”。

在 Objective-C 中：

```
@implementation NSMutableArray (Shuffle)
// Fisher-Yates shuffle
- (void)shuffle
{
    for (NSUInteger i = self.count; i > 1; i--)
        [self exchangeObjectAtIndex:i - 1 withObjectAtIndex:arc4random_uniform((u_int32_t)i)];
}
@end 
```

在 Swift 3.2 和 4.x 中：

```
extension Array {
    /// Fisher-Yates shuffle
    mutating func shuffle() {
        for i in stride(from: count - 1, to: 0, by: -1) {
            swapAt(i, Int(arc4random_uniform(UInt32(i + 1))))
        }
    }
} 
```

在 Swift 3.0 和 3.1 中：

```
extension Array {
    /// Fisher-Yates shuffle
    mutating func shuffle() {
        for i in stride(from: count - 1, to: 0, by: -1) {
            let j = Int(arc4random_uniform(UInt32(i + 1)))
            (self[i], self[j]) = (self[j], self[i])
        }
    }
} 
```

注意：[在 Swift 中更简洁的解决方案可以从 iOS10 使用`GameplayKit`.](https://stackoverflow.com/a/43801201/1033581)

注意：[不稳定洗牌的算法（如果计数> 1，所有位置都强制改变）也可用](https://stackoverflow.com/a/31420827/1033581)

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-08-19T10:39:21.303

这是洗牌 NSArrays 或 NSMutableArrays 的最简单和最快的方法（对象拼图是一个 NSMutableArray，它包含拼图对象。我已添加到拼图对象变量索引，它指示数组中的初始位置）

```
int randomSort(id obj1, id obj2, void *context ) {
        // returns random number -1 0 1
    return (random()%3 - 1);    
}

- (void)shuffle {
        // call custom sort function
    [puzzles sortUsingFunction:randomSort context:nil];

    // show in log how is our array sorted
        int i = 0;
    for (Puzzle * puzzle in puzzles) {
        NSLog(@" #%d has index %d", i, puzzle.index);
        i++;
    }
} 
```

日志输出：

```
 #0 has index #6
 #1 has index #3
 #2 has index #9
 #3 has index #15
 #4 has index #8
 #5 has index #0
 #6 has index #1
 #7 has index #4
 #8 has index #7
 #9 has index #12
 #10 has index #14
 #11 has index #16
 #12 has index #17
 #13 has index #10
 #14 has index #11
 #15 has index #13
 #16 has index #5
 #17 has index #2 
```

您不妨将 obj1 与 obj2 进行比较，并决定要返回的可能值是：

*   NSOrderedAscending = -1
*   NSOrderedSame = 0
*   NSOrderedDescending = 1

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2017-05-05T09:22:34.523

从 iOS 10 开始，您可以使用[GameplayKit中的](https://developer.apple.com/reference/foundation/nsarray/1640855-shuffled)[NSArray`shuffled()`](https://developer.apple.com/reference/foundation/nsarray/1640855-shuffled)。这是 Swift 3 中 Array 的帮助器：

```
import GameplayKit

extension Array {
    @available(iOS 10.0, macOS 10.12, tvOS 10.0, *)
    func shuffled() -> [Element] {
        return (self as NSArray).shuffled() as! [Element]
    }
    @available(iOS 10.0, macOS 10.12, tvOS 10.0, *)
    mutating func shuffle() {
        replaceSubrange(0..<count, with: shuffled())
    }
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-09-13T15:26:48.983

有一个不错的流行库，其中包含此方法，在 GitHub 中称为[SSToolKit](https://github.com/soffes/sstoolkit)。文件 NSMutableArray+SSToolkitAdditions.h 包含 shuffle 方法。你也可以使用它。其中，似乎有很多有用的东西。

这个库的主页在[这里](http://sstoolk.it)。

如果你使用它，你的代码将是这样的：

```
#import <SSCategories.h>
NSMutableArray *tableData = [NSMutableArray arrayWithArray:[temp shuffledArray]]; 
```

这个库也有一个 Pod（参见 CocoaPods）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-03-21T12:36:44.047

如果元素有重复。

例如数组：AAABB 或 BBAAA

唯一的解决方案是：ABABA

`sequenceSelected`是一个 NSMutableArray，它存储类 obj 的元素，这些元素是指向某个序列的指针。

```
- (void)shuffleSequenceSelected {
    [sequenceSelected shuffle];
    [self shuffleSequenceSelectedLoop];
}

- (void)shuffleSequenceSelectedLoop {
    NSUInteger count = sequenceSelected.count;
    for (NSUInteger i = 1; i < count-1; i++) {
        // Select a random element between i and end of array to swap with.
        NSInteger nElements = count - i;
        NSInteger n;
        if (i < count-2) { // i is between second  and second last element
            obj *A = [sequenceSelected objectAtIndex:i-1];
            obj *B = [sequenceSelected objectAtIndex:i];
            if (A == B) { // shuffle if current & previous same
                do {
                    n = arc4random_uniform(nElements) + i;
                    B = [sequenceSelected objectAtIndex:n];
                } while (A == B);
                [sequenceSelected exchangeObjectAtIndex:i withObjectAtIndex:n];
            }
        } else if (i == count-2) { // second last value to be shuffled with last value
            obj *A = [sequenceSelected objectAtIndex:i-1];// previous value
            obj *B = [sequenceSelected objectAtIndex:i]; // second last value
            obj *C = [sequenceSelected lastObject]; // last value
            if (A == B && B == C) {
                //reshufle
                sequenceSelected = [[[sequenceSelected reverseObjectEnumerator] allObjects] mutableCopy];
                [self shuffleSequenceSelectedLoop];
                return;
            }
            if (A == B) {
                if (B != C) {
                    [sequenceSelected exchangeObjectAtIndex:i withObjectAtIndex:count-1];
                } else {
                    // reshuffle
                    sequenceSelected = [[[sequenceSelected reverseObjectEnumerator] allObjects] mutableCopy];
                    [self shuffleSequenceSelectedLoop];
                    return;
                }
            }
        }
    }
} 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2012-04-26T13:42:45.977

```
NSUInteger randomIndex = arc4random() % [theArray count]; 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2014-10-15T11:01:22.227

[Kristopher Johnson 的回答](https://stackoverflow.com/questions/56648/whats-the-best-way-to-shuffle-an-nsmutablearray#56656)非常好，但并非完全随机。

给定一个包含 2 个元素的数组，此函数始终返回反转数组，因为您在其余索引上生成随机范围。一个更准确的`shuffle()`功能就像

```
- (void)shuffle
{
   NSUInteger count = [self count];
   for (NSUInteger i = 0; i < count; ++i) {
       NSInteger exchangeIndex = arc4random_uniform(count);
       if (i != exchangeIndex) {
            [self exchangeObjectAtIndex:i withObjectAtIndex:exchangeIndex];
       }
   }
} 
```

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2015-02-09T16:15:44.167

编辑：**这是不正确的。**出于参考目的，我没有删除此帖子。请参阅有关此方法不正确原因的评论。

这里的简单代码：

```
- (NSArray *)shuffledArray:(NSArray *)array
{
    return [array sortedArrayUsingComparator:^NSComparisonResult(id obj1, id obj2) {
        if (arc4random() % 2) {
            return NSOrderedAscending;
        } else {
            return NSOrderedDescending;
        }
    }];
} 
```

# c# - 如何在 Windows XP Embedded 中从 C# 访问性能计数器？

> ID：56654
> 
> 赞同：1
> 
> 时间：2008-09-11T14:19:35.910
> 
> 标签：c#, .net, windows-xp-embedded

我有一个在 Windows XP 下运行的应用程序，我正在访问处理器和内存性能计数器。当我尝试在 XP Embedded 上运行相同的代码并访问它们时，计数器似乎不存在。它们出现在图像中 - 我可以在 perfmon 中看到它们。这里缺少什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-11T14:35:06.153

您是否添加了所有 WMI 组件？据我所知，您需要所有 WMI 组件才能访问计数器！

> 性能计数器 Windows 管理规范 (WMI) 提供程序组件提供了性能注册表接口和 WMI 接口之间的桥梁。该组件允许 WMI 客户端通过 WMI 脚本访问性能计数器，并允许使用 WMI 构建的管理应用程序访问性能计数器。如果没有这个组件，应用程序必须直接使用注册表接口或性能数据助手接口来访问性能计数器。

感谢 TimK 的链接（[http://msdn.microsoft.com/en-us/library/aa939695.aspx](http://msdn.microsoft.com/en-us/library/aa939695.aspx)）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-12T12:19:45.893

看起来这就是我所缺少的：http: [//msdn.microsoft.com/en-us/library/aa939695.aspx](http://msdn.microsoft.com/en-us/library/aa939695.aspx)

# visual-studio - 调试期间算术下溢或上溢异常

> ID：56655
> 
> 赞同：10
> 
> 时间：2008-09-11T14:19:49.857
> 
> 标签：visual-studio, debugging, exception, random

这是奇怪行为的一天。

我们有一个使用 Delphi 2007 制作的 Win32 项目，它承载 .NET 运行时并调用 .NET 以显示新表单，作为过渡期的一部分。

最近，我们开始在看似随机的位置和代码点遇到异常：算术上溢或下溢。

其中之一的堆栈跟踪如下所示：

```
at System.Windows.Forms.UnsafeNativeMethods.DispatchMessageW(MSG& msg)
at System.Windows.Forms.Application.ComponentManager.System.Windows.Forms.UnsafeNativeMethods.IMsoComponentManager.FPushMessageLoop(Int32 dwComponentID, Int32 reason, Int32 pvLoopData)
at System.Windows.Forms.Application.ThreadContext.RunMessageLoopInner(Int32 reason, ApplicationContext context)
at System.Windows.Forms.Application.ThreadContext.RunMessageLoop(Int32 reason, ApplicationContext context)
at System.Windows.Forms.Application.RunDialog(Form form)
at System.Windows.Forms.Form.ShowDialog(IWin32Window owner)
at System.Windows.Forms.Form.ShowDialog()
at Gatsoft.Gat.UI.Windows.Forms.Remanaging.RemanageForm.DelphiOpenInNewMode(String employeeCode, String departmentCode, DateTime date) in C:\Dev\VS.NET\Gatsoft\Gatsoft.Gat.UI.Windows\Forms\Remanaging\RemanageForm.Delphi.cs:line 67 
```

在 Visual Studio 解决方案中，最外层的类库之一（即，它可以提取所有引用）已经设置了一个特定的调试程序，以 Delphi 项目输出为目标。这允许我们从 Visual Studio 调试 .NET 代码，即使程序的主要部分是用 Delphi 编写的。

该问题仅在从调试器运行时出现，而不是在我们直接运行 exe 文件时（通过资源管理器、快捷方式，甚至是Visual Studio 中的`Ctrl`+ ）。`F5`

机器上显然没有间谍软件（如 this 暗示的那样[）](http://bytes.com/forum/thread106203.html)。

还有什么我们可以检查的吗？

* * *

**编辑：**看起来 .NET 调试器启用了这个 SNaN 标志，而 Delphi 调试器没有。我们将不得不对此进行进一步调查，但现在我将接受[@Lorenzo Boccaccia](https://stackoverflow.com/users/6550/lorenzo-boccaccia)的回答。

## 显然解决了

好的，看起来我们终于解决了这个问题。对于我们的测试人员来说，在没有附加调试器的情况下开始出现问题，因此我们必须优先考虑问题的优先级。

最后，我们发现了有问题的机器的一个常见问题，它们是配备 NVIDIA Quadro NVS 110M 的 Dell Lattitude D620 笔记本电脑，其系统映像中的旧驱动程序用于配置笔记本电脑，早在 2006 年。

我在网上找到了一篇帖子，虽然我在重新启动以更新显示驱动程序时丢失了 url，导致 .NET 服务崩溃，主要是当机器忙于在屏幕上做某事时。重现他的问题的一种方法是打开 C:\ 的命令提示符并执行 a`DIR /S`以强制进行大量屏幕更新，这将触发崩溃。

他也有一个 NVIDIA 视频卡。

我的机器上的问题大约每 2-4 次启动我们的程序就会出现，但在更新视频驱动程序后，我已经成功启动了 123 次，没有任何问题。（顺便说一句，我可以为这些事情推荐[AutoHotKey ）。](http://www.autohotkey.com/)

所以看起来我们找到了罪魁祸首，一个旧的/有缺陷的 NVIDIA 驱动程序。

更新了这个问题，以便将来有人可以节省一些时间。

现在，如果你能原谅我，我要去角落里哭。

## 被诅咒了！

我一定是把它搞砸了。在更新视频驱动程序后，我刚刚发布了上述更新，同事的笔记本电脑就出现了故障。

不过，我很肯定它现在是我们应用程序之外的一个问题，所以只需要弄清楚要更新哪些具体的东西。

* * *

**进一步更新**：好的，我的机器现在显然是固定的，我同事的机器不是这样。到目前为止，我们已经更新了 BIOS、芯片组驱动程序，目前 XP 的 SP3 即将推出。

今晚将进行老化测试，该应用程序将在夜间启动，因为问题在启动期间或第一次执行某些 WinForms .NET 代码时突然出现。这个应用程序主要是一个 Delphi Win32 应用程序，但它承载 .NET 运行时，问题似乎与 .NET 代码有关。当我们“启动”.NET 运行时，问题可能会出现，或者当我们从 Win32 触发第一个 .NET 窗口时，它也会出现。

* * *

从统计学上讲，我现在准备发布此代码。一夜之间，该应用程序已启动 3051 次而没有出现错误，而在我更新视频驱动程序之前，它每 2-4 次崩溃一次。

## 发现（！/？）

这种修复错误的折磨感觉就像去看医生，接下来会发生以下对话：

```
Doc: Does this hurt?
Me: No...
Doc: What about now? 
```

我已经刺激并戳了应用程序，最后我想我已经找到了我们所做的导致这个问题的事情。

在我们的应用程序中，我们托管来自 Delphi 2007 Win32 应用程序的 .NET 运行时，在我们的胶水代码中，我们有以下行（现在）：

```
 rc := CorBindToRuntimeEx('v2.0.50727', 'wks',
  STARTUP_LOADER_OPTIMIZATION_MULTI_DOMAIN or STARTUP_CONCURRENT_GC,
  @clsid, @iid, UnkRuntimeEngine); 
```

中间的两个常量原来只有一个 0，意思是*选择默认值*。这种变化是几个月前引入的，此后问题一直在慢慢蔓延到我们身上。引入此更改是为了鼓励 ANTS 分析器加载我们的 Win32 应用程序 + 托管的 .NET 运行时，以便进行性能分析，而我们当时引入的更改使这项工作发挥了作用。此外，算术上溢/下溢的问题正在慢慢变得更糟，所以我敢打赌，这个问题在更改后的一段时间内都没有出现，因此它与我们所做的任何更改都无关。

此外，由于我们仅（最初）在通过调试器运行时看到了问题，因此我们认为 Visual Studio 和/或 Delphi 有问题。

无论如何，现在从统计上看，在一个屏幕上的浏览器重复由 javascript 触发的上下滚动（显然需要触发错误），然后我已经能够成功启动应用程序 726 次，调用中的值为 0 ，并且它在 17 次中有 5 次崩溃，其中有两个常数。

```
Doc: Does this hurt? 
```

让我们先不要讨论是谁做出了这种改变。我敢肯定罪魁祸首是想匿名...*咳*

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-11T18:43:42.687

如果在启动应用程序后附加调试器，是否还会出现错误？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T22:26:17.793

可以使用信号 nan 支持编译链接 dll 的调试版本，有关此问题的示例，请参见[http://blogs.msdn.com/oldnewthing/archive/2008/07/02/8679191.aspx 。](http://blogs.msdn.com/oldnewthing/archive/2008/07/02/8679191.aspx)

heisenbug 是由未初始化的变量引起的，这里可能有一个链接的 dll 启用了 cpu 的 snan 功能并在返回时忘记禁用它

# svn - 复制受版本控制的目录

> ID：56657
> 
> 赞同：3
> 
> 时间：2008-09-11T14:20:26.203
> 
> 标签：svn, version-control, dvcs, bazaar

我很好奇是否可以复制受版本控制的目录并开始处理两个副本。

我知道它可以从一个 VCS 到另一个不同，但我故意不指定任何 VCS，因为我对不同的情况感到好奇。

我最近在和一位同事谈论在 SVN 中做这件事。我认为应该没问题，但我仍然不能 100% 确定，因为我不知道 SVN 究竟在工作副本中存储了什么。

但是，如果我们谈论 DVCS 世界，事情可能会更加不清楚，因为每个工作副本本身就是一个存储库。现在面临在 bzr 中这样做，我决定提出这个问题。

后期编辑：

有人问我为什么要这么做。这是整个故事：

在 SVN 的情况下，因为不在办公室，与 SVN 服务器的连接非常慢，所以我和我的同事决定只检查一次源并制作本地副本。这就是我们所做的并且效果很好，但我仍然想知道它是否可以保证工作，或者它只是发生了。

在 bzr 案例中，我计划将“主”存储库移动到另一台服务器。所以我想把它复制到那里并开始考虑主仓库。我想最安全的方法是克隆。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-11T17:01:22.620

在 Subversion 中，每个 .svn 文件夹都包含包含文件夹所需的任何内容。由于所有本地路径都存储为相对路径，因此在原始结帐树之外复制整个或部分树时是安全的。他们将继续在新家中工作。

我经常从外面的树干中复制子树，将新副本切换到其他分支/标签，并在“克隆”的本地副本上做任何必要的事情。这样，如果出于任何原因，我需要返回并在后备箱中做某事，我在原始位置有一个未受干扰的后备箱副本。

另一方面，将源代码控制的目录复制**到其他源代码控制的树中是****不安全**的。如果您将覆盖任何 .svn 文件夹，您很可能会损坏您的目标副本。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-11T14:27:01.163

我偶尔在 SVN 中这样做，我没有遇到任何问题。我相信在 SVN 中存储的只是目录的原始状态和指向它来自的存储库目录的指针。

所以基本上它可以像你想象的那样工作。

*   如果 Copy1 中的 File1 更改并且 Copy2 中的 File2 更改两者都可以提交
*   如果 Copy1 中的 File1 更改并且 Copy2 中的 File1 更改，则第二次提交的人将出现错误，并且必须首先更新/合并。

对于那些对我为什么要复制感到好奇的人，我在第一次检查我们的一个较大项目时遇到了通过我们的网络结帐非常慢的问题。相比之下，简单地从另一台计算机复制似乎为我提供了所有相同的好处。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-11T14:29:41.300

在svn中，没问题。您可以像进行第二次结帐一样使用副本。

不过，我建议您只检查第二次。如果您想要一份没有 .svn 文件的副本，svn export 将创建一个。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-16T03:46:57.307

对于 bzr，如果您只是将 .bzr 目录复制到另一个位置，它就可以工作。它不存储有关其所在路径或所在主机的任何信息，因此您可以将其复制到任何地方并期望它可以正常工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-11T14:22:19.460

我建议不要，因为您正在绕过源代码控制机制。

但也许你可以解释“为什么”？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-11T14:23:22.220

您也可以只检查两个工作副本（至少使用 SVN）来表示 work/copy1 和 work/copy2 并并行处理这两个版本。

我想知道您要达到的目的是什么，因为复制可能不是解决问题的最佳方法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-11T14:25:03.573

这将取决于 VCS。我知道在 CVS 中它在每个版本控制的目录中存储（隐藏）目录。当然，这些文件随后会与该目录的任何副本一起复制。

通常情况下，您不想复制那些隐藏文件，因此 rsync 工具附带了一个选项 (-C)，可以像 CVS 一样忽略这些文件。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-11T15:00:28.417

当我从 Visual Studio 中重新组织文件夹布局时，我对 SVN 感到有些头疼。在解决方案中移动的文件夹实际上会移动文件系统中的文件夹，包括隐藏`.svn`文件夹。这会导致提交问题，因为`.svn`数据与旧路径相关联，而我还没有找到重新关联到其新路径的方法。SVN`clean up`运行正常，但没有修复任何问题。SVN`switch`不允许您在移动文件夹后更改它。我只能通过删除`.svn`已移动文件夹及其子文件夹中的所有文件夹，然后重新添加该文件夹来解决此问题。

我在此修复程序中遇到的问题是您丢失了这些文件的版本跟踪，因为 SVN 将其视为全新的。此外，它不会通过存储与先前版本的差异来有效地存储文件内容。

根据 SVN 文档，建议允许`svn`客户端执行所有文件夹移动/创建/删除操作，以使所有内容在下一次提交时保持同步。这在 Visual Studio 中并不总是可以接受的。幸运的是，大多数问题案例都是在提交时发现的，特别是如果您使用 TortoiseSVN。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-11T17:43:08.823

对于 SVN，这通常会像其他人所说的那样工作。

如果你在机器之间复制，你可能会遇到麻烦。例如，如果您使用 file:// 存储库 URL 访问您的 SVN 存储库，那么事情很可能会中断。这同样适用于服务器访问可能不同的 http:// 或 svn:// URL。

为了安全起见，我只想在新地点结账。如果您想在新工作目录中进行大量未提交的更改（通常是个坏主意），则可以使用 rsync 复制源代码，而无需引入 .svn 目录。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2008-09-16T03:54:27.570

在我看来，GIT 也可能满足您的需求，因为您提到断开连接或通过蹩脚的连接。GIT 也有很好的 SVN 支持，所以两者是互补的，你最终会得到一个很好的版本化文件系统。

# html - 如何在 HTML 或 CSS 中指定表格单元格的绝对最小宽度

> ID：56658
> 
> 赞同：51
> 
> 时间：2008-09-11T14:21:32.177
> 
> 标签：html, css, html-table

### 概括

确保表格单元格不能小于某个最小宽度的最佳方法是什么。

### 例子

我想确保表格中的所有单元格相对于表格容器的宽度至少有 100 像素宽。如果有更多可用空间，表格单元格应填充该空间。

### 浏览器兼容性

我可能想找到一个适用的解决方案

*   即 6-8
*   法阵2-3
*   苹果浏览器

按优先顺序。

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2008-09-11T14:22:49.317

这个 CSS 应该足够了：

```
td { min-width: 100px; } 
```

然而，并非所有浏览器都正确地遵守它（min-width 属性）（例如，IE6 非常不喜欢它）。

**编辑：**至于 IE6（及之前）的解决方案，据我所知，没有一个在所有情况下都能可靠工作的解决方案。使用 nowrap HTML 属性并不能真正达到预期的效果，因为这只是防止单元格中的换行符，而不是指定最小宽度。

但是，如果 nowrap 与常规单元格宽度属性一起使用（例如使用 width: 100px），则 100px 将起到最小宽度*的*作用，并且单元格仍会随文本扩展（由于 nowrap）。这是一个不太理想的解决方案，它不能使用 CSS 完全应用，因此，如果您有很多表要应用它，实现起来会很乏味。（当然，如果您想在单元格中使用动态换行符，那么整个替代解决方案都会失败）。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-11T14:31:13.637

另一个**技巧**是旧的 1x1 透明像素技巧。插入一个 1x1 透明 gif 图片，并在图片标签中将其宽度设置为您想要的宽度。这将迫使单元格至少与图像一样宽。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-08-29T03:37:20.953

我知道这是一个老问题，但我想我会分享一些没有提到的东西（虽然概念上很简单..）你可以把 a`<div>`放在桌子里面（在`<td>`'s 或其他东西中）并设置`<div>`到`min-width`. 表格将停在`<div>`'s 宽度处。只是想我会把它扔在那里，以防有人在谷歌上遇到这个问题。另外，我不太确定在 I.E6 中如何处理 min-width 。但这已经包含在另一个答案中。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-06-17T15:59:11.360

我取得了一些成功：

```
 min-width: 193px;
    width:auto !important; 
    _width: 193px;  /* IE6 hack */ 
```

基于 Vatos 的回复和此处的最小高度文章：[http ://www.dustindiaz.com/min-height-fast-hack/](http://www.dustindiaz.com/min-height-fast-hack/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-11T14:23:51.983

这个css属性怎么样

```
min-width: 100px 
```

但如果没记错的话，它在 IE6 中并不真正起作用

如果你不想用css的方式做，我想你可以添加这个属性

```
nowrap="nowrap" 
```

在您的表格数据标签中

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-02-23T22:27:56.370

这是一种用于设置最小宽度和/或最小高度的跨浏览器方式：

```
{
width (or height): auto !important;
width (or height): 200px;
min-width (or min-height): 200px;
} 
```

IE 6 不理解！重要
IE 6 看到宽度/高度：200px（覆盖自动）

其他浏览器理解 min- 和 !important

我不是 100% 熟悉 TD 元素中的宽度行为，但这一切都适用于例如 DIV 标签

顺便提一句：

> 基于 Vatos 的回复和此处的最小高度文章：[http ://www.dustindiaz.com/min-height-fast-hack/](http://www.dustindiaz.com/min-height-fast-hack/)

由于前两行的顺序，这不起作用，它们需要按正确的顺序排列（考虑以上内容）；）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-11T14:45:54.893

IE6 将宽度处理为最小宽度：

```
td {
    min-width: 100px;
    _width: 100px;/* IE6 hack */
} 
```

如果你想让 IE6 像普通浏览器一样处理宽度，给它一个 overflow:visible; （这里不是这样）

# .net - 通过 Web 应用程序创建自定义计数器

> ID：56659
> 
> 赞同：2
> 
> 时间：2008-09-11T14:21:33.753
> 
> 标签：.net

我有一个 .NET 3.5 Web 应用程序，为此我实现了一个名为 CalculationsCounterManager 的类（代码如下）。此类具有一些共享/静态成员，它们管理两个自定义性能计数器的创建和递增，这些计数器监视对 SQL Server 数据库的数据调用。如果计数器不存在，则执行这些数据调用会驱动计数器的创建。当然，通过通过 nUnit GUI 为此类执行的单元测试，一切正常。计数器被创建并递增。

但是，当通过 ASPNET 辅助进程执行相同的代码时，会出现以下错误消息：“请求的注册表访问是不允许的。”。当执行读取以检查计数器类别是否已存在时，此错误发生在 CalculationsCounterManager 类的第 44 行。

有谁知道一种方法可以为工作进程帐户提供足够的特权，以便允许它在生产环境中创建计数器，而不会使服务器面临安全问题？

```
Namespace eA.Analytics.DataLayer.PerformanceMetrics
    ''' <summary>
    ''' Manages performance counters for the calculatioins data layer assembly
    ''' </summary>
    ''' <remarks>GAJ 09/10/08 - Initial coding and testing</remarks>
    Public Class CalculationCounterManager

        Private Shared _AvgRetrieval As PerformanceCounter
        Private Shared _TotalRequests As PerformanceCounter
        Private Shared _ManagerInitialized As Boolean
        Private Shared _SW As Stopwatch

        ''' <summary>
        ''' Creates/recreates the perf. counters if they don't exist
        ''' </summary>
        ''' <param name="recreate"></param>
        ''' <remarks></remarks>
        Public Shared Sub SetupCalculationsCounters(ByVal recreate As Boolean)

            If PerformanceCounterCategory.Exists(CollectionSettings.CalculationMetricsCollectionName) = False Or recreate = True Then

                Dim AvgCalcsProductRetrieval As New CounterCreationData(CounterSettings.AvgProductRetrievalTimeCounterName, _
                                                                        CounterSettings.AvgProductRetrievalTimeCounterHelp, _
                                                                        CounterSettings.AvgProductRetrievalTimeCounterType)

                Dim TotalCalcsProductRetrievalRequests As New CounterCreationData(CounterSettings.TotalRequestsCounterName, _
                                                                                  CounterSettings.AvgProductRetrievalTimeCounterHelp, _
                                                                                  CounterSettings.TotalRequestsCounterType)

                Dim CounterData As New CounterCreationDataCollection()

                ' Add counters to the collection.
                CounterData.Add(AvgCalcsProductRetrieval)
                CounterData.Add(TotalCalcsProductRetrievalRequests)

                If recreate = True Then
                    If PerformanceCounterCategory.Exists(CollectionSettings.CalculationMetricsCollectionName) = True Then
                        PerformanceCounterCategory.Delete(CollectionSettings.CalculationMetricsCollectionName)
                    End If
                End If

                If PerformanceCounterCategory.Exists(CollectionSettings.CalculationMetricsCollectionName) = False Then
                    PerformanceCounterCategory.Create(CollectionSettings.CalculationMetricsCollectionName, CollectionSettings.CalculationMetricsDescription, _
                                                  PerformanceCounterCategoryType.SingleInstance, CounterData)
                End If

            End If

            _AvgRetrieval = New PerformanceCounter(CollectionSettings.CalculationMetricsCollectionName, CounterSettings.AvgProductRetrievalTimeCounterName, False)
            _TotalRequests = New PerformanceCounter(CollectionSettings.CalculationMetricsCollectionName, CounterSettings.TotalRequestsCounterName, False)
            _ManagerInitialized = True

        End Sub

        Public Shared ReadOnly Property CategoryName() As String
            Get
                Return CollectionSettings.CalculationMetricsCollectionName
            End Get
        End Property

        ''' <summary>
        ''' Determines if the performance counters have been initialized
        ''' </summary>
        ''' <value></value>
        ''' <returns></returns>
        ''' <remarks></remarks>
        Public Shared ReadOnly Property ManagerInitializaed() As Boolean
            Get
                Return _ManagerInitialized
            End Get
        End Property

        Public Shared ReadOnly Property AvgRetrieval() As PerformanceCounter
            Get
                Return _AvgRetrieval
            End Get
        End Property

        Public Shared ReadOnly Property TotalRequests() As PerformanceCounter
            Get
                Return _TotalRequests
            End Get
        End Property

        ''' <summary>
        ''' Initializes the Average Retrieval Time counter by starting a stopwatch
        ''' </summary>
        ''' <remarks></remarks>
        Public Shared Sub BeginIncrementAvgRetrieval()

            If _SW Is Nothing Then
                _SW = New Stopwatch
            End If

            _SW.Start()

        End Sub

        ''' <summary>
        ''' Increments the Average Retrieval Time counter by stopping the stopwatch and changing the
        ''' raw value of the perf counter.
        ''' </summary>
        ''' <remarks></remarks>
        Public Shared Sub EndIncrementAvgRetrieval(ByVal resetStopwatch As Boolean, ByVal outputToTrace As Boolean)
            _SW.Stop()
            _AvgRetrieval.RawValue = CLng(_SW.ElapsedMilliseconds)
            If outPutToTrace = True Then
                Trace.WriteLine(_AvgRetrieval.NextValue.ToString)
            End If
            If resetStopwatch = True Then
                _SW.Reset()
            End If
        End Sub

        ''' <summary>
        ''' Increments the total requests counter
        ''' </summary>
        ''' <remarks></remarks>
        Public Shared Sub IncrementTotalRequests()
            _TotalRequests.IncrementBy(1)
        End Sub

        Public Shared Sub DeleteAll()
            If PerformanceCounterCategory.Exists(CollectionSettings.CalculationMetricsCollectionName) = True Then
                PerformanceCounterCategory.Delete(CollectionSettings.CalculationMetricsCollectionName)
            End If
        End Sub

    End Class
End Namespace 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-11T15:03:51.093

是的，这是*不可能的*。如果不对生产环境中的潜在安全/DOS 问题开放服务器，就无法向工作进程添加权限。安装程序（如 MSI）通常以提升的权限运行，并安装/卸载性能计数器类别和计数器以及其他锁定对象。

例如，[Windows Installer XML (WiX) 支持性能计数器](http://wix.sourceforge.net/manual-wix2/perfmon.htm "Windows Installer XML (WiX) 工具集 - 性能计数器 CustomActions")...

# c - 你如何分析你的代码？

> ID：56672
> 
> 赞同：10
> 
> 时间：2008-09-11T14:25:17.987
> 
> 标签：c, profiling

我希望不是每个人都在使用 Rational Purify。

那么当你想测量时你会怎么做：

*   函数花费的时间
*   内存使用峰值
*   代码覆盖率

目前，我们手动进行[使用带有时间戳的日志语句和另一个脚本来解析日志并输出到 excel。呼……）

你会推荐什么？指向工具或任何技术将不胜感激！

编辑：对不起，我没有先指定环境，它是专有移动平台*上的纯 C*

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-04T22:53:26.613

我已经做了很多。如果您有 IDE 或 ICE，[则有一种技术](https://stackoverflow.com/questions/375913/what-can-i-use-to-profile-c-code-in-linux/378024#378024)需要一些手动操作，但不会失败。

警告：现代程序员讨厌这个，我会被否决。他们喜欢他们的工具。但它确实有效，而且您并不总是拥有好的工具。

我假设在您的情况下，代码类似于在计时器上运行的 DSP 或视频，并且必须快速。假设您在每个计时器滴答声中运行的是子程序 A。编写一些测试代码以在一个简单的循环中运行子程序 A，例如 1000 次，或者足够长的时间让您至少等待几秒钟。

在它运行时，用暂停键随机停止它并采样调用堆栈（不仅仅是程序计数器）并记录它。（这是手动部分。）这样做几次，比如 10 次。一次是不够的。

现在寻找堆栈样本之间的共性。寻找至少出现在 2 个样本上的任何指令或调用指令。其中会有很多，但其中一些将在您可以优化的代码中。

这样做，你会得到很好的加速，保证。1000 次迭代将花费更少的时间。

您不需要大量样品的原因是您不是在寻找小东西。就像您在 10 个样本中的 5 个上看到特定的调用指令一样，它大约占总执行时间的 50%。如果您真的想知道，更多样本会更准确地告诉您百分比是多少。如果你像我一样，你只想知道它在哪里，所以你可以修复它，然后继续下一个。

这样做直到你找不到更多可以优化的东西，你将达到或接近你的最高速度。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-11T14:50:10.797

您可能需要不同的工具来进行性能分析和代码覆盖。

对于分析，我更喜欢 MacOSX 上的 Shark。它是免费的，而且非常好。如果您的应用程序是 vanilla C，您应该可以使用它，如果您可以使用 Mac。

对于 Windows 上的分析，您可以使用 LTProf。便宜，但不是很好： [http ://successfulsoftware.net/2007/12/18/optimising-your-application/](http://successfulsoftware.net/2007/12/18/optimising-your-application/)

（我认为微软没有为更便宜的 Visual Studio 版本提供一个像样的分析器，这真的是在自取其辱。）

对于覆盖率，我更喜欢 Windows 上的 Coverage Validator： http: [//successfulsoftware.net/2008/03/10/coverage-validator/](http://successfulsoftware.net/2008/03/10/coverage-validator/) 它实时更新覆盖率。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-11T14:39:47.547

对于复杂的应用程序，我是英特尔[Vtune](http://www.intel.com/cd/software/products/asmo-na/eng/239144.htm)的忠实粉丝。它与检测代码的传统分析器略有不同。它通过对处理器进行采样以查看指令指针每秒 1,000 次的位置来工作。它具有不需要对二进制文件进行任何更改的巨大优势，这通常不会改变您尝试测量的时间。

不幸的是，这对 .net 或 java 没有好处，因为 Vtune 无法像传统代码那样将指令指针映射到符号。

它还允许您测量各种其他以处理器/硬件为中心的指标，例如每条指令的时钟、高速缓存命中/未命中、TLB 命中/未命中等，这让您可以确定为什么某些代码部分的运行时间可能比您想的要长只需检查代码即可。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-11T15:23:30.577

如果你正在做一个“on the metal”嵌入式“C”系统（我不太确定你的帖子中暗示了什么“移动”），那么你通常有某种计时器 ISR，其中很容易采样发生中断的代码地址（通过回溯堆栈或查看链接寄存器或其他方式）。然后以某种粒度/感兴趣范围的组合构建地址直方图是微不足道的。

然后通常不难编造一些代码/脚本/Excel 表的组合，将直方图计数与链接器符号/列表文件中的地址合并，为您提供配置文件信息。

如果您的 RAM 非常有限，收集足够的数据以使其既简单又有用可能会有点痛苦，但您需要告诉我们更多关于您的平台的信息。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-11T14:26:58.857

[nProf](http://nprof.sourceforge.net/Site/Description.html) - 免费，适用于 .NET。

完成工作，至少足以看到 80/20。（20% 的代码，占用 80% 的时间）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-11T14:28:31.770

Windows（.NET 和 Native Exes）：[AQTime](http://www.automatedqa.com/products/aqtime/)是一款物超所值的工具。独立或作为 Visual Studio 插件。

Java：我是[JProfiler](http://www.ej-technologies.com/products/jprofiler/overview.html)的粉丝。同样，可以独立运行或作为 Eclipse（或各种其他 IDE）插件运行。

我相信两者都有试用版。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-12T05:09:43.820

[Google Perftools](http://code.google.com/p/google-perftools/)在这方面非常有用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T19:15:52.910

我在 MSVC 6 和 XP 中使用[devpartner](http://en.wikipedia.org/wiki/DevPartner)

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-09-12T05:50:38.730

如果您的平台是专有操作系统，那么任何工具将如何工作？我认为你现在正在尽你所能

# sql - 有没有办法解析 SQL 查询以提取列名和表名？

> ID：56677
> 
> 赞同：8
> 
> 时间：2008-09-11T14:27:19.260
> 
> 标签：sql, parsing

我在单独的文本文件中有 150 多个 SQL 查询，我需要分析这些查询（只是实际的 SQL 代码，而不是数据结果），以便识别所有使用的列名和表名。最好是每列和表格出现的次数。使用嵌套的 SELECT 语句等编写一个全新的 SQL 解析程序比看起来要复杂得多。

必须有一个程序或代码可以做到这一点（或接近这个），但我还没有找到它。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2010-01-29T18:44:08.817

我实际上最终使用了一个名为 [SQL Pretty Printer](http://www.dpriver.com/pp/sqlformat.htm)的工具。您可以购买桌面版，但我只是使用了免费的在线应用程序。只需将查询复制到文本框中，将输出设置为“列出数据库对象”，然后单击格式化 SQL 按钮。

使用大约 150 个不同（和复杂）的 SQL 查询，它工作得很好。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-11T15:29:15.087

在 MS SQLServer 中使用执行计划报告怎么样？您可以将其保存到一个 xml 文件中，然后可以对其进行解析。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-11T14:31:18.953

您可能想要寻找这样的东西：

[JSqlParser](http://jsqlparser.sourceforge.net "JSqlParser")

它使用 JavaCC 解析查询字符串并将其作为对象图返回。我从来没有使用过它，所以我不能保证它的质量。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-21T19:34:04.803

如果您的应用程序需要这样做，并且可以访问包含表等的数据库，您可以运行类似：

```
SELECT TOP 0 * FROM MY_TABLE 
```

使用 ADO.NET。这将为您提供一个 DataTable 实例，您可以查询其列及其属性。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-11-23T19:15:44.503

请与 antlr 一起...写一个语法 n 按照步骤..在 antlr 站点中给出..最终你会得到 AST（抽象语法树）。对于给定的查询......我们可以遍历它并带来查询中存在的所有表，列......

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-05-25T13:22:36.390

在 DB2 中，您可以在查询中附加如下内容，但 1 是您可以指定的最小值；如果您尝试指定 0，它将引发错误：

`FETCH FIRST 1 ROW ONLY`

# apache-flex - sdk 中是否包含 Flex 调试器？

> ID：56680
> 
> 赞同：6
> 
> 时间：2008-09-11T14:29:34.777
> 
> 标签：apache-flex

我已经编写 Flex 应用程序几个月了，幸运的是，到目前为止还不需要完整的调试器，到目前为止，我只使用了几个 Alert 框...

免费的 Flex SDK 中是否包含可用的调试器？我没有使用 FlexBuilder（我一直在使用 Emacs 并使用 ant 进行编译）。

如果没有，您如何在没有 FlexBuilder 的情况下调试 Flex 应用程序？（注意：我无意使用 flexbuilder）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-11T15:39:48.290

`fdb`Flex SDK 中包含一个名为的调试器。以下是有关如何使用它的一些文档：

*   [Adobe DevCenter：调试 Flex 应用程序中的客户端代码](http://www.adobe.com/devnet/flex/articles/client_debug_08.html)
*   [Flex 3 帮助：使用命令行调试器](http://livedocs.adobe.com/flex/3/html/help.html?content=debugging_01.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T15:36:40.547

在使用 ActionScript 进行编程并且必须在浏览器上对其进行测试时，我遇到了同样的问题。试试[这个](http://www.flex888.com/649/debugging-flex-with-thunderbolt.html)。它涉及使用 Firefox（我相信你会这样做）和 FireBug 来接收调试消息。

# c++ - 如何查看目录的子文件是否已更改

> ID：56682
> 
> 赞同：7
> 
> 时间：2008-09-11T14:30:19.270
> 
> 标签：c++, windows, filesystems, ntfs

在 Windows 中，是否有一种简单的方法来判断文件夹是否有已更改的子文件？

我验证了，当子文件更改时，文件夹上的最后修改日期不会更新。

我可以设置一个注册表项来修改此行为吗？

如果重要的话，我使用的是 NTFS 卷。

我最终希望从 C++ 程序中获得这种能力。

**递归扫描整个目录对我不起作用，因为该文件夹太大了。**

**更新：我真的需要一种方法来做到这一点，而无需在更改发生时运行进程。所以安装文件系统观察器对我来说不是最佳选择。**

**Update2：存档位也将不起作用，因为它与上次修改日期有相同的问题。将设置文件的存档位，但不会设置文件夹。**

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-11T14:54:57.993

这篇[文章](http://msdn.microsoft.com/en-us/library/aa365261(VS.85).aspx) 应该有所帮助。基本上，您创建一个或多个通知对象，例如：

```
处理 dwChangeHandles[2];
dwChangeHandles[0] = FindFirstChangeNotification(
      lpDir, // 观察目录
      FALSE, // 不看子树
      FILE_NOTIFY_CHANGE_FILE_NAME); // 观察文件名变化

   如果（dwChangeHandles[0] == INVALID_HANDLE_VALUE）
   {
     printf("\n 错误：FindFirstChangeNotification 函数失败。\n");
     ExitProcess(GetLastError());
   }

// 观察子树目录的创建和删除。  
   dwChangeHandles[1] = FindFirstChangeNotification(
      lpDrive, // 观看的目录
      TRUE, // 观察子树
      FILE_NOTIFY_CHANGE_DIR_NAME); // 观察目录名称变化

   if (dwChangeHandles[1] == INVALID_HANDLE_VALUE)
   {
     printf("\n 错误：FindFirstChangeNotification 函数失败。\n");
     ExitProcess(GetLastError());
   }

```

然后等待通知：

```
而（真）
   {
   // 等待通知。
      printf("\n等待通知...\n");

      DWORD dwWaitStatus = WaitForMultipleObjects(2, dwChangeHandles,
         错误，无限）；

      开关（dwWaitStatus）
      {
         案例 WAIT_OBJECT_0：

         // 在目录中创建、重命名或删除文件。
         // 重启通知。
             if ( FindNextChangeNotification(dwChangeHandles[0]) == FALSE )
             {
               printf("\n 错误：FindNextChangeNotification 函数失败。\n");
               ExitProcess(GetLastError());
             }
             休息;

         案例 WAIT_OBJECT_0 + 1：

         // 重启通知。
             if (FindNextChangeNotification(dwChangeHandles[1]) == FALSE)
             {
               printf("\n 错误：FindNextChangeNotification 函数失败。\n");
               ExitProcess(GetLastError());
             }
             休息;

         案例WAIT_TIMEOUT：

         // 发生超时。如果其他一些价值会发生这种情况
         // 而不是在等待调用中使用 INFINITE 并且不会发生任何更改。
         // 在单线程环境中，您可能不需要
         // 无限等待。

            printf("\n超时时间没有变化。\n");
            休息;

         默认：
            printf("\n 错误：未处理的 dwWaitStatus.\n");
            ExitProcess(GetLastError());
            休息;
      }
   }
}

```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-02T20:11:42.213

这可能是矫枉过正，但MS的[IFS 套件或 OSR 的](http://www.microsoft.com/whdc/devtools/ifskit/default.mspx)[FDDK](http://www.osr.com/toolkits_fddk.shtml)可能是一个替代方案。创建您自己的文件系统过滤器驱动程序，对文件系统的所有更改进行简单监控。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-03T20:45:39.313

[读取目录更改W](http://msdn.microsoft.com/en-us/library/aa365465%28VS.85%29.aspx)

[这篇 CodeProject 文章](http://www.codeproject.com/KB/files/directorychangewatcher.aspx)中的一些优秀示例代码

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T14:35:05.403

如果您在更改发生时无法运行进程，那么除了扫描文件系统并检查修改日期/时间之外，您无能为力。但是，这需要您存储每个文件的最后日期/时间并进行比较。

[您可以通过使用存档位](http://en.wikipedia.org/wiki/Archive_bit)来加快速度（尽管它可能会弄乱您的备份软件，因此请谨慎操作）。

> 存档位是存在于许多计算机文件系统中的文件属性，特别是 FAT、FAT32 和 NTFS。归档位的目的是跟踪文件的增量更改以进行备份，也称为归档。
> 
> 由于归档位是二进制位，它要么是 1 要么是 0，或者在这种情况下更频繁地称为设置 (1) 和清除 (0)。每当文件被创建、移动、重命名或以任何方式修改时，操作系统都会设置存档位。因此，归档位表示自上次备份以来的两种状态之一：“已更改”和“未更改”。
> 
> 归档位不受简单地读取文件的影响。复制文件时，原始文件的存档位不受影响，但副本的存档位将在制作副本时设置。

所以这个过程是：

1.  清除所有文件的存档位
2.  让文件系统随时间变化
3.  扫描所有文件 - 任何设置了存档位的文件都已更改

这将消除您的程序保持状态的需要，并且由于您只检查目录条目（存储位的位置）并且它们是集群的，因此它应该非常非常快。

但是，如果您可以在更改期间运行进程，那么您将需要查看[FileSystemWatcher](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher(VS.80).aspx)类。这是一个如何使用它的[示例。](http://msdn.microsoft.com/en-us/library/chzww271(VS.80).aspx)

它也存在于[.NET](https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-6165137.html)中（对于此类问题的未来搜索者）

也许您可以让机器上运行一个进程来监视更改并创建一个文件供您稍后阅读。

-亚当

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-11T16:17:26.140

也许您可以将 NTFS 5 Change Journal 与 DeviceIoControl 一起使用，如此[处所述](http://www.microsoft.com/msj/0999/journal/journal.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-11T14:36:28.240

如果您不反对使用 .NET，那么[FileSystemWatcher](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx)类会很容易地为您处理这个问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-11T14:39:32.977

没有什么容易的 - 如果您有一个正在运行的应用程序，您可以按照其他答案的建议使用 Win32 文件更改通知 API (FindFirstChangeNotification)。警告：大约 2000 年 Trend Micro 实时病毒扫描程序会将更改组合在一起，因此在请求文件系统更改列表时需要使用非常大的缓冲区。

如果您没有正在运行的应用程序，您可以打开 ntfs 日志并扫描日志以查找更改[http://msdn.microsoft.com/en-us/library/aa363798(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa363798(VS.85).aspx)但这可以是当更改的数量大于文件的数量时，比扫描整个目录要慢。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-11T14:51:43.773

从有人提到的双重帖子中：WMI Event Sink

不过仍在寻找更好的答案。

# windows - 如何摆脱 Windows 更新重启提示？

> ID：56684
> 
> 赞同：13
> 
> 时间：2008-09-11T14:30:41.467
> 
> 标签：windows, windows-vista, windows-update

我希望 Windows Update 自动下载并在我的 Vista 机器上安装更新，但是我不想被系统托盘重新启动提示所困扰（最多只能推迟 4 小时）。

我已经执行了[这里](http://www.howtogeek.com/howto/windows-vista/prevent-windows-update-from-forcibly-rebooting-your-computer/)描述的注册表黑客，以防止 Windows 强行重启我的机器，这是一个好的开始。但是，有什么办法可以完全摆脱重启提示，或者降低它们的频率？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-11T14:43:15.400

不确定 vista 是否相同，但值得一试。

在 Windows XP 上，您可以修改组策略设置以更改它重新提示您的频率。（开始 -> 运行类型 gpedit.msc）

查看计算机配置/管理模板/Windows 组件/Windows 更新

您需要的设置称为 Re-Prompt for restart with scheduled installations。默认值为 10 分钟。

您还可以尝试修改在同一位置找到的计划的自动更新安装不自动重新启动设置。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-11T14:32:56.377

只需关闭自动更新服务。下次重新启动时它将重新启动，因此您仍然可以完成更新。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-11T14:34:04.893

在命令窗口中运行它会停止它，直到下次重新启动。

```
 sc stop wuauserv 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-11T16:40:27.193

我建议禁用自动更新。

作为开发人员，您需要做的最后一件事是对工作站进行随机更新，尤其是在您工作时。我每个月都留出时间手动完成这个过程。如果我正在测试一些非常重要的东西或即将截止日期，我会避免这样做。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-11T15:24:16.130

澄清[ehogue](https://stackoverflow.com/users/4137/ehogue)所说的：开始->控制面板->管理工具->服务->自动更新->右键单击->停止。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-11T16:16:12.680

在 Windows XP 中，Windows 更新后，我使用以下技巧：运行此命令

```
pssuspend wuauclt

```

[pssuspend](http://technet.microsoft.com/en-us/sysinternals/bb897540.aspx)是一个免费的系统内部工具。

这样，您将不会被提示重新启动。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-12T01:07:11.127

我会冒着投反对票的风险说：这似乎有点精神分裂，尽管很多人都要求这样做。

如果您希望 Windows 下载并安装更新，但**不**通过重新启动完成安装过程 - 有什么意义？为什么不首先简单地打开 AutoUpdates 呢？如果您甚至不希望操作系统告诉您它想要重新启动，那么您怎么知道您需要重新启动？

需要重新启动的补丁在重新**启动完成之前不会完全激活**；因此，您的系统仍然容易受到未修补行为的影响。如果你是一个上厕所或吃饭的人，我只是不明白想要修补然后推迟几天、几周、几个月的戒色的心态。最好保持不打补丁！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-04-16T15:45:28.720

只需打开任务管理器并右键单击“wuauclt.exe” en clcik 停止或删除或应该阻止该程序运行的东西。

# java - 如何确保 RMI 仅使用一组特定的端口？

> ID：56687
> 
> 赞同：10
> 
> 时间：2008-09-11T14:31:47.317
> 
> 标签：java, rmi

在我们的应用程序中，我们以非常不同的方式使用 RMI 进行客户端-服务器通信：

1.  将数据从服务器推送到客户端进行显示。
2.  将控制信息从客户端发送到服务器。
3.  来自从服务器返回到客户端的控制消息代码路径的回调（边栏注释 - 这是一些遗留代码的副作用，不是我们的长期意图）。

我们想要做的是确保我们所有与 RMI 相关的代码将仅使用已知的指定端口清单。这包括注册表端口（通常预期为 1099）、服务器端口和回调产生的任何端口。

这是我们已经知道的：

1.  LocateRegistry.getRegistry(1099) 或 Locate.createRegistry(1099) 将确保注册表正在侦听 1099。
2.  使用带有端口参数的 UnicastRemoteObject 构造函数/exportObject 静态方法将指定服务器端口。

[这篇Sun 论坛帖子](http://forums.sun.com/thread.jspa?threadID=370039&messageID=1566073)也介绍了这些要点。

我们不知道的是：我们如何确保由回调产生的客户端连接回服务器只会连接到指定端口而不是默认连接到匿名端口？

编辑：添加了一个冗长的答案，总结了我的发现以及我们如何解决问题。希望这将帮助其他有类似问题的人。

第二次编辑：事实证明，在我的应用程序中，我创建和修改套接字工厂时似乎存在竞争条件。我曾希望允许用户在 Beanshell 脚本中覆盖我的默认设置。可悲的是，在工厂创建第一个套接字之后，我的脚本似乎正在显着运行。结果，我从一组默认值和用户设置中获得了混合端口。需要做更多的工作，这超出了这个问题的范围，但我想我会指出它是其他可能不得不在某些时候踏入这些水域的人的兴趣点......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-11T14:36:40.987

您可以使用自定义 RMI 套接字工厂来完成此操作。

套接字工厂为 RMI 创建了在客户端和服务器端都使用的套接字，因此如果您自己编写，您就可以完全控制所使用的端口。客户端工厂在服务器上创建，序列化，然后发送到客户端，这非常简洁。

[这是 Sun 的指南，告诉您如何操作。](http://docs.oracle.com/javase/7/docs/technotes/guides/rmi/socketfactory/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2016-05-20T22:25:28.773

为此，您不需要套接字工厂，甚至不需要多个端口。如果您从服务器 JVM 启动 Registry，您可以使用端口 1099 进行所有操作，实际上这就是默认情况下会发生的情况。如果您根本没有启动注册表，就像在客户端回调对象中一样，您可以在导出它时提供端口 1099。

您关于“由回调产生的客户端连接回服务器”的问题部分没有意义。它们与原始客户端到服务器的连接没有什么不同，它们将使用相同的服务器端口。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-19T19:39:28.583

下面的长答案总结：为了解决我遇到的问题（限制 RMI 连接两端的服务器和回调端口），我需要创建两对客户端和服务器套接字工厂。

更长的答案随之而来：

我们对回调问题的解决方案基本上包括三个部分。第一个是对象包装，它需要能够指定它是用于客户端到服务器的连接还是用于服务器到客户端的回调。使用扩展`UnicastRemoteObject`使我们能够指定我们想要使用的客户端和服务器套接字工厂。但是，锁定套接字工厂的最佳位置是在远程对象的构造函数中。

```
public class RemoteObjectWrapped extends UnicastRemoteObject {
// ....
private RemoteObjectWrapped(final boolean callback) throws RemoteException {
  super((callback ? RemoteConnectionParameters.getCallbackPort() : RemoteConnectionParameters.getServerSidePort()),
        (callback ? CALLBACK_CLIENT_SOCKET_FACTORY : CLIENT_SOCKET_FACTORY),
        (callback ? CALLBACK_SERVER_SOCKET_FACTORY : SERVER_SOCKET_FACTORY));
}
// ....
} 
```

因此，第一个参数指定对象期望请求的部分，而第二个和第三个参数指定将在驱动此远程对象的连接的任一端使用的套接字工厂。

由于我们想限制连接使用的端口，我们需要扩展 RMI 套接字工厂并锁定端口。以下是我们的服务器和客户端工厂的一些草图：

```
public class SpecifiedServerSocketFactory implements RMIServerSocketFactory {
/** Always use this port when specified. */
private int serverPort;
/**
 * @param ignoredPort This port is ignored.  
 * @return a {@link ServerSocket} if we managed to create one on the correct port.
 * @throws java.io.IOException
 */
@Override
public ServerSocket createServerSocket(final int ignoredPort) throws IOException {
    try {
        final ServerSocket serverSocket = new ServerSocket(this.serverPort);
        return serverSocket;
    } catch (IOException ioe) {
        throw new IOException("Failed to open server socket on port " + serverPort, ioe);
    }
}
// ....
} 
```

请注意，上面的服务器套接字工厂确保只有您之前指定的端口才会被该工厂使用。客户端套接字工厂必须与适当的套接字工厂配对（否则您将永远无法连接）。

```
public class SpecifiedClientSocketFactory implements RMIClientSocketFactory, Serializable {
/** Serialization hint */
public static final long serialVersionUID = 1L;
/** This is the remote port to which we will always connect. */
private int remotePort;
/** Storing the host just for reference. */
private String remoteHost = "HOST NOT YET SET";
// ....
/**
 * @param host The host to which we are trying to connect
 * @param ignoredPort This port is ignored.  
 * @return A new Socket if we managed to create one to the host.
 * @throws java.io.IOException
 */
@Override
public Socket createSocket(final String host, final int ignoredPort) throws IOException {
    try {
        final Socket socket = new Socket(host, remotePort);
        this.remoteHost = host;
        return socket;
    } catch (IOException ioe) {
        throw new IOException("Failed to open a socket back to host " + host + " on port " + remotePort, ioe);
    }
}
// ....
} 
```

因此，唯一要强制您的双向连接保持在同一组端口上的是一些逻辑来识别您正在回调客户端。在这种情况下，只需确保远程对象的工厂方法调用 RemoteObjectWrapper 构造函数，并将回调参数设置为 true。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-16T14:25:23.513

我在使用客户端回调实现 RMI 服务器/客户端架构时遇到了各种问题。我的情况是服务器和客户端都在防火墙/NAT 后面。最后，我得到了一个完整的工作实施。以下是我做的主要事情：

## 服务器端，本地 IP：192.168.1.10。公共（互联网）IP 80.80.80.10

在防火墙/路由器/本地服务器 PC 上打开端口 6620。在防火墙/路由器/本地服务器 PC 上打开端口 1099。在路由器/NAT 上将端口 6620 上的传入连接重定向到 192.168.1.10:6620 在路由器/NAT 上重定向传入端口 1099 到 192.168.1.10:1099 的连接

在实际程序中：

```
System.getProperties().put("java.rmi.server.hostname", IP 80.80.80.10);
MyService rmiserver = new MyService();
MyService stub = (MyService) UnicastRemoteObject.exportObject(rmiserver, 6620);
LocateRegistry.createRegistry(1099);
Registry registry = LocateRegistry.getRegistry();
registry.rebind("FAManagerService", stub); 
```

## 客户端，本地 IP：10.0.1.123 公共（互联网）IP 70.70.70.20

在防火墙/路由器/本地服务器 PC 上打开端口 1999。在路由器/NAT 上，将端口 1999 上的传入连接重定向到 10.0.1.123:1999

在实际程序中：

```
System.getProperties().put("java.rmi.server.hostname", 70.70.70.20);
UnicastRemoteObject.exportObject(this, 1999);
MyService server = (MyService) Naming.lookup("rmi://" + serverIP + "/MyService "); 
```

希望这可以帮助。伊拉克利斯

# c# - 随机加权选择

> ID：56692
> 
> 赞同：65
> 
> 时间：2008-09-11T14:34:11.053
> 
> 标签：c#, algorithm, random

考虑下面代表代理的类：

```
public class Broker
{
    public string Name = string.Empty;
    public int Weight = 0;

    public Broker(string n, int w)
    {
        this.Name = n;
        this.Weight = w;
    }
} 
```

我想从数组中随机选择一个经纪人，考虑到他们的权重。

你觉得下面的代码怎么样？

```
class Program
    {
        private static Random _rnd = new Random();

        public static Broker GetBroker(List<Broker> brokers, int totalWeight)
        {
            // totalWeight is the sum of all brokers' weight

            int randomNumber = _rnd.Next(0, totalWeight);

            Broker selectedBroker = null;
            foreach (Broker broker in brokers)
            {
                if (randomNumber <= broker.Weight)
                {
                    selectedBroker = broker;
                    break;
                }

                randomNumber = randomNumber - broker.Weight;
            }

            return selectedBroker;
        }

        static void Main(string[] args)
        {
            List<Broker> brokers = new List<Broker>();
            brokers.Add(new Broker("A", 10));
            brokers.Add(new Broker("B", 20));
            brokers.Add(new Broker("C", 20));
            brokers.Add(new Broker("D", 10));

            // total the weigth
            int totalWeight = 0;
            foreach (Broker broker in brokers)
            {
                totalWeight += broker.Weight;
            }

            while (true)
            {
                Dictionary<string, int> result = new Dictionary<string, int>();

                Broker selectedBroker = null;

                for (int i = 0; i < 1000; i++)
                {
                    selectedBroker = GetBroker(brokers, totalWeight);
                    if (selectedBroker != null)
                    {
                        if (result.ContainsKey(selectedBroker.Name))
                        {
                            result[selectedBroker.Name] = result[selectedBroker.Name] + 1;
                        }
                        else
                        {
                            result.Add(selectedBroker.Name, 1);
                        }
                    }
                }

                Console.WriteLine("A\t\t" + result["A"]);
                Console.WriteLine("B\t\t" + result["B"]);
                Console.WriteLine("C\t\t" + result["C"]);
                Console.WriteLine("D\t\t" + result["D"]);

                result.Clear();
                Console.WriteLine();
                Console.ReadLine();
            }
        }
    } 
```

我没那么自信。当我运行这个时，经纪人 A 总是比经纪人 D 获得更多的命中，并且它们具有相同的权重。

有没有更准确的算法？

谢谢！

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-09-11T14:45:27.440

你的算法几乎是正确的。但是，测试应该`<`代替`<=`：

```
if (randomNumber < broker.Weight) 
```

这是因为 0 包含在随机数中，而 0`totalWeight`是排除的。换句话说，权重为 0 的经纪人仍然有很小的机会被选中——根本不是你想要的。这说明经纪人 A 的点击次数比经纪人 D 多。

除此之外，您的算法很好，实际上是解决此问题的规范方法。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2012-08-13T08:47:04.360

可以用于任何数据类型的更通用的东西怎么样？

```
using System;
using System.Linq;
using System.Collections;
using System.Collections.Generic;

public static class IEnumerableExtensions {

    public static T RandomElementByWeight<T>(this IEnumerable<T> sequence, Func<T, float> weightSelector) {
        float totalWeight = sequence.Sum(weightSelector);
        // The weight we are after...
        float itemWeightIndex =  (float)new Random().NextDouble() * totalWeight;
        float currentWeightIndex = 0;

        foreach(var item in from weightedItem in sequence select new { Value = weightedItem, Weight = weightSelector(weightedItem) }) {
            currentWeightIndex += item.Weight;

            // If we've hit or passed the weight we are after for this item then it's the one we want....
            if(currentWeightIndex >= itemWeightIndex)
                return item.Value;

        }

        return default(T);

    }

} 
```

只需致电

```
 Dictionary<string, float> foo = new Dictionary<string, float>();
    foo.Add("Item 25% 1", 0.5f);
    foo.Add("Item 25% 2", 0.5f);
    foo.Add("Item 50%", 1f);

    for(int i = 0; i < 10; i++)
        Console.WriteLine(this, "Item Chosen {0}", foo.RandomElementByWeight(e => e.Value)); 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2010-10-10T10:13:47.880

```
class Program
{
    static void Main(string[] args)
    {
        var books = new List<Book> {
        new Book{Isbn=1,Name="A",Weight=1},
        new Book{Isbn=2,Name="B",Weight=100},
        new Book{Isbn=3,Name="C",Weight=1000},
        new Book{Isbn=4,Name="D",Weight=10000},
        new Book{Isbn=5,Name="E",Weight=100000}};

        Book randomlySelectedBook = WeightedRandomization.Choose(books);
    }
}

public static class WeightedRandomization
{
    public static T Choose<T>(List<T> list) where T : IWeighted
    {
        if (list.Count == 0)
        {
            return default(T);
        }

        int totalweight = list.Sum(c => c.Weight);
        Random rand = new Random();
        int choice = rand.Next(totalweight);
        int sum = 0;

        foreach (var obj in list)
        {
            for (int i = sum; i < obj.Weight + sum; i++)
            {
                if (i >= choice)
                {
                    return obj;
                }
            }
            sum += obj.Weight;
        }

        return list.First();
    }
}

public interface IWeighted
{
    int Weight { get; set; }
}

public class Book : IWeighted
{
    public int Isbn { get; set; }
    public string Name { get; set; }
    public int Weight { get; set; }
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2015-06-19T22:29:11.570

由于这是 Google 上的最高结果：

我[为随机选择的加权项目创建了一个 C# 库](https://github.com/BlueRaja/Weighted-Item-Randomizer-for-C-Sharp)。

*   它实现了树选择和 walker 别名方法算法，为所有用例提供最佳性能。
*   它经过单元测试和优化。
*   它具有 LINQ 支持。
*   它是免费和开源的，在 MIT 许可下获得许可。

一些示例代码：

```
IWeightedRandomizer<string> randomizer = new DynamicWeightedRandomizer<string>();
randomizer["Joe"] = 1;
randomizer["Ryan"] = 2;
randomizer["Jason"] = 2;

string name1 = randomizer.RandomWithReplacement();
//name1 has a 20% chance of being "Joe", 40% of "Ryan", 40% of "Jason"

string name2 = randomizer.RandomWithRemoval();
//Same as above, except whichever one was chosen has been removed from the list. 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-11T20:15:02.687

在通过内存使用情况下选择代理时，替代方法有利于速度。基本上，我们创建的列表包含与指定权重相同数量的代理实例引用。

```
List<Broker> brokers = new List<Broker>();
for (int i=0; i<10; i++)
    brokers.Add(new Broker("A", 10));
for (int i=0; i<20; i++)
    brokers.Add(new Broker("B", 20));
for (int i=0; i<20; i++)
    brokers.Add(new Broker("C", 20));
for (int i=0; i<10; i++)
    brokers.Add(new Broker("D", 10)); 
```

然后，选择一个随机加权的实例是一个 O(1) 操作：

```
int randomNumber = _rnd.Next(0, brokers.length);
selectedBroker = brokers[randomNumber]; 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2020-04-02T15:36:52.370

有点太晚了，但这里是 C#7 示例。它非常小并且可以提供正确的分布。

```
public static class RandomTools
{
    public static T PickRandomItemWeighted<T>(IList<(T Item, int Weight)> items)
    {
        if ((items?.Count ?? 0) == 0)
        {
            return default;
        }

        int offset = 0;
        (T Item, int RangeTo)[] rangedItems = items
            .OrderBy(item => item.Weight)
            .Select(entry => (entry.Item, RangeTo: offset += entry.Weight))
            .ToArray();

        int randomNumber = new Random().Next(items.Sum(item => item.Weight)) + 1;
        return rangedItems.First(item => randomNumber <= item.RangeTo).Item;
    }
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-12T01:32:54.713

如果您想要更快的速度，您可以考虑加权水库采样，您不必提前找到总重量（但您可以更频繁地从随机数生成器中采样）。代码可能看起来像

```
Broker selected = null;
int s = 0;
foreach(Broker broker in brokers) {
    s += broker.Weight;
    if (broker.Weight <= _rnd.Next(0,s)) {
        selected = broker;
    }
} 
```

这需要通过列表经纪人一次。但是，如果经纪人列表是固定的或不经常更改，您可以保留一个累积和数组，即 A[i] 是所有经纪人的权重总和 0,..,i-1。那么 A[n] 是总权重，如果你选择一个介于 1 和 A[n-1] 之间的数字，比如说 x，你会找到经纪人 j st A[j-1] <= x < A[j]。为方便起见，您让 A[0] = 0。您可以使用二进制搜索在 log(n) 步中找到这个经纪人编号 j，我将把代码留作一个简单的练习。如果您的数据经常更改，这可能不是一个好方法，因为每次一些权重更改时，您可能需要更新数组的大部分。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-01-03T23:25:38.670

我想出了这个解决方案的通用版本：

```
public static class WeightedEx
{
    /// <summary>
    /// Select an item from the given sequence according to their respective weights.
    /// </summary>
    /// <typeparam name="TItem">Type of item item in the given sequence.</typeparam>
    /// <param name="a_source">Given sequence of weighted items.</param>
    /// <returns>Randomly picked item.</returns>
    public static TItem PickWeighted<TItem>(this IEnumerable<TItem> a_source)
        where TItem : IWeighted
    {
        if (!a_source.Any())
            return default(TItem);

        var source= a_source.OrderBy(i => i.Weight);

        double dTotalWeight = source.Sum(i => i.Weight);

        Random rand = new Random();

        while (true)
        {
            double dRandom = rand.NextDouble() * dTotalWeight;

            foreach (var item in source)
            {
                if (dRandom < item.Weight)
                    return item;

                dRandom -= item.Weight;
            }
        }
    }
}

/// <summary>
/// IWeighted: Implementation of an item that is weighted.
/// </summary>
public interface IWeighted
{
    double Weight { get; }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-05-11T22:50:02.963

只是为了分享我自己的实现。希望你会发现它有用。

```
 // Author: Giovanni Costagliola <giovanni.costagliola@gmail.com>

    using System;
    using System.Collections.Generic;
    using System.Linq;

    namespace Utils
    {
    /// <summary>
    /// Represent a Weighted Item.
    /// </summary>
    public interface IWeighted
    {
        /// <summary>
        /// A positive weight. It's up to the implementer ensure this requirement
        /// </summary>
        int Weight { get; }
    }

    /// <summary>
    /// Pick up an element reflecting its weight.
    /// </summary>
    /// <typeparam name="T"></typeparam>
    public class RandomWeightedPicker<T> where T:IWeighted
    {
        private readonly IEnumerable<T> items;
        private readonly int totalWeight;
        private Random random = new Random();

        /// <summary>
        /// Initiliaze the structure. O(1) or O(n) depending by the options, default O(n).
        /// </summary>
        /// <param name="items">The items</param>
        /// <param name="checkWeights">If <c>true</c> will check that the weights are positive. O(N)</param>
        /// <param name="shallowCopy">If <c>true</c> will copy the original collection structure (not the items). Keep in mind that items lifecycle is impacted.</param>
        public RandomWeightedPicker(IEnumerable<T> items, bool checkWeights = true, bool shallowCopy = true)
        {
            if (items == null) throw new ArgumentNullException("items");
            if (!items.Any()) throw new ArgumentException("items cannot be empty");
            if (shallowCopy)
                this.items = new List<T>(items);
            else
                this.items = items;
            if (checkWeights && this.items.Any(i => i.Weight <= 0))
            {
                throw new ArgumentException("There exists some items with a non positive weight");
            }
            totalWeight = this.items.Sum(i => i.Weight);
        }
        /// <summary>
        /// Pick a random item based on its chance. O(n)
        /// </summary>
        /// <param name="defaultValue">The value returned in case the element has not been found</param>
        /// <returns></returns>
        public T PickAnItem()
        {
            int rnd = random.Next(totalWeight);
            return items.First(i => (rnd -= i.Weight) < 0);
        }

        /// <summary>
        /// Resets the internal random generator. O(1)
        /// </summary>
        /// <param name="seed"></param>
        public void ResetRandomGenerator(int? seed)
        {
            random = seed.HasValue ? new Random(seed.Value) : new Random();
        }
    }
} 
```

要点：[https ://gist.github.com/MrBogomips/ae6f6c9af8032392e4b93aaa393df447](https://gist.github.com/MrBogomips/ae6f6c9af8032392e4b93aaa393df447)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-04-10T12:22:11.453

原始问题中的实现对我来说似乎有点奇怪；

列表的总权重为 60，因此随机数为 0-59。它总是根据权重检查随机数，然后递减它。在我看来，它会根据它们的顺序来支持列表中的东西。

这是我正在使用的通用实现 - 症结在 Random 属性中：

```
using System;
using System.Collections.Generic;
using System.Linq;

public class WeightedList<T>
{
    private readonly Dictionary<T,int> _items = new Dictionary<T,int>();

    // Doesn't allow items with zero weight; to remove an item, set its weight to zero
    public void SetWeight(T item, int weight)
    {
        if (_items.ContainsKey(item))
        {
            if (weight != _items[item])
            {
                if (weight > 0)
                {
                    _items[item] = weight;
                }
                else
                {
                    _items.Remove(item);
                }

                _totalWeight = null; // Will recalculate the total weight later
            }
        }
        else if (weight > 0)
        {
            _items.Add(item, weight);

            _totalWeight = null; // Will recalculate the total weight later
        }
    }

    public int GetWeight(T item)
    {
        return _items.ContainsKey(item) ? _items[item] : 0;
    }

    private int? _totalWeight;
    public int totalWeight
    {
        get
        {
            if (!_totalWeight.HasValue) _totalWeight = _items.Sum(x => x.Value);

            return _totalWeight.Value;
        }
    }

    public T Random
    {
        get
        {
            var temp = 0;
            var random = new Random().Next(totalWeight);

            foreach (var item in _items)
            {
                temp += item.Value;

                if (random < temp) return item.Key;
            }

            throw new Exception($"unable to determine random {typeof(T)} at {random} in {totalWeight}");
        }
    }
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2022-02-16T00:03:46.383

另一种选择是这个

```
private static Random _Rng = new Random();
public static Broker GetBroker(List<Broker> brokers){
    List<Broker> weightedBrokerList = new List<Broker>();
    foreach(Broker broker in brokers) {
        for(int i=0;i<broker.Weight;i++) {
            weightedBrokerList.Add(broker);
        }
    }
    return weightedBrokerList[_Rng.Next(weightedBrokerList.Count)];
} 
```

# c# - 获取两个相同对象之间差异列表的最佳方法

> ID：56698
> 
> 赞同：2
> 
> 时间：2008-09-11T14:36:08.287
> 
> 标签：c#, oop

我想生成同一对象的 2 个实例之间的差异列表。有问题的对象：

```
public class Step
{
    [DataMember]
    public StepInstanceInfo InstanceInfo { get; set; }

    [DataMember]
    public Collection<string> AdHocRules { get; set; }

    [DataMember]
    public Collection<StepDoc> StepDocs
    {...}

    [DataMember]
    public Collection<StepUsers> StepUsers
    {...}
} 
```

我想做的是**找到一种智能方法来返回一个列出两个实例之间差异的对象**（例如，让我知道添加了 2 个特定的 StepDocs，删除了 1 个特定的 StepUser，并且一个规则从“去”到“停止”）。我一直在研究使用 MD5 哈希，但我找不到任何像这样遍历对象并返回**具体差异清单的**好例子（不仅仅是表明它们不同）。

*附加背景：*我需要这样做的原因是我支持的 API 允许客户端保存步骤（步骤步骤）......这对于使用实体和存储库将步骤对象持久保存到数据库非常有用。不过，我需要从此 SaveStep 方法引发特定事件（例如添加了此用户等），以提醒另一个系统（工作流引擎）步骤中的特定元素已更改。谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-11T22:41:59.853

您将需要一个单独的对象，例如 StepDiff，其中包含用于删除和添加项目的集合。执行此类操作的最简单方法是从每个旧对象和新对象中复制集合，以便 StepDiff 具有 collectionOldStepDocs 和 collectionNewStepDocs。

获取较短的集合并遍历它，查看每个 StepDoc 是否存在于另一个集合中。如果是这样，请从两个集合中删除 StepDoc 引用。然后，当您完成迭代时，collectionOldStepDocs 包含已删除的 stepDocs，collectionNewStepDocs 包含已添加的 stepDocs。

从那里你应该能够以任何必要的方式构建你的清单。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T14:55:49.300

在您的对象中实现 IComparable 接口可能会为您提供所需的功能。这将为您提供一种自定义方法来确定对象之间的差异，而无需求助于校验和，这实际上无法帮助您跟踪可用术语中的差异。否则，我无法确定 .NET 中两个用户对象之间的相等性。在 Visual Studio 的帮助文件或[此处](https://docs.microsoft.com/en-us/dotnet/api/system.icomparable)的 . 您也许可以从示例中收集一些关于比较属性的干净方法的指令，并以某种可用的方式存储值以用于跟踪目的（可能是集合或字典对象？）。

希望这会有所帮助，格雷格

# java - Java 右键单击 不会进行选择。在全球范围内解决此问题的最简单方法是什么？

> ID：56707
> 
> 赞同：6
> 
> 时间：2008-09-11T14:38:25.333
> 
> 标签：java, swing

有没有办法全局使右键单击也选择您右键单击的元素？

据我了解，这长期以来一直是一个错误，`Swing`可能永远无法修复，因为此时应用程序依赖于它。

**在全球范围内**这样做有什么建议吗？**也许在 L&F 上？**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-12T02:09:23.537

使用[玻璃窗格](http://java.sun.com/docs/books/tutorial/uiswing/components/rootpane.html)就可以了。

[这是](http://weblogs.java.net/blog/joshy/archive/2003/10/swing_hack_4_th.html)有关如何使用玻璃窗格获取右键单击按钮并将其重新分配到正确组件的教程。

* * *

由于玻璃窗格在这种情况下不是解决方案，我建议您看一下[Toolkit](http://java.sun.com/javase/6/docs/api/java/awt/Toolkit.html)类。特别是 addAWTEventListener 方法。您可以使用它添加全局事件侦听器。添加鼠标事件监听器：

```
Toolkit.getDefaultToolkit().
        addAWTEventListener(listener, AWTEvent.MOUSE_EVENT_MASK); 
```

干杯

# objective-c - 用于 Windows 的 Objective-C

> ID：56708
> 
> 赞同：231
> 
> 时间：2008-09-11T14:38:42.883
> 
> 标签：objective-c, windows, winapi, gcc, cygwin

在 Windows 平台上编写 Objective-C 的最佳方式是什么？

Cygwin和gcc？有没有办法以某种方式将其集成到 Visual Studio 中？

沿着这些思路 - 是否有任何关于如何链接和使用 Windows SDK 的建议。它是一个不同的野兽，但我知道我可以在 Windows DLL 中编写程序集和链接，让我可以访问这些调用，但我不知道如何在没有谷歌搜索和获取零碎指示的情况下做到这一点。

有没有人知道一个很好的在线或书籍资源来做或解释这些事情？

* * *

## 回答 #1

> 赞同：146
> 
> 时间：2008-09-26T18:42:43.120

扩展前两个答案，如果您只想要 Objective-C 而不是任何 Cocoa 框架，那么 gcc 将在任何平台上工作。您可以通过 Cygwin 使用它或获取 MinGW。然而，如果你想要 Cocoa 框架，或者至少是其中一个合理的子集，那么 GNUStep 和 Cocotron 是你最好的选择。

Cocotron 实现了很多 GNUStep 没有的东西，例如 CoreGraphics 和 CoreData，尽管我不能保证它们在特定框架上的实现有多完整。他们的目标是让 Cocotron 与最新版本的 OS X 保持同步，以便任何可行的 OS X 程序都可以在 Windows 上运行。因为 GNUStep 通常使用最新版本的 gcc，它们还添加了对 Objective-C++ 和许多 Objective-C 2.0 特性的支持。

我没有用 GNUStep 测试过这些特性，但是如果你使用足够新的 gcc 版本，你也许可以使用它们。几年前我无法在 GNUStep 中使用 Objective-C++。然而，GNUStep 几乎可以从任何平台编译。Cocotron 是一个非常以 mac 为中心的项目。虽然可能可以在其他平台上编译它，但它带有 XCode 项目文件，而不是 makefile，因此您只能在 OS X 上开箱即用地编译它的框架。它还带有在 XCode 上编译 Windows 应用程序的说明，但不是任何其他平台。基本上，为 Cocotron 设置一个 Windows 开发环境可能是可能的，但它不像为 GNUStep 设置一个那样容易，而且你将独自一人，所以如果你正在开发的话，GNUStep 绝对是要走的路Windows 而不是仅适用于 Windows。

值得一提的是，Cocotron 获得了 MIT 许可，而 GNUStep 获得了 LGPL 许可。

* * *

## 回答 #2

> 赞同：89
> 
> 时间：2012-03-24T05:04:13.457

您*可以*在 Windows 环境中使用 Objective C。如果您按照以下步骤操作，它应该可以正常工作：

1.  访问[GNUstep 网站](http://www.gnustep.org/windows/index.html)并下载`GNUstep MSYS Subsystem`（用于 GNUstep 的 MSYS）、`GNUstep Core`（用于 GNUstep 的库）和`GNUstep Devel`
2.  下载完这些文件后，按顺序安装，不然配置会有问题
3.  导航到`C:\GNUstep\GNUstep\System\Library\Headers\Foundation`¹并确保`Foundation.h`存在
4.  打开命令提示符并运行`gcc -v`以检查是否`GNUstep MSYS`已正确安装（如果您收到文件未找到错误，请确保该`bin`文件夹`GNUstep MSYS`在您的`PATH`.
5.  使用这个简单的“Hello World”程序来测试 GNUstep 的功能：

    ```
    #include <Foundation/Foundation.h>

    int main(void)
    {
        NSAutoreleasePool * pool = [[NSAutoreleasePool alloc] init];
        NSLog(@"Hello World!.");
        [pool drain];
     return;
    } 
    ```

6.  返回到命令提示符并返回`cd`到您保存“Hello World”程序的位置，然后编译它：²

    ```
    gcc -o helloworld.exe <HELLOWORLD>.m -I /GNUstep/GNUstep/System/Library/Headers -L /GNUstep/GNUstep/System/Library/Libraries -std=c99 -lobjc -lgnustep-base -fconstant-string-class=NSConstantString 
    ```

7.  最后，在命令提示符下，键入`helloworld`以运行它

祝一切顺利，享受 Objective-C 的乐趣！

* * *

**注意事项**：

1.  我使用了默认安装路径 - 相应地调整你的命令行
2.  确保你的文件夹路径和我的相似，否则会报错

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-09-11T18:26:08.377

还：

> Cocotron 是一个开源项目，旨在实现类似于 Apple Inc. 的 Cocoa 文档中描述的跨平台 Objective-C API。这包括 AppKit、Foundation、Objective-C 运行时和支持 API，例如 CoreGraphics 和 CoreFoundation。

[http://www.cocotron.org/](http://www.cocotron.org/)

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2015-08-10T21:12:24.233

WinObjC？适用于 iOS 的 Windows Bridge（以前称为“Project Islandwood”）。

适用于 iOS 的 Windows Bridge（也称为 WinObjC）是一个 Microsoft 开源项目，它为 Visual Studio/Windows 提供了一个 Objective-C 开发环境。此外，WinObjC 提供了对 iOS API 兼容性的支持。虽然最终版本将在今年秋天晚些时候发布（允许桥利用即将到来的 Visual Studio 2015 更新附带的新工具功能），

该桥现在以当前状态可供开源社区使用。从现在到秋天。iOS 桥作为 MIT 许可下的开源项目。鉴于该项目的雄心壮志，让 iOS 开发人员可以轻松地在 Windows 上构建和运行应用程序。

Salmaan Ahmed 有一篇关于 iOS 版 Windows 桥的深入文章[http://blogs.windows.com/buildingapps/2015/08/06/windows-bridge-for-ios-lets-open-this-up/](http://blogs.windows.com/buildingapps/2015/08/06/windows-bridge-for-ios-lets-open-this-up/)讨论了编译器、运行时、IDE 集成以及桥是什么和不是什么。最重要的是，iOS 桥的源代码[现在在 GitHub 上。](https://github.com/Microsoft/WinObjC/)

iOS 桥支持为 x86 和 x64 处理器架构构建的 Windows 8.1 和 Windows 10 应用程序，很快我们将添加编译器优化和对 ARM 的支持，从而增加移动支持。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-11-05T20:01:51.487

我对 Cocotron 项目的感受很复杂。我很高兴他们发布源代码和共享，但我不觉得他们做事的方式最简单。

例子。
Apple 已经发布了[Objective-C 运行时](http://www.opensource.apple.com/source/objc4/objc4-437/)的源代码，其中包括属性和垃圾回收。然而，Cocotron 项目有自己的 Objective-C 运行时实现。为什么要重复努力？甚至还有一个可用于构建 objc.dll 文件的 Visual Studio 项目文件。或者，如果您真的很懒，您可以从 Windows 上安装的 Safari 复制 DLL 文件。

他们也没有费心利用同样由 Apple 开源的 CoreFoundation。我发布了一个关于此的[问题](http://groups.google.com/group/cocotron-dev/browse_thread/thread/8d9b9ae9b9c17c8d/ba391f3f93ec4438?lnk=gst&q=matthieu+cormier#ba391f3f93ec4438)，但没有收到答案。

我认为目前最好的解决方案是从多个来源（Apple、CocoTron、GnuStep）获取源代码并将其合并到您需要的地方。您将不得不阅读大量源代码，但最终结果将是值得的。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2012-10-12T03:48:44.343

我知道这是一篇非常古老的帖子，但我发现了一个最近才可用的解决方案，并且在 Windows 平台上启用了几乎所有的 Objective-C 2.0 功能。

随着 gcc 4.6 的出现，对 Objective-C 2.0 语言特性（块、点语法、综合属性等）的支持被添加到了 Objective-C 编译器中（完整[的详细信息请参见发行说明](http://gcc.gnu.org/gcc-4.6/changes.html)）。它们的运行时也已更新，几乎与 Apple 自己的 Objective-C 2.0 运行时相同。简而言之，这意味着（几乎）任何可以在 Mac 上使用 Clang 合法编译的程序也可以使用 gcc 4.6 编译而无需修改。

作为旁注，一个不可用的功能是字典/数组/等文字，因为它们都被硬编码到 Clang 中以使用 Apple 的 NSDictionary、NSArray、NSNumber 等类。

但是，如果您愿意在没有 Apple 广泛的框架的情况下生活，那么您可以。如其他答案所述，GNUStep 和 Cocotron 提供了 Apple 类库的修改版本，或者您可以编写自己的（我的首选）。

MinGW 是在 Windows 平台上获取 GCC 4.6 的一种方式，可以从[MinGW 网站](http://mingw.org)下载。确保在安装它时包含 C、C++、Objective-C 和 Objective-C++ 的安装。虽然是可选的，但我还建议安装 MSYS 环境。

安装后，Objective-C 2.0 源代码可以编译为：

`gcc MyFile.m -lobjc -std=c99 -fobjc-exceptions -fconstant-string-class=clsname (etc, additional flags, see documentation)`

MinGW 还支持使用该`-mwindows`标志编译本机 GUI Windows 应用程序。例如：

`g++ -mwindows MyFile.cpp`

我还没有尝试过，但我想如果你在可能的最高层用 Objective-C++ 包装你的 Objective-C 类，你应该能够在一个 Windows 应用程序中成功地交织原生 Windows GUI C++ 和 Objective-C。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2015-11-03T16:24:23.883

查看**WinObjC**：

[https://github.com/Microsoft/WinObjC](https://github.com/Microsoft/WinObjC)

这是 Microsoft 的一个官方开源项目，与 Visual Studio + Windows 集成。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2010-07-20T23:08:26.783

如果你只是想试验一下，这里有一个用于 .NET (Windows) 的 Objective-C 编译器：[qckapp](http://www.qckapp.com/index.html?p=ObjC)

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2011-08-27T22:48:54.773

您可以在此处获得一个可与 Windows 配合使用并与 Visual Studio 2008\2010 配合使用的目标 c 编译器。

[开放-c flite](http://opencflite.svn.sourceforge.net/viewvc/opencflite/)

只需下载最新的源代码。您不需要构建所有的 CF-Lite，有一个名为 objc.sln 的解决方案。您将需要修复一些包含路径，但它会构建得很好。甚至还包括一个测试项目，因此您可以看到一些 Objective-c .m 文件正在编译并在 Visual Studio 中工作。一件可悲的事情是它只适用于 Win32 而不是 x64。需要为 x64 编写一些汇编代码才能支持它。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2014-06-01T15:23:36.810

近期将 Objective C 2.0 移植到 Windows 的尝试是[Subjective](https://github.com/crontab/Subjective)项目。

从自述文件：

> 主观是试图将具有 ARC 支持的 Objective C 2.0 引入 Windows。
> 
> 该项目是 objc4-532.2 的一个分支，objc4-532.2 是 OS X 10.8.5 附带的 Objective C 运行时。该端口可以在 OS X 上使用 llvm-clang 与 MinGW 链接器进行交叉编译。
> 
> 存在某些限制，其中许多是额外工作的问题，而其他一些限制，例如异常和块，则取决于 3rd 方项目中更严肃的工作。限制是：
> 
> • 仅 32 位 - 64 位正在进行中
> 
> • 仅静态链接 - 动态链接正在进行中
> 
> • 没有闭包/阻塞——直到 libdispatch 在 Windows 上支持它们
> 
> • 没有例外 - 直到 clang 在 Windows 上支持它们
> 
> • 没有老式 GC - 直到有人关心...
> 
> • 内部：没有 vtables，没有 gdb 支持，只有普通的 malloc，没有预优化——其中一些东西将在 64 位构建下可用。
> 
> • 目前需要修补的clang 编译器。该补丁添加了 -fobjc-runtime=subj 标志

该项目在[Github](https://github.com/crontab/Subjective)上可用，Cocotron Group 上也有一个[帖子](https://groups.google.com/forum/#!topic/cocotron-dev/ahkFkI9yRXk)，概述了一些进展和遇到的问题。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2014-12-20T13:53:42.777

[在此处](http://www.gnustep.org/windows/installer.html "GNUStep download page")获取 GNUStep

[在这里](http://sourceforge.net/projects/mingw/ "MINGW download page")获取 MINGW

安装 MINGW 安装 GNUStep 然后测试

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-02-28T01:34:28.813

如果您对 Visual Studio 环境感到满意，

小项目：jGRASP 和 gcc 大项目：Cocotron

我听说有模拟器，但我只能找到 Apple II Emulator [http://virtualapple.org/](http://virtualapple.org/)。看起来仅限于游戏。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-03-01T10:51:02.550

首先，忘记*GNUStep*工具。[ProjectManager](http://home.gna.org/pmanager/)和[ProjectCenter](http://wiki.gnustep.org/index.php/ProjectCenter)都不能称为 IDE。恕我直言，来自*GNUStep*项目的人似乎被困在 80 年代后期（那是*NeXTSTEP*首次出现的时候）。

### 维姆

`ctags`[从r771](https://sourceforge.net/p/ctags/code/771/)开始支持 Objective-C （一定要选择预发布的 5.9 版本并添加`--langmap=ObjectiveC:.m.h`到命令行，请参见[此处](https://stackoverflow.com/a/5790832/1343979)），因此您将拥有不错的代码完成/标签导航。

这是一个简短的[如何](http://bastibe.de/2011-12-04-how-to-make-tagbar-work-with-objective-c.html)将 Objective-C 支持添加到 Vim 标签栏插件。

### Emacs

这同样适用于`etags`现代 Emacsen，因此您可以从 Emacs [Objective C Mode](https://www.emacswiki.org/emacs/ObjectiveCMode)开始。[YASnippet](https://www.emacswiki.org/emacs-test/Yasnippet)将提供有用的模板：

[![YASnippet objc 模式](https://i.stack.imgur.com/aYOvw.png)](https://i.stack.imgur.com/aYOvw.png)

如果你想要比[基本的基于标签的代码完成](https://www.emacswiki.org/emacs-test/EmacsTags)更智能的东西，看看这个[问题](https://emacs.stackexchange.com/questions/801/how-to-get-intelligent-auto-completion-in-c)。

### 蚀

[CDT](https://eclipse.org/cdt/)支持`Makefile`基于 - 的项目：

[![在此处输入图像描述](https://i.stack.imgur.com/LRH2N.png)](https://i.stack.imgur.com/LRH2N.png)

-- 所以从技术上讲，您可以开箱即用地构建您的 Objective-C 项目（在 Windows 上，您需要*Cygwin*或*MinGW*工具链）。唯一的问题是代码编辑器会针对它认为是纯*C*代码的内容报告大量错误（可以关闭动态代码检查，但仍然......）。如果您想要正确的语法突出显示，您可以将[Eclim](http://eclim.org/)添加到您的*Eclipse*中，并享受*Eclipse*和*Vim*的所有优秀特性（见上文）。

另一个有前途的*Eclipse*插件是[Colorer](http://colorer.sourceforge.net/eclipsecolorer/)，但它还不支持 Objective-C。不过，请随时提交功能请求。

### 光滑编辑

[SlickEdit](https://www.slickedit.com)以及一个优秀 IDE的[其他特性，](https://www.slickedit.com/products/slickedit/cool-features)**确实** [支持](http://www.slickedit.com/products/slickedit/380-slickedit-supports-over-60-languages)Objective-C。虽然学习起来相当复杂（虽然不如 Emacs 复杂），但我相信这是您最好的选择，前提是您不介意购买它（价格相当实惠）。

此外，它还有一个[Eclipse 插件](http://www.slickedit.com/products/slickedit-core-for-eclipse)，可以用作独立编辑器的替代品。

### KDevelop

有传言说存在一个*KDevelop* [补丁](http://ftpmain.gnustep.org/pub/gnustep/contrib/kdkobjc-0.2.README)（15 岁，但谁在乎呢？）。*与Emacsen*相比，我个人认为*KDevelop*的功能并不优越，所以我不会费心去尝试它。

 ** * *

以上也适用于 Linux 上的 Objective-C 开发，因为所有提到的工具或多或少都是可移植的。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2022-02-21T14:50:40.623

截至 2021 年，[GNUstep Windows MSVC 工具链](https://github.com/gnustep/tools-windows-msvc)允许**将 Objective-C 代码集成到任何 Windows 应用程序中，包括使用 LLVM/Clang 的 Visual Studio 项目**。这包括对自动引用计数 (ARC) 和 Objective-C 2.0 功能（例如块）的支持。

该项目包括来自 GNUstep 的 Foundation、CoreFoundation 和 libdispatch 库。它目前不包括任何 UI 框架，例如 AppKit 或 UIKit，但它可以用于编写一个特定于 Windows 的 UI，该 UI 具有用 Objective-C 编写的跨平台业务逻辑。

# sql-server-2005 - 用户无权运行 DBCC DBREINDEX

> ID：56709
> 
> 赞同：6
> 
> 时间：2008-09-11T14:39:32.303
> 
> 标签：sql-server-2005, security

我在 SQL Server 2005 中收到以下错误消息：

```
User '<username>' does not have permission to run DBCC DBREINDEX for object '<table>'. 
```

为了运行命令，我必须赋予用户哪个最低角色？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-11T14:41:39.757

您需要成为**db_ddladmin**或**db_owner**角色 AFAIK的成员

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T14:45:03.727

> 调用者必须拥有该表，或者是 sysadmin 固定服务器角色、db_owner 固定数据库角色或 db_ddladmin 固定数据库角色的成员。

[DBCC DBREINDEX (Transact-SQL) @ MSDN](http://msdn.microsoft.com/en-us/library/ms181671(SQL.90).aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-04-29T11:47:31.750

将表名上的授权更改为 [域\用户名]

# vb.net - 查询远程服务器上磁盘空间的最佳方法

> ID：56715
> 
> 赞同：5
> 
> 时间：2008-09-11T14:40:12.413
> 
> 标签：vb.net, wmi

我试图通过查询所有驱动器然后循环直到找到我正在寻找的驱动器来确定远程服务器上的可用空间。
有一个更好的方法吗？

```
Dim oConn As New ConnectionOptions
Dim sNameSpace As String = "\\mnb-content2\root\cimv2"
Dim oMS As New ManagementScope(sNameSpace, oConn)

Dim oQuery As System.Management.ObjectQuery = New System.Management.ObjectQuery("select FreeSpace,Size,Name from Win32_LogicalDisk where DriveType=3")
Dim oSearcher As ManagementObjectSearcher = New ManagementObjectSearcher(oMS, oQuery)

Dim oReturnCollection As ManagementObjectCollection = oSearcher.Get()
Dim oReturn As ManagementObject

For Each oReturn In oReturnCollection
    'Disk name
    Console.WriteLine("Name : " + oReturn("Name").ToString())
    'Free Space in bytes
    Dim sFreespace As String = oReturn("FreeSpace").ToString()
    If Left(oReturn("Name").ToString(), 1) = "Y" Then
        Console.WriteLine(sFreespace)
    End If
Next 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-11T14:45:31.853

为什么不让你的 WMI 查询只在 name='Y' 的地方拉回？

所以：

```
Dim oQuery As System.Management.ObjectQuery = New System.Management.ObjectQuery("select FreeSpace,Size,Name from Win32_LogicalDisk where DriveType=3 AND name='Y'") 
```

# architecture - 建模架构

> ID：56716
> 
> 赞同：1
> 
> 时间：2008-09-11T14:40:17.013
> 
> 标签：architecture, modeling, modularity

构建由许多不同类型的项目组成的系统模型的常见解决方案是创建一个模块化系统，其中每个模块负责特定类型。例如，将有用于袋熊的模块 WombatModule:IModule，其中 IModule 接口具有 GetCount()（查找袋熊数量）和 Update()（更新所有袋熊的状态）等方法。

更面向对象的方法是为每个项目类型设置类并为每个项目创建一个实例。这将使类 Wombat:IItem 具有 Update() 之类的方法（以更新这个袋熊）。

从代码的角度来看，差异可以忽略不计，但运行时差异很大。面向模块的解决方案当然更快：更少的对象创建，更容易优化所有袋熊通用的操作。

当类型和模块的数量增加时，问题就来了。要么你失去了大部分性能优势，因为每个模块只支持几个项目，要么模块的复杂性增加以适应一种通用类型的稍微不同的项目——比如胖袋熊和瘦袋熊。或两者。

至少有一次我看到它退化为糟糕的状态，而 WombatModule 所做的只是保留隐藏的 Wombat 对象的集合并循环运行它们的方法。

当性能问题比长期开发问题更小时，您能否确定使用模块而不是每个项目对象的任何架构原因？可能还有另一种可能性我失踪了？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-11T15:35:40.407

我为 an 工作`embedded software company`，我们`code base`的公司很大。代码库设计有执行特定功能和维护一些对象的模块——还有一些对象作为独立对象存在。我们在方法中看到的最大问题是区分模块的边界。随着时间的推移，我们的模块往往会变得不必要地复杂，并且会慢慢增长以执行最初超出其边界的功能。我想说最好的方向是模块化设计和实现非常具体的对象，并努力不让模块变得比你想要的大。

# java - 用 Java 自动处理电子邮件

> ID：56722
> 
> 赞同：4
> 
> 时间：2008-09-11T14:41:45.327
> 
> 标签：java, email, lotus-notes

刚从我的老板那里收到一份我正在处理的应用程序的请求。基本上，我们正在为外部客户设置一个电子邮件地址，以向其提交 Excel 文件。

我需要的是一种自动接收发送到此地址的任何电子邮件的方法，这样我就可以获取附件，对其进行处理并将其保存到文件夹中。

任何关于从哪里开始的信息都会有所帮助。\

注意：我们正在使用 Lotus Notes 服务器来执行此操作，但通用方式会更有帮助（如果可能）。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-11T14:46:37.203

电子邮件 -> 邮件服务器 -> [某事] -> 磁盘上的文件。

磁盘上的文件很容易解析，使用[JavaMail](http://java.sun.com/products/javamail/javadocs/javax/mail/package-summary.html)。

[某事]可能是：

*   监听 smtp 连接（矫枉过正）！
*   [Pop3](http://java.sun.com/products/javamail/javadocs/com/sun/mail/pop3/package-summary.html) / [imap](http://java.sun.com/products/javamail/javadocs/com/sun/mail/imap/package-summary.html)客户端
*   [邮件目录](http://en.wikipedia.org/wiki/Maildir)/邮箱

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-10T16:19:09.903

*编辑：*自从我第一次写这个答案以来，Wiser 已经搬家了，现在声称只是一个单元测试工具，所以在下面的答案中加点盐......

* * *

Svrist 的回答很好，但是如果您想避免他的中间步骤（将邮件写入磁盘以供 Java 系统稍后提取的邮件服务器），您可以使用[Wiser](http://code.google.com/p/subethasmtp/wiki/Wiser)。

Wiser 允许您启动 Java 内邮件服务器：

```
Wiser wiser = new Wiser();
wiser.setPort(2500);
wiser.start(); 
```

然后你可以定期轮询它的邮件：

```
for (WiserMessage message : wiser.getMessages())
{
    String envelopeSender = message.getEnvelopeSender();
    String envelopeReceiver = message.getEnvelopeReceiver();

    MimeMessage mess = message.getMimeMessage();

    // mail processing goes here
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T11:23:46.353

我最近在 Domino 服务器上使用 Java 代理做了很多工作。Domino 8.5 服务器支持 Java 6 及其嵌入式，因此具有一点 Domino 开发经验的人不会花费很长时间来组装一个在新邮件到达时运行的代理。在 LotusScript 中它更容易，但需要更多的专业技能，您可能需要让承包商提供这些技能。

您可能遇到的限制与提取的文件有关，您可以轻松地将其放置在 Domino 服务器的文件结构中，但您可能会受到操作系统安全性的限制，无法将其放置在不同的服务器上。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T20:32:20.667

使用数据库中的邮件（您的 Domino 管理员可以为您设置，但它也在帮助文件中）。

在该数据库中，您可以创建一个定期运行以处理所有新文档的代理。该代理将使用 NotesRichTextItem 类的 EmbeddedObjects 属性和 NotesEmbeddedObject 类的 ExtractFile 方法来获取文件附件的句柄并将其提取到您指定的位置。

例如，此脚本遍历文档正文项中的所有文件附件、对象链接和嵌入对象。每次找到文件附件时，它都会将文件分离到 C 盘上的 SAMPLES 目录，并从文档中删除附件

```
Dim doc As NotesDocument
Dim rtitem As Variant
'...set value of doc...
Set rtitem = doc.GetFirstItem( "Body" )
If ( rtitem.Type = RICHTEXT ) Then
  Forall o In rtitem.EmbeddedObjects
    If ( o.Type = EMBED_ATTACHMENT ) Then
      Call o.ExtractFile( "c:\samples\" & o.Source )
      Call o.Remove
      Call doc.Save( False, True )
    End If
  End Forall
End If 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-15T15:58:51.300

Lotus Notes/Domino 将邮件存储在 Notes 数据库中。有一些 API 可用于获取文档（电子邮件）、读取字段值（发件人、主题）和分离文件。

API 包括

-LotusScript（VB 变体，在 Notes 数据库中可用）

-Java（来自数据库内部或外部）

-C API（外部）

- 通过 COM 服务器提供相同的 API

您可以在数据库中创建一个“预定代理”（使用 LotusScript 或 Java），它可以定位自上次运行以来创建的文档、定位附件并提取它们。代理需要使用在服务器上具有适当权限的 ID 进行签名，包括写入文件系统和启动任何其他进程所需的权限。

在数据库外部，您可以使用除 LotusScript 之外的任何 API 登录到服务器/邮件数据库，并遵循类似的过程，例如在客户端或单独的服务器上本地提取文件。C API 和 COM 需要安装 notes 客户端，但 Java 应用程序可以设置为通过 CORBA/DIIOP 运行而无需完全安装。

有关更多信息，请参阅 Domino Designer 帮助（或 IBM 的 C API 网站）。

至于执行此操作的“通用方式”，如果您正在访问 Notes 中的数据并需要提取附件，我相信这些 API 是您的最佳选择。如果您设想将应用程序移植到另一个邮件系统，请考虑通过“接口”将 API 例程解耦，这样您只需添加该接口的新实现即可支持新的邮件系统。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T16:09:29.747

您可以使用 DIIOP 相对轻松地访问 Notes 文档，这比走 C Api 之路要容易得多......

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T16:51:35.363

[尝试Net Commons 包](http://commons.apache.org/net/)中的 POP3Client ；它会让您的 Java 程序以您想要的任何时间间隔（每隔几分钟？每小时？）检查特定帐户的新邮件，并根据需要获取/删除邮件。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T20:39:47.903

可以在 Domino 服务器上启用 SMTP/POP3。之前使用过这个并让 Squirrel Mail 运行它。SMTP 有点占用资源，但值得付出努力，因为这样您就不必深入到 LotusLand 来使事情正常进行。只需编写一个小的 Java CLI 程序，该程序将检查特定的电子邮件邮箱（POP3 或 SMTP），并解析邮件，提取附件并将​​它们放置在需要的地方。

这里有大量文档和示例：http: [//java.sun.com/products/javamail/](http://java.sun.com/products/javamail/)

您采用这种方法开发的技术将比任何特定于 Lotus/Domino 的技术更广泛地适用于您未来的职业生涯。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-10T16:11:12.663

无论您做什么，都需要了解 Lotus Notes 数据结构。好消息是，可以非常轻松地在 Notes 中构建完全自动化的解决方案。

最好的办法是在 Notes 中构建它，并且可以将它设置为在收到新邮件时自动运行。加里的答案是肯定的，但没有任何经验，可能很难弄清楚如何自己实施。另一方面，任何称职的Notes 程序员真的不应该花费超过一两个小时来设置它。

# eclipse - 在 BIRT 报告中显示空白而不是 0 或 0.0

> ID：56723
> 
> 赞同：2
> 
> 时间：2008-09-11T14:41:46.777
> 
> 标签：eclipse, reporting, birt

在某些报告中使用聚合控件时，您希望看到一个空白字段而不是 0。似乎没有一种方法可以自动执行此操作。有没有人有办法做到这一点。请注意，您希望在导出时保持该字段的“0”值，但在呈现为 PDF 或 HTML 时希望显示空白。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-11T15:59:06.840

有很多方法可以解决这个问题。两个主要是使用可见性规则或突出显示来创建条件格式。可见性特别有吸引力，因为它很容易只将格式规则应用于特定类型的输出（例如 HTML）。

对于这种特殊情况，这些方法存在两个问题。首先，我想要一个无需指定文本颜色的通用解决方案。换句话说，当条件为真（值为 0）时，我希望我的文本颜色与背景颜色匹配。这样，如果有人更改控件的 backgroundColor，代码仍然有效。

另一个问题是，在这种情况下，我使用的是不支持值查找的动态列绑定。

我创建的解决方案是添加一个名为 hideMe 的 JavaScript 函数，如下所示。

```
function hideText (dataControl){
    if (dataControl.getValue() == 0) {
        var color = dataControl.getStyle().getBackgroundColor();
        var parentItem = dataControl.getParent();
        do {
            if (color == null && parentItem != null) {
                color = parentItem.getStyle().getBackgroundColor();
                parentItem = parentItem.getParent();
            } else {
                break;
            }

        } while (color == null);
        dataControl.getStyle().color = color;
    }
} 
```

一旦这个函数被添加到报告中（在我的例子中是一个包含的 javascript 文件），我只需从控件的 OnCreate 方法中调用它。

```
hideText(this); 
```

这也可以使用 Java 事件处理程序来完成，但这种方法似乎更容易。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-09-14T16:11:56.057

仅供参考，在使用了一段时间后，我发现使用可见性规则更容易。一大优势是您可以轻松地为不同的输出格式配置不同的可见性。因此，对于 PDF，最好使用空白，但对于 Excel，您可能需要 0 值。

# c# - 如何从 C# 调用 AllocateAndInitializeSid 函数？

> ID：56729
> 
> 赞同：4
> 
> 时间：2008-09-11T14:43:18.550
> 
> 标签：c#, .net, winapi

有人可以给我一个`AllocateAndInitializeSid`从 C# 代码调用函数的完整且有效的示例吗？

我发现[了这个](http://msdn.microsoft.com/en-us/library/aa375213(VS.85).aspx)：

```
BOOL WINAPI AllocateAndInitializeSid(
  __in   PSID_IDENTIFIER_AUTHORITY pIdentifierAuthority,
  __in   BYTE nSubAuthorityCount,
  __in   DWORD dwSubAuthority0,
  __in   DWORD dwSubAuthority1,
  __in   DWORD dwSubAuthority2,
  __in   DWORD dwSubAuthority3,
  __in   DWORD dwSubAuthority4,
  __in   DWORD dwSubAuthority5,
  __in   DWORD dwSubAuthority6,
  __in   DWORD dwSubAuthority7,
  __out  PSID *pSid
); 
```

而且我不知道如何构造此方法的签名 - 我应该如何处理`PSID_IDENTIFIER_AUTHORITY`和`PSID`类型？我应该如何通过它们 - 使用`ref`or `out`？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-12T02:20:06.037

使用[P/Invoke 互操作助手](http://www.codeplex.com/clrinterop)：

```
 [System.Runtime.InteropServices.StructLayoutAttribute(System.Runtime.InteropServices.LayoutKind.Sequential)]
    public struct SidIdentifierAuthority {

        /// BYTE[6]
        [System.Runtime.InteropServices.MarshalAsAttribute(
            System.Runtime.InteropServices.UnmanagedType.ByValArray, 
            SizeConst = 6, 
            ArraySubType = 
            System.Runtime.InteropServices.UnmanagedType.I1)]
        public byte[] Value;
    }

    public partial class NativeMethods {

        /// Return Type: BOOL->int
        ///pIdentifierAuthority: PSID_IDENTIFIER_AUTHORITY->_SID_IDENTIFIER_AUTHORITY*
        ///nSubAuthorityCount: BYTE->unsigned char
        ///nSubAuthority0: DWORD->unsigned int
        ///nSubAuthority1: DWORD->unsigned int
        ///nSubAuthority2: DWORD->unsigned int
        ///nSubAuthority3: DWORD->unsigned int
        ///nSubAuthority4: DWORD->unsigned int
        ///nSubAuthority5: DWORD->unsigned int
        ///nSubAuthority6: DWORD->unsigned int
        ///nSubAuthority7: DWORD->unsigned int
        ///pSid: PSID*
        [System.Runtime.InteropServices.DllImportAttribute("advapi32.dll", EntryPoint = "AllocateAndInitializeSid")]
        [return: System.Runtime.InteropServices.MarshalAsAttribute(System.Runtime.InteropServices.UnmanagedType.Bool)]
        public static extern bool AllocateAndInitializeSid(
            [System.Runtime.InteropServices.InAttribute()] 
            ref SidIdentifierAuthority pIdentifierAuthority, 
            byte nSubAuthorityCount, 
            uint nSubAuthority0, 
            uint nSubAuthority1, 
            uint nSubAuthority2, 
            uint nSubAuthority3, 
            uint nSubAuthority4, 
            uint nSubAuthority5, 
            uint nSubAuthority6, 
            uint nSubAuthority7, 
            out System.IntPtr pSid);

    } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-12T02:01:10.357

如果您的目标是 .NET 2.0 或更高版本，则 System.Security.Principal.SecurityIdentifier 类包装一个 SID 并允许您避免容易出错的 Win32 API。

不完全是您问题的答案，但谁知道它可能有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T14:47:22.037

对于 Platform Invoke，www.pinvoke.net 是您最好的新朋友！

[http://www.pinvoke.net/default.aspx/advapi32/AllocateAndInitializeSid.html](http://www.pinvoke.net/default.aspx/advapi32/AllocateAndInitializeSid.html)

# java - DocumentBuilder.parse() 线程安全吗？

> ID：56737
> 
> 赞同：27
> 
> 时间：2008-09-11T14:45:40.090
> 
> 标签：java, thread-safety

标准的 Java 1.6 [javax.xml.parsers.DocumentBuilder](http://java.sun.com/javase/6/docs/api/javax/xml/parsers/DocumentBuilder.html)类线程安全吗？从多个线程并行调用 parse() 方法是否安全？

JavaDoc 没有提到这个问题，但是Java 1.4[中同一个类的 JavaDoc](http://java.sun.com/j2se/1.4.2/docs/api/javax/xml/parsers/DocumentBuilder.html)特别指出它*不是*并发的；所以我可以假设在 1.6 中是这样吗？

原因是我在 ExecutorService 中运行了数百万个任务，每次调用 DocumentBuilderFactory.newDocumentBuilder() 似乎很昂贵。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-09-11T15:07:39.180

尽管 DocumentBuilder.parse 似乎不会改变它在 Sun JDK 默认实现（基于 Apache Xerces）上所做的构建器。古怪的设计决策。你能做什么？我猜使用 ThreadLocal：

```
private static final ThreadLocal<DocumentBuilder> builderLocal =
    new ThreadLocal<DocumentBuilder>() {
        @Override protected DocumentBuilder initialValue() {
            try {
                return
                    DocumentBuilderFactory
                        .newInstance(
                            "xx.MyDocumentBuilderFactory",
                            getClass().getClassLoader()
                        ).newDocumentBuilder();
            } catch (ParserConfigurationException exc) {
                throw new IllegalArgumentException(exc);
            }
        }
    }; 
```

（免责声明：与其说是试图编译代码。）

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-10-23T20:44:17.733

DocumentBuilder 上有一个 reset() 方法，可以将其恢复到首次创建时的状态。如果您要使用 ThreadLocal 路线，请不要忘记调用它，否则您会被淹没。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-09-16T08:17:10.563

您还可以检查此代码以进一步优化[https://svn.apache.org/repos/asf/shindig/trunk/java/common/src/main/java/org/apache/shindig/common/xml/XmlUtil。爪哇](https://svn.apache.org/repos/asf/shindig/trunk/java/common/src/main/java/org/apache/shindig/common/xml/XmlUtil.java)

# c++ - 文件系统信息——如何查询？

> ID：56741
> 
> 赞同：3
> 
> 时间：2008-09-11T14:46:04.833
> 
> 标签：c++, windows, winapi, filesystems

有没有办法通过某种类型的 Windows API 访问文件系统信息？如果不是，用户模式开发人员可以使用哪些其他方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-11T15:27:39.537

不是很干净，但是您可以将`DeviceIoControl()` 打开卷用作文件，将生成的句柄`DeviceIoControl()`与控制代码一起传递。检查 MSDN 的控制代码，有类似“读取日志记录”的内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T18:26:38.560

在另一篇文章中，有人推荐了这个：[密切关注您的 NTFS 驱动器：Windows 2000 更改日志解释](http://www.microsoft.com/msj/0999/journal/journal.aspx)。

它解释了如何通过 Windows 2000 使用带有 C++ 的 NTFS 文件系统。实现可能已经改变。

# ms-access - Access 2003 中的键盘快捷键

> ID：56761
> 
> 赞同：2
> 
> 时间：2008-09-11T14:51:43.553
> 
> 标签：ms-access

Access 2003 中是否有可以在设计或 sql 模式下运行查询的键盘快捷键？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-15T20:58:12.517

Sendkeys 总是一个错误，因为在 Access 中几乎没有任何东西不能通过代码实现。

正确的代码是：

```
DoCmd.RunCommand acCmdRun 
```

如何运行该代码取决于您，但它绝对比 SendKeys 更可取。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T14:55:41.937

它不是内置的。我会尝试一个宏 - AutoKeys？您应该能够以这种方式使几乎任何键盘变短。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T15:38:00.823

我结合使用答案编写了一个从 AutoKeys 宏调用的小函数，如下所示：

```
Public Function RunMyQuery() As Boolean
   SendKeys "%Q" & "R"
   RunMyQuery = True
End Function 
```

谢谢！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T04:15:36.677

此功能不是内置的，但您可以对其进行设置，以便按`F5`功能键运行查询。

1.  创建一个新宏。
2.  如果“宏名称”列尚未显示，请使用菜单“视图”>“宏名称”将其添加到网格中。
3.  在“宏名称”列中键入：{F5}
4.  在“操作”列中，向下滚动并选择“运行命令”。
5.  窗口窗格的下半部分是“动作参数”。对于“命令”，向下滚动并选择“运行”。
6.  将宏保存为 AutoKeys。
7.  关闭宏。
8.  在设计视图或 sql 视图中打开已保存的查询。
9.  按功能键 ,`F5`运行查询。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-05T18:43:43.917

`Ctrl`+`,`和`Ctrl`+`.`将使 MS Access 在查询视图 Design、Datasheet、SQL、Pivo​​tTable、Pivo​​tChart 中左右循环。

否则，您可以右键单击“运行”感叹号并选择自定义，然后在该自定义窗口打开的情况下，您可以再次右键单击“运行”感叹号，选择“图像和文本”以显示“运行”一词。只要显示单词，就可以使用`Alt`++激活那个基于下划线大写`Shift`R`R`的按钮。如果再次右键单击“运行”感叹号并选择属性，则可以将大写R更改为小写r这样就不需要 SHIFT 键，快捷方式就变成了`Alt`+ `R`。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-03-27T02:52:49.197

运行查询的键盘快捷键：

> 按（**不要**按住）`Alt`然后点击`v`然后点击`s`

返回查询视图的键盘快捷键：

> 按`Alt`然后点击`v`然后点击`q`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-11T15:04:18.127

Alt Q Alt R（即菜单项选择）不适合吗？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-04-01T20:44:58.273

不确定这与 Windows 2007 中的相同问题有什么相似之处，但 FWIW，我通过执行以下操作修复了它：

1.  右键单击运行按钮
2.  选择“自定义快速访问工具栏”
3.  在出现的对话框中，从左侧的下拉列表中选择“查询工具|设计选项卡”。左侧列表框中的选项将更改以反映选择。
4.  在左侧的列表框中，选择“运行”，然后单击“添加>>”。“运行”应添加到右侧的列表中。
5.  单击确定。

`Alt`现在您可以使用+运行您的 SQL `4`。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-08-21T15:54:39.633

尽管不是键盘快捷方式，但也可以将按钮添加到快速访问工具栏，以便无论您拥有哪个选项卡或功能区最小化时都可以轻松访问。

# .net - 开始一份专注于棕地应用程序重构和敏捷的新工作

> ID：56764
> 
> 赞同：3
> 
> 时间：2008-09-11T14:52:15.190
> 
> 标签：.net, vb.net, refactoring, brownfield

我星期一要开始一份新工作。该公司有一个本土企业案例管理应用程序，用`ASP.NET/VB.NET`. 他们正在尝试实施敏捷开发过程。他们甚至让两个人获得了 Scrum Master 认证并聘请了一名敏捷教练。他们目前专注于 6-9 个月的重构。

我的问题是，在这种环境下，有哪些好的方法/工具可以让我熟悉代码库并在我一落地就提高生产力？有什么建议吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-11T15:03:42.590

好问题！

我想说的第一件事就是让每日例会继续进行。你在 Scrum 中的角色将是学习代码。它将为您提供一种提问方式，并了解谁能帮助您学习代码。

一旦你选择了那个人（或多个人），就开始与他们结对编程。让他们开车，但要问问题。你会惊讶于你能以这种方式获得多少。鉴于他们对敏捷的偏爱，这应该很容易推销。:)

一旦确定了这一点，请务必经常更换合作伙伴，以便您了解整个代码库。仅仅坚持一个人做一个部分不会给你一个大图景，但是在人们之间跳跃会让你对代码有一个更好的大图视图。

只是我的2美分。：） 祝好运并玩得开心点！！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-11T15:02:06.947

祝贺新工作！

放松并保持冷静。[在这里](http://www.refactoring.com/sources.html)阅读一些东西。

我想，只要你运用常识，这个过程本身就会确保你富有成效:)

# c# - 数据集合并之间的差异

> ID：56767
> 
> 赞同：0
> 
> 时间：2008-09-11T14:54:07.620
> 
> 标签：c#, object, initialization, dataset

这两种合并数据集的方式之间是否存在差异（性能、开销）？

```
MyTypedDataSet aDataSet = new MyTypedDataSet();
aDataSet .Merge(anotherDataSet);
aDataSet .Merge(yetAnotherDataSet); 
```

和

```
MyTypedDataSet aDataSet = anotherDataSet;
aDataSet .Merge(yetAnotherDataSet); 
```

你推荐哪个？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-11T14:55:23.577

这两条线做不同的事情。

第一个创建一个新集合，然后将第二个集合合并到其中。

第二个将 ds 引用设置为指向第二个集合，因此：

```
MyTypedDataSet ds1 = new MyTypedDataSet();
ds1.Merge(anotherDataSet);
//ds1 is a copy of anotherDataSet
ds1.Tables.Add("test")

//anotherDataSet does not contain the new table

MyTypedDataSet ds2 = anotherDataSet;
//ds12 actually points to anotherDataSet
ds2.Tables.Add("test");

//anotherDataSet now contains the new table 
```

* * *

好的，假设您的意思是：

```
MyClass o1 = new MyClass();
o1.LoadFrom( /* some data */ );

//vs

MyClass o2 = new MyClass( /* some data */ ); 
```

然后后者更好，因为前者在填充之前创建了一个空对象。

但是，除非初始化一个空类的成本很高或重复很多次，否则差异并不那么重要。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-11T14:56:10.597

您的第二个示例不会**创建**新数据集。这只是对现有数据集的第二次*引用。*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T14:58:18.187

虽然基思是对的，但我想这个例子只是选错了。通常，最好从一开始就初始化为“正确”的对象，而*不是*像您的情况那样构造一个中间的空对象。两个原因：

1.  表现。这应该很明显：对象创建需要时间，因此创建更少的对象会更好。
2.  *然而，更*重要的是，它更好地说明了您的**意图**。您通常*不*打算创建无状态/空对象。相反，您打算创建具有某种状态或内容的对象。去做吧。无需创建一个无用的（因为空的）临时。

# concurrency - 如何告诉多核/多 CPU 机器并行处理循环中的函数调用？

> ID：56769
> 
> 赞同：7
> 
> 时间：2008-09-11T14:54:59.303
> 
> 标签：concurrency, mapreduce

我目前正在设计一个应用程序，该应用程序具有一个模块，该模块将从数据库中加载大量数据，并根据情况通过各种计算将其减少到更小的集合。

许多更密集的操作具有确定性，并且适合并行处理。

如果我有一个循环遍历从数据库到达的大量数据块，并且每个数据块都调用一个没有副作用的确定性函数，我将如何制作它以便程序不等待函数返回而是设置下一个电话，所以他们可以并行处理？一种天真的方法来证明这个原则现在对我有用。

我已经阅读了 Google 的 MapReduce 论文，虽然我可以在很多地方使用总体原理，但我现在不会针对大型集群，而是将其作为 1.0 版的单个多核或多 CPU 机器. 所以目前，我不确定我是否可以真正使用该库，或者自己必须推出一个简化的基本版本。

我处于设计过程的早期阶段，到目前为止，我将 C-something（用于速度关键位）和 Python（用于生产力关键位）作为我的语言。如果有令人信服的理由，我可能会切换，但到目前为止我对我的选择感到满意。

请注意，我知道从数据库中检索下一个块可能比处理当前块需要更长的时间，然后整个过程将受 I/O 限制。但是，我现在假设它不是，并且在实践中使用数据库集群或内存缓存或其他东西在这一点上不受 I/O 限制。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-11T14:58:23.007

[好吧，如果 .net 是一个选项，他们已经在Parallel Computing](http://msdn.microsoft.com/en-us/concurrency/default.aspx)上投入了很多精力。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-11T14:58:58.920

[您可以从 Google 的MapReduce](http://labs.google.com/papers/mapreduce.html)实现该算法，而无需物理上独立的机器。只需将这些“机器”中的每一个都视为“线程”。线程自动分布在多核机器上。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-15T19:57:34.130

如果您仍打算使用 Python，您可能想看看[Processing](http://pypi.python.org/pypi/processing)。它使用进程而不是线程进行并行计算（由于 Python GIL），并提供用于将“工作项”分配到多个进程的类。使用 pool 类，您可以编写如下代码：

```
import processing

def worker(i):
    return i*i
num_workers = 2
pool = processing.Pool(num_workers)
result = pool.imap(worker, range(100000)) 
```

这是 itertools.imap 的并行版本，它将调用分配给进程。您还可以使用池的 apply_async 方法并将惰性结果对象存储在列表中：

```
results = []
for i in range(10000):
    results.append(pool.apply_async(worker, i)) 
```

如需进一步参考，请参阅[Pool 类的文档](http://pyprocessing.berlios.de/doc/pool-objects.html)。

陷阱：

*   处理使用 fork()，所以你必须小心 Win32
*   在进程之间传输的对象需要是可腌制的
*   如果工人相对较快，您可以调整块大小，即一批发送到工作进程的工作项数
*   processing.Pool 使用后台线程

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-11T17:34:59.997

如果您正在使用支持它的编译器，我建议您查看[http://www.openmp.org](http://www.openmp.org)，了解一种注释代码的方式，以使某些循环可以并行化。

它还有更多功能，您可能会发现它很有帮助。

例如，他们的网页报告说 gcc4.2 将支持 openmp。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-12T00:29:38.860

我可能在这里遗漏了一些东西，但这使用 pthreads 似乎相当简单。

设置一个小线程池，里面有 N 个线程，并有一个线程来控制它们。

主线程只是位于一个循环中，执行以下操作：

1.  从数据库中获取数据块
2.  查找下一个空闲线程 如果没有空闲线程，则等待
3.  将块移交给工作线程
4.  返回并从数据库中获取下一个块

与此同时，他们坐下来做的工作线程：

1.  将自己标记为自由
2.  等待桅杆线程给我一大块数据
3.  处理数据块
4.  再次将自己标记为自由

实现这一点的方法可以像两个互斥控制数组一样简单。一个有工作线程（线程池），另一个指示每个相应线程是空闲还是忙碌。

根据您的喜好调整 N...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-10T12:00:41.313

java中使用相同的线程池。但是线程池中的线程是可序列化的并发送到其他计算机并反序列化以运行。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-10-28T13:03:20.313

我开发了一个 MapReduce 库，用于在单个服务器上进行多线程/多核使用。一切都由库处理，用户只需要实现 Map 和 Reduce。它被定位为 Boost 库，但尚未被接受为正式库。查看[http://www.craighenderson.co.uk/mapreduce](http://www.craighenderson.co.uk/mapreduce)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-10-28T13:09:33.423

您可能有兴趣检查[libdispatch](http://libdispatch.macosforge.org/)的代码，它是 Apple 的 Grand Central Dispatch 的开源实现。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-10-28T13:26:44.020

您也可能对英特尔的 TBB 或 boost::mpi 感兴趣。

# asp.net - 如何使用动态导航制作动态内容？

> ID：56770
> 
> 赞同：0
> 
> 时间：2008-09-11T14:55:02.157
> 
> 标签：asp.net, database, database-design, web-applications

我正在创建一个 ASP.NET 网站，其中所有页面都挂在数据库驱动的树层次结构上。页面通常呈现 HTML 内容。但是，有些人会执行编程。

*例子：*

1.  “联系我们”表格
2.  报告生成器

我应该如何表示/引用数据库中的编程？我应该有一个 Web 用户控件 (.ascx) 名称的 varchar 值吗？还是 Web 窗体 (.aspx) 名称？还有什么？还是应该只是我的应用程序中字典中的整数或其他此类 ID？

我可以用这种结构制作一个 ASP.NET 站点地图提供程序吗？

在此处查看更多信息：[哪个是我导航的最佳数据库架构？](https://stackoverflow.com/questions/56981/which-is-the-best-database-schema-for-my-navigation)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-11T17:56:32.690

您可以考虑`<my:contact-us-form/>`在特定页面的数据库中插入占位符；这样，数据库可以描述所有静态文本内容，而不是用`.ascx`控件完全替换数据库驱动的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T15:48:48.237

我们的开发团队已经成功地在数据库中定义了 Web 用户控件的名称。在页面加载时，它也会检查从数据库中动态加载的控件。

我们使用 Web 用户控件而不是 Web 表单，以确保我们可以在任何页面上使用该控件。

您还可以使用 ASP.Net 的提供程序动态构建站点地图。[CodeProject](http://www.codeproject.com/KB/aspnet/dynamicsitemap.aspx)有一个很好的例子。

# javascript - 如何将焦点设置到 HTML5 画布元素？

> ID：56771
> 
> 赞同：16
> 
> 时间：2008-09-11T14:55:02.673
> 
> 标签：javascript, canvas, focus

我在`<canvas>`iMac 上使用 Firefox 2.0.0.16 和 Safari 3.1.2 中的 HTML5 元素。（我也在 Windows 上的 Firefox 3.0 中尝试过，但也无济于事。）标签如下所示：

```
<td>
   <canvas id="display"
           width="500px"
           height="500px">
   </canvas>
</td> 
```

我有一个按钮来“激活”一些与画布交互的功能。该按钮的`onclick()`事件调用一个函数。在该函数中，我有以下行：

```
document.getElementById("display").focus(); 
```

这不起作用。Firebug 报告没有错误。但焦点仍然在原处。我可以单击画布或朝向画布的选项卡，焦点将从其他元素中丢失，但显然永远不会被画布获得（画布的`onfocus()`事件永远不会触发）。

我觉得这很奇怪。是画布根本无法获得焦点，还是我在这里遗漏了什么？任何见解将不胜感激。

谢谢你。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-09-11T18:54:35.983

给画布一个标签索引：

```
 <canvas id="display"
           width="500px"
           height="500px"
           tabindex="1">
   </canvas> 
```

# hosting - 我需要在标准服务器机架上留出空隙吗？

> ID：56786
> 
> 赞同：4
> 
> 时间：2008-09-11T14:59:29.260
> 
> 标签：hosting, rack

我们有一个 42U 机架，很快就会收到一批新的 1U 和 2U 服务器。这里的一个人认为您需要在服务器（1U）之间留出空隙以帮助冷却。

问题是，你呢？环顾数据中心时，似乎没有其他人在，这也减少了我们可以适应的程度。我们使用的是戴尔 1850 和 2950 硬件。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-11T15:01:22.517

不，服务器和交换机、KVM 和 PSU 都设计为堆叠在彼此顶部的机架上。我的基础是为 AT&T 建立了几年的 CO 和数据中心。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-11T16:55:29.000

您无需在系统之间为设计为机架安装的齿轮留出间隙。如果您自己构建系统，则需要仔细选择组件：一些 CPU + 主板运行太热，即使它们可以物理地放入 1U 机箱中。

戴尔设备会很好。

您*确实*需要保持机架之间和后面的空间没有杂乱。今天的大多数服务器都将气流从前向后引导，如果您没有在机架后面留下足够的露天空气，那么机架后面会变得非常热并降低冷却能力。

在典型的 48 端口交换机上，前面板覆盖有 RJ-45 连接器，后面板覆盖有冗余电源连接、PoE 电源托盘连接、堆叠端口和上行链路。许多 1U 网络交换机将它们的气流左右排列，因为它们无法从前后连接器的迷宫中获得足够的空气。所以你还需要确保机架旁边的通道相对开放，让交换机获得足够的气流。

在拥挤的服务器机架中，整洁很重要。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-11T17:14:14.897

我同意 Unkwntech 的观点，通常不需要间隙，但我认为有两点需要注意：

1) 如果安装在更深的设备下方（见下文），不如其他设备那么深的设备可能会出现通风问题。在通风良好的服务器机房中，这当然不是问题。

```
TOP OF RACK
===============
===============
===============
===============
===============
======== (Shallow equipment, trapped hot air) 
```

2) 在机柜中安装设备时，通常需要在顶部留出几英寸的空间以保证适当的通风。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-11T15:02:25.637

一般来说，没有。这就是 1U 服务器的全部要点：如果它需要额外的空间（甚至用于冷却），他们会给它一个更大的机箱并称之为 2U。在某些设计中，气流受到控制并且只需要冷却机架，这种间隙甚至会适得其反，因为它允许来自后面的暖空气流动并与前面的冷空气混合，从而减少冷却效率。即使您有逻辑分组的间隙，您也应该用空白面板将它们塞住以控制气流。

不幸的是，在实践中，一些白盒供应商偶尔会为 1U 指定过于努力，并且您会发现，如果您堆叠太多太靠近而没有偶尔的气流间隙，您就会遇到问题。这对于优质服务器和足够的冷却设计来说不是问题，但市场的底端可能会让您感到惊讶。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-11T17:01:03.463

我工作的最后两个地方有大型数据中心，它们将所有服务器和设备堆叠在一起，没有间隙。服务器的内部风扇有足够的冷却能力。还建议在架空地板上运行机架，机架前部有穿孔瓷砖，机架后部上方有空调空气回流以进行循环。

# bash - 将脚本从 ksh 转换为 bash

> ID：56798
> 
> 赞同：1
> 
> 时间：2008-09-11T15:01:58.850
> 
> 标签：bash, unix, ksh

我有一些 ksh 脚本，我想将其转换为使用 bash 运行。

有什么有用的在线资源吗？

我真的在寻找两个 shell 之间的差异列表以及我可能遇到的任何问题，尽管欢迎提供所有信息:-)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-11T15:06:58.260

您是否尝试过查看[此](http://www.faqs.org/faqs/unix-faq/shell/shell-differences/)页面？它有一个有用的特性矩阵和到其他地方的链接。

还有[这个](http://www.faqs.org/faqs/unix-faq/shell/bash/)链接，搜索：

> C2) bash 与 Korn shell 有何不同

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-11T16:00:56.727

以下是 HP 对 shell 之间差异的比较：

*   [http://docs.hp.com/en/B2355-90046/ch15s03.html](http://docs.hp.com/en/B2355-90046/ch15s03.html)

这是来自 Richard 的 Shell Scripting Universe 的一组很棒的 UNIX shell 教程：

*   [http://www.injunea.demon.co.uk/index.htm](http://www.injunea.demon.co.uk/index.htm)

第二个是迄今为止我发现的最有用的脚本资源之一，它确实可以帮助您学习如何在考虑到可移植性的情况下编写脚本。

祝您转化成功。

# sqlclr - SQLCLR中连接字符串的区别

> ID：56801
> 
> 赞同：2
> 
> 时间：2008-09-11T15:02:20.893
> 
> 标签：sqlclr

我正在查看顾问签入的一些代码，并注意到他们正在使用 SQLCLR。我没有任何经验，所以我想我会研究它是关于什么的。我注意到他们使用

```
Dim cn As New SqlConnection("server=LOCALHOST;integrated security=yes;database=" & sDb) 
```

代替

```
DIM conn As New SqlConnection("context connection=true") 
```

我想知道第一个是 localhost 有什么区别？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-11T15:19:57.637

上下文连接使用用户已经建立的到服务器的连接。因此，您可以继承它们的数据库上下文、连接选项等内容。

使用 localhost 将使用普通的共享内存连接连接到服务器。如果您不想使用用户的连接（即，如果您想连接到不同的数据库，或者使用不同的选项等），这可能很有用。

在大多数情况下，您应该使用上下文连接，因为它不会创建到服务器的单独连接。

另外，请注意，使用单独的连接意味着您不是用户事务的一部分，并且受制于正常的锁定语义。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T15:27:02.847

考虑一个大型办公电话系统：

我的办公室有一个内部电话系统。但是每部电话也有一个外部电话号码（使用一组真实 TELCO 线路的虚拟号码）。我可以通过直接拨打他们的电话分机来呼叫另一个办公室，并且该呼叫将通过我们的内部电话系统（单跳）进行路由。或者，我可以拨打该电话的公共号码，然后呼叫从大楼的系统路由到电信公司的交换局，然后通过大楼的系统返回到办公室分机（3 跳）。

当连接到连接字符串中指定的服务器时，第一个 SQL 连接的行为与任何标准 SQL 连接一样。使用标准本机 SQL 连接创建新连接。这就像拨打另一部办公电话的完整公共电话号码一样。当然，您正在连接到本地计算机，但连接的路由方式不同。

上下文连接具有使用正在执行 SQLCLR 对象的现有连接的新 SqlConnection 实例。它使用现有/本地上下文。这就像直接拨打我办公室同事的分机一样。本地上下文更高效。

虽然我并不肯定，但我相信在使用上下文连接时，对 SQLCLR 对象的调用也会参与上下文的事务。如果我错了，请有人纠正我。

彼得

# c - 如何在纯 C 中启动线程？

> ID：56810
> 
> 赞同：56
> 
> 时间：2008-09-11T15:04:25.053
> 
> 标签：c, multithreading

我在 C 中使用了 fork() 来启动另一个进程。如何开始一个新线程？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2008-09-11T15:09:22.577

既然你提到了 fork() 我假设你在一个类 Unix 系统上，在这种情况下你想要使用[POSIX 线程](http://en.wikipedia.org/wiki/POSIX_Threads)（通常称为 pthreads）。

具体来说， pthread_create() 是创建新线程所需的函数。它的论点是：

```
int  pthread_create(pthread_t  *  thread, pthread_attr_t * attr, void *
   (*start_routine)(void *), void * arg); 
```

第一个参数是返回的指向线程 id 的指针。第二个参数是线程参数，除非您想以特定优先级启动线程，否则它可以为 NULL。第三个参数是线程执行的函数。第四个参数是执行时传递给线程函数的单个参数。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-11T15:10:20.717

AFAIK，ANSI C 没有定义线程，但是有各种可用的库。

如果您在 Windows 上运行，请链接到 msvcrt 并使用 _beginthread 或 _beginthreadex。

如果您在其他平台上运行，请查看 pthreads 库（我相信还有其他的）。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2018-09-22T03:40:01.197

**C11 螺纹 + C11`atomic_int`**

添加到 glibc 2.28。通过从源代码编译 glibc 2.28 在 Ubuntu 18.10 amd64（带有 glic 2.28）和 Ubuntu 18.04（带有 glibc 2.27）中进行测试：[单个主机上的多个 glibc 库](https://stackoverflow.com/questions/847179/multiple-glibc-libraries-on-a-single-host/52454603#52454603)

示例改编自：[https ://en.cppreference.com/w/c/language/atomic](https://en.cppreference.com/w/c/language/atomic)

主程序

```
#include <stdio.h>
#include <threads.h>
#include <stdatomic.h>

atomic_int atomic_counter;
int non_atomic_counter;

int mythread(void* thr_data) {
    (void)thr_data;
    for(int n = 0; n < 1000; ++n) {
        ++non_atomic_counter;
        ++atomic_counter;
        // for this example, relaxed memory order is sufficient, e.g.
        // atomic_fetch_add_explicit(&atomic_counter, 1, memory_order_relaxed);
    }
    return 0;
}

int main(void) {
    thrd_t thr[10];
    for(int n = 0; n < 10; ++n)
        thrd_create(&thr[n], mythread, NULL);
    for(int n = 0; n < 10; ++n)
        thrd_join(thr[n], NULL);
    printf("atomic     %d\n", atomic_counter);
    printf("non-atomic %d\n", non_atomic_counter);
} 
```

[GitHub 上游](https://github.com/cirosantilli/linux-kernel-module-cheat/blob/e0fb39c92ae071a444cb92fbb2d0c1977fa7af51/userland/c/atomic.c).

编译并运行：

```
gcc -ggdb3 -std=c11 -Wall -Wextra -pedantic -o main.out main.c -pthread
./main.out 
```

可能的输出：

```
atomic     10000
non-atomic 4341 
```

由于跨线程对非原子变量的快速访问，非原子计数器很可能小于原子计数器。

另请参阅：[如何在 C 中进行原子增量和获取？](https://stackoverflow.com/questions/2353371/how-to-do-an-atomic-increment-and-fetch-in-c/30878480#30878480)

**拆解分析**

拆卸：

```
gdb -batch -ex "disassemble/rs mythread" main.out 
```

包含：

```
17              ++non_atomic_counter;
   0x00000000004007e8 <+8>:     83 05 65 08 20 00 01    addl   $0x1,0x200865(%rip)        # 0x601054 <non_atomic_counter>

18              __atomic_fetch_add(&atomic_counter, 1, __ATOMIC_SEQ_CST);
   0x00000000004007ef <+15>:    f0 83 05 61 08 20 00 01 lock addl $0x1,0x200861(%rip)        # 0x601058 <atomic_counter> 
```

所以我们看到原子增量是在带有[`f0`锁前缀](https://stackoverflow.com/questions/8891067/what-does-the-lock-instruction-mean-in-x86-assembly)的指令级完成的。

使用`aarch64-linux-gnu-gcc`8.2.0，我们得到了：

```
11              ++non_atomic_counter;
   0x0000000000000a28 <+24>:    60 00 40 b9     ldr     w0, [x3]
   0x0000000000000a2c <+28>:    00 04 00 11     add     w0, w0, #0x1
   0x0000000000000a30 <+32>:    60 00 00 b9     str     w0, [x3]

12              ++atomic_counter;
   0x0000000000000a34 <+36>:    40 fc 5f 88     ldaxr   w0, [x2]
   0x0000000000000a38 <+40>:    00 04 00 11     add     w0, w0, #0x1
   0x0000000000000a3c <+44>:    40 fc 04 88     stlxr   w4, w0, [x2]
   0x0000000000000a40 <+48>:    a4 ff ff 35     cbnz    w4, 0xa34 <mythread+36> 
```

所以原子版本实际上有一个`cbnz`循环运行，直到`stlxr`存储成功。请注意，ARMv8.1 可以通过一条 LDADD 指令完成所有这些操作。

这类似于我们使用 C++ 得到的`std::atomic`：[std::atomic 到底是什么？](https://stackoverflow.com/questions/31978324/what-exactly-is-stdatomic/58904448#58904448)

**基准**

去做。建立一个基准以表明 atomic 速度较慢。

**POSIX 线程**

主程序

```
#define _XOPEN_SOURCE 700
#include <assert.h>
#include <stdlib.h>
#include <pthread.h>

enum CONSTANTS {
    NUM_THREADS = 1000,
    NUM_ITERS = 1000
};

int global = 0;
int fail = 0;
pthread_mutex_t main_thread_mutex = PTHREAD_MUTEX_INITIALIZER;

void* main_thread(void *arg) {
    int i;
    for (i = 0; i < NUM_ITERS; ++i) {
        if (!fail)
            pthread_mutex_lock(&main_thread_mutex);
        global++;
        if (!fail)
            pthread_mutex_unlock(&main_thread_mutex);
    }
    return NULL;
}

int main(int argc, char **argv) {
    pthread_t threads[NUM_THREADS];
    int i;
    fail = argc > 1;
    for (i = 0; i < NUM_THREADS; ++i)
        pthread_create(&threads[i], NULL, main_thread, NULL);
    for (i = 0; i < NUM_THREADS; ++i)
        pthread_join(threads[i], NULL);
    assert(global == NUM_THREADS * NUM_ITERS);
    return EXIT_SUCCESS;
} 
```

编译并运行：

```
gcc -std=c99 -Wall -Wextra -pedantic -o main.out main.c -pthread
./main.out
./main.out 1 
```

第一次运行正常，第二次由于缺少同步而失败。

似乎没有 POSIX 标准化的原子操作：[UNIX Portable Atomic Operations](https://stackoverflow.com/questions/1130018/unix-portable-atomic-operations)

在 Ubuntu 18.04 上测试。[GitHub 上游](https://github.com/cirosantilli/cpp-cheat/blob/1778918f77bc913915386e602ad29f8505e73073/posix/pthread_mutex.c).

**GCC`__atomic_*`内置**

对于那些没有 C11 的人，您可以使用`__atomic_*`GCC 扩展来实现原子增量。

主程序

```
#define _XOPEN_SOURCE 700
#include <pthread.h>
#include <stdatomic.h>
#include <stdio.h>
#include <stdlib.h>

enum Constants {
    NUM_THREADS = 1000,
};

int atomic_counter;
int non_atomic_counter;

void* mythread(void *arg) {
    (void)arg;
    for (int n = 0; n < 1000; ++n) {
        ++non_atomic_counter;
        __atomic_fetch_add(&atomic_counter, 1, __ATOMIC_SEQ_CST);
    }
    return NULL;
}

int main(void) {
    int i;
    pthread_t threads[NUM_THREADS];
    for (i = 0; i < NUM_THREADS; ++i)
        pthread_create(&threads[i], NULL, mythread, NULL);
    for (i = 0; i < NUM_THREADS; ++i)
        pthread_join(threads[i], NULL);
    printf("atomic     %d\n", atomic_counter);
    printf("non-atomic %d\n", non_atomic_counter);
} 
```

编译并运行：

```
gcc -ggdb3 -O3 -std=c99 -Wall -Wextra -pedantic -o main.out main.c -pthread
./main.out 
```

输出和生成的程序集：与“C11 线程”示例相同。

在 Ubuntu 16.04 amd64、GCC 6.4.0 中测试。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-11T15:08:00.020

pthreads 是一个好的开始，看[这里](https://computing.llnl.gov/tutorials/pthreads/)

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-11T16:03:18.517

线程不是 C 标准的一部分，因此使用线程的唯一方法是使用某些库（例如：Unix/Linux 中的 POSIX 线程，如果您想使用该线程的 C 运行时或只是 CreateThread Win32，则为 _beginthread/_beginthreadex API)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-11T15:08:36.040

查看[pthread](https://computing.llnl.gov/tutorials/pthreads/)（POSIX 线程）库。

# web-services - CF 中不需要 BOM，但由 IIS/SharePoint 发送

> ID：56812
> 
> 赞同：2
> 
> 时间：2008-09-11T15:05:57.233
> 
> 标签：web-services, sharepoint, iis, coldfusion, byte-order-mark

我正在尝试通过 cfinvoke 从 ColdFusion 使用 SharePoint Web 服务（因为我不想处理（阅读：解析）SOAP 响应本身）。

SOAP 响应包含一个字节顺序标记字符 (BOM)，它在 CF 中产生以下异常：

```
"Cannot perform web service invocation GetList.
The fault returned when invoking the web service operation is:
'AxisFault
faultCode: {http://www.w3.org/2003/05/soap-envelope}Server.userException
faultSubcode:
faultString: org.xml.sax.SAXParseException: Content is not allowed in prolog." 
```

UTF-8 编码标准可选地包括 BOM 字符 ( [http://unicode.org/faq/utf_bom.html#29](http://unicode.org/faq/utf_bom.html#29) )。Microsoft 几乎普遍包含带有 UTF-8 编码流的 BOM 字符。据我所知，在 IIS 中无法改变它。JRun (ColdFusion) 默认使用的 XML 解析器不处理 UTF-8 编码的 XML 流的 BOM 字符。因此，解决此问题的方法似乎是更改 JRun 使用的 XML 解析器（[http://www.bpurcell.org/blog/index.cfm?mode=entry&entry=942](http://www.bpurcell.org/blog/index.cfm?mode=entry&entry=942)）。

Adobe 说它不处理 BOM 字符（请参阅 5 月 2 日和 5 日来自 anonynomous 和 halL 的评论）。
[http://livedocs.adobe.com/coldfusion/8/htmldocs/Tags_g-h_09.html#comments](http://livedocs.adobe.com/coldfusion/8/htmldocs/Tags_g-h_09.html#comments)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-11T15:37:35.300

我要说的是，您的问题的答案（有可能吗？）是否定的。我不确定这一点，但是在大厅上方发表评论的发帖人（[在本页的评论中](http://livedocs.adobe.com/coldfusion/8/htmldocs/help.html?content=Tags_g-h_09.html#comments)）给出了解决该问题的方法——所以我认为在手动解析时可以处理。

您说您正在使用 CFInvoke 是因为您不想自己处理肥皂响应。看起来你别无选择。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T15:33:16.673

正如 Adam Tuttle 已经说过的，解决方法在您链接到的页面上

```
<!--- Remove BOM from the start of the string, if it exists --->
<cfif Left(responseText, 1) EQ chr(65279)>
<cfset responseText = mid(xmlText, 2, len(responseText))>
</cfif> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T15:32:34.657

听起来 ColdFusion 在幕后使用了 Apache Axis。

这并不完全适用于您的解决方案，但是在使用 Apache Axis/Java 使用 .NET Web 服务之前，我不得不处理过这个问题。我能找到的唯一解决方案（因为 Web 服务的所有者不愿意更改他的任何内容）是编写一个 Handler 类，Axis 将插入到管道中，如果存在的话，它将从消息中删除 BOM。

那么也许可以通过 ColdFusion 配置 Axis？如果是这样，[您可以向消息处理流程添加额外的处理程序](http://wiki.apache.org/ws/FrontPage/Axis/AxisClientConfiguration)。

# python - round() 似乎没有正确舍入

> ID：56820
> 
> 赞同：138
> 
> 时间：2008-09-11T15:08:09.240
> 
> 标签：python, floating-point, rounding

[round()](http://docs.python.org/lib/built-in-funcs.html)函数的文档说明您将其传递给一个数字，并将小数点后的位置进行四舍五入。因此它*应该*这样做：

```
n = 5.59
round(n, 1) # 5.6 
```

但是，实际上，很好的旧浮点怪异现象逐渐出现，你会得到：

```
5.5999999999999996 
```

出于 UI 的目的，我需要显示`5.6`. 我在 Internet 上浏览了一下，发现了一些[文档](http://mail.python.org/pipermail/python-list/2005-September/340383.html)，这取决于我对 Python 的实现。不幸的是，这发生在我的 Windows 开发机器和我尝试过的每台 Linux 服务器上。[另请参见此处](http://www.python.org/doc/2.5.1/tut/node16.html)。

没有创建我自己的圆形库，有什么办法解决这个问题吗？

* * *

## 回答 #1

> 赞同：107
> 
> 时间：2008-09-11T15:11:41.400

我无法帮助它的存储方式，但至少格式可以正常工作：

```
'%.1f' % round(n, 1) # Gives you '5.6' 
```

* * *

## 回答 #2

> 赞同：103
> 
> 时间：2008-09-11T15:14:22.033

即使无需四舍五入，格式也能正常工作：

```
"%.1f" % n 
```

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2013-03-13T23:48:33.637

如果您使用 Decimal 模块，您可以在不使用“round”函数的情况下进行近似。这是我一直在使用的舍入方法，尤其是在编写货币应用程序时：

```
from decimal import Decimal, ROUND_UP

Decimal(str(16.2)).quantize(Decimal('.01'), rounding=ROUND_UP) 
```

这将返回一个十进制数，即 16.20。

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2008-09-11T21:27:35.070

`round(5.59, 1)`工作正常。问题是 5.6 不能用二进制浮点数精确表示。

```
>>> 5.6
5.5999999999999996
>>> 
```

正如 Vinko 所说，您可以使用字符串格式进行舍入以进行显示。

如果需要，Python 有一个[用于十进制算术的模块。](http://docs.python.org/lib/module-decimal.html)

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2008-09-11T15:13:28.777

如果你这样做，你会得到 '5.6'`str(round(n, 1))`而不是`round(n, 1)`.

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-09-11T15:12:19.013

您可以将数据类型切换为整数：

```
>>> n = 5.59
>>> int(n * 10) / 10.0
5.5
>>> int(n * 10 + 0.5)
56 
```

然后通过插入区域设置的小数分隔符来显示数字。

但是，[吉米的答案](https://stackoverflow.com/questions/56820/round-in-python-doesnt-seem-to-be-rounding-properly#56833)更好。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-09-11T15:13:32.487

浮点数学容易受到轻微但令人讨厌的精度误差的影响。如果您可以使用整数或定点，则可以保证精度。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2010-07-12T04:12:38.953

看看[Decimal 模块](http://docs.python.org/library/decimal.html)

> 十进制“基于一个以人为本设计的浮点模型，并且必然有一个最重要的指导原则——计算机必须提供一种与人们在学校学习的算术相同的算术。” – 十进制算术规范的摘录。

和

> 十进制数可以精确表示。相反，像 1.1 和 2.2 这样的数字在二进制浮点中没有精确的表示。最终用户通常不会期望 1.1 + 2.2 像二进制浮点那样显示为 3.3000000000000003。

Decimal 提供的操作使编写需要浮点运算的应用程序变得容易，并且*还*需要以人类可读的格式（例如会计）呈现这些结果。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2013-06-25T12:00:58.487

确实是个大问题。试试这个代码：

```
print "%.2f" % (round((2*4.4+3*5.6+3*4.4)/8,2),) 
```

它显示 4.85。然后你做：

```
print "Media = %.1f" % (round((2*4.4+3*5.6+3*4.4)/8,1),) 
```

它显示 4.8。您是否手动计算，确切答案是 4.85，但如果您尝试：

```
print "Media = %.20f" % (round((2*4.4+3*5.6+3*4.4)/8,20),) 
```

您可以看到真相：浮点数存储为分母为 2 的幂的最接近的有限和。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-09-11T15:14:15.623

**printf**吸盘。

```
print '%.1f' % 5.59  # returns 5.6 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2020-02-19T07:23:49.787

`round()`在这种情况下，我会完全避免依赖。考虑

```
print(round(61.295, 2))
print(round(1.295, 2)) 
```

将输出

```
61.3
1.29 
```

如果您需要四舍五入到最接近的整数，这不是所需的输出。要绕过这种行为`math.ceil()`（或者`math.floor()`如果你想四舍五入）：

```
from math import ceil
decimal_count = 2
print(ceil(61.295 * 10 ** decimal_count) / 10 ** decimal_count)
print(ceil(1.295 * 10 ** decimal_count) / 10 ** decimal_count) 
```

输出

```
61.3
1.3 
```

希望有帮助。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-09-11T15:12:25.050

您可以使用字符串格式运算符`%`，类似于 sprintf。

```
mystring = "%.2f" % 5.5999 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2017-02-24T15:57:46.700

我在做：

```
int(round( x , 0)) 
```

在这种情况下，我们首先在单位级别正确舍入，然后转换为整数以避免打印浮点数。

所以

```
>>> int(round(5.59,0))
6 
```

我认为这个答案比格式化字符串效果更好，而且使用 round 函数对我来说也更有意义。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2015-11-18T04:10:22.283

完美运行

```
format(5.59, '.1f') # to display
float(format(5.59, '.1f')) #to round 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2020-05-15T13:29:32.097

另一个潜在的选择是：

```
def hard_round(number, decimal_places=0):
    """
    Function:
    - Rounds a float value to a specified number of decimal places
    - Fixes issues with floating point binary approximation rounding in python
    Requires:
    - `number`:
        - Type: int|float
        - What: The number to round
    Optional:
    - `decimal_places`:
        - Type: int 
        - What: The number of decimal places to round to
        - Default: 0
    Example:
    ```
    hard_round(5.6,1)
    ```
    """
    return int(number*(10**decimal_places)+0.5)/(10**decimal_places) 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2018-03-08T03:29:12.107

代码：

```
x1 = 5.63
x2 = 5.65
print(float('%.2f' % round(x1,1)))  # gives you '5.6'
print(float('%.2f' % round(x2,1)))  # gives you '5.7' 
```

输出：

```
5.6
5.7 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2018-04-11T14:05:40.830

问题仅在最后一位为 5 时。例如。0.045 在内部存储为 0.044999999999999...您可以简单地将最后一位数增加到 6 并四舍五入。这将为您提供所需的结果。

```
import re

def custom_round(num, precision=0):
    # Get the type of given number
    type_num = type(num)
    # If the given type is not a valid number type, raise TypeError
    if type_num not in [int, float, Decimal]:
        raise TypeError("type {} doesn't define __round__ method".format(type_num.__name__))
    # If passed number is int, there is no rounding off.
    if type_num == int:
        return num
    # Convert number to string.
    str_num = str(num).lower()
    # We will remove negative context from the number and add it back in the end
    negative_number = False
    if num < 0:
        negative_number = True
        str_num = str_num[1:]
    # If number is in format 1e-12 or 2e+13, we have to convert it to
    # to a string in standard decimal notation.
    if 'e-' in str_num:
        # For 1.23e-7, e_power = 7
        e_power = int(re.findall('e-[0-9]+', str_num)[0][2:])
        # For 1.23e-7, number = 123
        number = ''.join(str_num.split('e-')[0].split('.'))
        zeros = ''
        # Number of zeros = e_power - 1 = 6
        for i in range(e_power - 1):
            zeros = zeros + '0'
        # Scientific notation 1.23e-7 in regular decimal = 0.000000123
        str_num = '0.' + zeros + number
    if 'e+' in str_num:
        # For 1.23e+7, e_power = 7
        e_power = int(re.findall('e\+[0-9]+', str_num)[0][2:])
        # For 1.23e+7, number_characteristic = 1
        # characteristic is number left of decimal point.
        number_characteristic = str_num.split('e+')[0].split('.')[0]
        # For 1.23e+7, number_mantissa = 23
        # mantissa is number right of decimal point.
        number_mantissa = str_num.split('e+')[0].split('.')[1]
        # For 1.23e+7, number = 123
        number = number_characteristic + number_mantissa
        zeros = ''
        # Eg: for this condition = 1.23e+7
        if e_power >= len(number_mantissa):
            # Number of zeros = e_power - mantissa length = 5
            for i in range(e_power - len(number_mantissa)):
                zeros = zeros + '0'
            # Scientific notation 1.23e+7 in regular decimal = 12300000.0
            str_num = number + zeros + '.0'
        # Eg: for this condition = 1.23e+1
        if e_power < len(number_mantissa):
            # In this case, we only need to shift the decimal e_power digits to the right
            # So we just copy the digits from mantissa to characteristic and then remove
            # them from mantissa.
            for i in range(e_power):
                number_characteristic = number_characteristic + number_mantissa[i]
            number_mantissa = number_mantissa[i:]
            # Scientific notation 1.23e+1 in regular decimal = 12.3
            str_num = number_characteristic + '.' + number_mantissa
    # characteristic is number left of decimal point.
    characteristic_part = str_num.split('.')[0]
    # mantissa is number right of decimal point.
    mantissa_part = str_num.split('.')[1]
    # If number is supposed to be rounded to whole number,
    # check first decimal digit. If more than 5, return
    # characteristic + 1 else return characteristic
    if precision == 0:
        if mantissa_part and int(mantissa_part[0]) >= 5:
            return type_num(int(characteristic_part) + 1)
        return type_num(characteristic_part)
    # Get the precision of the given number.
    num_precision = len(mantissa_part)
    # Rounding off is done only if number precision is
    # greater than requested precision
    if num_precision <= precision:
        return num
    # Replace the last '5' with 6 so that rounding off returns desired results
    if str_num[-1] == '5':
        str_num = re.sub('5$', '6', str_num)
    result = round(type_num(str_num), precision)
    # If the number was negative, add negative context back
    if negative_number:
        result = result * -1
    return result 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2018-02-22T01:14:59.093

这是我看到回合失败的地方。如果您想将这两个数字四舍五入到小数点后一位怎么办？23.45 23.55 我的教育是从四舍五入你应该得到： 23.4 23.6 “规则”是如果前面的数字是奇数，你应该四舍五入，如果前面的数字是偶数，你应该四舍五入。python中的round函数只是截断5。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2021-01-19T06:37:07.453

这是一种将浮点数四舍五入到任意小数位的简单方法，它在 2021 年仍然有效！

```
float_number = 12.234325335563
rounded = round(float_number, 3) # 3 is the number of decimal places to be returned.You can pass any number in place of 3 depending on how many decimal places you want to return.
print(rounded) 
```

这将打印出来；

```
12.234 
```

* * *

## 回答 #20

> 赞同：-4
> 
> 时间：2008-09-11T15:11:04.430

关于什么：

```
round(n,1)+epsilon 
```

# xml - 如何使用 XSLT 制作 xml 节点的子节点的精确副本？

> ID：56837
> 
> 赞同：3
> 
> 时间：2008-09-11T15:12:03.397
> 
> 标签：xml, xslt, xhtml

我的问题是我的 XML 文档在其中包含 XHTML 的片段，并且在通过 XSLT 传递它时，我希望它能够呈现这些片段而不破坏它们。

我尝试将片段包装在 CDATA 中，但它不起作用，因为小于和大于被转换为 < 和 >，而不是直接回显。

执行此操作所需的 XSL 是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-12T07:57:31.840

```
<xsl:template match="@*|node()">
  <xsl:copy>
    <xsl:apply-templates select="@*|node()"/>
  </xsl:copy>
</xsl:template> 
```

[这在XSLT 规范](http://www.w3.org/TR/xslt#copying)中称为“身份转换” 。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-11-08T04:45:55.883

我遇到了那个问题，副本当然是最容易使用的。标识有效，但这是 5 行代码，您需要调用这样的模板，而不仅仅是在 XSLT 文档中定义它（否则您可能无法在输出中得到预期的结果。）

我的主要问题实际上是复制标签的内容，而不是标签本身。它实际上很容易解决，但我花了一点时间才弄清楚（可能是因为 QtXmlPatterns 崩溃了很多！）

因此，以下内容复制了此处命名的标签及其所有子标签：

```
<xsl:copy-of select="this/tag/here"/> 
```

但大多数情况下您不想这样做，因为 <here> 实际上是容器，换句话说，它不应该出现在输出中。在这种情况下，您可以简单地这样做：

```
<xsl:copy-of select="this/tag/here/*"/> 
```

这将复制在名为 <here> 的标记中找到的所有子项。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-12T07:52:23.303

假设您的 xhtml 在元素 YYY 中

[http://www.dpawson.co.uk/xsl/sect2/N1930.html](http://www.dpawson.co.uk/xsl/sect2/N1930.html)解释选项

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-11T15:16:39.003

xsl：副本

# java - 寻找 HQL 构建器（休眠查询语言）

> ID：56843
> 
> 赞同：9
> 
> 时间：2008-09-11T15:12:52.193
> 
> 标签：java, hibernate, hql

我正在寻找Java中的[HQL构建器。](http://www.hibernate.org/hib_docs/reference/en/html/queryhql.html)我想摆脱这样的事情：

```
StringBuilder builder = new StringBuilder()
    .append("select stock from ")
    .append( Stock.class.getName() )
    .append( " as stock where stock.id = ")
    .append( id ); 
```

我宁愿有类似的东西：

```
HqlBuilder builder = new HqlBuilder()
    .select( "stock" )
    .from( Stock.class.getName() ).as( "stock" )
    .where( "stock.id" ).equals( id ); 
```

我google了一下，没找到。

我写了一个适合我现在需要的又快又笨`HqlBuilder`的东西，但我很想找到一个比我一个人拥有更多用户和测试的人。

注意：我希望能够做这样的事情以及更多，但我未能使用 Criteria API 做到这一点：

```
select stock
from com.something.Stock as stock, com.something.Bonus as bonus
where stock.someValue = bonus.id 
```

IE。从红利表中选择属性`someValue`指向*任何*红利的所有股票。

谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2010-01-11T21:07:01.727

对于您的问题的类型安全方法，请考虑[Querydsl](http://www.querydsl.com)。

示例查询变为

```
HQLQuery query = new HibernateQuery(session);
List<Stock> s = query.from(stock, bonus)
  .where(stock.someValue.eq(bonus.id))
  .list(stock); 
```

Querydsl 使用 APT 来生成 JPA2 等代码，并支持 JPA/Hibernate、JDO、SQL 和 Java 集合。

我是Querydsl的维护者，所以这个答案是有偏见的。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-11T15:20:11.380

[Criteria API](http://www.hibernate.org/hib_docs/v3/reference/en/html/querycriteria.html)不是为您做的吗？它看起来几乎与您要求的完全一样。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-11T17:02:48.123

@ [Sébastien Rocca-Serra](https://stackoverflow.com/questions/56843/looking-for-an-hql-builder-hibernate-query-language#57001)
现在我们要到具体的地方了。您尝试执行的那种连接实际上无法通过 Criteria API 进行，但子查询应该完成同样的事情。首先为红利表创建 a `DetachedCriteria`，然后使用`IN`运算符 for `someValue`。

```
DetachedCriteria bonuses = DetachedCriteria.forClass(Bonus.class);
List stocks = session.createCriteria(Stock.class)
    .add(Property.forName("someValue").in(bonuses)).list(); 
```

这相当于

```
select stock
from com.something.Stock as stock
where stock.someValue in (select bonus.id from com.something.Bonus as bonus) 
```

唯一的缺点是如果您引用了不同的表，`someValue`并且您的 ID 在所有表中不是唯一的。但是您的查询将遭受同样的缺陷。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-12-04T02:21:35.400

对于另一个类型安全的查询 dsl，我推荐[http://www.torpedoquery.org](http://www.torpedoquery.org)。该库还很年轻，但它通过直接使用实体的类来提供类型安全。这意味着在重构或重新设计之前查询不再适用时的早期编译器错误。

我还为您提供了一个示例。我认为从您的帖子中您可以尝试进行子查询限制，因此我以该示例为基础：

```
import static org.torpedoquery.jpa.Torpedo.*;

Bonus bonus = from(Bonus.class);
Query subQuery = select(bonus.getId());

Stock stock = from(Stock.class);
where(stock.getSomeValue()).in(subQuery);

List<Stock> stocks = select(stock).list(entityManager); 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-11T15:27:56.527

看起来您想使用 Hibernate 中内置的 Criteria 查询 API。要执行上述查询，它看起来像这样：

```
List<Stock> stocks = session.createCriteria(Stock.class)
    .add(Property.forName("id").eq(id))
    .list(); 
```

如果您还没有访问 Hibernate Session 的权限，您可以像这样使用“DetachedCriteria”：

```
DetachedCriteria criteria = DetachedCriteria.forClass(Stock.class) 
    .add(Property.forName("id").eq(id)); 
```

如果您想获取所有具有特定 ID 的 Bonus 股票，您可以执行以下操作：

```
DetachedCriteria criteria = DetachedCriteria.forClass(Stock.class)
     .createCriteria("Stock")
          .add(Property.forName("id").eq(id))); 
```

有关更多信息，请查看Hibernate 文档中的[Criteria Queries](http://www.hibernate.org/hib_docs/reference/en/html/querycriteria.html "来自 Hibernate 文档的条件查询")

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-11T15:42:11.360

@[塞巴斯蒂安·罗卡-塞拉](https://stackoverflow.com/questions/56843/looking-for-an-hql-builder-hibernate-query-language#56889)

```
select stock
from com.something.Stock as stock, com.something.Bonus as bonus
where stock.bonus.id = bonus.id 
```

那只是一个连接。Hibernate 会自动执行此操作，当且仅当您拥有`Stock`和`Bonus`setup 之间的映射并且 if`bonus`是`Stock`. `Criteria.list()`将返回`Stock`对象，您只需调用`stock.getBonus()`.

请注意，如果您想做类似的事情

```
select stock
from com.something.Stock as stock
where stock.bonus.value > 1000000 
```

你需要使用[`Criteria.createAlias()`](http://www.hibernate.org/hib_docs/v3/api/org/hibernate/Criteria.html#createAlias(java.lang.String,%20java.lang.String)). 会是这样的

```
session.createCriteria(Stock.class).createAlias("bonus", "b")
   .add(Restrictions.gt("b.value", 1000000)).list() 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-11T17:32:59.253

Criteria API 不提供 HQL 中可用的所有功能。例如，您不能对同一列执行多个联接。

你为什么不使用**[NAMED QUERIES](http://www.javalobby.org/java/forums/t33053.html)**？看起来更干净：

```
Person person = session.getNamedQuery("Person.findByName")
                             .setString(0, "Marcio")
                             .list(); 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-25T15:15:04.230

我为 OMERO 编写了 GPL 解决方案，您可以轻松构建适合您的情况的解决方案。

*   来源：[QueryBuilder.java](http://trac.openmicroscopy.org.uk/omero/browser/trunk/components/server/src/ome/tools/hibernate/QueryBuilder.java)
*   测试：[QueryBuilderMockTest](http://trac.openmicroscopy.org.uk/omero/browser/trunk/components/server/test/ome/server/utests/QueryBuilderMockTest.java)

用法：

```
QueryBuilder qb = new QueryBuilder();
qb.select("img");
qb.from("Image", "img");
qb.join("img.pixels", "pix", true, false);

// Can't join anymore after this
qb.where(); // First
qb.append("(");
qb.and("pt.details.creationTime > :time");
qb.param("time", new Date());
qb.append(")");
qb.and("img.id in (:ids)");
qb.paramList("ids", new HashSet());
qb.order("img.id", true);
qb.order("this.details.creationEvent.time", false); 
```

它充当状态机“select->from->join->where->order”等，并跟上可选参数。有几个 Criteria API 无法执行的查询（参见[HHH-879](http://opensource.atlassian.com/projects/hibernate/browse/HHH-879)），所以最后编写这个小类来包装 StringBuilder 会更简单。（注意：有一个票据[HHH-2407](http://opensource.atlassian.com/projects/hibernate/browse/HHH-2407)描述了一个应该统一两者的 Hibernate 分支。在那之后，重新访问 Criteria API 可能是有意义的）

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-12-02T20:10:15.523

[查看hibernate-generic-dao](http://code.google.com/p/hibernate-generic-dao/)项目提供的搜索包。这是一个相当不错的 HQL Builder 实现。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-12-10T10:38:12.620

我知道这个线程很老了，但我也在寻找一个 HqlBuilder 我发现这个[“屏幕保护程序”项目](http://forge.abcd.harvard.edu/gf/project/screensaver/scmsvn/?action=browse&path=%2Fbranches%2Ficcbl%2Ftrunk%2Fsrc%2Fedu%2Fharvard%2Fmed%2Fscreensaver%2Fdb%2Fhibernate%2FHqlBuilder.java&view=markup)
它不是 Windows 屏幕保护程序，它是一个*用于高通量筛选 (HTS) 设施的“实验室信息管理系统 (LIMS)进行小分子和 RNAi 筛选。* ”

它包含一个看起来相当不错的 HQLBuilder。
以下是可用方法的示例列表：

```
...
HqlBuilder select(String alias);
HqlBuilder select(String alias, String property);
HqlBuilder from(Class<?> entityClass, String alias);
HqlBuilder fromFetch(String joinAlias, String joinRelationship, String alias);
HqlBuilder where(String alias, String property, Operator operator, Object value);
HqlBuilder where(String alias, Operator operator, Object value);
HqlBuilder where(String alias1, Operator operator, String alias2);
HqlBuilder whereIn(String alias, String property, Set<?> values);
HqlBuilder whereIn(String alias, Set<?> values);
HqlBuilder where(Clause clause);
HqlBuilder orderBy(String alias, String property);
HqlBuilder orderBy(String alias, SortDirection sortDirection);
HqlBuilder orderBy(String alias, String property, SortDirection sortDirection);
String toHql();
... 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-07-09T10:20:24.467

现在还可以使用标准的[JPA 类型安全](http://www.ibm.com/developerworks/library/j-typesafejpa/)查询和一个不太标准但也很好的[对象查询](https://www.objectquery.org/)

例子：

JPA 类型安全

```
EntityManager em = ...
CriteriaBuilder qb = em.getCriteriaBuilder();
CriteriaQuery<Stock> c = qb.createQuery(Stock.class);
Root<Stock> = c.from(Stock.class);
Predicate condition = qb.eq(p.get(Stock_.id), id);
c.where(condition);
TypedQuery<Stock> q = em.createQuery(c); 
List<Stock> result = q.getResultList(); 
```

对象查询

```
EntityManager em = ...
ObjectQuery<Stock> query = new GenericObjectQuery<Stock>(Stock.class);
Stock toSearch = query.target();
query.eq(toSearch.getId(),id);
List<Stock> res = (List<Stock>)JPAObjectQuery.execute(query, em); 
```

# iphone - 如何让 UIDatePicker 显示特定日期？

> ID：56856
> 
> 赞同：5
> 
> 时间：2008-09-11T15:15:52.140
> 
> 标签：iphone, cocoa-touch, cocoa, uidatepicker

我的应用程序需要让用户从符合特定模式的日期列表中选择一个日期。例如，他们可能需要从星期一的列表中选择一个月的星期一。有没有办法让 a`UIDatePicker`将日期选择限制为某个子集，或者我应该只使用 a`UIPickerView`吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-12T14:39:32.623

您不能限制在`UIDatePicker`. 您可以更改发送值更改事件的日期，但由于用户无法分辨哪些日期是“好”而哪些不是，因此这样做是一个糟糕的 UI 选择。

改用`UIPickerView`自己制作的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-04-30T12:06:23.457

`UIDatePicker`为此目的拥有`minimumDate`和属性。`maximumDate`没有必要`UIPickerView`仅仅因为这个原因使用。

# cab - 是否可以在屏幕中心的 SCSF 应用程序中显示模式窗口

> ID：56859
> 
> 赞同：0
> 
> 时间：2008-09-11T15:17:02.480
> 
> 标签：cab, scsf

在 SCSF 应用程序中，我想将视图显示为屏幕中心的模式窗口。有可能这样做吗？

WindowSmartPartInfo 没有任何设置屏幕位置的选项。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-12T10:42:46.220

假设您谈论的是 Winforms，而不是 WPF，因为 CAB 的 WPF 层确实公开了此选项。在 winforms 中，WindowSmartPartInfo 中没有执行此操作的选项。但是，您可以扩展它并扩展 WindowWorkspace 以使用新的 SmartPartInfo（覆盖 OnApplySmartPartInfo 方法）。

在执行此操作之前，您可能需要检查贡献和社区站点，看看是否有人已经这样做了。我想我在某个地方见过一个。

# oop - Liskov 替换原则的一个例子是什么？

> ID：56860
> 
> 赞同：1097
> 
> 时间：2008-09-11T15:17:38.983
> 
> 标签：oop, definition, solid-principles, design-principles, liskov-substitution-principle

我听说 Liskov 替换原则 (LSP) 是面向对象设计的基本原则。它是什么，有哪些使用示例？

* * *

## 回答 #1

> 赞同：1091
> 
> 时间：2009-02-25T04:44:31.487

说明 LSP 的一个很好的例子（鲍勃叔叔在我最近听到的一个播客中给出）是有时在自然语言中听起来正确的东西在代码中并不完全有效。

在数学中，a`Square`是 a `Rectangle`。实际上，它是矩形的特化。“is a”让你想用继承来建模。但是，如果在您制作的代码中`Square`派生自`Rectangle`，那么 a`Square`应该可以在您期望 a 的任何地方使用`Rectangle`。这导致了一些奇怪的行为。

想象一下，你的基类上`SetWidth`有`SetHeight`方法；`Rectangle`这似乎完全合乎逻辑。但是，如果您的`Rectangle`参考指向 a `Square`，那么`SetWidth`并且`SetHeight`没有意义，因为设置一个会更改另一个以匹配它。在这种情况下`Square`，里氏替换测试失败了，继承自`Rectangle`的抽象是一个糟糕的抽象。`Square``Rectangle`

[![在此处输入图像描述](https://i.stack.imgur.com/ilxzO.jpg)](https://i.stack.imgur.com/ilxzO.jpg)

你们都应该看看其他无价的[SOLID 原则励志海报](http://web.archive.org/web/20160521015258/https://lostechies.com/derickbailey/2009/02/11/solid-development-principles-in-motivational-pictures/)。

* * *

## 回答 #2

> 赞同：518
> 
> 时间：2008-09-11T15:34:26.417

Liskov 替换原则（LSP，[lsp](/questions/tagged/lsp "显示标记为“lsp”的问题")）是面向对象编程中的一个概念，它指出：

> 使用指向基类的指针或引用的函数必须能够在不知情的情况下使用派生类的对象。

LSP 的核心是关于接口和契约，以及如何决定何时扩展类与使用组合等其他策略来实现目标。

我见过的最有效的说明这一点的方法是[Head First OOA&D](http://oreilly.com/catalog/9780596008673/index.html)。他们提出了一个场景，您是一个项目的开发人员，为策略游戏构建框架。

他们提供了一个类，该类代表一个如下所示的板：

![类图](https://oncodebynotmyself.files.wordpress.com/2011/03/board_thumb.png)

所有方法都以 X 和 Y 坐标为参数，在 的二维数组中定位图块位置`Tiles`。这将允许游戏开发者在游戏过程中管理棋盘中的单元。

该书继续更改要求，说游戏框架还必须支持 3D 游戏板以适应具有飞行的游戏。因此`ThreeDBoard`引入了一个扩展类`Board`。

乍一看，这似乎是一个不错的决定。`Board`提供`Height`和`Width`属性并`ThreeDBoard`提供 Z 轴。

当您查看所有其他成员继承自`Board`. `AddUnit`、`GetTile`等的方法`GetUnits`都采用`Board`类中的 X 和 Y 参数，但也`ThreeDBoard`需要 Z 参数。

因此，您必须使用 Z 参数再次实现这些方法。Z 参数对类没有上下文，从`Board`类继承的方法`Board`失去了意义。尝试使用`ThreeDBoard`该类作为其基类的代码单元`Board`将非常不走运。

也许我们应该找到另一种方法。应该由对象组成`Board`，而不是扩展。Z 轴每单位一个对象。`ThreeDBoard``Board``Board`

这允许我们使用良好的面向对象原则，如封装和重用，并且不违反 LSP。

* * *

## 回答 #3

> 赞同：357
> 
> 时间：2017-07-04T19:58:38.450

> 可替换性是面向对象编程中的一个原则，它指出，在计算机程序中，如果 S 是 T 的子类型，则 T 类型的对象可以被 S 类型的对象替换

让我们用Java做一个简单的例子：

## 不好的例子

```
public class Bird{
    public void fly(){}
}
public class Duck extends Bird{} 
```

鸭子可以飞，因为它是一只鸟，但是这个呢：

```
public class Ostrich extends Bird{} 
```

Ostrich 是鸟，但它不会飞，Ostrich 类是 Bird 类的子类型，但它应该不能使用 fly 方法，这意味着我们违反了 LSP 原则。

## 好例子

```
public class Bird{}
public class FlyingBirds extends Bird{
    public void fly(){}
}
public class Duck extends FlyingBirds{}
public class Ostrich extends Bird{} 
```

* * *

## 回答 #4

> 赞同：149
> 
> 时间：2008-09-12T13:45:10.320

LSP 关注不变量。

经典示例由以下伪代码声明（省略实现）给出：

```
class Rectangle {
    int getHeight()
    void setHeight(int value) {
        postcondition: width didn’t change
    }
    int getWidth()
    void setWidth(int value) {
        postcondition: height didn’t change
    }
}

class Square extends Rectangle { } 
```

现在我们有一个问题，虽然接口匹配。原因是我们违反了源自正方形和矩形的数学定义的不变量。getter 和 setter 的工作方式， a`Rectangle`应该满足以下不变量：

```
void invariant(Rectangle r) {
    r.setHeight(200)
    r.setWidth(100)
    assert(r.getHeight() == 200 and r.getWidth() == 100)
} 
```

然而，这个不变量（以及显式的后置条件）*必须*被 的正确实现所违反`Square`，因此它不是 的有效替代品`Rectangle`。

* * *

## 回答 #5

> 赞同：80
> 
> 时间：2008-09-12T13:34:37.443

[Robert Martin 有一篇关于 Liskov Substitution Principle](http://web.archive.org/web/20151128004108/http://www.objectmentor.com/resources/articles/lsp.pdf)的优秀论文。它讨论了可能违反该原则的微妙和不那么微妙的方式。

论文的一些相关部分（请注意，第二个示例非常精简）：

> # 违反 LSP 的简单示例
> 
> 最明显违反此原则的行为之一是使用 C++ 运行时类型信息 (RTTI) 根据对象的类型选择函数。IE：
> 
> ```
> void DrawShape(const Shape& s)
> {
>   if (typeid(s) == typeid(Square))
>     DrawSquare(static_cast<Square&>(s)); 
>   else if (typeid(s) == typeid(Circle))
>     DrawCircle(static_cast<Circle&>(s));
> } 
> ```
> 
> 显然，该`DrawShape`功能的形成很糟糕。它必须知道`Shape`类的每个可能的派生词，并且每当创建新的派生词时都必须更改它`Shape`。事实上，许多人将此功能的结构视为对面向对象设计的诅咒。
> 
> # 方形和矩形，更微妙的违反。
> 
> 但是，还有其他更微妙的方式来违反 LSP。考虑一个使用`Rectangle`如下描述的类的应用程序：
> 
> ```
> class Rectangle
> {
>   public:
>     void SetWidth(double w) {itsWidth=w;}
>     void SetHeight(double h) {itsHeight=w;}
>     double GetHeight() const {return itsHeight;}
>     double GetWidth() const {return itsWidth;}
>   private:
>     double itsWidth;
>     double itsHeight;
> }; 
> ```
> 
> [...] 想象有一天，除了矩形之外，用户还需要操作正方形的能力。[...]
> 
> 显然，正方形是所有正常意图和目的的矩形。由于 ISA 关系成立，因此将类建模`Square` 为从`Rectangle`. [...]
> 
> `Square`将继承`SetWidth`and`SetHeight`函数。这些函数完全不适合 a `Square`，因为正方形的宽度和高度是相同的。这应该是设计存在问题的重要线索。但是，有一种方法可以回避这个问题。我们可以覆盖`SetWidth`并`SetHeight`[...]
> 
> 但请考虑以下功能：
> 
> ```
> void f(Rectangle& r)
> {
>   r.SetWidth(32); // calls Rectangle::SetWidth
> } 
> ```
> 
> 如果我们将一个`Square`对象的引用传递给这个函数，该 `Square`对象将被破坏，因为高度不会改变。这明显违反了 LSP。该函数不适用于其参数的导数。
> 
> [...]

* * *

## 回答 #6

> 赞同：40
> 
> 时间：2011-11-26T16:35:21.967

LSP 在某些代码认为它正在调用某个类型的方法时是必要的`T`，并且可能会在不知不觉中调用某个类型的方法`S`，其中`S extends T`（即`S`继承、派生自超类型或者是超类型的子类型`T`）。

例如，当输入参数类型为 的函数`T`被调用（即调用）时，参数值为 类型`S`。或者，在 type 的标识符`T`被分配一个 type 的值的情况下`S`。

```
val id : T = new S() // id thinks it's a T, but is a S 
```

`T`LSP 要求类型（例如）方法的期望（即不变量） ，而不是在调用类型（例如）`Rectangle`方法时违反。`S``Square`

```
val rect : Rectangle = new Square(5) // thinks it's a Rectangle, but is a Square
val rect2 : Rectangle = rect.setWidth(10) // height is 10, LSP violation 
```

即使具有*不可变字段*的类型仍然具有不变量，例如，*不可变*的Rectangle 设置器期望维度被独立修改，但*不可变*的Square 设置器违反了这种期望。

```
class Rectangle( val width : Int, val height : Int )
{
   def setWidth( w : Int ) = new Rectangle(w, height)
   def setHeight( h : Int ) = new Rectangle(width, h)
}

class Square( val side : Int ) extends Rectangle(side, side)
{
   override def setWidth( s : Int ) = new Square(s)
   override def setHeight( s : Int ) = new Square(s)
} 
```

LSP 要求子类型的每个方法都`S`必须具有逆变输入参数和协变输出。

逆变是指方差与继承的方向相反，即子类型`Si`的每个方法的每个输入参数的类型`S`，必须是相同的或者*父*类型`Ti`的对应方法的对应输入参数的类型的超类型`T`.

协方差是指方差在继承的同一方向上，即子类型`So`的每个方法的输出的类型`S`，必须是相同的，或者是超类型对应方法的对应输出的类型的*子*类型。`To``T`

这是因为如果调用者认为它有一个 type `T`，认为它正在调用 的一个方法`T`，那么它会提供 type 的参数`Ti`并将输出分配给 type `To`。当它实际调用 的对应方法时`S`，则将每个`Ti`输入参数分配给一个`Si`输入参数，并将`So`输出分配给 type `To`。因此，如果`Si`与 不逆变`Ti`，则`Xi`可以将一个子类型（它不是的子类型）`Si`分配给`Ti`。

此外，对于在类型多态性参数（即泛型）上具有定义站点方差注释的语言（例如 Scala 或 Ceylon），该类型的每个类型参数的方差注释的同向或相反方向`T`必须[相反](https://stackoverflow.com/q/5278591)或相同方向分别用于`T`具有类型参数类型的每个输入参数或输出（的每个方法）。

此外，对于具有函数类型的每个输入参数或输出，所需的方差方向是相反的。此规则以递归方式应用。

* * *

[子类型适用](https://stackoverflow.com/a/8352969)于可以枚举不变量的情况。

关于如何对不变量进行建模的研究正在进行中，以便它们由编译器强制执行。

[Typestate](http://www.cs.cmu.edu/~aldrich/papers/onward2009-state.pdf#page3)（参见第 3 页）声明并强制执行与类型正交的状态不变量。[或者，可以通过将断言转换为类型](http://lambda-the-ultimate.org/node/4009#comment-60775)来强制执行不变量。例如，要断言文件在关闭之前已打开，则 File.open() 可以返回 OpenFile 类型，该类型包含 File 中不可用的 close() 方法。[tic-tac-toe API](http://blog.tmorris.net/scala-exercise-with-types-and-abstraction/)可以是另一个在编译时使用类型来强制执行不变量的示例。类型系统甚至可能是图灵完备的，例如[Scala](https://stackoverflow.com/a/4050833)。依赖类型语言和定理证明形式化了高阶类型的模型。

由于语义需要[抽象而不是扩展](http://lambda-the-ultimate.org/node/4009#comment-60765)，我希望使用类型来建模不变量，即统一的高阶指称语义，优于 Typestate。“扩展”是指不协调的、模块化的开发的无限的、置换的组合。因为在我看来，统一和自由度的对立面，有两个相互依赖的模型（例如类型和类型状态）来表达共享语义，它们不能相互统一以实现可扩展的组合. 例如，类似[表达式问题](http://en.wikipedia.org/wiki/Expression_problem)的扩展在子类型化、函数重载和参数类型化域中被统一起来。

我的理论立场是，为了让[知识存在](http://www.coolpage.com/commentary/economic/shelby/Understand%20Everything%20Fundamentally.html)（参见“集中化是盲目的和不合适的”部分），*永远不会*有一个通用模型可以在图灵完备的计算机语言中强制 100% 覆盖所有可能的不变量。知识要存在，就存在很多意想不到的可能性，即无序和熵必须总是在增加。这就是熵力。证明潜在扩展的所有可能计算，就是先验地计算所有可能的扩展。

这就是Halting Theorem 存在的原因，也就是说，在图灵完备的编程语言中是否每个可能的程序都终止是不可判定的。可以证明某些特定程序终止（已定义和计算了所有可能性的程序）。但是不可能证明该程序的所有可能扩展都终止，除非该程序扩展的可能性不是图灵完备的（例如，通过依赖类型）。由于图灵完备性的基本要求是[无限递归](https://stackoverflow.com/q/8283566)，因此可以直观地理解哥德尔不完备性定理和罗素悖论如何应用于扩展。

对这些定理的解释将它们纳入对熵力的广义概念理解中：

*   **哥德尔不完备定理**：任何可以证明所有算术真理的形式理论都是不一致的。
*   **[罗素悖论](http://plato.stanford.edu/entries/russell-paradox/#SOTP)**：可以包含集合的集合的每个成员规则，要么枚举每个成员的特定类型，要么包含自身。因此，集合要么不能扩展，要么是无限递归。例如，所有不是茶壶的东西的集合，包括它自己，它包括它自己，它包括它自己，等等……。因此，如果规则（可能包含一个集合并且）不枚举特定类型（即允许所有未指定的类型）并且不允许无界扩展，则该规则是不一致的。这是不属于自身成员的集合。这种无法在所有可能的扩展上保持一致和完全枚举的能力，就是哥德尔的不完备性定理。
*   **Liskov Substition Principle**：一般来说，任何集合是否是另一个集合的子集是一个不可判定的问题，即继承一般是不可判定的。
*   **林斯基参考**：当事物被描述或感知时，无法确定计算的内容是什么，即感知（现实）没有绝对的参考点。
*   **科斯定理**：没有外部参考点，因此任何无界外部可能性的障碍都将失效。
*   **[热力学第二定律](http://en.wikipedia.org/wiki/Second_law_of_thermodynamics#Mathematical_descriptions)**：整个宇宙（一个封闭系统，即万物）趋向于最大无序，即最大独立可能性。

* * *

## 回答 #7

> 赞同：37
> 
> 时间：2018-02-18T19:07:29.777

我在每个答案中都看到了矩形和正方形，以及如何违反 LSP。

我想通过一个真实的例子来展示如何使 LSP 符合：

```
<?php

interface Database 
{
    public function selectQuery(string $sql): array;
}

class SQLiteDatabase implements Database
{
    public function selectQuery(string $sql): array
    {
        // sqlite specific code

        return $result;
    }
}

class MySQLDatabase implements Database
{
    public function selectQuery(string $sql): array
    {
        // mysql specific code

        return $result; 
    }
} 
```

这种设计符合 LSP，因为无论我们选择使用何种实现，行为都保持不变。

是的，你可以在这个配置中违反 LSP，做一个简单的改变，如下所示：

```
<?php

interface Database 
{
    public function selectQuery(string $sql): array;
}

class SQLiteDatabase implements Database
{
    public function selectQuery(string $sql): array
    {
        // sqlite specific code

        return $result;
    }
}

class MySQLDatabase implements Database
{
    public function selectQuery(string $sql): array
    {
        // mysql specific code

        return ['result' => $result]; // This violates LSP !
    }
} 
```

现在不能以相同的方式使用子类型，因为它们不再产生相同的结果。

* * *

## 回答 #8

> 赞同：34
> 
> 时间：2016-08-13T14:26:50.663

有一个清单可以确定您是否违反了 Liskov。

*   如果您违反以下一项 -> 您违反了 Liskov。
*   如果您不违反任何-> 无法得出任何结论。

检查清单：

*   **派生类中不应抛出新异常**：如果您的基类抛出 ArgumentNullException，那么您的子类只允许抛出 ArgumentNullException 类型的异常或从 ArgumentNullException 派生的任何异常。抛出 IndexOutOfRangeException 违反了 Liskov。

*   **前提条件无法加强**：假设您的基类与成员 int 一起使用。现在您的子类型要求该 int 为正数。这是强化的先决条件，现在任何以前使用负整数都可以正常工作的代码都被破坏了。

*   **不能削弱后置条件**：假设您的基类要求在方法返回之前关闭所有与数据库的连接。在您的子类中，您覆盖了该方法并保持连接打开以供进一步重用。您削弱了该方法的后置条件。

*   **必须保留不变量**：要实现的最困难和最痛苦的约束。不变量有时隐藏在基类中，显示它们的唯一方法是阅读基类的代码。基本上，您必须确保在覆盖方法时，任何不可更改的内容在执行覆盖的方法后必须保持不变。我能想到的最好的事情是在基类中强制执行这些不变的约束，但这并不容易。

*   **历史约束**：重写方法时，不允许修改基类中不可修改的属性。查看这些代码，您可以看到 Name 被定义为不可修改（私有集），但 SubType 引入了允许修改它的新方法（通过反射）：

    ```
     public class SuperType
     {
         public string Name { get; private set; }
         public SuperType(string name, int age)
         {
             Name = name;
             Age = age;
         }
     }
     public class SubType : SuperType
     {
         public void ChangeName(string newName)
         {
             var propertyType = base.GetType().GetProperty("Name").SetValue(this, newName);
         }
     } 
    ```

还有其他 2 项：**方法参数**的逆变和**返回类型的协方差**。但这在 C# 中是不可能的（我是 C# 开发人员），所以我不关心它们。

* * *

## 回答 #9

> 赞同：29
> 
> 时间：2017-10-28T23:10:45.207

**长话短说**，让我们留下矩形矩形和正方形正方形，扩展父类时的实际示例，您必须保留确切的父 API 或扩展它。

假设您有一个**基础**ItemsRepository。

```
class ItemsRepository
{
    /**
    * @return int Returns number of deleted rows
    */
    public function delete()
    {
        // perform a delete query
        $numberOfDeletedRows = 10;

        return $numberOfDeletedRows;
    }
} 
```

还有一个扩展它的子类：

```
class BadlyExtendedItemsRepository extends ItemsRepository
{
    /**
     * @return void Was suppose to return an INT like parent, but did not, breaks LSP
     */
    public function delete()
    {
        // perform a delete query
        $numberOfDeletedRows = 10;

        // we broke the behaviour of the parent class
        return;
    }
} 
```

然后，您可以让**客户端**使用 Base ItemsRepository API 并依赖它。

```
/**
 * Class ItemsService is a client for public ItemsRepository "API" (the public delete method).
 *
 * Technically, I am able to pass into a constructor a sub-class of the ItemsRepository
 * but if the sub-class won't abide the base class API, the client will get broken.
 */
class ItemsService
{
    /**
     * @var ItemsRepository
     */
    private $itemsRepository;

    /**
     * @param ItemsRepository $itemsRepository
     */
    public function __construct(ItemsRepository $itemsRepository)
    {
        $this->itemsRepository = $itemsRepository;
    }

    /**
     * !!! Notice how this is suppose to return an int. My clients expect it based on the
     * ItemsRepository API in the constructor !!!
     *
     * @return int
     */
    public function delete()
    {
        return $this->itemsRepository->delete();
    }
} 
```

当用子类**替换****父**类时， **LSP**会破坏**API 的合同**。

 ******```
class ItemsController
{
    /**
     * Valid delete action when using the base class.
     */
    public function validDeleteAction()
    {
        $itemsService = new ItemsService(new ItemsRepository());
        $numberOfDeletedItems = $itemsService->delete();

        // $numberOfDeletedItems is an INT :)
    }

    /**
     * Invalid delete action when using a subclass.
     */
    public function brokenDeleteAction()
    {
        $itemsService = new ItemsService(new BadlyExtendedItemsRepository());
        $numberOfDeletedItems = $itemsService->delete();

        // $numberOfDeletedItems is a NULL :(
    }
} 
```

您可以在我的课程中了解有关编写可维护软件的更多信息：[https ://www.udemy.com/enterprise-php/](https://www.udemy.com/enterprise-php/)

* * *

## 回答 #10

> 赞同：26
> 
> 时间：2019-02-10T10:56:06.173

让我们用Java来说明：

```
class TrasportationDevice
{
   String name;
   String getName() { ... }
   void setName(String n) { ... }

   double speed;
   double getSpeed() { ... }
   void setSpeed(double d) { ... }

   Engine engine;
   Engine getEngine() { ... }
   void setEngine(Engine e) { ... }

   void startEngine() { ... }
}

class Car extends TransportationDevice
{
   @Override
   void startEngine() { ... }
} 
```

这里没有问题，对吧？汽车绝对是一种交通工具，在这里我们可以看到它重写了其超类的 startEngine() 方法。

让我们添加另一个运输设备：

```
class Bicycle extends TransportationDevice
{
   @Override
   void startEngine() /*problem!*/
} 
```

现在一切都没有按计划进行！是的，自行车是一种交通工具，但是它没有引擎，因此无法实现 startEngine() 方法。

> 这些是违反里氏替换原则所导致的问题，通常可以通过什么都不做的方法来识别，甚至无法实现。

这些问题的解决方案是正确的继承层次结构，在我们的例子中，我们将通过区分带和不带引擎的运输设备类别来解决问题。尽管自行车是一种交通工具，但它没有引擎。在这个例子中，我们对运输设备的定义是错误的。它不应该有引擎。

我们可以重构我们的 TransportationDevice 类如下：

```
class TrasportationDevice
{
   String name;
   String getName() { ... }
   void setName(String n) { ... }

   double speed;
   double getSpeed() { ... }
   void setSpeed(double d) { ... }
} 
```

现在我们可以为非机动设备扩展TransportationDevice。

```
class DevicesWithoutEngines extends TransportationDevice
{  
   void startMoving() { ... }
} 
```

并为机动设备扩展TransportationDevice。这里更适合添加Engine对象。

```
class DevicesWithEngines extends TransportationDevice
{  
   Engine engine;
   Engine getEngine() { ... }
   void setEngine(Engine e) { ... }

   void startEngine() { ... }
} 
```

因此，我们的 Car 类变得更加专业，同时遵守 Liskov 替换原则。

```
class Car extends DevicesWithEngines
{
   @Override
   void startEngine() { ... }
} 
```

而且我们的 Bicycle 类也符合 Liskov 替换原则。

```
class Bicycle extends DevicesWithoutEngines
{
   @Override
   void startMoving() { ... }
} 
```

* * *

## 回答 #11

> 赞同：25
> 
> 时间：2008-11-08T17:53:32.567

LSP 是关于类契约的规则：如果基类满足契约，那么 LSP 的派生类也必须满足该契约。

在伪python中

```
class Base:
   def Foo(self, arg): 
       # *... do stuff*

class Derived(Base):
   def Foo(self, arg):
       # *... do stuff* 
```

如果每次在 Derived 对象上调用 Foo 时，只要 arg 相同，它就满足 LSP 与在 Base 对象上调用 Foo 完全相同的结果。

* * *

## 回答 #12

> 赞同：22
> 
> 时间：2016-12-18T16:54:19.917

我想每个人都在技术上涵盖了 LSP 是什么：您基本上希望能够从子类型细节中抽象出来并安全地使用超类型。

所以 Liskov 有 3 个基本规则：

1.  签名规则：在语法上，子类型中父类型的每个操作都应该有一个有效的实现。编译器将能够为您检查的东西。关于抛出更少的异常并至少与超类型方法一样可访问，有一个小规则。

2.  方法规则：这些操作的实现在语义上是合理的。

    *   较弱的前提条件：子类型函数应该至少采用超类型作为输入的内容，如果不是更多的话。
    *   更强的后置条件：它们应该产生超类型方法产生的输出的一个子集。
3.  属性规则：这超出了单个函数调用。

    *   不变量：总是真实的事物必须保持真实。例如。Set 的大小永远不会是负数。
    *   进化属性：通常与不变性或对象可以处于的状态类型有关。或者对象只会增长而不会缩小，因此子类型方法不应该这样做。

所有这些属性都需要保留，并且额外的子类型功能不应违反超类型属性。

如果这三件事都得到了照顾，那么您就已经从底层的东西中抽象出来了，并且您正在编写松散耦合的代码。

资料来源：Java 程序开发 - Barbara Liskov

* * *

## 回答 #13

> 赞同：20
> 
> 时间：2008-09-11T16:04:55.593

> 使用指向基类的指针或引用的函数必须能够在不知情的情况下使用派生类的对象。

当我第一次阅读有关 LSP 的内容时，我认为这是非常严格的意思，本质上将其等同于接口实现和类型安全的强制转换。这意味着语言本身可以保证或不保证 LSP。例如，在这个严格意义上，就编译器而言，ThreeDBoard 肯定可以替代 Board。

在阅读了更多关于这个概念的内容后，我发现 LSP 的解释通常比这更广泛。

简而言之，客户端代码“知道”指针背后的对象是派生类型而不是指针类型意味着什么，并不局限于类型安全。对 LSP 的遵守也可以通过探测对象的实际行为来测试。也就是说，检查对象的状态和方法参数对方法调用结果或对象抛出的异常类型的影响。

再次回到这个例子，**理论上**Board 方法可以在 ThreeDBoard 上正常工作。然而，在实践中，很难防止客户端可能无法正确处理的行为差异，而不妨碍 ThreeDBoard 打算添加的功能。

掌握了这些知识，评估 LSP 的依从性可以成为一个很好的工具，用于确定何时组合是扩展现有功能而不是继承更合适的机制。

* * *

## 回答 #14

> 赞同：20
> 
> 时间：2013-03-25T21:26:41.767

*使用*LSP 的一个重要例子是在**软件测试**中。

如果我有一个类 A 是 B 的符合 LSP 的子类，那么我可以重用 B 的测试套件来测试 A。

要完全测试子类 A，我可能需要添加更多测试用例，但至少我可以重用所有超类 B 的测试用例。

一种实现方式是通过构建 McGregor 所说的“用于测试的并行层次结构”：我的`ATest`类将继承自`BTest`. 然后需要某种形式的注入来确保测试用例与 A 类型的对象而不是 B 类型的对象一起工作（一个简单的模板方法模式就可以了）。

请注意，为所有子类实现重用超级测试套件实际上是一种测试这些子类实现是否符合 LSP 的方法。因此，人们也可以争辩说*应该*在任何子类的上下文中运行超类测试套件。

另请参阅 Stackoverflow 问题的答案“[我可以实现一系列可重用的测试来测试接口的实现吗？](https://stackoverflow.com/a/9367854/165292) ”

* * *

## 回答 #15

> 赞同：11
> 
> 时间：2019-08-19T11:55:07.647

**里氏替换原则**

*   被覆盖的方法不应为空
*   被覆盖的方法不应该抛出错误
*   基类或接口行为不应因为派生类行为而进行修改（返工）。

* * *

## 回答 #16

> 赞同：10
> 
> 时间：2009-04-03T00:11:54.680

LSP 的这个公式太强了：

> 如果对于每个 S 类型的对象 o1 都有一个 T 类型的对象 o2 使得对于所有以 T 定义的程序 P，当 o1 替换 o2 时 P 的行为不变，则 S 是 T 的子类型。

这基本上意味着 S 是与 T 完全相同的东西的另一个完全封装的实现。我可以大胆地决定性能是 P 行为的一部分...

因此，基本上，任何后期绑定的使用都违反了 LSP。当我们用一种对象替换另一种对象时，获得不同行为是 OO 的全部要点！

[维基百科](http://en.wikipedia.org/wiki/Liskov_substitution_principle)引用的公式更好，因为属性取决于上下文，不一定包括程序的整个行为。

* * *

## 回答 #17

> 赞同：10
> 
> 时间：2017-08-16T08:40:52.117

用一个非常简单的句子，我们可以说：

子类不得违反其基类特征。它必须有能力。我们可以说它与子类型相同。

* * *

## 回答 #18

> 赞同：9
> 
> 时间：2018-05-21T09:01:48.310

> **里氏替换原则（LSP）**
> 
> 我们一直在设计程序模块并创建一些类层次结构。然后我们扩展一些类，创建一些派生类。
> 
> 我们必须确保新的派生类只是扩展而不替换旧类的功能。否则，新类在现有程序模块中使用时会产生不良影响。
> 
> Liskov 的替换原则指出，如果程序模块正在使用 Base 类，那么对 Base 类的引用可以替换为 Derived 类，而不会影响程序模块的功能。

**例子：**

以下是违反 Liskov 替换原则的经典示例。在示例中，使用了 2 个类：Rectangle 和 Square。假设在应用程序的某处使用了 Rectangle 对象。我们扩展应用程序并添加 Square 类。square 类由工厂模式返回，基于某些条件，我们不知道将返回的确切对象类型。但我们知道它是一个矩形。我们得到矩形对象，将宽度设置为 5，高度设置为 10，然后得到面积。对于宽度为 5 和高度为 10 的矩形，面积应为 50。相反，结果将为 100

```
 // Violation of Likov's Substitution Principle
class Rectangle {
    protected int m_width;
    protected int m_height;

    public void setWidth(int width) {
        m_width = width;
    }

    public void setHeight(int height) {
        m_height = height;
    }

    public int getWidth() {
        return m_width;
    }

    public int getHeight() {
        return m_height;
    }

    public int getArea() {
        return m_width * m_height;
    }
}

class Square extends Rectangle {
    public void setWidth(int width) {
        m_width = width;
        m_height = width;
    }

    public void setHeight(int height) {
        m_width = height;
        m_height = height;
    }

}

class LspTest {
    private static Rectangle getNewRectangle() {
        // it can be an object returned by some factory ...
        return new Square();
    }

    public static void main(String args[]) {
        Rectangle r = LspTest.getNewRectangle();

        r.setWidth(5);
        r.setHeight(10);
        // user knows that r it's a rectangle.
        // It assumes that he's able to set the width and height as for the base
        // class

        System.out.println(r.getArea());
        // now he's surprised to see that the area is 100 instead of 50.
    }
} 
```

> **结论：**
> 
> 这个原则只是 Open Close 原则的扩展，它意味着我们必须确保新的派生类在不改变其行为的情况下扩展基类。

参见：**[开闭原则](https://en.wikipedia.org/wiki/Open/closed_principle)**

一些类似的概念以获得更好的结构：[约定优于配置](https://en.wikipedia.org/wiki/Convention_over_configuration)

* * *

## 回答 #19

> 赞同：9
> 
> 时间：2020-01-24T12:19:38.613

[LSP 简单地](https://dev.to/erikwhiting88/liskov-substitution-principle-in-3-minutes-2dc6)说就是同一个超类的对象应该能够在不破坏任何东西的情况下相互**交换。**

例如，如果我们有一个`Cat`和一个`Dog`从类派生的`Animal`类，那么任何使用 Animal 类的函数都应该能够正常使用`Cat`或`Dog`运行。

* * *

## 回答 #20

> 赞同：9
> 
> 时间：2020-03-02T17:54:24.657

该原则由**Barbara Liskov**在 1987 年引入，并通过关注超类及其子类型的行为扩展了开闭原则。

当我们考虑违反它的后果时，它的重要性就变得显而易见了。考虑一个使用以下类的应用程序。

```
public class Rectangle 
{ 
  private double width;

  private double height; 

  public double Width 
  { 
    get 
    { 
      return width; 
    } 
    set 
    { 
      width = value; 
    }
  } 

  public double Height 
  { 
    get 
    { 
      return height; 
    } 
    set 
    { 
      height = value; 
    } 
  } 
} 
```

想象有一天，客户要求除了矩形之外还需要操作正方形的能力。既然正方形就是长方形，那么正方形类应该派生自Rectangle类。

```
public class Square : Rectangle
{
} 
```

但是，这样做我们会遇到两个问题：

正方形不需要从矩形继承的高度和宽度变量，如果我们必须创建数十万个正方形对象，这可能会在内存中造成重大浪费。从矩形继承的宽度和高度设置器属性不适用于正方形，因为正方形的宽度和高度是相同的。为了将高度和宽度设置为相同的值，我们可以创建两个新属性，如下所示：

```
public class Square : Rectangle
{
  public double SetWidth 
  { 
    set 
    { 
      base.Width = value; 
      base.Height = value; 
    } 
  } 

  public double SetHeight 
  { 
    set 
    { 
      base.Height = value; 
      base.Width = value; 
    } 
  } 
} 
```

现在，当有人设置一个正方形对象的宽度时，它的高度会相应地改变，反之亦然。

```
Square s = new Square(); 
s.SetWidth(1); // Sets width and height to 1\. 
s.SetHeight(2); // sets width and height to 2\. 
```

让我们继续考虑这个其他功能：

```
public void A(Rectangle r) 
{ 
  r.SetWidth(32); // calls Rectangle.SetWidth 
} 
```

如果我们将一个方形对象的引用传递给该函数，我们将违反 LSP，因为该函数不适用于其参数的导数。属性宽度和高度不是多态的，因为它们没有在矩形中声明为虚拟（方形对象将被破坏，因为高度不会改变）。

但是，通过将 setter 属性声明为虚拟，我们将面临另一个违规行为，即 OCP。事实上，派生类正方形的创建导致基类矩形的变化。

* * *

## 回答 #21

> 赞同：8
> 
> 时间：2013-12-27T05:20:22.787

一些附录：
我想知道为什么没有人写关于派生类必须遵守的基类的 Invariant 、前置条件和后置条件。对于派生类 D 完全可以被基类 B 替代，类 D 必须遵守某些条件：

*   基类的变量必须由派生类保留
*   派生类不能强化基类的前置条件
*   派生类不能削弱基类的后置条件。

所以派生必须知道基类强加的上述三个条件。因此，子类型的规则是预先确定的。这意味着，只有当子类型遵守某些规则时，才应遵守“IS A”关系。这些规则，以不变量、前置条件和后置条件的形式，应该由正式的“[设计合同](http://en.wikipedia.org/wiki/Design_by_contract)”来决定。

可以在我的博客上对此进行进一步讨论：[Liskov Substitution principle](http://design-principle-pattern.blogspot.in/2013/12/liskov-substitution-principle.html)

* * *

## 回答 #22

> 赞同：5
> 
> 时间：2015-07-27T21:56:40.427

正方形是宽度等于高度的矩形。如果正方形为宽度和高度设置了两种不同的大小，则它违反了正方形不变量。这是通过引入副作用来解决的。但是如果矩形有一个 setSize(height, width)，前提是 0 < height 和 0 < width。派生的子类型方法需要 height == width; 一个更强的前提条件（这违反了 lsp）。这表明虽然正方形是一个矩形，但它不是一个有效的子类型，因为前提条件被加强了。解决方法（通常是一件坏事）会导致副作用，这会削弱后置条件（违反 lsp）。基础上的 setWidth 具有后置条件 0 < 宽度。派生用高度==宽度削弱它。

因此，可调整大小的正方形不是可调整大小的矩形。

* * *

## 回答 #23

> 赞同：5
> 
> 时间：2020-11-22T05:09:46.227

它指出如果 C 是 E 的子类型，则可以用 C 类型的对象替换 E，而不会改变或破坏程序的行为。简而言之，派生类应该可以替代它们的父类。例如，如果**农民的儿子**是农民，那么他可以代替父亲工作，但如果**农民的儿子**是板球运动员，那么他不能代替父亲工作。

### 违规示例：

```
public class Plane{

  public void startEngine(){}      

}        
public class FighterJet extends Plane{}

public class PaperPlane extends Plane{} 
```

在给定的示例`FighterPlane`和`PaperPlane`类中，都扩展了`Plane`包含`startEngine()`方法的类。所以很明显`FighterPlane`可以启动引擎但`PaperPlane`不能所以它正在破坏`LSP`。

`PaperPlane`class 虽然扩展`Plane`了 class 并且应该可以替代它，但它不是 Plane 实例可以替换的合格实体，因为纸飞机无法启动引擎，因为它没有引擎。所以一个很好的例子是，

### 尊敬的例子：

```
public class Plane{ 
} 
public class RealPlane{

  public void startEngine(){} 

}
public class FighterJet extends RealPlane{} 
public class PaperPlane extends Plane{} 
```

* * *

## 回答 #24

> 赞同：5
> 
> 时间：2021-09-20T10:50:36.327

大图：

*   什么是里氏替换原则？它是关于什么是（什么不是）给定类型的**子**类型。
*   为什么如此重要？**因为subtype**和**subclass**之间是有区别的。

# 例子

与其他答案不同，我不会从违反 Liskov 替换原则 (LSP) 开始，而是从 LSP 合规开始。我使用 Java，但在每种 OOP 语言中几乎都是一样的。

## `Circle`和`ColoredCircle`

几何示例在这里似乎很受欢迎。

```
class Circle {
    private int radius;

    public Circle(int radius) {
        if (radius < 0) {
            throw new RuntimeException("Radius should be >= 0");
        }
        this.radius = radius;
    }

    public int getRadius() {
        return this.radius;
    }
} 
```

半径不允许为负数。这是一个子类：

```
class ColoredCircle extends Circle {
    private Color color; // defined elsewhere

    public ColoredCircle(int radius, Color color) {
        super(radius);
        this.color = color;
    }

    public Color getColor() {
        return this.color;
    }
} 
```

`Circle`根据 LSP，这个子类是 的子类型。

LSP 指出：

> 如果对于每个 S 类型的对象 o1 都有一个 T 类型的对象 o2 使得对于所有以 T 定义的程序 P，当 o1 替换 o2 时 P 的行为不变，则 S 是 T 的子类型*。 Barbara Liskov，“数据抽象和层次结构”，SIGPLAN Notices，23,5（1988 年 5 月））*

在这里，对于每个`ColoredCircle`实例`o1`，考虑`Circle`具有相同半径的实例`o2`。对于每个使用`Circle`对象的程序，如果您替换`o2`为`o1`，则任何使用对象的程序的行为`Circle`在替换后都将保持不变。（请注意，这是理论上的：使用`ColoredCircle`实例比使用`Circle`实例更快地耗尽内存，但这与此处无关。）

我们如何找到`o2`依赖`o1`？我们只是剥离`color`属性并保留`radius`属性。我称变换`o1`->空间上`o2`的空间*投影*。`CircleColor``Circle`

# 反例

让我们创建另一个示例来说明违反 LSP 的情况。

## `Circle`和`Square`

想象一下前一个类的这个子`Circle`类：

```
class Square extends Circle {
    private int sideSize;

    public Square(int sideSize) {
        super(0);
        this.sideSize = sideSize;
    }

    @Override
    public int getRadius() {
        return -1; // I'm a square, I don't care
    }

    public int getSideSize() {
        return this.sideSize;
    }
} 
```

## 违反 LSP

现在，看看这个程序：

```
public class Liskov {
    public static void program(Circle c) {
        System.out.println("The radius is "+c.getRadius());
    } 
```

我们用一个`Circle`对象和一个`Square`对象来测试程序。

```
 public static void main(String [] args){
        Liskov.program(new Circle(2)); // prints "The radius is 2"
        Liskov.program(new Square(2)); // prints "The radius is -1"
    }
} 
```

发生了什么 ？直观地说，虽然`Square`是 的子类`Circle`，*但不是*`Square`的子类型，因为没有任何常规实例的半径为 -1。*`Circle``Circle`*

 *形式上，这违反了里氏替换原则。

我们有一个程序定义为，`Circle`并且在该程序中没有`Circle`可以替换`new Square(2)`（或任何`Square`实例）的对象并且保持行为不变：记住 any 的半径`Circle`始终为正。

# 子类和子类型

现在我们知道为什么**子类**并不总是**子类型**。当子类不是子类型时，即存在 LSP 违规时，某些程序（至少一个）的行为将不会始终是预期的行为。这非常令人沮丧，通常被解释为错误。

在理想世界中，编译器或解释器将能够检查给定的子类是否是真正的子类型，但我们不在理想世界中。

## 静态类型

如果有一些静态类型，你会在编译时受到超类签名的约束。`Square.getRadius()`不能返回 a`String`或 a `List`。

如果没有静态类型，如果一个参数的类型错误（除非类型很弱）或参数的数量不一致（除非语言非常宽松），您将在运行时收到错误。

*关于静态类型的注意事项：存在返回类型的协变（S 的方法可以返回 T 的相同方法的返回类型的子类）和参数类型的逆变（S 的方法可以接受T 的相同方法的相同参数的参数的超类）。这是下面解释的前置条件和后置条件的特定情况。*

## 合同设计

还有更多。某些语言（我认为是 Eiffel）提供了一种强制遵守 LSP 的机制。

更不用说确定`o2`初始对象的投影了`o1`，我们可以期待任何程序的相同行为 if`o1`被替换为`o2`if，**对于任何参数`x`和任何方法`f`**：

*   如果`o2.f(x)`是一个有效的调用，那么`o1.f(x)`也应该是一个有效的调用 (1)。
*   的结果（返回值、控制台上的显示等）`o1.f(x)`应该等于 的结果`o2.f(x)`，或者至少同样有效 (2)。
*   `o1.f(x)`应该让`o1`进入内部状态并且`o2.f(x)`应该让`o2`进入内部状态，以便下一个函数调用将确保 (1)、(2) 和 (3) 仍然有效 (3)。

（*请注意，如果函数`f`是纯函数，则 (3) 是免费提供的。这就是我们喜欢拥有不可变对象的原因。*）

这些条件是关于类的**语义**（期望什么），而不仅仅是类的语法。而且，这些条件非常强。但是它们可以通过合同编程的设计断言来近似。这些断言是一种确保类型语义得到维护的方法。违反合同会导致运行时错误。

*   前置条件定义什么是有效调用。当对一个类进行子类化时，前提条件只能被削弱（`S.f`接受超过`T.f`）（a）。
*   后置条件定义什么是有效结果。当子类化一个类时，后置条件只能被加强（`S.f`提供超过`T.f`）（b）。
*   不变量定义了什么是有效的内部状态。当对一个类进行子类化时，不变量必须保持不变 (c)。

我们看到，粗略地说，（a）确保（1）和（b）确保（2），但（c）比（3）弱。此外，断言有时难以表达。

想象一个类`Counter`有一个返回下一个整数的唯一方法`Counter.counter()`。您如何为此编写后置条件？想象一个类`Random`有一个`Random.gaussian()`返回 0.0 和 1.0 之间的浮点数的方法。您如何编写后置条件来检查分布是否为高斯分布？这可能是可能的，但成本会很高，以至于我们将依赖测试而不是后置条件。

# 结论

不幸的是，子类并不总是子类型。这可能会导致意外的行为——一个错误。

OOP 语言提供了避免这种情况的机制。首先在句法层面。在语义级别也是如此，这取决于编程语言：一部分语义可以使用断言编码在程序的文本中。但是确保子类是子类型取决于您。

还记得你是从什么时候开始学习 OOP 的吗？“如果关系是 IS-A，则使用继承”。反之亦然：**如果您使用继承，请确保关系是 IS-A**。

LSP 在比断言更高的级别上定义了什么是子类型。断言是确保 LSP 得到维护的宝贵工具。

* * *

## 回答 #25

> 赞同：4
> 
> 时间：2008-09-11T15:28:44.027

用一组 Board 来实现 ThreeDBoard 会有用吗？

也许您可能希望将各个平面上的 ThreeDBoard 切片视为 Board。在这种情况下，您可能希望为 Board 抽象出一个接口（或抽象类）以允许多个实现。

在外部接口方面，您可能需要为 TwoDBoard 和 ThreeDBoard 考虑一个 Board 接口（尽管上述方法都不适合）。

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2016-05-03T19:34:38.153

到目前为止，我发现的 LSP 最清晰的解释是“Liskov 替换原则说，派生类的对象应该能够替换基类的对象，而不会在系统中带来任何错误或修改基类的行为“从[这里](http://www.infragistics.com/community/blogs/dhananjay_kumar/archive/2015/06/30/simplifying-the-liskov-substitution-principle-of-solid-in-c.aspx)。本文给出了违反 LSP 并修复它的代码示例。

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2017-10-09T04:26:28.383

假设我们在代码中使用了一个矩形

```
r = new Rectangle();
// ...
r.setDimensions(1,2);
r.fill(colors.red());
canvas.draw(r); 
```

在我们的几何课中，我们了解到正方形是一种特殊类型的矩形，因为它的宽度与高度相同。让我们`Square`也根据这些信息创建一个类：

```
class Square extends Rectangle {
    setDimensions(width, height){
        assert(width == height);
        super.setDimensions(width, height);
    }
} 
```

如果我们在第一个代码中替换为`Rectangle`，`Square`那么它将中断：

```
r = new Square();
// ...
r.setDimensions(1,2); // assertion width == height failed
r.fill(colors.red());
canvas.draw(r); 
```

这是因为有一个我们在课堂`Square`上没有的新前提： . 根据 LSP，实例应该可以用子类实例替代。这是因为这些实例通过了实例的类型检查，因此它们会导致代码中出现意外错误。`Rectangle``width == height``Rectangle``Rectangle``Rectangle`

[这是wiki 文章中](https://en.wikipedia.org/wiki/Liskov_substitution_principle)*“无法在子类型中加强先决条件”*部分的示例。所以总而言之，违反 LSP 可能会在某些时候导致代码中的错误。

* * *

## 回答 #28

> 赞同：3
> 
> 时间：2019-04-06T12:55:40.627

LSP 说“对象应该可以被它们的子类型替换”。另一方面，这一原则指向

> 子类不应该破坏父类的类型定义。

下面的例子有助于更好地理解 LSP。

没有 LSP：

```
public interface CustomerLayout{

    public void render();
}

public FreeCustomer implements CustomerLayout {
     ...
    @Override
    public void render(){
        //code
    }
}

public PremiumCustomer implements CustomerLayout{
    ...
    @Override
    public void render(){
        if(!hasSeenAd)
            return; //it isn`t rendered in this case
        //code
    }
}

public void renderView(CustomerLayout layout){
    layout.render();
} 
```

通过 LSP 修复：

```
public interface CustomerLayout{
    public void render();
}

public FreeCustomer implements CustomerLayout {
     ...
    @Override
    public void render(){
        //code
    }
}

public PremiumCustomer implements CustomerLayout{
    ...
    @Override
    public void render(){
        if(!hasSeenAd)
            showAd();//it has a specific behavior based on its requirement
        //code
    }
}

public void renderView(CustomerLayout layout){
    layout.render();
} 
```

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2013-09-09T07:32:23.133

我鼓励您阅读这篇文章：[违反 Liskov 替换原则 (LSP)](http://www.codeproject.com/Articles/648987/Violating-Liskov-Substitution-Principle-LSP)。

您可以在其中找到什么是 Liskov 替换原则的解释、帮助您猜测是否已经违反它的一般线索以及帮助您使类层次结构更安全的方法示例。

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2016-08-12T17:16:29.980

LISKOV SUBSTITUTION PRINCIPLE（来自 Mark Seemann 的书）指出，我们应该能够在不破坏客户端或实现的情况下将接口的一个实现替换为另一个实现。正是这一原则能够解决未来出现的需求，即使我们可以。今天无法预见它们。

如果我们把电脑从墙上拔下来（实现），墙上的插座（接口）和电脑（客户端）都不会坏（事实上，如果是笔记本电脑，它甚至可以用电池运行一段时间） . 然而，对于软件，客户通常希望服务可用。如果服务被删除，我们会收到 NullReferenceException。为了处理这种情况，我们可以创建一个“什么都不做”的接口实现。这是一种称为 Null Object [4] 的设计模式，它大致对应于将计算机从墙上拔下。因为我们使用的是松散耦合，所以我们可以用什么都不做而不会造成麻烦的东西代替真正的实现。

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2017-09-23T19:26:00.980

Likov 的替换原则指出，*如果程序模块正在使用 Base 类，那么对 Base 类的引用可以替换为 Derived 类，而不会影响程序模块的功能。*

意图 - 派生类型必须完全替代它们的基本类型。

示例 - java 中的协变返回类型。

* * *

## 回答 #32

> 赞同：2
> 
> 时间：2018-08-12T17:10:59.413

[这是这篇文章](https://dzone.com/articles/liskov-substitution-principle-or-how-to-create-bea)的摘录，很好地澄清了事情：

[..] 为了理解一些原则，重要的是要意识到它何时被违反。这就是我现在要做的。

违反这个原则是什么意思？这意味着一个对象不履行由接口表达的抽象所强加的契约。换句话说，这意味着您错误地识别了您的抽象。

考虑以下示例：

```
interface Account
{
    /**
     * Withdraw $money amount from this account.
     *
     * @param Money $money
     * @return mixed
     */
    public function withdraw(Money $money);
}
class DefaultAccount implements Account
{
    private $balance;
    public function withdraw(Money $money)
    {
        if (!$this->enoughMoney($money)) {
            return;
        }
        $this->balance->subtract($money);
    }
} 
```

这是否违反了 LSP？是的。这是因为账户的合约告诉我们账户会被撤回，但情况并非总是如此。那么，我应该怎么做才能修复它？我只是修改合同：

```
interface Account
{
    /**
     * Withdraw $money amount from this account if its balance is enough.
     * Otherwise do nothing.
     *
     * @param Money $money
     * @return mixed
     */
    public function withdraw(Money $money);
} 
```

瞧，现在合同已经完成了。

这种微妙的违反常常使客户有能力分辨所使用的具体对象之间的区别。例如，给定第一个 Account 的合约，它可能如下所示：

```
class Client
{
    public function go(Account $account, Money $money)
    {
        if ($account instanceof DefaultAccount && !$account->hasEnoughMoney($money)) {
            return;
        }
        $account->withdraw($money);
    }
} 
```

而且，这自动违反了开闭原则[即对于提款要求。因为你永远不知道如果违反合同的对象没有足够的钱会发生什么。可能它什么都不返回，可能会抛出异常。所以你必须检查它`hasEnoughMoney()`是否不是接口的一部分。因此，这种强制的依赖于具体类的检查是违反 OCP 的]。

这一点也解决了我经常遇到的关于 LSP 违规的误解。它说“如果父母的行为改变了孩子，那么，它违反了 LSP。” 然而，它不会——只要孩子不违反父母的合同。

* * *

## 回答 #33

> 赞同：2
> 
> 时间：2020-11-11T15:08:17.660

[[坚硬的]](https://stackoverflow.com/a/66087638/4770877)

[Wiki Liskov 替换原则 (LSP)](https://en.wikipedia.org/wiki/Liskov_substitution_principle)

**类（子类型）**

> 先决条件不能在子类型中得到加强。
> 后置条件不能在子类型中被削弱。
> 超类型的不变量必须保留在子类型中。

*前置条件和后置条件是`function (method) types`^([[Swift Function 类型。Swift 函数 vs 方法]](https://stackoverflow.com/a/60988242/4770877))

*   Sybtype 对调用者的要求不应超过超类型
*   Sybtype 不应该暴露给调用者少于超类型

```
//C1 <- C2 <- C3

class C1 {}
class C2: C1 {}
class C3: C2 {} 
```

*   前提条件（例如 function `parameter type`）可以相同或更弱。（争取-> C1）

*   后置条件（例如 function `returned type`）可以相同或更强（争取 -> C3）

*   超类型的不变变量[^([About]应该保持不变)](https://stackoverflow.com/a/64788342/4770877)

迅速

```
class A {
    func foo(a: C2) -> C2 {
        return C2()
    }
}

class B: A {
    override func foo(a: C1) -> C3 {
        return C3()
    }
} 
```

爪哇

```
class A {
    public C2 foo(C2 a) {
        return new C2();
    }
}

class B extends A {

    @Override
    public C3 foo(C2 a) { //You are available pass only C2 as parameter
        return new C3();
    }
} 
```

**函数（覆盖）** 方法签名）

> 子类型中方法参数的逆变。
> 子类型中返回类型的协方差。
> 子类型的方法不应抛出新的异常，除非这些异常本身是超类型方法抛出的异常的子类型。

[[方差、协方差、逆变]](https://stackoverflow.com/a/62752867/4770877)

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2019-04-26T06:59:43.353

让我试试，考虑一个接口：

```
interface Planet{
} 
```

这是由类实现的：

```
class Earth implements Planet {
    public $radius;
    public function construct($radius) {
        $this->radius = $radius;
    }
} 
```

您将地球用作：

```
$planet = new Earth(6371);
$calc = new SurfaceAreaCalculator($planet);
$calc->output(); 
```

现在考虑另一个扩展地球的类：

```
class LiveablePlanet extends Earth{
   public function color(){
   }
} 
```

现在根据 LSP，您应该能够使用 LiveablePlanet 代替 Earth，它不应该破坏您的系统。像：

```
$planet = new LiveablePlanet(6371);  // Earlier we were using Earth here
$calc = new SurfaceAreaCalculator($planet);
$calc->output(); 
```

取自[此处的示例](https://bootsity.com/php/understanding-the-solid-principles-of-software-engineering)

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2021-12-14T23:53:50.037

> 令 q(x) 是关于类型 T 的 x 对象可证明的属性。那么 q(y) 应该对于类型 S 的对象 y 是可证明的，其中 S 是 T 的子类型。

* * *

实际上，公认的答案并不是 Liskov 原则的反例。正方形自然是特定的矩形，因此继承自类 rectangle 是完全合理的。您只需要以这种方式实现它：

```
@Override
public void setHeight(double height) {
   this.height = height;
   this.width = height; // since it's a square
}

@Override
public void setWidth(double width) {
   setHeight(width);
} 
```

* * *

因此，在提供了一个很好的例子之后，这是一个反例：

```
class Family:
-- getChildrenCount()

class FamilyWithKids extends Family:
-- getChildrenCount() { return childrenCount; } // always > 0

class DeadFamilyWithKids extends FamilyWithKids:
-- getChildrenCount() { return 0; }
-- getChildrenCountWhenAlive() { return childrenCountWhenAlive; } 
```

在这个实现中，`DeadFamilyWithKids`不能继承`FamilyWithKids`自`getChildrenCount()`返回`0`，而从`FamilyWithKids`它应该总是返回更大的东西`0`。

# java - 从 Seam 调用 Web 服务

> ID：56865
> 
> 赞同：3
> 
> 时间：2008-09-11T15:20:05.453
> 
> 标签：java, seam

一个简单的问题，但是有人可以提供示例代码来说明某人如何从 JBoss Seam 框架中调用 Web 服务并处理结果吗？

我需要能够与将其功能公开为 Web 服务的私人供应商提供的搜索平台集成。所以，我只是在寻找一些关于调用给定 Web 服务的代码是什么样子的指导。

（可以选择任何示例 Web 服务作为示例。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-12T10:04:05.517

大约有一个庞大的 HTTP 客户端库（Restlet 远不止这些，但我已经有了其他的代码片段），但它们都应该支持发送 GET 请求。这是一个使用Apache Commons的[HttpClient的功能较少的片段：](http://hc.apache.org/httpclient-3.x/tutorial.html)

```
HttpClient client = new HttpClient();
HttpMethod method = new GetMethod("http://api.search.yahoo.com/WebSearchService/V1/webSearch?appid=restbook&query=HttpClient");
client.executeMethod(method); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T16:58:35.653

```
import org.restlet.Client;
import org.restlet.data.Protocol;
import org.restlet.data.Reference;
import org.restlet.data.Response;
import org.restlet.resource.DomRepresentation;
import org.w3c.dom.Node;

/**
 * Uses YAHOO!'s RESTful web service with XML.
 */
public class YahooSearch {
    private static final String BASE_URI = "http://api.search.yahoo.com/WebSearchService/V1/webSearch";

    public static void main(final String[] args) {
        if (1 != args.length) {
            System.err.println("You need to pass a search term!");
        } else {
            final String term = Reference.encode(args[0]);
            final String uri = BASE_URI + "?appid=restbook&query=" + term;
            final Response response = new Client(Protocol.HTTP).get(uri);
            final DomRepresentation document = response.getEntityAsDom();

            document.setNamespaceAware(true);
            document.putNamespace("y", "urn:yahoo:srch");

            final String expr = "/y:ResultSet/y:Result/y:Title/text()";
            for (final Node node : document.getNodes(expr)) {
                System.out.println(node.getTextContent());
            }
        }
    }
} 
```

此代码使用[Restlet](http://www.restlet.org/)向 Yahoo 的 RESTful 搜索服务发出请求。显然，您正在使用的 Web 服务的详细信息将决定您的客户端的外观。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T17:40:42.027

```
final Response response = new Client(Protocol.HTTP).get(uri); 
```

所以，如果我理解正确的话，上面这行是对 Web 服务进行实际调用的地方，响应被转换为适当的格式并在此行之后进行操作。

假设我没有使用 Restlet，这条线会有什么不同？
*（当然，实际的处理代码也会有很大的不同，所以这是给定的。）*

# oop - 接口与基类

> ID：56867
> 
> 赞同：808
> 
> 时间：2008-09-11T15:20:30.803
> 
> 标签：oop, interface, language-agnostic, base-class, static-typing

什么时候应该使用接口，什么时候应该使用基类？

如果我不想实际定义方法的基本实现，它是否应该始终是一个接口？

如果我有狗和猫课。为什么我要实现 IPet 而不是 PetBase？我可以理解为 ISheds 或 IBarks （IMakesNoise？）提供接口，因为这些接口可以逐个放置在宠物上，但我不明白哪个用于通用宠物。

* * *

## 回答 #1

> 赞同：521
> 
> 时间：2008-09-11T15:36:14.540

让我们以 Dog 和 Cat 类为例，并使用 C# 进行说明：

狗和猫都是动物，特别是四足哺乳动物（动物太笼统了）。让我们假设您对它们都有一个抽象类 Mammal：

```
public abstract class Mammal 
```

这个基类可能有默认方法，例如：

*   喂养
*   伴侣

所有这些都是在两个物种之间具有或多或少相同实现的行为。要定义这一点，您将拥有：

```
public class Dog : Mammal
public class Cat : Mammal 
```

现在让我们假设还有其他哺乳动物，我们通常会在动物园里看到它们：

```
public class Giraffe : Mammal
public class Rhinoceros : Mammal
public class Hippopotamus : Mammal 
```

这仍然是有效的，因为在功能的核心`Feed()`并且`Mate()`仍然是相同的。

然而，长颈鹿、犀牛和河马并不完全是可以用来制作宠物的动物。这就是接口有用的地方：

```
public interface IPettable
{
    IList<Trick> Tricks{get; set;}
    void Bathe();
    void Train(Trick t);
} 
```

上述合同的执行在猫和狗之间是不同的；将它们的实现放在一个抽象类中继承将是一个坏主意。

您的 Dog 和 Cat 定义现在应该如下所示：

```
public class Dog : Mammal, IPettable
public class Cat : Mammal, IPettable 
```

理论上你可以从更高的基类覆盖它们，但本质上一个接口允许你只将你需要的东西添加到一个类中，而不需要继承。

因此，因为您通常只能从一个抽象类继承（在大多数静态类型的 OO 语言中......例外包括 C++）但能够实现多个接口，它允许您在严格*按要求*的基础上构造对象。

* * *

## 回答 #2

> 赞同：150
> 
> 时间：2008-09-11T15:32:11.460

好吧，Josh Bloch 在[Effective Java 2d](https://rads.stackoverflow.com/amzn/click/com/0321356683)中说自己：

## 比抽象类更喜欢接口

一些要点：

> *   **现有的类可以很容易地改造以实现一个新的接口**。您所要做的就是添加所需的方法（如果它们尚不存在）并在类声明中添加一个 implements 子句。
>     
>     
> *   **接口是定义 mixins 的理想选择**。粗略地说，mixin 是一个类除了它的“主要类型”之外还可以实现的一种类型，以声明它提供了一些可选的行为。例如，Comparable 是一个 mixin 接口，它允许类声明其实例相对于其他可相互比较的对象是有序的。
>     
>     
> *   **接口允许构建非分层类型的框架**。类型层次结构非常适合组织某些事物，但其他事物并不能整齐地落入严格的层次结构中。
>     
>     
> *   **接口通过包装类习惯用法**实现了安全、强大的功能增强。**如果你使用抽象类来定义类型，你就让想要添加功能的程序员别无选择，只能使用继承。**
>     
>     
> 
>  **此外，您可以通过提供一个抽象骨架实现类与您导出的每个重要接口一起使用，从而结合接口和抽象类的优点。**

 **另一方面，接口很难发展。如果您向接口添加方法，它将破坏它的所有实现。

PS：买书。它更详细。

* * *

## 回答 #3

> 赞同：131
> 
> 时间：2008-09-15T19:25:29.730

接口和基类代表两种不同形式的关系。

**继承**（基类）表示“is-a”关系。例如，狗或猫“是”宠物。这种关系总是代表类的（单一）**目的**（结合[“单一责任原则”](http://codebetter.com/blogs/glenn.block/archive/2008/09/11/the-alt-net-criterion.aspx "软件工程最重要原则的参考资料")）。

**另一方面，**接口代表一个类的****附加特性**。我将其称为“是”关系，就像在“`Foo`是一次性的”中一样，因此是`IDisposable`C# 中的接口。**

 *** * *

## 回答 #4

> 赞同：111
> 
> 时间：2008-09-11T15:22:03.967

现代风格是定义IPet*和*PetBase。

该接口的优点是其他代码可以使用它，而与其他可执行代码没有任何联系。完全“干净”。接口也可以混合。

但是基类对于简单的实现和通用实用程序很有用。所以也提供一个抽象基类来节省时间和代码。

* * *

## 回答 #5

> 赞同：65
> 
> 时间：2008-09-11T15:52:34.797

## 接口

*   大多数语言允许您实现多个接口
*   修改界面是一项重大更改。所有实现都需要重新编译/修改。
*   所有成员都是公开的。实现必须实现所有成员。
*   接口有助于解耦。您可以使用模拟框架来模拟接口后面的任何内容
*   接口通常表示一种行为
*   接口实现相互解耦/隔离

## 基类

*   允许您添加一些通过派生免费获得的**默认**实现（从 C# 8.0 通过接口，您可以拥有默认实现）
*   除了 C++，你只能从一个类派生。即使可以来自多个班级，这通常也是一个坏主意。
*   更改基类相对容易。推导不需要做任何特别的事情
*   基类可以声明可以通过派生访问的受保护和公共函数
*   抽象基类不能像接口一样容易被模拟
*   基类通常表示类型层次结构 (IS A)
*   类派生可能依赖于一些基本行为（对父实现有复杂的了解）。如果您对一个人的基本实现进行更改并破坏其他人，事情可能会变得一团糟。

* * *

## 回答 #6

> 赞同：60
> 
> 时间：2008-09-11T15:22:47.397

一般来说，你应该更喜欢接口而不是抽象类。使用抽象类的一个原因是，如果您在具体类之间有共同的实现。当然，您仍然应该声明一个接口 (IPet) 并让一个抽象类 (PetBase) 实现该接口。使用小而不同的接口，您可以使用多个接口来进一步提高灵活性。接口允许跨边界类型的最大灵活性和可移植性。跨边界传递引用时，始终传递接口而不是具体类型。这允许接收端确定具体的实施并提供最大的灵活性。在以 TDD/BDD 方式编程时，这是绝对正确的。

四人组在他们的书中说：“因为继承将子类暴露给其父类的实现细节，所以人们常说‘继承破坏了封装’”。我相信这是真的。

* * *

## 回答 #7

> 赞同：51
> 
> 时间：2008-09-11T16:18:49.023

这是非常特定于 .NET 的，但《框架设计指南》一书认为，一般来说，类在不断发展的框架中提供了更大的灵活性。一旦一个接口被交付，你就没有机会在不破坏使用该接口的代码的情况下更改它。但是，对于一个类，您可以修改它而不破坏链接到它的代码。只要您做出正确的修改，包括添加新功能，您就可以扩展和发展您的代码。

Krzysztof Cwalina 在第 81 页说：

> 在 .NET Framework 的三个版本的过程中，我已经与我们团队中的很多开发人员讨论了这个指南。他们中的许多人，包括那些最初不同意这些指导方针的人，都表示他们后悔将一些 API 作为接口发布。我从来没有听说过有人后悔他们运送了一个班级。

话虽这么说，接口肯定有一席之地。作为一般准则，始终提供接口的抽象基类实现，如果没有别的作为实现接口的方法的示例。在最好的情况下，基类将节省大量工作。

* * *

## 回答 #8

> 赞同：19
> 
> 时间：2008-09-11T21:32:07.710

胡安

我喜欢将接口视为描述类的一种方式。一个特定的犬种类，比如约克夏犬，可能是父犬类的后代，但它也实现了 IFurry、IStubby 和 IYippieDog。所以类定义了类是什么，但接口告诉我们关于它的事情。

这样做的好处是它允许我收集所有的 IYippieDog 并将它们放入我的 Ocean 收藏中。所以现在我可以跨越一组特定的对象并找到符合我正在查看的标准的对象，而无需过于仔细地检查类。

我发现接口确实应该定义一个类的公共行为的子集。如果它为所有实现的类定义了所有公共行为，那么它通常不需要存在。他们没有告诉我任何有用的东西。

这种想法虽然与每个类都应该有一个接口并且你应该对接口进行编码的想法背道而驰。这很好，但是你最终会得到很多一对一的类接口，这会让事情变得混乱。我知道这个想法是它实际上并不需要任何成本，现在您可以轻松地交换东西。但是，我发现我很少这样做。大多数时候，我只是在适当地修改现有类，并且如果该类的公共接口需要更改，我总是会遇到完全相同的问题，除了我现在必须在两个地方进行更改。

因此，如果您像我一样思考，您肯定会说 Cat 和 Dog 是 IPettable。这是一个与他们两者相匹配的特征。

另一部分是它们应该具有相同的基类吗？问题是它们是否需要被广泛视为同一事物。当然它们都是动物，但这符合我们将如何一起使用它们。

假设我想收集所有 Animal 类并将它们放在我的 Ark 容器中。

或者他们需要是哺乳动物吗？也许我们需要某种跨动物挤奶厂？

它们甚至需要连接在一起吗？只知道它们都是 IPettable 就足够了吗？

当我真的只需要一个类时，我经常感到想要派生出整个类层次结构。我这样做是为了期待有一天我可能需要它，但通常我从不这样做。即使我这样做了，我通常也会发现我必须做很多事情来修复它。那是因为我创建的第一个类不是狗，我没有那么幸运，而是鸭嘴兽。现在我的整个类层次结构都是基于奇怪的情况，我有很多浪费的代码。

在某些时候，您可能还会发现并非所有猫都是 IPettable（就像那只无毛猫）。现在您可以将该接口移动到所有适合的派生类。您会发现突然之间 Cats 不再从 PettableBase 派生的破坏性变化要小得多。

* * *

## 回答 #9

> 赞同：19
> 
> 时间：2008-10-15T06:19:23.863

这是接口和基类的基本和简单定义：

*   基类 = 对象继承。
*   接口 = 功能继承。

干杯

* * *

## 回答 #10

> 赞同：15
> 
> 时间：2008-10-16T20:39:24.500

[这篇Java World 文章](http://www.javaworld.com/javaworld/javaqa/2001-04/03-qa-0420-abstract.html)对此进行了很好的解释。

就个人而言，我倾向于使用接口来定义接口——即系统设计中指定如何访问某些东西的部分。

我将有一个实现一个或多个接口的类并不少见。

我用抽象类作为其他东西的基础。

以下是上述文章[JavaWorld.com 文章的摘录，作者 Tony Sintes，04/20/01](http://www.javaworld.com/javaworld/javaqa/2001-04/03-qa-0420-abstract.html)

* * *

> ## 接口与抽象类
> 
> 选择接口和抽象类不是一个非此即彼的命题。如果你需要改变你的设计，把它变成一个界面。但是，您可能有提供一些默认行为的抽象类。抽象类是应用程序框架内的优秀候选者。
> 
> 抽象类让你定义一些行为；他们强迫您的子类提供其他人。例如，如果您有一个应用程序框架，那么一个抽象类可能会提供默认服务，例如事件和消息处理。这些服务允许您的应用程序插入到您的应用程序框架中。但是，有一些特定于应用程序的功能只有您的应用程序才能执行。此类功能可能包括启动和关闭任务，这些任务通常依赖于应用程序。因此，抽象基类可以声明抽象的关闭和启动方法，而不是尝试定义该行为本身。基类知道它需要这些方法，但是抽象类让你的类承认它不知道如何执行这些操作；它只知道它必须启动这些动作。启动时间到了，抽象类可以调用启动方法。当基类调用该方法时，Java 调用子类定义的方法。
> 
> 许多开发人员忘记了定义抽象方法的类也可以调用该方法。抽象类是创建计划继承层次结构的绝佳方式。它们也是类层次结构中非叶类的不错选择。
> 
> ## 类与接口

有人说你应该根据接口定义所有类，但我认为推荐似乎有点极端。当我看到我的设计中的某些内容会经常更改时，我会使用接口。

> 例如，策略模式允许您将新算法和流程交换到您的程序中，而无需更改使用它们的对象。媒体播放器可能知道如何播放 CD、MP3 和 wav 文件。当然，您不想将这些播放算法硬编码到播放器中；这将使添加新格式（如 AVI）变得困难。此外，您的代码将充满无用的 case 语句。雪上加霜的是，每次添加新算法时，您都需要更新这些案例陈述。总而言之，这不是一种非常面向对象的编程方式。
> 
> 使用策略模式，您可以简单地将算法封装在对象后面。如果您这样做，您可以随时提供新的媒体插件。我们将插件类称为 MediaStrategy。该对象将有一个方法：playStream(Stream s)。因此，要添加新算法，我们只需扩展我们的算法类。现在，当程序遇到新的媒体类型时，它只是将流的播放委托给我们的媒体策略。当然，您需要一些管道来正确实例化您需要的算法策略。
> 
> 这是一个使用界面的好地方。我们使用了策略模式，它清楚地表明了设计中会发生变化的地方。因此，您应该将策略定义为接口。当您希望对象具有某种类型时，通常应该优先使用接口而不是继承；在这种情况下，MediaStrategy。依赖类型标识的继承是危险的；它将您锁定在特定的继承层次结构中。Java 不允许多重继承，所以你不能扩展一些给你有用的实现或更多类型标识的东西。

* * *

## 回答 #11

> 赞同：12
> 
> 时间：2008-09-11T19:03:01.780

我建议尽可能使用组合而不是继承。使用接口，但使用成员对象进行基本实现。这样，您可以定义一个工厂，该工厂将您的对象构造为以某种方式运行。如果要更改行为，则创建一个新的工厂方法（或抽象工厂）来创建不同类型的子对象。

在某些情况下，如果所有可变行为都在辅助对象中定义，您可能会发现主对象根本不需要接口。

因此，您最终可能会得到一个具有 IFurBehavior 参数的 Pet，而不是 IPet 或 PetBase。IFurBehavior 参数由 PetFactory 的 CreateDog() 方法设置。shed() 方法调用的正是这个参数。

如果您这样做，您会发现您的代码更加灵活，并且您的大多数简单对象都处理非常基本的系统范围的行为。

即使在多重继承语言中，我也推荐这种模式。

* * *

## 回答 #12

> 赞同：11
> 
> 时间：2008-09-15T18:54:51.440

另外请记住，不要在 OO 中被扫除（[请参阅博客](http://www.indiangeek.net/2006/10/25/do-not-start-with-an-interface)）并始终根据所需的行为对对象进行建模，如果您正在设计一个应用程序，其中您需要的唯一行为是动物的通用名称和物种，那么您只需要一个类 Animal 具有名称的属性，而不是世界上每种可能的动物的数百万个类。

* * *

## 回答 #13

> 赞同：10
> 
> 时间：2012-10-14T08:56:40.550

我有一个粗略的经验法则

**功能：**可能在所有部分都不同：接口。

**数据和功能部分大部分相同，部分不同：**抽象类。

**实际工作的数据和功能，如果仅稍作更改即可扩展：**普通（具体）类

**数据和功能，未计划更改：**带有 final 修饰符的普通（具体）类。

**数据，也许还有功能：只读：**枚举成员。

这是非常粗略和现成的，并且根本没有严格定义，但是有一个范围，从所有内容都打算更改的接口到所有内容都像只读文件一样固定的枚举。

* * *

## 回答 #14

> 赞同：9
> 
> 时间：2014-12-09T20:42:00.577

**来源**：http: [//jasonroell.com/2014/12/09/interfaces-vs-abstract-classes-what-should-you-use/](http://jasonroell.com/2014/12/09/interfaces-vs-abstract-classes-what-should-you-use/)

C# 是一种美妙的语言，在过去的 14 年中已经成熟和发展。这对我们开发人员来说非常有用，因为成熟的语言为我们提供了大量可供我们使用的语言功能。

然而，权力越大，责任越大。其中一些功能可能会被滥用，或者有时很难理解为什么您会选择使用一个功能而不是另一个功能。多年来，我看到许多开发人员都在苦苦挣扎的一个特性是何时选择使用接口或选择使用抽象类。两者都有优点和缺点以及使用它们的正确时间和地点。但是我们如何决定？？？

两者都提供了类型之间公共功能的重用。最明显的区别是接口没有为其功能提供实现，而抽象类允许您实现一些“基本”或“默认”行为，然后能够在必要时用类派生类型“覆盖”这种默认行为.

这一切都很好，提供了代码的大量重用，并遵守软件开发的 DRY（不要重复自己）原则。当您有“是”关系时，抽象类非常有用。

例如：金毛猎犬“是”一种狗。贵宾犬也是如此。他们都可以吠叫，就像所有的狗一样。但是，您可能要声明贵宾犬公园与“默认”狗吠声明显不同。因此，您可以按照以下方式实现：

```
public abstract class Dog
{
      public virtual void Bark()
      {
        Console.WriteLine("Base Class implementation of Bark");
      }
}

public class GoldenRetriever : Dog
{
   // the Bark method is inherited from the Dog class
}

public class Poodle : Dog
{
  // here we are overriding the base functionality of Bark with our new implementation
  // specific to the Poodle class
  public override void Bark()
  {
     Console.WriteLine("Poodle's implementation of Bark");
  }
}

// Add a list of dogs to a collection and call the bark method.

void Main()
{
    var poodle = new Poodle();
    var goldenRetriever = new GoldenRetriever();

    var dogs = new List<Dog>();
    dogs.Add(poodle);
    dogs.Add(goldenRetriever);

    foreach (var dog in dogs)
    {
       dog.Bark();
    }
}

// Output will be:
// Poodle's implementation of Bark
// Base Class implementation of Bark

// 
```

如您所见，这将是保持代码 DRY 并允许在任何类型仅依赖默认 Bark 而不是特殊情况实现时调用基类实现的好方法。GoldenRetriever、Boxer、Lab 等类都可以免费继承“默认”（低音类）Bark，因为它们实现了 Dog 抽象类。

但我相信你已经知道了。

您在这里是因为您想了解为什么您可能希望选择接口而不是抽象类，反之亦然。好吧，您可能想要选择接口而不是抽象类的一个原因是当您没有或想要阻止默认实现时。这通常是因为实现接口的类型在“是”关系中不相关。实际上，除了每个类型“能够”或具有“能力”做某事或拥有某事这一事实之外，它们根本不必相关。

现在这到底是什么意思？好吧，例如：人不是鸭子……鸭子也不是人。很明显。然而，鸭子和人类都有游泳的“能力”（假设人类在一年级就通过了游泳课:)）。此外，由于鸭子不是人，反之亦然，这不是“是”关系，而是“能够”的关系，我们可以使用界面来说明：

```
// Create ISwimable interface
public interface ISwimable
{
      public void Swim();
}

// Have Human implement ISwimable Interface
public class Human : ISwimable

     public void Swim()
     {
        //Human's implementation of Swim
        Console.WriteLine("I'm a human swimming!");
     }

// Have Duck implement ISwimable interface
public class Duck: ISwimable
{
     public void Swim()
     {
          // Duck's implementation of Swim
          Console.WriteLine("Quack! Quack! I'm a Duck swimming!")
     }
}

//Now they can both be used in places where you just need an object that has the ability "to swim"

public void ShowHowYouSwim(ISwimable somethingThatCanSwim)
{
     somethingThatCanSwim.Swim();
}

public void Main()
{
      var human = new Human();
      var duck = new Duck();

      var listOfThingsThatCanSwim = new List<ISwimable>();

      listOfThingsThatCanSwim.Add(duck);
      listOfThingsThatCanSwim.Add(human);

      foreach (var something in listOfThingsThatCanSwim)
      {
           ShowHowYouSwim(something);
      }
}

 // So at runtime the correct implementation of something.Swim() will be called
 // Output:
 // Quack! Quack! I'm a Duck swimming!
 // I'm a human swimming! 
```

使用像上面代码这样的接口将允许你将一个对象传递给一个“能够”做某事的方法。代码并不关心它是怎么做的……它所知道的是它可以调用那个对象的 Swim 方法，并且那个对象会根据它的类型知道在运行时采取哪些行为。

再一次，这有助于您的代码保持 DRY，这样您就不必编写多个调用对象的方法来执行相同的核心函数（ShowHowHumanSwims(human)、ShowHowDuckSwims(duck) 等）

在这里使用接口允许调用方法不必担心是什么类型或行为是如何实现的。它只知道给定接口，每个对象都必须实现 Swim 方法，因此可以安全地在自己的代码中调用它，并允许在自己的类中处理 Swim 方法的行为。

概括：

所以我的主要经验法则是，当您想为类层次结构实现“默认”功能或/并且您正在使用的类或类型共享“是”关系时（例如，贵宾犬“是”类型的狗）。

另一方面，当您没有“是”关系但具有共享“能力”做某事或拥有某事的类型时使用接口（例如，鸭子“不是”人类。但是，鸭子和人类共享“能力”游泳）。

抽象类和接口之间需要注意的另一个区别是，一个类可以实现一对多接口，但一个类只能从一个抽象类（或任何类）继承。是的，您可以嵌套类并具有继承层次结构（许多程序都具有并且应该具有），但是您不能在一个派生类定义中继承两个类（此规则适用于 C#。在某些其他语言中，通常可以这样做只是因为这些语言缺乏接口）。

还要记住在使用接口时要遵守接口隔离原则 (ISP)。ISP 声明不应强迫任何客户端依赖它不使用的方法。出于这个原因，接口应该专注于特定任务并且通常非常小（例如 IDisposable、IComparable ）。

另一个提示是，如果您正在开发小而简洁的功能，请使用接口。如果您正在设计大型功能单元，请使用抽象类。

希望这可以为某些人解决问题！

另外，如果您能想到任何更好的例子或想指出一些事情，请在下面的评论中这样做！

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2008-09-11T15:34:03.983

接口应该很小。真的很小。如果你真的要分解你的对象，那么你的接口可能只包含一些非常具体的方法和属性。

抽象类是捷径。是否有所有 PetBase 衍生品共享的东西，您可以编写一次并完成？如果是，那么该是抽象类的时候了。

抽象类也有限制。虽然它们为您提供了生成子对象的捷径，但任何给定对象只能实现一个抽象类。很多时候，我发现这是抽象类的限制，这就是我使用大量接口的原因。

抽象类可能包含多个接口。您的 PetBase 抽象类可以实现 IPet（宠物有主人）和 IDigestion（宠物吃，或者至少它们应该吃）。然而，PetBase 可能不会实现 IMammal，因为并非所有的宠物都是哺乳动物，也不是所有的哺乳动物都是宠物。您可以添加一个扩展 PetBase 的 MammalPetBase 并添加 IMammal。FishBase 可以有 PetBase 并添加 Ifish。IFish 将使用 ISwim 和 IUnderwaterBreather 作为接口。

是的，我的例子对于这个简单的例子来说过于复杂了，但这是接口和抽象类如何协同工作的伟大之处的一部分。

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2008-11-18T20:25:45.743

Submain .NET 编码指南中很好地解释了基类优于接口的情况：

> **基类与接口** 接口类型是值的部分描述，可能被许多对象类型支持。尽可能使用基类而不是接口。从版本控制的角度来看，类比接口更灵活。使用一个类，您可以发布 1.0 版，然后在 2.0 版中向该类添加一个新方法。只要方法不是抽象的，任何现有的派生类都将继续保持不变。
> 
> 因为接口不支持实现继承，所以适用于类的模式不适用于接口。给接口增加方法相当于给基类增加抽象方法；任何实现该接口的类都会中断，因为该类没有实现新方法。接口适用于以下情况：
> 
> 1.  几个不相关的类想要支持该协议。
> 2.  这些类已经建立了基类（例如，有些是用户界面 (UI) 控件，有些是 XML Web services）。
> 3.  汇总不合适或不可行。在所有其他情况下，类继承是更好的模型。

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2008-09-11T15:24:14.180

一个重要的区别是您只能继承**一个**基类，但您可以实现**多个**接口。*因此，如果您绝对确定*不需要同时继承不同的基类，那么您只想使用基类。此外，如果您发现您的界面变得越来越大，那么您应该开始将其分解为几个定义独立功能的逻辑部分，因为没有规定您的类不能全部实现它们（或者您可以定义不同的接口，只是继承它们全部来对它们进行分组）。

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2008-12-11T22:14:03.690

当我第一次开始学习面向对象编程时，我犯了一个简单且可能很常见的错误，即使用继承来共享公共行为——即使这种行为对于对象的性质来说并不是必不可少的。

为了进一步建立在这个特定问题中经常使用的示例，有*很多*东西是可宠物的 - 女朋友，汽车，毛茸茸的毯子...... - 所以我可能有一个提供这种常见行为的 Petable 类，并且各种类继承从中。

然而，可触摸并不是任何这些物体的性质的一部分。还有更重要的概念对*他们*的本性至关重要——女朋友是人，汽车是陆地车辆，猫是哺乳动物……

行为应该首先分配给接口（包括类的默认接口），并且只有当它们（a）对于作为更大类的子集的一大类类来说是公共的时才被提升为基类——在同样的意义上“猫”和“人”是“哺乳动物”的子集。

问题是，在您比我一开始更充分地理解面向对象设计之后，您通常会自动执行此操作而无需考虑它。因此，“为接口编写代码，而不是抽象类”这句话的赤裸裸的真相变得如此明显，你很难相信有人会费心去说它——并开始尝试从中解读其他含义。

我要补充的另一件事是，如果一个类是*纯*抽象的——没有非抽象、非继承的成员或暴露给子、父或客户端的方法——那么为什么它是一个类？它可以被替换，在某些情况下由接口替换，在其他情况下由 Null 替换。

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2016-02-27T11:43:54.000

**比抽象类更喜欢接口**

基本原理，要考虑的要点[这里已经提到的两个]是：

*   接口更灵活，因为一个类可以实现多个接口。由于 Java 没有多重继承，因此使用抽象类可以防止您的用户使用任何其他类层次结构。**一般来说，当没有默认实现或状态时，更喜欢接口。**Java 集合提供了很好的例子（Map、Set 等）。
*   抽象类具有允许更好的前向兼容性的优点。一旦客户使用一个接口，你就不能改变它；如果他们使用抽象类，您仍然可以在不破坏现有代码的情况下添加行为。**如果兼容性是一个问题，请考虑使用抽象类。**
*   即使您确实有默认实现或内部状态，也要 **考虑提供接口和它的抽象实现**。这将为客户提供帮助，但如果需要[1]，仍然可以为他们提供更大的自由。
    当然，该主题已在其他地方进行了详细讨论 [2,3]。

[1] 当然，它会添加更多代码，但如果您最关心的是简洁，那么您可能应该首先避免使用 Java！

[2] Joshua Bloch，Effective Java，第 16-18 条。

[3] [http://www.codeproject.com/KB/ar](http://www.codeproject.com/KB/ar) ...

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2008-09-11T22:01:10.217

以前关于使用抽象类进行通用实现的评论肯定是正确的。我还没有看到提到的一个好处是，使用接口可以更容易地实现模拟对象以进行单元测试。正如 Jason Cohen 所描述的那样定义 IPet 和 PetBase 使您能够轻松地模拟不同的数据条件，而无需物理数据库的开销（直到您决定是时候测试真实的东西）。

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2008-09-12T21:24:45.693

不要使用基类，除非您知道它的含义，并且它适用于这种情况。如果适用，请使用它，否则，请使用接口。但请注意关于小接口的答案。

公共继承在 OOD 中被过度使用，并且比大多数开发人员意识到或愿意实现的要多得多。参见[Liskov 可替换性原则](http://en.wikipedia.org/wiki/Liskov_substitution_principle)

简而言之，如果 A“是”B，那么对于它公开的每个方法，A 需要的不超过 B，交付的也不少于 B。

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2008-09-15T22:34:03.723

从概念上讲，*接口*用于正式和半正式地定义对象将提供的一组方法。正式表示一组方法名称和签名，半正式表示与这些方法相关的人类可读文档。

接口只是对 API 的描述（毕竟[API](https://en.wikipedia.org/wiki/Application_programming_interface)代表应用程序编程**接口**），它们不能包含任何实现，也不可能使用或运行接口。它们只明确约定您应该如何与对象交互。

类提供了一个实现，它们可以声明它们实现了零个、一个或多个接口。如果要继承一个*类，则约定是在类名前加上“Base”。*

*基类*和*抽象基类*(ABC)之间存在区别。ABC 将接口和实现混合在一起。计算机编程之外的抽象意味着“摘要”，即“抽象==接口”。然后，*抽象基类*既可以描述接口，也可以描述旨在被继承的空的、部分的或完整的实现。

关于何时使用*接口*与*抽象基类*与仅使用*类*的意见将根据您正在开发的内容以及您正在开发的语言而大不相同。接口通常仅与静态类型的语言相关联，例如 Java 或 C#，但是动态类型语言也可以有*接口*和*抽象基类*。例如，在 Python 中，声明其**实现**接口的类和作为*类*的实例并被称为**提供**该*接口的对象**之间的区别很明显*****. *在动态语言中，作为同一个类*的实例的两个对象可以声明它们提供完全**不同的**接口。在 Python 中，这仅适用于对象属性，而方法是*类*的所有对象之间的共享状态。但是，在 Ruby 中，对象可以具有每个实例的方法，因此同一*类*的两个对象之间的*接口*可能会根据程序员的需要而变化（但是，Ruby 没有任何明确的方法来声明接口）。****

 *****在动态语言中，对象的接口通常是隐式假设的，要么通过内省对象并询问它提供了哪些方法（*在你跳跃之前查看*），或者最好通过简单地尝试在对象上使用所需的*接口*并在对象上捕获异常不提供该*界面*（*请求宽恕比许可更容易*）。这可能导致“误报”，其中两个*接口*具有相同的方法名称，但语义不同。但是，权衡是您的代码更加灵活，因为您无需预先过多指定即可预期代码的所有可能用途。

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2008-11-03T22:30:11.513

另一个要记住的选择是使用“has-a”关系，也就是“根据”或“组合”来实现。有时，这是一种比使用“is-a”继承更简洁、更灵活的结构方式。

说 Dog 和 Cat 都“拥有”一个 Pet 在逻辑上可能没有多大意义，但它避免了常见的多重继承陷阱：

```
public class Pet
{
    void Bathe();
    void Train(Trick t);
}

public class Dog
{
    private Pet pet;

    public void Bathe() { pet.Bathe(); }
    public void Train(Trick t) { pet.Train(t); }
}

public class Cat
{
    private Pet pet;

    public void Bathe() { pet.Bathe(); }
    public void Train(Trick t) { pet.Train(t); }
} 
```

是的，这个例子表明，以这种方式做事有很多代码重复和缺乏优雅。但人们也应该意识到，这有助于保持 Dog 和 Cat 与 Pet 类分离（因为 Dog 和 Cat 无法访问 Pet 的私有成员），并且它为 Dog 和 Cat 从其他东西继承留下了空间—— - 可能是哺乳动物类。

当不需要私有访问并且您不需要使用通用 Pet 引用/指针来引用 Dog 和 Cat 时，组合是更可取的。接口为您提供了通用的引用功能，可以帮助减少代码的冗长，但是当它们组织得不好时，它们也会使事情变得模糊。当您需要私有成员访问权限时，继承很有用，并且在使用它时，您承诺将您的 Dog 和 Cat 类与 Pet 类高度耦合，这是一个高昂的成本。

在继承、组合和接口之间，没有一种方法总是正确的，这有助于考虑如何协调使用所有三个选项。在这三者中，继承通常是最不应该使用的选项。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2008-09-11T15:29:09.860

这取决于您的要求。如果 IPet 足够简单，我更愿意实现它。否则，如果 PetBase 实现了您不想复制的大量功能，那么请使用它。

实现基类的缺点是需要`override`（或`new`）现有方法。这使它们成为虚拟方法，这意味着您必须小心如何使用对象实例。

最后，.NET 的单一继承杀死了我。一个天真的例子：假设你正在制作一个用户控件，所以你继承了`UserControl`. 但是，现在您也无法继承`PetBase`. 这迫使您重新组织，例如创建`PetBase`班级成员。

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2008-09-11T15:31:47.577

在我需要之前，我通常不会实施。我更喜欢接口而不是抽象类，因为这提供了更多的灵活性。如果在某些继承类中存在共同行为，我会将其向上移动并创建一个抽象基类。我不认为两者都需要，因为它们本质上服务于相同的目的，并且两者兼有是一种糟糕的代码味道（恕我直言），解决方案已经过度设计。

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2011-02-23T11:51:10.550

关于 C#，从某种意义上说，接口和抽象类是可以互换的。但是，区别在于：i) 接口不能实现代码；ii) 正因为如此，接口不能进一步向上调用堆栈到子类；iii) 一个类上只能继承抽象类，而一个类上可以实现多个接口。

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2014-09-23T13:54:21.387

按照定义，接口提供了与其他代码通信的层。类的所有公共属性和方法默认实现隐式接口。我们还可以将接口定义为角色，当任何类需要扮演该角色时，它必须实现它，根据实现它的类赋予它不同的实现形式。因此，当您谈论接口时，您正在谈论多态性，而当您谈论基类时，您正在谈论继承。哎呀的两个概念！

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2016-03-04T18:23:09.573

我发现 Interface > Abstract > Concrete 的模式适用于以下用例：

```
1\.  You have a general interface (eg IPet)
2\.  You have a implementation that is less general (eg Mammal)
3\.  You have many concrete members (eg Cat, Dog, Ape) 
```

抽象类定义了具体类的默认共享属性，但强制执行接口。例如：

```
public interface IPet{

    public boolean hasHair();

    public boolean walksUprights();

    public boolean hasNipples();
} 
```

现在，由于所有哺乳动物都有头发和乳头（AFAIK，我不是动物学家），我们可以把它放到抽象基类中

```
public abstract class Mammal() implements IPet{

     @override
     public walksUpright(){
         throw new NotSupportedException("Walks Upright not implemented");
     }

     @override
     public hasNipples(){return true}

     @override
     public hasHair(){return true} 
```

然后具体类仅定义它们直立行走。

```
public class Ape extends Mammal(){

    @override
    public walksUpright(return true)
}

public class Catextends Mammal(){

    @override
    public walksUpright(return false)
} 
```

当有很多具体的类时，这种设计很好，并且您不想仅仅为了对接口进行编程而维护样板。如果将新方法添加到接口中，则会破坏所有生成的类，因此您仍然可以获得接口方法的优势。

**在这种情况下，抽象也可以是具体的；然而，抽象的名称有助于强调这种模式正在被使用。**

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2008-09-11T18:23:33.390

基类的继承者应该具有“是”关系。接口代表一个“实现一个”关系。因此，仅当您的继承者将保持关系时才使用基类。

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2011-03-14T21:26:25.353

使用接口在不相关类的整个系列中强制执行合同。例如，您可能对表示集合的类有通用访问方法，但包含完全不同的数据，即一个类可能表示来自查询的结果集，而另一个可能表示图库中的图像。此外，您可以实现多个接口，从而允许您混合（并表示）类的功能。

当类具有共同关系并因此具有相似的结构和行为特征时，使用继承，即汽车、摩托车、卡车和 SUV 都是可能包含多个车轮、最高速度的所有类型的公路车辆

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2015-01-23T06:42:58.270

列出您的对象*必须*是、拥有或做的事情以及您的对象*可以*（或*可能*）成为、拥有或做的事情。*Must*指示您的基本类型，并且*can*指示您的接口。

例如，您的 PetBase*必须*呼吸，而您的 IPet*可能会*使用 DoTricks。

对问题域的分析将帮助您定义精确的层次结构。

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2016-01-05T10:02:07.820

> 什么时候应该使用接口，什么时候应该使用基类？

如果你应该使用接口

1.  你有纯`abstract`方法，没有非抽象方法
2.  您没有`non abstract`方法的默认实现（Java 8 语言除外，其中接口方法提供默认实现）
3.  如果您使用的是 Java 8，现在接口将为一些非抽象方法提供默认实现。`interface`与类相比，这将更有用`abstract`。

看看这个 SE [question](https://stackoverflow.com/questions/479142/when-to-use-an-interface-instead-of-an-abstract-class-and-vice-versa/33963465#33963465)了解更多细节。

> 如果我不想实际定义方法的基本实现，它是否应该始终是一个接口？

是的。它更好更干净。即使你有一个带有一些抽象方法的基类，我们也让基类`abstract`通过接口扩展方法。您将来可以在不更改基类的情况下更改接口。

java中的示例：

```
abstract class PetBase implements IPet {
// Add all abstract methods in IPet interface and keep base class clean. 
   Base class will contain only non abstract methods and static methods.
} 
```

> 如果我有狗和猫课。为什么我要实现 IPet 而不是 PetBase？我可以理解为 ISheds 或 IBarks （IMakesNoise？）提供接口，因为这些接口可以逐个放置在宠物上，但我不明白哪个用于通用宠物。

我更喜欢让基类实现接口。

```
 abstract class PetBase implements IPet {
 // Add all abstract methods in IPet
 }

 /*If ISheds,IBarks is common for Pets, your PetBase can implement ISheds,IBarks. 
  Respective implementations of PetBase can change the behaviour in their concrete classes*/

 abstract class PetBase implements IPet,ISheds,IBarks {
 // Add all abstract methods in respective interfaces
 } 
```

**好处：**

1.  如果我想在现有接口中添加一个抽象方法，我只需更改接口而不触及抽象基类。如果我想更改合同，我将更改接口和实现类而不触及基类。

2.  您可以通过接口为基类提供不变性。看看这篇[文章](http://www.andygibson.net/blog/programming/immutability-through-interfaces/)

有关更多详细信息，请参阅此相关 SE 问题：

[我应该如何解释接口和抽象类之间的区别？](https://stackoverflow.com/questions/18777989/how-should-i-have-explained-the-difference-between-an-interface-and-an-abstract/34978606#34978606)

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2008-09-11T15:33:52.173

除了那些提到 IPet/PetBase 实现的评论之外，在某些情况下，提供访问器助手类可能非常有价值。

IPet/PetBase 风格假定您有多个实现，因此增加了 PetBase 的价值，因为它简化了实现。但是，如果您有多个客户端的相反或两者的混合，则提供类帮助以帮助使用接口可以通过使接口更易于使用来降低成本。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2008-09-11T18:43:58.020

用你自己的判断力，聪明点。不要总是按照别人（比如我）所说的去做。你会听到“更喜欢接口而不是抽象类”，但这真的取决于。这取决于类是什么。

在上面提到的我们有对象层次结构的情况下，接口是一个好主意。接口有助于处理这些对象的集合，并且在实现使用层次结构的任何对象的服务时也有帮助。您只需定义使用层次结构中的对象的协定。

另一方面，当您实现一堆共享通用功能的服务时，您可以将通用功能分离到一个完整的单独类中，或者您可以将其移动到通用基类中并使其抽象，这样任何人都无法实例化基类班级。

还要考虑如何随着时间的推移支持您的抽象。接口是固定的：您将接口作为任何类型都可以实现的一组功能的合同发布。基类可以随着时间的推移而扩展。这些扩展成为每个派生类的一部分。

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2008-09-11T19:51:44.987

接口具有明显的优势，即类在某种程度上是“可热交换的”。将一个类从一个父类更改为另一个类通常会导致大量工作，但通常可以删除和更改接口，而不会对实现类产生太大影响。这在您“可能”希望类实现的几组狭窄行为的情况下特别有用。

这在我的领域特别有效：游戏编程。基类可能会因继承对象“可能”需要的大量行为而变得臃肿。使用接口可以很容易地向对象添加或删除不同的行为。例如，如果我为想要反射伤害的对象创建一个“IDamageEffects”接口，那么我可以轻松地将其应用于各种游戏对象，并在以后轻松改变主意。假设我设计了一个要用于“静态”装饰对象的初始类，并且我最初决定它们是不可破坏的。稍后，我可能会决定如果它们爆炸会更有趣，因此我更改了类以实现“IDamageEffects”接口。这比切换基类或创建新的对象层次结构要容易得多。

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2008-09-11T19:53:42.533

继承还有其他优点 - 例如变量能够保存父类或继承类的对象（无需将其声明为通用对象，如“对象”）。

例如，在 .NET WinForms 中，大多数 UI 组件都派生自 System.Windows.Forms.Control，因此声明为该变量的变量可以“容纳”几乎任何 UI 元素 - 无论是按钮、ListView 还是您拥有的任何东西。现在，当然，您将无法访问该项目的所有属性或方法，但您将拥有所有基本内容 - 这可能很有用。

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2008-09-12T21:32:04.740

如果除了您的类型的成员之外，其他开发人员确实没有任何理由希望使用他们自己的基类**并且**您预见到版本控制问题，那么您应该使用基类（请参阅[http://haacked.com/archive/2008/02 /21/versioning-issues-with-abstract-base-classes-and-interfaces.aspx](http://haacked.com/archive/2008/02/21/versioning-issues-with-abstract-base-classes-and-interfaces.aspx)）。

如果继承开发人员有任何理由使用他们自己的基类来实现您的类型的接口并且您没有看到接口发生变化，那么请使用接口。在这种情况下，为了方便起见，您仍然可以引入实现接口的默认基类。

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2014-08-29T23:40:23.700

感谢[Jon Limjap的](https://stackoverflow.com/users/372/jon-limjap)[回答](https://stackoverflow.com/a/56912/1817640)，但我想为接口和抽象基类的概念添加一些解释

**接口类型与抽象基类**

改编自[Pro C# 5.0 和 .NET 4.5 Framework](http://www.apress.com/9781430242338)书。

接口类型可能看起来非常类似于抽象基类。回想一下，当一个类被标记为抽象时，它可以定义任意数量的抽象成员来为所有派生类型提供多态接口。然而，即使一个类确实定义了一组抽象成员，它也可以自由定义任意数量的构造函数、字段数据、非抽象成员（带有实现）等等。另一方面，接口只包含抽象成员定义。由抽象父类建立的多态接口受到一个主要限制，即只有派生类型支持抽象父类定义的成员。但是，在较大的软件系统中，开发多个类层次结构非常常见，这些层次结构除了 System.Object 之外没有共同的父级。鉴于抽象基类中的抽象成员仅适用于派生类型，我们无法配置不同层次结构中的类型以支持相同的多态接口。例如，假设您定义了以下抽象类：

```
public abstract class CloneableType
{
// Only derived types can support this
// "polymorphic interface." Classes in other
// hierarchies have no access to this abstract
// member.
   public abstract object Clone();
} 
```

鉴于此定义，只有扩展 CloneableType 的成员才能支持 Clone() 方法。如果您创建一组不扩展此基类的新类，则无法获得此多态接口。此外，您可能还记得 C# 不支持类的多重继承。因此，如果您想创建一个既是 Car 又是 CloneableType 的 MiniVan，您无法这样做：

```
// Nope! Multiple inheritance is not possible in C#
// for classes.
public class MiniVan : Car, CloneableType
{
} 
```

正如您所猜测的那样，接口类型来拯救。定义接口后，它可以由任何类或结构、任何层次结构、任何命名空间或任何程序集（用任何 .NET 编程语言编写）实现。如您所见，接口是高度多态的。考虑在 System 命名空间中定义的名为 ICloneable 的标准 .NET 接口。该接口定义了一个名为 Clone() 的方法：

```
public interface ICloneable
{
object Clone();
} 
```

# vb.net - UI 线程安全

> ID：56886
> 
> 赞同：1
> 
> 时间：2008-09-11T15:29:00.797
> 
> 标签：vb.net, multithreading, winforms, .net-3.5, form-control

关于在更改表单控件的属性时确保线程安全的最佳方式的任何建议？我一直在使用我。过去调用，我想知道您是否有优点/缺点、评论、建议等。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-11T15:32:59.570

如果您从另一个线程推送表单中的内容，调用是正确的方法。

但是您可能会考虑表单本身是否会更好地提取数据，可能来自计时器，并且可能比后台进程推送单个更新的频率更低。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T15:31:13.630

我确实控制。调用目标控件而不是整个表单，但这只是我。我声称没有关于获胜形式的高级知识，我只是不时地使用它。

# sql - 证明 SQL 查询等效性

> ID：56895
> 
> 赞同：22
> 
> 时间：2008-09-11T15:32:14.550
> 
> 标签：sql, oracle

您将如何证明两个查询在功能上是等效的，例如，它们总是返回相同的结果集。

* * *

由于我在执行此操作时有一个特定的查询，因此我最终按照@dougman 的建议进行，超过大约 10% 的行涉及的表并比较结果，确保没有不合适的结果。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-18T15:16:50.300

您可以做的最好的事情是根据给定的一组输入比较 2 个查询输出，以寻找任何差异。要说它们总是为所有输入返回相同的结果，实际上取决于数据。

对于 Oracle 来说，如果不是最好的方法之一（非常有效），这里是更好的方法之一（`Ctrl`+`F`比较两个表的内容）：
[http://www.oracle.com/technetwork/issue-archive/2005/05-jan/o15asktom-084959.html](http://www.oracle.com/technetwork/issue-archive/2005/05-jan/o15asktom-084959.html)

归结为：

```
select c1,c2,c3, 
       count(src1) CNT1, 
       count(src2) CNT2
  from (select a.*, 
               1 src1, 
               to_number(null) src2 
          from a
        union all
        select b.*, 
               to_number(null) src1, 
               2 src2 
          from b
       )
group by c1,c2,c3
having count(src1) <> count(src2); 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2017-08-09T07:27:49.597

**1) Cosette 的真实等价证明：**
Cosette 检查（通过证明）2 个 SQL 查询是否等价，反例则不等价。这是绝对确定的唯一方法，几乎​​；）您甚至可以在他们的网站上输入 2 个查询并立即检查（正式）等价性。

链接到珂赛特： [https ://cosette.cs.washington.edu/](https://cosette.cs.washington.edu/)

链接到很好地解释了 Cosette 如何工作的文章：[https ://medium.com/@uwdb/introducing-cosette-527898504bd6](https://medium.com/@uwdb/introducing-cosette-527898504bd6)

**2）或者，如果您只是在寻找快速实用的解决方法：**
试试这个 stackoverflow 答案：[[ sql - 检查两个选择是否相等]](https://stackoverflow.com/questions/5727882/check-if-two-selects-are-equivalent)
这归结为：

```
(select * from query1 MINUS select * from query2) 
UNION ALL
(select * from query2 MINUS select * from query1) 
```

此查询为您提供仅由其中一个查询返回的所有行。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-11T15:40:22.300

在我看来，这听起来像是一个 NP 完全问题。我不确定是否有可靠的方法来证明这种事情

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-19T01:23:24.053

这很容易做到。

假设您的查询名为 a 和 b

**a减b**

应该给你一个空集。如果没有。然后查询返回不同的集合，结果集会显示不同的行。

然后做

**b减去a**

那应该给你一个空集。如果是这样，那么查询确实返回相同的集合。如果它不为空，则查询在某些方面是不同的，结果集会向您显示不同的行。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-11T18:42:58.350

DBMS 供应商已经为此工作了很长时间。正如 Rik 所说，这*可能是*一个棘手的问题，但我认为尚未对问题空间的 NP 完全性进行任何正式分析。

但是，最好的办法是尽可能多地利用 DBMS。所有 DBMS 系统都将 SQL 转换为某种查询计划。您可以使用这个查询计划，它是查询的抽象版本，作为一个很好的起点（DBMS 将进行大量优化，将查询扁平化为更可行的模型）。

*注意：现代 DBMS 使用“基于成本”的分析器，它在统计信息更新中是不确定的，因此查询计划器可能会随着时间的推移更改相同查询的查询计划。*

在 Oracle（取决于您的版本）中，您可以使用 SQL 提示告诉优化器从基于成本的分析器切换到基于确定性规则的分析器（这将简化计划分析），例如

```
SELECT /*+RULE*/ FROM yourtable 
```

基于规则的优化器自 8i 以来已被弃用，但即使在 10g 之前它仍然存在（我不知道 'bout 11）。然而，基于规则的分析器没有那么复杂：错误率可能要高得多。

为了进一步阅读更通用的性质，IBM 的查询优化专利相当多产。这里关于将 SQL 转换为“抽象计划”的方法是一个很好的起点： http: [//www.patentstorm.us/patents/7333981.html](http://www.patentstorm.us/patents/7333981.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-18T15:21:08.370

也许您可以使用[Venn Diagrams](http://en.wikipedia.org/wiki/Venn_diagram) （手动）绘制查询和结果，并查看它们是否生成相同的图表。维恩图非常适合表示数据集，而 SQL 查询适用于数据集。如果 2 个查询在功能上是等效的，绘制维恩图可能会帮助您可视化。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-01-23T04:18:08.650

这会成功的。如果此查询返回零行，则两个查询将返回相同的结果。作为奖励，它作为单个查询运行，因此您不必担心设置隔离级别，以便数据不会在两个查询之间更改。

```
select * from ((<query 1> MINUS <query 2>) UNION ALL (<query 2> MINUS <query 1>)) 
```

这是一个方便的 shell 脚本来执行此操作：

```
#!/bin/sh

CONNSTR=$1
echo query 1, no semicolon, eof to end:; Q1=`cat` 
echo query 2, no semicolon, eof to end:; Q2=`cat`

T="(($Q1 MINUS $Q2) UNION ALL ($Q2 MINUS $Q1));"

echo select 'count(*)' from $T | sqlplus -S -L $CONNSTR 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-04-20T12:15:01.587

小心！功能上的“等价”往往是基于数据的，你可以通过比较很多情况下的结果来“证明”2个查询的等价性，***但一旦数据以某种方式发生变化，仍然是错误的***。

例如：

```
SQL> create table test_tabA
(
col1 number
)

Table created.

SQL> create table test_tabB
(
col1 number
)

Table created.

SQL> -- insert 1 row

SQL> insert into test_tabA values (1)

1 row created.

SQL> commit

Commit complete.

SQL> -- Not exists query:

SQL> select * from test_tabA a
where not exists
(select 'x' from test_tabB b
where b.col1 = a.col1)

      COL1

----------

         1

1 row selected.

SQL> -- Not IN query:

SQL> select * from test_tabA a
where col1 not in
(select col1
from test_tabB b)

      COL1

----------

         1

1 row selected.

-- THEY MUST BE THE SAME!!! (or maybe not...)

SQL> -- insert a NULL to test_tabB

SQL> insert into test_tabB values (null)

1 row created.

SQL> commit

Commit complete.

SQL> -- Not exists query:

SQL> select * from test_tabA a
where not exists
(select 'x' from test_tabB b
where b.col1 = a.col1)

      COL1

----------

         1

1 row selected.

SQL> -- Not IN query:

SQL> select * from test_tabA a
where col1 not in
(select col1
from test_tabB b)

**no rows selected.** 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-16T18:16:40.230

你没有。

例如，如果您需要对性能变化没有改变查询输出的高度置信度，那么请对其进行测试。

如果您需要非常高的信心..然后errrm，请进行更多测试。

为 SQL 查询拼凑大量的测试并不难。编写一个过程，它将围绕一组大/完整的可能参数进行迭代，并使用每组参数调用每个查询，并将输出写入相应的表。比较两张表，你就知道了。

这不完全科学，我猜这是 OP 的问题，但我不知道证明等效性的正式方法。

# asp.net - ASP.Net AJAX JavaScript 序列化错误

> ID：56905
> 
> 赞同：1
> 
> 时间：2008-09-11T15:35:25.447
> 
> 标签：asp.net, javascript, asp.net-ajax

尝试序列化 ASP.Net AJAX 数组对象时遇到“堆栈空间不足”错误。

这是简化代码的场景：

1.  `Default.aspx`

2.  `MainScript.js`

    ```
    function getObject(){
        return new Array();
    }

    function function1(obj){
        var s=Sys.Serialization.JavaScriptSerializer.serialize(obj);
        alert(s);
    }

    function function2(){
        var obj=getObject();
        var s=Sys.Serialization.JavaScriptSerializer.serialize(obj);
        alert(s);
    } 
    ```

3.  `Content.aspx`

4.  `ContentScript.js`

    ```
    function serializeObject(){
        var obj=window.top.getObject();
        window.top.function1(obj); // <– This works fine

        obj=new Array();
        window.top.function1(obj); // <– this causes an Out of Stack Space error
    } 
    ```

示例页面和 JavaScript 的代码在[这里](http://braincells2pixels.wordpress.com/2008/02/14/aspnet-ajax-javascript-serialization-error/)。

在此处发布 aspx 页面的代码存在问题。因此，请检查上面的链接以查看 aspx 页面的代码。

带有 IFrame 的网页 (default.aspx) 承载内容页 (content.aspx)。

单击“Serialize Object”按钮调用 JavaScript 函数 serializeObject()。序列化适用于在顶部窗口（框架外）中创建的 Array 对象。但是，如果在 IFrame 中创建数组对象，则序列化会出现堆栈空间不足的错误。我逐步浏览了 ASP.Net AJAX JS 文件，我发现，该过程进入了一个无限循环，试图找出数组对象的类型。无休止地调用 Number.IsInstanceOf 很快你就会得到一个堆栈外错误。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-04-01T15:26:21.493

发生此问题是因为 Sys.Serialization.JavaScriptSerializer 无法序列化来自其他帧的对象，而只能序列化在当前窗口中实例化的那些对象（调用 serialize() 方法）。我知道的唯一解决方法是在调用 serialize() 方法之前从其他帧克隆对象。

您可以在此处找到 clone() 方法的示例（俄语评论）： [链接文本](http://snowcore.net/clone-javascript-object)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-11T16:05:17.257

我将您的示例转换为一组静态 html 文件，并下载了独立的[Microsoft Ajax Library 3.5](http://msdn.microsoft.com/en-us/asp.net/bb944808.aspx)进行测试。它在 Firefox 3 或 IE 7 上都没有问题，但我确实注意到第一个警告框显示 []（一个数组）和第二个 {}（一个对象）。

然后，我将您的新 Array() 代码转换为：

```
 var obj = [];
  obj.push(1); 
```

之后，我得到 [1] 和 {"0", 1} 是警报框。我认为该错误与 JavaScriptSerializer 无关，而是与跨帧传递对象有关。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T19:40:29.070

我现在无法测试您的代码，但对我来说它看起来像是 JavaScriptSerializer.serialize 中的一个错误。我的猜测是它试图通过 CLR 对数组进行某种类型检查，并且它不能正确处理空数组。

您是否尝试将可序列化类型的项添加到代码中的数组中？如果是这样，会发生什么？

# sql-server - 在 .NET 中打开存储在数据库中的文件

> ID：56906
> 
> 赞同：3
> 
> 时间：2008-09-11T15:35:31.127
> 
> 标签：sql-server, vb.net

我将 Word 文档存储在 SQL Server 2005 数据库中的 varbinary(max) 列中。有没有一种方法可以从 VB.NET Windows 窗体应用程序打开此文档，而无需先序列化到文件（即直接从我从数据库中读取的字节数组中）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-11T15:41:25.510

取决于阅读它的内容。如果是 Word，您可能必须序列化为文件，但如果它是可以接受 IO.Stream 的函数或库，那么您可以在字节数组周围包装一个新的 MemoryStream 并传递它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-11T15:37:02.650

并不真地。您需要将其视为电子邮件附件，通常将文件复制到临时文件夹中，并定期清理。

# c# - C#：在计算机中创建虚拟驱动器

> ID：56908
> 
> 赞同：36
> 
> 时间：2008-09-11T15:35:34.293
> 
> 标签：c#, .net, virtualization, storage, virtual-drive

有什么方法可以在“（我的）计算机”中创建一个虚拟驱动器并对其进行操作，就像 JungleDisk 那样？

它可能会执行以下操作：

```
override OnRead(object sender, Event e) {
    ShowFilesFromAmazon();
} 
```

是否有任何API：s？也许是写入 XML 文件或数据库，而不是真正的驱动器。

* * *

[Dokan 库](http://dokan-dev.net/en/)似乎是最符合我的问题的答案，尽管[System.IO.IsolatedStorage](http://msdn.microsoft.com/en-us/library/system.io.isolatedstorage.aspx)似乎是最标准化和最适合微软环境的。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2021-03-18T18:12:44.943

根据您希望构建的虚拟驱动器类型，这里有一些最近在 Windows、macOS 和 iOS 中引入的新 OS API。

下面的一些 API 可作为 Windows 上的托管 .NET 代码使用，但许多是本机 Windows / macOS / iOS API。尽管如此，我还是能够在 .NET 和 Xamarin 应用程序中使用以下许多 API，并在 C# 中为 Windows、macOS 和 iOS 构建整个虚拟驱动器。

## 用于远程云存储

**在 Windows 上。**Windows 10 提供[云同步引擎 API](https://docs.microsoft.com/en-us/windows/win32/cfapi/build-a-cloud-file-sync-engine)，用于创建从远程位置发布数据的虚拟驱动器。它也被称为“Cloud Filter API”或“Windows Cloud Provider”。以下是它的主要特点：

*   按需文件夹列表。仅当客户端应用程序第一次向文件系统请求时，才会列出文件夹。不会下载文件内容，但所有文件属性（包括文件大小）都可以通过常规文件 API 在客户端上使用。
*   按需文件内容加载。文件内容可以以多种模式下载（渐进式、流式传输模式、允许后台下载等），并在应用程序发出第一个文件内容读取请求时可供操作系统使用。
*   离线文件支持。文件可以在离线模式下编辑、固定/取消固定以及与服务器同步。
*   Windows 外壳集成。Windows 文件管理器显示文件状态（已修改、同步、冲突）和文件下载进度。
*   元数据和属性支持。自定义列可以显示在 Windows 文件管理器中，并且一些二进制元数据可以与每个文件和文件夹相关联。

**在 macOS 和 iOS 上。**MacOS Big Sur 和 iOS 11+ 提供了类似的 API，称为[File Provider API](https://developer.apple.com/documentation/fileprovider)。它的功能类似于 Windows API 提供的功能：

*   按需文件夹列表。
*   按需文件内容加载。
*   离线文件支持。
*   文件管理器集成。在 macOS Finder 和 iOS 文件应用程序中，您可以显示文件状态（在云端、本地）。

我目前不确定文件/文件夹是否可以在 macOS Finder 中显示自定义列并存储任何元数据。

## 用于高速本地存储

**在 Windows 上。**Windows 提供[ProjFS API](https://docs.microsoft.com/en-us/windows/win32/projfs/projected-file-system)。它与 Cloud Sync Engine API 和 macOS/iOS File Provider API 的主要区别在于它隐藏了它是远程存储的事实。它不提供文件状态、下载进度等的任何指示。文档说它旨在以文件系统的形式“投影”分层数据。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-11T16:48:47.453

您可以使用[Dokan 库](https://dokan-dev.github.io/)来创建虚拟驱动器。有一个用于与 C# 交互的 .Net 包装器。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-11T15:37:36.970

是的，使用[System.IO.IsolatedStorage中的类](http://msdn.microsoft.com/en-us/library/system.io.isolatedstorage.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-06T14:46:01.603

我的电脑的内容可以包括外壳命名空间扩展。这些 COM 对象在 Explorer 主进程中运行，许多其他 shell 扩展也是如此。将 C# 用于此类扩展是一个坏主意，因为您的扩展无法控制 Explorer.exe 可以使用的 CLR 版本。微软每个进程只允许一个 CLR。

# windows - 在 Windows XP 上批量重命名具有国际字符的文件

> ID：56913
> 
> 赞同：1
> 
> 时间：2008-09-11T15:36:40.450
> 
> 标签：windows, file, batch-file, utf-8, rename

我有一大堆文件，文件名使用我们可爱的瑞典字母**å å**和**ö**。由于各种原因，我现在需要将这些转换为 [a-zA-Z] 范围。只需删除此范围之外的任何内容都相当容易。给我带来麻烦的是我想用**a替换****å**用**o**替换**ö**等等。

 ******这是最糟糕的字符集问题。

我有一组测试文件：

```
files\Copy of New Text Documen åäö t.txt
files\fofo.txt
files\New Text Document.txt
files\worstcase åäöÅÄÖéÉ.txt 
```

我将我的脚本基于这一行，将其结果传递到各种命令中

```
for %%X in (files\*.txt) do (echo %%X) 
```

奇怪的是，如果我将这个结果（即普通的 for 循环）打印到一个文件中，我会得到这个输出：

```
files\Copy of New Text Documen †„” t.txt
files\fofo.txt
files\New Text Document.txt
files\worstcase †„”Ž™‚.txt 
```

因此，我的文件名甚至在到达其他工具之前就发生了一些奇怪的事情（我一直在尝试使用来自称为 GnuWin32 的 Windows 的 sed 端口来做到这一点，但到目前为止没有运气）并且对这些字符进行替换不会帮助。

你将如何解决这个问题？我对任何类型的工具、命令行或其他工具都持开放态度……</p>

**编辑：**这是一个一次性的问题，所以我正在寻找一个快速的'n丑陋的修复

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-11T16:33:33.293

如果您在 UNICODE 模式下打开 cmd.exe，您可能会更幸运。使用“cmd /U”。

其他人建议使用真正的编程语言。这很好，特别是如果你有一种你非常熟悉的语言。我在 C# 团队的朋友说 C# 3.0（带有 Linq）非常适合快速编写这样的小程序。他大部分时间都停止编写批处理文件。

就个人而言，我会选择 PowerShell。这个问题可以直接在命令行上解决，并且在一行中。患病的

编辑：这不是一行，但也不是很多代码。此外，看起来 StackOverflow 不喜欢语法“$_.Name”，并将 _ 呈现为 _。

```
$mapping = @{ 
    "å" = "a"
    "ä" = "a"
    "ö" = "o"
}

Get-ChildItem -Recurse . *.txt | Foreach-Object { 
    $newname = $_.Name      
    foreach  ($l in $mapping.Keys) {
        $newname = $newname.Replace( $l, $mapping[$l] )
        $newname = $newname.Replace( $l.ToUpper(), $mapping[$l].ToUpper() )
    }
    Rename-Item -WhatIf $_.FullName $newname    # remove the -WhatIf when you're ready to do it for real.
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T19:07:28.650

您可以使用此代码（Python）

# 重命名国际文件

```
# -*- coding: cp1252 -*-

import os, shutil

base_dir = "g:\\awk\\"    # Base Directory (includes subdirectories)
char_table_1 = "áéíóúñ"
char_table_2 = "aeioun"

adirs = os.walk (base_dir)

for adir in adirs:
    dir = adir[0] + "\\"          # Directory
    # print "\nDir : " + dir

    for file in adir[2]:    # List of files
        if os.access(dir + file, os.R_OK):
            file2 = file
            for i in range (0, len(char_table_1)):
                file2 = file2.replace (char_table_1[i], char_table_2[i])

            if file2 <> file:
                # Different, rename
                print dir + file, " => ", file2
                shutil.move (dir + file, dir + file2)

### 
```

你必须改变你的编码和你的字符表（我用西班牙语文件测试了这个脚本并且工作正常）。您可以评论“移动”行以检查它是否工作正常，稍后删除评论以进行重命名。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T15:39:01.693

我会在 C++、C# 或 Java 中编写此代码——我确信可以在这些环境中正确地从路径中获取 Unicode 字符。命令行工具总是不确定的，尤其是在 Cygwin 之外。

然后代码是一个简单的查找/替换或正则表达式/替换。如果您可以命名一种语言，那么编写代码将很容易。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-11T15:42:16.303

我会编写一个 vbscript (WSH) 来扫描目录，然后将文件名发送到一个函数，该函数将文件名分解为单独的字母，然后在瑞典语的字母上执行 SELECT CASE 并用你想要的替换它们。或者，该函数可以不这样做，而是通过一堆 REPLACE() 函数将其删除，将输出重新分配给输入字符串。最后，它使用新值重命名文件。

# sql - 如何为 SQL Server 登录编写密码更改脚本？

> ID：56923
> 
> 赞同：25
> 
> 时间：2008-09-11T15:38:26.330
> 
> 标签：sql, sql-server, sql-server-2005

正如标题所说，我需要更改现有 sql server 登录的密码，我想通过 sql 脚本来完成。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2012-06-07T03:58:08.363

如果用户已经拥有 ALTER ANY LOGIN 权限（即，用户可以更改任何用户的任何密码），则此方法有效：

```
alter login mylogin with password = 'mylogin' 
```

否则，如果您不想让系统中的每个用户都成为超级用户，请为同一命令添加旧密码参数：

```
alter login mylogin with password = 'mylogin' old_password='oldpassword' 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-11T15:39:21.897

更改登录

[http://msdn.microsoft.com/en-us/library/ms189828.aspx](http://msdn.microsoft.com/en-us/library/ms189828.aspx)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2011-05-30T05:07:55.790

```
alter login mylogin with password = 'mylogin' 
```

# .net - Crystal Reports 2008 InprocServer + TempDir =“操作尚未实施”

> ID：56926
> 
> 赞同：0
> 
> 时间：2008-09-11T15:39:21.163
> 
> 标签：.net, crystal-reports, report, tempdir

我有一个使用 CR 2008 进行报告的 .NET Web 应用程序。部署它的服务器装有 McAfee，我们想告诉 CR 使用 Windows 临时目录以外的临时目录。

Google 为我找到了以下注册表项：

SOFTWARE\Business Objects\Suite 12.0\Report Application Server\InprocServer\TempDir。

添加此键确实会导致 CR 在我指定的目录中创建一堆临时文件。但是，在报告运行结束时，我收到“操作尚未实施”异常。

我正在尝试通过 ExportToHttpRequest() 将 PDF 返回到浏览器，如果我不更改进程内服务器的 tempdir，它就可以正常工作。

有没有人遇到过这个？我已经赋予本地 ASPNET 帐户对新 tempdir 的完全控制权。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-11-05T07:34:54.017

C:/windows/temp 以外的其他临时目录应该位于您网站的虚拟目录中。只需在您的网站目录中添加该临时文件夹，当您创建它的虚拟路径以在 IIS 上托管它时，它会自动包含在内。如果你想在 D:/CrystalTEmp 等其他地方创建它，你需要在你的 Inetmgr 中添加这个文件夹，只需右键单击这个目录并启用它的网络共享。是的，您需要为此临时文件夹授予网络服务完全权限。

如果您将您的网站目录放在 inetpub/wwwroot 中，那么您不需要授予网络服务权限。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-12T09:32:48.977

我使用 CR 的时间比我想要的要长，但从来没有必要指定不同的临时文件夹。你有什么具体原因吗？我不知道 IIS 进程是否可以“简单地”访问它。

硬盘中的“其他”临时目录或更好的“它在哪里”是什么？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-08T12:38:25.620

我们在 IIS5 下也尝试过，但也无济于事。尝试设置 TempDir 注册表项后遇到了同样的问题。尽管所有其他报告导出（显然）都有效，但 PDF 导出开始失败。

但是，在运行 IIS6 的客户端站点上，这种将临时文件重定向到专用目录的方法可以正常工作。默认情况下，在他们的网站上，Crystal Reports 使用目录

C:\Program Files\Business Objects\BusinessObjects Enterprise 11.5\Data

作为其临时存储位置，并为 ASP.NET 帐户提供足够的权限来在那里创建和删除文件。因此，也许有一些硬连线逻辑要求在 CR 安装目录层次结构中创建文件。换句话说，在 IIS6 下安装 CR 后，这一切都按预期工作。

对于第 12 版，显然目录会略有不同。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2015-03-17T10:37:47.413

“尚未实施的操作”将“字体”类型从 - 右键单击​​文本区域。- 格式设置。- 更改字体

# java - Java ME 中的“是/否”对话框

> ID：56943
> 
> 赞同：5
> 
> 时间：2008-09-11T15:43:04.307
> 
> 标签：java, user-interface, java-me, midlet

我正在寻找一个简单的解决方案，用于在 Java ME midlet 中使用是/否对话框。我想像这样使用它，但其他方式也可以。

```
if (YesNoDialog.ask("Are you sure?") == true) {
  // yes was chosen
} else {
  // no was chosen
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-15T13:51:59.657

你需要一个[警报](http://java.sun.com/javame/reference/apis/jsr118/javax/microedition/lcdui/Alert.html)：

> 警报是向用户显示数据并在继续下一个 Displayable 之前等待一段时间的屏幕。警报可以包含文本字符串和图像。警报的预期用途是通知用户错误和其他异常情况。

使用 2 个[命令](http://java.sun.com/javame/reference/apis/jsr118/javax/microedition/lcdui/Command.html)（在您的情况下为“是”/“否”）：

> 如果 Alert 上有两个或多个 Commands，它会自动变为模态 Alert，并且超时值始终为 FOREVER。在调用命令之前，警报会一直显示在显示屏上。

这些是 MIDP 1.0 和更高版本支持的内置类。此外，您的代码片段将永远无法工作。这样的 API 需要阻塞等待用户选择和回答的调用线程。这与基于回调和委托的 MIDP 的 UI 交互模型完全相反。您需要提供自己的类，实现[CommandListener](http://java.sun.com/javame/reference/apis/jsr118/javax/microedition/lcdui/CommandListener.html)并为异步执行准备代码。

这是一个（未经测试！）基于警报的示例类：

```
public class MyPrompter implements CommandListener {

    private Alert yesNoAlert;

    private Command softKey1;
    private Command softKey2;

    private boolean status;

    public MyPrompter() {
        yesNoAlert = new Alert("Attention");
        yesNoAlert.setString("Are you sure?");
        softKey1 = new Command("No", Command.BACK, 1);
        softKey2 = new Command("Yes", Command.OK, 1);
        yesNoAlert.addCommand(softKey1);
        yesNoAlert.addCommand(softKey2);
        yesNoAlert.setCommandListener(this);
        status = false;
    }

    public Displayable getDisplayable() {
        return yesNoAlert;
    }

    public boolean getStatus() {
        return status;
    }

    public void commandAction(Command c, Displayable d) {
        status = c.getCommandType() == Command.OK;
        // maybe do other stuff here. remember this is asynchronous
    }

}; 
```

要使用它（再次，未经测试并且在我的头顶上）：

```
MyPrompter prompt = new MyPrompter();
Display.getDisplay(YOUR_MIDLET_INSTANCE).setCurrent(prompt.getDisplayable()); 
```

此代码将使提示成为您应用程序中当前显示的表单，但*不会*像您发布的示例中那样阻塞您的线程。您需要继续运行并等待 commandAction 调用。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2008-09-11T15:56:19.733

我没有在 Java ME 中编程，但我在它的可选包参考中找到了 [Advanced Graphics and User Interface API](http://java.sun.com/javame/reference/apis/jsr209/)，它像 Java SE API 一样使用[JOptionPane 类创建这些对话框](http://java.sun.com/javame/reference/apis/jsr209/javax/swing/JOptionPane.html)

> `int JOptionPane.showConfirmDialog(java.awt.Component parentComponent, java.lang.Object >message, java.lang.String title, int optionType)`

返回可能是 `JOptionPane.YES_OPTION`, `JOptionPane.NO_OPTION`, `JOptionPane.CANCEL_OPTION`...

# asp.net - 在 ASP.NET 站点中使用 OpenID 和 DotNetOpenID 对管理员进行身份验证的安全方法

> ID：56944
> 
> 赞同：3
> 
> 时间：2008-09-11T15:43:07.970
> 
> 标签：asp.net, openid, dotnetopenauth

在 SO 的鼓励下，我正在尝试编写一个使用 OpenID 进行用户身份验证的 ASP.NET 站点。这是一个常规的 WinForms 站点（不是 MVC.NET），使用[DotNetOpenId](http://code.google.com/p/dotnetopenid/)库进行身份验证。

通过简单地将当前会话的“ClaimedID”（在 OpenIdLogin_LoggedIn 事件中返回，作为成员 DotNetOpenId.RelyingParty,OpenIdEventArgs.Response.ClaimedIdentifier）与已知管理员的 OpenID（即矿）？

如果是这样，这个 ID 是可见的（例如在开源代码中）是否安全，还是应该“隐藏”在配置文件或数据库行中？（我知道让它可配置的设计更好，我的问题只是关于安全性。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-11T16:38:42.987

我的解决方案是遵循 Roles 表的相同想法。对用户进行身份验证后，查找该用户的角色。如果用户在 UserRoles 表中具有“管理员”角色，那么他们可以执行管理员可以执行的任何操作。

我不在我的应用程序中广播开放 ID。它们存储在表中。在每个操作结果上，我都会点击用户表，因为我还修改了我的表以存储各种用户状态信息。除了主页，我需要从该表中获取一些用户信息。我正在使用 LINQ，因此我包含 .LoadWith() 以在用户序列化时将其角色列表加载到用户中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-17T04:43:37.227

Jarrett 对使用数据库表做了一些很好的评论。

只是为了回答您的另一个问题，不，通常将您的 OpenID 放入您的代码中并不是保密的事情。如果为您的站点设置角色似乎有点过分，那么对您的 ClaimedIdentifier 进行简单的相等性检查就完美了。

# xml - 在 xml 字符串中突出显示父母

> ID：56946
> 
> 赞同：0
> 
> 时间：2008-09-11T15:45:11.553
> 
> 标签：xml, algorithm, text

说我有：

```
<ul>
    <li id="x">
        <a href="x">x</a>
    </li>

    <li id="y">
        <a href="y">y</a>

        <ul>
            <li id="z">
                <a href="z">z</a>
            </li>
        </ul>
    </li>
</ul> 
```

我想为作为 z 的父项的所有列表项添加一个类值。所以，我想修改 y 而不是 x。

显然，我可以将其解析为某种关联数组，然后向后递归。有什么想法可以通过文本处理（字符串替换、正则表达式等）来完成吗？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-11T15:52:23.363

我会使用 XSLT。您可以指定搜索作为 z 祖先的节点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-11T16:45:59.613

xpath 有一个祖先轴，其中包括当前上下文节点的所有祖先。

//*[@id="z"]/ancestor::li

*****任何元素
**[@id="z"]**的属性*id*的值为*z*（因为属性是 id，所以只能（/应该）是一个这样的元素）
**/ancestor::li**所有*li*元素都是祖先其中

另见：[https ://www.w3schools.com/xml/xpath_axes.asp](https://www.w3schools.com/xml/xpath_axes.asp)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-12T04:59:59.803

整个 XSLT 的示例：

```
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">

  <xsl:variable name="ancestors" select="descendant::li[@id = 'z']/ancestor::li"/>

  <xsl:template match="li">
    <xsl:copy>
      <!-- test if current li is in the $ancestors node-list -->
      <xsl:if test="count($ancestors | .) = count($ancestors)">
        <xsl:attribute name="class">ancestor</xsl:attribute>
      </xsl:if>
      <xsl:apply-templates select="node() | @*"/>
    </xsl:copy>
  </xsl:template>

  <xsl:template match="node() | @*">
    <xsl:copy>
      <xsl:apply-templates select="node() | @*"/>
    </xsl:copy>
  </xsl:template>

</xsl:stylesheet> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-12T16:49:19.740

除了 John Sheehan 的 anwser：
我宁愿使用 JQuery 而
`$('#z').parents('li').addClass('myClass');`
不是依赖实际结构。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-12T05:34:04.197

如果您可以使用 jQuery，这非常适合 jQuery。

```
$("#z").parent().parent().addClass("foo"); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-11T15:51:22.740

我建议您将其解析为 DOM 并像您想的那样向后递归。正则表达式不适用于具有任意嵌套级别的嵌套结构。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-11T17:17:55.293

只会将该属性添加到具有“z”后代元素的元素。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-11T17:58:15.510

感谢您的输入。我认为不解析（或使用 xsl 等）是不可能的......哦，好吧。

# floating-point - 浮点数是如何存储的？什么时候重要？

> ID：56947
> 
> 赞同：38
> 
> 时间：2008-09-11T15:45:13.583
> 
> 标签：floating-point, rounding-error

在跟进[这个问题](https://stackoverflow.com/questions/56820/round-in-python-doesnt-seem-to-be-rounding-properly)时，似乎有些数字根本不能用浮点表示，而是近似的。

浮点数是如何存储的？

不同尺寸是否有共同标准？

如果我使用浮点数，我需要注意哪些问题？

它们是否跨语言兼容（即，我需要处理哪些转换才能通过 TCP/IP 将浮点数从 python 程序发送到 C 程序）？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-11T16:20:27.553

如前所述，[关于 IEEE 754 的 Wikipedia 文章](http://en.wikipedia.org/wiki/IEEE_754-1985)很好地展示了浮点数在大多数系统上的存储方式。

现在，这里有一些常见的陷阱：

*   最大的问题是您几乎不想比较两个浮点数是否相等（或不相等）。您将希望使用大于/小于比较。
*   对浮点数执行的操作越多，舍入误差就越大。
*   精度受分数大小的限制，因此您可能无法正确添加相隔几个数量级的数字。（例如，您将无法将 1E-30 添加到 1E30。）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-11T15:52:38.680

标准是[IEEE 754](http://en.wikipedia.org/wiki/IEEE_754)。

当然，当 IEE754 不够好时，还有其他存储数字的方法。Java 之类的库`BigDecimal`可用于大多数平台，并且可以很好地映射到 SQL 的数字类型。符号可用于无理数，不能以二进制或十进制浮点数准确表示的比率可以存储为比率。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-11T16:01:55.837

至于您问题的第二部分，除非性能和效率对您的项目很重要，否则我建议您通过 TCP/IP 将浮点数据作为字符串传输。这可以让您避免字节对齐等问题，并简化调试。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-11T16:00:04.810

基本上，在浮点数中您需要担心的是精度位数有限。这可能会在测试相等性时导致问题，或者如果您的程序实际上需要比该数据类型提供的更多位数的精度。

在 C++ 中，一个好的经验法则是认为浮点数给您 7 位精度，而双精度数给您 15 位。此外，如果您有兴趣了解如何测试相等性，可以查看[这个](https://stackoverflow.com/questions/21265/comparing-ieee-floats-and-doubles-for-equality)问题线程。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-12-07T21:42:58.877

> 在跟进这个问题时，似乎有些数字根本不能用浮点数表示，而是近似的。

正确的。

> 浮点数是如何存储的？不同尺寸是否有共同标准？

正如其他海报已经提到的那样，几乎完全是 IEEE754 及其继任者 IEEE754R。谷歌搜索它会给你上千种解释以及位模式及其解释。如果您仍然无法获得它，那么仍然有两种常见的 FP 格式：IBM 和 DEC-VAX。对于一些深奥的机器和编译器（BlitzBasic、TurboPascal），有一些奇怪的格式。

> 如果我使用浮点数，我需要注意哪些问题？它们是否跨语言兼容（即，我需要处理哪些转换才能通过 TCP/IP 将浮点数从 python 程序发送到 C 程序）？

几乎没有，它们是跨语言兼容的。

非常罕见的怪癖：

*   IEEE754 定义了 sNaNs（信令 NaNs）和 qNaNs（安静 NaNs）。前者会导致一个陷阱，如果加载，它会强制处理器调用处理程序例程。后者不这样做。因为语言设计者讨厌 sNaN 中断他们的工作流程并支持它们强制支持处理程序例程的可能性，所以 sNaN 几乎总是默默地转换为 qNaN。所以不要依赖 1:1 的原始转换。但同样：这是非常罕见的，只有在存在 NaN 时才会发生。

*   如果在不同计算机之间共享文件，您可能会遇到字节顺序问题（字节顺序错误）。它很容易检测到，因为您得到的是数字的 NaN。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-11T15:52:58.697

这篇[题为](http://steve.hollasch.net/cgindex/coding/ieeefloat.html)“IEEE 标准 754 浮点数”的文章可能会有所帮助。老实说，我不完全确定我是否理解您的问题，所以我不确定这是否会有所帮助，但我希望它会有所帮助。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-11T15:56:08.127

是的，有[二进制浮点算术的 IEEE 标准（IEEE 754）](http://en.wikipedia.org/wiki/IEEE_754-1985)

当以二进制形式存储时，该数字分为三部分，符号、指数和分数。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-11T16:10:42.337

如果您真的担心浮点舍入错误，大多数语言都提供没有浮点错误的数据类型。SQL Server 具有 Decimal 和 Money 数据类型。.Net 具有 Decimal 数据类型。它们不像 Java 中的 BigDecimal 那样具有无限精度，但它们精确到定义的小数点数。因此，您不必担心输入为 $4.58 的美元值会被保存为浮点值 4.579999999999997

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-11T15:49:30.170

我记得是一个 32 位浮点数使用 24 位存储实际数字，其余 8 位用作 10 的幂，确定小数点在哪里。

我对这个问题有点生疏......

# .net - .NET 的竞争条件分析器

> ID：56949
> 
> 赞同：3
> 
> 时间：2008-09-11T15:46:53.017
> 
> 标签：.net, static-analysis, race-condition

我已经看到有一些针对 C++、C 和 Java 的竞争条件分析工具。任何人都知道任何对.NET 执行相同操作的静态分析工具吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-11T15:55:09.860

我从来没有使用过这个工具，但看起来 TypeMock 有一个名为 Racer 的工具可以处理这个问题。Roy Osherove 在[这里](http://weblogs.asp.net/rosherove/archive/2008/09/04/finding-deadlocks-with-readerwriterlock-and-typemock-racer.aspx)写了一篇博客。另一个有更好预览的帖子在[这里](http://weblogs.asp.net/rosherove/archive/2008/07/08/a-sneak-preview-of-typemock-racer.aspx)。

# sql-server - SQL Server 中的数值数据右对齐

> ID：56950
> 
> 赞同：17
> 
> 时间：2008-09-11T15:47:03.860
> 
> 标签：sql-server, tsql

我们都知道 T-SQL 的字符串操作功能有时还有很多不足之处......

我有一个数字字段需要在 T-SQL 中作为右对齐文本列输出。例子：

```
Value
----------
   143.55
  3532.13
     1.75 
```

你会怎么做呢？一个好的解决方案应该清晰而紧凑，但请记住“太聪明”这样的事情。

我同意这是错误的地方，但有时我们会被我们无法控制的力量所困。

谢谢你。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-11T15:57:41.853

[STR 函数](http://msdn.microsoft.com/en-us/library/ms189527.aspx)有一个可选的长度参数以及一个小数位数。

```
SELECT STR(123.45, 6, 1)

------
 123.5

(1 row(s) affected) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T15:58:42.647

如果您必须在 SQL 中执行此操作，您可以使用以下代码（此代码假定您没有大于 40 个字符的数字）：

```
SELECT REPLICATE(' ', 40 - LEN(CAST(numColumn as varchar(40)))) + 
CAST(numColumn AS varchar(40)) FROM YourTable 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T15:59:22.300

最简单的方法是向左填充：

```
CREATE FUNCTION PadLeft(@PadString nvarchar(100), @PadLength int)
RETURNS nvarchar(200)
AS
begin
return  replicate(' ',@padlength-len(@PadString)) + @PadString
end
go
print dbo.PadLeft('123.456', 20)
print dbo.PadLeft('1.23', 20) 
```

# applescript - 是否可以以编程方式将文件推送到无线 SD 卡？

> ID：56951
> 
> 赞同：2
> 
> 时间：2008-09-11T15:47:40.283
> 
> 标签：applescript, wireless, wifi

是否可以以编程方式将文件推送到无线 SD 卡 - 如 www.eye.fi 卡？

我使用 Mac，并认为我可以使用一些 AppleScript 来做到这一点 - 但还没有找到方法......

德里克

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-11T20:35:50.060

eye-fi 卡依赖于图像文件在传输之前被写入卡中的特定目录。除此之外，它的工作原理与存储卡完全一样。

向其写入文件，就好像您正在编写普通存储卡一样，只要它是大小合理的 jpg 图像文件，并且在适当的目录中（可能在 \DCIM\ 下），它们就应该传输。

如果您遇到问题，请仔细检查它是否适用于您的相机，并找出您的相机将图像放在卡上的位置，然后复制它。您甚至可以尝试将它们命名为与相机生成的图像类型相似的名称。

-亚当

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T20:31:36.453

看起来您可以将其视为外部硬盘驱动器（插入存储卡并找出安装点的位置）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T20:39:27.290

我认为他想在另一个设备中向它发送文件，而不是将其插入并使用它像直接连接到机器的天线一样传输文件。

# java - EasyMock：如何在没有警告的情况下创建泛型类的模拟？

> ID：56954
> 
> 赞同：43
> 
> 时间：2008-09-11T15:49:09.797
> 
> 标签：java, generics, mocking, easymock

编码

```
private SomeClass<Integer> someClass;
someClass = EasyMock.createMock(SomeClass.class); 
```

给我一个警告“类型安全：SomeClass 类型的表达式需要未经检查的转换才能符合 SomeClass<Integer>”。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-12-28T12:10:13.913

AFAIK，当涉及到类名文字时，您无法避免未经检查的警告，而`SuppressWarnings`注释是处理此问题的唯一方法。

请注意，尽可能缩小`SuppressWarnings`注释的范围是一种很好的形式。您可以将此注释应用于单个局部变量赋值：

```
public void testSomething() {

    @SuppressWarnings("unchecked")
    Foo<Integer> foo = EasyMock.createMock(Foo.class);

    // Rest of test method may still expose other warnings
} 
```

或使用辅助方法：

```
@SuppressWarnings("unchecked")
private static <T> Foo<T> createFooMock() {
    return (Foo<T>)EasyMock.createMock(Foo.class);
}

public void testSomething() {
    Foo<String> foo = createFooMock();

    // Rest of test method may still expose other warnings
} 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2012-01-17T15:22:42.237

我通过引入一个子类来解决这个问题，例如

```
private abstract class MySpecialString implements MySpecial<String>{}; 
```

然后创建该抽象类的模拟：

```
MySpecial<String> myMock = createControl().createMock(MySpecialString.class); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-11T16:06:20.583

两条明显的路线是抑制警告或模拟子类。

```
private static class SomeClass_Integer extends SomeClass<Integer>();
private SomeClass<Integer> someClass;
...
    someClass = EasyMock.createMock(SomeClass_Integer.class); 
```

（免责声明：我什至没有尝试编译此代码，也没有使用 EasyMock。）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-11T18:12:50.187

您可以使用 注释测试方法`@SuppressWarnings("unchecked")`。我同意这有点像 hack，但我认为它在测试代码上是可以接受的。

```
@Test
@SuppressWarnings("unchecked")
public void someTest() {
    SomeClass<Integer> someClass = EasyMock.createMock(SomeClass.class);
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-12-06T15:21:53.077

我知道这违背了这个问题，但为什么不创建一个列表而不是一个模拟列表呢？

它的代码更少且更易于使用，例如，如果您想将项目添加到列表中。

```
MyItem myItem = createMock(myItem.class);
List<MyItem> myItemList = new ArrayList<MyItem>();
myItemList.add(myItem); 
```

代替

```
MyItem myItem = createMock(myItem.class);
@SuppressWarnings("unchecked")
List<MyItem> myItemList = createMock(ArrayList.class);
expect(myItemList.get(0)).andReturn(myItem);
replay(myItemList); 
```

# flash - 在类中滚动 UIScrollBar 组件时出现问题

> ID：56968
> 
> 赞同：0
> 
> 时间：2008-09-11T15:55:26.617
> 
> 标签：flash, actionscript-3, actionscript

我正在尝试将 UIScrollbar 组件的实例附加到加载某些 XML 后正在创建的类实例内的动态文本字段。滚动条组件已正确连接，因为滑块的大小取决于文本字段中的内容量，但它不会滚动。

这是代码：

```
function xmlLoaded(evt:Event):void
{   
    //do some stuff

    for(var i:int = 0; i < numProfiles; i++)
    {
        var thisProfile:profile = new profile();

        thisProfile.alpha = 0;
        thisProfile.x = 0;
        thisProfile.y = 0;
        thisProfile.name = "profile" + i;

        profilecontainer.addChild(thisProfile);

        thisProfile.profiletextholder.profilename.htmlText = profiles[i].attribute("name");
        thisProfile.profiletextholder.profiletext.htmlText = profiles[i].profiletext;

        //add scroll bar
        var vScrollBar:UIScrollBar = new UIScrollBar();
        vScrollBar.direction = ScrollBarDirection.VERTICAL;
        vScrollBar.move(thisProfile.profiletextholder.profiletext.x + thisProfile.profiletextholder.profiletext.width, thisProfile.profiletextholder.profiletext.y);
        vScrollBar.height = thisProfile.profiletextholder.profiletext.height;
        vScrollBar.scrollTarget = thisProfile.profiletextholder.profiletext;
        vScrollBar.name = "scrollbar";
        vScrollBar.update();
        vScrollBar.visible = (thisProfile.profiletextholder.profiletext.maxScrollV > 1);

        thisProfile.profiletextholder.addChild(vScrollBar);

        //do some more stuff
    }
} 
```

我还尝试过在影片剪辑/类本身中使用 UIScrollBar 组件，但它仍然无法正常工作。有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T16:40:40.413

一旦您的文本字段从类似于以下的单独函数初始化后，您可以尝试添加滚动条：

```
private function assignScrollBar(tf:TextField, sb:UIScrollBar):void {
    trace("assigning scrollbar");
    sb.move(tf.x + tf.width, tf.y);
    sb.setSize(15, tf.height);
    sb.direction = ScrollBarDirection.VERTICAL;
    sb.scrollTarget = tf;
    addChild(sb);
    sb.update();         
} 
```

这就是我目前的做法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T16:36:12.607

在您的第一个示例中， 您是否尝试将 `vScrollBar.update();` 语句**放在**`addChild(vScollbar);` ?

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T17:51:51.687

您是否尝试过将 UI 滚动条放到舞台上，在设计时将其绑定到文本字段，然后在加载事件期间调用 update()？

过去在运行时动态创建 UIScrollbars 时，我有过一些*有趣的经历。*

# java - 来自匿名内部类的外部类的关键字

> ID：56974
> 
> 赞同：209
> 
> 时间：2008-09-11T15:58:55.030
> 
> 标签：java, anonymous-inner-class

在以下代码段中：

```
public class a {
    public void otherMethod(){}
    public void doStuff(String str, InnerClass b){}
    public void method(a){
        doStuff("asd",
            new InnerClass(){
                public void innerMethod(){
                    otherMethod();
                }
            }
        );
    }
} 
```

是否有关键字可以从内部类引用外部类？基本上我想做的是`outer.otherMethod()`，或类似的东西，但似乎找不到任何东西。

* * *

## 回答 #1

> 赞同：354
> 
> 时间：2008-09-11T16:03:27.127

通常，您`OuterClassName.this`用来指代外部类的封闭实例。

在你的例子中，那将是`a.this.otherMethod()`

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2008-09-11T16:05:15.657

```
OuterClassName.this.outerClassMethod(); 
```

# asp.net - 在 ASP.NET 中发送大量电子邮件的最佳方式是什么？

> ID：56975
> 
> 赞同：5
> 
> 时间：2008-09-11T15:59:06.683
> 
> 标签：asp.net, email, batch-file

我目前正在遍历数据读取器并调用 System.Net.Mail.SmtpClient 的 Send() 方法。这样做的问题是它很慢。每封电子邮件大约需要 5-10 秒发送（这可能只是我的主机的问题）。我必须像这样覆盖 web.config 文件中的 executionTimeout 默认值（默认为 90 秒）：

```
 <httpRuntime executionTimeout="3000" /> 
```

一个警告：我在一个共享主机上，所以我认为我不可能使用 PickupDirectoryFromIis 选项发送（至少，当我打开它时它给了我错误）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-11T16:04:23.257

您可以异步发送邮件。这样超时不应中断您的发送。

这篇文章应该可以帮助您开始：[在 C# 中异步发送电子邮件](http://www.eggheadcafe.com/articles/20030720.asp)。

这里还有另一种方法：http: [//www.vikramlakhotia.com/Sending_Email_asynchronously_in_AspNet_20.aspx](http://www.vikramlakhotia.com/Sending_Email_asynchronously_in_AspNet_20.aspx)

当然，有几个商业客户端可用，但我尝试过并且可以推荐的唯一一个是[http://www.aspnetemail.com/](http://www.aspnetemail.com/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T16:10:32.773

绝对在后台工作进程中生成它，以便它们异步退出。

顺便说一句，每封电子邮件 5-10 秒对我来说似乎很慢。在我的服务器上，每封电子邮件只需要几分之一秒。

# .net - 哪个是我导航的最佳数据库架构？

> ID：56981
> 
> 赞同：1
> 
> 时间：2008-09-11T16:01:03.810
> 
> 标签：.net, sql, database, linq-to-sql, database-design

我正在创建一个网站，其中所有页面都挂在数据库驱动的树层次结构上。

除了一个节点外，所有节点都有一个父节点。节点可能具有基于角色的读取权限。某些节点可能有特殊规则（例如：不在导航菜单中显示）。

节点可能表示到其他节点的链接（如 Windows 中的快捷方式）。节点通常代表页面。

页面呈现 HTML 内容或[执行编程](https://stackoverflow.com/questions/56770/dynamic-navigation-and-web-applications)。某些页面可能是子树的根（备用母版页和样式表）。

请帮助我在 Microsoft SQL Server 中设置我的节点数据库以供 Linq to SQL 使用。

我有三个想法：

1.  许多具有几乎为零的 nullalbe 字段的轻量级表。

    ![#1 许多轻量级表的 nullalbe 字段几乎为零](https://i.stack.imgur.com/Fze57.gif)

2.  具有大量 nullalbe 字段的重量级节点表。

    ![#2 具有大量 nullalbe 字段的重量级节点表](https://i.stack.imgur.com/Yf5Gn.gif)

3.  两者中最好的（或最坏的）：许多轻量级表的大量空外键。

    ![#3 许多轻量级表的大量空外键](https://i.stack.imgur.com/8xc8W.gif)

您认为哪个最能代表数据？哪个最容易与 Linq to SQL 一起使用？

如何将我的数据完整性规则保存在数据库中？我如何在我的编程中最好地执行它们？

*   节点必须是（但不能同时是）链接或页面。

*   页面必须是（但不能同时是）html 或代码。

*   链接可能不是根目录、html 或代码。

我可以制作具有这种结构的 ASP.NET 站点地图提供程序吗？我是不是该？

* * *

更新：我问了一个更一般的问题：

[在 SQL 中处理一对一关系的最佳方法是什么？](https://stackoverflow.com/questions/56770/dynamic-navigation-and-web-applications)

* * *

相关问题：
[如何在我的数据库中实施数据完整性规则？](https://stackoverflow.com/questions/86181/how-do-i-enforce-data-integrity-rules-in-my-database)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-11T16:07:33.327

阅读您的帖子后，我的最初印象是，我非常不愿意让**任何**一种技术（在本例中为 linq）严重影响数据库架构设计，直至您似乎建议的程度。

我认为您的架构应该几乎相同，无论您随后选择哪种技术来构建您的业务/表示层。

我希望我没有误解你。

# hardware - 如何访问 PCMCIA 调制解调器的序列号？

> ID：56999
> 
> 赞同：1
> 
> 时间：2008-09-11T16:07:32.547
> 
> 标签：hardware, modem

Sprint 蜂窝调制解调器插入笔记本电脑 - 通常是 PCMCIA 插槽。要进行连接，用户打开一个名为 Connection Manager 的程序。这个程序有一个菜单选项来显示当前插入的调制解调器的序列号和电话号码。

这是否意味着调制解调器的序列号/电话号码可用于系统上运行的其他程序？（注意：假设这是 Windows XP。）

具体来说，是否可以将公司的 VPN 软件配置为传递有关正在使用哪个调制解调器进行连接的信息？

最后，是否有现有的 VPN 软件已经可以做到这一点，还是必须进行定制编程？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-11T16:20:27.897

有时您可以使用 AT 命令集获取调制解调器的序列号。要查看此操作，请转到您的控制面板并打开电话和调制解调器选项。选择调制解调器选项卡，选择您感兴趣的调制解调器，然后选择属性。

在调制解调器窗口中，选择诊断选项卡，然后按查询调制解调器按钮。

这将打开串行端口并发送一系列 AT 命令以收集各种设置和信息。您可以在您的程序（或终端程序）中打开串口，发送 AT 命令，并返回相同的信息。

您可能需要检查特定调制解调器的 AT 命令集以查找序列号的存储位置，或者使用串行端口间谍程序查看 Sprint 的程序是如何做到的。

我不知道有任何 VPN 使用此信息，并且我可以想出几种方法来欺骗它，因为调制解调器和计算机之间的通信在加密上并不安全。

-亚当

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T22:57:53.677

打开超级终端或以编程方式建立串行端口连接，并使用 Hayes AT 语言与之对话。大多数软件还在设备属性和/或诊断中列出了它。

AT+GSN

按回车***************************