# StackOverflow 问答 000057000-000057999

# css - CSS使空单元格的边框出现？

> ID：57002
> 
> 赞同：73
> 
> 时间：2008-09-11T16:08:06.913
> 
> 标签：css

即使单元格为空，我应该使用什么 CSS 来显示单元格的边框？

特别是 IE 7。

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-09-11T16:09:23.477

如果我记得，某些 IE 中不存在该单元格，除非它充满了一些东西......

如果您可以放置​​一个`&nbsp;`（不间断的空间）来填补空白，那通常会起作用。还是您需要纯 CSS 解决方案？

显然，IE8默认显示单元格，你必须隐藏它`empty-cells:hide`但它在IE7中根本不起作用（默认隐藏）。

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2009-07-29T11:35:38.190

确保所有单元格中都有数据的另一种方法：

```
 $(document).ready(function() {
      $("td:empty").html("&nbsp;");
    }); 
```

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2008-09-11T16:44:26.980

如果将`border-collapse`属性设置为`collapse`，IE7 将显示空单元格。它也会折叠边框，所以这可能不是你想要的 100%

```
td {
  border: 1px solid red;
}
table {
  border-collapse: collapse;
}
<html> <head> <title>Border-collapse Test</title> <style type="text/css"> td {
  border: 1px solid red;
}
table {
  border-collapse: collapse;
}
```

```
<table>
  <tr>
    <td></td>
    <td>test</td>
    <td>test</td>
  </tr>
  <tr>
    <td>test</td>
    <td></td>
    <td>test</td>
  </tr>
  <tr>
    <td>test</td>
    <td></td>
    <td>test</td>
  </tr>
  <tr>
    <td>test</td>
    <td></td>
    <td />
  </tr>
</table>
```

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2011-03-02T20:23:22.227

这个问题要求一个 CSS 解决方案，但如果 HTML 解决方案可以做到，这里有一个：

尝试将这两个属性添加到 table 元素： **frame="box" rules="all"** 像这样：

```
<table border="1" cellspacing="0" frame="box" rules="all"> 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-09-11T16:16:51.447

我刚刚找到以下内容。它符合标准，但在 IE 中不起作用。叹。

```
empty-cells: show 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2011-05-27T19:52:26.010

我遇到了这个问题，但没有看到任何真正解决这个问题的答案。

问题的产生是因为 IE7 看不到单元格的任何内部内容；在编程术语中，单元格是作为 a 产生的，`null`并且像大多数事情一样，您不能为 a 设置边界`null`或对其执行任何操作。浏览器需要一个具有布局的元素/对象，才能应用边框/布局。

甚至是空的`<div></div>`或`<span></span>`不包含内容，因此没有要渲染的内容，`null`再次导致这种情况。

但是，您可以通过提供空`div/span`布局属性来欺骗浏览器，使其认为单元格有内容。最简单的方法是应用 CSS 样式`zoom:1`。

```
<table>
   <tr><td>Foo</td>
       <td><span style="zoom:1;"></span></td></tr>
</table> 
```

* * *

这种解决方法比使用 a 更好`&nbsp;`，因为它不会不必要地弄乱屏幕阅读器，也不会歪曲单元格的值。在较新的浏览器中，您可以使用`empty-cell:<show|hide>`替代方法。

* * *

***注意：***代替 Tomalak 的评论，应该理解 hasLayout 与 无关`null`，它只是比较浏览器如何交互和呈现 hasLayout 类似于数据库或编程语言如何与 null 交互。这是一个延伸，但我认为对于那些从程序员转为网页设计师的人来说可能更容易理解。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-09-11T16:18:15.593

理想情况下，表格中不应有任何空单元格。要么你有一个数据表，并且在那个特定的单元格中没有数据（你应该用“-”或“n/a/”，或者同样合适的东西来表示，或者 - 如果你必须 -  ，如建议的那样)，或者您有一个需要跨越列或行的单元格，或者您正在尝试使用应该使用 CSS 的表格来实现某种布局。

我们可以更详细一点吗？

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2011-04-06T23:45:48.090

这个问题很老，但仍然是谷歌的最高结果，所以我将添加我发现的内容：

简单地添加`border-collapse: collapse`到表格样式中为我在 IE7 中解决了这个问题（并且不影响它们在 FF、Chrome 等中的显示方式）。

`&nbsp;`当您可以使用 CSS 修复时，最好避免添加或其他间距元素的无关代码。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-11T16:10:41.617

我想这不能用 CSS 来完成；你需要放一个   在每个空白单元格中，以便在 IE 中显示边框...

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-08-31T20:46:19.157

empty-cell 仅修复了 Firefox（是的，我确实在 Firefox 中遇到过这个问题）IE 7 和 8 仍然有问题..

这在 Firefox 3.6.x、IE 7 & 8、Chrome 和 Safari 中都适用于我：

===============================

```
table {
*border-collapse: collapse;}

.sampleTD {
empty-cells: show;} 
```

===============================

必须使用 * 来确保表格样式仅适用于 IE 浏览器。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-07-20T14:57:33.733

如果您不能使用不可破坏的空间，请尝试以下操作：

```
var tn = document.createTextNode('\ ');
yourContainer.appendChild(ta); 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-03-07T14:10:54.273

我创建了一个与单元格背景具有相同字体颜色的 div 样式，并写下任何内容（通常是“-”“n/a”或“空”）来提供单元格内容。如果您突出显示页面，它会显示出来，但是当您正常查看时，它看起来像您想要的那样。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-04-09T04:20:00.560

我混合使用 html 和 css 来创建跨浏览器表格网格：

html

`<table cellspacing="1" style="background-color:#000;" border="0">`

css

```
td{background-color:#fff;} 
```

到目前为止，我还没有看到任何浏览器有任何问题。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-10T15:15:28.080

既然 IE8 已经出来，“IE”在这种情况下不再是一个有用的术语。

IE7 总是执行“empty-cells:show”（或者我被告知... Vista）。任何“怪癖”或“IE7 标准”模式下的 IE8 总是执行“空单元格：隐藏”。“标准”模式下的 IE8 默认为“empty-cells:show”，并通过 CSS 支持该属性。

据我所知，其他所有浏览器已经正确支持了好几年了（我知道它是在 Firefox 2 中添加的）。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-03-30T16:24:20.147

我从另一个网站上拿这个但是：

```
.sampletable {
border-collapse: collapse;}

.sampleTD {
empty-cells: show;} 
```

分别用于表格和 TD 元素的 CSS。

# search-engine - 如何找到哪些搜索词（如果有）将用户带到我的网站？

> ID：57004
> 
> 赞同：3
> 
> 时间：2008-09-11T16:08:44.710
> 
> 标签：search-engine, analytics

我想基于此创建动态内容。我知道它在某个地方，因为网络分析引擎可以获取这些数据来确定人们如何访问您的网站（推荐人，使用的搜索词等），但我自己不知道如何获得它。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-11T16:13:53.653

您可以使用用户发送的请求中的“引用者”部分来确定他搜索的内容。来自谷歌的例子：

> [http://www.google.no/search?q=stack%20overflow](http://www.google.no/search?q=stack%20overflow)

因此，您必须在字符串（在 ASP(.NET) 中可以找到`Request.Referer`）中搜索“q=”，然后对内容进行 URLDecode。

此外，您应该看看这篇文章，它更多地讨论了推荐人以及其他跟踪访问者的方法：

[http://www.15seconds.com/issue/021119.htm](http://www.15seconds.com/issue/021119.htm)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T16:33:56.523

这是一些代码来支持使用查询字符串方法的想法，如果使用 Request 对象的 UrlReferrer 属性不可用。然后可以将其隐藏在会话对象中（或其他地方，如果这对您更有效），以便您可以跟踪页面之间的源。（Page_Load 在这里的代码示例中似乎没有正确格式化）

```
public void Page_Load(Object Sender, EventArgs E) {
            if (null == Session["source"] || Session["source"].ToString().Equals(string.Empty)) {
                if (Request.QueryString["src"] != null) {
                    Session["source"] = Server.UrlDecode(Request.QueryString["src"].ToString());
                } else {
                    if (Request.UrlReferrer != null) {
                        Session["source"] = Request.UrlReferrer.ToString();
                    } else {
                        Session["source"] = string.Empty;
                    }
                }
            }} 
```

# windows - 从 Windows 上的主文件表获取信息

> ID：57007
> 
> 赞同：2
> 
> 时间：2008-09-11T16:09:57.907
> 
> 标签：windows, filesystems

我需要获取一些包含在 Windows 机器上的 MFT 中的信息，我希望有一些超级机密的 API 可以获取这些信息。我需要能够以编程方式获取这些信息，并且由于法律问题，我可能无法使用正式称为 sysinternals 的公司提供的工具。

我的另一个选择（我真的不想这样做）是使用 DeviceIoControl 获取 MFT 的起始扇区，并手动解析信息。

无论如何，特别是，我真正需要从主文件表中得到的是用于保存与文件关联的数据的逻辑扇区。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-11T17:16:38.933

自 Windows 2000 以来，有一个记录在案的 API 用于获取有关磁盘上文件位置的信息。在 MSDN 上查找带有 FSCTL_GET_RETRIEVAL_POINTERS 控制代码的 DeviceIoControl 函数：

[http://msdn.microsoft.com/en-us/library/aa364572(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa364572(VS.85).aspx)

该 API 已被提供用于编写​​自定义磁盘碎片整理程序，并由几个其他控制代码组成。

# c# - 减少字符串数组中序列的最佳方法

> ID：57010
> 
> 赞同：7
> 
> 时间：2008-09-11T16:10:38.297
> 
> 标签：c#, .net, algorithm

拜托，既然我已经重写了这个问题，并且在它受到进一步[的快速回答或](https://stackoverflow.com/questions/56103/fastest-gun-in-the-west-problem)[急切的编辑](https://stackoverflow.com/users/905/keith)过早关闭之前，让我指出这不是[这个问题](https://stackoverflow.com/questions/9673/remove-duplicates-from-array)的重复。我知道如何从数组中删除重复项。

这个问题是关于从数组中删除**序列，而不是严格意义上的重复。**

考虑数组中的这个元素序列；

```
[0] a
[1] a
[2] b
[3] c
[4] c
[5] a
[6] c
[7] d
[8] c
[9] d 
```

在这个例子中，我想获得以下......

```
[0] a
[1] b
[2] c
[3] a
[4] c
[5] d 
```

请注意，重复的元素被保留，但相同元素的序列已被简化为该元素的单个实例。

此外，请注意，当两行重复时，它们应减少为一组（两行）。

```
[0] c
[1] d
[2] c
[3] d 
```

...减少到...

```
[0] c
[1] d 
```

我正在用 C# 编码，但任何语言的算法都值得赞赏。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-11T17:47:59.247

**编辑：做了一些改变和新的建议**

推拉窗呢...

```
REMOVE LENGTH 2: (no other length has other matches)
//the lower case letters are the matches
ABCBAbabaBBCbcbcbVbvBCbcbcAB  
__ABCBABABABBCBCBCBVBVBCBCBCAB

REMOVE LENGTH 1 (duplicate characters):
//* denote that a string was removed to prevent continual contraction
//of the string, unless this is what you want.
ABCBA*BbC*V*BC*AB
_ABCBA*BBC*V*BC*AB

RESULT:
ABCBA*B*C*V*BC*AB == ABCBABCVBCAB 
```

这当然是从长度 = 2 开始，将其增加到 L/2 并向下迭代。

我也在考虑另外两种方法：

1.  **digraph** - 使用数据设置有状态有向图并使用字符串对其进行迭代，如果发现循环，您将有重复。我不确定检查这些周期有多容易......可能是一些动态编程，所以它可能等同于下面的方法 2。我将不得不考虑这个问题更长的时间。
2.  **距离矩阵**- 使用 levenstein 距离矩阵，您可能能够检测到成本为 0 的对角线移动（偏离对角线）的重复。这可能表明数据重复。我将不得不更多地考虑这一点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-11T19:30:46.020

这是我编写的 C# 应用程序，它解决了这个问题。

**需要**
aabcccdcd

**输出**
abcacd

可能看起来很乱，花了我一点时间来了解动态模式长度位。

```
class Program
{
    private static List<string> values;
    private const int MAX_PATTERN_LENGTH = 4;

    static void Main(string[] args)
    {
        values = new List<string>();
        values.AddRange(new string[] { "a", "b", "c", "c", "a", "c", "d", "c", "d" });

        for (int i = MAX_PATTERN_LENGTH; i > 0; i--)
        {
            RemoveDuplicatesOfLength(i);
        }

        foreach (string s in values)
        {
            Console.WriteLine(s);
        }
    }

    private static void RemoveDuplicatesOfLength(int dupeLength)
    {
        for (int i = 0; i < values.Count; i++)
        {
            if (i + dupeLength > values.Count)
                break;

            if (i + dupeLength + dupeLength > values.Count)
                break;

            var patternA = values.GetRange(i, dupeLength);
            var patternB = values.GetRange(i + dupeLength, dupeLength);

            bool isPattern = ComparePatterns(patternA, patternB);

            if (isPattern)
            {
                values.RemoveRange(i, dupeLength);
            }
        }
    }

    private static bool ComparePatterns(List<string> pattern, List<string> candidate)
    {
        for (int i = 0; i < pattern.Count; i++)
        {
            if (pattern[i] != candidate[i])
                return false;
        }

        return true;
    }
} 
```

*修复了初始值以匹配问题值*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T16:12:23.610

我会将它们全部转储到您最喜欢的 Set 实现中。

编辑：既然我理解了这个问题，那么您的原始解决方案看起来是最好的方法。只需遍历数组一次，保留一组标志来标记要保留的元素，加上一个计数器来跟踪新数组的大小。然后再次循环以将所有守护者复制到一个新数组中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-11T16:16:23.710

我同意，如果您可以将字符串转储到 Set 中，那么这可能是最简单的解决方案。

如果由于某种原因您无法访问 Set 实现，我只会按字母顺序对字符串进行排序，然后遍历一次并删除重复项。如何对它们进行排序并从列表中删除重复项将取决于您运行代码的语言和环境。

编辑：哦，ick....根据您的说明，我看到您希望模式甚至可能出现在单独的行上。我的方法不能解决你的问题。对不起。这是一个问题。如果我有以下文件。

一种

一种

b

C

C

一种

一种

b

C

C

您是否希望它简化为

一种

b

C

# cross-platform - 跨平台应用程序应该将数据保存在哪里？

> ID：57019
> 
> 赞同：16
> 
> 时间：2008-09-11T16:15:21.093
> 
> 标签：cross-platform

我正在构建一个面向 Windows、Mac 和 Linux 的应用程序。我想知道我应该将应用程序数据（例如设置等）保存在哪里。

应用程序的安装文件夹是最简单的选择，但我认为这可能是新 Vista 安全模型的问题。此外，用户可能需要不同的设置。

C:\Documents and Settings\username\MyApp 对 Vista 和 XP 都适用吗？/home/username/.MyApp 适用于 Linux 和 Mac 吗？

非常感谢任何想法和/或最佳实践链接。

谢谢！

胡安

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-11T16:17:35.797

每个平台都有自己的 API，用于查找用户的主文件夹、文档文件夹或首选项文件夹。

*   Windows：SHGetFolderPath() 或 SHGetKnownFolderPath()
*   Mac OS X 和 iPhone 操作系统：NSSearchPathForDirectoriesInDomains()
*   Unix：$HOME 环境变量

不要对特定路径进行硬编码，也不要在用户名上添加前缀和后缀。此外，请尝试遵循平台为文件命名的任何约定。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-11T16:38:41.503

关于最佳实践，Jeff 发表了一篇关于污染用户空间的文章，您可能会发现它很有用：[不要污染用户空间](http://www.codinghorror.com/blog/archives/001032.html "不要污染用户空间")

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-11T17:34:04.677

一般来说，我建议您将设置的实现抽象为“设置提供程序”，并为每个平台提供不同的提供程序。这样，您可以以最适合目标平台的方式（例如，Linux 上的文件或 Windows 注册表）实现设置的存储。

不要简单地采用“最小公分母”。如果您有必须明确存储在文件中的内容，请让您的设置提供程序公开这些文件的特定于平台的位置。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-11T16:19:04.810

我不是 ：）

我在 Windows 中使用 USERPROFILE，在 Mac/Linux 中使用 HOME。但即便如此，我需要知道那些地方是正确的。

谢谢！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-11T16:21:11.763

在 Windows 中，您需要深入到另一个层次，而不仅仅是用户配置文件。使用应用程序数据文件夹。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-11T16:24:42.927

在 Windows 上我使用 APPDATA，在 Linux 上我使用 HOME。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-11T19:35:16.400

对于 Linux/BSD/Solaris： [http ://standards.freedesktop.org/basedir-spec/basedir-spec-latest.html](http://standards.freedesktop.org/basedir-spec/basedir-spec-latest.html)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-11T16:21:47.537

永远不要将用户数据存储在应用程序文件夹中。这只是个坏主意。

大多数操作系统都有一个 $HOME（或 %HOME%）环境变量。那将是第一个看的地方。

但是，如果您想干净地支持多个操作系统，您将不得不为每个操作系统编写一些特定于操作系统的代码，以准确确定事情需要去哪里。（Mac OS 的 ~/Library，基于 GNOME 的系统的 ~/.config，Windows 的 %HOME%/Application Data 等）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-14T23:39:02.990

您打算使用什么语言？例如，Java 有一个专用的[Preference API](http://java.sun.com/javase/6/docs/technotes/guides/preferences/index.html)。

# c# - 哪个 .Net 集合可以一次添加多个对象并获得通知？

> ID：57020
> 
> 赞同：36
> 
> 时间：2008-09-11T16:15:52.587
> 
> 标签：c#, .net-3.5, collections

正在考虑`System.Collections.ObjectModel ObservableCollection<T>`上课。这个很奇怪，因为

*   它有一个添加方法，它只接受**一项**。没有 AddRange 或等效项。
*   Notification 事件参数有一个 NewItems 属性，它是一个**IList**（对象的......不是 T）

我需要将一批对象添加到集合中，并且侦听器还将该批次作为通知的一部分。我错过了什么 ObservableCollection 吗？还有其他符合我规格的课程吗？

*更新：尽可能不要自己动手。我必须构建添加/删除/更改等。很多东西。*

* * *

相关问：
[https ://stackoverflow.com/questions/670577/observablecollection-doesnt-support-addrange-method-so-i-get-notified-for-each](https://stackoverflow.com/questions/670577/observablecollection-doesnt-support-addrange-method-so-i-get-notified-for-each/670579#670579)

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-11T16:43:52.413

似乎该`INotifyCollectionChanged`界面允许在添加多个项目时进行更新，所以我不确定为什么`ObservableCollection<T>`没有`AddRange`. 您可以为 制作一个扩展方法`AddRange`，但这会为每个添加的项目引发一个事件。如果那是不可接受的，你应该能够继承`ObservableCollection<T>`如下：

```
public class MyObservableCollection<T> : ObservableCollection<T>
{
    // matching constructors ...

    bool isInAddRange = false;

    protected override void OnCollectionChanged(NotifyCollectionChangedEventArgs e)
    {
        // intercept this when it gets called inside the AddRange method.
        if (!isInAddRange) 
            base.OnCollectionChanged(e);
    }

    public void AddRange(IEnumerable<T> items)
    {
         isInAddRange = true;
         foreach (T item in items)
            Add(item);
         isInAddRange = false;

         var e = new NotifyCollectionChangedEventArgs(
             NotifyCollectionChangedAction.Add,
             items.ToList());
         base.OnCollectionChanged(e);
    }
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-14T19:03:47.557

好吧，这个想法与fryguybob 的想法相同——ObservableCollection 完成了一半有点奇怪。这件事的事件参数甚至不使用泛型..让我使用 IList（就是这样..昨天:) 测试片段如下......

```
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Collections.Specialized;

namespace MyNamespace
{
    public class ObservableCollectionWithBatchUpdates<T> : ObservableCollection<T>
    {
        public void AddRange(ICollection<T> obNewItems)
        {
            IList<T> obAddedItems = new List<T>();
            foreach (T obItem in obNewItems)
            {
                Items.Add(obItem);
                obAddedItems.Add(obItem);
            }
            NotifyCollectionChangedEventArgs obEvtArgs = new NotifyCollectionChangedEventArgs(
               NotifyCollectionChangedAction.Add, 
               obAddedItems as System.Collections.IList);
            base.OnCollectionChanged(obEvtArgs);
        }

    }
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-12T03:13:10.293

不仅是`System.Collections.ObjectModel.Collection<T>`一个不错的选择，而且在帮助文档中还有[一个示例](http://msdn.microsoft.com/en-us/library/ms132397.aspx)，说明如何覆盖其各种受保护的方法以获得通知。（向下滚动到示例 2。）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-05-12T04:54:58.787

如果您使用上述任何发送添加范围命令并将 observablecolletion 绑定到列表视图的实现，您将收到这个讨厌的错误。

```
不支持异常
   在 System.Windows.Data.ListCollectionView.ValidateCollectionChangedEventArgs（NotifyCollectionChangedEventArgs e）
   在 System.Windows.Data.ListCollectionView.ProcessCollectionChanged（NotifyCollectionChangedEventArgs 参数）
   在 System.Collections.Specialized.NotifyCollectionChangedEventHandler.Invoke（对象发送者，NotifyCollectionChangedEventArgs e）
   在 System.Collections.ObjectModel.ObservableCollection`1.OnCollectionChanged（NotifyCollectionChangedEventArgs e）

```

我使用的实现使用了在 WPF 框架周围更均匀地实现的 Reset 事件：

```
 public void AddRange(IEnumerable<T> collection)
    {
        foreach (var i in collection) Items.Add(i);
        OnPropertyChanged("Count");
        OnPropertyChanged("Item[]");
        OnCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset));
    } 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-09-30T09:58:37.800

我已经多次看到这种问题，我想知道为什么连微软都在到处推广 ObservableCollection 其他地方已经有更好的集合可用了。

> `BindingList<T>`

它允许您关闭通知并进行批量操作，然后打开通知。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-11T16:21:44.680

如果您想从某种集合继承，最好从 System.Collections.ObjectModel.Collection 继承，因为它提供了用于覆盖的虚拟方法。如果你走那条路，你将不得不从 List 中隐藏方法。

我不知道有任何提供此功能的内置集合，但我欢迎更正:)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-01-12T15:30:13.313

另一种类似于 CollectionView 模式的解决方案：

```
public class DeferableObservableCollection<T> : ObservableCollection<T>
{
    private int deferLevel;

    private class DeferHelper<T> : IDisposable
    {
        private DeferableObservableCollection<T> owningCollection;
        public DeferHelper(DeferableObservableCollection<T> owningCollection)
        {
            this.owningCollection = owningCollection;
        }

        public void Dispose()
        {
            owningCollection.EndDefer();
        }
    }

    private void EndDefer()
    {
        if (--deferLevel <= 0)
        {
            deferLevel = 0;
            OnCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset));
        }
    }

    public IDisposable DeferNotifications()
    {
        deferLevel++;
        return new DeferHelper<T>(this);
    }

    protected override void OnCollectionChanged(NotifyCollectionChangedEventArgs e)
    {
        if (deferLevel == 0) // Not in a defer just send events as normally
        {
            base.OnCollectionChanged(e);
        } // Else notify on EndDefer
    }
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-11T16:19:10.490

从 List<T> 继承并覆盖 Add() 和 AddRange() 方法来引发事件？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-07-14T03:25:12.300

看看在C# 和 VB 中[使用 AddRange、RemoveRange 和 Replace range 方法的 Observable 集合。](https://stackoverflow.com/questions/670577/observablecollection-doesnt-support-addrange-method-so-i-get-notified-for-each/670579#670579)

在 VB 中：INotifyCollectionChanging 实现。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-11-24T14:30:21.900

为了快速添加，您可以使用：

```
((List<Person>)this.Items).AddRange(NewItems); 
```

# java - jQuery 和 Java 小程序

> ID：57034
> 
> 赞同：10
> 
> 时间：2008-09-11T16:21:03.467
> 
> 标签：java, javascript, jquery, applet

我正在做一个项目，我们在其中使用 Java 小程序作为 UI 的一部分（特别是地图），但在 HTML/JavaScript 中围绕小程序构建 UI 的其余部分，通过 LiveConnect/NPAPI 与小程序通信. 有点奇怪，我知道，但让我们假设设置不在讨论中。我开始计划使用 jQuery 作为我的 JavaScript 框架，但我遇到了两个问题。

**发出第一个：**

选择小程序不提供对小程序方法的访问。

爪哇：

```
public class MyApplet extends JApplet {
  // ...
  public String foo() { return "foo!"; }
} 
```

JavaScript：

```
var applet = $("#applet-id");
alert(applet.foo()); 
```

运行上面的 JavaScript 会导致

```
$("#applet-id").foo 不是函数
```

这与 Prototype 不同，其中类似的代码确实有效：

```
var applet = $("applet-id");
alert(applet.foo()); 
```

那么……applet 方法去哪儿了？

**发出第二个：**

Firefox 2 中的 jQuery 和小程序存在一个已知问题：[http ://www.pengoworks.com/workshop/jquery/bug_applet/jquery_applet_bug.htm](http://www.pengoworks.com/workshop/jquery/bug_applet/jquery_applet_bug.htm)

这是一个很长的镜头，但有人知道解决方法吗？我怀疑这个问题无法解决，这意味着切换到 Prototype。

谢谢您的帮助！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-11T16:31:39.260

对于第一个问题，如何尝试

```
alert( $("#applet-id")[0].foo() ); 
```

对于第二个问题，这里[有](http://groups.google.com/group/jquery-dev/browse_thread/thread/c67483e58caacbfd)一个可能的解决方法。

引用解决方法

> ```
> // Prevent memory leaks in IE
> // And  prevent errors on refresh with events  like mouseover in other  browsers
> // Window isn't included so as not to unbind existing unload events
> jQuery(window).bind("unload",
> function() {
>         jQuery("*").add(document).unbind();
> }); 
> ```

将该代码更改为：

> ```
> // Window isn't included so as not to unbind existing unload events
> jQuery(window).bind("unload",
> function() {
>         jQuery("*:not('applet, object')").add(document).unbind();
> }); 
> ```

# algorithm - TNT.com 跟踪号使用什么校验和（如果有）？

> ID：57053
> 
> 赞同：2
> 
> 时间：2008-09-11T16:36:12.697
> 
> 标签：algorithm, validation, checksum

我正在编写一些软件来识别跟踪号码（就像谷歌在搜索 FedEx 或 UPS 号码时识别它们一样）。大多数快递员使用系统，例如“加权平均模数系统”，可用于识别号码是否为有效的跟踪号码。有谁知道 TNT 托运号码是否使用这样的系统，如果是，它是什么？我已经问过 TNT 的支持，代表告诉我他们没有……但我想再确认一下。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-10T10:41:10.597

好的，你问到现在已经三个月了，但我在写一个类似的软件时偶然发现了这个。据我们所知，TNT 使用[S10](http://en.wikipedia.org/wiki/S10_(UPU_standard))跟踪号系统。这意味着他们的号码将是 AA########AA 类型。最后两个字母对应一个 ISO/IATA 国家代码。话虽如此，TNT 使用我们认为必须代表全球的 WW。这不是一个完整的答案，至少与校验和或算法无关，但它可能有用吗？希望有帮助

柳

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T16:56:34.720

据我所知，没有。对不起。

我认为您正在尝试验证输入的跟踪号以确保输入正确？

——凯文·费尔柴尔德

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-10-21T09:02:20.923

我相信有一个 Check Digit / Checksum 数字，可能是 MOD10 的衍生物，但不知道它是什么算法，被 TNT 称为第 9 位。很高兴知道？？？

我所知道的 12345678 校验位是 5，22345678 校验位是 8。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-10-22T08:05:30.277

它实际上是我写的 MOD 11 VB.net 如下：

```
 Dim number As String = TextBox1.Text
    Dim A As Integer
    Dim B As Integer
    Dim C As Integer
    Dim check_digit As Integer

    A = (CInt(Mid(number, 1, 1)) * 8) + (CInt(Mid(number, 2, 1)) * 6) + (CInt(Mid(number, 3, 1)) * 4) + (CInt(Mid(number, 4, 1)) * 2) + (CInt(Mid(number, 5, 1)) * 3) + (CInt(Mid(number, 6, 1)) * 5) + (CInt(Mid(number, 7, 1)) * 9) + (CInt(Mid(number, 8, 1)) * 7)
    B = ((A \ 11) * 11)
    C = A - B

    If C = 0 Then
        check_digit = 5
    End If

    If C = 1 Then
        check_digit = 0
    End If

    If C <> 0 And C <> 1 Then
        check_digit = 11 - C
    End If

    MsgBox(number & check_digit) 
```

# .net - 如何解决 Generic.IList 之间的调用歧义 .this[] 和 IList.this[]？

> ID：57054
> 
> 赞同：7
> 
> 时间：2008-09-11T16:36:20.497
> 
> 标签：.net, generics, interface, explicit

我有一个集合，它实现了一个扩展 IList<T> 和 List 的接口。

```
public Interface IMySpecialCollection : IList<MyObject>, IList { ... } 
```

这意味着我有两个版本的索引器。

我希望使用通用实现，所以我通常实现它：

```
public MyObject this[int index] { .... } 
```

我只需要 IList 版本进行序列化，所以我明确地实现它，以保持它隐藏：

```
object IList.this[int index] { ... } 
```

但是，在我的单元测试中，以下

```
MyObject foo = target[0]; 
```

导致编译器错误

> 以下方法或属性之间的调用不明确

我对此有点惊讶；我相信我以前做过，而且效果很好。我在这里想念什么？如何让 IList<T> 和 IList 在同一个接口中共存？

**编辑**IList<T>*没有*实现 IList，我**必须**实现 IList 进行序列化。我对解决方法不感兴趣，我想知道我缺少什么。

**再次编辑**：我不得不从界面中删除 IList 并将其移动到我的班级。我不想这样做，因为实现接口的类最终会被序列化为 Xaml，这需要集合来实现 IDictionary 或 IList...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-11T17:41:12.837

你不能这样做

`public interface IMySpecialCollection : IList<MyObject>, IList { ... }`

但是你可以用一个类做你想做的事，你需要明确地实现其中一个接口。在我的示例中，我明确表示了 IList。

`public class MySpecialCollection : IList<MyObject>, IList { ... }`

`IList<object> myspecialcollection = new MySpecialCollection(); IList list = (IList)myspecialcollection;`

您是否考虑过让 IMySpecialCollection 实现 ISerializable 进行序列化？支持多种集合类型对我来说似乎有点不对劲。您可能还想查看将您的 IList 转换为 IEnumerable 以进行序列化，因为 IList 只是包装了 IEnumerable 和 ICollection。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-11-03T20:25:24.887

这是[我的问题的欺骗](https://stackoverflow.com/questions/1552456/icollection-vs-icollectiont-ambiguity-between-icollectiont-count-and-icollec)

总而言之，如果你这样做，它可以解决问题：

```
public Interface IMySpecialCollection : IList<MyObject>, IList
{
    new MyObject this[int index];
    ... 
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T16:53:18.817

不幸的是，您不能使用相同的参数列表声明两个索引器。以下段落摘自此处[C# Programming Guide - Using Indexers "Remarks" 部分](http://msdn.microsoft.com/en-us/library/2549tw02.aspx#languageReferenceRemarksToggle "C# 编程指南 - 使用索引器")：

> 索引器的签名由其形式参数的数量和类型组成。它不包括索引器类型或形式参数的名称。如果您在同一类中声明多个索引器，则它们必须具有不同的签名。

如果您希望使用第二个索引器，则必须声明一组不同的参数。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-11T17:00:40.670

将您的通用实现更改为...

```
T IList<T>.this[int index] { get; set; } 
```

这明确说明了哪个“这个”是哪个。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-09-11T16:44:51.583

List<T> 隐含 IList，因此在同一个类中使用两者是个坏主意。

# database - 我在哪里可以找到可以在多个数据库引擎中使用的具有通用格式数据的示例数据库？

> ID：57068
> 
> 赞同：69
> 
> 时间：2008-09-11T16:43:10.790
> 
> 标签：database, sample

有谁知道我可以下载的任何示例数据库，最好是 CSV 或类似的易于导入的格式，以便我可以在处理不同类型的数据集方面获得更多练习？

我知道加拿大环境部有可以下载的[历史天气数据。](http://www.climate.weatheroffice.ec.gc.ca/Welcome_e.html)但是，它不是我可以导入任何其他数据库的通用格式。而且，您只能根据包含的程序运行查询，实际上它可以提供什么样的数据非常有限。

有没有人知道任何有趣的数据集，这些数据集可以以我可以与 mySql、Sql Server 和其他类型的数据库引擎一起使用的通用格式免费获得？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-09-11T16:51:04.017

datawrangling 博客不久前发布了一个不错的列表：

[http://www.datawrangling.com/some-datasets-available-on-the-web](http://www.datawrangling.com/some-datasets-available-on-the-web)

包括财务、政府数据（劳动力、住房等）等等，这里就不一一列举了。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-07-17T23:39:47.440

Stack Overflow 中的许多数据都在 create commons 下获得许可。他们每 3 个月发布一次包含所有问题、答案、评论和投票的[数据转储。](https://blog.stackoverflow.com/category/cc-wiki-dump/)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-11T16:46:17.103

对于 Microsoft SQL Server，有[Northwind Sample DB](http://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46A0-8DA2-EEBC53A68034&displaylang=en)和[AdventureWorks](http://msdn.microsoft.com/en-us/library/ms124659.aspx)。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-11-26T20:28:58.303

[对于 MySQL，在http://dev.mysql.com/doc/index-other.html](http://dev.mysql.com/doc/index-other.html)上有很多示例数据库

1.  世界（世界国家和城市）
2.  sakila（视频出租）
3.  员工
4.  动物园

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2014-04-24T11:58:49.273

我使用[generateata.com](http://www.generatedata.com/)生成带有条目的自定义数据库方案。

要使用它，您只需注册一个新帐户，或下载其源代码并将其安装在您的服务器上。

您可以使用 SQL、XML、JSON 甚至服务器端脚本语言（如 php 等）导出生成的代码。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-11T16:53:59.843

[UnData](http://data.un.org/)和[Swivel](http://www.swivel.com/)都是很好的数据来源。任何数据库都应该能够导入 CSV 文件。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-11T16:46:09.083

您要导入哪个数据库引擎？这将有助于确定您可以在搜索中包含哪些格式。

联邦[能源管理](http://www.ferc.gov/docs-filing/eqr/soft-tools/sample-csv.asp)委员会有一些 CSV 格式的样本数据可供下载。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-11-27T22:12:26.653

英国的《卫报》有一个数据存储区[http://www.guardian.co.uk/data-store](http://www.guardian.co.uk/data-store)，里面充满了分类的数据集。它们最终都存储为 Google 文档，因此您可以将它们导出为 csv 和 Excel。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2010-02-22T02:28:33.350

CodePlex 上有一大堆免费的 SQL Server 示例数据库：http: [//www.codeplex.com/Wikipage? ProjectName=SqlServerSamples#databases](http://www.codeplex.com/Wikipage?ProjectName=SqlServerSamples#databases)

获取样本数据的一种非常简单的方法是使用完整的应用程序。我需要一些示例数据来练习我当时使用 MySQL 学习的内容，我刚刚下载了 PHPBB 并使用了他们提供的数据库。如果您需要添加用户等，只需使用该程序即可。

认为通用。您可以免费从常见来源获取天气数据，thetvdb.com 有一组非常漂亮的免费电视节目数据集，last.fm 等网站有大量可用于音乐收听习惯的数据。如果您只想要示例数据，那么获取它的最简单方法不是考虑“我想要一个数据库”。想想“那里有什么免费可用的数据”。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2012-12-17T13:55:10.160

对于 FileMaker，请参阅示例数据库： [http ://www.yzysoft.com/printouts/yzy_soft___Sample_Database.html](http://www.yzysoft.com/printouts/yzy_soft___Sample_Database.html)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-11T16:53:00.470

您可能可以找到 SQLServer 的 Northwind 示例数据库

这可能有点矫枉过正，但您可以[安装 OracleXE](http://www.oracle.com/technology/products/database/xe/index.html)，我认为它带有一些示例模式，或者您可以在线找到旧的 Scott 模式。

此外，在 stephen bohlen 的[Summer of NHibernate](http://summerofnhibernate.com/)截屏系列中，他创建了一个示例数据库，代码随附在 xml 文件中，您可以像他在截屏视频中描述的那样导入它（可能是第 2 集或第 3 集），以后不要删除它.

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-11-27T21:57:42.523

对于 Firebird，你有 employee.fdb

在 Windows 操作系统上，它位于 C:\Program Files\Firebird\Firebird_2_1\examples\empbuild

# excel - 如何在 Outlook 2007 中为 VBA 宏分配键盘快捷键？

> ID：57075
> 
> 赞同：5
> 
> 时间：2008-09-11T16:45:38.430
> 
> 标签：excel, outlook, keyboard-shortcuts, vba

如何在 Outlook 2007 中为 VBA 宏分配键盘快捷键？

我知道如何为宏创建一个工具并将其放入带有下划线快捷方式的菜单中。此解决方案需要我使用`Alt`++的`{menu key}`快捷方式`{tool key}`。如果我想将它分配给`Alt`+`F12`或类似的东西怎么办？

Visual Basic 编辑器分配给 Outlook 2007 中的键盘快捷键`Alt`+ `F11`。我想将类似的键盘快捷键分配给宏，或者如果需要，将宏分配给菜单或工具栏中的工具上的宏。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-11T17:45:07.023

由于 Outlook 没有 OnKey 事件，最简单的方法是为宏分配一个工具栏按钮，并在其名称中的某处放置一个 & 符号。这仅在您的快捷方式字母与现有快捷方式不冲突时才有效。

您可能还可以设置全局热键，但它通常更痛苦而不值得：

[http://www.mvps.org/vbvision/_samples/HotKey_Demo.zip](http://www.mvps.org/vbvision/_samples/HotKey_Demo.zip)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-27T15:50:55.983

MSDN中的[Do-It-Yourself IntelliSense](http://msdn.microsoft.com/en-us/library/aa155749(office.10).aspx)一文提供了有关 VBA 中键绑定的出色信息。

# html - 如何定位 DIV 以填充页眉 DIV 和页脚 DIV 之间的所有可用空间？

> ID：57091
> 
> 赞同：8
> 
> 时间：2008-09-11T16:59:29.863
> 
> 标签：html, css

假设我有一个父 DIV。在内部，有三个子 DIV：页眉、内容和页脚。标题附加到父级的顶部并水平填充。页脚附加到父级的底部并水平填充它。内容应该填充页眉和页脚之间的所有空间。

父级必须具有固定的宽度和高度。内容 DIV 必须填充页眉和页脚之间的所有可用空间。当内容 DIV 的内容大小超过页眉和页脚之间的空间时，***内容 DIV 应显示滚动条并允许适当***的滚动，这样页脚内容不会被遮挡，页脚内容也不会被遮挡。

现在是困难的部分：***您事先不知道页眉和页脚的高度***（例如，页眉和页脚是动态填充的）。如何在***不使用 JavaScript***的情况下定位内容？

例子：

```
<div style="position : relative; width : 200px; height : 200px; background-color : #e0e0ff; overflow : hidden;">
    <div style="background-color: #80ff80; position : absolute; left : 0; right : 0; top : 0;">
    header 
    </div>
    <div style="background-color: #8080ff; overflow : auto; position : absolute;">
    content (how to position it?)
    </div>
    <div style="background-color: #ff8080; position : absolute; bottom : 0px; left :0; right : 0;">
    footer 
    </div>    
</div> 
```

* * *

**为了进一步澄清这个事件**- 我试图实现的目标布局将用于业务 Web 应用程序。***父 DIV 将具有固定但未知的大小***（例如，它将与浏览器视口的大小完全一致，同时调整自身大小以及用户调整浏览器窗口的大小）。让我们将父 DIV 称为“屏幕”。

标题将包含一组过滤控件（如文本框、下拉列表和“过滤”按钮），如果水平空间不足，它们应该换行到下一行（因此它的高度可以随时更改以适应换行）。***标题应始终可见并附加到***“屏幕”的顶部。

页脚将包含一组按钮，就像在对话窗口上一样。如果水平空间不足，这些也可以换行到下一行。***页脚必须附加到***“屏幕”的底部，以便始终可以访问和可见。

内容将包含“屏幕”内容，如对话框字段等。如果字段太少，则其余内容将为“空白”（在这种情况下，页脚不应在内容之后立即开始，但仍附加到固定大小的“屏幕”底部）。如果字段太多，***则内容 DIV 将提供滚动条***来访问隐藏的控件（在这种情况下，内容 DIV 不得将自身扩展到页脚下方，因为滚动条将被部分隐藏）。

我希望这能进一步澄清这个问题，因为我的代表太低，无法对您的回复发表评论。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-11T17:34:26.987

我将为此进行降级，但这听起来像是一张桌子的工作。

您要做的是将三个连续 div 的总高度设置为一个单位，而高度为 100% 的 1x3 表实际上是一种更清洁的解决方案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-02-24T01:05:00.567

## 纯 CSS 解决方案 1 - Flexbox：

`display: flex;`您可以使用 CSS3属性创建一列以这种方式运行的 div （[请参阅 W3 规范](http://www.w3.org/TR/css3-flexbox/)）

使用包装器，您可以将列中的所有内容与`flex-direction: column;`声明对齐，然后用`justify content: space-between;`and填充垂直空间`height: 100vh;`。然后你需要做的就是让你的内容元素扩展`flex: 1 0 0;`并给它一个滚动条`overflow-y: auto;`。

***关于浏览器支持***的注意事项 - 虽然大多数现代浏览器都支持 flexbox，但仍有一些限制（参见： [http](http://caniuse.com/#feat=flexbox) ://caniuse.com/#feat=flexbox ）。我建议使用`-webkit-`and`-ms-`前缀。

* * *

**工作示例**：请参阅以下代码片段和此[jsfiddle](http://jsfiddle.net/4LxaP/18/)。

```
body {
    display: -webkit-flex; /* Safari 6.1+ */
    display: -ms-flex; /* IE 10 */ 
    display: flex;
    -webkit-flex-direction: column; /* Safari 6.1+ */
    -ms-flex-direction: column; /* IE 10 */
    flex-direction: column;
    -webkit-justify-content: space-between; /* Safari 6.1+ */
    -ms-justify-content: space-between; /* IE 10 */
    justify-content: space-between; /* Header top, footer bottom */
    height: 100vh;  /* Fill viewport height */
}
main {
    -webkit-flex: 1 0 0; /* Safari 6.1+ */
    -ms-flex: 1 0 0; /* IE 10 */
    flex: 1 0 0; /* Grow to fill space */
    overflow-y: auto; /* Add scrollbar */
    height: 100%; /* Needed to fill space in IE */
}
header, footer {
    -webkit-flex: 0 0 auto; /* Safari 6.1+ */
    -ms-flex: 0 0 auto; /* IE 10 */
    flex: 0 0 auto;
}

/* Make it look a little nicer */
body {
    margin: 0;
    background-color: #8080ff;
}
header {
    background-color: #80ff80; 
}
footer {
    background-color: #ff8080;
}
p {
    margin: 1.25rem;
}
```

```
<body>
    <header>
        <p>header</p> 
    </header>
    <main>
        <article>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nullam pellentesque lobortis augue, in porta arcu dapibus dapibus. Suspendisse vulputate tempus venenatis. Pellentesque ac euismod urna. Donec dui odio, ullamcorper in posuere eu, laoreet sed nisl. Sed vitae vestibulum leo. Maecenas mattis lacus eget nisl malesuada, quis semper urna ornare. Praesent id mauris nec neque aliquet dignissim.</p>
                            <p>Morbi varius dolor at lorem aliquet lacinia. Aliquam id lacinia quam. Sed vel libero felis. Etiam et pellentesque sem. Aenean bibendum, ante quis luctus tincidunt, elit mauris volutpat nisi, et tempus lectus sapien in mauris. Aliquam condimentum nisl ut elit accumsan hendrerit. Morbi mollis turpis est, id tincidunt ipsum rhoncus eget. Fusce in feugiat lacus. Quisque vel massa magna. Mauris varius congue nisl, vitae pellentesque diam ultricies at. Sed ac nibh ac diam tristique venenatis non nec nisl. Vivamus enim eros, pretium at iaculis nec, pharetra non sem. Aenean ac imperdiet odio.</p>
                            <p>Morbi varius dolor at lorem aliquet lacinia. Aliquam id lacinia quam. Sed vel libero felis. Etiam et pellentesque sem. Aenean bibendum, ante quis luctus tincidunt, elit mauris volutpat nisi, et tempus lectus sapien in mauris. Aliquam condimentum nisl ut elit accumsan hendrerit. Morbi mollis turpis est, id tincidunt ipsum rhoncus eget. Fusce in feugiat lacus. Quisque vel massa magna. Mauris varius congue nisl, vitae pellentesque diam ultricies at. Sed ac nibh ac diam tristique venenatis non nec nisl. Vivamus enim eros, pretium at iaculis nec, pharetra non sem. Aenean ac imperdiet odio.</p>
        </article>
    </main>
    <footer>
        <p>footer</p> 
    </footer>
</body>
```

* * *

**有关如何使用 flexbox 的更多信息，请参阅以下指南：**

*   [https://developer.mozilla.org/en-US/docs/Web/Guide/CSS/Flexible_boxes](https://developer.mozilla.org/en-US/docs/Web/Guide/CSS/Flexible_boxes)
*   [https://css-tricks.com/snippets/css/a-guide-to-flexbox/](https://css-tricks.com/snippets/css/a-guide-to-flexbox/)

* * *

* * *

## 纯 CSS 解决方案 2 - 显示表格 [旧解决方案]：

这也可以通过使用 CSS`display: table;`属性来完成（[请参阅 W3 规范](http://www.w3schools.com/cssref/pr_class_display.asp)）。

**的HTML：**

```
<div id="screen">
    <div id="header"></div>
    <div id="content">
        <div id="content_frame">
            <div id="content_wrap"></div>
        </div>
    </div>
    <div id="footer"></div>
</div> 
```

**CSS：**

```
html, body, #screen, #content, #content_frame {
    height: 100%; /* Make #screen viewport height and #content fill space */
}
#screen {
    display: table;
}
#header, #content, #footer {
    display: table-row;
}
#content_frame {
    overflow-y: auto; /* Add scrollbar */
    position: relative;
}
#content_wrap {
    position: absolute; /* Fix problem with overflow in FF */
} 
```

溢出属性对 css 表格元素及其子元素不可靠，因此我不得不嵌套内容。在这种情况下，我被迫嵌套两次并使用`position: absolute;`它以使其在 Firefox 中工作。也许其他人可以想出一个更优雅的解决方案来避免这种“divitis”。

这是一个正常运行的**[jsfiddle](http://jsfiddle.net/4LxaP/3/)**。

***警告：***这在 Opera 12 中似乎不起作用！内容 div 占据了父级高度的 100%，这会导致行溢出表格（就像他们在 Firefox 中所做的那样）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-12T12:18:32.527

如果您可以避免主要内容可滚动，您最好使用[footerStickAlt](http://www.themaninblue.com/writing/perspective/2005/08/29/)方法来确保您的页脚停留在屏幕底部或内容底部（如果内容超出屏幕底部）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-11T21:00:40.453

你需要让中心 div 改变大小吗？如果您只是想确保它的背景 (#8080ff) 出现在页眉和页脚之间，为什么不将包含 div 的背景设为 #8080ff。页眉和页脚背景将覆盖它，而 div 的其余背景将是正确的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-11T17:17:58.540

绝对定位把你搞砸了。尝试这样的事情：

HTML：

```
<div id="wrapper">
 <div id="header">
  header
 </div>
 <div id="content">
  content
 </div>
 <div id="footer">
  footer
 </div>
</div> 
```

CSS：

```
#wrapper {
  width: 200px;
  height: 200px;
  overflow: visible;
  background: #e0e0ff;
}
#header {
  background: #80ff80;
}
#content {
  background: #8080ff;
}
#footer {
  background: #ff8080;
} 
```

编辑：也许我误解了，你想让所有东西都适合 200x200px 的盒子还是你想让盒子增加它的高度以适应内容？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-11T17:18:55.197

父母是否需要保持固定高度？

```
<div style="position : relative; width : 200px; background-color : #e0e0ff; overflow : hidden;">
<div style="float: left; clear: left; background-color: #80ff80;">
header 
</div>
<div style="float: left; clear: left; background-color: #8080ff; overflow : auto; ">
content (how to position it?)
<BR />taller
<BR />taller
<BR />taller
<BR />taller
<BR />taller
<BR />taller
<BR />taller
<BR />taller
</div>
<div style="float: left; clear: left; background-color: #ff8080;">
footer 
<BR />taller
</div> 
```

如果父级的高度是固定的，这是我知道的最接近它的方法——如果这些色块（而不只是文本）真的很重要并且不仅仅是为了说明，那么仍然不完全正确DIV 的边界：

```
<div style="position : relative; width : 200px; height : 200px; background-color : #e0e0ff; overflow : hidden;">
<div style="float: left; clear: left; background-color: #80ff80; ">
header <BR .> taller
</div>
<div style="float: left; clear: left; background-color: #8080ff; overflow : auto; ">
content (how to position it?)<BR /> and another line
</div>
<div style="background-color: #ff8080; position : absolute; bottom : 0px; left :0; right : 0;">
footer <BR /> taller
</div> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-09-17T09:37:38.937

这可以通过使用不同的技术来解决。第一个是使用媒体查询。使用它们，您可以定义每种屏幕尺寸的页面外观。其次，有几种技术可以正确定位页脚（粘性页脚）。第三，您可以使用不同的表格样式或 flexbox 方法来正确定位您的内容。

# c# - 如何使用 C# 以编程方式运行 ASP.Net 开发服务器？

> ID：57094
> 
> 赞同：12
> 
> 时间：2008-09-11T17:00:47.927
> 
> 标签：c#, asp.net

我有 ASP.NET 网页，我想为其构建自动化测试（使用 WatiN 和 MBUnit）。如何从我的代码启动 ASP.Net 开发服务器？我不想使用 IIS。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-11T23:20:20.477

这就是我使用的有效方法：

```
using System;
using System.Diagnostics;
using System.Web;
...

// settings
string PortNumber = "1162"; // arbitrary unused port #
string LocalHostUrl = string.Format("http://localhost:{0}", PortNumber);
string PhysicalPath = Environment.CurrentDirectory //  the path of compiled web app
string VirtualPath = "";
string RootUrl = LocalHostUrl + VirtualPath;                 

// create a new process to start the ASP.NET Development Server
Process process = new Process();

/// configure the web server
process.StartInfo.FileName = HttpRuntime.ClrInstallDirectory + "WebDev.WebServer.exe";
process.StartInfo.Arguments = string.Format("/port:{0} /path:\"{1}\" /virtual:\"{2}\"", PortNumber, PhysicalPath, VirtualPath);
process.StartInfo.CreateNoWindow = true;
process.StartInfo.UseShellExecute = false;

// start the web server
process.Start();

// rest of code... 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-11T17:09:06.313

据我所知，您可以使用以下路径/语法从命令提示符启动开发服务器：

```
C:\Windows\Microsoft.NET\Framework\v2.0.50727\Webdev.WebServer.exe /port:[PORT NUMBER] /path: [PATH TO ROOT] 
```

...所以我可以想象你可以很容易地使用 Process.Start() 通过一些代码来启动你需要的细节。

自然，您会希望将该版本号调整为您最近/想要的任何版本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-11-07T20:17:13.543

在@Ray Vega 的有用答案和@James McLachlan 对VS2010 的重要更新的基础上，这是我的实现，以涵盖VS2012 并在必要时回退到VS2010。我还选择不只在 Environment.Is64BitOperatingSystem 上选择，因为它在我的系统上出错了。也就是说，我有一个 64 位系统，但 Web 服务器位于 32 位文件夹中。因此，我的代码首先查找 64 位文件夹，并在必要时回退到 32 位文件夹。

```
public void LaunchWebServer(string appWebDir)
{
    var PortNumber = "1162"; // arbitrary unused port #
    var LocalHostUrl = string.Format("http://localhost:{0}", PortNumber);
    var VirtualPath = "/";

    var exePath = FindLatestWebServer();

    var process = new Process
    {
        StartInfo =
        {
            FileName = exePath,
            Arguments = string.Format(
                "/port:{0} /nodirlist /path:\"{1}\" /virtual:\"{2}\"",
                PortNumber, appWebDir, VirtualPath),
            CreateNoWindow = true,
            UseShellExecute = false
        }
    };
    process.Start();
}

private string FindLatestWebServer()
{
    var exeCandidates = new List<string>
    {
        BuildCandidatePaths(11, true), // vs2012
        BuildCandidatePaths(11, false),
        BuildCandidatePaths(10, true), // vs2010
        BuildCandidatePaths(10, false)
    };
    return exeCandidates.Where(f => File.Exists(f)).FirstOrDefault();
}

private string BuildCandidatePaths(int versionNumber, bool isX64)
{
    return Path.Combine(
        Environment.GetFolderPath(isX64
            ? Environment.SpecialFolder.CommonProgramFiles
            : Environment.SpecialFolder.CommonProgramFilesX86),
        string.Format(
            @"microsoft shared\DevServer\{0}.0\WebDev.WebServer40.EXE",
            versionNumber));
} 
```

我希望有见识的读者能够为 VS2013 提供适当的咒语，因为它显然使用了不同的方案......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-07-26T08:44:57.887

You can easily use **Process Explorer** to find complete command line options needed for manually start it. Start Process Explorer while debugging your website. For VS2012, expand 'devenv.exe' node. Right-click on 'WebDev.WebServer20.exe' and from there you can see Path and Command Line values.

# java - 嵌入式java数据库

> ID：57102
> 
> 赞同：43
> 
> 时间：2008-09-11T17:07:37.660
> 
> 标签：java, database, embedded-database

我想获得有关 Java 中的嵌入式数据库的意见或建议。我特别关注 H2、HSQLDB 和 Derby。你在生产项目中使用过这些吗？你有意见或建议选择一个而不是其他的吗？

谢谢

**编辑：**我目前正在评估这些选项以在我们的内部开发中使用，因此我没有考虑特定的用例。我正在评估它们的可能用途之一是将数据库用作本地存储库的桌面应用程序。在某些时候，它会与中央存储库（在本例中为 DB2）同步。它是一种存储转发架构。无论如何，这只是指导您回答的一种可能性，基本上我正在寻找您使用这些工具的经验。

# ruby-on-rails - Rails 二进制流支持

> ID：57104
> 
> 赞同：15
> 
> 时间：2008-09-11T17:08:27.143
> 
> 标签：ruby-on-rails, blob

我将很快开始一个需要支持大型二进制文件的项目。我想为 webapp 使用 Ruby on Rails，但我担心 BLOB 支持。根据我使用其他语言、框架和数据库的经验，BLOB 经常被忽视，因此功能很差、困难和/或有缺陷。

RoR 是否充分支持 BLOB？一旦你已经致力于 Rails，有没有什么陷阱？

顺便说一句：我想使用 PostgreSQL 和/或 MySQL 作为后端数据库。显然，底层数据库中的 BLOB 支持很重要。目前，我想避免关注数据库的 BLOB 功能；我对 Rails 本身的反应更感兴趣。理想情况下，Rails 应该对我隐藏数据库的详细信息，因此我应该能够从一个切换到另一个。如果*不是*这种情况（即：在特定数据库中使用 Rails 存在一些问题），请务必提及。

更新：另外，我不只是在这里谈论 ActiveRecord。我需要在 HTTP 端处理二进制文件（文件上传有效）。这意味着通过 Rails 访问适当的 HTTP 标头和流。我更新了问题标题和描述以反映这一点。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-12T05:46:47.350

至于流式传输，您可以以（至少内存）有效的方式完成所有操作。在上传端，表单中的文件参数被抽象为可以读取的 IO 对象；在下载端，查看`render :text =>`采用 Proc 参数的形式：

```
render :content_type => 'application/octet-stream', :text => Proc.new {
    |response, output|
    # do something that reads data and writes it to output
} 
```

但是，如果您的东西在磁盘上的文件中，那么上述解决方案肯定会更好。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-11T20:53:59.377

+1 附件_fu

我在我的一个应用程序中使用 attachment_fu 并且必须将文件存储在数据库中（出于烦人的原因，这超出了这个 convo 的范围）。

我发现处理 w/BLOB 的（一个？）棘手的事情是你需要一个单独的代码路径来将数据发送给用户——你不能像你想要的那样简单地在文件系统上内联一个路径是一个普通的简文件。

例如，如果您要存储头像信息，则不能简单地执行以下操作：

```
<%= image_tag @youruser.avatar.path %> 
```

您必须编写一些包装器逻辑并使用 send_data，例如（以下只是一个带有附件_fu 的示例，实际上您需要将其干燥）

```
send_data(@youruser.avatar.current_data, :type => @youruser.avatar.content_type, :filename => @youruser.avatar.filename, :disposition => 'inline' ) 
```

不幸的是，据我所知，attachment_fu（我没有最新版本）并没有为你做巧妙的包装——你必须自己写。

PS 看到你的问题编辑 - Attachment_fu 处理你提到的所有烦人的东西 - 关于需要知道文件路径和所有这些废话 - 除了存储在数据库中时的一个小问题。试试看; 它是 Rails 应用程序的标准。如果您坚持重新发明轮子，attachment_fu 的源代码也应该记录大部分问题！

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-11T17:53:43.913

您可以`:binary`在 ActiveRecord 迁移中使用该类型，还可以限制最大大小：

```
class BlobTest < ActiveRecord::Migration
  def self.up
    create_table :files do |t|
      t.column :file_data, :binary, :limit => 1.megabyte
    end
  end
end 
```

ActiveRecord 将 BLOB（或 CLOB）内容公开为 Ruby 字符串。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-11T17:13:53.230

我认为你最好的选择是 attachment_fu 插件：http: [//github.com/technoweenie/attachment_fu/tree/master](http://github.com/technoweenie/attachment_fu/tree/master)

更新：在这里找到更多信息[http://groups.google.com/group/rubyonrails-talk/browse_thread/thread/a81beffb93708bb3](http://groups.google.com/group/rubyonrails-talk/browse_thread/thread/a81beffb93708bb3)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-12T02:38:24.650

查看插件，[x_send_file](http://john.guen.in/rdoc/x_send_file/)也是。

“XSendFile 插件提供了一个简单的接口，用于通过 X-Sendfile HTTP 标头发送文件。这使您的 Web 服务器可以直接从磁盘提供文件，而不是通过 Rails 进程流式传输文件。这样更快并且节省了大量内存如果您使用的是 Mongrel。并非每个 Web 服务器都支持此标头。YMMV。

我不确定它是否可用于 Blob，它可能仅适用于文件系统上的文件。但是您可能需要一些不会占用 Web 服务器流式传输大量数据的东西。

# windows - 如何检测真正的 Windows 版本？

> ID：57124
> 
> 赞同：40
> 
> 时间：2008-09-11T17:21:31.370
> 
> 标签：windows, delphi, winapi, version

我知道我可以调用 GetVersionEx Win32 API 函数来检索 Windows 版本。在大多数情况下，返回值反映了我的 Windows 版本，但有时并非如此。

如果用户在兼容层下运行我的应用程序，则 GetVersionEx 不会报告真实版本，而是兼容层强制执行的版本。例如，如果我正在运行 Vista 并在“Windows NT 4”兼容模式下执行我的程序，GetVersionEx 不会返回 6.0 版本而是 4.0。

有没有办法绕过这种行为并获得真正的 Windows 版本？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-09-11T17:25:30.597

我知道的最好方法是检查是否从某个 DLL 导出了特定的 API。每个新的 Windows 版本都添加了新功能，通过检查这些功能的存在，我们可以知道应用程序在哪个操作系统上运行。例如，Vista 从 kernel32.dll 导出[GetLocaleInfoEx](http://msdn.microsoft.com/en-us/library/ms724451(VS.85).aspx)，而以前的 Windows 没有。

长话短说，这里有一个这样的列表，其中只包含 kernel32.dll 的导出。

```
> *功能：实现于*  
> GetLocaleInfoEx：Vista  
> GetLargePageMinimum：Vista、Server 2003  
获取DLL目录：Vista、Server 2003、XP SP1  
GetNativeSystemInfo：Vista、Server 2003、XP SP1、XP  
替换文件：Vista、Server 2003、XP SP1、XP、2000  
OpenThread：Vista、Server 2003、XP SP1、XP、2000、ME  
GetThreadPriorityBoost：Vista、Server 2003、XP SP1、XP、2000、NT 4  
IsDebuggerPresent：Vista、Server 2003、XP SP1、XP、2000、ME、NT 4、98   
GetDiskFreeSpaceEx：Vista、Server 2003、XP SP1、XP、2000、ME、NT 4、98、95 OSR2  
ConnectNamedPipe：Vista、Server 2003、XP SP1、XP、2000、NT 4、NT 3  
哔声：Vista、Server 2003、XP SP1、XP、2000、ME、98、95 OSR2、95  

```

编写确定真实操作系统版本的函数很简单；只需从最新的操作系统到最旧的操作系统，并使用[GetProcAddress](http://msdn.microsoft.com/en-us/library/ms683212.aspx)检查导出的 API。用任何语言实现这一点都应该是微不足道的。

Delphi 中的以下代码是从免费的[DSiWin32](http://gp.17slon.com/gp/dsiwin32.htm)库中提取的）：

```
TDSiWindowsVersion = (wvUnknown, wvWin31, wvWin95, wvWin95OSR2, wvWin98,
  wvWin98SE, wvWinME, wvWin9x, wvWinNT3, wvWinNT4, wvWin2000, wvWinXP,
  wvWinNT, wvWinServer2003, wvWinVista);

function DSiGetWindowsVersion: TDSiWindowsVersion;
var
  versionInfo: TOSVersionInfo;
begin
  versionInfo.dwOSVersionInfoSize := SizeOf(versionInfo);
  GetVersionEx(versionInfo);
  Result := wvUnknown;
  case versionInfo.dwPlatformID of
    VER_PLATFORM_WIN32s: Result := wvWin31;
    VER_PLATFORM_WIN32_WINDOWS:
      case versionInfo.dwMinorVersion of
        0:
          if Trim(versionInfo.szCSDVersion[1]) = 'B' then
            Result := wvWin95OSR2
          else
            Result := wvWin95;
        10:
          if Trim(versionInfo.szCSDVersion[1]) = 'A' then
            Result := wvWin98SE
          else
            Result := wvWin98;
        90:
          if (versionInfo.dwBuildNumber = 73010104) then
             Result := wvWinME;
           else
             Result := wvWin9x;
      end; //case versionInfo.dwMinorVersion
    VER_PLATFORM_WIN32_NT:
      case versionInfo.dwMajorVersion of
        3: Result := wvWinNT3;
        4: Result := wvWinNT4;
        5:
          case versionInfo.dwMinorVersion of
            0: Result := wvWin2000;
            1: Result := wvWinXP;
            2: Result := wvWinServer2003;
            else Result := wvWinNT
          end; //case versionInfo.dwMinorVersion
        6: Result := wvWinVista;
      end; //case versionInfo.dwMajorVersion
    end; //versionInfo.dwPlatformID
end; { DSiGetWindowsVersion }

function DSiGetTrueWindowsVersion: TDSiWindowsVersion;

  function ExportsAPI(module: HMODULE; const apiName: string): boolean;
  begin
    Result := GetProcAddress(module, PChar(apiName)) <> nil;
  end; { ExportsAPI }

var
  hKernel32: HMODULE;

begin { DSiGetTrueWindowsVersion }
  hKernel32 := GetModuleHandle('kernel32');
  Win32Check(hKernel32 <> 0);
  if ExportsAPI(hKernel32, 'GetLocaleInfoEx') then
    Result := wvWinVista
  else if ExportsAPI(hKernel32, 'GetLargePageMinimum') then
    Result := wvWinServer2003
  else if ExportsAPI(hKernel32, 'GetNativeSystemInfo') then
    Result := wvWinXP
  else if ExportsAPI(hKernel32, 'ReplaceFile') then
    Result := wvWin2000
  else if ExportsAPI(hKernel32, 'OpenThread') then
    Result := wvWinME
  else if ExportsAPI(hKernel32, 'GetThreadPriorityBoost') then
    Result := wvWinNT4
  else if ExportsAPI(hKernel32, 'IsDebuggerPresent') then  //is also in NT4!
    Result := wvWin98
  else if ExportsAPI(hKernel32, 'GetDiskFreeSpaceEx') then  //is also in NT4!
    Result := wvWin95OSR2
  else if ExportsAPI(hKernel32, 'ConnectNamedPipe') then
    Result := wvWinNT3
  else if ExportsAPI(hKernel32, 'Beep') then
    Result := wvWin95
  else // we have no idea
    Result := DSiGetWindowsVersion;
end; { DSiGetTrueWindowsVersion } 
```

--- 更新于 2009-10-09

事实证明，在 Vista SP1 及更高版本上进行“未记录的”操作系统检测变得非常困难。查看[API 更改](http://msdn.microsoft.com/en-us/library/aa383687(VS.85).aspx)可以看出，所有 Windows 2008 功能也在 Vista SP1 中实现，所有 Windows 7 功能也在 Windows 2008 R2 中实现。太糟糕了 ：（

--- 更新结束

FWIW，这是我在实践中遇到的一个问题。我们（我工作的公司）有一个程序，当 Vista 发布时（以及在那之后的几个星期......），它并没有真正准备好 Vista。它也不能在兼容层下工作。（一些 DirectX 问题。不要问。）

我们根本不希望太聪明的用户在 Vista 上运行这个应用程序 - 是否兼容模式 - 所以我必须找到一个解决方案（一个比我聪明的人为我指明了正确的方向；上面的东西不是我的创意）。现在我发布它是为了您的快乐，并帮助所有将来必须解决这个问题的可怜的灵魂。谷歌，请索引这篇文章！

如果您有更好的解决方案（或我的升级和/或修复），请在此处发布答案...

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2008-09-11T17:24:24.717

WMI 查询：

```
"Select * from Win32_OperatingSystem" 
```

编辑：实际上更好的是：

```
"Select Version from Win32_OperatingSystem" 
```

你可以像这样在 Delphi 中实现它：

```
function OperatingSystemDisplayName: string;

  function GetWMIObject(const objectName: string): IDispatch;
  var
    chEaten: Integer;
    BindCtx: IBindCtx;
    Moniker: IMoniker;
  begin
    OleCheck(CreateBindCtx(0, bindCtx));
    OleCheck(MkParseDisplayName(BindCtx, PChar(objectName), chEaten, Moniker));
    OleCheck(Moniker.BindToObject(BindCtx, nil, IDispatch, Result));
  end;

  function VarToString(const Value: OleVariant): string;
  begin
    if VarIsStr(Value) then begin
      Result := Trim(Value);
    end else begin
      Result := '';
    end;
  end;

  function FullVersionString(const Item: OleVariant): string;
  var
    Caption, ServicePack, Version, Architecture: string;
  begin
    Caption := VarToString(Item.Caption);
    ServicePack := VarToString(Item.CSDVersion);
    Version := VarToString(Item.Version);
    Architecture := ArchitectureDisplayName(SystemArchitecture);
    Result := Caption;
    if ServicePack <> '' then begin
      Result := Result + ' ' + ServicePack;
    end;
    Result := Result + ', version ' + Version + ', ' + Architecture;
  end;

var
  objWMIService: OleVariant;
  colItems: OleVariant;
  Item: OleVariant;
  oEnum: IEnumvariant;
  iValue: LongWord;

begin
  Try
    objWMIService := GetWMIObject('winmgmts:\\localhost\root\cimv2');
    colItems := objWMIService.ExecQuery('SELECT Caption, CSDVersion, Version FROM Win32_OperatingSystem', 'WQL', 0);
    oEnum := IUnknown(colItems._NewEnum) as IEnumVariant;
    if oEnum.Next(1, Item, iValue)=0 then begin
      Result := FullVersionString(Item);
      exit;
    end;
  Except
    // yes, I know this is nasty, but come what may I want to use the fallback code below should the WMI code fail
  End;

  (* Fallback, relies on the deprecated function GetVersionEx, reports erroneous values
     when manifest does not contain supportedOS matching the executing system *)
  Result := TOSVersion.ToString;
end; 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-11T17:37:18.803

如何获取系统文件的版本？

最好的文件是 kernel32.dll，位于 %WINDIR%\System32\kernel32.dll。

有获取文件版本的 API。例如：我使用的是 Windows XP ->“5.1.2600.5512 (xpsp.080413-2111)”

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-11T18:49:59.550

另一种解决方案：

阅读以下注册表项：

```
HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProductName 
```

或其他键

```
HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2014-06-21T20:16:43.823

真实版本存储在进程信息的 PEB 块上。

Win32 应用程序示例（Delphi 代码）

```
unit RealWindowsVerUnit;

interface

uses
  Windows;

var
  //Real version Windows
  Win32MajorVersionReal: Integer;
  Win32MinorVersionReal: Integer;

implementation

type
  PPEB=^PEB;
  PEB = record
    InheritedAddressSpace: Boolean;
    ReadImageFileExecOptions: Boolean;
    BeingDebugged: Boolean;
    Spare: Boolean;
    Mutant: Cardinal;
    ImageBaseAddress: Pointer;
    LoaderData: Pointer;
    ProcessParameters: Pointer; //PRTL_USER_PROCESS_PARAMETERS;
    SubSystemData: Pointer;
    ProcessHeap: Pointer;
    FastPebLock: Pointer;
    FastPebLockRoutine: Pointer;
    FastPebUnlockRoutine: Pointer;
    EnvironmentUpdateCount: Cardinal;
    KernelCallbackTable: PPointer;
    EventLogSection: Pointer;
    EventLog: Pointer;
    FreeList: Pointer; //PPEB_FREE_BLOCK;
    TlsExpansionCounter: Cardinal;
    TlsBitmap: Pointer;
    TlsBitmapBits: array[0..1] of Cardinal;
    ReadOnlySharedMemoryBase: Pointer;
    ReadOnlySharedMemoryHeap: Pointer;
    ReadOnlyStaticServerData: PPointer;
    AnsiCodePageData: Pointer;
    OemCodePageData: Pointer;
    UnicodeCaseTableData: Pointer;
    NumberOfProcessors: Cardinal;
    NtGlobalFlag: Cardinal;
    Spare2: array[0..3] of Byte;
    CriticalSectionTimeout: LARGE_INTEGER;
    HeapSegmentReserve: Cardinal;
    HeapSegmentCommit: Cardinal;
    HeapDeCommitTotalFreeThreshold: Cardinal;
    HeapDeCommitFreeBlockThreshold: Cardinal;
    NumberOfHeaps: Cardinal;
    MaximumNumberOfHeaps: Cardinal;
    ProcessHeaps: Pointer;
    GdiSharedHandleTable: Pointer;
    ProcessStarterHelper: Pointer;
    GdiDCAttributeList: Pointer;
    LoaderLock: Pointer;
    OSMajorVersion: Cardinal;
    OSMinorVersion: Cardinal;
    OSBuildNumber: Cardinal;
    OSPlatformId: Cardinal;
    ImageSubSystem: Cardinal;
    ImageSubSystemMajorVersion: Cardinal;
    ImageSubSystemMinorVersion: Cardinal;
    GdiHandleBuffer: array [0..33] of Cardinal;
    PostProcessInitRoutine: Cardinal;
    TlsExpansionBitmap: Cardinal;
    TlsExpansionBitmapBits: array [0..127] of Byte;
    SessionId: Cardinal;
  end;

//Get PEB block current win32 process
function GetPDB: PPEB; stdcall;
asm
  MOV EAX, DWORD PTR FS:[30h]
end;

initialization
  //Detect true windows wersion
  Win32MajorVersionReal := GetPDB^.OSMajorVersion;
  Win32MinorVersionReal := GetPDB^.OSMinorVersion;
end. 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2015-07-31T23:37:38.100

以下适用于我在 Windows 10 中没有在应用程序清单中列出的 Windows 10 GUID：

```
uses
  System.SysUtils, Winapi.Windows;

type
  NET_API_STATUS = DWORD;

  _SERVER_INFO_101 = record
    sv101_platform_id: DWORD;
    sv101_name: LPWSTR;
    sv101_version_major: DWORD;
    sv101_version_minor: DWORD;
    sv101_type: DWORD;
    sv101_comment: LPWSTR;
  end;
  SERVER_INFO_101 = _SERVER_INFO_101;
  PSERVER_INFO_101 = ^SERVER_INFO_101;
  LPSERVER_INFO_101 = PSERVER_INFO_101;

const
  MAJOR_VERSION_MASK = $0F;

function NetServerGetInfo(servername: LPWSTR; level: DWORD; var bufptr): NET_API_STATUS; stdcall; external 'Netapi32.dll';
function NetApiBufferFree(Buffer: LPVOID): NET_API_STATUS; stdcall; external 'Netapi32.dll';

type
  pfnRtlGetVersion = function(var RTL_OSVERSIONINFOEXW): LONG; stdcall;
var
  Buffer: PSERVER_INFO_101;
  ver: RTL_OSVERSIONINFOEXW;
  RtlGetVersion: pfnRtlGetVersion;
begin
  Buffer := nil;

  // Win32MajorVersion and Win32MinorVersion are populated from GetVersionEx()...
  ShowMessage(Format('GetVersionEx: %d.%d', [Win32MajorVersion, Win32MinorVersion])); // shows 6.2, as expected per GetVersionEx() documentation

  @RtlGetVersion := GetProcAddress(GetModuleHandle('ntdll.dll'), 'RtlGetVersion');
  if Assigned(RtlGetVersion) then
  begin
    ZeroMemory(@ver, SizeOf(ver));
    ver.dwOSVersionInfoSize := SizeOf(ver);

    if RtlGetVersion(ver) = 0 then
      ShowMessage(Format('RtlGetVersion: %d.%d', [ver.dwMajorVersion, ver.dwMinorVersion])); // shows 10.0
  end;

  if NetServerGetInfo(nil, 101, Buffer) = NO_ERROR then
  try
    ShowMessage(Format('NetServerGetInfo: %d.%d', [Buffer.sv101_version_major and MAJOR_VERSION_MASK, Buffer.sv101_version_minor])); // shows 10.0
  finally
    NetApiBufferFree(Buffer);
  end;
end. 
```

**更新**：`NetWkstaGetInfo()`可能也可以工作，类似于“NetServerGetInfo()”，但我还没有尝试过。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-11-14T15:33:08.600

**注意：** Gabr 正在询问一种可以绕过`GetVersionEx`. JCL 代码使用 GetVersionEx，因此受兼容层的约束。此信息仅适用于不需要绕过兼容层的人。

使用 Jedi JCL，您可以添加单元 JclSysInfo，并调用函数`GetWindowsVersion`。它返回一个枚举类型 TWindowsVersion。

目前，JCL 包含所有已发布的 Windows 版本，并且每次 Microsoft 在一个盒子中发布新版本的 Windows 时都会更改：

```
 TWindowsVersion =
   (wvUnknown, wvWin95, wvWin95OSR2, wvWin98, wvWin98SE, wvWinME,
    wvWinNT31, wvWinNT35, wvWinNT351, wvWinNT4, wvWin2000, wvWinXP,
    wvWin2003, wvWinXP64, wvWin2003R2, wvWinVista, wvWinServer2008,
    wvWin7, wvWinServer2008R2); 
```

如果您想知道您运行的是 64 位 Windows 7 而不是 32 位，请调用`JclSysInfo.IsWindows64`.

请注意，JCL 也处理版本，如 Pro、Ultimate 等。对于该调用 GetWindowsEdition，它返回以下之一：

```
TWindowsEdition =
   (weUnknown, weWinXPHome, weWinXPPro, weWinXPHomeN, weWinXPProN, weWinXPHomeK,
    weWinXPProK, weWinXPHomeKN, weWinXPProKN, weWinXPStarter, weWinXPMediaCenter,
    weWinXPTablet, weWinVistaStarter, weWinVistaHomeBasic, weWinVistaHomeBasicN,
    weWinVistaHomePremium, weWinVistaBusiness, weWinVistaBusinessN,
    weWinVistaEnterprise, weWinVistaUltimate, weWin7Starter, weWin7HomeBasic,
    weWin7HomePremium, weWin7Professional, weWin7Enterprise, weWin7Ultimate); 
```

出于历史兴趣，您也可以使用 NtProductType 函数检查 NT 级别的版本，它返回：

```
 TNtProductType =       (ptUnknown, ptWorkStation, ptServer, ptAdvancedServer,        
        ptPersonal, ptProfessional, ptDatacenterServer, 
        ptEnterprise, ptWebEdition); 
```

请注意，上面检测到“N 个版本”。那是根据欧盟反垄断法规创建的欧盟（欧洲）版本的 Windows。这是 JCL 内部的一个非常好的检测等级。

这是一个示例函数，可帮助您检测 Vista，并在 Vista 上执行一些特殊操作。

```
function IsSupported:Boolean;
begin
  case GetWindowsVersion of
     wvVista:  result := false; 
    else
      result := true;
  end;
end; 
```

请注意，如果您想做“大于”检查，那么您应该使用其他技术。另请注意，版本检查通常会成为未来破坏的根源。我通常选择警告用户并继续，这样我的二进制代码就不会成为未来的实际破坏源。

最近我尝试安装一个应用程序，安装程序检查了我的驱动器可用空间，但没有安装，因为我有超过 2 GB 的可用空间。安装程序中的 32 位整数有符号值变为负数，从而破坏了安装程序。我必须将它安装到虚拟机中才能使其工作。添加“智能代码”通常会使您的应用程序“愚蠢”。警惕。

顺便说一句，我发现可以从命令行运行 WMIC.exe，然后键入`path Win32_OperatingSystem`（“从 Win32_OperatingSystem 中选择 *”对我不起作用）。将来也许 JCL 可以扩展到使用 WMI 信息。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-07-31T21:32:05.097

基本上回答重复的问题：[在 Delphi 2007 中获取 Windows 8.1 及更高版本的操作系统主要、次要和构建版本](https://stackoverflow.com/questions/31753092/getting-os-major-minor-and-build-versions-for-windows-8-1-and-up-in-delphi-200)

从 W2K 开始，您可以使用[NetServerGetInfo](https://msdn.microsoft.com/en-us/library/windows/desktop/aa370624%28v=vs.85%29.aspx)。NetServerGetInfo 在 W7 和 W8.1 上返回正确信息，无法在 W10 上进行测试。

```
function GetWinVersion: string;
var
  Buffer: PServerInfo101;
begin
  Buffer := nil;
  if NetServerGetInfo(nil, 101, Pointer(Buffer)) = NO_ERROR then
  try
     Result := <Build You Version String here>(
      Buffer.sv101_version_major,
      Buffer.sv101_version_minor,
      VER_PLATFORM_WIN32_NT // Save since minimum support begins in W2K
      );
  finally
    NetApiBufferFree(Buffer);
  end;
end; 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-08-01T18:31:54.313

关于使用 NetServerGetInfo() 的注意事项，它在 Windows 10 (10240.th1_st1) 上仍然有效...

[https://msdn.microsoft.com/en-us/library/windows/desktop/aa370903%28v=vs.85%29.aspx](https://msdn.microsoft.com/en-us/library/windows/desktop/aa370903%28v=vs.85%29.aspx)

> sv101_version_major
> 
> 主要版本号和服务器类型。
> 
> 操作系统的主要版本号以最低有效 4 位指定。服务器类型以最高有效 4 位指定。应用程序应使用 Lmserver.h 标头 {0x0F} 中定义的 MAJOR_VERSION_MASK 位掩码从该成员获取主要版本号。

换句话说，(sv101_version_major & MAJOR_VERSION_MASK)。

# svn - 使用 Subversion 的 403 禁止错误

> ID：57137
> 
> 赞同：45
> 
> 时间：2008-09-11T17:31:11.410
> 
> 标签：svn

我最近升级到 Subversion 1.5，现在我无法将代码提交到存储库。我收到一条错误消息：“403 Forbidden in response to MKACTIVITY”。我知道升级成功了，因为我的开发人员没有遇到这个问题。这是怎么回事？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-09-11T17:34:13.697

回答我自己的问题：

显然我的 SVN URL 有错误的情况！谷歌搜索出现了一篇解释正在发生的事情的文章（不再在线提供）。我的 URL 格式为[http://svn.foobar.com/foobar](http://svn.foobar.com/foobar)但实际存储库名为[http://svn.foobar.com/fooBar](http://svn.foobar.com/fooBar)。

我使用 TortoiseSVN，所以解决方法是使用 Relocate 命令来更正存储库的路径。

希望这会对其他人有所帮助。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-11T17:49:01.663

我们会定期遇到这种情况，这对开发人员来说非常令人沮丧。出于某种原因，从存储库读取似乎不区分大小写，但提交关心。

我理解大小写之所以重要，是因为 Subversion 源于对大小写敏感的 unix 文件系统，但我真的希望您在初始结帐时得到错误，而不是在提交时出错！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-09-08T00:09:04.727

如果您两次提交同名但大小写不同的文件（例如，foobar 和 FooBar），则会出现此问题的另一个实例。当然，这只有在 Windows 系统上才有可能，并且可能只是上面托德回答的一个特例。我们的一位开发人员不小心这样做了，同样花费了我们很多调试时间。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-02-09T14:52:24.327

托德是对的。愚蠢的是，repo 浏览器在签出时接受大写和小写，但如果签出时使用了错误的大小写，提交将失败。

[我从https://svn.domain.com/Company/Product/trunk](https://svn.domain.com/Company/Product/trunk)签出但无法提交，因为正确的 URL 是[https://svn.domain.com/company/product/trunk](https://svn.domain.com/company/product/trunk)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-09-26T13:36:42.387

在作为客户端的 msWin 环境中，另一个可能的原因是代理设置。

配置：*internet-explorer/internetOptions/connections/LAN-Settings/advanced/exceptions*

将您的 SVN 服务器放在例外中。

名字可能是其他人，我不使用英语作为系统语言。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-06-22T12:53:06.680

错误`Access to 'foo' forbidden`或`403 Forbidden`指示您的用户帐户缺乏对请求的存储库的权限。由于存储库中的存储库名称和路径区分大小写，因此您应该*检查输入的 URL 是否正确*以及您使用正确的凭据登录。运行[`svn auth`](http://subversion.apache.org/docs/release-notes/1.9.html#svn-auth)以查看客户端计算机上存储的凭据。

[通常，Subversion 中的访问控制是以基于路径的授权](https://www.visualsvn.com/support/svnbook/serverconfig/pathbasedauthz/)的形式实现的，并且完全支持**Read/Write**、**Read Only**和**No Access**访问级别。如果您实施复杂的访问控制策略，您必须了解 Subversion 中的访问控制原则。阅读文章[KB33：了解 VisualSVN 服务器授权](https://www.visualsvn.com/support/topic/00033/)以获取更多信息。虽然标题中写着“VisualSVN 服务器”，但这篇文章一般涵盖了基于路径的授权，并且应该适用于其他 SVN 服务器发行版。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-04-26T07:49:49.093

我遇到过同样的问题。我尝试了上面提供的几个答案，但没有一个对我有用。我发现我安装了两个版本的eclipse，并且在之前的eclipse版本上安装了subversion。我已完成以下步骤来解决 403-forbidden-error：

*   删除 subversion 文件夹 \AppData\Roaming\Subversion
*   从 Eclipse 卸载颠覆
*   安装颠覆

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-09-10T16:17:57.817

我有不再使用的凭据，但它们被记录在设置中。

删除这些旧设置就足以解决我的问题。

打开**Tortoise SVN**的**设置**：

 **1.  保存的数据

    *   认证数据

        *   全部清除
2.  刷新存储库

3.  使用正确的凭据再次登录

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-03-28T22:59:32.273

我认为这里的问题是 Subversion（无论其服务器安装在什么操作系统平台上）**是**区分大小写的。

但是，客户的操作系统可能不是。这可能会产生问题。

在我的公司里，我遇到过这种情况，我花了大约一个小时才弄明白。因此，一位在 mac 上工作的开发人员致力于使用相同名称的 svn 文件，但他将其名称中的几个字母改为大写字母。对于 mac 和 subversion，这不是问题，并且文件进入了。

后来，另一位碰巧在 windows 笔记本电脑上工作的开发人员遇到了一个错误，windows 完全糊涂了，什么也做不了。

所以，解决方案是 - 我问开发人员，我可以删除两个文件中的哪一个。我在 linux 上做到了，从那以后每个人都很开心。

所以，大写/小写拼写不是一个颠覆问题，而是一个 Windows 操作系统。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-04-01T17:36:38.393

它发生在我身上，原因是我无权访问该文件夹。一旦管理员添加了我的用户，我就可以签出代码。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-04-06T18:26:08.243

我遇到过同样的问题：

> 访问存储库条目时出错（403 Forbidden）

我发现了一些不同的方法。但对我来说，解决方案是：下载正确的插件（`subclipse 1.4`）版本以`svn`安装在服务器上`1.4.3`

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-07-18T08:51:04.803

用户/证书无权读取 svn 中的 repo。因此，您无法通过浏览器/乌龟访问存储库。与管理员交谈以解决此问题。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-06-15T07:24:56.573

就我而言，问题是詹金斯正在通过代理。我在 Tomcat 的 catalina.properties 文件中给出了以下属性。

```
http.proxyHost=proxyserver
http.proxyPort=3128 
```

为了指示它避免通过代理，我必须添加 http.nonProxyHosts 属性。多个主机可以用竖线 (|) 分隔

```
http.nonProxyHosts=localhost|*.companydomain.com 
```

SVN 服务器在 Intranet 上。我不需要通过代理。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-05-14T06:27:21.727

对我来说，更新正在工作，但提交操作给了我 403 禁止错误。我在进行电子邮件验证时解决了这个问题。

# .net - 返回 this 而不是 void 有什么缺点吗？

> ID：57140
> 
> 赞同：12
> 
> 时间：2008-09-11T17:32:51.390
> 
> 标签：.net, fluent-interface

说不是返回 void 方法，而是返回对类的引用，即使它没有任何特定的语义意义。在我看来，它会给你更多关于如何调用方法的选择，允许你以类似流畅的界面风格使用它，我真的想不出任何缺点，因为你不需要做任何事情与返回值（甚至存储它）。

因此，假设您处于想要更新对象然后返回其当前值的情况。而不是说

```
myObj.Update();
var val = myObj.GetCurrentValue(); 
```

你将能够结合这两行说

```
var val = myObj.Update().GetCurrentValue(); 
```

* * *

**编辑：** 我一时兴起问了下面的问题，回想起来，我同意这可能是不必要的和复杂的，但是我的问题是关于返回这个而不是无效的立场。

在相关的说明中，你们如何看待让该语言包含一些新的语法糖：

```
var val = myObj.Update()<.GetCurrentValue(); 
```

此运算符的优先级较低，因此 myObj.Update() 将首先执行，然后在 myObj 上调用 GetCurrentValue()，而不是 Update 的 void 返回。

本质上，我在想象一个运算符，它会说“在左侧第一个有效对象上调用运算符右侧的方法”。有什么想法吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-11T17:46:53.807

我认为作为一项一般政策，它根本没有意义。以这种方式链接的方法适用于正确定义的接口，但只有在语义上有意义时才适用。

您的示例是不合适的主要示例，因为它没有语义意义。

同样，使用适当设计的流畅界面也不需要您的语法糖。

Fluent 接口或方法链**可以**很好地工作，但需要仔细设计。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-11T17:54:19.107

我知道在 Java 中他们实际上正在考虑为 void 方法制定这种标准行为。如果你这样做，你就不需要额外的语法糖。

我能想到的唯一缺点是性能。但这很容易衡量。我会在几分钟后回复你结果:-)

编辑：

返回引用比返回 void 慢一点。真是令人惊讶。所以这是唯一的缺点。调用你的函数时，还有几个滴答声。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-11T17:58:33.357

我能看到的唯一缺点是它使 API 更加混乱。假设您有一些带有 remove() 方法的集合对象，该方法通常会返回 void。现在您要返回对集合本身的引用。新签名将如下所示：

```
public MyCollection remove(Object someElement) 
```

仅查看签名，尚不清楚您是否正在返回对同一实例的引用。也许 MyCollection 是不可变的，而您正在返回一个新实例。在某些情况下，例如这里，您需要一些外部文档来澄清这一点。

我实际上喜欢这个想法，并且我相信在 Java7 中改进所有 void 方法以返回对“this”的引用有一些讨论，但最终失败了。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-11T18:04:08.117

这不是“流畅的接口”——就像 JQuery 使用的那些——是如何构建的吗？一个好处应该是代码可读性（尽管[http://en.wikipedia.org/wiki/Fluent_interface](http://en.wikipedia.org/wiki/Fluent_interface)上的维基百科条目提到有些人认为它*不可读*）。另一个好处是代码简洁，您无需在 7 行代码中设置属性，然后在第 8 行调用该对象的方法。

Martin Fowler（他在这里创造了这个术语 - [http://martinfowler.com/bliki/FluentInterface.html](http://martinfowler.com/bliki/FluentInterface.html)）说，流式接口比方法链接更多，但是方法链接是与流式接口一起使用的常用技术。

编辑：我实际上是回到这里来编辑我的答案并补充说，当我看到乔治的评论指出我确实忘记讨论问题的重点时，以任何可衡量的方式返回这个而不是 void 没有任何*不利之处*。很抱歉最初的“毫无意义”漫无边际。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-11T17:41:11.353

返回“self”或“this”是一种常见的模式，有时称为[“方法链接”](http://www.martinfowler.com/dslwip/MethodChaining.html)。至于您提出的语法糖，我不太确定。我不是 .NET 人，但它对我来说似乎不是非常有用。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-11T17:45:15.213

NeXTSTEP Objective-C 框架曾经使用过这种模式。一旦分布式对象（基本上是远程过程调用）被添加到语言中，它在该框架中就停止了——返回的函数`self`必须是同步调用，因为分布式对象系统看到返回类型并假设调用者需要知道函数的结果。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-11T22:17:42.843

乍一看它可能看起来不错，但是对于一致的接口，您需要所有方法都返回对 this 的引用（这有它自己的问题）。

假设你有一个类，它有两个方法 GetA 返回 this 和 GetB 返回另一个对象：

然后你可以调用 obj.GetA().GetB()，但不能调用 obj.GetB().GetA()，至少看起来不一致。

使用 Pascal（和 Visual Basic），您可以调用同一对象的多个方法。

> ```
> with obj
>   .GetA();
>   .GetB();
> end with; 
> ```

此功能的问题在于，您可以轻松编写比应有的更难理解的代码。另外添加一个新的运算符可能会使它变得更加困难。

# java - 在 Java 中使用小型（1-10 项）实例级集合

> ID：57145
> 
> 赞同：6
> 
> 时间：2008-09-11T17:33:41.230
> 
> 标签：java, collections

在 Java 中创建类时，我经常发现自己创建了实例级集合，我提前知道这些集合非常小——集合中的项目少于 10 个。但我不提前知道项目的数量，所以我通常选择动态集合（ArrayList、Vector 等）。

```
class Foo
{
  ArrayList<Bar> bars = new ArrayList<Bar>(10);
} 
```

我的一部分一直在唠叨我，对这么小的东西使用复杂的动态集合是浪费的。有没有更好的方法来实现这样的事情？还是这是常态？

请注意，我没有受到任何（明显的）性能损失或类似的影响。这只是我想知道是否没有更好的方法来做事。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-11T17:48:59.527

Java 中的`ArrayList`类只有两个数据成员，一个对`Object[]`数组的引用和一个大小——如果你不使用`ArrayList`. 因此，不使用 an 的唯一好处`ArrayList`是节省了一个对象分配，这不太可能成为大事。

`ArrayList`如果您每秒钟都在创建和处理许多容器类的实例（以及扩展的实例），那么您*可能*会遇到垃圾收集搅动的小问题——但如果它真的发生了，那就需要担心了。垃圾收集通常是您最不担心的事情。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-11T18:03:39.927

为了简单起见，我认为这几乎不是问题。您的实现足够灵活，如果将来需求发生变化，您不会被迫进行重构。此外，考虑到您的小数据集和 Java 的 Collection API 的高质量，为混合解决方案添加更多逻辑是不值得的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-11T18:57:58.253

[Google Collections](https://web.archive.org/web/20081018003459/http://google-collections.googlecode.com:80/svn/trunk/javadoc/index.html?http://google-collections.googlecode.com/svn/trunk/javadoc/com/google/common/collect/package-summary.html) has collections optimized for immutable/small number of elements. See `Lists.asList` API as an example.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T17:45:18.443

开销非常小。可以编写一个混合数组列表，其中包含前几个项目的字段，然后回退到使用数组来获取更长的列表。

您可以通过使用数组完全避免列表对象的开销。更进一步的硬核，您可以将字段声明为对象，并完全避免单个项目的数组。

如果内存确实是个问题，您可能想忘记在低级别使用对象实例。而是在更大的粒度级别上使用更大的数据结构。

# database - 在 SQL 中处理一对一关系的最佳方法是什么？

> ID：57152
> 
> 赞同：10
> 
> 时间：2008-09-11T17:35:20.150
> 
> 标签：database, linq, linq-to-sql, database-design, schema

假设我有可能*与**Bravo*或 Charlie 的事物相关或无关的 Alpha 事物。

这些是一对一的关系：没有任何 Alpha 与一个以上的 Bravo 相关。没有 Bravo 与不止一个 Alpha 相关。

我有几个目标：

*   一个易于学习和维护的系统。
*   在我的数据库中强制执行数据完整性。
*   与我的数据的真实逻辑组织相匹配的模式。
*   我的编程中可以很好地映射到数据库表的类/对象（à la Linq to SQL）
*   快速的读写操作
*   有效利用空间（少数空字段）

我有三个想法……

```
PK = primary key  
FK = foreign key  
NU = nullable 
```

一张包含许多 nullalbe 字段的表（平面文件）...

```
 Alphas
      --------
   PK AlphaId
      AlphaOne
      AlphaTwo
      AlphaThree
   NU BravoOne
   NU BravoTwo
   NU BravoThree
   NU CharlieOne
   NU CharlieTwo
   NU CharlieThree 
```

许多具有零 nullalbe 字段的表...

```
 Alphas
      --------
   PK AlphaId
      AlphaOne
      AlphaTwo
      AlphaThree

      Bravos
      --------
FK PK AlphaId
      BravoOne
      BravoTwo
      BravoThree

      Charlies
      --------
FK PK AlphaId
      CharlieOne
      CharlieTwo
      CharlieThree 
```

两者中最好的（或最坏的）：许多表的许多空外键......

```
 Alphas
      --------
   PK AlphaId
      AlphaOne
      AlphaTwo
      AlphaThree
NU FK BravoId
NU FK CharlieId

      Bravos
      --------
   PK BravoId
      BravoOne
      BravoTwo
      BravoThree

      Charlies
      --------
   PK CharlieId
      CharlieOne
      CharlieTwo
      CharlieThree 
```

如果 Alpha 必须是 Bravo 或 Charlie，但不能两者兼而有之怎么办？

如果不只是 Bravos 和 Charlies，Alphas 还可以是 Deltas、Echos、Foxtrots 或 Golfs 等中的任何一个……？

* * *

**编辑：**这是问题的一部分：[哪个是我导航的最佳数据库模式？](https://stackoverflow.com/questions/56981/which-is-the-best-database-schema-for-my-navigation#57056)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-11T17:58:12.453

如果您希望每个 Alpha 仅与一个 Bravo 相关，我会投票支持使用组合 FK/PK 的可能性：

```
 Bravos
      --------
FK PK AlphaId
      BravoOne
      BravoTwo
      BravoThree 
```

这样，只有一个 Bravo 可以指代您的 Alpha。

如果 Bravos 和 Charlies 必须互斥，最简单的方法可能是创建一个鉴别器字段：

```
 Alpha
      --------
   PK AlphaId
   PK AlphaType NOT NULL IN ("Bravo", "Charlie")
      AlphaOne
      AlphaTwo
      AlphaThree

      Bravos
      --------
FK PK AlphaId
FK PK AlphaType == "Bravo"
      BravoOne
      BravoTwo
      BravoThree

      Charlies
      --------
FK PK AlphaId
FK PK AlphaType == "Charlie"
      CharlieOne
      CharlieTwo
      CharlieThree 
```

这样，AlphaType 字段会强制记录始终恰好属于一个子类型。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-22T05:24:49.773

I'm assuming you will be using SQL Server 2000 / 2005\. I have a standard pattern for 1-to-1 relationships which I use, which is not too dissimilar to your 2nd idea, but here are the differences:

*   Every entity must have its own primary key first, so your Bravo, Charlie, etc tables should define their own surrogate key, in addition to the foreign key column for the Alpha table. You are making your domain model quite inflexible by specifying that the primary key of one table must be exactly the same as the primary key of another table. The entities therefore become very tightly coupled, and one entity cannot exist without another, which is not a business rule that needs to be enforced within database design.

*   Add a foreign key constraint between the AlphaID columns in the Bravo and Charlie tables to the primary key column on the Alpha table. This gives you 1-to-many, and also allows you to specify whether the relationship is mandatory simply by setting the nullability of the FK column (something that isn't possible in your current design).

*   Add a unique key constraint to tables Bravo, Charlie, etc on the AlphaID column. This creates a 1-to-1 relationship, with the added benefit that the unique key also acts as an index which can help to speed up queries that retrieve rows based on the foreign key value.

The major benefit of this approach is that change is easier:

*   Want 1-to-many back? Drop the relevant unique key, or just change it to a normal index
*   Want Bravo to exist independently of Alpha? You've already got the surrogate key, all you do is set the AlphaID FK column to allow NULLs

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-11T17:41:57.967

就个人而言，我在您的第二个模型上取得了很多成功，在单个列上使用 PK/FK。

我从来没有遇到过要求所有 Alpha 都在 Bravo 或 Charlie 表中记录的情况。我一直处理 1 <-> 0..1，从来没有 1 <-> 1。

至于你的最后一个问题，那就是更多的表。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T22:07:43.147

到目前为止，我有一个非常适合您的模型的示例：

我有来自 Alpha 的外键 alpha_id 的 Charlie 和 Bravo 表。就像你的第一个例子一样，除了 alpha 不是主键， bravo_id 和 charlie_id 是。

我在需要处理这些实体的每个表上都使用 alpha_id，因此，为了避免可能导致延迟研究 Bravo 和 Charlie 以查找哪个 Alpha 的 SQL，我创建了一个 AlphaType 表并在 Alpha 表上我有它的 id (alpha_type_id) 作为外键。这样，我可以以编程方式知道我正在处理的 AlphaType，而无需加入可能有无数记录的表。在 tSQL 中：

```
// For example sake lets think Id as a CHAR.
// and pardon me on any mistake, I dont have the exact code here,
// but you can get the idea

SELECT 
  (CASE alpha_type_id
    WHEN 'B' THEN '[Bravo].[Name]'
    WHEN 'C' THEN '[Charlie].[Name]'
    ELSE Null
  END)
FROM ... 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-11T17:40:57.983

另一种方法是使用 3 个表来存储 3 个实体，并使用一个单独的表来存储关系。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-11T17:42:13.240

您可以有一个指定 Alpha 和相关 ID 的连接表。然后，您可以添加另一列，指定它是 Bravo、Charlie 还是其他的 ID。使列在 Alpha 上缓慢下降，但确实增加了连接查询的复杂性。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-17T19:04:08.297

您提出了很多问题，如果没有更多地说明您要解决的确切问题，就很难选择您提出的任何解决方案。不仅要考虑我的澄清问题，还要考虑您将用来评估我的问题的标准，以表明解决问题所需的详细信息量：

*   一个易于学习和维护的系统。

什么“系统”容易学习和维护？您的应用程序的源代码，或通过其最终用户界面的应用程序数据？

*   在我的数据库中强制执行数据完整性。

“在我的数据库中强制执行”是什么意思？这是否意味着您不能以任何其他方式控制数据完整性，即项目只需要基于数据库的数据完整性规则？

*   与我的数据的真实逻辑组织相匹配的模式。

您能否向我们提供您所指的真实世界的逻辑组织？不可能从您尝试存储的数据的三个示例中推断出它——即假设您的所有三个结构都完全错误。除非我们知道真实世界的规范，否则我们怎么知道呢？

*   我的编程中可以很好地映射到数据库表的类/对象（à la Linq to SQL）

这个要求听起来像是你的手被迫使用 linq to SQL 创建它，是这样吗？

*   快速的读写操作

什么是“快”？0.03 秒？3秒？30分钟？目前尚不清楚，因为您没有指定您所指的数据大小和操作类型。

*   有效利用空间（少数空字段）

有效利用空间与空字段的数量无关。如果您的意思是规范化的数据库结构，那将再次取决于问题中未提供的实际规范和应用程序的其他设计元素。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-11T17:48:23.257

除非我有充分的理由不这样做，否则我会选择选项 1。它可能不会像你想象的那样花费你那么多的空间，尤其是。如果您在 Bravo 中使用 varchars。不要忘记拆分它会花费你的外键、二级身份和所需的索引。

如果不太可能需要 Bravo (<%10) 并且您需要通过其中一个字段快速查询以便索引它，您可能会遇到麻烦的地方。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-17T18:13:16.407

我会创建一个超类型/子类型关系。

```
 THINGS
   ------
PK ThingId  

   ALPHAS
   ------
FK ThingId (not null, identifying, exported from THINGS)
   AlphaCol1
   AlphaCol2
   AlphaCol3  

   BRAVOS
   ------
FK ThingId (not null, identifying, exported from THINGS)
   BravoCol1
   BravoCol2
   BravoCol3  

   CHARLIES
   --------
FK ThingId (not null, identifying, exported from THINGS)
   CharlieCol1
   CharlieCol2
   CharlieCol3 
```

因此，例如，一个有 charlie 但没有 bravo 的 alpha：-

```
insert into things values (1);
insert into alphas values (1,'alpha col 1',5,'blue');
insert into charlies values (1,'charlie col 1',17,'Y'); 
```

请注意，您不能为 alpha 创建一个以上的 charlie，就好像您尝试创建一个 ThingId 为 1 的两个 charlie 一样，第二次插入将获得唯一的索引/约束违规。

# openid - 在计算机之间迁移 Cardspace 卡的问题

> ID：57154
> 
> 赞同：3
> 
> 时间：2008-09-11T17:36:33.190
> 
> 标签：openid, cardspace

这是场景。我将 myopenid 用于 StackOverflow 等。当我最初使用 myopenid 设置我的 openid 帐户时，我决定尝试 Cardspace，因为他们有支持。

后来我想从另一台机器访问 Stackoverflow，所以我选择备份我的卡。我给了它一个密码和一个文件名，并成功创建了一个备份文件。我也能够成功地将它导入我的笔记本电脑。

这就是问题所在 - 我无法使用从笔记本电脑备份的卡。原来的卡在我的桌面上仍然很好用。其他信息是我的台式机运行的是 Windows XP SP3 (x86)，而我的笔记本电脑运行的是 Windows Vista (x64)。

有任何想法吗？难道我做错了什么？我正在认真考虑将 Cardspace 放在 myopenid 上，转而使用他们的密码解决方案。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-15T14:52:19.557

它*应该*工作；但是，如果您在一台机器上安装了 3.5SP1，而在另一台机器上安装了 3.5 或更少，则代码会发生（未宣布的）重大更改，以从卡生成唯一 ID；这可以解释为什么它不起作用。

我会尝试将测试事务发送到[SharpSTS 测试页面](https://sharpsts.com/demos/informationCardToken.aspx)，仅将 PPID 作为声明，并检查发回的令牌；如果 PPID 不同，那就是你的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-19T11:48:29.243

在 Cardspace 中，卡被锁定在计算机上。您可以通过导出/导入来移动它。下一个版本“Geneva”将允许您将卡片存储在目录服务中，这对运行 Active Directory 的用户很有用。

# sql - 如何将一行从一个 SQL Server 表复制到另一个

> ID：57168
> 
> 赞同：101
> 
> 时间：2008-09-11T17:42:11.663
> 
> 标签：sql, sql-server

我有两个相同的表，需要将行从表复制到另一个表。最好的方法是什么？（我只需要以编程方式复制几行，我不需要使用批量复制实用程序）。

* * *

## 回答 #1

> 赞同：129
> 
> 时间：2008-09-11T17:49:36.187

只要没有身份列，您就可以

```
INSERT INTO TableNew
SELECT * FROM TableOld
WHERE [Conditions] 
```

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2008-09-11T17:49:45.763

替代语法：

```
INSERT tbl (Col1, Col2, ..., ColN)
  SELECT Col1, Col2, ..., ColN
  FROM Tbl2
  WHERE ... 
```

选择查询（当然）可以包括表达式、case 语句、常量/文字等。

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2008-09-11T17:52:19.690

Jarrett 的回答创建了一个新表。

斯科特的答案插入到具有相同结构的现有表中。

您还可以插入到具有不同结构的表中：

```
INSERT Table2
(columnX, columnY)
SELECT column1, column2 FROM Table1
WHERE [Conditions] 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-11T17:50:04.297

```
INSERT INTO DestTable
SELECT * FROM SourceTable
WHERE ... 
```

在 SQL Server 中工作

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-11T17:43:09.447

```
SELECT * INTO < new_table > FROM < existing_table > WHERE < clause > 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-09-20T14:46:19.697

只选择几行..这将像魅力一样工作..

```
SELECT TOP 10 *
INTO db2.dbo.new_table
FROM db1.dbo.old_table; 
```

注意：只需在所需的数据库中创建一个新表。我们不需要定义它的结构。

# .net - 来自 .Net 的 Oracle，带有 64 位客户端

> ID：57179
> 
> 赞同：5
> 
> 时间：2008-09-11T17:46:58.890
> 
> 标签：.net, oracle, 64-bit

有没有人在 64 位机器上使用 .Net 中的 Oracle 并使用 Oracle 的 UDT 功能？

我已经能够使用 x64 ODP.Net 客户端，但找不到任何支持 UDT 的客户端。

谢谢

缺口

[编辑] 我在下面发布了一个答案。最新版本（截至 2008 年 12 月）是 11.1.0.7。这支持 64 位和 UDT。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-30T16:52:24.530

您需要使用 11.1.0.7 版本。这具有 UDT 支持并适用于 32 位和 64 位。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T20:17:33.567

UDT 功能仅在 11g 客户端中列出，最新的 64 位客户端为 10.2.0.3。

不是您想要的答案，而是甲骨文似乎给出的答案。

其实我很高兴你问这个问题。我们正在努力迁移到 64 位服务器代码，我没想过要检查这一点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-01T13:09:29.807

一段时间以来，我一直在尝试让 64 位版本的 Windows Server 2003 连接到 Oracle 8i 实例。除了通过 32 位 VM 之外，这似乎是不可能的。

强制升级真的很烂！

# cvs - 获取特定用户的 CVS 历史记录

> ID：57183
> 
> 赞同：9
> 
> 时间：2008-09-11T17:48:18.637
> 
> 标签：cvs, tortoisecvs

如何获取特定用户对存储库的提交历史记录？

我可以通过命令行或 TortioseCVS 访问 CVS，因此使用任一方法的解决方案就足够了。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-22T14:56:12.693

作为一名编码员，我最感兴趣的是提交更改（与标记、分支等相反），因此我通常`-c`也包括提交选项：

```
cvs 历史 -c -u 用户名
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-11T18:00:06.597

```
cvs history -u username 
```

提供用户所做更改的历史记录

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-03-01T02:59:13.850

或者试试这个：

```
cvs history -x AMR -D "your-desired-date" 
```

例子

```
cvs history -x AMR -D "2012-04-12" 
```

# java - 当目录为空时，NLST 上的 FTP 超时

> ID：57194
> 
> 赞同：1
> 
> 时间：2008-09-11T17:51:19.817
> 
> 标签：java, ftp, webmethods

编辑：了解到 Webmethods 实际上使用 NLST，而不是 LIST，如果这很重要的话

我们的业务使用 WebMethods 集成服务器来处理我们的大部分出站通信，它的 FTP 功能还有一些不足之处。我们遇到了一个可能特定于 WebMethods 的问题，但如果有人能指出我可能会导致这种情况的方向，我将不胜感激。

当轮询我们合作伙伴的两个 FTP 服务器时，我们可以毫无问题地连接，但是当在一个空目录（没有文件和子目录）上执行 NLST 时，它会超时。实际错误是：

> com.wm.net.ftpCException：[ISC.0064.9010] java.net.SocketTimeoutException：接受超时

它在调用 pub.client.ftp:ls 服务期间被抛出。我已经使用多个 FTP 客户端登录到相同的站点，没有问题。我使用了 Windows、FileZilla 和 lftp 中的任何默认 FTP 客户端。都没有问题。据我所知，服务器本身与 FTP 服务器软件不同。一个是 Microsoft FTP，另一个我不确定，但绝对不是 Microsoft。

知道什么会导致 FTP 客户端在等待空目录上的 NLST 响应时超时？来自 FTP 服务器的可见响应似乎是相同的，但是 NLST 对我不知道的空目录的响应方式是否有所不同？

这个问题在这两台服务器上是一致的。在包含文件或子目录的目录上一切正常，但在为空时则不行。

任何想法或方向将不胜感激。

谢谢！

埃里克·斯普尔

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-11T18:48:50.397

我不确定这是否是同样的问题，但不久前我在 Java (commons.net) 中使用另一个 FTP 客户端时遇到了类似的症状。问题原来是由连接的主动/被动模式引起的。对不起，我不能给你更多的细节，这就是我能记住的……希望对你有所帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-11T19:47:35.513

Guillermo Vasconcelos 的回答是正确的。有两种 FTP 模式，主动和被动。默认[FTP](http://en.wikipedia.org/wiki/Ftp)模式处于活动状态。Active 要求服务器在某个 TCP/IP 端口上连接回客户端。这不适用于防火墙，因为此端口可能会被阻止，或者如果您位于具有 NAT 的路由器后面，但未映射。

如果您改用被动 (PASV) 模式，则不应出现问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-18T10:15:10.993

我在 WebMethods IS 版本 6.5 更新 WmPRT_6-5-1_SP1、IS_6-5_SP3 中试过这个。

它第一次完美运行。

我在 FTP 服务器（Debian 的默认 ftpd）上打开了调试。WebMethods 的 NLST 尊重传递给它的主动/被动参数。

NLST 命令没有什么特别之处，也没有它在空目录下的正确行为——如果 LIST 有效，那么 RETR、STOR 和 NLST 也应该如此。如果 NLST 使用非空目录，它应该使用空目录。

所以我的猜测是：

*   你的 WM 版本有一个错误，我没有
*   你的 FTP 服务器有一个错误，我没有
*   您的系统中有一个古怪的协议感知防火墙，它不喜欢其中没有数据的 FTP 数据套接字。

防火墙供应商在 FTP 方面有点任性...当与其他客户端一起测试时，请确保它来自运行 WebMethods Integration Server 的同一台机器。

仅作记录，以下是活跃的 NLST 应该发生的事情

*   客户端打开一个监听套接字，并发送一个带有该套接字详细信息的 PORT 命令
*   客户端发送 NLST 命令
*   服务器连接到客户端的监听套接字（这是数据套接字）
*   服务器通过数据套接字传输列表（在这种情况下，零字节）
*   服务器关闭数据套接字

...在被动模式下

*   客户端发送 PASV 命令
*   服务器打开一个监听套接字，并回复包含其详细信息的 PASV 响应
*   客户端连接到监听套接字（这是数据套接字）
*   客户端发送 NLST 命令
*   服务器通过数据套接字传输列表（再次为零字节）
*   服务器关闭数据套接字

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-11T19:53:10.087

明天在这里完成维护时，我将运行一些设置为被动的新测试，但我不确定这是问题所在。如果该目录中有文件或子目录，我们可以获得目录列表。只有当我们进行 NLST 处理的目录为空时，它才会失败。

主动/被动差异是否只体现在空目录中，还是有另一种可能性？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-05T22:17:05.843

FTP 要求通过防火墙打开指定的端口和它上面的端口。当我遇到 webMethods 超时问题时，这是因为防火墙没有打开返回端口。

霍华德

# javascript - 如何在 JScript 警报对话框中放置指向网页的链接？

> ID：57202
> 
> 赞同：4
> 
> 时间：2008-09-11T17:54:09.013
> 
> 标签：javascript, alert

我想在警告对话框中放置一个网页链接，以便更详细地说明如何修复导致创建对话框的错误。

如何使对话框显示如下内容：

```
There was an error.  Go to this page to fix it.
wwww.TheWebPageToFix.com 
```

谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-11T17:55:52.490

你不能。警报框不支持 html。您应该将错误显示为页面的一部分，无论如何它比 JS 警报更好。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-11T18:07:05.847

如果你***真的***想要，你可以覆盖`alert()`函数的默认行为。不是说你***应该***这样做。

这是一个使用 YUI 库的示例，但您不必使用 YUI 来执行此操作：

[基于 YUI 的警报框 - 替换你丑陋的 JavaScript 警报框](http://htmlblog.net/yui-based-alert-box-replace-your-ugly-javascript-alert-box/)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-11T18:08:23.147

你不能 - 但这里有一些选择：

*   `window.open()`- 制作自己的对话
*   使用`prompt()`并指导用户复制 url
*   使用 JavaScript 直接将它们导航到 url（可能在使用`confirm()`后询问它们）
*   在您的页面上包含`div`一个 [FIX IT] 按钮并取消隐藏它
*   使用 JavaScript 将修复它的 URL 放入用户的剪贴板（不推荐）

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-11T18:40:03.130

您可以尝试通过 window.prompt 询问他们是否希望访问：

```
if(window.prompt('Do you wish to visit the following website?','http://www.google.ca'))
  location.href='http://www.google.ca/'; 
```

此外，Internet Explorer 支持模式对话框，因此您可以尝试显示其中之一：

```
if (window.showModalDialog)
   window.showModalDialog("mypage.html","popup","dialogWidth:255px;dialogHeight:250px");
else
   window.open("mypage.html","name","height=255,width=250,toolbar=no,directories=no,status=no,menubar=no,scrollbars=no,resizable=no,modal=yes"); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-11T17:58:34.837

或使用 window.open 并将[链接放在那里](http://qa.techinterviews.com/q/20060809080754AAs7gKM)。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-11T17:58:40.080

即使可以，`alert()`框通常也是模态的 - 因此从一个打开的任何页面都必须在新窗口中打开。恼人的！

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-11T17:59:25.180

```
alert("There was an error. Got to this page to fix it.\nwww.TheWebPageToFix.com"); 
```

这是您可以从 JavaScript 中做的最好的事情`alert()`。您的替代选择是尝试打开一个看起来像对话框的新小窗口。用 IE 你可以打开它的模态。

# .net - TabPages 中的 ToolStrips 经常从 Windows 窗体设计器中消失

> ID：57208
> 
> 赞同：4
> 
> 时间：2008-09-11T17:57:50.470
> 
> 标签：.net, vb.net, visual-studio, winforms

我有一个带有 TabControl 的 Windows 窗体应用程序。TabControl 中的一个 TabPages 包含一个 ToolStrip。通常，Windows 窗体设计者会自发地将工具条的 Visible 属性设置为 False。为了让工具条重新出现在我的表单中，我必须手动找到控件并将属性设置回 True。这真的很烦人。

有谁知道为什么会发生这种情况，或者如何阻止它？我尝试将控件的最小高度设置为非零值，但这没有效果。

我正在使用 VS2008、VB.NET 和 .Net 框架 2.0，但是在几个不同的应用程序中，我也在 VS2005 中遇到了这个问题。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-15T15:28:27.537

我可能已经找到了解决方法。

我的 ToolStrip 直接放在 TabPage 上，停靠在顶部。但是，当 ToolStrip 位于 TabPage 上的 ToolStripContainer 中时，我[在 Microsoft Connect 上发现了一个描述相同问题的线程。](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=117176&wa=wsignin1.0)这个问题在 VS2005 的候选版本中被观察到，但据说微软在 2006 年 9 月修复了这个问题。

因此，我更改了代码以将 ToolStrip 放入 ToolStripContainer 中，但现在我无法重现该问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T13:20:07.797

打开设计器代码并将控件的可见属性显式设置为 true。

***尼克·汉肖***

# .net - 我应该附带什么 .NET Framework 版本；2、3、3.5？

> ID：57234
> 
> 赞同：11
> 
> 时间：2008-09-11T18:07:18.780
> 
> 标签：.net, .net-framework-version

我的应用程序使用 2.0。在未来的某个时候，我可能想开始使用在以后的框架版本中添加的新功能。我应该等到那个时候吗？或者现在更新到最新的 .NET 3.5 有什么好处？

我想等到我准备好迎接明年春天的 4.0 版时，它就会发布。也许我应该在秋季版本中坚持使用 2.0 并为我的客户节省 HD 空间和另一个框架版本的安装时间？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-11T18:09:52.673

在我看来，你应该提供你的应用程序需要的东西。否则，您将无缘无故地延长安装时间，并且正如您所指出的，基本上无缘无故地再次使用客户的 HD 空间。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-11T18:31:06.163

如果您计划升级到 3.5 SP1，您应该考虑使用[新的 .NET Framework Client Profile Setup Package](http://weblogs.asp.net/scottgu/archive/2008/05/12/visual-studio-2008-and-net-framework-3-5-service-pack-1-beta.aspx)。

.NET 3.5 SP1 为构建 .NET 客户端应用程序的开发人员引入了一个新的安装包选项，称为“.NET Framework 客户端配置文件”。这提供了一个新的安装程序，可以在尚未安装 .NET Framework 的计算机上为 .NET 客户端应用程序提供更小、更快和更简单的安装体验。

.NET Framework 客户端配置文件设置仅包含 .NET Framework 中通常用于客户端应用程序方案的程序集和文件。例如：它包括 Windows 窗体、WPF 和 WCF。它不包括 ASP.NET 以及主要用于服务器方案的那些库和组件。我们预计此安装包大小约为 26MB，下载和安装速度比完整的 .NET Framework 安装包快得多。

.NET Framework 客户端安装程序包中的程序集和 API 与完整 .NET Framework 安装程序包中的程序集和 API 100% 相同（它们实际上是相同的二进制文件）。这意味着应用程序可以针对 .NET 3.5 SP1 的客户端配置文件和完整配置文件（无需重新编译）。所有使用 .NET 客户端配置文件设置工作的 .NET 应用程序都会自动使用完整的 .NET Framework。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-11T18:19:29.093

我总是使用最新版本的框架。这对用户来说可能是一个小的前期负担，但该应用程序在升级之间的寿命要长得多。这对您可能重要也可能不重要，但请考虑：

如果您在 2005 年使用 .NET 1.1 发布了一个应用程序，那么您的应用程序运行的框架现在已经脱离了主流支持，并且可能存在未修补的安全漏洞或其他 Microsoft 可能无法处理且您无法弥补的严重问题在您自己的代码中。您在 2008 年唯一的选择是让您的用户现在升级他们的框架版本。而且，众所周知，让用户及时更新内容可能会有问题。

同样，考虑一下您在 2011 年的情况。如果您现在针对 .NET 3.5 进行编程，那么您的应用程序（交付时）将可以使用更长的时间。如果您现在为 .NET 2.0 发布，几年后您将不得不说服您的用户升级他们的框架（记住对他们没有任何好处的代码），这样您就可以正确支持此应用程序。

此外，如果您计划实现 3.5 级功能（例如明年的 LINQ to SQL），那么现在发布 3.5 而不是 2.0 符合您的利益，因为这将使以后的部署对您来说不是问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-06T02:58:41.463

请记住，用户的“小负担”可能意味着接受和拒绝您的应用程序之间的差异。

我为一家公司管理 IT。我们公司的标准不是3.5。您必须拥有一个非常出色的应用程序才能让我将每个人都升级到 .NET 3.5，这样您的应用程序才能运行。换句话说，可能不会发生。我会找到另一个不会给我们已经超负荷的 IS 部门增加额外“小负担”的应用程序。

其他人评论了您真正要使用的功能。如果 1.1 或 2.0 具有真正的功能集，您需要坚持下去。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-11T18:18:57.817

您应该使用任何版本的 .Net 分发您的应用程序，这是您进行最多测试的版本。如果您一直在 .Net 2.0 中进行所有开发和测试，那么请使用 2.0。

但是您可能欠您的客户对 3.5 进行测试并附带它，而是为了解决自 2.0 发布以来框架中已修复的任何错误。该框架已经如此庞大，以至于分发早期版本可能没有任何好处，即使它出现在 WCF、WPF 等之前，除非您支付带宽成本来分发它，或者目标设备的存储空间有限空间。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-23T22:40:37.677

.net 3.5sp1 引导程序太慢了，尤其是如果您使用 asp.net 应用程序（与 Windows 窗体相比），在只有 .net 2.0 的机器上，它会加载整个框架，这意味着您正在寻找大约 20-30在适中的互联网连接和机器速度下下载 + 安装时间的分钟数。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-11T18:10:34.823

我很欣赏 .NET 3.5 中的新语言功能，但在您使用它们之前，我会避免升级到最新的运行时，因为它是一个更大的文件/安装，您的用户可能必须处理。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-11T18:17:32.577

Linq to SQL 的特性，以及实际上非常多的 Linq 扩展，都非常值得升级。

至于您对 HD 空间和安装时间的担忧，IMO 这些与更新框架的大多数现代系统无关。较新版本的框架（3.0 和 3.5）实际上只是 2.0 框架的“更新”。除非您的客户/市场是较旧的 PC，否则我认为您将为您的开发团队在功能和生产力方面取得良好的折衷，而不是失去客户的风险微不足道，因为他们不能冒险在他们的硬盘驱动器上再增加 20Mb（我弥补了20mb的号码，有人可以打电话给BS）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-11T18:17:47.350

3.5 框架有它的第一个 Service Pack 版本，因此它比发布后更稳定，但请记住，如果您遇到任何原因，将代码从 2.0 升级到 3.5 要比回到 3.5 容易得多显示塞子。

[wiki 文章](http://en.wikipedia.org/wiki/Microsoft_.NET#.NET_Framework_3.0) 很好地展示了新功能。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-11T18:20:18.810

我同意[EBGreen](https://stackoverflow.com/questions/57234/what-net-framwork-version-should-i-ship-with-2-3-35#57239)和[Chris](https://stackoverflow.com/questions/57234/what-net-framework-version-should-i-ship-with-2-3-35#57260)的观点，但我想补充一点，您可能需要考虑针对较新版本的框架测试您的应用程序，并允许您的应用程序针对您认为可以正常工作的那些版本运行（这可以使用一些配置技巧，但不幸的是，我找不到它的参考）。这样，您的应用程序可以针对客户端可能已经安装的版本运行。

我建议这样做是因为：

1.  新的框架版本可能会给您带来性能提升。
2.  客户可能已经在他们的计算机上安装了另一个版本，正如您所说，浪费硬盘空间是一种耻辱。
3.  您可能希望将来某个时候针对较新的框架版本运行您的应用程序，并且如果您的客户已经拥有该版本并且正在运行该应用程序的当前版本，那么他们的计算机上将不会有旧的框架。

不过，我仍然缺少您可能拥有的一些信息，例如分发方式、客户机器的配置文件等。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-11T18:20:43.770

我发现 2.0 版是最容易定位和部署的版本，因为很多人已经安装了它，如果您的大部分客户群使用 Vista，您可能会考虑升级到 3.0。高于此的版本几乎总是需要安装，这对某些用户来说可能会很痛苦。

编辑：“框架版本不再支持”的说法站不住脚，因为 3.0 是 2.0 的扩展，而 3.5 是它的扩展。根据定义，只要 3.5 支持，就会支持 2.0。1.1 版是唯一一个完全独立的运行时版本，不再受支持。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-11T18:44:19.003

我想问的一个问题是您想使用 .NET 3.5 的哪些功能？许多大肆宣传的特性实际上是 C# 3.0 特性，而不是特定于 .NET 3.0/3.5 的特性，而且由于 C# 3.0 使用与 .NET Framework 2.0 相同的 CLR，因此您也可以在 2.0 应用程序中自由使用它们。这只需要VS 2008。

例子是：

*   Lambda 表达式
*   对象初始化器
*   匿名类型
*   局部变量类型推断
*   扩展方法

我在自己的 .NET 2.0 项目中使用了其中的许多，没有任何问题。

如果您需要特定于框架的功能（如 Linq、WPF 等），那么您必须升级。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-11T18:45:30.793

我同意你应该满足你的应用程序需要什么，但你也应该为你的应用程序将来需要什么做*准备*。

如果你有几个空闲周期，你可以在你的 SCM 中迁移一个单独的应用程序分支，该分支使用 3.5 运行时运行，当你真正需要升级时，你有一个工作分支（假设你保持它最新 -日期与一些双周合并）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-09T16:38:29.880

不要忘记 .Net 4.0 将与之前版本的框架略有不同。.Net 4.0 将并排安装 (SxS) .Net 3.5 和背面。如果您升级您的应用程序以使用 .Net 4.0，那么您的长期用户（也就是以前的版本）最终将不得不安装一个全新版本的框架。

如果您考虑使用您的应用程序和框架在客户端计算机上使用多少磁盘空间，那么不要忘记这种“隐藏”的额外空间使用。如果您现在将应用程序从 2.0 升级到 3.5，那么您的应用程序可能能够以完整的功能存在更长时间，而无需强制用户安装占用另外 20+ MB 空间的第二个框架。

# javascript - 查找网站中缺少的 Javascript 包含

> ID：57238
> 
> 赞同：2
> 
> 时间：2008-09-11T18:09:39.320
> 
> 标签：javascript, include

假设我在一个页面中有几个 JavaScript 包含：

```
<script type="text/javascript" src="/js/script0.js"></script>
<script type="text/javascript" src="/js/script1.js"></script>
<script type="text/javascript" src="/js/script2.js"></script>
<script type="text/javascript" src="/js/script3.js"></script>
<script type="text/javascript" src="/js/script4.js"></script> 
```

有没有一种方法可以告诉我是否没有找到其中的任何一个（404），而无需手动检查每个？我想我正在寻找一个在线工具或类似的东西。有任何想法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-11T18:12:49.233

如果您获得[Firebug](https://addons.mozilla.org/en-US/firefox/addon/1843 "萤火虫") firefox 插件并启用控制台，它应该会告诉您何时在控制台中检索资源时出错。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-11T18:13:12.837

我使用的其他浏览器不足以知道在哪里可以找到类似的功能，但是 Safari 有一个*活动*窗口，可以显示给定网页的所有包含文件，以及哪些文件无法检索。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-11T18:35:14.313

如果您想动态监控而不实际检查它是否存在，那么我建议将动态变量放在文件中。然后做这样的事情：

```
var script0Exists = true; // inside script0.js
var script1Exists = true; // inside script1.js 
```

然后在您的其他文件中，只需使用：

```
if ( script0Exists ) {
    // not a 404 - it exists
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T18:17:23.513

记录您的 404。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-11T18:48:03.953

如果您不想在客户端手动检查它，则需要在服务器端执行此操作。您需要确保您使用的任何网络服务器都配置为记录 404，然后检查该日志以查看哪些 HTTP 请求失败。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-07T12:30:50.463

如果您的网络主机总是返回 HTTP 结果“200 OK”，无论文件是否存在（后者应该给出“404 Not Found”），浏览器无法判断它是否接收到脚本。

您可以尝试通过 XMLHttpRequest 检索文件，检查数据，如果它们看起来像 JS，则 eval() 或者创建一个脚本标记，指向您下载的完全相同的 URL（如果脚本是可缓存的，它不会再次传输，因为浏览器已经拥有它）。

# sql - 在 SQL Server 中查找丢失的电子邮件

> ID：57243
> 
> 赞同：0
> 
> 时间：2008-09-11T18:11:28.770
> 
> 标签：sql, join, anti-join

我正在尝试做我已经做了一百万次的事情，但它不起作用，谁能告诉我为什么？

我有一张表格供发送简历的人使用，里面有他们的电子邮件地址...

我想知道这些人中是否有人没有在网站上注册。aspnet_Membership 表包含在网站上注册的所有人员。

有 9472 名求职者，拥有唯一的电子邮件地址。

此查询产生 1793 个结果：

```
select j.email from jobseeker j
join aspnet_Membership m on j.email = m.email 
```

这表明应该有 7679 (9472-1793) 封未在网站上注册的人的电子邮件。由于其中 1793 个 DID 匹配，我希望其余的不匹配......但是当我为此进行查询时，我什么也没得到！

为什么这个查询什么也没给我？？？

```
select j.email 
from jobseeker j
where j.email not in (select email from aspnet_Membership) 
```

我不知道这怎么可能行不通-它基本上说“向我显示所有在求职者表中的电子邮件，但不在 aspnet_Membership 表中......

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-11T18:20:05.927

我们最近遇到了一个非常相似的问题，子查询有时会返回空值。然后，in 语句以一种奇怪的方式处理 null，我认为总是匹配该值，所以如果您将查询更改为：

```
select j.email 
from jobseeker j
where j.email not in (select email from aspnet_Membership
                      where email is not null) 
```

它可能工作....

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-11T18:15:21.677

你可能有很多重复的东西。我没有在脑海中看到查询错误，但您可以尝试这样写：

```
SELECT j.email
FROM jobseeker j
LEFT JOIN aspnet_Membership m ON m.email = j.email
WHERE m.email IS NULL 
```

您还可以在其中添加 GROUP BY 或 DISTINCT 以消除重复项。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T22:33:50.073

另请参阅[从一个表返回不在另一个表中的所有行的五种方法](http://wiki.lessthandot.com/index.php/5_ways_to_return_rows_from_one_table_not_in_another_table)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-11T21:32:45.010

您可以使用`exists`而不是`in`这样：

```
Select J.Email
From Jobseeker j
Where not exists (Select * From aspnetMembership a where j.email = a.email) 
```

在使用`in`.

# epg - 从 DVB-T 获取 EPG 信息

> ID：57249
> 
> 赞同：7
> 
> 时间：2008-09-11T18:13:31.713
> 
> 标签：epg

我有兴趣从 DVB-T 流中获取 EPG 数据。有谁知道任何 C 库或获取数据的替代方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-11T20:48:50.543

tv_grab_dvb 可以做到这一点。查看源代码的[subversion 存储库](http://www.darkskiez.co.uk/svn/tv_grab_dvb/trunk/)。

tv_grab_dvb 可用于在 Linux 上使用[dvbtools](http://sourceforge.net/projects/dvbtools/)从 DVB-T 卡抓取的流，但它可能可移植到其他平台 - 我认为它仅适用于流中的原始数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-03-01T11:34:39.430

...一个老问题的新答案：

我编写了一个名为的实用程序`dvbtee`，它可以用作 c++ 库、跨平台命令行实用程序或 node.js 模块。

（尽管它是一个 c++ 库，仍然可以从 c 代码链接到它）

命令行实用程序将解析您的流并输出 EPG，根据您指定的参数，它可以生成纯文本或 JSON 数据块。

[dvbtee：数字电视流媒体/解析器/服务信息聚合器，支持各种接口，包括 telnet CLI 和 http 控制](http://mkrufky.github.io/libdvbtee)

node.js 模块将发出包含 PSIP 表数据的事件（以及 EPG 信息）

[node-dvbtee：Node.js 的 MPEG2 传输流解析器，支持电视广播 PSIP 表](https://www.npmjs.com/package/dvbtee)

# .net - 如何防止 ReadDirectoryChangesW 丢失文件更改

> ID：57254
> 
> 赞同：21
> 
> 时间：2008-09-11T18:16:46.823
> 
> 标签：.net, windows, readdirectorychangesw

互联网上有很多关于 ReadDirectoryChangesW API 函数在文件活动很多时丢失文件的帖子。大多数都归咎于调用 ReadDirectoryChangesW 函数循环的速度。这是一个不正确的假设。我见过的最好的解释是在下面的帖子中，2008 年 4 月 14 日星期一下午 2:15:27 的评论

[http://social.msdn.microsoft.com/forums/en-US/netfxbcl/thread/4465cafb-f4ed-434f-89d8-c85ced6ffaa8/](http://social.msdn.microsoft.com/forums/en-US/netfxbcl/thread/4465cafb-f4ed-434f-89d8-c85ced6ffaa8/)

总结是 ReadDirectoryChangesW 函数在文件更改离开文件后写队列时报告文件更改，而不是在添加时报告。如果在提交之前添加了太多，你会忽略其中一些。如果您只是编写一个程序以真正快速地在目录中生成 1000 多个文件，您可以在您的实现中看到这一点。只需计算您收到多少文件事件通知，您就会发现有时您不会收到所有通知。

问题是，有没有人找到一种可靠的方法来使用 ReadDirectoryChangesW 函数而不必每次都刷新音量？如果用户不是管理员，则不允许这样做，并且还可能需要一些时间才能完成。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-11T18:34:39.680

如果 API 不可靠，那么解决方法可能是您唯一的选择。这当然可能涉及跟踪 lastmodified 和文件名。 ~~这并不意味着您需要在查找更改时进行轮询，而是可以使用 FileSystemWatcher 作为触发检查的手段。~~

因此，如果您跟踪 ReadDirectoryChangesW ~~/FSW~~事件发生的最后 50-100 次，并且您看到它被快速调用，您可以检测到这一点并触发特殊条件以获取所有已更改的文件（并设置一个标志，以暂时防止未来的虚假 FSW 事件）在几秒钟内。

由于有些人对此解决方案的评论感到困惑，我建议您应该监控事件从 ReadDirectoryChangesW 到达的速度，以及当它们到达速度过快时，尝试尝试解决方法（通常是手动扫描目录）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-10-01T15:13:10.073

我们从未见过 ReadDirectoryChangesW 是 100% 可靠的。但是，最好的处理方式是将“报告”与“处理”分开。

我的实现有一个只有一项工作的线程，用于重新排队所有事件。然后是第二个线程来处理我的中间队列。基本上，您希望尽可能少地阻止事件报告。

在 CPU 较高的情况下，您还可以阻止观察者事件的报告。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-05-24T08:17:22.483

我遇到了同样的问题。但是，我没有找到保证获得所有事件的解决方案。在几次测试中，我知道在 GetQueuedCompletionStatus 函数返回后，应该尽快再次调用 ReadDirectoryChangesW 函数。我想如果文件系统的处理速度比我的应用程序处理速度快得多，应用程序可能会丢失一些事件。

无论如何，我将解析逻辑与监控逻辑分开，并将解析逻辑放在一个线程上。

# .net - 如何使用具有客户端和服务器身份验证的 TLS 从 .NET 连接到 PostgreSQL？

> ID：57261
> 
> 赞同：1
> 
> 时间：2008-09-11T18:19:28.983
> 
> 标签：.net, postgresql, database-connection, ssl

我想将 C# .NET 应用程序连接到 PostgreSQL 数据库，使用带有客户端*和*服务器身份验证的 TLS：换句话说，如果无法根据服务器的证书验证来自客户端的证书，则客户端应该被拒绝访问，如果客户端无法验证服务器的证书，客户端应立即中止连接。

我尝试使用 Npgsql 1.0 进行此操作，但在 Npgsql 中找不到任何方法来指定应用于连接的客户端证书。

我确实设法让客户端上的服务器证书验证正常工作，并且我也确实使用命令行 db 管理工具 psql 进行了所有验证工作，但这并没有帮助我进一步让它与 Npgsql 一起工作。

那么，如何使用 TLS 客户端和服务器身份验证将我的 .NET 应用程序连接到 PostgreSQL 数据库？

是否有支持此功能的更新/其他数据提供者？

实际上有没有人让这个以一种或另一种方式工作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-13T05:39:41.260

尝试[2.0 RC2](http://pgfoundry.org/frs/?group_id=1000140&release_id=1217)版本- 它非常稳定。

（请注意，CVS 直到 2009 年才添加对服务器证书验证的支持。请参阅[http://pgfoundry.org/tracker/?func=detail&atid=592&aid=1010558&group_id=1000140](http://pgfoundry.org/tracker/?func=detail&atid=592&aid=1010558&group_id=1000140)。我正在将其编辑到回复中，因为升级建议虽然为时过早，但却是正确的。）

# .net - SMTP 邮件超时问题

> ID：57285
> 
> 赞同：0
> 
> 时间：2008-09-11T18:29:52.797
> 
> 标签：.net, asp.net, email, smtp

当我为我的 Web 应用程序创建用户时，会使用自动生成的密码向用户发送一封 SMTP 电子邮件（使用 ASP.NET 的 SmtpClient）。但是，有时我注意到它超时并且新用户根本不会收到带有密码的电子邮件。

好的，所以我将显示一条消息，指示邮件未通过但已创建用户。

因此，系统管理员目前有 2 个选项：

1.  重置用户的密码，并希望使用自动生成的密码发送另一封 SMTP 邮件。
2.  删除并重新创建用户。

如果未发送 smtp，我可以回滚用户创建，但解决此问题的最佳做法是什么？

我在想我应该重试发送电子邮件 3 次，每次超时时间为 5 秒。所以 15 秒是最坏的情况。

这是要走的路吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-11T18:56:16.477

好吧，根据您的平台，如果您可以将邮件交给本地 MTA，它应该处理重试等。您的程序可以将邮件排队并继续前进，而不用担心处理超时和灰名单等。

如果邮件仍然无法发送，您可以随时尝试重新发送（通过密码重置功能）。如果也失败了，很可能是电子邮件地址有误，我建议删除该帐户，导致用户重新注册。

当然，这在某些系统上可能是不可能的，这取决于对未经确认的用户可以做什么——这实际上取决于您允许人们在他们的电子邮件被验证之前做什么。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T19:06:52.333

听起来您的 Web 应用程序正在直接向您用户的邮件服务器发送 SMTP。[您的 Web 应用程序是与用户的 MTA（邮件传输代理）对话的 MUA（邮件用户代理）。] 没有说用户的 MTA 必须可以访问或目前正在工作。您需要运行自己的 MTA，以确保有人提供排队、重试等。

如果你真的想向后弯腰，你可以做你正在做的事情（尽管只有一次尝试），退回到排队消息并继续以较慢的时间表重试至少 24 小时，并将未完成的状态暴露给用户。

可以在[RFC1123（Internet 主机要求 - 应用程序和支持）](http://www.ietf.org/rfc/rfc1123.txt)中找到有关您的应用程序应该如何运行的官方答案：

> 5.3.1.1 发送策略
> 
> 发件人 SMTP 的一般模型是一个或多个定期尝试传输外发邮件的进程。在典型的系统中，编写消息的程序有一些方法可以请求立即关注新的外发邮件，而不能立即传输的邮件必须排队并由发件人定期重试。邮件队列条目不仅包括邮件本身，还包括信封信息。
> 
> 发送方必须在一次尝试失败后延迟重试特定目的地。一般来说，重试间隔应该至少30分钟；但是，当发送方 SMTP 可以确定未投递的原因时，更复杂和可变的策略将是有益的。
> 
> 重试一直持续到消息被传输或发送者放弃；放弃时间一般至少需要4-5天。重试算法的参数必须是可配置的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T18:56:39.270

恕我直言，您应该通知用户，要求他验证电子邮件，而无需重试。

如果用户没有验证电子邮件并离开页面，您最好回滚帐户，因为用户无论如何都无法访问它。

大多数超时情况是由无效的电子邮件帐户引起的。用户要么犯了错误，要么给了你一个不存在的电子邮件地址，以避免被垃圾邮件。

如果可能的话，不要询问您的用户电子邮件。编程的第一条规则应该是：不要惹恼用户。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-11T19:24:33.337

如果您使用 ASP.NET 和 System.Net.Mail 类，您可能是通过 Web 服务器计算机上的 IIS 实例发送邮件（我不确定，因为您没有指定）。没有一个好方法可以了解您的邮件传输代理 (IIS SMTP) 发生了什么。它有自己的重试逻辑，默认情况下，可能需要很长时间才能传递消息。

您如何检测到邮件未送达？“超时”从何而来？

您应该有一个处理邮件发送的后台进程。如果成功交付给 MTA，您应该假设一切正常。除非您被列入垃圾邮件黑名单，否则大多数 MTA 会不断重试，直到通过。如果您在使用 MTA 删除消息时确实遇到错误，那么一定要重试，或者找出导致失败的原因并修复错误。老实说，这部分不应该失败。

您可能希望监控 NDR 邮件的返回地址，以便在您确定电子邮件未送达时采取某种措施。但是如果用户还不能登录系统，就没有好办法让他们知道发生了什么。也许您可以设置一个与电子邮件相关联的值的 cookie，如果您无法发送邮件，则在登录/注册页面上放一些东西。

# asp.net - ASP.Net RSS 提要

> ID：57287
> 
> 赞同：16
> 
> 时间：2008-09-11T18:30:47.273
> 
> 标签：asp.net, .net-2.0, webforms, rss

如何在 ASP.Net 中创建 RSS 提要？有内置的东西来支持它吗？如果没有，有哪些第三方工具可用？

我在考虑网络表单，而不是 MVC，尽管我想由于这不是传统页面，因此差异可能很小。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-14T22:50:38.807

.NET Framework 3.5 添加了一个 SyndicationFeed 类，它允许您创建和/或使用 Atom 1.0 和 RSS 2.0 格式的提要。

[MSDN 上的 SyndicationFeeds 类](http://msdn.microsoft.com/en-us/library/system.servicemodel.syndication.syndicationfeed.aspx)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-11T18:35:19.570

对于内置的，没有什么可以阻止您使用 XmlDocument 或 XDocument (3.5) 来构建 RSS 所需的 XML。不过，这比它的价值还要多。

我使用[Argotic Syndication Framework](http://www.codeplex.com/Argotic)并通过通用处理程序 (.ashx) 提供内容类型设置为 text/xml 的提要。

RSSToolkit[也](http://www.codeplex.com/ASPNETRSSToolkit)不错。如果你喜欢这种东西，它会附带一个 RSSDataSource 控件。它还包括一个控件，该控件将自动插入浏览器中提要自动发现所需的元标记。但是，我发现用于创建提要的构建提供程序有点笨拙。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-11T18:32:51.823

这是由 Microsoft 开发人员创建的 RSS 框架：[ASP.NET RSS Toolkit](http://www.codeplex.com/ASPNETRSSToolkit)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-11T18:41:36.047

使用可用于生成实际 RSS 的库之一。例如：[http ://www.rssdotnet.com/](http://www.rssdotnet.com/)

如果您查看底部的代码示例页面： [http](http://www.rssdotnet.com/documents/code_examples.html) ://www.rssdotnet.com/documents/code_examples.html ，您将找到用于清除 ASP.net 页面中的内容类型并输出 RSS 的代码。

类似于（未测试，未编译，仅键入）的内容：

```
public void PageLoad()
{

// create channel
RssChannel _soChannel = new RssChannel();

// create item
RssItem _soItem = new RssItem();
_soItem.Title = "Answer";
_soItem.Description = "Example";
_soItem.PubDate = DateTime.Now.ToUniversalTime();

// add to channel
_soChannel.Items.Add(_soItem.);

// set channel props
_soChannel.Title = "Stack Overflow";
_soChannel.Description = "Great site.. jada jada jada";
_soChannel.LastBuildDate = DateTime.Now.ToUniversalTime();

// change type and send to output
RssFeed _f = new RssFeed();
_f.Channels.Add(channel);
Response.ContentType = "text/xml";
_f.Write(Response.OutputStream);
Response.End();

} 
```

希望有帮助。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-11T19:12:08.390

你可以看看Argotic。这是一个非常酷的框架。

[http://www.codeplex.com/Argotic](http://www.codeplex.com/Argotic)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-06-11T21:02:29.257

创建 HTTP 处理程序以创建 RSS 提要

# ant - 有没有更简单的方法可以部署到 WebSphere？

> ID：57291
> 
> 赞同：10
> 
> 时间：2008-09-11T18:32:33.587
> 
> 标签：ant, jakarta-ee, websphere, jacl

我已经看到[这个](https://stackoverflow.com/questions/4046/can-someone-give-me-a-working-example-of-a-buildxml-for-an-ear-that-deploys-in)关于使用 WAS ant 任务部署到 WebSphere 的问题。

有没有更简单的方法来做到这一点？过去，我通过将战争文件放入目录中来部署到 Tomcat。我希望 WebSphere 有一个类似的机制，它不涉及调用 IBM 库或依赖 RAD 安装在您的工作站上。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-11T14:27:46.830

只是一个提示：如果您在系统管理/控制台首选项中激活“记录命令辅助命令”，您将在服务器日志目录中获得一个日志文件，其中包含您在控制台上执行的所有操作的 jython 脚本。所以你可以第一次在每个控制台部署你的东西，然后获取命令供以后使用，并将它们输入到`wsadmin.bat -lang jython "thecommandscomehere"`下一次部署中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-11T18:41:40.397

一种方法是使用[Jython 或 jacl 脚本](http://www.ibm.com/developerworks/websphere/library/samples/SampleScripts.html)。在 IBM 站点上查看这些示例。

**[编辑]**特别是`wsadminlib.py.zip`页面底部附近的下载包含大量示例和帮助函数，可帮助您入门。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-19T08:39:33.740

有[WebSphere Rapid Deployment](http://publib.boulder.ibm.com/infocenter/wasinfo/v6r1/index.jsp?topic=/com.ibm.etools.wrd.freeform.doc/topics/cwrdrapid.html)的概念。它应该与您为 Tomcat 描述的体验相同。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T22:41:26.487

WAS 确实提供了一个包含一些自定义 ant 任务的客户端 jar。然而，它们似乎非常有问题，并且不能与远程服务器一起使用。

[IBM ANT 任务 Javadoc](http://publib.boulder.ibm.com/infocenter/wasinfo/v6r1/index.jsp?topic=/com.ibm.websphere.javadoc.doc/public_html/api/com/ibm/websphere/ant/tasks/InstallApplication.html)

Netbeans 也支持 was 6 和 6.1，但这仍然有很多错误，但是它对于生成一些绑定文件等很有用。

# spring - 基于 Spring 2.5 构建的业务应用程序验证框架

> ID：57314
> 
> 赞同：0
> 
> 时间：2008-09-11T18:43:19.940
> 
> 标签：spring, validation

为基于 Spring 2.5 的中型企业级业务应用程序编写验证层的最佳策略是什么？

我知道 Spring 提供了工具，我们可以在其中实现 Validator 接口并在 validate 方法中编写验证逻辑。但这将仅限于通过 spring 控制器传入的 web 请求。

我想开发可以在 Web 服务调用期间使用的验证框架。

换句话说，框架可以保留和独立调用，而不需要实现 Validator 接口，然后它也可以自动集成到 Spring MVC 流中。

希望你明白我的意思。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-11T19:37:21.793

Spring Validation 框架可以在 Spring MVC 之外使用。您使用的是什么 WebServices 堆栈？如果您使用的是 Spring-WS（Spring 的 Web 服务堆栈），他们有关于如何在此处设置验证器的特殊说明：

[http://static.springframework.org/spring-ws/sites/1.5/reference/html/server.html#d0e2313](http://static.springframework.org/spring-ws/sites/1.5/reference/html/server.html#d0e2313)

如果您正在使用其他堆栈，则为该堆栈（或找到一个）实现将使用 Spring 验证框架的某些东西可能更容易。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-15T21:42:51.990

回想一下 Validator 接口定义了两个方法：

```
boolean supports(Class clazz)
void validate(Object target, Errors errors) 
```

这`Object target`是您的表单对象，它是代表要向用户显示的页面的整个对象。Errors 实例将包含将显示给用户的错误。

因此，您需要做的是定义一个中介，该中介可以使用您想要验证的表单中的细节调用，这些细节也与您的 Web 服务中的相同。中介可以采取以下两种形式之一：

1.  （可能是最好的）：

    ```
    public interface ErrorReturning { 
        public void getErrors(Errors errors);
    } 
    ```

2.  （如果添加了两个以上的状态，这会变得非常难看）：

    ```
    public interface ValidationObject {
        public Errors getErrors(Errors errors);
        public Object getResultOfWebServiceValidation();
    } 
    ```

我建议实施第一种方法。使用您的通用验证，传递一个可直接用于 Web 服务验证的对象，但允许它实现该`getErrors()`方法。这样，在您的 Spring 验证器中，在您的验证方法中，您可以简单地调用：

```
getCommonValidator().validate(partialObject).getErrors(errors); 
```

您的 Web 服务将基于`getCommonValidator().validate(partialObject)`对要在 Web 服务中使用的直接对象的调用。

第二种方法是这样的，尽管该接口只允许从给定对象返回一个对象以用于 Web 服务验证对象，而不是该对象本身就是一个可用的 Web 服务验证对象。

# asp.net - 是否有一种简单的方法可以RegularExpressionValidator在忽略空白的同时使用控件？ 我可以使用带有Regexand的自定义验证器控件IgnorePatternWhitespace，但最好 问问题 Joe90 问问题 2008-09-11T18:47:54.453 1035 次 This question shows research effort; it is useful and clear 3 This question does not show any research effort; it is unclear or not useful Bookmark this question. Show activity on this post. 是否有一种简单的方法可以RegularExpressionValidator在忽略空白的同时使用控件？ 我可以使用带有Regexand的自定义验证器控件IgnorePatternWhitespace，但最好在RegularExpressionValidator控件中有一个选项。 请记住，正则表达式验证器也希望使用 javascript 进行验证，因此您要确保您的表达式适用于 .Net 和 javascript 正则表达式引擎。这意味着使用 .IgnorePatterWhitespace 并不是最好的主意。 asp.netregex 4 2 回答 2 This answer is useful 2 包围你的正则表达式 （？X： ） 所以 "ab c" 变成 "(?x:abc) 于 2008-09-11T19:44:26.020 回答 This answer is useful 0 请记住，正则表达式验证器也希望使用 javascript 进行验证，因此您要确保您的表达式适用于 .Net 和 javascript 正则表达式引擎。这意味着使用 .IgnorePatterWhitespace 并不是最好的主意。 于 2008-09-11T18:49:46.837 回答 Related 1 asp.net-mvc-3 - 缓存维度和属性详细信息 1 asp.net - 我可以使用 Entity Framework 操作存储过程的内容吗 1 java - Generic Generics：“令牌“扩展”的语法错误，预期” 2 javascript - jquery加载时不显示标记图标 2 list - (>>) 是否应该丢弃所有左侧输出？ 5 java - java.lang.Thread 静态方法如何工作？ 2 java - Spring aspectj 注释切入点 3 javascript - 使用边距的 CSS3 textarea 布局 1 c# - 如何用新创建的节点替换 TreeView 的选定节点 1 apache - HAproxy - 代理整个 IP Reference php × 1429865 c/c++ × 756500 nginx × 49975 mongodb × 159057 mybatis × 3233 anaconda × 13410 pycharm × 14671 python × 1902243 vscode × 56040 docker × 110988 github × 49000 flask × 49129 ffmpeg × 24037 jmeter × 16910 matplotlib × 63493 bootstrap × 54641

> ID：57322
> 
> 赞同：3
> 
> 时间：
> 
> 标签：asp.net, regex

是否有一种简单的方法可以`RegularExpressionValidator`在忽略空白的同时使用控件？

我可以使用带有`Regex`and的自定义验证器控件`IgnorePatternWhitespace`，但最好在`RegularExpressionValidator`控件中有一个选项。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-11T19:44:26.020

包围你的正则表达式

> （？X： ）

所以 "ab c" 变成 "(?x:abc)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T18:49:46.837

请记住，正则表达式验证器也希望使用 javascript 进行验证，因此您要确保您的表达式适用于 .Net 和 javascript 正则表达式引擎。这意味着使用 .IgnorePatterWhitespace 并不是最好的主意。

# visual-studio - 按下开始调试按钮时，如何停止丢失所有 IDE 窗口位置？

> ID：57345
> 
> 赞同：3
> 
> 时间：2008-09-11T18:59:16.220
> 
> 标签：visual-studio, visual-studio-2008

我使用 Visual Studio 2008。我以前从未见过这种行为，据我所知，我没有更改选项中的任何内容。

当我按下开始调试所有可能的窗口（手表 1 - 4）时，数据源、属性、寄存器（老实说我以前什至从未见过这些窗口）出现在代码窗口的前面，并在我停止后停留在那里调试器。

任何人都知道可能导致这种情况的原因是什么？（我使用 CodeRush 和 Refactor 已经有一段时间了）

当我关闭并重新启动 Visual Studio 时，所有窗口都在它们应该在的位置。

PS：以前我看到过从正常模式到调试模式的正常切换，然后又返回了一些重新定位的更改。这就是它过去的工作方式。现在不是。它突然变得疯狂，当进入调试模式时，它有时会显示所有可能的 IDE 窗口，有时不会。当它这样做时，它不再返回到以前的状态。我在任何地方的选项中都找不到这个。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-11T19:07:26.747

Visual Studio*记住*2 组窗口布局，正常模式和调试模式。我的解决方案是按照我想要的方式排列我的普通窗口，然后开始调试应用程序并再次按照我想要的方式排列所有窗口，通常使其尽可能类似于我的*正常*布局，然后停止调试器并执行文件退出，以便 VS 保存我的设置。

之后，它每次都会想起我的 2 个不同的布局。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T19:01:39.633

我遇到了同样的事情 - 每当调试器运行时，将焦点切换回 IDE 会立即导致调试面板展开。

我最终只是固定了调试面板，以便它在调试时始终出现，并根据需要更改其高度。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T19:12:39.263

要添加到苍白马，另一个提示是[全屏](http://blogs.msdn.com/saraford/archive/2007/08/09/did-you-know-visual-studio-has-a-full-screen-mode.aspx)模式。

# c# - How do I get the current user's Local Settings folder path in C#?

> ID：57350
> 
> 赞同：23
> 
> 时间：2008-09-11T19:03:01.797
> 
> 标签：c#, .net, windows

I want to point a file dialog at a particular folder in the current user's Local Settings folder on Windows. What is the shortcut to get this path?

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-09-11T19:08:43.373

How about this, for example:

```
String appData = 
    Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData); 
```

I don't see an enum for just the Local Settings folder.

[http://web.archive.org/web/20080303235606/http://dotnetjunkies.com/WebLog/nenoloje/archive/2007/07/07/259223.aspx](http://web.archive.org/web/20080303235606/http://dotnetjunkies.com/WebLog/nenoloje/archive/2007/07/07/259223.aspx) has a list with examples.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-08-07T06:50:36.777

```
string localPath = Directory.GetParent(Environment.GetFolderPath(Environment.SpecialFolder.LocalApplicationData)).FullName; 
```

is the simple answer.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T19:08:15.577

Environment.GetFolderPath( Environment.SpecialFolders.LocalApplicationData);?

I can't remember if there is a "Local Settings" folder on Windows XP anymore, it seems vaguely familiar.

# c++ - 构造结构&

> ID：57355
> 
> 赞同：8
> 
> 时间：2008-09-11T19:05:57.813
> 
> 标签：c++, constants

我很难弄清楚 const 在特定情况下的确切应用方式。这是我的代码：

```
struct Widget
{
    Widget():x(0), y(0), z(0){}

    int x, y, z;
};

struct WidgetHolder //Just a simple struct to hold four Widgets.
{
    WidgetHolder(Widget a, Widget b, Widget c, Widget d): A(a), B(b), C(c), D(d){}

    Widget& A;
    Widget& B;
    Widget& C;
    Widget& D;
};

class Test //This class uses four widgets internally, and must provide access to them externally.
{
    public:
        const WidgetHolder AccessWidgets() const
        {
            //This should return our four widgets, but I don't want anyone messing with them.
            return WidgetHolder(A, B, C, D);
        }

        WidgetHolder AccessWidgets()
        {
            //This should return our four widgets, I don't care if they get changed.
            return WidgetHolder(A, B, C, D);
        }

    private:
        Widget A, B, C, D;
};

int main()
{
    const Test unchangeable;

    unchangeable.AccessWidgets().A.x = 1; //Why does this compile, shouldn't the Widget& be const?
} 
```

基本上，我有一个名为 test 的类。它在内部使用了四个小部件，我需要它来返回这些小部件，但如果 test 被声明为 const，我希望小部件也返回 const。

有人可以向我解释为什么 main() 中的代码可以编译吗？

非常感谢你。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-11T19:40:07.137

您需要创建一个专门用于保存 const Widget& 对象的新类型。IE：

```
 struct ConstWidgetHolder
{
    ConstWidgetHolder(const Widget &a, const Widget &b, const Widget &c, const Widget &d): A(a), B(b), C(c), D(d){}

    const Widget& A;
    const Widget& B;
    const Widget& C;
    const Widget& D;
};

class Test
{
public:
    ConstWidgetHolder AccessWidgets() const
    {
        return ConstWidgetHolder(A, B, C, D);
    } 

```

您现在将收到以下错误（在 gcc 4.3 中）：

```
widget.cc：在函数“int main()”中：
widget.cc:51：错误：在只读结构中分配数据成员“Widget::x”

```

在带有迭代器的标准库中使用了一个类似的习惯用法，即：

```
 class vector {
    iterator begin();
    const_iterator begin() const; 

```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-11T19:09:14.857

unchangeable.AccessWidgets():

此时，您正在创建一个 WidgetHolder 类型的新对象。此对象不受 const 保护。

您还在 WidgetHolder 中创建新的小部件，而不是对 Wdiget 的引用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-11T19:11:15.007

您`WidgetHolder`将持有无效的引用（指针）。您将堆栈上的对象传递给构造函数，然后保存对其（临时）地址的引用。这是保证打破。

**您应该只将引用分配给与引用本身具有相同（或更长）生命周期的对象。**

如果必须持有引用，则将引用传递给构造函数。更好的是，根本不要持有参考资料，而只是制作副本。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-11T19:14:59.427

这是可以编译的，因为尽管 WidgetHolder 是一个 const 对象，但这种 const 特性不会自动应用于指向（引用）WidgetHolder 的对象。在机器级别考虑它 - 如果 WidgetHolder 对象本身保存在只读内存中，您仍然可以写入 WidgetHolder 指向的内容。

问题似乎出在这一行：

```
WidgetHolder(Widget a, Widget b, Widget c, Widget d): A(a), B(b), C(c), D(d){} 
```

正如弗兰克所说，您在 WidgetHolder 类中的引用将在构造函数返回后保存无效引用。因此，您应该将其更改为：

```
WidgetHolder(Widget &a, Widget &b, Widget &c, Widget &d): A(a), B(b), C(c), D(d){} 
```

完成此操作后，它将无法编译，我将其作为练习留给读者解决其余的解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-12T09:08:09.097

编辑：他删除了他的答案，让我看起来有点愚蠢:)

火焰的答案是危险的错误。他的 WidgetHolder 在构造函数中引用了一个值对象。构造函数返回后，按值传递的对象将被销毁，因此您将持有对已销毁对象的引用。

使用他的代码的一个非常简单的示例应用程序清楚地表明了这一点：

```
#include <iostream>

class Widget
{
    int x;
public:
    Widget(int inX) : x(inX){}
    ~Widget() {
    std::cout << "widget " << static_cast< void*>(this) << " destroyed" << std::endl;
     }
};

struct WidgetHolder
{
    Widget& A;

public:
    WidgetHolder(Widget a): A(a) {}

    const Widget& a() const {
    std::cout << "widget " << static_cast< void*>(&A) << " used" << std::endl;
    return A;
}

};

int main(char** argv, int argc)
{
Widget test(7);
WidgetHolder  holder(test);
Widget const & test2 = holder.a();

return 0;
} 
```

输出将类似于

```
小部件 0xbffff7f8 被破坏
小部件 0xbffff7f8 已使用
小部件 0xbffff7f4 被破坏

```

为了避免这种情况，WidgetHolder 构造函数应该引用它想要存储为引用的变量。

```
结构 WidgetHolder
{
    小部件&A;

上市：
    WidgetHolder(Widget & a): A(a) {}

  /* ... */

};

```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-15T13:01:28.810

最初的查询是如果包含类是 const，如何将 WidgetHolder 作为 const 返回。C++ 使用 const 作为函数签名的一部分，因此您可以拥有同一函数的 const 和非 const 版本。当实例为非 const 时调用 none const ，当实例为 const 时调用 const 。因此，一种解决方案是通过函数而不是直接访问小部件持有者中的小部件。我在下面创建了一个更简单的示例，我相信它可以回答原始问题。

```
#include <stdio.h>

class Test
{
public:
  Test(int v){m_v = v;}
 ~Test(){printf("Destruct value = %d\n",m_v);}

 int& GetV(){printf ("None Const returning %d\n",m_v); return m_v;  }

 const int& GetV() const { printf("Const returning %d\n",m_v); return m_v;}
private:
  int m_v;
};

void main()
{
  // A none const object (or reference) calls the none const functions
  // in preference to the const
  Test one(10);
  int& x = one.GetV();
  // We can change the member variable via the reference
  x = 12;

  const Test two(20);
  // This will call the const version  
  two.GetV();

  // So the below line will not compile
  // int& xx = two.GetV();

  // Where as this will compile
  const int& xx = two.GetV();

  // And then the below line will not compile
  // xx = 3;

} 
```

就原始代码而言，我认为将 WidgetHolder 作为 Test 类的成员，然后返回对它的 const 或无 const 引用，并使 Widgets 成为持有者的私有成员，并提供一个每个小部件的 const 和无 const 访问器。

```
class WidgetHolder {
...

Widget& GetA();
const Widget& GetA() const;
...
}; 
```

然后在主课上

```
class Test {
...
WigetHolder& AccessWidgets() { return m_Widgets;}
const WidgetHolder&AcessWidgets() const { return m_Widgets;}

private:
  WidgetHolder m_Widgets;
...
}; 
```

# svn - 如何在 VSS 和 SVN 之间同步

> ID：57372
> 
> 赞同：9
> 
> 时间：2008-09-11T19:12:04.693
> 
> 标签：svn, visual-sourcesafe, sync

我被迫在工作中使用 VSS，但将 SVN 用于个人存储库。在 VSS 和同步之间进行同步的最佳方式是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-11T19:23:32.013

为了摆脱手动合并步骤，我可以使用一个单独的 svn 分支（svn://branches/VSS），如下所示：

1.  创建 svn://branches/VSS 的工作副本
2.  对此工作副本执行 VSS 获取最新信息
3.  svn 提交
4.  svn 从 svn://trunk 合并
5.  svn 提交
6.  做一个 VSS 差异并检查所有有差异的文件（不覆盖）
7.  签入这些文件
8.  将 svn://branches/VSS 重新整合到 svn://trunk

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T14:41:13.000

您也可以将其视为红豆书中定义的供应商提供的分支： [供应商分支](http://svnbook.red-bean.com/nightly/en/svn.advanced.vendorbr.html)

有了这个，基本流程将是：

1.  有一个供应商分支“分支/VSS/current”，其中包含来自 VSS 的最新代码
2.  将当前版本标记为“branches/VSS/2008-09-15”
3.  第二天，将新文件放入“当前”
4.  再次标记到“branches/VSS/2008-09-16”
5.  将两个标签之间的差异合并到主干中，解决冲突
6.  根据需要删除旧标签

这实际上是我们从 VSS 迁移到 SVN 时使用的技术。如果您关心从 SVN->VSS 的回程，您只需要区分主干和分支/VSS/当前之间的差异并将差异应用于 VSS。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T19:16:25.743

我过去所做的如下：

1.  确保我所有的更改都提交给 svn://trunk
2.  从 VSS 获取最新信息到我的工作副本中。
3.  手动合并我的工作副本中的更改。
4.  将合并后的代码提交到 svn://trunk
5.  做一个 VSS 差异并检查任何有差异的文件（不覆盖文件）
6.  签入这些文件。

# caching - 网页缓存 setexpires

> ID：57380
> 
> 赞同：2
> 
> 时间：2008-09-11T19:17:24.913
> 
> 标签：caching

如果服务器上的时钟早于客户端上的时钟，下面的代码会起作用吗？

```
Response.Cache.SetExpires(DateTime.Now.AddSeconds(-1)) 
```

编辑：我问的原因是在我们的一个网络应用程序上，一些用户声称他们正在查看以前使用该机器的用户的页面（帐号等）。然而，我们使用上面的线和其他线来“防止”这种情况发生。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-11T19:29:10.080

[这个问题](https://stackoverflow.com/questions/49547/making-sure-a-webpage-is-not-cached-across-all-browsers)包括确保网页没有被缓存。似乎您必须设置几个属性以确保网页不会在所有浏览器中缓存。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T19:33:04.563

您的问题可能是由浏览器记住输入到表单字段中的数据引起的。您可以像这样关闭它：

```
<input autocomplete="off"> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T21:32:44.200

据我所知，浏览器将根据本地时钟检查到期日期（尽管它会考虑时区），因此如果客户端的时钟不准确，您问题中的代码可能无法按预期工作。最常见的是，当他们的时间看起来正确但设置为错误的时区时，就会发生这种情况，这意味着 UTC 时间戳实际上相差了几个小时。

您可以尝试设置一个更旧的时间戳，例如：0000 1970 年 1 月 1 日 GMT（纪元）

我认为您拥有的代码应该与服务器端缓存一起使用，但您可以更明确地禁用它：

```
Response.Cache.SetNoServerCaching(); 
```

# c# - C# .Net 中的输出控件

> ID：57382
> 
> 赞同：6
> 
> 时间：2008-09-11T19:17:49.920
> 
> 标签：c#, .net, obout

有人在 C# .Net 中使用 Obout 控件吗？您如何评价这些控件，尤其是网格控件？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-16T18:06:44.073

我对他们印象深刻。在所有其他控件中（infragistics，telerik），这是我使用过的唯一（超过）受人尊敬的控件，它是 1）免费的！2）轻量级！Obout 唯一需要注意的是，我在合并其中一些控件和一些库存 AJAX 组件时遇到了麻烦。

到目前为止，Infragistics 是我最喜欢的（我对 Obout 是“轻量级”的评论是与在某些 Infragistics 控件中大量使用视图状态相比），但它大约是 1000-1500 个座位，所以如果你有一个更大的座位，它可能会变得昂贵团队。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-16T19:50:13.673

我喜欢他们的轻量级。他们的许可政策非常公平（支付一次终身免费更新），他们还提供（免费）教育许可。

但是，我不得不在我的一个项目中使用 Developer Express，此后再也没有回头。非常强大，不像 Infragistics 那样臃肿。

基本上，如果你决定走上一条路，你可能不会后悔。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-11T00:13:56.680

我喜欢 obout 的简单性和功能性。他们有很好的文档和几乎所有东西的样本。而且它们的价格比其他产品低一小部分（Componentart/Telerik）。我目前正在测试他们的网格控件（在我放弃了 Componentart 网格以获得客户端功能之后）并发现它非常简单。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-26T20:20:35.477

我几年前购买了许可证，从那以后一直在使用它。支持非常好，控制也很棒。我查看了其他一些供应商（telerik 等），但由于成本转换而没有搬到任何地方。obout 的好处是我几年前买的，他们仍然给我免费更新。这在未来可能会改变，但就目前而言，它很棒。产品按预期工作，并且他们总是对软件进行更新。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-06-05T15:08:33.803

这是我第一次使用 obout 控件。以前，我使用的是 Telerik 控件，因此，我很有机会比较这两组控件。我更喜欢 Obout，因为它重量轻且功能强大。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-11T19:40:23.453

我用他们的树做一个项目。对于免费控件来说还不错。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-02-22T21:42:08.593

我已经使用他们的日历控件将近 2 年了。它突然停止在 Google Chrome 上运行（Vr：17.0.963.56 m）。即使他们的现场演示也不起作用，尝试滚动几个月，它只会挂起错误“未捕获的类型错误：这不是日期对象。”。

我已经就这个问题给公司发了两次电子邮件，因为它使我的网站瘫痪了，而且我让客户不断地联系我。恐怕至今没有回复！！非常沮丧！

真的很遗憾，因为该工具在其他方面非常出色......如果他们至少可以承认错误并向我保证他们正在研究一个可行的解决方案，但被留在黑暗中表明完全缺乏基本的客户服务礼仪。

# c# - 如何在 C# 中重新抛出 InnerException 而不会丢失堆栈跟踪？

> ID：57383
> 
> 赞同：345
> 
> 时间：2008-09-11T19:17:52.090
> 
> 标签：c#, .net, exception

我正在通过反射调用一个可能导致异常的方法。如何在没有包装反射的情况下将异常传递给调用者？
我正在重新抛出 InnerException，但这会破坏堆栈跟踪。
示例代码：

```
public void test1()
{
    // Throw an exception for testing purposes
    throw new ArgumentException("test1");
}

void test2()
{
    try
    {
        MethodInfo mi = typeof(Program).GetMethod("test1");
        mi.Invoke(this, null);
    }
    catch (TargetInvocationException tiex)
    {
        // Throw the new exception
        throw tiex.InnerException;
    }
} 
```

* * *

## 回答 #1

> 赞同：542
> 
> 时间：2013-06-13T15:42:46.940

在**.NET 4.5**中现在有这个[`ExceptionDispatchInfo`](https://docs.microsoft.com/en-us/dotnet/api/system.runtime.exceptionservices.exceptiondispatchinfo)类。

这使您可以在不更改堆栈跟踪的情况下捕获异常并重新抛出它：

```
using ExceptionDispatchInfo = 
    System.Runtime.ExceptionServices.ExceptionDispatchInfo;

try
{
    task.Wait();
}
catch(AggregateException ex)
{
    ExceptionDispatchInfo.Capture(ex.InnerException).Throw();
} 
```

这适用于任何异常，而不仅仅是`AggregateException`.

它是由于`await`C# 语言特性而引入的，该特性从实例中解开内部异常，`AggregateException`以使异步语言特性更像同步语言特性。

* * *

## 回答 #2

> 赞同：87
> 
> 时间：2010-01-18T10:42:22.577

可以**在**重新抛出之前保留堆栈跟踪而不进行反射：

```
static void PreserveStackTrace (Exception e)
{
    var ctx = new StreamingContext  (StreamingContextStates.CrossAppDomain) ;
    var mgr = new ObjectManager     (null, ctx) ;
    var si  = new SerializationInfo (e.GetType (), new FormatterConverter ()) ;

    e.GetObjectData    (si, ctx)  ;
    mgr.RegisterObject (e, 1, si) ; // prepare for SetObjectData
    mgr.DoFixups       ()         ; // ObjectManager calls SetObjectData

    // voila, e is unmodified save for _remoteStackTraceString
} 
```

与通过缓存委托调用相比，这浪费了很多周期`InternalPreserveStackTrace`，但具有仅依赖公共功能的优势。以下是堆栈跟踪保留函数的一些常见使用模式：

```
// usage (A): cross-thread invoke, messaging, custom task schedulers etc.
catch (Exception e)
{
    PreserveStackTrace (e) ;

    // store exception to be re-thrown later,
    // possibly in a different thread
    operationResult.Exception = e ;
}

// usage (B): after calling MethodInfo.Invoke() and the like
catch (TargetInvocationException tiex)
{
    PreserveStackTrace (tiex.InnerException) ;

    // unwrap TargetInvocationException, so that typed catch clauses 
    // in library/3rd-party code can work correctly;
    // new stack trace is appended to existing one
    throw tiex.InnerException ;
} 
```

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2008-09-11T19:20:00.400

我认为你最好的选择就是把它放在你的 catch 块中：

```
throw; 
```

然后稍后提取内部异常。

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2016-11-14T10:28:48.990

`ExceptionDispatchInfo.Capture( ex ).Throw()`没有人解释和 plain之间的区别`throw`，所以在这里。

重新抛出捕获的异常的完整方法是使用`ExceptionDispatchInfo.Capture( ex ).Throw()`（仅适用于 .Net 4.5）。

以下是对此进行测试所需的案例：

1.

```
void CallingMethod()
{
    //try
    {
        throw new Exception( "TEST" );
    }
    //catch
    {
    //    throw;
    }
} 
```

2.

```
void CallingMethod()
{
    try
    {
        throw new Exception( "TEST" );
    }
    catch( Exception ex )
    {
        ExceptionDispatchInfo.Capture( ex ).Throw();
        throw; // So the compiler doesn't complain about methods which don't either return or throw.
    }
} 
```

3.

```
void CallingMethod()
{
    try
    {
        throw new Exception( "TEST" );
    }
    catch
    {
        throw;
    }
} 
```

4.

```
void CallingMethod()
{
    try
    {
        throw new Exception( "TEST" );
    }
    catch( Exception ex )
    {
        throw new Exception( "RETHROW", ex );
    }
} 
```

案例 1 和案例 2 将为您提供堆栈跟踪，其中`CallingMethod`方法的源代码行号是该行的行号`throw new Exception( "TEST" )`。

但是，案例 3 将为您提供堆栈跟踪，其中方法的源代码行号是调用`CallingMethod`的行号。`throw`这意味着如果该`throw new Exception( "TEST" )`行被其他操作包围，您将不知道实际抛出异常的行号。

情况 4 与情况 2 类似，因为保留了原始异常的行号，但不是真正的重新抛出，因为它改变了原始异常的类型。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2009-11-02T20:39:15.773

```
public static class ExceptionHelper
{
    private static Action<Exception> _preserveInternalException;

    static ExceptionHelper()
    {
        MethodInfo preserveStackTrace = typeof( Exception ).GetMethod( "InternalPreserveStackTrace", BindingFlags.Instance | BindingFlags.NonPublic );
        _preserveInternalException = (Action<Exception>)Delegate.CreateDelegate( typeof( Action<Exception> ), preserveStackTrace );            
    }

    public static void PreserveStackTrace( this Exception ex )
    {
        _preserveInternalException( ex );
    }
} 
```

在抛出异常之前调用异常的扩展方法，它将保留原始堆栈跟踪。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2019-07-16T08:09:40.500

根据 Paul Turners 的回答，我做了一个扩展方法

```
 public static Exception Capture(this Exception ex)
    {
        ExceptionDispatchInfo.Capture(ex).Throw();
        return ex;
    } 
```

`return ex`从来没有达到过，但优点是我可以用作`throw ex.Capture()`一个衬里，这样编译器就不会引发`not all code paths return a value`错误。

```
 public static object InvokeEx(this MethodInfo method, object obj, object[] parameters)
    {
        {
            return method.Invoke(obj, parameters);
        }
        catch (TargetInvocationException ex) when (ex.InnerException != null)
        {
            throw ex.InnerException.Capture();
        }
    } 
```

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2008-09-11T19:20:25.967

更多的反思...

```
catch (TargetInvocationException tiex)
{
    // Get the _remoteStackTraceString of the Exception class
    FieldInfo remoteStackTraceString = typeof(Exception)
        .GetField("_remoteStackTraceString",
            BindingFlags.Instance | BindingFlags.NonPublic); // MS.Net

    if (remoteStackTraceString == null)
        remoteStackTraceString = typeof(Exception)
        .GetField("remote_stack_trace",
            BindingFlags.Instance | BindingFlags.NonPublic); // Mono

    // Set the InnerException._remoteStackTraceString
    // to the current InnerException.StackTrace
    remoteStackTraceString.SetValue(tiex.InnerException,
        tiex.InnerException.StackTrace + Environment.NewLine);

    // Throw the new exception
    throw tiex.InnerException;
} 
```

请记住，这可能随时中断，因为私有字段不是 API 的一部分。[请参阅有关Mono bugzilla](https://bugzilla.novell.com/show_bug.cgi?id=425512)的进一步讨论。

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2008-09-11T19:22:57.770

第一：不要丢失 TargetInvocationException - 当您想要调试事物时，它是有价值的信息。
第二：将 TIE 作为 InnerException 包装在您自己的异常类型中，并放置一个 OriginalException 属性，该属性链接到您需要的内容（并保持整个调用堆栈完好无损）。
第三：让 TIE 从你的方法中消失。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2010-01-02T17:48:10.210

伙计们，你很酷……我很快就会成为一名死灵法师。

```
 public void test1()
    {
        // Throw an exception for testing purposes
        throw new ArgumentException("test1");
    }

    void test2()
    {
            MethodInfo mi = typeof(Program).GetMethod("test1");
            ((Action)Delegate.CreateDelegate(typeof(Action), mi))();

    } 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2012-04-03T08:19:24.807

另一个使用异常序列化/反序列化的示例代码。它不需要实际的异常类型是可序列化的。它也只使用公共/受保护的方法。

```
 static void PreserveStackTrace(Exception e)
    {
        var ctx = new StreamingContext(StreamingContextStates.CrossAppDomain);
        var si = new SerializationInfo(typeof(Exception), new FormatterConverter());
        var ctor = typeof(Exception).GetConstructor(BindingFlags.NonPublic | BindingFlags.Instance, null, new Type[] { typeof(SerializationInfo), typeof(StreamingContext) }, null);

        e.GetObjectData(si, ctx);
        ctor.Invoke(e, new object[] { si, ctx });
    } 
```

# security - 非对称密钥容器的互转换性（例如：X.509、PGP、OpenSSH）

> ID：57384
> 
> 赞同：5
> 
> 时间：2008-09-11T19:18:21.010
> 
> 标签：security, ssh, cryptography, x509, gnupg

非对称加密密钥基本上可以在主要密钥容器格式之间相互转换吗？例如，我可以将 X.509 密钥文件转换为 PGP 或 OpenGPG 密钥文件吗？

并且 - 假设答案是肯定的 - 将一对密钥以任何格式保存并转换为该场合所需的任何容器文件格式是否“安全中立”？

我有点厌倦了为 X.509、OpenGPG 和 SSH 维护这么多密钥对，因为它们的核心都是 RSA。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-11T19:29:23.747

是与否：是的，嵌入到证书和私钥中的 RSA 密钥只是数字。您可以从证书中提取它们并使用它们来构建其他格式的密钥。这通常用于在不同的证书格式之间进行转换。

PGP 对 S/MIME 的 X.509 有一些支持，但不能逐字使用 X.509 私钥。

SSH 对直接使用 X.509 密钥和证书有一些 beta 支持。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-03-25T13:38:18.577

您会发现如何在这些容器之间转换 kes： [http ://sysmic.org/dotclear/index.php?post/2010/03/24/Convert-keys-betweens-GnuPG,-OpenSsh-and-OpenSSL](http://sysmic.org/dotclear/index.php?post/2010/03/24/Convert-keys-betweens-GnuPG,-OpenSsh-and-OpenSSL)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-27T12:21:03.873

我还想看看 OpenSSL。它有很多不同的-in 和-out 函数，很可能能够转换证书。从一种类型到另一种类型。

看看[http://marc.info/?l=openssl-users&m=105162569405053&w=2](http://marc.info/?l=openssl-users&m=105162569405053&w=2)

# .net - 接口应该在哪里“实际存在”？

> ID：57386
> 
> 赞同：5
> 
> 时间：2008-09-11T19:18:44.817
> 
> 标签：.net, architecture

我喜欢将接口和实现分开的想法。但如何分开？接口定义是否在单独的 .Net 程序集中？您是否有一个项目来定义解决方案的所有接口？否则接口的循环依赖是否存在问题？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-11T19:22:14.997

将您的域对象和接口放在单独的“域”程序集中。
此程序集不应引用核心 .net 程序集以外的任何内容。

这样你就可以从你的域/服务模型和你的实现中得到一个清晰的分离。

*编辑：http:*
[//jeffreypalermo.com/blog/the-onion-architecture-part-1/](http://jeffreypalermo.com/blog/the-onion-architecture-part-1/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-11T19:23:30.733

我不会仅仅为了它而将接口放入单独的程序集中。但是，如果接口参与任何形式的 IPC 或可扩展性架构，那么给它们自己的程序集通常是有意义的。

如果您有需要相互引用的项目，那么是的，您将需要一个单独的接口程序集，但您还应该**仔细**检查架构，看看是否有另一种解决循环依赖的方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T19:27:31.707

我更喜欢将接口的最常见或最简单的实现保留在接口名称后面的子文件夹（和命名空间）中。

```
\项目\
\project\IAppender.cs
\项目\附加\
\project\Appender\FileAppender.cs
\project\Appender\ConsoleAppender.cs

```

如果我在项目之外扩展这个类。在一个特殊的项目中，类似地重复文件夹/命名空间。

```
\特殊项目\
\specialproject\Appender\
\specialproject\Appender\MemoryAppender.cs

```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-11T19:38:54.143

在我现在正在进行的项目中，接口和相关的基类进入在逻辑上划分为函数的程序集。这些提供程序和类的实现进入核心程序集。我们的想法是使用我们的 API 的人可以以清晰和合乎逻辑的方式引用更多或一个 API dll。

较小的应用程序不需要这种分离。但是，无论我将接口保存在哪里，我都会将它们保存在与任何基类相同的命名空间中。

# sql-server - OLTP 中的索引视图？

> ID：57406
> 
> 赞同：2
> 
> 时间：2008-09-11T19:28:28.460
> 
> 标签：sql-server, database, views, indexed, materialized

我熟悉 SQL Server 索引视图（或 Oracle 物化视图），我们在 OLAP 应用程序中使用它们。它们具有非常酷的功能，即能够篡改执行计划并将其重新映射到索引视图而无需更改现有代码。

IE。假设我有一个非常昂贵的连接 SPROC。

> SELECT [SOME COLUMNS]
> FROM Table1 INNER JOIN Table2 [DETAILS]
> INNER JOIN Table3 [BUNCH MORE JOINS] ...

如果我创建了一个包含类似结果集的索引视图，那么查询优化器很可能会将 SPROC 发送到我的索引视图，而不是基表，我会获得很大的性能提升。

现在说我想在**OLTP 中使用索引视图！？**我的意思是大多数 OLTP（比如这个站点）的阅读量相对较大，如果它们的连接成本很高，那么我们可以加快它们的速度并可能减少锁定争用（[http://www.codinghorror.com/blog/archives/001166.html](http://www.codinghorror.com/blog/archives/001166.html)）。更好的是您不必更改任何代码，只需编写索引视图。

但这也意味着数据库变得更大，因为我们需要在索引视图中保留这些数据的副本......

**有没有人使用过索引视图来解决 OLTP 中的争用或速度问题？我怎么从来没见过这个用的？**

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-07T14:20:04.360

物化视图可用于针对 OLTP 进行报告，尤其是在聚合大量行以获得结果时。空间要求完全取决于您节省了多少数据。将其视为缓存。

棘手的平衡在于报告需要多长时间的数据，以及您可以对 OLTP 性能造成多大影响。如果有些陈旧的数据是可以的，您可以在系统活动较少的时候安排对视图的更新。

有一次我不能，并且需要非常最新的数据，我最终使用了一些自定义开发。对基表的每次更新都会触发一个触发器，该触发器将记录写入事务表。该视图查看缓存的聚合，以及存储在事务表中的增量。在系统资源允许的情况下，事务作为增量事务应用于聚合表。这使我能够获得第二个数据、良好的报告性能（唯一发生的聚合是最近的事务）和数据库上的相当少的负载（每次写入的大小只会增加一倍，而不是每次都重新计算一个巨大的聚合）。

不幸的是，它维护起来很复杂，并且没有使用简单的内置工具。如果您可以等待报告数据，通常最好使用内置的物化视图并推迟刷新。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-11T19:37:51.993

我们使用物化视图来加快我工作的速度。最常用于针对 OLTP 系统的报告。我们的许多报告都是从数据仓库运行的，但由于我们会在一夜之间刷新仓库，所以目前数据必须来自 OLTP 表。

# visual-studio - 我不明白 Visual Studio 项目和解决方案的概念

> ID：57409
> 
> 赞同：9
> 
> 时间：2008-09-11T19:29:42.153
> 
> 标签：visual-studio, eclipse

在 Eclipse 中，我有一个包含我所有项目的工作区。每个项目单独构建和编译。一个项目不与另一个项目交互。

这与那里的 Visual Studio 和项目/解决方案有什么关系？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-11T19:36:30.000

VS 项目是它自己的实体。它将自行构建和编译。解决方案只是包含多个项目的一种方式。这些项目不一定需要编译其他项目（尽管它们可以依赖于其他项目）。

这只是让您在概念上将项目组合成一个大项目。例如，您可以有一个单独的测试项目。它取决于实际项目的代码，应该与实际项目一起保存，但不需要在同一个exe/dll中。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-11T19:31:16.597

每个 VS 项目都构建一个 EXE 或 DLL。解决方案只是相关项目的集合。

所以VS项目：Eclipse项目：：VS解决方案：Eclipse工作区。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-11T19:37:53.693

另一种看待它的方式是，解决方案是项目的容器。对于我的大部分工作，我将每一层创建为解决方案中的一个项目，因此我的树看起来像：

*   我的 Web 应用程序或 Win 应用程序
    *   表示层
        *   文件...
    *   业务层
        *   文件...
    *   数据访问
        *   文件

你的旅费可能会改变

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T19:38:55.173

@托马斯欧文斯：

是的，一些（大多数？）使用 Eclipse 的人拥有多个工作区。这是我第一次开始使用 Eclipse 时最让我吃惊的地方，所以我在这里回复是为了让这个评论更加明显。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-11T19:48:50.907

可能会让你失望的事情如下：

在 VS2003 中，所有东西都有一个项目文件和一个解决方案文件。如果您有一个包含一个项目的解决方案，您可以打开解决方案并查看一个项目。如果您打开项目，它会尝试创建一个新的解决方案文件来包含项目。但是 web 项目和 Winform 项目都有项目和解决方案。

在 VS2005 中，这发生了一些变化——现在默认情况下，Web 项目不再有项目文件。他们收到了一些不喜欢项目文件的 Web 开发人员的反馈——他们的看法是，如果文件在目录中，它就是应用程序的一部分。VS2005 发布后，他们从喜欢 Project 文件概念的开发人员那里得到了更多反馈，因此他们将其修补回来。这是 VS2005 中的“网站”与“Web 应用程序”（现在我不记得哪个是哪个了） .

此外，在 VS2005 中，如果您打开了一个只有一个项目的解决方案，您将不会在解决方案资源管理器中看到根本没有解决方案，您只会看到项目（好像它不在解决方案中）。只有在添加第二个项目之后，您才会看到有一个包含它们的解决方案。

所以基本上你走在了正确的轨道上——解决方案和项目在 Visual Studio 中的工作方式与在 Eclipse 中的工作方式相同，只是一些怪癖让事情变得混乱。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-11T19:38:59.777

一个解决方案有 0 个或多个项目...

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-11T21:06:37.443

Visual Studio 2008 中有太多种类的 Web 项目。有网站项目与 Web 应用程序项目，它们以不同的方式限制您。这是微软提供太多选择而不是专注于一个强大的解决方案的一个很好的例子。即使在网站项目选项中，也至少有 3 种不同的方式来编译您的应用程序。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-23T21:29:39.637

我发现在解决方案资源管理器中看到解决方案并不总是令人讨厌。选项->项目和解决方案->常规中有一个名为“始终显示解决方案”的设置，非常方便。

# ajax - Ajax 和受限的 uri

> ID：57421
> 
> 赞同：2
> 
> 时间：2008-09-11T19:37:12.307
> 
> 标签：ajax, xmlhttprequest

我想对不同的服务器（相同的域和框，只是不同的端口）进行 ajax 调用。例如

我的页面是

```
http://localhost/index.html

```

我想发出 ajax get 请求：

```
http://localhost:7076/?word=foo

```

我收到此错误：

```
拒绝访问受限 URI (NS_ERROR_DOM_BAD_URI) 

```

我知道你不能向不同的域发出 ajax 请求，但似乎这也包括不同的端口？有什么解决方法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-11T19:41:31.690

有某个页面在你的 80 端口服务器代理请求到另一个端口。例如：

```
http://localhost/proxy?port=7076&url=%2f%3fword%3dfoo 
```

请注意最后一个查询字符串参数值的 url 编码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T19:43:30.670

您可以使用 JSONP。这是您为请求指定回调的地方，来自您的 ajax 请求的响应将使用回调函数名称包装。不是使用 XmlHttpRequest，而是使用 URL 将标签插入到 HTML 文档中。然后，当检索到响应时，将调用回调函数，将数据作为参数传递。

查看此[博客文章](http://www.west-wind.com/Weblog/posts/107136.aspx)以获取示例

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T19:43:57.690

这是浏览器限制。所有 javascript 调用都必须指向脚本所在的同一服务器和端口。这将需要一些服务器端的东西来解决。IE`localhost`将请求转发到`localhost:7076`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-11T19:44:33.553

这很糟糕，但这是必要的......基本上你需要做的是通过本地代理代理你的 AJAX 请求 - 一些服务器端脚本/页面/你所在的同一域上的任何内容 - 接听电话并将其转发到其他资源服务器端。您可能可以使用一些 IFRAME 技巧，但我认为它们效果不佳......不过可能是错误的，已经有一段时间了。

# cocoa - 在程序中使用 mac 相机的示例代码？

> ID：57424
> 
> 赞同：13
> 
> 时间：2008-09-11T19:37:26.567
> 
> 标签：cocoa, language-agnostic, macos, camera

我想在程序中使用我的 Macbook 中的相机。我与语言无关——C、Java、Python 等都很好。谁能建议寻找文档或“Hello world”类型代码的最佳位置？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-11T19:53:24.250

Leopard 中的 ImageKit 框架有一个[`IKPictureTaker`](http://developer.apple.com/documentation/GraphicsImaging/Reference/IKImagePicker_Class/IKImagePicker_Reference.html#//apple_ref/occ/cl/IKPictureTaker)类，可以让您运行您在 iChat 和其他应用程序中看到的标准拍照表或面板。

如果您不想使用标准的拍照面板/工作表界面，您可以使用[QTKit Capture](http://developer.apple.com/documentation/QuickTime/Conceptual/QTKitCaptureProgrammingGuide/)功能从 iSight 获取图像。

这两者都需要在 Objective-C 中编写一些 Cocoa 代码，但如今这不应该成为真正的障碍。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-12T08:23:44.913

如果您想直接从您的代码中操作相机，您必须使用 QuickTime Capture API 或[Cocoa QTKit Capture](http://developer.apple.com/documentation/QuickTime/Conceptual/QTKitCaptureProgrammingGuide/Introduction/chapter_1_section_1.html)包装器（更好）。

唯一需要注意的是：如果您使用 QTCaptureDecompressedVideoOutput，请记住回调不是在主线程上进行的，而是在 QuickTIme 管理的捕获线程上进行的。使用 [someObject performSelectorOnMainThread:... withObject:... waitUntilDone:NO] 将消息发送到主线程上的对象。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T19:57:55.270

有一个名为 isightcapture 的实用程序，它从 unix 命令行运行，从 isight 相机拍摄照片并保存。

您可以在此网站上查看：http: [//www.macupdate.com/info.php/id/18598](http://www.macupdate.com/info.php/id/18598)

将其与 AppleScript 一起使用的示例是：

告诉应用程序“终端”执行脚本“/Applications/isightcapture myimage.jpg”结束告诉

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-02-03T21:50:37.593

从专门要求解决方案为 pythonic 的相关问题中，您应该尝试使用Andrew Straw[的 motmot 的 camiface](http://github.com/motmot/pycamiface)库。它也适用于火线相机，但也适用于您正在寻找的 isight。

从教程：

```
import motmot.cam_iface.cam_iface_ctypes as cam_iface
import numpy as np

mode_num = 0
device_num = 0
num_buffers = 32

cam = cam_iface.Camera(device_num,num_buffers,mode_num)
cam.start_camera()
frame = np.asarray(cam.grab_next_frame_blocking())
print 'grabbed frame with shape %s'%(frame.shape,) 
```

此[示例神经科学演示中使用了它](http://www.incm.cnrs-mrs.fr/LaurentPerrinet/SimpleCellDemo)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-18T07:07:44.190

Quartz Composer 也是一种在适用时捕捉和处理视频的好方法。有一个视频输入补丁。

Quartz Composer 是一个可视化编程环境，如果需要，它可以集成到更大的 Cocoa 程序中。

[http://developer.apple.com/graphicsimaging/quartz/quartzcomposer.html](http://developer.apple.com/graphicsimaging/quartz/quartzcomposer.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-01-23T22:32:22.353

另一种解决方案是[OpenCV+python](http://opencv.willowgarage.com/documentation/python/cookbook.html)，其脚本如下：

```
import cv
capture = cv.CaptureFromCAM(0)
img = cv.QueryFrame(capture) 
```

不能再简单了！

# c# - Activator.CreateInstance(string) 和 Activator.CreateInstance （） 不同之处

> ID：57439
> 
> 赞同：11
> 
> 时间：2008-09-11T19:42:33.747
> 
> 标签：c#, generics, design-patterns

不，这不是关于泛型的问题。

我有一个工厂模式，其中包含几个具有内部构造函数的类（如果不通过工厂，我不希望它们被实例化）。

我的问题是`CreateInstance`失败并出现“没有为此对象定义无参数构造函数”错误，除非我在非公共参数上传递“true”。

例子

```
// Fails
Activator.CreateInstance(type);

// Works
Activator.CreateInstance(type, true); 
```

我想让工厂通用以使其更简单，如下所示：

```
public class GenericFactory<T> where T : MyAbstractType
{
    public static T GetInstance()
    {
        return Activator.CreateInstance<T>();
    }
} 
```

但是，我无法找到如何传递该“真实”参数以使其接受非公共构造函数（内部）。

我错过了什么还是不可能的？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-09-11T19:48:43.373

为了解决这个问题，你不能像这样改变你的用法：

```
public class GenericFactory<T> where T : MyAbstractType
{
    public static T GetInstance()
    {
        return Activator.CreateInstance(typeof(T), true);
    }
} 
```

您的工厂方法仍然是通用的，但对激活器的调用不会使用通用重载。但是您仍然应该获得相同的结果。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-11T19:53:40.443

如果你绝对要求构造函数是私有的，你可以尝试这样的事情：

```
public abstract class GenericFactory<T> where T : MyAbstractType
{
    public static T GetInstance()
    {
        return (T)Activator.CreateInstance(typeof(T), true);
    }
} 
```

否则你最好添加新的约束并走这条路：

```
public abstract class GenericFactory<T> where T : MyAbstractType, new()
{
    public static T GetInstance()
    {
        return new T;
    }
} 
```

您正在尝试使用 GenericFactory 作为所有工厂的基类，而不是从头开始编写每个工厂，对吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-13T12:54:58.813

除了 Activator.CreateInstance(typeof(T), true) 工作，T 应该有默认构造函数

# c# - 从 .NET 1.1 升级到 .NET 2.0，会发生什么？

> ID：57449
> 
> 赞同：8
> 
> 时间：2008-09-11T19:48:38.257
> 
> 标签：c#, .net, vb.net, winforms, deprecated

我正在开发一个大型 .NET 1.1 项目，并且希望对其进行升级，主要是为了能够使用更好的工具，如 Visual Studio 2008，但也因为 .NET 中的新功能和更少的错误2.0 框架。

该项目包含 VB.NET 的大部分，但也有 C# 的部分。它是一个 Windows 窗体应用程序，使用各种第三方控件。使用 .NET 远程处理富客户端与与 MSSQL 2000 数据库接口的服务器进程对话。

如果我们决定执行升级，我们会遇到什么样的问题？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-15T10:43:42.773

从 .Net 2.0 开始，线程模型发生了变化，线程中未处理的异常将导致整个应用程序终止。我在更新一个执行大量线程并偶尔崩溃的应用程序时遇到了这个问题。显然 .Net 2.0 模型更健壮，因为无论如何您都应该抓住这些模型，但这是我在进行迁移时遇到的唯一真正问题。

这篇文章谈论它： http: [//odetocode.com/blogs/scott/archive/2005/12/14/2618.aspx](http://odetocode.com/blogs/scott/archive/2005/12/14/2618.aspx)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-11T20:05:01.010

我们现在正在考虑进行相同的迁移 Tobi。首先，您可以通过复制您的项目（或其中的一部分）并通过 .NET 2.0 编译器对其进行“试运行”来很好地了解预期内容。我的经验是 2.0 编译器会针对 1.1 编译器放任的不良编程实践给出更多警告。编译器会警告您有关隐式强制转换、“模糊”返回路径（函数不返回值的代码路径）和其他一些小问题。

以下是一些您可能会觉得有帮助的链接： [.NET Framework Compatability](http://msdn.microsoft.com/en-us/library/ms994381.aspx)

[.NET Framework 2.0 中的重大更改 Word 文档](http://go.microsoft.com/fwlink/?linkid=51223)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-11T19:50:13.260

真的没什么。您会发现一些关于过时方法的编译警告，但通常这些警告很容易修复。

你应该大打出手，然后选择 3.5。这里的水很niiiiiiice。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-11T19:57:08.500

看看这份关于将 .NET 2.0 应用程序升级到 3.5 的[白皮书。](http://www.ythos.net/casestudy.aspx?CaseStudyId=12)我认为从 1.1 到 2.0 的变化更显着，但过程应该是相似的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-11T20:09:14.557

除了上面提到的应用程序配置之外，如果您使用任何 XSD 验证，您将需要替换一些有关加载和验证 XML 的代码。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-16T16:58:34.067

我们处理电子邮件的方式必须改变。1.1版本使用system.WEB.mail，带有

```
 Imports System.Web.Mail
    '
    Dim message As New MailMessage' this is a web.mail msg, not a net.mail msg
    Dim objConn As SmtpMail
    Dim objAttach As MailAttachment
        '
    message .From = "From@us.com"
       ' more properties assigned to objMail
    objAttach = New MailAttachment(ExportName)
    message.Attachments.Add(objAttach)
       ' Here's where we actually send the thing
    SmtpMail.SmtpServer.Insert(0, "127.0.0.1")
    objConn.Send(objMail) 
```

新的有 system.NET.mail

```
 Imports System.Net.Mail
        '
         Dim message as MailMessage ' this is a net.mail msg, not a web.mail msg
         Dim data As Attachment
        Dim client As New SmtpClient("127.0.0.1")
    '
        data = New Attachment(ExportName)
    ' Create the message and add the attachment
        message = New MailMessage(EmailFrom, EmailTo, reportDescription)
        message.Attachments.Add(data)
' Send the message
        client.Send(message) 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-11T19:55:32.013

如果您使用 app.config 存储程序设置，您将看到的最多编译警告。System.Configuration.ConfigurationManager 不推荐使用 1.1 配置类。

您可能会看到来自编译器的其他警告将针对未初始化的变量（在变量声明中将它们设置为“= nothing”或“= null;”以使它们消失）和未使用的变量（编译器确定它们是安全删除）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-11T19:59:07.187

除了一些关于过时的东西的警告之外，大多数代码仍然应该编译。

但是对于 Visual Studio 生成的代码，您应该注意几件事。

如果您在 Visual Studio 2003 中生成了强类型数据集，您可以忘记在较新版本的 Visual Studio 中编辑它们。你必须重建它们，或者更好地用 nHibernate 之类的东西替换它们以获得最终的 OR-mapper-bliss

表单设计器仍应使用旧表单。您可能会有些困惑，因为 2005 和 2008 在这里使用部分类。因此，如果您创建新表单，代码看起来与旧表单不同。我从来没有升级过 ASP.Net 应用程序，所以我不知道 web-forms，但我想它会和 winforms 一样工作。大多数情况下它会起作用，但期待一些设计师的怪异。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-11T20:12:34.157

.NET 1.1 和 .NET 2.0-3.5 是完全不同的框架，更重要的是，.NET 3.5 只是一组可以添加到 .NET 2.0 项目中的额外程序集 - 就核心程序集而言，实际上没有任何变化我知道——还有一个升级的编译器，它知道称为 LINQ 的语法糖、扩展方法等。

换句话说，我不认为 .NET 2.0-3.5 升级与 .NET 1.1-2.0 升级非常相似。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-15T11:26:51.843

事情可能会编译好，但是我们在年初升级的应用程序中遇到了一些令人讨厌的运行时问题。

首先，当从 2.0 应用程序调用 1.1 Web 服务时，我们在 DateTime 对象中处理时区时遇到了许多问题，因为在序列化到线路时与 UTC 的转换似乎在框架版本之间的工作方式不同。

此外，2.0 异步 Web 服务使用基于事件的笨拙机制而不是 IAsyncResult 模式，如果您正在批处理您的请求，这将是非常痛苦的。

最后，我们有一些使用 Microsoft.mshtml.dll 托管嵌入式浏览器的遗留代码。升级到 2.0 会导致应用程序静默切换到该 dll 的较新版本，该版本具有一些与 javascript 交互相关的行为变化。最后一个案例有点晦涩，但表明迁移到较新的运行时可能会对您可能拥有的任何 COM 交互产生影响。

希望这可以帮助！

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-05T08:22:46.503

# RESX 文件升级问题

注意国际化的 RESX 文件。

当您在 .net 2.0 中重新打开 .net 1.1 表单时，RESX 文件会升级到新版本。在 .net 1.1 中，外语 .resx 文件仅包含更改。在 .net 2.0 中，默认 .resx 文件中的所有字段现在都移到了外语 resx 文件中。（例如.fr.resx）。如果您已经将表单国际化，则必须查看所有外语 resx 文件。

# 国际化工具

您可能已经使用/自己编写的一些用于大规模国际化的工具可能不再起作用，因为它们可能使用了编号资源。（多语言和基础设施）

Infragistics Winforms 控件修改 .net 1.1 中的 InitializeForm() 并使用资源编号系统访问资源。当迁移到 .net 2.0 时，Infragistics 资源的编号将失败，因为 resx 文件会重新生成。您将需要升级 Infragistics 库。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-11T19:55:27.350

尽管您可能会收到一些已弃用的方法警告，但您可能不会遇到任何**重大问题。**编译器通常应该告诉您替换是什么。我知道一些 System.Configuration 的东西已经更新。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-01-04T14:50:31.523

不应该有太多问题，因为理论上它是向后兼容的（我注意到 MikeeMike 关于线程异常的评论）。搬家之后，你会没事的，有很多不错的东西，比如泛型。尽管您不想一举将所有集合移植到泛型，但一旦完成此操作，您的代码应该会因为转换次数减少而更可靠 - 并且可能更快（尽管在这方面里程可能会有所不同） . 目前我即将开始我的三个产品的 .NET 2 -> .NET 4 转换。主要优势将是对多线程支持的进一步改进（并行 foreach 循环等）。

# .net - 将 .net 2.0 重定向到 3.5 时有哪些问题？

> ID：57458
> 
> 赞同：3
> 
> 时间：2008-09-11T19:52:23.380
> 
> 标签：.net

我目前正在开展一个全面从 .NET 2.0 迁移到 3.5 的项目。

我很清楚 3.5 基本上是在 2.0 提供的功能之上的一组附加功能（库，如果你愿意的话）。

通过简单地将编译器重新定位到 3.5，我可能会遇到任何问题吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-11T20:01:07.727

这不是一个陷阱，它更像是一个提醒。.NET v3.0 和 v3.5 不是新的 CLR，而只是添加了设置程序集、编译器、资源等......

**.NET v3.0 和 v3.5 都使用 v2.0 CLR。**因此，您将无法说将 IIS 应用程序池设置为使用 v3.5 CLR...因为它不存在。

在这里更详细地讨论： [http ://www.hanselman.com/blog/HowToSetAnIISApplicationOrAppPoolToUseASPNET35RatherThan20.aspx](http://www.hanselman.com/blog/HowToSetAnIISApplicationOrAppPoolToUseASPNET35RatherThan20.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-11T20:08:46.880

我看到的唯一问题是名称冲突。您需要消除代码中与添加到 .net 2.0 和 3.5 之间的 .net 框架的名称共享名称的任何类或方法名称的歧义

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T19:53:27.497

没有

3.5 与 2.0 完全兼容，当然不是相反

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T19:53:48.960

我最近将一个小项目从 2.0 迁移到 3.5 并没有遇到任何具体问题，因为框架版本***是向后兼容***的。也就是说，可以通过利用更高版本框架中的可用功能来进行大量优化和改进。您可能会收到一些已弃用的功能警告，但不会阻止您的项目编译。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-11T19:55:41.313

除此之外，该应用程序的一些用户将不得不下载新的框架运行时，我不知道。

# svn - 强制责备

> ID：57467
> 
> 赞同：51
> 
> 时间：2008-09-11T19:55:27.303
> 
> 标签：svn, version-control, perforce

在命令行上是否存在相当于 svn 对 Perforce 的责备？`p4 annotate`不显示用户名——只显示变更集编号（没有祖先历史！）。

我目前必须通过祖先跟踪代码并与文件日志进行比较，并且必须有一种更简单的方法——也许是 F/OSS 实用程序？

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2008-09-11T20:19:35.217

我对 blame 命令并不太熟悉，但我假设您正在寻找谁更改了特定的代码行。最简单的方法是使用 p4win 和 p4v 提供的 Perforce 的“延时视图”。

该工具使用 annotate 和其他一些命令为您提供随时间推移的代码行视图。您可以查看谁修改了哪些代码，何时从代码行中插入或删除代码等。

虽然它不是命令行。我在帮助中简要检查了一下，似乎没有办法直接从 p4win 或 p4v 调用启动延时视图。不过可能有……我会进一步检查……

编辑：我检查了支持，您可以通过 p4v 启动延时视图，如下所示：

```
p4v.exe -cmd "annotate //<path/to/file>" 
```

HTH。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-11T20:30:03.803

尝试看一下我认为可以为您提供大部分所需的工具：

1) Bob Sidebotham 和 Jonathan Kamens 编写的[p4pr](https://swarm.workshop.perforce.com/files/guest/jonathan_kamens/p4pr.perl) Perl 脚本。

2) [Emacs Perforce](http://www.dsmit.com/p4/)界面有一个命令“p4-print-with-rev-history”（绑定到“Cx p V”）。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2014-08-15T13:35:36.573

我用一个小脚本来指责

```
#!/bin/bash

FILE="$1"
LINE="$2"

p4 annotate -cq "${FILE}" | sed "${LINE}q;d" | cut -f1 -d: | xargs p4 describe -s | sed -e '/Affected files/,$d' 
```

您可以将它连接到一些将传递文件名和行的编辑器。

[这里](https://github.com/arnonzilca/p4u/blob/master/p4-annotate)有一个更复杂的版本。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-10-02T14:49:58.440

从 p4v 客户端，您可以在所有显示文件的视图（如文件、更改列表等）上获得“延时视图”上下文菜单。

延时视图有很多选项，例如单次修订、多次修订，以分析更改的内容、时间和人员。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-11T21:07:59.187

@alanw123：p4pr 接近我正在寻找的东西，但它不跨越分支边界：

```
last if $type eq 'branch'; 
```

这是我在尝试编写自己的实用程序时遇到的主要问题——你不能（容易地）知道这些行是如何映射回分支的文件的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-04-18T16:57:39.477

该`p4 annotate`命令实际上*可以*`-I`使用and命令在命令行上跟随合并/集成和分支`-i`（但它不能同时执行这两个操作：（）：

```
-I
Follow integrations into the file. If a line was introduced into the file by a merge, the source of the merge is indicated as the changelist that introduced the line. If that source was itself the result of an integration, that source will be used instead, and so on.
The use of the -I option implies the -c option. The -I option cannot be combined with -i.
-i
Follow file history across branches. If a file was created by branching, Perforce includes revisions up to the branch point.
The use of the -i option implies the -c option. The -i option cannot be combined with -I. 
```

# c# - C#图遍历——任意两个节点之间的跟踪路径

> ID：57471
> 
> 赞同：3
> 
> 时间：2008-09-11T19:55:53.120
> 
> 标签：c#, graph-theory, traversal, depth-first-search, breadth-first-search

寻找一种很好的方法来跟踪两个节点之间的广度优先遍历，而无需对图一无所知。与深度优先（如果路径不成功，您可以丢弃路径）相比，您在遍历过程中可能有很多“开放”的可能性。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-11T20:16:10.373

幼稚的方法是构建一棵树，以源节点为根，其所有连接为其子节点。根据您拥有的空间量，您可能需要随时消除循环。您可以使用位图来做到这一点，其中每个位对应于图中的不同节点。当您到达目标节点时，您可以按照父链接回到根节点，这就是您的路径。由于您首先要广度，因此即使您不消除循环，您也可以确信这是一条最短路径。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T22:42:48.680

对于广度优先搜索，您至少需要存储两件事。一个是已经访问过的节点集，另一个是从访问过的节点可以直接到达但自己没有访问过的节点集。然后你继续将状态从后者集合移动到前者，为后者添加新的可达状态。如果您需要从根到某些节点的路径，那么您还需要为上述集合中的每个节点（根除外）存储一个父节点。

通常已访问节点集合和未访问子节点集合（即已看到节点集合）的并集存储在哈希表中。这是为了能够快速确定之前是否见过“新”状态，如果是则忽略它。如果您有大量的州，您可能确实需要一个位数组（如 Joseph Bui 所述（[57509](https://stackoverflow.com/questions/57471/c-graph-traversal-tracking-path-between-any-two-nodes#57509))，但除非您的状态可以（直接或间接）用作该数组的索引，否则您将需要使用哈希函数将状态映射到索引。在后一种情况下，您可能会完全忽略某些状态，因为它们被映射到与不同（和可见）节点相同的索引，因此您可能需要小心这一点。此外，要获得路径，您仍然需要存储几乎否定位数组使用的父信息。

未访问但已看到的节点集可以存储为队列。（位数组对这个集合没有用，因为数组大部分是空的，并且找到下一个集合位相对昂贵。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-12T15:17:31.783

[我刚刚在这里](https://stackoverflow.com/questions/58306/graph-algorithm-to-find-all-connections-between-two-arbitrary-vertices#58446)提交了一个也适用于这个问题的解决方案。

基本上，我只保留一个访问节点的列表（实际上是一个堆栈）。在递归或保存解决方案之前将节点添加到列表中。之后总是直接从列表中删除。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-04T00:17:50.553

如果您使用的是 .NET 3.5，请考虑使用[Hashset](http://msdn.microsoft.com/en-us/library/bb359438.aspx)来防止重复节点被扩展，当您的图中存在循环时会发生这种情况。如果您对图表的内容有任何了解，请考虑实施[A* 搜索](http://en.wikipedia.org/wiki/A*_search_algorithm)以减少展开的节点数。祝你好运，我希望它对你有用。

如果您仍然是树件的粉丝，那么有很多关于图和图搜索主题的优秀书籍，例如 Peter Norvig 和 Stuart Russell 的《人工智能：现代方法》。

我的回复中的链接似乎有一个错误，它们是 Hashset：[http](http://msdn.com/en-us/library/bb359438.aspx) ://msdn.com/en-us/library/bb359438.aspx和 A* 搜索：[http ://en.wikipedia.org/wiki/A* _search_algorithm](http://en.wikipedia.org/wiki/A*_search_algorithm)

# jquery - 带有 jQ uery 的 Firefox 中的 AJAX 下拉菜单（HTML 选择）

> ID：57479
> 
> 赞同：1
> 
> 时间：2008-09-11T20:01:07.710
> 
> 标签：jquery, ajax, html-select

帮助！我正在使用 jQuery 进行 AJAX 调用，以在给定用户先前输入的情况下动态填充下拉列表（来自另一个下拉列表，即填充服务器端）。在除 Firefox（IE6/7、Opera、Safari）之外的所有其他浏览器中，我的附加调用实际上将信息附加到我现有选项下方 - “选择一个”。但是在 Firefox 中，它会自动选择给选择控件的最后一项，无论我是否将 JQuery 操作指定为 .append 或替换 (.html())。

```
<select name="Products" id="Products" onchange="getHeadings(this.value);">
  <option value="">Select Product</option>
</select>    

function getProducts(Category) {
  $.ajax({
    type: "GET",
    url: "getInfo.cfm",
    data: "Action=getProducts&Category=" + Category,
    success: function(result){
      $("#Products").html(result);
    }
  });
}; 
```

有什么想法吗？我过去曾尝试传输另一个空白的第一个选项，然后触发 JavaScript 选项以重新选择第一个索引，但这会触发我的代码中的 onChange 事件，这对用户来说相当烦人。

* * *

更新：

这是脚本将返回的示例

```
<option value="3">Option 1</option>
<option value="4">Option 2</option>
<option value="6">Option 3</option> 
```

或者，如果使用 .html() 方法而不是 .append()，我会放另一个

```
<option value="">Select a Product</option> 
```

在结果的顶部。

* * *

@达里尔·海因

这是脚本将返回的示例

```
<option value="3">Option 1</option>
<option value="4">Option 2</option>
<option value="6">Option 3</option> 
```

或者，如果使用 .html() 方法而不是 .append()，我会放另一个

```
<option value="">Select a Product</option> 
```

在结果的顶部。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-11T23:31:03.337

您可以更改成功功能以将所选项目重置为第一个选项吗？

```
$("#Products").append(result).selectedIndex = 0; 
```

或将其设置为先前的选择？

```
var tmpIdx = $("#Products").selectedIndex;
$("#Products").append(result).selectedIndex = tmpIdx; 
```

如果 onChange 事件不应触发，那么您始终可以设置一个标志以指示表单正在更新，并且更改事件可以检查该标志并在设置时退出。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T20:18:27.903

我只是做了以下事情，效果很好：

```
<select name="Products" id="Products">
<option value="">Select Product</option>
</select>

<script type="text/javascript">
$('#Products').append('<option value="1">test 1</option><option value="3">test 3</option><option value="3">test 3</option>');
</script> 
```

你的脚本返回什么？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-29T04:54:30.960

```
$('#field').find('option:first').attr('selected', 'selected').parent('select'); 
```

看到这会工作

# c++ - C++中的指针变量和引用变量有什么区别？

> ID：57483
> 
> 赞同：3654
> 
> 时间：2008-09-11T20:03:57.173
> 
> 标签：c++, pointers, reference, c++-faq

我知道引用是语法糖，所以代码更容易读写。

但是指针变量和引用变量有什么区别呢？

* * *

## 回答 #1

> 赞同：2013
> 
> 时间：2008-09-11T20:08:20.173

1.  可以重新分配指针：

    ```
    int x = 5;
    int y = 6;
    int *p;
    p = &x;
    p = &y;
    *p = 10;
    assert(x == 5);
    assert(y == 10); 
    ```

    引用不能重新绑定，必须在初始化时绑定：

    ```
    int x = 5;
    int y = 6;
    int &q; // error
    int &r = x; 
    ```

2.  指针变量有它自己的标识：一个独特的、可见的内存地址，可以用一元运算符获取`&`，一定量的空间可以用该`sizeof`运算符测量。在引用上使用这些运算符会返回一个与引用绑定的值相对应的值；引用自己的地址和大小是不可见的。由于引用以这种方式假定原始变量的身份，因此可以方便地将引用视为同一变量的另一个名称。

    ```
    int x = 0;
    int &r = x;
    int *p = &x;
    int *p2 = &r;

    assert(p == p2); // &x == &r
    assert(&p != &p2); 
    ```

3.  您可以将任意嵌套的指针指向提供额外间接级别的指针。引用仅提供一级间接。

    ```
    int x = 0;
    int y = 0;
    int *p = &x;
    int *q = &y;
    int **pp = &p;

    **pp = 2;
    pp = &q; // *pp is now q
    **pp = 4;

    assert(y == 4);
    assert(x == 2); 
    ```

4.  可以分配指针`nullptr`，而引用必须绑定到现有对象。如果你足够努力，你可以绑定一个对 的引用`nullptr`，但这是[未定义](https://stackoverflow.com/questions/2397984/)的，并且不会表现得一致。

    ```
    /* the code below is undefined; your compiler may optimise it
     * differently, emit warnings, or outright refuse to compile it */

    int &r = *static_cast<int *>(nullptr);

    // prints "null" under GCC 10
    std::cout
        << (&r != nullptr
            ? "not null" : "null")
        << std::endl;

    bool f(int &r) { return &r != nullptr; }

    // prints "not null" under GCC 10
    std::cout
        << (f(*static_cast<int *>(nullptr))
            ? "not null" : "null")
        << std::endl; 
    ```

    但是，您可以引用值为 的指针`nullptr`。

5.  指针可以遍历数组；您可以使用`++`转到指针指向的下一项，并`+ 4`转到第 5 个元素。这与指针指向的对象大小无关。

6.  需要取消引用指针`*`才能访问它指向的内存位置，而可以直接使用引用。指向类/结构的指针用于`->`访问其成员，而引用使用`.`.

7.  引用不能放入数组，而指针可以（用户@litb 提到）

8.  常量引用可以绑定到临时对象。指针不能（不是没有一些间接性）：

    ```
    const int &x = int(12); // legal C++
    int *y = &int(12); // illegal to take the address of a temporary. 
    ```

    这使得`const &`在参数列表等中使用更方便。

* * *

## 回答 #2

> 赞同：478
> 
> 时间：2009-02-27T21:26:44.913

# 什么是 C++ 参考（*针对 C 程序员*）

可以将*引用*视为具有自动间接寻址的*常量指针*（不要与指向常量值的指针混淆！），即编译器将为`*`您应用运算符。

所有引用都必须用非空值初始化，否则编译将失败。既不可能获得引用的地址——地址运算符将返回被引用值的地址——也不可能对引用进行算术运算。

C 程序员可能不喜欢 C++ 引用，因为当间接发生或如果参数通过值或指针传递而不查看函数签名时，它将不再明显。

C++ 程序员可能不喜欢使用指针，因为它们被认为是不安全的——尽管引用实际上并不比常量指针更安全，除非在最微不足道的情况下——缺乏自动间接的便利性并带有不同的语义内涵。

[*考虑C++ FAQ*](https://isocpp.org/wiki/faq/references#overview-refs)中的以下语句：

> 尽管引用通常使用底层汇编语言中的地址来实现，但请不要*将*引用视为指向对象的有趣指针。引用*是*对象。它不是指向对象的指针，也不是对象的副本。它*是*对象。

但如果引用*真的*是对象，怎么会有悬空引用呢？在非托管语言中，引用不可能比指针更“安全”——通常没有一种方法可以跨范围边界可靠地对值进行别名！

# 为什么我认为 C++ 参考很有用

来自 C 背景，C++ 引用可能看起来有点愚蠢，但仍应尽可能使用它们而不是指针：自动间接*很*方便，并且在处理[RAII](https://en.wikipedia.org/wiki/Resource_Acquisition_Is_Initialization)时引用变得特别有用- 但不是因为任何感知的安全性优势，而是因为它们使编写惯用的代码变得不那么尴尬。

RAII 是 C++ 的核心概念之一，但它与复制语义的交互非常重要。通过引用传递对象避免了这些问题，因为不涉及复制。如果语言中不存在引用，则必须改用指针，这使用起来更麻烦，从而违反了最佳实践解决方案应该比替代方案更容易的语言设计原则。

* * *

## 回答 #3

> 赞同：215
> 
> 时间：2008-09-11T21:43:16.873

如果你想真正迂腐，你可以用引用做一件你不能用指针做的事情：延长临时对象的生命周期。在 C++ 中，如果将 const 引用绑定到临时对象，则该对象的生命周期将变为引用的生命周期。

```
std::string s1 = "123";
std::string s2 = "456";

std::string s3_copy = s1 + s2;
const std::string& s3_reference = s1 + s2; 
```

在此示例中，s3_copy 复制作为连接结果的临时对象。而 s3_reference 本质上成为临时对象。它实际上是对临时对象的引用，该对象现在与引用具有相同的生命周期。

如果你在没有它的情况下尝试这个，`const`它应该无法编译。您不能将非常量引用绑定到临时对象，也不能为此获取其地址。

* * *

## 回答 #4

> 赞同：160
> 
> 时间：2008-09-11T20:07:29.520

除了语法糖，引用是一个`const`指针（*不是*指向a 的指针`const`）。您必须在声明引用变量时确定它所引用的内容，并且以后不能更改它。

更新：现在我想多了，有一个重要的区别。

const 指针的目标可以通过获取其地址并使用 const 强制转换来替换。

引用的目标不能以任何方式替换 UB。

这应该允许编译器对引用进行更多优化。

* * *

## 回答 #5

> 赞同：131
> 
> 时间：2008-09-11T21:06:49.910

与流行的观点相反，可以有一个为 NULL 的引用。

```
int * p = NULL;
int & r = *p;
r = 1;  // crash! (if you're lucky) 
```

诚然，参考文献要困难得多——但如果你能做到，你会为了找到它而绞尽脑汁。引用在 C++ 中*并不是*天生安全的！

从技术上讲，这是一个**无效的引用**，而不是一个空引用。C++ 不支持空引用作为您在其他语言中可能发现的概念。还有其他类型的无效引用。*任何*无效引用都会引发**未定义行为**的幽灵，就像使用无效指针一样。

实际错误在于在分配给引用之前取消引用 NULL 指针。但是我不知道有任何编译器会在这种情况下产生任何错误——错误会传播到代码中的某个点。这就是使这个问题如此阴险的原因。大多数情况下，如果您取消引用 NULL 指针，您就会在该位置崩溃，并且不需要太多调试即可解决。

我上面的例子很短而且做作。这是一个更真实的例子。

```
class MyClass
{
    ...
    virtual void DoSomething(int,int,int,int,int);
};

void Foo(const MyClass & bar)
{
    ...
    bar.DoSomething(i1,i2,i3,i4,i5);  // crash occurs here due to memory access violation - obvious why?
}

MyClass * GetInstance()
{
    if (somecondition)
        return NULL;
    ...
}

MyClass * p = GetInstance();
Foo(*p); 
```

我想重申，获得空引用的唯一方法是通过格式错误的代码，一旦你拥有它，你就会得到未定义的行为。检查空引用是**没有**意义的；例如，您可以尝试`if(&bar==NULL)...`，但编译器可能会优化该语句不存在！有效的引用永远不能为 NULL，因此从编译器的角度来看，比较总是错误的，并且可以自由地将`if`子句作为死代码消除 - 这是未定义行为的本质。

避免麻烦的正确方法是避免取消引用 NULL 指针来创建引用。这是实现此目的的自动化方法。

```
template<typename T>
T& deref(T* p)
{
    if (p == NULL)
        throw std::invalid_argument(std::string("NULL reference"));
    return *p;
}

MyClass * p = GetInstance();
Foo(deref(p)); 
```

有关具有更好写作技巧的人对这个问题的更早的看法，请参阅Jim Hyslop 和 Herb Sutter 的[Null References](http://www.gotw.ca/conv/002.htm)。

有关取消引用空指针的危险的另一个示例，请参阅Raymond Chen[在尝试将代码移植到另一个平台时暴露未定义的行为。](https://blogs.msdn.microsoft.com/oldnewthing/20171222-00/?p=97635)

* * *

## 回答 #6

> 赞同：126
> 
> 时间：2008-09-11T22:10:49.333

你忘记了最重要的部分：

带有指针`->`
的成员访问使用带有引用的成员访问`.`

`foo.bar`明显优于[vi](http://en.wikipedia.org/wiki/Vi)明显优于[Emacs](http://en.wikipedia.org/wiki/Emacs) :-) *_*`foo->bar` _ *_*

 ** * *

## 回答 #7

> 赞同：81
> 
> 时间：2013-09-01T03:44:41.590

引用与指针非常相似，但它们是专门为优化编译器而设计的。

*   引用的设计使得编译器更容易跟踪哪些引用别名哪些变量。两个主要特性非常重要：没有“参考算术”和没有重新分配参考。这些允许编译器在编译时找出哪些引用别名哪些变量。
*   允许引用引用没有内存地址的变量，例如编译器选择放入寄存器的变量。如果您获取局部变量的地址，编译器很难将其放入寄存器中。

举个例子：

```
void maybeModify(int& x); // may modify x in some way

void hurtTheCompilersOptimizer(short size, int array[])
{
    // This function is designed to do something particularly troublesome
    // for optimizers. It will constantly call maybeModify on array[0] while
    // adding array[1] to array[2]..array[size-1]. There's no real reason to
    // do this, other than to demonstrate the power of references.
    for (int i = 2; i < (int)size; i++) {
        maybeModify(array[0]);
        array[i] += array[1];
    }
} 
```

一个优化编译器可能会意识到我们正在访问大量的 a[0] 和 a[1]。它希望将算法优化为：

```
void hurtTheCompilersOptimizer(short size, int array[])
{
    // Do the same thing as above, but instead of accessing array[1]
    // all the time, access it once and store the result in a register,
    // which is much faster to do arithmetic with.
    register int a0 = a[0];
    register int a1 = a[1]; // access a[1] once
    for (int i = 2; i < (int)size; i++) {
        maybeModify(a0); // Give maybeModify a reference to a register
        array[i] += a1;  // Use the saved register value over and over
    }
    a[0] = a0; // Store the modified a[0] back into the array
} 
```

要进行这样的优化，需要证明在调用过程中没有任何东西可以改变array[1]。这很容易做到。i 永远不会小于 2，因此 array[i] 永远不能引用 array[1]。MaybeModify() 被赋予 a0 作为参考（别名数组 [0]）。因为没有“参考”算术，编译器只需要证明maybeModify 永远不会得到x 的地址，并且已经证明没有任何东西改变array[1]。

它还必须证明，当我们在 a0 中有一个临时寄存器副本时，未来的调用无法读取/写入 a[0]。这通常很容易证明，因为在许多情况下，很明显引用永远不会像类实例那样存储在永久结构中。

现在用指针做同样的事情

```
void maybeModify(int* x); // May modify x in some way

void hurtTheCompilersOptimizer(short size, int array[])
{
    // Same operation, only now with pointers, making the
    // optimization trickier.
    for (int i = 2; i < (int)size; i++) {
        maybeModify(&(array[0]));
        array[i] += array[1];
    }
} 
```

行为是一样的；只是现在要证明 MaybeModify 不会修改 array[1] 变得更加困难，因为我们已经给了它一个指针；猫从袋子里出来了。现在它必须做更困难的证明：对maybeModify 进行静态分析以证明它永远不会写入&x + 1。它还必须证明它永远不会保存可以引用array[0] 的指针，这只是一样棘手。

现代编译器在静态分析方面越来越好，但帮助他们并使用引用总是很好的。

当然，除非进行如此巧妙的优化，编译器确实会在需要时将引用转换为指针。

编辑：发布此答案五年后，我发现了一个实际的技术差异，其中引用不同于查看相同寻址概念的不同方式。引用可以以指针无法修改的方式修改临时对象的生命周期。

```
F createF(int argument);

void extending()
{
    const F& ref = createF(5);
    std::cout << ref.getArgument() << std::endl;
}; 
```

通常临时对象（例如由调用创建的对象`createF(5)`）在表达式结束时被销毁。但是，通过将该对象绑定到引用，`ref`C++ 将延长该临时对象的生命周期，直到`ref`超出范围。

* * *

## 回答 #8

> 赞同：76
> 
> 时间：2008-09-19T12:23:19.653

实际上，引用并不像指针。

编译器保持对变量的“引用”，将名称与内存地址相关联；这就是编译时将任何变量名转换为内存地址的工作。

创建引用时，您只需告诉编译器您为指针变量分配了另一个名称；这就是为什么引用不能“指向 null”，因为变量不能是，也不是。

指针是变量；它们包含一些其他变量的地址，或者可以为空。重要的是指针有一个值，而引用只有一个它正在引用的变量。

现在对实际代码进行一些解释：

```
int a = 0;
int& b = a; 
```

在这里，您没有创建另一个指向`a`;的变量。您只是在保存 . 值的内存内容中添加另一个名称`a`。该内存现在有两个名称，`a`和`b`，并且可以使用任一名称对其进行寻址。

```
void increment(int& n)
{
    n = n + 1;
}

int a;
increment(a); 
```

调用函数时，编译器通常会为要复制到的参数生成内存空间。函数签名定义了应该创建的空间，并给出了这些空间应该使用的名称。将参数声明为引用只是告诉编译器使用输入变量内存空间，而不是在方法调用期间分配新的内存空间。说您的函数将直接操作在调用范围内声明的变量可能看起来很奇怪，但请记住，在执行编译后的代码时，没有更多的范围；只有普通的平坦内存，您的函数代码可以操纵任何变量。

现在可能有一些情况，您的编译器在编译时可能无法知道引用，例如使用 extern 变量时。因此，引用可能会也可能不会被实现为底层代码中的指针。但是在我给你的例子中，它很可能不会用指针来实现。

* * *

## 回答 #9

> 赞同：46
> 
> 时间：2008-09-11T20:12:35.233

参考永远不可能`NULL`。

* * *

## 回答 #10

> 赞同：35
> 
> 时间：2014-10-29T17:17:23.507

如果您不熟悉以抽象甚至学术方式学习计算机语言，那么语义差异可能会显得深奥。

在最高级别，引用的概念是它们是透明的“别名”。您的计算机可能使用地址使它们工作，但您不应该担心这一点：您应该将它们视为现有对象的“只是另一个名称”，并且语法反映了这一点。它们比指针更严格，因此您的编译器可以更可靠地在您即将创建悬空引用时向您发出警告，而不是在您即将创建悬空指针时发出警告。

除此之外，指针和引用之间当然存在一些实际差异。使用它们的语法显然不同，您不能“重新定位”引用、引用虚无或引用指针。

* * *

## 回答 #11

> 赞同：35
> 
> 时间：2011-05-20T19:26:37.670

虽然引用和指针都用于间接访问另一个值，但引用和指针之间有两个重要区别。第一个是引用总是引用一个对象：定义一个引用而不初始化它是错误的。赋值的行为是第二​​个重要区别：赋值给引用会改变引用绑定的对象；它不会重新绑定对另一个对象的引用。一旦初始化，一个引用总是指向同一个底层对象。

考虑这两个程序片段。首先，我们将一个指针分配给另一个：

```
int ival = 1024, ival2 = 2048;
int *pi = &ival, *pi2 = &ival2;
pi = pi2;    // pi now points to ival2 
```

在分配 ival 之后，由 pi 寻址的对象保持不变。赋值改变了 pi 的值，使其指向不同的对象。现在考虑一个分配两个引用的类似程序：

```
int &ri = ival, &ri2 = ival2;
ri = ri2;    // assigns ival2 to ival 
```

这个赋值改变了 ival，ri 引用的值，而不是引用本身。赋值后，这两个引用仍然引用它们原来的对象，这些对象的值现在也一样了。

* * *

## 回答 #12

> 赞同：28
> 
> 时间：2013-01-01T17:45:46.727

引用是另一个变量的别名，而指针保存变量的内存地址。引用通常用作函数参数，因此传递的对象不是副本而是对象本身。

```
 void fun(int &a, int &b); // A common usage of references.
    int a = 0;
    int &b = a; // b is an alias for a. Not so common to use. 
```

* * *

## 回答 #13

> 赞同：22
> 
> 时间：2019-02-17T07:37:56.563

## The direct answer

What is a reference in C++? Some specific instance of type that **is not an object type**.

What is a pointer in C++? Some specific instance of type that **is an object type**.

From [the ISO C++ definition of object type](http://eel.is/c++draft/basic.types#8):

> An *object* type is a (possibly *cv*-qualified) type that is not a function type, not a reference type, and not *cv* void.

It may be important to know, object type is a top-level category of the type universe in C++. Reference is also a top-level category. **But pointer is not.**

Pointers and references are mentioned together [in the context of *compound type*](http://eel.is/c++draft/basic.compound#1). This is basically due to the nature of the declarator syntax inherited from (and extended) C, which has no references. (Besides, there are more than one kind of declarator of references since C++ 11, while pointers are still "unityped": `&`+`&&` vs. `*`.) So drafting a language specific by "extension" with similar style of C in this context is somewhat reasonable. (I will still argue that the syntax of declarators wastes the syntactic expressiveness *a lot*, makes both human users and implementations frustrating. Thus, all of them are not qualified to be *built-in* in a new language design. This is a totally different topic about PL design, though.)

Otherwise, it is insignificant that pointers can be qualified as a specific sorts of types with references together. They simply share too few common properties besides the syntax similarity, so there is no need to put them together in most cases.

Note the statements above only mentions "pointers" and "references" as types. There are some interested questions about their instances (like variables). There also come too many misconceptions.

The differences of the top-level categories can already reveal many concrete differences not tied to pointers directly:

*   Object types can have top-level `cv` qualifiers. References cannot.
*   Variable of object types do occupy storage as per [the abstract machine](http://eel.is/c++draft/intro.abstract) semantics. Reference do not necessary occupy storage (see the section about misconceptions below for details).
*   ...

A few more special rules on references:

*   [Compound declarators are more restrictive on references.](http://eel.is/c++draft/dcl.ref#5)
*   References can [collapse](http://eel.is/c++draft/dcl.ref#6).
    *   Special rules on `&&` parameters (as the "forwarding references") based on reference collapsing during template parameter deduction allow ["perfect forwarding"](https://stackoverflow.com/questions/3582001) of parameters.
*   References have special rules in initialization. The lifetime of variable declared as a reference type can be different to ordinary objects via extension.
    *   BTW, a few other contexts like initialization involving `std::initializer_list` follows some similar rules of reference lifetime extension. It is another can of worms.
*   ...

## The misconceptions

### [Syntactic sugar](https://en.wikipedia.org/wiki/Syntactic_sugar)

> I know references are syntactic sugar, so code is easier to read and write.

Technically, this is plain wrong. References are not syntactic sugar of any other features in C++, because they cannot be exactly replaced by other features without any semantic differences.

(Similarly, *lambda-expression*s are *not* syntactic sugar of any other features in C++ because it cannot be precisely simulated with "unspecified" properties like [the declaration order of the captured variables](http://eel.is/c++draft/expr.prim.lambda#capture-9), which may be important because the initialization order of such variables can be significant.)

C++ only has a few kinds of syntactic sugars in this strict sense. One instance is (inherited from C) the built-in (non-overloaded) operator `[]`, which [is defined exactly having same semantic properties of specific forms of combination over built-in operator unary `*` and binary `+`](http://eel.is/c++draft/expr.sub#1).

### Storage

> ***So, a pointer and a reference both use the same amount of memory.***

The statement above is simply wrong. To avoid such misconceptions, look at the ISO C++ rules instead:

From [[intro.object]/1](http://eel.is/c++draft/intro.object#1):

> ... An object occupies a region of storage in its period of construction, throughout its lifetime, and in its period of destruction. ...

From [[dcl.ref]/4](http://eel.is/c++draft/dcl.ref#4):

> It is unspecified whether or not a reference requires storage.

Note these are *semantic* properties.

### Pragmatics

Even that pointers are not qualified enough to be put together with references in the sense of the language design, there are still some arguments making it debatable to make choice between them in some other contexts, for example, when making choices on parameter types.

But this is not the whole story. I mean, there are more things than pointers vs references you have to consider.

If you don't have to stick on such over-specific choices, in most cases the answer is short: **you do not have the necessity to use pointers, so you don't**. Pointers are usually bad enough because they imply too many things you don't expect and they will rely on too many implicit assumptions undermining the maintainability and (even) portability of the code. **Unnecessarily relying on pointers is definitely a bad style and it should be avoided in the sense of modern C++.** Reconsider your purpose and you will finally find that **pointer is the feature of last sorts** in most cases.

*   Sometimes the language rules explicitly require specific types to be used. If you want to use these features, obey the rules.
    *   Copy constructors require specific types of *cv*-`&` reference type as the 1st parameter type. (And usually it should be `const` qualified.)
    *   Move constructors require specific types of *cv*-`&&` reference type as the 1st parameter type. (And usually there should be no qualifiers.)
    *   Specific overloads of operators require reference or non reference types. For example:
        *   Overloaded `operator=` as special member functions requires reference types similar to 1st parameter of copy/move constructors.
        *   Postfix `++` requires dummy `int`.
        *   ...
*   If you know pass-by-value (i.e. using non-reference types) is sufficient, use it directly, particularly when using an implementation supporting C++17 mandated copy elision. (**Warning**: However, to **exhaustively** reason about the necessity can be [very complicated](https://stackoverflow.com/a/53825424).)
*   If you want to operate some handles with ownership, use smart pointers like `unique_ptr` and `shared_ptr` (or even with homebrew ones by yourself if you require them to be *opaque*), rather than raw pointers.
*   If you are doing some iterations over a range, use iterators (or some ranges which are not provided by the standard library yet), rather than raw pointers unless you are convinced raw pointers will do better (e.g. for less header dependencies) in very specific cases.
*   If you know pass-by-value is sufficient and you want some explicit nullable semantics, use wrapper like `std::optional`, rather than raw pointers.
*   If you know pass-by-value is not ideal for the reasons above, and you don't want nullable semantics, use {lvalue, rvalue, forwarding}-references.
*   Even when you do want semantics like traditional pointer, there are often something more appropriate, like `observer_ptr` in Library Fundamental TS.

The only exceptions cannot be worked around in the current language:

*   When you are implementing smart pointers above, you may have to deal with raw pointers.
*   Specific language-interoperation routines require pointers, like `operator new`. (However, *cv*-`void*` is still quite different and safer compared to the ordinary object pointers because it rules out unexpected pointer arithmetics unless you are relying on some non conforming extension on `void*` like GNU's.)
*   Function pointers can be converted from lambda expressions without captures, while function references cannot. You have to use function pointers in non-generic code for such cases, even you deliberately do not want nullable values.

So, in practice, the answer is so obvious: **when in doubt, avoid pointers**. You have to use pointers only when there are very explicit reasons that nothing else is more appropriate. Except a few exceptional cases mentioned above, such choices are almost always not purely C++-specific (but likely to be language-implementation-specific). Such instances can be:

*   You have to serve to old-style (C) APIs.
*   You have to meet the ABI requirements of specific C++ implementations.
*   You have to interoperate at runtime with different language implementations (including various assemblies, language runtime and FFI of some high-level client languages) based on assumptions of specific implementations.
*   You have to improve efficiency of the translation (compilation & linking) in some extreme cases.
*   You have to avoid symbol bloat in some extreme cases.

### Language neutrality caveats

If you come to see the question via [some Google search result (not specific to C++)](https://www.google.com/search?q=pointer+vs+reference&hl=en), this is very likely to be the wrong place.

References in C++ is quite "odd", as it is essentially not first-class: [they will be treated as the objects or the functions being referred to](http://eel.is/c++draft/expr#type-1) so they have no chance to support some first-class operations like being the left operand of [the member access operator](http://eel.is/c++draft/expr.ref) independently to the type of the referred object. Other languages may or may not have similar restrictions on their references.

References in C++ will likely not preserve the meaning across different languages. For example, references in general do not imply nonnull properties on values like they in C++, so such assumptions may not work in some other languages (and you will find counterexamples quite easily, e.g. Java, C#, ...).

There can still be some common properties among references in different programming languages in general, but let's leave it for some other questions in SO.

(A side note: the question may be significant earlier than any "C-like" languages are involved, like [ALGOL 68 vs. PL/I](https://academic.oup.com/comjnl/article-pdf/17/4/325/1215152/17-4-325.pdf).)

* * *

## 回答 #14

> 赞同：21
> 
> 时间：2008-09-12T23:27:06.180

它占用多少空间并不重要，因为您实际上看不到它占用的任何空间的任何副作用（不执行代码）。

另一方面，引用和指针之间的一个主要区别是分配给 const 引用的临时对象一直存在，直到 const 引用超出范围。

例如：

```
class scope_test
{
public:
    ~scope_test() { printf("scope_test done!\n"); }
};

...

{
    const scope_test &test= scope_test();
    printf("in scope\n");
} 
```

将打印：

```
in scope
scope_test done! 
```

这是允许 ScopeGuard 工作的语言机制。

* * *

## 回答 #15

> 赞同：21
> 
> 时间：2014-01-13T13:14:16.557

这是基于[教程](http://www.cplusplus.com/files/tutorial.pdf)。写的更清楚了：

```
>>> The address that locates a variable within memory is
    what we call a reference to that variable. (5th paragraph at page 63)

>>> The variable that stores the reference to another
    variable is what we call a pointer. (3rd paragraph at page 64) 
```

只要记住这一点，

```
>>> reference stands for memory location
>>> pointer is a reference container (Maybe because we will use it for
several times, it is better to remember that reference.) 
```

更重要的是，正如我们几乎可以参考任何指针教程，指针是由指针算法支持的对象，它使指针类似于数组。

看下面的语句，

```
int Tom(0);
int & alias_Tom = Tom; 
```

`alias_Tom`可以理解为一个`alias of a variable`（与 不同`typedef`，即`alias of a type`）`Tom`。也可以忘记这种声明的术语是创建`Tom`.

* * *

## 回答 #16

> 赞同：19
> 
> 时间：2013-02-26T05:20:32.573

引用不是给某些记忆的另一个名称。它是一个不可变的指针，在使用时会自动取消引用。基本上可以归结为：

```
int& j = i; 
```

它在内部变成

```
int* const j = &i; 
```

* * *

## 回答 #17

> 赞同：18
> 
> 时间：2015-02-09T13:17:16.570

在 C++ 中可以对指针进行引用，但反过来是不可能的，这意味着指向引用的指针是不可能的。对指针的引用提供了一种更简洁的语法来修改指针。看这个例子：

```
#include<iostream>
using namespace std;

void swap(char * &str1, char * &str2)
{
  char *temp = str1;
  str1 = str2;
  str2 = temp;
}

int main()
{
  char *str1 = "Hi";
  char *str2 = "Hello";
  swap(str1, str2);
  cout<<"str1 is "<<str1<<endl;
  cout<<"str2 is "<<str2<<endl;
  return 0;
} 
```

并考虑上述程序的 C 版本。在 C 语言中，你必须使用指向指针的指针（多重间接），这会导致混乱，程序可能看起来很复杂。

```
#include<stdio.h>
/* Swaps strings by swapping pointers */
void swap1(char **str1_ptr, char **str2_ptr)
{
  char *temp = *str1_ptr;
  *str1_ptr = *str2_ptr;
  *str2_ptr = temp;
}

int main()
{
  char *str1 = "Hi";
  char *str2 = "Hello";
  swap1(&str1, &str2);
  printf("str1 is %s, str2 is %s", str1, str2);
  return 0;
} 
```

有关指针引用的更多信息，请访问以下内容：

*   *[C++：对指针的引用](http://markgodwin.blogspot.in/2009/08/c-reference-to-pointer.html)*
*   *[指针对指针和引用指针](http://www.codeguru.com/cpp/cpp/cpp_mfc/pointers/article.php/c4089/PointertoPointer-and-ReferencetoPointer.htm)*

正如我所说，指向引用的指针是不可能的。试试下面的程序：

```
#include <iostream>
using namespace std;

int main()
{
   int x = 10;
   int *ptr = &x;
   int &*ptr1 = ptr;
} 
```

* * *

## 回答 #18

> 赞同：16
> 
> 时间：2008-09-12T13:41:58.533

除非我需要以下任何一种，否则我会使用参考：

*   空指针可以用作标记值，这通常是避免函数重载或使用布尔值的廉价方法。

*   您可以对指针进行算术运算。例如，`p += offset;`

* * *

## 回答 #19

> 赞同：16
> 
> 时间：2012-02-06T08:59:29.383

我没有看到有人提到过指针和引用之间的一个根本区别：引用在函数参数中启用了按引用传递的语义。指针，虽然一开始不可见，但不可见：它们只提供按值传递的语义。[这篇文章](http://javadude.com/articles/passbyvalue.htm)已经很好地描述了这一点。

问候， &rzej

* * *

## 回答 #20

> 赞同：15
> 
> 时间：2010-01-29T15:15:18.520

另一个区别是您可以拥有指向 void 类型的指针（它意味着指向任何东西的指针），但禁止对 void 的引用。

```
int a;
void * p = &a; // ok
void & p = a;  //  forbidden 
```

我不能说我对这种特殊的差异感到非常满意。我更希望它被允许对具有地址的任何内容进行有意义的引用，否则引用的行为相同。它将允许使用引用定义一些 C 库函数的等价物，例如 memcpy。

* * *

## 回答 #21

> 赞同：15
> 
> 时间：2014-10-14T21:38:00.597

冒着增加混乱的风险，我想输入一些输入，我确信这主要取决于编译器如何实现引用，但在 gcc 的情况下，引用只能指向堆栈上的变量的想法实际上并不正确，例如：

```
#include <iostream>
int main(int argc, char** argv) {
    // Create a string on the heap
    std::string *str_ptr = new std::string("THIS IS A STRING");
    // Dereference the string on the heap, and assign it to the reference
    std::string &str_ref = *str_ptr;
    // Not even a compiler warning! At least with gcc
    // Now lets try to print it's value!
    std::cout << str_ref << std::endl;
    // It works! Now lets print and compare actual memory addresses
    std::cout << str_ptr << " : " << &str_ref << std::endl;
    // Exactly the same, now remember to free the memory on the heap
    delete str_ptr;
} 
```

哪个输出：

```
THIS IS A STRING
0xbb2070 : 0xbb2070 
```

如果您注意到甚至内存地址完全相同，这意味着引用成功指向堆上的变量！现在，如果您真的想变得怪异，这也可以：

```
int main(int argc, char** argv) {
    // In the actual new declaration let immediately de-reference and assign it to the reference
    std::string &str_ref = *(new std::string("THIS IS A STRING"));
    // Once again, it works! (at least in gcc)
    std::cout << str_ref;
    // Once again it prints fine, however we have no pointer to the heap allocation, right? So how do we free the space we just ignorantly created?
    delete &str_ref;
    /*And, it works, because we are taking the memory address that the reference is
    storing, and deleting it, which is all a pointer is doing, just we have to specify
    the address with '&' whereas a pointer does that implicitly, this is sort of like
    calling delete &(*str_ptr); (which also compiles and runs fine).*/
} 
```

哪个输出：

```
THIS IS A STRING 
```

因此，引用是引擎盖下的指针，它们都只是存储一个内存地址，地址指向的地方无关紧要，如果我调用 std::cout << str_ref; 你认为会发生什么 在调用 delete &str_ref 之后？好吧，显然它编译得很好，但是在运行时会导致分段错误，因为它不再指向一个有效的变量，我们基本上有一个仍然存在的损坏的引用（直到它超出范围），但是没有用。

换句话说，引用只不过是一个指针，它抽象了指针机制，使其更安全、更易于使用（没有意外的指针数学，没有混淆 '.' 和 '->' 等），假设你不要像我上面的例子那样尝试任何废话；）

现在**无论**编译器如何处理引用，它**总会**有某种指针，因为引用**必须**引用特定内存地址的特定变量才能按预期工作，没有解决这个问题（因此术语“参考”）。

对于引用，唯一需要记住的重要规则是它们必须在声明时定义（头文件中的引用除外，在这种情况下，它必须在构造函数中定义，在它包含的对象之后是构建它为时已晚定义它）。

**请记住，我上面的示例只是演示什么是引用的示例，您永远不会希望以这些方式使用引用！为了正确使用参考，这里已经有很多答案一针见血**

* * *

## 回答 #22

> 赞同：13
> 
> 时间：2009-10-15T01:57:37.327

此外，作为内联函数参数的引用的处理方式可能与指针不同。

```
void increment(int *ptrint) { (*ptrint)++; }
void increment(int &refint) { refint++; }
void incptrtest()
{
    int testptr=0;
    increment(&testptr);
}
void increftest()
{
    int testref=0;
    increment(testref);
} 
```

许多编译器在内联指针版本时实际上会强制写入内存（我们正在显式获取地址）。但是，他们会将参考留在更优化的寄存器中。

当然，对于没有内联的函数，指针和引用生成相同的代码，如果函数没有修改和返回它们，那么通过值传递内在函数总是比通过引用传递更好。

* * *

## 回答 #23

> 赞同：12
> 
> 时间：2008-09-12T17:59:56.840

引用的另一个有趣用途是提供用户定义类型的默认参数：

```
class UDT
{
public:
   UDT() : val_d(33) {};
   UDT(int val) : val_d(val) {};
   virtual ~UDT() {};
private:
   int val_d;
};

class UDT_Derived : public UDT
{
public:
   UDT_Derived() : UDT() {};
   virtual ~UDT_Derived() {};
};

class Behavior
{
public:
   Behavior(
      const UDT &udt = UDT()
   )  {};
};

int main()
{
   Behavior b; // take default

   UDT u(88);
   Behavior c(u);

   UDT_Derived ud;
   Behavior d(ud);

   return 1;
} 
```

默认风格使用引用的“将 const 引用绑定到临时”方面。

* * *

## 回答 #24

> 赞同：12
> 
> 时间：2013-03-15T03:03:08.197

该程序可能有助于理解问题的答案。这是一个引用“j”和指向变量“x”的指针“ptr”的简单程序。

```
#include<iostream>

using namespace std;

int main()
{
int *ptr=0, x=9; // pointer and variable declaration
ptr=&x; // pointer to variable "x"
int & j=x; // reference declaration; reference to variable "x"

cout << "x=" << x << endl;

cout << "&x=" << &x << endl;

cout << "j=" << j << endl;

cout << "&j=" << &j << endl;

cout << "*ptr=" << *ptr << endl;

cout << "ptr=" << ptr << endl;

cout << "&ptr=" << &ptr << endl;
    getch();
} 
```

运行程序，看看输出，你就会明白了。

另外，请花 10 分钟观看此视频：[https ://www.youtube.com/watch?v=rlJrrGV0iOg](https://www.youtube.com/watch?v=rlJrrGV0iOg)

* * *

## 回答 #25

> 赞同：12
> 
> 时间：2017-07-06T19:48:46.777

我觉得这里还有一点没有涉及。

与指针不同，引用在**语法上等同**于它们所引用的对象，即任何可以应用于对象的操作都适用于引用，并且具有完全相同的语法（当然，初始化除外）。

虽然这可能看起来很肤浅，但我相信这个属性对于许多 C++ 特性至关重要，例如：

*   *模板*。由于模板参数是鸭子类型的，因此类型的语法属性是最重要的，因此通常可以将同一个模板与`T`和一起使用`T&`。
    （或者`std::reference_wrapper<T>`仍然依赖于隐式转换`T&`）
    涵盖两者`T&`并且`T&&`更常见的模板。

*   *左值*。考虑一下没有引用的语句`str[0] = 'X';`，它只适用于 c-strings ( `char* str`)。通过引用返回字符允许用户定义的类具有相同的符号。

*   *复制构造函数*。从语法上讲，将对象传递给复制构造函数是有意义的，而不是指向对象的指针。但是复制构造函数无法按值获取对象——这将导致对同一个复制构造函数的递归调用。这使得引用成为这里唯一的选择。

*   *运算符重载*。通过引用，可以向操作员调用引入间接性 - 比如说，`operator+(const T& a, const T& b)`同时保留相同的中缀表示法。这也适用于常规重载函数。

这些点赋予了 C++ 和标准库的相当一部分功能，因此这是引用的一个主要属性。

* * *

## 回答 #26

> 赞同：11
> 
> 时间：2017-11-02T11:16:02.517

指针和引用之间有一个非常重要的非技术差异：通过指针传递给函数的参数比通过非常量引用传递给函数的参数更可见。例如：

```
void fn1(std::string s);
void fn2(const std::string& s);
void fn3(std::string& s);
void fn4(std::string* s);

void bar() {
    std::string x;
    fn1(x);  // Cannot modify x
    fn2(x);  // Cannot modify x (without const_cast)
    fn3(x);  // CAN modify x!
    fn4(&x); // Can modify x (but is obvious about it)
} 
```

回到 C 中，一个看起来像的调用`fn(x)`只能通过值传递，所以它绝对不能修改`x`；要修改参数，您需要传递一个指针`fn(&x)`。因此，如果一个参数前面没有一个，`&`你就知道它不会被修改。（反之，意味着修改，则不正确，因为有时您必须通过指针`&`传递大型只读结构。）`const`

一些人认为，在阅读代码时这是一个非常有用的特性，指针参数应该始终用于可修改参数而不是非`const`引用，即使函数从不期望`nullptr`. 也就是说，那些人认为`fn3()`不应该允许像上面这样的函数签名。[Google 的 C++ 风格指南](http://google.github.io/styleguide/cppguide.html#Reference_Arguments)就是一个例子。

* * *

## 回答 #27

> 赞同：10
> 
> 时间：2014-12-27T13:00:18.067

也许一些隐喻会有所帮助；在您的桌面屏幕空间的上下文中 -

*   引用要求您指定一个实际的窗口。
*   指针需要屏幕上一块空间的位置，以确保它将包含该窗口类型的零个或多个实例。

* * *

## 回答 #28

> 赞同：7
> 
> 时间：2019-08-01T08:02:39.203

## 关于引用和指针的一些关键相关细节

### 指针

*   指针变量使用*一元后缀声明符运算符**声明
*   指针对象被分配一个地址值，例如，通过分配给数组对象，使用 &*一元前缀运算符*的对象的地址，或分配给另一个指针对象的值
*   一个指针可以被重新分配任意次数，指向不同的对象
*   指针是保存分配地址的变量。它在内存中占用的存储空间等于目标机器架构的地址大小
*   例如，可以通过增量或加法运算符对指针进行数学操作。因此，可以使用指针等进行迭代。
*   要获取或设置指针引用的对象的内容，必须使用*一元前缀运算符** 来*取消引用*它

### 参考

*   引用必须在声明时进行初始化。
*   *使用一元后缀声明符运算符*&声明引用。
*   初始化引用时，使用它们将直接引用的对象的名称，而不需要*一元前缀运算符*&
*   一旦初始化，引用就不能通过赋值或算术操作指向其他东西
*   无需取消引用即可获取或设置它所引用的对象的内容
*   对引用的赋值操作操作的是它指向的对象的内容（在初始化之后），而不是引用本身（不会改变它指向的位置）
*   对引用的算术运算操作的是它指向的对象的内容，而不是引用本身（不会改变它指向的位置）
*   在几乎所有的实现中，引用实际上存储为被引用对象的内存中的地址。因此，它在内存中占用的存储空间等于目标机器架构的地址大小，就像指针对象一样

尽管指针和引用以几乎相同的方式“在幕后”实现，但编译器对它们的处理方式不同，从而导致上述所有差异。

### 文章

我最近写的一篇文章比我在这里展示的要详细得多，应该对这个问题很有帮助，尤其是关于记忆中的事情是如何发生的：

[深度文章中的数组、指针和引用](https://www.xitalogy.com/programming/2019/08/15/a-tour-of-cpp-arrays-pointers-and-references-under-the-hood.html)

* * *

## 回答 #29

> 赞同：7
> 
> 时间：2017-01-06T14:01:10.783

### 指针和引用的区别

可以将指针初始化为 0，而不能将引用初始化。事实上，引用也必须引用一个对象，但指针可以是空指针：

```
int* p = 0; 
```

但是我们不能拥有`int& p = 0;`and `int& p=5 ;`。

事实上，要正确地做到这一点，我们必须首先声明并定义一个对象，然后我们才能对该对象进行引用，因此前面代码的正确实现将是：

```
Int x = 0;
Int y = 5;
Int& p = x;
Int& p1 = y; 
```

另一个重要的一点是，我们可以在没有初始化的情况下声明指针，但是在必须始终引用变量或对象的引用的情况下不能这样做。然而，这样使用指针是有风险的，所以通常我们检查指针是否真的指向某个东西。在引用的情况下，不需要这样的检查，因为我们已经知道在声明期间引用对象是强制性的。

另一个区别是指针可以指向另一个对象，但是引用总是引用同一个对象，让我们举个例子：

```
Int a = 6, b = 5;
Int& rf = a;

Cout << rf << endl; // The result we will get is 6, because rf is referencing to the value of a.

rf = b;
cout << a << endl; // The result will be 5 because the value of b now will be stored into the address of a so the former value of a will be erased 
```

另一点：当我们有一个像 STL 模板这样的模板时，这种类模板总是会返回一个引用，而不是一个指针，以便于使用运算符 [] 轻松读取或分配新值：

```
Std ::vector<int>v(10); // Initialize a vector with 10 elements
V[5] = 5; // Writing the value 5 into the 6 element of our vector, so if the returned type of operator [] was a pointer and not a reference we should write this *v[5]=5, by making a reference we overwrite the element by using the assignment "=" 
```

* * *

## 回答 #30

> 赞同：7
> 
> 时间：2020-06-04T15:59:21.467

引用是一个 const 指针。`int * const a = &b`是一样的`int& a = b`。这就是为什么没有 const 引用这样的东西，因为它已经是 const，而对 const 的引用是`const int * const a`. 当您使用 -O0 进行编译时，编译器会在两种情况下将 b 的地址放在堆栈中，并且作为类的成员，它也将出现在堆栈/堆上的对象中，与您声明 a 时相同常量指针。使用 -Ofast，可以免费优化它。const 指针和引用都被优化掉了。

与 const 指针不同，没有办法获取引用本身的地址，因为它将被解释为它引用的变量的地址。因此，在 -Ofast 上，表示引用的 const 指针（被引用的变量的地址）将始终在堆栈外进行优化，但如果程序绝对需要实际 const 指针的地址（指针的地址本身，而不是它指向的地址）即打印 const 指针的地址，然后 const 指针将被放置在堆栈上，以便它具有地址。

否则它是相同的，即当您打印它指向的地址时：

```
#include <iostream>

int main() {
  int a =1;
  int* b = &a;
  std::cout << b ;
}

int main() {
  int a =1;
  int& b = a;
  std::cout << &b ;
} 
```

```
they both have the same assembly output
-Ofast:
main:
        sub     rsp, 24
        mov     edi, OFFSET FLAT:_ZSt4cout
        lea     rsi, [rsp+12]
        mov     DWORD PTR [rsp+12], 1
        call    std::basic_ostream<char, std::char_traits<char> >& std::basic_ostream<char, std::char_traits<char> >::_M_insert<void const*>(void const*)
        xor     eax, eax
        add     rsp, 24
        ret
--------------------------------------------------------------------
-O0:
main:
        push    rbp
        mov     rbp, rsp
        sub     rsp, 16
        mov     DWORD PTR [rbp-12], 1
        lea     rax, [rbp-12]
        mov     QWORD PTR [rbp-8], rax
        mov     rax, QWORD PTR [rbp-8]
        mov     rsi, rax
        mov     edi, OFFSET FLAT:_ZSt4cout
        call    std::basic_ostream<char, std::char_traits<char> >::operator<<(void const*)
        mov     eax, 0
        leave
        ret 
```

指针已在堆栈外进行了优化，在这两种情况下，指针甚至都没有在 -Ofast 上取消引用，而是使用编译时值。

作为对象的成员，它们在 -O0 到 -Ofast 上是相同的。

```
#include <iostream>
int b=1;
struct A {int* i=&b; int& j=b;};
A a;
int main() {
  std::cout << &a.j << &a.i;
}

The address of b is stored twice in the object. 

a:
        .quad   b
        .quad   b 
```

```
 mov     rax, QWORD PTR a[rip+8] //&a.j
        mov     esi, OFFSET FLAT:a //&a.i 
```

当您通过引用传递时，在 -O0 上，您传递所引用变量的地址，因此它与通过指针传递相同，即 const 指针包含的地址。在 -Ofast 上，如果函数可以被内联，则编译器会在内联调用中对其进行优化，因为动态范围是已知的，但在函数定义中，参数总是作为指针解引用（期望变量的地址为由引用引用）其中它可能被另一个翻译单元使用并且编译器不知道动态范围，除非该函数当然被声明为静态函数，否则它不能在翻译单元之外使用，然后只要在函数中没有通过引用修改它，它就按值传递，

* * *

## 回答 #31

> 赞同：7
> 
> 时间：2020-01-15T09:22:06.030

简单来说，我们可以说引用是变量的替代名称，而指针是保存另一个变量地址的变量。例如

```
int a = 20;
int &r = a;
r = 40;  /* now the value of a is changed to 40 */

int b =20;
int *ptr;
ptr = &b;  /*assigns address of b to ptr not the value */ 
```

* * *

## 回答 #32

> 赞同：6
> 
> 时间：2020-01-04T14:19:29.263

以下答案和链接的摘要：

1.  可以多次重新分配指针，而绑定后不能重新分配引用。
2.  指针不能指向任何地方（`NULL`），而引用总是指向一个对象。
3.  您不能像使用指针那样获取引用的地址。
4.  没有“引用算术”（但您可以获取引用指向的对象的地址并对其进行指针算术，如 中所示`&obj + 5`）。

澄清一个误解：

> *C++ 标准非常小心地避免规定编译器如何实现引用，但是每个 C++ 编译器都将引用实现为指针。也就是说，声明如下：*
> 
> ```
> int &ri = i; 
> ```
> 
> ***如果它没有完全优化***，*则分配与指针相同的存储量，并将地址`i`放入该存储中。*

***因此，指针和引用都使用相同数量的内存。***

作为基本规则，

*   在函数参数和返回类型中使用引用来提供有用和自记录的接口。
*   使用指针来实现算法和数据结构。

有趣的阅​​读：

*   我一直以来最喜欢的[C++ FAQ lite](https://yosefk.com/c++fqa/ref.html)。
*   [引用与指针](https://www.embedded.com/references-vs-pointers)。
*   [参考文献简介](https://www.embedded.com/an-introduction-to-references)。
*   [参考和 const](https://www.embedded.com/references-and-const)。

* * *

## 回答 #33

> 赞同：6
> 
> 时间：2016-04-24T13:22:20.387

不同之处在于非常量指针变量（不要与指向常量的指针混淆）可能会在程序执行期间的某个时间更改，需要使用指针语义（&，*）运算符，而可以在初始化时设置引用仅（这就是为什么您只能在构造函数初始化程序列表中设置它们，但不能以其他方式设置它们）并使用普通值访问语义。正如我在一些非常古老的书中所读到的，基本上引入了引用以支持运算符重载。正如有人在这个线程中所说 - 指针可以设置为 0 或您想要的任何值。0(NULL, nullptr) 表示指针初始化为空。取消引用空指针是错误的。但实际上指针可能包含一个不指向某个正确内存位置的值。反过来，引用尝试不允许用户初始化对由于您始终为其提供正确类型的右值而无法引用的事物的引用。尽管有很多方法可以将引用变量初始化到错误的内存位置 - 最好不要深入研究细节。在机器级别上，指针和参考都统一工作 - 通过指针。假设在基本引用中是语法糖。右值引用与此不同 - 它们自然是堆栈/堆对象。尽管有很多方法可以将引用变量初始化到错误的内存位置 - 最好不要深入研究细节。在机器级别上，指针和参考都统一工作 - 通过指针。假设在基本引用中是语法糖。右值引用与此不同 - 它们自然是堆栈/堆对象。尽管有很多方法可以将引用变量初始化到错误的内存位置 - 最好不要深入研究细节。在机器级别上，指针和参考都统一工作 - 通过指针。假设在基本引用中是语法糖。右值引用与此不同 - 它们自然是堆栈/堆对象。

* * *

## 回答 #34

> 赞同：3
> 
> 时间：2019-01-16T17:27:13.577

除了这里的所有答案，

您可以使用引用实现运算符重载：

```
my_point operator+(const my_point& a, const my_point& b)
{
  return { a.x + b.x, a.y + b.y };
} 
```

使用参数作为值将创建原始参数的临时副本，并且由于指针算术，使用指针不会调用此函数。

* * *

## 回答 #35

> 赞同：3
> 
> 时间：2017-11-11T22:59:51.703

我对引用和指针进行了类比，将引用视为对象的另一个名称，将指针视为对象的地址。

```
// receives an alias of an int, an address of an int and an int value
public void my_function(int& a,int* b,int c){
    int d = 1; // declares an integer named d
    int &e = d; // declares that e is an alias of d
    // using either d or e will yield the same result as d and e name the same object
    int *f = e; // invalid, you are trying to place an object in an address
    // imagine writting your name in an address field 
    int *g = f; // writes an address to an address
    g = &d; // &d means get me the address of the object named d you could also
    // use &e as it is an alias of d and write it on g, which is an address so it's ok
} 
```

* * *

## 回答 #36

> 赞同：3
> 
> 时间：2017-10-19T11:50:17.787

I always decide by [this](https://github.com/isocpp/CppCoreGuidelines/blob/master/CppCoreGuidelines.md#f60-prefer-t-over-t-when-no-argument-is-a-valid-option) rule from C++ Core Guidelines:

> Prefer T* over T& when "no argument" is a valid option

* * *

## 回答 #37

> 赞同：3
> 
> 时间：2018-08-02T17:13:41.873

如果您遵循传递给函数的参数的约定，则可以使用引用和指针之间的区别。常量引用用于传递给函数的数据，指针用于传递出函数的数据。`in`在其他语言中，您可以使用和之类的关键字明确地对此进行注释`out`。在 C++ 中，您可以（按照约定）声明等价物。例如，

```
void DoSomething(const Foo& thisIsAnInput, Foo* thisIsAnOutput)
{
   if (thisIsAnOuput)
      *thisIsAnOutput = thisIsAnInput;
} 
```

使用引用作为输入和指针作为输出是[Google 风格指南](https://google.github.io/styleguide/cppguide.html#Output_Parameters)的一部分。

* * *

## 回答 #38

> 赞同：2
> 
> 时间：2021-06-30T04:49:09.550

指针是保存另一个变量的内存地址的变量，其中作为引用是现有变量的别名。（已存在变量的另一个名称）

1\. 一个指针可以被初始化为：

```
int b = 15;
int *q = &b; 
```

或者

```
int *q;
q = &b; 
```

作为参考，

```
int b=15;
int &c=b; 
```

（在一个步骤中声明和初始化）

2.  指针可以赋值为null，但引用不能
3.  可以对指针执行各种算术运算，而没有称为引用算术的东西。
4.  可以重新分配指针，但不能重新分配引用
5.  指针在堆栈上有自己的内存地址和大小，而引用共享相同的内存地址

* * *

## 回答 #39

> 赞同：2
> 
> 时间：2018-04-27T08:43:23.260

Taryn♦ 说：

> 您不能像使用指针那样获取引用的地址。

其实你可以。

我引用[另一个问题的答案](https://stackoverflow.com/a/1950826)：

> [C++ FAQ](https://isocpp.org/wiki/faq/references)说得最好：
> 
> 与指针不同，一旦引用绑定到一个对象，它就不能“重新定位”到另一个对象。引用本身不是一个对象（它没有身份；获取引用的地址可以得到引用的地址；记住：引用是它的引用）。

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2021-09-22T09:32:46.877

您不能像指针一样取消引用引用，当取消引用时会在该位置给出值，

引用和指针都通过地址工作......

所以

你可以这样做

int* val = 0xDEADBEEF；*val 位于 0xDEADBEEF。

你不能这样做 int& val = 1;

*val 是不允许的。

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2019-08-30T13:56:05.097

指针（*）的基本含义是“地址处的值”，这意味着您提供的任何地址都会在该地址处提供值。更改地址后，它将给出新值，而引用变量用于引用任何特定变量，并且将来不能更改以引用任何其他变量。

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2019-08-05T17:06:15.260

“我知道引用是语法糖，所以代码更容易读写”

这个。引用不是实现指针的另一种方式，尽管它涵盖了一个巨大的指针用例。指针是一种数据类型——通常指向实际值的地址。但是，它可以设置为零，或者使用地址算术等设置在地址之后的几个位置。引用是具有自己值的变量的“语法糖”。

C只有按值传递语义。获取变量引用的数据的地址并将其发送到函数是通过“引用”传递的一种方式。引用通过“引用”原始数据位置本身在语义上简化了这一点。所以：

```
int x = 1;
int *y = &x;
int &z = x; 
```

Y 是一个 int 指针，指向存储 x 的位置。X 和 Z 指的是同一个存储位置（堆栈或堆）。

很多人都谈到了两者（指针和引用）之间的区别，就好像它们是同一个东西，但用途不同。它们根本不一样。

1）“指针可以重新分配任意次数，而引用在绑定后不能重新分配。” -- 指针是指向数据的地址数据类型。引用是数据的另一个名称。所以你*可以*“重新分配”一个参考。您只是无法重新分配它所引用的数据位置。就像您无法更改“x”所指的数据位置一样，您也无法更改“z”。

```
x = 2;
*y = 2;
z = 2; 
```

相同。这是一个重新分配。

2）“指针不能指向任何地方（NULL），而引用总是指向一个对象”——再次混淆。引用只是对象的另一个名称。空指针（在语义上）意味着它没有引用任何东西，而引用是通过说它是“x”的另一个名称来创建的。自从

3）“你不能像用指针那样获取引用的地址”——是的，你可以。再次与混乱。如果您试图找到用作引用的指针的地址，那就有问题了——因为引用不是指向对象的指针。他们是对象。这样就可以得到对象的地址，也可以得到指针的地址。因为它们都在获取数据的地址（一个是对象在内存中的位置，另一个是指向内存中对象位置的指针）。

```
int *yz = &z; -- legal
int **yy = &y; -- legal

int *yx = &x; -- legal; notice how this looks like the z example.  x and z are equivalent. 
```

4）“没有“参考算术””——再次令人困惑——因为上面的例子中 z 是对 x 的引用，因此两者都是整数，“参考”算术意味着例如将 1 添加到由X。

```
x++;
z++;

*y++;  // what people assume is happening behind the scenes, but isn't. it would produce the same results in this example.
*(y++);  // this one adds to the pointer, and then dereferences it.  It makes sense that a pointer datatype (an address) can be incremented.  Just like an int can be incremented. 
```

# java - 当使用带有休眠状态的条件查询时，如何将条件“或”在一起？

> ID：57484
> 
> 赞同：79
> 
> 时间：2008-09-11T20:04:17.563
> 
> 标签：java, hibernate

我正在尝试使用休眠条件查询对三个字段进行基本的“或”。

例子

```
class Whatever{
 string name;
 string address;
 string phoneNumber;
} 
```

我想构建一个条件查询，其中我的搜索字符串可以匹配“名称”或“地址”或“电话号码”。

* * *

## 回答 #1

> 赞同：137
> 
> 时间：2008-09-11T20:23:55.940

你想用`Restrictions.disjuntion()`. 像这样

```
session.createCriteria(Whatever.class)
    .add(Restrictions.disjunction()
        .add(Restrictions.eq("name", queryString))
        .add(Restrictions.eq("address", queryString))
        .add(Restrictions.eq("phoneNumber", queryString))
    ); 
```

[请参阅此处](http://docs.jboss.org/hibernate/orm/3.3/reference/en/html/querycriteria.html#querycriteria-narrowing)的 Hibernate 文档。

* * *

## 回答 #2

> 赞同：72
> 
> 时间：2008-09-11T20:31:08.310

假设您有一个休眠会话，那么类似以下的东西应该可以工作：

```
Criteria c = session.createCriteria(Whatever.class);
Disjunction or = Restrictions.disjunction();
or.add(Restrictions.eq("name",searchString));
or.add(Restrictions.eq("address",searchString));
or.add(Restrictions.eq("phoneNumber",searchString));
c.add(or); 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2014-08-13T10:37:09.693

```
 //Expression :  (c1 AND c2) OR (c3)      

     Criteria criteria = session.createCriteria(Employee.class);

      Criterion c1 = Restrictions.like("name", "%e%");
      Criterion c2 = Restrictions.ge("salary", 10000.00);
      Criterion c3 = Restrictions.like("name", "%YYY%");
      Criterion c4 = Restrictions.or(Restrictions.and(c1, c2), c3);
      criteria.add(c4); 
```

//对 (c1 OR c2) AND c3 或任何复杂的表达式都可以做同样的事情。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2014-08-13T19:09:41.453

```
//Expression :  (c1 AND c2) OR (c3)      

 Criteria criteria = session.createCriteria(Employee.class);

  Criterion c1 = Restrictions.like("name", "%e%");
  Criterion c2 = Restrictions.ge("salary", 10000.00);
  Criterion c3 = Restrictions.like("name", "%YYY%");
  Criterion c4 = Restrictions.or(Restrictions.and(c1, c2), c3);
  criteria.add(c4);

  //Same thing can be done for (c1 OR c2) AND c3, or any complex expression. 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-12T10:40:47.877

以防万一有人偶然发现与 NHibernate 相同的问题：

```
ICriteria c = session.CreateCriteria(typeof (Whatever))
    .Add(Expression.Disjunction()
        .Add(Expression.Eq("name", searchString))
        .Add(Expression.Eq("address", searchString))
        .Add(Expression.Eq("phoneNumber", searchString))); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-04-08T07:45:09.863

可以使用 or / 应用条件，并使用析取在不同级别的查询中应用条件

```
Criteria query = getCriteria("ENTITY_NAME");
query.add(Restrictions.ne("column Name", current _value));

Disjunction disjunction = Restrictions.disjunction();

if (param_1 != null)
    disjunction.add(Restrictions.or(Restrictions.eq("column Name", param1)));

if (param_2 != null)
    disjunction.add(Restrictions.or(Restrictions.eq("column Name", param_2)));

if (param_3 != null)
    disjunction.add(Restrictions.or(Restrictions.eq("column Name", param_3)));
if (param_4 != null && param_5 != null)
    disjunction.add(Restrictions.or(Restrictions.and(Restrictions.eq("column Name", param_4 ), Restrictions.eq("column Name", param_5 ))));

if (disjunction.conditions() != null && disjunction.conditions().iterator().hasNext())
    query.add(Restrictions.and(disjunction));

return query.list(); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-06-21T06:46:15.073

这对我来说适用于 OR 条件，也适用于 IN 条件，而不是在本次讨论中投票最多的答案：

```
criteria.add( Restrictions.or(
                    Restrictions.eq(ch.getPath(ch.propertyResolver().getXXXX()), "OR_STRING"),
                        Restrictions.in(ch.getPath(ch.propertyResolver().getYYYY()), new String[]{"AA","BB","CC"})
                    )); 
```

**结果查询：**

```
 and (
            this_.XXXX=? 
            or this_.YYYY in (
                ?, ?, ?
            )
        ) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-07-30T22:00:03.327

如果有人使用 CriteriaQuery 而不是 Criteria，您可以将所有表达式放在一个`Predicate`列表中，然后按谓词大小放置一个 OR，如下所示：

```
List<Predicate> predicates = new ArrayList<>();
if (...) {
  predicates.add(...);
}

criteriaQuery.where(cb.or(predicates.toArray(new Predicate[predicates.size()]))); 
```

# vb.net - .NET 日期常量（带全球化）

> ID：57488
> 
> 赞同：4
> 
> 时间：2008-09-11T20:06:51.520
> 
> 标签：vb.net, datetime

有谁知道声明与国际日期兼容的日期常量的方法？

我试过了：

```
' not international compatible
public const ADate as Date = #12/31/04#

' breaking change if you have an optional parameter that defaults to this value
' because it isnt constant.
public shared readonly ADate As New Date(12, 31, 04) 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-12T17:56:53.523

如果查看语句生成的 IL

```
public const ADate as Date = #12/31/04# 
```

你会看到这个：

```
.field public static initonly valuetype [mscorlib]System.DateTime ADate
.custom instance void [mscorlib]System.Runtime.CompilerServices.DateTimeConstantAttribute::.ctor(int64) = ( 01 00 00 C0 2F CE E2 BC C6 08 00 00 ) 
```

请注意，[DateTimeConstantAttribute](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.datetimeconstantattribute.aspx)正在使用采用 int64 滴答计数的构造函数进行初始化。由于此滴答计数是在编译时确定的，因此在运行时初始化此值时，似乎不太可能有任何本地化发挥作用。我的猜测是错误与代码中的其他日期处理有关，而不是 const 初始化。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-11T20:53:18.117

根据微软文档，

“您必须将日期文字括在数字符号 (# #) 中。您必须以 M/d/yyyy 格式指定日期值，例如 #5/31/1993#。此要求与您的区域设置和计算机的设置无关日期和时间格式设置。”

你是说这不正确，解析受当前语言环境影响？

**编辑：**您是否尝试使用 4 位数的年份？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T21:22:00.277

在 VB 中将数据放入 Date 对象后，您不必担心全球化，除非您将其与某些内容进行比较或尝试将其导出。

这可以：

```
Dim FirstDate as Date = Date.UtcNow() 'or this: = NewDate (2008,09,10)'
Dim SecondDate as Date

SecondDate = FirstDate.AddDays(1) 
```

这会引入全球化规则并以当前线程的文化格式打印：

```
HeaderLabel.Text = SecondDate.ToString() 
```

这是不好的：

```
Dim BadDate as Date = CDate("2/20/2000") 
```

实际上——即使你在这种情况下强制 CDate 使用正确的文化（InvariantCulture）也可以：

```
Dim OkButBadPracticeDate as Date = CDate("2/20/2000", CultureInfo.InvariantCulture) 
```

如果您想强制所有内容为特定文化，则需要将执行线程文化和 UI 文化设置为所需的文化（en-US、invariant 等）。

确保您没有将日期作为字符串进行任何工作——确保它们是实际的 Date 对象！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-11T20:17:50.243

好的，我不确定您要在这里做什么：

*   您发布的代码**不是**.NET，您要移植吗？
*   DateTime 不能声明为常量。
*   DateTime 是一种数据类型，因此一旦初始化，它们的初始化格式就无关紧要了。
*   如果您需要一个常量值，那么只需创建一个始终返回相同 DateTime 的方法。

例如：

```
public static DateTime SadDayForAll()
{
    return new DateTime(2001, 09, 11);
} 
```

### 更新

你到底是从哪里弄来的？！

*   C# 和 VB.NET 之间存在差异，这突出了其中之一**。**
*   **Date**不是[.NET 数据类型](http://www.ondotnet.com/pub/a/dotnet/2001/07/30/vb7.html)- **DateTime**是。
*   看起来您可以在 VB.NET 中创建 DateTime 常量，但有一些限制
*   该方法可以帮助您，因为您无法从**变量**（即可选参数）创建常量。这甚至没有意义。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-11T21:03:25.657

好吧，我更了解你来自哪里..

怎么样：

*   创建一个返回日期常量的静态方法。这克服了国际问题，因为它作为特定的 DateTime 值返回。
*   现在我记得我 VB6 时代的可选参数，但你能不能不只是重载方法？如果您使用的是没有日期的重载方法，只需将其从静态中拉出来？

**编辑：**如果您不确定我的意思并想要一个代码示例，只需评论这篇文章，我会添加一个。

# wpf - 保存前的 WPF 数据绑定

> ID：57493
> 
> 赞同：38
> 
> 时间：2008-09-11T20:08:29.923
> 
> 标签：wpf, data-binding

在我的 WPF 应用程序中，我有许多数据绑定文本框。这些`UpdateSourceTrigger`绑定的`LostFocus`. 使用文件菜单保存对象。我遇到的问题是可以在 TextBox 中输入一个新值，从“文件”菜单中选择“保存”，并且永远不要保留新值（在 TextBox 中可见的那个），因为访问菜单不会从 TextBox 移除焦点. 我怎样才能解决这个问题？有没有办法强制页面中的所有控件进行数据绑定？

*@palehorse：好点。不幸的是，我需要使用 LostFocus 作为我的 UpdateSourceTrigger 以支持我想要的验证类型。*

*@dmo：我已经想到了。然而，对于一个相对简单的问题，这似乎是一个非常不雅的解决方案。此外，它要求页面上有一些控件，该控件始终可见以接收焦点。但是，我的应用程序是选项卡式的，因此没有这样的控件很容易出现。*

*@Nidonocu：使用菜单并没有将焦点从 TextBox 移开这一事实也让我感到困惑。然而，这就是我所看到的行为。以下简单示例演示了我的问题：*

```
<Window x:Class="WpfApplication2.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300">
    <Window.Resources>
        <ObjectDataProvider x:Key="MyItemProvider" />
    </Window.Resources>
    <DockPanel LastChildFill="True">
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="File">
                <MenuItem Header="Save" Click="MenuItem_Click" />
            </MenuItem>
        </Menu>
        <StackPanel DataContext="{Binding Source={StaticResource MyItemProvider}}">
            <Label Content="Enter some text and then File > Save:" />
            <TextBox Text="{Binding ValueA}" />
            <TextBox Text="{Binding ValueB}" />
        </StackPanel>
    </DockPanel>
</Window> 
```

```
using System;
using System.Text;
using System.Windows;
using System.Windows.Data;

namespace WpfApplication2
{
    public partial class Window1 : Window
    {
        public MyItem Item
        {
            get { return (FindResource("MyItemProvider") as ObjectDataProvider).ObjectInstance as MyItem; }
            set { (FindResource("MyItemProvider") as ObjectDataProvider).ObjectInstance = value; }
        }

        public Window1()
        {
            InitializeComponent();
            Item = new MyItem();
        }

        private void MenuItem_Click(object sender, RoutedEventArgs e)
        {
            MessageBox.Show(string.Format("At the time of saving, the values in the TextBoxes are:\n'{0}'\nand\n'{1}'", Item.ValueA, Item.ValueB));
        }
    }

    public class MyItem
    {
        public string ValueA { get; set; }
        public string ValueB { get; set; }
    }
} 
```

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-11-19T16:59:16.347

我发现从菜单的 FocusScope 中删除范围依赖的菜单项会导致文本框正确失去焦点。我不认为这适用于菜单中的所有项目，但肯定适用于保存或验证操作。

```
<Menu FocusManager.IsFocusScope="False" > 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2011-01-18T13:44:57.397

假设选项卡序列中有多个控件，则以下解决方案似乎是完整且通用的（只是剪切和粘贴）...

```
Control currentControl = System.Windows.Input.Keyboard.FocusedElement as Control;

if (currentControl != null)
{
    // Force focus away from the current control to update its binding source.
    currentControl.MoveFocus(new TraversalRequest(FocusNavigationDirection.Next));
    currentControl.Focus();
} 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-12T07:32:13.087

这是一个丑陋的黑客，但也应该工作

```
TextBox focusedTextBox = Keyboard.FocusedElement as TextBox;
if (focusedTextBox != null)
{
    focusedTextBox.GetBindingExpression(TextBox.TextProperty).UpdateSource();
} 
```

此代码检查 TextBox 是否具有焦点...如果找到 1...更新绑定源！

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-12T07:22:48.540

> 假设您在一个窗口中有一个 TextBox 和一个带有 Save 按钮的 ToolBar。假设 TextBox 的 Text 属性绑定到业务对象上的属性，并且绑定的 UpdateSourceTrigger 属性设置为默认值 LostFocus，这意味着当 TextBox 失去输入焦点时，绑定的值会被推回业务对象属性。此外，假设 ToolBar 的 Save 按钮的 Command 属性设置为 ApplicationCommands.Save command。
> 
> 在这种情况下，如果您编辑文本框并用鼠标单击保存按钮，则会出现问题。单击工具栏中的按钮时，文本框不会失去焦点。由于 TextBox 的 LostFocus 事件不会触发，因此 Text 属性绑定不会更新业务对象的 source 属性。
> 
> 显然，如果 UI 中最近编辑的值尚未推送到对象中，则不应验证和保存对象。这正是 Karl 解决的问题，他在窗口中编写代码，手动查找具有焦点的 TextBox 并更新数据绑定的源。他的解决方案运行良好，但它让我想到了一个通用解决方案，该解决方案在这个特定场景之外也很有用。进入 CommandGroup…</p>

摘自 Josh Smith 关于[CommandGroup的 CodeProject 文章](http://www.codeproject.com/KB/WPF/commandgroup.aspx)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-09-22T17:24:23.457

简单的解决方案是更新 Xaml 代码，如下所示

```
 <StackPanel DataContext="{Binding Source={StaticResource MyItemProvider}}"> 
        <Label Content="Enter some text and then File > Save:" /> 
        <TextBox Text="{Binding ValueA, UpdateSourceTrigger=PropertyChanged}" /> 
        <TextBox Text="{Binding ValueB, UpdateSourceTrigger=PropertyChanged}" /> 
    </StackPanel> 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-11T20:14:05.933

您是否尝试将 UpdateSourceTrigger 设置为 PropertyChanged？或者，您可以调用 UpdateSOurce() 方法，但这似乎有点矫枉过正，违背了 TwoWay 数据绑定的目的。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-03-23T13:33:44.907

我遇到了这个问题，我发现的最佳解决方案是将按钮（或任何其他组件，如 MenuItem）的可聚焦值更改为 true：

```
<Button Focusable="True" Command="{Binding CustomSaveCommand}"/> 
```

它起作用的原因是因为它强制按钮在调用命令之前获得焦点，因此使 TextBox**或任何其他 UIElement**失去焦点并引发调用绑定被更改的丢失焦点事件。

*如果您使用有界命令（正如我在示例中所指出的那样），John Smith 的出色解决方案将不太适合，因为您无法将 StaticExtension 绑定到有界属性（也不是 DP）。*

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-11T21:09:10.247

您可以在保存之前将焦点设置在其他地方吗？

您可以通过在 UI 元素上调用 focus() 来完成此操作。

您可以专注于调用“保存”的任何元素。如果您的触发器是 LostFocus，那么您必须将焦点移到某处。Save 的优点是它不会被修改并且对用户有意义。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-12-30T14:12:35.703

由于我注意到这个问题仍然很难以非常通用的方式解决，因此我尝试了各种解决方案。

最终为我解决了一个问题：每当需要验证 UI 更改并将其更新到其源时（在关闭窗口、执行保存操作时检查更改...），我调用一个验证函数来执行各种操作事情： - 确保焦点元素（如文本框，组合框，...）失去其焦点，这将触发默认的 updatesource 行为 - 验证 DependencyObject 树中的任何控件，该控件提供给验证函数 - 将焦点设置回原始焦点元素

如果一切正常（验证成功），该函数本身返回 true -> 您的原始操作（通过可选的询问确认、保存等关闭）可以继续。否则，该函数将返回 false 并且您的操作无法继续，因为一个或多个元素存在验证错误（借助元素上的通用 ErrorTemplate）。

代码（验证功能基于文章[Detecting WPF Validation Errors](https://stackoverflow.com/questions/127477/detecting-wpf-validation-errors)）：

```
public static class Validator
{
    private static Dictionary<String, List<DependencyProperty>> gdicCachedDependencyProperties = new Dictionary<String, List<DependencyProperty>>();

    public static Boolean IsValid(DependencyObject Parent)
    {
        // Move focus and reset it to update bindings which or otherwise not processed until losefocus
        IInputElement lfocusedElement = Keyboard.FocusedElement;
        if (lfocusedElement != null && lfocusedElement is UIElement)
        {
            // Move to previous AND to next InputElement (if your next InputElement is a menu, focus will not be lost -> therefor move in both directions)
            (lfocusedElement as UIElement).MoveFocus(new TraversalRequest(FocusNavigationDirection.Previous));
            (lfocusedElement as UIElement).MoveFocus(new TraversalRequest(FocusNavigationDirection.Next));
            Keyboard.ClearFocus();
        }

        if (Parent as UIElement == null || (Parent as UIElement).Visibility != Visibility.Visible)
            return true;

        // Validate all the bindings on the parent 
        Boolean lblnIsValid = true;
        foreach (DependencyProperty aDependencyProperty in GetAllDependencyProperties(Parent))
        {
            if (BindingOperations.IsDataBound(Parent, aDependencyProperty))
            {
                // Get the binding expression base. This way all kinds of bindings (MultiBinding, PropertyBinding, ...) can be updated
                BindingExpressionBase lbindingExpressionBase = BindingOperations.GetBindingExpressionBase(Parent, aDependencyProperty);
                if (lbindingExpressionBase != null)
                {
                    lbindingExpressionBase.ValidateWithoutUpdate();
                    if (lbindingExpressionBase.HasError)
                        lblnIsValid = false;
                }
            }
        }

        if (Parent is Visual || Parent is Visual3D)
        {
            // Fetch the visual children (in case of templated content, the LogicalTreeHelper will return no childs)
            Int32 lintVisualChildCount = VisualTreeHelper.GetChildrenCount(Parent);
            for (Int32 lintVisualChildIndex = 0; lintVisualChildIndex < lintVisualChildCount; lintVisualChildIndex++)
                if (!IsValid(VisualTreeHelper.GetChild(Parent, lintVisualChildIndex)))
                    lblnIsValid = false;
        }

        if (lfocusedElement != null)
            lfocusedElement.Focus();

        return lblnIsValid;
    }

    public static List<DependencyProperty> GetAllDependencyProperties(DependencyObject DependencyObject)
    {
        Type ltype = DependencyObject.GetType();
        if (gdicCachedDependencyProperties.ContainsKey(ltype.FullName))
            return gdicCachedDependencyProperties[ltype.FullName];

        List<DependencyProperty> llstDependencyProperties = new List<DependencyProperty>();
        List<FieldInfo> llstFieldInfos = ltype.GetFields(BindingFlags.Public | BindingFlags.FlattenHierarchy | BindingFlags.Instance | BindingFlags.Static).Where(Field => Field.FieldType == typeof(DependencyProperty)).ToList();
        foreach (FieldInfo aFieldInfo in llstFieldInfos)
            llstDependencyProperties.Add(aFieldInfo.GetValue(null) as DependencyProperty);
        gdicCachedDependencyProperties.Add(ltype.FullName, llstDependencyProperties);

        return llstDependencyProperties;
    }
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-23T13:35:59.110

最简单的方法是*将焦点设置在某处*。
您可以立即重新设置焦点，但将焦点设置在任何位置都会触发**任何类型的控件**上的 LostFocus-Event并使其更新其内容：

```
IInputElement x = System.Windows.Input.Keyboard.FocusedElement;
DummyField.Focus();
x.Focus(); 
```

另一种方法是获取焦点元素，从焦点元素中获取绑定元素，然后手动触发更新。TextBox 和 ComboBox 的示例（您需要添加需要支持的任何控件类型）：

```
TextBox t = Keyboard.FocusedElement as TextBox;
if ((t != null) && (t.GetBindingExpression(TextBox.TextProperty) != null))
  t.GetBindingExpression(TextBox.TextProperty).UpdateSource();

ComboBox c = Keyboard.FocusedElement as ComboBox;
if ((c != null) && (c.GetBindingExpression(ComboBox.TextProperty) != null))
  c.GetBindingExpression(ComboBox.TextProperty).UpdateSource(); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-06-01T00:47:03.703

你怎么看待这件事？我相信我已经找到了一种使用反射使其更通用的方法。我真的不喜欢像其他一些例子那样维护一个列表的想法。

```
var currentControl = System.Windows.Input.Keyboard.FocusedElement;
if (currentControl != null)
{
    Type type = currentControl.GetType();
    if (type.GetMethod("MoveFocus") != null && type.GetMethod("Focus") != null)
    {
        try
        {
            type.GetMethod("MoveFocus").Invoke(currentControl, new object[] { new TraversalRequest(FocusNavigationDirection.Next) });
            type.GetMethod("Focus").Invoke(currentControl, null);
        }
        catch (Exception ex)
        {
            throw new Exception("Unable to handle unknown type: " + type.Name, ex);
        }
    }
} 
```

看看有什么问题吗？

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-11-13T06:27:24.643

我正在使用绑定组。

XAML：

```
<R:RibbonWindow Closing="RibbonWindow_Closing" ...>

    <FrameworkElement.BindingGroup>
        <BindingGroup />
    </FrameworkElement.BindingGroup>

    ...
</R:RibbonWindow> 
```

C＃

```
private void RibbonWindow_Closing(object sender, CancelEventArgs e) {
    e.Cancel = !NeedSave();
}

bool NeedSave() {
    BindingGroup.CommitEdit();

    // Insert your business code to check modifications.

    // return true; if Saved/DontSave/NotChanged
    // return false; if Cancel
} 
```

它应该工作。

# svn - 关于从 Clearcase 迁移到 SVN 的工具的建议？

> ID：57494
> 
> 赞同：6
> 
> 时间：2008-09-11T20:08:32.187
> 
> 标签：svn, migration, clearcase

我正在寻找从 ClearCase 迁移到 SVN 的工具。

理想情况下希望获得所有历史信息，或者尽可能多地获得。

增量合并将非常有益，但不是必需的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-11T20:19:01.613

[这](http://www.polarion.org/index.php?page=download&project=svnimporter)看起来是最好的。Polarion 的业务是 SVN，所以我想他们有既得利益[让尽可能多的人使用它](http://www.polarion.org/index.php?page=features&project=svnimporter)......

哦，事先备份所有数据，先在测试存储库上进行，等等等等。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-07-08T10:19:05.670

我遇到了与 Peter 相同的问题：Polarion 脚本无法继续处理大型 CleraCase VOB，并且总是以 Java Heap Size out-of-memory 错误告终。

我还遇到了另一个导致导入后数据损坏的关键问题。

Polarion 脚本就是这样工作的：

1.  使用 cleartool 命令访问 ClearCase 数据
2.  使用自己的算法将这些数据转储到 SVN DUMP 中的平面文件中
3.  SVN中使用svnadmin导入dump文件

我设法在一个较小的 VOB 上运行 Polarion 脚本。一切看起来都很好（导入成功完成，没有错误消息），但 SVN 存储库不可用（无法检查，没有确切的错误消息） - 尝试了几次，结果相同。

我了解该脚本正在根据自己的代码而不是任何 SVN API 重建 SVN DUMP 文件。它可能是为特定版本的 SVN（1.4，也许是 1.5？）而设计的，而我使用的是 SVN 1.6。此后，DUMP 文件格式可能已更改，或者 Polarion 脚本无法正确处理特定 ClearCase 数据的某些副作用。然而，在一天结束时，它只是不工作。

因此，我强烈建议使用另一种解决方案，并且可能基于 cleartool 和实际的 SVN API 构建您自己的脚本，以避免任何数据一致性问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-02T07:46:45.097

从 clearcase 迁移并非易事。polarion 进口商会为您提供支持，但是，大型 clearcase 存储库的历史和速度很难估计。

历史只会从 main 导入所有文件，不会考虑任何目录版本。问题是，如果您重命名它们，将放入标签中的文件具有最新名称。导入器也不会迁移已删除的文件。

由于导入器无法使用您的配置规范，它只会显示分支中更改的文件，因为 clearcase 使用延迟分支，这与 svns 分支机制完全不同。

迁移工具不支持合并跟踪，因为 SVN 仅从 1.5 开始支持它

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-19T16:19:42.500

只是另一种体验：

我们使用“自定义脚本”而不是 Polarion 工具。
这样，我们可以：

*   使用动态视图（快速更新）
*   准确选择我们要导入的分支
*   仅导入带有标签的版本（避免导入大量版本，而实际上没有人会利用那巨大的历史）
*   导入最后一个标签和 LATEST 之间的所有版本（对于给定的分支）

我们使用动态视图来更改其配置规范，并将所有我们感兴趣的标签导入 SVN。

注意：我们使用 UCM 对导出操作有很大帮助：

*   明确标识了分支（在其附加的流之后），并且
*   *在给定组件的所有*文件上设置标签（在 Base ClearCase 中，标签可以设置任意数量的文件）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-07-01T10:44:49.753

Polarion 工具的最后一个版本是从 2006 年开始的，它只是无法处理大型 CC vobs。就我而言，它总是因堆溢出而崩溃，即使是最大的 java 堆空间也不够用。所以对我没有好处。

# .net - Gallio 的用户，您在使用此工具时体验过哪些优点和缺点？

> ID：57512
> 
> 赞同：12
> 
> 时间：2008-09-11T20:17:58.043
> 
> 标签：.net, testing, integration, mbunit, gallio

对于那些熟悉[Gallio](http://www.gallio.org)的人来说，使用这个工具，即所谓的测试自动化平台，您体验过哪些优点和缺点？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-26T12:47:46.667

我们使用 Gallio/MbUnit 已经一年了。我们对此非常满意，Gallio 开发人员不断推出很酷的新功能，并且开发很活跃。如果您决定使用它，这里有一些提示/注意事项：

1.  为自己购买一个 TestDriven.NET 许可证 - 我认为这是 Gallio 单元测试的必要条件，因为 Resharper 测试运行程序不知道如何运行某些测试 + Gallio 有一个针对 TD.NET 的测试运行程序。
2.  我们为 CI 脚本/构建使用 Gallio.Echo 命令行运行程序。Gallio Icarus - GUI 运行器（至少是当前版本）非常不稳定且对用户不太友好。
3.  如果您想使用最新的 Gallio 功能（如并行测试等），请准备好使用最新的 Gallio 每日版本。如果这是一个问题，请继续使用“官方”构建，但我们在日常构建版本中没有遇到任何实际问题。
4.  我建议将基本的 Gallio .DLL 和 .EXE 添加到您的源代码管理中。并且实际上在您的项目中引用**这些**，而不是来自 GAC 的。这样，如果您团队中的某个人在他/她的机器上安装了不同版本的 Gallio，您将避免任何“在我的机器上工作”问题。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-02-26T13:29:18.690

我也尝试了 Gallio，它的运行速度比 TDD.Net 或本机 NUnit GUI 测试运行器慢得多。它甚至比 Resharper 跑步者还要慢！

我应该补充一点，我在这里谈论的是运行 NUnit 测试。

我不记得确切的数字，但相同的测试大约需要 3 分钟，NUnit 在 30 秒内完成（在一个线程、单个进程、多个域上运行）。

这本身就已经让它不行了。再加上笨重的 GUI，你就知道要远离它。

* * *

一些额外的信息：

*   在我的解决方案中，我进行了 NUnit 测试，并且最近开始添加[MSpec](http://blog.wekeroad.com/blog/make-bdd-your-bff-2/) 规范。在我重新编译并且测试 dll 更改后，我打开了 NUnit Gui 以自动重新运行我的旧测试（所有新测试都编写为 MSpecs）。

*   我使用 TDD.Net 来运行我的 Mspec 规范。

*   这使我能够在我的 Specs 完成运行而 NUnit Gui 运行器仍在完成时继续工作。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-11T20:23:47.483

当我们评估 Gallio 时，我们遇到了大型项目的稳定性问题。然而，我们较小的项目运行良好。伟大的概念......我认为一旦它更精致一点，它会引起轰动。

我可能想补充一点，Resharper 支持丢失（或损坏）了一段时间，但我听说它又回来了。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-20T22:45:17.080

最新版本的 Gallio (3.0.6) 解决了这些帖子中提到的许多稳定性问题。特别是，Icarus 现在更加稳定，并且能够附加到内置的调试器，因此使用起来甚至比 Resharper 更快，Resharper 在每次测试运行之前重新编译代码。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-10-08T11:12:43.863

它非常不稳定，我大约在 3-4 个月前使用它，它非常不稳定而且速度很慢。

现在我刚刚尝试过，当您单击“保存”时它会崩溃，然后它永远不会再次打开，除非您去清理“本地设置”，我认为它仍然非常不稳定。

我希望他们停止添加新功能，而是修复这些相当明显的错误。

PS Project 有 1000~ 个单元测试，它正在使用 nUnit（可能只是我的 nUnit 和 Gallio 不能很好地配合使用）

我真的很想使用它，而且我有 3.1 - 313，我什至无法保存项目而不会崩溃！

**毕竟坏东西的优点在这里：**

*   对不同风格的强大支持，我已经将它用于 nUnit 和 mbUnit，它非常好。它甚至很好地支持 nUnit 中的 RowTest。

*   GUI非常酷，干净

*   具有设置工作目录等强大功能
*   报告与整合

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-11T20:22:11.577

在优势方面，与一切的集成非常好 :) 说真的，我非常喜欢与 Visual Studio Team System 的实验性集成（[此处](http://blog.bits-in-motion.com/2008/05/announcing-gallio-v30-alpha-3.html)为屏幕截图）。我认为这确实降低了单元测试新手的门槛。

*到目前为止*，从我的角度来看，唯一的缺点是它尚未发布。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-11T20:31:36.357

我一直在评估 Gallio，它确实是一个很棒的概念。现在我不必告诉我的开发人员他们必须使用什么单元测试框架，因为它与我所知道的所有主要框架都集成了。他们可以使用他们最熟悉的那个，我得到单元测试的代码。

[Resharper](http://www.jetbrains.com/resharper/)集成也很好。我可以使用 Resharper 运行所有单元测试，而无需跳到命令行来运行它们。

在我看来，这肯定会使将单元测试引入商店变得容易得多。我同意[@David](https://stackoverflow.com/questions/57512/users-of-gallio-what-advantages-and-disadvantages-have-you-experienced-using-th#57521)，缺点是它还没有发布。

# .net - XmlDocument 上的 SelectNodes 是否有可能返回 null？

> ID：57518
> 
> 赞同：8
> 
> 时间：2008-09-11T20:20:29.317
> 
> 标签：.net, xml, unit-testing, resharper

是否有可能`SelectNodes()`被调用`XmlDocument`返回null？

我的困境是我试图达到 100% 的单元测试代码覆盖率；ReSharper 告诉我，我需要防止该`SelectNodes()`方法返回 null，但我看不出 XmlDocument 无法返回 null（因此，无法测试我的保护子句并达到 100% 的单元测试覆盖率！）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-11T20:27:25.587

查看反射器，如果尝试创建导航器返回 null，则 XmlDocument 的基类 XmlNode 上的 SelectNodes() 方法可以返回 null。CreateNavigator() 非常复杂，在某些情况下确实会返回 null。这些情况似乎与格式错误的 XML 文档有关——因此您的测试案例是 SelectNodes() 失败。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-11T20:35:29.797

如果您在 XmlDocument 本身上调用 SelectNodes 并且它确实是 XmlDocument 而不是派生类，则 SelectNodes 将不会返回 null。

如果您创建后代类并覆盖 CreateNavigator(XmlNode) 方法，则 SelectNodes 可能会返回 null。

同样，如果您在 EntityReference、DocumentType 或 XmlDeclaration 节点上调用 SelectNodes，您也​​会得到 null

简而言之，对于您不只是创建的 XmlDocument 或 XmlNode 的 100% 覆盖，您必须测试 null。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-11T20:27:05.993

是否有必要达到 100% 的代码覆盖率？事实上，在正常（即可控、可测试）的情况下，它甚至可能吗？

我们经常发现，使用像`using {}`块这样的“语法糖”结构，创建的“隐藏”代码路径（很可能是`finally {}`块`catch {}`）无法执行，除非某些环境条件（如损坏的套接字或损坏的磁盘）进入方式。

# javascript - 混合了文字和数组的 Javascript 数组

> ID：57522
> 
> 赞同：3
> 
> 时间：2008-09-11T20:22:31.123
> 
> 标签：javascript, jquery

我可以创建以下内容并使用

```
area[0].states[0] 
area[0].cities[0]

var area = [
        {
         "State"   : "Texas",
         "Cities"  : ['Austin','Dallas','San Antonio']
        },
        {
         "State"   :"Arkansas",
         "Cities"  : ['Little Rock','Texarkana','Hot Springs']
        }
       ] ; 
```

我如何重组“区域”，以便如果我知道州名，我可以在引用中使用它来获取城市数组？

谢谢

**编辑**尝试用我收到的答案来实施（感谢@Eli Courtwright、@17 of 26 和@JasonBunting）我意识到我的问题不完整。我需要在第一次通过索引引用“状态”时遍历“区域”，然后当我选择“状态”时，我需要使用“状态”的值循环回一个结构以获得关联的“城市”。我确实想从上述结构开始（尽管我可以自由地按照自己的方式构建它）并且我不介意类似于@eli 的答案的转换（尽管我无法使该转换正常工作）。第一个问题应该更完整。尝试实现 2 个选择框，其中第一个选择填充第二个...当页面加载时，我将在 js 文件中加载这个数组结构。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-11T20:27:53.730

```
var area = 
{
    "Texas" : { "Cities"  : ['Austin','Dallas','San Antonio'] },
    "Arkansas" : { "Cities"  : ['Little Rock','Texarkana','Hot Springs'] }
}; 
```

然后你可以这样做：

```
area["Texas"].Cities[0]; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-12T01:02:32.243

（在答案的帮助下，我得到了我想要的工作。我在下面的代码中修复了所选答案中的语法）

使用以下选择框

```
<select id="states" size="2"></select>
<select id="cities" size="3"></select> 
```

和这种格式的数据（在 .js 文件中或作为 JSON 接收）

```
var area = [
    {
     "states"   : "Texas",
     "cities"  : ['Austin','Dallas','San Antonio']
    },
    {
     "states"   :"Arkansas",
     "cities"  : ['Little Rock','Texarkana','Hot Springs']
    }
   ] ; 
```

这些 JQuery 函数将根据州选择框选择填充城市选择框

```
$(function() {      // create an array to be referenced by state name
 state = [] ;
 for(var i=0; i<area.length; i++) {
  state[area[i].states] = area[i].cities ;
 }
});

$(function() {
 // populate states select box
 var options = '' ;
 for (var i = 0; i < area.length; i++) {
  options += '<option value="' + area[i].states + '">' + area[i].states + '</option>'; 
 }
 $("#states").html(options);   // populate select box with array

 // selecting state (change) will populate cities select box
 $("#states").bind("change",
   function() {
    $("#cities").children().remove() ;      // clear select box
    var options = '' ;
    for (var i = 0; i < state[this.value].length; i++) { 
     options += '<option value="' + state[this.value][i] + '">' + state[this.value][i] + '</option>'; 
    }
    $("#cities").html(options);   // populate select box with array
   }        // bind function end
 );         // bind end 
}); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T20:26:52.610

如果您只想以这种方式创建它，只需说

```
area = {
    "Texas": ['Austin','Dallas','San Antonio']
} 
```

等等。如果您要问如何获取现有对象并将其转换为此，只需说

```
states = {}
for(var j=0; j<area.length; j++)
    states[ area[0].State ] = area[0].Cities 
```

运行上面的代码后，你可以说

```
states["Texas"] 
```

这将返回

```
['Austin','Dallas','San Antonio'] 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T20:28:23.247

这将为您提供基于了解州名的城市数组：

```
var area = {
   "Texas" : ["Austin","Dallas","San Antonio"], 
   "Arkansas" : ["Little Rock","Texarkana","Hot Springs"]
};

// area["Texas"] would return ["Austin","Dallas","San Antonio"] 
```

# sql-server - VBScript/ASP Classic 和 ADO 中的参数化

> ID：57528
> 
> 赞同：4
> 
> 时间：2008-09-11T20:26:20.740
> 
> 标签：sql-server, asp-classic, vbscript, ado

我在这里有点困惑。据我所知，微软声称参数化是保护数据库免受 SQL 注入攻击的最佳方式。但我在这里发现了两个相互矛盾的信息来源：

[该页面](http://support.microsoft.com/kb/200190)说使用 ADO 命令对象。但是[这个页面](http://msdn.microsoft.com/en-us/library/ms679836(VS.85).aspx)说命令对象对于脚本来说是不安全的。我似乎记得在某处读过，由于安全漏洞，命令对象不应该在 VBScript 或 JScript 中使用，但我似乎找不到那篇文章。

我在这里遗漏了什么，或者这两篇文章似乎相互矛盾？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-11T21:21:19.937

我在这里可能是错的，但我认为这只是意味着有人可以使用 Command 对象做坏事。即，如果其他人正在编写脚本，则不值得信任。

请参阅本文[中的脚本安全。](http://www.avdf.com/mar97/art_interface.html)每个在线谈论这个短语的实例都会引用它，就好像你正在标记一个 ActiveX 控件，说“这个控件没有 I/O 或只与它来自的服务器对话”，但 Command 对象不这样做。它可以用来做很多可能不安全的事情。

他们所说的“安全”和防止SQL注入的“安全”是两个不同的东西。关于使用 ADO Command 对象参数化数据的文章很贴切。你应该这样做。

而且，微软在这里进一步证实了这一点：

[http://msdn.microsoft.com/en-us/library/ms676585(v=VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms676585(v=VS.85).aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T21:25:21.347

我认为“脚本安全”的意思是“可以安全地从我们刚刚从某个尼日利亚王子那里检索到的网页运行”。命令对象应该可以安全地在服务器上运行。

不过在工作中，当时我的同事并不信任它，所以我们有一个内部框架，基本上做同样的事情。

# svn - 有什么工具可以将仓库从 Vault 迁移到 Subversion？

> ID：57530
> 
> 赞同：16
> 
> 时间：2008-09-11T20:26:49.973
> 
> 标签：svn, version-control, sourcegear-vault, version-control-migration

是否有任何**工具**可以促进从[Sourcegear 的 Vault](http://www.sourcegear.com/vault/index.html)到[Subversion](http://subversion.tigris.org/)的迁移？

我真的更喜欢现有的工具或项目（我会买！）。

**要求：**

1.  仅限一次性迁移
2.  带有评论的完整历史记录

**选修的：**

1.  对标签/分支/标签的一些支持
2.  比较快。它可能需要几个小时，但不是几天。
3.  费用（如果有）

如果您可以分享与此过程相关的个人经验，则可以加分。

* * *

我想这样做的原因之一是因为我们有很多项目分布在 Vault 和 Subversion 之间（我们终于远离了 sourcesafe）。在某些情况下，能够将特定客户的回购合并到 SVN 会很有帮助。

此外，SVN 在第三方工具中得到更好的支持。例如，[Hudson](http://hudson.dev.java.net/)和[Redmine](http://www.redmine.org/)。

不过，再次重申：我们并没有完全放弃保险库。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-11-30T18:45:14.853

我们正在考虑从 vault 迁移到 git。我编写了 vault2git 转换器，它负责处理历史并从 *.sln、*.csproj 文件中删除 vault 绑定。

一旦你有了 git repo，就有了 git2svn。

我知道这听起来像是绕圈子，但它可能比从头开始编写 vault2svn 更快。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-11T23:43:08.893

如果您想要完整的版本历史记录，您可能只想编写一个脚本，从 Vault 中检出每个版本，并将其与 Subversion 的注释一起检入。

[https://www.mercurial-scm.org/wiki/GenericConversion](http://www.selenic.com/mercurial/wiki/index.cgi/GenericConversion)就是一个很好的例子

根据我在 Vault 网站上看到的文档，查看命令行 GETVERSION。

使用您最喜欢的脚本语言...实现以下过程：

1.  从 Vault 中查看一个版本。
2.  获取变更集的提交评论。
3.  将文件添加/删除到 SVN 存储库
4.  使用提交注释提交文件
5.  使用下一个版本返回第一步

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-11T21:00:07.913

我从来没有找到从 Vault 转换为 svn 的简单方法。基本上，我们采用了最新的分支和主干，并在 svn 中开始了新的工作。老实说，我退了两三个标签，只是因为。我将保管库数据库保存了六个月，我们再也不需要回到它那里获取数据。因此，我假设您希望将您的历史发扬光大，以配合错误跟踪器；同时，我们将未解决的错误列表转移到了一个新的跟踪器中，这无疑让事情变得更加方便。如果我们使用相同的错误跟踪器，我想我们会为新的 repo 启动一个新的实例。祝你好运！

布雷特

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-16T14:44:30.043

自由。自从我们开始使用以来，Vault 用户许可证成本增加了两倍。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-16T21:30:26.187

我们也在考虑迁移。一个原因是成本，但另一个原因是 Vault 没有使用有效的 xml（或任何）作为其提交注释，因此特殊字符无法通过我们的自动 CCNet 构建系统（例如，项目符号字符就是其中之一，并且特别给我们带来了问题） . 解决此问题的方法是 A) 要求我们的开发人员不要使用这些特殊的“无效”字符（ASCII 32 - 126 范围之外的字符）和 B) 手动进入并重新提交带有“有效”的代码评论。这可能看起来没什么大不了的，但是不允许这些字符会阻止将错误和其他评论轻松复制/粘贴到提交评论中。这会减慢人们的速度，任何阻碍流动和生产力并造成挫败感的东西都需要减少或消除。

根据我的研究，似乎没有办法直接从 Vault 迁移到 SVN。也许可以使用另一个版本控制系统作为迁移中间步骤：Vault --> OtherSourceControlProduct --> SVN

...但我认为我们要么编写提交脚本（正如 Joshua 在本线程开头所建议的那样），要么 - 更有可能 - 只提交最后几个修订版并将 Vault repos 保留一段时间以获取历史记录等。这个实际上给了我们一个很好的机会来清理和重构我们当前的代码和层次结构。

保罗

# java - 从 Servlet 访问 Tomcat 上下文路径

> ID：57537
> 
> 赞同：6
> 
> 时间：2008-09-11T20:28:31.887
> 
> 标签：java, tomcat, servlets

在我的 Servlet 中，我想访问上下文的根，以便我可以做一些 JavaScript 缩小。

可以在安装过程中进行缩小，但我想在 Servlet 启动时进行以降低实施成本。

有谁知道获取上下文目录以便我可以将文件加载和写入磁盘的方法？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-11T20:49:26.253

这应该为您提供可用于提取/编辑文件的真实路径。

[Javadoc 链接](http://java.sun.com/j2ee/sdk_1.3/techdocs/api/javax/servlet/ServletContext.html#getRealPath(java.lang.String))

我们在上下文监听器中做类似的事情。

```
public class MyServlet extends HttpServlet {

    public void init(final ServletConfig config) {
        final String context = config.getServletContext().getRealPath("/");
        ...
    }

    ...
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-11-27T11:49:50.273

> *在我的 Servlet 中，我想访问上下文的根，以便我可以做一些 JavaScript 缩小*

您还可以通过 访问 WebContent 中的文件[`ServletContext#getResource()`](http://java.sun.com/javaee/5/docs/api/javax/servlet/ServletContext.html#getResource%28java.lang.String%29)。因此，如果您的 JS 文件位于例如，`WebContent/js/file.js`那么您可以使用以下内容`Servlet`来获取`File`它的句柄：

```
File file = new File(getServletContext().getResource("/js/file.js").getFile()); 
```

或得到一个`InputStream`：

```
InputStream input = getServletContext().getResourceAsStream("/js/file.js"); 
```

也就是说，您需要多久压缩一次 JS 文件？我从未见过需要基于请求的缩小，它只会不必要地增加很多开销。您可能只想在应用程序启动期间执行一次。如果是这样，那么使用 a`Servlet`是一个坏主意。更好地使用[`ServletContextListener`](http://java.sun.com/javaee/5/docs/api/javax/servlet/ServletContextListener.html)和做你的事`contextInitialized()`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-27T10:36:32.320

我在谷歌上搜索结果，却一无所获。在需要使用 Java Script 访问当前*contextPath*的 JSP 页面中，这实际上非常容易。

只需将以下行放入块内的*html 头中。*`script`

```
// set up a global java script variable to access the context path
var contextPath = "${request.contextPath}" 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-11T20:39:05.297

你的意思是：

```
public class MyServlet extends HttpServlet {

    public void init(final ServletConfig config) {
        final String context = config.getServletContext();
        ...
    }

    ...
} 
```

或者更复杂的东西？

# .net - 在 Windows Mobile 6 应用程序中嵌入视频的最佳方式是什么？

> ID：57545
> 
> 赞同：1
> 
> 时间：2008-09-11T20:32:18.727
> 
> 标签：.net, windows-mobile, video, compact-framework

应用程序需要在 .Net Compact Framework v.3.5 上运行。视频可以是任何格式，但我确实需要知道它何时播放完毕，这样我才能开始另一个。

如果可能的话，我希望有一种不涉及非托管代码的方法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T17:35:02.123

您需要使用 ActiveX Hosting 嵌入它。上面有一个[MSDN 教程](http://msdn.microsoft.com/en-us/library/aa446515.aspx)（注意[MS 发布的代码中有一个错误](http://blog.opennetcf.com/ctacke/2008/08/14/BugInMSDNActiveXHostingCode.aspx)）。如果你想要一种更友好的方式，那么 OpenNETCF 也有一个[商业控制](http://www.opennetcf.com/Products/Controls/MediaPlayerControls/tabid/264/Default.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-24T15:35:10.867

可以从 Adob​​e 2.1 下载的 Flash Lite 版本不支持视频，因此您不能将其嵌入为 ActiveX 控件。您唯一真正的选择是遵循@ctacke 的建议并嵌入 Windows Media Player 或其他提供您可以使用的 ActiveX 控件的媒体播放器（我不知道有任何 - 抱歉！）。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-11T20:36:53.460

Silverlight 即将登陆 windows mobile 6，它现在处于超级精英测试版中，也许可以参与其中。

# web-services - IMAP 转发器

> ID：57547
> 
> 赞同：7
> 
> 时间：2008-09-11T20:32:41.643
> 
> 标签：web-services, email, web-applications, imap, forwarding

我想知道从 IMAP 帐户转发邮件的最快和最可靠的方法是什么。

我的大学不允许我们的学生邮箱转发到私人电子邮件帐户（这里每个人都使用 Gmail 或 Hotmail）。这是一个政治问题，而不是技术问题。我们确实有对邮箱的 IMAP 访问权限。我想要一项通过 IMAP 下载邮件并转发的服务。扩展它会很好，所以成千上万的学生可以使用它。最终，我想建立一个公共注册页面，并从那里自动处理它。

到目前为止，我已经制作了一个不错的 PHP 脚本，它可以连接、下载标题和正文部分，并将它们联系在一起。我有两个问题。

1）我正在下载所有类型的部分，并将它们重新组合在一起。我希望每个异国情调的附件、奇怪的编码文本和每种类型的标题都能幸免于难。我什至不确定我是否有完整的标题。

2) to: 电子邮件地址成为私人电子邮件地址，而不是原始学生电子邮件地址。我认为这是蹩脚的，并且在搜索和存档时不方便。

PHP脚本是要走的路吗？使用特定的 linux 邮件服务/守护进程有什么技巧吗？IMAP 是否有“转发”命令，我错过了？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-11T20:45:33.157

您可能想查看[Fetchmail](http://www.fetchmail.info//)，因为这听起来像是它旨在解决的问题。Fetchmail 从 POP/IMAP/etc 服务器检索邮件并将其转发到 SMTP/LMTP/etc 服务器。Fetchmail 的优势是用了几年和很多用户解决了各种 IMAP 服务器的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T21:10:02.990

Fetchmail 似乎是要走的路。我可以使用 PHP 生成/编辑一个 fetchmail 命令文件，这样就可以涵盖公共注册。我正在寻找一个已经这样做的包/脚本。

Gmail 拉取仅适用于 POP3，不适用于 IMAP。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-11T20:46:11.877

如果使用 Gmail，您可以将 GMAIL 配置为从其他帐户接收邮件。

# gps - GPS 和嵌入式开发 - 在哪里可以找到资源？

> ID：57549
> 
> 赞同：3
> 
> 时间：2008-09-11T20:34:16.447
> 
> 标签：gps, embedded

我刚刚开始设计一些嵌入式设备，并且正在寻找资源。

我想要做的是将 GPS 接收器连接到轻型 SBC 或 mini-ITX、基于 x86 的计算机，并跟踪遥控车辆的位置/进度。

理想情况下，这可以转变为制造一些业余爱好的半自动车辆。

但我需要开始的是一个用于 GPS 编程的开发板。

您使用了哪些板/包，我在哪里可以找到 [最好是开源的] 开发？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-11T21:01:16.507

[OpenEmbedded](http://www.openembedded.org)是一个入门的好地方。很多嵌入式产品使用 ARM 和其他处理器，所以交叉编译很重要。 [Buildroot](http://buildroot.uclibc.org/)是为小型系统构建自定义 linux 内核的另一种资源。

您还可以找到许多使用单板计算机 (SBC) 的制造商，这些制造商有工具来做您想做的事 - 谷歌搜索“SBC Linux”，您应该有一个金矿。

[LinuxDevices 密切](http://linuxdevices.com/)关注 linux 嵌入式社区，您应该在那里找到几篇很好的文章，引导您找到可以帮助您的产品或软件。

Debian 有一个嵌入式构建，但我还没有探索过。

如果你想走这条路，有几本关于[嵌入式 linux的书可用。](http://www.linuxdevices.com/articles/AT2969812114.html)

GPS 接收器只需连接到串行或 USB 端口，并呈现 NMEA 数据流，您可以使用 GPSD 对其进行解析，并且多个程序可以通过 GPSD 访问它。这是一种非常简单的基于文本的格式。

我使用了普通的 PC 主板，以及用于嵌入式系统的 Atmel AT91 处理器（带有 GPS、蜂窝等）。现在有很多信息，而且进入起来并不昂贵。如果我要开始一个新项目，我会看看 Atmel 的 AVR32 处理器——它们对爱好者非常友好，并且在 AVR32 架构上为 linux 提供了很多社区支持。如果您想走无操作系统路线并在处理器上运行单个程序，它们提供免费的 GCC 编译器和重要的框架和示例。

祝你好运！

-亚当

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-11T20:52:27.353

“NMEA”是寻找这些东西时要搜索的关键字。虽然我很长很长时间没有对此做任何事情，但这里是一些板和其他硬件的一个很好的来源：

[http://www.sparkfun.com/commerce/categories.php?c=4](http://www.sparkfun.com/commerce/categories.php?c=4)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-11T20:53:41.343

我们对 Holux GPS 接收器（专为三星 q1 设计）带来了好运。通过串行端口进行非常简单的连接，您可以读取 NMEA 字符串。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-11T20:59:00.020

你的目标是什么操作系统？如果是 Linux，有很多可用的 GPS 库（[这里有一个很好的列表](http://tuxmobil.org/linux_gps_navigation_applications.html)）。 [GPSd](http://gpsd.berlios.de/)和[GpsDrive](http://www.gpsdrive.de/)是我见过的两个比较流行的。

我还没有看到任何专门用于轻量级/嵌入式使用的 GPS 设备，但许多消费类 GPS 设备都有可能工作的 USB 连接（注意低端设备，它们通常没有计算机接口）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-12T22:38:00.353

我建议从一个普通的旧 c 项目开始，该项目从串行端口读取和解析 NMEA。您可以在 Windows 或 Linux 中执行此操作。

我通常将任何这样的项目分解为一组较小的项目，例如：

1.  从串口读取和解析 NMEA
2.  建立从远程设备到跟踪系统服务器的串行/网络链接
3.  整合组件

维基百科有一篇关于[NMEA](http://en.wikipedia.org/wiki/NMEA_0183)协议的好文章。正如亚当指出的那样，它实际上非常简单。

Circuit Cellar 杂志也经常有这样的项目。
根据您要执行的操作，需要考虑各种大小的目标。将 Atmel AVR 用于小型低功耗（电池）设备。如果我只是想大致了解一下这个概念并需要 WiFi（或蜂窝网络）来上网，也许可以在旧笔记本电脑上使用 Linux。

然后可以对笔记本电脑 Linux 原型进行精简并移植到嵌入式 Cinux 系统，以便以后降低电池使用量和便携性。（虽然不如 Atmel 低）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-27T07:30:39.633

如果您对在 Linux 中编程感到满意，我会推荐 Gumstix 系列小型计算机 - [http://www.gumstix.com/](http://www.gumstix.com/)

您可以将 vedex 主板与 GPSstix 扩展板配对，从而制作一个具有良好编程环境的微型 GPS 接收器。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-12T15:47:01.220

我建议[GPSBabel](http://www.gpsbabel.org/)与您的 GPS 接收器进行通信。

GPS巴贝尔

*   处理航路点、航迹和路线，
*   知道很多格式（这解释了 Babel 这个名字），
*   可在 Windows、Linux、OSX、
*   自由。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-09T09:22:02.333

这里的一些人推荐了像 gumstix 这样的设备——没有 GPS 的嵌入式设备，售价 149 美元。我不明白那一点。现成的 TomTom 配备在 ARM 上运行 Linux、内置 GPS、大量闪存、电池和屏幕。量产带来的价格优势是难以超越的。对于您的爱好项目，不需要包含的地图，但谁在乎呢？

# asp.net - AJAX 下拉扩展问题

> ID：57552
> 
> 赞同：2
> 
> 时间：2008-09-11T20:34:43.760
> 
> 标签：asp.net, asp.net-ajax, dropdownextender

好的，所以我让我的扩展器在我网站上的 default.aspx 页面上工作，它看起来不错。我基本上将它的代码复制并粘贴到用户控件 control.ascx 页面中。当我这样做时，我完全失去了功能（只显示目标控件标签并且没有下拉菜单，即使在悬停时也是如此）。为什么它在母版页设置中的自定义用户控件中不起作用？

编辑：没有完全做到这一点。还有其他建议吗？它在母版页设置中，使用 eo web 选项卡（我在选项卡内和选项卡外尝试过，但在与选项卡相同的页面上，但无济于事），并且在自定义用户控件中。认为存在依赖性问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-12T17:27:40.067

显然 EO 与 MS Ajax Control Toolkit 存在兼容性问题。 [http://www.essentialobjects.com/Forum/Default.aspx?g=posts&t=1319](http://www.essentialobjects.com/Forum/Default.aspx?g=posts&t=1319) 我想我会留下这个问题，看看是否有人想出某种解决方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T12:43:49.193

经过几天的查看，我在后面的代码中发现了对模态弹出扩展器 .show() 的调用。评论后一切正常。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T20:42:28.047

检查文档类型。这是我发现有用的

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd" > 
```

将它放在您的用户控件（或使用它的页面）中，一切都应该很好。我在使用可折叠扩展器时遇到了类似的问题，这对我有用。

编辑：这是我的问题的[链接](https://stackoverflow.com/questions/26825/uncollapsible-collapsiblepanelextender)以获取更多详细信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-12T15:04:14.657

我不知道这是否有帮助，但我对自动完成扩展器有同样的问题，并确定服务器端功能不能在用户控件中，但需要在页面上（或者在 web 服务中，我猜）。一旦我移动了该功能，它就可以正常工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-12T15:15:27.717

嗯，所有这些功能都在松散！小心你不要丢失它（对不起！）

您是否正在使用类似[Firebug](https://addons.mozilla.org/en-US/firefox/addon/1843)（firefox 插件）的东西，以便您可以看到页面试图进行的 ajax 调用？如果它正在拨打电话但服务器行为异常，那么您也会在那里看到错误。IE 用户也许可以使用[开发工具栏](http://www.microsoft.com/downloads/details.aspx?FamilyID=e59c3964-672d-4511-bb3e-2d5e1db91038&displaylang=en)。

# c# - C# 中的邮件存储配额检查器

> ID：57557
> 
> 赞同：5
> 
> 时间：2008-09-11T20:37:03.600
> 
> 标签：c#, .net, outlook, ldap, exchange-server

我们需要在 Intranet 场景中为用户构建一个工具。该工具应检查邮箱配额（在 Active Directory 中设置）的使用百分比。目前，他们可以使用 Outlook 2003 检查他们的文件夹大小，但这不会显示为他们设置的配额限制或正在使用的百分比。

此[博客](http://gsexdev.blogspot.com/2005/03/relating-mailbox-sizes-to-mailbox.html)包含我需要的所有确切信息，包括[vbscript 示例](http://msgdev.mvps.org/exdevblog/mblimquerybyemail1.zip)。如果您有任何类似的 C# 代码，请发布。这将为我编写一个小的系统托盘应用程序提供一个很好的指导，该应用程序将轮询 Active Directory 并实时显示百分比。

PS：我不是偷懒。已经开始为此编写代码。只需检查你们中是否有人经历过类似的练习并有代码可以分享。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-12T13:20:52.377

查询 ActiveDirectory 非常简单。你可以在这里找到我之前使用过的一些很好的例子[。](http://www.codeproject.com/KB/system/activedirquery.aspx)

# c# - 如何检查是否已从 c# 安装了 Windows QFE/补丁？

> ID：57560
> 
> 赞同：2
> 
> 时间：2008-09-11T20:38:31.427
> 
> 标签：c#, windows, qfe

c# 中确定是否已安装给定 QFE/补丁的最佳方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-15T15:47:52.547

使用 WMI 并检查[Win32_QuickFixEngineering](http://msdn.microsoft.com/en-us/library/aa394391.aspx)枚举。

来自技术网：

```
strComputer = "."
Set objWMIService = GetObject("winmgmts:" _
    & "{impersonationLevel=impersonate}!\\" & strComputer & "\root\cimv2")
Set colQuickFixes = objWMIService.ExecQuery _
    ("Select * from Win32_QuickFixEngineering")
For Each objQuickFix in colQuickFixes
    Wscript.Echo "Computer: " & objQuickFix.CSName
    Wscript.Echo "Description: " & objQuickFix.Description
    Wscript.Echo "Hot Fix ID: " & objQuickFix.HotFixID
    Wscript.Echo "Installation Date: " & objQuickFix.InstallDate
    Wscript.Echo "Installed By: " & objQuickFix.InstalledBy
Next 
```

**HotFixID 是您要检查的内容。**

这是我系统上的输出：

```
    修补程序 ID：KB941569
    说明：Windows XP 安全更新 (KB941569)
    修补程序 ID：KB937143-IE7
    说明：Windows Internet Explorer 7 安全更新 (KB937143)
    修补程序 ID：KB938127-IE7
    说明：Windows Internet Explorer 7 安全更新 (KB938127)
    修补程序 ID：KB939653-IE7
    说明：Windows Internet Explorer 7 安全更新 (KB939653)
    修补程序 ID：KB942615-IE7
    说明：Windows Internet Explorer 7 安全更新 (KB942615)
    修补程序 ID：KB944533-IE7
    说明：Windows Internet Explorer 7 安全更新 (KB944533)
    修补程序 ID：KB947864-IE7
    说明：Windows Internet Explorer 7 的修补程序 (KB947864)
    修补程序 ID：KB950759-IE7
    说明：Windows Internet Explorer 7 安全更新 (KB950759)
    修补程序 ID：KB953838-IE7
    说明：Windows Internet Explorer 7 安全更新 (KB953838)
    修补程序 ID：MSCompPackV1
    说明：适用于 Windows XP 的 Microsoft Compression Client Pack 1.0
    修补程序 ID：KB873339
    说明：Windows XP 修补程序 - KB873339
    修补程序 ID：KB885835
    说明：Windows XP 修补程序 - KB885835
    修补程序 ID：KB885836
    说明：Windows XP 修补程序 - KB885836
    修补程序 ID：KB886185
    说明：Windows XP 修补程序 - KB886185
    修补程序 ID：KB887472
    说明：Windows XP 修补程序 - KB887472
    修补程序 ID：KB888302
    说明：Windows XP 修补程序 - KB888302
    修补程序 ID：KB890046
    说明：Windows XP 安全更新 (KB890046)

```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T20:58:02.583

最可靠的方法是确定哪些文件受 QFE 影响并`System.Diagnostics.FileVersionInfo.GetVersionInfo(path)`在每个文件上使用并比较版本号。

编辑：我认为还有一种方法可以检查注册表中的卸载信息，但是如果 QFE 成为可能报告误报的 Service Pack 或汇总包的一部分

# vb.net - 句柄与 AddHandler

> ID：57567
> 
> 赞同：1
> 
> 时间：2008-09-11T20:40:57.117
> 
> 标签：vb.net, .net-3.5, garbage-collection

动态附加/分离事件处理程序有优势吗？

手动分离处理程序是否有助于确保没有对已处置对象的引用？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-11T20:53:23.513

我很确定该`Handles`子句只是语法糖，并`AddHandler`在您的构造函数中插入了一条语句。我使用此代码进行了测试并禁用了应用程序框架，因此构造函数不会有额外的东西：

```
 Public Class Form1

    Public Sub New()
        ' This call is required by the Windows Form Designer. '
        InitializeComponent()

        ' Add any initialization after the InitializeComponent() call. '
        AddHandler Me.Load, AddressOf Form1_Load
    End Sub

    Private Sub Form1_Load(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles MyBase.Load
        Dim breakpoint As Integer = 4
    End Sub
End Class
```

IL最终是这样的：

```
 IL_0000:  nop
  IL_0001:  ldarg.0
  IL_0002:  call       instance void [System.Windows.Forms]System.Windows.Forms.Form::.ctor()
  IL_0007:  nop
  IL_0008:  ldarg.0
  IL_0009:  ldarg.0
  IL_000a:  dup
  IL_000b:  ldvirtftn  instance void WindowsApplication1.Form1::Form1_Load(object,
                                                                           class [mscorlib]System.EventArgs)
  IL_0011:  newobj     instance void [mscorlib]System.EventHandler::.ctor(object,
                                                                          native int)
  IL_0016:  call       instance void [System.Windows.Forms]System.Windows.Forms.Form::add_Load(class [mscorlib]System.EventHandler)

 '... lots of lines here '

  IL_0047:  ldarg.0
  IL_0048:  callvirt   instance void WindowsApplication1.Form1::InitializeComponent()
  IL_004d:  nop
  IL_004e:  ldarg.0
  IL_004f:  ldarg.0
  IL_0050:  dup
  IL_0051:  ldvirtftn  instance void WindowsApplication1.Form1::Form1_Load(object,
                                                                           class [mscorlib]System.EventArgs)
  IL_0057:  newobj     instance void [mscorlib]System.EventHandler::.ctor(object,
                                                                          native int)
  IL_005c:  callvirt   instance void [System.Windows.Forms]System.Windows.Forms.Form::add_Load(class [mscorlib]System.EventHandler)
  IL_0061:  nop
  IL_0062:  nop
  IL_0063:  ret
} // end of method Form1::.ctor
```

注意 IL_000b 和 IL_0051 周围有两个相同的代码块。我认为这只是语法糖。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-11T21:04:42.253

这不是使用 AddHandler 与 Handles 的问题。

如果您担心对事件处理程序的引用会干扰垃圾收集，那么无论处理程序是如何附加的，您都应该使用 RemoveHandler。在窗体或控件的 Dispose 方法中，删除所有处理程序。

我在 Windows 窗体应用程序（.NET 1.1 天）中遇到过这样的情况，即在没有其他对它们的引用的控件上调用事件处理程序（并且出于所有意图和目的，这些控件已死，我原以为已被 GC 处理） -- 极难调试。

我会使用 RemoveHandler 摆脱您不会重用的控件上的处理程序。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-10-10T21:15:27.323

将字段声明为`WithEvents`将导致编译器自动生成具有该名称的属性。getter 返回支持字段的值。设置器稍微复杂一些。它首先检查支持字段是否已经具有正确的值。如果是，则退出。否则，如果支持字段不为空，它会向支持字段标识的对象发出针对其所有事件的“RemoveHandler”请求。接下来，无论支持字段是否为非空，它都将其设置为等于请求的值。最后，如果新值不为空，无论旧值是否为空，该属性都会向由新值标识的对象发出“AddHandler”请求，以获取其所有事件。

只要在放弃对象前将对象的所有 WithEvents 成员设置为`Nothing`，并避免在多个线程中操作 WithEvents 成员，自动生成的事件代码就不会泄漏。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T20:50:43.770

我发现动态附加/分离事件处理程序仅在您有一个长期存在的对象公开被许多短期对象使用的事件时使用。在大多数其他情况下，这两个对象大约在同一时间被放置，并且 CLR 自己完成了足够的清理工作

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T17:06:02.583

我在手动创建控件时手动附加处理程序（例如，为每个数据库记录动态创建一个 TextBox）。我在处理我还没有准备好处理的事情时手动分离处理程序（可能是因为我使用了错误的事件？:)）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-11T20:42:23.540

大多数时候，框架会为您处理这些问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-11T20:48:26.707

手动分离事件对于防止内存泄漏非常重要：连接到另一个对象触发的事件的对象，在触发事件的对象被垃圾回收之前不会被垃圾回收。换句话说，“事件引发者”对与其相关的所有“事件监听者”有很强的引用。

# clickonce - Secure-Wave 和单击一次应用程序

> ID：57576
> 
> 赞同：-1
> 
> 时间：2008-09-11T20:43:18.110
> 
> 标签：clickonce

我有使用“安全波”安全性的用户。显然它是某种白名单应用程序监视器。

使用我的单击一次应用程序，使用的文件夹名称是运行时生成的，因此管理员无法正确地将应用程序及其文件列入白名单。

有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-11T20:50:59.290

无法覆盖 ClickOnce 安装位置。正如您所说，它是运行时生成的，并且驻留在单个用户目录中的用户 ClickOnce 应用程序缓存中。您是否考虑过让管理员将此特定文件夹列入白名单？

我想处理它的唯一其他方法是切换到 Windows Installer 并自己实现更新代码，这显然不是想法。将 Click Once 缓存列入白名单是最简单的方法，但显然要考虑到这样做的安全性考虑。

# .net - 如何合并来自不同 DomDocuments 的 XML

> ID：57577
> 
> 赞同：2
> 
> 时间：2008-09-11T20:43:26.690
> 
> 标签：.net, xml

从两个不同的 DOM 文档合并 XML 的最简单方法是什么？除了使用 Canonical [DataReader](http://support.microsoft.com/kb/311530)方法然后弄乱输出的 DOM 之外，还有其他方法吗？我基本上想要的是在没有得到的情况下将 AppendChild 附加到 XmlElements：`The node to be inserted is from a different document context.` 这是我想要工作的 C# 代码，显然不会（我正在做的是合并两个文档，这些文档有一堆我感兴趣的部分节点）：

```
XmlDocument doc1 = new XmlDocument();
doc1.LoadXml("<a><items><item1/><item2/><item3/></items></a>");
XmlDocument doc2 = new XmlDocument();
doc2.LoadXml("<b><items><item4/><item5/><item6/></items></b>");

XmlNode doc2Node = doc2.SelectSingleNode("/b/items");

XmlNodeList doc1Nodes = doc1.SelectNodes("/a/items/*");

foreach (XmlNode doc1Node in doc1Nodes)
{
    doc2Node.AppendChild(doc1Node);
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-11T20:49:08.047

您可以使用 XmlDocument.ImportNode 方法将节点从 XmlDocument 复制到另一个。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T20:52:13.470

您可能对[http://msdn.microsoft.com/en-us/library/system.xml.xmldocument.importnode.aspx](http://msdn.microsoft.com/en-us/library/system.xml.xmldocument.importnode.aspx)感兴趣。但请仔细查看“下表描述了每个 XmlNodeType 的特定行为。”-该文档的一部分。

# .net - 如何以编程方式使 ListView 的列自动调整大小？

> ID：57584
> 
> 赞同：5
> 
> 时间：2008-09-11T20:46:12.627
> 
> 标签：.net, windows, user-interface, controls

我发现了一些使用 Win32 api 或使用 SendKeys 模拟 ^+ 按钮组合（ - ）的示例[，](http://www.codeproject.com/KB/list/AutoResize.aspx)`ctrl`但`+`至少使用 SendKeys 方法，listview 会抓住光标并将其设置为沙漏，直到我按下键盘上的开始按钮. 最干净的方法是什么？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-12T01:25:25.590

看起来像一个电话`myListView.AutoResizeColumns(ColumnHeaderAutoResizeStyle.ColumnContent)`会做你想做的事。我想，只需在添加项目后调用它。

更多信息[在这里](https://msdn.microsoft.com/en-us/library/system.windows.forms.listview.autoresizecolumns(v=vs.110).aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T21:14:37.753

根据[MSDN](http://msdn.microsoft.com/en-us/library/system.windows.forms.columnheader.width(VS.71).aspx)，如果您将列宽设置为 -1 那么它将自动调整为最宽的项目

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-06-17T16:40:09.400

添加内容后循环遍历所有列并将宽度设置为-1。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-01-15T04:11:58.200

将以下例程添加到您的代码后，然后从任何过程/函数中调用它。但是不要在“Form_Load”过程中使用它。仅在将项目添加到 ListView 后才调用它（或者，如果要进行多次添加，请在所有添加结束时调用一次）：

```
 Private Sub AutoSizeListViewColumns(oListView As ListView)
        Dim nCol As Integer = 0
        SuspendLayout()
        For nCol = 0 To (oListView.Columns.Count - 1)
            oListView.Columns(nCol).Width = -1  'forces autosizing on column
        Next
        oListView.Refresh()
        ResumeLayout()
    End Sub 
```

# asp.net - ASP.Net UpdatePanel ImageButton 导致“this._postbackSettings.async 为空或不是对象”

> ID：57586
> 
> 赞同：3
> 
> 时间：2008-09-11T20:46:31.423
> 
> 标签：asp.net, asp.net-ajax, updatepanel

我在 dragPanelExtender 内的 popupControlExtender 内的更新面板上收到此错误。

我看到很多其他人都有这个问题，并且有各种修复，但没有一个对我有用。

我很想听听为什么会发生这种情况的合乎逻辑的解释，以及将来避免此类问题的万无一失的方法。

我发现像其他人一样，当触发器是 LinkBut​​ton 而不是 ImageButton 时不会发生此错误，仍然想知道是否有人有解释。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-02-24T13:15:05.263

我遇到了同样的问题，直到我最终找到了完全符合我要求的[https://siderite.dev/blog/thispostbacksettingsasync-is-null-or.html之前，我还没有真正找到任何令人满意的解决方案。](https://siderite.dev/blog/thispostbacksettingsasync-is-null-or.html)

只是为了避免将来可能出现死链接的问题，这里是代码：

```
var script = @"
if (Sys &&
    Sys.WebForms && Sys.WebForms.PageRequestManager &&
    Sys.WebForms.PageRequestManager.getInstance) 
{
    var prm = Sys.WebForms.PageRequestManager.getInstance();
    if (prm &&
       !prm._postBackSettings)
    {
        prm._postBackSettings = prm._createPostBackSettings(false, null, null);
    }";

ScriptManager.RegisterOnSubmitStatement(
    Page, 
    Page.GetType(), 
    "FixPopupFormSubmit", 
    script); 
```

如果在没有设置 _postBackSettings 的情况下提交，它会创建它们，导致空引用异常消失，因为 _postBackSettings.async 然后可用。

希望这可以帮助，

G。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-12T16:44:49.017

我最好的猜测是 UpdatePanel 无法将自定义“异步”属性正确写入回发请求。这可能是由于阻止了包装它的控件之一（我的直觉是它是 popupControlExtender - 它往往与更新面板有奇怪的行为，因为它旨在管理其中的事件以用于显示/隐藏目的）。

我建议要么删除更新面板并根据您的特定业务需求推出您自己的解决方案，或者实现您自己的弹出脚本（可能更容易编写）。

顺便说一句，对于某些背景，“this._postbackSettings.async”是您的 AJAX.NET 框架，试图确定这是否是异步调用。您可以通过在发送回发之前以编程方式设置它来克服它（捕获回发事件并将该字段添加到回发请求中，如果它尚不存在）。

只是一些想法......我不相信这个有一个“即插即用”的答案！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-02T19:38:48.770

在 ScriptManager 控件上将“EnablePartialRendering”设置为 false 可防止该错误，但这不是最佳解决方案。取决于您的应用程序，失去部分渲染的好处可能是一件大事。

只是为了记录，我做的和其他看到错误的人不一样。我有一个 PopupControlExtender，其中是一个复选框列表。我添加了一个带有 javascript 方法的“全选”链接，以编程方式全选/取消全选。我没有使用图像按钮。在添加 javascript 之前我没有看到错误，现在即使在删除它之后错误仍然存​​在。必须有另一个我错过的变化。

我希望这可以帮助别人...

——马特

# testing - 如何找到（并保留）作为开发人员的测试人员

> ID：57587
> 
> 赞同：11
> 
> 时间：2008-09-11T20:46:54.793
> 
> 标签：testing

我在一家软件供应商工作，其市场是开发人员工具，我们一直在为我们的产品寻找 QA 人员。

由于我们是一家小商店，因此职位将是支持和 QA 的组合，但是由于我们制作开发人员工具，因此我们的支持主要包括实际开发（因为该人员必须阅读并理解我们的客户代码并发现并指出错误）在里面）。
QA 部分还将包括编写应用程序（使用各种平台和语言）并测试它们如何与我们的工具一起工作。

我遇到的主要问题是，当您告诉具有开发经验的人该职位包含“QA”及其标题（甚至在职位描述中）时，他们会回避考虑这份工作。
我对如何找到一个好人来填补这份工作并确保他们乐于做这份工作的反馈和建议非常感兴趣。有任何想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-11T20:48:42.073

金钱和责任。

我回避这些类型的工作的原因是它们往往无法让我保持足够长的兴趣。拥有真正的开发任务应该使您远离该类别。另一个问题是薪水通常明显低于标题中的薪水。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-11T21:04:54.187

我是一名开发人员，但花时间担任 QA 人员（测试编写、自动化、工具编写/编码）。我认为这是我在一边做的事情，最终会搬出去。

我想要离开的主要原因是这根本不是我想要的职业。再多的钱/责任也不会改变这一点。但是，我认为尊重也与此有关。很多 QA 工作根本没有受到重视，因此需要将其明确解释为“不是您公司的工作方式”。

我会找到一个**想要**QA 职位，但具有很强的开发/编码/解决问题能力的人。他们可以完成工具创建或其他小型编码任务，但它会在旁边。有点跟我上面的感觉相反。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-11T21:30:28.777

我认为理想的工作组合是产品经理 + QA。我所说的产品经理是指编写需求文档并负责确保产品满足需求的人。此人将是首席开发人员的同行，而不是上级。一个开发人员但喜欢管理并希望走这条职业道路的人可能会对这种角色组合非常感兴趣。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-11T21:43:36.327

首先，您可以将“QA”**从**标题和描述中去掉，如果这似乎是让候选人无法认真看待该职位的“热门按钮”。

根据您的描述，您的职位与传统的“测试员”角色没有太多共同之处——工作主要是编写和思考代码，而不是敲打别人的代码并试图破坏它。将其视为一个相当不拘一格、以工具为导向的开发职位，并尝试相应地对其进行宣传和配备人员。（并且期望相应地支付 - 你得到你所支付的。）有相当多的开发人员拥有良好的技能，但可能比其他人更短的注意力，并且他们更愿意连续工作迷你项目，而不是更大项目中更持久的部分。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-11T21:43:53.610

您可能只想在标题中保留“QA”，并称该职位为“开发人员支持”或类似的名称。不要在角色职责上误导任何候选人，但您可以将其更多地表述为“您将负责构建版本并确保它们准备好交付给客户。”

还要确保有一条职业道路可以带来更多的发展，而不是更多的 QA，如果这是候选人想要的。

最后，确保其他开发人员将此人视为开发人员，而不是团队之外的人。

遗憾的是，“QA”在开发人员中受到了一些污名，但确实如此。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-11T22:38:19.127

我是一名程序员，做过一段时间的测试员。如果可以的话，答案很简单：**让他们为所欲为**。

如果您让他们自由支配，我可以保证您的软件将以您从未想象过的方式进行测试。

另一方面，如果你试图控制这样的人，那么他们就会变得鄙视你。这是不可避免的。

收益大于成本。如果你是一家大公司，那么这个决定很容易。只需聘请软件开发人员并告诉他们“去城里”开发您的产品。你会喜欢结果的。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-16T04:08:52.920

正如亚当和乔普斯所指出的，金钱和责任是关键。质量工程师应该与开发人员处于相同的薪酬水平。有趣的工作也是一个重要因素。这个角色听起来像是各种各样的任务。

在我的公司，开发人员经常在项目之间或测试团队人满为患时被借给测试团队。有些人有诀窍，有些人没有。尽管如此，大多数开发人员宁愿测试自己的代码，也不愿在其他人的工作中发现错误。测试经理积极吸引具有强大测试技能的开发人员。七年来，我一直拒绝切换到测试团队。一次晋升、20% 的加薪以及我的职责主要是解决故障、管理和计划的承诺最终说服了我转换。我做的测试比我想象的要多，但我也得到了具有挑战性的工作。

薪酬与发展相媲美。说实话；披露对角色的实际期望。将标题更改为软件质量工程师。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-11T20:55:52.040

我同意亚当的观点，金钱和责任是关键。我建议，如果您在一家小公司内，那么您的 QA 团队很小/不存在。这可能意味着有人进入并做出真正的努力来贡献和塑造贵公司的质量保证政策、程序和工作流程的好机会。

我们公司在 QA 方面也遇到了类似的问题，但我们仍然没有 100% 解决这个问题。但是，让 QA 人员有权决定政策和程序，并参与产品开发的各个方面，以使他们保持在循环中，这对我们来说效果很好。这意味着，当涉及到 QA 和测试时，我们有一个了解产品的人，从里到外了解它，从一开始就积极参与，并在很大程度上塑造了他们自己和开发团队将要执行的程序跟随。责任是关键。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-09-22T15:31:21.300

大多数开发人员既不是优秀的测试人员，也不喜欢测试，而您想要两者兼得的人。在你的招聘广告中诚实地说，这个职位不是开发人员职位的垫脚石，你的申请者会更少，但留住你所雇用的人的机会更大。QA 通常的薪水很差，所以如果你愿意支付更高的薪水，你应该能够找到人。如果你雇佣一个整天想写代码的人，不管你付给他们多少钱，你都不会留住他们。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-11T20:55:08.627

我认为你在这里有一个坚强的人：

*   全职开发人员完成您需要的工作的成本太高了。
*   大多数开发人员（包括我自己）很快就会非常厌倦。大多数开发人员的热情是编码，他们希望尽可能多地这样做。从你所说的TBH那里，它可能在你的工作角色中很少。
*   我会说也许找一个初级，一个没有经验的新鲜人。他们可能会更好地适应您的测试/质量保证流程，这让他们有机会开始查看生产代码，也许还有机会使用它。
*   除非你很幸运，否则我不会指望“开发人员”能待太久，所以要么期望有一点营业额，要么可能会在需要时扩展为完整的开发人员角色，并获得更便宜的唯一测试人员。
*   我知道你是一家小商店，所以财务可能是一个很大的因素，但我想说你需要权衡让开发人员进入并解决经常发生的问题的可能性。相比之下，测试仪很便宜。最好找一个测试人员，找出所有问题，然后找一个承包商/兼职开发人员来解决问题。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-11T21:48:19.700

伙计，我工作的某家公司已经找到了解决您问题的方法。聘请 QE 而不是 QA。QA（质量保证）确实有一个耻辱。职称本身对大多数开发人员来说意味着无聊的死记硬背的任务。QE（质量工程）听起来一样糟糕，但并没有吓跑那么多人。

如果一切都失败了，只需聘请开发人员。我的意思是说真的，你想要一个会写代码的人，所以雇佣一个受过这方面培训的人。问题是，您需要查看您的申请人并与他们交谈。您正在寻找一个了解 QE 工作原理的人，并且您想聘请一位以您的程序使用的语言而不是编写的语言工作的开发人员。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-16T13:12:53.360

这个职位最常见的标题是“测试中的软件开发人员”。

但我认为另一个问题更重要 - 很难阻止具有良好测试和开发知识的人迁移到开发团队

# tsql - 如何在 T-SQL 中用年、月和日计算年龄

> ID：57599
> 
> 赞同：55
> 
> 时间：2008-09-11T20:50:49.883
> 
> 标签：tsql, datediff

在 T-SQL (SQL Server 2000) 中以年、月和日为单位计算某人年龄的最佳方法是什么？

该`datediff`函数不能很好地处理年份边界，而且将月份和日期分开将是一个负担。我知道我可以在客户端相对容易地做到这一点，但我想在我的[存储过程](http://en.wikipedia.org/wiki/Stored_procedure)中完成它。

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-09-11T21:34:02.573

下面是一些 T-SQL，它为您提供自 @date 中指定的日期以来的年数、月数和天数。它考虑到 DATEDIFF() 在不考虑月份或日期的情况下计算差异这一事实（因此 8/31 和 9/1 之间的月份差异为 1 个月）并使用递减结果的 case 语句来处理它合适的。

```
DECLARE @date datetime, @tmpdate datetime, @years int, @months int, @days int
SELECT @date = '2/29/04'

SELECT @tmpdate = @date

SELECT @years = DATEDIFF(yy, @tmpdate, GETDATE()) - CASE WHEN (MONTH(@date) > MONTH(GETDATE())) OR (MONTH(@date) = MONTH(GETDATE()) AND DAY(@date) > DAY(GETDATE())) THEN 1 ELSE 0 END
SELECT @tmpdate = DATEADD(yy, @years, @tmpdate)
SELECT @months = DATEDIFF(m, @tmpdate, GETDATE()) - CASE WHEN DAY(@date) > DAY(GETDATE()) THEN 1 ELSE 0 END
SELECT @tmpdate = DATEADD(m, @months, @tmpdate)
SELECT @days = DATEDIFF(d, @tmpdate, GETDATE())

SELECT @years, @months, @days 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2011-07-08T00:16:37.283

试试这个...

```
SELECT CASE WHEN
 (DATEADD(year,DATEDIFF(year, @datestart  ,@dateend) , @datestart) > @dateend)
THEN DATEDIFF(year, @datestart  ,@dateend) -1
ELSE DATEDIFF(year, @datestart  ,@dateend)
END 
```

基本上“DateDiff（年份......”，给你这个人今年的年龄，所以我只是添加一个案例陈述说，如果他们今年还没有生日，那么减去 1 年，否则返回值。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2013-10-06T02:23:20.497

以文本形式获取年龄的简单方法如下：

```
Select cast((DATEDIFF(m, date_of_birth, GETDATE())/12) as varchar) + ' Y & ' + 
       cast((DATEDIFF(m, date_of_birth, GETDATE())%12) as varchar) + ' M' as Age 
```

结果格式为：

```
**63 Y & 2 M** 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-09-18T12:39:53.773

## 用 ISO 格式日期的算术实现。

```
declare @now date,@dob date, @now_i int,@dob_i int, @days_in_birth_month int
declare @years int, @months int, @days int
set @now = '2013-02-28' 
set @dob = '2012-02-29' -- Date of Birth

set @now_i = convert(varchar(8),@now,112) -- iso formatted: 20130228
set @dob_i = convert(varchar(8),@dob,112) -- iso formatted: 20120229
set @years = ( @now_i - @dob_i)/10000
-- (20130228 - 20120229)/10000 = 0 years

set @months =(1200 + (month(@now)- month(@dob))*100 + day(@now) - day(@dob))/100 %12
-- (1200 + 0228 - 0229)/100 % 12 = 11 months

set @days_in_birth_month = day(dateadd(d,-1,left(convert(varchar(8),dateadd(m,1,@dob),112),6)+'01'))
set @days = (sign(day(@now) - day(@dob))+1)/2 * (day(@now) - day(@dob))
          + (sign(day(@dob) - day(@now))+1)/2 * (@days_in_birth_month - day(@dob) + day(@now))
-- ( (-1+1)/2*(28 - 29) + (1+1)/2*(29 - 29 + 28))
-- Explain: if the days of now is bigger than the days of birth, then diff the two days
--          else add the days of now and the distance from the date of birth to the end of the birth month 
select @years,@months,@days -- 0, 11, 28 
```

## 测试用例

*天的方法与接受的答案不同，以下评论中显示了差异：*

```
 dob        now  years  months  days 
2012-02-29 2013-02-28      0      11    28  --Days will be 30 if calculated by the approach in accepted answer. 
2012-02-29 2016-02-28      3      11    28  --Days will be 31 if calculated by the approach in accepted answer, since the day of birth will be changed to 28 from 29 after dateadd by years. 
2012-02-29 2016-03-31      4       1     2
2012-01-30 2016-02-29      4       0    30
2012-01-30 2016-03-01      4       1     2  --Days will be 1 if calculated by the approach in accepted answer, since the day of birth will be changed to 30 from 29 after dateadd by years.
2011-12-30 2016-02-29      4       1    30 
```

## Days by case 语句的简短版本：

```
set @days = CASE WHEN day(@now) >= day(@dob) THEN day(@now) - day(@dob)
                 ELSE @days_in_birth_month - day(@dob) + day(@now) END 
```

**如果您只想要年和月的年龄，它可能会更简单**

```
set @years = ( @now_i/100 - @dob_i/100)/100
set @months =(12 + month(@now) - month(@dob))%12 
select @years,@months -- 1, 0 
```

**注意：**一个非常有用的[SQL Server 日期格式链接](http://www.sql-server-helper.com/tips/date-formats.aspx)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-11T21:54:12.417

这是一个（稍微）简单的版本：

```
CREATE PROCEDURE dbo.CalculateAge 
    @dayOfBirth datetime
AS

DECLARE @today datetime, @thisYearBirthDay datetime
DECLARE @years int, @months int, @days int

SELECT @today = GETDATE()

SELECT @thisYearBirthDay = DATEADD(year, DATEDIFF(year, @dayOfBirth, @today), @dayOfBirth)

SELECT @years = DATEDIFF(year, @dayOfBirth, @today) - (CASE WHEN @thisYearBirthDay > @today THEN 1 ELSE 0 END)

SELECT @months = MONTH(@today - @thisYearBirthDay) - 1

SELECT @days = DAY(@today - @thisYearBirthDay) - 1

SELECT @years, @months, @days
GO 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-05-11T09:15:57.993

与函数相同的东西。

```
create function [dbo].[Age](@dayOfBirth datetime, @today datetime)
   RETURNS varchar(100)
AS

Begin
DECLARE @thisYearBirthDay datetime
DECLARE @years int, @months int, @days int

set @thisYearBirthDay = DATEADD(year, DATEDIFF(year, @dayOfBirth, @today), @dayOfBirth)
set @years = DATEDIFF(year, @dayOfBirth, @today) - (CASE WHEN @thisYearBirthDay > @today THEN 1 ELSE 0 END)
set @months = MONTH(@today - @thisYearBirthDay) - 1
set @days = DAY(@today - @thisYearBirthDay) - 1

return cast(@years as varchar(2)) + ' years,' + cast(@months as varchar(2)) + ' months,' + cast(@days as varchar(3)) + ' days'
end 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-07-24T09:00:13.890

```
create  procedure getDatedifference

(
    @startdate datetime,
    @enddate datetime
)
as
begin
    declare @monthToShow int
    declare @dayToShow int

    --set @startdate='01/21/1934'
    --set @enddate=getdate()

    if (DAY(@startdate) > DAY(@enddate))
        begin
            set @dayToShow=0

            if (month(@startdate) > month(@enddate))
                begin
                    set @monthToShow=  (12-month(@startdate)+ month(@enddate)-1)
                end
            else if (month(@startdate) < month(@enddate))
                begin
                    set @monthToShow=  ((month(@enddate)-month(@startdate))-1)
                end
            else
               begin
                   set @monthToShow=  11
               end
            -- set @monthToShow= convert(int, DATEDIFF(mm,0,DATEADD(dd,DATEDIFF(dd,0,@enddate)- DATEDIFF(dd,0,@startdate),0)))-((convert(int,FLOOR(DATEDIFF(day, @startdate, @enddate) / 365.25))*12))-1
                         if(@monthToShow<0)
                         begin
                            set @monthToShow=0
                         end

                      declare @amonthbefore integer
                      set @amonthbefore=Month(@enddate)-1
                          if(@amonthbefore=0)
                             begin
                                set @amonthbefore=12
                              end

                      if (@amonthbefore  in(1,3,5,7,8,10,12))
                          begin
                            set @dayToShow=31-DAY(@startdate)+DAY(@enddate)
                          end
                      if (@amonthbefore=2)
                         begin
                           IF (YEAR( @enddate ) % 4 = 0 AND YEAR( @enddate ) % 100 != 0) OR  YEAR( @enddate ) % 400 = 0
                                 begin
                                    set @dayToShow=29-DAY(@startdate)+DAY(@enddate)
                                  end
                           else
                               begin
                                   set @dayToShow=28-DAY(@startdate)+DAY(@enddate)
                           end
                      end
                      if (@amonthbefore in (4,6,9,11))
                        begin
                           set @dayToShow=30-DAY(@startdate)+DAY(@enddate)
                        end
                 end
    else
        begin
          --set @monthToShow=convert(int, DATEDIFF(mm,0,DATEADD(dd,DATEDIFF(dd,0,@enddate)- DATEDIFF(dd,0,@startdate),0)))-((convert(int,FLOOR(DATEDIFF(day, @startdate, @enddate) / 365.25))*12))
          if (month(@enddate)< month(@startdate))
              begin
                 set @monthToShow=12+(month(@enddate)-month(@startdate))
              end
          else
              begin
                set @monthToShow= (month(@enddate)-month(@startdate))
              end
          set @dayToShow=DAY(@enddate)-DAY(@startdate)
        end

    SELECT
        FLOOR(DATEDIFF(day, @startdate, @enddate) / 365.25) as [yearToShow],
          @monthToShow as  monthToShow ,@dayToShow as dayToShow ,
        convert(varchar,FLOOR(DATEDIFF(day, @startdate, @enddate) / 365.25)) +' Year ' + convert(varchar,@monthToShow) +' months '+convert(varchar,@dayToShow)+' days ' as age

    return
end 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2018-08-12T21:46:21.870

我使用我修改的这个函数（天部分）来自@Dane 答案：[https ://stackoverflow.com/a/57720/2097023](https://stackoverflow.com/a/57720/2097023)

```
CREATE FUNCTION dbo.EdadAMD
    (
        @FECHA DATETIME
    )
    RETURNS NVARCHAR(10)
    AS
    BEGIN
        DECLARE
            @tmpdate DATETIME
          , @years   INT
          , @months  INT
          , @days    INT
          , @EdadAMD NVARCHAR(10);

        SELECT @tmpdate = @FECHA;

        SELECT @years = DATEDIFF(yy, @tmpdate, GETDATE()) - CASE
                                          WHEN (MONTH(@FECHA) >    MONTH(GETDATE()))
                                             OR (
                                                MONTH(@FECHA) = MONTH(GETDATE())
                                          AND DAY(@FECHA) > DAY(GETDATE())
                                          ) THEN
                                                1
                                            ELSE
                                                0
                                    END;
    SELECT @tmpdate = DATEADD(yy, @years, @tmpdate);
    SELECT @months = DATEDIFF(m, @tmpdate, GETDATE()) - CASE
                              WHEN DAY(@FECHA) > DAY(GETDATE()) THEN
                                                            1
                                                        ELSE
                                                            0
                                                    END;
    SELECT @tmpdate = DATEADD(m, @months, @tmpdate);

    IF MONTH(@FECHA) = MONTH(GETDATE())
       AND DAY(@FECHA) > DAY(GETDATE())
          SELECT @days = 
            DAY(EOMONTH(GETDATE(), -1)) - (DAY(@FECHA) - DAY(GETDATE()));
    ELSE
        SELECT @days = DATEDIFF(d, @tmpdate, GETDATE());

    SELECT @EdadAMD = CONCAT(@years, 'a', @months, 'm', @days, 'd');

    RETURN @EdadAMD;

END; 
GO 
```

它工作得很好。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-11-29T14:53:53.217

我已经多次看到这个问题，结果输出年、月、日，但从未输出数字/十进制结果。（至少不是一个不正确舍入的）。我欢迎对此功能的反馈。可能还不需要一点调整。

-- 函数的输入是两个日期。-- 输出是 Decimal(7,4) 格式的两个日期之间的数字年数。-- 输出总是一个正数。

## -- 注意：如果差值大于 999.9999，则不处理输出

-- 逻辑基于三个步骤。-- 1) 差值是否小于 1 年（0.5000、0.3333、0.6667 等） -- 2) 差值正好是整数年（1、2、3 等）

## -- 3) (Else)...区别是年和一些天数。（1.5000、2.3333、7.6667 等）

* * *

* * *

```
CREATE Function [dbo].[F_Get_Actual_Age](@pi_date1 datetime,@pi_date2 datetime)
RETURNS Numeric(7,4)
AS
BEGIN

Declare 
 @l_tmp_date    DATETIME
,@l_days1       DECIMAL(9,6)
,@l_days2       DECIMAL(9,6)
,@l_result      DECIMAL(10,6)
,@l_years       DECIMAL(7,4)

  --Check to make sure there is a date for both inputs
  IF @pi_date1 IS NOT NULL and @pi_date2 IS NOT NULL  
  BEGIN

    IF @pi_date1 > @pi_date2 --Make sure the "older" date is in @pi_date1
      BEGIN
        SET @l_tmp_date = @pi_date2
        SET @pi_date2 = @Pi_date1
        SET @pi_date1 = @l_tmp_date
      END

    --Check #1 If date1 + 1 year is greater than date2, difference must be less than 1 year
    IF DATEADD(YYYY,1,@pi_date1) > @pi_date2  
      BEGIN
          --How many days between the two dates (numerator)
        SET @l_days1 = DATEDIFF(dd,@pi_date1, @pi_date2) 
          --subtract 1 year from date2 and calculate days bewteen it and date2
          --This is to get the denominator and accounts for leap year (365 or 366 days)
        SET @l_days2 = DATEDIFF(dd,dateadd(yyyy,-1,@pi_date2),@pi_date2) 
        SET @l_years = @l_days1 / @l_days2 -- Do the math
      END
    ELSE
      --Check #2  Are the dates an exact number of years apart.
      --Calculate years bewteen date1 and date2, then add the years to date1, compare dates to see if exactly the same.
      IF DATEADD(YYYY,DATEDIFF(YYYY,@pi_date1,@pi_date2),@pi_date1) = @pi_date2  
        SET @l_years = DATEDIFF(YYYY,@pi_date1, @pi_date2) --AS Years, 'Exactly even Years' AS Msg
      ELSE
      BEGIN
        --Check #3 The rest of the cases.
        --Check if datediff, returning years, over or under states the years difference
        SET @l_years = DATEDIFF(YYYY,@pi_date1, @pi_date2)
        IF DATEADD(YYYY,@l_years,@pi_date1) > @pi_date2
          SET @l_years = @l_years -1
          --use basicly same logic as in check #1  
        SET @l_days1 = DATEDIFF(dd,DATEADD(YYYY,@l_years,@pi_date1), @pi_date2) 
        SET @l_days2 = DATEDIFF(dd,dateadd(yyyy,-1,@pi_date2),@pi_date2) 
        SET @l_years = @l_years + @l_days1 / @l_days2
        --SELECT @l_years AS Years, 'Years Plus' AS Msg
      END
  END
  ELSE
    SET @l_years = 0  --If either date was null

RETURN @l_Years  --Return the result as decimal(7,4)
END 
```

`

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-06-12T11:36:47.343

相当老的问题，但我想分享我为计算年龄所做的工作

```
 Declare @BirthDate As DateTime
Set @BirthDate = '1994-11-02'

SELECT DATEDIFF(YEAR,@BirthDate,GETDATE()) - (CASE 
WHEN MONTH(@BirthDate)> MONTH(GETDATE()) THEN 1 
WHEN MONTH(@BirthDate)= MONTH(GETDATE()) AND DAY(@BirthDate) > DAY(GETDATE()) THEN 1 
Else 0 END) 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-11T21:03:13.257

您是否要计算一个年龄的总天数/月数/年数？你有开始日期吗？或者你想剖析它（例如：24 年、1 个月、29 天）？

如果您有一个正在使用的开始日期，datediff 将使用以下命令输出总天数/月数/年数：

```
Select DateDiff(d,'1984-07-12','2008-09-11')

Select DateDiff(m,'1984-07-12','2008-09-11')

Select DateDiff(yyyy,'1984-07-12','2008-09-11') 
```

各自的输出为（8827/290/24）。

现在，如果你想做解剖方法，你必须减去以天为单位的年数（天 - 365 * 年），然后对其进行进一步的数学运算以获得月份等。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-04-03T02:57:34.503

`DateTime`T-SQL 中的值存储为浮点数。您可以将日期彼此相减，您现在有了一个新日期，即它们之间的时间跨度。

```
declare @birthdate datetime
set @birthdate = '6/15/1974'

--age in years - short version
print year(getdate() - @birthdate) - year(0)

--age in years - visualization
declare @mindate datetime
declare @span datetime

set @mindate = 0
set @span = getdate() - @birthdate

print @mindate
print @birthdate
print getdate()
print @span
--substract minyear from spanyear to get age in years
print year(@span) - year(@mindate)
print month(@span)
print day(@span) 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-06-23T11:52:37.110

这是 SQL 代码，它为您提供自 sysdate 以来的年数、月数和天数。输入此格式的 input_birth_date 的值 (dd_mon_yy)。注意：输入相同的值（出生日期）为年、月和日，例如 01-mar-85

```
select trunc((sysdate -to_date('&input_birth_date_dd_mon_yy'))/365) years,
trunc(mod(( sysdate -to_date('&input_birth_date_dd_mon_yy'))/365,1)*12) months,
trunc((mod((mod((sysdate -to_date('&input_birth_date_dd_mon_yy'))/365,1)*12),1)*30)+1) days 
 from dual 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-02-25T06:16:43.710

```
CREATE FUNCTION DBO.GET_AGE
(
@DATE AS DATETIME
)
RETURNS VARCHAR(MAX)
AS
BEGIN

DECLARE @YEAR  AS VARCHAR(50) = ''
DECLARE @MONTH AS VARCHAR(50) = ''
DECLARE @DAYS  AS VARCHAR(50) = ''
DECLARE @RESULT AS VARCHAR(MAX) = ''

SET @YEAR  = CONVERT(VARCHAR,(SELECT DATEDIFF(MONTH,CASE WHEN DAY(@DATE) > DAY(GETDATE()) THEN DATEADD(MONTH,1,@DATE) ELSE @DATE END,GETDATE()) / 12 ))
SET @MONTH = CONVERT(VARCHAR,(SELECT DATEDIFF(MONTH,CASE WHEN DAY(@DATE) > DAY(GETDATE()) THEN DATEADD(MONTH,1,@DATE) ELSE @DATE END,GETDATE()) % 12 ))
SET @DAYS = DATEDIFF(DD,DATEADD(MM,CONVERT(INT,CONVERT(INT,@YEAR)*12 + CONVERT(INT,@MONTH)),@DATE),GETDATE())

SET @RESULT = (RIGHT('00' + @YEAR, 2) + ' YEARS ' + RIGHT('00' + @MONTH, 2) + ' MONTHS ' + RIGHT('00' + @DAYS, 2) + ' DAYS')

RETURN @RESULT
END

SELECT DBO.GET_AGE('04/12/1986') 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-08-29T17:21:42.030

```
DECLARE @BirthDate datetime, @AgeInMonths int
SET @BirthDate = '10/5/1971'
SET @AgeInMonths                              -- Determine the age in "months old":
    = DATEDIFF(MONTH, @BirthDate, GETDATE())  -- .Get the difference in months
    - CASE WHEN DATEPART(DAY,GETDATE())       -- .If today was the 1st to 4th,
              < DATEPART(DAY,@BirthDate)      --   (or before the birth day of month)
           THEN 1 ELSE 0 END                  --   ... don't count the month.
SELECT @AgeInMonths / 12 as AgeYrs            -- Divide by 12 months to get the age in years
      ,@AgeInMonths % 12 as AgeXtraMonths     -- Get the remainder of dividing by 12 months = extra months
      ,DATEDIFF(DAY                           -- For the extra days, find the difference between, 
               ,DATEADD(MONTH, @AgeInMonths   -- 1\. Last Monthly Birthday 
                             , @BirthDate)    --     (if birthdays were celebrated monthly)
               ,GETDATE()) as AgeXtraDays     -- 2\. Today's date. 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2014-11-21T15:29:14.363

对于那些想要在表中创建计算列来存储年龄的人：

```
CASE WHEN DateOfBirth< DATEADD(YEAR, (DATEPART(YEAR, GETDATE()) - DATEPART(YEAR, DateOfBirth))*-1, GETDATE()) 
     THEN DATEPART(YEAR, GETDATE()) - DATEPART(YEAR, DateOfBirth)
     ELSE DATEPART(YEAR, GETDATE()) - DATEPART(YEAR, DateOfBirth) -1 END 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2016-02-03T15:43:11.310

这是我计算给定出生日期和当前日期的年龄的方法。

```
select case 
            when cast(getdate() as date) = cast(dateadd(year, (datediff(year, '1996-09-09', getdate())), '1996-09-09') as date)
                then dateDiff(yyyy,'1996-09-09',dateadd(year, 0, getdate()))
            else dateDiff(yyyy,'1996-09-09',dateadd(year, -1, getdate()))
        end as MemberAge
go 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-03-09T21:13:35.640

有一种简单的方法，基于两天之间的时间，但结束日期被截断。

```
SELECT CAST(DATEDIFF(hour,Birthdate,CAST(GETDATE() as Date))/8766.0 as INT) AS Age FROM <YourTable> 
```

这已被证明是非常准确和可靠的。如果不是 GETDATE() 上的内部 CAST，它可能会在午夜前几个小时翻转生日，但是使用 CAST，它会随着年龄的变化而在**午夜**结束。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-01-14T08:34:29.053

还有另一种计算年龄的方法是

见下表

```
 FirstName       LastName    DOB
    sai             krishnan    1991-11-04
    Harish          S A         1998-10-11 
```

对于查找年龄，您可以按月计算

```
 Select datediff(MONTH,DOB,getdate())/12 as dates from [Organization].[Employee] 
```

结果将是

```
firstname   dates
sai         27
Harish      20 
```

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2016-04-05T13:38:57.213

```
DECLARE @DoB AS DATE = '1968-10-24'
DECLARE @cDate AS DATE = CAST('2000-10-23' AS DATE)

SELECT 
--Get Year difference
DATEDIFF(YEAR,@DoB,@cDate) -
--Cases where year difference will be augmented
CASE 
    --If Date of Birth greater than date passed return 0
    WHEN YEAR(@DoB) - YEAR(@cDate) >= 0 THEN DATEDIFF(YEAR,@DoB,@cDate)

    --If date of birth month less than date passed subtract one year
    WHEN MONTH(@DoB) - MONTH(@cDate) > 0 THEN 1 

    --If date of birth day less than date passed subtract one year
    WHEN MONTH(@DoB) - MONTH(@cDate) = 0 AND DAY(@DoB) - DAY(@cDate) > 0 THEN 1 

    --All cases passed subtract zero
    ELSE 0
END 
```

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2016-05-20T11:30:24.703

```
declare @StartDate datetime = '2016-01-31'
declare @EndDate datetime = '2016-02-01'
SELECT @StartDate AS [StartDate]
      ,@EndDate AS [EndDate]
      ,DATEDIFF(Year,@StartDate,@EndDate) - CASE WHEN DATEADD(Year,DATEDIFF(Year,@StartDate,@EndDate), @StartDate) > @EndDate THEN 1 ELSE 0 END AS [Years]
      ,DATEDIFF(Month,(DATEADD(Year,DATEDIFF(Year,@StartDate,@EndDate) - CASE WHEN DATEADD(Year,DATEDIFF(Year,@StartDate,@EndDate), @StartDate) > @EndDate THEN 1 ELSE 0 END,@StartDate)),@EndDate) - CASE WHEN DATEADD(Month, DATEDIFF(Month,DATEADD(Year,DATEDIFF(Year,@StartDate,@EndDate) - CASE WHEN DATEADD(Year,DATEDIFF(Year,@StartDate,@EndDate), @StartDate) > @EndDate THEN 1 ELSE 0 END,@StartDate),@EndDate) , @StartDate) > @EndDate THEN 1 ELSE 0 END AS [Months]
      ,DATEDIFF(Day, DATEADD(Month,DATEDIFF(Month, (DATEADD(Year,DATEDIFF(Year,@StartDate,@EndDate) - CASE WHEN DATEADD(Year,DATEDIFF(Year,@StartDate,@EndDate), @StartDate) > @EndDate THEN 1 ELSE 0 END,@StartDate)),@EndDate) - CASE WHEN DATEADD(Month, DATEDIFF(Month,DATEADD(Year,DATEDIFF(Year,@StartDate,@EndDate) - CASE WHEN DATEADD(Year,DATEDIFF(Year,@StartDate,@EndDate), @StartDate) > @EndDate THEN 1 ELSE 0 END,@StartDate),@EndDate) , @StartDate) > @EndDate THEN 1 ELSE 0 END  ,DATEADD(Year,DATEDIFF(Year,@StartDate,@EndDate) - CASE WHEN DATEADD(Year,DATEDIFF(Year,@StartDate,@EndDate), @StartDate) > @EndDate THEN 1 ELSE 0 END,@StartDate)) ,@EndDate) - CASE WHEN DATEADD(Day,DATEDIFF(Day, DATEADD(Month,DATEDIFF(Month, (DATEADD(Year,DATEDIFF(Year,@StartDate,@EndDate) - CASE WHEN DATEADD(Year,DATEDIFF(Year,@StartDate,@EndDate), @StartDate) > @EndDate THEN 1 ELSE 0 END,@StartDate)),@EndDate) - CASE WHEN DATEADD(Month, DATEDIFF(Month,DATEADD(Year,DATEDIFF(Year,@StartDate,@EndDate) - CASE WHEN DATEADD(Year,DATEDIFF(Year,@StartDate,@EndDate), @StartDate) > @EndDate THEN 1 ELSE 0 END,@StartDate),@EndDate) , @StartDate) > @EndDate THEN 1 ELSE 0 END  ,DATEADD(Year,DATEDIFF(Year,@StartDate,@EndDate) - CASE WHEN DATEADD(Year,DATEDIFF(Year,@StartDate,@EndDate), @StartDate) > @EndDate THEN 1 ELSE 0 END,@StartDate)) ,@EndDate),DATEADD(Month,DATEDIFF(Month, (DATEADD(Year,DATEDIFF(Year,@StartDate,@EndDate) - CASE WHEN DATEADD(Year,DATEDIFF(Year,@StartDate,@EndDate), @StartDate) > @EndDate THEN 1 ELSE 0 END,@StartDate)),@EndDate) - CASE WHEN DATEADD(Month, DATEDIFF(Month,DATEADD(Year,DATEDIFF(Year,@StartDate,@EndDate) - CASE WHEN DATEADD(Year,DATEDIFF(Year,@StartDate,@EndDate), @StartDate) > @EndDate THEN 1 ELSE 0 END,@StartDate),@EndDate) , @StartDate) > @EndDate THEN 1 ELSE 0 END  ,DATEADD(Year,DATEDIFF(Year,@StartDate,@EndDate) - CASE WHEN DATEADD(Year,DATEDIFF(Year,@StartDate,@EndDate), @StartDate) > @EndDate THEN 1 ELSE 0 END,@StartDate))) > @EndDate THEN 1 ELSE 0 END AS [Days] 
```

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2016-06-20T05:14:45.643

```
select DOB as Birthdate,
       YEAR(GETDATE()) as ThisYear, 
       YEAR(getdate()) - EAR(date1) as Age   
from TableName 
```

* * *

## 回答 #23

> 赞同：-1
> 
> 时间：2016-06-20T05:22:24.513

```
SELECT DOB AS Birthdate ,
       YEAR(GETDATE()) AS ThisYear,
       YEAR(getdate()) - YEAR(DOB) AS Age
FROM tableprincejain 
```

* * *

## 回答 #24

> 赞同：-1
> 
> 时间：2020-01-07T11:05:39.300

```
declare @BirthDate datetime
declare @TotalYear int
declare @TotalMonths int
declare @TotalDays int
declare @TotalWeeks int
declare @TotalHours int
declare @TotalMinute int
declare @TotalSecond int
declare @CurrentDtTime datetime
set @BirthDate='1998/01/05 05:04:00'  -- Set Your date here
set @TotalYear= FLOOR(DATEDIFF(DAY, @BirthDate, GETDATE()) / 365.25)
set @TotalMonths= FLOOR(DATEDIFF(DAY,DATEADD(year, @TotalYear,@BirthDate),GetDate()) / 30.436875E)
set @TotalDays= FLOOR(DATEDIFF(DAY, DATEADD(month, @TotalMonths,DATEADD(year, 
    @TotalYear,@BirthDate)), GETDATE()))
set @CurrentDtTime=CONVERT(datetime,CONVERT(varchar(50), DATEPART(year, 
    GetDate()))+'/' +CONVERT(varchar(50), DATEPART(MONTH, GetDate()))
    +'/'+ CONVERT(varchar(50),DATEPART(DAY, GetDate()))+' '
    + CONVERT(varchar(50),DATEPART(HOUR, @BirthDate))+':'+ 
     CONVERT(varchar(50),DATEPART(MINUTE, @BirthDate))+
   ':'+ CONVERT(varchar(50),DATEPART(Second, @BirthDate)))
set @TotalHours = DATEDIFF(hour, @CurrentDtTime, GETDATE())
if(@TotalHours < 0)
begin
   set @TotalHours = DATEDIFF(hour,DATEADD(Day,-1, @CurrentDtTime), GETDATE())
   set @TotalDays= @TotalDays -1  
 end
set @TotalMinute= DATEPART(MINUTE, GETDATE())-DATEPART(MINUTE, @BirthDate)
 if(@TotalMinute < 0)
set @TotalMinute = DATEPART(MINUTE, DATEADD(hour,-1,GETDATE()))+(60-DATEPART(MINUTE, 
   @BirthDate))

set @TotalSecond= DATEPART(Second, GETDATE())-DATEPART(Second, @BirthDate)

 Print 'Your age are'+ CHAR(13)
 + CONVERT(varchar(50), @TotalYear)+' Years, ' +
   CONVERT(varchar(50),@TotalMonths) +' Months, ' +
   CONVERT(varchar(50),@TotalDays)+' Days, ' +
   CONVERT(varchar(50),@TotalHours)+' Hours, ' +
   CONVERT(varchar(50),@TotalMinute)+' Minutes, ' + 
   CONVERT(varchar(50),@TotalSecond)+' Seconds. ' +char(13)+
     'Your are born at day of week was - ' + CONVERT(varchar(50),DATENAME(dw , 
     @BirthDate ))
  +char(13)+char(13)+
+'Your Birthdate to till date your '+ CHAR(13)
+'Years - ' + CONVERT(varchar(50), FLOOR(DATEDIFF(DAY, @BirthDate, GETDATE()) / 
   365.25))
+' , Months - ' + CONVERT(varchar(50),DATEDIFF(MM,@BirthDate,getdate())) 
+' , Weeks - ' + CONVERT(varchar(50),DATEDIFF(wk,@BirthDate,getdate()))
+' , Days - ' + CONVERT(varchar(50),DATEDIFF(dd,@BirthDate,getdate()))+char(13)+
+'Hours - ' + CONVERT(varchar(50),DATEDIFF(HH,@BirthDate,getdate()))
+' , Minutes - ' + CONVERT(varchar(50),DATEDIFF(mi,@BirthDate,getdate()))
+' , Seconds - ' + CONVERT(varchar(50),DATEDIFF(ss,@BirthDate,getdate())) 
```

输出

```
Your age are
22 Years, 0 Months, 2 Days, 11 Hours, 30 Minutes, 16 Seconds. 
Your are born at day of week was - Monday

Your Birthdate to till date your 
Years - 22 , Months - 264 , Weeks - 1148 , Days - 8037
Hours - 192899 , Minutes - 11573970 , Seconds - 694438216 
```

# language-agnostic - 继续 被认为是有害的？

> ID：57600
> 
> 赞同：22
> 
> 时间：2008-09-11T20:50:57.623
> 
> 标签：language-agnostic, loops, goto, continue

开发人员是否应该避免在 C# 中使用[continue](http://msdn.microsoft.com/en-us/library/923ahwt1.aspx)或其他语言中的等价物来强制循环的下一次迭代？支持或反对的论点是否会与有关[Goto](https://stackoverflow.com/questions/46586/goto-still-considered-harmful)的论点重叠？

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2008-09-11T20:54:55.477

我认为应该更多地使用continue！

我经常遇到如下代码：

```
for (...)
{
   if (!cond1)
   {
      if (!cond2)
      {
          ... highly indented lines ...
      }
   }
} 
```

代替

```
for (...)
{
   if (cond1 || cond2)
   {
      continue;
   }

   ...
} 
```

使用它使代码更具可读性！

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-09-11T20:56:14.410

**`continue`**比说，更有害吗**`break`**？

如果有的话，在我遇到/使用它的大多数情况下，我发现它使代码更清晰，不像意大利面条。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-09-11T20:56:48.187

你可以写好代码有或没有继续，你可以写坏代码有或没有继续。

关于 goto 的参数可能有一些重叠，但就我而言，使用 continue 相当于使用 break 语句（在循环中）或从方法体中的任何位置返回语句 - 如果使用正确，它可以简化代码（不太可能包含错误，更易于维护）。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-11T22:02:50.243

没有有害的关键字。它们只有有害用途。

Goto 本身并无害，继续也无害。它们需要小心使用，仅此而已。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-11T21:14:22.823

如果 continue 导致可读性问题，那么您可能还有其他问题。例如，for 循环中的大量代码。如果您必须编写大型 for 循环，我会尝试坚持在 for 循环顶部附近使用 continue 。否则，很容易错过深埋在 for 循环中间的 continue。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-11T22:14:59.620

我喜欢在循环的开头使用 continue 来处理简单的 if 条件。

对我来说，它使代码更具可读性，因为没有额外的嵌套，您可以看到我已经明确处理了这些情况。

这与我使用 goto 的原因相同吗？也许。我有时确实使用它们来提高可读性并停止代码的嵌套，但我通常更多地使用它们来进行清理/错误处理。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-12T20:43:53.103

我会说：“这取决于”。

如果您有相当小的循环代码（您可以在不滚动的情况下看到整个循环代码），通常可以使用 continue。

但是，如果循环体很大（例如由于一个大开关），并且有一些后续代码（比如在开关下方），您可能会通过添加 continue 来轻松引入错误，从而有时会跳过该代码。我在字节码解释器的核心遇到过这种情况，在某些情况下，由于在某些情况下分支的继续，有时无法执行某些检测代码。

这可能是一个人为构造的案例，但我通常会尽量避免 continue 并使用 if （但不会像 Rob 的示例代码那样嵌套太深）。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-11T20:53:27.663

我认为 continue 永远不会像 goto 那样困难，因为 continue 永远不会将执行移出它所在的代码块。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-15T14:06:14.130

如果您正在遍历任何类型的结果集，并对所述结果执行操作，例如在 for each 中，并且如果一个特定结果导致问题，则它在捕获预期错误（通过 try-catch）方面非常有用，记录它，然后通过 continue 转到下一个结果。imo，对于在奇数时间执行工作的无人值守服务，Continue 特别有用，并且一个异常不应影响其他 x 条记录。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-01-12T20:49:21.563

就这个程序员而言，**嵌套 if/else**被认为是有害的。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-03-06T18:37:51.000

1.  在循环的开头使用 continue 来避免迭代不必要的元素是无害的，并且非常有用，但是在嵌套的 if 和 else 中间使用它可以将循环代码变成一个复杂的迷宫，以便理解和验证。

2.  我认为它的使用避免也是语义误解的结果。从未在他们的代码上看到/写过“继续”关键字的人，当看到带有 continue 的代码时，可以将其解释为“自然流的延续”。例如，如果不是 continue 我们有**next**，我想更多的人会喜欢这个有价值的光标功能。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-11T21:10:47.123

goto 可以用作继续，但不能反过来。

您可以“转到”任何地方，从而任意中断流量控制。

因此继续，几乎没有那么有害。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-11T22:28:45.483

其他人已经暗示过......但是 continue 和 break 由**编译器**强制执行，并且有自己的关联规则。Goto 没有这样的限制，尽管在某些情况下净效果*可能几乎相同。*

我不认为 continue 或 break 本身是有害的，尽管我确信两者都可以以一种会使任何理智的程序员作呕的方式使用不当。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-11T20:59:02.923

在大多数语言中，Continue 是一个非常有用的功能，因为它允许在某些条件下跳过代码块。

一种替代方法是在 if 语句中使用布尔变量，但每次使用后都需要重置这些变量。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-12T13:17:40.497

我会说是的。对我来说，它只是打破了流畅编写的代码的“流程”。

另一个论点也可能是，如果您坚持大多数现代语言支持的基本关键字，那么您的程序流（如果不是逻辑或代码）可以移植到任何其他语言。使用不受支持的关键字（即 continue 或 goto）会破坏这一点。

这实际上更像是个人喜好，但我从来没有使用过它，并且在我编写新代码时也没有真正考虑过它。（与 goto 相同。）

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2008-09-11T21:07:06.023

`continue`我觉得不对。`break`让你离开那里，但`continue`似乎只是意大利面。

另一方面，您可以`continue`使用`break`（至少在 Java 中）进行模拟。

```
for (String str : strs) contLp: {
    ...
       break contLp;
    ...
} 
```

`break`（这篇文章在上述代码中存在十多年的明显错误。这对于/看起来不太好`continue`。）

`continue`在某些情况下可能有用，但我仍然觉得它很脏。可能是时候引入一种新方法了。

```
for (char c : cs) {
    final int i;
    if ('0' <= c && c <= '9') {
        i = c - '0';
    } else if ('a' <= c && c <= 'z') {
        i = c - 'a' + 10;
    } else {
        continue;
    }
    ... use i ...
} 
```

这些用途应该很少见。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2008-09-12T04:49:23.540

我相信反对 continue 的底线论点是它更难证明代码是正确的。这是数学意义上的证明。但这对您来说可能无关紧要，因为没有人有资源“证明”一个非常复杂的计算机程序。

输入静态分析工具。你可能会让他们更难...

还有 goto，出于同样的原因，这听起来像是一场噩梦，但在代码中的任何随机位置。

# c# - 使用 C# 应用程序在 WinCE 中保存注册表值

> ID：57609
> 
> 赞同：3
> 
> 时间：2008-09-11T20:54:07.770
> 
> 标签：c#, registry, windows-ce

我正在使用带有触摸屏的 WinCE 6.0 系统，该触摸屏将其校准数据（xy 位置、偏移量等）存储在系统注册表 (HKLM\HARDWARE\TOUCH) 中。现在，我将 cal 值放入在构建时放入 OS 映像的注册表项中。这适用于我从中获取原始校准值的显示器，但是当我将此图像加载到具有不同显示器的另一个系统时，触摸屏指针位置（可以理解）关闭，因为两个显示器没有相同的校准值.

我的问题是我不知道如何将值正确存储到注册表中，以便它们在重新启动后仍然存在。看，我可以在第二个系统上重新校准屏幕，但新值只存在于易失性内存中。我向我的老板建议，我们可以告诉我们的客户在任何时候都将电源保持在设备上——但效果并不好。

我需要关于如何将新常量保存到注册表中的建议，以便我们可以在将监视器发送给我们的客户之前对其进行一次校准，而不必为我们构建的每个单元制作单独的操作系统映像。

已知在 CE6.0 中工作的 AC# 方法会有所帮助。谢谢。

-奥巴斯塔

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-12T21:22:22.860

跟进这个问题：

感谢 DannySmurf，最终需要完成刷新注册表项。但是，在到达那个阶段之前，我还缺少一些步骤。因此，以下是曝光的内容：

*   我使用的是基于 RAM 的注册表，根据设计，冷启动后注册表不会持续存在。我不得不将注册表切换到基于配置单元的注册表。
*   切换到基于 hive 的注册表结构时，您需要确保 hive 存在于非易失性介质上。这是在 platform.reg 文件中指定的：

    ```
    [HKEY_LOCAL_MACHINE\init\BootVars]
    "SystemHive"="\\Hard Disk\\system.hv"
    "ProfileDir"="\\Documents and Settings"
    "RegistryFlags"=dword:1               ; Flush hive on every RegCloseKey call
    "SystemHiveInitialSize"=dword:19000   ; Initial size for hive-registry file 
    "Start DevMgr"=dword:1 
    ```

*   一旦 system.hv 文件在硬盘上（在我的例子中是 CF 卡），注册表中的值将在冷启动后保持不变。请注意，system.hv 文件包含所有 HKLM 密钥。

*   还需要注意的是，任何需要在启动时初始化的驱动程序都必须在解决方案的 .reg 文件中指定。例如，在尝试从中读取系统配置单元文件之前，我必须确保已加载硬盘驱动程序 (PCMCIA)。这样做的方法是在每个驱动程序初始化键周围添加以下格式的指令：

    ```
    ;HIVE BOOT SECTION
    [HKEY_LOCAL_MACHINE\Drivers\PCCARD\PCMCIA\TEMPLATE\PCMCIA]
      "Dll"="pcmcia.dll"
      "NoConfig"=dword:1
      "IClass"=multi_sz:"{6BEAB08A-8914-42fd-B33F-61968B9AAB32}=PCMCIA Card Services"
      "Flags"=dword:1000
    ;END HIVE BOOT SECTION 
    ```

再加上很多运气，就是这样。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-11T23:55:48.863

我认为您可能正在寻找的是 RegistryKey 类的 Flush 函数。这通常不是必需的（默认情况下，注册表是惰性刷新的），但如果在系统有机会执行此操作之前关闭设备电源，则更改将被丢弃：

[http://msdn.microsoft.com/en-us/library/microsoft.win32.registrykey.flush.aspx](http://msdn.microsoft.com/en-us/library/microsoft.win32.registrykey.flush.aspx)

此功能在 .NET Compact Framework 2.0 版及更高版本中可用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-15T20:28:03.277

据我了解，您需要知道如何在运行时为注册表设置值。我希望下面的代码可以帮助你。

使用 Microsoft.Win32；

```
 /// <summary>
    /// store a key value in registry. if it don't exist it will be created. 
    /// </summary>
    /// <param name="mainKey">the main key of key path</param>
    /// <param name="subKey">the path below the main key</param>
    /// <param name="keyName">the key name</param>
    /// <param name="value">the value to be stored</param>
    public static void SetRegistry(int mainKey, String subKey, String keyName, object value)
    {
        if (mainKey != CURRENT_USER && mainKey != LOCAL_MACHINE)
        {
            throw new ArgumentOutOfRangeException("mainKey", "\'mainKey\' argument can only be AppUtils.CURRENT_USER or AppUtils.LOCAL_MACHINE values");
        }

        if (subKey == null)
        {
            throw new ArgumentNullException("subKey", "\'subKey\' argument cannot be null");
        }

        if (keyName == null)
        {
            throw new ArgumentNullException("keyName", "\'keyName\' argument cannot be null");
        }

        const Boolean WRITABLE = true;
        RegistryKey key = null;

        if (mainKey == CURRENT_USER)
        {
            key = Registry.CurrentUser.OpenSubKey(subKey, WRITABLE);

            if (key == null)
            {
                key = Registry.CurrentUser.CreateSubKey(subKey);
            }
        }
        else if (mainKey == LOCAL_MACHINE)
        {
            key = Registry.LocalMachine.OpenSubKey(subKey, WRITABLE);

            if (key == null)
            {
                key = Registry.LocalMachine.CreateSubKey(subKey);
            }
        }

        key.SetValue(keyName, value);

    }

    /// <summary>
    /// find a key value in registry. if it don't exist the default value will be returned.
    /// </summary>
    /// <param name="mainKey">the main key of key path</param>
    /// <param name="subKey">the path below the main key</param>
    /// <param name="keyName">the key name</param>
    /// <param name="defaultValue">the value to be stored</param>

    public static object GetRegistry(int mainKey, String subKey, String keyName, object defaultValue)
    {
        if (mainKey != CURRENT_USER && mainKey != LOCAL_MACHINE)
        {
            throw new ArgumentOutOfRangeException("mainKey", "\'mainKey\' argument can only be AppUtils.CURRENT_USER or AppUtils.LOCAL_MACHINE values");
        }

        if (subKey == null)
        {
            throw new ArgumentNullException("subKey", "\'subKey\' argument cannot be null");
        }

        if (keyName == null)
        {
            throw new ArgumentNullException("keyName", "\'keyName\' argument cannot be null");
        }

        RegistryKey key = Registry.CurrentUser.OpenSubKey(subKey);

        if (mainKey == CURRENT_USER)
        {
            key = Registry.CurrentUser.OpenSubKey(subKey);
        }
        else if (mainKey == LOCAL_MACHINE)
        {
            key = Registry.LocalMachine.OpenSubKey(subKey);
        }

        object result = defaultValue;

        if (key != null)
        {
            result = key.GetValue(keyName, defaultValue);
        }

        return result;
    } 
```

# c# - 如何向 Console.ReadLine() 添加超时？

> ID：57615
> 
> 赞同：131
> 
> 时间：2008-09-11T20:55:57.377
> 
> 标签：c#, .net, console, timeout, io

我有一个控制台应用程序，我想在其中给用户*x*秒来响应提示。如果一段时间后没有输入，程序逻辑应该继续。我们假设超时意味着空响应。

解决这个问题的最直接方法是什么？

* * *

## 回答 #1

> 赞同：121
> 
> 时间：2013-08-20T18:14:39.590

令我惊讶的是，5 年后，所有答案仍然存在以下一个或多个问题：

*   使用了 ReadLine 以外的功能，导致功能丧失。（删除/退格/向上键用于先前的输入）。
*   函数在多次调用时表现不佳（产生多个线程、许多挂起的 ReadLine 或其他意外行为）。
*   功能依赖于忙等待。这是一种可怕的浪费，因为预计等待时间从几秒到超时，可能是几分钟。运行这么长时间的忙等待是对资源的可怕吸收，这在多线程场景中尤其糟糕。如果用睡眠修改忙等待，这会对响应能力产生负面影响，尽管我承认这可能不是一个大问题。

我相信我的解决方案将解决最初的问题，而不会遇到上述任何问题：

```
class Reader {
  private static Thread inputThread;
  private static AutoResetEvent getInput, gotInput;
  private static string input;

  static Reader() {
    getInput = new AutoResetEvent(false);
    gotInput = new AutoResetEvent(false);
    inputThread = new Thread(reader);
    inputThread.IsBackground = true;
    inputThread.Start();
  }

  private static void reader() {
    while (true) {
      getInput.WaitOne();
      input = Console.ReadLine();
      gotInput.Set();
    }
  }

  // omit the parameter to read a line without a timeout
  public static string ReadLine(int timeOutMillisecs = Timeout.Infinite) {
    getInput.Set();
    bool success = gotInput.WaitOne(timeOutMillisecs);
    if (success)
      return input;
    else
      throw new TimeoutException("User did not provide input within the timelimit.");
  }
} 
```

当然，调用非常简单：

```
try {
  Console.WriteLine("Please enter your name within the next 5 seconds.");
  string name = Reader.ReadLine(5000);
  Console.WriteLine("Hello, {0}!", name);
} catch (TimeoutException) {
  Console.WriteLine("Sorry, you waited too long.");
} 
```

或者，您可以使用`TryXX(out)`约定，如 shmueli 建议的那样：

```
 public static bool TryReadLine(out string line, int timeOutMillisecs = Timeout.Infinite) {
    getInput.Set();
    bool success = gotInput.WaitOne(timeOutMillisecs);
    if (success)
      line = input;
    else
      line = null;
    return success;
  } 
```

这被称为如下：

```
Console.WriteLine("Please enter your name within the next 5 seconds.");
string name;
bool success = Reader.TryReadLine(out name, 5000);
if (!success)
  Console.WriteLine("Sorry, you waited too long.");
else
  Console.WriteLine("Hello, {0}!", name); 
```

在这两种情况下，您都不能将呼叫`Reader`与正常`Console.ReadLine`呼叫混在一起：如果`Reader`超时，则会出现挂起的`ReadLine`呼叫。相反，如果您想进行正常（非定时）`ReadLine`调用，只需使用`Reader`并省略超时，使其默认为无限超时。

那么我提到的其他解决方案的那些问题呢？

*   如您所见，使用了ReadLine，避免了第一个问题。
*   该函数在多次调用时行为正常。无论是否发生超时，只有一个后台线程会一直运行，并且至多只有一次对 ReadLine 的调用会一直处于活动状态。调用该函数将始终导致最新的输入或超时，并且用户不必多次按 Enter 来提交他的输入。
*   而且，显然，该功能不依赖于忙等待。相反，它使用适当的多线程技术来防止资源浪费。

我预见到这个解决方案的唯一问题是它不是线程安全的。`Reader.ReadLine`但是，多个线程不能真正同时要求用户输入，因此无论如何都应该在调用之前进行同步。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2010-01-11T11:30:36.787

```
string ReadLine(int timeoutms)
{
    ReadLineDelegate d = Console.ReadLine;
    IAsyncResult result = d.BeginInvoke(null, null);
    result.AsyncWaitHandle.WaitOne(timeoutms);//timeout e.g. 15000 for 15 secs
    if (result.IsCompleted)
    {
        string resultstr = d.EndInvoke(result);
        Console.WriteLine("Read: " + resultstr);
        return resultstr;
    }
    else
    {
        Console.WriteLine("Timed out!");
        throw new TimedoutException("Timed Out!");
    }
}

delegate string ReadLineDelegate(); 
```

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2008-09-11T21:06:45.963

这种使用[Console.KeyAvailable](http://msdn.microsoft.com/en-us/library/system.console.keyavailable.aspx)的方法会有帮助吗？

```
class Sample 
{
    public static void Main() 
    {
    ConsoleKeyInfo cki = new ConsoleKeyInfo();

    do {
        Console.WriteLine("\nPress a key to display; press the 'x' key to quit.");

// Your code could perform some useful task in the following loop. However, 
// for the sake of this example we'll merely pause for a quarter second.

        while (Console.KeyAvailable == false)
            Thread.Sleep(250); // Loop until input is entered.
        cki = Console.ReadKey(true);
        Console.WriteLine("You pressed the '{0}' key.", cki.Key);
        } while(cki.Key != ConsoleKey.X);
    }
} 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2011-10-05T16:19:49.770

这对我有用。

```
ConsoleKeyInfo k = new ConsoleKeyInfo();
Console.WriteLine("Press any key in the next 5 seconds.");
for (int cnt = 5; cnt > 0; cnt--)
  {
    if (Console.KeyAvailable)
      {
        k = Console.ReadKey();
        break;
      }
    else
     {
       Console.WriteLine(cnt.ToString());
       System.Threading.Thread.Sleep(1000);
     }
 }
Console.WriteLine("The key pressed was " + k.Key); 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-09-11T21:18:13.580

一种或另一种方式，您确实需要第二个线程。您可以使用异步 IO 来避免声明自己的：

*   声明一个 ManualResetEvent，称之为“evt”
*   调用 System.Console.OpenStandardInput 来获取输入流。指定将存储其数据并设置 evt 的回调方法。
*   调用该流的 BeginRead 方法以启动异步读取操作
*   然后在 ManualResetEvent 上输入定时等待
*   如果等待超时，则取消读取

如果读取返回数据，则设置事件并且您的主线程将继续，否则您将在超时后继续。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2010-08-28T16:41:21.763

```
// Wait for 'Enter' to be pressed or 5 seconds to elapse
using (Stream s = Console.OpenStandardInput())
{
    ManualResetEvent stop_waiting = new ManualResetEvent(false);
    s.BeginRead(new Byte[1], 0, 1, ar => stop_waiting.Set(), null);

    // ...do anything else, or simply...

    stop_waiting.WaitOne(5000);
    // If desired, other threads could also set 'stop_waiting' 
    // Disposing the stream cancels the async read operation. It can be
    // re-opened if needed.
} 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-09-11T21:02:09.110

我认为您将需要创建一个辅助线程并轮询控制台上的密钥。我知道没有内置的方法来实现这一点。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-09-11T22:09:41.943

在委托中调用 Console.ReadLine() 是不好的，因为如果用户没有点击“输入”，那么该调用将永远不会返回。执行委托的线程将被阻塞，直到用户点击“输入”，无法取消它。

发出这些调用的序列不会像您期望的那样运行。考虑以下内容（使用上面的示例控制台类）：

```
System.Console.WriteLine("Enter your first name [John]:");

string firstName = Console.ReadLine(5, "John");

System.Console.WriteLine("Enter your last name [Doe]:");

string lastName = Console.ReadLine(5, "Doe"); 
```

用户让第一个提示的超时到期，然后为第二个提示输入一个值。firstName 和 lastName 都将包含默认值。当用户点击“输入”时，第**一个**ReadLine 调用将完成，但代码已放弃该调用并基本上放弃了结果。第二**次**ReadLine 调用将继续阻塞，超时最终将到期，返回的值将再次成为默认值。

顺便说一句 - 上面的代码中有一个错误。通过调用 waitHandle.Close() 您可以从工作线程下关闭事件。如果用户在超时到期后点击“输入”，工作线程将尝试发出引发 ObjectDisposedException 的事件。异常是从工作线程抛出的，如果您没有设置未处理的异常处理程序，您的进程将终止。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2012-01-26T10:39:11.013

在找到一个在企业环境中完美运行的解决方案之前，我为这个问题苦苦挣扎了 5 个月。

到目前为止，大多数解决方案的问题是它们依赖于 Console.ReadLine() 以外的东西，而 Console.ReadLine() 有很多优点：

*   支持删除、退格、方向键等。
*   按“向上”键并重复上一个命令的能力（如果您实现一个经常使用的后台调试控制台，这将非常方便）。

我的解决方案如下：

1.  使用 Console.ReadLine()生成一个**单独的线程来处理用户输入。**
2.  [超时时间过后，通过使用http://inputsimulator.codeplex.com/](http://inputsimulator.codeplex.com/)向当前控制台窗口发送 [enter] 键来解除对 Console.ReadLine() 的阻止。

示例代码：

```
 InputSimulator.SimulateKeyPress(VirtualKeyCode.RETURN); 
```

有关此技术的更多信息，包括中止使用 Console.ReadLine 的线程的正确技术：

[.NET 调用将 [enter] 击键发送到当前进程，这是一个控制台应用程序？](https://stackoverflow.com/questions/9016087/net-call-to-send-enter-keystroke-into-the-current-process-which-is-a-console)

[当所述线程正在执行Console.ReadLine时，如何中止.NET中的另一个线程？](https://stackoverflow.com/questions/8984838/how-to-abort-another-thread-in-net-when-said-thread-is-executing-console-readl)

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2017-06-26T12:48:08.993

如果你在`Main()`方法中，你不能使用`await`，所以你必须使用`Task.WaitAny()`：

```
var task = Task.Factory.StartNew(Console.ReadLine);
var result = Task.WaitAny(new Task[] { task }, TimeSpan.FromSeconds(5)) == 0
    ? task.Result : string.Empty; 
```

但是，C# 7.1 引入了创建异步`Main()`方法的可能性，因此最好在`Task.WhenAny()`有该选项时使用该版本：

```
var task = Task.Factory.StartNew(Console.ReadLine);
var completedTask = await Task.WhenAny(task, Task.Delay(TimeSpan.FromSeconds(5)));
var result = object.ReferenceEquals(task, completedTask) ? task.Result : string.Empty; 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-10-23T20:20:49.527

我可能对这个问题读得太多了，但我假设等待类似于启动菜单，除非你按下一个键，否则它会等待 15 秒。您可以使用 (1) 阻塞函数或 (2) 您可以使用线程、事件和计时器。该事件将充当“继续”，并会阻塞直到计时器到期或按下某个键。

(1) 的伪代码是：

```
// Get configurable wait time
TimeSpan waitTime = TimeSpan.FromSeconds(15.0);
int configWaitTimeSec;
if (int.TryParse(ConfigManager.AppSetting["DefaultWaitTime"], out configWaitTimeSec))
    waitTime = TimeSpan.FromSeconds(configWaitTimeSec);

bool keyPressed = false;
DateTime expireTime = DateTime.Now + waitTime;

// Timer and key processor
ConsoleKeyInfo cki;
// EDIT: adding a missing ! below
while (!keyPressed && (DateTime.Now < expireTime))
{
    if (Console.KeyAvailable)
    {
        cki = Console.ReadKey(true);
        // TODO: Process key
        keyPressed = true;
    }
    Thread.Sleep(10);
} 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2017-09-14T18:49:32.100

好像这里还没有足够的答案:0)，下面封装成一个静态方法@kwl 上面的解决方案（第一个）。

```
 public static string ConsoleReadLineWithTimeout(TimeSpan timeout)
    {
        Task<string> task = Task.Factory.StartNew(Console.ReadLine);

        string result = Task.WaitAny(new Task[] { task }, timeout) == 0
            ? task.Result 
            : string.Empty;
        return result;
    } 
```

用法

```
 static void Main()
    {
        Console.WriteLine("howdy");
        string result = ConsoleReadLineWithTimeout(TimeSpan.FromSeconds(8.5));
        Console.WriteLine("bye");
    } 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2016-01-12T16:37:52.693

.NET 4 使用 Tasks 使这非常简单。

首先，构建你的助手：

```
 Private Function AskUser() As String
      Console.Write("Answer my question: ")
      Return Console.ReadLine()
   End Function 
```

其次，执行一个任务并等待：

```
 Dim askTask As Task(Of String) = New TaskFactory().StartNew(Function() AskUser())
      askTask.Wait(TimeSpan.FromSeconds(30))
      If Not askTask.IsCompleted Then
         Console.WriteLine("User failed to respond.")
      Else
         Console.WriteLine(String.Format("You responded, '{0}'.", askTask.Result))
      End If 
```

没有尝试重新创建 ReadLine 功能或执行其他危险的 hack 来使其正常工作。任务让我们以非常自然的方式解决问题。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-09-11T21:30:38.697

**编辑**：通过在单独的进程中完成实际工作并在超时时终止该进程来解决问题。详情见下文。哇！

只是试了一下，它似乎工作得很好。我的同事有一个使用 Thread 对象的版本，但我发现委托类型的 BeginInvoke() 方法更优雅一些。

```
namespace TimedReadLine
{
   public static class Console
   {
      private delegate string ReadLineInvoker();

      public static string ReadLine(int timeout)
      {
         return ReadLine(timeout, null);
      }

      public static string ReadLine(int timeout, string @default)
      {
         using (var process = new System.Diagnostics.Process
         {
            StartInfo =
            {
               FileName = "ReadLine.exe",
               RedirectStandardOutput = true,
               UseShellExecute = false
            }
         })
         {
            process.Start();

            var rli = new ReadLineInvoker(process.StandardOutput.ReadLine);
            var iar = rli.BeginInvoke(null, null);

            if (!iar.AsyncWaitHandle.WaitOne(new System.TimeSpan(0, 0, timeout)))
            {
               process.Kill();
               return @default;
            }

            return rli.EndInvoke(iar);
         }
      }
   }
} 
```

ReadLine.exe 项目是一个非常简单的项目，它有一个类，如下所示：

```
namespace ReadLine
{
   internal static class Program
   {
      private static void Main()
      {
         System.Console.WriteLine(System.Console.ReadLine());
      }
   }
} 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2010-06-03T15:36:58.550

不幸的是，我无法对 Gulzar 的帖子发表评论，但这里有一个更完整的例子：

```
 while (Console.KeyAvailable == false)
            {
                Thread.Sleep(250);
                i++;
                if (i > 3)
                    throw new Exception("Timedout waiting for input.");
            }
            input = Console.ReadLine(); 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2010-02-17T16:59:03.773

解决此问题的简单线程示例

```
Thread readKeyThread = new Thread(ReadKeyMethod);
static ConsoleKeyInfo cki = null;

void Main()
{
    readKeyThread.Start();
    bool keyEntered = false;
    for(int ii = 0; ii < 10; ii++)
    {
        Thread.Sleep(1000);
        if(readKeyThread.ThreadState == ThreadState.Stopped)
            keyEntered = true;
    }
    if(keyEntered)
    { //do your stuff for a key entered
    }
}

void ReadKeyMethod()
{
    cki = Console.ReadKey();
} 
```

或顶部的静态字符串以获得整行。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2010-06-04T12:29:21.657

我的情况是这样的：

```
public static ManualResetEvent evtToWait = new ManualResetEvent(false);

private static void ReadDataFromConsole( object state )
{
    Console.WriteLine("Enter \"x\" to exit or wait for 5 seconds.");

    while (Console.ReadKey().KeyChar != 'x')
    {
        Console.Out.WriteLine("");
        Console.Out.WriteLine("Enter again!");
    }

    evtToWait.Set();
}

static void Main(string[] args)
{
        Thread status = new Thread(ReadDataFromConsole);
        status.Start();

        evtToWait = new ManualResetEvent(false);

        evtToWait.WaitOne(5000); // wait for evtToWait.Set() or timeOut

        status.Abort(); // exit anyway
        return;
} 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2013-05-12T02:56:55.480

这不是很好而且很短吗？

```
if (SpinWait.SpinUntil(() => Console.KeyAvailable, millisecondsTimeout))
{
    ConsoleKeyInfo keyInfo = Console.ReadKey();

    // Handle keyInfo value here...
} 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2013-07-13T07:22:39.090

这是 Glen Slayden 解决方案的更完整示例。在为另一个问题构建测试用例时，我碰巧做到了这一点。它使用异步 I/O 和手动复位事件。

```
public static void Main() {
    bool readInProgress = false;
    System.IAsyncResult result = null;
    var stop_waiting = new System.Threading.ManualResetEvent(false);
    byte[] buffer = new byte[256];
    var s = System.Console.OpenStandardInput();
    while (true) {
        if (!readInProgress) {
            readInProgress = true;
            result = s.BeginRead(buffer, 0, buffer.Length
              , ar => stop_waiting.Set(), null);

        }
        bool signaled = true;
        if (!result.IsCompleted) {
            stop_waiting.Reset();
            signaled = stop_waiting.WaitOne(5000);
        }
        else {
            signaled = true;
        }
        if (signaled) {
            readInProgress = false;
            int numBytes = s.EndRead(result);
            string text = System.Text.Encoding.UTF8.GetString(buffer
              , 0, numBytes);
            System.Console.Out.Write(string.Format(
              "Thank you for typing: {0}", text));
        }
        else {
            System.Console.Out.WriteLine("oy, type something!");
        }
    } 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2017-03-22T00:18:54.960

这是一个安全的解决方案，它在超时后伪造控制台输入以解除阻塞线程。 [https://github.com/Igorium/ConsoleReader](https://github.com/Igorium/ConsoleReader)项目提供了一个示例用户对话框实现。

```
var inputLine = ReadLine(5);

public static string ReadLine(uint timeoutSeconds, Func<uint, string> countDownMessage, uint samplingFrequencyMilliseconds)
{
    if (timeoutSeconds == 0)
        return null;

    var timeoutMilliseconds = timeoutSeconds * 1000;

    if (samplingFrequencyMilliseconds > timeoutMilliseconds)
        throw new ArgumentException("Sampling frequency must not be greater then timeout!", "samplingFrequencyMilliseconds");

    CancellationTokenSource cts = new CancellationTokenSource();

    Task.Factory
        .StartNew(() => SpinUserDialog(timeoutMilliseconds, countDownMessage, samplingFrequencyMilliseconds, cts.Token), cts.Token)
        .ContinueWith(t => {
            var hWnd = System.Diagnostics.Process.GetCurrentProcess().MainWindowHandle;
            PostMessage(hWnd, 0x100, 0x0D, 9);
        }, TaskContinuationOptions.NotOnCanceled);

    var inputLine = Console.ReadLine();
    cts.Cancel();

    return inputLine;
}

private static void SpinUserDialog(uint countDownMilliseconds, Func<uint, string> countDownMessage, uint samplingFrequencyMilliseconds,
    CancellationToken token)
{
    while (countDownMilliseconds > 0)
    {
        token.ThrowIfCancellationRequested();

        Thread.Sleep((int)samplingFrequencyMilliseconds);

        countDownMilliseconds -= countDownMilliseconds > samplingFrequencyMilliseconds
            ? samplingFrequencyMilliseconds
            : countDownMilliseconds;
    }
}

[DllImport("User32.Dll", EntryPoint = "PostMessageA")]
private static extern bool PostMessage(IntPtr hWnd, uint msg, int wParam, int lParam); 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2019-03-24T03:22:16.290

*我的代码完全基于朋友的回答@JSQuareD*

但是我需要使用`Stopwatch`计时器，因为当我完成程序时`Console.ReadKey()`它仍在等待`Console.ReadLine()`并且它产生了意外的行为。

**它对我来说非常有效。保持原来的 Console.ReadLine()**

```
class Program
{
    static void Main(string[] args)
    {
        Console.WriteLine("What is the answer? (5 secs.)");
        try
        {
            var answer = ConsoleReadLine.ReadLine(5000);
            Console.WriteLine("Answer is: {0}", answer);
        }
        catch
        {
            Console.WriteLine("No answer");
        }
        Console.ReadKey();
    }
}

class ConsoleReadLine
{
    private static string inputLast;
    private static Thread inputThread = new Thread(inputThreadAction) { IsBackground = true };
    private static AutoResetEvent inputGet = new AutoResetEvent(false);
    private static AutoResetEvent inputGot = new AutoResetEvent(false);

    static ConsoleReadLine()
    {
        inputThread.Start();
    }

    private static void inputThreadAction()
    {
        while (true)
        {
            inputGet.WaitOne();
            inputLast = Console.ReadLine();
            inputGot.Set();
        }
    }

    // omit the parameter to read a line without a timeout
    public static string ReadLine(int timeout = Timeout.Infinite)
    {
        if (timeout == Timeout.Infinite)
        {
            return Console.ReadLine();
        }
        else
        {
            var stopwatch = new Stopwatch();
            stopwatch.Start();

            while (stopwatch.ElapsedMilliseconds < timeout && !Console.KeyAvailable) ;

            if (Console.KeyAvailable)
            {
                inputGet.Set();
                inputGot.WaitOne();
                return inputLast;
            }
            else
            {
                throw new TimeoutException("User did not provide input within the timelimit.");
            }
        }
    }
} 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2021-03-26T17:48:58.260

我有一个使用 Windows API 的解决方案，它比这里的许多解决方案都有一些好处：

*   使用 Console.ReadLine 检索输入，因此您可以获得与该输入相关的所有细节（输入历史等）
*   强制 Console.ReadLine 调用在超时后完成，因此您不会为每个超时的调用累积一个新线程。
*   不会不安全地中止线程。
*   没有像输入伪造方法那样的焦点问题。

两个主要缺点：

*   仅适用于 Windows。
*   这很复杂。

基本思想是 Windows API 具有取消未完成的 I/O 请求的函数：[CancelIoEx](https://docs.microsoft.com/en-us/windows/win32/fileio/cancelioex-func)。当您使用它取消对 STDIN 的操作时，Console.ReadLine 会引发 OperationCanceledException。

所以这里是你如何做到的：

```
using System;
using System.Runtime.InteropServices;
using System.Threading;
using System.Threading.Tasks;

namespace ConsoleHelper
{
    public static class ConsoleHelper
    {
        public static string ReadLine(TimeSpan timeout)
        {
            return ReadLine(Task.Delay(timeout));
        }

        public static string ReadLine(Task cancel_trigger)
        {
            var status = new Status();

            var cancel_task = Task.Run(async () =>
            {
                await cancel_trigger;

                status.Mutex.WaitOne();
                bool io_done = status.IODone;
                if (!io_done)
                    status.CancellationStarted = true;
                status.Mutex.ReleaseMutex();

                while (!status.IODone)
                {
                    var success = CancelStdIn(out int error_code);

                    if (!success && error_code != 0x490) // 0x490 is what happens when you call cancel and there is not a pending I/O request
                        throw new Exception($"Canceling IO operation on StdIn failed with error {error_code} ({error_code:x})");
                }
            });

            ReadLineWithStatus(out string input, out bool read_canceled);

            if (!read_canceled)
            {
                status.Mutex.WaitOne();
                bool must_wait = status.CancellationStarted;
                status.IODone = true;
                status.Mutex.ReleaseMutex();

                if (must_wait)
                    cancel_task.Wait();

                return input;
            }
            else // read_canceled == true
            {
                status.Mutex.WaitOne();
                bool cancel_started = status.CancellationStarted;
                status.IODone = true;
                status.Mutex.ReleaseMutex();

                if (!cancel_started)
                    throw new Exception("Received cancelation not triggered by this method.");
                else
                    cancel_task.Wait();

                return null;
            }
        }

        private const int STD_INPUT_HANDLE = -10;

        [DllImport("kernel32.dll", SetLastError = true)]
        private static extern IntPtr GetStdHandle(int nStdHandle);

        [DllImport("kernel32.dll", SetLastError = true)]
        private static extern bool CancelIoEx(IntPtr handle, IntPtr lpOverlapped);

        private static bool CancelStdIn(out int error_code)
        {
            var handle = GetStdHandle(STD_INPUT_HANDLE);
            bool success = CancelIoEx(handle, IntPtr.Zero);

            if (success)
            {
                error_code = 0;
                return true;
            }
            else
            {
                var rc = Marshal.GetLastWin32Error();
                error_code = rc;
                return false;
            }
        }

        private class Status
        {
            public Mutex Mutex = new Mutex(false);
            public volatile bool IODone;
            public volatile bool CancellationStarted;
        }

        private static void ReadLineWithStatus(out string result, out bool operation_canceled)
        {
            try
            {
                result = Console.ReadLine();
                operation_canceled = false;
            }
            catch (OperationCanceledException)
            {
                result = null;
                operation_canceled = true;
            }
        }
    }
} 
```

避免简化这一点的诱惑，让线程正确是非常棘手的。您需要处理所有这些情况：

*   取消被触发并在开始`CancelStdIn`之前被调用`Console.ReadLine`（这就是为什么你需要在 中的循环`cancel_trigger`）。
*   Console.ReadLine 在触发取消之前返回（可能很久之前）。
*   Console.ReadLine 在触发取消之后但在`CancelStdIn`调用之前返回。
*   `CancelStdIn`Console.ReadLine 由于调用 以响应取消触发器而引发异常。

致谢：从[Gérald Barré 的博客中获得的](https://www.meziantou.net/cancelling-console-read.htm)[SO 答案](https://stackoverflow.com/a/58475263/1769757)中获得了 CancelIoEx 的想法。然而，这些解决方案存在细微的并发错误。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2008-09-11T21:20:54.697

获得第二个线程的另一种廉价方法是将其包装在委托中。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2009-05-19T23:26:29.610

上面 Eric 帖子的示例实现。这个特定示例用于读取通过管道传递给控制台应用程序的信息：

```
 using System;
using System.Collections.Generic;
using System.IO;
using System.Threading;

namespace PipedInfo
{
    class Program
    {
        static void Main(string[] args)
        {
            StreamReader buffer = ReadPipedInfo();

            Console.WriteLine(buffer.ReadToEnd());
        }

        #region ReadPipedInfo
        public static StreamReader ReadPipedInfo()
        {
            //call with a default value of 5 milliseconds
            return ReadPipedInfo(5);
        }

        public static StreamReader ReadPipedInfo(int waitTimeInMilliseconds)
        {
            //allocate the class we're going to callback to
            ReadPipedInfoCallback callbackClass = new ReadPipedInfoCallback();

            //to indicate read complete or timeout
            AutoResetEvent readCompleteEvent = new AutoResetEvent(false);

            //open the StdIn so that we can read against it asynchronously
            Stream stdIn = Console.OpenStandardInput();

            //allocate a one-byte buffer, we're going to read off the stream one byte at a time
            byte[] singleByteBuffer = new byte[1];

            //allocate a list of an arbitary size to store the read bytes
            List<byte> byteStorage = new List<byte>(4096);

            IAsyncResult asyncRead = null;
            int readLength = 0; //the bytes we have successfully read

            do
            {
                //perform the read and wait until it finishes, unless it's already finished
                asyncRead = stdIn.BeginRead(singleByteBuffer, 0, singleByteBuffer.Length, new AsyncCallback(callbackClass.ReadCallback), readCompleteEvent);
                if (!asyncRead.CompletedSynchronously)
                    readCompleteEvent.WaitOne(waitTimeInMilliseconds);

                //end the async call, one way or another

                //if our read succeeded we store the byte we read
                if (asyncRead.IsCompleted)
                {
                    readLength = stdIn.EndRead(asyncRead);
                    if (readLength > 0)
                        byteStorage.Add(singleByteBuffer[0]);
                }

            } while (asyncRead.IsCompleted && readLength > 0);
            //we keep reading until we fail or read nothing

            //return results, if we read zero bytes the buffer will return empty
            return new StreamReader(new MemoryStream(byteStorage.ToArray(), 0, byteStorage.Count));
        }

        private class ReadPipedInfoCallback
        {
            public void ReadCallback(IAsyncResult asyncResult)
            {
                //pull the user-defined variable and strobe the event, the read finished successfully
                AutoResetEvent readCompleteEvent = asyncResult.AsyncState as AutoResetEvent;
                readCompleteEvent.Set();
            }
        }
        #endregion ReadPipedInfo
    }
} 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2011-09-06T11:13:55.620

```
string readline = "?";
ThreadPool.QueueUserWorkItem(
    delegate
    {
        readline = Console.ReadLine();
    }
);
do
{
    Thread.Sleep(100);
} while (readline == "?"); 
```

请注意，如果您使用“Console.ReadKey”路线，您将失去 ReadLine 的一些很酷的功能，即：

*   支持删除、退格、方向键等。
*   按“向上”键并重复上一个命令的能力（如果您实现一个经常使用的后台调试控制台，这将非常方便）。

要添加超时，请更改 while 循环以适应。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2013-07-30T12:02:03.103

请不要恨我为过多的现有答案添加另一个解决方案！这适用于 Console.ReadKey()，但可以很容易地修改为与 ReadLine() 等一起使用。

由于“Console.Read”方法是阻塞的，因此有必要“[轻推](https://stackoverflow.com/questions/9479573/interrupt-console-readline)”StdIn 流以取消读取。

调用语法：

```
ConsoleKeyInfo keyInfo;
bool keyPressed = AsyncConsole.ReadKey(500, out keyInfo);
// where 500 is the timeout 
```

代码：

```
public class AsyncConsole // not thread safe
{
    private static readonly Lazy<AsyncConsole> Instance =
        new Lazy<AsyncConsole>();

    private bool _keyPressed;
    private ConsoleKeyInfo _keyInfo;

    private bool DoReadKey(
        int millisecondsTimeout,
        out ConsoleKeyInfo keyInfo)
    {
        _keyPressed = false;
        _keyInfo = new ConsoleKeyInfo();

        Thread readKeyThread = new Thread(ReadKeyThread);
        readKeyThread.IsBackground = false;
        readKeyThread.Start();

        Thread.Sleep(millisecondsTimeout);

        if (readKeyThread.IsAlive)
        {
            try
            {
                IntPtr stdin = GetStdHandle(StdHandle.StdIn);
                CloseHandle(stdin);
                readKeyThread.Join();
            }
            catch { }
        }

        readKeyThread = null;

        keyInfo = _keyInfo;
        return _keyPressed;
    }

    private void ReadKeyThread()
    {
        try
        {
            _keyInfo = Console.ReadKey();
            _keyPressed = true;
        }
        catch (InvalidOperationException) { }
    }

    public static bool ReadKey(
        int millisecondsTimeout,
        out ConsoleKeyInfo keyInfo)
    {
        return Instance.Value.DoReadKey(millisecondsTimeout, out keyInfo);
    }

    private enum StdHandle { StdIn = -10, StdOut = -11, StdErr = -12 };

    [DllImport("kernel32.dll")]
    private static extern IntPtr GetStdHandle(StdHandle std);

    [DllImport("kernel32.dll")]
    private static extern bool CloseHandle(IntPtr hdl);
} 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2013-10-11T14:49:44.730

这是一个使用`Console.KeyAvailable`. 这些是阻塞调用，但如果需要，通过 TPL 异步调用它们应该是相当简单的。我使用标准的取消机制来简化与任务异步模式和所有好东西的连接。

```
public static class ConsoleEx
{
  public static string ReadLine(TimeSpan timeout)
  {
    var cts = new CancellationTokenSource();
    return ReadLine(timeout, cts.Token);
  }

  public static string ReadLine(TimeSpan timeout, CancellationToken cancellation)
  {
    string line = "";
    DateTime latest = DateTime.UtcNow.Add(timeout);
    do
    {
        cancellation.ThrowIfCancellationRequested();
        if (Console.KeyAvailable)
        {
            ConsoleKeyInfo cki = Console.ReadKey();
            if (cki.Key == ConsoleKey.Enter)
            {
                return line;
            }
            else
            {
                line += cki.KeyChar;
            }
        }
        Thread.Sleep(1);
    }
    while (DateTime.UtcNow < latest);
    return null;
  }
} 
```

这有一些缺点。

*   您没有获得`ReadLine`提供的标准导航功能（向上/向下箭头滚动等）。
*   如果按下特殊键（F1、PrtScn 等），这会将“\0”字符注入输入。不过，您可以通过修改代码轻松过滤掉它们。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2013-12-17T10:41:09.813

在这里结束，因为问了一个重复的问题。我想出了以下看起来很简单的解决方案。我确信它有一些我错过的缺点。

```
static void Main(string[] args)
{
    Console.WriteLine("Hit q to continue or wait 10 seconds.");

    Task task = Task.Factory.StartNew(() => loop());

    Console.WriteLine("Started waiting");
    task.Wait(10000);
    Console.WriteLine("Stopped waiting");
}

static void loop()
{
    while (true)
    {
        if ('q' == Console.ReadKey().KeyChar) break;
    }
} 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2014-10-03T18:20:53.960

我来到这个答案并最终做了：

```
 /// <summary>
    /// Reads Line from console with timeout. 
    /// </summary>
    /// <exception cref="System.TimeoutException">If user does not enter line in the specified time.</exception>
    /// <param name="timeout">Time to wait in milliseconds. Negative value will wait forever.</param>        
    /// <returns></returns>        
    public static string ReadLine(int timeout = -1)
    {
        ConsoleKeyInfo cki = new ConsoleKeyInfo();
        StringBuilder sb = new StringBuilder();

        // if user does not want to spesify a timeout
        if (timeout < 0)
            return Console.ReadLine();

        int counter = 0;

        while (true)
        {
            while (Console.KeyAvailable == false)
            {
                counter++;
                Thread.Sleep(1);
                if (counter > timeout)
                    throw new System.TimeoutException("Line was not entered in timeout specified");
            }

            cki = Console.ReadKey(false);

            if (cki.Key == ConsoleKey.Enter)
            {
                Console.WriteLine();
                return sb.ToString();
            }
            else
                sb.Append(cki.KeyChar);                
        }            
    } 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2015-06-27T13:29:26.067

一个简单的例子`Console.KeyAvailable`：

```
Console.WriteLine("Press any key during the next 2 seconds...");
Thread.Sleep(2000);
if (Console.KeyAvailable)
{
    Console.WriteLine("Key pressed");
}
else
{
    Console.WriteLine("You were too slow");
} 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2016-06-19T13:26:28.263

更现代和基于任务的代码看起来像这样：

```
public string ReadLine(int timeOutMillisecs)
{
    var inputBuilder = new StringBuilder();

    var task = Task.Factory.StartNew(() =>
    {
        while (true)
        {
            var consoleKey = Console.ReadKey(true);
            if (consoleKey.Key == ConsoleKey.Enter)
            {
                return inputBuilder.ToString();
            }

            inputBuilder.Append(consoleKey.KeyChar);
        }
    });

    var success = task.Wait(timeOutMillisecs);
    if (!success)
    {
        throw new TimeoutException("User did not provide input within the timelimit.");
    }

    return inputBuilder.ToString();
} 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2016-08-25T21:06:07.150

我有一个独特的情况，即拥有一个 Windows 应用程序（Windows 服务）。当以交互方式运行程序时`Environment.IsInteractive`（VS 调试器或从 cmd.exe），我使用 AttachConsole/AllocConsole 来获取我的标准输入/标准输出。为了防止进程在工作完成时结束，UI 线程调用`Console.ReadKey(false)`. 我想取消 UI 线程正在从另一个线程执行的等待，所以我想出了@JSquaredD 对解决方案的修改。

```
using System;
using System.Diagnostics;

internal class PressAnyKey
{
  private static Thread inputThread;
  private static AutoResetEvent getInput;
  private static AutoResetEvent gotInput;
  private static CancellationTokenSource cancellationtoken;

  static PressAnyKey()
  {
    // Static Constructor called when WaitOne is called (technically Cancel too, but who cares)
    getInput = new AutoResetEvent(false);
    gotInput = new AutoResetEvent(false);
    inputThread = new Thread(ReaderThread);
    inputThread.IsBackground = true;
    inputThread.Name = "PressAnyKey";
    inputThread.Start();
  }

  private static void ReaderThread()
  {
    while (true)
    {
      // ReaderThread waits until PressAnyKey is called
      getInput.WaitOne();
      // Get here 
      // Inner loop used when a caller uses PressAnyKey
      while (!Console.KeyAvailable && !cancellationtoken.IsCancellationRequested)
      {
        Thread.Sleep(50);
      }
      // Release the thread that called PressAnyKey
      gotInput.Set();
    }
  }

  /// <summary>
  /// Signals the thread that called WaitOne should be allowed to continue
  /// </summary>
  public static void Cancel()
  {
    // Trigger the alternate ending condition to the inner loop in ReaderThread
    if(cancellationtoken== null) throw new InvalidOperationException("Must call WaitOne before Cancelling");
    cancellationtoken.Cancel();
  }

  /// <summary>
  /// Wait until a key is pressed or <see cref="Cancel"/> is called by another thread
  /// </summary>
  public static void WaitOne()
  {
    if(cancellationtoken==null || cancellationtoken.IsCancellationRequested) throw new InvalidOperationException("Must cancel a pending wait");
    cancellationtoken = new CancellationTokenSource();
    // Release the reader thread
    getInput.Set();
    // Calling thread will wait here indefiniately 
    // until a key is pressed, or Cancel is called
    gotInput.WaitOne();
  }    
} 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2017-04-27T07:27:06.987

这似乎是最简单的工作解决方案，不使用任何本机 API：

```
 static Task<string> ReadLineAsync(CancellationToken cancellation)
    {
        return Task.Run(() =>
        {
            while (!Console.KeyAvailable)
            {
                if (cancellation.IsCancellationRequested)
                    return null;

                Thread.Sleep(100);
            }
            return Console.ReadLine();
        });
    } 
```

示例用法：

```
 static void Main(string[] args)
    {
        AsyncContext.Run(async () =>
        {
            CancellationTokenSource cancelSource = new CancellationTokenSource();
            cancelSource.CancelAfter(1000);
            Console.WriteLine(await ReadLineAsync(cancelSource.Token) ?? "null");
        });
    } 
```

# php - PHP 是否面向对象？

> ID：57622
> 
> 赞同：10
> 
> 时间：2008-09-11T20:57:20.040
> 
> 标签：php, oop, web-applications

我有一个未使用 PHP 的面向对象功能编写的 web 应用程序的开始。

我真的不知道是否值得回去重写我已经完成的部分。面向对象的 PHP 是否值得重写一个体面的工作应用程序的全部或部分？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-11T21:24:43.860

鉴于您有一个不完整的应用程序，我会说将其重新构建为基于对象的应用程序可能会有所帮助。

要考虑的一件事是最终应用程序的预期大小。在一定的复杂性之下，基于对象可能是矫枉过正，除了学习经验。

我开始避免像瘟疫这样的物体，因为我在大学课堂上最初对它们的介绍很糟糕。我最近不得不从事一个在 php 对象中实现的项目。进行所需的更改比其他项目容易得多。从那以后，我经常在对象模型中工作，发现它非常方便快速创建和更容易维护。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-11T22:41:35.610

只是不同意共识......在大多数情况下我会说不。无论如何，这不是商业代码的学术练习。如果它正在工作，请不要重新编写它。如果您必须进行更改/添加位，那么重构面向 OO 实践（在 SO 上有很多关于在您更改代码时进行重构的帖子，而不仅仅是为了它）。

在实践中，如果你没有做过很多 OOP，那么你会想从小处着手，感受一下。

一旦你掌握了基础知识，一本好的设计模式初学者指南（我喜欢 Head First 这本书）就非常有用。大多数 PHP 书籍对 OOP 的教导都很差。他们教你关于继承的知识，但通常不会教你关于松散耦合和偏好组合而不是继承的知识。一本设计模式书将使您更好地了解这一点。

PHP 仍然以没有正确“做”OO 而闻名。我认为这不公平，但这反映了人们在没有真正了解 OOP 的情况下很容易上手的事实。我会冒昧地说大多数（非常轻微 - 称之为 51%）的 PHP 程序员对 OOP 并不满意。我认为在 PHP 中做好的 OO 是可能的，如果你已经对这种语言感到满意，那么这是提高你技能的好方法。

编辑：

只是添加一些免责声明......

1.  我对*大多数*PHP 程序员对 OOP 不满意的评论不适用于当前的 SO 受众！
2.  并不是说您对 OOP 不满意，*如果*您不满意，这适用

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-11T21:03:34.037

典型的回答：“视情况而定。”

我倾向于把显示页面写成一个从头到尾，<html> 到</html> 的脚本页面。但是那个页面上发生的事情是对象。有点像穷人的ASP。虽然您*可以*拥有基于 OOP 的输出，但我一直认为它对于像将数据转储到浏览器这样乏味的任务来说太麻烦了。

因此，业务规则和数据访问是 OOP。演示文稿是脚本。

如果您有**不是**OOP 的业务规则，我会认真考虑在两​​个条件下将它们写为对象：（1）“您有时间/精力/金钱吗？” (2) 是“你有一个好的 PHP IDE 可以让你的生活更轻松吗？” 如果它有效，并且改变它意味着用 Notepad++ 编写，那么我会称之为完成。:-)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-11T20:59:52.077

我不会说这很关键，但如果你打算在应用程序上走得更远，我建议你现在就去做，而这并不是一项艰巨的任务。我想说一个编写良好的 OOP 程序的可维护性可能远远超过前期成本。尤其是当您认为您将能够在进行过程中重构大部分代码时。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-11T21:02:01.387

学习面向对象的技术将非常有用，尤其是对于将来用其他语言进行编程。

由于您刚刚启动应用程序，您可以重写和改进您编写的部分。这取决于你的截止日期。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-15T12:42:01.600

有两种可能性：要么您的应用程序是一次性的，只需立即运行，永远不会被触及、调整、扩展或修改，**或者**您的应用程序是您将继续使用和使用的东西的开始很长时间。

如果是前者，请不要破坏完全可用的代码。你的时间有更好的事情要做。

如果是后者，您必须记住关于 PHP 的一个重要事实，那就是：**编写不佳的 PHP 是维护的噩梦。** 不如写得不好的 Perl 糟糕——因为它是什么？——但已经够糟糕了，迟早你会有强烈的冲动去偷一台时间机器，回到你写代码的那一刻，你现在发现自己在维护，然后用冰锥刺自己的眼窝。

因此，如果您要随着时间的推移维护此代码，请花时间将其做好。这意味着：某种模板系统，没有嵌入 HTML 中的 PHP 标记，用于不同功能的单独文件，以及**classes 类 classes**！

你的眼窝会感谢你的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-12T05:45:38.867

*我会说试着去 OO 只是因为如果做得好*，你所拥有的东西可以比程序更容易重用

 *我还要说OO比程序更有组织。当您的规模很小时，很容易摆脱草率的代码 OO 与否。但是当你处理更大的项目时，你的程序必须更有条理和深思熟虑。在一些较大的项目中，OO 往往会迫使您更有条理，使事情变得更容易。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-15T12:30:54.343

不，我认为如果应用程序正常工作，则无需重写它。PHP 根本不是真正的 OOP。他们很努力，但有时我认为即使是 PHP 开发人员也并不真正理解 OOP 的意义。如果您想学习 OOP（这肯定是一个好主意），请尝试使用真正的 OOP 语言（如 Smalltalk）来学习基本概念。Java 也不错 2 学习基础知识，虽然它也不是完全面向对象的

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-15T12:47:33.273

我想在这里重申其他答案。这取决于应用程序的大小以及您想了解多少有关 OOP 的知识。不过，我会小心使用 PHP 来学习 OOP。

至于 PHP 有多少**是**面向对象的…… PHP4 有一些 OOP 元素，PHP5 更好，但它没有融入语言。PHP 可以双向工作，我个人喜欢你可以选择。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-09-02T05:16:19.207

在我看来，我们phper可以彻底抛弃Object（类实例）的概念，我们只需要Array和Mode Class：

初始模式下的所有数组都支持任何数组函数，因为它的方法：

```
<?php
$array1->array_flip(this);
?> 
```

用于`->mode()`验证最小数据集，然后切换模式类：

```
<?php
$array1->mode('class1', $success);
?> 
```

任何模式类都没有`->construct()`，但必须`->validate()`验证最小数据集。

一个模式下的数组仍然可以使用数组函数作为它的方法，但是使用其中任何一个后数组都会切换回基本数组模式，我们需要使用`->mode('class1', $success);`来切换模式。

激进的思想是以数据为中心的编程，我们需要将数据（数组）和活动（类方法）分开。

我们可以修改PHP引擎，去掉部分OO（面向对象），支持Mode Class，我们可以称之为MyPHP。

例如： `$array_man1`可以设置为两种模式：`cls_normal_man`和`cls_crazy_man`：

```
<?php
$array_man1->mode('cls_normal_man')->normal_method1()->mode('cls_crazy_man')->crazy_method1();
?> 
```

# sql-server - 您如何在 SQL Server 2005 中锁定表，我什至应该这样做吗？

> ID：57625
> 
> 赞同：13
> 
> 时间：2008-09-11T20:57:48.933
> 
> 标签：sql-server, tsql

这需要一些解释。我所做的是在 SQL Server 2005 中创建一个特定的自定义消息队列。我有一个包含确认和完成时间戳的消息表。调用者为获取其队列中的下一条消息而执行的存储过程也会确认该消息。到现在为止还挺好。好吧，如果系统正在经历大量事务（每分钟数千次），那么在另一个存储过程的执行过程中是否有可能在另一个执行过程中确认消息，而另一个消息本身准备好这样做？让我通过在存储过程中显示我的 SQL 代码来提供帮助：

```
--Grab the next message id
declare @MessageId uniqueidentifier
set @MessageId = (select top(1) ActionMessageId from UnacknowledgedDemands);

--Acknowledge the message
update ActionMessages
set AcknowledgedTime = getdate()
where ActionMessageId = @MessageId

--Select the entire message
...
... 
```

在上面的代码中，不能同时运行的另一个存储过程获取相同的 id 并尝试同时确认它吗？我可以（或者我应该）实现某种锁定以防止另一个存储过程确认另一个存储过程正在查询的消息吗？

哇，这有任何意义吗？有点难以表达...

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-11T21:09:57.000

像这样的东西

```
--Grab the next message id
begin tran
declare @MessageId uniqueidentifier
select top 1 @MessageId =   ActionMessageId from UnacknowledgedDemands with(holdlock, updlock);

--Acknowledge the message
update ActionMessages
set AcknowledgedTime = getdate()
where ActionMessageId = @MessageId

-- some error checking
commit tran

--Select the entire message
...
... 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-07-19T11:25:43.490

这似乎是一种[`OUTPUT`](http://msdn.microsoft.com/en-us/library/ms177564.aspx)有用的情况：

```
-- Acknowledge and grab the next message
declare @message table (
    -- ...your `ActionMessages` columns here...
)
update ActionMessages
set    AcknowledgedTime = getdate()
output INSERTED.* into @message
where  ActionMessageId in (select top(1) ActionMessageId from UnacknowledgedDemands)
  and  AcknowledgedTime is null

-- Use the data in @message, which will have zero or one rows assuming
-- `ActionMessageId` uniquely identifies a row (strongly implied in your question)
...
... 
```

在那里，我们在同一个操作中更新和抓取行，这告诉查询优化器我们正在**做**什么，允许它选择它可以选择的最细粒度的锁并在尽可能短的时间内维护它。（虽然列前缀是`INSERTED`,`OUTPUT`就像触发器一样，用`UPDATE`删除行和插入新行来表示。）

我需要有关您`ActionMessages`和`UnacknowledgedDemands`表（视图/TVF/其他）的更多信息，更不用说对 SQL Server 自动锁定的更多了解，以说明该`and AcknowledgedTime is null`子句是否必要。它可以防止子选择和更新之间的竞争条件。我敢肯定，如果我们从`ActionMessages`自身中进行选择（例如，`where AcknowledgedTime is null`在`top`,`update`而不是在 上的子选择`UnacknowledgedDemands`），则没有必要。我希望即使它是不必要的，它也是无害的。

请注意，这`OUTPUT`是在 SQL Server 2005 及更高版本中。这就是你所说的你正在使用的，但如果需要与老年 SQL Server 2000 安装兼容，你会想要另一种方式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T21:06:23.327

@基尔霍夫：

整个 SQL 批处理在执行之前被解析，因此 SQL 知道您将对表进行更新以及从中进行选择。

编辑：此外，SQL 不一定会锁定整个表 - 它可以只锁定必要的行。有关SQL Server 中锁定的概述，请参见[此处。](http://msdn.microsoft.com/en-us/library/aa213039(SQL.80).aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T12:59:45.607

而不是显式锁定，通常由 SQL Server 升级到比预期更高的粒度，为什么不尝试这种方法：

```
declare @MessageId uniqueidentifier
select top 1 @MessageId = ActionMessageId from UnacknowledgedDemands

update ActionMessages
  set AcknowledgedTime = getdate()
  where ActionMessageId = @MessageId and AcknowledgedTime is null

if @@rowcount > 0
  /* acknoweldge succeeded */
else
  /* concurrent query acknowledged message before us,
     go back and try another one */ 
```

您锁定的越少 - 您拥有的并发性越高。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-11T21:04:32.723

你真的应该一件一件地处理事情吗？您不应该让 SQL Server 用今天的日期确认所有未确认的消息并返回它们吗？（当然也都在交易中）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-11T21:11:06.763

[在此处](http://www.quest-pipelines.com/newsletter-v3/0202_F.htm)和[此处](http://msdn.microsoft.com/en-us/library/aa213039(SQL.80).aspx)阅读有关 SQL Server 选择锁定的更多信息。SQL Server 能够在选择上调用表锁。在事务期间，表不会发生任何事情。事务完成后，任何插入或更新都将自行解决。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-11T21:01:47.907

您想将代码包装在事务中，然后 SQL Server 将处理锁定相应的行或表。

```
begin transaction

--Grab the next message id
declare @MessageId uniqueidentifier
set @MessageId = (select top(1) ActionMessageId from UnacknowledgedDemands);

--Acknowledge the message
update ActionMessages
set AcknowledgedTime = getdate()
where ActionMessageId = @MessageId

commit transaction

--Select the entire message
... 
```

# javascript - 如何让 JavaScript 在当前监视器上打开一个弹出窗口

> ID：57652
> 
> 赞同：22
> 
> 时间：2008-09-11T21:06:21.687
> 
> 标签：javascript, multiple-monitors

设想：

1.  用户有两个监视器。
2.  他们的浏览器在辅助监视器上打开。
3.  他们单击浏览器中的链接，该链接调用具有特定顶部和左侧窗口偏移量的 window.open()。
4.  弹出窗口始终在其主监视器上打开。

JavaScript 中有什么方法可以让弹出窗口在与初始浏览器窗口（打开器）相同的监视器上打开？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-11T21:15:08.983

您不能指定监视器，但可以将弹出窗口的位置指定为相对于单击导致窗口弹出的位置。

使用 getMouseXY() 函数获取要作为 left 和 top args 传递给 window.open() 方法的值。（left 和 top args 仅适用于 V3 及更高版本的浏览器）。

window.open 文档： [http ://www.javascripter.net/faq/openinga.htm](http://www.javascripter.net/faq/openinga.htm)

```
function getMouseXY( e ) {
    if ( event.clientX ) { // Grab the x-y pos.s if browser is IE.
        CurrentLeft = event.clientX + document.body.scrollLeft;
        CurrentTop  = event.clientY + document.body.scrollTop;
    }
    else {  // Grab the x-y pos.s if browser isn't IE.
        CurrentLeft = e.pageX;
        CurrentTop  = e.pageY;
    }  
    if ( CurrentLeft < 0 ) { CurrentLeft = 0; };
    if ( CurrentTop  < 0 ) { CurrentTop  = 0; };  

    return true;
} 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2011-01-13T16:11:02.027

这是我从 Facebook oauth API 无耻地逆向工程的东西。在 Firefox/Chrome 的主要和次要显示器上进行了测试。

```
function popup_params(width, height) {
    var a = typeof window.screenX != 'undefined' ? window.screenX : window.screenLeft;
    var i = typeof window.screenY != 'undefined' ? window.screenY : window.screenTop;
    var g = typeof window.outerWidth!='undefined' ? window.outerWidth : document.documentElement.clientWidth;
    var f = typeof window.outerHeight != 'undefined' ? window.outerHeight: (document.documentElement.clientHeight - 22);
    var h = (a < 0) ? window.screen.width + a : a;
    var left = parseInt(h + ((g - width) / 2), 10);
    var top = parseInt(i + ((f-height) / 2.5), 10);
    return 'width=' + width + ',height=' + height + ',left=' + left + ',top=' + top + ',scrollbars=1';
}   

window.open(url, "window name", "location=1,toolbar=0," + popup_params(modal_width, modal_height)); 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-01-24T20:46:10.190

```
// Pops a window relative to the current window position
function popup(url, winName, xOffset, yOffset) {
  var x = (window.screenX || window.screenLeft || 0) + (xOffset || 0);
  var y = (window.screenY || window.screenTop || 0) + (yOffset || 0);
  return window.open(url, winName, 'top=' +y+ ',left=' +x))
} 
```

像下面这样调用它，它将在当前窗口的顶部打开

```
popup('http://www.google.com', 'my-win'); 
```

或者让它稍微偏移

```
popup('http://www.google.com', 'my-win', 30, 30); 
```

关键是 window.screenX/screenLeft 为您提供与整个桌面相关的位置，而不仅仅是显示器。

window.screen.left 将是为您提供所需信息的理想人选。问题是它是在页面加载时设置的，用户可以将窗口移动到另一个监视器。

**更多研究**

这个问题的最终解决方案（不仅仅是从当前窗口位置偏移）需要知道窗口所在屏幕的尺寸。由于屏幕对象不会随着用户移动窗口而更新，我们需要制作我们的自己检测当前屏幕分辨率的方法。这是我想出的

```
/**
 * Finds the screen element for the monitor that the browser window is currently in.
 * This is required because window.screen is the screen that the page was originally
 * loaded in. This method works even after the window has been moved across monitors.
 * 
 * @param {function} cb The function that will be called (asynchronously) once the screen 
 * object has been discovered. It will be passed a single argument, the screen object.
 */
function getScreenProps (cb) {
    if (!window.frames.testiframe) {
      var iframeEl = document.createElement('iframe');
      iframeEl.name = 'testiframe';
      iframeEl.src = "about:blank";
      iframeEl.id = 'iframe-test'
      document.body.appendChild(iframeEl);
    }

    // Callback when the iframe finishes reloading, it will have the 
    // correct screen object
    document.getElementById('iframe-test').onload = function() {
      cb( window.frames.testiframe.screen );
      delete document.getElementById('iframe-test').onload;
    };
    // reload the iframe so that the screen object is reloaded
    window.frames.testiframe.location.reload();
}; 
```

因此，如果您想始终在窗口所在的任何监视器的左上角打开窗口，您可以使用以下命令：

```
function openAtTopLeftOfSameMonitor(url, winName) {
  getScreenProps(function(scr){
    window.open(url, winName, 'top=0,left=' + scr.left);
  })
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-10-24T14:25:59.697

在当前显示器上打开居中的窗口，也可以与 Chrome 一起使用：

```
function popupOnCurrentScreenCenter(url, title, w, h) {
    var dualScreenLeft = typeof window.screenLeft !== "undefined" ? window.screenLeft : screen.left;
    var dualScreenTop = typeof window.screenTop !== "undefined" ? window.screenTop : screen.top;

    var width = window.innerWidth ? window.innerWidth :
        document.documentElement.clientWidth ? document.documentElement.clientWidth : screen.width;
    var height = window.innerHeight ? window.innerHeight :
        document.documentElement.clientHeight ? document.documentElement.clientHeight : screen.height;

    var left = ((width / 2) - (w / 2)) + dualScreenLeft;
    var top = ((height / 2) - (h / 2)) + dualScreenTop;
    var newWindow =
        window.open(url, title, 'scrollbars=yes, width=' + w + ', height=' + h + ', top=' + top + ', left=' + left);

    // Puts focus on the newWindow
    if (window.focus) {
        newWindow.focus();
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-14T20:47:22.497

*如果*你知道每台显示器的分辨率，你可以估计这个。对于公共网站来说是个坏主意，但如果您知道（出于某种奇怪的原因）这种情况将始终适用，则可能会有用。

相对于鼠标（如上所述）或相对于原始浏览器窗口的位置也可能很有用，尽管您必须假设用户使用最大化的浏览器（这不一定是真的）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-01-12T04:35:01.107

我最近遇到了这个问题，终于找到了一种将弹出窗口定位在触发它的屏幕上的方法。在我的 github 页面上查看我的解决方案：[https ://github.com/svignara/windowPopUp](https://github.com/svignara/windowPopUp)

诀窍在于使用`window.screen`对象，它返回`availWidth`、`availHeight`和值（以及`availLeft`和）。有关对象中变量的完整列表以及这些变量所代表的含义，请查看[https://developer.mozilla.org/en-US/docs/DOM/window.screen](https://developer.mozilla.org/en-US/docs/DOM/window.screen)。`availTop``width``height`

`window.screen`本质上，我的解决方案会在单击弹出窗口的触发器时找到 的值。这样我就可以确定从哪个监视器屏幕上单击它。该`availLeft`值负责其余部分。就是这样：

> > 基本上，如果左边的第一个可用像素 ( `availLeft`) 是负数，这告诉我们“主”监视器的左侧有一个监视器。同样，如果左起第一个可用像素大于 0，则意味着以下两种情况之一：
> > 
> > 1.  监视器位于“主”监视器的右侧，或者
> > 2.  屏幕左侧有一些“垃圾”（可能是应用程序停靠栏或 Windows 开始菜单）

无论哪种情况，您都希望弹出窗口的偏移量从左侧可用像素之后开始。

```
offsetLeft = availableLeft + ( (availableWidth - modalWidth) / 2 ) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-09-10T00:34:55.307

只有 user11153 的版本适用于 Chrome 和双屏。这是它的 TypeScript 版本。

```
popupOnCurrentScreenCenter(url: string, title: string, w: number, h: number): Window|null {
    var dualScreenLeft = typeof window.screenLeft !== "undefined" ? window.screenLeft : (<any>screen).left;
    var dualScreenTop = typeof window.screenTop !== "undefined" ? window.screenTop : (<any>screen).top;

    var width = window.innerWidth ? window.innerWidth :
        document.documentElement.clientWidth ? document.documentElement.clientWidth : screen.width;
    var height = window.innerHeight ? window.innerHeight :
        document.documentElement.clientHeight ? document.documentElement.clientHeight : screen.height;

    var left = ((width / 2) - (w / 2)) + dualScreenLeft;
    var top = ((height / 2) - (h / 2)) + dualScreenTop;
    var newWindow =
        window.open(url, title, 'scrollbars=yes, width=' + w + ', height=' + h + ', top=' + top + ', left=' + left);

    // Puts focus on the newWindow
    if (window.focus && newWindow) {
        newWindow.focus();
    }
    return newWindow;
} 
```

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2008-09-11T21:14:08.440

只要您知道落在特定显示器上的 x 和 y 位置，您就可以执行以下操作：

```
var x = 0;
var y = 0;
var myWin = window.open(''+self.location,'mywin','left='+x+',top='+y+',width=500,height=500,toolbar=1,resizable=0'); 
```

# ruby-on-rails - 如何使用 Rails 通过 Web 服务以 JSON 格式公开数据？

> ID：57665
> 
> 赞同：6
> 
> 时间：2008-09-11T21:09:58.373
> 
> 标签：ruby-on-rails, web-services, json

有没有一种简单的方法可以使用 Rails 以 JSON 格式将数据返回给 Web 服务客户端？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-29T01:26:16.420

Rails 资源为您的模型提供了 RESTful 接口。让我们来看看。

# 模型

```
class Contact < ActiveRecord::Base
  ...
end 
```

# 路线

```
map.resources :contacts 
```

# 控制器

```
class ContactsController < ApplicationController
  ...
  def show
    @contact = Contact.find(params[:id]

    respond_to do |format|
      format.html 
      format.xml {render :xml => @contact}
      format.js  {render :json => @contact.json}
    end
  end
  ...
end 
```

因此，这为您提供了一个 API 接口，而无需定义特殊方法来获取所需的响应类型

例如。

```
/contacts/1 # Responds with regular html page

/contacts/1.xml # Responds with xml output of Contact.find(1) and its attributes

/contacts/1.js # Responds with json output of Contact.find(1) and its attributes 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-11T21:28:19.233

[http://wiki.rubyonrails.org/rails/pages/HowtoGenerateJSON](http://wiki.rubyonrails.org/rails/pages/HowtoGenerateJSON)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-11T22:00:14.600

Rails monkeypatches 大多数你关心的东西都有一个`#to_json`方法。

在我的脑海中，您可以对哈希、数组和 ActiveRecord 对象执行此操作，它们应该涵盖您可能想要的大约 95% 的用例。如果您有自己的自定义对象，则为它们编写自己的`to_json`方法很简单，它可以将数据塞入散列，然后返回 jsonized 散列。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T09:18:29.430

有一个插件可以做到这一点， [http://blog.labnotes.org/2007/12/11/json_request-handling-json-request-in-rails-20/](http://blog.labnotes.org/2007/12/11/json_request-handling-json-request-in-rails-20/)

据我了解，这个功能已经在 Rails 中了。但是去看看那个博客文章，有代码示例和解释。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T17:11:38.513

ActiveRecord 还提供了与 JSON 交互的方法。要从 AR 对象创建 JSON，只需调用 object.to_json。要从 JSON 创建一个 AR 对象，您应该能够创建一个新的 AR 对象，然后调用 object.from_json .. 据我所知，但这对我不起作用。

# .net - 你如何创建一个进程范围的单例对象？

> ID：57677
> 
> 赞同：1
> 
> 时间：2008-09-11T21:13:32.187
> 
> 标签：.net, singleton

我读到.Net中静态字段的粒度单位是每个AppDomain，而不是每个进程。是否可以创建一个进程范围的单例对象？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-11T21:25:07.120

您必须使用编组调用跨 AppDomain 传递信息。因此，您需要在父 AppDomain 中创建状态对象，然后将其传递给任何想要使用它的子对象。如果您不必这样做，那么您将在 AppDomains 之间共享内存，这违背了目的。

在每个 AppDomain 中，您可以有一个单例，其中包含对主域中实际单例的（编组）引用的引用。所以你的代码看起来仍然是“singleton-y”，但它背后会有一些隐藏的布线。

# jquery - 如何确定为什么 jQuery ajax $.post 请求不成功？

> ID：57679
> 
> 赞同：4
> 
> 时间：2008-09-11T21:13:53.260
> 
> 标签：jquery, ajax, post

我正在尝试根据此调用的结果确定它是否成功。没有被`successFunction`调用，所以我假设它不是。我怎么知道出了什么问题？

```
xmlRequest = $.post("/url/file/", { 'id' : object.id }, successFunction, 'json'); 
```

我是否使用 xmlRequest 对象？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-12T00:22:10.453

您可以使用：

```
$.ajax({
    url:"/url/file/",
    dataType:"json"
    data:{ 'id' : object.id }
    error:function(request){alert(request.statusText)}
    success:successFunction
}) 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-11T21:18:52.283

您可以使用 $.ajaxComplete() 和/或 $.ajaxError() 方法将函数附加到这些事件。我还建议使用带有 Firebug 插件的 Firefox 浏览器，您可以获得很多关于请求和响应的信息。

# sql-server - SSRS - 小计自定义 - 将列移动到行首

> ID：57683
> 
> 赞同：0
> 
> 时间：2008-09-11T21:14:59.063
> 
> 标签：sql-server, reporting-services, ssrs-2008

我请求将 TOTAL's 和 subtotals 列移动到它所代表的列的顶部/左侧，并且默认情况下 SSRS 在总计列的底部或右侧进行。有办法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-24T22:48:29.967

我找到了自己的解决方案，当您右键单击小计列右上角的绿色小三角形时。然后选择属性，你可以调整“布局”属性。它有2个选项，之前和之后。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T23:40:37.543

您可以在数据集之前添加一行，对于您想要总计的每个字段，只需给该单元格一个表达式，该表达式对该特定字段执行 SUM()。

# java - 如何使用 Java 通过 Web 服务以 JSON 格式公开数据？

> ID：57689
> 
> 赞同：22
> 
> 时间：2008-09-11T21:19:30.643
> 
> 标签：java, web-services, json

有没有一种简单的方法可以使用 java 以 JSON 格式将数据返回给 Web 服务客户端？我对 servlet、spring 等很好。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-16T16:02:41.360

可能值得研究一下[泽西岛](http://jersey.java.net/)。Jersey 可以轻松地将 restful web 服务公开为 xml 和/或 JSON。

一个例子......从一个简单的类开始

```
@XmlType(name = "", propOrder = { "id", "text" })
@XmlRootElement(name = "blah")
public class Blah implements Serializable {
    private Integer id;
    private String text;

    public Blah(Integer id, String text) {
        this.id = id;
        this.text = text;
    }    

    @XmlElement
    public Integer getId() { return id; }
    public void setId(Integer id) { this.id = id; }

    @XmlElement
    public String getText() { return text; }
    public void setText(String value) { this.text = value; }
} 
```

然后创建资源

```
@Path("/blah")
public class BlahResource {
    private Set<Blah> blahs = new HashSet<Blah>();

    @Context
    private UriInfo context;

    public BlahResource() {
        blahs.add(new Blah(1, "blah the first"));
        blahs.add(new Blah(2, "blah the second"));
    }

    @GET
    @Path("/{id}")
    @ProduceMime({"application/json", "application/xml"})
    public Blah getBlah(@PathParam("id") Integer id) {
        for (Blah blah : blahs) {
            if (blah.getId().equals(id)) {
                return blah;
            }
        }
        throw new NotFoundException("not found");
    }
} 
```

并暴露它。有很多方法可以做到这一点，例如使用 Jersey 的 ServletContainer。(web.xml)

```
<servlet>
    <servlet-name>jersey</servlet-name>
    <servlet-class>com.sun.jersey.spi.container.servlet.ServletContainer</servlet-class>
    <load-on-startup>1</load-on-startup>
</servlet>

<servlet-mapping>
    <servlet-name>jersey</servlet-name>
    <url-pattern>/*</url-pattern>
</servlet-mapping> 
```

这就是您需要做的一切...弹出浏览器并浏览到[http://localhost/blah/1](http://localhost/blah/1)。默认情况下，您将看到 XML 输出。如果您使用的是 FireFox，请安装 TamperData 并将您的`accept`标头更改`application/json`为查看 JSON 输出。

显然还有更多，但[泽西岛](http://jersey.java.net/)让所有这些事情变得非常容易。

祝你好运！

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-12T00:52:14.780

我们一直在使用 Flexjson 将 Java 对象转换为 JSON，并且发现它非常易于使用。 [http://flexjson.sourceforge.net](http://flexjson.sourceforge.net/)

这里有些例子：

```
public String searchCars() {
  List<Car> cars = carsService.getCars(manufacturerId);
  return new JSONSerializer().serialize(cars);
} 
```

它有一些很酷的特性，比如 deepSerialize 可以发送整个图，并且不会中断双向关系。

```
new JSONSerializer().deepSerialize(user); 
```

在服务器端格式化日期通常也很方便

```
new JSONSerializer().transform(
  new DateTransformer("dd/MM/yyyy"),"startDate","endDate"
).serialize(contract); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-12T01:40:11.513

对我来说，[最好的 Java <-> JSON 解析器是 XStream](http://xstream.codehaus.org/json-tutorial.html)（是的，我说的是 json，而不是 xml）。XStream 已经处理了循环依赖，并且有一个简单而强大的 api，您可以在其中编写自己的驱动程序、转换器等。

亲切的问候

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-11T21:41:40.510

[http://www.json.org/java/index.html](http://www.json.org/java/index.html)有你需要的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-11T21:44:49.007

是的！查看[json-lib](http://json-lib.sourceforge.net/)

这是*我自己的代码的简化代码片段，*它发送一组我的域对象：

```
private String getJsonDocumenent(Object myObj) (
    String result = "oops";
    try {
        JSONArray jsonArray = JSONArray.fromObject(myObj);

        result = jsonArray.toString(2);  //indent = 2

    } catch (net.sf.json.JSONException je) {

        throw je;
    }
    return result;
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-03-02T17:31:57.953

我发现 google-gson 引人注目。它转换为 JSON 并返回。[http://code.google.com/p/google-gson/](http://code.google.com/p/google-gson/)它非常灵活，可以直接处理对象的复杂性。我喜欢它对泛型的支持。

```
/*
* we're looking for results in the form
* {"id":123,"name":thename},{"id":456,"name":theOtherName},...
*
* TypeToken is Gson--allows us to tell Gson the data we're dealing with
* for easier serialization.
*/
Type mapType = new TypeToken<List<Map<String, String>>>(){}.getType();

List<Map<String, String>> resultList = new LinkedList<Map<String, String>>();

for (Map.Entry<String, String> pair : sortedMap.entrySet()) {
    Map<String, String> idNameMap = new HashMap<String, String>();
    idNameMap.put("id", pair.getKey());
    idNameMap.put("name", pair.getValue());
    resultList.add(idNameMap);
}

return (new Gson()).toJson(resultList, mapType); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-15T13:23:22.983

对于 Java 中的 RESTful Web 服务，还可以查看[Restlet API](http://www.restlet.org/)，它为 REST Web 服务（服务器和客户端，在容器中或独立）提供了非常强大和灵活的抽象，并且还与 Spring 和 JSON 很好地集成。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-24T18:25:19.937

如前所述，[Jersey](http://jersey.dev.java.net) (JAX-RS impl) 是要使用的框架；但是对于 Java 对象与 JSON 的基本映射，[Tutorial](http://jackson.codehaus.org/Tutorial)很好。与许多替代方案不同，它不使用奇怪的 XML 兼容性约定，而是读取和写入直接映射到对象和从对象映射的干净 JSON。它也没有关于 null（缺少条目和具有 null 的条目之间存在差异）、空列表或字符串（两者都与 null 不同）的问题。

Jackson 也可以很好地与 Jersey 配合使用，可以使用 JAX-RS 提供程序 jar，甚至可以手动使用。同样，它也很容易与普通的旧 servlet 一起使用；只需获取输入/输出流，调用 ObjectMapper.readValue() 和 .writeValue()，仅此而已。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-09-21T03:14:41.333

我一直在使用 jaxws-json，用于提供 JSON 格式的 Web 服务。您可以检查项目[https://jax-ws-commons.dev.java.net/json/](https://jax-ws-commons.dev.java.net/json/)。

这是一个不错的项目，一旦你上手，你就会发现它有多迷人。

# c# - C#中'is'反射的性能特点是什么？

> ID：57701
> 
> 赞同：21
> 
> 时间：2008-09-11T21:25:23.030
> 
> 标签：c#, reflection

它[表明](http://www.codeproject.com/KB/cs/csharpcasts.aspx)'as' 转换比前缀转换快得多，但是'is' 反射呢？有多糟糕？您可以想象，在 Google 上搜索“is”并不是非常有效。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-11T22:39:58.000

有几个选项：

1.  **经典演员**阵容：`Foo foo = (Foo)bar`
2.  **`as`演员**表操作员：`Foo foo = bar as Foo`
3.  **`is`测试**：_`bool is = bar is Foo`

* * *

1.  **经典**转换需要检查是否`bar`可以安全地转换为（快速），然后`Foo`实际执行（较慢），或者抛出异常（非常慢）。
2.  **`as`操作员**需要检查是否可以转换，然后`bar`进行转换，或者如果不能安全地转换，则返回`null`。
3.  **`is`运算符**只是检查是否`bar`可以强制转换为 Foo，并返回一个`boolean`.

测试**`is`**很快，因为它只进行完整铸造操作的第一部分。该**`as`**运算符比经典转换更快，因为如果转换失败不会引发异常（这对于您合理预期转换可能失败的情况很有用）。

如果您只需要知道变量`bar`是否为 a ，`Foo`则使用**`is`**运算符**BUT**，如果您要测试 if 是否`bar`为 a `Foo`，如果是，**则转换它**，那么您应该使用**`as`**运算符。

本质上，每次转换都需要在`is`内部进行等效的检查，以确保转换有效。因此，如果您在进行`is`一次完整转换之后进行检查（无论是一次`as`转换，还是使用经典转换运算符），您实际上是在进行`is`两次检查，这是一个额外的开销。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-11T21:32:05.323

我学到的方法是这样的：

```
if (obj is Foo) {
  Foo f = (Foo)obj;
  f.doSomething();
} 
```

比这慢：

```
Foo f = obj as Foo;
if (f != null) {
  f.doSomething();
} 
```

它足够慢吗？可能不会，但这是一件需要注意的简单事情，你不妨去做。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-11T21:27:50.263

"is" 基本上等同于 "isinst" IL 运算符——那篇文章将其描述为快速。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-11T21:28:23.773

它应该足够快，无所谓。如果您检查对象的类型足以使其对性能产生显着影响，您需要重新考虑您的设计

# python - 在 Python 中将 XML/HTML 实体转换为 Unicode 字符串

> ID：57708
> 
> 赞同：76
> 
> 时间：2008-09-11T21:28:46.940
> 
> 标签：python, html, entities

我正在做一些网页抓取，网站经常使用 HTML 实体来表示非 ascii 字符。Python 是否有一个实用程序可以接收带有 HTML 实体的字符串并返回 unicode 类型？

例如：

我回来了：

```
&#x01ce; 
```

代表一个带声调的“ǎ”。在二进制中，这表示为 16 位 01ce。我想将 html 实体转换为值 `u'\u01ce'`

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2008-09-12T01:40:41.390

Python 有[htmlentitydefs](https://docs.python.org/2/library/htmllib.html#module-htmlentitydefs)模块，但它不包括对 HTML 实体进行转义的函数。

Python 开发人员 Fredrik Lundh（elementtree 的作者等）[在他的网站上](http://effbot.org/zone/re-sub.htm#unescape-html)有这样一个函数，它适用于十进制、十六进制和命名实体：

```
import re, htmlentitydefs

##
# Removes HTML or XML character references and entities from a text string.
#
# @param text The HTML (or XML) source text.
# @return The plain text, as a Unicode string, if necessary.

def unescape(text):
    def fixup(m):
        text = m.group(0)
        if text[:2] == "&#":
            # character reference
            try:
                if text[:3] == "&#x":
                    return unichr(int(text[3:-1], 16))
                else:
                    return unichr(int(text[2:-1]))
            except ValueError:
                pass
        else:
            # named entity
            try:
                text = unichr(htmlentitydefs.name2codepoint[text[1:-1]])
            except KeyError:
                pass
        return text # leave as is
    return re.sub("&#?\w+;", fixup, text) 
```

* * *

## 回答 #2

> 赞同：60
> 
> 时间：2012-09-27T05:34:44.200

标准库自己的 HTMLParser 有一个未记录的函数 unescape() ，它完全按照你的想法做：

直到 Python 3.4：

```
import HTMLParser
h = HTMLParser.HTMLParser()
h.unescape('&copy; 2010') # u'\xa9 2010'
h.unescape('&#169; 2010') # u'\xa9 2010' 
```

Python 3.4+：

```
import html
html.unescape('&copy; 2010') # u'\xa9 2010'
html.unescape('&#169; 2010') # u'\xa9 2010' 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-09-11T23:09:08.710

使用内置`unichr`- BeautifulSoup 不是必需的：

```
>>> entity = '&#x01ce'
>>> unichr(int(entity[3:],16))
u'\u01ce' 
```

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2014-12-11T14:12:00.520

如果您使用的是 Python 3.4 或更高版本，则可以简单地使用[`html.unescape`](https://docs.python.org/3.4/library/html.html#html.unescape)：

```
import html

s = html.unescape(s) 
```

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2012-02-09T18:55:48.347

另一种选择，如果你有 lxml：

```
>>> import lxml.html
>>> lxml.html.fromstring('&#x01ce').text
u'\u01ce' 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-09-11T21:52:28.833

您可以在这里找到答案——[从网页中获取国际字符？](https://stackoverflow.com/questions/53224/getting-international-characters-from-a-web-page#53246)

**编辑**：似乎`BeautifulSoup`不转换以十六进制形式编写的实体。可以修复：

```
import copy, re
from BeautifulSoup import BeautifulSoup

hexentityMassage = copy.copy(BeautifulSoup.MARKUP_MASSAGE)
# replace hexadecimal character reference by decimal one
hexentityMassage += [(re.compile('&#x([^;]+);'), 
                     lambda m: '&#%d;' % int(m.group(1), 16))]

def convert(html):
    return BeautifulSoup(html,
        convertEntities=BeautifulSoup.HTML_ENTITIES,
        markupMassage=hexentityMassage).contents[0].string

html = '<html>&#x01ce;&#462;</html>'
print repr(convert(html))
# u'\u01ce\u01ce' 
```

**编辑**：

[`unescape()`](http://effbot.org/zone/re-sub.htm#unescape-html)[@dF](https://stackoverflow.com/questions/57708/convert-xml-html-entities-into-unicode-string-in-python/58125#58125)提到的函数使用 `htmlentitydefs`标准模块，`unichr()`在这种情况下可能更合适。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-02-21T19:45:58.123

这是一个可以帮助您正确处理并将实体转换回 utf-8 字符的函数。

```
def unescape(text):
   """Removes HTML or XML character references 
      and entities from a text string.
   @param text The HTML (or XML) source text.
   @return The plain text, as a Unicode string, if necessary.
   from Fredrik Lundh
   2008-01-03: input only unicode characters string.
   http://effbot.org/zone/re-sub.htm#unescape-html
   """
   def fixup(m):
      text = m.group(0)
      if text[:2] == "&#":
         # character reference
         try:
            if text[:3] == "&#x":
               return unichr(int(text[3:-1], 16))
            else:
               return unichr(int(text[2:-1]))
         except ValueError:
            print "Value Error"
            pass
      else:
         # named entity
         # reescape the reserved characters.
         try:
            if text[1:-1] == "amp":
               text = "&amp;amp;"
            elif text[1:-1] == "gt":
               text = "&amp;gt;"
            elif text[1:-1] == "lt":
               text = "&amp;lt;"
            else:
               print text[1:-1]
               text = unichr(htmlentitydefs.name2codepoint[text[1:-1]])
         except KeyError:
            print "keyerror"
            pass
      return text # leave as is
   return re.sub("&#?\w+;", fixup, text) 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-12-14T11:52:26.177

不知道为什么堆栈溢出线程不包含';' 在搜索/替换中（即 lambda m: '&#%d* *;* *'） 39 停电）。

这对我来说效果更好：

```
import re
from BeautifulSoup import BeautifulSoup

html_string='<a href="/cgi-bin/article.cgi?f=/c/a/2010/12/13/BA3V1GQ1CI.DTL"title="">&#x27;Blackout in a can; on some shelves despite ban</a>'

hexentityMassage = [(re.compile('&#x([^;]+);'), 
lambda m: '&#%d;' % int(m.group(1), 16))]

soup = BeautifulSoup(html_string, 
convertEntities=BeautifulSoup.HTML_ENTITIES, 
markupMassage=hexentityMassage) 
```

1.  int(m.group(1), 16) 将数字（以 base-16 指定）格式转换回整数。
2.  m.group(0) 返回整个匹配，m.group(1) 返回正则表达式捕获组
3.  基本上使用 markupMessage 是一样的：
    html_string = re.sub('&#x([^;]+);', lambda m: '&#%d;' % int(m.group(1), 16) , html_string)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-11-02T20:28:35.620

另一个解决方案是内置库 xml.sax.saxutils（用于 html 和 xml）。但是，它只会转换 >、& 和 <。

```
from xml.sax.saxutils import unescape

escaped_text = unescape(text_to_escape) 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-12-25T13:55:16.170

这是[dF 答案](https://stackoverflow.com/a/58125/2086547)的 Python 3 版本：

```
import re
import html.entities

def unescape(text):
    """
    Removes HTML or XML character references and entities from a text string.

    :param text:    The HTML (or XML) source text.
    :return:        The plain text, as a Unicode string, if necessary.
    """
    def fixup(m):
        text = m.group(0)
        if text[:2] == "&#":
            # character reference
            try:
                if text[:3] == "&#x":
                    return chr(int(text[3:-1], 16))
                else:
                    return chr(int(text[2:-1]))
            except ValueError:
                pass
        else:
            # named entity
            try:
                text = chr(html.entities.name2codepoint[text[1:-1]])
            except KeyError:
                pass
        return text # leave as is
    return re.sub("&#?\w+;", fixup, text) 
```

主要的变化关注`htmlentitydefs`的是现在`html.entities`和`unichr`现在`chr`。请参阅此[Python 3 移植指南](http://docs.pythonsprints.com/python3_porting/py-porting.html#reorganization)。

# asp.net-mvc - ASP.NET MVC 和 IIS 5

> ID：57712
> 
> 赞同：25
> 
> 时间：2008-09-11T21:30:50.740
> 
> 标签：asp.net-mvc, iis, shared-hosting

在 IIS 5（6 或 7）上托管 ASP.NET MVC 应用程序的最佳方法是什么。当我尝试发布我的 ASP.NET MVC 应用程序时，我似乎得到的只是 404 错误。我做了一些谷歌搜索并找到了几个解决方案，但看起来都不是超级优雅，我担心一旦我开始为应用程序使用共享托管环境，它们是否会无法使用。

[解决方案 1](http://blogs.microsoft.co.il/blogs/dorony/archive/2007/12/15/using-asp-net-mvc-on-iis-5.aspx)

> 1.  右键单击 inetmgr.exe 上的应用程序虚拟目录。
> 2.  属性-> 虚拟目录选项卡-> 配置。
> 3.  添加新的映射扩展。扩展名应该是 .*，它将被映射到可执行文件 C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\aspnet_isapi.dll 或您计算机上的适当位置（您可以简单地从映射中复制它.aspx 文件）。在映射上取消选中“检查文件是否存在”。
> 4.  3 X OK，你就可以走了。
> 5.  如果需要，您可以将此设置应用于您的所有网站。在第 1 步中，单击“默认网站”节点而不是您自己的虚拟目录，在第 2 步中转到“主目录”选项卡。其余的都是一样的。

通过 ASP.NET 路由所有内容似乎有点笨拙。

[解决方案 2](http://blog.pagedesigners.co.nz/?p=29)

编辑 MVC 路由以在 URL 中包含 .mvc，然后按照基于此扩展的解决方案 1 中的步骤进行操作。*编辑：原始图片链接已丢失，但此处来自 Google 的缓存：*

![替代文字](https://i.stack.imgur.com/TDp4F.png)

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-11T21:45:41.470

答案在[这里](http://forums.asp.net/p/1239943/2294813.aspx)

> 如果 *.mvc 扩展名没有注册到主机，它会给出 404 异常。在这种情况下托管 MVC 应用程序的工作方式是通过以下方式修改 global.asax 路由 caluse。
> 
> routes.Add(new Route("{controller}.mvc.aspx/{action}", new MvcRouteHandler()) { Defaults = new RouteValueDictionary (new{ controller = "YourController"} ) });
> 
> 这样，您的所有控制器请求都将以 *.mvc.aspx 结尾，您的主机可以识别该文件。由于 MVC dll 被复制到您的本地 bin 中，因此无需对其进行特殊设置。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-11T21:46:00.813

我认为**无论哪种方式，您都必须执行解决方案 1**。

考虑 HTTP 请求管道。

1.  一个请求进入 IIS。
2.  IIS 检查端口/主机标头以查看它是否设置了一个网站来捕获对该主机标头/端口的请求。
3.  **IIS 调查请求的文件扩展名（.php、.asp、.aspx）并将其交给可以处理该类型请求的 ISAPI。**

**只有在这一点上，ASP.NET（或 PHP 运行时）才会启动。**如果 IIS 没有该映射，那么它永远不会将请求传递给 ASP.NET 运行时，并且请求永远不会到达您的代码。这就是您需要将 glob (*) 映射到 ASP.NET ISAPI 的原因。

ASP.NET MVC 框架 url 通常以根本没有文件扩展名结尾。如果您希望这些请求由 ASP.NET（或其他一些运行时）处理，则必须将所有请求映射到该 ISAPI（即 aspnet_isapi.dll），而不管文件扩展名如何。

这通常也适用于需要服务于 .jpg、.gif 等媒体的 HttpHandler。对于要命中的处理程序，即使 .jpg 不是“正常”的 ASP.NET 文件扩展名，它也需要映射到您的代码。

HTH，
泰勒

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-11-08T01:56:26.513

运行：C:\WINDOWS\Microsoft.NET\Framework\v4.0.30319\aspnet_isapi.dll -i

这将为 aspnet 用户重置 IIS 注册表设置。

创建虚拟目录： 1\. 右键单击​​要转换的目录

*   选择属性
    1.  在目录下，选择创建。
    2.  在配置下，选择添加。
    3.  对于可执行插入：

C:\WINDOWS\Microsoft.NET\Framework\v4.0.30319\aspnet_isapi.dll

对于扩展插入：.*

*   取消选中“检查文件是否存在”</p>

*   在 Documents 下添加入口点文件，即：Default.htm、index.htm、Global.asax

*   在目录设置下

    1.  选择编辑...
    2.  选择匿名访问
    3.  取消选中允许 IIS 控制密码
    4.  取消选中基本身份验证
    5.  取消选中集成 Windows 身份验证
    6.  在 ASP.NET 下，确保版本 = v4.0.30319

注意用户名，即：IUSR_AVSJ82S

设置物理目录的共享权限：

*   在 Windows 资源管理器中，转到已转换为虚拟目录的物理目录。右键单击目录名称
*   选择属性
*   在安全选项卡下，选择添加
*   输入 IIS 用户名，即：IUSR_AVSJ82S 单击检查名称。
*   点击确定
*   将权限设置为读取和写入。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T21:35:32.197

您是否尝试将 .aspx 添加到控制器名称的末尾？

它适用于 Stack Overflow 问题*[我在哪里可以获得 ASP.NET MVC 托管？](https://stackoverflow.com/questions/32757/where-can-i-get-asp-mvc-hosting)*.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-15T17:57:03.873

仅供参考：在服务器 2003 上（开发一个必须连接到 RPS 的应用程序），它不允许我添加扩展名 .*，我使用了修改路由子句的替代解决方案，并且有效。

# .net - 任何人使用实体框架*好吧*？

> ID：57718
> 
> 赞同：12
> 
> 时间：2008-09-11T21:32:50.393
> 
> 标签：.net, entity-framework, orm, ado.net

有没有人真正发布了一个实体框架项目，该项目将 O/R 映射到与数据存储中的表完全不同的概念类？

我的意思是将连接 (M:M) 表折叠到其他实体中，以形成存在于业务域中但在数据存储中组织为**多个表的****概念**类。我在 MSDN 上看到的所有示例都很少使用继承、将联结表折叠成其他实体或将查找表折叠成实体。

 **我很想听听或查看以下示例，这些示例支持您通常希望在业务对象上执行的所有 CRUD 操作。：

1.  车辆表和颜色表。一种颜色可以出现在许多车辆中 (1:M)。它们形成了具有属性 Color 的概念类 UsedCar。

2.  Doctor、DoctorPatients 和 Patients 表（形成多对多）。医生有很多患者，患者可以有很多医生（M:M）。绘制出两个概念类Doctor（具有Patients 集合）和Patients（具有Doctors 集合）。

**有人在实体框架中使用 CSDL 和 SSDL 看到/做过这个吗？如果 CSDL 没有实际映射到任何东西，它就不好了！**

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-12T01:49:31.587

我尝试在现有项目（约 60 个表，3 个具有继承性）上使用实体框架，只是为了了解它的全部内容。我的经验归结为：

设计师的表面很笨拙。映射不直观，一定有人认为同时打开多个工具窗口是可以接受的。手动创建一个对象并映射正确的字段需要很长时间——然后从代码中与它交谈仍然很奇怪。虽然有一些东西来处理数据库通信是必不可少的，*但我觉得将控制权交给 EF 比手动完成要困难得多*。

有时，在您重新启动 Visual Studio 之前，设计器不会加载。我确定这只是一个错误，但重新启动 VS 很烦人。

你所有的工作最终都在一个文件中，我不想合并多个开发者版本。

生成的 SQL（通过 Profiler 观察）不是很好。我并没有真正深入研究原因，但你会被迫在第一次尝试时写出更糟糕的东西。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-18T01:17:55.293

[实体框架 - 不信任投票](http://efvote.wufoo.com/forms/ado-net-entity-framework-vote-of-no-confidence/)

这就是我要说的...

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-12T02:20:10.123

你的意思是这样吗？

```
<edmx:ConceptualModels>
  <Schema xmlns="http://schemas.microsoft.com/ado/2006/04/edm" Namespace="Model1" Alias="Self">
    <EntityContainer Name="Model1Container" >
      <EntitySet Name="ColorSet" EntityType="Model1.Color" />
      <EntitySet Name="DoctorSet" EntityType="Model1.Doctor" />
      <EntitySet Name="PatientSet" EntityType="Model1.Patient" />
      <EntitySet Name="UsedCarSet" EntityType="Model1.UsedCar" />
      <AssociationSet Name="Vehicle_Color" Association="Model1.Vehicle_Color">
        <End Role="Colors" EntitySet="ColorSet" />
        <End Role="Vehicles" EntitySet="UsedCarSet" /></AssociationSet>
      <AssociationSet Name="DoctorPatient" Association="Model1.DoctorPatient">
        <End Role="Doctor" EntitySet="DoctorSet" />
        <End Role="Patient" EntitySet="PatientSet" /></AssociationSet>
      </EntityContainer>
    <EntityType Name="Color">
      <Key>
        <PropertyRef Name="ColorID" /></Key>
      <Property Name="ColorID" Type="Int32" Nullable="false" />
      <NavigationProperty Name="Vehicles" Relationship="Model1.Vehicle_Color" FromRole="Colors" ToRole="Vehicles" /></EntityType>
    <EntityType Name="Doctor">
      <Key>
        <PropertyRef Name="DoctorID" /></Key>
      <Property Name="DoctorID" Type="Int32" Nullable="false" />
      <NavigationProperty Name="Patients" Relationship="Model1.DoctorPatient" FromRole="Doctor" ToRole="Patient" /></EntityType>
    <EntityType Name="Patient">
      <Key>
        <PropertyRef Name="PatientID" /></Key>
      <Property Name="PatientID" Type="Int32" Nullable="false" />
      <NavigationProperty Name="Doctors" Relationship="Model1.DoctorPatient" FromRole="Patient" ToRole="Doctor" />
      </EntityType>
    <EntityType Name="UsedCar">
      <Key>
        <PropertyRef Name="VehicleID" /></Key>
      <Property Name="VehicleID" Type="Int32" Nullable="false" />
      <NavigationProperty Name="Color" Relationship="Model1.Vehicle_Color" FromRole="Vehicles" ToRole="Colors" /></EntityType>
    <Association Name="Vehicle_Color">
      <End Type="Model1.Color" Role="Colors" Multiplicity="1" />
      <End Type="Model1.UsedCar" Role="Vehicles" Multiplicity="*" /></Association>
    <Association Name="DoctorPatient">
      <End Type="Model1.Doctor" Role="Doctor" Multiplicity="*" />
      <End Type="Model1.Patient" Role="Patient" Multiplicity="*" /></Association>
    </Schema>
</edmx:ConceptualModels> 
```

# html - 如何在 HTML/CSS 中仅显示图像的一部分？

> ID：57725
> 
> 赞同：164
> 
> 时间：2008-09-11T21:35:44.567
> 
> 标签：html, css, image

假设我想要一种仅在 HTML 中显示 250x250 像素的图像的中心 50x50 像素的方法。我怎样才能做到这一点。另外，有没有办法为 css:url() 引用做到这一点？

我知道 CSS 中的*剪辑*，但这似乎只在与绝对定位一起使用时才有效。

* * *

## 回答 #1

> 赞同：180
> 
> 时间：2011-01-09T15:00:58.073

正如问题中提到的，有[`clip`](http://www.w3.org/TR/CSS21/visufx.html#clipping)css 属性，尽管它*确实*要求被剪辑的元素是`position: absolute;`（这是一个耻辱）：

```
.container {
  position: relative;
}
#clip {
  position: absolute;
  clip: rect(0, 100px, 200px, 0);
  /* clip: shape(top, right, bottom, left); NB 'rect' is the only available option */
}
```

```
<div class="container">
  <img src="http://lorempixel.com/200/200/nightlife/3" />
</div>
<div class="container">
  <img id="clip" src="http://lorempixel.com/200/200/nightlife/3" />
</div>
```

[JS Fiddle 演示](http://jsfiddle.net/davidThomas/ygds2eeu/)，用于实验。

为了补充最初的答案——有点晚了——我正在编辑以显示 的用法`clip-path`，它已经取代了现在已弃用的`clip`属性。

该`clip-path`属性允许一系列选项（比原来的更多`clip`），包括：

*   `inset`— 矩形/长方体形状，用四个值定义为 'distance-from' `(top right bottom left)`。
*   `circle`— `circle(diameter at x-coordinate y-coordinate)`.
*   `ellipse`— `ellipse(x-axis-length y-axis-length at x-coordinate y-coordinate)`.
*   `polygon`— 由与元素左上角原点相关的一系列`x`/坐标定义。`y`由于路径自动关闭，多边形的实际最小点数应该是三个，任何更少（两个）是一条线或（一个）是一个点：`polygon(x-coordinate1 y-coordinate1, x-coordinate2 y-coordinate2, x-coordinate3 y-coordinate3, [etc...])`。
*   `url`— 这可以是本地 URL（使用 CSS id-selector）或外部文件的 URL（使用文件路径）来识别 SVG，尽管我还没有尝试过任何一个（目前），所以我不能提供关于它们的好处或警告的见解。

```
div.container {
  display: inline-block;
}
#rectangular {
  -webkit-clip-path: inset(30px 10px 30px 10px);
  clip-path: inset(30px 10px 30px 10px);
}
#circle {
  -webkit-clip-path: circle(75px at 50% 50%);
  clip-path: circle(75px at 50% 50%)
}
#ellipse {
  -webkit-clip-path: ellipse(75px 50px at 50% 50%);
  clip-path: ellipse(75px 50px at 50% 50%);
}
#polygon {
  -webkit-clip-path: polygon(50% 0, 100% 38%, 81% 100%, 19% 100%, 0 38%);
  clip-path: polygon(50% 0, 100% 38%, 81% 100%, 19% 100%, 0 38%);
}
```

```
<div class="container">
  <img id="control" src="http://lorempixel.com/150/150/people/1" />
</div>
<div class="container">
  <img id="rectangular" src="http://lorempixel.com/150/150/people/1" />
</div>
<div class="container">
  <img id="circle" src="http://lorempixel.com/150/150/people/1" />
</div>
<div class="container">
  <img id="ellipse" src="http://lorempixel.com/150/150/people/1" />
</div>
<div class="container">
  <img id="polygon" src="http://lorempixel.com/150/150/people/1" />
</div>
```

[JS Fiddle 演示](http://jsfiddle.net/davidThomas/36tg0one/)，用于实验。

参考：

*   ~~[`clip`](https://developer.mozilla.org/en-US/docs/Web/CSS/clip)~~— 注意：**已弃用**。
*   [`clip-path`（MDN）](https://developer.mozilla.org/en-US/docs/Web/CSS/clip-path)。
*   [`clip-path`(W3C)](http://dev.w3.org/fxtf/css-masking-1/#the-clip-path)。

* * *

## 回答 #2

> 赞同：125
> 
> 时间：2008-09-11T21:37:29.007

一种方法是将要显示的图像设置为容器（td、div、span 等）中的背景，然后调整背景位置以获得所需的精灵。

* * *

## 回答 #3

> 赞同：43
> 
> 时间：2014-04-22T13:21:50.340

另一种选择如下，虽然不是最干净的，因为它假设图像是容器中的唯一元素，例如在这种情况下：

```
<header class="siteHeader">
  <img src="img" class="siteLogo" />
</header> 
```

然后，您可以将容器用作具有所需大小的蒙版，并用负边距包围图像以将其移动到正确的位置：

```
.siteHeader{
    width: 50px;
    height: 50px;
    overflow: hidden;
}

.siteHeader .siteLogo{
    margin: -100px;
} 
```

演示可以在[这个 JSFiddle](http://jsfiddle.net/m3P44/)中看到。

似乎只在 IE>9 中工作，并且可能在所有其他浏览器的所有重要版本中工作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2020-09-15T09:19:58.213

调整 background-position 以将背景图像移动到 的不同位置`div`：

```
div { 
  background-image: url('image url');
  background-position: 0 -250px; 
} 
```

# version-control - 管理构建版本的最佳构建过程解决方案

> ID：57730
> 
> 赞同：4
> 
> 时间：2008-09-11T21:40:05.383
> 
> 标签：version-control, msbuild, build-process, cruisecontrol.net

我运行一个包含多个独立应用程序的相当复杂的项目。然而，这些使用了几个共享组件。所以我有一个类似于下面的源代码树。

*   我的项目
    *   应用 A
    *   共享1
    *   共享2
    *   应用 B
    *   应用 C

所有应用程序都有自己的 MSBuild 脚本，用于构建项目及其所需的所有共享资源。我还在 CruiseControl 控制的持续集成构建服务器上运行这些构建。

部署应用程序时，它们会部署在多台服务器上以分配负载。这意味着跟踪每个不同服务器上部署的构建/修订版本*非常重要（我们需要在 DLL 版本中包含当前版本，例如“1.0.0.68”）。*

同样重要的是能够重新创建一个已构建的修订/构建，以便在某些事情没有按预期工作时能够回滚（哦，是的，那发生了......）。今天我们使用 SourceSafe 进行源代码控制，但如果我们能提出充分的理由，这可能会改变（SS，到目前为止它实际上对我们来说工作正常*）*。

我们尝试遵循的另一个原则是，只有由我们进一步部署的集成服务器构建和测试的代码。

## “CrusieControl 构建标签”解决方案

我们对解决上述问题有几个想法。第一个是让持续集成服务器构建并在本地部署项目并对其进行测试（现在可以这样做）。您可能知道 CruiseControl 中的成功构建会生成一个构建标签，我想我们可以用它来设置可执行文件的 DLL 版本（所以构建标签 35 会创建一个类似“1.0.0.35”的 DLL）？这个想法也是使用这个构建标签来标记**完整**的源代码树。然后我们可能可以通过该标签检查并稍后重新创建构建。

标记完整树的原因是不仅包括实际的应用程序代码（位于源代码树中的一个位置），还包括所有共享项（位于树中的不同位置）。因此，“Application A”的成功构建将使用标签“ApplicationA35”标记整个树。

但是，在部署之前尝试重新创建此构建并设置 DLL 版本时可能会出现问题，因为我们将无法再访问 CruiseControl 生成的构建标签。如果所有项目的所有 CrusieControl 构建标签都是唯一的，我们可以只使用编号进行标签，但情况并非如此（应用程序 A 和 B 可以同时在构建 35 上）所以我们必须在标签。因此 SourceSafe 标签为“Application35”。**一旦我们构建了构建 35，我如何重新创建构建 34 并将 1.0.0.34 设置为 DLL 版本号？**

## “修订号”解决方案

有人告诉我，例如 Subversion 会在每次签入时为整个源代码树创建一个修订号——**是这样吗？SourceSafe 有类似的东西吗？**如果这是正确的，那么想法是在获取最新版本时获取该修订号并在 CruiseControl 服务器上构建。然后可以使用修订号来设置 DLL 版本号（例如“1.0.0.5678”）。我想如果需要，我们可以为 Subversion 获得这个特定的修订，然后将包括该应用程序和所有共享项目，以便能够从过去重新创建特定版本。**这会起作用吗？这是否也可以使用 SourceSafe 来实现？**

## 总结

所以两个主要要求是：

1.  能够**跟踪构建和部署的 DLL 的构建/修订号。**
2.  能够**重建过去的修订/构建，在该构建的可执行文件上设置旧的构建/修订号**（以符合要求 1）。

**那么你将如何解决这个问题？**您首选的方法是什么，您将**如何**解决它（或者您有完全不同的想法？）？**请给出详细答案。**

*奖励问题*修订号和内部版本号之间有什么区别，什么时候真正需要两者？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-12T00:47:55.197

您的方案在 VSS 中是合理且可实现的（尽管我建议您考虑替代方案，VSS 确实是一个过时的产品）。

对于您的“CI”构建 - 您将执行版本控制，查看具有“版本”任务的[MSBuild 社区任务项目。](http://msbuildtasks.tigris.org/)通常，您的源代码树中有一个“Version.txt”，MSBuild 任务将增加“发布”编号，而开发人员控制 Major.Minor.Release.Revision 编号（这就是我的客户想要的方式）。如果您愿意，可以使用修订版。

然后，您将有一个“FileUpdate”任务来编辑具有该版本的 AssemblyInfo.cs 文件，并且您的 EXE 和“DLL”将具有所需的版本。

最后，VSSLabel 任务将适当地标记您的所有文件。

对于您的“重建”构建 - 您将修改您的“获取”以从该标签获取文件，显然不执行“版本”任务（因为您正在选择要构建的版本）然后 FileUpdate 任务将使用该版本号。

奖金问题：

这些都是“你想如何使用它们” - 我会使用内部版本号，以及内部版本号，这就是我要增加的。如果您使用 CI，您将拥有非常多的构建 - 绝大多数都不打算在任何地方部署。

主要和次要是不言而喻的 - 但我一直将修订用于“修补程序”指标。我打算发布一个“1.3”版本——这实际上是一个带有 1.3.1234.0 版本的产品。在 1.4 上工作时 - 我发现了一个错误 - 需要一个 1.3.2400.1 的热修复。然后当 1.4 准备好时 - 会说 1.4.3500.0

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-12T21:36:13.607

我需要比回复更多的空间，因为评论直接允许...

> 谢谢！好答案！有什么区别，例如使用 SubVersion 更好地解决这个问题？Richard Hallgren（15 小时前）

VSS 的问题与此示例无关（尽管我认为“标签”功能的实现效率低下......）

以下是 VSS 的一些问题

1) 分支基本上是不可能的 2) 通常不使用共享结帐（我知道有几个人已经成功了） 3) 性能很差 - 它非常“健谈” 4) 除非你有一个非常小的存储库- 这完全不可靠，对于大多数商店来说，这是一颗定时炸弹。

对于 4 - 问题是 VSS 是由在文件系统中表示为“平面文件”的整个存储库实现的。当存储库超过一定大小时（我相信 4GB，但我对这个数字没有信心），你就有机会“腐败”。随着规模的增加，腐败的机会也在增加，直到几乎可以确定。

所以看看你的存储库大小——如果你进入千兆字节——我强烈建议你开始计划更换 VSS。

无论如何-“VSS Sucks”的谷歌提供了 30K 次点击...我认为如果您确实开始使用替代品-您会意识到这是非常值得的努力。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-23T07:28:30.687

1.  让 CC.net 标记成功的构建
2.  将解决方案中的每个项目链接到一个通用的 solutioninfo.cs 文件，该文件包含程序集和文件版本属性（从每个项目的 assemblyinfo.cs 中删除）
3.  在构建之前，巡航控制运行 msbuild 正则表达式替换（来自 msbuild 社区任务）以使用 cc.net 构建标签更新版本信息（作为参数传递给 msbuild 任务）
4.  构建解决方案、运行测试、fx cop 等
5.  可选择还原解决方案信息文件

结果是 cc.net 发布的构建中的所有程序集都具有相同的版本号，这些版本号符合源代码存储库中的标签

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-16T18:17:27.670

UppercuT 可以通过自定义打包任务来拆分应用程序来完成所有这些工作。要获取源代码的版本号，您可能会考虑 Subversion。

它也非常容易上手。

[http://code.google.com/p/uppercut/](http://code.google.com/p/uppercut/)

这里有一些很好的解释：[Uppercut](http://ferventcoder.com/category/uppercut.aspx)

# sql-server-2005 - 从 .NET 应用程序到 SQL Server 的偶尔缓慢的调用

> ID：57731
> 
> 赞同：3
> 
> 时间：2008-09-11T21:41:10.870
> 
> 标签：sql-server-2005, data-retrieval

我在 SQL Server 中有一个表，它是从仍在生产中的遗留系统继承而来的，该系统根据以下代码构建。我创建了一个 SP 来查询表，如表创建语句下方的代码中所述。我的问题是，通过 Enterprise Library 4 和 DataReader 对象从 .NET 到此 SP 的调用偶尔会很慢。SP 通过数据层中的循环结构调用，该结构指定进入 SP 以填充用户对象的参数。值得一提的是，不会在每次通过循环结构时都进行慢速调用。它通常会在一天或更长时间的大部分时间里都很好，然后开始展示，这使得调试变得非常困难。

有问题的表包含大约 500 万行。例如，缓慢的调用将需要长达 10 秒的时间，而快速的调用平均需要 0 到 10 毫秒。我在慢速调用期间检查了锁定/阻塞事务，没有找到。我在数据层创建了一些自定义性能计数器来监控调用时间。从本质上讲，当性能很差时，这对那个电话来说真的很糟糕。但是当它很好时，它真的很好。我已经能够在几台不同的开发人员机器上重现该问题，但不能在我们的开发和暂存数据库服务器上重现，这些服务器当然具有更强大的硬件。通常，通过重新启动 SQL Server 服务可以解决问题，但并非总是如此。表上有我正在查询的字段的索引，但是有比我想要的更多的索引。但是，由于它可能对遗留系统产生影响，我不愿删除任何索引或玩具。以前有没有人遇到过这样的问题，或者您有解决方法的建议吗？

```
CREATE TABLE [dbo].[product_performance_quarterly](
    [performance_id] [int] IDENTITY(1,1) NOT FOR REPLICATION NOT NULL,
    [product_id] [int] NULL,
    [month] [int] NULL,
    [year] [int] NULL,
    [performance] [decimal](18, 6) NULL,
    [gross_or_net] [char](15) NULL,
    [vehicle_type] [char](30) NULL,
    [quarterly_or_monthly] [char](1) NULL,
    [stamp] [datetime] NULL CONSTRAINT [DF_product_performance_quarterly_stamp]  DEFAULT (getdate()),
    [eA_loaded] [nchar](10) NULL,
    [vehicle_type_id] [int] NULL,
    [yearmonth] [char](6) NULL,
    [gross_or_net_id] [tinyint] NULL,
 CONSTRAINT [PK_product_performance_quarterly_4_19_04] PRIMARY KEY CLUSTERED 
(
    [performance_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON, FILLFACTOR = 80) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
ALTER TABLE [dbo].[product_performance_quarterly]  WITH NOCHECK ADD  CONSTRAINT [FK_product_performance_quarterlyProduct_id] FOREIGN KEY([product_id])
REFERENCES [dbo].[products] ([product_id])
GO
ALTER TABLE [dbo].[product_performance_quarterly] CHECK CONSTRAINT [FK_product_performance_quarterlyProduct_id]

CREATE PROCEDURE [eA.Analytics.Calculations].[USP.GetCalculationData]
(
    @PRODUCTID INT,                     --products.product_id
    @BEGINYEAR INT,                     --year to begin retrieving performance data
    @BEGINMONTH INT,                    --month to begin retrieving performance data
    @ENDYEAR INT,                       --year to end retrieving performance data
    @ENDMONTH INT,                      --month to end retrieving performance data
    @QUARTERLYORMONTHLY VARCHAR(1),     --do you want quarterly or monthly data?
    @VEHICLETYPEID INT,                 --what product vehicle type are you looking for?
    @GROSSORNETID INT                   --are your looking gross of fees data or net of fees data?
)
AS
BEGIN

    SET NOCOUNT ON

    DECLARE @STARTDATE VARCHAR(6),
            @ENDDATE   VARCHAR(6),
            @vBEGINMONTH VARCHAR(2),
            @vENDMONTH VARCHAR(2)   

IF LEN(@BEGINMONTH) = 1 
    SET @vBEGINMONTH = '0' + CAST(@BEGINMONTH AS VARCHAR(1))
ELSE
    SET @vBEGINMONTH = @BEGINMONTH

IF LEN(@ENDMONTH) = 1
    SET @vENDMONTH = '0' + CAST(@ENDMONTH AS VARCHAR(1))
ELSE
    SET @vENDMONTH = @ENDMONTH

SET @STARTDATE = CAST(@BEGINYEAR AS VARCHAR(4)) + @vBEGINMONTH
SET @ENDDATE = CAST(@ENDYEAR AS VARCHAR(4)) + @vENDMONTH

--because null values for gross_or_net_id and vehicle_type_id are represented in 
--multiple ways (true null, empty string, or 0) in the PPQ table, need to account for all possible variations if 
--a -1 is passed in from the .NET code, which represents an enumerated value that
--indicates that the value(s) should be true null.

IF @VEHICLETYPEID = '-1' AND @GROSSORNETID = '-1'
    SELECT
        PPQ.YEARMONTH, PPQ.PERFORMANCE
    FROM PRODUCT_PERFORMANCE_QUARTERLY PPQ
        WITH (NOLOCK)
    WHERE 
        (PPQ.PRODUCT_ID = @PRODUCTID)
        AND (PPQ.YEARMONTH BETWEEN @STARTDATE AND @ENDDATE)
        AND (PPQ.QUARTERLY_OR_MONTHLY = @QUARTERLYORMONTHLY)
        AND (PPQ.VEHICLE_TYPE_ID IS NULL OR PPQ.VEHICLE_TYPE_ID = '0' OR PPQ.VEHICLE_TYPE_ID = '')
        AND (PPQ.GROSS_OR_NET_ID IS NULL OR PPQ.GROSS_OR_NET_ID = '0' OR PPQ.GROSS_OR_NET_ID = '')
    ORDER BY PPQ.YEARMONTH ASC

IF @VEHICLETYPEID <> '-1' AND @GROSSORNETID <> '-1'
    SELECT
        PPQ.YEARMONTH, PPQ.PERFORMANCE
    FROM PRODUCT_PERFORMANCE_QUARTERLY PPQ
        WITH (NOLOCK)
    WHERE 
        (PPQ.PRODUCT_ID = @PRODUCTID)
        AND (PPQ.YEARMONTH BETWEEN @STARTDATE AND @ENDDATE)
        AND (PPQ.QUARTERLY_OR_MONTHLY = @QUARTERLYORMONTHLY)
        AND (PPQ.VEHICLE_TYPE_ID = @VEHICLETYPEID )
        AND (PPQ.GROSS_OR_NET_ID = @GROSSORNETID)
    ORDER BY PPQ.YEARMONTH ASC

IF @VEHICLETYPEID = '-1' AND @GROSSORNETID <> '-1'
    SELECT
        PPQ.YEARMONTH, PPQ.PERFORMANCE
    FROM PRODUCT_PERFORMANCE_QUARTERLY PPQ
        WITH (NOLOCK)
    WHERE 
        (PPQ.PRODUCT_ID = @PRODUCTID)
        AND (PPQ.YEARMONTH BETWEEN @STARTDATE AND @ENDDATE)
        AND (PPQ.QUARTERLY_OR_MONTHLY = @QUARTERLYORMONTHLY)
        AND (PPQ.VEHICLE_TYPE_ID IS NULL OR PPQ.VEHICLE_TYPE_ID = '0' OR PPQ.VEHICLE_TYPE_ID = '')
        AND (PPQ.GROSS_OR_NET_ID = @GROSSORNETID)
    ORDER BY PPQ.YEARMONTH ASC

IF @VEHICLETYPEID <> '-1' AND @GROSSORNETID = '-1'
    SELECT
        PPQ.YEARMONTH, PPQ.PERFORMANCE
    FROM PRODUCT_PERFORMANCE_QUARTERLY PPQ
        WITH (NOLOCK)
    WHERE 
        (PPQ.PRODUCT_ID = @PRODUCTID)
        AND (PPQ.YEARMONTH BETWEEN @STARTDATE AND @ENDDATE)
        AND (PPQ.QUARTERLY_OR_MONTHLY = @QUARTERLYORMONTHLY)
        AND (PPQ.VEHICLE_TYPE_ID = @VEHICLETYPEID)
        AND (PPQ.GROSS_OR_NET_ID IS NULL OR PPQ.GROSS_OR_NET_ID = '0' OR PPQ.GROSS_OR_NET_ID = '')
    ORDER BY PPQ.YEARMONTH ASC

END 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-11T21:54:14.287

我已经看到过时的索引会发生这种情况。它也可能是参数嗅探问题，其中不同的查询计划被用于进入存储过程的不同参数。

您应该捕获慢速调用的参数，并在每次运行缓慢时查看它们是否相同。

您也可以尝试运行调整向导，看看它是否推荐任何索引。

在您可以证明更新和插入发生得太慢（修改索引加上锁定/争用所需的时间）或者您的磁盘空间不足之前，您不想担心索引过多。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-22T04:44:30.417

似乎这是两件事之一 - 慢速调用的参数在某种程度上与快速调用的参数不同，并且它们也无法使用索引，或者存在某种类型的锁定争用让你向上。您说您在特定进程挂起时检查了阻塞锁，但没有看到 - 这表明它是第一个。但是 - 您确定您的登台服务器（您无法在其上重现此错误）和开发服务器（您可以在其上重现此错误）具有相同的数据库配置吗？例如，可能在生产中启用了“READ COMMITTED SNAPSHOT”，但在开发中未启用，这将导致读取争用问题在生产中消失。

如果参数不同，我建议使用 SQL Profiler 来观察事务并捕获一些事务 - 一些慢的和一些更快的，然后在 Management Studio 窗口中，用参数替换上面那个 SP 中的变量值，然后按“Control-L”获取执行计划。这将准确地告诉您 SQL Server 期望如何处理您的查询，并且您可以比较不同参数组合的执行计划，以查看一组是否存在差异，并从那里开始优化它。

祝你好运！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T21:46:42.027

听起来另一个查询正在后台运行，该查询已锁定表，而您无辜的查询只是在等待它完成

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-11T21:55:18.217

一个奇怪的边缘案例，但我最近遇到了它。

如果查询在应用程序中运行的时间比在 Management Studio 中运行的时间长，您可能需要检查以确保 Arithabort 已关闭。Management Studio 使用的连接参数与 .NET 使用的连接参数不同。

# asp.net - 使用通配符映射时 ASP.NET 表单身份验证超时的最佳解决方法是什么？

> ID：57739
> 
> 赞同：2
> 
> 时间：2008-09-11T21:45:51.047
> 
> 标签：asp.net, forms-authentication, wildcard-mapping

我的团队正在开发一个蹩脚的旧网站，大多数页面仍然是 ASP 经典。但是，我们最近迁移到使用 ASP.NET 和通配符映射的表单身份验证。除了一件事之外，一切都运行得非常好：登录用户超时太快了。在查看日志后，似乎人们正好在 20 分钟后超时（这是由于不活动而指定的超时）。

因此，我们的假设是 ASP 经典页面不会触发表单身份验证框架中重置非活动计时器的任何机制。我用谷歌搜索，甚至阅读了大顾的通配符映射帖子，但仍然找不到其他有这个问题的人。所以，1）你见过这个问题吗？和 2) 最好的解决方法是什么？（除了在每个在后台加载哑 .NET 页面的 janky ASP 页面中手动放置一个隐藏框架）

**更新**：*slidingExpiration*设置为*true*

**另外**：我们不能使用永久会话，因为我们需要应用程序在 20 分钟不活动后超时。此外，这个可怕的网站被编写成界面通常存储在页面中。没有一段简单的界面代码可以让 JavaScript 插入其中。我们试图将一些 js 放入一个包含文件中，该文件被我们大约 80% 的页面调用，但这会导致文件下载缓冲区出现一些深奥的问题，因此我们可能不得不尝试不同的策略。谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-11T21:56:27.747

**创建一个永久会话。**

本质上，您最终会在母版页或导航用户控件中发出一些 JavaScript 和图像标记（无论您使用什么来实现一致的导航）。此 JavaScript 在某个时间间隔内将图像标记的源更改为 http 处理程序端点（一些 .aspx、.ashx），该端点返回 1x1 像素清晰 gif 作为对图像的响应。不断的请求确保空闲页面将保持会话活动。

**只要浏览器窗口对您的页面打开，您的 ASP.NET 会话就永远不会超时。**

JavaScript 通常会在请求中添加一个随机数，这样浏览器就不会缓存请求。

一个不错的演练可以[在这里找到](http://www.codeproject.com/KB/aspnet/SessionForever.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-06T15:00:44.110

我假设您已经手动创建了 cookie，在这种情况下，您在代码中的超时值可能会覆盖您在配置中的超时值。

首先，如果可能（可能不是）不要手动创建 cookie，它不仅可以让您避免这种头痛，还可以避免其他许多问题。

如果您必须手动创建 cookie，请确保您使用的超时实际上是读取您在配置文件中设置的超时值，并且滑动到期设置为 true（您已经说过是这样）。

也就是说，当手动创建 cookie 时，我们仍然偶尔会遇到奇怪的超时问题。在我工作的地方，我们实施了一个解决方案，允许自动创建 cookie，超时不再是问题；但是，它确实产生了其他问题，我们被迫转回。

# tfs - 设置 Team Foundation 服务器

> ID：57747
> 
> 赞同：25
> 
> 时间：2008-09-11T21:53:51.807
> 
> 标签：tfs

我必须为一家公司设置团队基础服务器，我没有任何经验。

该公司将有大约 5 名左右的开发人员将使用它。

这是一项艰巨的任务还是相当容易做的事情（有说明）？
有什么有用的教程可以推荐吗？

对于 5-10 人的团队，服务器规格有什么建议吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-16T07:08:04.953

您的第一步应该是从这里下载最新的 TFS 安装指南 (TFSInstall.chm)：http: [//www.microsoft.com/downloads/details.aspx? FamilyID=FF12844F-398C-4FE9-8B0D-9E84181D9923&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=FF12844F-398C-4FE9-8B0D-9E84181D9923&displaylang=en)

您应该使用 TFS 2008 SP1，因为它是最新版本，包含许多新功能和性能改进。

如果您计划使用 Windows 2008 和 SQL 2008 进行安装，则需要将 TFS 2008 SP1“集成”到安装光盘中。说明包含在 TFSInstall.chm 中，但 Martin Woodward 在他的博客上也有一个演练： [http](http://www.woodwardweb.com/vsts/creating_a_tfs.html) ://www.woodwardweb.com/vsts/creating_a_tfs.html （这对于 SQL 2005 SP2 + Windows 2003 不是必需的）

安装指南还提供了硬件建议。

对于您这样规模的团队，您还应该考虑将 TFS 实例作为虚拟机运行。这将允许您在以后更轻松地升级和移动您的安装。Hyper-V 虚拟化平台支持 TFS：http: [//blogs.msdn.com/granth/archive/2008/06/27/team-foundation-server-and-hyper-v-virtualization.aspx](http://blogs.msdn.com/granth/archive/2008/06/27/team-foundation-server-and-hyper-v-virtualization.aspx)

如果您在此过程中需要帮助，您有以下三种选择：

1.  致电 MS 产品支持（$$，但您会得到答复）

2.  在官方 Team Foundation Server - 安装论坛上发帖：[http ://forums.microsoft.com/MSDN/ShowForum.aspx?ForumID=68&SiteID=1](http://forums.microsoft.com/MSDN/ShowForum.aspx?ForumID=68&SiteID=1)

3.  注册到[http://OzTFS.com/](http://OzTFS.com/)邮件列表。这份名单上的人非常擅长几乎立即回答问题。如果您只想“观看”正在发生的事情，这也是一个很好的加入列表。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-12T01:13:01.580

忽略“Cliff's Note”链接 - 它适用于 VSTS 2005。没有理由安装旧版本 - 安装程序（以及有关产品的所有其他内容）在 VSTS2008 中得到了很大改进。还要确保您安装了 SP1——它不仅仅是错误修复，还有一些主要的增强功能。

安装说明在这里：[Team Foundation VSTS2008 安装指南](http://www.microsoft.com/downloads/details.aspx?familyid=FF12844F-398C-4FE9-8B0D-9E84181D9923&displaylang=en)确保您严格遵循安装所需帐户的建议。

[包含服务器规格](http://blogs.msdn.com/bharry/archive/2007/10/18/tfs-2008-system-recommendations.aspx)建议的博客文章

Espo 发布的链接是安装 TFS 后配置 TFS 的绝佳演练。

[TFS 2008 SP1 下载](http://www.microsoft.com/downloads/details.aspx?familyid=9e40a5b6-da41-43a2-a06d-3cee196bfe3d&displaylang=en)

您还需要以下内容

[TFS 2008 Power Tools](http://msdn.microsoft.com/en-us/tfs2008/bb980963.aspx)特别是有一个“Team Foundation Server Best Practices Analyzer”，您可以在安装之前对服务器运行它以确保所有内容都正确修补等（然后确保安装正确）。它需要在服务器上安装 Windows Powershell 作为先决条件。

您还需要[Team System Web Access 2008 SP1](http://www.microsoft.com/downloads/details.aspx?FamilyId=3ECD00BA-972B-4120-A8D5-3D38311893DE&displaylang=en) -（以前的 Team Plain），它允许您将 TFS 的功能作为 Web 应用程序访问。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-12-05T18:28:10.587

这是使用 Visual Studio 2012 在 Windows 8 机器上设置 TFS 2012 的绝佳指南

[http://www.codeproject.com/Articles/426135/Team-Foundation-Server-2012-RC-Install-Configure](http://www.codeproject.com/Articles/426135/Team-Foundation-Server-2012-RC-Install-Configure)

这是带有 SQL Server 2012 的 Windows Server 2012 上的 TFS 2012

[http://blog.hinshelwood.com/installing-tfs-2012-on-server-2012-with-sql-2012/](http://blog.hinshelwood.com/installing-tfs-2012-on-server-2012-with-sql-2012/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T22:11:17.023

请参阅下面的链接以获取简明演练：

[Cliff 的团队系统安装说明](http://blogs.vertigosoftware.com/teamsystem/archive/2006/04/04/2512.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-12T01:16:43.943

正确安装和配置 VSTS2005 非常具有挑战性。我听说 2008 年要好得多，但还没有尝试过。准备好花一点时间在这上面，并在开始之前阅读所有内容。但是，不要灰心，TFS 值得努力！

# regex - Emacs 查询替换与文本转换

> ID：57751
> 
> 赞同：9
> 
> 时间：2008-09-11T21:54:47.377
> 
> 标签：regex, emacs

我想在文件中查找与*t* `[A-Z]`*u*形式的正则表达式匹配的任何文本（即，匹配*t*后跟一个大写字母和另一个匹配*u*，并转换匹配的文本，使大写字母为小写。例如，对于正则表达式`x[A-Z]y`

```
xAy 
```

变成

```
xay 
```

和

```
xZy 
```

变成

```
xzy 
```

Emacs 的`query-replace`功能允许反向引用，但 AFAIK 不允许匹配文本的转换。有没有内置函数可以做到这一点？有人有我可以使用的简短 Elisp 功能吗？

**更新**

@Marcel Levy 有它：`\,`在替换表达式中引入了（任意？）Elisp 表达式。例如，上面的解决方案是

```
M-x replace-regexp <RET> x\([A-Z]\)z <RET> x\,(downcase \1)z 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-11T22:19:19.673

看起来[Steve Yegge](http://steve-yegge.blogspot.com/)实际上在几年前就已经发布了这个问题的答案：[“Shiny and New: Emacs 22”。](http://steve-yegge.blogspot.com/2006/06/shiny-and-new-emacs-22.html)向下滚动到“在替换字符串中更改大小写”，您将看到他使用该`replace-regexp`函数的示例代码。

一般的答案是您使用“\”来调用任何 lisp 表达式作为替换字符串的一部分，如`\,(capitalize \1)`. 阅读帮助文本，看起来它只是在交互模式下，但这似乎是最需要这样做的地方。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-15T22:54:06.560

在这种情况下，qrr 的替代方法是录制宏并重放它。（isearch-forward-regexp，选择字符，downcase-region。）我发现动态宏更容易，因为如果您的 regexp 错误，您会立即获得反馈。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T06:16:49.600

我也会使用宏来执行此操作，但这只是因为从正则表达式的替换字符串中执行代码对我来说非常不直观。如果您正在编写批处理脚本或需要非常快的东西，\，肯定是要走的路。

# windows - 为什么 Vista 不允许在非管理员帐户上创建“程序”的快捷方式？不应该从非管理员帐户安装应用程序？

> ID：57759
> 
> 赞同：1
> 
> 时间：2008-09-11T21:59:21.390
> 
> 标签：windows, windows-vista, installation

我正在开发安装程序（使用 Wise Installer，1999 年的旧版本）。

我正在“程序”组中创建 EXE 的快捷方式。我还在桌面上创建了一个快捷方式。

如果安装是从管理员帐户运行的，那么我会在 Common Desktop 和 Common Program Group 上创建快捷方式（即，从 HKEY_LOCAL_MACHINE\Explorer\Shell for All Users 读取）。如果它是从非管理员帐户安装的，那么我会安装到 HKEY_CURRENT_USER 的桌面和程序组。

**行为**

安装在：

*XP NonAdmin* - 桌面和程序快捷方式安装正常。

*Vista Admin* - 桌面和程序快捷方式安装正常。

*Vista 非管理员，UAC 关闭*-**桌面快捷方式安装，但程序快捷方式不安装**。但是，它们应该安装到的程序组*文件夹**确实*被创建了。

在安装结束时，我启动具有快捷方式的程序组。它在上述所有内容中启动。我可以手动将快捷方式拖到该文件夹​​中，它工作得很好。

我真是一头雾水。

我已经尝试安装其他一些商业应用程序（Opera、Foxit、FireFox）只有 FireFox 会安装在 NonAdmin 下（并且只有当您选择 Program Files 以外的东西时，我知道这是对 nonAdmin 帐户的限制）。并且 FF 不会安装卸载图标，也不会从删除程序中安装卸载支持。

我尝试安装 IE 7，它*需要管理员*安装。它甚至不会使用临时提升的管理员安装。

**也许这个想法是您不应该从非管理员帐户在 Vista 中安装软件？**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-12T04:24:15.863

Vista 做了一些漂亮的透明重定向，以提供与非 vista 应用程序的向后兼容性。尝试以非管理员身份安装到所有用户位置，Vista 应该透明地将您的快捷方式放在该用户独有的位置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-07T05:30:09.400

当用户开始在 Vista 上安装时，我创建的安装程序存在权限问题。解决我的问题的方法是将安装程序重命名为 install.exe（或 setup.exe）。

-戴夫

# asp.net - 逐步 ASP.NET 自动构建/部署

> ID：57762
> 
> 赞同：30
> 
> 时间：2008-09-11T22:01:09.827
> 
> 标签：asp.net, iis, deployment

似乎有很多不同的方法可以自动化构建/部署，以至于很难解析人们在网络教程中支持的所有不同场景。所以我想向stackoverflow人群提出这个问题......使用以下配置设置自动构建和部署系统的最佳方法是什么：

*   视觉工作室 2008
*   网络应用项目
*   CruiseControl.NET

我尝试的第一件事是让 CCnet 自动压缩输出并将其复制到服务器，但这需要手动工作才能在目的地解压缩。但是，如果我们尝试单独复制所有文件，那么如果它是一个大型应用程序，则可能需要很长时间（构建服务器位于我们办公室的数据中心之外......我知道）。

同样特别有趣的是我们将如何支持多种环境，因为我们有 dev、qa、uat，当然还有 prod。

[MSDeploy](http://blogs.iis.net/msdeploy/archive/2008/01/22/welcome-to-the-web-deployment-team-blog.aspx)似乎真的很有趣，但除非我对文献的解释不正确，否则在从构建服务器的输出部署的场景中没有帮助。如果有的话，它似乎在跨构建场部署一个构建时很有用......但即使从一个环境部署到另一个环境，也必须手动更改配置设置和 Web 服务 URL 等。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-12T15:29:35.657

我最近花了几天时间在我的公司进行自动化部署。

我们使用 CruiseControl、NAnt、MSBuild 的组合来生成应用程序的发布版本。然后一个单独的脚本使用 MSDeploy 和 XCopy 来备份实时站点并传输新文件。

我们的解决方案在回答这个问题[Automate Deployment for Web Applications？](https://stackoverflow.com/questions/45783/automate-deployment-for-web-applications)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-11T22:38:31.560

您可能对[MSDeploy](http://blogs.iis.net/msdeploy/archive/2008/01/22/welcome-to-the-web-deployment-team-blog.aspx)感兴趣。[这](http://www.hanselman.com/blog/MSDeployNewIISWebDeploymentTool.aspx)是 Scott Hanselman 的帖子。它目前仅作为技术预览版（2008 年 9 月）提供，但值得根据您的要求进行评估。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-08-23T04:41:46.963

还有另一个名为**NUBuild**的新构建工具（一个非常智能的包装器） 。它的轻量级、开源且极易设置，并提供几乎无接触的维护。我真的很喜欢这个新工具，我们已经将它作为我们项目持续构建和集成过程的标准工具（我们有大约 400 个项目，涉及 75 个开发人员）。试试看。

[http://nubuild.codeplex.com/](http://nubuild.codeplex.com/)

*   易于使用的命令行界面
*   能够针对所有 .Net 框架版本，即 1.1、2.0、3.0 和 3.5
*   支持基于 XML 的配置
*   支持项目和文件引用
*   为给定项目自动生成“完整的有序构建列表”——无需接触维护。
*   检测和显示循环依赖的能力
*   执行并行构建 - 自动决定生成的构建列表中的哪些项目可以独立构建。
*   处理代理程序集的能力
*   为构建过程提供视觉线索，例如显示“完成百分比”、“当前状态”等。
*   以 XML 和文本格式生成详细的执行日志
*   与 Cruise-Control.Net 持续集成系统轻松集成
*   面向 2.0 + 版本时可以使用自定义记录器，如 XMLLogger
*   解析错误日志的能力
*   能够将构建的程序集部署到用户指定的位置
*   能够将源代码与源代码控制系统同步
*   版本管理能力

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-12T15:27:04.507

你有能力远程运行命令吗？[Systinternals](http://technet.microsoft.com/en-us/sysinternals/default.aspx)的[PsExec](http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx)实用程序将允许在远程计算机上运行命令行解压缩程序。如果您有一个将构建作为 .zip 文件复制到远程站点的脚本，则只需多一行 PsExec 调用即可解压缩文件。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-12T15:23:13.940

我有一个[有关](https://stackoverflow.com/questions/55323/aspnet-web-application-build-output-how-do-i-include-all-deployment-files)从自动构建中获取一组可部署文件的相关问题。我发现 Web 部署项目（链接和旧问题中的所有内容）满足了我的需求——它们是 VS 和 MSBuild 附加组件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-05-22T16:35:06.210

这是所有开发的常见问题（我希望我早点阅读它），而不仅仅是 ASP.NET。作为其开发人员之一，我的团队自然在内部使用[BuildMaster](http://inedo.com/buildmaster)进行整个发布过程，并且对于大多数场景来说它是免费的。在该工具中，我们能够执行所有标准 CI 构建以创建工件，然后设置自动化流程以将这些工件部署到我们内部或外部托管的 40 多台服务器中的任何一台，具体取决于特定的应用程序或环境.

由于您特别提到了部署到不同的测试环境，这是该工具的一个基本方面。这个想法是对你已经存在的环境工作流程（例如集成 -> QA -> 生产）进行建模，并从根本上促进从源代码控制到生产的整个构建过程。大多数时候，它就像添加一个将工件部署到环境中的部署操作一样简单，而其他时候它可能要复杂得多。

您还随便提到了配置文件更改是部署的一部分，这是 BuildMaster 的另一个内置组件。我们的想法是使用该工具本身作为所有配置文件和部署的中心枢纽，从而确保通过部署计划中的简单“部署配置文件”操作自动应用最新更改。

关于此过程，您没有提到的一件事是数据库部署方面。大多数 ASP.NET 应用程序都需要关联的数据库，否则它们可能只是静态 HTML 文件。每次部署都将数据库模式更新为适当的数据库版本，这一点至关重要。毫不奇怪，BuildMaster 中的一个模块也可以为您处理这个问题。这个想法是将 DDL-DML 脚本存储在工具本身中，并且*只执行一次脚本*每个环境，它确保您在每个环境中的所有数据库都是最新的，因为您的构建是通过它们部署的。其他脚本（例如存储过程、视图、触发器等）本质上是代码文件，因此属于源代码控制。在大多数情况下，这些 DROP-CREATE-CONFIGURE 类型的脚本每次都可以通过简单的部署操作运行。

大多数开发人员没有考虑的另一个部署难题是流程自动化。许多开发人员需要执行签核或填写变更请求表才能手动执行这些过程。同样，这一切都可以作为 BuildMaster 中自动化工作流程设置的一部分。您可以设置阻止程序，除非所有单元测试都已通过，否则不允许升级到 QA 环境，或者阻止升级到 Staging 环境，除非 QA 团队中的某个人批准构建并且您的问题跟踪工具中的所有问题都已解决/关闭那个特定的版本。

虽然我意识到我在答案中遗漏了 CC.NET，但我们的应用程序都是通过 BuildMaster 构建和部署的，因此我们不再需要它，尽管我们可以轻松地从放置位置获取工件并在以后的环境中部署它们。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-07-14T11:57:55.137

我看到很多人在他们的 .NET 项目中使用 CC，但为什么不使用 Jenkins、Sonarqube？他们得到了你需要的一切。我在 3 天内设置了所有这些。我有一个 Win 2008 服务器 R2、MSSQL、Jenkins、VIsual SVN 和 Sonarqube。

这一切都很好，你会得到你项目的所有指标。Sonarqube 使用 Gallio、Gendarme、FXcop、Stylecop、NDepths 和 PartCover 来获取您的指标，所有这些都非常简单，因为 SonarQube 无需太多配置即可自动执行此操作。

我给你贴了一些照片，你也有感觉。这是 Jenkins 女巫构建和获取声纳指标以及自动部署到 IIS 的另一项工作

![](https://i.stack.imgur.com/VbAmP.png)

还有 Sonarqube，我项目的所有指标。这是一个简单的 MVC4 应用程序，但效果很好！：

![](https://i.stack.imgur.com/0nKLI.png)

如果您想了解更多信息，我可以更具体，但我认为您至少应该考虑詹金斯。如果 CC 更适合您，至少您在选择之前查看了不错的选择。

整个设置使用 MSBuild，也构建和部署应用程序。

# winforms - BufferedGraphicsContext 错误

> ID：57766
> 
> 赞同：2
> 
> 时间：2008-09-11T22:03:14.827
> 
> 标签：winforms, multithreading, exception, gdi+

经过几个小时的应用程序使用后，我每天都在同一时间收到以下错误和调用堆栈。任何人都可以对正在发生的事情有所了解吗？

```
System.InvalidOperationException: BufferedGraphicsContext cannot be disposed of because a buffer operation is currently in progress.

at System.Drawing.BufferedGraphicsContext.Dispose(Boolean disposing)

at System.Drawing.BufferedGraphicsContext.Dispose()

at System.Drawing.BufferedGraphicsContext.AllocBufferInTempManager(Graphics targetGraphics, IntPtr targetDC, Rectangle targetRectangle)

at System.Drawing.BufferedGraphicsContext.Allocate(IntPtr targetDC, Rectangle targetRectangle)

at System.Windows.Forms.Control.WmPaint(Message& m)

at System.Windows.Forms.Control.WndProc(Message& m)

at System.Windows.Forms.ScrollableControl.WndProc(Message& m)

at System.Windows.Forms.ToolStrip.WndProc(Message& m)

at System.Windows.Forms.MenuStrip.WndProc(Message& m)

at System.Windows.Forms.Control.ControlNativeWindow.OnMessage(Message& m)

at System.Windows.Forms.Control.ControlNativeWindow.WndProc(Message& m)

at System.Windows.Forms.NativeWindow.Callback(IntPtr hWnd, Int32 msg, IntPtr wparam, IntPtr lparam) 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-12T01:44:15.063

[这里](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=200483&SiteID=1)有一个关于这个错误的很长的 MSDN 论坛讨论。在大多数情况下，错误显然与以下任何一项有关：

1.  潜在的 OutOfMemory 问题，表现为 BufferedGraphicsContext 异常，可能是由于框架错误。
2.  GDI 对象泄漏（创建 GDI 对象而不释放它们）。

我记得大约一年前我自己看到过这个错误，它肯定与内存问题有关，导致我们的应用程序在长时间运行后填满了所有可用的 VM，所以 #1 与我观察到的一致。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T22:37:03.780

黑暗中的一枪——你是用多个线程绘画吗？如果您正在做与绘画相关的工作，请在 GUI 线程上进行或仔细同步您的代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-01-22T12:23:23.350

我知道这个问题很老，但我遇到了同样的问题并发现它只出现在我使用多个实现手动双缓冲的控件时。

对我来说，我在这一点上发现了问题：

```
BufferedGraphicsContext _BackbufferContext = BufferedGraphicsManager.Current; 
```

所以我所有的控件都使用了*当前*上下文，我假设它总是相同的。在我替换它之后

```
BufferedGraphicsContext _BackbufferContext = new BufferedGraphicsContext(); 
```

一切都如愿以偿。

我希望这有点帮助。

# asp.net - 作为 ColdFusion 开发人员，您应该如何学习 ASP.NET？

> ID：57768
> 
> 赞同：3
> 
> 时间：2008-09-11T22:04:46.713
> 
> 标签：asp.net, coldfusion

作为一个使用 Adob​​e 的 ColdFusion 编写 Web 应用程序大约 10 年的人，我决定将 ASP.NET 作为字符串添加到我的弓上。

对于长期使用 CF 和底层 Java 的人来说，ASP.NET 对我来说似乎有点陌生。我应该如何开始使用 ASP.NET，这样我才能真正危险地使用它？我是否需要非常详细地了解 C#？

我希望能够快速构建基本的 Web 应用程序，这样我就可以在做棘手的事情时学到更多东西。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-12T00:08:55.697

我可能只有六个月的时间走同样的路，但以下是我迄今为止的经验中的一些想法：

如果您完全有 Java（甚至 CFScript）方面的经验，那么 C# 语言应该不会给您带来太多问题。不过，作为参考，当我开始时，我发现[csharp-station](http://www.csharp-station.com/)是语言基础知识的良好入门。就 ASP.NET 而言，它对您没有多大帮助；但它对语法有好处。更多您将熟悉 .NET 库。IDE 实际上在这里可以提供巨大的帮助。

以下是我在进行过渡时发现的三个最大差异：

1.  **ASP.NET 服务器控件**- 在 ColdFusion 中，您确实可以直接控制 HTML；您与页面密切合作。在 ASP.NET 中情况并非如此。服务器控件旨在减轻您的许多乏味，但代价可能是一些直接控制。作为一名 CF 程序员，我非常关注实际输出到浏览器的内容。起初 ASP.NET 让我很沮丧，因为它会产生很多额外的代码。尽管如此，这些控件仍然非常强大，熟悉它们是值得的。尤其是表单和验证控件，可以让您从 CF 中处理回发和验证的大量乏味中解脱出来。W3Schools 实际上有一个不错[的 Web 服务器控件列表](https://web.archive.org/web/20080829141718/https://www.w3schools.com/ASPNET/aspnet_refwebcontrols.asp)。
2.  **页面模型**- ColdFusion 在页面流方面是非常不可知的。ASP.NET 非常适合使用回传，并且非常受事件驱动。如果您没有使用带有 CF 的框架（例如 Model Glue），这对您来说可能是陌生的。.NET 会为您处理很多回发行为。此外，并不是说 ColdFusion 不能通过充分利用 CFC 来驱动对象和函数，但根据我的经验，与 CF 相比，ASP.NET 确实试图将您推向 OO 路径。
3.  **数据库访问**- 使用 ASP.NET 真的让我体会到 cfquery 的强大功能。csharp-station 站点也有关于使用本机 .NET db 工具的很好的教程。我还没有从事足够多的项目来开始寻找数据库访问扩展；我很确定 Jeff 推荐了一些他们用来构建这个网站的东西，所以你可以去看看。否则，我真的建议您熟悉 DataSet 对象。它有点类似于 CF 中的查询对象，并允许您运行查询等查询……在 CF 中循环查询非常常见，但由于数据绑定，在 ASP.NET 中几乎不会发生这种情况。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T22:06:33.383

Microsoft 为您可能感兴趣的 ColdFusion 开发人员提供了一个名为[ASP.NET的视频。](http://www.asp.net/Learn/videos/video-27.aspx)

编辑，[还有一个](http://www.asp.net/learn/videos/video-28.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-12T13:28:12.857

ADO.NET is a core concept, and I would really recommend taking a course in it. Having a qualified instructor explain exactly what the differences are between a DataSet, DataReader (and so forth -- there are a **lot** of different data access object types) is ***invaluable***. Not to mention you'll better understand the appropriate time and place to use each; and you can ask questions and get immediate answers in a classroom setting.

I took an ADO.NET class (one night a week, about 8 weeks) at my local university for around $400\. Even if my company hadn't paid for it, I would have been happy to, and I can highly recommend anyone trying to learn .NET do the same.

# visual-studio - 如何在 Visual Studio 中“添加现有项”整个目录结构？

> ID：57776
> 
> 赞同：787
> 
> 时间：2008-09-11T22:09:48.743
> 
> 标签：visual-studio, ide

我有一组独立的文件，它们根本不隶属于任何 C# 项目，它们位于复杂的嵌套目录结构中。

我想以这种格式将它们添加到我正在处理的 ASP.NET Web 应用程序中的不同目录中；同时保留相同的结构。因此，我将文件夹复制到项目的目标位置，并尝试“添加现有项目”，只是丢失了之前的文件夹层次结构。

通常我会手动重新创建目录，一对一地复制，然后添加现有项目。在这种情况下，目录/项目太多了。

那么如何在 Visual Studio 2008 中添加现有目录和文件呢？

* * *

## 回答 #1

> 赞同：750
> 
> 时间：2008-09-11T22:10:14.500

将文件/文件夹从 Windows 资源管理器拖到解决方案资源管理器中。它将全部添加。请注意，如果 Visual Studio 处于管理员模式，这将不起作用，因为 Windows 资源管理器是用户模式进程。

* * *

## 回答 #2

> 赞同：555
> 
> 时间：2008-09-11T22:15:18.013

为特定项目启用*“显示所有文件”*（您可能需要点击“刷新”才能看到它们）**。

不属于您的项目的文件夹/文件在项目树中 *显得稍微“轻一些” 。*

*右键单击*要添加的文件夹/文件，然后单击*“包含在项目中”*。它将递归地将文件夹/文件添加到项目中。

** 这些按钮位于迷你解决方案资源管理器工具栏上。

** 确保您未处于调试模式。

* * *

## 回答 #3

> 赞同：91
> 
> 时间：2012-07-10T20:00:25.403

在解决方案资源管理器中：

1.  单击*显示所有文件*（解决方案资源管理器顶部左侧的第二个图标）。
2.  找到要添加的文件夹。
3.  右键单击并选择*“包含在项目中”*

我使用它来安装附加组件，例如 HTML 编辑器和第三方文件浏览器。

* * *

## 回答 #4

> 赞同：35
> 
> 时间：2014-07-24T00:22:20.050

我只想指出之前提供的两种解决方案，

*   从 Windows 资源管理器拖放
*   *显示所有文件*，然后包含在项目中。

不要做问题所要求的：

*在保留目录结构的同时*包含在项目中。

至少在我的情况下不是（Windows 7 上的 C++/CLI 项目 Visual Studio 2013）。

在 Visual Studio 中，一旦您返回普通视图（不是*Show All Files*），您添加的文件都将列在项目的顶层。

是的，在磁盘上它们仍然驻留在原来的位置，但在解决方案资源管理器中它们是松散的。

除了在解决方案资源管理器中重新创建目录结构然后在正确的位置*添加现有项目*之外，我没有找到解决方法。

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2012-02-08T22:01:17.343

根据这些描述，我并没有立即理解这一点，但这是我最终偶然发现的：

1.  打开“显示所有文件” - 解决方案资源管理器工具栏上有一个图标
2.  使用 Windows 资源管理器（不是解决方案资源管理器），将文件移动到您希望它们驻留的目录结构中
3.  在解决方案资源管理器工具栏上也单击“刷新”
4.  您已移动的文件应该在您放置它们的解决方案资源管理器树结构中可见“幻影”
5.  右键单击您的幻影文件或文件夹，然后单击“包含在项目中”。将包含文件夹的所有内容

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2016-07-25T07:45:29.963

下面是“**显示所有文件**”的图标，仅供参考。

[![在此处输入图像描述](https://i.stack.imgur.com/iELY6.jpg)](https://i.stack.imgur.com/iELY6.jpg)

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2018-05-01T20:02:03.213

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2015-06-11T06:06:12.600

您可以更改项目 XML 以将现有子文件夹和结构自动添加到项目中，例如 NPM 中的“node_modules”：

这适用于较旧的 MSBuild / Visual Studio 版本

```
<ItemGroup>
   <Item Include="$([System.IO.Directory]::GetFiles(&quot;$(MSBuildProjectDirectory)\node_modules&quot;,&quot;*&quot;,SearchOption.AllDirectories))"></Item>
</ItemGroup> 
```

对于当前的 MSBuild / Visual Studio 版本：

只需将它放在xml的节点中：

```
<Project>
</Project> 
```

在这种情况下，只需将 $(MSBuildProjectDirectory)\node_modules 更改为您的文件夹名称。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2011-11-20T12:44:29.827

您需要将目录结构放在项目目录中。然后单击解决方案资源管理器工具箱顶部的“显示所有文件”图标。之后，将显示添加的目录。然后，您需要选择此目录，右键单击并选择“包含在项目中”。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2017-04-28T05:43:34.460

这就是我所做的：

1.  右键单击解决方案 -> 添加 -> 现有网站...
2.  选择您的网站所在的文件夹。只是站点的根文件夹。

然后，从文件夹到文件以及这些文件夹中的文件，所有内容都将添加到您的解决方案中。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2017-03-23T12:18:07.640

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2019-04-04T14:03:50.080

现在市场中有一个开源扩展，似乎可以满足 OP 的要求：

[文件夹到解决方案文件夹](https://marketplace.visualstudio.com/items?itemName=CeciliaWiren-CeciliaSHARP.FolderToSolutionFolder)

[![文件夹到解决方案文件夹](https://i.stack.imgur.com/vieVa.gif)](https://i.stack.imgur.com/vieVa.gif)

如果它不完全符合您的要求，则代码可用，因此您可以对其进行修改以适合您的场景。

高温高压

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2017-01-13T19:52:16.777

我发现的一个巧妙技巧是，如果您转到“添加现有...”，您可以将文件夹从打开的对话框拖到您的解决方案中。

我让我的 Visual Studio 自动在管理模式下打开，所以这对我来说是一个很好的解决方法，因为我不想为了让它工作而撤消它。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2016-08-02T20:43:06.650

对我有用的是将文件夹拖到 Visual Studio 中，然后右键单击该文件夹并选择“在文件资源管理器中打开文件夹”。然后全选并将它们拖到 Visual Studio 中的文件夹中。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2012-11-29T11:05:20.347

在 Windows 7 中，您可以执行以下操作：

右键单击您的项目并选择“添加->现有项目”。在出现的对话框中，浏览到要添加的目录的根目录。在右上角，您有一个搜索框。键入`*.cs`或`*.cpp`，无论您要添加什么类型的文件。搜索完成后，选择所有文件，点击添加，稍等片刻...

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-10-07T13:31:12.460

我发现最干净的方法是在目标文件夹中创建一个新的类库项目，并将其所有构建输出重定向到其他地方。它仍然会在该文件夹中留下一个 .csproj 文件，但它确实允许您在 Visual Studio 中查看它并选择要包含在项目中的文件。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-09-30T17:30:46.050

自从最初发布以来已经有一段时间了，但这里有一个替代答案。如果您只关心能够从 Visual Studio 内部查看物理文件并且不一定需要在解决方案资源管理器默认视图中查看它们，则单击切换视图按钮并选择文件夹视图和任何物理目录/目录即使它们没有出现在解决方案资源管理器默认视图中，它们也会出现在您的解决方案根文件夹下。

[![文件夹视图](https://i.stack.imgur.com/B3Fy6.png)](https://i.stack.imgur.com/B3Fy6.png)

但是，如果您想添加一个不太大的文件夹树作为虚拟解决方案目录/目录以匹配您现有的树结构，请执行此操作，然后将现有的物理文件“添加”到虚拟目录/目录。如果物理目录存在于您的解决方案目录中，它将不会复制文件 - 它会直接链接到物理文件，但它们将作为解决方案虚拟目录的一部分出现。

* * *

## 回答 #18

> 赞同：-3
> 
> 时间：2016-01-02T18:31:36.143

令人讨厌的是，Visual Studio 本身不支持这一点，但 CMake 可以生成 Visual Studio 项目作为解决方法。

除此之外，只需使用 Qt Creator。然后它可以导出一个 Visual Studio 项目。

# visual-studio-2008 - Visual Studio 2008 / 网站问题

> ID：57790
> 
> 赞同：2
> 
> 时间：2008-09-11T22:15:51.177
> 
> 标签：visual-studio-2008, internet-explorer-8, visual-studio-2008-sp1

我正在使用带有 SP1 和 IE 8 beta 2 的 VS 2008。每当我启动新网站或在解决方案资源管理器中双击 ASPX 时，VS 坚持尝试在独立的 IE 中显示 ASPX 页面浏览器实例。该地址是它尝试加载的 ASPX 的本地文件路径，并显示“无法显示 XML 页面”的错误。

否则，一切正常（我只是关闭了有问题的浏览器窗口。ASP.NET 已在 IIS 中注册，我没有其他问题。我已经在其他 PC 上测试了相同的配置，它工作正常。有人遇到过这个问题吗？

谢谢

rp

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-11T22:20:48.000

右键单击该文件，选择“打开方式”并选择“Web 表单编辑器”，然后单击“设置为默认值”。

# javascript - 我可以覆盖特定元素的 onbeforeunload 吗？

> ID：57791
> 
> 赞同：4
> 
> 时间：2008-09-11T22:16:24.937
> 
> 标签：javascript, events

我有一个页面做了很多工作，我不希望用户能够在没有收到警告的情况下离开该页面（关闭浏览器、点击返回按钮等）。我发现 onbeforeunload 事件（我认为它是特定于 IE 的，对我来说效果很好，因为该项目使用了很多 ActiveX）效果很好。

问题是，我希望用户能够点击右上角的一个小“帮助”图标，并随时弹出帮助窗口。这会导致 onbeforeunload 触发，即使主窗口永远不会去任何地方并且页面永远不会卸载。

在 onbeforeunload 事件运行时运行的 JavaScript 函数只是将文本放入 event.returnValue。如果我能以某种方式确定帮助图标是被点击的图标，那么在那种情况下我就不能将文本放入 event.returnValue 中。但是我怎么能让页面弄清楚呢？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-11T22:39:50.763

让我猜猜：帮助“图标”实际上是一个带有`javascript:`url 的链接？将其更改为真正的按钮、真正的链接，或者至少将功能放在 onclick 事件处理程序中（防止默认行为）。问题解决了。

```
<!-- clicking this link will do nothing. No onbeforeunload handler triggered. 
Nothing. 
And you could put something in before the return false bit...
...and the onunload handler would still not get called... -->
<a href="http://www.google.com/" onclick="return false;">blah1</a>
<!-- this should also do nothing, but IE will trigger the onbeforeunload 
handler -->
<a href="javascript:void(0)">blah2</a> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-11T22:22:27.653

**编辑：**基于我缺乏理解，我下面的“解决方法”完全是矫枉过正。使用上面 Shog9 的答案。

好的，所以当我写这个问题时，我想出了一个现在可以使用的解决方法。

我将一个全局 JavaScript 变量作为一个布尔值来判断图标是否被悬停。然后，我将事件附加到图像的 onmouseover 和 onmouseout 事件，并编写将设置此值的函数。最后，我只是在处理 onbeforeunload 的函数中编写代码，该函数将在设置 event.returnValue 之前检查此值。

可能不是一个完美的解决方法，但它现在可以工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-06T03:40:43.147

在互联网上，您会发现很多人建议您使用类似的东西

window.onbeforeunload = null

但这在 IE6 中对我不起作用。在 MSDN 文档中阅读事件对象时，我发现了对 event.cancelBubble 属性的引用，我认为这是解决方案。但是感谢Orso指出设置“event.cancelBubble=true”是没有用的，摆脱confirm提示的方法是完全排除return语句，我选择使用布尔变量作为标志来决定是否退货或不退货。在下面的示例中，我以编程方式在后面的代码中添加了 javascript 代码：

```
Page.ClientScript.RegisterStartupScript(typeof(String), "ConfirmClose", @"  <script>        window.onbeforeunload = confirmExit;        function confirmExit()      {           if(postback == false)               return ""Please don't leave this page without clicking the 'Save Changes' or 'Discard Changes' buttons."";                                                      }       </script>"); 
```

然后帮助按钮包含以下 aspx 标记：

```
OnClientClick="postback=true;return true; 
```

这会将“回发”变量设置为 true，该变量在 confirmExit() 函数中被拾取，具有取消事件的效果。

希望您觉得这个有帮助。它在 IE6 和 FF 1.5.0.2 中经过测试和工作。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-21T10:42:42.003

我有一种方法有点笨拙，但在大多数情况下都可以使用。

创建一个“Holding”弹出页面，其中包含一个 100% 单个 FRAME 的 FRAMESET，并将正常的 onUnload 和 onbeforeUnload 事件处理程序放在 HEAD 中。

```
<html>
<head>
<script language="Javascript" type="text/javascript">
  window.onbeforeunload = exitCheck;
  window.onunload = onCloseDoSomething;

  function onCloseDoSomething()
  {
  alert("This is executed at unload");
  }

  function exitCheck(evt)
  {
  return "Any string here."}
  </script>
  </head>

    <frameset rows="100%">
    <FRAME name="main" src="http://www.yourDomain.com/yourActualPage.aspx">
    </frameset>
<body>
</body>
</html> 
```

使用这种方法，您可以自由地使用您想查看的实际页面、回发并单击超链接，而无需触发外框 onUnload 或 onbeforeUnload 事件。

如果外部框架被刷新或实际关闭，事件将被触发。

就像我说的那样，不是完全证明，但会在每次点击或回发时绕过事件的触发。

# sql-server-2005 - Sql Server 2005 服务的最低权限集是多少？

> ID：57800
> 
> 赞同：3
> 
> 时间：2008-09-11T22:23:17.243
> 
> 标签：sql-server-2005, security, system-administration

最佳实践建议不要安装 Sql Server 以作为 SYSTEM 运行。您需要为其创建的用户帐户提供的最低限度是多少？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-12T05:01:42.310

默认情况下，SQL Server 2005 安装将创建一个名为 SQLServer2005MSSQLUser$ComputerName$MSSQLSERVER 且具有正确权限的安全组。您只需要创建一个域用户或本地用户并使其成为该组的成员。

SQL Server 联机丛书中提供了更多详细信息：[查看授予 SQL Server 服务帐户的 Windows NT 权限和特权](http://msdn.microsoft.com/en-us/library/ms143504(SQL.90).aspx#Review_NT_rights "设置 Windows 服务帐户")

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T22:32:54.040

通常，我创建一个仅具有网络上特定权限的域用户，我需要服务器拥有（即写入网络备份驱动器），然后根据需要将该帐户添加到本地高级用户或本地管理员在机器上完成，但这不是必需的。我已经多次使用标准用户作为服务帐户安装 SQL，但您需要确保用户有权写入[https://web.archive.org/web/20081223155956/http中列出的资源://support.microsoft.com/kb/283811](https://web.archive.org/web/20081223155956/http://support.microsoft.com/kb/283811)。它可能不像您想要的那样定义答案，但我只是一名开发人员（不是专业的 DBA/系统工程师）。

Mauro PS 不要因为我说“只有开发人员”而贬低我：P

# javascript - 如何在 JavaScript 中将十进制转换为十六进制

> ID：57803
> 
> 赞同：1743
> 
> 时间：2008-09-11T22:26:58.453
> 
> 标签：javascript, hex, number-formatting, base

如何在 JavaScript 中将十进制值转换为十六进制等效值？

* * *

## 回答 #1

> 赞同：2904
> 
> 时间：2008-09-11T22:28:34.610

将数字转换为十六进制字符串：

```
hexString = yourNumber.toString(16); 
```

并通过以下方式反转该过程：

```
yourNumber = parseInt(hexString, 16); 
```

* * *

## 回答 #2

> 赞同：158
> 
> 时间：2009-03-30T16:05:03.197

如果您需要处理位域或 32 位颜色等内容，则需要处理带符号的数字。JavaScript 函数`toString(16)`将返回一个负的十六进制数，这通常不是您想要的。这个函数做了一些疯狂的加法，使它成为一个正数。

```
function decimalToHexString(number)
{
  if (number < 0)
  {
    number = 0xFFFFFFFF + number + 1;
  }

  return number.toString(16).toUpperCase();
}

console.log(decimalToHexString(27));
console.log(decimalToHexString(48.6));
```

* * *

## 回答 #3

> 赞同：100
> 
> 时间：2008-09-11T22:29:07.730

下面的代码会将十进制值 d 转换为十六进制。它还允许您向十六进制结果添加填充。所以 0 默认会变成 00。

```
function decimalToHex(d, padding) {
    var hex = Number(d).toString(16);
    padding = typeof (padding) === "undefined" || padding === null ? padding = 2 : padding;

    while (hex.length < padding) {
        hex = "0" + hex;
    }

    return hex;
} 
```

* * *

## 回答 #4

> 赞同：71
> 
> 时间：2012-11-05T21:08:15.877

```
function toHex(d) {
    return  ("0"+(Number(d).toString(16))).slice(-2).toUpperCase()
} 
```

* * *

## 回答 #5

> 赞同：47
> 
> 时间：2013-06-14T10:59:55.367

为了完整起见，如果您想要负数的[二进制补码十六进制表示，您可以使用](http://en.wikipedia.org/wiki/Two%27s_complement "二进制补码 [维基百科]")[零填充右移`>>>`运算符](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Bitwise_Operators#%3E%3E%3E_%28Zero-fill_right_shift%29 "零填充右移 [MDN]")。例如：

```
> (-1).toString(16)
"-1"

> ((-2)>>>0).toString(16)
"fffffffe" 
```

但是有一个限制：[JavaScript 位运算符将其操作数视为 32 位序列](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Bitwise_Operators#Summary "位运算符 [MDN]")，也就是说，您将获得 32 位二进制补码。

* * *

## 回答 #6

> 赞同：38
> 
> 时间：2011-07-13T14:29:20.303

带填充：

```
function dec2hex(i) {
   return (i+0x10000).toString(16).substr(-4).toUpperCase();
} 
```

* * *

## 回答 #7

> 赞同：21
> 
> 时间：2014-11-06T16:21:37.530

接受的答案没有考虑返回的单个数字十六进制代码。这很容易通过以下方式调整：

```
function numHex(s)
{
    var a = s.toString(16);
    if ((a.length % 2) > 0) {
        a = "0" + a;
    }
    return a;
} 
```

和

```
function strHex(s)
{
    var a = "";
    for (var i=0; i<s.length; i++) {
        a = a + numHex(s.charCodeAt(i));
    }

    return a;
} 
```

我相信上述答案已被其他人以一种或另一种形式多次发布。我将它们包装在一个 toHex() 函数中，如下所示：

```
function toHex(s)
{
    var re = new RegExp(/^\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*$/);

    if (re.test(s)) {
        return '#' + strHex( s.toString());
    }
    else {
        return 'A' + strHex(s);
    }
} 
```

请注意，数字正则表达式来自[10+ 有用的 JavaScript 正则表达式函数，以提高您的 Web 应用程序效率](http://ntt.cc/2008/05/10/over-10-useful-javascript-regular-expression-functions-to-improve-your-web-applications-efficiency.html)。

更新：在多次测试这个东西后，我发现了一个错误（RegExp 中的双引号），所以我修复了它。然而！经过大量测试并阅读了 almaz 的帖子后，我意识到我无法让负数起作用。

此外 - 我对此进行了一些阅读，因为无论如何所有 JavaScript 数字都存储为 64 位字 - 我尝试修改 numHex 代码以获取 64 位字。但事实证明你不能那样做。如果您将“3.14159265”作为数字放入变量中 - 您将能够得到的只是“3”，因为小数部分只能通过重复将数字乘以十（IE：10.0）来访问。或者换一种说法 - 0xF 的*十六进制*值导致*浮点*值在它被“与”之前被转换为*整数，这会删除句点后面的所有内容。*而不是将值作为一个整体（即：3.14159265）并将*浮点*值与 0xF 值进行与运算。

因此，在这种情况下，最好的做法是将 3.14159265 转换为*字符串*，然后再转换字符串。由于上述原因，负数的转换也很容易，因为减号正好变成了值前面的 0x26。

所以我所做的是确定变量包含一个数字 - 只需将其转换为字符串并转换字符串。这对每个人来说意味着，在服务器端，您需要对传入的字符串进行 unhex，然后确定传入的信息是数字的。您只需在数字前面添加“#”，在返回的字符串前面添加“A”即可轻松做到这一点。请参阅 toHex() 函数。

玩得开心！

又过了一年，经过深思熟虑，我决定真的需要改进“toHex”函数（我也有一个“fromHex”函数）。整个问题是“我怎样才能更有效地做到这一点？” 我决定 to/from 十六进制函数不应该关心某些东西是否是小数部分，但同时它应该确保小数部分包含在字符串中。

那么问题就变成了，“你怎么知道你正在使用十六进制字符串？”。答案很简单。使用全球公认的标准前置字符串信息。

换句话说 - 使用“0x”。所以现在我的 toHex 函数查看它是否已经存在，如果它存在 - 它只返回发送给它的字符串。否则，它将转换字符串、数字等。这是修改后的 toHex 函数：

```
/////////////////////////////////////////////////////////////////////////////
//  toHex().  Convert an ASCII string to hexadecimal.
/////////////////////////////////////////////////////////////////////////////
toHex(s)
{
    if (s.substr(0,2).toLowerCase() == "0x") {
        return s;
    }

    var l = "0123456789ABCDEF";
    var o = "";

    if (typeof s != "string") {
        s = s.toString();
    }
    for (var i=0; i<s.length; i++) {
        var c = s.charCodeAt(i);

        o = o + l.substr((c>>4),1) + l.substr((c & 0x0f),1);
    }

    return "0x" + o;
} 
```

这是一个非常快速的函数，它考虑了单个数字、浮点数，甚至检查该人是否正在发送一个十六进制值以再次进行十六进制处理。它只使用了四个函数调用，其中只有两个在循环中。要取消十六进制您使用的值：

```
/////////////////////////////////////////////////////////////////////////////
//  fromHex().  Convert a hex string to ASCII text.
/////////////////////////////////////////////////////////////////////////////
fromHex(s)
{
    var start = 0;
    var o = "";

    if (s.substr(0,2).toLowerCase() == "0x") {
        start = 2;
    }

    if (typeof s != "string") {
        s = s.toString();
    }
    for (var i=start; i<s.length; i+=2) {
        var c = s.substr(i, 2);

        o = o + String.fromCharCode(parseInt(c, 16));
    }

    return o;
} 
```

与 toHex() 函数一样，fromHex() 函数首先查找“0x”，然后将传入的信息转换为字符串（如果它还不是字符串）。我不知道它怎么会不是一个字符串——但以防万一——我检查一下。然后该函数执行，抓取两个字符并将它们转换为 ASCII 字符。如果您希望它翻译 Unicode，您需要将循环更改为一次四 (4) 个字符。但是你还需要确保字符串不能被四整除。如果是 - 那么它是一个标准的十六进制字符串。（记住字符串前面有“0x”。）

一个简单的测试脚本显示 -3.14159265 在转换为字符串后仍然是 -3.14159265。

```
<?php

    echo <<<EOD
<html>
    <head><title>Test</title>
        <script>
            var a = -3.14159265;
            alert( "A = " + a );
            var b = a.toString();
            alert( "B = " + b );
        </script>
    </head>
    <body>
    </body>
</html>
EOD;

?> 
```

由于 JavaScript 相对于 toString() 函数的工作方式，所有这些问题都可以消除，这些问题以前会导致问题。现在所有字符串和数字都可以轻松转换。此外，诸如对象之类的东西会导致 JavaScript 本身产生错误。我相信这是最好的。剩下的唯一改进是 W3C 在 JavaScript 中只包含一个 toHex() 和 fromHex() 函数。

* * *

## 回答 #8

> 赞同：20
> 
> 时间：2010-09-11T03:05:10.847

没有循环：

```
function decimalToHex(d) {
  var hex = Number(d).toString(16);
  hex = "000000".substr(0, 6 - hex.length) + hex;
  return hex;
}

// Or "#000000".substr(0, 7 - hex.length) + hex;
// Or whatever
// *Thanks to MSDN 
```

另外，不使用必须评估的循环测试不是更好吗？

例如，而不是：

```
for (var i = 0; i < hex.length; i++){} 
```

有

```
for (var i = 0, var j = hex.length; i < j; i++){} 
```

* * *

## 回答 #9

> 赞同：19
> 
> 时间：2012-11-15T12:44:10.273

将这些好想法中的一些结合用于 RGB 值到十六进制函数（在`#`HTML/CSS 的其他地方添加）：

```
function rgb2hex(r,g,b) {
    if (g !== undefined)
        return Number(0x1000000 + r*0x10000 + g*0x100 + b).toString(16).substring(1);
    else
        return Number(0x1000000 + r[0]*0x10000 + r[1]*0x100 + r[2]).toString(16).substring(1);
} 
```

* * *

## 回答 #10

> 赞同：14
> 
> 时间：2015-11-10T04:23:11.650

对于任何感兴趣的人，[这里有一个 JSFiddle 比较了这个问题的大部分答案](http://jsfiddle.net/t3z4tqy5/)。

这是我最终采用的方法：

```
function decToHex(dec) {
  return (dec + Math.pow(16, 6)).toString(16).substr(-6)
} 
```

* * *

另外，请记住，如果您希望将十进制转换为十六进制以在 CSS 中用作[颜色数据类型](https://developer.mozilla.org/en/docs/Web/CSS/color_value)，您可能更愿意从十进制中提取 RGB 值并使用[rgb()](https://developer.mozilla.org/en/docs/Web/CSS/color_value#rgb())。

例如（[JSFiddle](http://jsfiddle.net/6wzckyn9/)）：

```
let c = 4210330 // your color in decimal format
let rgb = [(c & 0xff0000) >> 16,  (c & 0x00ff00) >> 8,  (c & 0x0000ff)]

// Vanilla JS:
document..getElementById('some-element').style.color = 'rgb(' + rgb + ')'
// jQuery:
$('#some-element').css('color', 'rgb(' + rgb + ')') 
```

这会将`#some-element`的 CSS`color`属性设置为`rgb(64, 62, 154)`.

* * *

## 回答 #11

> 赞同：13
> 
> 时间：2008-09-11T22:32:53.853

```
var number = 3200;
var hexString = number.toString(16); 
```

16 是基数，十六进制数中有 16 个值 :-)

* * *

## 回答 #12

> 赞同：12
> 
> 时间：2012-01-27T13:35:14.013

限制/填充到一组字符：

```
function decimalToHex(decimal, chars) {
    return (decimal + Math.pow(16, chars)).toString(16).slice(-chars).toUpperCase();
} 
```

* * *

## 回答 #13

> 赞同：10
> 
> 时间：2009-05-30T18:47:07.137

```
function dec2hex(i)
{
  var result = "0000";
  if      (i >= 0    && i <= 15)    { result = "000" + i.toString(16); }
  else if (i >= 16   && i <= 255)   { result = "00"  + i.toString(16); }
  else if (i >= 256  && i <= 4095)  { result = "0"   + i.toString(16); }
  else if (i >= 4096 && i <= 65535) { result =         i.toString(16); }
  return result
} 
```

* * *

## 回答 #14

> 赞同：9
> 
> 时间：2012-06-13T09:48:20.847

如果您想将数字转换为 RGBA 颜色值的十六进制表示，我发现这是以下几个技巧的最有用组合：

```
function toHexString(n) {
    if(n < 0) {
        n = 0xFFFFFFFF + n + 1;
    }
    return "0x" + ("00000000" + n.toString(16).toUpperCase()).substr(-8);
} 
```

* * *

## 回答 #15

> 赞同：8
> 
> 时间：2009-09-18T20:07:41.287

AFAIK[评论 57807](https://stackoverflow.com/questions/57803/how-to-convert-decimal-to-hex-in-javascript/57807#57807)是错误的，应该类似于： **var hex = Number(d).toString(16);** 而不是 **var hex = parseInt(d, 16);**

```
function decimalToHex(d, padding) {
    var hex = Number(d).toString(16);
    padding = typeof (padding) === "undefined" || padding === null ? padding = 2 : padding;

    while (hex.length < padding) {
        hex = "0" + hex;
    }

    return hex;
} 
```

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2012-10-21T07:32:32.387

如果这个数字是负数？

这是我的版本。

```
function hexdec (hex_string) {
    hex_string=((hex_string.charAt(1)!='X' && hex_string.charAt(1)!='x')?hex_string='0X'+hex_string : hex_string);
    hex_string=(hex_string.charAt(2)<8 ? hex_string =hex_string-0x00000000 : hex_string=hex_string-0xFFFFFFFF-1);
    return parseInt(hex_string, 10);
} 
```

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2013-06-10T11:57:16.797

正如公认的答案所述，从十进制转换为十六进制的最简单方法是`var hex = dec.toString(16)`. 但是，您可能更喜欢添加字符串转换，因为它可以确保字符串表示形式`"12".toString(16)`正常工作。

```
// Avoids a hard-to-track-down bug by returning `c` instead of `12`
(+"12").toString(16); 
```

要扭转这个过程，您也可以使用下面的解决方案，因为它更短。

```
var dec = +("0x" + hex); 
```

在 Google Chrome 和 Firefox 中它似乎更慢，但在 Opera 中明显更快。请参阅[http://jsperf.com/hex-to-dec](http://jsperf.com/hex-to-dec)。

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2012-12-13T17:35:59.700

我正在一个非常大的循环中转换为十六进制字符串，所以我尝试了几种技术以找到最快的一种。我的要求是得到一个固定长度的字符串，并正确编码负值（-1 => ff..f）。

简单`.toString(16)`对我不起作用，因为我需要正确编码负值。以下代码是迄今为止我在 1-2 字节值上测试过的最快的代码（请注意，它`symbols`定义了您想要获得的输出符号的数量，即对于 4 字节整数，它应该等于 8）：

```
var hex = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'a', 'b', 'c', 'd', 'e', 'f'];
function getHexRepresentation(num, symbols) {
    var result = '';
    while (symbols--) {
        result = hex[num & 0xF] + result;
        num >>= 4;
    }
    return result;
} 
```

它比 1-2 字节数字执行得更快`.toString(16)`，而在更大的数字上执行得更慢（当`symbols`>= 6 时），但仍然应该优于正确编码负值的方法。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2016-02-07T09:15:46.610

**如何在 JavaScript 中将十进制转换为十六进制**

我无法找到一个不涉及大量函数和数组的非常干净/简单的十进制到十六进制转换......所以我不得不为自己做这个。

```
function DecToHex(decimal) { // Data (decimal)

    length = -1;    // Base string length
    string = '';    // Source 'string'

    characters = [ '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F' ]; // character array

    do { // Grab each nibble in reverse order because JavaScript has no unsigned left shift

        string += characters[decimal & 0xF];   // Mask byte, get that character
        ++length;                              // Increment to length of string

    } while (decimal >>>= 4); // For next character shift right 4 bits, or break on 0

    decimal += 'x'; // Convert that 0 into a hex prefix string -> '0x'

    do
        decimal += string[length];
    while (length--); // Flip string forwards, with the prefixed '0x'

    return (decimal); // return (hexadecimal);
}

/* Original: */

D = 3678;    // Data (decimal)
C = 0xF;    // Check
A = D;        // Accumulate
B = -1;        // Base string length
S = '';        // Source 'string'
H = '0x';    // Destination 'string'

do {
    ++B;
    A& = C;

    switch(A) {
        case 0xA: A='A'
        break;

        case 0xB: A='B'
        break;

        case 0xC: A='C'
        break;

        case 0xD: A='D'
        break;

        case 0xE: A='E'
        break;

        case 0xF: A='F'
        break;

        A = (A);
    }
    S += A;

    D >>>= 0x04;
    A = D;
} while(D)

do
    H += S[B];
while (B--)

S = B = A = C = D; // Zero out variables
alert(H);    // H: holds hexadecimal equivalent 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2019-01-30T12:59:59.273

[你可以在ECMAScript 6](https://en.wikipedia.org/wiki/ECMAScript#6th_Edition_-_ECMAScript_2015)中做这样的事情：

```
const toHex = num => (num).toString(16).toUpperCase(); 
```

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2019-05-17T05:49:27.430

如果您正在寻找转换大整数，即大于 Number.MAX_SAFE_INTEGER -- 9007199254740991 的数字，那么您可以使用以下代码

```
const hugeNumber = "9007199254740991873839" // Make sure its in String
const hexOfHugeNumber = BigInt(hugeNumber).toString(16);
console.log(hexOfHugeNumber)
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2013-12-10T00:14:57.363

总结一下；

```
function toHex(i, pad) {

  if (typeof(pad) === 'undefined' || pad === null) {
    pad = 2;
  } 

  var strToParse = i.toString(16);

  while (strToParse.length < pad) {
    strToParse = "0" + strToParse;
  }

  var finalVal =  parseInt(strToParse, 16);

  if ( finalVal < 0 ) {
    finalVal = 0xFFFFFFFF + finalVal + 1;
  }

  return finalVal;
} 
```

但是，如果您不需要在最后将其转换回整数（即颜色），那么只需确保值不是负数就足够了。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2017-11-05T18:21:54.883

我还没有找到一个明确的答案，没有检查它是负数还是正数，它使用二进制补码（包括负数）。为此，我将我的解决方案展示为一个字节：

```
((0xFF + number +1) & 0x0FF).toString(16); 
```

您可以将此指令用于任意数量的字节，只需`FF`在相应的位置添加即可。例如，到两个字节：

```
((0xFFFF + number +1) & 0x0FFFF).toString(16); 
```

如果要将数组整数转换为十六进制字符串：

```
s = "";
for(var i = 0; i < arrayNumber.length; ++i) {
    s += ((0xFF + arrayNumber[i] +1) & 0x0FF).toString(16);
} 
```

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2018-03-13T19:34:29.230

如果您希望转换为“完整”的 JavaScript 或 CSS 表示形式，您可以使用以下内容：

```
 numToHex = function(num) {
    var r=((0xff0000&num)>>16).toString(16),
        g=((0x00ff00&num)>>8).toString(16),
        b=(0x0000ff&num).toString(16);
    if (r.length==1) { r = '0'+r; }
    if (g.length==1) { g = '0'+g; }
    if (b.length==1) { b = '0'+b; }
    return '0x'+r+g+b;                 // ('#' instead of'0x' for CSS)
  };

  var dec = 5974678;
  console.log( numToHex(dec) );        // 0x5b2a96 
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2021-01-23T13:08:46.527

*   rgb(255, 255, 255) // 返回 FFFFFF

*   rgb(255, 255, 300) // 返回 FFFFFF

*   rgb(0,0,0) // 返回 000000

*   rgb(148, 0, 211) // 返回 9400D3

    ```
     function rgb(...values){
              return values.reduce((acc, cur) => {
                let val = cur >= 255 ? 'ff' : cur <= 0 ? '00' : Number(cur).toString(16);
                return acc + (val.length === 1 ? '0'+val : val);
              }, '').toUpperCase();
          } 
    ```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2019-08-19T06:56:08.087

这是基于 Prestaul 和 Tod 的解决方案。然而，这是一个解释变量大小变化的概括（例如，从微控制器串行日志中解析有符号值）。

```
function decimalToPaddedHexString(number, bitsize)
{ 
  let byteCount = Math.ceil(bitsize/8);
  let maxBinValue = Math.pow(2, bitsize)-1;

  /* In node.js this function fails for bitsize above 32bits */
  if (bitsize > 32)
    throw "number above maximum value";

  /* Conversion to unsigned form based on  */
  if (number < 0)
    number = maxBinValue + number + 1;

  return "0x"+(number >>> 0).toString(16).toUpperCase().padStart(byteCount*2, '0');
} 
```

测试脚本：

```
for (let n = 0 ; n < 64 ; n++ ) { 
     let s=decimalToPaddedHexString(-1, n); 
     console.log(`decimalToPaddedHexString(-1,${(n+"").padStart(2)}) = ${s.padStart(10)} = ${("0b"+parseInt(s).toString(2)).padStart(34)}`);
   } 
```

测试结果：

```
decimalToPaddedHexString(-1, 0) =        0x0 =                                0b0
decimalToPaddedHexString(-1, 1) =       0x01 =                                0b1
decimalToPaddedHexString(-1, 2) =       0x03 =                               0b11
decimalToPaddedHexString(-1, 3) =       0x07 =                              0b111
decimalToPaddedHexString(-1, 4) =       0x0F =                             0b1111
decimalToPaddedHexString(-1, 5) =       0x1F =                            0b11111
decimalToPaddedHexString(-1, 6) =       0x3F =                           0b111111
decimalToPaddedHexString(-1, 7) =       0x7F =                          0b1111111
decimalToPaddedHexString(-1, 8) =       0xFF =                         0b11111111
decimalToPaddedHexString(-1, 9) =     0x01FF =                        0b111111111
decimalToPaddedHexString(-1,10) =     0x03FF =                       0b1111111111
decimalToPaddedHexString(-1,11) =     0x07FF =                      0b11111111111
decimalToPaddedHexString(-1,12) =     0x0FFF =                     0b111111111111
decimalToPaddedHexString(-1,13) =     0x1FFF =                    0b1111111111111
decimalToPaddedHexString(-1,14) =     0x3FFF =                   0b11111111111111
decimalToPaddedHexString(-1,15) =     0x7FFF =                  0b111111111111111
decimalToPaddedHexString(-1,16) =     0xFFFF =                 0b1111111111111111
decimalToPaddedHexString(-1,17) =   0x01FFFF =                0b11111111111111111
decimalToPaddedHexString(-1,18) =   0x03FFFF =               0b111111111111111111
decimalToPaddedHexString(-1,19) =   0x07FFFF =              0b1111111111111111111
decimalToPaddedHexString(-1,20) =   0x0FFFFF =             0b11111111111111111111
decimalToPaddedHexString(-1,21) =   0x1FFFFF =            0b111111111111111111111
decimalToPaddedHexString(-1,22) =   0x3FFFFF =           0b1111111111111111111111
decimalToPaddedHexString(-1,23) =   0x7FFFFF =          0b11111111111111111111111
decimalToPaddedHexString(-1,24) =   0xFFFFFF =         0b111111111111111111111111
decimalToPaddedHexString(-1,25) = 0x01FFFFFF =        0b1111111111111111111111111
decimalToPaddedHexString(-1,26) = 0x03FFFFFF =       0b11111111111111111111111111
decimalToPaddedHexString(-1,27) = 0x07FFFFFF =      0b111111111111111111111111111
decimalToPaddedHexString(-1,28) = 0x0FFFFFFF =     0b1111111111111111111111111111
decimalToPaddedHexString(-1,29) = 0x1FFFFFFF =    0b11111111111111111111111111111
decimalToPaddedHexString(-1,30) = 0x3FFFFFFF =   0b111111111111111111111111111111
decimalToPaddedHexString(-1,31) = 0x7FFFFFFF =  0b1111111111111111111111111111111
decimalToPaddedHexString(-1,32) = 0xFFFFFFFF = 0b11111111111111111111111111111111
Thrown: 'number above maximum value' 
```

注意：不太清楚为什么它在 32 位以上失败

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2021-02-09T20:08:22.683

# 任意精度

此解决方案采用输入十进制字符串，并返回十六进制字符串。支持小数部分。算法

*   将数字拆分为符号 ( `s`)、整数部分 ( `i`) 和小数部分 ( `f`) 例如因为`-123.75`我们有`s=true`, `i=123`,`f=75`
*   整数部分到十六进制：
    *   如果`i='0'`停止
    *   取模：（`m=i%16`任意精度）
    *   转换`m`为十六进制数字并放入结果字符串
    *   用于下一步计算整数部分`i=i/16`（任意精度）
*   小数部分
    *   计算小数位数`n`
    *   乘法`k=f*16`（任意精度）
    *   用数字拆分`k`到右侧部分并将它们放入，将其余数字拆分到左侧部分并将它们放入`n``f``d`
    *   转换`d`为十六进制并添加到结果中。
    *   当结果小数位数足够时完成

```
// @param decStr - string with non-negative integer
// @param divisor - positive integer
function dec2HexArbitrary(decStr, fracDigits=0) {   
    // Helper: divide arbitrary precision number by js number
    // @param decStr - string with non-negative integer
    // @param divisor - positive integer
    function arbDivision(decStr, divisor) 
    { 
        // algorithm https://www.geeksforgeeks.org/divide-large-number-represented-string/
        let ans=''; 
        let idx = 0; 
        let temp = +decStr[idx]; 
        while (temp < divisor) temp = temp * 10 + +decStr[++idx]; 

        while (decStr.length > idx) { 
            ans += (temp / divisor)|0 ; 
            temp = (temp % divisor) * 10 + +decStr[++idx]; 
        } 

        if (ans.length == 0) return "0"; 

        return ans; 
    } 

    // Helper: calc module of arbitrary precision number
    // @param decStr - string with non-negative integer
    // @param mod - positive integer
    function arbMod(decStr, mod) { 
      // algorithm https://www.geeksforgeeks.org/how-to-compute-mod-of-a-big-number/
      let res = 0; 

      for (let i = 0; i < decStr.length; i++) 
        res = (res * 10 + +decStr[i]) % mod; 

      return res; 
    } 

    // Helper: multiply arbitrary precision integer by js number
    // @param decStr - string with non-negative integer
    // @param mult - positive integer
    function arbMultiply(decStr, mult) {
      let r='';
      let m=0;
      for (let i = decStr.length-1; i >=0 ; i--) {
        let n = m+mult*(+decStr[i]);
        r= (i ? n%10 : n) + r 
        m= n/10|0;
      }
      return r;
    }

    // dec2hex algorithm starts here

    let h= '0123456789abcdef';                                         // hex 'alphabet'
    let m= decStr.match(/-?(.*?)\.(.*)?/) || decStr.match(/-?(.*)/);   // separate sign,integer,ractional
    let i= m[1].replace(/^0+/,'').replace(/^$/,'0');                   // integer part (without sign and leading zeros)
    let f= (m[2]||'0').replace(/0+$/,'').replace(/^$/,'0');            // fractional part (without last zeros)
    let s= decStr[0]=='-';                                                                             // sign

    let r='';                                                                                                          // result

    if(i=='0') r='0';

    while(i!='0') {                                                    // integer part
      r=h[arbMod(i,16)]+r; 
      i=arbDivision(i,16);
    }

    if(fracDigits) r+=".";

    let n = f.length;

    for(let j=0; j<fracDigits; j++) {                                  // frac part
      let k= arbMultiply(f,16);
      f = k.slice(-n);
      let d= k.slice(0,k.length-n); 
      r+= d.length ? h[+d] : '0';
    }

    return (s?'-':'')+r;
}

// -----------
// TESTS
// -----------

let tests = [
  ["0",2],
  ["000",2],  
  ["123",0],
  ["-123",0],  
  ["00.000",2],

  ["255.75",5],
  ["-255.75",5], 
  ["127.999",32], 
];

console.log('Input      Standard          Abitrary');
tests.forEach(t=> {
  let nonArb = (+t[0]).toString(16).padEnd(17,' ');
  let arb = dec2HexArbitrary(t[0],t[1]);
  console.log(t[0].padEnd(10,' '), nonArb, arb); 
});

// Long Example (40 digits after dot)
let example = "123456789012345678901234567890.09876543210987654321"
console.log(`\nLong Example:`);
console.log('dec:',example);
console.log('hex:     ',dec2HexArbitrary(example,40));
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2022-02-18T10:18:49.800

## 将十六进制颜色数字转换为十六进制颜色字符串：

`toString`使用ES6的简单解决方案，`padStart`用于将十六进制颜色数字转换为十六进制颜色字符串。

```
const string = `#${color.toString(16).padStart(6, '0')}`; 
```

例如：

`0x000000`将成为`#000000`
`0xFFFFFF`将成为`#FFFFFF`

[在此处的小提琴中检查此示例](https://jsfiddle.net/wilt/zg1vcbu3/)

* * *

## 回答 #29

> 赞同：-3
> 
> 时间：2018-11-20T08:47:21.103

这是我的解决方案：

```
hex = function(number) {
  return '0x' + Math.abs(number).toString(16);
} 
```

问题是：*“如何在 JavaScript 中将十进制转换为十六进制”*。虽然问题没有指定十六进制字符串应以 0x 前缀开头，但任何编写代码的人都应该知道 0x 被添加到十六进制代码中以区分*十六进制代码*与*编程标识符*和*其他数字*（1234 可以是十六进制、十进制或甚至八进制）。

因此，要正确回答这个问题，为了编写脚本，您必须添加 0x 前缀。

Math.abs(N) 函数将负数转换为正数，作为奖励，它看起来不像是有人通过木材削片机运行它。

我想要的答案应该有一个字段宽度说明符，因此我们可以例如显示 8/16/32/64 位值，就像您在十六进制编辑应用程序中看到它们一样。那是实际的正确答案。

# c# - NHibernate.MappingException：没有持久性：XYZ

> ID：57804
> 
> 赞同：136
> 
> 时间：2008-09-11T22:27:05.597
> 
> 标签：c#, .net, nhibernate

现在，在你说之前：我**做了**谷歌，我的`hbm.xml`文件**是**嵌入式资源。

这是我正在调用的代码：

```
ISession session = GetCurrentSession();
var returnObject =  session.Get<T>(Id); 
```

这是我的类的映射文件：

```
<?xml version="1.0" encoding="utf-8" ?>
<hibernate-mapping xmlns="urn:nhibernate-mapping-2.2">
  <class name="HQData.Objects.SubCategory, HQData" table="SubCategory" lazy="true">
    <id name="ID" column="ID" unsaved-value="0">
      <generator class="identity" />
    </id>

    <property name="Name" column="Name" />
    <property name="NumberOfBuckets" column="NumberOfBuckets"  />
    <property name="SearchCriteriaOne" column="SearchCriteriaOne" />

    <bag name="_Businesses" cascade="all">
      <key column="SubCategoryId"/>
      <one-to-many 
         class="HQData.Objects.Business, HQData"/>
    </bag>

    <bag name="_Buckets" cascade="all">
      <key column="SubCategoryId"/>
      <one-to-many
         class="HQData.Objects.Bucket, HQData"/>
    </bag>

  </class>
</hibernate-mapping> 
```

以前有没有人遇到过这个问题？

这是完整的错误消息：

> ```
> MappingException：没有持久性：HQData.Objects.SubCategory]NHibernate.Impl.SessionFactoryImpl.GetEntityPersister(String entityName, Boolean throwIfNotFound)
>  在 c:\CSharp\NH2.0.0\nhibernate\src\NHibernate\Impl\SessionFactoryImpl.cs:766 NHibernate.Impl.SessionFactoryImpl.GetEntityPersister(String entityName)
>  在 c:\CSharp\NH2.0.0\nhibernate\src\NHibernate\Impl\SessionFactoryImpl.cs:752 NHibernate.Event.Default.DefaultLoadEventListener.OnLoad(LoadEvent 事件, LoadType loadType)
>  在 c:\CSharp\NH2.0.0\nhibernate\src\NHibernate\Event\Default\DefaultLoadEventListener.cs:37 NHibernate.Impl.SessionImpl.FireLoad（LoadEvent 事件，LoadType loadType）
>  在 c:\CSharp\NH2.0.0\nhibernate\src\NHibernate\Impl\SessionImpl.cs:2054 NHibernate.Impl.SessionImpl.Get(String entityName, Object id)
>  在 c:\CSharp\NH2.0.0\nhibernate\src\NHibernate\Impl\SessionImpl.cs:1029 NHibernate.Impl.SessionImpl.Get（类型 entityClass，对象 id）
>  在 c:\CSharp\NH2.0.0\nhibernate\src\NHibernate\Impl\SessionImpl.cs:1020 NHibernate.Impl.SessionImpl.Get(对象 id)
>  在 c:\CSharp\NH2.0.0\nhibernate\src\NHibernate\Impl\SessionImpl.cs:985 HQData.DataAccessUtils.NHibernateObjectHelper.LoadDataObject(Int32 Id)
>  在 C:\Development\HQChannelRepo\HQ Channel Application\HQChannel\HQData\DataAccessUtils\NHibernateObjectHelper.cs:42 HQWebsite.LocalSearch.get_subCategory()
>  在 C:\Development\HQChannelRepo\HQ Channel Application\HQChannel\HQWebsite\LocalSearch.aspx.cs:17 HQWebsite.LocalSearch.Page_Load(Object sender, EventArgs e)
>  在 C:\Development\HQChannelRepo\HQ Channel Application\HQChannel\HQWebsite\LocalSearch.aspx.cs:27 System.Web.Util.CalliHelper.EventArgFunctionCaller(IntPtr fp, Object o, Object t, EventArgs e) +15 System.Web .Util.CalliEventHandlerDelegateProxy.Callback(Object sender, EventArgs e) +33 System.Web.UI.Control.OnLoad(EventArgs e) +99 System.Web.UI.Control.LoadRecursive() +47 System.Web.UI.Page .ProcessRequestMain（布尔includeStagesBeforeAsyncPoint，布尔includeStagesAfterAsyncPoint）+1436
> ```

**更新**，这是我的场景的解决*方案*：我更改了一些代码，并且在运行时我没有将程序集添加到配置文件中。

* * *

## 回答 #1

> 赞同：102
> 
> 时间：2008-09-12T00:20:28.460

听起来您忘记将映射程序集添加到会话工厂配置中..

如果您使用的是 app.config ...

```
.
.
    <property name="show_sql">true</property>
    <property name="query.substitutions">true 1, false 0, yes 'Y', no 'N'</property>
    <mapping assembly="Project.DomainModel"/>  <!-- Here -->
</session-factory>
.
. 
```

* * *

## 回答 #2

> 赞同：94
> 
> 时间：2009-11-25T10:09:45.923

一些显而易见的东西，但对于 NHibernate 的新手来说非常有用。

所有 XML 映射文件都应被视为*Embedded Resources*而不是默认的*Content*。此选项是通过编辑文件属性中的 Build Action 属性来设置的。

然后将 XML 文件嵌入到程序集中，并在 NHibernate 的配置阶段在项目启动时进行解析。

* * *

## 回答 #3

> 赞同：53
> 
> 时间：2010-08-18T13:45:43.023

我的问题是我忘记将 .hbm 放在映射 xml 的名称中。还要确保将其设为嵌入式资源！

* * *

## 回答 #4

> 赞同：45
> 
> 时间：2010-08-22T16:14:16.047

我从[这里](http://www.mail-archive.com/fluent-nhibernate@googlegroups.com/msg03276.html)得到了这个：

就我而言，映射类不是公开的。换句话说，而不是：

```
public class UserMap : ClassMap<user>  // note the public! 
```

我刚有：

```
class UserMap : ClassMap<user> 
```

* * *

## 回答 #5

> 赞同：29
> 
> 时间：2012-08-01T11:27:02.440

花了大约 4 个小时在**谷歌搜索**和**stackoverflowing**上，尝试了所有的东西，我发现了我的错误：

**我的映射文件被称为*.nbm.xml*而不是*.hbm.xml***。那太疯狂了。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-07-08T13:04:01.040

我有类似的问题，我解决了它如下：

我在 MS SQL 2008 上工作，但在 NH 配置中我的方言不好：NHibernate.Dialect。 如果我将其更正为：NHibernate.Dialect，**则为 MsSql2005Dialect 。****MsSql2008Dialect** 然后一切正常，无一例外“没有持久性：......”大卫。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-05-24T15:13:50.777

我还在初始化期间添加了错误的程序集。我坚持的类在程序集#1 中，我的 .hbm.xml 文件嵌入在程序集#2 中。我更改`cfg.AddAssembly(...`为添加程序集#2（而不是程序集#1），一切正常。谢谢！

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2012-06-28T21:09:50.713

要添加到 Amol 的答案，请不要错误指定 Interface 类类型。 **确保您指定了实现类**。（即不要使用 IDomainObjectType）。不是我犯了这个错误...... :)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-11T23:01:31.490

应该是`name="Id"`吗？错别字是一个可能的原因。

接下来是使用非泛型测试进行尝试，以确保您传递了正确的类型参数。

您可以发布整个错误消息吗？

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2010-12-27T10:54:28.163

我遇到了同样的问题，因为我在 Configuration.AddAssembly() 方法中添加了错误的程序集。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2014-04-18T11:59:46.077

出现此错误是因为映射配置无效。您应该检查为会话工厂设置 .Mappings 的位置。基本上在您的项目中搜索“.Mappings(”并确保您在下面的行中指定了正确的实体类。

```
.Mappings(m => m.FluentMappings.AddFromAssemblyOf<YourEntityClassName>()) 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-03-05T15:04:17.217

如果从单独的程序集在存储库上运行测试，请确保您的 Hibernate.cfg.xml 设置为始终在所述程序集的 bin 目录中输出。这对我们来说并没有发生，我们在某些情况下遇到了上述错误。

免责声明：这可能是一个稍微深奥的建议，因为它是我们如何构建存储库集成测试程序集的直接结果（即我们有一个从每个测试程序集到单个 Hibernate.xfg.xml 的符号链接）

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-03-10T23:56:35.997

不要忘记在 .config 文件中指定映射信息

例如

其中 MyApp.Data 是包含您的映射的程序集

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-18T21:05:41.053

通过 id 查找对象时遇到了类似的问题...我所做的只是在类名中使用完全限定名。那是以前：

```
find("Class",id) 
```

对象，所以它变成了这样：

```
find("assemblyName.Class",id) 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-09-09T10:05:29.620

确保您已经`CreateCriteria(typeof(DomainObjectType))`为您打算从数据库中获取的域对象调用了 Session 上的方法。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2020-03-02T14:07:24.487

我有一个类似的问题，但所有提到的*要求*都得到了满足。就我而言，我尝试将一些实体类（OBJEKTE 类型）保存回数据库。其他地方确实有效，但只有在这种情况下它才会失败并引发此异常。

我的解决方案（HACK）是重新映射 OBJEKTE 类型的对象，然后存储它。突然它起作用了。但不要问为什么。

```
 OBJEKTE t = _mapper.Map<OBJEKTE>(inparam);
            OBJEKTE res = await _objRepo.UpdateAsync(t); 
```

如果 inparam 将直接转到 UpdateAsync() 它找不到匹配的持久化器。

这可以通过 NH 这样做的方式来解释。它从您的映射类派生一个代理并实现包含脏处理的属性。看到这个：

```
t.GetType()
{Name = "OBJEKTE" FullName = "MyComp.Persistence.OBJEKTE"}

inparam.GetType()
{Name = "OBJEKTEProxyForFieldInterceptor" FullName = "OBJEKTEProxyForFieldInterceptor"} 
```

有趣的是，它的来源`inparam`实际上是 NH 存储库本身。无论如何。我下次继续使用这个重新分配技巧。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-12-09T14:22:36.040

在我的情况下，我获取了一个没有的实体`await`：

```
var company = _unitOfWork.Session.GetAsync<Company>(id); 
```

然后我试图删除它：

```
await _unitOfWork.Session.DeleteAsync(company); 
```

我无法破译我正在删除 a`Task<Company>`而不是的错误消息`Company`：

*MappingException：没有持久性：System.Runtime.CompilerServices.AsyncTaskMethodBuilder'1+AsyncStateMachineBox'1[[SmartGuide.Core.Domain.Users.Company, SmartGuide.Core, Version=2.0.0.0, Culture=neutral, PublicKeyToken=null], [NHibernate.Impl.SessionImpl+d__54`1[[SmartGuide.Core.Domain.Users.Company, SmartGuide.Core, Version=2.0.0.0, Culture=neutral, PublicKeyToken=null]], NHibernate, Version=5.3.0.0,文化=中性，PublicKeyToken=aa95f207798dfdb4]]*

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2022-02-22T20:42:40.167

你会认为 14 年后，这个问题的所有可能答案都已经写下来了。似乎情况并非如此。

在我目前正在处理的应用程序中，有*几个* `ISessionFactory`实例，每个实例用于不同的数据库。

如果您使用错误的方法来创建您的`ISession`，它当然不会知道您要坚持的课程，这在我的情况下是错误的。

# javascript - 删除所有以某个字符串开头的类

> ID：57812
> 
> 赞同：108
> 
> 时间：2008-09-11T22:32:28.143
> 
> 标签：javascript, jquery, css

我有一个 div，`id="a"`它可能有来自多个组的任意数量的类。每个组都有一个特定的前缀。在 javascript 中，我不知道组中的哪个类在 div 上。我希望能够清除所有具有给定前缀的类，然后添加一个新类。如果我想删除所有以“bg”开头的类，我该怎么做？像这样的东西，但实际上有效：

```
$("#a").removeClass("bg*"); 
```

* * *

## 回答 #1

> 赞同：113
> 
> 时间：2012-05-31T14:17:04.637

单词边界上的正则表达式拆分`\b`不是最好的解决方案：

```
var prefix = "prefix";
var classes = el.className.split(" ").filter(function(c) {
    return c.lastIndexOf(prefix, 0) !== 0;
});
el.className = classes.join(" ").trim(); 
```

或者作为一个 jQuery mixin：

```
$.fn.removeClassPrefix = function(prefix) {
    this.each(function(i, el) {
        var classes = el.className.split(" ").filter(function(c) {
            return c.lastIndexOf(prefix, 0) !== 0;
        });
        el.className = $.trim(classes.join(" "));
    });
    return this;
}; 
```

2018 ES6 更新：

```
const prefix = "prefix";
const classes = el.className.split(" ").filter(c => !c.startsWith(prefix));
el.className = classes.join(" ").trim(); 
```

* * *

## 回答 #2

> 赞同：60
> 
> 时间：2008-09-12T09:05:21.787

使用 jQuery，实际的 DOM 元素的索引为零，这应该可以

```
$('#a')[0].className = $('#a')[0].className.replace(/\bbg.*?\b/g, ''); 
```

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2011-12-24T12:59:24.093

我编写了一个简单的[jQuery 插件 - alterClass](https://gist.github.com/1517285)，它可以删除通配符类。也可以选择添加类。

```
$( '#foo' ).alterClass( 'foo-* bar-*', 'foobar' ) 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-09-11T22:36:36.900

你不需要任何 jQuery 特定的代码来处理这个。只需使用 RegExp 替换它们：

```
$("#a").className = $("#a").className.replace(/\bbg.*?\b/g, ''); 
```

您可以修改它以支持任何前缀，但更快的方法是上面的，因为 RegExp 将只编译一次：

```
function removeClassByPrefix(el, prefix) {
    var regx = new RegExp('\\b' + prefix + '.*?\\b', 'g');
    el.className = el.className.replace(regx, '');
    return el;
} 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2013-03-05T22:13:56.740

使用第二个[签名](http://api.jquery.com/removeClass/#removeClass-functionindex--class)：`$.fn.removeClass`

```
// Considering:
var $el = $('<div class="  foo-1 a b foo-2 c foo"/>');

function makeRemoveClassHandler(regex) {
  return function (index, classes) {
    return classes.split(/\s+/).filter(function (el) {return regex.test(el);}).join(' ');
  }
}

$el.removeClass(makeRemoveClassHandler(/^foo-/));
//> [<div class=​"a b c foo">​&lt;/div>​] 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2018-10-26T05:45:58.117

对于现代浏览器：

```
let element = $('#a')[0];
let cls = 'bg';

element.classList.remove.apply(element.classList, Array.from(element.classList).filter(v=>v.startsWith(cls))); 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2015-03-12T06:00:57.890

我将使用简单的 jQuery 构造和数组处理函数使用的一种方法是声明一个函数，该函数采用类的控件和前缀的 id 并删除所有分类。附上代码：

```
function removeclasses(controlIndex,classPrefix){
    var classes = $("#"+controlIndex).attr("class").split(" ");
    $.each(classes,function(index) {
        if(classes[index].indexOf(classPrefix)==0) {
            $("#"+controlIndex).removeClass(classes[index]);
        }
    });
} 
```

现在可以从任何地方调用此函数，单击按钮或代码：

```
removeclasses("a","bg"); 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-09T18:03:23.273

[http://www.mail-archive.com/jquery-en@googlegroups.com/msg03998.html](http://www.mail-archive.com/jquery-en@googlegroups.com/msg03998.html)说：

...和 ​​.removeClass() 将删除所有类...

这个对我有用 ;）

干杯

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-10-14T20:18:31.187

我正在寻找完全相同的问题的解决方案。删除所有以前缀“fontid_”开头的类 阅读完这篇文章后，我写了一个小插件，我现在正在使用它。

```
(function ($) {
        $.fn.removePrefixedClasses = function (prefix) {
            var classNames = $(this).attr('class').split(' '),
                className,
                newClassNames = [],
                i;
            //loop class names
            for(i = 0; i < classNames.length; i++) {
                className = classNames[i];
                // if prefix not found at the beggining of class name
                if(className.indexOf(prefix) !== 0) {
                    newClassNames.push(className);
                    continue;
                }
            }
            // write new list excluding filtered classNames
            $(this).attr('class', newClassNames.join(' '));
        };
    }(fQuery)); 
```

用法：

```
$('#elementId').removePrefixedClasses('prefix-of-classes_'); 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2017-07-03T11:23:14.157

在一行中...删除与正则表达式*someRegExp匹配的所有类*

```
$('#my_element_id').removeClass( function() { return (this.className.match(/someRegExp/g) || []).join(' ').replace(prog.status.toLowerCase(),'');}); 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-09-28T06:54:55.710

我知道这是一个老问题，但我找到了新的解决方案，想知道它是否有缺点？

```
$('#a')[0].className = $('#a')[0].className
                              .replace(/(^|\s)bg.*?(\s|$)/g, ' ')
                              .replace(/\s\s+/g, ' ')
                              .replace(/(^\s|\s$)/g, ''); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-12T01:19:49.987

Prestaul 的回答很有帮助，但对我来说不太管用。通过 id 选择对象的 jQuery 方法不起作用。我不得不使用

```
document.getElementById("a").className 
```

代替

```
$("#a").className 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-07-19T20:10:43.023

我还使用连字符'-' 和数字作为类名。所以我的版本包括 '\d-'

```
$('#a')[0].className = $('#a')[0].className.replace(/\bbg.\d-*?\b/g, ''); 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-12-19T02:47:39.963

```
(function($)
{
    return this.each(function()
    {
        var classes = $(this).attr('class');

        if(!classes || !regex) return false;

        var classArray = [];

        classes = classes.split(' ');

        for(var i=0, len=classes.length; i<len; i++) if(!classes[i].match(regex)) classArray.push(classes[i]);

        $(this).attr('class', classArray.join(' '));
    });
})(jQuery); 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-06-21T07:17:14.680

对于那些想要仅使用 jQuery 的解决方案的人来说，转换为 jQuery 的最佳答案：

```
const prefix = 'prefix'
const classes = el.attr('class').split(' ').filter(c => !c.startsWith(prefix))
el.attr('class', classes.join(' ').trim()) 
```

* * *

## 回答 #16

> 赞同：-6
> 
> 时间：2013-02-13T14:22:23.487

```
$("#element").removeAttr("class").addClass("yourClass"); 
```

# c# - 在 C# 中实例化 System.Xml.Serialization.XmlSerializer 时崩溃

> ID：57839
> 
> 赞同：2
> 
> 时间：2008-09-11T22:44:49.877
> 
> 标签：c#, .net, serialization

`System.Xml.Serialization.XmlSerializer`在 C# 库中实例化类的实例时，我们看到了崩溃。崩溃发生在构造函数中，当它尝试向字典添加重复键时。我在下面包含了一个堆栈跟踪。

这种崩溃只发生在一台机器上，修复我们的 .NET 3.5 安装并没有帮助。有没有其他人看到任何类似的问题？

```
System.ArgumentException was unhandled
  Message="Item has already been added. Key in dictionary: 'mainbuild'  Key being added: 'mainbuild'"
  Source="mscorlib"
  StackTrace:
       at System.Collections.Hashtable.Insert(Object key, Object nvalue, Boolean add)
       at System.Collections.Hashtable.Add(Object key, Object value)
       at System.Collections.Specialized.StringDictionary.Add(String key, String value)
       at System.CodeDom.Compiler.Executor.ExecWaitWithCaptureUnimpersonated(SafeUserTokenHandle userToken, String cmd, String currentDir, TempFileCollection tempFiles, String& outputName, String& errorName, String trueCmdLine)
       at System.CodeDom.Compiler.Executor.ExecWaitWithCapture(SafeUserTokenHandle userToken, String cmd, String currentDir, TempFileCollection tempFiles, String& outputName, String& errorName, String trueCmdLine)
       at Microsoft.CSharp.CSharpCodeGenerator.Compile(CompilerParameters options, String compilerDirectory, String compilerExe, String arguments, String& outputFile, Int32& nativeReturnValue, String trueArgs)
       at Microsoft.CSharp.CSharpCodeGenerator.FromFileBatch(CompilerParameters options, String[] fileNames)
       at Microsoft.CSharp.CSharpCodeGenerator.FromSourceBatch(CompilerParameters options, String[] sources)
       at Microsoft.CSharp.CSharpCodeGenerator.System.CodeDom.Compiler.ICodeCompiler.CompileAssemblyFromSourceBatch(CompilerParameters options, String[] sources)
       at System.CodeDom.Compiler.CodeDomProvider.CompileAssemblyFromSource(CompilerParameters options, String[] sources)
       at System.Xml.Serialization.Compiler.Compile(Assembly parent, String ns, XmlSerializerCompilerParameters xmlParameters, Evidence evidence)
       at System.Xml.Serialization.TempAssembly.GenerateAssembly(XmlMapping[] xmlMappings, Type[] types, String defaultNamespace, Evidence evidence, XmlSerializerCompilerParameters parameters, Assembly assembly, Hashtable assemblies)
       at System.Xml.Serialization.TempAssembly..ctor(XmlMapping[] xmlMappings, Type[] types, String defaultNamespace, String location, Evidence evidence)
       at System.Xml.Serialization.XmlSerializer.GenerateTempAssembly(XmlMapping xmlMapping, Type type, String defaultNamespace)
       at System.Xml.Serialization.XmlSerializer..ctor(Type type, String defaultNamespace)
       at System.Xml.Serialization.XmlSerializer..ctor(Type type)
       at OurTools.Tools.Common.XML.DataAccess`1.DeserializeFromXml(String strFilePath) in c:\AutomatedBuild\projects\1.0\OurTools.Tools.Common\OurTools.Tools.Common\XML\DataAcess.cs:line 100
       at OurTools.Tools.Common.ProjectFileManager.GetProjectInfoModel() in c:\AutomatedBuild\projects\1.0\OurTools.Tools.Common\OurTools.Tools.Common\ProjectFileManager.cs:line 252
       at OurTools.Tools.Common.ProjectFileManager.GetAvailableCultures() in c:\AutomatedBuild\projects\1.0\OurTools.Tools.Common\OurTools.Tools.Common\ProjectFileManager.cs:line 299
       at OurAppLib.GeneratorOptions.DefaultCultures() in c:\AutomatedBuild\projects\1.0\OurApp\OurAppLib\GeneratorOptions.cs:line 192
       at OurAppLib.GeneratorOptions.ReadCulturesFromArgs(List`1 arglist, String& errormsg) in c:\AutomatedBuild\projects\1.0\OurApp\OurAppLib\GeneratorOptions.cs:line 358
       at OurAppLib.GeneratorOptions.ReadFromArgs(String[] args, String& errormsg) in c:\AutomatedBuild\projects\1.0\OurApp\OurAppLib\GeneratorOptions.cs:line 261
       at OurApp.Program.Main(String[] args) in c:\AutomatedBuild\projects\1.0\OurApp\OurApp\Program.cs:line 76`print("code sample");` 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-11T23:20:55.623

找到了这个链接，它解释了这个问题： [http ://social.msdn.microsoft.com/forums/en-US/asmxandxml/thread/4476f044-bab9-492d-bb94-4e0960bd2d26](http://social.msdn.microsoft.com/forums/en-US/asmxandxml/thread/4476f044-bab9-492d-bb94-4e0960bd2d26)

快速总结：当序列化时，对象从所有环境变量中创建一个字典，但似乎对所有条目运行 ToLower()。因此，如果您有两个除大小写外相同的环境变量，您将遇到崩溃。

只有在像 cygwin 这样强制变量区分大小写的系统内部运行时，这才会成为问题。在我们的例子中，我们使用 make。

有几个解决方案，但它们都围绕着确保您的环境在您的 c# 应用程序运行时没有任何重复的变量。

# c# - 如何附加调试器以从托管（C#）包装器进入本机（C++）代码？

> ID：57840
> 
> 赞同：18
> 
> 时间：2008-09-11T22:45:29.470
> 
> 标签：c#, c++, visual-studio, debugging

我有一个从 C# 代码调用的 C++ 函数调用的包装器。如何在 Visual Studio 中附加调试器以单步执行本机 C++ 代码？

这是我拥有的调用 C++ 文件中定义的 GetData() 的包装器：

```
 [DllImport("Unmanaged.dll", CallingConvention=CallingConvention.Cdecl, 
               EntryPoint = "GetData", BestFitMapping = false)]
        public static extern String GetData(String url); 
```

代码崩溃了，我想调查根本原因。

谢谢，尼基尔

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-11T23:02:02.393

检查项目属性页面上的调试选项卡。应该有一个“启用非托管代码调试”复选框。当我们为旧的 c++ DLL 开发新的 .NET UI 时，这对我有用。

如果您的非托管 DLL 是从另一个项目构建的（有一段时间我们的项目是使用 VS6 构建的），请确保您有 DLL 的 pdb 文件方便调试。

另一种方法是使用 C# exe 作为目标 exe 从 DLL 项目运行，然后您可以正常调试您的 DLL。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-11T23:10:39.393

除了 Lou 对启动调试器的建议外，您还可以通过单击“附加到进程”对话框中的“选择...”并选择“托管代码”和“在附加到现有进程时使用哪些调试引擎”本机代码”。

以这种方式调试称为混合模式调试。有关一些提示，请参阅此[博客文章](http://blogs.msdn.com/sripod/archive/2006/12/05/debugging-mixed-mode-applications.aspx)。

我相信这不支持 64 位进程......虽然在这一点上很想错。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-12T13:29:00.813

对于使用 WinDbg 的任何人：

1>设置符号

看看这些命令。（帮助：在控制台 .hh <command> 中）

```
.sympath
.sympath+ 
.symfix 
```

2>设置源路径

```
.srcpath 
```

3>加载SOS扩展以调试托管/混合模式程序。

（确保您正确设置了扩展路径）

添加 Microsoft.NET\Framework\v2.0.50727 for x86 使用-

```
.extpath 
```

为要加载的 clr 设置断点。

```
sxe ld:mscorwks 
```

(F5 / g) (等待 mscorwks.dll 上的 ModLoad BP)

确保您没有已加载重复的 sos 扩展。看：

```
.chain 
```

现在我们准备加载sos扩展。:)

```
.loadby sos mscorwks 
```

4>重新加载所有符号..

```
.reload 
```

现在你都准备好了:)

(YMMV)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-08T22:47:40.730

64 位模式不支持混合调试（从 Visual Studio 2008 开始）。

# asp.net - ASP.NET 中的 BackgroundWorker 线程

> ID：57845
> 
> 赞同：20
> 
> 时间：2008-09-11T22:49:34.187
> 
> 标签：asp.net, multithreading

是否可以在[ASP.NET](http://en.wikipedia.org/wiki/ASP.NET) 2.0 中使用 BackGroundWorker 线程用于以下场景，使浏览器端的用户不必等待很长时间？

## 设想

1.  浏览器请求一个页面，比如 SendEmails.aspx
2.  SendEmails.aspx 页面创建一个 BackgroundWorker 线程，并为该线程提供足够的上下文来创建和发送电子邮件。
3.  浏览器收到来自 ComposeAndSendEmails.aspx 的响应，表示正在发送电子邮件。
4.  同时，后台线程正在进行创建和发送电子邮件的过程，这可能需要相当长的时间才能完成。

我主要关心的是保持 BackgroundWorker 线程运行，尝试发送 50 封电子邮件，而 ASP.NET workerprocess 线程池线程早已不复存在。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-11T23:00:23.770

如果您不想使用 AJAX 库，或者电子邮件处理真的很长并且会使标准 AJAX 请求超时，您可以使用 AsynchronousPostBack 方法，这是 .net 1.1 天的“旧技巧”。

本质上，您所做的是让您的提交按钮以异步状态开始电子邮件处理，同时将用户带到中间页面。这样做的好处是您可以根据需要尽可能多地刷新中间页面，而不必担心达到标准超时。

当您的后台进程完成后，它会在数据库/应用程序变量/任何东西中放置一个小的“完成”标志。当您的中间页面刷新自身时，它会检测到此标志并自动将用户重定向到“完成”页面。

同样，AJAX 使所有这些都没有实际意义，但如果由于某种原因您有一个非常密集或及时的过程必须通过 Web 完成，那么这个解决方案将适合您。[我在这里](http://www.simple-talk.com/dotnet/asp.net/asynchronous-client-script-callbacks/)找到了一个很好的教程，还有更多。

当我们在开发一个与第三方应用程序交互的“网络签到”类型的应用程序时，我不得不使用这样的过程，并且它们的导入 API 非常慢。

编辑：嘎！诅咒你古兹拉尔和你神一样的打字能力 8^D。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-11T23:20:28.417

您不应该从 ASP.NET 页面执行任何线程。当工作进程回收时，任何长时间运行的线程都有被杀死的危险。你无法预测何时会发生这种情况。任何长时间运行的进程都需要由 Windows 服务处理。例如，您可以通过在 MSMQ 中删除消息来启动这些过程。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-11T22:52:39.047

```
ThreadPool.QueueUserWorkItem(delegateThatSendsEmails) 
```

或在 System.Net.Mail.SmtpServer 上使用 SendAsync 方法。

您想将电子邮件发送代码放在另一个线程上，因为这样它会立即返回用户，并且只会处理，无论需要多长时间。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-11T22:55:56.573

有可能的。从页面异步启动新线程后，页面请求将继续并将页面发送回用户。异步线程将继续在服务器上运行，但不再有权访问会话。

如果您必须显示任务进度，请考虑一些 Ajax 技术。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-11T23:28:37.197

对于这种情况，您需要使用异步页面，这是 ASP.NET 2.0 中添加的一项功能

> 异步页面为 I/O 绑定请求引起的问题提供了一个巧妙的解决方案。页面处理在线程池线程上开始，但是一旦异步 I/O 操作开始响应来自 ASP.NET 的信号，该线程就会返回到线程池。操作完成后，ASP.NET 从线程池中获取另一个线程并完成对请求的处理。可伸缩性增加是因为线程池线程的使用效率更高。原本会等待 I/O 完成的线程现在可以用于服务其他请求。直接受益者是不执行冗长 I/O 操作并因此可以快速进出管道的请求。

[http://msdn.microsoft.com/en-us/magazine/cc163725.aspx](http://msdn.microsoft.com/en-us/magazine/cc163725.aspx)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-10T14:24:02.137

如果你想在你的 ASP 页面中使用多标题，你可以使用这样的简单线程模型：

```
{
    System.Threading.Thread _thread = new Thread(new ThreadStart(Activity_DoWork));
    _thred.Start();
}
Activity_DoWork()
{
    /*Do some things...
} 
```

此方法适用于 ASP 页。带有 BackgroundWorker 的 ASP 页面不会启动，而 BackgroundWorker 将完成。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-06-10T17:33:28.017

5 年后，问题依旧……如果你想从你的应用程序中执行即发即弃的操作并且忘记与 ASP.NET 应用程序中的后台作业处理相关的所有困难，你可以使用[http://hangfire.io](http://hangfire.io)。

*   它不会丢失您在回收过程中的工作，因为它使用持久存储来保存有关后台工作的信息。
*   它会自动重试因暂时异常（SMTP 服务器连接错误）而中止或失败的后台作业。
*   它允许您通过集成的 Web 界面轻松调试后台作业。
*   安装/配置/使用 HangFire 非常容易。

还有教程[Sending Mail in Background with ASP.NET MVC](http://docs.hangfire.io/en/latest/tutorials/send-email.html) for using HangFire with [Postal](http://aboutcode.net/postal/)。

# c# - .NET ListView 行填充

> ID：57849
> 
> 赞同：2
> 
> 时间：2008-09-11T22:53:25.767
> 
> 标签：c#, listview

似乎没有办法更改 .NET ListView 中所有行的填充（或行高）。有人有优雅的黑客攻击吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2012-10-25T15:51:38.383

我知道这篇文章已经相当老了，但是，如果您从未找到最佳选择，我有一篇[博客文章](http://qdevblog.blogspot.co.uk/2011/11/c-listview-item-spacing.html)可能会有所帮助，它涉及使用 LVM_SETICONSPACING。

**根据我的博客，**

最初，您需要添加：

```
using System.Runtime.InteropServices; 
```

接下来，您需要导入 DLL，以便您可以利用 SendMessage 来修改 ListView 参数。

```
[DllImport("user32.dll")]
public static extern int SendMessage(IntPtr hWnd, int msg, IntPtr wParam, IntPtr lParam); 
```

完成后，创建以下两个函数：

```
public int MakeLong(short lowPart, short highPart)
{
    return (int)(((ushort)lowPart) | (uint)(highPart << 16));
}

public void ListViewItem_SetSpacing(ListView listview, short leftPadding, short topPadding) 
{     
    const int LVM_FIRST = 0x1000;     
    const int LVM_SETICONSPACING = LVM_FIRST + 53;     
    SendMessage(listview.Handle, LVM_SETICONSPACING, IntPtr.Zero, (IntPtr)MakeLong(leftPadding, topPadding));      
} 
```

然后要使用该功能，只需传入您的 ListView，并设置值。在示例中，64 像素是图像宽度，32 像素是我的水平间距/填充，100 像素是图像高度，16 像素是我的垂直间距/填充，这两个参数都需要至少 4 像素。

```
ListViewItem_SetSpacing(this.listView1, 64 + 32, 100 + 16); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-12T00:03:39.907

一种解决方法是使用与您希望项目一样高的 ImageList。只需用背景颜色填充空白图像。您甚至可以将图像设置为 1 宽，以免水平占用太多空间。

# javascript - 如何关闭浏览器窗口而不收到“您要关闭此窗口”提示？

> ID：57854
> 
> 赞同：93
> 
> 时间：2008-09-11T22:59:39.293
> 
> 标签：javascript, browser

如何关闭浏览器窗口而不收到*是否要关闭此窗口*提示？

使用该`window.close();`功能时出现提示。

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2010-04-28T14:57:49.010

```
window.open('', '_self', ''); window.close(); 
```

这对我有用。

* * *

## 回答 #2

> 赞同：61
> 
> 时间：2014-07-20T19:45:21.987

*不允许*脚本关闭用户打开的窗口。这被认为是一种安全风险。尽管它没有任何标准，但所有浏览器供应商都遵循这一点（[Mozilla 文档](https://developer.mozilla.org/en-US/docs/Web/API/Window.close)）。如果在某些浏览器中发生这种情况，这是一个安全漏洞（理想情况下）会很快得到修补。

这个问题的答案中的任何黑客都不再有效，如果有人想出另一个肮脏的黑客，最终它也会停止工作。

我建议您不要为此浪费精力，而是采用浏览器为您提供的非常有用的方法——在您看似崩溃他们的页面之前*询问用户。*

* * *

## 回答 #3

> 赞同：58
> 
> 时间：2009-09-11T16:54:15.170

我的朋友......有一种方法，但“hack”并没有开始描述它。您必须基本上利用 IE 6 和 7 中的错误。

每次都有效！

而不是调用`window.close()`，重定向到另一个页面。

打开页面：

```
alert("No whammies!");
window.open("closer.htm", '_self'); 
```

重定向到另一个页面。这会欺骗 IE，让您关闭此页面上的浏览器。

关闭页面：

```
<script type="text/javascript">
    window.close();
</script> 
```

厉害吧？！

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2013-05-07T06:54:12.820

这是我用来在没有提示或警告的情况下关闭浏览器的 Javascript 函数，它也可以从 Flash 调用。它应该在 html 文件中。

```
 function closeWindows() {
         var browserName = navigator.appName;
         var browserVer = parseInt(navigator.appVersion);
         //alert(browserName + " : "+browserVer);

         //document.getElementById("flashContent").innerHTML = "<br>&nbsp;<font face='Arial' color='blue' size='2'><b> You have been logged out of the Game. Please Close Your Browser Window.</b></font>";

         if(browserName == "Microsoft Internet Explorer"){
             var ie7 = (document.all && !window.opera && window.XMLHttpRequest) ? true : false;  
             if (ie7)
             {  
               //This method is required to close a window without any prompt for IE7 & greater versions.
               window.open('','_parent','');
               window.close();
             }
            else
             {
               //This method is required to close a window without any prompt for IE6
               this.focus();
               self.opener = this;
               self.close();
             }
        }else{  
            //For NON-IE Browsers except Firefox which doesnt support Auto Close
            try{
                this.focus();
                self.opener = this;
                self.close();
            }
            catch(e){

            }

            try{
                window.open('','_self','');
                window.close();
            }
            catch(e){

            }
        }
    } 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2013-04-10T05:37:34.990

这适用于 Chrome 26、Internet Explorer 9 和 Safari 5.1.7（**不**使用帮助页面，ala Nick 的回答）：

```
<script type="text/javascript">
    window.open('javascript:window.open("", "_self", "");window.close();', '_self');
</script> 
```

嵌套`window.open`是为了让IE不显示*你要关闭这个窗口*的提示。

不幸的是，不可能让 Firefox 关闭窗口。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2010-12-13T18:42:05.560

在正文标签中：

```
<body onload="window.open('', '_self', '');"> 
```

要关闭窗口：

```
<a href="javascript:window.close();"> 
```

在 Safari 4.0.5、FF for Mac 3.6、IE 8.0 和 FF for Windows 3.5 上测试

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2011-08-31T20:04:26.587

出于安全原因，只有在 JavaScript 中打开的窗口才能在 JavaScript 中关闭。为了关闭窗口，您必须打开一个`_self`以目标为目标的新窗口，这将覆盖您当前的窗口，然后关闭该窗口（您可以这样做，因为它是通过 JavaScript 打开的）。

```
window.open('', '_self', '');
window.close(); 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2018-02-18T17:53:24.033

```
window.open('', '_self', '').close();
```

抱歉在这里有点晚了，但我找到了解决方案，至少对于我的情况。在 Safari 11.0.3 和 Google Chrome 64.0.3282.167 上测试

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2013-09-18T04:40:39.437

由于 IE 中的安全增强功能，您无法关闭窗口，除非它是由脚本打开的。所以解决这个问题的方法是让浏览器认为这个页面是使用脚本打开的，然后关闭窗口。下面是实现。

试试这个，它就像一个魅力！
***[javascript在不提示IE的情况下关闭当前窗口](http://www.dotnetbull.com/2011/12/closing-window-without-prompt-in.html)***

```
<script type="text/javascript">
function closeWP() {
 var Browser = navigator.appName;
 var indexB = Browser.indexOf('Explorer');

 if (indexB > 0) {
    var indexV = navigator.userAgent.indexOf('MSIE') + 5;
    var Version = navigator.userAgent.substring(indexV, indexV + 1);

    if (Version >= 7) {
        window.open('', '_self', '');
        window.close();
    }
    else if (Version == 6) {
        window.opener = null;
        window.close();
    }
    else {
        window.opener = '';
        window.close();
    }

 }
else {
    window.close();
 }
}
</script> 
```

## [javascript在不提示IE的情况下关闭当前窗口](http://www.dotnetbull.com/2011/12/closing-window-without-prompt-in.html)

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2008-09-11T23:04:05.290

从[这里](http://blogs.x2line.com/al/articles/350.aspx)：

```
<a href="javascript:window.opener='x';window.close();">Close</a> 
```

你需要设置`window.opener`一些东西，否则它会抱怨。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-04-03T09:35:44.497

```
window.opener=window;
window.close(); 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2012-12-17T12:30:51.830

创建一个 JavaScript 函数

```
<script type="text/javascript">
    function closeme() {
        window.open('', '_self', '');
        window.close();
    }
</script> 
```

现在编写这段代码并调用上面的 JavaScript 函数

```
<a href="Help.aspx" target="_blank" onclick="closeme();">Help</a> 
```

或者简单地说：

```
<a href="" onclick="closeme();">close</a> 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2016-02-11T09:50:36.053

这将起作用：

```
<script type="text/javascript">
function closeWindowNoPrompt()
{
window.open('', '_parent', '');
window.close();
}
</script> 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2017-04-17T13:11:53.493

在我的情况下，以下代码被嵌入到一个 php 文件中。

```
var PreventExitPop = true;
function ExitPop() {
  if (PreventExitPop != false) {
    return "Hold your horses! \n\nTake the time to reserve your place.Registrations might become paid or closed completely to newcomers!"
  }
}
window.onbeforeunload = ExitPop; 
```

所以我打开控制台并写下以下内容

```
PreventExitPop = false 
```

这解决了问题。因此，找出 JavaScript 代码并找到变量并将它们分配给适当的“值”，在我的情况下是“假”

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-11T23:05:47.547

浏览器抱怨是因为您使用 JavaScript 关闭了一个不是用 JavaScript 打开的窗口，即`window.open('foo.html');`.

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2014-11-11T11:44:23.460

将以下代码放在 ASPX 中。

```
<script language=javascript>
function CloseWindow() 
{
    window.open('', '_self', '');
    window.close();
}
</script> 
```

将以下代码放在按钮单击事件后面的代码中。

```
string myclosescript = "<script language='javascript' type='text/javascript'>CloseWindow();</script>";

Page.ClientScript.RegisterStartupScript(GetType(), "myclosescript", myclosescript); 
```

如果您在关闭之前没有任何处理，那么您可以直接将以下代码放入 ASPX 本身的按钮单击标记中。

```
OnClientClick="CloseWindow();" 
```

希望这可以帮助。

* * *

## 回答 #17

> 赞同：-2
> 
> 时间：2008-09-11T23:00:21.320

我找到的最佳解决方案是：

```
this.focus();
self.opener=this;
self.close(); 
```

* * *

## 回答 #18

> 赞同：-3
> 
> 时间：2015-10-08T14:23:06.943

我将发布此内容，因为这是我目前用于我的网站的内容，它在 Google Chrome 和 IE 10 中都可以使用，而不会收到任何弹出消息：

```
<html>
    <head>
    </head>
    <body onload="window.close();">
    </body>
</html> 
```

我的网站上有一个函数，我想运行它来将开/关变量保存到会话，而不直接进入新页面，所以我只打开一个小弹出网页。然后该网页会立即使用该`onload="window.close();"`功能自行关闭。

# windows-vista - 包含 Vista 上本地用户的 Programs 文件夹的文件夹的注册表项

> ID：57855
> 
> 赞同：0
> 
> 时间：2008-09-11T23:00:04.037
> 
> 标签：windows-vista, registry

我正在解决创建 Vista 快捷方式的问题。

我想确保我们的安装程序正在从正确的注册表项中读取 Programs 文件夹。

它从以下位置读取它：

```
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders\Programs 
```

它显示了这个程序目录：

```
C:\Users\NonAdmin2 UAC OFF\AppData\Roaming\Microsoft\Windows\Start Menu\Programs 
```

从我读过的内容来看，这似乎是正确的，但我想仔细检查一下。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-11T23:04:17.880

不要使用注册表来阅读此内容。将[SHGetFolderPath](http://msdn.microsoft.com/en-us/library/bb762181(VS.85).aspx)与 CSIDL_PROGRAMS 一起使用。

原因请参见 Raymond Chen 对“Shell Folders”键的评论：

[http://blogs.msdn.com/oldnewthing/archive/2003/11/03/55532.aspx](http://blogs.msdn.com/oldnewthing/archive/2003/11/03/55532.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T23:05:35.223

使用 Windows 安装程序属性。可能会更容易。

[http://msdn.microsoft.com/en-us/library/aa370905(VS.85).aspx#system_folder_properties](http://msdn.microsoft.com/en-us/library/aa370905(VS.85).aspx#system_folder_properties)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T23:07:06.670

您可能应该为此使用 API，例如[SHGetFolderPath](http://msdn.microsoft.com/en-us/library/bb762181(VS.85).aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-11T23:03:57.287

听起来对我来说是正确的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-12T01:06:47.227

VB 中的 SHGetFolderPath 示例 [http://support.microsoft.com/kb/252652](http://support.microsoft.com/kb/252652)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-12T03:18:37.050

有用的代码片段：

```
public class Utilities
{

    public enum FolderPaths
    {
        CSIDL_DESKTOP                   = 0x0000,        // <desktop>
        CSIDL_INTERNET                  = 0x0001,        // Internet Explorer (icon on desktop)
        CSIDL_PROGRAMS                  = 0x0002,        // Start Menu\Programs
        CSIDL_CONTROLS                  = 0x0003,        // My Computer\Control Panel
        CSIDL_PRINTERS                  = 0x0004,        // My Computer\Printers
        CSIDL_PERSONAL                  = 0x0005,        // My Documents
        CSIDL_FAVORITES                 = 0x0006,        // <user name>\Favorites
        CSIDL_STARTUP                   = 0x0007,        // Start Menu\Programs\Startup
        CSIDL_RECENT                    = 0x0008,        // <user name>\Recent
        CSIDL_SENDTO                    = 0x0009,        // <user name>\SendTo
        CSIDL_BITBUCKET                 = 0x000a,        // <desktop>\Recycle Bin
        CSIDL_STARTMENU                 = 0x000b,        // <user name>\Start Menu
        CSIDL_MYDOCUMENTS               = CSIDL_PERSONAL, //  Personal was just a silly name for My Documents
        CSIDL_MYMUSIC                   = 0x000d,        // "My Music" folder
        CSIDL_MYVIDEO                   = 0x000e,        // "My Videos" folder
        CSIDL_DESKTOPDIRECTORY          = 0x0010,        // <user name>\Desktop
        CSIDL_DRIVES                    = 0x0011,        // My Computer
        CSIDL_NETWORK                   = 0x0012,        // Network Neighborhood (My Network Places)
        CSIDL_NETHOOD                   = 0x0013,        // <user name>\nethood
        CSIDL_FONTS                     = 0x0014,        // windows\fonts
        CSIDL_TEMPLATES                 = 0x0015,
        CSIDL_COMMON_STARTMENU          = 0x0016,        // All Users\Start Menu
        CSIDL_COMMON_PROGRAMS           = 0X0017,        // All Users\Start Menu\Programs
        CSIDL_COMMON_STARTUP            = 0x0018,        // All Users\Startup
        CSIDL_COMMON_DESKTOPDIRECTORY   = 0x0019,        // All Users\Desktop
        CSIDL_APPDATA                   = 0x001a,        // <user name>\Application Data
        CSIDL_PRINTHOOD                 = 0x001b,        // <user name>\PrintHood
        CSIDL_LOCAL_APPDATA             = 0x001c        // <user name>\Local Settings\Applicaiton Data (non roaming)
    }

    [DllImport("shfolder.dll", CharSet = CharSet.Unicode)]
    public static extern int SHGetFolderPath(IntPtr owner, int folder, IntPtr token, int flags, StringBuilder path);
}

void MyFunction()
{
    StringBuilder path = new StringBuilder(260);

    String folderPath = "";
    if (0 == Utilities.SHGetFolderPath(IntPtr.Zero, (int) Utilities.FolderPaths.CSIDL_MYVIDEO, IntPtr.Zero, 0, path))
    {
        folderPath = path.ToString();
    }

} 
```

# resharper - 是否有符合所有 StyleCop 要求的标准 ReSharper 代码样式定义？

> ID：57859
> 
> 赞同：20
> 
> 时间：2008-09-11T23:00:55.860
> 
> 标签：resharper, stylecop

ReSharper 重新格式化代码功能非常方便和灵活，特别是 JetBrains 在 3.0 版中添加了新的代码布局模板灵活性。

是否有一组标准的 ReSharper 代码样式设置与[Microsoft StyleCop](http://code.msdn.microsoft.com/sourceanalysis)强制执行的规则相匹配，以便 StyleCop 合规性可以像运行 ReSharper“重新格式化代码”功能一样简单？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-17T12:25:01.907

尝试 ReSharper StyleCop 插件： http: [//www.codeplex.com/StyleCopForReSharper](http://www.codeplex.com/StyleCopForReSharper)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-07T08:12:42.037

我正在寻找同样的东西。

这是自定义类型成员布局：

```
<?xml version="1.0" encoding="utf-8"?>
<Patterns xmlns="urn:shemas-jetbrains-com:member-reordering-patterns">

  <!--Do not reorder COM interfaces and structs marked by 
      StructLayout attribute-->
  <Pattern>
    <Match>
      <Or Weight="100">
        <And>
          <Kind Is="interface"/>
          <HasAttribute CLRName="System.Runtime.InteropServices.InterfaceTypeAttribute"/>
        </And>
        <HasAttribute CLRName="System.Runtime.InteropServices.StructLayoutAttribute"/>
      </Or>
    </Match>
  </Pattern>

  <!--Special formatting of NUnit test fixture-->
  <Pattern RemoveAllRegions="true">
    <Match>
      <And Weight="100">
        <Kind Is="class"/>
        <HasAttribute CLRName="NUnit.Framework.TestFixtureAttribute" 
                      Inherit="true"/>
      </And>
    </Match>

    <!--Setup/Teardow-->
    <Entry>
      <Match>
        <And>
          <Kind Is="method"/>
          <Or>
            <HasAttribute CLRName="NUnit.Framework.SetUpAttribute" 
                          Inherit="true"/>
            <HasAttribute CLRName="NUnit.Framework.TearDownAttribute" 
                          Inherit="true"/>
            <HasAttribute CLRName="NUnit.Framework.FixtureSetUpAttribute" 
                          Inherit="true"/>
            <HasAttribute CLRName="NUnit.Framework.FixtureTearDownAttribute" 
                          Inherit="true"/>
          </Or>
        </And>
      </Match>
      <Group Region="Setup/Teardown"/>
    </Entry>

    <!--All other members-->
    <Entry/>

    <!--Test methods-->
    <Entry>
      <Match>
        <And Weight="100">
          <Kind Is="method"/>
          <HasAttribute CLRName="NUnit.Framework.TestAttribute" 
                        Inherit="false"/>
        </And>
      </Match>
      <Sort>
        <Name/>
      </Sort>
    </Entry>
  </Pattern>

  <!--Default pattern-->
  <Pattern>
    <!--public delegate-->
    <Entry>
      <Match>
        <And Weight="100">
          <Access Is="public"/>
          <Kind Is="delegate"/>
        </And>
      </Match>
      <Sort>
        <Name/>
      </Sort>
      <Group Region="Delegates"/>
    </Entry>

    <!--public enum-->
    <Entry>
      <Match>
        <And Weight="100">
          <Access Is="public"/>
          <Kind Is="enum"/>
        </And>
      </Match>
      <Sort>
        <Name/>
      </Sort>
      <Group>
        <Name Region="${Name} enum"/>
      </Group>
    </Entry>

    <!--fields and constants-->
    <Entry>
      <Match>
        <Or>
          <Kind Is="constant"/>
          <Kind Is="field"/>
        </Or>
      </Match>
      <Sort>
        <Kind Order="constant field"/>
        <Readonly/>
        <Static/>
        <Name/>
      </Sort>
      <Group Region="Fields"/>
    </Entry>

    <!-- Events-->
    <Entry>
      <Match>
        <Kind Is="event"/>
      </Match>
      <Sort>
        <Name/>
      </Sort>
      <Group Region="Events"/>
    </Entry>

    <!--Constructors. Place static one first-->
    <Entry>
      <Match>
        <Kind Is="constructor"/>
      </Match>
      <Sort>
        <Static/>
      </Sort>
      <Group Region="Constructors"/>
    </Entry>

    <!--properties, indexers-->
    <Entry>
      <Match>
        <Or>
          <Kind Is="property"/>
          <Kind Is="indexer"/>
        </Or>
      </Match>
      <Sort>
        <Name/>
      </Sort>
      <Group Region="Properties"/>
    </Entry>

    <!--interface implementations-->
    <Entry>
      <Match>
        <And Weight="100">
          <Kind Is="member"/>
          <ImplementsInterface/>
        </And>
      </Match>
      <Sort>
        <ImplementsInterface Immediate="true"/>
        <Kind Order="property"/>
        <Name/>
      </Sort>
      <Group>
        <ImplementsInterface Immediate="true" 
                             Region="${ImplementsInterface} Members"/>
      </Group>
    </Entry>

    <!-- public Methods -->
    <Entry>
      <Match>
        <And>
          <Kind Is="method"/>
          <Access Is="public"/>
        </And>
      </Match>
      <Sort>
        <Static/>
        <Name/>
      </Sort>
      <Group>
      </Group>
    </Entry>

    <!-- internal Methods -->
    <Entry>
      <Match>
        <And>
          <Kind Is="method"/>
          <Access Is="internal"/>
        </And>
      </Match>
      <Sort>
        <Static/>
        <Name/>
      </Sort>
      <Group>
      </Group>
    </Entry>

    <!--protected internal Methods -->
    <Entry>
      <Match>
        <And>
          <Kind Is="method"/>
          <Access Is="protected-internal"/>
        </And>
      </Match>
      <Sort>
        <Static/>
        <Name/>
      </Sort>
      <Group>
      </Group>
    </Entry>

    <!-- protected Methods -->
    <Entry>
      <Match>
        <And>
          <Kind Is="method"/>
          <Access Is="protected"/>
        </And>
      </Match>
      <Sort>
        <Static/>
        <Name/>
      </Sort>
      <Group>
      </Group>
    </Entry>

    <!-- private Methods -->
    <Entry>
      <Match>
        <And>
          <Kind Is="method"/>
          <Access Is="private"/>
        </And>
      </Match>
      <Sort>
        <Static/>
        <Name/>
      </Sort>
      <Group>
      </Group>
    </Entry>

    <!--all other members-->
    <Entry/>

    <!--nested types-->
    <Entry>
      <Match>
        <Kind Is="type"/>
      </Match>
      <Sort>
        <Name/>
      </Sort>
      <Group>
        <Name Region="Nested type: ${Name}"/>
      </Group>
    </Entry>
  </Pattern>
</Patterns>
<!--
I. Overall

I.1 Each pattern can have <Match>....</Match> element. For the given type 
    declaration, the pattern with the match, evaluated to 'true' with the 
    largest weight, will be used 
I.2 Each pattern consists of the sequence of <Entry>...</Entry> elements. 
    Type member declarations are distributed between entries
I.3 If pattern has RemoveAllRegions="true" attribute, then all regions 
    will be cleared prior to reordering. Otherwise, only auto-generated 
    regions will be cleared
I.4 The contents of each entry is sorted by given keys (First key is 
    primary,  next key is secondary, etc). Then the declarations are 
    grouped and en-regioned by given property

II. Available match operands

Each operand may have Weight="..." attribute. This weight will be added 
to the match weight if the operand is evaluated to 'true'.The default 
weight is 1

II.1 Boolean functions:
II.1.1 <And>....</And>
II.1.2 <Or>....</Or>
II.1.3 <Not>....</Not>

II.2 Operands
II.2.1  <Kind Is="..."/>. Kinds are: class, struct, interface, enum, 
        delegate, type, constructor, destructor, property, indexer, method, 
        operator, field, constant, event, member
II.2.2  <Name Is="..." [IgnoreCase="true/false"] />. The 'Is' attribute 
        contains regular expression
II.2.3  <HasAttribute CLRName="..." [Inherit="true/false"] />. The 'CLRName'
        attribute contains regular expression
II.2.4  <Access Is="..."/>. The 'Is' values are: public, protected, internal,
        protected internal, private
II.2.5  <Static/>
II.2.6  <Abstract/>
II.2.7  <Virtual/>
II.2.8  <Override/>
II.2.9  <Sealed/>
II.2.10 <Readonly/>
II.2.11 <ImplementsInterface CLRName="..."/>. The 'CLRName' attribute 
        contains regular expression
II.2.12 <HandlesEvent />
--> 
```

基于这个，这对我没有用，但谁值得称赞：http: [//www.clydesdalesoftware.net/blogs/jluif/CommentView,guid,1875594b-0d23-401f-8e22-f1cbf87beefe.aspx](http://www.clydesdalesoftware.net/blogs/jluif/CommentView,guid,1875594b-0d23-401f-8e22-f1cbf87beefe.aspx)

这是一个符合 stylecop 的标题片段：

```
// <copyright file="$FileName$" company="$Company$">
// Copyright (c) 2008 All Right Reserved
// </copyright>
// <author>$author$</author>
// <email>$email$</email>
// <date>$date$</date>
// <summary>$summary$</summary> 
```

仍然不完全在那里，但这是一个开始。

自此答案以来，自定义类型成员布局已放入 StyleCop for resharper 插件中。看[这里](http://1succeeded0failed0skipped.com/blogs/howardvanrooijen/archive/2008/12/07/stylecop-for-resharper-v0-0-14220-released.aspx)

# windows - 是否有解释整个（或大部分）Windows 注册表的 Windows 注册表“字典”？

> ID：57867
> 
> 赞同：20
> 
> 时间：2008-09-11T23:04:01.763
> 
> 标签：windows, registry

我希望能够查看注册表项的用途。一本关于注册表的书也可以。有关 Windows Vista 更改的信息会很棒！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-11T23:08:10.757

维基百科的文章实际上相当不错。不是对所有事情的完整说明，但也不是太破旧。 [http://en.wikipedia.org/wiki/Windows_Registry](http://en.wikipedia.org/wiki/Windows_Registry)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-12T00:50:29.793

哦，我多么希望有一个站点，所有在那里写值的人都集体记录了注册表！请记住，任何应用程序都可以创建自己的一组注册表项和值，因此不只是 MS 需要这样做。尽管他们将成为关键球员！

同时，当我需要知道特定键/值对的作用时，我使用两个 MS 站点作为起点：

Windows 2003 注册表参考： [http ://technet.microsoft.com/en-us/library/cc778196.aspx](http://technet.microsoft.com/en-us/library/cc778196.aspx)

Windows 2000 注册表参考： [http ://technet.microsoft.com/en-us/library/cc974061.aspx](http://www.microsoft.com/technet/prodtechnol/windows2000serv/reskit/default.mspx)

请记住，由于 Windows 是一个不断发展的事物，因此即使是有关旧版本的信息也会非常有用。另请注意，W2003 与 XP 有很多相似之处。遗憾的是，我还没有找到与上述类似的 Vista/Windows 2008 注册表的链接。

如果您需要了解特定密钥的情况，但在上述链接之一中找不到该密钥，请尝试在[http://support.microsoft.com上搜索该密钥的完整路径](http://support.microsoft.com)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-10-28T20:44:25.533

始终首先在 Windows SDK 中查找 API，而不是首先查找注册表项。例如，如果您将路径存储到用户的我的文档文件夹（是的，它在注册表中），那么当用户的注册表漫游到另一台用户的配置文件存储在不同位置的计算机时，您的代码可能会中断。

推荐阅读： [Shell Folders 键的漫长而悲伤的故事](http://blogs.msdn.com/b/oldnewthing/archive/2003/11/03/55532.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T23:14:50.117

我过去使用过[这个帮助文件](http://www.majorgeeks.com/Mystery_Behind_Windows_Registry_d415.html)。很好的资源

# oracle - SQL/Oracle：当可以使用多列索引时

> ID：57878
> 
> 赞同：20
> 
> 时间：2008-09-11T23:09:47.303
> 
> 标签：oracle, indexing

如果我按顺序在列（A、B、C）上创建索引，我的理解是即使我只搜索（A）或（A 和 B）或（ A 和 B 和 C)，但如果我只搜索 (B)、或 (C) 或 (B 和 C)，则不会。它是否正确？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-15T20:25:04.670

当谓词放在索引的非前导列上时，Oracle 实际上可以使用三种基于索引的访问方法。

i) 索引跳过扫描：http: [//download.oracle.com/docs/cd/B19306_01/server.102/b14211/optimops.htm#PFGRF10105](http://download.oracle.com/docs/cd/B19306_01/server.102/b14211/optimops.htm#PFGRF10105)

ii) 快速全索引扫描：http: [//download.oracle.com/docs/cd/B19306_01/server.102/b14211/optimops.htm#i52044](http://download.oracle.com/docs/cd/B19306_01/server.102/b14211/optimops.htm#i52044)

iii) 索引全扫描：http: [//download.oracle.com/docs/cd/B19306_01/server.102/b14211/optimops.htm#i82107](http://download.oracle.com/docs/cd/B19306_01/server.102/b14211/optimops.htm#i82107)

我经常“在野外”看到快速全索引扫描，但一切皆有可能。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-12T15:47:58.950

这是不正确的。总是最好拿出一个代表您的数据的测试用例并亲自查看。如果你想真正了解 Oracle SQL Optimizer google Jonathan Lewis，阅读他的书籍、阅读他的博客、查看他的网站，这个人很棒，而且他总是会生成测试用例。

```
create table mytab nologging as (
select mod(rownum, 3) x, rownum  y, mod(rownum, 3) z from all_objects, (select 'x' from user_tables where rownum < 4)
);

create index i on mytab (x, y, z);

exec dbms_stats.gather_table_stats(ownname=>'DBADMIN',tabname=>'MYTAB', cascade=>true);

set autot trace exp

select * from mytab where y=5000;

Execution Plan
----------------------------------------------------------
   0      SELECT STATEMENT Optimizer=CHOOSE (Cost=1 Card=1 Bytes=10)
   1    0   INDEX (SKIP SCAN) OF 'I' (INDEX) (Cost=1 Card=1 Bytes=10) 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-15T12:46:25.367

**直到 Oracle 8 版本**，除非第一列包含在 SQL 中，否则永远不会使用索引。

在 Oracle 9i 中引入了**跳过扫描索引访问**特性，它允许 Oracle CBO 尝试使用索引，即使前缀列不可用。

在这里很好地概述了跳过扫描的工作原理：[http ://www.quest-pipelines.com/newsletter-v5/1004_C.htm](http://www.quest-pipelines.com/newsletter-v5/1004_C.htm)

# solaris - 您对 Sun CoolThreads 技术有何体验？

> ID：57902
> 
> 赞同：4
> 
> 时间：2008-09-11T23:29:43.233
> 
> 标签：solaris

我的项目在财政年度结束前有一些钱可以花掉，我们正在考虑更换我们已经使用了几年的 Sun-Fire-V490 服务器。我们正在研究的一种选择是[CoolThreads](http://www.sun.com/servers/coolthreads/overview/index.jsp)技术。我所知道的只是 Sun 的营销，它可能不是 100% 公正的。有人真的玩过其中一个吗？

我怀疑这对我们没有任何价值，因为我们很少使用线程或虚拟机，而且我们不能花很多时间来改进代码。我们确实产生了大量的进程，但我怀疑 CoolThreads 在那里会有所帮助。

（是的，这笔钱最好花在奖金或其他东西上，但这不会发生。）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-11T23:57:01.373

IIRCcoolthreads 技术指的是这样一个事实，即他们现在正在寻找具有超线程的多核处理器，而不是仅仅提高时钟速度以提高性能，从而有效地在一个芯片上为您提供大量处理器。总体而言，可用的处理能力更高，但没有您期望的额外电力和空调要求（因此很酷）。它的用处绝对取决于你打算在它上面运行什么。如果您使用多线程内核运行 Apache，它会喜欢它，因为它可以在单个 cpu 内核上运行单个响应线程。如果您只是运行单线程进程，您将在单个 cpu 盒上获得一些性能提升，但不会那么好（任何老式的非 mod_perl/mod_python CGID 进程仍然会共享 cpu）。如果您的应用程序由一个单线程进程组成，该进程在机器上以最大的速度运行，那么在以相同速度运行的单核 cpu 上，您将获得很少的改进。

彼得

编辑：

哦，作为一个基准。我们将服务器场中的 T2000 与我们当前的 V240 进行了比较（我不记得可能是 V480） T2000 在实时测试中承受了 12-13 个旧机器的负载，而没有任何操作系统调整性能。正如我所说的 Apache 喜欢它:-)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-12T12:51:37.860

**披露：我为 Sun 工作**（但作为客户端软件工程师）。

您不一定需要多线程代码来使用这些机器。拥有多个进程将利用多个内核上的多个硬件线程。

旧的 T1 处理器（T1000 和 T2000 盒子）确实只有一个 FPU，并且并不真正适合浮点数超过 1% 的任务。较新的 T2 和 T2+ 处理器的每个内核都有一个 FPU。对于大规模浮点运算来说，这可能仍然不是很好，但更受人尊敬。

（注意：超线程技术是 Intel 的商标。Sun 使用术语芯片多线程 (CMT)。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-12T00:02:51.280

我们在我的最后一个系统中使用了 Sun Fire T2000s。就处理能力而言，这些盒子本身远远超出了我们的容量要求。对我们来说，这个决定是基于较低的功耗和空间要求。我们在同一个机器上成功地运行了 WebSphere 6、Oracle 10g 和 SunONE Directory 服务器。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-12T06:12:39.877

我的信息可能有点过时（上次使用这些服务器是 2 年前），但我记得一个大问题是单个 CPU 上的所有内核都共享*同一个*FPU 单元，所以如果你的代码做了很多浮动点（我们正在做 GIS）FPU 是一个巨大的瓶颈，您并没有从大量线程中获得太多好处。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-12T06:38:12.937

对于任何具有高并行性的过程，这些机器（例如 t1000/t2000）的成本都很高。我已经在它们上运行 oracle 大约 18 个月了，效果很好。

如果您的任务是单线程/单进程，那么您最好使用高速双/四核英特尔机器。

如果您的应用程序有很多线程/大量进程，那么这些机器可能会非常适合它。

最重要的是，Sun 将在 60 天内向您发送一个评估，这是我们在承诺之前所做的，最终获得了 2 个 t2000，最近又购买了 4 个 t1000。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-12T17:29:34.260

昨晚让我印象深刻的是，我们的核心进程不是多线程的，但有问题的机器确实有一堆系统进程。特别是，它充当 NFS 服务器。听起来运行数百个进程也将从所有这些内核中受益。

我会看看我们是否可以先获得一个演示单元进行测试。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-09T15:47:04.230

Sun 一直在向所有人出售 Niagra 机器，使其成为万能的。它们确实有自己的位置：Web 服务是最好的部署。我们在一些 T2000 上运行了 Oracle，它在高度并行化的操作中运行良好。但是机器在单踏板操作上表现不佳，其性能相当糟糕。如果您有浮点工作要做，请寻找其他地方。即使是每核一个 FPU 的较新芯片也不够用。此外，这些机器不能长时间承受企业级的冲击，而且我们遇到了可靠性问题。多核技术更多的是炒作而不是实质。桑迪亚国家实验室对它的研究发现，4 到 8 核大约是最高端的有用性，16 核芯片的吞吐量与双核芯片相同。所以一个16核的芯片浪费了很多钱。还，随着核心数量的增加，时钟速度必须降低，因为存在热壁。在内存技术改进之前，大多数制造商可能会选择四核芯片（你不能让 16 个核心为内存提供支持，并且大多数核心都停滞不前）。最后，考虑到 Sun 的混乱情况，你最好去别处看看。

# .net - 创建新的 GUI 时，WPF 是不是 Windows 窗体的首选？

> ID：57909
> 
> 赞同：47
> 
> 时间：2008-09-11T23:33:59.913
> 
> 标签：.net, wpf, winforms, .net-3.5, .net-3.0

Windows 窗体的大多数限制和技巧对大多数程序员来说都是常见的。但由于 .NET 3.0 也有 WPF 可用，即 Windows Presentation Foundation。据说您可以使用它使“性感应用程序”更容易，并且使用 .NET 3.5 SP1 可以很好地提高执行速度。

但另一方面，很多事情都与 WPF 不同。我不会说它更难，但你必须从头开始学习“一切”。

我的问题：当您必须创建一个新的 GUI 并且项目没有时间压力时，是否值得花费这些额外的时间？

* * *

## 回答 #1

> 赞同：148
> 
> 时间：2009-03-04T10:18:44.680

[在尝试在 WPF 上敲定一个业务线](http://en.wikipedia.org/wiki/Line_of_business)(LOB) 应用程序三个月后，我达到了考虑将我的项目转回 Windows 窗体的地步，并在研究其他人的意见时，遇到了这个线程......

是的，WPF 是一项出色的技术，它所带来的好处远远超出了视觉上的吸引力……模板和绑定功能就是很好的例子。整个对象模型提供了更大的灵活性和更广泛的可能性。然而，这并不能使它成为未来 LOB 应用程序的实际平台。

WPF 在将 GUI 与业务逻辑分离方面解决的“问题”并不是在 Windows 窗体中通过简单地从正确的架构和思维方式开始就无法轻易解决的问题。甚至 WPF 的对象路径绑定功能也可以通过一些非常简单的帮助类在 Windows 窗体中重现。WPF 的数据模板功能非常好，但在极少数情况下，当您完全不知道要在任何给定部分上表示哪些对象时，它们又不是您无法在 Windows 窗体中模拟的。屏幕。

Windows Forms 领先的地方在于成熟度。如果不访问某人为您解决了 Windows 窗体问题的博客，您就无法在 Google 上挥动一只死猫。另一方面，WPF 的可用学习资源相对较少，可用的自定义控件较少，而且还没有解决很多初期问题。

在做出 WPF 与 Windows 窗体决策的高峰期，必须是开发环境的成熟度。Windows 窗体编辑器流畅、响应迅速且直观。有关错误的反馈会立即发送给您，解决方案通常很明显，并且 Windows 窗体中的编译->调试->编辑周期非常快。

另一方面，WPF 应用程序具有相对可怜的设计时支持，设计视图在第一次遇到错误时已经准备好退出，通常需要在修复后构建项目，然后设计师才愿意参与再次。考虑到在很多情况下它要么根本不起作用，要么产生完全不直观的结果，因此也可能不支持从工具箱中拖放组件。尽管有 WpfToolkit 的承诺，但仍然没有用于 WPF 的可用 DataGrid 产生任何类型的合理性能或设计时间友好性。

调试 WPF 应用程序有点像*旧*的ASP.NET 调试范例...命中`F5`-> 等待 -> 启动 -> 错误 -> 停止 -> 修复 -> 命中`F5`-> 等待 -> 启动 -> 错误 -> 呻吟 -> stop -> fix -> hit `F5`.... 程序运行的所有 XAML 都被锁定，跟踪 XAML 特定问题通常很乏味。

简而言之，Windows 窗体的开发工具将让您在 WPF 应用程序的一小部分时间内完成前端工作……*尤其是*在您创建主从网格或电子表格时像大多数 LOB 都有的接口。使用 Windows 窗体，您可以从已经为您完成的 90% 的工作开始。

我是 WPF 架构的忠实粉丝。我只是希望设计时工具集不像预 alpha 调试构建。

* * *

编辑：这个答案是关于 .NET 3.5 + Visual Studio 2008 发布的，但是带有 Visual Studio 2010 的 .NET 4.0 附带了 WPF 数据网格。虽然对新的 WPF 开发体验进行了许多改进，但我这里的回答保持不变，我想补充以下建议：

如果您急于进行[RAD](http://en.wikipedia.org/wiki/Rapid_application_development)开发，请使用 Windows 窗体。如果您正在寻找构建良好、可维护、可扩展、资源友好、多用户的业务线应用程序，请考虑使用 ASP.NET MVC + HTML 5 + jQuery ......我使用这些技术的项目带来了更好的结果为我的客户更快地取得成果。MVC 提供了与 WPF 相同的模板，而 jQuery 支持动画和复杂的交互。更重要的是，ASP.NET MVC + jQuery 解决方案不要求您的最终用户拥有具有良好图形硬件的现代桌面。

* * *

## 回答 #2

> 赞同：84
> 
> 时间：2009-07-06T14:02:11.977

我已经使用 WPF 七个月了，现在它已成为我的客户的核心系统，我想与您分享一些关于学习和使用 WPF 作为业务线演示平台的经验的更多想法。

总的来说，我上面的评论仍然成立…… WPF 的设计时支持还没有出现。如果您急于推出富客户端应用程序，请使用 Windows 窗体。时期。Microsoft 并不急于停止 GDI / Windows Forms 平台，因此您可以在未来一段时间内获得良好的支持。

**WPF 并不容易掌握**，但这不应该是您决定是否投入时间和精力学习 WPF 的地方。尽管 WPF 目前还不够成熟，但它是围绕一些有用的现代概念构建的。

例如，在 WPF 中，您对编写良好且具有健全验证逻辑的业务对象的投资是一项可靠的投资。与 Windows 窗体不同，WPF 的数据绑定充满了允许界面控件对无效的用户输入做出反应*而无需编写 GUI 代码*来检测这些错误的功能。这是有价值的。

WPF 中的样式和模板功能也被证明是有价值的。尽管人们普遍认为样式和模板的唯一用途是创建屏幕上的视觉效果，但事实是这些功能显着简化了提供丰富反馈的用户界面的编码 - 例如禁用/启用自身的按钮底层业务逻辑层的状态，或根据光标下对象的状态智能查找其文本的工具提示等。

*所有这些都为“没什么花哨的”业务应用程序*添加了非常有价值的功能，仅仅是因为它们使界面与底层数据保持一致变得容易。

简而言之：

*   在 Windows 窗体中，您设计用户界面，然后编写代码来驱动该用户界面，这通常还包括驱动数据对象的代码。
*   在 WPF 中，您投资于驱动数据对象的业务层，然后设计一个*侦听*数据对象的接口。

这似乎是一个微妙的差异，但它对您重用代码的能力产生了巨大的影响......这就引出了一个问题：“Windows 窗体与 WPF 的问题实际上是一个投资决定吗？”

（这似乎已成为我最喜欢的线程。）

* * *

## 回答 #3

> 赞同：73
> 
> 时间：2009-11-07T17:23:23.203

**是否有任何令人信服的理由使用 WPF**

绝对地！WPF 绝对令人难以置信！对于几乎任何项目来说，这将是一个主要的好处，因为它具有 Windows 窗体所缺乏的许多特性和能力。

对于业务应用程序，最大的胜利将是：

*   奇妙的数据绑定和模板是最大的不同。一旦一个体面的数据模型就位，只需单击几下即可创建数据模板并使用[Expression Blend](http://en.wikipedia.org/wiki/Microsoft_Expression_Blend)使用拖放操作准确配置对象的外观。绑定到颜色或形状之类的东西是微不足道的。
*   屏幕布局非常灵活。WPF 中的所有内容不仅可以平滑地适应容器大小和形状的变化，而且可以轻松地放大和旋转项目，甚至可以延伸到其包含框架之外。
*   普通对象可以以任何你喜欢的方式呈现，可以很容易地在不同的屏幕上有不同的呈现，可以共享呈现，并且可以使它们的呈现适应数据值的变化。
*   如果您需要打印，渲染到打印机是微不足道的。如果配置正确，WPF 会使[Crystal Reports](http://en.wikipedia.org/wiki/Crystal_Reports)或[SQL Server Reporting Services](http://en.wikipedia.org/wiki/SQL_Server_Reporting_Services) (SSRS) 看起来像孩子的玩具。
*   您的用户界面看起来和感觉都更加动态，包括一些不错的功能，例如当您将鼠标移过它们时会产生动画效果的按钮。

对于实用程序和游戏而言，其他优势尤为突出：

*   您可以轻松地将形状、线条和任意图形添加到您的应用程序中，而无需使用外部编辑器。这些组件的每个组件都可以是数据绑定和动画的，或者由代码控制。在 Windows 窗体中，您通常只需要导入位图并按原样使用它，除非您想进行大量工作。
*   动画很酷！只要您不过度使用它，用户就会真正印象深刻。它们还可以帮助人们了解正在发生的事情并减少对突出显示的需求。例如，当拖动一个对象时，您可以为目标设置动画以显示如果您放下它会发生什么。
*   颜色，渐变填充，画笔，花哨的字体，任何对象的旋转，瓷砖画笔等。您想要的任何图形都可以满足您的要求。
*   令人难以置信的可定制性。我需要为一个应用程序绘制铁轨，这样我就可以在上面放一列火车。[几个小时后，我有了可以使用贝塞尔曲线](http://en.wikipedia.org/wiki/B%C3%A9zier_curve)在屏幕上任意位置绘制的铁轨，它们会自动连接并切换。

最重要的是，您可以在 Windows 窗体中构建的任何大型 GUI 都可以在 WPF 中构建，只需三分之一（或更少）的工作量，并且看起来更好。

**WPF 是否需要更多资源（尤其是 RAM）**

与 Windows 窗体相比，您确实付出了一些代价，但代价很小。

*   RAM 可以上升或下降，具体取决于您的实施。WPF 更有效地存储其数据，因此单个对象更小，但 WPF 中的对象往往比 Windows 窗体中的更多，因此这是平衡的，任何一个都可以领先。
*   与 Windows 窗体相比，CPU 会上升。根据我的经验，屏幕上 WPF 对象的实际更新占用的 CPU 大约是普通 Windows 窗体渲染的两倍。如果您的应用程序大部分时间都在更新屏幕，那么 WPF 可能不适合您。但在这种情况下，您可能也没有使用 Windows 窗体：大多数严肃的游戏都是直接写入[DirectX](http://en.wikipedia.org/wiki/DirectX)的。
*   WPF 的磁盘使用量会稍微少一些，因为它使用的代码比 Windows 窗体少得多。当然，数据大小相同。

关于 CPU 使用的另一个注意事项：动画和变换（运动、平移等）实际上在 WPF 上比在 Windows 窗体中更有效，因为它具有保留模式存储。最初获取物体的速度较慢。

**维护费用**

在维护方面， WPF 是对 Windows 窗体的**巨大**胜利。由于一切都是用以前的 1/5 代码完成的，因此需要维护的代码也只有 1/5。此外，所有样板文件都消失了，因此您可以专注于实际完成工作的代码。

**XAML 的好处**

[XAML](http://en.wikipedia.org/wiki/Extensible_Application_Markup_Language)是 WPF 的核心。尽管 WPF 可以在没有 XAML 的情况下使用，但 XAML 使其非常易于使用。XAML 具有 HTML 轻松指定用户界面的能力，但其内置标签功能更强大，您可以轻松定义自己的标签。（其实这样做很正常）。

XAML 的一些特定优势：

*   您的整个 UI 都定义在一个易于阅读和操作的文本文件中，对于用户和工具来说都是如此
*   MarkupExtensions 允许以清晰简单的方式指定绑定
*   类型转换器允许轻松指定具有复杂类型的属性。例如，您可以说 Brush="Green" 或者您可以指定具有三个停止点的径向渐变画笔。
*   您可以创建自己的元素
*   您可以轻松利用 WPF 强大的“附加属性”

**其他见解**

多年来，我一直梦想着像 WPF 这样的东西。许多人已经实现了这个功能的一部分，但是以这样的价格（0 美元）将它们全部集中在一个地方是惊人的。

WPF 是从 Windows 窗体发生的巨大范式转变，需要一些时间来适应，但花在学习上的时间会带来很多倍的回报。

WPF 即使在五年后仍然有一些缺点，但一旦你体验它的力量，它的力量会让你大吃一惊。如果有人试图将您拖回 Windows 窗体，您只会大喊大叫。

提示： - 一定要获得一份用于开发的 Expression Blend - 偶尔手动编辑 XAML - 当它一开始看起来很奇怪时不要放弃

* * *

## 回答 #4

> 赞同：72
> 
> 时间：2008-09-16T18:22:01.510

WPF 使您能够做一些令人惊奇的事情，我喜欢它……但是，每当开发人员问我是否认为他们应该转向新技术时，我总是觉得有义务证明我的建议。

您的开发人员是否愿意（最好是 EAGER）花时间学习有效地使用 WPF？我从来没有想过要对 MFC、Windows 窗体甚至非托管 DirectX 这么说，但您可能不希望团队在正常开发过程中尝试“拿起”WPF。运输产品的周期！

是否至少有一两个开发人员具有一定的设计敏感性，并且具有最终设计权限的个人是否对开发问题有很好的理解，因此您可以利用 WPF 功能来创建实际上更好的东西，而不仅仅是更“多彩” ，以免费动画为特色？

您的目标客户群中是否有一部分运行在可能不支持您计划的功能的集成图形芯片组上——或者他们是否仍在运行 Windows 2000，这将完全排除他们作为客户的身份？有些人还会问您的客户是否真的关心增强的视觉效果，但是在经历了 90 年代初期公司内部“我们的业务客户不关心颜色和图片”的辩论后，我知道您的竞争对手精心设计的解决方案会让他们关心，真正的问题是条件是否合适，使您能够提供让他们现在关心的东西。

项目是否涉及底层开发，至少对于表示层，以避免尝试挂钩到不兼容的遗留脚手架的额外复杂性（与 Win Forms 的互操作不是无缝的）？

您的经理能否接受（或分散注意力）在四到六个月内开发人员生产力的显着下降？

最后一个问题是由于我喜欢将 WPF 视为“FizzBin”性质，有十种不同的方式来实现任何任务，没有明显的理由偏爱一种方法，而且很少有指导可以帮助您制作选择。您所做的任何选择的缺点不仅会在项目的后期变得很明显，而且您几乎可以保证项目中的每个开发人员都采用不同的方法，从而导致严重的维护问题。最令人沮丧的是，当您尝试学习该框架时，经常会遇到不一致性。

您可以在我的博客上的条目中找到更深入的 WPF 相关信息：

[http://missedmemo.com/blog/2008/09/13/WPFTheFizzBinAPI.aspx](http://missedmemo.com/blog/2008/09/13/WPFTheFizzBinAPI.aspx)

* * *

## 回答 #5

> 赞同：62
> 
> 时间：2008-12-23T11:56:53.337

WPF 需要 Windows Vista 或 Windows XP SP2，这不是一项繁重的要求，但它是一个相关的要求。如果您想在 Windows 2000 上运行（有些人仍然这样做），那么 WPF 将不适合您。

WPF 也是一种较新的技术，不如 Windows 窗体经过验证，因此您可以选择 Windows 窗体作为风险较小的选项，尤其是对于较大的应用程序。

话虽如此，是的，WPF 是未来。Visual Studio 2010 正在用 WPF 重写，这可能是迄今为止最大的 WPF 应用程序，它也将是对该技术的真正测试。

显然，旧的 Windows 窗体应用程序将是另一种情况，它是正确的选择。

* * *

## 回答 #6

> 赞同：50
> 
> 时间：2008-10-14T18:40:38.190

正如其他人所说，无论你走到这里，都有优点和缺点。正如其他人所说，WPF 的优点包括：

*   能够*相对*轻松地制作非常丰富的 UI。
*   更简单的动画和特殊效果
*   固有的可伸缩性（在 WPF 应用程序和 Windows 窗体应用程序上使用 Windows Vista 放大镜工具：请注意，在 WPF 应用程序中，所有矢量图都可以很好地缩放）
*   （意见提醒）我觉得在 WPF 中做面向文档的系统“更容易”

但是，WPF 也有一些缺点，Windows 窗体在其中占据优势：

*   WPF 的内置控件套件远比 Windows 窗体受限。
*   Windows 窗体的第三方控件空间提供了更多支持。（当然，这种情况正在发生变化，但请考虑一下：Windows 窗体自 2001 年以来就已经存在；WPF 仅仅几年。通过时间优势，Windows 窗体在社区中得到了更大的支持。）
*   大多数开发人员已经知道 Windows 窗体；WPF 提供了新的学习曲线

最后，请记住，如果您完成工作（或使用正确的第三方工具），您可以在任一工具中创建出色、有吸引力和引人入胜的 UI。归根结底，在所有情况下，两者都不一定更好。使用适合项目的东西。

* * *

## 回答 #7

> 赞同：24
> 
> 时间：2009-03-09T06:34:05.257

WPF 的编程模型比 Windows 窗体更开放和灵活，但与 ASP.NET MVC 一样，它在正确实现模型-视图-视图模型模式方面需要更多的纪律。

我的第一个使用 WPF 的[LOB](http://en.wikipedia.org/wiki/Line_of_business)应用程序最终彻底失败了，因为它占用了大量资源，导致我的最终用户的超低端笔记本电脑陷入停顿……这最终是因为我刚刚加入了 WPF + [LINQ to SQL](http://en.wikipedia.org/wiki/Language_Integrated_Query#LINQ_to_SQL)并期望得到一个好的结果......这就是 WPF 与 Windows 窗体如此强烈不同的地方......在 Windows 窗体中，你可以摆脱这种事情。WPF 在资源上比 Windows 窗体要重得多，如果您不将应用程序设计为精简，您最终会得到一个 800 磅的大猩猩。

不要回避 WPF... 探索它。但请注意，Windows 窗体编码可接受的错误不会在 WPF 中产生良好的结果。它们是根本不同的引擎，它们适用于根本不同的编码模式。

最后一句话：如果您继续使用 WPF，请熟悉用于列表和网格的数据虚拟化。什么是简单的数据绑定 ListItem 或 GridCell 最终会成为 WPF 中庞大的逻辑 + 可视对象图，如果您不学习如何虚​​拟化，您的应用程序将无法在大型数据集上表现良好。

* * *

## 回答 #8

> 赞同：18
> 
> 时间：2008-09-12T00:46:27.853

WPF 有一个非常陡峭的学习曲线，我建议您首先获得显而易见的书籍（[Adam Nathan](https://rads.stackoverflow.com/amzn/click/com/0672328917 "Windows Presentation Foundation Unleashed (WPF)")、 [Sells/Griffiths](https://rads.stackoverflow.com/amzn/click/com/0596510373 "编程 WPF")和 [Chris Anderson](https://rads.stackoverflow.com/amzn/click/com/0321374479 "基本 Windows 演示基础 (WPF)")）和博客（[Josh Smith](http://joshsmithonwpf.wordpress.com/)等）。只需为此做好准备，并确保您的项目允许您有时间学习 WPF。

除了学习技术之外，还要花一些时间学习用于构建 WPF 应用程序的模式。[模型视图视图模型](http://en.wikipedia.org/wiki/Model_View_ViewModel)(MVVM) 似乎是获得了广泛认可的模型。

就个人而言，我认为 WPF 是值得的，但要预先警告。另请注意，您有效地将用户限制为 Windows XP SP2+ 和 Windows Vista。我们已经做出了决定，但您可能有一些不同的要求。

* * *

## 回答 #9

> 赞同：18
> 
> 时间：2008-12-23T12:09:07.197

这两种技术都有其优点和缺点。在具有“经典” UI 的大型应用程序中，我会使用 Windows 窗体。在需要丰富用户界面（皮肤、动画、更改用户界面）的应用程序中，我会选择 WPF。请查看比较 WPF 和 Windows 窗体的文章*[WPF 与 Windows](http://joshsmithonwpf.wordpress.com/2007/09/05/wpf-vs-windows-forms/)*窗体。

* * *

## 回答 #10

> 赞同：15
> 
> 时间：2009-05-19T22:37:30.597

除了 UI 设计的灵活性之外，WPF 还有一些技术优势：

**1.) WPF 不依赖于 GDI 对象。** 好吧，我认为它使用 2 个 GDI 对象作为窗口本身的实例，但这实际上没什么。我在一定程度上参与了一个非常大的内部 Windows 窗体应用程序。我们办公室的人有时会同时运行 3 或 4 个实例。问题是它们经常遇到 Windows 2000、XP 和 Vista 固有的 10,000 个 GDI 对象限制。发生这种情况时，整个操作系统变得无响应，您将开始看到视觉伪影。清除它的唯一方法是关闭应用程序。

**2.) WPF 利用 GPU。** WPF 将一些 UI 处理卸载到 GPU 的能力非常出色。我只希望它的这方面随着时间的推移会变得更好。作为前 OpenGL 编程爱好者，我可以体会到来自 GPU 的力量。我的意思是，我 100 美元的显卡有 112 个内核，每个内核运行频率为 1.5 GHz（无论如何这都不是顶级的）。这种并行处理能力可以让任何四核 CPU 相形见绌。

但是，WPF 仍然很新。它不能在 Windows 2000 上运行。事实上，WPF 应用程序在重新启动后启动速度可能很慢。我在我的博客上讨论了所有这些：http: [//blog.bucketsoft.com/2009/05/wpf-is-like-fat-super-hero.html](http://blog.bucketsoft.com/2009/05/wpf-is-like-fat-super-hero.html)

* * *

## 回答 #11

> 赞同：14
> 
> 时间：2008-09-11T23:40:17.293

我认为值得学习WPF。一旦您加快速度，恕我直言，您的表单设计工作会容易得多。我不会那么担心“性感”的东西。这大部分只是一种时尚。您可以在 WPF 中快速轻松地制作“普通”Winforms 风格的应用程序。

整个概念有助于更轻松地设计 IMO。

* * *

## 回答 #12

> 赞同：13
> 
> 时间：2008-12-24T09:47:38.043

我不同意这里的一些答案。WPF 非常适合[业务线](http://en.wikipedia.org/wiki/Line_of_business)(LOB) 应用程序。（青蛙设计 LOB 客户端就是最好的例子）。除了让您的 UI 变得引人注目（这在业务应用程序中不是必需的）的所有可能性之外，WPF 还为您提供了更多。

数据绑定和模板功能只是优于 Windows 窗体。它还提供了一种更好的方法来分离代码和表示。我们已经在不超过 2-3 名开发人员的团队中成功地将 WPF 用于 2 个 LOB 应用程序。

您将面临的最大问题可能是 WPF 的陡峭学习曲线（与 Windows 窗体相比）这将降低不习惯 WPF 的开发人员的开发速度。

* * *

## 回答 #13

> 赞同：11
> 
> 时间：2008-09-12T01:13:31.533

我们目前正在从 Windows 窗体用 WPF 重写我们的应用程序。是的，有一个陡峭的学习曲线，你必须“重新学习”一些东西，但这是非常值得的。结合 WCF，我们发现我们编写的代码比以往任何时候都更少、更快、更健壮。

坚持一段时间，阅读[Adam Nathan 的书](https://rads.stackoverflow.com/amzn/click/com/0672328917)，并查看不断增长的第三方控件库，例如来自[Telerik](http://www.telerik.com/products/wpf/overview.aspx)和[ComponentOne](http://www.componentone.com/)的那些。在我看来，一个负面因素是设计工具[Expression Blend](http://en.wikipedia.org/wiki/Microsoft_Expression_Blend)使用起来非常尴尬。最新版本仍处于测试阶段，但对于我们这些使用 Visual Studio 多年的人来说，感觉不太对劲。是的，它主要面向设计师，但有些事情在 Visual Studio 中是做不到的。

* * *

## 回答 #14

> 赞同：9
> 
> 时间：2008-12-23T12:09:53.683

如果界面设计对您很重要，请考虑 WPF，因为 WPF 可以提供更好的 UI 体验。但是 Windows Forms 拥有多年的演变，因此它被证明是有效的，并且您可以找到许多精通该平台的程序员。

可移植性也可能是一个问题，WPF 仅适用于 Windows XP SP2 及更高版本。

此外，WPF 具有陡峭的学习曲线，这意味着如果没有特定的 WPF 经验，要交付高质量的产品并不容易。

* * *

## 回答 #15

> 赞同：8
> 
> 时间：2008-12-23T12:24:12.687

嗯，一个答案是“当您必须支持 1.1 或 2.0 时”，因为 WPF 是 .NET 3.0 的一部分。WPF 存在已知的操作系统限制，并且存在一个明显的技能问题：如果您有一个了解 winforms 的开发人员团队，那么*使用*winforms 生成健壮的代码可能会更容易。但是，如果您正在编写大量 UI 代码，则可能值得在某个时候开始使用 WPF。

WPF 也与 Silverlight 有很多共同点，因此它具有可转移的优势。

* * *

## 回答 #16

> 赞同：8
> 
> 时间：2008-12-23T13:42:43.793

WPF 具有许多优点，例如出色的数据绑定功能、关注点分离、设计和逻辑分离等......

作为一名开发人员，我喜欢使用 XAML 来定义我的 UI，而不是依赖于 Windows 窗体设计器，我很高兴知道我可以依靠另一个设计器来使我的应用程序看起来不错。

就我个人而言，我不在乎不支持旧版本的 Windows，但 WPF 的一个大问题是 Mono ( [http://www.mono-project.com](http://www.mono-project.com) ) 不支持 (当前/曾经) 所以 WPF应用程序不会在 Mac OS 或 Linux 上运行。（尽管 Silverlight 应用程序会）。

如果您有时间和资源投入学习 WPF，那就去做吧！即使您要编写 Silverlight 应用程序来支持多个操作系统。

如果您需要桌面应用程序在多个操作系统上运行，请使用 SWF。

* * *

## 回答 #17

> 赞同：7
> 
> 时间：2008-10-14T17:43:26.823

有很多不同之处。我们喜欢 WPF 是因为：

1.  声明式编程风格。
2.  动画和状态转换
3.  Expression Blend 是一个很棒的工具
4.  良好的风格支持。

但是，我们坚持使用 Windows 窗体，因为：

1.  当开发人员已经了解 Windows 窗体时，他们需要额外的时间来学习 WPF。
2.  WPF 不能在 Windows 2000 或更低版本上运行。

* * *

## 回答 #18

> 赞同：6
> 
> 时间：2008-10-14T17:37:19.580

在决定使用哪一个时，最大的考虑是考虑您的目标受众安装了什么 .NET Framework。我发现更多人拥有仅支持 Windows 窗体的较低 .NET Framework 版本，但这只是我的个人经验。

* * *

## 回答 #19

> 赞同：5
> 
> 时间：2008-10-14T17:41:09.290

WPF 的优点是使用自定义控件和动画创建漂亮的 GUI 更加容易。WPF 还有助于进一步分离表示层和逻辑层。如果您有设计师，它可以让您将 95% 的工作交给非编码人员，并允许编码人员从事逻辑工作。缺点是 Expressions Blend 的软件成本，以及缺乏任何运行良好的 Visual Studio 代码分析工具，因为它们往往会在尝试呈现 XAML 时陷入框架调用。我相信还有其他人，但这是我们真正看到的仅有的两个。

主要考虑因素是您是否希望要求您的客户必须安装 .NET 3.0 甚至更好的 .NET 3.5 SP1。你会得到一些负面的反馈

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2008-12-23T12:27:55.053

WPF 使将表单设计工作交给实际设计师而不是设计师服装的开发人员变得更加容易。如果这是您想做的事情，WPF 就是您的答案。如果经典的 Windows 样式按钮很好，那么 Windows 窗体可能是要走的路。

（多个答案声称如果界面设计“对您很重要”，您应该使用 WPF，但这很模糊。界面设计始终是“重要的”。）

* * *

## 回答 #21

> 赞同：4
> 
> 时间：2008-09-12T01:09:25.443

如果您有 MSDN 许可证，请查看[Expression tools](http://www.microsoft.com/expression/)。它专为 WPF 设计，直接导出到 Visual Studio，它可能有助于简化您的过渡。

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2008-09-11T23:35:19.613

如果您只关心支持 Windows 并且不介意学习它所需的时间，请使用 WPF。它快速、灵活、易于重新设计，并且有很好的工具来使用它。

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2008-09-14T10:11:26.543

作为附带的好处，Silverlight 基于 WPF，从其中一个开始，您可以了解如何与另一个一起工作。如果事情继续以 Web 为基础，拥有可以轻松传输到浏览器（或 Windows Live Mesh）的先验知识（和现有代码库）可能有助于为您的软件提供额外的生命。

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2008-09-15T20:21:11.483

如果您决定使用 WPF，考虑到上述答案中已经解释的利弊，我强烈建议您[与比利霍利斯一起阅读这个 dnrTV 剧集](http://www.dnrtv.com/default.aspx?showNum=115)

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2009-02-03T16:56:37.983

在[DotNetRocks 第 315 集中](http://www.dotnetrocks.com/default.aspx?ShowNum=315)，Brian Noyes 广泛讨论了这一点。

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2009-11-19T14:54:39.293

在过去的 3 1/2 年里，我一直在进行 Windows 窗体开发（在两家公司）。这两个应用程序都被广泛使用并最终遇到了 GDI 问题。大型 Windows 窗体应用程序最终将耗尽 GDI 资源 - 导致最终用户必须重新启动。

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2009-12-23T01:29:20.443

WPF 中的文本呈现存在一个已知问题。许多用户报告说，大量使用抗锯齿和像素混合会导致文本模糊。在某些情况下，这是一个大问题，据我所知，微软在某种程度上已经承认了这一点。

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2008-10-02T17:33:51.020

[Scott 抱怨 Expression Blend](http://geekswithblogs.net/lbugnion/archive/2007/05/13/WPF-The-integrator.aspx)以及作为一名开发人员对他来说没有意义。我对 Expression Blend 的第一反应就是这样。然而，现在我认为它是一个非常宝贵的工具，但这真的取决于你是什么类型的开发人员。

我是一名用户界面开发人员，必须扮演[集成](http://geekswithblogs.net/lbugnion/archive/2007/05/13/WPF-The-integrator.aspx)者角色，最终我发现 Expression Blend 对于以所见即所得的方式创建样式和控制模板非常有用。我几乎总是同时在同一个项目上运行 Expression Blend 和 Visual Studio。

我还认为，在 Expression Blend 中玩耍并查看吐出的[XAML](http://en.wikipedia.org/wiki/Extensible_Application_Markup_Language)是学习 WPF API 的绝佳方式......就像在 Windows 窗体中使用设计器并检查它吐出的 C# 代码很有帮助学习如何使用你在那里设计的任何东西。

Expression Blend 很有帮助。试一试，特别是如果您正在处理应用程序的视觉效果。

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2009-11-25T22:34:49.557

引用[来自 Mark 的早期帖子](https://stackoverflow.com/questions/57909/when-creating-a-new-gui-is-wpf-the-preferred-choice-over-windows-forms/1087148#1087148)：

> *   在 Windows 窗体中，您设计用户界面，然后编写代码来驱动该用户界面，这通常还包括驱动数据对象的代码。
> *   在 WPF 中，您投资于驱动数据对象的业务层，然后设计一个侦听数据对象的接口。

我认为这更多是一种设计选择，而不是您使用的是 Windows 窗体还是 WPF。但是，我可以理解某些技术可能更适合特定方法。

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2008-10-14T17:37:45.087

WPF 通过 XAML 对声明性 UI 的支持、丰富的控件模板和样式以及[Expression Blend](http://en.wikipedia.org/wiki/Microsoft_Expression_Blend)等工具，使得设计人员可以更好地与开发人员在同一个项目上合作。此外，它为开发人员提供了附加依赖属性和极其强大的数据绑定的灵活性。此外，Silverlight 支持 XAML 的子集和与 WPF 相同的控件类，因此您的应用程序可以轻松移植为[RIA](http://en.wikipedia.org/wiki/Rich_Internet_application)。

任何一天我都会选择 WPF 而不是 Windows 窗体。即使目标机器只有[.NET 2.0](http://en.wikipedia.org/wiki/.NET_Framework_version_history#.NET_Framework_2.0)，如果用户可以安装其他程序，新的 .NET Framework Client 配置文件也可以很容易地部署 WPF 应用程序。

我可能决定坚持使用 Windows 窗体的唯一原因是该产品是否将部署在锁定且只有 .NET 2.0 或 .NET 1.1 的机器上。

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2010-06-10T09:32:50.970

仅当您没有 WPF 专业知识并且不想投资时：)

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2008-12-26T18:29:32.760

对于转换项目（从[Visual Basic 6.0](http://en.wikipedia.org/wiki/Visual_Basic#Timeline)开始），很难让团队切换到 WPF。除了学习曲线之外，人们已经习惯了旧界面。Windows 窗体虽然已被淘汰，但仍将存在很长时间。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2010-07-19T08:50:54.860

我会使用 Winforms 来快速验证概念，因为虽然它对于实际应用程序来说很糟糕，但它对于“Visual Basic 6.0”——风格的快速原型设计来说非常好。

所以，这里有一个例子：

如果我需要跟踪流程的多个步骤（例如下载某些内容、计算/转换、创建智能输出）并使所有内容可重现，我通常会制作一个带有 ListBox 和几个按钮的快速表单。

因为我是一个真正的开发人员，所以逻辑已经在视图之外的类中，所以这是一个很好的起点。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2011-09-05T10:04:44.137

使用 WPF 为您提供了在很大程度上自定义应用程序的方法。你可以非常快速地编码，即在几秒钟内创建一个像文本框一样的自定义控件，并自定义内容样式等各种属性，而最好的部分是UI美感，即动画，触发器等，图形。但它需要良好的硬件规格和一些仅在 Windows Vista 和 Windows 7 中可用的特殊功能。

Windows 窗体没有这些真正重要的丰富功能，否则我们可以使用它创建任何类型的应用程序，我们可以在 WPF 中使用它。

Windows Forms 和 WPF 完全是不同的物种，这完全取决于项目要求，即客户或用户想要什么。

# grails - 如何增加每页的默认行数？

> ID：57910
> 
> 赞同：2
> 
> 时间：2008-09-11T23:34:13.470
> 
> 标签：grails

Grails 脚手架默认为每页 10 行。我想在不生成视图和更改每个文件中的 10 的情况下增加该数字。我在哪里更改默认值？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-15T10:03:44.680

您必须安装脚手架模板：

grails 安装模板

现在，编辑 src/templates/scaffolding Controller.groovy 并根据需要增加值 params.max

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-12T03:01:54.737

我找到了这个，但无法让它工作。你应该能够（根据[this](http://www.nabble.com/Dynamic-scaffolding-Controller-using-edited-template-td13468221.html)）搭建脚手架，然后在你的控制器中覆盖你想要的操作（比如列表），但就像我说的那样，它对我不起作用......

```
class PersonController {
  def scaffold = true

  def list = {
    if(!params.max) params.max = 20
    [ personList: Person.list( params ) ]
  }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T10:54:58.323

好的，如果您使用动态脚手架解决此错误，请直接在您的 GRAILS_HOME/src/grails/templates/scaffolding 中编辑

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-03-13T17:21:48.040

添加到 uri：

```
?max=<num_rows_desired> 
```

例如：

```
http://projecthost:8080/Library/Books/list?max=20 
```

# sql - 在一个事务中更新架构和行，SQL Server 2005

> ID：57912
> 
> 赞同：2
> 
> 时间：2008-09-11T23:34:31.973
> 
> 标签：sql, sql-server, sql-server-2005, transactions, ado

我目前正在更新一个遗留系统，该系统允许用户指定其中一个表的部分架构。用户可以通过此界面在表中创建和删除列。这个遗留系统使用 ADO 2.8，并使用 SQL Server 2005 作为其数据库（在尝试对这头野兽进行现代化改造之前，您甚至不想知道它使用的是什么数据库……但我离题了。=））

在同一编辑过程中，用户可以定义（和更改）可以存储在这些用户创建的字段中的有效值列表（如果用户想要限制字段中可以包含的内容）。

当用户更改字段的有效条目列表时，如果他们删除了其中一个有效值，则允许他们选择一个新的“有效值”来映射其中包含此（现在无效）值的任何行，以便它们现在再次具有有效值。

在查看旧代码时，我注意到它极易使系统进入无效状态，因为上述更改不是在事务中完成的（因此，如果其他人在上述过程的中途出现并进行了他们的自己的变化......好吧，你可以想象可能导致的问题）。

问题是，我一直试图让它们在单个事务下更新，但是每当代码到达它更改该表架构的部分时，所有其他更改（更新行中的值，无论是在架构更改与否的表......它们甚至可以是完全不相关的表）在事务中构成的那一点似乎被静默删除。我没有收到表明它们已被删除的错误消息，并且当我最后提交事务时没有引发错误......但是当我去查看应该在事务中更新的表时，只有新列在那里。所做的任何非架构更改都不会保存。

到目前为止，在网上寻找答案被证明是浪费几个小时......所以我转向这里寻求帮助。有没有人尝试过通过 ADO 执行事务，既更新表的架构又更新表中的行（无论是同一个表还是其他表）？不允许吗？是否有任何文档可以在这种情况下有所帮助？

编辑：

好的，我做了一个trace，这些命令被发送到数据库中（括号中的解释）

**（我不知道这里发生了什么，看起来它正在创建一个临时存储过程......？）**

```
 declare @p1
int set @p1=180150003 declare @p3 int
set @p3=2 declare @p4 int set @p4=4
declare @p5 int set @p5=-1 
```

**（检索包含用户生成字段的定义信息的表）**

```
 exec sp_cursoropen @p1 output,N'SELECT * FROM CustomFieldDefs ORDER BY Sequence',@p3 output,@p4 output,@p5 output select @p1, @p3, @p4, @p5
go 
```

**（我认为我的代码在这里遍历它们的列表，获取当前信息）**

```
 exec sp_cursorfetch 180150003,32,1,1
go
exec sp_cursorfetch 180150003,32,1,1
go
exec sp_cursorfetch 180150003,32,1,1
go
exec sp_cursorfetch 180150003,32,1,1
go
exec sp_cursorfetch 180150003,32,1,1
go
exec sp_cursorfetch 180150003,32,1,1
go
exec sp_cursorfetch 180150003,32,1,1
go
exec sp_cursorfetch 180150003,32,1,1
go
exec sp_cursorfetch 180150003,1025,1,1
go
exec sp_cursorfetch 180150003,1028,1,1
go
exec sp_cursorfetch 180150003,32,1,1
go 
```

**（这似乎是我输入定义的修改数据的地方，我遍历每个并更新自定义字段本身的定义中发生的任何更改）**

```
 exec sp_cursor 180150003,33,1,N'[CustomFieldDefs]',@Sequence=1,@Description='asdf',@Format='U|',@IsLookUp=1,@Length=50,@Properties='U|',@Required=1,@Title='__asdf',@Type='',@_Version=1
go
exec sp_cursorfetch 180150003,32,1,1
go
exec sp_cursor 180150003,33,1,N'[CustomFieldDefs]',@Sequence=2,@Description='give',@Format='Y',@IsLookUp=0,@Length=0,@Properties='',@Required=0,@Title='_give',@Type='B',@_Version=1
go
exec sp_cursorfetch 180150003,32,1,1
go
exec sp_cursor 180150003,33,1,N'[CustomFieldDefs]',@Sequence=3,@Description='up',@Format='###-##-####',@IsLookUp=0,@Length=0,@Properties='',@Required=0,@Title='_up',@Type='N',@_Version=1
go 
exec sp_cursorfetch 180150003,32,1,1
go
exec sp_cursor 180150003,33,1,N'[CustomFieldDefs]',@Sequence=4,@Description='Testy',@Format='',@IsLookUp=0,@Length=50,@Properties='',@Required=0,@Title='_Testy',@Type='',@_Version=1
go
exec sp_cursorfetch 180150003,32,1,1
go
exec sp_cursor 180150003,33,1,N'[CustomFieldDefs]',@Sequence=5,@Description='you',@Format='U|',@IsLookUp=0,@Length=250,@Properties='U|',@Required=0,@Title='_you',@Type='',@_Version=1
go
exec sp_cursorfetch 180150003,32,1,1
go
exec sp_cursor 180150003,33,1,N'[CustomFieldDefs]',@Sequence=6,@Description='never',@Format='mm/dd/yyyy',@IsLookUp=0,@Length=0,@Properties='',@Required=0,@Title='_never',@Type='D',@_Version=1
go
exec sp_cursorfetch 180150003,32,1,1
go
exec sp_cursor 180150003,33,1,N'[CustomFieldDefs]',@Sequence=7,@Description='gonna',@Format='###-###-####',@IsLookUp=0,@Length=0,@Properties='',@Required=0,@Title='_gonna',@Type='C',@_Version=1
go
exec sp_cursorfetch 180150003,32,1,1
go 
```

**（这是我的代码在此保存开始之前通过界面删除删除的地方] ...据我所知，这也是在此事务期间实际发生的唯一事情）**

```
 ALTER TABLE CustomizableTable DROP COLUMN _weveknown; 
```

**（现在，如果任何定义被更改为需要更改用户创建的列的属性或需要添加/删除列上的索引，则在此处完成，并为任何行提供默认值给定列还没有值...请注意，据我所知，当存储过程完成时，实际上没有发生这种情况。）**

```
`go
SELECT * FROM sys.columns WHERE object_id = OBJECT_ID(N'CustomizableTable') AND name = '__asdf'
go
ALTER TABLE CustomizableTable ALTER COLUMN __asdf VarChar(50) NULL
go
IF EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID(N'[dbo].[CustomizableTable]') AND name = N'idx___asdf') CREATE NONCLUSTERED INDEX idx___asdf ON CustomizableTable ( 
__asdf ASC) WITH (PAD_INDEX  = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF);
go
select * from IF EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID(N'[dbo].[CustomizableTable]') AND name = N'idx___asdf') CREATE NONCLUSTERED INDEX idx___asdf ON 
CustomizableTable ( __asdf ASC) WITH (PAD_INDEX  = OFF, SORT_IN_TEMPDB = OFF, DROP_EXISTING = OFF, IGNORE_DUP_KEY = OFF, ONLINE = OFF);
go
UPDATE CustomizableTable SET [__asdf] = '' WHERE [__asdf] IS NULL
go
SELECT * FROM sys.columns WHERE object_id = OBJECT_ID(N'CustomizableTable') AND name = '_give'
go
ALTER TABLE CustomizableTable ALTER COLUMN _give Bit NULL
go
IF EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID(N'[dbo].[CustomizableTable]') AND name = N'idx__give') DROP INDEX idx__give ON CustomizableTable WITH ( ONLINE = OFF );
go
UPDATE CustomizableTable SET [_give] = 0 WHERE [_give] IS NULL
go
SELECT * FROM sys.columns WHERE object_id = OBJECT_ID(N'CustomizableTable') AND name = '_up'
go
ALTER TABLE CustomizableTable ALTER COLUMN _up Int NULL
go
IF EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID(N'[dbo].[CustomizableTable]') AND name = N'idx__up') DROP INDEX idx__up ON CustomizableTable WITH ( ONLINE = OFF );
go
UPDATE CustomizableTable SET [_up] = 0 WHERE [_up] IS NULL
go
SELECT * FROM sys.columns WHERE object_id = OBJECT_ID(N'CustomizableTable') AND name = '_Testy'
go
ALTER TABLE CustomizableTable ADD _Testy VarChar(50) NULL
go
IF EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID(N'[dbo].[CustomizableTable]') AND name = N'idx__Testy') DROP INDEX idx__Testy ON CustomizableTable WITH ( ONLINE = OFF );
go
UPDATE CustomizableTable SET [_Testy] = '' WHERE [_Testy] IS NULL
go
SELECT * FROM sys.columns WHERE object_id = OBJECT_ID(N'CustomizableTable') AND name = '_you'
go
ALTER TABLE CustomizableTable ALTER COLUMN _you VarChar(250) NULL
go
IF EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID(N'[dbo].[CustomizableTable]') AND name = N'idx__you') DROP INDEX idx__you ON CustomizableTable WITH ( ONLINE = OFF );
go
UPDATE CustomizableTable SET [_you] = '' WHERE [_you] IS NULL
go
SELECT * FROM sys.columns WHERE object_id = OBJECT_ID(N'CustomizableTable') AND name = '_never'
go
ALTER TABLE CustomizableTable ALTER COLUMN _never DateTime NULL
go
IF EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID(N'[dbo].[CustomizableTable]') AND name = N'idx__never') DROP INDEX idx__never ON CustomizableTable WITH ( ONLINE = OFF );
go
UPDATE CustomizableTable SET [_never] = '1/1/1900' WHERE [_never] IS NULL
go
SELECT * FROM sys.columns WHERE object_id = OBJECT_ID(N'CustomizableTable') AND name = '_gonna'
go
ALTER TABLE CustomizableTable ALTER COLUMN _gonna Money NULL
go
IF EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID(N'[dbo].[CustomizableTable]') AND name = N'idx__gonna') DROP INDEX idx__gonna ON CustomizableTable WITH ( ONLINE = OFF );
go
UPDATE CustomizableTable SET [_gonna] = 0 WHERE [_gonna] IS NULL
go` 
```

`**（关闭交易...？）**`

 ````
`exec sp_cursorclose 180150003
go` 
```

`经过上面的所有这些，只发生了该列的删除。事务中它之前和之后的所有内容似乎都被忽略了，并且 SQL 跟踪中没有消息表明事务期间出现了问题。`

 `* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-12T02:26:27.287

该代码使用服务器端游标，这就是这些调用的目的。第一组调用是准备/打开光标。然后从游标中获取行。最后关闭光标。这些存储过程类似于 OPEN CURSOR、FETCH NEXT、CLOSE CURSOR T-SQL 语句。

我必须仔细看看（我会的），但我的猜测是服务器端游标、封装事务和 DDL 发生了一些事情。

还有一些问题：

1.  您是否打算在这种情况下使用服务器端游标？
2.  ADO 命令是否都使用相同的活动连接？

**更新：**

我不确定发生了什么。

看起来您正在使用服务器端游标，因此您可以使用 Recordset.Update() 将更改推送回服务器，此外还可以执行生成的 SQL 语句来更改模式并更新动态表中的数据。在显式事务中使用相同的连接。

我不确定游标操作会对事务的其余部分产生什么影响，反之亦然，老实说，我很惊讶这不起作用。

我不知道它会有多大的变化，但我建议远离服务器端游标并为表更新构建 UPDATE 语句。

抱歉，我无法提供更多帮助。

顺便说一句-我在 sp_cursor 调用中找到了以下信息：

[http://jtds.sourceforge.net/apiCursors.html](http://jtds.sourceforge.net/apiCursors.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T23:38:42.633

您描述的行为是允许的。使架构更改的代码如何？动态构建 SQL 并通过 ADO 命令执行？还是使用 ADOX？

如果您有权访问数据库服务器，请在测试您概述的场景时尝试运行 SQL Profiler 跟踪。查看跟踪是否记录任何错误/回滚。

# java - Java 中的 WS-Eventing 客户端有哪些好的示例？

> ID：57915
> 
> 赞同：2
> 
> 时间：2008-09-11T23:35:21.267
> 
> 标签：java, web-services, ws-eventing

有一些可用于 Java 的 Web 服务框架：Axis2、CXF、JBossWS 和 Metro。有没有人有一些使用这些框架的 WS-Eventing 客户端的好例子？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-12T06:45:21.220

查看[Apache Savan](http://ws.apache.org/savan/source-repository.html)。它是 Axis2 的发布者/订阅者实现，支持 WS-Eventing（请参阅[sample.eventing.Client](https://github.com/apache/savan/blob/trunk/modules/samples/eventing/src/sample/eventing/Client.java)以获取示例客户端），但已于 2014 年退役。

[JBossWS 有一些关于在此处](http://www.jboss.org/jbossws/user-guide/en/html/1.0.4/en/html/wseventing.html)设置服务的信息，但我没有看到任何客户端示例。关于 CXF 包括对事件的支持，尽管它使用本机类型，但 JAX-WS 没有。

# sql - 什么时候应该使用全文索引？

> ID：57918
> 
> 赞同：53
> 
> 时间：2008-09-11T23:37:56.380
> 
> 标签：sql, sql-server, tsql, indexing, full-text-search

我们有一大堆“搜索”客户、客户等的查询。您可以按名字、电子邮件等进行搜索。我们以下列方式使用 LIKE 语句：

```
SELECT * 
FROM customer 
WHERE fname LIKE '%someName%' 
```

全文索引在场景中是否有帮助？我们使用的是 SQL Server 2005。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-09-11T23:42:08.867

这将取决于您的 DBMS。我相信除非你使用全文功能，否则大多数系统不会利用全文索引。（例如，mySQL 中的[MATCH/AGAINST](http://dev.mysql.com/doc/refman/5.0/en/fulltext-natural-language.html)或 MS SQL 中的 FREETEXT/CONTAINS）

这是关于何时、为什么以及如何在 SQL Server 中使用全文索引的两篇好文章：

1.  [如何使用 SQL Server 全文搜索](https://www.developer.com/database/sql-server-full-text-searching/)
2.  [使用全文索引解决复杂的 SQL 问题](https://www.developer.com/guides/solving-complex-sql-problems-with-full-text-indexing/)

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-09-12T02:17:01.957

FTS*可以*在这种情况下提供帮助，问题是它是否值得。

首先，让我们看看为什么`LIKE`可能不是最有效的搜索。当您使用`LIKE`时，尤其是在`%`比较开始时使用 a 进行搜索时，SQL Server 需要对每一行执行表扫描，*并对*正在检查的列进行逐字节检查。

FTS 有一些更好的算法来匹配数据，也有一些更好的名称变化统计数据。因此，当您寻找 Smith 时，FTS 可以为匹配 Smith、Smythe、Smithers 等提供更好的性能。

然而，使用 FTS 有点复杂，因为您需要掌握`CONTAINS`vs`FREETEXT`和搜索的神秘格式。但是，如果您想在 FName 或 LName 匹配的地方进行搜索，您可以使用一个语句而不是 OR 来执行此操作。

要确定 FTS 是否有效，请确定您拥有多少数据。我在数亿行的数据库上使用 FTS，这比使用 搜索确实有好处`LIKE`，但我不会在每个表上都使用它。

如果您的表大小更合理，少于几百万，则可以通过为要搜索的每一列创建索引来获得类似的速度，并且 SQL Server 应该执行索引扫描而不是表扫描。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2013-06-28T15:15:12.413

根据我的测试场景：

*   SQL Server 2008
*   10.000.000 行，每行都有一个字符串，如“wordA wordB wordC...”（在 1 到 30 个单词之间变化）
*   使用 CONTAINS(column, "wordB") 选择 count(*)
*   结果大小几十万
*   目录大小约 1.8GB

全文索引在 2s 范围内，而*like '% wordB %'*在 1-2 分钟范围内。

**但这仅在您不使用任何其他选择标准时才有意义！**例如，如果我在主键列上另外使用了一些*“like 'prefix%'”*，性能会更差，因为进入全文索引的操作比在某些字段中进行字符串搜索的成本更高（只要那些不是太多了）。

**因此，我建议仅**在您必须进行“免费字符串搜索”或使用它的某些特殊功能的情况下使用全文索引...

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-12T00:00:13.907

要专门针对 MSSQL 回答问题，全文索引对您的方案**没有**帮助。

为了改进该查询，您可以执行以下操作之一：

1.  在列上配置全文目录并使用 CONTAINS() 函数。
2.  如果您主要使用前缀进行搜索（即从名称的开头匹配），您可以将谓词更改为以下内容并在列上创建索引。

    其中 fname 像 'prefix%'

(1) 对此可能是矫枉过正，除非查询的性能是一个大问题。

# .net - 从 .NET 应用程序发送电子邮件的最佳方式？

> ID：57919
> 
> 赞同：7
> 
> 时间：2008-09-11T23:38:00.013
> 
> 标签：.net, vb.net, email

我正在开发一个 Windows 窗体 (.NET 3.5) 应用程序，它有一个内置的异常处理程序来捕获可能出现的任何（天堂禁止的）异常。我希望异常处理程序能够提示用户单击`Send Error Report`按钮，这将导致应用程序向我的 FogBugz 电子邮件地址发送电子邮件。

做到这一点的最佳方法是什么，是否有任何“陷阱”需要注意？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-12T00:40:24.607

您不必担心客户端凭据，只需按照 Esteban 的建议使用 SmtpClient。您将需要用户在配置时提供有效的 Smtp 服务器 url，但大多数 ISP 允许匿名 smtp，前提是您在他们的网络（他们的客户端之一）上 - 只要用户输入他们的 ISP smptp 服务器的 url，那么大多数人们不会有任何问题。

注意：.config 文件中有一个预定义部分用于存储 SmtpClient 对象的配置选项。如果您将设置放在那里，则发送电子邮件时无需在代码中明确设置任何内容。该部分的示例如下：

```
<system.net>
   <mailSettings>
      <smtp deliveryMethod="Network" from="stuff@somewhere.com.au">
         <network host="smtp.somewhere.com.au" />
      </smtp>
   </mailSettings>
</system.net> 
```

用户名和密码是可选的。Intellisense 适用于配置文件的这些部分。

编辑：对我的代码示例进行轻微修正。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-11T23:43:27.910

您需要使用**[此处](http://msdn.microsoft.com/en-us/library/system.net.mail.smtpclient.aspx)**概述的 SmtpClient 类。
没有陷阱 - 发送电子邮件就这么简单。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-11T23:48:53.577

*在受控环境中，*使用 SmtpClient 将是答案。但是在用户的机器上，您需要一个 SMTP 服务器来发送。

您可以提示用户输入他们的 SMTP 凭据，但我认为这对您的情况不切实际。作为用户，我不想将我的 SMTP 凭据提供给随机应用程序（想想垃圾邮件）。您也不想将自己的 SMTP 凭据硬编码到应用程序中，恶意用户嗅探这些凭据并使用您的服务器发送垃圾邮件是微不足道的。

理想情况下，您将能够使用用户的邮件代理来发送电子邮件。我在想您可能能够制定和执行 mailto: URL，但我不确定您是否能够指定邮件的正文或任何附件。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-12T01:18:38.650

你提到你正在使用 Fogbugz。

试试[http://www.fogcreek.com/FogBugz/docs/60/topics/customers/BugzScout.html?isl=59722](http://www.fogcreek.com/FogBugz/blog/post/C-wrapper-for-the-FogBugz-API.aspx?isl=59722) 或[http://www.fogcreek.com/FogBugz/blog/post/C-wrapper-for -the-FogBugz-API.aspx?isl=59722](http://www.fogcreek.com/FogBugz/blog/post/C-wrapper-for-the-FogBugz-API.aspx?isl=59722)

周围有一些示例代码，我认为在您的 FB 安装目录中。我向 Michael Pryor re: license 检查过，他说可以使用他们的代码，但是 YMMV，所以我会检查一下。

它提供了一个很好的起点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-11T23:48:44.107

您可能还想查看第 3 方[aspNetEmail](http://www.aspnetemail.com/)库，它提供了许多有用的功能，超出了 System.Net.Mail 为您提供的功能。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-18T10:39:23.680

> 您需要使用[此处](http://msdn.microsoft.com/en-us/library/system.net.mail.smtpclient.aspx)概述的 SmtpClient 类。没有陷阱 - 发送电子邮件就这么简单。

广泛的[System.Net.Mail 常见问题解答](http://www.systemnetmail.com/default.aspx "System.Net.Mail 常见问题解答")位于[此处](http://www.systemnetmail.com/default.aspx "System.Net.Mail 常见问题解答")。

# c# - 究竟什么是“托管”代码？

> ID：57923
> 
> 赞同：57
> 
> 时间：2008-09-11T23:38:58.157
> 
> 标签：c#, .net, vb.net, managed-code

我已经编写 C/C++ 代码近 20 年了，我知道 Perl、Python、PHP 和一些 Java，并且我正在自学 JavaScript。但我从未做过任何 .NET、VB 或 C# 的东西。**托管**代码到底是什么意思？

维基百科[将其](http://en.wikipedia.org/wiki/Managed_code)简单描述为

> 在虚拟机管理下执行的代码

它特别指出Java（通常）是托管代码，所以

*   **为什么这个术语似乎只适用于 C#/.NET？**
*   **您可以将 C# 编译成包含 VM 的 .exe，还是必须将其打包并提供给另一个 .exe（a la java）？**

与此相类似，

*   **.NET 是一种*语言*还是一种*框架*，这里的“框架”到底是什么意思？**

好的，所以这不仅仅是一个问题，但对于像我一样长期从事该行业的人来说，我现在感觉相当 N00B-ish...

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-09-11T23:47:32.517

当您将 C# 代码编译为 .exe 时，它​​会被编译为通用中间语言 (CIL) 字节码。每当您运行 CIL 可执行文件时，它都会在 Microsoft 的公共语言运行时 (CLR) 虚拟机上执行。所以不，不可能将 VM 包含在您的 .NET 可执行文件中。您必须在将运行您的程序的任何客户端计算机上安装 .NET 运行时。

要回答您的第二个问题，.NET 是一个框架，因为它是一组库、编译器和 VM，不是特定于语言的。因此，您可以使用 C#、VB、C++ 和任何其他具有 .NET 编译器的语言在 .NET 框架上进行编码。

[https://bitbucket.org/brianritchie/wiki/wiki/.NET%20Languages](https://bitbucket.org/brianritchie/wiki/wiki/.NET%20Languages)

上面的页面列出了具有 .NET 版本的语言，以及指向它们页面的链接。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-20T13:45:18.263

我不认为只有您对 .Net 是什么感到困惑。已经有其他答案应该涵盖您，但我会为其他人提供这些信息。

要查看 .Net “真正”是什么，只需转到 c:\Windows\Microsoft.Net\Framework

在那里，您将看到特定于您安装的版本的文件夹。例如，如果您安装了 v2.0.xxxxx 文件夹，请进入该文件夹。

在该文件夹中是框架。你基本上会看到一堆 .exe 文件和 .dll 文件。所有以 System.*.dll 开头的 DLL 文件本质上都是 .Net 框架。

您将在该文件夹中看到的 .exe 文件是开发人员和编译器的实用程序。你提到了 C#。找到 csc.exe 文件。那是你的 C# 编译器。

构建一个程序真的很简单。将以下代码放入 hello.cs 文件中。

```
using System;
class Program
    {
        static void Main(string[] args)
        {
            Console.WriteLine("hello world");
        }
    } 
```

然后在命令行输入> csc hello.cs

这将为您生成一个 .exe 文件。运行它，它显然会吐出'hello world'。

显示 Console.WriteLine() 的行正在调用框架。Console 是一个存在于 System 命名空间中的对象，而 WriteLine() 是一个静态方法。

这是该 Console.WriteLine() 方法的反汇编代码：

```
[HostProtection(SecurityAction.LinkDemand, UI=true)]
public static void WriteLine(string value)
{
    Out.WriteLine(value);
} 
```

当人们说“我应该使用 PHP 还是 .Net？”或“我应该使用 Python 还是 .Net”之类的话时，您会开始看到讨论的问题是错误的。他们显然是将语言与框架进行比较。C# 是一种语言，它只是可用于在 .Net 平台之上编写代码的众多语言之一。Console.WriteLine() 的相同方法可以从 C#、VB.Net、Pascal、C++、Ruby、Python、F# 和任何其他在 .Net 平台上工作的语言调用。

我希望这会有所帮助。

-基思

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-11T23:46:41.757

主要是指您所有的内存分配都是为您“管理”的。如果您使用托管代码，则不必担心在使用完对象后会释放它们。简单地允许它们超出范围将意味着 VM 最终将认识到不再有任何对它们的引用，并将垃圾收集它们并将内存返回给系统。

另一方面，非托管代码只会“泄漏”，除非您在丢弃引用之前明确释放指针。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-11T23:44:17.660

它主要用于描述 .NET，因为这是 Microsoft 选择将 .NET 与 C/C++ 和其他旧语言区分开来的术语。微软之所以选择它是因为它不是一个通常与 Java 相关联的术语，因为他们不想强调 C#/.NET 和 Java 之间的相似之处（而不是将其称为“虚拟机代码”之类的东西听起来更像Java）。基本上，“托管代码”的使用是营销驱动的，而不是技术驱动的术语。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-20T13:22:42.327

特别是在 .NET 和 Visual C++ 下，您可以同时拥有非托管和托管代码。这些术语指的是分配和“管理”内存的方式。

非托管代码将是您习惯的 C++ 内容。动态内存分配和显式释放内存。.NET 运行时不会为您管理内存，因此是“非托管”的。

另一方面，托管代码由运行时管理。您在需要的地方分配内存（通过声明变量，而不是内存空间），运行时垃圾收集器确定何时不再需要并清理它。垃圾收集器还将移动内存以提高效率。运行时为您“管理”这一切。

正如我上面提到的，可以编写托管和非托管的代码。

非托管：

```
class Bar : public Foo {
    private:
            int fubar;
    public:
            Bar(int i) : fubar(i) {}
            int * getFubar() { return * fubar; }
} 
```

管理：

```
public ref class Bar :  public Foo
    private:
            int fubar;
    public:
            Bar(int i) : fubar(i) {}
            int ^ getFubar() { return ^ fubar; }
} 
```

注意裁判？这几乎指定了一个托管类。但是，当您混合使用这两种代码时，它会变得非常混乱。例如，您希望将引用指针 (^) 指针的托管等效项保存到非托管类中的图片框控件。由于垃圾收集器可以移动内存，下次您尝试取消引用图片框时，它就找不到了。运行时不会告诉您的非托管代码它的内存更改。

因此，您需要将托管对象固定在内存中，以允许您的非托管代码跟踪它。然后是拆箱和其他各种怪癖，可以让您将两者混合在一起。代码复杂度是巨大的！

正式地，托管/非托管可能归结为代码在 .NET 堆栈上的执行方式。但是，如果您来自 C++ 背景，我希望这对您来说更相关。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-11T23:43:33.370

*托管*一词通常仅适用于 .NET，因为 Microsoft 使用该术语。Microsoft 通常不使用术语“虚拟机”来指代 .NET 托管执行环境。

.NET 的“字节码”(IL) 与 Java 字节码有些不同，因为它被明确设计为在托管环境中执行之前编译为本机代码，而 Java 被设计为可解释的，但平台无关代码的概念类似。

“.NET 框架”基本上是微软提供的一组庞大的库，包含数千个可用于开发应用程序的类。

已编译的 C# .exe 包含可在任何 .NET 兼容环境（包括 Mono）中运行的独立于平台的代码。但是，运行时通常与使用它的应用程序分开分发。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-11T23:45:51.430

托管意味着代码不编译为本机代码，因此在虚拟机的主持下运行。Java 编译成一种称为字节码的中间格式，Java VM 知道如何解释和执行这种格式。所有 .NET 语言都做类似的事情，编译为 .NET 运行时解释的 IL（中间语言）。这有点令人困惑，因为 .NET IL 有 .dll 和 .exe 文件结尾。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-12T04:20:28.323

冒着冒犯某些人的风险，我怀疑使用了托管这个词，因此他们可以使用非托管这个词而不是编译。虽然托管可能意味着更多，但现实情况是它似乎主要用于区分几乎即时编译的代码（作为曾经解释或 pcode 的替代）和本机编译代码。

或者换一种方式，您更喜欢使用哪种方式：

a) 可能对系统造成无法控制的事情的非托管代码。

b) 快速、可靠且接近操作系统的本机编译代码。

当然，它们实际上是一回事。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-20T13:43:09.140

> > 同样，.NET 是一种语言还是一种框架，“框架”在这里究竟是什么意思？<<

.NET 是微软当前的企业软件平台。它包括：

• 用于访问 Windows 功能的单一通用界面：

```
o The .NET Framework Class Library (FCL).
o The FCL provides a rich set of high-level functionality for developers. 
```

• 用于执行 .NET 应用程序的单一通用语言和运行时：

```
o Common Language Runtime (CLR) executes Common Intermediate Language (CIL).
o The CLR is God: it runs, controls, and polices everything. 
```

• 为开发 .NET 应用程序选择多种语言：

```
o Every development language is compiled to CIL, which is run by the CLR.
o C# and VB are the two main development languages. 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-11T23:44:19.750

.NET 是一个框架。公共语言运行时 (CLR) 执行在编译解决方案时生成的 Microsoft 中间语言 (MSIL) 代码（即，它不编译为机器代码）。您不能在 exe 中包含 API，也不想包含它，因为它非常大。这里的主要好处是内存管理（以及其他一些安全优势，可能还有其他我不知道的优势。）

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-11T23:45:48.653

我可以回答框架问题。.NET 是一个框架，C#、VB.NET 等是语言。基本上.NET 提供了一个通用的库平台来调用（所有系统...... dll），任何使用.NET 的语言都可以调用。所有 .NET 语言都被编译成 MSIL（Microsoft 中间语言，更广为人知的简称 IL），然后可以在安装了适当 .NET 框架的任何 PC 上运行。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-11T23:42:37.460

.NET 是一个框架。它可以用于多种语言（VB.NET、C#、IronPython、boo 等）

.NET 始终按解释执行，不，您不能在 .exe 中包含“VM”。任何希望运行您的 .NET 应用程序的用户都必须安装该框架。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-11T23:48:20.597

它可以引用由虚拟机而不是直接由 CPU 执行的任何代码。

我认为这可以实现垃圾收集和数组边界检查等功能。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-08T19:04:44.973

就个人而言，我认为“框架”这个词有点用词不当。

.NET 是一个“平台”，由一个执行环境（CLR 虚拟机）和一组库组成。它与 Java、Perl 或 Python 完全类似（它们都没有被称为“框架”）。

在大多数情况下，“框架”一词用于诸如 Spring、Struts 或 QT 之类的项目，它们位于平台之上（即不提供自己的执行环境），如库。

但与“库”不同的是，框架旨在重新定义底层平台的基本操作。（Spring 的依赖注入违背了普通 Java 代码的构造函数调用逻辑。QT 的信号槽实现违背了普通的 C++ 代码。）

我知道我只是一个迂腐的混蛋，但对我来说，.NET 不是一个框架。这是一个平台。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2016-05-21T03:31:48.177

托管代码--MSIL 和 IL 和托管代码是相同的。当我们构建应用程序时，会在 Bin 文件夹中生成 .dll 或 .exe 文件。这些文件称为托管代码。稍后将这些文件提供给 CLR 以生成 Native操作系统可以理解的代码。

# excel - Excel中基于复杂团队规则的十大排序

> ID：57927
> 
> 赞同：3
> 
> 时间：2008-09-11T23:41:16.417
> 
> 标签：excel, spreadsheet, vba

我有一个类似于以下格式的 Excel 电子表格...

```
| NAME  | CLUB | STATUS | SCORE |
| Fred  |  a   | Gent   | 145   |
| Bert  |  a   | Gent   | 150   |
| Harry |  a   | Gent   | 195   |
| Jim   |  a   | Gent   | 150   |
| Clare |  a   | Lady   | 99    |
| Simon |  a   | Junior | 130   |
| John  |  b   | Junior | 130   |
   :
   :
| Henry |  z   | Gent   | 200   | 
```

我需要将此表转换为“前十名”团队的列表。规则是

*   每支球队的分数取自该俱乐部四名成员的总和。
*   这些总分应该是最好的四个分数，除了......
    *   每个团队必须由至少一名青少年或女士组成

例如，在上表中，俱乐部 A 的球队得分将是 625**而不是**640，因为您会计算 Harry(190)、Bert(150)、Jim(150) 和 Simon(130) 的得分。你不能拿 Fred (145) 的分数，因为那只会给你 Gents。

我的问题是，这可以作为一系列 Excel 公式轻松完成，还是我需要使用更程序化的东西？

理想情况下，解决方案需要在团队选择中自动进行，我不想为每个团队创建单独的手工公式。我也不一定有每个俱乐部成员的有序列表。虽然我可能可以通过额外的计算表生成列表。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-13T00:11:22.047

```
Public Function TopTen(Club As String, Scores As Range)

    Dim i As Long
    Dim vaScores As Variant
    Dim bLady As Boolean
    Dim lCnt As Long
    Dim lTotal As Long

    vaScores = FilterOnClub(Scores.Value, Club)
    vaScores = SortOnScore(vaScores)

    For i = LBound(vaScores, 2) To UBound(vaScores, 2)
        If lCnt = 3 And Not bLady Then
            If vaScores(3, i) <> "Gent" Then
                lTotal = lTotal + vaScores(4, i)
                bLady = True
                lCnt = lCnt + 1
            End If
        Else
            lTotal = lTotal + vaScores(4, i)
            lCnt = lCnt + 1
            If vaScores(3, i) <> "Gent" Then bLady = True
        End If

        If lCnt = 4 Then Exit For
    Next i

    TopTen = lTotal

End Function

Private Function FilterOnClub(vaScores As Variant, sClub As String) As Variant

    Dim i As Long, j As Long
    Dim aTemp() As Variant

    For i = LBound(vaScores, 1) To UBound(vaScores, 1)
        If vaScores(i, 2) = sClub Then
            j = j + 1
            ReDim Preserve aTemp(1 To 4, 1 To j)
            aTemp(1, j) = vaScores(i, 1)
            aTemp(2, j) = vaScores(i, 2)
            aTemp(3, j) = vaScores(i, 3)
            aTemp(4, j) = vaScores(i, 4)
        End If
    Next i

    FilterOnClub = aTemp

End Function

Private Function SortOnScore(vaScores As Variant) As Variant

    Dim i As Long, j As Long, k As Long
    Dim aTemp(1 To 4) As Variant

    For i = 1 To UBound(vaScores, 2) - 1
        For j = i To UBound(vaScores, 2)
            If vaScores(4, i) < vaScores(4, j) Then
                For k = 1 To 4
                    aTemp(k) = vaScores(k, j)
                    vaScores(k, j) = vaScores(k, i)
                    vaScores(k, i) = aTemp(k)
                Next k
            End If
        Next j
    Next i

    SortOnScore = vaScores

End Function 
```

用作包含俱乐部字母的`=TopTen(H2,$B$2:$E$30)`地方。`H2`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-15T11:16:55.957

> 这可以作为一系列 Excel 公式轻松完成吗

简短的回答，是的。（取决于您对“轻松”的定义）。

长答案...

（我*认为*这行得通）

这是我的（简要）测试数据：

```
 A          B    C        D
 1 NAME      CLUB STATUS  SCORE
 2 Kevin    a   Gent    145
 3 Lyle     a   Gent    150
 4 Martin   a   Gent    195
 5 Norm     a   Gent    150
 6 Oonagh   a   Lady    100
 7 Arthur   b   Gent    200
 8 Brian    b   Gent    210
 9 Charlie  b   Gent    190
10 Donald   b   Gent    220
11 Eddie    b   Junior  150
12 Quentin  c   Gent    145
13 Ryan     c   Gent    150
14 Sheila   c   Lady    195
15 Trevor   c   Gent    150
16 Ursula   c   Junior  200 
```

现在，如果我对规则的理解正确，我们想要最好的四分，但如果女士或青少年的最高分不在最好的四分之内，我们使用它而不是第四高。我已经重申了一些，原因可能会变得很明显......

好的。数组公式来拯救！（我希望）

a队的最高分应该是

```
{=LARGE(IF(B2:B16="a",D2:D16,0),1)} 
```

其中 {} 表示使用 Control-Shift-Enter 输入公式创建的数组公式。前四名的创建方式类似。对于女士/少年位，我们需要更多的复杂性。以女士为例，我们需要这个：

```
{=LARGE(IF($B$2:$B$16=$J3,IF($C$2:$C$16="Lady",$D$2:$D$16,0),0),1)} 
```

我希望，Junior 可以安全地留给学生作为练习。

我现在正在查看具有以下布局的俱乐部“a”的表格

```
 J    K      L      M      N      O      P
 1 Club    1      2      3      4   Lady  Junior
 2 a     195    150    150    145    100      0 
```

俱乐部得分应该是前三名的“任何人”得分加上最好的女士或青少年（*如果她们尚未进入前四名*）。

所以在第二季度我把这个：

```
=SUM(K2:M2)+MIN(MAX(O2,P2),N2) 
```

MAX(O2,P2) 告诉我最好的女士或青少年分数，必须包括在内。如果它高于第四高的球队得分，那么它已经在列表中，我们只取前四名。否则，我们用最好的女士/小学生代替第四高的分数。

现在我们可以在一个公式中完成所有操作，将部分代入最终公式：

```
{=LARGE(IF($B$2:$B$16=$J3,$D$2:$D$16,0),1)+
LARGE(IF($B$2:$B$16=$J3,$D$2:$D$16,0),2)+
LARGE(IF($B$2:$B$16=$J3,$D$2:$D$16,0),3)+
MIN(LARGE(IF($B$2:$B$16=$J3,$D$2:$D$16,0),4),
MAX(LARGE(IF($B$2:$B$18=$J3,IF($C$2:$C$18="Lady",$D$2:$D$18,0),0),1),
LARGE(IF($B$2:$B$18=$J3,IF($C$2:$C$18="Junior",$D$2:$D$18,0),0),1)))} 
```

但我不推荐它...

所以对于上述数据，我最终得到了这个：

```
 Anyone                                          Lady        Junior                
Club        1           2           3           4           1           1           Total     
a           195         150         150         145         100         0           595       
b           220         210         200         190         0           150         780       
c           200         195         150         150         195         200         695 
```

大鼠。在我（我认为）让困难的部分工作时感到兴奋时，我忘了提到

*   分数列表可以按任何顺序排列
*   您可以使用 RANK() 获得俱乐部排名
*   然后，您可以使用 MATCH() 和 INDEX() 将前 10 名拉到另一个表中

```
 A               B       C       D           E       F       G               H    
1   club            Sc      Rank    UniqRk              Pos     Club            Score
2   third-equal#1   80      3       79.999980   1       1       best            100  
3   second          90      2       89.999970   2       2       second          90   
4   third-equal#2   80      3       79.999960   3       3       third-equal#1   80   
5   best            100     1       99.999950   4       3       third-equal#2   80   
6   worst           70      5       69.999940   5       5       worst           70 
```

A 列和 B 列是我们计算的分数，E 列是俱乐部在决赛桌中的输出顺序。其他公式如下：

```
C: =RANK(B2,$B$2:$B$6)      # what it says, with ties both getting the lower number
D: =B2-ROW()*0.00001        # score, modified slightly to ensure uniqueness
F: =SMALL($C$2:$C$6,E2)     # first output column, ranks including ties
G: =INDEX($A$2:$A$6,MATCH(LARGE($D$2:$D$6,E2),$D$2:$D$6,0))
                            # club name for position, using the modified score in D
H: =INDEX($B$2:$B$6,MATCH(LARGE($D$2:$D$6,E2),$D$2:$D$6,0))
                            # as G, but indexes into scores 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-09-14T01:04:37.203

我做的是蹩脚的，但它的工作原理。

只需创建一个新列，然后将这个公式插入`=If(a1=N,b1,0)`其中`A1`是标准列，`N`是标准并且`B1`在您试图从中获取大数据的列中。然后我只是在另一列中做大公式。

有时我会变得很花哨，而不是推出 a `N`，而是让它说`$C$1`，然后在该单元格中拼出标准。

完美的答案是让微软添加一个`largeifs`（请阅读这个微软）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-11T23:52:44.020

使用数据透视表作为对您拥有的数据的数据库查询。透视，以便团队沿着列向下移动，团队成员连同他们的状态类型一起穿过透视表。我不确定 2003 年的情况，但 Excel 2007 允许您进行排序，以便最高分出现在左侧。然后你的第一个总和可以简单地为每支球队取前三个分数。但是，要获得最后一人的总和，您必须确定是否可以使用第 4 分，或者是否必须使用初级或女士类型的最大值。这可以使用一个复杂的蛮力公式来完成，有点像这样：

如果（位置 1 的类型是初级或女士或... 2 或 3...）则使用位置 4，否则如果位置 5 是初级或女士，则使用 5，否则如果 p 6 是...，依此类推.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-11T23:54:31.377

用 VBA 编写解决方案将是我的首选，尤其是在规则有可能变得更复杂的情况下。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-12T00:07:33.110

我认为除非表格以某种方式排序，否则无法做到这一点。Excel 的大多数查找函数都需要有序列表。这当然可以通过 VBA 函数来完成。

# c# - 了解 .Net 配置选项

> ID：57947
> 
> 赞同：5
> 
> 时间：2008-09-11T23:47:50.740
> 
> 标签：c#, .net, configuration

我对 .Net v2 中 dll、ASP.net 网站等的 .Net 配置的各种配置选项感到非常困惑——尤其是考虑到配置文件在链的 UI/最终用户端的影响时。

因此，例如，我使用的一些应用程序使用我们访问的设置：

```
string blah = AppLib.Properties.Settings.Default.TemplatePath; 
```

现在，这个选项看起来很酷，因为成员是严格键入的，而且我将无法键入 Visual Studio 2005 IDE 中不存在的属性名称。我们最终在命令行可执行项目的 App.Config 中得到这样的行：

```
<connectionStrings>
    <add name="AppConnectionString" connectionString="XXXX" />
    <add name="AppLib.Properties.Settings.AppConnectionString" connectionString="XXXX" />
</connectionStrings> 
```

（如果我们没有第二个设置，那么有人向 live box 发布调试 dll 可能已经构建了其中嵌入的调试连接字符串 - eek）

我们还可以像这样访问设置：

```
string blah = System.Configuration.ConfigurationManager.AppSettings["TemplatePath_PDF"]; 
```

现在，这些看起来很酷，因为我们可以从 dll 代码或 exe / aspx 代码访问设置，而我们在 Web 或 App.config 中需要的只是：

```
<appSettings>
   <add key="TemplatePath_PDF" value="xxx"/>
</appSettings> 
```

但是，这个值当然可能没有在配置文件中设置，或者字符串名称可能输入错误，因此我们遇到了不同的问题。

所以......如果我的理解是正确的，前一种方法会提供强类型，但 dll 和其他项目之间的值共享很差。后者提供更好的共享，但打字较弱。

我觉得我一定是错过了什么。目前，我什至不关心应用程序能否将值写回配置文件、加密或类似的东西。此外，我已经决定存储任何非连接字符串的最佳方式是在数据库中......然后我要做的下一件事就是存储电话号码以在数据库连接问题的情况下发短信给人们，所以他们必须存储在数据库之外！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-12T00:06:23.457

如果您使用 VS 2005+ 中的设置选项卡，您可以添加强类型设置并获得智能感知，例如在您的第一个示例中。

```
string phoneNum = Properties.Settings.Default.EmergencyPhoneNumber; 
```

这物理存储在 App.Config 中。

您仍然可以使用配置文件的 appSettings 元素，甚至可以滚动您自己的 ConfigurationElementCollection、ConfigurationElement 和 ConfigurationSection 子类。

至于在哪里存储您的设置、数据库或配置文件，在非连接字符串的情况下：这取决于您的应用程序架构。如果您有一个由所有客户端共享的应用程序服务器，请使用上述方法，在应用程序服务器上的 App.Config 中。否则，您可能必须使用数据库。将它放在每个客户端的 App.Config 中会导致版本控制/部署问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-12T02:37:10.723

Nij，我们的思维差异来自于我们不同的视角。我正在考虑开发主要使用 WinForms 客户端的企业应用程序。在这种情况下，业务逻辑包含在应用服务器上。每个客户端都需要知道要拨打的电话号码，但是如果电话号码发生变化，将其放在每个客户端的 App.config 中会产生问题。在这种情况下，将应用程序配置信息（或应用程序范围的设置）存储在数据库中并让每个客户端从那里读取设置似乎很明显。

另一种 .NET 方式（我之所以做出区分，是因为在 .NET 之前，我们将应用程序设置存储在 DB 表中）是将应用程序设置存储在 app.config 文件中，并通过生成的 Settings 类进行访问.

我跑题了。你的情况听起来不一样。如果所有不同的应用程序都在同一台服务器上，您可以将设置放在更高级别的 web.config 中。但是，如果它们不是，您还可以拥有一个单独的“配置服务”，所有三个应用程序都可以通过它来获取它们的共享设置。至少在此解决方案中，您不会在三个地方复制代码，从而在添加设置时增加了维护问题的可能性。不过听起来有点过度设计。

我个人的偏好是使用强类型设置。实际上，我根据数据库中的设置表生成了自己的强类型设置类。这样我就可以两全其美了。智能感知我的设置和存储在数据库中的设置（注意：这是在没有应用服务器的情况下）。

我也有兴趣学习其他人的策略:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T23:50:13.340

我认为您的困惑来自这样一个事实，即您的第一个示例看起来像是一个自制的库，而不是 .NET 的一部分。configurationmanager 示例是内置功能的示例。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-12T00:20:00.273

我支持 Rob Grays 的回答，但想稍微补充一下。这可能过于明显，但如果您使用多个客户端，app.config 应该存储所有特定于安装的设置，而数据库应该存储几乎所有其他内容。

单个客户端（或服务器）应用程序有些不同。这里真的是更多的个人选择。一个值得注意的例外是，如果设置是数据库中记录的 ID，在这种情况下，我将始终使用外键将设置存储*在*数据库中，以确保引用不会被删除。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-12T00:39:10.677

是的 - 我认为我/我们处于令人头疼的情况 Rob descibes - 我们在需要访问同一个数据库的三个独立服务器上拥有 5 或 6 个不同的网站和应用程序。就目前情况而言，每个人都有自己的 Web 或 App.config 以及我们主要的 DB-access dll 库中描述的设置和/或覆盖设置。

Rob - 当您说应用程序服务器时，我不确定您的意思是什么？我能想到的最接近的事情是，我们至少可以通过将它们放在目录层次结构中更高的 web.config 中来在同一台机器上的站点之间共享一些设置......但这也不是我能够调查的事情......认为更重要的是了解哪个强类型或弱类型的路线“更好”。

# asp.net - 何时使用 HtmlControls 与 WebControls

> ID：57958
> 
> 赞同：5
> 
> 时间：2008-09-11T23:53:28.247
> 
> 标签：asp.net

我喜欢 HtmlControls，因为没有 HTML 魔法正在发生...... asp 源代码看起来与客户端看到的相似。

我无法与 GridView、Repeater、CheckBoxLists 等实用程序争论，所以当我需要这些功能时我会使用它们。

此外，混合和匹配的代码看起来很奇怪：

```
<asp:Button id='btnOK' runat='server' Text='OK' />
<input id='btnCancel' runat='server' type='button' value='Cancel' /> 
```

（上面的情况是您想将服务器端事件侦听器绑定到 OK 但 Cancel 只是运行一个隐藏当前 div 的 javascript）

那里有一些明确的风格指南吗？应该避免 HtmlControls 吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-12T00:09:15.743

当您希望对最终由您的页面发出的标记进行更多控制时，将 HTML 控件视为一个选项可能会很有用。从某种意义上说，您希望每个浏览器都看到完全相同的标记，因此可以进行更多控制。

如果您创建 System.Web.UI.HtmlControls，例如：

```
<input id='btnCancel' runat='server' type='button' value='Cancel' /> 
```

然后你就知道会发出什么样的代码了。尽管大多数时候：

```
<asp:Button id='btnCancel' runat='server' Text='Cancel' /> 
```

最终将成为相同的标记。并非总是为所有 WebControl 发出相同的标记。许多 WebControl 都内置了自适应渲染，可以根据浏览器用户代理渲染不同的 HTML。例如，DataGrid 在移动浏览器中的外观与在桌面浏览器中的外观完全不同。

使用 WebControls 而不是 HtmlControls 还可以让您利用[ASP.NET v2.0 ControlAdapters](http://msdn.microsoft.com/en-us/library/67276kc5.aspx)，我相信它仅适用于 WebControls，这将允许您对发出的标记进行编程配置驱动控制。

当您考虑到某些移动浏览器或 WebTV 将需要 WML 或完全不同的标记集时，这似乎更有价值。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-12T00:00:16.123

根据我的经验，差别很小。正如 Darren 所说，如果您不需要服务器端功能，HTML 控件的影响可能较小。

不要忘记，您可以将服务器端功能绑定到几乎任何 HTML 控件上，只需向其添加 runat="server" 指令和 ID。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T23:55:02.813

好吧...如果您不需要在服务器上对其执行任何操作，我不会使用 html 控件。我会做

```
<input id='btnCancel' type='button' value='Cancel' /> 
```

鳍。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-01-16T07:25:34.843

通过添加 runat="server" 您可以访问服务器端的任何 HTML 控件。我相信与 ASP.NET 服务器控件相比，HTML 控件的重量更轻。

# c# - 用OLEDB写入excel文件

> ID：57987
> 
> 赞同：8
> 
> 时间：2008-09-12T00:10:25.380
> 
> 标签：c#, excel, oledb

有谁知道如何在 C# 中通过 OLEDB 写入 excel 文件（.xls）？我正在执行以下操作：

```
 OleDbCommand dbCmd = new OleDbCommand("CREATE TABLE [test$] (...)", connection);
   dbCmd.CommandTimeout = mTimeout;
   results = dbCmd.ExecuteNonQuery(); 
```

但是我收到一条带有消息的 OleDbException：

> “无法修改表 'test$' 的设计。它位于只读数据库中。”

我的连接似乎很好，我可以很好地选择数据，但我似乎无法将数据插入到 excel 文件中，有谁知道我如何通过 OLEDB 获得对 excel 文件的读/写访问权限？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-23T10:49:35.653

我也在寻找并回答，但 Zorantula 的解决方案对我不起作用。我在[http://www.cnblogs.com/zwwon/archive/2009/01/09/1372262.html上找到了解决方案](http://www.cnblogs.com/zwwon/archive/2009/01/09/1372262.html)

我删除了`ReadOnly=false`参数和`IMEX=1`扩展属性。

该`IMEX=1`属性以导入模式打开工作簿，因此结构修改命令（如`CREATE TABLE`或`DROP TABLE`）不起作用。

我的工作连接字符串是：

```
"Provider=Microsoft.Jet.OLEDB.4.0;Data Source=workbook.xls;Mode=ReadWrite;Extended Properties=\"Excel 8.0;HDR=Yes;\";" 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-08T18:38:27.583

您需要添加`ReadOnly=False;`到您的连接字符串

```
Provider=Microsoft.Jet.OLEDB.4.0;Data Source=fifa_ng_db.xls;Mode=ReadWrite;ReadOnly=false;Extended Properties=\"Excel 8.0;HDR=Yes;IMEX=1\"; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-08-04T20:16:02.627

我也有同样的问题。只删除扩展属性`IMEX=1`。这将解决你的问题。您的表格将在您的 Excel 文件中创建...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-12T02:04:24.797

几个问题：

*   执行您的应用程序的用户（您？）是否有权写入文件？
*   文件是只读的吗？
*   你的连接字符串是什么？

如果您使用的是 ASP，则需要添加 IUSER_* 用户，如[本例所示](http://support.microsoft.com/kb/195951/)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-12T16:12:37.907

*   如何检查我的应用程序写入 excel 文件的权限（我使用的是 excel 2007）？
*   该文件不是只读的，也不是受保护的（据我所知）。
*   我的连接字符串是：

> "Provider=Microsoft.Jet.OLEDB.4.0;Data Source=fifa_ng_db.xls;Mode=ReadWrite;Extended Properties=\"Excel 8.0;HDR=Yes;IMEX=1\""

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-08T18:49:51.897

继迈克尔·哈伦的回答之后。如果此代码在 ASP.NET 应用程序中运行（在 IIS 应用程序池中指定），则您需要授予对 XLS 文件修改权限的帐户可能是 NETWORK SERVICE。要准确了解您的代码运行的帐户，您可以执行以下简单操作：

```
Response.Write(Environment.UserDomainName + "\\" + Environment.UserName); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-10T16:11:17.943

我在 ASP.NET 下运行，遇到“无法修改设计...”和“无法找到 ISAM...”错误消息。

我发现我需要：

**a** ) 使用以下连接字符串：

`Provider=Microsoft.Jet.OLEDB.4.0;Mode=ReadWrite;Extended Properties='Excel 8.0;HDR=Yes;';Data Source=" + {path to file};`

请注意，我也对连接字符串中`IMEX=1`的`ReadOnly=false`属性有疑问。

**b** ) 授予每个人对正在写入文件的文件夹的完全权限。通常，ASP.NET 在 NETWORK SERVICE 帐户下运行，并且该帐户已经具有权限。但是，OleDb 代码是非托管的，因此它必须在其他一些安全上下文中运行。（我目前懒得弄清楚哪个帐户，所以我只使用了每个人。）

# c# - 与 StructureMap 等 IoC 容器相关的间接成本是多少？

> ID：57990
> 
> 赞同：3
> 
> 时间：2008-09-12T00:17:01.167
> 
> 标签：c#, inversion-of-control, structuremap

在参加了最近关于 IoC 的 Alt.NET 小组后，我开始思考可用的工具以及它们如何工作。 特别是使用属性和引导程序概念来映射对to`StructureMap`的请求。属性会自动为我抛出反射或 IL 注入正在进行的标志。有谁知道它是如何工作的（对于或其他 IoC 工具）以及在运行时或编译时相关的开销可能是多少？`IThing``ConcreteThing``StructureMap`

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-12T00:28:20.377

对于其他 IoC 工具包，我不能说太多，但我使用 Spring.Net 并发现在启动时会有一次性的初始性能损失。配置容器后，应用程序运行不受影响。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-12T13:41:06.337

我使用[CastleProject](http://castleproject.org)中的 Windsor，发现它在减少依赖方面非常有用。我还没有注意到性能问题，但我发现的一件事是配置可能会有点麻烦。为了在这方面提供帮助，我开始研究 Binsor，这是一个用 boo 编写的 Windsor DSL。

要注意的另一件事是，在导航代码时，您将无法转到将在运行时执行的代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T20:49:13.983

我在这里构建了一个非常轻量级和基本的[IOC](http://blogs.microsoft.co.il/blogs/shay/archive/2008/09/30/building-custom-object-mapper.aspx)：

[http://blogs.microsoft.co.il/blogs/shay/archive/2008/09/30/building-custom-object-mapper.aspx](http://blogs.microsoft.co.il/blogs/shay/archive/2008/09/30/building-custom-object-mapper.aspx)

它不是您提到的库的替代品，但如果您只需要通过提供接口来解析类型，那么它可能是一个完美的解决方案。

我不处理实例化类型（单例、瞬态、线程、池...），所有对象都将被实例化为单例，你可以这样称呼它：

```
IRepository _repository = ObjectFactory.BuildFactory<IRepository>(); 
```

谢伊

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-12T00:41:11.873

他们的主要问题是代码变得难以理解。如果过度使用 IoC ，它可能会变*得很神奇。*另一个问题是性能。在大多数情况下，性能损失并不明显。但是，当您开始通过 IoC 容器创建大部分对象时，它可能会突然下降到海平面以下。

# visual-c++ - dllexport 和 dllimport 有什么区别？

> ID：57999
> 
> 赞同：65
> 
> 时间：2008-09-12T00:23:23.400
> 
> 标签：visual-c++, dll, import, export

我只是在寻找对这两者之间区别的简单、简洁的解释。MSDN 在这里没有详细介绍。

* * *

## 回答 #1

> 赞同：90
> 
> 时间：2008-09-12T00:43:53.710

`__declspec( dllexport )`- 如此标记的类或函数将从其内置的 DLL 中导出。如果您正在构建 DLL 并且需要 API，则需要使用此文件或定义导出的单独 .DEF 文件（[MSDN](http://msdn.microsoft.com/en-us/library/3y1sfaz2.aspx)）。这很方便，因为它将定义保存在一个地方，但 .DEF 文件提供了更多选项。

`__declspec( dllimport )`- 如此标记的类或函数将从 DLL 中导入。这实际上不是必需的 -*无论如何*您都需要一个导入库来使链接器满意。但是当用 正确标记时`dllimport`，编译器和链接器有足够的信息来优化调用；没有它，您将获得到导入库中存根函数的正常静态链接，这会增加不必要的间接性。[ONT1](https://web.archive.org/web/20130616032939/http://blogs.msdn.com/b/oldnewthing/archive/2006/07/26/679044.aspx) [ONT2](https://web.archive.org/web/20170202195259/https://blogs.msdn.microsoft.com/oldnewthing/20040108-00/?p=41163/)

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2008-09-12T00:41:42.747

*   `__declspec(dllexport)`告诉链接器您希望此对象可供其他 DLL 导入。它在创建其他人可以链接到的 DLL 时使用。

*   `__declspec(dllimport)`从 DLL 导入实现，以便您的应用程序可以使用它。

我只是一个新手 C/C++ 开发人员，所以也许有人比我有更好的解释。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-09-12T00:43:32.773

两种不同的用例：

1）您在 dll 中定义一个类实现。您希望另一个程序使用该类。在这里，您在创建希望 dll 公开的类时使用 dllexport。

2）您正在使用由 dll 提供的功能。您包括随 dll 提供的标头。这里头文件使用 dllimport 来引入当前程序要使用的实现。

通常在这两种情况下使用相同的头文件并定义一个宏。构建配置根据需要定义要导入或导出的宏。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-12T00:43:34.117

Dllexport 用于将函数标记为已导出。您在 DLL 中实现该函数并将其导出，以便任何使用您的 DLL 的人都可以使用它。

Dllimport 则相反：它将函数标记为从 DLL 导入。在这种情况下，您只需声明函数的签名并将代码与库链接。``******