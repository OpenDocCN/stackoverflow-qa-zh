# StackOverflow 问答 11977000-11977999

# debian - 防火墙在 Debian 上填满了我的日志文件，我该如何阻止它？

> ID：11977000
> 
> 赞同：0
> 
> 时间：2012-08-15T20:46:06.863
> 
> 标签：debian, firewall

我在 Debian 6.0 上运行 Shorewall 作为防火墙和 NAT。

我现在有一个问题，我的 /var/log/syslog 和 /var/log/messages 充满了像这样的数十万行：

```
Aug 15 22:37:34 pathfinder kernel: [ 3091.789049] Shorewall:loc2fw:REJECT:IN=eth0 OUT= MAC=00:32:4d:7a:d7:53:00:24:8c:df:44:48:08:00 SRC=192.168.1.100 DST=83.233.146.100 LEN=104 TOS=0x00 PREC=0x00 TTL=64 ID=29973 PROTO=UDP SPT=60003 DPT=53247 LEN=84 
Aug 15 22:37:37 pathfinder kernel: [ 3094.790387] Shorewall:loc2fw:REJECT:IN=eth0 OUT= MAC=00:32:4d:7a:d7:53:00:24:8c:df:44:48:08:00 SRC=192.168.1.100 DST=83.233.146.100 LEN=104 TOS=0x00 PREC=0x00 TTL=64 ID=29974 PROTO=UDP SPT=60003 DPT=53247 LEN=84 
```

我不确定为什么 192.168.1.100 机器会这样做（试图从路由器上的内部网络接口 eth0 中访问我的公共 IP。现在这并不重要，但我不想让我的日志充满这个.

我的日志设置看起来像这样 /etc/shorewall/shorewall.conf

```
###############################################################################
#                              L O G G I N G
###############################################################################

LOGFILE=/var/log/messages

STARTUP_LOG=/var/log/shorewall-init.log

LOG_VERBOSITY=1

LOGFORMAT="Shorewall:%s:%s:"

LOGTAGONLY=No

LOGRATE=

LOGBURST=

LOGALLNEW=

BLACKLIST_LOGLEVEL=

MACLIST_LOG_LEVEL=info

TCP_FLAGS_LOG_LEVEL=""
# above was in original setting info

SMURF_LOG_LEVEL=info

LOG_MARTIANS=Yes 
```

我尝试将 log_verbosity 设置为 0 和 -1 均未成功。我也尝试过（如您所见）将 tcp_flag_log_level 更改为空字符串。

岸墙的哪个部分产生这些消息，我怎样才能阻止它们出现在我的日志文件中？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-16T16:28:31.797

我找到了问题！

/etc/shorewall/policy 看起来像这样

```
###############################################################################
#SOURCE         DEST            POLICY          LOG LEVEL       LIMIT:BURST

loc             net             ACCEPT
loc             $FW             ACCEPT
net             all             DROP            info
$FW             net             ACCEPT
# THE FOLLOWING POLICY MUST BE LAST
all             all             REJECT          info 
```

我把它改成了

```
###############################################################################
#SOURCE         DEST            POLICY          LOG LEVEL       LIMIT:BURST

loc             net             ACCEPT
loc             $FW             ACCEPT
net             all             DROP            warn
$FW             net             ACCEPT
# THE FOLLOWING POLICY MUST BE LAST
all             all             REJECT          info 
```

最后我的日志文件又恢复了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-16T01:45:35.003

在 /etc/cron.d 我放置了一个文件：log2zero。基本上它会运行 ecery 8 分钟的命令，将大于 100mb 的日志文件设置为零。

```
SHELL=/bin/sh
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=root
*/8 * * * *   root  find /var/log /var/local/log -size +100M -type f | while read file; do cat /dev/null > $file && echo "$file > 100M (set to zero)"; done 
```

# ios - 访问本地定义的标签

> ID：11977001
> 
> 赞同：0
> 
> 时间：2012-08-15T20:46:09.073
> 
> 标签：ios, uilabel

我的应用程序有一个创建标签的方法

```
 -(void)addLabel:(float)x:(float)y:(float)w:(float)h:(NSString *)text {
        CGRect label1Frame = CGRectMake( x, y, w, h );
        UILabel *label1 = [[UILabel alloc] initWithFrame: label1Frame];
        label1.text = text;
        [self.view addSubview:label1];} 
```

然后我从其他方法调用这个方法。

我如何访问这些标签之一以将其从超级视图中删除，因为我没有它的 var 名称。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T20:51:53.613

```
-(void)addLabel:(float)x :(float)y :(float)w :(float)h :(NSString *)text tag:(NSInteger)tag {
    CGRect label1Frame = CGRectMake( x, y, w, h );
    UILabel *label1 = [[UILabel alloc] initWithFrame: label1Frame];
    label1.tag = tag;
    label1.text = text;
    [self.view addSubview:label1];
} 
```

然后传入一个适当的`tag`值（一个整数），它是唯一的。然后使用：

```
UILabel *label = (UILabel *)[self.view viewWithTag:someIntID]; 
```

访问它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-15T20:49:44.303

您需要为其创建一个 ivar/属性。如果你不想在你的接口上有这个标签，在你的实现文件中声明一个类扩展并声明你的标签

```
@interface yourclass()
@property (nonatomic, weak)UILabel *yourLabel;
@end 
```

请记住将您的 @synthesize 添加到您的实现文件中。将标签添加为子视图后将值分配给属性。

# list - OCaml 中 ('a -> 'b) 列表 -> 'a -> 'b 列表类型的函数

> ID：11977009
> 
> 赞同：2
> 
> 时间：2012-08-15T20:46:43.220
> 
> 标签：list, types, polymorphism, ocaml

> 编写任何类型为的 Ocaml 函数`('a -> 'b) list -> 'a -> 'b list`

`('a -> 'b) list`是最让我困惑的部分。我是 OCaml 的新手，很难理解如何编写函数来获取特定的数据类型。

```
# let int x = x+1;;
# let fcn = [int; int];; 
```

所以我传递一个函数一个函数和一个变量。我要将该变量添加到列表的每个元素并返回列表？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-08-15T20:53:54.837

`('a -> 'b)`表示从 type`'a`到 type的函数`'b`。基本上，您需要创建一个函数，该函数接受一个接受`'a`和返回的函数列表`'b`，加上一个特定`'a`值，并返回一个`'b`值列表（可能通过将函数列表中的每个函数应用于特定`'a`值）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-08-15T23:03:43.243

As this is homework, I will not provide you with a complete solution. But, as a hint, I would suggest that you take a look at this implementation of the familiar `map` function:

```
let rec map f = function
  | [] -> []
  | x :: xs -> f x :: map f xs 
```

It has type `('a -> 'b) -> 'a list -> 'b list` which means that it takes as its first argument a function that takes values of some type `'a` to values of some type `'b`, as its second argument a list of elements of type `'a`, and that it produces a list of elements of type `'b`. It proceeds by pattern matching on the argument list and, recursively applying the function (`f`) to every element `x` of the list.

Now have a look at the type of the function that you have to write? What does it tell you about the required behaviour of that function? Keeping the implementation of the `map` function in mind, how would you write your function?

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-08-19T21:19:53.880

```
('a -> 'b) list -> 'a -> 'b list 
```

这意味着您的函数有两个参数

*   其中的列表`('a -> 'b)`表示一个函数，该函数将 type 的元素`'a`作为参数并返回 type 的元素`'b`。如您所见，这些类型是抽象的，因此它们可以是任何类型，例如`(int -> int)`等等`(int -> float)`......
*   类型的元素`'a`。请注意，此类型必须与函数的参数相同。

因此，您将使用作为参数提供的元素来构建结果列表。

这是一个小例子：

```
let action l a =
  let rec todo l res =
    match l with
      | [] -> res
      | h :: t -> todo t res@[h a] in
  todo l [] 
```

所以在这里，任何类型的函数都`int -> int`将被接受。只要您不将它们与其他类型混合，任何其他类型也一样。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-12-31T10:41:53.653

```
let rec func f a = match f with          (* ( 'a->'b ) list -> 'a -> 'b list *)
                       |[]->[]
                       |x::lr -> x a :: func lr a;; 
```

这可能会有所帮助！它工作正常
***1 -***我们知道，ocaml 逐行创建函数的类型

***2 -***在这个函数中，我们有两个参数**f**和**a**

***3 -*** **( 'a->'b ) 列表** ：对于**f**

***4 -*** **'a**：**为**
***！ocaml 是怎么做到的？***听 ！

***5 -***当我们将 f 与 [ ] 'blank list' ocaml release 匹配时，它是一个列表**（****）列表**，但不知道代码的最后一行中包含什么，他会做吗？好的 ！
- 这里我们在代码的最后一行，我们只有 f 类型的 list -

***6 -*** **x :: lr**表示我们对之前匹配的元素的第一个元素进行排序： **f**并在此处添加**a** ocaml 为**a**和匹配的列表元素提供类型： **f**作为第一个元素 ocaml 为它们提供类型 from **'a**到**'z**所以这里我们**有f 的 ('a->'b) 列表和 a 的 'a -这里我们有 f****类型**：(' **a** **-** >' **b** )**列表** 和 **a**类型： **'a**

 *********7 -***这个函数的结果**'b list**所以你可以在评论中回答！**:D 谢谢********

# perl - 如何在 Perl 测试套件中并行运行一些但不是所有测试？

> ID：11977015
> 
> 赞同：16
> 
> 时间：2012-08-15T20:47:07.607
> 
> 标签：perl, testing, parallel-processing, automated-tests

我有一个基于 Perl 的测试套件，其中包含 10,000 多个测试，我想让它们运行得更快。我已经使用`-j`to 标志进行了测试`prove`，我发现我的大多数但不是所有的测试都准备好并行运行。

虽然我可以努力使剩余的测试“并行友好”，但我希望总有一些测试不是。有什么好的方法来管理这个？我希望它可以轻松高效地运行整个测试集，并在需要时轻松将测试标记为“未准备好”。

以下是我看到的一些选项：

1.  [可以对证明进行修补以支持某些未并行准备的测试](https://rt.cpan.org/Public/Bug/Display.html?id=77238)
2.  Jenkins 被用来管理测试套件的运行。我可以将非并行测试拆分为他们自己的运行。换句话说，放弃并使用两次测试运行。
3.  也许有一种方法可以将两个`TAP`我尚未恢复的结果流合并在一起。

我不太关心如何管理例外列表。我可以在文件中保留一个列表作为测试工具基础设施的一部分，或者我可以在每个测试标头中放置一些东西来标记它，我们的测试工具可以动态确定异常列表。

（测试套件部分基于 Test::Class，我还将查看 Test::Class::Load 以加快它的速度。）

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2012-08-15T21:19:10.180

我找到了解决方案。[它在TAP::Harness 的 aggregate_tests()](https://metacpan.org/module/TAP::Harness#3)的文档中。它包含一个代码示例，说明我如何为此目的编写自己的工具：

> ...这很有用，例如，在某些测试应该并行运行但其他测试不适合并行执行的情况下。

```
my $formatter   = TAP::Formatter::Console->new;
my $ser_harness = TAP::Harness->new( { formatter => $formatter } );
my $par_harness = TAP::Harness->new(
    {   formatter => $formatter,
        jobs      => 9
    }
);
my $aggregator = TAP::Parser::Aggregator->new;

$aggregator->start();
$ser_harness->aggregate_tests( $aggregator, @ser_tests );
$par_harness->aggregate_tests( $aggregator, @par_tests );
$aggregator->stop();
$formatter->summary($aggregator); 
```

从那里看起来我可以：

*   子类`App::Prove`和覆盖`_runtests()`，这是上面的新功能可以合并的地方。
*   Fork`prove`以便它调用`My::App::Prove`而不是`App::Prove`.

现在我更好地理解了这些部分是如何组合在一起的，我可以看到我如何创建一个补丁来`prove`添加一个类似的选项`--exclude-from-parallel FILE`，这将允许您指定一个文件，其中包含要从并行测试中排除的测试文件列表。

**2012-08-16 更新：**我现在有一个补丁`prove`，并已提交以供审核。您可以[查看和评论 Pull Request](https://github.com/Perl-Toolchain-Gang/Test-Harness/pull/3)。运行输出后不生成摘要。目前尚不清楚为什么。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-08-20T11:46:50.220

到目前为止，我已经找到了解决这个问题的最佳解决方案。事实证明，`prove`自 2008 年以来，它一直支持将某些测试标记为按顺序运行而不是并行运行。它得到了 TAP::Parser::Scheduler 中一个相当奇特的“规则”系统的支持，该系统允许复杂的订购安排规范并行和顺序测试运行。

这是当前的基本配方`prove`：

```
 # All tests are allowed to run in parallel, except those starting with "p"
 --rules='seq=t/p*.t' --rules='par=**' 
```

我有一个新的[拉取请求](https://github.com/Perl-Toolchain-Gang/Test-Harness/pull/5)，为这个特性添加了文档，并开始讨论可能为基本异常提供更简单的语法。有关详细信息，请参阅拉取请求。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-08-17T18:01:10.043

我找到了另一个宣传此功能的解决方案，但我只能让琐碎的案例起作用。这是使用[Test::Steering](https://metacpan.org/module/Test%3a%3aSteering)。它允许我这样做：

```
include_tests( { jobs => 4 }, @parallel_tests );
include_tests( @serial_tests  ); 
```

使用此解决方案，请注意：

*   在它真正起作用之前，我目前必须[修补代码以修复](https://rt.cpan.org/Ticket/Display.html?id=62681)多年来一直未修补的基本错误。
*   需要额外的代码来处理生成要运行的并行和串行测试列表。
*   我实际上并没有得到我真实世界测试的综合总结......两个部分都发出了自己的总结报告，所以它并没有真正起作用。也许我错过了什么，或者它坏了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-11-25T16:15:51.547

Test::Parallel 还提供了一种更简单的方法来并行运行一些测试查看来自[https://metacpan.org/pod/Test::Parallel的示例](https://metacpan.org/pod/Test::Parallel)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-05-15T21:22:02.100

另一种选择：使用[TAP::Harness](http://search.cpan.org/~leont/Test-Harness-3.35/lib/TAP/Harness.pm%20TAP::Harness)的规则文件。

您可以在 YAML 文件（默认称为 testrules.yml）中构建自定义规则。我需要类似于你描述的东西，我可以用一个看起来像这样的 testrules.yml 文件来做到这一点：

```
---
    序列：
        # 未准备好并行的测试（将单独运行）
        - 序列：
            -t/test1.t
            - t/test2.t
        # 可以并行运行的测试
        - 标准杆：
            # 其他所有内容的通配符
            - **

```

就我而言，我将它与直接调用 App::Prove 的代码一起使用，而不是 command-line `prove`。但我认为它也可以使用`prove`？

# c# - Silverlight - 使用继承时的绑定问题

> ID：11977017
> 
> 赞同：1
> 
> 时间：2012-08-15T20:47:18.210
> 
> 标签：c#, wpf, silverlight, binding, esri

我正在使用来自 Esri 的地图，它提供了一个功能，您可以将集合绑定到地图，它为绘制和渲染图形点提供了所有魔力。它只要求对象具有一些要绑定的属性，如下所示：

```
<esri:PointDataSource
         ItemsSource="{Binding Path=PlottedData, Source={StaticResource ViewModel}, Mode=TwoWay}"
         XCoordinateBinding="{Binding X}"
         YCoordinateBinding="{Binding Y}"
         IsSelectedBinding="{Binding IsSelected, Mode=TwoWay}"> 
```

当然，我的应用程序需要的数据不仅仅是这些点，而且还有不同的类型。这导致我们为所有不同类型创建 DataPoint 的子类，然后将它们传递给地图，这样地图就不会更明智了。

我在没有子类的演示应用程序中很好地工作，但是当我将它合并到应用程序中并开始从服务作为子类接收数据时，IsSelected 功能停止工作。我可以确认所有点上的 IsSelected 属性正在按预期切换，但是当我切换它们时，它们不会反射回地图上。*澄清一下，如果我在它们返回模型后*用这个替换服务结果：

```
var returned = new ObservableCollection<DataPoint>()
    {
        new DataPoint(){IsPlottable = true, IsSelected = false, X = 722762, Y = 488253},
        new DataPoint(){IsSelected = false, X = 810000, Y = 550000, IsPlottable = true},
        new DataPoint(){IsSelected = false, X = 801000, Y = 480000, IsPlottable = true},
        new DataPoint(){IsSelected = false, X = 800100, Y = 500000, IsPlottable = true},
        new DataPoint(){IsSelected = false, X = 800010, Y = 506000, IsPlottable = true}
    }; 
```

然后它工作。然后当我用这个替换它时：

```
var returned = new ObservableCollection<DataPoint>()
    {
        new DataPointSubclass(){IsPlottable = true, IsSelected = false, X = 722762, Y = 488253},
        new DataPointSubclass(){IsSelected = false, X = 810000, Y = 550000, IsPlottable = true},
        new DataPointSubclass(){IsSelected = true, X = 801000, Y = 480000, IsPlottable = true},
        new DataPointSubclass(){IsSelected = false, X = 800100, Y = 500000, IsPlottable = true},
        new DataPointSubclass(){IsSelected = true, X = 800010, Y = 506000, IsPlottable = true}
    }; 
```

它停止工作。同时，这些点被正确绘制了——所以我知道绑定至少在创建绑定集合时是有效的（注意上面的子类是如何有一些 IsSelected = true; 最初也是正确绑定的）。

我的继承实现可能会导致绑定从基本上从单向/双向绑定切换到一次性绑定？我可以错误地归因于这个问题吗？

**编辑**：感谢下面的评论，我将其范围缩小到 PropertyChange 事件处理程序在设置 IsSelected 时为空。为清楚起见，这里是我在基类中定义 IsSelected 的公共成员的地方：

```
 [DataMember]
    public bool IsSelected
    {
        get { return _IsSelected; }
        set
        {
            if (_IsSelected != value)
            {
                _IsSelected = value;
                if (PropertyChanged != null)
                    PropertyChanged(this, new PropertyChangedEventArgs("IsSelected"));
            }
        }
    } 
```

在我的演示应用程序中，一切正常，如果我使用上面的第一组虚拟点（有效），PropertyChanged 不为空，并且 setter 引发 PropertyChanged 事件。

但是，当使用 DataPointSubclass 时，PropertyChanged 始终为 null（但正在触发 setter）。我在这里能错过什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T21:08:21.013

您的服务代码有`ObservableCollection<DataPoint>()`，所以我猜该方法的返回类型是`IQueryable<DataPoint>`or `IEnumerable<DataPoint>`。

通过这样做，它只是序列化它知道的位（即`DataPoint`）并忽略其他成员。

您需要将预期类型更改为派生类才能正确序列化。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-16T16:54:42.780

这是我的工具妨碍的情况之一。

我有一个实现 INotifyPropertyChanged 服务器端的基类。我的服务返回一个对象集合，这些对象是它的子类。由于它是一个子类，我的客户需要访问基类。为了解决这个问题，我添加了一个真正存在于服务器端的文件客户端作为链接。这样，当我更新服务引用时，会在客户端（在references.cs中）生成一个部分类，它看起来有点像这样：

```
public partial class DataPointSubclass: Application.Server.Data.SharedCode.DataPoint, INotifyPropertyChanged { } 
```

它是一个非常酷的功能，除了它实现了 INotifyPropertyChanged，尽管 DataPoint 也实现了它。这是一个很大的禁忌，是我所有问题的根源。**当您在子类上重新实现 INPC（至少，不覆盖基类的属性）时，PropertyChanged 在基类中将始终为 null**。在这种情况下，服务引用自动实现了 INotifyPropertyChanged，而不检查它的基类是否已经实现了它。

**解决方案**：您必须在 References.svcmap 中禁用此功能。查找此属性并将其设置为*false*：

```
<EnableDataBinding>true</EnableDataBinding> 
```

您可以通过在解决方案资源管理器中显示所有文件并查看服务器引用树来找到 References.svcmap。

通过这样做，通过更新服务引用自动生成的类不会自动实现 INotifyPropertyChanged。如果您想拥有该功能，您可能必须手动实现它。

# amazon-s3 - EC2 到 S3 - 亚马逊

> ID：11977018
> 
> 赞同：0
> 
> 时间：2012-08-15T20:47:23.757
> 
> 标签：amazon-s3, amazon-ec2, amazon, flash-media-server, s3fs

我在 EC2 机器上运行 Adob​​e Media Server 5，并且我还有一个录制应用程序，可将 .flv 文件保存到默认的 AMS 文件夹，我想在所有录制的文件到达文件夹后立即将它们发送到 S3。

由于我们使用的是 RTMP，我需要在用户停止录制后执行此操作，然后关闭连接并运行该例程（自动）

有没有办法做到这一点？

我的 EC2 和 S3 在同一个区域，但你知道这些传输是像闪电一样，还是像任何其他上传到服务器一样？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-16T15:27:28.847

看一下[s3cmd](http://s3tools.org/s3cmd)，它将允许您直接从 EC2 实例的 shell 与 S3 交互。因此，您可以将文件上传集成到您的工作流程中。一个简单的上传如下所示：

```
s3cmd put --acl-public --guess-mime-type test.flv s3://example.com/videos/test.flv 
```

响应将如下所示：

```
File 'test.flv' stored as s3://example.com/videos/test.flv (xxxx bytes)
Public URL of the object is: http://example.com.s3.amazonaws.com/videos/test.flv 
```

如果需要，您可以使用正则表达式来提取公共 url。如果您不希望您的文件公开，只需去掉`--acl-public`put 命令。

关于速度：stackoverflow 上有一个关于此主题的信息线程：[提高 Amazon EC2 上的数据传输速率](https://stackoverflow.com/questions/5912921/improving-data-transfer-rate-on-amazon-ec2)

# javascript - 显示 iframe 值

> ID：11977020
> 
> 赞同：0
> 
> 时间：2012-08-15T20:47:39.427
> 
> 标签：javascript, javascript-events

我正在尝试显示表盘的角度。我有四个表盘。我的代码适用于一个拨号。感谢您对如何显示所有拨号值的建议。这是我的代码。

```
function myAngle() {
    var angleVal = window.frames['clkwise1'].document.getElementById("demo").innerHTML;
    var angleVal1 = window.frames['antiClkwise1'].document.getElementById("demo").innerHTML;
    var angleVal2= window.frames['clkwise2'].document.getElementById("demo").innerHTML;
    var angleVal3= window.frames['antiClkwise2'].document.getElementById("demo").innerHTML;
    var angleVal4 = window.frames['clkwise3'].document.getElementById("demo").innerHTML;

    document.getElementById("anglesvalue").innerHTML = angleVal, angleVal1; 
```

// 这就是我如何在点击时提取值。它适用于第一个角度值

```
<p <b id="anglesvalue"></b></p>
<input  type= button id= bttn name= bttn onclick= "myAngle()"  value= "Get Angle" /> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T20:52:06.963

只需将它们连接成一个字符串：Q_Q

```
document.getElementById("anglesvalue").innerHTML = angleVal+ angleVal +  angleVal2 + angleVal3 + angleVal4; 
```

编辑：如果你想用昏迷分开，请执行以下操作：

```
document.getElementById("anglesvalue").innerHTML = angleVal+', '+ angleVal1 +', '+  angleVal2 +', '+ angleVal3 +', '+ angleVal4; 
```

# php - PHP：fopen 与流

> ID：11977043
> 
> 赞同：0
> 
> 时间：2012-08-15T20:48:48.063
> 
> 标签：php, http, stream, fopen

运行 PHP 5.3 的站点，它内置了“流”扩展，但它没有出现在扩展列表中，所以我猜它不能被禁用。

“allow url fopen”被禁用，所以我不能使用 fopen 发出外部请求。

但是我仍然可以使用“流”来这样做（stream_socket_client / fwrite / stream_get_contents）。

这是正常的吗？有没有办法禁用“流”？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T20:54:49.243

正如[PHP 手册](http://php.net/manual/en/stream.installation.php)中所写：
从 4.3.0 版开始，流是 PHP 不可或缺的一部分。无需任何步骤即可启用它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T21:26:50.967

> 有没有办法禁用“流”？

如果这是您 Q 的症结所在，那么是的，有人可能会通过将流相关功能添加到 php.ini 指令来禁用它们`disable_functions`。

如果它绕过allow_url_fopen，那么大多数人似乎都在使用cURL，看看它是否在你的phpinfo（）读数中被激活。

# java - 我怎样才能使这个类成为一个小程序

> ID：11977045
> 
> 赞同：-1
> 
> 时间：2012-08-15T20:49:04.787
> 
> 标签：java, swing, applet

我有以下类，它是一个简单的 gui，我想让它成为一个小程序，以便它可以显示在浏览器中。我知道如何将代码嵌入到 html 页面中（完成）......但是如何让我的课程成为一个小程序？另外，我假设我不需要一个网络服务器来在我的浏览器中显示小程序......

```
package tester1;

import javax.swing.*;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

public class PanelTest implements ActionListener {

    JFrame frame;
    JLabel inputLabel;
    JLabel outputLabel;
    JLabel outputHidden;
    JTextField inputText;
    JButton button;
    JButton clear;
    JButton about;

    public PanelTest() {
       frame = new JFrame("User Name");
       frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
       frame.setLayout(new GridLayout(3, 2, 10, 10));

       //creating first row
       JPanel row1 = new JPanel();
       inputLabel = new JLabel("Your Name");
       inputText = new JTextField(15);
//       FlowLayout flow1 = new FlowLayout(FlowLayout.CENTER, 10, 10);
//       row1.setLayout(flow1);
       row1.add(inputLabel);
       row1.add(inputText);
       frame.add(row1);
       //creating second row
       JPanel row2 = new JPanel();
       button = new JButton("Display");
       clear = new JButton("Clear");
       about = new JButton("About");
       button.addActionListener(this);
       clear.addActionListener(this);
       about.addActionListener(new displayAbout());
       row2.add(button);
       row2.add(clear);
       row2.add(about);
       frame.add(row2);
       //creating third row
       JPanel row3 = new JPanel();
       outputLabel = new JLabel("Output:", JLabel.LEFT);
       outputHidden = new JLabel("", JLabel.RIGHT);
//       FlowLayout flow2 = new FlowLayout(FlowLayout.CENTER, 10, 10);
//       row3.setLayout(flow2);
       row3.add(outputLabel);
       row3.add(outputHidden);
       frame.add(row3); 

       frame.pack();
       frame.setVisible(true);

    }  

    //same method listen for two different events
    @Override
    public void actionPerformed(ActionEvent e) {
        String command = e.getActionCommand();
        if(command.equals("Display")) {
            outputHidden.setText(inputText.getText());
        }
        if(command.equals("Clear")) {
            outputHidden.setText("");
            inputText.setText("");
        }        
    }

    //another way to listen for events
    class displayAbout implements ActionListener {
        @Override
        public void actionPerformed(ActionEvent e) {
            JOptionPane.showMessageDialog(frame, "Username 1.1 \n by Jorge L. Vazquez");
        }
    }    

    public static void main(String[] args) {
        PanelTest frameTest = new PanelTest();
    }

} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T20:50:25.670

使用 a[`JApplet`](http://docs.oracle.com/javase/7/docs/api/javax/swing/JApplet.html)而不是 a `JFrame`。确保您阅读[了相关的 Java 教程](http://docs.oracle.com/javase/tutorial/uiswing/components/applet.html)，其中涵盖了 applet 生命周期方法，如`init`、`start`、`stop`和`destroy`.

* * *

作为旁注，您**不**应该在事件调度线程之外构建您的 UI。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-15T20:53:12.473

使用 a`JApplet`而不是`JFrame`像 veer 所说的那样，但您还必须删除`frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);`,`frame.pack();`和`frame.setVisible(true);`

另外，替换`main(String[] args)`为`init()`.

# php - Magento：在 catalog/layer/view.phtml 中获取对搜索结果的引用

> ID：11977046
> 
> 赞同：0
> 
> 时间：2012-08-15T20:49:10.843
> 
> 标签：php, magento

我需要以数组形式访问当前加载的搜索结果，但需要从`catalog/layer/view.phtml`.

我试过使用下面的代码，但它返回一个空数组......

```
$products = $this->getLayout()  
                 ->getBlockSingleton('catalog/product_list')
                 ->getLoadedProductCollection()
                 ->toArray();

echo "<pre>".print_r($products,true)."</pre>";
die(); 
```

这甚至可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T21:28:45.047

您需要获取搜索模型。

下面是获取 Search 模型的代码：

```
$search = Mage::getSingleton('catalogsearch/advanced'); 
```

这是搜索您的产品的代码：

```
$search = Mage::getSingleton('catalogsearch/advanced')->addFilters(array('name' => $term)); 
```

然后要在对象中获取结果，请输入以下行：

```
$search->getProductCollection(); 
```

祝你好运，

逾越节

# python - 列表作为python中的引用类型

> ID：11977060
> 
> 赞同：2
> 
> 时间：2012-08-15T20:50:16.137
> 
> 标签：python, primes

以下是我编写的用于计算第 n 个素数的代码。我初始化 arr = [2,3,5]; 并且 prime(arr,n) 应该修改 arr 以包含前 n 个素数。但 arr 不反映 prime(arr,n) 执行后的变化。我读到列表是作为引用类型传递的，所以下面的代码有什么问题。t 表示必须进行验证的测试用例的数量。

该程序导致错误，指出数组索引超出了 arr 的范围。

```
import sys;
def prime (arr,n):
    while(len(arr)< n):
        num=arr[len(arr)-1]+1;prime=0;
        while(prime==0):
            prime = 1
            for val in arr:
                if(num%val==0):
                    prime=0;
                    break;
            if(prime == 1):
                print "hello";
                arr = arr + [num];print arr; print "--";
            else:
                num = num+1;

t=raw_input();
t=int(t);
arr=[2,3,5];
ans =[];
for v in range (0,t):
    n = raw_input();
    n = int(n);
    if(n<=len(arr)):
        ans = ans + [arr[n-1]];
    else:
        prime(arr,n);print arr;print"arr was printed"
        ans= ans + [arr[n-1]];
print ans;print 'ans '; 
```

以下是上述代码的示例运行

```
>>> 
1
4
hello
[2, 3, 5, 7]
--
[2, 3, 5]
arr was printed

Traceback (most recent call last):
  File "C:\Users\Pulkit\Desktop\Random\nth_prime.py", line 30, in <module>
    ans= ans + [arr[n-1]];
IndexError: list index out of range 
```

提前致谢 ：）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-08-15T20:54:39.333

换行：

```
arr = arr + [num]; 
```

到

```
arr.append(num) 
```

新行实际上更改了`arr`数组。原行没有改变它；它创建了一个名为的*新*变量`arr`（它是[重新绑定操作而不是变异操作](http://en.wikipedia.org/wiki/Name_binding#Rebinding_and_mutation)）

此更改后的示例运行：

```
1
4
hello
[2, 3, 5, 7]
--
[2, 3, 5, 7]
arr was printed
[7]
ans 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T20:58:08.477

列表确实是引用类型（无论它们是否作为参数传递）。但是，这具有特定的定义明确的含义，与传递引用不同。作为引用类型的东西只是意味着它总是通过抽象句柄引用，而不是被复制（例如，在变量赋值时）。由此可见，可变引用类型可以从多个地方变异——例如从另一个函数。

在您的特定情况下，使用`arr.append(...)`代替`arr = arr + [...]`（这在时间和空间上也非常有效）。第一个改变列表对象，后者创建一个新的列表对象并将对它的引用存储在局部变量中（而不是更新传入的变量以引用新对象，就像使用 pass-引用）。

# php - 用 PHP 和 JavaScript 导出 csv 文件

> ID：11977062
> 
> 赞同：3
> 
> 时间：2012-08-15T20:50:16.637
> 
> 标签：php, javascript, codeigniter

我正在尝试实现一种工具，将研究网站中的数据导出为`csv`文件。在我的`download`控制器中，我有：

```
public function export(){
    $data = array(
          array('Name', 'Age', 'City'),
          array('Philippe', '23', 'Palo Alto'),
          array('John', '30', 'San Francisco'),
          array('Paul', '20', 'Los Angeles')
    );

    header('Content-type: text/csv; charset=utf-8');
    header('Content-Disposition: attachment; filename=data.csv');

    $fp = fopen('php://output', 'w');
    foreach( $data as $line ) {
        fputcsv( $fp, $line );
    }
    fclose($fp);
} 
```

从我的`view`，我做：

```
function download() {
     $('#download').empty().html('<img src="<?php echo base_url();?>/images/loader.gif" />');
     $.post('<?php echo base_url();?>/index.php/download/export');
} 
```

并`download()`在用户单击带有`onclick='download()'`. 但是，我没有看到正在下载的文件，也没有看到错误消息。当我查看`firebug`控制台时，我看到：

> 200 OK 29ms jquery.min.js（第 4 行） HeadersPostResponseCookies
> 
> 姓名，年龄，城市 Philippe，23，“Palo Alto”​​ John，30，“San Francisco” Paul，20，“Los Angeles”

我错过了什么？谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T21:06:16.200

您实际上并不需要 AJAX 请求。您希望使用以下命令将用户重定向到文件：

```
window.location = '<?php echo base_url();?>/index.php/download/export'; 
```

AJAX 请求告诉服务器将数据发送回脚本的成功方法。由于它是下载，重定向不会让您离开页面，因此您可以使用此方法而不会混淆您的用户。

# javascript - Javascript重复表单输入

> ID：11977063
> 
> 赞同：1
> 
> 时间：2012-08-15T20:50:18.307
> 
> 标签：javascript, forms, datepicker, duplicates

我有一个表格，我需要两个字段相同。在设置第一个之后，我正在尝试使用 javascript 使第二个与第一个相同。

这是javascript（在我的标签上方）

```
 <script type="text/javascript" charset="utf-8">    
      function updateDate(){        
      startDate = document.getElementById("startdate").value;      
      document.getElementById("enddate").value = startDate;
 } </script> 
```

HTML如下：

```
 <span class="em-events-search-dates em-date-range">
 <input type="text" id="startdate" class="em-date-input-loc em-date-start" onchange="updateDate();" />
 <input type="hidden" class="em-date-input" name="scope[0]" value="<?php if( !empty($_REQUEST['scope'][0]) ) echo $_REQUEST['scope'][0]; ?>" />
 <input type="text" id="enddate" class="em-date-input-loc em-date-end" />
 <input type="hidden" class="em-date-input" name="scope[1]" value="<?php if( !empty($_REQUEST['scope'][1]) ) echo $_REQUEST['scope'][1]; ?>" />
 </span> 
```

我遇到的问题是，当您单击表单字段时，它会打开一个日期选择器。我很确定它使用这个确切的插件[http://jqueryui.com/demos/datepicker/](http://jqueryui.com/demos/datepicker/)

不幸的是，这意味着您在选择日期后从不实际单击表单域，也从不输入任何内容。

我在第二个字段上尝试了 onmouseout（带有类 em-date-input 的隐藏字段）我在第一个 id 为 startdate 的元素上尝试了 onchange

只有当您返回并单击选定日期的可见字段时，其中一些才有效。问题是，用户永远不会这样做。

我什至试着把 onsubmit="updateDate();" 在提交按钮上，希望当您单击它时，它会在提交表单之前更改第二个日期.. 不走运。有什么建议么？

编辑：添加警报以查看哪些有效，哪些无效

```
 <input type="text" onchange="alert('first');" id="startdate" class="em-date-input-loc em-date-start" />
 <input type="hidden" onchange="alert('second');" class="em-date-input" name="scope[0]" value="<?php if( !empty($_REQUEST['scope'][0]) ) echo $_REQUEST['scope'][0]; ?>" />
 <input type="text" onchange="alert('third');" id="enddate" class="em-date-input-loc em-date-end" />
 <input type="hidden" onchange="alert('fourth');" class="em-date-input" name="scope[1]" value="<?php if( !empty($_REQUEST['scope'][1]) ) echo $_REQUEST['scope'][1]; ?>" /> 
```

当我更改第二个框 (id="enddate") 上的日期时，它会触发第三个警报。即使我多次更改第一个框中的日期或通过键入，也不会触发其他警报。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T20:58:12.703

在提交事件之前使用表单：

onsubmit="return YOUR_FUNCTION_HERE()"

只需将其添加为您的提交按钮。

然后在该函数中设置值：

```
var YOUR_FUNCTION_HERE = function(){
    //set your hidden inputs
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T21:26:36.517

如果我理解你的问题，那么你可能想要这个（对你的问题有点困惑）

```
$(function(){
    $('#startdate, #enddate').datepicker();
    $('#startdate').on('change', function(e){
        $('#enddate').val($('#startdate').val());
    });
});​ 
```

[**演示**](http://jsfiddle.net/qZyHQ/4/)或[**这个。**](http://jsfiddle.net/qZyHQ/5/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T20:54:18.300

您需要将一个`onchange`事件连接到`textbox`，然后在它触发后复制您的数据。一旦日期选择器更新值，它就会触发。

# mysql - 使用时间条件连接两个表，sql

> ID：11977067
> 
> 赞同：2
> 
> 时间：2012-08-15T20:50:28.837
> 
> 标签：mysql, sql

我正在尝试加入两个表，但问题是作为一个条件，我需要他们的字段“时间”大致相同。

让我写得清楚一点，这是我到现在为止的想法。

```
SELECT location
FROM retailer
LEFT JOIN imovo
ON retailer.time=imovo.time. 
```

现在，我真正需要的不是这个：retailer.time=imovo.time，但我需要零售商表中字段的秒数与 imovo 时间字段之间的差异不大于 4 秒。

让我解释一下，假设零售商的时间字段显示：11:11:23 如果来自 imovo 的时间介于 11:11:23 和 11:11:26 之间，我应该加入这两个表

那么，你能帮我解决这个问题吗？谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T20:59:54.547

我没有对此进行测试，但我认为它应该可以工作：

```
imovo.time between retailer.time and retailer.time + interval 4 second 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T21:00:59.917

```
...
ON addtime(retailer.time, '0:0:4')<imovo.time
AND retailer.time >imovo.time 
```

[http://dev.mysql.com/doc/refman/5.5/en/date-and-time-functions.html#function_addtime](http://dev.mysql.com/doc/refman/5.5/en/date-and-time-functions.html#function_addtime) http://dev.mysql.com/doc/refman/5.5/en/date-and -time-functions.html#function_subtime

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T20:54:22.370

在小时和分钟上进行连接并添加 where 子句作为

伪代码，其中 (imovo.time - Retailer.time) < 4 秒

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-08-15T21:08:58.973

如果您想按照早期海报的建议进行操作，并按小时和分钟加入，您可以尝试内置的 HOUR 和 MINUTE 功能。看：

参考资料和有用的页面：

*   [“MySQL :: MySQL 5.0 参考手册 :: 12.7 日期和时间函数——小时” [dev.mysql.com]](http://dev.mysql.com/doc/refman/5.0/en/date-and-time-functions.html#function_hour)
*   [“MySQL :: MySQL 5.0 参考手册 :: 12.7 日期和时间函数——分钟” [dev.mysql.com]](http://dev.mysql.com/doc/refman/5.0/en/date-and-time-functions.html#function_minute)
*   [Google 搜索：'mysql 日期时间获取秒数'](http://www.google.ca/#hl=en&sclient=psy-ab&q=mysql+date+time+get+seconds&oq=mysql+date+time+get+seconds&gs_l=hp.3...2524.7934.0.8533.27.27.0.0.0.0.111.1400.26j1.27.0.efrsh..0.0...1.60PyV0RCpGk&pbx=1&bav=on.2,or.r_gc.r_pw.r_qf.&fp=c8555e532373c719&biw=1680&bih=972)

[[引用历史记录](http://bit.ly/Of1GMV)]

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-08-15T21:09:21.013

我认为 MySQL 不支持 INTERVAL （无法在手册中快速找到它），如果 ti 支持，请将@grossvogel 的答案与 +/- 4 混合，以使您的保证金在双方都有效。

```
SELECT location
FROM retailer
LEFT JOIN imovo
ON TO_SECONDS(imovo.time) BETWEEN TO_SECONDS(retailer.time) - 4 AND TO_SECONDS(retailer.time) + 4 
```

# haskell - 管道 Sink 内的嵌套 ResourceT 范围

> ID：11977071
> 
> 赞同：3
> 
> 时间：2012-08-15T20:50:56.797
> 
> 标签：haskell, conduit

有没有办法`runResourceT`限制一个单一的生命周期`Sink`？

我正在尝试构建一个`Sink`包装可能无限数量的`Sinks`. 这适用于线程，但我试图在没有线程的情况下做到这一点。似乎应该是可能的。由于范围界定，我遇到了障碍`runResourceT`：我的资源管理粒度太粗（但功能齐全）或太细（完全损坏）。

```
{-# LANGUAGE FlexibleContexts #-}

import Control.Monad.Trans (lift)
import Control.Monad.Trans.Resource
import Data.ByteString (ByteString)
import qualified Data.ByteString.Char8 as BC8 (pack)
import Data.Conduit
import qualified Data.Conduit.Binary as Cb
import qualified Data.Conduit.List as Cl
import System.FilePath ((<.>))

test :: IO ()
test =
  runResourceT
      $ Cl.sourceList (fmap (BC8.pack . show) [(1 :: Int)..1000])
     $$ rotateResourceHog "/tmp/foo"

-- |
-- files are allocated on demand but handles are released at the same time
rotateResourceHog
  :: MonadResource m
  => FilePath -> Sink ByteString m ()
rotateResourceHog filePath = step 0 where
  step i = do
    x <- Cl.peek
    case x of
      Just _  -> do
        chunkWriter $ filePath <.> show (i :: Integer)
        -- loop
        step $ i+1

      Nothing -> return ()

-- |
-- files are allocated on demand but handles are released immediately
rotateUsingClosedHandles
  :: (MonadBaseControl IO m, MonadResource m)
  => FilePath -> Sink ByteString m ()
rotateUsingClosedHandles filePath = step 0 where
  step i = do
    x <- Cl.peek
    case x of
      Just _  -> do
        transPipe runResourceT . chunkWriter $ filePath <.> show (i :: Integer)
        -- loop
        step $ i+1

      Nothing -> return ()

chunkWriter
  :: MonadResource m
  => FilePath -> Sink ByteString m ()
chunkWriter filePath = do
  _ <- lift $ allocate (putStrLn "alloc") (\ _ -> putStrLn "free")

  -- the actual conduit chain is more complicated
  Cl.isolate 100 =$= Cb.sinkFile filePath 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-16T04:45:11.430

`ResourceT`仅用于在特殊情况下清理资源。它不是为了提供*快速*的最终确定，只是*保证*最终确定。为了及时起见，`conduit`提供了自己的工具来处理清理。在您的情况下，您正在寻找两者：您希望清理尽可能早地发生，并且即使在抛出异常的情况下也会发生。为此，您应该使用`bracketP`. 例如：

```
chunkWriter
  :: MonadResource m
  => FilePath -> Sink ByteString m ()
chunkWriter filePath = bracketP
    (putStrLn "alloc")
    (\() -> putStrLn "free")
    (\() -> Cl.isolate 100 =$= Cb.sinkFile filePath) 
```

这导致了 alloc 和 free 输出的所需交错。

# sql-server-2008 - 一个大数据库，还是每个客户一个？

> ID：11977077
> 
> 赞同：1
> 
> 时间：2012-08-15T20:51:11.957
> 
> 标签：sql-server-2008

我被要求开发一个应用程序，该应用程序将用于多个业务部门。每个单元的应用程序将基本相同，但会有细微的程序差异，这不会改变底层数据库的结构。我应该为每个业务单位使用一个数据库，还是为所有单位使用一个大数据库？业务部门完全独立

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T21:04:53.537

我的偏好是每个客户端一个数据库。优点：

*   如果客户端变得太大，它们很容易移动——备份、恢复、更改连接字符串、繁荣。当他们的数据与大型数据库中的其他数据混合在一起时，请尝试这样做。即使您使用模式和文件组来隔离，移动它们也不是小菜一碟。

*   在客户继续前进时删除客户的数据也是如此。

*   根据定义，您将每个客户的数据分开。这通常是一种需要，有时是一种需要。有时它甚至会具有法律约束力。

*   数据库中的所有代码都更简单 - 它不必包含客户端的模式（无法参数化），并且您的表不必乱扔指示客户端的额外列。

很多人会声称管理 200 或 500 个数据库比管理 10 个数据库困难得多。根据我的经验，这并没有什么不同。您构建自动化脚本，错开索引维护和备份作业等。

潜在的缺点是当您进入每个实例 4 位数和更高数据库的领域时，您想开始考虑拥有多个服务器（阈值实际上取决于工作负载和硬件，所以我只是选择一个数字）。如果您正确构建系统，添加第二台服务器并在那里放置新数据库应该非常简单。同样，应用程序应该知道每个客户端的连接字符串，而您通过使用不同的服务器所做的一切就是更改连接字符串指向的实例。

您应该查看有关 dba.SE 的一些问题。它们并不全是关于 SQL Server，但许多概念和挑战是通用的：

[https://dba.stackexchange.com/questions/16745/handling-growth-number-of-tenants-in-multi-tenant-database-architecture](https://dba.stackexchange.com/questions/16745/handling-growing-number-of-tenants-in-multi-tenant-database-architecture)

[https://dba.stackexchange.com/questions/5071/what-are-the-performance-implications-of-running-multiple-smaller-dbs-instead-of](https://dba.stackexchange.com/questions/5071/what-are-the-performance-implications-of-running-multiple-smaller-dbs-instead-of)

[https://dba.stackexchange.com/questions/7924/one-big-database-vs-several-smaller-ones](https://dba.stackexchange.com/questions/7924/one-big-database-vs-several-smaller-ones)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-15T21:08:49.277

你的问题是一个设计问题。为了回答它，您需要了解您要构建的系统的要求。从技术角度来看，SQL Server——或者实际上是任何数据库——可以处理任何一种情况。

这里有一些需要考虑的事情。

第一个问题是您的客户需要数据的分离程度。在某些情况下（例如，银行的投资方和市场分析方）将来自不同业务部门的数据混合在一起可能是不合法的。在这种情况下，单独的数据库是解决方案。

下一个问题是安全性。在某些情况下，客户可能会因为知道他们的数据与其他客户数据混合在一起而感到非常不舒服。一个小失误，机密信息被无意中共享。对于同一家公司的不同业务部门来说，这可能不是问题。

您是否必须处理不同的正常运行时间要求、上传要求、自定义以及可能与其他工具的交互？如果一个业务部门需要尽快进行其他业务部门不感兴趣的定制，那么这建议使用不同的数据库。

另一个考虑因素是性能。此应用程序是否使用大量昂贵的资源？如果是这样，能够将应用程序分区到不同的数据库——可能还有不同的服务器——可能是非常可取的。

另一方面，如果大部分数据是共享的，并且存储库实际上是具有相同底层功能的中央存储库，那么一个数据库是一个不错的选择。

# php - 通过 php 访问 blob 存储

> ID：11977079
> 
> 赞同：1
> 
> 时间：2012-08-15T20:51:31.177
> 
> 标签：php, azure-storage

我不是 php 开发人员，这是我第一次使用 php。我被分配到一个项目以将其移至 Windows Azure。该应用程序是php（我认为它是旧的php，因为没有类或对象）。我将使用 Blob 存储来保存上传的文件。我已经阅读了很多关于 php 和 WA 的文章。已使用 Web 角色和平台安装程序安装 PHP。该应用程序工作并与 sql azure 通信。但是当我关注这篇文章时

```
 http://blogs.msdn.com/b/silverlining/archive/2012/07/18/new-connection-pattern-in-the-php-client-libraries-for-windows-azure.aspx 
```

它呈现 500 错误。我弄错了，旧的 php 可能与面向对象的 php 不兼容。谢谢你的建议。

# google-drive-api - Google Drive 的每日限制错误消息

> ID：11977083
> 
> 赞同：0
> 
> 时间：2012-08-15T20:51:57.997
> 
> 标签：google-drive-api

尝试使用 Google Drive API 获取文件时收到错误消息。使用 Python，导致错误的行是：

```
file = service.files().get(fileId=googleDriveFileId).execute() 
```

错误信息是：

```
HttpError: <HttpError 404 when requesting 
https://www.googleapis.com/drive/v2/files/0B6Cpn8NXwgGPSE8zQW10XzJMc0k?alt=json returned
"File not found: 0B6Cpn8NXwgGPSE8zQW10XzJMc0k"> 
```

基本上说“找不到文件”

但是，如果我将请求的 URL 放入浏览器，我会收到不同的错误消息：

```
https://www.googleapis.com/drive/v2/files/0B6Cpn8NXwgGPSE8zQW10XzJMc0k

{
 "error": {
  "errors": [
   {
    "domain": "usageLimits",
    "reason": "dailyLimitExceededUnreg",
    "message": "Daily Limit Exceeded. Please sign up",
    "extendedHelp": "https://code.google.com/apis/console"
   }
  ],
  "code": 403,
  "message": "Daily Limit Exceeded. Please sign up"
 }
} 
```

这些错误消息对我来说似乎都不正确。我知道文件在那里。这是从 Google Drive UI 中的“共享链接”检索到的同一文件的有效链接：

```
https://docs.google.com/file/d/0B6Cpn8NXwgGPSE8zQW10XzJMc0k 
```

我还检查了 api 控制台中的配额报告，我们的使用率为 0%。

有什么想法吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-01-09T11:00:56.987

[在 python quickstart](https://developers.google.com/drive/quickstart-python)之后我遇到了类似的错误。

事实证明我已经正确创建了一个 API 密钥等，但是错过了第 2 步：

> 1.  在您的 API 项目中选择 Services 选项卡，然后*启用 Drive API*。

在我跳过之前使用过 API 并错过了这个关键点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-15T21:33:48.883

两条错误消息都没有准确的信息。问题与权限有关。我使用 Google Picker 上传有问题的文件，但由于权限，这些文件不会自动提供给 API。我认为他们会根据文件。

我通过使用 Google Drive UI 为“公共”设置图像上传到的文件夹的权限解决了问题。现在我的应用程序有权访问上传的文件。

虽然在我的情况下将文件权限设置为“公共”是可以的，因为这些文件是公开的，但我知道这在所有情况下都是不可接受的。有人可以说明如何处理此问题....以便使用 Google Picker 上传的文件自动具有 API 访问权限，而无需将文件夹权限设置为“公共”？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-08-30T15:34:10.330

这些消息是准确的。

在第一种情况下，由于您没有权限，Google 会给出未找到的文件。这是一种标准的安全措施，而不是通过确认文件存在来泄露信息。

在第二种情况下，您调用了没有身份验证标头的 API，因此 Google 将您视为未注册和未经授权的应用程序，这对于某些 Google API 是可以的，最多达到每日配额。对于云端硬盘，每日配额为零。

我同意这不直观，而且我敢肯定许多开发人员的年数都被浪费了（包括我的），但它是准确的。

要回答有关上传文件为何无法访问的问题，请检查您是否请求了正确的范围，并且在上传时使用了正确的客户端 ID 和 MIME 类型。

# javascript - 正则表达式匹配评论

> ID：11977087
> 
> 赞同：0
> 
> 时间：2012-08-15T20:52:11.270
> 
> 标签：javascript, regex

我有两种类型的评论块

```
<!-- asdfasd //--> 
```

和

```
<!--asdfasd-->

    <!--
<span onclick="window.open('http://www.abc.com?xyz=asfasdfasd')">magic</span>
--> 
```

我只需要匹配第二个/第三个并且我有这个模式，我尝试了很多组合，但是没有运气。注释还包含所有数字/字母/特殊字符

```
<!--[\s\S]*?--> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T22:43:05.540

```
<!--(\\?|.|\s).*[^/^/]--> 
```

这对我有用

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-02-26T05:41:48.060

尝试以下模式：

```
<!--[\s\S]+?--> 
```

它为我工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T21:08:39.443

对于上面发布的确切字符串，这有效：

```
<!--[^-/]+--> 
```

但是，如果 // 可能在注释中的任何位置，它将不起作用。

我需要更多信息以获得更准确的解决方案

干杯坦纳利

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-08-15T21:11:31.340

只需使用一个功能：

这是我认为最正确的做法。

```
var str='<!--asdfasd-->';

var matches= str.match(/<!--.*?(\/*)-->/s)

if (matches&&!matches[1].length>1) alert('You got me :)') 
```

解释：不管它有没有'//'我们先捕获它。

然后我们检查第二个匹配的长度，我们将匹配任意数量的 '/' 。

如果有两个或更多的斜线 - 它会警告“假”；

[http://jsfiddle.net/WNM7G/2/](http://jsfiddle.net/WNM7G/2/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-08-15T21:12:17.427

这应该这样做：

```
<!--[^\/\s]+--> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-08-15T21:13:01.760

试试这个模式：

```
<!-- *[a-z]+ *--> 
```

它应该适用于`<!--asdfasd-->`和`<!-- asdfasd -->`

**编辑**

> 评论还包含所有数字/字母/特殊字符？？？

好吧，添加所有预期的特殊字符而不要忘记转义：

```
[a-zA-Z0-9"!\?_-]+ 
```

# javascript - Windows 8 Javascript insanity - variable undefined

> ID：11977089
> 
> 赞同：1
> 
> 时间：2012-08-15T20:52:22.503
> 
> 标签：javascript, windows-8

I'm working through some Windows 8 tutorials from the msdn website. Specifically I'm on [this one](http://msdn.microsoft.com/en-us/library/windows/apps/hh974582.aspx).

Part of my code (copied from the tutorial is blowing my mind why it's erroring. Sample below:

```
(function () {
    "use strict";

    var list = getBlogPosts();
    var groupedItems = list.createGrouped(
        function groupKeySelector(item) { return item.group.key; },
        function groupDataSelector(item) { return item.group; }
    );
    var dataPromises = [];
    var blogs;
    var blogPosts = new WinJS.Binding.List();

    function getFeeds() {
        blogs = [
            {
                key: "blog1",
                url: 'http://windowsteamblog.com/windows/b/developers/atom.aspx',
                title: 'tbd', updated: 'tbd',
                acquireSyndication: acquireSyndication, dataPromise: null
            },
            // lots more entries ...
        ];

        blogs.forEach(function (feed) {
            feed.dataPromise = feed.acquireSyndication(feed.url);
            dataPromises.push(feed.dataPromise);
        });

        return WinJS.Promise.join(dataPromises).then(function () { return blogs });
    }

// more code...

})(); 
```

At the line `dataPromises.push(feed.dataPromise);` I get the error `JavaScript runtime error: Unable to get property 'push' of undefined or null reference`. You can see `dataPromises` is defined and initialised to an empty array near the top of the file (I've also tried initialising it with `new Array();`).

What am I doing wrong here??? I'm guessing I've made some stupid screw up... Incidentally, the 3 places `dataPromises` appears in the snippet above are the **only** places it appears anywhere in the project.

My first thought was hoisting but unless something magical is going on, I'm not explicitly declaring `dataPromises` in any local scopes that might be overriding the top function scope.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T21:29:19.377

You are not following the tutorial correctly. The line

```
var list = getBlogPosts(); 
```

replaces the `new WinJS.Binding.List()` call, which occurs after the line that initializes `dataPromises`.

The problem is that `getBlogPosts()` is calling `getFeeds()`, and `getFeeds` is trying to push results onto `dataPromises` but the line `var dataPromises = []` hasn't executed yet, so `dataPromises` is still `undefined`.

Move the call to `getBlogPosts()` to after the initialization of the `dataPromises` variable.

Stepping through the code in the debugger line by line should have exposed this problem in a fairly straightforward manner.

# c# - 我如何在代码中执行所有功能？

> ID：11977091
> 
> 赞同：-3
> 
> 时间：2012-08-15T20:52:27.617
> 
> 标签：c#

我在下面编写了代码来检查来自 C# 表单中组件的输入数据。

这段代码调用了一些函数，每个函数都返回一个布尔值。如果检查正常，则函数返回 false，否则返回 true。

如果我的用户没有正确完成任何输入，第一个代码检查函数将返回 true，并跳过其他函数调用。

即使一个返回true，我如何避免跳过其他函数调用？

命名约定：

*   以 'txt' 开头的变量是 TextBox
*   带有“mtxt”的变量星是 MaskedTextBox
*   带有 'rtxt' 的变量星是 RichTextBox

**代码：**

```
bool allIsOK = false;

allIsOK = checker.txtChecker(txtcode) ;
allIsOK = allIsOK || checker.txtChecker(txtdavar); 
allIsOK = allIsOK || checker.txtChecker(txtKomakHazine);
allIsOK = allIsOK || checker.txtChecker(txtnevisande);
allIsOK = allIsOK || checker.txtChecker(txtonvan); 
allIsOK = allIsOK || checker.txtChecker(txtostadMoshaver);
allIsOK = allIsOK || checker.txtChecker(txtostadRahnama);

allIsOK = allIsOK || checker.richTextBoxChecker(rtxtmaghale);
allIsOK = allIsOK || checker.mtxtDateChecker(mtxtdefa);
allIsOK = allIsOK || checker.mtxtDateChecker(mtxttasvib); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T21:01:43.957

做

```
allIsOK = allIsOK && checker.txtChecker(txtdavar); //not|| 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-15T21:00:47.530

您遇到了表达式短路；如果 OR (||) 的第一部分为真，则不需要评估第二部分。AND (&&) 也有类似的规则，如果第一部分为假，则不评估第二部分。这是设计使然，并且是该语言的一个非常有用的特性。

确保评估所有检查的最简单的代码更改是交换测试的顺序，将检查放在`||`运算符的左侧。

```
allIsOK = checker.txtChecker(txtcode) ;
allIsOK = checker.txtChecker(txtdavar) || allIsOK; 
allIsOK = checker.txtChecker(txtKomakHazine) || allIsOK;
// etc etc 
```

# php - 使用 PEAR 的带有多个附件的 php 电子邮件表单

> ID：11977092
> 
> 赞同：0
> 
> 时间：2012-08-15T20:52:32.597
> 
> 标签：php, pear

我创建了一个简单的 HTML 表单，我尝试在提交表单后使用 PEAR 发送多个附件。说到 PHP，我是个菜鸟，所以我有点不知所措。每次我提交表单时，我只会得到两个附件之一（letter_uploaded_file）。任何帮助表示赞赏。

```
 <?php 
// Pear library includes
// You should have the pear lib installed
include('PEAR/Mail.php');
include('PEAR/Mail/mime.php');

//Settings 
$max_allowed_file_size = 4096; // size in KB 
$allowed_extensions = array("pdf", "txt", "doc", "docx");
$upload_folder = './uploads/'; //<-- this folder must be writeable by the script
$your_email = 'gradysapp@gmail.com';//<<--  update this to your email address

$errors ='';

if(isset($_POST['submit']))
{
//Get the uploaded file information
$names_of_files = array();
$names_of_files[] = basename($_FILES["resume_uploaded_file"]['name']);
$names_of_files[] = basename($_FILES["letter_uploaded_file"]['name']);

//get the file extension of the file
$type_of_uploaded_file = array();
$type_of_uploaded_file[] = basename($_FILES['resume_uploaded_file']['type']);
$type_of_uploaded_file[] = basename($_FILES['letter_uploaded_file']['type']);

$size_of_uploaded_file = array();
$size_of_uploaded_file[] = basename($_FILES["resume_uploaded_file"]["size"]/2048);
$size_of_uploaded_file[] = basename($_FILES["letter_uploaded_file"]["size"]/2048);

///------------Do Validations-------------
if(empty($_POST['name'])||empty($_POST['email']))
{
$errors .= "\n Name and Email are required fields. ";   
}
if(IsInjected($visitor_email))
{
$errors .= "\n Bad email value!";
}

if($size_of_uploaded_file > $max_allowed_file_size ) 
{
$errors .= "\n Size of file should be less than $max_allowed_file_size";
}

//------ Validate the file extension -----
$allowed_ext = false;
for($i=0; $i<sizeof($allowed_extensions); $i++) 
{ 
    if(strcasecmp($allowed_extensions[$i],$type_of_uploaded_file) == 0)
{
    $allowed_ext = true;        
}
}

if(!$allowed_ext)
{
$errors .= "\n The uploaded file is not supported file type. ".
" Only the following file types are supported: ".implode(',',$allowed_extensions);
}

//send the email 
if(empty($errors))
{
    //copy the temp. uploaded file to uploads folder
    $path_of_uploaded_file = $upload_folder . $name_of_uploaded_file;
    $tmp_path = array();
    $tmp_path[] = basename($_FILES["resume_uploaded_file"]["tmp_name"]);
    $tmp_path[] = basename($_FILES["letter_uploaded_file"]["tmp_name"]);

    if(is_uploaded_file($tmp_path))
    {
    if(!move_uploaded_file($tmp_path,$path_of_uploaded_file))
    {
        $errors .= '\n error while moving the uploaded file';
    }
}

//send the email
$name = $_POST['name'];
$visitor_email = $_POST['email'];
$phone = $_POST["phone"];
$position = $_POST["position"];
$to = $your_email;
$subject="New Job Applicant Submission";
$from = $your_email;
$text = "A user  $name has sent you this message:\n $user_message";
$text .= "Phone: " . $phone . "\n";
$text .= "Email: " . $visitor_email . "\n";
$text .= "Position: " . $position . "\n";

$message = new Mail_mime();
$message->setTXTBody($text);
$message->addAttachment($path_of_uploaded_file);
$message->addAttachment($path_of_uploaded_file);
$body = $message->get();
$extraheaders = array("From"=>$from, "Subject"=>$subject,"Reply-To"=>$visitor_email);
$headers = $message->headers($extraheaders);
$mail = Mail::factory("mail");
$mail->send($to, $headers, $body);
    //redirect to 'thank-you page
    header('Location: careers_thank-you.html');
}
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T21:09:51.310

好吧，一方面，您只调用一次 addAttachment ：

```
$message->addAttachment($path_of_uploaded_file); 
```

您需要为每个上传的文件执行一次。

另外，我建议您使用 move_uploaded_file() 而不是 copy() 将上传的文件放置在它们最终的位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T21:12:09.033

您只得到一个文件，因为您使用相同的变量来处理这两个文件：

```
$name_of_uploaded_file =  basename($_FILES['resume_uploaded_file']['name']);
$name_of_uploaded_file =  basename($_FILES['letter_uploaded_file']['name']); 
```

这应该是这样的：

```
$names_of_files = array();
$names_of_files[] = basename($_FILES['resume_uploaded_file']['name']);
$names_of_files[] = basename($_FILES['letter_uploaded_file']['name']); 
```

您必须在其余代码中传播此模式，并在附加文件时循环文件。

# vba - 在给定另一个单元格的条件下，为单元格分配背景颜色

> ID：11977095
> 
> 赞同：10
> 
> 时间：2012-08-15T20:52:35.983
> 
> 标签：vba, excel

我正在尝试在 Microsoft Excel 2010 中创建一个公式来完成以下算法：

> 如果 A1=10，则 A2 的背景颜色为红色。

我对 Excel 中的 if/then 语句有基本的了解，所以到目前为止我有这个：

```
=IF(A1=10, x) 
```

...`x`更改单元格背景颜色的公式在哪里。然而，在对该主题进行了一些互联网研究之后，共识似乎是我应该改用条件格式来完成这项任务。我从未使用过条件格式，并且无法理解如何使用它，以便一个单元格上的条件会影响另一个单元格。

这是我面临的条件格式屏幕：

![条件框](../Images/6d9208267296534d95d90970fba1aea1.png)

所以我想我有两个问题：

1.  使用条件格式是实现此目的的最佳方法吗？
2.  如果是这样，考虑到不同单元格上条件的真实性，我如何利用它为单元格分配背景颜色？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2012-08-15T21:02:14.580

您可以使用条件格式来做到这一点，因此您走在正确的轨道上。我在这里假设的一件事是你想用值格式化单元格右侧的单元格 - 对吗？如果是这样，您实际上不需要使用`if`公式（尽管您的逻辑是正确的）。在该对话框中，制作公式：

```
=A1=10 
```

然后，当您单击“确定”时，通过单击旁边的小图表图标并单击单元格**B1来更改“****应用于**范围” 。然后申请等，关闭框并尝试在 中输入 10 。当您需要扩大范围时，您只需更改**适用于**范围以包含您想要影响的所有内容。在下面的示例中，如果直接在左侧的单元格（A 列）中输入 10，则单元格将全部更改。**`A1`**`B1:B26`****

 ****![在此处输入图像描述](../Images/17673f49fbccd5e662c8da7793bab531.png)****

# sql - sql server 使用 select 语句检查大于

> ID：11977096
> 
> 赞同：0
> 
> 时间：2012-08-15T20:52:39.830
> 
> 标签：sql, sql-server-2008-r2

为什么我不能这样做：

```
 select distinct ps.ID, from vwList wt
    where Flag = 1 
    and GETDATE()  < (select dbo.fn_Date(ps.date1,ps.UploadDate) from pseres ps where ps.ID = wt.ID) 
```

我得到无法绑定多部分标识符“ps.ID”。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T20:54:28.493

由于 ps.ID 与 wt.ID 匹配，而 ps 只在子查询中提及，为什么不：

```
select distinct wt.ID from vwList wt 
```

?

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T20:55:22.923

问题出在外部选择中。试试这个：

```
select distinct wt.ID
from vwList wt
where Flag = 1 and
      GETDATE()  < (select dbo.fn_Date(ps.date1,ps.UploadDate) from pseres ps where ps.ID = wt.ID) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T20:55:42.077

PS 在 where 子句的内部选择中。如果要从 pseres 中选择列，则需要将其放在 from 子句中或作为连接。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-08-15T20:59:50.413

这应该有效：

```
SELECT DISTINCT wt.ID
FROM vwList wt
    INNER JOIN (SELECT dbo.fn_Date(ps.date1,ps.UploadDate) AS MyDate FROM pseres) ps ON     wt.ID = ps.ID
WHERE Flag = 1 AND
      MyDate > GETDATE() 
```

# ssl - 在 SSL 上有一个测试子域和一个通配符域

> ID：11977101
> 
> 赞同：0
> 
> 时间：2012-08-15T20:53:09.080
> 
> 标签：ssl, virtualhost

我在服务器上安装了 SSL，并且在 ssl.conf 文件的 VirtualHost 部分中使用了子域通配符。SSL 证书对所有子域都有效，效果很好。

现在我想设置一个子域并将其用作测试，即test.mywebapp.com。此测试子域应指向不同的文档根。我想通过添加一个新的 VirtualHost 条目将它放在我的 ssl.conf 中。

目前唯一的条目是_default_:443。如何添加新条目而不与现有条目重叠？我尝试了 test.mywebapp.com:443，但它一直使用 _default_ 之一。

干杯，瑞克

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T20:59:54.760

保留`<VirtualHost _default_:443>`（或`*:443`或`the.ip.address:443`，但不是主机名）。

使用`ServerName`虚拟主机中的指令来配置不同的主机。

# r - 根据具有特定顺序的向量对数据框行进行排序

> ID：11977102
> 
> 赞同：190
> 
> 时间：2012-08-15T20:53:10.033
> 
> 标签：r, sorting, dataframe

有没有一种更简单的方法来确保数据框的行按照我在下面的简短示例中实现的“目标”向量进行排序？

```
df <- data.frame(name = letters[1:4], value = c(rep(TRUE, 2), rep(FALSE, 2)))

df
#   name value
# 1    a  TRUE
# 2    b  TRUE
# 3    c FALSE
# 4    d FALSE

target <- c("b", "c", "a", "d") 
```

这似乎有点太“复杂”而无法完成工作：

```
idx <- sapply(target, function(x) {
    which(df$name == x)
})
df <- df[idx,]
rownames(df) <- NULL

df 
#   name value
# 1    b  TRUE
# 2    c FALSE
# 3    a  TRUE
# 4    d FALSE 
```

* * *

## 回答 #1

> 赞同：268
> 
> 时间：2012-08-15T21:03:58.547

尝试`match`：

```
df <- data.frame(name=letters[1:4], value=c(rep(TRUE, 2), rep(FALSE, 2)))
target <- c("b", "c", "a", "d")
df[match(target, df$name),]

  name value
2    b  TRUE
3    c FALSE
1    a  TRUE
4    d FALSE 
```

只要您`target`包含与 完全相同的元素`df$name`，并且不包含重复值，它就会起作用。

来自`?match`：

```
match returns a vector of the positions of (first) matches of its first argument 
in its second. 
```

因此`match`找到与`target`的元素匹配的行号，然后我们`df`按该顺序返回。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2016-06-23T03:30:00.843

我更喜欢在需要匹配数据时使用`***_join` in 。`dplyr`一种可能的尝试

```
left_join(data.frame(name=target),df,by="name") 
```

请注意，`***_join`需要 tbls 或 data.frame的输入

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2020-01-14T09:10:45.997

我们可以根据`target`和使用它来调整因子水平`arrange`

```
library(dplyr)
df %>% arrange(factor(name, levels = target))

#  name value
#1    b  TRUE
#2    c FALSE
#3    a  TRUE
#4    d FALSE 
```

或者`order`它并使用它`slice`

```
df %>% slice(order(factor(name, levels = target))) 
```

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2015-05-26T11:11:04.133

这种方法有点不同，它为我提供了比以前的答案更多的灵活性。通过使其成为有序因子，您可以很好地使用它`arrange`。我使用了`gdata`包装中的 reorder.factor。

```
df <- data.frame(name=letters[1:4], value=c(rep(TRUE, 2), rep(FALSE, 2)))
target <- c("b", "c", "a", "d")

require(gdata)
df$name <- reorder.factor(df$name, new.order=target) 
```

接下来，使用它现在已订购的事实：

```
require(dplyr)
df %>%
  arrange(name)
    name value
1    b  TRUE
2    c FALSE
3    a  TRUE
4    d FALSE 
```

如果您想返回原始（字母）排序，只需使用`as.character()`使其恢复到原始状态。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2020-01-17T19:53:32.600

如果您不想使用任何库并且数据中重复出现，您也可以使用`which`with `sapply`。

```
new_order <- sapply(target, function(x,df){which(df$name == x)}, df=df)
df        <- df[new_order,] 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-01-12T00:41:59.130

这是一个类似的系统，适用于您最初想要排序的变量，但随后您想根据该次要变量在初始排序中首次出现的顺序按次要变量进行排序。

在下面的函数中，调用了初始排序变量并调用`order_by`了辅助变量`order_along`——如“按此变量沿其初始顺序排序”。

```
library(dplyr, warn.conflicts = FALSE)
df <- structure(
  list(
    msoa11hclnm = c(
      "Bewbush", "Tilgate", "Felpham",
      "Selsey", "Brunswick", "Ratton", "Ore", "Polegate", "Mile Oak",
      "Upperton", "Arundel", "Kemptown"
    ),
    lad20nm = c(
      "Crawley", "Crawley",
      "Arun", "Chichester", "Brighton and Hove", "Eastbourne", "Hastings",
      "Wealden", "Brighton and Hove", "Eastbourne", "Arun", "Brighton and Hove"
    ),
    shape_area = c(
      1328821, 3089180, 3540014, 9738033, 448888, 10152663, 5517102,
      7036428, 5656430, 2653589, 72832514, 826151
    )
  ),
  row.names = c(NA, -12L), class = "data.frame"
) 
```

这并没有给我我需要的东西：

```
df %>% 
  dplyr::arrange(shape_area, lad20nm)
#>    msoa11hclnm           lad20nm shape_area
#> 1    Brunswick Brighton and Hove     448888
#> 2     Kemptown Brighton and Hove     826151
#> 3      Bewbush           Crawley    1328821
#> 4     Upperton        Eastbourne    2653589
#> 5      Tilgate           Crawley    3089180
#> 6      Felpham              Arun    3540014
#> 7          Ore          Hastings    5517102
#> 8     Mile Oak Brighton and Hove    5656430
#> 9     Polegate           Wealden    7036428
#> 10      Selsey        Chichester    9738033
#> 11      Ratton        Eastbourne   10152663
#> 12     Arundel              Arun   72832514 
```

这是一个函数：

```
order_along <- function(df, order_along, order_by) {
  cols <- colnames(df)

  df <- df %>%
    dplyr::arrange({{ order_by }})

  df %>% 
    dplyr::select({{ order_along }}) %>% 
    dplyr::distinct() %>% 
    dplyr::full_join(df) %>% 
    dplyr::select(dplyr::all_of(cols))

}

order_along(df, lad20nm, shape_area)
#> Joining, by = "lad20nm"
#>    msoa11hclnm           lad20nm shape_area
#> 1    Brunswick Brighton and Hove     448888
#> 2     Kemptown Brighton and Hove     826151
#> 3     Mile Oak Brighton and Hove    5656430
#> 4      Bewbush           Crawley    1328821
#> 5      Tilgate           Crawley    3089180
#> 6     Upperton        Eastbourne    2653589
#> 7       Ratton        Eastbourne   10152663
#> 8      Felpham              Arun    3540014
#> 9      Arundel              Arun   72832514
#> 10         Ore          Hastings    5517102
#> 11    Polegate           Wealden    7036428
#> 12      Selsey        Chichester    9738033 
```

^(由[reprex 包](https://reprex.tidyverse.org)于 2021-01-12 创建(v0.3.0))

# html - 对 div 元素的模糊效果

> ID：11977103
> 
> 赞同：71
> 
> 时间：2012-08-15T20:53:10.640
> 
> 标签：html, css, blur

`div`是否可以在元素上添加高斯模糊？如果是，我该怎么做？

* * *

## 回答 #1

> 赞同：160
> 
> 时间：2015-04-08T17:26:54.797

我想这就是你要找的吗？如果您希望为 div 元素添加模糊效果，您可以直接通过 CSS 过滤器执行此操作——参见小提琴：http: [//jsfiddle.net/ayhj9vb0/](http://jsfiddle.net/ayhj9vb0/)

```
 div {
  -webkit-filter: blur(5px);
  -moz-filter: blur(5px);
  -o-filter: blur(5px);
  -ms-filter: blur(5px);
  filter: blur(5px);
  width: 100px;
  height: 100px;
  background-color: #ccc;

} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-08-15T20:55:47.497

尝试使用这个库： [https ://github.com/jakiestfu/Blur.js-II](https://github.com/jakiestfu/Blur.js-II)

那应该为你做。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-08-15T20:56:46.383

这是我发现的：

演示：[http ://tympanus.net/Tutorials/ItemBlur/](http://tympanus.net/Tutorials/ItemBlur/)

和教程：[http ://tympanus.net/codrops/2011/12/14/item-blur-effect-with-css3-and-jquery/](http://tympanus.net/codrops/2011/12/14/item-blur-effect-with-css3-and-jquery/)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2019-03-07T12:26:16.823

我使用 SVG 模糊滤镜进行模糊处理：

**CSS**

```
-webkit-filter: url(#svg-blur);
        filter: url(#svg-blur); 
```

**SVG**

```
<svg id="svg-filter">
    <filter id="svg-blur">
        <feGaussianBlur in="SourceGraphic" stdDeviation="4"></feGaussianBlur>
    </filter>
</svg> 
```

工作示例：

[https://jsfiddle.net/1k5x6dgm/](https://jsfiddle.net/1k5x6dgm/)

请注意 - 这在 IE 版本中不起作用

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2021-07-02T18:24:41.250

模糊 div 的背景元素可以使用`backdrop-filter`.

像这样使用它：

```
.your-class-name {
   backdrop-filter: blur(5px);
} 
```

放置在 div 下的所有元素都将通过使用它变得模糊。

编辑：请注意，并非每个浏览器都支持此功能

# java - Android中的原始文件夹

> ID：11977105
> 
> 赞同：0
> 
> 时间：2012-08-15T20:53:17.790
> 
> 标签：java, android

我正在尝试在应用程序中播放音效。无论我在哪里，都被告知要在 res 目录中添加一个*原始*文件夹（在 eclipse 中工作）。

首先，我在 res 下添加 raw 文件夹。然后我把我的 .wav 文件放进去。当我尝试在我的代码中使用 R.raw.filename 时，我收到一个错误“无法解析原始文件”。所以我清理并重建了项目。突然，我使用 R.id 或 R.anything 的所有地方都被下划线标记为错误。当我查看错误时，发现它与 Android.R 有关。我所做的一切都无法解决。所以我删除了原始文件夹并重建了项目。突然之间，一切都很好。

我已经重复了这个过程大约 4 次，但我不知道为什么添加原始文件夹会如此痛苦。谁能告诉我我做错了什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-08-15T23:43:32.023

您的任何 .wav 文件的名称中是否包含无效字符？检查是否可能在您的构建中的某处显示以下消息：

> 未解析的 aapt 错误！检查控制台的输出。

和

> 文件名无效：必须仅包含 [a-z0-9_.]

只有小写字符、数字、下划线和句点对名称和扩展名有效。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-15T20:56:31.720

使用`assets`文件夹和...

```
InputStream sound = getAssets().open("filename.mp3"); 
```

...或`raw`文件夹和...

```
InputStream sound = getResources().openRawResource(R.raw.filename); 
```

只需确保名为的文件`filename`存在于名为`raw`.

如果所有的用法`R.*`都加了下划线，删除`android.R`你类的上半部分的导入，正如 Maxim 所提到的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T20:57:49.277

显然，您的活动添加了导入 android.R，之后所有与 R 的引用都转到对您的原始文件一无所知的 android 框架（android.jar）。只需检查导入，如果您看到 android.R，请将其删除并添加 com.my_app_namespace.R 之后应该可以工作

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-08-16T16:17:13.317

我不确定这是否算作一个解决方案，但是当我使用 .ogg 文件而不是 .wav 文件时，一切正常。

# c - 从c中的mat文件中读取矩阵列的子集

> ID：11977106
> 
> 赞同：1
> 
> 时间：2012-08-15T20:53:18.410
> 
> 标签：c, matlab

我有一个非常大的矩阵存储在一个 mat 文件中，在一个 C 程序中，我需要存储在它的前几列中的数据。目前我使用 matGetVariable 将整个矩阵读入内存，但它占用了大量内存。我想知道是否有一种简单的方法可以仅将矩阵的前几列或变量的子索引读取到 C 中的内存中。

# azure - Azure 中的 CloudDrive.Delete() 和 CloudBlobContainer.Delete() 有什么区别

> ID：11977108
> 
> 赞同：0
> 
> 时间：2012-08-15T20:53:23.860
> 
> 标签：azure, azure-blob-storage

CloudDrive 是一个 Blob。

无论哪种方式，文件都消失了。那么有什么区别呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T21:26:50.290

当您删除 CloudDrive 时，您实际上是在删除(blob) 容器**中**[的页面 blob 。](http://msdn.microsoft.com/en-us/library/microsoft.windowsazure.storageclient.clouddrive.delete.aspx) 调用[CloudBlobContainer.Delete](http://msdn.microsoft.com/en-us/library/windowsazure/ee772840)会删除 blob 容器（连同该容器中的所有 blob），调用此方法可能会删除比您想要删除的文件更多的文件。

# objective-c - IOS FacebooSDK 3.0 FBLoginVIew 在模态视图控制器中

> ID：11977112
> 
> 赞同：7
> 
> 时间：2012-08-15T20:53:41.243
> 
> 标签：objective-c, ios, facebook-ios-sdk

我在 rightBarButtonItem 单击时显示了模态视图控制器。我在这个控制器中使用 FbLoginView 作为示例[ios-Facebook SDK 3.0 Error 5 When Posting Status Update](https://stackoverflow.com/questions/11850899/ios-facebook-sdk-3-0-error-5-when-posting-status-update)。

但我无法多次显示模态视图控制器。我试图在 ViewDidUnload 上释放 FBLoginView 但它总是在第二次尝试打开模态视图控制器时崩溃。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-08-18T18:14:38.027

遇到同样的问题并已经处理了几天。最后这是我的解决方案：

```
if (!FBSession.activeSession.isOpen) {
    theLoginView = [[FBLoginView alloc] init];
    theLoginView.frame = CGRectOffset(theLoginView.frame,
                                      ([[UIScreen mainScreen] bounds].size.width-theLoginView.frame.size.width)/2,
                                      ([[UIScreen mainScreen] bounds].size.height-theLoginView.frame.size.height)/2 -50);
    theLoginView.delegate = self;
    [self.view addSubview:theLoginView];
    [theLoginView sizeToFit];
}  
//Only close the session when application is terminating, this will save the token information:
- (void)applicationWillTerminate:(UIApplication *)application {
    [FBSession.activeSession close];
}  

//And keep the FBSession within the app until the user want to logout:
[FBSession.activeSession closeAndClearTokenInformation]; 
```

现在对我来说它工作得很好。希望这有帮助。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-08-19T21:07:29.017

FB SDK 似乎不喜欢您创建多个 FBLoginView。如果您正确终止会话，也许您可​​以，但我发现只创建一次 LoginView 并保留它更容易。

我这样做如下：

1）在我的`.m`模态视图控制器文件中，我创建了一个静态变量

```
static FBLoginView* loginView; 
```

2) 在 my 中加载模态视图控制器时`viewDidLoad`，而不是

```
FBLoginView *loginview = [[FBLoginView alloc] initWithPermissions:
                          [NSArray arrayWithObject:@"status_update"]];
loginview.frame = CGRectOffset(loginview.frame, 10, 10); 
```

我添加了一个检查以查找它是否已经初始化，如下所示：

```
if (!loginView) {
    loginView = [[FBLoginView alloc] initWithPermissions:
                              [NSArray arrayWithObject:@"status_update"]];
    loginView.frame = CGRectOffset(loginView.frame, 10, 10);

} 
```

除此之外，我只是按照 FB 的 HelloFacebook 项目的例子。

不是漂亮的代码，但它似乎工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-08-17T11:34:02.200

我有同样的问题。尝试添加如下内容：

```
if(!yourFBLoginView)
{
    yourFBLoginView = [FBLoginView alloc] init...];
} 
```

和/或在关闭 modalViewController 时不要忘记关闭活动会话。

```
if ([[FBSession activeSession] isOpen])
{
    [[FBSession activeSession] close];
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-12-27T03:25:39.503

我认为我的答案（所说的变体）只是我需要拥有：

`[FBSession.activeSession closeAndClearTokenInformation];`

在里面：

`(void)applicationWillTerminate:(UIApplication *)application`

功能。对我来说特别的问题是，当我在测试时......我一直在终止应用程序而没有实际注销用户而没有破坏`FBSession`，所以当我回到应用程序测试我所做的更改时 - 我的 Facebook 用户仍然登录，因此某些条件未正确满足。我认为这对于任何正在测试的人来说都非常重要（而且我实际上认为你应该在那里有那条线）以确保每次应用程序终止时清除会话以避免这个问题......我可以想象我的应用程序刚刚在某人身上崩溃，现在他们正在重新打开它并且他们经历了崩溃，因为会话从未被清除。

# java - 创建引导程序

> ID：11977119
> 
> 赞同：-2
> 
> 时间：2012-08-15T20:54:13.360
> 
> 标签：java, netty, bootstrapping

为什么创建一个新的引导程序看起来如此尴尬？应该有比通常更简单的方法来做到这一点

```
serverBootstrap = new ServerBootstrap(new NioServerSocketChannelFactory(
    Executors.newCachedThreadPool(),
    Executors.newCachedThreadPool())); 
```

它的样子绝对是可怕的。比如，为什么我必须调用 newCachedThreadPool() 两次？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T22:36:38.757

在最新版本的 Netty 中，您可以使用默认`NioServerSocketChannelFactory`构造函数，它使用两个缓存线程池，就像您目前正在做的那样。然后，boostrap 实例化将看起来像这样，它不那么冗长：

```
ServerBootstrap sb = new ServerBootstrap(new NioServerSocketChannelFactory()); 
```

但是，请研究这些线程池的用途。在某些情况下（例如[缓慢的 loris 攻击](http://en.wikipedia.org/wiki/Slowloris)），此设置不会很好地工作，而是会导致 Java 进程耗尽堆空间。出于这个原因，您可能需要查看 Netty 提供的[MemoryAwareThreadPoolExecutor类。](http://docs.jboss.org/netty/3.1/api/org/jboss/netty/handler/execution/MemoryAwareThreadPoolExecutor.html)

缓存线程池本质上是邪恶的，因为它们有一个达到“临界质量”的点。在这种情况下，当线程数非常高时，由于上下文切换的开销而导致性能下降。由于线程数导致性能下降，线程池工作人员完成任务的速度会更慢。由于这些工作人员忙于较长时间，缓存线程池必须继续创建新线程来处理持续的工作负载。随着更多线程的创建，性能继续降低事件更多。问题是自己造成的，您的服务器基本上会爆炸。玩得开心！

# matlab - Matlab：当相机处于轨道模式时如何以编程方式停止旋转图

> ID：11977126
> 
> 赞同：3
> 
> 时间：2012-08-15T20:54:41.233
> 
> 标签：matlab, matlab-figure, matlab-guide

要明白我的意思，请：

1.  运行下面的代码

    ```
    figure
    plot(peaks)
    cameratoolbar('SetMode','orbit');
    cameratoolbar('Show'); 
    ```

2.  将鼠标移到绘图上。按住左键，将鼠标向左或向右移动，然后松开单击。你会看到情节永远开始狙击。

    现在，如果您单击红色的`stop`签名按钮，它将停止旋转。但是我想以**编程**方式停止旋转图。有什么想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-16T07:26:40.087

在编辑器中打开`cameratoolbar`显示*轨道*是通过将图形的`WindowButton*`回调临时设置为`cameratoolbar`.

从我所做的 1 分钟对角线阅读来看，相机轨道本身是通过调用平移/缩放函数来完成的`orbitPangca`，该函数递归调用 `cameratoolbar`. 此递归循环由标志控制，这些标志由工具栏按钮的回调切换。这些标志改变递归循环中每次迭代的行为。

如果情况确实如此，则意味着 Matlab 不接受来自您可以编程控制的任何来源的命令，而情节正在运行。它只会响应按钮按下。这意味着，如果您想以编程方式停止运动，则必须破解`cameratoolbar`以允许这样做 - 这不是最便携的选项。

另一个突然想到的想法是确定哪个`WindowButton*`回调用于轨道，并在那里定义您自己的函数。您可能很幸运，MathWorks 实现`cameratoolbar`了每次迭代都会调用*两个*回调，这将使您能够以编程方式控制标志。但是——你必须自己测试一下。

# php - 如何通过 MongoDB PHP 中的嵌入项查找文档

> ID：11977127
> 
> 赞同：0
> 
> 时间：2012-08-15T20:54:41.320
> 
> 标签：php, arrays, mongodb

我在 MongoDB 中有下一个文档：

比赛文件：

```
{
 "_id": ObjectId("502aa915f50138d76d11112f7"),
 "contestname": "Contest1",  
 "description": "java programming contest", 
 "numteams": NumberInt(2),
 "teams": [
   {
    "teamname": "superstars",
    "userid1": "50247314f501384b011019bc",
    "userid2": "50293cf9f50138446411001c",
    "userid3": "50293cdff501384464110018"
   },

   {
    "teamname": "faculty",
    "userid1": "50247314f501384b0110100c",
    "userid2": "50293cf9f50138446410001b",
    "userid3": "50293cdff501384464000019"
   }
 ],
 "term": "Fall 2012"
} 
```

想象一下，我有更多用户可以注册的文档。我想找到用户注册的所有比赛。到目前为止，我有这样的事情：

```
$id = "50247314f501384b011019bc";
$user = array('userid1' => $id, 'userid2' => $id, 'userid3' => $id );
$team = array('teams' => $user);            
$result =$this->collection->find($team);
return $result; 
```

有人可以帮我吗？

谢谢你。

- - - 解决了 - - -

```
$team = array('$or' => array(array('teams.userid1' => $id),
               array('teams.userid2' => $id), 
               array('teams.userid3' => $id)
                 ));            

$result =$this->collection->find($team); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T21:22:09.327

您的数据结构很难查询，因为您有一组嵌入式文档。通过对数据稍作更改，您可以使其更易于使用。

我已将用户 ID 放入数组中：

```
{
 "contestname": "Contest1",  
 "description": "java programming contest", 
 "numteams": 2,
 "teams": [
   {
    "teamname": "superstars",
    "members": [
        "50247314f501384b011019bc",
        "50293cf9f50138446411001c",
        "50293cdff501384464110018"
    ]
   },

   {
    "teamname": "faculty",
    "members": [
        "50247314f501384b0110100c",
        "50293cf9f50138446410001b",
        "50293cdff501384464000019"
    ]
   }
 ],
 "term": "Fall 2012"
} 
```

然后，您可以对 PHP 等效的[find()](http://www.php.net/manual/en/mongocollection.find.php)执行以下操作：

```
db.contest.find(
        {'teams.members':'50247314f501384b011019bc'},
        {'contestname':1, 'description':1}
    ) 
```

这将返回该用户输入的匹配竞赛：

```
{
    "_id" : ObjectId("502c108dcbfbffa8b2ead5d2"),
    "contestname" : "Contest1",
    "description" : "java programming contest"
}
{
    "_id" : ObjectId("502c10a1cbfbffa8b2ead5d4"),
    "contestname" : "Contest3",
    "description" : "Grovy programming contest"
} 
```

# database - 如何防止更改数据库

> ID：11977128
> 
> 赞同：0
> 
> 时间：2012-08-15T20:54:42.387
> 
> 标签：database, security

防止更改数据库或验证其完整性的最佳方法是什么，以便无法从为该数据库创建的应用程序中更改它。

假设您有访问数据库的用户名和密码允许读写。

### 要求：

*   用户有写权限
*   不要依赖特定的系统，例如（MySQL、Oracle、SQL Server）

我正在寻找的解决方案不是基于用户对数据库的权限

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T20:58:12.587

大多数现代数据库允许您授予读取和写入权限，但同时不允许像 ALTER TABLE 这样的 DDL 命令。

不要授予不应更改数据库结构的用户执行 DDL 的权限。

如果“更改”是指更改任何数据行，而不是数据库结构，则可以仅授予用户 SELECT 权限。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-15T20:58:52.177

您的应用程序使用的用户或帐户必须获得数据库服务器的权限。通常权限包括以下内容：

*   选择
*   插入
*   更新
*   删除
*   改变
*   降低

仅授予用户帐户所需的权限；换句话说，不授予`Alter`权限，应用程序（或使用相同登录名的任何人）将无法更改表。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T21:00:18.243

两种策略： 1）如果你运行的是 SQL Server、Oracle、DB2 等，你可以配置权限，让用户默认是读/写（这意味着没有更改权限）。2）您可以定期检查是否有人更改了数据结构，甚至设置数据库触发器来检测更改并记录谁/何时等（取决于您的数据库平台）

# xcode - 防止 Xcode 在每次调试时复制资产？

> ID：11977130
> 
> 赞同：3
> 
> 时间：2012-08-15T20:54:43.043
> 
> 标签：xcode, debugging

我有一个拥有大量资产的项目。我需要检查所有资产的应用程序。

问题是 xCode 正在将所有资产复制到设备上，即使没有进行任何更改。这会减慢构建速度，调试过程是一场噩梦。

有没有办法“要求”xCode不要每次都复制这些资产？

# notepad++ - notepad++ 查找和替换

> ID：11977134
> 
> 赞同：1
> 
> 时间：2012-08-15T20:55:07.370
> 
> 标签：notepad++

我正在尝试跨多个文件查找和替换。我正在更改 c 代码中头文件的位置，例如，我想用 xdm/ti/xdais/[wildcard].h 更改 ti/xdais/[wildcard].h

我想找到

```
ti/xdais 
```

并替换为

```
xdm/ti/xdais 
```

如果我只是查找所有内容，它会按预期工作并找到所有引用。但是当我尝试进行查找和替换时，它不起作用。说什么都没找到。有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T21:11:11.943

弄清楚了。我试图替换的文件是写保护的。Notepad++ 没有说明这一点，所以我花了一点时间才意识到这一点。

# javascript - dojo.deferred 和 for 循环

> ID：11977136
> 
> 赞同：1
> 
> 时间：2012-08-15T20:55:11.063
> 
> 标签：javascript, dojo

我有一个传递给函数的值数组。该函数循环遍历数组并在另一种方法中使用这些值。

这适用于数组中的第一个值，然后是所有其他项目'我得到一个错误：“这个延迟已经解决了”。

我想得到一系列响应，它目前在 1 个响应后停止？

有什么帮助吗？谢谢！

```
function showQueryResults(searchResults){
    function getFacIds(arr){
        var def = new dojo.Deferred();
        for (var i = 0, iLen = arr.features.length; i < iLen; i++) {
            findParams.searchText = searchResults.features[i].attributes.ID;
            findTask.execute(findParams, function(response){
                def.callback(response);
            });
        };
        return def;
    };              
    getFacIds(searchResults).then(function(result){
        console.log(result);
    });
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T21:39:05.647

A[`Deferred`](http://dojotoolkit.org/reference-guide/1.7/dojo/Deferred.html)只能解决一次。您需要跟踪响应。

在 Dojo 1.7 语法中，假设没有错误：

```
require(["dojo/Deferred", "dojo/_base/array", "example/async"],
                                              function(Deferred, array, async) {
  var foo = function (arr) {
    var def, results, index;
    def = new Deferred();
    results = [];
    array.forEach(arr, function(item, index) {
      async(arr[index], function (r) {
        results.push(r);
        if(results.length === arr.length) {
          def.callback(results);
        }
      });
    }
    return def;
  };

  foo([1, 2, 3]).then(function (results) {
    //do something with the results
  });
} 
```

# c++ - 为什么调用静态成员函数。或 -> 语法合法？

> ID：11977137
> 
> 赞同：22
> 
> 时间：2012-08-15T20:55:19.100
> 
> 标签：c++, static, member-functions

> **可能重复：**
> [类实例上的 C++ 静态成员方法调用](https://stackoverflow.com/questions/325555/c-static-member-method-call-on-class-instance)

今天我发现我长久以来（我的意思是*长久以来*——比如，二十年），在 C++ 中认为非法的东西实际上是合法的。即，调用静态成员函数，就好像它属于单个对象一样。例如：

```
struct Foo
{
    static void bar() { cout << "Whatever."; }
};

void caller()
{
    Foo foo;
    foo.bar();    // Legal -- what?
} 
```

我通常会看到使用“范围解析语法”严格调用静态成员函数，因此：

```
Foo::bar(); 
```

这是有道理的，因为静态成员函数不与类的任何特定实例相关联，因此我们不希望特定实例在语法上“附加”到函数调用。

然而我今天发现 GCC 4.2、GCC 4.7.1 和 Clang 3.1（作为编译器的随机抽样）接受前一种语法，以及：

```
Foo* foo = new Foo;
foo->bar(); 
```

在我的特殊情况下，这个表达式的合法性导致了一个运行时错误，这让我相信这种语法的特殊性不仅仅是学术上的兴趣——它还有实际的后果。

为什么 C++ 允许调用静态成员函数，就好像它们是单个对象的直接成员一样——也就是说，通过使用 . 或 -> 附加到对象实例的语法？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2012-08-15T21:14:36.740

在第 288 页*的 C++ 的设计和演变中*，Bjarne Stroustrup 提到在静态成员函数出现之前的日子里，程序员使用诸如`((X*)0)->f()`调用不需要对象的成员函数之类的技巧。我的猜测是，当静态成员函数被添加到语言中时，允许通过访问，`->`这样具有类似代码的程序员就可以更改`f`为，`static`而无需寻找和更改它的每次使用。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2012-08-15T21:03:26.490

大概是这样，您可以在您可能不知道某些东西的类类型但编译器知道的地方调用它。

假设我有一堆类，每个类都有一个返回类名的静态成员：

```
class Foo
{
    static const char* ClassName() { return "Foo"; }
};

class Bar
{
    static const char* ClassName() { return "Bar"; }
}; 
```

然后在我的代码中，我可以执行以下操作：

```
Foo foo;

printf( "This is a %s\n", foo.ClassName() ); 
```

不必一直担心知道我的对象的类别。例如，在编写模板时，这将非常方便。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-08-15T21:01:50.630

之所以这样，是因为标准说这就是它的工作方式。n3290 § 9.4 规定：

> 类 X 的静态成员 s 可以使用限定 ID 表达式来引用，`X::s;`而不必使用类成员访问语法 (5.2.5) 来引用静态成员。可以使用类成员访问语法来引用静态成员，在这种情况下，对象表达式会被求值。[ 例子：
> 
> ```
> struct process { 
>   static void reschedule(); 
> }; 
> 
> process& g();
> 
> void f() { 
>   process::reschedule(); // OK: no object necessary
>   g().reschedule(); // g() is called 
> } 
> ```
> 
> 结束示例]

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2012-08-15T21:17:03.913

摘自[The Evolution of C++ (pdf)，第 8 节。静态成员函数](http://www.usenix.org/publications/compsystems/1989/sum_stroustrup.pdf)：

> ...还观察到不可移植的代码，例如

```
 ((x*)0)->f(); 
```

> 用于模拟静态成员函数。

所以我的猜测是（基于几乎所有其他奇怪的语法事物的基本原理模式）当你刚刚拥有提供与已建立但已损坏的习语的向后兼容性的类型时，它们允许调用静态成员函数。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-08-15T21:05:01.547

如果您不订阅“因为标准这么说”的因果关系学派，我还建议静态方法已经足够老了，以至于人们真正担心将`this`参数传递给函数调用的额外开销时，因此，将纯函数“静态”作为优化可能在 1985 年风靡一时。

# wordpress - RSS 问题 - Drupal 到 WordPress 迁移

> ID：11977141
> 
> 赞同：0
> 
> 时间：2012-08-15T20:55:28.663
> 
> 标签：wordpress, drupal, rss

我正在使用[该站点](http://blog.room34.com/archives/4530)的脚本将 Drupal 数据库迁移到 WordPress。它似乎工作正常，除了当我尝试访问它时返回 HTTP 304 错误的 RSS 提要。

我认为问题出在以下几行：

```
TRUNCATE TABLE wordpress.wp_comments;
TRUNCATE TABLE wordpress.wp_links;
TRUNCATE TABLE wordpress.wp_postmeta;
TRUNCATE TABLE wordpress.wp_posts;
TRUNCATE TABLE wordpress.wp_term_relationships;
TRUNCATE TABLE wordpress.wp_term_taxonomy;
TRUNCATE TABLE wordpress.wp_terms; 
```

当脚本清空 WordPress 数据库时，RSS 提要停止工作。但是，如果我在不清空上述表格的情况下导入博客文章，则提要似乎可以正常工作。

有什么想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-16T08:27:17.983

在上述行中，我认为没有任何问题。所以你必须检查所有的代码：

数据库转换表 Drupal 6.x Table(s) WordPress 2.9x 等效 term_data, term_hierarchy wp_terms node, node_revisions `wp_posts term_node wp_term_relationships comments wp_comments

截断 WordPress 表格

首先，我需要删除当前在某些 wordpress 表中的所有数据，以便我可以使用新的石板。

注意：默认情况下，当您安装 wordpress 时，所有表都以 wp_ 为前缀，除非您将其更改为其他内容。如果您使用 wp_ 以外的任何其他内容，则需要修改以下查询。

```
TRUNCATE TABLE wp_comments;
TRUNCATE TABLE wp_postmeta;
TRUNCATE TABLE wp_posts;
TRUNCATE TABLE wp_term_relationships;
TRUNCATE TABLE wp_term_taxonomy;
TRUNCATE TABLE wp_terms; 
```

进口分类术语

下一组查询导入分类术语。

注意：表名以 drupal 开头。需要是您的 drupal 数据库的实际名称。您需要将其更改为您的 drupal 数据库的名称。

```
INSERT INTO wp_terms (term_id, name, slug, term_group)
  SELECT d.tid, d.name, REPLACE(LOWER(d.name), ' ', '-'), 0
  FROM drupal.term_data d
  INNER JOIN drupal.term_hierarchy h
  USING(tid); 
```

默认情况下，WordPress 有几种可用的分类类型；类别、post_tag 和 link_category。在我的 Drupal 实例中，我主要使用分类作为标签，但您可能有不同的需求。您可能需要根据您希望如何导入分类法来修改以下查询中的第 3 行：

```
 Categories: category
    Link Categories: link_category
    Post Tags: post_tag

 INSERT INTO wp_term_taxonomy (term_taxonomy_id, term_id, taxonomy, 
                              description, parent)
      SELECT d.tid, d.tid, 'post_tag', d.description, h.parent
      FROM drupal.term_data d
      INNER JOIN drupal.term_hierarchy h
      USING(tid); 
```

导入帖子内容

Drupal 允许自定义帖子类型，而从 WordPress 2.9x 开始，自定义帖子类型只能通过插件获得。您可以使用未修改的以下查询，它将所有故事转换为帖子，其他所有内容都将按原样转移。如果您需要转换其他帖子类型，可以添加其他案例语句。

示例：WHEN 'book' THEN 'post'

我还调整了查询​​，以便根据我的 GMT 偏移量 -6:00（中部时间）正确填充“post_date_gmt”。如果您在不同的时区，则需要调整 FROM_UNIXTIME(created+21600) 以根据您的位置正确减去或添加。

```
INSERT INTO
wp_posts (id, post_date, post_date_gmt, post_content, post_title,
post_excerpt, post_name, post_type, post_modified)
SELECT DISTINCT
n.nid, FROM_UNIXTIME(created), 
FROM_UNIXTIME(created+21600), body, n.title, teaser, LOWER(n.title),
(CASE n.TYPE
  WHEN 'story' THEN 'post'
  ELSE n.TYPE
END) AS TYPE,
FROM_UNIXTIME(changed)
FROM drupal.node n, drupal.node_revisions r
WHERE n.vid = r.vid; 
```

导入帖子和分类关系

```
 INSERT INTO wp_term_relationships (object_id, term_taxonomy_id)
    SELECT nid, tid FROM drupal.term_node;
Category Count Updating

 UPDATE wp_term_taxonomy tt
 SET COUNT = (
 SELECT COUNT(tr.object_id)
 FROM wp_term_relationships tr
 WHERE tr.term_taxonomy_id = tt.term_taxonomy_id
 ); 
```

导入评论

```
INSERT INTO wp_comments (comment_post_ID, comment_date, 
        comment_content, comment_parent, comment_author, 
        comment_author_email, comment_author_url, comment_approved)
 SELECT nid, FROM_UNIXTIME(TIMESTAMP), comment, thread, 
          name, mail, homepage, STATUS 
 FROM drupal.comments; 
```

更新评论数

```
 UPDATE wp_posts 
   SET comment_count = (SELECT COUNT(comment_post_id) 
  FROM wp_comments 
  WHERE wp_posts.id = wp_comments.comment_post_id); 
```

更新帖子蛞蝓

Drupal 的 URL 别名等同于 WordPress 的永久链接。与 WordPress 相比，Drupal 具有更积极的标题卫生。在迁移到 WordPress 时，我希望能够出于 SEO 的原因保持我的标题相同。

为了保留我的旧标题，我需要使用与 Drupal 类似的规则来连接 WordPress 的标题卫生。下面的代码需要放在当前主题的 functions.php 文件中的某个位置。

```
add_filter('sanitize_title', 'my_sanitize_title'); 
function my_sanitize_title($title) {
                                                                                                          $title                                                                                          =                                                                                                           preg_replace('/\b(a|an|as|at|before|but|by|for|from|is|in|into|like|of|off|on|onto|per|since|than|the|this|that|to|up|via|with)\b/i', '', $title);
   $title = preg_replace('/-+/', '-', $title);
   $title = trim($title, '-');
   return $title;
   } 
```

您需要将以下代码保存到 WordPress 主目录中的文件，即“fix-slugs.php”并通过浏览器运行它。

```
< ?php

   require_once('wp-load.php');

     $posts = $wpdb->get_results(
 "SELECT ID, post_title, post_name FROM $wpdb->posts"
    );

    $count = 0;
   $ignored = 0;
  $errors = 0;
  foreach($posts as $post) {
  if(strcmp($slug = sanitize_title($post->post_title), $post->post_name) !== 0) {
  $wpdb->show_errors();
  if(($result = $wpdb->query("UPDATE $wpdb->posts SET post_name='$slug' WHERE ID=$post->ID")) === false) {
    $errors++;
  } elseif($result === 0) {
    $ignore++;
  } else {
    $count++;
  }
} else {
   $ignored++;
}
 }

echo "<strong>$count post slug(s) sanitized.</strong><br />";
echo "$ignored post(s) ignored.<br />";
 echo "$errors error(s).<br />"; 
```

如果您按照本教程进行操作，那么当我遇到问题时，我使用 WordPress 数据库描述作为参考，基于我的 Drupal 设置进行了一些更改。如果您通过 Drupal 的界面上传图像，可能需要完成一些额外的步骤，但上述查询能够成功地将我的数据从 Drupal 迁移到 WordPress。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-23T12:08:09.040

在 Visual Studio 中使用 HtmlAgilityPack 有助于快速构建导入器以浏览 Drupal 的每个帖子并使用 XMLRPC 将它们添加到 Wordpress。由于 Drupal 为帖子内容和帖子预告片有两个单独的列，因此将 Drupal 导入 Wordpress 会更好，这样您就可以动态添加`<!--more-->`标签。

# javascript - window.close() 和 iOS

> ID：11977145
> 
> 赞同：0
> 
> 时间：2012-08-15T20:55:47.270
> 
> 标签：javascript, iphone, ios, ipad, mobile-safari

我编写了这段代码，它适用于除 iPhone 和 iPad 上的 Safari 之外的所有浏览器。还有其他方法可以关闭窗口吗？

```
 var newWin=window.open('https://twitter.com/share?url=<?=urlencode($pathFile)?>&text=text', 'Twitter', params);
        setTimeout(
            function()
            {
                newWin.close();
            },
            30000
        ); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2014-10-14T19:02:12.117

这是这个[问题](https://stackoverflow.com/questions/25804730/window-close-doesnt-work-on-ios-8-gm-seed?rq=1)的副本。总而言之，window.close 在 iOS8 上被破坏，目前没有已知的解决方法。

# android - 自定义标题条码打破 onCreate()

> ID：11977149
> 
> 赞同：0
> 
> 时间：2012-08-15T20:56:08.447
> 
> 标签：android

我制作了一个自定义标题栏，我希望它出现在我的应用程序中的所有活动中。它在我的主要活动中完美运行：

```
requestWindowFeature(Window.FEATURE_CUSTOM_TITLE);
setContentView(R.layout.main);
getWindow().setFeatureInt(Window.FEATURE_CUSTOM_TITLE, R.layout.title_bar); 
```

但是我的主要活动调用了另一个活动，当我尝试在那里做**同样**的事情时它失败了：

```
requestWindowFeature(Window.FEATURE_CUSTOM_TITLE);
setContentView(R.layout.layout_2);
getWindow().setFeatureInt(Window.FEATURE_CUSTOM_TITLE, R.layout.title_bar); 
```

尝试执行*findViewById()*崩溃，我将其中一个包裹在 try/catch 中以查看发生了什么：

```
TextView tv1;
try {    
    tv1 = (TextView)findViewById(R.id.header);
}
catch (Exception e)  {
    Log.d("MyActivity2", "boom");  
} 
```

异常说 *cause=ClassCastException detailMessage=android.widget.RelativeLayout*

我不知道这意味着什么，**注意****如果**我注释掉*requestWindowFeature()*和*getWindow()*调用没有问题。

 ****提前感谢您对此的任何见解！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T21:53:20.760

如果您收到 ClassCastException ，则意味着 R.id.header 不是 TextView 。在您的布局`header`中是Relativelayout 的名称。因此，将其更改为与 TextView 匹配。****

# c# - .NET ConfigurationSettings.AppSettings("TheDB")

> ID：11977152
> 
> 赞同：0
> 
> 时间：2012-08-15T20:56:24.060
> 
> 标签：c#, .net, vb.net, web-config, machine.config

我正在查看一个自定义构建的 .NET 控件 (vb)。它有一个公共字符串声明为：

```
Public Shared strConn As String = ConfigurationSettings.AppSettings("TheDB") 
```

我试图找出“TheDB”应该是什么。我使用这个自定义控件查看了网站的 web.config 文件，但是任何地方都没有“TheDB”参数。我还查看了 Web 服务器的 machine.config 文件，同样，那里也没有“TheDB”参数。

帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T20:58:49.643

如果缺少，只需添加它：

```
 <appSettings>
     <add key="TheDB" value="somevalue" />
 </appSettings> 
```

（假设它`ConfigurationSettings.AppSettings`确实对应于.`appSettings`的部分`web.config`。这不清楚，因为通常您使用内置`ConfigurationManager`类引用配置文件的标准部分）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-15T20:59:13.953

查看您的 web.config。在某处有一个名为“AppSettings”的部分，其中应该有一些看起来像这样的元素：

`<add key="TheDB" value="something" />`

其中之一将是你的。或者可能有人把它拿出来了。不过，它很可能是您的数据库的连接字符串。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T23:31:07.353

web.config 是**分层**的。每个 web.config 将配置信息提供给它所在的目录以及它下面的整个目录层次结构。

[http://msdn.microsoft.com/en-us/library/ms178685.aspx](http://msdn.microsoft.com/en-us/library/ms178685.aspx)

从 .Net v1.1 开始就是这样。当您查找配置值或部分时，.Net 配置系统会在最低级别的 web.config 中查找。如果未找到所需的值，它将沿目录树向上运行，直到找到为止。

您需要运行目录层次结构（是的，其中还包括安装在 IIS 中的虚拟目录），直到找到包含所需 appsetting 值的 web.config 文件。还有 IIS `ApplicationHost.config`，位于

```
%windir%\system32\inetsrv\config 
```

# vba - 当传递两个参数时，excel VBA告诉我它需要一个'='？

> ID：11977158
> 
> 赞同：1
> 
> 时间：2012-08-15T20:56:35.363
> 
> 标签：vba, excel

我有一个功能：

```
Sub WordsToDate(col, endRow)
    ....
End Sub 
```

然后当我这样称呼它时：

```
Functions.WordsToDate(7, endRow) 
```

（功能是模块）它给了我错误：

```
Compile Error: Expected: = 
```

当我尝试离开线路时，它会弹出并告诉我这一点。

有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T21:06:27.657

是否`Functions.WordsToDate(7, endRow)`在工作表上的单元格中？在这种情况下，您需要改为输入`=Functions.WordsToDate(7, endRow)`。

# php - 根据用户所做的从 mysql 获取数据

> ID：11977160
> 
> 赞同：0
> 
> 时间：2012-08-15T20:56:42.487
> 
> 标签：php, mysql

这有点像脑筋急转弯，我一直在思考如何去做。不确定标题是否足够，但这是我能做的最好的。

我目前正在开发的站点中有一个集中的音频播放系统。集中式是指网站上的所有内容都通过它播放，因此一次只能播放一首曲目，并且还可以进行连续播放。

在我详细介绍玩家之前，我应该解释一下网站的某些部分。该网站为音乐家提供音乐和其他内容。音乐家被用户投票选入网站。要投票，用户将点击投票，听曲目并点击喜欢或不喜欢，简单！一旦曲目获得足够的赞，曲目的创建者将成为该网站的一部分，并将能够将更多曲目上传到该网站的个人资料以及其他内容。这应该可以解释网站的这一部分是关于什么的，这样我就可以详细介绍玩家了。

有 2 个播放器，一个在工具栏中，一个在页面中，可以有几个，有点像 soundcloud 的播放器。一切都链接在一起，因此如果在页内播放器上播放曲目，它会在工具栏播放器中播放，反之亦然。

音频播放器是用 jQuery 构建的。

用户还可以做 3 件事来触发音频播放；

1.  播放工具栏播放器中显示的最新曲目。
2.  在页内播放器中播放曲目。
3.  单击投票并收听随机曲目进行投票。

现在我遇到的问题是mysql查询以及它们是如何选择的。因为用户可以发送的 3 个触发器中的每一个都需要不同的 mysql 查询，所以我需要想办法为每个触发器选择查询。

在下面的查询中，我省略了变量和根据所选曲目获取有关艺术家信息的查询。

查询 1（工具栏播放器）；

```
$fetchtrack = mysql_query("SELECT * FROM tracks ORDER BY timestamp DESC LIMIT 1");
$track = mysql_fetch_array($fetchurl);

$url = $track['url']; 
```

查询 2（在页面播放器中）

```
$fetchtrack = mysql_query("SELECT * FROM tracks WHERE track_ID = Variable for the selected track");
$track = mysql_fetch_array($fetchurl);

$url = $track['url']; 
```

查询3（投票）

```
 //Set up artist query so no artists are shown and cannot be voted on

 $findartist = mysql_query("SELECT * FROM artists");
 $artist = mysql_fetch_array($findartist);

 $artist =  $artist['name']; 

 //Set up vote query so that you are not shown a track you have already voted on

 $findvoted = mysql_query ("SELECT * FROM votes WHERE ID = '$user_ID'");
 $voted = mysql_fetch_array($findvoted);

 $votedID = $voted['track_ID'];

 //Query tracks with relevent information

 $fetchtrack = mysql_query("SELECT * FROM tracks WHERE ID != '$user_ID' AND track_ID != '$votedID' LIMIT 1");
 $track = mysql_fetch_array($fetchtrack);
 $url = $track['url']; 
```

哦，它可以帮助您了解投票系统、工具栏播放器和页面播放器都在单独的文件中，并且都链接到 jQuery 的单个 js 文件。$url 变量作为 var 放入 jQuery 中。

我将如何选择正确的查询以使正确的事情发生？或者至少选择正确的查询结果？

很抱歉这个问题有点啰嗦，但我需要解释几乎每一个细节。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-17T21:20:15.457

我已经整理好了。我最终在我的 javascript 中使用了几个 AJAX 请求，所以它很冗长。每个查询都有一个 AJAX 请求，每个查询都在一个单独的文件中，并且 url 被回显。然后将 url 发送回播放歌曲的 javascript。同时，该 url 被发送到其中一个播放器，在该播放器中进行更多的 sql 查询，并检索正确的信息并为正确的轨道回显。当我掌握了 jQuery 中的 AJAX 函数时，它既简单又合乎逻辑。

# jquery - jQuery条件应用于多个项目

> ID：11977171
> 
> 赞同：0
> 
> 时间：2012-08-15T20:57:51.083
> 
> 标签：jquery, if-statement, conditional, each

我正在尝试 #1 获取文件扩展名，然后一旦我有了 - 有条件地显示一个相应的图标来显示它是什么文件类型。我得到它来检测扩展，我第一次让它工作，我不能让它对每个项目进行不同的处理。

这是代码：

```
 <html>
<head>
<title>check ext</title>

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.js"></script>
    <script>
$(document).ready(function(){

$("div").each(function(){ 
var fileName =$('div img.myimg').attr('src')
var fileExtension = fileName.substring(fileName.lastIndexOf('.') );

if (fileExtension==".jpg")
{
   $(this).next().find("#indicator").addClass("isjpg");
}
else (fileExtension==".gif")
{
   $(this).next().find("#indicator").addClass("isgif");

}

 });

 });

</script>

<style>
.isjpg{background-image:url('images/jpg.gif');}
.isgif{background-image:url('images/gif.gif');}

#indicator{width:100px;height:100px;border:solid;border-width:1px;}
</style>

</head>
<body>
<div>
<img class="myimg" src="images/carthumb.jpg"/><div id="indicator"></div>
</div>

<div>
<img class="myimg" src="images/plus.gif"/><div id="indicator"></div>
</div>
<div>
<img class="myimg" src="images/carthumb.jpg"/><div id="indicator"></div>
</div>

</body>

</html> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T21:01:11.110

您需要使用`this`引用`<div>`迭代序列中的当前，否则返回的文件名将始终是第一个 div 中的图像所指示的文件名：

```
$(document).ready(function() {
    $("body > div").each(function() {
        var fileName = $(this).find('img.myimg').attr('src');
        var fileExtension = fileName.substring(fileName.lastIndexOf('.'));

        if (fileExtension == ".jpg") {
            $(this).find("#indicator").addClass("isjpg");
        }
        else if (fileExtension == ".gif") {
            $(this).find("#indicator").addClass("isgif");
        }
    });
}); 
```

即改变~~`var fileName =$('div img.myimg').attr('src')`~~对此`var fileName =$(this).find('img.myimg').attr('src');`

为了聪明并避免检查每一个，你可以这样做（替换你的`if/else`）：

```
if(fileExtension)
    $(this).find("#indicator").addClass("is" + fileExtension.slice(1) ); 
```

请注意，我删除了[`.next()`](http://api.jquery.com/next/)，它针对的是*下一个*div。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-15T21:02:10.613

尝试更改以下行以引用正确的对象。

```
var fileName =$(this).find('img.myimg').attr('src'); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-08-15T21:21:00.450

这是一个更短的方法

```
$(document).ready(function() {
    $("body > div").each(function() {  // <-- get div's that are direct descendants of body
        var fileName = $(this).find('.myimg').attr('src'); // <-- find img and get src   
        var fileExtension = fileName.substring(fileName.lastIndexOf('.'));  // <-- get img file type
        $(this).find('div').addClass('is'+fileExtension.replace('.','')); // add class 'is' + file type without period
        // since there is only one div you can just look for the div.. 
        // ID's should be unique.. you can change it to a class  or data- attribute if you 
        // really need more than one
    });
});​ 
```

[http://jsfiddle.net/wirey00/4L7wB/](http://jsfiddle.net/wirey00/4L7wB/)

# mocha.js - 样品 mongoskin mocha 测试

> ID：11977172
> 
> 赞同：1
> 
> 时间：2012-08-15T20:57:59.767
> 
> 标签：mocha.js, mongoskin

我有一个带有四个文档的集合“乐队”的样本数据库“摇滚乐队”。这是一个有效的简单存根（咖啡）：

```
mongo     = require('mongoskin')

db = mongo.db('localhost:27017/rockband')
db.collection("bands").find().toArray (err, result) ->
  throw err  if err
  console.log result 
```

这将返回具有良好数据的 json。

但是，以下 mocha 测试通过而没有返回数据或任何投诉：

```
should = require("should")
mongo     = require('mongoskin')

describe "simple test", ->
  err = db = null
  before (done) ->
    db = mongo.db('localhost:27017/rockband')
    done()

  it "should pass", ->
    db.collection("bands").find().toArray (err, result) ->
      throw err  if err
      console.log result

    should.not.exist err 
```

有什么建议么？

# php - 丢弃匹配组中的字符

> ID：11977176
> 
> 赞同：1
> 
> 时间：2012-08-15T20:58:13.840
> 
> 标签：php, regex

我在一个很长的正则表达式模式中一个接一个地有几个匹配的组。在中间我有

```
...(?<number>(?:/(?:digit|num))?\d+|)... 
```

它应该匹配类似`/num9`,`/digit9`或`9`或空白的东西（因为我需要命名组出现在结果关联数组中，即使它是空的）。

`/`该模式有效，但是如果前两种情况之一匹配，是否可以丢弃该字符？我尝试了一个积极的前瞻，但如果你在前瞻之前有表达式，你似乎不能使用那些。

我正在尝试使用正则表达式来完成吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T21:15:43.837

根据您的输入，我认为您`/`无论如何都需要在某个时候捕获，否则您的整个正则表达式都会失败。同时你想忽略它，所以它不能成为你命名组的一部分。因此，通过将其放在它之外并使其成为可选的，同时确保一个数字前面没有直接由 a`/`您提出所需的结果：

```
^/?(?<number>(?:(?:digit|num))?(?<!/)\d+|)$ 
```

但是，鉴于您缺乏更完整的输入和正则表达式，我不能 100% 确定这将适用于您的所有情况。

# jquery - 等待多个 jQuery Deferreds 中的第一个被解决？

> ID：11977192
> 
> 赞同：0
> 
> 时间：2012-08-15T20:59:26.040
> 
> 标签：jquery, jquery-deferred

使用 jQuery，我知道我可以`$.when()`用来等待*所有*multipe`Deferred`被解析。（或者第一个被拒绝。）

但是有没有一种简单的方法来触发多个`Deferred`s 然后等待*第一个*被解决？

例如，我想尝试使用两个类似的 AJAX Web 服务，或者它们可能会出现故障或速度慢，然后处理首先回复的任何一个。然后我可能会使用第三`Deferred`个超时。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T21:21:49.883

基于 Kevin B 的代码，这是一种使用主 Deferred 对象的方法：

```
var masterDeferred = new $.Deferred(),
    reqOne = $.post("foo.php"),
    reqTwo = $.post("bar.php");

masterDeferred.done(function() {
    // do stuff
});

reqOne.done(function() {
    masterDeferred.resolve();
});
reqTwo.done(function() {
    masterDeferred.resolve();
}); 
```

我想我说得对，解决 masterDeferred 的最简单形式是：

```
reqOne.done(masterDeferred.resolve);
reqTwo.done(masterDeferred.resolve); 
```

但是单独的 done 函数将允许您在内部分支并调用`.resolve()`,`.reject()`或酌情`.resolveWith(...)`与一般形式的回调`.rejectWith(...)`一起：`masterDeferred`

```
masterDeferred.then( doneCallbacks, failCallbacks ); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T21:02:32.360

一种快速简便的方法是在两个请求之一完成时中止另一个请求，尽管您也可以检查延迟的状态，其语法将取决于您的 jQuery 版本，这就是我现在使用 abort 的原因。

```
function doStuff(data) {
    alert( "Hello World!" );
}
var reqOne = $.post("foo.php"),
reqTwo = $.post("bar.php");

reqOne.done(function(data){
    reqTwo.abort();
    finished = true;
    doStuff(data);
});
reqTwo.done(function(data){
    reqOne.abort();
    finished = true;
    doStuff(data);
}); 
```

# php - While 循环和多个条件

> ID：11977195
> 
> 赞同：11
> 
> 时间：2012-08-15T20:59:38.537
> 
> 标签：php

是否可以在while循环中编写多个条件？如果没有，有什么替代方案？我尝试了它并返回一个错误，该错误与设置 while 循环条件的代码行有关。这是我的意思的一个例子。

```
$s = 1;

while ($result_row = mysql_fetch_assoc($query) && $s < 5)
{
echo $result_row['id'];
$s++;
} 
```

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2012-08-15T21:02:29.993

这是可能的，但是因为`=`它的[优先级](http://php.net/manual/en/language.operators.precedence.php)低于`&&`你需要括号来确保你的语句被正确解释：

```
while (($result_row = mysql_fetch_assoc($query)) && ($s < 5)) 
```

这里不需要括号`$s < 5`，但为了清楚起见，我将它们包括在内。

但是，将查询修改为仅返回 5 行会更容易，只需添加`LIMIT 5`.

```
SELECT ...
FROM yourtable
ORDER BY ...
LIMIT 5 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T21:03:21.217

你可以试试：

```
$s=1
while ($result_row = mysql_fetch_assoc($query))
{
    echo $result_row['id'];
    $s++;
    if($s>5){
        break;
    }
} 
```

[http://php.net/manual/en/control-structures.break.php](http://php.net/manual/en/control-structures.break.php)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T21:04:34.353

虽然我认为这没有错。另一种方法是做这样的事情。

```
$s = 1;
while ($result_row = mysql_fetch_assoc($query))
{
    if($s < 5) {
        //enter the condition
    }
    $s++;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-08-15T21:08:01.640

的值`$result_row`可能被设置为布尔条件，即是否`mysql_fetch_assoc($query)`返回真值且`$s`小于 5。因此尝试`$result_row`作为字典阅读不再有效。

您可以使用括号来准确指定如何解析事物：

```
while (($result_row = mysql_fetch_assoc($query)) && ($s < 5)) 
```

这样，`$result_row`设置为`mysql_fetch_assoc($query)`，这就是您想要的，*并且*只要该赋值的逻辑值返回真值并且`s`小于 5，循环就会继续。

# excel - Excel中的高级查找和替换

> ID：11977200
> 
> 赞同：0
> 
> 时间：2012-08-15T21:00:01.707
> 
> 标签：excel, replace

我有一个产品列表 excel 表和类别列表 excel 表。

在类别 excel 中有 cat_id 和 cat_name 一个对应另一个。

我需要对每个 cat_id 进行查找和替换，并将产品列表中的数字替换为 cat_name。

我将如何在excel中做到这一点？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-16T00:58:56.153

我认为您无法通过 Excel 公式一步实现您想要的。但是，您可以使用以下方法。

假设调用了产品列表表，而调用`ProductList`了另一个表`CategoryList`。另外，假设工作表上的`cat_id`项目`ProductList`在列中，工作表上`A`的`cat_id`和`cat_name`列`CategoryList`在列`A`和中`B`。

首先，您必须确保工作表上的项目`CategoryList`按升序排序`cat_id`。然后，在工作表上空列的第一行的单元格中`ProductList`（假设是 cell `Q1`），输入以下公式：

```
=LOOKUP($A1,CategoryList!A:A,CategoryList!B:B) 
```

然后选择单元格`Q1`并将右下角一直向下拖动，直到工作表中数据的末尾。在此之后，列`Q`将包含所需的值。

`A`要将列中的原始值实际替换为 中的值`Q`，您需要复制整个列`Q`并将“选择性粘贴”到列`A`中，在其中选择单选按钮“值”。之后，您可以删除临时列`Q`。

如果您想`cat_id`对 sheet 上不存在的项目保持稳健`CategoryList`，您可以添加一个检查，使公式如下（在一行上）：

```
=IF($A1<>LOOKUP($A1,CategoryList!A:A,CategoryList!A:A),
    "Not Found",LOOKUP($A1,CategoryList!A:A,CategoryList!B:B)) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-02-01T07:21:28.157

Powershell 脚本扩展 PSExcel 具有一些连接功能：

[PSExcel：](https://github.com/RamblingCookieMonster/PSExcel)[https ://github.com/RamblingCookieMonster/PSExcel](https://github.com/RamblingCookieMonster/PSExcel)

方法： `Join-Worksheet -Path`

我已经尝试搜索并成功替换。也可以在这里参考我的答案： [Perform find & replace in excel doc in C#](https://stackoverflow.com/questions/5792681/perform-find-replace-in-excel-doc-in-c-sharp/41974151#41974151)

# php - 将多维数组的子数组附加到 PHP 关联数组

> ID：11977203
> 
> 赞同：0
> 
> 时间：2012-08-15T21:00:25.867
> 
> 标签：php, multidimensional-array

如何将多维数组的一部分添加到现有的二维（关联）数组中？

例如，对于具有以下元素的现有关联数组：

```
$builder = array();
$builder['builder_id'] =        $source['id'];
$builder['builder_name'] =      $source['name'];
$builder['builder_address'] =   $source['address']; 
```

以下多维数组的部分如何：

```
$selection[$category['category_name']]['item_name'] = $category_general['item_name'];
$selection[$category['category_name']]['item_source'] = $category_general['item_source'];
$selection[$category['category_name']]['item_image'] = $category_general['item_image']; 
```

附加以创建以下结构：

```
$builder['builder_id']
$builder['builder_name']
$builder['builder_address']
$builder['category_name']
$builder['category_name']['item_name']
$builder['category_name']['item_source']
$builder['category_name']['item_image'] 
```

像这样的作业不起作用：

```
$builder['category_name'] = $selection[$category['category_name']];
$builder['category_name'] = $selection[$category['category_name']][]; 
```

有什么建议么？

谢谢！

*编辑：
@symcbean 你是对的。由于分配了数组中的空元素，分配失败。
@Snowsickle 感谢您提供指出问题根源的提示。*

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T21:08:42.983

第一个任务应该工作。

```
$builder['category_name'] = $selection[$category['category_name']]; 
```

将数组中包含的所有值分配给`$selection[$category['category_name']]`数组`$builder['category_name']`。

[**演示**](http://sandbox.onlinephpfunctions.com/code/c3635f282f3d2fa4927b9c9a3da25d570bab5f6e)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-15T21:06:55.040

分配应该工作..但如果你需要另一种方法：

```
foreach($selection[$category['category_name']] as $key => $value)
{
    $builder['category_name'][$key] = $value;
} 
```

但是再一次，数组赋值一直对我有用。

# objective-c - 获得随机奇数或偶数的最有效方法是什么？

> ID：11977208
> 
> 赞同：0
> 
> 时间：2012-08-15T21:00:49.847
> 
> 标签：objective-c

因此，在我的脑海中，我可以想到一些解决方案（例如，专注于获取随机奇数）：

```
int n;
while (n == 0 || n % 2 == 0) {
    n = (arc4random() % 100);
} 
```

eww..对吗？一点效率都没有。。

```
int n = arc4random() % 100);
if (n % 2 == 0) n += 1; 
```

但我不喜欢它总是会增加数字，如果它不是奇数的话。也许这不重要？另一种方法可能是随机化：

```
int n = arc4random() % 100);
if (n % 2 == 0) {
    if (arc4random() % 2 == 0) {
       n += 1;
    else {
       n -= 1;
    }
 } 
```

但这对我来说感觉有点糟糕。所以我想知道是否有更好的方法来做这种事情？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-08-15T21:03:12.160

生成一个随机数，然后将其乘以 2 为偶数，乘以 2 加 1 为奇数。

通常，您希望保持这些简单，否则您会冒着弄乱数字分布的风险。获取典型 [0...1) 随机数生成器的输出，然后使用函数将其映射到所需范围。

FWIW - 除了第三个之外，您看起来并没有扭曲上面的分布。请注意，除非您使用模数（包括）进行调整，否则获得 99 的可能性低于所有其他人。负数。自从..

```
P(99) = P(first roll = 99) + P(first roll = 100 & second roll = -1) + P(first roll = 98 & second roll = +1) 
```

和`P(first roll = 100) = 0`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-08-15T21:07:46.313

如果您想要一组随机的二进制数字，后跟一个固定数字，那么我会使用按位运算：

```
 odd = arc4random() | 1; 
 even = arc4random() & ~ 1; 
```

# css - CSS, someClass:not(.foo):not(.bar)

> ID：11977209
> 
> 赞同：1
> 
> 时间：2012-08-15T21:00:53.170
> 
> 标签：css

在 CSS 中，我必须指定一个特定的类（例如`.myClass`），但排除具有两个类之一的实例（例如，not `.foo`nor `.bar`）。

我研究了 CSS3 新`:not()`语法，但我不确定如何指定我不想使用的*两个类。*我认为这是不正确的（它对我不起作用）。但是，这似乎是一种简洁的方式来展示我正在尝试做的事情：

```
.myClass:not(.foo):not(.bar) {
   ...
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T21:03:48.650

只需用逗号分隔它们：

```
.myClass:not(.foo, .bar){
   ...
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T21:03:54.150

在它们之间使用逗号：

```
.myClass:not(.foo, .bar) {
    ...
} 
```

来源：[http ://devsnippets.com/article/5-advanced-css-pseudo-class.html](http://devsnippets.com/article/5-advanced-css-pseudo-class.html)

# c++ - 从数组中释放元素

> ID：11977216
> 
> 赞同：0
> 
> 时间：2012-08-15T21:01:20.150
> 
> 标签：c++, arrays, dynamic, size

可能，这是一个非常基本的问题，但无论如何。我有一个大小为 10 的数组。但是，在为该数组分配整数时，我只给出 8 个元素。我可以释放 2 个未使用的元素的内存吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T21:03:42.710

不，你不能。对于动态分配，您只能使用`free`or分配的`delete`内存。完全相同的数量与完全相同的指针。对于自动变量，内存将被自动释放。`malloc``new`

但由于这是 C++，请使用 a`std::vector`代替。请。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T21:04:37.583

这首先取决于您如何获得阵列。

如果它是在自动或静态存储（即本地或全局）中分配的数组，则没有任何东西可以释放，因为您没有分配任何东西（编译器为您做了）。

如果这是一个动态分配的数组，您可以通过创建一个只有八个元素的较小数组，将原始值复制到其中，然后释放原始数组来达到相同的效果。这并不能保证分配给程序的内存量一定会减少，因为八元素数组的分配器允许为更多元素分配空间。另一方面，如果数字是 10000 和 8000，您几乎肯定会节省一些钱（尽管标准也不能保证）。

# android - 将图像转换为 Base64 - ProfileMap 为空？- 安卓

> ID：11977217
> 
> 赞同：-4
> 
> 时间：2012-08-15T21:01:26.413
> 
> 标签：android, base64

为什么我的 profileMap 为空。它似乎并没有保持人口稠密，但我没有在任何地方清除它。我究竟做错了什么？每当我尝试像在 logcat 中一样打印出 profileMap 数据时，它是空的？

这是日志猫：

```
 08-15 07:34:37.141: I/ActivityThread(382): Pub com.iconnexus.client: com.iconnexus.client.ProfileProvider
 08-15 07:34:37.351: D/dalvikvm(382): GC_EXTERNAL_ALLOC freed 57K, 53% free 2566K/5379K, external 1625K/2137K, paused 78ms
 08-15 07:34:41.581: E/ProfileDBUtilities(382): Error when getting profile from the db: Index 0 requested, with a size of 0
 08-15 07:34:41.651: E/ProfileActivity(382): profile map data after update: {}null
 08-15 07:34:41.651: E/ProfileActivity(382): profile map data after setProfile: {}
 08-15 07:34:41.651: E/ProfileActivity(382): profile map data after update: {}null
 08-15 07:34:41.661: E/ProfileActivity(382): profile map data after setProfile: {}
 08-15 07:34:41.671: E/ProfileActivity(382): unhandled exception when attempting to set profile image:null
 08-15 07:34:41.711: E/ProfileActivity(382): profile map data after creation: {}
 08-15 07:34:41.711: E/ProfileActivity(382): profile map data after update: {}null
 08-15 07:34:41.721: E/ProfileActivity(382): profile map data after setProfile: {}
 08-15 07:34:41.721: E/ProfileActivity(382): unhandled exception when attempting to set profile image:null
 08-15 07:34:41.991: E/ProfileActivity(382): LocalProfileActivity profileJSON: {"nameValues":{},"profileId":13,"valid":false}
 08-15 07:34:42.061: E/LocalProfile(382): ConvertandSetImagetoBase64: Could not load selected profile image
 08-15 07:34:42.071: E/LocalProfile(382): ConvertandSetImagetoBase64: Could not load selected profile image
 08-15 07:40:23.171: W/KeyCharacterMap(382): No keyboard for id 0
 08-15 07:40:23.193: W/KeyCharacterMap(382): Using default keymap: /system/usr/keychars/qwerty.kcm.bin
 08-15 07:40:24.161: E/ProfileDBUtilities(382): Error when getting profile from the db: Index 0 requested, with a size of 0
 08-15 07:40:24.161: E/ProfileActivity(382): profile map data after update: {}null
 08-15 07:40:24.161: E/ProfileActivity(382): profile map data after setProfile: {}
 08-15 07:40:24.592: E/ProfileActivity(382): profile map data after update: {}null
 08-15 07:40:24.621: E/ProfileActivity(382): profile map data after setProfile: {}
 08-15 07:40:24.621: E/ProfileActivity(382): profile map data after update: {}null
 08-15 07:40:24.632: E/ProfileActivity(382): profile map data after setProfile: {}
 08-15 07:40:24.641: E/ProfileActivity(382): unhandled exception when attempting to set profile image:null
 08-15 07:40:24.691: E/ProfileActivity(382): profile map data after creation: {}
 08-15 07:40:24.711: E/AndroidClient(382): Before initEventHandlers
 08-15 07:40:24.711: E/AndroidClient(382): After initEventHandlers
 08-15 07:40:24.721: E/AndroidClient(382): Local Profile Map is null from intent in ConnectActivity
 08-15 07:40:24.721: E/AndroidClient(382): Before OnCreate() Try
 08-15 07:40:24.731: E/AndroidClient(382): In OnCreate() Try
 08-15 07:40:24.842: E/AndroidClient(382): Created Socket
 08-15 07:40:24.851: E/AndroidClient(382): Created DataOutputStream
 08-15 07:40:24.862: E/AndroidClient(382): Created DataInputStream
 08-15 07:40:24.862: E/AndroidClient(382): Created Profile Instance
 08-15 07:40:24.872: E/AndroidClient(382): Created Gson InstanceGetProfileJSONStr:{},"profileId":13,"valid":false}
 08-15 07:40:25.043: E/AndroidClient(382): Get Profile JSON String:{"nameValues":{},"profileId":0,"valid":false}
 08-15 07:40:25.043: E/AndroidClient(382): Converted Profile to JSON
 08-15 07:40:25.053: E/AndroidClient(382): Before: outputJSON = gson.toJson(p);
 08-15 07:40:25.053: E/AndroidClient(382): Created outputJSON:{},"profileId":13,"valid":false}
 08-15 07:40:25.074: E/AndroidClient(382): Print Profile JSON String:{"nameValues":{},"profileId":13,"valid":false}
 08-15 07:40:25.074: E/AndroidClient(382): LATER Print Profile JSON String:{},"profileId":13,"valid":false}
 08-15 07:40:25.101: E/AndroidClient(382): TAGLINE: null
 08-15 07:40:25.101: E/AndroidClient(382): WHOOZNEAR PIC:null
 08-15 07:40:25.111: E/AndroidClient(382): REGEX REPLACEALL:"Ryan"
 08-15 07:40:25.111: E/AndroidClient(382): temp_Bitmap is NULL!!
 08-15 07:40:25.141: E/ProfileActivity(382): unhandled exception when attempting to set profile image
 08-15 07:40:25.141: D/AndroidRuntime(382): Shutting down VM
 08-15 07:40:25.151: W/dalvikvm(382): threadid=1: thread exiting with uncaught exception (group=0x40015560)
 08-15 07:40:25.181: E/AndroidRuntime(382): FATAL EXCEPTION: main
 08-15 07:40:25.181: E/AndroidRuntime(382): java.lang.RuntimeException: Unable to start activity ComponentInfo{com.iconnexus.client/com.iconnexus.client.AndroidClient}: java.lang.NullPointerException
 08-15 07:40:25.181: E/AndroidRuntime(382):     at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:1647)
 08-15 07:40:25.181: E/AndroidRuntime(382):     at android.app.ActivityThread.handleLaunchActivity(ActivityThread.java:1663)
 08-15 07:40:25.181: E/AndroidRuntime(382):     at android.app.ActivityThread.access$1500(ActivityThread.java:117)
 08-15 07:40:25.181: E/AndroidRuntime(382):     at android.app.ActivityThread$H.handleMessage(ActivityThread.java:931)
 08-15 07:40:25.181: E/AndroidRuntime(382):     at android.os.Handler.dispatchMessage(Handler.java:99)
 08-15 07:40:25.181: E/AndroidRuntime(382):     at android.os.Looper.loop(Looper.java:123)
 08-15 07:40:25.181: E/AndroidRuntime(382):     at android.app.ActivityThread.main(ActivityThread.java:3683)
 08-15 07:40:25.181: E/AndroidRuntime(382):     at java.lang.reflect.Method.invokeNative(Native Method)
 08-15 07:40:25.181: E/AndroidRuntime(382):     at java.lang.reflect.Method.invoke(Method.java:507)
 08-15 07:40:25.181: E/AndroidRuntime(382):     at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:839)
 08-15 07:40:25.181: E/AndroidRuntime(382):     at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:597)
 08-15 07:40:25.181: E/AndroidRuntime(382):     at dalvik.system.NativeStart.main(Native Method)
 08-15 07:40:25.181: E/AndroidRuntime(382): Caused by: java.lang.NullPointerException
 08-15 07:40:25.181: E/AndroidRuntime(382):     at android.util.Base64.encode(Base64.java:494)
 08-15 07:40:25.181: E/AndroidRuntime(382):     at android.util.Base64.encodeToString(Base64.java:456)
 08-15 07:40:25.181: E/AndroidRuntime(382):     at com.iconnexus.client.ProfileActivity.GetBase64ImgString(ProfileActivity.java:315)
 08-15 07:40:25.181: E/AndroidRuntime(382):     at com.iconnexus.client.AndroidClient.onCreate(AndroidClient.java:266)
 08-15 07:40:25.181: E/AndroidRuntime(382):     at android.app.Instrumentation.callActivityOnCreate(Instrumentation.java:1047)
 08-15 07:40:25.181: E/AndroidRuntime(382):     at android.app.ActivityThread.performLaunchActivity(ActivityThread.java:1611)
 08-15 07:40:25.181: E/AndroidRuntime(382):     ... 11 more
 08-15 07:40:27.442: I/Process(382): Sending signal. PID: 382 SIG: 9 
```

以下是 ProfileActivity.java 的代码： package com.iconnexus.client;

```
import java.io.ByteArrayOutputStream;

import java.io.FileInputStream;

import java.util.ArrayList;

import java.util.HashMap;

import java.util.LinkedHashMap;

import java.util.Set;

import java.util.Map.Entry;

/*import javax.jmdns.ServiceEvent;

import javax.jmdns.ServiceInfo;*/

import com.iconnexus.client.R;

import android.app.Activity;

import android.content.Context;

import android.content.Intent;

import android.graphics.Bitmap;

import android.graphics.BitmapFactory;

import android.os.Bundle;

import android.util.Base64;

import android.util.Log;

import android.view.LayoutInflater;

import android.view.Menu;

import android.view.MenuItem;

import android.view.View;

import android.view.ViewGroup;

import android.widget.BaseAdapter;

import android.widget.ImageButton;

import android.widget.ListView;

import android.widget.TextView;

import android.widget.Toast;

public class ProfileActivity extends Activity {

private static final int NEAR = Menu.FIRST;

private final static String LOG_TAG = ProfileActivity.class.getSimpleName();

//ServiceInfo info = null;

private static final String TAG = "ProfileActivity";

protected LinkedHashMap<String, String> profileMap;

protected static ArrayList<Entry<String, String>> profileArrayList;

private Set<Entry<String, String>> profileSet;

//private Context context;

protected static final boolean D = false;

protected static byte[] input;

protected ListView profileList;

private TextView nameView;

private TextView tagLineView;

protected ProfileAdapter customAdapter;

private ImageButton buttonReturnToNearby;

private TextView screenNameView;

private Profile profile = new Profile();

private Bitmap profBitmap;

protected static class ProfileAdapter extends BaseAdapter {

    private LayoutInflater mInflater;

    public ProfileAdapter(Context context ) {

        mInflater = LayoutInflater.from(context);

    }

    public int getCount() {

        return profileArrayList.size();

    }

    public Object getItem(int arg0) {

        return profileArrayList.get(arg0);

    }

    public long getItemId(int position) {

        return position;

    }

    public View getView(int position, View convertView, ViewGroup parent) {

        // A ViewHolder keeps references to children views to avoid unnecessary calls

        // to findViewById() on each row.

        ViewHolder holder;

        // When convertView is not null, we can reuse it directly, there is no need

        // to reinflate it. We only inflate a new View when the convertView supplied

        // by ListView is null.

        if (convertView == null) {

            convertView = mInflater.inflate(R.layout.peer_profile_row, null, false);

            // Creates a ViewHolder and store references to the two children views

            // we want to bind data to.

            holder = new ViewHolder();

            holder.propertyName = (TextView) convertView.findViewById(R.id.propertyName);

            holder.propertyValue = (TextView) convertView.findViewById(R.id.propertyValue);

            //TODO: Put a default view here or something if it is a phone or email

            //holder.icon = (ImageView) convertView.findViewById();

            convertView.setTag(holder);

        } else {

            // Get the ViewHolder back to get fast access to the TextView

            // and the ImageView.

            holder = (ViewHolder) convertView.getTag();

        }

        // Bind the data efficiently with the holder.            

        //TODO: Make this correct

        holder.propertyName.setText( profileArrayList.get(position).getKey() );

        holder.propertyValue.setText( profileArrayList.get(position).getValue() );

        return convertView;

    }

    class ViewHolder {

        TextView propertyName;

        TextView propertyValue;

    }

    public boolean isEmpty() {

        return profileArrayList.isEmpty();

    }

};

/*

public void onStart(){

    super.onStart();

    if (D) {Log.i(TAG, "++++ ON START +++++"); }

}

*/

@Override

public void onCreate (Bundle savedInstanceState) {

    super.onCreate(savedInstanceState);

    setContentView(R.layout.activity_profile_display);

    //if (D) {Log.i(TAG, "++++ ON CREATE +++++"); }

    HashMap<String, String> temp = new HashMap<String, String>();

    try 

    {

        temp = (HashMap<String, String>)  profileMap; 

        //THE LINE BELOW NEEDS TO BE UNCOMMENTED TO RECEIVE THE ATTRIBUTES 4/9/12

        temp = (HashMap<String, String>)  this.getIntent().getSerializableExtra("ProfileData"); 

        //temp = profile.getAllAttributesIncludingPicture();

        //profile.setTagLine(temp.get("TagLine"));

        //profile.setProfilePicStr(temp.get("WHOOZNEAR_PROFILEPIC"));

        //profile.setWhatIDo(temp.get("What I Do"));

    }

    catch (Exception e)

    {

        Log.e(TAG, "Runtime Exceptions suck");

    }

    if (temp != null) {

        profileMap =  new LinkedHashMap<String, String> (temp);     

        //profileMap = profile.getAllAttributesIncludingPicture();

    }

    else

    {

        Log.e(TAG, "temp HashMap is NULL");

    }

    setProfile(profile);

    screenNameView = (TextView) findViewById(R.id.ab_screen_name);

    screenNameView.setText("Peer Profile");

    buttonReturnToNearby = (ImageButton) findViewById(R.id.btn_nearby);

    buttonReturnToNearby.setOnClickListener(new View.OnClickListener() {

        public void onClick(View v) {

            try {

                Log.e(TAG, "commented out call to WhoozNearActivity");

                /*

                if(profileMap.get("Name") != null && profileMap.get("Name").compareTo("Set a new value") != 0

                        && profileMap.get("Age") != null && profileMap.get("Age").compareTo("Set a new value") != 0

                        && profileMap.get("Looking") != null && profileMap.get("Looking").compareTo("Set a new value") != 0){

                    float age = Float.parseFloat(profileMap.get("Age"));

                    Intent mainIntent = new Intent(getBaseContext(), WhoozNearActivity.class);

                    startActivity(mainIntent);

                    //finish();

                } else {

                    Toast.makeText(getBaseContext(), "Please, enter values for Name, Age and Looking", Toast.LENGTH_LONG).show();

                }

                */

            } catch (NumberFormatException nfe) {

                nfe.printStackTrace();

                Toast.makeText(getBaseContext(), "Value Age is not correct", Toast.LENGTH_LONG).show();

            } catch (NullPointerException npe) {

                npe.printStackTrace();

                Toast.makeText(getBaseContext(), "Error", Toast.LENGTH_LONG).show();

            }

        }

    });

    //AndroidClient android = new AndroidClient();

    //profile = android.getLocalProfile();

    setProfile(profile);

    setupAdapter();

    //updateProfileList();  //extra call to update is not required

    setupViews();

    Log.e(TAG, "profile map data after creation: " + profileMap);

    //Log.e(TAG, "Get Profile Pic STR:"+getProfilePicStr());

    //Log.e(TAG, "Get Image STR:"+getImageStr());

}

public void setProfile(Profile profile) {

    this.profileMap = profile.getAllAttributes();

    updateProfileList();

    Log.e(TAG, "profile map data after setProfile: " + profileMap);

}

public String getTagline() { 

    return profileMap.get("TagLine");

}

public String getName() { 

    Log.e(TAG, "Got the NAME!");

    return profileMap.get("Name");

}

/*public void setProfilePic() { 

    Log.e(TAG, "SET THE PROFILE PIC!!");

}*/

public LinkedHashMap<String, String> getProfileMap() { 

    return profileMap;

}

public void setupAdapter() {

    customAdapter = new ProfileAdapter(this);

}

public void setupViews() {

    if (profileList == null) {

        profileList = (ListView) findViewById(R.id.profile_list);

        profileList.setAdapter(customAdapter);

    }

    nameView = (TextView) findViewById(R.id.profileNameLine);

    nameView.setText(profileMap.get("Name"));

    tagLineView = (TextView) findViewById(R.id.profileTagLine);

    tagLineView.setText(profileMap.get("TagLine"));

    //try to set profile pic, otherwise use default

    try{

        ImageButton ppView = (ImageButton) findViewById(R.id.btn_whooznear);

        String base64 = profileMap.get("WHOOZNEAR_PROFILEPIC");

        //base64 = ConvertandSetImagetoBase64(profile.getSelectedImgPath());

        Log.e("LOG_TAG", "ProfileActivity Base64 String:"+base64+profileMap.get("WHOOZNEAR_PROFILEPIC"));

        //SET THE LOCAL PROFILE PIC STR

        profile.setProfilePicStr(base64);

        byte[] picBytes = Base64.decode(base64, Base64.DEFAULT);  //works with android 2.2 and higher

        //byte[] picBytes = Base64.decode(base64);

        Bitmap bitmap = BitmapFactory.decodeByteArray(picBytes, 0, picBytes.length);

        if (bitmap != null) {

            setProfileBitmap(bitmap);

            ppView.setImageBitmap(bitmap);

        }

    }       

    catch (Exception e)

    {

        Log.e(TAG, "unhandled exception when attempting to set profile image:" + e.getMessage());

        Toast.makeText(getBaseContext(), "No profile image selected", Toast.LENGTH_LONG).show();

    }

}

/*public String getImageStr() { 

    return profileMap.get("WHOOZNEAR_PROFILEPIC").toString();

}*/

/*public String getProfilePicStr() { 

    return profileMap.get("ProfilePic").toString();

}*/

 /*public String ConvertandSetImagetoBase64(String imagePath) { 

        String base64 = null;

        byte[] input = null;

        try{

            FileInputStream fd = new FileInputStream(imagePath);

            Bitmap bmt = BitmapFactory.decodeFileDescriptor(fd.getFD());

            try{                

                ByteArrayOutputStream stream = new ByteArrayOutputStream();

                Bitmap tmp = ProfileActivity.scaleDownBitmap(bmt, 10, this);

                tmp.compress(Bitmap.CompressFormat.JPEG, 10, stream);

                input = stream.toByteArray();

                base64 = Base64.encodeToString(input, Base64.DEFAULT);

                //LocalProfileActivity.input = input;

            }catch(Exception e){

                Log.e(LOG_TAG,"[ONACTIVITYRESULT] Could not bind input to the bytearray: " + e.getMessage());

            }

        }

        catch (Exception e){

            Log.e("LocalProfile", "Could not load selected profile image");

        }

        return base64;

    }*/

public void setProfileBitmap(Bitmap profBitmap) { 

    this.profBitmap = profBitmap;

}

public Bitmap getProfileBitmap() {

    return profBitmap;

}

/*public String GetBase64ImgString() { 

    String base64Str = Base64.encodeToString(getImageBytes(), Base64.DEFAULT);

    return base64Str;

}*/

public String BitMapToString(Bitmap bitmap){

     String temp = "";

     Bitmap temp_Bitmap = bitmap;

     if (temp_Bitmap != null) { 

         try { 

              ByteArrayOutputStream baos = new ByteArrayOutputStream();

              temp_Bitmap.compress(Bitmap.CompressFormat.PNG, 0, baos);

              byte[] b=baos.toByteArray();

              temp=Base64.encodeToString(getImageBytes(), Base64.DEFAULT);

         }

         catch(Exception e){

              Log.e(LOG_TAG,"[ONACTIVITYRESULT] Could not bind input to the bytearray: " + e.getMessage());

         }

     }

     return temp;

}

public Bitmap StringToBitMap(String encodedString){

     try{

       byte[] encodeByte=Base64.decode(encodedString,Base64.DEFAULT);

       Bitmap bitmap=BitmapFactory.decodeByteArray(encodeByte, 0, encodeByte.length);

       return bitmap;

     }catch(Exception e){

       e.getMessage();

       return null;

     }

}

public byte[] getImageBytes() { 

    byte[] picBytes = null;

    try{

        //ImageButton ppView = (ImageButton) findViewById(R.id.icon);

        String base64 = profileMap.get("WHOOZNEAR_PROFILEPIC");

        picBytes = Base64.decode(base64, Base64.DEFAULT);  //works with android 2.2 and higher

        //byte[] picBytes = Base64.decode(base64);

        //Bitmap bitmap = BitmapFactory.decodeByteArray(picBytes, 0, picBytes.length);

        //if (bitmap != null )

            //ppView.setImageBitmap(bitmap);

    }       

    catch (Exception e)

    {

        Log.e(TAG, "unhandled exception when attempting to set profile image");

        //Toast.makeText(getBaseContext(), "No profile image selected", Toast.LENGTH_LONG).show();

    }

    return picBytes;

}

public void updateProfileList() {

    try

    {

    LinkedHashMap <String, String> temp = (LinkedHashMap<String, String>) profileMap.clone();

    temp.remove("Name");

    temp.remove("TagLine");

    temp.remove("ProfileName");

    profileSet = temp.entrySet();

    }

    catch(NullPointerException e)

    {

        e.printStackTrace();

        Log.i(TAG, "exception in thread: updateProfileList() ... profile map: " + profileMap);

    }

    //Profile personfound = new Profile();

            //personfound.addAttribute("age", info.getPropertyBytes("profilePic"));

            //personfound.addAttribute("name", profileMap.get("name"));

            //personfound.addAttribute("age", info.getPropertyString("age"));

            //personfound.addAttribute("gender", info.getPropertyString("gender"));

            //personfound.addAttribute("name", info.getPropertyString("name"));

    //getProfile(personfound);

    //profileArrayList = new ArrayList( Arrays.asList(profileArray) );

    if (profileArrayList == null)

        profileArrayList = new ArrayList();

    else

        profileArrayList.clear();

    for (Entry<String, String> e : profileSet ) {

        profileArrayList.add(e);

    }

    if (profileList != null)

        if (profileList.getAdapter() != null)

            customAdapter.notifyDataSetChanged();

    Log.e(TAG, "profile map data after update: " + profileMap + profileMap.get("WHOOZNEAR_PROFILEPIC"));

}

public Profile getProfile(Profile profilePersonFound) { 

    return profilePersonFound;

}

public void onNameClick (View v) {

    return;

}

public boolean onCreateOptionsMenu(Menu menu) {

    menu.add(0, NEAR, 0, "NearBy").setIcon(android.R.drawable.ic_menu_info_details);

    return true;

}

@Override

public boolean onOptionsItemSelected(MenuItem item) {

   switch (item.getItemId()) {

   case NEAR:

       try {

            /*if(profileMap.get("Name") != null && profileMap.get("Name").compareTo("Set a new value") != 0

                    && profileMap.get("Age") != null && profileMap.get("Age").compareTo("Set a new value") != 0

                    && profileMap.get("Looking") != null && profileMap.get("Looking").compareTo("Set a new value") != 0){

                float age = Float.parseFloat(profileMap.get("Age"));

                Intent mainIntent = new Intent(this, WhoozNearActivity.class);

                startActivity(mainIntent);

                //finish();

            } else {

                Toast.makeText(this, "Please, enter values for Name, Age and Looking", Toast.LENGTH_LONG).show();

            }*/

           String tagline = profileMap.get("TagLine");

           /*NeighborViewModel nv = new NeighborViewModel();

           nv.setNeighborDesc(profileMap.get("TagLine"));  //Try setServiceDesc();

           String name = profileMap.get("Name");

           NeighborViewModel nv = null;

           nv.setNeighborName(name);*/

           Profile profile = new Profile();

           profile.setProfileName(profileMap.get("Name"));

           profile.setTagLine(profileMap.get("TagLine"));

           if (profileMap.get("Name") != null) { 

               //Toast.makeText(this, "In If Statement", Toast.LENGTH_LONG).show();

               //Toast.makeText(this, tagline, Toast.LENGTH_LONG).show();

               //Intent Call

               //Intent intent = new Intent(this, WhoozNearActivity.class);

               //startActivity(intent);

               //Pass the profile data so that it can be broadcasted in ConnectActivity.java

               Intent myIntent = new Intent(ProfileActivity.this,

                   AndroidClient.class);

               /*try{

                   if(input!= null){

                       Bitmap b = ShrinkBitmap(input, 10,10);

                       ByteArrayOutputStream stream = new ByteArrayOutputStream();

                       b.compress(Bitmap.CompressFormat.JPEG, 10, stream);

                       byte[] byteArray = stream.toByteArray();

                       String base64Image = Base64.encodeToString(byteArray, Base64.DEFAULT);

                       //SETS THE PROFILE PIC STRING IN BASE64 TO THE PROFILE CLASS

                       profile.setProfilePicStr(base64Image);

                       //Log.i(LOG_TAG, "Image:"+base64Image);

                       int imageSize = base64Image.length();

                       Log.i(LOG_TAG, "WholeImage:"+base64Image);

                       Log.i(LOG_TAG,"Image Size: " + imageSize);

                       int chunkSize = 200;

                       int numSplits = imageSize/chunkSize;

                       Log.i(LOG_TAG,"Num splits: " + numSplits);

                       int i =0;

                       int index = 0;

                       for(index =0; index < numSplits; index++){

                           String tmp = base64Image.substring(i, i+chunkSize);

                           i+=chunkSize;

                           Log.i(LOG_TAG,"Index = " +i);

                           Log.i(LOG_TAG,"Breaking image into pieces of size : " + tmp.length());

                           profileMap.put("ProfilePic"+ index, tmp);

                       }

                       String tmp = base64Image.substring(i);

                       profileMap.put("ProfilePic"+index, tmp);

                   }

               }catch(Exception e){

                   Log.e(LOG_TAG,"Image parsing error: " +e.getMessage());

                   e.printStackTrace();

               }*/

               Toast.makeText(getBaseContext(), "In ProfileActivity", Toast.LENGTH_SHORT);

               myIntent.putExtra("Props", profileMap);

               startActivity(myIntent);

           }

           else {

            Toast.makeText(this, "Please, enter values for Name", Toast.LENGTH_LONG).show();

        }

        } catch (NumberFormatException nfe) {

            nfe.printStackTrace();

            Toast.makeText(this, "Value Age is not correct", Toast.LENGTH_LONG).show();

        } catch (NullPointerException npe) {

            npe.printStackTrace();

            Toast.makeText(this, "Error", Toast.LENGTH_LONG).show();

        }

        break;

    }

    return true;

}

Bitmap ShrinkBitmap(byte[] file, int width, int height){

    BitmapFactory.Options bmpFactoryOptions = new BitmapFactory.Options();

       bmpFactoryOptions.inJustDecodeBounds = true;

       Bitmap bitmap;

       int heightRatio = (int)Math.ceil(bmpFactoryOptions.outHeight/(float)height);

       int widthRatio = (int)Math.ceil(bmpFactoryOptions.outWidth/(float)width);

       if (heightRatio > 1 || widthRatio > 1)

       {

        if (heightRatio > widthRatio)

        {

         bmpFactoryOptions.inSampleSize = heightRatio;

        } else {

         bmpFactoryOptions.inSampleSize = widthRatio; 

        }

       }

       bmpFactoryOptions.inJustDecodeBounds = false;

       bitmap = BitmapFactory.decodeByteArray(file, 0, file.length, bmpFactoryOptions);

    return bitmap;

   }

public static Bitmap scaleDownBitmap(Bitmap photo, int newHeight, Context context) {

    final float densityMultiplier = context.getResources().getDisplayMetrics().density;        

    int h= (int) (newHeight*densityMultiplier);

    int w= (int) (h * photo.getWidth()/((double) photo.getHeight()));

    photo=Bitmap.createScaledBitmap(photo, w, h, true);

    return photo;

    }

} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T21:10:09.797

根据 LogCat 和您的代码，看起来 profileMap.get(String) 返回 null ，然后将其传递给 Base64。Base64（显然）无法处理空参数。

# sql - sql聚合案例查询

> ID：11977223
> 
> 赞同：0
> 
> 时间：2012-08-15T21:01:51.437
> 
> 标签：sql, aggregate

我有一行查询来获取过去 24 小时内每小时的红色、黄色、绿色和青色项目的总和。查询返回正确的结果。但是可以简化吗？提前致谢。

```
Set statistics io on;
DECLARE @currentTimeInMs bigint = 398244649728; -- input parameter
DECLARE @oneHourInMs bigint = 3600000; -- 1 hour = 60 mins = 3600 secs = 3600000 msecs
DECLARE @h24 bigint = @currentTimeInMs

DECLARE @h00 bigint = @h24 - (@oneHourInMs * 24)
DECLARE @h01 bigint = @h24 - (@oneHourInMs * 23)
DECLARE @h02 bigint = @h24 - (@oneHourInMs * 22)
DECLARE @h03 bigint = @h24 - (@oneHourInMs * 21)
DECLARE @h04 bigint = @h24 - (@oneHourInMs * 20)
DECLARE @h05 bigint = @h24 - (@oneHourInMs * 19)
DECLARE @h06 bigint = @h24 - (@oneHourInMs * 18)
DECLARE @h07 bigint = @h24 - (@oneHourInMs * 17)
DECLARE @h08 bigint = @h24 - (@oneHourInMs * 16)
DECLARE @h09 bigint = @h24 - (@oneHourInMs * 15)
DECLARE @h10 bigint = @h24 - (@oneHourInMs * 14)
DECLARE @h11 bigint = @h24 - (@oneHourInMs * 13)
DECLARE @h12 bigint = @h24 - (@oneHourInMs * 12)
DECLARE @h13 bigint = @h24 - (@oneHourInMs * 11)
DECLARE @h14 bigint = @h24 - (@oneHourInMs * 10)
DECLARE @h15 bigint = @h24 - (@oneHourInMs * 9)
DECLARE @h16 bigint = @h24 - (@oneHourInMs * 8)
DECLARE @h17 bigint = @h24 - (@oneHourInMs * 7)
DECLARE @h18 bigint = @h24 - (@oneHourInMs * 6)
DECLARE @h19 bigint = @h24 - (@oneHourInMs * 5)
DECLARE @h20 bigint = @h24 - (@oneHourInMs * 4)
DECLARE @h21 bigint = @h24 - (@oneHourInMs * 3)
DECLARE @h22 bigint = @h24 - (@oneHourInMs * 2)
DECLARE @h23 bigint = @h24 - (@oneHourInMs * 1)

SELECT @currentTimeInMs AS CurrentTimeInMs,
-- H00
    SUM(CASE 
        WHEN @h00 <= AnnounceStartTime AND AnnounceStartTime < @h01 AND Kind=0 AND (Severity=0x400)
        THEN 1 ELSE 0
        END) AS 'H00Red',
    SUM(CASE 
        WHEN @h00 <= AnnounceStartTime AND AnnounceStartTime < @h01 AND Kind=0 AND (Severity=0x200)
        THEN 1 ELSE 0
        END) AS 'H00Yellow',
    SUM(CASE 
        WHEN @h00 <= AnnounceStartTime AND AnnounceStartTime < @h01 AND Kind=0 AND (Severity=0x100)
        THEN 1 ELSE 0
        END) AS 'H00Green',
    SUM(CASE 
        WHEN @h00 <= AnnounceStartTime AND AnnounceStartTime < @h01 AND Kind=1
        THEN 1 ELSE 0
        END) AS 'H00Cyan',
-- H01
    SUM(CASE 
        WHEN @h01 <= AnnounceStartTime AND AnnounceStartTime < @h02 AND Kind=0 AND (Severity=0x400)
        THEN 1 ELSE 0
        END) AS 'H01Red',
    SUM(CASE 
        WHEN @h01 <= AnnounceStartTime AND AnnounceStartTime < @h02 AND Kind=0 AND (Severity=0x200)
        THEN 1 ELSE 0
        END) AS 'H01Yellow',
    SUM(CASE 
        WHEN @h01 <= AnnounceStartTime AND AnnounceStartTime < @h02 AND Kind=0 AND (Severity=0x100)
        THEN 1 ELSE 0
        END) AS 'H01Green',
    SUM(CASE 
        WHEN @h01 <= AnnounceStartTime AND AnnounceStartTime < @h02 AND Kind=1
        THEN 1 ELSE 0
        END) AS 'H01Cyan',
-- H02
    SUM(CASE 
        WHEN @h02 <= AnnounceStartTime AND AnnounceStartTime < @h03 AND Kind=0 AND (Severity=0x400)
        THEN 1 ELSE 0
        END) AS 'H02Red',
    SUM(CASE 
        WHEN @h02 <= AnnounceStartTime AND AnnounceStartTime < @h03 AND Kind=0 AND (Severity=0x200)
        THEN 1 ELSE 0
        END) AS 'H02Yellow',
    SUM(CASE 
        WHEN @h02 <= AnnounceStartTime AND AnnounceStartTime < @h03 AND Kind=0 AND (Severity=0x100)
        THEN 1 ELSE 0
        END) AS 'H02Green',
    SUM(CASE 
        WHEN @h02 <= AnnounceStartTime AND AnnounceStartTime < @h03 AND Kind=1
        THEN 1 ELSE 0
        END) AS 'H02Cyan',
-- H03
    SUM(CASE 
        WHEN @h03 <= AnnounceStartTime AND AnnounceStartTime < @h04 AND Kind=0 AND (Severity=0x400)
        THEN 1 ELSE 0
        END) AS 'H03Red',
    SUM(CASE 
        WHEN @h03 <= AnnounceStartTime AND AnnounceStartTime < @h04 AND Kind=0 AND (Severity=0x200)
        THEN 1 ELSE 0
        END) AS 'H03Yellow',
    SUM(CASE 
        WHEN @h03 <= AnnounceStartTime AND AnnounceStartTime < @h04 AND Kind=0 AND (Severity=0x100)
        THEN 1 ELSE 0
        END) AS 'H03Green',
    SUM(CASE 
        WHEN @h03 <= AnnounceStartTime AND AnnounceStartTime < @h04 AND Kind=1
        THEN 1 ELSE 0
        END) AS 'H03Cyan',
-- H04
    SUM(CASE 
        WHEN @h04 <= AnnounceStartTime AND AnnounceStartTime < @h05 AND Kind=0 AND (Severity=0x400)
        THEN 1 ELSE 0
        END) AS 'H04Red',
    SUM(CASE 
        WHEN @h04 <= AnnounceStartTime AND AnnounceStartTime < @h05 AND Kind=0 AND (Severity=0x200)
        THEN 1 ELSE 0
        END) AS 'H04Yellow',
    SUM(CASE 
        WHEN @h04 <= AnnounceStartTime AND AnnounceStartTime < @h05 AND Kind=0 AND (Severity=0x100)
        THEN 1 ELSE 0
        END) AS 'H04Green',
    SUM(CASE 
        WHEN @h04 <= AnnounceStartTime AND AnnounceStartTime < @h05 AND Kind=1
        THEN 1 ELSE 0
        END) AS 'H04Cyan',
-- H05
    SUM(CASE 
        WHEN @h05 <= AnnounceStartTime AND AnnounceStartTime < @h06 AND Kind=0 AND (Severity=0x400)
        THEN 1 ELSE 0
        END) AS 'H05Red',
    SUM(CASE 
        WHEN @h05 <= AnnounceStartTime AND AnnounceStartTime < @h06 AND Kind=0 AND (Severity=0x200)
        THEN 1 ELSE 0
        END) AS 'H05Yellow',
    SUM(CASE 
        WHEN @h05 <= AnnounceStartTime AND AnnounceStartTime < @h06 AND Kind=0 AND (Severity=0x100)
        THEN 1 ELSE 0
        END) AS 'H05Green',
    SUM(CASE 
        WHEN @h05 <= AnnounceStartTime AND AnnounceStartTime < @h06 AND Kind=1
        THEN 1 ELSE 0
        END) AS 'H05Cyan',
-- H06
    SUM(CASE 
        WHEN @h06 <= AnnounceStartTime AND AnnounceStartTime < @h07 AND Kind=0 AND (Severity=0x400)
        THEN 1 ELSE 0
        END) AS 'H06Red',
    SUM(CASE 
        WHEN @h06 <= AnnounceStartTime AND AnnounceStartTime < @h07 AND Kind=0 AND (Severity=0x200)
        THEN 1 ELSE 0
        END) AS 'H06Yellow',
    SUM(CASE 
        WHEN @h06 <= AnnounceStartTime AND AnnounceStartTime < @h07 AND Kind=0 AND (Severity=0x100)
        THEN 1 ELSE 0
        END) AS 'H06Green',
    SUM(CASE 
        WHEN @h06 <= AnnounceStartTime AND AnnounceStartTime < @h07 AND Kind=1
        THEN 1 ELSE 0
        END) AS 'H06Cyan',
-- H07
    SUM(CASE 
        WHEN @h07 <= AnnounceStartTime AND AnnounceStartTime < @h08 AND Kind=0 AND (Severity=0x400)
        THEN 1 ELSE 0
        END) AS 'H07Red',
    SUM(CASE 
        WHEN @h07 <= AnnounceStartTime AND AnnounceStartTime < @h08 AND Kind=0 AND (Severity=0x200)
        THEN 1 ELSE 0
        END) AS 'H07Yellow',
    SUM(CASE 
        WHEN @h07 <= AnnounceStartTime AND AnnounceStartTime < @h08 AND Kind=0 AND (Severity=0x100)
        THEN 1 ELSE 0
        END) AS 'H07Green',
    SUM(CASE 
        WHEN @h07 <= AnnounceStartTime AND AnnounceStartTime < @h08 AND Kind=1
        THEN 1 ELSE 0
        END) AS 'H07Cyan',
-- H08
    SUM(CASE 
        WHEN @h08 <= AnnounceStartTime AND AnnounceStartTime < @h09 AND Kind=0 AND (Severity=0x400)
        THEN 1 ELSE 0
        END) AS 'H08Red',
    SUM(CASE 
        WHEN @h08 <= AnnounceStartTime AND AnnounceStartTime < @h09 AND Kind=0 AND (Severity=0x200)
        THEN 1 ELSE 0
        END) AS 'H08Yellow',
    SUM(CASE 
        WHEN @h08 <= AnnounceStartTime AND AnnounceStartTime < @h09 AND Kind=0 AND (Severity=0x100)
        THEN 1 ELSE 0
        END) AS 'H08Green',
    SUM(CASE 
        WHEN @h08 <= AnnounceStartTime AND AnnounceStartTime < @h09 AND Kind=1
        THEN 1 ELSE 0
        END) AS 'H08Cyan',
-- H09
    SUM(CASE 
        WHEN @h09 <= AnnounceStartTime AND AnnounceStartTime < @h10 AND Kind=0 AND (Severity=0x400)
        THEN 1 ELSE 0
        END) AS 'H09Red',
    SUM(CASE 
        WHEN @h09 <= AnnounceStartTime AND AnnounceStartTime < @h10 AND Kind=0 AND (Severity=0x200)
        THEN 1 ELSE 0
        END) AS 'H09Yellow',
    SUM(CASE 
        WHEN @h09 <= AnnounceStartTime AND AnnounceStartTime < @h10 AND Kind=0 AND (Severity=0x100)
        THEN 1 ELSE 0
        END) AS 'H09Green',
    SUM(CASE 
        WHEN @h09 <= AnnounceStartTime AND AnnounceStartTime < @h10 AND Kind=1
        THEN 1 ELSE 0
        END) AS 'H09Cyan',
-- H10
    SUM(CASE 
        WHEN @h10 <= AnnounceStartTime AND AnnounceStartTime < @h11 AND Kind=0 AND (Severity=0x400)
        THEN 1 ELSE 0
        END) AS 'H10Red',
    SUM(CASE 
        WHEN @h10 <= AnnounceStartTime AND AnnounceStartTime < @h11 AND Kind=0 AND (Severity=0x200)
        THEN 1 ELSE 0
        END) AS 'H10Yellow',
    SUM(CASE 
        WHEN @h10 <= AnnounceStartTime AND AnnounceStartTime < @h11 AND Kind=0 AND (Severity=0x100)
        THEN 1 ELSE 0
        END) AS 'H10Green',
    SUM(CASE 
        WHEN @h10 <= AnnounceStartTime AND AnnounceStartTime < @h11 AND Kind=1
        THEN 1 ELSE 0
        END) AS 'H10Cyan',
-- H11
    SUM(CASE 
        WHEN @h11 <= AnnounceStartTime AND AnnounceStartTime < @h12 AND Kind=0 AND (Severity=0x400)
        THEN 1 ELSE 0
        END) AS 'H11Red',
    SUM(CASE 
        WHEN @h11 <= AnnounceStartTime AND AnnounceStartTime < @h12 AND Kind=0 AND (Severity=0x200)
        THEN 1 ELSE 0
        END) AS 'H11Yellow',
    SUM(CASE 
        WHEN @h11 <= AnnounceStartTime AND AnnounceStartTime < @h12 AND Kind=0 AND (Severity=0x100)
        THEN 1 ELSE 0
        END) AS 'H11Green',
    SUM(CASE 
        WHEN @h11 <= AnnounceStartTime AND AnnounceStartTime < @h12 AND Kind=1
        THEN 1 ELSE 0
        END) AS 'H11Cyan',
-- H12
    SUM(CASE 
        WHEN @h12 <= AnnounceStartTime AND AnnounceStartTime < @h13 AND Kind=0 AND (Severity=0x400)
        THEN 1 ELSE 0
        END) AS 'H12Red',
    SUM(CASE 
        WHEN @h12 <= AnnounceStartTime AND AnnounceStartTime < @h13 AND Kind=0 AND (Severity=0x200)
        THEN 1 ELSE 0
        END) AS 'H12Yellow',
    SUM(CASE 
        WHEN @h12 <= AnnounceStartTime AND AnnounceStartTime < @h13 AND Kind=0 AND (Severity=0x100)
        THEN 1 ELSE 0
        END) AS 'H12Green',
    SUM(CASE 
        WHEN @h12 <= AnnounceStartTime AND AnnounceStartTime < @h13 AND Kind=1
        THEN 1 ELSE 0
        END) AS 'H12Cyan',
-- H13
    SUM(CASE 
        WHEN @h13 <= AnnounceStartTime AND AnnounceStartTime < @h14 AND Kind=0 AND (Severity=0x400)
        THEN 1 ELSE 0
        END) AS 'H13Red',
    SUM(CASE 
        WHEN @h13 <= AnnounceStartTime AND AnnounceStartTime < @h14 AND Kind=0 AND (Severity=0x200)
        THEN 1 ELSE 0
        END) AS 'H13Yellow',
    SUM(CASE 
        WHEN @h13 <= AnnounceStartTime AND AnnounceStartTime < @h14 AND Kind=0 AND (Severity=0x100)
        THEN 1 ELSE 0
        END) AS 'H13Green',
    SUM(CASE 
        WHEN @h13 <= AnnounceStartTime AND AnnounceStartTime < @h14 AND Kind=1
        THEN 1 ELSE 0
        END) AS 'H13Cyan',
-- H14
    SUM(CASE 
        WHEN @h14 <= AnnounceStartTime AND AnnounceStartTime < @h15 AND Kind=0 AND (Severity=0x400)
        THEN 1 ELSE 0
        END) AS 'H14Red',
    SUM(CASE 
        WHEN @h14 <= AnnounceStartTime AND AnnounceStartTime < @h15 AND Kind=0 AND (Severity=0x200)
        THEN 1 ELSE 0
        END) AS 'H14Yellow',
    SUM(CASE 
        WHEN @h14 <= AnnounceStartTime AND AnnounceStartTime < @h15 AND Kind=0 AND (Severity=0x100)
        THEN 1 ELSE 0
        END) AS 'H14Green',
    SUM(CASE 
        WHEN @h14 <= AnnounceStartTime AND AnnounceStartTime < @h15 AND Kind=1
        THEN 1 ELSE 0
        END) AS 'H14Cyan',
-- H15
    SUM(CASE 
        WHEN @h15 <= AnnounceStartTime AND AnnounceStartTime < @h16 AND Kind=0 AND (Severity=0x400)
        THEN 1 ELSE 0
        END) AS 'H15Red',
    SUM(CASE 
        WHEN @h15 <= AnnounceStartTime AND AnnounceStartTime < @h16 AND Kind=0 AND (Severity=0x200)
        THEN 1 ELSE 0
        END) AS 'H15Yellow',
    SUM(CASE 
        WHEN @h15 <= AnnounceStartTime AND AnnounceStartTime < @h16 AND Kind=0 AND (Severity=0x100)
        THEN 1 ELSE 0
        END) AS 'H15Green',
    SUM(CASE 
        WHEN @h15 <= AnnounceStartTime AND AnnounceStartTime < @h16 AND Kind=1
        THEN 1 ELSE 0
        END) AS 'H15Cyan',
-- H16
    SUM(CASE 
        WHEN @h16 <= AnnounceStartTime AND AnnounceStartTime < @h17 AND Kind=0 AND (Severity=0x400)
        THEN 1 ELSE 0
        END) AS 'H16Red',
    SUM(CASE 
        WHEN @h16 <= AnnounceStartTime AND AnnounceStartTime < @h17 AND Kind=0 AND (Severity=0x200)
        THEN 1 ELSE 0
        END) AS 'H16Yellow',
    SUM(CASE 
        WHEN @h16 <= AnnounceStartTime AND AnnounceStartTime < @h17 AND Kind=0 AND (Severity=0x100)
        THEN 1 ELSE 0
        END) AS 'H16Green',
    SUM(CASE 
        WHEN @h16 <= AnnounceStartTime AND AnnounceStartTime < @h17 AND Kind=1
        THEN 1 ELSE 0
        END) AS 'H16Cyan',
-- H17
    SUM(CASE 
        WHEN @h17 <= AnnounceStartTime AND AnnounceStartTime < @h18 AND Kind=0 AND (Severity=0x400)
        THEN 1 ELSE 0
        END) AS 'H17Red',
    SUM(CASE 
        WHEN @h17 <= AnnounceStartTime AND AnnounceStartTime < @h18 AND Kind=0 AND (Severity=0x200)
        THEN 1 ELSE 0
        END) AS 'H17Yellow',
    SUM(CASE 
        WHEN @h17 <= AnnounceStartTime AND AnnounceStartTime < @h18 AND Kind=0 AND (Severity=0x100)
        THEN 1 ELSE 0
        END) AS 'H17Green',
    SUM(CASE 
        WHEN @h17 <= AnnounceStartTime AND AnnounceStartTime < @h18 AND Kind=1
        THEN 1 ELSE 0
        END) AS 'H17Cyan',
-- H18
    SUM(CASE 
        WHEN @h18 <= AnnounceStartTime AND AnnounceStartTime < @h19 AND Kind=0 AND (Severity=0x400)
        THEN 1 ELSE 0
        END) AS 'H18Red',
    SUM(CASE 
        WHEN @h18 <= AnnounceStartTime AND AnnounceStartTime < @h19 AND Kind=0 AND (Severity=0x200)
        THEN 1 ELSE 0
        END) AS 'H18Yellow',
    SUM(CASE 
        WHEN @h18 <= AnnounceStartTime AND AnnounceStartTime < @h19 AND Kind=0 AND (Severity=0x100)
        THEN 1 ELSE 0
        END) AS 'H18Green',
    SUM(CASE 
        WHEN @h18 <= AnnounceStartTime AND AnnounceStartTime < @h19 AND Kind=1
        THEN 1 ELSE 0
        END) AS 'H18Cyan',
-- H19
    SUM(CASE 
        WHEN @h19 <= AnnounceStartTime AND AnnounceStartTime < @h20 AND Kind=0 AND (Severity=0x400)
        THEN 1 ELSE 0
        END) AS 'H19Red',
    SUM(CASE 
        WHEN @h19 <= AnnounceStartTime AND AnnounceStartTime < @h20 AND Kind=0 AND (Severity=0x200)
        THEN 1 ELSE 0
        END) AS 'H19Yellow',
    SUM(CASE 
        WHEN @h19 <= AnnounceStartTime AND AnnounceStartTime < @h20 AND Kind=0 AND (Severity=0x100)
        THEN 1 ELSE 0
        END) AS 'H19Green',
    SUM(CASE 
        WHEN @h19 <= AnnounceStartTime AND AnnounceStartTime < @h20 AND Kind=1
        THEN 1 ELSE 0
        END) AS 'H19Cyan',
-- H20
    SUM(CASE 
        WHEN @h20 <= AnnounceStartTime AND AnnounceStartTime < @h21 AND Kind=0 AND (Severity=0x400)
        THEN 1 ELSE 0
        END) AS 'H20Red',
    SUM(CASE 
        WHEN @h20 <= AnnounceStartTime AND AnnounceStartTime < @h21 AND Kind=0 AND (Severity=0x200)
        THEN 1 ELSE 0
        END) AS 'H20Yellow',
    SUM(CASE 
        WHEN @h20 <= AnnounceStartTime AND AnnounceStartTime < @h21 AND Kind=0 AND (Severity=0x100)
        THEN 1 ELSE 0
        END) AS 'H20Green',
    SUM(CASE 
        WHEN @h20 <= AnnounceStartTime AND AnnounceStartTime < @h21 AND Kind=1
        THEN 1 ELSE 0
        END) AS 'H20Cyan',
-- H21
    SUM(CASE 
        WHEN @h21 <= AnnounceStartTime AND AnnounceStartTime < @h22 AND Kind=0 AND (Severity=0x400)
        THEN 1 ELSE 0
        END) AS 'H21Red',
    SUM(CASE 
        WHEN @h21 <= AnnounceStartTime AND AnnounceStartTime < @h22 AND Kind=0 AND (Severity=0x200)
        THEN 1 ELSE 0
        END) AS 'H21Yellow',
    SUM(CASE 
        WHEN @h21 <= AnnounceStartTime AND AnnounceStartTime < @h22 AND Kind=0 AND (Severity=0x100)
        THEN 1 ELSE 0
        END) AS 'H21Green',
    SUM(CASE 
        WHEN @h21 <= AnnounceStartTime AND AnnounceStartTime < @h22 AND Kind=1
        THEN 1 ELSE 0
        END) AS 'H21Cyan',
-- H22
    SUM(CASE 
        WHEN @h22 <= AnnounceStartTime AND AnnounceStartTime < @h23 AND Kind=0 AND (Severity=0x400)
        THEN 1 ELSE 0
        END) AS 'H22Red',
    SUM(CASE 
        WHEN @h22 <= AnnounceStartTime AND AnnounceStartTime < @h23 AND Kind=0 AND (Severity=0x200)
        THEN 1 ELSE 0
        END) AS 'H22Yellow',
    SUM(CASE 
        WHEN @h22 <= AnnounceStartTime AND AnnounceStartTime < @h23 AND Kind=0 AND (Severity=0x100)
        THEN 1 ELSE 0
        END) AS 'H22Green',
    SUM(CASE 
        WHEN @h22 <= AnnounceStartTime AND AnnounceStartTime < @h23 AND Kind=1
        THEN 1 ELSE 0
        END) AS 'H22Cyan',
-- H23
    SUM(CASE 
        WHEN @h23 <= AnnounceStartTime AND AnnounceStartTime < @h24 AND Kind=0 AND (Severity=0x400)
        THEN 1 ELSE 0
        END) AS 'H23Red',
    SUM(CASE 
        WHEN @h23 <= AnnounceStartTime AND AnnounceStartTime < @h24 AND Kind=0 AND (Severity=0x200)
        THEN 1 ELSE 0
        END) AS 'H23Yellow',
    SUM(CASE 
        WHEN @h23 <= AnnounceStartTime AND AnnounceStartTime < @h24 AND Kind=0 AND (Severity=0x100)
        THEN 1 ELSE 0
        END) AS 'H23Green',
    SUM(CASE 
        WHEN @h23 <= AnnounceStartTime AND AnnounceStartTime < @h24 AND Kind=1
        THEN 1 ELSE 0
        END) AS 'H23Cyan'   

FROM Alert A
WHERE A.AnnounceStartTime BETWEEN @h00 AND @h24 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T21:53:25.587

这是一种可以简化它的方法。您可以为每个元素创建标志，然后将它们相乘：

```
select sum(isHH00*isRed) as HH00Red,
       sum(isHH00*isYellow) as HH00Yellow,
       . . .
from (select a.*,
             (case when Kind=0 AND (Severity=0x400) then 1 else 0 end) as IsRed,
             . . .
             (case when @h00 <= AnnounceStartTime AND AnnounceStartTime < @h01
                   then 1 else 0
              end) as isHH00,
             . . .
      from Alert a
     ) a
where . . . 
```

您的另一种选择是通过执行以下操作对查询进行分组：

```
select datepart(hh, AnnounceStartTime), kind, Severity, count(*) as cnt
from Alert a
group by datepart(hh, AnnounceStartTime), kind, Severity 
```

然后使用 PIVOT 语句或 Excel 等其他工具将其转换为您需要的数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-15T22:57:33.867

我将从创建一个临时汇总表开始：

```
declare
  @one_hour_in_ms    int      ,
  @dtNow             datetime ,
  @@dtNowLess24Hours datetime

set @one_hour_in_ms   = 60 * 60 * 1000
 set @dtNow            = current_timestamp        -- current date and time
 set @dtNowLess24Hours = dateadd(hour,-24,@dtNow)

create table #work
(
  period_id int not null primary key clustered ,
  red       int not null ,
  yellow    int not null ,
  green     int not null ,
  cyan      int not null ,
)

insert #work ( period_id , red , yellow , green , cyan )
select period_id = datediff(ms,@startofPeriod,a.AnnounceStartTime) / @one_hour_in_ms , -- creates period id with the domain 0-23 indicating the hour offset within the reporting period
       red       = sum( case when a.Kind = 0 and a.Severity = 0x400 then 1 else 0 end ) ,
       yellow    = sum( case when a.Kind = 0 and a.Severity = 0x200 then 1 else 0 end ) ,
       green     = sum( case when a.Kind = 0 and a.Severity = 0x100 then 1 else 0 end ) ,
       cyan      = sum( case when a.Kind = 1                        then 1 else 0 end )
from Alert a
where a.AnnounceStartTime >= @startOfPeriod
  and a.AnnounceStartTime <  @dtNow
group by datediff(ms,@startofPeriod,a.AnnounceStartTime) / @one_hour_in_ms 
```

上面创建了一个最多包含 24 行的临时表，在 24 小时报告期间每小时一个。当然，如果该期间没有记录数据，则不会生成任何行。

如果这足够，您可以将其作为多行结果集返回，并让客户端将行旋转为列。否则，您需要进行*表格旋转*。一种与实现无关的方法，一种不依赖于`pivot`的方法是这样做：

```
select dtFrom  = @dtNowLess24Hours ,
       dtThru  = @dtNow            ,
       H00_Red = sum( p00.red ) , H00_Yellow = sum( p00.yellow ) , H00_Green = sum( p00.green ) , H00_Cyan = sum( p00.cyan ) ,
       H01_Red = sum( p01.red ) , H01_Yellow = sum( p01.yellow ) , H01_Green = sum( p01.green ) , H01_Cyan = sum( p01.cyan ) ,
       ...
       H23_Red = sum( p23.red ) , H23_Yellow = sum( p23.yellow ) , H23_Green = sum( p23.green ) , H23_Cyan = sum( p23.cyan )
from       ( select * from #work where period_id = 0  ) p00
cross join ( select * from #work where period_id = 1  ) p01
...
cross join ( select * from #work where period_id = 23 ) p23 
```

如果你的系统支持`pivot`，那么整个过程就简单多了。

# coding-style - 在将变量与文字进行比较时，应该将文字放在等于“==”运算符的左侧还是右侧？

> ID：11977224
> 
> 赞同：3
> 
> 时间：2012-08-15T21:01:51.407
> 
> 标签：coding-style

在学习编码时，我在检查变量的值时被教导以下风格：

```
int x;
Object *object;
...
if(x == 7) { ... }
if(object == NULL) { ... } 
```

然而，现在我在这个领域，我遇到过不止一位同事发誓要在`if`语句中切换 lhs 和 rhs 的方法：

```
if(7 == x) { ... }
if(NULL == object) { ... } 
```

原因是，如果您不小心键入`=`而不是`==`，那么代码将在编译时失败。由于不习惯这种风格，阅读`7 == x`对我来说很困难，减慢了我对他们代码的理解。

看来如果我采用这种风格，我可能会在未来的某一天免于调试`x = 7`错误，但同时，每次有人阅读我的代码时，我可能是在浪费他们的时间，因为我担心语法不正统。

这种`7 == x`风格在行业中是否普遍接受和可读，或者这只是我同事的个人喜好？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T21:06:46.293

> 原因是如果您不小心键入 = 而不是 ==，那么代码将在编译时失败。

真的。另一方面，我相信*现代*C 和 C++ 编译器（我假设您正在使用其中一种语言？您还没有说过）如果您这样做，会警告您。

你用你正在使用的编译器试过吗？如果默认情况下它不这样做，请查看是否有可以用来引发它的标志 - 理想情况下使其成为*错误*而不仅仅是警告。

例如，使用 Microsoft C 编译器，我得到：

```
cl /Wall Test.c
test.c(3) : warning C4706: assignment within conditional expression 
```

这很清楚，IMO。（不可否认，*默认*警告设置不会发现它。）

> 由于不习惯这种风格，阅读 7 == x 对我来说很困难，这会减慢我对他们代码的理解。

确实。你的方法是更自然的风格，应该使用（IMO），除非你*真的*在处理一个没有发现这是一个潜在问题的编译器（并且你别无选择使用那个编译器）。

编辑：请注意，这在所有语言中都不是问题——甚至不是所有类 C 语言。

例如，尽管 Java 和 C# 都有类似的`if`构造，但两者中的条件表达式都需要隐式转换为布尔值。虽然赋值部分可以编译，但第一个示例中的表达式类型是`int`，它不能隐式转换为任何一种语言的相关布尔类型，从而导致编译时错误。您仍然遇到问题的罕见情况是：

```
if (foo == true) 
```

其中，如果错字：

```
if (foo = true) 
```

会编译并做错事。MS C# 编译器甚至会警告您，尽管通常最好只使用

```
if (foo) 
```

或者

```
if (!foo) 
```

在可能的情况。剩下的就是：

```
if (x == MethodReturningBool()) 
```

对比

```
if (MethodReturningBool() == x) 
```

which is still pretty rare, and there's still a warning for it in the MS C# compiler (and probably in some Java compilers).

# asp.net - 从 ASP.net Web 应用程序扫描文档

> ID：11977226
> 
> 赞同：4
> 
> 时间：2012-08-15T21:01:59.277
> 
> 标签：asp.net, c#-4.0, image-scanner, leadtools-sdk

我有一个 ASP.Net C# 4.0 Web 应用程序

我需要为我的用户添加扫描功能。这就是我想要在我的网络应用程序上实现的目标

1.  用户点击一个按钮
2.  在连接到客户端系统的扫描设备中打开一个带有文档预览的窗口
3.  用户确认扫描
4.  这会将扫描的文档以 jpg/pdf 格式保存在服务器上
5.  然后对文档进行 OCR

任何人都可以提出一种方法来实现这一目标。

我读到了这个[https://www.leadtools.com/sdk/engine/imaging](https://www.leadtools.com/sdk/engine/imaging)不确定这能起到多大的作用。任何人都可以提出一种最好的方法来完成这项工作。

谢谢

# 更新

[尝试了来自https://www.leadtools.com/support/forum/posts/m28036-Re--Scan-and-Upload-v16--NET-with-Caspol-exe-deployment](https://www.leadtools.com/support/forum/posts/m28036-Re--Scan-and-Upload-v16--NET-with-Caspol-exe-deployment)的Leadtools作为 LEAD 支持建议，但它丢失了参考不知道在哪里以及如何获得这些参考![在此处输入图像描述](../Images/868b86abcb81626862a21530f84c2941.png)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-26T07:44:22.123

HaBo，这是领导支持。既然您提到了我们的 LEADTOOLS 工具包，那么您的问题的答案是肯定的。我们的工具包可用于实现 tgolisch 提到的两种方法中的任何一种。

对于单击一次方法，您只需使用包含 Twain 支持的 Windows 窗体控件并将您的应用程序打包以进行 ClickOnce 部署。例如，这是在这个演示项目中完成的： [LEADTOOLS ClickOnce Demos](https://www.leadtools.com/demos/net-click-once)

对于自定义控制方法，请参阅我们论坛上执行[扫描和上传的示例代码项目](https://www.leadtools.com/support/forum/posts/m28036-Re--Scan-and-Upload-v16--NET-with-Caspol-exe-deployment)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2020-06-16T12:20:46.480

解决方案在这里：

1.  在 ASP.Net/Core 项目中，您发送消息以调用 winform 项目：

    ```
     var start = function () {
            var i = 0;
            var wsImpl = window.WebSocket || window.MozWebSocket;
            window.ws = new wsImpl('ws://localhost:8181/');
            ws.onmessage = function (e) {
                $('#submit').hide();
                $('#scanBtn').hide();
                $('.loader').show();
                if (typeof e.data === "string") {
                    //IF Received Data is String
                }
                else if (e.data instanceof ArrayBuffer) {
                    //IF Received Data is ArrayBuffer
                }
                else if (e.data instanceof Blob) {
                    i++;
                    var f = e.data;
                    f.name = "File" + i;
                    storedFiles.push(f);
                    formdata.append(f.name, f);
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        var html = "<div class=\"col-sm-2 text-center\" 
                    style=\"border: 1px solid black; margin-left: 2px;\"><img 
                    height=\"200px\" width=\"200px\" src=\"" + e.target.result + "\" 
                    data-file='" + f.name + "' class='selFile' title='Click to 
                    remove'><br/>" + i + "</div>";
                        selDiv.append(html);
                        $('#submit').show();
                        $('#scanBtn').show();
                        $('.loader').hide();
                    }
                    reader.readAsDataURL(f);
                }
            };
            ws.onopen = function () {
                //Do whatever u want when connected succesfully
            };
            ws.onclose = function () {
                $('.dalert').modal('show');
            };
        }
        window.onload = start;
        function scanImage() {
            ws.send("1100");
        }; 
    ```

[https://javascript.info/websocket](https://javascript.info/websocket)

2.  在 Winforms 项目中，您扫描文档并将图形数据发送回 Asp.Net/Core 项目：

    公共部分类Form1：Form { ImageCodecInfo _tiffCodecInfo; TwainSession _twain; 布尔_stopScan；布尔 _loadingCaps; 列出所有套接字；WebSocketServer 服务器；公共 Form1() { InitializeComponent();

    ```
     if (NTwain.PlatformInfo.Current.IsApp64Bit)
    {
        Text = Text + " (64bit)";
    }
    else
    {
        Text = Text + " (32bit)";
    }
    foreach (var enc in ImageCodecInfo.GetImageEncoders())
    {
        if (enc.MimeType == "image/tiff") { _tiffCodecInfo = enc; break; }
    }

    this.WindowState = FormWindowState.Minimized;
    this.ShowInTaskbar = false;

    allSockets = new List<IWebSocketConnection>();
    server = new WebSocketServer("ws://0.0.0.0:8181");
    server.Start(socket =>
    {
        socket.OnOpen = () =>
        {
            Console.WriteLine("Open!");
            allSockets.Add(socket);
        };
        socket.OnClose = () =>
        {
            Console.WriteLine("Close!");
            allSockets.Remove(socket);
        };
        socket.OnMessage = message =>
        {
            if (message == "1100")
            {
                this.Invoke(new Action(()=> {
                    this.WindowState = FormWindowState.Normal;
                }));
            }
        };
    }); 
    ```

    }

链接到项目。

[https://github.com/mgrit/ScanAppForWeb](https://github.com/mgriit/ScanAppForWeb)

您可以根据需要重新制作此项目。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T21:12:28.800

Web 浏览器无权使用此类系统设备（主要安全问题）。有两种常见的解决方法：

1.  制作一个自定义控件以在您的浏览器中运行（flash、silverlight、java 小程序）。
2.  制作用户从您的页面启动的“单击一次部署应用程序”。

这两种方法都会通过 Web 服务或 WCF 等将数据发送回您的服务器。

# c++ - 运算符重载中的错误答案

> ID：11977228
> 
> 赞同：0
> 
> 时间：2012-08-15T21:02:07.583
> 
> 标签：c++

我刚刚学习了运算符重载，我想尝试制作一个表示复数的对象。我写了以下内容：

```
#include <iostream>

using namespace std;

class complexNumber
{
    public:
        double re, im;
        complexNumber(){}
        complexNumber(double a, double b)
        {
            re = a;
            im = b;
        }
        complexNumber operator+ (complexNumber b)
        {
            complexNumber c;
            c.re = re + b.re;
            c.im = im + b.im;
        }
        complexNumber operator- (complexNumber b)
        {
            complexNumber c;
            c.re = re - b.re;
            c.im = im - b.im;
        }
};

int main()
{
    complexNumber a(1,2);
    complexNumber b(4,6);
    complexNumber c;
    complexNumber d;

    c = a + b;
    d = a - b;

    cout << c.re << " + " << c.im << "i" << endl;
    cout << d.re << " + " << d.im << "i" << endl;
} 
```

我得到了结果：

2.44156e+253 + 6.95225e-308i

2.44156e+253 + 6.95225e-308i

关于我在这里出错的任何想法。提前致谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-08-15T21:04:03.940

您需要从函数中返回一个值。你的编译器没有警告你吗？

# java - 速率限制 s3 使用 Java API 上传

> ID：11977230
> 
> 赞同：1
> 
> 时间：2012-08-15T21:02:10.407
> 
> 标签：java, amazon-s3

我正在使用 java aws sdk 将大文件传输到 s3。目前我正在使用[TransferManager](http://docs.amazonwebservices.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/s3/transfer/TransferManager.html)类的上传方法来启用分段上传。我正在寻找一种方法来限制这些文件的传输速率，以确保我不会中断在此 CentOS 服务器上运行的其他服务。API中是否缺少我的东西，或者其他方式来实现这一点？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-27T13:49:47.453

如果没有 API 对此的支持，一种方法是将 s3 命​​令用[涓流](http://monkey.org/~marius/pages/?page=trickle)包装。

# javascript - 停止 jQuery 等高 div 计算隐藏内容

> ID：11977232
> 
> 赞同：-1
> 
> 时间：2012-08-15T21:02:13.930
> 
> 标签：javascript, jquery

我正在使用以下 jQuery 给某些 id 的`#main`, `#sidebar`,`#side-event`等高的 div。在大多数页面上，我`.hide();`用来切换网站内容部分中的信息。问题是当 JS 计算 #main div 的高度时，它也在计算所有隐藏的内容，这是我不想要的。如何更改我的代码以使高度等于最高 div，并且不包括方程式中的隐藏信息？此外，我添加了用于在页面加载时隐藏信息的代码。这是我在网站上的页面，用于引用该问题。希望有人可以帮助我解决这个问题。

[http://shadowfaxdigital.com/cdi/events/mba-essentials-business-design-workshops/](http://shadowfaxdigital.com/cdi/events/mba-essentials-business-design-workshops/)

计算高度：

```
 $("#main, #sidebar, #side-event").addClass("heights");

    var highestCol = Math.max($('#main').height(),$('#sidebar').height(), $("#side-event").height());

    $('.heights').height(highestCol); 
```

用于隐藏切换中内容的代码：

```
 //jQuery toggle
            $(".toggle_container").hide();
            $("h2.trigger").click(function(){
                $(this).toggleClass("active").next().slideToggle("slow");
            }); 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-10-22T17:48:22.973

我今天也遇到了这个问题。谷歌了很多，找到了这个线程。似乎这没有得到妥善解决，因此我发布了我的解决方案：我的问题是高度调整脚本在元素被 jQuery 成功隐藏之前计算高度，因此我将高度均衡脚本复制到 $( document).ready(function() {} );

像这样：

```
$(document).ready(function()
   {
     if ($('.sidebar').height() < $('#mainwindow').height())
   {
    var mainwindowHeight = $('#mainwindow').height();
    $(".sidebar").css('height', mainwindowHeight+8+'px');
   }
  }); 
```

这为我解决了。希望这可以帮助某人。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-15T21:12:07.053

目前尚不完全清楚您究竟在寻求什么帮助。 `.height()`将仅包括在布局中占用空间的子元素的高度。因此，隐藏的项目`.hide()`将被标记`display:none`并且不会包含在任何父元素的高度中。但是一个元素为零`opacity`或`visibility:hidden`将占用布局中的空间并将包含在父级的高度中。

在 jQuery 中，您可以通过以下方式查看是否可见：

```
$("#main").is(":visible"); 
```

或者，您可以将其直接放入选择器以仅包含可见项目：

```
$("#main:visible") 
```

因此，如果您只想在选择器中包含可见项目，则可以将代码更改为如下内容：

```
var visibleItems = $("#main:visible, #sidebar:visible, #side-event:visible");
var highestCol = Math.max.apply(this, visibleItems.map(function() {
    return $(this).height();
}).get()); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T21:12:58.197

您可以添加[可见](http://api.jquery.com/visible-selector/)选择器，这将检查元素是否具有 display:none 或 opacity:0

```
var $sfd = jQuery.noConflict();
var cols = $sfd('#main:visible, #sidebar:visible, #side-event:visible');
var maxHeight = 0;
$(cols).each(function(){
    $(this).addClass('heights');
    maxHeight = Math.max($(this).height(), maxHeight);
});

$sfd('.heights').height(maxHeight); 
```

# ruby-on-rails - Facebook Koala Gem - 注销

> ID：11977233
> 
> 赞同：1
> 
> 时间：2012-08-15T21:02:17.467
> 
> 标签：ruby-on-rails, facebook, facebook-graph-api, koala

我在使用 Koala Gem 注销时遇到问题，想知道它们是否相关。

下面是我的 Javascript 代码：

```
 <script>
    window.fbAsyncInit = function() {
      FB.init({
        appId      : '310521258992725', // App ID
        channelUrl : '//localhost:3000/channel', // Channel File
        status     : true, // check login status
        cookie     : true, // enable cookies to allow the server to access the session
        xfbml      : true  // parse XFBML
      });
      // Additional initialization code here
      // whenever the user logs in, we refresh the page

      FB.Event.subscribe('auth.login', function() {
        setTimeout('document.location.reload()',0);
      });

      FB.logout(function(response) {
        FB.Auth.setAuthResponse(null, 'unknown');
        setTimeout('document.location.reload()',0);
      });
    };

    // Load the SDK Asynchronously
    (function(d){
       var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
       if (d.getElementById(id)) {return;}
       js = d.createElement('script'); js.id = id; js.async = true;
       js.src = "//connect.facebook.net/en_US/all.js";
       ref.parentNode.insertBefore(js, ref);
     }(document));
  </script> 
```

以下是我的 Facebook 标签：

```
 <div id="fb-root"></div> 
```

我的注销代码：

```
<a href="/" onclick="FB.logout();">Logout</a> 
```

登录工作完美，我可以执行 api 调用没问题。但是，在我注销后，我收到以下错误：

```
OAuthException: Error validating access token: The session is invalid because the user logged out.  app/controllers/application_controller.rb:58: in 'fbookinvite_check' 
```

下面是我的 fbookinvite_check 代码：

```
 def fbookinvite_check
    unless @facebook_cookies.nil?
      @access_token = @facebook_cookies["access_token"]
      @graph = Koala::Facebook::GraphAPI.new(@access_token)
      if !@graph.nil? == true
        @friends = @graph.get_object("/me/friends")
      end
    end
  end 
```

问题似乎是cookie是访问令牌无效，重定向后@graph没有显示为nil。如果我刷新，则页面加载没有问题，但是当我注销时出现错误。

也许有一种方法可以在不关闭应用程序的情况下捕获@graph.get_object 错误？

任何建议将不胜感激！！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T21:13:52.703

`fbookinvite_check`是的，只需将您的开始/救援包装在您从中救援的地方`OAuthException`，然后为您的应用程序返回一些理智的东西。

你是在自问自答：

> 也许有一种方法可以在不关闭应用程序的情况下捕获@graph.get_object 错误？

将您的逻辑包装在开始/救援块中，如下所示：

```
def fbookinvite_check
  begin
    unless @facebook_cookies.nil?
      @access_token = @facebook_cookies["access_token"]
      @graph = Koala::Facebook::GraphAPI.new(@access_token)
      if !@graph.nil? == true
        @friends = @graph.get_object("/me/friends")
      end
    end
  rescue OAuthException => ex
    # handle the exception if you need to, or just ignore it if thats ok too
  end
end 
```

# search - CursorLoader 不更新 listView，但光标有正确的结果

> ID：11977235
> 
> 赞同：0
> 
> 时间：2012-08-15T21:02:29.957
> 
> 标签：search, android-loadermanager, android-cursorloader

我正在为一个 pre-android 3.0 兼容的应用程序实现一个 searchView，并且正在为正确的 listView 重新加载而苦苦挣扎。我认为支持库存在一些问题，甚至可能是通过我无法使用的 onQueryTextChangedListener 的 EditText istea 上的 textChangeListener 实现的罕见实现。有什么帮助吗？

这是代码：

```
import android.content.ContentResolver;
import android.content.ContentValues;
import android.content.Intent;
import android.database.Cursor;
import android.net.Uri;
import android.os.Bundle;
import android.provider.BaseColumns;
import android.support.v4.app.FragmentTransaction;
import android.support.v4.app.ListFragment;
import android.support.v4.app.LoaderManager;
import android.support.v4.content.CursorLoader;
import android.support.v4.content.Loader;
import android.text.Editable;

import android.text.TextUtils;
import android.text.TextWatcher;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.EditText;
import android.widget.ListView;

import com.actionbarsherlock.app.SherlockFragmentActivity;
import com.actionbarsherlock.view.Menu;
import com.actionbarsherlock.view.MenuItem;
import com.actionbarsherlock.view.Window;

public class RecipesActivity extends SherlockFragmentActivity {
public static String category;
private ListMenu listMenu;
public static EditText et;

@Override
protected void onCreate(Bundle savedInstanceState) {        

    setTheme(R.style.Theme_Sherlock); 
    requestWindowFeature(Window.FEATURE_ACTION_BAR_OVERLAY);
    super.onCreate(savedInstanceState);
    setContentView(R.layout.list_activity_layout);

    getSupportActionBar().setBackgroundDrawable(getResources()
    .getDrawable(R.drawable.ab_bg_black));

    category=getIntent().getExtras().getString("category");

    FragmentTransaction ft=getSupportFragmentManager().beginTransaction();
    listMenu=new ListMenu();
    ft.add(R.id.listFragment,listMenu).commit();        
}

@Override
public boolean onCreateOptionsMenu(Menu menu) {
menu.add("Search")
    .setIcon(R.drawable.search)
    .setActionView(R.layout.collapsible_search)
    .setShowAsAction(MenuItem.SHOW_AS_ACTION_ALWAYS |                                                                                     

    MenuItem.SHOW_AS_ACTION_COLLAPSE_ACTION_VIEW);

et=(EditText)menu.getItem(0).getActionView();       
return true;
}   

public static class ListMenu extends ListFragment 
implements LoaderManager.LoaderCallbacks<Cursor> {

private String category;
private String mCurFilter;
private MyCursorAdapter adapter;    
private ContentResolver resolver; 

@Override
public View onCreateView(LayoutInflater inflater, ViewGroup container,
        Bundle savedInstanceState) {
View view = inflater.inflate(R.layout.list_layout, container, false);
return view;
}

@Override
public void onActivityCreated(Bundle savedInstanceState) {
super.onActivityCreated(savedInstanceState);

//initialization
category=getActivity().getIntent().getStringExtra("category");

setHasOptionsMenu(true);            
resolver = this.getActivity().getContentResolver();
final Cursor cursor;
String[] projection=
    {BaseColumns._ID,Recipes.NAME,Recipes.KEYWORDS,Recipes.STARRED};
if(category.equals("xxx")){
cursor = resolver.query(Recipes.CONTENT_URI_DRINKS, projection, null, null,
    Recipes.STARRED);
} else 
if(category.equals("yyy")){
cursor = resolver.query(Recipes.CONTENT_URI_HANGOVERS, projection, null, null, 
    Recipes.STARRED);
} else
{cursor = resolver.query(Recipes.CONTENT_URI_GAMES, projection, null, null, 
    Recipes.STARRED);
    }
//getActivity().getSupportLoaderManager().initLoader(0, null, this);
getLoaderManager().initLoader(0, null, this);

adapter=new MyCursorAdapter(getActivity(), cursor, true);
setListAdapter(adapter);

et.addTextChangedListener(new TextWatcher() {               
@Override
public void onTextChanged(CharSequence s, int start, int before, int count) {

String text=s.toString();
String newFilter = (String) (!TextUtils.isEmpty(text) ? text : null);
Log.i("text changed listener","ontextchanged:"+newFilter);

if (mCurFilter == null && newFilter == null){;}else
if(mCurFilter != null && mCurFilter.equals(newFilter)){;}else
{
mCurFilter = newFilter;
getLoaderManager().restartLoader(0, null, ListMenu.this);
Log.i("QueryListMenu","onQueryTextChange");
}                   
}               

@Override public void onListItemClick(ListView l, View v, int position, long id) {
Intent intent=new Intent(getActivity(),Viewer.class);
String[] projection = {Recipes.PATH };
String selection= "("+BaseColumns._ID+"="+id+")";
Cursor c=resolver.query(Recipes.getUri(category), projection, selection, null, 
    Recipes.STARRED+"DESC"+","+Recipes.NAME+" ASC");
c.moveToFirst();
String path=c.getString(c.getColumnIndex("path"));
intent.putExtra("path", category+"/"+path);
Log.i("onlistitemclick","path:"+path+" with id:"+id);
    startActivity(intent);        
    }

@Override
public Loader<Cursor> onCreateLoader(int arg0, Bundle arg1) {       
    Uri firstUri=Recipes.getUri(category);        
    String selection;
    String[] projection = {BaseColumns._ID,Recipes.NAME,Recipes.STARRED}; 

    if (mCurFilter != null) {            
        selection = "(" + Recipes.NAME + " NOTNULL) AND ("
                + Recipes.KEYWORDS + " like '%"+mCurFilter+"%')";
    } else {            
        selection=null;
    }

    CursorLoader cursorLoader = new CursorLoader(getActivity(),
            firstUri, projection, selection, null, Recipes.STARRED+" 
    DESC"+","+Recipes.NAME+" ASC");
    Log.i("recipes activity","mCurFilter="+mCurFilter);
    return cursorLoader;
}

@Override
public void onLoadFinished(Loader<Cursor> loader, Cursor data) {
adapter.changeCursor(data); 
}

@Override
public void onLoaderReset(Loader<Cursor> loader) {
    adapter.changeCursor(null); 

}
    } 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-03-10T11:23:55.737

所以魔法就在几行字里。您必须将 FilterQueryProvider 添加到适配器：

```
adapter=new MyCursorAdapter(this, c, true);
adapter.setFilterQueryProvider(new FilterQueryProvider() {

    @Override
    public Cursor runQuery(CharSequence constraint) {
    String[] projection = { Recipes._ID, Recipes.NAME, Recipes.KEYWORDS, 
                            Recipes.PATH, Recipes.STARRED }; 
    String selection = Recipes.KEYWORDS + " like '%" + constraint.toString() +"%'";
    return getContentResolver().query(Recipes.getUri(cat),projection, 
                                      selection, null, Recipes.STARRED + " DESC"
                                      + "," + Recipes.NAME + " ASC");
    }
}); 
```

# objective-c - UITextView 禁用自动换行

> ID：11977237
> 
> 赞同：0
> 
> 时间：2012-08-15T21:02:33.980
> 
> 标签：objective-c, ios, cocoa-touch, uitextview

我想显示长度未知的 Web 请求的响应。我选择使用可滚动的 UITextView，但它似乎会自动换行，看起来不太好。我不认为 UITextView 有办法禁用这个自动换行。

在未知数量的行上显示未知数量的字符会是更好的选择吗？

谢谢

# android - 如何将所有列中的特定数据导入单个数组

> ID：11977238
> 
> 赞同：0
> 
> 时间：2012-08-15T21:02:44.640
> 
> 标签：android, android-sqlite

我需要从 SQLite 数据库（存储它的位置）以数组的形式导入名称列表。这是正确的方法吗

数据库代码

```
public String queryAll() {
    // TODO Auto-generated method stub
    String [] columns = new String [] {KEY_NAME};
    Cursor point = ourDatabase.query(DATABASE_TABLE, columns, null, null, null, null, null);
    String result = "";

    int iName = point.getColumnIndex(KEY_NAME);

    for(point.moveToFirst();!point.isAfterLast();point.moveToNext()){
        result = result + point.getString(iName);
    }
    return result; 
```

代码到我应该将数据导入到的位置

```
 DBContact info = new DBContact (this);
    info.open();
    String data[] = info.queryAll();
    info.close();
    NewContact = (Button) findViewById(R.id.bAddContact); 
```

我是初学者，任何事情都会有很大帮助。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T21:24:18.497

```
public String[] queryAll() {
    String [] columns = new String [] {KEY_NAME};
    Cursor cursor = ourDatabase.query(DATABASE_TABLE, columns, null, null, null, null, null);
    if (cursor != null) {
        try {
            final int nameColumnIndex = cursor.getColumnIndex(KEY_NAME);
            List<String> names = new ArrayList<String>();
            while (cursor.moveToNext()) {
                names.add(cursor.getString(nameColumnIndex));
            }
            return names.toArray(new String[names.size()]);
        } finally {
            cursor.close();
        }
    }
    return null;
} 
```

# oauth-2.0 - 猫鼬身份验证中的OAuth2.0？

> ID：11977239
> 
> 赞同：1
> 
> 时间：2012-08-15T21:03:03.340
> 
> 标签：oauth-2.0, everyauth

我在 node.js 中使用 mongoose-auth 进行了身份验证。想要连接到需要 OAuth2.0 身份验证的 Google REST Api。mongoose-auth 是否支持 OAuth2？

（添加everyauth 作为标签，因为mongoose-auth 还不存在）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-18T02:37:26.583

mongoose-auth 扩展了确实实现 OAuth2.0ds 的everyauth

# drupal - 具有创建自己的 CSS 的字段的自定义内容类型？

> ID：11977240
> 
> 赞同：0
> 
> 时间：2012-08-15T21:03:07.723
> 
> 标签：drupal

我正在寻找一个包含图像文件字段的内容类型 - 很简单。但是，我希望这个图像文件显示为背景图像。我是否必须创建自定义 node.tpl 并将图像源包含在 inline`style="background: url(sites/all/themes/theme/images/image.png);"`中，还是有更优雅的方法来执行此操作，可能包括使用 JavaScript 从字段写入样式表？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-16T20:00:12.890

您可以在 hook_node_view 函数、节点预处理脚本或节点模板中使用 drupal_add_css 直接添加样式：

```
$css = "#bg-img { 
  background: url(/sites/all/themes/theme/images/image.png) left top no-repeat; 
};"
drupal_add_css($css, 'inline'); 
```

或者，您可以使用drupal 设置，然后在jquery 脚本中引用它；使用“设置”选项查找[drupal_add_js用法和示例：](http://api.drupal.org/api/drupal/includes!common.inc/function/drupal_add_js/7)

```
drupal_add_js(array("moduleName" => array('bgImg' => $absolute_url)), 'setting'); 
```

使用 Drupal.settings.moduleName['bgImg'] 在 jQuery 中引用

IMO 按照您的描述调整 node.tpl.php 是非常明智的。使用 drupal_add_css 可以让您在节点外的元素（例如整个页面）上设置背景图像。当我需要更高级的定位/调整大小选项时，我使用了 jquery。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-08-02T22:35:33.770

无需阅读文档和深入研究代码，只需使用 Field Formatter CSS 模块 ( [https://drupal.org/project/field_formatter_class](https://drupal.org/project/field_formatter_class) ) 并在几分钟内完成。这是一颗宝石，您会发现自己一遍又一遍地使用它。它允许您向自定义内容类型的“管理显示”中的每个字段添加 css 类和其他选项。至于这种将用户上传的图像作为背景的特殊情况，这里是一个屏幕截图。在 Field Formatter Class 字段中添加一个类，然后您应该能够使用 css 和 jquery 进一步重新定位和调整大小。

![在此处输入图像描述](../Images/972638bd0b642e416eacc69f99084bd6.png)

# jquery - jquery模态窗口：第一次加载内容onclick；随后通过 php 脚本

> ID：11977241
> 
> 赞同：1
> 
> 时间：2012-08-15T21:03:08.467
> 
> 标签：jquery, dialog, modal-dialog

我正在使用一个登录脚本，它使用 php 处理所有错误捕获和反馈消息。这些消息将用户发送到网站导航之外的页面，因此我试图让它们显示在 jquery 模式窗口中。我使用以下代码加载初始页面 onclick：

```
var dlg=$('#register').dialog({
        title: 'Register for LifeStor',
        resizable: true,
        autoOpen:false,
        modal: true,
        hide: 'fade',
        width:350,
        height:350
     });

     $('#reg_link').click(function(e) {
         e.preventDefault();
         dlg.load('register.php', function(){
             dlg.dialog('open');
         });
      }); 
```

这很好——脚本加载，用户可以填写注册信息。当他们提交该信息时，会使用以下代码生成 php 反馈消息：

```
function procLogin(){
      global $session, $form;
      /* Login attempt */
      $retval = $session->login($_POST['user'], $_POST['pass'], isset($_POST['remember']));

      /* Login successful */
      if($retval){
         //header("Location: ".$session->referrer);
        header('Location:userhome(2).php');

      }
      /* Login failed */
      else{
         $_SESSION['value_array'] = $_POST;
         $_SESSION['error_array'] = $form->getErrorArray();
         header("Location: ".$session->referrer);
      }
   } 
```

我将 header("Location") 行更改为： header("Location: lifestor2.html:);

这是具有模态框所在的隐藏 div 的主页。这种作品！它用反馈消息（在另一个 php 页面上）替换了模式对话框的内容。但是，由于模态对话框是在单击时启动的（见上文），您必须再次单击该链接才能看到反馈消息。

所以，我的问题：有没有办法在第一次点击时启动模式对话框，然后让它自动打开？我不想过多地使用 php 脚本，因为它非常分层和复杂。如果我可以在模态中显示正确的消息，那将是完美的。

问候...

# html - 使用 css 动态突出显示选项卡

> ID：11977246
> 
> 赞同：0
> 
> 时间：2012-08-15T21:03:23.477
> 
> 标签：html, css

我有以下代码，我想使用 css 突出显示当前选择的选项卡。

```
<div id="Maintabs">
  <ul class"tablist">
    <li><a href="AshukuWeb.jsp?VIEW=Summary"  target=_top>Summary</a></li>
    <li><a href="AshukuWeb.jsp?VIEW=Advanced" target=_top>Advanced</a></li>
    <li><a href="AshukuWeb.jsp?VIEW=Expert" target=_top>Expert</a></li>
 </ul>
</div> 
```

有什么办法可以做到这一点？我知道css hover给出了鼠标悬停的元素，是否有类似的选择

多谢你们，

是的，我确实需要动态处理，所以我按照你说的方式做了。我捕获了该选项卡和类上的点击事件。在 css 中，我将所需的样式应用于该类，但它不起作用。

这是我的代码：

在 JavaScript 中：

```
 $('#summary').click(function(){
              $(this).addClass("selected");
        alert(" summary");
          }); 
```

HTML 代码：

```
<div id="Maintabs">
        <ul>
            <li style="width: 100px;"><a id="summary" href="AshukuWeb.jsp?VIEW=Summary"  target=_top>Summary</a></li>
            <li style="width: 100px;"><a id="advanced" href="AshukuWeb.jsp?VIEW=Advanced" target=_top>Advanced</a></li>
            <li style="width: 100px;"><a id="expert" href="AshukuWeb.jsp?VIEW=Expert" target=_top>Expert</a></li>
        </ul>
        </div> 
```

CSS 代码：

```
.selected{
    background-color:#FEE0C6;
} 
```

你觉得我做错了什么？？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T21:12:12.113

我不确定您如何使用纯 CSS 来产生选项卡效果。您通常需要 Javascript 或 jQuery 来动态更改当前选项卡的内容。

但是，如果您*使用*Javascript 或 jQuery 作为选项卡效果，您可以简单地添加一个类来突出显示选定的选项卡。

例如，这可能是您的 jQuery：

```
$("#tab1").addClass("selected-tab"); 
```

这是你的CSS：

```
.selected-tab
{
    /*Some style to highlight it and show it's the selected tab*/   
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-15T21:15:56.880

你会想要做一个活跃的课程。通过给你的 li 定义的类活动。然后您可以使用 css 使 .active 具有不同的颜色、大小、形状等

这是一个例子（第一个li）：

**HTML**

```
<div id="Maintabs">
  <ul class"tablist">
    <li class="active"><a href="AshukuWeb.jsp?VIEW=Summary"  target=_top>Summary</a></li>
    <li><a href="AshukuWeb.jsp?VIEW=Advanced" target=_top>Advanced</a></li>
    <li><a href="AshukuWeb.jsp?VIEW=Expert" target=_top>Expert</a></li>
 </ul>
</div> 
```

这是一个例子（第二个li）：

**HTML**

```
<div id="Maintabs">
  <ul class"tablist">
    <li><a href="AshukuWeb.jsp?VIEW=Summary"  target=_top>Summary</a></li>
    <li class="active"><a href="AshukuWeb.jsp?VIEW=Advanced" target=_top>Advanced</a></li>
    <li><a href="AshukuWeb.jsp?VIEW=Expert" target=_top>Expert</a></li>
 </ul>
</div> 
```

这是一个例子（第三个li）：

**HTML**

```
<div id="Maintabs">   <ul class"tablist">
    <li><a href="AshukuWeb.jsp?VIEW=Summary"  target=_top>Summary</a></li>
    <li><a href="AshukuWeb.jsp?VIEW=Advanced" target=_top>Advanced</a></li>
    <li class="active"><a href="AshukuWeb.jsp?VIEW=Expert" target=_top>Expert</a></li>  
 </ul> 
</div> 
```

**CSS**

```
#maintabs.active {background-color: #000;}
#maintabs {background-color: #ccc;} 
```

结果将是活动选项卡为黑色 (#000)，非活动选项卡为浅灰色 (#ccc)

# liferay - CASifying Liferay

> ID：11977254
> 
> 赞同：0
> 
> 时间：2012-08-15T21:03:55.930
> 
> 标签：liferay

我认为这是一个常见的问题，但我正在重新提出这个问题，因为我没有得到一个真正好的问题。所以，我在 Tomcat 7 上运行 Liferay 6.1 CE，我想从 LDAP 服务器导入用户，然后使用 CAS 进行 SSO。

在我的门户中，我集成了其他应用程序（这里我也有与 Alfresco 集成的问题），这些应用程序也需要使用来自 LDAP 的凭据登录，这就是我需要 SSO 解决方案（如 CAS）的原因。

我该如何面对这个问题？有没有人可以帮我解决这一切？任何信息都可以帮助我，我必须在两周内完成这一切......我希望我所要求的一切都是可行的。

感谢和问候

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-16T08:04:51.923

Liferay 提供所有必要的基础设施来解决您的需求。`portal.properties` [在https://github.com/liferay/liferay-portal/blob/master/portal-impl/src/portal.properties](https://github.com/liferay/liferay-portal/blob/master/portal-impl/src/portal.properties)查找 CAS 和 LDAP并在`portal-ext.properties` [Liferay 中进行配置：如何配置 Liferay 门户](https://stackoverflow.com/questions/11983343/liferay-how-to-configure-liferay-portal)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-09-04T20:18:59.230

这里有两个任务，从 LDAP 导入用户和使用 CAS 验证用户。您可以从控制面板 (UI) 或 portal-ext.properties 文件进行配置。如果您使用这两种方法进行配置并且存在属性冲突，则控制面板设置优先。

从 LDAP 导入用户并不困难（我在 5.2.3 和 6.1 中都做过），尽管导入/不导入密码可能会令人困惑。首先尝试处理此任务并确保您能够针对 LDAP 进行身份验证。我建议使用身份验证链（多种身份验证方式，如果一种方法失败，将尝试第二种方法，依此类推）。在 CAS 中断的情况下以这种方式配置它会很有用，这样您就不会出现单点故障。注意：如果您使用 portal-ext.properties，请务必阅读[这篇文章](https://www.liferay.com/community/forums/-/message_boards/message/8246721)并添加提到的属性（即使您不打算使用它们）：

> ldap.user.custom.mappings.1=
> ldap.contact.mappings.1=
> ldap.contact.custom.mappings.1=

关于针对 CAS 的身份验证，我已经在 Liferay 5.2.3 上使用了几年，根据我的经验，它的工作非常可靠。

# linux - 在八度音程中，printf 给出奇怪的错误

> ID：11977260
> 
> 赞同：2
> 
> 时间：2012-08-15T21:04:04.853
> 
> 标签：linux, matrix, printf, cell, octave

在 GNU Octave 中，我收到此代码的错误。

```
A = cell(10,1);
A{5,1} = "foobar";
outputFile = fopen("mytext.txt", "w");
printf(outputFile, "%s", A{5,1}); 
```

我收到此错误：

```
error: printf: format TEMPLATE must be a string 
```

这个错误信息没有帮助，谷歌不知道这个错误是什么！怎么了？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T21:07:30.717

**找到了这个错误的解决方案。**

您传入的第一个参数`printf`必须是有效的格式字符串。您正在向它传递一个文件句柄。如果要传递文件句柄，则应`fprintf`改为使用。如果您将第一个参数指定为文件， printf 会给您上述错误。

你应该这样做：

```
A = cell(10,1);
A{5,1} = "foobar";
outputFile = fopen("mytext.txt", "w");
fprintf(outputFile, "%s", A{5,1}); 
```

或者，如果您想打印到屏幕上，请删除 outputFile 参数：

```
A = cell(10,1);
A{5,1} = "foobar";
outputFile = fopen("mytext.txt", "w");
printf("%s", A{5,1});
% Here printf successfully casts the cell as a string.  no error. 
```

您正在向 printf 传递错误的参数，而 Octave 试图解释无意义。查看此网页以查看可以和不能传递到 octave 的 printf 中的内容：

[http://www.gnu.org/software/octave/doc/interpreter/Formatted-Output.html#doc-printf](http://www.gnu.org/software/octave/doc/interpreter/Formatted-Output.html#doc-printf)

# php - 带文件上传的php邮件程序

> ID：11977261
> 
> 赞同：0
> 
> 时间：2012-08-15T21:04:04.950
> 
> 标签：php

我试图让一个 php 邮件程序代码附加一个文件以及常规信息。我不知道该怎么办。这是我已经走了多远。

**表单.html**

```
<form method="post" name="contact" action="contactprocessor.php">
<label for="name">Name: </label> <input type="text" id="name">
<label for="email">email: </label> <input type="email" id="email">
<label for="file">Upload file: </label> <input type="file" id="file">
<input type="submit" id="name" value="upload"> 
```

**联系人处理器.php**

```
<?php 
$emailSubject = 'file upload';
$mailto ='me@mymail.com';
$nameField = $_POST['name'];
$emailField = $_POST['email'];
$body = <<<EOD 
NAME: $name <br>
Email: $email <br>
EOD;
$headers = "from: $email\r\n";
$success = mail($mailto, $emailSubject, $body, $headers);
?> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T21:32:25.353

首先，您需要将 enctype="multipart/form-data" 添加到您的

他们是对的，有教程可以做这样的事情。它们通常涉及多部分和 base64

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-15T21:55:01.420

不幸的是，您不能直接通过电子邮件发送文件。我建议使用 phpmailer 类 (http://code.google.com/a/apache-extras.org/p/phpmailer/) 但也有一种传统方式：[http://webcheatsheet.com/php/send_email_text_html_attachment。 php](http://webcheatsheet.com/php/send_email_text_html_attachment.php)

# html - 如何超链接到嵌入式地图中的位置

> ID：11977262
> 
> 赞同：0
> 
> 时间：2012-08-15T21:04:12.967
> 
> 标签：html, maps, embedding

我正在创建一个博客，并创建了一个带有“我的地方”的公共谷歌地图。该地图包含博客文章的几个相关位置。我想在每个帖子中包含一个链接，指向博客另一个页面中嵌入地图上的位置。这怎么可能？或者这有更好的方法吗？

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T21:09:53.263

在 Google 地图中查看位置时，只需复制按下 LINK 按钮时给出的值。

如果您在自己的页面上呈现地图（和标记），则可以使用哈希 url 技术。

```
http://mysite.com/map#loc_3 
```

当页面加载时，使用 JavaScript 查看`document.location.hash`，获取值，然后触发事件以转到该标记。

# android - 获取远程视图来更新文本有点麻烦

> ID：11977263
> 
> 赞同：1
> 
> 时间：2012-08-15T21:04:22.043
> 
> 标签：android, widget

因此，在过去三个小时与此作斗争后，我决定最好再次来这里。我已经设置了这个程序，我希望用户能够在一个屏幕上输入一些东西，并显示在该应用程序的小部件上。到目前为止，它的效果并不好。

这是一些代码：

```
case R.id.svbtn1:
        String nameData = inName1.getText().toString();
        SharedPreferences.Editor editor4 = prefs.edit();
        prefs.edit().putString(constants.menuname1, nameData).commit();
        RemoteViews view = new RemoteViews(c.getPackageName(),     R.layout.MyWidget);
        view.setTextViewText(R.id.menubtn1, constants.menuName1);
        break; 
```

那么当按下 svbtn1 时如何让它工作呢？

# python - python 中的猴子补丁：我们什么时候需要它？

> ID：11977270
> 
> 赞同：3
> 
> 时间：2012-08-15T21:04:45.150
> 
> 标签：python, monkeypatching

在 Python 中，该术语`monkey patch`仅指在运行时对类或模块的动态修改，作为初学者，我很难在 python 的上下文中理解该术语。谁能用一个真实的例子向我解释我们到底是怎么做的？

1.  类的动态修改
2.  在运行时动态修改模块

我坚持一个真实世界的例子（尽可能简单）来了解我们必须在哪些场景中执行此类任务？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-08-15T21:18:42.083

Monkey-patching 是一种以现有代码将继续运行但行为已修改的方式进行一些全局底层更改的方法。

### `str`一个改变内置命令行为的非常简单的例子：

**b.py**

```
def foo(msg):
    s = str(msg)
    print s, type(s) 
```

**一个.py**

```
import b

b.foo('foo')

# monkey-patch 
import __builtin__
__builtin__.str = unicode

b.foo('foo')

# Results:
#foo <type 'str'>
#foo <type 'unicode'> 
```

该`a`模块使用该`str`命令修改了其他代码的行为，通过修补它来`unicode`代替使用。这是必要的，因为我们假装我们无法访问`b.py`的代码。它可能是一个巨大的包，我们只是使用而无法更改。但是我们可以插入新的代码来改变行为。

### [来自 gevent](http://www.gevent.org/intro.html#monkey-patching)的真实示例

> ```
> >>> import gevent
> >>> from gevent import socket
> >>> urls = ['www.google.com', 'www.example.com', 'www.python.org']
> >>> jobs = [gevent.spawn(socket.gethostbyname, url) for url in urls]
> >>> gevent.joinall(jobs, timeout=2)
> >>> [job.value for job in jobs]
> ['74.125.79.106', '208.77.188.166', '82.94.164.162'] 
> ```
> 
> 上面的示例使用 gevent.socket 进行套接字操作。如果使用标准套接字模块，则需要 3 倍的时间才能完成，因为 DNS 请求是连续的。在 greenlets 中使用标准的 socket 模块会使 gevent 变得毫无意义，那么构建在 socket 之上的模块和包呢？
> 
> **这就是猴子修补的目的。gevent.monkey 中的函数小心地将标准套接字模块中的函数和类替换为它们的对应物。这样，即使是不知道 gevent 的模块也可以从在 multi-greenlet 环境中运行中受益。**
> 
> ```
> >>> from gevent import monkey; monkey.patch_socket()
> >>> import urllib2 # it's usable from multiple greenlets now 
> ```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-08-15T21:18:50.840

使用猴子补丁时有一些现实生活中的例子：

1.  **单元测试**。创建存根/模拟修补真实对象以更改其行为以尊重测试需求通常很方便。例如，您想测试`Object.method1()`行为。方法可以返回一个字符串或无。所以这里的猴子补丁来了。您替换`method1`为只包含一行代码的存根方法`return None`。
2.  在运行时**修改/扩展**代码。这种用例的最佳示例可能是相当流行的 python gevent 库。它使用猴子补丁来使标准套接字模块按照 gevent 需要的方式工作。这是一个源[代码](https://bitbucket.org/denis/gevent/src/e1b82d1a7b62/gevent/monkey.py)。
3.  **在运行时将补丁应用于对象**。对对象进行简单快速的修改会很有用，在此之后，对象必须符合应用程序其他部分使用的某些接口。它可以在 Python 中使用`setattr`函数轻松完成。好吧，这通常意味着您的应用程序**架构不好，并且****不是一个好的设计决策**。

# python - Python烧瓶以及如何在网页中显示代码

> ID：11977273
> 
> 赞同：1
> 
> 时间：2012-08-15T21:04:48.403
> 
> 标签：python, flask

我的网络框架是 Flask。

我想创建一个页面的一部分来显示 java 脚本和 html 代码片段。我不知道这样做的术语。有没有为此的python烧瓶插件？任何其他类型的 js 库？同样，我需要 js 和 html 代码片段。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-08-15T21:10:25.990

看看[Prettify](http://code.google.com/p/google-code-prettify/) - Stackoverflow 使用它来格式化代码。它将格式化您页面上的代码，并使其看起来与本网站上的一样。

您只需在页面上包含 JavaScript 和 CSS。

```
<link rel="stylesheet" type="text/css"  href="css/colorschemes/prettify.css" />
<script type="text/javascript" src="js/prettify/prettify.js"></script> 
```

[请参阅此处](http://google-code-prettify.googlecode.com/svn/trunk/README.html)的设置说明

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-08-15T21:26:55.337

看看[pygments](http://pygments.org/)。它可以处理[大量的格式](http://pygments.org/docs/lexers/)。

# python - Python中等效的构建器模式

> ID：11977279
> 
> 赞同：74
> 
> 时间：2012-08-15T21:05:11.353
> 
> 标签：python, design-patterns, builder-pattern

在 Java 中，您可以使用[**构建器模式**](https://stackoverflow.com/questions/5007355/builder-pattern-in-effective-java)来提供一种更易读的方法来实例化具有许多参数的类。在构建器模式中，使用设置命名属性的方法构造一个配置对象，然后使用它来构造另一个对象。

Python中的等价物是什么？模仿相同实现的最佳方法是什么？

* * *

## 回答 #1

> 赞同：119
> 
> 时间：2012-08-15T21:16:45.753

设计模式通常可以用内置的语言特性代替。

### 您的用例

你说“我想要一个更易读的“手段”来实例化一个有很多参数的类。”。在 Java 的情况下：

> [[A] 构建器模式的用例是当要构建的对象的构造器必须采用非常多的参数时。`setMaxTemperature(int t)`在这种情况下，将此类配置参数集中在构建器对象（ 、`setMinTemperature(int t)`、 .. 等）中通常`set`比让调用者负担一长串参数来传递类的构造函数更方便。](http://c2.com/cgi/wiki?BuilderPattern).

### 不需要构建器模式

但是 Python 支持[**命名参数**](https://en.wikipedia.org/wiki/Named_parameter)，所以这不是必需的。您可以只定义一个类的构造函数：

```
class SomeClass(object):
    def __init__(self, foo="default foo", bar="default bar", baz="default baz"):
        # do something 
```

并使用命名参数调用它：

```
s = SomeClass(bar=1, foo=0) 
```

请注意，您可以自由地重新排序和省略参数，就像使用 Java 中的构建器一样，您可以省略或重新排序`set`对构建器对象上的方法的调用。

另外值得一提的是，Python 的动态特性使您可以更自由地构建对象（使用`__new__`等），这可以替代构建器模式的其他用途。

### 但如果你真的想使用它

您可以[`collections.namedtuple`](http://docs.python.org/dev/library/collections.html#collections.namedtuple)用作您的配置对象。`namedtuple()`返回一个表示元组的新类型，每个参数都有一个给定的名称，而无需编写样板类。您可以以与 Java 构建器类似的方式使用结果类型的对象。（感谢[Paul McGuire](https://stackoverflow.com/users/165216/paul-mcguire)的建议。）

### `StringBuilder`

一个相关的模式是 Java 的 StringBuilder，它用于`String`分阶段有效地构造一个（不可变的）。在 Python 中，这可以替换为`str.join`. 例如：

```
final StringBuilder sb = new StringBuilder();
for(int i = 0; i < 100; i++)
    sb.append("Hello(" + i + ")");
return sb.toString(); 
```

可以替换为

```
return "".join(f"Hello({i})" for i in range(100)) 
```

* * *

## 回答 #2

> 赞同：49
> 
> 时间：2014-10-04T12:51:08.413

OP 通过将 Builder 模式转换为特定于 Java 的方式来为自己做好准备。它不是。它在[四人帮的书中](http://en.wikipedia.org/wiki/Builder_pattern)，并且可能与任何面向对象的语言相关。

不幸的是，即使是[关于 Builder 模式的 Wikipedia 文章](http://en.wikipedia.org/wiki/Builder_pattern)也没有给予足够的信任。它不仅仅对代码优雅有用。**构建器模式是创建不可变对象的好方法，这些对象在使用之前必须是可变的。**不可变状态在函数范式中尤其重要，这使得 Builder 成为 Python 的优秀面向对象模式。

我在下面使用[collections.namedtuple提供了一个示例 Builder + ImmutableObject 实现，从“](https://docs.python.org/dev/library/collections.html#collections.namedtuple) [How to make an immutable object in python](https://stackoverflow.com/a/4828108/3653274) ”中借用和修改。我让 Builder 相当简单。但是，可以提供返回 Builder 本身的 setter 函数以允许调用链。或者可以在 Builder 中使用 @property 语法来提供在设置之前检查属性有效性的属性设置器。

```
from collections import namedtuple

IMMUTABLE_OBJECT_FIELDS = ['required_function_result', 'required_parameter', 'default_parameter']

class ImmutableObjectBuilder(object):
    def __init__(self, required_function, required_parameter, default_parameter="foo"):
        self.required_function = required_function
        self.required_parameter = required_parameter
        self.default_parameter = default_parameter

    def build(self):
        return ImmutableObject(self.required_function(self.required_parameter),
                               self.required_parameter,
                               self.default_parameter)

class ImmutableObject(namedtuple('ImmutableObject', IMMUTABLE_OBJECT_FIELDS)):
    __slots__ = ()

    @property
    def foo_property(self):
        return self.required_function_result + self.required_parameter

    def foo_function(self):
        return self.required_function_result - self.required_parameter

    def __str__(self):
        return str(self.__dict__) 
```

示例用法：

```
my_builder = ImmutableObjectBuilder(lambda x: x+1, 2)
obj1 = my_builder.build()
my_builder.default_parameter = "bar"
my_builder.required_parameter = 1
obj2 = my_builder.build()
my_builder.required_function = lambda x: x-1
obj3 = my_builder.build()

print obj1
# prints "OrderedDict([('required_function_result', 3), ('required_parameter', 2), ('default_parameter', 'foo')])"
print obj1.required_function_result
# prints 3
print obj1.foo_property
# prints 5
print obj1.foo_function()
# prints 1
print obj2
# prints "OrderedDict([('required_function_result', 2), ('required_parameter', 1), ('default_parameter', 'bar')])"
print obj3
# prints "OrderedDict([('required_function_result', 0), ('required_parameter', 1), ('default_parameter', 'bar')])" 
```

在这个例子中，我创建了三个 ImmutableObjects，它们都具有不同的参数。我赋予调用者以构建器的形式复制、修改和传递可变配置的能力，同时仍保证构建对象的不变性。在 ImmutableObjects 上设置和删除属性会引发错误。

底线：构建器是传递具有可变状态的东西的好方法，当您准备好使用它时，它为对象提供了不可变状态。或者，换句话说，构建器是提供属性设置器同时仍确保不可变状态的好方法。这在功能范式中尤其有价值。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2014-03-05T18:04:51.093

我不同意@MechanicalSnail。我认为类似于海报所引用的构建器实现在某些情况下仍然非常有用。命名参数只允许您简单地设置成员变量。如果你想做一些稍微复杂的事情，那你就不走运了。在我的示例中，我使用经典的构建器模式来创建一个数组。

```
class Row_Builder(object):
  def __init__(self):
    self.row = ['' for i in range(170)]

  def with_fy(self, fiscal_year):
    self.row[FISCAL_YEAR] = fiscal_year
    return self

  def with_id(self, batch_id):
    self.row[BATCH_ID] = batch_id
    return self

  def build(self):
    return self.row 
```

使用它：

```
row_FY13_888 = Row_Builder().with_fy('FY13').with_id('888').build() 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2020-06-22T14:42:54.853

我刚刚遇到了构建这种模式的需求，偶然发现了这个问题。我意识到这个问题有多老了，但不妨添加我的构建器模式版本，以防它对其他人有用。

我相信使用装饰器来指定构建器类是在 python 中实现构建器模式最符合人体工程学的方式。

```
def buildermethod(func):
  def wrapper(self, *args, **kwargs):
    func(self, *args, **kwargs)
    return self
  return wrapper

class A:
  def __init__(self):
    self.x = 0
    self.y = 0

  @buildermethod
  def set_x(self, x):
    self.x = x

  @buildermethod
  def set_y(self, y):
    self.y = y

a = A().set_x(1).set_y(2) 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-08-15T21:17:59.497

Java 中的构建器模式可以通过使用以下变体在 python 中轻松实现：

`MyClass(self, required=True, someNumber=<default>, *args, **kwargs)`

where`required`和`someNumber`是一个示例，显示具有默认值的所需参数，然后在处理可能存在的情况时读取可变参数`None`

如果您之前没有使用过变量参数，请参考[这里](https://stackoverflow.com/questions/287085/what-does-args-and-kwargs-mean)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2020-06-30T08:07:58.267

builder和constructor不是一回事，builder是一个概念，constructor是一种编程语法。没有必要将两者进行比较。

因此，请确保您可以使用构造函数、类方法或专用类来实现构建器模式，没有冲突，请使用适合您情况的任何一种。

从概念上讲，构建器模式将构建过程与最终对象分离。以建造房屋的真实世界为例。建造者可能会使用很多工具和材料来建造房屋，但最终的房屋在建造后不需要那些工具和多余的材料。

例子：

```
woodboards = Stores.buy(100)
bricks = Stores.buy(200)
drills = BuilderOffice.borrow(4)

house = HouseBuilder.drills(drills).woodboards(woodboards).bricks(bricks).build() 
```

# c++ - 此 C++ 代码中以何种方式调用函数？

> ID：11977280
> 
> 赞同：0
> 
> 时间：2012-08-15T21:05:15.783
> 
> 标签：c++, function

我从 c++ 入门书中得到了这段代码，它是为了解释删除运算符。但是，我不明白的是程序如何调用这两个函数以及它们如何交互。

```
// delete.cpp -- using the delete operator
#include <iostream>
#include <cstring> // or string.h
using namespace std;
char * getname(void); // function prototype

int main()
{
    char * name; // create pointer but no storage

    name = getname(); // assign address of string to name
    cout << name << " at " << (int *) name << "\n";
    delete [] name; // memory freed

    name = getname(); // reuse freed memory
    cout << name << " at " << (int *) name << "\n";
    delete [] name; // memory freed again

    return 0;
}

char * getname() // return pointer to new string
{
    char temp[80]; // temporary storage
    cout << "Enter last name: ";
    cin >> temp;

    char * pn = new char[strlen(temp) + 1];
    strcpy(pn, temp); // copy string into smaller space

    return pn; // temp lost when function ends
} 
```

本书提供了以下示例运行：

```
Enter last name: Fredeldumpkin
Fredeldumpkin at 0x004326b8
Enter last name: Pook
Pook at 0x004301c8 
```

我不明白的是“输入姓氏：”是如何以及为什么执行了两次，为什么char * getname()函数在int main()之前执行，以及这两个函数是如何相互作用的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-08-15T21:12:35.070

“输入姓氏”被打印了两次，因为它被打印`getname()`并被`getname()`调用了两次。

`getname()`之前*没有*执行`int main()`，它被声明。必须声明它，以便在编译器编译`main()`（使用`getname()`）时，编译器知道要做什么。

`main()`是第一段可执行代码（开发人员通常可以对其施加影响，但也有例外）。程序中发生的一切都是因为要么`main()`这样做，要么`main()`调用（直接或间接）调用它。在您的示例中，`main()`将：执行以下操作：

1.  调用 getname()
2.  根据 getname() 的返回打印一些东西
3.  释放在 getname() 中分配的资源
4.  调用 getname()
5.  根据 getname() 的返回打印一些东西
6.  释放在 getname() 中分配的资源

# navigation - 在 member_action 上显示 ActiveAdmin 导航栏

> ID：11977282
> 
> 赞同：1
> 
> 时间：2012-08-15T21:05:21.863
> 
> 标签：navigation, activeadmin

我正在尝试在 ActiveAdmin 中创建一个 member_action，并希望导航栏出现在页面顶部的通常位置。

我尝试使用 .erb 和 .arb 格式的视图，并尝试显式呈现应用程序布局，但导航栏从未显示。

这是我正在尝试做的文档：

[http://activeadmin.info/docs/8-custom-actions.html#rendering_in_custom_actions](http://activeadmin.info/docs/8-custom-actions.html#rendering_in_custom_actions)

作为一种解决方法，我将注册一个新页面并将其从菜单中隐藏，即使这对于资源丰富的 POV 来说是错误的。

任何有关如何正确执行此操作的建议将不胜感激！

# sql - 在单个表中查找多个 ID 匹配项

> ID：11977283
> 
> 赞同：1
> 
> 时间：2012-08-15T21:05:22.670
> 
> 标签：sql, sql-server, tsql

在 SQL Server (2008) 中，我想在一个表中找到所有具有 3、4、5 或 4、5、6 技能 ID 的员工。他们需要其中一组。例如，仅具有 Skillid=4 不应产生匹配。如何构建这种类型的查询？

一个示例表：

```
pkid, empid, skillid
 1     2       3
 2     2       4
 3     2       5
 4     5       6 
```

在上面的例子中，empid=2 匹配集合 3,4,5。empid=5 不是。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-08-15T21:11:09.623

您将需要在查询中使用一个`GROUP BY`和一个`HAVING`子句：

```
select empid
from t1
where skillid in (3, 4, 5) 
    or skillid in (4, 5, 6) 
group by empid
having count(distinct skillid) = 3 
```

请参阅[带有演示的 SQL Fiddle](http://sqlfiddle.com/#!3/469e7/2)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-15T22:05:41.713

我对您最初问题的阅读是，您想找到满足以下任一条件的员工：

*   他们的技能 ID 为 3 和 4 和 5
*   他们的技能 ID 为 4 和 5 和 6

（或两者）。如果是这种情况，您将需要使用*相关子查询*来执行类似的操作：

```
select *
from employee e
where (     exists ( select * from employee_skill es3 on es3.empid = e.empid and es3.skillid = 3 )
        and exists ( select * from employee_skill es3 on es3.empid = e.empid and es3.skillid = 4 )
        and exists ( select * from employee_skill es3 on es3.empid = e.empid and es3.skillid = 5 )
      )
   OR (     exists ( select * from employee_skill es3 on es3.empid = e.empid and es3.skillid = 4 )
        and exists ( select * from employee_skill es3 on es3.empid = e.empid and es3.skillid = 5 )
        and exists ( select * from employee_skill es3 on es3.empid = e.empid and es3.skillid = 6 )
      ) 
```

但是，由于您的两个目标技能集 { 3, 4, 5 } 和 { 4, 5, 6 } 具有公共子集 { 4 , 5 }，因此我们可以简化。重构，我们得到

```
select *
from employee e
where exists ( select * from employee_skill es3 on es3.empid = e.empid and es3.skillid =    4       )
  and exists ( select * from employee_skill es3 on es3.empid = e.empid and es3.skillid =    5       )
  and exists ( select * from employee_skill es3 on es3.empid = e.empid and es3.skillid in ( 3 , 6 ) ) 
```

另一种技术是使用`left join`：

```
select *
from employee e
left join employee_skill es3 on es3.empid = e.empid and es3.skillid = 3
left join employee_skill es4 on es4.empid = e.empid and es4.skillid = 4
left join employee_skill es5 on es5.empid = e.empid and es5.skillid = 5
left join employee_skill es6 on es6.empid = e.empid and es6.skillid = 6
where es4.empid is not null
  and es5.empid is not null
  and (    es3.empid is not null
        OR es6.empid is not null
      ) 
```

后一种方法使用`left join`包含一个隐含的假设，即特定员工/技能组合在数据模型中是唯一的。如果不是这种情况，那么这种方法将需要使用，`select distinct`以免您在结果集中获得重复的行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-08-15T21:07:36.103

尝试

```
select pkid, empid
from your_table
where skillid in (3,4,5) or skillid in (4,5,6) 
group by pkid, empid
having count(distinct skillid) = 3 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-08-15T21:23:07.677

先前的两个答案都无法区分 (1,2,6) 或 (1,5,6) 或 (2,5,6) 等中的集合成员资格。结果必须只显示一个 empid ALL of 1,2,3 OR 4,5,6 的成员。

尝试：

```
    创建表Table1（pkid int 约束PK_Table1 主键，empid int，skillid int）

    插入 table1 值 (1,2,1)
    插入 table1 值 (2,2,2)
    插入 table1 值 (3,2,3)
    插入 table1 值 (4,3,1)

    选择 empid
    从 （
        SELECT empid, sum(t.s1) as s1, sum(t.s2) as s2, sum(t.s3) as s3, sum(t.s4) as s4, sum(t.s5) as s5, sum( t.s6) 作为 s6
        从
        (
            选择 empid, 1 s1, 0 s2, 0 s3, 0 s4, 0 s5, 0 s6
            从表 1
            其中skillid = 1
            联合所有
            选择 empid, 0, 1, 0, 0, 0, 0
            从表 1
            其中skillid = 2
            联合所有
            选择 empid, 0, 0, 1, 0, 0, 0
            从表 1
            其中skillid = 3
            联合所有
            选择 empid, 0, 0, 0, 1, 0, 0
            从表 1
            其中skillid = 4
            联合所有
            选择 empid, 0, 0, 0, 0, 1, 0
            从表 1
            其中skillid = 5
            联合所有
            选择 empid, 0, 0, 0, 0, 0, 1
            从表 1
            其中skillid = 6
        ) 吨
        按 t.empid 分组
    ) tt
    WHERE (tt.s1 = 1 and tt.s2 = 1 and tt.s3 = 1) or (tt.s4 = 1 and tt.s5=1 and tt.s6=1)

```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-08-15T21:29:21.263

empid IN (3,4,5) 是 empid = 3 或 empid = 4 或 empid = 5 的简写，所以 empid IN 3,4,5, OR empid IN (4,5,6) 与 empid IN ( 3,4,5,6)。但是，我们需要避免用 3、5、6 或 3、4、6 来计算人。你可以这样做：

```
SELECT empid, 345 AS skillset
FROM your_table
WHERE skillid IN (3,4,5)
GROUP BY empid
HAVING COUNT(DISTINCT skillid) = 3
UNION ALL
SELECT empid, 456 AS skillset
FROM your_table
WHERE skillid IN (4,5,6)
GROUP BY empid
HAVING COUNT(DISTINCT skillid) = 3 
```

如果您想查看哪个 empid 有两个集合等，您可以在此周围放置一个 SELECT。

# objective-c - 如果您在变量之前放置多个静态修饰符，这意味着什么？

> ID：11977285
> 
> 赞同：4
> 
> 时间：2012-08-15T21:05:34.190
> 
> 标签：objective-c, ios, c

我只是在 Xcode 中闲逛，我发现以下语句可以编译，它甚至不会引发警告，更不用说错误了：

```
static static static int static long static var[5]; 
```

那是怎么回事？这是否使它成为超级 DUPER 静态的？:)

除了开玩笑，为什么编译器允许重复静态修饰符？实际上是否有理由允许人们这样做，或者编写编译器的人懒得让它引发错误？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-08-15T21:45:45.547

我不是 Objective-C 开发人员，但该语言是否允许对修饰符进行任意排序（例如 static volatile extern）？如果是这样，那么它可能是编译器中的一个良性错误，在读取修饰符（`static`在本例中为“”）后返回到它再次接受任何修饰符终端的状态，并且会一直这样做，直到它遇到变量的类型。连续`static`声明不会与任何先前的修饰符相矛盾，因此不会引发任何错误；所以基于此，我希望`volatile volatile volatile int x;`也能工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-15T22:29:14.453

对于 C 2011，以下适用：

> **第 6.7.1 节第 2 段**
> 
> 最多可以在声明中的声明说明符中给出一个存储类说明符，除非它`_Thread_local`可能与 static 或 extern 一起出现。

存储类说明符定义为：

```
storage-class-specifier:
          typedef 
          extern
          static
          _Thread_local
          auto
          register 
```

所以对于 C 2011，这应该是非法的。

* * *

*至于Objective C，我不知道在哪里可以找到语言规范，所以我无法帮助你。*

# php - 用于测试 POST 到 .PHP 的网站

> ID：11977286
> 
> 赞同：4
> 
> 时间：2012-08-15T21:05:44.513
> 
> 标签：php

我有一个 iOS 应用程序，并希望从该应用程序 POST 到 .php Web 服务。

目前我正在使用这个网站来测试（一切正常）[http://www.htmlcodetutorial.com/cgi-bin/mycgi.pl](http://www.htmlcodetutorial.com/cgi-bin/mycgi.pl)。

我的问题是：有没有像我发布的那样用 .php 编写的网站，以便我可以用它们测试我的应用程序？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T21:14:39.497

就像他们说的那样，POST 是一个 POST，但是......交付......

```
<?php

$post = print_r($_POST, TRUE);

echo '<pre>', $post, '</pre>'; 
```

享受。

```
http://instagraph.me/post 
```

例子：

```
Array
(
    [a] => 12345
) 
```

编辑为“不起作用”评论：

```
curl -A "Mozilla" -d a=12345 http://instagraph.me/post
Array
(
    [a] => 12345
) 
```

我建议你“伪造”用户代理，只需添加 Mozilla，你就可以省去可能的麻烦。

# c++ - 带有模板、运算符重载和 boost::bind 的 C++——这个小代码是做什么的？

> ID：11977298
> 
> 赞同：0
> 
> 时间：2012-08-15T21:06:47.740
> 
> 标签：c++, templates, operator-overloading, boost-bind

```
#include <iostream> 
#include <boost/bind.hpp>

struct FCall3Templ {

  template<typename ARG1, typename ARG2>
  ARG1 operator()(ARG1 arg1, ARG2 arg2) {
    return arg1+arg2;
  }
};
int main() {
  boost::bind<int>(FCall3Templ(), 45, 56)(); // call 1
  boost::bind<double>(FCall3Templ(), 45.0, 56.0)(); // call 2
  return 0;
} 
```

我发布的代码与您可以在[此处](https://stackoverflow.com/a/7039640/827992)找到的代码相同。

我对元编程、boost::bind 和运算符重载相对较新，但我不明白这段代码在代码的某些部分中做了什么，我有这个问题：

*   为什么`operator()`在不指定该运算符的标签的情况下使用？什么是重载/定义？
*   我应该如何使用赋值来捕获和存储 2 个调用返回的值`T var = ?`？
*   `()`两个调用中最后一个都是空的事实是什么意思？是接线员的电话吗？那么这种技术/操作符的名称是什么？
*   为什么以这种方式使用运算符重载而不是仅使用方法？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T21:13:49.250

好的，首先，类型`FCall3Templ`是函子，两个参数`operator()`意味着您可以创建一个实例并像这样“调用”它：

```
FCall3Templ f; // instantiate it
int i = f(45, 56); // call it, sums the numbers and returns the result 
```

接下来，`boost::bind`可用于制作另一个具有较少参数的可调用对象。在这种情况下：

```
boost::bind<int>(FCall3Templ(), 45, 56); 
```

它接受一个`FCall3Templ`实例，并创建一个可以在没有参数的情况下调用的仿函数，它的作用与调用相同`f(45, 56)`。换句话说，它将函子“绑定”到两个参数值。最后一行等价于但不完全相同

```
boost::bind<int>(f, 45, 56); 
```

您可以通过将返回值分配给变量来捕获该值，就像您对任何函数所做的那样：

```
int n = boost::bind<int>(FCall3Templ(), 45, 56); 
```

最后，我们在这里调用这样一个仿函数的临时实例：

```
boost::bind<int>(FCall3Templ(), 45, 56)(); 
```

其中最终的`()`意思是我们称为无参数仿函数，如果像这样表示（未经测试）会更清楚：

```
boost::function<int()> f2 = boost::bind<int>(FCall3Templ(), 45, 56);
int n = f2(); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-08-15T21:21:28.620

依次回答您的问题：

1)`operator()`是`()`对象的运算符。例如，如果您查看[std::less](http://en.cppreference.com/w/cpp/utility/functional/less)的定义，它定义`operator()`了接受两个参数并进行比较，然后返回结果。这允许你写

```
 bool foo(int a, int b)
    {
       std::less<int> compare;
       return compare(int a, int b);
    } 
```

2）在这种情况下，您可以像往常一样抓住它们。

```
int i = boost::bind<int>(FCall3Templ(), 45, 56)(); // call 1     
double d = boost::bind<double>(FCall3Templ(), 45.0, 56.0)(); // call 2 
```

3)`boost::bind`用于获取函数对象（已`operator()`定义的对象）、函数指针或成员函数指针可选地连同参数，并返回一个新的函数对象（其类型难以描述），该对象在调用时使用绑定的参数（以及调用期间可能的参数）。请参阅[boost::bind的文档](http://www.boost.org/doc/libs/1_50_0/libs/bind/bind.html)

在这种情况下，答案只是调用`boost::bind`然后立即调用结果。第二组`()`正在调用结果。由于所有参数在调用时都已绑定，因此`boost::bind`不需要额外的参数。

4）原因是最初的问题是询问如何`boost::bind`自动选择正确的函数模板实例化。不幸的是，当使用函数指针（包括模板函数）时，`boost::bind`不能自动执行重载解析，因为它必须传递一个函数指针作为它的第一个参数，并且它不知道如何执行重载解析。

但是，如果给定一个函子，并且该函数定义了模板化成员函数`operator()`甚至重载`operator ()`，则它可以在调用时执行重载决议。

# python - 试图理解一段非常简单的python代码的行为：return [x[0] for x in y]

> ID：11977301
> 
> 赞同：1
> 
> 时间：2012-08-15T21:07:02.043
> 
> 标签：python, syntax, for-loop, return-value

我想（但仍然 Contino 不明白为什么会有差异）这段代码：

```
def categories(self):
    cur=self.con.execute('select category from cc');
    for d in cur:
        return d[0] 
```

相当于另一个：

```
def categories(self):
    cur=self.con.execute('select category from cc');
    return [d[0] for d in cur] 
```

但是，当我在代码中一个一个替换时，我在代码的其他位置出现错误：

```
 File "C:\Users\CG\Desktop\Google Drive\Sci&Tech\projects\naivebayes\main.py", line 226, in post
    spam_result = nb.classify(given_sentence)
  File "C:\Users\CG\Desktop\Google Drive\Sci&Tech\projects\naivebayes\main.py", line 204, in classify
    if cat==best: continue
UnboundLocalError: local variable 'best' referenced before assignment 
```

为什么会这样？为什么这两段代码不等价？

完整代码：

```
# -*- coding: utf-8 -*-
# -*- coding: utf-8 -*-

import sqlite3

import USSSALoader

import random

from pysqlite2 import dbapi2 as sqlite

import re

import math

def getfeatures(doc):
  splitter=re.compile('\\W*')
  # Split the words by non-alpha characters
  words=[s.lower() for s in splitter.split(doc)
          if len(s)>2 and len(s)<20]
  # Return the unique set of words only
#  return dict([(w,1) for w in words]).iteritems()
  return dict([(w,1) for w in words])

class classifier:
  def __init__(self,getfeatures, filename=None):
    # Counts of feature/category combinations
    self.fc={}
    # Counts of documents in each category
    self.cc={}
    self.getfeatures=getfeatures

#  def setdb(self,dbfile):
    self.con=sqlite.connect('db_file')
#    self.con=sqlite3.connect(":memory:")
    self.con.execute('create table if not exists fc(feature,category,count)')
    self.con.execute('create table if not exists cc(category,count)')

  def incf(self,f,cat):
    count=self.fcount(f,cat)
    if count==0:
      self.con.execute("insert into fc values ('%s','%s',1)" % (f,cat))
    else:
      self.con.execute(
        "update fc set count=%d where feature='%s' and category='%s'"
        % (count+1,f,cat))

  def fcount(self,f,cat):
    res=self.con.execute(
      'select count from fc where feature="%s" and category="%s"'
      %(f,cat)).fetchone()
    if res==None: return 0
    else: return float(res[0])

  def incc(self,cat):
    count=self.catcount(cat)
    if count==0:
      self.con.execute("insert into cc values ('%s',1)" % (cat))
    else:
      self.con.execute("update cc set count=%d where category='%s'"
                       % (count+1,cat))

  def catcount(self,cat):
    res=self.con.execute('select count from cc where category="%s"'
                         %(cat)).fetchone()
    if res==None: return 0
    else: return float(res[0])

  def categories(self):
    cur=self.con.execute('select category from cc');
#    return [d[0] for d in cur]
    for d in cur:
 #       print "d =", d
  #      print "d[0] =", d[0]
        return d[0]

  def totalcount(self):
    res=self.con.execute('select sum(count) from cc').fetchone();
    if res==None: return 0
    print "res=self.con.execute('select * FROM cc').fetchall(); = ", self.con.execute('select * FROM cc').fetchall();
    print 'res sum(count) = ', res
    print 'res[0] = ', res[0]
    return res[0]

  def train(self,item,cat):
    features=self.getfeatures(item)
    # Increment the count for every feature with this category
    for f in features:
##    for f in features:
      self.incf(f,cat)
    # Increment the count for this category
    self.incc(cat)
    self.con.commit()

  def fprob(self,f,cat):
    if self.catcount(cat)==0: return 0
    # The total number of times this feature appeared in this
    # category divided by the total number of items in this category
    return self.fcount(f,cat)/self.catcount(cat)

  def weightedprob(self,f,cat,prf,weight=1.0,ap=0.5):
    # Calculate current probability
    basicprob=prf(f,cat)
    # Count the number of times this feature has appeared in
    # all categories
    totals=sum([self.fcount(f,c) for c in self.categories()])
    # Calculate the weighted average
    bp=((weight*ap)+(totals*basicprob))/(weight+totals)
    return bp

class naivebayes(classifier):

  def __init__(self,getfeatures):
    classifier.__init__(self, getfeatures)
    self.thresholds={}

  def docprob(self,item,cat):
    features=self.getfeatures(item)
    # Multiply the probabilities of all the features together
    p=1
    for f in features: p*=self.weightedprob(f,cat,self.fprob)
    return p

  def prob(self,item,cat):
    catprob=self.catcount(cat)/self.totalcount()
    docprob=self.docprob(item,cat)
    return docprob*catprob

  def setthreshold(self,cat,t):
    self.thresholds[cat]=t

  def getthreshold(self,cat):
    if cat not in self.thresholds: return 1.0
    return self.thresholds[cat]

  def classify(self,item,default=None):
    probs={}
    # Find the category with the highest probability
    max=0.0
    for cat in self.categories():
      probs[cat]=self.prob(item,cat)
      if probs[cat]>max:
        max=probs[cat]
        best=cat

    # Make sure the probability exceeds threshold*next best
    for cat in probs:
      if cat==best: continue
      if probs[cat]*self.getthreshold(best)>probs[best]: return default
    return best

def sampletrain(cl):
  cl.train('Nobody owns the water.','good')
  cl.train('the quick rabbit jumps fences','good')
  cl.train('buy pharmaceuticals now','bad')
  cl.train('make quick money at the online casino','bad')
  cl.train('the quick brown fox jumps','good')

nb = naivebayes(getfeatures)

sampletrain(nb)

doc_test = "buy pharmaceuticals now or earn money at the online casino"

print ('\ndoc_test is classified as %s'%nb.classify(doc_test)) 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-08-15T21:10:44.547

一个函数只返回一次。

当你看到

```
for d in cur:
    return d[0] 
```

循环在第一次迭代期间返回。

但是这个[列表理解](http://docs.python.org/tutorial/datastructures.html#list-comprehensions)

```
return [d[0] for d in cur] 
```

循环遍历每个项目`cur`以创建一个列表，然后返回结果。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T21:29:03.020

Building on Steven Rumbalksi's answer, the following code:

```
dList = []
for d in cur:
    dList.append(d[0])
return dList 
```

would be equivalent to:

```
return [d[0] for d in cur] 
```

[List comprehensions](http://docs.python.org/tutorial/datastructures.html#list-comprehensions) are really powerful like that, but they can be excessively dense ways of expressing the ideas, especially when you start nesting them, which leads to difficulty reading and debugging code.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-08-16T00:35:02.677

我认为您可能会混淆生成器的常规功能，请更改

```
for d in cur:
    return d[0] 
```

至

```
for d in cur:
    yield d[0] 
```

返回一个可迭代的

# android - Android设置背景资源和颜色

> ID：11977302
> 
> 赞同：4
> 
> 时间：2012-08-15T21:07:04.583
> 
> 标签：android

是否可以在自定义适配器中设置 ListView/ExpandableListView 的`backgroundResource`和`backgroundColor`。

我有一个透明的 png，它将作为可扩展列表视图中每一行的边框。这个图像只是一个内部阴影和底部的边框。

目标是做这样的事情：

![png + 颜色](../Images/44389ec9d4748b182bc676b4d8c21424.png)

当我设置 backgroundResource 和 backgroundColor 时，两者中只有一个出现。我无法获得覆盖颜色的资源。有谁知道这是否可能？

这是我的代码以获得更好的主意：

```
private int[] colors2= new int[] { Color.parseColor("#e2e8e9"), Color.parseColor("#f1f2f2") };
public View getGroupView(int groupPosition, boolean isExpanded, View convertView, ViewGroup parent) {
    ViewHolder holder;
    ExpandListGroup group = (ExpandListGroup) getGroup(groupPosition);
    if (convertView == null) {
        holder = new ViewHolder();
        LayoutInflater inf = (LayoutInflater) context.getSystemService(context.LAYOUT_INFLATER_SERVICE);
        convertView = inf.inflate(R.layout.expandlist_group_item, null);
        holder.title = (TextView) convertView.findViewById(R.id.tvGroup);
        convertView.setTag(holder);
    }else{
        holder = (ViewHolder) convertView.getTag();
    }
    int colorPos = groupPosition % colors.length; 
    convertView.setBackgroundResource(R.drawable.row_forground);
    convertView.setBackgroundColor(color2[colorPos]);
    holder.title.setText(group.getName());
    return convertView;
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2012-08-15T21:28:44.633

`setBackgroundResource` and `setBackgroundColor` both use the same api `setBackgroundDrawable` internally to do their tasks. So one overwrites the other. So you wont be able to achieve your goal using this api.

You will have to use setBackgroundResource with a custom drawable

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2014-11-28T00:14:41.727

如果你想使用`setBackgroundResource`，`setBackgroundColor`你可以这样做：

```
...
int colorPos = groupPosition % colors.length;
convertView.setBackgroundResource(R.drawable.row_forground);
GradientDrawable drawable = (GradientDrawable) convertView.getBackground();
drawable.setColor(color2[colorPos]);
... 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-08-15T21:22:34.177

肯定有代码可以绘制背景并在其上使用一些颜色。但我现在不记得了:-)
但是还有其他方法可以实现你的目标。看看这个网站： http:
[//developer.android.com/guide/topics/resources/drawable-resource.html](http://developer.android.com/guide/topics/resources/drawable-resource.html)
看看你可以准备的9patch drawables，它们只是小图像，可以根据需要缩小/扩展。你准备一个里面有其他颜色的。
第二种方法是使用 ShapeDrawable。在 XML 中，您可以在其中创建矩形和一些纯色。
在这两种情况下，您只需根据需要交换背景可绘制对象。
我不明白你想要实现什么，但我希望这能有所帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-12-31T15:00:39.837

只需在将背景资源设置为这样的视图后添加一个 ColorFilter

```
view.setBackgroundResource(R.drawable.yourRessource);
view.getBackground().setColorFilter(
                Color.yourColor,
                PorterDuff.Mode.DST_OVER
); 
```

了解有关[使用 Android 的 ColorFilter 操作图像和 Drawable 的更多信息](https://medium.com/over-engineering/manipulating-images-and-drawables-with-androids-colorfilter-25bf061843e7)

# sql - 为什么此 SQLAlchemy 查询返回未请求的不合逻辑值？

> ID：11977303
> 
> 赞同：0
> 
> 时间：2012-08-15T21:07:09.910
> 
> 标签：sql, sqlalchemy

```
 posts_query = (db.session.query(Post).
                   join(PostOption,PostOption.post_id == post_obj.id).
                   filter(and_(PostOption.key == "name",
                               PostOption.val == 'a')).
                   filter(Post.place_id == post_obj.place_id)
                   )

    print map(lambda x:get_post_values(x),posts_query.all()) 
```

返回

```
[{u'name': u'a'}, {u'name': u'a'}, {u'name': u'a'}, {u'name': u'a'}, {u'name': u'a'}, {u'name': u'a'}, {u'name': u'a'}, {u'name': u'a'}, {u'name': u'a'}, {u'name': u'a'}, {u'name': u'a'}, {u'name': u'a'}, {u'name': u'a'}, {u'name': u'a'}, {u'name': u'b'}, {u'name': u'b'}, {u'name': u'b'}, {u'name': u'b'}, {u'name': u'b'}, {u'name': u'b'}, {u'name': u'b'}, {u'name': u'b'}, {u'name': u'b'}, {u'name': u'b'}, {u'name': u'b'}, {u'name': u'b'}, {u'name': u'b'}] 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T21:12:40.657

在这里疯狂猜测：

在 and_ 中包含 place_id 子句：

```
posts_query = (db.session.query(Post).
           join(PostOption,PostOption.post_id == post_obj.id).
           filter(and_(PostOption.key == "name",
                       PostOption.val == 'a',
                       Post.place_id == post_obj.place_id))
           ) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-16T18:17:38.017

认为这是连接，看来您正在将 Post 加入 PostOptions 上 PostOption.post_id = 一些文字值。认为你的意思是这样的：

```
posts_query = (db.session.query(Post).
  join(PostOption, PostOption.post_id == Post.id).
  filter(and_(PostOption.key == "name", PostOption.val == 'a')).
  filter(Post.place_id == post_obj.place_id).
  filter(Post.id == post_obj.id)
) 
```

# objective-c - LDAP 日期到 NSDate

> ID：11977305
> 
> 赞同：1
> 
> 时间：2012-08-15T21:07:21.517
> 
> 标签：objective-c, macos, cocoa

当我执行 ldapsearch 时，我试图从 NSTask 响应中解析 pwdLastSet 值。我已成功提取值 (129875475241190194)，并尝试将其转换为 NSDate 对象。

参考： http: [//www.chrisnowell.com/information_security_tools/date_converter/Windows_active_directory_date_converter.asp](http://www.chrisnowell.com/information_security_tools/date_converter/Windows_active_directory_date_converter.asp)

我试图从上面的页面中提取 Javascript 代码并进行转换，但我得到了不同的日期。

```
 int iYearsFrom1601to1970 = 1970 - 1601;
        int iDaysFrom1601to1970 = iYearsFrom1601to1970 * 365;
        iDaysFrom1601to1970 += (int)(iYearsFrom1601to1970 / 4); // leap years
        iDaysFrom1601to1970 -= 3; // non-leap centuries (1700,1800,1900).  2000 is a leap century
        float iSecondsFrom1601to1970 = iDaysFrom1601to1970 * 24 * 60 * 60;

        int iTotalSecondsSince1601 = (int)(129875475241190194 / 10000000);

        float iTotalSecondsSince1970 = iTotalSecondsSince1601 - iSecondsFrom1601to1970;

        NSDate *date = [NSDate dateWithTimeIntervalSince1970:iTotalSecondsSince1970]; 
```

任何帮助，将不胜感激。

谢谢！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2012-08-15T23:16:09.223

这是我的做法：

```
NSDateComponents *base = [[NSDateComponents alloc] init];
[base setDay:1];
[base setMonth:1];
[base setYear:1601];
[base setEra:1]; // AD

NSCalendar *gregorian = [[NSCalendar alloc] initWithCalendarIdentifier:NSGregorianCalendar];

NSDate *baseDate = [gregorian dateFromComponents:base];
[base release];
[gregorian release];

NSTimeInterval timestamp = 129875475241190194.0 / 10000000.0;

NSDate *finalDate = [baseDate dateByAddingTimeInterval:timestamp]; 
```

这给了我一个`finalDate`.`2012-07-24 03:58:22 +0000`

由于时间戳是自 1601 年 1 月 1 日 00:00 UTC 以来的时间间隔，您可以使用`-dateByAddingTimeInterval:`on 方法`NSDate`将时间戳添加到基准日期以获取最终的`NSDate`.

完成后，您可以通过运行它`NSDateFormatter`来格式化它以供显示。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-15T23:23:12.983

假设基准时间之间的大胆转换是正确的：实际查看警告而不是将它们丢弃，实际上可能会有所帮助：

```
int main(void)
{
    int iTotalSecondsSince1601 = (129875475241190194 / 10000000);
    return 0;
}

stieber@gatekeeper:~$ clang++ Test.cpp
Test.cpp:4:8: warning: implicit conversion from 'long' to 'int' changes value from 12987547524 to 102645636
.... 
```

这应该解释了很大的差异......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-16T13:19:40.920

试试这个

```
NSTimeInterval value = 129875475241190194;
// instead of trying to compute seconds between 1601 and 1970
const NSTimeInterval EPOCH = 11644473600;
const NSTimeInterval NANO = 10000000;

NSTimeInterval seconds = value / NANO - EPOCH;
NSDate *answer = [NSDate dateWithTimeIntervalSince1970:seconds]; 
```

这也是您不想计算自 1601 年以来的秒数的原因： ...在上个千年中，1600 和 2000 是闰年，但 1700、1800 和 1900 不是。摘自维基百科的[公历](http://en.wikipedia.org/wiki/Gregorian_calendar)。

EPOCH 的值在[Convert Active Directory "LastLogon:" time to (UNIX) readable time](http://meinit.nl/convert-active-directory-lastlogon-time-to-unix-readable-time) 中进行了解释。

*注意：***accountExpires**的信息从 12-31-1601 (11644473600) 开始。**然而， lastLogon**和**lastLogonTimeStamp**值使用 01-01-1601 作为日期来计算该值 (11676009600)。

# javascript - 通过 JavaScript 或 JQuery 在 DESC 或 ASC 之前获取子字符串

> ID：11977312
> 
> 赞同：1
> 
> 时间：2012-08-15T21:07:39.877
> 
> 标签：javascript, jquery, regex

我有一些这样的网址

```
/WebSite/Movies/807?sort=MovieName&sortdir=DESC&p2=2&p3=3

/WebSite/Movies/807?sort=MovieName&sortdir=ASC&p4=4&p5=5 
```

我只需要得到一部分

```
/WebSite/Movies/807?sort=MovieName&sortdir=DESC

/WebSite/Movies/807?sort=MovieName&sortdir=ASC 
```

如何通过**JavaScript Regex 或 JQuery**完成？

我知道有一些在线工具，如[http://regexpal.com/](http://regexpal.com/)等，但我无法弄清楚如何确定字符串以 DESC 或 ASC 结尾。

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-08-15T21:12:41.920

你可以用子字符串来做

```
var sub = "";
if (string.indexOf("DESC") !== -1) {
    sub = string.substring(0, string.indexOf("DESC") + 4);
}
else if (string.indexOf("ASC") !== -1) {
    sub = string.substring(0, string.indexOf("ASC") + 3);
}

alert(sub); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T21:15:04.010

这是一个正则表达式模式，它将通过 desc 或 asc 匹配任何内容：

```
 .+[(DESC)(ASC)] 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-08-15T21:17:47.737

试试[这个](http://jsfiddle.net/Xwqk9/1/)（使用 JavaScript 和 jQuery 只是为了好玩））：

```
/.*(DESC|ASC).*/g 
```

查看组（#2 有您要查找的内容）

```
<input id="Link" value="/WebSite/Movies/807?sort=MovieName&sortdir=DESC&p2=2&p3=3" style="width: 90%;" />
<br />
<button onclick="getOrder();">Get Order</button>
<script>
getOrder = function() {
    var url = $('#Link').val()
        , regex= /.*(DESC|ASC).*/g
        , match = regex.exec(url);

    alert(match[1]);
}
</script> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-08-15T21:44:44.630

我想这已经得到了回答，但这是我一直使用的一个 fn，我将与你分享。如果您要查找的查询字符串（“key”）不存在，它将返回您在“default_”中放置的值。否则返回“key”的值。

我不记得我是从哪里弄来的。我从某个地方捡起它并做了一些温和的改进。

```
 getQuerystring = function(key, default_){
        if (default_==null) default_=""; 
        key = key.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
        var regex = new RegExp("[\\?&]"+key+"=([^&#]*)");
        var qs = regex.exec(window.location.href);
        if(qs == null)
           return default_;
        else
           return qs[1];
    } 
```

# mysql - 如何将部分数据迁移到另一个数据库

> ID：11977313
> 
> 赞同：0
> 
> 时间：2012-08-15T21:07:44.727
> 
> 标签：mysql, database, partial, data-migration

这是我第一次遇到这个问题，我不确定如何解决。

我们有一个包含数百名医生信息的网站，我需要将所有“医生”从一个 mySQL 数据库移动到另一个数据库。这是一个 Drupal 站点，信息分布在 20 个不同的表中。新的数据库也是一个Drupal站点，表结构一样，但也有新的信息不能丢失。

我应该如何从特定表中获取特定行到新数据库？

为了让它更难一点，所有的行 ID 都是自动递增的。我需要使用接下来出现的任何索引 id 插入它们，然后在其他相关表中更新该 id。为了完成这项工作，必须发生什么？

# c - 全局和局部变量的内存分配

> ID：11977316
> 
> 赞同：11
> 
> 时间：2012-08-15T21:07:48.597
> 
> 标签：c, memory-management

我了解到，全局变量的内存是在程序启动时分配的，而局部变量的内存是在进行函数调用时分配的。

**案例 1：**
我声明了一个大小为 63500000 的全局整数数组，使用的内存为 256 MB
[Ideone Link](http://ideone.com/9x4f1)

```
include <stdio.h>
int a[63500000];
int main()
{
    printf ("This code requires about 250 MB memory\n");
    return 0;
} 
```

**案例 2：**
我在 main() 中声明了一个相同大小的本地整数数组，使用的内存为 1.6 MB
[Ideone 链接](http://ideone.com/6Hd17)

```
#include <stdio.h>
int main()
{
    int a[63500000]= {1,5,0};
    printf ("This code requires only 1.6 MB \n");
    //printf ("%d\n", a[0]);
    return 0;
} 
```

**案例 3：**
我在另一个函数中声明了一个相同大小的本地整数数组，使用的内存为 1.6 MB
[Ideone Link](http://ideone.com/K88cf)

```
#include <stdio.h>
void f()
{
    int a[63500000];
}

int main()
{
    f();
    return 0;
} 
```

请解释为什么使用的内存有所不同或我的内存分配概念是错误的？？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2012-08-15T21:34:58.490

首先：ideone编译器是GCC。

那么，当你编译这个时，GCC 会做什么呢？：

```
void foo ()
{
  int a[63500000];
} 
```

`gcc -S -O2 foo.c`生成：

```
foo:
    pushl   %ebp
    movl    %esp, %ebp
    popl    %ebp
    ret 
```

即，*根本**没有*在堆栈上分配任何内容。

 ***该数组被 GCC 简单地优化掉了，因为它从未被使用过。**

GCC 不会对全局执行此操作，因为可能在另一个编译单元中使用了全局，因此不确定它是否从未使用过。另外：全局*不在*堆栈上（因为它是全局的）。

现在，让我们看看当你实际*使用*本地数组时会发生什么：

```
int bar (int a, int b, int c)
{
  int f[63500000];
  f[a] = 9;
  f[b] = 7;
  return f[c];
} 
```

情况非常不同：

```
bar:
    pushl   %ebp
    movl    %esp, %ebp
    subl    $254000000, %esp
    movl    8(%ebp), %eax
    movl    $9, -254000000(%ebp,%eax,4)
    movl    12(%ebp), %eax
    movl    $7, -254000000(%ebp,%eax,4)
    movl    16(%ebp), %eax
    movl    -254000000(%ebp,%eax,4), %eax
    leave
    ret 
```

这一行：`subl $254000000, %esp`对应于数组的大小。即内存*是*在堆栈上分配的。

现在，如果我尝试`bar`在程序中使用该函数会怎样：

```
int bar (int a, int b, int c)
{
  int f[63500000];
  f[a] = 9;
  f[b] = 7;
  return f[c];
}

int main (void)
{
  return bar (0, 0, 0);
} 
```

我们已经看到，该`bar`函数在堆栈上分配了大约 250 兆字节。在我的默认 GNU/Linux 安装中，堆栈大小限制为 8MB。因此，当程序运行时，会导致“分段错误”。如果需要，我可以通过在 shell 中执行以下命令来增加它：

```
ulimit -s 1000000 #i.e. allow stack size to grow close to 1GB 
```

然后我可以运行程序，它确实会运行。

它在 ideone 网站上失败的原因是他们在执行程序时限制了堆栈大小（他们应该这样做，否则恶意用户可能会弄​​乱他们的系统）。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-08-15T21:12:17.630

**案例 2、3**

您在函数内部定义的变量在堆栈上分配。这意味着当函数退出时，相关的内存被清理（堆栈被“弹出”）。

**情况1**

在全局范围内定义的变量分配在一个数据段（或者，通常是从操作系统请求的内存空间）中，该数据段存在于进程的生命周期中。

**此外**

使用*malloc*分配的内存是从堆中分配的，并且在使用*free*显式释放之前一直保持分配状态。

请注意，现代操作系统可能会提供程序请求的地址空间，但不会在物理上用 RAM 支持该地址空间，直到内存（或通常称为*页面*的内存的一部分）被物理访问。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-08-15T21:23:43.007

**`case 2`**并且**`case 3`**会导致堆栈溢出，因为您要求**64 MB**的堆栈内存，其中您的堆栈在 Linux 上通常为**8 MB 。**这将导致随机的坏事和/或核心转储和崩溃。

[这个](https://stackoverflow.com/a/1171517/143897)答案极大地解释了进程地址空间（.text、.bss、.data）的各个部分以及如何完成变量的各种分配。*

# c# - 计算socket c#中传输文件的速度

> ID：11977317
> 
> 赞同：0
> 
> 时间：2012-08-15T21:07:56.223
> 
> 标签：c#, performance, sockets

我研究了很多，我找到了一种计算方法，但我不相信
请帮我解决它？？？:(
那是我的代码

```
while (sum < length)
{
    stopWatch.Restart();
    if (length - sum > packetSize)
    {
        count = fileStream.Read(buffer, 0, packetSize);
        Send(socket_File, buffer);
    }
    else
    {
        buffer = new byte[length - sum];
        count = fileStream.Read(buffer, 0, length - sum);
        Send(socket_File, buffer);
    }
    stopWatch.Stop();
    sum = sum + count;
    SendFile.Downloaded = sum;
    SendFile.Transfer_rate = ((sum * 8) / stopWatch.ElapsedMilliseconds).ToString();//kbps
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T21:17:42.183

一些随机点：

*   您可能想在循环之外采样时钟，而不是在每次迭代时，
*   一些文件读取时间也包含在您的计算中，
*   您正在测量将字节放入 OS 套接字缓冲区的时间，而不是实际传输。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-16T01:06:55.000

> 我不相信

为什么不？在您确定问题之前，没有人可以解决问题。

但是，您的*复制*代码全错了。您假设读取填充了缓冲区。您不能假设使用 TCP。

```
if (length - sum > packetSize)
{
    count = fileStream.Read(buffer, 0, packetSize);
}
else
{
    count = fileStream.Read(buffer, 0, length - sum);
}
Send(socket_File, buffer, count); 
```

当然，秒表的开始和停止以及打印输出应该在循环之外，否则你只是在计时单个读/写对。

# javascript - Javascript 语法——我做错了什么？

> ID：11977322
> 
> 赞同：0
> 
> 时间：2012-08-15T21:08:07.290
> 
> 标签：javascript

我是 JavaScript 新手。我有两份文件——一个旧的和一个新的——我正在比较。但是，我在下面的代码中的某处遇到语法错误。
在这里的某个地方，我的代码正在爆炸。错误说“表达式不评估函数。” 关于我在哪里写了不正确的陈述的任何句法想法？

```
if(userCtx.name != oldDoc.Document.attributeA) { 
        for (var key in oldDoc.Document)
        {
          if(newdoc.Document.hasOwnProperty('key')
          {
            if(oldDoc.Document[key] != newDoc.Document[key])
            {
               if(key === 'attributeB')
               {
                 return;
               }
               else
               {
                 throw(forbidden: 'Only admins may change this field.')
               }
            }
          }
        }
    } 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-08-15T21:09:46.127

```
if(newdoc.Document.hasOwnProperty('key') <-- I am missing a ) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-08-15T21:10:30.967

要抛出对象文字，请将圆括号替换为大括号：

```
throw {
    forbidden: 'Only admins may change this field.'
}; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T21:34:59.960

您发布的代码是否在函数定义中？在定义作为参数传递给其他东西的函数时，我已经看到了该错误，并且忘记将函数包装在括号中。例如：
`"compare": "function(docA, docB) { ... }"`
应该是：
`"compare": "(function(docA, docB) { ... })"`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-08-15T21:36:08.223

可能还有一个……这是在函数内部吗？如果不是，您可能会在`return;`

# php - 在 mysql REGEXP 查询中转义单引号

> ID：11977333
> 
> 赞同：1
> 
> 时间：2012-08-15T21:08:39.450
> 
> 标签：php, mysql, regex

我尝试在 mysql 中使用正则表达式，它运行良好，除非我在单词中使用引号。

例如：

```
SELECT * FROM table WHERE REGEXP "^pagina's[^[:space:]]*$" 
```

我尝试了以下所有方法：

```
SELECT * FROM table WHERE REGEXP "^'.preg_quote("pagina's").'[^[:space:]]*$" 
```

和

```
SELECT * FROM table WHERE REGEXP "^'.addslashes("pagina's").'[^[:space:]]*$" 
```

和

```
SELECT * FROM table WHERE REGEXP "^'.mysql_escape_real_string("pagina's").'[^[:space:]]*$" 
```

没运气..

由于单词“pagina's”中的单引号（'），它不会给我任何结果。

如何转义所有引号，以便 mysql 看到引号文字并匹配数据库中的字段？

** 编辑 **

这是我的 PHP 代码：

```
$word = "pagina's";
$ary[] = "LOWER(idx.sidx_word) REGEXP '^".preg_quote($word)."[^[:space:]]*$'"; 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T21:14:33.147

您需要指定一个表和一个列名......并且您没有正确地转义引号。尝试这样的事情：

```
SELECT *
FROM table
WHERE column REGEXP '^pagina''s[^[:space:]]*$'; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-16T06:40:50.950

您必须为正则表达式指定一个列名并用斜杠转义引号：

```
SELECT *
FROM table
WHERE column REGEXP '^pagina\'s[^[:space:]]*$'; 
```

# ruby-on-rails - 带有辅助方法的 Rails 自定义验证消息

> ID：11977335
> 
> 赞同：2
> 
> 时间：2012-08-15T21:08:45.877
> 
> 标签：ruby-on-rails, ruby-on-rails-3, validation, ruby-on-rails-3.2

我正在尝试为唯一性验证提供自定义验证消息。但是，对于错误消息，我需要稍微复杂的行为，所以我将这个逻辑放在一个私有方法（`error_message_for_email_uniqueness`）中。

这是我正在使用的代码

```
validates_uniqueness_of :email, message: error_message_for_email_uniqueness 
```

这是我得到的错误

```
/Users/dylandrop/.rvm/gems/ruby-1.9.2-p290/gems/attr_encrypted-1.2.0/lib/attr_encrypted.rb:229:in `method_missing': undefined local variable or method `error_message_for_email_uniqueness' for #<Class:0x00000103684198> (NameError) 
```

我试过使用`message: lambda { error_message_for_email_uniqueness }`，它也不起作用。另外，我尝试将它包装在 Proc 而不是 lambda 中，这对我没有任何帮助。

我怎样才能解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T21:38:10.017

您是否将 error_message_for_email_uniqueness 定义为类方法？

我做了一个快速测试，效果很好：

```
validates_uniqueness_of :email, message: Proc.new { error_message_for_email_uniqueness }

def self.error_message_for_email_uniqueness
  # logic to generate message goes here
end 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-15T21:42:14.123

如果要根据模型属性或其他内容动态创建消息，则应创建自定义验证器，因为消息应为字符串。

# c# - 需要一个 asp.net webservice 的安全场景

> ID：11977336
> 
> 赞同：2
> 
> 时间：2012-08-15T21:08:48.183
> 
> 标签：c#, asp.net, web-services, winapp

我开发了一个 .Net 3.5 windows 窗体应用程序。我还想设计一个网站，它有一个带有多个 Web 方法的 Web 服务来查询主机上的数据库。我希望只能通过我的 winapp 和我的网站调用网络服务！而且我不希望任何其他人能够调用和使用我的 web 服务，但只有一些有权访问我开发的 windows 应用程序的人。

为此，我需要一个良好的安全方案！我真的很感谢任何可以帮助我的人，因为这是我开发 Web 服务的第一次体验，我真的需要它像我提到的那样安全！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T21:27:50.453

What you're talking about is going to be difficult to do for several reasons, but primarily this:

***If you put anything in code on your WinForms app, it can be decompiled very easily. You can obfuscate the code all you like, but it can be de-compiled.***

Because of that, any code that you have in your app can be read by anyone with access to the code. *You should always treat any WinForms app as if it's completely compromised, and ensure that the security at the server end compensates.*

Because of this, you can't simply store usernames and passwords in configuration files or in code. You have to come up with something else. You CAN use authentication and prompt the user to enter a username/password on program launch, and use that. However, people tend to share these things, so you may want to go for extra protection.

You can put the connection info, or secrets into the app.config and encrypt it, but anyone who can de-compile the code, can recompile it, and add code to decrypt it at will.

You can provide signed keys with your app, and use that in an authentication mechanism, but that can be bypassed.

You can restrict your IP address to specific IP addresses, but those can be spoofed.

**However...**

By layering all of the above techniques, you can make it difficult for an attacker to bypass your precautions. We did the following in one of our apps where we had a similar requirement:

*   We set up a database that holds a GUID record for each authorized customer, and IP addresses allowed for that customer.
*   Every web method expects a CustomerKey parameter. (the guid mentioned above) Each call to a web service checks the key against the IP address.

    *   If it matches, valid data is returned.
    *   If it fails, ***valid looking*** data is returned. We actually return what looks like good data, but it's really not. This makes it harder for an attacker to know if they've actually broken through the defenses.
*   In the WinForms app, the key is stored in the app.config, which is encrypted in the main() event (the entry point for WinForms apps). This is to prevent the casual reader from accessing it.
*   The program is launched automatically on install, so that the encryption happens at startup, to minimize the chance someone can read the file before it's encrypted.
*   Also, the code is obfuscated.

Layering the defenses, hopefully, will discourage the average attacker.

Microsoft has some guidelines as well: [http://msdn.microsoft.com/en-us/library/ff648643.aspx](http://msdn.microsoft.com/en-us/library/ff648643.aspx)

# vba - 没有 VBA 的复杂枢轴式摘要

> ID：11977339
> 
> 赞同：3
> 
> 时间：2012-08-15T21:09:05.953
> 
> 标签：vba, excel, excel-2003, pivot-table

给定一组这样的数据：

```
User    Item1 Desc.    Item1 Sel.    Item2 Desc.    Item2 Sel.    Item3 Desc.    Item3 Sel.
UserA   Item 1         Yes           Item 2         Yes           Item 3         Yes
UserB   Item 1         Yes           Item 2         No            Item 3         No
UserB   Item 1         Yes           Item 2         Yes           Item 3         No
UserC   Item 1         Yes           Item 2         No            Item 3         Yes
UserA   Item 1         No            Item 2         Yes           Item 3         Yes
UserA   Item 1         Yes           Item 2         No            Item 3         Yes 
```

有没有办法可以使用内置的 Excel 工具、函数或公式来生成这样的输出

```
Item    UserA    UserB    UserC
Item1   1        0        0
Item2   1        1        1
Item3   0        2        0 
```

其中`Items`和`Users`被合并，并且呈现的值是表中 s 的计数`No`？

我被要求为我的一位同事准备这个，最后在下面创建了 VBA 函数。它又快又脏，当然需要重构，但它确实让我得到了我需要的东西。

```
Sub SummarizeData()

Dim wksSrc As Worksheet
Dim dicAssoc As Object
Dim l As Long
Dim i As Integer
Dim rngCell As Range
Dim v As Variant

    Set dicAssoc = CreateObject("Scripting.Dictionary")
    With ThisWorkbook.Sheets.Add()
        .Name = "Results"
        Set wksSrc = ThisWorkbook.Sheets("data")
        For l = 2 To 184
            If Not dicAssoc.exists(wksSrc.Range("C" & l).Value) Then
                dicAssoc.Add wksSrc.Range("C" & l).Value, wksSrc.Range("C" & l).Value
            End If
        Next l
        .Range("A1:A26").Value = ThisWorkbook.Sheets("Sheet5").Range("A1:A26").Value
        l = 2
        For Each v In dicAssoc.items
            .Cells(1, l).Value = v
            l = l + 1
        Next v
        For Each rngCell In wksSrc.Range("A2:CT184").Cells
            For l = 2 To 26
                If rngCell.Value = .Cells(l, 1).Value Then
                    If rngCell.Offset(0, 1).Value = "No" Then
                        For i = 2 To 148
                            If .Cells(1, i).Value = wksSrc.Range("C" & rngCell.Row).Value Then
                                .Cells(l, i).Value = .Cells(l, i).Value + 1
                            End If
                        Next i
                    End If
                End If
            Next l
        Next rngCell
    End With
End Sub 
```

我最初试图在没有代码的情况下解决这个问题，但经过一些试验和错误后，我决定最好不要在这个项目上浪费我的一整天。我以为我可以尝试`DCOUNTA`，但这需要我提取多行额外的数据，这会浪费空间：

`DCOUNT`标准示例：

```
Item1 Sel.    Item2 Sel.    Item3 Sel.    User
No                                        UserA
              No                          UserA
                            No            UserA
No                                        UserB
              No                          UserB
                            No            UserB 
```

等等等等。大约有 25 个项目和大约 25 个用户，这将是一个巨大的块，其中大部分都必须手动创建。在那一点上，我还不如手动计算一切。

我还考虑过使用, , 和的一些组合`VLOOKUP`，但我永远无法得到一个计算*所有*s的结果；它总是抓住它找到的第一行。`HLOOKUP``INDEX``INDIRECT`*`No`*

 **我想知道是否有一种相对简单的方法可以在**不**使用 VBA 的情况下生成此摘要。*

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-08-15T21:33:27.757

`SUMPRODUCT`使用公式可以轻松实现您想要的。

请参阅随附的示例和屏幕截图。

要查找项目 1 和用户 1 的“否”编号，我使用的公式是

```
=SUMPRODUCT(($A$2:$A$7=$B$11)*($C$2:$C$7="No")) 
```

同样，您必须为其余部分执行此操作。

**示例文件**：

[http://wikisend.com/download/725440/Gaffi.xlsx](http://wikisend.com/download/725440/Gaffi.xlsx)

**快照**：

![在此处输入图像描述](../Images/195630a59b51ecae2eb2c1dad20b34b3.png)*

# actionscript-3 - Function.call(someInstance,args) 用于方法。忽略第一个参数

> ID：11977341
> 
> 赞同：2
> 
> 时间：2012-08-15T21:09:08.423
> 
> 标签：actionscript-3, call, this

在 as3 中，有一种灵活的方法可以在调用对象实例时更改它。可以使用特定的第一个参数调用函数对象的调用或应用成员，并且引用说我们，这个第一个参数将是函数内部的“this”指针。但我发现它错了。

我写了一些小测试，如下所示。

```
public class Test 
{
  private var name:String = "default";
  public var test3:Function = test;
  public var test2:Function = function()
  {
    trace(this.name);
  }

  public function Test(name:String) 
  {
    this.name = name;
  }

  public function test():void
  {
    trace(this.name);
  }
} 
```

并对其进行了测试。

```
var tmp:Test = new Test("default");
tmp.test();  //out default
tmp.test.call(new Test("new"));  //out default

tmp.test2(); //out default
tmp.test2.call(new Test("new2")); //out new2

tmp.test3(); //out default
tmp.test3.call(new Test("new3")); //out default 
```

因此，在匿名函数调用中，我们可以获得正确的输出，但在成员函数的情况下则不行。也许是因为模棱两可的“this”指针，它应该为正确的工作提供真实的对象实例，也许还有其他的。我现在不知道，as3 参考并没有描述它。

最后列出问题：

1.  为什么这样？对我来说，这很奇怪，看起来像是未定义的行为；
2.  我怎样才能实现该功能？如何欺骗匿名测试功能？不是调用方法目标吗？

这不是很重要，但我会很高兴任何好的答案。谢谢！

PS对不起我的英语。

//已编辑：将此语句添加到所有“名称”引用中。没有什么变化。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-16T00:30:11.053

> 调用 [[Call]] 属性时，不同类型的闭包的行为是不同的。闭包是一个包含对方法的引用的对象，并且 [[Call]] 属性的行为不同，具体取决于它是函数、方法还是类闭包。函数闭包是一个与类的任何实例都不相关的全局方法。方法闭包包含一个类的实例方法，并且将始终记住它的原始“this”值。
> 
> 如果闭包是函数闭包，则传递给 [[Call]] 的第一个参数将传递给方法并用作“this”值。如果第一个参数为 null 或未定义，则全局对象将用作方法的“this”值。
> 
> 如果闭包是一个方法闭包，那么 [[Call]] 的第一个参数将被忽略，并且为方法闭包保存的“this”值将作为第一个参数传递给该方法。方法闭包记录其原始“this”值是什么，并且始终使用该值而不是 [[Call]] 的第一个参数。
> 
> 如果闭包是类闭包，并且有 1 个参数传递给 [[Call]]（除了 "this" 参数），则调用被视为类型转换，参数将被强制转换为类型由闭包表示。

[http://learn.adobe.com/wiki/display/AVM2/2.4+Method+invocation+notes](http://learn.adobe.com/wiki/display/AVM2/2.4+Method+invocation+notes)

# c# - codedom 添加参考

> ID：11977342
> 
> 赞同：0
> 
> 时间：2012-08-15T21:09:10.293
> 
> 标签：c#, reference, codedom, mail-sender

我想做一个邮件发件人生成器。但我对代码域参考有疑问。我的结果是：“命名空间‘System.Net’中不存在类型或命名空间名称‘Mail’（您是否缺少程序集引用？）”

我无法添加 system.net.mail 因为 system.net.mail 不是 dll 文件。我的代码：

```
using System;
using System.Collections.Generic;
using Microsoft.CSharp;
using System.CodeDom.Compiler;
using System.Runtime.InteropServices;

namespace compilerTest
{
    class Program
    {
        static void compileIt1()
        {
            //mail sender code
            string source =
            @"
using System;
using System.Collections.Generic;
using System.Text;
using System.Net.Mail;
using System.Net;

namespace mail_sender
{
    class Program
    {
        static void Main(string[] args)
        {

           SmtpClient smtp = new SmtpClient(""smtp.gmail.com"", 587);

            NetworkCredential myCredentials = new NetworkCredential(""sendermail@gmail.com"", ""password"");

            smtp.Credentials = myCredentials;

            smtp.EnableSsl = true;
            ServicePointManager.ServerCertificateValidationCallback = (s, cert, chain, ssl) => true;
            smtp.Send(""sendermail@gmail.com"", ""tomaill@gmail.com"", ""titel"", ""mail body"");
            Console.ReadKey();
        }

    }

}
           ";

            //version
            Dictionary<string, string> providerOptions = new Dictionary<string, string>
                {
                    {"CompilerVersion", "v3.5"}
                };
            //code type
            CSharpCodeProvider provider = new CSharpCodeProvider(providerOptions);

            //output file
            CompilerParameters compilerParams = new CompilerParameters
            {
                OutputAssembly = "D:\\mailsender.EXE",
                GenerateExecutable = true
            };
            compilerParams.ReferencedAssemblies.Add("System.Net.Dll");

            //compile
            CompilerResults results = provider.CompileAssemblyFromSource(compilerParams, source);

            //errors
            Console.WriteLine("Number of Errors: {0}", results.Errors.Count);
            foreach (CompilerError err in results.Errors)
            {
                Console.WriteLine("ERROR {0}", err.ErrorText);
            }
        }

        static void Main(string[] args)
        {
            compileIt1();
            Console.WriteLine("Press a key...");
            Console.ReadKey();
        }
    }
} 
```

我有：.net 3.5 VS 2010

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T23:39:42.690

`SmtpClient`等。在`System`程序集中定义，而不是`System.Net`.

# loops - 文本文件被覆盖且未附加

> ID：11977348
> 
> 赞同：0
> 
> 时间：2012-08-15T21:09:39.453
> 
> 标签：loops, io, python-2.7

到目前为止，我有这个程序做我想做的事。但是，在运行时，它将覆盖最后一个员工记录，而不仅仅是添加到文件中。我是 prgramming 的新手，已经盯着这个看了好几个小时了，但我还是看不懂。只需要在正确的方向上轻轻一点。

```
# Define Employee Class
# Common Base Class for all Employees
class EmployeeClass:
def Employee(fullName, age, salary):
    fullName = fullName
    age = age
    salary = salary
def displayEmployee():
    print("\n")
    print("Name: " + fullName)
    print("Age: " + age)
    print("Salary: " + salary)
    print("\n")

EmployeeArray = []

Continue = True
print ("Employee Information V2.0")

while Continue == True:
print ("Welcome to Employee Information")
print ("1: Add New Record")
print ("2: List Records")
print ("3: Quit")

choice = input("Pick an option: ")

if choice == "1":
    fullName = input ("Enter Full Name: ")
    if fullName == "":
        blankName = input ("Please enter a name or quit: ")
        if blankName == "quit":
            print ("Goodbye!")
            print ("Hope to see you again.")
            Continue = False
            break
    age = input ("Enter Age: ")
    salary = input ("Enter Salary: ")
    EmployeeRecords = open ('EmployeeRecords.txt' , 'w')
    EmployeeRecords.write("Full Name: " + fullName + '\n')
    EmployeeRecords.write("Age: " + age + '\n')
    EmployeeRecords.write("Salary: " + salary + '\n')
    EmployeeRecords.close()
elif choice == "2":
    EmployeeRecords = open ('EmployeeRecords.txt', 'r')
    data = EmployeeRecords.read()
    print ("\n")
    print (data)
    EmployeeRecords.close
elif choice == "3":
    answer = input ("Are you sure you want to quit? " "yes/no: ")
    if answer == "yes" or "y":
        print ("Bye!")
        Continue = False
    else:
        Continue
else:
    print ("Please choose a valid option")
    print ("\n") 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T21:14:47.610

附加模式应该可以工作。

```
EmployeeRecords = open('EmployeeRecords.txt', 'a') 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T21:16:48.830

根据传递给 open 的控制字符串，您每次都打开要重写的文件。更改`open ('EmployeeRecords.txt, 'w')`为`open ('EmployeeRecords.txt', 'a+')`。并且记录将附加到文件的末尾。

# c# - 如何绘制动态创建的按钮控件？

> ID：11977354
> 
> 赞同：0
> 
> 时间：2012-08-15T21:09:57.113
> 
> 标签：c#, winforms

这是我的代码：

```
Button b = new Button();
Graphics g = b.CreateGraphics();

g.DrawString("Hello World", new Font(FontFamily.GenericSerif, 5), Brushes.Red, new PointF(1, 1));

b.Height = 100;
b.Width = 100;

this.Controls.Add(b); 
```

我得到一个按钮，但上面没有图像..

我正在使用以下代码，它可以满足我的需要。感谢大家。

```
Button b = new Button();
b.Height = 100;
b.Width = 100;

Bitmap bitmap = new Bitmap(b.Height, b.Width);
Graphics g = Graphics.FromImage(bitmap);
g.DrawString("Hello World", new Font(FontFamily.GenericSerif, 5), Brushes.Red, new PointF(1, 1));

b.Image = bitmap;
this.Controls.Add(b); 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-16T11:39:04.953

使用 Button Image 属性将图像设置到按钮上。

```
 Button b = new Button();
 Bitmap picture = new Bitmap();
 b.Image = picture; 
```

# javascript - Jquery 无法在单击时选择和取消选择 td

> ID：11977364
> 
> 赞同：0
> 
> 时间：2012-08-15T21:10:35.663
> 
> 标签：javascript, html, jquery

我写了 2 个 jquery 函数。第 1-11 行是第一个在 mousedown 上绑定 mouseover 事件以获得单击和拖动以选择 td 的效果（内部选中/取消选中复选框）。

第二个功能（12-20）是单击并取消单击单个 td 以选中和取消选中复选框。我可以执行 mousedown 并选择多个 td，但我无法单击并取消单击单个 td。我不确定问题出在哪里？任何建议表示赞赏。

这是代码：

```
$("#tbl td").mousedown(function() {
    $("#tbl td").bind('mouseover', function() {
        var checkbox = $(':checkbox', this)[0];
        $(this).css({
            'background': (checkbox.checked ? 'white' : '#6D7B8D')
        });
        checkbox.checked = !checkbox.checked;
    });
    $(this).mouseover();
}).mouseup(function(event) {
    $("#td").unbind('mouseover');
    event.preventDefault();
    event.stopPropagation();
});

$('#tbl td').click(function(e) {
    if ($(this).find('input:checkbox').is(':checked')) {
        $(this).find('input:checkbox').attr("checked", "");
        $(this).css({
            background: "white"
        });
    } else {
        $(this).find('input:checkbox').attr("checked", "checked");
        $(this).css({
            background: "#6D7B8D"
        });
    }
});​ 
```

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T22:14:44.260

好吧，我不确定这是否是您真正需要的，但也许可以提供帮助。

***（只是要知道，如果你把 HTML 代码放进去会很有帮助！）***

**现场演示：http:** [//jsfiddle.net/oscarj24/TATg7/](http://jsfiddle.net/oscarj24/TATg7/)

**代码：**

```
$('#tbl').on('mousedown, mouseover, mouseup, click', 'td', function(e) {
    if(e.type == 'mousedown'){
        $(this).mouseover();
    } else if(e.type == 'mouseover'){
        var checkbox = $('input:checkbox');
        $(this).css({'background': (checkbox.is(':checked') ? 'white' : '#6D7B8D')});
        checkbox.prop('checked', !checkbox.checked);    
    } else if(e.type == 'mouseup'){
        $(this).unbind('mouseover');
        e.preventDefault();
        e.stopPropagation();
    } else if(e.type == 'click'){
        var checked = $('input:checked').is(':checked');
        checked ? background = 'white' : background = '#6D7B8D';
        $('input:checked').prop('checked', !checked);
        $(this).css({background: background});
    }
});
​ 
```

# c# - 如何返回集合中拥有特定类型接口属性的所有项目？

> ID：11977366
> 
> 赞同：0
> 
> 时间：2012-08-15T21:10:36.443
> 
> 标签：c#, linq

我有一个 ApprovalTicket 类，它有一个名为 ApprovalRules 的 IApproval 类型的属性：

```
IApproval ApprovalRules; 
```

该字段将包含实现该接口的几种不同类型的类。现在升级一个级别，我将有一个 ApprovalTickets 列表。我想要做的是使用 linq 返回具有 MocReviewerApproval 类型的 ApprovalRules 的 ApprovalTicket 列表。

我正在尝试类似的东西：

```
var reviews = request.MocApprovalTasks
  .Where(mocApproval => mocApproval.ApprovalRules is MocReviewerApproval)
  .ToList(); 
```

但是当我检查返回的列表时，它仍然包括具有 MocManagerApproval 的 ApprovalRules 类型的票证和其他票证。我错过了什么？

更新：

让我更具体一点。这是继承方案

```
MocApproval : TaskTicket
    >>IApproval ApprovalRules;

MocReviewerApproval : IApproval
MocManagerApproval : IApproval
MocControllerApproval : IApproval

    internal interface IApproval
    {
        bool Approve(Guid approverGuid, MocApproval approval);
        bool Deny(Guid approverGuid, MocApproval approval, TaskComment denialComment);
        bool Close(Guid approverGuid, MocApproval approval, TaskComment closeComment);
        bool Notify();
        void Set(MocApproval approval);
        User GetAssignee();
        TaskComment GetNotificationComment();
    } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T21:18:03.570

`is`意味着，可以有效地转换为，而不是，“正是这种类型”。在您的情况下，任何子类`MocReviewerApproval`仍将返回 true。您可以使用：

```
 mocApproval.ApprovalRules.GetType() == typeof(MocReviewerApproval) 
```

以确保该类型，并且只有该类型，将返回 true。话虽如此，拥有这样的东西有点糟糕的代码气味。考虑问问自己这是否真的是你想要的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T21:18:19.747

你的代码对我来说看起来不错。我怀疑你有诊断问题，或者你根本不追求`is`那种关系。这是一个完整的例子，展示了它的工作原理：

```
using System;
using System.Collections.Generic;
using System.IO;
using System.Linq;

class Foo
{
    public object Value { get; set; }
}

class Test
{
    static void Main()
    {
        var list = new List<Foo>
        {
            new Foo { Value = "" },
            new Foo { Value = 10 },
            new Foo { Value = new object() },
            new Foo { Value = new MemoryStream() }
        };

        ShowCount<IDisposable>(list); // 1 (MemoryStream)
        ShowCount<IFormattable>(list); // 1 (Int32)
        ShowCount<IComparable>(list); // 1 (String, Int32)
    }

    static void ShowCount<T>(List<Foo> list)
    {
        var matches = list.Where(f => f.Value is T)
                          .ToList();
        Console.WriteLine("{0} matches for {1}", 
                          matches.Count, typeof(T));
    }
} 
```

编辑：如果您想要*完全*符合给定类型的匹配项，请使用：

```
var reviews = request.MocApprovalTasks
                     .Where(task => task.ApprovalRules.GetType() == 
                                           typeof(MocReviewerApproval))
                     .ToList(); 
```

这比根据 Servy 的原始答案查找名称更便于重构。

# rally - 可以锁定缺陷以防止创建任务吗？

> ID：11977369
> 
> 赞同：0
> 
> 时间：2012-08-15T21:10:43.823
> 
> 标签：rally

是否有可能以用户无法为该缺陷创建任务的方式故意锁定 Rally 缺陷？

我们的指标收集工具正在处理 Rally 故事。我们的缺陷流程应该是，用户在产生缺陷的原始故事下创建一个或多个任务。

不幸的是，并不是所有的团队成员都记得/遵循这个过程。我们最终得到了直接与缺陷相关的任务，这些任务在我们的度量数据拉取中没有得到报告。

我想我可以重写度量数据拉取应用程序，但作为一种快速修复，我希望只是防止创建有缺陷的任务。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-16T19:59:05.020

不幸的是，Rally 权限模型并不是那么精细。对权限模型进行更严格的控制是一种流行的功能要求。我鼓励您对以下内容进行投票：

[更细化的用户权限](http://ideas.rallydev.com/ideas/D391)

[拉力赛](http://ideas.rallydev.com)的想法

为这个增强请求赢得投票和可见性。

# java - 使用 DButils 从 MS Access 中选择 COUNT 到 JTable

> ID：11977371
> 
> 赞同：0
> 
> 时间：2012-08-15T21:11:07.507
> 
> 标签：java, sql, select, count, jtable

我有一个到 MS Access 数据库的 JDBC:ODBC 连接，该数据库使用 DButils 填充 JTable。我的基本 SQL 查询工作正常，直到我尝试 COUNT 函数，然后在尝试填充我的 JTable 时出现错误。查询可以很好地填充 JTextArea，所以我知道查询没问题。我的代码低于任何帮助将不胜感激。

```
 import javax.swing.JFrame;
    import javax.swing.JScrollPane;
    import javax.swing.JTable;
    import java.sql.*;
    import net.proteanit.sql.DbUtils;

public class table {
    Connection con;
    Statement st;
    ResultSet rs;

    public table(){
        connect();
    }
    public void connect(){

        JTable tbl = new JTable();
        tbl.setDefaultEditor(Object.class, null);
        JFrame resFrame = new JFrame("Results");
        resFrame.setLayout(null);
        resFrame.setSize(525, 445);
        resFrame.setVisible(true);
        JScrollPane tsp = new JScrollPane(tbl);
        tsp.setLocation(20, 20);
        resFrame.add(tsp);
        tbl.setAutoResizeMode(JTable.AUTO_RESIZE_OFF);
        tsp.setSize(370,375);

        String sql = "SELECT Club, COUNT('memberID') AS total FROM Members_Table, Club_Table WHERE Club_Table.clubID=Members_Table.clubID GROUP BY Club";

        try{

            String driver = "sun.jdbc.odbc.JdbcOdbcDriver";
            Class.forName(driver);
            String db = "jdbc:odbc:ITUKdb";
            con = DriverManager.getConnection(db);
            st = con.createStatement(ResultSet.TYPE_SCROLL_INSENSITIVE,ResultSet.CONCUR_UPDATABLE);
            rs = st.executeQuery(sql);
            tbl.setModel(net.proteanit.sql.DbUtils.resultSetToTableModel(rs));
        }catch(Exception ex){

        }
    }
} 
```

我得到的错误如下

```
java.sql.SQLException: [Microsoft][ODBC Driver Manager] Invalid cursor state
    at sun.jdbc.odbc.JdbcOdbc.createSQLException(JdbcOdbc.java:6956)
    at sun.jdbc.odbc.JdbcOdbc.standardError(JdbcOdbc.java:7113)
    at sun.jdbc.odbc.JdbcOdbc.SQLGetDataString(JdbcOdbc.java:3906)
    at sun.jdbc.odbc.JdbcOdbcResultSet.getDataString(JdbcOdbcResultSet.java:5697)
    at sun.jdbc.odbc.JdbcOdbcResultSet.getString(JdbcOdbcResultSet.java:353)
    at sun.jdbc.odbc.JdbcOdbcResultSet.getObject(JdbcOdbcResultSet.java:1677)
    at net.proteanit.sql.DbUtils.resultSetToTableModel(DbUtils.java:28)
    at trial.table.connect(table.java:53)
    at trial.table.<init>(table.java:22)
    at trial.ITUKSQL.main(ITUKSQL.java:212) 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-16T14:19:02.280

排序必须删除

```
ResultSet.TYPE_SCROLL_INSENSITIVE,ResultSet.CONCUR_UPDATABLE 
```

从

```
 st = con.createStatement(); 
```

# sql-server - 部署使用 SQL Server 用户实例的 Winfoms 应用程序时，我应该将 MDF、LDF 文件放在哪里？

> ID：11977379
> 
> 赞同：0
> 
> 时间：2012-08-15T21:11:22.977
> 
> 标签：sql-server, visual-studio-2010, mdf

我有一个使用 Entity Framework 4.3.1.0 编写的 C# 应用程序，它与我在 Visual Studio 2010 中的开发机器上的 SQL Server 2008 用户实例对话。它也适用于我在 Visual Studio 中的笔记本电脑。但是在客户的台式电脑上，使用 SQL Server 2008 R2 我无法使用应用程序连接到数据库。错误是

> *基础提供程序在打开时失败*

三台计算机都是 Windows 7 64 位，但应用程序是 32 位。

我怀疑 中的连接字符串`myapp.exe.config`，但它与我在 Visual Studio 中使用的相同。

在进行研究时，我提出了两种可能性。

1.  相同的连接字符串是否适用于 SQL Server 2008 和 SQL Server 2008 R2？
2.  文件的位置是否`.mdf / .ldf`重要，我最初将它们安装在应用程序文件夹中，但可能有更好的位置，例如预定义的`AllUsersAppData`. 服务器文件的应用程序文件夹是只读的吗？

这是 app.config 中的 ConnectionStrings 部分。不知道是不是两个都需要。

```
 <connectionStrings>
    <add name="DataClass.Properties.Settings.SWDatabaseEntities" connectionString="Data Source=.\SQLEXPRESS;AttachDbFilename=|DataDirectory|\SWDatabase.mdf;Integrated Security=True;User Instance=True" providerName="System.Data.SqlClient" />
    <add name="SWDatabaseEntities" connectionString="metadata=res://*/SWDatabaseModel.csdl|res://*/SWDatabaseModel.ssdl|res://*/SWDatabaseModel.msl;provider=System.Data.SqlClient;provider connection string=&quot;data source=.\SQLEXPRESS;attachdbfilename=|DataDirectory|\SWDatabase.mdf;integrated security=True;user instance=True;multipleactiveresultsets=True;App=EntityFramework&quot;" providerName="System.Data.EntityClient" />
  </connectionStrings> 
```

在我从 IBM 客户端安装的 mcahine.config 中删除了一个错误后，它开始工作了。它没有立即工作，但我不知道还有什么变化。可能是重启后。

# postgresql - 在两台服务器之间复制选定的 postgresql 表？

> ID：11977381
> 
> 赞同：10
> 
> 时间：2012-08-15T21:11:28.363
> 
> 标签：postgresql, replication, rsync, failover

将单个数据库表从 Master postgresql 服务器复制到从机的最佳方法是什么？它可以通过 cron+rsync 或任何可能内置的 postgresql 或某种 OSS 工具来完成，但到目前为止，postgres 文档似乎并未涵盖*如何*进行表复制。我无法进行完整的数据库复制，因为某些表连接了许可证-> IP 内容，并且我无法在从属计算机上复制这些内容。我不需要即时复制，每小时也可以接受。

如果我只需要 rsync，有人可以帮助确定 /var/lib/pgsql 目录中的哪些文件需要同步，或者我如何知道它们是哪些表。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-08-16T10:47:45.960

您可能想尝试 Bucardo，这是一个开源软件，即使它们位于远程位置，也可以在表之间同步行。这是一个非常简单的软件，它也能够创建单向同步关系。

查看[http://bucardo.org/wiki/Bucardo](http://bucardo.org/wiki/Bucardo)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2020-08-14T05:10:21.673

从 Postgres 10 开始，逻辑复制被内置到 Postgres 中！这通常是比外部解决方案更好的解决方案。[Postgres 文档](https://www.postgresql.org/docs/10/logical-replication.html)非常棒且易于理解。这很容易。请参阅[快速设置文档](https://www.postgresql.org/docs/10/logical-replication-quick-setup.html)，本质上归结为运行此：

```
-- On publisher DB
CREATE PUBLICATION mypub FOR TABLE users, departments;

-- On subscriber DB
CREATE SUBSCRIPTION mysub CONNECTION 'dbname=foo host=bar user=repuser' PUBLICATION mypub; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-08-15T22:33:56.653

通过复制数据目录中的单个表文件，您无法获得任何有用的信息。如果要复制选定的表，有许多不错的选择。

[http://wiki.postgresql.org/wiki/Replication,_Clustering,_and_Connection_Pooling](http://wiki.postgresql.org/wiki/Replication,_Clustering,_and_Connection_Pooling)

# c# - 并行存储 - 保存在数据库中

> ID：11977382
> 
> 赞同：0
> 
> 时间：2012-08-15T21:11:29.363
> 
> 标签：c#, wpf, performance, parallel-processing

我有很多数据要导入我的数据库。

这些数据需要处理、过滤、联合等。所以一切都是用对象完成的，在开始之前携带所有表，并将所有对象保存到最后。

在所有处理之后，我运行命令进行保存。这花费的时间太长了。我想练习一种不同的方法：

> ```
> Task.Factory.StartNew(() =>
>         {
>             while (allCSV.Length % 4 != 0)
>             {
>                 Save(allCSV.FirstOrDefault());
>                 allCSV = allCSV.Skip(1).ToArray();
>             } 
> ```

```
 int count1 = 0;
            int middle = allCSV.Length / 4;
            int count2 = middle;
            int count3 = middle * 2;
            int count4 = middle * 3;
            Parallel.For(0, 4, new Action<int>((i) =>
            {
                switch (i)
                {
                    case 0:
                       for (int j = 0; j < middle; j++)
                       {
                         Save(allCSV[count1]);
                         count1++;
                       }
                    break;
                    case 1:
                       for (int k = 0; k < middle; k++)
                       {
                         Save(allCSV[count2]);
                         count2++;
                       }
                    break;
                    case 2:
                       for (int l = 0; l < middle; l++)
                       {
                         Save(allCSV[count3]);
                         count3++;
                       }
                    break;
                    case 3:
                       for (int m = 0; m < middle; m++)
                       {
                         Save(allCSV[count4]);
                         count4++;
                       }
                    break;
                 }
              }
          } 
```

那会是正确的吗？简化流程的最佳方法是什么？

一些考虑，使用的电脑是最新一代的。数据库是 MySQL。

用于保存的ORM，非常简单，没有任何优化。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T22:18:45.270

除非您可以一次对表进行多次插入，否则应用程序的多线程将无济于事。我在使用 SQL Server 时遇到了这个问题。插入/更新需要很长时间，因为我们做了这么多，而且它们都必须是原子的，所以一次插入/更新意味着整个表被锁定。我不知道 mySQL 是否能更好地处理表级锁定，但我对此表示怀疑。

您最好的选择可能是查看以数据库为中心的解决方案。执行事务、批量插入、ETL 等可能是编写一些 C# 代码更好的解决方案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-15T21:35:10.543

好像你把它复杂化了。不会

```
Parallel.ForEach(allCsv, Save); 
```

更直截了当？

当然，您是否会从并行化操作中获得任何性能优势是值得商榷的。

# objective-c - “...：”的方法定义未找到

> ID：11977385
> 
> 赞同：0
> 
> 时间：2012-08-15T21:11:34.620
> 
> 标签：objective-c, ios

我的应用程序不断出现“语义错误”并不断冻结/崩溃。一切似乎都很好地串在一起，并且启动没有问题。TextFields 工作正常，但只要我单击其他任何内容，它就会失败并强制退出。有什么建议吗？

H。

```
@interface ViewController : UIViewController {
    IBOutlet UITextField *buy1;
    IBOutlet UITextField *sell1;
    IBOutlet UILabel *percentage1;
    IBOutlet UILabel *profit1;
    IBOutlet UITextField *royalty;
    IBOutlet UITextField *buy2;
    IBOutlet UILabel *sell2;
    IBOutlet UITextField *percentage2;
    IBOutlet UILabel *profit2;

}
@property (weak, nonatomic) IBOutlet UITextField *buytext1;
@property (weak, nonatomic) IBOutlet UITextField *selltext1;
@property (weak, nonatomic) IBOutlet UILabel *percentage1;
@property (weak, nonatomic) IBOutlet UILabel *profit1;
@property (weak, nonatomic) IBOutlet UITextField *royalty;
@property (weak, nonatomic) IBOutlet UITextField *buytext2;
@property (weak, nonatomic) IBOutlet UILabel *sell2;
@property (weak, nonatomic) IBOutlet UITextField *percentagetext2;
@property (weak, nonatomic) IBOutlet UILabel *profit2;

-(IBAction)Button;

- (IBAction)backgroundTouched:(id)sender;

- (IBAction)textfieldReturn:(id)sender;

@end 
```

米。

```
@implementation ViewController
        //This is where I keep getting the Semantic Error "Incomplete Implementation"
@synthesize buytext1;
@synthesize selltext1;
@synthesize buytext2;
@synthesize percentagetext2;

- (IBAction)backgroundTouched:(id)sender {
    [buy1 resignFirstResponder];
    [sell1 resignFirstResponder];
    [buy2 resignFirstResponder];
    [percentage2 resignFirstResponder];

}

    - (IBAction)textFieldReturn:(id)sender {
        [buy1 resignFirstResponder];
        [sell1 resignFirstResponder];
        [buy2 resignFirstResponder];
        [percentage2 resignFirstResponder];

}

int VarBuy1 = 0;
int VarSell1 = 0;
int VarProfit1 =0;
int VarPercentage1 =0;
int VarRoyalty = 0;
int VarBuy2 = 0;
int VarSell2 = 0;
int VarProfit2 =0;
int VarPercentage2 =0;

-(IBAction)Button{
    VarBuy1 = ([buy1.text intValue]);
    VarSell1 = ([sell1.text intValue]);

    VarProfit1 = (VarSell1 - (VarSell1 * (VarRoyalty / 100)) - VarBuy1);
    VarPercentage1 = (VarProfit1 / VarSell1);
    VarSell2 = (VarBuy2 / ((100 - VarRoyalty) / 100 - VarPercentage2));
    VarProfit2 = (VarSell2 - (VarSell2 * VarRoyalty) - VarBuy2);

    profit1.text = [[NSNumber numberWithInt:VarProfit1] stringValue];
    percentage1.text = [[NSNumber numberWithInt:VarPercentage1] stringValue];
    sell2.text = [[NSNumber numberWithInt:VarSell2] stringValue];
    profit2.text = [[NSNumber numberWithInt:VarProfit2] stringValue];
}

@end 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T21:17:26.130

在.h

```
- (IBAction)textfieldReturn:(id)sender; 
```

在.m

```
- (IBAction)textFieldReturn:(id)sender 
```

小心字母大小写。场和场。

没有 (id)sender 的 IBAction 听起来不太好。

# mysql - Grails Scaffold - 为 JodaTime DateTime 字段生成 MySQL 列类型

> ID：11977386
> 
> 赞同：2
> 
> 时间：2012-08-15T21:11:46.803
> 
> 标签：mysql, grails, grails-orm

我是 Grails 的新手，我正在使用带有 MySQL 5.5 后端的 Grails 2.1 来构建一个示例项目来学习。

我安装了 JodaTime 1.4 Plug-in 然后运行`grails install-joda-time-templates`

但是，当我将域类字段声明为 org.joda.time.DateTime 类型时，尝试保存新条目时出现错误。

为了隔离问题，我创建了一个简单的域类：

```
import org.joda.time.DateTime

class Project
{
    String name
    DateTime startDate

    static constraints = {
        name(blank: false, maxSize: 50)
        startDate(validator: {return (it > new DateTime())})
    }
} 
```

控制器只是将脚手架设置为使用域类。

我的 DataSource.groovy 指定`dbCreate = "create-drop"`，因为我让 Grails 创建表。

这是我尝试保存时遇到的错误：

```
Class:com.mysql.jdbc.MysqlDataTruncation
Message:Data truncation: Data too long for column 'start_date' at row 1 
```

当我查看 Grails 创建的 MySQL 数据库中的 project.start_date 列时，类型是 TINYBLOB。

我的想法是 TINYBLOB 可能不足以存储 JodaTime DateTime 字段的数据。

有谁知道我怎样才能让 Grails 创建一个合适的类型？

非常感谢你。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-08-16T13:28:25.253

在您的 Config.groovy 中：

```
grails.gorm.default.mapping = {
    "user-type" type: PersistentDateTime, class: DateTime
    "user-type" type: PersistentLocalDate, class: LocalDate
} 
```

还有你的映射闭包：

```
static mapping = {
    startDate type: PersistentDateTime
} 
```

看看[这篇文章](http://adhockery.blogspot.com.br/2010/06/defaulting-joda-time-hibernate-types.html)了解更多信息，看看它是否有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-26T13:19:12.850

我做了什么使它工作（Grails 2.1）：

1）添加到buildConfig：

```
compile "org.jadira.usertype:usertype.jodatime:1.9" 
```

2）刷新依赖

3) 运行此命令添加支持的用户类型：

```
grails install-joda-time-gorm-mappings 
```

4）最后在域类中：

```
import org.jadira.usertype.dateandtime.joda.*

static mapping = {
 column_name type: PersistentDateTime
} 
```

文档在这里找到：[持久性](http://gpc.github.com/grails-joda-time/guide/persistence.html)

# javascript - 如果 li 少于 3 个字符，隐藏？

> ID：11977388
> 
> 赞同：6
> 
> 时间：2012-08-15T21:12:04.633
> 
> 标签：javascript, jquery, dom

我希望能够隐藏少于 3 个字符的列表项，我该怎么做？我下面的代码有什么问题？

我是一个 JavaScript/jQuery 新手。

```
jQuery().ready(function () {
    if (jQuery('ol li').length < 3) {
        jQuery(this).hide();
    };
}); 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2012-08-15T21:13:52.993

你的代码说

```
if (jQuery('ol li').length < 3) {  //If I have less than 3 li elements
    jQuery(this).hide();   //hide the window object
}; 
```

您要使用的是过滤器

```
$('ol li').filter( function(){ return $(this).text().length<3; } ).hide(); 
```

编辑 - 根据您在我的帖子中的评论：如果它是一个跨度标签，它周围可能有其他数据：

```
$('ol li span').filter( function(){ return $(this).text().length<3; } ).parent().hide() 
```

[小提琴运行跨度示例](http://jsfiddle.net/96DXy/)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2012-08-15T21:14:16.833

您需要过滤掉内容少于 3 个字符的元素，并隐藏这些元素：

```
$(function() {
    $('ol li').filter(function() {
        return $(this).text().length < 3 ;
    }).hide();
}); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-08-15T21:15:33.960

```
$('ul li').each(function() {
    if ($(this).text().length < 3)
        $(this).hide();
}); 
```

[演示](http://jsfiddle.net/FRHjg/2/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-08-15T21:18:28.317

试试这个：

```
$('ol li').filter(function(){ return $(this).text().length < 3; }).hide(); 
```

另一种选择可能是这样的：

*（因为您正在评估问题代码片段中的元素而不是值字符）*

```
if($('ol li').length < 3){ $(this).hide(); }; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-08-15T21:13:40.340

我认为您需要获取`.html()`您的 DOM 元素，然后执行`.length`此操作。

# linux - Linux CPU 百分比加起来不是 100%

> ID：11977391
> 
> 赞同：3
> 
> 时间：2012-08-15T21:12:08.970
> 
> 标签：linux, cpu-usage, collectd

每当我尝试从命令`top`或`mpstat`特别是`collectd`服务之类的命令中添加 CPU 利用率百分比时，我都无法获得确切的 100% CPU 利用率。

例如`top`来自 Amazon EC2 上的测试服务器的结果：

```
Cpu(s): 13.6%us, 31.6%sy,  0.0%ni, 53.2%id,  0.0%wa,  0.0%hi,  0.0%si,  1.7%st 
```

无论我如何将这些百分比相加，我从来没有完全得到 100% 的 CPU，当然不是以任何合乎逻辑的方式。大多数情况下，这似乎是舍入错误；100.1% 或 99.9%，但有时我最终会超过 110%。这通常发生在`steal`相对较高的情况下，例如`collectd`报告的一种情况是约 21.44% 的抢断和约 88% 的闲置，而这两种情况已经远远超过 100%。我知道`ni`(nice) 也计入`us`(user)，所以我不应该添加它，但这仍然行不通。

有谁知道如何将这些添加到 100% 或如何解释`collectd`有时报告的例外情况？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-08-15T21:43:08.217

`collectd`（和`top`,`htop`或`vmstat`任何其他此类实用程序）报告一个间隔内的平均值，并且根据内核的性质（这些实用程序从中查询其统计数据）通常不使用浮点数学并且不一定试图详尽地解释所有内容，可以' t 100% 准确。有时它们加起来会少于 100%，有时会更多。它不打算用于审计，只是一个一般性的时间花在哪里的指示。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-03-12T12:38:33.307

我确认这与 collectd 无关，而是与内核会计有关。这种不准确性在无滴答系统和/或节流状态下尤其明显。

# clojure - Clojure 可以使用哪些文本到语音和语音识别库？

> ID：11977393
> 
> 赞同：7
> 
> 时间：2012-08-15T21:12:13.720
> 
> 标签：clojure, speech-recognition, libraries, text-to-speech, speech-synthesis

Clojure 可以使用哪些文本到语音和语音识别库？到目前为止，我发现

[https://github.com/klutometis/speech-recognition](https://github.com/klutometis/speech-recognition)

[https://github.com/klutometis/speech-synthesis](https://github.com/klutometis/speech-synthesis)

这两个都使用谷歌，因此依赖于网络。

我正在寻找不依赖互联网工作的人

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-08-16T01:16:15.193

我认为就现有的 Clojure 库而言，这是一个几乎未开发的领域。

您最好的选择可能是查看许多可用的 Java 语音识别库并从 Clojure 中使用它们——此时它们将变得更加成熟和强大。

你可能想看看：

*   [http://cmusphinx.sourceforge.net/sphinx4/](http://cmusphinx.sourceforge.net/sphinx4/)

使用 Clojure 中的 Java 库非常简单——它通常就像导入正确的类并执行`(.someMethod someObject arg1 arg2)`

如果您确实为语音识别器创建了 Clojure 包装器，请务必将其回馈给社区！我知道很多人（包括我自己）会对在 Clojure 中做一些与语音相关的工作感兴趣。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-25T20:50:10.427

到目前为止，我已经能够使用本机系统的 TTS 这是我的代码，也许这会对某人有所帮助？

```
(use '[speech-synthesis.say :as say])
(use '[clojure.java.shell :only [sh]])

(defn festival [x](sh "sh" "-c" (str "echo " x " | festival --tts")))
(defn espeak [x] (sh "espeak" x))
(defn mac-say[x] (sh "say" x))
(defn check-if-installed[x] (:exit(sh "sh" "-c" (str "command -v " x " >/dev/null 2>&1 || { echo >&2 \"\"; exit 1; }"))))

(defn engine-check[]
(def engines (conj["Google" ]
(if (= (check-if-installed "festival") 0)  "Festival" )
(if (= (check-if-installed "espeak") 0) "ESpeak"   )
(if (= (check-if-installed "say") 0)  "Say"  ))) ;; Say is the Apple say command
(remove nil? engines))

(defn set-engine [eng](cond (= eng "Google")(def speak say)
                      (= eng "Festival" )(def speak festival)
                      (= eng "ESpeak") (def speak espeak)
                      (= eng "Say") (def speak mac-say))) 
```

然后使用

```
(set-engine "Festival") ;; set the engine
(speak "Hello, I can talk") ;; speak your text 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-03-02T06:31:10.797

我通过我编写的 JNI java 库使用 espeak 从 clojure 中的文本生成语音。基本库在 github 上可用。不幸的是，由于不相关的原因，我暂时被迫将注意力集中在另一个问题上。但是，如果您想使用我的库与 clojure 的 espeak 交互，请给我留言 - 我可以向您发送一些我如何使用它的示例。

# php - 在 OSX 上启用 PHP Blowfish

> ID：11977403
> 
> 赞同：0
> 
> 时间：2012-08-15T21:12:56.563
> 
> 标签：php, macos, mamp, bcrypt, password-hash

我最近迁移到 OS X 10.7 作为我的开发机器，运行 MAMP Pro 2.0.5。我们使用的加密库默认使用河豚，但在此平台配置上似乎不可用。我们现有的所有数据都是使用河豚加密的，所以现在我无法处理它。

我搜索了 MAMP 手册，但没有找到任何参考资料，我发现的所有其他内容都与 mcrypt 是否可用有关，但与加密算法无关。

我怎样才能启用河豚，还是我完全错过了这个概念？不幸的是，我正在为 PHP < 5.3 开发，因此不提供本机支持。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2018-11-06T13:59:38.357

这是一个纯 PHP 类，可以在任何运行 PHP 的操作系统（包括 OSX）上使用。[PHP 5 河豚加密类](https://github.com/themattharris/PHP-Blowfish/blob/master/blowfish.php)您只需将其包含到您的源代码中并在需要时调用其方法。

# cakephp - CakePHP 2.x：自定义日志记录

> ID：11977408
> 
> 赞同：3
> 
> 时间：2012-08-15T21:13:11.020
> 
> 标签：cakephp, logging

我有一个从 PayPal 接收即时付款通知的 CakePHP 应用程序。我想记录 PayPal 发布的数据。我可以使用以下方法轻松做到这一点：

```
file_put_contents(LOGS . 'ipns.log', date('Y-m-d H:i:s ') . print_r($_POST, true) . "\n", FILE_APPEND|LOCK_EX); 
```

但我更喜欢尽可能使用“CakePHP 方式™”。我已经浏览[了 CakePHP 食谱的“Core Libraries > Logging”部分，](http://book.cakephp.org/2.0/en/core-libraries/logging.html)但无法理解它。我知道这样做是*不*正确的：

```
CakeLog::write('ipns', print_r($_POST, true)); 
```

尽管上述方法似乎确实有效，但它也可能导致问题，如此[处所示](http://cakephp.lighthouseapp.com/projects/42648-cakephp/tickets/3100-cakelog-writes-twice)。

那么 CakePHP 的方法是什么？或者我应该只使用这个问题顶部显示的原始 PHP 吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-08-15T23:37:06.483

你想要什么在这里解释[http://book.cakephp.org/2.0/en/core-libraries/logging.html#creating-and-configuring-log-streams](http://book.cakephp.org/2.0/en/core-libraries/logging.html#creating-and-configuring-log-streams)

但我建议您阅读整页，而不仅仅是本节。

我会将ipn逐个字段写入数据库表，而不是写入文件日志。我可以根据我对 paypal API 的经验告诉你这一点。优点很明显，例如，您可以查找 ipns 以获取订单、搜索错误等。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-04-13T12:42:25.800

根据2.x 食谱的*Logging*部分的[Writing to log](http://book.cakephp.org/2.0/en/core-libraries/logging.html#writing-to-logs)段落：

 *> `CakeLog` **不再自动配置自身**。因此，如果没有流在监听，日志文件将不再自动创建。`default`如果您想收听所有类型和级别，请确保您至少设置了一个流。通常，您只需将核心`FileLog`类设置为输出到`app/tmp/logs/`：
> 
> ```
> CakeLog::config('default', array(
>     'engine' => 'File'
> )); 
> ```

因此，为了`CakeLog::write('ipns', print_r($_POST, true));`写入`app/tmp/logs/ipns.log`您需要的自定义文件，`app/Config/bootstrap.php`而不是：

```
/**
 * Configures default file logging options
 */
App::uses('CakeLog', 'Log');
CakeLog::config('debug', array(
    'engine' => 'File',
    'types' => array('notice', 'info', 'debug'),
    'file' => 'debug',
));
CakeLog::config('error', array(
    'engine' => 'File',
    'types' => array('warning', 'error', 'critical', 'alert', 'emergency'),
    'file' => 'error',
)); 
```

写：

```
/**
 * Configures default file logging options
 */
App::uses('CakeLog', 'Log');
CakeLog::config('default', array(
    'engine' => 'File'
)); 
```*

# java - java查找哪些jar与哪些java源文件一起使用

> ID：11977409
> 
> 赞同：4
> 
> 时间：2012-08-15T21:13:22.183
> 
> 标签：java, jar

我是我公司的新配置经理，我正在启动一个项目来清理我们的大部分构建过程。

我们在一个 Subversion 项目中存放了大量的罐子。有些人将这些 jar 复制到他们的项目中。其他人将他们项目中的 SVN:External 放到此目录中。其他人在这些罐子中复制的方式很复杂。这些是我们假设使用的唯一罐子。

我要搬到常春藤，也许还要搬到 Maven。我已经设置了一个 Maven 存储库，并确定了这些 jar 的 GroupId、ArtifactId 和 Version，并记录了如何通过 Ivy 和 Maven 配置访问您需要的那些。

我想浏览所有项目的源文件，找到所有导入语句，并将这些导入与这些 jar 包含的所有类进行比较。

我想找到给定的一组源直接调用的所有罐子。例如，如果一个 jar 包含：

```
import org.apache.commons.beanutils.* 
```

我知道它需要 commons-beanutils.jar（1.6 版）。我也知道它需要 commons-logging.jar，但我会让 Maven 和 Ivy 处理这个问题。我只想告诉开发人员当他们创建他们的`pom.xml`or时`ivy.xml`，他们需要包含`common-beanutils#common-beansutil#1.6`在他们的`pom.xml`or`ivy.xml`文件中。

我知道这不会是一个完整的列表。我知道运行时需要 jar，但不能编译。我也知道有些类可以使用多个 jar。我现在开发人员也可以这样做：

```
import org.apache.commons.*; 
```

这将与几十个罐子相匹配，什么也不告诉我。（也许有一种方法可以确定 Java 源文件中实际使用了哪些类）。

我可以编写一个 Python 或 Perl 脚本来完成这项工作，但我希望已经有一些东西可以为我节省几个小时的工作。我知道 JBoss 的 TattleTale，但文档似乎说它只适用于 jar 并显示 jar 之间的依赖关系等。我对此并不感兴趣。我只想知道我们的源调用了哪些 jar，并让 Ivy 和 Maven 处理更深层次的依赖关系。

有没有这样的工具？

* * *

### 附录

只是为了更具体。这是一个老项目。事实上，有50个左右的项目。我们知道一个特定的项目需要 20 个 jars 才能运行，而 TattleTail 等工具可以通过并向您展示整个数据分析。

但是，让我们从开发人员的角度来看它。我有一个问题，我找到了一个可以解决我的问题的开源项目。我阅读了文档，编写了代码并导入了我需要的类。我知道那个包含类的开源项目的 jar，这就是我所知道的。

我要做的是回到最初开发者的心态：我在这个项目中使用了这些类，我需要这5个jar。这 5 个 jar 可能需要另外 15 个才能运行，这是 Ivy/Maven 现在将处理的事情。我们知道程序需要的 20 个罐子。我只想要开发人员最初在他们的代码中提到的 5 个。

这是为了帮助开发人员编写他们的`pom.xml`or `ivy.xml`. 我不希望他们将所有 20 个罐子都放在那个`pom.xml`或那个`ivy.xml`文件中——只是他们需要的五个。

This is just a starting point. They might have imported `com.foo.bar.bar.foo` and that class is in `foo-all.jar`, `foo-client.jar`, and `bar-talk.com`. The developers will have to decide which one of these their project needs.

This is a massive paradigm shift in our programming, but we are losing track of jars and versions, and making sure all of these projects can talk to each other. Using Ivy/Maven will greatly simplify this mess.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-09-21T17:53:52.610

[Tattletale](http://www.jboss.org/tattletale) ended up giving me the first level of dependencies which is what I need to build my `ivy.xml` or `pom.xml` file. It misses one or two occasionally, but otherwise it works pretty good.

# r - 在 R 中打包相对路径

> ID：11977417
> 
> 赞同：12
> 
> 时间：2012-08-15T21:14:03.977
> 
> 标签：r, r-package

我为使用相对路径的包编写了一些函数，例如：

```
"./data/foobar.rds" 
```

这是一个示例函数：

```
foo <- function(x) { 
x <- readRDS("./data/bar.rds")
return(x)
} 
```

现在，如果我要在包的开发路径中工作，这将按我的预期工作。但是当我加载包时，这个路径使用的是当前工作目录，而不是包的相对路径。

如何设置它以使包内函数的路径保持它们在包内的相对路径？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-08-15T21:25:16.053

正如 Andrie 所说，您可以使用[`system.file`](http://stat.ethz.ch/R-manual/R-patched/library/base/html/system.file.html)“查找包中文件的完整文件名等”。

```
x <- readRDS(system.file("help", "aliases.rds", package="MASS")) 
```

# c++ - 继承 - 为什么这是非法的？

> ID：11977419
> 
> 赞同：8
> 
> 时间：2012-08-15T21:14:08.657
> 
> 标签：c++, inheritance, types, typechecking

我正在做一个 C++ 测验。并遇到了以下代码 - 这是非法的，但我不明白为什么。谁能解释为什么这条线：

```
Box* b1 = s1->duplicate(); 
```

生成编译器错误，“无法从 Shape* 转换为 Box”？我认为这`s1->duplicate()`是调用`Box::duplicate()`，因为`s1`实际上指向`Box`- 但从编译器错误来看，它看起来像是在调用`Shape::duplicate()`.

```
#include <iostream>

struct Shape
{
  virtual Shape* duplicate()
  {
    return new Shape;
  }

  virtual ~Shape() {}
};

struct Box : public Shape
{
  virtual Box* duplicate()
  {
    return new Box;
  }

};

int main(int argc, char** argv) 
{ 
  Shape* s1 = new Box;

  Box* b1 = s1->duplicate();

  delete s1;
  delete b1;
  return 0; 
} 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2012-08-15T21:17:28.957

C++ 语言是静态类型的。关于调用合法性的决定是在编译时做出的。很明显，编译器无法知道`s1->duplicate()`返回一个指向`Box`对象的指针。在这种情况下，期望它接受您的代码是不合逻辑的。

是的，`s1->duplicate()`确实在您的示例中调用`Box::duplicate`了，但是您希望编译器如何知道这一点？从您的具体示例中可以说它是“显而易见的”，但是这种语言功能的规范对于这种“显而易见”的情况也不例外。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-08-15T21:17:53.010

`Shape::duplicates()`返回 a `Shape*`，它不是 a `Box*`。您实际返回的运行时类型与它无关。编译器怎么知道`Shape*`返回的实际上指向 a `Box`？

编辑：想想这个：

```
struct Shape
{
  virtual Shape* duplicate()
  {
    return new Shape;
  }

  virtual ~Shape() {}
};

struct Box : public Shape
{
  virtual Box* duplicate()
  {
    return new Box;
  }

};

struct Sphere : public Shape
{
  virtual Sphere* duplicate()
  {
    return new Sphere;
  }

};

Shape* giveMeABoxOrASpehere()
{
    if ( rand() % 2 )
       return new Box;
    else
       return new Sphere;
}

//
Shape* shape = giveMeABoxOrASphere();
// What does shape->duplicate() return?

Box* shape = giveMeABoxOrASphere();
// shoud this compile? 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-08-16T00:12:16.513

出于完全相同的原因

```
Shape* s1 = new Box;
Box* b1 = s1; 
```

不编译。编译器不关心`s1`引用 a `Box`，也不应该关心。

如果您知道`s1`指的是 a `Box`，请直接说：

```
Box *s1 = new Box; 
```

关于语法的注释：解析规则`Box * s1;`是（非常简化）：

```
declaration := type-name declarator ;
declarator := name 
            | * declarator 
```

所以解析是：

```
 Box        *       s1        ;
                   ^^^^^^^^
                  declarator
^^^^^^^^^    ^^^^^^^^^^^^^^^^^^
type-name         declarator 
```

分组是`Box (* (s1) )`

它被认为是最好的编写风格，`Box *s1;`因为它与解析更一致，而不是`Box* s1;`在一个声明中声明多个变量，`Box*`语法可能会令人困惑：

```
Box* x, y; 
```

`x`是一个指向 的指针`Box`，但是`y`是一个`Box`，因为解析是：

```
Box (*x), y; 
```

# .net - TChart 的性能问题

> ID：11977423
> 
> 赞同：0
> 
> 时间：2012-08-15T21:14:24.490
> 
> 标签：.net, c#-4.0, teechart

我在我的应用程序中使用 Steema TChart。我使用此组件绘制折线图，​​通常包含 1,000 到 2,000 个数据点，在数据点可用时实时显示。一条典型的线路大约需要 30 秒才能完成。

在生成我的第 2 行或第 3 行之后，TChart 组件到达与处理器挂钩的位置。即使图表正在更新，其他 UI 更新也会受到每次添加新数据点时图表必须执行的重绘的巨大影响。我进行了实验，发现如果在绘制线条时不显示图表（图表位于窗口的单独选项卡上；但当前未显示），我的性能要好得多，处理器使用率也会下降急剧下降。

有没有人找到使用此组件并获得更好性能的方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-16T07:05:12.247

[在这种情况下，可能异步绘画技术，使用此线程](http://www.teechart.net/support/viewtopic.php?t=5127)中建议的 AutoRepaint 属性，将有助于提高系统的性能。基本上，您需要将 Autorepaint 设置为 false 以防止在添加点后重新绘制图表并将其设置回 true 并在数据添加完成时调用 refresh。

[此处](http://www.teechart.net/reference/articles/index.php)的*实时图表*文章也可能有助于提高 TeeChart 应用程序的性能。这是一篇 Delphi 文章，但其中大部分内容也可以应用于 .NET 版本的 TeeChart。

最后但同样重要的是，用于 .NET 的 TeeChart 附带一个 Direct2D 渲染引擎。这是 DSP 实时应用所需的高速数据吞吐量的理想选择。请参阅白皮书《[提升 Windows 窗体中](http://www.teechart.net/files/teechartnet/WhitePaper_Direct2D.pdf)的图形渲染性能》，了解详细信息。

# java - 在不使用 StoredProcedures 的情况下检索多个 ResultSet

> ID：11977424
> 
> 赞同：0
> 
> 时间：2012-08-15T21:14:25.663
> 
> 标签：java, sql, db2, sql-optimization

Java 1.5 中有没有一种方法可以`ResultSet`通过单个 SQL 调用从 DB2 数据库中检索多个对象，而无需使用 StoredProcedures / `CallableStatements`？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T21:15:24.010

不，我认为不可能在单个 SQL 调用中获得多个 ResultSet 对象。您可以参考[JDBC API 文档](http://docs.oracle.com/javase/1.5.0/docs/api/java/sql/Statement.html)。

# html - CSS样式=显示：块不起作用

> ID：11977425
> 
> 赞同：9
> 
> 时间：2012-08-15T21:14:30.090
> 
> 标签：html, css

浏览器是火狐。

我有一个包含 15 个单选按钮的列表。像这样显示它们后：

```
<div class="abcd"  style="margin-left:10px;">
    <form id='some'....>
        <legend>Select Item type :</legend>
        <fieldset style="display:block;float:left;">
            <input class="yy" id="sss" type="radio" name="group0" value="aaa"/> ABC
            ...
        </fieldset>
        <p>
            <input placeholder="Enter Name/Value" name="xxx" id="xxx" size="40" style="display:block;float:left;">
            <button type="button" id="xxx" style="width:100;">Process</button>
        </p>
    </form>
</div> 
```

一切都显示在一行中。我不确定如何在单选按钮下显示文本框，中间有一些空格。？

请帮忙。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2012-08-15T21:22:02.677

你的风格的问题是`float: left`，你必须清除“浮动”。在`p`标签处，包括`clear:both`，它告诉浏览器没有东西可以在它的左边或右边浮动。

```
<div class="abcd"  style="margin-left:10px;">
    <form id='some'>
        <fieldset style="display:block;float:left;">
            <input class="yy" id="sss" type="radio" name="group0" value="aaa"/> ABC

            <input class="yy" id="sss" type="radio" name="group0" value="aaa"/> ABC

            <input class="yy" id="sss" type="radio" name="group0" value="aaa"/> ABC

        </fieldset>
        <p style="clear:both">
            <input placeholder="Enter Name/Value" name="xxx" id="xxx" size="40" style="display:block;float:left;">
            <button type="button" id="xxx" style="width:100;">Process</button>
        </p>
    </form>
</div> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-15T21:19:29.120

使用该`float`属性时，您必须清除它，以便其他元素不会出现在它旁边。尝试`clear: both`像这样添加到输入框的css：

```
<input placeholder="Enter Name/Value" name="Name" id="NameID" size="40" 
style="clear:both; display:block;"/> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-08-15T21:20:27.393

粘贴

```
<div style="clear:both"></div> 
```

在字段集之后。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-08-15T21:18:14.117

尝试将 css 规则添加到单选按钮本身。像这样：

```
<style type="text/css">
.group0
{
    display:block;
}
</style> 
```

这假定`group0`是具有所有单选按钮的组。

# php - isset() 在表单上无法正常工作

> ID：11977431
> 
> 赞同：4
> 
> 时间：2012-08-15T21:14:47.800
> 
> 标签：php

我有一个用户提交的注册表单，使用 isset($_POST) 发送数据以查看是否有任何内容放入表单输入框中。如果不是，则将其发送到 else ，然后将其发送到一个函数，该函数将用户返回到注册表单以完成一些丢失的表单。由于某种原因，它无法正常工作。

这是我的检查代码------

```
function returnBack(){

    header("Location:register.php");
    exit;

}

if(isset($_POST['myusername']))
{
    $myusername = $_POST['myusername'];
}
else
{
    returnBack();   
}
if(isset($_POST['mypassword']))  {
    $mypassword=$_POST['mypassword'];

}
else{   

    returnBack();
}
if(isset($_POST['myemail']))  {

    $myemail=$_POST['myemail'];
}
else{

    returnBack();
}
if(isset($_POST['myname']))  {

    $myname=$_POST['myname'];
}
else{

    returnBack();
}
if(isset($_POST['mylastname'])){

    $mylastname=$_POST['mylastname'];

}
else{

    returnBack();
}
/////////////////////////////////////////////////////////////*******CONNECT TO SERVER ******************************************************************/
try {  
  # MySQL with PDO_MYSQL  
  $DBH = new PDO("mysql:host=$hostname;dbname=$database", $username, $password);  
  $DBH->setAttribute( PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION );

}  
catch(PDOException $e) { 
    echo "I'm sorry, I'm afraid I can't do that.";  
    file_put_contents('PDOErrors.txt', $e->getMessage(), FILE_APPEND);   
}
////////////////////////////////////////////////////////////***********INSERT REGISTER DATA INTO DB ***************************************************************/
//$encrypt_password = md5($mypassword);

$insertdata = $DBH->prepare("INSERT INTO members (username, password, email, firstname, lastname ) VALUES ('$myusername','$mypassword','$myemail','$myname','$mylastname')");
$insertdata->execute();
echo "success";

$DBH = null; 
```

这是表单部分------------------------------

```
<table width="300" border="0" align="center" cellpadding="0" cellspacing="1" bgcolor="#CCCCCC">
<tr>
<form name="register" method="post" action="insertnewmem.php">
<td>
<table width="100%" border="0" cellpadding="3" cellspacing="1" bgcolor="#FFFFFF">
<tr>
<td colspan="3"><strong>Registration Form </strong></td>
</tr>
<tr>
<td width="78">Username</td>
<td width="6">:</td>
<td width="294"><input name="myusername" type="text" id="myusername" ></td>
</tr>
<tr>
<td>Password</td>
<td>:</td>
<td><input name="mypassword" type="text" id="mypassword"></td>
</tr>
<tr>
<td>Email</td>
<td>:</td>
<td><input name="myemail" type="text" id="myemail"></td>
</tr>
<tr>
<td>First Name</td>
<td>:</td>
<td><input name="myname" type="text" id="myname"></td>
</tr>
<tr>
<td>Last Name</td>
<td>:</td>
<td><input name="mylastname" type="text" id="mylastname"></td>
</tr>
<tr>
<td>&nbsp;</td>
<td>&nbsp;</td>
<td><input type="submit" name="Submit" value="Register"></td>
</tr>
</table>
</td>
</form>
</tr>
</table> 
```

更新 - - - - - - - - - - - - - - - - - - - - - - -

抱歉，它跳过了 returnBack() 函数，即使表单没有正确填写，也只是将其插入到 db 中。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2012-08-15T21:16:57.703

尝试 `!empty()`代替`isset()`. 仅当存在除 null、false、0 或空字符串 '' 之外的其他内容时，它才会评估为 true。您可能提交了空字符串。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-08-15T21:19:52.770

其他人已经发布了答案，但让我解释一下原因。

isset() 检查是否设置了值，而不是值是什么，而只是检查它是否有值。当您提交表单时，您将传递一个空字符串作为每个输入的值。

通常我使用以下方法检查：

```
if(isset($_POST['variable']) && $_POST['variable'] !== "") 
```

第一部分确保变量存在（以便第二个条件不会引发错误），第二个条件确保字符串不为空。

# mysql - sql fiddle 可以处理的内容有限制吗？sql fiddle 不编译任何东西并且不返回错误消息

> ID：11977441
> 
> 赞同：6
> 
> 时间：2012-08-15T21:15:37.160
> 
> 标签：mysql, error-handling, compilation, limit, sqlfiddle

我最近创建了一个成功编译并返回所需结果的查询。当我将该段代码用作stackoverflow上的用户为我提出的另一段代码中的子查询时，我遇到了一些问题，最终得到了解决。我试图在给我的那段代码中将此查询用作子查询。但是，sql fiddle 不返回任何内容。没有错误或编译消息。当我尝试故意输入语法错误（如随机 + 号）时，什么也没发生。是因为查询太长了吗？

**图式**

```
CREATE TABLE sampleData 
    (
     id MEDIUMINT NOT NULL AUTO_INCREMENT,
      timecode int, 
     count int,
      PRIMARY KEY (id)
    )
#ENGINE=MyISAM
;

INSERT INTO sampleData
(timecode, count)
VALUES
(1344893440, 1), ( 1346014720, 1),( 1344898688,1),( 1345654784,1),( 1345978368,1),
( 1345959296,1), (1345064704,1), ( 1345156352,1),( 1345225600,1),
(1345017984,1),( 1345640960,1),( 1346019968,1),( 1345834752,1),
( 1345438464,1),( 1344986880,1),( 1345045632,1),( 1345557888,1),( 1344973056,1),( 1345087232,1),( 1345433216,1),( 1345691008,1),
( 1344917760,1),( 1345253248,1),( 1344934912,1),( 1345890048,1),( 1345272448,1), (1345829504,1),( 1345798400,1),( 1345203200,1),( 1344741120,1),
( 1345175552,1),( 1344824192,1),( 1344926336,1),( 1345571712,1),( 1344931584,1),( 1345211776,1),( 1345059456,1),( 1345516288,1),( 1345441920,1),( 1346009472,1) 
```

**询问**

```
select t_0.*,
           (coalesce(t_3.average_number_of_votes_per_previous_period_days, 0) - coalesce(t_4.average_number_of_votes_per_previous_period_days, 0)) * 100.0
    from 
        (select t.*,
           (coalesce(t_1.count, 0) - coalesce(t_2.count, 0)) * 100.0 as "percentage increase in count in %"
    from  
    (
      SELECT sum(1) AS ordr,
      t1.id,t1.day, t1.count, SUM(t2.count) as aggregate, (SUM(t2.count)-t1.count)/(sum(1)-1) as "average_number_of_votes_per_previous_period_days"

      FROM 
        (SELECT  id, date(FROM_UNIXTIME( timecode))  AS day,(FROM_UNIXTIME( timecode)) AS original, COUNT(1)  as 'count'
        FROM sampleData
        GROUP BY DAY) t1
        INNER JOIN 
        (SELECT date(FROM_UNIXTIME( timecode) ) AS day,(FROM_UNIXTIME( timecode)) AS original, COUNT(1)  as 'count'
        FROM sampleData
        GROUP BY DAY) t2 
        on t1.day >= t2.day                                                                                                                                
        GROUP BY t1.day, t1.count
        ORDER BY t1.day
        )t 
      left outer join
         (
          SELECT sum(1) AS ordr,
            t1.id,t1.day, t1.count, SUM(t2.count) as aggregate, (SUM(t2.count)-t1.count)/(sum(1)-1) as "average_number_of_votes_per_previous_period_days"
          FROM 
            (SELECT  id, date(FROM_UNIXTIME( timecode))  AS day,(FROM_UNIXTIME( timecode)) AS original, COUNT(1)  as 'count'
            FROM sampleData
            GROUP BY DAY) t1
          INNER JOIN 
            (SELECT date(FROM_UNIXTIME( timecode) ) AS day,(FROM_UNIXTIME( timecode)) AS original, COUNT(1)  as 'count'
            FROM sampleData
            GROUP BY DAY) t2 
          on t1.day >= t2.day                                                                                                                                
          GROUP BY t1.day, t1.count
          ORDER BY t1.day
          )t_1
       on t.ordr = t_1.ordr + 1 left outer join
         (
          SELECT sum(1) AS ordr,
            t1.id,t1.day, t1.count, SUM(t2.count) as aggregate, (SUM(t2.count)-t1.count)/(sum(1)-1) as "average_number_of_votes_per_previous_period_days"
          FROM 
              (SELECT  id, date(FROM_UNIXTIME( timecode))  AS day,(FROM_UNIXTIME( timecode)) AS original, COUNT(1)  as 'count'
              FROM sampleData
              GROUP BY DAY) t1
            INNER JOIN 
              (SELECT date(FROM_UNIXTIME( timecode) ) AS day,(FROM_UNIXTIME( timecode)) AS original, COUNT(1)  as 'count'
              FROM sampleData
              GROUP BY DAY) t2 
            on t1.day >= t2.day                                                                                                                                
            GROUP BY t1.day, t1.count
            ORDER BY t1.day
            ) t_2
        on t.ordr = t_2.ordr + 2)t_0 
    left outer join
         (select t.*,
           (coalesce(t_1.count, 0) - coalesce(t_2.count, 0)) * 100.0 as "percentage increase in count in %"
    from  
    (
      SELECT sum(1) AS ordr,
      t1.id,t1.day, t1.count, SUM(t2.count) as aggregate, (SUM(t2.count)-t1.count)/(sum(1)-1) as "average_number_of_votes_per_previous_period_days"

      FROM 
        (SELECT  id, date(FROM_UNIXTIME( timecode))  AS day,(FROM_UNIXTIME( timecode)) AS original, COUNT(1)  as 'count'
        FROM sampleData
        GROUP BY DAY) t1
        INNER JOIN 
        (SELECT date(FROM_UNIXTIME( timecode) ) AS day,(FROM_UNIXTIME( timecode)) AS original, COUNT(1)  as 'count'
        FROM sampleData
        GROUP BY DAY) t2 
        on t1.day >= t2.day                                                                                                                                
        GROUP BY t1.day, t1.count
        ORDER BY t1.day
        )t 
      left outer join
         (
          SELECT sum(1) AS ordr,
            t1.id,t1.day, t1.count, SUM(t2.count) as aggregate, (SUM(t2.count)-t1.count)/(sum(1)-1) as "average_number_of_votes_per_previous_period_days"
          FROM 
            (SELECT  id, date(FROM_UNIXTIME( timecode))  AS day,(FROM_UNIXTIME( timecode)) AS original, COUNT(1)  as 'count'
            FROM sampleData
            GROUP BY DAY) t1
          INNER JOIN 
            (SELECT date(FROM_UNIXTIME( timecode) ) AS day,(FROM_UNIXTIME( timecode)) AS original, COUNT(1)  as 'count'
            FROM sampleData
            GROUP BY DAY) t2 
          on t1.day >= t2.day                                                                                                                                
          GROUP BY t1.day, t1.count
          ORDER BY t1.day
          )t_1
       on t.ordr = t_1.ordr + 1 left outer join
         (
          SELECT sum(1) AS ordr,
            t1.id,t1.day, t1.count, SUM(t2.count) as aggregate, (SUM(t2.count)-t1.count)/(sum(1)-1) as "average_number_of_votes_per_previous_period_days"
          FROM 
              (SELECT  id, date(FROM_UNIXTIME( timecode))  AS day,(FROM_UNIXTIME( timecode)) AS original, COUNT(1)  as 'count'
              FROM sampleData
              GROUP BY DAY) t1
            INNER JOIN 
              (SELECT date(FROM_UNIXTIME( timecode) ) AS day,(FROM_UNIXTIME( timecode)) AS original, COUNT(1)  as 'count'
              FROM sampleData
              GROUP BY DAY) t2 
            on t1.day >= t2.day                                                                                                                                
            GROUP BY t1.day, t1.count
            ORDER BY t1.day
            ) t_2
        on t.ordr = t_2.ordr + 2) t_3
         on t.ordr = t_3.ordr + 1 
    left outer join
         (select t.*,
           (coalesce(t_1.count, 0) - coalesce(t_2.count, 0)) * 100.0 as "percentage increase in count in %"
    from  
    (
      SELECT sum(1) AS ordr,
      t1.id,t1.day, t1.count, SUM(t2.count) as aggregate, (SUM(t2.count)-t1.count)/(sum(1)-1) as "average_number_of_votes_per_previous_period_days"

      FROM 
        (SELECT  id, date(FROM_UNIXTIME( timecode))  AS day,(FROM_UNIXTIME( timecode)) AS original, COUNT(1)  as 'count'
        FROM sampleData
        GROUP BY DAY) t1
        INNER JOIN 
        (SELECT date(FROM_UNIXTIME( timecode) ) AS day,(FROM_UNIXTIME( timecode)) AS original, COUNT(1)  as 'count'
        FROM sampleData
        GROUP BY DAY) t2 
        on t1.day >= t2.day                                                                                                                                
        GROUP BY t1.day, t1.count
        ORDER BY t1.day
        )t 
      left outer join
         (
          SELECT sum(1) AS ordr,
            t1.id,t1.day, t1.count, SUM(t2.count) as aggregate, (SUM(t2.count)-t1.count)/(sum(1)-1) as "average_number_of_votes_per_previous_period_days"
          FROM 
            (SELECT  id, date(FROM_UNIXTIME( timecode))  AS day,(FROM_UNIXTIME( timecode)) AS original, COUNT(1)  as 'count'
            FROM sampleData
            GROUP BY DAY) t1
          INNER JOIN 
            (SELECT date(FROM_UNIXTIME( timecode) ) AS day,(FROM_UNIXTIME( timecode)) AS original, COUNT(1)  as 'count'
            FROM sampleData
            GROUP BY DAY) t2 
          on t1.day >= t2.day                                                                                                                                
          GROUP BY t1.day, t1.count
          ORDER BY t1.day
          )t_1
       on t.ordr = t_1.ordr + 1 left outer join
         (
          SELECT sum(1) AS ordr,
            t1.id,t1.day, t1.count, SUM(t2.count) as aggregate, (SUM(t2.count)-t1.count)/(sum(1)-1) as "average_number_of_votes_per_previous_period_days"
          FROM 
              (SELECT  id, date(FROM_UNIXTIME( timecode))  AS day,(FROM_UNIXTIME( timecode)) AS original, COUNT(1)  as 'count'
              FROM sampleData
              GROUP BY DAY) t1
            INNER JOIN 
              (SELECT date(FROM_UNIXTIME( timecode) ) AS day,(FROM_UNIXTIME( timecode)) AS original, COUNT(1)  as 'count'
              FROM sampleData
              GROUP BY DAY) t2 
            on t1.day >= t2.day                                                                                                                                
            GROUP BY t1.day, t1.count
            ORDER BY t1.day
            ) t_2
        on t.ordr = t_2.ordr + 2) t_4
        on t_0.ordr = t_4.ordr + 2 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-08-15T22:00:41.643

我已将您的查询插入[此](http://sqlfiddle.com/#!2/97a57)小提琴，现在我看到了问题。您的查询长度超过 8000 个字符（准确地说是 8423），我没有在结果面板上显示该消息。基本上，这是我以前没有注意到的 SQL Fiddle 中的一个显示错误（所以，感谢您引起我的注意！）。

同时，您可以尝试删除一些字符以使其适合 8000 个字符的限制。

# java - 封装级别的方法

> ID：11977442
> 
> 赞同：4
> 
> 时间：2012-08-15T21:15:43.260
> 
> 标签：java, packages

是否可以编写在包级别可用的方法？假设`foo`是一个包：

```
long version = foo.getPackageVersion(); 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-08-15T21:16:39.263

不它不是。方法只能在类上定义。无处。

包不是*物理*的，它不能作为字节码的容器。包不过是类、枚举和接口的命名空间。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-08-15T21:18:33.980

理论上你可以在 scala 中执行此操作，但它会创建一个类来存储这些包级别的方法和对象。

您可以创建包级别的 javadocs，并向其添加注释，但不能添加字段、构造函数或方法。

`package-info.java`在包中调用的文件中`mypackage`

```
/**
 * Javadoc comments for package {@code mypackage}.
 */
@PackageVersion(getPackageVersion = "1.2.3")
package mypackage; 
```

* * *

```
@Retention(RetentionPolicy.RUNTIME)
public @interface PackageVersion {
    String getPackageVersion();
} 
```

* * *

```
Package mypackage = Package.getPackage("mypackage");
PackageVersion version = mypackage.getAnnotation(PackageVersion.class);
System.out.println("Package version: "+version.getPackageVersion()); 
```

印刷

```
Package version: 1.2.3 
```

此功能是在[JSR-175中添加的](http://www.jcp.org/en/jsr/detail?id=175)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T21:17:26.207

不，包本身既不是对象也不是类。只有类有方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-08-15T21:17:44.570

在 Java 中，方法/操作应该在类中。如果您尝试在类外添加方法，编译器会报错。

# actionscript-3 - AS3：矢量项未拼接

> ID：11977445
> 
> 赞同：0
> 
> 时间：2012-08-15T21:15:51.523
> 
> 标签：actionscript-3, actionscript, flash-cs6

您好，我正在创建一个带有发射子弹的枪的系统。

更新函数是这样处理的：

```
 var b:Bullet;
        var l:uint = bulletList.length;
        var i:uint;

        for (i = 0; i < l; i++) {
            b = bulletList[i];
            b.sprite.x +=  b.vx;
            b.sprite.y +=  b.vy;

            if (b.sprite.x > 1200 || b.sprite.x < -100 || b.sprite.y < -1000) {
                deleteBullet(b);
                bulletList.splice(i,1);
            }

        }

    public function deleteBullet(b:Bullet) {
        b.sprite = null;
        b = null;
    } 
```

当我射出一颗子弹时，它会产生一个错误，有时它会创建一个新的但它根本没有任何动作。这是我得到的错误：

> RangeError：错误 #1125：索引 1 超出范围 1。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T21:23:26.423

您收到该错误是因为您在 for 循环中拼接数组。

而不是使用'l'作为for循环的参数，而是直接使用bulletList.length作为每次迭代它会查看当前长度，这将反映任何拼接出来的东西。拼接时还需要减去迭代器，因为这会将所有未来的索引向下移动一个。

```
 for (i = 0; i < bulletList.length; i++) {
            b = bulletList[i];
            b.sprite.x +=  b.vx;
            b.sprite.y +=  b.vy;

            if (b.sprite.x > 1200 || b.sprite.x < -100 || b.sprite.y < -1000) {
                deleteBullet(b);
                bulletList.splice(i,1);
                i--;
            }

        } 
```

# html - IE8中的背景图片

> ID：11977453
> 
> 赞同：0
> 
> 时间：2012-08-15T21:16:44.790
> 
> 标签：html, css, internet-explorer-8

我正在尝试将图像显示为页面主体的背景，它需要在 IE8 中工作。

目前我有以下工作，但我宁愿让图像与窗口大小成比例缩放，此时图像以 100% 的大小显示，而不是它应该填充浏览器窗口并缩放为窗口变化。

```
<div id="bg">
    <img src="images/bg.jpg" alt="">
</div> 
```

CSS：

```
#bg {
    position:fixed; 
    top:-50%; 
    left:-50%; 
    width:200%; 
    height:200%;
}
#bg img {
    position:absolute; 
    top:0; 
    left:0; 
    right:0; 
    bottom:0; 
    margin:auto; 
    min-width:50%;
    min-height:50%;
} 
```

# asp.net - 在 ASP.NET 中使用 filestream 读取图像文件并存储在 Sql server 数据库中

> ID：11977456
> 
> 赞同：0
> 
> 时间：2012-08-15T21:16:49.223
> 
> 标签：asp.net, sql, sql-server-2008

我的数据库中有大约 1k 条记录，其中包含人口统计信息 + 图像列。当前所有图像都驻留在文件系统中，我被分配了拾取这些图像并将其存储在数据库中的任务。

我的目标是
1\. 使用 ASP.NET，从文件系统中读取图像文件
2\. 将图像存储在 SQL Server 2008 数据库中

到目前为止，我已经看到这可能只使用 FileUpload 方法，这将是非常乏味的。

任何帮助，非常感谢

谢谢，尼尔

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T23:53:48.407

这是一个很好的方法，它包括 VB 和 C# 代码：[http ://www.aspsnippets.com/Articles/Save-and-Retrieve-Files-from-SQL-Server-Database-using-ASP.Net .aspx](http://www.aspsnippets.com/Articles/Save-and-Retrieve-Files-from-SQL-Server-Database-using-ASP.Net.aspx)

如果您需要进行批量加载，只需在代码周围循环，并将目录中的文件列表提供给它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-16T03:55:22.803

Asp.net 不适合批量加载任务。

由于文件已经在您的文件系统上，一个简单的控制台应用程序可以完成任务。

*   获取图像目录中的所有文件
*   循环它们以读取字节
*   将数据插入您的数据库。

代码：

```
 var files = Directory.GetFiles(@"MY_PATH");
 foreach (var file in files)
 {
    var data = File.ReadAllBytes(file);
    var fileName = Path.GetFileName(file);
    string strQuery = "insert into imageData(Name, Data) values (@Name,@Data)";

    SqlCommand cmd = new SqlCommand(strQuery);

    cmd.Parameters.Add("@Name", SqlDbType.VarChar).Value = filename;
    cmd.Parameters.Add("@Data", SqlDbType.Binary).Value = data;

    cmd.ExecuteNonQuery();
 } 
```

# php - WordPress 赞助商翻转插件

> ID：11977457
> 
> 赞同：1
> 
> 时间：2012-08-15T21:16:50.557
> 
> 标签：php, wordpress

我想在我的网站上包含这个插件 [http://wordpress.org/extend/plugins/wp-sponsor-flip-wall/](http://wordpress.org/extend/plugins/wp-sponsor-flip-wall/)

但是，我不想在所有页面上显示它，而是只想在我将为赞助商创建的页面上显示它。这甚至可能吗？

根据说明，要包括赞助商，我必须调用以下函数

```
<?php wp_sfw_render(); ?> 
```

我试图将其包括在内`footer.php`，它正确地在页脚上显示了赞助商。

我可以添加相同的代码，说`page.php`并编写一个条件，以便它只显示特定页面吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T21:25:56.210

您必须使用`Wordpress`模板系统。

您可以复制模板，例如：`single.php`到`sponsor.php`并按照[Wordpress Codex](http://codex.wordpress.org/Pages#Creating_Your_Own_Page_Templates)说明进行操作。

然后，当您创建页面时，您可以选择要使用的模板。您可以以任何方式更改该模板，包括翻转墙：

```
<?php wp_sfw_render(); ?> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T21:25:07.863

您可以创建一个自定义页面 - [http://codex.wordpress.org/Pages#Creating_Your_Own_Page_Templates](http://codex.wordpress.org/Pages#Creating_Your_Own_Page_Templates)并且此代码仅适用于该页面模板。然后，您创建一个新页面“赞助商”并在右侧页面模板菜单中选择。

# windows-7 - 创建批处理文件或其他东西来启动数据库等服务？

> ID：11977460
> 
> 赞同：0
> 
> 时间：2012-08-15T21:17:09.530
> 
> 标签：windows-7, windows-services

我正在使用 Windows 7-64 位和 SQL Server 数据库。我想创建一个批处理文件/任何我可以简单地单击以启动其所有服务的文件。我想避免单击并手动启动它们中的每一个的苦差事。但是，我不希望它们在启动时自动运行。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T23:21:06.677

使用标准 NET 命令启动批处理文件中的每个服务。请参阅[“如何从命令行启动/停止 Windows 服务？”](http://www.coretechnologies.com/WindowsServices/FAQ.html#StartStopFromCommandLine) 有关详细信息，请参阅 Windows 服务常见问题解答。

# php - 使用 PHP 将 css/js 文件分配给 html 文档

> ID：11977475
> 
> 赞同：0
> 
> 时间：2012-08-15T21:17:47.673
> 
> 标签：php, javascript, html, css, include

我创建了自己的模板/查看引擎以与 Codeigniter 一起使用。在其中，我可以指定某些 css/js 文件以用于特定视图。我在一个数组中分配文件名，然后将循环通过，同时`<link href="X"..., <script type="X"...,`在模板的头文件中为相应的文件类型回显必要的等。

问题是我似乎无法使用我试图包含的资源。CSS/JS 文件无法正常工作，即使它们被包含和嵌入，并且根据 HTML 源代码中的语法，一切看起来都是正确的。

我的理论是，因为我使用 echo 将链接/脚本对象实际打印到 HTML 中，所以它实际上并不是 HTML 可以识别的对象？有点像试图在 PHP 中回显一个对象——它不起作用。

有什么建议吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T21:46:46.940

如果您使用 php 生成的代码的纯 HTML 并不重要。对于浏览器来说都是一样的。

您需要检查您的源代码，并检查您包含的脚本是否可访问。因此，从浏览器的源代码中复制/粘贴 src="blabla"，然后将其粘贴到地址栏中，看看会发生什么。

这绝对不是 PHP 的错。

# c# - 在 C# 中引用对象

> ID：11977477
> 
> 赞同：1
> 
> 时间：2012-08-15T21:17:55.740
> 
> 标签：c#, object, reference

我有一个名为节点的类。我想将每个节点的父节点存储在每个节点中，如下所示：

```
public class Node
{
    public Node parent;
} 
```

所以说我将父节点分配给一个节点：

```
Node n = new Node();
Node n2 = new Node();
n.parent = n2; 
```

如果我改变n2，n的父变量也会改变吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-08-15T21:20:27.580

不，`parent`变量 of`n`不会改变：一旦引用被复制，它就会拥有自己的生命。但是，如果您更改`Node`指向的`n2`，则`n`的父级将看到该更改。例如，如果您设置`n2.parent = n3`,`n.parent.parent`也会更改`n3`为。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T21:19:50.840

是的，这是参考，`n.parent = n2;`

需要明确的是，如果您更改 N2（即`N2.prop = newvalue`），那么当您更改时`n.Parent.prop`，它将是`newvalue`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-08-15T21:24:22.223

```
public class Node
{
   public string a;
   public Node parent;
}

Node n = new Node();

Node n2 = new Node();
n2.a = "1";
n.parent = n2; 

// n.parent.a is "1" now

n2.a = "2";

// n.parent.a is "2" now 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-08-15T21:33:51.650

将类类型的变量、参数、数组槽等视为持有“对象 ID”。类似这样的语句`n1.parent = n2;`“查找由存储在 中的对象 ID 标识的对象，该对象`n1`的类型为`Node`；更改该`parent`对象的字段以包含存储在中的对象 ID `n2`”。

假设`n1`最初分配了 [Object ID#1] 并`n2`最初分配了 [Object ID#2]。该语句`n1.parent = n2`将使`parent`Object #1 的字段包含 [Object ID #2]。如果要执行一个语句，就像`n2.someProperty = 5`之前将任何其他内容存储在 中一样`n2`，该语句将修改 Object #2 的该属性。由于`parent`Object #1 的字段包含 [Object ID#2]，因此该语句也将显示为 modify `n1.parent.someProperty`。另一方面，如果将不同的对象 ID 存储到`n2`中，则不会影响`n1.parent`，它将继续保存 [对象 ID #2]。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-08-15T21:19:40.607

是的，因为它是通过引用。它将在 n 和 n2 中更新

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-08-15T21:20:04.383

是的，您通过引用来引用同一个对象。

# php - PHP 正则表达式 preg_replace 定义丢失

> ID：11977487
> 
> 赞同：0
> 
> 时间：2012-08-15T21:18:30.623
> 
> 标签：php, regex

我想让用户输入有效，因此我使用正则表达式。我希望用户只插入字母数字内容和一些特定字符 - ,!$^& 等。到目前为止我得到的代码是：

```
$validText = preg_replace('@[^A-Za-z0-9\w\ ]@', '',$text); 
```

但它只关心字母数字和空格，但我如何定义正则表达式以将字符称为 .'!@# 等？我在哪里定义它？顺便问一下，你能给我推荐一个**好的**正则表达式吗？

任何建议

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-08-15T21:20:21.727

只需将它们添加到您的组。

```
$validText = preg_replace('/[^A-Za-z0-9\w .\'!@#]/', '',$text); 
```

**注意：** [`preg_match()`](http://php.net/manual/en/function.preg-match.php)可能更适合这种情况。目前您允许无效字符然后删除它们。导致用户体验不佳。

# windows - 使用 7zip 压缩某些目录的批处理文件？

> ID：11977488
> 
> 赞同：0
> 
> 时间：2012-08-15T21:18:33.020
> 
> 标签：windows, batch-file, 7zip

只是请求批处理编程的帮助。需要对某些文件夹进行定期备份，并且想知道我将如何实现这一点。

目标：滚动目录并压缩具有特定名称的特定文件夹。

代码逻辑：

```
 //For all directories in folder
  for /d %%X in (*) do (
    if ( %%X != tag_****** )
        "7z.exe" a -ttar "%%X.tar" "%%X\"
  ) 
```

.

```
 for %%X in (*.tar) do 
    "7z.exe" a -tgzip "%%X.tgz" "%%X" 
```

如果可能，我将如何批量区分文件夹名称？

例如：压缩 tag_aaa111 ，跳过 tag_aaa111_v2 ，跳过所有没有前缀“tag_”的文件夹

条件是目录以 tag_ 开头，之后正好有 6 个字符。

一直试图弄清楚这一点。谢谢您的帮助。

编辑：代码，澄清。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T21:30:10.003

你在乎语言吗？如果您想使用 PERL，您可以执行以下操作：

```
while(<*>){
  if(-d && m/^tag_/){
    system("7zip $_"); # Change to whatever compress command you need
  } else {
    #other condition for other files and non matching directories
  }
} 
```

系统将使用其中的任何参数进行系统调用。-d 将指定文件是否为目录，m// 是与指定模式匹配的正则表达式

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T21:29:58.890

查看 Windows[`FOR`](http://ss64.com/nt/for.html)和[`IF`](http://ss64.com/nt/if.html)批处理文件命令。基本上，应该可以这样写：

```
for /D %%f in (*) do (
    set dirname=%%f
    if "%dirname:~0,4%"=="tag_" (
        7z ... %dirname% ...
    )
) 
```

[未经测试:)]

# ruby-on-rails - 如何将 RSpec/Capybara 测试放在 spec/requests 目录之外？

> ID：11977490
> 
> 赞同：0
> 
> 时间：2012-08-15T21:18:32.573
> 
> 标签：ruby-on-rails, capybara, rspec2

出于某种原因，我的团队不希望我们的验收测试存在于 spec/requests 目录中。相反，他们希望将它们放置在规范目录结构之外的一个名为接受的新目录中。所以，我的第一个问题是，使用 RSpec、Capybara 和 capybara-webkit，这是否可能？

这是我的acceptance_spec_helper.rb 文件

```
 require 'rubygems'

ENV["RAILS_ENV"] ||= 'test'

require File.expand_path("../../config/environment", __FILE__)

require 'rspec/rails'
require 'rspec/autorun'
require 'capybara/rspec'
require 'capybara/rails'

# Requires supporting ruby files with custom matchers and macros, etc,
# in spec/support/ and its subdirectories.
Dir[Rails.root.join("spec/support/**/*.rb")].each {|f| require f}

# Capybara.javascript_driver = :webkit

RSpec.configure do |config|

  config.include RSpec::Rails::RequestExampleGroup, :type => :request, :example_group => {
    :file_path => config.escaped_path(%w[acceptance])
  }

  # Remove this line if you're not using ActiveRecord or ActiveRecord fixtures
  config.fixture_path = "#{::Rails.root}/spec/fixtures"

  # If you're not using ActiveRecord, or you'd prefer not to run each of your
  # examples within a transaction, remove the following line or assign false
  # instead of true.
  config.use_transactional_fixtures = true

  # If true, the base class of anonymous controllers will be inferred
  # automatically. This will be the default behavior in future versions of
  # rspec-rails.
  config.infer_base_class_for_anonymous_controllers = false
end 
```

但是，看起来应用程序实际上并不是为了进行测试而运行的。

并且请不要只是说将测试放回 spec/requests 目录而没有一些非常有力的论据来支持为什么这是唯一的选择。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-10-09T13:40:03.510

我在我的规格中做了类似的事情`spec/acceptance`，用 标记它们`:acceptance => true`，并用单独的 rake 任务运行它们`rake spec:acceptance`

查看这个要点 - [https://gist.github.com/3858851](https://gist.github.com/3858851)。

希望能帮助到你

# wcf - 使用 WCF 自定义 MessageEncoder 解析多部分消息

> ID：11977493
> 
> 赞同：4
> 
> 时间：2012-08-15T21:18:41.933
> 
> 标签：wcf, mtom

我正在将 WCF 客户端写入 SOAP 服务，该服务返回带有二进制数据（实际上是 PDF 文件）的 mime 多部分结果。它使用自定义消息编码器。

如果我将请求设为单部分格式，该服务似乎并不介意，因此我可以返回结果。从我所看到的结果来看，有两个问题：

*   它似乎只返回多部分消息的第一部分。
*   我的自定义编码器无法解码我返回的数据。

我曾尝试使用 MTOM 绑定，但这会弄乱请求。未能在内容类型中添加“边界”参数，因此服务器无法理解请求。

我想我想要的是一个基本的文本 SOAP 请求，但响应解码为 MTOM 样式。但是，我不知道如何设置它。

我找到的最接近的解决方案是：http: [//blogs.msdn.com/b/carlosfigueira/archive/2011/02/16/using-mtom-in-a-wcf-custom-encoder.aspx](http://blogs.msdn.com/b/carlosfigueira/archive/2011/02/16/using-mtom-in-a-wcf-custom-encoder.aspx)

但这对我的项目来说似乎是一个非常具有侵略性的改变。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-08-17T16:34:24.517

我想通了。首先，当我说我只使用 MTOM 编码器获取多部分消息的第一部分时，我是不正确的；我得到了整个事情。我在调试器中查看它，底部一定在调试查看器中被剪掉了。将其归咎于我缺乏手动查看和破译多部分消息的经验。

对于第二点，我所要做的就是在 Content-Type 是多部分/相关并且一切正常时使用 MTOM 编码器。如果您阅读了上面引用的文章，这就是动态检测消息是多部分文本还是常规文本，并据此选择合适的编码器。本质上，它是一个自定义编码器，其中内置了文本编码器和 MTOM 编码器，并根据传入消息的内容类型来回切换。

我们的项目需要在将响应消息传递给主程序逻辑之前对其进行一些后期处理。因此，我们将传入的 SOAP 内容作为 XML 字符串获取，并对其进行一些 XML 操作。

这与文章中推荐的解决方案略有不同。本文解决方案中所需的只是使用正确的编码器将消息读取到 System.ServiceModel.Channels.Message 中，然后将其返回。在我们的解决方案中，我们需要中断这个过程并进行后处理。

为此，请在您的自定义编码器中实现以下内容：

```
public override Message ReadMessage(ArraySegment<byte> buffer, BufferManager bufferManager, string contentType)
{
    //First, get the incoming message as a byte array
    var messageData = new byte[buffer.Count];
    Array.Copy(buffer.Array, buffer.Offset, messageData, 0, messageData.Length);
    bufferManager.ReturnBuffer(buffer.Array);
    //Now convert it into a string for post-processing.  Look at the content-type to determine which encoder to use.
    string stringResult;
    if (contentType != null && contentType.Contains("multipart/related"))
    {
        Message unprocessedMessageResult = this.mtomEncoder.ReadMessage(buffer, bufferManager, contentType);
        stringResult = unprocessedMessageResult.ToString();
    }
    else {
        //If it's not a multi-part message, the byte array already has the complete content, and it simply needs to be converted to a string
        stringResult = Encoding.UTF8.GetString(messageData);
    }
    Message processedMessageResult = functionToDoPostProccessing(stringResult);
    return processedMessageResult;
} 
```

# android - 安卓监控应用

> ID：11977497
> 
> 赞同：11
> 
> 时间：2012-08-15T21:19:14.103
> 
> 标签：android

我想创建一个具有实时监控功能的 Android 应用程序。一种监控功能是审计音频流。另一个功能是与外围传感器交互。这些监控功能可以由其他人触发。此外，为了节省功耗，音频功能会以轮询模式运行，即休眠一定时间，唤醒一定时间。

我正在考虑如何设计Android应用程序。

*   将音频功能设计为Service还是Activity？问题是如果设计成Activity的话，如果屏幕关闭一段时间后，音频功能就会关闭。

*   如何设计轮询功能？使用 AlarmManager 或带 Timer 的内线程？

我的目标是尽可能地节省功耗。谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-28T16:13:19.817

我会推荐以下

a) 使用服务。活动是短暂的实体（它仅在屏幕上有效）

b）使服务前台（阅读此： http: [//developer.android.com/reference/android/app/Service.html#startForeground](http://developer.android.com/reference/android/app/Service.html#startForeground(int) (int , android.app.Notification)。这将减少系统杀死的机会你的服务

c) 在服务中，启动一个线程并在线程中做所有你需要的事情。

d) 如果要定期执行，只需在线程中执行 Thread.sleep() 即可（当 Thread 休眠时，它不会消耗 CPU 周期）。

我相信 c) 和 d) 比 AlarmManager 更可取。这是文档中的一段（http://developer.android.com/reference/android/app/AlarmManager.html）：“注意：警报管理器适用于您希望在特定时间运行应用程序代码的情况，即使您的应用程序当前未运行。对于正常的计时操作（滴答声、超时等），使用 Handler 更容易且效率更高。

由于您的应用程序正在运行，因此最好有一些永久运行的线程并在其上执行某些操作。一般来说 Handler、HandlerThread、MessageQueue 只是用于更复杂的消息处理和调度的便利类。看起来你的情况很简单，通常的 Thread 应该足够了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-12T00:59:07.223

同意 Victor，您肯定想使用服务，并通过调用将其固定到内存中`startForeground()`

但是我建议您考虑使用内置系统`Handler`；将您的功能放在 a 中`Runnable`并调用`mhandler.postDelayed(myRunnable, <some point in future>)`；这将允许 android 框架充分利用电源管理。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-13T12:41:44.640

那是一种服务。

而且您可能需要一些额外的健壮性：服务可以被终止并且以后*不会*重新启动，即使是前台服务。这将停止您的监控。

从 UI 启动您的服务。如果您希望服务在设备重启后仍然存在，也可以从 android.intent.action.BOOT_COMPLETED 的 BroadcastReceiver 启动它。

如此处其他答案中所述，在服务中创建一个线程。

此外，使用警报管理器定期重新启动您的服务。多个 startService() 调用都可以。如果已经运行，该服务将继续运行。但是如果它被系统遗忘了，比如在一系列资源不足的情况下，它现在会重新启动。

负责任地安排这些警报：做一个好公民，设置绝对最低的频率。毕竟，Android 有一些很好的理由来终止该服务。

对于某些服务，可能需要更多步骤，但在这种情况下，这种方法似乎就足够了。

# javascript - JavaScript 字符串何时不是字符串？

> ID：11977506
> 
> 赞同：8
> 
> 时间：2012-08-15T21:19:59.033
> 
> 标签：javascript

> **可能重复：**
> [为什么 (“foo” === new String(“foo”)) 在 JavaScript 中评估为 false？](https://stackoverflow.com/questions/10951906/why-does-foo-new-stringfoo-evaluate-to-false-in-javascript)

在[这里，](https://stackoverflow.com/questions/3586775/javascript-string-equality-whats-the-correct-way)我收到了最好使用非类型强制字符串比较的建议，但在 Chrome 中，我发现了一些奇怪的东西：

```
var t1 = String("Hello world!");
var t2 = new String("Hello world!");
var b1 = (t1==t2); // true
var b2 = (t1===t2); // false 
```

这是标准行为吗？如果是这样，t1 和 t2 各自的类型是什么？谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2012-08-15T21:23:14.583

如果不将“ `new`”关键字与 String 一起使用，则会得到原始字符串。

如果你使用“ `new`”关键字，你会得到一个字符串对象而不是原始对象。

当您使用**`==`**它时，它会尝试转换为可比较的类型，因此它可以相等。

如果你使用**`===`**，它不会转换，所以一个对象不能等于一个基元。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-08-15T21:23:12.340

这是解释

```
typeof String("Hello world!");
"string" 
```

和：

```
typeof new String("Hello world!");
"object" 
```

当你使用`===`它时要注意类型，所以它返回 false

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-08-15T21:23:44.723

`String`，作为函数调用，将其参数转换为 a `string`。`String`，作为构造函数调用，创建一个原型为`String`函数的对象。（查看相关 ECMAScript 规范部分的[James 答案](https://stackoverflow.com/a/11977606/15055)。）

这确实令人困惑。

这两个相等运算符实际上做了非常不同的事情。从[ECMA-262, v 5.1 文档](http://www.ecma-international.org/ecma-262/5.1/Ecma-262.pdf)中，`===`可以：

> 1.  如果`Type(x)`不同`Type(y)`，则返回`false`。
> 2.  如果`Type(x)`是`Undefined`，则返回`true`。
> 3.  如果`Type(x)`是`Null`，则返回`true`。
> 4.  如果`Type(x)`是`Number`，那么
>     a. 如果`x`是`NaN`，则返回`false`。
>     湾。如果`y`是`NaN`，则返回`false`。
>     C。如果`x`与 的`Number`值相同`y`，则返回`true`。
>     d。如果`x`是`+0`和`y`是`-0`，返回`true`。
>     e. 如果`x`是`-0`和`y`是`+0`，返回`true`。
>     F。返回`false`。
> 5.  如果`Type(x)`是`String`，则返回`true`if`x`和`y`是完全相同的字符序列（长度相同，对应位置的字符相同）；否则，返回`false`。
> 6.  If `Type(x)`is `Boolean`, return `true`if `x`and `y`are both `true`or both `false`; 否则，返回`false`。
> 7.  返回`true`if`x`并`y`引用同一个对象。否则，返回`false`。

鉴于`==`：

> 1.  如果`Type(x)`与 相同`Type(y)`，则
>     a。如果`Type(x)`是`Undefined`，则返回`true`。
>     湾。如果`Type(x)`是`Null`，则返回`true`。
>     C。如果`Type(x)`是`Number`，那么
>        我。如果`x`是`NaN`，则返回`false`。
>        ii. 如果`y`是`NaN`，则返回`false`。
>        iii. 如果`x`与 的`Number`值相同`y`，则返回`true`。
>        iv. 如果`x`是`+0`和`y`是`-0`，返回`true`。
>        v. 如果`x`是`-0`并且`y`是`+0`，返回`true`。
>        六。返回`false`。
>     d。如果`Type(x)`is `String`，然后返回`true`if`x`和`y`是完全相同的字符序列（相同的长度和相同的字符在相应的位置）。否则，返回`false`。
>     e. 如果`Type(x)`是`Boolean`，则返回`true`if`x`和`y`are both`true`或 both `false`。否则，返回`false`。
>     F。返回`true`if`x`并`y`引用同一个对象。否则，返回`false`。
> 2.  如果`x`为 null`y`且未定义，则返回`true`。
> 3.  如果`x`未定义且`y`为空，则返回`true`。
> 4.  如果`Type(x)`是`Number`和`Type(y)`是`String`，返回比较的结果
>     `x == ToNumber(y)`。
> 5.  如果`Type(x)`是`String`和`Type(y)`是`Number`，返回比较的结果
>     `ToNumber(x) == y`。
> 6.  如果`Type(x)`是`Boolean`，则返回比较结果`ToNumber(x) == y`。
> 7.  如果`Type(y)`是`Boolean`，则返回比较结果`x == ToNumber(y)`。
> 8.  如果`Type(x)`是`String`或者`Number`和`Type(y)`是`Object`，则返回比较的结果`x == ToPrimitive(y)`。
> 9.  如果`Type(x)`是`Object`并且`Type(y)`是`String`或者`Number`，返回比较的结果`ToPrimitive(x) == y`。
> 10.  返回`false`。

请注意，在规范中，`Type`原始字符串对象的 是`String`，而任何对象（包括`String`对象）的类型是`Object`。

与`===`相关的行是`#1`：`Type`对象不同，因此`false`返回。

与`==`相关的行是`#8`: `x`is a `String`( `"Hello world!"`) and `y`is an `Object`(The `String`object contains the string `"Hello world!"`)。这样就进行了比较`x == ToPrimitive(y)`。`ToPrimitive`最终调用`valueOf`对象的方法，或者如果该方法不存在，则调用该`toString`方法。在这种情况下，`String` *对象*的`valueOf`方法返回`string`对象包含的原语。因此，相等操作再次完成，这次是在两个`string`包含相同文本的原始 s之间，`true`由于`#1.d`.

JavaScript 在底层有点混乱......

* * *

编辑：请注意，如果比较两个对象，则不应用转换，而是应用规则`#1.f`。因此，多亏了规范，我能够正确预测以下代码的输出：

```
> new String("hi") == new String("hi")
false 
```

* * *

编辑：只是想我会补充一点，这些区别被更隐式的类型转换进一步模糊了。例如，以下工作：

```
> ("hi").toString()
"hi" 
```

但这不是因为`"hi"`是一个对象（就像在 Python 中一样）：

```
> typeof "hi"
"string" 
```

而是因为[`.`运算符](http://ecma-international.org/ecma-262/5.1/#sec-11.2.1) 将原始类型[转换](http://ecma-international.org/ecma-262/5.1/#sec-8.7.1)`string`为字符串`Object`类型（创建一个新的字符串对象），`toString`然后调用其方法。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-08-15T21:27:30.093

此行为在[ECMAScript 5 规范 15.5.1 和 15.5.2](http://es5.github.com/#x15.5.1)中有详细说明：

> 当`String`作为函数而不是构造函数调用时，它执行类型转换。
> 
> ...
> 
> 返回由 计算的字符串值（不是`String`对象）`ToString(value)`。如果`value`未提供，则返回空字符串“”。

因此`String("some string")`创建了一个字符串值。

> 当`String`作为`new`表达式的一部分被调用时，它是一个构造函数：它初始化新创建的对象。

所以`new String("some string")`创建了一个`String`对象的实例。

* * *

并实际回答您的问题：

> 这是标准行为吗？

*是*的，出于上面详述的原因。

> 如果是，t1 和 t2 各自的类型是什么

您可以与`typeof`操作员检查：

```
console.log(typeof t1); //string
console.log(typeof t2); //object 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-08-15T21:24:44.770

发生这种情况是因为`==`操作员只检查值是否相同，而同时`===`检查值**和**类型。`new String("Hello world!")`实际上并没有给出类型`string`，它是一个`object`，而`String("Hello world!")`实际上是一个`string`。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-08-15T21:23:30.203

第一个示例`String("Hello world!)"`创建一个原始字符串，而第二个示例`new String("Hello world!")`创建一个 String 对象。

# php - 获取本周和上周的访问者总数

> ID：11977507
> 
> 赞同：0
> 
> 时间：2012-08-15T21:20:01.303
> 
> 标签：php, date

我想获得本周和上周的访问者总数，我找到了一个可能的解决方案，但它不会显示正确的数量。根据 HeidiSQL，本周有 91 位访客，上周有 383 位访客。下面的代码显示，本周有 88 位访客，上周有 56 位访客。

`SELECT COUNT(date_lastactive) FROM visitors WHERE DATE(date_lastactive) = '".date('Y-m-d', strtotime('this week'))."'`

`SELECT COUNT(date_lastactive) FROM visitors WHERE DATE(date_lastactive) = '".date('Y-m-d', strtotime('last week'))."'`

我应该怎么做才能发出这个 SQL 请求以获得正确数量的访问者，或者 HeidiSQL 是这里的骗子？

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T21:38:04.680

您只选择一天。

```
SELECT COUNT(date_lastactive) FROM visitors WHERE DATE(date_lastactive) > '".date('Y-m-d', strtotime('monday'))."' && DATE(date_lastactive) < '".date('Y-m-d', strtotime('sunday'))."' 
```

我的代码不正确，但是您可以看到重点。

# javascript - 在 iPhone/iPad 5.1 中动态更改 contentEditable 状态时，execCommand 失败

> ID：11977511
> 
> 赞同：0
> 
> 时间：2012-08-15T21:20:14.180
> 
> 标签：javascript, iphone, ios, ipad, cordova

一个使用 PhoneGap 开发的 iOS 应用程序，向用户显示大型 HTML 内容。用户可以将文本部分加粗、下划线...，但不应添加或删除现有文本。

因此，我在 HTML 中默认将 div 的 contentEditable 设置为“false”。使用 execCommand() 格式化所选文本。当用户选择文本并单击“粗体”按钮时，我在执行 execCommand() 之前将 contentEditable 更改为“true”，然后将其设置回“false”。execCommand() 在包括 Safari 在内的所有桌面浏览器中使文本按预期加粗，但在 iPhone/iPad 中则不然。

非常感谢您的帮助。

示例代码：（我在 iOS 5.1 模拟器中测试过）

```
<html>
<head>
<script>
    function bold()
    {
        var content = document.getElementById("content");
        content.contentEditable = true;
        //document.body.contentEditable = true;
        var result = document.execCommand('bold', false, null);
        content.contentEditable = false;
        //document.body.contentEditable = false;
    };
</script>
</head>
<body>
    <div id="content">this is the same text used for testing...</div>
    <br><br>
    <input type="button" value="bold" onclick="javascript: bold();"/>
</body>
</html> 
```

# java - Jetty 在其中一台计算机中使用了过多的 RSS 内存。如何减少它

> ID：11977513
> 
> 赞同：1
> 
> 时间：2012-08-15T21:20:22.887
> 
> 标签：java, memory, jetty

我正在使用 maven、jetty、scala、scalate 和 scalate-ssp 运行一个简单的“hello world”Web 服务器项目。

使用“mvn jetty:run”运行项目，需要 120Mb 的 RSS 内存（ps -o rss,etime,pid,command）。

但是，在另一台计算机上运行完全相同的项目需要 480Mb 的 RSS 内存。

第一台电脑，mac：uname -a

```
Darwin mac.local 11.4.0 Darwin Kernel Version 11.4.0: Mon Apr  9 19:32:15 PDT 2012; root:xnu-1699.26.8~1/RELEASE_X86_64 x86_64 
```

第二台计算机，Linux：uname -a

```
Linux linux.local 2.6.32-220.2.1.el6.x86_64 #1 SMP Fri Dec 23 02:21:33 CST 2011 x86_64 x86_64 x86_64 GNU/Linux 
```

什么可以解释这种差异？

我有一个内存有限的环境。如何减少第二台计算机的 RSS 内存？

* * *

**从 joakime 的回答更新：**

苹果电脑：

```
Java HotSpot(TM)
Java version: 1.6.0_33, vendor: Apple Inc.
Apache Maven 3.0.3 (r1075438; 2011-02-28 18:31:09+0100) 
```

Linux：

```
OpenJDK
Java version: 1.6.0_24, vendor: Sun Microsystems Inc.
Apache Maven 3.0.4 (r1232337; 2012-01-17 09:44:56+0100) 
```

Mac 的 Runtime.getRuntime().maxMemory() 为 120Mb，Linux 为 3500Mb。

现在我运行：

```
export MAVEN_OPTS="-Xmx256m -Xms10m"; mvn jetty:run 
```

有了这个，在 linux Runtime.getRuntime().maxMemory() 现在提供 227Mb（而不是 3500Mb）。

但是，执行“ps -o rss,etime,pid,command”仍然会提供 430Mb 的 RSS 内存。我需要 RSS 内存小于 250Mb。

如何做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T22:00:51.227

如果没有更多信息，我推测您有不同的 JVM 实现（1 个 linux，1 个 OSX），并且可能没有指定这些 JVM 的内存上限。

请注意，不同的 JVM 可能会指定不同的内存上限默认值。即使是相同的 JVM 版本，oracle 也会在不同的操作系统/硬件组合上以不同的方式指定不同的最大内存限制。

关于这个主题的一个先前的问题可能会有所帮助：[Java SE 6 中 Sun 的 JVM 的默认最大堆大小是多少？](https://stackoverflow.com/questions/2915276/what-is-the-default-maximum-heap-size-for-suns-jvm-from-java-se-6)

此外，maven 版本在默认情况下使用的插件版本也不同，您可能会有完全在 maven + 其插件范围内的差异。

# backbone.js - 主干 Web 应用程序上的文件结构

> ID：11977516
> 
> 赞同：1
> 
> 时间：2012-08-15T21:20:44.970
> 
> 标签：backbone.js, namespaces, directory-structure, backbone-routing

我正在开发一个通过骨干网运行并使用路由器的 Web 应用程序。在某些事件成功时，我想将用户重定向到静态成功页面。

将路由 url 路径与静态页面（例如我的成功页面）明确分开的良好命名约定是什么？

我的路由主干对象中的路由对象如下所示：

```
App.MyRouter = Backbone.Router.extend({
    routes: {
        "":                     "index",
        "!/search/*search":     "search",
        "!/profile/*user":      "profile",
        "!/business/:id":       "business"

    }
}); 
```

# xml - 复杂的 xslt 地址拆分

> ID：11977517
> 
> 赞同：0
> 
> 时间：2012-08-15T21:20:54.103
> 
> 标签：xml, xslt, xpath, split, xslt-1.0

我有一个需要在第一个空格之后拆分的地址（我认为可以安全地假设街道名称在第一个空格之后开始）。然后我需要将每个文本部分（街道名称/门号/邮政信箱）分配给不同的节点。所有标点符号也需要删除。

代码需要这样做：

```
<address>123 1st St., P.O. Box 321</address> 
```

并把它变成这样：

```
<door_num>123</door_num>
<street_name>1st St</street_name>
<addr_postfix>PO Box 321</addr_postfix> 
```

我已经看到了几个关于如何在给定字符串中给定字符或位置的情况下拆分字符串的问题，但从不使用这两个参数。我最初想扫描字符串并挑选出任何数字，但我认为这不适用于邮政信箱号码或编号的街道。

我在想我需要使用 substring-before 和 substring-after 运算符，但我不知道如何正确实现它们。另外，这很复杂，我什至不知道从哪里开始

谢谢，

艾伦

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-16T02:18:08.863

**下面是一个完整的转换，适用于所提供的 XML 文档：**

```
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
 <xsl:output omit-xml-declaration="yes" indent="yes"/>

 <xsl:template match="address">
   <xsl:variable name="vNum" select="substring-before(.,' ')"/>
   <xsl:variable name="vStreet" select=
    "substring-before(substring-after(.,$vNum), ',')"/>
   <xsl:variable name="vPOBox" select="substring-after(.,',')"/>

   <door_num><xsl:value-of select="$vNum"/></door_num>
   <street_name>
    <xsl:value-of select="normalize-space(translate($vStreet, '.',''))"/>
   </street_name>
   <addr_postfix>
    <xsl:value-of select="normalize-space(translate($vPOBox, '.',''))"/>
   </addr_postfix>
 </xsl:template>
</xsl:stylesheet> 
```

**应用于提供的 XML 文档时**：

```
<address>123 1st St., P.O. Box 321</address> 
```

**产生了想要的正确结果：**

```
<door_num>123</door_num>
<street_name>1st St</street_name>
<addr_postfix>PO Box 321</addr_postfix> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-16T01:11:04.587

这解决了示例地址的特定情况，可以帮助您入门：

```
<xsl:template match="address">
    <door_num>
       <xsl:value-of select="substring-before(., ' ')"/>
    </door_num>
    <street_name>
       <xsl:value-of select="translate(substring-before(substring-after(., ' '), ','), '.', '')"/>
    </street_name>
    <addr_postfix>
       <xsl:value-of select="translate(normalize-space(substring-after(., ',')), '.', '')"/>
     </addr_postfix>
</xsl:template> 
```

# metadata - 将额外数据添加到 exe 末尾是否安全？

> ID：11977518
> 
> 赞同：1
> 
> 时间：2012-08-15T21:20:57.580
> 
> 标签：metadata, exe

我想在我的 exe 中添加一个可变长度的用户数据。例如，我不想在每次提交快速测试供某人查看时更改构建版本。如果我在 exe 中没有存储/可用的构建选项，我想添加 git/mercurial 分支信息和构建选项。这样我可以将 exe 放入 util 并获取我需要的数据。

将额外的数据添加到 exe 的末尾可以吗？它将是一个带有 Visual Studio 或 gcc 的 Windows C++ exe 构建，或者它可能是一个 .NET 应用程序

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T21:24:51.490

一些病毒检查程序可能会在这类事情上触发（如果您有的话，在您自己的机器上，或者可能在目标机器上）。

另一种方法是保留（手动或自动）您发送给人们的可执行文件的 SHA1 日志。然后，您可以通过计算可执行文件的 SHA1 并将其与日志中的条目进行比较来查看某人正在运行的确切版本。

# tomcat - Redis / Jedis - Tomcat 挂起 - 在 <5c1a77ba> 上等待（一个 org.apache.commons.pool.impl.GenericObjectPool$Latch）

> ID：11977520
> 
> 赞同：1
> 
> 时间：2012-08-15T21:21:07.300
> 
> 标签：tomcat, redis, deadlock, jedis

我有以下问题：

我的 Tomcat 因以下线程转储而挂起：

```
"ajp-bio-28109-exec-1589" - Thread t@1713
   java.lang.Thread.State: WAITING
                at java.lang.Object.wait(Native Method)
                - waiting on <5c1a77ba> (a org.apache.commons.pool.impl.GenericObjectPool$Latch)
                at java.lang.Object.wait(Object.java:503)
                at org.apache.commons.pool.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:1118)
                at redis.clients.util.Pool.getResource(Pool.java:24) 
```

我的应用程序将 Redis DB 与 Jedis 客户端一起使用。我有大约 2K 请求/秒。几个小时后，每个线程都在等待。

会不会是 DBCP 问题？有没有其他方法可以使用 Redis / Jedis 创建连接池？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-10-26T07:51:01.000

这可能是由于使用默认的*whenExhaustedAction*设置导致的，该设置将阻塞（调用 Object.wait()），直到有新的或空闲的对象可用。[在此处](http://commons.apache.org/pool/apidocs/org/apache/commons/pool/impl/GenericObjectPool.html)检查 javadoc 。

您可能需要增加*maxActive*值或设置适当的*maxWait*。

正如@xetorthio 提到的，您必须通过以下方式返回绝地资源：

```
Jedis jedis = pool.getResource();
try {
  /// ... do stuff here ... for example
  jedis.set("foo", "bar");
  String foobar = jedis.get("foo");
  jedis.zadd("sose", 0, "car"); jedis.zadd("sose", 0, "bike"); 
  Set<String> sose = jedis.zrange("sose", 0, -1);
} finally {
  /// ... it's important to return the Jedis instance to the pool once you've finished using it
  pool.returnResource(jedis);
}
/// ... when closing your application:
pool.destroy(); 
```

希望这可以帮助。

# sql - SQL Server 分页和圣杯

> ID：11977521
> 
> 赞同：0
> 
> 时间：2012-08-15T21:21:06.950
> 
> 标签：sql, sql-server, performance, pagination

我正在研究做一些有效的分页，发现这个链接说“圣杯”是最好的方法。

[http://www.sqlservercentral.com/articles/T-SQL/66030/](http://www.sqlservercentral.com/articles/T-SQL/66030/)

该表只是用作示例，还是实际上是解决方案的一部分。我的意思是，您将如何使用具有许多连接的表执行此操作，方法相同？有人可以发布一个例子吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T21:44:32.867

表“[INFORMATION_SCHEMA].columns”仅用作示例。

对于有很多连接的表，我会使用相同的方法。只要确保你有正确的索引。

“Holy Grial”解决方案只为您提供分页结果以及指示行总数的列，而无需开销。您可以获取另一个查询的总行数。

请注意文章结论：

> ....这种方法最适合来自复杂查询的较小结果集，其中 I/O 是主要瓶颈。Jeff Moden、Peso 和其他人在这里指出，对于更大的结果集，您节省的 I/O 成本超过 CPU 成本。

# function - 通过引用调用 Lua 函数

> ID：11977527
> 
> 赞同：2
> 
> 时间：2012-08-15T21:21:46.893
> 
> 标签：function, lua

好的，我搜索了这个，但无济于事。这是一种模糊的想法/想法，所以……就这样。

是否可以在 Lua 中调用一个函数（带有声明的值），然后通过引用再次调用它（无需再次传递值）？

我想要做的是创建一个更大的泛型函数（重复使用），它具有在调用泛型函数时声明的传递值。

如果通用函数失败，我希望它回收并尝试使用相同的使用值调用自身（无需再次将它们传递给函数。）

如果我没有失去任何人，希望那里有一些想法和想法。蒂姆

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-08-15T22:05:53.570

如果要将参数传递给函数，则需要每次都传递它们。

您可以通过闭包将一些参数绑定到函数：

```
function bind(f, ...)
    local args = {...}
    return function()
        return f(unpack(args))
    end
end

foo = bind(print, "This", "is", "a", "test")
foo() --> This    is      a       test
foo() --> This    is      a       test 
```

如果您发布了一些示例代码，那么回答您的问题会容易得多。

# c - C中的联合处理将多种类型的指针传递给函数

> ID：11977530
> 
> 赞同：0
> 
> 时间：2012-08-15T21:21:55.733
> 
> 标签：c

我有一些代码，我想要一个通用函数，该函数从主代码中获取指针并在指针地址处操作变量。问题是指针的类型是 char、int 和 short。我希望能够在没有标志或跟踪传递的指针类型等的情况下做到这一点。我的猜测是可以使用指针的 typedef 联合，然后该函数将采用 int 指针（最大数据大小三者中的）

除了 char 指针之外，以下类型的作品。有一个更好的方法吗？

```
 #include <stdio.h>

    void pointerfunction(int *p);
    int a=10;
    short b=20;
    char f=4;
    typedef union 
    {
    int *ptr1;
    short *ptr2;
    char *ptr3;
    }pointers;

    int main()
    {
    pointers mypointers;

    mypointers.ptr1=&a;
    pointerfunction(mypointers.ptr1);
    printf("%d\n", *(mypointers.ptr1));
    mypointers.ptr2=&b;
    pointerfunction(mypointers.ptr1);
    printf("%d\n", *(mypointers.ptr2));
    mypointers.ptr3=&f;
    pointerfunction(mypointers.ptr1);
    printf("%d\n", *(mypointers.ptr3));
    }

    void pointerfunction(int *p)
    {
    *p=*p*10;  
    } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T21:46:10.783

您使用联合的想法是一个很好的想法，但是您将不得不在联合中添加一个额外的成员来指示它实际上是哪种指针。

同一台机器上的所有指针大小相同，无论它们是 int *、char * 还是 void *。

int 和 short 工作的原因是因为编译器将 int 和 short 转换为 int，所以`printf()`函数基本上看到两者相同。

首先，我将描述一个可能的实现。然而，这个特定的实现是丑陋的，并不是真正的方法，因为它有许多问题，尤其是您使用命令开关并真正降低[内聚](http://en.wikipedia.org/wiki/Cohesion_%28computer_science%29)和增加[耦合](http://en.wikipedia.org/wiki/Coupling_%28computer_science%29)。

第一次尝试将类似于以下内容。

```
#define  POINTER_UNION_TYPE_CHAR   1
#define  POINTER_UNION_TYPE_INT    2
#define  POINTER_UNION_TYPE_SHORT  3

typedef struct {
  int   iType;
  union {
    char *pChar;
    int  *pInt;
    short *pShort;
  } u;
} Pointers; 
```

当您使用此结构时，您将执行以下操作：

```
int iValue = 1;
Pointers  PointerThing;

PointerThing.u.pInt = &iValue;  PointerThing.iType = POINTER_UNION_TYPE_INT; 
```

然后在你的函数中使用这个你会做类似的事情：

```
void pointer_funct (Pointers *pPointers)
{
   switch (pPointers->iType) {
      case  POINTER_UNION_TYPE_CHAR:
           // do things with char pointer pPointers->u.pChar
           break;
      case  POINTER_UNION_TYPE_INT:
           // do things with char pointer pPointers->u.pInt
           break;
      case  POINTER_UNION_TYPE_SHORT:
           // do things with char pointer pPointers->u.pShort
           break;
      default:
           break;
    }
} 
```

一个更好的方法是让单独的函数完成所有组合成一个函数的工作。因此，换句话说，您将拥有三个不同的函数，每个函数都将处理特定的指针类型。这样，知道类型是什么的功能就可以继续调用适当的函数。

另一种方法是使用一些面向对象的技术。看到这个[帖子到另一个虽然类似的问题](https://stackoverflow.com/questions/11821115/how-can-i-write-hardware-independent-functions-in-c-for-the-pic24)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-15T22:31:05.653

正如其他人所说，这在 C 中是不可能的。你是正确的，它`int`是三种类型中最大的，但你似乎忽略了这个事实的含义。

## 为什么这在 C 中是不可能的？

在 C 中，数据直接存储在内存中，没有元数据开销。变量直接映射到内存中的数据。除非您创建它（违反您的要求，即没有标志或跟踪正在传递的指针类型），否则没有与变量一起存储的信息，例如：

*   它是什么类型
*   变量是否已初始化
*   变量是否在范围内
*   或（对于数组/字符串）使用的长度或可用大小

就像其他语言一样。相反，这个信息应该由程序员维护，要么通过创建一个`struct`来存储这些信息，要么让程序员记住发生了什么。

C 是一种系统编程语言，它适用于系统编程的部分原因是它不像 Java 或 C# 那样具有这种开销。

## 好的，但为什么它在工会中不起作用？

所指向的类型的各种大小的含义是什么？考虑以下内存图，其中每个字符为 4 位，int 为 32 位，short 为 16 位，char 为 8 位：

```
半字节：89ABCDEF0123456789ABCDEF0123456789ABCDEF0123456789ABCDEF
[other ][data ][int ][int ][int ][mo][re][ ][da][ta] // 整数
[other ][data ][sh][or][t ][sh][or][t ][mo][re][ ][da][ta] // 短裤
[其他][数据][][][][][][][][][][][][][mo][re][][da][ta] // 字符

```

请注意，这完全忽略了对齐和字节顺序问题；有一些平台（包括 ARM，我在您的其他一些问题中看到）对对齐做出了某些保证，可以帮助您。（†）

但是，对于静态内存或堆上的内存，问题仍然存在。考虑如果将字符串存储`ABCDEFGHIJKL`在字符数组中会发生什么。记住 ASCII`A`是 0x41，这将在内存中变为以下内容：

```
[其他][数据]4142434445464748494A4B4C[mo][re][][da][ta]

```

现在假设您传递了一个指向`C`函数的指针，该函数将 this 取消引用为整数：

```
                    [int] // 指向 C 的 Int 指针
[其他][数据][][][][][][][][][][][][][mo][re][][da][ta] // 字符
[其他][数据]4142434445464748494A4B4C[mo][re][][da][ta]
                    ^-- C 在这里；0x43

```

在此处使用 int 指针将违反 C 规范。

如果这还不够，并且我们假设您的编译器在逻辑上运行，它将尝试跨字边界取消引用内存，这可能会引发总线错误或使用错误（我忘记了它在 ARMv7 上的实际作用，但其中任何一个错误都会终止您的程序）。

如果这仍然不够，并且它以某种方式完成了所要求的操作，则该操作将产生错误的答案，因为您正在使用值 0x43444546 而不是 0x43。

* * *

### 关于 ARM 处理器上的内存对齐的一些脚注

(†) 例如，在 ARM 上，ABI 指定堆栈在正常使用中必须是字对齐的 ( `sp % 4 == 0`)，在这种情况下，您的代码可能会工作，如下图所示：

```
0123456789ABCDEF0123456789ABCDEF0123456789ABCDEF0123456789ABCDEF0123456789ABCDEF
[其他][数据][int][int][int][mo][re][][da][ta]
[其他][数据][sh] [or] [t] [sh] [or] [t] [mo] [re] ...
[其他][数据][][][][][][][][]...

```

堆栈还保证对公共接口是双字对齐的，并且在内部不必维护它，有关详细信息，请参见 AAPCS 中的 5.2.1。尽管如此，这不是您想要依赖的东西（在大多数情况下可移植代码更可取），或者甚至需要知道，除非您正在编写编译器或原始汇编代码

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-08-15T21:30:58.063

这是一个坏主意。看这里：

```
void pointerfunction(int *p);
short b=20;
short c=20;
typedef union
{
  int *ptr1;
  short *ptr2;
  char *ptr3;
} pointers;

int main()
{
  pointers mypointers;

  mypointers.ptr2=&b;
  pointerfunction(mypointers.ptr2);
  printf("b=%d,c=%d\n", b,c);

  mypointers.ptr2=&c;
  pointerfunction(mypointers.ptr2);
  printf("b=%d,c=%d\n", b,c);

}

void pointerfunction(int *p)
{
  *p=*p*10;
} 
```

在我的系统上打印：

```
b=200,c=200
b=200,c=2000 
```

那是你想要发生的吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-08-16T06:29:02.353

看来您想要模板函数之类的东西。但是，C 不支持模板函数或函数重载。

由于您的三种类型具有不同的大小，您可以从指针推断类型。因此，您可以使用宏来创建重载函数的感觉。

```
#define pointerfunction(x) do { \
    switch (sizeof(*x)) { \
    case sizeof(int):   pointerfunction_int((void *)x);   break; \
    case sizeof(short): pointerfunction_short((void *)x); break; \
    case sizeof(char):  pointerfunction_char((void *)x);  break; \
    default:            fprintf(stderr, "unknown pointer type for %p\n", x); \
                        break; \
    } \
} while (0)

#define pointerfunction_template(T) \
    void pointerfunction_ ## T (T *x) { *x = *x * 10; }

pointerfunction_template(int);
pointerfunction_template(short);
pointerfunction_template(char); 
```

然后，您可以像这样使用宏：

```
int a=10;
short b=20;
char f=4;

int main () {
    pointerfunction(&a);
    pointerfunction(&b);
    pointerfunction(&f);
    return 0;
} 
```

但是，这种技术一般不会起作用。特别是，如果两种类型的大小相同，它就会失败。然后，您将被迫将类型本身嵌入到您的宏调用中。

```
#define pointerfunction_call(T, x) pointerfunction_ ## T(x)

pointerfunction_template(float);
pointerfunction_template(double);

float g = 2.2;
double h = 3.1;

pointerfunction_call(float, &g);
pointerfunction_call(double, &h); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-08-15T21:30:30.960

这是行不通的。您无法知道您在联合中存储的指针的类型。

您可以定义一个结构，该结构将联合作为成员，另一个字段说明您正在使用哪种值。请记住，无论指针指向什么，指针的大小都是相同的。我没有测试过这个，但你明白了。

```
#include <stdio.h>

int a=10;
short b=20;
theChar f=4;

#define INT 1
#define SHORT 2
#define CHAR 4

typedef union 
{
int *ptr1;
short *ptr2;
char *ptr3;
}pointers;

typedef struct {
    pointers ps;
    type int;
} myStruct;

void pointerfunction(myStruct theStruct)
{
    switch (theStruct.type) {
        case INT:
            *(theStruct.ptr1) += 10;
            break;
        case SHORT:
            *(theStruct.ptr2) += 20;
            break;
        case CHAR:
            *(theStruct.ptr3) += 30;
            break;
    }
}

int main()
{
    // Example with a char
    myStruct theStruct;
    theStruct.type = CHAR;

    theStruct.ptr3=&theChar;

    pointerfunction(theStruct);
    printf("%d\n", *(theStruct.pointers.ptr3));
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-08-15T22:18:27.917

C*不能*做“通用”函数，至少不能像 C++ 模板和函数重载那样“做我的意思”：

```
template <typename T>
void pointerfunction(T *p)
{
  *p = *p * 10;
}
...
pointerfunction(&a);
pointerfunction(&b);
pointerfunction(&c); 
```

在某些时候，您的函数*必须*知道指针的正确类型才能正常运行；将指针类型转换为`int *`将导致非整数类型出现问题。

您*可以*做的一件事是编写一个不同的函数来处理每种类型的指针，但通过一个通用的“通用”接口调用这些函数，如下所示：

```
void intfunc(void *p)   { int   *lp = *p; *lp *= 10; }
void charfunc(void *p)  { char  *lp = *p; *lp *= 10; }
void shortfunc(void *p) { short *lp = *p; *lp *= 10; }

void callfunc(void *data, void (*ptrfunc)(void *))
{
  ptrfunc(data);
}
...
callfunc(&a, intfunc);
callfunc(&b, shortfunc);
callfunc(&c, charfunc); 
```

它并不漂亮，而且与 C++ 模板不同，它会抛出任何类型安全的伪装（一旦你开始使用`void *`，你就失去了编译器的任何支持）。

但...

这种方法非常灵活，您不必做任何*不*自然的事情就可以让它发挥作用。

# .net - 使用 C# 任务挂起 nunit 并使用 Testflight 在后台继续运行。怎么单元测试呢？

> ID：11977531
> 
> 赞同：0
> 
> 时间：2012-08-15T21:21:57.590
> 
> 标签：.net, unit-testing, nunit, task-parallel-library, testdriven.net

我正在构建一个基于任务的服务器。我的问题是如何通过单元测试证明工作正常：

下面的方法是应用程序的核心，需要扎实。我需要它来执行任务链，如果启动它的日期在将来，则休眠等等。但是，当我使用 nuni gui 运行它时，它会永远挂起，并且使用[http://www.testdriven.net/](http://www.testdriven.net/)附加组件运行，并让它在后台运行，所以我无法阻止它VS IDE（即运行，然后根据IDE完成，但一直在后台运行，需要kill testdriven才能停止）

```
public Task RunPlan(plan thePlan)
{
    List<BackupTask> tasks = this.nextTasks(thePlan);
    List<Task> backupTasks = new List<Task>();

    TimeSpan wait;
    int i = 1;
    Task run = new Task(() =>
    {
        Logging.Debug("Starting {0}", thePlan);
    });
    //  Create a new token source
    var primaryTokenSource = new CancellationTokenSource();
    //  Create the cancellation token to pass into the Task
    CancellationToken token = primaryTokenSource.Token;

    workerTokens.GetOrAdd(run, primaryTokenSource);

    backupTasks.Add(run);

    foreach (var t in tasks)
    {
        BackupTask job = t;

        Task next = backupTasks.Last().ContinueWith(x =>
        {
            //  Check to see if we've been cancelled
            if (token.IsCancellationRequested)
            {
                Logging.Debug("Cancelled");
                return;
            }
            //Si es en el futuro, esperar
            wait = job.SuggestedDate - DateTime.Now;

            if (wait.TotalSeconds > 0)
            {
                Logging.Debug("Sleeping {0} secs..", wait.TotalSeconds);
                //http://stackoverflow.com/questions/1141617/thread-interrupt-to-stop-long-sleep-at-app-shutdown-is-there-a-better-approach
                //Thread.Sleep(TimeSpan.FromSeconds(wait.TotalSeconds));
                while (!stopping)
                {
                    lock (padlock)
                    {
                        Monitor.Wait(padlock, TimeSpan.FromSeconds(wait.TotalSeconds));
                    }
                }
            }

            //  Check to see if we've been cancelled
            if (token.IsCancellationRequested)
            {
                Logging.Debug("Cancelado");
                return;
            }

            job.doWork();
        },TaskContinuationOptions.LongRunning);
        backupTasks.Add(next);
    }

    backupTasks.First().Start();

    return backupTasks.Last();
} 
```

和测试：

```
[Test]
public void testFullBackup()
{
    taskMgr.RunPlan(plans.First()).Wait();
    Assert.AreEqual(0, taskMgr.workerTokens.Count());
} 
```

# django - 通过 django-denorm 中的另一个模型对关系进行非规范化

> ID：11977532
> 
> 赞同：0
> 
> 时间：2012-08-15T21:21:59.517
> 
> 标签：django, postgresql

[是否可以使用django-denorm](https://github.com/initcrash/django-denorm)对多级关系进行非规范化？

具体来说，我有以下结构：

```
Question --> User --> CustomProfile --> Avatar 
```

我想对`Question`模型上的头像名称进行非规范化。目前，我必须遍历这 4 个表才能获取该信息。

我正在使用 Postgresql。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-16T14:36:25.313

通常链接依赖项是有效的，并且是处理这种情况的方法。

在这种情况下，如果您没有提供链中的一个模型，您最好的选择是实现您自己的依赖类，类似于在以下位置找到的那些： [https ://github.com/initcrash/django-denorm/blob/master/ denorm/dependencies.py](https://github.com/initcrash/django-denorm/blob/master/denorm/dependencies.py)

所以你得到：

```
class Question(models.Model):
    @denormalized(...)
    @depend_on_related("User")
    @depend_on_indirectly_related("CustomProfile",through="User")
    def avatar(self):
        return self.user.custom_profile.avatar_name

class CustomProfile(models.Model):
    @denormalized(...)
    @depend_on_related("Avatar")
    def avatar_name(self):
        return self.avatar.name 
```

这当然是 django-denorm 的一个受欢迎的补丁。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T21:34:12.250

没试过，但你可以试试这个：

在您的模型中级联[官方文档中的](http://initcrash.github.com/django-denorm/tutorial.html#creating-denormalized-fields-using-callback-functions)*取决于相关模型代码*，即`Avatar --> Custom Profile --> User --> Question`

由于它在内部使用触发器，因此应该级联。

```
class SomeModel(models.Model):
    # the other fields
    other = models.ForeignKey('SomeOtherModel')

    @denormalized(models.CharField,max_length=100)
    @depend_on_related('SomeOtherModel')
    def some_computation(self):
       # your code
       return some_value 
```

如果这不起作用，我可能会亲自使用自定义 sql，然后取决于 django 的 ORM。

# ruby-on-rails - 安装 Nerdtree 的问题

> ID：11977535
> 
> 赞同：0
> 
> 时间：2012-08-15T21:22:08.983
> 
> 标签：ruby-on-rails, macvim, nerdtree, pathogen

根据 nerdtree 安装说明，我需要安装 Pathogen.vim 来安装 nerdtree。为了安装pathogen.vim，我遵循了pathogen install instructions，我这样做了：

```
~$ mkdir -p ~/.vim/autoload ~/.vim/bundle; \
> curl -so ~/.vim/autoload/pathogen.vim \
> <link to github> 
```

这在这里创建了pathogen.vim：

```
~/.vim/autoload$ ls

pathogen.vim  … … … 
```

然后我按照病原体安装说明进行操作：

```
Add this to your vimrc:

call pathogen#infect() 
```

==

```
~$ cat .vimrc
…
…
"For pathogen(a vim installer):
call pathogen#infect() 
```

然后按照 nerdtree 安装说明进行操作：

```
pathogen.vim is the recommended way to install nerdtree.

cd ~/.vim/bundle
git clone <link to github>

Then reload vim, run :helptags, and check out :help NERD_tree.txt. 
```

我尝试像这样安装 nerdtree：

```
~/.vim/bundle$ git clone <link to github>
Cloning into 'nerdtree'...
remote: Counting objects: 2426, done.
remote: Compressing objects: 100% (801/801), done.
remote: Total 2426 (delta 1091), reused 2354 (delta 1025)
Receiving objects: 100% (2426/2426), 912.52 KiB | 573 KiB/s, done.
Resolving deltas: 100% (1091/1091), done.
$ 
```

其中产生：

```
~/.vim$ cd bundle
~/.vim/bundle$ ls
nerdtree 
```

但我无法让 nerdtree 工作。当我尝试这个时：

```
~$ cd rails_projects/demo_app22/
~/rails_projects/demo_app22$ mvim .
~/rails_projects/demo_app22$ 
```

...然后这个：

```
:NERDtree 
```

我得到错误：

```
E492: Not an editor command: NERDtree 
```

当我尝试 :helptags 时，我得到了错误：

```
E472: Argument required 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T22:07:09.663

查看这个脚本来装饰 Vim for Rails：[http ://www.vim.org/scripts/script.php?script_id=1567](http://www.vim.org/scripts/script.php?script_id=1567)

# php - 使用 curl_error 发出请求时出错

> ID：11977537
> 
> 赞同：1
> 
> 时间：2012-08-15T21:22:21.263
> 
> 标签：php, ssl, curl, easyphp

我从 PHP 5.3 升级到 5.4 (easyphp)，现在出现以下错误：

```
Exception: TestCaseCtrlSignUp -> testSignUp -> Unexpected PHP error [Error making request with curl_error: error:14077102:SSL routines:SSL23_GET_SERVER_HELLO:unsupported protocol] severity [256] in [C:\Program Files (x86)\EasyPHP-12.0\www\workspace\CPS\lib\campain_monitor\class\transport.php line 132]
Failed with code 0 
```

这是 transport.php 文件：

```
define('CS_REST_GET', 'GET');
define('CS_REST_POST', 'POST');
define('CS_REST_PUT', 'PUT');
define('CS_REST_DELETE', 'DELETE');
define('CS_REST_SOCKET_TIMEOUT', 1);

function CS_REST_TRANSPORT_get_available($requires_ssl, $log) {
    if(function_exists('curl_init') && function_exists('curl_exec')) {
        return new CS_REST_CurlTransport($log);
    } else if(CS_REST_TRANSPORT_can_use_raw_socket($requires_ssl)) {
        return new CS_REST_SocketTransport($log);
    } else { 
        $log->log_message('No transport is available', __FUNCTION__, CS_REST_LOG_ERROR);
        trigger_error('No transport is available.'.
            ($requires_ssl ? ' Try using non-secure (http) mode or ' : ' Please ').
            'ensure the cURL extension is loaded', E_USER_ERROR);
    }    
}
function CS_REST_TRANSPORT_can_use_raw_socket($requires_ssl) {
    if(function_exists('fsockopen')) {
        if($requires_ssl) {
            return extension_loaded('openssl');
        }

        return true;
    }

    return false;
}   
class CS_REST_BaseTransport {

    var $_log;

    function CS_REST_BaseTransport($log) {
        $this->_log = $log;
    }

    function split_and_inflate($response, $may_be_compressed) {        
        $ra = explode("\r\n\r\n", $response);

        $result = array_pop($ra);
        $headers = array_pop($ra);

        if($may_be_compressed && preg_match('/^Content-Encoding:\s+gzip\s+$/im', $headers)) {        
            $original_length = strlen($response);
            $result = gzinflate(substr($result, 10, -8));

            $this->_log->log_message('Inflated gzipped response: '.$original_length.' bytes ->'.
                strlen($result).' bytes', get_class(), CS_REST_LOG_VERBOSE);
        }

        return array($headers, $result); 
    }
}
/**
 * Provide HTTP request functionality via cURL extensions
 *
 * @author tobyb
 * @since 1.0
 */
class CS_REST_CurlTransport extends CS_REST_BaseTransport {

    var $_curl_zlib;

    function CS_REST_CurlTransport($log) {
        $this->CS_REST_BaseTransport($log);

        $curl_version = curl_version();
        $this->_curl_zlib = isset($curl_version['libz_version']);
    }

    /**
     * @return string The type of transport used
     */
    function get_type() {
        return 'cURL';
    }

    function make_call($call_options) {
        $ch = curl_init();

        curl_setopt($ch, CURLOPT_URL, $call_options['route']);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
        curl_setopt($ch, CURLOPT_HEADER, true);
        curl_setopt($ch, CURLOPT_HTTPAUTH, CURLAUTH_BASIC);
        curl_setopt($ch, CURLOPT_USERPWD, $call_options['credentials']);
        curl_setopt($ch, CURLOPT_USERAGENT, $call_options['userAgent']);
        curl_setopt($ch, CURLOPT_HTTPHEADER, array('Content-Type: '.$call_options['contentType']));

        $headers = array();
        $inflate_response = false;
        if($this->_curl_zlib) {
            $this->_log->log_message('curl+zlib support available. Requesting gzipped response.',
                get_class($this), CS_REST_LOG_VERBOSE);
            curl_setopt($ch, CURLOPT_ENCODING, 'gzip');
        } else if(function_exists('gzinflate')) {
            $headers[] = 'Accept-Encoding: gzip';
            $inflate_response = true;
        }

        if($call_options['protocol'] === 'https') {
            curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, true);
            curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, 2);
            curl_setopt($ch, CURLOPT_CAINFO, dirname(__FILE__).'/GoDaddyClass2CA.crt');
        }

        switch($call_options['method']) {
            case CS_REST_PUT:
                curl_setopt($ch, CURLOPT_CUSTOMREQUEST, CS_REST_PUT);
                $headers[] = 'Content-Length: '.strlen($call_options['data']);
                curl_setopt($ch, CURLOPT_POSTFIELDS, $call_options['data']);
                break;
            case CS_REST_POST:
                curl_setopt($ch, CURLOPT_POST, true);
                curl_setopt($ch, CURLOPT_POSTFIELDS, $call_options['data']);
                break;
            case CS_REST_DELETE:
                curl_setopt($ch, CURLOPT_CUSTOMREQUEST, CS_REST_DELETE);
                break;
        }

        if(count($headers) > 0) {
            curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
        }

        $response = curl_exec($ch);
        if(!$response && $response !== '') {
            $this->_log->log_message('Error making request with curl_error: '.curl_errno($ch),
                get_class($this), CS_REST_LOG_ERROR);
            trigger_error('Error making request with curl_error: '.curl_error($ch), E_USER_ERROR);
        }

        list( $headers, $result ) = $this->split_and_inflate($response, $inflate_response);

        $this->_log->log_message('API Call Info for '.$call_options['method'].' '.
        curl_getinfo($ch, CURLINFO_EFFECTIVE_URL).': '.curl_getinfo($ch, CURLINFO_SIZE_UPLOAD).
            ' bytes uploaded. '.curl_getinfo($ch, CURLINFO_SIZE_DOWNLOAD).' bytes downloaded'.
            ' Total time (seconds): '.curl_getinfo($ch, CURLINFO_TOTAL_TIME), 
        get_class($this), CS_REST_LOG_VERBOSE);

        $result = array(
            'code' => curl_getinfo($ch, CURLINFO_HTTP_CODE),
            'response' => $result
        );

        curl_close($ch);

        return $result;
    }
}

class CS_REST_SocketWrapper {
    var $socket;

    function open($domain, $port) {
        $this->socket = fsockopen($domain, $port, $errno, $errstr, CS_REST_SOCKET_TIMEOUT);

        if(!$this->socket) {
            die('Error making request with '.$errno.': '.$errstr);
            return false;
        } else if(function_exists('stream_set_timeout')) {
            stream_set_timeout($this->socket, CS_REST_SOCKET_TIMEOUT);
        }

        return true;
    }

    function write($data) {
        fwrite($this->socket, $data);
    }

    function read() {
        ob_start();
        fpassthru($this->socket);

        return ob_get_clean();
    }

    function close() {
        fclose($this->socket);
    }
}

class CS_REST_SocketTransport extends CS_REST_BaseTransport {

    var $_socket_wrapper;

    function CS_REST_SocketTransport($log, $socket_wrapper = NULL) {
        $this->CS_REST_BaseTransport($log);

        if(is_null($socket_wrapper)) {
            $socket_wrapper = new CS_REST_SocketWrapper();
        }

        $this->_socket_wrapper = $socket_wrapper;
    }

    /**
     * @return string The type of transport used
     */
    function get_type() {
        return 'Socket';
    }

    function make_call($call_options) {
        $start_host = strpos($call_options['route'], $call_options['host']);
        $host_len = strlen($call_options['host']);

        $domain = substr($call_options['route'], $start_host, $host_len);
        $host = $domain;
        $path = substr($call_options['route'], $start_host + $host_len);
        $protocol = substr($call_options['route'], 0, $start_host);
        $port = 80;

        $this->_log->log_message('Creating socket to '.$domain.' over '.$protocol.' for request to '.$path,
            get_class($this), CS_REST_LOG_VERBOSE);

        if($protocol === 'https://') {
            $domain = 'ssl://'.$domain;
            $port = 443;
        }

        if($this->_socket_wrapper->open($domain, $port)) {
            $inflate_response = function_exists('gzinflate');

            $request = $this->_build_request($call_options, $host, $path, $inflate_response);
            $this->_log->log_message('Sending <pre>'.$request.'</pre> down the socket',
            get_class($this), CS_REST_LOG_VERBOSE);

            $this->_socket_wrapper->write($request);
            $response = $this->_socket_wrapper->read();
            $this->_socket_wrapper->close();

            $this->_log->log_message('API Call Info for '.$call_options['method'].' '.
            $call_options['route'].': '.strlen($request).
                ' bytes uploaded. '.strlen($response).' bytes downloaded', 
            get_class($this), CS_REST_LOG_VERBOSE);

            list( $headers, $result ) = $this->split_and_inflate($response, $inflate_response);

            $this->_log->log_message('Received headers <pre>'.$headers.'</pre>',
                get_class($this), CS_REST_LOG_VERBOSE);

            return array(
                'code' => $this->_get_status_code($headers),
                'response' => trim($result)
            );
        }
    }

    function _get_status_code($headers) {
        if (preg_match('%^\s*HTTP/1\.1 (?P<code>\d{3})%', $headers, $regs)) {
            $this->_log->log_message('Got HTTP Status Code: '.$regs['code'],
            get_class($this), CS_REST_LOG_VERBOSE);
            return $regs['code'];
        }

        $this->_log->log_message('Failed to get HTTP status code from request headers <pre>'.$headers.'</pre>',
            get_class($this), CS_REST_LOG_ERROR);
        trigger_error('Failed to get HTTP status code from request', E_USER_ERROR);        
    }

    function _build_request($call_options, $host, $path, $accept_gzip) {
        $request =
$call_options['method'].' '.$path." HTTP/1.1\n".
'Host: '.$host."\n".
'Authorization: Basic '.base64_encode($call_options['credentials'])."\n".
'User-Agent: '.$call_options['userAgent']."\n".
"Connection: Close\n".
'Content-Type: '.$call_options['contentType']."\n";

        if($accept_gzip) {
            $request .=
"Accept-Encoding: gzip\n";           
        }

        if(isset($call_options['data'])) {
            $request .=
'Content-Length: '.strlen($call_options['data'])."\n\n".
$call_options['data'];
        }

        return $request."\n\n";
    }
} 
```

# mongodb - Java 的 Log4mongo：无法实例化名为 MongoDB 的附加程序

> ID：11977538
> 
> 赞同：0
> 
> 时间：2012-08-15T21:22:22.387
> 
> 标签：mongodb, log4j, mongodb-java

Log4j.properties 文件

```
log4j.rootLogger=ERROR, MongoDB
log4j.appender.MongoDB=org.log4mongo.MongoDbAppender
log4j.appender.MongoDB.databaseName=appName
log4j.appender.MongoDB.collectionName=test 
```

构建应用程序时出现错误，无法实例化名为“MongoDB”的附加程序

相同的 log4j.properties 适用于链接中的示例示例 [http://log4mongo.org/pages/viewpage.action?pageId=1474614]

# linq - 如何使用 linq 从数据库中删除记录？

> ID：11977542
> 
> 赞同：1
> 
> 时间：2012-08-15T21:22:36.350
> 
> 标签：linq, web-services, linq-to-sql, vb.net-2010

我试图使用 LINQ 从数据库中删除一条记录。我已经给系统提供了要删除的行键，它确实返回了一行。

这是我的代码：

```
 Public Function DeleteHydrantByKey(ByVal objDeptGUID As String, ByVal objLogonToken As String, ByVal objSesionToken As String, ByVal objHydrantKey As Integer) As String
    'Check if Token is good
    If CheckToken(objSesionToken, objDeptGUID) = False Then
        Return "Session Error"
    End If
    'Check if login Token is good
    If CheckLoginToken(objDeptGUID, objLogonToken) = False Then
        Return "Logon Session Error"
    End If

    Try
        Dim lbHydrants As New linqAlarmDumpDataContext

        'Check for Hydrans in system
        Dim GetHydrants = From r In lbHydrants.tbHydrants _
                          Where r.key = objHydrantKey
                          Select r

        'Check For Hydrent Data
        If GetHydrants.Count = 0 Then
            Return "Not Found"
        End If

        'Deletes Hydrent Data After Check was ok
        lbHydrants.tbHydrants.DeleteOnSubmit(GetHydrants)
        lbHydrants.SubmitChanges()

        Return "OK"
    Catch ex As Exception
        Return "Error"
    End Try
End Function 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T21:49:18.327

```
 Public Function DeleteHydrantByKey(ByVal objDeptGUID As String, ByVal objLogonToken As String, ByVal objSesionToken As String, ByVal objHydrantKey As Integer) As String
    'Check if Token is good
    If CheckToken(objSesionToken, objDeptGUID) = False Then
        Return "Session Error"
    End If
    'Check if login Token is good
    If CheckLoginToken(objDeptGUID, objLogonToken) = False Then
        Return "Logon Session Error"
    End If

    Try
        Dim lqHydrants As New linqAlarmDumpDataContext

        'Check for Hydrans in system
        Dim GetHydrants = From r In lqHydrants.tbHydrants _
                          Where r.key = objHydrantKey
                          Select r

        'Check For Hydrent Data
        If GetHydrants.Count = 0 Then
            Return "Not Found"
        End If

        'Deletes Hydrent Data After Check was ok
        lqHydrants.tbHydrants.DeleteAllOnSubmit(GetHydrants)
        lqHydrants.SubmitChanges()

        Return "OK"
    Catch ex As Exception
        Return "Error"
    End Try
End Function 
```

# wpf - 数据网格 CanUserAddRows = True

> ID：11977544
> 
> 赞同：0
> 
> 时间：2012-08-15T21:22:48.027
> 
> 标签：wpf, xaml, wpfdatagrid

我有一个 wpf 数据网格，设置 CanUserAddRows 设置为 true。这将向数据网格添加一个空白的空行，当用户双击该行时，它将清零所有属性并将其添加到集合/项目源（ObservableCollection）。问题是当空行归零并将其添加到集合中时，我需要添加另一个空白行并准备好在添加前一行并将其归零后立即使用。相反，在我选择一个新行（selectionchange）之前，数据网格上不会显示一个新的空白行。希望这很清楚我在问什么。关于如何解决这个问题的任何想法？感谢任何输入。

```
 <DataGrid Grid.Row="1" RowHeaderWidth="0" BorderBrush="Black" ItemsSource="{Binding MyCollection, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" SelectedItem="{Binding SelectedRow, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" Height="280" Focusable="True" CanUserAddRows="True">

       <DataGridTextColumn Binding="{Binding Weight}" Header="Tare Lbs." Width="70" />
       <DataGridTextColumn Binding="{Binding Bu, UpdateSourceTrigger=PropertyChanged}" Header="Gross Bu." Width="70" /> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-04-09T00:00:26.240

如果您调用 DataGrid.CommitEdit() 它将完成添加新行并为您创建新的空白行。我们在 DataGrid.CurrentCellChanged() 中执行此操作。

XAML

```
<DataGrid x:Name="theGrid" ItemsSource="{Binding MyCollection, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" SelectedItem="{Binding SelectedRow, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" CanUserAddRows="True" CurrentCellChanged="theGrid_CurrentCellChanged"> 
```

代码背后：

```
private void theGrid_CurrentCellChanged(object sender, EventArgs e)
{
   DataGrid grid = sender as DataGrid;

   IEditableCollectionView items = (IEditableCollectionView)grid.Items;
   if (items != null && items.IsAddingNew) {
      // Commit the new row as soon as the user starts editing it
      // so we get a new placeholder row right away.
      grid.CommitEdit(DataGridEditingUnit.Row, false);
  }
} 
```

# android - 不同大小的android布局填充空间

> ID：11977551
> 
> 赞同：1
> 
> 时间：2012-08-15T21:23:14.657
> 
> 标签：android, android-layout, size

我想制作一个可以显示图像的应用程序。但真正的问题是存在的：例如，我希望在纵向模式下的“手机”版本中连续显示一个图像，在横向模式下显示两个图像（如 Youtube 应用程序）。并在“平板电脑”版本中从中推断出来，例如两个纵向图像和四个横向图像。并自动重定向到下一行。

这是一个很好的例子：我有 7 张图片，我希望我的布局在所有不同的布局中看起来像这样：

*   手机中的纵向模式：7 行（每行 1 张图像）
*   手机中的横向模式：3 排 2 和 1 排 1
*   平板电脑中的纵向模式：3 排 2 和 1 排 1
*   平板电脑中的横向模式：1 排 4 和 1 排 3

我不知道我是否可以更清楚。我只想朝着正确的方向前进。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T21:31:12.690

在我的脑海中，我可以想到两个解决方案：

1.  使用[GridView](http://developer.android.com/guide/topics/ui/layout/gridview.html)。这将根据屏幕大小和项目大小自动将项目放入适当数量的行/列中。
2.  使用 Android 的[内置功能](http://developer.android.com/guide/practices/screens_support.html)来管理不同屏幕设置的替代布局。因此，您可以创建布局的纵向/横向变化以及不同屏幕尺寸的小/中/大/xlarge 变化。然后，您可以简单地使用 RelativeLayout、LinearLayout 或任何您想要将图像实际定位到行/列中的东西。

希望这可以帮助！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-15T21:34:02.747

我创建了一个工具，允许您缩放/调整平板电脑和小屏幕设备的布局，并在此处发表了一篇关于它的博客文章：http: [//onemanmobile.blogspot.com/2012/04/how-to-scale-your- android-layouts-to.html](http://onemanmobile.blogspot.com/2012/04/how-to-scale-your-android-layouts-to.html)

基本上，如果您希望您的应用程序适合所有设备和平板电脑，那么以 dp 单位定义布局是不够的，因为有四种不同的“密度桶”。此工具将允许您的布局转换为适合这些密度桶。

在您的情况下，它可以将网格布局元素缩放到适合手机和平板电脑的大小。

# visual-studio - Visual Studio 2012 先决条件：不正确的函数设置失败

> ID：11977552
> 
> 赞同：5
> 
> 时间：2012-08-15T21:23:16.783
> 
> 标签：visual-studio, windows-8, visual-studio-2012

当我尝试安装 Visual Studio 2012 时，出现此错误：

![在此处输入图像描述](../Images/e9b09cc4e7e1c4c55aeed0629322c55d.png)

> Visual Studio 2012 先决条件：函数不正确

如何解决此问题以便安装 Visual Studio 2012？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-08-15T21:23:16.783

当您尝试使用任何或所有附加组件（如 Blend 和/或 Lightswitch，甚至没有）安装 Visual Studio 时，会发生此错误[罕见？]。

它可以通过使用 Visual Studio 2012 Web 安装程序来解决。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-10-24T03:49:53.810

只是重新启动安装对我有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-01-28T16:25:17.027

ISO 和 Web 安装对我来说都失败了。唯一让它接近的是服务包更新。

# python - 在 Google AppEngine 上使用 python 是否有更高级的教程？

> ID：11977563
> 
> 赞同：3
> 
> 时间：2012-08-15T21:23:56.467
> 
> 标签：python, google-app-engine

我正在寻找一个从[官方教程](https://developers.google.com/appengine/docs/python/gettingstartedpython27/)结束的地方开始的教程。换句话说，关于 Python + Google AppEngine + webapp2 的更全面的教程

非常感谢任何提示！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T21:30:07.537

您可以查看[webapp 改进文档](http://webapp-improved.appspot.com/)。此外，还有一本书《Programming Google App Engine》，它的第二版应该会在 10 月出版（详情请参见其[网页](http://ae-book.appspot.com/)）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T21:34:15.760

至于 webapp2，请尝试查看[http://blog.notdot.net/2011/11/Migrating-to-Python-2-7-part-2-Webapp-and-templates](http://blog.notdot.net/2011/11/Migrating-to-Python-2-7-part-2-Webapp-and-templates)（基本上是 Nick Johnson 的任何内容）。**编辑：**我猜塞巴斯蒂安·克雷夫特的建议是你想要的。但仍然阅读尼克的东西:)

至于更高级的教程，一个逃避的答案（我会推荐）只是阅读文档并自己尝试一些东西。例如，通读[这个](https://developers.google.com/appengine/docs/python/overview)（相同的文档，就在左侧导航的下方）将为您提供各种服务/api/等的概述。在 SDK 中可用。正如你所发现的那样，我远非专家，但这样做（结合我自己的问题并在本网站上的人的帮助下解决）肯定会帮助你学习。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-16T02:34:20.917

这不是使用 webapp2，但在[这个 python](https://sites.google.com/site/gdevelopercodelabs/app-engine/python-codelab)代码实验室类似于留言簿教程，但有 2 个额外部分显示如何使用其他 App Engine API，如：

*   内存缓存
*   邮件 API
*   频道 API

最后的独立练习显示：

*   网址提取，
*   克朗
*   任务队列

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-06-17T11:01:13.600

这个教程系列也很不错，因为它展示了如何使用 webapp2 正确构建代码。缺点是使用 db（旧标准）而不是 ndb（新标准）。

[http://tutorialzine.com/2011/01/getting-started-with-google-app-engine/](http://tutorialzine.com/2011/01/getting-started-with-google-app-engine/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-09-19T23:22:06.157

自从 webapp 时代以来，谷歌已经做了大量的工作。

2016 年末，在 Google Cloud/App Engine 上从头开始一个新项目，您现在可以逐步完成一个教程，该教程为您克隆一个**快速入门项目**，然后从 gloud 控制台运行它。

这可以在[https://cloud.google.com/appengine/docs/python/quickstart](https://cloud.google.com/appengine/docs/python/quickstart)参考。它本质上是一个 Python Flask 0.10 项目，所有 Flask 组件都放在 /lib 目录中。

在[https://cloud.google.com/python/getting-started/hello-world](https://cloud.google.com/python/getting-started/hello-world)上还有一个柔性环境 Beta 版的教程。在注释中，他们引用了除 Flask 之外的许多框架，特别是 Django、Pyramid、Bottle、Tornado，当然还有 web.py

# asp.net - 从串口c#asp.net读取输入？

> ID：11977568
> 
> 赞同：0
> 
> 时间：2012-08-15T21:24:21.973
> 
> 标签：asp.net, c#-4.0, serial-port

您好，我有一个 PIC16F877A 微控制器和液晶显示器。我已经让 PIC 控制器每 2 分钟在 LCD 屏幕上显示随机数，并且它还通过 RS232 电缆每 2 分钟将这些随机生成的数字发送到我的笔记本电脑。我正在使用 ASP.NET 4 C# 创建一个网站，我想在其中读取这些数字并执行功能。我已经编写了以下代码，但它不起作用，但我在笔记本电脑的超级终端中收到了这些随机数。请建议我如何实现这一点 - 我必须每 2 分钟收到一次这些代码。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.IO.Ports;

public partial class Entercode : System.Web.UI.Page
{
    static SerialPort mySerialPort = new SerialPort("COM46", 1200, Parity.None, 8,     StopBits.One);
    protected void Page_Load(object sender, EventArgs e)
    {
        mySerialPort.Open();
        String str = mySerialPort.ReadLine();
        mySerialPort.Close();

    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T21:33:37.880

我建议重新构建你的程序。

ASP.NET 被设计为无状态的（因为它的 HTTP 基础）。ASP.NET 宿主进程 (w3wp.exe) 可以随意终止和回收，不会发出警告。如果您需要可靠性，您应该在专用的 Windows 服务进程中执行 SerialPort 通信，该进程通过某种形式的 IPC 与您的 ASP.NET 应用程序进行通信。

使用 Page_Load 是非常不合适的，更不用说非常不安全了。该`.Close`方法等效于调用`.Dispose`，它破坏了将您的 SerialPort 作为静态成员（作为其生命周期结束）的点。

我知道您不熟悉 ASP.NET 或 IO 端口编程。我建议你分别磨练这些方面的技能（即先开发一个命令行串口程序，然后是一个不使用串口的简单的 ASP.NET Web 应用程序），然后在两者都很强之后将它们结合起来领域。

# c# - 将文本文件行划分为数据库的两个不同表

> ID：11977575
> 
> 赞同：0
> 
> 时间：2012-08-15T21:25:15.013
> 
> 标签：c#, arrays, linq, text-files

对不起，如果我不清楚酵母日，我要做的是逐行获取一个文本文件，并根据行开头的内容确定将其发送到哪个表。我在寻找以单词或“[”开头的某些行到某个表的最佳（最有效）方式时遇到问题。这是我正在加载的文本文件的示例，它是日志，异常、消息和源可以在文本文件中的任何位置。以“[”开头的行转到（LogTable），以“Exception”开头的行将转到（ExceptionTable），但是每个“Exception”都连接到前一个 Log 行，所以我也在寻找一种方法连接两者，以便它们可以在数据库中链接。

```
[2012-07-05 00:01:07,008]  [INFO ] [MessageManager]  [3780] () [] [Starting     ProcessNewMessageEvent]
[2012-07-05 00:01:07,008]  [INFO ] [MessageManager]  [3780] () [] [Method: RegValue]
[2012-07-05 00:01:07,008]  [DEBUG] [MessageManager]  [3780] () [] [reg: InstallPath]

Exception: System.ServiceModel.EndpointNotFoundException
Message: There was no endpoint listening at that could accept the message. This is often caused by an incorrect address or SOAP action. See InnerException, if present, for more details.
Source: mscorlib
[2012-07-04 23:55:59,598]  [INFO ] [MessageManager]  [6616] () [] [Method: RegValue]
[2012-07-04 23:55:59,598]  [DEBUG] [MessageManager]  [6616] () [] [reg: InstallPath] 
```

这段代码没有循环，它将执行第一个循环，然后它在最后一部分被“grougquery”查询捕获，并且不会循环整个“for”循环，所以当它到达“异常：”行时它会抛出一个例外。有没有比我在这里做的更有效的方法？我还没有找到另一种方式？再次感谢

```
 foreach (string s in filePaths)
                {
                  string[] lines = System.IO.File.ReadAllLines(s);

                  for (int i = 0; i < lines.Length; i++)
                  {
                      if (lines[i].Contains("Exception:"))
                      {

                          var exQuery = from exMessage in lines
                                        let logRecord = exMessage.Split(':')
                                        select new ExTable()

                                        {
                                            ExlogException = logRecord[i],
                                            ExlogMessage = logRecord[i + 1],
                                            ExlogSource = logRecord[i + 2],

                                        };
                          foreach (var item in exQuery)
                          {
                              exception ex = new exception();

                              ex.LogException = item.ExlogException;
                              ex.LogMessage = item.ExlogMessage;
                              ex.LogSource = item.ExlogSource;
                              ex.LogServerStackTrace = item.ExlogServerStackTrace;
                              ex.LogExRethrown = item.ExlogRethrown;

                          }

                      }
                      else if (lines[i].Contains("["))
                      {

                          var groupQuery = from date in lines
                                           let logRecord = date.Split('[', ']', '(', ')')
                                           select new OLog()

                                           {
                                               OlogDate = logRecord[1],
                                               OlogLevel = logRecord[3],
                                               OlogLogger = logRecord[5],
                                               OlogThread = logRecord[7],
                                               OlogProperty = logRecord[9],
                                               OlogMethod = logRecord[11],
                                               OlogException = logRecord[12],

                                           };

                          foreach (var item in groupQuery)
                          {
                              temp temp = new temp();

                              temp.logDate = item.OlogDate;
                              temp.logLevel = item.OlogLevel;
                              temp.logLogger = item.OlogLogger;
                              temp.logThread = item.OlogThread;
                              temp.logProperty = item.OlogProperty;
                              temp.logMethod = item.OlogMethod;
                              temp.logException = item.OlogException;

                              logEntity.temps.AddObject(temp);
                          }

                      }
                  }
                          logEntity.SaveChanges();
               } 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T21:34:37.110

使用 SSIS 进行集成，它会更容易，它可以帮助您拆分文本文件 [http://social.technet.microsoft.com/wiki/contents/articles/3172.aspx](http://social.technet.microsoft.com/wiki/contents/articles/3172.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-15T21:59:12.130

您按行拆分，然后按“：”拆分，在我看来，您的异常跨越 3 行，因此行数组中有 3 个不同的值，因此您的第二次拆分不会按预期工作。

完成我认为您要完成的事情的一种方法是遍历行数组，然后在遇到这些情况时处理它们，如下所示：

```
foreach (string s in filePaths) {
//goes through each line in each file
string[] lines = System.IO.File.ReadAllLines(s);

for (int i=0;i < lines.Length; i++)
{
    if (line[i].Contains("Exception:"))
    {
        // Handle line[i] as Exception, line[i+1] as Message, line[i+2] as Source
    }
    else if (line[i].Contains("["))
    {
        // Same as you had before
    }
}
// same as before 
```

}

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T22:13:25.033

这就是我认为您正在尝试做的事情......以一种比 for 循环更灵活的方式。

注意，这个例子是在我推荐使用 linq 代码的 LinqPad (linqpad.com) 中运行的。它给出了预期的结果。

```
void Main()
{
    string [] lines = {
"[2012-07-05 00:01:07,008]  [INFO ] [MessageManager]  [3780] () [] [Starting     ProcessNewMessageEvent]",
"[2012-07-05 00:01:07,008]  [INFO ] [MessageManager]  [3780] () [] [Method: RegValue]",
"[2012-07-05 00:01:07,008]  [DEBUG] [MessageManager]  [3780] () [] [reg: InstallPath]",
@"Exception: System.ServiceModel.EndpointNotFoundException
Message: There was no endpoint listening at that could accept the message. This is often caused by an incorrect address or SOAP action. See InnerException, if present, for more details.
Source: mscorlib",
"[2012-07-04 23:55:59,598]  [INFO ] [MessageManager]  [6616] () [] [Method: RegValue]",
"[2012-07-04 23:55:59,598]  [DEBUG] [MessageManager]  [6616] () [] [reg: InstallPath]"
    };

       var exceptions = lines.Where(l => l.Contains("Exception:"))
                          .Select(line => 
                          { 
                             var items = line.Split(':');
                             var result = new  
                                          {
                                             OlogException = items.ElementAtOrDefault(1),
                                             OlogMessage =   items.ElementAtOrDefault(2),
                                             OlogSource = items.ElementAtOrDefault(3),
                                             OlogServerStackTrace = items.ElementAtOrDefault(4)
                                          };
                             return result;
                          });

    var groups = lines.Where(l => l.StartsWith("["))
                      .Select(line => 
                       { 
                          var items = line.Split('[', ']', '(', ')');
                          var result = new 
                                       {
                                          OlogDate = items.ElementAtOrDefault(1),
                                          OlogLevel = items.ElementAtOrDefault(3),
                                          OlogLogger = items.ElementAtOrDefault(5),
                                          OlogThread = items.ElementAtOrDefault(7),
                                          OlogProperty = items.ElementAtOrDefault(9),
                                          OlogMethod = items.ElementAtOrDefault(11),
                                          OlogException = items.ElementAtOrDefault(13)
                                        };
                          return result;
                       });

  exceptions.Dump();
  groups.Dump();

} 
```

# ios - webview代码不起作用

> ID：11977576
> 
> 赞同：1
> 
> 时间：2012-08-15T21:25:39.797
> 
> 标签：ios, ios5, uiwebview

```
-(bool) webView:(UIWebView *)webView shouldStartLoadWithRequest:(NSURLRequest *)request navigationType:(UIWebViewNavigationType)navigationType{
    if (navigationType == UIWebViewNavigationTypeLinkClicked) {
        NSURL *url = request.URL;
        BrowserLinker *linker= [[BrowserLinker alloc]initWithNibName:@"BLinker" bundle:nil];
        [self.navigationController pushViewController:linker  animated:YES];
        return NO;
    }
    else {
        return YES;
    }
} 
```

我在 BrowserLinker 类中声明了一个 UIWebView，并且还声明了该方法。当在 UIWebView 中单击链接时，它必须在新的 ViewController 中打开。有人可以告诉我代码有什么问题吗？顺便说一句，代码改编自 SO answer。

> **错误**：WebKit 在 webView:decidePolicyForNewWindowAction:request:newFrameName:decisionListener:delegate:Could not load NIB in bundle: 'NSBundle (loaded)' with name 'BLinker'

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-19T21:11:44.387

Nib 文件名通常与其随附的视图控制器文件名共享相同的基本名称。在这里，您已经调用了视图控制器`BrowserLinker`和调用了 nib `BLinker`。你确定你的笔尖没有被调用`BrowserLinker`吗？

# magento - 为什么我的 adminhtml“新”操作页面没有在 Magento 中显示？

> ID：11977578
> 
> 赞同：1
> 
> 时间：2012-08-15T21:25:45.663
> 
> 标签：magento

为此，在`/brands/adminhtml_brand/new/`我的自定义模块的管理面板中，当我想向数据库添加新条目时，我应该会看到一个页面。我正在[关注本教程](http://codemagento.com/2011/02/grids-and-forms-in-the-admin-panel/)。我`layout.xml`的设置正确。

![magento 无法编辑](../Images/f59ef06dc8bd27ecae7423ded15cc634.png)

**BrandController.php**

```
class Desbest_Brands_Adminhtml_BrandController extends Mage_Adminhtml_Controller_Action
    public function editAction()
        {
            $id = $this->getRequest()->getParam('id', null);
            $model = Mage::getModel('brands/example');
            if ($id) {
                $model->load((int) $id);
                if ($model->getId()) {
                    $data = Mage::getSingleton('adminhtml/session')->getFormData(true);
                    if ($data) {
                        $model->setData($data)->setId($id);
                    }
                } else {
                    Mage::getSingleton('adminhtml/session')->addError(Mage::helper('brands')->__('Example does not exist'));
                    $this->_redirect('*/*/');
                }
            }
            Mage::register('example_data', $model);

            $this->loadLayout();
            $this->getLayout()->getBlock('head')->setCanLoadExtJs(true);
            $this->renderLayout();
      }
 } 
```

**编辑.php**

```
<?php 
class Desbest_Brands_Block_Adminhtml_Example_Edit extends Mage_Adminhtml_Block_Widget_Form_Container
{
    public function __construct()
    {
        parent::__construct();

        $this->_objectId = 'id';
        $this->_blockGroup = 'brands';
        $this->_controller = 'adminhtml_example';
        $this->_mode = 'edit';

        $this->_addButton('save_and_continue', array(
                  'label' => Mage::helper('adminhtml')->__('Save And Continue Edit'),
                  'onclick' => 'saveAndContinueEdit()',
                  'class' => 'save',
        ), -100);
        $this->_updateButton('save', 'label', Mage::helper('brands')->__('Save Example'));

        $this->_formScripts[] = "
            function toggleEditor() {
                if (tinyMCE.getInstanceById('form_content') == null) {
                    tinyMCE.execCommand('mceAddControl', false, 'edit_form');
                } else {
                    tinyMCE.execCommand('mceRemoveControl', false, 'edit_form');
                }
            }

            function saveAndContinueEdit(){
                editForm.submit($('edit_form').action+'back/edit/');
            }
        ";
    }

    public function getHeaderText()
    {
        if (Mage::registry('example_data') && Mage::registry('example_data')->getId())
        {
            return Mage::helper('brands')->__('Edit Example "%s"', $this->htmlEscape(Mage::registry('example_data')->getName()));
        } else {
            return Mage::helper('brands')->__('New Example');
        }
    }

} 
```

**网格.php**

```
<?php
class Desbest_Brands_Block_Adminhtml_Example_Grid extends Mage_Adminhtml_Block_Widget_Grid
{
    public function __construct()
    {
        parent::__construct();
        $this->setId('example_grid');
        $this->setDefaultSort('id');
        $this->setDefaultDir('desc');
        $this->setSaveParametersInSession(true);
    }

    protected function _prepareCollection()
    {
        $collection = Mage::getModel('brands/example')->getCollection();
        $this->setCollection($collection);
        return parent::_prepareCollection();
    }

    protected function _prepareColumns()
    {
        $this->addColumn('id', array(
            'header'    => Mage::helper('brands')->__('ID'),
            'align'     =>'right',
            'width'     => '50px',
            'index'     => 'id',
        ));

        $this->addColumn('attributelabelid', array(
            'header'    => Mage::helper('brands')->__('Name'),
            'align'     =>'left',
            'index'     => 'name',
        ));

        $this->addColumn('name', array(
            'header'    => Mage::helper('brands')->__('Description'),
            'align'     =>'left', 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T22:08:06.333

根据您尝试访问的 URL，您的控制器操作应该是`newAction()`，而不是`editAction()`，除非您已经有 newAction() 转发以在教程中进行编辑。

您链接到的教程包括从 newAction 到 editAction 的转发，使用这个：

```
public function newAction()
{
    $this->_forward('edit');
} 
```

因此，请确保您使用的是该转发，或者访问控制器`/brands/adminhtml_brand/edit/`，如果您这样做，请确保更新您的布局句柄以定位编辑路线。

解决问题需要做的一些事情：

*   首先，将所有相关代码发布到 SO 问题 - 包括布局 xml 更新
*   始终包含所有 magento 类/文件的完整类名或文件路径。因为看起来你没有做明显错误的事情，它可能会归结为一些琐碎的事情，比如拼写错误或不匹配的块类型/名称——这种事情在我身上发生过很多次。
*   如果您还没有禁用缓存
*   启用块模板提示，以便您确定哪些模板和块被拉入页面。
*   检查 exception.log、system.log 以及您的 PHP 错误日志以查看其中是否有任何内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-15T21:40:10.810

您可能遇到 ACL（magento 安全性）问题。

有关更多详细信息，请参见[此处](http://alanstorm.com/magento_acl_authentication)。

# java - 计算一系列数字的 LCM 的最有效算法是什么？

> ID：11977582
> 
> 赞同：9
> 
> 时间：2012-08-15T21:26:06.040
> 
> 标签：java, algorithm, optimization, biginteger, lcm

我环顾四周，发现了其他有答案的问题，但没有一个问题涉及这个特定问题的范围。包括[这个问题](https://stackoverflow.com/questions/185781/finding-the-lcm-of-a-range-of-numbers)，还有[这个](https://stackoverflow.com/questions/8806520/how-to-get-gcd-and-lcm-of-a-range-of-numbers-efficiently)。

我必须以有效的方式计算大范围数字的 LCM。我没有对其他问题进行深入研究，因为它们不处理与该算法必须处理的数字一样大的数字范围。

我现在得到的代码可以在大约 90 秒内计算出 1 到 350000 之间每个数字的 LCM。（得到的数字大约有 76000 个十进制数字）。我希望最终能够将它扩展到数百万甚至数十亿元素长的范围内。

它最终可能会被并行化。对于某些算法，这根本不难，而对于其他算法则比较棘手（例如，如果该算法使用当前生成的 LCM 来计算其计算的其他部分的素数）

这里是：

```
public static BigInteger getLCMOfRange(BigInteger lower, BigInteger upper)
{
    BigInteger M = BigInteger.ONE;
    BigInteger t;

    // long l = System.currentTimeMillis();
    // System.out.println("Calculating LCM of numbers up to " + upper + "...");
    for (; lower.compareTo(upper) != 1; lower = lower.add(BigInteger.ONE))
    {
        t = M.gcd(lower);
        if (t.compareTo(lower) == 0)
            continue;
        M = M.multiply(lower).divide(t);
    }
    // System.out.println("Done.  Took " + (System.currentTimeMillis() - l) + " milliseconds.  LCM is " + M.bitCount()+ " bits long.");
    return M;
} 
```

请注意，与典型的 for 循环不同，此函数在 [lower, upper] 而不是 [lower, upper) 上运行。这种行为是故意的。

一些支持性的数学是，某些数字集的 LCM 是一组素因数的乘积，从中可以产生任何一个数字，而无需池外的任何数字。如果我的范围是 [1,20]，我可以用以下方式表示：

```
1: 1         6:  3*2      11: 11       16: 2^4
2: 2         7:  7        12: 3*2^2    17: 17
3: 3         8:  2^3      13: 13       18: 3^2*2
4: 2^2       9:  3^2      14: 7*2      19: 19
5: 5         10: 5*2      15: 5*3      20: 5*2^2

LCM{[1,20]}: 2^4*3^2*5*7*11*13*17*19 = 232792560 
```

有没有更有效的方法来计算如此大范围的 LCM？

我不在乎有人建议的算法是否非常占用内存，在这种情况下，时间性能比内存性能更重要（也更昂贵）。

这不是一个家庭作业问题。

# 问题

计算大量数字的 LCM 的最有效方法是什么？该算法需要在非常广泛的数字范围内运行，因此必须仔细优化。

# 附录 1

一个密切相关的问题是：计算一个 BigInteger（以另一个 BigInteger 为基础）的对数的最有效方法是什么？结果值可以截断为最接近的整数。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T22:04:38.213

这是算法的布局。我假设你总是从 1 开始：

1.  查找范围内的素数。您可以使用 Eratosthenes 筛子 350000。对于更大的数字范围，您需要[分段筛子](https://stackoverflow.com/questions/10249378/segmented-sieve-of-eratosthenes)。

2.  对于每个素数 p，使用对数函数求出 p ^e在该范围内的最大指数 e。乘以^(LCM)。（优化细节取决于你的实现）

为什么是正确的？

*   对于 p ^e形式的数字，其中 p 是素数，并且 e >= 1，由于步骤 2，已包含在 LCM 中，因此 p ^e | 液晶模组。
*   其他数的形式为 N = p [1] ^(e [1]) p [2] ^(e [2]) ...p [n] ^(e [n])（其中 p [i]是成对不同的素数，并且 e [i] >= 1），它大于或等于 p [i] ^(e [i])（对于从 1 到 n 的所有 i）。由于 p [i] ^(e [i]) | LCM，由于前面的论点，N | 液晶模组。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-15T23:03:27.313

这是@nhahtdh 答案的概括

第一步，找出所有小于或等于上界的素数。

然后取每个素数 p 并以 p 为基数记下下界和上界。这两个数字中不同的最高数字是您需要包含在 LCM 中的 p 的指数。如果下限为 1，则这与其他答案相同。

请注意，该算法的复杂性不取决于范围的长度，而仅取决于上限的大小。

# r - 在对最后一列运行算术运算时，R 数据框将行值与一列相加

> ID：11977583
> 
> 赞同：0
> 
> 时间：2012-08-15T21:26:06.940
> 
> 标签：r, dataframe

我有以下数据框：关于数据和框架的历史很少。这是第二个版本，初始数据框具有基于列标题表示的实际相似性值。根据实际的相似性值，每个都由它们所属的 bin 标识，我认为 bin 是实际分数。

```
 cosinFcolor cosinEdge cosinTexture histoFcolor histoEdge histoTexture jaccard
1             3         0            0           1         1            0       0
2             0         0            5           0         2            2       0
3             1         0            2           0         0            1       0
4             0         0            3           0         1            1       0
5             1         3            1           0         4            0       0
6             0         0            1           0         0            0       0 
```

我想要做的是对每一行值求和并将其保存在 jaccard 列旁边的列中，但在求和过程中我想检查 jaccard 的值，这是我想要根据 jaccard 值执行的 sudo 代码：

这是须藤代码：

```
If jaccard.value of that row == 5
   (cosinFcolor + cosinEdge + cosinTexture + histoFcolor + histoEdge + histoTexture) += (jaccard.value of the row * .5)
If jaccard.value of that row == 4
   (cosinFcolor + cosinEdge + cosinTexture + histoFcolor + histoEdge + histoTexture) += (jaccard.value of the row * .4)
If jaccard.value of that row == 3
   (cosinFcolor + cosinEdge + cosinTexture + histoFcolor + histoEdge + histoTexture)+= (jaccard.value of the row * .3)
If jaccard.value of that row == 2
   (cosinFcolor + cosinEdge + cosinTexture + histoFcolor + histoEdge + histoTexture) += (jaccard.value of the row * .2)
If jaccard.value of that row == 1
   (cosinFcolor + cosinEdge + cosinTexture + histoFcolor + histoEdge + histoTexture) += (jaccard.value of the row * .1)
else if jaccard.value of that row == 0
   value in the new column is = -1 
```

**完成此操作后，我希望最终数据帧如下所示：**

```
 cosinFcolor cosinEdge cosinTexture histoFcolor histoEdge histoTexture jaccard  weightedScore
1             3         0            0           1         1            0       0       -1
2             0         0            5           0         2            2       0       -1
3             1         0            2           0         0            1       0       -1
4             0         0            3           0         1            1       0       -1
5             1         3            1           0         4            0       0       -1
6             0         0            1           0         0            0       0       -1
7             0         0            1           0         0            0       1       1.1 
```

我的初始（我放置的第一个数据框）是在 StackOverflow 用户的帮助下通过遵循 R 代码生成的：

这是R代码：

```
single_img_sim_no_title <- single_img_similarity
single_img_sim_no_title$title <- NULL
head(single_img_sim_no_title)
#converting it to bins
sing_img_bins <- apply(single_img_sim_no_title, 2, cut, c(-Inf, seq(0.5, 1, 0.1), Inf), labels=0:6)
sing_img_bins[sing_img_bins=="6"] <- "0"
sing_img_bins <- as.data.frame(sing_img_bins) 
```

# nvidia - nvapi 在 d3d10 中使用 NvAPI_Stereo_SetDriverMode

> ID：11977585
> 
> 赞同：3
> 
> 时间：2012-08-15T21:26:19.190
> 
> 标签：nvidia, stereo-3d, stereoscopy, direct3d10, nvapi

我目前正在尝试使用函数 NvAPI_Stereo_SetDriverMode 将 nvapi 设置为在直接模式下工作。

根据 Nvidia nvapi[站点](http://developer.nvidia.com/nvapi)（在手册中），如果您想进行 direct3d 实现，您需要初始化 nvpai ，然后设置直接模式，然后创建设备 (d3d10device) ，然后创建立体声句柄......（继续该程序）。

```
NvAPI_Initialize();
NvAPI_Stereo_SetDriverMode(g_StereoHandle , NVAPI_STEREO_DRIVER_MODE_DIRECT);
D3D10CreateDeviceAndSwapChain(...,pD3D10Device);
NvAPI_Stereo_CreateHandleFromIUnknown(pD3D10Device,&g_StereoHandle );
.....(the rest) 
```

我试过了，但是函数 NvAPI_Stereo_SetActiveEye（它告诉我要渲染我的网格的哪只眼睛）说该模式不是直接模式。

当我查看头文件时，我发现应该在创建句柄后调用该模式。但是当我这样做时，它返回了 NVAPI_INVALID_ARGUMENT （我再次无法设置活动眼）。

```
NvAPI_Initialize();
D3D10CreateDeviceAndSwapChain(...,pD3D10Device);
NvAPI_Stereo_CreateHandleFromIUnknown(pD3D10Device,&g_StereoHandle );
NvAPI_Stereo_SetDriverMode(g_StereoHandle , NVAPI_STEREO_DRIVER_MODE_DIRECT);
.....(the rest) 
```

有没有人遇到同样的问题？

我试图在网上查看带有 nvapi 的示例，但它似乎是新的，并且 nvidia 开发人员区已关闭（由于一些技术问题）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-11-20T19:18:43.150

那很奇怪。

1.  NVidia 网站（您提出的第一个）中显示的方式对我有用。
2.  SetDriverMode 不接受立体声句柄的参数（与您复制的代码相反）。

也许有人在你的代码中添加了一个邪恶的“#define”？:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2018-05-31T10:27:54.850

万一有人来寻找一个可行的例子

> NvAPI_STEREO_DRIVER_MODE_DIRECT

然后这里是我在[github](https://github.com/bo3b/3D-Vision-Direct)上遇到的一个项目的链接。这里的示例演示了在 d3d 设备之前对立体的初始化，并显示了在每只眼睛中使用后台缓冲区进行渲染的用法。至于 OP，第一种方法应该可以工作，因为 DirectMode 需要在创建设备之前首先初始化 NVAPI 和 NvAPI_Stereo_SetDriverMode。希望这可以帮助某人:)

# php - PHP CMS 数据模型 - 可以更改吗？

> ID：11977588
> 
> 赞同：0
> 
> 时间：2012-08-15T21:26:21.157
> 
> 标签：php, database, frameworks, content-management-system, datamodel

我有一个艺术史数据库，其中包含 30 个表格以及人（保姆、艺术家等）与作品（绘画、雕塑等）之间的复杂关系。目前这是在 MS Access 中实现的，大约有 5k 行 VBA 代码和 30 种奇怪的形式。我必须选择使用 PHP 框架还是使用 CMS。我有 PHP 编码技能，但没有太多时间，所以真的不能花很长时间评估 CMS 产品，看看它们是否可以适应使用不同的数据模型。

我的问题是流行的开源 CMS 产品（如 Joomla 或 Drupal）是否允许使用自定义数据模型，或者他们是否希望您使用他们的内置模型（文章、博客、评论等）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T21:35:50.177

使用 CMS 是不合适的——虽然它们中的许多确实支持自定义属性，但它们通常不会将它们作为关系数据库中的字段来实现（因此，如果不可能的话，很难进行排序或索引）。

我建议你在 MySQL 中重新创建你的 MS Access 数据库，然后使用 Scaffolding 框架（Ruby-on-Rails 有一个非常著名的脚手架）为你自动生成代码和 GUI，然后你只需根据需要对其进行修改。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-15T22:06:01.723

我不建议使用 CMS。你没有足够的灵活性。

我建议使用 PHP 框架，例如[Symfony](http://www.symfony-project.org/)。您只需在 MySQL 中重新创建数据模型，然后使用 symfony 搭建脚手架，然后简单地设置站点样式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T22:30:49.120

我有一个关于动物、位置和发现的类似数据库模型，并且我已经成功地使用了 TYPO3 和具有许多 mysql 自关节的邻接列表模型。我可以推荐 TYPO3，但我认为任何其他 CMS 都可以对艺术数据库做同样的事情，但重要的是要知道 mysql 不支持递归查询，这就是我需要自连接来实现关系数据模型的原因。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-08-14T05:53:46.557

当涉及到您的数据模型或“内容类型”时，Bolt 非常灵活。您可以定义或修改它们，CMS 将为您更新数据库中的表。网站：[http ://bolt.cm](http://bolt.cm)

# css - css 中通用选择器的用途

> ID：11977589
> 
> 赞同：-2
> 
> 时间：2012-08-15T21:26:24.073
> 
> 标签：css

我有以下代码：

```
.x-border-box,
.x-border-box *{
  box-sizing: border-box;
  -moz-box-sizing: border-box;
  -ms-box-sizing: border-box;
  -webkit-box-sizing: border-box; } 
```

现在我的问题是， * 在那里做什么？

根据[http://www.w3.org/TR/CSS2/selector.html](http://www.w3.org/TR/CSS2/selector.html)，它匹配任何元素。

它是否存在似乎对我的代码有一些影响......

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T21:29:55.577

It does exactly what you said: It matches all descendants of `.x-border-box`.

# javascript - 谷歌映射javascript多种方法错误

> ID：11977592
> 
> 赞同：0
> 
> 时间：2012-08-15T21:26:36.720
> 
> 标签：javascript, google-maps

我正在尝试运行下面的代码，但遇到了多种方法错误，我不确定如何解决。此类错误的一个示例是 Object # has no method 'getBounds' 。我已从未包含在以下代码中的 API 密钥注册。

**代码**

```
<!doctype html>

<html lang="en-us">
<head>
    <meta charset="UTF-8">
    <title>Example</title>

    <style type="text/css">
        div {
            margin-top: 500px;
        }
    </style>

</head>

<div id="map"></div>

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>

    <script type="text/javascript"src="http://www.google.com/jsapi?key={API_KEY}&sensor=false"></script>

    <script type="text/javascript"charset="utf-8">
    google.load("maps","2.x"); 
    google.load("jquery","1.5.2");
    </script>

    <script type="text/javascript">

    $(document).ready(function(){ 
      var map = new GMap2(document.getElementById('map')); 
      var burnsvilleMN = new GLatLng(44.797916,-93.278046); 
      map.setCenter(burnsvilleMN, 8); 
    });

    // setup 10 random points
    var bounds = map.getBounds(); 
    var southWest = bounds.getSouthWest(); 
    var northEast = bounds.getNorthEast(); 
    var lngSpan = northEast.lng() - southWest.lng(); 
    var latSpan = northEast.lat() - southWest.lat(); 
    var markers = []; 
    for (var i = 0; i<10; i++) { 
      var point = new GLatLng(southWest.lat() + latSpan * Math.random(), southWest.lng() + lngSpan * Math.random()); 
      marker = new GMarker(point); 
      map.addOverlay(marker); 
      markers[i] = marker; 
    }

    $.each(markers, function(i, marker){
          // var marker = marker
          setInterval(function(){displayPoint(marker, i);}, 5000 + (i * 5000));
          });

          $('#map-info').appendTo(map.getPane(G_MAP_FLOAT_SHADOW_PANE));

    function displayPoint(marker, index){
        var x = marker.getLatLng();
        $('#map-info').hide();
        var moveEnd = GEvent.addListener(map, 'moveend', function(){
          var markerOffset = map.fromLatLngToDivPixel(x);
          GEvent.removeListener(moveEnd);
        });
        map.panTo(marker.getLatLng());
          }

    </script>

</html> 
```

**更新代码**

```
<!doctype html>

<html lang="en-us">
<head>
    <meta charset="UTF-8">
    <title>Example</title>

    <style type="text/css">
        div {
            margin-top: 500px;
        }
    </style>

</head>

<body>
<div id="map"></div>

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>

    <script type="text/javascript"src="http://www.google.com/jsapi?key={API_KEY}&sensor=false"></script>

    <script type="text/javascript"charset="utf-8">
    google.load("maps","2.x"); 
    google.load("jquery","1.5.2");
    </script>

    <script type="text/javascript">

    $(document).ready(function(){ 
      var map = new GMap2(document.getElementById('map')); 
      var burnsvilleMN = new GLatLng(44.797916,-93.278046); 
      map.setCenter(burnsvilleMN, 8); 

      // setup 10 random points
    var bounds = map.getBounds(); 
    var southWest = bounds.getSouthWest(); 
    var northEast = bounds.getNorthEast(); 
    var lngSpan = northEast.lng() - southWest.lng(); 
    var latSpan = northEast.lat() - southWest.lat(); 
    var markers = []; 
    for (var i = 0; i<10; i++) { 
      var point = new GLatLng(southWest.lat() + latSpan * Math.random(), southWest.lng() + lngSpan * Math.random()); 
      marker = new GMarker(point); 
      map.addOverlay(marker); 
      markers[i] = marker; 
    }

    $.each(markers, function(i, marker){
          // var marker = marker
          setInterval(function(){displayPoint(marker, i);}, 5000 + (i * 5000));
          });

          $('#map-info').appendTo(map.getPane(G_MAP_FLOAT_SHADOW_PANE));

    function displayPoint(marker, index){
        var x = marker.getLatLng();
        $('#map-info').hide();
        var moveEnd = GEvent.addListener(map, 'moveend', function(){
          var markerOffset = map.fromLatLngToDivPixel(x);
          GEvent.removeListener(moveEnd);
        });
        map.panTo(marker.getLatLng());
          }
    });

    </script>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T21:31:30.763

`$(document).ready()`当 DOM 准备好时，您的函数就会运行。然而，其他代码在遇到时运行——在 DOM 准备好之前。

这意味着浏览器尝试做的事情`map.getBounds()` *之前* `map`已经设置好了。

解决方案是一起做所有的地图操作。

* * *

还要注意，必须为地图指定明确的大小。你需要这样的东西：

```
 div#map {
        height: 500px;
        width:500px;
    } 
```

并且给**每个**div a`margin-top`将通过将该边距应用于每个地图图块而对地图产生不利影响。这需要去：

```
 div {  // applies to every div element
        margin-top: 500px;
    } 
```

# r - R 中 nlme 模型的起始值的长度——我怎么知道？

> ID：11977595
> 
> 赞同：1
> 
> 时间：2012-08-15T21:26:48.117
> 
> 标签：r

我正在尝试在 R 中拟合非线性混合效应模型。我正在逐步执行此操作，以便更轻松地找到模型的起始值。它看起来像这样：

```
fit.nlme.10<-nlme(fit.beta.10, random=pdDiag(w.max ~1))

cfs <- fixef(fit.nlme.10)
fit.nlme2 <- update(fit.nlme.10, fixed = list(w.max ~ trt, t.e + t.m ~ 1),
                start = c(cfs[1], rep(0,2), cfs[2:3]))

cfsT <- fixef(fit.nlme2)

fit.nlme3 <- update(fit.nlme.10, fixed = list(w.max ~ ground, t.e + t.m ~ 1),
             start = c(cfs[1], rep(0,1), cfs[2:3]))

cfsG <- fixef(fit.nlme3)

fit.nlme4 <- update(fit.nlme.10, fixed = list(w.max ~ trt + ground, t.e + t.m ~ 1),
                    start = c(cfsT2[1:3], cfsG2[1:2], cfs[2:3])) 
```

这个想法是随着模型变得更加复杂，使用先前拟合的系数作为起始值。我以前成功地做到了这一点，但从未完全理解它。我经常收到错误消息“固定组件的起始值不是正确的长度”。我花了很多时间玩弄长度，直到不再出现错误消息。

谁能向我解释我如何从一开始就知道正确的长度是多少？

很抱歉没有附加数据，但要运行它，您还需要一些冗长的自定义函数。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-04-29T07:48:08.103

您可以使用的一个技巧是`lm`用相同的固定术语拟合 a 并计算 coefs 的数量。

```
temp<-length(coef(lm(w.max ~ trt + ground,data)))
fit.nlme4 <- update(fit.nlme.10, fixed = list(w.max ~ trt + ground, t.e + t.m ~ 1),
                start = c(cfs[1], rep(0,temp-1), cfs[2:3])) 
```

# jquery - jQuery .each 其他 URL 内容中的元素

> ID：11977600
> 
> 赞同：0
> 
> 时间：2012-08-15T21:27:00.390
> 
> 标签：jquery

这是我第三次尝试在 stackoverflow 上获得帮助。基本上我要做的是获取一个 url 页面，然后从每个元素“tr.r1.lastrow td.cell.c0”中获取内容。

除了最里面的 .each 循环之外，关于代码的一切都在工作。我相信我刚刚写错了每个函数。我在这里做错了什么？

编辑：这已经解决了 san substr，这只是一个错误。谢谢大家。

```
var allLessonsArray= new Array();
$.each(lessonInTopicSectionArray, function(index, lesson){   
    var lastAttempt = 0;
    url='------/learn/mod/lesson/report.php?id='+lesson.id+'&action=reportdetail&userid='+userid+'&try='+lastAttempt;
    $.get(url, function(data) {
        var lessonArray= new Array();
        $('tr.r1.lastrow td.cell.c0').html(data).each(function(index, content) {
            alert(jQuery(content).html());
            score=parseInt(content.substr(content.length - 1));
            lessonArray[index]=score;
        });     
    allLessonsArray[index]={name:lesson.name, score: lessonArray};  
    }); 
}); 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T21:44:01.807

问题出在这部分：

```
$('tr.r1.lastrow td.cell.c0').html(data) 
```

您实际上是在选择单元格并用检索到的数据替换它们。你的意思大概是这样的：

```
$(data).find('tr.r1.lastrow td.cell.c0') 
```

它将`tr.r1.lastrow td.cell.c0`在检索到的文档上执行“”选择器。

# c++ - 重构导致链接器出现重复问题

> ID：11977601
> 
> 赞同：1
> 
> 时间：2012-08-15T21:27:06.290
> 
> 标签：c++

我希望有一些包装代码是一个只有头文件的库。我受到了 boost 库的启发，将它们保留为标题只是为了简化分发 .lib 和包括编译 .cpp 的需要。

在此示例中，“zh”是包装器，a.cp​​p 已被重构以将 B() 移动到它自己的源文件中。现在它不起作用。

zh

```
class Z
{
    public:
    void Foo(); // edited to match my code
};

Z::Foo() { } 
```

a.cpp

```
#include "z.h"
void A() { 
      Z z;
      z.Foo();
}
//void B(Z z) {
//     z.Foo();
//} 
```

b.cpp

```
#include "z.h"
void B(Z z) {           
      z.Foo();
} 
```

*error LNK2005: "public: __cdecl void z::Foo()" 已经在 b.obj 中定义*

我知道我可以通过将 zh 分离为 zh 用于声明和 z.cpp 用于定义来解决此问题。

*   但是，没有 .cpp 文件，Boost 库如何摆脱困境呢？
*   一切都需要模板吗？
*   zh里能进去什么代码？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T23:15:34.870

考虑一下这个标题：

```
// foo.hpp

void foo(int x)
{
    /* do something */
} 
```

（标题保护在这里无关紧要，它们按翻译单元工作。）我们现在有两个翻译单元：

```
// a.cpp

#include "foo.hpp" 
```

和：

```
// b.cpp

#include "foo.hpp" 
```

最终要做的是定义`foo(int x)`两次，每个 TU 中定义一次。根据单一定义规则 (ODR)，不允许多个定义，虽然从技术上讲不需要诊断，但在编译器部分这样做是微不足道的，因此您会得到错误。

幸运的是，有一个关键字 ,`inline`可以改变这种行为：

```
// foo.hpp

inline void foo(int x)
{
    /* do something */
} 
```

这个关键字告诉链接器，如果它遇到多个定义，它可以自由地选择一个定义并丢弃其余的。（由您来确保这实际上没问题！）通过此更改，先前的 ODR 违规得到解决并且程序编译。

现在，您已将标题列为：

```
class Z      
{      
    public:      
    void Foo(){       
       //do stuff      
    }      
}; 
```

这相当于：

```
class Z      
{      
    public:      
    void Foo();
};    

inline void Z::Foo(){       
       //do stuff      
    } 
```

因为在类中定义的函数是隐式的`inline`。（这使您可以将定义包含在多个翻译单元中而不会出错。）我怀疑您所写的不是您帖子中的内容，而是如下所示：

```
class Z      
{      
    public:      
    void Foo();
};    

void Z::Foo(){       
       //do stuff      
    } 
```

哪里`inline`不见了。等价性丢失，创建了多个定义，并且您违反了 ODR。

解决方案是使用`inline`，或通过定义隐式使用它类定义中的函数。就个人而言，我发现后者更清晰（因为您避免重复自己），并且更容易维护。Boost`inline`经常使用来避免需要单个定义。

# html - 请求中的参数始终为“空”

> ID：11977603
> 
> 赞同：0
> 
> 时间：2012-08-15T21:27:22.653
> 
> 标签：html, servlets

我以前做过，但这次不能让它工作：S

我有一个带有表单的 JSP：

```
 <form action="/SimModSystem-web/ExecuteModel" method="post">
            <h2>Initial State</h2>
    <h3>ASSET</h3>
    <div  style="style0"><span style="style1">Assets Amount</span><span style="style2"><span style="style2">Amount<input type="text" value="[-Infinite - +Infinite]" id="initial..asset.amount.param0" /></span></span></div>
    <div  style="style0"><span style="style1">Savings Interest APR</span><span style="style2"><span style="style2">APR %<input type="text" value="[0.0 - 1.0]" id="initial..asset.apr.param0" /></span></span></div>
    <div  style="style0"><span style="style1">Desired Savings Percentage</span><span style="style2"><span style="style2">Annual %<input type="text" value="[0.0 - 1.0]" id="initial..asset.minsaving.param0" /></span></span></div>
    <h3>LIABILITY</h3>
    <div  style="style0"><span style="style1">Liabilities Monthly Minimum Payment Percentage</span><span style="style2"><span style="style2">Minimum Payment %<input type="text" value="[0.0 - 1.0]" id="initial..liabilities.minpay.param0" /></span></span></div>
    <div  style="style0"><span style="style1">Liabilities Amount</span><span style="style2"><span style="style2">Amount<input type="text" value="[0.0 - +Infinite]" id="initial..liabilities.amount.param0" /></span></span></div>
    <div  style="style0"><span style="style1">Liabilities APR</span><span style="style2"><span style="style2">APR %<input type="text" value="[0.0 - 1.0]" id="initial..liabilities.apr.param0" /></span></span></div>
    <div  style="style0"><span style="style1">Liabilities Delayed Payment Fee</span><span style="style2"><span style="style2">Fee Amount<input type="text" value="[0.0 - +Infinite]" id="initial..liabilities.delayedfee.param0" /></span></span></div>
...
<input type="submit"/>
        </form> 
```

当我单击“提交”时，在 servlet 中我尝试执行以下操作：

```
request.getParameterNames();
request.getParameterMap();
request.getParateter("initial..liabilities.delayedfee.param0"); //or any other param 
```

全部返回“空”。

如您所见，这种形式没有特殊编码。

有谁知道可能出了什么问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T21:30:19.463

您需要使用组件的名称，只是“id”不起作用

```
<input type="text" value="[-Infinite - +Infinite]" id="initial..asset.amount.param0" name="comp1" /> 
```

和

```
request.getParameter("comp1"); 
```

# javascript - jQuery Module pattern not named | How is '$' accessible?

> ID：11977604
> 
> 赞同：0
> 
> 时间：2012-08-15T21:27:23.107
> 
> 标签：javascript, jquery

Here is the [jQuery latest](http://code.jquery.com/jquery-latest.js).

It is wrapped in a anonymous immediately invoked function expression ( aiife )

```
(function( window, undefined ) {
    // all jQuery code
})( window ); 
```

How do you access the $ sign , the alias of for jQuery that is so popular?

I thought you needed a name to access if you were going to access something?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T21:30:38.120

答案在以下几行中：

```
// Expose jQuery to the global object
window.jQuery = window.$ = jQuery; 
```

换句话说，两者都`jQuery`被`$`定义为全局对象的属性。这使它们可以按原样访问 - by`jQuery`和`$`. )

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-08-15T21:30:27.053

`window`对象足以使变量可访问。它基本上是全局对象，执行页面的范围。因此，您可以执行以下操作：

```
window.test = 'hello!';
alert(test); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T21:31:05.827

不，`$`是 Javascript 变量的有效名称，jQueryX.js 定义了它。所以你可以使用，例如，

```
$(document).ready(){} 
```

或者

```
$('div').hide(); 
```

ETC

# c++ - Finding the directory where file is being executed from?

> ID：11977605
> 
> 赞同：0
> 
> 时间：2012-08-15T21:27:24.343
> 
> 标签：c++, file, boost, filesystems, filenames

I want to call `opendir()` with the argument of the directory the program is being run from. If possible it will be a platform independent way. I'm confused because the accepted answer to a [similar question](https://stackoverflow.com/questions/143174/c-c-how-to-obtain-the-full-path-of-current-directory) doesn't look to be platform independent. Other answers say use Boost but a reply to [this question](https://stackoverflow.com/questions/6108650/replacement-for-deprecated-boost-filesystem-initial-path) states `initial_path()` is deprecated. If it can't be done in a platform independent the target is Windows.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T21:42:07.597

`initial_path()`已弃用，但它`current_path()`在程序开始时有效地为您调用，然后在任何后续调用中返回该结果。因此，您需要做的就是`current_path()`在程序开始时调用并将其存储在某个地方。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T21:34:26.693

这是跨平台的，并告诉您程序的当前工作目录。

char *getcwd(char *buf, size_t 大小);

这是一个 posix 函数，应该在 Linux、OsX 和 Windows 上支持。在这里阅读：

[http://linux.die.net/man/3/getcwd](http://linux.die.net/man/3/getcwd)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T21:57:28.950

大致相同的问题是[here](https://stackoverflow.com/questions/143174/c-c-how-to-obtain-the-full-path-of-current-directory)。

您还可以从这里获得帮助：[Makefile 教程](http://mrbook.org/tutorials/make/)

您也可以使用这些命令

```
initial_path()
current_path() 
```

# c# - Securely storing the string used to generate a symmetric encryption key

> ID：11977608
> 
> 赞同：2
> 
> 时间：2012-08-15T21:27:31.547
> 
> 标签：c#, .net, vb.net

I have a windows forms applciation that stores encrypted files to disk. At runtime, it decrypts those files and passes the resulting memorystreams to Datasets. I am using symmetric encryption with AESManaged.

There are custom functions to generate Key and IV byte arrays from a string. However I am currently hard coding the secure string that I use to generate Key and Iv, which I think defeats the purpose of encryption. I understand that the best way would be to prompt the user for a password and use that string. Is there any other way around this where I don't have to prompt the user for a password? Also I cannot use DPAPI because the encrypted data file is expected to be shared between users and computers.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T21:38:28.320

不可能有你的蛋糕也吃它:) 你不能存储解密密钥并使用它，也不能让别人恢复它。您唯一能做的就是通过混淆您的代码、预加密您的密钥并动态解密它（可能通过分散在几个类中的几轮解密）来明确它的位置。与其他编程学科不同，这就是乱码是件好事。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-17T02:55:26.967

我认为你还是应该考虑 DPAPI；不是为了加密数据文件，而是为了加密秘密字符串。

是否可以只要求您的用户一次输入密码字符串？* 如果可以，您会：

*   使用 DPAPI 对其进行加密
*   然后将加密的值存储在某个地方（配置文件、设置文件、注册表，无论你喜欢什么。最好是对用户安全的东西，而不是公众。）
*   然后当你需要它时，使用 DPAPI 来检索秘密字符串
*   使用您已经拥有的其余代码。

由于您的数据文件仍将使用相同的秘密字符串由 AES 加密，因此它们仍然可以互换。（在具有相同秘密字符串的人中......所以现在你已经做到了，所以你的应用程序可以有多个安全组，每个组都设置自己的秘密......但这是一个切线。）

好处是即使有人得到了你的代码，再多的逆向工程也不会返回秘密字符串……因为它不存在。

请注意，这比单独的混淆要好。通过混淆，如果攻击者获取了您的代码并可以在他们自己的环境中运行它，他们可以附加一个调试器并在您将字符串传递给 AES 代码时停止。他们不必关心你用了多少技巧来打乱它。他们只是在你解读后才看。使用 DPAPI 除非他们在用户的上下文中运行您的代码，否则这将不起作用……在这种情况下，游戏无论如何都会结束。

我并不是说 DPAPI 是完美的，但在这种情况下，我真的会在单独使用混淆之前考虑它。（您仍然可以通过混淆工具运行您的代码：这也是一件好事，只是还不够。）

*如果没有，您可以在安装/初始配置时提供它吗？我已经看到它在文件中以纯文本形式安装密钥，然后程序在首次使用时对其进行加密。

# ios - Filtering and propagating swipe events between nested UIScrollViews?

> ID：11977609
> 
> 赞同：1
> 
> 时间：2012-08-15T21:27:45.657
> 
> 标签：ios, uiscrollview, uiimageview, touch, gallery

*I have an app that implements a photo gallery:*

*   Each **photo** in the gallery is implemented as a subclassed UIScrollView.
*   The **gallery** itself is also a UIScrollView with paging enabled.
*   A user can swipe left and right in the gallery to change photos. They can also pinch/zoom and translate the photo onscreen while zoomed. If you drag on an edge you can see the next photo, and paging causes it to snap to the adjacent photo.
*   The layout of the photos is bit unorthodox and precludes me being able to use one of the pre-existing solutions for this.

My problem is that horizontal movements are sometimes being detected by the gallery, other times by the photo itself. Drags on the photo should move it around, drags on the gallery should change photos. If you're not 'clean' in your drag from left to right, you're not able to scroll, the photo moves a bit, shows the adjacent photo and bounces back.

Is there a tried and true solution to this problem? I'm envisioning measuring the length of the drag (in the photo), and if its over some distance, propagating the event from the photo to the gallery to animate the swipe.

# php - 如何使网页只能从某些链接访问

> ID：11977610
> 
> 赞同：0
> 
> 时间：2012-08-15T21:27:45.250
> 
> 标签：php, html, database, paypal

我正在制作一个网站，您必须先付款（通过 PayPal）才能访问该网站的某些安全部分。我已经设置好了，所以“注册”按钮会直接带你到 PayPal，然后一旦你在那里完成支付，你就会被引导到注册 (root/signup/index.php) 页面，你可以在其中输入你的姓名、电子邮件，密码等，并且此信息存储在数据库中。一旦某人的信息进入数据库，他们就可以登录网站的安全部分。

我的问题是，用户可以通过访问 www.mysite.com/signup/ 并输入他们的姓名/电子邮件/密码/等来绕过 PayPal 付款，这些信息仍将输入到数据库中，从而授予他们无需付费即可访问该网站的权限。

有什么方法可以让 www.mysite.com/signup/ 成为只能从 PayPal 访问的页面？我设置了一个 PayPal 按钮，用于在用户完成付款后将其带到注册页面，我希望这是用户访问该页面的唯一方式。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T21:32:14.013

通常，当用户从 PayPal 返回时，您会将他们定向到您网站上的特定页面，然后您可以在其中评估 PayPal 发布给您的数据。您可以简单地验证用户是否成功购买，如果是，则设置会话变量并将用户定向到您的注册页面。只有当他们有一个有效的会话变量表明他们是付费客户时，您才会向他们展示注册表单。

如果用户在没有经过适当验证的情况下到达您的页面，您只需将他们重定向到其他地方，或者给他们一些错误消息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T21:31:02.250

最好将标志作为`$_SESSION`变量传递，表明用户已付款，然后阻止。

如果您仍然想检查引荐来源网址，您应该让您的脚本检查`$_SERVER['HTTP_REFERER']`变量并从那里开始。不过，我不完全确定这有多安全。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T21:32:29.600

如果您知道 paypal 只使用一组 IP 地址来联系您的站点，那么将网络服务器配置为仅允许从这些地址访问将相当容易。但是，IP 可能会被欺骗。如果您真的需要更加安全，则必须使用证书。

# weka - How to add classifier to weka?

> ID：11977613
> 
> 赞同：2
> 
> 时间：2012-08-15T21:28:00.347
> 
> 标签：weka, classification

I want to add custom classifier to Weka. This classifier is in jar file. I've put it into the Weka folder and run this command `java -classpath "D:/weka/ancl.jar;D:/weka_bin/weka.jar" weka.gui.GUIChooser` Weka runs normally but I can't find my classifier on the classifiers list.

I've also tried to this classifier to GenericObjectEditor.props file, but when I run weka with the the commmand above I get this exception when I hit Explorer button

```
$ java -classpath "D:/weka/ancl.jar;D:/weka_bin/weka.jar"  weka.gui.GUIChooser
---Registering Weka Editors---
Checking class: weka.core.MathematicalExpression
java.lang.ExceptionInInitializerError
        java.lang.Class.forName0(Native Method)
        java.lang.Class.forName(Unknown Source)
        weka.core.ClassDiscovery.find(ClassDiscovery.java:416)
        weka.core.AllJavadoc.<clinit>(AllJavadoc.java:59)
        java.lang.Class.forName0(Native Method)
        java.lang.Class.forName(Unknown Source)
        weka.core.ClassDiscovery.find(ClassDiscovery.java:416)
        weka.gui.GenericPropertiesCreator.generateOutputProperties(GenericProper                                                                     tiesCreator.java:455)
        weka.gui.GenericPropertiesCreator.execute(GenericPropertiesCreator.java:                                                                     534)
        weka.core.converters.ConverterUtils.<clinit>(ConverterUtils.java:714)
        weka.gui.ConverterFileChooser.<clinit>(ConverterFileChooser.java:110)
        weka.gui.explorer.PreprocessPanel.<init>(PreprocessPanel.java:162)
        weka.gui.explorer.Explorer.<init>(Explorer.java:184)
        weka.gui.GUIChooser.showExplorer(GUIChooser.java:1074)
        weka.gui.GUIChooser$17.actionPerformed(GUIChooser.java:928)
        javax.swing.AbstractButton.fireActionPerformed(Unknown Source)
        javax.swing.AbstractButton$Handler.actionPerformed(Unknown Source)
        javax.swing.DefaultButtonModel.fireActionPerformed(Unknown Source)
        javax.swing.DefaultButtonModel.setPressed(Unknown Source)
        javax.swing.plaf.basic.BasicButtonListener.mouseReleased(Unknown Source)
        java.awt.Component.processMouseEvent(Unknown Source)
        javax.swing.JComponent.processMouseEvent(Unknown Source)
        java.awt.Component.processEvent(Unknown Source)
        java.awt.Container.processEvent(Unknown Source)
        java.awt.Component.dispatchEventImpl(Unknown Source)
        java.awt.Container.dispatchEventImpl(Unknown Source)
        java.awt.Component.dispatchEvent(Unknown Source)
        java.awt.LightweightDispatcher.retargetMouseEvent(Unknown Source)
        java.awt.LightweightDispatcher.processMouseEvent(Unknown Source)
        java.awt.LightweightDispatcher.dispatchEvent(Unknown Source)
        java.awt.Container.dispatchEventImpl(Unknown Source)
        java.awt.Window.dispatchEventImpl(Unknown Source)
        java.awt.Component.dispatchEvent(Unknown Source)
        java.awt.EventQueue.dispatchEventImpl(Unknown Source)
        java.awt.EventQueue.access$000(Unknown Source)
        java.awt.EventQueue$3.run(Unknown Source)
        java.awt.EventQueue$3.run(Unknown Source)
        java.security.AccessController.doPrivileged(Native Method)
        java.security.ProtectionDomain$1.doIntersectionPrivilege(Unknown Source)
        java.security.ProtectionDomain$1.doIntersectionPrivilege(Unknown Source)
        java.awt.EventQueue$4.run(Unknown Source)
        java.awt.EventQueue$4.run(Unknown Source)
        java.security.AccessController.doPrivileged(Native Method)
        java.security.ProtectionDomain$1.doIntersectionPrivilege(Unknown Source)
        java.awt.EventQueue.dispatchEvent(Unknown Source)
        java.awt.EventDispatchThread.pumpOneEventForFilters(Unknown Source)
        java.awt.EventDispatchThread.pumpEventsForFilter(Unknown Source)
        java.awt.EventDispatchThread.pumpEventsForHierarchy(Unknown Source)
        java.awt.EventDispatchThread.pumpEvents(Unknown Source)
        java.awt.EventDispatchThread.pumpEvents(Unknown Source)
        java.awt.EventDispatchThread.run(Unknown Source)

        at java.lang.Class.forName0(Native Method)
        at java.lang.Class.forName(Unknown Source)
        at weka.core.ClassDiscovery.find(ClassDiscovery.java:416)
        at weka.core.AllJavadoc.<clinit>(AllJavadoc.java:59)
        at java.lang.Class.forName0(Native Method)
        at java.lang.Class.forName(Unknown Source)
        at weka.core.ClassDiscovery.find(ClassDiscovery.java:416)
        at weka.gui.GenericPropertiesCreator.generateOutputProperties(GenericPro                                                                     pertiesCreator.java:455)
        at weka.gui.GenericPropertiesCreator.execute(GenericPropertiesCreator.ja                                                                     va:534)
        at weka.core.converters.ConverterUtils.<clinit>(ConverterUtils.java:714)
        at weka.gui.ConverterFileChooser.<clinit>(ConverterFileChooser.java:110)
        at weka.gui.explorer.PreprocessPanel.<init>(PreprocessPanel.java:162)
        at weka.gui.explorer.Explorer.<init>(Explorer.java:184)
        at weka.gui.GUIChooser.showExplorer(GUIChooser.java:1074)
        at weka.gui.GUIChooser$17.actionPerformed(GUIChooser.java:928)
        at javax.swing.AbstractButton.fireActionPerformed(Unknown Source)
        at javax.swing.AbstractButton$Handler.actionPerformed(Unknown Source)
        at javax.swing.DefaultButtonModel.fireActionPerformed(Unknown Source)
        at javax.swing.DefaultButtonModel.setPressed(Unknown Source)
        at javax.swing.plaf.basic.BasicButtonListener.mouseReleased(Unknown Sour                                                                     ce)
        at java.awt.Component.processMouseEvent(Unknown Source)
        at javax.swing.JComponent.processMouseEvent(Unknown Source)
        at java.awt.Component.processEvent(Unknown Source)
        at java.awt.Container.processEvent(Unknown Source)
        at java.awt.Component.dispatchEventImpl(Unknown Source)
        at java.awt.Container.dispatchEventImpl(Unknown Source)
        at java.awt.Component.dispatchEvent(Unknown Source)
        at java.awt.LightweightDispatcher.retargetMouseEvent(Unknown Source)
        at java.awt.LightweightDispatcher.processMouseEvent(Unknown Source)
        at java.awt.LightweightDispatcher.dispatchEvent(Unknown Source)
        at java.awt.Container.dispatchEventImpl(Unknown Source)
        at java.awt.Window.dispatchEventImpl(Unknown Source)
        at java.awt.Component.dispatchEvent(Unknown Source)
        at java.awt.EventQueue.dispatchEventImpl(Unknown Source)
        at java.awt.EventQueue.access$000(Unknown Source)
        at java.awt.EventQueue$3.run(Unknown Source)
        at java.awt.EventQueue$3.run(Unknown Source)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.security.ProtectionDomain$1.doIntersectionPrivilege(Unknown Sour                                                                     ce)
        at java.security.ProtectionDomain$1.doIntersectionPrivilege(Unknown Sour                                                                     ce)
        at java.awt.EventQueue$4.run(Unknown Source)
        at java.awt.EventQueue$4.run(Unknown Source)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.security.ProtectionDomain$1.doIntersectionPrivilege(Unknown Sour                                                                     ce)
        at java.awt.EventQueue.dispatchEvent(Unknown Source)
        at java.awt.EventDispatchThread.pumpOneEventForFilters(Unknown Source)
        at java.awt.EventDispatchThread.pumpEventsForFilter(Unknown Source)
        at java.awt.EventDispatchThread.pumpEventsForHierarchy(Unknown Source)
        at java.awt.EventDispatchThread.pumpEvents(Unknown Source)
        at java.awt.EventDispatchThread.pumpEvents(Unknown Source)
        at java.awt.EventDispatchThread.run(Unknown Source)
Caused by: java.lang.RuntimeException: Uncompilable source code - package java_c                                                                     up.runtime does not exist
        at weka.core.MathematicalExpression.<clinit>(MathematicalExpression.java                                                                     :26)
        ... 51 more
Checking class: weka.core.MathematicalExpression
java.lang.NoClassDefFoundError: Could not initialize class weka.core.Mathematica                                                                     lExpression
        java.lang.Class.forName0(Native Method)
        java.lang.Class.forName(Unknown Source)
        weka.core.ClassDiscovery.find(ClassDiscovery.java:416)
        weka.gui.GenericPropertiesCreator.generateOutputProperties(GenericProper                                                                     tiesCreator.java:455)
        weka.gui.GenericPropertiesCreator.execute(GenericPropertiesCreator.java:                                                                     534)
        weka.core.converters.ConverterUtils.<clinit>(ConverterUtils.java:714)
        weka.gui.ConverterFileChooser.<clinit>(ConverterFileChooser.java:110)
        weka.gui.explorer.PreprocessPanel.<init>(PreprocessPanel.java:162)
        weka.gui.explorer.Explorer.<init>(Explorer.java:184)
        weka.gui.GUIChooser.showExplorer(GUIChooser.java:1074)
        weka.gui.GUIChooser$17.actionPerformed(GUIChooser.java:928)
        javax.swing.AbstractButton.fireActionPerformed(Unknown Source)
        javax.swing.AbstractButton$Handler.actionPerformed(Unknown Source)
        javax.swing.DefaultButtonModel.fireActionPerformed(Unknown Source)
        javax.swing.DefaultButtonModel.setPressed(Unknown Source)
        javax.swing.plaf.basic.BasicButtonListener.mouseReleased(Unknown Source)
        java.awt.Component.processMouseEvent(Unknown Source)
        javax.swing.JComponent.processMouseEvent(Unknown Source)
        java.awt.Component.processEvent(Unknown Source)
        java.awt.Container.processEvent(Unknown Source)
        java.awt.Component.dispatchEventImpl(Unknown Source)
        java.awt.Container.dispatchEventImpl(Unknown Source)
        java.awt.Component.dispatchEvent(Unknown Source)
        java.awt.LightweightDispatcher.retargetMouseEvent(Unknown Source)
        java.awt.LightweightDispatcher.processMouseEvent(Unknown Source)
        java.awt.LightweightDispatcher.dispatchEvent(Unknown Source)
        java.awt.Container.dispatchEventImpl(Unknown Source)
        java.awt.Window.dispatchEventImpl(Unknown Source)
        java.awt.Component.dispatchEvent(Unknown Source)
        java.awt.EventQueue.dispatchEventImpl(Unknown Source)
        java.awt.EventQueue.access$000(Unknown Source)
        java.awt.EventQueue$3.run(Unknown Source)
        java.awt.EventQueue$3.run(Unknown Source)
        java.security.AccessController.doPrivileged(Native Method)
        java.security.ProtectionDomain$1.doIntersectionPrivilege(Unknown Source)
        java.security.ProtectionDomain$1.doIntersectionPrivilege(Unknown Source)
        java.awt.EventQueue$4.run(Unknown Source)
        java.awt.EventQueue$4.run(Unknown Source)
        java.security.AccessController.doPrivileged(Native Method)
        java.security.ProtectionDomain$1.doIntersectionPrivilege(Unknown Source)
        java.awt.EventQueue.dispatchEvent(Unknown Source)
        java.awt.EventDispatchThread.pumpOneEventForFilters(Unknown Source)
        java.awt.EventDispatchThread.pumpEventsForFilter(Unknown Source)
        java.awt.EventDispatchThread.pumpEventsForHierarchy(Unknown Source)
        java.awt.EventDispatchThread.pumpEvents(Unknown Source)
        java.awt.EventDispatchThread.pumpEvents(Unknown Source)
        java.awt.EventDispatchThread.run(Unknown Source)

        at java.lang.Class.forName0(Native Method)
        at java.lang.Class.forName(Unknown Source)
        at weka.core.ClassDiscovery.find(ClassDiscovery.java:416)
        at weka.gui.GenericPropertiesCreator.generateOutputProperties(GenericPro                                                                     pertiesCreator.java:455)
        at weka.gui.GenericPropertiesCreator.execute(GenericPropertiesCreator.ja                                                                     va:534)
        at weka.core.converters.ConverterUtils.<clinit>(ConverterUtils.java:714)
        at weka.gui.ConverterFileChooser.<clinit>(ConverterFileChooser.java:110)
        at weka.gui.explorer.PreprocessPanel.<init>(PreprocessPanel.java:162)
        at weka.gui.explorer.Explorer.<init>(Explorer.java:184)
        at weka.gui.GUIChooser.showExplorer(GUIChooser.java:1074)
        at weka.gui.GUIChooser$17.actionPerformed(GUIChooser.java:928)
        at javax.swing.AbstractButton.fireActionPerformed(Unknown Source)
        at javax.swing.AbstractButton$Handler.actionPerformed(Unknown Source)
        at javax.swing.DefaultButtonModel.fireActionPerformed(Unknown Source)
        at javax.swing.DefaultButtonModel.setPressed(Unknown Source)
        at javax.swing.plaf.basic.BasicButtonListener.mouseReleased(Unknown Sour                                                                     ce)
        at java.awt.Component.processMouseEvent(Unknown Source)
        at javax.swing.JComponent.processMouseEvent(Unknown Source)
        at java.awt.Component.processEvent(Unknown Source)
        at java.awt.Container.processEvent(Unknown Source)
        at java.awt.Component.dispatchEventImpl(Unknown Source)
        at java.awt.Container.dispatchEventImpl(Unknown Source)
        at java.awt.Component.dispatchEvent(Unknown Source)
        at java.awt.LightweightDispatcher.retargetMouseEvent(Unknown Source)
        at java.awt.LightweightDispatcher.processMouseEvent(Unknown Source)
        at java.awt.LightweightDispatcher.dispatchEvent(Unknown Source)
        at java.awt.Container.dispatchEventImpl(Unknown Source)
        at java.awt.Window.dispatchEventImpl(Unknown Source)
        at java.awt.Component.dispatchEvent(Unknown Source)
        at java.awt.EventQueue.dispatchEventImpl(Unknown Source)
        at java.awt.EventQueue.access$000(Unknown Source)
        at java.awt.EventQueue$3.run(Unknown Source)
        at java.awt.EventQueue$3.run(Unknown Source)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.security.ProtectionDomain$1.doIntersectionPrivilege(Unknown Sour                                                                     ce)
        at java.security.ProtectionDomain$1.doIntersectionPrivilege(Unknown Sour                                                                     ce)
        at java.awt.EventQueue$4.run(Unknown Source)
        at java.awt.EventQueue$4.run(Unknown Source)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.security.ProtectionDomain$1.doIntersectionPrivilege(Unknown Sour                                                                     ce)
        at java.awt.EventQueue.dispatchEvent(Unknown Source)
        at java.awt.EventDispatchThread.pumpOneEventForFilters(Unknown Source)
        at java.awt.EventDispatchThread.pumpEventsForFilter(Unknown Source)
        at java.awt.EventDispatchThread.pumpEventsForHierarchy(Unknown Source)
        at java.awt.EventDispatchThread.pumpEvents(Unknown Source)
        at java.awt.EventDispatchThread.pumpEvents(Unknown Source)
        at java.awt.EventDispatchThread.run(Unknown Source)
Checking class: weka.filters.unsupervised.attribute.MathExpression
java.lang.ExceptionInInitializerError
        java.lang.Class.forName0(Native Method)
        java.lang.Class.forName(Unknown Source)
        weka.core.ClassDiscovery.find(ClassDiscovery.java:416)
        weka.gui.GenericPropertiesCreator.generateOutputProperties(GenericProper                                                                     tiesCreator.java:455)
        weka.gui.GenericPropertiesCreator.execute(GenericPropertiesCreator.java:                                                                     534)
        weka.core.converters.ConverterUtils.<clinit>(ConverterUtils.java:714)
        weka.gui.ConverterFileChooser.<clinit>(ConverterFileChooser.java:110)
        weka.gui.explorer.PreprocessPanel.<init>(PreprocessPanel.java:162)
        weka.gui.explorer.Explorer.<init>(Explorer.java:184)
        weka.gui.GUIChooser.showExplorer(GUIChooser.java:1074)
        weka.gui.GUIChooser$17.actionPerformed(GUIChooser.java:928)
        javax.swing.AbstractButton.fireActionPerformed(Unknown Source)
        javax.swing.AbstractButton$Handler.actionPerformed(Unknown Source)
        javax.swing.DefaultButtonModel.fireActionPerformed(Unknown Source)
        javax.swing.DefaultButtonModel.setPressed(Unknown Source)
        javax.swing.plaf.basic.BasicButtonListener.mouseReleased(Unknown Source)
        java.awt.Component.processMouseEvent(Unknown Source)
        javax.swing.JComponent.processMouseEvent(Unknown Source)
        java.awt.Component.processEvent(Unknown Source)
        java.awt.Container.processEvent(Unknown Source)
        java.awt.Component.dispatchEventImpl(Unknown Source)
        java.awt.Container.dispatchEventImpl(Unknown Source)
        java.awt.Component.dispatchEvent(Unknown Source)
        java.awt.LightweightDispatcher.retargetMouseEvent(Unknown Source)
        java.awt.LightweightDispatcher.processMouseEvent(Unknown Source)
        java.awt.LightweightDispatcher.dispatchEvent(Unknown Source)
        java.awt.Container.dispatchEventImpl(Unknown Source)
        java.awt.Window.dispatchEventImpl(Unknown Source)
        java.awt.Component.dispatchEvent(Unknown Source)
        java.awt.EventQueue.dispatchEventImpl(Unknown Source)
        java.awt.EventQueue.access$000(Unknown Source)
        java.awt.EventQueue$3.run(Unknown Source)
        java.awt.EventQueue$3.run(Unknown Source)
        java.security.AccessController.doPrivileged(Native Method)
        java.security.ProtectionDomain$1.doIntersectionPrivilege(Unknown Source)
        java.security.ProtectionDomain$1.doIntersectionPrivilege(Unknown Source)
        java.awt.EventQueue$4.run(Unknown Source)
        java.awt.EventQueue$4.run(Unknown Source)
        java.security.AccessController.doPrivileged(Native Method)
        java.security.ProtectionDomain$1.doIntersectionPrivilege(Unknown Source)
        java.awt.EventQueue.dispatchEvent(Unknown Source)
        java.awt.EventDispatchThread.pumpOneEventForFilters(Unknown Source)
        java.awt.EventDispatchThread.pumpEventsForFilter(Unknown Source)
        java.awt.EventDispatchThread.pumpEventsForHierarchy(Unknown Source)
        java.awt.EventDispatchThread.pumpEvents(Unknown Source)
        java.awt.EventDispatchThread.pumpEvents(Unknown Source)
        java.awt.EventDispatchThread.run(Unknown Source)

        at java.lang.Class.forName0(Native Method)
        at java.lang.Class.forName(Unknown Source)
        at weka.core.ClassDiscovery.find(ClassDiscovery.java:416)
        at weka.gui.GenericPropertiesCreator.generateOutputProperties(GenericPro                                                                     pertiesCreator.java:455)
        at weka.gui.GenericPropertiesCreator.execute(GenericPropertiesCreator.ja                                                                     va:534)
        at weka.core.converters.ConverterUtils.<clinit>(ConverterUtils.java:714)
        at weka.gui.ConverterFileChooser.<clinit>(ConverterFileChooser.java:110)
        at weka.gui.explorer.PreprocessPanel.<init>(PreprocessPanel.java:162)
        at weka.gui.explorer.Explorer.<init>(Explorer.java:184)
        at weka.gui.GUIChooser.showExplorer(GUIChooser.java:1074)
        at weka.gui.GUIChooser$17.actionPerformed(GUIChooser.java:928)
        at javax.swing.AbstractButton.fireActionPerformed(Unknown Source)
        at javax.swing.AbstractButton$Handler.actionPerformed(Unknown Source)
        at javax.swing.DefaultButtonModel.fireActionPerformed(Unknown Source)
        at javax.swing.DefaultButtonModel.setPressed(Unknown Source)
        at javax.swing.plaf.basic.BasicButtonListener.mouseReleased(Unknown Sour                                                                     ce)
        at java.awt.Component.processMouseEvent(Unknown Source)
        at javax.swing.JComponent.processMouseEvent(Unknown Source)
        at java.awt.Component.processEvent(Unknown Source)
        at java.awt.Container.processEvent(Unknown Source)
        at java.awt.Component.dispatchEventImpl(Unknown Source)
        at java.awt.Container.dispatchEventImpl(Unknown Source)
        at java.awt.Component.dispatchEvent(Unknown Source)
        at java.awt.LightweightDispatcher.retargetMouseEvent(Unknown Source)
        at java.awt.LightweightDispatcher.processMouseEvent(Unknown Source)
        at java.awt.LightweightDispatcher.dispatchEvent(Unknown Source)
        at java.awt.Container.dispatchEventImpl(Unknown Source)
        at java.awt.Window.dispatchEventImpl(Unknown Source)
        at java.awt.Component.dispatchEvent(Unknown Source)
        at java.awt.EventQueue.dispatchEventImpl(Unknown Source)
        at java.awt.EventQueue.access$000(Unknown Source)
        at java.awt.EventQueue$3.run(Unknown Source)
        at java.awt.EventQueue$3.run(Unknown Source)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.security.ProtectionDomain$1.doIntersectionPrivilege(Unknown Sour                                                                     ce)
        at java.security.ProtectionDomain$1.doIntersectionPrivilege(Unknown Sour                                                                     ce)
        at java.awt.EventQueue$4.run(Unknown Source)
        at java.awt.EventQueue$4.run(Unknown Source)
        at java.security.AccessController.doPrivileged(Native Method)
        at java.security.ProtectionDomain$1.doIntersectionPrivilege(Unknown Sour                                                                     ce)
        at java.awt.EventQueue.dispatchEvent(Unknown Source)
        at java.awt.EventDispatchThread.pumpOneEventForFilters(Unknown Source)
        at java.awt.EventDispatchThread.pumpEventsForFilter(Unknown Source)
        at java.awt.EventDispatchThread.pumpEventsForHierarchy(Unknown Source)
        at java.awt.EventDispatchThread.pumpEvents(Unknown Source)
        at java.awt.EventDispatchThread.pumpEvents(Unknown Source)
        at java.awt.EventDispatchThread.run(Unknown Source)
Caused by: java.lang.RuntimeException: Uncompilable source code - package java_c                                                                     up.runtime does not exist
        at weka.filters.unsupervised.attribute.MathExpression.<clinit>(MathExpre                                                                     ssion.java:38)
        ... 47 more 
```

Could anyone tell me how the automatic class discovery in Weka works? Or why it doesn't actally :( Any help appricieted

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-04T13:38:13.770

我按照这些说明进行操作，一切都很好：

[https://waikato.github.io/weka-wiki/writing_classifier/](https://waikato.github.io/weka-wiki/writing_classifier/)

快速浏览一下结尾：

这是对 weka.classifiers.trees.Id3 和生成的类 weka.classifiers.WekaWrapper 的示例调用（它将实际生成的代码包装在伪分类器中）：

```
java weka.classifiers.CheckSource \
    -W "weka.classifiers.trees.Id3" \
    -S weka.classifiers.WekaWrapper \
    -t data.arff \
    -c last 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-02-08T22:56:22.160

在创建 jar 时将 Java_cup、Meta_Inf 和 weka 文件夹合并在一起，然后上述错误将消失。

# backbone.js - 如何导入包含下划线模板的文件？

> ID：11977617
> 
> 赞同：1
> 
> 时间：2012-08-15T21:28:18.687
> 
> 标签：backbone.js, underscore.js

正如在任何项目中所预期的那样，我 90% 的主 HTML 文件由许多不同的模板组成，就像这样：

```
<script type="text/template" id="template-parametros">
  <div id="parametros">
    <h2>Parâmetros</h2>
    <table id="tab-parametros">
      <tr><td>Descrição</td><td>Tipo</td><td>Locale</td></tr>
    </table>
    <button id="parametros-ad">Adicionar</button>
  </div>
</script> 
```

我想把它们放在其他地方，这样用户体验人员就可以自己处理它们了。将它们放在另一个文件中很容易，但是我以后如何导入它们呢？我已经尝试过了，但是浏览器尝试，当然，失败了，将其解释为 javascript 代码。type="text" 也失败了。任何的想法？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-16T01:29:55.560

我使用具有文本插件的模块加载器（requireJS）。它允许您将模板文件定义为参数并在主干视图中使用。

带有 require 的主干视图看起来像这样。

```
define([
    'jquery',
    'underscore',
    'backbone',
    'text!/templates/templateFileName.html'  // Define the template using text! plugin
], function($, _, Backbone, myTemplate) {  // Include the template as an argument
    "use strict";

    ViewName = Backbone.View.extend({
        template: _.template(myTemplate),  // Setup my template (underscore)
        events: {
            ...
        },
        initialize: function() {
            ...     
        },
        render: function() {
            $(this.el).html(this.template()); // render the template
            return this;
        }
    });

    return ViewName;
}); 
```

除此之外，使用下划线`_.template()`很容易插入值。

说我的 templateFileName.html 看起来像这样

```
<section>
    <div>
        <%= name %>
    </div>
    <div>
        <%= age %>
    </div>
</section> 
```

您所要做的就是传递带有这些属性名称的散列来填充 html。

```
var myHash = {"name":"Felix", "age":"9"};

$(this.el).html(this.template(myHash)); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-17T01:29:46.157

怎么样：

```
if (!async) async = false;
$.ajax({
    async: async,
    url: '/template/' + templateId,
    dataType: 'json',
    success: function(response) {
        $('body').append(response.content);
    }
}); 
```

# php - prevent sql injection by converting string to arrays

> ID：11977620
> 
> 赞同：1
> 
> 时间：2012-08-15T21:28:55.387
> 
> 标签：php, sql, sql-injection

In my Login forms I hash username and password before I execute the queries

... class ...

```
private $username;
private $password;
protected function Login(){
    $user = hash('sha256', $this->username);
    $pass = hash('sha256', $this->password);
    $this query = "..."
    ...
} 
```

and in other kind of forms (like Search forms) I convert the strings to arrays and then I execute the queries, that way the query would look like this:

```
$searchstring = explode(' ', $search);
//.... Some lines of PHP code... and the resulting query is: ...
$this->query = "SELECT... WHERE name LIKE 'DELETE%' OR name LIKE 'FROM%' ";
$this->query.= " OR name LIKE 'USERS%' OR name LIKE 'WHERE%' OR name LIKE '1%'"; 
```

Is this enough to prevent sql injection? thanks

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-08-15T21:33:37.113

不要相信自己有能力防止 SQL 注入！许多比你更好的头脑都落入了它。

使用 mysqli 或 PDO 和参数化查询。这还有一个好处，就是允许您的数据库也缓存查询计划。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-16T00:28:55.200

或者，您可以将其转换为二进制：

```
function mssql_escape($data) {
    if(is_numeric($data))
        return $data;
    $unpacked = unpack('H*hex', $data);
    return '0x' . $unpacked['hex'];
} 
```

...如果您不在`mysql`数据库上。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T21:36:15.010

您可以采取一些非常简单的步骤来使代码更安全：

```
$query= mysqli_real_escape_string($database_connection, $user) 
```

这会转义任何可能对 SQL 字符串产生不利影响的危险字符

```
$query = mysqli_real_escape_string($database_connection, trim($user)) 
```

在这一步中，我们添加了 trim 函数，该函数去除了任何空格 - 用于发起 SQL 注入攻击

[你可以在这里](https://stackoverflow.com/questions/5541347/can-i-be-hacked-with-this-code/5541482#5541482)看到更多关于这个的信息

# c++ - 如何使优化器正确地将变量放入寄存器？

> ID：11977625
> 
> 赞同：1
> 
> 时间：2012-08-15T21:29:08.430
> 
> 标签：c++, visual-studio, optimization

我有一个简单的函数，它通过引用获取两个变量：

```
void foo(int*& it2,
         bit_reader<big_endian_tag>& reader2)
{
    for(/* ... */)
    {
        *it2++ = boo(reader2.next());
        // it2++ => 0x14001d890 add qword ptr [r12], 0x4
    }
} 
```

这里的问题是 for`it2`和`reader2`优化器使计算机在循环期间写入内存而不是寄存器。

但是，以下代码在循环期间将变量正确放入寄存器，但在循环之前和之后以不必要的副本形式产生了额外的开销：

```
void foo2(int*& it2,
         bit_reader<big_endian_tag>& reader2)
{
    auto reader = reader2;
    auto it     = it2;

    for(/* ... */)
    {
        *it++ = boo(reader.next());
        // it++ => 0x14001d890 add r15, 0x4
    }

    reader2 = reader;
    it2 = it;
} 
```

例如

如何使第一个示例生成与第二个示例相同的代码但没有额外的副本？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-08-15T21:41:31.863

问题是编译器无法证明`it2`函数内部没有变化。（嗯，它可以，但这远远超出了普通 C++ 编译器的预期功能。）

它怎么知道`boo(reader2.next());`不改变价值？考虑：

```
int* i = 0;

struct foo
{
    int myInt;
    int blah() { i = &myInt; return 5; }
};

void bar(int*& ptr, const foo& f)
{
    *ptr = f.blah(); // changes value of ptr!
}

int otherInt;
i = &otherInt;

bar(i, foo()); 
```

这不会为 分配任何内容`otherInt`，而在您转换之后它将：

```
void bar(int*& ptr, const foo& f)
{
    int* ptrCopy = ptr;
    *ptrCopy = f.blah(); // changes ptr, but not ptrCopy
} 
```

所以除非编译器可以证明行为是相同的，否则它不能进行优化。

C99 用关键字解决了这个问题`restrict`，但 C++ 没有等价物。但是，大多数 C++ 编译器中都存在扩展，例如`__restrict__`or `__restrict`。

要在标准 C++ 中做到这一点，您只需要明确并自己制作副本

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T21:41:27.127

好吧，你不能。

当您通过非常量引用传递参数时，您要求编译器更新原始变量。所以它*必须*将新值写入内存。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T21:54:25.947

It is all about optimizing for the "memory hierarchies", doing computation is fastest when done directly on registers and that's why you really really want to take stuff from memory and copy it into registers **before** computing anything on it and then copy the result back into the memory location you need to. The performance you gain by computing directly on registers will generally offset the cost of loading and saving the memory to and from registers.

How do you ensure you get stuff from memory into registers? e.g.

```
size_t size;
double* arr;
for (int i = 0; i < size - 1; ++i) {
    double a = arr[i];     // copy to register
    double b = arr[i + 1]; // copy to register
    b = a*b + b;           // make sure flop computation is done in registers
    arr[i] = b;            // copy back to memory
} 
```

# java - 从 finally 块返回时 Java 的奇怪行为

> ID：11977626
> 
> 赞同：11
> 
> 时间：2012-08-15T21:29:11.047
> 
> 标签：java, return, return-value, finally

试试这段代码。为什么 getValueB() 返回 1 而不是 2？毕竟， increment() 函数被调用了两次。

```
 public class ReturningFromFinally
    {
      public static int getValueA() // This returns 2 as expected
      {
         try     { return 1; }
         finally { return 2; }
      }

      public static int getValueB() // I expect this to return 2, but it returns 1
      {
        try     { return increment(); }
        finally { increment(); }
      }

      static int counter = 0;

      static int increment()
       {
          counter ++;
          return counter;
       }

      public static void main(String[] args)
      {
          System.out.println(getValueA()); // prints 2 as expected
          System.out.println(getValueB()); // why does it print 1?
      }
} 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2012-08-15T21:33:41.993

> 毕竟， increment() 函数被调用了两次。

是的，但是返回值是在第二次调用*之前确定的。*

返回的值由在该*时间点*对 return 语句中表达式的评估确定- 而不是“就在执行离开方法之前”。

从[JLS 的第 14.17 节](http://docs.oracle.com/javase/specs/jls/se7/html/jls-14.html#jls-14.17)：

> 带有 Expression 的 return 语句试图将控制权转移给包含它的方法的调用者；表达式的值成为方法调用的值。更准确地说，**执行这样的 return 语句首先评估 Expression**。如果 Expression 的评估由于某种原因突然完成，那么 return 语句会因为这个原因而突然完成。如果 Expression 的求值正常完成，产生一个值 V，那么 return 语句会突然完成，原因是返回值 V。

*然后*[根据 JLS 的第 14.20.2 节](http://docs.oracle.com/javase/specs/jls/se7/html/jls-14.html#jls-14.20.2)将执行转移到`finally`块中。不过，这不会重新评估 return 语句中的表达式。

如果您的 finally 块是：

```
finally { return increment(); } 
```

那么这个新的返回值将是该方法的最终结果（根据第 14.20.2 节） - 但你没有这样做。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-08-15T21:35:04.293

见[我的评论](https://stackoverflow.com/questions/11977626/javas-strange-behavior-while-returning-from-finally-block/11977707#comment15967945_11977626)。

`2`如果你有它会返回`finally { return increment(); }`。第一条`return`语句的表达式在 finally 块之前进行评估。请参阅[JLS 的第 14.20.2 节](http://docs.oracle.com/javase/specs/jls/se7/html/jls-14.html#jls-14.20.2)。

> 如果块的执行`try`正常完成，则`finally`执行该块，然后有一个选择：
> 
> *   如果`finally`块正常完成，则`try`语句正常完成。
> *   **如果`finally`块因故突然完成`S`，则`try`语句因故而突然完成`S`。**

调用`getValue2`（正如你现在所拥有的那样）两次将导致`1`后面跟着`3`.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T21:33:46.277

方法中的`finally`块`GetValue2`不返回任何内容。它只是调用方法来增加`counter`。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-08-15T21:34:22.360

因为在你的 getValue2() 方法中，你最终被阻止只是调用 increment()，它不会返回它。所以你的代码正在做的是递增并返回计数器（1），然后将计数器递增到 2，但不返回它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-08-27T05:06:07.247

在第二个示例中，您没有显式返回。在这种情况下，它将返回`try`块内的值。这很直观，因为`Java`已经执行了`try`块内的代码。执行块后不会再次执行该`finally`块。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-07-09T15:25:27.127

finally 方法的目的是确保在任何情况下都关闭资源。考虑这个例子：

```
public List<Person> getPersons() {
    Connection conn = openConnection();
    try {
        return selectPersons(conn);
    } finally {
        conn.close()
    }
} 
```

conn.close() 语句在 selectPersons(conn) 执行后执行。否则 selectPersons(conn) 会引发连接关闭错误。

# backbone.js - backbone.js and scoped urls

> ID：11977630
> 
> 赞同：0
> 
> 时间：2012-08-15T21:29:22.603
> 
> 标签：backbone.js, router

Currently I keep the current locale and account id only in global variables. But now I need to embed them in the url's of my backbone application, so the users can copy/ paste the url.

Currently:

```
/#users
/#documents
/#images
... 
```

Desired:

```
/#de/32/users
/#de/232/documents
/#de/4452/images
... 
```

I wonder what's the best way to extract and store the current locale and account id from the url before any router processes it. This way I should be able to leave all routers as they are, am I?

Do I have to "hack" this into the routers (something like in [https://github.com/documentcloud/backbone/pull/299](https://github.com/documentcloud/backbone/pull/299)) or is there any better way?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-16T08:08:48.717

我真的不会使用内部 Backbone 机制，尤其是当您可以移动代码以实现 Backbone 标准时。

我宁愿建议修改您的所有网址以接受这两个新值：

```
:locale/:account_id/users
:locale/:account_id/documents
:locale/:account_id/images
... 
```

此外，您想使用手工机制*提取和存储这些值*，这正是 Router 的含义之一，如果您不小心，最终可能会*重新发明轮子*。

# python - How to save Unicode codepoint as character, not codepoint in Python

> ID：11977633
> 
> 赞同：1
> 
> 时间：2012-08-15T21:29:39.243
> 
> 标签：python, json, unicode, codepoint

Is there a way to save a Unicode string into JSON that allows for Unicode codepoints to be replaced with their actual characters?

For instance, having a dict like this ported into JSON...:

```
dict1[u'N\u00e1utico'] = 2 
```

...instead of having it dumped with the codepoint, could the key be dumped as the actual string?:

```
Náutico 
```

Printing works fine for representing the characters, but saving I'm just lost on. Thanks.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-08-15T21:42:54.800

任何编写 JSON 的库都将为超出标准 ASCII 范围的字符提供 unicode 代码点，并且任何可以读取 JSON（包括浏览器）的库都将正确显示它。我不确定为什么您认为在 JSON 中表示字符串时需要重音字符，但您不应该这样做，并且作为提供代码点的交换格式是正确的行为。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T22:55:58.500

您的意思是包含非 ASCII 字符作为原始字符，而不是等效的`\u`转义符？如果是这样：

```
>>> print json.dumps({u'N\u00e1utico': 2}, ensure_ascii= False)
{"Náutico": 2} 
```

# objective-c - Is there a way to limit the Applications shown in a UIDocumentInteractionController?

> ID：11977635
> 
> 赞同：4
> 
> 时间：2012-08-15T21:29:43.497
> 
> 标签：objective-c, ios, uidocumentinteraction, uti

I am currently displaying a UIDocumentInteractionController so that the user of my App can open a File in a different App. The controller pops up and lists the App with no problem. However, it also displays Cloud apps such as Dropbox (which I'm assuming associate themselves with nearly every valid file-type), which is quite annoying. Is there anyway that I can specify the controller to only display the App I want?

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2012-08-15T21:31:57.087

不，您不能过滤此列表。如果用户愿意，您不能告诉他们不能将您的文件发送到 Dropbox。:)

（如果您只有一个可以将文件发送到的特定应用程序，并且您可以控制该应用程序或与该应用程序建立合作伙伴关系，那么您可以同意使用其他一些晦涩的文件类型，或直接通过自定义 URL 进行通信。`UIDocumentInteractionController`是专为允许用户将文件传送到他们可能需要的地方的一般情况而设计，而云服务可以是放置标准类型文件的完全有效的地方。）

# javascript - Overlapping Tabs JS CSS HTML

> ID：11977638
> 
> 赞同：0
> 
> 时间：2012-08-15T21:30:07.090
> 
> 标签：javascript, html, css, overlapping

I ran into an issue today with an html/css map I am designing. For some reason the tabs are overlapping each other causing the text to be difficult to read and otherwise offsetting the functionality of the map. If anyone knows how to fix this issue please let me know. You can find a sample of the site below.

[http://mikedemar.com/martygraff/index.html](http://mikedemar.com/martygraff/index.html)

Thanks in advance,

*   Mike

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T21:47:17.357

从css中删除`.handleicon`z-index以及z-index并将z-index更改为999。这应该可以解决您的问题。`.topdiv``.handleinfo`

祝你好运 ：）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-15T21:54:21.493

或者，您可以从 css 类中删除 z-index 值并使用 jQuery 向当前 div 添加/删除更高的 z-index 值：

```
$('.handle').on('mouseover', function(){
    $(this).css('z-index', '200000000');
});
$('.handle').on('mouseout', function(){
    $(this).css('z-index', '100000000');
}); 
```

# x86 - How does preemption on x86 architecture work?

> ID：11977640
> 
> 赞同：9
> 
> 时间：2012-08-15T21:30:07.137
> 
> 标签：x86, preemption

I'm struggling to understand one thing about preemption. Citing Wikipedia:

> In computing, preemption (more correctly pre-emption) is the act of temporarily interrupting a task being carried out by a computer system, without requiring its cooperation, and with the intention of resuming the task at a later time. Such a change is known as a context switch. It is normally carried out by a privileged task or part of the system known as a preemptive scheduler, **which has the power to preempt, or interrupt**, and later resume, other tasks in the system.

So, basically, they say the scheduler can interrupt the current running task. How is that even possible? CPU is running the code of this task at the moment, not the code of scheduler. So how a scheduler can *do* anything?

My guess is that there must be some kind of a hardware timer which physically interrupts CPU after some time has passed and give control back to scheduler. Is this correct? Is there any documentation where I can read about it in more detail?

Any answers will be highly appreciated.

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-08-15T21:35:51.603

的确。x86 体系结构有一个称为`interrupts`. 一些中断由硬件触发（而其他中断可以由软件触发）。

内核注册处理此问题的“处理程序”。如果您从事内核设计，这里有一个可能会有所帮助的教程：[http](http://www.osdever.net/bkerndev/Docs/gettingstarted.htm) ://www.osdever.net/bkerndev/Docs/gettingstarted.htm （注意：其中一些内容可能非常困难，并且涵盖了一些不是严格来说是你问题的一部分）

当触发中断时，当前正在执行的代码将停止。CPU 将改为执行处理程序，一旦处理程序完成，就会返回到触发中断之前正在执行的代码。对于应用程序来说，就好像中断从未发生过一样。

我们可以将中断处理与硬件时钟（例如 PIT 芯片）结合起来，以获得您想要的结果。

您还可以查看[http://wiki.osdev.org/PIT](http://wiki.osdev.org/PIT)（同样，请注意，如果您刚刚开始了解该主题，其中一些内容可能会很复杂）。

> 使用 IRQ 进行抢先式多任务处理
> 
> 定时器 IRQ 也可用于执行抢占式多任务。要给当前正在运行的任务一些运行时间，请设置一个阈值，例如 3 个滴答声。使用像之前一样的全局变量，但从 0 开始上升，当该变量达到 3 时，切换任务。你如何做到这一点取决于你。

所以：

1.  内核通过注册适当的中断处理程序说“当时间到期时，我希望执行此代码”。
2.  定时器到期，触发中断。然后执行内核注册的代码。
3.  内核接管，从停止的进程中保存所有需要的数据（例如寄存器的状态和正在执行的代码的地址），并将控制权交给不同的进程。
4.  稍后，当内核希望第一个进程继续运行时，它会使用所有保存的数据将进程恢复到之前的状态。然后，它告诉 CPU 从它停止的地方继续执行代码。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-08-15T21:33:07.820

你的猜测是正确的。在大多数操作系统中，都有一个定时器中断，它以某个固定频率运行内核中的特权代码。此特权代码可以决定 (a) 返回到最初运行的代码，或 (b) 保存上下文并开始运行其他代码。

还有其他可能导致上下文切换的条件，例如从 I/O 读取的请求，其中进程必须等待 I/O 准备好。当第一个任务等待时，内核可能会切换到其他任务。

您可能也有兴趣阅读所谓的[无滴答内核](https://www.google.com/search?q=tickless+kernel)。

# python - 您将如何从迭代创建的复选框中检索值？

> ID：11977642
> 
> 赞同：0
> 
> 时间：2012-08-15T21:30:17.027
> 
> 标签：python, checkbox, tkinter

我正在尝试从迭代创建的复选框中获取 Tkinter 复选框值。我无法理解如何从`__init__`函数外部引用每个/任何这些复选框的关联变量。以下是相关代码：

```
class Display_Window():
    def __init__(self, parent):
# some code excluded here
        self.widgets = []
        for i in range(len(self.eventNameList)): # a list of dictionaries
            self.eventName = self.eventNameList[i]['event_name']
            self.var1 = IntVar()
            self.cbEvent = Checkbutton(self.myContainer, text=self.eventName,
                                                            variable=self.var1)
            self.cbEvent.grid(row = i+2, column = 0, sticky = W)
            self.cbEvent.deselect()
            self.widgets.append((self.eventName, self.cbEvent)

        self.bSelect = Button(self.myContainer, text="Select", width=10)
        self.bSelect.bind("<Button-1>",
                             lambda event, arg=self.widgets: self.select(arg))
        self.bSelect.bind("<Return>",
                             lambda event, arg=self.widgets: self.select(arg))
        self.bSelect.grid(row = 1, column = 2)

    def select(self, widgets):
        for widget in widgets:
            cBox = widget[1] # references the checkbox
            cBoxValue = #get() what? 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T21:45:38.203

创建检查按钮的动态数量不会（也不应该）将它们分配为实例的属性。您所做的只是将最后一个创建为成员属性，这是毫无意义的。

此外，您的小部件列表几乎有正确的想法......

```
class Display_Window():
    def __init__(self, parent):
...snip...

        self.widgets = {}

        for i, eventDict in enumerate(self.eventNameList):        
            eventName = eventDict['event_name']
            var1 = IntVar()
            cbEvent = Checkbutton(self.myContainer, text=eventName, variable=var1) 
            cbEvent.grid(row = i+2, column = 0, sticky = W)
            cbEvent.deselect()

            self.widgets[eventName] = (cbEvent, var1)

        self.bSelect = Button(self.myContainer, text="Select", width=10)
        self.bSelect.bind("<Button-1>", self.select)
        self.bSelect.bind("<Return>", self.select)
        self.bSelect.grid(row = 1, column = 2)

    def select(self, *args):
        for widget, intvar in self.widgets.iteritems():
            # do stuff 
```

如我上面的示例所示，您可以做的是将检查按钮存储在字典中，假设事件名称是唯一的。这将使它们易于按名称查找，而不是循环遍历列表。在那个字典中，我存储了一个元组，其中第一项是小部件，第二项是 IntVar。我不确定你真的想如何组织它，但这是保存这些引用的一种方法。

此外，您似乎不再需要为按钮的回调执行自定义 lambda 以传递引用，因为`select`是同一类的成员，它可以简单地查看`self.widgets`字典。

# css - 如果 inline-block 元素上有足够的高度，则强制换行

> ID：11977647
> 
> 赞同：0
> 
> 时间：2012-08-15T21:30:47.460
> 
> 标签：css, html, layout

我正在制作一个具有水平内容的网站。我的问题是，为了使内容水平，我不得不在内容上使用 inline-block。内容只是图像，将有两个不同的高度，620 和 305 像素。

该网站如下所示：http: [//jsfiddle.net/alekks/2uBLG/](http://jsfiddle.net/alekks/2uBLG/)

正如你所看到的，小图片是排成一行的，但是，因为有足够的空间让小图片堆叠在一起，所以我希望他们这样做。即当有小图片时，内联规则不应该适用，希望它看起来像这样：

```
 _____  _____________  _____  __
|     ||             ||     ||  |
|     ||             ||_____||__|
|     ||             ||     ||  |
|_____||_____________||_____||__| 
```

但是，如果我以小班级为目标，将财产拿走或试图打破界限：之后，它只会打破整条界限，它们最终会出现在大图像之下。

有人对解决方案有任何想法吗？jQuery 与否无关紧要，只想像这样得到它:)

希望你明白我的意思。

请随时询问更多信息。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2014-03-21T01:21:03.193

jQuery 能够根据图像的大小提供不同的类。

```
jQuery(document).ready(function() {
    var set = jQuery('#content > img');  
    for(var i = 0, len = set.length; i < len; i += 1){
        set.slice(i, i+1).wrapAll('<div class="postImg" />');
    };    

    var set = jQuery('.size-thumbnail');  
    for(var i = 0, len = set.length; i < len; i += 2){
        set.slice(i, i+2).wrapAll('<div class="smallImgWrap" />');
    };
}); 
```

CSS：

```
#content{
        white-space: nowrap;  
    }
    #content .postImg{
        height: 100%;
        display: inline-block;
    }
        .postImg > img{
            width: auto;
        }

    .smallImgWrap{
        display: inline-block;
    }
        .smallImgWrap img{
            display:block !important;
            float:none;
        } 
```

# xcode - xcrun：错误：无法执行真正的 xcrun。（没有这样的文件或目录）

> ID：11977648
> 
> 赞同：22
> 
> 时间：2012-08-15T21:30:52.277
> 
> 标签：xcode, macos, xcrun

我已将 OSX Lion 升级到 Mountain Lion 并重新安装了命令行工具（因为升级删除了它们）。从那时起 xcrun 不再工作了。xcode-select 设置为 /usr/bin，二进制文件也在该目录中，但如果我使用参数（例如 xcrun gcc）运行 xcrun，它会显示：

```
xcrun：错误：无法执行真正的 xcrun。（没有这样的文件或目录）

```

我尝试使用 xcode-select 再次设置路径并重新安装了 CLT。没有任何帮助。

任何建议如何解决这个问题？

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2012-08-26T15:55:03.767

我有同样的问题。最初我为我的 xcode-switch 执行以下操作：

```
$ sudo xcode-select -switch /Applications/Xcode.app/ 
```

然而，真正需要的是：

```
$ sudo xcode-select -switch /Applications/Xcode.app/Contents/Developer/ 
```

这解决了我的问题。不确定是否需要 sudo。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-02-05T22:41:02.367

唯一的解决办法显然是破解。我尝试了提到的脚本并且它有效

[OSX 10.8 xcrun（没有这样的文件或目录）](https://stackoverflow.com/questions/13041525/osx-10-8-xcrun-no-such-file-or-directory)

# xna - 是否可以将数据块提供给 32 位应用程序以避免出现内存不足异常的风险？

> ID：11977658
> 
> 赞同：0
> 
> 时间：2012-08-15T21:31:48.227
> 
> 标签：xna, out-of-memory, shared-memory

我正在制作一个 XNA 游戏，它的主要思想是能够同时使用很多游戏对象，这意味着很多各自的纹理和声音效果。当地图足够大（通常是这样）时，游戏可能会创建太多对象并导致内存不足异常。

加载地图块是解决方案的一部分，因为玩家通常移动得足够慢以使游戏加载下一个块，但声音效果是一个问题——当太多游戏事件调用它们的声音时，加载新的块时会出现明显的延迟以通常的方式发出声音。

我想知道是否有一种方法可以通过在实际游戏和后台加载帮助应用程序之间交换内存块来加载资源，或者类似的方式来提高加载速度。

* * *

我正在考虑使用虚拟 RAM 驱动器来存储临时数据，它可能足够快。

# algorithm - 找到数组中元素的最大总和，使得相邻的元素不超过 k

> ID：11977663
> 
> 赞同：2
> 
> 时间：2012-08-15T21:32:10.100
> 
> 标签：algorithm

[这是从给定广告牌中移除广告牌](https://stackoverflow.com/questions/9376976/removal-of-billboards-from-given-ones)的副本，我已经仔细阅读了这个问题（和其他问题）的答案，但我仍然无法理解它？[他的回答](https://stackoverflow.com/questions/9376976/removal-of-billboards-from-given-ones/9377318#9377318)中的灵魂检查是什么意思？

我不需要代码，我只想用简单的英语解释算法。如果提供示例，我将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-16T08:49:03.253

他建议制作和 P[n,k] 数组，其中 P[i,j] 将存储可以从广告牌 1..i 获得的最大可能值（利润）（必要时删除其中一些），这样右边正好有j个连续的广告牌。

编辑：顺便说一下，这个解决方案不符合问题的要求（N <= 10^5）

# sql - 不安全的 SQL 汇编错误

> ID：11977673
> 
> 赞同：0
> 
> 时间：2012-08-15T21:32:57.147
> 
> 标签：sql, sql-server, sql-server-2005

我有以下错误消息：

```
Msg 10314, Level 16, State 11, Line 1
An error occurred in the Microsoft .NET Framework while trying to load assembly id 66007\. The server may be running out of resources, or the assembly may not be trusted with PERMISSION_SET = EXTERNAL_ACCESS or UNSAFE. Run the query again, or check documentation to see how to solve the assembly trust issues. For more information about this error: 
System.IO.FileLoadException: Could not load file or assembly 'powerstatregression, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null' or one of its dependencies. The given assembly name or codebase was invalid. (Exception from HRESULT: 0x80131047)
System.IO.FileLoadException: 
    at System.Reflection.Assembly._nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, Assembly locationHint, StackCrawlMark& stackMark, Boolean throwOnFileNotFound, Boolean forIntrospection)
    at System.Reflection.Assembly.InternalLoad(AssemblyName assemblyRef, Evidence assemblySecurity, StackCrawlMark& stackMark, Boolean forIntrospection)
    at System.Reflection.Assembly.InternalLoad(String assemblyString, Evidence assemblySecurity, StackCrawlMark& stackMark, Boolean forIntrospection)
    at System.Reflection.Assembly.Load(String assemblyString) 
```

我运行此代码，最后几行导致问题：

```
ALTER DATABASE dasolPSDev SET TRUSTWORTHY ON;
GO

CREATE ASSEMBLY PowerStatRegression
AUTHORIZATION [dbo]
from 'C:\SqlDlls\PowerStatRegression.dll'
WITH PERMISSION_SET = UNSAFE
GO

CREATE PROCEDURE [dbo].[SpCreatePowerStatCorr]
    @strUID [nvarchar](4000),
    @seqId [int],
    @flagProgress [int]
WITH EXECUTE AS CALLER
AS
EXTERNAL NAME [PowerStatRegression].[StoredProcedures].[SpCreatePowerStatCorr]
GO

CREATE PROCEDURE [dbo].[SpCreatePowerStatCorrEx]
    @strUID [nvarchar](4000),
    @seqId [int],
    @flagProgress [int]
WITH EXECUTE AS CALLER
AS
EXTERNAL NAME [PowerStatRegression].[StoredProcedures].[SpCreatePowerStatCorrEx]
GO

CREATE PROCEDURE [dbo].SpCheckCollinearity
    @strUID [nvarchar](4000),
    @seqId [int],
    @flagProgress [int]
WITH EXECUTE AS CALLER
AS
EXTERNAL NAME [PowerStatRegression].[StoredProcedures].[SpCheckCollinearity]
GO

CREATE PROCEDURE [dbo].[AboutPowerStatCorrelation]
WITH EXECUTE AS CALLER
AS
EXTERNAL NAME [PowerStatRegression].[StoredProcedures].[AboutPowerStatCorrelation]
GO

--  To Test
dbo.AboutPowerStatCorrelation
GO

grant execute on SpCreatePowerStatCorr to db_executor
GO 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T22:07:04.080

@chris 您在项目中引用了哪些其他程序集？在您的自定义程序集之前，您可能需要将一些其他程序集添加到 sql server，这就是导致该错误的原因。例如，如果您引用 Newtonsoft 之类的东西进行 JSON 解析，则需要在您的之前添加该程序集。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-10-07T11:26:15.943

当我试图加载一个针对 x86（32 位）构建的 dll 时，我刚刚遇到了这个错误——或者至少是一个非常相似的错误，但是 Sql Server 是 x64。该错误仅在尝试运行我注册的功能时显示......注册时它没有抱怨！

将构建更改为针对“任何 CPU”并重新注册程序集对我有用。

# jquery - 如何检查输入验证等于“0”且只有“0”？

> ID：11977676
> 
> 赞同：1
> 
> 时间：2012-08-15T21:33:26.290
> 
> 标签：jquery

在 jQuery 验证检查的这一部分需要帮助：

```
 if ($(this).val() == badTumblrInput && $(this).val() != "0") 
```

我需要只允许单个字符零（“0”）在表达式中有效。

此代码允许任何带有零（“0”）的东西都是有效的。

来自新手的感谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-08-15T21:35:48.237

```
if (this.value == '0') {
    //the value was zero, the character zero, and only the character zero
} 
```

[小提琴](http://jsfiddle.net/z4kBM/1/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-08-15T21:38:23.577

为什么要使用 != 如果您希望它相等。但是要回答您的问题，您应该使用`!==`或`===`取决于您要做什么。

这些是考虑类型（字符串、整数等）的精确比较运算符。例如：

```
('0' == 0) // true
(false == 0) // true
('0' === 0) // false
(false === 0) // false
('0' != 0) // false
(false != 0) // false
('0' !== 0) // true
(false !== 0) // true 
```

# objective-c - iOS POST 有时只能工作

> ID：11977681
> 
> 赞同：0
> 
> 时间：2012-08-15T21:33:40.637
> 
> 标签：objective-c

我有以下代码：

```
NSString *post = @"i hope this gets there";

NSData *postData = [post dataUsingEncoding:NSUTF8StringEncoding allowLossyConversion:NO];
NSString *postLength = [NSString stringWithFormat:@"%d", [post length]];

NSURL *url = [NSURL URLWithString:@"http://www.oneoftwosites.com"];
NSMutableURLRequest *request = [NSMutableURLRequest requestWithURL:url cachePolicy:NSURLRequestUseProtocolCachePolicy timeoutInterval:60.0];
[request setHTTPMethod:@"POST"];
[request setValue:postLength forHTTPHeaderField:@"Content-Length"];
[request setHTTPBody:postData];

[NSURLConnection connectionWithRequest:request delegate:nil];

//potential response
NSData *response = [NSURLConnection sendSynchronousRequest:request returningResponse:nil error:nil];

//convert response so that it can be LOG'd
NSString *returnString = [[NSString alloc] initWithData:response encoding:NSASCIIStringEncoding];

NSLog(@"RETURN: %@", returnString); 
```

我已经用 2 个不同的网站对其进行了测试：http: [//www.htmlcodetutorial.com/cgi-bin/mycgi.pl](http://www.htmlcodetutorial.com/cgi-bin/mycgi.pl)和[http://instagraph.me/post](http://instagraph.me/post)，将这些网址替换为`http://www.oneoftwosites.com`. 出于某种原因，它只适用于第一个网站（用 perl 编写），而不适用于第二个网站（用 .php 编写）。

有谁知道为什么会这样？它似乎很愚蠢，它有时只会起作用，但我真的不知道为什么它不适用于第二个网站（我没有看到代码，但我确实看到了一些示例输出）。

* * *

编辑：我补充说

`[request setValue:@"application/x-www-form-urlencoded" forHTTPHeaderField:@"Content-Type"];`并尝试了几种不同的类型，但仍然没有运气

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T21:40:44.247

Instagraph 期望什么样的 POST 数据？很有可能，它是某种结构化数据，例如 URL 编码形式、XML 或 JSON。你的字符串不是那些。因此，请提供`Content-Type`, 并相应地格式化您的 POST 数据。也许你会得到更好的运气。

编辑：您的第二个网站是 Instagraph。这是一个公共网站。它可能有一个记录在案的 API - POST 中应该有哪些字段和值。您发送的 POST 数据是否符合该规范？到目前为止，我不这么认为。如果您发送虚拟测试数据-您为什么期望它起作用？你期待什么合理的效果？

顺便说一句，“我希望它到达那里”这一行并不构成类型的有效数据块`application/x-www-form-urlencoded`。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-16T02:02:18.707

帖子长度应来自 postData

```
NSString *postLength = [NSString stringWithFormat:@"%d", [postData length]]; 
```

# vb.net - 具有多个聚合、总和和最大值的 Linq to SQL

> ID：11977689
> 
> 赞同：0
> 
> 时间：2012-08-15T21:34:05.247
> 
> 标签：vb.net, linq

注意更新：感谢所有的帮助，对于那些精通vb.net的人来说，这里是自包含的例子......

```
Structure Stuff
        public client as String
        public BDate as DateTime
        public KB as long
        public sub new(client as string, BDate as DateTime, KB as Long)
            Me.client = client
            Me.BDate = BDate
            Me.KB = KB
        end sub
    End Structure
Sub Main

Dim Stuffs as new List(Of Stuff)
Stuffs.Add(new Stuff("dev0db05", "6/25/2012  7:00:35 AM",1))
Stuffs.Add(new Stuff("dev0db05", "6/25/2012  7:00:35 AM",1))
Stuffs.Add(new Stuff("dev0db05", "6/25/2012  7:00:35 AM",1))
Stuffs.Add(new Stuff("dev0db05", "6/26/2012  7:00:35 AM",2))
Stuffs.Add(new Stuff("dev0db05", "6/26/2012  7:00:35 AM",2))
Stuffs.Add(new Stuff("dev0db05", "6/26/2012  7:00:35 AM",2))
Stuffs.Add(new Stuff("dev0db05", "6/27/2012  7:00:35 AM",3))
Stuffs.Add(new Stuff("dev0db05", "6/27/2012  7:00:35 AM",3))
Stuffs.Add(new Stuff("dev0db05", "6/27/2012  7:00:35 AM",3))
Stuffs.Add(new Stuff("dev0db05", "6/28/2012  7:00:35 AM",4))
Stuffs.Add(new Stuff("dev0db05", "6/28/2012  7:00:35 AM",4))
Stuffs.Add(new Stuff("dev0db05", "6/28/2012  7:00:35 AM",4))

dim q = From c In Stuffs _
  where c.client= "dev0db05" _
  order by c.BDate _
  group c by c.Client,c.bdate into g = group _
  select ClientName = Client, BDate = DateTime.Parse(bdate).ToShortDateString, SumKB = g.sum(Function(p) p.kb)

Output:
ClientName BDate SumKB 
dev0db05 6/25/2012 3 
dev0db05 6/26/2012 6 
dev0db05 6/27/2012 9 
dev0db05 6/28/2012 12 
```

所以在这个例子中，我只想为dev0db05返回最高的SumKB（12）我知道我必须做一个MAX但不知道如何反对上述......谢谢，可能太简单了，但我在失利 ...

对于下面的 Linq 查询，如何只返回最大值，即 259835919？谢谢！我是一个新手，并试图理解。

```
dim q = From c In Stuff _
where c.client= "dev0db05" _
where c.policy = "mcg-oracle-db" _
order by c.BackupDate _
group c by key = 0, c.Client,c.backupdate into g = group _
select ClientName = Client, BDate = DateTime.Parse(backupdate).ToShortDateString, SumKB = g.sum(Function(p) p.kilobytes) 
```

返回：

```
dev0db05    5/20/2012   163160396
dev0db05    5/27/2012   235918153
dev0db05    6/3/2012    259813647
dev0db05    6/10/2012   259835151
dev0db05    6/13/2012   23824838
dev0db05    6/14/2012   259578160
dev0db05    6/15/2012   23864427
dev0db05    6/16/2012   259578127
**dev0db05  6/17/2012   259835919**
dev0db05    6/18/2012   23858283
dev0db05    6/19/2012   259575055
dev0db05    6/20/2012   33412 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-16T21:01:53.917

好的，以下是解决方案。这是最有效的方法吗？

```
Structure Stuff
  public client as String
  public BackupDate as DateTime
  public Kilobytes as double
  public sub new(client as string, BackupDate as DateTime, Kilobytes as double)
  Me.client = client
  Me.BackupDate = BackupDate
  Me.Kilobytes = Kilobytes
  end sub
End Structure

Sub Main
Dim Stuffs as new list(Of Stuff)
Stuffs.Add(new Stuff("dev0db05", "6/25/2012  7:00:35 AM",1))
Stuffs.Add(new Stuff("dev0db05", "6/25/2012  7:00:35 AM",1))
Stuffs.Add(new Stuff("dev0db05", "6/25/2012  7:00:35 AM",1))
Stuffs.Add(new Stuff("dev0db05", "6/26/2012  7:00:35 AM",2))
Stuffs.Add(new Stuff("dev0db05", "6/26/2012  7:00:35 AM",2))
Stuffs.Add(new Stuff("dev0db05", "6/26/2012  7:00:35 AM",2))
Stuffs.Add(new Stuff("dev0db06", "6/27/2012  7:00:35 AM",3))
Stuffs.Add(new Stuff("dev0db06", "6/27/2012  7:00:35 AM",3))
Stuffs.Add(new Stuff("dev0db06", "6/27/2012  7:00:35 AM",3))
Stuffs.Add(new Stuff("dev0db06", "6/28/2012  7:00:35 AM",4))
Stuffs.Add(new Stuff("dev0db06", "6/28/2012  7:00:35 AM",4))
Stuffs.Add(new Stuff("dev0db06", "6/28/2012  7:00:35 AM",4))
Stuffs.Add(new Stuff("dev0db09", "6/27/2012  7:00:35 AM",5))
Stuffs.Add(new Stuff("dev0db09", "6/27/2012  7:00:35 AM",5))
Stuffs.Add(new Stuff("dev0db09", "6/27/2012  7:00:35 AM",5))
Stuffs.Add(new Stuff("dev0db03", "6/28/2012  7:00:35 AM",6))
Stuffs.Add(new Stuff("dev0db03", "6/28/2012  7:00:35 AM",6))
Stuffs.Add(new Stuff("dev0db03", "6/28/2012  7:00:35 AM",6))

dim jj = From t1 In ((From t0 In Stuffs _
  Group t0 By t0.Client,t0.BackupDate Into g = Group  _
  Select SumKB = CType(g.Sum(Function(p) p.Kilobytes),long?),Client,BDate = CStr(CDate(BackupDate)))) _
where t1.client = "dev0db05" _
Group t1 By t1.Client Into g = Group  _
Select Client, MaxKB = CType(g.Max(Function(p) p.SumKB),long?) 
```

为 dev0db05 返回 6

# c# - CustomValidator 问题和丢失 TextBox 数据

> ID：11977690
> 
> 赞同：1
> 
> 时间：2012-08-15T21:34:06.070
> 
> 标签：c#, asp.net, validationsummary

我的页面是一个注册页面，用户在其中输入用户名、电子邮件地址和密码。这是我背后的代码：

```
protected void Page_Load(object sender, EventArgs e)
{
}

protected void btnRegister_Click(object sender, EventArgs e)
{
    if (!Page.IsValid)
        return;
}

protected void cvEmail_ServerValidate(object source, ServerValidateEventArgs args)
{
    args.IsValid = false;
} 
```

这是我的页面：

```
<asp:ValidationSummary ID="vs" runat="server" />

<asp:TextBox ID="txtUsername" runat="server" />
<asp:TextBox ID="txtEmail" runat="server" />
<asp:TextBox ID="txtPassword" runat="server" TextMode="Password" />

<asp:Button ID="btnRegister" runat="server" OnClick="btnRegister_Click" />

<asp:CustomValidator ID="cvEmail" runat="server" ControlToValidate="txtEmail" 
    OnServerValidate="cvEmail_ServerValidate"
    ErrorMessage="Invalid Email" /> 
```

所以问题是，如果自定义验证器失败，当页面重新加载我的错误消息时，我的文本框是空的。但奇怪的是，如果我检查 Firebug 中的文本框元素，`value`设置的`input`，它只是由于某种原因没有显示在页面上。

我尝试`EnableViewState`在文本框和页面上设置为 true，但这没有帮助。

有人知道我在做什么错吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-20T21:00:19.267

您是否打开了 JavaScript 验证？或者任何其他涉及这些领域的 JavaScript？

如果您在页面标记中看到它，但它没有显示在浏览器中，那么在页面加载后某些东西正在改变它们。可能是Javascript。

这也将支持问题评论中发布的发现，即相同的代码在另一个项目中工作（在页面上不共享相同的 JavaScript）。

# css - Wordpress 上的 Internet Explorer CSS 问题

> ID：11977695
> 
> 赞同：0
> 
> 时间：2012-08-15T21:34:22.407
> 
> 标签：css, wordpress, internet-explorer

此页面在 Opera、Firefox 和 Chrome 中看起来不错：

[http://pt.drpedrocoelho.com/contactos](http://pt.drpedrocoelho.com/contactos)

但是在 IE 中尝试一下，它会显示上面的地图和下面的表格（grrr ...）。

有没有办法解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T21:38:32.343

遵循 W3C 约定[http://validator.w3.org/](http://validator.w3.org/) 您也可以安装 w3c 的 firefox 插件以获得支持

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-16T00:34:50.643

快速简便的解决方法是浮动：右移地图 iframe 所在的段落标签。

# ruby - 在 Eclipse 中运行 bundle exec

> ID：11977699
> 
> 赞同：1
> 
> 时间：2012-08-15T21:34:45.683
> 
> 标签：ruby, eclipse, exec, bundler, watir-webdriver

谁能帮助我在 Eclipse IDE 中运行 bundle exec 的步骤。这是我试图通过 eclipse 执行的命令

```
bundle exec rspec -I . spec/test_run_202_spec.rb 
```

但我目前收到错误消息，说明当我使用外部工具配置启动上述命令时

```
tput: No value for $TERM and no -T specified
tput: No value for $TERM and no -T specified
ERROR: Gem bundler is not installed, run 'gem install bundler' first. 
```

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2014-07-25T09:10:52.993

这是颜色支持的问题。

某些应用程序需要特定的 TERM 设置来支持颜色。

我在eclipse中由编译器调用的bash脚本有一个类似的问题。
我在此[**链接**](http://www.linuxfromscratch.org/blfs/view/6.1/postlfs/profile.html)中找到了更多信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-15T22:54:14.987

我想你需要先安装一个 ruby​​ devkit，然后再安装 bundler。在此处尝试以下步骤：[https ://github.com/oneclick/rubyinstaller/wiki/Development-Kit](https://github.com/oneclick/rubyinstaller/wiki/Development-Kit)

# ruby-on-rails - 将 Add 方法添加到 ActiveRecord 数组

> ID：11977701
> 
> 赞同：5
> 
> 时间：2012-08-15T21:34:52.360
> 
> 标签：ruby-on-rails, ruby, activerecord

我有模型类别和产品。如果我使用`category.products << new_product`该项目，则会将其添加到数组中，并将记录保存到数据库中。我尝试将以下“add”方法添加到数组类中，虽然它确实将 new_product 添加到数组中，但它不会将其保存到数据库中。这是为什么？

```
class Array
  def add(item)
    self << item
  end
end 
```

**更新：**

collection_proxy.rb 有以下方法：

```
def <<(*records)
  proxy_association.concat(records) && self
end
alias_method :push, :<< 
```

因此，以下扩展有效：

```
class ActiveRecord::Relation
  def add(*records)
    proxy_association.concat(records) && self
  end
end 
```

**解决方案：**

为 CollectionProxy 添加别名：

```
class ActiveRecord::Associations::CollectionProxy
  alias_method :add, :<<
end 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-16T04:11:01.460

**编辑：** Manuel 找到了更好的解决方案

```
class ActiveRecord::Associations::CollectionProxy
  alias_method :add, :<<
end 
```

**原始解决方案：**

这应该让你开始。这并不完美。

```
class ActiveRecord::Relation
  def add(attrs)
    create attrs
  end
end 
```

我没有使用您的模型名称启动一个新的 rails 项目，而是使用了一个用于以下示例的项目：

```
1.9.3p194 :006 > Artist.create(:first_name => "Kyle", :last_name => "G", :email => "foo@bar.com")
 => #<Artist id: 5, first_name: "Kyle", last_name: "G", nickname: nil, email: "foo@bar.com", created_at: "2012-08-16 04:08:30", updated_at: "2012-08-16 04:08:30", profile_image_id: nil, active: true, bio: nil> 
1.9.3p194 :007 > Artist.first.posts.count
 => 0 
1.9.3p194 :008 > Artist.first.posts.add :title => "Foo", :body => "Bar"
 => #<Post id: 12, title: "Foo", body: "Bar", artist_id: 5, created_at: "2012-08-16 04:08:48", updated_at: "2012-08-16 04:08:48"> 
1.9.3p194 :009 > Artist.first.posts.count
 => 1 
```

# iphone - 增强现实室内

> ID：11977702
> 
> 赞同：1
> 
> 时间：2012-08-15T21:34:53.953
> 
> 标签：iphone, objective-c, ios, augmented-reality

我正在寻找一个增强现实 iphone 应用程序，用户可以在其中从一个固定点扫描房间。因此，可能在室内，因为我没有使用 CLLocationManager 和数字 GPS。

但是，我遇到了重大问题。不知何故，兴趣点气泡不断改变它们在 iPhone 屏幕上的位置，即使我没有移动。再一次，我没有使用数字 GPS。我以以下方式使用 CMMotionManager。

```
[motionManager startDeviceMotionUpdatesUsingReferenceFrame: CMAttitudeReferenceFrameXTrueNorthZVertical]; 
```

有人能解释一下使用 CMMotionManager 类会如何导致我的兴趣点波动吗？并提供可能的解决方案？谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T21:44:57.600

CoreMotion 框架使用陀螺仪来提供设备运动更新，并且陀螺仪会随时间漂移。此外，当您告诉框架使用`CMAttitudeReferenceFrameXTrueNorthZVertical`时，您是在说您想使用磁力计偶尔更新陀螺仪的参考系，以使其与现实世界的参考系保持同步。设备上的指南针可能会受到干扰，仅偶尔用于校正漂移。

不幸的是，唯一能做的就是等待并希望 Apple 神奇地改进框架的内部结构。

# android - 如何实现无缝播放（API 7+）

> ID：11977715
> 
> 赞同：2
> 
> 时间：2012-08-15T21:35:51.530
> 
> 标签：android, media-player

谁能推荐一种实现无间隙音乐播放的方法（例如，加载 2 个文件并且文件之间没有间隙 - API7+）？（我目前正在考虑使用 InputStream 或其他东西）

早在 2012 年就有人问过这样的问题： [请参阅此处的问题](https://stackoverflow.com/questions/3992621/android-gapless-playback-of-a-looped-audio-file-in-mediaplayer)

几年前我看到了一些播放文件的东西： [link here（关于流媒体）](http://blog.infidian.com/2009/12/27/android-streaming-mediaplayer-tutorial-updated-to-v1-5-cupcake/)

感谢您的任何想法。

# javascript - JavaScript 中的原型继承......我可以称之为“超级”等价物吗？

> ID：11977718
> 
> 赞同：2
> 
> 时间：2012-08-15T21:36:14.193
> 
> 标签：javascript, inheritance, prototype

我正在使用原型继承在 javascript 中构建一个面向对象的库。与 Java 和 .NET 类似，我的所有对象/原型都将继承“对象”对象/原型。我想知道是否可以从派生函数中调用超级对象/原型函数？

考虑以下代码示例：

```
function Object() {
    this.DoAction = function() {
    };
};

function CustomObject() {
    this.DoAction = function() {
        super.DoAction();    //How do I do this in JavaScript?
    };
}; 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-08-25T07:52:40.723

JavaScript 没有`super`.

一种解决方法可能是在覆盖之前将方法保存在原型上，例如：

```
function CustomObject() {
    this._super_DoAction = this.DoAction;
    this.DoAction = function() {
        this._super_DoAction(); 
    };
}; 
```

如果您能够使用 ES5 功能，您可以使用`Object.getPrototypeOf`从原型中获取方法，然后`apply`使用当前对象执行它`this`：

```
function CustomObject(){
    this.DoAction=function() {
        Object.getPrototypeOf(this).DoAction.apply(this, []);
    };
} 
```

# maven - 将 xom 添加到 Maven 项目时出现问题

> ID：11977720
> 
> 赞同：0
> 
> 时间：2012-08-15T21:36:14.450
> 
> 标签：maven, xom

我正在尝试在 Maven 项目 中使用[xom ，但出现错误](http://www.xom.nu/)`Description Resource Path Location Type ArtifactDescriptorException: Failed to read artifact descriptor for xom:xom:jar:1.2.5: ArtifactResolutionException: Failure to transfer xom:xom:pom:1.2.5 from [http://repo2.maven.org/maven2](http://repo2.maven.org/maven2) was cached in the local repository, resolution will not be reattempted until the update interval of repo2_maven_org has elapsed or updates are forced. Original error: Could not transfer artifact xom:xom:pom:1.2.5 from/to repo2_maven_org (http://repo2.maven.org/maven2): null to [http://repo2.maven.org/maven2/xom/xom/1.2.5/xom-1.2.5.pom](http://repo2.maven.org/maven2/xom/xom/1.2.5/xom-1.2.5.pom) pom.xml /tahrir line 1 Maven Dependency Problem`

我的`pom.xml`样子

```
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd">
<modelVersion>4.0.0</modelVersion>
<groupId>tahrirproject</groupId>
<artifactId>tahrir</artifactId>
<version>0.0.1-SNAPSHOT</version>
<properties>
    <project.build.mainClass>tahrir.TrMain</project.build.mainClass>
    <!-- I need to explicitly specify encoding to avoid non-standard, like was GBK or GB18030\. Because I live in China. -->
<project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
</properties>
<resources>
    <resource>
        <directory>src/main/resources</directory>
    </resource>
</resources>
<pluginRepositories>
    <pluginRepository>
        <id>codehaus-snapshots</id>
        <url>http://nexus.codehaus.org/snapshots</url>
        <snapshots>
            <enabled>true</enabled>
        </snapshots>
        <releases>
            <enabled>false</enabled>
        </releases>
    </pluginRepository>
</pluginRepositories>
<build>
    <plugins>
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-compiler-plugin</artifactId>
            <version>2.3.2</version>
            <configuration>
                <source>1.6</source>
                <target>1.6</target>
            </configuration>
        </plugin>
        <plugin>
            <artifactId>maven-assembly-plugin</artifactId>
            <version>2.2.1</version>
            <configuration>
                <descriptorRefs>
                    <descriptorRef>jar-with-dependencies</descriptorRef>
                </descriptorRefs>
                <archive>
                    <manifest>
                        <mainClass>tahrir.TrMain</mainClass>
                    </manifest>
                </archive>
            </configuration>
            <executions>
                <execution>
                    <id>make-assembly</id>
                    <phase>package</phase> <!-- bind to the packaging phase -->
                    <goals>
                        <goal>single</goal>
                    </goals>
                </execution>
            </executions>
        </plugin>
        <!-- Proguard setup, see http://blog.boxofrats.com/2009/08/07/setting-up-maven-for-scala-and-proguard/ -->
        <plugin>
            <groupId>com.pyx4me</groupId>
            <artifactId>proguard-maven-plugin</artifactId>
            <version>2.0.4</version>
            <executions>
                <execution>
                    <phase>package</phase>
                    <goals>
                        <goal>proguard</goal>
                    </goals>
                </execution>
            </executions>
            <configuration>
                <options>
                    <option>-allowaccessmodification</option>
                    <option>-keep public class ${project.build.mainClass} { public
                        static void main(java.lang.String[]);}</option>
                    <option>-dontwarn</option>
                    <option>-dontskipnonpubliclibraryclasses</option>
                    <option>-dontskipnonpubliclibraryclassmembers</option>
                </options>
                <includeDependency>false</includeDependency>
                <injar>${project.build.finalName}-jar-with-dependencies.jar</injar>
                <outjar>${project.build.finalName}-shrunk.jar</outjar>
                <libs>
                    <!-- WARNING: This is required on OSX, will need to be adjusted for 
                        other platforms because these jar files are in a different location -->
                    <lib>${java.home}/../Classes/classes.jar</lib>
                    <lib>${java.home}/../Classes/jce.jar</lib>
                </libs>
            </configuration>
        </plugin>
    </plugins>
</build>
<repositories>
    <repository>
        <id>repo2_maven_org</id>
        <url>http://repo2.maven.org/maven2</url>
    </repository>
    <repository>
        <id>doodleproject-repo</id>
        <name>DoodleProject Maven 2 Repository</name>
        <url>http://doodleproject.sourceforge.net/maven2/release</url>
    </repository>
</repositories>
<dependencies>
    <dependency>
        <groupId>net.sf.doodleproject</groupId>
        <artifactId>numerics4j</artifactId>
        <version>1.3</version>
    </dependency>
    <dependency>
        <groupId>com.google.code.gson</groupId>
        <artifactId>gson</artifactId>
        <version>1.4</version>
        <type>jar</type>
        <scope>compile</scope>
    </dependency>
    <dependency>
        <groupId>args4j</groupId>
        <artifactId>args4j</artifactId>
        <version>2.0.9</version>
    </dependency>
    <dependency>
        <groupId>org.testng</groupId>
        <artifactId>testng</artifactId>
        <version>5.14</version>
        <scope>test</scope>
    </dependency>
    <dependency>
        <groupId>bouncycastle</groupId>
        <artifactId>bcprov-jdk16</artifactId>
        <version>140</version>
        <type>jar</type>
        <scope>compile</scope>
    </dependency>
    <dependency>
        <groupId>com.google.guava</groupId>
        <artifactId>guava</artifactId>
        <version>13.0</version>
        <type>jar</type>
        <scope>compile</scope>
    </dependency>
    <dependency>
        <groupId>ch.qos.logback</groupId>
        <artifactId>logback-classic</artifactId>
        <version>0.9.28</version>
    </dependency>
    <dependency>
        <groupId>com.miglayout</groupId>
        <artifactId>miglayout</artifactId>
        <version>3.7.4</version>
    </dependency>
    <dependency>
        <groupId>org.datanucleus</groupId>
        <artifactId>datanucleus-db4o</artifactId>
        <version>3.0.0-m3</version>
        <type>jar</type>
        <scope>compile</scope>
    </dependency>
    <dependency>
        <groupId>joda-time</groupId>
        <artifactId>joda-time</artifactId>
        <version>1.6.2</version>
        <type>jar</type>
        <scope>compile</scope>
    </dependency>
    <dependency>
        <groupId>com.google.inject</groupId>
        <artifactId>guice</artifactId>
        <version>3.0</version>
    </dependency>
    <dependency>
        <groupId>com.seaglasslookandfeel</groupId>
        <artifactId>seaglasslookandfeel</artifactId>
        <version>0.2</version>
    </dependency>
    <dependency>
        <groupId>xom</groupId>
        <artifactId>xom</artifactId>
        <version>1.2.5</version>
    </dependency>
</dependencies> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T22:29:56.167

通过清除`.m2/rerepository`文件夹并从头开始重新构建项目来解决问题。

# php - 数组 php 中的 if 语句

> ID：11977721
> 
> 赞同：0
> 
> 时间：2012-08-15T21:36:29.090
> 
> 标签：php, arrays

你可以在“数组”函数中有一个“if”语句吗？

```
 $my_array = array(
    'foo' => $foo,
    'bar' => 'bar',
    'lorem' => $lorem,
    if($z == 'z'){ 'ipsum' => $ipsum }
); 
```

我的问题当然与第 5 行有关，即数组中的第 4 项。它似乎不想工作，有没有更好的方法呢？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-08-15T21:38:26.740

你不能那样做。只需在`if`后面添加语句。

```
$my_array = array(
    'foo' => $foo,
    'bar' => 'bar',
    'lorem' => $lorem
);

if($z == 'z'){
    $my_array['ipsum'] = $ipsum;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T21:40:15.960

您可以使用三元运算符：

```
$my_array = array(
    'foo' => $foo,
    'bar' => 'bar',
    'lorem' => $lorem,
    'ipsum' => ($z == 'z') ? $ipsum : null
); 
```

这会给你一个数组元素等于`null`如果比较是`false`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T21:38:29.973

我认为您不能将 if 语句放在数组初始化中，但您可以执行以下操作：

```
$my_array = array(
    'foo' => $foo,
    'bar' => 'bar',
    'lorem' => $lorem,
);
if($z == 'z'){ $my_array['ipsum'] = $ipsum; } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-08-15T21:42:09.187

您可以使用 if 语句的简短版本来做到这一点：

```
$my_array = array(
    'foo' => $foo,
    'bar' => 'bar',
    'lorem' => $lorem,
    'ipsum' => $z == 'z' ? $ipsum : null
); 
```

# eclipse - Eclipse indigo 3.7.2 java/flex 4.6 项目远程对象默认不工作？

> ID：11977722
> 
> 赞同：0
> 
> 时间：2012-08-15T21:36:33.453
> 
> 标签：eclipse, actionscript-3, jakarta-ee, apache-flex, flex4.6

我在 eclipse indigo 3.7.2 x32 上安装了 flash builder 4.6 插件（无法在 juno 上安装 flash builder），并在本地主机上测试的 jboss 7.1 服务器上部署为耳朵。

因此，在使用 WTP 创建一个新的 flex/java 项目之后，对于远程对象“Java EE 4.6 的服务 ADEP 数据服务”数据服务 war 文件，默认情况下，我在刚刚创建的干净项目上调用的任何远程对象都会给我一个“Client. Error.MessageSend 发送失败”弹出窗口，控制台上没有跟踪堆栈或任何错误提示...

MXML

```
<s:RemoteObject
        id="testRO"
        destination="test"
        fault="loginRO_faultHandler(event)"
        result="loginRO_resultHandler(event)"/> 
```

远程配置.xml

```
<service id="remoting-service" 
class="flex.messaging.services.RemotingService">

<adapters>
    <adapter-definition id="java-object" class="flex.messaging.services.remoting.adapters.JavaAdapter" default="true"/>
</adapters>

<default-channels>
    <channel ref="my-amf"/>
</default-channels>
<destination id="test">
    <properties>
        <source>architecture.controller.TestCon</source>
        <scope>application</scope>
    </properties>
</destination> 
```

TestCon.java

```
package architecture.controller;

import com.sun.istack.internal.logging.Logger;

public class TestCon {
    private static Logger logger = Logger.getLogger(TestCon.class);
    public void test(){
        logger.info("testing");
    }
} 
```

还尝试了 lcds 3.1 和一些建议导入 war 文件然后将项目类型添加/更改为 Flex 项目的 pdf 步骤，但没有任何运气。

我在同一台服务器上部署了在 flash builder 4.0 中制作的其他项目，与远程对象通信工作得很好。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-16T16:03:05.850

解决了......原来我已经导入了**com.sun.istack.internal.logging.Logger**而不是**org.apache.log4j.Logger**。

我想这里真正的问题是误导性错误消息和控制台没有显示跟踪堆栈。

# python - 如何验证对 Windows Azure 的管理服务请求？

> ID：11977725
> 
> 赞同：0
> 
> 时间：2012-08-15T21:36:44.117
> 
> 标签：python, ssl, azure, ssl-certificate

我正在尝试通过 Python 向 Azure 发出请求以列出我拥有的存储服务。

我的基本代码是这样的：

```
import httplib
conn = httplib.HTTPSConnection('management.core.windows.net')
conn.request('GET', '/[subscription id]/services/storageservices/')
response = conn.getresponse()
print response.status response.reason 
```

显然，因为我没有进行身份验证，所以打印出来`403 Forbidden`

所以，我按照[http://msdn.microsoft.com/en-us/library/windowsazure/gg651127](http://msdn.microsoft.com/en-us/library/windowsazure/gg651127)上的说明创建了一个证书，给了我`cert.cer`. 我将我上传`.cer`到我的 Azure 帐户并将其复制`.cer`到我正在使用 Python 的 Linux VM。我将我的代码修改为：

```
import httplib
cert_file = '/path/to/cert.cer'
conn = httplib.HTTPSConnection('management.core.windows.net', cert_file = cert_file)
conn.request('GET', '/[subscription id]/services/storageservices/') 
```

并得到错误：

```
ssl.SSLError: [Errno 336265225] _ssl.c:351: error:140B0009:SSL routines:SSL_CTX_use_PrivateKey_file:PEM lib 
```

给人的印象可能是因为我试图使用`.cer`证书而不是.pem 和 .cer 之间[的](https://serverfault.com/questions/9708/what-is-a-pem-file-and-how-does-it-differ-from-other-openssl-generated-key-file)区别*（它们是相同的东西，但扩展名不同）*`.pem`，我只是将我的 .cer 上的扩展名更改为 .pem 并再次尝试，得到相同的错误。

 *如何正确地向 Azure 验证自己以访问其 API？这是我如何上传证书的问题，还是我需要对证书做一些事情以使其适合呈现给服务器？在 Windows 上，我似乎可以将其安装`.cer`到某种证书存储中 - 在 Linux 中是否有一个等效项，我需要在使用它进行身份验证之前从中检索证书？感谢您的帮助 =)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-08-15T22:31:01.623

这是一些有效的 Python 代码，但正如您所指出的，诀窍是获取正确的 PEM 文件：

```
import httplib

conn = httplib.HTTPSConnection('management.core.windows.net', cert_file='cert.pem', key_file='key.pem')
conn.request('GET', '/%s/services/storageservices' % subscription_id, headers={'x-ms-version': '2011-02-25'})
print conn.getresponse().read() 
```

我从[https://github.com/smarx/waz-cmd](https://github.com/smarx/waz-cmd)获得了我的 PEM 文件，这是我编写的一个基于 Ruby 的命令行工具，用于与服务管理 API 交互。请注意，您需要两个部分（ the`cert_file`和 the `key_file`）。

您已经拥有证书文件，但我认为您实际上可能需要通过类似`openssl`PEM 格式的方式将其转换。对于密钥文件，我认为您需要导出在 Windows 机器上创建的证书，然后用于`openssl`将私钥导出为 PEM 文件。

如今，您可以从 Windows Azure 门户下载文件，而不是创建自己的证书，`.publishsettings`该门户会生成并为您提供准备就绪的证书。请参阅[http://blog.smarx.com/posts/calling-the-windows-azure-service-management-api-with-the-new-publishsettings-file](http://blog.smarx.com/posts/calling-the-windows-azure-service-management-api-with-the-new-publishsettings-file)。那里的证书是 PFX 格式的，但正确的`openssl`魔法应该会给你你需要的两件。我实际上曾经解决过这个问题（用于`curl`在 Mac 上使用），但我不再手头有确切的命令。:-(我*可能*会试一试，今晚写一篇关于它的博客文章。

**编辑**：

这是一个完整的 Python 程序，它`.publishsettings`在命令行上获取一个文件，将密钥和证书转储到当前目录中的单个文件 (cert.pem) 中，然后使用它调用服务管理 API 并打印所有名称您的存储帐户。在运行之前，只需`pip install lxml pyopenssl`.

```
import httplib
import argparse
from StringIO import StringIO
from lxml import etree
import base64
from OpenSSL.crypto import *

parser = argparse.ArgumentParser()
parser.add_argument('file', metavar='file', type=str, help='Your .publishsettings file.')
args = parser.parse_args()

tree = etree.parse(args.file)
pp = tree.find('PublishProfile')
cert = load_pkcs12(base64.decodestring(pp.get('ManagementCertificate')))
with open('cert.pem', 'w') as f:
    f.write(dump_certificate(FILETYPE_PEM, cert.get_certificate()))
    f.write(dump_privatekey(FILETYPE_PEM, cert.get_privatekey()))
subscription_id = pp.find('Subscription').get('Id')

conn = httplib.HTTPSConnection('management.core.windows.net', cert_file='cert.pem')
conn.request('GET', '/%s/services/storageservices' % subscription_id, headers={'x-ms-version': '2011-02-25'})
for e in etree.parse(StringIO(conn.getresponse().read())).iterfind('//{http://schemas.microsoft.com/windowsazure}ServiceName'): print e.text 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-21T23:31:21.580

这就是我如何将在我的问题中创建的证书转换为我可以用来验证我对 Azure 服务管理 API 的请求的格式。Smarx 的答案也有效，实际上我使用了他的技术创建的证书，涉及`.publishsettings`文件来确定我转换后的证书的外观。

通过打开 Visual Studio 命令提示符并键入以下内容来创建您的证书：

```
makecert -r -pe -a sha1 -n "CN=My Azure Management Certificate" -ss My -len 2048 -sp   
"Microsoft Enhanced RSA and AES Cryptographic Provider" -sy 24 myazuremanagementcert.cer 
```

按照[http://msdn.microsoft.com/en-us/library/windowsazure/gg651127](http://msdn.microsoft.com/en-us/library/windowsazure/gg651127)的指示。

`certmgr.msc`然后，通过在搜索框中键入来打开证书管理器。我在`Certificates - Current User/Personal/Certificates`.

右键单击证书，转到“所有任务”，然后单击“导出”。出现提示时，确保选择“是，导出私钥”并将文件导出为 .PFX (PKCS#12)。

在这里，我将我的 .PFX 移至 Linux VM。

[从这里开始的所有内容都遵循http://blog.scottlowe.org/2005/12/02/certificate-conversion-using-openssl/](http://blog.scottlowe.org/2005/12/02/certificate-conversion-using-openssl/)中列出的步骤

打开终端，输入：

```
openssl pkcs12 -in pfxfilename.pfx -out tempfile.pem 
```

这将提示您输入用于加密 .pfx 的密码和用于加密 .pem 的新密码。*请勿将此密码留空！我做了并且很困惑，因为密钥不仅被解密，而且根本没有包含在新的 .pem 中*

将新 .pem 中的密钥和证书分成两个不同的文件，删除除行之外的所有多余`----begin/end cert/key----`行。

通过键入以下内容来解密密钥：

```
openssl rsa -in encryptedkey -out decryptedkey 
```

并且，重新组合密钥和证书：

```
cat decryptedkey certificatefile > finalfile.pem 
```

现在，此证书应正确验证对 Azure 的服务管理请求：

```
import httplib
sub_id = [subid]
conn = httplib.HTTPSConnection('management.core.windows.net', cert_file = 'finalfile.pem')
conn.request('GET', '/%s/services/storageservices' % sub_id, headers = {'x-ms-versiojn':'2012-03-01'})

response = conn.getresponse()
print reponse.status response.reason 
```*

# python - 动态改变 Celery Beat 设置

> ID：11977726
> 
> 赞同：8
> 
> 时间：2012-08-15T21:36:47.007
> 
> 标签：python, scheduled-tasks, celery, celerybeat

有没有办法告诉 celerybeat 在运行时更改特定任务的设置？

这个例子最好地说明了它的实用性：

我有一个定期任务，每 30 秒检查一次值。有时，基于外部触发器（我无法预测），我希望此任务将轮询频率提高到 10 秒 - 持续几分钟。

这是否以可管理的方式可行？我知道我可以更改任务配置并重新加载芹菜，但这似乎是一种混乱的做事方式......

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2013-02-15T17:53:42.963

在 schedules.py 模块上，您会发现：

```
class schedule(object):

    def is_due(self, last_run_at):
        """Returns tuple of two items `(is_due, next_time_to_run)`,
        where next time to run is in seconds.

        e.g.

        * `(True, 20)`, means the task should be run now, and the next
            time to run is in 20 seconds.

        * `(False, 12)`, means the task should be run in 12 seconds.

        You can override this to decide the interval at runtime,
        but keep in mind the value of :setting:`CELERYBEAT_MAX_LOOP_INTERVAL`,
        which decides the maximum number of seconds celerybeat can sleep
        between re-checking the periodic task intervals.  So if you
        dynamically change the next run at value, and the max interval is
        set to 5 minutes, it will take 5 minutes for the change to take
        effect, so you may consider lowering the value of
        :setting:`CELERYBEAT_MAX_LOOP_INTERVAL` if responsiveness is of
        importance to you.

        .. admonition:: Scheduler max interval variance

        The default max loop interval may vary for different schedulers.
        For the default scheduler the value is 5 minutes, but for e.g.
        the django-celery database scheduler the value is 5 seconds.

        """
        last_run_at = self.maybe_make_aware(last_run_at)
        rem_delta = self.remaining_estimate(last_run_at)
        rem = timedelta_seconds(rem_delta)
        if rem == 0:
            return True, self.seconds
        return False, rem 
```

因此，您可以覆盖 is_due 方法来设置您自己的时间增量。

# ruby-on-rails - 如何在 Rails 2 中设置受保护的变量

> ID：11977727
> 
> 赞同：1
> 
> 时间：2012-08-15T21:36:47.930
> 
> 标签：ruby-on-rails, security

我努力表现得很好，并确保我所有的模型都设置为防止大规模分配。我的用户类有一个受保护的管理标志。

那么设置它的最佳方法是什么？我看到的所有谈论大规模分配的恐怖的博客和 RailsCasts 似乎都掩盖了这一部分。

作为典型（我认为？）我将我的控制器设置为`update_attributes`用作条件来确定更新是否有效以及要显示哪个闪存消息：

```
if @user.update_attributes(params[:user]) 
```

那么我什么时候设置管理员标志呢？ `update_attributes`不占用块（至少在 Rails 2 中不是）所以我不能在那里设置它。

我正在考虑将其设置并保存在`update_attributes`条件的成功块中。对于一个简单的管理员布尔值来说，这一切都很好。需要实际验证的东西呢？然后，您是否需要另一个 if/else 块来处理该保存失败？

您是否应该在调用之前设置它`update_attributes`并保存条件的部分？

```
if @user.save && @user.update_attributes(params[:user]) 
```

因为这对我来说有点味道。

尽管我不喜欢[DHH](https://gist.github.com/1975644)摆脱批量分配保护并使用 slice 的想法，但它似乎为我解决了这个问题。

还是我做错了？

# ruby-on-rails - Rails - 部署战争后添加资产和语言文件

> ID：11977729
> 
> 赞同：1
> 
> 时间：2012-08-15T21:36:54.153
> 
> 标签：ruby-on-rails, ruby, ruby-on-rails-3, asset-pipeline, war

我有一个 Rails（带有资产管道的 3.1.3）应用程序，它将被部署为战争。这个应用程序有 ui “主题”。在内部，我在 Rails 应用程序的 assets 目录中只有 .scss 文件（Sass），我让用户在它们之间切换。

我想允许管理员在应用程序部署为战争后向应用程序添加主题（基本上是 .scss 文件）。我怎样才能允许功能而不需要重建/重新编译战争（使用莺）。理想情况下，他们可以添加主题，而无需对 war 文件做任何事情。

我对语言文件也有类似的担忧。有人如何动态地将语言文件添加到已部署的 Rails 应用程序中？

我目前正在生产中预编译资产，即使用 Sass 编写的主题，但如果它有助于解决这个问题，我愿意改变它。我可以在战争之外预编译资产吗？是否可以将资产管道的路径设置到战争之外？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-21T19:52:39.353

Reading about Warbler seems like there's no easy workaround, have the app serve new themes and languages via database

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T22:26:57.783

这就是我想到的。

您必须使用一些 tomcat-apache-httpd 组合

我的建议是预编译文件并让 apache 提供静态内容，不要将其添加到战争中。

一旦你觉得文件的内容需要改变，再次用最新的内容预编译并在服务器上替换它。它不应该要求重新部署战争

您需要进行一些服务器配置以从 Apache 提供静态内容，并让其他调用转到 tomcat。

预编译资产复制公共资产目录并存储在其他地方，并将 apache 配置为`/assets`从该目录中的所有服务器

检查如何配置`mod_jk`以从 apache 提供静态资产

[http://tomcat.apache.org/connectors-doc/webserver_howto/apache.html](http://tomcat.apache.org/connectors-doc/webserver_howto/apache.html) 检查**配置 Apache 以提供静态 Web 应用程序文件**部分

使用`proxypass`

[https://serverfault.com/questions/379667/apache-proxypass-ignore-static-files](https://serverfault.com/questions/379667/apache-proxypass-ignore-static-files)

[https://serverfault.com/questions/156391/what-is-an-ideal-apache-tomcat-setup-with-apache-serving-static-assets](https://serverfault.com/questions/156391/what-is-an-ideal-apache-tomcat-setup-with-apache-serving-static-assets)

[https://www.apachelounge.com/viewtopic.php?t=3907](https://www.apachelounge.com/viewtopic.php?t=3907)

关于语言文件，如果它们位于资产之外，那么我认为@pito 建议尝试使用一些数据库。

或者，如果文件需要由某个管理员更新，则可以使用相同的缓存技术通过从其他服务器调用它并重新加载文件缓存来缓存整个文件。

任何代码更改都需要重新编译。

你可以在解压后直接在 WEPAPPS 解压目录中添加文件更改文件并重新启动 tomcat，但我认为这对生产环境来说风险太大。

我还没有这样做，但我认为肯定应该工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-08-25T04:25:00.803

**免责声明：**我根本不熟悉 WAR。我的回答可能完全错误，因为我没有这方面的经验。请理解，我发现这是一个有趣的挑战，我想找到一个解决方案。

我不知道当您创建 WAR 存档时应用程序能够做什么。结果我决定使用命令行来进行实际的编译。[但是，如果需要，包含sass gem](https://github.com/nex3/sass)并直接使用编译器应该不会太难。

因为我依赖命令行，所以你必须安装[sass gem](https://github.com/nex3/sass)。然后查看使用命令行界面的[README](https://github.com/nex3/sass/blob/1af167f4edc9f03e5da67fe01628d68d2fec5b67/README.md#using)。

为了测试，我创建了一个名为`Theme`以下列的模型。您可能需要更改下面的代码以匹配您现有的模型。

1.  `(string) title # the title of the theme`
2.  `(string) stylesheet_file_name # the name of the file that is saved`

在我的表单内部，我使用了不同的字段名称来防止重叠。

```
<%= f.form_field :styleheet %> 
```

然后在我的控制器内部，我添加了代码来编译上传的 scss 文件并将其移动到公共目录中。

```
def create
  if params[:theme].has_key?(:stylesheet)

    # create a filename friendly version of the theme name
    file_name = params[:theme][:stylesheet_file_name] = params[:theme][:title].parameterize

    # where to copy the temporary uploaded file to. It is important that we get
    # the original extension. The `sass` command uses the extension to determine how to compile the file
    tmp_file = "#{Rails.root}/tmp/#{params[:theme][:stylesheet].original_filename}"

    # move from /tmp path to within the Rails temp directory
    `cp #{params[:theme][:stylesheet].tempfile.path} #{tmp_file}`

    # create the theme's css file.
    File.open("#{Rails.root}/public/stylesheets/#{file_name}.css", 'w') do |f|

      # compile the .scss file via command line
      parsed_theme = `sass #{tmp_file}`

      # store the contents of the file
      f.write(parsed_theme)
    end

    # remove the temporary file we created earlier
    `rm #{tmp_file}`

    # this key wasn't part of my AR model
    params[:theme].delete("stylesheet")
  end

  # rest of action here ...
end 
```

准备好 css 文件后，您可以`layout/application.html.erb`使用以下内容将其包含在文件中。

```
<head>
  <%= stylesheet_link_tag "/stylesheets/#{@current_theme.stylesheet_file_name}" %>
</head> 
```

# python - 创建具有相同值的字典

> ID：11977730
> 
> 赞同：10
> 
> 时间：2012-08-15T21:37:01.513
> 
> 标签：python, dictionary

假设我有字典`a = {}`，我想得到这样的结果

```
value = 12
a = {'a':value,'b':value,'f':value,'h':value,'p':value} 
```

等等很多`keys:same value`。现在我当然可以这样做

```
a.update({'a':value})
a.update({'b':value}) 
```

等等....但是由于所有键的值都相同，我们难道没有更 Pythonic 的方法来做到这一点吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2012-08-15T21:40:06.083

您可以使用[dict 理解](http://www.python.org/dev/peps/pep-0274/)（python 2.7+）：

```
>>> v = 12
>>> d = {k:v for k in 'abfhp'}
>>> print d
{'a': 12, 'h': 12, 'b': 12, 'p': 12, 'f': 12} 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2012-08-15T21:40:53.420

如何使用您想要的键和默认值创建一个新字典？检查[fromkeys](http://docs.python.org/library/stdtypes.html#dict.fromkeys)方法。

```
>>> value=12
>>> a=dict.fromkeys(['a', 'b', 'f', 'h', 'p'], value)
>>> print a
{'a': 12, 'h': 12, 'b': 12, 'p': 12, 'f': 12} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-08-15T21:52:09.853

```
>>> a=dict(zip('abfhp',[12]*len('abfhp')))
>>> a
{'a': 12, 'h': 12, 'b': 12, 'p': 12, 'f': 12} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-08-15T21:40:04.153

```
a = dict()
for key in keys:
    a[key] = value 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-08-21T02:39:57.147

正如 stummjr 所指出的，字典理解对理解和使用很有用，尤其是因为 python 中的所有内容都是字典。

您可以考虑解决此问题的另一种方法是使用 lambda 函数。

```
makeDict = lambda keys, values: { k:v for k, v in zip(keys, values) }
makeDict( [1,2,3], list('abc') )
['a': 1, 'c': 3, 'b': 2] 
```

如果这增加了任何清晰度，这就是 makeDict 看起来被重写为常规函数的内容。

```
def makeDict(keys, values):
    return { k:v for k, v in zip(keys, values) } 
```

无论如何，lambdas 可以玩起来很有趣，这也不是最强大的例子。使用 zip 可能会丢失数据。两个序列的长度必须相同才能正常工作。Python 将遍历，直到它有对来匹配两个序列。以下示例中的额外元素不应出现在字典中。

```
{ k:v for k, v in zip( list('abc'), [1,2,3,4]) }
['a': 1, 'c': 3, 'b': 2] 
```

# perl - Perl Dancer 会话 Cookie

> ID：11977731
> 
> 赞同：1
> 
> 时间：2012-08-15T21:37:30.297
> 
> 标签：perl, session, cookies, strawberry-perl, dancer

我刚开始使用 Dancer::Session::Cookie，我遇到了一些我没有预料到的行为。我整理了一个简单的 Perl Dancer 应用程序来使用 Authen::Simple::ActiveDirectory 进行身份验证。我的路线如下。

```
package auth;
use Dancer ':syntax';

our $VERSION = '0.1';

get '/' => sub {
    template 'index', {user => session->{user}};
};

hook 'before' => sub {
    if (! session('user') && request->path_info !~ m{^/login}) {
        var requested_path => request->path_info;
        request->path_info('/login');
    }
};

get '/login' => sub {
    # Display a login page; the original URL they requested is available as
    # vars->{requested_path}, so could be put in a hidden field in the form
    template 'login', { path => vars->{requested_path} };
};

post '/login' => sub {
    # Validate the username and password they supplied
    my $ad = Authen::Simple::ActiveDirectory->new( 
        host      => 'host',
        principal => 'example.com'
    );

    if ($ad->authenticate( params->{user}, params->{pass} )) {
        session user => params->{user};
        redirect params->{path} || '/';
    } else {
        redirect '/login?failed=1';
    }
};

get '/logout' => sub {
    session->destroy;
    redirect '/';
};

true; 
```

我能够成功登录并创建会话。我的用户名在登录后放在主页上，并且我有一个指向 /logout 路由的链接。当我单击该链接时，将执行路由（我在调试器中确认了这一点），但我返回到主页，仍然显示我的用户名。由于不存在会话，我希望返回登录页面。任何想法为什么舞者会这样做？我是否误解了会话的工作方式？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-12-06T14:42:43.963

我以前没有使用过 Dancer::Session::Cookie，但看起来该`destroy`方法不正确 - 它只是从服务器端的已解析哈希中删除 cookie 条目，但这永远不会传达回浏览器。

代替打电话`session->destroy`试试这个：

```
cookie session->session_name => '', expires => '-1 day'; 
```

这就是腰带和吊带的方法——它清空 cookie 并将过期时间设置为过去。

# sharepoint - SharePoint Foundation 2010 - 搜索正在运行但无法正常工作。事件日志中的错误

> ID：11977732
> 
> 赞同：1
> 
> 时间：2012-08-15T21:37:44.323
> 
> 标签：sharepoint, sharepoint-2010, sharepoint-search

我最近负责设置具有内置 SharePoint 搜索功能的 SharePoint Foundation 2010 服务器。

为此，我们创建了两个帐户。运行服务的 spSearch 和爬取内容数据库的 spCrawl。我使用 spSearch 帐户设置 Foundation Search 服务作为服务帐户，将带有 pwd 的 spCrawl 帐户添加到 Content Access Acount。添加了数据库（不需要特定的实例）并且数据库保留为默认设置。我更新了索引时间并单击了确定。

然后我单击开始链接并再次单击开始按钮。我确保爬网帐户可以访问内容数据库，并将运行搜索的服务器添加到内容数据库中。

据我所知，没有一个帐户设置有任何特殊权利或限制。

自搜索开始以来，我们在事件日志中收到以下错误：

日志名称：应用程序

来源：Microsoft-SharePoint 产品-SharePoint Foundation 搜索

日期：2012 年 8 月 15 日下午 3:11:53

事件编号：57

任务类别：搜索服务

级别：警告

关键词：

用户：XXXXXXXXXXX

电脑：XXXXXXXXXXXX

描述：发生数据库错误。来源：Microsoft OLE DB Provider for SQL Server 代码：发生 14 次 257 次 描述：[DBNETLIB][ConnectionOpen (Invalid Instance()).]无效连接。

```
Context: Application 'dfa254b7-8bac-4842-83b8-3033ebc424f2'
Event Xml:
<Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
  <System>
    <Provider Name="Microsoft-SharePoint Products-SharePoint Foundation Search" Guid="{1C415899-58B3-4BFC-9236-105E7FD38719}" />
    <EventID>57</EventID>
    <Version>14</Version>
    <Level>3</Level>
    <Task>173</Task>
    <Opcode>0</Opcode>
    <Keywords>0x2000000000000000</Keywords>
    <TimeCreated SystemTime="2012-08-15T21:11:53.516367700Z" />
    <EventRecordID>6100</EventRecordID>
    <Correlation />
    <Execution ProcessID="5720" ThreadID="3280" />
    <Channel>Application</Channel>
    <Computer>XXXXXXXXXXXXX</Computer>
    <Security UserID="XXXXXXXXXXXXX" />
  </System>
  <EventData>
    <Data Name="string0">Microsoft OLE DB Provider for SQL Server</Data>
    <Data Name="string1">14</Data>
    <Data Name="string2">257</Data>
    <Data Name="string3">[DBNETLIB][ConnectionOpen (Invalid Instance()).]Invalid connection.</Data>
    <Data Name="string4">

Context: Application 'dfa254b7-8bac-4842-83b8-3033ebc424f2'</Data>
  </EventData>
</Event> 
```

我已经尝试了我能想到的一切，并花了一天时间在谷歌上搜索这个问题，但没有运气。有什么建议么？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-22T13:46:28.630

所以我最终自己确定了这个问题。这可以归因于新人并且不知道服务器的配置。事实证明，SQL Server 没有使用默认实例安装，但由于命名实例是使用 SQL Server Management Studio 连接到它时唯一安装的实例，连接字符串中没有特定实例，它仍然将我登录到命名实例。

一旦我意识到 SharePoint 数据库位于命名实例上，就可以快速修改搜索设置以指向该实例。

搜索现在正在工作。

# javascript - 如何从 Chrome 创建桌面通知？

> ID：11977733
> 
> 赞同：0
> 
> 时间：2012-08-15T21:37:48.783
> 
> 标签：javascript, google-chrome, notifications

我在 StackExchange 聊天中注意到，我现在可以启用桌面通知（我也在 Gmail 和 Google 音乐中使用）。现在我决定我希望能够在我的网站上做到这一点。我做了一些谷歌搜索，但只找到[了有关 Chrome Extensions 的信息](https://developer.chrome.com/dev/extensions/notifications.html)。如何在我自己的站点中制作桌面通知？

**编辑**

在 Chrome 控制台中，我找到了 function `webkitNotifications.requestPermission()`，但调用它并没有做任何事情。我希望它会显示 Chrome 顶部栏，询问“您想为 http://...启用桌面通知吗？”

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-16T15:00:05.257

[html5rocks.com 上](http://www.html5rocks.com/en/tutorials/notifications/quick/)有一个不错的通知 API 教程。希望这可以帮助！

`webkitNotifications.requestPermission()`仅供参考，你打电话时什么都没做的原因是因为

> 此方法只应在处理用户手势时调用，在其他情况下将不起作用

如[通知 API 规范](http://www.chromium.org/developers/design-documents/desktop-notifications/api-specification)中所述。因此，您可能需要在用户手势（*例如*鼠标单击）中实现此方法，以使其生效：

```
<script>
function requestNotificationPermission()
{
    window.webkitNotifications.requestPermission();
}
</script>

<a onclick="requestNotificationPermission(); return false;" href="#">Request notifications permission</a> 
```

# python - Python Google Calendar API 麻烦

> ID：11977734
> 
> 赞同：0
> 
> 时间：2012-08-15T21:37:49.590
> 
> 标签：python, google-calendar-api, bulk, asp.net-web-api

我可以将多个事件批量添加到 Google 日历，但这仅在我的默认日历中。我如何能够获得相同的代码来使用我有 URL 的另一个日历？

```
request_feed = gdata.calendar.CalendarEventFeed()

# add events to the request_feed
request_feed.AddInsert(entry=InsertSingleEvent(calendar_service, "walk the dog at 4:00pm"))
request_feed.AddInsert(entry=InsertSingleEvent(calendar_service, "walk the cat at 5:00pm"))

response_feed = calendar_service.ExecuteBatch(request_feed,
gdata.calendar.service.DEFAULT_BATCH_URL)) 
```

这将正常工作，所有事件将立即出现在我的日历中。但是当我更换时：

```
response_feed = calendar_service.ExecuteBatch(request_feed,
gdata.calendar.service.DEFAULT_BATCH_URL)) 
```

和：

```
url = 'calendar/feeds/.../private/full'
response_feed = calendar_service.ExecuteBatch(request_feed,
url)) 
```

我收到错误：

```
gaierror: [Errno 11004] getaddrinfo failed 
```

另请注意，我已经能够使用该 URL 自己添加事件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T23:33:43.173

查看[代码](http://code.google.com/p/gdata-python-client/source/browse/src/gdata/calendar/service.py)，似乎：

```
DEFAULT_BATCH_URL = 'http://www.google.com/calendar/feeds/default/private/full/batch' 
```

在您的代码中，它似乎正在尝试解析部分 URL。如果您将 URL 格式化为：

```
url = 'http://www.google.com/calendar/feeds/.../private/full/batch' 
```

它应该工作。

# css - 将图像转换为 css

> ID：11977735
> 
> 赞同：1
> 
> 时间：2012-08-15T21:37:56.870
> 
> 标签：css, css-shapes

我有这张图片（附件）。我不是设计师，但我不想在我的应用程序中使用该图像。我听说你可以非常接近使用 css 的图像。有人可以帮我处理这张图片并变成一个css等价物吗

谢谢！

![在此处输入图像描述](../Images/063c21ecfd77f3f5525a686ea2c7c1e9.png)

**尝试过**

```
<span class="xyz">
   <svg xmlns="http://www.w3.org/2000/svg" version="1.1">
      <polygon points="0,0 100,0 100,40 0,40 20,20" style="fill:#46b"/>
   </svg>
   text
</span> 
```

不知道如何将其添加到我当前的 css **也尝试过**

```
display: block;
clear: both;
width: 70%;
height: 2%;
float:right;
margin-top: -50%;
margin-right: 2%;
border-left: 10px solid transparent;
border-top: 4px solid #546aa4;
border-bottom: 4px solid #546aa4; 
```

上面的问题是我的文本不再有背景...如果我使用背景颜色，那么我将不得不使用左边框：10px 纯白色，这在不同的背景图像上看起来不太好，因为这一层会坐在图像的顶部。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T21:45:59.180

如果你有`<div class="magic">`，你可以应用这种风格：

```
.magic { 
    width: 200px; 
    height: 50px; 
}
.magic:before {
    content: '.';
    float: left;
    width: 0;
    height: 0;
    border-top: 25px solid transparent;
    border-left: 25px solid white;
    border-bottom: 25px solid transparent;
} 
```

​根据自己的口味更改尺寸。这个技巧被称为[CSS 三角形](http://css-tricks.com/snippets/css/css-triangle/)。

[jsFiddle 演示](http://jsfiddle.net/f6Ayy/)

**编辑：**或者一个带有透明箭头的[快速演示](http://jsfiddle.net/f6Ayy/16/)- 在这里你基本上使用不同的边框颜色来处理棘手的边框以及将箭头向左移动的方法 - 我使用过`position: relative`- 所以 div 的背景不会覆盖下面的内容。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-08-15T22:24:23.130

*“我不想在我的应用程序中使用图像”*是一个相当模糊的要求，您可能会发现[数据 URI](https://developer.mozilla.org/en-US/docs/data_URIs)是一个合适的替代方案：

```
.xyz{
  background:url(data:image/png;base64,/*encoded image*/);
} 
```

我非常喜欢谨慎使用它们——如果图像是外部的，它们不需要额外的 http 请求，它们不需要客户端上的渲染资源，因为它们是重精灵（除了大多数微不足道的情况图形比你的*更简单*）渲染速度比 CSS3 效果快。

**编辑：** base64 编码是一些 LESS/SASS css 预处理实现的一部分，并且有在线编码器可供一次性使用，例如[这个](http://www.motobit.com/util/base64-decoder-encoder.asp)（只要记住从数据 uri 中删除所有换行符）

[摆弄](http://jsfiddle.net/ovfiddle/Ag6jt/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-08-15T21:41:33.810

从某种意义上说，HTML 元素可以设置样式，是的，可以创建这样的形状。您必须使用多个 DIV 来完成它。这是一个网站，它很好地概述了使用边框样式创建基本几何形状：

[http://css-tricks.com/examples/ShapesOfCSS/](http://css-tricks.com/examples/ShapesOfCSS/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-08-15T21:56:38.187

如果您只想避免链接到外部图像文件，则可以将图像直接嵌入到 css 或 html 中。

这是一个例子：

```
<!doctype html>
<html>
<head>
   <title>CSS Image Data Example</title>
   <style>
      #imgHolder {
         background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAAAvCAYAAACmGYWkAAADs0lEQVR42u2dS2sVSRSAjRoyGh8bNyKIiO+NgiCIOPhaGNQBb1clPggEF53b1bk4I4qIrwvqHxDECeqEpKqu4W5cCIIrt4rPhU9EGVz4REEFh9EZ4+mHN53Ef+B34IObe7t7ceCj6tSp6oxTxn0W/hO+CkMAMMw4ZewpbfwF+eOpfBZZPKIAfBdke1ibIYIsU5E7oI27KV/+Q2IAckGq1er4rq6+X3S3W6Jivz8w7r788IXkAIgg3yMMe5uDnr5FMooclx/uyojyLwkCBClEIklHPLhA6pBqYOwjueB/kgQIUgit6xN0RaZbxh6WCx6SJECQ0TE01LTt9/NzpB45KHXJg8B4ahJAkGIkxbs2dp5cZNKaJEYSQJARsTy80VwKe2fKdOuoXPxYMZIAgowdSTrifincbVVueCB8opkICDKqcN9qBheryB8SUW6pmCVgQJBRS8A3mnVkFwaROyI33s62pZBAQJARfZJUktjuSSVhJAEEGRlrqlcmBt1+voiyjz4JIMiPapJ6fYIu98/SMt3Sxr1RUbpdnoQCghQjiPxckeOYiHJHU5MAgoyNUmhnJnu3smYiNQkgyJg+SRDWFqnI7k+XgNPzJPRJAEFGbnCM7MKscLdXs2YiyQUEaURb5WTLDqlJRJI9MtW6l59zJ8mAIMWRJFsCdkfS8yRscAQE+cF0a3d9dsn4oypy15huAYKMPVDS1FZx09qN3a5ie51EA4IMR1P6EoiyXyFTrBOBcU9INCBIHp17L7cGkd8QxM5Lsf6UBiIgSD5ytFUutZTKbpWIcU4e/koZm7z0gZ4I/PSCNO2UmkNFdrU89LTwnDeiAII0eiCXWtpj/6uMGE54jRyAIIVlXdVj18jD/lRROnKQWECQVI4/6pNKxq8NIjcgD3vByAEIkvc5koNTiRza2Av5tIqEAoKkS7mdA60dFbs0ML5PHvKRfVeAIPnI0bl3oFVVzq9Wsf9LGc/IAQjSqDlMfYqK3XoV+TNy8zsSCAhS6HPontq6wNizWZ/DUpADgiSxa9e5qarcv1luqAXGPaPmAAQp9Dnay25VEDkvU6u3yAEIUnxRXLdbIqNGX1aQc9YcEKTRBMwKcntG6o4PJAsQpCCHjmsr071VvBQOEGT4P0slS7na2I3ZtIq9VYAgjSagDuvTdWQ3JatVwkvOcgCC5HJsCS9OTs5z6OQkYCYHfQ5AkCSSM+TZrlzbm29ZRw6ARJCOyuBS3WN/y6dV75EDoCCIFON/52LwcgWAUXwDOUawyI+Ht4oAAAAASUVORK5CYII=);
         width: 200px;
         height: 47px;
      }
   </style>
</head>
<body>
   <h1>Look, Ma, no external links!</h1>
   <div id="imgHolder">&nbsp;</div>
</body>
</html> 
```

在这种情况下，我将图像数据 URL 用于 background-image css 属性，但您也可以将相同的 URL 用于标记的`src`属性。`<img>`

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-08-15T21:46:05.390

这是一个帮助您入门的示例：

**HTML：**

```
<div class="box">
    <div class="flag"></div>
</div>​ 
```

**CSS：**

```
.box {
    /* Set dimensions and color of containing box */
    width: 100px;
    height: 30px;
    background: #03e;
}

.flag {
    float: left;
    /* Set left border to control width and color of flag */
    border-left: 20px solid #fff;
    /* Set top and bottom border each to half of box height */
    border-top: 15px solid transparent;
    border-bottom: 15px solid transparent;
    width: 0;
    height: 0;
}​ 
```

小提琴链接：http: [//jsfiddle.net/kHDFp/](http://jsfiddle.net/kHDFp/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-08-15T21:47:05.787

看来你想要一个矢量图像。您可以使用[HTML svg 标签](http://www.w3schools.com/svg/default.asp)创建多边形：

```
<svg xmlns="http://www.w3.org/2000/svg" version="1.1">
   <polygon points="0,0 100,0 100,40 0,40 20,20"
   style="fill:#46b"/>
 </svg> 
```

[http://jsfiddle.net/XDtXV/](http://jsfiddle.net/XDtXV/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-08-15T21:52:05.063

这是您可以做的一个好的开始。

```
<style>
#button {
   width: 120px; 
   background: #546AA4; 
   border-left: 40px solid white;
   border-top: 24px solid transparent;
   border-bottom: 24px solid transparent;
}
</style>

<p id="button"></p> 
```

见：[在行动](https://dl.dropbox.com/u/60673975/shared-code/css-image.html)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-03-26T09:27:46.453

我还没有在这里看到使用伪元素的方法，所以我想我会在这里添加一个。这是假设你给你的 div 一个设定的高度：

```
div{
  height:50px;
  width:200px;
  position:relative;
  margin-left:25px;
  background:tomato;
  }

div:before{
  content:"";
  position:absolute;
  top:0;
  left:-25px;
  border-top:25px solid tomato;
  border-left:25px solid transparent;
  }

div:after{
  content:"";
  position:absolute;
  bottom:0;
  left:-25px;
  border-bottom:25px solid tomato;
  border-left:25px solid transparent;
  }
```

```
<div></div>
```

# javascript - 关于生成随机数的一些想法

> ID：11977738
> 
> 赞同：2
> 
> 时间：2012-08-15T21:38:07.530
> 
> 标签：javascript, random

我想要一些关于生成随机整数的信息。我在里面寻找它，`Google`并且`Stack Overflow`大部分都找到了这样的代码（如果我们想要从 1 到 52 的数字）：

```
var randInt=function(){
   number=Math.floor(Math.random()*52+1);
}; 
```

和

```
var randNumMin = 1;
var randNumMax = 52;
var randInt = function (){
   number = (Math.floor(Math.random() * (randNumMax - randNumMin + 1)) + randNumMin);
}; 
```

我阅读了一些关于的参考资料`Math.random`，发现它正在生成从`0`to的数字`1`。如果`Math.random`generate `1`，我们会得到 number `5`，所以这意味着我们会得到错误。我同意这是非常罕见的情况，但这是可能的。我稍微修改了代码以避免该错误（在我们的例子中生成 number `53`）。这里我认为是在 JavaScript 中生成随机数的正确代码。在您的示例中，它仅生成整数，但我认为可以修改代码并生成任何类型的数字：

```
var randInt = function(){
    number = Math.floor(Math.random()*52+1);
    if (number === 53){
       randInt();
    }
}; 
```

和

```
var randNumMin = 1;
var randNumMax = 52;
var randInt = function (){
    number = (Math.floor(Math.random() * (randNumMax - randNumMin + 1)) + randNumMin);
    if (number===53){
        randInt();
    }
}; 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2012-08-15T21:39:37.223

该`Math.random()`函数生成随机数`x`，其中`0 <= x < 1`. 所以它永远不会*准确地*生成1，尽管它可能非常接近。

从[文档中`random`](https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Math/random)：

> 返回范围内的浮点伪随机数，`[0, 1)`即从 0（包括）到但不包括 1（不包括），然后您可以将其缩放到所需的范围。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-15T21:42:05.743

只需获取您的第一个代码示例，然后从 52 中减去一个。一般公式是这样的：

```
random number between X and Y = (Y - X) * Math.random() + X 
```

或对于整数，

~~Math.round((Y - X) * Math.random() + X)~~

或更准确地说（正如@Guffa 指出的那样），

```
Math.floor((Y-(X-1)) * Math.random() + X) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T21:51:43.863

您不需要使用地板，因为它确实会降低结果。

只需使用`round`

Math.round(Math.random(51))+1

# doxygen - 如何在主页中使用现有的 HTML 源

> ID：11977748
> 
> 赞同：0
> 
> 时间：2012-08-15T21:39:09.587
> 
> 标签：doxygen

对于 C 编程作业，我生成了一个描述作业的网页。它是 HTML 源代码。我在所有提供的 C 代码和生成的文档中添加了 doxygen 注释。

将分配文件的内容放在 doxygen 生成的主页选项卡上会很好。我拿了一个 C 文件并在其中添加了以下代码段

```
/** @mainpage Fall 2012 Programming Assignment 1 - Bit Fields in C
 *  \include "description.html"
 */ 
```

我在生成的主页选项卡上看到的是原始 HTML，而不是渲染良好的输出。我怎么能做到这一点？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-16T08:46:24.763

而不是使用`\include`命令尝试使用[`\htmlinclude`](/manual/commands.html#cmdhtmlinclude)命令。

# c++ - WORD 的 cmpxchg 比 BYTE 快

> ID：11977749
> 
> 赞同：7
> 
> 时间：2012-08-15T21:39:16.413
> 
> 标签：c++, multithreading, assembly, inline-assembly

昨天我发布了[这个](https://stackoverflow.com/questions/11959374/fastest-inline-assembly-spinlock)关于如何编写快速自旋锁的问题。感谢 Cory Nelson，我似乎找到了一种优于我的问题中讨论的其他方法的方法。我使用该`CMPXCHG`指令来检查锁是否为 0，因此是空闲的。`CMPXCHG`在“字节”上运行，`WORD`并且`DWORD`。我会假设该指令在`BYTE`. 但是我写了一个锁来实现每种数据类型：

```
inline void spin_lock_8(char* lck)
{
    __asm
    {
        mov ebx, lck                        ;move lck pointer into ebx
        xor cl, cl                          ;set CL to 0
        inc cl                              ;increment CL to 1
        pause                               ;
        spin_loop:
        xor al, al                          ;set AL to 0
        lock cmpxchg byte ptr [ebx], cl     ;compare AL to CL. If equal ZF is set and CL is loaded into address pointed to by ebx
        jnz spin_loop                       ;jump to spin_loop if ZF
    }
}
inline void spin_lock_16(short* lck)
{
    __asm
    {
        mov ebx, lck
        xor cx, cx
        inc cx
        pause
        spin_loop:
        xor ax, ax
        lock cmpxchg word ptr [ebx], cx
        jnz spin_loop
    }
}
inline void spin_lock_32(int* lck)
{
    __asm
    {
        mov ebx, lck
        xor ecx, ecx
        inc ecx
        pause
        spin_loop:
        xor eax, eax
        lock cmpxchg dword ptr [ebx], ecx
        jnz spin_loop
    }
}
inline spin_unlock(<anyType>* lck)
{
    __asm
    {
        mov ebx, lck
        mov <byte/word/dword> ptr [ebx], 0
    }
} 
```

然后使用以下伪代码测试锁（请注意，lcm 指针始终指向可被 4 整除的地址）：

```
<int/short/char>* lck;
threadFunc()
{
    loop 10,000,000 times
    {
        spin_lock_8/16/32 (lck);
        spin_unlock(lck);
    }
}
main()
{
    lck = (char/short/int*)_aligned_malloc(4, 4);//Ensures memory alignment
    start 1 thread running threadFunc and measure time;
    start 2 threads running threadFunc and measure time;
    start 4 threads running threadFunc and measure time;
    _aligned_free(lck);
} 
```

我在具有 2 个能够运行 4 个线程的物理内核（Ivy Bridge）的处理器上以毫秒为单位测量了以下结果。

```
 1 thread    2 threads     4 threads
8-bit      200         700           3200
16-bit     200         500           1400
32-bit     200         900           3400 
```

数据表明，所有功能都需要相同的时间来执行。但是当多个线程必须检查时，如果`lck == 0`使用 16 位可以明显更快。这是为什么？我不认为这与`lck`?

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-12-23T13:11:37.853

想象一下有 1234 个线程和 16 个 CPU。一个线程获取自旋锁，然后操作系统进行任务切换。现在您有 16 个 CPU，每个 CPU 都运行剩余的 1233 个线程中的一个，所有这些都以一种非常无意义的方式旋转，无论操作系统需要多长时间才能将 CPU 时间还给唯一可以释放自旋锁的线程。这意味着整个操作系统基本上可以锁定几秒钟（所有 CPU 都完全耗尽）。这是严重的迟缓；那你怎么修呢？

您可以通过不在用户空间中使用自旋锁来修复它。只有当/当可以禁用任务切换时，才应该使用自旋锁；并且只有内核应该能够禁用任务切换。

更具体地说，您需要使用互斥锁。现在互斥锁可能会在放弃并使线程等待锁之前开始旋转，并且（对于典型/低争用情况）这确实有帮助，但它仍然是互斥锁而不是自旋锁。

下一个; 对于健全的软件，重要的（对于性能）是避免锁争用，然后确保无争用情况很快（如果没有争用，一个好的互斥锁不会导致任务切换）。您正在衡量有争议的/不相关的案例。

最后; 你的锁坏了。为避免过度使用`lock`前缀，您应该测试是否可以在没有任何`lock`前缀的情况下获取，并且只有在您可能能够获取时才使用`lock`前缀。英特尔（可能还有很多其他人）将此策略称为“测试；然后（测试和设置）”。此外，您未能理解`pause`（或“rep nop”对于那些糟糕到不支持 10 年旧指令的汇编程序）的目的。

一个像样的自旋锁可能看起来像：

```
acquire:
    lock bts dword [myLock],0   ;Optimistically attempt to acquire
    jnc .acquired               ;It was acquired!
.retry:
    pause
    cmp dword [myLock],0        ;Should we attempt to acquire again?
    jne .retry                  ; no, don't use `lock`
    lock bts dword [myLock],0   ;Attempt to acquire
    jc .retry                   ;It wasn't acquired, so go back to waiting
.acquired:
    ret

release:
    mov dword [myLock],0        ;No lock prefix needed here as "myLock" is aligned
    ret 
```

另请注意，如果您未能充分减少锁争用的机会，那么您确实需要关心“公平”并且不应该使用自旋锁。“不公平”自旋锁的问题在于，有些任务可能很幸运，总是得到锁，而有些任务可能很不幸，永远不会得到锁，因为幸运的任务总是得到它。对于竞争激烈的锁来说，这一直是一个问题，但对于现代 NUMA 系统来说，它更可能成为一个问题。在这种情况下，您至少应该使用票证锁。

票证锁的基本思想是确保任务按照它们到达的顺序获得锁（而不是一些“可能非常糟糕”的随机顺序）。为了完整起见，票证锁可能如下所示：

```
acquire:
    mov eax,1
    lock xadd [myLock],eax           ;myTicket = currentTicket, currentTicket++

    cmp [myLock+4],eax               ;Is it my turn?
    je .acquired                     ; yes
.retry:
    pause
    cmp [myLock+4],eax               ;Is it my turn?
    jne .retry                       ; no, wait
.acquired:
    ret

release:
    lock inc dword [myLock+4]
    ret 
```

**tl;博士;** 一开始你不应该使用错误的工具（自旋锁）；但是，如果您坚持使用错误的工具，那么至少要正确实施错误的工具... :-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-12-23T12:14:06.103

据我回忆，锁适用于一个单词（2 个字节）。在 486 中首次引入时就是这样写的。

如果您携带不同大小的锁，它实际上会生成相当于 2 个锁（双字的锁字 A 和字 B）。对于一个字节，它可能必须防止第二个字节的锁定，这有点相似到2把锁...

所以你的结果符合 CPU 优化。

# java - Spring 的 @RequestMapping 内部结构

> ID：11977750
> 
> 赞同：0
> 
> 时间：2012-08-15T21:39:23.707
> 
> 标签：java, spring, web, http-request-parameters

我正在构建一个包含多个 Maven 工件的应用程序。由于设计限制，其中一个工件本质上是后端，无法访问请求（因此不允许使用@RequestMapping）。现实情况是，有些请求需要直接连接到其中一些类方法。

我在春天做了一些深潜，并遇到了使它工作所需的一半。简单的部分是自己编写一个 HandlerMapping 并正确配置它。该映射器将了解后端实体以手动映射必要的 url。

我找不到的部分是 Spring 在哪里（什么）管理调用？例如，当您有：

```
@Component
@RequestMapping("/mypath")
public class MyStuff
{
   @RequestMapping(value = "/dothis", method = RequestMethod.GET)
   public ResponseEntity<String> doThis(HttpServletRequest request)
   {
   }
} 
```

当向 /mypath/dothis 发出请求时，哪个对象会拦截该请求并在正确的 bean 中调用正确的方法？据我所知，映射器仅返回映射到特定 bean的*所有url 的字符串数组。*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T22:15:06.550

概括地说，这就是流程——Spring 的 DispatcherServlet 首先处理请求——这是在 web.xml 文件中有条目的流程。

`DispatcherServlet`维护一个 HandlerAdapters 和 HandlerMappings 的列表，对于请求，它向每个 handlerMapping 询问一个处理程序

在 Spring 3.1 中，主要的 handlerMapping 实现之一是`RequestMappingHandlerMapping`维护请求 uri 到处理程序的映射（`HandlerMethod`最终指向 @RequestMapping 映射方法）。

一旦从 HandlerMapping 中获得了一个处理程序，DispatcherServlet 就会询问每个 handlerAdapter 是否可以处理请求（HandlerAdapter.supports api），如果可以，则将请求分派到适当的 HandlerAdapter，最终调用 handlerMethod。在 Spring 3.1 中，注册的主要 HandlerAdapter`<mvc:annotation-driven/>`是`RequestMappingHandlerAdapter`

我认为这应该足以开始进行更深入的调查。遵循流程的一个好方法是在 DispatcherServlet 中放置一个断点并通过堆栈跟随流程。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-15T22:03:34.810

[http://static.springsource.org/spring/docs/current/spring-framework-reference/html/mvc.html](http://static.springsource.org/spring/docs/current/spring-framework-reference/html/mvc.html)

See section 16.4 about request interceptors. You should be able to use that to map to your class.

# web - 将网站缩放为可下载图像的在线服务？

> ID：11977753
> 
> 赞同：-3
> 
> 时间：2012-08-15T21:39:37.813
> 
> 标签：web, screenshot, scale

有谁知道一项服务，它允许您提供一个 URL，该 URL 将重新调整该站点的图形表示并让您下载图像。我需要将网站的比例图像叠加在智能手机图形上，而且我不想跳过箍从手机上获取屏幕截图。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T21:42:32.060

[http://www.shrinktheweb.com/](http://www.shrinktheweb.com/)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-09-07T23:21:17.750

如果您需要进行大量捕获[http://www.snapit.io/](http://www.snapit.io/)和[http://url2png.com/](http://url2png.com/)为此提供 API 并运行良好。还有很多其他人也这样做。您可以通过 Web 界面对其中的大多数进行免费的个人捕获。例如，使用 snapit.io 对该 URL 的全屏捕获看起来像

[http://www.snapit.io/snaps?url=stackoverflow.com/questions/11977753/online-service-to-scale-a-website-into-a-downloadable-image](http://www.snapit.io/snaps?url=stackoverflow.com/questions/11977753/online-service-to-scale-a-website-into-a-downloadable-image)

这些站点中的大多数都允许您修改捕获选项（视口大小、缩略图的捕获后比例、捕获延迟等）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-16T16:54:07.260

[Mobilito](http://mobilito.net/)和[mobiilisivutesti.fi](http://mobiilisivutesti.fi/)使用[Browshot](http://browshot.com/)在移动设备上截取屏幕截图，并检索缩略图。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-05-08T09:36:12.480

这是另一个：[http](http://www.website-screenshots.com) ://www.website-screenshots.com它允许在选项中设置浏览器尺寸。

# qt - QtQuick 或 QGraphicsView

> ID：11977766
> 
> 赞同：1
> 
> 时间：2012-08-15T21:40:39.330
> 
> 标签：qt, qgraphicsview, qt-quick

什么时候应该使用 QGraphicsView，什么时候 QtQuick 是更好的选择？
如果我想要具有高度自定义小部件（小部件及其行为的可视化）的高性能应用程序，哪个是更好的选择？

:?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-23T03:08:00.363

为了获得高性能，您应该使用 Qt 和 C++ 而不是 QML 和 JavaScript。所以让我们`QGraphicsView`在这种情况下使用 a 。

但是，使用 QML 创建小部件比使用 QtWidget 更容易和更快。它可能非常适合制作原型或设计师制作的界面。如果您不需要高性能，QML 是一个方便的解决方案。您还可以查看[这篇文章](http://cdumez.blogspot.fr/2010/12/ways-to-improve-qml-performance.html)以提高程序中的 QML 性能

# android - 从 java 数组创建一个 Image ListView

> ID：11977773
> 
> 赞同：0
> 
> 时间：2012-08-15T21:40:55.473
> 
> 标签：android, android-listview

我知道如何通过创建一个包含每个都是可绘制资源的项目的数组来为可绘制文件夹中的图像创建一个 ListView。然后通过使用列表和图像适配器，我们得到一个照片列表视图。

我有一个常规的 java 数组，其中包含代表我想要包含在 listview 中的图片的字符串，如何从这个字符串数组创建一个图像 ListView？

谢谢你

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T21:47:59.873

您将必须使用[SimpleAdapter](http://developer.android.com/reference/android/widget/SimpleAdapter.html) ，然后使用[setViewBinder](http://developer.android.com/reference/android/widget/SimpleAdapter.html#setViewBinder%28android.widget.SimpleAdapter.ViewBinder%29)。在绑定列表的每个元素之前，您将获得一个回调

```
setViewValue(View view, Object data, String textRepresentation) 
```

根据 textRepresentation，您可以设置图像，然后仅在这种情况下返回 true。

# php - 在非对象上调用成员函数 fetchObject()

> ID：11977774
> 
> 赞同：2
> 
> 时间：2012-08-15T21:40:56.447
> 
> 标签：php, pdo

在我的 while 循环中中断。一直在阅读php手册，但无法弄清楚我在这里做错了什么......

$pdo 调用我的数据库连接

```
function getSelectedPhoto($the_selected_id) {
global $pdo;

$id = $the_selected_id;

$stmt = $pdo->prepare("SELECT handle, src FROM images WHERE id = :id LIMIT 1");
$vars = array(':id' => $id);
$result = $stmt->execute($vars);

if($result) {
    while($row = $result->fetchObject()) {
        echo '<img src="../' . $row->src . '" alt="image" /><br />';
        echo '<p id="handle">' . $row->handle . '</p>';
    } 
} else die("There was some problem"); 
```

}

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T21:55:47.870

根据手册“ [PDOStatement::execute](http://php.net/manual/en/pdostatement.execute.php) ” `execute()`- 方法返回`true`或`false`不返回结果：

> 成功时返回 TRUE，失败时返回 FALSE。

当然，这将导致*“调用非对象上的成员函数 fetchObject()* ” `$result->fetchObject()`。

你的代码应该是这样的：

```
$result = $stmt->execute($vars);

if ($result) {
    while( $row = $stmt->fetchObject() ) {}
} 
```

# android - 如果 ViewPager.visibility 已消失，是否会调用 ViewPager Adapter 的 instantiateItem？

> ID：11977775
> 
> 赞同：0
> 
> 时间：2012-08-15T21:41:02.687
> 
> 标签：android, user-interface, adapter, visibility, android-viewpager

我有一个具有以下布局的活动：

```
LinearLayout  (orientation vertical)
    --> ViewPager 
    --> ListView 
```

在活动的初始加载时，`ViewPager`可见性设置为 GONE，尽管它的适配器已创建和设置。此时布局膨胀时是否会`PagerAdapter`调用`instantiateItem()`？（因为它的可见性已经消失了）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-16T00:12:29.103

我测试了流程，发现即使在为 ViewPager 视图膨胀并为视图设置适配器之后，如果 viewpager 被设置为 GONE 则不会调用 instantiateItem。我使用计时器验证了这一点，在几秒钟后将 viewpager 的可见性从 GONE 反转为 VISIBLE，并发现程序流立即进入了 instantiateItem，可见性发生了变化。（以前没有）

# node.js - Mongoose 中带节点的默认嵌套集合

> ID：11977776
> 
> 赞同：0
> 
> 时间：2012-08-15T21:41:03.263
> 
> 标签：node.js, mongodb, mongoose

我正在使用 Node 和 MongoDB 构建一个应用程序，我有一个公司模型和一个 API 密钥模型，在 Mongoose 中看起来像这样：

```
 var APIKeysSchema = new Schema({
    name: { type: String }
  });

  var CompanySchema = new Schema({
      name            : {type : String, required: true, index: { unique: true }}
    , apiKeys           : [ APIKeysSchema ]
    , created_at      : {type : Date, default : Date.now}
  }); 
```

我希望每家公司在创建公司时默认生成一个 API 密钥。我应该为此编写自定义中间件，还是有某种方法可以在架构本身中做到这一点。谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-16T16:57:28.077

最后只是在模型中保存时将其作为中间件：

```
CompanySchema.pre('save', function(next){
    if(this.get('apiKeys').length < 1){
        //generate API key
        var objectId = new ObjectID();
        this.get('apiKeys').push({ key: objectId.toHexString() });
    }
    next();
  }); 
```

# centos - 在centos，opensuse中通过x-scheme-handler设置协议处理程序

> ID：11977779
> 
> 赞同：2
> 
> 时间：2012-08-15T21:41:27.340
> 
> 标签：centos, mime-types, opensuse, gconf

我的要求是在 linux 系统中使用 firefox 运行自定义协议处理程序。

通过在 /usr/share/applications 中创建 myapp.desktop 文件，我已经在 Ubuntu 中成功添加了协议处理程序。内容是这样的。

```
[Desktop Entry]
Name=myapp
Comment= My Custom protocol handler
Exec=/path/to/my/application %U
Icon=myicon
Terminal=0
Type=Application
X-MultipleArgs=True
MimeType=x-scheme-handler/myapp
Encoding=UTF-8
Categories=Network;Application; 
```

之后我运行更新桌面数据库。一切就绪，我可以在 Ubuntu 的 firefox 浏览器或 Fedora 中输入 myapp://，然后 myapp 被调用。

虽然相同的过程在 Centos 或 Opensuse 中不起作用。我在 centos 和 opensuse 中尝试了以下内容，但没有奏效。

```
gconftool-2 -t string -s /desktop/gnome/url-handlers/myapp/command "/path/to/my/app %U"
gconftool-2 -s /desktop/gnome/url-handlers/myapp/needs_terminal false -t bool
gconftool-2 -t bool -s /desktop/gnome/url-handlers/myapp/enabled true 
```

请帮助使协议处理程序在 centos 和 opensuse 中工作。我正在使用 centos-6.2 和 opensuse 11.2

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-16T18:07:11.860

我弄清楚了原因。运行 gconftool 确实会添加 url 处理程序。我将这些命令作为 rpm post 脚本的一部分运行，该脚本需要 root 权限。因此 url 处理程序没有向用户注册。一旦以用户身份手动运行，当我在浏览器中键入 myapp:// 时，firefox 可以调用 myapp。

# google-chrome - 谷歌浏览器开发者工具

> ID：11977783
> 
> 赞同：0
> 
> 时间：2012-08-15T21:41:34.873
> 
> 标签：google-chrome, google-chrome-devtools

我看过几个网站（[比如这个](http://www.labnol.org/software/deobfuscate-javascript/19815/)和[这个](http://www.sagarganatra.com/2011/06/de-obfuscating-javascript-code-in.html)）说谷歌 Chrome 网络浏览器在开发人员工具中内置了一个 javascript 去混淆器。我似乎找不到这个。有人可以指出我正确的方向吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T21:44:31.603

也许他们指的`{}`是“源”选项卡上的按钮，或者在旧版本的 Chrome 中，“脚本”选项卡上的按钮。

# c# - 带有通配符的真值表（ish）

> ID：11977785
> 
> 赞同：2
> 
> 时间：2012-08-15T21:41:52.743
> 
> 标签：c#, pattern-matching

首先，这是用于模式匹配的，所以请记住这一点，因为您可能有一个完全不同的解决方案，我想听听。

我有这一系列数据（我们暂时称它为 mystring）。

```
string a = get_starting_letters(mystring)
string b = get_ending_letters(mystring)
bool c = check_code_appears(mystring)
.
.
.
and so on 
```

我想要一个像这样工作的字典/真值表（* 表示通配符）。

```
key  (a,b,c...)               value

"abc", *, True     =   "type a string"
"abc", "xyz", True =   "type b string"
*, "xyz", True     =   "type m string" 
```

这如何在 C# 中实现？我知道这对于 F# 来说是非常微不足道的，但是这个代码将来可能会被只知道 C# 的人更新。

我为什么要这样做？因为当前的代码变得难以遵循和更新（嵌套的 if、else、else if 太多），并且到目前为止只描述了几个“类型”（它将在几个月内翻倍）。

我一直在考虑的其他解决方案：一种树/结构，描述了由条件检查的不同可能变量：

```
 b = "xyz"
           a = "abc" <
mystring <            b = "xxx"
           a = "cda" <
                      b = * 
```

然而，它似乎会产生很大的开销，并且速度对此很重要，此外，树不会是二进制的，并且也需要处理通配符。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-16T01:33:45.460

如果您只需要能够检查给定元组是否与给定类型匹配，那么您可以只使用常规字典，例如

```
Dictionary<string, Tuple<string, string, bool>> lookup = new Dictionary<string, Tuple<string, string, bool>>();

//add some values
lookup["type a string"] = new Tuple<string, string, bool>("abc", null, true);
lookup["type b string"] = new Tuple<string, string, bool>("abc", "xyz", true);
lookup["type m string"] = new Tuple<string, string, bool>(null, "xyz", true); 
```

然后，您只需查找要检查匹配的类型，以查看值是否相等（或者元组中是否存在空值）。

如果您需要能够确定字符串匹配*哪些*类型（并且不想迭代已知类型），那么显然这种方法不起作用......但您需要建立某种类型优先规则以及...

更新：一种方法是使用 SQL 并添加一些索引（如果您不想编写自己的基于 B 树的索引）。是的，它是基于磁盘的，但是如果你经常引用它，表可能会被缓存，如果你不这样做，就没有理由担心性能。

一个更简单的想法是使用排序集。内存效率不是很高，但可能足够快，具体取决于您的规则设置方式。您将为每个字段的每个可能值构造一个集合，其中包含类型字符串。例如，你有一个集合，其中 a="abc"，它有两个成员，"type a string" 和 "type b string"，还有一个集合 a=*，它只有一个成员，"键入 m 字符串”。

如果您试图查找与 a="abc"、b="xxx" 和 c=true 的字符串匹配的值，您将采用 a="abc" 和 a=* 集的交集，将它与 b="xxx" 和 b=*的并集相交，然后与 c=true 和 c= 的并集相交*。然后，您将拥有一组与您的键匹配的值。

它将运行在 O([a="abc"] + [a=*] + [b="xxx"] + [b=*] + [c=true] + [c=*]) = O(n )

当然，它 O(n) 只是遍历所有规则以检查匹配项，但在这里我们大大减少了 n 的大小。

# javascript - 输入格式化指令

> ID：11977789
> 
> 赞同：1
> 
> 时间：2012-08-15T21:42:06.450
> 
> 标签：javascript, widget, angularjs, directive

请看一下这个[jsfiddle](http://jsfiddle.net/007design/VahqD/)。

我正在尝试创建一个“小部件”，允许用户选择 a`$`或`%`签名并相应地格式化文本字段。我已经让它工作了，有点，但它没有正确更新底层模型。

有人可以指出我缺少什么吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T22:48:46.990

发生这种情况是因为一个带有隔离范围的错误（至少我认为），在没有隔离范围的情况下看到[这个](http://jsfiddle.net/VahqD/14/)工作

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-16T08:23:25.130

您是否考虑过使用过滤器？

这些方面的东西？

[http://jsfiddle.net/ganarajpr/bbKFg/1/](http://jsfiddle.net/ganarajpr/bbKFg/1/)

# javascript - 基于索引的同位素自定义排序在过滤器后不起作用

> ID：11977800
> 
> 赞同：0
> 
> 时间：2012-08-15T21:43:10.397
> 
> 标签：javascript, jquery, jquery-isotope

这个问题是这个问题的后续： [同位素网格+角戳去除空格，排序逻辑](https://stackoverflow.com/questions/11904302/isotope-grid-corner-stamp-removing-empty-spaces-sorting-logic)

那里的答案在未过滤的同位素布局上完美无缺。但是，一旦删除了某些元素，此功能就会停止工作。

我想知道是否有一种好方法可以修改上一个答案中的代码以适应这种情况。

**这是一个在点击角戳时添加了一个基本过滤器的小提琴：http: [//jsfiddle.net/zewkG/13/](http://jsfiddle.net/zewkG/13/)**

请注意，在单击要过滤的角标后，单击元素 11 或 15 时，布局再次出现间隙。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T23:21:16.380

在这里你有解决方案：http: [//jsfiddle.net/zewkG/14/](http://jsfiddle.net/zewkG/14/)

```
$('.corner-stamp').click( function() {
    $container.isotope( 'destroy' );
    grid('.item.odd');
    $container.isotope('remove', $('.item:not(.odd)') )    
    $container.isotope('updateSortData', $('.item.odd'));
}); 
```

**编辑：**

固定答案：http: [//jsfiddle.net/zewkG/16/](http://jsfiddle.net/zewkG/16/)

问题出在这里：

```
getSortData : {
      fitOrder : function( $item ) {
        var index = $item.index(); 
```

它应该是：

```
getSortData : {
      fitOrder : function( $item ) {
        var index = $item.index(selector); 
```

这样我们就可以消除`-1`排序逻辑中的丑陋：

```
if ( $item.hasClass('large')) {
      if(index>10){
          order = Math.floor((index-1) / (columns))*(columns) + 1.5;
      }else{
          order = Math.floor((index-1) / (columns-1))*(columns-1) + .5;
      }
} 
```

变成

```
if ( $item.hasClass('large')) {
      if(index>10){
          order = Math.floor((index) / (columns))*(columns) + 1.5;
      }else{
          order = Math.floor((index) / (columns-1))*(columns-1) + .5;
      }
} 
```

那是因为

*   当我们拥有所有盒子时，box1的索引为0，box2的索引为1，box3的索引为2...
*   当我们有奇数时，box1的索引是0，box3的索引是1，box5的索引是2......

所以我们打破了一个盒子的文本和它的索引之间的对应关系，以保持排序逻辑。

最后，

```
$('.corner-stamp').click( function() {
    $container.isotope( 'destroy' );
    grid('.item.odd');
    $('.item:not(.odd)').css('display','none');   
}); 
```

我们需要`$('.item:not(.odd)').css('display','none')`，因为如果我们不这样做，偶数框会显示在动画奇数框下方。

**编辑2：**

你还记得我发现[http://jsfiddle.net/zewkG/8/](http://jsfiddle.net/zewkG/8/)有一个bug：box number 13,17,21（在行的末尾），当点击时，他们转到下一行而不是行首；所以我在[http://jsfiddle.net/zewkG/9](http://jsfiddle.net/zewkG/9/) ​​/ 中修复了它？

但在那之后，我们似乎有一个回归，固定的排序逻辑被旧的取代了。

所以我在 http://jsfiddle.net/zewkG/20/ 中修复了[你](http://jsfiddle.net/zewkG/20/)的[http://jsfiddle.net/zewkG/19/](http://jsfiddle.net/zewkG/19/)

固定的排序逻辑是：

```
if ($item.hasClass('large')) {
    if(index>10){
        order = Math.floor((index-1) / (columns))*(columns) + 1.5;
    }else{
        order = Math.floor((index) / (columns-1))*(columns-1) + .5;
    }
}else {
    order = index + 1;
} 
```

# javascript - 如何使文本区域仅在聚焦时进行拼写检查？

> ID：11977802
> 
> 赞同：3
> 
> 时间：2012-08-15T21:43:29.723
> 
> 标签：javascript, html, spell-checking

我希望对我的 TEXTAREA Dom 节点进行拼写检查（即 spellcheck=true），但是只要 TEXTAREA 没有聚焦，拼写检查就变得不可见（即没有红色曲线）。我不在乎是否在 TEXTAREA 失去焦点时重置拼写检查状态。

据我所知，这是 INPUT 的默认行为，但不是 TEXTAREA，至少在 Chrome 中是这样。

我尝试将 TEXTAREA 设置为 spellcheck=false onblur，但这似乎没有帮助。

对于内容可编辑的 DIV，设置 div.innerHTML=div.innerHTML 的策略似乎可以解决问题，但我不确定如何为 TextAreas 做一些等效的事情。

更新：

以下最终为我工作：

```
 onblur: function(e) {
              e.target.spellcheck = false;
              var old_value = e.target.value;
              e.target.value = "";
              e.target.value = old_value;
              e.target.spellcheck = true;
            } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T21:51:45.640

如果您使用的是 jQuery，那么：

```
$("textarea").on("focus", function() { $(this).attr("spellcheck", "true"); }); 
```

如果您不使用 jQuery，那么我建议您使用[jQuery](http://jquery.com/)。

**编辑：**

以下代码将相应地切换值：

```
$("textarea").on("focusin", function() { $(this).attr("spellcheck", "true"); });
$("textarea").on("focusout", function() { $(this).attr("spellcheck", "false"); }); 
```

# regex - 正则表达式在标签之间用下划线查找并替换所有空格

> ID：11977803
> 
> 赞同：2
> 
> 时间：2012-08-15T21:43:34.663
> 
> 标签：regex, replace, sublimetext2

我正在尝试在将 xml 文档导入数据库之前对其进行格式化。我有几百行，`<Image #1 File Name>Random string to find and replace</Image #1 File Name>`我不知道在正则表达式中正确的查找和替换模式来做我需要的事情。我能够将所有实例与此匹配：

```
<Image #1 File Name>(.*?)</Image #1 File Name> 
```

但我不确定我需要在打开/关闭标签之间用下划线替换空格的模式`<Image #1 File Name>Random_string_to_find_and_replace</Image #1 File Name>`

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T22:05:02.950

```
awk -F'<|>' '{gsub(/ /,"_",$3);print"<"$2">"$3"<"$4">"}' yourxmlfile 
```

好的，您可以`~`在过滤之前使用匹配运算符进行检查：

```
awk -F'<|>' '{if ($0 ~ /Image #1 File Name/) {gsub(/ /,"_",$3);print"<"$2">"$3"<"$4">"} else {print;}}' yourxmlfile 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-17T06:54:34.917

我建议下一个技巧：

1.  将`<Image #1 File Name>`and替换`</Image #1 File Name>`为两个不同的不带空格的特殊词（示例`MY_START_TAG`和 `MY_END_TAG`）。
2.  用下划线替换所有空格。
3.  还原第一步。

分而治之:)

# c# - 解决泛型运行时的重载问题

> ID：11977804
> 
> 赞同：2
> 
> 时间：2012-08-15T21:43:51.110
> 
> 标签：c#, c#-4.0, generics, overloading

是否可以在 C# 中将泛型传递给重载方法，并使其解析为该方法的非泛型版本？例如：

```
class Program {
    static void Main(string[] args) {
        A a = new A();

        Process(a);
        Console.ReadLine();
    }

    static void Process<T>(T item) {
        Writer(item);
    }

    // Writer methods...

    static void Writer<T>(T item) {
        Console.WriteLine("Type: " + item.GetType());
        Console.WriteLine("You lose");
    }

    static void Writer(A item) {
        item.Write();
    }
}   

class A {
    public void Write() {
        Console.WriteLine("You found me!");
    }
} 
```

此代码输出：

> 类型：Foo.A
> 
> 你输了

我想看看：

> 你发现我了！

有没有办法做到这一点，或类似的东西？我正在使用 C# 4。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-08-15T22:07:02.847

您可以使用`dynamic`将重载决议推迟到运行时：

```
static void Process<T>(T item)
{
    dynamic d = item;
    Writer(d);
} 
```

# winapi - 如何通过 IDispatch 将 SAFEARRAY 传递给 COM 对象？

> ID：11977806
> 
> 赞同：6
> 
> 时间：2012-08-15T21:44:08.400
> 
> 标签：winapi, com, variant, safearray

我正在尝试调用 COM 对象的方法，其中***记录***的参数之一是*“字节数组*”。实际声明取决于您正在查看的每种语言的文档：

*   在**C#**语言中：

    ```
    byte[] TransformFinalBlock(
        byte[] inputBuffer,
        int inputOffset,
        int inputCount
    ) 
    ```

*   **C++**语言；

    ```
    array<unsigned char>^ TransformFinalBlock(
        array<unsigned char>^ inputBuffer, 
        int inputOffset, 
        int inputCount
    ) 
    ```

*   VB**语言**：

    ```
    Function TransformFinalBlock ( _
        inputBuffer As Byte(), _
        inputOffset As Integer, _
        inputCount As Integer _
    ) As Byte() 
    ```

*   在**F#**语言中：

    ```
    abstract TransformFinalBlock : 
            inputBuffer:byte[] * 
            inputOffset:int * 
            inputCount:int -> byte[] 
    ```

我正在使用的对象也可以使用**COM**访问。该对象提供了一个早期绑定接口 ，`ICryptoTransform`该接口将方法声明为 using [**`SAFEARRAY`**](http://msdn.microsoft.com/en-us/library/windows/desktop/ms221482(v=vs.85).aspx)。

从**类型库**：

*   使用**IDL**语法

    ```
    [
      odl,
      uuid(8ABAD867-F515-3CF6-BB62-5F0C88B3BB11),
      version(1.0),
      dual,
      oleautomation,
      custom(0F21F359-AB84-41E8-9A78-36D110E6D2F9, "System.Security.Cryptography.ICryptoTransform")    
    ]
    interface ICryptoTransform : IDispatch {
       ...
       [id(0x60020005)]
       HRESULT TransformFinalBlock(
                    [in] SAFEARRAY(unsigned char) inputBuffer, 
                    [in] long inputOffset, 
                    [in] long inputCount, 
                    [out, retval] SAFEARRAY(unsigned char)* pRetVal);
    }; 
    ```

*   使用**对象 Pascal**语法：

    ```
    ICryptoTransform = interface(IDispatch)
         ['{8ABAD867-F515-3CF6-BB62-5F0C88B3BB11}']
         ...
         function TransformFinalBlock(inputBuffer: PSafeArray; inputOffset: Integer; inputCount: Integer): PSafeArray; safecall;
    end; 
    ```

这意味着在使用*早期绑定*时，您必须传递方法 a `SAFEARRAY`。我使用的语言支持 SafeArray API，我是否可以轻松地执行调用：

```
var
   inputBuffer: PSafeArray;
   xform: ICryptoTransform;
   ...
begin
   ...

   xform.TransformFinalBlock(inputBuffer, ...);
   ...
end; 
```

这是类似 java 语言的相同代码：

```
PSafeArray inputBuffer;
ICryptoTransform xform;

...

xform.TransformFinalBlock(inputBuffer, ...); 
```

一切*正常*；但这不是我的问题。

> **注意**：我试图强调这是一个与**语言无关的**问题，因为**COM 是一种与语言无关的技术**。但是在某些时候，我们必须实际*使用*一种语言来演示代码。[有些人将语言与技术混淆了](https://stackoverflow.com/questions/11972829/how-to-call-use-net-rijndaelmanaged-from-native-com)。如果我知道 Knuth 发明的语言，我会使用它。

## 但是后期绑定`IDispatch`呢？

现在我们知道我们*可以*将 a 传递[`SAFEARRAY`](http://msdn.microsoft.com/en-us/library/windows/desktop/ms221482(v=vs.85).aspx)给 COM 对象（使用***early-binding时），我需要解决使用******late-binding***传递数组的问题。

> **注意**：除此之外，如何通过 IDispatch 将 SAFEARRAY 传递给 COM 对象的问题对我很有用`ICryptoTransform`。
> 
> *   [将数组传递`BSTR`给 MSHTML 控件](https://stackoverflow.com/questions/489048/net-mshtml-how-to-pass-a-bstr-safearray)
> *   [将字节数组传递给其他 COM 对象](https://stackoverflow.com/questions/11972829/how-to-call-use-net-rijndaelmanaged-from-native-com)

`IDispatch`一些语言提供了在运行时通过接口调用方法的自动机制（即*后期绑定*）。事实上`IDispatch`，后期绑定是为 VBScript 发明的：

```
Dim xform = CreateObject("System.Security.Cryptography.SHA256Managed");
Dim buffer;
o.TransformFinalBlock(buffer, 0, 8); 
```

.NET 4.0 中添加了后期绑定编译器自动魔法：

```
dynamic xform = Activator.CreateInstance(Type.GetTypeFromProgID("System.Security.Cryptography.SHA256Managed", true));
xform.TransformFinalBlock(buffer, 0, 8); 
```

Delphi 中也存在后期绑定编译器魔法：

```
xform: OleVariant;
buffer: OleVariant;
xform.TransformFinalBlock(buffer, 0, 8); 
```

我*碰巧*在使用 Dephi，这个调用失败了。

## 但这并不是真正的编译器魔法

VBScript、C# dynamic 和 Delphi 所做的并不是什么神奇的事情。他们只是在打电话[`IDispatch.Invoke`](http://msdn.microsoft.com/en-us/library/windows/desktop/ms221479%28v=vs.85%29.aspx)：

```
IDispatch = interface(IUnknown)
   ['{00020400-0000-0000-C000-000000000046}']
   function Invoke(DispID: Integer; const IID: TGUID; LocaleID: Integer;
         Flags: Word; var Params; VarResult, ExcepInfo, ArgErr: Pointer): HResult; stdcall;
end; 
```

混乱正在设置这些参数：

```
xform.Invoke(
      1610743820,      //DispID
      IID_NULL,        //riid (reserved for future use, must be IID_NULL)
      0,               //locale id (lcid)
      DISPATCH_METHOD, //flags
      dispParams,      //Pointer to a DISPPARAMS structure
      null,            //Pointer to the location where the result is to be stored, or NULL if the caller expects no result
      exceptInfo,      //Pointer to a structure that contains exception information
      null);           //This argument can be set to null. 
```

真正的技巧是`dispParams`包含参数的结构。

## 参数将是一个变体

通过 DISPARAMS 传递的参数都是变体：

```
typedef struct tagDISPPARAMS {
  VARIANTARG *rgvarg;
  DISPID     *rgdispidNamedArgs;
  UINT       cArgs;
  UINT       cNamedArgs;
} DISPPARAMS; 
```

所以无论发生什么，我*的“字节数组”*都将是一个变体。

A [`VARIANT`](http://msdn.microsoft.com/en-us/library/aa908601.aspx)，在 Win32 中，只是一个联合，它包含：

*   `VARTYPE vt`：联合中的数据类型。
*   适当的工会成员，例如：

    ```
    BYTE        bVal;
    IDispatch  *pdispVal;
    SAFEARRAY  *parray;
    BYTE       *pbVal;
    IDispatch  *ppdispVal;
    SAFEARRAY  *pparray;
    VARIANT    *pvarVal;
    PVOID       byref;
    CHAR        cVal; 
    ```

到目前为止，我一直在传递一种类型的变体：

```
vt = VT_ARRAY | VT_UI1 
```

MSDN 记录了当您想使用**parray** union时必须执行的操作`VT_ARRAY | *`：

> **价值**：`VT_ARRAY | <anything>`
> 
> **说明**：传递了一个数据类型的数组。VT_EMPTY 和 VT_NULL 是与 VT_ARRAY 组合的无效类型。**pbyrefVal**中的指针指向一个数组描述符，它描述了数组的维度、大小和内存中的位置。

这意味着使用该**`parray`**成员：

```
 SAFEARRAY  *parray; 
```

您需要将`parray`member 设置为指向[`SAFEARRAY`](http://msdn.microsoft.com/en-us/library/windows/desktop/ms221482%28v=vs.85%29.aspx)结构的指针：

```
typedef struct tagSAFEARRAY {
  USHORT         cDims;
  USHORT         fFeatures;
  ULONG          cbElements;
  ULONG          cLocks;
  PVOID          pvData;
  SAFEARRAYBOUND rgsabound[1];
} SAFEARRAY, *LPSAFEARRAY; 
```

就我而言，我***的字节数组***实际上是 a `SAFEARRAY`，然后将其存储在一个变体中：

```
VARIANT *inputBuffer;
SAFEARRAY *safeArray;

//Setup our SAFEARRAY of data
safeArray.cDims = 1;
safeArray.fFeatures = FADF_HAVEVARTYPE;
safeArray.cbElements = 1;
safeArray.cbLocks = 0;
safeArray.pvData = pMyData;
safeArray.rgsabound[0].ElementCount = 1;
safeArray.rgsabound[0].LowBound = 0;

//Wrap the safearray in a variant
inputBuffer.vt = VT_ARRAY | VT_UI1; //$2011
vt.parray = safeArray; 
```

> **注意**：当然我还没有疯狂到自己创建了这个安全数组；我正在使用[`SafeArrayCreate`](http://msdn.microsoft.com/en-us/library/windows/desktop/ms221234%28v=vs.85%29.aspx)api 功能。我只是在证明这一切都是可知的，而不是魔法。

## 换句话说，我传递了一个字节的数组变体

换句话说，我*正在*传递一个字节数组，包装在一个变体中，因为所有调用：

```
dispatch.Invoke(...); 
```

一定是。除了*后期绑定*调用抛出错误：

```
The parameter is incorrect. 
```

那么我可能做错了什么？

如何将一个**字节数组**传递给**后期绑定** `IDispatch`调用？

## 我的问题

如何通过 IDispatch 将 SAFEARRAY 传递给 COM 对象？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-17T18:54:43.027

这应该会给你一些见解：

在调用方，C# 代码：

```
Foo foo = new Foo();
byte[] input = new byte[] { 1, 2, 3, 4 };
byte[] output = foo.Bar(input);
byte[] referenceOutput = new byte[] { 4, 3, 2, 1 };
Debug.Assert(Enumerable.SequenceEqual(output, referenceOutput)); 
```

`Foo.Bar`IDL ：

```
interface IFoo : IDispatch
{
    [id(1)] HRESULT Bar([in] VARIANT vInput, [out, retval] VARIANT* pvOutput);
}; 
```

以及带有安全数组的 C++ (ATL) 服务器实现：

```
// IFoo
    STDMETHOD(Bar)(VARIANT vInput, VARIANT* pvOutput) throw()
    {
        _ATLTRY
        {
            ATLENSURE_THROW(vInput.vt == (VT_ARRAY | VT_UI1), E_INVALIDARG);
            CComSafeArray<BYTE> pInputArray(vInput.parray);
            ATLASSERT(pInputArray.GetDimensions() == 1);
            const ULONG nCount = pInputArray.GetCount();
            CComSafeArray<BYTE> pOutputArray;
            ATLENSURE_SUCCEEDED(pOutputArray.Create(nCount));
            for(ULONG nIndex = 0; nIndex < nCount; nIndex++)
                pOutputArray[(INT) nIndex] = pInputArray[(INT) ((nCount - 1) - nIndex)];
            ATLASSERT(pvOutput);
            VariantInit(pvOutput);
            CComVariant vOutput(pOutputArray.Detach());
            ATLVERIFY(SUCCEEDED(vOutput.Detach(pvOutput)));
        }
        _ATLCATCH(Exception)
        {
            return Exception;
        }
        return S_OK;
    } 
```

来源：[Trac](http://www.alax.info/trac/public/browser/trunk/Utilities/Miscellaneous/ByteArrayVariant)，[Subversion](http://www.alax.info/svn/public/trunk/Utilities/Miscellaneous/ByteArrayVariant/) - 当心 Visual Studio 2012。

# curl - 用于编码“utf-8”的编码序列无效

> ID：11977809
> 
> 赞同：3
> 
> 时间：2012-08-15T21:44:15.367
> 
> 标签：curl, encoding, d, immutability

我正在使用[`std.net.curl`](http://dlang.org/phobos/std_net_curl.html)模块从删除网页中获取 HTML。但是我在编码方面有一些问题，我不知道如何解决。某些页面，例如`facebook.com`我收到以下错误消息（运行时）：

```
std.net.curl.CurlException@/usr/include/d/dmd/phobos/std/net/curl.d(800): Invalid encoding sequence for enconding 'utf-8'
----------------
./foo(char[] std.net.curl._decodeContent!(char)._decodeContent(ubyte[], immutable(char)[])+0xf6) [0x812e6ba]
./foo(char[] std.net.curl._basicHTTP!(char)._basicHTTP(const(char)[], const(void)[], std.net.curl.HTTP)+0x28e) [0x80f89f6]
./foo(char[] std.net.curl.get!(std.net.curl.HTTP, char).get(const(char)[], std.net.curl.HTTP)+0x8f) [0x80f8737]
./foo(immutable(char)[] teste.get_html(immutable(char)[])+0x112) [0x80f0806]
./foo(_Dmain+0x5f) [0x80f06e3]
./foo(extern (C) int rt.dmain2.main(int, char**).void runMain()+0x14) [0x8138340]
./foo(extern (C) int rt.dmain2.main(int, char**).void tryExec(scope void delegate())+0x18) [0x8137e50]
./foo(extern (C) int rt.dmain2.main(int, char**).void runAll()+0x32) [0x8138382]
./foo(extern (C) int rt.dmain2.main(int, char**).void tryExec(scope void delegate())+0x18) [0x8137e50]
./foo(main+0x94) [0x8137e04]
/lib/libc.so.6(__libc_start_main+0xf3) [0xb7593003] 
```

对于`google.com`，我得到（我得到二进制文件了吗？如何？）

```
�S��7�砱�y�����g�d��C���|��W��O�s��~����*6��@�4�&amp;�A�J����r▒4=�FT�e�� [...] 
```

因为`dlang.org`它工作正常。

问题是：阅读它的正确方法是什么？独立于页面编码。

这是我的 D 代码：

```
string get_html(string page) {
  auto client = HTTP(); 
  client.clearRequestHeaders();
  client.addRequestHeader("DNA", "1");
  client.addRequestHeader("Accept", "text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8");
  client.addRequestHeader("Accept-Encoding", "gzip, deflate");
  client.addRequestHeader("User-Agent", "Mozilla/5.0 (X11; Linux i686; rv:7.0.1) Gecko/20100101 Firefox/7.0.1");
  client.addRequestHeader("Accept-Charset", "ISO-8859-1,utf-8;q=0.7,*;q=0.7");

  return cast(string)get(page, client);
} 
```

提前致谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-08-16T12:02:29.747

`cast(string)get(page, client)`任何非`UTF-8`序列都失败。

使用standalone`get`和`post`函数，它们根据服务器发送的headers对内容进行解码并返回valid `UTF-8`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-16T10:37:10.867

curl 真的支持 gzip 和 deflate 编码以及 ISO-8859-1 字符集吗？您真的应该自己指定这些标头，而不是让 curl 自己声明它支持的编码和字符集吗？

要回答您的问题：

> 问题是：阅读它的正确方法是什么？独立于页面编码。

您查看服务器发送给您的标头，其中包含页面编码和字符集，然后根据这些标头解释数据（例如，调用 zlib 解压缩或膨胀数据，然后将解压缩的 HTML 转换为 UTF-8）。

# ruby-on-rails - 实验室预期，得到字符串

> ID：11977810
> 
> 赞同：0
> 
> 时间：2012-08-15T21:44:18.810
> 
> 标签：ruby-on-rails, forms, foreign-keys, associations

我有案例模型。案例模型有 3 个字段用于实验室模型的 id。
案例模型

```
belongs_to :lab1, foreign_key: 'lab1', class_name: 'Lab', inverse_of: :lab1, conditions: {step1: true}
belongs_to :lab2, foreign_key: 'lab2', class_name: 'Lab', inverse_of: :lab2, conditions: {step2: true}
belongs_to :lab3, foreign_key: 'lab3', class_name: 'Lab', inverse_of: :lab3, conditions: {step3: true} 
```

在实验室模型中

```
has_many :lab1, foreign_key: 'lab1', class_name: 'Case', inverse_of: :lab1
has_many :lab2, foreign_key: 'lab2', class_name: 'Case', inverse_of: :lab2
has_many :lab3, foreign_key: 'lab3', class_name: 'Case', inverse_of: :lab3 
```

并且还形成以防万一

```
 .lab_group
   = f.association :lab1, label: false, input_html: {'data-placeholder'=> t('step.one')}
   = f.input :lab1_delivered, label: t('case.done')
 .lab_group
   = f.association :lab2, label: false, input_html: {'data-placeholder'=> t('step.two')}
   = f.input :lab2_delivered, label: t('case.done')
.lab_group
   = f.association :lab3, label: false, input_html: {'data-placeholder'=> t('step.three')}
   = f.input :lab3_delivered, label: t('case.done') 
```

但是当我尝试保存它时，我有一个错误

```
Lab(#70207759169540) expected, got String(#70207716712320) 
```

并请求参数

```
{"utf8"=>"✓",
 "authenticity_token"=>"G0BWY6V6tkxRt81I0ZOxKXs8RD/7cdfbZfhVfRTmboo=",
 "case"=>{"number"=>"123",
 "doctor_id"=>"1",
 "lab1"=>"1",
 "lab1_delivered"=>"0",
 "lab2"=>"2",
 "lab2_delivered"=>"0",
 "lab3"=>"2",
 "lab3_delivered"=>"0",
 "delivered"=>"0",
 "patient"=>"",
 "comment"=>"for example"},
 "commit"=>"Save"} 
```

和屏幕

![](../Images/e386ea866722dc4d5dfc71f23dbe2ab1.png)

![](../Images/a71b5226cacd301619d2bb6e42af428e.png) 我该如何解决？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-16T09:46:55.463

解决方案：
我的案例表中有 lab1、lab2、lab3 列。但是foreign_key没有看到。我更改了lab1、lab2 和lab3 的名称，例如lab1_id、lab2_id 和lab3_id。
我从关联中删除了 foreign_key。
让我们来看看。
万一模型

```
belongs_to :lab1, class_name: 'Lab', inverse_of: :lab1, conditions: {step1: true}
belongs_to :lab2, class_name: 'Lab', inverse_of: :lab2, conditions: {step2: true}
belongs_to :lab3, class_name: 'Lab', inverse_of: :lab3, conditions: {step3: true} 
```

实验室模型

```
has_many :lab1, class_name: 'Case', inverse_of: :lab1
has_many :lab2, class_name: 'Case', inverse_of: :lab2
has_many :lab3, class_name: 'Case', inverse_of: :lab3 
```

并以形式

```
.lab_group
  = f.association :lab1, label: false, input_html: {'data-placeholder'=> t('step.one')}
  = f.input :lab1_delivered, label: t('case.done')
.lab_group
  = f.association :lab2, label: false, input_html: {'data-placeholder'=> t('step.two')}
  = f.input :lab2_delivered, label: t('case.done')
.lab_group
  = f.association :lab3, label: false, input_html: {'data-placeholder'=> t('step.three')}
  = f.input :lab3_delivered, label: t('case.done') 
```

foreign_key 不起作用 :( 是错误吗？可能是。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-15T22:05:09.513

我认为您在这里使用名称 lab1、lab2、lab3 而不是 lab1_id、lab2_id、lab3_id 作为外键名称。

# python - Python 始终无法正确解析 JSON。

> ID：11977818
> 
> 赞同：0
> 
> 时间：2012-08-15T21:45:01.630
> 
> 标签：python, json, api, automation

从 JSON 对象中获取它：

调用在这里：

```
response = make_request(GET_QUALIFIED_OFFERS_URL, request)

def make_request(url, json_data):
    host = url
    req = urllib2.Request(host, json_data, {'content-type': 'application/json'})
    response_stream = urllib2.urlopen(req)

    return response_stream.read()

response = {"Violations":[],"Messages":[],"Log":[],"Session":{"SessionId":813982132},"W3iDeviceId":294294043,"IsAfppOfferwallEnabled":true}, skipkeys=True, ensure_ascii=False, sort_keys=True, indent=4}

print json.dumps((response), sort_keys=True, indent=4) 
```

收到错误：

```
print json.dumps({"Violations":[],"Messages":[],"Log":[],"Session":{"SessionId":813982132},"W3iDeviceId":294294043,"IsAfppOfferwallEnabled":true}, skipkeys=True, ensure_ascii=False, sort_keys=True, indent=4)
NameError: global name 'true' is not defined 
```

看起来有些 JSON 不正确。我在值“true”周围加上引号，它起作用了。那么有没有办法在所有值周围加上引号？

这有效：

```
response = {"Violations":[],"Messages":[],"Log":[],"Session":{"SessionId":813982132},"W3iDeviceId":294294043,"IsAfppOfferwallEnabled":"true"}, skipkeys=True, ensure_ascii=False, sort_keys=True, indent=4} 
```

问题是我到处都有这样的 JSON，其值如 false 和 true，在巨大的键值数据集中没有引号。

我正在尝试做的是采用 JSon 并使其变得漂亮以便能够与之进行比较。我正在尝试编写一个自动化框架来测试 Json 中返回的内容。理想情况下，我很想创建一个 csv 输出。也许每个键都有一列，然后每个值都有一行。还有其他人在做这样的事情吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-08-15T21:47:02.567

在 Python 中，关键字是`True`，不是`true`。区分大小写很重要。举例说明`dumps`and的用法`loads`：

```
>>> from json import dumps, loads
>>>
>>> d1 = {'key1': 'val1', 'key2': True, 'key3': False}
>>> s1 = dumps(d1)
>>> d2 = loads(s1)
>>> d1
{'key3': False, 'key2': True, 'key1': 'val1'}
>>> s1
'{"key3": false, "key2": true, "key1": "val1"}'
>>> d2
{u'key3': False, u'key2': True, u'key1': u'val1'} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-08-16T19:55:40.317

编写纯 JSON 字符串和将 Python 数据结构转换为 JSON 字符串是有区别的。

Python`JSON{En,De}coder`默认执行以下翻译：

```
JSON            Python

object          dict
array           list
string          unicode
number (int)    int, long
number (real)   float
true            True
false           False
null            None 
```

因此，当您`{'foo': True}`使用 Python 编写代码时，JSONEncoder 会`{'foo': true}`按照 JSON 标准写出。

# c# - Java 中 StringBuffer 的 .NET 等价物是什么？

> ID：11977819
> 
> 赞同：41
> 
> 时间：2012-08-15T21:45:01.353
> 
> 标签：c#, java, .net, string

.NET 相当于[`java.lang.StringBuffer`](http://docs.oracle.com/javase/7/docs/api/java/lang/StringBuffer.html)什么？

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2012-08-15T21:46:00.127

是[`System.Text.StringBuilder`](http://msdn.microsoft.com/en-us/library/system.text.stringbuilder.aspx)。请注意，在现代 Java 中，您也会使用[`java.lang.StringBuilder`](http://docs.oracle.com/javase/7/docs/api/java/lang/StringBuilder.html)。（就像`StringBuffer`，但没有同步 - 我不记得上次我*想要*同步 的时间`StringBuffer`。请注意，.NET`StringBuilder`也不是线程安全的，但同样，我不记得我最后一次发现成为一个问题。）

# iphone - 全新安装后我将面临 Xcode 的问题

> ID：11977823
> 
> 赞同：3
> 
> 时间：2012-08-15T21:45:20.857
> 
> 标签：iphone, xcode, macos, development-environment

**我必须迁移到新机器。我应该携带 Xcode 的哪些部分？**

我知道我需要：

*   移动所有证书

*   移动所有项目文件

*   重新安装xcode（当然）

然而，在这里和那里阅读之后，我开始害怕这个过程比我列出的更多。

我**最担心**的是，如果我丢失了所有派生数据文件夹，我将无法更新我目前在商店中拥有的应用程序。这是真的？

除此之外，我还有什么需要担心的吗？

我不想做完所有事情然后遇到麻烦，因为我彻底搞砸了我的开发环境。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-10-15T22:35:03.710

派生数据中没有什么真正有用的东西。您仍然可以更新您的应用程序。

当您使用 Xcode 登录门户时，它会自动下载您的所有配置文件。它太酷了。

正如@joerick 所说，您想要带上您的钥匙串，就好像您丢失了您的私钥一样，您将不得不制作新的证书和新的配置文件等等。Xcode 实际上可以为您导出所有这些作为组织者的开发者资料。在设备部分选择您的团队，底部的导出按钮会将您的所有证书放入一个文件中，您可以在新机器上导入。

如果您在商店中有应用程序，您想随身携带它们的档案。这是从您构建和存档时开始的，并且是应用商店提交过程的一部分。如果您想测试您发送到商店的构建，并且因为构建的 dSYM 文件在存档中，存档不会做太多但很好。如果您希望能够从 itunes connect 符号化崩溃日志，您将需要应用程序存档。

应用程序存档存储在`~/Library/Developer/Xcode/Archives`

事实上，`~/Library/Developer`如果可以的话，您不妨随身携带整个文件夹。它会：

1.  省去您重新下载文档集的麻烦。`~/Library/Developer/Shared/Documentation`
2.  带来任何自定义代码片段`~/Library/Developer/Xcode/UserData/CodeSnippets`
3.  保存您的字体和配色方案`~/Library/Developer/Xcode/UserData/FontAndColorThemes`

也可能有配色方案和键绑定 `~/Library/Application Support/Xcode`

# javascript - jquery UI 执行中的奇怪延迟

> ID：11977824
> 
> 赞同：0
> 
> 时间：2012-08-15T21:45:22.397
> 
> 标签：javascript, jquery, jquery-ui, event-propagation

我一直在研究 Web 应用程序的一部分。javascript 文件变得相当大，其中很大一部分负责初始化和处理 jQuery UI 元素和事件。为了使事情更具可读性和可维护性，我将 UI 初始化程序和事件处理程序拆分到一个单独的文件中。该文件在逻辑文件之前加载，由 firebug 的 net 选项卡确认。

由于我已经分离了 UI 元素，我注意到按钮和复选框在它们的事件第一次触发之前已经从单击触发器变为双击。之后，单击执行事件。为了仔细检查，我在事件处理程序中设置了一个日志语句，直到第二次单击它才会打印。

这是html页面的脚本声明

```
<script type="text/javascript" src="../js/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="../js/jquery-ui-1.8.21.custom.min.js"></script>
<script type="text/javascript" src="../js/ajaxupload.3.5.js"></script>

<script type="text/javascript" src="../js/modernizer.js"></script>
<script type="text/javascript" src="../js/ui_initialization.js"></script>
<script type="text/javascript" src="../js/setCoordinates.js"></script>
<script type='text/javascript> 
  $(document).ready(function(){
    onload();
  });
<script type="text/javascript" src="../js/nav.js"></script> 
```

`onload`在 setCoordinates 中定义，然后`setupElements`在 ui_initilization 中触发。

例如，我在 html 中定义一个复选框为

```
<div id='checkboxes'>
  <input type="checkbox" id="panel" class="checkbox"/>
  <label for="panel" id='paneLabel' class="checkbox"></label>
</div> 
```

并将点击事件处理`ui_initilization.js`为

```
$("#checkboxes").buttonset();
$("#paneLabel").text("Hide Panels");

$("#panel").click(function(){
  console.log("pane click");
  handlePanelButtonClick();
}); 
```

第一次单击什么也不做，日志语句也不显示。第二次点击触发事件。

有没有办法来解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T22:45:24.093

如果没有现场示例，我真的很难解决这个问题。也许这是一些默认的浏览器行为......或者点击的触发器在第一次点击时不可用

尝试这个

```
$("#panel").click(function(event){
    event.preventDefault();
    event.stopPropagation();

    //your code...
}); 
```

# javascript - jquery拖放表格行和表格行组

> ID：11977828
> 
> 赞同：1
> 
> 时间：2012-08-15T21:45:56.100
> 
> 标签：javascript, jquery, html, ruby-on-rails, html-table

我的 ruby​​ on rails 应用程序中以表格格式列出了记录。记录或表行实际上被分组为记录组。我通过使用不同的行背景颜色来向用户表明这一点。

`<TR>`我需要能够将's 或 table 行从一组行拖放到另一组行。理想情况下，当您拖动行并在另一个组上时，它会勾勒/突出显示该组以表明您将要进入该组。

最好的方法是什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T23:52:34.613

我会说在进入组时突出显示组标题。确保组的标题始终在页面上，方法是使用一些 javascript 使离开页面顶部的最后一个组标题行始终出现（固定在顶部）。

# objective-c - 将 NSUInteger 除以 100

> ID：11977841
> 
> 赞同：0
> 
> 时间：2012-08-15T21:46:59.943
> 
> 标签：objective-c, ios, cocoa-touch, nsuinteger

我有一个 NSUInteger，我想将它除以 100。所以假设我在 NSUInteger 中有数字 1，我想将它除以 100 并得到 0.01 作为结果。

```
(float) percent / 100 
```

百分比是 NSUInteger

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-08-15T21:49:35.810

当两个整数相除时，结果将是一个整数。使其中一个成为浮点数（常数是典型的）

```
float percent = grade / 100.0f; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T21:51:20.950

您的示例看起来不错，因为您将其转换`percent`为浮点数。要记住的经验法则是得到一个浮点值，你必须除以一个浮点数。这意味着要么两个数字都是浮点数，要么其中一个数字是浮点数。以下任何一种情况都可以解决您的问题。

```
//I recommend the first option
float percentage = percent / 100.0f;
float percentage = (float)percent / 100.0f;
float percentage = (float)percent / 100; 
```

# asp.net - ASP.NET：xmldatasource 显示字符串但不显示字符串变量

> ID：11977843
> 
> 赞同：0
> 
> 时间：2012-08-15T21:47:00.293
> 
> 标签：asp.net, xml

我有一个 aspx 文件，但在使用 xmlDatasource 和中继器时遇到问题，这是我的代码

```
<asp:xmldatasource runat="server" XPath="bookstore/genre[@name='fiction']" Id="XmlSource" data="<% x; %>">
 <data>
 <bookstore><genre name='fiction'><book ISBN='0000000000'><title>Secrets of Silicon Valley</title><price>12.95</price><chapters><chapter num='1' name='Introduction' /></chapters></book></genre></bookstore>
 </data>
 </asp:xmldatasource>

 <asp:Repeater
    DataSourceID="XmlSource"
    runat="server">
      <ItemTemplate>
          <h1><%# XPath ("book/title") %></h1>
          <b>Price:</b>
          <%# XPath ("book/price") %>
      </ItemTemplate>
  </asp:Repeater> 
```

当我像这样使用它时，它工作得很好，即当我直接在数据对象中写入 xml 字符串时。

但是当我将它存储在变量中并使用它时它不起作用。任何想法如何做到这一点

这是我想要做的

```
string x = "<bookstore><genre name='fiction'><book ISBN='0000000000'><title>Secrets of Silicon Valley</title><price>12.95</price><chapters><chapter num='1' name='Introduction' /></chapters></book></genre></bookstore>";
<asp:xmldatasource runat="server" XPath="bookstore/genre[@name='fiction']" Id="XmlSource">
 <data>
 x;
</data>
</asp:xmldatasource> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-16T00:31:43.230

您可以像在示例中那样使用 XmlDataSource，但在标记中将其保留为空：

```
<asp:xmldatasource runat="server" XPath="bookstore/genre[@name='fiction']" Id="XmlSource">
</asp:xmldatasource> 
```

然后`Data`在后面的代码中设置属性：

```
XmlSource.Data = @"
<bookstore>
 <genre name='fiction'>
  <book ISBN='0000000000'>
   <title>Secrets of Silicon Valley</title>
   <price>12.95</price>
   <chapters>
    <chapter num='1' name='Introduction' />
   </chapters>
  </book>
 </genre>
</bookstore>"; 
```

# java - 在java中获取通用接口

> ID：11977848
> 
> 赞同：2
> 
> 时间：2012-08-15T21:47:32.923
> 
> 标签：java, hibernate, generics, reflection

我在某处读到不可能在运行时获得类的通用接口。那么休眠是如何做到这一点的呢？例如在 OneToMany 映射中，hibernate 如何找出许多部分类（使用注释）？

```
class A{
    ...
    @OneToMany(mapped-by="a")
    public List<B> getBs(){ 
    ...
    }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-08-15T21:48:27.787

> 我在某处读到不可能在运行时获得类的通用接口。

这取决于。您不能询问泛型类型的实例其类型参数是什么 - 但您*可以*从有关类、方法返回类型等的元数据中获取该信息。

例如，[`Method.getGenericReturnType`](http://docs.oracle.com/javase/7/docs/api/java/lang/reflect/Method.html#getGenericReturnType%28%29)返回 a`Type`而不是 a `Class<?>`，这样您就可以获取相关信息。

示例代码：

```
import java.lang.reflect.*;
import java.util.*;

public class Test {

    public static void main(String[] args) throws Exception {
        Method method = Test.class.getMethod("getList");
        Type returnType = method.getGenericReturnType();
        System.out.println(returnType); // java.util.List<java.lang.Integer>
        ParameterizedType parameterized = (ParameterizedType) returnType;
        System.out.println(parameterized.getActualTypeArguments()[0]);
    }    

    public List<Integer> getList() {
        return null;
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-15T21:49:01.527

类包含存储**一些**通用信息的元数据。

# mysql - 为什么在还返回列的 MAX 值时总是返回 ID 最低的行？

> ID：11977850
> 
> 赞同：1
> 
> 时间：2012-08-15T21:47:42.287
> 
> 标签：mysql

考虑以下两个查询：

```
SELECT *, MAX(age) AS maxAge FROM someTable ORDER BY age ASC;
SELECT *, 'dummyC' AS dummyC FROM someTable ORDER BY age ASC; 
```

前一个查询返回表的所有行和所有列，以及一个额外的虚拟列。后面的查询仅返回一行，即具有最低主键的行。为什么会这样，我该如何解决？在一些旧但稳定的 Debian 服务器上在 MySQL 5.1 中进行了测试。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T21:50:24.053

这是一个[MySQL 扩展](http://dev.mysql.com/doc/refman/5.6/en/group-by-hidden-columns.html)。

> MySQL 扩展了 GROUP BY 的使用，以便选择列表可以引用未在 GROUP BY 子句中命名的非聚合列。这意味着前面的查询在 MySQL 中是合法的。您可以使用此功能通过避免不必要的列排序和分组来获得更好的性能。但是，这主要在每个未在 GROUP BY 中命名的非聚合列中的所有值对于每个组都相同时很有用。服务器可以自由地从每个组中选择任何值，因此除非它们相同，否则选择的值是不确定的。此外，从每个组中选择值不会受到添加 ORDER BY 子句的影响。在选择了值之后对结果集进行排序，并且 ORDER BY 不会影响服务器选择的值。

你得到的价值是不确定的。您通常会得到插入到表中的第一行，但这不能保证。

如果您想要包含最高年龄的行中的相应值，那么最好使用`ORDER BY`和的组合`LIMIT 1`：

```
SELECT *
FROM someTable
ORDER BY age DESC
LIMIT 1; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-15T21:55:56.850

第一个查询有一个聚合函数 ( `MAX`)，但没有`GROUP BY`，这意味着它聚合（收集和组合值）整个结果集并将其作为一行返回。大多数 SQL 方言不允许非聚合列出现在这样的查询中，但 MySQL 特别允许。但是，这些非聚合列填充了 MySQL 遇到的第一行的值，这可能是任何行。如果您从未从有问题的表中删除过，MySQL 通常会首先找到 ID 最低的行，因为它以与存储在磁盘上的顺序相同的顺序扫描表（至少在需要全表扫描时）。如果您要在表上运行一堆`DELETE`后续`INSERT`语句，您至少会在某些查询中获得其他行。简而言之，不要指望得到任何特定的行。

第二个查询缺少聚合函数，因此它不执行任何隐式分组 - 您只需获得完整的结果集。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-08-15T21:49:38.530

在第一个查询中，* 是[隐藏列](http://dev.mysql.com/doc/refman/5.0/en/group-by-hidden-columns.html)

引用 MySQL 文档：

> MySQL 扩展了 GROUP BY 的使用，以便选择列表可以引用未在 GROUP BY 子句中命名的非聚合列。这意味着前面的查询在 MySQL 中是合法的。您可以使用此功能通过避免不必要的列排序和分组来获得更好的性能。但是，这主要在每个未在 GROUP BY 中命名的非聚合列中的所有值对于每个组都相同时很有用

# android - 如何识别按钮

> ID：11977852
> 
> 赞同：0
> 
> 时间：2012-08-15T21:48:00.120
> 
> 标签：android

我正在android中开发一个图片拼图，我有9个按钮，每个按钮都有自己的图像，除了一个是白色的，现在我真正想要的是，当我单击与白色按钮并排或下方或上方的任何按钮时白色白色按钮，两个按钮的属性交换，我的意思是白色按钮变为单击按钮，单击按钮变为白色按钮及其 id。我正在这样做，但似乎不合逻辑，也不起作用。

```
private OnClickListener btnClick = new OnClickListener() {

    public void onClick(View Sender) {

        ImageButton Incoming=(ImageButton) Sender;
        try{    

                ImageButton temp=MyButtons[Incoming.getId()];
                MyButtons[Incoming.getId()].setImageDrawable(MyButtons[Incoming.getId()-1].getDrawable());
                MyButtons[Incoming.getId()].setId(MyButtons[Incoming.getId()-1].getId());
                MyButtons[Incoming.getId()-1].setImageDrawable(temp.getDrawable());
                MyButtons[Incoming.getId()-1].setId(temp.getId());

        }
        catch (Exception e) {
            // TODO: handle exception
            Toast.makeText(getBaseContext(), e.toString(), Toast.LENGTH_LONG).show();
        }

    }
}; 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T22:08:36.543

您拥有的代码与此类似：

```
Button temp = MyButtons[1];
MyButtons[1].id = MyButtons[0].id;
MyButtons[0].id = temp.id; // FAIL - same as MyButtons[0].id = MyButtons[1].id 
```

您假设第一行仅保留对现有按钮的引用时正在制作按钮的副本。然后设置按钮的 id：

```
MyButtons[Incoming.get()].setId(MyButtons[Incoming.getId()-1].getId()); 
```

然后尝试设置另一个按钮的id：

```
MyButtons[Incoming.get()-1].setId(temp.getId())); 
```

这与：

```
MyButtons[Incoming.get()-1].setId(MyButtons[Incoming.getId()].getId()); 
```

您需要保存 id 和图像，而不是按钮引用。

# java - 使 JPA 与 JBoss 服务器上的 Spring Framework 一起工作

> ID：11977853
> 
> 赞同：1
> 
> 时间：2012-08-15T21:48:06.553
> 
> 标签：java, spring, hibernate, jpa

**基础**

我正在使用 Spring 2.5.6 和 Hibernate 3.2.1 - 因为我必须部署到不允许干扰其设置的 jboss 4.2.3（因为 jboss 服务器是由脚本构建的，并且脚本是旧的但没有给予投入时间来改变它的章程）。所以，不，不能在 JBoss 上为应用程序提供私有库。

我是注释人员的 JPA，而不是休眠 XML 人员。所以我不会将 DTO 和映射更改为使用休眠 XML。不得不从 Hibernate 3.6 退回到 Hibernate 3.2.1 对我来说已经太多了。我有休眠自动检测我的实体类，我不会改变它。

**问题**

我在 JBoss 4.2.3 开发环境中编写了一个与 JPA 和 JAX-RS 完美运行的 web 应用程序。现在我必须将它放入 Spring 2.5.6 框架中。

所以，我创建了以下**ApplicationContext.xml** ...

```
<bean id="propertyPlaceHolder" class="zzz.common.spring.config.ConfigPlaceholderConfigurer" >
    <property name="location" value="file:C:/config/bootstrap.properties"/>
</bean>

<tx:annotation-driven />

<bean id="transactionManager" class="org.springframework.orm.jpa.JpaTransactionManager"> 
  <property name="entityManagerFactory" ref="entityManagerFactory" />
</bean>

<bean id="jpaTemplate" class="org.springframework.orm.jpa.JpaTemplate"> 
  <property name="entityManagerFactory" ref="entityManagerFactory" />
</bean>

<bean id="entityManagerFactory"
  class="org.springframework.orm.jpa.LocalEntityManagerFactoryBean" >
  <property name="persistenceUnitName" value="obamacare"/>    
</bean> 
```

~

这就是**persistence.xml**。最初，属性值是在开发期间硬编码的。但是要将它们转化为生产，必须将它们的值转换为 spring ${references}。${references} 是从文件：C:/config/bootstrap.properties 中读取的，zzz.common.spring.config.ConfigPlaceholderConfigurer 需要通过身份验证服务设置用户和密码。

```
<persistence-unit name="obamacare" transaction-type="RESOURCE_LOCAL">
    <provider>org.hibernate.ejb.HibernatePersistence</provider>
    <exclude-unlisted-classes>false</exclude-unlisted-classes>
    <!-- Scan for annotated classes and Hibernate mapping XML files -->
    <properties>
        <property name="hibernate.archive.autodetection" value="class, hbm" />

        <property name="hibernate.connection.driver_class"
            value="${zzz.common.sql.ConnectionPool.driverClass}" />
        <property name="hibernate.connection.url"
            value="${zzz.common.sql.ConnectionPool.url}" />

        <property name="hibernate.connection.username" value="${zzz.common.sql.ConnectionPool.user}"/>
        <property name="hibernate.connection.password" value="${zzz.common.sql.ConnectionPool.password}"/>

        <property name="hibernate.dialect" value="org.hibernate.dialect.OracleDialect" />
        <property name="hibernate.show_sql" value="true" />

    </properties>
</persistence-unit> 
```

很明显，持久化XML中的spring ${references}是不行的，因为实体管理器为Null，因为jdbc驱动类为null。以及 url 和用户名和密码。

我将以下几行放入 JAX-RS 响应代码中，其中调试器显示 entityManager 为空。

```
@PersistenceContext
private EntityManager entityManager; 
```

**问题**：

**Q1。**

我需要做些什么才能使 spring ${references} 注入到我的 persistence.xml 属性中？

**Q2。**

我试图将 persisitence.xml 属性传输到 ApplicationContext.xml 中的数据源中。

```
<bean id="entityManagerFactory"
    class="org.springframework.orm.jpa.LocalEntityManagerFactoryBean" >
    <property name="persistenceUnitName" value="unit1"/>    
</bean>

<bean id="dataSource"
    class="org.springframework.jdbc.datasource.DriverManagerDataSource">

    <property name="driverClassName" value="${zzz.common.sql.ConnectionPool.driverClass}"/>
    <property name="url" value="${zzz.common.sql.ConnectionPool.url}"/>
    <property name="username" value="${zzz.common.sql.ConnectionPool.user}"/>
    <property name="password" value="${zzz.common.sql.ConnectionPool.password}"/>
</bean> 
```

但是 JBoss 启动失败，因为... DriverManagerDataSource 不可写，没有 setDatasource 方法或 setDatasource 方法不可访问，等等，等等。

为什么在 DriverManagerDataSource 中不能设置数据源？我需要在扩展类中做什么来创建 setDatasource 方法。在该方法中我需要做什么？

您能否建议一个允许 setDatasource 的替代 jdbc 数据源？

**Q3。**

还有什么我需要做的，或者spring框架会自动在实体管理器中找到PersistenceContext注释，然后尝试实例化它？

**Q4。**

bean jpaTemplate 有什么作用？为什么我需要它？

**Q5。**

如果我将所有内容都转移到 ApplicationContext.xml，我还需要保留一个虚拟的占位符 persistence.xml 吗？

我需要帮助。通过使 DriverManagerDataSource 在 ApplicationContext.xml 中工作或使 ${references} 在 persistence.xml 中工作。

谢谢你们。

这是我上周提出的问题的后续：[动态设置 JPA 持久性属性](https://stackoverflow.com/questions/11695291/setting-jpa-persistence-properties-dynamically)。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-19T22:41:22.823

**Q4** JpaTemplate 不再是必需的。它被贬低了。

**Q5** 如果你只有一个持久化单元，那么Spring就不需要persistence.xml。您可以使用 LCEMFB 属性“packagesToScan”并引用实体包目录。

注意：不要使用“PersistenceUnit”属性，它会覆盖“PackagesToScan”

[我在这里写过关于 Spring Data JPA 的博客](http://gordondickens.com/wordpress/2011/08/01/simpler-jpa-with-spring-data-jpa/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-16T08:43:14.853

**第一季度**

你不能 AFAIK，Spring 只会将占位符配置加载到它自己管理的 xml 文件中

**Q2、Q3、Q5**

这篇[博文](http://krams915.blogspot.co.uk/2011/10/spring-310rc1-jpa-entitymanagerfactory.html)讨论了使用[LocalContainerEntityManagerFactoryBean](http://static.springsource.org/spring/docs/2.5.x/api/org/springframework/orm/jpa/LocalContainerEntityManagerFactoryBean.html)来取消 persistence.xml

**第四季度**

这篇文章谈到[不想使用 JpaTemplate](http://blog.springsource.org/2006/08/07/using-jpa-in-spring-without-referencing-spring/)但仍然获得 Spring 的 Exception 翻译等优点。

# objective-c - 如何正确链接自定义 UITableViewCell 和访问元素

> ID：11977857
> 
> 赞同：2
> 
> 时间：2012-08-15T21:48:41.060
> 
> 标签：objective-c, ios, uitableview

我在创建自定义 UITableViewCell 时遇到了难以置信的困难。我已经彻底检查了 stackoverflow 和 google，但发布的所有解决方案要么不完整、不正确，要么做得不够。

所以这就是我想要做的。我想在自定义单元格中加载 MyTableViewController，我们称它们为 MyCustomCell，而不是默认单元格。我希望 MyCustomCell 成为 UITableViewCell 的完整子类，所以我有一个只有一个 UITableViewCell（以及其中的一些测试标签）的 .xib。单元标识符设置为“MyCustomCell”，类设置为“MyCustomCell”。我可以使用 MyCustomCell.h 拖动标签并将其链接起来。

回到 MyTableViewController.m，我得到了以下代码

```
-(UITableViewCell*)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath
{
static NSString *ident = @"MyCustomCell";

MyCustomCell *cell = [tableView dequeueReusableCellWithIdentifier:ident];//appears to crash here
if(cell == nil){
    NSArray *topLevelObjects = [[NSBundle mainBundle] loadNibNamed:ident owner:self options:nil];
    for(id currentObject in topLevelObjects){
        if([currentObject isKindOfClass:[MyCustomCell class]]){
            cell = (MyCustomCell*)currentObject;
            break;
        }
    }
}
cell.myCustomLabel.text = @"hello world";//myCustomLabel from the .xib is linked up to the 
//proper variable in MyCustomCell.h, and it's also being synthesized
//I'd like to modify all the custom labels,imageviews,etc here
return cell;
} 
```

运行它会给我以下错误：

```
Terminating app due to uncaught exception 'NSUnknownKeyException', reason: '[<MyTableViewController 0x7d5ba80> setValue:forUndefinedKey:]: this class is not key value coding-compliant for the key myCustomLabel.' 
```

当我忘记将某些东西与 .xib 和它的 .h 文件挂钩时，通常会出现这种情况，或者可能在它没有合成时出现，但我已经检查过，它似乎可以解决。我在这里做错了什么吗？我必须做 [[MyCustomCell alloc] init] 或 [[MyCustomCell alloc] initWithCustomMethod:...] 吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T21:53:59.827

如果您的目标是 iOS 5，请使用以下命令：

```
 [self.tableView registerNib:[UINib nibWithNibName:@"yourNibName" bundle:nil] forCellReuseIdentifier:@"yourNibIdentifier"]; 
```

然后，您只需使用标识符从笔尖获取单元格

```
[tableView dequeueReusableCellWithIdentifier:CellIdentifier]; 
```

最后：确保您实际上为您的 UITableViewCell 子类的 nib 分配了正确的类名和正确的标识符。

# excel - 返回由索引和匹配查找确定的范围的最大值

> ID：11977858
> 
> 赞同：7
> 
> 时间：2012-08-15T21:48:42.617
> 
> 标签：excel, excel-formula, max, excel-2010, excel-match

我需要一个单元格来显示由索引和匹配公式定义的行的最大值。我知道这将是一个数组函数，但我正在努力使语法正确。这是我的数据的样子。我用列字母和行号（如 Excel）对其进行了布局。

在第二个表中使用下表作为参考。当我`b`在单元格`A1`和`y`列中输入时，单元格中`B1`的公式`C1`应该返回该值`35`，因为是由和使用确定的行上的`35`列中的最大值和`C:F``A1``B1``INDEX``MATCH`

表格1。

```
 A      B      C     D     E     F
1    a      x      25    6     23    11
2    a      y      39    15    42    19
3    b      x      28    34    51    24
4    b      y      27    19    15    35
5    b      z      38    26    12    18
6    c      x      12    19    22    15 
```

现在......我想要做的是创建一个公式，该公式在与中的值匹配的行中找到列`C`的最大值，并在单独的表中给出。对于此示例，我们将在单元格中编写公式。该公式应该根据 column和 column的匹配（公式告诉我们是 row ）取最大值through 。在这种情况下，我想要的值是因为它是 row 上 4 列 ( )的最大值。`F``A``B``C1``C``F``A = b``B = y``4``35``C:F``4`

这是我的第二个表格应该是这样的，公式在行中`C`

表 2。

```
 A      B      C
1    b      y      35
2    a      x      25
3    b      z      38
4    c      x      22 
```

我试过这个：（公式在表2中，所以它没有在公式的匹配部分明确声明。你还必须熟悉excel中的表格才能得到它）

```
 =INDEX(MAX(Table1[C]:Table1[F]),MATCH([@A]&[@B],Table1[A]&Table1[B],0)) 
```

然后我用`Control`++将它`Shift` 包装`Enter` 到数组中。

当我将`MAX`函数放在`INDEX`. 有没有办法解决这个问题？也许我应该使用一组完全不同的功能？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2012-08-15T22:01:49.637

You don't need an index match formula. You can use this array formula. You have to press `CTL` + `SHIFT` + `ENTER` after you enter the formula.

```
=MAX(IF((A1:A6=A10)*(B1:B6=B10),C1:F6)) 
```

**SNAPSHOT**

![enter image description here](../Images/89b436e99d1db02ad1557270c7d09911.png)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-12-23T12:57:53.237

您可以在查找最大值时轻松地将匹配类型更改为 1，或者在查找最小值时将匹配类型更改为 -1。

# ios - IOS，AVCam，如何预览拍摄的图像？

> ID：11977859
> 
> 赞同：2
> 
> 时间：2012-08-15T21:48:44.500
> 
> 标签：ios, uiimageview, preview, avcapture

使用 AVCam 示例，我看不到如何访问 AVCamViewController.m 文件中的图像。我想预览捕获的图像，但我看不到如何在方法中访问此图像：`- (IBAction)captureStillImage:(id)sender`在行之后：`[[self captureManager] captureStillImage];`

我想像这样以编程方式添加预览：

```
 UIImageView *imageView = [[UIImageView alloc] initWithFrame:CGRectMake(0, 0, 320/5, 480/5)];
    [imageView setImage:[captureManager image]];
    [self.view addSubview:imageView];
    [imageView release]; 
```

我试图在这里寻求帮助，但一直未能。这里有人有一些提示吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2012-09-10T09:18:10.683

AVcam 将捕获的图像存储在照片库中，您需要访问照片库中最后保存的图像，您可以使用此方法。您还需要添加 AssetsLiberary.framework 以使用此 als 添加此#include 在 .h 文件中

```
 #include <AssetsLibrary/AssetsLibrary.h>

    @interface PhotoViewController :  UIViewController<UIImagePickerControllerDelegate,UIPopoverControllerDelegate>{

        ALAssetsLibrary *assetsLibrary;
    }
    - (void)viewDidLoad
    {
        assetsLibrary = [[ALAssetsLibrary alloc] init];
        [self updateLastPhotoThumbnail];

      }
- (void)updateLastPhotoThumbnail
{
    [assetsLibrary enumerateGroupsWithTypes:ALAssetsGroupSavedPhotos usingBlock:^(ALAssetsGroup *group, BOOL *stop) {
        NSInteger numberOfAssets = [group numberOfAssets];
        if (numberOfAssets > 0) {
            NSInteger lastIndex = numberOfAssets-1;
            [group enumerateAssetsAtIndexes:[NSIndexSet indexSetWithIndex:lastIndex] options:0   usingBlock:^(ALAsset *result, NSUInteger index, BOOL *stop) {
                UIImage *thumbnail = [UIImage imageWithCGImage:[result thumbnail]];
                if (thumbnail && thumbnail.size.width > 0) {
                    YouImageView.image = thumbnail;
                    *stop = YES;
                }
            }];
        }
    } failureBlock:^(NSError *error) {
        NSLog(@"error: %@", error);
    }];
} 
```

# mysql - MySQL 多查询或使用 IN(value1,value2,value3)

> ID：11977861
> 
> 赞同：1
> 
> 时间：2012-08-15T21:48:53.603
> 
> 标签：mysql, performance

简单介绍一下：

我有一个表`t1( id(mediumint), string(varchar(45) )`都属于主键。

我需要在这个表中找到 5 个字符串，比如说。而这张表就像 5M + 行。

什么会更快？

1.  一个查询使用`IN()`：

    ```
    SELECT id, string FROM t1 WHERE string IN (value1,value2,...,value5) 
    ```

    或者

2.  五个查询，每个值一个：

    ```
    SELECT id, string FROM t1 WHERE string = value1
    SELECT id, string FROM t1 WHERE string = value2
    '
    '
    SELECT id, string FROM t1 WHERE string = value5 
    ```

应用程序服务器和数据库服务器将在同一个网络上（100Mbit 或 1Gbit，尚不确定），而不是在同一台机器上。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-08-15T21:54:38.030

大多数情况下，使用单个查询可能比使用多个查询更快，因为它避免了解析、发送查询和接收多个单独响应的开销，并且允许更好的优化。如有疑问，请提供个人资料。

还要记住查询的长度。大多数数据库服务器对查询字符串的长度都有限制。因此，如果您有很长的值列表，您应该分批发送它们。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-15T21:51:58.200

使用 IN() 的一个查询应该更快。确保您有一个以“字符串”作为第一列的索引。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-08-15T21:56:02.487

只有当您在查询中需要复杂且可能有多个 JOIN 时，才会有多个查询更快、更高效，而不是从单独的表中获取单独的结果并将它们 JOIN 到应用程序的内存中。**主要作为一种节省传输时间/带宽的方式。**
最好每隔一次运行单个查询。

# javascript - jquery 到 javascript - $.ajaxSetup()

> ID：11977863
> 
> 赞同：0
> 
> 时间：2012-08-15T21:48:59.937
> 
> 标签：javascript, jquery

因为我在我的项目中使用 ExtJs 框架，所以我不能在我的项目中使用 jquery。现在我在 jquery 中有一段代码（如下所示），有人可以帮我将 jquery 转换为 javascript 吗？谢谢

```
setup: function (networkErrorCallback) {
        this._networkErrorCallback = networkErrorCallback;

        var self = this;
        //$.support.cors = true;
        $.ajaxSetup({
            type: "GET",
            contentType: "application/json; charset=utf-8",
            dataType: "jsonp",
            jsonp: "method",
            timeout: 30000,
            error: function (XMLHttpRequest, textStatus, errorThrown) { self._networkErrorCallback(); },
            cache: false
        });
    } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T21:58:25.217

看看[jQuery.noConflict](http://api.jquery.com/jQuery.noConflict/)

它使您能够与 jQuery 一起使用另一个库。

你会像这样使用它：`jQuery.ajaxSetup`

您需要做的就是添加`$.noConflict()`

```
<script type="text/javascript" src="other_lib.js"></script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript">
  $.noConflict();
  // Code that uses other library's $ can follow here.
</script> 
```

您还可以分配另一个前缀而不是`jQuery`. 例子：

```
var j = jQuery.noConflict();
// Do something with jQuery
j("div p").hide();
// Do something with another library's $()
$("content").style.display = 'none'; 
```

[http://api.jquery.com/jQuery.noConflict/](http://api.jquery.com/jQuery.noConflict/)

如果您想放弃所有这些库，请查看：**[MicroJS](http://microjs.com/#)**

# mysql - 如何让mysql返回看涨值最高的行？

> ID：11977865
> 
> 赞同：2
> 
> 时间：2012-08-15T21:49:04.210
> 
> 标签：mysql, aggregate-functions

考虑下表：

```
stock    _date       return2  bullishness
-----------------------------------------
1        2011-03-14  0.10     0.75
2        2011-03-14  0.05     1.75
3        2011-03-14  0.11     1.00
1        2011-03-15  0.03     1.99
2        2011-03-15  0.30     4.00
3        2011-03-15  0.00     0.60 
```

我正在寻找一个查询，它将：

*   查看特定的`bullishness`for all s`stock``_date`
*   并返回最高的行`bullishness`

我本来期望的，因为`2011-03-14`要做到这一点

```
SELECT MAX(bullishness) as bullishness, stock, return2 
FROM stocks 
WHERE _date = '2011-03-14' 
```

但这总是返回第一行，在这种情况下：

```
1   2011-03-14  0.10  0.75 
```

虽然我希望查询返回第二行（因为它的 a`bullishness`为 1.75，高于 0.75）：

```
2   2011-03-14  0.05  1.75 
```

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-08-15T21:52:17.013

诸如此类的[聚合函数](http://dev.mysql.com/doc/refman/5.0/en/group-by-functions.html)`MAX()`不会按照您期望的方式工作。

你可以使用这个技巧来得到你想要的：

```
SELECT bullishness, stock, return2 
FROM stocks 
WHERE _date = '2011-03-14'
ORDER BY bullishness DESC
LIMIT 1 
```

你基本上是按看涨下降的顺序排列的，所以最大的看涨首先出现。那么你只限于一个结果。

# java - Android - 每次更改变量的值时更新通知

> ID：11977868
> 
> 赞同：1
> 
> 时间：2012-08-15T21:49:31.603
> 
> 标签：java, android

我有一个小型通知应用程序，它将变量“int a”查看到状态通知中。在我启动应用程序时，变量的值被获取并显示在状态栏中。由于此变量连续变化（大约每 1-2 分钟一次），您能告诉我如何使状态栏自动更新此变量的值以避免每次应用程序都重新加载吗？我希望我很清楚。谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T22:30:21.243

您只需要发送一个包含新 int 值的新通知。

只需确保设置标志 Notification.FLAG_AUTO_CANCEL，它将用您发送的新通知替换您现有的通知。

# asp.net - 如何以编程方式将“PreviousPageType VirtualPath”（对于“Server.Transfer”从多页设置为一页）？

> ID：11977872
> 
> 赞同：1
> 
> 时间：2012-08-15T21:49:38.900
> 
> 标签：asp.net, asp.net-4.0

我想为几个页面显示一个页面`Server.Transfer`（例如，如果用户导航到 page1 或 page2 - 在这两种情况下，它都会向他显示 page3）。我这样做是因为页面非常相似。

但是，它们之间存在一些差异，我想负责获取发送页面（例如 page1 或 page2）的公共属性，如[MSDN](http://msdn.microsoft.com/en-us/library/6c3yckfw.aspx)上的第四个选项中所示。

但这需要`PreviousPageType VirtualPath`设置为正确的页面 - 这可能是几个之一（例如 page1 或 page2）。我怎么做？

编辑：这是一个网络应用程序项目。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-18T06:08:24.243

这是解决您的问题的另一种方法，使用`Object.GetType()`方法来找出您从哪个页面调用`server.transfer`方法。

**这是 page3 的 page_load 中的代码**

```
 Object prePage=PreviousPage;
    String gotprePage=prePage.GetType().ToString();
    if (gotprePage == "ASP.crosspage3_aspx")
    {
        //now call properties specific to crosspage3.aspx page
        // prePage.GetType().GetProperty("your_property").
        //GetValue(objPreviousPage, null).ToString();
    }
    else
    {
        if (gotprePage == "ASP.crosspage4_aspx")
        {
            //now call properties specific to crosspage4.aspx page
        }
    } 
```

# php - 如何使用 php 将 html 标签写入另一个 html 文件？

> ID：11977873
> 
> 赞同：3
> 
> 时间：2012-08-15T21:49:42.680
> 
> 标签：php, html, writefile

我有两个文件。一个是input.php，另一个是output.html。
内部 input.php 文件的代码如下：

```
<?php

   $file="output.html";
   $doc=new DOMDocument('1.0');
   $doc->loadHTMLFile($file);
   $elements = $doc->getElementsByTagName('head');

   $jscript=$doc->createElement("script");
   $jstype=$doc->createAttribute("type");
   $jstText=$doc->createTextNode("text/javascript");
   $jstype->appendChild($jstText);
   $jscript->appendChild($jstype);
   $jssource=$doc->createAttribute("src");
   $jssText=$doc->createTextNode("xxxxx.js");
   $jssource->appendChild($jssText);
   $jscript->appendChild($jssource);
   $elements->item(0)->appendChild($jscript);
   $doc->save("output.html");   
?> 
```

在 output.html 文件中：

```
<code>   
 <html>
   <head>
   </head>
   <body>
   </body>
 </html>
</code> 
```

实际上，我想添加下 output.html 的“头”。但是现在有两个问题。

1.虽然内容可以写在output.php文件中，但总是在文件的第一行，导致html页面打不开。

2.标签总是添加为 . （xml 格式）。它不起作用，我需要（html格式）

有没有解决这2个问题的方法？或者有没有其他方法可以实现我的目标？（在 input.php 文件中我尝试了 saveHTML() - 仍然不起作用）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T22:12:44.113

从文档

> DOMDocument::save — 将**内部 XML 树**转储回文件中

所以难怪你会得到一个 XML 表示。您应该`DOMDocument::saveHTMLFile`按照评论中的建议尝试，或者您可以尝试`echo $doc->saveHTML();`

# php - 在 vbulletin 4 模板中进行 preg 替换

> ID：11977882
> 
> 赞同：1
> 
> 时间：2012-08-15T21:50:41.647
> 
> 标签：php, vbulletin

我想要代码替换钩子上的 vbulletin 模板中的一个单词 (global_start ....)

vb3中的代码

```
$vbulletin->templatecache['SHOWTHREAD'] = preg_replace("#word#", "replace", $vbulletin->templatecache['SHOWTHREAD']); 
```

但我想要它用于 vbulletin 4

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T22:04:00.463

You should use str_replace instead:

```
$vbulletin->templatecache['SHOWTHREAD'] = str_replace("word", "replace", $vbulletin->templatecache['SHOWTHREAD']); 
```

# php - 如何在 PHP 中回显大文本变量

> ID：11977883
> 
> 赞同：0
> 
> 时间：2012-08-15T21:50:45.550
> 
> 标签：php, mysql

我有一个从数据库中提取并在回显之前对其进行操作的字符串变量。我收到“内存不足”错误，我怀疑这是因为某些实例很大，例如 500 个字符。我总是可以增加内存限制，但在这种情况下我不想这样做，因为这是在我网站上的一个公共页面上，我希望避免对我的服务器上的内存征税。我在 Stackoverflow 上看到了另外两个线程，但它们并不密切相关；一位推荐了我不熟悉的heredoc语法；如果这是一种适当的方法，有人可以向我解释吗？其他想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T21:56:29.570

我认为我们需要一些代码来查看这里出了什么问题。500 个字符永远不会导致内存不足错误（除非 memory_limit 设置为 < 1MB 左右）。

一定有其他东西（比如循环）导致了这个问题，但是没有代码，我猜我们无法帮助你

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T22:49:13.267

PHP 最多可以容纳 2 GiB 的字符串，并且脚本默认设置为 1 GiB 的内存限制。500 个字符（~500-2000 B）应该没问题。请向我们提供更多信息和代码:)

# php - 如何在一段文本中插入然后执行 PHP 代码（从 MySQL 检索后）？

> ID：11977885
> 
> 赞同：0
> 
> 时间：2012-08-15T21:51:00.807
> 
> 标签：php, mysql, include, preg-replace, eval

我有一个我管理的博客，其中大部分是纯文本，其中包含一些 HTML。在检索该博客的文本以进行显示时，我希望在该文本中执行一行 PHP 代码，同时希望避免将 PHP 代码放置在我的数据库中。我使用 MySQL。

在大多数情况下，PHP 代码类似于`<? include "phpfile.php"; ?>`. 我将使用它来插入增强功能，例如投票、幻灯片等。

过去，我依靠 iframe 来保存 PHP 文件。

```
This is the blog text. <a id='marker'></a> 
This is the second part of the blog text. 
```

我使用“preg_replace()”将我的标记 ( `<a id='marker'></a>`) 替换为 iframe 的代码。这会产生以下内容，我用 PHP 将其回显到我的页面：

```
This is the blog text. <iframe src='phpfile.php'></iframe>
This is the second part of the blog text. 
```

这很好用，但我希望能够在没有必须猜测 iframe 所包含内容的高度和宽度的情况下工作。

在阅读其他线程/问题时，我考虑了这些：

*   在用户进入他的博客后将 PHP 代码插入我的数据库（坏主意）

*   在我用代码替换“标记”后，使用“eval”以某种方式执行我的 PHP 代码？我不确定如何一步完成。我想我将不得不做类似下一个方法的事情。（我认为应该尽可能避免使用“eval()”！！！）

*   将博客文本分成两部分（保存在变量中）。我可以做连续的“回声”语句（每个博客部分一个），用`include "phpfile.php";`. 我不确定这对我的服务器来说有多大的内存密集度——我会处理，比如说，大约 50kb 的文本块。

除了最后一种方法，我觉得必须有一种更简单的方法来插入 PHP 代码并执行它。

tia 的任何建议。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T22:05:05.137

您可以简单地使用 str_replace 来解决这个问题：

你的文字：

```
Hello world, i want [phpcode] here 
```

脚本：

```
<?php $text = str_replace( "[phpcode]", phpcode(), $text); 
```

然后在你的代码中定义 phpcode() 并做任何你想做的事情。

您还可以使用正则表达式来更改它，并将“[]”之间的文本替换为函数名称：

你好世界，我想要 [php:functionName] 这里

# php - MySQL 查询花费的时间比第一次运行的时间长（但仅在选择某个字节阈值时）

> ID：11977886
> 
> 赞同：2
> 
> 时间：2012-08-15T21:51:08.330
> 
> 标签：php, mysql, performance

我第一次在页面加载时运行这个查询，它总是需要大约 100 毫秒，即使它应该需要大约 1 毫秒。我已经通过 MySQL 控制台和 PhpMyAdmin 运行了完全相同的查询，而且它总是很快。

我在 PHP 中对它进行了计时，如下所示：

```
$t = microtime(true);
mysql_query($sql, $this->id);
die((microtime(true)-$t)*1000); 
```

如果我第二次运行完全相同的查询（例如通过复制中间行），第二次几乎立即运行。

查询如下所示：

```
SELECT `user_id`, `login`, `first_name`, `last_name`, `name`, `email`, ... FROM `users` WHERE `user_id`='1000' LIMIT 1 
```

通过实验我发现，如果我减少我选择的字段数量，它会突然跑得很快。当我添加第 26 列时，它从 1 毫秒跳到 100 毫秒。第 26 列是什么似乎无关紧要，即使是像“1”这样的常数，它也会突然变慢。

这可能是什么原因造成的，我该如何解决？

* * *

架构：

```
CREATE TABLE `user` (
    `f1` int(11) unsigned NOT NULL DEFAULT '0',
    `f2` varchar(50) NOT NULL DEFAULT '',
    `f3` varchar(32) NOT NULL DEFAULT '',
    `f4` varchar(50) DEFAULT NULL,
    `f5` varchar(50) DEFAULT NULL,
    `f6` varchar(100) NOT NULL DEFAULT 'Anonymous',
    `f7` varchar(100) DEFAULT NULL,
    `f8` varchar(100) NOT NULL DEFAULT 'Anonymous',
    `f9` tinyint(1) NOT NULL DEFAULT '0',
    `f10` tinyint(1) unsigned NOT NULL DEFAULT '0',
    `f11` varchar(250) DEFAULT NULL,
    `f12` int(10) unsigned NOT NULL DEFAULT '0',
    `f13` varchar(250) NOT NULL DEFAULT '',
    `f14` int(10) unsigned NOT NULL DEFAULT '0',
    `f15` varchar(100) DEFAULT NULL,
    `f16` varchar(25) DEFAULT NULL,
    `f17` varchar(25) DEFAULT NULL,
    `f18` varchar(25) DEFAULT NULL,
    `f19` varchar(200) DEFAULT NULL,
    `f20` varchar(50) DEFAULT NULL,
    `f21` varchar(50) DEFAULT 'BC',
    `f22` varchar(50) DEFAULT 'Canada',
    `f23` varchar(20) DEFAULT NULL,
    `f24` bigint(20) unsigned NOT NULL DEFAULT '0',
    `f25` bigint(20) unsigned NOT NULL DEFAULT '0',
    `f26` int(5) unsigned zerofill NOT NULL DEFAULT '00000',
    `f27` tinyint(1) NOT NULL DEFAULT '0',
    `f28` tinyint(1) unsigned NOT NULL DEFAULT '0',
    `f29` tinyint(1) NOT NULL DEFAULT '0',
    `f30` tinyint(1) unsigned NOT NULL DEFAULT '0',
    `f31` varchar(50) DEFAULT NULL,
    `f32` varchar(100) NOT NULL DEFAULT '',
    `f33` bigint(20) unsigned NOT NULL DEFAULT '0',
    `f34` bigint(20) unsigned NOT NULL DEFAULT '0',
    `f35` varchar(250) DEFAULT NULL,
    `f36` text NOT NULL,
    `f37` tinyint(1) unsigned NOT NULL DEFAULT '0',
    `f38` bigint(20) NOT NULL DEFAULT '0',
    `f39` bigint(20) NOT NULL DEFAULT '0',
    `f40` tinyint(1) unsigned NOT NULL DEFAULT '0',
    `f41` tinyint(1) unsigned NOT NULL DEFAULT '0',
    PRIMARY KEY (`f1`),
    UNIQUE KEY `f2` (`f2`)
) ENGINE=MyISAM DEFAULT CHARSET=latin1; 
```

我更改了字段名称以保护无辜者。

* * *

**更新：**我可能对魔法列限制有误。我认为这毕竟是一个字节限制......我尝试了所有数字，除了我实际需要的少数字段：

```
SELECT `f1`, `f2`, `f3`, `f4`, `f5`, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55 FROM `wx_user` WHERE `user_id`='1000' LIMIT 1 
```

运行时间为 1 毫秒。如果我在末尾添加“56”，则需要约 100 毫秒。

* * *

我做了更多的测试：

```
mysql_query("SELECT 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa' FROM `user` WHERE `f1`='1000' LIMIT 1"); 
```

在 1200 到 1300 a 之间的某个地方，它从 1 毫秒跳到 100 毫秒。

我可以使用更多列但更小的数据（整数）重复同样的事情。

这向我暗示了两件事：

1.  它与发送的字节数有关
2.  添加额外列的开销非常大，因为选择大约 50 个整数与选择单个 1300 个字符字段的效果相同。

现在我想起来，这个数字非常接近约翰建议的数字。1300 个字符 + 开销可能等于 John 提到的 1500 MTU 限制。

这是 MySQL 设置还是操作系统设置？我可以尝试什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T22:37:54.233

正如约翰所说，第二次运行相同的查询从缓存中检索结果，所以它几乎是即时的。

话虽如此，在某些情况下，当添加第 X 列时，查询可能“运行”的时间比它应该运行的时间长。几种可能：

*   第 X 列非常大（如 CHAR(65000)），传输它需要时间，
*   所有（X-1）列都是已经在 MySQL 内存中的索引的一部分，但是对 Xth 列的引用会强制 MySQL 从驱动器中读取行，
*   同时查询锁定引用的表或导致 CPU/hdd/内存负载，
*   第 X 列是 TEXT/BLOB 并且必须进行额外的磁盘查找以从外部文件中检索列值（BLOB 和 TEXT 值存储在表数据文件之外），
*   第 X 列为必须从 MySQL 服务器发送到应用程序的行数据添加了足够的字节，以至于必须使用两个或多个网络数据包来传输整行。如果你真的，真的，我的意思是**真的**必须从查询中挤出每一毫秒确保查询结果适合一个 MTU 帧（通常是 1500 字节） - 使用嗅探器来确认它，
*   其他情况是相当低的水平，普通人在现实世界中看不到它们。

您还可以使用内置的 MySQL 查询分析来找出哪个查询执行阶段需要这么多时间。跑：

```
SET profiling = 1;
[..run Your queries, each one is numbered..]
SHOW PROFILE FOR QUERY n; -- SHOW PROFILE FOR QUERY 1;
SET profiling = 0; 
```

您应该对花费额外时间的地方有很好的了解。在此处阅读有关查询分析的更多信息：[MySQL 查询分析](http://dev.mysql.com/doc/refman/5.0/en/show-profiles.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-15T22:00:02.517

MySQl 会缓存您的查询，因此您第二次执行它时，它会从缓存中加载并且会快得多。

还要确保在您的表上有正确的索引，因为这可以大大加快速度。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-04-10T14:33:58.677

嗯，MySQL 有一个缓存，它可以加快速度，这一切都是真的……

**但不仅如此。**问题不在您的查询中。我遇到同样的事情，我无法调试它的原因正是缓存：我不能再次产生同样的问题。不仅仅是 MySQL，它也是缓存内容的文件系统，因此完全不可能重现最初的缓慢 - 另外我不确定它是否会第二次发生，也许背后的原因导致它不会发生再次。尝试重新启动 MySQL，尝试刷新缓存，但没有任何东西可以重现第一次运行。

**还有更神秘的！**有一个没有意义的解决方法：如果您在查询之前执行 CHECK TABLE（并确保它只是第一次！），查询本身将以正常速度运行。不，与已经缓存时的速度不同；这是一个正常但仍然是第一次的速度。如您所料，再次调用它会立即产生结果。

现在每个人都点头说“当然，文件系统在执行 CHECK 时会缓存表文件，因此下次运行速度会更快”。 **但事实并非如此。** 如果我尝试使用任何其他程序将 MYD 文件读入内存（我做了一个简单的“复制”），它并不能解决问题，即使我也复制了索引。然而，CHECK 似乎做了一些真正有帮助的事情。

**结论：** - 这不是一个简单的“慢查询”问题，这是黑暗巫术。显然，这种解决方法不适用于生产环境。我之所以提到它，是因为它显示了两件重要的事情：

1.  不同之处不仅在于缓存。还有更多。
2.  在开发期间，您可以针对该问题应用简单的修复程序。

希望这对那里的一些人有所帮助-花了我几天时间:)

# c# - 托管 DirectX：将 HLSL 效果应用于表面

> ID：11977892
> 
> 赞同：2
> 
> 时间：2012-08-15T21:51:43.420
> 
> 标签：c#, winforms, directx-9, pixel-shader

首先，我是一个完整的 DirectX 菜鸟。我正在将位图加载到表面中，并且需要在显示之前对其应用 HLSL 效果。目标是在图像上显示实时效果。无论出于何种原因，图像显示但没有效果。

我*认为*这可能与我将表面拉伸到后缓冲区并规避效果有关，但我不知道如何解决它。最终，这个表面将包含一个立体图像对加上 Nvidia 的立体图像签名，以便它与 3D Vision 一起使用。虽然这对这个问题无关紧要，但它可以解释为什么我使用表面，而其他方法可能更好。

这是我的代码：

在表格中：

```
public partial class frmMain : Form
{
    private Device device;
    private Effect effect = null;
    private Surface ImageSurface;
    private Rectangle ImageSize;

    public frmMain()
    {
        InitializeComponent();
    }

    public bool InitializeGraphics()
    {
        //Get Bitmap
        Bitmap MyImage = (Bitmap)Bitmap.FromFile(@"C:\test\OD_1_L.jpg");
        ImageSize = new Rectangle(0, 0, MyImage.Width, MyImage.Height);

        //Set Presentation Parameters
        PresentParameters presentParams = new PresentParameters();
        presentParams.Windowed = true;
        presentParams.SwapEffect = SwapEffect.Discard;
        presentParams.AutoDepthStencilFormat = DepthFormat.D16;
        presentParams.EnableAutoDepthStencil = true;
        presentParams.BackBufferFormat = Format.A8R8G8B8;
        presentParams.BackBufferCount = 1;
        presentParams.BackBufferWidth = MyImage.Width;
        presentParams.BackBufferHeight = MyImage.Height;
        presentParams.PresentationInterval = PresentInterval.One;

        bool canDoShaders = true;

        //Determine whether or not the hardware can support shaders...
        Caps hardware = Manager.GetDeviceCaps(0, DeviceType.Hardware);

        if (hardware.VertexShaderVersion >= new Version(1, 1))
        {
            //Default to software processing
            CreateFlags flags = CreateFlags.SoftwareVertexProcessing;

            //Use hardware if it's available
            if (hardware.DeviceCaps.SupportsHardwareTransformAndLight)
            {
                flags = CreateFlags.HardwareVertexProcessing;
            }

            //Use pure if it's available
            if (hardware.DeviceCaps.SupportsPureDevice)
            {
                flags |= CreateFlags.PureDevice;
            }

            //Create Device
            device = new Device(0, DeviceType.Hardware, this, flags, presentParams);

            //Create effect
            effect = Effect.FromFile(device, @"..\..\invert.fx", null, ShaderFlags.None, null);
            effect.Technique = "InvertTechnique";

        }
        else
        {
            //No Shader Support
            canDoShaders = false;

            //Create a reference device
            device = new Device(0, DeviceType.Reference, this, CreateFlags.SoftwareVertexProcessing, presentParams);
        }

        //Create Image Surface...            
        ImageSurface = Surface.FromBitmap(device, MyImage, Pool.Default);

        return canDoShaders;
    }

    protected override void OnPaintBackground(PaintEventArgs e)
    {
        //do nothing
    }

    protected override void OnPaint(PaintEventArgs e)
    {
        device.Clear(ClearFlags.Target | ClearFlags.ZBuffer, Color.CornflowerBlue, 1.0f, 0);

        Surface backbuffer = device.GetBackBuffer(0, 0, BackBufferType.Mono);

        device.BeginScene();
        int numPasses = effect.Begin(0);
        for (int i = 0; i < numPasses; i++)
        {
            effect.BeginPass(i);
            device.StretchRectangle(ImageSurface, ImageSize, backbuffer, ImageSize, TextureFilter.None);
            effect.EndPass();
        }
        effect.End();
        device.EndScene();
        device.Present();

        this.Invalidate();
    }
} 
```

在着色器中：

```
sampler2D input : register(s0); 
float inversionAmount : register(c0);

float4 Invert(float2 uv : TEXCOORD) : COLOR { 
float4 color;
color = tex2D(input, uv.xy); 

//this changes inversion
float4 inverted_color =  1 - color;
inverted_color.a = color.a;
inverted_color.rgb *= inverted_color.a;
return inverted_color;
}

technique InvertTechnique
{
  pass P0
  {
    CullMode = None;

    // shaders
    VertexShader = null;
    PixelShader  = compile ps_1_1 Invert();
  }
} 
```

# php - 使用 PHP Simple HTML DOM Parser 获取评论

> ID：11977896
> 
> 赞同：2
> 
> 时间：2012-08-15T21:51:47.330
> 
> 标签：php, parsing, dom, html-parsing

我正在使用 PHP Simple HTML DOM Parser。

我想知道是否可以提取 HTML 注释 ( `<!-- -->`)。

你可以吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-08-15T21:53:44.833

直接来自他们的文档：

```
// Find all comment (<!--...-->) blocks 
$es = $html->find('comment'); 
```

[http://simplehtmldom.sourceforge.net/manual.htm](http://simplehtmldom.sourceforge.net/manual.htm)

# java - 无法从 Java 中的锁定文件读取或写入

> ID：11977901
> 
> 赞同：0
> 
> 时间：2012-08-15T21:52:05.830
> 
> 标签：java, concurrency, filelock

我已经使用 Java 中的 FileLock 锁定了一个文件，但现在我无法读取或写入它。我该怎么办？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T21:52:05.830

虽然这个问题可能有很多潜在的解决方案，但我发现以下工作非常好：

```
// Gets a readable and writable channel to your file.
FileChannel channel = new RandomAccessFile(yourFile, "rw").getChannel();

// Allows you to read from the file.
InputStream in = Channels.getInputStream(channel);

// Allows you to write to the file.
OutputStream out = Channels.getOutputStream(channel);

// Lock the file here as you see fit to prevent concurrency issues.
// As a concrete example, you could attempt to lock the file using "channel.tryLock()"
... 
```

当我遇到这个问题时，我发现它非常令人沮丧，所以我想我会与可能需要它的其他人分享我的解决方案。

# python - QT 的 wxStaticBox 等价物

> ID：11977906
> 
> 赞同：4
> 
> 时间：2012-08-15T21:52:28.187
> 
> 标签：python, qt, pyqt, pyside

在 wxpython 中，我可以将 staticbox 与 staticboxsizer 结合使用，在小部件周围制作一个带有标题的框，如下所示：

![wxstaticbox](../Images/997710f0724d14937e0fe16709b89047.png)

我对 qt 相当陌生，不知道所有的小部件，所以也许我错过了一些微不足道的东西，但我怎样才能在 pyqt/pyside 中实现呢？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-08-15T21:56:31.040

它被称为[QGroupBox](http://doc.qt.nokia.com/latest/qgroupbox.html)：

![在此处输入图像描述](../Images/624e367991ded4af2555f582508a5e74.png)

您可以通过 GUI 编辑器（我的首选方法）创建它，也可以`QGroupBox()`在 Python 中创建一个对象并将其添加到窗口的布局中。

# actionscript-3 - FlashBuilder 4.6 vs. FDT 5.5 Free vs. FlashDevelop 4.0 vs IntelliJ IDEA

> ID：11977907
> 
> 赞同：0
> 
> 时间：2012-08-15T21:52:32.053
> 
> 标签：actionscript-3, apache-flex, ide

亲爱的 Flex/Flash 开发人员，

考虑到您必须为未来（至少）3 年的 flex web 和 AIR 移动开发选择一个新的 IDE，您会选择什么作为最佳选择？

我在 flex/flash builder 上工作了大约 6 年，但我可以说我有时对使用非常昂贵的许可证获得的功能数量和性能不满意。

我开始评估 FDT，我觉得它很棒。不幸的是，我认为高级版本仍然很昂贵，而我正在考虑使用的免费版本缺少很多“核心”功能（例如 - 分析）。

最近我通过一些随机的事实回到 FlashDevelop，发现它看起来比旧版本好得多（至少从规范方面）。

现在我有点困惑，我想知道，也许你最近做出了同样的决定，你的选择是什么，为什么......？

期待您的回答，祝您编程愉快！

**更新：** 不幸的是，我对 IntelliJ IDEA 没有太多经验。但是，如果您可以提供有关为什么/如何使用它的更多详细信息，那就太好了。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T22:02:48.433

It seems like you answered your own question already. FlashBuilder is too expensive for what it does, and FDT is too expensive compared to FlashDevelop.

I would rule out FlashBuilder right away, and then ask if FDT is worth the extra $.

If you're on a pc, I don't really see a reason to chose anything but Flashdevelop. FD is developed actively, it is free, and and last time I checked (though it wasn't recently) it does about the same that FDT. The shortcuts that FD has are very helpful, if you're going from FlashBuilder, and essential when going from FDT.

I've been programming AS in FlashDevelop for a long time now, and they've added a lot of good features since, like the debug and profiler. and I have not needed to switch to any other environment.

# ios - ShareKit 分享者只显示一次？

> ID：11977911
> 
> 赞同：1
> 
> 时间：2012-08-15T21:53:20.620
> 
> 标签：ios, modalviewcontroller, sharekit, null

这个问题有点具体，但我还是要问。因此，我已正确遵循此处安装 ShareKit 2.0 的所有说明：[https ://github.com/ShareKit/ShareKit/wiki/Installing-sharekit](https://github.com/ShareKit/ShareKit/wiki/Installing-sharekit)

一切都编译得很好等等。我添加的唯一文件是包含我的共享者信息的 DefaultSHKConfigurator.m 文件。

所以例如我这样称呼`SHKMail`：

```
SHKItem *item = [SHKItem image:image title:@"Hey"];
        [item setText:myText];
        [item setURL:appURL];
        if ([SHKMail canShare]) {
            [SHKMail shareItem:item];
        } 
```

第一次加载正常没有问题，并且关闭正常。我第二次执行此代码时，设备上没有任何反应。此问题不限于 SHKMail，它会发生在*所有*共享者身上。我已将问题缩小到`SHK.m`班级。

在该`showViewController`方法中，此代码被第二次调用：

```
// If a view is already being shown, hide it, and then try again
    if (currentView != nil)
    {
        self.pendingView = vc;
        [[currentView parentViewController] dismissModalViewControllerAnimated:YES];
        return;
    } 
```

第二次执行我发布的第一个代码片段时，不应调用该代码。无论如何，这可能是什么原因造成的？我还能尝试调试什么？有任何想法吗？

我认为任何帮助我完全解决此问题的人都将获得***50 点赏金***。

感谢任何试图回答这个问题的人！:)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T22:39:02.187

这是在黑暗中拍摄的，但我之前曾因共享工具包问题而把头发拉出来，所以我知道任何事情都是有帮助的。

似乎在第一次关闭视图后，`currentView`never 被设置为 nil。

我看到他们已经更新了一些适用于 iOS 5 的方法。尝试在`SHK.m`

```
- (void)hideCurrentViewControllerAnimated:(BOOL)animated
{
    if (isDismissingView)
        return;

    if (currentView != nil)
    {
        // Dismiss the modal view
        if ([currentView parentViewController] != nil)
        {
            self.isDismissingView = YES;
            [[currentView parentViewController] dismissModalViewControllerAnimated:animated];
        }
        // for iOS5
        else if([currentView respondsToSelector:@selector(presentingViewController)] &&
                [currentView presentingViewController])
        {
            self.isDismissingView = YES;            
            [[currentView presentingViewController] dismissViewControllerAnimated:animated completion:^{                                                                           
                [[NSOperationQueue mainQueue] addOperationWithBlock:^{
                    [[NSNotificationCenter defaultCenter] postNotificationName:SHKHideCurrentViewFinishedNotification object:nil];

                     //THIS IS NEW
                     self.currentView = nil;
                }];
            }];
        }

        else
            self.currentView = nil;
    }
} 
```

`self.currentView = nil;`我只是在 iOS5 中关闭视图后才添加强制调用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-16T00:06:08.687

我也在使用 ShareKit 2.0 进行 Facebook 分享（即 [SHKFacebook shareItem:item]），并没有遇到您目前面临的问题。

我已经在 iPhone Simulator 4.3 和 5.1 中测试了您的代码（即 [SHKMail shareItem:item]），没有任何问题。

可能是您的环境设置不正确，或者您的代码不是最新的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-21T01:18:58.350

通过在 StackOverflow 上查看这个问题，我已经成功解决了这个问题：我最终通过这个答案解决了这个问题：[ShareKit method swizzling in Lion / Xcode 4.3.1?](https://stackoverflow.com/questions/9900189/sharekit-method-swizzling-in-lion-xcode-4-3-1)

几乎只是远离方法混搭。

# ios - 链接图标和社交网络

> ID：11977918
> 
> 赞同：0
> 
> 时间：2012-08-15T21:54:02.103
> 
> 标签：ios, integration, social-networking

我将如何连接图标以登录社交网络（即 Facebook），一旦登录，图标将链接到 Xcode 中的个人资料图片？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T22:24:01.343

首先使用 facebook API 登录。我相信他们都提供了他们的标志来放置到应用程序中。登录后，尝试查看 API。如果没有，您可以使用`UIWebView`来自登录信息中的 javascript 命令将其链接`UIIimage`到个人资料图片。

# actionscript-3 - 是否可以存储 cookie 并通过多个 StageWebView 实例共享？

> ID：11977926
> 
> 赞同：2
> 
> 时间：2012-08-15T21:55:48.013
> 
> 标签：actionscript-3, air, adobe, flash-builder

我在 Flash Builder 中有一个使用 Flex 4.6 和 AIR 3.3 的移动项目。在这个项目中，我有多个视图，其中一些视图内部有一个 StageWebView 来显示一些在线内容。

更具体地说，我使用[StageWebViewBridge 项目](http://code.google.com/p/stagewebviewbridge/)，以便在 AS3 和 Javascript 之间架起一座桥梁。

但是，这些 StageWebView 中显示的某些内容有时需要登录信息。在普通浏览器中，它存储在当前会话中。

由于这些 StageWebView 不共享同一个会话，是否可以将负责会话的 cookie 保留在内存中，然后与所有 StageWebView 共享这些 cookie？

这个问题可以在 C# 中使用 CookieContainer 类以及 HttpWebRequest 轻松解决，所以类似的东西真的很有帮助。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-10-07T19:21:42.597

简短的回答......是的，在某些情况下。

长答案...不，如果您打算保持应用程序浏览器和操作系统独立，则不会。AIR 将与也使用默认操作系统 cookie 机制的浏览器共享它的 cookie，但不能真正跨客户端依赖该功能。如果您希望您的应用程序在 Firefox（或者我相信 Chrome）中运行，这是不可能的。

查看来自的最佳答案： [Cookies working in Flex but not in Air](https://stackoverflow.com/questions/4417348/cookies-working-in-flex-but-not-in-air)

我已经通过一些 hackish URL hash-tag 废话解决了这个问题，我将会话从 AIR 传递到 web 视图，但这显然是在我控制项目的 AIR 和 web 部分 100%（和安全性）的环境中在这个特定的项目中并不是一个大问题）。

# java - 在服务中使用 Google 地图

> ID：11977927
> 
> 赞同：0
> 
> 时间：2012-08-15T21:55:54.143
> 
> 标签：java, android, google-maps, service

全部-我有一个运动追踪器应用程序，其中我有一个`service`正在运行的秒表，因此用户的设备可以进入睡眠状态，而无需秒表停止。我还想`Map`在我的应用程序中包含一个选项卡，以便用户可以看到他们去了哪里。我尝试使用主要活动来完成此操作，并且效果很好，但是每次手机进入睡眠状态时，主要活动都会退出，并随之拉下地图。这在 GPS 中造成了间隙，无法跟踪速度或距离。因此，我尝试将地图放入我的服务中，但遇到了诸如我的服务必须扩展`MapActivity`（但也必须扩展`Service`）之类的问题。这是我尝试过的：

```
public class KeepGoing extends Service { //But also has to extend MapView?  
MapView mapView = null;
MapController mapController = null;
MyLocationOverlay whereAmI = null;

protected boolean isLocationDisplayed() {
    return whereAmI.isMyLocationEnabled();
}

protected boolean isRouteDisplayed() {
    return false;
} 
```

还：

```
 @Override
public int onStartCommand(Intent intent, int flags, int startId) {      
    start();        
    return(START_NOT_STICKY);       
}   

private void start() {

    mHandler.sendEmptyMessage(MSG_START_TIMER);

    LayoutInflater inflater = ( LayoutInflater ) getSystemService( LAYOUT_INFLATER_SERVICE );
    View layout = inflater.inflate( R.layout.activity_main , null );

    mapView = (MapView) layout.findViewById(R.id.mapview);  

    mapView.setBuiltInZoomControls(true);

    mapController = mapView.getController();
    mapController.setZoom(15);

    whereAmI = new MyLocationOverlay(this, mapView);
    mapView.getOverlays().add(whereAmI);
    mapView.postInvalidate(); } 
```

我的方法中没有任何与地图相关的代码`onDestroy`。***我的问题是：如何将 a`mapView`放入服务中，以便它即使在设备处于睡眠状态时也能运行和/或是否有另一种/更好的方法来完成此操作？*** 感谢您的时间和精力！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T22:05:10.963

如果要获取用户去过的坐标，可以使用[Location Manager](http://developer.android.com/training/basics/location/locationmanager.html "位置经理")。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-15T22:06:35.820

> 运行秒表的服务，因此用户的设备可以在没有秒表停止的情况下进入睡眠状态

当设备进入睡眠状态时，秒表肯定会“停止”，因为 CPU 断电并且您的代码停止运行。唯一不会发生的方法是如果您使用`WakeLock`.

话虽如此，您不需要让设备运行来跟踪时间。

> 这在 GPS 中造成了间隙，无法跟踪速度或距离

欢迎您使用`LocationManager`来获取自己的 GPS 定位。但是，“GPS 中的间隙”并不意味着“无法跟踪速度或距离”，主要是因为您**总是**有间隙。间隔是毫秒还是千年肯定会有所不同，但您计算距离和速度的方式相同：距离是通过比较两个 GPS 定位点的位置来确定的，速度是距离除以经过的时间。

> 如何将 mapView 放入服务中，以便即使设备处于睡眠状态也能运行

你不能。

> 和/或是否有另一种/更好的方法来实现这一点？

重新设计您的应用程序以更好地处理设备入睡的情况，或者不允许设备入睡（例如，`android:keepScreenOn="true"`在您的应用程序中`MapView`，或用于确定位置`PARTIAL_WAKE_LOCK`的您`Service`的应用程序中）。`LocationManager`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T22:08:33.650

而不是试图让地图视图在您的服务中运行（不要忘记将在现有活动中运行的地图视图），您应该使用[LocationManager](http://developer.android.com/reference/android/location/LocationManager.html)并存储用户访问的点（通过使用 LocationManager 中的[requestLocationUpdate](http://developer.android.com/reference/android/location/LocationManager.html#requestLocationUpdates%28java.lang.String,%20long,%20float,%20android.location.LocationListener%29)方法找到) 在 ArrayList 或类似的数据结构中，然后您所要做的就是使用这个点列表来显示用户访问过的地方。

# python - 如何将带有变音符号的字符串转换回 JSON

> ID：11977935
> 
> 赞同：3
> 
> 时间：2012-08-15T21:57:10.773
> 
> 标签：python, json, string, decode, encode

我有这个 JSON Python 字符串：

```
linklist = str('
{
   "Download":{
   "Test": "http://www.test.org",
   u"K\xf6ter": "http://www.koeter.de"}
}'
) 
```

我想使用：

```
myJson= json.loads(linklist) 
```

但是我遇到了一个问题，因为 JSON 字符串中有一个德语变音符号

什么是编码/解码此字符串的最佳方法，以便使用 simplejson 将字符串转换为有效的 JSON 对象

**嘿伙计们，这是我想在我的代码中做的事情：**

JSON：链接.json

```
{
 "Download":{
    "Link1ä":"http://www.link1.de/test",
    "Link2ö":"http://www.link2.de/test/cool",
    "Link3ü":"http://www.link3.de/test/foo/bar",
    "Link4ü":{"Link5ü":"http://www.link5.de/test"}
}
} 
```

蟒蛇文件：

```
linksFile = open('links.json', 'r')
linksList = json.load(linksFile) 
```

在此链接列表中，我想搜索测试并将其替换为即**myTest**

如何在此 JSON-Object链接列表中替换所有字符串 -> 测试 -> **myTest**

**非常感谢您的帮助**。我尝试在 JSON 对象上进行替换，并且对变音符号没有任何问题：

```
linksFile = open('links.json', 'r')
linksList = json.load(linksFile)
dump = json.dumps(linksList)
linksList = json.loads(dump.replace('toReplace', 'replacement')) 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T23:20:28.830

如果该字符串是**Köter**，那么您的问题在于编码，而不是 json（反）序列化。看起来你正在使用 cp1250。

尝试明确指定编码（默认的是 UTF-8，这显然不是你的情况）：

```
myJson = json.loads(linklist, 'cp1250') 
```

# javascript - 如何缩小大图像（1600x1200）的大小，使其适合大多数屏幕作为背景？

> ID：11977937
> 
> 赞同：0
> 
> 时间：2012-08-15T21:57:14.220
> 
> 标签：javascript, css

我有一张 1600x1200 的图片

我想用它作为我网站的背景图片。图像应该是静态的，只有内容应该是可滚动的。

这是我尝试过的：

```
background-image: url('blog-baggrund2.jpg');
background-repeat: no-repeat;
background-attachment: fixed;
background-size: cover; 
```

问题是`background-size: cover;`拉伸它以使整个图像不显示，并将`background-size: contain;`其最小化以使其不适合整个屏幕（至少在宽度 - 高度上是完美的）

我自己的屏幕分辨率是1600x900

jsFiddle：

[http://jsfiddle.net/zJNLJ/4/](http://jsfiddle.net/zJNLJ/4/)

请注意，未显示图像底部的所有“黑色”内容。

有什么建议么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T22:10:16.230

试试这个小提琴：http: [//jsfiddle.net/zJNLJ/5/](http://jsfiddle.net/zJNLJ/5/)

我改变`background-size`了`100% 100%`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-15T23:11:40.733

background-size 属性可以满足您的需求。“背景尺寸：封面；” 将图像缩放到最小尺寸，使其宽度和高度都适合内容区域

更多@http [://www.w3schools.com/cssref/css3_pr_background-size.asp](http://www.w3schools.com/cssref/css3_pr_background-size.asp)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T23:20:21.137

也许将图像编辑为具有相等的宽度/高度，然后将其设置为 100%？这样可能最好看。

# php - 在学说 mongodb ODM 结果中添加和删除元素 - PHP

> ID：11977940
> 
> 赞同：0
> 
> 时间：2012-08-15T21:57:22.070
> 
> 标签：php, symfony-2.1, doctrine-odm

如何删除和添加元素到学说的 odm 返回的结果中。例如，

我有查询

`$fruits = $dm->createQueryBuilder('Fruits') ->field('id')->in($fruit_list) ->getQuery()->execute();`

$fruits 返回的是一个数组，然后我需要遍历这个数组并在分析后过滤一些水果。通过查询生成器无法入围，我需要返回过滤后的结果。

我想问如何从odm返回的这个对象中删除元素。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-16T13:52:43.427

我不确定我是否完全理解您，我假设您正在尝试从 ODM 返回的实体中删除一些字段。

我会关闭水合作用并使用简单的阵列。

例子：

```
$fruits = $dm->createQueryBuilder('Fruits')
             ->field('id')
             ->in($fruit_list)
             ->hydrate(false) /* Turn off hydration */
             ->getQuery()->execute(); 
```

现在您所要做的就是使用 unset 并从数组中删除想要的元素。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-16T23:07:54.700

当您迭代`$fruits`并做出入围决定时，创建一个[ArrayCollection](http://www.doctrine-project.org/api/common/2.3/class-Doctrine.Common.Collections.ArrayCollection.html)并添加所有进行剪切的对象并返回它而不是光标。

# python - 如何将 .obj 转换为 .json 格式的 3D 模型？

> ID：11977941
> 
> 赞同：1
> 
> 时间：2012-08-15T21:57:23.223
> 
> 标签：python, json, three.js, collada, .obj

编辑：没关系，windows 命令提示符似乎更容易使用。有效。
我正在尝试使用[convert_ob_three.py](https://github.com/mrdoob/three.js/blob/master/utils/exporters/obj/convert_obj_three.py) python 脚本文件将 .obj 文件转换为 .js 格式。

这是我所做的：
1\. 将 google sketchup 模型导出为 .obj
2\. 安装了 python 版本 2，顺便说一下，这是转换器所需的版本。
3\. 尝试运行脚本文件并立即关闭
4\. 尝试将“python convert_obj_three.py -i mesh.obj -o mesh.js”（不带引号）放在 python 命令行中。收到有关语法错误的错误。
5\. 尝试在前面加上“$”。没运气。

有没有搞错！？我应该放弃 .js 并尝试使用 collada 加载程序吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T22:03:45.527

我解释你所尝试的方式，似乎你以某种方式做错了所有这些步骤......

您不能简单地双击期望在带有 args 的命令行中运行的 python 脚本。

您不能从 python 交互式解释器行运行 shell 语法。

“$”在python shell中没有意义

很可能您只想做的（对这个脚本一无所知）是打开一个普通的命令 shell 并运行：`python convert_obj_three.py -i mesh.obj -o mesh.js`

# c - 整数常量上的无效后缀“-252”

> ID：11977943
> 
> 赞同：8
> 
> 时间：2012-08-15T21:57:43.937
> 
> 标签：c, integer

我一直在尝试从[https://github.com/amree/mykad-c/blob/master/scdump.c](https://github.com/amree/mykad-c/blob/master/scdump.c)运行 C 文件，但我一直在获取`Invalid suffix "-252" on integer constant`这部分代码：

```
 if (RxBuffer[0x11E-252] == 'P')
            printf("Female\n");
        else if (RxBuffer[0x11E-252] == 'L')
            printf("Male\n");
        else
            printf("%c\n", RxBuffer[0x11E-252]); 
```

我很确定它与语法有关。但我并不真正理解代码（我正在尝试，但我几乎被卡住了）。谁能帮我？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2012-08-16T00:06:10.483

虽然这个问题在某种程度上与十六进制浮点常量有关，但问题的根本原因不是因为`0x11E`是十六进制浮点常量的开始（因为它不是十六进制浮点常量的开始）。

问题是它`0x11E-252`是单个令牌而不是像`0x11F-252`is 这样的三个令牌。如果您查看 C99 6.4.8 “预处理数字”，您会看到 pp-number 标记是：

> 预处理数字以数字开头，可选地以句点 (.) 开头，后面可以跟有效的标识符字符和字符序列 e+、e-、E+、E-、p+、p-、P+ 或 P-

因此，`0x11E-252`是单个标记，并且标记化发生在翻译阶段 3，但是当需要在语法和语义上解释标记时（发生在翻译阶段 7），它在语法上无效，因此您会收到编译器错误。

另一方面，`0x11F-252`是三个标记，因为`-`它不是预处理数字标记的一部分，除非它的前面紧跟一个`P`或`E`（大写或小写）。

当然，这与浮点常量（十六进制或其他）有关，因为这就是`-`字符最终会出现在预处理数字标记中间的原因。`0xx11F`但是，请注意，对于类似于或`22bad_token`与十六进制浮点常量不相似的标记，您将收到类似的错误消息。

修复方法[如 ouah 所述](https://stackoverflow.com/a/11977981/12711)，在 之前插入空格`-`以强制编译器将序列视为多个标记。如果这是您的代码，更好的解决方案可能是为所有这些幻数（枚举或宏）命名。后面跟着的标识符`-`不会被视为单个令牌。另外，您希望获得使代码更加自我记录的好处。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-08-15T22:02:25.887

```
0x11E-252 
```

是 C 中的十六进制浮点常数，`-252`是指数部分。您收到警告是因为您正在使用浮点常量初始化整数对象。

```
0x11E - 252  // Note the whitespace 
```

是一个整数表达式。

使用后者来获得所需的行为。

**编辑**：

我的回答实际上是不正确的。虽然修复是可以的，但请参阅[@MichaelBurr](https://stackoverflow.com/questions/11977943/invalid-suffix-252-on-integer-constant/11979001)的答案以了解正在发生的事情的真正解释。`0x11E-252`在 C 规则下是作为单个标记读取的，它不是有效的浮点数（或整数）。

# ruby-on-rails - 没有从 DreamHost 上的 Rails3 应用程序获得任何有用的日志输出

> ID：11977944
> 
> 赞同：0
> 
> 时间：2012-08-15T21:57:46.080
> 
> 标签：ruby-on-rails, ruby-on-rails-3.2, dreamhost

我正在尝试在我的共享 DreamHost 帐户上部署一个非常简单的 Rails 应用程序，但被卡住了。日志输出似乎没有告诉我出了什么问题。

当我在浏览器中访问应用程序的任何资源时，它会返回标准的 404 错误页面 (public/404.html)。log/production.log 文件中的所有内容：

```
Started GET "/" for 198.144.202.78 at Wed Aug 15 14:34:58 -0700 2012 Processing by HomeController#index as HTML   Rendered home/index.html.erb within layouts/application (5.3ms)

Started GET "/internal_error.html" for 198.144.202.78 at Wed Aug 15 14:34:58 -0700 2012

ActionController::RoutingError (No route matches [GET] "/internal_error.html"):
  actionpack (3.2.8) lib/action_dispatch/middleware/debug_exceptions.rb:21:in `call'
  actionpack (3.2.8) lib/action_dispatch/middleware/show_exceptions.rb:56:in `call'
  railties (3.2.8) lib/rails/rack/logger.rb:26:in `call_app'
  railties (3.2.8) lib/rails/rack/logger.rb:16:in `call'
  actionpack (3.2.8) lib/action_dispatch/middleware/request_id.rb:22:in `call'
  rack (1.4.1) lib/rack/methodoverride.rb:21:in `call'
  rack (1.4.1) lib/rack/runtime.rb:17:in `call'
  activesupport (3.2.8) lib/active_support/cache/strategy/local_cache.rb:72:in `call'
  rack (1.4.1) lib/rack/lock.rb:15:in `call'
  rack-cache (1.2) lib/rack/cache/context.rb:136:in `forward'
  rack-cache (1.2) lib/rack/cache/context.rb:245:in `fetch'
  rack-cache (1.2) lib/rack/cache/context.rb:185:in `lookup'
  rack-cache (1.2) lib/rack/cache/context.rb:66:in `call!'
  rack-cache (1.2) lib/rack/cache/context.rb:51:in `call'
  railties (3.2.8) lib/rails/engine.rb:479:in `call'
  railties (3.2.8) lib/rails/application.rb:223:in `call'
  railties (3.2.8) lib/rails/railtie/configurable.rb:30:in `send'
  railties (3.2.8) lib/rails/railtie/configurable.rb:30:in `method_missing'
  /dh/passenger/lib/phusion_passenger/rack/request_handler.rb:96:in `process_request'
  /dh/passenger/lib/phusion_passenger/abstract_request_handler.rb:513:in `accept_and_process_next_request'
  /dh/passenger/lib/phusion_passenger/abstract_request_handler.rb:274:in `main_loop'
  /dh/passenger/lib/phusion_passenger/rack/application_spawner.rb:205:in `start_request_handler'
  /dh/passenger/lib/phusion_passenger/rack/application_spawner.rb:170:in `send'
  /dh/passenger/lib/phusion_passenger/rack/application_spawner.rb:170:in `handle_spawn_application'
  /dh/passenger/lib/phusion_passenger/utils.rb:479:in `safe_fork'
  /dh/passenger/lib/phusion_passenger/rack/application_spawner.rb:165:in `handle_spawn_application'
  /dh/passenger/lib/phusion_passenger/abstract_server.rb:357:in `__send__'
  /dh/passenger/lib/phusion_passenger/abstract_server.rb:357:in `server_main_loop'
  /dh/passenger/lib/phusion_passenger/abstract_server.rb:206:in `start_synchronously'
  /dh/passenger/lib/phusion_passenger/abstract_server.rb:180:in `start'
  /dh/passenger/lib/phusion_passenger/rack/application_spawner.rb:128:in `start'
  /dh/passenger/lib/phusion_passenger/spawn_manager.rb:253:in `spawn_rack_application'
  /dh/passenger/lib/phusion_passenger/abstract_server_collection.rb:132:in `lookup_or_add'
  /dh/passenger/lib/phusion_passenger/spawn_manager.rb:246:in `spawn_rack_application'
  /dh/passenger/lib/phusion_passenger/abstract_server_collection.rb:82:in `synchronize'
  /dh/passenger/lib/phusion_passenger/abstract_server_collection.rb:79:in `synchronize'
  /dh/passenger/lib/phusion_passenger/spawn_manager.rb:244:in `spawn_rack_application'
  /dh/passenger/lib/phusion_passenger/spawn_manager.rb:137:in `spawn_application'
  /dh/passenger/lib/phusion_passenger/spawn_manager.rb:275:in `handle_spawn_application'
  /dh/passenger/lib/phusion_passenger/abstract_server.rb:357:in `__send__'
  /dh/passenger/lib/phusion_passenger/abstract_server.rb:357:in `server_main_loop'
  /dh/passenger/lib/phusion_passenger/abstract_server.rb:206:in `start_synchronously'
  /dh/passenger/helper-scripts/passenger-spawn-server:99 
```

据我了解，报告的唯一错误是它找不到要重定向到的“internal_error.html”页面。（尽管我确实在 public/internal_error.html 上创建了一个 - 这没有帮助）。在任何情况下，它都不会告诉我它遇到了什么错误（这是我正在寻找的）。我在 config/environments/production.rb 中设置了 config.log_level = :debug。

apache 错误日志（~/logs/MY_DOMAIN/http/error.log）只说：

```
[Wed Aug 15 14:34:58 2012] [error] [client 198.144.202.78] Premature end of script headers: 
```

无论如何，这是我的 Gemfile：

```
source 'https://rubygems.org'
gem 'rails', '3.2.8'
# Bundle edge Rails instead:
# gem 'rails', :git => 'git://github.com/rails/rails.git'
gem 'sqlite3'
gem 'mysql2'
gem 'json'
# Gems used only for assets and not required
# in production environments by default.
group :assets do
  gem 'sass-rails',   '~> 3.2.3'
#  gem 'coffee-rails', '~> 3.2.1'
  # See https://github.com/sstephenson/execjs#readme for more supported runtimes
  # gem 'therubyracer', :platforms => :ruby
  gem 'uglifier', '>= 1.0.3'
end
gem 'jquery-rails'
gem 'ruby-debug'
gem "rake", "0.8.7"
#gem "rmagick"
# gem "rmagick", ">= 1.15", :require => 'RMagick'
gem "rmagick", "1.15.14", :require => 'RMagick'
gem "carrierwave"
gem "therubyracer" 
```

关于环境的一些细节：

rails - 使用 ~/.gems/bin/rails 版本 3.2.8 ruby​​ - 据我所知，使用 /usr/bin/ruby 版本 1.8.7 rake - 使用 /usr/lib/ruby/gems/1.8/bin/ /rake 版本 0.8.7

我能够成功运行 bundle 和 rake db:migrate （在跳过很多圈之后）。

# php - 为什么这个程序有效？

> ID：11977945
> 
> 赞同：12
> 
> 时间：2012-08-15T21:57:47.687
> 
> 标签：php

阅读[这个引人入胜的问题](https://stackoverflow.com/questions/11695110/why-is-this-program-valid-i-was-trying-to-create-a-syntax-error)让我想起了几周前偶然发现的一段代码；它给了我几分钟的困惑，直到我弄清楚它为什么起作用，也许它对其他人也会很有趣。

```
<?php

http://example.com/some-article
$items = get_items();
// etc. 
```

显然，程序员想在代码块之前添加一个解释性链接作为注释，但忘记`//`在开头添加。尽管如此，代码工作正常。你能说出为什么吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2012-08-15T21:59:41.300

这`http:`是一个[转到](http://php.net/manual/en/control-structures.goto.php)标签，该行的其余部分被注释掉。

# capistrano - 是否有可用的变量允许我从任务中发现 Capistrano 角色？

> ID：11977947
> 
> 赞同：0
> 
> 时间：2012-08-15T21:58:11.040
> 
> 标签：capistrano, task, role

我有两个几乎相同的不同角色的任务。唯一的区别是他们正在运行的命令有一个等于角色名称的参数。是否可以使用角色名称作为变量将这两个任务组合成一个任务？

下面的馅饼显示了我正在寻找的示例之前和之后。我不想像前面的示例那样重复代码，唯一的区别是角色的名称。

[http://pastie.org/4496316](http://pastie.org/4496316)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-09-18T01:30:38.333

我不认为角色变量存在，但我知道服务器变量存在并且您应该能够从变量中获取该服务器的角色。

# amd - 如何将多个 AMD 模块捆绑在一个文件中？

> ID：11977949
> 
> 赞同：9
> 
> 时间：2012-08-15T21:58:30.513
> 
> 标签：amd, javascript

AMD 似乎是按需加载 javascript 模块的最佳实践。

这应该适用于用户只使用一小部分可用功能的大型网络应用程序。

我读过优化器，它将所有需要的模块连接到一个文件中，我读过没有优化，即用异步请求加载每个模块。

两者似乎都不适合这个用例：使用请求加载每个模块可能会很快导致大量请求，而优化会迫使您下载**所有**代码。

有没有办法将多个模块捆绑到一个文件中？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2012-08-15T22:14:03.787

是的。通常将应用程序分成这么多文件并用 AMD 加载它们**只对开发有好处**。它有助于保持代码简洁易懂；每个模块都包含视图、模型、控制器并且每个模块都是一个单独的文件，这是非常合乎逻辑的。

然而，**大量的请求在生产中没有意义**。因此，您应该使用优化器将文件编译并最小化为一个（或几个）文件，以提高性能和用户体验。

如果您使用 RequireJS，请参考[http://requirejs.org/docs/optimization.html#wholeproject](http://requirejs.org/docs/optimization.html#wholeproject) — 它解释了如何使用`r.js`RequireJS 提供的工具。

例如，如果我的应用程序由公共区域、管理和一个非常复杂的注册表单组成，每个都由数百个视图/模型/控制器组成，**我可能会将我的代码编译成只有 4 个文件**：common、public、admin、sign_up。然后，当用户进入特定区域时，将异步加载适当的文件。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-08-19T16:13:46.733

RequireJS 用他们的优化工具支持这个用例。

通过 build.js 中的正确配置，可以将其配置为将多个模块捆绑在多个文件中。

它们的映射可以在[build.js](https://github.com/requirejs/example-multipage/blob/master/tools/build.js)中定义，如本[示例项目所示](https://github.com/requirejs/example-multipage)

# opencv - OpenCV：矩阵迭代

> ID：11977954
> 
> 赞同：8
> 
> 时间：2012-08-15T21:59:18.090
> 
> 标签：opencv, matrix, iterator, iteration

我是 OpenCV 的新手。我正在尝试使用迭代器而不是“for”循环，这对我的情况来说太慢了。我尝试了一些这样的代码：

```
MatIterator_<uchar> it, end;
for( it = I.begin<uchar>(), end = I.end<uchar>(); it != end; ++it)
{
    //some codes here
} 
```

我的问题是：如何转换 for 循环，例如：

```
for ( int i = 0; i < 500; i ++ )
{
    exampleMat.at<int>(i) = srcMat>.at<int>( i +2, i + 3 )
} 
```

进入迭代器模式？也就是说，如何以迭代器形式执行“i +2，i + 3”？我想我只能通过“*it”得到相应的值，但我无法得到它的计数。提前谢谢了。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2012-08-16T04:10:31.237

慢的不是 for 循环，而是`exampleMat.at<int>(i)`进行范围检查的循环。

为了有效地循环遍历所有像素，您可以使用 .ptr() 在每行的开头获取指向数据的指针

```
for(int row = 0; row < img.rows; ++row) {
    uchar* p = img.ptr(row);
    for(int col = 0; col < img.cols; ++col) {
         *p++  //points to each pixel value in turn assuming a CV_8UC1 greyscale image 
    }

    or 
    for(int col = 0; col < img.cols*3; ++col) {
         *p++  //points to each pixel B,G,R value in turn assuming a CV_8UC3 color image 
    }

} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-16T00:50:09.460

您需要某种计数变量，您必须自己声明和更新它。一种紧凑的方法是

```
int i = 0;
for( it = I.begin<uchar>(), end = I.end<uchar>(); it != end; ++it,i++)
{
//some codes here involving i+2 and i+3
} 
```

如果您正在寻找超快速访问但是我建议您自己操作数据指针。有关迭代速度的详细说明，请参阅第 51 页的*OpenCV 2 计算机视觉应用程序编程食谱（pdf 中的 65）。*您的代码可能看起来像

```
cv::Mat your_matrix;
//assuming you are using uchar
uchar* data = your_matrix.data();

for(int i = 0; i < some_number; i++)
{
  //operations using *data
  data++;
} 
```

# oracle - 使用 Oracle 客户端连接到远程 Oracle 数据库

> ID：11977965
> 
> 赞同：1
> 
> 时间：2012-08-15T22:00:17.173
> 
> 标签：oracle, oracle11g, oracleclient

我必须连接到远程 Oracle 数据库。连接仅适用于对远程网络的 VPN 访问。我已经设置了VPN，并且可以正常工作。

远程团队已通过 TNS.ORA 设置。我几乎没有配置过 oracle，也不知道我需要在我的机器上进行哪些设置。我只需要运行几个查询来测试数据。

有人可以指导我在 Windows 7 上连接到远程 Oracle 数据库所需的设置和配置吗？

我的第一个假设是下载 Oracle 客户端。我下载了 Oracle Insta Client 文件，但我不知道如何配置它以连接到远程数据库。我什至在 Insta 客户端的已安装文件中都找不到任何 ORA 文件。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-16T01:29:16.743

您安装了即时客户端并安装了它，您可以使用easyconnect 字符串连接到远程数据库。如果您在 sqlplus 中，您可以执行以下操作：

CONNECT 用户名@[//]host[:port][/service_name][:server][/instance_name]

假设您的远程主机是 remote1，service_name 是 test（这可以从 tnsnames.ora 中检索）

连接用户名@//remote1/test

# android - android自定义对话框错误

> ID：11977966
> 
> 赞同：0
> 
> 时间：2012-08-15T22:00:24.613
> 
> 标签：android, customdialog

我正在尝试创建一个自定义对话框，但遇到了一些麻烦。

在用户按下菜单按钮并选择一个选项后，将显示自定义对话框。

这是代码：

```
 @Override
    public boolean onCreateOptionsMenu(Menu menu) {
        super.onCreateOptionsMenu(menu);
        MenuInflater myMenu = getMenuInflater();

        myMenu.inflate(R.menu.menu, menu);

        return true;
    }

    @Override
    public boolean onOptionsItemSelected(MenuItem item) {
        // TODO Auto-generated method stub
        switch (item.getItemId()) {
            case R.id.email:

                Context mContext = getApplicationContext();
                Dialog dialog = new Dialog(mContext);

                dialog.setContentView(R.layout.email);
                dialog.setTitle("Custom Dialog");

                dialog.show();

                break;
            case R.id.info:
                // Todo something
                break;
        }
        return super.onOptionsItemSelected(item);

    } 
```

这`R.layout.email`是：

```
<?xml version="1.0" encoding="utf-8"?>
<LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:orientation="vertical" >

    <TextView
        android:id="@+id/emailTitle"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:padding="4dp"
        android:text="@string/emailTitle" />

    <MultiAutoCompleteTextView
        android:id="@+id/multiAutoCompleteTextView1"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:padding="4dp" >

        <requestFocus />
    </MultiAutoCompleteTextView>

    <LinearLayout
        android:layout_width="match_parent"
        android:layout_height="0dp"
        android:layout_weight="4" >

        <TextView
            android:id="@+id/emailTV1"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_weight="1" />

        <Button
            android:id="@+id/emailBsend"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:padding="4dp"
            android:text="@string/emailSend" />

        <Button
            android:id="@+id/emailBcancel"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_weight="1"
            android:padding="4dp"
            android:text="@string/emailCancel" />

        <TextView
            android:id="@+id/emailTV2"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_weight="1" />
    </LinearLayout>

</LinearLayout> 
```

我收到此错误：

```
android.view.WindowManager$BadTokenException: Unable to add window -- token null is not for an application 
```

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T22:02:14.893

您不应该使用 getApplicationContext。采用

```
Context mContext = [ActivityName].this; 
```

# javascript - div centered vertically with specific margin when resize

> ID：11977969
> 
> 赞同：0
> 
> 时间：2012-08-15T22:00:50.620
> 
> 标签：javascript, vertical-alignment, centering, margins

I really need some help.

I have this test-web: www.sfrpsicologia.com/inicio.html

As you can see, I have centered the green box in the middle of the screen. The problem is that when I resize the height of the window, this box is above the logo and the footer. And what I want is that ALWAYS this div respect the height of the logo and the footer. I need a margin top and bottom that this box never overpass.

Any help please? I dont know much about javascript. I have tried with css styles but as it is positioned absolutely I cant do it.

Thank you very much

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T22:09:49.193

在这种情况下不要使用绝对定位。您正在尝试使用 javascript 解决糟糕的设计问题，这不是一个好习惯。使用粘性页脚方法[http://ryanfait.com/resources/footer-stick-to-bottom-of-page/](http://ryanfait.com/resources/footer-stick-to-bottom-of-page/) 并根据该技术过度考虑您的页面结构。

* * *

好的，我明白你的意思了。

这样做，但是我不保证它会起作用，因为我无法在您的网站上对其进行测试，但是如果发生任何障碍，您应该对其进行修改以使其正常工作。我使用的是 jQuery，你应该熟悉它。

所以**第1步**（获取div）`<div id=wrapp>`并取它的高度

```
var wrapp = jQuery('#wrapp');
var h = wrapp.outerHeight(); 
```

**第2步**（设置一些其他变量）

```
var winH = 0;
var pos = null;
var footerH = 34;
var headerH = 74; 
```

这些高度是除了您`<div id=wrapp>`的情况之外的元素，它们可能或多或少。

```
var footerH = 34;
var headerH = 74; 
```

这个想法是当屏幕上没有空间让所有这些都停止`<div id=wrapp>`向上时。

**第 3 步**（所有这些都绑定到窗口调整大小事件）：

```
jQuery(window).resize(function(){

    winH = jQuery(this).height();
    pos = wrapp.position();    
    if(winH  < h + headerH + footerH  )
        wrapp.css({'top' : pos.top});
    else
        wrapp.css({'top' : '50%'});
}); 
```

在调整大小时更新窗口高度，还获取`<div id=wrapp>`位置对象，如果（根据您放置的所有高度没有更多空间）将`top`位置固定到**当前顶部位置，** `<div id=wrapp>`否则将其放回百分比。

这是一个例子：http: [//jsfiddle.net/F7mrf/44/](http://jsfiddle.net/F7mrf/44/)

如果你的想法只需要很少的修改就可以工作，你只需要做数学并输入正确的数字，祝你好运

# javascript - jquery automatic fadeIn fadeOut on a series of images?

> ID：11977971
> 
> 赞同：3
> 
> 时间：2012-08-15T22:01:01.690
> 
> 标签：javascript, jquery, fadein, fadeout

I'm essentially trying to make a slideshow where images fade in and fade out after 5 seconds or so. The slideshow a bunch of images stacked on top of each other, not side by side. How would I make img1 fadeOut and img2 fadeIn after 5 seconds, then have img2 fadeout and img3 fadein after another 5 seconds, etc.?

I was thinking of using the setInterval() function, but I don't know how it works. Maybe delay()?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-08-15T22:10:44.440

你不需要插件。用几行代码很容易做到：

**HTML**

```
 <div id="images">
    <ul
        ><li><img src="img/11.jpg" width="520" height="203" alt="" /></li
        ><li><img src="img/12.jpg" width="520" height="203" alt="" /></li
        ><li><img src="img/13.jpg" width="520" height="203" alt="" /></li
        ><li><img src="img/14.jpg" width="520" height="203" alt="" /></li
        ><li><img src="img/15.jpg" width="520" height="203" alt="" /></li
        ><li><img src="img/5.jpg" width="520" height="203" alt="" /></li
    ></ul>
</div> 
```

**CSS**

```
#images ul{position:absolute;right:9px;top:1px;width:520px;height:202px;list-style:none;overflow:hidden}
#images li{display:none;position:absolute;left:0;top:0;} 
```

**JS**

```
$(document).ready(
  function() {
    var i = 0, j = 0; 
    var imgs = $('#header ul').children();
    runIt(imgs);

    function runIt() {
      $(imgs).eq(i).fadeIn(3000, function() {
        setTimeout(runIt,'200');
      });
      i = i + 1; 
      if (i == imgs.length) {
        i = 0; $('#images li').fadeOut(1000)
      } 
    }
}); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-08-15T22:03:18.040

Why not use a plugin that does this? There are tons of them out there, including [cycle](http://jquery.malsup.com/cycle/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-06-08T00:04:18.043

当我尝试对切片库使用淡入和淡出时，我遇到了 IE 问题。我正在使用 jquery 库“ [http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js](http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js) ”。当我更改为“ [http://code.jquery.com/jquery-1.9.1.js](http://code.jquery.com/jquery-1.9.1.js) ”库时，IE、Chrome 和 FF 一切正常，我可以跳过所有修改。

# ruby-on-rails - Want to add links to a method of another controller in the show screen using active admin

> ID：11977975
> 
> 赞同：0
> 
> 时间：2012-08-15T22:01:50.287
> 
> 标签：ruby-on-rails, activeadmin

in my active admin app i have 2 models, per example: Vehicle and Front.(Front has many Vehicles)

In the :show view of an Front, it lists all the vehicles that belong to it. And for each Vehicle it lists, it have a link "Remove" that removes the corresponding Vehicle from that Front. Here's what my code looks like:

```
ActiveAdmin.register Front do
    show do
      panel "Vehicles in this Front" do
        table_for(front.vehicles) do |vehicle|
          vehicle.column("id") {|vehicle| auto_link frente.vehicles}
          vehicle.column("category") {|vehicle| vehicle.descricao}
          vehicle.column("status") {|vehicle| vehicle.status}
          vehicle.column {link_to "Remove" , remove_admin_vehicle_path(vehicle.id), :method => :post}
        end
      end 
```

And the Remove method from Vehicle:

```
member_action :remove , :method => :post do
  vehicle = Vehicle.find(params[:id])
  vehicle.front = null
  vehicle.save!
  flash[:notice] = "vehicle removed"
  redirect_to :action => :show  
end 
```

But when I click on the Remove link, theres an error: Its not sending the id from the vehicle. How can I send the id from the Vehicle?

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T22:42:05.217

使用删除方法和销毁动作，这是正确的方法。
所以..
尝试使用

```
vehicle.column {link_to "Remove" , remove_admin_vehicle_path(vehicle), :method => :post} 
```

并显示`rake routes`结果。

# cocos2d-iphone - Cocos2D: Best way to display text from font atlas?

> ID：11977976
> 
> 赞同：1
> 
> 时间：2012-08-15T22:02:01.493
> 
> 标签：cocos2d-iphone

Based on the use CCDirector makes of CCLabelAtlas, I tried the following:

```
scoreLabel = [[CCLabelAtlas alloc]  initWithString:@"0123456789" charMapFile:@"fps_images.png" itemWidth:8 itemHeight:12 startCharMap:'.'];
[scoreLabel setPosition:ccp(200, 200)];
[self addChild:scoreLabel]; 
```

I must be missing something as nothing displays. I'm using the basic .png that's supplied with Cocos2D.

What am I missing? Thanks!

# java - JodaTime dd-MMM-yyyy Pattern Exception

> ID：11977977
> 
> 赞同：0
> 
> 时间：2012-08-15T22:02:08.107
> 
> 标签：java, formatting, jodatime

I have the following code

```
 DateTimeFormatter formatter = DateTimeFormat.forPattern("dd-MMM-yyyy").withLocale(Locale.US);       
formatter.parseDateTime("10-23-2012"); 
```

Why am I getting the following exception?

```
nested exception is java.lang.IllegalArgumentException: Invalid format: "10-23-2012" is malformed at "23-2012" 
```

After reading the javadoc, I still can figure this out. The lowercase d (day of month) is supposed the represent minimum number of digits, but according to the exception it is getting truncated? Any ideas?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T22:04:11.007

中有三个月的字符，`dd-MMM-yyyy`但只有两个`10-23-2012`。

它变得更糟。你的中间数字似乎是一天，而不是一个月；无论如何，你可能想要像“OCT”这样的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T22:04:14.887

试试`dd-MM-yyyy`。注意只有两个 M。此外，要解析`10-23-2012`，格式应该是`MM-dd-yyy`

**例子**

MMM = 2 月、7 月等。

MM = 02、07 等。

[参考](http://docs.oracle.com/javase/6/docs/api/java/text/SimpleDateFormat.html)

# php - 获取博客外的 wordpress 最新帖子

> ID：11977982
> 
> 赞同：0
> 
> 时间：2012-08-15T22:02:32.240
> 
> 标签：php, wordpress

我正在尝试在 wordpress 之外的静态页面上获取最新的 wordpress 帖子。我正在尝试以下代码，但它不起作用（即我没有得到任何输出）。

```
<?php
    $config_file = $_SERVER['DOCUMENT_ROOT'].'/wp/wp-config.php';
    include($config_file); 

    $postlist = get_posts('numberposts=5');
    foreach ($postlist as $post) : ?>
        <p><a href="<?php the_permalink(); ?>"><?php the_title(); ?></a></p>
    <?php endforeach; ?> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-15T22:38:44.543

wp-config 文件仅存储这些变量以供其他脚本使用。它没有定义任何 wordpress 功能。我相信你正在寻找的是这样的。

```
 define('WP_USE_THEMES', false);
  require('/server/path/to/your/wordpress/site/htdocs/blog/wp-blog-header.php'); 
```

之后，您应该能够使用 wordpress 功能。

# java - What weblogic jar file contains com.bea.logging.BaseLogRecord?

> ID：11977983
> 
> 赞同：0
> 
> 时间：2012-08-15T22:02:40.990
> 
> 标签：java, jar, weblogic, java.util.logging

In order to solve a build path issue, I am trying to figure out the Weblogic 10.3 library that contains com.bea.logging.BaseLogRecord

Thanks in advance.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-16T15:39:54.503

我找到了罐子，感谢肖恩。对于那些需要回答的人，在 Weblogic 10.3 上，该类位于 jar 文件 $BEA_HOME/modules/com.bea.core.logging.1.8.0.0.jar 中。

# c# - 为什么按值传递的对象被修改为按引用传递？

> ID：11977988
> 
> 赞同：0
> 
> 时间：2012-08-15T22:02:50.103
> 
> 标签：c#

例如，

```
 class Age
  {
    public int Year
    {
      get;
      set;
    }
    public Age(int year)
    {
      Year = year;
    }
  }

  class Person
  {
    public Age MyAge
    {
      get;
      set;
    }
    public Person(Age age)
    {
      age.Year = ( age.Year * 2 );
      MyAge = age;      
    }
  } 
```

[客户]

```
Age a = new Age(10);
Person p = new Person( a ); 
```

构造新`Age`类时，`Year`属性为：10。但是，Person 类将 Year 更改为 20，即使没有 ref 关键字...

有人可以解释为什么 Year 还不是 10 吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-08-15T22:05:54.727

对对象的引用是按值传递的。通过该引用，可以修改对象实例本身。

请考虑以下示例以了解该语句的含义：

```
public class A
{
    private MyClass my = new MyClass();

    public void Do()
    {
        TryToChangeInstance(my);
        DoChangeInstance(my);
        DoChangeProperty(my);
    }

    private void TryToChangeInstance(MyClass my)
    {
        // The copy of the reference is replaced with a new reference.
        // The instance assigned to my goes out of scope when the method exits.
        // The original instance is unaffected.
        my = new MyClass(); 
    }

    private void DoChangeInstance(ref MyClass my)
    {
        // A reference to the reference was passed in
        // The original instance is replaced by the new instance.
        my = new MyClass(); 
    }

    private void DoChangeProperty(MyClass my)
    {
        my.SomeProperty = 42; // This change survives the method exit.
    }
} 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2012-08-15T22:06:44.067

因为`Age`是*引用*类型。

# javascript - Get signed_request in Node.js (Express) Facebook canvas app

> ID：11977989
> 
> 赞同：6
> 
> 时间：2012-08-15T22:03:09.457
> 
> 标签：javascript, facebook, node.js, express

is there any way how to get and parse signed_request in Node.js Facebook page tab app? I need to know page id and if user liked the page...

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2012-08-15T23:03:13.033

I did this a little while ago, and ended up writing a small library to do it. The original CoffeeScript can be found at [https://gist.github.com/fbef51815ab6f062b51a#file_signed_request.coffee](https://gist.github.com/fbef51815ab6f062b51a#file_signed_request.coffee), here is a JavaScript translation:

```
var crypto = require('crypto');

SignedRequest = (function() {

  function SignedRequest(secret, request) {
    this.secret = secret;
    this.request = request;
    this.verify = this.verify.bind(this);

    var parts = this.request.split('.');
    this.encodedSignature = parts[0];
    this.encoded = parts[1];
    this.signature = this.base64decode(this.encodedSignature);
    this.decoded = this.base64decode(this.encoded);
    this.data = JSON.parse(this.decoded);
  }

  SignedRequest.prototype.verify = function() {
    if (this.data.algorithm !== 'HMAC-SHA256') {
      return false;
    }
    var hmac = crypto.createHmac('SHA256', this.secret);
    hmac.update(this.encoded);
    var result = hmac.digest('base64').replace(/\//g, '_').replace(/\+/g, '-').replace(/\=/g, '');
    return result === this.encodedSignature;
  };

  SignedRequest.prototype.base64encode = function(data) {
    return new Buffer(data, 'utf8').toString('base64').replace(/\//g, '_').replace(/\+/g, '-').replace(/\=/g, '');
  };

  SignedRequest.prototype.base64decode = function(data) {
    while (data.length % 4 !== 0) {
      data += '=';
    }
    data = data.replace(/-/g, '+').replace(/_/g, '/');
    return new Buffer(data, 'base64').toString('utf-8');
  };

  return SignedRequest;

})();

module.exports = SignedRequest; 
```

Which you can use like this:

```
var verifier = new SignedRequest(clientSecret, signedRequest);
verifier.verify() // whether or not the signed request verifies
verifier.data // the data from the signed request 
```

# ruby-on-rails-3 - CloudFoundry 504 Gateway Time-out

> ID：11977991
> 
> 赞同：2
> 
> 时间：2012-08-15T22:03:21.447
> 
> 标签：ruby-on-rails-3, cloud-foundry

I have tried to push a simple rails 3.2.3 application with mongo_mapper to cloudfoundry, but I am getting 504 Gateway Time-out. The application ran fine on localhost. I provided additional information below. Please could you provide me assistance to resolve this issue?

To create and push application I typed:

```
rails new myapp -skip-active-record
scaffold massage content:string --skip-migration --orm mongo_mapper
bundle update
bundle install
bundle package
vmc push myapp --runtime ruby19 
```

Here is the Gemfile:

```
Source 'http://rubygems.org'
gem  rails', '3.2.3
gem  mongo_mapper
gem  bson_ext  
end 
```

Here is the controller:

```
class MessagesController < ApplicationController
  def index
   @messages = Message.all
    respond_to do |format|
     format.html # index.html.erb
     format.json { render json: @messages }
    end
  end

 def show
  @message = Message.find(params[:id])
  respond_to do |format|
  format.html # show.html.erb
  format.json { render json: @message }
end
end

def new
@message = Message.new
respond_to do |format|
  format.html # new.html.erb
  format.json { render json: @message }
end
end

def edit
 @message = Message.find(params[:id])
end

def create
@message = Message.new(params[:message])

respond_to do |format|
  if @message.save
    format.html { redirect_to @message, notice: 'Message was successfully created.' }
    format.json { render json: @message, status: :created, location: @message }
  else
    format.html { render action: "new" }
    format.json { render json: @message.errors, status: :unprocessable_entity }
  end
end
end

def update
 @message = Message.find(params[:id])

 respond_to do |format|
  if @message.update_attributes(params[:message])
    format.html { redirect_to @message, notice: 'Message was successfully updated.' }
    format.json { head :no_content }
  else
    format.html { render action: "edit" }
    format.json { render json: @message.errors, status: :unprocessable_entity }
  end
end
end

def destroy
 @message = Message.find(params[:id])
 @message.destroy

respond_to do |format|
  format.html { redirect_to messages_url }
  format.json { head :no_content }
end
end
end 
```

Here is the modle:

```
class Message
 include MongoMapper::Document
 key :content, String
 end 
```

Here is the index view

```
<h1>Listing messages</h1>

<table>
 <tr>
  <th>Content</th>
 </tr>

 <% @messages.each do |message| %>
 <tr>
  <td><%= message.content %></td>
  <td><%= link_to 'Show', message %></td>
  <td><%= link_to 'Edit', edit_message_path(message) %></td>
  <td><%= link_to 'Destroy', message, :confirm => 'Are you sure?', method: :delete %></td>
 </tr>
 <% end %>
 </table>
 <br />
 <%= link_to 'New Message', new_message_path %> 
```

Here is config/locales/mongo.yml

```
 defaults: &defaults
host: 127.0.0.1
port: 27017

development:
<<: *defaults
database: proj815_development

test:
<<: *defaults
database: proj815_test

# set these environment variables on your prod server
production:
host: <%= JSON.parse( ENV['VCAP_SERVICES'] )['mongodb-1.8'].first['credentials']['hostname'] rescue 'localhost'%>
port: <%= JSON.parse( ENV['VCAP_SERVICES'] )['mongodb-1.8'].first['credentials']['port'] rescue '27017'%>
database: <%= JSON.parse( ENV['VCAP_SERVICES'] )['mongodb-1.8'].first['credentials']['db'] rescue 'proj815' %>
username: <%= JSON.parse( ENV['VCAP_SERVICES'] )['mongodb-1.8'].first['credentials']['username'] rescue ''%>
password: <%= JSON.parse( ENV['VCAP_SERVICES'] )['mongodb-1.8'].first['credentials']['password'] rescue ''%> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-01-14T22:06:37.100

通常发生这种情况是因为您的应用程序太大而无法上传，如果您可以减小应用程序的大小，应该没问题。

# sql - Why does my self join return double rows? And how would I query the error in this table correctly?

> ID：11977992
> 
> 赞同：0
> 
> 时间：2012-08-15T22:03:31.973
> 
> 标签：sql, oracle, self-join

I've turned this question into a two part question.

I'm trying to understand the logic of self joins but for some reason I get twice as many rows as I think I should be getting here and I don't know why.

I also need to revise my query to prevent the extra row from appearing in the result

The table has user input errors where the begin date of a new ID2 should be the day following the EndDate of the old ID2.

The table is :

```
ID | BeginDate  | EndDate   | ID2
1  | 2000-01-01 |           | TEN
1  | 2000-01-01 |2010-01-01 | ONEHUNDRED
2  | 2000-01-01 |2011-11-11 | TWENTY
2  | 2011-11-12 |           | TWOHUNDRED
3  | 2000-01-01 |           | THIRTY 
```

I need to do a self join that would expose rows where the BeginDate should have been updated but hasn't been. So for above we would only see the rows for ID1.

I also have a query that should take the one correct ID2 for each ID. The table error will return two ID2's where ID = 1 when I only want the correct one; the query is below.

```
SELECT ID2 
FROM TABLE1
WHERE inDate BETWEEN BeginDate AND NVL(EndDate, SYSDATE); 
```

I had tried something like this SELECT ID2 FROM TABLE1 WHERE inDate BETWEEN BeginDate AND NVL(MAX(EndDate), SYSDATE);

but MAX obviously won't work in the where clause.

All my self joins to try and expose these errors such as the one below return a row for each side.

```
SELECT v.* 
FROM Table1 v INNER JOIN Table1 v2
ON v.ID = v2.ID
AND v.BeginDate = v2.BeginDate
AND v.ID2 != v2.ID2 
```

I think I just miss the point of how a self join should work.

I don't think I can compare the end date where they are null as Oracle won't do a comparison with Nulls.

Does anyone have any insight as to what I would need to compare in Table1 in a self join to only show the rows from one side of a self join?

Thanks

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-15T22:52:04.407

`id`和上没有唯一键`begin_date`，因此您可能希望`distinct`输出为

```
SELECT DISTINCT v.*
  FROM Table1 v INNER JOIN Table1 v2
    ON v.ID = v2.ID
   AND v.BeginDate = v2.BeginDate
   AND v.ID2 != v2.ID2; 
```

或者

```
SELECT DISTINCT v.*
  FROM Table1 v , Table1 v2
 WHERE v.ID = v2.ID
   AND v.BeginDate = v2.BeginDate
   AND v.ID2 != v2.ID2; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-15T22:14:53.493

要获得预期的行数，请更改`v.ID2 != v2.ID2`为`v.ID2 < v2.ID2`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-15T22:12:41.670

这种自我加入将为您提供 numrows*numrows 记录。但是你用进一步的规则来限制它。与 null 比较将始终返回 false，但它会起作用。

总共应该是 numrows*numrows-numrows-nulls。

# c# - Can't click textbox after validation fails

> ID：11977996
> 
> 赞同：0
> 
> 时间：2012-08-15T22:03:48.100
> 
> 标签：c#, wpf, validation, binding

I'm working on trying to implement validation in WPF, and running into an issue where I can't click on or change the value of a textbox after validation fails.

I have a User class (which implements IDataErrorInfo), which contains the following relevant code:

```
public virtual string Error
{
    get
    {
        return null;
    }
}

public virtual string this[string name]
{
    get
    {
        string result = null;

        if (name == "uFirstName")
        {
           if (String.IsNullOrEmpty(this.uFirstName))
            {
                return "Must enter a first name!";
            }
         }
         return result;
     }
} 
```

Then, over in my MainWindow code-behind, I have this code to hookup my combobox:

```
comboBox1.ItemsSource = Users; //Users is a collection of Users 
```

Finally, in my MainWindow xaml, I have this:

```
<ComboBox Name="comboBox1" ItemTemplate="{StaticResource userTemplate}" />
<TextBox Name="textBox1" DataContext="{Binding ElementName=comboBox1,
    Path=SelectedItem}" Text="{Binding Path=uFirstName, ValidatesOnDataErrors=True,
    NotifyOnValidationError=True}"/> 
```

And indeed, the validation does fire when I delete the text and the textbox gets a nice red border. However, the changes are still sent back to Users (uFirstName gets set to nothing!). Even worse though, I now cannot edit the value in that textbox *unless* I **tab back into it**.

What is needed to make sure the value isn't sent back if it isn't valid, and allow the textbox to be edited if is invalid?

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2012-08-16T02:11:46.537

IDataErrorInfo 实现仅用于报告错误。您应该在 uFirstName 属性中实现您的验证。如果您认为某个属性的某个验证并非对所有实例都是正确的，那么您应该开始研究`ValidationRule`. 这是在 WPF 中实现验证的更好方法。如果验证失败，ValidationRule 不会为源设置值。

由于系统级别的样式，文本框可能表现得很奇怪？不完全确定您在那里遇到麻烦的原因。