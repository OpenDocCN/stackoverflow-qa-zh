# StackOverflow 问答 000714000-000714999

# c# - C#：在哪些类中使用了 ICommandExecutor 接口？

> ID：714007
> 
> 赞同：3
> 
> 时间：2009-04-03T13:54:16.560
> 
> 标签：c#, winforms, command

我在 .net 中找到了 ICommandExecutor 接口，但找不到实现它的类。我知道使用了一些与 xaml 相关的东西。但是winforms也有什么东西吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-03T13:56:43.637

它在作为 System.Windows.Forms.MenuItem 的内部类的 MenuItemData 中实现。

一般来说，如果您想找出在哪里实现了哪些接口，获得答案的最快方法是通过 Reflector。它使这样的查询非常容易。

[http://www.red-gate.com/products/reflector/](http://www.red-gate.com/products/reflector/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-08T12:10:34.540

我认为它的命令设计模式，但它不是要使用的意图。这就是供应商告诉我们不要使用它的原因：http: [//msdn.microsoft.com/en-us/library/system.windows.forms.icommandexecutor](http://msdn.microsoft.com/en-us/library/system.windows.forms.icommandexecutor(VS.85).aspx) (VS.85).aspx 。

它应该以一种可以使用的方式完成，因为它是每个基于设计模式的面向 UI 的应用程序中的常见工件。

再见。

# .net - 如何根据触发 AJAX 的控件显示 javascript 消息？

> ID：714021
> 
> 赞同：0
> 
> 时间：2009-04-03T13:58:17.080
> 
> 标签：.net, javascript, ajax

每当从实际保存表单的控件进行 AJAX 调用时，我试图弄清楚如何在屏幕上显示“已保存”消息（由 JQuery 提供淡出效果）。表单相对复杂，有 5 个单独的 UpdatePanel，其中一些（但不是全部）控件将执行回发以保存表单。

我知道哪些控件应该导致显示保存消息。但是，我不知道在 AJAX 请求完成后如何识别这些控件。我想我需要在下面的“endRequestHandler”中添加我的逻辑，但我可能是错的。

***修订*** 这是我可能想在我的整个网站上使用的东西。我需要提出一种通用机制，以声明方式指示控件应在作为回发源时显示“已保存”消息。我可以在控件上放置一些可以在 InitializeRequestHandler 或 EndRequsetHandler 中访问的东西（见下文）吗？也许我应该添加一个可以使用 JQuery 找到的自定义属性？ ***结束修订***

如果您需要更多信息，请告诉我。在此先感谢您的帮助！

```
Sys.WebForms.PageRequestManager.getInstance().add_endRequest(endRequestHandler);

function endRequestHandler(sender, args) {
  //--check to see if the sender should cause the "Saved" message to display
    //--use JQuery Fadeout effect to make the "Saved Message" display on the screen
    //  temporarily
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-03T14:03:48.237

您可以先存储谁进行了 ajax 调用，然后在 end_request 中取消设置存储它的变量。

我假设有一个 begin_request 事件给你这个，如果没有，你可以让你的元素首先调用一个函数来设置谁在发起调用，然后让函数执行回调。

# 编辑

你是在自问自答。向控件添加自定义属性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-06T11:39:10.837

为了解决这个问题，我在我的母版页上放置了一个隐藏字段，id='hfSaveMessageText'。这将保存要显示的消息（如果有）。我还在 MasterPage 上放置了一个 id='mpSaveSpot' 和适当样式的跨度。这是我的消息将显示的地方。

然后，我创建了一个接受 System.Web.UI.Page 和要显示的字符串消息的服务器端方法。该方法获取对母版页上隐藏字段的引用，并将值设置为用户传入的消息（例如：“已删除记录”或“已发送电子邮件”）。

以下 javascript 在每个异步回发 endRequest 上运行，以查看是否有需要显示的消息。如果是这样，我会显示消息并在 4.5 秒内将其淡出（由 JQuery fadeOut 提供）。

```
//--Get an instance of the PageRequestManager so we can
//  designate an end-request handler
var prm = Sys.WebForms.PageRequestManager.getInstance();
//--designed the displayFadeoutMessage as the end request handler
prm.add_endRequest(displayFadeoutMessage);

function displayFadeoutMessage() {
    //--if there is a message to display then show it
    if ($("#ctl00_hfSaveMessageText").attr("value") != "") {
        //--add a span to the placeholder span and then fade it out 
        //  over 4.5 seconds
        $("#mpSaveSpot").append("<span id='spanFadeoutMessage' style='background-color:#ddd;'>" + $("#ctl00_hfSaveMessageText").attr("value") + "</span>").fadeOut(4500, function() {
                //--once the message is faded out then clear the message hidden
                //  field and clear out the message span
                $("#ctl00_hfSaveMessageText").attr("value", "");
                $("#mpSaveSpot").empty();
        });
    }
} 
```

现在，无论我在哪个页面上，我都有一个可重用的机制来在我的网站上显示精美的淡出消息。问题解决了！

# php - 饼干神秘再现的原因是什么？

> ID：714024
> 
> 赞同：3
> 
> 时间：2009-04-03T14:00:34.360
> 
> 标签：php, cookies, safari, zombie-process

我正在开发一个使用 cookie 来存储会话信息的 Web 应用程序。我已经手动删除了会话 cookie，因为我正在处理我不想要登录会话的代码的另一部分。然而，在页面重新加载几次后，会话 cookie 神秘地重新出现，包括一个我为测试目的只设置一次的早期 cookie，然后删除并且再也没有使用过。

我一直手动删除有问题的 cookie，但是，当我在一段时间后重新加载页面时，cookie 又回来了。我已经仔细检查了我的代码，我很肯定我没有在任何地方设置这些 cookie。我的代码目前都在一个文件中，并且我没有包含任何内容，因此我不可能忽略某些内容。

我的代码在 PHP 中，并在我最初创建这些 cookie 时使用了 setcookie() 调用。

我没有在 cookie 上设置过期日期。使用 Safari 4 Beta 和 GlimmerBlocker 代理。

这种奇怪行为的解释是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T14:12:30.823

某些浏览器的 cookie 处理存在已知问题。

请参阅以下论文： [Cookie 后的 iSEC 清理](http://www.isecpartners.com/files/iSEC_Cleaning_Up_After_Cookies.pdf)

另请参阅Apple.com 上关于重新出现 cookie 的[讨论。](http://discussions.apple.com/thread.jspa?messageID=9262463)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T14:04:04.807

试试这个，它*应该*会删除你所有的会话 cookie：

```
 session_start();
    // Unset all of the session variables.
    $_SESSION = array();
    // If it's desired to kill the session, also delete the session cookie.
    // Note: This will destroy the session, and not just the session data!
    if (isset($_COOKIE[session_name()])) {
        setcookie(session_name(), '', time()-42000, '/');
    }       
    // Finally, destroy the session.
    session_destroy(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-29T00:08:31.173

您使用的是什么版本的操作系统？您同时使用了哪些其他应用程序？这些问题通常是由于应用程序一个接一个地踩在 cookie 存储文件（~/Library/Cookies/Cookies.plist）上。

# vb.net - VB.NET 使用 ByRef 参数调用 DLL 方法

> ID：714028
> 
> 赞同：2
> 
> 时间：2009-04-03T14:01:47.510
> 
> 标签：vb.net, dll, reference, arguments

使用 VB.NET，有没有办法在调用 dll 中的函数时传递引用参数。

假设我想将 arg2 作为参考参数传递，我该怎么做？

```
 method.Invoke(obj, New [Object]() {arg1, arg2, arg3}) 
```

换句话说，我想将 arg2 指向被调用函数中的其他内容。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-03T14:11:10.733

如果目标函数定义为`ByRef`它会自动工作，否则你不能。

像这样称呼它：

```
method.invoke(obj, arg1, arg2, arg3) 
```

在您的情况下，您实际上发送了一个参数（一个对象数组）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-03-15T15:31:45.687

Yes, the parameters in your object array will hold the values that were set inside the method call. One thing to be aware of is that if arg1, arg2 and arg3 are value types (like Int32) then the actual arg1 variable will not have been updated because its value was copied into the array not its reference.

To get around this, create the object array before the function call, then pull the values out of the array afterwards. Like this

```
Dim paramArray = New [Object]() {arg1, arg2, arg3}
method.Invoke(obj, paramArray)
arg1 = paramArray[0]
arg2 = paramArray[1]
arg3 = paramArray[2] 
```

# c# - 与 C# 中的 NULL 混淆

> ID：714032
> 
> 赞同：7
> 
> 时间：2009-04-03T14:02:13.983
> 
> 标签：c#, .net, .net-2.0

我总是对表达空值的不同方式感到困惑。有空引用类型（又名“空”）。然后我看到，在我的整个应用程序中，开发人员都使用 MinValue 来表示空值。例如：Double.MinValue 或 DateTime.MinValue，但他们使用“null”的字符串除外

然后是 System.DBNull （和 System.DBNull.Value - 不确定何时使用）。更令人困惑的是，还有`System.Nullable`和`System.Nullable<T>`命名空间。

有人可以帮我清除这种无效的混乱吗？

谢谢

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-04-03T14:07:23.143

当然。

`System.DBNull`是 ADO.NET 曾经（现在仍然是）用来表示`null`数据库中的值的类。

`null`实际上是一个`null`引用，在您的应用程序代码中，任何引用类型都应该`null`用作它的`null`值。

`MinValue`各种原始类型（因为它们是不能赋值的值类型）的使用`null`可以追溯到引入泛型的 C# 2.0 之前的黑暗日子。现在表示可以为空的原始类型的首选方法是使用`Nullable<T>`泛型类型，通常用简写形式在原始类型之后用问号表示。例如，我可以在 C# 中声明一个可以为空的`int`变量，命名为：`foo`

```
Nullable<int> foo; 
```

或者

```
int? foo; 
```

两者是相同的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-03T14:12:09.637

*   `null`仅对*引用*类型有效：类型是 a`class`而不是 a `structure`。
*   .Net 也有值类型：int、double、DateTime 等。值类型不能为 null，因此您通常会将它们与默认值进行比较，默认值通常是`type.MinValue`，但可能是某种东西（例如，考虑布尔值）。
*   `Nullable<T>`适用于当您有一个可能真正为空的值类型时。默认值（可能是 MinValue）也是有效的，您需要将其与尚未分配变量时区分开来。在 C# 中，您可以使用 ? 使用值类型作为简写符号（例如：`int?`），但您仍在创建相同的`Nullable<T>`.
*   `DBNull`专门指数据库中的 NULL 值。这与在语言的其他地方使用 null 不同：它仅用于与数据库对话，因此您可以知道查询何时返回 null 值。
*   使用泛型时，您还会看到使用的`default(T)`构造，其中 T 是类型参数。这允许您在不知道该类型是引用类型还是值类型的情况下设置类型的默认值，更不用说特定值类型的默认值可能是什么了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T14:08:45.370

*   null 用于实际 null 值中的引用类型
*   .NET 2.0 中添加的 Nullable 是一种表示值类型空值的方式，根据定义，值类型不能为空。
*   与 DateTime.MinValue 相同 - DateTime 是一种值类型，不能为空，因此您可以约定一个众所周知的值，如 DateTime.MinValue 被视为空值。它还有其他用途。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-03T14:09:24.903

值`Null`表示尚未分配内存的任何引用类型对象。

`MinValue`不代表 a ，`Null`而是一个属性，通常用于表示给定值类型可以具有的最小可能常量值。

该类`DBNull.Value`是返回/传递到数据库的 Null 的映射。

Nullable 泛型类型使您能够将 Null 值分配给值类型。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-03T14:07:38.493

`MinValue`在 C# 2.0 中出现可空类型之前，" "s 与值类型一起使用。所以有很多遗留代码使用知道值类型何时没有值的旧样式。`DateTime? date = null`如今，使用 a比使用 容易得多`DateTime date = DateTime.MinValue`。就 DBNull 而言，这是作为数据库的抽象层所必需的，但您可以通过使用诸如 NHibernate 之类的 ORM 或类似的东西来避免自己处理它 - 您几乎可以从应用程序中处理它。开发角度只需要处理内置的 C# 类型。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-03T14:08:30.490

MinValue 不为空。这是最小值。使用 C# 1.0 的人有时将它“当作 null”使用，因为它没有可为空的值类型。相反，他们应该使用 Nullable，而不是 DateTime?。

DBNull 是一个 .NET 值，用于与数据库进行通信（“DB”为空）。NULL 的数据库概念意味着与 .NET 空引用不同的东西。在数据库术语中，NULL 表示“未知”或“不存在”。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-03T14:09:36.460

引用类型（又名对象）可以设置为 null，因为引用类型变量只是指向实际实例的指针。指示缺少实例很容易，因为您可以直接将变量设置为 null。

对于值类型，这有点困难，因为值类型变量总是包含一个值。因此，Double.MinValue 或 DateTime.MinValue 的使用在 Nullable 之前的日子里有些有效。那时没有简单的方法来表达值类型中缺少值。

现在，对于可为空的类型，您可以说：

```
double? d = null; 
```

因此，您还可以拥有包含 null 的值类型变量。

System.DBNull 是另一回事，因为它直接与在数据集中表达值“NULL”相关。这是在 imo 取代 DBNull 的可空类型之前引入的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-03T14:10:45.867

.NET 中的大多数类型都是*引用*类型，并且`null`是“非引用”，可以将其分配给变量或字段以指示没有对象。

.NET 中的所有其他类型都是值类型。始终存在具有值类型的值，因此无法指示“无值”。因此，实现可以定义特定的特殊值来指示这一点。通常，值类型的`MinValue`（常量）字段用于此目的。因此，使用`DateTime.MinValue`出生日期可以表示“未知”或“不适用”（例如，对于公司实体）。

`DbNUll`用于表达 RDBMS 的含义`NULL`与 .NET 的含义略有不同。在大多数情况下，这将被转换为 null 或类似的。

最后，`Nullable<T>`是值类型的包装器，可以更直接地表达“未知”，通常比 using 更好`MinValue`，但在 .NET 2 中添加，因此较旧的设计可能在可用`MinValue`之前`Nullable<T>`就已经开始使用。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-03T14:11:33.773

tou 理解这种不同的 null 值的最佳方法是尝试它们并查看每个值的用途，但为了简单起见，这里有一些指导方针

*   null 只能用于引用类型，如集合和自定义类（字符串是特殊的）
*   DBNull 用于来自 db 查询的空值。
*   因为我们不能将 null 分配给小数或双精度，所以我们使用 MinValue 属性分配它们（它们是值对象）

*   Nullable 是开发人员将 null 值分配给十进制等值对象的一种方式， `Nullable<int> is same as int?`

* * *

我希望我能帮助你理解这些差异。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-03T14:14:51.347

这里的重要区别在于值类型和引用类型之间。值类型直接表示某个值，而引用类型指向应该表示一个值的内存位置。当一个引用类型实际上没有指向具有有效内容的内存位置时，该引用为 Null。

由于值类型是值的直接表示，因此它们不能为空。但是，值类型的实际值可能是未知的。对于这种情况，.Net 提供了 Nullable 类型构造。然而，当这样的构造不可用时，人们倾向于使用特殊值或默认值，例如 MinValue。

在与数据库通信时，我们期望的很多值类型实际上可以是 Null，因为它是数据库处理未知值的方式。这也可以通过 Nullable 类型来解决，但这些并不总是可用的。这就是 DBNull 存在的原因，用于处理数据库中可能的空值。

# web-hosting - 一个“简单”的网站不选择基于云的托管的原因是什么？

> ID：714035
> 
> 赞同：14
> 
> 时间：2009-04-03T14:02:53.170
> 
> 标签：web-hosting, cloud

我最近通过阅读有关云托管的内容来进行一些追赶。

对于具有与 StackOverflow 大致相同特征的客户端（Windows 堆栈，相同数量的访问者），我需要设置一个托管环境。Stackoverflow 从出租变成了购买。

问题是他们为什么不选择云托管？

由于 Stackoverflow 不使用任何需要在专用服务器上运行的奇怪东西，并且据说云托管是“最佳”解决方案，为什么不使用它呢？

通过得到这个问题的答案，我希望自己能够做出权衡决定。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-03T14:08:50.287

老实说，我不知道为什么 SO 在私有服务器上运行如此。

但是，我可以假设为什么一个网站会更喜欢这个：

*   **可维护性**——当事情*确实*出错时，您希望亲身解决问题，并尽快解决问题，而不需要依赖第三方。当然，缺点是*您*需要 24/7 全天候可用来处理这些问题。
*   **可扩展性**- 云托管（或任何外部托管，就此而言）对于中小型站点来说非常方便。而且今天的大多数托管服务提供商确实为您提供了从小规模开始（例如共享托管）并发展到私人服务器/VPN/等的选择......但是如果您真的相信您需要额外的增长空间，您可能想要仅依靠您自己的基础架构。
*   **完全控制**- 使用您自己的服务器，您**永远不会**受到托管服务可能强加给您的任何限制或限制。运行你想要的任何东西，占用你的 CPU 或 RAM，等等。是你的服务器。许多托管服务提供商不给你这种自由（当然，除非你付钱:)）

同样，这是一个成本效益问题，每个企业都会以不同的方式处理它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-03T14:08:01.787

我认为这可能是一个重要原因：

> 云数据库的功能通常比本地数据库更受限制。App Engine 最多返回 1000 个结果。SimpleDB 在 5 秒内超时。在单个查询中连接来自两个表的记录会破坏针对规模优化的数据库。App Engine 提供专门的存储和查询类型，例如地理坐标。
> 
> 云实例的数据库层可以抽象为云堆栈中单独的同类最佳层，但开发人员最有可能使用本地解决方案，因为它既快速又简单。

[从尼尔肯尼迪](http://www.niallkennedy.com/blog/2009/03/cloud-computing-stack.html#cloud-stack-database)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-03T14:07:18.637

显然，我不能说 StackOverflow，但我有一些客户选择了“云托管”路线。所有这些现在都在疯狂地试图摆脱云。

在很多情况下，它还不是 100%。用户跟踪的限制（传递请求者的 IP 地址）、由于云上的其他负载而导致的性能波动以及未知的使用次数只是出现的一些问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-03T14:22:01.970

据我所见（这只是基于阅读各种博客故事），大多数情况下，云托管的美元成本是行不通的，特别是考虑到一些计划或分析。它仅对那些期望无法预测或季节性爆发的高度波动流量的人真正有价值。我猜它还处于起步阶段，它的竞争力还不够。

IIRC Jeff 和 Joel 说（在其中一个播客中）他们确实计算了这些数字，但并没有显示出有利于云的结果。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-03T14:30:21.920

我认为 Jeff 在其中一个 Podcast 中说过，他想学习很多有关托管的知识，而且通常这样做很有趣。除了一些令人头疼的问题（参见 SO 博客），我认为这是一次很棒的学习经历。

正如许多其他答案所指出的那样，云计算肯定具有它的优势，但有时您只是希望能够控制服务器的每一点。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-18T10:52:33.427

我曾经为一个相当小的网站调查过它。运行一个小型 Amazon 实例一年将花费大约 700 英镑 + 带宽成本 + S3 存储成本。具有类似规格和可观带宽限额的 VPS 托管约为 500 英镑。所以我认为成本与它有很大关系，除非你会有波动的流量和很多！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-03T14:04:51.607

我相信来自 SO 的人会回答它，但“不仅仅是更麻烦”吗？老式托管仍然很便宜，除非您遇到很大的可扩展性问题，否则为什么要进行云托管？

# ruby-on-rails - 获取当前时间的单元测试代码

> ID：714042
> 
> 赞同：5
> 
> 时间：2009-04-03T14:03:51.827
> 
> 标签：ruby-on-rails, ruby, unit-testing, datetime

为获取当前时间的代码编写单元测试的最佳方法是什么？例如，某些对象可能仅在工作日创建，其他对象在检查执行某些操作的权限时会考虑当前时间等。

我想我应该模拟 Date.today 和 Time.now。这是正确的方法吗？

更新：两种解决方案 (a) Time.is 和 (b) Time.stubs(:now).returns(t) 都有效。(a) 是非常好的方法，但 (b) 解决方案将与其他测试代码更加一致。

在这个[问题](https://stackoverflow.com/questions/565289/unit-testing-code-that-does-date-processing-based-on-todays-date)上，作者要求一个通用的解决方案。对于 Ruby，在我的选项中，上述两个解决方案[更简单](http://en.wikipedia.org/wiki/KISS_principle)，因此比提取获取当前日期/时间的代码更好。

顺便说一句，我建议使用[Chronic](http://chronic.rubyforge.org/)来获得所需的时间，例如

```
require 'Chronic'    
mon = Chronic.parse("next week monday")
Time.stubs(:now).returns(mon) 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-03T15:03:49.233

以下来自[杰·菲尔德的想法](http://blog.jayfields.com/2007/11/ruby-timeis.html)。它允许您重新定义`Time.now`块的持续时间。

```
require 'time'

class Time
  def self.metaclass
    class << self; self; end
  end

  def self.is(point_in_time)
    new_time = case point_in_time
      when String then Time.parse(point_in_time)
      when Time then point_in_time
      else raise ArgumentError.new("argument should be a string or time instance")
    end
    class << self
      alias old_now now
    end
    metaclass.class_eval do
      define_method :now do
        new_time
      end
    end
    yield
    class << self
      alias now old_now
      undef old_now
    end
  end
end

Time.is(Time.now) do
  Time.now # => Tue Nov 13 19:31:46 -0500 2007
  sleep 2
  Time.now # => Tue Nov 13 19:31:46 -0500 2007
end

Time.is("10/05/2006") do
  Time.now # => Thu Oct 05 00:00:00 -0400 2006
  sleep 2
  Time.now # => Thu Oct 05 00:00:00 -0400 2006
end 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-03T14:07:25.407

将 ITimeProvider（例如）类传递给您的例程以用于获取时间，然后您可以模拟它并使用模拟对象始终为您提供一致的时间供例程使用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-03T14:09:20.860

就在我的脑海中，我猜想最好的方法是不要让你的对象本身获得时间。换句话说，将日期/时间传递给当前正在使用内置时间构造的对象上调用的任何方法。根据您的情况，这可能是一个比模拟 Date.today 和 Time.now 更简单的解决方案，如您所建议的。

**编辑**：我说这与将 ITimeProvider 接口作为依赖项传入的建议形成鲜明对比……在我看来，这只是矫枉过正。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-03T23:32:33.503

模拟 Time.now 或 Date.today 看起来很简单，看起来像：

```
require 'rubygems'
require 'test/unit'
require 'mocha'

class MyClass

  def foo
    Time.now
  end

end

class MyTest < Test::Unit::TestCase

  def test_foo
    assert true
    t = Time.now
    Time.expects(:now).returns(t)
    assert_equal t, MyClass.new.foo
  end

end 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-03T14:22:52.857

创建一个 ITimeProvider 对象作为依赖项比传递时间要好，因为它符合 Don't Repeat Yourself 原则。

在您的生产代码中的某处，必须获取当前时间。您可以将日期生成代码置于测试覆盖范围之外，或者您可以拥有一个易于测试的对象，该对象可以在其他任何地方。

# asp.net - 如何在运行时将 ASP.Net 控件移动到 Web 窗体上的不同位置？

> ID：714046
> 
> 赞同：5
> 
> 时间：2009-04-03T14:04:16.163
> 
> 标签：asp.net, controls

是否有一种可接受的方式来“移动”控件。

我的客户想在页面上的几个不同位置之一放置一定的标记块（代表一些视觉元素）。这些位置不同，以至于我无法影响 CSS 的更改（通过浮动它或其他方式）。

我考虑将控件放置在多个位置，并将 Visible 设置为“false”，然后在该特定页面所需的位置显示该控件。

然而，这个控件的代码并不简单——例如，有几个模板部分。不得不在多个地方重复这一点会变得笨拙。此外，出于同样的原因，我不想严格从代码隐藏中使用此控件。

所以，我想把它放在 Web 表单上的一个地方，根据我想要的位置移动它。我可以将占位符放在不同的位置，将控件放在一个位置，然后将其删除并添加到正确的位置吗？我怀疑这会奏效。

有人有更好的主意吗？对此有最佳做法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-03T14:53:26.497

我建议使用占位符控件，将您的标记移动到单独的用户控件中，然后在运行时加载它并将其添加到相关的占位符中。

例如。

```
// Load a user control
MyControl userCtrl = (MyControl) LoadControl("~/Controls/MyControl.ascx");

// Or create an instance of your control
SubclassedControl subclassedCtrl = new SubclassedControl();

// Do stuff with controls here
userCtrl.LoadData();
subclassedCtrl.Text = "Hello World";

// Check which placeholder to add controls to
PlaceHolder placeHolder = (foo=="bar") ? placeHolder1 : placeHolder2;

// Add the controls
placeHolder.Controls.Add(userCtrl);
placeHolder.Controls.Add(subclassedCtrl); 
```

这将避免使用不必要的标记使您的页面混乱，并且在运行时加载它也将避免以后不必要的混乱，当另一个开发人员查看代码并且无法立即看到为什么控件位于标记中的一个位置，但呈现在页面的完全不同的部分。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-03T15:20:35.853

另一种方法（我以前见过很多次）是通过 javascript 和 DOM。在隐藏的 div 标签内呈现您的控件。所以你会在这里呈现你的内容：

```
<div id='rendercontent' style='display:none'>
  .. control here ..
</div> 
```

然后，假设你想把它全部移到这里（span 标签在里面，因为这是我们要替换的）：

```
<div id='newlocation1'><span></span></div> 
```

您将定义以下 javascript：

```
<script language="JavaScript">
function replaceNode(newElementID, targetElementID)
{
    var targetElement=document.getElementById(targetElementID);
    var newElement=document.getElementById(newElementID);
    targetElement.replaceChild(newElement, targetElement.firstChild);
}
</script> 
```

当您要将内容移动到新位置时，请调用：

```
<script language="JavaScript">
replaceNode('rendercontent','newlocation1');
</script> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-03T14:17:56.520

Web 部件是否执行您想要执行的操作？

或者，您可以以编程方式更改控件的父级，以将它们移动到单独的区域。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-03T14:18:25.863

您始终可以将面板放在预定义的位置，并在运行时将控件添加到特定面板。这是一个添加标签的示例（标签可以替换为任何控件）。

```
Dim lblDisplay As Label = New Label()
lblDisplay.ID = "myLabel"
lblDisplay.Text = "Some Text"
pnlDisplay.Controls.Add(lblDisplay) 
```

据，直到...为止...

> “此外，出于同样的原因，我不想严格从代码隐藏中使用此控件。”

我认为您将不得不在后面的代码中完成大部分工作。

PS.. 整个用户控件设置的一个很好的例子可以在这里下载.. [http://www.asp.net/downloads/starter-kits/time-tracker/](http://www.asp.net/downloads/starter-kits/time-tracker/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-03T14:40:00.367

您可以覆盖 Render 方法并将控件放置在 html 中的任何位置。

您只需将控件添加到必须在服务器上交互的控件集合中。您的 HTML 的其余部分可以写入响应流。如果您覆盖 Render，您可以创建任何您认为合适的 html，以任何顺序放置控件。

下面是一个如何写出你的html的例子。

```
protected override void Render(HtmlTextWriter writer)
{
  AddAttributesToRender(writer);
  writer.RenderBeginTag(TagKey);

  writer.RenderBeginTag(HtmlTextWriterTag.Div);
  _control.RenderControl(writer);
  writer.RenderEndTag();

  writer.RenderEndTag();
} 
```

# java - Java XML 解析

> ID：714056
> 
> 赞同：2
> 
> 时间：2009-04-03T14:06:57.077
> 
> 标签：java, xml, dom, sax

转换文档的最快方法是什么：

```
<customermodel:Customer>
    <creditCards>
        <cardNumber>@0</cardNumber>
        <provider>@HSBC</provider>
        <xsi:type>@customermodel:CreditCard</xsi:type>
             23242552
    </creditCards>
    .
    . 
```

使带有@的元素成为父元素的属性。

即到达：

```
<customermodel:Customer>
    <creditCards cardNumber="0" provider="HSBC" xsi-type="customermodel:CreditCard>
         232323232
    </creditCards>
        .
        . 
```

使用dom？或 Sax 解析器或手动？我可以将@移动到<>的

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T14:50:26.277

如果您决定使用 XSLT，它看起来像

```
 <!-- process element and attributes first so that whitespace doesn't interfere -->
  <xsl:template match="creditCards">
    <xsl:copy>
      <xsl:apply-templates select="* | @*"/>
      <xsl:apply-templates select="text()"/>
    </xsl:copy>    
  </xsl:template>

  <!-- change childrent of creditCards to attributes and strip first charcter from value -->
  <xsl:template match="creditCards/*">
    <xsl:attribute name="{name()}">
      <xsl:value-of select="substring(., 2)"/>
    </xsl:attribute>
  </xsl:template>

  <!-- rename xsi:type -->
  <xsl:template match="creditCards/xsi:type">
    <xsl:attribute name="xsi-type">
      <xsl:value-of select="substring(., 2)"/>
    </xsl:attribute>
  </xsl:template>

  <!-- identity transform -->
  <xsl:template match="node() | @*">
    <xsl:copy>
      <xsl:apply-templates select="node() | @*"/>
    </xsl:copy>
  </xsl:template> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T14:10:30.907

直接处理 XML 数据的最佳方式是使用 XQuery。这不是最容易学习的东西，但如果您经常使用 XML，它会非常有用。

一些 IDE 甚至支持 XQuery 编辑（如 Oxygen XML）。

[http://de.wikipedia.org/wiki/XQuery](http://de.wikipedia.org/wiki/XQuery) [http://www.oxygenxml.com/](http://www.oxygenxml.com/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T14:14:54.717

我认为 XSLT 是要走的路。

更多细节[在这里](http://www.onjava.com/pub/a/onjava/excerpt/java_xslt_ch5/index.html)

并使用 SAX 解析器，除非你有很好的理由。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-03T14:10:31.903

下面的链接可能会有所帮助

[http://www.totheriver.com/learn/xml/xmltutorial.html#5](http://www.totheriver.com/learn/xml/xmltutorial.html#5)

# nhibernate - 如何告诉 nHibernate 不允许表中的重复条目？

> ID：714059
> 
> 赞同：0
> 
> 时间：2009-04-03T14:07:23.190
> 
> 标签：nhibernate

我有一个简单的实体，它有一个 Id（主键）和一个字符串名称。我正在寻找一种方法来告诉 nHibernate 不允许表中出现重复名称。

我想要一个可以采用新实体（Id = 0）的 Add 方法，并在必要时添加新实体并更新 Id。这现在有效。如果名称已经存在于表中，我想简单地更新 Id 并返回现有的 Id。

我希望能够这样称呼它：

Foo foo = new Foo(name); // foo.Id = 0 FooRepository.Add(foo);

.. 然后 foo.Id <> 0 并且它被添加或找到现有的 foo.name 并返回其 Id。

谢谢/jf

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T14:13:38.933

您必须在映射文件中将唯一属性设置为 true 才能使其成为唯一列。

```
<property name="serialNumber" unique="true" type="string" column="SERIAL_NUMBER"/> 
```

如果您打算将该列作为该表的主键，则输入

```
<id name="CommentId">
    <column name="comment_id" not-null="false"/>
    <generator class="identity"/>
</id> 
```

该列将自动对其具有唯一约束。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T14:31:26.860

我不认为 nhibernate 可以在自然键上额外匹配。您必须在存储库的 add 方法中执行此操作。即按名称查找，如果找到更新名称并保存。（通过示例查找可能会在这里为您节省时间）

看起来您想在此处使用分配的 id 而不是代理 id。可能是地图名称作为标识符并摆脱代理键

# python - 从父文件夹导入模块

> ID：714063
> 
> 赞同：881
> 
> 时间：2009-04-03T14:08:02.190
> 
> 标签：python, module, path, directory, python-import

我正在运行 Python 2.5。

这是我的文件夹树：

```
ptdraft/
  nib.py
  simulations/
    life/
      life.py 
```

（我`__init__.py`在每个文件夹中也有，为了便于阅读，这里省略了）

如何`nib`从模块内部导入`life`模块？我希望无需修改 sys.path 就可以做到。

注意：正在运行的主模块位于`ptdraft`文件夹中。

* * *

## 回答 #1

> 赞同：698
> 
> 时间：2009-04-03T16:17:27.513

您可以使用相对导入（python >= 2.5）：

```
from ... import nib 
```

[（Python 2.5 中的新增功能）PEP 328：绝对和相对导入](http://docs.python.org/2/whatsnew/2.5.html#pep-328-absolute-and-relative-imports)

**编辑**：添加了另一个点“。” 上两包

* * *

## 回答 #2

> 赞同：399
> 
> 时间：2012-06-22T14:30:07.303

相对导入（如`from .. import mymodule`）仅在包中有效。要导入当前模块的父目录中的“mymodule”：

```
import os
import sys
import inspect

currentdir = os.path.dirname(os.path.abspath(inspect.getfile(inspect.currentframe())))
parentdir = os.path.dirname(currentdir)
sys.path.insert(0, parentdir) 

import mymodule 
```

**编辑**：`__file__`属性并不总是给出。而不是使用`os.path.abspath(__file__)`我现在建议使用检查模块来检索当前文件的文件名（和路径）

* * *

## 回答 #3

> 赞同：384
> 
> 时间：2018-05-05T21:24:48.987

*对于从同级包导入的问题，我也发布了类似的答案。你可以[在这里](https://stackoverflow.com/a/50193944/3015186)看到它。*

# 没有`sys.path`黑客的解决方案

### 概括

*   将代码打包到一个文件夹中（例如`packaged_stuff`）
*   创建一个`setup.py`使用[setuptools.setup()](https://stackoverflow.com/a/50193944/3015186)的脚本。
*   Pip 以可编辑状态安装包`pip install -e <myproject_folder>`
*   使用导入`from packaged_stuff.modulename import function_name`

## 设置

我假设与问题中的文件夹结构相同

```
.
└── ptdraft
    ├── __init__.py
    ├── nib.py
    └── simulations
        ├── __init__.py
        └── life
            ├── __init__.py
            └── life.py 
```

我调用`.`根文件夹，在我的情况下，它位于`C:\tmp\test_imports`.

## 脚步

1.  `setup.py`在根文件夹中添加一个-- 里面的内容`setup.py`可以很简单

```
 from setuptools import setup, find_packages

    setup(name='myproject', version='1.0', packages=find_packages()) 
```

基本上“任何”`setup.py`都可以。这只是一个最小的工作示例。

2.  使用虚拟环境

* * *

*如果您熟悉虚拟环境，请激活一个，然后跳到下一步。*虚拟环境的使用不是*绝对*必要的，但从长远来看，它们*确实*会帮助你（当你有超过 1 个正在进行的项目时......）。最基本的步骤是（在根文件夹中运行）

*   创建虚拟环境
    *   `python -m venv venv`
*   激活虚拟环境
    *   `. venv/bin/activate`(Linux) 或`./venv/Scripts/activate`(Win)
*   停用虚拟环境
    *   `deactivate`(Linux)

要了解更多信息，只需谷歌搜索“python virtualenv 教程”或类似内容。除了创建、激活和停用之外，您可能永远不需要任何其他命令。

一旦你创建并激活了一个虚拟环境，你的控制台应该在括号中给出虚拟环境的名称

```
PS C:\tmp\test_imports> python -m venv venv
PS C:\tmp\test_imports> .\venv\Scripts\activate
(venv) PS C:\tmp\test_imports> 
```

3.  pip 以可编辑状态安装您的项目

* * *

`myproject`使用`pip`. _ 诀窍是`-e`在安装时使用标志。这样它以可编辑状态安装，对 .py 文件所做的所有编辑都将自动包含在安装的包中。

在根目录下，运行

`pip install -e .`（注意点，它代表“当前目录”）

您还可以看到它是通过使用安装的`pip freeze`

```
(venv) PS C:\tmp\test_imports> pip install -e .
Obtaining file:///C:/tmp/test_imports
Installing collected packages: myproject
  Running setup.py develop for myproject
Successfully installed myproject
(venv) PS C:\tmp\test_imports> pip freeze
myproject==1.0 
```

4.  `mainfolder`在每次导入之前导入

* * *

在此示例中，`mainfolder`将是`ptdraft`。这样做的好处是您不会遇到与其他模块名称（来自 python 标准库或 3rd 方模块）的名称冲突。

* * *

# 示例用法

## 笔尖

```
def function_from_nib():
    print('I am the return value from function_from_nib!') 
```

## 生活.py

```
from ptdraft.nib import function_from_nib

if __name__ == '__main__':
    function_from_nib() 
```

## 运行生活.py

```
(venv) PS C:\tmp\test_imports> python .\ptdraft\simulations\life\life.py
I am the return value from function_from_nib! 
```

* * *

## 回答 #4

> 赞同：147
> 
> 时间：2009-04-03T14:09:23.840

似乎问题与位于父目录或类似目录中的模块无关。

您需要将包含的目录添加`ptdraft`到 PYTHONPATH

您说这`import nib`与您合作，这可能意味着您将`ptdraft`自己（而不是其父级）添加到 PYTHONPATH。

* * *

## 回答 #5

> 赞同：105
> 
> 时间：2015-02-25T06:37:47.063

**您可以在sys.path**中列出的“模块搜索路径”中使用取决于操作系统的路径。因此，您可以轻松添加父目录，如下所示

```
import sys
sys.path.insert(0,'..') 
```

如果要添加父父目录，

```
sys.path.insert(0,'../..') 
```

这适用于 python 2 和 3。

* * *

## 回答 #6

> 赞同：72
> 
> 时间：2017-02-14T19:57:07.057

对python 2不太了解，
在python 3中可以添加父文件夹如下：

```
import sys 
sys.path.append('..') 
```

...然后可以从中导入模块

* * *

## 回答 #7

> 赞同：62
> 
> 时间：2012-02-17T15:30:55.643

如果将模块文件夹添加到 PYTHONPATH 不起作用，您可以在 Python 解释器搜索要导入的模块的程序中修改**sys.path列表，** [python 文档](http://docs.python.org/tutorial/modules.html#the-module-search-path)说：

> 当导入名为**spam**的模块时，解释器首先搜索具有该名称的内置模块。如果没有找到，它会在变量 sys.path 给出的目录列表中搜索名为**spam.py的文件。**sys.path 从这些位置初始化：
> 
> > *   包含输入脚本的目录（或当前目录）。
> > *   PYTHONPATH（目录名称列表，与 shell 变量 PATH 具有相同的语法）。
> > *   安装相关的默认值。
> > 
> > 初始化后，Python 程序可以修改**sys.path**。包含正在运行的脚本的目录位于搜索路径的开头，位于标准库路径之前。这意味着将加载该目录中的脚本，而不是库目录中的同名模块。除非打算更换，否则这是一个错误。

知道了这一点，您可以在程序中执行以下操作：

```
import sys
# Add the ptdraft folder path to the sys.path list
sys.path.append('/path/to/ptdraft/')

# Now you can import your module
from ptdraft import nib
# Or just
import ptdraft 
```

* * *

## 回答 #8

> 赞同：35
> 
> 时间：2015-11-04T21:06:30.593

这是一个简单的答案，因此您可以了解它是如何工作的，小型且跨平台。
它只使用内置模块（和） `os`，因此应该适用 于任何操作系统（OS），因为 Python 就是为此而设计的。`sys``inspect`

### 更短的答案代码 - 更少的行和变量

```
from inspect import getsourcefile
import os.path as path, sys
current_dir = path.dirname(path.abspath(getsourcefile(lambda:0)))
sys.path.insert(0, current_dir[:current_dir.rfind(path.sep)])
import my_module  # Replace "my_module" here with the module name.
sys.path.pop(0) 
```

对于比这更少的行，将第二行替换为`import os.path as path, sys, inspect`，在（第 3 行）的开头
添加并删除第一行。 - 但是这会导入所有模块，因此可能需要更多时间、内存和资源。`inspect.``getsourcefile`

### 我的答案的代码（*更长的版本*）

```
from inspect import getsourcefile
import os.path
import sys

current_path = os.path.abspath(getsourcefile(lambda:0))
current_dir = os.path.dirname(current_path)
parent_dir = current_dir[:current_dir.rfind(os.path.sep)]

sys.path.insert(0, parent_dir)

import my_module  # Replace "my_module" here with the module name. 
```

它使用来自 Stack Overflow 答案的示例*[如何
在 Python 中获取当前执行文件的路径？](https://stackoverflow.com/questions/2632199/how-do-i-get-the-path-of-the-current-executed-file-in-python/33531619#33531619)*使用内置工具查找运行代码的源（文件名）。

> ```
> from inspect import getsourcefile  
> from os.path import abspath 
> ```
> 
> 接下来，无论您想从哪里找到源文件，只需使用：
> 
> ```
> abspath(getsourcefile(lambda:0)) 
> ```

我的代码将文件路径添加到`sys.path`python*路径列表*
，因为这允许 Python 从该文件夹导入模块。

在代码中导入模块后，当添加的文件夹具有与 稍后在程序 中导入的另一个模块同名的模块时，最好`sys.path.pop(0)`在新行上运行。您需要删除导入之前添加的列表项，而不是其他路径。 如果您的程序不导入其他模块，则不删除文件路径是安全的，因为 在程序结束（或重新启动 Python shell）后，所做的任何编辑都会消失。

`sys.path`

### 关于文件名变量的注释

我的答案没有使用`__file__`变量来获取运行代码的文件路径/文件名，
因为这里的用户经常将其描述为**unreliable**。您不应该使用它
来从其他人使用的程序 *的父文件夹中导入模块。*

**它不起作用的一些示例（引用[this](https://stackoverflow.com/questions/2632199/how-do-i-get-the-path-of-the-current-executed-file-in-python/) Stack Overflow question）：**

•在某些平台上找不到 • 有时[不是](https://stackoverflow.com/questions/714063/importing-modules-from-parent-folder/11158224#11158224)[完整的文件路径](https://stackoverflow.com/questions/714063/importing-modules-from-parent-folder/33532002#comment33997203_19409830)

> *   `py2exe`没有`__file__`属性，但有一个解决方法
> *   当您从`execute()`没有`__file__`属性的 IDLE 运行时
> *   我得到的 OS X 10.6`NameError: global name '__file__' is not defined`

* * *

## 回答 #9

> 赞同：32
> 
> 时间：2014-02-14T16:09:22.770

这是更通用的解决方案，将父目录包含在 sys.path 中（对我有用）：

```
import os.path, sys
sys.path.append(os.path.join(os.path.dirname(os.path.realpath(__file__)), os.pardir)) 
```

* * *

## 回答 #10

> 赞同：28
> 
> 时间：2016-03-31T13:08:47.087

pathlib 库（包含在 >= Python 3.4 中）使得将父目录的路径附加到 PYTHONPATH 变得非常简洁和直观：

```
import sys
from pathlib import Path
sys.path.append(str(Path('.').absolute().parent)) 
```

* * *

## 回答 #11

> 赞同：24
> 
> 时间：2019-04-29T22:09:37.620

我发现以下方法适用于从脚本的父目录导入包。在示例中，我想`env.py`从`app.db`包中导入函数。

```
.
└── my_application
    └── alembic
        └── env.py
    └── app
        ├── __init__.py
        └── db 
```

```
import os
import sys
currentdir = os.path.dirname(os.path.realpath(__file__))
parentdir = os.path.dirname(currentdir)
sys.path.append(parentdir) 
```

* * *

## 回答 #12

> 赞同：22
> 
> 时间：2019-11-06T16:33:19.580

**在 Jupyter Notebook 中（使用 Jupyter LAB 或 Jupyter Notebook 打开）**

只要您在 Jupyter Notebook 中工作，这个简短的解决方案可能会很有用：

```
%cd ..
import nib 
```

即使没有`__init__.py`文件，它也可以工作。

我在 Linux 和 Windows 7 上使用 Anaconda3 对其进行了测试。

* * *

## 回答 #13

> 赞同：18
> 
> 时间：2018-07-28T11:15:52.673

上面提到的解决方案也很好。这个问题的另一个解决方案是

如果您想从顶级目录导入任何内容。然后，

```
from ...module_name import * 
```

此外，如果您想从父目录导入任何模块。然后，

```
from ..module_name import * 
```

此外，如果您想从父目录导入任何模块。然后，

```
from ...module_name.another_module import * 
```

这样，您可以根据需要导入任何特定方法。

* * *

## 回答 #14

> 赞同：12
> 
> 时间：2018-04-12T13:48:33.400

对我来说，访问父目录的最短且我最喜欢的 oneliner 是：

```
sys.path.append(os.path.dirname(os.getcwd())) 
```

或者：

```
sys.path.insert(1, os.path.dirname(os.getcwd())) 
```

os.getcwd() 返回当前工作目录的名称，os.path.dirname(directory_name) 返回传递的目录名称。

实际上，在我看来，Python 项目架构应该按照子目录中的任何模块都不会使用父目录中的任何模块的方式来完成。如果发生这样的事情，值得重新考虑项目树。

另一种方法是将父目录添加到 PYTHONPATH 系统环境变量。

* * *

## 回答 #15

> 赞同：10
> 
> 时间：2016-09-05T23:07:57.597

`import sys sys.path.append('../')`

* * *

## 回答 #16

> 赞同：8
> 
> 时间：2020-10-11T14:32:12.947

虽然原作者可能不再寻找解决方案，但为了完整性，有一个简单的解决方案。将*life.py*作为一个模块运行，如下所示：

```
cd ptdraft
python -m simulations.life.life 
```

这样，您可以从*nib.py*导入任何内容，因为*ptdraft*目录位于路径中。

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2013-10-16T17:25:20.493

与过去的答案相同的风格 - 但行数更少：P

```
import os,sys
parentdir = os.path.dirname(__file__)
sys.path.insert(0,parentdir) 
```

文件返回您正在工作的位置

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2017-10-25T14:16:11.320

在 Linux 系统中，您可以创建从“life”文件夹到 nib.py 文件的软链接。然后，您可以像这样简单地导入它：

```
import nib 
```

* * *

## 回答 #19

> 赞同：5
> 
> 时间：2021-04-24T15:11:54.743

我认为您可以在该特定示例中尝试此操作，但在 python 3.6.3 中 [![在此处输入图像描述](https://i.stack.imgur.com/2S8pY.png)](https://i.stack.imgur.com/2S8pY.png)

* * *

## 回答 #20

> 赞同：4
> 
> 时间：2021-09-18T08:52:47.860

两行最简单的解决方案

```
import os, sys
sys.path.insert(0, os.getcwd()) 
```

如果 parent 是您的工作目录，并且您想从子脚本中调用另一个子模块。

您可以在任何脚本中从父目录导入所有子模块并将其执行为

```
python child_module1/child_script.py 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2021-02-24T12:02:57.507

我们的文件夹结构：

```
/myproject
  project_using_ptdraft/
    main.py
  ptdraft/
    __init__.py
    nib.py
    simulations/
      __init__.py
      life/
        __init__.py
        life.py 
```

我理解这一点的方式是有一个以包为中心的视图。包根是`ptdraft`，因为它是包含的最顶层`__init__.py`

包中的所有文件都可以使用绝对路径（相对于包根目录）进行导入，例如在 中`life.py`，我们只需：

```
import ptdraft.nib 
```

但是，要运行`life.py`包开发/测试目的，`python life.py`我们需要使用：

```
cd /myproject
python -m ptdraft.simulations.life.life 
```

请注意，此时我们根本不需要摆弄任何路径。

* * *

更令人困惑的是，当我们完成`ptdraft`包时，我们想在驱动程序脚本中使用它，该脚本必须在`ptdraft`包文件夹之外，也就是`project_using_ptdraft/main.py`我们需要摆弄路径：

```
import sys
sys.path.append("/myproject")  # folder that contains ptdraft
import ptdraft
import ptdraft.simulations 
```

并用于`python main.py`毫无问题地运行脚本。

有用的网址：

*   [https://tenthousandmeters.com/blog/python-behind-the-scenes-11-how-the-python-import-system-works/](https://tenthousandmeters.com/blog/python-behind-the-scenes-11-how-the-python-import-system-works/)（看看怎么`__init__.py`用）
*   [https://chrisyeh96.github.io/2017/08/08/definitive-guide-python-imports.html#running-package-initialization-code](https://chrisyeh96.github.io/2017/08/08/definitive-guide-python-imports.html#running-package-initialization-code)
*   [https://stackoverflow.com/a/50392363/2202107](https://stackoverflow.com/a/50392363/2202107)
*   [https://stackoverflow.com/a/27876800/2202107](https://stackoverflow.com/a/27876800/2202107)

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2015-09-24T20:56:22.803

与图书馆合作。创建一个名为 nib 的库，使用 setup.py 安装它，让它驻留在站点包中，您的问题就解决了。你不必把你做的所有东西都塞进一个包里。把它分解成碎片。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2020-07-06T11:52:29.100

我遇到了一个问题，我必须导入一个 Flask 应用程序，该应用程序的导入还需要在单独的文件夹中导入文件。这部分使用了[Remi 的答案](https://stackoverflow.com/a/11158224/7910473)，但假设我们有一个如下所示的存储库：

```
.
└── service
    └── misc
        └── categories.csv
    └── test
        └── app_test.py
    app.py
    pipeline.py 
```

然后在从`app.py`文件中导入应用程序对象之前，我们将目录更改为上一级，因此当我们导入应用程序（导入`pipeline.py`）时，我们还可以读取其他文件，如 csv 文件。

```
import os,sys,inspect
currentdir = os.path.dirname(os.path.abspath(inspect.getfile(inspect.currentframe())))
parentdir = os.path.dirname(currentdir)
sys.path.insert(0,parentdir)

os.chdir('../')
from app import app 
```

导入 Flask 应用程序后，您可以使用`os.chdir('./test')`，这样您的工作目录就不会更改。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2021-08-12T21:16:27.053

在我看来，您实际上并不需要导入父模块。假设在 nib.py 中有 func1() 和 data1，需要在 life.py 中使用

## 笔尖

```
import simulations.life.life as life
def func1():
   pass
data1 = {}
life.share(func1, data1) 
```

## 生活.py

```
func1 = data1 = None

def share(*args):
   global func1, data1
   func1, data1 = args 
```

现在您可以访问 life.py 中的 func1 和数据了。当然，在尝试使用它们之前，你必须小心在 life.py 中填充它们，

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2020-07-03T07:31:22.217

我制作了这个库来做到这一点。

[https://github.com/fx-kirin/add_parent_path](https://github.com/fx-kirin/add_parent_path)

```
# Just add parent path
add_parent_path(1)

# Append to syspath and delete when the exist of with statement.
with add_parent_path(1):
   # Import modules in the parent path
   pass 
```

* * *

## 回答 #26

> 赞同：-2
> 
> 时间：2020-06-15T09:49:58.117

虽然违反了所有规则，但我还是要提一下这种可能性：

您可以先将文件从父目录复制到子目录。接下来导入它并随后删除复制的文件：

例如在`life.py`：

```
import os
import shutil

shutil.copy('../nib.py', '.')
import nib
os.remove('nib.py')

# now you can use it just fine:
nib.foo() 
```

当然，当 nibs 尝试使用相对导入/路径导入/读取其他文件时，可能会出现一些问题。

* * *

## 回答 #27

> 赞同：-5
> 
> 时间：2021-07-26T23:16:21.430

这对我来说可以从更高的文件夹中导入东西。

```
import os
os.chdir('..') 
```

# javascript - 你如何组织 Javascript 的冗长性？

> ID：714068
> 
> 赞同：1
> 
> 时间：2009-04-03T14:09:11.783
> 
> 标签：javascript, greasemonkey

我正在编写一个 GM 脚本，而我意识到我正在反复做的一件事就是一遍又一遍地执行相同的代码。具体来说，样式属性。

```
function createButton() {
    var a = document.createElement('a');
    a.href = '#';
    a.innerHTML = 'Print Topic';
    a.style.position = 'absolute';
    a.style.right = '3em';
    a.style.top = '6em';
    a.style.fontFamily = 'Arial,Helvetica,sans-serif';
    a.style.fontWeight = 'bold';
    a.style.fontSize = '125%';
    a.style.background = '#777777 none repeat scroll 0 0';
    a.style.color = 'white';
    a.style.padding = '6px 12px';
    document.body.insertBefore(a, document.body.lastChild);
} 
```

正如您在我的示例代码中所看到的，我反复写了 a.style 很多次。你有避免这种混乱的技术吗？只是为了优雅。

谢谢 -

伙计们，这是简化的代码：

```
function createButton() {
    var a = document.createElement('a');
    var css = document.createElement('style');
    css.type = 'text/css';
    css.innerHTML = '#prt { position:absolute; right:3em; top: 6em; font-family: Arial,Helvetica,sans-serif; font-weight:bold; font-size:125%; background: #777777 none repeat scroll 0 0; color: white; padding: 6px 12px;}'
    a.href = '#';
    a.innerHTML = 'Print Topic';
    a.id = 'prt';
    document.body.insertBefore(a, document.body.lastChild);
    document.body.appendChild(css);
} 
```

大声笑，那当然看起来更好

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-03T14:11:51.760

将样式属性放入 CSS 类中，然后只需动态交换类，而不是显式地执行每个样式属性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T14:12:06.457

不是很好但可能比原来更好的答案：

```
s = a.style;

s.position = "absolute";
...etc...
s.color = "white"; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T14:13:12.053

尝试

如果您使用的是 jQuery，您可以编写：

```
$("a").css({position: "absolute", right: "3em", top: "6em"}) // etc. 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-03T14:18:47.673

jQuery 通过一个魔术函数 $() 使事情变得更短，它返回一个 dom 元素的包装器。

包装器使您可以访问所有 css 属性，以及几乎所有它的方法（即设置器返回“this”），包括 CSS 设置器。

举个例子会更清楚...

```
$("<a href='toto/'></a>")
    .css("position", "absolute");
    .css("right", "3em")
    .appendTo($(containerid)); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-03T14:32:20.307

Javascript 有一个[with](https://developer.mozilla.org/en/Core_JavaScript_1.5_Guide/Object_Manipulation_Statements#with_Statement)语句...

```
with a.style {
  position = 'absolute';
  right = '3em';
} 
```

您可以将重复的功能拆分为函数并将元素作为参数传递...

```
function setStyle(elem) {
  with elem.style {
    position = 'absolute';
    right = '3em';
  }

  return elem
}

//Invoke like this: elem = setStyle(elem) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-03T14:45:30.853

详细说明上面投票率最高的答案。只需将所有 css 信息放入 css 类。然后只需分配类属性。

```
<style type='text/css'>
 a .prt { 
 position:absolute; 
 right:3em; 
 top: 6em; 
 font-family: Arial,Helvetica,sans-serif; 
 font-weight:bold; 
 font-size:125%;
 background: #777777 none repeat scroll 0 0;
 color: white; padding: 6px 12px;
}
</style>
<script>
function createButton() {    
 var a = document.createElement('a');
 a.class= 'prt';   
 document.body.insertBefore(a, document.body.lastChild);
}
</script> 
```

# c# - 客户端/服务器在 1 次连接后都放弃

> ID：714091
> 
> 赞同：0
> 
> 时间：2009-04-03T14:13:37.933
> 
> 标签：c#, .net, networking, tcp, client-server

我正在编写一个客户端/服务器（你们中的许多人可能已经知道了！）。服务器将向客户端发送数据。但是，客户端可以连接一次，之后一旦连接终止，它就不会再次尝试连接。同样，一旦服务器发送了它的消息，它将忽略未来的连接尝试。

服务器：

```
public Server(String p)
    {
        path = p;
        listener = new TcpListener(IPAddress.Any, 1337);
        listener.Start();
        Thread t = new Thread(new ThreadStart(ListenForClients));
        t.IsBackground = true;
        t.Start();
    }

    private void ListenForClients()
    {
        TcpClient client = listener.AcceptTcpClient();
        new Thread(new ParameterizedThreadStart(HandleClientCom)).Start(client);
    }

    private void HandleClientCom(object TcpClient)
    {
        new Dialog("Connection", "Connection established.");
        TcpClient client = (TcpClient)TcpClient;
        NetworkStream stream = client.GetStream();
        //SslStream stream = new SslStream(client.GetStream());
        //stream.AuthenticateAsServer(new X509Certificate(path + "\\ServerCert.cer"));

        ASCIIEncoding encoder = new ASCIIEncoding();
        String str = "This is a long piece of text to send to the client.";
        byte[] bytes = encoder.GetBytes(str);

        stream.Write(bytes, 0, bytes.Length);
        stream.Flush();
    } 
```

客户：

```
public TCP(BackgroundWorker b)
    {
        try
        {
            bw = b;
            client = new TcpClient();
            IPEndPoint server = new IPEndPoint(IPAddress.Parse(srv), 1337);
            client.Connect(server); //Connect to the server
            bw.ReportProgress(0);   //Update the GUI with the connection status

            Thread t = new Thread(new ParameterizedThreadStart(HandleComms));
            t.IsBackground = true;
            t.Start(client);
        }
        catch (Exception ex)
        {
            lastException = ex;
        }
    }

    public void HandleComms(object c)
    {
        Boolean keepListening = true;
        TcpClient client = (TcpClient)c;
        NetworkStream stream = client.GetStream();
        //stream = new SslStream(client.GetStream());
        //stream.AuthenticateAsClient(srv);

        byte[] msg = new byte[4096]; ;
        int bytesRead = 0;

        while (keepListening)
        {
            try
            {
                bytesRead = stream.Read(msg, 0, 4096);
            }
            catch (Exception ex)
            {
                lastException = ex;
            }

            if (bytesRead > 0)
            {
                StreamWriter writer = new StreamWriter("C:\\Users\\Chris\\Desktop\\ClientLog.txt");
                ASCIIEncoding encoder = new ASCIIEncoding();
                rx = encoder.GetString(msg);
                writer.WriteLine(rx);
                keepListening = false;
                writer.Close();
            }
        }
    } 
```

抱歉，代码量很大。无论如何可以指出我哪里出错了？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T14:17:19.237

接受连接后，您需要重新开始收听。

尝试进行此更改：

```
private void ListenForClients()
{
    while(true)
    {
        TcpClient client = listener.AcceptTcpClient();
        new Thread(new ParameterizedThreadStart(HandleClientCom)).Start(client);
    }
} 
```

# c# - 使用委托的新实例取消注册事件

> ID：714098
> 
> 赞同：3
> 
> 时间：2009-04-03T14:16:19.753
> 
> 标签：c#, events

```
EventHandler a = new EventHandler(control_RegionChanged);
EventHandler b = new EventHandler(control_RegionChanged);

 if (a == b)
 {
     Console.WriteLine("Same!");
 }
 else
 {
     Console.WriteLine(a.GetHashCode() + " " + b.GetHashCode());
 } 
```

这将写入`Same!`控制台。

```
control.RegionChanged += new EventHandler(control_RegionChanged);
control.RegionChanged -= new EventHandler(control_RegionChanged); 
```

这段代码执行后，是`EventHandler`未注册的吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-03T14:20:37.217

是的; 代表在实例上进行比较，并且`MethodInfo`；如果它们相同，那么它将起作用。尝试取消订阅匿名方法时会出现问题；在这种情况下，您必须保留对委托的引用才能取消订阅。

所以：

这可以：

```
control.SomeEvent += obj.SomeMethod;
//...
control.SomeEvent -= obj.SomeMethod; 
```

但这风险更大：

```
control.SomeEvent += delegate {Trace.WriteLine("Foo");};
//...
control.SomeEvent -= delegate {Trace.WriteLine("Foo");}; 
```

使用匿名方法的正确过程是：

```
EventHandler handler = delegate {Trace.WriteLine("Foo");};
control.SomeEvent += handler;
//...
control.SomeEvent -= handler; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T14:20:01.553

尝试使用

```
control.RegionChanged += control_RegionChanged
control.RegionChanged -= control_RegionChanged 
```

这也应该有效（从记忆中 - 还没有真正测试过）。至少它不会创建新的事件处理程序引用。

# makefile - 操作系统检测生成文件

> ID：714100
> 
> 赞同：293
> 
> 时间：2009-04-03T14:16:36.100
> 
> 标签：makefile, os-agnostic, os-detection

我经常在几台不同的计算机和几个不同的操作系统上工作，它们是 Mac OS X、Linux 或 Solaris。对于我正在处理的项目，我从远程 git 存储库中提取代码。

无论我在哪个终端，我都希望能够处理我的项目。到目前为止，我已经找到了通过在每次切换计算机时更改生成文件来绕过操作系统更改的方法。然而，这很乏味并且会引起很多头痛。

如何修改我的 makefile 以检测我正在使用的操作系统并相应地修改语法？

这是生成文件：

```
cc = gcc -g
CC = g++ -g
yacc=$(YACC)
lex=$(FLEX)

all: assembler

assembler: y.tab.o lex.yy.o
        $(CC) -o assembler y.tab.o lex.yy.o -ll -l y

assembler.o: assembler.c
        $(cc) -o assembler.o assembler.c

y.tab.o: assem.y
        $(yacc) -d assem.y
        $(CC) -c y.tab.c

lex.yy.o: assem.l
        $(lex) assem.l
        $(cc) -c lex.yy.c

clean:
        rm -f lex.yy.c y.tab.c y.tab.h assembler *.o *.tmp *.debug *.acts 
```

* * *

## 回答 #1

> 赞同：330
> 
> 时间：2012-08-23T20:06:35.247

这里已经有很多很好的答案，但我想分享一个更完整的例子：

*   不假定`uname`在 Windows 上存在
*   还检测处理器

此处定义的 CCFLAGS 不一定是推荐的或理想的；它们正是我添加 OS/CPU 自动检测的项目碰巧正在使用的。

```
ifeq ($(OS),Windows_NT)
    CCFLAGS += -D WIN32
    ifeq ($(PROCESSOR_ARCHITEW6432),AMD64)
        CCFLAGS += -D AMD64
    else
        ifeq ($(PROCESSOR_ARCHITECTURE),AMD64)
            CCFLAGS += -D AMD64
        endif
        ifeq ($(PROCESSOR_ARCHITECTURE),x86)
            CCFLAGS += -D IA32
        endif
    endif
else
    UNAME_S := $(shell uname -s)
    ifeq ($(UNAME_S),Linux)
        CCFLAGS += -D LINUX
    endif
    ifeq ($(UNAME_S),Darwin)
        CCFLAGS += -D OSX
    endif
    UNAME_P := $(shell uname -p)
    ifeq ($(UNAME_P),x86_64)
        CCFLAGS += -D AMD64
    endif
    ifneq ($(filter %86,$(UNAME_P)),)
        CCFLAGS += -D IA32
    endif
    ifneq ($(filter arm%,$(UNAME_P)),)
        CCFLAGS += -D ARM
    endif
endif 
```

* * *

## 回答 #2

> 赞同：128
> 
> 时间：2009-04-03T14:22:09.927

不带参数的 uname 命令 ( [http://developer.apple.com/documentation/Darwin/Reference/ManPages/man1/uname.1.html](http://developer.apple.com/documentation/Darwin/Reference/ManPages/man1/uname.1.html) ) 应该告诉您操作系统名称。我会使用它，然后根据返回值制作条件。

例子

```
UNAME := $(shell uname)

ifeq ($(UNAME), Linux)
# do something Linux-y
endif
ifeq ($(UNAME), Solaris)
# do something Solaris-y
endif 
```

* * *

## 回答 #3

> 赞同：69
> 
> 时间：2013-02-08T17:17:51.647

### 使用两个简单的技巧检测操作系统：

*   首先是环境变量`OS`
*   然后`uname`命令

```
ifeq ($(OS),Windows_NT)     # is Windows_NT on XP, 2000, 7, Vista, 10...
    detected_OS := Windows
else
    detected_OS := $(shell uname)  # same as "uname -s"
endif 
```

或者更安全的方式，如果不在 Windows 上且不`uname`可用：

```
ifeq ($(OS),Windows_NT) 
    detected_OS := Windows
else
    detected_OS := $(shell sh -c 'uname 2>/dev/null || echo Unknown')
endif 
```

如果您想区分 Cygwin/MinGW/MSYS/Windows，[Ken Jackson提出了一个有趣的替代方案。](https://stackoverflow.com/u/1060774)看看[他的回答](https://stackoverflow.com/a/52062069/938111)是这样的：

```
ifeq '$(findstring ;,$(PATH))' ';'
    detected_OS := Windows
else
    detected_OS := $(shell uname 2>/dev/null || echo Unknown)
    detected_OS := $(patsubst CYGWIN%,Cygwin,$(detected_OS))
    detected_OS := $(patsubst MSYS%,MSYS,$(detected_OS))
    detected_OS := $(patsubst MINGW%,MSYS,$(detected_OS))
endif 
```

然后您可以根据以下内容选择相关内容`detected_OS`：

```
ifeq ($(detected_OS),Windows)
    CFLAGS += -D WIN32
endif
ifeq ($(detected_OS),Darwin)        # Mac OS X
    CFLAGS += -D OSX
endif
ifeq ($(detected_OS),Linux)
    CFLAGS   +=   -D LINUX
endif
ifeq ($(detected_OS),GNU)           # Debian GNU Hurd
    CFLAGS   +=   -D GNU_HURD
endif
ifeq ($(detected_OS),GNU/kFreeBSD)  # Debian kFreeBSD
    CFLAGS   +=   -D GNU_kFreeBSD
endif
ifeq ($(detected_OS),FreeBSD)
    CFLAGS   +=   -D FreeBSD
endif
ifeq ($(detected_OS),NetBSD)
    CFLAGS   +=   -D NetBSD
endif
ifeq ($(detected_OS),DragonFly)
    CFLAGS   +=   -D DragonFly
endif
ifeq ($(detected_OS),Haiku)
    CFLAGS   +=   -D Haiku
endif 
```

## 笔记：

*   命令与此[**`uname`**](http://www.man7.org/linux/man-pages/man1/uname.1.html)相同，**`uname -s`**因为选项**`-s`**( **`--kernel-name`**) 是默认值。看看[为什么**`uname -s`**比**`uname -o`**](https://stackoverflow.com/a/27776822/938111).

*   `OS`（而不是）的使用`uname`简化了识别算法。您仍然可以单独使用`uname`，但您必须处理`if/else`块以检查所有 MinGW、Cygwin 等变体。

*   环境变量`OS`始终设置为`"Windows_NT"`不同的 Windows 版本（请参阅[`%OS%`Wikipedia 上的环境变量](https://en.wikipedia.org/wiki/Environment_variable#OS)）。

*   另一种方法`OS`是环境变量`MSVC`（它检查*MS Visual Studio*的存在，参见[使用 Visual C++ 的示例](https://stackoverflow.com/a/27776822/938111)）。

* * *

下面我提供了一个使用`make`和`gcc`构建共享库的完整示例：`*.so`或`*.dll`取决于平台。该示例尽可能简单以便更易于理解。

要在 Windows 上安装`make`和安装，`gcc`请参阅[Cygwin](http://cygwin.com/install.html)或[MinGW](http://www.mingw.org/wiki/Getting_Started)。

## 我的示例基于五个文件

```
 ├── lib
 │   └── Makefile
 │   └── hello.h
 │   └── hello.c
 └── app
     └── Makefile
     └── main.c 
```

**提醒：** `Makefile`使用**制表**缩进。复制粘贴下面的示例文件时要小心。

## 两个`Makefile`文件

### 1.**`lib/Makefile`**

```
ifeq ($(OS),Windows_NT)
    uname_S := Windows
else
    uname_S := $(shell uname -s)
endif

ifeq ($(uname_S), Windows)
    target = hello.dll
endif
ifeq ($(uname_S), Linux)
    target = libhello.so
endif
#ifeq ($(uname_S), .....) #See https://stackoverflow.com/a/27776822/938111
#    target = .....
#endif

%.o: %.c
    gcc  -c $<  -fPIC  -o $@
    # -c $<  => $< is first file after ':' => Compile hello.c
    # -fPIC  => Position-Independent Code (required for shared lib)
    # -o $@  => $@ is the target => Output file (-o) is hello.o

$(target): hello.o
    gcc  $^  -shared  -o $@
    # $^      => $^ expand to all prerequisites (after ':') => hello.o
    # -shared => Generate shared library
    # -o $@   => Output file (-o) is $@ (libhello.so or hello.dll) 
```

### 2.**`app/Makefile`**

```
ifeq ($(OS),Windows_NT)
    uname_S := Windows
else
    uname_S := $(shell uname -s)
endif

ifeq ($(uname_S), Windows)
    target = app.exe
endif
ifeq ($(uname_S), Linux)
    target = app
endif
#ifeq ($(uname_S), .....) #See https://stackoverflow.com/a/27776822/938111
#    target = .....
#endif

%.o: %.c
    gcc  -c $< -I ../lib  -o $@
    # -c $<     => compile (-c) $< (first file after :) = main.c
    # -I ../lib => search headers (*.h) in directory ../lib
    # -o $@     => output file (-o) is $@ (target) = main.o

$(target): main.o
    gcc  $^  -L../lib  -lhello  -o $@
    # $^       => $^ (all files after the :) = main.o (here only one file)
    # -L../lib => look for libraries in directory ../lib
    # -lhello  => use shared library hello (libhello.so or hello.dll)
    # -o $@    => output file (-o) is $@ (target) = "app.exe" or "app" 
```

要了解更多信息，请阅读[cfi](https://stackoverflow.com/users/923794/cfi)指出的[*自动变量*文档](http://www.gnu.org/software/make/manual/html_node/Automatic-Variables.html)。

## 源代码

### -**`lib/hello.h`**

```
#ifndef HELLO_H_
#define HELLO_H_

const char* hello();

#endif 
```

### -**`lib/hello.c`**

```
#include "hello.h"

const char* hello()
{
    return "hello";
} 
```

### -**`app/main.c`**

```
#include "hello.h" //hello()
#include <stdio.h> //puts()

int main()
{
    const char* str = hello();
    puts(str);
} 
```

## 构建

`Makefile`修复（用一个列表替换前导空格）的复制粘贴。

```
> sed  's/^  */\t/'  -i  */Makefile 
```

该`make`命令在两个平台上是相同的。给定的输出在类 Unix 操作系统上：

```
> make -C lib
make: Entering directory '/tmp/lib'
gcc  -c hello.c  -fPIC  -o hello.o
# -c hello.c  => hello.c is first file after ':' => Compile hello.c
# -fPIC       => Position-Independent Code (required for shared lib)
# -o hello.o  => hello.o is the target => Output file (-o) is hello.o
gcc  hello.o  -shared  -o libhello.so
# hello.o        => hello.o is the first after ':' => Link hello.o
# -shared        => Generate shared library
# -o libhello.so => Output file (-o) is libhello.so (libhello.so or hello.dll)
make: Leaving directory '/tmp/lib'

> make -C app
make: Entering directory '/tmp/app'
gcc  -c main.c -I ../lib  -o main.o
# -c main.c => compile (-c) main.c (first file after :) = main.cpp
# -I ../lib => search headers (*.h) in directory ../lib
# -o main.o => output file (-o) is main.o (target) = main.o
gcc  main.o  -L../lib  -lhello  -o app
# main.o   => main.o (all files after the :) = main.o (here only one file)
# -L../lib => look for libraries in directory ../lib
# -lhello  => use shared library hello (libhello.so or hello.dll)
# -o app   => output file (-o) is app.exe (target) = "app.exe" or "app"
make: Leaving directory '/tmp/app' 
```

## 运行

应用程序需要知道共享库在哪里。

在 Windows 上，一个简单的解决方案是复制应用程序所在的库：

```
> cp -v lib/hello.dll app
`lib/hello.dll' -> `app/hello.dll' 
```

在类 Unix 操作系统上，您可以使用`LD_LIBRARY_PATH`环境变量：

```
> export LD_LIBRARY_PATH=lib 
```

在 Windows 上运行命令：

```
> app/app.exe
hello 
```

在类 Unix 操作系统上运行命令：

```
> app/app
hello 
```

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2012-09-10T12:01:37.610

我最近在做实验，以回答我问自己的这个问题。以下是我的结论：

由于在 Windows 中，您无法确定该`uname`命令是否可用，因此您可以使用`gcc -dumpmachine`. 这将显示编译器目标。

`uname`如果你想做一些交叉编译，在使用的时候也可能会出现问题。

以下是可能输出的示例列表`gcc -dumpmachine`：

*   mingw32
*   i686-pc-cygwin
*   x86_64-redhat-linux

您可以像这样检查 makefile 中的结果：

```
SYS := $(shell gcc -dumpmachine)
ifneq (, $(findstring linux, $(SYS)))
 # Do Linux things
else ifneq(, $(findstring mingw, $(SYS)))
 # Do MinGW things
else ifneq(, $(findstring cygwin, $(SYS)))
 # Do Cygwin things
else
 # Do things for others
endif 
```

它对我来说效果很好，但我不确定这是获取系统类型的可靠方法。至少它对**MinGW**是可靠的，这就是我所需要的，因为它不需要在 Windows中有`uname`命令或**MSYS包。**

总而言之，`uname`为您提供**您**正在编译的系统，并`gcc -dumpmachine`为您提供您正在**为其**编译的系统。

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2009-04-13T09:30:25.587

[git makefile](http://git.kernel.org/?p=git/git.git;a=blob_plain;f=Makefile;hb=c965c029330b1f81cc107c5d829e7fd79c61d8ea)包含许多关于如何在没有 autoconf/automake 的情况下进行管理的示例，但仍然可以在许多 unixy 平台上工作。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2012-05-15T20:23:10.583

更新：我现在认为这个答案已经过时了。我在下面发布了一个新的完美解决方案。

如果您的 makefile 可能在非 Cygwin Windows 上运行，`uname`则可能不可用。这很尴尬，但这是一个潜在的解决方案。您必须先检查 Cygwin 以排除它，因为它的`PATH`环境变量中也有 WINDOWS。

```
ifneq (,$(findstring /cygdrive/,$(PATH)))
    UNAME := Cygwin
else
ifneq (,$(findstring WINDOWS,$(PATH)))
    UNAME := Windows
else
    UNAME := $(shell uname -s)
endif
endif 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-04-03T14:19:38.887

这就是 GNU 的[automake](http://www.gnu.org/software/automake/) / [autoconf](http://www.gnu.org/software/autoconf/)旨在解决的工作。你可能想调查他们。

或者，您可以在不同平台上设置环境变量，并使 Makefile 以它们为条件。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2012-04-24T19:52:03.447

我今天遇到了这个问题，我在 Solaris 上需要它，所以这里有一个 POSIX 标准的方法来做（非常接近）这个。

```
#Detect OS
UNAME = `uname`

# Build based on OS name
DetectOS:
    -@make $(UNAME)

# OS is Linux, use GCC
Linux: program.c
    @SHELL_VARIABLE="-D_LINUX_STUFF_HERE_"
    rm -f program
    gcc $(SHELL_VARIABLE) -o program program.c

# OS is Solaris, use c99
SunOS: program.c
    @SHELL_VARIABLE="-D_SOLARIS_STUFF_HERE_"
    rm -f program
    c99 $(SHELL_VARIABLE) -o program program.c 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2018-08-28T16:03:03.943

我终于找到了为我解决这个问题的完美解决方案。

```
ifeq '$(findstring ;,$(PATH))' ';'
    UNAME := Windows
else
    UNAME := $(shell uname 2>/dev/null || echo Unknown)
    UNAME := $(patsubst CYGWIN%,Cygwin,$(UNAME))
    UNAME := $(patsubst MSYS%,MSYS,$(UNAME))
    UNAME := $(patsubst MINGW%,MSYS,$(UNAME))
endif 
```

UNAME 变量设置为 Linux、Cygwin、MSYS、Windows、FreeBSD、NetBSD（或者可能是 Solaris、Darwin、OpenBSD、AIX、HP-UX）或未知。然后可以在 Makefile 的其余部分进行比较，以分离任何操作系统敏感的变量和命令。

关键是 Windows 使用分号来分隔 PATH 变量中的路径，而其他所有人都使用冒号。（可以在名称中创建一个带有 ';' 的 Linux 目录并将其添加到 PATH 中，这会破坏这一点，但谁会这样做呢？）这似乎是检测本机 Windows 风险最小的方法，因为它不需要外壳调用。Cygwin 和 MSYS PATH 使用冒号，因此为它们调用*uname 。*

请注意，OS 环境变量可用于检测 Windows，但不能用于区分 Cygwin 和原生 Windows。测试引号的回声是可行的，但它需要一个 shell 调用。

不幸的是，Cygwin 在*uname*的输出中添加了一些版本信息，所以我添加了 'patsubst' 调用以将其更改为 'Cygwin'。此外，MSYS 的 uname 实际上有三个可能的输出，以 MSYS 或 MINGW 开头，但我也使用 patsubst 将所有输出转换为“MSYS”。

如果区分路径上带有和不带有 uname.exe 的本地 Windows 系统很重要，则可以使用这一行来代替简单的赋值：

```
UNAME := $(shell uname 2>NUL || echo Windows) 
```

当然，在所有情况下都需要 GNU *make*，或者另一个支持所使用功能的*make 。*

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2015-05-14T14:43:10.323

这是一个简单的解决方案，用于检查您是否处于 Windows 或类似 posix 的 (Linux/Unix/Cygwin/Mac) 环境中：

```
ifeq ($(shell echo "check_quotes"),"check_quotes")
   WINDOWS := yes
else
   WINDOWS := no
endif 
```

它利用了 echo 在类 posix 和 Windows 环境中都存在的事实，并且在 Windows 中，shell 不会过滤引号。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-10-01T16:12:59.397

请注意，Makefile 对间距非常敏感。这是一个在 OS X 上运行额外命令并在 OS X 和 Linux 上运行的 Makefile 示例。不过，总的来说，autoconf/automake 是解决任何不平凡的事情的方法。

```
UNAME := $(shell unname -s)
CPP = g++
CPPFLAGS = -pthread -ansi -Wall -Werror -pedantic -O0 -g3 -I /nexopia/include
LDFLAGS = -pthread -L/nexopia/lib -lboost_system

HEADERS = data_structures.h http_client.h load.h lock.h search.h server.h thread.h utility.h
OBJECTS = http_client.o load.o lock.o search.o server.o thread.o utility.o vor.o

全部：vor

干净的：
    rm -f $(对象) vor

vor：$（对象）
    $(CPP) $(LDFLAGS) -o vor $(OBJECTS)
ifeq ($(UNAME),达尔文)
    # 设置 Boost 库位置
    install_name_tool -change libboost_system.dylib /nexopia/lib/libboost_system.dylib vor
万一

%.o: %.cpp $(HEADERS) Makefile
    $(CPP) $(CPPFLAGS) -c $
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-08-04T00:43:13.767

另一种方法是使用“配置”脚本。如果您已经在 makefile 中使用了一个，则可以结合使用 uname 和 sed 来解决问题。首先，在您的脚本中，执行以下操作：

```
UNAME=uname 
```

然后，为了把它放在你的 Makefile 中，从 Makefile.in 开始，它应该有类似的东西

```
UNAME=@@UNAME@@ 
```

在里面。

`UNAME=uname`在位之后的配置脚本中使用以下 sed 命令。

```
sed -e "s|@@UNAME@@|$UNAME|" < Makefile.in > Makefile 
```

现在您的 makefile 应该已`UNAME`根据需要进行了定义。剩下的就是 if/elif/else 语句！

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-03-13T12:30:15.247

我有一个案例，我必须检测两个版本的 Fedora 之间的差异，以调整 inkscape 的命令行选项：
- 在 Fedora 31 中，默认的 inkscape 是 1.0beta，它使用`--export-file`
- 在 Fedora < 31 中，默认的 inkscape 是0.92 使用`--export-pdf`

我的 Makefile 包含以下内容

```
# set VERSION_ID from /etc/os-release

$(eval $(shell grep VERSION_ID /etc/os-release))

# select the inkscape export syntax

ifeq ($(VERSION_ID),31)
EXPORT = export-file
else
EXPORT = export-pdf
endif

# rule to convert inkscape SVG (drawing) to PDF

%.pdf : %.svg
    inkscape --export-area-drawing $< --$(EXPORT)=$@ 
```

这是有效的，因为`/etc/os-release`包含一行

```
VERSION_ID=<value> 
```

因此 Makefile 中的 shell 命令返回字符串`VERSION_ID=<value>`，然后 eval 命令对此进行操作以设置 Makefile 变量`VERSION_ID`。这显然可以针对其他操作系统进行调整，具体取决于元数据的存储方式。请注意，在 Fedora 中没有提供操作系统版本的默认环境变量，否则我会使用它！

# c# - 在 C# 中查找包含超过 20,000 个文件的目录中的文件的最快方法

> ID：714101
> 
> 赞同：21
> 
> 时间：2009-04-03T14:16:37.147
> 
> 标签：c#, .net, file-io

我有一个每天晚上运行的工作，从根目录下有超过 20,000 个子文件夹的目录中提取 xml 文件。这是结构的样子：

```
rootFolder/someFolder/someSubFolder/xml/myFile.xml
rootFolder/someFolder/someSubFolder1/xml/myFile1.xml
rootFolder/someFolder/someSubFolderN/xml/myFile2.xml
rootFolder/someFolder1
rootFolder/someFolderN 
```

所以看上面，结构总是一样的——一个根文件夹，然后是两个子文件夹，然后是一个xml目录，然后是xml文件。我只知道 rootFolder 的名称和 xml 目录。

下面的代码遍历所有目录，速度极慢。关于如何优化搜索的任何建议，尤其是在目录结构已知的情况下？

```
string[] files = Directory.GetFiles(@"\\somenetworkpath\rootFolder", "*.xml", SearchOption.AllDirectories); 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-03T14:24:18.907

与其进行 GetFiles 并进行蛮力搜索，不如使用 GetDirectories，首先获取“第一个子文件夹”的列表，遍历这些目录，然后对子文件夹重复该过程，遍历它们，最后查看对于 xml 文件夹，最后搜索 .xml 文件。

现在，至于性能，速度会有所不同，但首先搜索目录，然后获取文件应该会有很大帮助！

**更新**

好的，我做了一些快速的测试，你实际上可以比我想象的更进一步优化它。

以下代码片段将搜索目录结构并在整个目录树中查找所有“xml”文件夹。

```
string startPath = @"C:\Testing\Testing\bin\Debug";
string[] oDirectories = Directory.GetDirectories(startPath, "xml", SearchOption.AllDirectories);
Console.WriteLine(oDirectories.Length.ToString());
foreach (string oCurrent in oDirectories)
    Console.WriteLine(oCurrent);
Console.ReadLine(); 
```

如果您将其放入测试控制台应用程序中，您将看到它输出结果。

现在，一旦你有了这个，只需在找到的每个目录中查找 .xml 文件。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2013-11-15T16:50:52.120

我创建了一个递归方法`GetFolders`，使用 a`Parallel.ForEach`来查找所有命名为变量的文件夹`yourKeyword`

```
List<string> returnFolders = new List<string>();
object locker = new object();

Parallel.ForEach(subFolders, subFolder =>
{
    if (subFolder.ToUpper().EndsWith(yourKeyword))
    {
        lock (locker)
        {
            returnFolders.Add(subFolder);
        }
    }
    else
    {
        lock (locker)
        {
            returnFolders.AddRange(GetFolders(Directory.GetDirectories(subFolder)));
        }
    }
});

return returnFolders; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-03T14:22:36.837

是否有与 xml 文件夹处于同一级别的其他目录？如果是这样，如果您自己进行搜索并从搜索中消除该级别，则可能会加快搜索速度。

```
 System.IO.DirectoryInfo root = new System.IO.DirectoryInfo(rootPath);
        List<System.IO.FileInfo> xmlFiles=new List<System.IO.FileInfo>();

        foreach (System.IO.DirectoryInfo subDir1 in root.GetDirectories())
        {
            foreach (System.IO.DirectoryInfo subDir2 in subDir1.GetDirectories())
            {
                System.IO.DirectoryInfo xmlDir = new System.IO.DirectoryInfo(System.IO.Path.Combine(subDir2.FullName, "xml"));

                if (xmlDir.Exists)
                {
                    xmlFiles.AddRange(xmlDir.GetFiles("*.xml"));
                }
            }
        } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-03T14:24:01.700

我想不出 C# 中更快的方法，但是您是否为该文件系统打开了索引？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-03T14:25:47.140

我能看到这会产生很大差异的唯一方法是从蛮力搜索中改变并使用一些第三方或操作系统索引例程来加速返回。这样搜索是从您的应用程序离线完成的。

但我也建议你应该尽可能地寻找更好的方法来构建这些数据。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-03T14:29:03.513

使用 P/Invoke on //`FindFirstFile`并避免创建大量 FileInfo 实例的开销。`FindNextFile``FindClose`

但这将是一项艰巨的工作（您必须自己处理文件与目录的所有处理以及递归）。因此，请尝试一些简单的方法（Directory.GetFiles()、Directory.GetDirectories()），然后开始工作。如果速度太慢，请查看替代方案（但始终衡量，太容易使其变慢）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-02-23T13:30:25.837

根据您的需要和配置，您可以使用 Windows 搜索索引：[https ://msdn.microsoft.com/en-us/library/windows/desktop/bb266517(v=vs.85).aspx](https://msdn.microsoft.com/en-us/library/windows/desktop/bb266517(v=vs.85).aspx)

根据您的配置，这可能会大大提高性能。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-03-22T20:44:40.777

出于文件和目录搜索的目的，我想提供具有广泛搜索机会的使用多线程 .NET 库。您可以在 GitHub 上找到有关库的所有信息： [https](https://github.com/VladPVS/FastSearchLibrary) ://github.com/VladPVS/FastSearchLibrary 如果您想下载它，可以在这里下载：[https](https://github.com/VladPVS/FastSearchLibrary/releases) ://github.com/VladPVS/FastSearchLibrary/releases 如果您有任何问题请问他们。

工作速度非常快。自己检查吧！

这是如何使用它的一个示范性示例：

```
class Searcher
{
    private static object locker = new object(); 

    private FileSearcher searcher;

    List<FileInfo> files;

    public Searcher()
    {
        files = new List<FileInfo>();
    }

    public void Startsearch()
    {
        CancellationTokenSource tokenSource = new CancellationTokenSource();

        searcher = new FileSearcher(@"C:\", (f) =>
        {
            return Regex.IsMatch(f.Name, @".*[Dd]ragon.*.jpg$");
        }, tokenSource);  

        searcher.FilesFound += (sender, arg) => 
        {
            lock (locker) // using a lock is obligatorily
            {
                arg.Files.ForEach((f) =>
                {
                    files.Add(f);
                    Console.WriteLine($"File location: {f.FullName}, \nCreation.Time: {f.CreationTime}");
                });

                if (files.Count >= 10) 
                    searcher.StopSearch();
            }
        };

        searcher.SearchCompleted += (sender, arg) => 
        {
            if (arg.IsCanceled) 
                Console.WriteLine("Search stopped.");
            else
                Console.WriteLine("Search completed.");

            Console.WriteLine($"Quantity of files: {files.Count}"); 
        };

        searcher.StartSearchAsync();
    }
} 
```

这是其他示例的一部分：

```
***
List<string> folders = new List<string>
{
  @"C:\Users\Public",
  @"C:\Windows\System32",
  @"D:\Program Files",
  @"D:\Program Files (x86)"
}; // list of search directories

List<string> keywords = new List<string> { "word1", "word2", "word3" }; // list of search keywords

FileSearcherMultiple multipleSearcher = new FileSearcherMultiple(folders, (f) =>
{
  if (f.CreationTime >= new DateTime(2015, 3, 15) &&
     (f.Extension == ".cs" || f.Extension == ".sln"))
    foreach (var keyword in keywords)
      if (f.Name.Contains(keyword))
        return true;
  return false;
}, tokenSource, ExecuteHandlers.InCurrentTask, true);  
*** 
```

此外，可以使用简单的静态方法：

```
List<FileInfo> files = FileSearcher.GetFilesFast(@"C:\Users", "*.xml"); 
```

请注意，此库的所有方法都不会抛出 UnauthorizedAccessException 而不是标准的 .NET 搜索方法。

此外，如果您使用多核处理器，该库的快速方法的执行速度至少比简单的单线程递归算法快 2 倍。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-05-09T20:12:47.530

对于那些想要搜索单个文件并且知道根目录的人，我建议您尽可能保持简单。这种方法对我有用。

```
 private void btnSearch_Click(object sender, EventArgs e)
    {
        string userinput = txtInput.Text;

        string sourceFolder = @"C:\mytestDir\";
        string searchWord = txtInput.Text + ".pdf";
        string filePresentCK = sourceFolder + searchWord;
        if (File.Exists(filePresentCK))
            {

                pdfViewer1.LoadFromFile(sourceFolder+searchWord);
            }
            else if(! File.Exists(filePresentCK))
            {
                MessageBox.Show("Unable to Find file :" + searchWord);
            }

        txtInput.Clear();

    }// end of btnSearch method 
```

# java - 任意数量集合的笛卡尔积

> ID：714108
> 
> 赞同：55
> 
> 时间：2009-04-03T14:17:40.903
> 
> 标签：java, set, cartesian-product

你知道一些简洁的 Java 库，它们可以让你制作两个（或更多）集合的笛卡尔积吗？

例如：我有三套。一个是 Person 类的对象，第二个是 Gift 类的对象，第三个是 GiftExtension 类的对象。

我想生成一组包含所有可能的三元组 Person-Gift-GiftExtension。

集合的数量可能会有所不同，因此我无法在嵌套的 foreach 循环中执行此操作。在某些情况下，我的应用程序需要制作 Person-Gift pair 的乘积，有时它是三重 Person-Gift-GiftExtension，有时甚至可能会设置 Person-Gift-GiftExtension-GiftSecondExtension-GiftThirdExtension 等。

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-04-03T14:48:32.997

***编辑：****删除了两组以前的解决方案。有关详细信息，请参阅编辑历史记录。*

这是一种对任意数量的集合递归执行的方法：

```
public static Set<Set<Object>> cartesianProduct(Set<?>... sets) {
    if (sets.length < 2)
        throw new IllegalArgumentException(
                "Can't have a product of fewer than two sets (got " +
                sets.length + ")");

    return _cartesianProduct(0, sets);
}

private static Set<Set<Object>> _cartesianProduct(int index, Set<?>... sets) {
    Set<Set<Object>> ret = new HashSet<Set<Object>>();
    if (index == sets.length) {
        ret.add(new HashSet<Object>());
    } else {
        for (Object obj : sets[index]) {
            for (Set<Object> set : _cartesianProduct(index+1, sets)) {
                set.add(obj);
                ret.add(set);
            }
        }
    }
    return ret;
} 
```

请注意，不可能在返回的集合中保留任何通用类型信息。如果您事先知道要获取多少个集合的乘积，则可以定义一个通用元组来保存那么多元素（例如`Triple<A, B, C>`），但是在 Java 中没有办法拥有任意数量的通用参数。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2013-11-15T12:41:50.357

这是一个很老的问题，但为什么不使用[Guava 的笛卡尔产品](https://google.github.io/guava/releases/snapshot/api/docs/com/google/common/collect/Sets.html#cartesianProduct-java.util.List-)呢？

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2012-02-29T09:07:29.140

下面的方法创建字符串列表的笛卡尔积：

```
protected <T> List<List<T>> cartesianProduct(List<List<T>> lists) {
    List<List<T>> resultLists = new ArrayList<List<T>>();
    if (lists.size() == 0) {
        resultLists.add(new ArrayList<T>());
        return resultLists;
    } else {
        List<T> firstList = lists.get(0);
        List<List<T>> remainingLists = cartesianProduct(lists.subList(1, lists.size()));
        for (T condition : firstList) {
            for (List<T> remainingList : remainingLists) {
                ArrayList<T> resultList = new ArrayList<T>();
                resultList.add(condition);
                resultList.addAll(remainingList);
                resultLists.add(resultList);
            }
        }
    }
    return resultLists;
} 
```

例子：

```
System.out.println(cartesianProduct(Arrays.asList(Arrays.asList("Apple", "Banana"), Arrays.asList("Red", "Green", "Blue")))); 
```

会产生这个：

```
[[Apple, Red], [Apple, Green], [Apple, Blue], [Banana, Red], [Banana, Green], [Banana, Blue]] 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-04-03T15:52:38.820

> 集合的数量可能会有所不同，因此我无法在嵌套的 foreach 循环中执行此操作。

两个提示：

*   A x B x C = A x (B x C)
*   递归

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2012-06-08T09:12:39.793

**基于索引的解决方案**

使用索引是一种快速且节省内存的替代方法，并且可以处理任意数量的集合。实现 Iterable 允许在 for-each 循环中轻松使用。有关用法示例，请参见#main 方法。

```
public class CartesianProduct implements Iterable<int[]>, Iterator<int[]> {

    private final int[] _lengths;
    private final int[] _indices;
    private boolean _hasNext = true;

    public CartesianProduct(int[] lengths) {
        _lengths = lengths;
        _indices = new int[lengths.length];
    }

    public boolean hasNext() {
        return _hasNext;
    }

    public int[] next() {
        int[] result = Arrays.copyOf(_indices, _indices.length);
        for (int i = _indices.length - 1; i >= 0; i--) {
            if (_indices[i] == _lengths[i] - 1) {
                _indices[i] = 0;
                if (i == 0) {
                    _hasNext = false;
                }
            } else {
                _indices[i]++;
                break;
            }
        }
        return result;
    }

    public Iterator<int[]> iterator() {
        return this;
    }

    public void remove() {
        throw new UnsupportedOperationException();
    }

    /**
     * Usage example. Prints out
     * 
     * <pre>
     * [0, 0, 0] a, NANOSECONDS, 1
     * [0, 0, 1] a, NANOSECONDS, 2
     * [0, 0, 2] a, NANOSECONDS, 3
     * [0, 0, 3] a, NANOSECONDS, 4
     * [0, 1, 0] a, MICROSECONDS, 1
     * [0, 1, 1] a, MICROSECONDS, 2
     * [0, 1, 2] a, MICROSECONDS, 3
     * [0, 1, 3] a, MICROSECONDS, 4
     * [0, 2, 0] a, MILLISECONDS, 1
     * [0, 2, 1] a, MILLISECONDS, 2
     * [0, 2, 2] a, MILLISECONDS, 3
     * [0, 2, 3] a, MILLISECONDS, 4
     * [0, 3, 0] a, SECONDS, 1
     * [0, 3, 1] a, SECONDS, 2
     * [0, 3, 2] a, SECONDS, 3
     * [0, 3, 3] a, SECONDS, 4
     * [0, 4, 0] a, MINUTES, 1
     * [0, 4, 1] a, MINUTES, 2
     * ...
     * </pre>
     */
    public static void main(String[] args) {
        String[] list1 = { "a", "b", "c", };
        TimeUnit[] list2 = TimeUnit.values();
        int[] list3 = new int[] { 1, 2, 3, 4 };

        int[] lengths = new int[] { list1.length, list2.length, list3.length };
        for (int[] indices : new CartesianProduct(lengths)) {
            System.out.println(Arrays.toString(indices) //
                    + " " + list1[indices[0]] //
                    + ", " + list2[indices[1]] //
                    + ", " + list3[indices[2]]);
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-04-10T05:20:46.387

这是一个 Iterable，它允许您使用简化的 for 循环：

```
import java.util.*;

// let's begin with the demo. Instead of Person and Gift, 
// I use the well known char and int. 
class CartesianIteratorTest {

    public static void main (String[] args) {
        List <Object> lc = Arrays.asList (new Object [] {'A', 'B', 'C', 'D'});
        List <Object> lC = Arrays.asList (new Object [] {'a', 'b', 'c'});   
        List <Object> li = Arrays.asList (new Object [] {1, 2, 3, 4});
            // sometimes, a generic solution like List <List <String>>
            // might be possible to use - typically, a mixture of types is 
            // the common nominator 
        List <List <Object>> llo = new ArrayList <List <Object>> ();
        llo.add (lc);
        llo.add (lC);
        llo.add (li);

        // Preparing the List of Lists is some work, but then ...    
        CartesianIterable <Object> ci = new CartesianIterable <Object> (llo);

        for (List <Object> lo: ci)
            show (lo);
    }

    public static void show (List <Object> lo) {
        System.out.print ("(");
        for (Object o: lo)
            System.out.print (o + ", ");
        System.out.println (")");
    }
} 
```

它是如何完成的？我们需要一个 Iterable，以使用简化的 for 循环，并且必须从 Iterable 返回一个 Iterator。我们返回一个对象列表——这可以是一个集合而不是列表，但是集合没有索引访问，所以用集合而不是列表来实现它会有点复杂。与通用解决方案不同，Object 可以用于多种用途，但泛型允许更多限制。

```
class CartesianIterator <T> implements Iterator <List <T>> {

    private final List <List <T>> lilio;    
    private int current = 0;
    private final long last;

    public CartesianIterator (final List <List <T>> llo) {
        lilio = llo;
        long product = 1L;
        for (List <T> lio: lilio)
            product *= lio.size ();
        last = product;
    } 

    public boolean hasNext () {
        return current != last;
    }

    public List <T> next () {
        ++current;
        return get (current - 1, lilio);
    }

    public void remove () {
        ++current;
    }

    private List<T> get (final int n, final List <List <T>> lili) {
        switch (lili.size ())
        {
            case 0: return new ArrayList <T> (); // no break past return;
            default: {
                List <T> inner = lili.get (0);
                List <T> lo = new ArrayList <T> ();
                lo.add (inner.get (n % inner.size ()));
                lo.addAll (get (n / inner.size (), lili.subList (1, lili.size ())));
                return lo;
            }
        }
    }
} 
```

数学工作是在“get”方法中完成的。考虑 2 组 10 个元素。您总共有 100 种组合，从 00、01、02、... 10、... 到 99 枚举。对于 5 X 10 元素 50，对于 2 X 3 元素 6 组合。子列表大小的模有助于为每次迭代选择一个元素。

可迭代我这里最不有趣的事情：

```
class CartesianIterable <T> implements Iterable <List <T>> {

    private List <List <T>> lilio;  

    public CartesianIterable (List <List <T>> llo) {
        lilio = llo;
    }

    public Iterator <List <T>> iterator () {
        return new CartesianIterator <T> (lilio);
    }
} 
```

为了实现允许for-each循环的Iterable，我们必须实现iterator()，而对于Iterator，我们必须实现hasNext()、next()和remove()。

结果：

```
(A, a, 1, )
(B, a, 1, )
(C, a, 1, )
(D, a, 1, )
(A, b, 1, )
(B, b, 1, )
(C, b, 1, )
(D, b, 1, )
...
(A, a, 2, )
...
(C, c, 4, )
(D, c, 4, ) 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2015-04-19T22:24:00.870

这是一个`Iterator`给出二维数组的笛卡尔积的结果，其中数组组件表示问题中的集合（总是可以将实际`Set`的 s 转换为数组）：

```
public class CartesianIterator<T> implements Iterator<T[]> {
    private final T[][] sets;
    private final IntFunction<T[]> arrayConstructor;

    private int count = 0;
    private T[] next = null;

    public CartesianIterator(T[][] sets, IntFunction<T[]> arrayConstructor) {
        Objects.requireNonNull(sets);
        Objects.requireNonNull(arrayConstructor);

        this.sets = copySets(sets);
        this.arrayConstructor = arrayConstructor;
    }

    private static <T> T[][] copySets(T[][] sets) {
        // If any of the arrays are empty, then the entire iterator is empty.
        // This prevents division by zero in `hasNext`.
        for (T[] set : sets) {
            if (set.length == 0) {
                return Arrays.copyOf(sets, 0);
            }
        }
        return sets.clone();
    }

    @Override
    public boolean hasNext() {
        if (next != null) {
            return true;
        }

        int tmp = count;
        T[] value = arrayConstructor.apply(sets.length);
        for (int i = 0; i < value.length; i++) {
            T[] set = sets[i];

            int radix = set.length;
            int index = tmp % radix;

            value[i] = set[index];

            tmp /= radix;
        }

        if (tmp != 0) {
            // Overflow.
            return false;
        }

        next = value;
        count++;

        return true;
    }

    @Override
    public T[] next() {
        if (!hasNext()) {
            throw new NoSuchElementException();
        }

        T[] tmp = next;
        next = null;
        return tmp;
    }
} 
```

基本思想是将`count`其视为多基数（数字`i`有自己的基数，等于`i`“第”组的长度）。每当我们必须解决`next`时（即，何时`hasNext()`被调用和`next`是`null`），我们将数字分解为这个多基数中的数字。这些数字现在用作我们从不同集合中提取元素的索引。

示例使用：

```
String[] a = { "a", "b", "c"};
String[] b = { "X" };
String[] c = { "r", "s" };

String[][] abc = { a, b, c };

Iterable<String[]> it = () -> new CartesianIterator<>(abc, String[]::new);
for (String[] s : it) {
    System.out.println(Arrays.toString(s));
} 
```

输出：

```
[a, X, r]
[b, X, r]
[c, X, r]
[a, X, s]
[b, X, s]
[c, X, s] 
```

如果不喜欢数组，代码可以很容易地转换为使用集合。

我想这或多或少类似于“用户未知”给出的答案，只是没有递归和集合。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-03T21:42:01.523

是的，有[函数式 Java](http://functionaljava.org/)。

对于一组`s`：

```
s.bind(P.p2(), s); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-04-20T07:44:12.323

您可以使用*Java 9 Streams*获取任意数量的*不同类型集合的**笛卡尔积*，并将其存储到一*组*对象中，如下所示：**`Set<Set<Object>>`**

 ***[在线尝试！](https://tio.run/##nVVRb9owEH7nV9x4qJIJ3ELf2pKpqyZt0qpNYm/THky4gKljZ7ZT1E397fTsBJI26dgWCUgud/fdd3f@2PB7Pt4s73Y7kRfaONiQgdmfkn0TOV4O2tbSCcne9tisM8hz/2pQlAspUkgltxZuuVDwewB01XbruKOfObor//my2GDqkgRSbhxawdVXo5dl6iL/9l3CGAOLzsZ1Fn@dnoJQqTaGIsNdLtQKltzxg4vIIPJhMJuBKqWMwaArjYIbLSWFCa0sw7xwDwQTxZeHwNrt2hj@YGtaIVN8cGmVobQa@/TA1TI8hJSh4I47y4R0aHwyGCfeB95UxcHJiX9kVvzCKIYEznrBDBYGLSoHyNN1SIASc2/gFlrN7ELnvGjh7mnFwU6BFxf7UJ11oVslzEPg1cvhJa/GsLTqd1T3XRvLnA49j3tJ2jLPuR8P6AwKLoz1N0IpNK@01SCtC0ae32TkfaZxzXNyIPonTrQ@C6EC5jGsZpSSu1vqXfCd1HDT43At2BzNCsFtdQuQbp0GrfBogjC5EDj16NVcmM7qikZV0unxSjqUwjpURP4hunfMzVmL/jrT/vos1B0uP3K7DgUp3MZ9G9PeHNpvGl97nIP/rrcXvv9Qer2wHT0bgXZrNFthkcQBDrrQ3V9tPkiLUb8w1cr0OOiR0HstlpCTwEY0flLA7z@Am9UzpfQVfVIOV2iqEwEzb/OLQjsyHcF5S/oChZCpWufGd3g9HMHwvf@6Gb6IqAn7iPMmghoG/u8jOvMUnkO0Vb/S6K74N4c5fLfLpKbr0hVl00qfhGXUR5LFaP5gHdJRKGlsBZFxUh2a@LjbPQE "Java (JDK) – 在线试用")

```
public static Set<Set<Object>> cartesianProduct(Set<?>... sets) {
    // incorrect incoming data
    if (sets == null) return Collections.emptySet();
    return Arrays.stream(sets)
            // non-null and non-empty sets
            .filter(set -> set != null && set.size() > 0)
            // represent each set element as Set<Object>
            .map(set -> set.stream().map(Set::<Object>of)
                    // Stream<Set<Set<Object>>>
                    .collect(Collectors.toSet()))
            // summation of pairs of inner sets
            .reduce((set1, set2) -> set1.stream()
                    // combinations of inner sets
                    .flatMap(inner1 -> set2.stream()
                            // merge two inner sets into one
                            .map(inner2 -> Stream.of(inner1, inner2)
                                    .flatMap(Set::stream)
                                    .collect(Collectors.toCollection(
                                            LinkedHashSet::new))))
                    // set of combinations
                    .collect(Collectors.toCollection(LinkedHashSet::new)))
            // returns Set<Set<Object>>, otherwise an empty set
            .orElse(Collections.emptySet());
} 
```

```
public static void main(String[] args) {
    Set<Integer> set1 = Set.of(1, 2, 3);
    Set<String> set2 = Set.of("A", "B", "C");
    Set<Object> set3 = Set.of(new Time(0));

    Set<Set<Object>> sets = cartesianProduct(set1, set2, set3);
    // output
    sets.forEach(System.out::println);
} 
```

输出：

```
[1, A, 03:00:00]
[1, B, 03:00:00]
[1, C, 03:00:00]
[2, A, 03:00:00]
[2, B, 03:00:00]
[2, C, 03:00:00]
[3, A, 03:00:00]
[3, B, 03:00:00]
[3, C, 03:00:00] 
```

* * *

^(另请参阅：[如何创建类似于三个不同类型列表的笛卡尔积的数据结构？](https://stackoverflow.com/a/67165269/15675591))

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-07-29T10:15:58.017

一个简单的解决方案，例如对于整数集应该如下：

```
void printCombination(List<Set<Integer>> listSet, Set<Integer> combination) {
    if (listSet.isEmpty()) {
        System.out.println("a combination :" + combination);

        return;
    }

    Set<Integer> intSet = listSet.get(0);
    for (Integer it : intSet) {
        Set<Integer> combination1 = new HashSet<Integer>();
        combination1.addAll(combination);
        combination1.add(it);

        List<Set<Integer>> listSet1 = new ArrayList<Set<Integer>>();
        listSet1.addAll(listSet);
        listSet1.remove(0);
        this.printCombination(listSet1, combination1);
    }

} 
```

# c++ - 如何返回带有私有比较器的 std::set

> ID：714118
> 
> 赞同：0
> 
> 时间：2009-04-03T14:19:12.833
> 
> 标签：c++, stl

我想编写一个返回 std::set 自定义对象的（C++）方法。但是，我不想公开插入对象时使用的比较器，因此我将其设为私有类。我创建这样的集合：

```
std::set<some_class, some_class_comparator> return_object; 
```

现在我想返回集合，所以它必须像这样（返回时隐含）：

```
(const std::set<some_class>) return_object; 
```

这是编译器抱怨的地方。有没有办法将带有比较器的可变集转换为不可变的不可变集？

多谢，

霍尔格

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-03T14:31:19.373

> 有没有办法将带有比较器的可变集转换为不可变的不可变集？

没有为什么

```
std::set<some_class, some_class_comparator> 
```

和

```
std::set<some_class> 
```

是完全不同的、不相关的类型。模板就是这样，模板——一种在编译之前指定如何生成类型的方法。在第二种情况下，比较器是 std::set 附带的默认比较器。

是否有一个令人信服的理由 some_class_comparotor 需要是私有的？它会是它自己的独立实体吗？只是您不想污染班级的公共界面吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T14:23:56.210

我不这么认为。AFAIK`std::set<some_class>`只是简写，`std::set<some_class, std::less<some_class> >`因此无法根据需要转换集合。

我建议将这些项目转移到其他一些数据结构（例如向量）中，这样可以保持当前项目的顺序，而不需要比较器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T14:41:56.133

您最好的解决方案是这样的：

```
class MyClass
{
    class some_class_comparator;
public:
    typedef std::set<int, some_class_comparator> ReturnSet;
    ReturnSet myMethod();
    // ...
private:
    class some_class_comparator
    {
    public:
        bool operator< (MyClass& m) {return true;}
    };
};

//later...
MyClass::ReturnSet s = my_class_instance.myMethod(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-03T14:32:06.470

这是两种不同的类型 std::< Type, Comparator > 和 std::set< Type, DefaultComparator >。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-03T14:37:52.307

你想对调用者隐藏一个实现细节，这听起来不像模板，听起来像虚函数。我想首先，你需要问自己，这真的重要吗？如果是这样，请将您的类隐藏在 IOpaqueSet 接口后面。当然，没有其他 STL 操作可以处理它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-03T14:48:56.367

STL 带有许多内置类，但它也是一个可扩展的框架。如果您定义了您的::own::immutable_set，并定义了迭代器，则其他 STL 算法可以使用它。`immutable_set<T>`将被定义为围绕可变变量的薄 const 包装器`std::set<T, comparator<T> >`（支持不同比较器所需的一些模板魔法，因为它们导致不同的类型）。`immutable_set<T>::iterator::operator++`会转发到`std::set<T>::iterator::operator++`等

# c# - Odbc Paradox Driver WHERE 子句日期

> ID：714123
> 
> 赞同：2
> 
> 时间：2009-04-03T14:19:48.450
> 
> 标签：c#, .net, odbc, paradox

我正在使用带有 Paradox 的 Odbc 驱动程序。我有一张桌子，里面有日期。我正在尝试按该列中的日期进行查询。我似乎无法让 where 子句起作用。我可以通过整数搜索记录，但我不知道如何使用日期时间。

```
OdbcCommand comm= new OdbcCommand("SELECT * FROM  [Journal]  WHERE" + 
                                  "[Date] = 04/02/2009 ",
                                  new OdbcConnection(@"Driver={Microsoft Paradox Driver (*.db )};DriverID=538;Fil=Paradox 5.X;DefaultDir=d:\\ics\\tables\\HISTORY;Dbq=d:\\ics\\tables\\HISTORY;CollatingSequence=ASCII"));

OdbcDataAdapter adapt = new OdbcDataAdapter(comm);
DataTable table = new DataTable();
adapt.Fill(table ); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-03T15:00:06.620

好的，我想通了。

```
...where   [Date] = {d 'yyyy-MM-dd'} AND... 
```

在 odbc 中，您必须使用 {} 来定义对象，而 d 定义日期的格式。

您可以使用以下内容。

{d'值'} yyyy-mm-dd

{t '值'} hh:mm:ss

{ts '值'} yyyy-mm-dd hh:mm:ss

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T14:33:15.873

在 Paradox 中查找将字符串转换为日期的日期/时间函数。像在 SQL 中一样使用字符串作为日期是非常棘手的。必须有一些函数，如 TO_DATE 或类似的函数，可以为您正确格式化它。

# javascript - 我是在 Firefox 中遇到内存泄漏，还是只是高内存使用率？

> ID：714125
> 
> 赞同：6
> 
> 时间：2009-04-03T14:20:18.247
> 
> 标签：javascript, memory-leaks

我正在将一些相当大的数据集加载到 Firefox（500 k 左右）并用它们绘制表格。Firefox 正在使用多达 400 兆的内存。我如何判断 Firefox 是否正在泄漏内存，或者只是因为它可以使用大量内存？

如果不需要它，是否有另一个浏览器会使用更少的内存？我感觉firefox为自己抓取了一堆内存，除非必须，否则不会释放它。很明显，我对内存管理的一般理解非常肤浅。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-03T14:22:53.373

您可以在 Firefox 中设置一个设置，强制它尽可能多地释放内存：

1.  在网站 url 工具栏上输入 about:config
2.  会出现一页充满文字的页面。右键单击任意位置并选择 New -> Boolean
3.  对于名称输入类型“config.trim_on_minimize”选择 True
4.  重新启动火狐。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T14:30:11.373

如果它正在泄漏内存，那么 Windows 任务管理器中的内存使用量（K 数）将继续增长。如果这个数字相当一致，那么 Firefox 表现正常。我认为 Firefox 需要太多内存才能正常运行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T14:48:22.640

> 我如何判断 Firefox 是否正在泄漏内存，或者只是因为它可以使用大量内存？

在不同的选项卡中打开另一个页面。然后关闭你的“大”标签，看看内存是否被释放。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-03T14:49:15.540

> **内存泄漏**- 应该释放的内存没有释放

如果 Firefox 为保存数据而分配的内存在您离开页面时被释放，则没有内存泄漏。您可以争论 Firefox 是否使用了太多内存，但这超出了您的范围。

如果没有释放该内存，您的手上确实有泄漏。在这种情况下，您应该检查它是否可以在您的 JS 代码中处理，或者是 firefox 错误。如果是后者，请前往 mozilla bugzilla，然后开一张票。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-03T14:42:24.260

您可以打开 Windows 性能监视器并查看 firefox.exe 进程是否随时间增加内存，以确认是否存在内存泄漏。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-03T14:49:06.803

> 我感觉firefox为自己抓取了一堆内存，除非必须，否则不会释放它。很明显，我对内存管理的一般理解非常肤浅。

好吧，在 1 点 Firefox 需要大量内存，比如 400Mb。也许在那之后，它不需要那么多内存，但是

由于您的系统不需要此内存，因此它不会将其回收给 Firefox，而是保留它。

如果您启动了需要大量内存的其他进程，那么您的操作系统将向其他以高优先级运行的进程索回内存。

总结一下我的想法：这可能不是内存泄漏。

> 如果不需要它，是否有另一个浏览器会使用更少的内存？

你为什么不试试呢？

# ruby-on-rails - Slice 256 是否足以容纳至少 4 个 Rails 站点的 Apache2 + 乘客？

> ID：714130
> 
> 赞同：2
> 
> 时间：2009-04-03T14:21:20.257
> 
> 标签：ruby-on-rails, passenger

我有一个带有 4 个**Rails 1.2.6站点的****Slice 256 ，在****Lighttpd + FastCGI**上运行得相当不错（Ubuntu Server 8.04 LTS 从 6.06 LTS 升级）；尽管它的配置如此陈旧，但对于我的小型网站来说，它已被证明足够可靠。

 ****现在我想将一些升级到 Rails 2.x，我想知道相同的 Slice 256 是否可以采用**Apache2 + Passenger**配置，因为它在我的本地开发 Linux 机器上运行良好。

所以我的问题是：**对于至少托管 4 个 Rails 站点的 Apache2 + 乘客来说，Slice 256 是否足够？**

对此的任何建议和经验将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-03T17:09:40.350

万一有人感到困惑，提问者可能是指 Slicehost.com 上的 256 MB [VPS](http://www.slicehost.com)

并回答您的问题：这取决于。

你能不能运行四个 Twitter，当然不能。您能否运行 4 个站点，它们之间将有 1 个（或更少）并发用户，然后是的，您可以。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-23T19:28:36.397

我会说不。我假设您所说的“4 个站点”是 4 个 rails 实例。2 可能更适合 256MB 切片，如果您需要运行 cron/rake tast 或类似的东西，即使这样也可能会推动它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T17:44:56.880

我不完全确定从 1.2 迁移到 2.3。我确实知道从 2.2 迁移到 2.3 具有一些节省内存的功能（更具体地说是路由）。

如果这些是生产站点，我建议设置一个新的 256 切片并尝试升级。无论如何，有一个开发部分是件好事。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-04T13:07:39.753

在我的经验中; 运行一个简单的 Typo 博客会经常在基本上没有流量的共享主机上消耗超过 64M 的内存。

带有 Memcached 的 100 多个资源的大型 2.3 Rails 应用程序，所有的花里胡哨等，有时会达到 420MB 的内存。

当然，答案确实是“视情况而定”。这取决于您的代码、您的流量、您的服务器、您的数据库架构、您的表索引等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-05T15:34:59.797

乘客建议你在 256 片上使用两个乘客儿童池。这意味着它可以同时处理两个并行请求。（如果我错了，请纠正我）正如尼克所说，这完全取决于您（客户）网站的点击量。

# c# - Linq To Sql - 当另一个值更改时更新一个值

> ID：714131
> 
> 赞同：2
> 
> 时间：2009-04-03T14:21:31.270
> 
> 标签：c#, .net, asp.net, linq, linq-to-sql

使用 Linq To Sql - 当另一个表中的值发生变化时，更新数据库中一个表的值的最佳方法是什么？

例如，在 TableA 中有一个名为 DateModified 的列。TableA 与 TableB 有关联。现在，我想将 DateModified 字段的值设置为每次 tableA 中的记录更改以及每次在 TableB 中创建/更新/删除子记录时的当前日期。

如何做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-03T14:26:00.010

如果更改仅在一条记录中，您可以使用`On*Changed`部分方法，或者您可以覆盖`SubmitChanges`数据上下文，调用`GetChangeSet`并在更新之前应用更改。后一种（数据上下文）方法对于捕获广泛的变化很有用，因为该`On*Changed`方法对于特定于单个属性的逻辑很有用。

但是，在提出的情况下（非同质更新），我希望数据库触发器可能更合适。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-03T14:28:41.500

您可以在 OnCreated 中的子实体上注册 PropertyChanged 事件处理程序（在部分类中实现）并让该处理程序更新父属性。如果您不关心已经加载的类会获得更改，那么使用@Marc 建议的数据库触发器也是一种选择。

**编辑**：如果您还需要捕获删除，您可以实现数据上下文的删除部分方法以调用相同的处理程序方法来更新被删除实体的父级。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T14:28:11.097

通过允许您在 TableA 上执行更新的 StoredProcedure 在 TableB 上执行插入/更新/删除，或者在 TableB 上具有更新 TableA 的插入/更新/删除触发器

我不会尝试在 LINQ 中完成此操作，因为它将涉及覆盖各种 IDE 生成的代码结构（维护噩梦）或对数据库的额外调用以获取相关的 TableA 项目。

# c# - 从 XML 生成不同的 JSON

> ID：714136
> 
> 赞同：2
> 
> 时间：2009-04-03T14:22:31.827
> 
> 标签：c#, javascript, json

我正在尝试从 XML 文件生成一些 JSON，但不是直接的转换。我希望挑选位并具有稍微不同的结构。

我宁愿不只是将一个巨大的字符串连接在一起，而是想知道周围是否有一些像样的库可以做到这一点。

此外，为了测试，我希望能够验证创建的 json，只需简单检查它是否是有效的 JSON

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-03T15:53:36.180

[您可以使用XSLT](http://www.w3schools.com/xsl/)轻松地将 XML 转换为其他文本表示，尤其是使用[xsltproc或](http://xmlsoft.org/XSLT/xsltproc2.html)[xalan](http://xalan.apache.org/)的命令行版本的文件到文件。

XSLT 有时是一种笨拙的编程语言，但如果你走这条路，我有两个关于 JSON 转换的建议。使用 UTF-8 字符集将输出设置为文本：

```
<xsl:output method="text" encoding="UTF-8" /> 
```

并在结果上运行[JSLint](http://www.jslint.com/)，以捕获 XSLT 文件中的任何错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T16:06:58.333

我可能会使用 Linq to XML（XElement 和朋友）来生成新对象，然后将该对象传递给 Json 序列化程序。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T14:30:38.923

将 XML 加载到一组类中（使用 XMLSerializer），然后在这些类上实现 JSON 生成器方法。不同的方法，不同的JSON。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T20:34:52.000

Other answers look good: I think I would also bind source format into objects, then serialize as the other formats. And any transformations would be done to objects, and not using data format representation. When using proper parser (for input) and generators/serializers (for output), you do not have to worry about well-formedness (resulting xml or json being syntactically correct). And for biz-logic validity you could (and should) do it using objects.

# c++ - 在 Carbon 中创建 JPEG 时的 JPEG 质量

> ID：714142
> 
> 赞同：1
> 
> 时间：2009-04-03T14:23:39.907
> 
> 标签：c++, macos, core-graphics, jpeg, quartz-graphics

我正在编写一个 Carbon 应用程序，我们正在创建 JPEG 文件。我目前正在使用 Quartz CGImageDestinations 和 kCGImagePropertyJFIFDictionary 来执行此操作。但是，JFIF 似乎没有任何关于压缩质量的条目。有谁知道如何设置这个？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T14:44:09.983

这与 JFIF 选项不同，因为其他一些格式（包括 TIFF）支持有损压缩。您使用的键是[`kCGImageDestinationLossyCompressionQuality`](http://developer.apple.com/documentation/GraphicsImaging/Reference/CGImageDestination/Reference/reference.html#//apple_ref/doc/c_ref/kCGImageDestinationLossyCompressionQuality)，并且您将此选项和 ​​JFIF-options 字典放入同一个字典中；你不要把它放进 JFIF-options 字典。

# apache-flex - 如何使两个 Flex AdvancedDataGrid 中的列宽可绑定？

> ID：714150
> 
> 赞同：0
> 
> 时间：2009-04-03T14:25:04.083
> 
> 标签：apache-flex, actionscript-3, mxml, advanceddatagrid

在这里忍受我。我有一个奇怪的设置来完成我需要的东西。我基本上有一个 AdvancedDataGrid，它显示 WebService 返回的数据。数据为 XML 格式：

```
<children label="parent 1" value="3100">
    <children label="child 1" value="1100">
        <children label="grandchild 1" value="200">
        </children>
        <children label="grandchild 2" value="300">
        </children>
        <children label="grandchild 3" value="600">
        </children>
    </children>
    <children label="child 2" value="2000">
        <children label="grandchild 4" value="1200">
        </children>
        <children label="grandchild 5" value="800">
        </children>
    </children>
</children>
<children label="parent 2" value="1000">
    <children label="child 3" value="1000">
        <children label="grandchild 6" value="300">
        </children>
        <children label="grandchild 7" value="700">
        </children>
    </children>
</children> 
```

我在 WebService 结果处理程序中将 XML 转换为 HierarchicalData 对象。我还为 AdvancedDataGrid 动态构建列，因为它用于根据用户输入显示不同的列。但是，我还需要在 AdvancedDataGrid 的底部显示总计“行”。我无法弄清楚如何将我的 XMLListCollection 转换为 GroupingCollection，从而以这种方式创建总计行，因此，我实际上计算了 WebService 中的总计并将其作为 XML 中的节点返回：

```
<totals value="4100" /> 
```

我使用这个“总计”数据填充第二个 AdvancedDataGrid，它没有位于第一个 ADG 正下方的标题，因此它“看起来”是第一个 ADG 的“最后一行”。两个 ADG 都使用相同的可绑定列数组：

```
<mx:AdvancedDataGrid id="reportADG" dataProvider="{__model.reportData}"
    columns="{__model.adgDrillColumns}" width="100%" height="100%" />

<mx:AdvancedDataGrid id="reportTotalsADG" 
    dataProvider="{__model.reportTotalsData}" 
    folderOpenIcon="{null}" folderClosedIcon="{null}" 
    disclosureClosedIcon="{null}" disclosureOpenIcon="{null}" 
    defaultLeafIcon="{null}" showHeaders="false" 
    selectable="false" rowCount="1" 
    columns="{__model.adgColumns}" width="100%" /> 
```

但是，如果在第一个 ADG 中调整列的大小，我无法找到让第二个 ADG 中的列也调整大小的方法。我能做些什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-09-17T23:52:30.230

您可以使用汇总行方法，也可以创建自定义组件以单独显示总计。就我而言，我必须创建一个自定义组件来获取所有 ADG 列，确定它们的宽度，绘制垂直线/分隔符，然后对所有行求和并显示一个标签。这很好，因为它是这样使用的：

```
<components:DataGridSummaryFooter id="summaryView"
     height="6%" width="100%"
     totalsColumns="{[impressionsCol, estimatedSpendingCol]}"
     dataSource="{dataViewSource}" 
/> 
```

......剩下的就是魔法！

仅供参考，我必须创建一个单独的组件而不使用摘要行的原因是由于此应用程序的设计要求。事实上，我希望一直这样做，因为对于摘要行，您必须一直滚动到网格底部才能看到摘要，这不是很好的 UX。

我希望这可以帮助某人在某些时候有所帮助！:)

干杯

# c# - 从桌面客户端将对象作为参数传递给 ASP .Net MVC 中的 ActionResult 方法

> ID：714155
> 
> 赞同：1
> 
> 时间：2009-04-03T14:26:17.403
> 
> 标签：c#, asp.net, asp.net-mvc

给定以下代码：

```
using (var client = new WebClient())
  {
    string url = string.Concat(someUrl, "SomeControllerName/", currentId, "/WriteLogFile");
    var toWrite = DateTime.Now

    /* Code to post object to URL goes here e.g. client.UploadValues(url, someNameValueCollectionObject)*/
  } 
```

和控制器方法签名：

```
public ActionResult WriteLogFile(DateTime date, int id) 
```

如何使代码的第一部分将 DateTime 对象传递给此 ActionResult 方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-05T01:32:33.253

您可以使用格式字符串作为日期

```
string url = string.Format("someUrl/SomeControllerName/WriteLogFile/{0}/{1}", currentId, DateTime.Now.ToString("MM-dd-yyyy")); 
```

并在路由表中添加一个条目以将其路由到适当的控制器和操作

```
routes.MapRoute("SomeRoutename",
                "SomeControllerName/WriteLogFile/{id}/{date}",
                new {   controller = "SomeControllerName", action = "WriteLogFile", 
                        date= DateTime.Now}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T14:41:40.317

添加查询字符串参数：

```
var toWrite = DateTime.Now;
string url = string.Concat(someUrl, "SomeControllerName/", currentId, "/WriteLogFile");
url = string.Concat(url, "?date=", toWrite.ToString("s")); 
```

# ruby-on-rails - 想要在 ruby 中显示文本字段的前 50 或 60 个单词？

> ID：714158
> 
> 赞同：4
> 
> 时间：2009-04-03T14:27:48.307
> 
> 标签：ruby-on-rails, ruby

我有一个故事文本字段，想在快照页面中显示前几行——比如该字段的前 50 个单词。如何在 Ruby（在 Rails 上）中做到这一点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-03T14:36:42.543

假设您的单词由空格分隔，您可以执行以下操作。

```
stories.split(' ').slice(0,50).join(' ') 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-03T15:11:13.210

[与Aaron Hinni 的答案](https://stackoverflow.com/questions/714158/want-to-show-the-first-50-or-60-words-of-a-text-field-in-ruby/714192#714192)大致相同，但会尽量保留 3 个完整的句子（如果句子太长，则截断为 50 个单词）

```
def truncate(text, max_sentences = 3, max_words = 50)
  # Take first 3 setences (blah. blah. blah)
  three_sentences = text.split('. ').slice(0, max_sentences).join('. ')
  # Take first 50 words of the above
  shortened = three_sentences.split(' ').slice(0, max_words).join(' ')
  return shortened # bah, explicit return is evil
end 
```

此外，如果此文本有任何 HTML，我对[“截断 Markdown？”的回答。](https://stackoverflow.com/questions/395783/truncate-markdown/395814#395814)可能有用

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-28T05:22:26.740

在 Rails 应用程序中使用非常相似的东西来扩展（“猴子补丁”）基本 String 类。

我创建了`lib/core_extensions.rb`其中包含：

```
class String
  def to_blurb(word_count = 30)
    self.split(" ").slice(0, word_count).join(" ")
  end
end 
```

然后我创建了`config/initializers/load_extensions.rb`其中包含：

```
require 'core_extensions' 
```

现在，我`to_blurb()`在 Rails 应用程序中的所有 String 对象上都有了该方法。

# vba - 如何对 Excel 中的多行条目进行排序？

> ID：714162
> 
> 赞同：0
> 
> 时间：2009-04-03T14:28:49.660
> 
> 标签：vba, excel

所以我有一个文档，其中包含许多遵循这种通用格式的条目。

机构名称 职务 地址 电话 传真

描述行 1

描述行 2

组织的网站。

机构名称 职务 地址 电话 传真

描述行 1

描述行 2

组织的网站。

机构名称 职务 地址 电话 传真

描述行 1

描述行 2

组织的网站。

我想要做的是按组织对它们进行排序并将第一行视为一个条目，因此 excel 基本上认为：

机构名称 职务 地址 电话 传真

描述行 1

描述行 2

组织的网站。

是一排。我还应该补充一点，底部的 3 行在构成它们上方的行的单元格中合并。本质上，我需要它作为数据库工作，但对于技术上不熟练的政府工作人员来说，他们无法升级到 Office 2007，因为整个功能区的东西“太混乱了”。所以我坚持使用 Excel 2002。我需要能够对它们进行排序并使用实际图表上方的前几行来包含标题和子标题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-03T14:59:16.483

您是否需要描述/网站行保持合并？如果不取消合并以使其更容易。您已将其标记为 VBA，但如果这是一次性修复，那么手动处理工作表是否可以？

作为起点，我建议为每组行添加一个标识符，根据您的数据质量，您可以通过检查网站单元格或简单地计算行数来做到这一点。例如，您可以在数据之前插入一个新列，并将以下内容放在单元格 A2 中：

```
=IF(Left(Lower(B1),4)="http",B2,A1) 
```

其中 B1（上一行）可以是组织、描述 1、描述 2、组织的网站，如果它是一个网站，我们假设在这个新行上我们从一个新的数据块开始，所以我们将采用机构名称。如果它不是网站，我们将使用之前使用的组织名称（A1 需要 =B1）。然后将该公式复制到最后，这 4 行至少现在将有一个公共键，然后您可以使用它来混合数据。

如果有只是以 www 开头的 URL。然后修改公式或更好，只需搜索/替换“www”。成为“ [http://www](http://www)。” 从而提高您的数据质量。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-06T17:55:26.660

您不能尝试使用 UI 录制一个宏来执行您想要的任何排序操作，然后分析代码，并了解您需要做什么吗？

# unit-testing - 如何处理反对单元测试的同事

> ID：714166
> 
> 赞同：3
> 
> 时间：2009-04-03T14:30:15.990
> 
> 标签：unit-testing

在我们的 Scrum 团队中，有几个成员在没有进行单元测试的情况下将内容直接放到页面上，然后在代码的其他地方进行的更改破坏了他们的内容时会抱怨。副歌总是“它曾经有效，你做了什么？”

我们很早就开始转向敏捷，而 CI 是议程上的下一件事。在那之前，我该如何处理人的问题？毕竟，这是最难处理的部分。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T14:37:17.270

你是团队，所以在你开始工作之前你必须同意。如果没有达成协议，责备游戏将永远持续下去（这几乎是真的）。

请参阅我对单元测试价值问题的回答：单元测试 [的价值](https://stackoverflow.com/questions/708047/the-value-of-unit-testing)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-03T14:40:31.940

我认为处理这类事情的最好方法是通过问责制。如果他们的东西坏了，他们就会承受压力并必须找到解决办法，即使根本原因在其他地方，他们的部分问题是他们在发布之前没有抓住它。

请注意，这可能实际上并不能说服他们改变习惯……

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-03T14:43:06.710

跟他们讲话。问他们为什么不做单元测试。如果只是懒惰，请解释从长远来看它是如何节省时间的（通过你提到的具体例子），是的，它需要一些努力才能养成，但很快就会成为一种有好处的习惯。

如果这没有帮助，请给他们一个单独的单元测试和实施时间，并告诉他们现在*他们的工作*是花 5 个小时为这个用例编写单元测试，从而产生不错的覆盖率，并且你会很乐意帮助他们开始。

如果这仍然没有帮助，解雇他们并让一个不会完全无视命令的人正确地完成他的工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-03T14:50:38.250

在这里扮演魔鬼的拥护者，但为什么其他地方的变化会破坏他们的代码？单元测试真的会阻止这种破坏吗？人们是否在破坏或更改代码单元之间的接口？

我的意思是，是的，单元测试和按合同设计是很棒的东西，但是代码必须遵守合同。让这些程序员编写单元测试将有助于确定您何时遇到问题，但这是否让您更接近于防止这些问题？听起来可能有一个更大的设计问题需要解决。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-03T15:09:19.047

谁在没有编写单元测试的情况下破坏了构建，就需要为整个团队购买一份幸运。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-03T14:45:38.230

我会先看看你的团队政策。为什么他们一开始就可以在没有单元测试的情况下提交代码？如果您想要一致的单元测试，那么您需要设置策略。您可以解释单元测试是捕获回归问题的重要方法。如果他们继续抱怨，请指出政策并告诉他们单元测试不是可选的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-03T14:48:36.320

使用具有良好责备机制的持续集成系统。像 Hudson 这样可以持续检查 Subversion 或其他源代码控制系统的东西。设置您的 CI 构建系统，以便在系统测试失败时立即发送电子邮件，广播名称和引入错误的更改。

换句话说，确保每个人都知道是谁在引入 bug，并在引入 bug 后立即识别它们。随着时间的推移，这些脾气暴躁的开发人员会意识到他们是引入缺陷的人。

# jquery - 当以 Ajax 方式创建控件时，ASP.net MVC 中的 jQuery 自动完成功能不起作用

> ID：714169
> 
> 赞同：0
> 
> 时间：2009-04-03T14:30:32.247
> 
> 标签：jquery, ajax, asp.net-mvc, autocomplete

我正在运行一个问题，你能用你的知识帮助我吗..？

基本上，jQuery 的这个自动完成扩展依赖于 jQueryLibrary 的 ready 方法。（我不是 100% 确定它实际上做了什么，但我猜它会检查 DOM 是否已加载，如果加载它会作为常规的“onload”事件处理程序执行某些操作）。

现在，我有一个 ASP.net MVC 应用程序，我在其中使用 Ajax 呈现部分视图（一个 ascx 文件），并且该文件包含自动完成文本框。

由于 DOM 已经加载，并且我现在以 Ajax 方式使用 ascx 文件的内容修改了 DOM，因此我在 ascx 中的文本框没有执行任何自动完成功能。什么可能是这个问题的替代或解决方法..？即使我有点好奇为什么它不起作用..？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T14:33:34.313

您需要再次加载自动完成功能，就像您所说的 dom 中的新项目已经在 jquery 加载之后出现。您可以将 jquery 函数放在 ascx 中（简单方式）或强制 jquery 再次在 DOM 上运行，这可能会导致意外结果。

# c# - 使用 C# 在服务器之间移动 zip 文件

> ID：714171
> 
> 赞同：1
> 
> 时间：2009-04-03T14:30:50.077
> 
> 标签：c#

我想将 zip 文件从一台服务器移动到另一台服务器。使用 C# 的最佳方法是什么？

如果我在本地机器上运行我的 C# 应用程序。我想访问两台服务器服务器 A 和服务器 B 使用 File.COpy() 将文件从 A 传输到 B 然后它给了我凭证问题。

我不知道我是否有两台服务器的 UNC 共享。我想使用 webrequest 将 zip 文件从我的机器从服务器 A 传输到服务器 B。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-03T14:32:49.277

如果目标服务器上有 UNC 共享，则可以使用

```
System.IO.File.Copy(String sourceFileLocation, 
                     String destinationFileLocation) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-03T14:38:00.573

否则，您必须简单地通过 FTP 访问它。

[http://www.devasp.net/net/articles/display/280.html](http://www.devasp.net/net/articles/display/280.html)

# java - 将 Excel 模板与 Apache POI 结合使用

> ID：714172
> 
> 赞同：20
> 
> 时间：2009-04-03T14:31:00.327
> 
> 标签：java, excel, apache-poi

基本问题：如何加载用于 POI 的 Excel 模板，然后将其保存到 XLS 文件中？

*编辑：*

答案是：

```
FileInputStream inputStream = new FileInputStream(new File(templateFile));
Workbook workbook = new HSSFWorkbook(inputStream); 
```

（只需将模板加载为工作簿，然后将工作簿作为 XLS 文件写入其他地方。）

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-03T14:43:25.820

您是否尝试过使用 POI 将其作为标准 .xls 加载、修改然后保存？

这是我用于在 POI 生成的 .xls 中插入宏的方法。我使用宏创建文件（诚然为 .xls），然后将其加载到我的应用程序中，填充数据并另存为新创建的 .xls。这一切都很好。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-04-03T15:01:21.097

您可以直接加载将充当模板的 .xls 并对其进行修改。

```
POIFSFileSystem fs = new POIFSFileSystem(
                new FileInputStream("template.xls"));
HSSFWorkbook wb = new  HSSFWorkbook(fs, true); 
```

将加载一个 xls，保留其结构（包括宏）。然后你可以修改它，

```
HSSFSheet sheet1 = wb.getSheet("Data");
... 
```

然后保存它。

```
FileOutputStream fileOut = new FileOutputStream("new.xls"); 
wb.write(fileOut);
fileOut.close(); 
```

希望这可以帮助。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-01-16T01:38:17.290

您还可以将内部模板用作资源。

```
InputStream fis = ChartSample.class.getResourceAsStream("/templates.xls");
HSSFWorkbook wb = new HSSFWorkbook(fis);        
fis.close();
HSSFSheet sh = wb.getSheetAt(0); 
//Here you go 
```

并保存：

```
out = new FileOutputStream("./new.xls");
wb.write(out);
out.close(); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-11-04T22:21:21.670

您可以从 XLS 模板创建 XLS 文件。

但是，为此，您需要在每次需要使用模板时创建模板的副本。如果没有，您将编辑原始模板（您不想要的）。

因此，您需要首先获取您的模板文件：

```
URL url = Thread.currentThread().getContextClassLoader().getResource("templates/template.xls");
File file = new File(url.getPath()); 
```

复制模板文件：

```
try (FileOutputStream fileOutputStream = new FileOutputStream("/home/jake/fileCopiedFromTemplate.xls")) {

    Files.copy(file.toPath(), fileOutputStream);

    Workbook workbook = new HSSFWorkbook();
    workbook.write(fileOutputStream);
} 
```

访问新复制的文件：

```
FileInputStream inp = new FileInputStream("/home/jake/fileCopiedFromTemplate.xls"); 
```

创建一个`Workbook`，以便您可以在新文件中写入：

```
Workbook workbook = WorkbookFactory.create(inp); 
```

在你的工作簿上写下：

```
try (FileOutputStream fileOut = new FileOutputStream("/home/jake/fileCopiedFromTemplate.xls")) {
    workbook.write(fileOut);
} 
```

创建 XLS 模板文件的提示是用一些变量标记模板，以便本地化要填充的位置。像：

```
------------------------------------
|   | Columna A     | Column B     |
------------------------------------
| 1 |  Some description            | 
------------------------------------
| 2 | {person.name} | {person.age} |
------------------------------------ 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-12-14T13:46:46.507

对于`.xlsx`使用以下内容的 excel 文件：

```
FileInputStream inputStream = new FileInputStream(new File("template.xlsx"));
        @SuppressWarnings("resource")
        Workbook wb = new XSSFWorkbook(inputStream);  
        Sheet sheet = wb.getSheet("sheet1"); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-01-09T13:54:05.510

如果要将其保存为 2007+ 格式，则可以通过在 maven pom.xml 中添加 poi-ooxml 依赖项来使用 XSSF。

如果您在此 xmls 中有带有摘要表的 template.xlsx 文件，并且您想要更改特定单元格，您可以这样做：

```
XSSFWorkbook wb = new XSSFWorkbook(new FileInputStream("template.xlsx"));           
FileOutputStream fileOut = new FileOutputStream("new.xlsx");
XSSFSheet sheet1 = wb.getSheet("Summary");
XSSFRow row = sheet1.getRow(15);
XSSFCell cell = row.getCell(3);
cell.setCellValue("Bharthan");

wb.write(fileOut);
log.info("Written xls file");
fileOut.close(); 
```

# linq - 简单（哑）LINQ 提供程序

> ID：714180
> 
> 赞同：5
> 
> 时间：2009-04-03T14:32:29.683
> 
> 标签：linq, provider

编写一个可以只使用我的类定义（没有任何对象引用作为属性）并给我翻译后的 SQL 的愚蠢 LINQ 提供程序是多么容易。它可以假设属性和列的名称以及类和基础表的名称相同。你能给我一些指点吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-03T14:44:44.130

我花了大约 4 个月的全职工作（每天 8 小时）来构建一个稳定的、可工作的提供程序来实现 linq 的整个规范。我会说大约三周后我有一个非常简单、错误和不稳定的版本，所以如果你只是在寻找一些粗糙的东西，我会说你可能会看一周到两个月的任何东西，这取决于你有多好是什么类型的requiements 你有。

为此，我必须将您指向 Wayward 博客，Matt 写了一篇关于如何实现 linq 提供程序的非常好的演练，即使您可能无法复制和粘贴，它也会帮助您到达掌握工作时的思维方式。你可以在这里找到马特的演练：http: [//blogs.msdn.com/mattwar/archive/2007/07/30/linq-building-an-iqueryable-provider-part-i.aspx](http://blogs.msdn.com/mattwar/archive/2007/07/30/linq-building-an-iqueryable-provider-part-i.aspx)。我建议您按照 Matt 的方式进行操作，并扩展 Matt 在其教程的第二部分中包含的表达式树访问者。

此外，当我开始使用它时，我从表达式树可视化器中获得了很多帮助，一旦您看到 linq 如何解析查询，它确实使解析变得容易得多。

建立一个提供者真的很有趣，即使有时有点令人沮丧。祝你一切顺利！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-03T14:43:23.463

看看[LINQExtender](http://www.codeplex.com/LinqExtender)项目，它是一个用于创建自定义 LINQ 提供程序的工具包。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-04-14T21:25:17.347

另一个帮助你的选择似乎是[re-linq](https://www.re-motion.org/blogs/mix/archive/2009/09/02/how-to-write-a-linq-provider-the-simple-way.aspx "重新链接")，它是一个用于创建自定义 LINQ 提供程序的框架。

这是[源代码](https://svn.re-motion.org/svn/Remotion/trunk/Relinq/Core/ "源代码")和编写代码所涉及内容的一个很好的[概述 (pdf)](https://www.re-motion.org/download/re-linq.pdf)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-07-02T00:18:38.230

我根据从头开始开发 LINQ-to-SQL 提供程序的经验，在我的博客上编写了一个教程系列，从表达式树组合阶段（调用 LINQ 方法）开始，继续表达式访问者，分解查询到组件中，解析 where 子句，生成文本和参数，最后，使用 .NET 表达式命名空间将整个内容编译到 IL 中。

我见过许多承诺解释如何编写提供程序的不完整的帖子，但没有达到标准，几乎没有触及表面，实际上并没有提供任何远程可执行的东西。

我根据自己的经验编写的博客系列有一个示例项目可供下载，该简单提供程序仅涵盖教程示例所需的功能。但是，它还包括支持许多操作（where、join、first、count、top 等）、子查询、嵌套语句等的生产版本。此外，它产生的 SQL 比我的很多已经从实体和 LINQ-to-SQL 中看到。没有不必要的/冗余的嵌套，将所有内容都包含在括号中等等。

对于任何具有良好抽象思维水平的人来说，开发这样的提供程序并不是许多人认为的那么困难的任务。我在大约 3 个月的兼职工作（意味着一些晚上和周末）中开发了一个用于生产环境的产品。从一开始，它就以性能和整洁的 SQL 为目标——这是它实现的目标。

很难找到时间发布这些材料，但我想——如果它可以帮助到那里的人，那么没有理由浪费这种经验：

*   [如何在 C# 第 1 部分中编写 LINQ to SQL 提供程序 - 简介](http://www.devbible.com/post/15/How_to_write_a_LINQ_to_SQL_provider_in_C_sharp_and_NET_40_part_1_of_4/)
*   [如何在 C# 第 2 部分 - 表达式访问者中编写 LINQ to SQL 提供程序](http://www.devbible.com/post/16/How_to_write_a_LINQ_to_SQL_provider_in_C_sharp_and_NET_40_part_2_of_4-expression_visitor/)
*   [如何在 C# 第 3 部分中编写 LINQ to SQL 提供程序 - Where 子句访问者](http://www.devbible.com/post/17/How_to_write_a_LINQ_to_SQL_provider_in_C_sharp_and_NET_40_part_3_of_4-where_clause_visitor/)
*   [如何在 C# 第 4 部分中编写 LINQ to SQL 提供程序 - 编译表达式树](http://www.devbible.com/post/18/How_to_write_a_LINQ_to_SQL_provider_in_C_sharp_and_NET_40_part_4_of_4-compiling_expression_trees/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-08-07T11:10:53.517

我创建了一个项目“ [LinqToAnything](https://github.com/mcintyre321/LinqToAnything) ”，旨在使实现（简单）Linq 提供程序变得非常容易。

# asp.net - 获取自动控制的大小？

> ID：714185
> 
> 赞同：1
> 
> 时间：2009-04-03T14:33:50.537
> 
> 标签：asp.net, javascript, vb.net

我有一种情况，我在同一个 asp.net 页面上有几个列表框控件。它们目前已自动调整大小以防止数据被截断。但是，我希望能够确定最大列表框的宽度，然后将其他列表框的大小更改为相同。

问题是...如何访问列表框的大小？或者我可以吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-03T14:38:09.967

是的你可以...

```
//This is a <div> that wraps around your listboxes
var wrapperDiv = document.getElementById('listboxWrapper');

//Get all <select> elements within the <div>
var sels = wrapperDiv.getElementsByTagName('SELECT');

//An array to store the width values
var widths = new Array();

//Load the array
for(var i = 0, l = sels.length; i < l; i++)
  widths[i] = sels[i].offsetWidth;

//Get the max width
var maxW = Math.max(widths);

//Set the max width to all the list boxes
for(var sel in sels)
  sels[sel].style.width = maxW; 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-04-03T14:43:15.070

为了获得最佳结果，请考虑使用 javascript 框架，使用 jquery：

```
var width = 0;
//get the largest width
$("select").each(function() {
    if ($(this).width() > width) {
        width = $(this).width();
     }
});
//make them all the same width
$("select").css("width", width); 
```

# c# - 当我在派生类中时，如何“取消绑定”附加到基类中的事件的事件处理程序？

> ID：714189
> 
> 赞同：5
> 
> 时间：2009-04-03T14:35:23.717
> 
> 标签：c#, event-handling

我曾经遇到过一种情况，我必须在我的某个派生类中重写事件处理程序。不幸的是，我不能仅仅“覆盖”它，因为实现逻辑严格绑定到基类中的特定方法实现。

我的自然想法是首先从事件中“解除绑定”原始事件处理程序，然后绑定我自己的全新方法。所以我尝试使用“-=”运算符，例如：

```
myObject.SomeEvent -= new EventHandler (BaseClass.SomeEventHandler) 
```

此时编译器抱怨它无法访问私有方法 SomeEventHandler。由于基类是库的一部分，我真的不想修改它的实现（尽管看起来只是将“私有”变成“受保护”）；

将事件处理程序附加到事件非常简单。为什么摆脱一个人这么难？

为什么我想要它？因为基本实现解决了一些问题（只是没有处理我们的特殊情况）所以我想重新定义它。但即使在我附加了我的事件处理程序之后，基本实现仍然会被执行。由于它正在执行某种重定向，因此我自己的实现永远不会运行，因为重定向后请求处理在服务器上被破坏。

有没有办法在不修改其实现的情况下从库中删除基类中的事件处理程序？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-03T14:39:04.957

如果您的代码可以正式看到处理程序*，那么**摆脱*处理程序同样容易。如果绝对必要，可以使用反射取消订阅以获取委托，但这很麻烦。a: 避免要求，或 b: 更改代码以制作 handler会*更*干净、更安全。**`protected`**

 *** * *

反思方法（使用风险自负）；取消注释中的块`Bar.ctor()`以查看更改。

```
using System;
class Foo
{
    public event EventHandler SomeEvent;
    public Foo()
    {
        SomeEvent += SecretHandler; // a bad idea, anyway
                                    //(self-subscribed events....)
    }
    protected virtual void OnSomeEvent()
    {
        EventHandler handler = SomeEvent;
        if (handler != null) handler(this, EventArgs.Empty);
    }
    private void SecretHandler(object sender, EventArgs args)
    {
        Console.WriteLine("suscribed");
    }
}
class Bar : Foo
{
    public Bar()
    {
        /*
        MethodInfo method = typeof(Foo).GetMethod("SecretHandler",
            BindingFlags.NonPublic | BindingFlags.Instance);
        EventHandler handler = (EventHandler)Delegate.CreateDelegate(
            typeof(EventHandler), this, method);
        SomeEvent -= handler;
         */
    }
    public void Test()
    {
        OnSomeEvent();
    }
}
static class Program
{
    static void Main()
    {
        Bar bar = new Bar();
        bar.Test();
    }
} 
```

# database - 引荐数据库架构

> ID：714190
> 
> 赞同：1
> 
> 时间：2009-04-03T14:35:45.993
> 
> 标签：database, schema, billing, referrals, flexibility

我正在使用现在典型的“推荐”系统编写一个新的 {monthly|yearly} 付费网站：当新用户注册时，他们可以指定其他用户的 {username|referral code}（如果他们可以自动检测到来自一个特殊的 URL），这将导致推荐人赚取新用户支付的任何费用的一定百分比。

在重新发明轮子之前，我想知道你们中是否有人有将此类数据存储在关系数据库中的经验。目前我正在使用 MySQL，但我相信任何好的解决方案都应该很容易适应任何 RDBMS，对吧？

我希望支持以下功能：

*   **在线计费系统**- 一旦支付了每张发票，就会计算推荐人的收入，他们将能够兑现。这当然包括在线浏览发票/付款的可能性。

*   **付费选项各不相同**- 它们的性质和成本不同（有时会有所不同），因此应根据每张最终发票计算佣金。

*   **跟踪推荐**（用户之间的关系、被推荐的日期以及任何其他有用的信息 - 有什么想法吗？）

*   **访问历史推荐数据**（已支付多少）或应计佣金的简单方法。

*   将来，我可能会提议用**累积的现金来换取订阅续订**（包括全部或部分新订阅，如果需要，必须支付差额）

*   **多个级别**- 我正在考虑支付大约 10% 的直接推荐收入 + 2% 的下一个级别，但这可能会在未来发生变化（添加更多级别，更改百分比），所以我应该能够存储历史数据。

请注意，我不打算在任何其他项目中使用它，所以我不担心它是“即插即用”的。

你做过类似要求的工作吗？如果是这样，你是如何处理所有这些事情的？你会推荐任何特定的数据库模式吗？为什么？

我有什么遗漏可以帮助实现更灵活的实现吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T14:51:52.583

相当了不起的是，有一个[数据库模式](http://www.databaseanswers.org/data_models/)库。虽然我看不到特定于推荐的东西，但可能有一些相关的东西。至少（希望）你应该能够得到一些想法。

# c# - Excel DateTime 作为 DBNull 返回

> ID：714199
> 
> 赞同：1
> 
> 时间：2009-04-03T14:38:08.360
> 
> 标签：c#, excel, oledb

我有一些使用 OLEDB ( `Provider=Microsoft.Jet.OLEDB.4.0;Data Source={0};Extended Properties=Excel 8.0;`) 的 Excel 文件读取代码，它运行良好，但我一直遇到一个问题，即某些日期返回为 DBNull。

在原始 XLS 文档中，有效的日期格式（en-GB 语言环境）为：

```
"02/04/2009  17:00:00" // returned as a System.DateTime 
```

以下样式失败：

```
"08/Jan/09 11:24 AM" // returned as DBNull 
```

Excel 知道它们都是日期（尽管我不能强制它们正确设置样式），因为以下正确显示了日期：

```
=DATE(YEAR(c),MONTH(c),DAY(c))  // where c = cell reference. 
```

有没有办法在**不改变自动生成的原始文件**的情况下获取数据？

* * *

**编辑**以供参考，这是我的读取数据方法（假设已经设置了 dbAdapter - 请注意 DBNull 不是来自根本没有触发的捕获）：

```
 public List<List<string>> GetData(string tableName, int maxColumns)
    {
        List<List<string>> rows = new List<List<string>>();

        DataSet ExcelDataSet = new DataSet();
        dbCommand.CommandText = @"SELECT * FROM [" + tableName + "]";
        dbAdapter.Fill(ExcelDataSet);

        DataTable table = ExcelDataSet.Tables[0];

        foreach (DataRow row in table.Rows)
        {
            List<string> data = new List<string>();

            for (int column = 0; column < maxColumns; column++)
            {
                try
                {
                    data.Add(row[column].ToString());
                }
                catch (Exception)
                {
                    data.Add(null);
                }
            }

            //  Stop processing at first blank row
            if ( string.IsNullOrEmpty(data[0]) ) break;
            rows.Add(data);
        }

        return rows;
    } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T14:59:23.987

我不知道这是否有帮助，但我遇到了 Excel OLEDB 代码在我期望数据的地方返回 NULL 的问题，而且它几乎总是回到数据类型推断问题。Excel 根据前 x 行数据确定列的数据类型（我认为 x=10，可能是错误的）。我知道您不想更改文件，但可能值得尝试将问题日期样式放在前 10 行中，看看它是否会改变应用程序的行为。

显然，如果它确实解决了它，那么这并不能解决您的问题。在这种情况下，我所知道的唯一修复是更改文件（在前 10 行中放置一些内容，强制它使用正确的数据类型）。抱歉，我无法提供更好的解决方案，但希望至少我能帮助您找出导致问题的原因。

# c++ - Process Explorer 中的可拖动十字准线如何工作？

> ID：714205
> 
> 赞同：4
> 
> 时间：2009-04-03T14:39:09.667
> 
> 标签：c++, .net, sysinternals

Sysinternal 的[Process Explorer](https://docs.microsoft.com/en-us/sysinternals/downloads/process-explorer)中有一个功能，它允许将十字准线从应用程序拖到您正在运行的任何其他应用程序中的控件上，并突出显示所述控件。

有谁知道这是如何实现的，或者是否有可以重用的 .NET/C++ 库？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-03T14:42:19.737

使用[Win32 API](http://en.wikipedia.org/wiki/Win32)

*   [**GetCursorPos**](http://www.pinvoke.net/default.aspx/user32/GetCursorPos.html)：获取光标位置（也许 .NET 有自己的功能来做到这一点）
*   [**WindowFromPoint**](http://www.pinvoke.net/default.aspx/user32/WindowFromPoint.html)：从屏幕中的特定点获取窗口的句柄

[更多信息](http://www.c-sharpcorner.com/UploadFile/shrijeetnair/win32api12062005005528AM/win32api.aspx)

# operating-system - 缓冲同步 I/O 和异步 I/O 有什么区别？

> ID：714209
> 
> 赞同：1
> 
> 时间：2009-04-03T14:40:11.613
> 
> 标签：operating-system, io

当使用诸如`fread`缓冲的同步 I/O 时，读取操作被推迟和组合，我认为这不是同步完成的。

那么缓冲同步 I/O 和异步 I/O 有什么区别呢？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-03T14:47:23.890

我对异步 I/O 的理解是，当它通过某种中断完成时你会收到通知，这样你就可以在那时进行更多的 I/O。使用缓冲 I/O，您执行它并忘记它，您再也不会听到那个特定的 I/O。

至少我们处理的大型智能磁盘阵列是这样的。

异步 I/O 的想法是您开始 I/O 并返回做其他事情。然后，当 I/O 完成时，您会收到通知并且可以执行更多 I/O - 换句话说，您无需等待它完成。

专门针对同步读取情况：您请求一些输入，然后在从设备读取它时等待。在那里缓冲只涉及读取比您需要的更多的内容，因此它可以在下一次读取时使用，而无需前往设备获取它。

异步读取，您只需启动读取过程，然后您就可以在它发生时去做其他事情。无论是通过轮询还是中断，您稍后都会发现读取已完成并且数据可供您使用。

对于写入，我不确定我是否能看到一个优于另一个的优势。缓冲的同步写入将几乎立即返回，除非缓冲区已满（这是异步写入可能具有优势的唯一时间）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T14:49:03.793

同步 I/O 在轮询的基础上工作：您轮询，返回数据（如果可用 --- 如果不可用，则：对于阻塞 I/O，您的程序阻塞直到数据可用；对于非阻塞 I/O，返回一个状态码，表示没有可用的数据，您可以重试）。

异步 I/O 在回调的基础上工作：您传入一个回调函数，当数据可用时（从不同的线程）调用它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T14:48:16.087

从编程的角度来看，同步 IO 将在相同的函数/进程中处理，例如。

```
var data0 = synchronousRead();
var data1 = synchronousRead(); 
```

而异步 IO 将由回调处理。

```
asynchronousRead(callBack1);
doOtherStuff();
...

function callBack1(data)
{
    data0 = data;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-03T14:48:33.903

同步 IO 是您调用例程的“正常”类型，当例程读入您的局部变量（忽略写入）时，控制流将继续。

异步 IO 涉及设置缓冲区变量（静态、全局或其他长期/广泛范围）并告诉系统您希望在数据最终可用时将数据放入其中。然后您的程序继续。当系统有数据时，它会向您发送某种信号/事件/消息，告诉您现在缓冲区变量中有数据。

GUI 程序通常使用异步 IO 来避免在 IO 完成时停止用户界面。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-03T14:51:46.487

看这里。你想知道的一切都有解释。

[链接到维基百科](http://en.wikipedia.org/wiki/Asynchronous_I/O)

# c++ - C++ 模板转换

> ID：714213
> 
> 赞同：3
> 
> 时间：2009-04-03T14:41:20.410
> 
> 标签：c++, templates

我对如何投射模板有点迷茫。我有一个函数 foo ，它接受一个类型的参数`ParamVector<double>*`。我想传入 a `ParamVector<float>*`，但我不知道如何为我的`ParamVector`班级重载强制转换运算符，而 Google 并没有给我太多帮助。有没有人有如何做到这一点的例子？谢谢。

编辑：添加一些代码，对不起，我是个白痴，根本没有很好地表达原始问题；

```
template<class T> class ParamVector 
{
public:
    vector <T> gnome;
    vector <T> data_params;
}

template<class T> class ParamVectorConsumer
{
 public:
 ParamVector<T> test;
}

ParamVector<float> tester;
ParamVectorConsumer<double> cons;
cons.ParamVector = tester 
```

将无法编译。我想知道如何编写它，以便我可以将测试器的浮点版本转换为 ParamVector 双精度。谢谢

EDIT2：铸造是错误的词。我不介意编写额外的代码，我只需要知道如何让编译器接受它，这样我就可以编写某种转换代码。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-03T14:54:33.390

我不确定，但也许你需要这样的：

```
template< typename TypeT >
struct ParamVector
{
    template < typename NewTypeT >
    operator ParamVector< NewTypeT >()
    {
        ParamVector< NewTypeT > result;
        // do some converion things
        return result;
    }

    template< typename NewTypeT >
    ParamVector( const ParamVector< NewTypeT > &rhs )
    {
        // convert
    }

    template < typename NewTypeT >
    ParamVector& operator=( const ParamVector< NewTypeT > &rhs )
    {
        // do some conversion thigns
        return *this;
    }

};
ParamVector< double > d1;
ParamVector< float > f1;
f1 = d1; 
```

您可以选择使用转换运算符或 operator= - 我在我的示例中都提供了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-03T15:27:27.693

好吧，你不能。每个不同的实际模板参数，创建一个全新的类，它与任何其他类没有*关系继承关系，具有不同的实际参数，由该模板制成。

没有关系。好吧，除了每个都提供相同的接口，以便*在模板内部*您可以处理相同的情况。

但是静态类型和动态类型都没有任何关系。

让我回到这里，解释一下。

当我声明一个指向类类型的指针时，比如

```
Foo fp*; 
```

fp 具有我们所说的静态类型，即指向 Foo 的指针。如果类 Bar 是 Foo 的子类，并且我将 fp 指向新 Bar：

```
fp = new Bar1(); 
```

那么我们就说fp所指向的对象具有Bar的动态类型。

如果 Bar2 也公开派生自 Foo，我可以这样做：

```
fp = new Bar2(); 
```

甚至不知道 fp 指向什么，我可以调用在 Foo 中声明的虚拟方法，并让编译器确保在他指向的动态类型中定义的方法就是所谓的。

为一个`template< typename T > struct Baz { void doSomething(); };`

`Baz<int>`并且`Baz<float>`是两个*完全不同的类类型*，没有关系。

唯一的“关系”是我可以在两者上调用 doSomething() ，但由于静态类型没有关系，如果我有 a `Baz<int> bi*`，我不能将它指向 a `Baz<float>`。甚至没有演员表。编译器无法将对 Baz doSotheing 方法的调用“转换”为对 Baz::doSomething() 方法的调用。那是因为*没有“Baz 方法”，没有 Baz*，只有`Baz<int>s`and `Baz<float>s`， and `Baz<whatevers>`，但没有共同的父母。Baz 不是一个类，Baz 是一个模板，一组关于当且仅当我们有一个绑定到实际类型（或常量）的 T 参数时如何创建类的说明。

现在我可以用一种方法来处理这些`Baz`es：在模板中，它们呈现相同的接口，并且编译器如果知道我们真正处理的是哪种 Baz，则可以对该方法进行*静态*调用（或成员变量的静态访问）。

但是模板不是代码，模板是元代码，是如何合成一个类的指令。模板中的“调用”不是调用，它是关于如何编写代码进行调用的说明。

所以。那是冗长而令人困惑的。在模板定义之外，ParamVector 和aParamVector 之间没有任何关系。所以你的任务不能工作。

好。几乎。

实际上，通过部分应用模板，您可以编写一个*模板函数*，它给出了如何将 a 转换为 a 的“配方`Paramvector<T>`” `ParamVector<U>`。注意 T 和 U。如果您可以编写代码来将任何类型的 ParamVector（无论实际模板参数如何）转换为任何其他类型的 ParamVector，您可以将其打包为部分应用的模板，编译器会将该函数添加到，例如，参数向量。

这可能涉及制作一个`ParamVector<U>`，并将 中的每个 T`ParamVector<T>`转换为 U 以放入`ParamVector<U>`。这仍然不会让您分配给`ParamConsumer<T>`.

所以也许你想同时拥有模板和继承。在这种情况下，您可以将所有 ParamVectors（无论类型如何）都继承自某个非模板类。然后在 ParamVectors 之间会有关系，它们都是该基类的兄弟子类。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-03T15:34:52.730

请注意，当您执行隐式转换时，编译器可以在没有您帮助的情况下（我的意思是，无需额外代码）完成的只是引用向上转换。这意味着，将对象视为参考（仅用于转换目的，对象的性质当然不会改变），它可以将其视为其祖先之一。当您有两个模板实例时，它们都不是另一个的祖先（它们都不一定在同一层次结构中）。尝试之后，编译器会查找强制转换运算符、构造函数等。在这个阶段，可能需要创建一个临时对象，除非您正在执行归因并且有一个适合的归因运算符。

您的问题的一种解决方案是使用转换构造函数：

```
template<class T> class ParamVector 
{
public:
    vector <T> gnome;
    vector <T> data_params;

    ParamVector()
    {
    }
    template <class T2> ParamVector(const ParamVector<T2> &source)
    {
        gnome.reserve(source.gnome.size());
        copy(source.gnome.begin(), source.gnome.end(), gnome.begin());
        data_params.reserve(source.data_params.size());
        copy(source.data_params.begin(), source.data_params.end(), data_params.begin());
    }
}; 
```

每当您使用模板实例并且需要其他实例时，这将创建一个临时对象。如果您要处理大型容器，这不是一个好的解决方案，开销是不可接受的。此外，如果您将模板实例传递给不需要对象而是需要引用的函数，编译器将不会自动调用转换构造函数（您必须进行显式调用）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-03T14:51:21.587

你迷路是因为你做不到——这两种类型完全不同。每当您遇到需要在代码中进行强制转换时，您应该非常仔细地检查您的代码和您的设计——其中一个或两个都可能是错误的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-03T14:51:58.293

你不能通过直接转换来做到这一点，因为 double 和 float 的大小完全不同。双精度数将是 64 位，而浮点数是 32。强制从

```
ParamVector<float> 
```

到

```
ParamVector<double> 
```

会曲解数据并给你垃圾。您可能想在谷歌上搜索“指针别名”，或者只是了解更多关于指针的一般信息，看看它是如何工作的。

想一想，你有一个数组，它是一堆 64 位值，其字段布局如下

```
0 => abcdabcd12341234
1 => abcdabcd12341234 
```

如果您强制将其解释为 32 位值的数组，则将无法正确解释。你可能会也可能不会得到类似的东西

```
0 => abcdabcd
1 => 12341234
2 => abcdabcd
3 => abcdabcd 
```

或者可以切换它以使 12341234 先出现，或者由于单词排序的方式而出现一些奇怪的东西。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-03T14:55:47.630

您在标题中提到了“模板转换”，所以我假设这`ParamVector`是一个模板类型。这意味着它`foo`也可以被模板化，这将解决您的问题。

```
template <typename T>
void foo(ParamVector<T> const& data)
{
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-03T15:00:21.723

你不能像这样转换模板，因为类型是不相关的。

但是，您可以添加转换函数，例如：

（你的代码并不完整，所以我也可以发布完整的代码。希望你能明白。）

```
template<class T> class ParamVectorConsumer
{
 public:
 ParamVector<T> test;

 template<T2> ParamVectorConsumer<T2> convert()
 {
   ParamVectorConsumer<T2> ret;
   ret = this->...
} 
```

# vb.net - 退出函数是否返回假？

> ID：714221
> 
> 赞同：7
> 
> 时间：2009-04-03T14:42:39.753
> 
> 标签：vb.net

在 VB.NET 中的布尔函数上，如果您运行 Exit Function 行，它会返回 false 吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-03T14:44:59.420

这是正确的，但需要注意的是，在 VB 中，函数名也可以是返回的变量。如果您之前将其设置为 true，它将返回 true。

* * *

更完整的是，在 VB.Net 中，如果我`Foo()`定义了一个布尔函数，如下所示：

```
Public Function Foo() As Boolean
   '... 
```

...该函数的主体有一个隐含变量，其名称`Foo`也与函数的返回类型相匹配——`Boolean`在这种情况下，但`Object`如果返回类型被省略（你应该使用`Option Strict`，它需要返回类型）。这个隐含变量被初始化为使用该类型的默认值。

如果您未能`Return`从函数中获取值，无论是通过`Exit Function`还是仅仅通过到达末尾，都会返回此隐含变量。因此，如果您提前不进行其他更改，`Boolean`函数将返回，因为这是与函数一起使用的隐含变量中的默认值。但是，如果您愿意，您也可以将该变量设置为first，然后使其返回。`False``Exit Function``True``Exit Function``True`

现在人们不经常使用隐含变量，但在某些情况下，它可以为您节省几行代码，而不会花费任何清晰的成本。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-03T18:53:10.180

不管它是否存在（编译器只给出空引用警告），如果只是为了可读性，您仍然应该显式返回 false。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-03T14:44:46.407

只要您在退出之前没有将该功能设置为 True

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-04T10:58:56.397

我总是做“返回真”或“返回假”来退出方法而不是退出语句。

# bash - 将主目录从多个客户端同步到服务器

> ID：714229
> 
> 赞同：5
> 
> 时间：2009-04-03T14:44:26.113
> 
> 标签：bash, backup, rsync

我正在使用多台 Linux 笔记本电脑/台式机，并希望它们“共享”主目录。

不幸的是，NFS 不是一个选项。因此，我试图使用 rsync 创建一个 bash 脚本，但我不知道该怎么做。

这是我现在的例子

```
`#`!/bin/bash

sync() {
  rsync -azvR --exclude-from=/home/ME/.rsync_excludes --delete -e 'ssh -ax' $1 $2
}

sync /home/ME server.domain:/home/ME
`#`sync server.domain:/home/ME /home/ME 
```

如果我只使用一台更新服务器文件的客户端机器，我认为这会很好用。正确的？

如果我删除一个客户端中的文件怎么办？想要在另一个客户端上删除该文件（在同步之后）？

我可以为此目的使用 rsync 吗？我应该寻找其他程序吗？但希望不会……

编辑：由于这个解决方案不应该只适合我，如果该解决方案能够自动进行，我将不胜感激。

Edit2：也许必须有一个解决方案，包括以某种方式回购。Subversion、Git、Mercurial 或其他。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-03T16:32:32.920

`rsync`保持一个位置与主站同步是很好的。或者换句话说，将 A 镜像到 B。不过，这不是你正在做的事情。您必须从`rsync`A 到 B，从 B 到 A。这带来了一系列全新的问题。如果一个文件消失了，你需要在另一边删除还是 rsync 回来？也许它在另一边被修改了；你不能检查。

反正; 解决这个问题的方法是[一致](http://www.cis.upenn.edu/~bcpierce/unison/)的。这是一个工具（适用于 Linux、OS X、Windows、BSD，...）（具有 CLI 工具、GUI 工具，并且可以很好地安排`cron`在能够处理几乎任何类型的冲突或问题。那些人认为这一切都比我们在这里好得多。

或者，还有 SCM。许多人使用 SCM 来管理他们的主目录。Subversion 对此很受欢迎，但我根本不推荐它。它不仅会消耗大量空间，还会让一切变得非常缓慢，并迫使您根据与主存储库的活动连接保持同步。有替代品，如 GIT 等，但它们都有其缺点。

无论哪种方式，任何基于 SCM 的解决方案都违反了 SCM 的一个非常重要的规则：您永远不应该在其中保留大的二进制数据。SCM 不是为此而设计的。您不会将您的照片集、电影、文档、下载和类似的东西保存在 SCM 中，即使您可能希望它们保持同步或在它们上保留历史记录（尤其是图片/文档）。

重要的是要了解保持备份和保持同步之间的区别。您的备份应保存在远程/分离位置，并且可以包含您拥有的所有内容的历史记录。我个人为此推荐[rdiff-backup](http://www.gnu.org/savannah-checkouts/non-gnu/rdiff-backup/)。它完美地保留了所有内容的历史记录，使用底层`rsync`算法来最小化流量，访问备份位置看起来像是备份的最新状态：您可以像浏览普通文件一样浏览它。

总而言之，我建议您将[unison](http://www.cis.upenn.edu/~bcpierce/unison/)和[rdiff-backup](http://www.gnu.org/savannah-checkouts/non-gnu/rdiff-backup/)结合使用，以获得全面的解决方案，以确保您的数据安全可靠地同步。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-03T14:47:27.713

为什么不使用[Subversion](http://www.onlamp.com/pub/a/onlamp/2005/01/06/svn_homedir.html)执行此操作？链接的文章详细介绍了作者如何使用源代码控制同步和存储历史记录（显然，您不必使用 Subversion - 还有其他选择）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T14:50:28.687

看看你所做的，这应该可以工作......你只需要确保每个客户端在完成工作后都同步到服务器。我使用以下，我在每个目录的基础上手动调用：

```
function syncDown() {
    f=${1/\\/$/}/;
    rsync -acuvz --exclude 'CVS' --exclude '*.class' --exclude '.classpath' server:projects/$f $f;
    }

function syncUp() {
    f=${1/\\/$/}/;
    rsync -acuvz --exclude 'CVS' --exclude '*.class' $f server:projects/$f;
    } 
```

如果您正在寻找无人值守的自动同步，那么您将不会得到它：您总是会遇到竞争条件，您在一个客户端上工作，但该工作会被另一个客户端的同步覆盖。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-03T15:07:11.347

看起来您可能已经知道这一点，但是，为了向那些将来可能会看到这个问题的人强调这一点：

`rsync`只做单向同步。如果你想要双向同步，你需要使用别的东西。（`cvs`/ `svn`/ `git`/etc. 将是合适的“其他东西”，但如果您不需要更新历史记录，修订控制系统可能不是最佳选择。）

实际上，这意味着如果您`rsync`从 A 到 B，那么每次同步都会使 B 上的目录看起来与 A 上的目录完全相同 - 自上次同步以来在 B 上所做的任何更改都将丢失（排除排除和仅在指定`rsync`时才会删除文件的警告`--delete`）。这种带有权威主版本的安排，然后将其推送到其他位置在许多情况下是合适的，但任何类型的协作工作都不在其中。

# c# - 使用 NHibernate 检索映射表的 PK

> ID：714230
> 
> 赞同：0
> 
> 时间：2009-04-03T14:44:37.813
> 
> 标签：c#, nhibernate

刚开始使用 NHIbernate 并且有一个问题，可能有点愚蠢！;-) 我有 2 个表格，电子邮件和附件，一封电子邮件可以有零个或多个附件。所以我创建了一个这样的hbm文件：

```
<set name="Attachments" table="Attachments">
  <key column="EmailId" foreign-key="fk_Attachments_Emails"/>
  <composite-element class="Foo.Emails.Attachment, Foo.Emails">
    <!-- PROBLEM HERE!!! -->
    <property name="Id" column="Id" type="long"  />          
    <!-- END PROBLEM -->
    <property name="Name" column="Name" type="String" length="50"/>
    <property name="Mime" column="MimeType" type="String" length="50"/>      
    <property name="Size" column="Size" type="long" />
    <property name="FilePath" column="FilePath" type="String" length="256"/>
    <property name="Parsed" column="Parsed" type="Boolean" />
  </composite-element>
</set> 
```

因为我希望能够通过 PK（集合中的 Id 列）搜索附件，所以我将其包含在内，但现在每次我尝试保存带有附件的电子邮件时，当 Nhibernate 尝试插入一个值时，我都会从数据库中收到一个错误进入PK，我的数据库自然不会允许。

所以，我的问题是，我可以提取 Attqachment 表的 pk，但在插入电子邮件/附件时阻止 Nhiberntate 编写它吗？我应该换成另一个容器吗？如果你愿意，你能提供一个例子，因为我正在努力寻找一个我理解的例子！

感谢您的帮助！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-03T18:05:46.940

也许是一个更实际的例子？如果您有这样的对象结构：

电子邮件
--EmailId
--EmailProperty1
--AttachmentCollection

附件
--AttachmentId
--ParentEmail
--AttachmentProperty1

映射到这样的表结构（不是我如何命名它，而是例如）：

电子邮件
--emailId int PK，身份
--emailProp1 varchar(50)

emailattachment
--attachmentId int PK，身份
--emailId int，FK 到电子邮件表
--attachmentProp1 varchar(50)

```
<hibernate-mapping>
        <class name="Email" table="email">
          <id name="EmailId">
            <!-- this tells NHibernate to use DB to generate id -->
            <generator class="native"/>
          </id>
          <property name="EmailProperty1" column="emailProp1"/>
          <bag name="AttachmentCollection" lazy="true" inverse="true">
            <key column="emailId"/>
            <one-to-many class="Foo.Emails.Attachment, Foo.Emails"/>
          </bag>
        </class>
        <class name="Attachment" table="emailattachment">
          <id name="AttachmentId">
            <generator class="native"/>
          </id>
          <property="AttachmentProperty1" column="attachmentProp1"/>
          <many-to-one name="ParentEmail" class="Foo.Emails.Email, Foo.Emails" lazy="proxy" column="emailId">
        </class>
    </hibernate-mapping> 
```

在此映射中，您将获得双向关系，并且该生成器标记告诉 nhibernate 具有空 Id 属性的对象（您也可以指定另一个“未保存值”），然后您将插入该对象，否则更新。应该解决您当前的问题。

结合其他事情：仔细检查映射时需要使用哪种容器（袋子、集合和列表）。hibernaterhino 的[NHibernateFAQ](https://web.archive.org/web/20110227204838/http://blogs.hibernatingrhinos.com/nhibernate/Default.aspx)中有一篇很棒的文章。

另外，由于您是 NHibernate 的新手，我非常非常强烈地推荐[夏天的 nhibernate 截屏视频](http://www.summerofnhibernate.com/)。迄今为止我发现的最好的学习工具。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T15:43:47.797

我想你想要一个双向的关系。这样，您可以双向导航关联。这包括生成的密钥...这是一个示例：

```
 <class name="Order" table="ORDERHEADER" lazy="false" >
<id name="OrderId" column="ORDERID" type="int">
  <generator class="sequence">
    <param name="sequence">"ORDERID_SEQ"</param>
  </generator>
</id>
<property name="OrderType" column="ORDERTYPE" type="Int16"/>
<bag name="OrderDetail" table="ORDERDETAIL" lazy="false" inverse="true">
  <key column="OrderId"/>
  <one-to-many class="OrderDetail"  />
</bag> 
```

```
 <class name="OrderDetail" table="ORDERDETAIL" lazy="false">
<id name="OrderDetailId" column="ORDERDETAILID" type="int">
  <generator class="sequence">
    <param name="sequence">"ORDERDTLID_SEQ"</param>
  </generator>
</id>
<property name="OrderId" column="ORDERID" type="Int32"/>
<property name="ItemNumber" column="ITEMNUMBER" type="Int32"/>
<property name="OrderQuantity" column="ORDERQUANTITY" type="Int32"/>
<many-to-one name="Order" class="Order" column="OrderId" /> 
```

# sql - 可重新运行的 SQL Server 脚本

> ID：714231
> 
> 赞同：13
> 
> 时间：2009-04-03T14:44:41.790
> 
> 标签：sql, sql-server, tsql

确保您的 SQL 可以重复运行而不会在后续运行中收到错误的最佳实践是什么？

例如

*   在创建表之前检查表不存在
*   在创建或重命名之前检查列不存在
*   错误回滚的事务
*   如果您在重新创建之前删除存在的表，请先删除它们的依赖关系，并且不要忘记在之后重新创建它们
*   如果您的 SQL 风格支持，则使用 CREATE OR ALTER PROCEDURE 代替 CREATE PROCEDURE 或 ALTER PROCEDURE
*   维护一个内部版本控制方案，因此相同的 SQL 一开始就不会运行两次。通过这种方式，您始终可以通过查看版本号来了解您所在的位置。
*   将现有数据导出到 INSERT 语句，并从头开始完全重新创建整个数据库。

*   在创建它们之前删除表（这不是最安全的事情，但如果你知道你在做什么，它会在紧要关头工作）

编辑：我正在寻找这样的东西：

```
IF EXISTS ( SELECT  *
            FROM    sys.objects
            WHERE   object_id = OBJECT_ID(N'[dbo].[foo]')
                    AND OBJECTPROPERTY(object_id, N'IsUserTable') = 1 ) 
DROP TABLE foo 
```

其他人是否使用这样的陈述或更好的陈述？

编辑：我喜欢 Jhonny 的建议：

```
IF OBJECT_ID('table_name') IS NOT NULL DROP TABLE table_name 
```

我这样做是为了添加列：

```
IF NOT EXISTS ( SELECT  *
                FROM    SYSCOLUMNS sc
                WHERE   EXISTS ( SELECT id
                                 FROM   [dbo].[sysobjects]
                                 WHERE  NAME LIKE 'TableName'
                                        AND sc.id = id )
                        AND sc.name = 'ColumnName' ) 
    ALTER TABLE [dbo].[TableName] ADD [ColumnName] 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-03T17:22:49.553

为了让事情变得更容易，我将管理工作室配置为将对象编写为可重新运行的脚本

1.  工具
2.  选项
3.  SQL Server 对象资源管理器
4.  脚本
5.  对象脚本选项
6.  包括 IF Not Exists 子句**True**

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-03T15:05:20.960

我认为确保脚本可重新运行的最重要做法是……**在对脚本进行任何更改后多次针对测试数据库运行它们**。您遇到的错误应该会影响您的实践。

**编辑**

为了响应您对语法的编辑，一般来说，我认为最好避免使用系统表来支持系统视图，例如

```
if exists(Select 1 from information_schema.tables where table_name = 'sometable')
    drop sometable
go
if exists(Select 1 from information_schema.routines where 
specific_name  = 'someproc')
   drop someproc 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-03T14:52:45.767

要添加到您的列表中：

*   如果您在重新创建之前删除存在的表，请先删除它们的依赖关系，并且不要忘记在之后重新创建它们
*   使用`CREATE OR ALTER PROCEDURE`代替`CREATE PROCEDURE`或`ALTER PROCEDURE`如果您的 SQL 风格支持它

但最终，我会选择以下之一：

*   维护一个内部版本控制方案，因此相同的 SQL 一开始就*不会*运行两次。通过这种方式，您始终可以通过查看版本号来了解您所在的位置。
*   将现有数据导出到`INSERT`语句并从头开始完全重新创建整个数据库。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-03T15:10:44.800

我最近发现了一个我不知道存在的签到，我喜欢它，因为它更短

```
IF OBJECT_ID('table_name') IS NOT NULL DROP TABLE table_name 
```

以前，我曾经使用

```
IF EXISTS (SELECT * FROM information_schema.tables WHERE table_name = 'table_name') 
DROP TABLE table_name 
```

我发现它很有用，因为它更便携（MySql，Postgres 等），当然考虑到差异

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-03T14:49:19.470

要维护模式，请查看迁移工具。我认为 LiquiBase 将适用于 SQL Server。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-03T14:54:44.060

您还需要检查您可能正在删除/重新创建的任何表上的外键。此外，请考虑您可能进行的任何数据更改 - 在尝试第二次插入之前删除行等。

您可能还希望在删除表之前放入代码以检查数据作为保护措施，这样您就不会删除已在使用的表。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-03T15:09:57.267

对于 SQL 批处理语句，您可以发出

这只是一个仅供参考，我只运行了 10 次

```
IF EXISTS ( SELECT  *
            FROM    sys.objects
            WHERE   object_id = OBJECT_ID(N'[dbo].[foo]')
                    AND OBJECTPROPERTY(object_id, N'IsUserTable') = 1 ) 
DROP TABLE foo

GO 10 -- run the batch 10 times 
```

这只是一个仅供参考，我只运行了 10 次

> 开始执行循环批处理
> 
> 执行完成 10 次。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-04T17:56:41.930

"IF OBJECT_ID('table_name', 'U') IS NOT NULL" 语法很好，它也可以用于过程： IF OBJECT_ID('procname', 'P') IS NOT NULL ...

...以及触发器、视图等...如果您的命名标准允许过程和表具有相似的名字...

此外，一个好主意可能是创建您自己的过程来更改表，并根据您的环境进行错误处理。例如：

*   prcTableDrop，用于删除表的 Proc
*   prcTableColumnAdd，用于向表中添加列的 Proc
*   prcTableColumnRename，你懂的
*   prcTableIndexCreate

这样的过程使得创建可重复的（在相同或其他数据库中）更改脚本变得更加容易。

/乙

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-03-19T05:01:20.313

我在我的帖子[DDL 'IF not Exists' 条件中描述了一些检查，以使 SQL 脚本可重新运行](https://mfreidge.wordpress.com/2011/08/12/ddl-if-not-exists-conditions-to-make-sql-scripts-re-runnable/)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-10-12T10:49:12.263

只是为将来的搜索者（包括我自己）添加这个，这样的脚本被称为幂等（名词是幂等的）

# wpf - 将 XML 数据绑定到 WPF 树视图控件

> ID：714239
> 
> 赞同：3
> 
> 时间：2009-04-03T14:45:42.287
> 
> 标签：wpf, treeview

我花了很多时间试图弄清楚如何将我的 XML 文件中的数据绑定到 TreeView 控件，但我不知道从哪里开始。我什至尝试过将[XML 数据双向绑定到 WPF TreeView](https://stackoverflow.com/questions/188001/two-way-binding-of-xml-data-to-the-wpf-treeview)和 Josh Smith 在 codeproject 上的代码示例，但仍然不明白如何开始！！！

我在文件“C:\SPDependencies.xml”中有 XML（如果需要，我可以更改格式）！！！：

```
 <node type="SPDependencies" Name="SPDependencies">
        <node type="StoredProc" Name="SP1">
                <node type="OperationType" Name="Type1">
                        <node type="TableName" Name="Table1"/>
                        <node type="TableName" Name="Table2"/>
                </node>
                <node type="OperationType" Name="Type2">
                         <node type="TableName" Name="Table1"/>
                        <node type="TableName" Name="Table2"/>
                </node>
                 .....
        </node>
        <node type="StoredProc" Name="SP2">
              <node type="OperationType" Name="Type1">
              ...
              ...
        </node>
</node> 
```

我需要在 Treeview 控件中以以下格式显示它：

```
<SP1>
   <Type1>
      <Table1>
      <Table2>
      <Table3>
   <Type2>
      <Table1>
      <Table2>
      <Table3>
<SP2>
    <Type1>
........ 
```

谢谢，阿比。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-11-22T08:51:04.613

给定以下 xml 文件：

```
<node type="SPDependencies" Name="SPDependencies">
  <node type="StoredProc" Name="SP1">
    <node type="OperationType" Name="Type1">
      <node type="TableName" Name="Table1"/>
    </node>
    <node type="OperationType" Name="Type2">
      <node type="TableName" Name="Table1"/>
    </node>
  </node>
  <node type="StoredProc" Name="SP2">
    <node type="OperationType" Name="Type1">
    </node>
  </node>
</node> 
```

**看法：**

```
<Window x:Class="Tree.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:Tree"
        Title="MainWindow" Height="350" Width="525">
    <Window.DataContext>
        <local:ViewModel />
    </Window.DataContext>
    <Window.Resources>
        <HierarchicalDataTemplate x:Key="template">
            <TextBlock Text="{Binding XPath=@Name}" />
            <HierarchicalDataTemplate.ItemsSource>
                <Binding XPath="node" />
            </HierarchicalDataTemplate.ItemsSource>
        </HierarchicalDataTemplate>
    </Window.Resources>
    <Grid DataContext="{Binding Path=XmlData}">
        <TreeView ItemsSource="{Binding}" ItemTemplate="{StaticResource template}">
        </TreeView>
    </Grid>
</Window> 
```

**查看型号：**

```
public class ViewModel
{
    public XmlDataProvider XmlData { get; set; }

    public ViewModel()
    {
        XmlData = new XmlDataProvider();
        XmlData.Source = new Uri(@"C:\input.xml");
        XmlData.XPath = "node";
    }
} 
```

**输出：**

![树视图输出](https://i.stack.imgur.com/ttXxo.jpg)

如果您只想显示根**下方**的节点，只需将 XPath 更改为：

```
XmlData.XPath = "/node/node"; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-04T13:18:41.740

这是树：

```
<Window.Resources>
    <HierarchicalDataTemplate DataType="node"
                              ItemsSource="{Binding XPath=node}">
        <TextBox Width="Auto"
                 Text="{Binding XPath=@Name, UpdateSourceTrigger=PropertyChanged}" />
    </HierarchicalDataTemplate>

    <XmlDataProvider
        x:Key="xmlDataProvider"
        XPath="node" Source="C:\Data.XML">
    </XmlDataProvider>
</Window.Resources>
<Grid>
    <StackPanel>
        <Button Click="Button_Click">Save</Button>
            <TreeView
                Width="Auto"
                Height="Auto"
                Name="treeview"
                ItemsSource="{Binding Source={StaticResource xmlDataProvider}, XPath=.}"/>
     </StackPanel>
</Grid> 
```

我添加了一个简单的按钮来保存更改。因此，对于后面代码中的 Button_Click 方法：

```
XmlDataProvider dataProvider = this.FindResource("xmlDataProvider") as XmlDataProvider;
dataProvider.Document.Save(dataProvider.Source.LocalPath); 
```

有关数据绑定和 WPF 的文章，请参见[此处](http://msdn.microsoft.com/en-us/magazine/cc700358.aspx)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2017-02-21T17:31:39.427

我已经想出了如何在不踩踏的情况下做到这一点`TreeView.DataContext`。装订很容易。Codebehind 几乎同样简单，但有一个小问题。

如果您绑定或分配`XmlDataProvider`给`ItemsSource`. 它不是`IEnumerable`（尽管它是`INotifyPropertyChanged`）并且没有隐式转换。您想要的是`XmlDataProvider.Data`，它被声明为`Object`，但我看到的是运行时类型`XmlDataCollection`（继承自`ReadOnlyObservableCollection<XmlNode>`）。

# MVVM

装订`Data`很容易。我不知道放入`XmlDataProvider`您的视图模型是否是纯 MVVM，也许不是。

视图模型：

```
public XmlDataProvider ViewModelXMLDataProp { ... } 
```

XAML

```
<TreeView
    ItemsSource="{Binding ViewModelXMLDataProp.Data}"
    ...
    /> 
```

完成——也就是说，除非您需要`XPath`使用`Binding`. 如果你这样做，你必须使用`DataContext`kludge。您不能同时设置`Path`和设置`XPath`相同的绑定。

的 XPath 属性`XmlDataProvider`做同样的事情。如果你能用它，你很好。

您认为`Binding.Source`会起作用，因为当您`XmlDataProvider`是静态资源时它会起作用。当`Binding.Source`是 a`DataSourceProvider`并且`Path`未指定时，`Path`默认为`Data`：

```
<TreeView
    ItemsSource="{Binding Source={StaticResource MyXmlDataProviderResource}}"
    ...
    /> 
```

...但这是有效的，因为你给它一个静态资源。以下内容实际上绑定到字符串，`"ViewModelXMLDataProp"`而不是`DataContext`通过该名称查找属性。那不好。

```
<TreeView
    ItemsSource="{Binding Source=ViewModelXMLDataProp}"
    ...
    /> 
```

也许你可以写一个`MarkupExtension`能让它工作的东西，但没有必要。

# 代码隐藏

你应该学习和使用 MVVM，但事情的发生有很多原因，你不是来这里布道的。

代码隐藏有点棘手。`TreeView.ItemsSource`只需要你给它的对象必须实现，`System.Collections.IEnumerable`所以不要担心确切的运行时类型是什么。`provider.Data``System.Collections.IEnumerable`

现在这是问题所在：`XmlDataProvider.Data`异步填充。

```
protected void LoadXML(String path)
{
    var provider = 
        new XmlDataProvider()
        {
            Source = new Uri(path, UriKind.Absolute),
            XPath = "./*"
        };

    //  FAIL: provider.Data is still null
    treeView.ItemsSource = (IEnumerable)provider.Data;
} 
```

即使我创建`XmlDocument`、调用`XmlDocument.Load()`并将文档分配给`XmlDataProvider.Document`. 当属性最终被设置时， A`Binding`仍然会徘徊，然后它会更新。但是在你的代码后面的文件中分配没有这样的事情。`Data``ItemsSource``ItemsSource`

与 Stack Overflow 普遍存在的民间信仰相反，在以下代码中没有发生绑定，并且在任何意义上都没有绑定任何内容：

```
//  NOT A BINDING
treeView.ItemsSource = someRandomCollectionOfStuff; 
```

如果没有人创建`System.Windows.Data.Binding`or的实例`x:Bind`，则它不是绑定。这种区别很重要：“使用当前值`x`”与“无限期更新`y.x`每次`y`提升的未来值”是不同的概念`PropertyChanged`。

您可以以编程方式创建一个`Binding`甚至句柄`PropertyChanged`，但他们继续为您提供了一个更简单的选项。只是处理`XmlDataProvider.DataChanged`事件。

```
protected void LoadXML(String path)
{
    var provider = 
        new XmlDataProvider()
        {
            Source = new Uri(path, UriKind.Absolute),
            XPath = "./*"
        };

    provider.DataChanged += (s,e) 
        => treeView.ItemsSource = (IEnumerable)provider.Data;
} 
```

就这样。您甚至可以保留该提供程序，在其中加载新的 XML，并使`DataChanged`事件保持树视图最新。虽然看起来很浪费精力。

# delphi - 图像未显示为嵌入在我的应用程序发送的电子邮件中

> ID：714241
> 
> 赞同：0
> 
> 时间：2009-04-03T14:46:09.727
> 
> 标签：delphi, email, gmail, indy

我正在尝试使用 Indy 通过 delphi 应用程序发送带有嵌入图像的电子邮件，但不知何故它不起作用。

我将我发送的电子邮件的内容与从 gmail 发送的电子邮件的内容进行了比较，一切看起来都很好，但我可能遗漏了一些小细节。

Gmail 将我的电子邮件的附件图像显示为普通附件，但它被正确设置为内联。

**编辑**

使用[TIdMessageBuilderHtml](http://www.indyproject.org/Sockets/Blogs/RLebeau/20080116.EN.aspx)解决了它在第一次尝试时效果很好。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-03T19:00:25.763

使用[TIdMessageBuilderHtml](http://www.indyproject.org/Sockets/Blogs/RLebeau/20080116.EN.aspx)解决了它在第一次尝试时效果很好。

只需几行代码：

```
 with TIdMessageBuilderHtml.Create do
    try
      Subject := 'example';
      Html.Text := 'HTML goes here';
      HtmlFiles.Add('c:\folder\image1.jpg');
      HtmlFiles.Add('c:\folder\image2.jpg');
      FillMessage(IdMessage1);
    finally
      Free;
    end; 
```

# python - 关于空腹燕子的意见？

> ID：714242
> 
> 赞同：33
> 
> 时间：2009-04-03T14:46:30.600
> 
> 标签：python, llvm, unladen-swallow

[您对Google 的 Unladen Swallow](http://code.google.com/p/unladen-swallow/wiki/ProjectPlan)有何看法和期望？从他们的项目计划中：

> 我们想让 Python 更快，但我们也想让大型、完善的应用程序更容易切换到 Unladen Swallow。
> 
> 1.  生成 Python 版本至少比 CPython 快 5 倍。
> 2.  Python 应用程序性能应该是稳定的。
> 3.  保持与 CPython 应用程序的源代码级兼容性。
> 4.  保持与 CPython 扩展模块的源代码级兼容性。
> 5.  我们不想永远维护一个 Python 实现；我们将我们的工作视为一个分支，而不是一个分支。

甚至更甜蜜：

> 此外，我们打算移除 GIL 并修复 Python 中的多线程状态。我们相信这可以通过实施更复杂的 GC 来实现

它看起来好得令人难以置信，就像 PyPy 和 Stackless 的最佳组合一样。

更多信息：

*   杰西·诺勒：[“Pycon：空载燕子”](http://jessenoller.com/2009/03/26/pycon-unladen-swallow/)
*   ArsTechnica： [“Google 搜索 Python 性能的圣杯”](http://arstechnica.com/open-source/news/2009/03/google-launches-project-to-boost-python-performance-by-5x.ars)

更新：正如 DNS 指出的那样，有一个相关的问题：[什么是 LLVM 以及如何用 LLVM 替换 Python VM 将速度提高 5 倍？](https://stackoverflow.com/questions/695370/what-is-llvm-and-how-is-replacing-python-vm-with-llvm-increasing-speeds-5x)

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-03T15:13:49.583

我对它寄予厚望。

1.  谷歌的几个人正在研究这个问题。鉴于 BDFL 也在那里使用，这是一个积极的方面。

2.  他们立即声明这是一个分支，而不是一个叉子。因此，这有可能最终被合并到主干中。

3.  最重要的是，**他们有一个工作版本**。他们**现在正在**为 Youtube 的内容使用一个空载燕子版本。

他们似乎有他们的狗屎在一起。他们在这个阶段有一个相对详细的项目计划，他们有一个测试列表，用于衡量性能改进和回归。

我对 GIL 的移除并没有屏住呼吸，但即使他们从来没有解决这个问题，单单速度的增加就让它变得很棒。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-02-19T22:53:15.940

很抱歉让您失望了，但是当您阅读[PEP 3146](http://www.python.org/dev/peps/pep-3146/)时，情况看起来很糟糕。

到目前为止，改进很小，因此编译器代码变得更加复杂。删除 GIL 也有许多缺点。

Btw. PyPy seems to be faster then Unladen Swallow in [some tests](http://morepypy.blogspot.com/2010/03/hello.html).

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-03T15:14:28.490

我认为该项目具有崇高的目标，并且有足够的时间（2-3 年），它们可能会实现其中的大部分。

他们可能无法将他们的分支合并回主干，因为 Guido 目前的观点是 cpython 应该是一个参考实现（即它不应该做 IronPython 和 jython 无法复制的事情。）我看过报告这就是阻止 stackless 的酷部分被合并到 cpython 中的原因。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-03T16:17:08.510

[这个问题](https://stackoverflow.com/questions/695370/what-is-llvm-and-how-is-replacing-python-vm-with-llvm-increasing-speeds-5x)讨论了许多相同的事情。我的意见是听起来不错，但我在等着看它是什么样子，以及需要多长时间才能稳定下来。

我特别关心与现有代码和库的兼容性，以及库编写社区如何响应它。最终，除了个人爱好项目之外，它对我来说是零价值，直到它可以运行我所有的第三方库。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-01-07T19:39:36.093

Guido 刚刚在他的推特账户上发布了一篇文章，这是对之前发布的 Jesse Noller 文章的更新。 [http://jessenoller.com/2010/01/06/unladen-swallow-python-3s-best-feature/](http://jessenoller.com/2010/01/06/unladen-swallow-python-3s-best-feature/)。听起来他们正在像前面提到的 python 3 一样前进。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-03T15:20:23.203

他们有一个季度发布。所以就在不远处，观望，让他们想出一些不只是计划的东西。

如果它确实是真的，那么即使对于性能密集型操作，也很容易摆脱 C 和 C++。

即使它是 Google 赞助的开源项目，令人惊讶的是，它在任何地方都没有涉及 Guido。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-03T17:36:00.957

我认为 5 倍的速度提升对我个人来说并不是那么重要。

这不是一个数量级的变化。尽管如果您消耗的 CPU 功率与 Google 的规模相当，那么让您的一些员工参与其中可能是值得的投资。

许多速度改进最终可能会使其进入 cpython。

摆脱 GIL 原则上很有趣，但一旦 GIL 被删除，可能会暴露出许多与非线程安全的模块有关的问题。

我不认为我会很快使用 Unladen Swallow，但喜欢关注性能如何改进常规 Python 版本。

# java - “未找到 SAX2 驱动程序类 org.apache.crimson.parser.XMLReaderImpl”在 Tomcat 上的 web 应用程序中使用 Batik

> ID：714243
> 
> 赞同：3
> 
> 时间：2009-04-03T14:46:58.523
> 
> 标签：java, tomcat, svg, classpath, batik

这可能与类路径问题有关，但目前我真的不确定，因为在某些机器上我没有收到此错误。

堆栈顶部的错误是`SAX2 driver class org.apache.crimson.parser.XMLReaderImpl not found`。为什么我只会在某些环境中收到此错误，而在其他环境中不会？我该如何进一步调查和/或解决这个问题？

**环境：**

*   Mac 或 PC 上的 Jetty == OK
*   Mac 上的 Tomcat 5 或 6 == OK
*   Win XP 上的 Tomcat 5 或 6 == 错误
*   CentOS 上的 Tomcat 6 == 错误

**POM 中的版本：**

*   蜡染：蜡染：罐子：1.5：编译
*   net.sf.saxon:saxon:jar:8.7:compile
*   蜡染：蜡染转码器：jar：1.6-1：编译
    *   蜡染：蜡染桥：罐子：1.6-1：编译
    *   蜡染：蜡染-gvt：jar：1.6-1：编译
    *   蜡染：蜡染-awt-util：jar：1.6-1：编译
    *   蜡染：蜡染工具：罐子：1.6-1：编译
    *   蜡染:batik-gui-util:jar:1.6-1:compile
    *   蜡染：蜡染分机：罐子：1.6-1：编译
    *   xml-apis:xmlParserAPIs:jar:2.0.2:compile
    *   蜡染：蜡染脚本：jar：1.6-1：编译
    *   蜡染:batik-svg-dom:jar:1.6-1:compile
    *   蜡染：蜡染-dom：jar：1.6-1：编译
    *   蜡染：蜡染-css：jar：1.6-1：编译
    *   蜡染：蜡染-xml：jar：1.6-1：编译
    *   蜡染：蜡染解析器：jar：1.6-1：编译
    *   fop:fop:jar:0.20.5:编译
    *   蜡染：batik-1.5-fop:jar:0.20-5:compile
    *   xml-apis:xml-apis:jar:1.0.b2:编译
    *   xalan:xalan:jar:2.4.1:编译
    *   xerces:xercesImpl:jar:2.2.1:编译
    *   avalon 框架：avalon 框架：jar：4.0：编译

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-11-10T06:58:22.880

谢谢，这非常有用。

在 Win 7 / Tomcat 6 上有完全相同的“缺少深红色”的东西。通过添加深红色库让它工作，但性能很差，很慢。单个图像转码大约需要 10-15 秒。终于按照您的描述通过删除 FOP 解决了问题，现在它真的很快。在我的 POM 中是这样的：

```
 <dependency>
        <groupId>batik</groupId>
        <artifactId>batik-transcoder</artifactId>
        <version>1.6-1</version>
        <scope>compile</scope>
        <exclusions>
            <exclusion>
                <artifactId>fop</artifactId>
                <groupId>fop</groupId>
            </exclusion>
        </exclusions>
    </dependency> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-03T18:15:52.267

事实证明，Apache XML Graphics 本身两次将 Crimson 添加到类路径中。一次在 Apache Batik 转码器中，一次在 Apache FOP 中。

由于库在 Tomcat 中按字母顺序加载，因此 FOP 首先包括 Crimson，但随后 Batik 也这样做了。

我从项目 POM 中排除了 FOP，并解决了类路径问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-01-14T02:51:53.710

这是JDK版本问题。[在这里找到](https://community.oracle.com/thread/1637889)：

*   一些 JDK 已经包含`crimson`lib 并且在开发者机器上运行良好；
*   但是有些JDK在用户的机器上没有那个lib并抛出错误；

使用以下 Maven 配置：

```
<dependency>
    <groupId>batik</groupId>
    <artifactId>batik-transcoder</artifactId>
    <version>1.6-1</version>
</dependency>
<dependency>
    <groupId>crimson</groupId>
    <artifactId>crimson</artifactId>
    <version>1.1.3</version>
</dependency> 
```

# integration - 估计集成时间，真的是 3 倍吗？

> ID：714246
> 
> 赞同：0
> 
> 时间：2009-04-03T14:47:14.717
> 
> 标签：integration, estimation

我在一个神话般的人月中读到，集成所需的时间是开发单个组件所需时间的 3 倍。

你们经历了什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-03T14:56:50.903

是和不是。集成*工作量*可能仍然是 3 倍，但现在它已在整个开发过程中摊销（例如早期集成、集成测试（尤其是 TDD 中）等）

我们仍然需要做这项工作，但它不再让我们感到惊讶。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-03T14:49:22.200

那是指他们分别构建所有软件组件然后尝试将它们全部放在一起的糟糕的过去。聪明的人不再那样工作了——他们[不断地整合](http://en.wikipedia.org/wiki/Continuous_Integration)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T15:21:29.160

我会同意，如果不是更高的话。尽管它确实取决于集成接触点。

我参与了一个在 Siebel 和 SAP 之间集成多个模块的项目。虽然这两种产品都有可用的集成模块，但项目中的所有问题（并且有很多问题）都涉及到集成。

我们使用的大部分 SAP 都是德语的，并且正在传输的消息采用不同的 XML 编码格式（UTF8 / UTF16），这对我们没有帮助。

一旦我们掌握了 SAP 想要发送和接收的内容的复杂性，整个项目就进展得更快了。

成功集成项目的关键：

*   关于集成模块的良好文档（英文！）
*   关于消息格式的良好文档
*   良好的项目管理

项目管理位很重要，因为他们提供比萨饼，并且当您连续工作 30 小时以从一台机器上的一个文本框中获取帐户名称以显示在另一台机器上的另一个文本框中时，确实表现出一些理解。

我们的项目持续了一年多。我们所做的 Siebel 配置的其余部分，很多只是几个月，

所以集成 - 10 个月+，其余配置 2 个月。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-03T15:00:28.400

集成时间取决于几个因素：项目规模、团队之间的沟通以及您的集成理念。

小项目需要更少的时间来集成。大型、超大型或大型项目将需要更多时间来集成。我一直在进行集成最少的小型项目。我参与过跨越多个组件团队的大型项目，其中集成需要很长时间。

集成的时间还取决于您在团队之间进行沟通的程度。如果您的团队没有沟通，则可能需要 3 倍或更多的时间来整合和解决所有相关的错误。

持续集成有助于理解集成需要更少的时间。使用 CI，集成的时间在项目的整个生命周期中分摊。但是，如果您与其他组件团队的关系不佳，那么所有集成的总时间将花费非零时间。

CI 绝对比替代方案更好。等到开发周期的后期才进行集成势必会给您带来很大的痛苦。越早开始集成，每个团队就越能适应这个过程。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-03T15:09:39.233

附带说明一下，Juval Lowey 对此进行了一次有趣的谈话。如果您有许多微小的组件，那么您会增加集成的工作量。如果您只有几个大型组件，则会降低集成度，但您需要维护更复杂的组件。因此，您的集成工作取决于架构以及在何处平衡组件数量与其复杂性。良好的平衡是关键，因为如果你在一侧或另一侧漂移，所需的努力会成倍增加。如果您有 20 个组件并添加第 21 个组件，那么它不仅会复杂 5% (1/20)，因为您必须考虑潜在的其他 20 个组件的相互作用。因此，添加一个组件可以增加 20 种与现有组件交互的方式。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-03T15:14:05.340

尼尔和马库斯的回答很到位。在 Windows 中，我们不断集成。我们的源代码控制系统（我们称之为“Source Depot”）是分层的，“WinMAIN”位于顶部，其下方的分支树通常对应于组织结构。

一般来说，变化在“正向集成”和“反向集成”的过程中上下流动。这种情况经常发生 - winmain 下的顶级分支几乎每天都发生，而较低级别的分支则较少发生。每个主要分支*每天都*以至少四种口味完全构建。顶级分支有六种风格。风味类似于 x86/fre 或 x64/chk。我们还获得了一些日常的伪本地化构建。

“构建”是指从源代码构建完全可安装的 Windows 客户端产品。这种情况每天发生数百次。

这对我们很有效——这里有两个重要的目标：

1.  在树上下保持良好的代码流（我们称之为速度）。这个想法是任何分支都与 WinMAIN 没有太大的不同。
2.  尽早发现集成错误。

Markus 非常正确，这可以在项目的整个生命周期内摊销集成成本。对我们来说，这使得成本比我们将成本更多地推迟到周期结束时的成本低很多。这就是过去的工作方式。不要放太多脏衣服，但是当我大约 5 1/2 年前开始使用 Windows 时，进行构建需要非常非常长的时间。它们现在每天都在发生，就像时钟工作一样。Windows 工程工具和发布组 (WETR) 对此赞不绝口。

正如许多其他人在各种论坛中所建议的那样 - 定期集成和每日全自动构建对于大多数项目来说都是必不可少的。

请注意，日常和定期自动化测试是另一个主题（您可以想象这是一项巨大的努力）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-19T12:07:18.250

如果您在项目计划的项目结束时有一个集成阶段，那么您注定要失败，x3 还不错。

你应该选择持续集成，比如每 2 周发布一个包含一些集成的版本。

# sharepoint - Infopath 2007：隐藏复选框控件

> ID：714254
> 
> 赞同：0
> 
> 时间：2009-04-03T14:48:25.340
> 
> 标签：sharepoint, checkbox, infopath

我正在开发一个 infopath 2007 网络表单，我希望能够隐藏一个复选框。控件本身并没有这样做，那么有没有人有隐藏它们的好方法？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-06T12:20:07.900

将条件格式添加到复选框。删除框后面的文本（将一直可见）。在复选框后面添加一个表达式字段并将您的文本放在这里。然后给那个表达式框同样的条件格式。

替代：

将复选框放入带有条件格式的部分（这需要更多空间，但以后更容易构建和管理。）

# c# - SHDocVw.WebBrowserClass 注册刷新事件

> ID：714259
> 
> 赞同：0
> 
> 时间：2009-04-03T14:48:44.247
> 
> 标签：c#, internet-explorer, .net-2.0, shdocvw

有没有办法知道用户何时使用 C# 的 SHDocVw.WebBrowserClass 对页面执行刷新

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-03T14:56:31.747

可能有更好的方法，但您可以考虑使用 Before_Navigate 它也应该由刷新触发。

**编辑 ：**

我刚刚检查了文档，显然刷新不会触发这些，抱歉。

我认为这没有简单的方法，您可能想尝试以下组件：

[http://code.google.com/p/csexwb2/](http://code.google.com/p/csexwb2/)

这是一个非常好的 webbrowser 控件实现，使用 C++ 处理棘手的部分，并且有一个可以使用的 refreshbegin 事件。

# c# - 为什么这段代码的执行速度比预期的要快？

> ID：714266
> 
> 赞同：1
> 
> 时间：2009-04-03T14:49:20.063
> 
> 标签：c#, .net, multithreading, execution

我有这个代码：

```
 public void replay() {
        long previous = DateTime.Now.Ticks;
        for (int i = 0; i < 1000; i++) {
            Thread.Sleep(300);
            long cur = DateTime.Now.Ticks;
            Console.WriteLine(cur - previous);
            previous = cur;
        }
    } 
```

它作为一个单独的线程调用，如下所示：

```
 MethodInvoker replayer = new MethodInvoker(replay);
        replayer.BeginInvoke(null, null); 
```

但是，如果我查看输出，它的行为会很奇怪。它`i`成对输出。例如，它会等待一个完整的等待，然后输出`i`，然后也快速输出下一个`i`，然后再次等待。为什么会这样，我该如何纠正？

它输出这个：

```
3125040
2968788
2968788
2968788
3125040
2968788
2968788
2968788
3125040
2968788
2968788
2968788
3125040 
```

如果我将睡眠时间增加到一秒钟以上，则不会发生这种情况。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-03T14:58:24.037

更改代码以消除分析中的显示延迟：

```
public void replay() 
{        
    Thread.Sleep(5000);
    DateTime start = DateTime.Now;      
    for (int i = 0; i < 1000; i++) 
    {            
          Console.WriteLine(string.Format("Exec:{0} - {1} ms",
                i, DateTime.Now - start));
          start = DateTime.Now;
          Thread.Sleep(300);        
    }
} 
```

查看修改后的输出，循环延迟的方差小于 5%（300 个中的 15 毫秒）。这是正常的，因为操作系统实际将时间片分配给线程时所涉及的不确定性......（如果我没记错的话，在 Windows 操作系统中，这通常是每 20 毫秒！）

您在控制台输出中看到的较大差异几乎可以肯定是由于显示延迟。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-03T14:52:34.563

无法重现。我想知道它是否是您机器本地的东西；缓冲，也许。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-03T15:04:56.873

我无法重现这一点，但您可能需要考虑使用计时器。它会更可靠。

```
public class Counter
{
    private readonly TimeSpan initialDelay, incrementDelay;
    private readonly int maxCount;
    private Timer timer;
    private int count;

    public Counter(TimeSpan initialDelay, TimeSpan incrementDelay, int maxCount)
    {
        this.maxCount = maxCount;
        this.initialDelay = initialDelay;
        this.incrementDelay = incrementDelay;
    }

    public void Start(Action<int> tickBehavior)
    {
        if (timer != null)
        {
            Timer temp = timer;
            timer = null;
            temp.Dispose();
        }
        timer = new Timer(() =>
            {
                tickBehavior(count++);
                if (count > maxCount) timer.Dispose();
            }, null, initialDelay, incrementDelay);
    }
} 
```

用它：

```
Counter counter = new Counter(TimeSpan.FromSeconds(5), TimeSpan.FromSeconds(.3), 1000);
counter.Start((count) => Console.WriteLine(count);); 
```

**编辑**

我正在使用`System.Threading.Timer`，但`Counter`可以很容易地修改为使用`System.Timers.Timer`或`System.Windows.Forms.Timer`根据您的需要。有关何时使用哪些计时器的说明，请参阅[此链接。](http://msdn.microsoft.com/en-us/magazine/cc164015.aspx)

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-04-03T14:52:17.933

你在循环中的睡眠时间只有 300 毫秒，这不是很长。您的应用程序将执行以下操作：

*   睡眠 5 秒
*   打印 0
*   睡眠 300 毫秒
*   打印 1
*   睡眠 300 毫秒
*   打印 2

等等

# memcached - 您使用 memcached 的一些更有趣的方式是什么？

> ID：714275
> 
> 赞同：3
> 
> 时间：2009-04-03T14:51:52.163
> 
> 标签：memcached

在我的模式工具中实现`memcached`缓存层后，我想知道是否有更多功能可以使用`memcached`规范以外的服务：

```
rec = cache.get(make_cache_key(k))
if rec: return rec
rec = dbi.execute(query_string(k))
cache.set(make_cache_key(k), rec)
return rec 
```

使用行缓存？

诸如结构化数据的 JSON/XML 缓存之类的东西？图表数据？图片？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2015-03-19T18:45:09.043

到那时，redis 开始看起来更有用了！

[http://www.redis.io/](http://www.redis.io/)

# uml - 我应该为此使用哪些 UML 图？

> ID：714282
> 
> 赞同：0
> 
> 时间：2009-04-03T14:52:56.153
> 
> 标签：uml

我有一些交互的类（4），我想展示如何，基本上是什么函数调用什么，也许是参数。

我还想展示一些操作的流程，但我认为活动图会做，或者可能是序列图。

无论哪种方式，我都不确定在第一种情况下使用什么。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T14:54:44.560

听起来像是[交互图](http://atlas.kennesaw.edu/~dbraun/csis4650/A&D/UML_tutorial/interaction.htm)人的工作！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-04-05T20:19:54.357

我知道这个问题是在 2 年前提出的，但是哦，好吧。如果你有很多迭代，交互图。如果算法是高度顺序的，则为序列图。

但是为了做你想做的事情（基本上是试图做一个图形伪代码表示），我会选择交互图。

序列图通常是伪代码的不良替代品，因为它们的初衷是将系统之间的时间依赖关系显示为单个任务执行（和完成）的一部分。

# wpf - 为什么 WPF 中没有视觉继承？

> ID：714283
> 
> 赞同：8
> 
> 时间：2009-04-03T14:53:17.807
> 
> 标签：wpf, inheritance

在 Windows 窗体中，有时让一个窗口继承自另一个窗口是很有用的。但在 WPF 中，这是不允许的。为什么 WPF 窗口没有视觉继承？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-09-20T08:34:56.477

WPF 不支持视觉继承的原因是由于表单设计是通过标记 (.xaml) 实现的，而不是使用代码隐藏来生成布局的 winforms。代码隐藏是可扩展的，而标记不是。Web 表单也是如此。asp.net 中的母版页提供了准视觉继承。所以这是一种权衡，标记提供了布局和数据清晰分离的好处，而代码隐藏提供了视觉可扩展性。有点遗憾，因为视觉可扩展性在创建 GUI 的一致性以及非常快速的开发方面非常有效。好吧，似乎耀斑比功能更受欢迎。WPF 没问题...

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-03T15:01:09.473

WPF 故意与 Windows 窗体非常、非常不同。可组合性模型不是基于 Windows，而是基于[Dependency Object](http://msdn.microsoft.com/en-us/library/system.windows.dependencyobject.aspx)、[Visual](http://msdn.microsoft.com/en-us/library/system.windows.media.visual.aspx)、[UIElement](http://msdn.microsoft.com/en-us/library/system.windows.uielement.aspx)等类。您还可以使用控件模板、样式、数据绑定和其他技术大幅修改现有事物的行为。

我鼓励你去尝试！WPF 很容易用

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T15:07:19.210

在 WPF 中，人们付出了很大的努力来将视觉与逻辑分开。正因为如此，有很大的自由度可以让 UI 看起来像你想要的那样。包括窗口在内的所有控件都是“无外观”的。您可以通过模板和样式提供自己的外观。提供了默认的视觉样式，使一切看起来像您期望的那样，但您不必使用它。

# c# - 将数据库中可用角色的列表显示为像 NerdDinner 对国家所做的复选框

> ID：714284
> 
> 赞同：0
> 
> 时间：2009-04-03T14:53:19.353
> 
> 标签：c#, asp.net-mvc, repository

我在 C# 中有一个使用表单身份验证的 ASP.NET MVC 项目，并且 Active Directory 是成员资格提供程序（用户使用他们现有的 uid/pwd 登录）。但是，我希望由 aspnet_Roles（应用程序创建的默认表）提供角色。在我的 Web.config 中，我有： 使用此节点的默认设置。

我成功地遵循了[NerdDinner](http://tinyurl.com/aspnetmvc)示例应用程序 PDF 并希望使用我所学到的东西。在我的应用程序中，我使用存储库模式，就像 NerdDinner 一样。在 NerdDinner 中，它展示了如何使用 Helper 方法来填充 DropDownList。我也想做同样的事情，但我想从表格中提取角色并填充复选框，而不是国家和下拉菜单。

在我的 UsersController.cs 中，我有：

```
//
// ViewModel Classes
public class UserFormViewModel
{
    // properties
    public User User { get; private set; }
    public SelectList Roles { get; private set; }

    // Constructor
    public UserFormViewModel(User user)
    {
        User = user;
        Roles = new SelectList(Roles.All, ); //this is where I have problems
    }
} 
```

在我看来，我有（这当然行不通）：

```
<ul>
    <% foreach (var role in Roles as IEnumerable<SelectListItem>)) { %>
    <li><%= Html.CheckBox(role.ToString())%> <%= role.ToString() %></li>
    <% } %>
</ul> 
```

PS 我是 .NET 的新手，但我喜欢它！如果我错了，请纠正我，但我认为这个问题与集合和类型定义有关？

此外，我熟悉使用 ASP.NET 配置工具添加角色和用户，但我想创建一个自定义用户管理部分。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-03T16:20:37.160

像这样的东西？

```
<li><%= Html.CheckBox(role.ToString(), 
     Roles.IsUserInRole(Model.User.Identity.LoginName, role.ToString())) %> 
    <%= role.ToString() %>
</li> 
```

不太记得 asp.net 成员资格提供程序中角色的确切语法，但它是沿着这些线的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-06T13:00:42.357

看起来我不需要使用 UserFormViewModel 类。变形帮了我。这就是我正在做的事情：

```
<ul>            
    <% 
        string[] allroles = Roles.GetAllRoles();
        foreach (string role in allroles) {
    %>
    <li>
        <%= Html.CheckBox(role.ToString(), Roles.IsUserInRole(Model.UserName, role.ToString())) %>
        <%= role.ToString() %>
    </li>                   
    <% } %>

</ul> 
```

# java - Java 套接字的 PrintWriter 线程安全吗？

> ID：714287
> 
> 赞同：9
> 
> 时间：2009-04-03T14:53:27.043
> 
> 标签：java, multithreading, sockets

所以，我有两个线程。

线程一管理客户端连接。（只有一个客户端和一个服务器）
我称之为我的服务器线程。

线程二管理向客户端发送消息。我称它为我的消息处理器线程。

线程一负责定期向客户端发送心跳。

在编程时，我假设套接字不是线程安全的，但缓冲区是，只要我为服务器和处理器线程使用单独的缓冲区就可以了。

我还假设“PrintWriter”类似于 Java 中的套接字缓冲区。

在这些假设下，我编写了这个函数来发送心跳：

```
public void sendHeartBeat(){
        logger.info("Sending a hearbeat!");
        PrintWriter printWriter=null;
        try {
            printWriter = new PrintWriter(clientSocket.getOutputStream());
        } catch (IOException e) {
            logger.info(e.toString());
        }
        if(printWriter!=null){
            printWriter.print("HEARTBEAT#");
            printWriter.flush();
        }
    } 
```

另一个线程，“处理器”线程做了类似的事情：

```
printWriter=new PrintWriter(theServer.getClientSocket().getOutputStream()); 
```

以这种方式，每当我希望发送心跳时，我都会创建一个新的“缓冲区”，并且我的消息永远不会被覆盖。

不幸的是，情况似乎并非如此。我通过管道收到一条消息，如下所示：dsgdsbHEARTBEAT#sdg

这会导致稍后发生核心转储。

以下是我的问题：

1) 套接字显然不是线程安全的，但我从它们那里得到的 PrintWriters 是线程安全的吗？还是只是返回相同的 PrintWriter？

2) 什么类似于 Java 中的套接字缓冲区？我应该如何思考这个问题？

3）如何使这些线程不写入套接字上的同一个缓冲区？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-03T15:21:45.523

将这些多个`PrintWriter`s 放在同一个流上是一个糟糕的设计。真的，您至少希望调用它们的对象是同步的（或线程受限的）。

但是，假设由于某种原因您确实想要多个`PrintWriter`s：

第一个问题：`Writer`s不要`this`用作锁。默认情况下，两者都使用`PrintWriter`它们构造的锁。这显然是彻底坏掉了。他们应该使用' 锁，而不是本身。一个简单的错误，因为锁定了一个删除静态类型安全的特性。所以你需要用套接字（或其他一些常见的对象）作为锁来构造一个。`BufferedWriter``Writer``Writer``Writer``Object``PrintWriter``OutputStream`

其次，我们在`PrintWriter`. 所以在缓冲区结束时，一半被写入，一半等待下一次写入。为防止这种情况，请在外部锁定以组合 a`print`和`flush`，或使用自动刷新并添加换行符。

所以，它不是*有意义的*线程安全，但你可以破解它。或者你可以使用更好的设计。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-03T14:58:48.403

您需要一种`PrintWriter`在线程之间使用相同的方法（`t1.writer == t2.writer`而不仅仅是`PrintWriter`从相同的创建`OutputStream`）。同理`PrintWriter`，所有的写操作都是同步的。

# batch-file - PsExec 和调用批处理文件

> ID：714303
> 
> 赞同：0
> 
> 时间：2009-04-03T14:58:59.807
> 
> 标签：batch-file, psexec

我将尝试尽可能简单地分解它。

涉及三台计算机。本地机器 (LM)、计算节点 (CN) 和数据节点 (DN) 将从这里开始成为它们的名称。

我有一个 psexec 命令，它调用计算节点上的批处理文件。

```
psexec \\"compute node" -w WorkingDirectory BatchFileName 
```

此 BatchFileName 设置一些局部变量，然后设置位于 WorkingDirectory 中的可执行文件。这个可执行文件加载，但它有一个配置文件，指向位于数据节点上的一堆文件。这就是我的操作失败的地方。如果我在计算节点上本地运行批处理，一切正常。我只是尝试使用 psexec 从本地机器调用它。在这种情况下，所有计算机都使用相同的帐户名和密码。

我得到的错误是它无法打开位于数据节点上的文件。

批处理文件：

```
@echo off
setlocal
set VALUATION_DATE=20090313
set LiTEShome=C:\LiTES
ServiceConsole.exe
endlocal
exit /b 0 
```

ServiceConsole.exe.config 包含：

```
<add key="SomeName" value="\\Data Node\\Directory\\FileName"/> 
```

对此的任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-03T15:15:32.700

尝试

```
psexec \"compute node" -w WorkingDirectory BatchFileName -u UserName -p Password 
```

使用对两个节点都具有权限的帐户。

# linux - SVN：忽略已经提交的文件

> ID：714307
> 
> 赞同：23
> 
> 时间：2009-04-03T14:59:27.963
> 
> 标签：linux, svn, version-control

我有一个使用颠覆进行版本控制的设置文件。每个人都有自己的这个文件的副本，我需要这个永远不要被提交。但是，就像我说的那样，版本控制下已经有一个副本。我的问题是：**如何在不删除每个人的文件的情况下从版本控制中删除此文件，然后将其添加到忽略列表中以使其不会被提交？**我正在使用linux命令行svn。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-03T15:28:05.523

进行干净的结帐，`svn delete`文件并添加忽略。然后提交这个。其他人都必须注意（一次）他们的本地副本不会在 next 上被删除`svn update`，但在那之后，本地文件将保持不受干扰并被 SVN 忽略。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-04-03T15:28:55.023

如果您从版本控制中删除该文件，该项目的新开发人员（或不小心删除其本地副本的开发人员）如何在初次签出后获得它？如果设置文件中有附加内容怎么办？

我建议如下：在 SVN 中保留一个默认设置文件（没有密码、主机名、连接字符串等），`settings.dist`将其命名为`settings`. 每个开发人员都必须制作一次此副本，然后才能使用她的个性化设置。如果有添加，请将它们添加到`settings.dist`- 其他所有人都会通过更新获得它们，然后可以合并到她的个性化副本中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-03T23:05:49.720

删除文件后，您的用户必须使用`svn export`.

```
$ svn export -r x path ./ 
```

Where`x`是文件在被删除之前存在的修订版，是文件`path`的完整路径，并且`./`是放置文件的位置。

有关[`svn help export`](http://svnbook.red-bean.com/en/1.0/re10.html)更多信息，请参阅。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-03T15:48:53.227

只需定义一个包含将覆盖默认设置的设置的文件。该文件未检入 Subversion，每个开发人员负责根据他们的环境维护该文件。

在基于 Ant 的世界中，您将拥有以下文件：

```
settings.properties
settings-local.properties (ignored for Subversion) 
```

在你的`build.xml`文件中

```
<property file="settings-local.properties"/>
<property file="settings.properties"/> 
```

对于那些无法连接点的人：

1.  像建议的那样修改 build.xml 文件
2.  将 setting-local.properties 设置为忽略
3.  在`init`构建的目标中，将 settings.properties 复制到 settings-local.properties
4.  等几天，直到每个人都有机会运行这个目标
5.  从 Subversion 中删除 setting.properties

瞧，每个开发人员都有自己的 setting-local.properties，一切都是自动完成的（没有开发人员丢失了他或她的设置，如果你从 Suvbersion 粗暴地删除文件并且没有“其他人都必须小心”，就会发生这种情况。 ..”）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-09-19T06:40:43.330

我有一个类似的问题。在我的例子中，它是一个自动生成的用户设置文件（visual studio），在项目的早期就被意外签入了。虽然只是删除它可能会起作用，但将其从历史中删除似乎更多`correct`，因为它本来就不应该存在于那里。

我遇到了这个，这可能是一个新功能，因为这个问题最初是在 7.5 年前发布的：

[https://stackoverflow.com/a/6025750/779130](https://stackoverflow.com/a/6025750/779130)

似乎一个想法是：

```
1) create a dump of the project.
2) filter the dump using `svndumpfilter` to exclude the unwanted file(s).
3) load the dump as a new project. 
```

这可能是完全摆脱文件的唯一方法。在大多数情况下，“删除并忽略”方法可能就足够了。

* * *

## 回答 #6

> 赞同：-4
> 
> 时间：2009-04-03T21:22:33.627

[[*我是颠覆的新手，所以也许这没有意义。将此标记为 wiki - 如果您知道正确的答案，请在后面的部分中追加*]]

难道你不能有一组自定义的结帐步骤，以便每个用户都有一个不同的设置文件夹吗？

> ```
> $ svn checkout http://example.com/project  project
> ..
> $ dir project
> original_settings\     folder1\     folder2\ 
> $ svn checkout http://example.com/project/aaron_settings project\settings
> ..
> $ dir project
> original_settings\     folder1\     folder2\    settings\ 
> ```
> 
> 或者对于新用户
> 
> ```
> $ svn import project\settings  http://example.com/project/aaron_settings 
> ```

我要说的是，您希望每个用户都拥有存储库的自定义视图。在其他版本控制系统中，您可以设置一个自定义列表，列出您正在使用的项目、未使用的项目以及放置在奇怪位置的项目。

这在颠覆中有效吗？上面的代码看起来真的很冒险，但也许我做错了。

维基：

（还没有）

# c# - 无效的数字证书

> ID：714308
> 
> 赞同：0
> 
> 时间：2009-04-03T14:59:31.427
> 
> 标签：c#, .net, ssl, digital-certificate

我正在尝试将 SSL 添加到我的服务器，以便将客户详细信息发送给客户端。

它似乎在服务器端工作，数字证书 (.pfx) 已成功加载。

当我尝试与客户端连接时，问题就来了。抛出 AuthenticationException 说明远程证书无效。该证书是自签名测试证书 - 这可能是问题吗？

如果没有，我没有想法！

**编辑：**证书位于双方 MMC 中受信任的根证书文件夹中（服务器和客户端出于开发目的在同一台机器上运行）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T16:06:30.517

我不得不重写验证方法：

```
public static bool RemoteCertificateValidationCallback(Object sender, X509Certificate certificate, X509Chain chain, SslPolicyErrors sslPolicyErrors)
{
    return true;
} 
```

显然，这将接受传递给它的**每个**证书，因此我需要使用证书的哈希或类似的东西进行检查。然而，现在是假期！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T15:06:04.330

这绝对是问题所在。您是否尝试过将该 Web 服务器添加到客户端上的受信任根证书中？如果客户端不信任证书提供者（您的 Web 服务器，因为是自签名的），它会在尝试对证书进行身份验证时抛出异常。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T16:04:53.860

你是如何生成证书的？

*   默认情况下，makecert.exe 会生成一个不适合使用 ssl 身份验证的证书。

*   使用“-sky exhange”选项生成一个合适的。

makecert -n "CN=Client" -pe -ss My -sr CurrentUser -sky exchange client.cer makecert -n "CN=Host" -pe -ss My -sr LocalMachine -sky exchange host.cer

# windows-installer - Web 设置项目中的虚拟目录

> ID：714309
> 
> 赞同：16
> 
> 时间：2009-04-03T14:59:36.327
> 
> 标签：windows-installer, web-setup-project

我有一个 Web 设置项目，默认情况下在文本框安装程序屏幕中显示虚拟目录。我希望虚拟目录名称不能由用户编辑，并且始终默认为我在我的 msi 中设置的那个。如何做到这一点？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-04-16T19:05:31.043

如果您不希望用户更改虚拟目录，您可以简单地从用户界面中删除“安装地址”对话框。

1.  右键单击安装程序项目并选择“用户界面”。
2.  展开“开始”节点。
3.  右键单击“安装地址”。
4.  选择“删除”

如果您想要网站、虚拟目录、通常由安装地址对话框选择的应用程序池的不同参数，您可以使用其他人描述的自定义操作覆盖。

但是，根据我的经验，自定义操作无助于设置用户可以更改的默认值，因为它们在要求用户输入的对话框***之后执行。***

设置一些用户可以在必要时在对话框中覆盖的默认值的最简单方法是执行以下操作。

1.  删除欢迎页面。
2.  添加文本框对话框（例如“文本框 (A)”）
3.  将所有文本框的 Visible 属性更改为 false，以便不显示文本框。
4.  更改 BannerBitmap 和 BodyText 属性，使其看起来有点像欢迎页面。
5.  在“编辑***<n> 属性”中设置您想要覆盖的必要属性，并在“编辑<n>***值”***中设置默认值。***

最有用的属性（恕我直言）是。

TARGETDIR - 要复制文件的位置。
TARGETVDIR - 要在指定站点中创建的虚拟目录。
TARGETAPPPOOL - 要使用的应用程序池（注意：必须存在，不会创建）
TARGETSITE - 要创建虚拟目录的网站（注意：这是网站的***元数据库值***...例如：“/LM/W3svc/2”。还要注意该站点必须存在）。

可以在[此处](http://msdn.microsoft.com/en-us/library/aa370905.aspx)找到安装程序的完整属性列表。

如果您真的想要更好地控制 IIS 设置，我建议您将项目更改为标准 Windows Installer 项目并创建自定义安装操作，以便您可以通过编程方式创建 AppPools。开始了解以编程方式创建这些东西的好地方是[这里](http://msdn.microsoft.com/en-us/library/ms524896.aspx)。

这样做的最大原因是自定义操作在提示***后***运行，但必须在安装程序提示***之前***创建应用程序池和网站。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-06T21:05:36.627

理论上听起来不错，但据我所知，它不起作用，至少不适用于设置 AppPool。我有一个自定义操作来在我的 vs2008 Web 设置项目中设置 apppool（顺便说一下，当安装程序是用 VS2005 构建时，它可以正常工作）。

```
DirectoryEntry IISVdir = new DirectoryEntry(String.Format("IIS://{0}{1}/{2}", strServer, strRootSubPath, Vdir));
IISVdir.Properties["AppPoolId"].Value = appPool;
IISVdir.CommitChanges(); 
```

安装程序在没有对话框的情况下运行（删除了安装地址 UI 节点），但虚拟目录上设置的 AppPool 最终成为 DefaultAppPool。

我的助手类中的其他自定义操作确实可以运行和工作。

所以肯定还需要一些其他的魔法咒语。

谢谢。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-14T21:23:02.963

为了使用 Context.Parameters 获取虚拟目录

1.  添加自定义操作以安装节点（如果您想知道如何添加自定义操作，请使用此[url ）](http://msdn.microsoft.com/en-us/library/d9k65z2d(VS.80).aspx)
2.  右键单击自定义操作并选择属性窗口。
3.  对于 CustomActionsData 属性集 /targetvdir="[TARGETVDIR]"。
4.  现在在您的安装程序类中，您可以通过 Context.Parameters["targetvdir"] 获取虚拟目录名称。希望这对你有帮助:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-03T15:34:50.127

切换到[Wix](http://wix.sourceforge.net/)并使用他们的[Web 扩展](http://wix.sourceforge.net/manual-wix3/iis_xsd_index.htm)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-06-13T20:31:12.360

Lo-tech 解决方案：在 notepad++ 中编辑 vdproj 文件以设置虚拟目录并从用户界面编辑器中删除安装地址对话框。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-09T22:42:47.370

选择您的安装项目，查看 > 编辑器 > 用户界面，选择安装地址对话框，然后将其删除。

编辑：

正如 Shay 指出的那样，用户可以从命令行覆盖默认安装位置。要覆盖它，您应该在 InstallExecuteSequence 中设置 TARGETDIR 属性。不幸的是，您无法从 Visual Studio 更改此序列，您必须使用 Orca：

1.  构建您的安装项目。
2.  从 Orca 打开 MSI 文件。
3.  使用 Source "TARGETDIR"（不带引号）、目标文件夹的 Target 和 Action 的唯一名称创建一个类型 51（设置属性）的新自定义操作（约定是使用带有初始下划线的 GUID）。
4.  在 InstallExecuteSequence 中创建一个新行，其中 Action 是您的唯一名称，Condition 是“NOT Installed”，使用 TARGETDIR 之前的序列号（750 是我制作的示例中的第一次使用，所以我使用了 555 的序列） .

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-10T19:22:08.187

Org 不允许开源，或者 GPL 开源。

解决方案： * 编辑自定义动作（右键>查看>自定义动作）修复虚拟目录和路径更改customactiondata：

```
/targetdir="[TARGETDIR]\" /connectionstring="[CONNECTIONSTRING]" /targetvdir="[TARGETVDIR]" /targetsite="[TARGETSITE]" 
```

至：

```
 /targetdir="[TARGETDIR]\" /connectionstring="[CONNECTIONSTRING]" /targetvdir="FIXED_NAME" /targetsite="[TARGETSITE]" 
```

您可能只是从用户界面中删除安装地址，并设置一个将信息传递给自定义安装的组件

*   使用 msbuildtasks 在 msbuild 上编写一个包装器

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-11-25T08:50:11.797

对我来说 VS

1.  右键单击设置项目

2.  查看 -> 文件系统

3.  Web 应用程序文件夹（在左窗格中）

4.  在属性窗口中（右下角）

5.  虚拟目录（最后一个）

    在这里，您可以更改/设置 IIS 上的默认路径，即可以安装的目标目录。

# .net - 我的 System.Xml.Linq 库有问题吗？

> ID：714321
> 
> 赞同：18
> 
> 时间：2009-04-03T15:02:51.437
> 
> 标签：.net, linq, dll

我正在尝试学习一些 Linq to XML 的东西，我在 XElement 中遇到了 XPathSelectElement 函数。这个功能似乎正是我需要的，但由于某种原因，我不能使用它！查看我的代码：

```
 XElement rootElement = XElement.Load(dataFile);
        XElement parentElement = rootElement.XPathSelectElement(xPath); 
```

我在任何需要的地方都包含了对 System.Xml.Linq 的引用。我尝试过的该库中的所有其他东西似乎都在工作，但 XPathSelectElement 甚至没有出现在 Visual Studio 的 Intellisense 中。

在构建上述代码时，我收到以下错误：

> 错误 1“System.Xml.Linq.XElement”不包含“XPathSelectElement”的定义，并且找不到接受“System.Xml.Linq.XElement”类型的第一个参数的扩展方法“XPathSelectElement”（您是否缺少使用指令还是程序集引用？） C:\PageHelpControl\PageHelp.cs 155 50 HelpControl

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-04-03T15:07:04.140

您尝试使用的方法是扩展方法。您需要包含 System.Xml.XPath 命名空间。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-04-03T15:13:40.253

只是为了将两个答案联系在一起......

[`XPathSelectElement`](http://msdn.microsoft.com/en-us/library/system.xml.xpath.extensions.xpathselectelement.aspx)是一种扩展方法。要将其*用作*扩展方法（即，就好像它是 on 的实例方法[`XNode`](http://msdn.microsoft.com/en-us/library/system.xml.linq.xnode.aspx)），您需要`using`在源代码中为相关命名空间添加一个指令：

```
using System.Xml.XPath; 
```

（这就是[`Extensions`](http://msdn.microsoft.com/en-us/library/system.xml.xpath.extensions.aspx)包含扩展方法的类所在的地方。）

This works in the same way that you need `using System.Linq;` in your code before you can use `Select`, `Where` etc on `IEnumerable<T>`.

# javascript - 我想动态地将事件附加到链接。但是 onclick attach 不起作用

> ID：714323
> 
> 赞同：0
> 
> 时间：2009-04-03T15:03:15.147
> 
> 标签：javascript, greasemonkey

所以我正在为这个网站编写一个 Greasemonkey 脚本。无论如何，我的问题是我无法将 onclick 事件附加到我新创建的锚点中。

我不知道出了什么问题，也许是因为我在 Greasemonkey 这就是为什么它没有按预期工作？

```
function createButton() {
    var a = document.createElement('a');
    var css = document.createElement('style');
    css.type = 'text/css';
    css.innerHTML = '#prt { position:absolute; right:3em; top: 6em; font-family: Arial,Helvetica,sans-serif; font-weight:bold; font-size:125%; background: #777777 none repeat scroll 0 0; color: white; padding: 6px 12px;}'
    a.href = '#';
    a.innerHTML = 'Print Topic';
    a.id = 'prt';
    a.onclick = getTopic; // DOESN'T WORK
    document.body.insertBefore(a, document.body.lastChild);
    document.body.appendChild(css);
} 
```

我尝试了其他技术，例如 setAttribute

```
a.setAttribute('onclick', function() { alert("hey"); }); 
```

setAttribute 也没有工作..

怎么会？？

大家好，

我让它工作了。有人在 IRC #greasemonkey 上帮助了我。谢谢 broquaint！

因此，使用 setAttribute 或元素的 .onclick 属性的问题是，greasemonkey 不支持它们，而是会在 JavaScript 控制台中返回“组件不可用”错误。

如果您在使用之前遇到过这个问题

```
element.addEventListener ('click', myClickHandler, false); 
```

这是维基：[http ://wiki.greasespot.net/XPCNativeWrapper#Event_Handlers](http://wiki.greasespot.net/XPCNativeWrapper#Event_Handlers)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T15:22:13.777

使用锚点的 attachEvent 方法——

`a.attachEvent(getTopic)`

编辑 - attachEvent 仅限 IE。对于 Firefox，您必须使用 addEventListener -

`a.addEventListener(getTopic)`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T15:23:12.963

尝试将其包装在匿名函数中

```
a.onclick = function(){
    getTopic();
} 
```

# apache - 仅允许来自特定 IP 的请求

> ID：714332
> 
> 赞同：23
> 
> 时间：2009-04-03T15:04:42.460
> 
> 标签：apache, unix, accessibility

我有应用程序托管 Apache UNIX，我允许用户从 citrix 环境（从 citrix 机器）访问应用程序 url。

但是，目前可以从所有连接的机器访问 url。我想限制它只能从 citrix 机器访问。因此，如果有人需要访问它，他需要访问 citrix 机器。

我试过以下：

```
<Directory /APP>

    Order Deny,Allow

    Deny from all

    Allow from 160.120.25.65

    Allow from 127

</Directory> 
```

它没有用。有什么建议吗？

很少有人回答 iptables 解决方案，但是这个解决方案是在 Solaris 上加载的（它没有内置的防火墙作为 linux 操作系统）。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-04-03T15:22:51.653

这应该做你需要的：

```
<Directory /APP>

    Order Allow,Deny

    Allow from 160.120.25.65
    Allow from 127.0.0.0/8

</Directory> 
```

有关详细信息，请参阅[`mod_authz_host`](http://httpd.apache.org/docs/2.2/en/mod/mod_authz_host.html)文档。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-03T15:11:11.383

你运行的是什么版本的 Apache？IP 允许机制是 AFAIK，由 mod_authz_host 提供，它是在 2.2 中引入的（从技术上讲，是 2.1）。如果您确实有 2.2，请确保它没有在禁用[mod_authz_host的情况下编译。](http://httpd.apache.org/docs/2.2/mod/mod_authz_host.html)

不过，一般来说，您可能会发现一个更简单、更强大的解决方案是其他答案中建议的 iptables 或其他防火墙。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T18:13:09.417

为此，我建议使用 Iptables。在 iptables 中放置一条规则，无论目标端口是 apache 机器的端口号，源 ip 是 critix 机器的 IP 地址，linux 机器都应该丢弃该数据包。如果您的机器的 apache 上没有托管其他应该对所有 ips 开放的应用程序，这种方式将解决您的问题。透视规则的一个例子可能是：-

```
iptables -I INPUT 1 -s 160.120.25.65 -d <port_of_apache_on_your_machine> -j DROP 
```

这应该可以解决您的问题，一旦您用正确的值替换

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-04-03T15:06:23.393

我可能会为此使用 iptables 规则。我不确定您发布的示例是什么，但是您应该能够配置几乎任何防火墙以按照您的意愿工作。

# java - 为Java应用程序筛选格式不正确的XHTML页面的最佳方法是什么

> ID：714335
> 
> 赞同：4
> 
> 时间：2009-04-03T15:04:59.993
> 
> 标签：java, regex, xpath, screen-scraping, xquery

我希望能够从网页中抓取内容，尤其是其中的标签和内容。我已经尝试过 XQuery 和 XPath，但它们似乎不适用于格式错误的 XHTML，而 REGEX 只是一种痛苦。

有没有更好的解决方案。理想情况下，我希望能够请求所有链接并返回一组 URL，或者请求链接的文本并返回包含链接文本的字符串数组，或者请求所有粗体文本等等

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-03T15:09:45.833

[通过JTidy](http://jtidy.sourceforge.net/)之类的东西运行 XHTML ，它应该会返回有效的 XML。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-03T15:10:20.573

你可能想看看[Watij](http://watij.com/)。我只使用了它的 Ruby 表亲 Watir，但有了它，我能够加载一个网页并以您描述的方式请求该页面的所有 URL。

使用起来非常容易——它确实会启动一个网络浏览器，并以漂亮的形式为您提供信息。IE 支持似乎最好，但至少 Watir 也支持 Firefox。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-03T15:12:51.100

那天我在使用 JTidy 时遇到了一些问题。我认为这与导致 JTidy 失败的未关闭标签有关。不知道现在修好了没有。我最终使用了[TagSoup](http://home.ccil.org/~cowan/XML/tagsoup/)的包装器，尽管我不记得确切的项目名称。还有[HTMLCleaner](http://htmlcleaner.sourceforge.net/)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-03T18:53:48.837

我用过[http://htmlparser.sourceforge.net/](http://htmlparser.sourceforge.net/)。它可以解析格式不正确的 html，并且可以很容易地提取数据。

# java - Tomcat/Linux 上的 UTF-8 和 Servlet

> ID：714339
> 
> 赞同：2
> 
> 时间：2009-04-03T15:05:37.560
> 
> 标签：java, tomcat, encoding, servlets, utf-8

我在 Tomcat 6 / Linux 上从 servlet 读取和写入 UTF-8 时遇到了一些问题。请求和响应是 utf-8，浏览器是 utf-8，URIEncoding 在连接器和主机上的 server.xml 中设置。简而言之，代码本身对我来说所有已知的东西，服务器配置都是 utf-8。

读取请求时，我不得不从 String 中获取字节数组，然后将该字节数组再次转换为 String。写请求时，我必须写字节，而不是字符串本身，才能得到正确的响应（否则我会得到一个异常，指出某些非 ASCII 字符不是有效的 ISO 8859-1）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-03T18:53:43.067

更改 LANG 环境变量是解决问题的一种方法。

官方的方法是在sevlet过滤器中设置字符编码：[http ://wiki.apache.org/tomcat/Tomcat/UTF-8](http://wiki.apache.org/tomcat/Tomcat/UTF-8)

一些背景资料：[http ://www.crazysquirrel.com/computing/general/form-encoding.jspx](http://www.crazysquirrel.com/computing/general/form-encoding.jspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T15:10:06.160

解决方案是将 LANG 环境变量设置为（在我的情况下）en_US.UTF-8，或者可能是任何其他 UTF-8 语言环境。我仍然对这样一个事实感到困惑，即我无法从代码中做任何事情来使我的 servlet 正常运行。如果没有办法做到这一点，那么从我的角度来看，这是一个错误。

# c# - 具有强类型局部视图的 HandleError

> ID：714342
> 
> 赞同：0
> 
> 时间：2009-04-03T15:06:09.320
> 
> 标签：c#, asp.net-mvc

今天早上我遇到了 HandleError 的一个小障碍。用户被正确定向到 /Views/Shared/Error.aspx。此视图使用一个母版页，它也显示得很好。它还在其 Page_Load 方法中记录 ViewData.Model.Exception 的详细信息。在我看来，代码隐藏的使用是可以接受的。

我的问题是：该页面包含一个强类型的部分视图，其中包含一些用户的输入数据。即使发生异常，我也希望保留对该数据的访问权限 - 因此用户不会因我们的异常而受到双重惩罚（显示错误消息并丢失其表单值）。

有没有办法使用 HandleError 或其他可重用属性来完成此操作？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-03T16:59:59.483

我解决这个问题的方法是使用`Ajax.BeginForm(){}`和渲染用户控件，这样您的视图不会刷新并且您的输入不会丢失。如果你的错误信息是严格输入限制那么你也可以使用`jquery.validate.js`文件可以在这里找到[http://randomactsofcoding.blogspot.com/2008/09/starting-with-jquery-validation-plug-in.html](http://randomactsofcoding.blogspot.com/2008/09/starting-with-jquery-validation-plug-in.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-26T02:43:05.460

最简单的解决方案是后退按钮，它不需要代码:-)

如果您需要基于代码的解决方案，我认为您必须在用户登陆 Error.aspx 之前保留您的表单数据。此时发生了重定向，所有请求数据都将丢失。然后，当用户导航到错误视图时，您可以从持久值中恢复表单。

Error.aspx 是一个一般错误页面，也是您最后的手段。这个页面甚至不应该尝试做任何超出一般错误处理的任务。

# python - 如何通过 Python 执行任意 shell 脚本并传递多个变量？

> ID：714360
> 
> 赞同：2
> 
> 时间：2009-04-03T15:10:32.837
> 
> 标签：python, ruby, macos, shell, environment-variables

我正在用 Python 构建一个应用程序插件，它允许用户使用简单的脚本（在 Mac OS X 下工作）任意扩展应用程序。执行 Python 脚本很容易，但有些用户更喜欢 Ruby 等语言。

根据我的阅读，我可以使用`subprocess`管道轻松执行 Ruby 脚本（或其他任意 shell 脚本）并捕获它们的输出；这不是问题，网上有很多例子。但是，我需要为脚本提供多个变量（比如一段文本以及一些关于脚本正在修改的文本的简单布尔信息），我无法找出最好的方法来做到这一点。

有没有人建议最好的方法来实现这一点？我的目标是用最少的代码为脚本提供他们需要的信息，以便在脚本中访问该信息。

提前致谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-03T15:16:32.587

请参阅[http://docs.python.org/library/subprocess.html#using-the-subprocess-module](http://docs.python.org/library/subprocess.html#using-the-subprocess-module)

> args 应该是一个字符串，或一系列程序参数。要执行的程序通常是 args 序列中的第一项，如果给定了字符串，则为字符串，但可以使用可执行参数显式设置。

所以，你的电话可能看起来像这样

```
p = subprocess.Popen( args=["script.sh", "-p", p_opt, "-v", v_opt, arg1, arg2] ) 
```

您已将任意 Python 值放入`subprocess.Popen`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T15:37:09.433

如果您要启动多个脚本并且需要将相同的信息传递给每个脚本，您可以考虑使用环境（警告，我不懂 Python，所以下面的代码很可能很糟糕）：

```
#!/usr/bin/python 

import os

try:
    #if environment is set
    if os.environ["child"] == "1":
        print os.environ["string"]
except:
    #set environment
    os.environ["child"]  = "1"
    os.environ["string"] = "hello world"

    #run this program 5 times as a child process
    for n in range(1, 5):
        os.system(__file__) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-05T07:48:15.237

您可以采用的一种方法是使用 json 作为父脚本和子脚本之间的协议，因为 json 支持在许多语言中很容易获得，并且具有相当的表现力。您还可以使用管道将任意数量的数据发送到子进程，假设您的要求允许您从标准输入读取子脚本。例如，父母可以做类似的事情（显示 Python 2.6）：

```
#!/usr/bin/env python

import json
import subprocess

data_for_child = {
    'text' : 'Twas brillig...',
    'flag1' : False,
    'flag2' : True
}

child = subprocess.Popen(["./childscript"], stdin=subprocess.PIPE)
json.dump(data_for_child, child.stdin) 
```

这是一个子脚本的草图：

```
#!/usr/bin/env python
# Imagine this were written in a different language.

import json
import sys

d = json.load(sys.stdin)
print d 
```

在这个简单的示例中，输出为：

```
$ ./foo12.py
{u'text': u'Twas brillig...', u'flag2': True, u'flag1': False}

```

# python - 尽快将 ctypes 数据转换为 python 字符串

> ID：714367
> 
> 赞同：3
> 
> 时间：2009-04-03T15:11:15.800
> 
> 标签：python, pyqt4, ctypes

我正在尝试在 PyQt4 中编写一个视频应用程序，并且我已经使用 Python ctypes 连接到一个旧的遗留视频解码器库。该库为我提供了 32 位 ARGB 数据，我需要将其转换为 QImage。我的工作方式如下：

```
 # Copy the rgb image data from the pointer into the buffer
memmove(self.rgb_buffer, self.rgb_buffer_ptr, self.buffer_size)

# Copy the buffer to a python string
imgdata = ""
for a in self.rgb_buffer:
    imgdata = imgdata + a

# Create a QImage from the string data
img = QImage(imgdata, 720, 288, QImage.Format_ARGB32) 
```

问题是ctypes将数据输出为“ `ctypes.c_char_Array_829440`”类型，我需要将其转换为python字符串，以便我可以构造一个QImage。我的复制机制目前每张图像需要将近 300 毫秒，因此速度非常慢。该过程的解码和显示部分只需要大约50ms。

谁能想到我可以采取任何巧妙的捷径来加快这个过程并避免像我目前正在做的那样复制缓冲区两次？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-03T16:38:18.413

该`ctypes.c_char_Array_829400`实例具有`.raw`返回可能包含 NUL 字节的字符串的属性，`.value`以及返回字符串到第一个 NUL 字节（如果它包含一个或多个字节）的属性。

但是，您也可以使用 ctypes 访问字符串`self.rgb_buffer_ptr`，如下所示 `ctypes.string_at(self.rgb_buffer_ptr, self.buffer_size)`：这将避免对 memmove 调用的需要。

# c# - GlobalAssemblyInfo.cs 和强命名

> ID：714368
> 
> 赞同：7
> 
> 时间：2009-04-03T15:11:29.620
> 
> 标签：c#, .net, configuration-management

我的解决方案的根目录中有一个 GlobalAssemblyInfo.cs 文件，其中有类似以下条目的内容，以启用对输出程序集的强命名。

```
#pragma warning disable 1699
[assembly : AssemblyKeyFile("..\\keyfile.snk")]
#pragma warning restore 1699 
```

这种方法有两个缺点。首先，AssemblyKeyFileAttribute 已被弃用，因此为了避免编译警告，我需要您在上面看到的编译指示行。其次，我要么需要将我的所有项目相对于根目录保持相同的深度以使用相对路径，要么使用绝对路径，这决定了其他用户机器（以及持续集成服务器/构建代理）上的结帐位置.

除了在项目文件中通过每个项目设置强命名之外，有没有人有比这更好的解决方案？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T15:18:40.757

好吧，为了避免路径问题，您可以`[assembly:AssemblyKeyName(...)]`改用（尽管 IIRC 这也已被弃用）；用于`sn -i`安装命名密钥。每台机器（进行构建）都需要添加此密钥。

除此之外; 是的，您可能需要编辑项目文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T15:32:15.030

出于充分的理由（信息泄漏），不推荐使用密钥签名的这些属性，这是采用项目路线的另一个原因。

如果您有很多项目，则可以通过录制的宏来设置它们，甚至可以直接操作 .csproj 文件（确保它们首先从 VS 中卸载）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T16:07:54.087

Richard 对信息泄露提出了一个很好的观点——我现在找到了来自 Microsoft .NET 团队的帖子，他们在其中描述了这一点。所以我接受了他的建议并提出了以下 NAnt 目标：

```
 <target name="strongName" description="Strong names the output DLLs">
    <foreach item="File" property="filename">
      <in>
        <items>
          <include name="**/*.csproj"></include>
          <exclude name="**/*.Test.csproj"></include>
        </items>
      </in>
      <do>
        <echo message="${filename}" />
        <xmlpoke file="${filename}" xpath="/m:Project/m:PropertyGroup/m:SignAssembly" value="false">
          <namespaces>
            <namespace prefix="m" uri="http://schemas.microsoft.com/developer/msbuild/2003" />
          </namespaces>
        </xmlpoke>
        <xmlpoke file="${filename}" xpath="/m:Project/m:PropertyGroup/m:AssemblyOriginatorKeyFile" value="..\keyfile.snk">
          <namespaces>
            <namespace prefix="m" uri="http://schemas.microsoft.com/developer/msbuild/2003" />
          </namespaces>
        </xmlpoke>
      </do>
    </foreach>
  </target> 
```

<namespaces> 元素对于在 csproj 文件中解析 XPath 是必需的 - 请注意，这是针对 VS2008 的，在 VS2005 中可能需要稍微不同的东西。

# flash - Flash 和 SharePoint

> ID：714370
> 
> 赞同：2
> 
> 时间：2009-04-03T15:12:34.877
> 
> 标签：flash, sharepoint

我有一个要在 SharePoint 中集成的 flash 控件，并且想知道从列表中读取以便在 flash 控件中显示项目的最佳方式是什么？

欢迎代码示例/想法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-06T04:25:57.383

我认为从 Flash 控件的列表中检索项目的最简单方法是通过 SharePoint 的[Lists Web Service](http://msdn.microsoft.com/en-us/library/lists.aspx)。具体来说，[GetListItems 方法](http://msdn.microsoft.com/en-us/library/lists.lists.getlistitems.aspx)可用于根据[CAML 查询检索列表项（或列表项中的某些字段）](http://msdn.microsoft.com/en-us/library/ms467521.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-17T04:49:02.313

我编写了一个自定义 ASPX 页面，它以 XML 形式发出列表数据。Flash 开发人员调用此 ASPX 并使用 xml 来填充他的 Flash 控件。我对Flash一无所知，但显然它可以操纵XML。

代码非常简单：

*   打开列表（列表名称在查询字符串中传递给 aspx）
*   选择您需要的列表项（如果不是全部）
*   转换为 xml（我使用）
*   确保将页面的响应类型设置为 XML

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T19:18:41.430

在 SDK 之后的源代码中有一个 C# 示例，说明如何编写自定义字段控件 - 我知道，因为我在 2006 年一直纠缠 MS 以获取此示例，直到他们对其进行编码以使我闭嘴 ;-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-08T04:11:44.343

好吧，我可以告诉你如何不这样做，除非你必须这样做，我做到了。我们的客户想要一个动态的 Flash 作品，但我们的 IT 只给我们基本的作者访问权限。

使用列表的 RSS 提要输出，我能够将列表的自定义字段以 XML 格式保存到 Flash 中。问题是，SharePoint 将任何非标准 RSS 字段（在我的例子中几乎全部）放入 RSS 标记中。因此，您需要对内容进行一些解析才能使其正常工作。非常丑陋，但最终奏效了。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2009-04-07T02:08:56.877

如果您想要代码，“codeproject”可能是一个好地方。我没有使用它的任何代码，因此，我不知道是否稳定。

# javascript - 获取 dom 元素的最快方法是什么？

> ID：714375
> 
> 赞同：6
> 
> 时间：2009-04-03T15:13:01.177
> 
> 标签：javascript, jquery, dom

我正在调整我的代码的性能，并且惊讶地发现瓶颈不是 dom 节点插入，而是选择。

这很快：

```
var row = jquery(rowHTML).appendTo(oThis.parentTable); 
```

但是随后在“行”中获取元素的速度很慢：

```
var checkbox = jquery(".checkbox input", row); 
```

我需要在每一行中获取复选框，以便将事件处理程序附加到它。选中该复选框几乎是插入整个父行的 10 倍。

我在这里做错了什么？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-04T01:35:50.353

DOM 操作使用本机函数来执行简单的操作。浏览器供应商优化这些。您正在从 HTML 构建行。在内部，jQuery`.innerHTML`用于构建集合，然后将其修补到浏览器的超高速解析器中。

选择比较慢，因为 JS 代码需要反复循环遍历 DOM。较新的浏览器具有本机选择处理，这为基于选择器的 JS 提供了显着的加速。随着时间的推移，这将不再是一个问题。

以下是有问题的查询如何`$(".checkbox input", row)`分解：

1.  `row.getElementsByTagName('*');`
2.  for 循环遍历返回的每个元素（行内的所有元素）并`elements[i].className`使用`/(\s|^)checkbox(\s|$)/`.
3.  for-循环每个仍然剩余的元素并收集`matched[i].getElementsByTagName('input');`
4.  独特的最终集合。

这与 jQuery 1.3 不同，因为它的引擎以相反的方式在选择器中移动，从获取所有输入元素开始，然后测试父元素。

请记住，JS 选择器引擎实现的 CSS 选择器规范比实际可用于 CSS（或由当前浏览器实现）的要多得多。利用这一点，以及对引擎的了解，我们可以优化选择器，可以通过几种不同的方式进行优化：

**如果您知道这`.checkbox`是什么元素类型：**

```
$("td.checkbox input", row); 
```

先过滤类型然后再过滤那些匹配的类会更快。这不适用于非常小的元素子集，但在实践中几乎从未如此。

单类测试是[人们实际使用的常见选择器](http://ejohn.org/blog/selectors-that-people-actually-use/)中最慢的。

**更简单的选择：**

```
$("input[type=checkbox]", row); 
```

一个循环比两个循环快。这只会找到输入元素，然后直接按类型属性过滤它们。由于从不使用子/子元素，因此也可能会跳过唯一性（智能引擎会尝试这样做，因为唯一性很慢）。

**更直接的选择器：**

```
$("td:first.checkbox input", row); 
```

如果更直接（YMMV），更复杂的选择器实际上可能更快。

**如果可能，将搜索上下文移动到表级别：**

我的意思是，与其循环遍历行，并在每一行中搜索复选框，不如将它们单独放置，直到循环结束，然后一次选择它们：

```
$("tr td:first.checkbox input", table); 
```

这样做的目的是消除重复启动选择器引擎的开销，而是一次完成所有事情。这是为了完整性，而不是我认为会带来巨大加速的东西。

**不要选择：**

从位构建行，随时分配事件。

```
var row = $( '<tr></tr>' );
var cell = $( '<td class="checkbox"></td>' ).appendTo( row );
$( '<input type="checkbox" name="..."/>' ).appendTo( cell ).click(/* ... */); 
```

由于 Ajax 或您无法控制的其他模板，这可能是不可能的。此外，速度可能不值得将您的代码变成这种混乱，但有时这可能是有道理的。

或者，如果这些都不适合您，或者返回的性能提升太大，那么可能是时候重新考虑该方法了。您可以在树的上方分配一个事件侦听器并在那里获取事件，而不是每个元素的实例：

```
$('table').change(function(e){
  // you may want a faster check...
  if ( $(e.target).is('input[type=checkbox]') ) {
    // do some stuff ...
  }
}); 
```

这样，除非并且直到用户实际请求它，否则您不会做任何事情。最快的。:-)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-03T15:16:30.683

```
var checkbox = jquery(".checkbox input", row); 
```

这是遍历整个 dom 树以找到复选框。您可以通过将选择器更改为可以使用浏览器本机 getElementById 功能的 ID 来加速它。

```
var checkbox = jquery("#checkbox input", row); 
```

您还可以使用您的行作为 DOM 搜索的起点，如下例所示。现在您不再解析整个 DOM 树来查找匹配的元素。

```
var row = jquery(rowHTML).appendTo(oThis.parentTable);
row.children(".checkbox input"); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-03T15:18:46.483

使用事件委托并将单个处理程序添加到父元素而不是复选框本身。

jQuery 通过[`live()`](http://docs.jquery.com/Events/live)函数支持这一点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-03T15:15:51.200

尝试在输入字段本身上放置一个类名。这可能会更快。

原因是您的代码遍历所有 .checkbox 类，尝试找到该元素的输入子元素并返回它。我认为那个动作可能是你的罪魁祸首。

通过简单地查找输入字段具有的类的所有元素，您可能会看到一些加速。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-03T15:17:26.987

尝试使用[Sly](http://digitarald.de/journal/89737433/rolling-out-sly-the-javascript-selector-engine/)，它强调性能。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-03T15:31:03.160

如果您正在寻找性能，jQuery 选择器非常慢。在那里的示例中，它必须扫描完整的 DOM 树并检查 CSS 类等以找到相关节点。

使用本机 DOM 方法要快得多。这里有一些有趣的库性能比较：

[http://ajaxian.com/archives/taskspeed-more-benchmarks-for-the-libraries-and-browsers](http://ajaxian.com/archives/taskspeed-more-benchmarks-for-the-libraries-and-browsers)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-02-01T22:28:26.303

获取 DOM 元素最快的方法是使用纯 JavaScript 并通过 ID 调用它。

```
var element = document.getElementById('element); 
```

# html - HTML、列和 'div's

> ID：714384
> 
> 赞同：0
> 
> 时间：2009-04-03T15:14:37.443
> 
> 标签：html, css

我正在使用 HTML。我将页面分为两列：inner1 和inner2。

*   `Inner1`有一些数据，它没有列1中的问题。
*   `Inner2`有一个问题：由于Inner2被分成了两行[in the same column2]
*   `point2`- 它有可变数据[row -1]
*   `another_new`- 它有固定的数据[row-2]

### HTML：

```
<div id="outer">
    <div id="inner1">
        <div id="point1">
        </div>
        <div id="response">
        </div>
    </div>
<div id="inner2">
    <div id="point2"> <!-- Variable data -->
    </div>
    <div id="another_new"> <!-- Fixed data -->
    </div>
    </div>
</div> 
```

### CSS：

```
#inner1{
    float : left;
    width :61%;
}
#inner2{
    float :right;
    width :39%;
} 
```

如何显示页面？`Point2`数据不应与`another_new`数据重叠。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-03T20:24:53.907

非常欢迎您将一列向左浮动，另一列向右浮动。您的问题很可能来自您使用 100% 的宽度这一事实。如果这些 div 有任何与它们相关的边距或边框，则可能会导致它们比您预期的要宽，因此不能并排放置。即使没有边距/边框，某些浏览器也会遇到问题。尝试将其中一列的宽度减小 1% 左右。

另一种可能性是 clear 属性。确保两列都有明确的：无；应用于他们。或者，您可以应用 clear: left; 向左列，并明确：右；到右列。

根据具体情况和使用的浏览器，在您的两列*之后有一个“后续” div 也可能会有所帮助：*

```
<div class="col1"></div>
<div class="col2"></div>
<div class="clearBoth"></div>

div.clearBoth
{
   clear: both;
   height: 0px;
   overflow: hidden;
   margin: 0px;
   padding: 0px;
} 
```

此外，您可能对 CSS 的 clearFix 技巧感兴趣：[这里](http://www.positioniseverything.net/easyclearing.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T15:36:23.103

更改您的 CSS，使两列都设置为`float: left;`. 这将使您的列一个接一个地堆叠。

您可能还必须减小您在此处给出的宽度。某些浏览器，如 Internet Explorer，往往不喜欢 100% (61% + 39%) 的宽度，因此会导致最右边的浮动项目换行到下一行。

我只是猜测这是你的问题:o)

您也可以尝试添加 CSS，

```
clear: both; 
```

到 div 'another_new'。无论 point2 有多大，这都会将其推到“point2”以下。

# .net - iManage ImportCmd 启动 Word 的新实例

> ID：714388
> 
> 赞同：0
> 
> 时间：2009-04-03T15:15:27.800
> 
> 标签：.net, vb.net, vsto, imanage

我正在尝试使用 IMANEXTLib 中的 ImportCmd 将 Word 文档保存到 iManage 中，并且每次运行它时都会获得一个新的 Word 实例。

我已将文档保存到 doc1.doc，然后：

```
 'Connects to WorkSite
    Dim dmsConnection As IManage.IManDMS = New IManage.ManDMSClass()
    dmsConnection.ApplicationName = "My Application"
    Dim sesCobbDms As IManage.IManSession = dmsConnection.Sessions.Add("DMS")
    sesCobbDms.TrustedLogin()

    'Initialisation
    Dim hwndWord As Integer
    Dim strTempCaption As String = Application.Caption
    Application.Caption = "Hunting For Word"
    hwndWord = MyApi.FindWindow("OpusApp", Application.Caption)
    Application.Caption = strTempCaption
    Dim intKeepCheckedOut As Integer
    Dim docJustSaved As IManage.NRTDocument
    Dim objImportCmd As IMANEXTLib.ImportCmd
    Dim objContextItems As New IMANEXTLib.ContextItems

    'Sets up ContextItems ready for save process
    objContextItems.Add("ParentWindow", hwndWord)
    objContextItems.Add("DestinationObject", sesCobbDms)
    objContextItems.Add("IManExt.Import.FileName", NrPort & "\Doc1.doc")
    'Note that we have to check it in and then back out again, otherwise it checks out to the wrong place
    intKeepCheckedOut = IManage.CheckinOptions.nrDontKeepCheckedOut
    objContextItems.Add("IManExt.Import.KeepCheckedOut", intKeepCheckedOut)
    'Forces a blank description
    objContextItems.Add("ImanExt.Import.DocDescription", "")

    objImportCmd = New IMANEXTLib.ImportCmd
    objImportCmd.Initialize(objContextItems)
    objImportCmd.Update()

    If objImportCmd.Status = IMANEXTLib.CommandStatus.nrActiveCommand Then
        'Imports the document, throwing a Save As screen at the user
        objImportCmd.Execute() 
```

在这一点上，我得到了一个新的 Word 实例，位于我从中保存的那个之上（即，在 Application 之上）。是什么赋予了？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-14T14:32:48.940

只是为了提供解决方案，我注意到问题仅发生在一个用户帐户（我的）下，然后我删除了我的用户配置文件。我的闪亮！新的！profile 没有同样的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T15:52:34.687

我希望这看起来不像是逃避，但我会联系 Interwoven 支持（或本月将其买断的任何人）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-05-20T22:56:49.580

您可以尝试使用`save`iManage 以外的命令。为了进行测试，您可以创建一个演示 word 文档，然后尝试从`MS WORD`应用程序本身保存 word 文档，以检查哪个弹出窗口可见。如果文档以所需的正常行为保存，则表示您的代码存在问题，但如果再次打开新单词应用程序，则说明您的应用程序存在问题。

您可以尝试两者`Save As`并`local Save As`在应用程序中使用 iManage `MS WORD`。如果两者都可以正常工作，请尝试在您的代码中使用替代`save`命令。

# sql - 将 LINQ to SQL 与动态表一起使用

> ID：714401
> 
> 赞同：4
> 
> 时间：2009-04-03T15:17:41.337
> 
> 标签：sql, linq, dynamic

我正在尝试将一个旧项目迁移到使用 LINQ，但我遇到了一个相当大的问题。问题是我们有用于搜索索引的动态表（具有动态属性的 CM 系统）。搜索索引具有每个可搜索属性 { attribute_x, attribute_y, ... } 的列。现在的问题是我无法静态定义哪些列可用（甚至在我们划分搜索索引时使用哪个表），所以我需要一种动态执行此操作的方法。

我尝试过使用动态表达式，但它们仍然需要一个类型来构建表达式，而且我无法通过反射生成有效的类型。（似乎没有生成 MemberInfo）。

我也可以满足于生成一个搜索表达式（但我想这不是一件容易的事）。类似的东西

```
var mySearchIndex= db.GetTable(myTableType);
var query = from p in db.Products from idx in mySearchIndex;
查询=查询。哪里（
 “身份证。” + 属性名 + " > 50.0 &&
 idx。" + 属性名 + "
```

将是可取的。

有没有人遇到过这个问题的解决方案？在过去的两天里，我一直在浏览博客文章和论坛，但都是徒劳的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-03T15:55:12.527

您在 Linq to SQL 的设计之外工作，但我认为如果您**真的**需要，可以这样做。探索的最佳选择可能是您可以在上下文的构造函数中使用的 XmlMappingSource。在处理动态[表重命名](http://theruntime.com/blogs/jacob/archive/2008/08/27/changing-table-names-in-an-orm.aspx)时，我在这方面取得了一些成功。

在映射 XML 时，数据库上的**实际**列名是列元素的“名称”属性，而类属性是“成员”。如果您在 XML 中更改它，它应该适当地映射最终查询。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T15:23:18.453

您可能想尝试[Linq to Dataset](http://msdn.microsoft.com/en-us/library/bb386977.aspx)：

> LINQ to DataSet 使查询缓存在 DataSet 对象中的数据变得更加容易和快捷。具体来说，LINQ to DataSet 通过使开发人员能够从编程语言本身编写查询，而不是使用单独的查询语言来简化查询。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T15:23:38.810

我不相信使用 LINQ 可以解决这个问题。至少我从未听说过或发现过。如果表结构发生更改并且您每次都必须重新创建 DataModel，则 LINQ 会中断。

如果我不正确，我很想听听。:)

# objective-c - 如何将数组中的初始值设置为0

> ID：714403
> 
> 赞同：1
> 
> 时间：2009-04-03T15:18:16.670
> 
> 标签：objective-c

我需要跟踪 UITableView 中各个部分的行。为此，我想创建一个数组，在每个部分中放置一定数量的行。这个数组应该有一定的大小——所以我想使用 NSArray 而不是 NSMutableArray 会更好。

我的问题是 - 我如何用一定数量的 NSInteger 类型的对象初始化它，最初设置为 0？以及如何更改该数组-在我的特定情况下，以在需要时增加每个项目的价值？

例如：

```
while (objects)
{
 myArray.(object string's first letter transformed to int)++;
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T15:43:50.400

如果数组是特定大小且所有常规整数（在您的示例中为 NSInteger），为什么不使用简单的整数指针？例如：

```
- (id)init {
  if( (self = [super init]) ) {
    // assume this is an instance variable of type NSInteger *myArray;
    myArray = (NSInteger*)calloc(arraySize, sizeof(NSInteger));

    // Do any other initialization that you need
  }
  return self;
}

- (void)myMethod {
  // Do whatever you need
  while( objects ) { myArray[whatever]++; }
}

- (void)dealloc {
  free(myArray);
  [super dealloc];
} 
```

如果您的要求需要一个简单的、固定容量的数组，所有这些数组都由相同的原始类型组成，我认为简单的解决方案是最好的。如果数组的长度永远不会改变（即，您在编译时知道长度），您可以使用 NSInteger 数组作为实例变量而不是指针，这样您就不必处理分配内存或释放它。此外，在这种情况下，您将自动获得一个归零的数组。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T15:22:20.903

```
NSMutableArray *a = [[NSMutableArray alloc] init];
int i;

for (i = 0; i < ...; ++i)
    [a addObject:[NSNumber numberWithInt:0]]; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T15:36:43.413

当您需要更改数组时，您需要使用可变数组而不是不可变数组。

如果你需要初始化一个包含 10 个项目的数组，你可以这样写：

```
NSMutableArray *mutableArray = [NSMutableArray arrayWithCapacity:10];

for (NSUInteger i = 0; i < 10; i++) {
    [mutableArray insertObject:[NSNumber numberWithInt:0] atIndex:i];
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-03T15:23:05.473

您必须像这样遍历整个数组：

```
for ( var key in list ) {
   list[key] = // Your new object here;
} 
```

# c# - 是否可以使用 C# 创建持久的 ODBC 连接？

> ID：714411
> 
> 赞同：0
> 
> 时间：2009-04-03T15:19:03.003
> 
> 标签：c#, odbc

我没有尝试创建要在我的应用程序中使用的 ODBC 连接。我正在使用另一种脚本语言（我别无选择），它使用 odbcad32（Microsoft ODBC 源管理器）中定义的本地 ODBC 连接。我想以编程方式更改 odbcad32 中的服务器，然后使用新信息调用脚本来完成它的工作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-03T15:44:29.680

我不确定这是否是最好的方法，但您可以简单地在保存文件数据源的目录中创建一个 .dsn 文件。在我的例子中是 C:\Program Files\Common Files\ODBC\Data Sources。

这些文件只是看起来像这样的文本文件：

```
[ODBC]
DRIVER=SQL Server
UID=myName
Trusted_Connection=Yes
DATABASE=Test
WSID=ServerName
APP=Microsoft Data Access Components
SERVER=(local) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T15:25:37.527

听起来您希望通过您选择的 DBMS 从您选择的语言中获得一个工作队列，并因此运行 C# 代码。如果您在 Windows 或其他支持消息队列系统的地方使用语言（未指定），这可能是您最好的选择。简短的回答是，是的，您可以保持持久连接。使用 MS-SQL 2005+，您甚至可以创建用 C# 编写的嵌入式代码来响应事件和函数。

如果您想要更具体的答案，问一个更具体的问题会有所帮助。

# weblogic - 使用无状态会话 bean 后，MDB 是否应该调用 remove()？

> ID：714412
> 
> 赞同：2
> 
> 时间：2009-04-03T15:19:05.920
> 
> 标签：weblogic, ejb, jboss-mdb, stateless-session-bean

我们多年前的 WebLogic J2EE 应用程序有一个使用无状态会话 bean 的消息驱动 bean。MDB onMessage 方法获取无状态会话 bean 的 home 接口，并调用 home 接口的`create()`方法来获取实际的无状态会话 bean 本身。

代码不会尝试缓存会话 bean，只是直接使用它：

```
public void onMessage(Message message) 
{
    ...
    MySessionBeanLocal ejbLocal = MySessionBeanLocalHome.create();
    ejbLocal.myMethod(); 
```

MDB中没有对应`remove()`的调用。

我的问题是：在这种情况下不打电话是不是很糟糕`remove()`？

我相当确定需要调用`remove()`一个有状态的会话 bean，但是对于 state less 是否需要调用*对我来说**不太*清楚。`remove()`

 *我们最近进行了显着的性能改进，但突然开始在负载下耗尽有状态会话 bean，但有以下异常：

```
java.lang.RuntimeException: An invocation of EJB MyMessageDrivenBean(Application: 
MyApplication, EJBComponent: MyApplication.jar) timed out while waiting to get an instance from the free pool.
    at weblogic.ejb20.pool.StatelessSessionPool.waitForBean(StatelessSessionPool.java:229)
    at weblogic.ejb20.pool.StatelessSessionPool.getBean(StatelessSessionPool.java:100)
    at weblogic.ejb20.manager.StatelessManager.preInvoke(StatelessManager.java:140)
    at weblogic.ejb20.internal.BaseEJBLocalObject.preInvoke(BaseEJBLocalObject.java:228)
    at weblogic.ejb20.internal.StatelessEJBLocalObject.preInvoke(StatelessEJBLocalObject.java:53)
    at MyMessageDrivenBean_x56omo_ELOImpl.processMessage(MyMessageDrivenBean_x56omo_ELOImpl.java:28)
    at MyMessageDrivenBean.onMessage(TBMessageListener.java:94)
    at weblogic.ejb20.internal.MDListener.execute(MDListener.java:370)
    at weblogic.ejb20.internal.MDListener.onMessage(MDListener.java:262)
    at weblogic.jms.client.JMSSession.onMessage(JMSSession.java:2678) 
```

我们的 MDB 池设置为：

```
<message-driven-descriptor>
<pool>
    <max-beans-in-free-pool>20</max-beans-in-free-pool>
    <initial-beans-in-free-pool>5</initial-beans-in-free-pool> 
```

我们的无状态会话 bean 池设置为：

```
<stateless-session-descriptor>
<pool>
     <max-beans-in-free-pool>50</max-beans-in-free-pool>
     <initial-beans-in-free-pool>5</initial-beans-in-free-pool> 
```

我的问题是，调用`create()`无状态会话 bean 的 MDB 是否也负责调用无状态*会话*`remove()`bean ？（该应用程序似乎已经运行多年而没有调用，但我想知道提高吞吐量是否暴露了一个旧错误。）*`remove()`*

 ** * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-29T17:58:34.530

`remove()`在远程接口对象被垃圾处理后，无论如何都会调用该方法。

我认为没有 EJB 应用程序应该强制显式调用 remove() 方法，如果发生这种情况，可能是因为池太小了。当然，您调用 always using 进行微调，但这应该是一个例外，而不是规则。

# sql-server - 如何从工作室检测所有 sql server 实例？

> ID：714413
> 
> 赞同：2
> 
> 时间：2009-04-03T15:19:12.427
> 
> 标签：sql-server, sql-server-2005, multiple-instances

一个盒子上安装了多个 SQL Server 2005 实例。是否有可以从 Studio 运行的 T-SQL 查询来检测这些其他实例及其名称？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-03T19:32:40.973

我想出了一个骗子。它需要使用 xp_cmdshell 和 net start 命令。我对使用 net start 命令以及可能产生的负面影响一无所知。任何人都可以就此提出建议吗？

```
create table #test ( srvcs varchar(2000) )
;

insert into #test
exec master..xp_cmdshell 'net start'
;

select 
  substring( srvcs, charindex( '(', srvcs ) + 1, (charindex( ')', srvcs ) - charindex( '(', srvcs ) - 1) ) 
  as srvcs
from #test
where ltrim(srvcs) like '%SQL Server (%'
;

drop table #test
; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T15:26:49.380

我非常怀疑您可以运行一个查询来查找实例（您需要连接到一个才能运行查询），但是**SQL Server 外围应用配置**（在开始菜单--> Microsoft SQL Server 2005 --> 配置工具下）会显示您在给定机器上拥有的所有实例。

另一种方法可能是从代码中执行 - 请参阅[这篇文章](http://www.codeproject.com/KB/database/SubmitSQLInfoEnumerator.aspx)。

# vb.net - list.sort 在 vb.net 中不起作用

> ID：714419
> 
> 赞同：2
> 
> 时间：2009-04-03T15:21:09.550
> 
> 标签：vb.net, sorting

我有一个稍微奇怪的问题，我认为这很可能是由于我的愚蠢行为，但对于我（和我团队的其他成员）的一生来说，我看不到它。

我有一个包含我想要排序的通用列表属性的对象。我写了一个比较器类来为我做这件事，我用以下方式调用它：

```
baseObject.ListOfThings.Sort(new ThingComparer()) 
```

我已经调试了我的比较函数，它返回了正确的值。

但是在排序调用之后，列表保持不变。我是否错过了一些明显的事情，或者我需要做其他事情。

非常感谢

编辑：是的，我是个傻瓜，返回列表的属性每次访问时都会从头开始重新创建它。谢谢大家的帮助，我会努力学习在以后寻求帮助之前更好地检查事情

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-03T15:27:19.020

您的基础对象是否在每次访问时都重新创建列表？每次有人要求我帮助解决这个问题时，这都是问题所在。也许该属性正在调用数据库，在访问时构建列表等等......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T15:26:30.490

对我来说看起来很好。ListOfThings 属性是否可能返回基础列表的**副本？**

然后，您将对列表的副本进行排序，然后该副本丢失，并且在下次调用 ListOfThings 时，您将按原始顺序获得列表的新副本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T15:31:56.437

我不知道其余的代码，但是尝试这样的事情怎么样：

```
baseObject.ListOfThings.Sort(AddressOf ThingComparer) 
```

（假设您要调用共享函数）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-03T16:40:06.380

为了理解这里发生了什么，我们需要更多关于 ListOfThings 是如何实现的上下文。特别是我们需要知道

*   它是一个属性。如果是这样，请告诉我们获取方法
*   ListOfThings 的类型是什么

它似乎是一个属性，并且可以通过多种方式实现它，从而导致这种行为。例如，以下定义将导致您看到的确切行为

```
Public ReadOnly Property ListOfThings As List(Of Thing) 
  Get
    Return New List(Of Thing)(someInternalList)
  End Get
End Property 
```

# javascript - 如何在客户端存储持久数据

> ID：714420
> 
> 赞同：15
> 
> 时间：2009-04-03T15:21:10.923
> 
> 标签：javascript, persistence, storage, client-side

我需要以编程方式在客户端存储数据，而不必在每次页面加载时从服务器传输数据。我考虑为用户当前会话生成一个包含所需数据的动态 JavaScript 文件，并确保它被缓存，但这看起来真的很混乱，而且我可以想到这种方法有一些缺点。

如何在客户端存储持久数据？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2014-03-01T12:34:12.420

您可以使用[Web Storage API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API) ([`Window.localStorage`](https://developer.mozilla.org/en/docs/Web/API/Window/localStorage)或[`Window.sessionStorage`](https://developer.mozilla.org/en/docs/Web/API/Window/sessionStorage))。查看[html5doctor](http://html5doctor.com/storing-data-the-simple-html5-way-and-a-few-tricks-you-might-not-have-known/)上的这篇文章以获得更深入的解释。目前所有现代浏览器都[支持](http://caniuse.com/namevalue-storage)[Web Storage API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API)。

> 只读的 localStorage 属性允许您访问 Document 来源的 Storage 对象；**存储的数据跨浏览器会话保存**。localStorage 与 sessionStorage 类似，不同之处在于，虽然 localStorage 中存储的数据没有过期时间，但sessionStorage 中存储的数据会在页面会话结束时（即页面关闭时）**被清除。**
> ^([https://developer.mozilla.org/en/docs/Web/API/Window/localStorage](https://developer.mozilla.org/en/docs/Web/API/Window/localStorage))

如上所述：

*   要无限期地存储数据（直到缓存被清除），请使用[`Window.localStorage`](https://developer.mozilla.org/en/docs/Web/API/Window/localStorage).
*   要在窗口关闭之前存储数据，请使用[`Window.sessionStorage`](https://developer.mozilla.org/en/docs/Web/API/Window/sessionStorage).

有两种通过[`Window.localStorage`](https://developer.mozilla.org/en/docs/Web/API/Window/localStorage)和[`Window.sessionStorage`](https://developer.mozilla.org/en/docs/Web/API/Window/sessionStorage)API 设置和获取属性的方法：

1.  直接访问属性：

    ```
    localStorage.name = 'ashes999';
    console.log(localStorage.name); // ashes999
    delete localStorage.name;
    console.log(localStorage.name); // undefined 
    ```

    ```
    sessionStorage.name = 'ashes999';
    console.log(sessionStorage.name); // ashes999
    delete sessionStorage.name;
    console.log(sessionStorage.name); // undefined 
    ```

2.  使用[`Storage.setItem`](https://developer.mozilla.org/en-US/docs/Web/API/Storage/setItem)、[`Storage.getItem`](https://developer.mozilla.org/en-US/docs/Web/API/Storage/getItem)和[`Storage.removeItem`](https://developer.mozilla.org/en-US/docs/Web/API/Storage/removeItem)API 方法。

    ```
    localStorage.setItem('name', 'ashes999');
    console.log(localStorage.getItem('name')); // ashes999
    localStorage.removeItem('name');
    console.log(localStorage.getItem('name')); // undefined 
    ```

    ```
    sessionStorage.setItem('name', 'ashes999');
    console.log(sessionStorage.getItem('name')); // ashes999
    sessionStorage.removeItem('name');
    console.log(sessionStorage.getItem('name')); // undefined 
    ```

### 注意事项：

*   [浏览器可能会对Web Storage API](https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API)的每个来源的存储容量施加限制，但您应该安全最多 5MB。
*   Web Storage API 受同源策略限制。
*   如果用户在 Firefox 中禁用了第三方 cookie，则拒绝从第三方 IFrame 访问 Web 存储

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-03T15:30:43.210

您可以将数据存储在 中`window.name`，其中最多可容纳 2MB 的数据 (!)。

```
/* on page 1 */
window.name = "Bla bla bla";

/* on page 2 */
alert(window.name); // alerts "Bla bla bla" 
```

**编辑：**还可以查看有关此的[Ajaxian 文章](http://ajaxian.com/archives/whats-in-a-windowname)。

请注意，同一选项卡/窗口中的其他站点也可以访问`window.name`，因此您不应在此处存储任何机密信息。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-03T15:26:06.200

***如果***你真的需要这样做（我绝对怀疑这是一个好主意），你的额外 javascript 文件想法并不像你想象的那么糟糕。只需使用 JSON 表示法来保存数据，并且根据需要很容易加载和卸载。如果您保留一些经过深思熟虑的逻辑划分，您也应该能够按需更新其中的一部分。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-03T15:51:34.593

谷歌齿轮怎么样。它是为离线存储而设计的，但我认为它可能会起作用。 [http://code.google.com/apis/gears/design.html](http://code.google.com/apis/gears/design.html)

从文档中：

> 存储用户数据
> 
> 不仅仅是静态文件的应用程序具有通常存储在服务器上的数据。为了使应用程序在离线时有用，这些数据必须可以在本地访问。数据库模块提供了一个用于存储数据的关系数据库。在架构页面上，您将找到有关设计应用程序所需的本地存储的策略的讨论。
> 
> 当离线应用程序重新连接时，您需要将本地数据库中所做的任何更改与服务器同步。同步数据有许多不同的方法，没有一种完美的方法。架构页面描述了一些同步策略。
> 
> Gears 数据库的一个附加功能是全文搜索，它提供了一种在数据库文件中搜索文本的快速方法。在此处阅读详细信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-02-05T00:13:36.863

Web Storage API的本地存储[限制为 5MB](https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API/Browser_storage_limits_and_eviction_criteria)，但可以使用[IndexedDB](https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API)在客户端存储更多数据。在一些较新的浏览器中，还可以使用[Service Workers](https://developer.mozilla.org/en-US/docs/Web/Progressive_web_apps/Offline_Service_workers)缓存数据以供离线使用。

URL 片段也可以存储客户端数据，尽管它们在大多数浏览器中只能存储[几千个字符。](https://stackoverflow.com/questions/1571753/maximum-length-of-url-fragments-hash)

客户端存储通常仅限于一个源，尽管[可以](https://stackoverflow.com/questions/33957477/cross-domain-localstorage-with-javascript)使用`postMessage()`.

# unix - 在两个文件之间进行排序差异的简单方法是什么？

> ID：714421
> 
> 赞同：54
> 
> 时间：2009-04-03T15:21:28.130
> 
> 标签：unix, shell

我有两个文件，其中一些行已更改顺序。我希望能够比较这些。

一个网站建议的内容如下所示：

```
diff <(sort text2) <(sort text1) 
```

但这会产生错误：*缺少重定向名称。*

我正在使用 tcsh。上面的命令是针对不同的 shell 的吗？

有没有更好的办法？

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2009-04-03T15:34:06.447

这种重定向语法是特定于 bash 的。因此它在 tcsh 中不起作用。

您可以调用 bash 并直接指定命令：

```
bash -c 'diff <(sort text2) <(sort text1)' 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2012-10-17T16:10:29.650

这是它的一个功能：

```
function diffs() {
        diff "${@:3}" <(sort "$1") <(sort "$2")
} 
```

像这样称呼它：

```
diffs file1 file2 [other diff args, e.g. -y] 
```

如有必要，您可以根据大卫施密特的回答对其进行更改。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2018-11-28T14:43:02.347

> 有没有更好的办法？

就在这里。

使用`comm`实用程序：

> 用法：comm [-123i] file1 file2

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-03T15:26:07.697

如果这对您的 shell 不起作用，只需 3 行即可：

```
sort text1 > text1.sorted
sort text2 > text2.sorted
diff text1.sorted text2.sorted 
```

简单但应该工作......

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-03T15:25:46.763

*您发布的“差异”的*问题是`diff`只能通过. 所以我认为你必须将至少一个排序文件写入临时文件。*`stdin`*

 *```
diff - file.txt 
```

将区分标准输入与 file.txt。'-' 代表标准输入

编辑：我假设进程替换将通过标准输入工作。但事实并非如此，`/dev/fd/{num}`正如上面 VardhanDotNet 所指出的那样，上述情况正在发生。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2020-04-20T00:37:48.167

在`fish`贝壳中，

```
diff (sort a.txt | psub) (sort b.txt | psub) 
```

# php - 我可以编写自己的 mySQL 函数以在 mySQL 查询中使用吗？

> ID：714433
> 
> 赞同：5
> 
> 时间：2009-04-03T15:23:28.717
> 
> 标签：php, mysql, function

我可以编写一个自定义函数，以便在进行 mySQL 查询时调用，例如。

我的数据库表有字段“文件类型”和“文件名”。我想在返回结果之前对文件名执行一个函数。

```
$query = "SELECT filetype, MY_FUNCTION(filename) FROM table..";
$result = mysql_query($query);
return $result 
```

SO $result 现在具有由 MY_FUNCTION 创建的新值。原始数据库数据将保持不变。

好的 - 所以看起来用户定义函数是要走的路......我如何编写自己的用户定义函数？我可以用PHP来写吗？我在哪里保存函数或将它包含在我的全局文件中？

谢谢！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-03T15:44:17.280

```
DELIMITER $$

CREATE FUNCTION MY_FUNCTION (FILENAME VARCHAR(255)) RETURNS VARCHAR(255)
DETERMINISTIC
NO SQL
BEGIN
       RETURN SUBSTR(filename, 1, 20);
END
$$

DELIMITER ; 
```

要创建该函数，您只需将其代码（与上面提供的类似）粘贴到您喜欢的查询工具中，例如`mysql.exe`,`MySQL Query Browser`等`phpmysqladmin`。

你可以写`UDF`in`C`和 in `SQL`。在后一种情况下，您不需要编译器。

我作为示例提供的功能是`SQL UDF`. 它只返回`20`文件名的第一个字符。

`MySQL`您可以使用`SQL UDF`.

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-03T15:33:46.353

是的，这称为[用户定义函数 (UDF)](http://dev.mysql.com/doc/refman/5.0/en/adding-functions.html)。

这里是一个[很好](http://www.mysqludf.org/)的预构建函数存储库，因此您可以检查是否符合您的需求。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T15:29:53.883

如果我理解正确，你想创建一个存储过程？[http://dev.mysql.com/tech-resources/articles/mysql-storedprocedures.html](http://dev.mysql.com/tech-resources/articles/mysql-storedprocedures.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-03T15:31:46.467

[是的，您可以添加使用过的定义函数。](http://dev.mysql.com/doc/refman/5.1/en/adding-functions.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-03T17:30:56.417

您不能在 PHP 中编写用户定义的函数（或者至少在没有编写将调用您的脚本的包装器的情况下不能编写），因为 UDF 是作为本机代码加载的。

# javascript - 通过在字符串中捕获它们的类/ID来选择不同的元素是否被认为是一种不好的做法？

> ID：714439
> 
> 赞同：0
> 
> 时间：2009-04-03T15:25:15.687
> 
> 标签：javascript, jquery, html, string

我已经使用 Jquery 一段时间了，我有一个关于坏/好的做法的问题。这是交易。假设我们有这个 HTML：

```
 <span class="а_s_trigger" id="tekst1">text1</span>
 <span class="а_s_trigger" id="video1">video1</span>
                <div class="a_s_songvideo" id="showvideo1">

                        <object>
                           //video1
                        </object>

                </div>
                <div class="a_s_songtext" id="showtext1">

                        <p>
                        //text1
                        </p>

                </div> 
```

以及以下 jQuery 函数，该函数在单击时触发视频或文本元素的隐藏/显示。

```
$('.а_s_trigger')
           .bind('mouseover',function(e) {
                $(this).css({background:'#F3F3F3',cursor:'pointer'});
            })
            .bind('mouseout',function(e) {
                $(this).css({background:'#E6E6E6'});    
            })
            .bind('click',function(e) {
                var id=$(this).attr('id');
                var status=$(this).attr('id').toString().slice(0,5);
                var index=$(this).attr('id').toString().slice(5,7);
                var visibility=$('#showtext'+index).css('display');

                    if(status=='tekst1')
                    {
                        if(visibility=='block')
                        {
                            $('#showtext'+index).slideUp();
                        }
                        else if(visibility=='none')
                        {
                            $('#showtext'+index).slideDown();
                        }

                    }
                    else if(status=="video")
                    {
                        $('#showvideo'+index).toggle();
                    }

            }); 
```

一切正常，但让我烦恼的是我选择所需元素的方式：

```
var id=this.id;
var status=$(this).attr('id').toString().slice(0,5);
var index=$(this).attr('id').toString().slice(5,7);
var visibility=$('#showtext'+index).css('display'); 
```

以这种方式将变量分配给字符串可以吗？我知道 jQuery 完全是关于选择器和不错的链接函数，例如：

```
$(this).children().siblings().attr('id'); //and so on 
```

我应该总是尝试使用链选择器来选择元素，还是应该遵循“如果它有效就不要改变它！”的原则？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T15:29:41.870

我是**班人**

```
 $(".button").  //etc 
```

对我来说它更容易，你可以抓住多个元素，但如果你对你说的方式没有问题

> 如果它有效，请不要改变它！”

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-03T18:22:00.940

我认为条件使您的代码有点混乱且难以阅读。在我看来，您可以将状态封装在事件处理程序中。

将状态作为类添加到您的元素中。

```
<span class="а_s_trigger tekst" id="t_001">text1</span>
<span class="а_s_trigger video" id="v_001">video1</span> 
```

相应地绑定：

```
$('.а_s_trigger').bind('mouseover',function(e) {
                        $(this).css({background:'#F3F3F3',cursor:'pointer'});
                }).bind('mouseout',function(e) {
                        $(this).css({background:'#E6E6E6'});
                });

$('.а_s_trigger .tekst').bind('click',function(e) {
    var index=this.id.toString().slice(2,6);
    var $element = $('#showtext'+index);
    var visibility=$element.css('display');
    if(visibility=='block')
    {
        $element.slideUp();
    }
    else
    {
        $element.slideDown();
    }});

$('.а_s_trigger .video').bind('click',function(e) {
    var index=this.id.toString().slice(2,6);
    $('#showvideo'+index).toggle;
}); 
```

编辑：

文本处理程序可以替换为（性能损失很小）：

```
$('.а_s_trigger .tekst').bind('click',function(e) {
    var index=this.id.toString().slice(2,6);
    $('#showtext'+index + ':visible').slideUp();
    $('#showtext'+index + ':hidden').slideDown();
}); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T15:29:07.143

没关系。由于您在条件登录中多次使用这些值，因此首先将它们存储到局部变量是有意义的。

随机说明：如果您只需要 id，this.id 与 $(this).attr('id') 一样有效。

# delphi - 如何在 Delphi 中通过引用传递数组？

> ID：714456
> 
> 赞同：13
> 
> 时间：2009-04-03T15:28:22.263
> 
> 标签：delphi, parameters, reference, types

我已经阅读了有关通过引用传递的信息，所以

```
procedure test(var x:integer);
begin
  x:=x+5;
end; 
```

所以上面的代码通过引用更新了 5。我假设如果我通过引用更新数组，我可以声明*var X: array of blah* ... 有一些绑定错误，只是想知道我是否应该使用数据类型作为指向数据的指针或者指针总是 int... 只是让我知道这是我通过引用传递的方式还是我的代码中的其他内容是问题所在。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-04-03T17:44:32.437

如果将动态数组作为非 var 参数传递，编译器将进行复制。

下面的小代码示例通过在表单标题中显示 37/42 来证明这一点。

```
procedure IncArray1(data: array of integer);
var i : integer;
begin
  for i := Low(data) to High(data) do
    data[i] := data[i] + 5;
end;

procedure IncArray2(var data: array of integer);
var i : integer;
begin
  for i := Low(data) to High(data) do
    data[i] := data[i] + 5;
end;

procedure TForm8.FormCreate(Sender: TObject);
var
  data: array of integer;
begin
  SetLength(data, 1);
  data[0] := 37;
  IncArray1(data);
  Caption := IntToStr(data[0]);
  IncArray2(data);
  Caption := Caption + '/' + IntToStr(data[0]);
end; 
```

如果我们查看生成的汇编代码，IncArray1 以

```
004552B4 8BCA             mov ecx,edx
004552B6 85C9             test ecx,ecx
004552B8 7807             js $004552c1
004552BA 8B1C88           mov ebx,[eax+ecx*4]
004552BD 49               dec ecx
004552BE 53               push ebx
004552BF 79F9             jns $004552ba
004552C1 8BC4             mov eax,esp 
```

此代码将源数组复制到堆栈并将 eax 设置为第一个元素的地址（= 最后一次推送后存储在堆栈指针中的地址）。堆栈向下增长，因此代码从最后一个元素开始（调用 IncArray1 时 edx 包含 High(data)）并重复（读取元素；推送元素；递减索引）直到到达元素 0。

IncArray2 不包含这样的代码。调用者在调用 IncArray2 之前将数据的地址存储到 eax 寄存器中，而 IncArray2 仅使用该地址。

如果您出于任何原因不想使用“var”，您可以将数据的地址传递给您的方法。但是由于您不能在参数声明中使用语法'data: ^array of integer'，因此您必须为您的数据声明一个类型。而且您必须在方法中的任何地方都使用“数据^”而不是“数据”。

```
type
  TData = array of integer;
  PData = ^TData;

procedure IncArray(data: PData);
var i : integer;
begin
  for i := Low(data^) to High(data^) do
    data^[i] := data^[i] + 5;
end;

procedure TForm8.FormCreate(Sender: TObject);
var
  data: TData;
begin
  SetLength(data, 2);
  data[0] := 37;
  IncArray(@data);
  Caption := IntToStr(data[0]);
end; 
```

用德尔福 2007 测试。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-03T19:41:32.497

Gabr 的回答是正确的，但关键点被埋得足够深，我将把它作为一个单独的帖子提出：

首先定义你的类型！在这种特定情况下，编译器在那里接受了一个整数数组，但这只是因为它具有特殊含义并且*不是*您所期望的。在过程定义中定义类型的任何其他尝试都将失败。

与 C 不同，如果你想让两个东西赋值兼容，你必须将它们声明为*相同*类型，而不仅仅是构建相同的两种类型：

```
Var
     A : Array [1..4] of Integer;
     B : Array [1..4] of Integer;

Begin
    A := B; 
```

不会编译。相当：

```
Type
    Array4 = array [1..4] of Integer;

Var
    A : Array4;
    B : Array4;

Begin
    A := B; 
```

并且编译器会按照您的预期进行。

# sql-server - 同时使用 GUID 和自动递增整数

> ID：714458
> 
> 赞同：9
> 
> 时间：2009-04-03T15:28:47.503
> 
> 标签：sql-server, database, indexing, primary-key, guid

我一直在研究使用 GUID 作为数据库中的主键。目前看来，利大于弊。但是，我发现 GUID 可能不是我想要的。

在我的应用程序中，用户应该能够根据用户友好的 ID 识别对象。因此，例如，如果他们想在不输入全名的情况下获得特定产品，他们可以使用产品的 ID。对于这样的事情，GUID 不容易记住。

我一直在考虑的解决方案是同时使用 GUID 和自动递增整数。GUID 将是行的主键，而自动递增整数将是应用程序过滤函数使用的索引。但是，所有 SQL SELECT、UPDATE、DELETE 语句都将使用 GUID。

我想使用 GUID 的主要原因是防止合并两个数据库时发生冲突。如果 Database #1 和 Database #2 都具有 Product #2，则导入器脚本必须更改 ID 和引用它的所有外键。使用 GUID，我只需要更改表本身中的用户友好 ID，而外键将使用每个导入记录唯一的 GUID，因此无需修改即可工作。

所以，我的问题是：具有自动递增整数索引和 GUID 主键是否存在任何重大问题（除了 GUID 字段的大小和简单的页面碎片）？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-03T15:32:59.583

我总是倾向于在我的数据库中使用代理主键。也就是说：那些主键在问题域中没有实际意义，因此，这些主键永远不会暴露给用户。（如果这个代理主键的类型是 GUID 或身份，我不在乎；这取决于要求）。

如果您说用户应该能够根据用户友好的 ID 识别对象，那么，我认为这个用户友好的 ID 是属于您的“问题域”的值。这意味着，这个 ID 确实应该是您表中的一个属性，但它不应该用作您的表中的主键。

这还允许您轻松修改此类用户友好 ID 的值（如果有必要），而不必担心修改相关的外键。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T15:36:51.867

“为什么“用户应该能够根据用户友好的 ID 识别对象”？

在我看来，您的用户应该使用代码来识别记录。

假设您的数据库包含产品（正如您在问题中提到的那样）。如果他们有代表产品的代码，用户可以输入，那不是更好吗？

假设您有桌椅，作为用户，我更喜欢使用 tbl 和 chr 而不是 1 和 2 来识别我在说什么。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T15:33:27.197

在`MySQL`中，您需要将数字设置`ID`为`PRIMARY KEY`，`AUTO_INCREMENT`可能只有`PRIMARY KEY`，这意味着它也应该是`NOT NULL`。

您仍然可以`UNIQUE INDEX`在`GUID`列上定义 a 并在任何地方使用它，尽管`InnoDB`表将聚集在 numeric`id`上，而不是`GUID`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-03T15:35:26.380

有一种思想流派说，您永远不应该将您的代理 ID 暴露给外界。所以他们会说，如果你想要一个企业 ID，你应该使用别的东西。

例如，[这篇维基百科文章是这样说的：](http://en.wikipedia.org/wiki/Surrogate_key)

> 解离
> 
> 生成的代理键的值 - 因为它们是生成的且任意的 - 与连续保存的数据的实际含义无关。当检查另一行持有对代理键的外键引用时，仅仅通过查看行本身中的数据是不可能弄清楚它持有该引用的含义的。在尝试理解数据项时必须导航的每个外键连接都会向此间接添加一个层。这也可能使审计更加困难，因为不正确的数据在检查时并不明显。
> 
> 对于导出和共享的数据，代理键也不自然。一个特别的困难是模式的两个实例可以保存在逻辑上表示相同事物的记录（即，它们在商业意义上是相同的），但由于键的分配历史，它们具有不同的键。处理这个问题的一种方法是采用代理键永远不会导出或导入的规则：它们永远不会暴露在数据库之外，除非作为临时数据（最明显的是，在执行与数据库具有“实时”连接的应用程序时）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-03T15:55:35.693

为了更具体地说明您的问题，是的，在数据​​库中使用 GUID 作为主键还有其他问题：

[http://www.sqlskills.com/BLOGS/KIMBERLY/post/GUIDs-as-PRIMARY-KEYs-andor-the-clustering-key.aspx](http://www.sqlskills.com/BLOGS/KIMBERLY/post/GUIDs-as-PRIMARY-KEYs-andor-the-clustering-key.aspx)

问题不在于使用 GUID 作为主键，而是使用非顺序 GUID 作为表的*聚集索引*。

这里的要点是要么使用其他字段作为聚集索引，要么使用顺序 GUID 来避免这种碎片。

# .net - 授予私有访问属性

> ID：714462
> 
> 赞同：0
> 
> 时间：2009-04-03T15:29:29.687
> 
> 标签：.net, assemblies, attributes

您应用于程序集以允许从另一个程序集访问私有方法的属性的名称是什么？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-03T15:35:32.090

没有。

您可以通过该属性授予对指定其他程序集的 *内部类和方法的访问权限。*`InternalsVisibleTo`然而，并非所有 .NET 语言编译器都尊重这一点（IIRC C# 支持，但 VB 不支持）。

例如来自 System.Management.Automation.dll（因为我在 Reflector 中打开了它）：

```
[assembly: InternalsVisibleTo("Microsoft.PowerShell.ConsoleHost,PublicKey=0024000004800000940000000602000000240000525341310004000001000100b5fc90e7027f67871e773a8fde8938c81dd402ba65b9201d60593e96c492651e889cc13f1415ebb53fac1131ae0bd333c5ee6021672d9718ea31a8aebd0da0072f25d87dba6fc90ffd598ed4da35e44c398c454307e8e33b8426143daec9f596836f97c8f74750e5975c64e2189f45def46b2a2b1247adc3652bf5c308055da9")] 
```

# jquery - 如何在元素外的任何位置隐藏单击事件中的元素？

> ID：714471
> 
> 赞同：123
> 
> 时间：2009-04-03T15:31:28.840
> 
> 标签：jquery, events, event-bubbling

我想知道当单击页面上的任何位置时，这是否是隐藏可见元素的正确方法。

```
$(document).click(function (event) {            
    $('#myDIV:visible').hide();
}); 
```

当点击事件发生在元素的边界内时，元素（div、span 等）不应消失。

* * *

## 回答 #1

> 赞同：209
> 
> 时间：2009-04-03T16:07:41.170

如果我理解，当您单击除 div 之外的任何位置时，您想隐藏 div，如果您在 div 上单击时，它不应该关闭。您可以使用以下代码执行此操作：

```
$(document).click(function() {
    alert("me");
});
$(".myDiv").click(function(e) {
    e.stopPropagation(); // This is the preferred method.
    return false;        // This should not be used unless you do not want
                         // any click events registering inside the div
}); 
```

这会将点击绑定到整个页面，但是如果您点击有问题的 div，它将取消点击事件。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-04-03T15:39:01.597

试试这个

```
 $('.myDiv').click(function(e) { //button click class name is myDiv
  e.stopPropagation();
 })

 $(function(){
  $(document).click(function(){  
  $('.myDiv').hide(); //hide the button

  });
}); 
```

我使用**类名而不是 ID**，因为在 asp.net 中，您必须担心 .net 附加到 id 的额外内容

**编辑-** 由于您添加了另一件，它会像这样工作：

```
 $('.myDiv').click(function() { //button click class name is myDiv
  e.stopPropagation();
 })

 $(function(){
  $('.openDiv').click(function() {
  $('.myDiv').show(); 

  });
  $(document).click(function(){  
  $('.myDiv').hide(); //hide the button

  });
}); 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2012-05-30T01:27:46.687

从 jQuery 1.7 开始，有一种处理事件的新方法。我想我会在这里回答只是为了展示我如何以“新”方式去做这件事。如果您还没有，我建议您阅读[jQuery 文档以了解“on”方法](http://api.jquery.com/on/)。

```
var handler = function(event){
  // if the target is a descendent of container do nothing
  if($(event.target).is(".container, .container *")) return;

  // remove event handler from document
  $(document).off("click", handler);

  // dostuff
}

$(document).on("click", handler); 
```

在这里，我们滥用了 jQuery 的选择器和事件冒泡。请注意，我确保之后清理事件处理程序。`$('.container').one`您可以使用（[请参阅：docs](http://api.jquery.com/one/) ）自动执行此行为，但因为我们需要在处理程序中执行不适用于此处的条件。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2009-07-17T16:02:43.307

以下代码示例似乎最适合我。虽然您可以使用“return false”来停止对 div 或其任何子级事件的所有处理。如果你想控制弹出 div（例如弹出登录表单），你需要使用 event.stopPropogation()。

```
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title></title>
</head>
<body>
    <a id="link" href="#">show box</a>
    <div id="box" style="background: #eee; display: none">
        <p>a paragraph of text</p>
        <input type="file"  />
    </div>

    <script src="jquery.js" type="text/javascript"></script>

    <script type="text/javascript">
        var box = $('#box');
        var link = $('#link');

        link.click(function() {
            box.show(); return false;
        });

        $(document).click(function() {
            box.hide();
        });

        box.click(function(e) {
            e.stopPropagation();
        });

    </script>
</body>
</html> 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2010-04-21T11:09:16.020

谢谢，托马斯。我是 JS 新手，我一直在疯狂寻找解决问题的方法。你的帮助。

我使用 jquery 制作了一个向下滑动的登录框。为了获得最佳用户体验，当用户点击框以外的某个位置时，我决定让框消失。花了大约四个小时来解决这个问题，我有点尴尬。但是，嘿，我是 JS 新手。

也许我的代码可以帮助某人：

```
<body>
<button class="login">Logg inn</button>
<script type="text/javascript">

    $("button.login").click(function () {
        if ($("div#box:first").is(":hidden")) {
                $("div#box").slideDown("slow");} 
            else {
                $("div#box").slideUp("slow");
                }
    });
    </script>
<div id="box">Lots of login content</div>

<script type="text/javascript">
    var box = $('#box');
    var login = $('.login');

    login.click(function() {
        box.show(); return false;
    });

    $(document).click(function() {
        box.hide();
    });

    box.click(function(e) {
        e.stopPropagation();
    });

</script>

</body> 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2012-05-21T15:32:48.440

我做了以下。想到分享，以便其他人也可以受益。

```
$("div#newButtonDiv").click(function(){
    $(this).find("ul.sub-menu").css({"display":"block"});

    $(this).click(function(event){
        event.stopPropagation();
        $("html").click(function(){
            $(this).find("ul.sub-menu").css({"display":"none"});
        }
    });
}); 
```

让我知道我是否可以帮助某人。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2013-05-11T15:06:35.760

你还可以做的是：

```
$(document).click(function (e)
{

  var container = $("div");

   if (!container.is(e.target) && container.has(e.target).length === 0)
  {
 container.fadeOut('slow');

   }

}); 
```

如果您的目标不是 div，则通过检查其长度是否为零来隐藏 div。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2015-08-16T06:14:18.177

试试这个：

```
 $(document).mouseup(function (e) {
    var div = $("#yourdivid");
    if (!div.is(e.target) && div.has(e.target).length === 0) 
    {
       div.hide();
     }
    }); 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2014-09-17T18:46:29.223

当点击发生在非子元素中时，隐藏容器 div 的另一种方法；

```
$(document).on('click', function(e) {
    if(!$.contains($('.yourContainer').get(0), e.target)) {
        $('.yourContainer').hide();
    }
}); 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2015-05-28T05:53:37.090

```
 $(document).on('click', function(e) { // Hides the div by clicking any where in the screen
        if ( $(e.target).closest('#suggest_input').length ) {
            $(".suggest_div").show();
        }else if ( ! $(e.target).closest('.suggest_container').length ) {
            $('.suggest_div').hide();
        }
    }); 
```

这里#suggest_input in 是文本框的名称，.suggest_container 是 ul 类名，.suggest_div 是我的自动建议的主要 div 元素。

此代码用于通过单击屏幕中的任何位置来隐藏 div 元素。在做每一件事之前，请理解代码并复制它......

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2013-08-11T06:45:59.160

试试这个，它对我来说很完美。

```
$(document).mouseup(function (e)
{
    var searchcontainer = $("#search_container");

    if (!searchcontainer.is(e.target) // if the target of the click isn't the container...
        && searchcontainer.has(e.target).length === 0) // ... nor a descendant of the container
    {
        searchcontainer.hide();
    }
}); 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2015-02-03T10:49:08.187

```
$('html').click(function() {
//Hide the menus if it is visible
});

$('#menu_container').click(function(event){
    event.stopPropagation();
}); 
```

但你也需要记住这些事情。[http://css-tricks.com/dangers-stopping-event-propagation/](http://css-tricks.com/dangers-stopping-event-propagation/)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2015-07-28T10:08:22.260

这是一个基于 Sandeep Pal 回答的 CSS/small JS 解决方案：

```
$(document).click(function (e)
{
  if (!$("#noticeMenu").is(e.target) && $("#noticeMenu").has(e.target).length == 0)
  {
   $("#menu-toggle3").prop('checked', false);
  }
}); 
```

通过单击复选框然后在菜单之外尝试一下：

[https://jsfiddle.net/qo90txr8/](https://jsfiddle.net/qo90txr8/)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-04-03T15:58:55.717

这不起作用 - 当您在其中单击时，它会隐藏 .myDIV。

```
$('.openDiv').click(function(e) {
$('.myDiv').show(); 
e.stopPropagation();
})

$(document).click(function(){  
$('.myDiv').hide(); 

});

});

<a class="openDiv">DISPLAY DIV</a>

<div class="myDiv">HIDE DIV</div> 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2012-02-13T16:21:54.847

对上述建议仅有 2 处小改进：

*   解绑文档。完成后单击
*   停止对触发此事件的传播，假设它是一次点击

    ```
    jQuery(thelink).click(function(e){
        jQuery(thepop).show();

        // bind the hide controls
        var jpop=jQuery(thepop);
        jQuery(document).bind("click.hidethepop", function() {
                jpop.hide();
                // unbind the hide controls
                jQuery(document).unbind("click.hidethepop");
        });
        // dont close thepop when you click on thepop
        jQuery(thepop).click(function(e) {
            e.stopPropagation();
        });
        // and dont close thepop now 
        e.stopPropagation();
    }); 
    ```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2017-10-15T10:07:40.407

```
$(document).ready(function(){

$("button").click(function(){

        $(".div3").toggle(1000);
    });
   $("body").click(function(event) {
   if($(event.target).attr('class') != '1' && $(event.target).attr('class') != 'div3'){
       $(".div3").hide(1000);}
    }); 

});
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js"></script>
<button class="1">Click to fade in boxes</button><br><br>

<body style="width:100%;height:200px;background-color:pink;">
<div class="div3" style="width:80px;height:80px;display:none;background-color:blue;"></div><body>
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2019-04-16T08:37:56.863

```
$( "element" ).focusout(function() {
    //your code on element
}) 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-08-11T19:15:13.090

这是由上述其他解决方案制成的。

```
$(document).ready(function(){  

    $("button").click(function(event){
        $(".area").toggle();
        event.stopPropagation();    //stops the click event to go "throu" the button an hit the document
    });

    $(document).click(function() {
        $(".area").hide();
    });

    $(".interface").click(function(event) {
        event.stopPropagation();
        return false;                                        
    });
}); 
```

```
 <div>
    <div>
        <button> Press here for content</button> 
      <div class="area">
        <div class="interface"> Content</div>
      </div>
    </div>       
</div> 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2021-06-02T13:03:56.723

```
$(document).click(function() {
  var container = $("#container");
  if (!container.is(event.target) &&
    !container.has(event.target).length) {
    container.hide();
  }
}); 
```

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2017-01-13T15:35:56.623

```
$(document).mouseup(function (e)
{
    var mydiv = $('div#mydiv');
    if (!mydiv.is(e.target) && mydiv.has(e.target).length === 0){
       search.slideUp();
    }
}); 
```

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2019-07-11T06:43:49.643

简单的解决方案：在某个特定元素之外的任何地方隐藏单击事件上的元素。

```
$(document).on('click', function () {
                $('.element').hide();
            });
            //element will not Hide on click some specific control inside document
            $('.control-1').on('click', function (e) {
                e.stopPropagation();
            }); 
```

# python - Python 函数中的最大参数数是多少？

> ID：714475
> 
> 赞同：39
> 
> 时间：2009-04-03T15:32:14.157
> 
> 标签：python, function, arguments, language-features, limit

众所周知，Python 函数最多可以有 256 个参数。我很想知道这个限制是否适用`*args`以及`**kwargs`何时以下列方式展开：

```
items = [1,2,3,4,5,6]

def do_something(*items):
    pass 
```

我问是因为，假设可能存在大于 256 个项目的列表被展开为一组`*args`or的情况`**kwargs`。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-03T15:44:51.537

WFM

```
>>> fstr = 'def f(%s): pass' % (', '.join(['arg%d' % i for i in range(5000)]))
>>> exec(fstr)
>>> f
<function f at 0x829bae4> 
```

**更新：**正如布赖恩所注意到的，限制在调用方：

```
>>> exec 'f(' + ','.join(str(i) for i in range(5000)) + ')'

Traceback (most recent call last):
  File "<pyshell#63>", line 1, in <module>
    exec 'f(' + ','.join(str(i) for i in range(5000)) + ')'
  File "<string>", line 1
SyntaxError: more than 255 arguments (<string>, line 1) 
```

另一方面，这有效：

```
>>> f(*range(5000))
>>> 
```

**结论：**不，它不适用于展开的论点。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2012-01-19T19:36:03.867

在 Python 3.6 及之前版本中，限制是由于编译后的字节码如何处理使用位置参数和/或关键字参数调用函数。

关注的字节码操作是[`CALL_FUNCTION`](https://docs.python.org/3.5/library/dis.html#opcode-CALL_FUNCTION)它携带一个`op_arg`长度为 4 个字节的字节码，但使用了两个最低有效字节。其中，最高有效字节表示堆栈上关键字参数的数量，最低有效字节表示堆栈上位置参数的数量。因此，您最多可以有`0xFF == 255`关键字参数或`0xFF == 255`位置参数。

此限制不适用于`*args`and`**kwargs`因为使用该语法的调用使用字节码 ops [`CALL_FUNCTION_VAR`](https://docs.python.org/3.5/library/dis.html#opcode-CALL_FUNCTION_VAR), [`CALL_FUNCTION_KW`](https://docs.python.org/3.5/library/dis.html#opcode-CALL_FUNCTION_KW), 和[`CALL_FUNCTION_VAR_KW`](https://docs.python.org/3.5/library/dis.html#opcode-CALL_FUNCTION_VAR_KW)取决于签名。对于这些操作码，堆栈由一个可迭代的 the和`*args`一个`dict`. `**kwargs`这些项目直接传递给接收器，接收器根据需要展开它们。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2018-01-01T16:46:21.283

在 Python 3.7 和更新版本中，没有限制。[这是issue #27213](https://bugs.python.org/issue27213)和[issue #12844](https://bugs.python.org/issue12844)中工作的结果；#27213 重新设计了`CALL_FUNCTION*`操作码系列以提高性能和简单性（3.6 的一部分），释放操作码参数以仅对单个参数计数进行编码，并且 #12844 删除了阻止具有更多参数的代码被编译的编译时检查。

所以从 3.7 开始，使用[`EXTENDED_ARG()`opcode](https://docs.python.org/3/library/dis.html#opcode-EXTENDED_ARG)，现在*完全没有限制*你可以使用显式参数传入多少个参数，保存多少个可以放入堆栈（现在受你的记忆约束）：

```
>>> import sys
>>> sys.version_info
sys.version_info(major=3, minor=7, micro=0, releaselevel='alpha', serial=2)
>>> def f(*args, **kwargs): pass
...
>>> exec("f({})".format(', '.join(map(str, range(256)))))
>>> exec("f({})".format(', '.join(map(str, range(2 ** 16))))) 
```

请注意，列表、元组和字典仅限于[`sys.maxsize`](https://docs.python.org/3/library/sys.html#sys.maxsize)元素，因此如果被调用的函数使用`*args`和/或`**kwargs`catch-all 参数，那么这些*都是*有限的。

对于`*args`and调用语法（扩展参数），除了Python 标准类型的相同大小限制外，`**kwargs`没有其他限制。`sys.maxint`

在 Python 3.7 之前的版本中，CPython 在调用中限制为 255 个显式传递的参数：

```
>>> def f(*args, **kwargs): pass
...
>>> exec("f({})".format(', '.join(map(str, range(256)))))
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "<string>", line 1
SyntaxError: more than 255 arguments 
```

这个限制是存在的，因为在 Python 3.5 之前，[`CALL_FUNCTION`操作码](https://docs.python.org/3.5/library/dis.html#opcode-CALL_FUNCTION)重载了操作码参数以对堆栈上的位置参数和关键字参数的数量进行编码，每个参数都以单个字节编码。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-03T16:45:42.063

这似乎是编译源代码的限制，因此可能只存在于直接传递的参数，而不是 *args 或 **kwargs。

相关代码可以在[ast.c](http://svn.python.org/view/python/trunk/Python/ast.c?view=markup)中找到：

```
if (nargs + nkeywords + ngens > 255) {
  ast_error(n, "more than 255 arguments");
  return NULL;
} 
```

但请注意，这是在 ast_for_call 中，因此仅适用于调用方。即`f(a,b,c,d,e...)`，而不是定义，尽管它会同时计算位置参数`(a,b,c,d)`和`keyword (a=1, b=2, c=3)`样式参数。实际参数`*args`和`**kwargs`参数看起来应该只算作调用端用于这些目的的一个参数。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-03T15:46:26.870

对于 **kwargs，如果我没记错的话，这是一本字典。因此，它几乎没有限制。

对于 *args，我不太确定，但我认为它是一个元组或一个列表，所以它也几乎没有限制。

没有限制，我的意思是除了内存限制。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-04-03T15:35:43.633

我尝试了一个包含 4000 个项目的列表，并且成功了。所以我猜它也适用于更大的值。

# wcf - 无法理解 WCF 错误消息，需要帮助

> ID：714488
> 
> 赞同：7
> 
> 时间：2009-04-03T15:35:23.493
> 
> 标签：wcf, exception

我有一个简单的 Web 服务，允许应用程序查询我的 CMDB。我遇到问题的功能适用于较小的结果集，但适用于较大的结果集，这表明 WCF 服务配置中的某些内容阻止了它成功。

我有一个简单的 WinForms 测试应用程序，其中包含对 Web 服务的服务引用和调用相关函数的单个函数。

较小的结果集返回 ~120KB 的 xml，失败的较大结果集是 ~2MB。我尝试增加 maxReceivedMessageSize 和 maxStringContentLength 的大小但没有成功。

我错过了一些配置吗？如果这是问题所在，我会期待更详细的错误消息。

提前致谢，

缺口

* * *

返回的错误是：

```
System.ServiceModel.CommunicationException: The underlying connection was closed: The connection was closed unexpectedly. --->
System.Net.WebException: The underlying connection was closed: The connection was closed unexpectedly.
   at System.Net.HttpWebRequest.GetResponse()
   at System.ServiceModel.Channels.HttpChannelFactory.HttpRequestChannel.HttpChannelRequest.WaitForReply(TimeSpan timeout)
   --- End of inner exception stack trace ---

Server stack trace: 
   at System.ServiceModel.Channels.HttpChannelUtilities.ProcessGetResponseWebException(WebException webException, HttpWebRequest request, HttpAbortReason abortReason)
   at System.ServiceModel.Channels.HttpChannelFactory.HttpRequestChannel.HttpChannelRequest.WaitForReply(TimeSpan timeout)
   at System.ServiceModel.Channels.RequestChannel.Request(Message message, TimeSpan timeout)
   at System.ServiceModel.Channels.ClientReliableChannelBinder`1.RequestClientReliableChannelBinder`1.OnRequest(TRequestChannel channel, Message message, TimeSpan timeout, MaskingMode maskingMode)
   at System.ServiceModel.Channels.ClientReliableChannelBinder`1.Request(Message message, TimeSpan timeout, MaskingMode maskingMode)
   at System.ServiceModel.Channels.ClientReliableChannelBinder`1.Request(Message message, TimeSpan timeout)
   at System.ServiceModel.Security.SecuritySessionClientSettings`1.SecurityRequestSessionChannel.Request(Message message, TimeSpan timeout)
   at System.ServiceModel.Dispatcher.RequestChannelBinder.Request(Message message, TimeSpan timeout)
   at System.ServiceModel.Channels.ServiceChannel.Call(String action, Boolean oneway, ProxyOperationRuntime operation, Object[] ins, Object[] outs, TimeSpan timeout)
   at System.ServiceModel.Channels.ServiceChannel.Call(String action, Boolean oneway, ProxyOperationRuntime operation, Object[] ins, Object[] outs)
   at System.ServiceModel.Channels.ServiceChannelProxy.InvokeService(IMethodCallMessage methodCall, ProxyOperationRuntime operation)
   at System.ServiceModel.Channels.ServiceChannelProxy.Invoke(IMessage message)

Exception rethrown at [0]: 
   at System.Runtime.Remoting.Proxies.RealProxy.HandleReturnMessage(IMessage reqMsg, IMessage retMsg)
   at System.Runtime.Remoting.Proxies.RealProxy.PrivateInvoke(MessageData& msgData, Int32 type)
   at TestRig.CmdbDataService.ICmdbDataService.GetMonitors(String client)
   at TestRig.CmdbDataService.CmdbDataServiceClient.GetMonitors(String client) in C:\Documents and Settings\nfoster\My Documents\Visual Studio Projects\Virtual Operations Manuals\Trunk\src\TestRig\Service References\CmdbDataService\Reference.vb:line 1480
   at TestRig.Form1.btnGetServers_Click(Object sender, EventArgs e) in C:\Apps\Virtual Operations Manuals\Trunk\src\TestRig\Form1.vb:line 8 
```

应用程序中的调用函数是：

```
Private Sub btnGetMonitors_Click(ByVal sender As System.Object, ByVal e As System.EventArgs) Handles btnGetMonitors.Click
  txtResults.Text = String.Empty
  Dim proxy As CmdbDataService.CmdbDataServiceClient = Nothing
  Try
    proxy = New CmdbDataService.CmdbDataServiceClient("WSHttpBinding_ICmdbDataService")
    Dim monitors As TestRig.CmdbDataService.ConfigurationItems = proxy.GetMonitors(txtClientName.Text)
    proxy.Close()
    For Each monitor In monitors
      txtResults.Text &= monitor.Name & " (" & monitor.TypeName & ")" & vbCrLf
    Next
    txtResults.Text &= monitors.Count & " monitors returned"
  Catch ex As Exception
    If Not IsNothing(proxy) AndAlso proxy.State <> ServiceModel.CommunicationState.Closed Then proxy.Abort()
    txtResults.Text = ex.ToString
  Finally
    proxy = Nothing
  End Try
End Sub 
```

在测试台端，app.config 包含以下 serviceModel：

```
 <system.serviceModel>
    <diagnostics>
      <messageLogging logMalformedMessages="true" logMessagesAtServiceLevel="true"
        logMessagesAtTransportLevel="true" />
    </diagnostics>
    <behaviors />
    <bindings>
      <wsHttpBinding>
        <binding name="WSHttpBinding_Default" closeTimeout="00:05:00"
          openTimeout="00:05:00" receiveTimeout="00:10:00" sendTimeout="00:05:00"
          maxBufferPoolSize="104857600" maxReceivedMessageSize="104857600">
          <readerQuotas maxDepth="104857600" maxStringContentLength="104857600"
            maxArrayLength="104857600" maxBytesPerRead="104857600" maxNameTableCharCount="104857600" />
        </binding>
      </wsHttpBinding>
    </bindings>
    <client>
      <endpoint address="http://localhost/CmdbServices/DataService.svc/soap12"
        binding="wsHttpBinding" bindingConfiguration="WSHttpBinding_Default"
        contract="CmdbDataService.ICmdbDataService" name="WSHttpBinding_ICmdbDataService">
        <identity>
          <userPrincipalName value="MyMachine\ASPNET" />
        </identity>
      </endpoint>
    </client>
  </system.serviceModel> 
```

在服务端，web.config 是：

```
 <system.serviceModel>
    <diagnostics performanceCounters="Default">
      <messageLogging logMalformedMessages="true" logMessagesAtServiceLevel="true"
       logMessagesAtTransportLevel="true" />
    </diagnostics>
    <services>
      <service behaviorConfiguration="ServiceBehavior" name="MyCorp.Cmdb.Services.DataService.CmdbDataService">
        <endpoint address="soap12" binding="wsHttpBinding" contract="MyCorp.Cmdb.Services.DataService.ICmdbDataService" />
        <endpoint address="soap11" binding="basicHttpBinding" contract="MyCorp.Cmdb.Services.DataService.ICmdbDataService" />
        <endpoint address="mex" binding="mexHttpBinding" contract="IMetadataExchange" />
      </service>
    </services>
    <behaviors>
      <serviceBehaviors>
        <behavior name="ServiceBehavior">
          <serviceMetadata httpGetEnabled="true"/>
          <serviceDebug includeExceptionDetailInFaults="true"/>
        </behavior>
      </serviceBehaviors>
    </behaviors>
  </system.serviceModel> 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-03T16:11:44.950

我的一位同事刚刚向我指出了[这篇博客文章](http://blogs.conchango.com/merrickchaffer/archive/2007/09/19/WCF-System.Net.WebException_3A00_-The-underlying-connection-was-closed_3A00_-The-connection-was-closed-unexpectedly.aspx)，其中真正的罪魁祸首是端点行为中的 maxItemsInObjectGraph 属性。

解决这些问题已经解决了问题，我一定刚刚超过了默认阈值 65536 :D

很高兴看到错误消息为您指明了正确的方向:(

干杯....

另外：您可能会收到此错误，因为您的 Web 方法之一使用的类不是`[DataContract]`类。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-11-16T16:24:37.047

此博客介绍了如何设置跟踪侦听器和使用 svctraceviewer.exe。

[http://tbszone.com/post/2010/11/16/WCF-The-connection-was-closed-unexpectedly.aspx](http://tbszone.com/post/2010/11/16/WCF-The-connection-was-closed-unexpectedly.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T15:47:09.457

更新：好的，我看到你已经打开了跟踪。你看过 WCF 的踪迹吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-03-05T14:07:01.860

尝试在客户端代码中添加此捕获：

```
catch (CommunicationException commProblem)
{
   Console.WriteLine("There was a communication problem. " + commProblem.Message + commProblem.StackTrace);
   Console.Read();

 } 
```

# perl - 如何将我的数据重新排列为 GD::Graph 的 (x,y) 坐标？

> ID：714494
> 
> 赞同：3
> 
> 时间：2009-04-03T15:36:17.157
> 
> 标签：perl, plot, gd-graph

我正在编写一个程序，该程序接受用户的输入文件。[该文件中有一堆数字，我将读取文件中的数字并使用GD::Graph](http://search.cpan.org/dist/GDGraph/Graph.pm)根据这些数字创建一个图。

文件的第一行是X轴，文件的第二行是X轴对应的Y值和第三、第四、...等例如：

```
1 2 3 4 5 
2 4 5 10 14
5 6 8 12 13 
```

所以在上面，第一行是 x 轴，第二行是对应于 xaxis 的 y 值，所以这将获取 10 个点。(1, 2) (1, 5) (2, 4) (2, 6)....(4,10) (4,12) (5,14) (5, 13)

我计划读取数组的每一行，然后将行拆分为空格或制表符并将值存储在数组中。因此，数组 1 将具有 x 轴，数组 2 将具有 y 轴，但是我应该如何在数组中存储第 3、第 4、第 5、... 等行，以便它们成为（x，y）？

此外，如何找到第一行和第二行（2 个数组）的最大值，以便为 X 轴和 Y 轴创建限制？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T16:11:40.037

不是您问题的真正答案，但不要错过[GD::Graph::Data](http://search.cpan.org/dist/GDGraph/Graph/Data.pm)。

除非您**确定**每行的第一个和最后一个是最小/最大的，否则您需要使用[List::Util](http://search.cpan.org/perldoc?List::Util)`min()`和`max()`.

* * *

我不太明白您所说的“文件的第一行是 X 轴，文件的第二行是 Y 轴，第三，第四，...等是 X 轴的对应点”是什么意思。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T17:47:30.760

您可以随时扩展您的 x 和 y 数组。

```
#!/usr/bin/perl

use Data::Dumper;
use warnings;
use strict;

my @xs = ();
my @ys = ();
my $expecting_xs = 1;
my $last_xs_count;

while(<>) {
  chomp;
  my @values = split(/\s+/);
  if($expecting_xs) {
    push(@xs, @values);
    $last_xs_count = @values;
    $expecting_xs = 0;
  } else {
    if(@values != $last_xs_count) {
      die "Count mismatch";
    } 
    push(@ys, @values);
    $expecting_xs = 1;
  }
}

if(!$expecting_xs) {
  die("Odd number of lines");
}

my($xmin, $xmax) = extremes(@xs);
my($ymin, $ymax) = extremes(@ys);

print "xmin: $xmin xmax: $xmax ymin: $ymin ymax: $ymax\n";
print Dumper(\@xs), Dumper(\@ys);

sub extremes {
  my(@values) = @_;
  return undef unless @values;
  my $min = shift(@values);
  my $max = $min;
  for my $value (@values) {
    $max = $value if $value > $max;
    $min = $value if $value < $min;
  }
  return $min, $max;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T16:02:43.350

哎呀，误读了这个问题，您想要 AoAoH 还是 AoH，这取决于第一条线之后的每条线是代表一条线，还是都只是要分别绘制的点。如果文件中的每一行都成为图中的一行，我会这样写：

```
#!/usr/bin/perl

use strict;
use warnings;
use List::Util qw/min max/;

my @x_points         = split " ", scalar <>; #read in the x axis labels
my ($x_min, $x_max)  = (sort { $a <=> $b } @x_points)[0,-1];
my ($y_min, $y_max)  = (0, 0);

#lines is an AoAoH, first layer are the lines to be drawn
#second layer is a list of coords
#third layer are the x and y coords
my @lines;
while (<>) {
    my @y_points = split;
    #if the two arrays are not the same size, we have a problem
    die "invalid file\n" unless @y_points == @x_points;

    $y_min = max($y_min, @y_points);
    $y_max = min($y_max, @y_points);

    push @lines, [ 
        map { { x => $x_points[$_], y => $y_points[$_] } }  
    0 .. $#x_points 
    ];
}

use Data::Dumper;

print "x min and max $x_min $x_max\n",
      "y min and max $y_min $y_max\n",
      "data:\n",
      Dumper(\@lines);

my $i;
for my $line (@lines) {
    $i++;
    print "line $i is made up of points: ",
        (map { "($_->{x}, $_->{y}) " } @$line), "\n";
} 
```

如果它们只是要绘制的点，我将如何处理它：

```
#!/usr/bin/perl

use strict;
use warnings;
use List::Util qw/min max/;

my @x_points         = split " ", scalar <>; #read in the x axis labels
my ($x_min, $x_max)  = (sort { $a <=> $b } @x_points)[0,-1];
my ($y_min, $y_max)  = (0, 0);

#lines is an AoAoH, first layer are the lines to be drawn
#second layer is a list of coords
#third layer are the x and y coords
my @points;
while (<>) {
    my @y_points = split;
    #if the two arrays are not the same size, we have a problem
    die "invalid file\n" unless @y_points == @x_points;

    $y_min = max($y_min, @y_points);
    $y_max = min($y_max, @y_points);

    push @points,
        map { { x => $x_points[$_], y => $y_points[$_] } }
        0 .. $#x_points;
}

use Data::Dumper;

print "x min and max $x_min $x_max\n",
      "y min and max $y_min $y_max\n",
      "data:\n",
      Dumper(\@points);

print "Here are the points: ", 
    (map { "($_->{x}, $_->{y}) " } @points), "\n"; 
```

# sql - 如何在服务器场中使用 sql 会话状态模拟会话结束事件

> ID：714501
> 
> 赞同：1
> 
> 时间：2009-04-03T15:38:59.943
> 
> 标签：sql, session-state, load-balancing

使用 SQL 会话状态时，会话结束事件不可用。我们有一个使用此事件的现有应用程序，但我们需要将其切换到 SQL 会话状态，以便我们可以为应用程序设置服务器场。我们希望在负载均衡器上使用“粘性会话”，以便我们可以继续使用 inproc 会话状态，但无法使其正常工作。

有没有人遇到过类似的挑战或有任何想法？

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-03T18:07:47.997

您可以在存储会话状态的表上创建一个标志，并将其设置为一个值以指示会话已结束。

# visual-studio - 清除所有的 Visual Studio 即时窗口命令

> ID：714503
> 
> 赞同：111
> 
> 时间：2009-04-03T15:39:06.543
> 
> 标签：visual-studio, visual-studio-2008, immediate-window

是否有清除 Visual Studio 中的即时窗口的命令？

我讨厌不得不在那里抓住鼠标右键单击菜单 - 宁愿只输入“cls”或其他东西。

* * *

## 回答 #1

> 赞同：150
> 
> 时间：2009-04-03T15:45:56.807

要清除即时窗口，您可以使用`>cls`，它是 的预定义命令[别名](https://msdn.microsoft.com/en-us/library/c3a0kd3x.aspx)`>Edit.ClearAll`。

[MSDN 文章](https://msdn.microsoft.com/en-us/library/c3a0kd3x.aspx)列出了所有预定义的别名，您也可以定义自己的别名。（对于 VS 2010 及更早版本，[自定义别名](https://msdn.microsoft.com/en-us/library/xasxzd71(v=vs.100).aspx)在另一篇文章中进行了描述。）仔细查看，其中有一大堆，其中一些甚至可能源于 MS-DOS DEBUG.EXE（特别是`>d`, `>g`, `>p`, `>q`,和 >`t`浮现在脑海中）。

* * *

另外值得注意的是，它只需按下两个键：上下文菜单 > 全部清除调用相同的命令，并且可以使用键盘进行导航。因此，在即时窗口中，您可以按`Context Menu`, `L`。

如果您的键盘上没有[`context-menu`键](https://en.wikipedia.org/wiki/Menu_key)（您知道，介于`Right Alt`和之间的那个`Right Ctrl`），您可以使用`Shift`+`F10`代替。

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2009-04-03T15:53:51.080

```
>cls 
```

似乎为我做。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2015-09-17T14:18:22.287

1.  将鼠标光标放在立即窗口中。
2.  右键单击鼠标并选择“全部清除”。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-04-03T15:42:19.420

找到了...

">Edit.ClearAll"

或者

">cls"

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-04-13T03:19:24.853

以下是如何在运行时执行此操作：

1.  在您的应用程序中引用 EnvDTE dll。

2.  根据需要创建并使用此功能。

```
Public Sub ClearImmediateWindow()
  Try
    Dim vsWindowKindImmediateWindow As String _ 
          = "{ECB7191A-597B-41F5-9843-03A4CF275DDE}"
    Try
      Dim obj As Object = System.Runtime.InteropServices.Marshal._ 
                          GetActiveObject("VisualStudio.DTE.10.0")
      If obj IsNot Nothing Then
        Dim DTE2 As EnvDTE80.DTE2 = CType(obj, EnvDTE80.DTE2)
        For Each wndw As EnvDTE.Window In DTE2.Windows
          If wndw.ObjectKind = vsWindowKindImmediateWindow Then
            wndw.Activate()
            DTE2.ExecuteCommand("Edit.ClearAll")
            Exit For
          End If
        Next
      End If
    Catch comEx As COMException
      ' Not running from within the VS IDE?
    Catch ex As Exception
      Throw ex
    End Try
  Catch ex As Exception
    ' Handle this as you desire.
  End Try
End Sub
  End Sub 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-02-13T00:59:34.607

对于 Visual Studio 2012，我使用：

```
Public Sub ClearImmediateWindow()
    Dim dte As EnvDTE80.DTE2 = Marshal.GetActiveObject("VisualStudio.DTE.11.0")
    dte.Windows.Item("Immediate Window").Activate() 'Activate Immediate Window  
    dte.ExecuteCommand("Edit.SelectAll")
    dte.ExecuteCommand("Edit.ClearAll")
    Marshal.ReleaseComObject(dte)
End Sub 
```

从代码中自动清除即时窗口（需要将 DTE 引用添加到项目中）。如果它不起作用，请根据您的 Visual Studio 版本尝试`VisualStudio.DTE.8.0`, 。`VisualStudio.DTE.9.0``...`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-07-22T21:07:49.960

我几乎逐字逐句地使用了最后一个答案并且它有效，尽管我希望将注意力重新放在它的位置上。这是略微改进的 C# 版本。我使用配置开关启用它。

```
#if DEBUG
    if (GetIni("Debug", "ClearImmediateWindow", true)) {
        try {
            var dte = (EnvDTE.DTE) Marshal.GetActiveObject("VisualStudio.DTE.15.0");
            var me  = dte.ActiveWindow;
            dte.Windows.Item("Immediate Window").Activate();
            dte.ExecuteCommand("Edit.ClearAll");
            me.Activate();
        }
        catch { /* Meh! */ } 
```

# 万一

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-01-07T22:13:48.143

那些想知道如何在 Visual Studio Mac 上清除即时窗口的人，只需在窗口内右键单击并选择选项**清除**

# c++ - 开源 Visual Studio 项目分发噩梦

> ID：714504
> 
> 赞同：7
> 
> 时间：2009-04-03T15:39:36.010
> 
> 标签：c++, c, visual-studio, compiler-construction, visual-c++

每次 Microsoft 发布新版本的 Visual Studio 时，他们总是要求我将我的解决方案和项目文件转换为“最新版本”。即使使用像“Hello World”这样简单的解决方案，我也需要通过他们的转换向导！

而且，更糟糕的是，新的 Visual Studio 解决方案文件与旧版本的 Visual Studio 不兼容。

对于与一群人一起工作的任何人……或任何希望为他们的项目分发源代码的人来说，这真是一场噩梦。

有没有什么好的方法可以分发一个 Visual Studio 项目，并允许使用旧版本 Visual Studio 的人仍然使用它？这是一个简单的 C 程序，没有使用任何漂亮的选项。我只能访问 Visual Studio 2008，而 Visual Studio 不提供向后“转换”向导。使用 nmake+makefile 发布源代码来构建程序是否有意义？似乎 nmake 文件格式在一段时间内没有发生显着变化，并且可以提供适用于更广泛版本的 Visual Studio 的 makefile。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-03T17:23:11.083

执行此操作的正常方法是将 vs 项目文件放在解决方案的子目录中。例如

```
solution
 - build
 -- vc6
 -- vc7
 -- vc8
 -project1
 -- src
 -- build
 --- vc6
 --- vc7
 --- vc8
 -project2
 -- src
 -- build
 --- vc6
 --- vc7
 --- vc8 
```

然后当你得到一个新版本的 vs - 复制最后一个项目目录，例如 vc7 到 vc8 - 对解决方案做同样的事情 - 在文本编辑器中打开解决方案和项目文件以修复任何路径 - 最后在新版本中打开解决方案的 vs 并让它转换您的项目 - （使用源代码控制，好像一个或您的路径错误，它会更新旧目录中的项目）

这很烦人，但你只需要每隔几年做一次。

这就是我们过去的做法，但是有一种更好的方法，那就是使用[CMake](http://cmake.org)生成您的项目。我们现在在工作中使用它，它允许使用单个项目定义在 Windows 和 unix 上本地工作。在 windows 上，我们使用 vs 项目，在 unix 上，我们使用 eclipse 和 makefile。此外，CMake 允许您抽象常见的项目设置，如编译器和链接器标志，因此只需在一处修改它们。

我现在将 CMake 用于所有 c++ 项目，无论我是否需要它的多平台功能。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-03T17:12:14.633

您可以使用[CMake](http://www.cmake.org/)作为项目的构建工具。它将为您生成 VS 项目文件，您只需打开文件并使用它来构建项目。转换问题无关紧要，因为您可以使用 CMake 再次构建它。

在这种情况下，CMake 的优势在于可移植性和版本独立性（还有跨平台构建能力，但这可能不相关）。然而，CMake 确实有一些学习曲线，它并不像使用项目文件那么简单，但它确实解决了您遇到的问题。由于您的项目相对简单，因此它可能是您的解决方案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-03T15:50:15.143

没有简单的答案。不过，我希望我们做到了。从 2005 年开始，您还需要打包一个 redist 包或与运行时进行静态链接，这种情况只会变得更糟。如果你有一个 2008 年的静态链接二进制文件与更早一代（早于 2005 年）的应用程序对话，我不知道它会做什么。根据 MS 的说法，这应该可行。

您可以安全地假设您的所有用户都将拥有 Visual Studio 的副本吗？他们都运行相同的版本吗？（我知道，现在速成版是免费的......）如果您继续走这条路，并让他们都使用相同版本的 VS2008 以使周围的每个人的生活更轻松，您将需要对您的用户群进行困难的教育。

不过，我宁愿使用 make/gcc 而不是绕着公园转。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-03T16:27:52.277

我认为使用 nmake 是可行的方法 - 不幸的是，VC6 是最后一个可以根据项目自动为您创建一个的版本。

但是，您说您的项目非常简单，因此这应该不是主要障碍。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-03T17:37:45.183

我建议您使用开源流程。将您的代码发布为 VS 2008，并允许使用早期版本的人为这些版本贡献解决方案文件。这就是开源方式。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-03T23:30:34.710

我见过商业 Windows 库使用的一种解决方案是使用 VS 版本作为后缀命名解决方案文件（例如：Project_VS2005.sln、Project_VS2008.sln 等）。您仍然必须使它们保持同步，但您不必更改文件路径、包含目录或修改实际的解决方案文件；只需保留多个文件，每个支持的 VS 版本一个。您必须对项目文件做同样的事情，但至少您不必更改内容以支持不同的目录结构，除非您想支持与多个 VS 版本并排构建，并且在这种情况下您只需要更改每个不同项目文件的输出设置。

并不是说这是一个很好的解决方案，而只是另一种选择。

# c# - 如何使用 WebBrowser 控件以编程方式更改打印机设置？

> ID：714507
> 
> 赞同：18
> 
> 时间：2009-04-03T15:41:15.850
> 
> 标签：c#, winforms, printing, webbrowser-control

我终于想出了[如何在](https://stackoverflow.com/questions/707518/printing-transformed-xml)不提示用户或不显示 IE 窗口的情况下打印转换后的 XML，但现在我需要指定副本数量以及可能的其他打印机设置。

有没有办法以编程方式更改 WebBrowser 控件上的打印机设置？

有问题的代码：

```
private static void PrintReport(string reportFilename)
{
    WebBrowser browser = new WebBrowser();

    browser.DocumentCompleted += browser_DocumentCompleted;

    browser.Navigate(reportFilename);
}

private static void browser_DocumentCompleted
    (object sender, WebBrowserDocumentCompletedEventArgs e)
{
    WebBrowser browser = sender as WebBrowser;

    if (null == browser)
    {
        return;
    }

    browser.Print();

    browser.Dispose();
} 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-03T15:52:22.470

我成功的唯一方法是即时修改注册表（并将它们改回不影响其他任何东西）。

您可以在 CurrentUser 下的“Software\Microsoft\Internet Explorer\PageSetup”中找到所需的设置。

要更改打印机，您可以使用以下命令：

```
using System.Management

public static bool SetDefaultPrinter(string defaultPrinter)
{
    using (ManagementObjectSearcher objectSearcher = new ManagementObjectSearcher("SELECT * FROM Win32_Printer"))
    {
        using (ManagementObjectCollection objectCollection = objectSearcher.Get())
        {
            foreach (ManagementObject mo in objectCollection)
            {
                if (string.Compare(mo["Name"].ToString(), defaultPrinter, true) == 0)
                {
                    mo.InvokeMethod("SetDefaultPrinter", null, null);
                    return true;
                }
            }
        }
    }
    return false;
} 
```

至于份数，您可以随时将 WebBrowser.Print 放在 while 循环中。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2013-04-10T23:23:58.623

```
 string strKey = "Software\\Microsoft\\Internet Explorer\\PageSetup";
        bool bolWritable = true;

        RegistryKey oKey = Registry.CurrentUser.OpenSubKey(strKey, bolWritable);
        Console.Write(strKey);

        if (stringToPrint.Contains("Nalog%20za%20sluzbeno%20putovanje_files"))
        {
            oKey.SetValue("margin_bottom", 15);
            oKey.SetValue("margin_top", 0.19);
        }
        else
        {
            //Return onld walue
            oKey.SetValue("margin_bottom", 0.75);
            oKey.SetValue("margin_top", 0.75);
        } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-11-29T15:37:52.163

您需要通过代码更改注册表设置以更改 Internet Explorer 或 Web 浏览器控件的设置。查看下面的链接，它描述了如何执行此操作，如果您需要使用注册表更改更多选项，则使用 regedit.exe 查找 Internet Explorer 的其他键。

[http://support.microsoft.com/kb/236777](http://support.microsoft.com/kb/236777)

ps：您应该注意，您通过代码对 Internet Explorer 的注册表设置所做的任何更改都将保留在您的系统/用户帐户中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-12-04T19:27:43.877

这对我来说效果很好，但是我使用的是 .NET 3.5

```
this.webBrowser1.ShowPrintDialog(); 
```

# domain-driven-design - 通过聚合根访问实体：简单示例？

> ID：714509
> 
> 赞同：7
> 
> 时间：2009-04-03T15:42:11.013
> 
> 标签：domain-driven-design

您能否展示通过 ita 聚合根访问聚合中实体内容的简单示例？我不清楚您将如何表示聚合权限以反映这些概念。蒂亚。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-05T14:24:10.107

您通常会将其封装在 Aggregate 在其合约上公开的命令中。

例如，对于 Order Aggregate，您可以使用从 GUI 获得的数据添加 OrderLines。

```
// This is the Order Aggregate Root
public class Order
{
    private readonly int id;
    private readonly Customer customer; // Customer is another Aggregate
    private readonly IList<OrderLine> orderLines;
    private readonly IOrderLineFactory orderLineFactory;

    public Order(int id, Customer customer, IOrderLineFactory orderLineFactory)
    {
        this.id = id;
        this.customer = customer;
        this.orderLines = new List<OrderLine>();
        this.orderLineFactory = orderLineFactory;
    }

    public void AddOrderLine(Item item, int quantity)
    {
        OrderLine orderLine = orderLineFactory.Create(this, item, quantity);
        orderLines.Add(orderLine);
    }
} 
```

# sql - 如何使用多个字段从表中提取重复记录？

> ID：714517
> 
> 赞同：0
> 
> 时间：2009-04-03T15:44:47.183
> 
> 标签：sql, sql-server, tsql

我已经检查了[使用临时表删除重复记录](https://stackoverflow.com/questions/633860/deleting-duplicate-records-using-a-temporary-table)的问题，但它还不足以帮助我解决这个问题：

***我有一个托管在SQL 2000 Server***上的大约 200,000 个地址位置的表。这张表存在一个巨大的问题，就是多年来各方的无效输入导致表中数据重复。我需要输出重复记录的列表，以便开始清理它们的漫长过程。

所以考虑下面的表结构：

```
Table Company(   
  CompanyId NVarChar(10) Not Null Constraint PK_Locations Primary Key,   
  CompanyName NVarChar(30),   
  CompanyAddress NVarChar(30),   
  CompanyCity NVarchar(30), 
  CompanyState Char(2),   
  CompanyZip NVarChar(10),   
  DateCreated DateTime, 
  LastModified DateTime,  
  LastModifiedUser NVarChar(64) 
) 
```

对于第一次解析，我什至不会担心拼写错误和变化，这将是一个更大的噩梦，我什至还没有第一个解决问题的线索。

因此，对于这一部分，当多个记录在以下条件下匹配时，一条记录被认为是重复的：

> （公司名称或公司地址）和 CompanyCity 和 CompanyState

邮编被排除在外，因为很多地点都缺少邮政编码，而且输入错误的地方太多，如果我把它们包括在内，只会导致报告的准确性大大降低。

我意识到，一家公司在一个城市/州内可能合法地有多个地点[例如麦当劳，就在我的脑海中]，并且在一个城市和州内的一个地址可能合法地有多个公司[对于例如在购物中心或办公楼内]，但现在我们将认为这些至少需要一定程度的人类关注，并将它们包含在报告中。

单个字段上的匹配是小菜一碟，但是当我到达多个字段时，我会陷入困境，尤其是当有些是有条件的时。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T15:53:49.003

```
WITH q AS (
          SELECT Company.*,
                 ROW_NUMBER() OVER (PARTITION BY CompanyState, CompanyCity, CompanyName ORDER BY CompanyID) AS rnName,
                 ROW_NUMBER() OVER (PARTITION BY CompanyState, CompanyCity, CompanyAddress ORDER BY CompanyID) AS rnAddress
          FROM Company
          )
SELECT    *
WHERE     rnName > 1 OR rnAddress > 1 
```

但请注意，如果您的数据如下所示：

```
CompanyID    CompanyName  CompanyAddress 
---------    -----------  --------------
1            McDonalds    Avenue 1
2            McDonalds    Avenue 2
3            Starbucks    Avenue 2 
```

, 然后这两条记录`2`都`3`将被删除（这是您要求的，但可能不是您想要的）

如果您只想列出所有重复的行，请发出：

```
SELECT  *
FROM    Company co
WHERE   EXISTS
        (
        SELECT  1
        FROM    Company cn
        WHERE   cn.CompanyState = co.CompanyState
                AND cn.CompanyCity = co.CompanyCity
                AND cn.CompanyName = co.CompanyName
                AND cn.CompanyID <> co.CompanyID
        )
        OR EXISTS
        (
        SELECT  1
        FROM    Company ca
        WHERE   ca.CompanyState = co.CompanyState
                AND ca.CompanyCity = co.CompanyCity
                AND ca.CompanyAddress = co.CompanyAddress
                AND ca.CompanyID <> co.CompanyID
        ) 
```

这也将起作用`SQL Server 2000`。

拥有索引`(CompanyState, CompanyCity, CompanyName)`并将`(CompanyState, CompanyCity, CompanyAddress)`大大改善此查询。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T15:55:54.273

```
SELECT
     C1.CompanyID,
     C2.CompanyID
FROM
     Company C1
INNER JOIN Company C2 ON
     (C2.CompanyName = C1.CompanyName OR C2.CompanyAddress = C1.CompanyAddress) AND
     C2.CompanyCity = C1.CompanyCity AND
     C2.CompanyState = C2.CompanyState AND
     C2.CompanyID > C1.CompanyID 
```

如果您有三个或更多匹配项，那么它们将在列表中出现多次。有多种方法可以处理这个问题，具体取决于您希望从查询中得到什么。

我还强烈建议您研究更好的前端编码来限制地址如何进入您的系统以及用户培训。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T15:55:59.873

尝试这样的事情......

```
Select field1, field2, ... etc, count(*)
FROM Company,
GROUP BY field1, field2, ...
HAVING count(*) > 1 
```

这应该向您显示重复的内容。

# sql - SQL Server 上的内部连接 UDF

> ID：714520
> 
> 赞同：1
> 
> 时间：2009-04-03T15:45:56.183
> 
> 标签：sql, sql-server

我有一个执行复杂查询并返回一个表 (UDF1) 的表值函数，然后我有另一个表，它有一堆可用于减少此 UDF 输出的行。

是否可以连接这两个并将表中的列作为参数传递给 UDF ？

像，

```
SELECT * 
FROM UDF1 (TBL1.Column1, TBL1.Column2)
INNER JOIN TBL1
           ON (TBL1.Column3 = UDF1.Col3) 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-03T17:10:16.090

您需要在此处使用[CROSS APPLY](http://msdn.microsoft.com/en-us/library/ms175156.aspx)语法。

为了合理的性能，如果可能的话，UDF 应该是内联的而不是多语句的。

# sql - LDAP 建模最佳实践

> ID：714523
> 
> 赞同：8
> 
> 时间：2009-04-03T15:46:11.207
> 
> 标签：sql, database-design, active-directory, ldap

我非常熟悉关系建模，但对 LDAP 建模很陌生，并且正在寻找设计 LDAP 模式的最佳实践。想知道 LDAP 世界中第三范式和其他实践的等价物是什么？

非常感谢扩展此主题的白皮书链接。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-21T11:20:28.437

选择适合您预期目的的标准模式，例如[core](https://www.rfc-editor.org/rfc/rfc2256)、[cosine](http://www.faqs.org/rfcs/rfc4524.html)、[inetOrgPerson](https://www.rfc-editor.org/rfc/rfc2798)、[eduPerson](http://middleware.internet2.edu/eduperson/)、[Java Objects](http://www.ietf.org/rfc/rfc2713.txt)等[。](http://docs.sun.com/source/816-6699-10/schemaov.html)大多数 LDAP 服务器都带有一组默认值。

首选现有元素，但如果您需要[扩展架构](http://www.openldap.org/doc/admin22/schema.html)，请使用 comCompany（您公司的域名或其他唯一标识符）作为前缀，以避免与未来的标准元素发生冲突。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-07T14:21:13.450

我们的经验表明模式和 DIT 的设计非常依赖于 LDAP 服务器的用途。

对于模式，通常最好坚持行业或 LDAP 服务器供应商的“标准”。

对于 DIT 的结构，除非它是用于文件和打印服务（即 Active Directory）或 OES（Netware），否则通常“平面”结构可以更好地扩展。

如果它是一个大型实现（即> 100k），则应尽可能避免使用组。

-吉姆

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-17T01:33:03.483

根据我的经验，尽可能多地去规范化，作为目标，如前所述，用 LDAP 查找非常快，但这意味着插入记录可能需要更长的时间，一段时间后。确保您可以保留 ldap 的备份也很重要。

您可能希望查看创建各种类，例如用户，但如果需要，还可以为授权用户创建一个类。

看看可能需要什么。例如，在我所在的大学里，我们意识到一些与大学只存在关系的人会有一个 LDAP 帐户。

当您确定 ldap 中将包含哪些类型的用户或资源时，它将帮助您确定如何设置人员。例如，如果您有一个类只有一个用户名或标识符和一个密码，也许还有一个证书，那么这将有助于提高灵活性。

如果您要允许人们从他们的 unix 帐户登录，那么某些类必须在模式中。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-03T20:40:01.873

LDAP 本质上甚至*不*符合第一范式 - 它的某些属性可以包含多个值。

LDAP 是一个为优化读取/查找性能而设计的系统，例如，它更适合您读取/查找数据的方式比更改数据（--> 目录；您的公司电话簿不会改变）的情况一天几十次）。

LDAP 不适合或设计用于替代或与擅长数据输入/转换的标准关系数据库系统竞争，您的大量操作将插入和/或更新数据。这就是 RDBMS 非常适合的地方。

所以，最后：LDAP 与 RDBMS 确实是一个初学者 - 这两个世界是截然不同的，并且在他们的工作风格上也完全不同。我不建议盲目地将某个世界的某些东西应用到另一个世界——这将是一场糟糕的比赛。

至于 LDAP 模式设计的灵感——我肯定会看看 Microsoft 的 Active Directory、Novell 的 eDirectory（或现在所谓的任何东西），以及可能的其他 LDAP 目录，并从他们的设计中学习。

马克

# ruby-on-rails - Rails 中的组合字段

> ID：714527
> 
> 赞同：3
> 
> 时间：2009-04-03T15:47:24.933
> 
> 标签：ruby-on-rails

解决问题的最佳方法是什么？用户输入和编辑字符串“tom had a dog”。我希望模型和数据库将“tom”和“had a dog”存储为单独的字段。我记得在处理电话号码字符串时解决了这个问题，但不太记得我是怎么做的。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-03T15:53:43.433

您可以在模型中创建一个未映射到数据库字段的设置器...此设置器将包含确定如何将字符串分成两部分的逻辑，然后相应地设置两个字段：

```
class MyModel

  def mysetter=(string)
      # your logic to split up the string
      field1 = ...
      field2 = ...
  end
end 
```

# macos - 在 Mac OS X 上安装本地 LAMP 以进行 Web 开发的最简单方法是什么？

> ID：714528
> 
> 赞同：0
> 
> 时间：2009-04-03T15:47:56.943
> 
> 标签：macos, webserver, lamp

我是 mac os x 的新手。在 Windows XP 世界中，有一些可用的软件包，如 easyPHP、wampserver、uniformserver，使您能够拥有一个完整的本地网络服务器，其中包含通过自动安装程序配置的 php、mysql。真的很方便。

我的新 Mac 上也需要同样的东西。我知道 mac os x 带有本地网络服务器。这已经预装了php，mysql吗？

我想让你们就拥有这个本地灯的最简单方法提供建议，这样我就可以继续在这台漂亮而闪亮的机器上进行开发。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-03T15:53:27.443

问：LAMP是什么意思？

答案：Linux Apache MySQL PHP

问：如果这是在 Mac 上运行的？

答：试试[MAMP](http://sourceforge.net/projects/mamp)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-03-18T22:16:37.577

XAMPP也是一个很好的选择

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T15:51:38.760

[http://foundationphp.com/tutorials/php_leopard.php](http://foundationphp.com/tutorials/php_leopard.php)

[http://dev.mysql.com/doc/refman/5.0/en/mac-os-x-installation.html](http://dev.mysql.com/doc/refman/5.0/en/mac-os-x-installation.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-03T15:51:51.800

OS X 已经安装了 php 和 apache。它默认没有安装 mysql，但您可以从[mysql 网站](http://www.mysql.com/)轻松下载 Mac OS X 版本的 tarball 版本或软件包版本。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-03T15:53:02.937

Mac OS X 本质上是 Linux。

Mac OS X 已经包含 Apache。打开文件共享，您将打开 Apache。

您需要为 Mac OS X 下载并安装 MySQL。 [http://dev.mysql.com/downloads/mysql/5.1.html](http://dev.mysql.com/downloads/mysql/5.1.html)

您需要编辑 httpd.conf 以启用 mod_apache。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-08-02T23:45:53.747

五年后，我相信一些新人仍在阅读这个问题和现有答案。

就个人而言，我强烈推荐使用**[Homebrew](http://brew.sh/)**在 mac os x 上拥有一个完美的开发环境。不仅是 PHP，homebrew 还打开了通往开源工具包/库/应用程序天堂的所有大门。

这是我与此主题相关的[另一个答案。](https://stackoverflow.com/questions/25095942/problems-compile-phalcon-on-osx-10-9/25100138#25100138)

# html - 博主布局问题

> ID：714557
> 
> 赞同：0
> 
> 时间：2009-04-03T15:54:24.493
> 
> 标签：html, css, xhtml, layout

这是我的博客： http: [//laschavasdeflickr.blogspot.com](http://laschavasdeflickr.blogspot.com)

如您所见，那里有一条灰线（#bbbbbb），它不在边缘，因为我更改了帖子列的宽度，所以我正疯狂地试图修复它。如果有人能指出我做错了什么，我将不胜感激。

```
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html expr:dir='data:blog.languageDirection' xmlns='http://www.w3.org/1999/xhtml' xmlns:b='http://www.google.com/2005/gml/b' xmlns:data='http://www.google.com/2005/gml/data' xmlns:expr='http://www.google.com/2005/gml/expr'>

<head>
  <b:include data='blog' name='all-head-content'/>
  <title><data:blog.pageTitle/></title>
  <b:skin><![CDATA[/*
-----------------------------------------------
Blogger Template Style
Name:     Rounders 3
Designer: Douglas Bowman
URL:      www.stopdesign.com
Date:     27 Feb 2004
Updated by: Blogger Team
----------------------------------------------- */

/* Variable definitions
  ====================
   <Variable name="mainBgColor" description="Main Background Color"
             type="color" default="#eec" value="#eeeecc">
   <Variable name="mainTextColor" description="Text Color" type="color"
             default="#333" value="#333333">
   <Variable name="postTitleColor" description="Post Title Color" type="color"
             default="#333" value="#333333">
   <Variable name="dateHeaderColor" description="Date Header Color"
             type="color" default="#586" value="#558866">
   <Variable name="borderColor" description="Post Border Color" type="color"
             default="#bbb" value="#bbbbbb">

   <Variable name="mainLinkColor" description="Link Color" type="color"
             default="#456" value="#445566">
   <Variable name="mainVisitedLinkColor" description="Visited Link Color"
             type="color" default="#234" value="#223344">

   <Variable name="titleBgColor" description="Page Header Background Color"
             type="color" default="#357" value="#223344">
   <Variable name="titleTextColor" description="Blog Title Color"
             type="color" default="#fff" value="#ffffff">

   <Variable name="topSidebarHeaderColor"
             description="Top Sidebar Title Color"
             type="color" default="#fff" value="#ffffff">
   <Variable name="topSidebarBgColor"
             description="Top Sidebar Background Color"
             type="color" default="#586" value="#558866">
   <Variable name="topSidebarTextColor" description="Top Sidebar Text Color"
             type="color" default="#fff" value="#ffffff">
   <Variable name="topSidebarLinkColor" description="Top Sidebar Link Color"
             type="color" default="#fff" value="#ffffff">
   <Variable name="topSidebarVisitedLinkColor"
             description="Top Sidebar Visited Link Color"
             type="color" default="#fff" value="#ffffff">
   <Variable name="bottomSidebarHeaderColor"
             description="Bottom Sidebar Title Color"
             type="color" default="#abc" value="#aabbcc">

   <Variable name="bottomSidebarLinkColor"
             description="Bottom Sidebar Link Color"
             type="color" default="#99ddbb" value="#99ddbb">
   <Variable name="bottomSidebarVisitedLinkColor"
             description="Bottom Sidebar Visited Link Color"
             type="color" default="#ffffff" value="#ffffff">
   <Variable name="bodyFont" description="Text Font" type="font"
             default="normal normal 100% 'Trebuchet MS',Verdana,Arial,Sans-serif" value="normal normal 100% 'Trebuchet MS',Verdana,Arial,Sans-serif">
   <Variable name="pageTitleFont" description="Blog Title Font" type="font"
             default="normal bold 200% 'Trebuchet MS',Verdana,Arial,Sans-serif" value="normal bold 200% 'Trebuchet MS',Verdana,Arial,Sans-serif">
   <Variable name="descriptionFont" description="Blog Description Font" type="font"
             default="normal normal 100% 'Trebuchet MS',Verdana,Arial,Sans-serif" value="normal normal 100% 'Trebuchet MS',Verdana,Arial,Sans-serif">
   <Variable name="headerFont" description="Sidebar Title Font" type="font"
             default="normal bold 100% 'Trebuchet MS',Verdana,Arial,Sans-serif" value="normal bold 100% 'Trebuchet MS',Verdana,Arial,Sans-serif">
   <Variable name="postTitleFont" description="Post Title Font" type="font"
             default="normal bold 135% 'Trebuchet MS',Verdana,Arial,Sans-serif" value="normal bold 135% 'Trebuchet MS',Verdana,Arial,Sans-serif">
*/

body {
  background:#123;
  margin:0;
  text-align:center;
  line-height: 1.5em;
  font: x-small Trebuchet MS, Verdana, Arial, Sans-serif;
  color:$mainTextColor;
  font-size/* */:/**/small;
  font-size: /**/small;
  }

/* Page Structure
----------------------------------------------- */
/* The images which help create rounded corners depend on the 
   following widths and measurements. If you want to change 
   these measurements, the images will also need to change.
   */
#outer-wrapper {
  width:740px;
  margin:0 auto;
  text-align:left;
  font: $bodyFont;
  }
#main-wrap1 {
  width:525px;
  float:left;
  background:$mainBgColor url("http://farm3.static.flickr.com/2297/2045724843_5d984f0011_o.gif") no-repeat left bottom;
  margin:15px 0 0;
  padding:0 0 20px;
  color:$mainTextColor;
  font-size:97%;
  line-height:1.5em;
  word-wrap: break-word; /* fix for long text breaking sidebar float in IE */
  overflow: hidden;     /* fix for long non-text content breaking IE sidebar float */
  }
#main-wrap2 {
  float:left;
  width:100%;
  background:url("http://farm3.static.flickr.com/2357/2046504320_15aec77d32_o.gif") no-repeat left top;
  padding:10px 0 0;
  }
#main {
  background:url("http://www.blogblog.com/rounders3/rails_main.gif") repeat-y;
  padding:0;
  }
#sidebar-wrap {
  width:200px;
  float:right;
  margin:15px 0 0;
  font-size:97%;
  line-height:1.5em;
  word-wrap: break-word; /* fix for long text breaking sidebar float in IE */
  overflow: hidden;     /* fix for long non-text content breaking IE sidebar float */
  }

.main .widget { 
  margin-top: 4px;
  width: 525px;
  padding: 0 13px;
}

.main .Blog {
  margin: 0;
  padding: 0;
  width: 525px;
}

/* Links
----------------------------------------------- */
a:link {
  color: $mainLinkColor;
  }
a:visited {
  color: $mainVisitedLinkColor;
  }
a:hover {
  color: $mainVisitedLinkColor;
  }
a img {
  border-width:0;
  }

/* Blog Header
----------------------------------------------- */
#header-wrapper {
  background:$titleBgColor url("http://www.blogblog.com/rounders3/corners_cap_top.gif") no-repeat left top;
  margin:22px 0 0 0;
  padding:8px 0 0 0;
  color:$titleTextColor;
  }
#header {
  background:url("http://www.blogblog.com/rounders3/corners_cap_bot.gif") no-repeat left bottom;
  padding:0 15px 8px;
  }
#header h1 {
  margin:0;
  padding:10px 30px 5px;
  line-height:1.2em;
  font: $pageTitleFont;
  }
#header a,
#header a:visited {
  text-decoration:none;
  color: $titleTextColor;
  }
#header .description {
  margin:0;
  padding:5px 30px 10px;
  line-height:1.5em;
  font: $descriptionFont;
}

/* Posts
----------------------------------------------- */
h2.date-header {
  margin:0 28px 0 20px;
  font-size:85%;
  line-height:2em;
  text-transform:uppercase;
  letter-spacing:.2em;
  color:$dateHeaderColor;
  }
.post {
  margin:.3em 0 25px;
  padding:0 0;
  border:1px dotted $borderColor;
  border-width:1px 0;
  }
.post h3 {
  margin:0;
  line-height:1.5em;
  background:url("http://www.blogblog.com/rounders3/icon_arrow.gif") no-repeat 10px .5em;
  display:block;
  border:1px dotted $borderColor;
  border-width:0px 1px 1px;
  padding:2px 14px 2px 29px;
  color: $postTitleColor;
  font: $postTitleFont;
  }
.post h3 a, .post h3 a:visited {
  text-decoration:none;
  color: $postTitleColor;
  }
a.title-link:hover {
  background-color: $borderColor;
  color: $mainTextColor;
  }
.post-body {
  border:1px dotted $borderColor;
  border-width:0 0px 0px;
  border-bottom-color:$mainBgColor;
  padding:10px 14px 1px 5px;
  }
html>body .post-body {
  border-bottom-width:0;
  }

.post p {
  margin:0 0 .75em;
  }
.post-footer {
  background: #ffffff;
  margin:0;
  padding:2px 14px 2px 29px;
  border:1px dotted $borderColor;
  border-width:1px;
  font-size:100%;
  line-height:1.5em;
  color: #666666;
}
.post-footer p { 
  margin: 0;
}
html>body .post-footer {
  border-bottom-color:transparent;
  }

.uncustomized-post-template .post-footer {
  text-align: right;
}

.uncustomized-post-template .post-author,
.uncustomized-post-template .post-timestamp {
  display: block;
  float: left;
  text-align:left;
  margin-right: 4px;
}

.post-footer a { 
  color: #456;
 }
.post-footer a:hover { 
  color: #234;
 }
a.comment-link {
  /* IE5.0/Win doesn't apply padding to inline elements,
     so we hide these two declarations from it */
  background/* */:/**/url("http://www.blogblog.com/rounders/icon_comment.gif") no-repeat 0 45%;
  padding-left:14px;
  }
html>body a.comment-link {
  /* Respecified, for IE5/Mac's benefit */
  background:url("http://www.blogblog.com/rounders3/icon_comment.gif") no-repeat 0 45%;
  padding-left:14px;
  }
.post img {
  margin:0 0 5px 0;
  padding:4px;
  border:1px solid $borderColor;
  }
blockquote {
  margin:.75em 0;
  border:1px dotted $borderColor;
  border-width:1px 0;
  padding:5px 15px;
  color: $dateHeaderColor;
  }
.post blockquote p {
  margin:.5em 0;
  }

#blog-pager-newer-link {
  float: left;
  margin-left: 13px;
 }

#blog-pager-older-link {
  float: right;
  margin-right: 13px;
 }

#blog-pager {   
  text-align: center; 
 }

.feed-links { 
  clear: both;
  line-height: 2.5em;
  margin-left: 13px;
}

/* Comments
----------------------------------------------- */
#comments {
  margin:-25px 13px 0;
  border:1px dotted $borderColor;
  border-width:0 1px 1px;
  padding:20px 0 15px 0;
  }
#comments h4 {
  margin:0 0 10px;
  padding:0 14px 2px 29px;
  border-bottom:1px dotted $borderColor;
  font-size:120%;
  line-height:1.4em;
  color:$postTitleColor;
  }
#comments-block {
  margin:0 15px 0 9px;
  }
.comment-author {
  background:url("http://www.blogblog.com/rounders3/icon_comment.gif") no-repeat 2px .3em;
  margin:.5em 0;
  padding:0 0 0 20px;
  font-weight:bold;
  }
.comment-body {
  margin:0 0 1.25em;
  padding:0 0 0 20px;
  }
.comment-body p {
  margin:0 0 .5em;
  }
.comment-footer {
  margin:0 0 .5em;
  padding:0 0 .75em 20px;
  }
.comment-footer a:link {
  color: #333;
  }
.deleted-comment {
  font-style:italic;
  color:gray;
  }

/* Profile
----------------------------------------------- */
.profile-img { 
  float: left;
  margin: 5px 5px 5px 0;
  border: 4px solid $topSidebarTextColor;
}

.profile-datablock {
  margin:0 15px .5em 0;
  padding-top:8px;
}

.profile-link { 
  background:url("http://www.blogblog.com/rounders3/icon_profile.gif") no-repeat 0 .1em;
  padding-left:15px;
  font-weight:bold;
}

.profile-textblock {
  clear: both;
  margin: 0;
}

.sidebar .clear, .main .widget .clear { 
  clear: both;
}

#sidebartop-wrap {
  background:$topSidebarBgColor url("http://farm3.static.flickr.com/2329/2046538634_af629f2518_o.gif") no-repeat left bottom;
  margin:0px 0px 15px;
  padding:0px 0px 10px;
  color:$topSidebarTextColor;
  }

#sidebartop-wrap2 { 
 background:url("http://farm3.static.flickr.com/2050/2045737079_76addfe5f6_o.gif") no-repeat left top;
  padding: 10px 0 0;
  margin:0;
  border-width:0;
 }

#sidebartop h2 {
  line-height:1.5em;
  color:$topSidebarHeaderColor;
  border-bottom: 1px dotted $topSidebarHeaderColor;
  font: $headerFont;
  margin-bottom: 0.5em;
}

#sidebartop a { 
 color: $topSidebarLinkColor;
}

#sidebartop a:hover { 
 color: $topSidebarVisitedLinkColor;
}
#sidebartop a:visited { 
 color: $topSidebarVisitedLinkColor;
}

#sidebar a { 
  color: $bottomSidebarLinkColor;
}
#sidebar a:hover,
#sidebar a:visited { 
  color: $bottomSidebarVisitedLinkColor;
}

/* Sidebar Boxes
----------------------------------------------- */

.sidebar .widget { 
  margin:.5em 3px 1.25em;
  padding:0 0px;
 }

.widget-content { 
  margin-top: 0.5em;
 }

#sidebarbottom-wrap1 {
  background:$titleBgColor url("http://farm3.static.flickr.com/2331/2046546608_f6d083f99a_o.gif") no-repeat left top;
  margin:0 0 15px;
  padding:10px 0 0;
  color: $titleTextColor;
}

#sidebarbottom-wrap2 {
  background:url("http://farm3.static.flickr.com/2063/2050854447_fedd0c67f1_o.gif") no-repeat left bottom;
  padding:0px 13px 8px;
}

.sidebar h2 {
  margin:0 0 .5em 0;
  padding:0 0 .2em;
  line-height:1.5em;
  font:$headerFont;
}

.sidebar ul {
  list-style:none;
  margin:0 0 1.25em;
  padding:0 0px;
}

.sidebar ul li {
  background:url("http://www.blogblog.com/rounders3/icon_arrow_sm.gif") no-repeat 2px .25em;
  margin:0;
  padding:0 0 3px 16px;
  margin-bottom:3px;
  border-bottom:1px dotted $borderColor;
  line-height:1.4em;
  }
.sidebar p {
  margin:0 0 .6em;
  }

#sidebar h2 { 
  color: $bottomSidebarHeaderColor;
  border-bottom: 1px dotted $bottomSidebarHeaderColor;
 }

/* Footer
----------------------------------------------- */
#footer-wrap1 {
  clear:both;
  margin:0;
  padding:15px 0 0;
  }
#footer-wrap2 {
  background:$titleBgColor url("http://www.blogblog.com/rounders3/corners_cap_top.gif") no-repeat left top;
  padding:8px 0 0;
  color:$titleTextColor;
  }
#footer {
  background:url("http://www.blogblog.com/rounders3/corners_cap_bot.gif") no-repeat left bottom;
  padding:0px 15px 8px;
  }
#footer hr {display:none;}
#footer p {margin:10;}
#footer a {color:$titleTextColor;}

/** Page structure tweaks for layout editor wireframe */
body#layout #main-wrap1,
body#layout #sidebar-wrap,
body#layout #header-wrapper {
  margin-top: 0;
}

body#layout #header, body#layout #header-wrapper,
body#layout #outer-wrapper { 
  margin-left:0,
  margin-right: 0;
  padding: 0;
}

body#layout #outer-wrapper { 
  width: 730px;
}

body#layout #footer-wrap1 { 
  padding-top: 0;
 }
]]></b:skin>
</head>

<body>
  <div id='outer-wrapper'>

  <div id='header-wrapper'>
    <b:section class='header' id='header' maxwidgets='1'>
<b:widget id='Header1' locked='true' title='Las Chavas de Flickr (cabecera)' type='Header'/>
</b:section>
  </div>

  <div id='crosscol-wrapper' style='text-align:center'>
    <b:section class='crosscol' id='crosscol' showaddelement='no'/>
  </div>

  <div id='main-wrap1'><div id='main-wrap2'>
    <b:section class='main' id='main' showaddelement='no'>
<b:widget id='Blog1' locked='true' title='Entradas del blog' type='Blog'/>
</b:section>
  </div></div>

  <div id='sidebar-wrap'>

    <div id='sidebartop-wrap'><div id='sidebartop-wrap2'>
      <b:section class='sidebar' id='sidebartop'>
<b:widget id='HTML1' locked='false' title='' type='HTML'/>
</b:section>
    </div></div>

    <div id='sidebarbottom-wrap1'><div id='sidebarbottom-wrap2'>
      <b:section class='sidebar' id='sidebar' preferred='yes'>
<b:widget id='Feed2' locked='false' title='MexAutos.com' type='Feed'/>
<b:widget id='LinkList1' locked='false' title='Links' type='LinkList'/>
<b:widget id='HTML6' locked='false' title='' type='HTML'/>
<b:widget id='Feed1' locked='false' title='FreeUsedCarsAds.com' type='Feed'/>
<b:widget id='HTML4' locked='false' title='' type='HTML'/>
<b:widget id='Feed3' locked='false' title='The Cars of You Tube' type='Feed'/>
<b:widget id='HTML2' locked='false' title='' type='HTML'/>
<b:widget id='Feed4' locked='false' title='Google Reader' type='Feed'/>
<b:widget id='HTML7' locked='false' title='' type='HTML'/>
<b:widget id='AdSense1' locked='false' title='' type='AdSense'/>
<b:widget id='HTML5' locked='false' title='' type='HTML'/>
</b:section>
    </div></div>

  </div>

  <div id='footer-wrap1'><div id='footer-wrap2'>
    <b:section class='footer' id='footer'>
<b:widget id='HTML3' locked='false' title='' type='HTML'/>
</b:section>
  </div></div>

</div>
</body>
</html> 
```

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-03T15:59:43.093

未经测试，但您可能需要指定类似

边距：.3em 0 25px 0 0; 填充：0 0 0 0；

代替：

.post { 边距：.3em 0 25px; 填充：0 0；边框：1px 虚线 $borderColor; 边框宽度：1px 0；}

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T16:04:34.237

这是由这一点CSS引起的。

```
#main {
  background:url("http://www.blogblog.com/rounders3/rails_main.gif") repeat-y;
  padding:0;
} 
```

看一下那个图像，你会看到它是那个正在加载的图像，并且把灰线放在那里。将其更改为此以摆脱它。

```
#main {
  background: transparent;
  padding:0;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T16:05:59.067

主 div (rounders3/rails_main.gif) 的背景图像为 485 像素宽。如果更改列的宽度，则必须制作具有新宽度的新图像。

# c# - 判断两个文件是否相同的最佳方法？

> ID：714574
> 
> 赞同：2
> 
> 时间：2009-04-03T15:59:31.173
> 
> 标签：c#, file

如果我使用 C# 通过 Internet 将文件从计算机 A 传输到计算机 B，使用使用 .NET 进行文件传输的多种方法之一，判断计算机 A 和计算机 B 上的文件是否相同的最佳方法是什么？

我认为 MD5 哈希是一个很好的判断方法。这似乎是一种被广泛接受的说法。但是，我只是仔细检查一下是否没有更好的方法隐藏在 .NET 框架中。

谢谢托尼

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-03T16:01:23.947

MD5 是要走的路。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-03T16:03:28.373

CRC32 或 Adler32，比 MD5 快很多。如果您需要检查文件是否被恶意操纵，您应该使用 MD5。如果没有必要，那就太矫枉过正了。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-08-08T13:46:48.720

SHA2（SHA256，SHA512）算法优于MD5，原因有很多。

*   它们更能抵抗碰撞，这是大文件的一个重要问题。虽然 MD5 可以检测到文件内容的更改，但两个大文件更有可能最终具有相同的 MD5。
*   它们的计算速度更快。这可能看起来很奇怪，但是芯片组和操作系统实现都加速了 SHA 算法。算法本身也更容易并行化。因此，在 Vista+ 中 SHA 或 SHA2 算法的本机实现比等效的 MD5 算法快得多。
*   他们使用更大的块大小，这意味着他们可以一次处理大文件块。处理大文件时，I/O 时间可能会增加。

.NET 中的本机实现是[SHA256Cng](http://msdn.microsoft.com/en-us/library/system.security.cryptography.sha256cng.aspx)、SHA384Cng 和 SHA512Cng。[您可以将它们定义为使用配置文件中的<cryptoClass>](http://msdn.microsoft.com/en-us/library/hzccd30c.aspx)元素进行散列时使用的默认算法，而不是显式实例化它们。

完成此操作后，您可以编写`HashAlgorithm.Create()`或`SHA256256.Create()`创建本机实例。

# .net - 批量打印Word文档.Net？

> ID：714578
> 
> 赞同：1
> 
> 时间：2009-04-03T16:00:12.623
> 
> 标签：.net, ms-word, printing

是否可以通过 .Net 一次打印一批 Word 文档（c# 或 VB，2.0、3.0、3.5... 2 以上的语言和框架对我来说无关紧要）？

例如，我有一个包含多个 word 文档的本地目录……我可以遍历列表并调用 PrintOut() 方法，但我相信这会发送多个打印作业。我想将它们排成队列并发送一份打印作业。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T16:15:31.667

在进行办公自动化时，VB.Net 使事情比 C# 容易得多。请参阅此相关[答案](https://stackoverflow.com/questions/698012/office-esp-outlook-addins/698118#698118)。

无论如何，这是 C# 中的一个示例；-)

> [http://www.codeproject.com/KB/printing/WordPrinting.aspx](http://www.codeproject.com/KB/printing/WordPrinting.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T16:01:58.437

是的，通过办公自动化。它是 COM 互操作，因此您需要熟悉它，但对象模型并不难掌握。

提示：首先在 VBA 宏中进行测试以获得想法，然后在确定必要的内容后实施 .NET 代码。

# sql - 处理 SQL Server 中的重复数据

> ID：714579
> 
> 赞同：0
> 
> 时间：2009-04-03T16:00:23.870
> 
> 标签：sql, sql-server, sql-server-2005

我有一个看起来像这样的大型 SQL 服务器表：

```
ImageId int
页整数
FSPath varchar(256)
图像帧整数
...

```

该表存储多个图像文件的每一页的条目。这样做是为了使表格能够表示每个页面由不同文件表示的图像，以及包含同一文件中的页面的多页图像文件。当我处理多页设置时，FSPath 列的值对于同一文档中的每个页面都是完全重复的，这会占用大量空间（仅此表目前约为 5GB）。以这种方式复制数据似乎非常浪费，但我一直无法找到我满意的替代解决方案。

该表的使用模式主要是基于路径（和其他列）的主键 (ImageId/Page) 的查找，但我还需要能够有效地处理新数据的插入和偶尔的删除。

如果我为路径元素创建一个查找表并将路径元素 id 插入到 pages 表中，我将需要通过 Id 和路径对其进行索引，这会损害每个页面都有不同路径片段的情况，并且在查找表中可能存在也可能不存在路径的地方插入新数据变得复杂。此外，删除主页面表中的任何行都需要我清理不再使用的关联路径条目。

我一直希望我可以创建连接表的可更新视图并让 SQL Server 为我发挥作用，但我收到消息：视图或函数“Scrap.dbo.PageView”不可更新，因为修改会影响多个基础表。试图执行插入。

有没有一种合理的方法可以做到这一点，我只是想念，还是我不走运？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-03T16:16:04.707

这不会解决重复条目问题，因为我无法 100% 了解您的架构，但这是我必须减少潜在大小的一个想法，假设您要存储路径信息和文件大小。

文件系统是什么样的？如果它是一个深层目录树，有什么方法可以将它抽象为一个单独的查找表，而不是每次都存储路径信息？例如，类似：

表路径：

```
ID 路径名父级
int varchar(128) int, FK on PATHS.ID
--- ------------ --------
1 / 空
2 图片 1
3 目录 1 2
4 目录 2 2

```

或者为了更快地重建路径，您只需存储整个内容，只要您只保存每条路径一次。这样你就不必担心每次都递归回根来组装路径：

```
标识路径名
整数 varchar(128)
--- ------------
1 /
2 /图像
3 /图像/目录1
4 /图像/目录2

```

然后您可以将表的定义更改为：

```
ImageId int
页整数
文件名 varchar(256)
路径 int，FK 到 PATHS.ID
图像帧整数
...

```

也许可以节省一点空间，特别是如果它很深的话。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T16:36:50.397

我对实际问题感到困惑？您是否遇到性能问题，或者 5 场演出真的那么贵？如果性能是问题，较小的表可能不是解决方案。我会调查将 FSPath 更改为 char(256)。它会占用更多空间，但您的数据会更好地排列在硬盘上，并且*应该*有助于提高性能。我也支持按照您的描述更改架构，但如果它不可行，因为消费者不能/不会更改代码，您可能必须构建一些测试以证明更改是值得的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T16:18:35.700

我认为你是对的 - 创建一个新表只是为了存储唯一路径实际上可能比将重复数据留在原始表中需要更多的空间。此外，它使查询和更新变得复杂。这当然取决于重复的数量。

# svn - git-svn 可以正确填充 svn:mergeinfo 属性吗？

> ID：714589
> 
> 赞同：32
> 
> 时间：2009-04-03T16:03:02.057
> 
> 标签：svn, git, merge, git-svn

我正在评估 git-svn 并试图确定它在特定 svn 存储库中的表现如何。我最关心的是让 git-svn 执行合并，以使 svn:mergeinfo 属性在 subversion repo 中正确设置。这可能吗？

这是我到目前为止所做的：

```
# Checkout the SVN repo.
$ git svn clone svn://server/project1 -T trunk -b branches -t tags

# Make sure we are working on trunk.
$ git reset --hard remotes/trunk

# Modify the working copy.
$ vim file.txt

# Commit locally to the git repo.
$ git commit -a

# Push the commits back to the SVN server.
$ git svn dcommit
Committing to svn://server/project1/trunk ...
    M   file.txt
Committed r178
    M   file.txt
r178 = b6e4a3a0c28e7b9aa71d8058d96dcfe7c8a2b349 (trunk) 
```

现在我将如何着手将该特定提交合并到一个颠覆分支中？同样，对我来说，git 在提交更改时正确设置 svn:mergeinfo 属性非常重要。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2011-05-12T19:48:26.963

尽管这是一个老问题，但 git-svn 的当前状态在被问到之后已经发生了变化。具体来说，在 git 1.7.5 中，当 dcommitting back to svn 时，对设置 svn:mergeinfo 的支持有限。

`git svn dcommit`现在接受`-mergeinfo=<mergeinfo>`标志。引用[1.7.5+ 手册页](http://git-scm.com/docs/git-svn)：

> -mergeinfo=<合并信息>
> 
> > 在 dcommit 期间添加给定的合并信息（例如 --mergeinfo="/branches/foo:1-10"）。所有 svn 服务器版本都可以存储此信息（作为属性），从 1.5 版开始的 svn 客户端可以使用它。git svn 目前不使用，也不会自动设置。

但是，在使用它时应该非常小心。即使手册页说“添加”，它的真正含义是“替换”。也就是说，该`svn:mergeinfo`属性是根据传递的内容设置的，它不会将指定的修订添加到已经存在的`svn:mergeinfo`. 从我的错误中吸取教训……</p>

# 编辑：

看来他们仍在努力进一步改进这一点。从[git-svn 1.7.7](http://git.kernel.org/?p=git/git.git;a=commit;h=1e5814f3def08452aef4caa703f074ba7d167867)开始，以下文本被添加到 git-svn 手册页：

> > 配置键：svn.pushmergeinfo
> 
> 此选项将导致 git-svn 尝试在可能的情况下自动填充 SVN 存储库中的 svn:mergeinfo 属性。目前，这只能在 dcommitting 非快进合并时完成，其中除了第一个之外的所有父级都已被推入 SVN。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-05-12T19:27:00.170

简短回答：不，git-svn 不关心 svn:mergeinfo 属性，因为 git-svn 没有合并回 svn（它正在提交）。

长答案：大多数人使用 git-svn 来摆脱 svn 的脑损伤合并。svn 的问题在于它不区分复制文件或文件夹（通常由重构引起）和创建分支，因为创建分支或标签是通过使用“svn copy”命令完成的。svn:mergeinfo 属性是解决这个问题的创可贴，但仍然存在修改不明确的情况。Git 对分支和合并有更强大的支持。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-12-16T11:55:54.090

似乎他们正在努力。下一个版本可能会：

[http://git.kernel.org/?p=git​​/git.git;a=commit;h=6abd9332f97441a568421ba233ad8929b50a7efc](http://git.kernel.org/?p=git/git.git;a=commit;h=6abd9332f97441a568421ba233ad8929b50a7efc)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-09-10T17:59:43.457

## 理论部分

问题是 Subversion 和 Git 有明显不同的合并跟踪机制。

因此，某些合并信息无法从 Subversion 正确转换为 Git。例如，当 SVN 甚至在子目录级别跟踪它们时，Git 根本不跟踪樱桃挑选。

另一方面，在 Subversion 中表示 Git 合并历史没有问题。但是这里要小心，因为 Git 存储库中不存在一些 SVN 文件/目录属性（例如 svn:keywords），一旦您提交合并提交，对这些属性的修改就会丢失在 SVN 存储库中。

## 实用部分

git-svn 不会根据 Git 提交的所有父级自动设置 svn:mergeinfo 属性。但是您可以在 dcommit 相应的提交之前手动指定属性的值。

看看[SubGit](http://subgit.com)，它是 git-svn 的服务器端替代品。如果可能，它会在两个方向上转换合并信息。它还支持 svn:ignore、svn:eol-style 和 svn:mime-type 等 SVN 属性。

有关更多详细信息，请参阅[SubGit 文档](http://subgit.com/documentation/)和[SubGit 与 git-svn](http://subgit.com/documentation/gitsvn.html)比较。

SubGit 是一款商业产品，为开源、学术和小型项目提供免费选项。我是 SubGit 开发人员之一。

# sql-server - 多行最高效（快速）的 T-SQL 删除？

> ID：714590
> 
> 赞同：5
> 
> 时间：2009-04-03T16:03:16.047
> 
> 标签：sql-server, performance, tsql

我们的服务器应用程序全天以每秒 1000-2000 行的速率接收有关要添加到数据库的行的信息。表中有两个互斥列唯一标识一行：一个是数字标识符，称为“tag”，另一个是 50 个字符的字符串，称为“longTag”。一行可以有一个标签或一个longTag；不是都。

从套接字进入的每一行可能已经存在也可能不存在于表中。如果存在，则必须使用新信息更新该行。如果它不存在，则必须添加它。我们使用的是 SQL 2005，在少数情况下甚至使用 SQL 2000，因此我们不能使用新的 MERGE 关键字。

我现在这样做的方式是构建一个巨大的 DELETE 语句，如下所示：

```
DELETE from MyRecords
WHERE tag = 1
OR tag = 2
OR longTag = 'LongTag1'
OR tag = 555 
```

...每个传入行都有自己的“OR tag = n”或“OR longTag = 'x'”子句。

然后我使用 ISQLXMLBulkLoad 执行 XML 批量加载以一次加载所有新记录。

巨大的 DELETE 语句有时会超时，需要 30 秒或更长时间。我不确定为什么。

当记录从套接字进来时，它们要么被插入，要么必须替换现有的行。我的做法是不是最好的做法？

**编辑**：新行与替换行的比率将非常严重地向新行倾斜。在我看到的来自生产的数据中，每次更正通常会有 100-1000 个新行。

**编辑 2**：插入和删除都必须作为单个事务处理。如果插入或删除失败，它们都必须回滚，使表处于插入和删除开始之前的相同状态。

**编辑 3**: 关于 NULL 标签。我需要先简单地描述一下这个系统。这是一个交易系统的数据库。MyTable 是一个包含两种交易的交易表：所谓的“日内交易”和所谓的“开仓头寸”。日间交易只是简单的交易——如果您是一名期权交易员并且您进行了交易，那么该交易将是该系统中的日间交易。开放头寸基本上是您迄今为止的投资组合的摘要。开仓头寸和日间交易都存储在同一个表中。日内交易有标签（longTags 或数字标签），而开仓头寸没有。开仓可以有重复的行——这是正常的。但是日间交易不能有重复的行。如果当日交易带有与数据库中已有记录相同的标签，

所以 tag & longTag 中的值有 4 种可能：

1) tag 非零且 longTag 为空：这是一个带有数字标识符的日间交易。2) tag 为零，longTag 有一个非空字符值。这是带有字母数字标识符的日间交易。3) tag 为零，longTag 为空：这是一个开仓。4) tag 非零且longTag 有一个非空字符值。我们的服务器软件阻止了这种情况的发生，但如果发生这种情况，longTag 将被忽略，并将与案例 #1 一样对待。同样，这不会发生。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-03T16:11:19.803

我认为将巨大的 DELETE 语句拆分为 2 DELETE 可能会有所帮助。

1个DELETE处理tag和一个单独的DELETE处理longTag。这将有助于 SQL Server 选择有效地使用索引。

当然，您仍然可以在 1 个 DB 往返中触发 2 个 DELETE 语句。

希望这可以帮助

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-03T16:26:22.840

OR（或 in）几乎就像每个 OR 操作数都是不同的查询一样工作。也就是说，它变成了表扫描，对于每一行，数据库都必须将每个 OR 操作数作为谓词进行测试，直到找到匹配项或操作数用完。

将其打包的唯一原因是使其成为一个逻辑工作单元。您还可以在事务中包装一堆删除，并且仅在全部成功完成后才提交。

Quassnoi 提出了一个有趣的建议——使用表格——但由于他随后使用了 IN 和 OR，因此结果相同。

但是试试这个。

创建一个反映您的真实表的新表。称它为 u_real_table。在 tag 和 longTag 上对其进行索引。

将所有传入数据放入 u_real_table。

现在，当您准备好进行批量处理时，请加入镜像表或标签上的真实表。从真实表中，删除 u_real_table 中的所有标记行：

```
delete real_table from real_table a 
   join u_real_table b on (a.tag = b.tag);
insert into real_table select * 
   from u_real_table where tag is not null; 
```

看看我们在这里做了什么？由于我们*只在 tag 上*加入，因此更有可能使用 tag 索引。

首先，我们删除了所有新内容，然后我们插入了新的替换内容。我们也可以在这里进行更新。哪个更快取决于您的表结构及其索引。

我们不必编写脚本来执行此操作，只需将记录插入到 u_real_table 中。

现在我们对 longTags 做同样的事情：

```
delete real_table from real_table a 
   join u_real_table b on (a.longTag = b.longTag);
insert into real_table select * 
   from u_real_table where longTag is not null; 
```

最后，我们清除 u_real_table：

```
delete from u_real_table; 
```

显然，我们将每个删除/插入对包装在一个事务中，这样删除只有在后续插入成功时才变为真实，然后我们将整个东西包装在另一个事务中。因为它是一个逻辑工作单元。

这种方法减少了您的手动工作，减少了手动错误的可能性，并且有一些机会加快删除速度。

请注意，这依赖于缺少的标签和 longTags 正确地为空，而不是零或空字符串。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-03T16:05:42.220

也许：

```
DELETE FROM MyRecords
WHERE  tag IN (1, 2, 555) -- build a list
OR longTag IN ('LongTag1') 
```

我怀疑索引会帮助您删除，但会大大减慢您的插入速度，所以我不会玩太多。但是我的直觉还不是很完美，你也许可以调整 FillFactor 或其他项目来解决这个问题，而我确实知道的一件事是你真的想要分析两者。

另一种选择是将新插入加载到临时表中（命名为`InputQueue`），然后加入 MyRecords 上的临时表以处理过滤更新。这也使得分两步进行更新变得容易：您可以将标签和 longTags 作为单独的操作删除，这样可能会更有效。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-03T16:15:13.727

这样的事情可以简化流程（您只需插入行，无论它们是否已经存在 - 不需要预先的 DELETE 语句）：

```
CREATE TRIGGER dbo.TR_MyTable_Merge 
   ON  dbo.MyTable 
   INSTEAD OF INSERT
AS 
BEGIN
  SET NOCOUNT ON;

  BEGIN TRANSACTION

  DELETE MyTable 
  FROM   MyTable t INNER JOIN inserted i ON t.tag = i.tag 

  DELETE MyTable 
  FROM   MyTable t INNER JOIN inserted i ON t.longTag = i.longTag

  INSERT MyTable 
  SELECT * FROM inserted

  COMMIT TRANSACTION

  SET NOCOUNT OFF;
END 
```

编辑：以前组合的 DELETE 语句分为两个单独的语句，以实现最佳索引使用。

根本不使用 DELETE，而是更新受影响/重复的行在索引上会更容易。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-03T16:19:23.000

查看此视频，该视频展示了如何进行“蚕食”删除。该过程运行良好，绝对可以减少您看到的锁定/碰撞问题：

[http://www.sqlservervideos.com/video/nibbling-deletes](http://www.sqlservervideos.com/video/nibbling-deletes)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-03T16:06:22.500

似乎您的表没有被索引`(tag)`并且`(longTag)`

建立两个索引：一个 on `(tag)`，一个 on`(longTag)`

如果您打算删除大量记录，则声明两个表变量，用值填充它们并像这样删除：

```
DECLARE @tag TABLE (id INT);
DECLARE @longTag TABLE (id VARCHAR(50));

INSERT
INTO  @tag
VALUES (`tag1`)

INSERT
INTO  @tag
VALUES (`tag2`)

/* ... */

INSERT INTO @longTag
VALUES ('LongTag1')

/* ... */

DELETE
FROM    MyRecords r
WHERE   r.tag IN (SELECT * FROM @tag)
        OR r.longTag IN (SELECT * FROM @longTag) 
```

您也可以尝试执行两遍`DELETE`：

```
DELETE
FROM    MyRecords r
WHERE   r.tag IN (SELECT * FROM @tag)

DELETE
FROM    MyRecords r
WHERE   r.longTag IN (SELECT * FROM @longTag) 
```

看看哪些语句运行时间更长，看看索引是否有问题。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-03T16:10:16.640

使用 OR 可能会导致表扫描——你能把它分成四个语句吗？将每个包装在事务中也可以加快速度。

```
DELETE from MyRecords
WHERE tag = 1

DELETE from MyRecords
WHERE tag = 2

DELETE from MyRecords
WHERE tag = 555

DELETE from MyRecords
WHERE longTag = 'LongTag1' 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-03T20:32:57.040

**索引：**

考虑为 longTag 使用索引的持久计算列，该列存储 longTag 的校验和。不是索引“LongTag1”，而是索引一个 4 字节的 int 值 (86939596)。

然后您的查找 [希望*] 更快，您只需在查询/删除中包含 longTag 值。您的代码会稍微复杂一些，但索引可能会更有效率。

* 需要测试

# wcf - WebInvoke/DataContractJsonSerializer，“1,6276”不能解析为“双”

> ID：714594
> 
> 赞同：1
> 
> 时间：2009-04-03T16:04:19.337
> 
> 标签：wcf, serialization, datacontractserializer, webinvoke

我将 WCF`WebInvokeAttribute`用于声明性 JSON 请求 ( `DataContractJsonSerializer`)，并带有`DataContractAttribute`/`DataMemberAttribute`基于的序列化。

我使用的服务支持返回包含基于不同文化的数据的 JSON。默认情况下，此服务使用 en-US 文化设置，这意味着小数分隔符将为“.”。

我有一个有`System.Double`属性的类。如果我使用使用“，”作为小数分隔符的区域性请求数据`SerializationException`，则在解析以下内容时，我会尝试反序列化此属性的值`System.Double`：

> “反序列化 XXX 类型的对象时出错。值 '1,6276' 无法解析为类型 'double'。”

这当然是因为在解析 Double 时使用了不变的文化。我希望在当前线程上设置正确的文化可以解决这个问题，但它没有。

因此，对于任何不使用“.”的文化，服务都会中断。作为小数分隔符。

将感谢帮助。

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-06T17:02:53.133

根据[JSON Specification](http://www.json.org/)，数字应使用句点格式化。换句话说，问题不在 Deserializer 部分，而在 Serializer 部分。

如果您绝对必须使用逗号分隔符，那么我建议使用属性类型的字符串设置合同，并在您的类上提供一个未序列化的附加属性以将字符串转换为小数（然后您将能够传递你需要的任何文化）。

# visual-studio - SVN 下的 Visual Studio 2008 非常慢

> ID：714597
> 
> 赞同：1
> 
> 时间：2009-04-03T16:05:15.747
> 
> 标签：visual-studio, visual-studio-2008, debugging

我最近经历了将遗留网站项目转换为 (C#)Web 应用程序项目的痛苦。在此期间，我还将代码从 VSS 控件迁移到开发服务器上的 Subversion。

在 VS2008 下调试应用程序时，项目可能需要 4/5 分钟才能完全加载。大多数情况下，输出窗口表明它正在从 Temp ASP.NET 目录加载符号。

考虑到这可能是它在 SVN 控制下的问题，我导出了项目并开始在没有源代码控制的情况下进行调试，这解决了问题。

谁能提出为什么会发生这种情况，即。为什么在源代码控制下调试需要这么长时间？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T16:32:32.437

符号加载不应该与 .svn 有任何关系。如果移动你的项目解决了这个问题，我猜这与你的实际副本和导出的副本之间的差异有关。特别是，我会说这与不太可能提交的文件有关，例如“.user”文件。“.user”文件可能有很多VS试图加载的额外垃圾，移动它意味着它们被重置了。

检查是否有任何文件丢失（在干净的导出之后......在您打开解决方案 1x 后它们将被重新创建），您可能会找到罪魁祸首。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T16:08:47.953

你可以试试[TortoiseSVN](http://tortoisesvn.tigris.org/)客户端

您为 VS 拥有的插件（Resharper 等）越多，速度就越慢。

# string - 如何格式化存储在字符串中的数字？

> ID：714598
> 
> 赞同：0
> 
> 时间：2009-04-03T16:05:32.813
> 
> 标签：string, decimal

如果我将数字作为没有小数位的文本字符串，我如何将其转换为 2 个小数位，以便将 12345 转换为 123.45？字符串可以是任何大于 1 的长度。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-03T16:07:43.370

将其转换为您的十进制类型，然后除以 100。

```
string stringVal = "12345";

decimal val = decimal.Parse( stringVal ) / 100M;

double val = double.Parse( stringVal ) / 100.0; 
```

使用将其转换回字符串

```
string newVal = string.Format( "{0:N}", val ); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T16:08:47.063

只需将其除以 100.0。

```
x = int(x)
x /= 100.0 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T16:11:07.340

如果您确信它是数字并且不想仔细检查，那么您可以避免转换：

```
if (stringVal.Length == 2)
{
    stringVal = "0." + stringVal;
}
else
{
    stringVal = stringVal.Insert(x.Length - 2, ".");
} 
```

这假设如果它是 2 位数字，您需要前导零。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-03T16:13:10.407

如果要将结果作为字符串，则可以使用字符串操作（C# 中的示例）：

```
value.Substring(0, value.Length-2) + "." + value.Substring(value.Length-2) 
```

如果要将结果作为数字，首先解析值然后除以 100：

```
double.Parse(value) / 100.0 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-03T16:43:00.493

十进制 str=12345;
(str/100).ToString("F");

# java - 匿名与命名内部类？- 最佳实践？

> ID：714602
> 
> 赞同：47
> 
> 时间：2009-04-03T16:06:12.327
> 
> 标签：java, oop, class, inheritance, anonymous-class

我有一个类，我们称之为 LineGraph，它呈现一个折线图。我需要对它进行子类化，但派生类只在一个地方使用，并且与使用它的类耦合。所以我正在使用一个内部类。

我看到两种方法可以做到这一点：

**匿名内部类**

```
public class Gui {
    LineGraph graph = new LineGraph() {
        // extra functionality here.
    };
} 
```

**命名内部类**

```
public class Gui {
    MyLineGraph graph = new MyLineGraph();

    private class MyLineGraph extends LineGraph {
        // extra functionality here.
    }
} 
```

我不是匿名内部类的粉丝，因为坦率地说，我只是觉得它看起来很丑。但是对于只在一个地方使用的子类，命名内部类是否过大？公认的做法是什么？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-04-03T16:12:17.837

匿名内部类的一个优点是没有人可以在其他任何地方使用它，而可以使用命名的内部类（如果只有创建它的类如果设为私有）。这是一个很小的区别，但这确实意味着您可以保护内部类不被意外使用到其他地方。

此外，使用匿名内部类可以让任何阅读您的代码的人都振作起来——“这个类只在这里使用，其他任何地方都没有。” 如果你看到一个命名的内部类，有人可能会认为它会在类中的多个地方使用。

它们非常相似，所以这两点都不会改变游戏规则。我只是认为，如果您一次性使用匿名内部类，并在类中多次使用它时命名内部类，这有助于清晰。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-04-03T16:41:59.980

（反驳丹尼尔·卢）

匿名内部类的一个缺点是没有人可以在其他任何地方使用它，而可以使用命名的内部类（如果只有创建它的类如果设为私有）。这是一个很小的区别，但这确实意味着您可以帮助确保内部类不会在其他地方意外重新创建。

此外，使用匿名内部类会使任何人阅读您的代码更加困难，因为他们必须解析这个不知从何而来的类。使用命名的内部类，您可以更多地组织源代码。

我见过有两个（或更多）匿名内部类具有完全相同代码的情况。特别是在 GUI 中（您可能有多个控件执行相同的操作），这可能会突然出现（我说的是生产代码，而不是我的学生编写的代码）。

可读性问题是双向的，有些人发现匿名内部类更好，因为它可以让你看到一个地方发生了什么，而另一些人则认为它会分散注意力。这部分归结为个人喜好。

同样使类静态更有效，如果您在实例中声明匿名内部类，那么将会有更多开销，如果您不需要访问实例变量，这是浪费的（但可能不值得担心直到它出现问题）。

我个人的偏好是使用非匿名类，因为它们在以后修改代码时允许更大的灵活性。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-04-03T16:11:16.403

为什么需要对它进行子类化？如果只是覆盖现有的虚方法，我觉得匿名内部类是可以的。如果您要添加额外的功能，我会使用命名类。不过，我会将其设为嵌套类（即使用`static`修饰符）-我发现它们更容易推理:)

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-04-03T18:37:54.523

[做可能可行的最简单的事情](http://www.c2.com/cgi/wiki?DoTheSimplestThingThatCouldPossiblyWork)：使用匿名内部类。

如果您后来发现需要更广泛的范围，请重构代码以支持这一点。

（你可以对变量做同样的事情——把它们放在最具体的范围内。对其他源资产做同样的事情是有意义的。）

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-03T16:30:49.790

匿名内部类很难在 Eclipse 中调试（这就是我使用的）。您将无法通过简单的右键单击来查看变量值/注入值。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-07-30T18:55:23.493

我个人的经验法则：如果匿名内部类要小，请坚持使用匿名类。小被定义为大约 20 - 30 行或更少。如果它会更长，我认为它开始变得不可读，所以我将它命名为内部类。我记得曾经看过一个 4000+ 行的匿名内部类。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-03T17:11:21.190

内部类的一个缺点是它们不能是静态的。这意味着它将持有对包含它们的外部类的引用。

非静态内部类可能是一个问题。例如，我们最近有一个内部类被序列化，但外部类不可序列化。隐藏的引用意味着外部类也将被序列化，这当然失败了，但需要一段时间才能找出原因。

在我工作的地方，我们的编码最佳实践（在可能的情况下）鼓励静态内部类，因为它们携带的隐藏包袱更少并且更精简。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-03T16:35:38.590

匿名内部类通常是要走的路。我发现它们非常具有可读性。但是，如果该类的实例需要序列化（即使只是因为它是其他东西的字段），我强烈建议使用命名内部类。字节码中匿名内部类的名称很容易更改，这可能会破坏序列化。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-11-20T04:15:44.293

匿名类不能有构造函数，因为它们没有名字。如果您需要传递其他变量而不是您要扩展的类的构造函数中的变量，则应使用（静态）命名的内部类。这有时可以通过在周围的方法/代码中使用最终变量来克服，但这有点难看恕我直言（并且可能导致 Robin 所说的）。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-03T18:24:35.163

我对简单的匿名类没有问题。但如果它由多于几行代码或几个方法组成，内部类就更清晰了。我还认为，在某些情况下，它们永远不应该被使用。比如当他们必须返回数据时。

我看过代码，其中使用 1 个项目的最终数组将数据从调用传递回匿名内部类。在 anon 类的方法中，设置单个元素，然后在方法完成后提取此“结果”。有效但丑陋的代码。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-05-26T21:01:06.607

匿名类：

*   定义中不能有任何东西`static`（静态类、静态字段、静态初始化器等）
*   无法在 Eclipse 中检查字段
*   不能用作类型（`Foo$1 myFoo=new Foo$1(){int x=0;}`不起作用）
*   无法使用 Eclipse 中的类名定位（搜索对`Foo$1`我不起作用）
*   不能重复使用

然而，匿名类可以有一个初始化器，比如`{super.foo(finalVariable+this.bar);}`

命名内部类没有这些限制，但即使一个专门用于一个长过程的中间，声明也必须向上移动到下一个命名类。

如果限制不适用，我个人更喜欢匿名内部类，因为：

*   我知道任何其他字段仅在类定义中引用。
*   Eclipse 可以轻松地将它们转换为嵌套类。
*   我不需要复制我想使用的变量。我可以将它们声明为最终并引用它们。当我有很多参数时，这特别有用。
*   交互的代码紧密相连。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-04-16T22:23:40.987

今天刚和我的同事讨论过这个问题，正在四处寻找流行的意见。

我同意 TofuBeer。如果您的代码超过 2 行，它可能不是“一次性的”，并且可能有一天会被重用。如果您使用 MVC 模式创建表单，则页面上可能有 20 个可控制元素，而不是用大量匿名类使视图混乱（见鬼，您的视图可能是使用 GUI 构建器创建的，并且代码是自动生成的编辑源甚至不是一个选项）您可能会将每个元素提供给控制器。您可以在控制器中嵌套内部类以处理视图所需的每个不同的处理程序/侦听器接口。这很好地组织了代码，特别是如果您有一个约定，即您的处理程序类必须使用 GUI 元素名称命名（如 backButtonHandler 用于 backButtonElement）。这对我们非常有效，我们编写了一个自动注册工具（当您在视图上注册控制器时，视图会使用元素名称查找内部类并将它们用于每个命名元素的处理程序）。这对于匿名类是不可能的，并且使控制器更易于回收。

TLDR：如有疑问，请编写一个命名的内部类。您永远不会知道有一天是否有人想重用您的代码（除非它是 2 行代码，否则您必须想知道“这段代码有味道吗？”）。从长远来看，组织良好的代码具有更高的好处，尤其是在您的项目处于维护状态时。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-03T16:24:28.947

我认为这是一个品味问题。我更喜欢对[Functors](http://en.wikipedia.org/wiki/Function_object#Functors_in_Java)使用匿名类。但在你的情况下，我会使用一个内部类，因为我认为你将在其中打包不仅仅是几行代码，也许不仅仅是一个方法。它会强调这样一个事实，即通过将其放在类中而不是隐藏在方法中的某个位置，它正在向超类添加功能。另外，谁知道呢，也许有一天你可能需要其他地方的子类。当然，这取决于您对软件将如何发展的了解程度。除此之外，只需掷硬币。:)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-03T16:11:38.073

我认为在这种情况下你所做的一切都非常有意义，无论你怎么看，我认为你真的在为这个特殊问题而烦恼。它们都非常相似，并且都可以工作。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-02-27T12:18:12.123

使用匿名内部类，我们无法更改包含类成员的状态。他们需要被宣布为最终的。

# windows - 改进远程文件服务器上的文件系统访问

> ID：714607
> 
> 赞同：0
> 
> 时间：2009-04-03T16:07:15.117
> 
> 标签：windows, memory, filesystems

我有一台大型文件服务器机器，其中包含几 TB 的图像数据，我通常以块的形式访问这些数据。我想知道是否有什么特别的方法可以向操作系统提示应该将一组特定的文档预加载到内存中，以改善通过文件共享加载文件子集时的访问时间。

在我开始访问它们之前，我可以提供一个父目录，其中包含构成给定块的所有文件。

首先想到的是简单地编写一个服务，它将遍历指定路径中的文件，将它们加载到进程内存中，然后释放内存，希望 OS 文件系统缓存能够保留它们，但我想知道如果有更明确的方法可以做到这一点。

如果我可以重用现有的文件共享访问范例，而不是要求对这些文件的访问通过内存缓存层，那将节省大量工作。

有问题的文件几乎总是以只读方式访问。

我正在使用 Windows Server 2003/2008

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-03T18:13:55.377

想到了两种方法：

1）将服务器设置为针对文件服务进行优化。这曾经在文件和打印机共享的属性中，但在 Windows 2008 中似乎已经消失。这是通过注册表设置的：

> HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\内存管理\LargeSystemCache=1
> 
> HKLM\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters\Size=3

[http://technet.microsoft.com/en-us/library/cc784562.aspx](http://technet.microsoft.com/en-us/library/cc784562.aspx)作为参考。

2) 确保两个端点都是 windows 2008/windows 2008 或 windows 2008/Vista。SMB 2.0 和 IP 堆栈都有显着的性能改进，大大提高了性能。由于成本、组织限制或采购提前期，这可能不是一个选项，但我想我会提到它。

[http://technet.microsoft.com/en-us/library/bb726965.aspx](http://technet.microsoft.com/en-us/library/bb726965.aspx)作为参考。

# ios - 在 iPhone 上播放声音样本

> ID：714618
> 
> 赞同：1
> 
> 时间：2009-04-03T16:10:11.727
> 
> 标签：ios, audio, playback

我已经到了想在我的游戏/应用程序中播放一些样本的地步。我的直觉说使用 openAL ...我会遇到需要一次播放多个样本（但不超过 2 或 3 个）并且样本会很短（2 或 3 秒）的情况。

我的问题是，考虑到该标准，在 iPhone 上播放样本的最佳方式是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T16:57:01.660

这是我正在使用的一段示例代码：

**第一个选项：**

我在我的 .h 文件中定义了这个

```
SystemSoundID topClick; 
```

在我的 .m 文件中，我最先加载声音（aiff 文件）：

```
NSBundle* bundle = [NSBundle mainBundle];
NSString *topClickFile = [bundle pathForResource:@"top_click" ofType:@"aiff"]; 
```

然后，当我想播放声音时，我使用：

```
AudioServicesPlaySystemSound(topClick); 
```

**第二个选项：**

您还可以使用 AVAudioPlayer（我认为自固件 2.2 起可用）：

```
NSString *graffitiSprayFile = [bundle pathForResource:@"sound_effect" ofType:@"aiff"];
AVAudioPlayer* sprayAudio = [[AVAudioPlayer alloc] initWithContentsOfURL:[NSURL fileURLWithPath:graffitiSprayFile] error:NULL];
sprayAudio.delegate = self;
[sprayAudio prepareToPlay];
[sprayAudio setNumberOfLoops:999]; 
```

第一个选项对于相对较短的声音效果非常有用。

# asp.net - Intratnet ASP.NET/SQL2K5 环境的角色安全最佳实践是什么？

> ID：714620
> 
> 赞同：3
> 
> 时间：2009-04-03T16:11:05.607
> 
> 标签：asp.net, sql-server, intranet, security-roles

我们当前的 Intranet 环境有点过时了。当前堆栈具有针对 SQL 2000 数据库进行查询的 ASP.NET 1.1/2.0 应用程序。

为了角色安全，用户加入的服务器上有用户组（所以需要在测试和生产机器上加入组）。这些用户组被同步到 SQL 2000 本身的用户角色中。根据需要向角色授予对存储过程的执行权限，以防止任何访问冲突。

在 Web 应用程序级别，我们使用基本身份验证（针对我们的 Active Directory 进行身份验证）并打开身份模拟。到数据库的连接字符串使用集成安全性。这将创建一个环境，其中 Web 应用程序在用户登录时连接到数据库，这将对被调用的存储过程强制执行数据库安全性。它还允许我们使用典型的 User.IsInRole() 方法在应用程序本身内执行授权。

这有几个问题。首先是只有我们的服务器管理员才能访问机器上的用户组，因此更新角色安全性或添加其他用户不在应用程序管理员的控制范围内。此外，获得该角色的唯一方法是调用一个名为“xp_logininfo”的 SQL 过程，该过程在 SQL 2005 中被锁定。虽然我不知道全部细节，但我们的 DBA 告诉我们这个通用模型不起作用考虑到较新版本中模式的性质，SQL 2005 很好。

现在我们已经准备好更新我们的环境了。我们正在编写 .NET 3.5 应用程序以利用更多 AJAX，而 SQL Server 2005 是我们数据库的主要环境。我们正在寻求更新安全模型，以便为应用程序管理员提供更灵活的服务，并可能更多地利用 Active Directory。

我们还有一个担忧是给定用户很可能可以访问多个应用程序，因此拥有某种集中式解决方案是最佳选择，这样我们就可以在需要时轻松删除用户。

在这种环境中维护角色安全的最佳实践是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T16:14:51.560

[ASP.NET 2.0 的成员资格、角色和配置文件](http://www.4guysfromrolla.com/articles/120705-1.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T16:59:10.687

我认为与之前做出的决定相关的考虑因素并没有发生太大变化。

关于模式注释，这些只会帮助您组织数据库元素，因此您可以为模式内的所有元素分配权限，而不必为每个过程/表进行配置。

是否让身份流向 SQL Server 而不是使用受信任的子系统模型所涉及的决策非常特定于特定场景。也就是说，我不喜欢像那样流动身份，因为通常仍然在应用程序上执行逻辑，这意味着 sp 可能正在执行部分规则。由于这个原因，这种方法也推动了存储过程中的更多逻辑。

关于只有管理员有权访问机器中的用户组，请考虑查看 ADAM（活动目录应用程序模式）。我不知道它是否支持将它与 SQL Server 集成，所以我不确定这是否适用于该架构。不过值得检查。

关于无法获取角色，根据您的信息，我假设用户组和所涉及的数据库角色之间存在密切关系。您可以获取用户在活动目录中的组（角色）。

底线：评估 ADAM 如何适合您的场景，以及使用当前身份流方法所涉及的注意事项是否仍然存在。另外不要忘记考虑项目中更改应用程序身份流的影响。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T16:13:23.637

尝试重构您的设计，使您的存储库本身是 LDAP。所以本质上你的用户和角色对象映射了 AD 对象。然后，您可以拥有完全的控制权，而无需通过各种系统管理员。当然，这并不容易，具体取决于代码的状态。但最好的开始方法是创建小型概念证明来完成您的业务对象到 AD 的映射。

# security - Web 服务器的防火墙是否应该阻止通过端口 80 的出站 HTTP 流量？

> ID：714631
> 
> 赞同：6
> 
> 时间：2009-04-03T16:13:04.963
> 
> 标签：security, http, sysadmin, firewall

我理解需要将 Web 服务器放在 DMZ 中并阻止除 80 和 443 之外的所有端口的入站流量。我还可以理解为什么您可能还应该阻止大多数出站流量，以防服务器受到损害。

但是是否有必要阻止通过端口 80 的出站 HTTP 流量？如果是这样，为什么？如今，许多 Web 应用程序依赖于从外部 Web 服务和 API 发送/检索数据，因此阻止端口 80 上的出站流量将阻止此功能。是否存在足够有效的安全问题来证明这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-03T16:15:37.047

我能想到的唯一原因是，如果您的机器以某种方式远程受损，那么它将无法在端口 80 上对另一个网站进行 DDoS 攻击。但这不是我通常会做的事情。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T16:36:56.530

与其阻止它，不如扼杀它。使用 iptables -m 限制。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T16:38:10.660

我有几个调用外部 Web 服务的 Web 应用程序，所以我会说阻止输出 HTTP 流量是个坏主意。如果您担心安全性，您可以阻止它并只允许某些目的地。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-03T17:48:24.407

根据您的 SQL 版本，您可能会遇到 SQL Server 2005 的证书身份验证超时问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-05-31T22:51:16.863

首先 - 我同意@vartec 对节流的看法，“而不是阻止它，节流它。使用 iptables -m limit”作为解决方案的至少一部分。

但是，我可以提供另一个理由来始终不阻止端口 80 出站。如果您打开了自动安全更新，则服务器无法通过端口 80 访问 PPA 以启动安全更新。因此，如果您设置了自动安全更新，它们将不会运行。在 ubuntu 上，自动安全更新在 14.04 LTS 中打开：

```
 sudo apt-get install unattended-upgrades update-notifier-common && \
 sudo dpkg-reconfigure -plow unattended-upgrades
 (then select "YES") 
```

更优雅的解决方案是自动打开端口的 ansible 脚本，如果您在 AWS，除了 iptables 之外，还可能通过 CLI 修改 AWS 安全组规则。我更喜欢通过由隐身盒启动的 AWS CLI 临时修改我的出站规则。这会强制将更新记录在我的 AWS S3 日志存储桶中，但不会出现在服务器本身的日志中。此外，启动更新的服务器甚至不必位于私有子网 ACL 中。

也许两者都做？您有时必须考虑到攻击会中继您子网中的内部 IP，因此在保留自动备份和安全更新的能力的同时，加倍降级是有好处的。

我希望这有帮助。如果不回复并提供更多代码示例以更具体和准确。＃注意安全 ！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-06-20T22:16:41.373

如果机器受到攻击并且允许端口 80 上的出站流量，那么入侵者将更容易将收集到的数据发回给自己。允许出站流量意味着您可以启动从您的机器到外部世界的连接。更好的方法是只允许出站流量到您信任的某些网站/地址（即 Microsoft Windows Update、Google reCAPTCHA），而不是世界上的任何目的地。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-04-03T16:21:01.933

阻止通过端口 80 的出站流量是什么意思。

你有两种可能。生成动态规则，允许从客户端到您的网络服务器进行此会话的通信。搜索状态防火墙规则。

或者，您通常允许已建立的连接相互进出通信。

如果您通常阻止通过端口 80 的所有出站流量，您的 Web 服务器将无法回复任何客户端。

反过来，如果您的 Web 服务器需要获取一些 API，例如 jquery 库，他不会使用端口 80 作为他的端口来与持有 API 的 Web 服务器通信。

您的 Web 服务器通常会选择一个 > 1024 的端口并将其用于他的请求以从远程服务器获取 API。

因此，阻止端口 80 上的所有流量（作为您连接的端口）不会阻止您的服务器发送任何对 api 和此类事物的请求。因为他作为客户端不使用80端口。

# asp.net-mvc - 复杂复合对象的自定义模型绑定器帮助

> ID：714634
> 
> 赞同：7
> 
> 时间：2009-04-03T16:14:23.713
> 
> 标签：asp.net-mvc, modelbinders

我正在尝试编写自定义模型绑定器，但我很难弄清楚如何绑定复杂的复合对象。

这是我要绑定的类：

```
public class Fund
{
        public int Id { get; set; }
        public string Name { get; set; }
        public List<FundAllocation> FundAllocations { get; set; }
} 
```

这就是我尝试编写自定义活页夹的样子：

```
public class FundModelBinder : IModelBinder
{
    public object BindModel(ControllerContext controllerContext, ModelBindingContext bindingContext)
    {
        throw new NotImplementedException();
    }

    public object GetValue(ControllerContext controllerContext, string modelName, Type modelType, ModelStateDictionary modelState)
    {
        var fund = new Fund();

        fund.Id = int.Parse(controllerContext.HttpContext.Request.Form["Id"]);
        fund.Name = controllerContext.HttpContext.Request.Form["Name"];

        //i don't know how to bind to the list property :(
        fund.FundItems[0].Catalogue.Id = controllerContext.HttpContext.Request.Form["FundItem.Catalogue.Id"];
        return fund;
    }
} 
```

有任何想法吗

谢谢托尼

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-22T10:43:18.157

你真的需要在这里实现一个自定义的 ModelBinder 吗？默认绑定器可以满足您的需要（因为它可以填充集合和复杂对象）：

假设您的控制器操作如下所示：

```
public ActionResult SomeAction(Fund fund)
{
  //do some stuff
  return View();
} 
```

你的 html 包含这个：

```
<input type="text" name="fund.Id" value="1" />
<input type="text" name="fund.Name" value="SomeName" />

<input type="text" name="fund.FundAllocations.Index" value="0" />
<input type="text" name="fund.FundAllocations[0].SomeProperty" value="abc" />

<input type="text" name="fund.FundAllocations.Index" value="1" />
<input type="text" name="fund.FundAllocations[1].SomeProperty" value="xyz" /> 
```

默认模型绑定器应使用 FundAllocations 列表中的 2 个项目初始化您的基金对象（我不知道您的 FundAllocation 类是什么样的，所以我组成了一个属性“SomeProperty”）。只需确保包含那些“fund.FundAllocations.Index”元素（默认活页夹查看它以供自己使用），当我试图让它工作时让我得到了）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-22T10:18:23.910

我最近在同样的事情上花了太多钱！

在没有看到您的 HTML 表单的情况下，我猜它只是从多选列表或其他内容中返回选择结果？如果是这样，您的表单只是返回一堆整数，而不是返回您的水合`FundAllocations`对象。如果您想这样做，那么在您的自定义 ModelBinder 中，您将需要自己进行查找并自己水合对象。

就像是：

```
fund.FundAllocations = 
      repository.Where(f => 
      controllerContext.HttpContext.Request.Form["FundItem.Catalogue.Id"].Contains(f.Id.ToString()); 
```

当然，我的 LINQ 只是示例，您显然可以随心所欲地检索数据。顺便说一句，我知道它不能回答你的问题，但经过一番折腾后，我决定对于复杂的对象，我最好使用 ViewModel 并将默认的 ModelBinder 绑定到它，然后，如果我需要，水合物代表我的实体的模型。我遇到了许多问题，这些问题使它成为最佳选择，我现在不会让你厌烦它们，但如果你愿意，我很乐意推断。

最新的[Herding Code 播客](http://herdingcode.com/?p=177)对此进行了很好的讨论，[K Scott Allen 的 Putting the M in MVC 博客文章也是](http://odetocode.com)如此。

# silverlight - Silverlight MVVM 隔离存储

> ID：714640
> 
> 赞同：1
> 
> 时间：2009-04-03T16:15:46.987
> 
> 标签：silverlight, mvvm, isolatedstorage

我尝试在我的 ViewModel 中使用 IsolatedStorageSettings，但这些设置不会在浏览器刷新 (F5) 时保留。

例如;

```
//look in the IsoStore for remembered details

    IsRememberMe = IsolatedStorageSettings.ApplicationSettings.Contains(Constants.LOGIN_REMEMBERED_USERNAME);

        if (IsRememberMe)
        {
            UserName = IsolatedStorageSettings.ApplicationSettings[Constants.LOGIN_REMEMBERED_USERNAME] as string;
        } 
```

我需要在我的 MVVM ViewModel 中做一些不同的事情吗？

**编辑** 值得注意的是，这段代码位于一个引用的项目中——因此最终将一个单独的 XAP 文件发送到浏览器中加载的父 XAP——这是否会导致每次刷新时丢失设置？

谢谢，马克

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-04T13:39:29.130

好...

在我的情况下，我在使用应用程序隔离存储时遇到问题，每次我部署我的应用程序的新版本时（例如更改按钮的颜色，我丢失了 Iso 存储:-()。

我转而使用 SiteStorage 而不是应用程序级别，它起作用了：

[http://www.tipsdotnet.com/TechBlog.aspx?PageIndex=0&BLID=13](http://www.tipsdotnet.com/TechBlog.aspx?PageIndex=0&BLID=13)

另一方面，我对 Iso Storage 所做的是对文件夹和文件执行 CRUD，不确定其他类型的设置。

HTH布劳里奥

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T17:13:00.203

我认为这里正在发生两件事之一。您的绑定在两个方向上都无法正常工作，因此永远不会命中持久性或检索代码。或者，您将这些值存储在来自两个不同应用程序（或类似的东西）的应用程序级 iso 存储中。确保您的代码在两种情况下（存储和检索）都被命中，并确保您从同一个地方访问 iso 存储（如果您使用应用程序级隔离，从同一个应用程序存储/检索等）。

# asp.net - IE8 Win7 Facebook 连接问题

> ID：714646
> 
> 赞同：6
> 
> 时间：2009-04-03T16:17:26.857
> 
> 标签：asp.net, asp.net-mvc, internet-explorer-8, facebook

2009 年 4 月 8 日更新 - 我进入了新的一周，没有任何进展，也没有来自 Facebook 论坛的答案。那边没有一个回应，这很令人失望。我也无法弄清楚如何在这个问题上悬赏，但我真的很想解决这个问题。

* * *

我看了很多帖子，看看有没有以前发过，其实不是。这是简短的版本：

我正在浏览示例 FB Connect 教程 (v1)，但无法使其在 Win7 上的 IE8 中运行。它在 Win7 上的 FF3 上按预期工作。

长版：

我很惊讶事情没有工作，因为我已经复制并粘贴了很多内容。我用 alert() javascript调用跳过了这一点，所以我把它放进去看看解析器是否能做到这一点。我将以下代码放入：

```
[my raw html]
Or use, <fb:login-button length="long" onlogin="alert('yo!!!');"></fb:login-button>
[/my raw html] 
```

IE8 上没有弹出警报。它适用于FF。

当我改回调用 update_user_box() 时，我的 HTML 如下所示：

```
Or use, <fb:login-button length="long" onlogin="update_user_box();"></fb:login-button>

<script type="text/javascript">
    function update_user_box() {
        var user_box = document.getElementById("user");
        user_box.innerHTML =
            "<span>"
            + "<fb:profile-pic uid='loggedinuser' facebook-logo='true'></fb:profile_pic>"
            + "Welcome, <fb:name uid='loggedinuser' useyou='false'></fb:name>."
            + "You are signed in."
            + "</span>"

        FB.XFBML.Host.parseDomTree();
    }

    FB.init("23e24c73feed7ca0f6afd876575842de", "../../Connect/xd_receiver.htm", { "ifUserConnected": update_user_box });
</script> 
```

同样，这在 FF3 中也能正常工作。我的照片和一切都出现了。实际上，它在 FF3 中的工作比完全没有工作的情况更让我不安。

这是 IE8 中的见证行为：

1.  当我单击 FBConnect 按钮时。javascript 窗口弹出并加载正确的登录页面

2.  焦点变回主窗口（带有我的应用程序的窗口）

3.  IE8 主窗口（我单击连接按钮的那个窗口）现在显示一个 facebook 登录页面。

4.  当我在 FB javascript 窗口中输入我的凭据时，该页面会加载该页面的空白文档 URL：[http://localhost:55994/Connect/xd_receiver.htm?fb_login&fname=_opener&session=%7B%22session_key%22%3A%223 .A4DpHk4nrKHooB7K_Q6EiA__.86400.1238796000-623225%22%2C%22uid%22%3A%22623225%22%2C%22expires%22%3A1238796000%2C%22secret%22%3A%22HtjtJS_xg8dX7TR7lLggew__%22%2C%22sig%22%3A%22ae12c0f98d4567612b70861314d42fbb %22%7D](http://localhost:55994/Connect/xd_receiver.htm?fb_login&fname=_opener&session=%7B%22session_key%22%3A%223.A4DpHk4nrKHooB7K_Q6EiA__.86400.1238796000-623225%22%2C%22uid%22%3A%22623225%22%2C%22expires%22%3A1238796000%2C%22secret%22%3A%22HtjtJS_xg8dX7TR7lLggew__%22%2C%22sig%22%3A%22ae12c0f98d4567612b70861314d42fbb%22%7D)

查看该页面的源代码：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<body>
    <script src="http://static.ak.connect.facebook.com/js/api_lib/v0.4/XdCommReceiver.js" type="text/javascript"></script>
</body>
</html> 
```

5，如果我关闭该窗口并在应用程序窗口中键入我的凭据，则页面将使用 FBConnect 按钮重新加载。

正如我所说，我在 FF3 中得到了预期的行为，但在 IE8 中没有。我什至尝试过IE8的兼容模式，但也没有用。有人对正在发生的事情有任何线索吗？

我的 HTML 标签看起来像：

所以我知道这不是问题。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-13T21:40:04.070

我遇到了同样的问题 - 确保您在主页上设置了 HTML 命名空间：

```
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://www.facebook.com/2008/fbml"> 
```

[http://forum.developers.facebook.com/viewtopic.php?id=23412](http://forum.developers.facebook.com/viewtopic.php?id=23412)

另外，我做了一些引导以防止出现空错误：

```
FB.Bootstrap.requireFeatures(["Connect"], function() 
{
    FB.init("--api-key--","domain/xd_receiver.htm");
    FB.Connect.ifUserConnected(your_function_here);
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-05-25T11:13:43.683

IE8 和 Facebook 连接简单。

在我的 Facebook Connect 网站上，我正在开发 Facebook 小部件，根本没有加载

当然，您必须在 IE8 中启用 Javascript（关于此的许多其他信息），这是我确定的。

还是不行。

然后是达伦特牛顿上面的帖子....

`<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://www.facebook.com/2008/fbml">`

行得通！谢谢达伦。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-03T16:02:25.820

我在让 facebook 连接使用新的 Javascript SDK 身份验证方法时遇到了一些麻烦——它在 Chrome 和 FF 中运行良好，但在 IE8.0 中运行良好

经过一番修补后，我发现这 `<html xmlns="http://www.w3.org/1999/xhtml" xmlns:fb="http://www.facebook.com/2008/fbml">`是必要的。

我还必须编辑我的应用程序设置：将连接 URL 更改为： http: [//XXX.example.com.org](http://XXX.example.com.org:8006/XXXX/) :8006/XXXX / 并将基本域更改为： `example.com`

注意：当我在本地机器上测试时，将基域设置为 IP 地址不起作用。渲染方式：iframe

供参考的Javascript：

```
<script src="http://connect.facebook.net/en_US/all.js"></script>

<script>

  FB.init({appId: '{{facebook_app_id}}', status: true, cookie: true, xfbml: true});
  FB.Event.subscribe('auth.sessionChange', function(response) {
    if (response.session) {
      // A user has logged in, and a new cookie has been saved
        window.location.reload();
    } else {
        // The user has logged out, and the cookie has been cleared
    }
  });

</script> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-06-21T19:31:49.850

有点晚了，但这救了我的皮！！希望这对其他人有帮助！

> FB Connect在IE8、IE9登录时显示空白弹窗解决方法：
> 
> 使用自定义频道网址
> 
> 1.在FB.init会话中添加channelUrl参数。
> 
> FB.init({ appId : 'YOUR APP ID', status : true, cookie : true, xfbml : true, channelUrl: "http://yourdomainname/fbtest/channel.html" //将此文件添加到您的网站中。
> } );
> 
> 2.channel.html文件的内容应该是这一行：
> 
> 3.测试您的FB登录...享受...

请参阅[http://forum.developers.facebook.net...](http://forum.developers.facebook.net/viewtopic.php?pid=353827)了解完整的论坛主题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-11-08T16:23:26.710

我有一个非常相似的问题。在 IE7-8 Win7 上，我得到“无法显示页面”。弹出窗口为空。

在 Fiddler 上，它不会将安全调用传递给 CONNECT（主机）。

我正在使用带有 API.ui/stream.Publish 的 Facebook Javascript SDK API。我已经设置了 2 个应用程序。一个用于法语域，一个用于英语域。英文域响应正确，法语域没有。两个连接网址/基本域均已正确设置。

这适用于所有其他浏览器/操作系统组合。

我试过fb xmlns，没有结果。

# c# - 在 C# 中将帖子标题转换为 URL 的最佳方法

> ID：714653
> 
> 赞同：3
> 
> 时间：2009-04-03T16:19:59.660
> 
> 标签：c#, regex, url

我想知道将字符串（例如帖子标题）转换为描述性 URL 的最佳方法是什么。想到的最简单的方法是使用正则表达式，例如：

```
public static Regex regex = new Regex(
      "\\W+",
    RegexOptions.IgnoreCase
    | RegexOptions.CultureInvariant
    | RegexOptions.IgnorePatternWhitespace
    | RegexOptions.Compiled
    );

string result = regex.Replace(InputText,"_"); 
```

哪个转

“我的第一个（但还不错）纸杯蛋糕！！:) .//\。”

进入

```
my_first_yet_not_so_bad_cupcake_ 
```

然后我可以去掉最后一个“_”并对照我的数据库检查它，看看它是否还存在。在这种情况下，我会添加一个尾随数字以使其唯一并重新检查。

我可以用它，说

```
http://myblogsite.xom/posts/my_first_yet_not_so_bad_cupcake 
```

但是，这种方式安全吗？我应该检查其他东西（比如字符串的长度）还有其他更好的方法吗？谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T16:49:30.663

这就是我所做的。regStripNonAlpha 删除所有非字母或“-”字符。Trim() 删除尾随和前导空格（因此我们不会在两边都出现破折号）。regSpaceToDash 将空格（或空格）转换为单个破折号。这对我来说效果很好。

```
static Regex regStripNonAlpha = new Regex(@"[^\w\s\-]+", RegexOptions.Compiled);
static Regex regSpaceToDash = new Regex(@"[\s]+", RegexOptions.Compiled);

public static string MakeUrlCompatible(string title)
{
    return regSpaceToDash.Replace(
      regStripNonAlpha.Replace(title, string.Empty).Trim(), "-");
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T16:23:49.760

字符串结果 = regex.Replace(InputText,"-");

而不是在分数下放 hypen (-)，这将为 Google 搜索引擎带来额外的优势。

有关更多详细信息，请参阅下面的帖子

[http://www.mattcutts.com/blog/dashes-vs-underscores/](http://www.mattcutts.com/blog/dashes-vs-underscores/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T16:52:28.643

这是我不久前写的一个方法，它接受一个字符串并将其格式化为一个永久链接。

```
 private string FormatPermalink(string title)
        {
            StringBuilder result = new StringBuilder();
            title = title.Trim();
            bool lastOneChanged = false;
            for (int i = 0; i < title.Length; i++)
            {
                char c = title[i];
                if (!char.IsLetterOrDigit(c))
                {
                    c = '_';
                    if (lastOneChanged)
                    {
                        continue;
                    }
                    lastOneChanged = true;
                }

                else
                {
                    lastOneChanged = false;
                }

                result.Append(c);
            }

            if (result[result.Length - 1] == '_') //if last one is underscore, remove
            {
                result = result.Remove(result.Length - 1, 1);
            }
            return result.ToString();
        } 
```

这也考虑了特殊字符，所以如果标题有特殊字符，它会忽略它并继续下一个。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-03T16:30:59.273

您可以查看 URL 重写 HTTPModule。网络上有很多例子。

一旦在您的 web.config 中实现，您只需使用 SEO 友好名称指定正则表达式以映射到“真实”页面

```
<!-- Rule 1: example... "/admin/somepage" redirects to..."/UI/Forms/Admin/frmPage.aspx" -->

  <add key="^/admin/(.*)" value="/UI/Forms/Admin/frm$1.aspx" /> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-03T16:52:47.443

如果您想避免自己这样做，像[http://urlrewriter.net/](http://urlrewriter.net/)这样的 HttpModule 可能会有所帮助。它非常好，但需要一些设置。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-03T16:54:55.097

就个人而言，我会将您的特殊字符与日期结合起来，因此您的示例如下所示：

[http://myblogsite.xom/posts/2009/04/03/my_first_yet_not_so_bad_cupcake](http://myblogsite.xom/posts/2009/04/03/my_first_yet_not_so_bad_cupcake)

这样，如果您满足于相同的标题，它也会按日期区分。我经常在我访问的一些博客上看到这一点，他们经常使用“五件随机的事情发表一篇文章”（但不是在同一天）。

# javascript - 如何在 JavaScript 中创建的 DOM 元素上设置 css ":hover"？

> ID：714655
> 
> 赞同：6
> 
> 时间：2009-04-03T16:20:49.143
> 
> 标签：javascript, html, css, dom

我正在使用 DOM 来管理来自我正在运行的 AJAX 函数的 JSON 响应。我正在编写的脚本需要完全可移植，因此我正在动态定义创建元素的样式（意思是，不链接到外部 CSS，也不在 HTML 文档本身中提供 CSS，因为我不会控制文档）。

我想在某些元素上创建悬停效果。

例子：

```
#myDiv：悬停{背景：#000000; }
```

有没有办法在 DOM 中定义它？还是我必须使用`mouseover`？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-03T16:34:35.833

您可以动态创建和操作样式表。有关此方法的一些跨浏览器问题，[请参见此处。](http://www.quirksmode.org/dom/w3c_css.html#change)

我有一个包装器函数，可以[围绕](http://mercurial.intuxication.org/hg/js-hacks/raw-file/tip/createstylesheet.js)其中一些函数工作；使用它，代码将读取

```
document.createStyleSheet().addRule('#myDiv:hover', 'background:#000000;'); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-14T06:57:19.267

您可以使用预定义的类创建元素：

```
.h:hover{color: #c00}

var elem = document.createElement('div');
elem.className = 'h' 
```

# flash - 在 AIR 中读取 TIFF 文件？

> ID：714656
> 
> 赞同：1
> 
> 时间：2009-04-03T16:20:49.827
> 
> 标签：flash, actionscript-3, graphics, air

有什么方法可以`TIFF`使用读取文件`AIR`吗？看起来`Flash`没有对 TIFF 格式的本机支持。有没有可用的图书馆？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-03T16:31:25.793

据此[，](http://help.adobe.com/en_US/ActionScript/3.0_ProgrammingAS3/WS5b3ccc516d4fbf351e63e3d118a9b90204-7d66.html) Adobe Flash Player 和 Adob​​e AIR 支持TIFF **，**以及 BMP、GIF、JPG 和 PNG。

**编辑：** 自由贸易协定：

> TIFF 格式的缺点是，由于 TIFF 种类繁多，没有一个阅读器可以处理每个版本。此外，目前没有网络浏览器支持该格式。

**edit2：** 似乎无法动态加载 TIFF。我找不到任何第三方库可以这样做。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-03T13:47:18.310

我找到了一个工作解码器（仅限未压缩文件）：[http ://www.ctyeung.com/AIR/index.html](http://www.ctyeung.com/AIR/index.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-04T06:54:35.173

[这](http://blog.kevinhoyt.org/2009/03/10/actionscript-3-tiff-encoder/)是一个开源编码项目，据作者说，解码未来一直在努力。

# project-management - 管理里程碑和 Web 开发项目

> ID：714663
> 
> 赞同：8
> 
> 时间：2009-04-03T16:21:31.557
> 
> 标签：project-management, trac

我正在尝试实现 Trac+SVN。但是我遇到了项目管理问题。给你一个背景，我的大部分项目都与 Web 开发有关（它们经历了设计、编程、测试等阶段）。

现在我正在为我的项目实施 Trac。现在的问题是我应该放置什么作为里程碑和票证。对于门票，我应该得到多少粒度？例如，我应该说使 X 成为 Y 功能的一部分还是仅使 Y 功能。我制作的票越多，我花在制作这些票上的时间就越多。

另外，对于里程碑，我见过像 CakePHP 等项目。当他们使用 Trac 时，他们将里程碑设置为版本号（对应于 SVN 中的标签）。这是最好的方法吗？

假设我有一个客户的最后期限是 X 日期。然后我将我的里程碑设置为 1.0，截止日期为 X。但是我如何每周跟踪项目？因为我不想在发布日期前一天意识到剩下的太多了。我想以某种方式每周检查一次。

此外，我还想将增强/错误考虑在内，并将它们作为里程碑组合在一起。

我想象过类似 1.xx 的东西，其中第一个 x 对应于一组功能增强，而第二个 x 对应于错误修复。有没有更好的办法？如何在这样的系统中管理每周状态？

有没有标准的方法来做到这一点？我该怎么做？我完全糊涂了。

谢谢你。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-09T11:25:46.977

这要看情况。你没有具体说明项目有多大，有多少程序员工作，你计划多久交付一次。

说明一下，这是我们在一个跨越数年的大型项目中使用 Trac 的方式，该项目由许多较小的子项目组成。

*   **里程碑**被定义为我们在子项目中准备好交付的一些功能点。每个子项目的第一个里程碑通常是最长的。我们通常将里程碑命名为“子项目名称 v0.01”。版本只是增量 0.01, 0.02, ... 当我们实现子项目预期的所有内容时，我们将最后一个里程碑标记为 v1.00。随后的错误修复进入我们标记为“子项目名称 - v1.00 - 错误修复”的里程碑

*   里程碑描述仅包含新功能或错误修复的列表。文档写在 wiki 和门票中。

*   **Trac Wiki**通常至少有一页关于将在特定里程碑中实现的新功能。它通常是对应用程序预期行为的更高级别的描述。通常，有一些应用程序应该产生的预期结果的例子。

*   **工单**包含必须实现的功能或错误的详细描述。

    *   错误报告票包含错误描述和重现步骤（几乎总是）。
    *   功能票包含对必须实现的功能的详细描述。一张票包含**长达 6 小时的工作**。当我们计划工作时，我们将功能划分为 1 到 6 小时的工作时间。如果我们估计该功能需要更多时间，那么我们会将其分成几张票，以便每张票都可以适应 1-6 小时的工作。我们选择 6 小时是因为我们认为它是我们可以估计的最高值，误差不大于 30%（这意味着这 6 小时的估计几乎总是可以在 4-8 小时的范围内完成）。当然，这个统计数据也有例外。根据我们的经验，错误估计的主要原因是我们编写的规范错误。这几乎总是发生，因为我们（开发人员）误解了用户的业务需求。
*   用于估计和时间跟踪的 Trac 插件很少。检查此页面：[http](http://trac.edgewall.org/wiki/TimeTracking) ://trac.edgewall.org/wiki/TimeTracking 。我们使用[Timing And Estimation 插件](http://trac-hacks.org/wiki/TimingAndEstimationPlugin) 。您可以输入工单的预计时间和处理工单所花费的时间。然后，您可以获得报告您在工单/里程碑上花费了多少时间以及您需要多少时间完成。

两年后，我们可以非常准确地估计完成某些工作所需的时间。当我们正确理解用户的需求和要求时，我们通常可以在承诺的时间范围内交付。目前，我们的统计数据显示，我们高估了大约 10% 的购票时间。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-10T11:44:35.540

一个小小的警告：我不知道使用 Trac... 或 SVN。我认为您的里程碑不应该由版本控制/错误跟踪系统设置。

通常，里程碑只是您项目中的重要事件。它们应该对所有利益相关者都很重要。一个主要可交付成果的完成是一个里程碑。一些功能的完成不是。签署所有计划和合同是一件大事，但完成 10 个模型却不是。

我倾向于使用时间表和任务来与团队合作。完成任务后勾选它们。对于其他所有人，我只报告里程碑。我们要在 5 月 15 日之前制作 UAT 吗？是的我们是。

由于里程碑是向赞助商和其他利益相关者报告的工具，因此您应该将它们设置为他们认为重要的内容。我的赞助商会想知道某个核心功能集何时完成，这是一个里程碑。他们会想知道何时签署 UAT，这是一个里程碑。

设定的里程碑太少，直到最后没人会知道你的进展情况。设置太多，值会丢失。

没有神奇的公式，但有数百个任务和数千个工时的项目可能只有 4 个里程碑。

[替代文字 http://officeadd.in/Images/articles/ProjectMilestones-scribblea.png](http://officeadd.in/Images/articles/ProjectMilestones-scribblea.png "只是一个时间表和里程碑的粗略图")

抱歉，这与 Trac 和 SVN 没有直接关系，但希望这能让您大致了解里程碑通常是如何使用的。哦，并为过度使用 Comic Sans 提前道歉……糟糕。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T17:06:46.660

将您的 1.0 里程碑设置为可交付日期很好，但您需要定义更早的里程碑 - 如果这对您来说是一个合适的间隔，请每周进行一次，并适当地对它们进行编号。对于一个为期 4 周的项目，0.2、0.5、0.7 和 1.0 可能会起作用。列出每个里程碑的相关位：“设计完成”、“编码完成”、“测试完成”等。如果您没有达到目标，那么真正的项目管理工作就开始了！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T12:18:44.650

我看到你有几个选择和几个决定要做。

您可以考虑[功能驱动开发](http://en.wikipedia.org/wiki/Feature_Driven_Development)。您可以使用 trac 来支持通信而不是控制。粗粒度任务、细粒度工单和早期版本。

列出要开发的功能，并说明发布，比如说……版本 1.0，当所有功能都被开发和测试时发生。为所有功能制作雨伞票。有粗粒度的，将定义开发节奏。

现在根据计划的功能数量和时间定义几个里程碑。第一个里程碑应该包含至少一个特性，因为里程碑的目标是构建项目以进行测试和反馈。定义一个或多个里程碑来标记所有功能何时完成，称它们为“测试版”、“候选发布版”或其他任何名称。

如果在开发过程中需要更细粒度的任务，请不要害羞。并使伞式任务依赖于这些较新的票证。

错误报告不需要在其中任何一个之下，并且可以根据需要包含尽可能多的详细信息。这些是细粒度的。这些*不会*定义发展节奏。一个例外是一个 bug squashing sprint 以消除干扰。发布具有更多已分配且未解决的错误的开发人员的姓名，以迫使他们解决问题。

制作里程碑、测试版或发布候选版本的过程的一部分是标记源以使该过程可重复，并且即使在主干源已经更改时也能够发现错误。在 SVN 上，标记的常用方法包括将主干源复制到“标记”上的目录，并确保没有人提交到该分支。

我相信对于大多数情况来说，两个数字的版本号就足够了。第一个数字表示兼容性，第二个数字表示版本。但是版本号中可以包含几个变量：源代码兼容性、二进制兼容性、错误修复级别、版本、配套产品版本（ala oracle）、协议兼容性等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-10T03:44:24.803

我已经使用 Trac/SVN 两年半了。

这是我的建议：

*   将软件版本的生产拆分为几个迭代：Inception、Elaboration、Transition（或随意调用它们）
*   为第一次迭代计划功能。对于其他人计划增强和错误修复
*   任务（票证）应尽可能细化，前提是每张票证都有对客户有价值的可交付成果
*   节省创建工单的时间不是一个好主意。更细化和更小的任务——对进度的更多控制。因此，更早地发现规划的缺陷和更多的时间来管理出来。
*   即使在进行中，门票也可以拆分。如果开发人员达到了可以显示给客户的结果但没有完成整个任务，那么开发人员可以拆分任务并将完成的部分标记为“关闭”或“已解决”，从而提供更精细的控制。
*   每天而不是每周（或每周至少几次）跟踪进度

Trac 是一个非常好的工具。最好的功能或 Trac 是能够将 WikiLinks 放在任何地方，包括变更集评论。如果您要求将票证 # 放入变更集注释，然后将变更集编号放入票证注释，这会将任务和更改链接到代码。稍后，这些链接可以更轻松地跟踪软件的演变。这是一个救生员，特别是如果项目的持续时间超过几个月。

# starteam - StarTeam 没有签出到工作文件夹？

> ID：714664
> 
> 赞同：1
> 
> 时间：2009-04-03T16:21:46.270
> 
> 标签：starteam, vcs-checkout

我正在使用 StarTeam 4.1，并且正在尝试使用 StarTeam 的命令行版本来签出文件夹中的所有文件。但由于某种原因，它没有检出到 C:\Installation，而是检出到 C:\400\Installation。在 GUI 中，StarTeam 明确指出完整的工作文件夹路径是 C:\Installation。如果我运行 stcmd.exe 并尝试从安装的根目录检出单个文件，它说没有这样的文件，而我可以从 GUI 中检出它。stcmd.exe 也不会显示安装的所有子文件夹。知道为什么会发生这种情况吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-03T19:32:05.250

我没有意识到在 checkout 命令中指定了视图名称。如果不指定视图名称，则使用默认值。在我的例子中，有一个名为 Installation 的文件夹和一个名为 Installation 的视图。由于我刚刚指定签出安装，因此它被解释为视图名称而不是文件夹，并且安装视图出于某种原因将安装文件夹签出到 C:\400\Installation。

# c# - 扩展 Control 以提供始终安全的 Invoke/BeginInvoke 功能是否合适？

> ID：714666
> 
> 赞同：33
> 
> 时间：2009-04-03T16:22:21.073
> 
> 标签：c#, winforms, controls, extension-methods, invoke

在维护严重违反 winforms 中的跨线程更新规则的旧应用程序的过程中，我创建了以下扩展方法，以在发现非法调用时快速修复它们：

```
/// <summary>
/// Execute a method on the control's owning thread.
/// </summary>
/// <param name="uiElement">The control that is being updated.</param>
/// <param name="updater">The method that updates uiElement.</param>
/// <param name="forceSynchronous">True to force synchronous execution of 
/// updater.  False to allow asynchronous execution if the call is marshalled
/// from a non-GUI thread.  If the method is called on the GUI thread,
/// execution is always synchronous.</param>
public static void SafeInvoke(this Control uiElement, Action updater, bool forceSynchronous)
{
    if (uiElement == null)
    {
        throw new ArgumentNullException("uiElement");
    }

    if (uiElement.InvokeRequired)
    {
        if (forceSynchronous)
        {
            uiElement.Invoke((Action)delegate { SafeInvoke(uiElement, updater, forceSynchronous); });
        }
        else
        {
            uiElement.BeginInvoke((Action)delegate { SafeInvoke(uiElement, updater, forceSynchronous); });
        }
    }
    else
    {
        if (!uiElement.IsHandleCreated)
        {
            // Do nothing if the handle isn't created already.  The user's responsible
            // for ensuring that the handle they give us exists.
            return;
        }

        if (uiElement.IsDisposed)
        {
            throw new ObjectDisposedException("Control is already disposed.");
        }

        updater();
    }
} 
```

示例用法：

```
this.lblTimeDisplay.SafeInvoke(() => this.lblTimeDisplay.Text = this.task.Duration.ToString(), false); 
```

我也喜欢如何利用闭包来读取，尽管在这种情况下 forceSynchronous 需要为真：

```
string taskName = string.Empty;
this.txtTaskName.SafeInvoke(() => taskName = this.txtTaskName.Text, true); 
```

我不质疑这种方法对修复遗留代码中的非法调用的有用性，但是新代码呢？

当您可能不知道哪个线程正在尝试更新 ui 时，使用此方法更新新软件中的 UI 是否是一个好的设计，或者新的 Winforms 代码通常应该包含一个特定的、专用的方法以及适当的`Invoke()`相关管道所有这些用户界面更新？（当然，我会先尝试使用其他合适的后台处理技术，例如 BackgroundWorker。）

有趣的是，这不适用于[ToolStripItems](http://msdn.microsoft.com/en-us/library/system.windows.forms.toolstripitem.aspx)。我最近才发现它们直接来自[Component](http://msdn.microsoft.com/en-us/library/system.componentmodel.component.aspx)而不是来自[Control](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.aspx)。相反，`ToolStrip`应该使用包含的调用。

## 评论的跟进：

一些评论表明：

```
if (uiElement.InvokeRequired) 
```

应该：

```
if (uiElement.InvokeRequired && uiElement.IsHandleCreated) 
```

考虑以下[msdn 文档](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.invokerequired.aspx)：

> 这意味着 如果不需要 Invoke（调用发生在同一个线程上），或者**如果控件是在不同的线程上创建但尚未创建控件的句柄，则 InvokeRequired 可以****返回 false 。**
> 
>  **在尚未创建控件句柄的情况下，不应简单地调用控件上的属性、方法或事件。这可能会导致在后台线程上创建控件的句柄，从而在没有消息泵的线程上隔离控件并​​使应用程序不稳定。
> 
> **当 InvokeRequired 在后台线程上返回 false 时，您还可以通过检查 IsHandleCreated 的值来防止这种情况。****

 **如果控件是在不同的线程上创建的，但尚未创建控件的句柄，则`InvokeRequired`返回 false。这意味着如果`InvokeRequired`返回`true`，`IsHandleCreated`将始终为真。再次测试它是多余的和不正确的。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-03T17:02:37.683

您还应该创建 Begin 和 End 扩展方法。如果你使用泛型，你可以让调用看起来更好一些。

```
public static class ControlExtensions
{
  public static void InvokeEx<T>(this T @this, Action<T> action)
    where T : Control
  {
    if (@this.InvokeRequired)
    {
      @this.Invoke(action, new object[] { @this });
    }
    else
    {
      if (!@this.IsHandleCreated)
        return;
      if (@this.IsDisposed)
        throw new ObjectDisposedException("@this is disposed.");

      action(@this);
    }
  }

  public static IAsyncResult BeginInvokeEx<T>(this T @this, Action<T> action)
    where T : Control
  {
    return @this.BeginInvoke((Action)delegate { @this.InvokeEx(action); });
  }

  public static void EndInvokeEx<T>(this T @this, IAsyncResult result)
    where T : Control
  {
    @this.EndInvoke(result);
  }
} 
```

现在你的电话变得更短更清晰了：

```
this.lblTimeDisplay.InvokeEx(l => l.Text = this.task.Duration.ToString());

var result = this.BeginInvokeEx(f => f.Text = "Different Title");
// ... wait
this.EndInvokeEx(result); 
```

对于`Component`s，只需在表单或容器本身上调用。

```
this.InvokeEx(f => f.toolStripItem1.Text = "Hello World"); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-03T16:25:47.070

我喜欢一般的想法，但我确实看到了一个问题。处理 EndInvokes 很重要，否则您可能会发生资源泄漏。我知道很多人不相信这一点，但这确实是真的。

[这是一个谈论它的链接](http://www.interact-sw.co.uk/iangblog/2005/05/16/endinvokerequired)。还有其他的。

但我的主要反应是：是的，我认为你在这里有一个好主意。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-01-30T05:54:16.763

这实际上不是答案，而是回答了已接受答案的一些评论。

对于标准`IAsyncResult`模式，`BeginXXX`方法包含`AsyncCallback`参数，所以如果你想说“我不关心这个——完成后调用 EndInvoke 并忽略结果”，你可以做这样的事情（这是为了`Action`但应该是能够针对其他委托类型进行调整）：

```
 ...
    public static void BeginInvokeEx(this Action a){
        a.BeginInvoke(a.EndInvoke, a);
    }
    ...
    // Don't worry about EndInvoke
    // it will be called when finish
    new Action(() => {}).BeginInvokeEx(); 
```

（不幸的是，在每次使用此模式时，我没有一个解决方案，即不使用辅助函数而不声明变量）。

但是因为`Control.BeginInvoke`我们没有`AsyncCallBack`，所以没有简单的方法来表达这个`Control.EndInvoke`保证被调用。它的设计方式提示它`Control.EndInvoke`是可选的。

# java - 在 Java 中：在给定 COFF/ELF/DWARF 可执行文件的情况下，以编程方式确定 C/C++ 变量的地址

> ID：714675
> 
> 赞同：5
> 
> 时间：2009-04-03T16:24:16.233
> 
> 标签：java, executable, elf, coff, dwarf

这是我时不时遇到的情况：

对于不使用虚拟寻址的嵌入式系统，我有一个从 C 或 C++ 代码编译的可执行文件，其中包含调试信息。它通常采用 COFF 或 ELF/DWARF（我把这两种混淆）格式。

在运行时，在 PC 上，我想确定给定名称的变量的地址。（例如“foo.bar[7].baz”）这允许我在嵌入式系统上读/写变量的值（给定一个超出此问题范围的调试协议）。显然，任何基于堆栈或基于堆的变量都不存在，因为它们没有静态地址。

我之前已经在 C++ 中完成了这项工作，以从 TI 的编译器为他们的 2800 系列 DSP 解析 COFF 文件，这有点痛苦。我想知道那里是否已经有一个 Java 库可以做这种事情，因为我面临着同样的事情与一个或两个其他处理器的可执行文件。

* * *

**更新：**（2009 年 11 月 18 日）一个有希望的线索！

有没有人使用过 Eclipse CDT ELF 解析器？

（参见[http://help.eclipse.org/help33/index.jsp?topic=/org.eclipse.cdt.doc.isv/reference/api/org/eclipse/cdt/core/model/IBinary.html](http://help.eclipse.org/help33/index.jsp?topic=/org.eclipse.cdt.doc.isv/reference/api/org/eclipse/cdt/core/model/IBinary.html)之一javadoc pgs 的)

TI 的 Code Composer 4（基于 Eclipse）似乎使用了这个，所以如果我能弄清楚文档在哪里，也许我可以用它来解决我的问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T17:19:49.953

gdb 是否支持您的目标 CPU？

如果是，那么实现调试协议并与目标通信的程序也可以实现[GDB 远程串行协议](http://sourceware.org/gdb/current/onlinedocs/gdb_34.html#SEC721)并为 gdb 提供一个 TCP 套接字与之通信。

安排是这样的

gdb <--gdb 协议--> java-prog <--你的调试协议--> 目标

要运行整个事情，假设您的目标已经在运行您的程序

1.  运行 java-prog
2.  运行`gdb your-executable`并连接到 java-prog

    (gdb) 目标远程 127.0.0.1：端口

3.  让 gdb 读取一个值

    (gdb) p foo.bar[7].baz

这被转换为通过 TCP 发送到 java-prog 的 gdb 数据包。java-prog 应该在 gdb 协议和您的自定义调试协议之间进行转换。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-04T16:59:10.663

您可以为您的平台编译的[GNU binutils](http://www.gnu.org/software/binutils/)构建一个 JNI 接口。但是，如果 GPL 与您的软件许可冲突，那么这将不是一个可行的解决方案。

# iphone - 如何在 OpenGL 中将场景渲染为蒙版？

> ID：714678
> 
> 赞同：1
> 
> 时间：2009-04-03T16:24:50.257
> 
> 标签：iphone, opengl-es

我已经将 EAGLContext 绘制到 CAEAGLLayer 中（通过 iPhone SDK 中的标准 GLGravityView 示例）。

我想要做的是将我的视图放在另一个视图之上，并使用我在 OpenGL 中渲染的内容来掩盖底层视图。

假设底部视图是一张花的图片，我将 OpenGL 视图放在顶部，并将 OpenGL 透明色设置为不透明黑色，然后渲染我的球体。我希望球体穿过黑色，只露出花朵图片的圆形部分。更好的是同时显示球体（半透明）和花朵，穿过黑色。

我打过电话

```
glView.backgroundColor = [UIColor clearColor];
glClearColor(0.0, 0.0, 0.0, 1.0); 
```

当我设置视图并调用

```
glColor4f( 1.0, 1.0, 1.0, 0.5 ); 
```

就在渲染球体之前。

它只是使球体呈灰白色，并没有显示底层的花朵。我对此并不感到惊讶。

有谁知道如何创建一个面具呢？

谢谢您的帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-24T20:50:44.517

你现在可能已经放弃了，但以防万一......

我认为您的 glClearColor(0.0, 0.0, 0.0, 1.0) 应该是 glClearColor(0.0, 0.0, 0.0, 0.0) 因为您想使用 Alpha=0 将视图清除为“透明黑色”而不是使用 Alpha = 的“不透明黑色” 1.

您还应该确保您的 OpenGL 视图未标记为不透明。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-07T03:45:46.350

我只使用“EAGLayer”或任何它的名字做了类似的事情。只需先绘制背景，然后在顶部绘制更多内容。这很有效，因为底部“层”的轻敲功能要么没有，要么很少。当我想在底部“层”中点击功能时，我只是在某些 xy 坐标附近寻找点击（而不是像使用真实层那样拖放按钮。）

这真的取决于你想对底层做什么。如果你想要的只是花图片，那么我的方法有效。如果您想拖放更复杂的 UI 控件，那么我的方法将行不通。

# c - Alloca 实施

> ID：714692
> 
> 赞同：34
> 
> 时间：2009-04-03T16:28:20.277
> 
> 标签：c, assembly, memory-management, inline-assembly, alloca

如何在 D、C 和 C++ 等语言中使用内联 x86 汇编器实现 alloca()？我想创建一个稍微修改过的版本，但首先我需要知道标准版本是如何实现的。从编译器读取反汇编并没有帮助，因为它们执行了很多优化，我只想要规范形式。

编辑：我想困难的部分是我希望它具有正常的函数调用语法，即使用裸函数或其他东西，使其看起来像正常的 alloca()。

编辑＃2：啊，到底是什么，你可以假设我们没有省略帧指针。

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2009-04-03T17:04:45.340

实现`alloca`实际上**需要编译器的帮助**。这里的一些人说这很容易：

```
sub esp, <size> 
```

不幸的是，这只是图片的一半。是的，这将“在堆栈上分配空间”，但有几个陷阱。

1.  如果编译器发出了引用其他变量的代码，`esp`而不是`ebp` （典型的如果你编译没有帧指针）。然后需要调整这些参考。即使使用帧指针，编译器有时也会这样做。

2.  更重要的是，根据定义，分配的空间`alloca`必须在函数退出时“释放”。

最重要的是第 2 点。因为您**需要**编译器发出代码以在函数的每个退出点对称`<size>`添加`esp`。

最可能的情况是编译器提供了一些内在函数，允许库编写者向编译器寻求所需的帮助。

**编辑：**

事实上，在 glibc（GNU 的 libc 实现）中。的实现`alloca`很简单：

```
#ifdef  __GNUC__
# define __alloca(size) __builtin_alloca (size)
#endif /* GCC.  */ 
```

**编辑：**

在考虑之后，我认为编译器需要的最低要求是在任何使用 的函数中**始终**使用帧指针`alloca`，而不管优化设置如何。这将允许通过`ebp`安全地引用所有本地变量，并且将通过将帧指针恢复为`esp`.

**编辑：**

所以我做了一些这样的实验：

```
#include <stdlib.h>
#include <string.h>
#include <stdio.h>

#define __alloca(p, N) \
    do { \
        __asm__ __volatile__( \
        "sub %1, %%esp \n" \
        "mov %%esp, %0  \n" \
         : "=m"(p) \
         : "i"(N) \
         : "esp"); \
    } while(0)

int func() {
    char *p;
    __alloca(p, 100);
    memset(p, 0, 100);
    strcpy(p, "hello world\n");
    printf("%s\n", p);
}

int main() {
    func();
} 
```

不幸的是，**它不能正常工作**。通过 gcc 分析汇编输出后。似乎优化阻碍了。问题似乎是，由于编译器的优化器完全不知道我的内联汇编，它习惯于以意想不到的顺序做事情，并且**仍然**通过`esp`.

这是生成的 ASM：

```
8048454: push   ebp
8048455: mov    ebp,esp
8048457: sub    esp,0x28
804845a: sub    esp,0x64                      ; <- this and the line below are our "alloc"
804845d: mov    DWORD PTR [ebp-0x4],esp
8048460: mov    eax,DWORD PTR [ebp-0x4]
8048463: mov    DWORD PTR [esp+0x8],0x64      ; <- whoops! compiler still referencing via esp
804846b: mov    DWORD PTR [esp+0x4],0x0       ; <- whoops! compiler still referencing via esp
8048473: mov    DWORD PTR [esp],eax           ; <- whoops! compiler still referencing via esp           
8048476: call   8048338 <memset@plt>
804847b: mov    eax,DWORD PTR [ebp-0x4]
804847e: mov    DWORD PTR [esp+0x8],0xd       ; <- whoops! compiler still referencing via esp
8048486: mov    DWORD PTR [esp+0x4],0x80485a8 ; <- whoops! compiler still referencing via esp
804848e: mov    DWORD PTR [esp],eax           ; <- whoops! compiler still referencing via esp
8048491: call   8048358 <memcpy@plt>
8048496: mov    eax,DWORD PTR [ebp-0x4]
8048499: mov    DWORD PTR [esp],eax           ; <- whoops! compiler still referencing via esp
804849c: call   8048368 <puts@plt>
80484a1: leave
80484a2: ret 
```

如您所见，事情并非如此简单。不幸的是，我坚持我最初的断言，即您需要编译器的帮助。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-03T16:54:03.460

这样做会很棘手 - 事实上，除非您对编译器的代码生成有足够的控制权，否则它不能完全安全地完成。您的例程必须操作堆栈，以便在它返回时所有内容都被清除，但堆栈指针仍保留在这样的位置，即内存块仍保留在该位置。

问题是，除非您可以通知编译器堆栈指针已在您的函数调用中被修改，否则它很可能会决定它可以继续通过堆栈指针引用其他本地（或其他） - 但偏移量将是不正确。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-04T19:50:48.550

C 和 C++ 标准没有指定`alloca()`必须使用堆栈，因为`alloca()`不在 C 或 C++ 标准（或 POSIX 中）¹。

编译器也可以`alloca()`使用堆来实现。例如，ARM RealView (RVCT) 编译器`alloca()`用于`malloc()`分配缓冲区（[在其网站上引用](http://infocenter.arm.com/help/index.jsp?topic=/com.arm.doc.dai0212a/ar01s02s02.html)），并且还导致编译器发出代码，在函数返回时释放缓冲区。这不需要使用堆栈指针，但仍需要编译器支持。

如果堆栈上没有足够的空间， Microsoft Visual C++ 有一个[`_malloca()`](http://msdn.microsoft.com/en-us/library/5471dc8s.aspx)使用堆的函数，但它需要调用者使用`_freea()`，不像`_alloca()`，它不需要/想要显式释放。

（使用 C++ 析构函数，您显然可以在没有编译器支持的情况下进行清理，但您不能在任意表达式中声明局部变量，所以我认为您不能编写`alloca()`使用 RAII 的宏。再说一次，显然您无论如何都不能`alloca()`在某些表达式中使用（例如[函数参数](http://c-faq.com/malloc/alloca.html)）。）

¹ 是的，编写一个`alloca()`简单调用`system("/usr/games/nethack")`.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-04T02:14:06.923

对于 D 编程语言，alloca() 的源代码随[下载](http://www.digitalmars.com/d/download.html)一起提供。它的工作原理得到了很好的评论。对于 dmd1，它位于 /dmd/src/phobos/internal/alloca.d 中。对于 dmd2，它位于 /dmd/src/druntime/src/compiler/dmd/alloca.d 中。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-04-20T22:10:45.653

# **延续传递风格 Alloca**

**纯 ISO C++**中的可变长度数组。概念验证实施。

# 用法

```
void foo(unsigned n)
{
    cps_alloca<Payload>(n,[](Payload *first,Payload *last)
    {
        fill(first,last,something);
    });
} 
```

# 核心理念

```
template<typename T,unsigned N,typename F>
auto cps_alloca_static(F &&f) -> decltype(f(nullptr,nullptr))
{
    T data[N];
    return f(&data[0],&data[0]+N);
}

template<typename T,typename F>
auto cps_alloca_dynamic(unsigned n,F &&f) -> decltype(f(nullptr,nullptr))
{
    vector<T> data(n);
    return f(&data[0],&data[0]+n);
}

template<typename T,typename F>
auto cps_alloca(unsigned n,F &&f) -> decltype(f(nullptr,nullptr))
{
    switch(n)
    {
        case 1: return cps_alloca_static<T,1>(f);
        case 2: return cps_alloca_static<T,2>(f);
        case 3: return cps_alloca_static<T,3>(f);
        case 4: return cps_alloca_static<T,4>(f);
        case 0: return f(nullptr,nullptr);
        default: return cps_alloca_dynamic<T>(n,f);
    }; // mpl::for_each / array / index pack / recursive bsearch / etc variacion
} 
```

[**现场演示**](http://ideone.com/HsrQqc)

[**github上的**cps_alloca****](https://github.com/panaseleus/cps_alloca)

 *** * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-03T16:39:06.507

alloca 直接用汇编代码实现。那是因为您无法直接从高级语言控制堆栈布局。

另请注意，大多数实现将执行一些额外的优化，例如出于性能原因对齐堆栈。在 X86 上分配堆栈空间的标准方法如下所示：

```
sub esp, XXX 
```

而 XXX 是要分配的字节数

**编辑：**
如果您想查看实现（并且您正在使用 MSVC），请参阅 alloca16.asm 和 chkstk.asm。
第一个文件中的代码基本上将所需的分配大小与 16 字节边界对齐。第二个文件中的代码实际上遍历了所有属于新堆栈区域的页面并触及它们。这可能会触发 PAGE_GAURD 异常，操作系统使用这些异常来增长堆栈。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-04T13:27:22.060

您可以检查开源 C 编译器的源代码，例如[Open Watcom](http://www.openwatcom.org/index.php/Main_Page)，然后自己找到它

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-07-04T08:18:20.397

如果您不能使用 c99 的可变长度数组，则可以使用复合文字转换为 void 指针。

```
#define ALLOCA(sz) ((void*)((char[sz]){0})) 
```

这也适用于 -ansi （作为 gcc 扩展），即使它是函数参数；

```
some_func(&useful_return, ALLOCA(sizeof(struct useless_return))); 
```

不利的一面是，当编译为 c++ 时，g++>4.6 会给你一个[错误：获取临时数组的地址](https://gcc.gnu.org/bugzilla/show_bug.cgi?id=53220)... clang 和 icc 不会抱怨

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-03-19T14:44:28.880

我们想做的是这样的：

```
void* alloca(size_t size) {
    <sp> -= size;
    return <sp>;
} 
```

在组装（Visual Studio 2017，64 位）中，它看起来像：

```
;alloca.asm

_TEXT SEGMENT
    PUBLIC alloca
    alloca PROC
        sub rsp, rcx ;<sp> -= size
        mov rax, rsp ;return <sp>;
        ret
    alloca ENDP
_TEXT ENDS

END 
```

不幸的是，我们的返回指针是堆栈上的最后一项，我们不想覆盖它。此外，我们需要注意对齐，即。*将大小*舍入到 8 的倍数。所以我们必须这样做：

```
;alloca.asm

_TEXT SEGMENT
    PUBLIC alloca
    alloca PROC
        ;round up to multiple of 8
        mov rax, rcx
        mov rbx, 8
        xor rdx, rdx
        div rbx
        sub rbx, rdx
        mov rax, rbx
        mov rbx, 8
        xor rdx, rdx
        div rbx
        add rcx, rdx

        ;increase stack pointer
        pop rbx
        sub rsp, rcx
        mov rax, rsp
        push rbx
        ret
    alloca ENDP
_TEXT ENDS

END 
```

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-04-03T16:30:31.803

Alloca 很简单，只需将堆栈指针向上移动即可；然后生成所有读/写指向这个新块

```
sub esp, 4 
```

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2009-04-03T16:34:04.290

我推荐“进入”指令。在 286 和更新的处理器上可用（*可能*在 186 上也可用，我不记得了，但无论如何这些都没有广泛使用）。

# mysql - MySQL 上的 SQL 注入安全性的最佳解决方案是什么？

> ID：714704
> 
> 赞同：0
> 
> 时间：2009-04-03T16:31:34.513
> 
> 标签：mysql, security, sql-injection

运行我的字符串以确保不可能进行 MySQL 注入的最佳功能是什么？

另外，它是否需要在输出时通过另一个函数运行它才能正确显示？

### 也可以看看

> [参数真的足以防止 Sql 注入吗？](https://stackoverflow.com/questions/306668/are-parameters-really-enough-to-prevent-sql-injections)[带有子句](https://stackoverflow.com/questions/650455/c-parameterized-query-mysql-with-in-clause)
> [的 C# 参数化查询 MySQL`in`](https://stackoverflow.com/questions/650455/c-parameterized-query-mysql-with-in-clause)
> [我可以通过转义单引号和用单引号包围用户输入来防止 SQL 注入吗？](https://stackoverflow.com/questions/139199/can-i-protect-against-sql-injection-by-escaping-single-quote-and-surrounding-user)

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-03T16:33:33.650

[参数化查询](http://en.wikipedia.org/wiki/SQL_injection#Using_Parameterized_Statements)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T16:33:35.273

一个参数函数。

撇开幽默不谈，我的意思是如果可以避免*的*话，不要将用户输入的内容作为 SQL 动态执行。将所有内容作为参数传递，并从您的查询中引用它们。请参阅[Chad Birch 的答案](https://stackoverflow.com/questions/714704/best-solution-for-mysql-injection-security/714712#714712)以获得解释此问题的良好链接。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T16:37:56.823

正如 Chad 所说，始终使用参数化查询来避免 SQL 注入。

要回答您问题的后半部分，如果您的输出是网页，则始终转义任何特殊的 HTML 字符（`&`, `<`, `>`）以防止脚本注入。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-03T18:41:37.960

向参数化查询添加应用程序中输入验证的使用。永远不要相信输入是干净的。核实。例如，如果它应该是一个整数，请检查以确保它可以毫无问题地转换为数值。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2013-01-30T13:53:23.570

在 PHP 中，最好的方法是对字符串使用 HTML 转义。
它将特殊字符转换为 HTML 兼容字符。

示例：“”（空格）转换为“%20”。

# iphone - 如何在 iPhone 上存储 plist？

> ID：714705
> 
> 赞同：0
> 
> 时间：2009-04-03T16:31:56.400
> 
> 标签：iphone

我想存储一些用户设置，如选定的图像等。我怎么能用 plist 做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-03T16:34:21.560

对于基本设置，您可以使用 NSUserDefaults。如果您需要更复杂的东西（序列化对象），那么您应该写出并读入数据文件。

# c++ - OpenGL 上下文不打开窗口 - 使用 GetDesktopWindow 制作的 HWND 时，wglMakeCurrent 因 HDC 和 HGLRC 失败

> ID：714707
> 
> 赞同：3
> 
> 时间：2009-04-03T16:32:08.897
> 
> 标签：c++, windows, opengl

这有点重复[这个问题](https://stackoverflow.com/questions/576896/can-you-create-opengl-context-without-opening-a-window)。

我正在尝试制作一个无窗口控制台应用程序来检查支持的 OpenGL 版本。为了做到这一点，我需要设置一个渲染上下文——但不创建一个窗口。我正在尝试使用桌面句柄，我不会写信给它。

我忘记在前面的示例中设置像素格式 - 这可能是创建渲染上下文失败的原因 - 但是即使设置了像素格式，我也无法激活它。wglMakeCurrent(hDC, hRC) 只返回 0。

这是完整的源代码转储：

```
 #include <iostream>
    #include <GL/GLee.h>

    #include <windows.h>

HDC hDC = NULL;
HGLRC hRC = NULL;
HWND hWnd = NULL;
HINSTANCE hInstance;

int res = 0;
int pf = 0;
PIXELFORMATDESCRIPTOR pfd = {
    sizeof(PIXELFORMATDESCRIPTOR),
    1,                     /* version */
    PFD_DRAW_TO_WINDOW |
    PFD_SUPPORT_OPENGL |
    PFD_DOUBLEBUFFER,
    PFD_TYPE_RGBA,
    24,                    /* 24-bit color depth */
    0, 0, 0, 0, 0, 0,      /* color bits */
    0,                     /* alpha buffer */
    0,                     /* shift bit */
    0,                     /* accumulation buffer */
    0, 0, 0, 0,            /* accum bits */
    32,                    /* z-buffer */
    0,                     /* stencil buffer */
    0,                     /* auxiliary buffer */
    PFD_MAIN_PLANE,        /* main layer */
    0,                     /* reserved */
    0, 0, 0                /* layer masks */
};

std::string trash;

int main(int argc, char**argv) {

hInstance = GetModuleHandle(NULL);  // Grab An Instance For Our Window

hWnd = GetDesktopWindow();          // Instead of CreateWindowEx

if (!(hDC = GetDC(hWnd))) {
    std::cout << "Device context failed" << std::endl;

    std::cout << std::endl << "Press ENTER to exit" << std::endl;
    std::getline(std::cin, trash);
    return 1;
}

// pixel format
pf = ChoosePixelFormat(hDC, &pfd);
res = SetPixelFormat(hDC, pf, &pfd);

if (!(hRC = wglCreateContext(hDC))) {
    std::cout << "Render context failed" << std::endl;

    std::cout << std::endl << "Press ENTER to exit" << std::endl;
    std::getline(std::cin, trash);
    return 1;
}

if(!wglMakeCurrent(hDC,hRC)) { // fail: wglMakeCurrent returns 0
    std::cout << "Activating render context failed" << std::endl;

    std::cout << std::endl << "Press ENTER to exit" << std::endl;
    std::getline(std::cin, trash);
    return 1;
}

std::cout << "OpenGL 1.2 support ... ";
if (GLEE_VERSION_1_2) {
    std::cout << "OK" << std::endl;
} else {
    std::cout << "FAIL" << std::endl;
}

std::cout << "OpenGL 1.3 support ... ";
if (GLEE_VERSION_1_3) {
    std::cout << "OK" << std::endl;
} else {
    std::cout << "FAIL" << std::endl;
}

std::cout << "OpenGL 1.4 support ... ";
if (GLEE_VERSION_1_4) {
    std::cout << "OK" << std::endl;
} else {
    std::cout << "FAIL" << std::endl;
}

std::cout << "OpenGL 1.5 support ... ";
if (GLEE_VERSION_1_5) {
    std::cout << "OK" << std::endl;
} else {
    std::cout << "FAIL" << std::endl;
}

std::cout << "OpenGL 2.0 support ... ";
if (GLEE_VERSION_2_0) {
    std::cout << "OK" << std::endl;
} else {
    std::cout << "FAIL" << std::endl;
}

std::cout << "OpenGL 2.1 support ... ";
if (GLEE_VERSION_2_1) {
    std::cout << "OK" << std::endl;
} else {
    std::cout << "FAIL" << std::endl;
}

std::cout << "OpenGL 3.0 support ... ";
if (GLEE_VERSION_3_0) {
    std::cout << "OK" << std::endl;
} else {
    std::cout << "FAIL" << std::endl;
}

std::cout << std::endl << "Press ENTER to exit" << std::endl;
std::getline(std::cin, trash);

// cleanup
wglMakeCurrent(NULL, NULL);     /* make our context not current */
wglDeleteContext(hRC);      /* delete the rendering context */
ReleaseDC(hWnd, hDC);               /* release handle to DC */

return 0; 
```

}

* * *

**编辑：**我知道 wglMakeCurrent() 如果传递给它的任何一个句柄是无效的，或者如果要成为当前的渲染上下文当前对于另一个线程来说是当前的，但我不确定在这种情况下哪些是正确的.

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2011-11-10T17:31:35.627

不得在桌面窗口上创建 OpenGL 上下文。要创建 OpenGL 上下文，必须设置窗口的像素格式，这是严禁在桌面窗口上进行的。

如果要进行离屏渲染，请使用 PBuffer 代替窗口，或者创建一个不可见的窗口并使用帧缓冲区对象 (FBO) 作为渲染目标。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-03T17:11:04.527

如果您使用 CreateWindow() 而不是 GetDesktopWindow() 是否有效？

我会说 GetDesktopWindow() 极不可能工作。我希望这与普通窗口不同，并且您收到的值是特殊的句柄值。

如果迫在眉睫，只需打开一个没有 WS_VISIBLE 的窗口。没有人会更聪明。

Ps 我注意到你正在把它变成一个控制台应用程序。如果控制台应用程序可以使用任何图形，无论是 OpenGL 还是仅 Windows 2D 绘图 API，我都会感到非常惊讶。

Pss 我很确定 Windows 应用程序可以（以一种或另一种方式）写入它们运行的​​命令行的标准输出。您可以简单地编写一个普通的 Windows 应用程序，但只需将输出发送到标准输出。

# javascript - 设置一个功能在 30 秒内运行并且可以取消它？

> ID：714708
> 
> 赞同：1
> 
> 时间：2009-04-03T16:32:12.563
> 
> 标签：javascript

我有一个非常好的应用程序，但它不会为某些用户加载。我有一个 lite 版本，它总是加载但几乎没有那么好，所以我想设置一个 javascript 等待 30 秒，然后从主应用程序切换到 lite 应用程序。但是，如果主应用程序在 30 秒内加载取消，则切换到它会停留在主应用程序上。

基本上我想等待 30 秒然后运行一个函数，但我希望能够取消。

谢谢！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-03T16:35:28.840

```
var timeoutId = -1;

function functionToRun()
{
    alert('hi there!');
}

function delayRun()
{
    timeoutId = setTimeout(functionToRun, 30 * 1000);
}

function cancelRun()
{
    if (timeoutId == -1)
        return;

    clearTimeout(timeoutId);

    timeoutId = -1;
} 
```

将“做某事”的代码放入`functionToRun`，然后调用`delayRun()`. 打电话`cancelRun()`给...嗯...取消。

# php - 克服 PHP、SoapServer、UTF-8 和非英文字符的编码问题？

> ID：714713
> 
> 赞同：2
> 
> 时间：2009-04-03T16:33:34.697
> 
> 标签：php, xml, soap, encoding, utf-8

我在让 PHP 与 SoapServer + UTF-8 很好地配合时遇到问题。任何时候任何人发送带有非英文字符（即有趣的引号、重音字符等）的 Soap 请求时，SoapServer 都会抛出一个异常，说“错误请求”。我尝试使用 utf8_decode 对请求进行解码，甚至使用 HTML 特殊字符对文本进行编码。没有什么对我有用。

我正在寻找一个正确方向的点，因为我现在迷路了。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-03T16:43:34.580

确保[SoapServer](http://www.php.net/manual/en/soapserver.soapserver.php)和[SoapClient](http://www.php.net/manual/en/soapclient.soapclient.php)都使用 UTF-8 编码进行了初始化：

```
$client = new SoapClient("some.wsdl", array('encoding'=>'UTF-8'));
$server = new SoapServer("some.wsdl", array('encoding'=>'UTF-8')); 
```

使用“有趣的引号、重音字符等”来处理请求的 XML 证实？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T17:16:25.013

一个明显的下一步是验证您收到的请求是否*实际*编码为 UTF-8。像 WireShark 这样的网络嗅探器（或者甚至可以使用普通的旧 telnet 客户端进行一些工作）可以让您检查传递给服务器的确切数据。仔细检查并验证它实际上是有效的 UTF-8。

# windows-mobile - 保持移动数据同步

> ID：714720
> 
> 赞同：2
> 
> 时间：2009-04-03T16:35:24.083
> 
> 标签：windows-mobile, windows-ce, sql-server-ce

我想要一种简单的方法来保持 SQL CE 数据库（在 Windows Mobile 或 CE 上）与 SQL Server Express 同步。我的理解是 SQL Express 没有通常使用的复制功能。有没有其他方法可以做到这一点？

我正在使用 .Net 2.0 在 C# 中工作。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T16:44:07.870

[微软同步框架](http://msdn.microsoft.com/en-us/sync/default.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T17:11:15.107

SQL CE 确实支持复制（您可以订阅复制发布者（我还没有得到它甚至工作OTOH））。

如前所述，MS Sync Framework，但这在复杂的东西上确实做得不好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T17:07:51.417

多年前，我为移动维修人员编写了一个应用程序，用于在客户站点开具发票，该应用程序在 PocketPC 上运行。当您对接 PocketPC 时，ActiveSync 会自动从台式机 (SQL Express) 上的主数据库同步数据。ActiveSync 为我的每个表添加了字段以支持同步数据库，并自行处理同步 - 因此它不需要依赖复制。

总而言之，ActiveSync 的数据库同步功能实际上非常流畅，并且易于使用。简短的回答是：如果通过 ActiveSync 同步，则不需要复制。

希望有帮助，埃里克

# javascript - 在 HTML 末尾或“onload”时初始化 JS 组件？

> ID：714729
> 
> 赞同：3
> 
> 时间：2009-04-03T16:36:59.120
> 
> 标签：javascript, ajax, initialization

有一段时间，我一直在通过等待“onload”事件触发并执行`main()`各种操作来运行 JavaScript 组件初始化。它看起来更干净，你可以确定你的 DOM 的 ID 状态是有序的。但是经过一段时间的尝试后，我发现组件的初始化被加载期间挂起的任何类型的资源（图像、css、iframe、flash 等）阻塞。

现在，我使用内联执行将初始化调用移动到 HTML 文档本身的末尾，`<script />`并发现它将初始化推送到其他外部资源之前。

现在我想知道这样做是否会带来一些陷阱，而不是等待“onload”。

您使用哪种方法？

**编辑**：谢谢。似乎每个库都有针对`DOMContentLoaded`/`readyState`实现差异的专门功能。我使用原型，所以[这](http://www.prototypejs.org/api/document/observe)就是我需要的。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-03T16:41:40.637

对我来说，我们使用 jquery，它的文档就绪状态确保 DOM 已加载，但不会像你说的那样等待资源。您当然可以在没有 javascript 框架的情况下执行此操作，它确实需要一个您可以创建的函数，例如：[文档准备好](http://snipplr.com/view/6156/documentready/) 现在，在大多数情况下，将脚本放在页面末尾确保页面的其余部分在那里，但是制作确保 DOM 准备就绪从来都不是一件坏事。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-03T16:40:23.900

Jquery 有 $(document).ready()

运行大多数脚本的理想时间是文档准备好时，而不一定是“加载”时。

[看这里](http://encosia.com/2009/03/25/document-ready-and-pageload-are-not-the-same/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T16:41:31.183

我都不用。相反，我依赖于[YUI 的 onDomReady()](http://developer.yahoo.com/yui/event/#ondomready)（或 onContentReady()/onAvailable()），因为它为我处理初始化时间。

（其他 JS 库也有类似的方法，只在页面完全加载后才执行，因为这是一个常见的 JS 问题。）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-03T16:42:02.150

这不符合任何 (X)HTML 规范，建议不要这样做。它会将您的网站置于浏览器的怪癖模式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-03T22:11:21.937

解决此问题的正确方法是使用`DOMContentLoaded`事件，并非所有浏览器都支持该事件。存在黑客（例如轮询`doScroll()`或使用`onreadystatechange`），因此库能够跨浏览器提供此功能。

但是仍然存在`DOMContentLoaded`流行的 JavaScript 框架尚未解决的分块传输问题。

这是[我对这个问题](http://mercurial.intuxication.org/hg/js-hacks-docs/raw-file/tip/domcontentloaded-en.html)的看法。

# php - PHP @exec 静默失败

> ID：714740
> 
> 赞同：5
> 
> 时间：2009-04-03T16:40:50.700
> 
> 标签：php, iis, exec

这真让我抓狂。我正在尝试在我的 PHP Web 应用程序的 Windows 框中执行命令行语句。它在 Windows XP、IIS5.1 上运行。Web 应用程序运行良好，但我无法让 @exec() 使用特定的联系人变量。我的命令结构如下所示：

```
$cmd = ($config->svn." cat ".$this->repConfig->svnParams().quote($path).' -r '.$rev.' > '.quote($filename)); 
```

当它生成以下字符串时，此命令不能像上面那样工作：

```
svn --non-interactive --config-dir /tmp cat "file:///c:/temp/test/acccount/dbo_sproctest.sql" -r 1 > "C:\Inetpub\sites\websvn\temp\wsv5B45.tmp" 
```

如果我将它复制/粘贴到我自己的命令行，它工作正常。

如果我对相同的路径进行硬编码而不是将其与变量一起添加，它就可以工作！我试过在文件名周围加引号和不加引号。我试过在整个命令周围加引号和不加引号。我试过其他目录。我尝试将输出参数传递给 exec()，但它返回为空（Array ()）。我尝试将命令的错误流的输出重定向到一个文件，并且永远不会创建该错误输出文件。

我唯一能想到的是 exec() 默默地失败了。我到底在这里做错了什么？如果我使用相同的目录结构和文件名对文件路径进行硬编码，它就可以正常工作。如果我不这样做，它不会。

也许文件路径中的斜杠 () 没有被正确转义，但是当我用单引号手动执行时，它们不被视为转义序列？

*更新：*

我从 exec 中删除了@，但仍然没有看到任何错误。

我给出了 SVN 的完整路径，仍然没有运气。应该注意的是，只要我手动指定 cat 的文件目标，该命令在使用非完整路径 SVN 之前运行良好。

*更新 2：回复：基思*

我通过尝试两种方法来调用 exec：

```
exec($cmd); 
```

或者

```
exec($cmd, $out); 
```

我的 php.ini 已经有了 safe_mode = 0。

我添加了 error_reporting(E_ALL); 并没有看到任何新东西

如果我回显（或 print_r）我的 exec 调用，我实际上并没有看到*任何东西*

如果我在包含输出变量时回显（或 print_r）我的 exec 调用，我会得到一个空的 arr

*更新 3*

我尝试了 escapeshellcmd 和 escapeshellarg 都无济于事（不过是个好主意）。

我应该补充一点，文件是通过调用创建的

```
tempnam("temp", "wbsn"); 
```

如果我手动指定字符串而不是让它由 tempname 生成，它工作得很好这一事实似乎表明问题的根源，但我不知道如何。我将手动字符串与生成的字符串进行了比较，它作为匹配返回。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-04-03T16:43:34.877

`@exec`总是会默默地失败，因为 @ 是 PHP 的错误抑制运算符。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-02-16T17:28:33.130

不确定这是否会对您有所帮助，因为您使用的是 Windows，而我使用的是 Linux，但我遇到了来自 PHP exec() 的同样的静默错误问题。我发现我试图发出的命令 (nconvert) 将其错误消息发送到标准错误流，而不是标准输出。所以我加了

> `2>&1`

在命令行的末尾将我的错误重定向回标准流。然后我可以看到 nconvert 给了我一个权限被拒绝的错误。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-03T16:42:46.187

可能是 PATH 与您的 php 脚本与您的用户帐户不同。尝试删除 @ 并查看它是否试图引发错误。

此外，您可能想尝试将完整的文件系统路径放入 SVN 可执行文件。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-08-01T16:52:52.127

在调试 shell exec 问题时，一个非常有用的技巧是在命令的开头放置一个“echo”。确保您可以在某处查看标准输出。

这将让您检查命令是否存在任何明显的问题。也许它有一个意外扩展的通配符，或者外壳引用不完全正确。echo 会让您看到这一点，您可以将 echoed 命令剪切并粘贴到另一个 shell 中，以查看它是否正常工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-03T17:57:18.193

好吧，如果删除`@`不起作用，请尝试在您正在运行的代码的开头包含此内容：

```
error_reporting(E_ALL); 
```

这将打开完整的错误报告，以防万一您在`php.ini`文件中将其关闭或禁用。

我不认为你能告诉我们你到底是怎么打电话的`exec()`？您是否还可以检查以确保您没有意外在安全模式下运行脚本？您是否正在回显`exec()`正在返回的内容，如果是，返回的内容是什么？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-03T19:37:32.243

您是否尝试过 echo exec("dir") 或其他简单的方法来查看 exec() 是否正常工作？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-03T19:52:36.013

我不知道发生了什么，但我至少有一个解决方法。

这有效：

```
$tmp = tempnam("./", "wbsn");
$filename = dirname($tmp).'\\temp\\'.basename($tmp); 
```

然而，这并没有，但我希望它生成相同的路径（差异文件名，因为它是一个新的 tempnam()）。

```
$tmp = tempnam("temp", "wbsn"); 
```

此外，这不起作用，我也希望生成同样的东西：

```
$tmp = tempnam("temp", "wbsn");
$filename = dirname($tmp).'\\'.basename($tmp); 
```

所有这 3 个解决方案*似乎*都生成了相同的文件路径，但只有第一个在我的 exec 中使用时真正起作用。我*不*知道为什么它没有。

所有这三个的目视检查（回声）似乎生成了相同的路径（当然，文件名不同）。这 3 个中每一个的 dirname() 的字符串比较显示为匹配。我不知道这笔交易是什么，但第一个是一种解决方法。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-03T18:41:48.290

我不太喜欢添加另一个回复，但如果我只是编辑我之前的回复，您可能看不到它。

PHP 有一些特殊的 shell 脚本转义命令：[escapeshellcmd](http://www.php.net/escapeshellcmd)和[escapeshellarg](http://www.php.net/escapeshellarg)。

我*认为*您应该能够`escapeshellcmd`在整个 $cmd 周围使用，但我不确定。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2013-03-26T16:32:09.087

我的建议是从 WIN、IIS 切换到 linux，但作为替代方案，你可以试试这个：

```
function exec_alt($cmd) {
    exec($cmd, $output);
    if (!$output) {
        /**
         * FIXME: for some reason exec() returns empty output array @mine,'s machine.
         *        Somehow proc_open() approach (below) works, but doesn't work at
         *        test machines - same empty output with both pipes and temporary
         *        files (not we bypass shell wrapper). So use it as a fallback.
         */
        $output = array();
        $handle = proc_open($cmd, array(1 => array('pipe', 'w')), $pipes, null, null, array('bypass_shell' => true));
        if (is_resource($handle)) {
            $output = explode("\n", stream_get_contents($pipes[1]));
            fclose($pipes[1]);
            proc_close($handle);
        }
    }
    return $output; } 
```

# c# - 使用 file.copy() 移动 zip 文件

> ID：714756
> 
> 赞同：2
> 
> 时间：2009-04-03T16:45:47.647
> 
> 标签：c#

我正在尝试将文件从服务器移动`\\abc\\C$\\temp\\coll.zip`到另一台服务器 `\\def\\c$\\temp`。

我正在尝试使用`File.Copy(source,destination)`. 但我在源路径中收到错误消息：`Couldn't find the part of the path.`

我不确定源路径有什么问题。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-03T16:48:55.160

如果您使用 C#，请确保您的“\”字符被转义。您必须将反斜杠加倍或在字符串文字前加上 @，如下所示：

`string fileName = @"\\abc\C$\temp\coll.zip";`

或者

`string fileName = "\\\\abc\\C$\\temp\\coll.zip";`

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-03T16:56:36.577

您可以使用 C# @ Verbatim 并在代码中使用检查，如下所示：

```
string source = @"\\abc\C$\temp\coll.zip";
string destination = @"\\def\c$\temp\coll.zip";
string destDirectory = Path.GetDirectoryName(destination)
if (File.Exists(source) && Directory.Exists(destDirectory)) {
    File.Copy(source, destination);
}
else {
    // Throw error or alert
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-03T16:48:07.517

看起来你在开始时需要两个反斜杠：

*   \\abc\C$\temp\coll.zip
*   \\def\c$\temp

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-03T16:53:04.900

确保您使用的是有效的 UNC 路径。UNC 路径应以 \ 开头，而不仅仅是 . 您还应该考虑使用**System.IO.File.Exists(filename);** 在尝试复制之前，您可以完全避免异常，因此您的应用程序可以优雅地处理丢失的文件。

希望这可以帮助

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-03T16:49:05.767

它可能是您用于路径的字符串。如果它与您在这里输入的完全一样，我相信您需要双反斜杠。服务器名称前的“\\”。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-03T16:49:37.950

我总是将网络共享用于此类工作，但 UNC 路径也应该可用。

不要忘记在使用 \'s 时需要对字符串进行转义。此外，UNC 路径大部分时间都以 double 开头。

例子：

```
\\MyComputerName\C$\temp\temp.zip 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-03T16:52:24.650

实际上我在两个字符串之前错过了@。源路径和目标路径。这就是它给出错误的原因。

# language-agnostic - 是否有软件工程师可以跟踪他们的需求 -> 设计文档 -> 源代码的工具？

> ID：714757
> 
> 赞同：0
> 
> 时间：2009-04-03T16:46:24.773
> 
> 标签：language-agnostic, project-management, tdd, agile

所以我最近完成了我的第三年软件工程项目。该项目是一个游戏。

至少这并不容易。我做过的最具挑战性的项目。

经过一番思考，我注意到我们小组遇到的主要问题是：

*   我们的 SRS 很少与我们的设计图匹配
*   我们的架构没有很好的定义
*   最后，我们的代码与我们的设计毫无关系

在这个项目中，我们被迫为我们的 RADIT 使用瀑布过程（请求、分析、设计、实现和测试）。我讨厌这种方法，并想在我的第四年项目中**使用敏捷做 TDD 。**但是我担心我将无法**跟踪reqs -> design -> architecture -> test -> source。****因此，我正在考虑制作一个在git**之上执行此操作的工具。但是，如果已经有一个用于此目的，那就太好了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T19:15:44.543

你可以试试[混合](http://studios.thoughtworks.com/mingle-agile-project-management "交融")。它是为管理敏捷项目团队而构建的。需求被跟踪为虚拟卡片墙上的故事。它具有开箱即用的 SVN 集成，但我认为还有一个用于 git 的社区插件。它内置了一个 wiki，因此您可以轻松地跟踪需求和生成的架构，因为您只需将需求链接到设计 wiki 页面。

此外，如果您计划将 Mingle 用于学术目的，即在课堂/实验室中或作为课程的一部分，学术用户有资格获得免费许可。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T17:08:28.310

在过去的 15 年里，我一直致力于为软件工程的可追溯性提供工具支持，而广泛使用的最好的是 DOORS+SysML。它们都需要进行手动连接（尽管您可以将 ID 添加到代码和单元测试中，并获取一些覆盖率指标）。

制作一个将特定测试与需求 ID 相关联的简单工具非常容易，然后将该需求报告为已测试。同样，您可以添加标记来说明您的代码的哪些部分映射到您的设计元素（尽管这主要是由逆向工程工具自动完成的）。然后，您可以判断您是否有针对所有要求和所有设计元素的标记。这些是对 COTS UML 工具的扩展，因此可能与 git 的设计精神不同。

目前我所知道的任何工具都没有为您提供任何方法来实际确定测试是否执行了应该实现超链接要求的设计部分（这是可行的，因为您可以在代码中记录覆盖率运行测试时链接到设计元素）。

还有其他工具，例如 CaDiZ 和 Cog，它们是定理证明工具，它们可以对您的需求和代码的注释模型进行正式描述，并验证模型是否符合规范。这适用于足够简单的代码，但对于博士后级别的计算机科学家来说相当耗时（几十行代码需要几周的时间）。

我所知道的工具都没有与 git 集成。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T19:06:33.503

我记得很多个月前回顾过[Rational RequisitePro](http://www-01.ibm.com/software/awdtools/reqpro/)，尽管我们最终没有使用它。IIRC，它与我们当时使用的 Rational 的 Clear Case 源代码控制系统集成。这有点漂亮，但对我们的需求来说太过分了。

# delphi - Delphi中如何使用单元文件

> ID：714760
> 
> 赞同：2
> 
> 时间：2009-04-03T16:48:01.650
> 
> 标签：delphi, private, pascal, public, delphi-units

我只是想掌握单独的单元以使我的代码更加封装。我正在尝试整理我的方法的公共/私有声明，以便我可以从其他使用`testunit`. 在这个例子中，我想`hellofromotherunit`公开，但不`stickletters`公开。

```
unit testunit;    

interface

uses
  Windows, Messages, Dialogs;    

implementation

function stickletters(a,b:string):string;
begin
  result:=a+b;
end;

procedure hellofromotherunit();
begin
 showmessage(stickletters('h','i'));
end;

end. 
```

我似乎无法从其他单位复制私有/公共结构，如下所示：

```
Type
private
function stickletters(a,b:inter):integer;
public
procedure hellofromotherunit();
end 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-03T16:58:16.570

Unit 结构看起来有点像对象中的公共/私有部分，你可以说它是它们的先驱。但是语法不同。

您只需在接口部分声明方法头，如下所示：

```
interface
  procedure hellofromotherunit();

implementation
  procedure hellofromotherunit(); begin .. end; 
```

每个部分只允许一个。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-03T16:58:08.240

Private & Public 仅适用于课程。

您要做的是将 hellofromotherunit 声明的副本放入接口部分。但是，不要将 Stickletter 声明的副本放在那里。

界面部分中出现的任何内容实际上都是公开的。仅在实现中出现的任何内容都是私有的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-06T06:51:15.383

此外，

每个单元有两个不同的部分。接口和实现。

接口部分包含所有公共定义（类型、过程标题、常量）。实施部分包含所有实施细节。

当您使用一个单元时，（使用 uses 子句）您可以访问该单元的公共定义。这种访问不是递归的，因此如果单元 A 接口使用单元 B，而单元 C 使用单元 A，除非您明确使用它，否则您无法访问单元 B。

实现部分可以访问接口，可以访问两个使用子句（接口和实现）中使用的单元。

在继续编译其余单元之前，首先编译已使用单元的接口。这样做的好处是您可以从实现中获得循环依赖：

```
unit A;
interface
uses B;

unit B;
interface
implementation
uses A; 
```

编译：

*   尝试接口A，失败需要B
*   试试B接口，ok！
*   试试接口A，ok！
*   尝试实现A，好的！
*   尝试实施B，好的！

每个单元也有一个初始化部分（如果它有一个初始化部分，它也可以有一个终结部分。）初始化部分用于初始化单元的变量。终结部分用于清理。当您使用这些时，明智的做法是不要指望其他单元的初始化。只要让它们简单而简短。

单位也是命名空间。考虑以下问题：

```
unit A;
interface
const foo = 1;

unit B;
interface
const foo = 2;

unit C;
interface
uses A, B;

const
  f1 = foo;
  f2 = A.foo;
  f3 = B.foo; 
```

如果在多个使用的单位中定义了一个标识符，则采用使用列表中可能的最后一个单位。所以 f1 = 2。但是你可以在它前面加上单元（命名空间）名称来解决这个问题。

随着 .net 的引入，允许使用多部分命名空间，这引入了其他一些不错的问题：

```
unit foo;
interface
type
  rec1 = record
    baz : Boolean;
  end;
var
  bar : rec1;

unit foo.bar;
interface
var
  baz : Integer;

uses
  foo, foo.bar;    
begin
  foo.bar.baz := true;
  foo.bar.baz := 1;
end.  

// 1\. Which these lines gives an error and why?
// 2\. Does the result change if you write uses foo.bar, foo? 
```

在这种情况下，您有冲突。但这可以通过赋予命名空间名称更高的优先级来解决。所以第一行失败了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-09-21T09:46:25.640

只需不要在接口部分声明方法，它将保持私有。

```
unit Unit2;

interface
  function MyPublicFunction():Boolean;

implementation

function MyPrivateFunction():Boolean;
begin
  // blah blah
end;

function MyPublicFunction():Boolean;
begin
  // blah blah
end;
end. 
```

# java - 如何在 shell 变量中捕获系统调用的结果？

> ID：714769
> 
> 赞同：5
> 
> 时间：2009-04-03T16:50:29.413
> 
> 标签：java, linux, shell, scripting

我们想要构建一个每晚运行的脚本（杀死并重新启动一个 java 进程）。为此，我们需要捕获进程号（因为可能有多个 java 进程在运行）。下面的命令基本上是我们将用来获取进程号的命令，可能在 grep 末尾带有一个正则表达式。除非有更好的建议出现。

```
root#ps -e |grep  'java'
18179 pts/0    00:00:43 java 
```

我们想知道如何解析上面的输出并将其放入 shell 变量中，以便我们可以使用下面的 kill 命令。

```
kill -9 ${processid}
wait 10 
```

注意1：我们不能依赖正常的服务停止命令的原因是因为进程有时不想死。我们必须手动使用 kill 命令。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-03T16:59:58.377

有几个选项可以解决这个问题。如果你使用 bash，那么 shell 变量 '$!' 将包含最后一个分叉的子进程的 PID。因此，在启动 Java 程序后，请执行以下操作：

```
echo $! > /var/run/my-process.pid 
```

然后，在您的 init 脚本停止 Java 进程后：

```
# Get the pidfile.
pid=$(cat /var/run/my-process.pid)

# Wait ten seconds to stop our process.
for count in $(1 2 3 4 5 6 7 8 9 10); do
    sleep 1
    cat "/proc/$pid/cmdline" 2>/dev/null | grep -q java
    test $? -ne 0 && pid="" && break
done

# If we haven't stopped, kill the process.
if [ ! -z "$pid" ]; then
    echo "Not stopping; terminating with extreme prejudice."
    kill -9 $pid
fi 
```

完成后确保删除 pidfile。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-03T17:02:04.720

```
ps aux | grep java | awk '{print $1}' | xargs kill -9 
```

这是一个解释：

`ps aux`为您提供所有进程的列表

`grep java`为您提供名称和命令行参数包含字符串“java”的所有进程

`awk '{print $1}'`通过空格将 grep 命令的输出解析为列并仅重新打印第一列

`xargs kill -9`将 awk 命令的每个结果作为参数传递给 kill -9 命令

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-05-20T20:29:44.557

我意识到这已经过时了，但是呢：

```
pidof java | xargs kill 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-03T17:03:15.047

您可以使用反引号和 cut（或 awk，如果愿意）轻松地将 PID 或 PID 列表放入变量中，以仅检索 PID 字段：

```
[user@host ~]$ ps -e | grep java | cut -d' ' -f1
12812
12870
13008
13042
13060 
```

请注意，在上面的示例中，我有多个 Java 进程正在运行，因此有多个值。如果你把它保存到一个像这样的变量中：

```
JAVA_PROCS=`ps -e | grep java | cut -d' ' -f1` 
```

如果需要，您可以遍历进程以终止它们：

```
for proc in $JAVA_PROCS; do
    kill -9 $proc; 
done 
```

当然，如果您只检索一个进程，则无需迭代，您可以将其运行为：

```
kill -9 $JAVA_PROCS 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-03T17:03:18.430

如果你按照你的建议去做，你最终可能会捕获 grep 本身并杀死它（因为你的 grep 命令包含你正在搜索的 java 字符串）。您可以通过排除 grep 来解决此问题（通过使用另一个 grep！）：

```
pid=`ps -e | fgrep java | fgrep -v grep | awk '{print $1}'`
# check pid has a value
# kill $pid 
```

您可能还喜欢`ps -e -opid,args`.

一个更好的选择是使用`pgrep(1)`或者`pkill(1)`如果你的系统有它们。不再有管道、seds、awks、cuts、xargs：

```
pkill -9 java 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-03T16:53:04.727

杀了它：

```
ps -e | grep java | cut -f1 -d' ' | xargs kill -9 
```

将PID存储在变量上：

```
export JAVAPID=`ps -e | grep 'java' | cut -f1 -d' '` 
```

检查它是否有效：

```
echo $JAVAPID 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-03T17:03:30.740

我使用这样的东西：

```
kill $(ps -A | grep java | cut -b 1-5) 
```

# c++ - 尝试在大型机类 VS 6.0 中创建自己的工具栏

> ID：714775
> 
> 赞同：0
> 
> 时间：2009-04-03T16:52:29.533
> 
> 标签：c++, visual-studio, mfc, toolbar

我在大型机内创建自己的工具栏时遇到问题。我有按钮的位图，我想将其用于我自己的工具栏，但问题是工具栏显示在我的 SDI 应用程序的视图中。这是显示不正确的工具栏的图片。

[http://www.flickr.com/photos/14402427@N02/3409050475/](http://www.flickr.com/photos/14402427@N02/3409050475/)

这是 Mainframe 类的 OnCreate 函数中的代码：我还有一个

```
// CToolBarCtrl m_wndToolBar; declared inside the MainFrame.h class.

      if(m_wndToolBar.Create(WS_CHILD |  TBSTYLE_FLAT | WS_VISIBLE | CBRS_TOP
        | CBRS_GRIPPER | CBRS_TOOLTIPS | CBRS_FLYBY | CBRS_SIZE_DYNAMIC
            ,CRect(0,0,250,50),this,0))
    {
        TRACE0("Failed to create toolbar\n");
        return -1;      // fail to create
    }

        TBBUTTON       tbbutton[3] = {0};
      CSize        button_size(90,90);      
      CSize        bitmap_size(80,80);     

      //m_wndToolBar.AddStrings("String 1\0String 2\0String 3\0");

      tbbutton[0].iBitmap                  = 0;      
      tbbutton[0].idCommand            = ID_CONNECT;
    tbbutton[0].fsState                  = TBSTATE_ENABLED;      
      tbbutton[0].fsStyle                  = TBSTYLE_BUTTON;
      tbbutton[0].dwData                  = 0;     
      tbbutton[0].iString                  = 0;

      tbbutton[1].iBitmap                  = 1;      
      tbbutton[1].idCommand            = ID_DISCONNECT;
    tbbutton[1].fsState                  = TBSTATE_ENABLED;       
      tbbutton[1].fsStyle                  = TBSTYLE_BUTTON;
    tbbutton[1].dwData                  = 0;     
      tbbutton[1].iString                  = 1;

      tbbutton[2].iBitmap                  = 2;      
      tbbutton[2].idCommand              = ID_STOP;
    tbbutton[2].fsState                  = TBSTATE_ENABLED;      
      tbbutton[2].fsStyle                  = TBSTYLE_BUTTON   ;
    tbbutton[2].dwData                  = 0;     
      tbbutton[2].iString                  = 2;

m_wndToolBar.SetButtonSize(button_size);
m_wndToolBar.SetBitmapSize( bitmap_size);

m_wndToolBar.AddButtons(3,tbbutton);
m_wndToolBar.AddBitmap(1,IDB_BITMAP1);
m_wndToolBar.AddBitmap(1,IDB_BITMAP2);
m_wndToolBar.AddBitmap(1,IDB_BITMAP3);

return TRUE; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-09-23T13:19:10.813

`DockControlBar(&m_wndToolBar)`在`return`. _

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T23:11:50.510

从您的图像看来，它没有绘制或绘制不正确，您是否尝试先添加位图然后添加按钮？或者你可以在 m_wndToolbarBar 上调用 AutoSize 吗？

# social-networking - 搜索社交网络

> ID：714780
> 
> 赞同：0
> 
> 时间：2009-04-03T16:54:40.933
> 
> 标签：social-networking, search

如何在社交网络 Web 应用程序中组织搜索？搜索是按全名完成的。我想使用存储过程。它是最好的解决方案吗？可以使用什么算法？

注册时，用户指定他/她的全名，例如：Alice Johnson Martin。我想使用他/她的全名搜索用户。如果有人正在搜索 Johnson Martin Alice，则应该找到名为 Alice Johnson Martin 的用户。我正在使用 postgre sql 和 asp.net mvc。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-03T17:02:26.937

> 可以使用什么算法？

我想到了图算法、机器学习、启发式算法等。取决于你想要达到什么。

# sas - 从字符串中去除撇号（压缩？）

> ID：714781
> 
> 赞同：1
> 
> 时间：2009-04-03T16:54:41.197
> 
> 标签：sas, compression

我有一个看起来像这样的字符串：

```
 "ABAR_VAL", "ACQ_EXPTAX_Y",  "ACQ_EXP_TAX", "ADJ_MATHRES2" 
```

我希望它看起来像这样：

```
ABAR_VAL ACQ_EXPTAX_Y ACQ_EXP_TAX ADJ_MATHRES2 
```

即没有撇号或逗号和单个空格分隔。

在 SAS 9.1.3 中最干净/最短的方法是什么？

最好是这样的：

```
call symput ('MyMacroVariable',compress(????,????,????)) 
```

为了清楚起见，结果需要用单个空格分隔，没有标点符号，并且包含在宏变量中。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-05T14:29:16.897

干得好..

```
data test;
var1='"ABAR_VAL", "ACQ_EXPTAX_Y",  "ACQ_EXP_TAX", "ADJ_MATHRES2"';
run;

data test2;
set test;
call symput('macrovar',COMPBL( COMPRESS( var1,'",',) ) );
run;

%put &macrovar; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-03T20:16:12.977

这是 infile 语句的一部分，还是您确实想要创建包含这些值的宏变量？如果这是 infile 语句的一部分，如果您正确设置了分隔符，则无需执行任何操作。

```
infile foo DLM=',' ; 
```

是的，您确实可以使用 compress 函数从字符串中删除特定字符，无论是在数据步骤中还是作为宏调用的一部分。

```
COMPRESS(source<,characters-to-remove>) 
```

样本数据：

```
data temp;
     input a $;
datalines;
"boo" 
"123" 
"abc"
;
run; 
```

解决数据步骤中的问题（而不是创建宏变量）：

```
data temp2; set temp;
a=compress(a,'"');
run; 
```

在生成宏变量时解决问题：

```
data _null_; set temp; 
call symput('MyMacroVariable',compress(a,'"'));
run;
%put &MyMacroVariable.; 
```

如果您使用后面的代码，您必须遍历观察结果才能查看每个记录的变量的压缩值。:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-05T04:05:17.223

要将多个空白压缩为一个，请使用 compbl ：[http ://www.technion.ac.il/docs/sas/lgref/z0214211.htm](http://www.technion.ac.il/docs/sas/lgref/z0214211.htm)

# c# - LINQ 优化问题

> ID：714782
> 
> 赞同：1
> 
> 时间：2009-04-03T16:54:43.210
> 
> 标签：c#, .net, linq, optimization

所以我一直在使用 LINQ 一段时间，我有一个问题。

我有一个对象集合。它们根据其属性值分为两类。我需要为一组设置不同的属性，为另一组设置一种方式：

```
foreach(MyItem currentItem in myItemCollection)
{
    if (currentItem.myProp == "CATEGORY_ONE")
    {
        currentItem.value = 1;
    }
    else if (currentItem.myProp == "CATEGORY_TWO")
    {
         currentItem.value = 2;
    }
} 
```

或者，我可以执行以下操作：

```
myItemCollection.Where(currentItem=>currentItem.myProp == "CATEGORY_ONE").ForEach(item=>item.value = 1);
myItemCollection.Where(currentItem=>currentItem.myProp == "CATEGORY_TWO").ForEach(item=>item.value = 2); 
```

我认为第一个更快，但认为检查不会有什么坏处。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-03T16:58:36.180

仅对集合进行一次迭代（并且不调用任何委托，并且不使用尽可能多的迭代器）可能会稍微快一些，但我非常怀疑它是否重要。

编写最易读的代码来完成这项工作，并且只在出现问题时担心微观级别的性能（即易于更改的地方）。

我认为在这种情况下，第一段代码更具可读性。更少的 LINQy，但更具可读性。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-03T17:00:01.840

那样做怎么样？

```
myItemCollection.ForEach(item => item.value = item.myProp == "CATEGORY_ONE" ? 1 : 2); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-03T17:00:10.827

## 真实答案

只有分析器才能真正告诉您哪个更快。

## 模糊答案

就原始速度而言，第一个很可能更快。有两个原因

1.  该列表仅迭代一次
2.  第二个为列表中的每个元素请求 2 次委托调用。

但真正的问题是“两种解决方案之间的速度差异重要吗？” 这是与您的应用程序相关的唯一问题。只有分析才能真正为您提供大量数据。

# java - Java中方法的默认范围是什么？

> ID：714791
> 
> 赞同：176
> 
> 时间：2009-04-03T16:57:32.440
> 
> 标签：java, scope

如果我输入：

```
 void doThis(){
     System.out.println("Hello Stackoverflow.");
 } 
```

的默认范围是`doThis()`什么？

上市？受保护？私人的？

* * *

## 回答 #1

> 赞同：275
> 
> 时间：2009-04-03T17:01:39.263

默认范围是包私有。同一个包中的所有类都可以访问方法/字段/类。包私有比受保护和公共范围更严格，但比私有范围更宽松。

更多信息：
[http ://docs.oracle.com/javase/tutorial/java/javaOO/accesscontrol.html](http://docs.oracle.com/javase/tutorial/java/javaOO/accesscontrol.html)
[http://mindprod.com/jgloss/scope.html](http://mindprod.com/jgloss/scope.html)

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-04-03T17:04:41.843

任何定义为包私有的东西都可以被类本身、同一个包内的其他类访问，但不能在包外访问，也不能被子类访问。

请参阅[此页面](http://java.sun.com/docs/books/tutorial/java/javaOO/accesscontrol.html)以获取方便的访问级别修饰符表...

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-04-03T17:18:27.817

如果没有访问修饰符，则可以在声明它的整个包中访问类成员。您可以从[Java 语言规范第 6.6 节中了解更多信息。](http://java.sun.com/docs/books/jls/third_edition/html/names.html#6.6)

接口的成员始终是可公开访问的，无论是否显式声明。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-03T16:58:46.197

默认范围是“默认”。这很奇怪——有关更多信息，请参阅[这些](http://www.d.umn.edu/~gshute/java/c2java.html) [参考资料](http://mindprod.com/jgloss/scope.html)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-07-08T04:39:44.713

**Java 8 现在允许在具有默认**范围（且仅限静态）的接口本身内实现方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-05-09T12:02:57.687

如果您没有为您的方法提供任何修饰符，那么默认情况下它将是 Default 修饰符，它在包内具有范围。
有关更多信息，您可以参考[http://wiki.answers.com/Q/What_is_default_access_specifier_in_Java](http://wiki.answers.com/Q/What_is_default_access_specifier_in_Java)

# java - 有什么方法可以加快 Selenium Server 的加载时间？

> ID：714792
> 
> 赞同：16
> 
> 时间：2009-04-03T16:57:51.987
> 
> 标签：java, selenium

按照设计，每次运行新测试时，Selenium 都会为您的 Firefox 配置文件创建一个新副本。我发现这个复制时间是一个相当大的瓶颈，尤其是在运行 100 次测试时。（重新复制配置文件需要 5-15 秒）。

有谁知道对此有任何覆盖行为？我希望我的 Selenium 服务器只重用相同的 firefox 配置文件。我知道这违反了“干净地设置测试装置”的理念，但这是我愿意采取的捷径，因为我的测试不会实质性地改变我的 Firefox 配置文件，足以危及未来的测试。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-07T13:08:09.133

我同意这是一个问题。每次都拥有一个新的 Firefox 进程副本很好，但是通过重新生成 Firefox 配置文件来使启动时间加倍有点矫枉过正。[如果您在http://jira.openqa.org](http://jira.openqa.org)上打开错误报告并发送电子邮件至 patrick@browsermob.com 给我发电子邮件，我将很高兴确保我们得到适当的解决方案。

PS：我已经一次性解决了这个问题。我们使用相同的 Firefox 配置文件，只删除缓存和 cookie 数据库。但我真的应该将这个更改修补回 Selenium 源。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-03T17:20:59.980

只需将下面的代码移到测试设置之外并进入夹具设置并保持 selenium 实例的全局（代码假定为 NUnit。）

```
[TestFixtureSetUp()]
public void FixtureSetup()
{
    selenium = New DefaultSelenium("localhost", 4444, "*firefox", "http://localhost/");
    selenium.Start();
    selenium.SetTimeout("30000");
    selenium.Open("/");
} 
```

您的测试设置应如下所示：

```
[SetUp()]
public void SetUpTest()
{
    selenium.Open("default.aspx");
    selenium.WaitForPageToLoad("30000");
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-02-14T21:45:12.777

减少配置文件加载时间的一种小方法是从 firefox 配置文件中删除较大的文件。为此，请通过运行命令 firefox.exe -p 设置您自己的配置文件。创建配置文件后，进入选项并关闭 Web 测试不需要的缓存和其他绒毛。然后将您的配置文件复制到新位置并删除不需要的 sql 文件。（否则，当您再次打开它时，您会恢复使配置文件非常小的已删除文件）。当您开始 selenium 测试时，请在新位置引用您的配置文件。在此之前，我在每次测试启动时复制超过 50MB 的配置文件，现在它复制超过 3-4MB 的配置文件，启动时间几乎是即时的。

同样，这不是再次使用相同配置文件的方法，但它会减少您复制每个配置文件的时间。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-07-10T15:52:04.840

使用 MSTest，我能够`Firefox`通过初始化`WebDriver`in `ClassInitialize`(and `Cleanup`) 而不是`TestInitialize`：

```
static string path;
        static IWebDriver driver;
        static string baseURL;

        [ClassInitialize]
        public static void ClassInitialize(TestContext context) {
            DirectoryInfo di = new DirectoryInfo(Directory.GetCurrentDirectory());
            path = Path.Combine(di.Parent.Parent.Parent.FullName, "Tests\\bin\\debug\\");
            driver = new FirefoxDriver();
            baseURL = "http://localhost:5555/";
        }

        [ClassCleanup]
        public static void ClassCleanup() {
            driver.Quit();
        } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-10-07T07:03:44.177

虽然这是一个老问题了！！Selenium 服务器或 RC 已过时，但 Selenium Webdriver 仍然存在同样的问题。通过 webdriver 启动 firefox 大约需要 30 秒。

但正如这里所解释的，有些人解决了这个问题“禁用未使用的网络适配器（位于控制面板\网络和 Internet\网络连接）

它被卡住了：

```
ExtensionConnection connection = connectTo(exe.binary, profileToUse, "localhost"); 
```

[https://groups.google.com/forum/#!topic/selenium-users/a2fNfF-mD_E](https://groups.google.com/forum/#!topic/selenium-users/a2fNfF-mD_E)

虽然它对我不起作用，但可能有人想肯定地尝试一下！！

另一个出路可能是：

```
FirefoxProfile profile = new FirefoxProfile();
FirefoxBinary binary = new FirefoxBinary(@"path\to\firefox.exe");
FirefoxDriver driver = new FirefoxDriver(binary,profile); 
```

# javascript - 我们能否让 IE7 将 FILE TYPE=INPUT 元素视为单个控件？

> ID：714795
> 
> 赞同：2
> 
> 时间：2009-04-03T16:58:17.913
> 
> 标签：javascript, ajax, forms, internet-explorer-7

在通过按 TAB 键导航 HTML 表单时，Internet Explorer 7 将一个`INPUT`元素`TYPE=FILE`视为*两个*控件（[有关详细信息，请参阅 MSDN](http://msdn.microsoft.com/en-us/library/ms535263(VS.85).aspx)）。第一次点击 TAB 时，它专注于文本字段，第二次点击 Browse 按钮​​。这对 JavaScript 是不可见的。

问题是我想使用[Ajax Upload](http://valums.com/ajax-upload/)或类似的东西来允许用户单击看起来像按钮的东西并看到文件选择器出现。这是通过在鼠标下放置一个不可见的文件输入元素来实现的。我设法更改了脚本，以允许您使用 TAB 键切换到隐藏的文件输入元素，并为此触发 CSS 更改，因此假按钮看起来像它有焦点，结果是，在 IE7 以外的浏览器上，它看起来对用户来说，就好像您可以点击按钮并按预期激活它一样。

这在 IE7 上不起作用，因为第一个 TAB 将它带到了不可见的文本字段；按 SPACE 会为不可见的文件名添加一个空格，而不是激活文件选择器。我已经尝试为`keypress`调用`click`事件添加一个事件处理程序，但是当我这样做时，`change`我所依赖的事件似乎没有被触发。

我开始认为 IE7（以及，我认为是 IE8）上唯一可访问的解决方案是将整个对话替换为两部分形式 - 第一部分带有（可见）文件输入元素和上传按钮，第二部分与所有其他表单项。这是不幸的，因为 (a) IE7 的用户体验不太流畅，并且 (b) 我必须添加各种额外的服务器端代码以允许表单分两部分提交。

所以我很想知道是否有人有办法让 IE7 的文件输入元素表现得像一个单独的控件，或者，允许 JavaScript 访问元素的两个控件（DOM 不是为此而设计的！）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-04T02:21:40.103

这有点复杂，但方法如下：

创建一个新按钮以用作您的“假”输入控件（您将其作为可见元素）。这个元素需要是一个按钮或一个链接才能获得标签焦点（我建议按钮，以便它在 Safari 上更好地工作）。

`.tabIndex`通过将其设置为 -1 ，将文件输入从跳位顺序中删除。它现在应该从视线和标签顺序中隐藏起来。

将事件分配给文件输入，以便在活动时将焦点移回假按钮，从中复制值等等。

将单击事件分配给调用`.click`文件输入元素的假按钮。这仅适用于 IE。它也很可能在未来的版本中中断。

对于 mozilla 风格的浏览器，您可以将焦点从假按钮移动到*keydown*上的文件输入，*keypress事件将在文件控件上发生，然后您可以在**更改*时将焦点移回假按钮。这也应该为您提供删除/退格功能（清除字段）。

清除 IE 中的字段只能通过重建新的文件输入控件来完成。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-04T02:52:26.020

从我的其他答案中应该很明显，我已经设法构建了这个具有全键盘可访问性的小部件。

我真诚的建议是放弃这种追求。这是维护的*噩梦*。您正在利用浏览器中的安全漏洞来完成这项工作，供应商关闭您所依赖的东西只是时间问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-04T10:11:08.540

您还可以查看[swfupload](http://swfupload.org/)，因为它可能会提供您想要的内容等等。

# java - 优先队列/堆更新

> ID：714796
> 
> 赞同：41
> 
> 时间：2009-04-03T16:58:26.867
> 
> 标签：java, heap, priority-queue

一旦 PriorityQueue 中对象的优先级发生变化，Java 是否有一种简单的方法来重新评估堆？我在 中找不到任何迹象`Javadoc`，但必须有办法以某种方式做到这一点，对吧？我目前正在删除该对象，然后重新添加它，但这显然比在堆上运行更新要慢。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-03T17:18:25.960

您可能需要自己实现这样的堆。您需要处理堆中项目的位置，以及在项目的优先级发生变化时将项目向上或向下推的一些方法。

几年前，我写了这样一个堆作为学校作业的一部分。向上或向下推动一个项目是一个 O(log N) 操作。我将以下代码作为公共领域发布，因此您可以以任何您喜欢的方式使用它。（您可能想要改进这个类，以便排序顺序将依赖于 Java 的 Comparator 和 Comparable 接口，而不是抽象的 isGreaterOrEqual 方法，并且还会使该类使用泛型。）

```
import java.util.*;

public abstract class Heap {

    private List heap;

    public Heap() {
        heap = new ArrayList();
    }

    public void push(Object obj) {
        heap.add(obj);
        pushUp(heap.size()-1);
    }

    public Object pop() {
        if (heap.size() > 0) {
            swap(0, heap.size()-1);
            Object result = heap.remove(heap.size()-1);
            pushDown(0);
            return result;
        } else {
            return null;
        }
    }

    public Object getFirst() {
        return heap.get(0);
    }

    public Object get(int index) {
        return heap.get(index);
    }

    public int size() {
        return heap.size();
    }

    protected abstract boolean isGreaterOrEqual(int first, int last);

    protected int parent(int i) {
        return (i - 1) / 2;
    }

    protected int left(int i) {
        return 2 * i + 1;
    }

    protected int right(int i) {
        return 2 * i + 2;
    }

    protected void swap(int i, int j) {
        Object tmp = heap.get(i);
        heap.set(i, heap.get(j));
        heap.set(j, tmp);
    }

    public void pushDown(int i) {
        int left = left(i);
        int right = right(i);
        int largest = i;

        if (left < heap.size() && !isGreaterOrEqual(largest, left)) {
            largest = left;
        }
        if (right < heap.size() && !isGreaterOrEqual(largest, right)) {
            largest = right;
        }

        if (largest != i) {
            swap(largest, i);
            pushDown(largest);
        }
    }

    public void pushUp(int i) {
        while (i > 0 && !isGreaterOrEqual(parent(i), i)) {
            swap(parent(i), i);
            i = parent(i);
        }
    }

    public String toString() {
        StringBuffer s = new StringBuffer("Heap:\n");
        int rowStart = 0;
        int rowSize = 1;
        for (int i = 0; i < heap.size(); i++) {
            if (i == rowStart+rowSize) {
                s.append('\n');
                rowStart = i;
                rowSize *= 2;
            }
            s.append(get(i));
            s.append(" ");
        }
        return s.toString();
    }

    public static void main(String[] args){
        Heap h = new Heap() {
            protected boolean isGreaterOrEqual(int first, int last) {
                return ((Integer)get(first)).intValue() >= ((Integer)get(last)).intValue();
            }
        };

        for (int i = 0; i < 100; i++) {
            h.push(new Integer((int)(100 * Math.random())));
        }

        System.out.println(h+"\n");

        while (h.size() > 0) {
            System.out.println(h.pop());
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-03T18:13:48.840

PriorityQueue 具有对`heapify`整个堆进行重新排序的`fixUp`方法、将较高优先级的元素提升到堆上的`fixDown`方法以及将较低优先级的元素下推到堆下的方法。不幸的是，所有这些方法都是私有的，所以你不能使用它们。

我会考虑使用观察者模式，以便包含的元素可以告诉队列其优先级已更改，然后队列可以执行类似`fixUp`或`fixDown`取决于优先级分别增加或减少的事情。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-03T17:23:57.697

标准接口不提供更新功能。您已经使用了实现此功能的自定义类型。

你是对的；尽管使用堆的算法的大 O 复杂度在移除和替换堆顶时不会改变，但它们的实际运行时间几乎可以翻倍。`peek()`我希望看到对堆使用的 a和`update()`样式的更好的内置支持。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2015-10-18T05:58:12.527

这是正确的。`PriorityQueue`Java 没有提供更新优先级的方法，并且删除似乎需要线性时间，因为它不会像那样将对象存储为键`Map`。它实际上多次接受同一个对象。

我也想做PQ提供更新操作。这是使用泛型的示例代码。任何 Comparable 类都可以与它一起使用。

```
class PriorityQueue<E extends Comparable<E>> {
    List<E> heap = new ArrayList<E>();
    Map<E, Integer> map = new HashMap<E, Integer>();

    void insert(E e) {
        heap.add(e);
        map.put(e, heap.size() - 1);
        bubbleUp(heap.size() - 1);
    }

    E deleteMax() {
        if(heap.size() == 0)
            return null;
        E result = heap.remove(0);
        map.remove(result);
        heapify(0);
        return result;
    }

    E getMin() {
        if(heap.size() == 0)
            return null;
        return heap.get(0);
    }

    void update(E oldObject, E newObject) {
        int index = map.get(oldObject);
        heap.set(index, newObject);
        bubbleUp(index);
    }

    private void bubbleUp(int cur) {
        while(cur > 0 && heap.get(parent(cur)).compareTo(heap.get(cur)) < 0) {
            swap(cur, parent(cur));
            cur = parent(cur);
        }
    }

    private void swap(int i, int j) {
        map.put(heap.get(i), map.get(heap.get(j)));
        map.put(heap.get(j), map.get(heap.get(i)));
        E temp = heap.get(i);
        heap.set(i, heap.get(j));
        heap.set(j, temp);
    }

    private void heapify(int index) {
        if(left(index) >= heap.size())
            return;
        int bigIndex = index;
        if(heap.get(bigIndex).compareTo(heap.get(left(index))) < 0)
            bigIndex = left(index);
        if(right(index) < heap.size() && heap.get(bigIndex).compareTo(heap.get(right(index))) < 0)
            bigIndex = right(index);
        if(bigIndex != index) {
            swap(bigIndex, index);
            heapify(bigIndex);
        }
    }

    private int parent(int i) {
        return (i - 1) / 2;
    }

    private int left(int i) {
        return 2*i + 1;
    }

    private int right(int i) {
        return 2*i + 2;
    }
} 
```

在这里更新时，我只是增加优先级（对于我的实现）并且它正在使用 MaxHeap，所以我正在做bubbleUp。可能需要根据需要进行堆放。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-03T17:07:43.100

根据数据结构的实现，可能没有更快的方法。大多数 PQ/堆算法不提供更新功能。Java 实现可能没有任何不同。请注意，尽管删除/插入会使代码变慢，但不太可能导致代码具有不同的运行时复杂度。

**编辑**：看看这个线程：[允许有效优先级更新的优先级队列？](https://stackoverflow.com/questions/450180/a-priority-queue-which-allows-efficient-priority-update)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-07-24T19:32:46.847

不幸的是，JDK 的优先队列不提供更新。Robert Sedgewick 和 Kevin Wayne 以在普林斯顿的算法课程而闻名，他们还编写了[Algorithms](http://amzn.to/13VNJi7)。

在这本优秀的书中，他们提供了自己的数据结构实现，包括可更新的[优先级队列](https://algs4.cs.princeton.edu/24pq/)，例如[IndexMinPQ.java](https://algs4.cs.princeton.edu/24pq/IndexMinPQ.java.html)

根据 GPLv3 许可。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-04-12T06:51:19.880

你需要自己实现它。但你不必花哨。在 Java 的实现中删除堆项目的实际大量时间`remove(Object)`实际上是`indexOf()`因为它必须迭代整个列表才能找到特定对象的索引。如果您实现自己的数据结构，您可以告诉每个对象在数组中的位置，即使您的实现并不花哨，它也会胜过 Java，因为每个对象都会知道它在数组中的位置。

存储这些信息，您只需执行经典的删除和添加新项目，您将大大击败 Java。

更新例程只是在特定索引上调用 heapify。它节省了 heapify 调用和一些常量操作。这里的大部分优化是Java的实际`PriorityQueue`不能存储索引。因此`remove(Object)`，在该数据结构中实际上是一个非常昂贵的操作。因为您将不得不在列表中找到该对象。这个特殊的课程将所花费的时间减少`PriorityQueue`到几乎没有。尽管它要求您`Heap.Indexed`在放入堆中的项目上实现。

```
import java.util.Arrays;

public class Heap<T extends Heap.Indexed<T>> {

    private Indexed[] heap;
    private int length = 0;

    public Heap() {
        heap = new Indexed[12];
    }

    private void ensureCapacity() {
        if (length > heap.length) {
            heap = Arrays.copyOf(heap, length * 2);
        }
    }

    public void add(T obj) {
        int index = length++;
        ensureCapacity();
        obj.setIndex(index);
        heap[index] = obj;
        heapify(index);
    }

    public T removeAt(int index) {
        T result = get(index);
        length -= 1;
        if ((length > 0) && (index != length)) {
            swap(index, length);
            heapify(index);
        }
        result.setIndex(-1);
        heap[length] = null;
        return result;
    }

    public T remove(T obj) {
        int index = obj.getIndex();
        if (index == -1) {
            return null;
        }
        return removeAt(index);
    }

    public void update(T obj) {
        int index = obj.getIndex();
        obj.setIndex(-1);
        if (index == -1) {
            return;
        }
        heapify(index);
    }

    public T poll() {
        if (length == 0) {
            return null;
        }
        return removeAt(0);
    }

    public T peek() {
        return get(0);
    }

    public T get(int index) {
        return (T) heap[index];
    }

    public int size() {
        return length;
    }

    protected boolean compare(int first, int last) {
        return get(first).compareTo(get(last)) > -1;
    }

    protected void swap(int i, int j) {
        T tmp = (T) heap[i];
        heap[i] = (T) heap[j];
        heap[j] = tmp;
        heap[i].setIndex(i);
        heap[j].setIndex(j);
    }

    public void heapify(int index) {
        int parent = (index - 1) / 2;
        if (index > 0 && !compare(parent, index)) {
            swap(parent, index);
            heapify(parent);
            return;
        }
        int left = (index << 1) + 1;
        int right = left + 1;
        int largest = index;

        if (left < length && !compare(largest, left)) {
            largest = left;
        }
        if (right < length && !compare(largest, right)) {
            largest = right;
        }

        if (largest != index) {
            swap(largest, index);
            heapify(largest);
        }
    }

    public boolean isEmpty() {
        return length == 0;
    }

    public void clear() {
        this.length = 0;
        Arrays.fill(heap, null);
    }

    public interface Indexed<I extends Heap.Indexed> extends Comparable<I> {

        int getIndex();

        void setIndex(int index);
    }

} 
```

# c# - 有没有一种简单的方法可以将（lambda 表达式）字符串解析为 Action 委托？

> ID：714799
> 
> 赞同：14
> 
> 时间：2009-04-03T16:58:38.693
> 
> 标签：c#, .net, linq, parsing, expression-trees

我有一个方法可以根据传递给它的操作委托更改“帐户”对象：

```
public static void AlterAccount(string AccountID, Action<Account> AccountAction) {
  Account someAccount = accountRepository.GetAccount(AccountID);
  AccountAction.Invoke(someAccount);
  someAccount.Save();
} 
```

这按预期工作......

```
AlterAccount("Account1234", a => a.Enabled = false); 
```

...但现在我想做的是有一个这样的方法：

```
public static void AlterAccount(string AccountID, string AccountActionText) {
  Account someAccount = accountRepository.GetAccount(AccountID);
  Action<Account> AccountAction = MagicLibrary.ConvertMagically<Action<Account>>(AccountActionText);
  AccountAction.Invoke(someAccount);
  someAccount.Save();
} 
```

然后可以像这样使用它：

```
AlterAccount("Account1234", "a => a.Enabled = false"); 
```

禁用帐户“Account1234”。

我已经查看了[linq 动态查询库](http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx)，它似乎或多或少地做了我想要的，但对于 Func 类型委托，我对表达式树等的了解还不够好，无法弄清楚如何实现我的目标想。

有没有一种简单的方法可以做我想做的事，还是我需要正确学习表达式并编写大量代码？

（我想这样做的原因是允许从用户可以指定 lambda 表达式来执行更改的 powershell 脚本批量更新帐户对象的简单方法。）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-03T17:23:32.283

动态 LINQ 库是一个不错的选择，因为它会生成表达式，您可以以轻量级方式编译成代码。

您提供的示例实际上产生了一个布尔值——因此您应该能够请求一个 Func 并且它可能会对其进行排序。

编辑：这当然是错误的，因为表达式中根本没有赋值。

因此，另一种可能的方法是采用两个 lambda。一个是找到你想要的属性，一个是提供一个值：

(a => a.AccountId), (a => true)

然后使用反射将第一个 lambda 中引用的属性设置为第二个 lambda 的结果。Hackish，但与调用 C# 编译器相比，它仍然可能是轻量级的。

这样你就不必自己做很多代码生成了——你得到的表达式将包含你需要的大部分内容。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-09-05T06:39:17.667

你可以试试这个：[Dynamic Lambda Expressions Using An Isolated AppDomain](http://jp-labs.blogspot.com/2008/11/dynamic-lambda-expressions-using.html)

它使用 CodeDOM 编译器编译 lambda 表达式。为了处理创建的内存中程序集，编译器在隔离的`AppDomain`. 对于通过域边界传递表达式，它必须被序列化。唉，`Expression<>`不是`Serializable`。因此，必须使用一个技巧。所有细节都在帖子中解释。

顺便说一句，我是那个组件的作者。我非常想听听您的反馈。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T17:04:35.137

在没有完整编译的情况下，没有通用的方法可以将字符串解析为 lambda 表达式，因为 lambda 表达式可以引用在 lambda 表达式之外定义的内容。我知道没有库可以处理您想要的特定案例。在 C# 讨论组的一个[线程](http://www.tech-archive.net/Archive/DotNet/microsoft.public.dotnet.languages.csharp/2007-05/msg04019.html)上对此进行了长时间的讨论。

获得所需内容的最简单方法是在运行时编译方法。您可以编写一个接收字符串“a.Enabled = true; return a;”的函数 并将其粘贴在以 Account 作为参数的函数的中间。我会使用这个[库](http://www.codeproject.com/KB/cs/runtime_eval.aspx)作为起点，但您也可以使用[另一个线程](https://stackoverflow.com/questions/690017/convert-complex-bool-condition-from-string-to-bool-in-net/690039#690039)上提到的函数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-05T12:00:38.070

这很容易：

*   使用[CodeDom](http://msdn.microsoft.com/en-us/library/y2k85ax6.aspx)生成包含您将用于构建表达式的“周围类”的模块；此类必须实现您的应用程序已知的接口
*   使用[CodeSnippedExpression](http://msdn.microsoft.com/en-us/library/system.codedom.codesnippetexpression(VS.80).aspx)将表达式注入其成员。
*   使用[Activator](http://msdn.microsoft.com/en-us/library/system.activator.aspx)类型在运行时创建此类的实例。

基本上，您需要使用 CodeDom 构建以下类：

```
using System;
using MyNamespace1;
using ...
using MyNamespace[N];

namespace MyNamespace.GeneratedTypes 
{
  public class ExpressionContainer[M] : IHasAccountAction
  {
    public Action<Account> AccountAction { 
      get {
        return [CodeSnippedExpression must be used here];
      }
    } 
  }
} 
```

假设`IHasAccountAction`是：

```
public IHasAccountAction {
  public Action<Account> AccountAction { get; }
} 
```

如果这样做了，您可以轻松地获得从字符串编译的表达式。如果您需要它的表达式树表示，请使用`Expression<Action<Account>>`而不是`Action<Account>`在生成的类型中。

# jquery - 为什么我的 DIV 比它的内容小？

> ID：714809
> 
> 赞同：2
> 
> 时间：2009-04-03T17:00:36.597
> 
> 标签：jquery, html, css, layout

我正在尝试修改Jonathan Raasch 发布的[Simple jQuery Slideshow 。](http://jonraasch.com/blog/a-simple-jquery-slideshow)

它循环遍历从一个到下一个淡入淡出的所有图像。

[350 像素高度的 DIV 容器中的 350 像素方形图像 http://img154.imageshack.us/img154/904/fixed.jpg](http://img154.imageshack.us/img154/904/fixed.jpg)

他的示例适用于固定大小的图像。我希望它改为使用大小为浏览器窗口宽度百分比的图像。

这适用于固定尺寸的图像......

```
#slideshow {
    ...
    height:350px;
}

#slideshow img {
    ...
} 
```

我就是这样改的...

```
#slideshow {
    ...
}

#slideshow img {
    ...
    width: 50%;
} 
```

因为我不再明确设置DIV“幻灯片”的高度，它折叠为0。然后图像覆盖了我的文本。比较...

[零高度 DIV 容器中的 50% 宽图像（重叠文本）http://img253.imageshack.us/img253/6016/variable.jpg](http://img253.imageshack.us/img253/6016/variable.jpg)

这是我的整个 HTML 文件，包括 CSS 和 JavaScript...

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xml:lang="en">
    <head>
        <title></title>
        <style type="text/css">

            #slideshow {
                position:relative;
                height:350px;
            }

            #slideshow img {
                position:absolute;
                top:0;
                left:0;
                z-index:8;
            }

            #slideshow img.active {
                z-index:10;
            }

            #slideshow img.last-active {
                z-index:9;
            }

        </style>
        <script src="js/jquery-1.3.2.min.js" type="text/javascript"></script>
        <script type="text/javascript">

            function slideSwitch() {
                var $active = $('#slideshow img.active');
                if ( $active.length == 0 ) $active = $('#slideshow img:last');
                var $next =  $active.next().length ? $active.next()
                    : $('#slideshow img:first');
                $active.addClass('last-active');
                $next.css({opacity: 0.0})
                    .addClass('active')
                    .animate({opacity: 1.0}, 1000, function() {
                        $active.removeClass('active last-active');
                    });
            }

            $(function() {
                setInterval( "slideSwitch()", 5000 );
            });

        </script>
    </head>
    <body>

        <div id="slideshow">
            <img src="img/img1.jpg" alt="" class="active" />
            <img src="img/img2.jpg" alt="" />
            <img src="img/img3.jpg" alt="" />
        </div>

        <p>Lorem ipsum ...</p>

    </body>
</html> 
```

为什么我的 DIV 比它的内容小？如何使我的 DIV 高度与其内容的高度相匹配？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-03T17:02:59.570

通过将图像的位置设置为绝对位置，您可以将其从文档流（其余文本所在的位置）中删除并将其放在顶部。

**编辑**：

我将 CSS 调整为：

```
 #slideshow {
            position:relative;
            height:1000px;
        }

        #slideshow img {
            position:absolute;
            width: 50%;
            top:0;
            left:0;
            z-index:8;
            display: none;
        }

        #slideshow img.active {
            z-index:10;
            display: inline;
        }

        #slideshow img.last-active {
            z-index:9;
            display: inline;
        } 
```

也许这更像你想要的。你需要想出一个与你的大部分内容相匹配的合理高度，但这似乎会使图片在循环结束时淡入淡出，并以最少的“弹出”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T18:02:32.517

绝对定位是图像在文本上方的原因（因为没有`#slideshow <div>`任何高度），但是您的系统需要绝对定位图像才能将它们堆叠在一起以获得幻灯片效果。由于无论如何您都在使用 jQuery，因此您可以通过编程将容器扩展`<div>`到最大图像的高度。

```
var maxHeight = 0;
$("#slideshow img").each(function(){
    if (maxHeight < $(this).height()) {maxHeight = $(this).height()}
});
$("#slideshow").height(maxHeight); 
```

我相信有人可以指出一种更优雅的方式来编写脚本的 maxHeight 部分！

# regex - 如何在 Perl 中删除所有带有非单词字符的标记？

> ID：714813
> 
> 赞同：3
> 
> 时间：2009-04-03T17:01:12.570
> 
> 标签：regex, perl, pcre

我正在尝试提出一个正则表达式来删除所有包含非单词字符的单词。

因此，如果它包含冒号、逗号、数字、括号等，则将其从行中删除，不仅是字符，还有单词。到目前为止我有这个。

```
$wordline = s/\s.*\W.*?\s//g; 
```

不必是完美的，所以用破折号和撇号删除字符串是可以的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-03T17:34:59.667

```
$wordline = join(" ", grep(/^\w+$/, split(/\s+/, $wordline))); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-03T17:08:52.303

```
s/\w*([^\w\s]|\d)+\w* ?//g; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-03T18:14:07.263

```
s/(?<!\S)(?![A-Za-z]+(?:\s|$))\S+(?!\S)//g 
```

在 regex-land 中，“单词字符”是字母、数字或下划线 ( `[A-Za-z0-9_]`)。听起来你只是用它来表示字母，所以`\w`对`\W`你没有任何好处。我的正则表达式匹配：

*   一堆非空白字符：`\S+`

*   前面没有：`(?<!\S)`或后面：`(?!\S)`非空白字符

*   除非所有字符都是字母：`(?![A-Za-z]+(?:\s|$))`

这将留下它删除的单词周围的所有空格。正确处理这些问题比您想象的要复杂一些。在单独的步骤中执行起来要容易得多，例如：

```
s/^ +| +(?= |$)//g 
```

# c# - 如何将来自另一个程序的文本点击到您自己的文本框中？

> ID：714821
> 
> 赞同：0
> 
> 时间：2009-04-03T17:02:52.020
> 
> 标签：c#, .net

我的意思是如何从另一个正在运行的活动窗口中获取文本。例如，我有一个程序，让我们说 word 或 msn。当我自己的程序在托盘中运行时，我正在与某人聊天。我想设置一个键，比如说右键单击和 ctrl 打开我的程序并获取我单击的单词。我正在使用 C#。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-03T17:12:58.860

我指导您[回答我对](https://stackoverflow.com/questions/266244/unified-way-to-scrape-html-from-any-type-of-browser-process/484312#484312)[从任何类型的浏览器进程中抓取 HTML 的统一方式](https://stackoverflow.com/questions/266244/unified-way-to-scrape-html-from-any-type-of-browser-process)的问题的回答

答案链接到[Coding the Wheel](http://www.codingthewheel.com/)上的一篇文章，该文章详细介绍了如何通过系统 dll 挂钩访问其他窗口中的文本。那应该有你需要的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-05T00:30:41.233

您可以复制单词，然后从应用程序的剪贴板中取出单词……否则，您可能会从任何应用程序的谈话 API 中获取单词。

# c# - 我们如何解决将 Access DB 从生产服务器转移到实时服务器的日期时间问题

> ID：714825
> 
> 赞同：3
> 
> 时间：2009-04-03T17:03:13.643
> 
> 标签：c#, ms-access

您能否建议在 .Net 中纠正时区问题的最佳方法。最近我使用 asp.net C# 作为代码隐藏和 MS Access 作为后端开发了一个简单的网站。

我的生产服务器和实时服务器的日期时间设置不同。我的生产服务器日期格式是 dd-mm-yyyy

实时服务器格式为 mm-dd-yyyy。

当我尝试在前端投射日期时间时遇到错误。“字符串未被识别为有效的日期时间。”

我尝试投射的日期已填充到我的生产服务器中，它在生产服务器中运行良好。但是当我将访问文件推送到实时服务器时，我遇到了上述错误。任何帮助将不胜感激

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T17:53:37.390

作为一般规则，在不指定确切格式的情况下将 DateTime 转换为字符串/从字符串转换几乎每次都是一个坏主意。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-03T19:46:18.523

将日期转换为 ISO 日期格式 - YYYY-MM-DD。当你把它放在那种格式中时，就会有零歧义，而且 MS 的日期函数总是能理解它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-04T15:58:52.523

这就是我在前端处理日期时间时总是做的事情：指定我自己的确切格式（通常是 DD/MMM/YYYY - 这样我就确定我的日期部分始终是数字，月份部分字符串和年份部分 a 4数字

还 - 使用 DateTime.ParseExact 而不是 DateTime.Parse。这样前端代码就没有歧义了。

还有 1 个提示 - 如果您使用的是 c# 3.5，我真的建议您在 datetime 类上创建一个扩展方法，在该类中您实际上对给定应用程序的特定格式进行硬编码，而不是在 10 个不同的地方提供您的格式正在转换，只需调用此扩展方法

这样，如果出于任何原因您想稍后更改格式，您只需更改 1 个扩展方法 :-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-03T17:11:24.433

我很抱歉我不做 c#，但是在 VB 中，我做了以下事情（这是 Access 的常见问题）

myNewDate = cdate(format(DateIn,"mm/dd/yy"))

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-03T17:11:50.110

您有几个选择，最合乎逻辑的做法是在从生产环境升级到实时环境时将该列中的值简单地转换为新格式。

但是，我宁愿强调最好的做法是让您的测试/开发/qa 环境尽可能接近生产环境，因此重新配置您的服务器以全部使用相同的格式将有助于避免该问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-03T17:12:34.523

在插入/更新查询中，无论区域设置如何，Access 都需要 mm/dd/yyyy 格式的日期。

# javascript - selectionStart-End with textareas

> ID：714830
> 
> 赞同：36
> 
> 时间：2009-04-03T17:03:57.760
> 
> 标签：javascript, jquery, editor

我遇到了这个烦人的问题，我似乎无法在 textarea 中获取所选文本的开始和结束索引，我得到的只是这样的未定义：

```
$('#myarea').selectionStart; // return undefined 
```

我做错什么了吗？

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2009-04-03T17:05:26.867

尝试：

```
$('#myarea')[0].selectionStart; 
```

为什么？jQuery 选择器不返回实际的 DOM 元素，而是返回包装的 jQuery 集合。jQuery 使实际的 DOM 元素可以作为数组访问，所以如果你想使用第一个匹配的元素（在这种情况下，是唯一的一个，因为它是按 ID），你可以按照上面的方法进行操作。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2016-07-11T05:28:46.063

从 jQuery 1.6 版开始，您可以使用[.prop()](http://api.jquery.com/prop/)方法：

得到：

```
// always start at 0

var start = $('#myarea').prop('selectionStart');
var end = $('#myarea').prop('selectionEnd'); 
```

放：

```
$('#myarea').prop('selectionStart', 10);
$('#myarea').prop('selectionEnd', 15);

// or short hand by

$('#myarea').prop({
    'selectionStart': 10,
    'selectionEnd': 15
}); 
```

# http - “经典” cookie 身份验证是否有任何可行的替代方案？

> ID：714844
> 
> 赞同：11
> 
> 时间：2009-04-03T17:09:25.780
> 
> 标签：http, authentication, login, cookies

有没有什么方法（除了 HTTP 身份验证，我认为它在 Internet 上本质上是不安全的？）让“现实生活”网站使用会话 cookie 来处理登录和身份验证，而不是传统方式？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-03T18:14:26.077

[HTTP 摘要身份验证](http://en.wikipedia.org/wiki/Digest_access_authentication)（这与 HTTP 基本身份验证完全不同）在直接 HTTP 上非常安全，并且在服务器上实现一点也不困难。没有任何东西通过网络发送可以揭示密码是什么，只是允许客户端向服务器证明他们拥有正确密码的信息。

如果您想对如何在您的应用程序中实现 HTTP 摘要身份验证有一个体面的解释，[Paul James 有一篇关于它的优秀文章](http://www.peej.co.uk/projects/phphttpdigest.html)。

The only real problem with HTTP authentication is in the browsers themselves: the UI is terrible, but that can be [overcome with some Javascript](http://www.peej.co.uk/articles/http-auth-with-html-forms.html).

**Addendum:** This answer is almost a decade old. These days, you should *really* be using HTTPS regardless of any other considerations.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-03T17:14:52.210

HTTP 基本身份验证在与 SSL (https://) 网站一起使用时非常安全，因为包括凭据在内的所有 HTTP 流量都将被加密。但是，一个主观的缺点是，当使用这种方法时，您的用户需要与浏览器的身份验证弹出窗口进行交互才能登录到您的站点。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-03T18:07:58.573

需要明确的是，唯一真正做到这一点的方法是通过 HTTPS。

但是，由于我认为这不是一个选项，并且我还假设您正在寻找“完全托管的登录”系统，所以我继续：

除了 HTTPS 之外，还可以使用 JavaScript 在客户端对密码进行安全哈希处理，以防止通过网络泄露纯文本密码，但这只是一个成功的解决方案。

这种方法的问题是：

1.  重放攻击仍然是一个可行的选择。
2.  只有启用了 JavaScript 的用户才能以这种方式进行身份验证。

另一种方法是更复杂的挑战/响应机制：

1.  与登录页面一起发送“挑战”。
2.  计算 Password + Challenge 客户端的哈希值。
3.  提交登录。
4.  在服务器端计算 Password + Challenge（在页面请求中不得信任）的哈希值，并进行比较。

以及随之而来的问题：

1.  只有启用了 JavaScript 的用户才能以这种方式进行身份验证。
2.  PLAINTEXT 密码必须存储在服务器上以验证质询响应，并且必须在磁盘上加密或以其他方式保护。

现在，公平地说，问题 #2 并不像听起来那么危险。事实上，当您改为使用 HASH 身份验证时，哈希本身会提升到“密钥”级别。

此时使用 cookie 存储随机生成的登录引用 ID 是相当安全的，类似于他们的会话 ID，但服务器可能希望使用引用 IP 作为 IV 或 KEY 的一部分进行加密，以防止其他用户劫持参考 ID。

无论如何，我希望这能为您的设计提供一点方向。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-03T17:12:19.797

使用 HTTP 时，HTTP 身份验证并非不安全。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-03T18:11:30.343

首先，HTTP Auth 在 SSL 上是安全的，除了您无法实现真正​​的“注销”功能。用户需要关闭他们的浏览器，这很糟糕。

其次，您需要在所有情况下都使用 HTTPS 以确保其安全，之后您获得了 Basic Auth 类似的东西，例如“Digest”和“NTLM Auth”。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-03T18:06:02.947

当您使用 https 时，您还可以在客户端的浏览器中安装证书并进行验证。[myopenid](https://www.myopenid.com/)为其 OpenID 帐户提供此功能。我有一个，它工作得非常好（从客户端的角度来看）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-03T18:09:12.970

使用 SSL 进行加密并结合[HttpOnly Cookie](http://www.codinghorror.com/blog/archives/001167.html)来帮助防止 XSS 是使用 cookie 的最佳选择。不过，我不会说它是防弹的。

# sharepoint - 如何指示 SharePoint 场在特定服务器上运行计时器作业？

> ID：714848
> 
> 赞同：6
> 
> 时间：2009-04-03T17:10:45.543
> 
> 标签：sharepoint, moss, wss, timer-jobs

我们有一个 SP 计时器作业，它运行了很长一段时间。最近，管理员将另一台服务器加入场，因此 SharePoint 决定开始在另一台服务器上运行此计时器作业。问题是服务器上没有安装所有依赖项（即 Oracle），因此作业失败。我只是在这里寻找阻力最小的路径。我的问题是有没有办法强制计时器作业在您想要的服务器上运行？

**[编辑]** 如果我可以通过适合我的代码来做到这一点。如果确实存在 API，我只需要知道执行此操作的 API 是什么。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-06-24T16:55:26.190

如果我在推动显而易见的事情，我深表歉意；我只是还没有看到有人深入研究它。

通过控制构造函数参数来约束自定义计时器作业（即您自己的从 SPJobDefinition 派生的计时器作业类）。

计时器作业通常在提交它们的服务器上运行（如 vinny 所示），假设在创建计时器作业期间未指定目标服务器。但是，SPJobDefinition 类型的两个重载构造函数分别接受一个 SPServer 和一个 SPJobLockType 作为第三个和第四个参数。正确使用这两个参数将使您能够决定作业的运行位置。

通过将目标服务器指定为 SPServer 并将 SPJobLockType 指定为“Job”，您可以限制您创建的计时器作业实例在您选择的服务器上运行。

有关我所描述的文档，请参阅 MSDN：http: [//msdn.microsoft.com/en-us/library/microsoft.sharepoint.administration.spjobdefinition.spjobdefinition.aspx](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.administration.spjobdefinition.spjobdefinition.aspx)。

我对您正在运行的代码一无所知，但自定义计时器作业通常在功能激活期间设置。我感觉你的代码库可能不是你自己的（？）；如果是这样，您可能需要查找派生自 SPFeatureReceiver 的一种或多种类型/类。在此类类的 FeatureActivated 方法中，您可能会找到实际执行计时器作业实例化的代码。

当然，您还需要查看自定义计时器作业类（或类）本身，以了解它们是如何被实例化的。有时开发人员会将类的实例化构建到类本身中（例如，通过工厂方法模式）。但是，在计时器作业类和 SPFeatureReceiver 实现之间，您应该正在寻找需要更改的内容。

我希望这会有所帮助！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-03T17:16:22.003

场中的服务器需要相同。如果您碰巧将 VM 用于 Web 前端，则可以快照服务器并提供副本，以便您知道它们都是相同的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T19:16:39.610

每个定义的计时器作业在所有 Web 前端运行。

如果您需要在特定服务器上运行预定逻辑，则需要在计时器作业中专门对此进行编码，或者改用“标准”NT 服务。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-17T21:45:30.713

我认为将 SPJobLockType 设置为“Job”的副作用是它将在提交作业的服务器上执行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-03T23:13:34.970

您可以使用业务日志实现 Web 服务并将该 Web 服务部署到一台机器上。然后您的 Timer Job 可以定期触发您的 Web 服务。

当您的计时器作业正在运行时，它并不那么重要。SharePoint 自行决定在何处运行计时器作业。

# linux - 禁止分叉命令被杀死的通知

> ID：714855
> 
> 赞同：2
> 
> 时间：2009-04-03T17:11:53.683
> 
> 标签：linux, bash, macos

假设我有`foo.sh`一个非常简化的 bash 脚本 ( )，如下所示：

```
echo "hello"
sleep 100 &
ps ax | grep sleep | grep -v grep | awk '{ print $1 } ' | xargs kill -9
echo "bye" 
```

第三行模仿`pkill`，我在 Mac OS X 上默认没有，但你可以认为它与`pkill`. 但是，当我运行此脚本时，我得到以下输出：

```
hello
foo: line 4: 54851 Killed                  sleep 100
bye 
```

如何抑制中间的线，以便我看到的只是`hello`and `bye`？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-03T18:10:47.270

虽然`disown`可能具有使消息静音的*副作用*；这就是您如何以一种真正消除消息的方式启动流程，而不必放弃对流程的作业控制。

```
{ command & } 2>/dev/null 
```

如果您仍然想要命令自己的 stderr（只是在 stderr 上静音 shell 的消息），您需要将进程的 stderr 发送到真正的 stderr：

```
{ command 2>&3 & } 3>&2 2>/dev/null 
```

要了解重定向的工作原理：

*   来自 BashGuide：[http://mywiki.wooledge.org/BashGuide/TheBasics/InputAndOutput#Redirection](http://mywiki.wooledge.org/BashGuide/TheBasics/InputAndOutput#Redirection)
*   图解教程：[http://bash-hackers.org/wiki/doku.php/howto/redirection_tutorial](http://bash-hackers.org/wiki/doku.php/howto/redirection_tutorial)
*   还有更多信息：[http://bash-hackers.org/wiki/doku.php/syntax/redirection](http://bash-hackers.org/wiki/doku.php/syntax/redirection)

顺便说一下; [不要使用`kill -9`](https://stackoverflow.com/questions/690415/in-what-order-should-i-send-signals-to-gracefully-shutdown-processes/690631#690631).

我也觉得有义务评论你的：

```
ps ax | grep sleep | grep -v grep | awk '{ print $1 } ' | xargs kill -9 
```

这将使任何带有线索的 UNIX/Linux 用户眼花缭乱。而且，每次解析时，都会`ps`死去一个仙女。做这个：

```
kill $! 
```

即使是诸如此类的工具`pgrep`也基本上被设计破坏了。虽然他们在匹配流程方面做得更好，但基本缺陷仍然存在：

*   Race：当您获得 PID 输出并将其解析并用于其他用途时，PID 可能已经消失，甚至被完全不相关的进程所取代。
*   责任：在 UNIX 进程模型中，管理子进程是父进程的责任，其他人不应该这样做。如果父母希望能够发出信号并且只有父母可以可靠地这样做，则父母应该保留其孩子的PID。UNIX 内核的设计假设用户程序将遵守此模式，而不是违反它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-03T17:39:26.643

不认怎么办？这主要适用于我在 Linux 上的 Bash。

```
echo "hello"
sleep 100 &
disown
ps ax | grep sleep | grep -v grep | awk '{ print $1 } ' | xargs kill -9
echo "bye" 
```

**编辑：**更好地匹配海报的代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T17:16:59.693

消息是真实的。该代码也杀死了 grep 进程。

运行`ps ax | grep sleep`，您应该会在列表中看到您的 grep 进程。

在这种情况下我通常做的是`ps ax | grep sleep | grep -v grep`

编辑：这是对旧形式问题的回答，其中作者省略了 grep 对 kill 序列的排除。我希望我仍然得到一些代表来回答上半场。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-03-11T11:55:42.493

禁用作业终止消息的另一种方法是将您的命令置于`sh -c 'cmd &'`构造中。

正如已经指出的，没有必要模仿`pkill`；您可以将 的值存储`$!`在另一个变量中。

```
echo "hello"
sleep_pid=`sh -c 'sleep 30 & echo ${!}' | head -1`
#sleep_pid=`sh -c '(exec 1>&-; exec sleep 30) & echo ${!}'`
echo kill $sleep_pid
kill $sleep_pid
echo "bye" 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-03T17:50:26.213

您是否尝试过停用作业控制？它是一个非交互式 shell，所以我猜它默认是关闭的，但尝试一下也无妨……它由 -m (monitor) shell 变量调节。

# windows - 设置 Windows PowerShell 环境变量

> ID：714877
> 
> 赞同：819
> 
> 时间：2009-04-03T17:19:35.087
> 
> 标签：windows, powershell

我发现设置 PATH 环境变量只影响旧的命令提示符。PowerShell 似乎有不同的环境设置。如何更改 PowerShell (v1) 的环境变量？

笔记：

我想让我的更改永久化，所以我不必在每次运行 PowerShell 时都设置它。PowerShell 有配置文件吗？类似于 Unix 上的 Bash 配置文件？

* * *

## 回答 #1

> 赞同：734
> 
> 时间：2009-08-26T10:22:26.340

如果在 PowerShell 会话期间的某个时间，您需要查看或*临时*修改 PATH 环境变量，您可以键入以下命令之一：

```
$env:Path                             # shows the actual content
$env:Path = 'C:\foo;' + $env:Path     # attach to the beginning
$env:Path += ';C:\foo'                # attach to the end 
```

* * *

## 回答 #2

> 赞同：687
> 
> 时间：2009-04-03T17:35:44.890

可以使用这些`env: namespace / drive`信息来更改实际的环境变量。例如，此代码将更新路径环境变量：

```
$env:Path = "SomeRandomPath";             (replaces existing path) 
$env:Path += ";SomeRandomPath"            (appends to existing path) 
```

## 使改变永久化

有一些方法可以使环境设置永久化，但如果您只在 PowerShell 中使用它们，那么使用[Powershell*配置文件*](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_profiles)脚本可能要好得多。

每次启动新的 Powershell 实例时，它都会查找特定的脚本文件（命名*配置*文件）并在它们存在时执行它们。您可以编辑其中一个配置文件来自定义您的环境。

要了解这些*配置文件*脚本在您的计算机类型中的位置：

```
$profile                                     
$profile.AllUsersAllHosts           
$profile.AllUsersCurrentHost        
$profile.CurrentUserAllHosts    
$profile.CurrentUserCurrentHost 
```

您可以编辑其中之一，例如，通过键入：

```
notepad $profile 
```

* * *

## 回答 #3

> 赞同：388
> 
> 时间：2010-04-03T12:06:43.260

您还可以使用以下内容**永久**修改用户/系统环境变量（即将在 shell 重新启动时保持不变）：

修改系统环境变量

```
[Environment]::SetEnvironmentVariable
     ("Path", $env:Path, [System.EnvironmentVariableTarget]::Machine) 
```

修改用户环境变量

```
[Environment]::SetEnvironmentVariable
     ("INCLUDE", $env:INCLUDE, [System.EnvironmentVariableTarget]::User) 
```

注释中的用法 - 添加到系统环境变量

```
[Environment]::SetEnvironmentVariable(
    "Path",
    [Environment]::GetEnvironmentVariable("Path", [EnvironmentVariableTarget]::Machine) + ";C:\bin",
    [EnvironmentVariableTarget]::Machine) 
```

如果您不想编写类型，也可以使用基于字符串的解决方案

```
[Environment]::SetEnvironmentVariable("Path", $env:Path + ";C:\bin", "Machine") 
```

* * *

## 回答 #4

> 赞同：78
> 
> 时间：2012-01-09T13:03:27.267

警告：在 PowerShell 提示符下保存现有路径的副本`$env:path >> a.out`，以防出现问题。

从 PowerShell 提示符：

```
setx PATH "$env:path;\the\directory\to\add" -m 
```

然后你应该看到文本：

```
SUCCESS: Specified value was saved. 
```

重新启动会话，变量将可用。`setx`也可用于设置任意变量。`setx /?`在提示时键入文档。

* * *

## 回答 #5

> 赞同：42
> 
> 时间：2016-01-17T22:48:31.247

就像[JeanT 的回答](https://stackoverflow.com/a/30694253/27581)一样，我想要一个关于添加路径的抽象。与 JeanT 的回答不同，我需要它在没有用户交互的情况下运行。我正在寻找的其他行为：

*   更新`$env:Path`以使更改在当前会话中生效
*   为将来的会话保留环境变量更改
*   当相同路径已存在时不添加重复路径

如果它有用，这里是：

```
function Add-EnvPath {
    param(
        [Parameter(Mandatory=$true)]
        [string] $Path,

        [ValidateSet('Machine', 'User', 'Session')]
        [string] $Container = 'Session'
    )

    if ($Container -ne 'Session') {
        $containerMapping = @{
            Machine = [EnvironmentVariableTarget]::Machine
            User = [EnvironmentVariableTarget]::User
        }
        $containerType = $containerMapping[$Container]

        $persistedPaths = [Environment]::GetEnvironmentVariable('Path', $containerType) -split ';'
        if ($persistedPaths -notcontains $Path) {
            $persistedPaths = $persistedPaths + $Path | where { $_ }
            [Environment]::SetEnvironmentVariable('Path', $persistedPaths -join ';', $containerType)
        }
    }

    $envPaths = $env:Path -split ';'
    if ($envPaths -notcontains $Path) {
        $envPaths = $envPaths + $Path | where { $_ }
        $env:Path = $envPaths -join ';'
    }
} 
```

查看[我的要点](https://gist.github.com/mkropat/c1226e0cc2ca941b23a9)以获得相应的`Remove-EnvPath`功能。

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2014-12-17T11:23:45.110

尽管当前接受的答案在路径变量从 PowerShell 的上下文中永久更新的意义上起作用，但它实际上并没有更新存储在 Windows 注册表中的环境变量。

为此，您显然也可以使用 PowerShell：

```
$oldPath=(Get-ItemProperty -Path 'Registry::HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\Environment' -Name PATH).Path

$newPath=$oldPath+’;C:\NewFolderToAddToTheList\’

Set-ItemProperty -Path 'Registry::HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\Environment' -Name PATH –Value $newPath 
```

更多信息在博文中*[使用 PowerShell 修改您的环境路径](http://blogs.technet.com/b/heyscriptingguy/archive/2011/07/23/use-powershell-to-modify-your-environmental-path.aspx)*

如果您使用 PowerShell 社区扩展，则将路径添加到环境变量路径的正确命令是：

```
Add-PathVariable "C:\NewFolderToAddToTheList" -Target Machine 
```

* * *

## 回答 #7

> 赞同：18
> 
> 时间：2016-10-10T13:08:27.893

所有暗示永久更改的答案都有相同的问题：它们破坏了路径注册表值。

`SetEnvironmentVariable`将`REG_EXPAND_SZ`值`%SystemRoot%\system32` 转换为 的`REG_SZ`值`C:\Windows\system32`。

路径中的任何其他变量也会丢失。添加新的 using`%myNewPath%`将不再起作用。

`Set-PathVariable.ps1`这是我用来解决此问题的脚本：

```
 [CmdletBinding(SupportsShouldProcess=$true)]
 param(
     [parameter(Mandatory=$true)]
     [string]$NewLocation)

 Begin
 {

 #requires –runasadministrator

     $regPath = "SYSTEM\CurrentControlSet\Control\Session Manager\Environment"
     $hklm = [Microsoft.Win32.Registry]::LocalMachine

     Function GetOldPath()
     {
         $regKey = $hklm.OpenSubKey($regPath, $FALSE)
         $envpath = $regKey.GetValue("Path", "", [Microsoft.Win32.RegistryValueOptions]::DoNotExpandEnvironmentNames)
         return $envPath
     }
 }

 Process
 {
     # Win32API error codes
     $ERROR_SUCCESS = 0
     $ERROR_DUP_NAME = 34
     $ERROR_INVALID_DATA = 13

     $NewLocation = $NewLocation.Trim();

     If ($NewLocation -eq "" -or $NewLocation -eq $null)
     {
         Exit $ERROR_INVALID_DATA
     }

     [string]$oldPath = GetOldPath
     Write-Verbose "Old Path: $oldPath"

     # Check whether the new location is already in the path
     $parts = $oldPath.split(";")
     If ($parts -contains $NewLocation)
     {
         Write-Warning "The new location is already in the path"
         Exit $ERROR_DUP_NAME
     }

     # Build the new path, make sure we don't have double semicolons
     $newPath = $oldPath + ";" + $NewLocation
     $newPath = $newPath -replace ";;",""

     if ($pscmdlet.ShouldProcess("%Path%", "Add $NewLocation")){

         # Add to the current session
         $env:path += ";$NewLocation"

         # Save into registry
         $regKey = $hklm.OpenSubKey($regPath, $True)
         $regKey.SetValue("Path", $newPath, [Microsoft.Win32.RegistryValueKind]::ExpandString)
         Write-Output "The operation completed successfully."
     }

     Exit $ERROR_SUCCESS
 } 
```

我在[博客文章](https://peter.hahndorf.eu/blog/AddingToPathVariable.html)中更详细地解释了这个问题。

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2020-10-01T01:59:24.273

**注意 1：所有这些命令都应该在 powershell-eleved-mode 下运行（例如，具有管理员权限）**

**注意 2：在使您的命令正常工作的每一步之后，关闭会话并再次打开它以完成任务**

不要让自己头疼，想要一个简单的单行解决方案来添加**永久**环境变量：

```
[Environment]::SetEnvironmentVariable("NewEnvVar", "NewEnvValue", "Machine") 
```

### 

* * *

如果您想**修改/更改**：

```
[Environment]::SetEnvironmentVariable("oldEnvVar", "NewEnvValue", "Machine") 
```

### 

* * *

如果您想**删除/删除**它：

```
[Environment]::SetEnvironmentVariable("oldEnvVar", "", "Machine") 
```

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2015-06-07T13:47:11.807

这会设置当前会话的路径并提示用户永久添加它：

```
function Set-Path {
    param([string]$x)
    $Env:Path+= ";" +  $x
    Write-Output $Env:Path
    $write = Read-Host 'Set PATH permanently ? (yes|no)'
    if ($write -eq "yes")
    {
        [Environment]::SetEnvironmentVariable("Path",$env:Path, [System.EnvironmentVariableTarget]::User)
        Write-Output 'PATH updated'
    }
} 
```

您可以将此功能添加到您的默认配置文件 ( `Microsoft.PowerShell_profile.ps1`)，通常位于`%USERPROFILE%\Documents\WindowsPowerShell`。

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2018-01-05T12:09:31.993

我的建议是这个：

我已经对此进行了测试以永久添加`C:\oracle\x64\bin`到环境变量中`Path`，并且效果很好。

```
$ENV:PATH 
```

第一种方法很简单：

```
$ENV:PATH=”$ENV:PATH;c:\path\to\folder” 
```

但这种变化不是永久性的。`$env:path`一旦您关闭 PowerShell 终端并再次重新打开它，它将默认恢复到以前的状态。那是因为您在会话级别而不是在源级别（即注册表级别）应用了更改。要查看 的全局值`$env:path`，请执行以下操作：

```
Get-ItemProperty -Path ‘Registry::HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\Environment’ -Name PATH 
```

或者更具体地说：

```
(Get-ItemProperty -Path ‘Registry::HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\Environment’ -Name PATH).path 
```

现在要改变这一点，首先我们捕获需要修改的原始路径：

```
$oldpath = (Get-ItemProperty -Path ‘Registry::HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\Environment’ -Name PATH).path 
```

现在我们定义新路径应该是什么样子。在这种情况下，我们将附加一个新文件夹：

```
$newpath = “$oldpath;c:\path\to\folder” 
```

注意：确保`$newpath`外观符合您的要求。如果没有，那么您可能会损坏您的操作系统。

现在应用新值：

```
Set-ItemProperty -Path ‘Registry::HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\Environment’ -Name PATH -Value $newPath 
```

现在做最后一次检查，它看起来像你期望的那样：

```
(Get-ItemProperty -Path ‘Registry::HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\Environment’ -Name PATH).Path 
```

您现在可以重新启动 PowerShell 终端（甚至重新启动机器）并查看它不会再次回滚到其旧值。

请注意，路径的顺序可能会发生变化，因此它是按字母顺序排列的，因此请确保检查整行。为方便起见，您可以使用分号作为分隔符将输出拆分为行：

```
($env:path).split(“;”) 
```

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2018-02-05T14:24:02.407

在[@Michael Kropat 的](https://stackoverflow.com/a/34844707/1509300 "迈克尔·克罗帕特")回答的基础上，我添加了一个参数以将新路径添加到现有`PATH`变量并进行检查以避免添加不存在的路径：

```
function Add-EnvPath {
    param(
        [Parameter(Mandatory=$true)]
        [string] $Path,

        [ValidateSet('Machine', 'User', 'Session')]
        [string] $Container = 'Session',

        [Parameter(Mandatory=$False)]
        [Switch] $Prepend
    )

    if (Test-Path -path "$Path") {
        if ($Container -ne 'Session') {
            $containerMapping = @{
                Machine = [EnvironmentVariableTarget]::Machine
                User = [EnvironmentVariableTarget]::User
            }
            $containerType = $containerMapping[$Container]

            $persistedPaths = [Environment]::GetEnvironmentVariable('Path', $containerType) -split ';'
            if ($persistedPaths -notcontains $Path) {
                if ($Prepend) {
                    $persistedPaths = ,$Path + $persistedPaths | where { $_ }
                    [Environment]::SetEnvironmentVariable('Path', $persistedPaths -join ';', $containerType)
                }
                else {
                    $persistedPaths = $persistedPaths + $Path | where { $_ }
                    [Environment]::SetEnvironmentVariable('Path', $persistedPaths -join ';', $containerType)
                }
            }
        }

        $envPaths = $env:Path -split ';'
        if ($envPaths -notcontains $Path) {
            if ($Prepend) {
                $envPaths = ,$Path + $envPaths | where { $_ }
                $env:Path = $envPaths -join ';'
            }
            else {
                $envPaths = $envPaths + $Path | where { $_ }
                $env:Path = $envPaths -join ';'
            }
        }
    }
} 
```

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2020-03-11T13:04:31.727

只有将值推送到注册表的答案才会影响*永久*更改（因此该线程上的大多数答案，包括接受的答案，都*不会*永久影响`Path`）。

以下函数适用于`Path`/`PSModulePath`和 for `User`/`System`类型。默认情况下，它还会将新路径添加到当前会话。

```
function AddTo-Path {
    param ( 
        [string]$PathToAdd,
        [Parameter(Mandatory=$true)][ValidateSet('System','User')][string]$UserType,
        [Parameter(Mandatory=$true)][ValidateSet('Path','PSModulePath')][string]$PathType
    )

    # AddTo-Path "C:\XXX" "PSModulePath" 'System' 
    if ($UserType -eq "System" ) { $RegPropertyLocation = 'HKLM:\System\CurrentControlSet\Control\Session Manager\Environment' }
    if ($UserType -eq "User"   ) { $RegPropertyLocation = 'HKCU:\Environment' } # also note: Registry::HKEY_LOCAL_MACHINE\ format
    $PathOld = (Get-ItemProperty -Path $RegPropertyLocation -Name $PathType).$PathType
    "`n$UserType $PathType Before:`n$PathOld`n"
    $PathArray = $PathOld -Split ";" -replace "\\+$", ""
    if ($PathArray -notcontains $PathToAdd) {
        "$UserType $PathType Now:"   # ; sleep -Milliseconds 100   # Might need pause to prevent text being after Path output(!)
        $PathNew = "$PathOld;$PathToAdd"
        Set-ItemProperty -Path $RegPropertyLocation -Name $PathType -Value $PathNew
        Get-ItemProperty -Path $RegPropertyLocation -Name $PathType | select -ExpandProperty $PathType
        if ($PathType -eq "Path") { $env:Path += ";$PathToAdd" }                  # Add to Path also for this current session
        if ($PathType -eq "PSModulePath") { $env:PSModulePath += ";$PathToAdd" }  # Add to PSModulePath also for this current session
        "`n$PathToAdd has been added to the $UserType $PathType"
    }
    else {
        "'$PathToAdd' is already in the $UserType $PathType. Nothing to do."
    }
}

# Add "C:\XXX" to User Path (but only if not already present)
AddTo-Path "C:\XXX" "User" "Path"

# Just show the current status by putting an empty path
AddTo-Path "" "User" "Path" 
```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2016-05-04T10:14:02.830

正如[Jonathan Leaders在](https://stackoverflow.com/users/1689770/jonathan-leaders)[这里](https://stackoverflow.com/a/28596275)提到的那样，运行提升的命令/脚本以便能够更改**'machine' 的**环境变量很重要，但是运行提升的一些命令不必通过社区扩展来完成，所以我想以某种方式修改和扩展[JeanT 的](https://stackoverflow.com/users/1116269/jeant) [答案](https://stackoverflow.com/a/30694253)，即使脚本本身没有运行提升，也可以执行更改机器变量：

```
function Set-Path ([string]$newPath, [bool]$permanent=$false, [bool]$forMachine=$false )
{
    $Env:Path += ";$newPath"

    $scope = if ($forMachine) { 'Machine' } else { 'User' }

    if ($permanent)
    {
        $command = "[Environment]::SetEnvironmentVariable('PATH', $env:Path, $scope)"
        Start-Process -FilePath powershell.exe -ArgumentList "-noprofile -command $Command" -Verb runas
    }

} 
```

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2019-07-08T15:21:25.297

在 PowerShell 中，可以通过键入以下内容导航到环境变量目录：

```
Set-Location Env: 
```

这会将您带到 Env:> 目录。在此目录中：

要查看所有环境变量，请键入：

```
Env:\> Get-ChildItem 
```

要查看特定环境变量，请键入：

```
Env:\> $Env:<variable name>, e.g. $Env:Path 
```

要设置环境变量，请键入：

```
Env:\> $Env:<variable name> = "<new-value>", e.g. $Env:Path="C:\Users\" 
```

要删除环境变量，请键入：

```
Env:\> remove-item Env:<variable name>, e.g. remove-item Env:SECRET_KEY 
```

更多信息在*[关于环境变量](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_environment_variables?view=powershell-6)*中。

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2015-02-18T23:55:38.447

大多数答案都没有解决[UAC](http://en.wikipedia.org/wiki/User_Account_Control)。这涵盖了 UAC 问题。

首先安装 PowerShell Community Extensions：`choco install pscx`通过[http://chocolatey.org/](http://chocolatey.org/)（您可能需要重新启动 shell 环境）。

然后启用 pscx

```
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser #allows scripts to run from the interwebs, such as pcsx 
```

然后使用`Invoke-Elevated`

```
Invoke-Elevated {Add-PathVariable $args[0] -Target Machine} -ArgumentList $MY_NEW_DIR 
```

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2020-10-22T20:51:17.923

明确一点，1990 年代的 Windows 方式点击**开始**，右击**这台电脑**，选择**属性**，然后选择**高级系统设置**，然后在弹出的对话框中选择**环境变量**，在列表中双击在**PATH**上，然后使用**New**、**Edit**、**Move Up**和**Move Down**仍然可以更改 PATH。Power shell 和 Windows 的其余部分可以获取您在此处设置的任何内容。

是的，您可以使用这些新方法，但旧方法仍然有效。在基础级别，所有永久更改方法都是编辑注册表文件的受控方式。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2019-03-17T14:14:57.863

打开 PowerShell 并运行：

```
[Environment]::SetEnvironmentVariable("PATH", "$ENV:PATH;<path to exe>", "USER") 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2019-01-18T14:20:59.120

我尝试稍微优化[SBF](https://stackoverflow.com/questions/714877/setting-windows-powershell-environment-variables/48624689#48624689)和[Michael 的](https://stackoverflow.com/questions/714877/setting-windows-powershell-environment-variables/34844707#34844707)代码以使其更紧凑。

我依赖 PowerShell 的类型强制，它会自动将字符串转换为枚举值，所以我没有定义查找字典。

我还拉出了根据条件将新路径添加到列表中的块，这样工作就完成了一次并存储在一个变量中以供重复使用。

然后根据`$PathContainer`参数将其永久应用或仅应用于会话。

我们可以将代码块放在我们直接从命令提示符调用的函数或 ps1 文件中。我选择了 DevEnvAddPath.ps1。

```
param(
    [Parameter(Position=0,Mandatory=$true)][String]$PathChange,

    [ValidateSet('Machine', 'User', 'Session')]
    [Parameter(Position=1,Mandatory=$false)][String]$PathContainer='Session',
    [Parameter(Position=2,Mandatory=$false)][Boolean]$PathPrepend=$false
)

[String]$ConstructedEnvPath = switch ($PathContainer) { "Session"{${env:Path};} default{[Environment]::GetEnvironmentVariable('Path', $containerType);} };
$PathPersisted = $ConstructedEnvPath -split ';';

if ($PathPersisted -notcontains $PathChange) {
    $PathPersisted = $(switch ($PathPrepend) { $true{,$PathChange + $PathPersisted;} default{$PathPersisted + $PathChange;} }) | Where-Object { $_ };

    $ConstructedEnvPath = $PathPersisted -join ";";
}

if ($PathContainer -ne 'Session') 
{
    # Save permanently to Machine, User
    [Environment]::SetEnvironmentVariable("Path", $ConstructedEnvPath, $PathContainer);
}

# Update the current session
${env:Path} = $ConstructedEnvPath; 
```

我为 DevEnvRemovePath.ps1 做了类似的事情。

```
param(
    [Parameter(Position=0,Mandatory=$true)][String]$PathChange,

    [ValidateSet('Machine', 'User', 'Session')]
    [Parameter(Position=1,Mandatory=$false)][String]$PathContainer='Session'
)

[String]$ConstructedEnvPath = switch ($PathContainer) { "Session"{${env:Path};} default{[Environment]::GetEnvironmentVariable('Path', $containerType);} };
$PathPersisted = $ConstructedEnvPath -split ';';

if ($PathPersisted -contains $PathChange) {
    $PathPersisted = $PathPersisted | Where-Object { $_ -ne $PathChange };

    $ConstructedEnvPath = $PathPersisted -join ";";
}

if ($PathContainer -ne 'Session') 
{
    # Save permanently to Machine, User
    [Environment]::SetEnvironmentVariable("Path", $ConstructedEnvPath, $PathContainer);
}

# Update the current session
${env:Path} = $ConstructedEnvPath; 
```

到目前为止，它们似乎有效。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2021-06-06T18:39:28.210

很多附加或覆盖的例子。这是一个在 Powershell 上为 Linux、Ubuntu 18.04 和`pwsh`7.1.3添加路径的示例

```
$ENV:PATH = "/home/linuxbrew/.linuxbrew/bin:$ENV:PATH" 
```

我专门添加了 linuxbrew (homebrew for linux) bin 目录以优先于已安装的系统。它帮助解决了我遇到的一个问题，虽然这是最有帮助的地方，但它也让我“实验”了。

请注意，这`:`是 Linux 路径分隔符，而在 Windows（或至少我的 Windows）上，您`;`通常会使用 powershell。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2021-09-17T13:14:12.470

[在@ali Darabi 的答案](https://stackoverflow.com/a/48113366/2234009)中编辑注册表项对我来说效果最好，但是当我没有从Powershell 执行此操作的正确权限时。所以我直接在regedit中编辑了。

我想在这个答案中进一步扩展这个主题。

重新启动 Powershell 也不足以传播更改。我必须打开任务管理器并重新启动 explorer.exe 才能触发重新加载注册表。

导航注册表可能非常繁琐，因此为了保持用户友好的体验，您可以从 Powershell 执行此操作：

```
REG ADD "HKCU\Software\Microsoft\Windows\CurrentVersion\Applets\Regedit" /v "LastKey" /d "HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\Environment" /f; regedit 
```

它将最后打开的窗口设置为某个注册表路径，以便下次打开 regedit 时它会以正确的键打开。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2021-12-13T09:40:56.953

如果您需要动态设置变量名称并且仅用于会话，请使用：

```
New-Item env:\$key -Value $value -Force | Out-Null 
```

# python - 如何在循环中打印对 subprocess.Popen(...) 的调用的输出？

> ID：714879
> 
> 赞同：4
> 
> 时间：2009-04-03T17:20:33.977
> 
> 标签：python, subprocess

我编写了一个脚本来运行具有不同输入参数的命令行程序，并从输出中获取特定的行。我有以下循环运行：

```
p1 = subprocess.Popen(["program", args], stderr=subprocess.STDOUT, stdout=subprocess.PIPE, shell=False)
p2 = subprocess.Popen(["grep", phrase], stdin=p1.stdout, stdout=subprocess.PIPE, shell=False)
p1.wait()
p2.wait()
p = str(p2.stdout.readlines())
print 'p is ', p 
```

一个问题是循环运行完成后只有输出。我想在每次进程完成时打印一些东西。我怎样才能做到这一点？

另外，我希望可以选择显示 p1 的输出。但是我不能在不破坏 p2 的情况下用 p1.stdout.readlines() 抓住它。我怎样才能做到这一点？

我在想我不能调用 grep，存储 p1 的输出并搜索短语，但是有很多输出，所以这种方式似乎效率很低。

任何建议将不胜感激。谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-05T08:11:14.293

这是一个在 Linux 上对我有用的快速 hack。根据您的要求，它可能对您有用。它使用[tee](http://unixhelp.ed.ac.uk/CGI/man-cgi?tee)作为过滤器，如果你传递`print_all`给你的脚本，它将复制一个额外的副本到[/dev/tty](http://linux.die.net/man/4/tty)（嘿，我说这是一个 hack）：

```
#!/usr/bin/env python

import subprocess
import sys

phrase = "bar"
if len(sys.argv) > 1 and sys.argv[1] == 'print_all':
    tee_args = ['tee', '/dev/tty']
else:
    tee_args = ['tee']

p1 = subprocess.Popen(["./program"], stderr=subprocess.STDOUT, stdout=subprocess.PIPE, shell=False)
p2 = subprocess.Popen(tee_args, stdin=p1.stdout, stdout=subprocess.PIPE, shell=False)
p3 = subprocess.Popen(["grep", phrase], stdin=p2.stdout, stdout=subprocess.PIPE, shell=False)
p1.wait()
p2.wait()
p3.wait()
p = str(p3.stdout.readlines())
print 'p is ', p 
```

将以下内容作为内容`program`：

```
#!/bin/sh

echo foo
echo bar
echo baz 
```

示例输出：

```
$ ./foo13.py
p 是 ['bar\n']
$ ./foo13.py print_all
富
酒吧
巴兹
p 是 ['bar\n']

```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T17:29:50.020

尝试在每个打印语句之后调用 sys.stdout.flush() 。

# python - 如何包含外部 Python 代码以在其他文件中使用？

> ID：714881
> 
> 赞同：124
> 
> 时间：2009-04-03T17:21:58.823
> 
> 标签：python

如果您在一个文件中有一组方法，有没有办法将这些文件包含在另一个文件中，但在没有任何前缀（即文件前缀）的情况下调用它们？

所以如果我有：

```
[Math.py]
def Calculate ( num ) 
```

我怎么称呼它：

```
[Tool.py]
using Math.py

for i in range ( 5 ) :
    Calculate ( i ) 
```

* * *

## 回答 #1

> 赞同：158
> 
> 时间：2009-04-03T17:24:28.427

您需要将另一个文件作为模块导入，如下所示：

```
import Math 
```

如果您不想在`Calculate`函数前面加上模块名称，请执行以下操作：

```
from Math import Calculate 
```

如果要导入模块的所有成员，请执行以下操作：

```
from Math import * 
```

**编辑：这是** [Dive Into Python](https://linux.die.net/diveintopython/html/toc/index.html)[的一个很好的章节](https://linux.die.net/diveintopython/html/object_oriented_framework/importing_modules.html)，对这个主题有更深入的了解。

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2013-05-17T08:15:42.207

只需编写“包含”命令：

```
import os

def include(filename):
    if os.path.exists(filename): 
        execfile(filename)

include('myfile.py') 
```

@删除：

@bfieck 评论是正确的，对于 python 2 和 3 的兼容性，您需要：

Python 2 和 3：备选方案 1

```
from past.builtins import execfile

execfile('myfile.py') 
```

Python 2 和 3：备选方案 2

```
exec(compile(open('myfile.py').read())) 
```

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2009-04-03T17:24:10.720

如果您使用：

```
import Math 
```

那么这将允许您使用 Math 的函数，但您必须执行 Math.Calculate，所以这显然是您不想要的。

如果你想导入一个模块的函数而不用加前缀，你必须明确地命名它们，比如：

```
from Math import Calculate, Add, Subtract 
```

现在，您可以仅通过名称来引用计算、加法和减法。如果您想从 Math 中导入所有函数，请执行以下操作：

```
from Math import * 
```

但是，在对内容不确定的模块执行此操作时，您应该非常小心。**如果您导入两个包含相同函数名称定义的模块，一个函数将覆盖另一个函数，而您不会更明智。**

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-11-11T23:34:50.430

我发现 python 检查模块非常有用

例如 teststuff.py

```
import inspect

def dostuff():
    return __name__

DOSTUFF_SOURCE = inspect.getsource(dostuff)

if __name__ == "__main__":

    dostuff() 
```

从另一个脚本或 python 控制台

```
import teststuff

exec(DOSTUFF_SOURCE)

dostuff() 
```

现在**dostuff**应该在本地范围内，并且**dostuff()**将返回控制台或脚本**_*名称*_**，而执行 test.dostuff() 将返回 python 模块名称。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-11-04T00:25:16.260

我想强调一个对我来说效果很好的评论中的答案。正如mikey所说，如果你想在'include'调用者的范围内包含文件中的变量，这将起作用，只需将其作为普通python插入即可。它的工作方式类似于 PHP 中的 include 语句。在 Python 3.8.5 中工作。

替代#1

```
import textwrap 
from pathlib import Path
exec(textwrap.dedent(Path('myfile.py').read_text())) 
```

替代#2

```
with open('myfile.py') as f: exec(f.read()) 
```

我更喜欢备选方案#2，并且一直在我的网站开发中使用它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-06-12T10:56:53.320

这很容易和简单：你可以这样做：

```
def run_file(path):
    return exec(open(path).read());

run_file("myfile.py"); 
```

# persist - 您如何处理需要持久化的一次性数据？

> ID：714885
> 
> 赞同：0
> 
> 时间：2009-04-03T17:22:56.153
> 
> 标签：persist

最近，有人要求我为网站管理员添加一些东西，他可以在其中“展示”一些东西。

对于本次讨论，假设它是“特色文章”。

所以很自然地，我们已经有了一个“文章”的数据库模型，它有大约 20 列，所以我真的不想再让它膨胀了。

我的选择：

1.  添加一个“特色”布尔（或整数），并意识到在任何给定时间只会展示一件事

2.  创建一个新模型来保存这个和任何其他可能弹出的特征蠕变项目。

3.  我采纳你的建议！;)

在这种情况下你会怎么做？我时不时地遇到这个问题，我只是讨厌不得不再增加一个专栏。确实需要保留此信息。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-03T17:27:19.013

我可能只是添加一个简单的两列表，它基本上是一个键值存储。然后添加一个新列，其值类似于`(featured_article_id, 45)`或任何第一个特色 ID。

编辑：正如 rmeador 在评论中指出的那样，应该注意的是，只要事情保持相对简单，这只是一个很好的解决方案。如果您需要存储更复杂的数据，请考虑找出更灵活的解决方案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-03T17:28:23.737

如果一次只能展示一篇文章，那么添加布尔列是一种浪费。您应该上一级并为 FeaturedArticleID 添加一列。您有 Site_Settings 表吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T17:26:31.120

您可以使用可扩展模型，例如拥有一个属性表，然后是一个链接表，以在文章和属性之间形成多对多关系。这样，这些类型的功能不需要修改架构。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-03T17:32:26.317

有某种带有 parameter_name 和 parameter_value 列的 global_settings 表。将特色文章 ID 放在这里。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-03T17:34:09.403

对于像这样的快速和肮脏的东西，我喜欢包含某种设置表：

```
CREATE TABLE Settings (
    SettingName NVARCHAR(250) NOT NULL,
    SettingValue NVARCHAR(250)
) 
```

如果您需要每个用户或每个客户的设置，而不是全局设置，您可以添加一列以将其标识给该特定用户/客户。然后，您可以为“FeaturedArticle”添加一行并从字符串中解析 ID。它不是超级优化的，但纯文本非常灵活，这听起来正是您所需要的。

# c# - 虚拟事件如何在 C# 中工作？

> ID：714893
> 
> 赞同：10
> 
> 时间：2009-04-03T17:26:22.493
> 
> 标签：c#, events, compiler-construction

下面是我用于测试的程序。它打印（如预期）：

```
Raise A
Event from A
Raise B
Event from B 
```

现在，如果我们将 Main 的前两行更改为：

```
 A a = new B();
        B b = new B(); 
```

该程序将打印：

```
Raise A
Raise B
Event from B 
```

这也是意料之中的，因为覆盖事件隐藏了基类中的私有支持字段，因此基类触发的事件对派生类的客户端不可见。

现在我将相同的行更改为：

```
 B b = new B();
 A a = b; 
```

程序开始打印：

```
Raise A
Raise B
Event from A
Event from B 
```

这是怎么回事？

```
class A
{
    public virtual event EventHandler VirtualEvent;
    public void RaiseA()
    {
        Console.WriteLine("Raise A");
        if (VirtualEvent != null)
        {
            VirtualEvent(this, EventArgs.Empty);
        }
    }
}
class B : A
{
    public override event EventHandler VirtualEvent;
    public void RaiseB()
    {
        Console.WriteLine("Raise B");             
        if (VirtualEvent != null)
        {
            VirtualEvent(this, EventArgs.Empty);
        }
    }
}

class Program
{
    static void Main(string[] args)
    {
        A a = new A();
        B b = new B();

        a.VirtualEvent += (s, e) => Console.WriteLine("Event from A");
        b.VirtualEvent += (s, e) => Console.WriteLine("Event from B");

        a.RaiseA();
        b.RaiseB();
    }
} 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-03T17:36:38.087

我们有一个（B）实例，它具有以下字段：

*   A.VirtualEvent：空
*   B.VirtualEvent：两个事件处理程序

`a.RaiseA()` *只*打印“Raise A”的调用- 但仅此而已，因为 A 中的私有字段为空。

调用`b.RaiseB()`打印剩余的三行，因为该事件已被订阅两次（一次打印“来自 A 的事件”，一次打印“来自 B 的事件”）。

这有帮助吗？

编辑：为了更清楚 - 将虚拟事件视为一对虚拟方法。非常像这样：

```
public class A
{
    private EventHandler handlerA;

    public virtual void AddEventHandler(EventHandler handler)
    {
        handlerA += handler;
    }

    public virtual void RemoveEventHandler(EventHandler handler)
    {
        handlerA -= handler;
    }

    // RaiseA stuff
}

public class B : A
{
    private EventHandler handlerB;

    public override void AddEventHandler(EventHandler handler)
    {
        handlerB += handler;
    }

    public override void RemoveEventHandler(EventHandler handler)
    {
        handlerB -= handler;
    }

    // RaiseB stuff
} 
```

现在更清楚了吗？情况并非*如此*，因为据我所知，您不能仅覆盖事件的“部分”（即其中一种方法），但它给人的总体印象是正确的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-03T17:36:31.300

您将两个事件处理程序连接到同一个事件。由于 A 和 B 指向同一个对象，因此当您调用 b.RaiseB() 时，两个事件处理程序都会被触发。所以首先你调用 RaiseA 这是一个基本方法。这会打印 Raise A。然后它实际上并没有触发事件，因为它是空的。然后，您正在提升 B，但有*两个*处理程序连接到它，因此它首先打印 Raise B，当事件触发时，两个处理程序都会被调用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T17:40:49.637

尝试使您的 RaiseA 功能受保护 + 虚拟。

经验法则：如果派生类覆盖事件访问器，它也必须覆盖调用事件的函数。

# iphone - 如何指定通知发送者？（可可触摸）

> ID：714896
> 
> 赞同：0
> 
> 时间：2009-04-03T17:27:05.223
> 
> 标签：iphone, cocoa-touch, nsnotifications, addobserver

我能找到的所有设置通知的示例如下所示：

[nc addObserver:self selector:@selector(keyboardWillShow:) name: UIKeyboardWillShowNotification object:nil];

其中对象始终设置为零。object 是 notificationSender，在文档中是这样定义的：

“观察者想要接收其通知的对象；也就是说，只有这个发送者发送的通知才会传递给观察者。当为 nil 时，通知中心不使用通知的发送者来决定是否将其传递给观察者。”

我只想为一个特定的文本视图接收键盘通知，所以我想告诉 addObserver ，但我不知道为对象提供什么。我尝试了绑定到我感兴趣的文本视图的出口变量，但这只是导致我根本没有收到任何通知。

有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-03T17:59:12.977

`UIKeyboardWillShowNotification`来自您的窗口实例，并且出于所有意图和目的是“系统”通知。键盘显示或不显示，它并不是与特定控件绑定的东西。

如果您想在用户输入特定文本字段时执行某些操作，您可能应该在文本字段的委托中控制它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T17:56:59.520

在这种情况下，您无法仅获得一个特定文本视图的通知，因为 UIKeyboardWillShowNotification 的文档说“通知对象为零。”。

如果您的特定文本视图是FirstResponder，您必须检查您的keyboardWillShow impl。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-04T00:42:39.013

我有两个相互竞争的需求 - 我必须使用键盘通知，因为我需要获取键盘高度，这似乎只能通过这种方式获得，但我还需要知道我在哪个文本视图中，这意味着还需要使用 textViewDidBeginEditing代表。经过一番折腾后，我终于求助于在通知方法中获取键盘高度并将其存储在实例变量中，然后可以在委托方法中使用（我需要向上滚动视图，因此底部文本视图不是大部分当他们开始打字时隐藏在他们的键盘下）。有点不雅，但它有效。

谢谢指点！

# linux - 是否可以在 Linux x86 GAS 程序集中创建没有系统调用的线程？

> ID：714905
> 
> 赞同：41
> 
> 时间：2009-04-03T17:31:43.667
> 
> 标签：linux, multithreading, assembly, gnu-assembler

在学习“汇编语言”（在 x86 架构的 linux 中，使用 GNU 作为汇编器）的同时，一个令人惊叹的时刻是使用[系统调用](http://www.ibm.com/developerworks/linux/library/l-system-calls/)的可能性。[当您的程序在用户空间中运行时，](http://en.wikipedia.org/wiki/Kernel_mode#Supervisor_mode)这些系统调用非常方便，有时甚至是必要的。
然而，系统调用在性能方面相当昂贵，因为它们需要中断（当然还有系统调用），这意味着必须从用户空间中的当前活动程序到内核空间中运行的系统进行上下文切换。

我想说的是：我目前正在实现一个编译器（用于大学项目），我想添加的额外功能之一是对多线程代码的支持，以提高编译程序的性能. 因为一些多线程代码将由编译器自己自动生成，这几乎可以保证其中也会有非常少量的多线程代码。为了获得性能上的胜利，我必须确保使用线程会实现这一点。

然而，我担心的是，为了使用线程，我*必须*进行系统调用和必要的中断。因此，微小的（自动生成的）线程将受到进行这些系统调用所需时间的高度影响，甚至可能导致性能损失......

**因此，我的问题是双重的（下面有一个额外的奖励问题）：**

*   是否可以编写可以同时在多个内核上同时运行多个线程而无需系统调用的汇编*代码*？
*   如果我有非常小的线程（就像线程的总执行时间一样小），性能损失，或者根本不值得付出努力，我会获得性能提升吗？

我的猜测是，如果没有系统调用，多线程汇编代码是*不可能的。*即使是这种情况，您是否有建议（甚至更好：一些真实的代码）来尽可能高效地实现线程？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-06-15T08:45:44.073

简短的回答是你不能。当您编写汇编代码时，它会在一个且仅一个逻辑（即硬件）线程上按顺序（或使用分支）运行。如果您希望某些代码在另一个逻辑线程上执行（无论是在同一个内核上，在同一个 CPU 上的不同内核上，甚至在不同 CPU 上），您需要让操作系统设置另一个线程的指令指针 ( `CS:EIP`) 指向您要运行的代码。这意味着使用系统调用来让操作系统做你想做的事。

用户线程不会为您提供所需的线程支持，因为它们都运行在同一个硬件线程上。

**编辑：**将 Ira Baxter 的答案与*Parlanse*结合起来。如果您确保您的程序在开始时每个逻辑线程中都有一个线程运行，那么您可以构建自己的调度程序而不依赖于操作系统。无论哪种方式，您都需要一个调度程序来处理从一个线程到另一个线程的跳跃。在调用调度程序之间，没有特殊的汇编指令来处理多线程。调度器本身不能依赖任何特殊的程序集，而是依赖于每个线程中调度器部分之间的约定。

无论哪种方式，无论您是否使用操作系统，您仍然必须依赖一些调度程序来处理跨线程执行。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-06-16T04:48:33.080

“医生，医生，我这样做的时候很痛”。医生：“不要那样做”。

简短的回答是您可以在不调用昂贵的操作系统任务管理原语的情况下进行多线程编程。只需忽略操作系统进行线程调度操作。这意味着您必须编写自己的线程调度程序，并且永远不会将控制权交还给操作系统。（而且你必须比相当聪明的操作系统家伙更聪明地处理你的线程开销）。我们之所以选择这种方法，正是因为 Windows 进程/线程/光纤调用都太昂贵，无法支持数百条指令的计算粒度。

我们的 PARLANSE 编程语言是一种并行编程语言：参见[http://www.semdesigns.com/Products/Parlanse/index.html](http://www.semdesigns.com/Products/Parlanse/index.html)

PARLANSE 在 Windows 下运行，提供并行“grains”作为抽象并行结构，并通过高度调整的手写调度程序和 PARLANSE 编译器生成的调度代码的组合来调度此类grain，该编译器考虑grain 的上下文以最小化调度高架。例如，编译器确保grain 的寄存器在可能需要调度（例如，“等待”）时不包含任何信息，因此调度程序代码只需要保存PC 和SP。事实上，调度程序代码通常根本无法控制。分叉的grain 只存储分叉的PC 和SP，切换到编译器预分配的堆栈并跳转到grain 代码。谷物的完成将重新启动分叉器。

通常有一个联锁来同步颗粒，由编译器使用本机 LOCK DEC 指令实现，该指令实现相当于计数信号量的内容。应用程序可以在逻辑上分叉数百万个谷子；如果工作队列足够长，那么调度程序会限制父颗粒产生更多的工作，因此更多的工作将无济于事。调度程序实现了工作窃取，以允许工作匮乏的 CPU 从相邻的 CPU 工作队列中获取准备好的颗粒。这已实现处理多达 32 个 CPU；但我们有点担心 x86 供应商实际上可能会在未来几年内使用更多的东西！

PARLANSE 是一门成熟的语言；我们从 1997 年开始使用它，并在其中实现了数百万行并行应用程序。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-03T17:38:11.607

实现用户模式线程。

历史上，线程模型被概括为 N:M，也就是说 N 个用户模式线程运行在 M 个内核模型线程上。现代使用是 1:1，但并非总是如此，也不必如此。

您可以自由地在单个内核线程中维护任意数量的用户模式线程。只是你有责任在它们之间进行足够频繁的切换，以使它们看起来是并发的。您的线程当然是合作的，而不是先发制人的；您基本上在自己的代码中分散了 yield() 调用，以确保发生定期切换。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-10T14:49:37.293

如果你想获得性能，你将不得不利用内核线程。只有内核可以帮助您让代码在多个 CPU 内核上同时运行。除非您的程序受 I/O 限制（或执行其他阻塞操作），否则执行用户模式协作多线程（也称为[Fiber](http://en.wikipedia.org/wiki/Fiber_(computer_science))）不会为您带来任何性能。您将只是执行额外的上下文切换，但您的真实线程正在运行的一个 CPU 仍将以 100% 的方式运行。

系统调用变得更快了。现代 CPU 支持该`sysenter`指令，该指令比旧`int`指令快得多。另请参阅[这篇文章](http://www.trilithium.com/johan/2005/08/linux-gate/)，了解 Linux 如何以最快的方式进行系统调用。

确保自动生成的多线程让线程运行足够长的时间以获得性能。不要试图并行化一小段代码，你只会浪费时间生成和加入线程。还要注意内存效应（尽管这些效应更难测量和预测）——如果多个线程正在访问独立的数据集，由于[缓存一致性](http://en.wikipedia.org/wiki/Cache_coherency)问题，它们的运行速度将比它们重复访问相同数据的速度快得多。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-10T14:39:15.400

首先，您应该学习如何在 C 中使用线程（pthreads、POSIX theads）。在 GNU/Linux 上，您可能想要使用 POSIX 线程或 GLib 线程。然后你可以简单地从汇编代码中调用 C。

这里有一些提示：

*   Posix 线程：[链接文本](https://computing.llnl.gov/tutorials/pthreads/)
*   您将学习如何从程序集中调用 C 函数的教程：[链接文本](http://www.drpaulcarter.com/pcasm/)
*   Butenhof 关于 POSIX 线程的书[链接文本](https://www.amazon.fr/Programming-POSIX-Threads-David-Butenhof-ebook/dp/B006QTHCJ6/ref=sr_1_2?ie=UTF8&qid=1526418669&sr=8-2&keywords=posix%20threads%20butenhof)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-10T14:44:59.973

系统调用现在并没有那么慢，使用`syscall`或`sysenter`代替`int`. 不过，只有在创建或销毁线程时才会有开销。一旦它们运行，就没有系统调用。用户模式线程不会真正帮助您，因为它们只在一个内核上运行。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2016-10-14T01:47:37.343

现在有点晚了，但我自己对这种话题很感兴趣。事实上，除了并行化/性能之外，没有什么特别需要内核干预的线程。

**强制 BLUF**：

Q1：不需要。至少需要初始系统调用才能跨各种 CPU 内核/超线程创建多个内核线程。

Q2：视情况而定。如果您创建/销毁执行微小操作的线程，那么您就是在浪费资源（线程创建过程将大大超过踏板在退出之前使用的时间）。如果您创建 N 个线程（其中 N 是系统上的 ~# of cores/hyper-threads）并重新分配它们，那么答案可能是肯定的，具体取决于您的实现。

Q3：如果您提前知道精确的操作排序方法，您可以优化操作。具体来说，您可以创建相当于 ROP 链的内容（或前向调用链，但这实际上可能最终实现起来更复杂）。这个 ROP 链（由线程执行）将连续执行“ret”指令（到它自己的堆栈），其中该堆栈被连续添加（或在它滚动到开头的情况下添加）。在这样一个（奇怪的！）模型中，调度程序保留一个指向每个线程的“ROP 链末端”的指针，并向其写入新值，从而代码在内存中循环执行函数代码，最终导致 ret 指令。同样，这是一个奇怪的模型，但仍然很有趣。

在我价值 2 美分的内容上。

我最近通过管理各种堆栈区域（通过 mmap 创建）并维护一个专用区域来存储“线程”的控制/个性化信息，创建了在纯汇编中有效地作为线程运行的东西。尽管我没有这样设计，但可以通过 mmap 创建一个大块内存，我将其细分为每个线程的“私有”区域。因此，只需要一个系统调用（尽管它们之间的保护页面很聪明，但它们需要额外的系统调用）。

此实现仅使用进程产生时创建的基本内核线程，并且在整个程序执行过程中只有一个用户模式线程。程序通过内部控制结构更新自己的状态并自行安排。I/O 等在可能的情况下通过阻塞选项处理（以降低复杂性），但这不是严格要求的。当然，我使用了互斥锁和信号量。

要实现这个系统（完全在用户空间中，如果需要也可以通过非 root 访问），需要以下内容：

线程归结为的概念： 堆栈操作的堆栈（有点自我解释和明显） 一组要执行的指令（也很明显） 一小块内存，用于保存单个寄存器内容

调度程序归结为：调度程序指定的有序列表（通常是优先级）中一系列线程的管理器（请注意，进程从不实际执行，只是它们的线程执行）。

线程上下文切换器：注入到代码的各个部分（我通常将它们放在重型函数的末尾）的宏，大致相当于“线程屈服”，它保存线程的状态并加载另一个线程的状态。

因此，确实有可能（完全在汇编中并且除了初始 mmap 和 mprotect 之外没有系统调用）在非根进程中创建用户模式线程状构造。

我只添加了这个答案，因为您特别提到了 x86 程序集，而这个答案完全是通过一个完全用 x86 程序集编写的自包含程序得出的，该程序实现了最小化系统调用和最小化系统端线程的目标（减去多核功能）高架。

# .net - 如何从 GAC 中提取程序集？

> ID：714907
> 
> 赞同：137
> 
> 时间：2009-04-03T17:32:26.333
> 
> 标签：.net, assemblies

我必须处理一个包，它可以将程序集直接安装到 GAC 中（例如，在 %windows%/assembly 深处的某个地方）。

如何将 GAC 中的实际程序集（DLL）驱除到普通文件系统中？

谢谢。

* * *

## 回答 #1

> 赞同：151
> 
> 时间：2009-04-03T17:36:00.333

我使用[本文](http://blogs.msdn.com/akukreja/archive/2008/05/23/get-dll-out-of-the-gac.aspx)中的建议从 GAC 获取程序集。

> **从 GAC 中获取 DLL**
> 
> 在 GAC 中部署的 DLL（通常位于 c:\windows\assembly）不能作为普通 DLL 文件查看或使用。它们不能直接从 VS 项目中引用。开发人员通常保留一份原始 DLL 文件的副本，并在开发（设计）时在项目中引用它，在项目运行时使用来自 GAC 的程序集。
> 
> 在执行期间（运行时），如果发现程序集已在 GAC 中签名和部署，CLR 会自动从 GAC 中获取程序集，而不是在 VS 中的设计时引用的 DLL。如果开发人员删除了原始 DLL 或由于某种原因没有它，有一种方法可以从 GAC 获取 DLL 文件。按照以下步骤从 GAC 复制 DLL
> 
> 1.  运行 regsvr32 /u C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\shfusion.dll
>     
>     
>     *   shfusion.dll 是一个资源管理器扩展 DLL，它为 GAC 文件夹提供了独特的外观。取消注册此文件将删除程序集缓存查看器，然后 GAC 文件夹将与资源管理器中的任何普通文件夹一样可见。
> 2.  打开“%windir%\assembly\GAC_MSIL”。
>     
>     
> 3.  浏览到您的 DLL 文件夹，进入深处以找到您的 DLL。
>     
>     
> 4.  将 DLL 复制到硬盘上的某个位置，然后在项目中引用它
>     
>     
> 5.  运行“regsvr32 %windir%\Microsoft.NET\Framework\<.NET版本目录>\shfusion.dll”重新注册shfusion.dll文件，恢复GAC原有的清晰视图。

* * *

## 回答 #2

> 赞同：108
> 
> 时间：2009-04-03T17:38:20.080

这里描述的方法非常简单：

[http://andreasglaser.net/post/2008/08/05/Extract-assembly-from-Global-Assembly-Cache-(GAC)-with-network-drive-mapping.aspx](http://andreasglaser.net/post/2008/08/05/Extract-assembly-from-Global-Assembly-Cache-(GAC)-with-network-drive-mapping.aspx)

**文章摘要：**

*   映射网络驱动器（资源管理器 -> 工具）
    *   映射到 \servername\folder ( `\\YourServer\C$\Windows\Assembly`)
*   如果您是管理员，则无需共享
*   浏览到驱动器并提取您的程序集

* * *

## 回答 #3

> 赞同：93
> 
> 时间：2010-06-09T20:42:01.520

打开命令提示符并键入：

```
cd  c:\windows\assembly\GAC_MSIL 

xcopy . C:\GacDump /s /y 
```

这应该会转储整个 GAC

享受！

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2009-04-03T17:37:58.363

是的。

添加 DisableCacheViewer 注册表项

在 HKLM\Software\Microsoft\Fusion\ 下创建一个名为 DisableCacheViewer 的新双字键，并将其 [DWORD] 值设置为 1。

返回到 Windows 资源管理器的程序集文件夹，它将是正常的文件系统视图。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2009-04-03T17:47:55.313

我认为最简单的方法是像大卫提到的那样通过命令行来完成。唯一的技巧是 .dll 不仅仅位于 C:\Windows\Assembly。您必须导航到 C:\Windows\Assembly\GAC\[ASSEMBLY_NAME]\[VERSION_NUMBER]_[PUBLIC KEY]。然后，您可以使用以下方法进行复制：

复制 [ASSEMBLY_NAME].dll c:\ （或您想要的任何位置）

希望有帮助。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2009-04-03T17:34:34.910

我发现的简单方法是打开命令提示符并浏览您提到的文件夹，直到找到所需的 DLL - 然后您可以使用复制命令将其取出。Windows 资源管理器具有此文件夹的“有用”特殊视图。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2017-07-08T13:21:47.980

打开**RUN**然后输入`%windir%\assembly\GAC_MSIL`，这将在文件夹视图中打开您的 dll，然后您可以导航到您的 dll 命名文件夹并打开它，您将找到您的 dll 文件并轻松复制它

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2013-04-21T20:09:42.837

我是[PowerShell GAC](https://powershellgac.codeplex.com/)的作者。使用 PowerShell GAC，您可以从 GAC 中提取程序集，而无需依赖 GAC 内部，例如更改文件夹结构。

```
Get-GacAssembly SomeCompany* | Get-GacAssemblyFile | Copy-Item -Dest C:\Temp\SomeCompany 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2010-01-28T14:36:06.047

这篇[MSDN 博客](http://blogs.msdn.com/johnwpowell/archive/2009/01/14/how-to-copy-an-assembly-from-the-gac.aspx)文章描述了从 GAC 中提取 DLL 的三种不同方法。迄今为止给出的方法的有用总结。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2012-08-27T12:33:05.367

请改用文件浏览器“Total Commander”。

1.  在 Total Commander 中启用“显示隐藏/系统文件”设置
2.  浏览到“c:\windows\assembly”
3.  复制

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2015-11-11T19:26:09.613

我想我找到了一种无需修改注册表或使用命令行、powershell 或任何其他程序即可查看 GAC 内部的方法：

创建一个新的快捷方式（到任何地方）。然后修改快捷方式以使目标为：

```
%windir%\assembly\GAC_MSIL\System 
```

打开此快捷方式会将您带到 GAC 内的 System 文件夹（每个人都应该拥有），并具有让您切换到更高目录然后浏览到您想要的任何其他文件夹（并查看 dll 文件等）的美妙副作用

我在 Windows 7 和 Windows Server 2012 上对此进行了测试。

注意：它不会让您在创建快捷方式时使用该目标，但允许您对其进行编辑。

享受！

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2010-04-20T08:52:55.117

只需导航到 C:\Windows 找到 [程序集] 文件夹右键单击并选择添加到存档

等一下

vola 你有一个存档文件，其中包含 GAC 中的所有程序集

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2013-01-25T09:51:31.087

从一个 Powershell 脚本，你可以试试这个。我在 GAC 中只有一个版本的程序集，所以它工作得很好。

```
cd "c:\Windows\Microsoft.NET\assembly\GAC_MSIL\"
Get-ChildItem assemblypath -Recurse -Include *.dll |  Copy-Item -Destination "c:\folder to copy to" 
```

其中汇编路径可以使用通配符。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-07-13T19:44:58.193

另一个方向 - 只需解压缩 MSI 文件并以这种方式获取好东西。使您免于最终卸载。. .

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-10-09T22:37:06.460

从命令行复制是不必要的。我从开始窗口搜索中输入了 DLL 的名称。我选择了查看更多结果。GAC 中的那个在搜索窗口中返回。我右键单击它并说打开文件位置。它在普通的 Windows 资源管理器中打开。我复制了文件。我关上了窗户。完毕。

# version-control - Maven 2 项目版本、依赖版本和永久发布

> ID：714909
> 
> 赞同：3
> 
> 时间：2009-04-03T17:33:09.700
> 
> 标签：version-control, maven-2

场景：系统有许多组件，每个组件都有自己的 POM。有一些很长的依赖链（A 依赖于 B 依赖于 C，等等）。我希望每个“非开发人员桌面”构建都成为潜在的候选发布版本——如果它通过了 QA，我们将在不重新构建的情况下部署它。换句话说，我从不想构建 SNAPSHOT 版本作为我定期构建的一部分，只有 1.3.0.5、1.3.0.6 等版本。我还想让开发人员能够同时处理多个组件。

为了阻止一些预期的建议：Maven Release Plugin 对我没有帮助......除非有一些神奇的方式我可以让我的依赖版本不是 POM 中的 SNAPSHOT，但仍然让开发人员同时处理多个组件？

**我们应该如何管理我们所有 POM 中的项目和依赖版本？** 现在它只是随处可见的 SNAPSHOT，这使开发人员的事情变得简单（他们从 SNAPSHOT 开始，从不关心其他任何事情）。但在部署时令人担忧（具有 SNAPSHOT 依赖项的构建没有明确定义，并且不可重现）。

我想避免在构建时过度杂耍，但现在我看不到任何解决办法。

假设我有组件 util、libj、libk、APP 和 UI，其依赖关系如下：

libj -> util（libj 依赖于 util）

库 -> 实用程序

应用程序-> libj

UI -> libj，libk

我有开发团队在 APP 和 UI 上工作，他们有时需要对一些依赖项（甚至是 util）进行更改/添加，以启用他们当前的工作。每个组件的签入 POM 和依赖版本应该是怎样的？

编辑：我更新了标题以引用 Maven 2 而不是 2.0，因为很明显我需要使用 2.1 或更好的版本才能最好地解决这个问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-26T01:19:14.100

尝试对构建进行布局，以便需要一起开发的模块一起发布。这将使 maven 发布插件为您完成大部分工作。

对于真正应该具有单独生命周期的依赖项...因为它们不经常更改或由多个项目共享，您希望以不同的方式处理它们。我这样做的方法是将依赖项保留在最后一个版本，直到更改实际上需要升级到下一个快照。这样当你去发布产品的时候，只要按照快照的轨迹，你就会发现所有可能发布的东西。

我发现将外部依赖版本指定为项目顶部 pom 中的属性也很有帮助。这使得一目了然地看到需要发布的内容很容易。[查找Nexus](http://nexus.sonatype.org) pom的示例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T21:31:50.410

这是我发现 Maven 和内部项目非常困难的事情；你有两个版本控制系统（maven，坦率地说，不是很好）和你的源代码控制（假设它是 CVS 或更好的，支持真正的工作流程）。

我们是这样做的：

```
report --depends on--> core
web    --depends on--> core 
```

我们使用 maven 发布插件：

在开发过程中，报告的 pom 将具有与核心 pom 中的内容匹配的 SNAPSHOT 版本。我做了一个核心，然后我可以在我的本地环境中`mvn clean install`看到这些变化。`report`

当我发布报告时，我必须首先通过 maven 发布插件发布核心。当我在核心上使用它时，它要求我设置要发布的核心版本（即删除 -SNAPSHOT），我说是，并且最终发布的工件不依赖于 SNAPSHOT 版本。当发布插件完成后，report pom 现在依赖于核心的下一个 SNAPSHOT 版本（尽管`mvn release:prepare`如果需要，您可以在此期间覆盖它）。

然后，网络上的开发人员会收到一封电子邮件，说明有新版本的核心可用，如果他们愿意，他们可以选择使用它。我们的政策是他们应该在发布前更新。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T18:01:43.393

这与需要对他们正在处理的代码进行分支的人确实是同一个问题。您需要某种形式的标识符才能获得特定版本，直到您合并回该组件的主线开发。

[依赖分类器](http://maven.apache.org/pom.html#Dependencies)可能是值得研究的东西。您仍然需要有能够正确识别他们修改过的代码的开发人员。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-03T18:47:01.117

我们使用“超级父”.pom-project，其中版本被定义为属性，并且在每个 child.project 中，版本都是使用这些属性设置的

此外，真正的项目没有版本集，而是从其父 pom 项目（包括 groupId 等）继承它

通过这种设置，版本仅在某些父 pom 项目中定义，因此所需的设置被最小化

例如这个结构

*   超级父 pom-project（所有第 3 方版本作为属性定义，例如 2.5.6 spring-framework）---- persistence-parent pom-project，全部继承自超级父 ------ persistence-foobar jar 项目，继承自persistence-parent ---- util-parent

等等

您看到的唯一版本是父关系示例中的版本：

> ```
>  <modelVersion>4.0.0</modelVersion>
> <artifactId>foo-bar-foo</artifactId>
> <packaging>jar</packaging>
> <name>whatever</name>
> <description>...</description>
> <parent>
>     <groupId>org.foo.bar</groupId>
>     <artifactId>persistence-parent</artifactId>
>     <version>1.0-SNAPSHOT</version>
> </parent>
> <dependencies>
>     <dependency>
>         <groupId>${project.groupId}</groupId>
>         <artifactId>foo-bar</artifactId>
>         <version>${project.version}</version>
>     </dependency>
>     <dependency>
>         <groupId>${project.groupId}</groupId>
>         <artifactId>foo-bar</artifactId>
>         <version>${project.version}</version>
>         <scope>test</scope>
>     </dependency>
>     <dependency>
>         <groupId>org.springframework</groupId>
>         <artifactId>org.springframework.jdbc</artifactId>
>         <version>${parent.spring.version}</version>
>     </dependency> 
> ```

它是这样工作的，因为在 pom 中你可以使用已经定义的值，比如版本，即使版本是通过继承设置的

我们将其与父项目中的模块设置结合起来，使构建更容易

# asp.net - 从 WCF 服务中查找 App_Data 路径

> ID：714910
> 
> 赞同：0
> 
> 时间：2009-04-03T17:33:31.073
> 
> 标签：asp.net, wcf

我正在尝试编写一个 WCF 函数，它可以返回 App_Data 文件夹中图像的 URI，以便我可以在 silverlight 应用程序中显示它。

如何获取 App_Data 文件夹的位置，以便在其中搜索以找到要显示的图像？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T17:36:49.100

[在 WCF 服务中访问 App_Data](https://stackoverflow.com/questions/480504/access-appdata-in-wcf-service)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T17:39:36.503

尝试： `HttpContext.Current.Server.MapPath("~/App_Data")`

# linux - 在 shell 脚本中使用 passwd 命令

> ID：714915
> 
> 赞同：75
> 
> 时间：2009-04-03T17:34:53.410
> 
> 标签：linux, bash, unix, shell

我正在编写一个 shell 脚本来自动添加一个新用户并更新他们的密码。我不知道如何让 passwd 从 shell 脚本中读取，而不是交互式地提示我输入新密码。我的代码如下。

```
添加用户 $1
密码 $1
2美元
2美元
```

* * *

## 回答 #1

> 赞同：100
> 
> 时间：2009-04-03T17:41:35.313

来自“ `man 1 passwd`”：

```
 --stdin
          This option is used to indicate that passwd should read the new
          password from standard input, which can be a pipe. 
```

所以在你的情况下

```
adduser "$1"
echo "$2" | passwd "$1" --stdin 
```

[**更新**]评论中提出了一些问题：

您的`passwd`命令可能没有`--stdin`选项：按照[ashawley](https://stackoverflow.com/questions/714915/using-the-passwd-command-from-within-a-shell-script/715802#715802)`chpasswd` 的建议使用该实用程序。

如果您使用 bash 以外的 shell，“echo”可能不是内置命令，shell 将调用`/bin/echo`. 这是不安全的，因为密码将显示在进程表中，并且可以使用`ps`.

在这种情况下，您应该使用另一种脚本语言。这是 Perl 中的一个示例：

```
#!/usr/bin/perl -w
open my $pipe, '|chpasswd' or die "can't open pipe: $!";
print {$pipe} "$username:$password";
close $pipe 
```

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2012-08-03T00:56:58.963

唯一的解决方案适用于 Ubuntu 12.04：

```
echo -e "new_password\nnew_password" | (passwd user) 
```

但是第二个选项仅在我从以下位置更改时才有效：

```
echo "password:name" | chpasswd 
```

到：

```
echo "user:password" | chpasswd 
```

请参阅原始帖子中的解释：[通过脚本更改密码](http://en.kioskea.net/faq/790-changing-password-via-a-script)

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2013-11-02T19:08:10.490

现在，您可以使用以下命令：

```
echo "user:pass" | chpasswd 
```

* * *

## 回答 #4

> 赞同：28
> 
> 时间：2009-04-03T20:48:41.573

阅读以下明智的话：

*   [http://mywiki.wooledge.org/BashFAQ/078](http://mywiki.wooledge.org/BashFAQ/078)

我引用：

> 您在 bash 中可以做的任何事情都不可能奏效。passwd(1) 不从标准输入读取。这是故意的。这是为了保护你。密码从未打算放入程序或由程序生成。它们只能由具有功能性大脑的真实人类的手指输入，并且永远不会在任何地方写下来。
> 
> 尽管如此，我们还是有成群的用户询问他们如何才能绕过 35 年的 Unix 安全性。

它继续解释如何`shadow(5)`正确设置密码，并向您展示 GNU *-I-only-care-about-security-if-it-doesn't-make-me-think-too-* much-滥用方式`passwd(1)`.

最后，如果您打算使用愚蠢的 GNU passwd(1) 扩展`--stdin`，**请不要**将密码放在命令行中。

```
echo $mypassword | passwd --stdin # Eternal Sin.
echo "$mypassword" | passwd --stdin # Eternal Sin, but at least you remembered to quote your PE.
passwd --stdin <<< "$mypassword" # A little less insecure, still pretty insecure, though.
passwd --stdin < "passwordfile" # With a password file that was created with a secure `umask(1)`, a little bit secure. 
```

最后一个是你可以用 GNU 做的最好的事情`passwd`。虽然我还是不推荐。

将密码放在命令行上意味着任何人甚至可以通过最远程的提示访问该框，从而可以监视`ps`或窃取密码。即使你认为你的盒子是安全的；这是您**真正**应该养成不惜一切代价避免的习惯（是的，即使是为了完成工作而付出更多麻烦的代价）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-05-04T21:39:51.430

对于那些需要通过脚本登录到 sudoers 文件中的用户帐户远程“以 root 身份运行”的人，我发现了一个邪恶的可怕黑客，这无疑是非常不安全的：

```
sshpass -p 'userpass' ssh -T -p port user@server << EOSSH
sudo -S su - << RROOT
userpass
echo ""
echo "*** Got Root ***"
echo ""
#[root commands go here]
useradd -m newuser
echo "newuser:newpass" | chpasswd
RROOT
EOSSH 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2020-05-31T05:32:48.107

*如果您`passwd`不支持并且由于某种原因`--stdin`不想（或不能）使用， *Here-document有效。*`chpasswd`*

 ***例子：**

```
#!/usr/bin/env bash

username="user"
password="pass"

passwd ${username} << EOD
${password}
${password}
EOD 
```

在 Arch Linux 下测试。这`passwd`是包的一个元素`shadow-utils`并从`core/filesystem`包中安装，您通常默认拥有它，因为`core/base`.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-03T17:49:38.740

在我为这类事情保留的 CentOS VMWare 映像上对此进行了测试。请注意，您可能希望避免将密码作为命令行参数，因为整个机器上的任何人都可以从“ps -ef”中读取它们。

也就是说，这将起作用：

```
user="$1"
password="$2"
adduser $user
echo $password | passwd --stdin $user 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-04-08T10:18:35.070

你可以使用 chpasswd

`echo $1:$2 | chpasswd`

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-03T17:43:33.547

您是否查看过（哪个 AFAIK 只是另一个名称）的`-p`选项？您可能还想查看使用明文密码的选项，但我不知道它是否是标准命令（它可能是 SE Linux 的一部分，或者可能只是 Fedora 的一个奇怪之处）。`adduser``useradd``-P``luseradd``luseradd`

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-07-07T09:33:43.707

有时设置一个没人知道的密码很有用。这似乎有效：

```
tr -dc A-Za-z0-9 < /dev/urandom | head -c44 | passwd --stdin $user 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-03-12T22:16:19.057

我偶然发现了同样的问题，由于某种原因，该`--stdin`选项在我使用的版本上不可`passwd`用（在 Ubuntu 14.04 中提供）。

如果你们中的任何人碰巧遇到同样的问题，您可以像我一样使用以下`chpasswd`命令来解决它：

```
echo "<user>:<password>" | chpasswd 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-06-02T23:06:18.320

这是 teradata 节点管理员的明确答案。

转到您的`/etc/hosts`文件并在文本文件中创建 IP 或节点名称列表。

```
SMP007-1
SMP007-2
SMP007-3 
```

将以下脚本放入文件中。

```
#set a password across all nodes
printf "User ID: "
read MYUSERID
printf "New Password: "
read MYPASS

while read -r i; do
    echo changing password on "$i"
    ssh root@"$i" sudo echo "$MYUSERID":"$MYPASS" | chpasswd
    echo password changed on "$i"
done< /usr/bin/setpwd.srvrs 
```

好的，我知道我已经使用 ssh 和 root 破坏了基本的安全规则，但我会让安全人员来处理它。

现在把它和​​你的配置文件`/usr/bin`一起放在你的子目录中。`setpwd.srvrs`

当您运行该命令时，它会提示您一次输入用户 ID，然后一次提示您输入密码。然后脚本遍历`setpwd.srvrs`文件中的所有节点并对每个节点进行无密码 ssh，然后设置密码，无需任何用户交互或二次密码验证。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-01-03T11:57:54.590

对我来说，在 Raspbian 上它只能以这种方式工作（添加了旧密码）：

```
#!/usr/bin/env bash

username="pi"
password="Szevasz123"
new_ps="Szevasz1234"

passwd ${username} << EOD
${password}
${new_ps}
${new_ps}
EOD 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-08-21T20:35:30.850

> 回声“你的密码”| sudo -S yourCommand

如果 -S 不起作用，请尝试使用 -kS

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2012-06-02T08:21:52.347

您可以使用[该`expect`实用程序](http://expect.sourceforge.net/)来驱动从 tty 读取的所有程序（与 stdin 不同，这是 passwd 所做的）。Expect 附带了针对各种交互式问题的准备运行示例，例如 passwd 输入。

# php - 从 PHP 中检索当前的 Active Directory 用户名

> ID：714917
> 
> 赞同：1
> 
> 时间：2009-04-03T17:35:14.207
> 
> 标签：php, active-directory

对于**内部**网络上的网站，所有 IE 安全设​​置都已设置。我想检索用户登录时使用的当前 AD 用户名。我不需要进行身份验证，因为我假设计算机上的人已经完成了该过程。

这甚至可能吗？我已经看到很多与 NTLM 相关的东西，它们展示了如何进行身份验证，但我似乎无法在没有提示框的情况下轻松提取当前经过身份验证的用户名，这是我试图避免的。

服务器设置是带有 Apache 的 Windows 服务器。如果使用 Linux 机器很容易完成，我也可以将它移到那里。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-03T18:19:23.100

如您的问题所述，必须将 IE 配置为允许 Windows 集成身份验证。这样做基本上允许 IE 将您的凭据/令牌提供给**请求它的站点**（通常仅限于 Intranet 区域中的站点）。请注意，您的网站必须请求这些凭据（在 IIS 中，它就像选中一个复选框一样简单）。在 Apache 中，您必须找到将 NTLM 身份验证支持添加到您的 Web 服务器的 Apache 模块。快速的谷歌搜索显示了几个不同的模块，似乎没有一个是特别最新的。如果您让 Apache NTLM 模块正常工作，我怀疑您将能够通过`$_SERVER['AUTH_USER']`.

# asp.net-mvc - ASP.NET MVC 使用 UpdateModel 发布子记录

> ID：714924
> 
> 赞同：1
> 
> 时间：2009-04-03T17:37:32.593
> 
> 标签：asp.net-mvc, model-view-controller, post, updatemodel

继续[这个](https://stackoverflow.com/questions/711184/asp-net-mvc-example-of-editing-multiple-child-records)问题，我有一个表格，其中列出了一个人的所有车辆，车辆字段是可编辑的，它们现在已成功发回我的保存操作。

现在我想使用 UpdateModel 来保存数据，但我不确定如何构造它。这是我现在的保存操作：

```
<ActionName("Edit"), AcceptVerbs(HttpVerbs.Post)> _
Function Save(ByVal form As Person, ByVal vehicles() As Vehicle) As ActionResult
    Dim original = From v In MyDataContext.Vehicles Where v.person_id = Person.person_id
    For Each item In original
        For i = 0 To vehicles.Count - 1
            If vehicles(i).vehicle_id = item.vehicle_id Then
                UpdateModel(item, New String() {"license_nbr", "color"})
                Exit For
            End If
        Next
    Next
    MyDataContext.SubmitChanges()
    Return RedirectToAction("Index", "Home")
End Function 
```

当我运行它时，它不会保存任何东西，并且 UpdateModel 不会抛出任何错误。我假设我必须给它更多的方向才能让它发挥作用，因为 UpdateModel 不知道车辆数组中的哪个项目用于每次更新。

我是否需要将 ValueProviderResult 指定为 UpdateModel 的第三个参数？如果是这样，我如何从车辆（i）中创建一个？我是否完全不了解我的设置方式？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-03T17:52:37.877

当您已经将表单字段处理为模型数据时，为什么还要使用 UpdateModel——它只是更新表单字段的属性？您不能直接将值分配给`vehicle`to`item`吗？

```
For Each item In original
    For i = 0 To vehicles.Count - 1
        If vehicles(i).vehicle_id = item.vehicle_id Then 
           item.license_nbr = vehicles(i).license_nbr
           item.color = vehicles(i).color
           Exit For
        End If
    Next
Next 
```

# sql-server - SQL Server 2005 - 触发循环？

> ID：714935
> 
> 赞同：2
> 
> 时间：2009-04-03T17:41:42.443
> 
> 标签：sql-server, database, sql-server-2005, triggers, rdbms

我是第一次使用触发器。

如果我通过同一张表上的更新触发器更新表中的字段，这会引发循环吗？sql server 是否防止这种递归行为？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-03T17:52:56.690

[此页面](http://msdn.microsoft.com/en-us/library/ms190739.aspx)（搜索`RECURSIVE_TRIGGERS`）描述了可用于修改此行为的一些数据库设置。此外，保护您的过程的一种方法是使用[`UPDATE()`](http://msdn.microsoft.com/en-us/library/ms187326.aspx)函数或[`COLUMNS_UPDATED()`](http://msdn.microsoft.com/en-us/library/ms186329.aspx)函数。

例如，如果您有一个包含 、 和 列的表`A`，`B`并且`C`您希望在更新`C`列中的值时自动更改 的值，`B`则可以保护触发器中的调用：

```
CREATE TRIGGER Whatever ON TableName AFTER UPDATE
AS
BEGIN
    IF UPDATE(B)
    BEGIN
        /* Update column C here */
    END
END 
```

这样，当您的`C`触发器更新列时，您可以避免递归调用触发器。 `COLUMNS_UPDATED()`也很有用，但我发现它很脆弱（依赖于列的位置而不是列名）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T18:09:42.687

您可以通过 RECURSION_TRIGGER 选项在数据库级别控制触发器的递归；它默认关闭。即使开启此选项，也有 32 层嵌套触发器的限制；如果您的退出条件在达到 32 个级别的限制之前没有停止递归，则所有更改都将回滚。

# c# - ASP.Net MVC ViewUserControl 与控制器使用 MVC 1.0

> ID：714939
> 
> 赞同：4
> 
> 时间：2009-04-03T17:43:26.760
> 
> 标签：c#, asp.net-mvc, viewusercontrol

由于所有预览版本和一个官方版本中关于 mvc 的所有信息之间存在混淆，我非常困惑如何处理 viewusercontrols。所以一劳永逸地告诉我如何实现这个例子：

我有一个即将发生的事件列表，需要在我网站的多个页面上显示。因此，我在 Views\Shared 文件夹中放置了一个新的 ViewUserControl (ListEvents.ascx)。

我请求这个 ListEvents.ascx 在我的 Home/Index 视图上呈现，如下所示：

```
<p>
    Here's a list of events:
    <% Html.RenderPartial("ListEvents");%>
</p> 
```

我将如何将我的模型传递给这个 viewusercontrol？我知道我可以这样做：

```
<p>
    Here's a list of events:
    <% Html.RenderPartial("ListEvents", (new Model.Services.EventService(null)).ListEvents());%>
</p> 
```

但这似乎不是一件很聪明的事情，从视图内部创建一个新模型？！还是我在这里错了？我什至不能通过任何验证状态，因此是 null 参数。因此，另一种选择是将这些数据存储到 ViewData[] 成员中，但我的 viewusercontrol 不应该依赖于它的父级的 ViewData！

我确信有一个非常简单的答案，请在我浏览完这个问题的网页后分享。

谢谢！

**简单的答案**：viewusercontrol 应该总是从它所在的视图中接收它的模型。解决这个问题，比如向 viewusercontrol 添加代码隐藏文件，会破坏 MVC 模式。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T17:53:26.643

默认情况下，将使用与页面相同的模型。如果您想为 的每个实例提供一个模型`RenderPartial`，您的情况可能就像在博客应用程序中呈现多个条目一样。您可以从页面模型中的集合中获取每个模型并将其传递给用户控件，如下所示：

```
foreach (var post in Model.Entries) {
  Html.RenderPartial("PostTemplate", post);
} 
```

# javascript - 如何阻止激烈的 Javascript 循环冻结浏览器

> ID：714942
> 
> 赞同：59
> 
> 时间：2009-04-03T17:43:40.673
> 
> 标签：javascript, jquery, performance, loops

我正在使用 Javascript 解析一个包含大约 3,500 个元素的 XML 文件。我正在使用 jQuery“每个”函数，但我可以使用任何形式的循环。
问题是浏览器在循环执行时冻结了几秒钟。在不降低代码速度的情况下停止冻结浏览器的最佳方法是什么？

```
$(xmlDoc).find("Object").each(function() {
    //Processing here
}); 
```

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2009-04-05T20:12:29.787

我会放弃“每个”函数以支持 for 循环，因为它更快。我还会使用“setTimeout”添加一些等待，但仅在需要时才经常使用。您不想每次等待 5 毫秒，因为处理 3500 条记录大约需要 17.5 秒。

下面是一个使用 for 循环的示例，该循环以 5 毫秒的间隔处理 100 条记录（您可以对其进行调整），这会产生 175 毫秒的开销。

```
var xmlElements = $(xmlDoc).find('Object');
var length = xmlElements.length;
var index = 0;
var process = function() {
  for (; index < length; index++) {
    var toProcess = xmlElements[index];
    // Perform xml processing
    if (index + 1 < length && index % 100 == 0) {
        setTimeout(process, 5);
    }
  }
};
process(); 
```

我还将对 xml 处理的不同部分进行基准测试，以查看是否存在可以修复的瓶颈。您可以使用 firebug 的分析器在 firefox 中进行基准测试，并像这样写出控制台：

```
// start benchmark
var t = new Date();
// some xml processing
console.log("Time to process: " + new Date() - t + "ms"); 
```

希望这可以帮助。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-04-03T17:51:20.687

在处理之间设置一个超时时间，以防止循环周期耗尽所有浏览器资源。总的来说，处理和循环所有内容只需要几秒钟，对于 3,500 个元素来说并非不合理。

```
var xmlElements = $(xmlDoc).find('Object');

var processing = function() {
  var element = xmlElements.shift();

  //process element;

  if (xmlElements.length > 0) {
    setTimeout(processing, 5);
  }
}

processing(); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-03T17:53:57.967

我会考虑将 3500 个元素从 xml 转换为 JSON 服务器端，或者甚至更好地将其上传到转换后的服务器，以便它从 getgo 开始是 JS 原生的。

这将最大限度地减少您的负载，并使文件大小也更小。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-03T20:27:58.953

您可以 setTimeout() 的持续时间为零，它会根据需要产生

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-12-14T10:40:07.127

Turboid 框架可以在不冻结浏览器的情况下进行长循环。有了它，您可以编写如下代码：

```
loop(function(){  
        // Do something...  
}, number_of_iterations, number_of_milliseconds); 
```

这篇 turboid.net 文章中的更多详细信息：[Javascript 中的真实循环](http://turboid.net/artikel/real-loops-in-javascript.php)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-03T17:51:22.793

Javascript 是单线程的，所以除了`setTimeout`，您无能为力。如果您的网站可以选择使用 Google Gears，它们提供了在真正的后台线程中运行 javascript 的能力。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-03T20:14:37.613

您可以使用 HTML5 workers API，但这仅适用于 Firefox 3.1 和 Safari 4 betas atm。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-10-04T09:09:36.090

当用户连续刷新页面时，我遇到了同样的问题。原因是两个嵌套的 for 循环发生了超过 52000 次。这个问题在 Firefox 24 中比在 Chrome 29 中更严重，因为 Firefox 会更快崩溃（比 Chrome 早大约 2000 毫秒）。我所做的只是使用“for”循环而不是每个循环，然后我重构了代码，以便将整个循环数组划分为 4 个单独的调用，然后将结果合并为一个。这个解决方案已经证明它是有效的。

像这样的东西：

```
var entittiesToLoop = ["..."]; // Mainly a big array
   loopForSubset(0, firstInterval);
   loopForSubset(firstInterval, secondInterval);
    ...

var loopForSubset = function (startIndex, endIndex) {
    for (var i=startIndex; i < endIndex; i++) {
            //Do your stuff as usual here
    }
} 
```

另一个对我也有用的解决方案是使用`Worker APIs`HTML5 实现的相同解决方案。在工作线程中使用相同的概念，因为它们会在主线程的后台运行，从而避免您的浏览器被冻结。如果仅通过 Workers API 应用它不起作用，请将每个实例`loopForSubset`放在不同的工人中，并将结果合并到 Worker 的主调用者中。

我的意思是这可能并不完美，但这已经奏效了。如果有人仍然认为这可能适合他们，我可以帮助处理更多真实的代码块。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-06-13T07:19:02.863

您可以尝试通过以下方式缩短代码

```
 $(xmlDoc).find("Object").each(function(arg1) {
    (function(arg1_received) {
                setTimeout(function(arg1_received_reached) {

                    //your stuff with the arg1_received_reached goes here 

                }(arg1_received), 0)
            })(arg1)
}(this)); 
```

这不会对你造成太大伤害；）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-10-17T09:16:43.560

作为@tj111 的修改回答完整的可用代码

```
 //add pop and shift functions to jQuery library. put in somewhere in your code.
    //pop function is now used here but you can use it in other parts of your code.
    (function( $ ) {
        $.fn.pop = function() {
            var top = this.get(-1);
            this.splice(this.length-1,1);
            return top;
        };

        $.fn.shift = function() {
            var bottom = this.get(0);
            this.splice(0,1);
            return bottom;
        };
    })( jQuery );

//the core of the code:
    var $div = $('body').find('div');//.each();
    var s= $div.length;
    var mIndex = 0;
    var process = function() {
        var $div = $div.first();            
    //here your own code.

    //progress bar:
        mIndex++;
    // e.g.:    progressBar(mIndex/s*100.,$pb0);

    //start new iteration.
        $div.shift();
        if($div.size()>0){
            setTimeout(process, 5);
        } else {
    //when calculations are finished.
            console.log('finished');
        }
    }
    process(); 
```

# asp.net - 您可以在不更新整个站点的情况下更新 Web 用户控件吗？

> ID：714943
> 
> 赞同：0
> 
> 时间：2009-04-03T17:44:09.473
> 
> 标签：asp.net, web-user-controls

我有一个使用网络用户控件的网站……嗯，基本上到处都是。它甚至包含在其他 Web 用户控件中。

所以我想我可以上传新的源代码，它会即时重新编译并且很好，但是每个使用它的页面或控件都会抱怨类型不匹配。因为它在很多地方使用，所以更新整个网站很快就会变得更容易。（或者至少如果我不需要为此经历我们的变更管理流程的话……）

那么我有什么遗漏吗？是否有任何方法可以上传 Web 用户控件并像更新单个网页时那样重新编译它？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-03T17:58:02.667

我认为它正在重新编译，它只需要一点时间，并且在重新编译时与临时 ASP.NET 文件中不匹配的 .ascx 和 .ascx.cs 文件发生冲突。**我可能错了。**就个人而言，如果我总是同时上传 .ascx 和 .ascx.cs 文件，我会取得更好的成功。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T18:14:54.953

我认为，如果您推动这些项目，您应该会很好……再少一点，您可能会遇到问题：

1.  bin 内容 - 这将包括您对用户控件的代码更改，如果程序集版本发生更改，您将希望包含任何使用它的 .dll，我通过尝试推送单个 .dll 多次遇到问题在垃圾桶里。

2.  .ascx 文件

我认为您不需要推送任何其他 .aspx 或 .ascx 文件。

# c# - 显示 XAML 时处理丢失的图像文件

> ID：714944
> 
> 赞同：1
> 
> 时间：2009-04-03T17:44:23.950
> 
> 标签：c#, wpf, xaml

我正在使用 XamlReader.Load() 加载可能包含一些图像和其他媒体的外部 XAML 文件。

我正在使用 ParserContext 设置 baseUri，因此如果 XAML 文件中的路径正确，则媒体加载成功。

```
// works
var pc = new ParserContext();
pc.BaseUri = new Uri(baseUri, UriKind.RelativeOrAbsolute);

using (FileStream stream = new FileStream(filename, FileMode.Open, FileAccess.Read))
    return XamlReader.Load(stream, pc); 
```

有没有办法让我找出哪些媒体文件将无法加载？也就是说，如果 XAML 文件包含一个 Image 标记，其源设置为一个不存在的路径，我可以在运行时告诉一个图像没有正确显示吗？（图像将是最常见的，但像 MediaElement 这样的其他控件也可能会加载外部文件。）

我可以想到几种可能的方法：

*   解析 XAML 文件以查找任何文件名，并直接检查每个文件名。
*   显示生成的可视化树时，查找某种 RoutedEvent 指示加载外部文件时出现问题

有小费吗？

* * *

*编辑*：我认为 XamlReader 的东西可能会分散注意力；我得到了一个有效的可视化树，但是当尝试加载不存在的文件时，控件本身可能会出现问题。这些是我想要捕捉的错误。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-04T17:41:40.140

如果您通过将图像绑定到背景对象来链接图像，您会发现 WPF 中的绑定错误不会引发异常。看看这篇[博客文章，它可能有助于解决这个限制](http://www.beacosta.com/blog/?p=52)。

然而，媒体元素更简单，因为它有一个事件 ( `MediaFailed`)，您可以捕获该事件以确定它是否失败。

```
<MediaElement Source="filePath.wmv" MediaFailed="EventHandler"/> 
```

# mysql - MySQL 性能优化：按日期时间字段排序

> ID：714950
> 
> 赞同：38
> 
> 时间：2009-04-03T17:47:29.183
> 
> 标签：mysql, performance, select

我有一个包含大约 100.000 个博客帖子的表格，通过 1:n 关系链接到一个包含 50 个提要的表格。当我使用 select 语句查询两个表时，按张贴表的日期时间字段排序，MySQL 总是使用文件排序，导致查询时间非常慢（>1 秒）。这是`postings`表的架构（简化）：

```
+---------------------+--------------+------+-----+---------+----------------+
| Field               | Type         | Null | Key | Default | Extra          |
+---------------------+--------------+------+-----+---------+----------------+
| id                  | int(11)      | NO   | PRI | NULL    | auto_increment |
| feed_id             | int(11)      | NO   | MUL | NULL    |                |
| crawl_date          | datetime     | NO   |     | NULL    |                |
| is_active           | tinyint(1)   | NO   | MUL | 0       |                |
| link                | varchar(255) | NO   | MUL | NULL    |                |
| author              | varchar(255) | NO   |     | NULL    |                |
| title               | varchar(255) | NO   |     | NULL    |                |
| excerpt             | text         | NO   |     | NULL    |                |
| long_excerpt        | text         | NO   |     | NULL    |                |
| user_offtopic_count | int(11)      | NO   | MUL | 0       |                |
+---------------------+--------------+------+-----+---------+----------------+ 
```

这是`feed`表格：

```
+-------------+--------------+------+-----+---------+----------------+
| Field       | Type         | Null | Key | Default | Extra          |
+-------------+--------------+------+-----+---------+----------------+
| id          | int(11)      | NO   | PRI | NULL    | auto_increment |
| type        | int(11)      | NO   | MUL | 0       |                |
| title       | varchar(255) | NO   |     | NULL    |                |
| website     | varchar(255) | NO   |     | NULL    |                |
| url         | varchar(255) | NO   |     | NULL    |                |
+-------------+--------------+------+-----+---------+----------------+ 
```

这是执行时间超过 1 秒的查询。请注意，该`post_date`字段有一个索引，但 MySQL 没有使用它来对发布表进行排序：

```
SELECT 
    `postings`.`id`, 
    UNIX_TIMESTAMP(postings.post_date) as post_date, 
    `postings`.`link`, 
    `postings`.`title`, 
    `postings`.`author`, 
    `postings`.`excerpt`, 
    `postings`.`long_excerpt`, 
    `feeds`.`title` AS feed_title, 
    `feeds`.`website` AS feed_website
FROM 
    (`postings`)
JOIN 
    `feeds` 
ON 
    `feeds`.`id` = `postings`.`feed_id`
WHERE 
    `feeds`.`type` = 1 AND 
    `postings`.`user_offtopic_count` < 10 AND 
    `postings`.`is_active` = 1
ORDER BY 
    `postings`.`post_date` desc
LIMIT 
    15 
```

此查询的`explain extended`命令结果显示 MySQL 正在使用文件排序：

```
+----+-------------+----------+--------+---------------------------------------+-----------+---------+--------------------------+-------+-----------------------------+
| id | select_type | table    | type   | possible_keys                         | key       | key_len | ref                      | rows  | Extra                       |
+----+-------------+----------+--------+---------------------------------------+-----------+---------+--------------------------+-------+-----------------------------+
|  1 | SIMPLE      | postings | ref    | feed_id,is_active,user_offtopic_count | is_active | 1       | const                    | 30996 | Using where; Using filesort |
|  1 | SIMPLE      | feeds    | eq_ref | PRIMARY,type                          | PRIMARY   | 4       | feedian.postings.feed_id |     1 | Using where                 |
+----+-------------+----------+--------+---------------------------------------+-----------+---------+--------------------------+-------+-----------------------------+ 
```

当我删除该`order by`部分时，MySQL 将停止使用文件排序。如果您对如何优化此查询以使 MySQL 使用索引对数据进行排序和选择有任何想法，请告诉我。正如一些博客文章所建议的那样，我已经尝试了一些事情，例如在所有 where/order by 字段上创建组合索引，但这也不起作用。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-04-03T17:55:21.053

`postings (is_active, post_date)`（按该顺序）创建一个复合索引。

它将用于过滤`is_active`和排序`post_date`。

`MySQL`应该`REF`在`EXPLAIN EXTENDED`.

请注意，您有一个`RANGE`过滤条件 over `user_offtopic_count`，这就是为什么您不能在过滤和按其他字段排序时对该字段使用索引的原因。

根据您的选择性`user_offtopic_count`（即满足多少行），创建索引并让 post_dates 排序`user_offtopic_count < 10`可能更有用。`user_offtopic_count`

为此，请创建一个复合索引`postings (is_active, user_offtopic_count)`并确保`RANGE`使用此索引上的访问方法。

哪个索引会更快取决于您的数据分布。创建两个索引，`FORCE`看看哪个更快：

```
CREATE INDEX ix_active_offtopic ON postings (is_active, user_offtopic_count);
CREATE INDEX ix_active_date ON postings (is_active, post_date);

SELECT 
    `postings`.`id`, 
    UNIX_TIMESTAMP(postings.post_date) as post_date, 
    `postings`.`link`, 
    `postings`.`title`, 
    `postings`.`author`, 
    `postings`.`excerpt`, 
    `postings`.`long_excerpt`, 
    `feeds`.`title` AS feed_title, 
    `feeds`.`website` AS feed_website
FROM 
    `postings` FORCE INDEX (ix_active_offtopic)
JOIN 
    `feeds` 
ON 
    `feeds`.`id` = `postings`.`feed_id`
WHERE 
    `feeds`.`type` = 1 AND 
    `postings`.`user_offtopic_count` < 10 AND 
    `postings`.`is_active` = 1
ORDER BY 
    `postings`.`post_date` desc
LIMIT 
    15

/* This should show RANGE access with few rows and keep the FILESORT */

SELECT 
    `postings`.`id`, 
    UNIX_TIMESTAMP(postings.post_date) as post_date, 
    `postings`.`link`, 
    `postings`.`title`, 
    `postings`.`author`, 
    `postings`.`excerpt`, 
    `postings`.`long_excerpt`, 
    `feeds`.`title` AS feed_title, 
    `feeds`.`website` AS feed_website
FROM 
    `postings` FORCE INDEX (ix_active_date)
JOIN 
    `feeds` 
ON 
    `feeds`.`id` = `postings`.`feed_id`
WHERE 
    `feeds`.`type` = 1 AND 
    `postings`.`user_offtopic_count` < 10 AND 
    `postings`.`is_active` = 1
ORDER BY 
    `postings`.`post_date` desc
LIMIT 
    15

/* This should show REF access with lots of rows and no FILESORT */ 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-03T17:52:32.260

MySQL 有两种文件排序算法：一种是对磁盘上的记录进行排序的旧文件排序，另一种是在内存中工作的新版本。

如果它不能使用连接中第一个表上的索引对查询进行排序，则必须进行文件排序。如果排序前转换为固定宽度格式的结果集大于排序缓冲区，*或者*如果它包含任何文本字段，则必须使用较慢的磁盘文件排序算法（第二个条件满足，因为您的查询有一个文本字段） .

MySQL 选择使用 is_active 列，表面上是因为它认为该列在继续使用其他连接和 where 条件之前在消除行方面最具选择性。我建议的第一件事是尝试使用 post_date、feed_id 和 where 条件中的列创建复合索引，例如（is_active、user_offtopic_count、post_date、feed_id）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-08-25T05:41:53.037

此外，重要的是要记住，如果您排序的列具有应用于它的函数，MySQL 将不会使用索引。

您还应该尝试将 posts.post_date 别名为其他名称。这将告诉 MySQL 按未更改的列排序，您仍将选择 unix 时间戳。

# visual-studio - 在 Visual Studio 中引用 COM 程序集与通过 tlbimp.exe 转换 COM 程序集

> ID：714952
> 
> 赞同：3
> 
> 时间：2009-04-03T17:47:44.423
> 
> 标签：visual-studio, assemblies, reference, tlbimp

当我通过将 COM 程序集 (dll) 作为参考添加到 Visual Studio 项目中时，我可以毫无问题地使用生成的等效公共语言运行时程序集。

但是，如果我尝试使用 tlbimp 将相同的 COM 程序集转换为公共语言运行时程序集，则会遇到各种问题。

有没有办法复制 Visual Studio 与 tlbimp 一起使用的设置？或者换句话说，有没有办法通过使用 tlbimp 来生成与 Visual Studio 相同的互操作类？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-05T10:37:08.157

我自己找到了解决方案。要复制 Visual Studio 与 tlbimp 一起使用的设置，您只需使用 /out 和 /namespace 标志。

out 标志用于为“Interop”添加前缀。在生成的文件上，命名空间标志用于将默认命名空间设置为 COM 程序集的名称。

例如

```
tlbimp /out:Interop.MyCom.dll /namespace:MyCom MyCom.dll 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-04-28T05:41:05.990

还有一点，你还需要使用 /sysarray 选项，否则你会发现你的应用程序会随机崩溃，假设 EngineExceptions 引用内存损坏。

这将为您提供与 Visual Studio 生成的相同的 ilcode。

指定 /namespace 参数以匹配（包括大小写） tlb 文件中的 library 子句。（可以使用oleview.exe直接查看tlbs）。

[其余的大脑转储] 使用 tlbimp 的好处，尤其是来自 msbuild 脚本的好处是，您可以让您的产品为 64 位和 32 位目标正确构建。

否则，您最终会使用最后一次 regsvr32'd 的 tlb 获得 64 位构建目标，这很可能是具有 32 位接口的 32 位 com 对象。

如果使用 64 位和 32 位，请同时使用 /reference 和 /tlbreference，以便它使用您在命令行上传递的互操作和 tlb，而不是在注册表中为它们钓鱼。

# objective-c - NSIndexPath - 如何？

> ID：714959
> 
> 赞同：0
> 
> 时间：2009-04-03T17:49:39.567
> 
> 标签：objective-c, cocoa-touch

我想在 UITableView 中实现索引功能，就像在标准联系人应用程序中一样。

是否有详细的教程如何实现这一目标？这样做的正确方法是什么？

我表中的数据按字母顺序排序，当用户按下索引中的某个字母时，我想滚动到表中的同一个字母。

如何返回每个部分的行数？目前我有一个函数可以计算每个部分的项目数。有没有办法自动计算？当我到达方法 cellForRowAtIndexPath 时，我需要知道表中项目的实际数量，而不是一行中的项目。我如何得到它？即我的表中有 50 个项目和 26 个部分。当涉及到第 30 项时，我想获得 30，而不是“section:3 row:2”。有没有办法这样做？

先感谢您。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T19:12:25.580

至于侧面的列表，使用UITableViewDataSource方法sectionIndexTitlesForTableView：

请记住，它仅在您使用 UITableViewStylePlain 时才有效

# c# - .NET 中的互操作性受损？

> ID：714960
> 
> 赞同：4
> 
> 时间：2009-04-03T17:50:11.750
> 
> 标签：c#, .net, interop, f#

最近我在这里问了一个关于在 C# 中使用 F# 扩展的问题。布赖恩引用：

> 根据语言规范，第 10.7 节“类型扩展”：
> 
> 可选的扩展成员是静态成员的语法糖。可选扩展成员的使用详细说明了对具有编码名称的静态成员的调用，其中对象作为第一个参数传递。此版本的 F# 中未指定名称的编码，并且与 C# 扩展成员的 C# 编码不兼容。

我想知道.NET 中是否还有其他互操作性问题将某些功能的使用限制为某些语言而不是其他语言？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-03T18:00:06.500

我预计会有很多事情，但如果您谈论主要的托管语言（C#、VB 和很快的 F#），主要是在极端情况下。F# 当前与 C# 交互不佳的其他情况是，当方法重载同时采用 Action 和 Func 时（C# 重载解析的工作方式与 F# 不同，因此 F# 对此类 API 的调用可能更冗长）；'params' 参数数组（尤其是在尝试利用 'array covariance' 时，这是 C# 而非 F# 的一个特性）；有一些关于子类化或实现接口的问题，以及可访问性（例如公共与内部），有时您无法从 C# 派生 F# 类...

其中许多问题只是 F# CTP 编译器中的“错误”或 F# 语言规范的“设计问题”，可能在 F# 最终版本之前更改。

我不太了解 CLR 尘土飞扬的角落，但我敢打赌，有些地方 C# 和 VB 无法啮合。并且有一些主要语言都没有使用的 CLR 功能，所以我希望有一些方法可以创建有效的 IL，这可能会导致某些互操作出现问题。

总的来说，我认为所有这些东西都是次要的，在 F# 的情况下，它的一部分将在最终版本之前“修复”。但我很想看看人们会说什么其他的东西，因为这对于 MS 的管理语言团队可能是有用的反馈。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-08-19T23:31:04.387

C++/CLI 对 CLR 对象（不是引用，而是对象本身）具有“按值传递”语义，包括复制构造函数、临时对象及其销毁等。您可以编写：

```
ref class Foo {
public:
  Foo() { ... }
  Foo(Foo% other) { ... }
}; 
```

接着：

```
Foo^ getFooRef() { ... } // returns a reference to Foo
Foo getFoo() { ... } // returns a copy of Foo 
```

当然，在 CLR 级别上，它都是引用 - C++/CLI 通过`operator=`在您希望调用构造函数、析构函数和析构函数的时候调用它们来模拟复制语义。在“按值返回”的情况下，这意味着调用者必须正确地破坏对象，它接收到的引用。C#、VB 和除 C++/CLI 之外的任何其他 CLI 语言都不知道如何执行此操作，因此无法从它们调用此类方法。

另一个有趣的地方是 CLR 允许定义具有`ref`返回类型的方法。没有 CLR 语言支持它们（甚至 C++/CLI 也不支持），但是您可以在 MSIL 中手动编写代码，并且不能从任何其他语言调用它。

一般来说，这类事情正是创建公共语言规范 (CLS) 的原因。如果你坚持它的规则，你不应该有任何语言的互操作性问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-03T18:04:43.900

微软发布了一套处理此类事情的[指南。](http://msdn.microsoft.com/en-us/library/ms229042.aspx)基本上它是为类设计者准备的，包括一些建议，例如不包括仅因大小写而异的方法（对于像 VB 这样的不区分大小写的语言），在运算符重载可能不可用时为运算符提供替代方法等。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-08-19T23:21:54.433

**从 c#代码中使用**f* # 类有时会很棘手或很烦人。*

 *### 默认情况下，f# 中的事件不是“正常”事件

添加`[<CLIEvent>]`属性可以解决这个问题，但除非您使用 DelegateEvent 而不是 Event，否则[c# 代码必须引用 FSharpCore](http://cs.hubfs.net/forums/thread/10554.aspx)。

### 头等舱功能的区别

在 f# 中使用 FastFunc（f# 函数的主干）制作委托很容易。在 c# 中从一个委托创建一个 FastFunc 相当烦人，[这里会涉及到](http://weblogs.asp.net/podwysocki/archive/2008/10/15/functional-c-implementing-async-computations-in-c.aspx)。特别是`Unit`概念图非常糟糕地回到了 c# 和 Func/Action 委托世界。

### 运营商

在 f# 中定义的运算符在其他 CLR 语言中的处理很差[且不一致。](https://stackoverflow.com/questions/967508/f-and-operator-overloads)这是 CLR 未定义所需的复杂类型元数据的必然结果。
运算符应被视为语言特征，而不是期望在不同语言之间进行很好的翻译。任何有用的运算符都应该有一个等效的静态方法，该方法允许以一致且可移植的方式访问该功能。

### 类型推断

在 f# 中，这是普遍存在的，因此您可能会发现正在构造一些非常复杂的类型。一旦在 c# 中使用，这可能会变得很麻烦，因为函数的类型推断没有那么强大，但更糟糕的是，构造函数中完全没有它，这可能导致令人痛苦的冗长 c# 代码。

# c# - 捕获谁点击了从网站 A 到网站 B 的链接？

> ID：714966
> 
> 赞同：0
> 
> 时间：2009-04-03T17:51:36.193
> 
> 标签：c#, asp.net

假设我有一个名为网站 A 的网站，它上面有一些指向其他网站的链接。其中一个链接可能是到网站 B 的链接。有没有办法，使用一些现有的解决方案、开源或您必须付费的东西，您可以在哪里跟踪谁、什么、在哪里等点击了从网站转到的链接A到网站B？

网站 B 可能是 Stackoverflow，而我的网站是 www.websiteA.com，所以在我的网站上，我有一个指向 www.stackoverflow.com 的链接。如果用户从我的页面单击 www.stackoverflow.com，我想捕获信息，例如姓名、电话等（不确定我是否可以这样做，除非用户实际登录到我的网站）。在这种情况下，这是一个任何人都可以访问的公共页面。如果我不能从我的网站上执行此操作，有没有办法告诉 stackoverflow 这个特定的人点击了我的链接以访问您的网站，我需要他们的信息。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-03T17:55:27.463

大多数站点为此使用的方法是让您站点上的脚本处理重定向。因此，而不是直接链接到：

> `http://websiteB.com`

链接类似于：

> `http://websiteA.com/link/websiteB.com`

“链接”脚本记录请求，然后将它们转发到地址（这应该立即完成，不要给他们“在 3 秒内将您转发到网站 B！”页面）。

请注意，作为您网站的*访问者*，我更喜欢当我将鼠标悬停在链接上时链接的目的地显而易见的方法，而不是某些网站使用的方法，您看到的只是一个 id。我的意思是，而不是链接是这样的：

> `http://websiteA.com/link/websiteB.com`

他们反而有一个链接，如：

> `http://websiteA.com/link/483`

显示目的地可以通过几种方式实现。一种方法是我上面描述的，其中目的地是查询字符串的一部分。或者，您可以为此使用一些 Javascript。状态栏的值可以通过 Javascript 通过设置`window.status`变量来更改，但许多浏览器默认阻止此操作（例如 Firefox）。

Google 通过实际使用 Javascript 更改**链接**而不是状态栏找到了解决此问题的偷偷摸摸的方法。当页面加载时，结果列表中的链接会转到它们的实际目的地，但是每个链接都有一个`onmousedown`javascript 事件，当您单击它时会更改链接。您可以通过右键单击链接来查看此操作。完成此操作后，将鼠标悬停在链接上现在将在状态栏中显示真正的目的地（Google 的点击跟踪脚本），而不是结果的真实 URL。

当然，用任何方法显示的信息都可能是对我实际将被发送到哪里的错误陈述，但我仍然更喜欢它而不是看到无意义的身份证号码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T17:53:34.130

尝试使用 HTTP_REFERER

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T17:54:58.213

您可以随时检查引荐来源网址，但这可能会被欺骗。

```
Request.UrlReferrer.ToString 
```

除此之外，您可以在网站 A 的链接上附加一个额外的查询参数，以便您知道它们来自哪里：

```
<a href="www.websiteb.com?from=websitea"> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-03T18:12:25.207

如果您控制网站 B，那么您只需在日志记录中使用 http_referer 部分。否则，您将希望在站点 A 上有一个重定向页面，该页面记录 url，然后将浏览器重定向到另一个站点/页面。

```
http://siteA/redirect?url=siteB/page 
```

站点a中的重定向页面重定向到..

```
"http://" + request['url'] 
```

# sql - 您如何在 tsql contains 函数中搜索 &（与号）？

> ID：714980
> 
> 赞同：3
> 
> 时间：2009-04-03T17:54:30.603
> 
> 标签：sql, sql-server, tsql, full-text-search

我有一个表 T，它的列 C 包含其中包含字符 & 的文本，但是如果我执行以下查询，它不会返回任何内容，尽管我可能有 10 行。

```
SELECT * FROM T WHERE Contains(C, 'a&b') 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-03T18:28:25.653

使用双引号使其成为搜索词：

```
SELECT *
FROM T
WHERE CONTAINS(C, '"a&b"') 
```

否则，您正在搜索具有 AND b 的内容。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-03T17:58:04.947

改用lik​​e：

```
SELECT * FROM T WHERE C like '%&%' 
```

如果你只是在寻找 &

或者

```
SELECT * FROM T WHERE C like '%a&b%' 
```

如果你需要搜索 a&b

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T17:57:19.863

你能用 LIKE 代替 contains 吗？

```
SELECT * FROM T WHERE C LIKE '%a&b%' 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-03T18:20:53.270

我所做的是创建列的副本，用 _ 替换 & 和其他非字母数字字符。然后我可以做到这一点。

```
SELECT * FROM T WHERE Contains(C_searchable, 'a_b') 
```

# css - 如何为非设计师生成 CSS 标记

> ID：714989
> 
> 赞同：0
> 
> 时间：2009-04-03T17:55:40.583
> 
> 标签：css, internet-explorer-6

行，

我的任务是将工作中的站点从基于表格的布局移植/转换/升级到基于 CSS 的布局。该站点非常典型，它有一个页眉、导航栏（页眉宽度）、左栏、主栏，然后是页脚。

一个问题是我们的企业网络标准是 IE6。传闻我们将很快部署 IE7，但目前，IE6 是我的目标。我使用 Firefox，但我的用户没有，所以它无济于事。

昨天我确实在网上找到了[SuperPreview](http://www.microsoft.com/downloads/details.aspx?FamilyID=8e6ac106-525d-45d0-84db-dccff3fae677&displaylang=en)，它对我有很大帮助，但坦率地说，我不太擅长 CSS，而且它往往让我感到沮丧。我必须编写/生成适用于 IE6 的标记，并且希望也适用于 IE7 和 IE8，但 IE6 是我的基线。

有没有工具可以帮助我，或者让我参与其中？我只需要一个可以为我生成一些布局的工具，比如 Word 中的日历向导。

我知道这是一项艰巨的任务，有什么建议吗？

ps 为了让您了解这个网站的年代，它是用 ASP 3 或 Classic ASP 编写的。

已编辑。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T18:04:00.190

确保您使用正确的文档类型，不会让浏览器进入怪异模式，并学习 CSS。如果您不了解 CSS 并且没有时间学习它，请将 CSS 留给了解它的人。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T17:59:00.950

您可以尝试使用 Yui 布局。
多种口味可供选择。
[雅虎！UI 库：网格 CSS](http://developer.yahoo.com/yui/grids/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T18:04:46.413

我会去寻找具有现成布局的网站。像[http://blog.html.it/layoutgala/](http://blog.html.it/layoutgala/)这样的网站。这里还有一个与 CSS 布局相关的问题。CSS 布局对于初学者来说可能非常棘手，而且很难想出。甚至专家也使用现成的经过测试的布局作为构建站点的基础。

我还想推荐一个好的编辑器来构建网站。Dreamweaver 似乎很受欢迎，但我更喜欢免费的 Aptana，因为我一直想用代码“弄脏我的手”，以获得控制的感觉。

此外，不要再认为ie6是你的目标，它会导致你为ie开发，这会导致你遇到问题。我强烈建议在[firebug](http://www.getfirebug.com/)帮助下使用 firefox 进行开发。然后解决 ie6 带来的错误和问题。

这样你以后会过得更好。当更改为 ie7 或更改为 safari、chrome、firefox、opera 或除 ie 之外的其他任何东西时，您的网站将运行得更好。:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-03T18:21:51.317

如果您觉得**有点**冒险，您可以尝试学习其中一个[网格系统](http://www.designbygrid.com/)。

我个人喜欢[http://www.blueprintcss.org/](http://www.blueprintcss.org/)（另一个主要的是[http://960.gs/](http://960.gs/)）

这是它为您提供的

> Blueprint 是一个 CSS 框架，旨在减少您的开发时间。它为您构建项目奠定了坚实的基础，具有易于使用的网格、合理的排版、有用的插件，甚至是用于打印的样式表

你也可以试试[http://layouts.ironmyers.com/ 之类的网站](http://layouts.ironmyers.com/)

# oracle - 确定 Oracle 数据库实例

> ID：714992
> 
> 赞同：4
> 
> 时间：2009-04-03T17:56:27.557
> 
> 标签：oracle, vinstance

除了查询 v_$database 和 v_$instance 表（或视图 v$instance、v$database）之外，还有其他方法可以以编程方式检索（从 PL/SQL）oracle 数据库的数据库名称吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-03T18:14:55.280

dbms_standard.database_name

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-03T18:48:21.440

在专家交流中发现以下内容：

```
select ora_database_name from dual;
select sys_context('userenv','db_name') from dual;
select global_name from global_name; 
```

[http://www.experts-exchange.com/Databases/Oracle/Q_20529577.html](http://www.experts-exchange.com/Databases/Oracle/Q_20529577.html)

# flash - 发布后刷新 FlexBuilder 中的 SWC

> ID：714993
> 
> 赞同：0
> 
> 时间：2009-04-03T17:56:38.770
> 
> 标签：flash, actionscript-3, flexbuilder

我在 FlexBuider 的 Actionscript 项目中使用从 Flash CS3 发布的 SWC。问题是每次我进行更改并重新发布 SWC 时，我所做的更改都不会立即在 FlexBuilder 中被识别。

为了识别新发布的 SWC，我必须从库路径中删除对 SWC 的引用，然后重新添加。这很乏味。

有没有更好的办法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-03-26T13:04:29.840

这里的答案是进入项目的属性并单击 ActionScript Build Path。在 Library Path 选项卡中，您应该会看到您的 SWC 文件和文件夹。继续删除，然后重新添加 SWC。这将使 Flex 重建其缓存。

Adobe 还提供了一份存档支持文档，说明如何确保其有效： http: [//kb2.adobe.com/cps/192/tn_19283.html](http://kb2.adobe.com/cps/192/tn_19283.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-03T18:05:05.007

右键单击 libs 文件夹，然后按刷新。非常简单。******************