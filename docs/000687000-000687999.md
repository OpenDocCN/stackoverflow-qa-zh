# StackOverflow 问答 000687000-000687999

# c - QueryFullProcessImageName 以有效的 HINSTANCE 失败？

> ID：687001
> 
> 赞同：2
> 
> 时间：2009-03-26T18:25:40.770
> 
> 标签：c, winapi

```
//window is an HWND
LPWSTR path = new WCHAR[1024];
DWORD  size = 1024;

GetWindowText(window, path, 1024);

HINSTANCE instance = (HINSTANCE)GetWindowLongPtr(window, GWLP_HINSTANCE);

QueryFullProcessImageName(instance, PROCESS_NAME_NATIVE, path, &size); 
```

此代码在调用 QueryFullProcessImageName(...) 时失败，错误代码为 6 [无效句柄]。GetWindowText 成功，GetWindowLong 返回一个非零的 HINSTANCE。

我对win32很陌生，所以为什么这不起作用超出了我的范围。我相信所涉及的 HWND 和 HINSTANCE 都是有效的......

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T18:27:22.263

**主要问题：**

对于函数：[QueryFullProcessImageName](http://msdn.microsoft.com/en-us/library/ms684919(VS.85).aspx)，第一个参数不是HINSTANCE，它是进程句柄。它们是不同的。要获取当前进程 ID，您应该使用[GetCurrentProcessId](http://msdn.microsoft.com/en-us/library/ms683180(VS.85).aspx)。然后将其传递给[OpenProcess](http://msdn.microsoft.com/en-us/library/ms684320(VS.85).aspx)以获取进程句柄。

* * *

**其他问题：**

您应该使用上面的[GetWindowLongPtr](http://msdn.microsoft.com/en-us/library/ms633585(VS.85).aspx)而不是 GetWindowLong。在 x64 系统上使用 GetWindowLong 可能会导致问题。

* * *

**如何自己找出问题所在：**

在大多数 Win32 函数失败后，您可以使用 GetLastError 找出原因。

因此，在调用 QueryFullProcessImageName 之后，请执行以下操作：

```
DWORD dwLastError = GetLastError();
LPVOID lpMsgBuf;
std::string strErrorMessage;
FormatMessage(FORMAT_MESSAGE_ALLOCATE_BUFFER | FORMAT_MESSAGE_FROM_SYSTEM | FORMAT_MESSAGE_IGNORE_INSERTS, NULL, dwLastError, MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT), (LPTSTR) &lpMsgBuf,    0, NULL);
if (lpMsgBuf)
{
    strErrorMessage = (const TCHAR*)lpMsgBuf;
    LocalFree(lpMsgBuf);
} 
```

您也可以简单地调用 GetLastError() 并[在此处查找其返回值](http://msdn.microsoft.com/en-us/library/ms681381(VS.85).aspx)。

# open-source - 向开源项目成员支付错误修复和功能的费用

> ID：687003
> 
> 赞同：19
> 
> 时间：2009-03-26T18:25:47.697
> 
> 标签：open-source

我有一个问题要解决，我认为需要 4 天，但如果我有一个功能请求排序和快照发布，那么我认为我可以一次性完成。从表面上看，这创建了 3 倍我每日费率的预算，以使其功能请求得到执行。

所以我的问题是，你有没有付钱让 O/S 项目成员为你修复一些东西？效果好吗？你是如何把这个想法卖给你的经理/同事的？钱是从哪里来的？

最重要的是，你是如何很好地询问的？这些东西有礼仪吗？项目负责人可能会接受这个想法吗？

万一重要的是，缺少功能的软件是 JBoss 项目——专业开源的家园——我可以报销费用，因为我是一名承包商。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-26T18:49:09.310

在工作中，我们很幸运地聘请了开源维护者来增强我们使用的库。

以下是我们过去做过的一些项目：

1.  我们需要将 Quake 2 与 wxWidgets 集成。我们聘请了 wxWidgets 的主要贡献者 Vadim Zeitlin。在不到 4 天的时间里，他通过适配 Windows 版本的 Quake 2 构建了一个 wxQuake2 小部件。
2.  后来，我们需要对原始位图进行便携式访问。所以我们再次聘请了 Vadim，并与他一起制作了一个新的原始位图 API。这涉及大量的设计工作，但我们真的很喜欢由此产生的 API，并且一直使用它。
3.  后来，我们聘请了另一位核心贡献者来改进 wxWidgets 可访问性支持。事实证明，由于各种技术原因，我们最终没有立即使用此代码。但从那时起，其他人一直在增强此代码，我们希望有一天能使用它。

换句话说，雇佣开源维护者很像雇佣任何其他类型的承包商。但有些事情也有点不同。根据我们的经验，这里有一些建议：

1.  如果您想增强现有项目并将更改作为开源发布，您将获得最大的运气。
2.  一般来说，你想雇佣核心团队的成员。他们拥有最好的跟踪记录，他们是最有生产力的，并且他们最有可能将您的更改合并到上游。
3.  您希望将更改合并到上游。如果你不这样做，你将维护一个本地分叉，这是一个令人头疼的问题。
4.  在招聘之前，做一些研究。谁负责您关心的功能？他们是你喜欢和他们一起工作的人吗？阅读邮件列表并浏览版本控制历史记录，然后挑选几个人来接近。
5.  在设计阶段，可能会有一些让步。开发人员正在查看项目的更大健康状况，而您正在查看特定业务的需求。这有时会使我们的谈判变得更加复杂，但最终的结果通常是比我们自己选择的更好的设计。

最重要的是，不要害羞。在任何足够大的开源项目中，核心团队的几名成员都已经在经营咨询业务。在较小的开源项目中，您通常会找到几个*想要*经营咨询业务的贡献者。

如果你仍然对接近某人犹豫不决，你可以随时问：“你知道有没有人有兴趣在 $FEATURE 上获得报酬？” 如果他们不感兴趣，你没有把他们放在现场，他们可能会告诉你该问谁。

总的来说，我们对开源维护者的专业精神和生产力印象深刻，我会向其他人推荐这条路线。

# bash - 在意外的 bash 退出中删除创建的临时文件

> ID：687014
> 
> 赞同：103
> 
> 时间：2009-03-26T18:28:33.743
> 
> 标签：bash, exit, temporary-files

我正在从 bash 脚本创建临时文件。我在处理结束时删除它们，但由于脚本运行了很长时间，如果我在运行期间将其杀死或只是 CTRL-C，临时文件不会被删除。
有没有办法在执行结束之前捕获这些事件并清理文件？

此外，这些临时文件的命名和位置是否有某种最佳实践？
我目前不确定是否使用：

```
TMP1=`mktemp -p /tmp`
TMP2=`mktemp -p /tmp`
... 
```

和

```
TMP1=/tmp/`basename $0`1.$$
TMP2=/tmp/`basename $0`2.$$
... 
```

或者也许有更好的解决方案？

* * *

## 回答 #1

> 赞同：133
> 
> 时间：2009-03-26T18:42:28.733

我通常创建一个目录来放置我的所有临时文件，然后立即创建一个 EXIT 处理程序以在脚本退出时清理此目录。

```
MYTMPDIR="$(mktemp -d)"
trap 'rm -rf -- "$MYTMPDIR"' EXIT 
```

如果您将所有临时文件放在 下`$MYTMPDIR`，那么在大多数情况下，当您的脚本退出时，它们都会被删除。使用 SIGKILL (kill -9) 终止进程会立即终止该进程，因此您的 EXIT 处理程序不会在这种情况下运行。

* * *

## 回答 #2

> 赞同：109
> 
> 时间：2009-03-26T18:32:01.427

您可以设置一个“[陷阱](http://tldp.org/LDP/Bash-Beginners-Guide/html/sect_12_02.html)”以在退出时执行或在 control-c 上执行以进行清理。

```
trap '{ rm -f -- "$LOCKFILE"; }' EXIT 
```

或者，我最喜欢的 unix-isms 之一是打开一个文件，然后在你仍然打开它的时候删除它。该文件保留在文件系统上，您可以对其进行读写，但是一旦您的程序退出，该文件就会消失。不过，不确定如何在 bash 中做到这一点。

顺便说一句：我将支持 mktemp 而不是使用您自己的解决方案的一个论点：如果用户预计您的程序将创建巨大的临时文件，他可能希望设置`TMPDIR`为更大的位置，例如 /var/tmp。mktemp 认识到，您的手动解决方案（第二个选项）没有。例如，我经常使用`TMPDIR=/var/tmp gvim -d foo bar`。

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2009-03-26T18:34:49.343

您想使用[trap](http://www.gnu.org/software/bash/manual/bashref.html#index-trap)命令来处理退出脚本或 CTRL-C 之类的信号。有关详细信息，请参阅[Greg 的 Wiki](https://mywiki.wooledge.org/SignalTrap)。

对于您的临时文件，使用`basename $0`是一个好主意，并提供一个模板来为足够的临时文件提供空间：

```
tempfile() {
    tempprefix=$(basename "$0")
    mktemp /tmp/${tempprefix}.XXXXXX
}

TMP1=$(tempfile)
TMP2=$(tempfile)

trap 'rm -f $TMP1 $TMP2' EXIT 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2017-01-09T19:57:05.433

请记住，选择的答案是`bashism`，这意味着解决方案为

```
trap "{ rm -f $LOCKFILE }" EXIT 
```

`dash`只能在 bash 中工作（如果 shell 是或 classic ，它不会捕获 Ctrl+c `sh`），但如果你想要兼容性，那么你仍然需要枚举你想要捕获的所有信号。

另请记住，当脚本退出时，始终执行信号“0”（又名 EXIT）的陷阱，从而导致`trap`命令的双重执行。

这就是如果有 EXIT 信号时不将所有信号堆叠在一行中的原因。

为了更好地理解它，请查看以下脚本，该脚本无需更改即可跨不同系统工作：

```
#!/bin/sh

on_exit() {
  echo 'Cleaning up...(remove tmp files, etc)'
}

on_preExit() {
  echo
  echo 'Exiting...' # Runs just before actual exit,
                    # shell will execute EXIT(0) after finishing this function
                    # that we hook also in on_exit function
  exit 2
}

trap on_exit EXIT                           # EXIT = 0
trap on_preExit HUP INT QUIT TERM STOP PWR  # 1 2 3 15 30

sleep 3 # some actual code...

exit 
```

此解决方案将为您提供更多控制，因为您可以在最终退出（函数）之前出现实际信号`preExit`时运行一些代码，如果需要，您可以在实际 EXIT 信号处运行一些代码（退出的最后阶段）

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-28T23:35:00.730

使用带有 $$ 的可预测文件名的替代方案是一个巨大的安全漏洞，您永远不应该考虑使用它。即使它只是您单用户 PC 上的一个简单的个人脚本。这是一个你不应该养成的非常坏的习惯。[BugTraq](http://www.securityfocus.com/archive/1)充满了“不安全的临时文件”事件。有关临时文件的安全方面的更多信息，请参见[此处](http://www.linuxsecurity.com/content/view/115462/151/)、[此处](http://www.dwheeler.com/secure-programs/Secure-Programs-HOWTO/avoid-race.html#TEMPORARY-FILES)和[此处。](http://chara.epfl.ch/~fsalvi/docs/linux/creating_temporary_files_in_shell_scripts.pdf)

我最初考虑引用不安全的 TMP1 和 TMP2 分配，但转念一想这可能[不是一个好主意](http://tarmo.fi/blog/2005/09/09/dont-draw-diagrams-of-wrong-practices-or-why-people-still-believe-in-the-waterfall-model/)。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2020-04-24T13:45:56.360

我不敢相信这么多人认为文件名不包含空格。如果将 $TMPDIR 分配给“临时目录”，世界将会崩溃。

```
zTemp=$(mktemp --tmpdir "$(basename "$0")-XXX.ps")
trap "rm -f ${zTemp@Q}" EXIT 
```

文件名中的空格和其他特殊字符（如单引号和回车符）应在代码中被视为良好编程习惯的要求。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-07-21T09:35:26.690

我更喜欢使用`tempfile`which 在 /tmp 中以安全的方式创建文件，您不必担心它的命名：

```
tmp=$(tempfile -s "your_sufix")
trap "rm -f '$tmp'" exit 
```

* * *

## 回答 #8

> 赞同：-5
> 
> 时间：2009-03-26T18:33:45.900

您不必费心删除那些用 mktemp 创建的 tmp 文件。无论如何，它们将在以后被删除。

如果可以，请使用 mktemp，因为它会生成更多唯一文件，然后是 '$$' 前缀。它看起来更像是创建临时文件然后显式将它们放入 /tmp 的跨平台方式。

# java - 如何使用 Oracle jdbc 驱动程序的 fixedString 属性？

> ID：687018
> 
> 赞同：4
> 
> 时间：2009-03-26T18:30:31.617
> 
> 标签：java, oracle, jdbc

Oracle 在 char 列中填充值，因此如果我在 CHAR(2) 列中插入“a”，则无法通过将该列与“a”进行比较来获得该记录，我应该通过将其与“a”进行比较来获得它。对？

为了解决这个问题，Oracle jdbc 驱动程序具有属性 fixedString 但我无法使其工作。[（在这里](https://docs.oracle.com/database/121/JAJDB/oracle/jdbc/OracleConnection.html#CONNECTION_PROPERTY_FIXED_STRING)寻找*固定字符串* ）

我正在为 Oracle 10gR2 使用 ojdbc14.jar 驱动程序并访问 Oracle 10gR2 数据库。

这是我的代码：

```
 try {
        Properties props = new Properties();
        props.put("user", "****");
        props.put("password", "****");
        props.put("fixedString", true);

        Class.forName("oracle.jdbc.driver.OracleDriver");

        String jdbcUrl = "jdbc:oracle:thin:@<host>:<port>:<sid>";

        Connection connection = DriverManager.getConnection(jdbcUrl, props);

        PreparedStatement ps = connection.prepareStatement(
                           "SELECT * FROM MY_TABLE WHERE MY_TABLE_ID = ?");
        ps.setObject(1, "abc"); // (*)
        // MY_TABLE_ID is CHAR(15)

        ResultSet rs = ps.executeQuery();
        while (rs.next())
        {
            System.out.print("data: ");
            System.out.println(rs.getString("MY_TABLE_ID"));
        }
        rs.close();
        ps.close();
        connection.close();
    } catch (SQLException ex) {
        ex.printStackTrace();
    } catch (ClassNotFoundException ex) {
        ex.printStackTrace();
    } 
```

上面的代码执行得很好（没有抛出异常），但是在 executeQuery() 之后 ResultSet 是空的。

如果我将行 (*) 更改为

```
ps.setObject(1, "abc            "); 
```

然后我得到了我想要的专栏。所以似乎驱动程序忽略了 fixedString 选项。

我也尝试将行 (*) 更改为

```
ps.setObject(1, "abc", java.sql.Types.CHAR); 
```

但是我得到的 ResultSet 又是空的。**我错过了什么？**

提前致谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-08-27T06:50:01.590

尝试将其用作

```
props.put("fixedString", "true"); 
```

Oracle 文档将fixedString 称为字符串（包含布尔值）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T18:34:47.923

您应该只对数据库中每个条目的长度相同的字符串使用 CHAR。对可变长度字符串使用 VARCHAR。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T19:57:25.107

oracle 文档真的很让人生气。在您提出问题之前我从未听说过这个（我喜欢这个网站的一件事）。对此进行了调查，发现一些参考文献提到它将使用“FIXED CHAR”语义，但没有描述它们如何工作或您的预期返回值将是什么，只有关于匹配和相等的行为。您可以使用“喜欢”进行查询吗？（当然要慢得多）关闭该查询的固定字符语义？仅将修剪后的值插入数据库？

参考[这里](https://docs.oracle.com/database/121/JAJDB/constant-values.html)，[这里](http://www.stanford.edu/dept/itss/docs/oracle/10g/java.101/b10979/basic.htm)，[这里](https://docs.oracle.com/database/121/JAJDB/oracle/jdbc/OracleConnection.html#CONNECTION_PROPERTY_FIXED_STRING)。

# c# - 在 C# 2.0 中使用 HashSet，兼容 3.5

> ID：687034
> 
> 赞同：18
> 
> 时间：2009-03-26T18:35:10.187
> 
> 标签：c#, .net, visual-studio-2005

我真的很想在我的程序中使用哈希集。使用字典感觉很难看。我可能有一天会开始使用 .Net 3.5 的 VS2008，所以我的理想是即使我不能（或者我可以？）在 VS2005 中使用[哈希集](http://msdn.microsoft.com/en-us/library/bb359438.aspx)，当我开始使用 .NET 3.5 时，我不想要为了切换到使用这些哈希集，必须进行大量更改（如果有的话）。

我想知道是否有人知道考虑到这一点设计的现有哈希集实现，或者在 VS2005 中使用 3.5 哈希集的方法。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-02T19:53:41.493

这是我为 2.0 编写的，它在内部使用 Dictionary<T, object>。它不是 3.5 HashSet<T> 的完全匹配，但它为我完成了这项工作。

```
using System;
using System.Collections;
using System.Collections.Generic;
using System.Runtime.Serialization;

public class HashSet<T> : ICollection<T>, ISerializable, IDeserializationCallback
{
    private readonly Dictionary<T, object> dict;

    public HashSet()
    {
        dict = new Dictionary<T, object>();
    }

    public HashSet(IEnumerable<T> items) : this()
    {
        if (items == null)
        {
            return;
        }

        foreach (T item in items)
        {
            Add(item);
        }
    }

    public HashSet<T> NullSet { get { return new HashSet<T>(); } }

    #region ICollection<T> Members

    public void Add(T item)
    {
        if (null == item)
        {
            throw new ArgumentNullException("item");
        }

        dict[item] = null;
    }

    /// <summary>
    /// Removes all items from the <see cref="T:System.Collections.Generic.ICollection`1"/>.
    /// </summary>
    /// <exception cref="T:System.NotSupportedException">The <see cref="T:System.Collections.Generic.ICollection`1"/> is read-only. </exception>
    public void Clear()
    {
        dict.Clear();
    }

    public bool Contains(T item)
    {
        return dict.ContainsKey(item);
    }

    /// <summary>
    /// Copies the items of the <see cref="T:System.Collections.Generic.ICollection`1"/> to an <see cref="T:System.Array"/>, starting at a particular <see cref="T:System.Array"/> index.
    /// </summary>
    /// <param name="array">The one-dimensional <see cref="T:System.Array"/> that is the destination of the items copied from <see cref="T:System.Collections.Generic.ICollection`1"/>. The <see cref="T:System.Array"/> must have zero-based indexing.</param><param name="arrayIndex">The zero-based index in <paramref name="array"/> at which copying begins.</param><exception cref="T:System.ArgumentNullException"><paramref name="array"/> is null.</exception><exception cref="T:System.ArgumentOutOfRangeException"><paramref name="arrayIndex"/> is less than 0.</exception><exception cref="T:System.ArgumentException"><paramref name="array"/> is multidimensional.-or-<paramref name="arrayIndex"/> is equal to or greater than the length of <paramref name="array"/>.-or-The number of items in the source <see cref="T:System.Collections.Generic.ICollection`1"/> is greater than the available space from <paramref name="arrayIndex"/> to the end of the destination <paramref name="array"/>.-or-Type T cannot be cast automatically to the type of the destination <paramref name="array"/>.</exception>
    public void CopyTo(T[] array, int arrayIndex)
    {
        if (array == null) throw new ArgumentNullException("array");
        if (arrayIndex < 0 || arrayIndex >= array.Length || arrayIndex >= Count)
        {
            throw new ArgumentOutOfRangeException("arrayIndex");
        }

        dict.Keys.CopyTo(array, arrayIndex);
    }

    /// <summary>
    /// Removes the first occurrence of a specific object from the <see cref="T:System.Collections.Generic.ICollection`1"/>.
    /// </summary>
    /// <returns>
    /// true if <paramref name="item"/> was successfully removed from the <see cref="T:System.Collections.Generic.ICollection`1"/>; otherwise, false. This method also returns false if <paramref name="item"/> is not found in the original <see cref="T:System.Collections.Generic.ICollection`1"/>.
    /// </returns>
    /// <param name="item">The object to remove from the <see cref="T:System.Collections.Generic.ICollection`1"/>.</param><exception cref="T:System.NotSupportedException">The <see cref="T:System.Collections.Generic.ICollection`1"/> is read-only.</exception>
    public bool Remove(T item)
    {
        return dict.Remove(item);
    }

    /// <summary>
    /// Gets the number of items contained in the <see cref="T:System.Collections.Generic.ICollection`1"/>.
    /// </summary>
    /// <returns>
    /// The number of items contained in the <see cref="T:System.Collections.Generic.ICollection`1"/>.
    /// </returns>
    public int Count
    {
        get { return dict.Count; }
    }

    /// <summary>
    /// Gets a value indicating whether the <see cref="T:System.Collections.Generic.ICollection`1"/> is read-only.
    /// </summary>
    /// <returns>
    /// true if the <see cref="T:System.Collections.Generic.ICollection`1"/> is read-only; otherwise, false.
    /// </returns>
    public bool IsReadOnly
    {
        get
        {
            return false;
        }
    }

    #endregion

    public HashSet<T> Union(HashSet<T> set)
    {
        HashSet<T> unionSet = new HashSet<T>(this);

        if (null == set)
        {
            return unionSet;
        }

        foreach (T item in set)
        {
            if (unionSet.Contains(item))
            {
                continue;
            }

            unionSet.Add(item);
        }

        return unionSet;
    }

    public HashSet<T> Subtract(HashSet<T> set)
    {
        HashSet<T> subtractSet = new HashSet<T>(this);

        if (null == set)
        {
            return subtractSet;
        }

        foreach (T item in set)
        {
            if (!subtractSet.Contains(item))
            {
                continue;
            }

            subtractSet.dict.Remove(item);
        }

        return subtractSet;
    }

    public bool IsSubsetOf(HashSet<T> set)
    {
        HashSet<T> setToCompare = set ?? NullSet;

        foreach (T item in this)
        {
            if (!setToCompare.Contains(item))
            {
                return false;
            }
        }

        return true;
    }

    public HashSet<T> Intersection(HashSet<T> set)
    {
        HashSet<T> intersectionSet = NullSet;

        if (null == set)
        {
            return intersectionSet;
        }

        foreach (T item in this)
        {
            if (!set.Contains(item))
            {
                continue;
            }

            intersectionSet.Add(item);
        }

        foreach (T item in set)
        {
            if (!Contains(item) || intersectionSet.Contains(item))
            {
                continue;
            }

            intersectionSet.Add(item);
        }

        return intersectionSet;
    }

    public bool IsProperSubsetOf(HashSet<T> set)
    {
        HashSet<T> setToCompare = set ?? NullSet;

        // A is a proper subset of a if the b is a subset of a and a != b
        return (IsSubsetOf(setToCompare) && !setToCompare.IsSubsetOf(this));
    }

    public bool IsSupersetOf(HashSet<T> set)
    {
        HashSet<T> setToCompare = set ?? NullSet;

        foreach (T item in setToCompare)
        {
            if (!Contains(item))
            {
                return false;
            }
        }

        return true;
    }

    public bool IsProperSupersetOf(HashSet<T> set)
    {
        HashSet<T> setToCompare = set ?? NullSet;

        // B is a proper superset of a if b is a superset of a and a != b
        return (IsSupersetOf(setToCompare) && !setToCompare.IsSupersetOf(this));
    }

    public List<T> ToList()
    {
        return new List<T>(this);
    }

    #region Implementation of ISerializable

    /// <summary>
    /// Populates a <see cref="T:System.Runtime.Serialization.SerializationInfo"/> with the data needed to serialize the target object.
    /// </summary>
    /// <param name="info">The <see cref="T:System.Runtime.Serialization.SerializationInfo"/> to populate with data. </param><param name="context">The destination (see <see cref="T:System.Runtime.Serialization.StreamingContext"/>) for this serialization. </param><exception cref="T:System.Security.SecurityException">The caller does not have the required permission. </exception>
    public void GetObjectData(SerializationInfo info, StreamingContext context)
    {
        if (info == null) throw new ArgumentNullException("info");
        dict.GetObjectData(info, context);
    }

    #endregion

    #region Implementation of IDeserializationCallback

    /// <summary>
    /// Runs when the entire object graph has been deserialized.
    /// </summary>
    /// <param name="sender">The object that initiated the callback. The functionality for this parameter is not currently implemented. </param>
    public void OnDeserialization(object sender)
    {
        dict.OnDeserialization(sender);
    }

    #endregion

    #region Implementation of IEnumerable

    /// <summary>
    /// Returns an enumerator that iterates through the collection.
    /// </summary>
    /// <returns>
    /// A <see cref="T:System.Collections.Generic.IEnumerator`1"/> that can be used to iterate through the collection.
    /// </returns>
    /// <filterpriority>1</filterpriority>
    public IEnumerator<T> GetEnumerator()
    {
        return dict.Keys.GetEnumerator();
    }

    /// <summary>
    /// Returns an enumerator that iterates through a collection.
    /// </summary>
    /// <returns>
    /// An <see cref="T:System.Collections.IEnumerator"/> object that can be used to iterate through the collection.
    /// </returns>
    /// <filterpriority>2</filterpriority>
    IEnumerator IEnumerable.GetEnumerator()
    {
        return GetEnumerator();
    }

    #endregion
} 
```

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-03-26T18:37:18.917

您现在可以`HashSet<T>`在 2.0 应用程序中使用 - 只需引用 System.Core.dll 就可以了。

**注意：**这将要求您安装免费且独立于 Visual Studio的[.NET 3.5 框架。](http://www.microsoft.com/downloads/details.aspx?FamilyID=AB99342F-5D1A-413D-8319-81DA479AB0D7&displaylang=en)安装完成后，您将拥有包含该`HashSet<T>`类型的新 System.Core 程序集。由于 .NET 框架版本 2.0 - 3.5 都共享相同的 CLR，因此您可以在 2.0 应用程序中使用此程序集而不会出现任何问题。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-26T18:52:24.670

您可以使用[Iesi.Collections](http://www.google.com/search?q=iesi+collections+generic)（NHibernate 使用）或[Mono 的 HashSet](https://github.com/mono/mono/blob/master/mcs/class/System.Core/System.Collections.Generic/HashSet.cs)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-26T21:55:13.653

[C5 库](http://www.itu.dk/research/c5/)也有一个 HashSet 实现。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-26T18:49:42.413

我认为[PowerCollections](http://www.codeplex.com/PowerCollections)库应该满足您的需求。它是一个开源库，其中包含 .NET 中缺少的几个集合类，包括`Set<T>`、`Bag<T>`等`MultiDictionary`。它在 .NET 2.0 上运行。我已经使用它几年了，我对它非常满意。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-26T18:37:34.063

您可以使用 using 指令将 Dictionary 别名为 Hashset。不是一回事，但它可能会在以后为您简化事情。

# c++ - 是否可以在 C++ 虚拟（纯）类成员中提供异常？

> ID：687049
> 
> 赞同：1
> 
> 时间：2009-03-26T18:41:02.263
> 
> 标签：c++, exception-specification

如果有怎么办？

我知道如何为成员提供异常规范，例如

```
class SOMEClass
{
public:

   void method(void)  throw (SOMEException); 

   virtual void pure_method(void) = 0;
}; 
```

所以`method`只有投掷`SOMEException`。如果我想确保`SOMEClass`throw `SOMEException`for的子类`pure_method`，是否可以添加异常规范？这种方法是否可行，还是我需要更多地了解异常和抽象方法以找出为什么可以（不能）完成？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-26T18:47:12.170

是的，纯虚拟成员可以有异常规范。

不过，我建议您阅读以下内容：[http](http://www.gotw.ca/publications/mill22.htm) ://www.gotw.ca/publications/mill22.htm ，然后再过多地参与异常规范。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T18:45:05.700

```
virtual void action() throw() = 0; 
```

有可能的。但仅适用于 throw() 情况。每次派生类忘记在其“action”方法声明中添加“throw()”规范时，编译器都会警告您。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T18:45:57.150

是的，尽管我没有尝试过，但我很确定将异常规范放在纯虚函数上。

然而，大多数 C++ 专家都同意，除了 nothrow 规范之外，C++ 异常规范非常无用，虽然它们是对编译器的提示，但它们的执行方式与它们在例如 Java 中的方式不同。

除非您将适当的 catch-all 块放入纯虚函数的每个实现中，否则您根本无法保证它只会抛出异常规范中列出的异常。

# open-source - 我应该向 Stack Overflow 等在线编程社区寻求许可建议吗？

> ID：687053
> 
> 赞同：5
> 
> 时间：2009-03-26T18:42:44.987
> 
> 标签：open-source, licensing, gpl

如果我正在编写非自由软件并且我想在一定程度上涉及 GPL 软件，并且我不确定 GPL 是否允许我分发我的代码的法律状况如何，我应该询问编程社区应该做什么做？

他们为我的国家和地区提供合理的法律建议的机会有多大？我应该直接访问[自由软件基金会的许可资源](http://www.fsf.org/licensing/education)吗？

谢谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-26T18:45:52.983

你最安全的选择是找律师。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-26T18:45:47.243

如果涉及金钱，您当然应该从律师那里获得专业建议，他们将有责任保险，不像我们SO上的人，

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-26T18:46:12.250

您应该要求更好地理解各种含义和激烈争论的观点，但最终您应该让律师帮助您。查看 FSF 的许可资源是个好主意。

您在互联网上免费获得的所有法律建议都物有所值。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-26T19:01:21.917

**我应该向 Stack Overflow 等在线编程社区寻求许可建议吗？**

不。

您应该向软件所有者询问他们的许可证，或聘请律师。“社区”不知道，最常回答的是“找律师”。

-亚当

# security - 漏洞利用“向后”进入出站 tcp 连接的风险

> ID：687059
> 
> 赞同：1
> 
> 时间：2009-03-26T18:43:44.050
> 
> 标签：security, tcp, firewall, network-protocols, exploit

我正在构建一个服务器应用程序，它将通过防火墙发起 TCP 连接来维持与其他应用程序的连接，该防火墙仅对应用程序将连接到的相关 IP 端口的出站流量开放。

有人接管了我们连接的机器，从而能够通过我们建立的出站连接向后利用我们的应用程序的风险是什么。

连接上使用的协议不难弄清楚，但它基于周期性的心跳（间隔 30 秒）。如果错过了两个连续的心跳，发起者（我们）将终止连接并重新连接。

我们应用程序的源代码或二进制文件对我们连接的组织不可用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T18:55:54.737

如果攻击者有权访问您连接的机器或网络，则攻击者很容易嗅探到您服务器的网络流量。这可能允许他对您的协议进行逆向工程，然后尝试将恶意数据注入返回到您服务器的数据中，或者完全替换客户端应用程序。

由于听起来您无法信任客户端应用程序，因此发起连接的人无关紧要，一旦建立连接，您就有了双向通信通道。在这种情况下，最好的办法是验证来自客户端的所有数据。

如果您可以信任客户端，但不能信任网络，那么为您的网络协议添加一些加密会有所帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T19:43:02.113

您的场景是一个相当普遍的场景，将网络与互联网完全隔离真的很少见。也就是说，请考虑以下因素：

*   第三方可以根据协议支持的内容发送信息。这几乎是一场失败的战斗，因为没有什么你可以真正依赖的东西可以完全阻止他们。见下文。
*   如果您想确保信息来自正确的第三方，那么您应该需要签名信息。一些更高级别的协议可以为您做到这一点。您会在实现中暴露于漏洞，但如果协议支持它，您自己的滚动将几乎不那么容易受到攻击。
*   如果要确保信息是私密的，则需要加密。一些更高级别的协议可以为您做到这一点。与上述相同的注释适用。
*   您会暴露于所使用的较低级别协议中的任何漏洞（隐式或显式）。自己动手做所有事情既不可能也不切实际，如果你这样做了，你可能会引入漏洞。当然，请确保拥有最新的补丁。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T18:51:20.833

如果您自己的应用程序服务器不监听任何传入数据，那么风险很小

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T18:51:41.440

除了向您说出您的协议之外，他们无法对您做任何事情。风险恰恰是任何可以做的事情，从他们的一端到你的一端，使用你的协议，都会被完成。

注意我并不是说他们必须向你讲一个*格式良好的*协议版本。如果您的系统使用 fgets() 将传入消息读入静态缓冲区，那么“缓冲区溢出”是使用您的协议可以对您执行的操作的一部分。

# scala - Scala 中的 _root_ 包是什么？

> ID：687071
> 
> 赞同：47
> 
> 时间：2009-03-26T18:46:18.240
> 
> 标签：scala, intellij-idea

我正在使用带有 Scala 插件的 IntelliJ IDEA。如果我在代码中引用 HashMap，然后使用 Alt-Enter 添加导入，则包将导入为：

```
_root_.scala.collection.immutable.HashMap 
```

这其中的*根源*是什么？它似乎可以使用和不使用它。

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-03-26T18:58:26.887

它必须做相对的 scala 导入 -`_root_`为您提供一种指定绝对包名称的方法。参见[Scala 维基](https://wiki.scala-lang.org/display/SYGN/Language+FAQs#LanguageFAQs-HowdoIimport)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-02-14T17:27:23.927

`_root_`Scala 语言规范在第 9.4 节**包参考**中对此进行了说明

 **> 特殊的预定义名称`_root_`是指包含所有顶级包的最外层根包。

有关完整的语言参考，请参阅以下 PDF：[http ://www.scala-lang.org/docu/files/ScalaReference.pdf](http://www.scala-lang.org/docu/files/ScalaReference.pdf)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-26T20:06:44.473

只有在当前包中有一个包含 HashMap 的嵌套包 scala.collection.immutable 时，才需要它。这将是不带 _root_ 部分的相对导入的首选。

**编辑：**这不太对，如果你有一个 scala 包作为祖先或嵌套在当前包中，问题就已经开始了。

# c# - StructureMap -> EnrichWith 丰富太多（其他实例）

> ID：687075
> 
> 赞同：5
> 
> 时间：2009-03-26T18:47:21.903
> 
> 标签：c#, .net, inversion-of-control, structuremap

```
// Enrich with is enriching more than i want

public intefrace ICommand {
   void Execute();
}

// classes

public class A : ICommand {}
public class B : ICommand {}
public class MultiCommand : ICommand {
  public MultiCommand(ICommand[] commands) {}
}

// -- decorators
public DecoratorOne : ICommand {
  public DecoratorOne(Icommand toDecorate) {}
}

public DecoratorTwo : ICommand {
  public DecoratorOne(Icommand toDecorate) {}
}

// what i tried

 ForREquesedType<ICommand>()
    .TheDefaultIsConcreteType<A>
    .EnrichWith(x => new DecoratorOne(x)
    .EnrichWith(y => new DecoratorTwo(y)
    .CacheBy(InstanceScope.Singleton);

 InstanceOf<ICommand>()
    .TheDefault.Is.OfConcreteType<B>
    .EnrichWith(x => new DecoratorOne(x)
    .WithName("secondCommand")

            ForRequestedType<MultiCommand>()
                .TheDefault.Is.OfConcreteType<MultiCommand>()
                .TheArrayOf<ICommand>()
                .Contains(y =>
                              {
                                  y.TheDefault();
                                  y.TheInstanceNamed("secondCommand")
                              })
                .WithName("multi"); 
```

**

## /// 我想做的事

**

我想要的是 A 是默认值。因此，任何需要 ICommand 实例的地方都会得到 A。MultiCommand 将同时具有 A 和 B，并将在循环中执行它们。

**

## // 我遇到的问题

**

B好像装修了几次。当我打电话时**`ObjectFactory.GetNamedInsance<ICommand>("secondCommand")`**，我得到了一些新的`**new DecoratorOne(new DecorateOne(B)).`** 我假设它正在被装饰，因为我对默认值的定义是 A。我怎样才能避免这种情况？

这也是将数组注入多命令的正确方法吗？

再次感谢，我是结构图的新手，因此将不胜感激。

## **更新**

我最终做的是创建一个 TypeInterceptor 的子类，它适当地修饰了类型。这对我来说感觉不对，但它比在我的代码中使用“新”要好。所以代码变成了

```
 RegisterInterceptor(new CommandDecoratorInterceptor());

        // this is the default that everyone hooks into
        ForRequestedType<ICOmmand>()
            .TheDefaultIsConcreteType<A>()
            .CacheBy(StructureMap.Attributes.InstanceScope.Singleton);

        InstanceOf<ICommand>()
            .Is.OfConcreteType<B>()
            .WithName("secondCommand");

        ForRequestedType<MultiCommand>()
            .TheDefault.Is.OfConcreteType<MultiCommand>()
            .TheArrayOf<ICommand>()
            .Contains(y =>
                          {
                              y.TheDefault();
                              y.TheInstanceNamed("secondCommand");
                          }); 
```

然后新的类型拦截器像以前一样装饰类。这允许 MultiMonitor 避免被装饰（丰富）。

任何有关改进这一点的建议将不胜感激；）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T22:23:31.447

在丰富之前不要使用 TheDefaultIsConcreteType。这就像在 ForRequestedType() 之后立即执行此操作一样，这表示您要丰富所有 ICommand。请改用 TheDefault.Is.OfConcreteType。

也不要加倍丰富，替换实例时它不会很好地链接。以下应该适用于您的方案：

```
 ForRequestedType<ICommand>()
        .CacheBy(StructureMap.Attributes.InstanceScope.Singleton)
        .TheDefault.Is.OfConcreteType<A>()
        .EnrichWith(x => new DecoratorTwo(new DecoratorOne(x)));
    InstanceOf<ICommand>().Is
        .OfConcreteType<B>()
        .EnrichWith(x => new DecoratorOne(x))
        .WithName("second");
    InstanceOf<ICommand>().Is
        .OfConcreteType<MultiCommand>()
        .TheArrayOf<ICommand>().Contains(y =>
        {
            y.TheDefault();
            y.TheInstanceNamed("second");
        })
        .WithName("multi"); 
```

# cobol - 与 cobol 中的重复记录进行文件比较

> ID：687076
> 
> 赞同：2
> 
> 时间：2009-03-26T18:47:36.070
> 
> 标签：cobol

如何比较 Cobol 中的两个文件，两个文件都有重复记录。any1 可以给出伪代码。代码必须在重复记录条件下工作

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T20:24:10.110

我不确定您到底在追求什么（例如，您希望从比较中报告什么），但一个想法可能是按如下方式进行：

*   使用来自目标的数据和连续的行号创建两个新的（临时）文件；将新文件从行号中删除
*   按行号逐步浏览这两个文件，收集您需要的数据。
*   如果按旧键，record_1 小于 record_2，则推进 file_1
*   如果更大，则提前 file_2
*   如果它们相等，则同时推进

在一个文件的 EOF 上，您需要检查剩余文件中的尾随唯一记录，这些记录可能在也可能不在 EOF。

# c++ - C++ 条件宏求值

> ID：687079
> 
> 赞同：5
> 
> 时间：2009-03-26T18:48:40.653
> 
> 标签：c++, gcc, macros, c-preprocessor

我有一个全局定义的符号，需要为我的源文件的给定子集有条件地未定义。所有需要特殊处理的文件都已经包含在 pre-inclusions 和 post-inclusions 中：

**前.h：**

```
#undefine mysymbol // [1] 
```

**post.h：**

```
#define mysymbol MY_SYMBOL_DEFINITION // [2] 
```

我的问题是，由于各种包含链接，给定的源文件可以多次包含`pre.h`and 。`post.h`因此，我需要[1](http://gcc.gnu.org/onlinedocs/gcc/Push_002fPop-Macro-Pragmas.html)在第一次包含 pre.h 时发生，我需要[2](https://stackoverflow.com/questions/619467/macro-to-replace-c-operator-new)发生在*最后一次*包含时`post.h`。从概念上讲：

```
pre         // undefine
   pre      // no-op
      pre   // no-op
      post  // no-op
   post     // no-op
post        // redefine 
```

由于我使用的是 GCC 3.4.6，因此我无法访问可能会为我解决此问题的[push 和 pop 宏编译指示。](http://gcc.gnu.org/onlinedocs/gcc/Push_002fPop-Macro-Pragmas.html)

如何使用剩余的预处理器功能模拟该行为？

我试图用预处理器来增加/减少一个值，但我不确定这是否可能。

“我到底想做什么？”

我们有宏要替换`new`——`new(__FILE__, __LINE__)`请参阅[我关于这个主题的另一个问题](https://stackoverflow.com/questions/619467/macro-to-replace-c-operator-new)——我们需要取消定义由上述前置和后置包含的源文件集中的这些宏，因为我们无法创建一个宏与其中使用的放置新语法兼容。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T19:27:05.803

您可以将这样的内容添加到您的 pre.h 文件中：

```
... 

#ifdef COUNT
#if COUNT == 2
#undef COUNT
#define COUNT 3
#endif

#if COUNT == 1
#undef COUNT
#define COUNT 2
#endif

#else
#define COUNT 1

... here put your pre.h code

#endif 
```

在 post.h 中：

```
#ifdef COUNT
#if COUNT == 1
#undef COUNT
#endif

#if COUNT == 2
#undef COUNT
#define COUNT 1
#endif

#if COUNT == 3
#undef COUNT
#define COUNT 2
#endif

...    

#end

#ifndef COUNT

... here put your pre.h code

#endif 
```

但你需要知道你能走多远。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T19:15:54.737

使用元编程魔法 a-la Loki 可能可以在编译时增加/减少一个值。但是你确定这是必要的吗？

为什么你的 h 文件被包含这么多次？为什么不使用包含防护？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T19:18:17.040

尝试：

### 文件 pre.h

```
#ifndef MYMACROGUARD
    #undef MYMACRO
    #define MYMACROGUARD MYMACROGUARD+1
#endif 
```

### 文件 post.h

```
#if MYMACROGUARD <= 0
    #undef MYMACROGUARD
#else
    #define MYMACROGUARD MYMACROGUARD-1
#endif 
```

使用此代码测试

```
#define MYMACRO

#include<iostream>

using namespace std;
int main()
{
    #ifdef MYMACRO
        cout<<"1"<<endl;
    #endif

    #include <pre.h>

    #ifdef MYMACRO
        cout<<"2"<<endl;
    #endif

    #include <pre.h>

    #ifdef MYMACRO
        cout<<"3"<<endl;
    #endif

    #include <post.h>

    #ifdef MYMACRO
        cout<<"4"<<endl;
    #endif

    #include <post.h>

    #ifdef MYMACRO
        cout<<"5"<<endl;
    #endif
}

$> g++ -w -I. test.cpp && ./a.out

1
5 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T19:22:29.900

如果您知道递归的最大深度，那么您应该能够通过在每个级别定义一个新宏来模拟推送/弹出。对于您给出的 3 级示例，它看起来像：

**前.h：**

```
#ifdef RECURSION_COUNT_1
 #ifdef RECURSION_COUNT_2
  #ifdef RECURSION_COUNT_3
   #error Recursion level too deep
  #else
   #define RECURSION_COUNT_3
  #endif
 #else
  #define RECURSION_COUNT_2
 #endif
#else
 #define RECURSION_COUNT_1
 #undef YOUR_SYMBOL_HERE
#endif 
```

**Post.h**

```
#ifdef RECURSION_COUNT_3
 #undef RECURSION_COUNT_3
#else
 #ifdef RECURSION_COUNT_2
  #undef RECURSION_COUNT_2
 #else
  #ifdef RECURSION_COUNT_1
   #undef RECURSION_COUNT_1
   #define YOUR_SYMBOL_HERE
  #endif
 #endif
#endif 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T19:32:48.957

pre.h

```
#ifndef MYSYMBOLUNDEFFERSTACK
#define MYSYMBOLUNDEFFERSTACK 0
#else
#define MYSYMBOLUNDEFFERSTACKTMP (MYSYMBOLUNDEFFERSTACK+1)
#undef MYSYMBOLUNDEFFERSTACK
#define MYSYMBOLUNDEFFERSTACK MYSYMBOLUNDEFFERSTACKTMP
#undef MYSYMBOLUNDEFFERSTACKTMP
#endif

#if MYSYMBOLUNDEFFERSTACK == 0
#undef mysymbol
#endif 
```

post.h

```
#ifndef MYSYMBOLUNDEFFERSTACK
#error "Async Post.h"
#else
#define MYSYMBOLUNDEFFERSTACKTMP (MYSYMBOLUNDEFFERSTACK-1)
#undef MYSYMBOLUNDEFFERSTACK
#define MYSYMBOLUNDEFFERSTACK MYSYMBOLUNDEFFERSTACKTMP
#undef MYSYMBOLUNDEFFERSTACKTMP
#endif

#if MYSYMBOLUNDEFFERSTACK == 0
#define mysymbol "MY_SYMBOL_DEFINITION"
#endif 
```

在这种情况下效果很好：

```
#include "stdio.h"
#include "pre.h"
#include "pre.h"
#include "pre.h"
//const char *pCompileError = mysymbol;
#include "post.h"
//const char *pCompileError = mysymbol;
#include "post.h"
//const char *pCompileError = mysymbol;
#include "post.h"

int main(void)
{
    const char *p = mysymbol;
    printf("%s\n", p);
    return 0;
} 
```

编辑：适用于 gcc 4.0。

# .net - VB.NET 将 xml 节点插入现有的 XML 文档

> ID：687081
> 
> 赞同：2
> 
> 时间：2009-03-26T18:49:16.610
> 
> 标签：.net, xml, vb.net

我只是想合并 2 个 xml 文档（将节点从一个添加到另一个）。我做了一些谷歌搜索，并尝试了一些东西，但我总是得到同样的错误“要插入的节点来自不同的文档上下文”

我确定我错过了一些简单的东西，看起来这不应该那么困难。

这是我的代码：

```
 Dim xmlDoc482 As XmlDocument = New XmlDocument
    Dim xmlDoc486 As XmlDocument = New XmlDocument
    Dim xmlDoc490 As XmlDocument = New XmlDocument

    xmlDoc482.LoadXml(strSettlement482)
    xmlDoc486.LoadXml(strSettlement486)
    xmlDoc490.LoadXml(strSettlement490)

    Dim xmlSummarysNode490 As XmlNode = xmlDoc486("Summarys")
    Dim xmlSummaryNode482 As XmlNode = xmlDoc482("Summarys").LastChild
    Dim xmlSummaryNode486 As XmlNode = xmlDoc486("Summarys").LastChild

    Dim nodeDest As XmlNode
    nodeDest = xmlDoc490.ImportNode(xmlSummaryNode482, True)
    xmlSummarysNode490.AppendChild(nodeDest)

    nodeDest = xmlDoc490.ImportNode(xmlSummaryNode486, True)
    xmlSummarysNode490.AppendChild(nodeDest) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T19:19:28.037

尝试将导入的节点附加到 DocumentElement 而不是 Dim xmlSummarysNode490 As XmlNode = xmlDoc486("Summarys") 行。

```
xmlDoc490.DocumentElement.AppendChild(nodeDest) 
```

您也可以在插入之前尝试使用*CloneNode()*而不是*ImportNode()*。

最后，过去帮助我合并的东西是构建一个简单的容器 xml，然后将子文档全部转储到其中。

```
xmlMerged.LoadXML("<set></set>") 
```

所以它变成：

```
<set>
 <Summary>....</Summary>
 <Summary>....</Summary>
 ...
</set> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T19:40:29.280

您可以创建一个辅助函数（或者甚至更好的扩展方法）来创建 XML 节点的副本，但将节点的关联文档更改为您要合并到的文档。您也可以尝试使用反射，但这会有点混乱......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-03T06:27:34.623

这是将 2 个具有相同架构的 xml 合并的简单方法：

```
Dim x1 As New Dataset
x1.ReadXml(path1)
Dim x2 As New Dataset
x2.ReadXml(path2)

x1.Merge(x2)
x1.WriteXml(path3) 
```

您可能可以根据自己的情况进行调整。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T19:52:07.427

这很好用，除了我的愚蠢，愚蠢的错字

这：

```
Dim xmlSummarysNode490 As XmlNode = xmlDoc486("Summarys") 
```

应该是这样的：

```
Dim xmlSummarysNode490 As XmlNode = xmlDoc490("Summarys") 
```

必须使用要添加到的文档来添加元素/节点。

# windows - 在多个 Windows 服务器上运行命令

> ID：687084
> 
> 赞同：4
> 
> 时间：2009-03-26T18:50:01.647
> 
> 标签：windows, windows-xp, command, execution

我维护了许多运行 Windows Server 2003 的负载平衡 Web 服务器。今天，当我想对这些服务器进行更改时，我使用了一个繁琐的过程：打开与每个服务器的远程桌面连接，然后从命令提示符运行命令在每台服务器上。这需要很多时间。

我想做的是在一个中央服务器上运行一个命令或编写一个脚本，该服务器访问每个其他 Windows 服务器并在每个服务器上运行相同的命令。在这种情况下，我希望在 5 到 10 台服务器上运行该命令，但可能不超过 10 台。

在远程服务器上运行的命令可以是以下任何一种：

复制一个文件重新编译——我们已经在每台服务器上都有一个 .bat 文件。源代码控制 (SVN) 签出或更新。可以从 Windows 命令外壳运行的任何其他命令。

此外，我拥有域管理员权限以及每个服务器的特定登录名和密码信息。

我知道如何使用 SSH 在 Linux/Unix 中执行此操作，所以请回答说切换到 Linux。

在此先感谢您的帮助。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-26T18:56:46.280

你可以试试[SysInternals`PsExec`](http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T18:56:15.830

[PSExec](http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T10:55:32.077

在 Windows 上安装 RSH 服务器。

RSH 最初存在于 UNIX 下，因此也存在于 Linux 下。

大约十年前，我将此解决方案用于分布式构建系统，该系统同时在 Windows、Solaris 和 HPUX 上构建了几个应用程序。每台机器上运行一个 RSH 服务器，控制机器向它们发出命令。

我们使用了第三方 RSH 服务器，我不知道它的名称。

Windows Server 曾经附带一个 RSH 恶魔，但我认为它刚刚从构建中删除。

# vb.net - 将表示 24 小时时间的字符串转换为 12 小时时间 VB.NET

> ID：687085
> 
> 赞同：2
> 
> 时间：2009-03-26T18:50:23.380
> 
> 标签：vb.net, datetime

# 解决方案

感谢[casperOne 的回答](https://stackoverflow.com/questions/687085/converting-a-string-representing-24h-time-to-12h-time-vb-net/687105#687105)，这是我得到的函数：

```
Shared Function FormatDate(ByVal s As String) As String
    Dim DT As DateTime
    s = Regex.Replace(s, "[^1234567890]", "")
    DT = DateTime.ParseExact(s, "HHmm", _
        Globalization.CultureInfo.InvariantCulture)
    Return DT.ToString("h:mm tt")
End Function 
```

* * *

我正在阅读一个以字符串格式保存时间信息的数据库，hh:mm。出于某种原因，我想起了我很久以前用来完成的内置功能，但是对于我的生活，我不记得如何去做。所以相反，我写了这个快速的脏函数：

```
 Shared Function FormatDate(ByVal s As String) As String
    '' this function takes a time string from the database
    '' and changes it from 24h to 12h

    Dim oSplit As String() = s.Split(":"c)
    Dim oRet As String = "", suffix As String = ""
    Dim hour, minute As String

    If CInt(oSplit(0)) > 12 Then
        hour = CStr(CInt(oSplit(0)) - 12)
        suffix = "PM"
    Else
        hour = oSplit(0)
        suffix = "AM"
    End If
    minute = oSplit(1)
    oRet = String.Format("{0}:{1} {2}", hour, minute, suffix)
    Return oRet
End Function 
```

有谁知道我认为我指的特定功能？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T18:55:14.163

您可以在此处查看问题“如何将 1400-1500 转换为下午 2 点 - 下午 3 点？”的答案：

[如何将 1400-1500 转换为 2pm - 3pm？](https://stackoverflow.com/questions/674269/how-to-convert-1400-1500-to-2pm-3pm/674320#674320)

在格式中，您将格式中的大写 H 替换为小写 h 以切换到 12 小时格式。

# nhibernate - NHibernate：HQL 等效于 Criteria Expression.In()？

> ID：687087
> 
> 赞同：1
> 
> 时间：2009-03-26T18:50:36.077
> 
> 标签：nhibernate, hibernate, hql, criteria

您将如何在 HQL 中表达以下 Criteria 查询？

```
var idArray = new int[] { 1, 2, 3, 4, 5 };

Session.CreateCriteria(typeof(Foo))
    .Add(Expression.In("Id", idArray)
    .List<Foo>(); 
```

我知道 HQL 中有一个“in”关键字，但据我了解，该关键字用于子查询，而不是像“... where Id in (1, 2, 3, 4, 5)”之类的东西之类的。如果不是这样，我很乐意接受更正。

谢谢/埃里克

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T19:00:08.097

试试这个：

```
var idArray = new int[] { 1, 2, 3, 4, 5 };
var foos = Session
    .CreateQuery("from Foo f where f.Id in (:ids)")
    .SetParameterList("ids", idArray)
    .List<Foo>(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-02-09T20:12:35.753

这也有效

```
ICriteria sc = session.CreateCriteria(typeof(Foo));
sc.Add(Restrictions.In("id",new[] { 1, 2 }));
siteList = sc.List();
session.Close(); 
```

# .net - 如何为 DataContractSerializer 设置 StreamingContext？

> ID：687088
> 
> 赞同：5
> 
> 时间：2009-03-26T18:51:03.173
> 
> 标签：.net, datacontractserializer

我有一些类似这样的代码：

```
[DataContract]
class Foo {
    [OnSerializing]
    private void BeforeSerialize(StreamingContext ctx)
    {
        ((MtType)ctx.Context).DoStuff()
    }

    ...
}

var reader = new XmlTextReader(filename);
var serializer = new DataContractSerializer(typeof(Type));
Type type = (Type)serializer.ReadObject(reader); 
```

我需要提供`StreamingContext`结构。我发现[了几个](http://social.msdn.microsoft.com/Forums/en-US/netfxremoting/thread/1db51319-9b1d-4ef1-8cff-1e7813d8a936/)可以这样做的参考资料，`NetDataContractSerializer`但没有`DataContractSerializer`。

*   有没有办法使这项工作？
*   我只是做错了吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-02-03T19:14:57.947

使用 IDataContractSurrogate 可让您在每个类型或每个对象的基础上进行自定义 JSON 序列化和反序列化。

请参阅API 文档的[IDataContractSurrogate 方法，并参阅示例的](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.idatacontractsurrogate_methods.aspx)[DataContract Surrogate](http://msdn.microsoft.com/en-us/library/ms751540%28v=vs.85%29.aspx)。

此外，要读取和解释 JSON，您将从 JsonReaderWriterFactory 开始，而不是 XML 工厂。请参阅[JsonReaderWriterFactory 类](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.json.jsonreaderwriterfactory.aspx)以了解我的意思。

希望这可以帮助！

# c# - C#：如何访问表单类之外的按钮

> ID：687090
> 
> 赞同：1
> 
> 时间：2009-03-26T18:51:26.170
> 
> 标签：c#, .net, winforms

我想启用或禁用另一个文件中的按钮，我应该怎么做？

这是表单类声明：

```
public partial class Form1 : Form 
```

我试过了

```
Form.btnName.enabled = false/true 
```

但没有 btnName 成员。

提前致谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-26T18:57:14.533

只需公开一个公共方法：

```
public void EnableButton(bool enable)
{
    this.myButton.Enabled = enable;
} 
```

更正：

```
public void EnableButton()
{
    this.myButton.Enabled = true;
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T18:57:44.453

您需要通过将 btnName 成员公开或使用某种属性将其公开给其他类。例如将以下代码添加到 Form1

```
public Button ButtonName { get { return btnName; } } 
```

现在您可以将 form.ButtonName 用于 Form1 的任何实例

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-26T19:07:00.780

我真的建议阅读有关表单如何适应 .net 的更多信息。您在该示例代码“Form.btnName.enabled = false/true”中有几个问题

*   您的表单称为 Form1，它继承自 Form。
*   表单是实例，实际上您可以在属于同一类的应用程序中拥有不同的表单实例。
*   由于上述原因，访问 Form1.btnName 是没有意义的。您必须通过特定实例来完成。
*   默认情况下，表单的控件不是公共的，为此定义一个方法。
*   Windows 窗体项目，通常有一个运行窗体的主程序。在那里，您可以访问表单实例并将其交给应用程序中的其他对象。
*   以上回答了具体问题。请注意，有多种方法可以实现不同的场景，而您真正想做的可能不需要上述方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T18:57:09.697

这是因为默认情况下，表单上的控件不是公开的（与 VB6 中的所有控件都公开公开不同）。

我相信您可以将设计器中的可见性访问器更改为公共，但这通常是一个坏主意。

相反，您应该在表单上公开一个方法，该方法将对按钮执行操作，并使该方法可被您想要调用它的任何代码访问。这允许更大的封装，并有助于防止代码中出现副作用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T18:56:42.553

您必须在 Form1 的特定实例上指定它。

即：如果你有类似的东西`Form1 myForm = new Form1(...);`，那么你可以做`myForm.btnName.Enabled = false;`

这也要求 btnName 是公开的。与直接提供对默认情况下私有按钮字段成员的公共访问相比，创建属性或访问器来检索它会“更好”。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-26T18:56:46.530

您需要添加公共属性或方法来设置按钮。

```
public void DisableBtnName()
{
  this.btnName.Enabled=false;
}

public Button BtnName
{
    get { return this.btnName;}
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-07-06T10:42:57.403

**在 Form1**中，为外部类创建一个对象（在参数中添加按钮名称）

```
Class1 obj_Class1 = new Class1(btnName); 
```

**在 Class1**中，创建一个私有按钮

```
private System.Windows.Forms.Button btnName; 
```

**在 Class1 构造中**

```
 public Class1(System.Windows.Forms.Button btnName)
        {
            this. btnName = btnName;
        } 
```

然后您可以访问您的按钮，例如，

```
btnName.enabled = false/true; 
```

# windows - 是否可以渐进式播放 DRMed 曲目

> ID：687095
> 
> 赞同：1
> 
> 时间：2009-03-26T18:52:55.947
> 
> 标签：windows, audio, drm, wma

从 HTTP 链接下载的 Windows Media DRM 曲目是否可以合法渐进播放？

我已经设法在没有 DRM 的情况下做到了这一点，但这里有人告诉我，使用 DRM 是不可能的。这是真的？

如果是这样，使用什么库或技术？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T19:24:38.740

是的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-22T07:30:24.853

我很确定这是可能的，也不违法。通常，有关内容加密的信息和实际加密内容的信息分开保存在同一个容器中。也就是说，元数据不加密，但内容加密。为了支持渐进式下载，内容通常被加密成小的可传输有序块。您的 DRM 客户端使用元数据来定位许可证服务器，然后从许可证服务器获取许可证和内容密钥。接下来，您的客户端下载内容“chunk-per-chunk”，解密每个块，并在下载时将其渲染为电影。

有关 SDK 的信息，请在[此处](http://www.microsoft.com/windows/windowsmedia/forpros/drm/components.aspx)查看不同的组件。

# winforms - 用复制和“更多详细信息”选项替换 WinForm MessageBox？

> ID：687098
> 
> 赞同：1
> 
> 时间：2009-03-26T18:53:30.953
> 
> 标签：winforms, messagebox

我见过一些应用程序带有一个允许用户复制消息的消息框和一个“更多详细信息”按钮，单击该按钮时，消息框会展开以显示更多信息。

是否有类似的免费组件可以下载并在我的 .NET 应用程序中使用（最好带有源代码）？我知道我可能可以开发一个，但我只想要一个现成的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T21:25:41.557

我敢打赌这个[代码项目页面](http://www.codeproject.com/KB/dialog/MessageBoxEx.aspx)会让你朝着正确的方向前进。我过去自己用过。

# sql - MySQL如何从[存储过程]插入[临时表]

> ID：687102
> 
> 赞同：25
> 
> 时间：2009-03-26T18:54:45.023
> 
> 标签：sql, mysql, stored-procedures

[这与问题653714](https://stackoverflow.com/questions/653714/how-to-select-into-temp-table-from-stored-procedure)非常相似，但适用于 MySQL 而不是 SQL Server。

基本上，我有一个复杂的选择，它是几个存储过程的基础。我想在存储过程中共享代码，但是，我不确定如何执行此操作。我可以做到这一点的一种方法是使共享选择一个存储过程，然后从其他存储过程中调用该存储过程。我不知道如何使用嵌套存储过程的结果集。如果我可以将它们放在临时表中，我可以有效地使用结果，但我无法弄清楚如何将它们放入临时表中。例如，这不起作用：

```
CREATE TEMPORARY TABLE tmp EXEC nested_sp(); 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-28T03:43:21.107

问题是，存储过程并没有真正直接返回输出。他们可以在脚本中执行 select 语句，但没有返回值。

MySQL 调用存储过程，`CALL StoredProcedureName();` 并且您不能将该输出定向到任何内容，因为**它们不返回任何内容**（与函数不同）。

[MySQL 调用命令](http://dev.mysql.com/doc/refman/5.1/en/call.html)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-01-02T19:18:36.297

您不能使用存储过程“SELECT INTO”。

首先创建临时表，并让您的存储过程使用普通的“INSERT INTO”将查询结果存储到创建的临时表中。只要您删除临时表或直到连接关闭，临时表就可见。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-26T19:59:02.777

我的第一反应是“这听起来像是我的观点”。这还不够抽象，因此您可以将可变性添加到每个案例的 SP 中吗？

任何添加临时表的东西，否则很可能是反模式。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-01-02T19:07:37.300

我知道这来得太晚了，但是由于我花了很长时间才找到真正的解决方案，所以我不妨分享一下。我研究了下面的一个例子。

创建的表是：

```
CREATE TABLE BOOK(
B_ID INT NOT NULL AUTO_INCREMENT,
PRIMARY KEY(B_ID),
TITLE VARCHAR(100),
DESCRIPTION VARCHAR(30),
PRICE DOUBLE);

CREATE TABLE BOOK_COMMENT(

PRIMARY KEY(B_C_ID),
B_C_ID INT NOT NULL AUTO_INCREMENT,
REMARK VARCHAR(120),
B_ID INT,
FOREIGN KEY(B_ID) REFERENCES BOOK(B_ID));

CREATE TABLE AUTHOR(
A_ID INT NOT NULL AUTO_INCREMENT,
PRIMARY KEY(A_ID),
A_NAME CHAR(15),
B_ID INT,

FOREIGN KEY(B_ID) REFERENCES BOOK(B_ID)); 
```

1.  分隔符

```
 CREATE PROCEDURE BOOK_IMPORTANT( _PRICE DOUBLE, _B_ID INT, A_NAME CHAR(15), _BD_ID INT)

BEGIN

INSERT INTO BOOK(PRICE)

VALUES(_PRICE);

SET _B_ID=LAST_INSERT_ID();

INSERT INTO BOOK_COMMENT(B_ID)

VALUES(_B_ID);

SET _BD_ID=LAST_INSERT_ID();

INSERT INTO AUTHOR(A_NAME,B_ID)

VALUES(A_NAME,_BD_ID);

END 
```

然后使用以下内容插入值。

```
CALL BOOK_IMPORTANT('0.79',LAST_INSERT_ID(),'',LAST_INSERT_ID()); 
```

`LAST_INSERT_ID()`获取表的最后一个自动增量并将其插入到子表的引用列中。

在过程参数`_B_ID`和`_BD_ID` 表示`B_ID`因为我需要`B_ID`在两个表中作为外键。

很抱歉措辞过多。所有其他人都希望你自动知道如何去做。希望能帮助到你

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2018-09-04T17:07:34.713

也许这是一个封闭的话题，但我想提供一个基于 MySQL 临时表属性的解决方案。首先，创建临时表的方法不是调用存储过程“CREATE TEMPORARY TABLE tmp EXEC nested_sp();”。查询是针对“基础设施”的临时表（以某种方式命名）。

为了达到预期的效果，需要创建 2 个存储过程，第一个存储过程处理数据并填充临时“基础结构”表，第二个存储过程读取该表并继续该过程，最后“删除” “基础设施”表

这是第一个存储过程：

```
 CREATE DEFINER = 'root'@'localhost'
PROCEDURE cajareal.priv_test()
BEGIN
  CREATE TEMPORARY TABLE IF NOT EXISTS  tmp(
      column1 TEXT
    , column2 TEXT
    , column3 TEXT
    );

  INSERT INTO tmp(column1, column2 , column3) VALUES(CURDATE(), CURRENT_DATE(), CURRENT_TIMESTAMP());

END 
```

这是第二个存储过程：

```
CREATE DEFINER = 'root'@'localhost'
PROCEDURE cajareal.priv_caller()
BEGIN
  CALL priv_test;

  -- Read data of "infrastructure" table
  SELECT * FROM tmp;

  -- Do the business logic

  -- Delete the "infrastructure" table
  DROP TABLE tmp;
END 
```

我使用这种技术来分析字符串并将其转换为表格

# java - Java servlet 过滤器在登录时不起作用

> ID：687127
> 
> 赞同：3
> 
> 时间：2009-03-26T19:00:41.793
> 
> 标签：java, servlets, servlet-filters

我编写了一个过滤器类来为每个页面添加一个 P3P 标题。我将此添加到我的 web.xml 中：

```
<filter>
    <filter-name>AddP3pHeaderFilter</filter-name>
    <filter-class>com.mycompany.AddP3pHeaderFilter</filter-class>
</filter>
<filter-mapping>
    <filter-name>AddP3pHeaderFilter</filter-name>
    <url-pattern>/*</url-pattern>
</filter-mapping> 
```

它将标头添加到每个页面请求，但在用户首次登录时不起作用。用户将表单提交到`j_security_check`，但响应不包含标头。如何使我的过滤器应用于登录请求？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T19:01:21.793

登录请求转发到相应的页面。默认情况下，过滤器仅适用于 REQUEST 调度。您需要修改 web.xml 如下：

```
<filter>
    <filter-name>AddP3pHeaderFilter</filter-name>
    <filter-class>com.mycompany.AddP3pHeaderFilter</filter-class>
</filter>
<filter-mapping>
    <filter-name>AddP3pHeaderFilter</filter-name>
    <url-pattern>/*</url-pattern>
    <dispatcher>REQUEST</dispatcher>
    <dispatcher>FORWARD</dispatcher>
</filter-mapping> 
```

**编辑：** 我以为这已经解决了，但我错了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T19:57:19.613

[在Tomcat中不起作用。](http://faq.javaranch.com/java/ServletsFaq#7)

我最终不得不使用Tomcat阀门。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-04-15T15:43:01.830

`/j_security_check`由于安全原因，大多数 servlet 容器确实不允许对请求进行挂钩。一些旧版本可以，但应该在新版本中修复。

无论如何，最好的方法是检查用户主体`HttpSession`是否存在，如果不存在，您手动将其放在那里。

```
public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) {
    HttpServletRequest httpRequest = (HttpServletRequest) request;
    UserPrincipal user = httpRequest.getUserPrincipal();
    HttpSession session = httpRequest.getSession();
    if (user != null && session.getAttribute("user") == null) {
        session.setAttribute("user", user);

        // First-time login. You can do your intercepting thing here.
    }
    chain.doFilter(request, response);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-07-05T12:38:26.427

不了解tomcat，但它在码头对我有用，只需将过滤器放在弹簧过滤器之前：

```
<filter>
    <filter-name>AddP3pHeaderFilter</filter-name>
    <filter-class>com.mycompany.AddP3pHeaderFilter</filter-class>
</filter>
<filter-mapping>
    <filter-name>AddP3pHeaderFilter</filter-name>
    <url-pattern>/*</url-pattern>
</filter-mapping>

<filter>
    <filter-name>springSecurityFilterChain</filter-name>
    <filter-class>org.springframework.web.filter.DelegatingFilterProxy</filter-class>
</filter>

<filter-mapping>
  <filter-name>springSecurityFilterChain</filter-name>
  <url-pattern>/*</url-pattern>
</filter-mapping> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-01-04T09:57:01.533

我的 web.xml

```
<filter>
        <description>
        FBIS Filter</description>
        <display-name>Fbisfilter</display-name>
        <filter-name>Fbisfilter</filter-name>
        <filter-class>fbis.filter.Fbisfilter</filter-class>
    </filter>
    <filter-mapping>
        <filter-name>Fbisfilter</filter-name>
        <url-pattern>/*</url-pattern>
    </filter-mapping> 
```

我的过滤器是

```
package fbis.filter;

import java.io.IOException;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

import javax.servlet.Filter;
import javax.servlet.FilterChain;
import javax.servlet.FilterConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import com.sqlconnection.SQLConnect;
import com.sun.security.auth.UserPrincipal;

import fbis.interfaces.abstractclasses.Connections;

/**
 * Servlet Filter implementation class Fbisfilter
 */
public class Fbisfilter extends Object implements Filter,Connections {
    public void destroy() {
    //  System.out.println("Filter Service finished");
    }
    public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {
        HttpServletRequest httpRequest = (HttpServletRequest) request;
        HttpServletResponse httpresponse = (HttpServletResponse) response;
        System.out.println("FILTER INSIDE");
    // place your code here
        HttpSession session = httpRequest.getSession(true);
        String usrid = httpRequest.getParameter("txtuname");
        String pwd = httpRequest.getParameter("txtpassword");
        PreparedStatement pstmt;
        try {
            pstmt = con
                    .prepareStatement("SELECT l.Userid,n.First_name from Login_details_dtls l join New_Registration_dtls n on l.Userid=n.Userid where n.Userid=? AND l.pwd=?");
        pstmt.setString(1, usrid);
        pstmt.setString(2, pwd);
        ResultSet rs = pstmt.executeQuery();
        if (rs.next()) {
            session.setAttribute("usr", rs.getString("Userid"));
            session.setAttribute("usrname", rs.getString("First_name"));
        }
        } catch (SQLException e) {
            e.printStackTrace();
        }
        chain.doFilter(httpRequest, httpresponse);
    }

    /**
     * @see Filter#init(FilterConfig)
     */
    public void init(FilterConfig fConfig) throws ServletException {
        System.out.println("Filter Service has started");
    }

} 
```

# jquery - jQuery 1.3.2 的模型框

> ID：687132
> 
> 赞同：0
> 
> 时间：2009-03-26T19:02:20.510
> 
> 标签：jquery

我正在使用 jQuery 1.3.2，我想知道是否有人知道可以使用它的模型箱/灯箱。我发现了一堆 jQuery 驱动的灯箱，但它们中的大多数都使用旧版本的 jQuery。

我将使用它来显示一个 html 表单，因此它需要它支持的不仅仅是图像。

谢谢

--

我最终选择了 colorbox，因为它真的很不错。我能看到的唯一缺点是，如果在您重新调整浏览器窗口大小后不会重新定位，但我可以没有它。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T19:09:03.943

我认为 1.3.2 没有什么特别的，因为它是最近的。

尽管[Thickbox](http://jquery.com/demo/thickbox/)很古老，但它仍然可以很好地工作，并且可以让您在模态中显示您想要的任何内容。

还可以查看[jqModal](http://dev.iceburg.net/jquery/jqModal/)以获得一个更新的插件，其中包含一些Thickbox 缺少的功能，例如回调。

我已经将这两个都与>1.3 jQuery 版本一起使用，没有任何问题，它们非常好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-30T22:06:30.393

[ColorBox](http://colorpowered.com/colorbox/)是我最近发现的一种，在功能上与Thickbox 相似。他们的主页表明它是针对 jQuery 1.3 构建的。

对我来说重要的特殊功能是：

*   外观完全通过 CSS 控制，因此用户可以重新设置框的样式。
*   优雅地降级，所有显示的内容都可以在没有 JavaScript 的情况下访问。
*   生成 W3C 有效的 XHTML 和 CSS，无 JSLint，不添加全局变量。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T19:23:15.483

我们同时使用了[SimpleModal](http://www.ericmmartin.com/projects/simplemodal/)和[FancyBox](http://fancy.klade.lv/)，并取得了不错的效果。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-30T21:33:09.273

**Slimbox 2：** [http ://www.digitalia.be/software/slimbox2](http://www.digitalia.be/software/slimbox2)

使用 jQuery 1.3.2 非常适合我，并且与原始 LightBox 一样简单。

# perl - 如何强制 IIS 7 刷新输出？

> ID：687133
> 
> 赞同：5
> 
> 时间：2009-03-26T19:02:35.893
> 
> 标签：perl, iis, iis-7

在 IIS 6 中，使用 Perl，我能够将输出流发送到客户端，而不是缓冲整个内容并一次性将其转储出去。这允许使用诸如进度条之类的东西。

我怎样才能在 IIS 7 中完成同样的事情？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T19:37:26.637

在 IIS 7 下，一旦您创建了 Perl 脚本脚本映射，您就可以添加一个属性来解决这个问题。

您修改 %windir%\system32\inetsrv\config\applicationHost.control 文件并按名称查找脚本映射（在我的例子中是 Perl-Script）。然后将 responseBufferLimit 属性添加到 XML 中，例如：

```
<add name="Perl-Script" path="*.pl" blah blah blah responseBufferLimit="0" /> 
```

这会导致 IIS 像在 IIS 6 中一样运行，但缓冲关闭。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2014-10-08T19:40:05.043

您可以自定义 Web 应用程序的 web.config 以设置`responseBufferLimit="0"`而不是更改全局设置。示例 web.config：

```
<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <system.webServer>
        <handlers>
            <add name="Perl CGI for .pl (custom)" path="*.pl" verb="GET,HEAD,POST" modules="CgiModule" scriptProcessor="C:\Perl64\bin\perl.exe &quot;%s&quot; %s" resourceType="File" requireAccess="Script" responseBufferLimit="0" />
        </handlers>
    </system.webServer>
    <system.web>
        <identity impersonate="false" />
    </system.web>
</configuration> 
```

将此文件放在 Web 根目录中。它将覆盖`*.pl`.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-12-28T17:42:56.037

在 IIS 7.5（Windows 7）中唯一对我有用的是以下命令，从 CMD 运行：

```
appcmd.exe set config /section:handlers "/[name='PHP_via_FastCGI'].ResponseBufferLimit:0" 
```

注意：您必须在“处理程序映射”**中将 PHP_via_FastCGI替换为您的 PHP 处理程序的名称。**

# asp.net - 我可以在 LinQ 中定义默认排序顺序吗

> ID：687134
> 
> 赞同：0
> 
> 时间：2009-03-26T19:02:50.697
> 
> 标签：asp.net, linq, sorting, listview, nested

如果我有一个嵌套的 ListView，并且我在 LinQ 中调用一个相关表，我如何对其进行排序，而不求助于父级的 ItemDataBound 事件？

伪代码（已更新解决方案）：

```
<asp:ListView ID="lv" runat="server" OnItemDataBound="lv_ItemDataBound" >
   <LayoutTemplate>
      <!-- Product Category Stuff --> 
      <asp:PlaceHolder Id="itemPlaceholder" runat="server"></asp:PlaceHolder>
   </LayoutTemplate>

   <ItemTemplate>
      <asp:ListView ID="lvInner" runat="server" DataSource='<%# <%# ((Category)Container.DataItem).Products.OrderBy(p => p.Description) %> %>'>
         <LayoutTemplate>
            <ul>
               <asp:PlaceHolder ID="itemPlaceholder" runat="server"></asp:PlaceHolder>
            </ul>
         </LayoutTemplate>
         <ItemTemplate>
            <li>Item Stuff</li>
         </ItemTemplate>
      </asp:ListView>
   </ItemTemplate>
</asp:ListView> 
```

也许该方法看似简单，但我希望内部**Products**按字段排序。如果我没记错的话，我看不到以声明方式执行此操作的方法，因为 LinQ 会动态创建此查询，并且不进行排序。

有什么想法吗？

**更新**

将示例更新为以下内容：

```
<%# ((Category)Container.DataItem).Products.OrderBy(p => p.Description) %> 
```

希望它可以帮助别人！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T19:11:16.713

我的假设是 Products 是一个`IEnumerable<Product>`（或 IQueryable）。如果是这样，为什么不将 OrderBy 方法添加到评估中，如下所示：

```
<%# Eval("Products.OrderBy(p => p.FieldToSortOn)") %> 
```

# c++ - throw/catch 异常命名的由来是什么？

> ID：687135
> 
> 赞同：5
> 
> 时间：2009-03-26T19:03:04.487
> 
> 标签：c++, exception

这个结构的创造者是棒球迷吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-26T19:06:40.483

参见 Stroustrup 的书“C++ 的设计与演变”——基本上，“raise”已经被采纳了。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-26T19:16:35.343

来自[http://www.cs.bgu.ac.il/~frankel/TechRep/pdfs/TR-08-03.pdf](http://www.cs.bgu.ac.il/~frankel/TechRep/pdfs/TR-08-03.pdf)

> MacLISP 是第一个引入 catch/throw 作为处理异常情况的异常处理机制[9]
> ...
> [9]Moon, DA MacLisp 参考手册。麻省理工学院 MAC 项目，1974 年 4 月。

-亚当

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-26T19:06:30.313

我不知道，但我记得 LISP 早在 76 年左右就有一个 THROW 函数。你会从一组嵌套很深的括号中抛出一个值，在它被捕获的地方，它会返回那个值。

# plsql - 防止sql注入的包

> ID：687145
> 
> 赞同：1
> 
> 时间：2009-03-26T19:06:50.360
> 
> 标签：plsql

是否已经编写了任何 pl/sql 包来处理所有阻止 SQL 注入的场景。如果有人知道这样的包，请告诉我。

谢谢你的帮助

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T19:08:40.013

准备好的报表

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-26T19:08:42.570

只需在 PL/SQL 中使用准备好的语句。这将防止sql注入

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T19:26:08.893

感谢您的回复，我正在寻找一个验证用户输入的包。比如只检查字母数字和特殊符号等如果包退出检查所有场景会很有帮助-</p>

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T19:42:04.550

这听起来更像是你想要一个[ORM](http://en.wikipedia.org/wiki/Object-relational_mapping)用于使用数据库的应用程序而不是 PostgreSQL 包。或者至少将您的代码封装在一个函数中以提供参数化。

这样想吧。SQL 注入通过将无效输入转化为恶意（但有效）的 SQL 来工作。至于它是否是有效的 SQL，数据库如何能够确定其他任何东西？如果它在所有情况下都可以判断，为什么不默认这样做而不是要求您使用某个包？

# printing - WebBrowser 控件 - 控制台应用程序 - 未触发事件

> ID：687146
> 
> 赞同：2
> 
> 时间：2009-03-26T19:07:00.687
> 
> 标签：printing, browser, webbrowser-control, console-application

我一直在浏览各种[WebBrowser 控件 stackoverflow 问题](https://stackoverflow.com/search?q=WebBrowser+control)，但我似乎无法找到我遇到的问题的答案。我正在尝试使用[WebBrowser 控件来打印网页](https://stackoverflow.com/questions/610183/printing-webbrowser-control-content)。按照[MSDN 的示例](http://msdn.microsoft.com/en-us/library/b0wes9a3.aspx)，我创建了以下控制台应用程序：

```
namespace WebPrintingMadness
{
    using System;
    using System.Collections.Generic;
    using System.Text;

    /// <summary>
    /// The entry point of the program.
    /// </summary>
    class Program
    {
        /// <summary>
        /// The main entry point of the program.
        /// </summary>
        /// <param name="args">Program arguments.</param>
        [STAThread]
        public static void Main(string[] args)
        {
            string url = "https://stackoverflow.com/";

            WebPagePrinter webPagePrinter = new WebPagePrinter();
            webPagePrinter.PrintWebPage(url);
            Console.ReadLine();
        }
    }
}

namespace WebPrintingMadness
{
    using System;
    using System.Collections.Generic;
    using System.Text;
    using System.Windows.Forms;

    /// <summary>
    /// This class is used to print a web page.
    /// </summary>
    internal class WebPagePrinter : IDisposable 
    {
        /// <summary>
        /// A System.Windows.Forms.WebBrowser control.
        /// </summary>
        private WebBrowser webBrowser;

        /// <summary>
        /// Initializes a new instance of the WebPagePrinter class.
        /// </summary>
        internal WebPagePrinter()
        {
            this.webBrowser = new WebBrowser();
            this.webBrowser.DocumentCompleted += new WebBrowserDocumentCompletedEventHandler(this.WebBrowser_DocumentCompleted);
            this.webBrowser.ScriptErrorsSuppressed = true;
        }

        /// <summary>
        /// Disposes of this instance.
        /// </summary>
        public void Dispose()
        {
            this.Dispose(true);
            GC.SuppressFinalize(this);
        }

        /// <summary>
        /// Prints a web page.
        /// </summary>
        /// <param name="url">The url of the web page.</param>
        internal void PrintWebPage(string url)
        {   
            this.webBrowser.Navigate(url);
        }

        /// <summary>
        /// Disposes of this instance.
        /// </summary>
        /// <param name="disposing">True if disposing, otherwise false.</param>
        protected virtual void Dispose(bool disposing)
        {
            if (disposing)
            {
                if (this.webBrowser != null)
                {
                    this.webBrowser.Dispose();
                    this.webBrowser = null;
                }
            }
        }

        /// <summary>
        /// Event handler for the webBrowser DocumentCompleted event.
        /// </summary>
        /// <param name="sender">The event sender.</param>
        /// <param name="e">The event arguments.</param>
        private void WebBrowser_DocumentCompleted(object sender, WebBrowserDocumentCompletedEventArgs e)
        {
            WebBrowser navigated = sender as WebBrowser;

            if (navigated == null)
            {
                return;
            }

            navigated.Print();
            navigated.Dispose();
        }
    }
} 
```

但是，DocumentCompleted 事件永远不会触发。是否可以在控制台应用程序中使用此 Windows.Forms 控件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-06-30T00:10:45.040

只要它在运行时处理事件，它就会工作。

您可以在等待循环中简单地调用“Application.DoEvents()”。你不需要做任何比这更花哨的事情，它在我的控制台应用程序中运行良好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T19:15:40.463

STA 线程的基本要求是它需要运行消息泵。在 Windows 窗体中，您可以使用 Application.Run。或者您可以使用 user32!GetMessage 和 DispatchMessage 手动编写消息泵。但在 WinForms 或 WPF 中使用它可能更容易。

# silverlight - Silverlight 面板 OnChildAdded 事件？

> ID：687148
> 
> 赞同：2
> 
> 时间：2009-03-26T19:07:10.420
> 
> 标签：silverlight, controls

我试图从 Silverlight 面板控件派生，以便在将控件添加到面板时添加一些自定义逻辑。我似乎在 Children 集合上找不到“OnChildAdded”事件（或类似事件）。是否有人对我如何判断何时将子控件添加到面板有任何建议，或者我是否必须编写自己的容器控件？

谢谢，

保罗

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T00:58:01.780

[之前在这里](https://stackoverflow.com/questions/684197/silveright-uielementcollection-change-notifications/684961#684961)问过- 不幸的是，您无法使用现有的 UIElementCollection Children 属性获得通知，但您可以尝试自定义[实现](http://skysigal.xact-solutions.com/Blog/tabid/427/EntryId/866/Silverlight-Getting-notified-upon-changes-to-a-Panel-rsquo-s-Children-of-type-UIElementCollection-property.aspx)。

# c# - 如何在网络连接以及用户登录时接收事件

> ID：687156
> 
> 赞同：9
> 
> 时间：2009-03-26T19:10:23.097
> 
> 标签：c#, .net, events, networking

我有一项正在运行的服务，我希望在以下情况下收到通知：

a) 网络已连接。

b) 当用户登录机器时。

我怎样才能做到这一点？（C# .NET 2.0）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-26T19:35:13.693

```
//using Microsoft.Win32;
//using System.Net.NetworkInformation;
public class SessionChanges
{
    public SessionChanges()
    {
        NetworkChange.NetworkAvailabilityChanged += 
            new NetworkAvailabilityChangedEventHandler(NetworkChange_NetworkAvailabilityChanged);
        SystemEvents.SessionSwitch += new SessionSwitchEventHandler(SystemEvents_SessionSwitch);
    }

    void SystemEvents_SessionSwitch(object sender, SessionSwitchEventArgs e)
    {
        if (e.Reason == SessionSwitchReason.SessionLogon)
        { 
            //user logged in
        }
    }

    void NetworkChange_NetworkAvailabilityChanged(object sender, NetworkAvailabilityEventArgs e)
    {
        if (e.IsAvailable)
        { 
            //a network is available
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-09T03:10:07.397

要在任何用户登录到机器时得到通知，调用`WTSRegisterSessionNotification`、传递`NOTIFY_FOR_ALL_SESSIONS`和监听`WM_WTSSESSION_CHANGE`消息循环中的消息。

在消息中，将`wParam`传递给`Microsoft.Win32.SessionSwitchReason`枚举以查明发生了什么，并将传递传递给以`lParam`查找`WTSQuerySessionInformation`用户名。

```
[DllImport("Wtsapi32.dll", CharSet=.CharSet.Auto)]
[return: MarshalAs(UnmanagedType.Bool)]
public static extern bool WTSRegisterSessionNotification(IntPtr hWnd, int dwFlags); 

//Pass this value in dwFlags
public const int NOTIFY_FOR_ALL_SESSIONS          =  0x1; 

//Listen for this message
public const int WM_WTSSESSION_CHANGE = 0x02B1;

//Call this method before exiting your program
[DllImport("Wtsapi32.dll", CharSet=.CharSet.Auto)]
[return: MarshalAs(UnmanagedType.Bool)]
public static extern bool WTSUnRegisterSessionNotification(IntPtr hWnd); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T19:32:16.447

要了解网络何时连接，请`NetworkAvailabilityChanged`在`System.Net.NetworkInformation.NetworkChange`类中添加处理程序。

找出用户何时登录的一种简单方法是制作一个单独的 exe 并将其放入公共启动中。每当任何用户登录时都会执行它，然后可以与您的服务通信并提供用户名。如果您希望您的服务与用户的桌面交互，这是（我相信）唯一的方法。但是，如果您不这样做，这可能不是一个好主意。

请记住，多个用户可以同时登录，尤其是通过远程桌面或终端服务（在 Windows 服务器上）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T19:30:38.227

你不能用 .NET 2.0 做 b)。对于 XP 和之前的版本，您需要创建一个 GINA 替换，它是一个导出一组指定函数的非托管 DLL。

在 Vista 中，您必须使用一个不同的基于 COM 的模型，您*可能*可以使用 .NET 2.0，但如果您不能，我不会感到惊讶。

我要做的是让您的 GINA 替代品（或 Vista 上的等价物）向您的服务发送某种信号。

对于 a) 这两个链接应该能够提供帮助：

Windows XP 中的网络感知

[http://msdn.microsoft.com/en-us/library/ms700657(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms700657(VS.85).aspx)

Windows Vista 上的网络感知

[http://msdn.microsoft.com/en-us/library/ms697388(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms697388(VS.85).aspx)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-03-26T19:23:47.963

您可以编写一个[WinLogin 通知包](http://msdn.microsoft.com/en-us/library/aa374783(VS.85).aspx)。但是，我不确定是否可以在 C# 中执行此操作。（我没有理由相信它不是，但我只在 C++ 和非托管代码中做过。）

这是一个 CodeProject[链接](http://www.codeproject.com/KB/system/winlogon_notification_package.aspx)

我不知道如何监听网络何时连接。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-26T19:28:07.530

SENS 可以做到这一点。 [http://msdn.microsoft.com/en-us/magazine/cc301850.aspx](http://msdn.microsoft.com/en-us/magazine/cc301850.aspx)

检查 ISensNetwork 和 ISensLogon。

为 C# 调整它，你就完成了。

# html - 有没有办法在 Firefox 中禁用附加页眉和页脚信息的打印？

> ID：687158
> 
> 赞同：1
> 
> 时间：2009-03-26T19:12:24.590
> 
> 标签：html, firefox, pdf, utf-8

我们使用的是 htmldoc，但不幸的是它不支持 UTF-8。

我尝试使用 Mozilla Firefox 命令行 printPDF 扩展，但它将 URL 放置在 PDF 每一页的右上角，不幸的是，这是不可接受的，因为这些文件是面向客户端的。

我也听说过[Prince](http://www.princexml.com/)，但它太贵了。

有没有办法在 Firefox 中禁用附加页眉和页脚信息的打印？在 about:config 中，我发现了一些看起来与我想要的相似的首选项——headerright 等等——并清除了它们，但它仍然出现。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T01:04:35.337

我确实在 firefox gui 中遇到了页眉和页脚配置 iptions 选项来删除你麻烦的页眉。我想知道如果你设置了这些，printPDF 扩展会按照你的意愿工作吗？

# php - 帮助合并2个数组并按键排序

> ID：687171
> 
> 赞同：0
> 
> 时间：2009-03-26T19:17:53.640
> 
> 标签：php, arrays, multidimensional-array

我在基本的 php 问题上遇到了一些麻烦，想知道是否有人可以帮助我。基本上我需要组合 2 个查询的结果，并根据键合并数组，同时保留两个查询中存在的 1 个键到 1 个值。

例如：“select * from table 1, table 2 where table1.id = table2.id”... 创建一个数组。

然后：“select * from table3, table4 where table3.id2 = table4.id2” .. 制作另一个数组。

最后： While ($res) { 用 } 打印出每一行。

关于如何处理这个问题的任何想法？伪代码非常感谢。id 之间的关系是 table1.id = table3.id 但其他 id 只是在查询中显示的表之间加入。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T19:23:36.607

```
<?php

// Merge arrays keeping keys
$new_array = array_merge($array1, $array2);

// Sort by key
ksort($new_array);

?> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T19:26:11.780

如果您不需要单独的 2 个数组，我会在 SQL 中使用联合，这应该更快且开销更少。

例如：

```
"(select * from table1, table2 where table1.id = table2.id)
     UNION ALL 
 (select * from table3, table4 where table3.id2 = table4.id2)" 
```

这确实假设两个数组的结构相同。[mySQL](http://dev.mysql.com/doc/refman/5.0/en/union.html)但语法是标准 SQL 而不是 mySQL 特定的。

或者：

```
"Select * from ((select table1.id as id, * from table1, table2 where table1.id = table2.id)
       UNION
      (select table3.id as id, * from table3, table4 where table3.id2 = table4.id2)) as t
 ORDER BY t.id" 
```

# opengl - 如何将粗二维线渲染为多边形？

> ID：687173
> 
> 赞同：24
> 
> 时间：2009-03-26T19:18:45.340
> 
> 标签：opengl, path, geometry, line, miter

我有一个由二维点列表组成的路径。我想把这些变成一条三角形，以渲染一条具有指定厚度的纹理线（以及其他类似的东西）。所以本质上，二维点列表需要成为一个顶点列表，指定多边形的轮廓，如果渲染将渲染线条。问题在于处理角连接、斜接、帽等。生成的多边形需要在没有过度绘制、干净连接等的意义上是“完美的”，以便它可以被挤出或以其他方式玩弄。

是否有任何*简单的*资源可以提供算法洞察力、代码或更多关于有效执行此操作的信息？

我绝对不想要一个完整的 2D 矢量库（cairo、antigrain、OpenVG 等），其中包含曲线、弧线、破折号和所有的花里胡哨。我一直在为 OpenVG 实现和其他东西挖掘多个源代码树以找到一些见解，但这一切都非常令人费解。

我绝对愿意自己编写代码，但是有许多退化的情况（小段 + 粗宽度 + 尖角）会产生各种连接问题。即使是一点点帮助，也能节省我处理所有这些问题的时间。

编辑：如果你只是从一个顶点到另一个顶点，这是一个导致丑陋的退化案例之一的例子。红色是原始路径。橙色块是以指定宽度绘制的矩形，对齐并以每个线段为中心。

[![](https://i.stack.imgur.com/MfYJs.png)](https://i.stack.imgur.com/MfYJs.png)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T06:35:35.493

哦，好吧 - 我已经尝试自己解决这个问题。我在一个试图解决零透支问题的解决方案上浪费了两个月。正如您已经发现的那样，您不能同时处理所有退化的情况并实现零透支。

但是，您可以使用混合方法：

为自己编写一个例程，检查连接是否可以从简单的几何图形构建而没有问题。为此，您必须检查连接角度、线宽和连接线段的长度（比宽度短的线段是 PITA）。通过一些启发式方法，您应该能够理清所有琐碎的案例。

我不知道您的平均线数据是什么样的，但在我的情况下，超过 90% 的宽线没有退化的情况。

对于所有其他行：

您很可能已经发现，如果您容忍过度绘制，生成几何图形会容易得多。这样做，让多边形 CSG 算法和曲面细分算法来完成这项艰巨的工作。

我已经评估了大多数可用的镶嵌包，最后我选择了 GLU 镶嵌器。它快速、健壮、永不崩溃（与大多数其他算法不同）。它是免费的，许可证允许我将它包含在商业程序中。镶嵌的质量和速度还可以。您不会获得 delaunay 三角测量质量，但由于您只需要三角形进行渲染，这不是问题。

由于我不喜欢 tesselator API，我从免费的 SGI OpenGL 参考实现中提取了 tesselation 代码，重写了整个前端并添加了内存池以减少分配数量。这样做花了两天时间，但这是非常值得的（就像因素五的性能提升）。顺便说一句，该解决方案最终以商业 OpenVG 实现 :-)

如果您在 PC 上使用 OpenGL 进行渲染，您可能希望将曲面细分/CSG 作业从 CPU 移动到 GPU，并使用模板缓冲区或 z 缓冲区技巧来消除过度绘制。这比 CPU 细分要容易得多，甚至可能更快。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2014-10-27T23:35:13.923

我刚刚发现了这个惊人的工作：

[http://www.codeproject.com/Articles/226569/Drawing-polylines-by-tessellation](http://www.codeproject.com/Articles/226569/Drawing-polylines-by-tessellation)

它似乎完全符合您的要求，并且它的许可证甚至允许在商业应用程序中使用它。另外，作者在详细说明他的方法方面做得非常出色。我可能会在某个时候试一试，以替换我自己的不太完美的实现。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T21:03:56.287

一个简单的方法在我脑海中浮现。

平分每个 2d 顶点的角度，这将创建一个漂亮的斜接线。然后沿着那条线向内和向外移动，你的“厚度”（或厚度除以二？）的量，你现在有你的内部和外部多边形点。移动到下一个点，重复相同的过程，沿途构建新的多边形点。然后应用三角剖分来获得渲染就绪的顶点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-12-13T22:27:39.053

我最终不得不弄脏自己的手并写了一个小ribbonizer来解决类似的问题。

对我来说，问题是我想要 OpenGL 中的粗线条没有我在 iPhone 上使用 OpenGL 看到的那种伪影。在查看了各种解决方案之后；贝塞尔曲线之类的——我认为自己制作可能是最简单的。有几种不同的方法。

一种方法是找到两个线段之间的相交角度，然后沿着该相交线移动距离表面一定距离，并将其视为带状顶点。我试过了，但它看起来并不直观；色带宽度会有所不同。

另一种方法是实际计算线段表面的法线，并使用它来计算该线段的理想色带边缘，并在色带段之间进行实际的相交测试。这工作得很好，除了对于尖角，带状线段交叉点太远（如果段间角度接近 180'）。

我用两种方法解决了锐角问题。Paul Bourke 线相交算法（我以未优化的方式使用）建议检测相交是否在路段内。由于两个段是相同的，我只需要测试其中一个段是否相交。然后我可以仲裁如何解决这个问题；通过捏造两端之间的最佳点或戴上端盖 - 两种方法看起来都不错 - 端盖方法可能会抛弃 opengl 的多边形正面/背面排序。

见[http://paulbourke.net/geometry/lineline2d/](http://paulbourke.net/geometry/lineline2d/)

在此处查看我的源代码：[https ://gist.github.com/1474156](https://gist.github.com/1474156)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T19:24:37.947

我想我会使用曲面细分算法。确实，在大多数情况下，使用这些的目的是减少顶点数量以优化渲染，但在您的情况下，您可以参数化以保留所有细节 - 优化的可能性可能会派上用场。

网络上有许多曲面细分算法和代码——几年前我在一个 DLL 中封装了一个纯 C 语言，用于与 Delphi 风景渲染器一起使用，它们对于高级图形编码教程等来说并不少见。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-26T19:32:46.460

我也对此感兴趣，因为我想完善我的地图应用程序 ( [Kosmos](http://wiki.openstreetmap.org/wiki/Kosmos) ) 的道路绘制。我使用的一种解决方法是绘制折线两次，一次用较粗的线，一次用较细的线，用不同的颜色。但这并不是真正的多边形，它只是一种模拟多边形的快速方法。在此处查看一些示例：[http ://wiki.openstreetmap.org/wiki/Kosmos_Rendering_Help#Rendering_Options](http://wiki.openstreetmap.org/wiki/Kosmos_Rendering_Help#Rendering_Options)

我不确定这是否是您需要的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-26T20:53:17.950

看看[德劳内三角测量](http://en.wikipedia.org/wiki/Delaunay_triangulation)是否有帮助。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-01-11T12:14:55.227

就我而言，我有能力透支。我只是在折线的每个顶点上绘制半径 = 宽度/2 的圆。

工件以这种方式被掩盖，并且很容易实现，如果您可以忍受“圆角”和一些过度绘制。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-01-13T04:50:25.387

从您的图像看来，您正在使用 FILL 并使用橙色围绕线段绘制框。这样做肯定会造成糟糕的透支。所以首先要做的是不渲染黑色边框，填充颜色可以是不透明的。

为什么你不能使用 GL_LINES 原语来做你想做的事情？您可以指定宽度、过滤、平滑度、纹理任何内容。您可以使用 glDrawArrays() 渲染所有顶点。我知道这不是您的想法，但是当您专注于 2D 绘图时，这可能是更简单的方法。（搜索纹理线条等）

# python - 如何在 Python 中获取 xml 文件的根节点？

> ID：687177
> 
> 赞同：4
> 
> 时间：2009-03-26T19:19:53.603
> 
> 标签：python, xml

基本上我正在使用：

从 xml.etree 导入 ElementTree 作为 ET

```
path = 'C:\cool.xml'
et = ET.parse ( path ) 
```

但我不确定如何从 et 获取根？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-26T19:23:18.977

你可能想要：

```
et.getroot() 
```

[从effbot 站点](http://effbot.org/zone/element-index.htm)查看 ElementTree 的官方文档。请注意，Python 2.5（第一个包含开箱即用 ElementTree 的 Python 版本）使用 ElementTree 1.2，而不是更新的 1.3。差别不大，仅供参考。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-26T19:23:58.993

```
root = et.getroot() 
```

我会推荐使用 lxml.etree 而不是 xml.etree.ElementTree，因为 lxml 更快并且界面相同。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T19:23:54.610

```
root = et.getroot() 
```

# visual-c++ - 如何强制 MSVC++ 忽略静态库的 CRT 依赖项？

> ID：687179
> 
> 赞同：2
> 
> 时间：2009-03-26T19:21:29.980
> 
> 标签：visual-c++, runtime, static-libraries, msvcrt

我不知道是否可以这样做，但我希望将 /NODEFAULTLIB 应用于静态库项目。

我有许多使用通用静态库 D.lib 的应用程序项目（A.exe、B.dll、C.dll）。这个库有很多代码，也有其他 .lib 依赖项。其中之一是 openssl 库，它似乎是针对 CRT 的发布版本为 win32 构建的（我没有原始项目/源）。

到目前为止，为了避免混合 CRT 的发布/调试版本，我必须将 /NODEFAULTLIB:msvcrt.lib 链接器指令放在所有叶项目（A.exe、B.dll）中。这可行，但我认为这不是处理该问题的理想方式。我试图把这个属性放在 D.lib 项目中，但它没有效果。

有没有办法强制 msvc++ 忽略第 3 方库中的 msvcrt.lib 依赖项？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T09:49:11.497

.lib 没有任何链接器设置，因为您没有链接它，而是链接**到**它。.lib 只是 .obj 文件的存档，有点像未压缩的 .zip 文件 - 这就是为什么您必须将设置放在链接到它的所有项目上。

如果您使用的是 VS2005+，您可以使用属性表，这样您只需将设置放在一个位置，然后在所有项目中使用该属性表。

但是，OpenSSL 就是这样 - 开源，因此您应该能够获取您正在使用的版本的源代码并再次构建它（当然，并将其添加到您的版本控制系统中）。我认为 OpenSSL 可以构建为 DLL 或 LIB，这可以解决您的问题，因为 DLL 不会干扰您的代码链接。

如果做不到这一点，您总是可以选择将您的功能拆分到一个单独的 DLL 中，这样您就只会遇到一个项目的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-13T09:04:54.470

我的理解是，如果库 LIB 静态链接到 DLL 中，则 DLL 已经包含来自 LIB 的所有相关代码。因此，这种耦合不能被移除。这只是基于我对静态链接的理解，而不是基于实验。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-02-17T06:20:40.023

为了防止您的分布式静态链接库依赖于特定的 MSVC 运行时库，您需要设置此编译器选项（在 Visual Studio 2010 中看起来像）：

配置属性 -> C/C++ -> 高级 -> 省略默认库名称 = Yes (/ZI)

现在，您的用户可以从他们的调试版本链接到您的发布构建的静态库，而不是尝试链接到导致问题的不正确运行时库以及链接器警告。

请注意，如果您的库实际上依赖于特定的运行时库或其行为，并且未以其他方式提供兼容组件，则可能会导致链接错误。

# sharepoint - SharePoint Web 部件 - 您可以将一个 Web 部件嵌入到另一个 Web 部件中吗？

> ID：687189
> 
> 赞同：0
> 
> 时间：2009-03-26T19:23:55.200
> 
> 标签：sharepoint

您可以将一个 SharePoint Web 部件嵌入到另一个中吗？例如，客户需要一个文档库，但也需要使用富文本编辑器工具编写有关该文档的执行摘要的能力。这可以做到吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T08:46:02.480

更简单的方法是在文档库中创建一个新列，类型为“多行文本”，格式为富文本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T19:39:36.367

您可以通过转到站点设置 > 站点内容类型库 > 新站点内容类型来创建新的站点内容类型。创建具有 Document 父内容类型的新类型。然后使用“从新站点列添加”按钮定义摘要的列。最后在站点上创建一个新列表以显示您的新类型并将列表粘贴到 Web 部件中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T22:32:26.917

您不能将一个 Web 部件放入另一个 Web 部件中。

正如 Jeremy 所说，您的客户的解决方案可能是自定义内容类型。您可以将自定义字段添加到您的内容类型，例如摘要，作为具有富文本支持的多行文本列。

在您的文档库中，您必须启用内容类型并将您的自定义内容类型附加到列表中，并将内容类型设置为默认内容类型。如果您的客户需要大量使用自定义内容类型的列表，您可以将列表保存为列表模板以使其可重用。

如果您使用 Word 将文档保存到列表中，用户将可以选择填写内容类型字段。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T19:38:17.117

我不是 100% 确定我正在回答您的问题，但我通过在 wiki 库中构建我的基础站点来做到这一点，它为我提供了丰富的文本内容。然后我根据需要将其他元素嵌入到 wiki 页面中。因此，就我而言，每个页面都专用于一个网络站点。正文是关于那个站点的，然后我嵌入了一个站点照片库、一个专用于该站点的文档库、一个专用于该站点的任务库等……

# asp.net - 单个文件的 Windows 身份验证

> ID：687192
> 
> 赞同：4
> 
> 时间：2009-03-26T19:24:11.817
> 
> 标签：asp.net, authentication, windows-authentication

环境：IIS 6.0、ASP.NET 3.5

我只需要使用 Windows 身份验证保护一个文件，并且只想确保我正确理解我的选项。

1.  通过 IIS 关闭我要保护的文件的匿名访问，并确保选中集成 Windows 安全性
2.  将文件放在它自己的目录中，并在其中放置一个 web.config 文件，该文件具有该目录的授权配置设置以要求 Windows 身份验证

有没有办法设置 web 配置来控制对单个文件的访问？是否有任何安全属性可以帮助我锁定单个文件？

在此先感谢凯文

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T00:24:01.737

> 将文件放在它自己的目录中，并在其中放置一个 web.config 文件，该文件具有该目录的授权配置设置以要求 Windows 身份验证

您不能为单个应用程序混合*身份验证提供程序。*因此，例如，您不能对 ~/ 进行表单身份验证，对 ~/Secure 进行 Windows 身份验证。您*可以*通过在 IIS 中创建 ~/Secure 另一个应用程序来解决它 - 但这会使部署和测试 IMO 变得非常复杂。

我在尝试使用来自域的基本身份验证来保护 ASMX 服务时遇到了这个问题，但与 Forms Authenticated 页面位于同一个应用程序中。我最终破解了 ASMX 服务本身的基本身份验证挑战，以提示输入凭据。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T00:13:49.140

`<location>`使用标签应该可以做到这一点。

[http://support.microsoft.com/kb/316871](http://support.microsoft.com/kb/316871)

我知道过去我做了相反的事情，并使用它来启用对单个资源的访问，并拒绝未经身份验证的用户访问所有其他资源。应该反过来工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T19:30:51.830

如果要应用 web.config，则需要确保放置它的目录是 IIS 虚拟目录。这应该可以解决问题，因为 web.config 的安全限制将管理该目录中的所有文件。

# php - 如何在来自 Web 服务器的流式内容上设置只读标志

> ID：687193
> 
> 赞同：1
> 
> 时间：2009-03-26T19:24:25.420
> 
> 标签：php, asp.net, http, coldfusion, http-headers

有没有办法包含或建议一个只读标志作为内容处置的一部分：附件；filename=document.doc 或其他 http 标头？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T20:38:43.040

我强烈怀疑不是。通常，您无法控制浏览器的本地文件系统（应该如此），因此您无法指定文件为只读、存档、隐藏等。

# iphone - 释放 NSXMLParser 时 EXC_BAD_ACCESS 崩溃

> ID：687197
> 
> 赞同：3
> 
> 时间：2009-03-26T19:24:50.380
> 
> 标签：iphone, objective-c, xml, nsxmlparser

我看到 [解析器版本] 出现间歇性崩溃。我会说我大约有 5% 的时间会看到它，而且我正在解析的数据在每次崩溃之间都会有所不同。我无法为我的生活找出原因。

在我向 Apple 提交错误报告（幸运的是，在示例代码中无法重现）之前，有没有人遇到过这个问题并知道可能发生了什么？

```
 NSData *d = [data copy]; // data is typically 2K-13K bytes
    @synchronized (xmlParserLock) {
        [[NSURLCache sharedURLCache] setMemoryCapacity:0];
        [[NSURLCache sharedURLCache] setDiskCapacity:0];

        NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];
        NSXMLParser *parser = [[NSXMLParser alloc] initWithData:d];
        [parser setDelegate:self];
        [parser setShouldProcessNamespaces:NO];
        [parser setShouldReportNamespacePrefixes:NO];
        [parser setShouldResolveExternalEntities:NO];
        [parser parse];
        [parser release];
        [pool release];
    }
    [d release]; 
```

这是 gdb 'where' 输出，它指向 [parser release]：

```
#0  0x93d08d12 in xmlCharEncCloseFunc ()
#1  0x93cfc0e3 in xmlFreeParserInputBuffer ()
#2  0x93cfc08f in xmlFreeInputStream ()
#3  0x93cfbdac in xmlFreeParserCtxt ()
#4  0x961384d6 in -[NSXMLParser dealloc] ()
#5  0x00149de7 in -[MyParserClass parseResponse] (self=0x104e9f0, _cmd=0x1766dc) at /Users/mike/Documents/MyApp/Classes/MyParserClass.m:60 
```

提前感谢您的帮助！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T23:15:36.487

我想我想通了——应用程序中其他地方的一些代码使用了 XML 函数，例如：

```
xmlCtxtReadMemory()
xmlClearParserCtxt();
xmlFreeParserCtxt();
xmlCleanupParser();
xmlFreeDoc(); 
```

这些函数很可能在我执行我发布的代码片段的同时在另一个线程中执行。NSXMLParser 显然在底层使用了相同的功能。

我已经使用与我用于 NSXMLParser 使用的锁定对象相同的锁定对象向其他代码添加了一个同步块，并且崩溃似乎已经消失。所以我想这里的教训是这些 XML 函数完全不是线程安全的——谨慎使用！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T20:20:31.010

看起来您正在使用多个线程。这可能有问题。线程错误经常会偶尔出现。您的解析器委托方法中可能还有一个错误，您没有在此处发布。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T01:51:56.923

只有在解析完成后，您才需要删除您的数据。在委托方法中调用parserDidEndDocument：释放数据。

希望这有帮助。

蒂埃里

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T01:56:53.603

只有在解析完成后，您才需要删除您的数据。在委托方法中调用parserDidEndDocument：释放数据。

希望这有帮助。

蒂埃里

# jsp - struts2 表单和组合框的帮助

> ID：687198
> 
> 赞同：0
> 
> 时间：2009-03-26T19:24:55.043
> 
> 标签：jsp, forms, combobox, struts2, action

我在表单中有一个组合框，当我单击提交时出现此错误。

HTTP 错误：404 没有为动作 MyAction 和结果输入定义结果

在操作中，我尝试返回 INPUT 而不是 SUCCESS 但仍然不起作用。

有什么想法有什么问题吗？

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T19:28:28.980

您可能有一个或多个验证规则失败。这会导致调用“输入”的隐式结果

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-30T03:19:22.333

如果没有更多可用信息，我将检查您的 struts.xml 并确保您的操作定义具有输入结果，并且它会将用户引导回编辑页面，在那里他们可以更正任何操作或字段错误。

# c# - 将func存储在字典中时参数类型不可分配

> ID：687201
> 
> 赞同：0
> 
> 时间：2009-03-26T19:25:53.747
> 
> 标签：c#

我有一个函数，它接受一个类型 T 的参数并返回一个值。

我想将它存储在字典中，如下所示：

```
Dictionary<CustomerMilestones, Func<string, string>> coll = new Dictionary<CustomerMilestones, Func<string, string>>();

string Indicator = coll[CustomerMilestones.Ordered100Products].Invoke(customerId.ToString());

coll.Add(CustomerMilestones.Ordered100Products, Execute(Indicator); 
```

Execute 是一个接受字符串但也返回字符串的方法。在最后一行，错误如下：

参数类型字符串不可分配给参数类型 Func。

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T19:27:27.627

您不应该*调用*Execute - 您只需将其作为方法组提供：

```
coll.Add(CustomerMilestones.Ordered100Products, Execute); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T19:31:02.657

如果我理解正确，您应该传入 Execute 方法，而不是执行调用的结果。

coll.Add(CustomerMilestones.Ordered100Products, Execute);

# .net - 显示堆栈的内容

> ID：687219
> 
> 赞同：1
> 
> 时间：2009-03-26T19:30:19.197
> 
> 标签：.net, cil

我在 Visual Studio 中或通过 Mdbg 运行 MSIL。

有什么方法可以显示 MSIL 堆栈的内容吗？

例如，如果我执行 ldloc“某个变量”，有没有办法查看堆栈并看到该变量现在在堆栈上。

我假设 MSIL 堆栈与 CPU 堆栈不同，即 SP 寄存器指向的内存？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-20T18:48:50.617

在运行时，实际上没有任何“MSIL”堆栈。即使在调试模式下，执行的代码也始终是 JIT 编译的。JIT 编译 MSIL 的过程将其从虚拟堆栈机器“扁平化”为您正在运行的平台的普通汇编代码。如果值已经在寄存器中，这意味着`ldloc.0`最终可能会被翻译成类似的东西，甚至是无操作。`mov eax, [sp + 4]`如果要调试特定指令`ldloc`，则必须在反汇编中查看它，以查看 ldoloc 被翻译成什么以及它实际从哪里加载数据。

WinDbg + SoS 工具（在另一篇文章中提到）将帮助您**从托管代码的角度查看 CPU 堆栈**。但是，它们不允许您查看“MSIL”堆栈，因为没有可查看的堆栈。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T19:35:18.823

您可以使用 WinDbg + SoS 做到这一点，甚至更多。检查[此问题](https://stackoverflow.com/questions/366517/what-is-the-best-resource-for-learning-the-features-and-benefits-of-windbg)以获取有关如何使用 WinDbg 的参考资料。

# python - Python中有一个函数可以列出特定对象的属性和方法吗？

> ID：687239
> 
> 赞同：49
> 
> 时间：2009-03-26T19:34:05.240
> 
> 标签：python

Python中有一个函数可以列出特定对象的属性和方法吗？

就像是：

```
ShowAttributes ( myObject )

   -> .count
   -> .size

ShowMethods ( myObject )

   -> len
   -> parse 
```

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-03-26T19:36:33.440

你想看看[`dir()`](http://diveintopython.net/power_of_introspection/built_in_functions.html)函数：

```
>>> li = []
>>> dir(li)      
['append', 'count', 'extend', 'index', 'insert',
'pop', 'remove', 'reverse', 'sort'] 
```

> `li`是一个列表，因此`dir(li)`返回列表中所有方法的列表。请注意，返回的列表包含字符串形式的方法名称，而不是方法本身。

* * *

**编辑以回应评论：**

不，这也会显示所有继承的方法。考虑这个例子：

**测试.py：**

```
class Foo:
    def foo(): pass

class Bar(Foo):
    def bar(): pass 
```

**Python解释器：**

```
>>> from test import Foo, Bar
>>> dir(Foo)
['__doc__', '__module__', 'foo']
>>> dir(Bar)
['__doc__', '__module__', 'bar', 'foo'] 
```

* * *

**您应该注意** [Python 的文档](http://docs.python.org/library/functions.html)指出：

> **注意：**因为*主要是为了方便在交互式提示中使用*`dir()`而 提供 的，所以它会尝试提供一组有趣的名称，而不是尝试提供一组严格或一致定义的名称，*并且它的详细行为可能会随着版本的不同而改变*。例如，当参数是类时，元类属性不在结果列表中。

 **因此，在您的代码中使用它是不安全的。改为使用`vars()`。`Vars()`不包括有关超类的信息，您必须自己收集它们。

* * *

如果您要`dir()`在交互式解释器中查找信息，请考虑使用`help()`.

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-26T19:35:53.393

dir() 和 vars() 不适合你吗？

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-03-26T20:25:25.663

对于更易于阅读的方式，您可以使用[see](http://github.com/inky/see/tree/master)：

```
In [1]: from see import see
In [2]: x = "hello world!"
In [3]: see(x)
Out[3]: 
  []   in   +   *   %   <   <=   ==   !=   >   >=   hash()   help()   len()
  repr()   str()   .capitalize()   .center()   .count()   .decode()
  .encode()   .endswith()   .expandtabs()   .find()   .format()   .index()
  .isalnum()   .isalpha()   .isdigit()   .islower()   .isspace()   .istitle()
  .isupper()   .join()   .ljust()   .lower()   .lstrip()   .partition()
  .replace()   .rfind()   .rindex()   .rjust()   .rpartition()   .rsplit()
  .rstrip()   .split()   .splitlines()   .startswith()   .strip()
  .swapcase()   .title()   .translate()   .upper()   .zfill() 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-26T19:53:12.527

另一种方法是使用漂亮的[IPython](http://ipython.scipy.org/moin/)环境。它使您可以完成标签以查找对象的所有方法和字段。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2017-03-03T23:02:52.107

令我惊讶的是，没有人提到 python 对象函数：
`keys()`

# c# - XPS 表格填写

> ID：687248
> 
> 赞同：0
> 
> 时间：2009-03-26T19:35:37.747
> 
> 标签：c#, xps

有没有办法在 C# 中使用 XPS 文档填写表单？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T19:47:12.633

这不是一个理想的解决方案。原因是 XPS 中的文本由[Glyphs](http://msdn.microsoft.com/en-us/library/system.windows.documents.glyphs.aspx)表示，其中字符（粗略地说）被指定为特定字体的字符形状表的索引，而不是像 Unicode 这样方便的东西。并且`Glyphs`必须专门定位，每个字符都从字符串原点偏移。如果一个字符串必须换成多行，则必须通过放入许多单独的`Glyphs`对象来完成，所有对象都是单独定位的。它不是一种逻辑格式，而是一种物理格式，并且在生成后并不特别适合更改。

最好将模板文档定义为[FlowDocument](http://msdn.microsoft.com/en-us/library/aa970909.aspx)。这是一种逻辑上更易于操作的格式，而不是物理“冻结”格式。（XPS 文档在技术上是[FixedDocument](http://msdn.microsoft.com/en-us/library/system.windows.documents.fixeddocument.aspx)）。然后，您可以将 a 冻结`FlowDocument`为 a`FixedDocument`以将其导出为 XPS，当它已被填写时。

[阅读有关流文档的更多信息。](http://msdn.microsoft.com/en-us/library/aa970909.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-30T21:10:22.480

这是你如何做到的。

首先，您创建一个对象（PO​​CO 很好），其中包含您希望用户填写表单的表单字段。接下来，您将表单创建为 FixedDocument。它应该具有对您的 POCO 起作用的绑定。然后，您创建一个窗口，以便用户可以为这些字段输入值。

将 POCO（普通的旧 CLR 对象）绑定到窗口中的文本框。用户输入表单数据后，获取您现在填写的对象并将其设置为 FixedDocument 的 DataContext。创建一个 XpsWriter 并将您的 FixedDocument 写入您的输出（文件、打印机等）。

我会给你代码，但因为我实际上是在做这个（或相对类似的）工作，所以我认为我做不到。我可以告诉你，最难的部分是处理 XPS 文档。你可以根据你在那里的经历来判断。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T19:38:04.683

**如果**您想填写 XPS 表格，可以。XPS 是 XML，因此您可以更改它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T20:13:10.387

修改 XPS 肯定是可能的，这在一定程度上取决于您希望它如何工作以及您愿意进行的编程量（但这可能适用于每个编程问题；-)）。

无论如何：请随时在 info-at-nixps-dot-com 上直接给我发电子邮件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-15T23:10:09.370

我从来没有找到一个非常好的解决方案，所以我做了一个。查看 www.flexsoftinc.com 以查看我的程序 XPS Express。

# .net - 开始拖放操作时保留前台窗口

> ID：687258
> 
> 赞同：0
> 
> 时间：2009-03-26T19:38:20.113
> 
> 标签：.net, winforms, drag-and-drop

在我的 .Net 应用程序中，用户可以将主窗口上的网格中的行拖到其他应用程序窗口中。通常，主应用程序窗口位于用户拖入的窗口后面。默认情况下，只要在主窗口上按下鼠标按钮，它就会获得焦点，隐藏用户想要拖动到的窗口。

有什么方法可以防止活动窗口发生变化？用户很难定位窗口，以便它们都可以**从**主窗口拖动**到**活动窗口的适当元素上。

请注意，Windows 资源管理器可以很好地处理这个问题 - 前台资源管理器窗口保持活动状态，以防用户想要拖入其中，直到释放鼠标按钮。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T19:54:31.650

使您的应用程序成为 MDI（多文档界面）应用程序（如 VisualStudio、Word、Excel 等）可能是有意义的，其中您有一个“主”窗口，其中包含由窗格分隔的所有其他窗口。

# asp.net - ASP .net 应用程序中的旧版 html 表单

> ID：687260
> 
> 赞同：2
> 
> 时间：2009-03-26T19:38:44.260
> 
> 标签：asp.net, xhtml

我有一个 html 页面，我将其转换为 asp .net 页面。此页面包含一个访问我无法控制的外部网站的表单。下面有一些示例代码：

```
<asp:Content ID="sample" ContentPlaceHolderID="body" Runat="Server">
<form name="Subscribe" method="post" action="http://anexternalwebsitehere.com/subscribe.asp">
        <input type="text" name="email" size="45" maxlength="120" />
        <input type="submit" name="submit" value="Subscribe" />
    </form>
</asp:Content> 
```

该表格比我提供的示例更复杂，但它大致了解了我需要转换的内容。以下是我遇到的问题。

**如果我保持原样：** 当您单击提交按钮时，您将回发到当前页面而不是外部页面

**如果简单地将所有内容转换为 asp 表单控件并更改回发 url：** id 变成了外部页面无法解释的一些复杂的“ctl00_body_ctl00”。

*注意：我确实需要该页面是一个 aspx 页面，因为我正在为页面上的其他内容使用母版页。*

附加说明：这不是 Microsoft MVC。

我错过了什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T20:20:24.207

正如其他人提到的那样，问题在于嵌套表单。

只需执行以下操作，我就可以解决所有问题：

1.  删除我添加的额外表单元素。
2.  将所有控件保留为简单的 html 控件，提交按钮除外。
3.  用 asp .net 按钮替换提交按钮，并设置回发网址。

旧代码如下：

```
<asp:Content ID="sample" ContentPlaceHolderID="body" Runat="Server">
<form name="Subscribe" method="post" action="http://anexternalwebsitehere.com/subscribe.asp">
        <input type="text" name="email" size="45" maxlength="120" />
        <input type="submit" name="submit" value="Subscribe" />
    </form>
</asp:Content> 
```

新代码：

```
<asp:Content ID="sample" ContentPlaceHolderID="body" Runat="Server">
        <input type="text" name="email" size="45" maxlength="120" />
        <input type="submit" name="submit" value="Subscribe" />
        <asp:button postbackurl="http://anexternalwebsitehere.com/subscribe.asp" text="Subscribe" runat="server" />
</asp:Content> 
```

这解决了无效嵌套表单的任何问题，因为没有嵌套表单。它还解决了 asp .net 重命名 asp 元素的问题，因为唯一被重命名的控件是 asp 按钮控件，它不是提交成功所必需的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T19:54:05.393

由于您的母版页上可能有跨越内容占位符的服务器表单标记，因此您声明的这个新表单将放置在服务器表单内（服务器表单是指用于回发的一个 asp.net 使用 runat="server ")

我遇到过一些情况，我需要在一个已经有服务器表单的 aspx 页面上使用特殊的非服务器表单，而我解决问题的方法是将这个非服务器表单放在服务器表单之外——我的意思是就是，把它放在服务器表单之后。由于您使用母版页，因此您需要在该母版页上添加一个新的内容占位符，您可以将其称为“noform”。它放置在服务器表单之后，因此放入此 noform 中的任何内容都将放置在服务器表单之外。这意味着没有 asp.net 控件将在这个特定的 contentplaceholder (noform) 中工作，因为它们不会被框架拾取，但是您将能够将非服务器表单放在那里并在其中发挥作用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T20:01:00.587

正如您可能已经猜到的那样，问题在于您在另一个表单中包含一个表单 - 即，旧表单出现在母版页所需的 ASP.NET 表单中。

解决此问题的一种快速（如果相当笨拙）的方法是关闭旧表单上方的 ASP.NET 表单，然后在旧表单下方打开一个新表单。这意味着页面上有三个表单，没有一个是嵌套的。

所以你最终会得到这样的结果：

```
<asp:Content ID="sample" ContentPlaceHolderID="body" Runat="Server">
    </form>
    <form name="Subscribe" method="post" action="http://anexternalwebsitehere.com/subscribe.asp">
        <input type="text" name="email" size="45" maxlength="120" />
        <input type="submit" name="submit" value="Subscribe" />
    </form>
    <form method="post" action="myAspNetPage.aspx">
</asp:Content> 
```

开始处的结束`</form>`标记从母版页关闭 ASP.NET。然后你就有了你的表单，它现在应该可以按预期工作了。然后末尾的打开`<form>`标记只是确保`</form>`母版页的结束标记是有效的 HTML。

显然，在遗留表单之后出现在母版页上的任何内容都不会在标准 ASP.NET 表单中，因此这可能对您不起作用，具体取决于页面其余部分的结构。

这不是一个特别优雅的解决方案，但它可以作为一种快速修复（取决于母版页上的其他内容）。我们在一个拥有数百个页面的网站上需要一个遗留表单的地方使用它，因此我们只需要一次性修复而不是任何影响母版页本身的东西。

在我们的案例中，我们无法更改遗留表单，因为它是由第三方提供的，定期更改，并且需要在没有开发人员参与修改的情况下放入 ASP.NET 页面（例如，与 Brian 的相反）解决他自己的问题，这需要编辑表格，显然是他的情况下一个更好的选择 - 并且可能在大多数其他有类似问题的情况下）。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-26T20:06:28.703

您的按钮的点击事件将处理 url 和数据的提交。

```
//C# source
protected void button_Click(object sender, EventArgs e)
}
  string customURL = "http://anexternalwebsitehere.com/";
  string emailValue = textBoxEmail.Text; //of course validate this for proper email...

  customURL += "page.aspx?email=" + emailValue;

  Response.Redirect(customURL);
} 
```

# image-processing - 将 RGB 转换为灰度/强度

> ID：687261
> 
> 赞同：141
> 
> 时间：2009-03-26T19:39:07.443
> 
> 标签：image-processing, colors, computer-vision, language-agnostic, rgb

当从 RGB 转换为灰度时，据说应该对通道 R、G 和 B 应用特定的权重。这些权重是：0.2989、0.5870、0.1140。

据说这是因为人类对这三种颜色的感知/感受不同。有时也有人说这些是用于计算 NTSC 信号的值。

但是，我在网上没有找到很好的参考资料。这些价值观的来源是什么？

另请参阅这些先前的问题：[此处](https://stackoverflow.com/questions/14330/rgb-to-monochrome-conversion)和[此处](https://stackoverflow.com/questions/596216/formula-to-determine-brightness-of-rgb-color)。

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2009-03-27T12:16:22.087

问题中的具体数字来自 CCIR 601（参见[Wikipedia 文章](https://en.wikipedia.org/wiki/CIELAB_color_space)）。

如果你用稍微不同的数字/不同的方法转换 RGB -> 灰度，在正常光照条件下，你在普通电脑屏幕上根本看不到太大差异——试试看。

以下是有关颜色的更多链接：

维基百科[亮度](http://en.wikipedia.org/wiki/Luma_(video))

[Bruce Lindbloom](http://www.brucelindbloom.com)的杰出网站

Colin Ware 所著的“信息可视化”一书中关于颜色的第 4 章，isbn 1-55860-819-2；[book.google.com](http://books.google.com/books?id=ZmG_FiqqyqgC&printsec=frontcover&dq=%22colin+ware%22+visualization&ei=UrDMSYjVKKaeyASyqo3XCg)中指向 Ware 的这个长链接 可能有效，也可能无效

[cambridgeincolor](http://www.cambridgeincolour.com/tutorials.htm)：优秀的、编写良好的“关于如何使用强调概念而非程序的视觉导向方法获取、解释和处理数码照片的教程”

如果您遇到“线性”与“非线性”RGB，这是对我自己的旧笔记的一部分。重复一遍，在实践中你不会看到太大的不同。

* * *

### RGB -> ^gamma -> Y -> L*

在色彩科学中，常见的 RGB 值，如 html rgb(10%, 20%, 30%)，被称为“非线性”或 [Gamma 校正](http://en.wikipedia.org/wiki/Gamma_correction)。“线性”值定义为

```
Rlin = R^gamma,  Glin = G^gamma,  Blin = B^gamma 
```

对于许多 PC，其中 gamma 为 2.2。通常的 RGB 有时写为 R' G' B' (R' = Rlin ^ (1/gamma)) （纯粹主义者舌头点击）但在这里我会放弃'。

CRT 显示器上的亮度与 RGBlin = RGB ^ gamma 成正比，因此 CRT 上 50% 的灰色非常暗：0.5 ^ 2.2 = 最大亮度的 22%。（LCD 显示器更复杂；此外，一些显卡会补偿伽马。）

要获得`L*`从 RGB 调用的亮度度量，首先将 RGB 除以 255，然后计算

```
Y = .2126 * R^gamma + .7152 * G^gamma + .0722 * B^gamma 
```

这是`Y`在 XYZ 颜色空间中；它是颜色“亮度”的量度。（真正的公式并不完全是 x^gamma，而是接近；坚持使用 x^gamma 进行第一遍。）

最后，

> ```
> L* = 116 * Y ^ 1/3 - 16 
> ```
> 
> “......渴望感知一致性 [和] 与人类对亮度的感知紧密匹配。” -- **维基百科[实验室色彩空间](http://en.wikipedia.org/wiki/Lab_color_space)**

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-03-26T21:54:23.437

我发现在对先前类似问题的回答中引用了该出版物。它非常有帮助，该页面有几个示例图像：

[Martin Čadík对彩色到灰度图像转换](http://cadik.posvete.cz/color_to_gray_evaluation/)的感知评估，计算机图形学论坛，2008 年第 27 卷

该出版物探讨了其他几种生成具有不同结果的灰度图像的方法：

*   CIE Y
*   颜色2灰色
*   脱色
*   史密斯08
*   拉舍05
*   巴拉04
*   纽曼07

有趣的是，它得出的结论是，没有普遍最佳的转换方法，因为每种方法的性能都比其他方法好或差，具体取决于输入。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2011-01-30T00:18:18.397

这是 c 中的一些代码，用于将 rgb 转换为灰度。用于 rgb 到灰度转换的实际权重是 0.3R+0.6G+0.11B。这些权重并不是绝对重要的，因此您可以使用它们。我把它们做成了 0.25R+ 0.5G+0.25B。它会产生稍暗的图像。

注意：以下代码假定 xRGB 32 位像素格式

```
unsigned int *pntrBWImage=(unsigned int*)..data pointer..;  //assumes 4*width*height bytes with 32 bits i.e. 4 bytes per pixel
unsigned int fourBytes;
        unsigned char r,g,b;
        for (int index=0;index<width*height;index++)
        {
            fourBytes=pntrBWImage[index];//caches 4 bytes at a time
            r=(fourBytes>>16);
            g=(fourBytes>>8);
            b=fourBytes;

            I_Out[index] = (r >>2)+ (g>>1) + (b>>2); //This runs in 0.00065s on my pc and produces slightly darker results
            //I_Out[index]=((unsigned int)(r+g+b))/3;     //This runs in 0.0011s on my pc and produces a pure average
        } 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-26T19:51:20.330

查看[颜色常见问题解答](http://homepages.inf.ed.ac.uk/rbf/CVonline/LOCAL_COPIES/POYNTON1/ColorFAQ.html)以获取相关信息。这些值来自我们在显示器中使用的 RGB 值的标准化。实际上，根据颜色常见问题解答，您使用的值已经过时，因为它们是用于原始 NTSC 标准而不是现代显示器的值。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2019-05-20T05:15:29.400

> 这些价值观的来源是什么？

发布的系数的“来源”是 NTSC 规范，可以在[Rec601](https://www.itu.int/rec/R-REC-BT.601/recommendation.asp?lang=en&parent=R-REC-BT.601-7-201103-I)和[“电视特征”中](https://www.itu.int/pub/R-REP-BT.624-4-1990)看到。

“最终来源”是 CIE 大约 1931 年关于人类颜色感知的实验。人类视觉的光谱响应是不均匀的。实验导致基于感知的三刺激值加权。我们的 L、M 和 S 视锥细胞¹对我们识别为“红色”、“绿色”和“蓝色”（分别）的光波长敏感，这就是派生三原色的地方。²

sRGB（和 Rec709）的线性光³光谱权重为：

### R[林]* 0.2126 + G[林]* 0.7152 + B[林]* 0.0722 = Y

这些特定于 sRGB 和 Rec709 色彩空间，旨在表示计算机显示器 (sRGB) 或 HDTV 显示器 (Rec709)，并在[Rec709](https://www.itu.int/rec/R-REC-BT.709/recommendation.asp?lang=en&parent=R-REC-BT.709-6-201506-I)和[BT.2380-2 (10/2018)的 ITU 文档中进行了详细说明](https://www.itu.int/dms_pub/itu-r/opb/rep/R-REP-BT.2380-2-2018-PDF-E.pdf)

***脚注*** (1) 视锥细胞是眼睛视网膜的颜色检测细胞。
(2) 然而，所选择的三色光波长不在每个锥体类型的“峰值”处——而是选择三色值，使得它们对特定锥体类型的刺激明显多于另一种，即刺激分离。
(3) 在应用系数之前，您需要对 sRGB 值进行线性化。我在[这里的另一个答案中讨论了这个问题。](https://stackoverflow.com/a/56200738/10315269)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-03-24T15:25:16.430

开始一个列表来列举不同的软件包是如何做到的。[这是一篇很好的 CVPR 论文，也可以阅读](https://openaccess.thecvf.com/content_cvpr_2017/papers/Nguyen_Why_You_Should_CVPR_2017_paper.pdf)。

**[免费图片](https://github.com/WinMerge/freeimage/blob/master/Source/Utilities.h#L478)**

```
#define LUMA_REC709(r, g, b)    (0.2126F * r + 0.7152F * g + 0.0722F * b)
#define GREY(r, g, b) (BYTE)(LUMA_REC709(r, g, b) + 0.5F) 
```

**[开放式CV](https://docs.opencv.org/2.4/modules/imgproc/doc/miscellaneous_transformations.html#void%20cvtColor%28InputArray%20src,%20OutputArray%20dst,%20int%20code,%20int%20dstCn%29)**

**[nVidia 性能基元](https://docs.nvidia.com/cuda/npp/group__image__color__to__gray.html)**

**[英特尔性能原语](https://software.intel.com/content/www/us/en/develop/documentation/ipp-dev-reference/top/volume-2-image-processing/image-color-conversion/color-gray-scale-conversions/rgbtogray.html)**

**[MATLAB](https://www.mathworks.com/help/matlab/ref/rgb2gray.html)**

```
nGray =  0.299F * R + 0.587F * G + 0.114F * B; 
```

* * *

## 回答 #7

> 赞同：-4
> 
> 时间：2016-08-18T01:04:03.037

这些价值观因人而异，尤其是对于色盲的人。

* * *

## 回答 #8

> 赞同：-7
> 
> 时间：2018-03-13T13:45:05.180

这一切真的有必要吗，人类的感知和CRT vs LCD会有所不同，但RGB强度不会，为什么不`L = (R + G + B)/3`将新的RGB设置为L，L，L？

# c# - ASP.NET 将 PDF 写入文件系统

> ID：687263
> 
> 赞同：2
> 
> 时间：2009-03-26T19:39:38.753
> 
> 标签：c#, .net, asp.net, iis, file-permissions

我有一份报告，我目前允许用户在提供报告参数（日期范围、过滤器等）时选择输出选项（HTML 或 PDF）。

我想更改报告，使其始终执行 HTML 并在呈现的 HTML 页面上放置一个链接，以便用户可以根据需要获取 PDF。

如何修改我的 IIS6/IIS7 配置、用户权限等，以允许我的站点将 PDF 写入文件系统？任何 C# 代码将不胜感激。

我计划使用随机文件名创建 PDF，并添加一个清理旧 PDF 的过程，这样我就不会遇到磁盘空间问题。这是一个轻度使用的网络应用程序，所以我不担心有很多旧的 PDF 文件挂在周围。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T19:44:34.933

在 IIS 6 管理器中，转到应用程序池并获取您的网站正在运行的应用程序池的属性（如果您不确定，它位于网站属性对话框 > 主目录选项卡上）。转到身份选项卡，查看应用程序池在哪个用户帐户下运行。

然后转到您要写入 PDF 的目标文件夹，右键单击并转到属性 > 安全 > 添加并为应用程序池列出的帐户添加“写入”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-12-15T05:58:23.223

n IIS 6 管理器，转到应用程序池并获取您的网站正在运行的应用程序池的属性（如果您不确定，它位于网站属性对话框 > 主目录选项卡上）。转到身份选项卡，查看应用程序池在哪个用户帐户下运行。

然后转到您要写入 PDF 的目标文件夹，右键单击并转到属性 > 安全 > 添加并为应用程序池列出的帐户添加“写入”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T19:43:12.627

您需要做的就是确保运行网站的用户 ID（或登录的用户，如果您的网站以这种方式运行）对您正在创建 PDF 的目录具有写入权限。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T19:56:24.517

您应该查看 .NET 中的 System.Security.Permissions 命名空间和 FileIOPermission 类，以便在尝试写入文件时确保正确设置了文件权限。

我使用它的方式与您需要它的方式大致相同（在将 PDF 文件提供给用户之前将它们写入服务器）。

# asp.net - 以编程方式在 GridView 中添加和删除事件

> ID：687267
> 
> 赞同：3
> 
> 时间：2009-03-26T19:40:14.897
> 
> 标签：asp.net, gridview

我有一个像下面这样的 GridView：

```
<asp:GridView ID="Results" runat="server" OnRowDataBound="Results_RowDataBound">
    <EmptyDataTemplate>No results found</EmptyDataTemplate>
</asp:GridView>

Protected Sub Results_RowDataBound(ByVal sender As Object, ByVal e As GridViewRowEventArgs)
            'do a bunch of work here
End Sub 
```

根据用户输入，有时我希望触发 OnRowDataBound 事件，有时我不想触发。

有没有办法以编程方式打开或关闭事件？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T19:47:17.423

这是以编程方式[在 VB.NET 中添加和删除事件](http://msdn.microsoft.com/en-us/library/6yyk8z93(VS.80).aspx)的示例代码：

```
If CheckBox1.Checked Then
    AddHandler Results.RowDataBound, AddressOf Results_RowDataBound
Else
    RemoveHandler Results.RowDataBound, AddressOf Results_RowDataBound
End If 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T19:42:38.370

在您的事件处理程序中添加一个 if 并在您不需要它时忽略该事件不是更容易吗？

# asp.net - 无法调试 ASP .NET 1.0 应用程序

> ID：687270
> 
> 赞同：0
> 
> 时间：2009-03-26T19:41:25.753
> 
> 标签：asp.net, registry, .net-1.0

当我尝试在 .NET 1.0 中调试网站时，出现以下错误“尝试运行项目时出错：无法在 Web 服务器上开始调试。无法从注册表中读取密钥”

由于无法从注册表中读取密钥，我无法找到有关此特定错误的任何文档。

我确实查看了[Microsoft KB For This](http://support.microsoft.com/kb/306172)，但是它没有任何注册表读取错误。

编辑：我找到了解决这个问题的方法。将运行 aspnet_wp.exe 的用户名添加到 PC 上的 Administrators 组。这是一件非常糟糕的事情，因为它暴露了您机器上的安全漏洞。但是，仍然不清楚该帐户需要哪些“其他”权限才能“从注册表中读取密钥”。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T14:43:17.350

Consider running the [RegMon](http://technet.microsoft.com/en-us/sysinternals/bb896652.aspx) from SysInternals. It should show your which registry keys get denied.

# sql-server - 我的 IN 子句导致对 T-SQL 中的索引进行全面扫描。我能做些什么？

> ID：687271
> 
> 赞同：2
> 
> 时间：2009-03-26T19:41:28.030
> 
> 标签：sql-server, tsql, optimization, indexing

我有一个带有 50 个参数的 sql 查询，例如这个。

```
DECLARE
  @p0 int, @p1 int, @p2 int, (text omitted), @p49 int

SELECT
  @p0=111227, @p1=146599, @p2=98917, (text omitted), @p49=125319

--
SELECT
  [t0].[CustomerID], [t0].[Amount],
  [t0].[OrderID], [t0].[InvoiceNumber]
FROM [dbo].[Orders] AS [t0]
WHERE ([t0].[CustomerID]) IN
  (@p0, @p1, @p2, (text omitted), @p49) 
```

估计的执行计划显示，数据库会收集这些参数，对它们进行排序，然后**从参数最小到最大***读取索引 Orders.CustomerID* ，然后对其余记录进行书签查找。

 **问题是最小和最大参数可能相距甚远，这可能会导致读取整个索引。

由于这是从客户端循环完成的（每次发送 50 个参数，用于**1000 次迭代**），这是一个糟糕的情况。如何制定查询/客户端代码来获取我的数据而无需重复索引扫描，同时保持往返次数减少？

* * *

我考虑对 50k 参数进行排序，以便出现较小的索引读数。有一个奇怪的缓解情况可以防止这种情况发生——我不能使用这个解决方案。为了模拟这种情况，假设我在任何时候只有 50 个 id 可用，并且无法控制它们在全局列表中的相对位置。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-26T19:45:58.597

将参数插入临时表，然后将其与您的表连接：

```
DECLARE @params AS TABLE(param INT);

INSERT
INTO    @params
VALUES  (@p1)
...
INSERT
INTO    @params
VALUES  (@p49)

SELECT
  [t0].[CustomerID], [t0].[Amount],
  [t0].[OrderID], [t0].[InvoiceNumber]
FROM @params, [dbo].[Orders] AS [t0]
WHERE ([t0].[CustomerID]) = @params.param 
```

这很可能会在每个循环上`NESTED LOOPS`使用`INDEX SEEK`over 。`CustomerID`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T20:11:24.527

索引范围扫描非常快。索引中的数据通常比表中的数据少得多，而且索引已经在内存中的可能性要大得多。

我不能责怪您希望通过将您要查找的每个 ID 打包来节省往返服务器的往返行程。如果索引 RANGE 扫描真的让您担心，您可以创建一个参数化的服务器端游标（例如，在 TSQL 中），它将 CustomerID 作为参数。找到匹配项后立即停止。该查询绝对应该使用索引唯一扫描而不是范围扫描。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T15:00:44.950

为了建立 Quassnoi 的答案，如果您使用的是 SQL 2008，则可以通过使用一条语句插入所有 50 个项目来节省一些时间。SQL 2008 具有用于多值插入的新功能。例如

```
INSERT INTO @Customers (CustID)
VALUES (@p0),
       (@p1),
       <snip>
       (@p49) 
```

现在@Customers 表已填充并准备就绪`INNER JOIN`，或者您的`IN`子句。

# asp.net-mvc - 结构映射 InstanceScope.Hybrid 与 asp.net mvc 行为不端

> ID：687276
> 
> 赞同：0
> 
> 时间：2009-03-26T19:42:26.390
> 
> 标签：asp.net-mvc, linq-to-sql, structuremap

我真的被困在这里了。

我有一个 asp.net mvc 应用程序并使用 StructureMap 2.5.3 (SM) 在我的控制器中注入服务和存储库类。所有控制器均由 SM 工厂制造。

我还有一个 Linq to SQL 数据上下文，我想通过混合进行缓存。

```
public class DBRegistry:Registry
{
    public  DBRegistry()
    {
        ForRequestedType<SharpShopDataContext>()
            .CacheBy(StructureMap.Attributes.InstanceScope.Hybrid)
            .TheDefault.IsThis(new SharpShopDataContext());
    }
} 
```

缓存似乎不起作用，因此我遇到了数据上下文问题。

多个浏览器请求都返回相同的dbcontext？！在我的一个存储库类中，我放置了这段代码。Debug.WriteLine("db hashcode: " + db.GetHashCode()+ " "+ DateTime.Now.ToString());

其中 db=datacontext 我还使用 db 打印存储库的哈希码，使用存储库打印服务，这里是多个请求的打印：

服务哈希码：6238972 26-3-2009 18:59:34

存储库哈希码：21756593 26-3-2009 18:59:34

数据库哈希码：7043935 26-3-2009 18:59:34

服务哈希码：59389065 26-3-2009 18:59:34

存储库哈希码：8331620 26-3-2009 18:59:34

数据库哈希码：7043935 26-3-2009 18:59:34

服务哈希码：11291358 26-3-2009 18:59:38

存储库哈希码：13848497 26-3-2009 18:59:38

数据库哈希码：7043935 26-3-2009 18:59:38

服务哈希码：42509361 26-3-2009 18:59:38

存储库哈希码：56101068 26-3-2009 18:59:38

数据库哈希码：7043935 26-3-2009 18:59:38

如您所见，7043935 是每次请求的数据上下文的哈希码，但服务和存储库每次都会获得一个新实例和哈希码。

因此，我得到了奇怪的错误，例如数据并发异常，因为 dbcontext 具有 4 个 webrequests 前的原始值，而数据库被另一个源更改。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-07-18T04:57:57.170

如果您试图让 SM 为`DataContext`每个 HttpRequest 创建一个，那么您的新`Registry`配置应该可以工作

```
ForRequestedType<ISharpShopDataContextWrapper>()
            .CacheBy(StructureMap.Attributes.InstanceScope.Hybrid)
            .TheDefaultIsConcreteType<SharpShopDataContextWrapper>(); 
```

`InstanceScope.Hybrid`如果您想要“每个线程或 ASP.NET 请求一次”生命周期，您应该使用 SM (v2.5.3) 枚举值（让我们转到源代码[Chad Myers](http://dotnetslackers.com/articles/designpatterns/IntroductionToStructureMap.aspx#intermediate-level-concepts)，SM[贡献者](http://www.ohloh.net/p/structuremap)）

如果您正确配置应用程序基础架构，则不应“必须更改大量代码”。我很想知道您为什么决定为您的`SharpShopDataContext`? LinqToSql`DataContext`被声明为分部类，因此您可以轻松创建`SharpShopDataContext`实现任何附加接口的分部类：

**LinqToSql**生成的部分类定义

```
public partial class SharpShopDataContext: System.Data.Linq.DataContext{
    /*Linq2Sql gen here*/
} 
```

**您的**部分类定义

```
public partial class SharpShopDataContext: ISharpShopDataContext{
   /*your implementation here*/
} 
```

您可以考虑阅读一些[Jeremy Miller 的 StructureMap 文章](http://codebetter.com/blogs/jeremy.miller/archive/tags/StructureMap/default.aspx)。一旦你很好地理解了它的功能，你可能会重构你的整个 MVC 应用程序。我知道我当前的基本 MVC 应用程序框架是高度可配置/可测试的，因为 SM IoC（以及大量试验/错误/气味/重构）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T21:04:16.707

这绝对是一个问题线：

```
.TheDefault.IsThis 
```

您正在指定一个特定的实例，这就是导致它返回相同的原因，即使指定 PerRequest。请注意，您更改为（在您的解决方法中）：

```
.TheDefaultIsConcreteType<SharpShopDataContextWrapper>(); 
```

附言。我没有使用过 HybridScope，但我有一个使用默认实例范围 (PerRequest) 的生产应用程序，并且每次传递数据上下文时它肯定会给出一个新的应用程序。如果您想具体控制它的实例化方式，请尝试其中一种接受表达式的方法，即您发送的方式：

```
() => new MyDataContext() 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T20:29:47.790

我有一个解决方法，但对此并不满意，因为我知道我必须更改很多代码，而且我通过反复试验发现了它。

我现在使用：

```
 ForRequestedType<ISharpShopDataContextWrapper>()
            .CacheBy(StructureMap.Attributes.InstanceScope.Hybrid)
            .TheDefaultIsConcreteType<SharpShopDataContextWrapper>(); 
```

接口的注入/缓存似乎有效。这是接口+具体包装器的实现。

所以它看起来真的像 SM 中的一个错误，还是我错过了什么？

```
public interface ISharpShopDataContextWrapper
{
    SharpShopDataContext DataContext
    {
        get;
    }
}

public class SharpShopDataContextWrapper : ISharpShopDataContextWrapper
{
    SharpShopDataContext db;

    public SharpShopDataContextWrapper()
    {
        db = new SharpShopDataContext();
    }
    public SharpShopDataContext DataContext
    {
        get { return db; }
    }
} 
```

# jquery - 用动画展开 div

> ID：687284
> 
> 赞同：4
> 
> 时间：2009-03-26T19:44:39.380
> 
> 标签：jquery, ajax, effects

我有一个 div 正在接收来自 ajax 调用的内容。现在我只是在 ajax 回调处理程序中这样做：

```
function searchCallback(html) { $("#divSearchResults").html(html); } 
```

这使得内容“弹出”到页面上，而且非常突兀。有没有办法让 div 优雅地调整大小，就像 .slideToggle() 方法一样？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T19:51:41.767

确保它是隐藏的，然后添加内容并将其滑入。

```
$("#divSearchResults").hide();
$("#divSearchResults").html(html);
$("#divSearchResults").slideDown(); 
```

或者您可以将其淡入：

```
$("#divSearchResults").fadeIn(); 
```

为确保您的页面在内容出现时不会“爆炸”，请确保 div 被隐藏以防止出现。此外，请确保添加内容后，页面看起来不错。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T19:48:55.767

你可以一开始就隐藏它。然后插入html，当该功能完成后，对其进行显示效果。（就像你的幻灯片切换）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T19:50:26.790

不确定这是否可行，但值得尝试：

*   找出当前的 div 大小并将其设置为固定。
*   更新 HTML
*   将高度和宽度设置为“自动”。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T19:58:17.553

当然，你可以试试这个：

```
function searchCallback(html) {
    var html_hidden = $('<div style="display:none;" class="hidden_insert">'+html+'</div>');
    $('#divSearchResults').html(html);
    $('#divSearchResults .hidden_insert').slideDown('medium');
} 
```

不是最漂亮的东西，但它会起作用。您可以通过为“hidden_​​insert”类创建一个 CSS 样式来美化它，这将使该类的元素默认隐藏。此外，在您发送此日期的后端，您可以在那里而不是在您的 javascript 中进行包装。然后可以将脚本简化为：

```
function searchCallback(html) { 
    $('#divSearchResults').html(html).find('.hidden_insert').slideDown('medium');
} 
```

我没有测试过这些，但它们应该可以工作。

# c# - 为什么没有创建或调用我的 IE MIME 过滤器？

> ID：687287
> 
> 赞同：2
> 
> 时间：2009-03-26T19:46:01.857
> 
> 标签：c#, .net, com, interop

我正在尝试创建一个 MIME 过滤器，以便在将网页接收到的资源传递给我们的 Windows 应用程序中的 Web 浏览器控件之前对它们进行一些自定义处理。该应用程序是用 C# 编写的，如果可能的话，我也想在托管代码中编写 MIME 过滤器。不过我遇到了麻烦：我的过滤器对象似乎根本没有被调用。

这是我的代码。抱歉这么长，但我想我可能在 COM 接口中定义了一些不正确的东西，所以我也包括了这些。任何想法我做错了什么？

```
[ComImport]
[InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]
[Guid("00000001-0000-0000-C000-000000000046")]
public interface IClassFactory
{
    void CreateInstance([MarshalAs(UnmanagedType.IUnknown)] object pUnkOuter, ref Guid riid, out IntPtr ppvObject);
    void LockServer(bool fLock);
}

[ComImport]
[InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]
[Guid("79EAC9E4-BAF9-11CE-8C82-00AA004BA90B")]
public interface IInternetProtocol : IInternetProtocolRoot
{
    void LockRequest(Int32 dwOptions);
    [PreserveSig]
    Int32 Read(IntPtr pv, UInt32 cb, out UInt32 pcbRead);
    void Seek(Int64 dlibMove, UInt32 dwOrigin, out UInt64 plibNewPosition);
    void UnlockRequest();
}

[ComImport]
[InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]
[Guid("79EAC9E3-BAF9-11CE-8C82-00AA004BA90B")]
public interface IInternetProtocolRoot
{
    void Abort(Int32 hrReason, Int32 dwOptions);
    void Continue(IntPtr pProtocolData);
    void Resume();
    void Start([MarshalAs(UnmanagedType.LPWStr)] string szUrl, IInternetProtocolSink pOIProtSink,
               IntPtr pOIBindInfo, UInt32 grfPI, IntPtr dwReserved);
    void Suspend();
    void Terminate(Int32 dwOptions);
}

[ComImport]
[InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]
[Guid("79EAC9E5-BAF9-11CE-8C82-00AA004BA90B")]
public interface IInternetProtocolSink
{
    void Switch(IntPtr pProtocolData);
    void ReportProgress(UInt32 ulStatusCode, [MarshalAs(UnmanagedType.LPWStr)] string szStatusText);
    void ReportData(UInt32 grfBSCF, UInt32 ulProgress, UInt32 ulProgressMax);
    void ReportResult(Int32 hrResult, UInt32 dwError, [MarshalAs(UnmanagedType.LPWStr)] string szResult);
}

[ComImport]
[InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]
[Guid("79eac9e7-baf9-11ce-8c82-00aa004ba90b")]
public interface IInternetSession
{
    void CreateBinding(); // Not Implemented
    void GetCache(); // Not Implemented
    void GetSessionOption(); // Not Implemented
    void RegisterMimeFilter([MarshalAs(UnmanagedType.Interface)] IClassFactory pCF, ref Guid rclsid, [MarshalAs(UnmanagedType.LPWStr)] string pwzType);
    void RegisterNameSpace([MarshalAs(UnmanagedType.Interface)] IClassFactory pCF, ref Guid rclsid, [MarshalAs(UnmanagedType.LPWStr)] string pwzProtocol,
                           UInt32 cPatterns, [MarshalAs(UnmanagedType.LPWStr)] string ppwzPatterns, UInt32 dwReserved);
    void SetCache(); // Not Implemented
    void SetSessionOption(); // Not Implemented
    void UnregisterMimeFilter(IClassFactory pCF, [MarshalAs(UnmanagedType.LPWStr)] string pwzType);
    void UnregisterNameSpace(IClassFactory pCF, [MarshalAs(UnmanagedType.LPWStr)] string pwzProtocol);
}

[ComVisible(true)]
[InterfaceType(ComInterfaceType.InterfaceIsDual)]
[Guid("C3ED53DA-EC0E-4625-AB0C-9837D0D0D59D")]
public interface _MimeFilter : IClassFactory, IInternetProtocol, IInternetProtocolRoot, IInternetProtocolSink
{
}

[ComVisible(true)]
[ClassInterface(ClassInterfaceType.None)]
[Guid("C3ED53DA-EC0E-4625-AB0C-9837D0D0D59D")]
public class MimeFilter : _MimeFilter
{
    #region [ IClassFactory ]
    public void CreateInstance([MarshalAs(UnmanagedType.IUnknown)] object pUnkOuter, ref Guid riid, out IntPtr ppvObject)
    {
        ... // This is never called
    }

    ...
}

internal class FilterUtils
{
    /// <summary>
    /// Registers the MIME filter for the current process
    /// </summary>
    public static void RegisterFilter()
    {
        IInternetSession session = null;
        int status = NativeMethods.CoInternetGetSession(0, ref session, 0);
        MimeFilter mf = new MimeFilter();
        Guid id = new Guid("C3ED53DA-EC0E-4625-AB0C-9837D0D0D59D");
        session.RegisterMimeFilter(mf, ref id, "text/html; charset=UTF-8");
    }

    private static class NativeMethods
    {
        [DllImport("urlmon.dll")]
        public static extern int CoInternetGetSession(UInt32 dwSessionMode /* = 0 */, ref IInternetSession ppIInternetSession, UInt32 dwReserved /* = 0 */);
    }
} 
```

据我所知，接下来应该发生的事情是应该调用 MimeFilter.CreateInstance() 方法。它不会被调用，MimeFilter 中的任何其他方法也不会被调用。

任何人都可以提供任何帮助，我将不胜感激。谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-08T15:25:13.940

结果 MSDN 文档和 Visual Studio 2008 不同意默认的 COM 可见性。MSDN 文档说所有 .NET 类型默认对 COM 可见，但 Visual Studio 2008 类库项目模板在 AssemblyInfo.cs 文件中禁用 COM 可见性。

解决方法：去掉线

```
[assembly: ComVisible(false)] 
```

来自 AssemblyInfo.cs 文件。

我可能也有错误的 COM 接口声明。[我已经用这个 CodeProject 文档](http://www.codeproject.com/KB/aspnet/AspxProtocol.aspx)中的那些替换了它们。

我发现的唯一可读的 MIME 过滤器示例代码可[在此处](http://www.bsalsa.com/forum/showpost.php?p=3031&postcount=4)获得，并且（简要）[记录在此处](http://www.bsalsa.com/mime_filter.html)。

# java - 使用现有的 KerberosTicket 绑定到 Ldap 并搜索用户属性

> ID：687291
> 
> 赞同：1
> 
> 时间：2009-03-26T19:46:53.697
> 
> 标签：java, ldap, kerberos

给定已转发到我的代码的现有 javax.security.auth.kerberos.KerberosTicket，Java 中有没有办法查询 Active Directory 中的用户属性？我知道我想使用 Ldap 进行搜索，但我对如何使用此 KerberosTicket 对象绑定到 ldap 感到困惑。目前我正在使用 Spring-Ldap 和 Spring-Security 与 Active Directory 通信并使用简单的身份验证凭据我可以绑定用户名和密码来验证我的用户并检索我的所有属性、角色等。但是在我通过的情况下来自该 Active Directory 服务器的 KerberosTicket 我现在知道如何绑定自己，因为我不知道该用户的密码。我目前没有从 LoginContext 调用 login() 来获取我的 KerberosTicket，它已作为加密的 java 对象转发到我的代码。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-02-10T12:43:13.720

在您的 LDAP 连接环境中，将 Context.SECURITY_AUTHENTICATION 设置为“GSSAPI”。然后在特权操作中创建 InitialLdapContext：

InitialLdapContext 上下文；Subject.doAs(subject, new PrivilegedAction() { public Object run() { context = new InitialLdapContext(env, null); } };

您可以通过在 LoginContext 上调用 getSubject() 来获取主题变量。env 是环境。您将不得不以某种方式捕获 NamingException。请注意，要使其在较新的 Windows 版本上工作，您必须设置注册表条目，请参阅[http://java.sun.com/j2se/1.5.0/docs/guide/security/jgss/tutorials/Troubleshooting.html](http://java.sun.com/j2se/1.5.0/docs/guide/security/jgss/tutorials/Troubleshooting.html) (搜索注册表）。

# python - 如何在 Django 查询集过滤中执行不等于？

> ID：687295
> 
> 赞同：838
> 
> 时间：2009-03-26T19:47:45.923
> 
> 标签：python, django, django-models, django-queryset

在 Django 模型 QuerySets 中，我看到比较值有一个`__gt`和`__lt`，但是有一个`__ne`或`!=`（**不等于**）吗？我想使用不等于过滤掉。例如，对于

```
Model:
    bool a;
    int x; 
```

我想要做

```
results = Model.objects.exclude(a=True, x!=5) 
```

`!=`语法不正确。我也试过了`__ne`。

我最终使用：

```
results = Model.objects.exclude(a=True, x__lt=5).exclude(a=True, x__gt=5) 
```

* * *

## 回答 #1

> 赞同：918
> 
> 时间：2009-07-20T17:58:38.883

您可以为此使用[Q 对象](https://docs.djangoproject.com/en/stable/topics/db/queries/#complex-lookups-with-q)。它们可以用`~`运算符取反，并像普通的 Python 表达式一样组合：

```
from myapp.models import Entry
from django.db.models import Q

Entry.objects.filter(~Q(id=3)) 
```

将返回除`3`ID 为以下的所有条目：

```
[<Entry: Entry object>, <Entry: Entry object>, <Entry: Entry object>, ...] 
```

* * *

## 回答 #2

> 赞同：733
> 
> 时间：2010-11-09T23:56:13.523

您的查询似乎有一个双重否定，您想要排除所有`x`不是 5 的行，所以换句话说，您想要包括所有`x` *为*5 的行。我相信这会成功：

```
results = Model.objects.filter(x=5).exclude(a=True) 
```

要回答您的具体问题，没有“不等于”[字段查找](http://docs.djangoproject.com/en/stable/ref/models/querysets/#field-lookups)，但这可能是因为 Django 具有可用的[`filter`](https://docs.djangoproject.com/en/stable/ref/models/querysets/#filter)和[`exclude`](https://docs.djangoproject.com/en/stable/ref/models/querysets/#exclude)方法，因此您始终可以切换逻辑以获得所需的结果。

* * *

## 回答 #3

> 赞同：150
> 
> 时间：2009-07-20T18:07:02.423

查询中的`field=value`语法是`field__exact=value`. 也就是说[Django 将查询运算符放在了 identifiers 中的查询字段上](http://docs.djangoproject.com/en/dev/ref/models/querysets/#field-lookups)。Django 支持以下运算符：

```
exact
iexact
contains
icontains
in
gt
gte
lt
lte
startswith
istartswith
endswith
iendswith
range

date
year
iso_year
month
day
week
week_day
iso_week_day
quarter
time
hour
minute
second

isnull
regex
iregex 
```

我敢肯定，通过将这些与[Dave Vogt 建议](https://stackoverflow.com/questions/687295/how-do-i-do-a-not-equal-in-django-queryset-filtering/1154977#1154977)的 Q 对象结合使用，`filter()`或者`exclude()`按照[Jason Baker 的建议](https://stackoverflow.com/questions/687295/how-do-i-do-a-not-equal-in-django-queryset-filtering/687316#687316)，您将获得几乎任何可能查询所需的内容。

* * *

## 回答 #4

> 赞同：131
> 
> 时间：2016-02-24T13:12:47.010

有三个选项：

1.  [链`exclude`和`filter`](https://docs.djangoproject.com/en/stable/topics/db/queries/#retrieving-specific-objects-with-filters)

    ```
    results = Model.objects.exclude(a=True).filter(x=5) 
    ```

2.  使用[`Q()`对象](https://docs.djangoproject.com/en/stable/ref/models/querysets/#q-objects)和[`~`运算符](https://docs.djangoproject.com/en/stable/topics/db/queries/#complex-lookups-with-q-objects)

    ```
    from django.db.models import Q
    object_list = QuerySet.filter(~Q(a=True), x=5) 
    ```

3.  注册[自定义查找函数](https://docs.djangoproject.com/en/stable/howto/custom-lookups/#a-lookup-example)

    ```
    from django.db.models import Lookup
    from django.db.models import Field

    @Field.register_lookup
    class NotEqual(Lookup):
        lookup_name = 'ne'

        def as_sql(self, compiler, connection):
            lhs, lhs_params = self.process_lhs(compiler, connection)
            rhs, rhs_params = self.process_rhs(compiler, connection)
            params = lhs_params + rhs_params
            return '%s <> %s' % (lhs, rhs), params 
    ```

    哪个可以照常使用：

    ```
    results = Model.objects.exclude(a=True, x__ne=5) 
    ```

* * *

## 回答 #5

> 赞同：114
> 
> 时间：2015-03-24T08:07:27.437

创建自定义查找很容易，[Django 的官方文档](https://docs.djangoproject.com/en/stable/howto/custom-lookups/#a-lookup-example)`__ne`中有一个查找示例。

您需要先创建查找本身：

```
from django.db.models import Lookup

class NotEqual(Lookup):
    lookup_name = 'ne'

    def as_sql(self, compiler, connection):
        lhs, lhs_params = self.process_lhs(compiler, connection)
        rhs, rhs_params = self.process_rhs(compiler, connection)
        params = lhs_params + rhs_params
        return '%s <> %s' % (lhs, rhs), params 
```

然后你需要注册它：

```
from django.db.models import Field
Field.register_lookup(NotEqual) 
```

现在您可以`__ne`像这样在查询中使用查找：

```
results = Model.objects.exclude(a=True, x__ne=5) 
```

* * *

## 回答 #6

> 赞同：48
> 
> 时间：2011-01-18T14:34:16.470

`=`虽然您可以使用、`__gt`、`__gte`、`__lt`、过滤模型`__lte`，但您不能使用`ne`或`!=`。但是，您可以使用 Q 对象实现更好的过滤。

您可以避免链接`QuerySet.filter()`and `QuerySet.exclude()`，并使用它：

```
from django.db.models import Q
object_list = QuerySet.filter(~Q(field='not wanted'), field='wanted') 
```

* * *

## 回答 #7

> 赞同：27
> 
> 时间：2016-04-21T08:44:38.413

# 待定的设计决定。同时，使用`exclude()`

Django 问题跟踪器有一个非凡的[条目 #5763](https://code.djangoproject.com/ticket/5763)，标题为*"Queryset doesn't have a "not equal" filter operator"*。这很了不起，因为（截至 2016 年 4 月）它是“9 年前开放的”（在 Django 石器时代）、“4 年前关闭”和“5 个月前最后一次更改”。

通读讨论，很有趣。基本上，有些人认为`__ne`应该添加，而另一些人则认为`exclude()`更清楚，因此*不*`__ne` 应该添加。

 *（我同意前者，因为后者的论点大致相当于说 Python 不应该有`!=`，因为它有`==`并且`not`已经......）

* * *

## 回答 #8

> 赞同：25
> 
> 时间：2018-07-12T10:43:14.147

使用排除和过滤

```
results = Model.objects.filter(x=5).exclude(a=true) 
```

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2015-09-25T08:52:02.660

你应该使用`filter`并且`exclude`喜欢这个

```
results = Model.objects.exclude(a=true).filter(x=5) 
```

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2018-01-13T03:23:37.900

[Django-model-values](https://pypi.org/project/django-model-values/)（披露：作者）提供了[NotEqual](https://github.com/coady/django-model-values/blob/v0.5.1/model_values.py#L374)查找的实现，如[this answer](https://stackoverflow.com/a/29227603/36433)中所示。它还为其提供语法支持：

```
from model_values import F
Model.objects.exclude(F.x != 5, a=True) 
```

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2019-09-29T10:48:09.593

这将给出您想要的结果。

```
from django.db.models import Q
results = Model.objects.exclude(Q(a=True) & ~Q(x=5)) 
```

对于**不相等**，您可以`~`在相等查询中使用。显然，`Q`可以用来达到相等查询。

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2009-03-26T19:54:05.923

最后一段代码将排除 x!=5 且 a 为 True 的所有对象。试试这个：

```
results = Model.objects.filter(a=False, x=5) 
```

请记住，上一行中的 = 符号将 False 分配给参数 a，将数字 5 分配给参数 x。它不是检查平等。因此，实际上没有任何方法可以在查询调用中使用 != 符号。

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2016-06-27T12:50:58.053

您正在寻找的是所有具有`a=false` **或** `x=5`的对象。在 Django 中，`|`充当`OR`查询集之间的运算符：

```
results = Model.objects.filter(a=false)|Model.objects.filter(x=5) 
```

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2017-02-22T12:12:00.773

```
结果 = Model.objects.filter(a = True).exclude(x = 5)
```

生成此 sql：

```
select * from tablex where a != 0 and x !=5
```

sql 取决于您的 True/False 字段的表示方式以及数据库引擎。django 代码就是你所需要的。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2019-03-14T13:21:43.090

注意这个问题的许多错误答案！

Gerard 的逻辑是正确的，尽管它会返回一个列表而不是一个查询集（这可能无关紧要）。

如果您需要查询集，请使用 Q：

```
from django.db.models import Q
results = Model.objects.filter(Q(a=false) | Q(x=5)) 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2021-06-13T21:03:51.407

如果我们需要根据我们可以使用的子查询集排除/否定，

[条件过滤器](https://docs.djangoproject.com/en/3.2/ref/models/conditional-expressions/#conditional-filter)：

当条件表达式返回一个布尔值时，可以直接在过滤器中使用它。这里`non_unique_account_type`返回一个布尔值。但是，我们仍然可以在过滤器中使用它。

```
>>> non_unique_account_type = Client.objects.filter(
...     account_type=OuterRef('account_type'),
... ).exclude(pk=OuterRef('pk')).values('pk')
>>> Client.objects.filter(~Exists(non_unique_account_type)) 
```

在 SQL 术语中，它的计算结果为：

```
SELECT * FROM client c0
WHERE NOT EXISTS (
  SELECT c1.id
  FROM client c1
  WHERE c1.account_type = c0.account_type AND NOT c1.id = c0.id
) 
```

# performance - 数据库索引速度与缓存

> ID：687299
> 
> 赞同：2
> 
> 时间：2009-03-26T19:49:25.920
> 
> 标签：performance, oracle, caching, indexing

我们在一个表中有大约 10K 行。我们希望有一个表单，其中我们有一个选择下拉列表，其中包含此表中给定列的不同值。我们在有问题的列上有一个索引。

为了提高性能，我创建了一个包含不同值的小缓存表，因此我们不需要`select distinct field from table`针对 10K 行执行操作。令人惊讶的是，（10 行）似乎`select * from cachetable`并不比对 10K 行执行 select distinct 快。为什么是这样？索引是否完成了所有工作？通过查询缓存表，我们的主表中有多少行会提高性能？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T19:55:26.873

对于数据库，10K 行*算不了什么*。您没有看到太大的差异，因为实际计算时间很短，其中大部分时间都被其他恒定开销所消耗。

很难预测您何时开始注意到差异，但它可能会在大约一百万行。

如果您已经设置了缓存并且它没有害处，则不妨将其保留。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-26T19:53:12.247

10k 行并不多......当你达到 500k ~ 100 万行时开始关心。

索引做得很好，特别是如果该索引只有 10 个不同的值。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-26T20:04:02.530

这取决于许多因素——你的数据库的内存量、表中行的大小、参数化查询的使用等等，但通常 10K 并不是很多行，特别是如果表的索引很好的话它根本不会让任何现代 RDBMS 出汗。

根据经验，我通常只会在表通过 100K 行标记时才开始密切关注性能问题，如果正确索引并被此类访问，500K 通常不会造成太大问题。在大型表上，性能通常会发生灾难性的下降——你可能在 500K 行上没问题，但在 600K 上爬行——但在你完全可能遇到此类问题之前，你还有很长的路要走。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-26T20:18:56.537

> 索引是否完成了所有工作？

您可以通过查看执行计划来了解查询是如何执行的。

例如，试试这个：

```
explain plan for select distinct field from table;

select * from table(dbms_xplan.display); 
```

我注意到您没有在其中包含 ORDER BY。如果您不包括 ORDER BY，则结果集的顺序可能是随机的，特别是如果 oracle 使用 HASH 算法来制作不同的列表。你应该检查一下。

因此，我将查看您认为使用索引的原始查询的执行计划，以及基于缓存表的执行计划。也许发布它们，我们可以评论真正发生的事情。

顺便说一句，缓存表通常被实现为物化视图，特别是如果主表通常是相当静态的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-26T20:21:39.167

严重的过早优化。让数据库完成它的工作，也许对配置进行一些调整（特别是如果它是 MySQL，它有几种缓存类型和设置）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-26T20:11:17.443

您`10K`在行中的查询很可能使用`HASH SORT UNIQUE`.

`10K`很可能适合`db_buffers`and ，所有操作都在`hash_area_size`内存中执行，您不会注意到任何区别。

但是，如果查询将用作更复杂查询的一部分，或者将被其他数据换出，您可能需要`disk I/O`访问数据，这会减慢查询速度。

在多个会话中循环运行您的查询（与连接的用户一样多的会话），并查看它在这种情况下的执行情况。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-26T21:13:29.867

对于未来的计划和可扩展性，您可能希望研究使用纯内存或比 TCP DB 往返速度更快的索引服务。很多人（包括我自己）使用 Lucene 通过将数据标准化为平面文件来实现这一点。

Lucene 内置了 Ram Drive 目录索引器，可以将索引全部建立在内存中——消除了对文件系统的依赖，大大提高了速度。

最近，我构建了具有由 Web 服务包装的单个 Ram 驱动器索引的系统。然后，我对那个 Web 服务进行了类似 Ajax 的下拉查询，以实现高可用性和高速 - 没有 db 层，没有文件系统，只有纯内存和远程 tcp 数据包速度。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-03-26T20:25:47.923

如果列上有索引，那么所有值都在索引中，dbms 永远不必在表中查找。它只是查看只有 10 个条目的索引。如果这主要是只读数据，则将其缓存在内存中。缓存通过减轻数据库的工作量来帮助可扩展性和很多。如果同时进行 30 个查询，则在没有用户的数据库上快速执行的查询可能会表现不佳。

# wpf - UserControl自定义DependencyProperties问题

> ID：687307
> 
> 赞同：1
> 
> 时间：2009-03-26T19:52:08.597
> 
> 标签：wpf, user-controls, dependency-properties

我有一个带有图像和标签的自定义 UserControl，它们都是在设计时在 XAML 中设置的，如下所示：`<controls:HomeBarButton Icon="/SuCo;component/Resources/music.png" Text="music"/>`

当控件只有一个图标时，它看起来很好。当我添加 Text 属性时，图标在设计和运行时都会消失，并且文本标签会忽略 UserControl 中设置的格式，并且当标签居中时在控件的左上角只是黑色。

相关的用户控件 XAML：

```
 <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
    <Image x:Name="icon" Width="102" Height="102" VerticalAlignment="Stretch"  Source="{Binding Icon}"/>
    <Label x:Name="label" HorizontalContentAlignment="Center" VerticalAlignment="Bottom" Foreground="White" FontFamily="Calibri" FontSize="24" Padding="0" Content="{Binding Text}"></Label>
</StackPanel> 
```

代码隐藏：

```
 public ImageSource Icon
    {
        get { return (ImageSource)this.GetValue(IconProperty); }
        set { this.SetValue(IconProperty, value); }
    }

    public static readonly DependencyProperty IconProperty = DependencyProperty.Register("Icon", typeof(ImageSource), typeof(HomeBarButton), new FrameworkPropertyMetadata(OnIconChanged));

    private static void OnIconChanged(DependencyObject dependencyObject, DependencyPropertyChangedEventArgs e)
    {
        dependencyObject.SetValue(Image.SourceProperty, e.NewValue);
    }

    public string Text
    {
        get { return (string)this.GetValue(TextProperty); }
        set { this.SetValue(TextProperty, value); }
    }

    public static readonly DependencyProperty TextProperty = DependencyProperty.Register("Text", typeof(string), typeof(HomeBarButton), new FrameworkPropertyMetadata(OnTextChanged));

    private static void OnTextChanged(DependencyObject dependencyObject, DependencyPropertyChangedEventArgs e)
    {
        dependencyObject.SetValue(Label.ContentProperty, e.NewValue);
    } 
```

我究竟做错了什么？:(

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T20:17:38.053

首先，我将该标签更改为一个文本块——您将使用标签将标签的文本与另一个控件相关联。从您的代码看来，您没有这样做，只想显示文本。要检查的另一件事是您的文本是否显示在图标的顶部。我猜这就是正在发生的事情。更改为 TextBlock 可能会解决此问题，如果没有，您可能应该手动设置 TextBlock 的高度和 with。只是我的 0.02 价值。

# rdf - SPARQL 选择 RDF:ID

> ID：687308
> 
> 赞同：2
> 
> 时间：2009-03-26T19:52:15.447
> 
> 标签：rdf, sparql

我正在尝试使用 sparql（在 Protege 中）选择对象的 rdf:ID，但我似乎无法获得 rdf:ID。有没有人看到这个问题。我使用的 SPARQL 查询是：

`Select * where (?element rdf:id ?id)`

以下也不起作用：

`Select * where (?element rdfs:label ?id)`

接受了一个建议，但这仍然不行：

`Select * where (?element rdfs:about ?id)`

但这确实：

`Select * where (?element rdfs:comment ?id)`

我得到的只是“不匹配”。所以我可以选择评论而不是标签...想法？

更新：：经过更多研究，选择以下内容：

`Select ?subject ?property ?object where (?subject ?property ?object)`

不提供任何 RDFS 属性。我错过了什么重要的东西吗？（我可以用 rdfs:comment 选择它，但这也没有显示出来......

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-03T05:16:18.320

首先 rdf:id 在数据模型中不存在 - rdf 图三倍。" `rdf:ID`" 是在一种语法 RDF/XML 中使用的语法术语，但不出现在三元组中。同样`rdf:about`是一个语法术语。

至于为什么 protege 的 sparql 在这里不起作用——而且我没有使用过 Protege——我想你试图找到的三元组是由推理引擎推断出来的，因此不一定在基础 rdf 图中。

目前尚不清楚您要做什么。你想要[一些三元组的] URI 对象吗？你如何识别这个三元组？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-20T23:55:27.143

如果您正在寻找所有 RDF 主题的 URI，您将运行：

`SELECT ?subject WHERE { ?subject ?predicate ?object }`

请注意，您需要花括号而不是括号。还要注意 RDF 中大小写很重要，所以要非常小心 URI（以及前缀/本地名称）的拼写和大小写。

对于 dajobe 关于蕴涵（推断三元组）的观点，`rdfs:label`它是一个 OWL 注释属性，除非您包含自己的规则和/或 OWL 构造，否则推断器将忽略该属性。换句话说，如果您刚开始使用 RDF，如果推理器将三元组推断`rdfs:label`为谓词，我会感到惊讶。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T20:22:10.413

我猜您的 rdf:ID （您的 rdf 文档中的本地引用）将使用 xml:base 解析并转换为 rdf:about

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-06-13T23:58:00.473

以下查询为我`rdf:ID`提供了个人类型`pref:class`

```
select * where {
?id rdf:type pref:class
} 
```

# asp.net - 参数化 SQL 查询错误

> ID：687310
> 
> 赞同：1
> 
> 时间：2009-03-26T19:52:25.007
> 
> 标签：asp.net, sql, parameterized

我有一个构建动态参数化 SQL 查询的应用程序。以下查询返回“在“=”或附近出现“语法错误”的内部异常...

我认为这是我将参数分配给列名的方式，但是我不确定。代码如下。

```
SELECT TOP 50 77 AS Repository, DocID, LastFileDate, ImageCount,
 LockedUserID,   DocClass, Offline, FileType, OrigFileName, C_CredCardSSN, C_CredCardName,C_CredCardDocType, C_CredCardDocDate, C_CredCardStatus 

FROM D77 

WHERE C_CredCardSSN 

LIKE C_CredCardSSN = @sp1% 

ORDER BY C_CredCardSSN,C_CredCardName 
```

**编辑：**谢谢大家。所有这些答案都有帮助。=)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T19:53:42.040

试一试

```
WHERE C_CredCardSSN LIKE @sp1 
```

或者

```
WHERE C_CredCardSSN LIKE @sp1+'%' 
```

取决于你为什么在那里有一个“%”（感谢 Joel Coehoorn 指出我错过的“%”的评论）。

或者（回应您的评论）也许：

```
WHERE C_CredCardSSN LIKE ''+@sp1 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-26T19:57:23.780

LIKE 语句应如下所示：

```
WHERE C_CredCardSSN LIKE @sp1 + '%' 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T19:57:34.870

试试这个：

```
WHERE C_CredCardSSN like @sp1 + '%' 
```

如果前几个字符正确，这只会找到您的 C_CredCardSSN。要找到该值内的任何内容，请尝试这样

```
WHERE C_CredCardSSN like '%' + @sp1 + '%' 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T20:37:56.227

在将其作为参数添加到查询之前，尝试将“%”添加到文本中：

```
SqlParameter p = new SqlParameter("@sp1");
p.value = C_CredCardSSNText + "%"; 
```

# c# - 构建列表中项目计数的字典

> ID：687313
> 
> 赞同：11
> 
> 时间：2009-03-26T19:53:38.827
> 
> 标签：c#, list, dictionary

我有一个包含一堆可以多次出现的字符串的列表。我想使用这个列表并构建一个列表项的字典作为键，并将它们的出现次数作为值。

例子：

```
List<string> stuff = new List<string>();
stuff.Add( "Peanut Butter" );
stuff.Add( "Jam" );
stuff.Add( "Food" );
stuff.Add( "Snacks" );
stuff.Add( "Philosophy" );
stuff.Add( "Peanut Butter" );
stuff.Add( "Jam" );
stuff.Add( "Food" ); 
```

结果将是一个字典，其中包含：

```
"Peanut Butter", 2
"Jam", 2
"Food", 2
"Snacks", 1
"Philosophy", 1 
```

我有办法做到这一点，但似乎我没有利用 C# 3.0 中的好东西

```
public Dictionary<string, int> CountStuff( IList<string> stuffList )
{
    Dictionary<string, int> stuffCount = new Dictionary<string, int>();

    foreach (string stuff in stuffList) {
        //initialize or increment the count for this item
        if (stuffCount.ContainsKey( stuff )) {
            stuffCount[stuff]++;
        } else {
            stuffCount.Add( stuff, 1 );
        }
    }

    return stuffCount;
} 
```

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-03-26T19:59:53.540

您可以使用 C# 中的 group 子句来执行此操作。

```
List<string> stuff = new List<string>();
...

var groups = 
    from s in stuff
    group s by s into g
    select new { 
        Stuff = g.Key, 
        Count = g.Count() 
    }; 
```

如果需要，您也可以直接调用扩展方法：

```
var groups = stuff
    .GroupBy(s => s)
    .Select(s => new { 
        Stuff = s.Key, 
        Count = s.Count() 
    }); 
```

从这里可以将其放入一个短跳`Dictionary<string, int>`：

```
var dictionary = groups.ToDictionary(g => g.Stuff, g => g.Count); 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-26T20:06:00.920

我会制作一个专门的列表，由 Dictionary 支持，add 方法将测试成员资格并在找到时增加计数。

有点像：

```
public class CountingList
{
    Dictionary<string, int> countingList = new Dictionary<string, int>();

   void Add( string s )
   {
        if( countingList.ContainsKey( s ))
             countingList[ s ] ++;
        else
            countingList.Add( s, 1 );
   }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T19:58:20.190

一个想法是给字典一个[默认值](https://stackoverflow.com/questions/367378/returning-a-default-value-c)零，这样你就不必对第一次出现进行特殊处理。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T20:02:29.727

好吧，真的没有更好的方法来做到这一点。

也许您可以编写一个 LINQ 查询来对字符串进行分组，然后计算每个组中有多少个字符串，但这不会像您已经拥有的那样有效。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-09-01T10:15:48.223

```
Dictionary<string, int> a = stuff.GroupBy(p => p).OrderByDescending(r=>r.Count()).ToDictionary(q => q.Key, q => q.Count()); 
```

您可以 GroupBy 然后创建字典来计算每个组。正如[性能测试](http://www.schnieds.com/2009/03/linq-vs-foreach-vs-for-loop-performance.html)表明的那样，通常有比 Linq 更有效的方法。我认为您的代码更高效，而 Linq 解决方案更具可读性和美观性。

# objective-c - 上下文信息的快捷方式是什么？

> ID：687318
> 
> 赞同：2
> 
> 时间：2009-03-26T19:54:48.090
> 
> 标签：objective-c, xcode, keyboard-shortcuts

我不知道那个词。但是当您将光标放在方法或变量上时，会有一个键盘快捷键，它会显示一个信息框，其中包含该变量的所有可用变量/方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T19:58:08.597

按`ESC`。

顺便说一句，[这个问题](https://stackoverflow.com/questions/146297/what-are-those-little-xcode-tips-tricks-you-wish-you-knew-about-2-years-ago)还有很多其他的 Xcode 技巧，你可能会觉得有用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T05:21:41.863

我认为 OP 正在谈论研究助手，您可以从帮助菜单中选择它或使用 Control-Command-调用它？(Control-Command-Shift-/)

# php - 使用 PHP 访问 Sabre Web 服务

> ID：687322
> 
> 赞同：2
> 
> 时间：2009-03-26T19:55:28.527
> 
> 标签：php, web-services, sabre

有人联系我创建一个网站，使用 Sabre Web 服务为预订系统提供动力。我看到的所有文档都是指 .NET 或 Java 解决方案，我怀疑是否可以使用 PHP，因为访问是使用 SOAP 执行的。

我没有找到有关此的更多信息，我认为答案是肯定的，但我想知道为什么没有一个单一的参考来说明这是可能的。所有解决方案似乎都是.NET！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T20:04:23.653

SOAP 是独立于语言的，这意味着任何语言都可以与 Web 服务进行通信，只要它能够生成 SOAP 请求并处理响应。

PHP 的 SOAP 文档可以在[php 手册中找到](http://uk.php.net/soap)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T20:05:56.067

PHP 可以用来[非常有效地调用 SOAP](http://is2.php.net/manual/en/soapclient.soapclient.php)。

关于如何很好地使用 SOAP，有一个关于[devzone](http://devzone.zend.com/node/view/id/689)的非常好的教程。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-09-14T13:53:31.243

我刚刚进行了一些挖掘，看起来您可以使用 stream_context_create() 创建自定义 HTTP 流上下文。这将包括您需要的 HTTP 内容类型标头。然后可以将从此函数调用返回的资源传递给 SoapClient 构造函数以在 SOAP 调用中使用。查看[http://ca.php.net/stream_context_create](http://ca.php.net/stream_context_create)和 SoapClient 构造函数的 PHP 手册页（抱歉，我只能以新用户的身份发布一个链接）以获取更多信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T20:03:42.547

是的，PHP 可用于连接到 SOAP Web 服务——看看[NuSOAP](http://sourceforge.net/projects/nusoap/)。它允许以一种简单易用的面向对象的方式来使用 Web 服务。

# sql - SQL Compact 的“引擎默认值”是什么类型的加密？

> ID：687327
> 
> 赞同：1
> 
> 时间：2009-03-26T19:56:35.187
> 
> 标签：sql, sql-server-ce

如果在加密 SQL CE 数据库时指定“引擎默认值”，它使用什么特定类型的加密？（假设版本 3.5）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-14T12:49:40.060

引擎默认为 AES128（与 Windows Mobile 2003 或 Windows CE 4.2 不兼容）

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2009-03-26T20:01:02.180

如果它与 SQL Server 相同——我想它是——那么它将是 Triple DES

# c# - C# 速记属性问题

> ID：687340
> 
> 赞同：32
> 
> 时间：2009-03-26T19:58:28.287
> 
> 标签：c#, properties

所以这里有一些我以前从未见过的语法，有人能告诉我这是什么意思吗？不确定这是否应该是抽象属性声明或其他东西的简写。

```
public Class1 myVar { get; set; } 
```

就其价值而言，Class1 是一个抽象类。

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2009-03-26T20:00:25.037

在 C# 3.0 及更高版本中，当属性访问器中不需要额外的逻辑时，[自动实现的属性使属性声明更加简洁。](http://msdn.microsoft.com/en-us/library/bb384054.aspx)它们还使客户端代码能够创建对象 当您如下例所示声明属性时，编译器会创建一个私有的匿名支持字段，该字段只能通过属性的 get 和 set 访问器访问。

```
// Auto-Impl Properties for trivial get and set
    public double TotalPurchases { get; set; }
    public string Name { get; set; }
    public int CustomerID { get; set; } 
```

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-03-26T20:01:30.820

这是让编译器为您创建（隐藏）字段的语法。

同样非常有用的是：

```
public Class1 myVar{ get; private set; } 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-03-26T20:06:33.150

它可能看起来像一个抽象属性或来自接口的属性，但它远非如此。为了鼓励开发人员使用属性（由于许多原因，它们是最佳实践），Microsoft 决定在 C# 3 中包含此功能，以便您更轻松地声明属性。

以下是创建属性的标准方法：

```
String foo;

public String Foo
{
    get { return this.foo }
    set { this.foo = value; }
} 
```

现在这需要相当多的输入，并且由于开发人员对核心很懒惰，有时我们很想创建公共字段只是为了节省一些时间。

现在使用 C# 3 编译器，我们可以这样做：

```
public String Foo { get; set; } 
```

虽然这看起来有点奇怪，但请考虑一下编译器代表您所做的工作。之前的代码被编译成这样：

```
[CompilerGenerated]    
private string <Foo>k__BackingField;

public string Foo
{
    [CompilerGenerated]
    get
    {
        return this.<Foo>k__BackingField;
    }
    [CompilerGenerated]
    set
    {
        this.<Foo>k__BackingField = value;
    }
} 
```

因此，即使语法看起来有点奇怪，您仍然可以完全按照您习惯的方式创建属性。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-26T19:59:32.667

它被称为自动或[自动实现的](http://msdn.microsoft.com/en-us/library/bb384054.aspx)属性，它不是抽象的。您可以按原样使用该属性。编译器将在幕后为其创建一个后备存储。

这与使用字段而不是属性非常相似，但是您可以获得属性语义，并且可以将其用于需要属性的数据绑定之类的事情。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-03-26T20:04:17.337

它是一个只在字段中存储值的属性的简写。所以它相当于：

```
private Class1 _myVar;

public Class1 myVar
{
  get{ return _myVar; }
  set{ _myVar = value;}
} 
```

它只是一个简单的属性，以后可以在不更改界面的情况下用更复杂的 evantuation 替换。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-26T20:05:18.363

这些是自动实现的属性。它们使您可以使代码更简洁。你可以在这里阅读更多关于它们的信息：

[自动实施](http://msdn.microsoft.com/en-us/library/bb384054.aspx)

您还可以使访问器具有不同的访问级别：

公共 int MyVar { 获取；私人套装；}

这允许您将属性公开给类外部并仍然在内部设置它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-26T19:59:31.747

自动获取器和设置器。

# excel - 在 Excel 2007 中将多个图表复制为图片会导致应用程序定义错误

> ID：687353
> 
> 赞同：4
> 
> 时间：2009-03-26T20:01:33.597
> 
> 标签：excel, vba

**介绍**

我似乎无法让 ChartObjects.CopyPicture 方法在 Excel 2007 中工作。无论我尝试什么，都会出错。

使用此技术会在 CopyPicture 行上引发“应用程序定义或对象定义错误”。

```
ActiveSheet.ChartObjects.CopyPicture Appearance:=xlScreen, Format:=xlPicture
Sheets("Sheet2").Paste 
```

此方法在 PasteSpecial 行上抛出“Worksheet 类的PasteSpecial 方法失败”

```
ActiveSheet.ChartObjects.Copy    
Sheets("Sheet2").PasteSpecial Format:="Picture (Enhanced Metafile)", Link:=False, DisplayAsIcon:=False 
```

但是，如果我将图表用作 Shape 对象，它就可以工作。

```
ActiveSheet.Shapes("Chart 6").CopyPicture Appearance:=xlScreen, Format:=xlPicture
Sheets("Sheet2").Paste 
```

这也有效

```
ActiveSheet.Shapes("Chart 6").Copy
Sheets("Sheet2").PasteSpecial Format:="Picture (Enhanced Metafile)", Link:=False, DisplayAsIcon:=False 
```

**问题**

我的问题是，当我尝试将多个图表作为一个组复制时，这会失败。

我尝试使用 Shapes 对象的 Range 属性，但没有可用的 CopyPicture 方法。我想出了这个解决方法，但这也失败了，我在尝试 CopyPicture 时收到了相同的消息。

```
ActiveSheet.Shapes.Range(Array("Chart 5", "Chart 6")).Select
Selection.CopyPicture Appearance:=xlScreen, Format:=xlPicture
Sheets("Sheet2").Paste 
```

相反，这也不起作用

```
ActiveSheet.Shapes.Range(Array("Chart 5", "Chart 6")).Select
Selection.Copy
Sheets("Sheet2").PasteSpecial Format:="Picture (Enhanced Metafile)", Link:=False, DisplayAsIcon:=False 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T20:15:56.870

这个问题让我发疯了很长时间。我终于找到了一个可行的解决方案，希望这会在未来对其他人有所帮助。

基本上解决方案是将图表分组为单个形状对象，然后在该形状上复制图片，然后在完成后取消组合。

```
With ActiveSheet.ChartObjects.ShapeRange.Group
    .CopyPicture Appearance:=xlScreen, Format:=xlPicture
    .Ungroup
End With

Sheets("Sheet2").Paste 
```

# sharepoint - ItemAdding 从未被解雇

> ID：687357
> 
> 赞同：1
> 
> 时间：2009-03-26T20:03:21.253
> 
> 标签：sharepoint, sharepoint-2007

我有一个带有两个事件处理程序的自定义内容类型：ItemAdded 和 ItemAdding。第一个（ItemAdded）被触发没有问题。但第二个永远不会着火。我已经使用 API et 声明性方式附加了该事件。但什么都没有改变。

你已经遇到同样的问题了吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T22:41:36.317

也许您可以使用此工具检查您的事件接收器是否正确分配到使用您的内容类型的列表中：

[http://www.entwicklungsgedanken.de/2008/02/29/tool-eventreceiver-installer-for-sharepoint/](http://www.entwicklungsgedanken.de/2008/02/29/tool-eventreceiver-installer-for-sharepoint/)

也许您的功能定义中有配置错误。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T23:44:37.463

查看事件日志。我的，大多数时候，会在应用程序事件日志中放置一个错误条目。

# c# - 如何从 .NET 字符串中获取 Unicode 代码点数组？

> ID：687359
> 
> 赞同：21
> 
> 时间：2009-03-26T20:03:46.400
> 
> 标签：c#, string, unicode, char, astral-plane

我有一个字符范围限制列表，我需要检查一个字符串，但是`char`.NET 中的类型是 UTF-16，因此一些字符变成了古怪的（代理）对。因此，在枚举`char`a 中的所有 '时`string`，我没有得到 32 位 Unicode 代码点，并且一些与高值的比较失败。

我对 Unicode 有足够的了解，可以在必要时自己解析字节，但我正在寻找 C#/.NET Framework BCL 解决方案。所以 ...

如何将 a 转换为 32 位 Unicode 代码点`string`的数组 ( )？`int[]`

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2015-01-26T17:12:01.667

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-26T20:28:10.787

**这个答案是不正确的。请参阅@Virtlink 的正确答案。**

```
static int[] ExtractScalars(string s)
{
  if (!s.IsNormalized())
  {
    s = s.Normalize();
  }

  List<int> chars = new List<int>((s.Length * 3) / 2);

  var ee = StringInfo.GetTextElementEnumerator(s);

  while (ee.MoveNext())
  {
    string e = ee.GetTextElement();
    chars.Add(char.ConvertToUtf32(e, 0));
  }

  return chars.ToArray();
} 
```

**注意**：处理复合字符需要规范化。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2015-01-26T18:11:49.250

Doesn't seem like it should be much more complicated than this:

```
public static IEnumerable<int> Utf32CodePoints( this IEnumerable<char> s )
{
  bool      useBigEndian = !BitConverter.IsLittleEndian;
  Encoding  utf32        = new UTF32Encoding( useBigEndian , false , true ) ;
  byte[]    octets       = utf32.GetBytes( s ) ;

  for ( int i = 0 ; i < octets.Length ; i+=4 )
  {
    int codePoint = BitConverter.ToInt32(octets,i);
    yield return codePoint;
  }

} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-07-19T14:10:27.377

I came up with the [same approach](https://stackoverflow.com/a/28156104/357886) suggested by Nicholas (and Jeppe), just shorter:

```
 public static IEnumerable<int> GetCodePoints(this string s) {
        var utf32 = new UTF32Encoding(!BitConverter.IsLittleEndian, false, true);
        var bytes = utf32.GetBytes(s);
        return Enumerable.Range(0, bytes.Length / 4).Select(i => BitConverter.ToInt32(bytes, i * 4));
    } 
```

The enumeration was all I needed, but getting an array is trivial:

```
int[] codePoints = myString.GetCodePoints().ToArray(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-06-12T06:44:08.073

This solution produces the same results as [the solution by Daniel A.A. Pelsmaeker](https://stackoverflow.com/a/28155130/730757) but is a little bit shorter:

```
public static int[] ToCodePoints(string s)
{
    byte[] utf32bytes = Encoding.UTF32.GetBytes(s);
    int[] codepoints = new int[utf32bytes.Length / 4];
    Buffer.BlockCopy(utf32bytes, 0, codepoints, 0, utf32bytes.Length);
    return codepoints;
} 
```

# c# - 如何从 C# 中的字符串创建泛型类？

> ID：687363
> 
> 赞同：18
> 
> 时间：2009-03-26T20:04:31.313
> 
> 标签：c#, .net, reflection, generics

我有一个这样的通用类：

```
public class Repository<T> {...} 
```

我需要用一个字符串来举例说明......示例：

```
string _sample = "TypeRepository";
var _rep = new Repository<sample>(); 
```

我怎样才能做到这一点？这甚至可能吗？

谢谢！

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-03-26T20:19:02.277

这是我的 2 美分：

```
Type genericType = typeof(Repository<>);
Type[] typeArgs = { Type.GetType("TypeRepository") };
Type repositoryType = genericType.MakeGenericType(typeArgs);

object repository = Activator.CreateInstance(repositoryType); 
```

在评论中回答问题。

```
MethodInfo genericMethod = repositoryType.GetMethod("GetMeSomething");
MethidInfo closedMethod = genericMethod.MakeGenericMethod(typeof(Something));
closedMethod.Invoke(repository, new[] { "Query String" }); 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-03-26T20:09:04.797

首先使用获取 Type 对象`Type.GetType(stringContainingTheGenericTypeArgument)`

然后用于`typeof(Repository<>).MakeGenericType(theTypeObject)`获取泛型类型。

最后使用`Activator.CreateInstance`

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-26T20:32:46.767

这是`dynamic`C# 4.0 中关键字的工作。

这里有一些不错的技巧可以为您提供对象的实例，但是无论当前版本的 C# 是什么，它都只会知道它有一个`object`，并且它本身不能对对象做很多事情，因为当前的 C# 不支持后期绑定。您至少需要能够将其转换为已知类型才能对其进行任何操作。最终，您必须*在编译时*知道您需要的类型，否则您将不走运。

现在，如果您可以将存储库类限制为实现某些已知接口的类型，那么您的状态会好得多。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-26T20:10:14.373

如果我正确理解了您的问题...您要做的是采用您的类型 (Repository<T>) 并在运行时构造一个特定的通用实现？

如果是这样，请查看[MakeGenericType](http://msdn.microsoft.com/en-us/library/system.type.makegenerictype.aspx)。您可以使用 typeof(Repository) 和您想要的 T 对象的 System.Type 并以这种方式构造它。一旦你有了类型，Activator.CreateInstance 就会为你工作。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-26T20:23:45.730

假设您的字符串包含类型的名称，您可以编写

```
object _rep = Activator.CreateInstance(typeof(Repository<>).MakeGenericType(Type.GetType(_sample))); 
```

但是，_rep 将是一个无类型的对象，您将无法对它做任何事情。由于您在编译时不知道泛型类是什么类型，因此没有将其转换为的类型。（除非 Repository 继承了非泛型类或实现了非泛型接口）

您可以通过为 Repository 创建一个非泛型基类并将对象转换为它来解决这个问题。

但是，根据您的情况，您可能想要创建`Repository`一个非泛型类。

如果`Repository`是一个包含其他类的类，最好将其设为非泛型。你可以让它的构造函数接受一个`Type`对象，然后调用`Type.IsInstanceOfType`你添加的每个对象以确保它是正确的类型。

如果 Repository 是事物的分类集合，最好将其设为非泛型，并使其构造函数采用`string category`.

如果您需要更具体的建议，请发布有关您的情况的更多详细信息。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-26T20:19:05.473

```
Type repType = typeof(Repository <>).MakeGenericType(Type.GetType("System.String"));
object rep = Assembly.GetAssembly(repType).CreateInstance(repType.FullName); 
```

这将创建一个`Repository<string>`. 您可以用您喜欢的任何类型替换“System.String”。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-26T20:10:02.407

这是“有点”可能的。你可以做到这一点，但这有点像黑客。

您有 3 个选项：

如果您事先知道您的课程，请使用 switch 语句。基本上是这样的：

```
switch(str){
   case "TypeRepository": return new Repository<TypeRepository>;
} 
```

作为上述更高级的形式，您可以使用字典而不是哈希表

```
var factory = new Dictionary<string, Func<object>>();
factory.Add( "TypeRepository", () => new Repository<TypeRepository>() );

var theObject = factory["TypeRepository"]() as Repository<TypeRepository>; 
```

为了获得最大的灵活性，您可以在运行时使用反射将字符串与类匹配。请注意，反射是相当缓慢的，所以如果你有规律地这样做，你要避免它。例如，这是使用[Frans Bouma](https://stackoverflow.com/questions/687363/how-do-i-create-a-generic-class-from-a-string-in-c/687383#687383)方法的示例。只需在您的代码中更改`List<>`为：`Repository<>`

```
public static object MakeList( string typeStr )
{
    var nameSpace = "MyTestApplication" + ".";

    var objType = Type.GetType(nameSpace + typeStr); // NAMESPACE IS REQUIRED
    var listType = typeof(List<>).MakeGenericType(objType);
    return Activator.CreateInstance(listType);
}

var listOfThings = MakeList("MyCoolObject") as List<MyCoolObject>; 
```

注意：无法避免所有这些机制 return 的事实，`object`然后您必须将其转换为正确的类型，而不是仅返回强类型值。

这是不可避免的，因为您直到运行时才知道列表的类型，而 C# 是围绕在编译时了解事物而构建的（这就是人们所说的“静态类型编程语言”的意思）。在 C#4 中它会不那么痛苦，在那里你可以 return `dynamic`，这将节省你的演员表。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-26T20:10:10.300

泛型适用于类型，而不适用于实例。[你可以在这里](http://msdn.microsoft.com/en-us/library/ms379564(vs.80).aspx)阅读更多。

听起来您只需要向您的类添加一个构造函数，该构造函数接受所需的类型并初始化值：

```
public class Foo<T>
{
    private T = default(T);

    public Foo(T initValue)
    {
        _val = T;
    }
} 
```

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2009-03-26T20:07:59.620

Generic 类中的“T”代表类型，而不是类型的实例。因此，如果您希望存储库保存字符串对象，请使用

```
var _rep = new Repository<string>(); 
```

# asp.net - 面向 ASP.Net 开发人员的 JSP 教程

> ID：687365
> 
> 赞同：2
> 
> 时间：2009-03-26T20:05:17.473
> 
> 标签：asp.net, jsp

我是一名 ASP.Net 开发人员，希望将我的涂料技能扩展到美妙的 Java 世界。奇怪的是，似乎有大量“面向 JSP 开发人员的 ASP.Net”教程，但很少（不是？）“面向 ASP.Net 开发人员的 JSP”教程。只是简单的事情，比如文件结构和布局之间的差异，使用什么网络服务器以及如何配置它等等......一千个微小的差异加起来令人沮丧，毫无疑问，一个好的教程可以很容易地回答。

所以...有人知道一个好的教程吗？或者，除此之外，JSP 教程的最佳“入门”是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T02:53:20.380

我也不知道任何教程，但我对两个世界（jsp和asp.net）都有一点了解，我向你推荐两种方法：

第一个。如果您只是想知道语法差异，不妨先看看 Sun 的这个[JSP 概述](http://java.sun.com/developer/technicalArticles/Programming/jsp/)，您会自动映射主要差异（我不建议您这样做，因为两个平台没有区别关于它的语法）

第二。如果您要开发 Java Web 应用程序，您应该先看看[J2EE 教程](http://java.sun.com/javaee/5/docs/tutorial/doc/)（特别是在第二部分）以及一些 MVC 框架（[Struts](http://struts.apache.org/)、[Spring Web MVC](http://static.springframework.org/spring/docs/2.0.x/reference/mvc.html)）和一些“不同的 MVC 方法” [JSF](http://wiki.apache.org/myfaces/JSF_and_MVC)。

JSP 是一种前端技术，将业务逻辑和/或复杂代码放在上面并不是一个好习惯。

希望能帮助到你。

# unix - Unix 管理员应该具备哪些编程能力？

> ID：687375
> 
> 赞同：4
> 
> 时间：2009-03-26T20:07:15.893
> 
> 标签：unix, sysadmin

您如何评估 Unix 系统管理员。

Unix 管理员应该具备哪些编程能力？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-26T20:11:48.237

我使用一些快速过滤器：

*   什么是叉形炸弹，它是好是坏？
*   给我一个单行命令，计算日志文件中有多少行从昨天的日期开始。
*   现在换一种方式
*   如果你愿意的话，还有三分之一。
*   应该是什么`chmod 777`，为什么。
*   您希望用户主目录中有哪些 .* 文件，其中有什么？

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-26T20:13:53.677

评估他们的唯一可靠方法是让他们与您认识并信任成为优秀 Unix 系统管理员的其他人聊天。我不同意问你自己并不真正理解的面试问题的做法，因为你将无法判断候选人是否对该主题有深入的了解，或者仅仅能够背诵一些琐事。

至于你可能想问他们什么，这取决于他们将承担什么责任。例如，你可能会问他们一些关于如何维护 Apache 的问题，但这只有在他们负责运行 Apache 的服务器（同上 MySQL、Samba 等）的情况下才有意义。

一般来说，您可能想尝试询问有关 shell 脚本、用户管理、如何衡量服务器健康和性能以及如何管理服务器安全性的问题。

然而，知识和经验并不是一切。确保你首先雇佣一个聪明和负责任的人。:) 没有什么比一个不稳定的系统管理员更糟糕的了，或者是一个对跟上当前技术毫无兴趣的呆板人。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-27T10:23:18.487

Parappas 最后一点非常重要，让某人有动力和负责任是任何招聘过程中最重要的事情之一。也有许多人声称，甚至可能已经在家里运行“多年的服务器”。安装 Ubuntu 并或多或少地运行 Apache 与成为一名优秀的系统管理员有很大不同。该人还应该习惯在桌面上使用 Linux 或 *BSD，因为这意味着他们必须在服务器端和桌面端两个不同级别上与 Unix 系统进行交互。

永远不要低估快速且乐于学习的人的价值。这又回到了动机的问题上。在我看来，一个年轻的、没有经验的人有时比一个 25 岁的兽医更好的选择。如果要聘用的人是自己作为唯一的系统管理员工作，当然您不希望没有经验的人，但是如果职位比那个职位更初级，那么“新人”可能是更好的选择.

至于编程，了解 shell 脚本和正则表达式是您可以要求的最低要求。如果他们根本不懂任何编程，他们可能很快就会迷失在配置文件中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T10:46:51.100

良好的 shell 脚本编程。理想情况下是 perl/python/awk 中的一种或多种 理想情况下，熟悉 C、Makefile 语法以及至少一种（理想情况下两者兼有）emacs 和/或 vi。

Shell 脚本应该是显而易见的。Perl/Python 不应该太难理解。提到 AWK 是因为它经常接近正确的工具，但有时需要更多。

过去，我需要编写各种 C 代码以使系统管理员的生活更轻松，但在这些工作场所，系统管理员还充当开发部门的工具匠。

# database - 只选择索引属性会导致更快的查询吗？

> ID：687376
> 
> 赞同：1
> 
> 时间：2009-03-26T20:07:32.460
> 
> 标签：database, database-design

在执行查询时，选择的属性构成索引的组件，这会导致更快的查询吗？我想查询计划器/优化器可以看到索引扫描可以完全满足请求的列。

### 简单的例子

```
CREATE TABLE "liked" (
  "id" BIGINT NOT NULL DEFAULT nextval('liked_id_seq'),
  "userid" BIGINT NOT NULL,
  "storyid" BIGINT NOT NULL,
  "notes" TEXT,
  PRIMARY KEY ("id")
);
CREATE INDEX "liked_user" ON "liked" (
  "userid",
  "storyid"
);
ALTER TABLE "liked" ADD FOREIGN KEY ("userid") REFERENCES "users" ("id") ON DELETE CASCADE;
ALTER TABLE "liked" ADD FOREIGN KEY ("storyid") REFERENCES "story" ("id") ON DELETE CASCADE;

SELECT storyid from liked where userid = 1; 
```

对于上面的查询，在索引中已经包含的内容之外没有任何数据，`liked_user`所以我想如果查询优化器可以推断出结果元组可以由索引单独满足，那么操作会更少。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T20:19:48.717

它被称为“覆盖索引”，它通过改变数量来提高效率，具体取决于您使用的 DBMS（以及如果您使用的是 MySQL，哪种存储方式）。

试着举一个具体情况的例子，如果你有的话。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T20:14:05.953

一般来说，是的，但这取决于您如何访问它们。使用 LIKE 键在字符串字段的中间进行匹配不会使用索引更快。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T20:15:04.500

没有那么多，以我的经验。您可以通过优化查询条件并尝试在这些条件下使用最佳索引来加快查询速度。根据您的选择，有很多方法可以减慢查询速度，例如使用子查询，也许是一些 UDF——当然，您可以使用一些不太理想的连接来减慢查询速度。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T20:33:33.757

它可以做到，但有一些警告。这些评论基于 Oracle，顺便说一句。

例如，SELECT COL1 FROM MY_TABLE 可能能够使用索引，但如果索引的所有列都可以为空，那么可能存在不包含在常规 btree 索引中的行，因此可能不使用索引。

索引也有可能比基础表（例如表只有一个列）更大（因此完整扫描的成本更高），因为索引必须包含每个条目以及列的 rowid价值观。在这种情况下，除非查询可以以某种特殊方式利用索引信息（例如，您包含索引可以提供而不需要排序的 ORDER BY 子句），否则可能不会使用索引。

You ought to also look into the various index access methods that the RDBMS can use in order to understand their strengths and weaknesses. In Oracle these would generally be INDEX RANGE SCAN, FULL INDEX SCAN, FAST FULL INDEX SCAN, and INDEX SKIP SCAN. This knowledge will help you understand whether an index could be used and in what way.

# asp.net - 你如何将数据从一个 HTTP 模块持久化到另一个模块以及最终的处理程序？

> ID：687377
> 
> 赞同：0
> 
> 时间：2009-03-26T20:07:38.763
> 
> 标签：asp.net, httpmodule, pipeline

从 HTTP 模块，有没有办法在请求中保留一些东西，以供主模块或最终处理程序访问？您能否在请求通过时将某些内容“粘贴”在该请求上，该内容稍后仍将存在于管道中？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T20:17:36.460

您可以使用 HttpContext（由静态 Current 属性公开的）。它有一个 Items 属性，专门用于在模块和处理程序之间传输数据，如文档所示：

> 获取可用于在 HTTP 请求期间在 IHttpModule 接口和 IHttpHandler 接口之间组织和共享数据的键/值集合。

可以位于此处：

[http://msdn.microsoft.com/en-us/library/system.web.httpcontext.items.aspx](http://msdn.microsoft.com/en-us/library/system.web.httpcontext.items.aspx)

# asp.net - Visual Studio Play 或 Build 进行编译

> ID：687381
> 
> 赞同：0
> 
> 时间：2009-03-26T20:08:20.150
> 
> 标签：asp.net, visual-studio, compiler-construction

我最近遇到了问题跟踪器入门工具包的问题，​​似乎可以通过使用“构建”选项解决。以前，我通常会使用“播放”按钮来调试我的应用程序，然后在一切正常时暂存文件，假设我上次点击“播放”按钮时，它已经完全编译了应用程序。

无论如何，我想知道“播放”按钮和“构建”菜单选项之间是否有区别？如果是这样，有什么区别？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T20:11:21.187

“构建”按钮编译您的网站，而“播放”按钮构建并使用默认页面作为参数启动浏览器。

“播放”按钮旨在执行在您的解决方案中指定为起点的程序集。由于 ASP.NET 网站没有真正的“入口点”（如`static void Main()`在控制台应用程序中），“播放”按钮通过将浏览器打开到项目“起始页”来模拟类似的操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T20:15:02.067

播放按钮 (F5) 在调试模式下执行您的应用程序。

构建菜单仅编译和生成您的程序集。

还有一个选项，CTRL + F5，它运行您的应用程序，但不在调试模式下。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T21:19:43.893

“玩”网站项目的缺点是，如果违规代码位于 App_Code 目录之外，并且您永远不会加载包含错误的代码，您可能会错过编译器错误。我认为进行“构建”确实会捕获这些错误。

另一个需要注意的问题 - 如果解决方案中有其他项目（例如类库），请确保在配置管理器中正确设置依赖项，以便在“播放”站点之前构建这些项目。否则，您可以在类库中进行更改，然后“播放”该站点但看不到更改。

# .net - 诊断 SqlConnection 泄漏？

> ID：687391
> 
> 赞同：3
> 
> 时间：2009-03-26T20:10:58.020
> 
> 标签：.net, sqlconnection

我遇到了一个 Web 应用程序的问题，该应用程序耗尽了连接池中的所有可用连接。我似乎记得一些用于诊断所有活动连接的好工具，但我画的是空白。诊断此问题有哪些好的选择？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T20:32:03.167

您是否在应用程序中使用 SqlDataReader 对象？SqlDataReader 对象将保持其连接打开，直到它关闭。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T20:36:27.320

我投票支持代码审查。我曾经在第三方构建的应用程序中遇到过类似的情况，并且搜索连接很快就会暴露它并没有使用/最终确保在发生异常时关闭连接。

同样正如 Michael 所指出的，您必须确保数据读取器使用的连接已关闭。您可以指定在阅读器关闭时关闭连接，然后对于这些情况，只需确保数据阅读器已被处置（使用 using(){} ）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T20:50:14.057

您可以运行 sp_who 查看来自 SQL 服务器的活动连接，但是，您可能没有像其他人建议的那样关闭您的连接。但是，如果您正在关闭连接，但立即重新打开它们（例如在循环中读取文本文件或其他内容），即使您认为正在关闭它们，您也可以使用它们（查看[Connection Pooling](http://www.ondotnet.com/pub/a/dotnet/2004/02/09/connpool.html)）。如果您发布代码示例，我认为您会得到更好的答案。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T21:28:20.177

[带有 SOS](http://msdn.microsoft.com/en-us/library/bb190764.aspx)的WinDbg 的[.Net 内存分析器](http://memprofiler.com/)将允许您追踪谁持有对您的连接对象的引用，使用该信息您应该能够追踪有问题的方法。

# java - 在 Eclipse 中获取所有捆绑包的捆绑包 []

> ID：687405
> 
> 赞同：0
> 
> 时间：2009-03-26T20:13:36.347
> 
> 标签：java, plugins, eclipse-plugin, osgi

我正在编写一个使用 Equinox 作为我的 OSGi 框架的应用程序。我正在尝试发现在我的捆绑包注册时已知的所有捆绑包。我尝试使用以下行来检索所有可用的捆绑包。然而，

EclipseStarter.getSystemBundleContext().getBundles();

给我一个警告...

不鼓励访问：由于对所需库 D:\java\eclipse\plugins\org.eclipse.osgi_3.4.0.v20080605-1900.jar 的限制，无法访问 EclipseStarter 类型的方法 getSystemBundleContext()

获取框架内所有可用捆绑包的列表的正确用法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T20:29:52.000

您可以使用自己的包上下文作为入口点，而不是 EclipseStarter - 在您的插件激活器中：

```
start(BundleContext context)
{
  context.getBundles();  // what you want
} 
```

如果您不了解`Plugin`罐头类，请查看它们。`AbstractUIPlugin`如果你真的需要单例访问，你的插件可能是一个 - 随意公开`YourPlugin.getInstance().getBundleContext()`.

（免责声明：我没有尝试过 - 但它与 OSGi/Eclipse 一致）

# c# - 什么控制 C# 部分类的 XML 序列化顺序？

> ID：687413
> 
> 赞同：4
> 
> 时间：2009-03-26T20:15:29.367
> 
> 标签：c#, sorting, xsd, xml-serialization, partial-classes

正如[C# 中的字段顺序是否重要？](https://stackoverflow.com/questions/431203/does-the-order-of-fields-in-c-matter)，可序列化属性的顺序会影响 XmlSerializer 输出等。

但是如果字段在 2 个文件中（使用部分类），有谁知道实际上是什么控制了结果顺序？也就是说，哪个文件的属性先出现？

（背景：我问这个是因为我遇到了一个场景，其中两个文件中的一个是从 xsd 自动生成的，另一个是手动编辑的。开发人员框与我们的脚本构建框的测试输出不同。大概这是两个环境中 xsd->C# 步骤的时间和历史的几个差异的副作用。各种修复方法，但如果可能的话，我想更好地理解编译过程。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T20:24:30.953

C# 规范没有任何保证。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-21T19:39:55.880

我发现使用“简单”的方法通过标记对象 [Serializable] 来制作对象通常只适用于非常简单的实现。

我建议您实现 IXmlSerializable 接口，该接口非常容易实现，并为您提供所需的所有控制。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-02-08T21:30:37.243

这是我们通过修复一个讨厌的错误发现的：

我们遇到了完全相同的问题，我们的序列化顺序在发布后发生了变化，而没有修改任何与序列化相关的类。

我们有一半是从 xsd-s 生成的，另一半是手工制作的。订单属性没有影响。我们看到的是，在发布之前，手工制作的部分零件首先是序列化的，然后是顺序发生变化的。

解决方案**按项目文件中的文件顺序排列**，其中包含两个类。事实证明，在 MSBuild（在我们的构建服务器上）构建之后，序列化程序会将早期（在 csproj 中）“.cs”文件的元素首先放入序列化的 XML 中。更改 csproj 中“.cs”文件的顺序交换了顺序，并且生成的部分在 XML 中根据需要放在前面。

这与上面 Eric Hirst 的回答和观察一致，因为重命名文件会重新排序 csproj 的项目（它们通常按字母顺序排列）。出于这个原因，也要注意手动编辑 csproj。

# tabs - 在 Textmate 中编程时如何默认使用 Soft Tabs？

> ID：687430
> 
> 赞同：25
> 
> 时间：2009-03-26T20:21:43.503
> 
> 标签：tabs, textmate

我在 TextMate 中的“软标签”设置不粘。重新启动 TextMate 后，我经常需要为同一个文件再次设置选项。如何将此设置设置为所有文件的粘性默认设置？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-10-09T08:15:26.980

## 对于文本伴侣 1

经过一番研究，我发现您可以将 TextMate 1 设置为默认使用软标签。

在“高级”首选项窗格的“Shell 变量”区域中，添加一个新条目，其名称`TM_SOFT_TABS`和值为`YES`.

从那时起，TextMate 应该默认为软标签，尽管对于至少一种或两种语言，我必须指定标签的数量。在我这样做之后，它似乎坚持我所做的一切。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2012-03-14T08:19:39.340

## 对于文本伴侣 2

要在 TextMate 2 中设置选项，请将以下设置添加到您的 ~/.tm_properties 文件中：

```
softWrap = true  
tabSize = 4  
softTabs = true 
```

检查这些链接以获取更多信息：

常见问题解答：[https](https://github.com/textmate/textmate/wiki/FAQ)
://github.com/textmate/textmate/wiki/FAQ 设置：[http ://wiki.macromates.com/Reference/Settings](http://wiki.macromates.com/Reference/Settings)

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-03-26T20:33:41.307

[从文档中](http://manual.macromates.com/en/working_with_text)：

> # 4.11 使用空格代替制表符
> 
> TextMate 可以使用空格而不是制表符。这是通过单击状态栏中的“选项卡大小”弹出窗口并启用软选项卡来完成的。
> 
> 此设置只会影响当前语言和所有具有公共根但尚未设置选项的语言。这同样适用于拼写检查、软换行和实际标签大小的状态。
> 
> ![](https://manual.macromates.com/images/tab_size_settings.png)
> 
> 当启用软标签时，TextMate 将在很大程度上与您使用硬标签完全一样，但文档确实包含空格。

看起来 Textmate 将其设置为当前语言，但我认为 Textmate 会分析您打开的文件并调整其设置以匹配文件。您可以在“文本”菜单中将文件中的选项卡转换为空格，反之亦然。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-04-15T00:54:23.097

你不需要任何特别的东西。你只需要调整你的 Python 包。

进入“捆绑编辑器”并找到 Python。打开它的插入符号，向下滚动并找到“杂项”首选项。它应该是这样的：

```
{   decreaseIndentPattern = '^\s*(elif|else|except|finally)\b.*:';
increaseIndentPattern = '^\s*(class|def|elif|else|except|finally|for|if|try|with|while)\b.*:\s*$';
shellVariables = (
    {   name = 'TM_COMMENT_START';
        value = '# ';
    },
    {   name = 'TM_LINE_TERMINATOR';
        value = ':';
    },
);
} 
```

这些是环境变量。您想要的是将环境变量`TM_SOFT_TABS`设置为“是”。很简单，只需像这样插入一个新任务：

```
 {   name = 'TM_SOFT_TABS';
        value = 'YES';
    }, 
```

……瞧！每次在 Python 模式下使用 Textmate 时，您的选项卡都会变软。

对于您可以设置的所有不同环境变量，请在此处查看手册：http: [//manual.macromates.com/en/environment_variables.html](http://manual.macromates.com/en/environment_variables.html)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-09-11T03:23:32.477

...除了@Ivan Sviatenko 的回答

# 对于 Textmate 2，语言特定的 softTabs 默认

编辑`~/.tm_properties`，例如：

```
# Default editing configuration
#
tabSize = 2
softTabs = true
softWrap = true  

# Defaults for c
#
[ source.c ]
softTabs = true
tabSize = 8

# Defaults for python
#
[ source.python ]
softTabs = true
tabSize = 4 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-08-31T13:03:13.520

TextMate底部还有一个下拉菜单，可以设置你的Tab Size值以及是否使用Soft Tabs，而且是粘性的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-09-20T07:48:28.287

1.  在桌面上为 TextMate 创建一个别名图标。
2.  将要打开的文件拖到图标上。
3.  该文件现在应该在 TextMate 中打开。
4.  使用状态栏选项设置软选项卡。
5.  关闭 TextMate。
6.  对您希望记住软标签设置的每种文件类型重复步骤 2 - 5。
7.  每次您想使用 TextMate 打开文件类型时，将该文件拖到该桌面图标上。
8.  不要同时打开一种以上的文件类型，打开的第二种文件类型将删除其软标签设置。

这是我能够在软标签设置上获得一致行为的唯一方法。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-30T22:38:02.160

我找到了一个名为“TabMate”的流行 TextMate 插件，它为我解决了这个问题。虽然它需要我为每个文件添加一个表格，但 TextMate 将我的选项卡设置调整为表格中描述的任何内容。

此外，从技术上讲，gs 上面的答案应该可以工作，但由于某种原因，它对我不起作用，我发现没有其他方法可以设置 SoftTabs 永远是所有语言的默认设置。

TabMate：[http ://konstochvanligasaker.se/tabmate/](http://konstochvanligasaker.se/tabmate/)

# c# - 以编程方式将文件检入 TFS 超出预期

> ID：687434
> 
> 赞同：4
> 
> 时间：2009-03-26T20:23:47.147
> 
> 标签：c#, api, tfs, checkin, working-directory

所以我有一个 .NET 应用程序，它通过并生成一系列文件，将它们输出到本地目录，然后确定是否需要更新现有文件或将新文件添加到 TFS（Team Foundation Server）项目中。
我的本地机器上有一个工作区，并且有 10 个不同的工作文件夹，这些文件夹是我在这台特定机器上从事的其他编码项目。当我去检查文件是否已经存在于 TFS 项目中并且需要更新或者是否需要作为新文件添加到项目中时，就会出现我的问题。
片段：

```
静态字符串 TFSProject = @"$/SQLScripts/";
静态 WorkspaceInfo wsInfo;
静态版本控制服务器版本控制；
静态字符串 argPath = "E:\\SQLScripts\\";

wsInfo = Workstation.Current.GetLocalWorkspaceInfo(argPath);
TeamFoundationServer tfs = new TeamFoundationServer(wsInfo.ServerUri.AbsoluteUri);
versionControl = (VersionControlServer)tfs.GetService(typeof(VersionControlServer));

工作区工作区 = versionControl.GetWorkspace(wsInfo);
workspace.GetLocalItemForServerItem(TFSProject);

```

此时，我检查文件是否存在，然后做两件事之一。如果文件存在，那么我将文件标记为 EDIT，然后将文件写出到本地目录，否则我将先编写文件脚本，然后将文件添加到工作区。我不在乎物理文件是否与我正在生成的文件相同，因为我这样做是作为“跟踪更改”的 SAS70 要求

如果它存在，我会这样做：
workspace.PendEdit(filename,RecurisionType.Full);
脚本输出文件（文件名）；

或者如果它不存在
scriptoutthefilename(filename);
workspace.PendAdd(filename,true);

好的，所有这些都是为了解决问题。当我去检查针对 PROJECT 的未决更改时，我会获得工作区中本地计算机上所有项目的所有未决更改。

```
// 显示我们挂起的更改。
PendingChange[] pendingChanges = workspace.GetPendingChanges();
foreach (PendingChanges 中的pendingChanges)
{
    做点什么...
}

```

我认为通过将工作区设置为 workspace.GetLocalItemForServerItem(TFSProject) 它只会为我提供该特定工作文件夹的对象。

如果有什么方法可以强制工作区对象只处理特定的工作文件夹？

这有什么意义吗？提前致谢...

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-08-10T13:17:15.037

使用 LINQ，您可以获得特定文件夹的待处理更改

```
PendingChange[] pendingChanges = workspace
    .GetPendingChanges()
    .Where(x => x.LocalOrServerFolder.Contains(argPath))
    .ToArray(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-27T18:14:33.183

这是刷新工作区缓存的另一种方法：

tf 工作区/s：[http://SomeTFSServer:8080/](http://SomeTFSServer:8080/)

此外，Workspace 有一个名为 UpdateWorkspaceInfoCache(..) 的方法，它似乎做同样的事情。不过，我还没有测试过。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-31T20:31:19.273

好的，事实证明我的机器上有一个损坏的 TFS 工作区缓存。这是解决方案（来自命令提示符）：

```
SET AppDataTF=%USERPROFILE%\Local Settings\Application Data\Microsoft\Team Foundation
SET AppDataVS=%APPDATA%\Microsoft\VisualStudio
如果存在 "%AppDataTF%\1.0\Cache" rd /s /q "%AppDataTF%\1.0\Cache" > NUL
如果存在 "%AppDataTF%\2.0\Cache" rd /s /q "%AppDataTF%\2.0\Cache" > NUL
IF EXIST "%AppDataVS%\8.0\Team Explorer" rd /s /q "%AppDataVS%\8.0\Team Explorer" > NUL
IF EXIST "%AppDataVS%\9.0\Team Explorer" rd /s /q "%AppDataVS%\9.0\Team Explorer" > NUL

```

问题的另一部分是，通过将项目文件夹放在同一个工作区中，它将从其他项目中提取所有待处理的更改。我创建了一个只有 SQLScripts 项目和本地文件夹的辅助工作区，一切都像一个魅力。

也许其他人会发现这很有用...

# javascript - 如何使用 Dojo 动态添加 div？

> ID：687436
> 
> 赞同：5
> 
> 时间：2009-03-26T20:24:28.193
> 
> 标签：javascript, dojo

我有以下静态 div：

```
<body>
  <div id="div1"></div>
.... 
```

我想通过使用dojo在div1中动态添加一个id为“div1_1”的div。我该怎么做？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-27T05:49:47.663

你可以只使用 Dojo Base 来完成——不需要包含任何东西，如果你使用的是 trunk 或 Dojo 1.3：

```
dojo.create("div", {id: "div1_1"}, "div1"); 
```

此行创建一个 id 为“div1_1”的 div，并将其附加到 id 为“div1”的元素。显然，您可以一次性添加更多属性和样式 — 阅读[dojo.create() 文档中的](http://docs.dojocampus.org/dojo/create)所有内容。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-03-20T14:00:40.533

使用灵活[dojo.place 的](http://dojotoolkit.org/reference-guide/1.7/dojo/place.html)另一个选项：

```
dojo.place("<div id='div1_1'></div>", "div1", /*optional*/ "only"); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-04-07T08:55:43.283

```
// dojo 1.7+ (AMD)
var n = domConstruct.create("div"); 
```

```
// dojo < 1.7
var n = dojo.create("div"); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-05-23T14:53:38.863

[dojo/dom-construct](http://dojotoolkit.org/reference-guide/1.9/dojo/dom-construct.html#create)也可用于创建新节点。

示例用法如下；

```
require([ "dojo/dom-construct", "dojo/_base/window" ], function(
        domConstruct, win) {
    // creates a new div and append it as the last child of the body
    domConstruct.create("div", null, win.body()));
}); 
```

dojo/dom-construct 参数是

1.  标签（div、h、img、li 等）
2.  属性（新节点属性）
3.  参考节点（放置新节点的位置）
4.  位置（默认最后）

您可以查看文档以获取更多信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T20:37:44.150

```
dojo.html.set(dojo.byId("div1"), "<div id='div1_1'></div>"); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-31T18:03:38.177

```
var divNode = document.createElement("div");
divNode.id = "div1_1";
document.body.appendChild( divNode ); 
```

这是一个好方法，它有助于解决 IE7 中的一些节点引用问题，您可以稍后继续使用对 divNode 的引用。

# multithreading - 使用 TVirtualTreeView 在 Delphi 中释放 DLL 时出现 NTWaitforMultipleObjects 错误

> ID：687438
> 
> 赞同：0
> 
> 时间：2009-03-26T20:24:34.307
> 
> 标签：multithreading, delphi, virtualtreeview

TVirtualTreeview 非常棒，但是很多时候当我关闭项目中包含 TVirtualTreeview 的 DLL 引用的窗口时，我会收到 NTWaitForMultipleObjects 错误。

问题出在 TVirtualTreeview 的某个深处，办公室里的其他人已经尝试了很多方法来解决它，我只是想知道是否有人在 Delphi 7 中遇到过类似的问题。

* * *

或者如果它在 2009 年得到修复，因为我们已经解决了这个问题，并且计划很快升级我们的代码（错误.. 把我们的脑袋撞到地上）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-12-28T21:50:05.803

Ulrich 指出的线程应该足以解决这个问题，但我并不认为这是一个错误，因为据我了解，你做错了：http:
[//blogs.msdn.com/oldnewthing/archive/2009/ 06/26/9804500.aspx](http://blogs.msdn.com/oldnewthing/archive/2009/06/26/9804500.aspx)

解决方案是在使用 DLL_PROCESS_DETACH 调用 DllMain 之前清理您的表单/树视图。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T09:30:17.070

也许[这](http://support.soft-gems.net/forums/viewtopic.php?t=583&sid=9d996041a7aeb6af36e7f5c4c5553c2f)有帮助。

# artificial-intelligence - 您使用什么人工神经网络或“生物”神经网络库/软件？

> ID：687439
> 
> 赞同：3
> 
> 时间：2009-03-26T20:24:41.483
> 
> 标签：artificial-intelligence, neural-network, biological-neural-network

你用什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-01-04T13:41:14.140

[快速人工神经网络库 (FANN)](http://leenissen.dk/fann/) 是一个免费的开源神经网络库，它用 C 语言实现多层人工神经网络，同时支持全连接和稀疏连接网络。支持定点和浮点的跨平台执行。它包括一个易于处理训练数据集的框架。它易于使用、用途广泛、有据可查且速度快。PHP、C++、.NET、Ada、Python、Delphi、Octave、Ruby、Prolog Pure Data 和 Mathematica 绑定可用。

[FannTool](http://code.google.com/p/fanntool/)图形用户界面也可用于库。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T20:28:11.397

每当我想快速使用任何数据挖掘算法时，我都会加载[Weka](http://www.cs.waikato.ac.nz/ml/weka/)。它非常复杂，但它实现了很多具有很多可定制性的算法（包括神经网络）。此外，它还有一些 NN 的可视化。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-26T20:33:02.837

它很旧，但我在不使用自己的代码时一直使用[NeuroShell 2 。](http://www.wardsystems.com/neuroshell2.asp)不幸的是，它不是免费的。我认为较新的 NeuroShell 仅用于预测股票。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-07T16:33:06.240

有很多不同的网络模拟器取决于您想要模拟的详细程度以及您想要模拟的网络类型。

如果你想模拟完整的生物网络（我猜你可能不会），甚至到树突的行为等，NEURON 和 GENESIS 都很好。

NEST 和 SPLIT 以及其他一些非常适合进行人口模拟，您可以在逐个节点的基础上创建人口并查看整个人口的行为。这几乎是“行业”标准方法，在研究和商业应用中被大量使用，因此值得研究。我知道 IBM 使用 SPLIT 进行一些研究。

如果您想使用微分方程来模拟人口的行为，那么 MIIND 很好，但这种方法相对较新且计算成本高（如果很酷的话）。

不确定这是否正是您想要的！

（注意，如果您在谷歌上搜索任何大写名称以及“模拟器”一词，您将最终进入相关网页 =）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-04-03T16:31:04.033

如果您想尝试深度学习，您应该研究 Theano Pylearn2（基于 Theano）

# java - 使用Java计算目录中的文件数

> ID：687444
> 
> 赞同：72
> 
> 时间：2009-03-26T20:25:56.643
> 
> 标签：java, performance, file, directory

如何使用 Java 计算目录中的文件数？为简单起见，我们假设该目录没有任何子目录。

我知道标准方法：

```
new File(<directory path>).listFiles().length 
```

但这将有效地遍历目录中的所有文件，如果文件数量很大，这可能需要很长时间。另外，我不关心目录中的实际文件，除非它们的数量大于某个固定的大数字（比如 5000）。

我在猜，但是目录（或者在 Unix 的情况下是它的 i-node）不存储其中包含的文件数吗？如果我可以直接从文件系统中获取该数字，它会快得多。在后端开始进行实际处理之前，我需要对 Tomcat 服务器上的每个 HTTP 请求进行此检查。因此，速度至关重要。

我可以每隔一段时间运行一个守护进程来清除目录。我知道，所以请不要给我那个解决方案。

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2009-03-26T20:39:06.503

啊......在Java中没有一个简单的方法来做到这一点的理由是文件存储抽象：一些文件系统可能没有目录中现成的文件数量......这个数量甚至可能根本没有任何意义（参见例如分布式、P2P 文件系统、将文件列表存储为链表的 fs 或数据库支持的文件系统......）。所以是的，

```
new File(<directory path>).list().length 
```

可能是你最好的选择。

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2016-01-12T15:33:32.783

从 Java 8 开始，您可以通过三行来完成：

```
try (Stream<Path> files = Files.list(Paths.get("your/path/here"))) {
    long count = files.count();
} 
```

关于 5000 个子节点和 inode 方面：

此方法将遍历条目，但正如 Varkhan 建议的那样，除了使用 JNI 或直接调用系统命令之外，您可能无法做得更好，但即便如此，您也永远无法确定这些方法不会做同样的事情！

但是，让我们深入研究一下：

查看 JDK8 源代码，*公开*`Files.list`了一个使用from委托给.*`Iterable``Files.newDirectoryStream``FileSystemProvider.newDirectoryStream`*

 *在 UNIX 系统（反编译`sun.nio.fs.UnixFileSystemProvider.class`）上，它加载一个迭代器：`sun.nio.fs.UnixSecureDirectoryStream`使用 A（在遍历目录时使用文件锁）。

因此，有一个迭代器将遍历此处的条目。

现在，让我们看看计数机制。

实际计数由[Java 8 流](https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html)公开的计数/总和减少 API 执行。理论上，这个 API 可以毫不费力地执行并行操作（使用多线程）。然而，流是在禁用并行性的情况下创建的，所以它是不行的......

这种方法的**好处**是**它不会将数组加载到内存**中，因为条目将由迭代器计数，因为它们是由底层（文件系统）API读取的。

最后，对于信息，从概念上讲，在文件系统中，目录节点不需要保存它包含的文件的*数量*，它可以*只*包含它的子节点列表（inode 列表）。我不是文件系统方面的专家，但我相信 UNIX 文件系统就是这样工作的。所以你不能假设有一种方法可以直接获得这些信息（即：总是可以在某处隐藏一些子节点列表）。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-03-26T20:34:49.570

不幸的是，我相信这已经是最好的方法了（虽然[`list()`](http://java.sun.com/javase/6/docs/api/java/io/File.html#list())比 略好`listFiles()`，因为它不构造`File`对象）。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-03-27T12:57:38.367

这可能不适合您的应用程序，但您始终可以尝试本地调用（使用 jni 或[jna](http://jna.dev.java.net)），或执行特定于平台的命令并在返回到 list().length 之前读取输出。在 *nix 上，您可以执行`ls -1a | wc -l`（注意 - 第一个命令是 dash-one-a，第二个命令是 dash-lowercase-L）。不确定在 Windows 上什么是正确的 - 也许只是一个`dir`并寻找摘要。

在打扰这样的事情之前，我强烈建议您创建一个包含大量文件的目录，然后看看 list().length 是否真的需要太长时间。正如[这位博主](http://asserttrue.blogspot.com/2009/03/twice-as-fast-isnt-good-enough.html)所建议的那样，您可能不想为此出汗。

我自己可能会接受Varkhan的回答。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2015-06-11T14:42:54.853

由于您实际上并不需要总数，并且实际上想要在某个数字（在您的情况下为 5000）之后执行操作，因此您可以使用[`java.nio.file.Files.newDirectoryStream`](http://docs.oracle.com/javase/7/docs/api/java/nio/file/Files.html#newDirectoryStream(java.nio.file.Path)). 好处是您可以提前退出，而不必遍历整个目录来获得计数。

```
public boolean isOverMax(){
    Path dir = Paths.get("C:/foo/bar");
    int i = 1;

    try (DirectoryStream<Path> stream = Files.newDirectoryStream(dir)) {
        for (Path p : stream) {
            //larger than max files, exit
            if (++i > MAX_FILES) {
                return true;
            }
        }
    } catch (IOException ex) {
        ex.printStackTrace();
    }

    return false;
} 
```

的[接口文档](http://docs.oracle.com/javase/7/docs/api/java/nio/file/DirectoryStream.html)`DirectoryStream`也有一些很好的例子。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-07-02T08:26:18.877

如果您的目录确实包含（> 100'000）许多文件，那么这是一种（非便携式）方法：

```
String directoryPath = "a path";

// -f flag is important, because this way ls does not sort it output,
// which is way faster
String[] params = { "/bin/sh", "-c",
    "ls -f " + directoryPath + " | wc -l" };
Process process = Runtime.getRuntime().exec(params);
BufferedReader reader = new BufferedReader(new InputStreamReader(
    process.getInputStream()));
String fileCount = reader.readLine().trim() - 2; // accounting for .. and .
reader.close();
System.out.println(fileCount); 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-05-16T23:07:28.817

使用 sigar 应该会有所帮助。[Sigar](http://sigar.hyperic.com/)有本地钩子来获取统计信息

```
new Sigar().getDirStat(dir).getTotal() 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2020-12-22T16:39:21.500

这种方法对我很有效。

```
 // Recursive method to recover files and folders and to print the information
public static void listFiles(String directoryName) {

    File file = new File(directoryName);
    File[] fileList = file.listFiles(); // List files inside the main dir
    int j;
    String extension;
    String fileName;

    if (fileList != null) {
        for (int i = 0; i < fileList.length; i++) {
            extension = "";
            if (fileList[i].isFile()) {
                fileName = fileList[i].getName();

                if (fileName.lastIndexOf(".") != -1 && fileName.lastIndexOf(".") != 0) {
                    extension = fileName.substring(fileName.lastIndexOf(".") + 1);
                    System.out.println("THE " + fileName + "  has the extension =   " + extension);
                } else {
                    extension = "Unknown";
                    System.out.println("extension2 =    " + extension);
                }

                filesCount++;
                allStats.add(new FilePropBean(filesCount, fileList[i].getName(), fileList[i].length(), extension,
                        fileList[i].getParent()));
            } else if (fileList[i].isDirectory()) {
                filesCount++;
                extension = "";
                allStats.add(new FilePropBean(filesCount, fileList[i].getName(), fileList[i].length(), extension,
                        fileList[i].getParent()));
                listFiles(String.valueOf(fileList[i]));
            }
        }
    }
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-26T20:39:55.987

不幸的是，正如 mmyers 所说，File.list() 的速度与您使用 Java 的速度差不多。如果速度和您说的一样重要，您可能需要考虑使用[JNI](http://en.wikipedia.org/wiki/Java_Native_Interface)执行此特定操作。然后，您可以根据您的特定情况和文件系统定制您的代码。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2018-05-31T15:40:32.340

```
public void shouldGetTotalFilesCount() {
    Integer reduce = of(listRoots()).parallel().map(this::getFilesCount).reduce(0, ((a, b) -> a + b));
}

private int getFilesCount(File directory) {
    File[] files = directory.listFiles();
    return Objects.isNull(files) ? 1 : Stream.of(files)
            .parallel()
            .reduce(0, (Integer acc, File p) -> acc + getFilesCount(p), (a, b) -> a + b);
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2021-09-04T10:48:34.497

计算目录和所有子目录中的文件。

```
var path = Path.of("your/path/here");
var count = Files.walk(path).filter(Files::isRegularFile).count(); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-04-22T01:46:26.303

在春季批次中，我在下面做了

```
private int getFilesCount() throws IOException {
        ResourcePatternResolver resolver = new PathMatchingResourcePatternResolver();
        Resource[] resources = resolver.getResources("file:" + projectFilesFolder + "/**/input/splitFolder/*.csv");
        return resources.length;
    } 
```

# sql - MS SQL 2005“对于 XML 路径”节点布局问题

> ID：687446
> 
> 赞同：0
> 
> 时间：2009-03-26T20:26:42.913
> 
> 标签：sql, sql-server, xml, tsql, sqlxml

我有以下查询

```
Select field1 as 'node1/field1',
       field2 as 'node1/field2',
  (Select field3 as 'child1/field3',
          field4 as 'child1/field4'
   From table2
   FOR XML PATH(''),TYPE,Elements)
From Table1 FOR XML PATH('Root'),Elements 
```

这会产生：

```
<Root>
  <node1>
    <field1>data1</field1>
    <field2>data2</field2>
  </node1>
   <child1>
     <field3>data3</field3>
     <field4>data4</field4>
   </child1>
   <child1>
     ...   
</Root> 
```

我希望 child1 节点成为 node1 的一部分，而不是下面的单独节点。

```
<Root>
  <node1>
    <field1>data1</field1>
    <field2>data2</field2>
    <child1>
       <field3>data3</field3>
       <field4>data4</field4>
    </child1>
    <child1>
      ...
 </node1>
 <node1>
   ...
</Root> 
```

我试过把 node1 放在子查询 PATH

```
FOR XML PATH('node1'),TYPE,Elements) 
```

或在子查询字段名称前加上 node1

```
Select field3 as 'node1/child1/field3', 
```

但两者都为子查询创建了一个新的 node1 元素。

有谁知道我怎么能做到这一点？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T22:06:56.323

你必须告诉 SQL Server table1 和 table2 是如何相关的。根据您在下面的回答，我认为这样的事情可能会奏效：

```
select 
    table1.field1 as 'Node1/Field1'
,   table2.field1 as 'Node1/Child1/Field1'
,   table1.field2 as 'Node2/Field2'
from table1
left join table2 on table1.id = table2.table1id
for xml PATH(''), ROOT('Root') 
```

这应该产生如下 XML：

```
<Root>
    <Node1>
        <Field1>Value</Field1>
        <Child1>
            <Field1>Value</Field1>
        </Child1>
    </Node1>
    <Node2>
        <Field2>Value</Field2>
    </Node2>
</Root> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T03:19:41.640

我没有用 T-SQL 和 FOR XML 做很多工作，但是我通过在每个子查询之后调用查询的 FOR XML 部分来解决类似的问题，如下所示，并使用 PATH 标识符来设置节点：

```
SELECT field1 as "Field1",
    field2  as "Field2",
    (select
        field3 as "Field3",
        field4 as "Field4"

        from table2 t2 inner join 
        tlink tl on tl.id = t2.id inner join
        table2 on t2.id = tl.id
        group by field3, field4
        FOR XML PATH ('Child'), type
        ) 

from table2 t2 
group by field1, field2
FOR XML PATH('Node'), ROOT('Root') 
```

这返回：

```
<Root>
  <Node1>
    <Field1>data1</Field1>
    <Field2>data2</Field2>
    <Child1>
      <Field3>data3</Field3>
      <Field4>data4</Field4>
    </Child1>
  </Node1>
  <Node2>
    <Field1>data1.2</Field1>
    <Field2>data2.2</Field2>
    <Child2>
      <Field3>data3.2</Field3>
      <Field4>data4.2</Field4>
    </Child2>

...
  </Node2>

...
</Root> 
```

正如 Andomar 所提到的，您需要确保您的数据正确连接。

我还加入了 Group By 子句，以确保数据不会“误入歧途”。我在将子查询数据复制为外部查询中每个条目的子项时遇到问题（每个节点下有多个子项，与有多少节点有关。）我确信有一个简单的解释，但我是当我这样做时，工作时间很紧，再也没有回去检查......

如果这是不正确的用法或任何人都可以阐明重复组，请指出，我会编辑...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T15:20:17.493

正如您所指出的，我的第一个示例查询不太正确。这是一个更精确的示例查询。

```
Select field1 as 'node1/field1',       
       field2 as 'node1/field2',  
  (Select field3 as 'child1/field3',          
        field4 as 'child1/field4'   
   From table2   
   Where table1.ID = table2.ID
   FOR XML PATH(''),TYPE,Elements),
       field5 as 'node2/field5',
       field6 as 'node2/field6'
From table1 FOR XML PATH('Root'),Elements 
```

产生：

```
<Root>
  <node1>
    <field1>data1</field1>
    <field2>data2</field2>
  </node1>   
  <child1>     
    <field3>data3</field3>
    <field4>data4</field4>
  </child1>
  <node2>
    <field5>data5</field5>
    <field6>data6</field6>
  </node2>
</Root> 
```

field5 和 field6 是来自外部查询的字段，但位于不同的节点路径 node2 中。这就是为什么我不能在外部查询中使用 PATH('node') 。外部查询字段用于 Root 下的许多不同节点路径。我需要子查询在 node1 下返回，还有其他子查询需要在 node2、node3 下返回......
我当然希望我说得通。这是我的第一篇文章，下次我会确保并发布更好的示例查询。

感谢您的回答。

短剑

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-28T00:19:54.420

如果您发布一些示例数据而不是使用 node1、field1、child1 等并解释数据来自哪些表，这可能更有意义。

XML 本质上是分层的。您不能随意启动与根下其他节点无关的新节点，这听起来像是您正在尝试做的事情。

`<node1>`..to..中的所有内容都`</node1>`与一条记录及其子查询生成的数据相关。下一个节点序列会将结构复制为`<node2>`..to..`</node2>`用于下一条记录。

如果你想在每个节点下有更多的子查询，那么只需在 SQL 中用自己的方式编写每个子查询`FOR XML PATH('SubNodeName')`

发布您的 XSD 或 XML 代码示例，我会看看我是否能弄清楚您想要做什么。

# c++ - C++ 未定义参考（即使包含）

> ID：687448
> 
> 赞同：9
> 
> 时间：2009-03-26T20:27:27.170
> 
> 标签：c++, include

如果不在我的 main.cpp 文件中显式包含 TestClass.cpp 文件，我无法编译这段简单的代码。我究竟做错了什么？提前致谢！

这是代码：

测试类.h

```
#ifndef TESTCLASS_H_
#define TESTCLASS_H_

class TestClass
{
    public:
        static int foo();
};

#endif 
```

测试类.cpp

```
#include "TestClass.h"

int TestClass::foo() { return 42; } 
```

主文件

```
#include <iostream>

#include "TestClass.h"

using namespace std;

int main()
{
    cout << TestClass::foo() << endl;

    return 0;
} 
```

这是错误：

```
g++ main.cpp -o main.app
/tmp/ccCjOhpy.o: In function `main':
main.cpp:(.text+0x18e): undefined reference to `TestClass::foo()'
collect2: ld returned 1 exit status 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-26T20:29:12.377

将 TestClass.cpp 包含到命令行中，以便链接器可以找到函数定义：

```
g++ main.cpp TestClass.cpp -o main.app 
```

或者，将每个编译为自己的目标文件，然后告诉编译器将它们链接在一起（它将它们转发给链接器）

```
g++ -c main.cpp -o main.o
g++ -c TestClass.cpp -o TestClass.o
g++ main.o TestClass.o -o main.app 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T20:31:43.760

您没有编译和链接`TestClass.cpp`（在哪里实现`foo()`）。因此，编译器抱怨您尝试使用未定义的函数。

# git - 如何比较两个 git 存储库？

> ID：687450
> 
> 赞同：34
> 
> 时间：2009-03-26T20:27:58.747
> 
> 标签：git, version-control

我有两个不同的 CVS 存储库导出到 git。它们在某些时候出现分歧，我正在调查原因。开发线可以追溯到几年前，提交了数万次。

在开发线的开头，每次提交的 SHA1 ID 都是相同的，告诉我 git-cvsimport 在读取 cvsps 和导入的结果时所做的工作非常一致。

但是在第一次提交和昨天之间的某个时间，SHA1 ID 开始出现分歧。我想通过比较来自每个存储库的提交 ID 列表并查看缺少的内容来找出它在哪里。有没有什么好的工具或技术可以做到这一点？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-03-26T20:50:13.653

由于两个 git 存储库一开始是相同的，因此您可以将两者都拉到同一个工作存储库中。

```
$ git remote add cvsimport-a git://.../cvsimport-a.git
$ git remote add cvsimport-b git://.../cvsimport-b.git
$ git remote update
$ git log cvsimport-a/master..cvsimport-b/master  # in B, not in A?
$ git log cvsimport-b/master..cvsimport-a/master  # in A, not in B? 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-03-26T20:49:35.213

为什么不将每个 repo 的 git log 放到它自己的文件中并进行比较？最接近文件底部的差异是他们开始分歧的地方......

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-03-26T21:08:06.230

在您的一个存储库中，执行以下操作：

```
$ git remote add other-repo git://.../other-repo.git
$ git remote update
$ git log other-repo/master...master
  # or maybe:
$ gitk master... other-repo/master 
```

这为您提供了两个存储库之间的对称差异；这向您显示了一个存储库中的所有提交，而不是另一个。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-26T20:45:35.973

显而易见的方法是克隆一个存储库，将另一个存储库的主分支的尖端提取到克隆中，然后在两个尖端上使用 git merge-base 来找到共同的祖先。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-27T03:29:23.647

您可以将两个存储库放入（获取）单个存储库，无论是新存储库还是现有存储库，如**ehemient**、**Charles Bailey**和**Brian Campbell**的响应。或者您可以使用 Git Wiki 上的[提示和技巧](https://git.wiki.kernel.org/index.php/GitTips#How_to_compare_two_local_repositories)页面中的技巧，或者更准确地说是“如何比较两个本地存储库”问题。

But it might be simpler to generate list of SHA-1 of commits in topological order using "git rev-list" (or "git-log" with appropriate options), and check the first revision they differ.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-09-23T19:24:39.880

我最近也有类似的需求。我有一个克隆的远程项目，需要与当前复制的代码库进行比较。git 日志不相关，因为提交没有任何共同点，而且我不确定它们是从同一个代码库中分支出来的。

为了解决这个问题，我以蛮力的方式使用了 git。我将要检查的文件复制到 git 存储库中，然后检查`git status`列表中的已更改文件。

此外，`git diff <filename>`还可用于进一步检查。我能够比较文件

# forms - struts2 组合框 - 通过表单将整数 id 而不是字符串名称传递给操作

> ID：687459
> 
> 赞同：0
> 
> 时间：2009-03-26T20:30:45.400
> 
> 标签：forms, combobox, struts2, action

我的表单正在将国家/地区的字符串名称传递给操作。如何将对象国家/地区的 ID 从组合框中传递给操作？

这就是我所拥有的：

s:combobox label="Country" name="country" headerValue="Select" headerKey="1" list="%{countries}" listValue="name"/>

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T20:59:39.900

您错过了**listKey**属性。如果您将其更改为：

```
<s:combobox label="Country" name="country" headerValue="Select" headerKey="1"
list="%{countries}" listValue="name" listKey="id"/> 
```

它可能会起作用。

有关所有可用属性，请参见[http://struts.apache.org/2.0.14/docs/combobox.html](http://struts.apache.org/2.0.14/docs/combobox.html)。

# configuration - .NET 类型可从 App.Config 加载

> ID：687466
> 
> 赞同：2
> 
> 时间：2009-03-26T20:33:12.977
> 
> 标签：configuration, .net-2.0, app-config

如何设计一种类型，以与 SMTPClient 类或 TraceListener 相同的方式从 App.Config 文件加载其属性？这样做时我应该遵循什么标准？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T20:36:10.240

查看[ConfigurationSection](http://msdn.microsoft.com/en-us/library/system.configuration.configurationsection.aspx)类和[ConfigurationElement](http://msdn.microsoft.com/en-us/library/system.configuration.configurationelement.aspx)类

这是一篇不错的教程文章 [http://msdn.microsoft.com/en-us/library/2tw134k3.aspx](http://msdn.microsoft.com/en-us/library/2tw134k3.aspx)

这是来自 machine.config 的 system.net 配置组的片段

```
<sectionGroup name="system.net" type="System.Net.Configuration.NetSectionGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089">
  <section name="authenticationModules" type="System.Net.Configuration.AuthenticationModulesSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"/>
  <section name="connectionManagement" type="System.Net.Configuration.ConnectionManagementSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"/>
  <section name="defaultProxy" type="System.Net.Configuration.DefaultProxySection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"/>
  <sectionGroup name="mailSettings" type="System.Net.Configuration.MailSettingsSectionGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089">
    <section name="smtp" type="System.Net.Configuration.SmtpSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"/>
  </sectionGroup>
  <section name="requestCaching" type="System.Net.Configuration.RequestCachingSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"/>
  <section name="settings" type="System.Net.Configuration.SettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"/>
  <section name="webRequestModules" type="System.Net.Configuration.WebRequestModulesSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"/>
</sectionGroup> 
```

# sql - SQL Compact Edition 是否支持聚集索引？

> ID：687469
> 
> 赞同：11
> 
> 时间：2009-03-26T20:34:21.820
> 
> 标签：sql, sql-server-ce

SQL CE 是否支持聚集索引？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-26T20:45:24.850

MSDN 谈到了 NONCLUSTERED 论点：

```
This is the only supported index type 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-26T20:40:17.310

从 SQL Server Compact Edition 的[CREATE INDEX](http://technet.microsoft.com/en-us/library/ms345331.aspx "创建索引")语法来看，唯一支持的索引类型是 NONCLUSTERED。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-11-26T01:35:55.183

大多数基于文件的数据库不支持聚集索引。如果您乱序插入新行，则需要重写整个索引。由于这很昂贵（并且是阻塞操作），大多数文件数据库都不允许这样做。

但是，您通常会获得自然秩序的概念。您插入的顺序是它们在磁盘上的顺序。这是完整的 SQL Server 所没有的，它总是从以前的页面中回收可用空间。

# vba - 如何将 2D Excel 表格“展平”或“折叠”成 1D？

> ID：687470
> 
> 赞同：52
> 
> 时间：2009-03-26T20:34:38.417
> 
> 标签：vba, excel

我在 Excel 中有一个包含国家和年份的二维表。例如。

```
 1961        1962        1963        1964
USA      a           x            g           y
France   u           e            h           a
Germany  o           x            n           p 
```

我想“展平”它，这样我在第一列中有国家，在第二列中有年份，然后在第三列中有值。例如。

```
Country      Year       Value
USA          1961       a
USA          1962       x
USA          1963       g
USA          1964       y
France       1961       u
              ... 
```

我在这里展示的示例只是一个 3x4 矩阵，但我拥有的真实数据集要大得多（大约 50x40 左右）。

有什么建议我可以如何使用 Excel 做到这一点？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-03-26T20:38:35.880

您可以使用 excel 数据透视表功能来反转数据透视表（这基本上就是您在这里所拥有的）：

这里有很好的说明：

[http://spreadsheetpage.com/index.php/tip/creating_a_database_table_from_a_summary_table/](http://spreadsheetpage.com/index.php/tip/creating_a_database_table_from_a_summary_table/)

如果您不想手动按照说明操作，则链接到以下 VBA 代码（将其放入模块中）：

```
Sub ReversePivotTable()
'   Before running this, make sure you have a summary table with column headers.
'   The output table will have three columns.
    Dim SummaryTable As Range, OutputRange As Range
    Dim OutRow As Long
    Dim r As Long, c As Long

    On Error Resume Next
    Set SummaryTable = ActiveCell.CurrentRegion
    If SummaryTable.Count = 1 Or SummaryTable.Rows.Count < 3 Then
        MsgBox "Select a cell within the summary table.", vbCritical
        Exit Sub
    End If
    SummaryTable.Select
    Set OutputRange = Application.InputBox(prompt:="Select a cell for the 3-column output", Type:=8)
'   Convert the range
    OutRow = 2
    Application.ScreenUpdating = False
    OutputRange.Range("A1:C3") = Array("Column1", "Column2", "Column3")
    For r = 2 To SummaryTable.Rows.Count
        For c = 2 To SummaryTable.Columns.Count
            OutputRange.Cells(OutRow, 1) = SummaryTable.Cells(r, 1)
            OutputRange.Cells(OutRow, 2) = SummaryTable.Cells(1, c)
            OutputRange.Cells(OutRow, 3) = SummaryTable.Cells(r, c)
            OutputRange.Cells(OutRow, 3).NumberFormat = SummaryTable.Cells(r, c).NumberFormat
            OutRow = OutRow + 1
        Next c
    Next r
End Sub 
```

-亚当

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-10-21T20:26:12.673

@Adam Davis 的答案是完美的，但以防万一你和我一样对 Excel VBA 一无所知，这就是我为使代码在 Excel 2007 中工作所做的工作：

1.  打开包含需要展平为表格的矩阵的工作簿并导航到该工作表
2.  按 Alt-F11 打开 VBA 代码编辑器。
3.  在左侧窗格的“项目”框中，您将看到一个树结构，表示 Excel 对象和任何已经存在的代码（称为模块）。右键单击框中的任意位置并选择“插入->模块”以创建一个空白模块文件。
4.  从上面复制 @Adman Davis 的代码并将其粘贴到打开的空白页面中并保存。
5.  关闭 VBA 编辑器窗口并返回到电子表格。
6.  单击矩阵中的任何单元格以指示您将使用的矩阵。
7.  现在您需要运行宏。此选项的位置将根据您的 Excel 版本而有所不同。当我使用 2007 时，我可以告诉您，它会将其宏保留在“视图”功能区中，作为最右侧的控件。单击它，您将看到一个宏清单，只需双击名为“ReversePivotTable”的宏即可运行它。
8.  然后它将显示一个弹出窗口，要求您告诉它在哪里创建展平表。只需将其指向电子表格中的任何空白区域，然后单击“确定”

你完成了！第一列是行，第二列是列，第三列是数据。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2015-08-14T22:19:01.343

在 Excel 2013 中需要执行以下步骤：

*   选择数据并转换为表格（***插入->表格***）
*   为表调用查询编辑器（**Power Query -> From Table**）
*   选择包含年份的列
*   在上下文菜单中选择“ ***Unpivot Columns*** ”命令。

[支持办公室：反透视列 (Power Query)](https://support.office.com/en-sg/article/Unpivot-columns-Power-Query-0f7bad4b-9ea1-49c1-9d95-f588221c7098?ui=en-US&rs=en-SG&ad=SG)

在 Excel 2016 中，Power Query 称为**获取和转换**，它位于**数据**选项卡中。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2015-10-07T02:59:58.077

可以使用一个数组公式¹和两个标准公式来展平数据矩阵（又*名表）。*

      [![将表格展平成列](https://i.stack.imgur.com/YwlsC.png)](https://i.stack.imgur.com/YwlsC.png)

G3:I3 中的数组公式¹和两个标准公式是，

```
=IFERROR(INDEX(A$2:A$4, MATCH(0, IF(COUNTIF(G$2:G2, A$2:A$4&"")<COUNT($1:$1), 0, 1), 0)), "")
=IF(LEN(G3), INDEX($B$1:INDEX($1:$1, MATCH(1E+99,$1:$1 )), , COUNTIF(G$3:G3, G3)), "")
=INDEX(A:J,MATCH(G3,A:A,0),MATCH(H3,$1:$1,0)) 
```

根据需要填写。

虽然数组公式会由于其循环计算而对性能产生负面影响，但您所描述的 40 行 × 50 列的工作环境不应过度影响性能并导致计算滞后。

* * *

¹[数组公式需要用`Ctrl`+ `Shift`+完成`Enter↵</kbd>. Once entered into the first cell correctly, they can be filled or copied down or right just like any other formula. Try and reduce full-column references to ranges more closely representing the extents of your actual data. Array formulas chew up calculation cycles logarithmically so it is good practise to narrow the referenced ranges to a minimum. See [Guidelines and examples of array formulas](https://support.office.com/en-ca/article/guidelines-and-examples-of-array-formulas-7d94a64e-3ff3-4686-9372-ecfd5caa57c7) for more information.`]

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-02-16T13:53:53.607

对于任何想要使用数据透视表并遵循以下指南的人： http: [//spreadsheetpage.com/index.php/tip/creating_a_database_table_from_a_summary_table/](http://spreadsheetpage.com/index.php/tip/creating_a_database_table_from_a_summary_table/)

如果您想在 Excel 2007 或 2010 中执行此操作，则首先需要启用数据透视表向导。

要找到您需要通过主 Excel 窗口图标转到“Excel 选项”的选项，并查看在“自定义”部分中选择的选项，然后从“选择命令来自：”下拉列表中选择“不在功能区中的命令”并且需要在右侧添加“数据透视表和数据透视图向导”。请参见下图。

完成后，Excel 窗口顶部的快捷栏菜单中应该会出现一个小的可透视向导图标，然后您可以按照上面链接中所示的相同过程进行操作。

![在此处输入图像描述](https://i.stack.imgur.com/WnHUE.png)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2017-08-16T10:21:29.447

我开发了另一个宏，因为我需要经常刷新输出表（输入表被其他人填充）并且我想在我的输出表中有更多信息（更多复制的列和一些公式）

```
Sub TableConvert()

Dim tbl As ListObject 
Dim t
Rows As Long
Dim tCols As Long
Dim userCalculateSetting As XlCalculation
Dim wrksht_in As Worksheet
Dim wrksht_out As Worksheet

'##block calculate and screen refresh
Application.ScreenUpdating = False
userCalculateSetting = Application.Calculation
Application.Calculation = xlCalculationManual

'## get the input and output worksheet
Set wrksht_in = ActiveWorkbook.Worksheets("ressource_entry")'## input
Set wrksht_out = ActiveWorkbook.Worksheets("data")'## output.

'## get the table object from the worksheet
Set tbl = wrksht_in.ListObjects("Table14")  '## input
Set tb2 = wrksht_out.ListObjects("Table2") '## output.

'## delete output table data
If Not tb2.DataBodyRange Is Nothing Then
    tb2.DataBodyRange.Delete
End If

'## count the row and col of input table

With tbl.DataBodyRange
     tRows = .Rows.Count
     tCols = .Columns.Count
End With

'## check every case of the input table (only the data part)
For j = 2 To tRows '## parse all row from row 2 (header are not checked)
    For i = 5 To tCols '## parse all column from col 5 (first col will be copied in each record)
        If IsEmpty(tbl.Range.Cells(j, i).Value) = False Then
            '## if there is time enetered create a new row in table2 by using the first colmn of the selected cell row and cell header plus some formula
            Set oNewRow = tb2.ListRows.Add(AlwaysInsert:=True)
            oNewRow.Range.Cells(1, 1).Value = tbl.Range.Cells(j, 1).Value
            oNewRow.Range.Cells(1, 2).Value = tbl.Range.Cells(j, 2).Value
            oNewRow.Range.Cells(1, 3).Value = tbl.Range.Cells(j, 3).Value
            oNewRow.Range.Cells(1, 4).Value = tbl.Range.Cells(1, i).Value
            oNewRow.Range.Cells(1, 5).Value = tbl.Range.Cells(j, i).Value
            oNewRow.Range.Cells(1, 6).Formula = "=WEEKNUM([@Date])"
            oNewRow.Range.Cells(1, 7).Formula = "=YEAR([@Date])"
            oNewRow.Range.Cells(1, 8).Formula = "=MONTH([@Date])"
        End If
   Next i
Next j
ThisWorkbook.RefreshAll

'##unblock calculate and screen refresh
Application.ScreenUpdating = True 
Application.Calculate
Application.Calculation = userCalculateSetting

End Sub 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-08-29T06:38:21.520

VBA 解决方案在某些情况下可能无法接受（例如由于安全原因无法嵌入宏等）。对于这些情况，以及一般情况下，我更喜欢使用公式而不是宏。

我试图在下面描述我的解决方案。

*   输入数据如问题所示（B2：F5）
*   column_header (C2:F2)
*   row_header (B3:B5)
*   数据矩阵（C3：F5）
*   no_of_data_rows (I2) = COUNTA(row_header) + COUNTBLANK(row_header)
*   no_of_data_columns (I3) = COUNTA(column_header) + COUNTBLANK(column_header)
*   no_output_rows (I4) = no_of_data_rows*no_of_data_columns
*   种子区为K2:M2，为空白但被引用，因此不被删除
*   K3（拖过说 K100，见评论说明）= ROW()-ROW($K$2) <= no_output_rows
*   L3（拖过 L100，见评论说明）= IF(K3,IF(COUNTIF($L$2:L2,L2)
*   M3（拖过说 M100，见注释说明）= IF(K3,IF(M2 < no_of_data_columns,M2+1,1),"-")
*   N3（拖过说 N100，见评论说明）= INDEX(row_header,L3)
*   O3（拖过说 O100，见评论说明）= INDEX(column_header,M3)
*   P3（拖过说 P100，见评论描述）= INDEX（data_matrix，L3，M3）
*   K3 中的评论：**可选**：检查是否预期没有。已实现输出行数。不需要，如果一个人只准备此表，则限制为否。输出行数。
*   L3 中的注释：**目标**：每个 RowIndex (1 .. no_of_data_rows) 必须重复 no_of_data_columns 次。这将为 row_header 值提供索引查找。在此示例中，每个 RowIndex (1 .. 3) 必须重复 4 次。**算法**：检查 RowIndex 已经发生了多少次。如果它小于 no_of_data_columns 次，则继续使用该 RowIndex，否则递增 RowIndex。**可选**：检查是否预期没有。已实现输出行数。
*   M3 中的注释：**目标**：每个 ColumnIndex (1 .. no_of_data_columns) 必须在一个循环中重复。这将为 column_header 值提供索引查找。在此示例中，每个 ColumnIndex (1 .. 4) 必须在一个循环中重复。**算法**：如果 ColumnIndex 超过 no_of_data_columns，则从 1 重新开始循环，否则增加 ColumnIndex。**可选**：检查是否预期没有。已实现输出行数。
*   R4 中的注释：**可选**：使用列 K 进行错误处理，如 L 列和 M 列所示。检查是否查找值 IsBlank 以避免由于 data_matrix 中的空白输入而导致输出中出现不正确的“0”。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-12-06T18:02:58.700

更新了 ReversePivotTable 函数，因此我可以指定标题列和行的数量

```
Sub ReversePivotTable()
'   Before running this, make sure you have a summary table with column headers.
'   The output table will have three columns.
    Dim SummaryTable As Range, OutputRange As Range
    Dim OutRow As Long
    Dim r As Long, c As Long

    Dim lngHeaderColumns As Long, lngHeaderRows As Long, lngHeaderLoop As Long

    On Error Resume Next
    Set SummaryTable = ActiveCell.CurrentRegion
    If SummaryTable.Count = 1 Or SummaryTable.Rows.Count < 3 Then
        MsgBox "Select a cell within the summary table.", vbCritical
        Exit Sub
    End If
    SummaryTable.Select

    Set OutputRange = Application.InputBox(prompt:="Select a cell for the 3-column output", Type:=8)
    lngHeaderColumns = Application.InputBox(prompt:="Header Columns")
    lngHeaderRows = Application.InputBox(prompt:="Header Rows")
'   Convert the range
    OutRow = 2
    Application.ScreenUpdating = False
    'OutputRange.Range("A1:D3") = Array("Column1", "Column2", "Column3", "Column4")
    For r = lngHeaderRows + 1 To SummaryTable.Rows.Count
        For c = lngHeaderColumns + 1 To SummaryTable.Columns.Count
            ' loop through all header columns and add to output
            For lngHeaderLoop = 1 To lngHeaderColumns
                OutputRange.Cells(OutRow, lngHeaderLoop) = SummaryTable.Cells(r, lngHeaderLoop)
            Next lngHeaderLoop
            ' loop through all header rows and add to output
            For lngHeaderLoop = 1 To lngHeaderRows
                OutputRange.Cells(OutRow, lngHeaderColumns + lngHeaderLoop) = SummaryTable.Cells(lngHeaderLoop, c)
            Next lngHeaderLoop

            OutputRange.Cells(OutRow, lngHeaderColumns + lngHeaderRows + 1) = SummaryTable.Cells(r, c)
            OutputRange.Cells(OutRow, lngHeaderColumns + lngHeaderRows + 1).NumberFormat = SummaryTable.Cells(r, c).NumberFormat
            OutRow = OutRow + 1
        Next c
    Next r
End Sub 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-10-01T19:21:36.273

声称具有某种普遍性的代码 这本书应该有两张纸： Sour = Source data Dest = “扩展”表将放在这里

```
 Option Explicit
    Private ws_Sour As Worksheet, ws_Dest As Worksheet
    Private arr_2d_Sour() As Variant, arr_2d_Dest() As Variant
    ' https://stackoverflow.com/questions/52594461/find-next-available-value-in-excel-cell-based-on-criteria
    Public Sub PullOut(Optional ByVal msg As Variant)
        ws_Dest_Acr _
                arr_2d_ws( _
                arr_2d_Dest_Fill( _
                arr_2d_Sour_Load( _
                arr_2d_Dest_Create( _
                CountA_rng( _
                rng_2d_For_CountA( _
                Init))))))
    End Sub

    Private Function ws_Dest_Acr(Optional ByVal msg As Variant) As Variant
        ws_Dest.Activate
    End Function

    Public Function arr_2d_ws(Optional ByVal msg As Variant) As Variant
        If IsArray(arr_2d_Dest) Then _
           ws_Dest.Cells(1, 1).Resize(UBound(arr_2d_Dest), UBound(arr_2d_Dest, 2)) = arr_2d_Dest
    End Function

    Private Function arr_2d_Dest_Fill(Optional ByVal msg As Variant) As Variant
        Dim y_Sour As Long, y_Dest As Long, x As Long
        y_Dest = 1
        For y_Sour = LBound(arr_2d_Sour) To UBound(arr_2d_Sour)
            ' without the first column
            For x = LBound(arr_2d_Sour, 2) + 1 To UBound(arr_2d_Sour, 2)
                If arr_2d_Sour(y_Sour, x) <> Empty Then
                    arr_2d_Dest(y_Dest, 1) = arr_2d_Sour(y_Sour, 1)    'iD
                    arr_2d_Dest(y_Dest, 2) = arr_2d_Sour(y_Sour, x)    'DTLx
                    y_Dest = y_Dest + 1
                End If
            Next
        Next
    End Function

    Private Function arr_2d_Sour_Load(Optional ByVal msg As Variant) As Variant
        arr_2d_Sour = ReDuce_rng(ws_Sour.UsedRange, 1, 0).Offset(1, 0).Value
    End Function

    Private Function arr_2d_Dest_Create(ByVal iRows As Long)
        Dim arr_2d() As Variant
        ReDim arr_2d(1 To iRows, 1 To 2)
        arr_2d_Dest = arr_2d
        arr_2d_Dest_Create = arr_2d
    End Function

    Public Function CountA_rng(ByVal rng As Range) As Double
        CountA_rng = Application.WorksheetFunction.CountA(rng)
    End Function

    Private Function rng_2d_For_CountA(Optional ByVal msg As Variant) As Range
        ' without the first line and without the left column
        Set rng_2d_For_CountA = _
        ReDuce_rng(ws_Sour.UsedRange, 1, 1).Offset(1, 1)
    End Function

    Public Function ReDuce_rng(rng As Range, ByVal iRow As Long, ByVal iCol As Long) _
           As Range
        With rng
            Set ReDuce_rng = .Resize(.Rows.Count - iRow, .Columns.Count - iCol)
        End With
    End Function

    Private Function Init()
        With ThisWorkbook
            Set ws_Sour = .Worksheets("Sour")
            Set ws_Dest = .Worksheets("Dest")
        End With
    End Function

'https://youtu.be/oTp4aSWPKO0 
```

# vba - EXCEL公式或VBA根据另一个单元格的数据提取数据

> ID：687471
> 
> 赞同：1
> 
> 时间：2009-03-26T20:34:45.953
> 
> 标签：vba, excel, excel-formula

我有以下关于人和年龄的工作表#1（针对问题进行了简化）：

```
人年龄
鲍勃 40
布雷特 35
布赖恩 38

```

我想设置另一个工作表，其中包含以下内容：

```
人年龄
现货 #1 公式

```

用户将在 Spot #1 中输入一个名称，我希望在名为 FORMULA 的单元格中输入一个公式/代码，其中公式/VBA 代码将查看工作表 #1 中的表格，并根据输入的人拉入适当的年龄。

我可以使用什么公式来做到这一点？

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T20:44:58.860

使用[VLOOKUP](http://office.microsoft.com/en-us/excel/HP052093351033.aspx)函数。下面的示例假定您的数据表位于 Sheet1!A1:B4 中。虽然我建议您将数据表设为[命名范围](http://office.microsoft.com/en-us/excel/HP052015361033.aspx?pid=CH010036991033)并使用 VLOOKUP(A2, MyDataTable, 2) 引用它

```
人年龄
点 #1 =VLOOKUP(A2, Sheet1!A1:B4, 2)

```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T20:37:25.040

试试 vLookup 功能

# ruby-on-rails - Rails link_to_remote 降级和 url_for

> ID：687474
> 
> 赞同：1
> 
> 时间：2009-03-26T20:36:04.857
> 
> 标签：ruby-on-rails, ajax, url-routing

我正在尝试使用 AJAX 创建一个链接来销毁和进入数据库，但我也希望它在没有启用 JavaScript 的情况下运行

但是下面的代码

```
<%=link_to_remote "Delete", :update => "section_phone", :url => {:controller => "phone_numbers", :action => "destroy", :id => phone_number_display.id }, :href => url_for(:controller => "phone_numbers", :action => "destroy", :id => phone_number_display.id)%> 
```

产生输出

```
 <a href="#" onclick="new Ajax.Updater('section_phone', '/phone_numbers/destroy/1', {asynchronous:true, evalScripts:true, parameters:'authenticity_token=' + encodeURIComponent('b64efb643e49e9af5e2e195a90fd5a8b6b99ece2')}); return false;">Delete</a> 
```

由于某种原因，url_for 无法正常工作，并且 href 标记设置为 #。我不知道为什么这不起作用，因为我没有收到日志中的任何错误通知

有谁知道为什么会这样？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T03:26:05.027

您在 :update 和 :url 所属的 options{} 哈希周围缺少花括号，以将它们与 :href 所属的 html_options{} 哈希分开。

试试这个：

```
<%=link_to_remote "Delete", {:update => "section_phone", :url => {:controller => "phone_numbers", :action => "destroy", :id => phone_number_display.id }}, :href => url_for(:controller => "phone_numbers", :action => "destroy", :id => phone_number_display.id)%> 
```

这将使 URL 显示为链接的 href 属性，但对销毁操作的 GET 请求不应将其删除。您将需要其他东西（如 vrish88 所建议的），以便您可以向销毁操作发出 GET 请求以获取表单，然后发布该表单以实际删除电话号码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T21:38:57.030

我相信您正在寻找这样的东西：[RailsCasts - Destroy without JavaScript](http://railscasts.com/episodes/77-destroy-without-javascript)

# java - 在 Eclipse java 调试器中隐藏不存在的变量

> ID：687477
> 
> 赞同：5
> 
> 时间：2009-03-26T20:36:44.357
> 
> 标签：java, eclipse, debugging

例如，我有一个包含 2 个元素的 ArrayList，但 Eclipse Java 调试器向我显示了 10 个元素，其中 3-10 只是空值。如何禁用此“功能”？

图片详情
[http://img.skitch.com/20090326-8si53ytntwy6tjgsur32qwtmm2.png](http://img.skitch.com/20090326-8si53ytntwy6tjgsur32qwtmm2.png)

PS：Mac OS 10.5.6、Java6、Eclipse 3.4.2

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-26T20:56:37.490

在“变量”视图中（如您的屏幕截图所示）单击右上角的小向下三角形（=菜单），选择“Java”子菜单，然后删除“显示空数组”前面的勾号条目”。

（这有时第一次不起作用。可能是一个错误。只需尝试直到空值在视图中消失。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T01:42:30.300

默认情况下，创建 ArrayList 时，其大小为 10。使用它的 ensureCapacity 方法来指定您的容量。如果您有大量元素要添加到arraylist，则应该使用此方法，这有助于最大限度地减少内存块的重新分配，以便在arraylist 动态增加其大小时。

# python - 如何使用 Python 2.6.1 为 .NET 设置 Python？

> ID：687487
> 
> 赞同：0
> 
> 时间：2009-03-26T20:39:57.703
> 
> 标签：python

[Python for .NET (链接](http://sourceforge.net/project/showfiles.php?group_id=162464&package_id=183296&release_id=537499 "关联"))的“最终”版本没有为 Python 2.6 预编译。按照文档中的说明将编译符号更改为 PYTHON26 没有问题，解决方案重建得很好，但是在尝试导入 CLR 时，我收到一个错误，表明缺少 python26.dll。有人知道如何构建这个文件吗？它似乎不是解决方案的一部分，但我可能会遗漏一些明显的东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T22:01:32.467

我按照一位飞鸿的[这些指示来管理它。](http://feihonghsu.blogspot.com/2008/02/installing-pythonnet-20-alpha-2-on.html)

我现在注意到，如果您使用的是 SP1 ，作者已经发表了一篇[后续文章，这可能也很重要。](http://feihonghsu.blogspot.com/search/label/python.net)

# .net - 服务在启动时启动时数据库连接不起作用，但在手动启动时起作用

> ID：687489
> 
> 赞同：3
> 
> 时间：2009-03-26T20:42:11.050
> 
> 标签：.net, networking, windows-services, database-connection

我正在尝试追踪我的应用程序无法连接到数据库服务器的可能原因。

我有一个 Windows 服务，它在启动时连接到数据库。该服务在具有可靠有线网络连接的机器上运行。它与启动自动一起安装，因此通常它在 Windows 启动时启动，并且在几乎所有情况下都可以正常工作。

但是，对于一组 XP 机器（我无法控制），当服务在 windows 启动时启动时，数据库连接失败。引发了标准异常：

> System.Data.SqlClient.SqlException：建立与服务器的连接时发生错误。连接到 SQL Server 2005 时，此故障可能是由于在默认设置下 SQL Server 不允许远程连接造成的。（提供者：SQL 网络接口，错误：26 - 错误定位服务器/指定的实例）

在这些机器上，如果用户登录并手动启动服务，它会正确连接到数据库，这很奇怪。所以我猜windows启动时的问题是：

*   服务在网络连接之前启动
*   该服务在机器可以连接到 DNS 以解析服务器名称之前启动（如果这是解析 db 服务器名称的方式）
*   机器上有一个策略/防火墙/等，最初阻止传出连接
*   别的东西……

当用户手动启动服务时不会出现问题，所以一定是发生了一些事情来解决问题。我猜这要么是一个在启动时运行但在我的服务启动时尚未完成的进程，要么是用户已经登录的事实——可能是他们的登录脚本中的某些内容。

我没有直接访问机器的权限，因此需要想出问题可能是什么以及确定是否正确的方法。我不能重复部署诊断程序，所以第一次需要彻底。

所以第一个问题是：是否有人知道可能导致这种情况的桌面策略、网络策略或软件？第二个问题：我能做些什么来准确诊断正在发生的事情？

我正在考虑创建一个新的诊断服务，该服务也将安装为自动启动，并将执行各种操作以查看发生了什么，并记录此信息。例如：

*   运行“ipconfig /all”（查看是否有网络连接）
*   通过 IP 地址 ping 数据库服务器（查看是否可以找到服务器）
*   按名称 ping 数据库服务器
*   检查包含服务器名称的 HKLM 注册表项（以防以后更新 HKLM 注册表）
*   创建与数据库的 sql 连接（以了解何时开始工作）
*   每隔几秒钟重复这些步骤。

我将安装此服务，重新启动机器，然后在一段时间后让用户登录。诊断应该显示一些有用的信息......但有人有更好的想法或其他建议吗？

我还尝试将服务更改为具有适当权限的用户帐户运行，但这并没有解决问题。请注意，本地系统帐户确实有足够的权限来连接到数据库服务器，因为手动启动时该服务工作正常。[所以这和这个问题](https://stackoverflow.com/questions/249928/executable-started-by-a-windows-service-using-the-local-system-account-cannot-acc)不一样。

更新：麻烦的机器正在运行 Win XP。

更新：[这篇文章](http://blogs.msdn.com/sql_protocols/archive/2007/05/13/sql-network-interfaces-error-26-error-locating-server-instance-specified.aspx)很好地讨论了错误代码 26

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T21:04:13.433

这些机器上是否有可能安装了某种防火墙，但在您的服务启动时尚未启动？我遇到过一些情况，软件防火墙将完全锁定互联网连接，直到服务完全启动并且它可以正确监控流量 - 如果是这种情况，并且您的服务启动速度比防火墙快，您可以看到什么在您的应用程序看来，它是一个断开连接的网络。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T20:50:00.953

几个提示：

1.  也许您应该设置从您的服务到另一个 Windows 服务（如 SQL Server 或 DTC）的**依赖关系**，这将确保这些服务在您的服务启动之前启动。

2.  另一种选择（取决于您正在运行的操作系统）是**延迟自动启动服务**，请查看[http://msdn.microsoft.com/en-us/magazine/cc164252.aspx](http://msdn.microsoft.com/en-us/magazine/cc164252.aspx)

3.  第三种选择：只需在服务线程第一次连接到数据库之前将一些 Thread.Sleep （或轮询循环）放入您的服务线程。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-28T16:47:47.697

我们以前也遇到过这个问题。我们解决问题的方法是让启动线程在与数据库建立连接之前不会退出。我们会经常尝试连接并记录我们无法连接的事实。一旦我们建立了连接，我们将继续服务。

换句话说，让你的服务正常启动，但不要让它尝试执行任何工作，直到它知道它是否可以连接到数据库。如果您决定记录每个连接失败，请务必小心，因为您可能会用无用的日志条目填满机器。我们将记录第一次连接失败，除非重新启动服务，否则不会再次记录。

当然，如果您的数据库始终对您的服务来说是本地的，那么更好的解决方案是创建对数据库 windows 服务的依赖关系，但听起来您的数据库并不是本地的。

# c++ - 如何将元组扩展为可变参数模板函数的参数？

> ID：687490
> 
> 赞同：156
> 
> 时间：2009-03-26T20:43:34.027
> 
> 标签：c++, c++11, arguments, tuples

考虑具有可变模板参数的模板化函数的情况：

```
template<typename Tret, typename... T> Tret func(const T&... t); 
```

现在，我有一个`t`值元组。如何`func()`使用元组值作为参数调用？我已经阅读了有关`bind()`函数对象、`call()`函数的内容，以及`apply()`不同的一些现已过时的文档中的函数。GNU GCC 4.4 的实现似乎`call()`在类中有一个函数`bind()`，但是关于这个主题的文档很少。

有些人建议手写递归黑客，但可变参数模板参数的真正价值是能够在上述情况下使用它们。

有没有人有解决方案，或提示在哪里阅读它？

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2016-05-08T13:59:50.387

在 C++17 中，您可以这样做：

```
std::apply(the_function, the_tuple); 
```

这已经在 Clang++ 3.9 中使用，使用 std::experimental::apply。

回应评论说如果模板化这将不起作用`the_function`，以下是一种解决方法：

```
#include <tuple>

template <typename T, typename U> void my_func(T &&t, U &&u) {}

int main(int argc, char *argv[argc]) {

  std::tuple<int, float> my_tuple;

  std::apply([](auto &&... args) { my_func(args...); }, my_tuple);

  return 0;
} 
```

这种变通方法是对传递重载集和函数模板的一般问题的简化解决方案，其中需要一个函数。此处介绍了通用解决方案（一种处理完美转发、constexpr-ness 和 noexcept-ness）：[https](https://blog.tartanllama.xyz/passing-overload-sets/) ://blog.tartanllama.xyz/passing-overload-sets/ 。

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2009-10-10T05:13:01.150

如果有人感兴趣，这是我的代码

基本上在编译时，编译器将递归展开各种包含函数调用中的所有参数 <N> -> 调用 <N-1> -> 调用 ... -> 调用 <0> 这是最后一个，编译器将优化掉各种中间函数调用只保留最后一个相当于 func(arg1, arg2, arg3, ...)

提供了 2 个版本，一个用于在对象上调用的函数，另一个用于静态函数。

```
#include <tr1/tuple>

/**
 * Object Function Tuple Argument Unpacking
 *
 * This recursive template unpacks the tuple parameters into
 * variadic template arguments until we reach the count of 0 where the function
 * is called with the correct parameters
 *
 * @tparam N Number of tuple arguments to unroll
 *
 * @ingroup g_util_tuple
 */
template < uint N >
struct apply_obj_func
{
  template < typename T, typename... ArgsF, typename... ArgsT, typename... Args >
  static void applyTuple( T* pObj,
                          void (T::*f)( ArgsF... ),
                          const std::tr1::tuple<ArgsT...>& t,
                          Args... args )
  {
    apply_obj_func<N-1>::applyTuple( pObj, f, t, std::tr1::get<N-1>( t ), args... );
  }
};

//-----------------------------------------------------------------------------

/**
 * Object Function Tuple Argument Unpacking End Point
 *
 * This recursive template unpacks the tuple parameters into
 * variadic template arguments until we reach the count of 0 where the function
 * is called with the correct parameters
 *
 * @ingroup g_util_tuple
 */
template <>
struct apply_obj_func<0>
{
  template < typename T, typename... ArgsF, typename... ArgsT, typename... Args >
  static void applyTuple( T* pObj,
                          void (T::*f)( ArgsF... ),
                          const std::tr1::tuple<ArgsT...>& /* t */,
                          Args... args )
  {
    (pObj->*f)( args... );
  }
};

//-----------------------------------------------------------------------------

/**
 * Object Function Call Forwarding Using Tuple Pack Parameters
 */
// Actual apply function
template < typename T, typename... ArgsF, typename... ArgsT >
void applyTuple( T* pObj,
                 void (T::*f)( ArgsF... ),
                 std::tr1::tuple<ArgsT...> const& t )
{
   apply_obj_func<sizeof...(ArgsT)>::applyTuple( pObj, f, t );
}

//-----------------------------------------------------------------------------

/**
 * Static Function Tuple Argument Unpacking
 *
 * This recursive template unpacks the tuple parameters into
 * variadic template arguments until we reach the count of 0 where the function
 * is called with the correct parameters
 *
 * @tparam N Number of tuple arguments to unroll
 *
 * @ingroup g_util_tuple
 */
template < uint N >
struct apply_func
{
  template < typename... ArgsF, typename... ArgsT, typename... Args >
  static void applyTuple( void (*f)( ArgsF... ),
                          const std::tr1::tuple<ArgsT...>& t,
                          Args... args )
  {
    apply_func<N-1>::applyTuple( f, t, std::tr1::get<N-1>( t ), args... );
  }
};

//-----------------------------------------------------------------------------

/**
 * Static Function Tuple Argument Unpacking End Point
 *
 * This recursive template unpacks the tuple parameters into
 * variadic template arguments until we reach the count of 0 where the function
 * is called with the correct parameters
 *
 * @ingroup g_util_tuple
 */
template <>
struct apply_func<0>
{
  template < typename... ArgsF, typename... ArgsT, typename... Args >
  static void applyTuple( void (*f)( ArgsF... ),
                          const std::tr1::tuple<ArgsT...>& /* t */,
                          Args... args )
  {
    f( args... );
  }
};

//-----------------------------------------------------------------------------

/**
 * Static Function Call Forwarding Using Tuple Pack Parameters
 */
// Actual apply function
template < typename... ArgsF, typename... ArgsT >
void applyTuple( void (*f)(ArgsF...),
                 std::tr1::tuple<ArgsT...> const& t )
{
   apply_func<sizeof...(ArgsT)>::applyTuple( f, t );
}

// ***************************************
// Usage
// ***************************************

template < typename T, typename... Args >
class Message : public IMessage
{

  typedef void (T::*F)( Args... args );

public:

  Message( const std::string& name,
           T& obj,
           F pFunc,
           Args... args );

private:

  virtual void doDispatch( );

  T*  pObj_;
  F   pFunc_;
  std::tr1::tuple<Args...> args_;
};

//-----------------------------------------------------------------------------

template < typename T, typename... Args >
Message<T, Args...>::Message( const std::string& name,
                              T& obj,
                              F pFunc,
                              Args... args )
: IMessage( name ),
  pObj_( &obj ),
  pFunc_( pFunc ),
  args_( std::forward<Args>(args)... )
{

}

//-----------------------------------------------------------------------------

template < typename T, typename... Args >
void Message<T, Args...>::doDispatch( )
{
  try
  {
    applyTuple( pObj_, pFunc_, args_ );
  }
  catch ( std::exception& e )
  {

  }
} 
```

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2011-06-23T12:45:32.263

在 C++ 中有许多扩展/解包元组并将这些元组元素应用于可变参数模板函数的方法。这是一个创建索引数组的小助手类。它在模板元编程中被大量使用：

```
// ------------- UTILITY---------------
template<int...> struct index_tuple{}; 

template<int I, typename IndexTuple, typename... Types> 
struct make_indexes_impl; 

template<int I, int... Indexes, typename T, typename ... Types> 
struct make_indexes_impl<I, index_tuple<Indexes...>, T, Types...> 
{ 
    typedef typename make_indexes_impl<I + 1, index_tuple<Indexes..., I>, Types...>::type type; 
}; 

template<int I, int... Indexes> 
struct make_indexes_impl<I, index_tuple<Indexes...> > 
{ 
    typedef index_tuple<Indexes...> type; 
}; 

template<typename ... Types> 
struct make_indexes : make_indexes_impl<0, index_tuple<>, Types...> 
{}; 
```

现在完成这项工作的代码不是那么大：

```
 // ----------UNPACK TUPLE AND APPLY TO FUNCTION ---------
#include <tuple>
#include <iostream> 

using namespace std;

template<class Ret, class... Args, int... Indexes > 
Ret apply_helper( Ret (*pf)(Args...), index_tuple< Indexes... >, tuple<Args...>&& tup) 
{ 
    return pf( forward<Args>( get<Indexes>(tup))... ); 
} 

template<class Ret, class ... Args> 
Ret apply(Ret (*pf)(Args...), const tuple<Args...>&  tup)
{
    return apply_helper(pf, typename make_indexes<Args...>::type(), tuple<Args...>(tup));
}

template<class Ret, class ... Args> 
Ret apply(Ret (*pf)(Args...), tuple<Args...>&&  tup)
{
    return apply_helper(pf, typename make_indexes<Args...>::type(), forward<tuple<Args...>>(tup));
} 
```

测试如下图：

```
// --------------------- TEST ------------------
void one(int i, double d)
{
    std::cout << "function one(" << i << ", " << d << ");\n";
}
int two(int i)
{
    std::cout << "function two(" << i << ");\n";
    return i;
}

int main()
{
    std::tuple<int, double> tup(23, 4.5);
    apply(one, tup);

    int d = apply(two, std::make_tuple(2));    

    return 0;
} 
```

我不是其他语言的专家，但我想如果这些语言的菜单中没有这样的功能，就没有办法做到这一点。至少使用 C++ 你可以，而且我认为它并没有那么复杂......

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2012-09-29T05:04:55.517

我发现这是最优雅的解决方案（并且它被最佳转发）：

```
#include <cstddef>
#include <tuple>
#include <type_traits>
#include <utility>

template<size_t N>
struct Apply {
    template<typename F, typename T, typename... A>
    static inline auto apply(F && f, T && t, A &&... a)
        -> decltype(Apply<N-1>::apply(
            ::std::forward<F>(f), ::std::forward<T>(t),
            ::std::get<N-1>(::std::forward<T>(t)), ::std::forward<A>(a)...
        ))
    {
        return Apply<N-1>::apply(::std::forward<F>(f), ::std::forward<T>(t),
            ::std::get<N-1>(::std::forward<T>(t)), ::std::forward<A>(a)...
        );
    }
};

template<>
struct Apply<0> {
    template<typename F, typename T, typename... A>
    static inline auto apply(F && f, T &&, A &&... a)
        -> decltype(::std::forward<F>(f)(::std::forward<A>(a)...))
    {
        return ::std::forward<F>(f)(::std::forward<A>(a)...);
    }
};

template<typename F, typename T>
inline auto apply(F && f, T && t)
    -> decltype(Apply< ::std::tuple_size<
        typename ::std::decay<T>::type
    >::value>::apply(::std::forward<F>(f), ::std::forward<T>(t)))
{
    return Apply< ::std::tuple_size<
        typename ::std::decay<T>::type
    >::value>::apply(::std::forward<F>(f), ::std::forward<T>(t));
} 
```

示例用法：

```
void foo(int i, bool b);

std::tuple<int, bool> t = make_tuple(20, false);

void m()
{
    apply(&foo, t);
} 
```

~~不幸的是，GCC（至少 4.6）无法用“抱歉，未实现：重载重载”（这仅仅意味着编译器尚未完全实现 C++11 规范）编译它，并且由于它使用可变参数模板，它不会在 MSVC 中工作，所以它或多或少没用。但是，一旦有支持该规范的编译器，恕我直言，这将是最好的方法。（注意：修改它以解决 GCC 中的缺陷或使用 Boost Preprocessor 实现它并不难，但它破坏了优雅，所以这是我发布的版本。）~~

GCC 4.7 现在支持这个代码就好了。

编辑：在实际函数调用周围添加前向以支持右值引用形式 *this，以防您使用 clang（或者如果其他人实际上可以添加它）。

编辑：在非成员应用函数主体中的函数对象周围添加了缺少的前向。感谢 pheedbaq 指出它丢失了。

编辑：这里是 C++14 版本，因为它更好（实际上还没有编译）：

```
#include <cstddef>
#include <tuple>
#include <type_traits>
#include <utility>

template<size_t N>
struct Apply {
    template<typename F, typename T, typename... A>
    static inline auto apply(F && f, T && t, A &&... a) {
        return Apply<N-1>::apply(::std::forward<F>(f), ::std::forward<T>(t),
            ::std::get<N-1>(::std::forward<T>(t)), ::std::forward<A>(a)...
        );
    }
};

template<>
struct Apply<0> {
    template<typename F, typename T, typename... A>
    static inline auto apply(F && f, T &&, A &&... a) {
        return ::std::forward<F>(f)(::std::forward<A>(a)...);
    }
};

template<typename F, typename T>
inline auto apply(F && f, T && t) {
    return Apply< ::std::tuple_size< ::std::decay_t<T>
      >::value>::apply(::std::forward<F>(f), ::std::forward<T>(t));
} 
```

这是成员函数的一个版本（没有经过太多测试！）：

```
using std::forward; // You can change this if you like unreadable code or care hugely about namespace pollution.

template<size_t N>
struct ApplyMember
{
    template<typename C, typename F, typename T, typename... A>
    static inline auto apply(C&& c, F&& f, T&& t, A&&... a) ->
        decltype(ApplyMember<N-1>::apply(forward<C>(c), forward<F>(f), forward<T>(t), std::get<N-1>(forward<T>(t)), forward<A>(a)...))
    {
        return ApplyMember<N-1>::apply(forward<C>(c), forward<F>(f), forward<T>(t), std::get<N-1>(forward<T>(t)), forward<A>(a)...);
    }
};

template<>
struct ApplyMember<0>
{
    template<typename C, typename F, typename T, typename... A>
    static inline auto apply(C&& c, F&& f, T&&, A&&... a) ->
        decltype((forward<C>(c)->*forward<F>(f))(forward<A>(a)...))
    {
        return (forward<C>(c)->*forward<F>(f))(forward<A>(a)...);
    }
};

// C is the class, F is the member function, T is the tuple.
template<typename C, typename F, typename T>
inline auto apply(C&& c, F&& f, T&& t) ->
    decltype(ApplyMember<std::tuple_size<typename std::decay<T>::type>::value>::apply(forward<C>(c), forward<F>(f), forward<T>(t)))
{
    return ApplyMember<std::tuple_size<typename std::decay<T>::type>::value>::apply(forward<C>(c), forward<F>(f), forward<T>(t));
} 
```

```
// Example:

class MyClass
{
public:
    void foo(int i, bool b);
};

MyClass mc;

std::tuple<int, bool> t = make_tuple(20, false);

void m()
{
    apply(&mc, &MyClass::foo, t);
} 
```

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2013-09-27T21:13:24.413

```
template<typename F, typename Tuple, std::size_t ... I>
auto apply_impl(F&& f, Tuple&& t, std::index_sequence<I...>) {
    return std::forward<F>(f)(std::get<I>(std::forward<Tuple>(t))...);
}
template<typename F, typename Tuple>
auto apply(F&& f, Tuple&& t) {
    using Indices = std::make_index_sequence<std::tuple_size<std::decay_t<Tuple>>::value>;
    return apply_impl(std::forward<F>(f), std::forward<Tuple>(t), Indices());
} 
```

这是使用 index_sequence 从 C++14 草案改编而来的。我可能会建议在未来的标准 (TS) 中应用。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-07-17T13:01:15.993

所有这些实现都很好。但是由于使用指向成员函数的指针编译器往往不能内联目标函数调用（至少gcc 4.8不能，不管[为什么gcc不能内联可以确定的函数指针？](https://stackoverflow.com/q/10047448/1559666)）

但是如果将指向成员函数的指针作为模板参数而不是函数参数发送，情况就会发生变化：

```
/// from https://stackoverflow.com/a/9288547/1559666
template<int ...> struct seq {};
template<int N, int ...S> struct gens : gens<N-1, N-1, S...> {};
template<int ...S> struct gens<0, S...>{ typedef seq<S...> type; };

template<typename TT>
using makeSeq = typename gens< std::tuple_size< typename std::decay<TT>::type >::value >::type;

// deduce function return type
template<class ...Args>
struct fn_type;

template<class ...Args>
struct fn_type< std::tuple<Args...> >{

    // will not be called
    template<class Self, class Fn>
    static auto type_helper(Self &self, Fn f) -> decltype((self.*f)(declval<Args>()...)){
        //return (self.*f)(Args()...);
        return NULL;
    }
};

template<class Self, class ...Args>
struct APPLY_TUPLE{};

template<class Self, class ...Args>
struct APPLY_TUPLE<Self, std::tuple<Args...>>{
    Self &self;
    APPLY_TUPLE(Self &self): self(self){}

    template<class T, T (Self::* f)(Args...),  class Tuple>
    void delayed_call(Tuple &&list){
        caller<T, f, Tuple >(forward<Tuple>(list), makeSeq<Tuple>() );
    }

    template<class T, T (Self::* f)(Args...), class Tuple, int ...S>
    void caller(Tuple &&list, const seq<S...>){
        (self.*f)( std::get<S>(forward<Tuple>(list))... );
    }
};

#define type_of(val) typename decay<decltype(val)>::type

#define apply_tuple(obj, fname, tuple) \
    APPLY_TUPLE<typename decay<decltype(obj)>::type, typename decay<decltype(tuple)>::type >(obj).delayed_call< \
            decltype( fn_type< type_of(tuple) >::type_helper(obj, &decay<decltype(obj)>::type::fname) ), \
            &decay<decltype(obj)>::type::fname \
            > \
            (tuple); 
```

和用法：

```
struct DelayedCall
{  
    void call_me(int a, int b, int c){
        std::cout << a+b+c;
    }

    void fire(){
        tuple<int,int,int> list = make_tuple(1,2,3);
        apply_tuple(*this, call_me, list); // even simpler than previous implementations
    }
}; 
```

可内联证明[http://goo.gl/5UqVnC](http://goo.gl/5UqVnC)

* * *

通过小的改动，我们可以“重载” `apply_tuple`：

```
#define VA_NARGS_IMPL(_1, _2, _3, _4, _5, _6, _7, _8, N, ...) N
#define VA_NARGS(...) VA_NARGS_IMPL(X,##__VA_ARGS__, 7, 6, 5, 4, 3, 2, 1, 0)
#define VARARG_IMPL_(base, count, ...) base##count(__VA_ARGS__)
#define VARARG_IMPL(base, count, ...) VARARG_IMPL_(base, count, __VA_ARGS__)
#define VARARG(base, ...) VARARG_IMPL(base, VA_NARGS(__VA_ARGS__), __VA_ARGS__)

#define apply_tuple2(fname, tuple) apply_tuple3(*this, fname, tuple)
#define apply_tuple3(obj, fname, tuple) \
    APPLY_TUPLE<typename decay<decltype(obj)>::type, typename decay<decltype(tuple)>::type >(obj).delayed_call< \
            decltype( fn_type< type_of(tuple) >::type_helper(obj, &decay<decltype(obj)>::type::fname) ), \
            &decay<decltype(obj)>::type::fname \
            /* ,decltype(tuple) */> \
            (tuple);
#define apply_tuple(...) VARARG(apply_tuple, __VA_ARGS__)

...

apply_tuple(obj, call_me, list);
apply_tuple(call_me, list);       // call this->call_me(list....) 
```

* * *

此外，这是唯一一种适用于模板化函数的解决方案。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-26T21:56:21.683

这个消息看起来不太好。

在阅读了[刚刚发布的标准草案](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2009/n2857.pdf)后，我没有看到对此的内置解决方案，这看起来确实很奇怪。

询问此类问题的最佳位置（如果您还没有）是 comp.lang.c++.moderated，因为有些人经常参与起草标准帖子。

如果您查看[此线程](http://groups.google.com/group/comp.lang.c++.moderated/browse_thread/thread/750fa3815cdaac45/d8dc09e34bbb9661?lnk=gst&q=tuple+variadic#d8dc09e34bbb9661)，有人有同样的问题（也许是您，在这种情况下，您会发现整个答案有点令人沮丧！），并建议了一些丑陋的实现。

我只是想知道让函数接受 a 是否会更简单`tuple`，因为这种方式的转换更容易。但这意味着所有函数都应该接受元组作为参数，以获得最大的灵活性，因此这只是证明了不提供元组的内置扩展到函数参数包的奇怪之处。

更新：上面的链接不起作用 - 尝试粘贴：

[http://groups.google.com/group/comp.lang.c++.moderated/browse_thread/thread/750fa3815cdaac45/d8dc09e34bbb9661?lnk=gst&q=tuple+variadic#d8dc09e34bbb9661](http://groups.google.com/group/comp.lang.c++.moderated/browse_thread/thread/750fa3815cdaac45/d8dc09e34bbb9661?lnk=gst&q=tuple+variadic#d8dc09e34bbb9661)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-05-14T14:07:48.037

1）如果你有一个现成的 parameter_pack 结构作为函数参数，你可以像这样使用 std::tie ：

```
template <class... Args>
void tie_func(std::tuple<Args...> t, Args&... args)
{
 std::tie<Args...>(args...) = t;
}

int main()
{
 std::tuple<int, double, std::string> t(2, 3.3, "abc");

 int i;
 double d;
 std::string s;

 tie_func(t, i, d, s);

 std::cout << i << " " << d << " " << s << std::endl;
} 
```

2）如果您没有现成的 parampack arg，则必须像这样展开元组

```
#include <tuple>
#include <functional>
#include <iostream>

template<int N>
struct apply_wrap {
    template<typename R, typename... TupleArgs, typename... UnpackedArgs>
    static R applyTuple( std::function<R(TupleArgs...)>& f, const std::tuple<TupleArgs...>& t, UnpackedArgs... args )
    {
        return apply_wrap<N-1>::applyTuple( f, t, std::get<N-1>( t ), args... );
    }
};

template<>
struct apply_wrap<0>
{
    template<typename R, typename... TupleArgs, typename... UnpackedArgs>
    static R applyTuple( std::function<R(TupleArgs...)>& f, const std::tuple<TupleArgs...>&, UnpackedArgs... args )
    {
        return f( args... );
    }
};

template<typename R, typename... TupleArgs>
R applyTuple( std::function<R(TupleArgs...)>& f, std::tuple<TupleArgs...> const& t )
{
    return apply_wrap<sizeof...(TupleArgs)>::applyTuple( f, t );
}

int fac(int n)
{
    int r=1;
    for(int i=2; i<=n; ++i)
        r *= i;
    return r;
}

int main()
{
    auto t = std::make_tuple(5);
    auto f = std::function<decltype(fac)>(&fac);
    cout << applyTuple(f, t);
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-04-29T09:22:54.273

这个怎么样：

```
// Warning: NOT tested!
#include <cstddef>
#include <tuple>
#include <type_traits>
#include <utility>

using std::declval;
using std::forward;
using std::get;
using std::integral_constant;
using std::size_t;
using std::tuple;

namespace detail
{
    template < typename Func, typename ...T, typename ...Args >
    auto  explode_tuple( integral_constant<size_t, 0u>, tuple<T...> const &t,
     Func &&f, Args &&...a )
     -> decltype( forward<Func>(f)(declval<T const>()...) )
    { return forward<Func>( f )( forward<Args>(a)... ); }

    template < size_t Index, typename Func, typename ...T, typename ...Args >
    auto  explode_tuple( integral_constant<size_t, Index>, tuple<T...> const&t,
     Func &&f, Args &&...a )
     -> decltype( forward<Func>(f)(declval<T const>()...) )
    {
        return explode_tuple( integral_constant<size_t, Index - 1u>{}, t,
         forward<Func>(f), get<Index - 1u>(t), forward<Args>(a)... );
    }
}

template < typename Func, typename ...T >
auto  run_tuple( Func &&f, tuple<T...> const &t )
 -> decltype( forward<Func>(f)(declval<T const>()...) )
{
    return detail::explode_tuple( integral_constant<size_t, sizeof...(T)>{}, t,
     forward<Func>(f) );
}

template < typename Tret, typename ...T >
Tret  func_T( tuple<T...> const &t )
{ return run_tuple( &func<Tret, T...>, t ); } 
```

函数模板采用给定的`run_tuple`元组并将其元素单独传递给给定的函数。它通过递归调用其辅助函数模板来执行其工作`explode_tuple`。`run_tuple`将元组的大小传递给`explode_tuple`;是很重要的。该数字充当要提取多少元素的计数器。

如果元组为空，则`run_tuple`调用第一个版本`explode_tuple`的远程函数作为唯一的其他参数。不带参数调用远程函数，我们就完成了。如果元组不为空，则将更大的数字`explode_tuple`与远程函数一起传递给 的第二个版本。递归调用`explode_tuple`使用相同的参数进行创建，除了计数器编号减一并且（对）最后一个元组元素的引用作为远程函数之后的参数。在递归调用中，计数器不为零，并且在计数器再次减小的情况下进行另一个调用，并且下一个未引用的元素被插入到远程函数之后但在其他插入的参数之前的参数列表中，或者计数器达到零，并调用远程函数，并在其后累积*所有参数。*

我不确定我是否有强制使用特定版本的函数模板的语法。我认为您可以将指向函数的指针用作函数对象；编译器会自动修复它。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-10-15T18:45:23.107

我正在评估 MSVS 2013RC，它在某些情况下未能编译此处提出的一些先前解决方案。例如，如果函数参数过多，MSVS 将无法编译“自动”返回，因为命名空间重叠限制（我将该信息发送给 Microsoft 以进行更正）。在其他情况下，我们需要访问函数的返回值，尽管这也可以使用 lamda 来完成：以下两个示例给出了相同的结果。

```
apply_tuple([&ret1](double a){ret1 = cos(a); }, std::make_tuple<double>(.2));
ret2 = apply_tuple((double(*)(double))cos, std::make_tuple<double>(.2)); 
```

再次感谢那些在我之前在这里发布答案的人，如果没有它，我将无法做到这一点......所以这里是：

```
template<size_t N>
struct apply_impl {
    template<typename F, typename T, typename... A>
    static inline auto apply_tuple(F&& f, T&& t, A&&... a)
    -> decltype(apply_impl<N-1>::apply_tuple(std::forward<F>(f), std::forward<T>(t),
                          std::get<N-1>(std::forward<T>(t)), std::forward<A>(a)...)) {
         return apply_impl<N-1>::apply_tuple(std::forward<F>(f), std::forward<T>(t),
                          std::get<N-1>(std::forward<T>(t)), std::forward<A>(a)...);
    }
    template<typename C, typename F, typename T, typename... A>
    static inline auto apply_tuple(C*const o, F&& f, T&& t, A&&... a)
    -> decltype(apply_impl<N-1>::apply_tuple(o, std::forward<F>(f), std::forward<T>(t),
                          std::get<N-1>(std::forward<T>(t)), std::forward<A>(a)...)) {
         return apply_impl<N-1>::apply_tuple(o, std::forward<F>(f), std::forward<T>(t),
                          std::get<N-1>(std::forward<T>(t)), std::forward<A>(a)...);
    }
};

// This is a work-around for MSVS 2013RC that is required in some cases
#if _MSC_VER <= 1800 /* update this when bug is corrected */
template<>
struct apply_impl<6> {
    template<typename F, typename T, typename... A>
    static inline auto apply_tuple(F&& f, T&& t, A&&... a)
    -> decltype(std::forward<F>(f)(std::get<0>(std::forward<T>(t)), std::get<1>(std::forward<T>(t)), std::get<2>(std::forward<T>(t)),
           std::get<3>(std::forward<T>(t)), std::get<4>(std::forward<T>(t)), std::get<5>(std::forward<T>(t)), std::forward<A>(a)...)) {
         return std::forward<F>(f)(std::get<0>(std::forward<T>(t)), std::get<1>(std::forward<T>(t)), std::get<2>(std::forward<T>(t)),
           std::get<3>(std::forward<T>(t)), std::get<4>(std::forward<T>(t)), std::get<5>(std::forward<T>(t)), std::forward<A>(a)...);
    }
    template<typename C, typename F, typename T, typename... A>
    static inline auto apply_tuple(C*const o, F&& f, T&& t, A&&... a)
    -> decltype((o->*std::forward<F>(f))(std::get<0>(std::forward<T>(t)), std::get<1>(std::forward<T>(t)), std::get<2>(std::forward<T>(t)),
           std::get<3>(std::forward<T>(t)), std::get<4>(std::forward<T>(t)), std::get<5>(std::forward<T>(t)), std::forward<A>(a)...)) {
         return (o->*std::forward<F>(f))(std::get<0>(std::forward<T>(t)), std::get<1>(std::forward<T>(t)), std::get<2>(std::forward<T>(t)),
           std::get<3>(std::forward<T>(t)), std::get<4>(std::forward<T>(t)), std::get<5>(std::forward<T>(t)), std::forward<A>(a)...);
    }
};
#endif

template<>
struct apply_impl<0> {
    template<typename F, typename T, typename... A>
    static inline auto apply_tuple(F&& f, T&&, A&&... a)
    -> decltype(std::forward<F>(f)(std::forward<A>(a)...)) {
         return std::forward<F>(f)(std::forward<A>(a)...);
    }
    template<typename C, typename F, typename T, typename... A>
    static inline auto apply_tuple(C*const o, F&& f, T&&, A&&... a)
    -> decltype((o->*std::forward<F>(f))(std::forward<A>(a)...)) {
         return (o->*std::forward<F>(f))(std::forward<A>(a)...);
    }
};

// Apply tuple parameters on a non-member or static-member function by perfect forwarding
template<typename F, typename T>
inline auto apply_tuple(F&& f, T&& t)
-> decltype(apply_impl<std::tuple_size<typename std::decay<T>::type>::value>::apply_tuple(std::forward<F>(f), std::forward<T>(t))) {
     return apply_impl<std::tuple_size<typename std::decay<T>::type>::value>::apply_tuple(std::forward<F>(f), std::forward<T>(t));
}

// Apply tuple parameters on a member function
template<typename C, typename F, typename T>
inline auto apply_tuple(C*const o, F&& f, T&& t)
-> decltype(apply_impl<std::tuple_size<typename std::decay<T>::type>::value>::apply_tuple(o, std::forward<F>(f), std::forward<T>(t))) {
     return apply_impl<std::tuple_size<typename std::decay<T>::type>::value>::apply_tuple(o, std::forward<F>(f), std::forward<T>(t));
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-10-31T19:33:01.420

扩展@David 的解决方案，您可以编写一个递归模板

1.  不使用 (overly-verbose, imo)`integer_sequence`语义
2.  不使用额外的临时模板参数`int N`来计算递归迭代
3.  （对于静态/全局仿函数可选）使用仿函数作为编译时优化的模板参数

例如：

```
template <class F, F func>
struct static_functor {
    template <class... T, class... Args_tmp>
    static inline auto apply(const std::tuple<T...>& t, Args_tmp... args)
            -> decltype(func(std::declval<T>()...)) {
        return static_functor<F,func>::apply(t, args...,
                std::get<sizeof...(Args_tmp)>(t));
    }
    template <class... T>
    static inline auto apply(const std::tuple<T...>& t, T... args)
            -> decltype(func(args...)) {
        return func(args...);
    }
};

static_functor<decltype(&myFunc), &myFunc>::apply(my_tuple); 
```

或者，如果您的仿函数未在编译时定义（例如，非`constexpr`仿函数实例或 lambda 表达式），您可以将其用作函数参数而不是类模板参数，实际上完全删除包含类：

```
template <class F, class... T, class... Args_tmp>
inline auto apply_functor(F&& func, const std::tuple<T...>& t,
        Args_tmp... args) -> decltype(func(std::declval<T>()...)) {
    return apply_functor(func, t, args..., std::get<sizeof...(Args_tmp)>(t));
}
template <class F, class... T>
inline auto apply_functor(F&& func, const std::tuple<T...>& t,
        T... args) -> decltype(func(args...)) {
    return func(args...);
}

apply_functor(&myFunc, my_tuple); 
```

对于指向成员函数的可调用指针，您可以像@David 的回答一样调整上述任一代码片段。

**解释**

参考第二段代码，有两个模板函数：第一个接受函子、带类型`func`的元组和类型的参数包。当被调用时，它递归地将对象 from一次添加到参数包中，从开始 ( ) 到结束，并使用新的递增参数包再次调用该函数。`t``T...``args``Args_tmp...``t``0`

第二个函数的签名几乎与第一个相同，只是它使用 type`T...`作为参数 pack `args`。因此，一旦`args`在第一个函数中完全填充了来自 的值`t`，它的类型将是`T...`（在伪代码中，`typeid(T...) == typeid(Args_tmp...)`），因此编译器将改为调用第二个重载函数，该函数又调用`func(args...)`.

静态函子示例中的代码工作方式相同，只是函子用作类模板参数。

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2012-02-04T05:27:49.700

为什么不将可变参数包装到一个元组类中，然后使用编译时递归（参见[链接](https://stackoverflow.com/questions/6245735/pretty-print-stdtuple)）来检索您感兴趣的索引。我发现将可变参数模板解包到容器或集合中可能不是类型安全的异构类型

```
template<typename... Args>
auto get_args_as_tuple(Args... args) -> std::tuple<Args...> 
{
    return std::make_tuple(args);
} 
```

* * *

## 回答 #13

> 赞同：-4
> 
> 时间：2014-06-12T15:06:02.737

这个简单的解决方案对我有用：

```
template<typename... T>
void unwrap_tuple(std::tuple<T...>* tp)
{
    std::cout << "And here I have the tuple types, all " << sizeof...(T) << " of them" << std::endl;
}

int main()
{
    using TupleType = std::tuple<int, float, std::string, void*>;

    unwrap_tuple((TupleType*)nullptr); // trick compiler into using template param deduction
} 
```

# java - OSGi 包的包结构

> ID：687491
> 
> 赞同：7
> 
> 时间：2009-03-26T20:43:59.317
> 
> 标签：java, osgi, modularization

我一直在思考关于 osgi 包中包结构的“良好实践”。目前，我们平均每个捆绑包有 8-12 个类。我的一项倡议/建议是有两个包裹；com.company_name.osgi.services.api（用于与 api 相关的类/接口（外部导出）和一个包 com.company_name.osgi.services.impl 用于实现（未导出））。这有什么好处和坏处？还有其他建议吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-26T21:53:24.657

您也可以考虑将接口放在 中`com.company_name.subsystem`，而实现则放在`com.company_name.subsystem.impl`OSGI 特定代码中，如果有的话，可以放在`com.company_name.subsystem.osgi`. 有时您可能有多个相同接口的实现。在这种情况下，您可以考虑 -`com.company_name.subsystem.impl1`和`com.company_name.subsystem.impl2`，例如：

```
com.company.scm        // the scm api
com.company.scm.git    // its git implementaton
com.company.scm.svn    // its subversion implementation
com.company.scm.osgi   // the place to put an OSGI Activator 
```

从这个意义上说，包结构可能与 OSGi 无关，如果您稍后移动到不同的容器，您只需添加一个额外的

```
com.company.scm.sca     // or whatever component model you might think of 
```

总是在你的包名中有`api`and`impl`可能很烦人。如果有疑问使用`impl`但不使用`api`.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T20:57:54.990

重要的不是类的数量，而是概念。在我看来，您应该在捆绑中包含一个概念实体。在某些情况下，这可能只是其他几个包含 100 个类的包中的几个类。

重要的是您将 API 和实现分开。一个包包含您的概念的 API，另一个包包含实现。像这样，您可以为定义良好的 API 提供不同的实现。在某些情况下，如果您想远程访问捆绑包中的服务（例如使用 R-OGSi），这甚至可能是必要的

然后，API 包由代码共享使用，实现包中的服务由服务共享使用。探索这些可能性的最佳方法是查看 ServiceTracker。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T08:43:35.263

在您的情况下，您可以在同一个包中实现，但它的所有类都“包保护”。这样，您可以导出包，并且即使不使用 OSGi（但作为常规 jar 文件），外部也不会看到实现。

# javascript - 有没有办法让两个 jQuery 动画同时（正确）运行？

> ID：687495
> 
> 赞同：7
> 
> 时间：2009-03-26T20:45:15.693
> 
> 标签：javascript, jquery, animation

我有一个调用两个动画动作的事件监听器。不幸的是，它们的开始有少量错开（例如，函数中的第一个首先开始）。

有谁知道正确同步它们的方法？

这是我的代码：

```
$("#nav ul li a").hover(
    function(){
        $(lastBlock).children("div").animate({width: "0px"}, { queue:false, duration:400, easing:"swing" });
        $(this).children("div").animate({width: maxWidth+"px"}, { queue:false, duration:400, easing:"swing"});
        lastBlock = this;
    }
); 
```

因为第一个动画在第二个之前运行，它会导致整体宽度暂时变得不相等，这看起来有点时髦。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-26T20:49:10.863

最近在 jQuery 开发者列表上有一个关于这个确切主题的讨论。他们创建了一些您可能想看的[测试用例。](http://jqueryjs.googlecode.com/svn/trunk/plugins/sync-animations/)[特别是约翰斯测试。](http://jqueryjs.googlecode.com/svn/trunk/plugins/sync-animations/johns.html)

[这是](http://groups.google.com/group/jquery-dev/browse_thread/thread/8319a8d4e63a5b65?pli=1)讨论主题顺便说一句。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-07-25T15:23:18.087

诀窍是有一个更新所有元素的间隔/回调。您可以在我的帖子中找到一个示例：

[我可以在 jQuery 中为每个动画步骤实现回调吗？](https://stackoverflow.com/questions/1361275/can-i-implement-a-callback-with-each-animation-step-in-jquery/1846118#1846118)

你最终得到的基本上是：

```
var el1 = $("#element1");
var el2 = $("#element2");

var animation = new AnimationTimeline( {
    easing: "swing"
  , onstep: function( stepValue, animprops )
    {
      // This is called for every animation frame. Set the elements:
      el1.css( { left: ..., top: ... } );
      el2.css( { left: ..., top: ... } );
    }
  });

// And start it.
animation.start(); 
```

# project-management - 团队内的信息/知识流

> ID：687509
> 
> 赞同：7
> 
> 时间：2009-03-26T20:51:09.097
> 
> 标签：project-management, agile, pair-programming

我想避免我的开发人员彼此不分享共同知识（他们遇到的问题的解决方案、酷提示、常见错误、实现特定目标的捷径、配置问题、部分要求等）的情况。我正在考虑这种缺乏沟通是偶然的情况（由于误解或管理不当） - 我没有考虑开发人员故意为自己保留知识的情况。

我相信以下技术对于改进开发人员团队中的信息流非常有用：

*   XP 结对编程 - 由于结对内的知识交流（以及由于常规结对混合）。
*   站立会议——因为有机会告诉其他人你在做什么以及你遇到了什么问题。
*   由主要开发人员为团队/部门的其他成员准备的培训/演示/指导。
*   “web 2.0 工具”——公司/部门的技术博客、团队负责人的专用 Twitter 帐户、wiki 和类似的东西。

还有什么想法吗？您在公司中使用（或使用过）什么技术？您将如何鼓励开发人员在他们之间分享知识？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-26T21:00:21.880

相信。

您可以“看起来很愚蠢”，但请*询问*您是否不知道或不完全理解我在说什么。如果我错了，请告诉我（我没有意识到，因为我同样愚蠢。）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-26T21:03:12.203

我在一家公司工作，每周五我们都会为开发人员举行午餐会议。管理层将提供食物，而开发人员必须分享他们的知识；展示最近学到的一些工具或技术，或演示您正在从事的项目等。它不限于当时团队正在使用的技术，鼓励开发人员学习新技术和给团队一个演示。

在我目前的工作中，我们每月举行一次 IT 小组会议，有时来自不同团队的开发人员会展示他们一直在从事的项目。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T21:16:30.673

1.  一个内部 twitter-esque 实用程序。如果你可以让它工作，也许是一个 wiki，我个人觉得它有点太多了。但推特不同。“只是添加了一个扩展方法来逃避 rowfilter 中的 like 子句”和类似的东西。

2.  有些人可能会觉得它有点霸道，但它是实用程序的常见位置，因此您知道在哪里查找，并且 string.CountOccurrences 不会分散在整个代码库中。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-26T21:18:48.950

我再补充几个

*   雇用合适的人 - 如果你想创造一个伟大的动态，这是必不可少的（不爱社交的人需要更多的努力）
*   验尸和验尸。为此，我们使用 wiki，为您的每个项目创建一个页面，将其拆分为重复性事物（商品和坏事）的部分。在每个里程碑结束时，让团队开会进行事后分析。在项目结束时（或经过一段时间的修复），让项目协调员将其编译成易于后代阅读的内容（并将其放在您的 wiki 上）
*   每日站立是必须的！你已经说过了，但我觉得它很有帮助！
*   如果您在公司中有多个团队，请组织关于他们最大成就之一的会议。如果可能定期进行，甚至在整个部门，您会惊讶于艺术家如何对程序员的工作感兴趣。
*   午餐是分享的好时机，在我们公司我们有总裁早餐，项目领导午餐，项目结束晚餐。我喜欢它们，混合搭配以获得更好的效果。
*   与整个公司的非现场会议很棒，我们每年至少进行一次（早上我们介绍未来的发展，下午是了解项目的活动）
*   Wiki 很棒，但要注意随着时间的推移可能会变成虚假的信息（这是任何书面信息都会出现的问题）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-26T23:29:17.547

我想到的还有几件事：

*   模式和实践会议——不一定每周都举行，但应该有一些时间专门用于团队可以讨论各种悬而未决的问题，并对可能让很多人头疼的事情达成共识。

*   文化因素——工作场所是否提供足够的社交活动来帮助团队凝聚，或者一些团队建设练习，例如障碍训练或一起做饭，是否有助于建立一些动力。开发人员之间是否有谦逊的态度，这样就不会有可能成为问题的自负。这里的另一个因素是考虑你会如何回答这个问题：你会去当地的酒吧和你的队友一起喝一杯吗？如果是，那么您在这里有一些好处，如果不是，那么可能需要在这里进行一些调查。

*   回顾性跟进 - 在回顾性过程中如何考虑和实施想法？一般如何处理会议？

*   团队内的演示 - 如果某个故事已经完成并涉及一些大代码点，那么也许应该对此进行一些演示，以便团队查看已完成的工作并允许其他人查看已完成的工作，以便传播知识大约。这可以与我的第一点相吻合，因为它有助于进一步沟通。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-26T21:00:39.587

我非常支持结对工作。这是传递知识和保持沟通渠道畅通的好方法。尝试混合每个项目的配对。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-26T21:15:58.193

我尝试了很多方法，并且非常喜欢在项目中结对工作，以及与团队进行定期讨论或会议。

然而，我也发现我能做的最好的事情就是培养开发人员之间不断沟通的文化。我尝试让我的所有开发人员在工作时相互交流——甚至不必等到每周或每月的会议。

对我来说，这有点棘手，因为我的大多数开发人员不在同一个位置，所以我们有一个 XMPP 聊天室设置，并且在我们处理项目时我们所有人都始终处于登录状态。一些开发人员（包括我自己）也会在我们的下班时间登录。

我对我办公室里的人也这样做——我们往往是一群相当安静的人，但我很愿意让人们用问题打断对方，或者随时找一张椅子坐下来进行头脑风暴。

不过，这样做的部分原因是我尽量不将交流限制在手头的工作或任何特定项目上。我的感觉是人们会谈论其他与工作无关的事情，无论我是否鼓励这样做。不过，我宁愿在官方频道上谈论“饮水机”，而不是在外面。

这让每个人都更放心地提出“似乎很明显”的问题。此外，人们不断地提出问题，因为他们就在那里，并且习惯于与每个人交谈。如果需要，很容易忽略，但也更容易抛出一个一般性问题，看看是否有人有想法而不会感到痛苦等。

我的经验是，因中断而损失的时间远小于由于拥有一个总是渴望帮助解决手头问题的团队而节省的时间。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-26T21:17:38.500

如果你有一个足够小的团队，使用足够的 SVN 提交评论，并利用它们生成 RSS 提要的工具（例如 Trac）可能是促进沟通的一种简单有效的方式。

这样做有几个要求，很容易达到： - 经常提交（这本身就很好，因为它允许每个人从每个程序员的本地更改中受益，并及早发现问题）；- 使用详细的注释（这很好，因为它可以更轻松地跟踪更改的内容，以防万一发生故障）；- 确保每个人都实际阅读（更好的是，通过 RSS 阅读器保持发布）这些提要。

当然，这样的评论是没有办法“回复”的，但如果真的有人需要回复，那很可能是那个人和提交者之间的事情，所以邮件通常就足够了。

另一个有用的工具是要求每个开发人员，比方说，每周一次，就他/她真正熟悉的主题为其他编码人员写一个 10 左右的建议要点列表。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-27T09:24:51.280

时间。

## 官方的

走出你尘土飞扬的办公室来清理你的思绪，真正花时间去听讲座或培训，这一切都有助于传播知识。

预算也很容易：N 个开发人员开会 T 小时。

## 非官方

“在职”培训...您的特定工作所需的东西只能由了解该工作的人教授。

在当前的气候下，在当前的压力下（必须*立即*发货），没有人需要时间来完全解释某件事。只有当人们放松时，他们才准备好进行信息共享。当人们有足够的时间时，他们就会放松。

除此之外，您需要在*真正*开始考虑之前遇到一些特定的链接器错误。没有*时间*思考、提问、阅读，你将无法获得知识。您不能将其推迟到官方的链接器培训。

预算更难：开发人员 Mary 用一个半小时向开发人员 Sophie 询问了动态链接。第二天，她带着一些问题回去了。经验丰富的开发人员将花费更多时间进行分发，而年轻的开发人员将需要更多时间学习。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-03-27T18:29:09.957

*   没有墙壁 - 让您的所有开发人员都在一个没有墙壁的大房间里 - 每个人都可以看到并互相交谈。
*   共同目标 - 确保您的团队对目标有很好的理解，包括自我提升的目标
*   奖励 - 奖励 - 即使只是沟通 - 加强你想要完成的事情

社会化和共同目标总是鼓励信息交流。

# oracle - 如何在 Oracle 中获得最大可能日期？

> ID：687510
> 
> 赞同：26
> 
> 时间：2009-03-26T20:51:30.763
> 
> 标签：oracle, function, date, max

Oracle 中是否有一个函数可以返回可能插入到日期字段中的最高日期？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-03-26T20:57:59.080

```
SELECT  TO_DATE('31.12.9999 23:59:59', 'dd.mm.yyyy hh24:mi:ss')
FROM    dual 
```

请注意，最小日期要简单得多：

```
SELECT  TO_DATE(1, 'J')
FROM    dual 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-26T21:02:11.610

来自 11g 文档：

Oracle 数据库可以存储儒略时代的日期，范围从公元前 4712 年 1 月 1 日到公元 9999 年 12 月 31 日（共同时代，或“公元”）。

[http://download.oracle.com/docs/cd/B28359_01/server.111/b28318/datatype.htm#i1847](http://download.oracle.com/docs/cd/B28359_01/server.111/b28318/datatype.htm#i1847)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T20:58:47.687

我不知道一个功能，但根据[这篇文章](http://www.ss64.com/orasyntax/datatypes.html)：

> **Oracle 7：**从公元前 4712 年 1 月 1 日到公元 4712 年 12 月 31 日。
> **Oracle 8：**从公元前 4712 年 1 月 1 日到公元 9999 年 12 月 31 日。
> **Oracle 9：**从公元前 4712 年 1 月 1 日到公元 9999 年 12 月 31 日。
> **PL/SQL：**从公元前 4712 年 1 月 1 日到公元 9999 年 12 月 31 日。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-26T22:50:30.510

另一种方式，只是为了好玩：

```
SELECT to_date(5373484, 'J') + (1 - 1/24/60/60)
  FROM dual;

SELECT date '9999-12-31' + (1 - 1/24/60/60) 
  FROM dual; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-03-02T22:02:50.693

在 Julian 格式 (JDDD) 中，最大 Oracle 日期为 2086307365。

# html - HTML 中的选框

> ID：687523
> 
> 赞同：0
> 
> 时间：2009-03-26T20:58:08.393
> 
> 标签：html, marquee

我将如何在 html 中制作选框？我可以定义所有内容，即速度、循环、文本颜色、背景颜色、方向等。只用 html 还是我需要知道另一种语言来定义这些方面？我也可以在选框中实现图像吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-26T20:59:42.867

[你不想使用那个标签](http://en.wikipedia.org/wiki/Marquee_tag)。真的。[这是邪恶的](http://www.webdesignfromscratch.com/html-tag-reference/html-marquee-tag.php)。

有关替代方案，请查看：

*   [丝般光滑的选框](http://remysharp.com/2008/09/10/the-silky-smooth-marquee/)
*   [jScroller2](http://jscroller2.markusbordihn.de/example/)
*   [跨浏览器选框](http://javascript.about.com/library/bltick2.htm)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T21:00:50.617

@Paolo 是正确的，您可能还想研究做类似事情但功能更多的工具。[以 jScroller](http://jscroller.markusbordihn.de/)为例。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T21:00:53.970

您可以在选框标签中制作图像：

[http://jdstiles.com/java/scrollers/scrollingimage.html](http://jdstiles.com/java/scrollers/scrollingimage.html)

但这不是一个好用的标签。选择执行此操作的众多 javascript 库之一，例如允许您设置所有您喜欢的参数的[跨浏览器选框。](http://nuclearscripts.com/javascript/scripts-and-programs/text-effects/cross-browser-marquee.html)

-亚当

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T21:02:04.467

像这样的东西：

```
<MARQUEE id=Marquee2 title="" 
style="BORDER-RIGHT: 1px; BORDER-TOP: 1px; PADDING-LEFT: 3px; Z-INDEX: 2; OVERFLOW: hidden; BORDER-LEFT: 1px; WIDTH: 5.197in; TEXT-INDENT: 0px; BORDER-BOTTOM: 1px; HEIGHT: 0.156in" 
trueSpeed scrollDelay=150 MsoTextAlign="General">My Text Goes Here</MARQUEE> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-08-17T16:29:32.410

您可以在 html 中更改速度、方向和循环，但要编辑背景颜色，您需要使用 CSS。要设置文本颜色的样式，您不需要设置 <marquee> 的样式，但需要设置标签内的元素样式。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-10-17T22:09:09.160

我最近使用 Cycle 2 Jquery 插件在 HTML 中实现了一个选取框：http: [//jquery.malsup.com/cycle2/demo/non-image.php](http://jquery.malsup.com/cycle2/demo/non-image.php)

```
<div class="cycle-slideshow"  data-cycle-fx="scrollHorz" data-cycle-speed="9000" data-cycle-timeout="1"  data-cycle-easing="linear" data-cycle-pause-on-hover="true" data-cycle-slides="> div" >
  <div>  Text 1  </div>
  <div>  Text 2  </div>
</div> 
```

# ruby-on-rails - 子类化模型在开发环境中导致 NameError 但在测试中没有

> ID：687535
> 
> 赞同：0
> 
> 时间：2009-03-26T21:03:03.730
> 
> 标签：ruby-on-rails, ruby

这是我的动作模型：

```
class Action < ActiveRecord::Base
end

class Fold < Action
end

class Check < Action
end

class Call < Action
end

class Bet < Action
end 
```

在另一个模型中，我有这个

```
class Deal < ActiveRecord::Base
  def Deal.parse_action(action_string)
    case action_string
    when "folds":   Fold.new()
    when "checks":  Check.new()
    when "calls":   Call.new()
    when "bets":    Bet.new()
    when "raises":  Bet.new()
    else nil   
    end
  end
  # ...
end 
```

现在，当我测试它是否在我的单元测试中有效时，一切似乎都有效。但是，一旦我在开发模式下启动 Web 服务器，我就会得到：

```
NameError（未初始化的常量 Deal::Fold）：
  app/models/deal.rb:115:in `parse_action'
  ...

```

为什么它认为 Fold 存在于命名空间 Deal 中？为什么在测试环境中不会发生这种情况？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T22:21:21.297

这并不是说`Fold`存在于`Deal`命名空间中，而是说它正在寻找常量`Fold`并且它当前在`Deal`. 例如，试试这个：

```
class Foo 
  def test; puts Bar; end
end
Foo.new.test 
```

你会得到这个：

```
NameError: uninitialized constant Foo::Bar
  from (irb):3:in `test'
  from (irb):7
  from :0 
```

`Fold`Rails 有一些东西可以为你自动加载常量，我猜问题是你自己的文件中没有这个类。尝试将`Fold`类定义放入它自己的文件中——`app/models/fold.rb`看看是否有帮助。如果是这样，请尝试将其放回 action.rb 文件中，然后在执行语句之前执行一些会导致`Action`文件加载的操作`case`，例如`x = Action`在 case 语句之前。如果这有效，那么您需要加入`require "action.rb"`，`deal.rb`因为问题是您的测试代码正在加载 action.rb（可能通过其他一些测试），但您的生产代码不是。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T01:17:27.287

我在工作中不使用 Rails，但有时我会遇到这样的场景：在运行测试时知道某个类，但在运行可执行文件时却没有。发生这种情况是因为我在相关文件的测试文件中有必要的“require”语句，但我没有将必要的“require”语句放入生产代码中。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-27T01:16:26.540

在 Ruby 中，向您声明的类添加方法，如下所示：

```
 class Deal < ActiveRecord::Base
    def self.parse_action(action_string)
      case action_string
        when "folds":   Fold.new
        .... 
```

这也可能是您问题的根源。

另外（对不起，挑剔）但你不需要括号`Fold.new`。您可以在不使用对偶的情况下将参数传递给方法。

# apache-flex - firefox不会在flex中将字符串转换为数字

> ID：687548
> 
> 赞同：1
> 
> 时间：2009-03-26T21:07:11.757
> 
> 标签：apache-flex, actionscript-3, string, firefox, numbers

我使用全局坐标在 Flex 中制作了一个 Web 应用程序

我从 Web 服务获取坐标作为字符串，然后执行以下操作：

```
latStr:String = "28.7242100786401";
longStr:String = "-106.12635420984";

var cLat:Number = new Number(latStr);
var cLong:Number = new Number(longStr); 
```

**这在 IE 和 chrome 上完美运行，从 Web 服务器和本地调试时，但*Firefox 仅在本地调试时有效，*而不是从 Web 服务器，在 Web 服务器中`cLat`并`cLong`返回“ `NaN`”。**

自己检查一下，当你点击结果时它应该会弹出一个警报：http: //mundobuk.com/prueba/mapa/main.html?buscar= [oxxo](http://mundobuk.com/prueba/mapa/main.html?buscar=oxxo)

所以我尝试使用，但`parseFloat()`它会`cLat`四舍五入：（`28``cLong``-106`

然后我尝试将小数与整数分开，例如我的示例 28 和 7242100786401 然后除以 7242100786401/10000000000000 = 0.7242100786401

有 2 个数字 28 和 0.7242100786401 我把它们加起来

28 + 0.7242100786401 = 28.7242100786401

这是代码形式：

```
var latArr:Array = latStr.split(".");
var longArr:Array = longStr.split(".");

var latDivStr:String = "1";
for (var i:int= 0; i< latArr[1].length; i++){
latDivStr += "0";
}

var longDivStr:String = "1";
for (var j:int = 0; j< longArr[1].length; j++){
longDivStr += "0";
}
var cLat:Number = parseFloat(latArr[0]) + arseFloat(latArr[1])/parseFloat(latDivStr);
var cLong:Number = parseFloat(longArr[0]) - parseFloat(longArr[1])/parseFloat(longDivStr); 
```

再一次，这种方式在任何地方都很好用，只是在 web 服务器的 firefox 中不行>_>

有人有想法么？我要疯了@_@

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T21:51:40.603

我从未听说过这样的错误，因为 Flash 运行时应该使不同的浏览器和操作系统以相同的方式解释 SWF。我会说我不相信你应该在你的号码转换前使用“新”。

```
latStr:String = "28.7242100786401";
longStr:String = "-106.12635420984";

var cLat:Number = new Number(latStr);
var cLong:Number = new Number(longStr); 
```

这应该是：

```
var cLat:Number = Number(latStr); //Number is right because its a Floating Point, but remove new.
var cLong:Number = Number(longStr); //Number is right because its a Floating Point, but remove new. 
```

我使用以下方法进行了测试，发现没有发生舍入。

var latStr:String = "28.7242100786401"; var longStr:String = "-106.12635420984";

```
trace(parseFloat(latStr)); //Outputs:  "28.7242100786401";
trace(parseFloat(longStr)); //Outputs:  "-106.12635420984";

trace(Number(latStr)); //Outputs:  "28.7242100786401";
trace(Number(longStr)); //Outputs:  "-106.12635420984"; 
```

我不明白您为什么需要这种解决方法。此外，我使用 firefox 作为我的主要浏览器，您的网站似乎运行良好。

干杯。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T16:32:15.700

逗号是许多欧洲国家/地区的分隔符，因此很可能是服务器或客户端上的区域配置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T16:28:46.253

我终于找到了为什么它不工作，由于某种原因在 Firefox 中而不是读取点（。）它从 Web 服务读取逗号（，）（在 vb.net 中完成）

在本地它也将其读取为一个点，而不是在线，所以我想它必须对我的 IIS 服务器 O_o 做一些事情

希望这可以帮助那里的人...

# java - PreparedStatements 和绩效

> ID：687550
> 
> 赞同：57
> 
> 时间：2009-03-26T21:10:14.510
> 
> 标签：java, database, performance, prepared-statement

所以我一直听说 PreparedStatements 对性能有好处。

我们有一个 Java 应用程序，其中我们使用常规的“语句”比使用“PreparedStatement”更多。在尝试使用更多 PreparedStatements 的同时，我试图更全面地了解 PreparedStatements 的工作原理——在客户端和服务器端。

那么如果我们有一些典型的 CRUD 操作，并且在应用程序中反复更新一个对象，那么使用 PS 有帮助吗？我知道我们每次都必须关闭 PS，否则会导致游标泄漏。

那么它对性能有什么帮助呢？驱动程序是否缓存预编译语句并在我下次执行 connection.prepareStatement 时给我一份副本？或者数据库服务器有帮助吗？

我理解有关 PreparedStatements 的安全优势的论点，我很欣赏下面强调它的答案。然而，我真的想把这个讨论集中在 PreparedStatements 的性能优势上。

更新：当我说更新数据时，我的意思更多的是随机调用该方法多次。我理解下面提供的答案的优势，它要求在循环中重用语句。

```
 // some code blah blah
    update();

    // some more code blah blah 
    update();

.... 

public void update () throws SQLException{
 try{
      PreparedStatement ps = connection.prepareStatement("some sql");
      ps.setString(1, "foobar1");
      ps.setString(2, "foobar2");
      ps.execute();
 }finally {
     ps.close();

 }

} 
```

没有办法真正重用“ps”java对象，我知道实际的connection.prepareStatement调用非常昂贵。

这让我回到了最初的问题。这个“一些 sql”PreparedStatement 是否仍然在我不知道的情况下被缓存和重用？

我还应该提到我们支持多个数据库。

提前致谢。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-03-26T21:49:58.987

准备好的语句主要是关于性能的概念是一种误解，尽管它很常见。

另一位发帖人提到，他注意到 Oracle 和 SQL Server 的速度提高了约 20%。我注意到 MySQL 有一个类似的数字。事实证明，解析查询并不是所涉及工作的重要部分。在一个非常繁忙的数据库系统上，查询解析是否会影响整体吞吐量也不清楚：总的来说，它可能只是用尽了 CPU 时间，否则在数据从磁盘返回时会处于空闲状态。

因此，作为使用准备好的语句的一个原因，**对 SQL 注入攻击的保护远远超过**了性能提升。如果您不担心 SQL 注入攻击，您可能应该...

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-03-26T21:30:39.157

重新使用您准备的相同语句时，准备好的语句可以提高性能：

```
PreparedStatement ps = connection.prepare("SOME SQL");

for (Data data : dataList) {
  ps.setInt(1, data.getId());
  ps.setString(2, data.getValue();
  ps.executeUpdate();
}

ps.close(); 
```

这比在循环中创建语句要快得多。

一些平台还缓存准备好的语句，以便即使您关闭它们也可以更快地重建它们。

但是，即使性能相同，您仍然应该使用准备好的语句来防止 SQL 注入。在我的公司，这是一个面试问题；弄错了，我们可能不会雇用你。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-03-26T21:26:00.400

准备好的语句在第一次使用后确实会被缓存，这是它们在性能方面优于标准语句的原因。如果您的陈述没有改变，那么建议使用此方法。它们通常存储在语句缓存中以供更改使用。

更多信息可以在这里找到：

[http://www.theserverside.com/tt/articles/article.tss?l=Prepared-Statments](http://www.theserverside.com/tt/articles/article.tss?l=Prepared-Statments)

您可能希望将 Spring JDBCTemplate 视为直接使用 JDBC 的替代方案。

[http://static.springframework.org/spring/docs/2.0.x/reference/jdbc.html](http://static.springframework.org/spring/docs/2.0.x/reference/jdbc.html)

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-03-26T22:51:29.867

解析 SQL 并不是唯一发生的事情。验证表和列确实存在，创建查询计划等。您使用 PreparedStatement 支付一次。

绑定以防止 SQL 注入确实是一件非常好的事情。还不够，海事组织。您仍然应该在进入持久层之前验证输入。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2014-12-11T10:30:35.597

> 那么它对性能有什么帮助呢？驱动程序是否缓存预编译语句并在我下次执行 connection.prepareStatement 时给我一份副本？或者数据库服务器有帮助吗？

我将从性能方面回答。这里的其他人已经规定了`PreparedStatement`s 对 SQL 注入具有弹性（有福的优势）。

应用程序（JDBC 驱动程序）创建`PreparedStatement`并使用占位符（the）将其传递给 RDBMS `?`。RDBMS 预编译，应用接收到的查询优化（如果需要）`PreparedStatement`并（在某些情况下）通常缓存它们。在执行期间`PreparedStatement`，使用预编译`PreparedStatement`的，用它们的相关值替换每个占位符并计算。这与`Statement`编译它并直接执行它相反，它只`PreparedStatement`编译和优化查询*一次*。现在，上面解释的这种情况并不是所有 JDBC 供应商的绝对情况，但本质上就是`PreparedStatement`这样使用和操作的。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-26T21:31:33.227

有趣的是：几年前，我在 Java 1.4 中使用 ODBC 对准备好的语句和动态语句进行了一些实验，同时使用了 Oracle 和 SQL Server 后端。我发现对于某些查询，prepared statements 可能会快 20%，但对于哪些查询改进到何种程度存在特定于供应商的差异。（这应该不足为奇，真的。）

底线是，如果您将重复使用相同的查询，准备好的语句可能有助于提高性能；但是，如果你的表现很糟糕以至于你需要立即采取措施，不要指望使用准备好的陈述来给你带来根本的提升。（20% 通常没什么好写的。）

当然，您的里程可能会有所不同。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-12-08T08:12:54.213

*这让我回到了最初的问题。这个“一些 sql”PreparedStatement 是否仍然在我不知道的情况下被缓存和重用？*

是的，至少对于 Oracle。根据 Oracle® 数据库 JDBC 开发人员指南[隐式语句缓存](http://docs.oracle.com/cd/E18283_01/java.112/e16548/stmtcach.htm#i1071993)（已添加重点），

> 当您启用隐式 Statement 缓存时，JDBC 会在您调用`close`此语句对象的方法时自动缓存准备好的或可调用的语句。使用标准连接对象和语句对象方法缓存和检索准备好的和可调用的语句。
> 
> 普通语句不会被隐式缓存，因为隐式语句缓存使用 SQL 字符串作为键，而普通语句是在没有 SQL 字符串的情况下创建的。因此，隐式 Statement 缓存仅适用于使用 SQL 字符串创建的`OraclePreparedStatement`and`OracleCallableStatement`对象。您不能将隐式语句缓存与 OracleStatement 一起使用。创建`OraclePreparedStatement`or`OracleCallableStatement`时，JDBC 驱动程序**会自动在缓存中搜索匹配的语句**。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-12-12T04:53:37.443

**1\. PreparedStatement 允许您编写动态和参数化查询**

通过在 Java 中使用 PreparedStatement，您可以编写参数化的 sql 查询并使用相同的 sql 查询发送不同的参数，这比创建不同的查询要好得多。

**2\. PreparedStatement 比 Java 中的 Statement 快**

使用 PreparedStatement 的主要好处之一是更好的性能。PreparedStatement 在数据库中预编译，并且访问计划也缓存在数据库中，这允许数据库执行使用准备好的语句编写的参数查询比普通查询快得多，因为它要做的工作更少。您应该始终尝试在生产 JDBC 代码中使用 PreparedStatement 来减少数据库负载。为了获得性能优势，值得注意的是仅使用参数化版本的 sql 查询而不是字符串连接

**3\. PreparedStatement 防止Java中的SQL注入攻击**

阅读更多：http: [//javarevisited.blogspot.com/2012/03/why-use-preparedstatement-in-java-jdbc.html#ixzz3LejuMnVL](http://javarevisited.blogspot.com/2012/03/why-use-preparedstatement-in-java-jdbc.html#ixzz3LejuMnVL)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-01-20T09:49:03.680

**简短的回答：**

PreparedStatement 有助于提高性能，因为通常 DB 客户端重复执行相同的查询，这使得可以对初始查询进行**一些预处理****以加快后续重复查询**。

**长答案：**

根据[Wikipedia](https://en.wikipedia.org/wiki/Prepared_statement)，使用准备好的语句的典型工作流程如下：

> **准备**：报表模板由应用程序创建并发送到数据库管理系统 (DBMS)。某些值未指定，称为参数、占位符或绑定变量（下面标记为“？”）： INSERT INTO PRODUCT（名称，价格）VALUES（？，？）
> 
> **（预编译）**：DBMS对语句模板进行解析、编译、查询优化，结果不执行就存储。
> 
> **执行**：稍后，应用程序为参数提供（或绑定）值，DBMS 执行语句（可能返回结果）。应用程序可以使用不同的值多次执行该语句。在此示例中，它可能为第一个参数提供“面包”，为第二个参数提供“1.00”。

**准备：**

在 JDBC 中，“准备”步骤是通过调用 java.sql.Connection 完成的。[prepareStatement](https://docs.oracle.com/javase/7/docs/api/java/sql/Connection.html#prepareStatement(java.lang.String))（字符串 sql）API。根据其Javadoc：

> 此方法针对处理受益于预编译的参数化 SQL 语句进行了优化。如果驱动程序支持预编译，prepareStatement 方法会将语句发送到数据库进行预编译。某些驱动程序可能不支持预编译。在这种情况下，在执行 PreparedStatement 对象之前，该语句可能不会发送到数据库。这对用户没有直接影响；但是，它确实会影响哪些方法抛出某些 SQLException 对象。

由于调用此 API 可能会将 SQL 语句发送到数据库，因此它通常是一个昂贵的调用。根据 JDBC 驱动程序的实现，如果您有相同的 sql 语句模板，为了获得更好的性能，您可能必须避免在客户端为同一个 sql 语句模板多次调用此 API。

**预编译：**

发送的语句模板将在数据库中**预编译**并缓存在数据库服务器中。数据库可能会使用连接和 sql 语句模板作为键，将预编译的查询和计算的查询计划作为缓存中的值。解析查询可能需要验证要查询的表、列，因此可能是一项昂贵的操作，[查询计划](https://en.wikipedia.org/wiki/Query_plan)的计算也是一项昂贵的操作。

**执行：**

对于相同连接和sql语句模板的后续查询，数据库服务器将直接从缓存中查找预编译的查询和查询计划，而无需再次重新计算。

**结论：**

从性能的角度来看，使用 prepare 语句是一个两阶段的过程：

1.  阶段 1，准备和预编译，这个阶段预计会完成一次，并为性能增加一些开销。
2.  阶段2，同一个查询的重复执行，由于阶段1对查询进行了一些预处理，如果重复查询的次数足够大，这样可以为同一个查询节省大量的预处理工作。

如果你想了解更多细节，有一些文章解释了 PrepareStatement 的好处：

1.  [http://javarevisited.blogspot.com/2012/03/why-use-preparedstatement-in-java-jdbc.html](http://javarevisited.blogspot.com/2012/03/why-use-preparedstatement-in-java-jdbc.html)
2.  [http://docs.oracle.com/javase/tutorial/jdbc/basics/prepared.html](http://docs.oracle.com/javase/tutorial/jdbc/basics/prepared.html)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-12-11T00:51:16.667

与普通语句相比，准备好的语句在性能方面具有一些优势，具体取决于您如何使用它们。正如之前有人所说，如果您需要使用不同的参数多次执行相同的查询，您可以重用准备好的语句并只传递新的参数集。性能改进取决于您使用的特定驱动程序和数据库。

例如，在数据库性能方面，Oracle 数据库在每次计算后缓存一些查询的执行计划（并非所有版本和所有 Oracle 配置都是如此）。即使您关闭一个语句并打开一个新语句，您也可以找到改进，因为这是在 RDBMS 级别完成的。仅当两个后续查询（逐个字符）相同时，才会激活这种缓存。这不适用于普通语句，因为参数是查询的一部分并产生不同的 SQL 字符串。

其他一些 RDBMS 可能更“智能”，但我不希望他们会使用复杂的模式匹配算法来缓存执行计划，因为它会降低性能。您可能会争辩说，执行计划的计算只是查询执行的一小部分。对于一般情况，我同意，但是..这取决于。请记住，通常，计算执行计划可能是一项代价高昂的任务，因为 rdbms 需要查阅内存外数据，例如统计信息（不仅是 Oracle）。

然而，关于缓存的争论范围从执行计划到提取过程的其他部分。多次向 RDBMS 提供相同的查询（无需深入了解特定实现）有助于在 JDBC（驱动程序）或 RDBMS 级别识别已计算的结构。如果您现在在性能方面没有发现任何特别的优势，那么您不能排除将在驱动程序/rdbms 的未来/替代版本中实现性能改进。

通过在批处理模式下使用准备好的语句可以获得更新的性能改进，但这是另一回事。

# javascript - 防止 TinyMCE/Internet Explorer 将 URL 转换为链接

> ID：687552
> 
> 赞同：6
> 
> 时间：2009-03-26T21:11:13.353
> 
> 标签：javascript, internet-explorer, drupal, tinymce

我正在使用 TinyMCE 为用户提供在 textarea 表单字段上进行简单文本格式化（粗体、斜体、列表）的功能。一切正常，除了在 Internet Explorer 中（8 但我读过它发生在早期版本上），当用户键入 URL（例如 www.google.com）时，它会在 TinyMCE 编辑器中自动转换为 HTML 链接，因为他们类型。这在 Firefox (3) 中不会发生。如何防止 IE 这样做？

我已经使用以下内容初始化了 TinyMCE：

```
tinyMCE.init({
    mode : "textareas",
    theme : "simple",
    convert_urls : false
 }); 
```

但我不认为 convert_urls 旨在影响我所描述的行为：[http ://wiki.moxiecode.com/index.php/TinyMCE:Configuration/convert_urls](http://wiki.moxiecode.com/index.php/TinyMCE:Configuration/convert_urls)

我试过：

```
function myCustomURLConverter(url, node, on_save) {
    return url;
}

tinyMCE.init({
    mode : "textareas",
    theme : "simple",
    urlconverter_callback : "myCustomURLConverter"
 }); 
```

但同样，我认为这只是一种影响 URL 在加载/保存时如何/是否转换的方法，而不是防止它们在用户键入时转换为链接： [http ://wiki.moxiecode.com/index.php/TinyMCE :配置/urlconverter_callback](http://wiki.moxiecode.com/index.php/TinyMCE:Configuration/urlconverter_callback)

我正在尝试解决的问题至少在几个地方进行了描述： [http](http://tinymce.moxiecode.com/punbb/viewtopic.php?id=2182&p=1) ://tinymce.moxiecode.com/punbb/viewtopic.php?id=2182&p= 1（第三篇文章，由 tommya 撰写） [http:// drupal.org/node/149511](http://drupal.org/node/149511)

有没有人见过这个或对如何解决它有任何建议？TinyMCE 代码库非常大且难以追踪，所以我希望有人可以帮助我稍微隔离一下这个问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T08:55:57.807

似乎不是在 IE 中禁用它的方法。它似乎是一个“功能”，它也出现在 FCKEditor 上。几个替代方案，从有效元素中删除元素。[http://wiki.moxiecode.com/index.php/TinyMCE:Configuration/valid_elements](http://wiki.moxiecode.com/index.php/TinyMCE:Configuration/valid_elements)

或者做一个服务器端标签解析来删除它。

我认为这可能是“功能” [http://msdn.microsoft.com/en-us/library/aa769893(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa769893(VS.85).aspx)

这里可能是让它工作的提示，但它看起来像 ActiveX 和 VB，所以我在实验中很快就迷路了 [http://www.mindfrost82.com/showpost.php?p=1114381&postcount=2](http://www.mindfrost82.com/showpost.php?p=1114381&postcount=2)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-09-26T14:35:58.620

我想我是这样解决的：

```
remove_script_host: "false",
relative_urls: "false",
document_base_url : "http//www.mywebsite.nlhttp://www.mywebsite.nl", 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-03-28T12:52:14.583

这是一个可行的解决方法，需要粘贴插件。在您的 TinyMCE 初始化配置中，添加：

```
paste_preprocess : function(pl, o) {
    // Strip <a> HTML tags from clipboard content (Happens on Internet Explorer)
    o.content = o.content.replace( /(\s[a-z]+=")<a\s[^>]+>([^<]+)<\/a>/gi, '$1$2' );
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-04-10T13:53:44.677

我已经用这些配置解决了这个问题：

```
remove_script_host : false,
auto_cleanup_word : false,
relative_urls : false, 
convert_urls : false,
verify_html : false,
convert_newlines_to_brs : false, 
urlconvertor_callback: "convLinkVC",
document_base_url : "",
forced_root_block : '', 
```

# java - Java中注解处理的弊端？

> ID：687553
> 
> 赞同：29
> 
> 时间：2009-03-26T21:11:32.213
> 
> 标签：java

我正在考虑启动一个项目，该项目用于使用注释在 Java 中生成代码（我不会详细说明，因为它并不真正相关）。我想知道该项目的有效性和有用性，令我印象深刻的是对 Annontation Processor Tool (apt) 的依赖。

我想知道，因为我不能从经验中说出来，在 Java 中使用注释处理有什么缺点？

这些可以是任何东西，包括：

*   编写处理器时很难做 TDD
*   很难在构建系统中包含处理
*   处理需要很长时间，并且很难让它快速运行
*   在 IDE 中使用注解需要一个插件，以使其在报告错误时表现相同

这些只是例子，不是我的意见。我正在研究这些是否属实（包括问这个问题;-)）

我确信肯定有缺点（例如，[Qi4J](http://www.qi4j.org/)明确列出不使用预处理器作为优点），但我没有使用它的经验来判断它们是什么。

使用注释处理的唯一合理替代方法可能是为相关 IDE 创建插件以生成代码（这与覆盖/实现方法功能有点相似，它会生成所有没有方法体的签名）。但是，据我所知，每次代码的相关部分发生更改时，都必须重复该步骤，注释处理不会。

关于以侵入性数量的注释给出的示例，我不认为使用需要是这样的，对于任何给定的类来说可能是少数。当然，这并不能阻止它被滥用。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-04-01T14:36:48.620

我创建了一组 JavaBean 注释（[http://code.google.com/p/javadude/wiki/Annotations](http://code.google.com/p/javadude/wiki/Annotations)）

[注意：我现在正在开发新版本，所以主干代码与更新站点下载不匹配]

**测试**

测试它们可能会非常困难......

我通常通过在 Eclipse 中使用测试代码创建一个项目并构建它来处理它，然后进行复制并关闭注释处理。

然后我可以使用 Eclipse 将“活动”测试项目与项目的“预期”副本进行比较。

我还没有太多的测试用例（生成这么多属性组合非常乏味），但这很有帮助。

**构建系统**

在构建系统中使用注解实际上非常容易。查看[http://code.google.com/p/javadude/wiki/Annotations](http://code.google.com/p/javadude/wiki/Annotations)以了解它如何在 ant 脚本中使用的示例，并且在 eclipse 中使用它只是制作一个指定注释处理器的插件的问题扩展并在想要使用它的项目中打开注释处理。

我在连续构建环境中使用注释处理，构建注释和处理器，然后在构建的其余部分中使用它。这真的很无痛。

**处理时间**

我还没有发现这是一个问题——小心你在处理器中所做的事情。我在我的代码中生成了很多代码并且运行良好。蚂蚁的速度有点慢。

请注意，Java6 处理器可以运行得更快一些，因为它们是正常编译过程的一部分。但是，我很难让它们在代码生成能力中正常工作（我认为大部分问题是 eclipse 的支持和运行多阶段编译）。目前，我坚持使用 Java 5。

**错误处理**

这是注释 API 中经过深思熟虑的事情之一。API 有一个处理所有错误的“信使”对象。每个 IDE 都提供了一个实现，将其转换为代码中正确位置的适当错误消息。

我所做的唯一特定于 Eclipse 的事情是强制转换处理环境对象，以便我可以检查它是作为构建运行还是用于编辑器协调。如果编辑，我退出。最终，我会将其更改为仅在编辑时进行错误检查，以便在您键入时报告错误。不过要小心——你需要保持它的速度*非常*快，以便在对账期间使用，否则编辑会变得迟缓。

**代码生成问题**

[根据评论添加了更多]

注释处理器规范声明不允许修改包含注释的类。我怀疑这是为了简化处理（进一步的轮次不需要包含带注释的类，也可以防止无限更新循环）

但是，您*可以*生成其他类，他们推荐这种方法。

我为所有 get/set 方法和我需要生成的任何其他方法生成一个超类。我还让处理器验证带注释的类是否扩展了生成的类。例如：

```
@Bean(...)
public class Foo extends FooGen 
```

我在同一个包中用带注释的类的名称加上“Gen”生成一个类，并验证带注释的类被声明为扩展它。

我见过有人使用编译器树 api 来修改带注释的类——这违反了规范，我怀疑他们会在某个时候堵住那个洞，所以它不会工作。

我建议生成一个超类。

**总体**

我*真的很*高兴使用注释处理器。设计得非常好，尤其是在 IDE/命令行构建独立性方面。

目前，如果您正在生成代码，我建议您坚持使用 Java5 注释处理器 - 您需要运行一个名为 apt 的单独工具来处理它们，然后进行编译。

请注意，Java 5 和 Java 6 注释处理器的 API 是不同的！恕我直言，Java 6 处理 API 更好，但我还没有运气好让 Java 6 处理器完成我需要的工作。

当 Java 7 出现时，我将再试一次新的处理方法。

如果您有任何问题，请随时给我发电子邮件。（斯科特@javadude.com）

希望这可以帮助！

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-02-03T21:17:04.783

我认为如果注释处理器那么肯定使用 API 的 Java 6 版本。那是将来会支持的。Java 5 API 仍然在非官方的 com.sun.xyz 命名空间中。

我想我们会在不久的将来看到更多注释处理器 API 的使用。例如，Hibernate 正在为新的 JPA 2 查询相关的静态元模型功能开发处理器。他们还在开发用于验证 Bean Validation 注释的处理器。所以注释处理就在这里了。

工具集成没问题。主流 IDE 的最新版本包含配置注释处理器并将它们集成到构建过程中的选项。主流构建工具还支持注释处理，其中 maven 仍然会引起一些悲伤。

测试我发现一个大问题。所有测试都是间接的，并且以某种方式验证注释处理的最终结果。我不能编写任何简单的单元测试来断言在 TypeMirrors 或其他基于反射的类上工作的简单方法。问题是不能在处理器编译周期之外实例化这些类型的类。我认为 Sun 在设计 API 时并没有真正考虑到可测试性。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T22:45:03.487

一个有助于回答问题的具体内容是与什么相反？不做项目，还是不使用注释？如果不使用注释，还有什么替代方法？

就个人而言，我发现过多的注释难以阅读，而且很多时候过于不灵活。看看这个在 Web 服务上实现供应商所需 WSDL 的一种方法：

```
 @WebMethod(action=QBWSBean.NS+"receiveResponseXML")
@WebResult(name="receiveResponseXML"+result,targetNamespace = QBWSBean.NS)
@TransactionAttribute(TransactionAttributeType.NOT_SUPPORTED)
public int receiveResponseXML(
        @WebParam(name = "ticket",targetNamespace = QBWSBean.NS) String ticket,
        @WebParam(name = "response",targetNamespace = QBWSBean.NS) String response,
        @WebParam(name = "hresult",targetNamespace = QBWSBean.NS) String hresult,
        @WebParam(name = "message",targetNamespace = QBWSBean.NS) String message) { 
```

我发现该代码非常不可读。不过，XML 配置替代方案不一定更好。

# delphi - 有没有办法在 Delphi 中找到未使用的事件处理程序？

> ID：687554
> 
> 赞同：6
> 
> 时间：2009-03-26T21:11:54.520
> 
> 标签：delphi, event-handling, vcl, dead-code

在 Delphi 中查找死代码通常非常简单：只需编译然后扫描缺少蓝点的例程。大多数时候，智能链接器非常擅长追踪它们。

问题是，这对事件处理程序不起作用，因为它们是已发布的方法，（理论上）可以通过 RTTI 以某种方式调用，即使这在实际实践中几乎从未发生过。

我正在尝试清理一个大型 VCL 表单单元，该单元在其历史上曾多次弯曲、折叠、旋转和肢解。如果我有办法找到表单的 DFM 实际未引用的事件处理程序并删除它们，那肯定会很好。有什么简单的方法可以做到这一点？例如，插件 IDE 专家？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-26T21:32:39.713

这有点难看（好吧，它*非常*难看），但对于一个单元来说，它几乎是万无一失的，并且不需要额外的工具：

1.  **确保将当前版本的表单签入源代码管理！**
2.  转到事件处理程序所在类的接口顶部。删除所有事件处理方法接口。
3.  查看代码资源管理器/错误洞察。有实现但没有接口的方法将被突出显示。删除实现。
4.  现在保存单元。Delphi 将一次一个地抱怨每个实际处理的事件缺少事件处理程序。当错误出现时把这些写下来。
5.  查看表单的原始版本，并删除任何不在您列表中的事件处理程序。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-26T22:47:56.803

使用“重命名方法”重构来重命名每个事件处理程序。选中“重构前查看引用”复选框。

检查重构窗口。如果事件处理程序链接到控件，将有一个“VCL 设计器更新”部分显示哪些控件链接到该方法。

这还将显示该方法是从任何其他单元调用的，还是以编程方式分配的。

注意：这是针对 D2006 的，后续版本可能会略有不同。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-09-13T19:39:56.407

[ModelMaker Code Explorer](http://www.modelmakertools.com/code-explorer/index.html)包含一个所谓的[事件处理程序视图](http://modelmakertools.com/movies/event-handlers-view.htm)。它还显示未连接到任何组件的事件处理程序。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-26T21:21:57.243

在最一般的情况下，没有任何解决方案可以保证给出正确的答案（如您所见，基于通过 RTTI 调用它们的可能性）。

一种解决方案是进行代码覆盖测试并仔细查看从未到达的处理程序。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-26T21:36:44.150

我不知道有一个预先存在的应用程序或插件来执行此操作，但编写脚本应该不难。

假设您没有使用 RTTI 或手动分配事件处理程序：（我是 C++Builder 用户而不是 Delphi，因此以下内容可能不太正确。）

1.  列出代码中所有已发布的方法。
    *   正确的方法是阅读`*.pas`. `class`查找以声明或`published`指令开头并以 、 或 结尾的每个`end`文本`private`块`public`。在每个文本块中，提取每个`procedure`.
    *   执行此操作的简单方法是列出常见事件处理程序类型并假设它们已发布。
2.  获得此列表后，打印列表中未在 DFM 文件中找到的所有内容。

我最喜欢使用 Cygwin 或 Linux 工具编写脚本。这是一个在 Cygwin 中工作的 bash 脚本，应该做你想做的事。

```
#!/bin/bash

for file in `find -name *.pas`; do
    echo $file:

    # Get a list of common event handling procedures.
    # Add more types between the | symbols.
    egrep '^[[:space:]]+procedure.*(Click|FormCreate|FormClose|Change|Execute)\(' $file | 
    awk '{print $2}' | cut -f 1 -d '(' > published.txt

    # Get a list of used event procedures.
    egrep '^[[:space:]]+On.* =' ${file%.pas}.dfm | awk '{print $3}' > used.txt

    # Compare the two.
    # Files listed in the left column are published but not used, so you can delete them.
    # Files in the right column were not by our crude search for published event 
    # handlers, so you can update the first egrep command to find them.
    comm -3 published.txt used.txt

    echo

done

# Clean up.
rm published.txt used.txt 
```

要实际使用它，如果您不熟悉 Cygwin：

*   下载并安装 Cygwin。我*认为*默认安装应该为您提供我使用的所有工具，但我并不肯定。
*   将脚本另存为`cleanup.sh`.
*   启动 Cygwin 命令提示符。
*   如果您的源位于 c:\MyApp 中，则键入`cd /cygdrive/c/myapp`
*   键入`./cleanup.sh`并按 Enter。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-26T21:43:59.467

从自动的角度来看，我认为这是不可能的。当对象内部发生特定事件时，事件处理程序被激活。在给定的运行中未触发偶数并不意味着没有导致它的执行路径。

您还可以在运行时动态分配处理程序，因此在一种情况下使用的内容是不保证的。

例如

button.onclick := DefaultClickHandler;

button.onClick := SpecialClickHandler;

假设单击处理程序与 onclick 事件签名匹配，但如果签名不正确，您将不会获得编译。

* * *

但是，您可以通过查找具有 (Sender: TObject) 方法签名的所有方法并将他的方法与 .dfm 中的方法进行比较来找到所有废弃的处理程序（如果您是，请确保将其保存为文本）使用旧版本的delphi），在我的书中没有自动连接的antyhing会被怀疑。

--

如果您不想走 cygwin 路径，您可以将 src 和 dfm 加载到两个 TStirngLists 中，并从每个 TStirngLists 中取出名称/标识，并生成一个包含几个循环和一些字符串操作的列表。我的猜测是大约需要 20 分钟的工作才能得到可以忍受的东西。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-26T22:16:51.073

有一个比克雷格更容易的方法。

转到可疑事件处理程序。以一致的方式重命名它——我通过在名称前面放一个 x 来做到这一点，然后继续执行并做同样的事情。看看编译器是怎么想的。

如果不满意，您只需将名称改回即可。

您可以使用相同的方法来消除不再执行任何操作的数据元素。

# powershell - 如何在 Powershell 中加载 WPFToolkit 程序集

> ID：687562
> 
> 赞同：1
> 
> 时间：2009-03-26T21:14:30.333
> 
> 标签：powershell, assemblies, load, wpftoolkit

我已经安装了 WPF 工具包：

```
Location: C:\Program Files\WPF Toolkit\v3.5.40320.1\WPFToolkit.dll 
Name: WPFToolkit, Version=3.5.40128.1, Culture=neutral, PublicKeyToken=31bf3856ad364e35 
Type: Library 
```

我可以通过完整路径加载它：

```
[System.Reflection.Assembly]::LoadFrom("C:\Program Files\WPF Toolkit\v3.5.40320.1\WPFToolkit.dll") 
```

但不能按程序集名称加载：

```
[System.Reflection.Assembly]::LoadWithPartialName("WPFToolkit, Version=3.5.40128.1, Culture=neutral, PublicKeyToken=31bf3856ad364e35")

[System.Reflection.Assembly]::Load("WPFToolkit, Version=3.5.40128.1, Culture=neutral, PublicKeyToken=31bf3856ad364e35") 
```

什么是解决方案？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T01:12:47.983

按程序集名称加载不起作用，因为 WPFToolkit 程序集既不在 GAC 也不在 PowerShell 目录中。有几种选择：

*   通过路径加载它
*   将其添加到 GAC
*   更改 powershell.exe.config 以查看 WPF Toolkit 目录
*   处理 AppDomain.AssemblyResolve 事件（在 PowerShell V1 中并不特别容易）

# mysql - 在 MySQL 中使用文件路径作为主键

> ID：687567
> 
> 赞同：2
> 
> 时间：2009-03-26T21:15:50.923
> 
> 标签：mysql, primary-key

我有一个表，它只包含有关文件的信息，因此，由于文件路径是唯一的并且可以识别任何条目，我认为我应该将它用作主键。

虽然，我遇到了一些问题，比如需要指定密钥长度（错误 1170）。我该怎么办？使用整数作为主键，每次我需要访问文件“x”的信息时，执行“where FilePath=x”？

感谢您花时间阅读我的问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T21:45:08.327

在大多数数据库中，为足够长以存储深度文件路径的字符串列创建索引是低效的（甚至是不可能的）。这是使用代理键的好情况。

另一种选择是使用廉价的散列函数从文件路径计算固定长度的散列，例如`MD5()`（尽管 MD5 的强度不足以用于密码，但在这种情况下，它足以确保输入数据的唯一性）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T21:19:12.960

使用 int 作为主键并将 Unique 放在文件路径的字段中。

```
CREATE TABLE `cms`.`test` (
    `id` INT( 32 ) NOT NULL AUTO_INCREMENT PRIMARY KEY ,
    `filepath` VARCHAR( 255 ) NOT NULL ,
UNIQUE (
    `filepath`
)
) ENGINE = MYISAM 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T21:24:29.467

您可以为文件路径指定最大长度并将列更改为 varchar 吗？

[这篇文章解释了这个错误](http://www.mydigitallife.info/2007/07/09/mysql-error-1170-42000-blobtext-column-used-in-key-specification-without-a-key-length/)。基本上，您不能将键放在文本或 blob 列上，因为键需要一个长度来检查唯一性。但是 text 和 blob 列不支持长度。所以你不能在一个键中使用它们。

在更高版本的 MySQL 中，Varchar 列最多可以包含 65K 个字符

> VARCHAR 列中的值是可变长度字符串。在 MySQL 5.0.3 之前，长度可以指定为 0 到 255 之间的值，在 5.0.3 和更高版本中可以指定为 0 到 65,535 之间的值。MySQL 5.0.3 及更高版本中 VARCHAR 的有效最大长度取决于最大行大小（65,535 字节，在所有列之间共享）和使用的字符集。

*   [http://dev.mysql.com/doc/refman/5.0/en/char.html](http://dev.mysql.com/doc/refman/5.0/en/char.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T21:34:53.093

不要使用自然键（文件路径/名称）使用代理键（int）

我会将主键设为 INT，并将任何路径和文件放入不同的列中。将长字符串作为键和/或作为其他表中的外键会很慢。

您可能希望从路径中拆分文件名，和/或仅存储路径的一部分。路径的主根可以是附加到数据库部分路径+文件名的配置设置。

当我们存储文件信息时，我们只存储名称，路径是基于其他数据构建的：相关项目（订单、事件、工作等），然后是其他数据的 ID，等等......

# apache-flex - 如何使用 SendGatewayMessage 向 Flex 消费者发送消息？

> ID：687572
> 
> 赞同：1
> 
> 时间：2009-03-26T21:16:41.937
> 
> 标签：apache-flex, coldfusion, blazeds

我有一个 CFC，它偶尔需要通过 LCDS/BlazeDS 向具有消费者设置的多个 Flex 应用程序发送消息。我很难弄清楚完成这项工作的具体步骤。使用 ColdFusion 8 和 Flex 3。

我知道它是 SendGatewayMessage 但我该如何配置？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T02:57:10.667

[它有点旧，但 Ben Forta在他的博客](http://www.forta.com/blog/index.cfm/2006/2/1/Getting-Started-With-ColdFusion-And-Flex-Enterprise-Services)上对如何开始有一个很好的逐步介绍

# java - 如何查看 Java 1.4 中的另一个字符串中是否存在子字符串？

> ID：687577
> 
> 赞同：14
> 
> 时间：2009-03-26T21:17:47.533
> 
> 标签：java, string, substring

如何判断子字符串“模板”（例如）是否存在于 String 对象中？

如果它不是区分大小写的检查，那就太好了。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-03-26T21:20:33.597

[String.indexOf(字符串)](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/String.html#indexOf(java.lang.String))

对于不区分大小写的搜索，在 indexOf 之前的原始字符串和子字符串上都使用 toUpperCase 或 toLowerCase

```
String full = "my template string";
String sub = "Template";
boolean fullContainsSub = full.toUpperCase().indexOf(sub.toUpperCase()) != -1; 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-26T21:22:24.510

使用正则表达式并将其标记为不区分大小写：

```
if (myStr.matches("(?i).*template.*")) {
  // whatever
} 
```

( **?i)**打开不区分大小写，搜索词每端的**.*匹配任何周围的字符（因为****String.matches**适用于整个字符串）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-26T21:22:02.220

您可以使用 indexOf() 和 toLowerCase() 对子字符串进行不区分大小写的测试。

```
String string = "testword";
boolean containsTemplate = (string.toLowerCase().indexOf("template") >= 0); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-06-24T04:14:54.163

```
String word = "cat";
String text = "The cat is on the table";
Boolean found;

found = text.contains(word); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-04-19T05:41:38.760

```
public static boolean checkIfPasswordMatchUName(final String userName, final String passWd) {

    if (userName.isEmpty() || passWd.isEmpty() || passWd.length() > userName.length()) {
        return false;
    }
    int checkLength = 3;
    for (int outer = 0; (outer + checkLength) < passWd.length()+1; outer++) {
        String subPasswd = passWd.substring(outer, outer+checkLength);
        if(userName.contains(subPasswd)) {
            return true;
        }
        if(outer > (passWd.length()-checkLength))
            break;
    }
    return false;
} 
```

# c# - Silverlight 和表单应用程序

> ID：687582
> 
> 赞同：2
> 
> 时间：2009-03-26T21:19:31.617
> 
> 标签：c#, asp.net, silverlight

我想知道是否可以像 HTML 表单一样使用 silverlight 制作表单并将其数据提交到服务器以将它们存储在数据库中。

我可以这样做吗？

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-26T21:31:13.693

你绝对可以做到这一点。但是您不能像使用 ASP.Net 那样通过 Silverlight 直接与服务器通信。您必须使用 Web 服务来实现这一点。

有很多方法可以做到这一点：
1\. 使用**Web 服务** （旧 ASMX；这有安全问题）
2\. 使用**WCF** （对于复杂系统）
3\. 使用**ADO.Net 数据服务**（这可能是最简单和最快的方法实现这一点）使用 ADO.Net 实体框架。
4\. 使用**RIA 服务**（现在在 Silverlight 3 的 CTP 中）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T21:29:31.670

看看这里的一些视频：
[http](http://silverlight.net/learn/videocat.aspx?cat=2#HDI2WebServices)
://silverlight.net/learn/videocat.aspx?cat=2 #HDI2WebServices 基本上，您使用 Linq（或其他一些 orm）构建数据模型，通过 Select 公开该数据/Update/Delete/... 使用 Web 服务（新 WCF 或旧 WCF，ASMX）的方法，并在 silverlight 中使用它。Silverlight 自动为通信创建代理类。在 Silverlight 中，您可以使用它丰富的数据绑定功能，因此您无需担心数据如何传输、序列化、从 UI 读取等。
silverlight.net 网络上的视频教程解释了大部分关于编程 SL2 的内容非常好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T21:25:46.937

您始终可以在表单应用程序加载的网页中托管 sliverlight 应用程序。

也可以直接集成 WPF 和表单。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-28T23:36:32.440

或者您没有像每个人似乎总是假设您在服务器上运行 ASP.NET，因此不要使用所有这些该死的“Web 服务”东西，[您可以使用`WebClient`并以这种方式进行 POST](http://msdn.microsoft.com/en-us/library/cc197953(VS.95).aspx)。

...我不知道为什么每个人都认为有必要在你和你的网络服务器之间放置这么多的首字母缩写词 goo。您的旧 javascript 代码没有使用 WCF、SOAP 或其他方式与您的后端交互，为什么要使用 Silverlight？把事情简单化！Silverlight 非常乐意制作常规的、老式的、经过时间考验的 HTTP POST。

不要无耻，我一直在研究我在项目中使用的一个库，以便更容易调用你的后端，就像你使用 javascript: [WebBuddy 一样](http://webbuddy.codeplex.com/)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-06-13T05:19:19.677

实际上，有一种简单的方法可以在silverlight 中创建一个html 页面并用数据填充它并将其发布到服务器。它将使用 Silverlight 浏览器互操作以编程方式创建 HTML 并为其设置元素。

```
//Creates a blank html document
var htmldoc = System.Windows.Browser.HtmlPage.Document;
// Returns a Reference type to the body of html page
var body = htmldoc.Body;

// Create a <form> element and add it to the body
var newForm = htmldoc.CreateElement("form");
newForm.SetAttribute("action", targetUrl);
newForm.SetAttribute("method", "post");
body.AppendChild(newForm);

//Add your elements to your form
HtmlElement input1 = htmldoc.CreateElement("input");
input1.SetAttribute("type", "hidden");
input1.SetAttribute("name", "someName");
input1.SetAttribute("value", "someValue");
newForm.AppendChild(input1);

//submit your form
newForm.Invoke("submit"); 
```

这么简单！

原答案：[这个答案](https://stackoverflow.com/questions/9175910/navigate-and-post-data-from-silverlight)

# c# - 如何使用 C# 解析 RSS-CB 数据？

> ID：687589
> 
> 赞同：0
> 
> 时间：2009-03-26T21:22:08.757
> 
> 标签：c#, rss

有没有人从 RSS-CB 文件中获取值的经验，我想从以下位置获取值：

```
<cb:value frequency="daily" decimals="4">1.3607</cb:value>. 
```

rss 的位置是[http://www.ecb.int/rss/fxref-usd.html](http://www.ecb.int/rss/fxref-usd.html)。任何提示最好的方法是什么？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T21:26:59.633

查看[http://www.rssdotnet.com/](http://www.rssdotnet.com/)。它非常擅长阅读 RSS 提要。而且我很确定您将能够向解析器添加名称空间，以便获得所需的值

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T21:30:35.617

您可以将 Linq to XML 与 XNamespace 类一起使用。[有关MSDN](http://msdn.microsoft.com/en-us/library/bb387069.aspx)的更多信息。

# javascript - 对 IE 6 / 7 Javascript 内存检查工具有什么建议吗？

> ID：687592
> 
> 赞同：3
> 
> 时间：2009-03-26T21:22:24.247
> 
> 标签：javascript, internet-explorer, memory, object

我正在寻找一个 IE 6 / 7 插件或类似 Firebug_Lite 的东西，它可以显示运行时的内存使用情况，以及每个对象或变量的内存分配。谁知道什么工具有这个功能？谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T21:48:35.853

您可以尝试[Drip](http://www.outofhanwell.com/ieleak/index.php?title=Main_Page)来解决内存泄漏问题，但根据我的经验，这几乎适用于 IE。让我们等待更好的回应:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T22:30:29.200

出色地。我发现有一个名为 Javascript Memory Validator 的工具。但是它很贵，而且似乎只适用于 Firefox。而且很难使用。仍在寻找一个好的 IE 工具来检查 javascript 性能和内存分配。

# c# - Windows 服务应用程序控制器

> ID：687594
> 
> 赞同：1
> 
> 时间：2009-03-26T21:22:27.227
> 
> 标签：c#, .net, windows-services

这是前提：

我有一个桌面，我需要能够启动和停止应用程序，但无法远程访问。我想到的是在机器上设置一个服务，该服务将按照指示启动/停止应用程序列表。此 Windows 服务将定期为新命令提供 Web 服务并相应地执行它们。

这些是我的问题。

1）这是最简单的解决方案吗？你还会推荐什么？

2) 从 Windows 服务运行 exe 有多难？停一个怎么样？

这不是为了一个项目或任何东西，只是我有兴趣实现的东西（主要是为了好玩）。任何答案甚至想法都值得赞赏。也欢迎一般讨论（随时发表评论）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T21:39:17.170

至于在 C# 中创建 Windows 服务本身，请参阅我的[帖子](https://stackoverflow.com/questions/593454/easiest-language-to-create-a-windows-service/593803#593803)。

轮询机制会起作用，但总的来说，我更喜欢事件驱动的进程而不是轮询进程。您没有提及您使用的 .NET 版本，但如果是 .NET 3.0/3.5，我建议使用 WCF。当命令发布到 Web 服务时，Web 服务可以将命令发送到 Windows 服务以执行。很简单。《Programming WCF Services》的作者 Juval Lowy 在他的[网站上](http://www.idesign.net)提供了许多可免费使用的 WCF 示例/库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T21:27:37.120

所以我猜[PsExec](http://technet.microsoft.com/en-us/sysinternals/bb897553.aspx)是不可能的？

除此之外，在 Win 服务中实现程序的运行并不难。只需使用 .NET Process 类来完成它，从我的代码示例：

```
 ProcessStartInfo processStartInfo = new ProcessStartInfo (programExePath, commandLineArgs);

        consoleLogger.WriteLine (log, Level.Debug, "Running program {0} ('{1}')", programExePath, commandLineArgs);

        processStartInfo.CreateNoWindow = true;
        processStartInfo.ErrorDialog = false;
        processStartInfo.RedirectStandardError = true;
        processStartInfo.RedirectStandardOutput = true;
        processStartInfo.UseShellExecute = false;

        using (Process process = new Process ())
        {
            process.StartInfo = processStartInfo;
            process.ErrorDataReceived += new DataReceivedEventHandler (process_ErrorDataReceived);
            process.OutputDataReceived += new DataReceivedEventHandler (process_OutputDataReceived);
            process.Start ();

            process.BeginOutputReadLine ();
            process.BeginErrorReadLine ();

            if (false == process.WaitForExit ((int)TimeSpan.FromHours(1).TotalMilliseconds))
                throw new ArgumentException("The program '{0}' did not finish in time, aborting.", programExePath);

            if (process.ExitCode != 0)
                throw new ArgumentException ("failed.");
        } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T21:28:42.703

我已经完成了一项启动其他 exe 文件的服务。有一些事情需要考虑：作为一项服务，您没有可视桌面 -> 不可能进行直接交互。此外，该程序必须设计为运行很长时间。

停止 exe 是为了终止该进程。考虑通常的副作用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T21:33:50.833

这不会太难 - 你可以让它每隔一段时间轮询一些 Web 服务以获取“被禁止”应用程序的列表，然后在另一个计时器上，让它检查正在运行的被禁止应用程序，如果是，则将其杀死。这是一些获取进程列表的代码，您可以使用进程类上的方法来启动或终止某些东西：

[http://www.vbdotnetheaven.com/UploadFile/prvn_131971/machineprocessvb11182005001454AM/machineprocessvb.aspx](http://www.vbdotnetheaven.com/UploadFile/prvn_131971/machineprocessvb11182005001454AM/machineprocessvb.aspx)

计时器也可以独立运行 - 例如，它可以每天检查一次网络服务以获取新的添加/禁止列表，然后每 2 分钟检查一次计算机上运行的进程。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T21:46:08.230

我先回答问题2：

要启动或停止程序，您只需要使用 System.Diagnostics.Process 对象，示例代码就在 MSDN 库中。

对于问题 1：如果您想这样做，您可以让它定期轮询 Web 服务。

作为替代方案，您可以设置远程处理服务并让它只在 tcp 端口上侦听函数调用，然后编写一个可以使用远程处理调用服务的 Windows 应用程序。我必须为合法的商业应用程序这样做，并且效果很好。

**但是，如果我不包含此警告，我将非常不负责任：**

无论哪种方式，将计算机设置为可以执行任意代码都是一个**坏**主意，应该非常小心地完成。仅仅因为它**可以**完成并不意味着它**应该**完成。如果你走 Web 服务路线，你将如何确保不会有人篡改 Web 服务并让恶意代码执行？你怎么知道有人不会弄乱你的 app.config 并将应用程序指向他们自己的 Web 服务？在远程处理场景中，如何确保其他一些 .Net 开发人员不只是创建自己的代理？

老实说，我很惊讶微软甚至允许在 .Net 应用程序中使用 System.Diagnostocs.Process。你可以用它做任何你想做的事情，包括启动 cmd shell 和执行系统命令。因此，我敦促您认真考虑是否真的有必要这样做。安装 vnc 或使用远程桌面或其他应用程序进行远程访问可能会更好。

您需要回答的另一个问题是“该应用程序是否应该对该远程计算机上的用户可见？” 如果是这样，那么您需要确保将服务设置为在该用户的上下文中运行。否则，例如，您可以使用本地系统帐户启动 Word，而登录该计算机的人将永远无法看到它。

# java - 有效的 Java 代码不是有效的 Groovy 代码？

> ID：687601
> 
> 赞同：25
> 
> 时间：2009-03-26T21:26:23.597
> 
> 标签：java, grails, groovy

大多数 Java 代码也是语法上有效的 Groovy 代码。但是，有一些例外情况导致我提出我的问题：

Java 中的哪些构造/特性在 Groovy 中在语法上是无效的？**请提供不是有效 Groovy 代码 (Groovy 1.6) 的 Java 代码 (Java 1.6) 的具体示例。**

**更新：**

到目前为止，我们已经得到了五个语法有效的 Java 代码示例，这些示例不是有效的 Groovy 代码：

1.  数组初始化
2.  内部类
3.  `def`是 Groovy 中的关键字，但在 Java 中不是
4.  `"$$"``GString`-strings -在 Groovy 中被解析为无效的 s
5.  非静态初始化块`-- class Foo { Integer x; { x = 1; } }`

这是完整的清单吗？还有其他例子吗？

**更新＃1：**我已经开始悬赏这个问题。赏金将授予提供最全面示例列表的人。到目前为止，我们已经发现了五个例子，但我敢肯定还有更多的例子。所以让他们来吧！

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-04-11T19:12:34.673

以下是有效的 Java 6，但无效的 Groovy 1.6 的项目列表。这不是一个完整的列表，但我认为它涵盖了大多数情况。其中一些是更高版本的 Groovy 允许的，如下所述。

（顺便说一句，我认为您应该注意非静态初始化块在 Groovy 中确实可以工作。）

**Groovy 1.6 中的任何内部类声明（[1.7 添加了内部类](http://groovy-lang.org/releasenotes/groovy-1.7.html)）：**

包括静态，

```
public class Outer{
  static class Inner{}
} 
```

非静态的，

```
public class Outer{
  class Inner{}
} 
```

本地班级，

```
public class Outer{
  public static void main(String[] args) {
    class Local{}  
  }
} 
```

和匿名类

```
java.util.EventListener listener=new java.util.EventListener(){}; 
```

**使用 Groovy 关键字作为变量在任何 Groovy 版本中都不起作用：**

```
int def;
int in;
int threadsafe;
int as; 
```

**Java 数组初始化**

```
String[] stuff=new String[]{"string"};
int[] array={1,2,3}; 
```

`{...}`通过更改为使用 Groovy 数组文字格式`[...]`。

**在后面的不是有效表达式的字符串中使用美元符号**

```
String s="$$";
String s="$def";
String s="$enum";
String s="$;";
String s="$\\";
//etc. 
```

**for 循环中有多个初始化器**

```
for (int i=0, j=0; i < 5; i++) {} 
```

**for 循环中的多个增量**

```
int j=0;
for (int i=0; i < 5; i++,j++) {} 
```

**使用换行符分解一些表达式**

```
int a= 2 
/ 2 
; 
```

提示：在 Groovy 中使用反斜杠续行

```
int a= 2 \
/ 2 \
; 
```

**带有没有主体的外壳的结束开关**

```
switch(a){
  case 1:
} 
```

**在没有主体的开关中具有默认值**

适用于默认位于末尾的两种情况

```
int a=0;
switch(a){
    default:
} 
```

或者在中间的某个地方

```
switch(a){
    default:
    case 1:
        break;
} 
```

**带有列表的注释**

```
@SuppressWarnings({"boxing","cast"}) 
```

提示：改用 Groovy 列表文字语法：

```
@SuppressWarnings(["boxing","cast"]) 
```

**本机方法声明**

```
public native int nativeMethod(); 
```

**1.6 中每个枚举的类（在更高的 Groovy 版本中有效）**

```
public enum JavaEnum{
  ADD{
    public String getSymbol(){ return "+"; }
  };
  abstract String getSymbol();
} 
```

**做循环**

```
do{
  System.out.println("stuff");
}while(true); 
```

**平等**

虽然在技术上`==`是有效的 Groovy 和 Java，但它在语义上是不同的。这是您不能仅仅依靠将 Java 编译为 Groovy 而不进行更改的原因之一。更糟糕的是，由于 Java 字符串实习，它有时似乎可以工作。

该示例太长，无法添加到现有答案中，但关键是，在***语法上*****像 Groovy 一样有效****的 Java 代码***在运行时的行为可能会有所不同。*

 *要在 Groovy 中`x == y`为两个非空对象获得与 Java 相同的结果。是有效的 Groovy，它只是*做了一些不同*的事情。`x.is(y)``x == y`

 *[Groovy 文档有更详细和更广泛的差异列表](http://groovy-lang.org/differences.html)。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-26T21:48:08.163

好的，这里有一点：

```
int[] i = { 0, 1, 2 }; 
```

这在 java 中是很好的语法，在 groovy 中是不好的。

我认为您不想假设任何给定的 java 代码在 groovy 中都是等效的。 [该站点](http://groovy-lang.org/differences.html)描述了一些差异，其中包括基本的东西 == 在两种语言中并不意味着相同的东西。另外，静态数组初始化不同，没有匿名内部类。

这在 Java 1.6 中编译得很好

```
public class Test2 {
    int[] i = { 0, 1, 2 };

    private class Class1 {
        public void method1() {
            if (i[2] == 2) {
                System.out.println("this works");
            }
        }
    }

    public void method1() {
        Class1 class1 = new Class1();
        class1.method1();
    }
} 
```

但是在 Groovy 中是错误的。它在 Groovy 1.6 中给出了以下错误：

```
unexpected token: 1 @ line 2, column 14.

Class definition not expected here. Possible attempt to use inner class. Inner classes not supported, perhaps try using a closure instead. at line: 4 column: 2. 
```

但是，如果您修复了这些问题，它确实会打印出您期望的内容。

如果您正在寻找较新的语言语法问题，例如泛型或注释，Groovy 支持这两者，但不完全支持。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-06-27T06:09:38.930

多维数组，其中未指定大小。

```
def x=new Object[5][];  // ERROR: expression expected 

def x=new Object[5][2]; // this works 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-09-22T12:45:30.063

补充彼得多尔伯格的答案：

除了在 Groovy 中无效的有效 Java 代码外，您还需要警惕在 Java 和 Groovy 中都有效但在 Groovy 中产生不同结果的代码。明显的例子是 char 字面量和 GStrings：

```
System.out.println(String.valueOf('3' + 3)); // 54 in Java, 33 in Groovy (arithmetic ascii value vs. String concat)

System.out.println("${3+4}"); 
```

隐式访问器：

```
class Foo {public static int counter; public static int bar; public static void getBar() {counter++; return bar;}}
System.out.println(Foo.bar);
System.out.println(Foo.counter); // 0 in Java, 1 in Groovy 
```

toString() 已被 GroovyDefaultMethods 覆盖，当您解析结果时它可能会咬到您。

```
Map someMap = new HashMap();
someMap.put("a", "b")
someMap.toString(); 
```

等于操作

```
"foo" == "foo"
class Foo {public boolean equals() {return true;}}
new Foo() == new Foo() 
```

一些运算符优先级：

```
a *= b/100; // Groovy: (a *= b)/100; Java: a *= (b/100); 
```

这不是对原始问题的正确答案，因为 groovy 代码本身在语法上仍然有效，但由于它有不同的结果，我认为这里值得一提。结果是，从算法上讲，一个方法在从 Java 复制到 Groovy 时可能会返回错误（无效）的结果。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-26T22:15:20.343

目前我能想到的只有：

*   `int def;`
*   `String s = "$$";`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-02-03T23:13:31.967

有没有人提到==的区别？我把它取自 Grails 文档。

== 表示所有类型都等于。在 Java 中有一个奇怪的语法部分，其中 == 表示原始类型的相等性， == 表示对象的身份。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-04-28T19:10:46.380

在变量名之后使用 [] 而非类型声明给定类型的数组在 Java 中有效，但在 Groovy 中无效。

`byte[] buff = new byte[1024]; // Works`

`byte buff[] = new byte[1024]; // Not Groovy`

导致原始类型文字：字节不能用作方法名称

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-31T18:04:13.963

非静态初始化块：

```
class Foo {
  Integer x;   
  { x = 1; }
} 
```

更新：这实际上是有效的 Groovy 代码。

# javascript - 具有透明背景悬停效果的圆角

> ID：687602
> 
> 赞同：3
> 
> 时间：2009-03-26T21:26:59.337
> 
> 标签：javascript, jquery, html, css, internet-explorer

在我的网站上，每个菜单按钮都使用[dd_roundies](http://www.dillerdesign.com/experiment/DD_roundies/)库进行圆角处理，并通过 JQuery 分配了 mouseover、mouseout 和 onclick 处理程序。相关的JS代码是：

```
$(function(){

    // Add an event handler to the menu items that changes the background colour on mouse-over
    // and reverts it on mouse-out.
    $('div.nav-box').hover(
      function() {
        $(this).addClass('highlight');
        document.body.style.cursor = 'pointer';
      }, 
      function() {
        $(this).removeClass('highlight');
        document.body.style.cursor = 'default';
      }
    );

    // Add an onclick handler to each menu item
    $('div.nav-box').click(
      function() {
        // Change the current page to the 'href' value of the nested <a> element
        document.location.href = $(this).find("a:first").attr("href");
      }
    );

    // Round the corners of the menu items 
    DD_roundies.addRule('.nav-box', '20px', true);
}); 
```

这一切在 FF 中运行得非常好，但在 IE7 中却是一团糟。最明显的问题是鼠标悬停时应用的背景是方形的（不是圆形的），并且在某些情况下，当您单击菜单项然后鼠标移出后，背景不会消失。

我不希望任何人弄清楚如何修复上面的代码，但是如果您知道另一种方法：

*   对 div 应用透明圆角（以便父元素的颜色通过圆角显示）
*   当圆形 div 的背景颜色发生变化（例如，通过 mouseover 事件处理程序）时，新的背景颜色会占据相同的圆形区域
*   适用于 IE7 和 FF3（至少）

换句话说，让上面提到的菜单在 IE 中像在 FF 中一样工作。我愿意用其他人替换现有的 JS 库，改用 CSS 或其他......

谢谢，唐

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-31T15:05:04.487

我在 IE 中使用[jQuery Corner](http://www.malsup.com/jquery/corner/)处理圆角时运气不错。我已经对其进行了测试，它满足了您上述所有需求。

```
$(document).ready(function(){
    $("div.nav-box").corner("20px");

    $("div.nav-box").click(function(){
        //
    });
}); 
```

我还将任何基于悬停的样式更改移动到 CSS 中。虽然要让悬停在 IE6 中工作，但您需要像上面那样。

```
div.nav-box
{
    cursor: default;
    background-color: Blue;
}

div.nav-box:hover
{
    cursor: pointer;
    background-color: Red;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-04T08:17:45.987

我没有亲自尝试过，但我相信有一种方法可以让 PNG（支持 alpha 层透明度）在 IE 中使用 HTML 组件 (.htc) 工作。看看[这个链接](http://www.twinhelix.com/css/iepngfix/)。

使用该 .htc 文件，您应该能够使用 PNG 背景图像通过 CSS 创建抗锯齿圆角。

# windows - MFC 罐头 DllMain 不为 DLL_PROCESSS_DETACH 调用 ExitInstance？

> ID：687603
> 
> 赞同：1
> 
> 时间：2009-03-26T21:26:59.477
> 
> 标签：windows, dll, mfc, dynamic-linking

MFC 8.0 的罐装 DllMain 在获得 DLL_PROCESS_DETACH 时似乎不会调用 ExitInstance。一种可能的解决方案是定义我自己的 DllMain，但我如何告诉链接器使用我的而不是 MFC？

或者，是否有另一个我不知道的在 DLL_PROCESS_DETACH 上被调用的覆盖？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T23:39:31.267

对于使用 /clr 编译的项目，我遇到了类似的问题。你有同样的情况吗？我永远无法将其跟踪到特定条件，但是将一些静态初始化程序更改为设置 null 清除了它。我认为这与静态析构函数的注册顺序有关。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-04T03:06:36.613

我不确定为什么不调用您的 ExitInstance，但是可以通过将 MFC 的 dllmodul.cpp 文件的内容复制到您的 dll 中的文件中并添加任何额外的必需功能来定义您自己的 DllMain。[此 MS 知识库文章](http://support.microsoft.com/kb/148791)中记录了该过程。虽然它是为 MFC 4.0 编写的，但我已经成功地将这种方法用于使用 MFC 8.0 的应用程序。

# function - 在 MATLAB 中，函数名称中允许使用哪些 ASCII 字符？

> ID：687605
> 
> 赞同：4
> 
> 时间：2009-03-26T21:27:12.627
> 
> 标签：function, matlab, variables, syntax, naming-conventions

我有一组对象，我从中读取信息，其中包含最终成为 MATLAB m 文件的信息。一条信息最终成为 MATLAB 中的函数名称。在将 M 文件写入文件系统之前，我需要从该字符串中删除所有不允许的字符。有人能告诉我哪些字符构成了 MATLAB 函数名称中允许的字符集吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-27T01:55:20.503

合法名称遵循模式 [A-Za-z][A-Za-z0-9_]*，即一个字母字符后跟零个或多个字母数字或下划线字符，最多为 NAMELENGTHMAX 个字符。

由于 MATLAB 变量和函数命名规则相同，您可能会发现[genvarname](http://www.mathworks.com/help/matlab/ref/genvarname.html)很有用。它将任意字符串清理为合法的 MATLAB 名称。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-26T21:56:45.317

**简短的回答...**

任何字母数字字符或下划线，只要名称以字母开头。

**更长的答案...**

MATLAB 文档有一个“[使用 M 文件](http://www.mathworks.com/access/helpdesk/help/techdoc/matlab_prog/f7-41453.html)”部分，其中更详细地讨论了命名。具体来说，它指出了函数[NAMELENGTHMAX](http://www.mathworks.com/access/helpdesk/help/techdoc/ref/namelengthmax.html)（操作系统将注意的名称中的最大字符数）、[ISVARNAME](http://www.mathworks.com/access/helpdesk/help/techdoc/ref/isvarname.html)（检查变量/函数名称是否有效）和[ISKEYWORD](http://www.mathworks.com/access/helpdesk/help/techdoc/ref/iskeyword.html)（显示受限关键字）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-26T21:33:09.290

编辑：

这可能会提供更多信息：

[http://scv.bu.edu/documentation/tutorials/MATLAB/functions.html](http://scv.bu.edu/documentation/tutorials/MATLAB/functions.html)

# windows-services - 从 Web 服务调用 Windows 服务

> ID：687608
> 
> 赞同：2
> 
> 时间：2009-03-26T21:27:42.050
> 
> 标签：windows-services, web-services

我正在使用 .Net 2.0 框架并想从 Web 服务调用 Windows 服务中的函数。这可能吗？如果是的话，我将对函数有多少控制权，即传递参数、取回结果等。任何想法将不胜感激:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T21:34:05.483

如果您需要传递参数值，[远程处理是您的最佳选择。](http://www.csharphelp.com/archives2/archive423.html)

如果您不需要共享对象或任何太复杂的东西，[ServiceController](http://msdn.microsoft.com/en-us/system.serviceprocess.servicecontroller.aspx)可能更容易。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T21:34:28.633

您可以通过 .NET 远程处理来完成。如果你走那条路，看起来你正在调用一个方法并得到一个结果，但是你的所有参数都将通过网络进行序列化，结果将被序列化回来。因此，一切都必须可序列化。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-27T02:49:40.170

如何在 Windows 服务中托管 WCF 服务。您可以使用 net.tcp 或命名管道在“您的”Web 服务和 Windows 服务中的服务之间进行通信。您可以使用 NetDataContractSerializer 进行类型保真的序列化。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T20:54:20.400

为什么不将函数打包在自己的DLL中，然后与Windows服务和Web服务分开分发呢？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T21:38:06.550

您*可以*实现一个基本的 http 服务器，将某些请求映射到函数。查询字符串将映射到参数。实际上并不难，我过去也这样做过（因为我提供了一些基本的基于模板的报告）。它不是动态的，但可以动态完成。以 HttpListener 为起点。您也可以在其中托管 asp.net 引擎。

它有它的优点和缺点。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-26T22:11:15.597

创建导出接口 COM 或使用 PIPE 传输数据的服务项目。[在 C# 中使用命名管道](http://www.switchonthecode.com/tutorials/interprocess-communication-using-named-pipes-in-csharp)查看此进程间通信

# jquery - 我可以使用 jquery Autocomplete 进行全文搜索吗？

> ID：687609
> 
> 赞同：0
> 
> 时间：2009-03-26T21:28:03.780
> 
> 标签：jquery, autocomplete

我希望能够搜索全名列表。我看过的自动补全demo都是从头搜索过的。那不好，因为我也想匹配姓氏。

如果至少遵循单词边界，我可以不用全文搜索。有点像这里的标签搜索。那是怎么做的？

干杯

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T21:30:45.210

你可以。只需从执行实际搜索的服务器端函数中获取项目。例如 SQL 服务器。你应该考虑性能。大量的行可能需要足够长的时间才能产生“片状”自动完成。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-12-10T20:05:02.517

这是一个搜索名字和姓氏的片段，即使您的搜索词中有多个部分单词：

```
var arrayOfNames = [{first:"John", last:"Box"},{first:"Rachel", last:"Park"}
               ,{first:"Rachel", last:"Dark"},{first:"Rachel", last:"Luck"}];

$("#input").autocomplete({
    source: function( request, response ) {
        var names = [];
        var searchTerms = request.term.split(" ");;
        $.grep(arrayOfNames, function(person, i) {
            var matches = 0;

            $.each(searchTerms, function(i, term) {
                if(person.first.indexOf(term)>=0 || person.last.indexOf(term)>=0)
                    matches++;
            });

            if(matches == searchTerms.length)
                names.push({value:person.first+" "+person.last});
        });

        response(names);
    }
}); 
```

在这里查看它的实际效果：http: [//jsfiddle.net/t29req1s/1/](http://jsfiddle.net/t29req1s/1/)

# architecture - 对于阵列密集型计算，一种架构相对于另一种架构有什么优势？

> ID：687613
> 
> 赞同：0
> 
> 时间：2009-03-26T21:28:58.943
> 
> 标签：architecture, hardware, cpu-architecture

我很想知道是否存在一种可以更快地处理数组密集型计算的架构。例如; 在 MIPS 工作站上运行的一些任意 C 代码会比在 x86 工作站上运行更快吗？我想一个更好的问题是*某些架构是否有更快的 FPU*？

我知道重型阵列和矩阵运算的较新选项之一是 GPU 计算和使用 Nvidia 的 CUDA 等工具，但我对传统 CPU 级别存在的内容更感兴趣。谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T21:32:27.733

过去，许多超级计算机使用[矢量处理器](http://en.wikipedia.org/wiki/Vector_processor)，它们基本上同时在多个阵列元素上运行。它们仍然用于一些小众领域（维基文章提到了视频游戏），但不适用于典型的桌面。可能您在标准桌面中找到的最接近的东西将涉及使用 GPU 进行非图形工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T21:35:51.797

当然有架构的优点和缺点。有一段时间，PowerPC 芯片在一系列浮点密集型基准测试中始终击败英特尔同类产品。这种差异反映在他们运行我当时正在研究的一些核物理代码的速度上。

然而，他们像狗一样运行 Word 和 Excel，然后他们的时钟速度真的开始下滑，桌面上的 PowerPC 芯片一切都结束了。我认为 Apple 只会坚持他们这样做，以便他们可以让多架构执行层顺利工作。

另请注意，如今许多架构都有 SIMD（单指令多数据，即矢量化）浮点和整数算术单元（例如 AltiVec、MMX、SSE 等）。与 GPU 等专用处理器相比，这些在通用芯片中只是轻度矢量化。

# c# - 代表的目的

> ID：687626
> 
> 赞同：21
> 
> 时间：2009-03-26T21:32:15.097
> 
> 标签：c#, .net, delegates

### 复制：

> [事件和委托及其各自应用程序之间的区别](https://stackoverflow.com/questions/563549/difference-between-events-and-delegates-and-its-respective-applications)
> 
> [代言人有什么好处？](https://stackoverflow.com/questions/639320/what-are-the-advantages-of-delegates)
> 
> [我在哪里使用代表？](https://stackoverflow.com/questions/31497/where-do-i-use-delegates)

我想知道代表的目的是什么。我没有太多地使用它们，也无法真正想到一些东西。

在我的课程中，委托是所有符合其签名的方法的蓝图。

此外，您可以向一个委托添加多个方法，然后它们将按照添加的顺序依次执行。这可能仅对影响局部变量的方法或不返回任何值的方法有用。

我读过 C# 将事件实现为委托，这被记录为：

```
//Summary: Represents the method that
will handle an event that has no event
data.

//Parameters:

//sender: The source of the event.

//e: An System.EventArgs that contains no event data.

[Serializable]

[ComVisible(true)] 

public delegate void EventHandler(object sender, EventArgs e); 
```

尽管如此，这还是有点令人困惑。有人可以给出这个概念的一个很好的有用的例子吗？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-03-26T21:38:24.160

是的，

您快到了。委托是指要调用的方法或函数。.NET 使用事件来表示.. 当有人按下此按钮时，我希望您执行这段代码。

例如，在使用 GPS 应用程序时：

```
public delegate void PositionReceivedEventHandler(double latitude, double longitude); 
```

这表示该方法必须将两个双精度值作为输入，并返回 void。当我们定义一个事件时：

```
public event PositionReceivedEventHandler PositionReceived; 
```

这意味着 PositionRecieved 事件调用与我们定义的 PositionReceivedEventHandler 委托具有相同定义的方法。所以当你这样做时

```
PositionRecieved += new PositionReceivedEventHandler(method_Name); 
```

method_Name 必须与委托匹配，以便我们知道如何执行该方法，它需要什么参数。例如，如果您使用 Visual Studio 设计器将一些事件添加到按钮，它将全部适用于需要对象和 EventArgs 参数的委托。

希望对一些人有所帮助...

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-03-26T21:42:34.480

正如您所指出的，委托是一种为方法调用创建签名的方法。使用委托有很多很好的例子，但真正让我大开眼界的是这个例子。

```
public delegate Duck GetDuckDelegate();

public GetDuckDelegate GiveMeTheDuckFactoryMethod(string type)
{
  switch(type)
  {
    case "Rubber":
      return new GetDuckDelegate(CreateRubberDuck);
    case "Mallard":
      return new GetDuckDelegate(CreateMallardDuck);
    default:
      return new GetDuckDelegate(CreateDefaultDuck);
  }
}

public Duck CreateRubberDuck()
{
  return new RubberDuck();
}

public Duck CreateMallardDuck()
{
  return new MallardDuck();
}

public Duck CreateDefaultDuck()
{
  return new Duck();
} 
```

然后使用它

```
public static void Main() {
  var getDuck = GiveMeTheDuckFactoryMethod("Rubber");
  var duck = getDuck();
} 
```

可以说，工厂模式会是一个更好的方法，但我只是临时想出了这个例子，并认为它证明了如何将委托视为对象

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-26T21:48:47.460

委托允许您传递类似值的方法。

例如，.Net 有一个名为的方法`Array.ForEach`，它接受一个委托和一个数组，并在数组的每个元素上调用委托。

因此，你可以写，

```
int[] arr = new int[] { 1, 2, 4, 8, 16, 32, 64 };
Array.ForEach(arr, new Action<int>(Console.WriteLine)); 
```

此代码将调用`Console.WriteLine`数组中的每个数字。

通过制作接受委托的函数，您可以做很多事情，尤其是与匿名方法结合使用时。例如，看看[LINQ](http://en.wikipedia.org/wiki/LINQ#Language_Extensions)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-10-20T07:54:53.387

许多人最初对代表和事件的真正需求感到困惑。我是其中之一，我花了一些时间才弄清楚:-)。最近在 ASP.NET 论坛中回答了一个类似的查询，并认为如果我创建一个关于这个主题的博客文章会很好！这是查询：

“我在某个银行类的某个地方阅读了一个示例，如果达到最低余额，您需要通知应用程序的其余部分已达到最小值，但我们不能通过调用普通方法来做到这一点。例如：假设当我们从余额中扣除一些金额并且如果达到最小值然后调用一些方法来采取一些行动，我完全想念为什么我们需要委托和自定义事件？”

事情是在银行的情况下，你当然可以调用一个方法，但这将是简单的过程编程，当我们希望我们的代码响应系统生成的一些事件时，我们需要基于事件的编程。

例如：认为windows操作系统是一个系统，我们正在编写一个代码（用任何语言），我们想在其中捕获一个像mouse_click（）这样的事件。现在我们的程序如何知道发生了鼠标点击？我们可以为它使用低级代码，但由于操作系统已经在处理低级代码，最好捕获操作系统引发的事件。

换句话说，当 mouse_click() 发生时，操作系统会触发一个事件。操作系统不关心谁捕获并使用它，它只是发送一个通知。然后任何代码（如我们的）都可以捕获该事件并相应地使用它。这为我们节省了大量时间来自己编写代码。其他程序也可以使用相同的事件并相应地处理它。

同样，银行系统可能很大，许多其他外部应用程序可能正在访问它。银行系统不知道有多少这样的应用程序需要它或依赖它，也不知道它们将如何处理某些情况，例如余额不足时，所以它只是在余额不足时触发一个事件，而这个事件可以除了银行代码本身之外，任何其他代码都可以使用。

请注意，该事件的每个订阅者都可以独立处理该事件，例如。如果余额不足，银行代码可能会停止执行某些操作，其他一些报告应用程序可能会在这种情况下发送电子邮件，或者某些 ATM 代码可以停止特定交易并通知用户余额不足。

希望这能澄清一些事情！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-26T21:38:20.730

我可以为您提供一个使用 Web 应用程序架构的示例：

通常，使用 Web 应用程序，您可以提供一个前端控制器来接收来自许多客户端的请求。我们可以将所有方法放在前端控制器中，以处理来自客户端的许多不同类型的请求。但是，这有点麻烦。相反，我们可以使用委托来封装不同请求的功能。我们可以有：

*   身份验证代表
*   用户管理代表

等等。因此，这是一种将功能拆分为逻辑块（委托）的巧妙方法。Struts 框架基于这种工作方式（ActionServlet 和 Action 类）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-26T21:39:16.780

有很多优秀的文章解释了代表 - 这里有一些很好的文章：

> [代表和事件](http://www.yoda.arachsys.com/csharp/events.html)
> [C# 代表解释 C#](http://www.aspfree.com/c/a/C-Sharp/C-Sharp-Delegates-Explained/)
> [中的代表](http://www.exforsys.com/tutorials/csharp/delegates-in-csharp.html)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-26T21:53:24.670

据我了解，委托提供了一种专门化类行为而不继承它的方法。

一些类具有复杂的泛型行为，但仍然是专门的。想一想 GUI 框架中的 Window 类：一个 Window 可以自己做很多事情，但您很可能仍然希望以某种方式专门化它。在某些框架中，这是通过继承完成的。一种不同的做法是与代表一起。假设您希望在 Window 调整大小时发生一些事情：然后您的委托类可以实现一个名为 onWindowResize 的方法（当然前提是 Window 类支持此方法），每当 Window 调整大小时都会调用该方法，并在 Window 时负责任何特殊行为调整大小。

我不会争论委托优于继承的优点，但只要说有很多人认为委托比继承“更干净”就足够了。

# firefox - 为什么 alt 属性会在 Firefox 中显示一瞬间？

> ID：687633
> 
> 赞同：0
> 
> 时间：2009-03-26T21:34:28.023
> 
> 标签：firefox

我正在使用课程管理系统 Moodle，在管理员中，文件夹树（使用文件夹图标）显示大约一秒钟给定的 alt 属性（在本例中为“打开文件夹”），然后它隐藏并显示图像时图像准备好了。

系统有点慢，所以我假设 Firefox 起初认为图像不存在。

这是一个问题，因为在那一瞬间，布局会拉伸以适应更宽的单词，这使得我认为它看起来不专业。

有没有办法可以隐藏这个标签而不必删除 alt 标签？（这将是劳动密集型的）可能使用 JQUERY 或 CSS。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T19:29:00.827

> 显示给定的 alt 属性大约一秒钟（在本例中为“打开文件夹”），然后在图像准备好时隐藏并显示图像。

是的，这就是替代文本的用途：它为图像不可用时提供了一种文本替代方案——无论是因为出现错误，还是在浏览器设置中关闭了图像，或者在这种情况下，文件只是没有还没到。

替代文字真的是您想要的吗？除非有问题的图像实际上包含“打开文件夹”字样，否则以上内容是不恰当的替代文字。如果我们谈论的是打开树的那些小加号/减号图标之一，更好的替代文本将是“+”。“打开文件夹”，作为对图像*作用*的描述（而不是它*包含*的内容），将更好地应用于用于工具提示的“标题”属性。

请注意，如果您使用的是 Quirks 模式并且图像具有指定的固定大小，Firefox 将使用“损坏的图像”图标，其中覆盖并裁剪了替代文本，而不是单独的纯替代文本。这是为了匹配 IE 的旧行为。但是您并不想使用 Quirks Mode，并且在固定大小较小的常见情况下，裁剪会使 alt 文本不可读且无用。

> 这是一个问题，因为在那一瞬间，布局会拉伸以适应更宽的单词，这使得我认为它看起来不专业。

我建议：克服它。这就是网络滚动的方式，任何页面在逐渐呈现时都可以移动一点。对于图像，您应该只看到一次，然后图像将被缓存并立即出现。如果不是，则缓存设置有问题。

根据您所谈论的布局类型，您也许可以修复它以不响应不断变化的图像大小。例如，如果使用表格，在表格上设置“table-layout: fixed”，在顶行的图像单元格上设置“width: (some number of)px”，即使里面的文本更小，它也会保持该宽度。请注意，可能会导致替代文本进入下一个单元格。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T21:42:06.943

如果图像是布局的一部分，我建议将它们移至 CSS。您还应该尽可能[优化](http://yuiblog.com/blog/2008/10/29/imageopt-1/)图像，无论它们是 CSS 还是其他。您还可以尽可能将您的 JavaScript 文件移动到页面底部，因为它们会[阻止并行下载](http://developer.yahoo.com/performance/rules.html#js_bottom)。一般来说，在[这里](http://developer.yahoo.com/performance/rules.html)应用很多技术可能会有所帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T21:59:43.393

如果图像必须具有一定的宽度，请给它们一个明确的宽度。

# c# - 重构问题

> ID：687637
> 
> 赞同：0
> 
> 时间：2009-03-26T21:35:09.490
> 
> 标签：c#, data-structures, methods, memorystream, xmltextwriter

给定一个方法

```
 public static string[] Foo(System.IO.Stream stream)
    {
        XmlTextWriter xmlWriter = new XmlTextWriter(stream,   System.Text.Encoding.ASCII);

        xmlWriter.WriteStartDocument();
        xmlWriter.WriteStartElement("Element");
        xmlWriter.WriteEndElement();
        xmlWriter.WriteEndDocument();
        xmlWriter.Flush();

        return new string[3]{"1", "2", "3"};
    } 
```

和一个调用代码

```
using(MemoryStream memStream = new MemoryStream())
{
     string[] playerIDs = PlayerCommand.Foo(stream);
     // do some stuff with stream and playerIDs
} 
```

当控件超出 using 指令时，是否存在 xmlWriter 未在 Foo 中显式关闭的问题（这会使流无用）？

此外，在方法之间传递 Stream 是否令人讨厌，是否有更好的方法将 XMLWriting 的结果传递回调用代码（这会将其压缩并归档）？

在此先感谢，格雷格

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T21:40:26.527

这里没问题。StreamWriter 的`Dispose()`方法基本上首先调用`Flush()`然后处理底层流，所以只要你`Flush()`自己有覆盖（你在上面做的）只要流还活着就可以让它挂起。

其他答案建议处置 Writer 本身，但这在这里并不是一个真正的选择，因为它也会处置底层流。

也就是说，如果您只是将 XML 文档放入流中然后稍后使用它，我宁愿传递 XML 文档本身而不是跟踪流。但也许你的代码并不那么简单。

# embedded - PIC24 的 F/OSS？

> ID：687641
> 
> 赞同：2
> 
> 时间：2009-03-26T21:36:20.500
> 
> 标签：embedded, pic

我正在使用 PIC24 学习嵌入式编程，并且正在寻找一些“真实世界”的东西来帮助我学习。是否有任何针对 PIC 的免费软件项目？有什么我可以帮助移植的，或者我可以尝试填补的利基市场吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T00:40:59.807

相当古老（2005），但可以帮助您开始：

[http://www.gnupic.org/](http://www.gnupic.org/)

例如，位于[http://www.dattalo.com/gnupic/gpsim.html的 gpsim](http://www.dattalo.com/gnupic/gpsim.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-04T15:59:14.677

如果您正在寻找软件项目，请查找 gputils - 是开源汇编器和链接器，以及 sdcc - 开源 c/c++ 编译器（缺少 PIC24 端口）。

如果您正在寻找嵌入式项目，则没有什么特别的想法。但是，请访问图片列表以获取代码片段并从示例中学习。一些最好的 PIC 编码员在那里做出了贡献。

如果您正在寻找硬件项目，opencores 上有 verilog PIC16/18 内核，但还没有 PIC24 内核。

所以，有很多东西可以满足所有的口味。

# wpf - 3d 元素作为 WPF ListBox 中的项目

> ID：687660
> 
> 赞同：1
> 
> 时间：2009-03-26T21:40:30.070
> 
> 标签：wpf, 3d, datatemplate

我想知道是否有人知道在 XAML 中是否有可能有一个 ListBox，其 DataTemplate 将 ListBoxItem 定义为 3d 元素。类似于以下内容：

```
 <ListBox x:Name="lst3D" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Viewport3D>
                            <Viewport2DVisual3D>
                                <Viewport2DVisual3D.Transform>
                                    <RotateTransform3D>
                                        <RotateTransform3D.Rotation>
                                            <AxisAngleRotation3D Angle="40" Axis="0, 1, 0" />
                                        </RotateTransform3D.Rotation>
                                    </RotateTransform3D>
                                </Viewport2DVisual3D.Transform>
                                <Viewport2DVisual3D.Geometry>
                                    <MeshGeometry3D Positions="-1,1,0 -1,-1,0 1,-1,0 1,1,0"
                        TextureCoordinates="0,0 0,1 1,1 1,0" 
                        TriangleIndices="0 1 2 0 2 3"/>
                                </Viewport2DVisual3D.Geometry>
                                <Viewport2DVisual3D.Material>
                                    <DiffuseMaterial Viewport2DVisual3D.IsVisualHostMaterial="True" Brush="AliceBlue"/>
                                </Viewport2DVisual3D.Material>

                                <Label>Hello, 3D</Label> // we'd like to databind controls like this one

                            </Viewport2DVisual3D>
                        </Viewport3D>
                    </DataTemplate>
                </ListBox.ItemTemplate>
                <ListBoxItem />
                <ListBoxItem />
                <ListBoxItem />
            </ListBox> 
```

有人看过这种事情吗/有什么建议吗？

非常感谢，bv

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T22:33:52.547

有几种方法可以做到这一点。

您可以将 DataTemplate 更改为 ControlTemplate，并将其应用于 ListBox 中的所有项目。但是您不能将其绑定到特定的数据类型。

另一个选项是将 DataTemplate 移动到资源部分，并将 DataType 设置为您希望显示的项目的类型。然后您可以使用绑定来绑定到项目的属性等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T06:30:44.663

将按钮替换为内容控件，例如，

```
 `<ContentControl Content="{Binding}" />` 
```

`它看起来`Viewpord3D`也不需要布局空间，所以我需要将它包装在 a`<Grid Height="100" Width="100">...</Grid>`中以查看任何内容。

# tree - 遍历图与遍历树

> ID：687661
> 
> 赞同：3
> 
> 时间：2009-03-26T21:40:44.343
> 
> 标签：tree, graph-theory

遍历图的函数是否同样适用于遍历树？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-26T21:42:52.497

好吧，树只是一种特殊类型的图，称为有向无环图，所以是的……广度优先和深度优先遍历都适用于树。

我可以写出关于广度和深度优先遍历之间差异的详细解释，但我可能会弄错（我还不是一个沉重的 comp-sci 人）。

可以这么说，宽度优先遍历和深度优先遍历之间的唯一区别是处理顶点的顺序。广度优先，您可以将其视为将顶点添加到“待处理”队列。深度优先，您可以将其视为将顶点添加到“待处理”堆栈中。当需要处理顶点时（在它们被添加到各自的数据结构中之后），您可以出列或弹出堆栈以获取下一个要处理的顶点。深度优先遍历的聪明版本使用递归来处理顶点，而不是将它们添加到堆栈中。

我不知道这是否有帮助...

一个快速的谷歌搜索（我不知道它是首先是广度还是深度）发现[这](http://www.google.com/search?hl=en&safe=off&q=Differences+between+depth+first+and+breadth+first+traversal+of+trees&btnG=Search)似乎很好地描述了 BFS 和 DFS 之间的差异。如果您想更深入地阅读，我还可以推荐 Steve Skiena 的[算法设计手册。](https://rads.stackoverflow.com/amzn/click/com/1848000693)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T21:59:11.193

可以遍历一般图的函数对于遍历树来说可能是多余的，因为在纯树中您不必检查循环。所以它会起作用，但更简单的东西也会起作用。

# jquery - 使用 jQuery 在文本框中单击时打开窗口

> ID：687663
> 
> 赞同：2
> 
> 时间：2009-03-26T21:41:33.793
> 
> 标签：jquery, asp.net-mvc, jquery-ui-dialog

我想创建一个类似于[www.redfin.com](http://www.redfin.com)在其搜索页面上的功能。当用户在文本框中单击时，将打开一个搜索表单。

我正在使用 MVC 和 jQuery，但不知道如何去做。我尝试使用 Dialog 插件，但由于某种原因，对话框只打开一次。

```
<input id="txtSearch" type="text" />
<div id="searchForm" title="Dialog Title">I am a dialog</div>

$("#txtSearch").click(function() {
    // Show form
    $("#searchForm").dialog();
}); 
```

但是，在常规网站中，对话框甚至不会打开。

```
$("#txtSearch").click(function() {
        // Show form
        $("#searchForm").dialog();
    }); 
```

使用焦点或单击似乎具有相同的效果。该对话框仅打开一次。当我关闭它并再次单击文本框时，没有对话框。

**我是否使用正确的方法来完成这项任务？有样品吗？欢迎提出建议。**

对话框可能不是最佳选择，因为它创建了标题。我想知道我还能使用什么，因为我还想通过 ajax 发布表单并在同一页面上显示结果。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T21:52:13.287

并且您要确保将事件绑定包装在文档就绪脚本中（您可能已经这样做了，但我只是指出它，因为它不在您的示例代码中，以防万一）

```
$(document).ready(function() {
    $("#txtSearch").click(function() {
        // Show form
        $("#searchForm").dialog();
    });
}); 
```

**编辑**

$("#searchForm").dialog(); 只将对话框注册到我认为的搜索表单

我想你可能需要调用一个对话框 show() 和 hide() 让它出现和消失。我以前使用过[jqModal](http://dev.iceburg.net/jquery/jqModal/)并且不得不这样做

```
$(document).ready(function() {
    $("#searchForm").jqm({modal: true}); //register this div as a modal

    $("#txtSearch").click(function() {
        // Show form
        $("#searchForm").jqmShow(); //show div
    });
}); 
```

稍后，要关闭模式，您调用

```
$("#searchForm").jqmHide(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T21:48:30.893

您可能想使用[`focus`](http://docs.jquery.com/Events/focus#fn)事件而不是`click`事件。

至于该对话框的用途，我建议查看[`BeautyTips`](http://www.lullabot.com/files/bt/bt-latest/DEMO/index.html). 查看该页面中的“自定义触发器”示例，这正是您想要做的。

# mysql - MySql 查询帮助：带总和和计数的关节

> ID：687664
> 
> 赞同：1
> 
> 时间：2009-03-26T21:41:38.617
> 
> 标签：mysql, join

我有这个数据库结构：

```
TBL_A  |  TBL_B  |  TBL_C  |  TBL_D  | TBL_E
-------+---------+---------+---------+----------
id     | id_tbla | id_tbla | id_tbla | id
name   | id_user | id_user | id_user | name_tbla
...    | is_bool |         | weight  | id_user 
```

这是我想要实现的目标：

```
SELECT 
    a.id, 
    a.name, 
    b.is_bool,
    count(c.id_user) AS nb_views, 
    sum(d.weight) AS total_weight,
    count(distinct e.id_user) AS distinct_users,
FROM TBL_A AS a 
LEFT JOIN (TBL_B AS b) on (b.id_tbla = a.id)
LEFT JOIN (TBL_C AS c) on (c.id_tbla = a.id)
LEFT JOIN (TBL_D AS d) on (d.id_tbla = a.id)
LEFT JOIN (TBL_E AS e) on (e.name_tbla = a.name)
where a.id = 1 and e.id_user = 1 
```

执行了查询，但结果（nb_views、total_weight、distinct_users）是错误的。知道为什么吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T21:53:42.457

您试图在一个查询中计算太多的聚合。

> *Enita non sunt multiplicanda praeter necessitatem*
> 
> （拉丁文，“实体不得在必要时增加”）

您的表 B、C、D 和 E 是相互生成的[笛卡尔积](http://en.wikipedia.org/wiki/Cartesian_product)。假设 A 中的给定行匹配：

*   B 中 3 行
*   C中的6行
*   D 中 4 行
*   E 中的 1 行

结果中的总行数为 3 * 6 * 4 * 1 = 72 行。所以你`count(c.id_user)`是它应该是的 12 倍，你`sum(d.weight)`是它应该是的 18 倍，等等。

最简单的补救措施是在单独的查询中计算这些聚合中的每一个：

```
SELECT a.id, a.name, COALESCE(b.is_bool, FALSE) AS is_bool
FROM TBL_A AS a LEFT JOIN TBL_B AS b ON (b.id_tbla = a.id)
WHERE a.id = 1;

SELECT a.id, COUNT(c.id_user) AS nb_views
FROM TBL_A AS a LEFT JOIN TBL_C AS c ON (c.id_tbla = a.id)
WHERE a.id = 1;

SELECT a.id, SUM(d.weight) AS total_weight,
FROM TBL_A AS a LEFT JOIN TBL_D AS d ON (d.id_tbla = a.id)
WHERE a.id = 1;

SELECT a.id, COUNT(DISTINCT e.id_user) AS distinct_users,
FROM TBL_A AS a LEFT JOIN TBL_E AS e 
  ON (e.name_tbla = a.name AND e.id_user = 1)
WHERE a.id = 1; 
```

# wordpress - 在不破坏旧 URL 的情况下更改 wordpress 中的 URL 方案

> ID：687665
> 
> 赞同：1
> 
> 时间：2009-03-26T21:41:48.803
> 
> 标签：wordpress, url, url-rewriting, blogs, friendly-url

我创建了一个博客，在几篇文章之后我决定我不喜欢 /2009/03/26/foo-bar 的 URL 方案（我改为只是 /foo-bar）。但是对于在我更改此内容之前发布的几篇帖子，我想添加重写规则，这样旧的 URL 就不会中断。

我已经尝试了 .htaccess 文件中我能想到的以下所有变体，但无济于事：（请注意，除了“first-post”和“second-post”行之外的所有内容都是 wordpress 样板）

```
# BEGIN WordPress
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /

RewriteRule /2009/03/25/first-post /first-post
RewriteRule /2009/03/26/second-post /second-post

RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L]
</IfModule>
# END WordPress 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-08T10:34:39.883

试试 Dean Lee 的[Permalink 迁移插件](http://www.deanlee.cn/wordpress/permalinks-migration-plugin/)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T21:44:41.150

尝试

```
RewriteRule ^\d*/\d*/\d*/(.*) /$1 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T21:47:24.390

我刚刚尝试过的一个可行的解决方案是实际创建目录和子目录 2009/03/25/ 等，然后添加一个包含以下内容的 index.php 文件：

```
<?php
header('Location: http://example.com/first-post');
?> 
```

# c# - 如何让 C# 与 Javascript 互操作？

> ID：687669
> 
> 赞同：7
> 
> 时间：2009-03-26T21:43:42.150
> 
> 标签：c#, javascript, interop

我想在我的 C# 程序中托管 Javascript。我想允许用户编写自定义 Javascript 代码，让我的 C# 程序运行他们的功能，并允许用户使用我的框架代码。

是否有可能做到这一点？如果是这样，怎么做？

编辑：要清楚，我*没有*在这个项目中使用 ASP.NET。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T21:59:11.130

您还可以使用 webbrowser 控件将 javascript 托管在 html 文档中，以便在两者之间进行交互，您将创建一个 COM 可见类并将其实例设置为 ObjectForScripting 属性。

现在可以通过 javascript 中的 window.external 访问“外部”类的任何公共成员。此外，从托管代码方面，您可以使用文档的 InvokeScript 方法来调用任何 javascript 函数。

这种方式很容易在两者之间传递复杂的对象。

我在这个 Google Earth Api 应用程序中多次使用了这个想法。 [http://fraserchapman.blogspot.com/2008/08/google-earth-plug-in-and-c.html](http://fraserchapman.blogspot.com/2008/08/google-earth-plug-in-and-c.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T22:24:47.763

我强烈建议您使用[Microsoft Dynamic Language Runtime (DLR)](http://www.codeplex.com/dlr)。它的生活目的是促进.Net 环境中的脚本编写。DLR 不是特定于脚本的，因此随着时间的推移，将在其上构建更多的脚本语言，但目前我所知道的是 IronRuby、IronPython 和 JScript。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T21:52:21.320

[Spidermonkey .NET](http://freshmeat.net/projects/spidermonkey-dotnet)可能是您正在寻找的。

我不确定它的发展程度。但它基本上是[Mozilla 的 Spidermonkey](http://www.mozilla.org/js/spidermonkey/) Javascript 解析器引擎的一个端口，我非常喜欢它。

或者你可以[直接评估](http://www.west-wind.com/WebLog/posts/10688.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T22:58:13.533

以前的方法是使用 Windows Script Host，它允许您托管 JSCript 或 VBScript。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T21:52:22.457

您当然可以从 C# 本地运行 Javascript - 请参阅[这篇文章](http://www.west-wind.com/WebLog/posts/10688.aspx)作为入门。不过，让 Javascript 访问您的框架可能会更棘手。也许[Script#](http://projects.nikhilk.net/ScriptSharp/)可以提供帮助？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-26T22:00:24.467

您可以在其中嵌入 JavaScript 的 HTML 组件。对于另一种方式，正确的事情是 ASP.NET Web 服务。也许有了智能客户端，您可以将两者结合起来。

# sql-server-2005 - 使用 Sql 服务器复制

> ID：687673
> 
> 赞同：1
> 
> 时间：2009-03-26T21:44:31.353
> 
> 标签：sql-server-2005, replication

我们正在使用复制，并且似乎遇到了无穷无尽的问题。它似乎因未知原因而关闭。它需要关闭才能删除一列，并且只在一半的时间内重新启动。有没有人对如何正确使用复制或它的一些替代方案有任何建议。

编辑：

我们使用的是 Sql Server 2005，我们不能使用数据库镜像，因为我们使用其他数据库进行报告。据我所知，您无法从镜像数据库中查询。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T04:21:25.597

如果您只需要数据库中的几个表用于报告，则复制更有用，但您也可以在 STAND BY 模式下使用辅助服务器设置日志传送（特别是如果您需要大量数据用于报告），那么您可以在辅助服务器上运行报告。您只需要记住日志传送会干扰事务日志备份，因此您必须为两个进程使用包含日志备份文件的同一文件夹。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-20T11:41:41.700

我认为数据库镜像和数据库快照的结合将解决您的问题。

首先，数据库镜像很容易设置，我从来没有遇到过任何问题（过去 4 年多使用它）。

其次，在故障转移服务器上创建数据库快照将允许您运行报告。您可以设置一个 sql 代理作业，以在您喜欢的任何可接受的时间间隔内删除和重新创建快照。

*当然，这完全取决于您是否需要在实时数据上运行报告，或者它们是否会有所延迟。*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-19T22:14:55.570

以下是我必须解决以使复制工作的问题的列表：

1）复制有时对我撒谎并告诉我这一点，即使它工作正常。“服务器 'Bob' 不是订阅者。（.Net SqlClient 数据提供者）”我试图重新初始化它，认为它已损坏并且从未...

2）重新启动可能需要一点时间，特别是如果您的远程数据库位于地球的另一端，就我而言。如果您的网络连接速度较慢，或者它不是 100% 可靠的，那么您可能会遇到问题。此外，重新启动进程的作业有时可能需要一段时间才能运行，这也会进一步延迟。

3) 某些更改需要完全重新初始化，这涉及发送新快照。如果您没有完全正确的权限，并且您可以手动重新初始化，但它不会自动发生，那么这可能是问题的另一个原因。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T21:49:06.390

我们有一个完美运行的 SQL 事务复制。您似乎说，当您对发布者进行架构更改时，您会遇到问题。每次我们进行架构更改时，我们都会删除发布、订阅和订阅数据库。进行更改，然后重新构建它。我们可以这样做，因为我们可以容忍重新应用快照所需的时间。有多种方法可以将架构更改应用于发布并将它们传播给订阅者。查看 sp_register_custom_scripting。我们已经完成了这项工作，因此如果您需要，我可以提供更多有关它的信息。
正如@Jason 所说，您可以使用快照从镜像数据库中报告。注意快照会占用空间，并为镜像服务器增加工作量。尽管有多少空间将取决于有多少数据正在更改以及您的原始数据库有多大。我们确实使用镜像数据库上的快照来偶尔报告，因为我们的整个数据库没有被复制。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-22T13:46:03.537

日志传送[http://msdn.microsoft.com/en-us/library/ms187103.aspx](http://msdn.microsoft.com/en-us/library/ms187103.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-26T22:18:47.903

您使用的是什么版本的 SQL Server？

我们现在将复制用于特定的解决方案，而且它似乎每天都在工作。

我会检查您的事件日志和 SQL Server 日志，看看您是否可以确定它关闭的原因以及它不启动的原因。您是否可能正在修补服务器，或者您是否遇到网络错误？

复制的替代方法是日志传送或数据库镜像。我个人更喜欢数据库镜像，但这真的取决于你想要做什么，因为其中一些不适合某些情况。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-22T17:12:55.193

我们还使用了 SQL 事务复制。我们在更新架构时遇到了同样的痛苦，这需要在所有服务器上删除发布，执行更新，然后重新初始化复制，并希望获得最好的结果。有时它不会初始化，或者一个节点会落后，我们几乎不会收到任何警告。有几次我们甚至丢失了所有存储过程的执行权限，导致网站几乎完全失败。

我们有一个相当大的数据库，因此重新初始化可能需要相当长的时间，这意味着所有更新都必须在周日凌晨 2 点完成 - 不完全是在我们清醒和警觉并且能够使用我们所有的能力来处理可能出现的问题时.

我们正在放弃复制，转而支持 SQL 2008 上的故障转移集群，但它仍然可以一直追溯到 SQL 2000。

[http://technet.microsoft.com/en-us/library/cc917693.aspx](http://technet.microsoft.com/en-us/library/cc917693.aspx)

# javascript - 可以使用 Javascript 打开 PDF 文件的打印对话框吗？

> ID：687675
> 
> 赞同：44
> 
> 时间：2009-03-26T21:45:05.143
> 
> 标签：javascript, pdf, printing

我知道如何在新窗口中打开网页并添加 javascript，以便弹出打印对话框。有没有办法用 PDF 文件做类似的事情？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2010-03-22T20:20:40.863

是的你可以...

PDF 支持 Javascript。创建 PHP 生成的 PDF 时，我需要具有自动打印功能，并且我能够使用 FPDF 使其工作：

[http://www.fpdf.org/en/script/script36.php](http://www.fpdf.org/en/script/script36.php)

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2011-05-15T17:45:11.157

我通常会做一些类似于[How to Use JavaScript to Print a PDF (eHow.com)](http://www.ehow.com/how_7352227_use-javascript-print-pdf.html "如何使用 JavaScript 打印 PDF |  eHow.com")给出的方法，使用`iframe`.

1.  ### 容纳打印触发器的功能...

    ```
    function printTrigger(elementId) {
        var getMyFrame = document.getElementById(elementId);
        getMyFrame.focus();
        getMyFrame.contentWindow.print();
    } 
    ```

2.  ### 一个按钮，让用户访问...

    （一个`onClick`或`a`或`button`或`input`任何你想要的）

    ```
    <input type="button" value="Print" onclick="printTrigger('iFramePdf');" /> 
    ```

3.  ### 指向您的 PDF 的 iframe...

    ```
    <iframe id="iFramePdf" src="myPdfUrl.pdf" style="display:none;"></iframe> 
    ```

* * *

**Bonus Idea #1** - 创建`iframe`并将其添加到您的页面中，`printTrigger();` 以便在用户单击您的“打印”按钮之前不会加载 PDF，然后 javascript 可以攻击！iframe 并触发打印对话框。

* * *

**Bonus Idea #2** - 如果您禁用“打印”按钮并在用户单击它后给他们一个小加载微调器或其他东西，那么他们就会知道某些东西正在处理中，而不是重复点击它！

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2011-03-24T14:40:44.717

刚刚弄清楚如何在 PDF 本身中执行此操作 - 如果您有 acrobat pro，请转到您的页面选项卡，右键单击第一页的缩略图，然后单击页面属性。单击窗口顶部的操作选项卡，然后在选择触发器下选择打开页面。在选择操作下选择“运行 javascript”。然后在 javascript 窗口中，输入以下内容：

```
this.print({bUI: false, bSilent: true, bShrinkToFit: true}); 
```

这将打印您的文档，而无需与您机器上的默认打印机对话。如果您想要打印对话框，只需将 bUI 更改为 true，将 bSilent 更改为 false，并且可以选择删除缩小以适应参数。

自动打印PDF！

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2012-07-03T05:37:01.847

我使用`named action`而不是 javascript，因为 javascript 通常被禁用，如果不是，它会发出警告。

我的 Web 应用程序创建了一个 postscript 文件，然后使用 ghostscript 将其转换为 pdf。我希望它自动打印，因为用户已经在我的应用程序中单击了打印。通过上面@DSimon 中有关命名操作的信息，我研究了如何解决这个问题。这一切都归结为`/Type /Action /S /Named /N /Print`在pdf中的正确位置插入字符串。

我正在考虑编写一个小实用程序，但它必须解析 pdf 以找到根节点，`/OpenAction`使用引用插入具有操作的对象，并重新计算外部参照中的字节偏移量。

但后来我发现了[pdfmark](http://partners.adobe.com/public/developer/en/acrobat/sdk/pdf/pdf_creation_apis_and_specs/pdfmarkReference.pdf)，它是 postscript 的扩展，以 postscript 语法表达由 Adob​​e 蒸馏器或 ghostscript 转换为 pdf 的习语。

由于我已经在使用 ghostscript，我所要做的就是将以下内容附加到我的 postscript 文件的末尾：

```
%AUTOPRINT
[ /_objdef {PrintAction} /type /dict /OBJ pdfmark
[ {PrintAction} << /Type /Action /S /Named /N /Print >> /PUT pdfmark
[ {Catalog} << /OpenAction {PrintAction} >> /PUT pdfmark 
```

ghostscript 将创建动作、链接它并计算外部参照偏移。（在后记`%`中是一条评论，`PrintAction`是我的对象名称）

通过查看 PDF，我发现它创建了这个：

```
1 0 obj
<</Type /Catalog /Pages 3 0 R
/OpenAction  9 0 R
/Metadata 10 0 R
>>
endobj

9 0 obj
<</S/Named
/Type/Action
/N/Print>>endobj 
```

`1 0`是对象 1，修订版 0，`9 0`是对象 9，修订版 0。在 pdf-trailer 中说对象 1 是根节点。如您所见，有来自对象 1 的引用，`/OpenAction`用于运行对象 9 修订版 0。

使用 ghostscript 可以将 pdf 转换为 postscript (pdf2ps)，附加上面的文本，然后使用`ps2pdf`. 应该注意的是，有关 pdf 的元信息在此转换中丢失了。我没有对此进行更多搜索。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2010-06-01T14:16:20.700

嵌入代码示例：

```
<object type="application/pdf" data="example.pdf" width="100%" height="100%" id="examplePDF" name="examplePDF"><param name='src' value='example.pdf'/></object>

<script>
   examplePDF.printWithDialog();
</script> 
```

可能不得不玩弄 ids/names。使用 adobe 阅读器...

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-11-04T18:06:40.317

如果您知道 PDF 文件的结构（或愿意花一点时间阅读规范），您可以这样做。

在 Catalog 对象的 OpenAction 字段中使用命名操作“Print”；“打印”操作未记录在案，但 Acrobat Reader 和大多数其他主要读者都理解它。这种方法的一个很好的好处是您不会收到任何 JavaScript 警告。详情见这里：[http ://www.gnostice.com/nl_article.asp?id=157](http://www.gnostice.com/nl_article.asp?id=157)

为了让它更加闪亮，我添加了第二个动作，URI，引导读者返回到发起请求的页面。然后我使用它的 Next 字段将此 Action 附加到第一个 Named 操作。将内容处置设置为“内联”，这样当用户单击打印链接时：

1.  它在同一选项卡中打开 Adob​​e Reader 并加载文件
2.  它立即显示打印对话框
3.  一旦打印对话框关闭（无论他们点击“确定”还是“取消”），浏览器选项卡都会返回网页

仅使用 File 和 IO 模块，我就能在 Ruby 中轻松完成所有这些更改；我打开了使用外部工具生成的 PDF，将外部参照跟随到现有目录部分，然后在 PDF 上附加了一个新部分，其中包含我的特殊 OpenAction 行的更新目录对象，以及新的操作对象。

由于 PDF 的增量修订功能，您不必对现有数据进行任何更改，只需在末尾附加一个附加部分即可。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-09-14T15:39:27.877

为什么不使用“操作”菜单选项来设置它？

执行以下操作：如果您有 Acrobat Pro，请转到您的页面选项卡，右键单击第一页的缩略图，然后单击页面属性。单击窗口顶部的操作选项卡，然后在选择触发器下选择打开页面。在选择操作下选择**“执行菜单项”**。单击“添加”按钮，然后选择“文件 > 打印”，然后选择“确定”。再次单击确定并保存 PDF。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-05-29T15:10:58.730

如果您使用 Ruby on Rails 的[prawn](http://prawn.majesticseacreature.com/docs/) gem 来生成 PDF，您可以使用以下附加 gem 来激活打印对话框：

[虾印](https://github.com/barsoom/prawn-print)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-10-20T11:42:57.023

另一种解决方案：

```
<input type="button" value="Print" onclick="document.getElementById('PDFtoPrint').focus(); document.getElementById('PDFtoPrint').contentWindow.print();"> 
```

* * *

## 回答 #10

> 赞同：-7
> 
> 时间：2009-05-11T19:10:17.227

如果您在网页中嵌入 pdf 并引用对象 ID，您应该可以做到。

例如。在您的 HTML 中：

```
<object ID="examplePDF" type="application/pdf" data="example.pdf" width="500" height="500"> 
```

在你的 javascript 中：

```
<script>

var pdf = document.getElementById("examplePDF");

pdf.print();

</script> 
```

我希望这会有所帮助。

# c# - 使用 LIKE 的 SqlDataSource SelectCommand 不起作用

> ID：687677
> 
> 赞同：0
> 
> 时间：2009-03-26T21:45:25.580
> 
> 标签：c#, asp.net, tsql, sqldatasource

我在 a 中有以下 T-SQL `SelectCommand`：

```
SELECT h.Business,
hrl.frn
FROM registration hrl
INNER JOIN holder h on h.call = hrl.call
WHERE 
(h.Business like '%' + @business + '%' and h.Business is not null) 
and 
(hrl.frn = @frn and hrl.frn is not null) 
```

`business`并且`frn`与控制参数相关联，即使一个或两个都留空，它也应该返回数据，但如果我输入数据只是为了`frn`举例，它不会返回任何东西。我认为我的 T-SQL 没有做正确的事情，我也不确定我`like`是否正确处理。

如果两个文本框都留空，它应该返回所有数据。如果`frn`输入，但`business`留空，它应该只返回与那个相关的数据`frn`。如果`business`输入但`frn`留空，则应返回所有匹配项`like` `business`。如果两者都输入，它应该返回仅匹配`frn`和 的数据`business`。

另外，我不确定这样做`and is not null`是否真的有必要。

```
protected void btnSearch_Click(object sender, EventArgs e)
{
    if (txtFRN.Text == "")
        frn = null;

    if (txtBusiness.Text == "")
        business = null;

    sqlDsMaster.SelectParameters[frn].DefaultValue = frn;
    sqlDsMaster.SelectParameters[business].DefaultValue = business;

    sqlDsMaster.DataBind();
} 
```

上面的内容在遇到此行时会引发“未设置为实例的对象引用”：

```
sqlDsMaster.SelectParameters[frn].DefaultValue = frn; 
```

`frn`并且`business`是属性。

* * *

这是`SearchMaster`存储过程：

```
CREAETE PROCEDURE SearchMaster
@business nvarchar(300) = NULL,
@frn nvarchar(10) = NULL
AS
SELECT h.Business,
       hrl.frn
FROM registration hrl
INNER JOIN holder h on h.call = hrl.call
WHERE (@business IS NULL OR h.Business like '%' + @business + '%') 
  AND (@frn IS NULL OR hrl.frn = @frn) 
```

这是`SearchDetails`存储过程：

```
CREATE PROCEDURE SearchDetails
@business nvarchar(300) = NULL,
@frn nvarchar(10) = NULL
AS
SELECT hrl.call 
FROM registration hrl 
INNER JOIN holder h ON h.call = hrl.call
WHERE (@business IS NULL OR h.Business LIKE '%' + @business + '%') 
      AND (@frn IS NULL OR hrl.frn = @frn) 
```

这是`SqlDataSource`程序`SearchMaster`：

```
<asp:SqlDataSource ID="sqlDsDetails" 
                   runat="server" 
                   ConnectionString="<%$ ConnectionStrings:cnxString %>
                   SelectCommandType="StoredProcedure" 
                   SelectCommand="SearchMaster">
  <SelectParameters>
    <asp:ControlParameter Name="business" ControlID="txtBusiness" 
                          Type="String" PropertyName="Text"  
                          ConvertEmptyStringToNull="true" />
    <asp:ControlParameter Name="frn" ControlID="txtFRN" 
                          Type="String" PropertyName="Text"
                          ConvertEmptyStringToNull="true"/>
  </SelectParameters>
</asp:SqlDataSource> 
```

这是`SqlDataSource`程序`SearchDetails`：

```
<asp:SqlDataSource ID="sqlDsDetails" 
                   runat="server" 
                   ConnectionString="<%$ ConnectionStrings:cnxString %>
                   SelectCommandType="StoredProcedure" 
                   SelectCommand="SearchDetails">
  <SelectParameters>
    <asp:Parameter Name="frn" Type="String" DefaultValue="" 
                   ConvertEmptyStringToNull="true" />
    <asp:Parameter Name="business" Type="String" DefaultValue="" 
                   ConvertEmptyStringToNull="true" />
  </SelectParameters>
</asp:SqlDataSource> 
```

这是绑定的按钮单击`SqlDsMaster`：

```
protected void btnSearch_Click(object sender, EventArgs e)
{
    sqlDsMaster.DataBind();
} 
```

这是`gvMaster_RowCreated`为详细信息创建行的：

```
protected void gvMaster_RowCreated(object sender, GridViewRowEventArgs e)
{
    if (e.Row.RowType == DataControlRowType.DataRow)
    {
        SqlDataSource ctrl = 
        e.Row.FindControl("sqlDsDetails") as SqlDataSource;

        if (ctrl != null && e.Row.DataItem != null)
        {
            ctrl.SelectParameters["frn"].DefaultValue = 
            ((DataRowView)e.Row.DataItem)["frn"].ToString();

            ctrl.SelectParameters["business"].DefaultValue = 
            ((DataRowView)e.Row.DataItem)["business"].ToString();
         }
     }
 } 
```

`SearchMaster`如果我通过 SQL Server Management Studio 运行它，`SearchDetails`两者都可以工作，如果我为`business`and输入两个数据，它就可以工作`frn`，但如果我只输入一个，则不会返回任何数据。参数设置是否正确？另外，如果我在`null`程序中初始化参数，是否还需要使用`ConvertEmptyStringToNull`？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T21:58:05.503

我会做类似的事情：

```
where (@business is null
          or @business = ''
          or h.Business like '%' + @business + '%')
      and (@frn is null
              or @frn = ''
              or hrl.frn = @frn) 
```

如果在传递空搜索字符串之前将其设为空，则可以跳过 @yyy = '' 部分。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T21:57:36.503

改变

“而且 h.Business 不为空”

到

“或 h.Business 为空”

和

“而且 hrl.frn 不为空”

到

“或 hrl.frn 为空”

当这些参数为空时，这将返回所有内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-12T10:57:24.560

### " `and is not null`"

存储过程有它的权利：`(@frn IS NULL OR hrl.frn = @frn)`. `frn`如果是`null`或匹配，您想选择任何行。相同的模式适用于该`business`属性。

### 空引用异常

```
sqlDsMaster.SelectParameters[frn].DefaultValue = frn; 
```

这失败了，因为您正在使用`frn`属性的值（可能是`null`）而不是字符串`"frn"`作为`SelectParameters`. 您在下一行使用`business`而不是出现相同的错误`"business"`。

### ConvertEmptyStringToNull

我会反过来提出问题：如果您正在使用`ConvertEmptyStringToNull`，为什么要让调用者负担相同的功能？除非空字符串是 or 的有效值，`frn`否则`business`我会保持`ConvertEmptyStringToNull`设置而不在调用者中关心它。

我希望这能回答你所有的问题。

# javascript - javasctipt 中的 && 和 == 运算符优先级是否重要？

> ID：687684
> 
> 赞同：0
> 
> 时间：2009-03-26T21:47:11.160
> 
> 标签：javascript, operators, operator-precedence

更具体地说，是否存在一组值（a、b 和 c）在语句中运算符优先级很重要：

```
var value = (a && b == c); 
```

（NaN 除外）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T21:53:44.530

是的

```
js> false && true == false
false
js> (false && true) == false
true 
```

由于`==`优先级高于`&&`，因此第一个被解析为`false && (true == false)`，相当于`false && false`，因此计算结果为`false`。第二个等价于`false == false`，即`true`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T21:50:50.387

该语言被解析为您的语句相当于`(a && (b == c))`. 相等运算符将始终在和其他逻辑运算符`&&`之前运行。[您可以在此处](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Operators/Operator_Precedence)`||`找到详细信息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T21:53:41.690

是的。 `==`比 绑定得更紧`&&`，所以你有什么绑定为

```
var val = a && ( b == c) 
```

见[这里](http://www.codehouse.com/javascript/precedence/)。所以`a==0`, `b==1`and`c==0`是假的，while`(a&&b)==c`是真的。

（修正错字。该死的。）

# c++ - C++ 的 StyleCop

> ID：687691
> 
> 赞同：15
> 
> 时间：2009-03-26T21:48:23.060
> 
> 标签：c++, coding-style

我想问一下你知道有什么类似于[StyleCop](http://code.msdn.microsoft.com/sourceanalysis)的程序，但是是 C++ 的吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-26T22:02:51.777

请参阅[根据一组编码标准检查 C/C++ 源代码的免费工具？](https://stackoverflow.com/questions/93260/a-free-tool-to-check-c-c-source-code-against-a-set-of-coding-standards). 这看起来就是您所追求的，尽管我不知道 StyleCop 工具的全部功能。

# sequences - 计算特定的生成函数序列

> ID：687695
> 
> 赞同：2
> 
> 时间：2009-03-26T21:48:48.753
> 
> 标签：sequences, power-series

[http://www.research.att.com/~njas/sequences/A097196](http://www.research.att.com/~njas/sequences/A097196)

我想知道如何继续生成链接中给出的序列。它基于生成函数。任何想法，将不胜感激。该序列的某个序列中的某些数字显示为欧拉计划[问题 208](http://projecteuler.net/index.php?section=problems&id=208)（机器人行走）的子问题的答案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T00:06:48.097

将生成函数转换为实际吐出系列元素的实现并非易事。如果你使用 Mathematica，有一些内置函数可以处理这个问题。描述可以在[Wolfram MathWorld](http://mathworld.wolfram.com/GeneratingFunction.html)找到。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T21:59:43.690

该序列不是由页面顶部的函数定义的 -`{n >= 1} (1+q^(3*n))^4*(1-q^(3*n))^2/(1-q^(2*n))`吗？继续运行函数，不是吗？

# python - Python 游戏编程：我的 IO 对象是否适合作为全局变量？

> ID：687703
> 
> 赞同：5
> 
> 时间：2009-03-26T21:52:07.857
> 
> 标签：python, io, global-variables

我正在用 Python 编写一个游戏，其中所有 IO 活动都由一个 IO 对象完成（希望很容易将该对象换成另一个实现不同用户界面的对象）。游戏中几乎所有其他对象都需要在某些时候访问 IO 系统（例如打印消息、更新玩家的位置、显示由游戏中动作引起的特殊效果），所以我的问题是：

对全局可用的 IO 对象的引用是否有意义？

另一种方法是将 IO 对象的引用传递给`__init__()`每个需要使用它的对象。我知道从测试的角度来看这很好，但这值得由此产生的“函数签名污染”吗？

谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-26T22:20:35.353

是的，这是对全局变量的合法使用。如果您不想这样做，那么传递与此全局等效的上下文对象是另一种选择，正如您所提到的。

既然我假设您正在使用多个文件（模块），为什么不这样做：

```
import io
io.print('hello, world')
io.clear() 
```

这是具有比简单打印更复杂的 I/O 需求的程序执行日志等操作的常用方式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T22:22:16.053

是的，我想是这样。

另一种可能性是创建一个具有和之类的功能的模块，`loggerModule`但这只会稍微好一点。`print()``write()`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T22:50:02.820

没有。

变量过于具体，无法在全局命名空间中传递。将它们隐藏在静态函数/类中，而不是在运行时对它们做神奇的事情（或完全调用其他函数）。

考虑一下如果 IO 可以周期性地改变状态或者它需要阻塞一段时间（就像许多套接字一样）会发生什么。

考虑如果多次包含相同的代码块会发生什么。变量实例是否也会重复？

考虑一下如果您想拥有相同变量的版本 2 会发生什么。如果你想改变它的界面怎么办？您是否必须修改所有引用它的代码？

感染所有使用该变量的代码并了解它可能变坏的所有方式真的有意义吗？

# c++ - 如何从 ADO/C++ 调用 MSSQL 系统函数？

> ID：687718
> 
> 赞同：0
> 
> 时间：2009-03-26T21:56:35.850
> 
> 标签：c++, sql, sql-server, tsql, ado

...特别是 MSSQL 2005 中的 fn_listextendedproperty 系统函数。

我向我的数据库对象添加了一个扩展属性，名为“schemaVersion”。在我的 MSVC 应用程序中，使用 ADO，我需要确定该扩展属性是否存在，如果存在，则从中返回字符串值。

这是我想要的 T-SQL 代码。我如何用 C++/ADO 编写它，或者以其他方式完成工作？

```
select value as schemaVer
from fn_listextendedproperty(default, default, default, default, default, default, default)
where name=N'schemaVersion' 
```

这是我最初尝试的代码。它失败并出现代码下方列出的错误：

```
_CommandPtr cmd;
cmd.CreateInstance(__uuidof(Command));
cmd->ActiveConnection = cnn;

cmd->PutCommandText("select value "
    "from fn_listextendedproperty(default, default, default, default, default, default, default) "
    "where name=N'schemaVersion'");
VARIANT varCount;
cmd->Execute(NULL, NULL, adCmdText); 
```

...这是我从 ADO 错误集合中剥离出来的错误。输出来自我的小实用函数，它添加了额外的文本，如线程 ID 等，所以忽略它。

```
(Proc:0x1930, Thread:0x8A0) INFO : ===   1 Provider Error Messages : =======================
(Proc:0x1930, Thread:0x8A0) INFO : [  1]   (-2147217900) 'Incorrect syntax near the keyword 'default'.'
(Proc:0x1930, Thread:0x8A0) INFO :         (SQLState = '42000')
(Proc:0x1930, Thread:0x8A0) INFO :         (Source = 'Microsoft OLE DB Provider for SQL Server')
(Proc:0x1930, Thread:0x8A0) INFO :         (NativeError = 156)
(Proc:0x1930, Thread:0x8A0) INFO : ========================================================== 
```

**编辑**：根据建议更新了通话。还将“SELECT value AS schemaVer”更改为“SELECT value”。

**编辑**：根据建议将 Execute() 的第一个参数更改为 NULL。这解决了我原来的问题，然后我继续下一个。:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T22:05:09.837

尝试为 fn_listextendedproperty 的每个参数指定 NULL 而不是默认值。这应该希望然后执行没有错误，只是让您检索结果作为下一步。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T14:47:36.120

我还没有想出如何直接做到这一点。为了继续我的生活，我编写了一个调用该函数的存储过程：

```
set ANSI_NULLS ON
set QUOTED_IDENTIFIER ON
go

ALTER PROCEDURE [dbo].[mh_getSchemaVersion]
@schemaVer VARCHAR(256) OUTPUT
AS
    select @schemaVer = CAST( (select value from fn_listextendedproperty(default, default, default, default, default, default, default) where name=N'schemaVersion') AS varchar(256) )
    return @@ROWCOUNT 
```

...然后从我的 ADO/C++ 代码中调用 thst sproc：

```
_CommandPtr cmd;
cmd.CreateInstance(__uuidof(Command));
cmd->ActiveConnection = cnn;
cmd->PutCommandText("mh_getSchemaVersion")_l

_variant_t schemaVar;
_ParameterPtr schemaVarParam = cmd->CreateParameter("@schemaVer", adVarChar, adParamOutput, 256);
cmd->GetParameters()->Append((IDispatch*)schemaVarParam);

cmd->Execute(NULL, NULL, adCmdStoredProc);

std::string v = (const char*)(_bstr_t)schemaVarParam->GetValue();

ver->hasVersion_ = true; 
```

...可行，但我不想部署新的存储过程。

因此，如果有人能想出原始问题的解决方案并告诉我如何直接从 ADO/C++ 调用系统函数，我将接受它作为答案。否则我只会接受这个。

# java - Java的开源调查/问卷引擎

> ID：687720
> 
> 赞同：8
> 
> 时间：2009-03-26T21:56:55.753
> 
> 标签：java, jakarta-ee, survey

是否有用于 java 的开源调查引擎允许问题分支？即问题 1 有 A、B 或 C 选项，每个选项都带您进入一组不同的后续问题。

我找到了一对（JSurveyLib 和 Socrates QE），但它们似乎与 GUI 密切相关。

我正在编写的应用程序有一个在 glassfish 上运行的 java 后端和一个 flex 前端。最终会有不同字体端的计划，因此引擎需要非常独立于 GUI。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T10:58:10.400

请看一下[JCaiF](http://jcaif.sourceforge.net/jcaif.html) ——“Java 计算机辅助面试框架 (JCaiF) 是一组 Java 接口，它们定义了问卷或调查的常见元素”——所以也许您可以针对这些接口实现您的应用程序。

# sql-server-2005 - 需要删除 SSIS 外部元数据列

> ID：687727
> 
> 赞同：0
> 
> 时间：2009-03-26T21:58:56.453
> 
> 标签：sql-server-2005, ssis

我正在动态创建一个 select 语句，因为列名和表名可以更改，但它们都需要进入相同的数据目标。还有其他共同点使这个可行，如果我以后需要，我会进入它们。所以，归根结底是这样的：我正在创建 16 列的 select 语句，总会有 16 列，不多也不少，列名可以改变，表名可以改变。当我执行包时，选择语句构建得很好，但是当数据流尝试执行时，我收到以下错误：

> “外部元数据列“ColumnName”(79)”需要从外部元数据列集合中删除。

正在生成的实际 SQL 语句是：

```
select 0 as ColumnName, Column88 as CN1, 0 as CN2, 0 as CN3, 0 as CN4,
       0 as CN5, 0 as CN6, 0 as CN7, 0 as CN8, 0 as CN9, 0 as CN10,
       0 as CN11, 0 as CN12, 0 as CN13, 0 as CN14, 0 as CN15 from Table3 
```

列“Column88”是动态生成的，表名也是动态生成的。如果其他 'as CNx' 列的源列存在，它们将以相同的方式出现（Column88 作为 CN1，Column89 作为 CN2，Column90 作为 CN3 等）并且表名将始终采用以下形式：Tablex 其中 x 是一个整数。

谁能帮我解决问题以及如何解决？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T00:35:31.083

你在这里有点深。您应该将其视为无法更改明显的列名或类型。输入列的名称和类型成为从源流下来的元数据的名称和类型。如果你改变了这些，那么依赖它们的一切都必须失败。

解决方案是使这些稳定，可能通过使用列别名和强制转换。对于一张桌子：

`SELECT COLNV, COLINT FROM TABLE1`

为了另一个

`SELECT CAST(COLV AS NVARCHAR(50)) AS COLNV, CAST(COLSMALL AS INTEGER) AS COLINT FROM TABLE2`

试一试，看看它是否适合你。如果不修复包的整个其余部分，您真的无法更改元数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-06-12T18:39:06.717

如何在桌子前面使用视图。并将视图称为 SSIS 源。这样，您可以根据需要映射列，并使用`ISNULL`or`COALESCE`函数来保持一致的列模式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-24T16:33:17.710

当我必须从 SQL 中的存储过程（吐出到临时表）中删除一列并添加两列时，我在这里遇到了同样的问题。为了解决这个问题，我必须从头开始检查我的 SSIS 包的每个部分（源 - 在我的情况下，从临时表中提取），一直到你的目的地（在我的情况下，一个平面文件连接到一个平面文件.csv）。在此过程中，我不得不重新进行所有映射，并观察在 SSIS 的 GUI 数据流任务中出现的错误。

这个错误确实以红色 X 的形式出现在我身上，周围有一个圆圈，我悬停在上面，它提到了元数据的东西……我双击它，它警告我我的一个列不存在不再想知道我是否想删除它。我确实删除了它，但我可以告诉您，此错误与 SSIS 告诉您映射已关闭有关，您需要检查 SSIS 包的每个部分以确保所有内容都正确映射。

# asp.net - 带有 xval 的 asp.net mvc 向导表单

> ID：687728
> 
> 赞同：0
> 
> 时间：2009-03-26T21:59:07.277
> 
> 标签：asp.net, asp.net-mvc, xval

我使用 linqtosql 和 xval 来验证服务器端和客户端。我试图做一个向导风格的表格，但不能通过不同的动作传递实际值。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T22:02:17.037

您有三个选择：将值存储在 TempData 中，将值存储在 Session 中，或者将临时值写入视图中的隐藏字段并在每一步重新加载它们。

# algorithm - 广度优先与深度优先

> ID：687731
> 
> 赞同：199
> 
> 时间：2009-03-26T21:59:16.060
> 
> 标签：algorithm, recursion, depth-first-search, breadth-first-search, tree-traversal

遍历树/图时，广度优先和深度优先有什么区别？任何编码或伪代码示例都会很棒。

* * *

## 回答 #1

> 赞同：327
> 
> 时间：2009-03-26T22:08:12.123

这两个术语区分了两种不同的走树方式。

仅仅展示差异可能是最简单的。考虑树：

```
 A
   / \
  B   C
 /   / \
D   E   F 
```

**深度**优先遍历将按此顺序访问节点

```
A, B, D, C, E, F 
```

请注意，在继续前进之前，您要一直走**下一**条腿。

**广度**优先遍历将按此顺序访问节点

```
A, B, C, D, E, F 
```

在这里，我们在下降之前一直**在每个级别上工作。**

（请注意，遍历顺序存在一些歧义，并且我作弊以维持树的每一级的“阅读”顺序。在任何一种情况下，我都可以在 C 之前或之后到达 B，同样我可以到达E 在 F 之前或之后。这可能重要也可能不重要，取决于您的应用程序...）

* * *

两种遍历都可以用伪代码实现：

```
Store the root node in Container
While (there are nodes in Container)
   N = Get the "next" node from Container
   Store all the children of N in Container
   Do some work on N 
```

两种遍历顺序的区别在于 的选择`Container`。

*   对于**深度，首先**使用堆栈。（递归实现使用调用堆栈...）
*   对于**广度优先**使用队列。

* * *

递归实现看起来像

```
ProcessNode(Node)
   Work on the payload Node
   Foreach child of Node
      ProcessNode(child)
   /* Alternate time to work on the payload Node (see below) */ 
```

当您到达没有子节点的节点时，递归结束，因此保证对于有限的非循环图结束。

* * *

在这一点上，我还是有点作弊。稍微聪明一点，您还可以*按*以下顺序处理节点：

```
D, B, E, F, C, A 
```

这是深度优先的一种变体，我不会在每个节点上进行工作，直到我走回树上。然而，我在向下寻找他们的孩子的路上*访问了更高的节点。*

这种遍历在递归实现中是相当自然的（使用上面的“Alternate time”行而不是第一个“Work”行），如果使用显式堆栈也不会*太难，但我将把它留作练习。*

* * *

## 回答 #2

> 赞同：116
> 
> 时间：2016-05-06T06:50:18.753

## 理解条款：

这张图片应该让您了解使用*广度*和*深度*这两个词的上下文。

[![了解广度和深度](https://i.stack.imgur.com/QtYo8.jpg)](https://i.stack.imgur.com/QtYo8.jpg)

* * *

## 深度优先搜索：

[![深度优先搜索](https://i.stack.imgur.com/gh0T1.png)](https://i.stack.imgur.com/gh0T1.png)

*   深度优先搜索算法的行为就像它想尽快远离起点一样。

*   它通常使用 a`Stack`来记住当它到达死胡同时它应该去哪里。

*   遵循的规则：将第一个顶点 A 推到`Stack`

    1.  如果可能，访问相邻的未访问顶点，将其标记为已访问，并将其压入堆栈。
    2.  如果你不能遵循规则 1，那么，如果可能的话，从堆栈中弹出一个顶点。
    3.  如果你不能遵循规则 1 或规则 2，那么你就完了。
*   Java代码：

    ```
    public void searchDepthFirst() {
        // Begin at vertex 0 (A)
        vertexList[0].wasVisited = true;
        displayVertex(0);
        stack.push(0);
        while (!stack.isEmpty()) {
            int adjacentVertex = getAdjacentUnvisitedVertex(stack.peek());
            // If no such vertex
            if (adjacentVertex == -1) {
                stack.pop();
            } else {
                vertexList[adjacentVertex].wasVisited = true;
                // Do something
                stack.push(adjacentVertex);
            }
        }
        // Stack is empty, so we're done, reset flags
        for (int j = 0; j < nVerts; j++)
            vertexList[j].wasVisited = false;
    } 
    ```

*   [应用](https://stackoverflow.com/a/37069004/5925259)：深度优先搜索通常用于模拟游戏（以及现实世界中的类似游戏的情况）。在典型的游戏中，您可以选择几个可能的动作之一。每个选择都会导致进一步的选择，每个选择都会导致进一步的选择，依此类推，形成一个不断扩大的树形可能性图。

* * *

## 广度优先搜索：

[![广度优先搜索](https://i.stack.imgur.com/TjhfH.png)](https://i.stack.imgur.com/TjhfH.png)

*   广度优先搜索算法喜欢尽可能靠近起点。
*   这种搜索通常使用`Queue`.
*   遵循的规则：使起始顶点 A 成为当前顶点
    1.  访问与当前顶点相邻的下一个未访问的顶点（如果有的话），标记它，并将其插入到队列中。
    2.  如果由于没有更多未访问的顶点而无法执行规则 1，请从队列中删除一个顶点（如果可能）并将其设为当前顶点。
    3.  如果您因为队列为空而无法执行规则 2，那么您就完成了。
*   Java代码：

    ```
    public void searchBreadthFirst() {
        vertexList[0].wasVisited = true;
        displayVertex(0);
        queue.insert(0);
        int v2;
        while (!queue.isEmpty()) {
            int v1 = queue.remove();
            // Until it has no unvisited neighbors, get one
            while ((v2 = getAdjUnvisitedVertex(v1)) != -1) {
                vertexList[v2].wasVisited = true;
                // Do something
                queue.insert(v2);
            }
        }
        // Queue is empty, so we're done, reset flags
        for (int j = 0; j < nVerts; j++) 
            vertexList[j].wasVisited = false;
    } 
    ```

*   [应用](https://stackoverflow.com/a/37069004/5925259)：广度优先搜索首先查找距离起点一条边的所有顶点，然后查找距离起点两条边的所有顶点，以此类推。如果您试图找到从起始顶点到给定顶点的最短路径，这很有用。

希望这足以理解广度优先和深度优先搜索。为了进一步阅读，我会推荐 Robert Lafore 的一本优秀的数据结构书中的 Graphs 章节。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2018-03-02T07:21:38.377

给定这个二叉树：

[![在此处输入图像描述](https://i.stack.imgur.com/l3Vt9.png)](https://i.stack.imgur.com/l3Vt9.png)

**广度优先遍历：**
**从左到右遍历每个级别。**

“我是 G，我的孩子是 D 和 I，我的孙子是 B、E、H 和 K，他们的孙子是 A、C、F”

```
- Level 1: G 
- Level 2: D, I 
- Level 3: B, E, H, K 
- Level 4: A, C, F

Order Searched: G, D, I, B, E, H, K, A, C, F 
```

**深度优先遍历：**
**遍历不是一次在整个关卡中完成。相反，遍历首先深入到树的深度（从根到叶）。但是，它比简单的上下移动要复杂一些。**

有以下三种方法：

```
1) PREORDER: ROOT, LEFT, RIGHT.
You need to think of this as a recursive process:  
Grab the Root. (G)  
Then Check the Left. (It's a tree)  
Grab the Root of the Left. (D)  
Then Check the Left of D. (It's a tree)  
Grab the Root of the Left (B)  
Then Check the Left of B. (A)  
Check the Right of B. (C, and it's a leaf node. Finish B tree. Continue D tree)  
Check the Right of D. (It's a tree)  
Grab the Root. (E)  
Check the Left of E. (Nothing)  
Check the Right of E. (F, Finish D Tree. Move back to G Tree)  
Check the Right of G. (It's a tree)  
Grab the Root of I Tree. (I)  
Check the Left. (H, it's a leaf.)  
Check the Right. (K, it's a leaf. Finish G tree)  
DONE: G, D, B, A, C, E, F, I, H, K  

2) INORDER: LEFT, ROOT, RIGHT
Where the root is "in" or between the left and right child node.  
Check the Left of the G Tree. (It's a D Tree)  
Check the Left of the D Tree. (It's a B Tree)  
Check the Left of the B Tree. (A)  
Check the Root of the B Tree (B)  
Check the Right of the B Tree (C, finished B Tree!)  
Check the Right of the D Tree (It's a E Tree)  
Check the Left of the E Tree. (Nothing)  
Check the Right of the E Tree. (F, it's a leaf. Finish E Tree. Finish D Tree)...  
Onwards until...   
DONE: A, B, C, D, E, F, G, H, I, K  

3) POSTORDER: 
LEFT, RIGHT, ROOT  
DONE: A, C, B, F, E, D, H, K, I, G 
```

**用法（又名，我们为什么关心）：**
我真的很喜欢 Quora 对深度优先遍历方法及其常用方法的简单解释：
“按顺序遍历将打印值 [为了 BST（二叉搜索树）] "
"前序遍历用于创建[二叉搜索树]的副本。"
“后序遍历用于删除[二叉搜索树]。”
[https://www.quora.com/What-is-the-use-of-pre-order-and-post-order-traversal-of-binary-trees-in-computing](https://www.quora.com/What-is-the-use-of-pre-order-and-post-order-traversal-of-binary-trees-in-computing)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-08-02T18:45:47.500

我认为以一种仅通过切换某些代码行才能为您提供一种算法或另一种算法的方式编写它们会很有趣，这样您就会发现您的困境并不像起初看起来那么强大.

我个人喜欢将 BFS 解释为淹没景观：首先淹没低海拔地区，然后才是高海拔地区。如果您将景观高度想象为我们在地理书籍中看到的等值线，那么很容易看出 BFS 同时填充了同一等值线下的所有区域，就像物理学一样。因此，将高度解释为距离或按比例缩放的成本给出了算法的一个非常直观的概念。

考虑到这一点，您可以轻松地调整广度优先搜索背后的思想，以轻松找到最小生成树、最短路径以及许多其他最小化算法。

我还没有看到对 DFS 的任何直观解释（只有关于迷宫的标准解释，但它没有 BFS 和洪水那么强大），所以对我来说，BFS 似乎与上述物理现象的相关性更好，而DFS 与理性系统上的选择困境（即人或计算机决定在国际象棋游戏中采取哪一步或走出迷宫）具有更好的相关性。

所以，对我来说，区别在于哪种自然现象最符合它们在现实生活中的传播模型（横向）。

# .net - 如何调试特定的行测试？

> ID：687748
> 
> 赞同：1
> 
> 时间：2009-03-26T22:05:52.630
> 
> 标签：.net, visual-studio, unit-testing, rowtest

如何调试特定的行测试？

我正在使用 Visual Studio 和 nUnit。[TDD.NET](http://www.testdriven.net/)插件很棒，但它不允许我调试特定的行测试，在进行测试之前，我必须通过所有以前的测试。

我知道有一些商业解决方案。我正在寻找免费（或非常便宜）的解决方案。

```
 <RowTest()> _
    <Row("x")> _
    <Row("y")> _
    <Row("z")> _
    Public Sub TEst(ByVal fileToParse As String)
...
End Sub 
```

在这种情况下，为了能够测试 Row("z") 我必须通过 "x" 和 "y" 并且我有一些超过 10 行的测试。

**2 不够好的解决方案：**

*   使用条件断点作为解决方法。
*   使用 nUnit 启动调试模式并从 nUnit GUI 运行该行测试。但这需要相当长的时间，有时我不想将我的单元测试 DLL 作为启动项目。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T22:09:36.893

那么一个肮脏的解决方案是注释掉所有其他行，然后调试:)。

或者在代码中放置一个 if 语句来检查 fileToParse 参数的值（比如说“y”）并在里面放置一个断点（C# 代码）：

```
 if (fileToParse == "y")
 {
    int a = 0; a++;
 } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T10:29:42.760

我最终在 Debug 中启动 nUnit 并双击该行。

# wpf - 无法在 PowerShell 中向 WPF DataGrid 添加行

> ID：687754
> 
> 赞同：0
> 
> 时间：2009-03-26T22:08:56.460
> 
> 标签：wpf, powershell, datagrid, wpftoolkit

我正在使用来自 PowerShell 的“WPF Toolkit”中的 DataGrid。问题是我无法使用 GUI 添加新行。

对话框.xaml

```
<Window
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:sys="clr-namespace:System;assembly=mscorlib"
  xmlns:dg="clr-namespace:Microsoft.Windows.Controls;assembly=WpfToolkit"
  >

  <Window.Resources>
    <x:Array x:Key="people" Type="sys:Object" />
  </Window.Resources>

  <StackPanel>
    <dg:DataGrid x:Name="_grid" ItemsSource="{DynamicResource people}" CanUserAddRows="True" AutoGenerateColumns="False">
      <dg:DataGrid.Columns>

        <dg:DataGridTextColumn Header="First" Binding="{Binding First}"></dg:DataGridTextColumn>
        <dg:DataGridTextColumn Header="Last" Binding="{Binding Last}"></dg:DataGridTextColumn>

      </dg:DataGrid.Columns>
    </dg:DataGrid>

    <Button>test</Button>
  </StackPanel>
</Window> 
```

对话框.ps1

```
# Includes
Add-Type -AssemblyName PresentationFramework 
[System.Reflection.Assembly]::LoadFrom("C:\Program Files\WPF Toolkit\v3.5.40320.1\WPFToolkit.dll")

# Helper methods
function LoadXaml
{
    param($fileName)

    [xml]$xaml = [IO.File]::ReadAllText($fileName)
    $reader = (New-Object System.Xml.XmlNodeReader $xaml) 
    [Windows.Markup.XamlReader]::Load( $reader ) 
}

# Load XAML
$form = LoadXaml('.\dialog.xaml')

#
$john = new-object PsObject
$john | Add-Member -MemberType NoteProperty -Name "First" -Value ("John")
$john | Add-Member -MemberType NoteProperty -Name "Last" -Value ("Smith")

$people = @( $john )
$form.Resources["people"] = $people

#
$form.ShowDialog() 
```

运行.bat

```
powershell -sta -file dialog.ps1 
```

问题似乎出在 $people 集合中。我在 C# 中尝试了相同的代码并且它有效，但集合是这样定义的：

```
List<Person> people = new List<Person>();
people.Add(new Person { First = "John", Last = "Smith" });
this.Resources["people"] = people; 
```

还尝试了 Clr 集合 - 根本不起作用：

```
$people = New-Object "System.Collections.Generic.List``1[System.Object]"
$people.add($john) 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T00:36:08.710

最终的解决方案：

```
# Declare Person class
add-type @"
    public class Person
    {
        public Person() {}

        public string First { get; set; }
        public string Last { get; set; }
    }
"@ -Language CsharpVersion3

# Make strongly-typed collection
[System.Collections.ArrayList] $people = New-Object "System.Collections.ArrayList"

# 
$john = new-object Person
$john.First = "John"
$john.Last = "Smith"

$people.add($john)

$form.Resources["people"] = $people 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-03-27T00:12:14.243

```
[System.Collections.ArrayList] $people = New-Object "System.Collections.ArrayList" 
```

> 如果必须传递参数，则应将它们设为强类型，以便 PowerShell 不会将其包装为 PsObject。

[链接不再有效](http://poshcode.org/68)

# ruby-on-rails - 了解 Ruby on Rails 渲染时间

> ID：687758
> 
> 赞同：10
> 
> 时间：2009-03-26T22:12:15.857
> 
> 标签：ruby-on-rails, optimization, benchmarking, performance

我正在对我的应用程序进行“优化”，并试图了解 rails（2.2.2 版）在渲染结束时给出的输出。

这是“旧”方式：

```
Rendered user/_old_log (25.7ms)
Completed in 466ms (View: 195, DB: 8) | 200 OK 
```

而“新”的方式：

```
Rendered user/_new_log (48.6ms)
Completed in 337ms (View: 192, DB: 33) | 200 OK 
```

这些查询完全相同，不同之处在于旧方式是解析日志文件，而新方式是查询数据库日志表。

页面的实际速度不是问题（用户理解这是一个缓慢的请求）......但我希望页面尽快响应，即使它是一个“慢”页面。

所以，我的问题是，这些数字代表/意味着什么？换句话说，哪种方式更快，为什么？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-26T23:47:36.817

这：

```
Rendered user/_old_log (25.7ms) 
```

*是只*渲染`_old_log`部分模板的时间，它来自由ActionView [::LogSubscriber](http://api.rubyonrails.org/v5.1/classes/ActionView/LogSubscriber.html)处理的[ActiveSupport::Notification](http://guides.rubyonrails.org/active_support_instrumentation.html#render-partial-action-view)

这：

```
Completed 200 OK in 466ms 
```

是返回的http状态，以及整个请求的总时间。它来自[ActionController::LogSubscriber](http://api.rubyonrails.org/v5.1/classes/ActionController/LogSubscriber.html)。

另外，请注意末尾的括号中的项目：

```
(Views: 124.6ms | ActiveRecord: 10.8ms) 
```

这些是渲染整个视图（部分和所有内容）和所有数据库请求的总时间，分别来自[ActionController::LogSubscriber](http://api.rubyonrails.org/v5.1/classes/ActionController/LogSubscriber.html)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T07:11:46.700

乔丹的回答是正确的。换句话说，第一个数字是页面加载的时间。第二个是生成视图需要多长时间。最后一个数字是您的数据库处理您发送给它的所有查询所需的时间。

您还可以通过从第一个数字中减去最后两个数字来估算控制器和模型代码花费的时间，但更好的方法是使用 Benchmark.measure 方法（[http://www.ruby-doc。 org/stdlib/libdoc/benchmark/rdoc/classes/Benchmark.html](http://www.ruby-doc.org/stdlib/libdoc/benchmark/rdoc/classes/Benchmark.html)）。

您的新方法似乎有所改进，因为控制器/模型中的代码完成得更快。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-26T22:23:14.630

您的新方法是花费更少的时间，但更多的时间来渲染模板。

# c# - 使用存储过程时哪个 ORM 最好

> ID：687762
> 
> 赞同：7
> 
> 时间：2009-03-26T22:13:58.630
> 
> 标签：c#, .net, database, stored-procedures, orm

我有业务对象（开发人员写）和一些 SPROCS（DBA 写）

谁能推荐一个好的对象映射器来处理这种设置。

我尝试了 codesmith 和 nhibernate，但遇到了麻烦。我不介意我的 ORM 是免费的还是付费的。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-26T22:57:53.923

SubSonic 对存储过程有很好的支持。它将每一个都包装在一个辅助方法中，如果需要，您可以从结果中检索强类型集合或实体。我在[这篇博文](http://john-sheehan.com/blog/how-i-use-subsonic-part-1/)中展示了一种方法。只要您的 sproc 返回与 SELECT * FROM TableName 相同的架构，它将与您的 SubSonic 实体一起使用。

至于基于您的数据库生成类，SubSonic 会生成部分类，因此您可以根据需要扩展它们。您还可以将 SubSonic 生成的类映射到您的实际模型。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-26T23:08:54.037

Subsonic 有一个灵活的解决方案：

```
 class CustomerOrder {
        private string productName;

        public string ProductName {
            get { return productName; }
            set { productName = value; }
        }
        private int total;

        public int Total {
            get { return total; }
            set { total = value; }
        }

    } 
```

然后：

```
List<CustomerOrder> orders = Northwind.SPs.CustOrderHist("ALFKI")
        .ExecuteTypedList<CustomerOrder>(); 
```

Subsonic 是一款坚固的“瑞士军刀”式 ORM。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-07-11T04:51:22.277

免责声明：我是[Dapper](http://samsaffron.com/archive/2011/03/30/How+I+learned+to+stop+worrying+and+write+my+own+ORM)的作者。

* * *

如果您正在寻找一个简单的对象映射器来处理将过程映射到业务对象，那么[Dapper](http://samsaffron.com/archive/2011/03/30/How+I+learned+to+stop+worrying+and+write+my+own+ORM)非常适合。

请记住，它没有“图形管理”、“身份映射”等。它提供了一个简单的、**完整**的解决方案，涵盖了其他 ORM 没有的许多场景。

[尽管如此，它还是提供了最快的对象物化器之一，在某些基准测试](http://samsaffron.com/archive/2011/03/30/How+I+learned+to+stop+worrying+and+write+my+own+ORM)中，它可以比 EF 快 10 倍，甚至比亚音速快 100 倍。

* * *

琐碎的：

```
create proc spGetOrder
   @Id int
as 
select * from Orders where Id = @Id
select * from OrderItems where OrderId = @Id 
```

可以用以下方式映射：

```
var grid = cnn.QueryMultiple("spGetOrder", new {Id = 1}, commandType: CommandType.StoredProcedure);
var order = grid.Read<Order>();
order.Items = grid.Read<OrderItems>(); 
```

此外，您还支持：

1.  一个多映射器，允许您将单行映射到多个对象
2.  输入/输出/返回参数支持
3.  用于 db 特定参数处理的可扩展接口（如 TVP）

例如：

```
create proc spGetOrderFancy
   @Id int,
   @Message nvarchar(100) output 
as 
set @Message = N'My message' 
select * from Orders join Users u on OwnerId = u.Id where Id = @Id
select * from OrderItems where OrderId = @Id
return @@rowcount 
```

可以映射为：

```
var p = new DynamicParameters(); 
p.Add("Id", 1);
p.Add("Message",direction: ParameterDirection.Output);
p.Add("rval",direction: ParameterDirection.ReturnValue);
var grid = cnn.QueryMultiple("spGetOrder", p, commandType: CommandType.StoredProcedure);
var order = grid.Read<Order,User,Order>((o,u) => {o.Owner = u; return o;});
order.Items = grid.Read<OrderItems>(); 

var returnVal = p.Get<int>("rval"); 
var message = p.Get<string>("message"); 
```

* * *

最后，dapper 还允许自定义参数实现：

```
public interface IDynamicParameters
{
   void AddParameters(IDbCommand command);
} 
```

在实现此接口时，您可以告诉 dapper 您希望将哪些参数添加到命令中。这允许您支持 Table-Valued-Params 和其他 DB 特定功能。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-26T22:31:49.930

根据数据库[Entity Framework](http://msdn.microsoft.com/en-us/library/bb399203.aspx)或[NHibernate](http://softwaredevscott.spaces.live.com/blog/cns!1A9E939F7373F3B7!241.entry)可能是您最好的选择（链接中的示例）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-26T22:17:34.690

LINQ to SQL 设计器将为您提供类型安全的存储过程作为 DataContext 对象上的方法。您可以很容易地将它们映射到对象以进行 CRUD 操作。

事实上，我正在这样做。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-27T14:43:45.350

由于您有一个编写存储过程的 DBA，我认为最好的办法是与他密切合作，弄清楚如何将表映射到对象，以及如何构建数据库以使其适用于您的域模型。存储过程没有任何问题，它们只需要开发人员和 DBA 之间的密切合作。

理想情况下，有问题的 DBA 是您项目团队的一员……

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-26T22:34:41.263

我看到的主要问题是，通过使用 SP，您会自动失去使用 ORM 时获得的很多灵活性，特别是在信息检索方面。因此，我确信您将无法使用大多数 ORM 的所有功能。

例如，如果您使用 linq2sql，您将拥有相当多的 SP 包装器。您还可以将生成的实体的插入、删除和更新映射到存储过程。您在信息检索上松了很多，因为查询现在已修复（并且您可能检索到比需要更多的信息，即额外的列 - 或创建大量 SP）和延迟加载。

**更新：**我更像是一个 linq2sql 人，但我会再看看你对 NHibernate 的假设。特别是，我怀疑它会强制列顺序，因为它配置了列名（请参阅[http://nhibernate.info/blog/2008/11/23/populating-entities-from-stored-procedures-with-nhibernate.html](http://nhibernate.info/blog/2008/11/23/populating-entities-from-stored-procedures-with-nhibernate.html)）。它还支持我不知道如何处理 linq2sql：[http](http://nhibernate.info/blog/2008/11/23/populating-entities-with-associations-from-stored-procedures-with-nhibernate.html) ://nhibernate.info/blog/2008/11/23/populating-entities-with-associations-from-stored-procedures-with-nhibernate.html . 请注意，我并不是说 linq2sql 不支持最后一个，只是我不知道如何；）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-27T14:52:12.460

我喜欢 Entity Framework 现在处理存储过程的方式。您可以将 sprocs 与实体的 crud 操作相关联，它甚至可以检测哪些 sprocs 与您的实体的属性相匹配。现在的一大缺点是，如果您将一个 sproc 与一个实体相关联，则必须将所有 crud 操作与一个 sproc 相关联。

这篇[EF Sproc 文章](http://blogs.msdn.com/meek/archive/2008/03/26/ado-entity-framework-stored-procedure-customization.aspx)有一些关于如何在 EF 中使用 sprocs 的很好的示例，并且还有一些非常好的扩展方法。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-06-04T06:19:29.973

这些天您可能会尝试 Nfinity.Data，它对存储过程具有强类型支持，包括表值参数 (TVP) 和输出参数。要读取任何结果，您需要手动访问阅读器（它为此提供了阅读器抽象）。

我不相信 NHibernate 或 EF 将实体映射到存储过程的想法，因为它们的内部工作是不确定的，即直到运行时才能以任何方式验证。通过上述阅读器在代码中执行所有操作更具声明性。

# javascript - 如何从 Javascript 函数返回两个变量作为属性

> ID：687764
> 
> 赞同：2
> 
> 时间：2009-03-26T22:14:37.193
> 
> 标签：javascript, dojo

不确定在 Dojo 或 JS 中是否可以让函数返回具有两个 vars 属性的对象？我的代码不起作用，但正如我的要求：

```
function getObj()
{
    var var1 = 123; // 123 as simple case, but it could be a DOM node
    var var2 = 345; // another DOM node
    return {v1: var1, v2: var2}; // any way to get two values back?
}
....
var obj = getObj();
console.log("obj.v1: " + obj.v1 + "; obj.v2: " + obj.v2); // not working but possible? 
```

好的，这是我真正的功能：

```
 dojo.requre("dojo.html");
 ....
 function getNodes()
 {
     var node = dojo.byId("div1"); // static <div> in html 
     var childen = "<div id='chart' style='width: 10px; height: 10px'></div><div id='legend'></div>";
     dojo.html.set(node, children); // add two divs as children
     var nodeChart = dojo.byId("chart");
     var nodeLegent = dojo.byId("legend");
     return {chart: nodeChart, legend: nodeLegend};
 }
 ...
 var nodes = getNodes();
 var nodeChart = nodes.chart; // OK div#chart
 var nodeLegend = nodes.legend; // nodes.legend is div#legend, but nodeLegend is undefined! 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-26T22:19:55.230

是的，这是可能的。我刚刚尝试了你的代码，它工作正常......

```
<html>
  <head>
    <script>
        function getObj(){
          var var1 = 123; // 123 as simple case, but it could be a DOM node
          var var2 = 345; // another DOM node
          return {v1: var1, v2: var2}; // any way to get two values back?
        }

        var obj = getObj();
        alert(obj.v1);
    </script>
  </head>
  <body>
    <h1>Test</h1>
  </body>
</html> 
```

**编辑：**

你有错别字...

```
 var nodeLegent = dojo.byId("legend");
 return {chart: nodeChart, legend: nodeLegend}; 
```

您的 var 名为*nodeLegent*，但您正在传递*nodeLegend* (undefined)

不要难过；每个人都会犯这样的错误。只需要另一双眼睛。

# php - 如何使用 PHP 将数据通过 UDP 发送到 IP 地址？

> ID：687765
> 
> 赞同：6
> 
> 时间：2009-03-26T22:14:51.420
> 
> 标签：php, udp, sockets

如何使用 PHP 将数据通过 UDP 发送到 IP 地址？

如何在另一台计算机上接收该数据？

```
<?php
$fp = pfsockopen( "udp://192.168.1.6", 9601, $errno, $errstr );

if (!$fp)
{
    echo "ERROR: $errno - $errstr<br />\n";
}
socket_set_timeout ($fp, 10);

$write = fwrite( $fp, "kik" );
//$data .= fread($fp,9600);
//echo "$data<br>";
fclose($fp);
echo "<br>Connection closed ..<br>";

if (!$write) {
    echo "error writing to port: 9600.<br/>";
    next;
?> 
```

这段代码发送带有程序的“kik”，我可以在另一台计算机上阅读它，但我如何在浏览器中看到它？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-26T22:25:48.603

我的 PHP 知识有点生疏，所以我一直在做一些搜索，试图找到一些好的指南和教程。这个[PHP Sockets Made Easy](http://www.litfuel.net/tutorials/sockets/sockets.php)看起来对你来说是一个很好的入门指南。

**编辑**：我发布的原始文章没有详细介绍 UDP，所以我删除了前面的代码。[PHP 手册](http://php.net/manual/en/function.stream-socket-server.php)中的文章有一些专门关于 UDP 的更多信息：

```
<?php
$socket = stream_socket_server("udp://127.0.0.1:1113", $errno, $errstr, STREAM_SERVER_BIND);
if (!$socket) {
    die("$errstr ($errno)");
}

do {
    $pkt = stream_socket_recvfrom($socket, 1, 0, $peer);
    echo "$peer\n";
    stream_socket_sendto($socket, date("D M j H:i:s Y\r\n"), 0, $peer);
} while ($pkt !== false);

?> 
```

**编辑#2**：这是另一个[有用](http://www.weberdev.com/ViewArticle/Socket-Programming-With-PHP)的 PHP 套接字编程教程。它主要是 TCP，但它确实包含有关如何更改代码以改用 UDP 的部分。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T22:28:31.840

刚刚从我拥有的一些工作代码中提取了这个片段

```
 if (!socket_bind($sh, LISTENIP, LISTENPORT)) exit("Could not bind to socket");

while (TRUE) {
    // $z = socket_recvfrom($sh, $data, 65535, 0, $connectip, $connectPort);
    while(socket_recvfrom($sh, $data, 65535, 0, $connectip, $connectPort)) {
        $pid = pcntl_fork();
        if ($pid == -1) {
            die('could not fork');
        } else { #START ELSE COULD FORK
            $PIDS[$pid] = $pid; //KEEP TRACK OF SPAWNED PIDS
            if ($pid) {
                //PARENT THREAD : $ch is a copy that we don't need in this thread
            } else {
                /** CHILD THREAD::BEGIN PROCESSING THE CONNECTION HERE!    **/
                include "include/child_thread.inc.php";
            } //Child Thread
        }//if-else-forked

        /** CLEANUP THE CHILD PIDs HERE :: "Any system resources used by the child are freed." **/
        foreach ($PIDS as $pid) pcntl_waitpid($pid,$status,WNOHANG);

        $i++; //INCREASE CONNECTION COUNTER
    }//While socket_accept

    /** CLEANUP THE PARENT PIDS **/
    foreach ($PIDS as $pid) {
        $returnPid = pcntl_waitpid($pid,$status);
        unset($PIDS[$pid]);
    }
}//While True 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-11-28T05:21:21.133

```
<?php
$server_ip   = '127.0.0.1';
$server_port = 43278;
$beat_period = 5;
$message     = 'PyHB';
print "Sending heartbeat to IP $server_ip, port $server_port\n";
print "press Ctrl-C to stop\n";
if ($socket = socket_create(AF_INET, SOCK_DGRAM, SOL_UDP)) {
  while (1) {
    socket_sendto($socket, $message, strlen($message), 0, $server_ip, $server_port);
    print "Time: " . date("%r") . "\n";
    sleep($beat_period);
  }
} else {
  print("can't create socket\n");
}
?> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T22:18:02.227

我想您会发现[PHP 的套接字参考](http://php.net/manual/en/intro.sockets.php)是研究这个主题的好地方。

# iphone - 如何将 ViewController 添加到滚动视图

> ID：687766
> 
> 赞同：2
> 
> 时间：2009-03-26T22:15:06.273
> 
> 标签：iphone

我有一个滚动视图，我正在尝试从 nib 文件中添加 ViewControllers。

```
ViewController *controller=[[ViewController alloc] initWithNibName:@"ViewController" bundle:[NSBundle mainBundle]];
[scrollview addSubview:controller]; 
```

Scrollview 在别处定义。

每当我添加其他项目（如`UIViews`简单的彩色背景）时，效果都很好。当我`ViewController`从笔尖添加时，`Viewdidload`被击中，图像从笔尖加载，但随后控制器代码停在那里（否`viewWillAppear`等）。所以我没有得到任何控制器的处理。

当作为导航或选项卡控制器推送时，相同的控制器可以正常工作。我确定我在教育过程中遗漏了一些东西，但希望有人能帮助我继续前进。

BTW：`ViewController`以上是一个简单的`UIViewController`.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-23T17:13:03.390

我认为您的问题是 addSubview 期望 UIView 而不是 UIViewController - 编译时您可能会收到警告（“可能不响应选择器”或类似的？）。如果是这样，请不要忽略这些-根据我的经验，通常它们是您的代码中的问题:-)

你可以尝试类似的东西

```
[scrollview addSubview:controller.view]; 
```

但这仍然不会让您获得视图控制器的处理......您需要在具有滚动视图 AFAIK 的视图控制器中进行该处理。我建议首先尝试在 IB 中使用滚动视图来获得基本视图。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T23:00:41.233

好的，看起来有点不对劲，但我在 viewDidLoad 中添加了 viewWillAppear，这很有效，但这似乎不是正确的方法，对吗？

# javascript - 如何在整个页面加载之前显示 jquery 对话框？

> ID：687767
> 
> 赞同：7
> 
> 时间：2009-03-26T22:15:12.280
> 
> 标签：javascript, jquery, jquery-ui, progress-bar

在我的网站上，许多操作可能需要很长时间才能完成。

当我知道页面需要一段时间才能加载时，我想在页面加载时显示进度指示器。

理想情况下，我想说的是：

```
$("#dialog").show("progress.php"); 
```

并将该叠加层放在正在加载的页面顶部（操作完成后消失）。

编码进度条和显示进度不是问题，问题是在加载页面时弹出进度指示器。我一直在尝试为此使用 JQuery 的对话框，但它们仅在页面加载后出现。

这一定是一个常见问题，但我对 JavaScript 不够熟悉，不知道最好的方法。

这是一个简单的例子来说明这个问题。下面的代码在 20 秒暂停结束之前无法显示对话框。我在 Chrome 和 Firefox 中尝试过。事实上，我什至没有看到“请稍候......”文字。

这是我正在使用的代码：

```
<html>
  <head>
      <link type="text/css" href="http://jqueryui.com/latest/themes/base/ui.all.css" rel="stylesheet" />
    <script type="text/javascript" src="http://jqueryui.com/latest/jquery-1.3.2.js"></script>
    <script type="text/javascript" src="http://jqueryui.com/latest/ui/ui.core.js"></script>
    <script type="text/javascript" src="http://jqueryui.com/latest/ui/ui.dialog.js"></script>

  </head>
  <body>
    <div id="please-wait">My Dialog</div>
    <script type="text/javascript">
      $("#please-wait").dialog();
    </script>
    <?php
    flush();
    echo "Waiting...";
    sleep(20);
    ?>
  </body>
</html> 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-26T22:33:37.303

您需要在 <body> 标记之后立即运行那段代码，例如：

```
<html>
  <head>
  </head>
  <body>
    <div id="please-wait"></div>
    <script type="text/javascript">
      // Use your favourite dialog plugin here.
      $("#please-wait").dialog();
    </script>
    ....
  </body>
</html> 
```

注意我省略了传统的 $(function (){}) 因为您需要在页面显示后立即加载它，而不是在加载整个 DOM 之后。

我以前做过这个并且效果很好，即使页面还没有完成加载。

**编辑：**您必须确定您正在使用的 jQuery 对话框插件在整个 DOM加载*之前加载。*通常情况并非如此，您将无法正常工作。在这种情况下，您需要使用 g'old 纯 JavaScript 解决方案，例如[Lightbox 1](http://www.huddletogether.com/projects/lightbox/)或[Lightbox 2](http://www.lokeshdhakar.com/projects/lightbox2/)。

# mfc - AfxMessageBox 中的超链接

> ID：687773
> 
> 赞同：1
> 
> 时间：2009-03-26T22:18:23.567
> 
> 标签：mfc

是否可以将网站/电子邮件的超链接添加到由创建的窗口中显示的消息`AfxMessageBox`？如果不是，那么有什么简单的方法可以用`AfxMessageBox`生成一个包含超链接的文本的类似窗口的调用来替换调用？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T13:21:04.380

您不能`MessageBox`为此使用标准（无论是否包装`AfxMessageBox`），但还有其他几个选项可供您选择：

1.  如果您使用的是 Vista，则可以改用[TaskDialog](http://blogs.chimpswithkeyboards.com/jonshute/archive/2006/11/26/230.aspx)类。
2.  如果没有，您可以调整 MessageBox 替换类之一（例如[XMessageBox](http://www.codeproject.com/KB/dialog/xmessagebox.aspx)）以支持此功能。

# linux - 记录 shell 脚本的参数

> ID：687780
> 
> 赞同：56
> 
> 时间：2009-03-26T22:21:50.797
> 
> 标签：linux, unix, shell

是否有记录 shell 脚本参数的约定？

例如：

```
#!/usr/bin/env bash

# <description>
#
# Usage:
#  $ ./myScript param1 [param2]
# * param1: <description>
# * param2: <description> 
```

我不喜欢这个特定模板的一些事情：

*   脚本的文件名 ( `myScript`) 出现在文件本身中
*   参数描述看起来很奇怪
*   前面的前导空格在`$`视觉上很有用，但可能会导致带有块注释的语言混淆，导致一些验证工具抱怨混合/不一致的缩进（例如，此块中的空格，代码标签 - 当然，前提是更喜欢标签）

有没有这方面的指导方针？

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2009-03-26T22:34:30.640

传统上，您在 usage() 函数中记录您的参数：

```
#!/bin/bash

programname=$0

function usage {
    echo "usage: $programname [-abch] [-f infile] [-o outfile]"
    echo "  -a      turn on feature a"
    echo "  -b      turn on feature b"
    echo "  -c      turn on feature c"
    echo "  -h      display help"
    echo "  -f infile   specify input file infile"
    echo "  -o outfile  specify output file outfile"
    exit 1
}

usage 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2016-11-14T00:39:33.843

我会推荐使用heredoc：

```
usage () {
    cat <<HELP_USAGE

    $0  [-a] -f <file>

   -a  All the instances.
   -f  File to write all the log lines
HELP_USAGE
} 
```

代替：

```
echo "$0  [-a] -f <file>"
echo
echo "-a  All the instances."
echo "-f  File to write all the log lines." 
```

我认为它比所有这些*回声*线都干净。

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2009-03-26T22:33:48.380

我通常将我的用法包装在函数中，这样我就可以从 -h 参数等中调用它。

```
#!/bin/bash
usage() {
    cat <<EOM
    Usage:
    $(basename $0) Explain options here

EOM
    exit 0
}

[ -z $1 ] && { usage; } 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-03-26T22:28:55.053

执行此操作的[Vim bash IDE](http://www.linux.com/feature/114359)：

```
#!/bin/bash
#===============================================================================
#
#          FILE:  test.sh
#
#         USAGE:  ./test.sh
#
#   DESCRIPTION:
#
#       OPTIONS:  ---
#  REQUIREMENTS:  ---
#          BUGS:  ---
#         NOTES:  ---
#        AUTHOR:  Joe Brockmeier, jzb@zonker.net
#       COMPANY:  Dissociated Press
#       VERSION:  1.0
#       CREATED:  05/25/2007 10:31:01 PM MDT
#      REVISION:  ---
#=============================================================================== 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-03-26T22:27:49.737

我建议让您的脚本自动打印使用情况（如果它不应该在没有参数的情况下运行）：

```
#!/usr/bin/env bash

if [ $# == 0 ]; then
    echo "Usage: $0 param1 [param2]"
    echo "* param1: <description>"
    echo "* param2: <description>"
fi 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-26T22:26:47.413

我宁愿写：

```
Usage: `basename $0` [option1]|[option2] param1
  Options:
   - option1:  .....
   - option2:  .....
  Parameters:
   - param1:   ..... 
```

尝试查看标准 UNIX 实用程序的帮助格式（例如，ls --help）

# .net - 将应用程序更新部署到多个站点

> ID：687781
> 
> 赞同：7
> 
> 时间：2009-03-26T22:22:02.230
> 
> 标签：.net, asp.net, windows, deployment

我有一个由 ASP.NET Web 应用程序、几个 Windows 服务和一个 SQL Server 2005 数据库组成的应用程序。此应用程序在多个站点上复制，因此每个站点都有一个包含所有部分（Web 应用程序、服务和 DB）的服务器。目前部署更新的过程是这样的：

## 数据库

1.  脚本数据库更改（使用 Management Studio 中的生成脚本）。
2.  在 Management Studio 中连接到站点的数据库。
3.  在站点的数据库上运行 SQL 脚本。
4.  对每个站点重复 2 和 3。

## Web应用程序

1.  在 Visual Studio 中使用发布。
2.  从已发布的副本中删除 web.config。
3.  压缩 Web 应用程序文件。
4.  将 zip 文件复制到站点。
5.  远程桌面进入该站点以解压缩文件。
6.  必要时手动修改 web.config。
7.  对每个站点重复 4-6。

## 视窗服务

1.  在 Visual Studio 中构建项目。
2.  Zip 重建二进制文件。
3.  将 zip 文件复制到站点。
4.  远程桌面进入该站点。
5.  停止服务。
6.  卸载旧版本。
7.  安装新版本。
8.  必要时手动修改 .config。
9.  启动服务。
10.  对每个站点重复 3-9。

目前有 3 个站点，部署很烦人但易于管理，但是在一年内我们很可能会有 10 或 11 个站点，并且必须以这种方式部署更新会让我自杀。

因此，我正在寻找有关如何自动化此过程的建议。我已经开始研究学习 MSBuild 以合并配置并将文件复制到我的服务器，但我不确定它会走多远。谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T22:28:42.247

使用任何您熟悉的脚本语言（看起来甚至 .bat 都适合您）并获取[PsTools](http://technet.microsoft.com/en-us/sysinternals/bb896649.aspx)

然后，您可以使用 psexec 和 psservice 远程控制进程和服务。您仍然需要自己编写脚本，但您不必远程登录（例如解压缩和复制文件），适用于一台服务器的方法适用于 10 台服务器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T00:09:02.597

**MSBUILD 几乎可以满足您的所有需求。** 但听起来您需要一些自定义任务才能完全自动化。但只要稍加努力，就可以做到。

MSBUILD 实际上已经是您项目的一部分。它是项目文件本身。它基本上是一切背后的 XML。在这个 XML 中，有 PreBuild 和 PostBuild 事件被触发，您必须执行复制、粘贴命令等。

此外，您可能对 Web 部署项目感兴趣，这些项目允许您为要构建的每个环境拥有多个 web.config 文件。

对于更高级的场景，您可以创建与 MSBUILD 事件集成的自定义任务。您甚至可以对这些任务使用条件。下面的参考资料都在谈论它。

有关 MSBUILD 的更多信息，请访问[http://msdn.microsoft.com/en-us/library/0k6kkbsd.aspx](http://msdn.microsoft.com/en-us/library/0k6kkbsd.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-02T21:34:14.420

对于数据库开发，请尝试[http://www.deltasql.org/wiki](http://www.deltasql.org/wiki)。

如果您存储 SQL 增量脚本，则有一个中央服务器（在 PHP/mySQL 中，可以使用 XAMPP 包轻松安装）。在每个模式上，您需要添加一个表 tbsynchronize ，其中包含在该数据库上执行的最新脚本。deltasql 服务器然后生成一个同步脚本，其中包含该模式的缺失脚本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T22:27:05.713

尽可能多地自动化和编写脚本，甚至是 FTP 部分。使用 ant/nant 和批处理文件为您完成重复的工作。如果可能的话，在事情变得糟糕时提供撤消脚本。我在 3 秒内更新了 linux 机器中的生产代码（使用脚本过程：备份、delta sql 脚本、发布代码、重新启动服务器）但在 Windows 上我不确定你能做到这一点有多巧妙。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T22:41:08.473

好的，所以我没有完整的答案，但是为什么要卸载这些服务。您可以停止它们并替换文件。我一直这样做。但我想看看你得到的答案，因为我有同样的问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-26T22:49:12.790

您可以使用 Visual Studio 中的部署项目和 Web 部署项目来创建 .MSI 文件来进行安装。您甚至可以提示一些站点之间可能不同的信息。

另外，请查看[IIS Web 部署工具](http://www.iis.net/downloads/1603/ItemPermaLink.ashx)。它最近刚刚消失了 RC1。

# c# - 动态 LINQ 和 CSLA BusinessListBase

> ID：687785
> 
> 赞同：0
> 
> 时间：2009-03-26T22:24:12.040
> 
> 标签：c#, linq, csla

我遇到了一个让我快要死的问题。我的一个 CSLA 对象（假设是 Parent）有很多孩子（我们称他们为 Children - Child 的列表）。Parent 是可编辑的根 (BusinessBase)，Child 是可编辑的子列表 (BusinessListBase)，Child 是可编辑的子。

我想做的是这样做： Parent x = Parent.GetParent(id); IQueryable y = Parent.MyChildren.OrderBy("Age DESC");

理论上，y 应该填充按年龄降序排列的孩子集合（假设“年龄”是 Child 对象的属性）。

但是，我得到的是 y.Count() = 0。虽然如果我执行 Parent.MyChildren.Count() 则没有 0。这是动态 LINQ 或 CSLA 中的错误吗？这（错误）不会发生在我的只读列表中。

帮助！乔

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T14:05:44.460

乔，

这是一个可能有帮助的线索。您对可编辑列表和只读列表之间区别的评论让我很好奇，所以我挖得更深一些。

根据我对 CSLA 3.5 代码的深入了解，BusinessListBase 实现了 IQueryable（实际上它是 CSLA 代码中的“C”，如“Child”）。ReadOnlyListBase 类没有。

这可能会影响正在调用哪个 Dynamic LINQ OrderBy 扩展方法（有两个），而用于 IQueryable 的一个只是为常规 IQueryable 调用 OrderBy 的版本。

另一方面，如果您在 BusinessListBase 中跟踪 IQueryable，则 Provider 属性（IQueryProvider 类型）委托给 CslaQueryProvider。

```
public IQueryProvider Provider
{
  get {
    return new Linq.CslaQueryProvider<T, C>(this);
  }
} 
```

综上所述，由于我必须花费的时间有限，我认为可能有必要进一步深入研究（使用调试器，呵呵！） CSLA LINQ 的东西。从其他地方的其他讨论和跟进中，我看到您还指出了为 CSLA 记录的错误/问题。这是链接：

[CSLA 问题 ID 326 - OrderBy 应返回与绑定网格一起使用的 LinqBindingList](http://www.lhotka.net/cslabugs/edit_bug.aspx?id=326 "CSLA 问题 ID 326 - OrderBy 应返回与绑定网格一起使用的 LinqBindingList")

我的怀疑是它与 BusinessListBase 的 IQueryable 实现的关系比其他任何东西都多。再一次，它看起来不像 ReadOnlyListBase 直接或通过继承（在我的 CSLA 3.5 副本中）实现 IQueryable。

希望有帮助。

杰夫·米勒

# java - 我应该如何清理 Java 中的数据库输入？

> ID：687787
> 
> 赞同：14
> 
> 时间：2009-03-26T22:25:24.173
> 
> 标签：java, mysql, security, sql-injection

有人可以指点我一份关于安全运行部分由用户输入形成的 SQL 查询的初学者指南吗？我正在使用 Java，但语言中性指南也很好。

期望的行为是，如果有人在 GUI 中键入类似

`very nice;) DROP TABLE FOO;`

数据库应将其视为文字字符串并安全存储而不删除任何表。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-26T22:30:15.377

您肯定想使用[PreparedStatement](https://docs.oracle.com/javase/7/docs/api/java/sql/PreparedStatement.html)。它们很方便。这是一个[例子](http://www.java2s.com/Code/Java/Database-SQL-JDBC/DemoPreparedStatementAddBatchMySQL.htm)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-26T22:27:33.747

使用[PreparedStatement](https://docs.oracle.com/javase/7/docs/api/java/sql/PreparedStatement.html)而不是[Statement](https://docs.oracle.com/javase/7/docs/api/java/sql/Statement.html)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-26T22:29:36.567

通常，您不应该创建连接输入的查询，而是使用[PreparedStatement](https://docs.oracle.com/javase/7/docs/api/java/sql/PreparedStatement.html)。

这使您可以指定将在查询中设置参数的位置，因此 Java 将负责为您清理所有输入。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-26T22:47:16.773

准备好的声明？是的，一点没错。但我认为还有一步：在接近数据库之前验证来自 UI 的输入并绑定到对象。

我可以看到在 PreparedStatement 中绑定字符串可能仍会使您容易受到 SQL 注入攻击：

```
String userInput = "Bob; DELETE FROM FOO";
String query = "SELECT * FROM FOO WHERE NAME = ?";

PreparedStatement ps = connection.prepareStatement(query);
ps.setString(1, userInput);
ps.executeQuery(); 
```

我必须承认我自己没有尝试过，但如果这是远程可能的话，我会说 PreparedStatement 是必要的，但还不够。在服务器端验证和绑定是关键。

我建议使用 Spring 的绑定 API。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-03T16:51:40.067

您的用户输入实际上必须是`"Bob'; delete from foo; select '"`（或类似的），因此准备好的语句添加的隐式引号将被关闭：

```
SELECT * FROM FOO WHERE NAME = 'Bob'; delete from foo; select '' 
```

但是如果你这样做，准备好的语句代码将引用你的报价，这样你就可以得到一个实际的查询

```
SELECT * FROM FOO WHERE NAME = 'Bob''; delete from foo; select ''' 
```

并且您的姓名将被存储为`"Bob', delete from foo; select '"`而不是运行多个查询。

# c++ - C++ const std::map 引用无法编译

> ID：687789
> 
> 赞同：17
> 
> 时间：2009-03-26T22:26:03.097
> 
> 标签：c++, find, std, operator-keyword, stdmap

传递对 a `std::map`as const 的引用会导致 [] 运算符中断是否有原因？使用 const 时出现此编译器错误（gcc 4.2）：

> 错误：“map[name]”中的“operator[]”不匹配</p>

这是函数原型：

```
void func(const char ch, std::string &str, const std::map<std::string, std::string> &map); 
```

`const`而且，我应该提一下，当我删除. 前面的关键字时没有问题`std::map`。

如果我的指示正确，如果 [] 运算符找不到密钥，它实际上会在映射中插入一个新对，这当然可以解释为什么会发生这种情况，但我无法想象这会是可接受的行为。

如果有更好的方法，比如使用*find*而不是 []，我将不胜感激。我似乎也无法找到工作……我收到*const* mismatched iterator 错误。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-03-26T22:30:08.217

是的，您不能使用`operator[]`. 使用`find`，但请注意它返回`const_iterator`而不是`iterator`：

```
std::map<std::string, std::string>::const_iterator it;
it = map.find(name);
if(it != map.end()) {
    std::string const& data = it->second;
    // ...
} 
```

就像指针一样。你不能分配`int const*`给`int*`. 同样，您不能分配`const_iterator`给`iterator`.

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-26T22:28:41.403

当您使用 operator[] 时，std::map 会查找具有给定键的项目。如果它没有找到，它会创建它。因此 const 的问题。

使用 find 方法，你会没事的。

您能否发布有关您如何尝试使用 find() 的代码？正确的方法是：

```
if( map.find(name) != map.end() )
{
   //...
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-06-04T18:58:18.903

如果您使用的是 C++11，则[std::map::at](http://www.cplusplus.com/reference/map/map/at/)应该适合您。

[std::map::operator[]](http://www.cplusplus.com/reference/map/map/operator%5B%5D/)不起作用的原因是，如果您要查找的键在地图中不存在，它将使用提供的键插入一个新元素并返回对它的引用（有关详细信息，请参阅链接）。这在 const std::map 上是不可能的。

但是，如果键不存在，'at' 方法将引发异常。话虽如此，在尝试使用 'at' 方法访问元素之前，使用 std::map::find 方法检查密钥是否存在可能是个好主意。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-26T22:29:20.047

可能是因为 std::map 中没有 const operator[]。operator[] 将添加您正在寻找的元素，如果它没有找到它。因此，如果您想在不添加的情况下进行搜索，请使用 find() 方法。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-26T22:34:40.547

对于您的“常量不匹配迭代器错误”：

find() 有两个重载：

```
 iterator find ( const key_type& x );
const_iterator find ( const key_type& x ) const; 
```

我的*猜测*是你得到这个错误是因为你正在做一些事情，比如为地图`find()`上的调用结果分配一个非常量迭代器（在左侧） `const`：

```
iterator<...> myIter /* non-const */ = myConstMap.find(...) 
```

这将导致错误，尽管可能不是您所看到的错误。

# iphone - 滚动时确定 UITableViewCell 的坐标

> ID：687793
> 
> 赞同：17
> 
> 时间：2009-03-26T22:27:07.680
> 
> 标签：iphone, uitableview, fade

我的目标是让 UITableViewCells 在接近 UITableView 的边界并即将被覆盖/显示时淡入/淡出。

我一直在尝试的方法是在滚动事件期间获取 UITableViewCell 的坐标。问题是每个单元格似乎都在 0,0。我尝试将坐标转换为父表和视图，但它们仍然出现在 0,0。

所以一般来说，如果有人知道获取坐标的方法，或者知道根据他们的位置淡入和淡出 UITableViewCells 的更好方法，我将非常感谢您提供的任何建议。

谢谢你的时间，乔尔

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2011-01-06T22:13:11.843

第一步是使用

`CGRect rectInTableView = [tableView rectForRowAtIndexPath:indexPath];`

它将报告 tableView 中单元格的 CGRect。但是，这个值不会随着 tableView 的滚动而改变。它是相对于表格第一行（而不是第一可见行）的位置。要获得单元格在屏幕上的位置，您必须使用将其转换为超级视图坐标系

```
CGRect rect = [tableView convertRect:rectInTableView toView:[tableView superview]]; 
```

所以下面这行就完成了

```
CGRect rect = [tableView convertRect:[tableView rectForRowAtIndexPath:indexPath] toView:[tableView superview]]; 
```

**斯威夫特 4**

```
// Consider the indexPath at row 1, section 0.
let rectWithinTableView : CGRect = self.tableView.rectForRow(at: IndexPath(row: 1, section: 0))
let rectWithSuperViewCoordinates : CGRect = self.convert(rect: rectWithinTableView, to: self.tableView.superview) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-27T01:29:23.420

为什么不在 UIImageView 中使用部分透明的渐变 PNG 叠加，顶部和底部的透明度较低？

在表格滚动中乱用单元格绘图将对性能产生很大影响。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-08-05T23:06:40.933

你可以打电话

```
- (CGRect)rectForRowAtIndexPath:(NSIndexPath *)indexPath; 
```

得到任何给定单元格的矩形。这将包含它在矩形内的原点结构中的坐标。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T23:16:21.197

我怀疑这些单元格保存在 UITableView 的“单元格大小”子视图中，因此您看到的是相对于该视图的框架。

我没有实际的答案，但是，我建议您查看 UIScrollView 的委托类：UIScrollViewDelegate。它会响应`– scrollViewDidScroll:`，您可以手动计算出您的偏移量。UIScrollView 是 UITableView 的超类。

`- (CGPoint)convertPoint:(CGPoint)point toView:(UIView *)view`您可以使用 UIView 的方法将点（例如您的原点）转换为另一个视图的坐标。

# documentation - ColdFusion 代码的自动文档

> ID：687802
> 
> 赞同：15
> 
> 时间：2009-03-26T22:29:06.427
> 
> 标签：documentation, coldfusion, automation, mindmapping

我继承了 600 多个 ColdFusion 源代码文件，为我的公司运行了一个内部网站。我的任务之一是“记录”它。代码库代表了大约 5 年的开发，没有关于它的功能的技术规范。

开发人员维护了每个文件的更改日志，并且有一个一致的标题。

我的想法是，我可以构建各种模块和引用的存储过程的依赖关系图，以通过扫描源文件来简化此文档。我过去曾将 Doxygen 用于 C++ 源代码，我想知道 ColdFusion 是否存在这样的工具。

我正在研究的一个输出是创建 xmind 文件的能力，作为可视化模块相互关系中的交叉依赖关系的手段。

提前致谢，

克里斯

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2011-02-07T19:41:05.180

ColdFusion 服务器[内置了自省](http://help.adobe.com/en_US/ColdFusion/9.0/Developing/WSc3ff6d0ea77859461172e0811cbec22c24-7dc5.html)功能，可以为任何 CFC 类输出类似 javadoc 的文档。

看：`http://YourColdfusionServer/CFIDE/componentutils/componentdoc.cfm`

但是，它需要您的服务器的 RDS 登录名/密码。为了交付给第三方，我设置了一个递归脚本，它`cfhttp`针对每个 cfc 文件的文档进行提取，然后将页面编译为带有`cfdocument`.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-26T22:34:06.990

你可以从[ColdDoc开始](http://colddoc.riaforge.org/)

此外，还有一个[UML 2 CFC](http://www.briankotek.com/blog/index.cfm/2007/6/12/Generate-CFCs-from-UML-Using-CFC-Stub-Generator)生成器。

我猜你真正需要的是将coldfusion代码逆向工程为uml类图。我什么都不知道。

[MagicDraw](http://www.magicdraw.com/)，[Objecteering](http://www.objecteering.com/index.php)似乎还没有做到这一点。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-06-29T21:29:41.813

在尝试自己找到这个问题的答案后，我最终编写了这个解决方案：

[冷鸭](http://murrayhopkins.wordpress.com/2013/06/25/coldduck-beautiful-documentation-for-coldfusion-cfcs/)

也许现在对你来说为时已晚，但我只是在传播这个词。

默里

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-30T20:53:14.237

在我看来，创建自己的 Xmind 或 XMI 文件是可行的方法。XMI 文件在工具之间可能更具可移植性，但我上次研究时，XMI 文件格式对于我可用于解决方案的时间来说有点令人生畏。如果标题的格式一致，足以使用 ReFind 或 Find 读取，我将构建一个使用 cfdirectory 和 cffile 遍历代码树并输出文件的脚本。

# c# - 关于索引器和/或泛型的问题

> ID：687808
> 
> 赞同：3
> 
> 时间：2009-03-26T22:30:58.573
> 
> 标签：c#, generics, indexer

怎么可能知道一个对象是否实现了索引器？，我需要为 DataRow 和 IDataReader 共享一个逻辑，但它们不共享任何接口。

我也尝试过使用泛型，但不知道应该对 where 子句施加什么限制。

```
public class Indexer {
    // myObject should be a DataRow or a IDataReader
    private object myObject;
    public object MyObject {
        get { return myObject; }
        set { myObject = value; }
    }
    // won't compile, myObject has no indexer
    public object this[int index] {
        get { return myObject[index]; }
        set { myObject[index] = value; }
    }
    public Indexer(object myObject) {
        this.myObject = myObject;
    }
}

public class Caller {
    void Call() {
        DataRow row = null;
        IDataReader reader = null;
        var ind1 = new Indexer(row);
        var ind2 = new Indexer(reader);
        var val1 = ind1[0];
        var val2 = ind1[0];
    }
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T22:34:59.580

您需要声明一个带有索引器属性的接口，将该接口用作约束，并且类型参数类需要实现该接口以满足约束。

由于您无法控制要使用的类，因此这是行不通的。

另一种方法是让`Indexer`类将 get/set 操作作为单独的参数：

```
public class Indexer {

    private Func<int, object> getter;        
    private Action<int, object> setter;

    public object this[int index] 
    {
        get { return getter(index); }
        set { setter(index, value); }
    }

    public Indexer(Func<int, object> g, Action<int, object> s) 
    {
        getter = g;
        setter = s;
    }
}

public static class IndexerExtensions
{
    public static Indexer ToIndexer(this DataRow row)
    {
        return new Indexer(n => row[n], (n, v) => row[n] = v);
    }

    public static Indexer ToIndexer(this IDataReader row)
    {
        return new Indexer(n => row[n], (n, v) => row[n] = v);
    }
} 
```

然后你可以这样做：

```
DataRow row = null;
IDataReader reader = null;
var ind1 = row.ToIndexer();
var ind2 = reader.ToIndexer();
var val1 = ind1[0];
var val2 = ind1[0]; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T22:40:22.420

您可以使您的索引器成为一个抽象基类，具有两个子类，一个用于 DataRow，一个用于 IDataReader。

为了使其更易于使用，可以存在 2 种工厂方法，例如：

```
`var ind1 = Indexer.CreateFromDataRow(row);
var ind2 = Indexer.CreateFromIDataReader(reader);` 
```

`他们可以为该类型创建一个特定的基类，并使用它自己的逻辑来处理索引。`

 `这避免了为每个 get/set 调用不断检查类型的开销（以单个虚拟属性而不是标准属性为代价）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T22:38:52.987

```
get { 
    DataRow row = myObject as DataRow;
    if (row != null)
        return row[index];
    IDataReader reader = myObject as IDataReader;
    if (reader != null)
        return reader[index];
} 
```

并对 set{} 使用相同的逻辑

# c++ - C++ int 操作在 mips 架构上是原子的吗

> ID：687813
> 
> 赞同：4
> 
> 时间：2009-03-26T22:32:56.963
> 
> 标签：c++, multithreading, mips, processor, cpu-architecture

我想知道我是否可以在不锁定 mips cpu（尤其是亚马逊或多瑙河）的情况下读取或写入共享 int 值。我的意思是如果这样的读取或写入是原子的（其他线程不能中断它们）。需要明确的是 - 我不想阻止线程之间的竞争，但我关心 int 值本身是否没有损坏。

假设编译器在 cpu 字的边界对齐所有 int，应该是可能的。我使用 gcc (g++)。测试还表明它似乎工作正常。但也许有人肯定知道？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-26T22:38:48.947

使用 gcc 的内置原子操作，如果它们不受支持，您会收到警告：http: [//gcc.gnu.org/onlinedocs/gcc-4.1.2/gcc/Atomic-Builtins.html](http://gcc.gnu.org/onlinedocs/gcc-4.1.2/gcc/Atomic-Builtins.html)

看起来加法/减法和测试的组合（至少）在硬件上是可能的： [http ://rswiki.csie.org/lxr/http/source/include/asm-mips/atomic.h](http://rswiki.csie.org/lxr/http/source/include/asm-mips/atomic.h)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-26T22:36:25.893

取决于操作。在 MIPS 中看了足够多的反汇编程序后，我知道只有一些操作是原子的。

新值的分配可能是 1 个操作或更多，您必须查看程序集。

例如：

```
x = 0; // move $a0, $0

x = 0x50000; // lui $a0, 0x0005

x = 0x50234; // lui $a0, 0x0005
             // ori $a0, 0x0234 
```

MIPS 汇编[参考](http://www.mrc.uidaho.edu/mrc/people/jff/digital/MIPSir.html)或[这里](http://en.wikipedia.org/wiki/MIPS_architecture#Integer)

请参阅[此处](https://svn.openwrt.org/openwrt/trunk/package/uboot-ifxmips/patches/100-ifx.patch)以查看多瑙河和亚马逊是 MIPS32，我的示例涵盖了这些，因此并非所有 32 位整数立即数都可以原子地编写。

请参阅上面发布的[R10000](http://en.wikipedia.org/wiki/R10000)是 MIPS64。由于 32 位值将是寄存器大小的一半，因此它可能是原子加载/写入。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-26T22:37:19.167

哪些操作？这似乎`int a; a=42;`是原子的。不能保证它`a= a+42;`是原子的，或者像 with 一样的任何变体`++`。此外，您必须关心优化器可能会做什么，例如在方便时将中间值保存在寄存器中。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-26T23:51:51.687

这个问题会引起误导性的答案。

您只能权威地回答有关汇编/机器语言的“它是原子的”问题。

任何给定的 C/C++ 代码片段都不能保证，可能会根据您使用的编译器（和版本）而有所不同，等等。（除非您调用某些特定于平台的内在函数或保证编译为已知原子机器指令的东西。 )

# sql-server - 管理测试数据：您可以将所有数据库连接加入到单个事务中吗？

> ID：687825
> 
> 赞同：2
> 
> 时间：2009-03-26T22:37:09.793
> 
> 标签：sql-server, testing, watin

我们目前正在使用 Watin 对我们的 Web 应用程序进行 UI 测试。实际上，我们正在从上到下进行集成测试，因为我们使用的是测试数据库而不是模拟。

为了确保测试数据库处于预期状态，我们之前一直使用 SQL Server 的快照功能在每次测试开始时回滚数据库。这相当慢，并且还会在恢复快照后立即导致错误。

由于每个测试都调用 UI 并可能使用多个数据库连接，因此我们无法在每个连接上启动事务。

我想知道是否有可能以某种方式将所有数据库连接附加到单个事务并在以后回滚它们？这可能必须在数据库级别本身发生。

如果有人对如何为每个 UI 测试重置我们的测试数据有任何其他建议，我很想听听您的想法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T22:49:25.723

如果您*在 process*中启动 Visual Studio 开发 Web 服务器的一个实例，然后运行您的 WatiN 测试，那么您可以将测试包装在一个块中，如下所示：

```
using (new TransactionScope())
{
    var server = new Server(PORT_NUMBER, VIRTUAL_PATH, PHYSICAL_PATH);
    server.Start();
    try
    {
        using (var ie = new IE())
        {
            // TODO: perform necessary testing using ie object
        }
    }
    finally
    {
        server.Stop();
    }
} 
```

理论上，您的所有数据库连接都将加入单个分布式事务，并且在处置 TransactionScope 时，它​​们的更改将全部回滚。

要在进程中运行开发 Web 服务器，您需要从 GAC 中提取 WebDev.WebHost.dll 并在您的项目中引用它——这是上面代码片段中 Server 类的源代码。如果您需要更详细的说明，请告诉我。

您需要确保 MSDTC 正在运行，并且如果您和数据库之间有防火墙，那么您可能会遇到困难，具体取决于端口设置。在进程中启动服务器的另一个好处是，WatiN 测试现在可以有助于测量代码覆盖率。

# linq - 数组中周围数字的Linq表达式

> ID：687828
> 
> 赞同：2
> 
> 时间：2009-03-26T22:37:25.690
> 
> 标签：linq, linq-to-sql

我需要一个 linq 表达式，它将在给定数字的数组中找到最接近的数字（“大于或等于”和“小于或等于”）。

例如数组 - 1、33、66、100

如果我有数字 10，我想返回 1 和 33。如果我有数字 70，我想返回 66 和 100。如果我有数字 33，我想返回 33 和 66。

我可以使用某种基本的 for 循环来做到这一点，但这是对数据库中数字的操作，所以我更喜欢 linq 到 sql 表达式。

编辑：我实际上是在寻找一个*linq*表达式来实现这一点，但也许我有点希望:)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T23:16:05.363

类似于 Andrews 的回答，但我更喜欢在 OrderBy 之前进行过滤，这样可以减少查询必须运行的数据量。OrderBy.First 与 Min 相同，OrderByDescending.First 与 Max 相同。

```
var high = list
    .Where(i => i > n)
    .DefaultIfEmpty()
    .Min();

var low = list
    .Where(i => i <= n)
    .DefaultIfEmpty()
    .Max(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T22:57:22.740

```
var list = new[] { 1, 33, 66, 100 };

var n = 33;

var high = list
    .OrderBy(i=>i)
    .FirstOrDefault(i => i >= n);

var low = list
    .OrderByDescending(i => i)
    .FirstOrDefault(i => i <= n);

Console.WriteLine(low);
Console.WriteLine(high); 
```

结果为 1, 33

唯一的问题是，如果您为 n 指定 33，您将得到 33、33。这是正确的吗？两者可以是同一个数字吗？如果没有，您将不得不将您的选择限制为可能的“<=”，然后只是“>”。

您应该能够使解决方案适应 Linq to SQL。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T23:05:34.403

```
 ArrayList arrList = new ArrayList();
        int number = 10;

        arrList.Add(1);
        arrList.Add(10);
        arrList.Add(20);
        arrList.Add(-12);

        int numberBelow = (from int i in arrList
                           where i <= number
                           select i).Max();

        int numberAbove = (from int i in arrList
                           where i >= number
                           select i).Min(); 
```

下面的数字是小于您的搜索值的最大值，同样上面的数字是大于您的搜索值的最小值。唯一的问题是你想要大于或等于还是仅仅大于。

# django - Django - 覆盖 get_form 以根据请求自定义管理表单

> ID：687829
> 
> 赞同：15
> 
> 时间：2009-03-26T22:38:00.307
> 
> 标签：django, django-admin

我尝试了各种方法来实现这一点。

我决定不重写`formfield_for_dbfield`，因为它没有得到请求对象的副本，我希望避免被`thread_locals`黑客入侵。

`get_form`我决定在我的课堂上覆盖`ModelAdmin`并尝试以下方法：

```
class PageOptions(admin.ModelAdmin):
    def get_form(self, request, obj=None, **kwargs):
        if request.user.is_superuser:
            self.fieldsets = ((None, {'fields': ('title','name',),}),)
        else:
            self.fieldsets = ((None, {'fields': ('title',),}),)
        return super(PageOptions,self).get_form(request, obj=None, **kwargs) 
```

当我打印`fieldsets`或`declared_fieldsets`从内部`get_form`得到`None`（或我在 中设置为初始值的任何内容`PageOptions`）时。

为什么这不起作用，有没有更好的方法来做到这一点？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-31T21:51:59.563

我有一些来自我最近的项目的示例代码，我相信它们可能会对您有所帮助。在此示例中，超级用户可以编辑每个字段，而其他所有人都排除了“描述”字段。

请注意，我认为您应该`Form`从 中返回一个类`get_form`，这可能是您的类不能正常工作的原因。

这是示例：

```
class EventForm(forms.ModelForm):
    class Meta:
        model = models.Event
        exclude = ['description',]

class EventAdminForm(forms.ModelForm):
    class Meta:
        model = models.Event

class EventAdmin(admin.ModelAdmin):

    def get_form(self, request, obj=None, **kwargs):
        if request.user.is_superuser:
            return EventAdminForm
        else:
            return EventForm 

admin.site.register(models.Event, EventAdmin) 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-04T16:16:52.467

我不知道为什么打印该属性不会让您希望您刚刚分配（我想这可能取决于您打印的确切位置），但请尝试覆盖`get_fieldsets`。基本实现如下所示：

> ```
> def get_fieldsets(self, request, obj=None):
>     if self.declared_fieldsets:
>         return self.declared_fieldsets
>     form = self.get_formset(request).form
>     return [(None, {'fields': form.base_fields.keys()})] 
> ```

即你应该能够只返回你的元组。

由安迪巴克编辑。4 年过去了，当我尝试在另一个项目上做类似的事情时，我再次发现了自己的问题。这次我采用了这种方法，尽管稍作修改以避免重复字段集定义：

```
def get_fieldsets(self, request, obj=None):
    # Add 'item_type' on add forms and remove it on changeforms.
    fieldsets = super(ItemAdmin, self).get_fieldsets(request, obj)
    if not obj: # this is an add form
        if 'item_type' not in fieldsets[0][1]['fields']:
            fieldsets[0][1]['fields'] += ('item_type',)
    else: # this is a change form
        fieldsets[0][1]['fields'] = tuple(x for x in fieldsets[0][1]['fields'] if x!='item_type')
    return fieldsets 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-11-19T14:16:34.303

这是我的解决方案：

```
class MyModelAdmin(admin.ModelAdmin):  

    def get_form(self, request, obj=None, **kwargs):
        if request.user.is_superuser:
            self.exclude = ()
        else:
            self.exclude = ('field_to_exclude',) 
        return super(MyModelAdmin, self).get_form(request, obj=None, **kwargs) 
```

希望能有所帮助

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2011-05-29T08:11:35.660

为了创建自定义的管理表单，我们定义了一个可以用作 mixin 的新类。该方法非常灵活：

*   ModelAdmin：定义一个包含**所有**字段的字段集

*   ModelForm：缩小显示的字段

*   FlexibleModelAdmin：覆盖 ModelAdmin 的 get_fieldsets 方法；返回仅包含管理表单中定义的字段的缩减字段集

```
class FlexibleModelAdmin(object):
    '''
    adds the possibility to use a fieldset as template for the generated form
    this class should be used as mix-in
    '''

    def _filterFieldset(self, proposed, form):
        '''
        remove fields from a fieldset that do not
        occur in form itself.
        '''

        allnewfields = []
        fields = form.base_fields.keys()
        fieldset = []
        for fsname, fdict in proposed:
            newfields = []
            for field in fdict.get('fields'):
                if field in fields:
                    newfields.append(field)
                allnewfields.extend(newfields)
            if newfields:
                newentry = {'fields': newfields}
                fieldset.append([fsname,  newentry])

        # nice solution but sets are not ordered ;) 
        # don't forget fields that are in a form but were forgotten
        # in fieldset template
        lostfields = list(set(fields).difference(allnewfields))
        if len(lostfields):
            fieldset.append(['lost in space', {'fields': lostfields}])

        return fieldset

    def get_fieldsets(self, request, obj=None):
        '''
        Hook for specifying fieldsets for the add form.
        '''

        if hasattr(self, 'fieldsets_proposed'):
            form = self.get_form(request, obj)
            return self._filterFieldset(self.fieldsets_proposed, form)
        else:
            return super(FlexibleModelAdmin, self).get_fieldsets(request, obj) 
```

在管理模型中，您定义用作模板并包含所有字段的 fieldsets_proposed。

```
class ReservationAdmin(FlexibleModelAdmin, admin.ModelAdmin):

    list_display = ['id', 'displayFullName']
    list_display_links = ['id', 'displayFullName']
    date_hierarchy = 'reservation_start'
    ordering = ['-reservation_start', 'vehicle']
    exclude = ['last_modified_by']

    # considered by FlexibleModelAdmin as template
    fieldsets_proposed = (
        (_('General'), {
           'fields': ('vehicle', 'reservation_start', 'reservation_end', 'purpose') # 'added_by'
        }),
        (_('Report'), {
            'fields': ('mileage')
        }),
        (_('Status'), {
            'fields': ('active', 'editable')
        }),
        (_('Notes'), {
            'fields': ('note')
        }),
    )
    ....        

    def get_form(self, request, obj=None, **kwargs):
        '''
        set the form depending on the role of the user for the particular group
        '''

        if request.user.is_superuser:
            self.form = ReservationAdminForm
        else:
            self.form = ReservationUserForm

        return super(ReservationAdmin, self).get_form(request, obj, **kwargs)

admin.site.register(Reservation, ReservationAdmin) 
```

在您的模型表单中，您现在可以定义要排除/包含的字段。mixin 类的 get_fieldset() 确保只返回表单中定义的字段。

```
class ReservationAdminForm(ModelForm):
    class Meta:
        model = Reservation
        exclude = ('added_by', 'last_modified_by')

class ReservationUserForm(BaseReservationForm):
    class Meta:
        model = Reservation
        fields = ('vehicle', 'reservation_start', 'reservation_end', 'purpose', 'note') 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-10-27T08:54:39.670

不要更改 self 属性的值，因为它不是线程安全的。您需要使用任何挂钩来覆盖这些值。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2019-02-12T12:13:21.870

就我而言，使用 Django 2.1，您可以执行以下操作

在forms.py

```
class ObjectAddForm(forms.ModelForm):

    class Meta:
        model = Object
        exclude = []

class ObjectChangeForm(forms.ModelForm):
    class Meta:
        model = Object
        exclude = [] 
```

然后在 admin.py

```
from your.app import ObjectAddForm, ObjectChangeForm

class ObjectAdmin(admin.ModelAdmin):
    ....
    def get_form(self, request, obj=None, **kwargs):
        if obj is None: 
            kwargs['form'] = ObjectAddForm
        else:
            kwargs['form'] = ObjectChangeForm
        return super().get_form(request, obj, **kwargs) 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2020-12-01T13:20:54.967

您可以为此目的使用 get_fields 或 get_fieldset 方法

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-03-30T14:02:02.310

您可以制作`fieldsets`和`form`属性并让它们发出信号以获取所需的表单/字段集。

# ssis - 调度相同的 SSIS 包并行运行

> ID：687830
> 
> 赞同：0
> 
> 时间：2009-03-26T22:38:03.130
> 
> 标签：ssis, packages

我们有一个架构，我们打算使用 SSIS 作为传入批次的数据加载引擎。目的是减少对手动干预和配置的需求，并尽可能地自动化功能，因此我们正在考虑设置我们的“批量监控”包以按计划运行 SQL Server 代理作业。

是否可以使用同一个包安排多个 SQL Server 代理作业，可能查看不同的文件夹或处理不同的数据块（按批次 ID 分组？

我们可能还有 3 或 4 个“作业”，它们都运行同一个包，并且都监视同一个文件夹中的传入文件，但间隔略有不同，以避免文件争用问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T22:59:50.207

我不知道你有什么理由不能这样做。您可以使用指向不同工作目录、输入文件夹等的不同配置（或配置）启动每个包。

# java - 如何获取 ArrayList 的最后一个值

> ID：687833
> 
> 赞同：716
> 
> 时间：2009-03-26T22:38:57.667
> 
> 标签：java, arraylist

如何获取 ArrayList 的最后一个值？

我不知道 ArrayList 的最后一个索引。

* * *

## 回答 #1

> 赞同：807
> 
> 时间：2009-03-26T22:42:45.427

以下是[`List`](http://java.sun.com/javase/6/docs/api/java/util/List.html)接口的一部分（ArrayList 实现）：

```
E e = list.get(list.size() - 1); 
```

`E`是元素类型。如果列表为空，则`get`抛出[`IndexOutOfBoundsException`](http://java.sun.com/javase/6/docs/api/java/lang/IndexOutOfBoundsException.html). [您可以在此处](http://java.sun.com/javase/6/docs/api/)找到完整的 API 文档。

* * *

## 回答 #2

> 赞同：232
> 
> 时间：2012-12-28T16:16:04.163

香草 Java 中没有优雅的方式。

# 谷歌番石榴

[Google Guava](https://github.com/google/guava)库很棒——看看他们的[`Iterables`课程](http://google.github.io/guava/releases/snapshot/api/docs/com/google/common/collect/Iterables.html#getLast-java.lang.Iterable-)。如果列表为空，则此方法将抛出 a [`NoSuchElementException`](http://docs.oracle.com/javase/8/docs/api/java/util/NoSuchElementException.html?is-external=true)，而不是 a [`IndexOutOfBoundsException`](http://docs.oracle.com/javase/8/docs/api/java/lang/IndexOutOfBoundsException.html)，就像典型的`size()-1`方法一样-我发现`NoSuchElementException`更好的方法，或者指定默认值的能力：

```
lastElement = Iterables.getLast(iterableList); 
```

如果列表为空，您还可以提供默认值，而不是异常：

```
lastElement = Iterables.getLast(iterableList, null); 
```

或者，如果您使用的是选项：

```
lastElementRaw = Iterables.getLast(iterableList, null);
lastElement = (lastElementRaw == null) ? Option.none() : Option.some(lastElementRaw); 
```

* * *

## 回答 #3

> 赞同：195
> 
> 时间：2009-03-26T22:41:29.970

这应该这样做：

```
if (arrayList != null && !arrayList.isEmpty()) {
  T item = arrayList.get(arrayList.size()-1);
} 
```

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2014-10-10T14:49:26.253

我使用 micro-util 类来获取列表的最后一个（也是第一个）元素：

```
public final class Lists {

    private Lists() {
    }

    public static <T> T getFirst(List<T> list) {
        return list != null && !list.isEmpty() ? list.get(0) : null;
    }

    public static <T> T getLast(List<T> list) {
        return list != null && !list.isEmpty() ? list.get(list.size() - 1) : null;
    }
} 
```

* * *

稍微灵活一点：

```
import java.util.List;

/**
 * Convenience class that provides a clearer API for obtaining list elements.
 */
public final class Lists {

  private Lists() {
  }

  /**
   * Returns the first item in the given list, or null if not found.
   *
   * @param <T> The generic list type.
   * @param list The list that may have a first item.
   *
   * @return null if the list is null or there is no first item.
   */
  public static <T> T getFirst( final List<T> list ) {
    return getFirst( list, null );
  }

  /**
   * Returns the last item in the given list, or null if not found.
   *
   * @param <T> The generic list type.
   * @param list The list that may have a last item.
   *
   * @return null if the list is null or there is no last item.
   */
  public static <T> T getLast( final List<T> list ) {
    return getLast( list, null );
  }

  /**
   * Returns the first item in the given list, or t if not found.
   *
   * @param <T> The generic list type.
   * @param list The list that may have a first item.
   * @param t The default return value.
   *
   * @return null if the list is null or there is no first item.
   */
  public static <T> T getFirst( final List<T> list, final T t ) {
    return isEmpty( list ) ? t : list.get( 0 );
  }

  /**
   * Returns the last item in the given list, or t if not found.
   *
   * @param <T> The generic list type.
   * @param list The list that may have a last item.
   * @param t The default return value.
   *
   * @return null if the list is null or there is no last item.
   */
  public static <T> T getLast( final List<T> list, final T t ) {
    return isEmpty( list ) ? t : list.get( list.size() - 1 );
  }

  /**
   * Returns true if the given list is null or empty.
   *
   * @param <T> The generic list type.
   * @param list The list that has a last item.
   *
   * @return true The list is empty.
   */
  public static <T> boolean isEmpty( final List<T> list ) {
    return list == null || list.isEmpty();
  }
} 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2009-03-26T22:44:40.350

该`size()`方法返回 ArrayList 中的元素数。元素的索引值是`0`through `(size()-1)`，因此您将使用它`myArrayList.get(myArrayList.size()-1)`来检索最后一个元素。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2018-05-08T01:18:10.740

使用 lambda：

```
Function<ArrayList<T>, T> getLast = a -> a.get(a.size() - 1); 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2019-06-05T21:20:23.720

在 Java中没有*优雅*的方式来获取列表的最后一个元素（与`items[-1]`Python 相比）。

你必须使用`list.get(list.size()-1)`.

当处理通过复杂方法调用获得的列表时，解决方法在于临时变量：

```
List<E> list = someObject.someMethod(someArgument, anotherObject.anotherMethod());
return list.get(list.size()-1); 
```

这是避免丑陋且通常昂贵甚至无法正常工作的版本的唯一选择：

```
return someObject.someMethod(someArgument, anotherObject.anotherMethod()).get(
    someObject.someMethod(someArgument, anotherObject.anotherMethod()).size() - 1
); 
```

如果将此设计缺陷的修复引入 Java API，那就太好了。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2014-12-12T20:49:05.917

如果可以的话，把 换成`ArrayList`，`ArrayDeque`它有方便的方法，比如`removeLast`.

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2018-11-11T23:10:10.243

如果您改用 LinkedList ，则可以使用 and 访问第一个元素和最后一个元素`getFirst()`（`getLast()`如果您想要比 size() -1 和 get(0) 更简洁的方式）

## 执行

声明一个链表

```
LinkedList<Object> mLinkedList = new LinkedList<>(); 
```

然后这是您可以用来获得所需内容的方法，在这种情况下，我们正在讨论列表的**FIRST**和**LAST**元素

```
/**
     * Returns the first element in this list.
     *
     * @return the first element in this list
     * @throws NoSuchElementException if this list is empty
     */
    public E getFirst() {
        final Node<E> f = first;
        if (f == null)
            throw new NoSuchElementException();
        return f.item;
    }

    /**
     * Returns the last element in this list.
     *
     * @return the last element in this list
     * @throws NoSuchElementException if this list is empty
     */
    public E getLast() {
        final Node<E> l = last;
        if (l == null)
            throw new NoSuchElementException();
        return l.item;
    }

    /**
     * Removes and returns the first element from this list.
     *
     * @return the first element from this list
     * @throws NoSuchElementException if this list is empty
     */
    public E removeFirst() {
        final Node<E> f = first;
        if (f == null)
            throw new NoSuchElementException();
        return unlinkFirst(f);
    }

    /**
     * Removes and returns the last element from this list.
     *
     * @return the last element from this list
     * @throws NoSuchElementException if this list is empty
     */
    public E removeLast() {
        final Node<E> l = last;
        if (l == null)
            throw new NoSuchElementException();
        return unlinkLast(l);
    }

    /**
     * Inserts the specified element at the beginning of this list.
     *
     * @param e the element to add
     */
    public void addFirst(E e) {
        linkFirst(e);
    }

    /**
     * Appends the specified element to the end of this list.
     *
     * <p>This method is equivalent to {@link #add}.
     *
     * @param e the element to add
     */
    public void addLast(E e) {
        linkLast(e);
    } 
```

所以，那么你可以使用

```
mLinkedList.getLast(); 
```

获取列表的最后一个元素。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2019-04-09T13:07:23.613

如解决方案中所述，如果`List`为空，`IndexOutOfBoundsException`则抛出 an。更好的解决方案是使用以下`Optional`类型：

```
public class ListUtils {
    public static <T> Optional<T> last(List<T> list) {
        return list.isEmpty() ? Optional.empty() : Optional.of(list.get(list.size() - 1));
    }
} 
```

如您所料，列表的最后一个元素以`Optional`:

```
var list = List.of(10, 20, 30);
assert ListUtils.last(list).orElse(-1) == 30; 
```

它还可以优雅地处理空列表：

```
var emptyList = List.<Integer>of();
assert ListUtils.last(emptyList).orElse(-1) == -1; 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2021-01-02T07:58:03.947

考虑到空列表的一个班轮将是：

```
T lastItem = list.size() == 0 ? null : list.get(list.size() - 1); 
```

或者，如果您不喜欢 null 值（并且性能不是问题）：

```
Optional<T> lastItem = list.stream().reduce((first, second) -> second); 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2020-08-21T12:01:20.420

如果你有一个 Spring 项目，你也可以使用`CollectionUtils.lastElement`from Spring ( [javadoc](https://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/util/CollectionUtils.html#lastElement-java.util.List-) )，所以你不需要像 Google Guava 那样添加额外的依赖。

它是 null 安全的，因此如果您传递 null，您将简单地收到 null 作为回报。不过，在处理响应时要小心。

这里有一些单元测试来演示它们：

```
@Test
void lastElementOfList() {
    var names = List.of("John", "Jane");

    var lastName = CollectionUtils.lastElement(names);

    then(lastName)
        .as("Expected Jane to be the last name in the list")
        .isEqualTo("Jane");
}

@Test
void lastElementOfSet() {
    var names = new TreeSet<>(Set.of("Jane", "John", "James"));

    var lastName = CollectionUtils.lastElement(names);

    then(lastName)
        .as("Expected John to be the last name in the list")
        .isEqualTo("John");
} 
```

注意：`org.assertj.core.api.BDDAssertions#then(java.lang.String)`用于断言。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2020-01-13T09:09:32.897

由于 ArrayList 中的索引从 0 开始并在实际大小前一位结束，因此返回最后一个 arraylist 元素的正确语句将是：

**int last = mylist.get(mylist.size()-1);**

例如：

如果数组列表的大小为 5，则 size-1 = 4 将返回最后一个数组元素。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-04-09T19:42:09.930

[guava](https://github.com/google/guava)提供了另一种从 a 获取最后一个元素的方法`List`：

`last = Lists.reverse(list).get(0)`

如果提供的列表为空，则会抛出`IndexOutOfBoundsException`

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-12-13T07:24:29.530

这对我有用。

```
private ArrayList<String> meals;
public String take(){
  return meals.remove(meals.size()-1);
} 
```

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2015-11-25T11:28:17.423

列表中的最后一项是`list.size() - 1`。该集合由一个数组支持，数组从索引 0 开始。

所以列表中的元素 1 位于数组中的索引 0

列表中的元素 2 在数组中的索引 1 处

列表中的元素 3 在数组中的索引 2 处

等等..

* * *

## 回答 #17

> 赞同：-3
> 
> 时间：2010-10-28T12:43:11.017

如果您修改列表，则使用[`listIterator()`](http://docs.oracle.com/javase/7/docs/api/java/util/ArrayList.html#listIterator())并从最后一个索引进行迭代（即`size()-1`分别）。如果您再次失败，请检查您的列表结构。

* * *

## 回答 #18

> 赞同：-3
> 
> 时间：2014-12-12T23:48:33.433

这个怎么样..在你班上的某个地方......

```
List<E> list = new ArrayList<E>();
private int i = -1;
    public void addObjToList(E elt){
        i++;
        list.add(elt);
    }

    public E getObjFromList(){
        if(i == -1){ 
            //If list is empty handle the way you would like to... I am returning a null object
            return null; // or throw an exception
        }

        E object = list.get(i);
        list.remove(i); //Optional - makes list work like a stack
        i--;            //Optional - makes list work like a stack
        return object;
    } 
```

* * *

## 回答 #19

> 赞同：-4
> 
> 时间：2016-02-14T01:42:48.953

您需要做的就是使用 size() 来获取 Arraylist 的最后一个值。例如。如果你是整数的 ArrayList，那么要获得最后一个值，你将不得不

```
int lastValue = arrList.get(arrList.size()-1); 
```

请记住，可以使用索引值访问 Arraylist 中的元素。因此，ArrayLists 一般用于搜索项目。

* * *

## 回答 #20

> 赞同：-4
> 
> 时间：2017-04-05T02:57:34.013

数组将它们的大小存储在一个名为“length”的局部变量中。给定一个名为“a”的数组，您可以使用以下内容来引用最后一个索引而不知道索引值

a[a.length-1]

要将值 5 分配给最后一个索引，您将使用：

a[a.length-1]=5;

* * *

## 回答 #21

> 赞同：-4
> 
> 时间：2021-10-23T09:06:55.660

在 JavaScript 中获取 arraylist 的最后一个值：

```
var yourlist = ["1","2","3"];
var lastvalue = yourlist[yourlist.length -1]; 
```

它给出的输出为 3 。

* * *

## 回答 #22

> 赞同：-6
> 
> 时间：2018-12-04T16:51:06.887

使用 Stream API 的替代方法：

```
list.stream().reduce((first, second) -> second) 
```

结果是最后一个元素的 Optional。

* * *

## 回答 #23

> 赞同：-11
> 
> 时间：2019-09-08T02:41:30.110

在 Kotlin 中，您可以使用以下方法`last`：

```
val lastItem = list.last() 
```

# cocoa - 过滤/清理用户输入。最佳方法

> ID：687843
> 
> 赞同：2
> 
> 时间：2009-03-26T22:42:46.067
> 
> 标签：cocoa, xcode, user-input, sanitize

为了澄清，我想检查有效字符。对于名字，姓氏，我想检查 [A-Za-z]。对于电子邮件，我想检查对电子邮件有效的字符。

我将使用什么算法来检查用户输入？具体来说，我想在添加到数据库之前检查用户的名字、姓氏和电子邮件地址是否有有效字符。

显然，这样的事情是不够的：

```
 if ( [firstName.text isEqualToString:@""] || [lastName.text isEqualToString:@""] || [emailAddress.text isEqualToString:@""]) { ... } 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T23:42:36.530

为您的编辑而修改：

你可能想看的是 NSCharacterSet。它允许您定义明确的字符集，然后您可以使用这些字符集来测试字符串是否存在这些字符。一个简单的例子：

```
NSCharacterSet* nonAlphaNumericSet = [[NSCharacterSet alphanumericCharacterSet] invertedSet];
if ([someString rangeOfCharacterFromSet:nonAlphaNumericSet].location != NSNotFound)
{
    NSLog(@"It's not alphanumeric!");
} 
```

# css - z-index 是强制一个元素位于另一个元素之上的唯一方法，如果不是还有其他方法吗？

> ID：687849
> 
> 赞同：5
> 
> 时间：2009-03-26T22:46:41.267
> 
> 标签：css, z-index

我正在开发一个带有地图的应用程序，角落里有一个 div，里面有一些东西。您可以单击此地图以在一个小窗口中显示一些信息。在某些情况下，窗口被角落的 div 覆盖。

我想要相反的效果（窗口覆盖 div）。我认为这只是一个 z-index 问题，但我无法让它工作。这是 IE7 的情况，从阅读的角度来看，z-index 似乎不起作用，除非它位于定位的元素内部。

这些元素似乎定位正确以使 z-index 正常工作，但我运气不佳。我已经尝试通过 Firebug 添加样式，但没有任何运气可以改变任何东西。窗口实际上只是两个 div，一个是绝对定位的，一个是相对的。

z-index 是唯一可能是这里的问题还是我不​​知道的其他东西？

有没有其他方法可以达到我想要的效果？我不能简单地通过 jquery 或其他方式隐藏 div，因为它的一部分应该从地图上打开的窗口后面可见。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-26T22:51:50.037

您遇到了堆叠上下文错误

[http://therealcrisp.xs4all.nl/meuk/IE-zindexbug.html](http://therealcrisp.xs4all.nl/meuk/IE-zindexbug.html)

IE 中每个定位的 div 都会创建一个新的堆叠上下文，并防止 z-index 不同的堆叠上下文出现在其他堆叠上下文之上。

解决方案是让您想要的窗口在树的顶部（例如进入正文），并且 z-index 值大于覆盖窗口的其他 div 的所有父级的 z-index。

在这里了解问题的广泛信息： [http ://richa.avasthi.name/blogs/tepumpkin/2008/01/11/ie7-lessons-learned/](http://richa.avasthi.name/blogs/tepumpkin/2008/01/11/ie7-lessons-learned/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T22:52:59.753

定位和负边距是我所知道的让元素重叠的唯一方法。z-index 仅用于明确告诉浏览器如何对元素进行分层。

至于您的问题，IE 需要容器元素和/或您重叠的元素`position:relative;`或`position:absolute;`z-index 才能正常工作。当有人说定位时，他们通常暗示`position`在 CSS 中设置属性。此外，在使用 z-index 时，请确保重叠的 elementa 彼此处于同一级别。

希望这可以帮助

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T00:11:25.633

很简单，HTML 文件中元素的顺序将决定堆叠顺序。如果您希望一个元素高于另一个元素，请确保它在 HTML 中稍后出现。

您只能交换所有在同一包含元素中的元素的堆叠顺序。例如，如果您有两个 div 并且它们都包含 3 个图像，则您不能使第二个 div 中的图像低于第一个 div 中的图像。

如果您需要复杂的堆叠顺序，则需要提前计划您的 HTML。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T22:57:45.467

正如其他答案所暗示的那样，`position:relative`并`position:absolute`在 IE 中重置“堆叠上下文”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T23:06:48.473

如果您想要一个更懒惰的答案，您可以使用 javascript 并在单击地图时隐藏 div，并在关闭地图时显示它。

无论如何，您都必须对页面上的任何选择执行此操作，因为它们不适用于 z-index。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-26T23:25:36.073

几天前我遇到了同样的问题，发现 Darko Z 建议的负边距效果很好。（我的代表还不够好，无法投票给达科）

我写了一篇关于它的快速帖子。

[http://www.swards.net/2009/03/layering-html-elements-without-using.html](http://www.swards.net/2009/03/layering-html-elements-without-using.html)

# linq-to-sql - 在 ADO.Net 数据服务中使用 Guid

> ID：687850
> 
> 赞同：1
> 
> 时间：2009-03-26T22:46:41.767
> 
> 标签：linq-to-sql, guid, wcf-data-services

我正在把头发拉出来。我正在尝试实现使用 Linq to SQL 数据上下文的 ADO.Net 数据服务。我以为我可以正常工作，但我的一张表的 URL 总是出现异常。

不工作的表和正常工作的表之间的明显区别在于，获得异常的表使用的是主键 Guid。Guid 是一个 UserID，它实际上与 ASP.net Membership 使用的 UserId 相关。（我没有公开 ASP.net 成员表，但我猜如果我公开这些表也会中断。）

这是一个非常简单的表：名称：UserDetails :: | 指导用户 ID | int GroupID (外键) | 字符串名称 |

有人知道让Guids工作是否有技巧吗？或者，如果这可能是一个完全不同的问题？

以下是服务的异常：处理此请求时发生错误。

InnerError：处理此请求时发生错误。

类型：System.InvalidOperationException

StackTrace： t System.Data.Services.Serializers.SyndicationSerializer.WriteObjectProperties（IExpandedResult 扩展，对象 customObject，ResourceType在 System.Data.Services.Serializers.SyndicationSerializer.WriteComplexObjectValue(Object element, String propertyName, ResourceType expectedType, String relativeUri, DictionaryContent content) 在 System.Data.Services.Serializers 的 resourceType、Uri absoluteUri、String relativeUri、SyndicationItem 项、DictionaryContent 内容） .SyndicationSerializer.WriteObjectProperties(IExpandedResult 扩展，对象 customObject，ResourceType resourceType，Uri absoluteUri，字符串 relativeUri，SyndicationItem 项，DictionaryContent 内容）在 System.Data.Services.Serializers.SyndicationSerializer.WriteObjectProperties（IExpandedResult 扩展，对象 customObject、ResourceType resourceType、Uri absoluteUri、String relativeUri、SyndicationItem 项、DictionaryContent 内容）在 System.Data.Services.Serializers.SyndicationSerializer.WriteEntryElement（IExpandedResult 扩展，对象元素，类型 expectedType，Uri absoluteUri，字符串 relativeUri，SyndicationItem 目标）在System.Data.Services.Serializers.SyndicationSerializer.<DeferredFeedItems>d__0.MoveNext() 在 System.ServiceModel.Syndication.Atom10FeedFormatter。在 System.ServiceModel.Syndication.Atom10FeedFormatter.WriteFeed(XmlWriter writer) 在 System.ServiceModel.Syndication.Atom10FeedFormatter.WriteFeedTo(XmlWriter writer, SyndicationFeed feed, Boolean isSourceFeed) 上的 WriteItems(XmlWriter writer, IEnumerable`1 items, Uri feedBaseUri)。 System.Data.Services.Serializers.SyndicationSerializer.WriteTopLevelElements（IExpandedResult 扩展，IEnumerator 元素，布尔 hasMoved）在 System.Data.Services.Serializers.Serializer.WriteRequest（IEnumerator queryResults，Boolean）的 ServiceModel.Syndication.Atom10FeedFormatter.WriteTo（XmlWriter writer） hasMoved) 在 System.Data.Services.ResponseBodyWriter.Write(Stream 流)SyndicationFeed 提要，布尔 isSourceFeed) 在 System.ServiceModel.Syndication.Atom10FeedFormatter.WriteFeed(XmlWriter writer) 在 System.ServiceModel.Syndication.Atom10FeedFormatter.WriteTo(XmlWriter writer) 在 System.Data.Services.Serializers.SyndicationSerializer.WriteTopLevelElements(IExpandedResult 扩展， IEnumerator 元素，Boolean hasMoved) 在 System.Data.Services.Serializers.Serializer.WriteRequest(IEnumerator queryResults, Boolean hasMoved) 在 System.Data.Services.ResponseBodyWriter.Write(Stream 流)SyndicationFeed 提要，布尔 isSourceFeed) 在 System.ServiceModel.Syndication.Atom10FeedFormatter.WriteFeed(XmlWriter writer) 在 System.ServiceModel.Syndication.Atom10FeedFormatter.WriteTo(XmlWriter writer) 在 System.Data.Services.Serializers.SyndicationSerializer.WriteTopLevelElements(IExpandedResult 扩展， IEnumerator 元素，Boolean hasMoved) 在 System.Data.Services.Serializers.Serializer.WriteRequest(IEnumerator queryResults, Boolean hasMoved) 在 System.Data.Services.ResponseBodyWriter.Write(Stream 流)IEnumerator 元素，Boolean hasMoved) 在 System.Data.Services.Serializers.Serializer.WriteRequest(IEnumerator queryResults, Boolean hasMoved) 在 System.Data.Services.ResponseBodyWriter.Write(Stream 流)IEnumerator 元素，Boolean hasMoved) 在 System.Data.Services.Serializers.Serializer.WriteRequest(IEnumerator queryResults, Boolean hasMoved) 在 System.Data.Services.ResponseBodyWriter.Write(Stream 流)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T22:50:43.427

这看起来像一个错误。我建议您在[http://connect.microsoft.com/visualstudio/](http://connect.microsoft.com/visualstudio/)上报告它，然后在此处发布您的错误报告的 URL，以便我们对其进行投票。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T15:55:14.307

我找到了解决问题的方法。它实际上根本与使用 Guid 值无关。

我必须在 Linq to SQL 的 UserDetail 类中添加一个 [IgnoreProperties("User")]。

“User”属性是与“User”类的关系，该类包含 ASP.Net Memberships 用户信息（实际表名是 aspnet_Users）。我的 Linq to SQL“用户”类被数据服务忽略了，所以我认为这一定是问题所在。

让我失望的是，当我访问数据服务时，它没有抛出任何错误。对于所有其他属性，我必须添加 DataServiceKey() 或 IgnoreProperties() 装饰，当我访问 DataService.svc 时，我会收到一个抱怨问题属性的异常。不管出于何种原因，它并没有给我这个属性带来问题，所以我不知道有什么问题。正如您在上面看到的，当我确实遇到异常时，它没有用。

因此，对于将 Linq To SQL 与 ADO.Net 数据服务一起使用的任何其他人，这就是教训：确保在引用您忽略的类的任何属性上使用 IgnoreProperties()。

# c# - Web 服务调用时发生零星的名称解析失败

> ID：687857
> 
> 赞同：1
> 
> 时间：2009-03-26T22:50:21.570
> 
> 标签：c#, web-services, soap, networking, dns

我们的一个 wcf 服务应用程序调用单独的第三方 Web 服务来提交信息。

我们经常收到以下错误，但并非总是如此：
System.Net.WebException：无法解析远程名称：System.Net.HttpWebRequest.GetRequestStream() 处的“ws.examplesite.net”。 Web.Services.Protocols.SoapHttpClientProtocol.Invoke(String methodName, Object[] 参数)

奇怪的是，错误发生后，我们可以在一秒钟后再次点击“提交”，它会顺利通过。

我们已经与我们的网络人员进行了反复检查，他们已经确认 DNS 是正确的，并且他们已经连续进行了多次 nslookup 来确认。

这发生在所有环境（开发、测试和生产）中。我们使用第三方测试和产品 url，当我们指向两者时就会发生这种情况。

有没有人为此或任何原因有任何其他故障排除技术？

非常感谢，~安斯利

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-30T08:14:02.767

如果“网络人”使用 nslookup 进行调试，则可能意味着他们不是 DNS 专家。最好的办法是发布实际域名，以便我们可以使用更好的工具（dig、zonecheck 等）进行测试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T02:45:33.627

名称解析失败的原因可能与 DNS 没有直接关系。例如，我今天遇到了名称解析失败，原因是 DNS 查询是在我丢失了 DHCP 租约之后并且在我获得新租约之前发出的。实际上，在查询时没有与 DNS 服务器的连接。

类似的事情（连接问题）可能是你的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T22:56:28.827

我要做的第一件事是使用[WireShark](http://www.wireshark.org/)或其他一些数据包跟踪器，并仔细检查 Web 服务请求失败时发送的内容。这将立即告诉您 DNS 请求是否失败或是否正在发送 Web 服务请求，这是报告错误消息的情况。我怀疑是前者。

# python - 如何从单条路径获取上层路径？

> ID：687863
> 
> 赞同：1
> 
> 时间：2009-03-26T22:52:38.773
> 
> 标签：python, directory

如何从单条路径获取上层路径？

所以说你有这样的路径：

```
'C:\a\b\c\d\' 
```

我如何到达`'C:\a\b'`或`'C:\a\b\c'`

有没有一种pythonic方法可以做到这一点？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-26T22:56:15.050

看[`os.path`](http://docs.python.org/library/os.path.html)

```
from os import path
path.dirname("C:\\a\\b\\c\\d\\") 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-26T22:56:45.813

有基本的东西，比如[os.path](http://docs.python.org/library/os.path.html)方法。

如果您想要目录树中每个连续父级的完整路径名列表，请使用单行：

```
from os.path import dirname

def f1(n): return [n] if n == dirname(n) else [n] + f1(dirname(n))

print f1("/a/b/c/d/e/f/g") 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T23:03:06.063

`os.path.split("C:\\a\\b\\c")`将返回一个元组：

```
('C:\a\b', 'c') 
```

您可以继续在元组的第一个元素上调用 split。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-26T23:04:59.180

```
>>> def go_up(path, n):
...     return os.path.abspath(os.path.join(*([path] + ['..']*n)))
>>> path = 'C:\\a\\b\\c\\d\\'
>>> go_up(path, 2)
'C:\\a\\b'
>>> go_up(path, 1)
'C:\\a\\b\\c'
>>> go_up(path, 0)
'C:\\a\\b\\c\\d' 
```

不是[os.path](http://docs.python.org/library/os.path.html)的普通用户，我不知道这是否是一个合适的/pythonic 解决方案。我将它与一个替代函数进行了比较，定义如下：

```
def go_up_2(path, n):
    for i in xrange(n):
        path = os.path.split(path)[0]
    return path 
```

首先要注意的是`go_up_2('C:\\a\\b\\', 1) != go_up_2('c:\\a\\b', 1)`，它在哪里与原作有关`go_up`。但是，如果这是一个问题，性能明显更好（可能不是，但我正在寻找一些明确的方式来说明我自己的算法更好）：

```
import timeit

g1 = """import os.path
import ntpath
os.path = ntpath
def go_up(path, n):
    return os.path.abspath(os.path.join(*([path] + ['..']*n)))"""

g2 = """import os.path
import ntpath
os.path = ntpath
def go_up(path, n):
    for i in xrange(n-1):
        path = os.path.split(path)[0]
    return path"""

t1 = timeit.Timer("go_up('C:\\a\\b\\c\\d', 3)", setup=g1).timeit()
t2 = timeit.Timer("go_up('C:\\a\\b\\c\\d', 3)", setup=g2).timeit()

print t1
print t2 
```

这输出（在我的机器上）：

```
133.364659071
30.101334095 
```

不是很有用的信息，但我在玩，并认为无论如何都应该在这里发布。

# oracle - 我想在 oracle 中生成将逗号分隔的条目转换为列的视图

> ID：687866
> 
> 赞同：1
> 
> 时间：2009-03-26T22:53:49.020
> 
> 标签：oracle, view, csv

我想生成视图

```
CUSTOMER, CUSTOMER_ID, PRODUCTS
ABC INC   1            A=XYX, B=ZZZ
DEF CO    2            A=XYX, B=ZZZ, C=WWW
GHI LLC   3            B=ZYX 
```

希望视图类似于

```
CUSTOMER, CUSTOMER_ID, A    B    C
ABC INC   1            XYX  ZZZ
DEF CO    2            XYX  ZZZ  WWW
GHI LLC   3                 ZYX 
```

我想知道在 oracle 中是否有办法做到这一点是快速有效的方式。我知道它可以用 PLSQL 或一些逻辑来完成。这里关注的主要是性能，因为我需要每 10 分钟从具有大量数据的表中提取数据，并且不希望视图查询占用更多数据。

有什么想法或建议吗？

谢谢，

谭

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T23:32:36.507

总是只有A，B和C吗？如果是这样，请使用 substr 和 instr

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T00:03:31.973

正如 Matthew 所说，隔离这些值实际上只是字符串函数的简单问题，但如果您希望能够使用 B=XYZ 等谓词查询视图，那么您将不得不考虑添加基于函数的索引在基础表上。

# c# - .NET 中是否可以进行被动日志记录？

> ID：687867
> 
> 赞同：8
> 
> 时间：2009-03-26T22:54:01.233
> 
> 标签：c#, .net, asp.net, vb.net, .net-3.5

我经常对代码中必须包含的大量日志记录感到沮丧，这让我想知道是否有更好的做事方式。

我不知道这是否已经完成，或者是否有人想出了一个更好的主意，但我想知道是否有任何人知道将记录器“注入”到应用程序中，以便它被动地监视线程并安静地记录过程发生时无需执行以下操作：

```
public void MyProcess(int a, string b, object c)
{
  log(
    String.Format(
      "Entering process MyProcess with arguments: [a] = [{0}]; [b] = [{1}]; [c] = [{2}]",
      a.ToString(),
      b,
      c.ToString()
  );

  try
  {
    int d = DoStuff(a)
    log(
      String.Format(
        "DoStuff({0}) returned value {1}",
        a.ToString(),
        d.ToString()
      )
    );
  }
  catch (Exception ex)
  {
    log(
      String.Format("An exception occurred during process DoStuff({0})\nException:\n{1}",
      a.ToString(),
      ex.ToString())
    )
  }
} 
```

如果我可以对我的记录器说：

```
Monitor(MyClass.MyMethod) 
```

然后它将监视该方法内部发生的所有事情，包括传入的参数以及传递给这些方法的方法调用和值、发生的异常等。

过去有没有人实施过这样的事情？它甚至*可以*实施吗？以这种方式登录只是一个白日梦吗？

我很想设计一些可以做到这一点的东西，但我什至不知道从哪里开始。当然，我也不想重新发明轮子，如果已经完成了，如果有人能指出我正确的方向，那就太好了。

任何建议将不胜感激...

**编辑：**我想我会评论一个询问日志中所需详细程度的答案。经常需要提供可配置的日志记录级别，这样如果配置指定了详细的日志记录，那么所有内容都会被记录，而如果配置了关键日志记录，那么只会记录某些信息以及异常。如果配置了致命日志记录，则只会记录导致应用程序死亡的信息。像这样的东西是可配置的，还是 AOP 需要 3 或 4 个不同的构建，具体取决于日志记录级别的数量？

我经常使用 4 个级别：致命、关键、信息、详细

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-26T22:56:01.510

您可以使用[PostSharp](http://postsharp.org)来“围绕”该方法进行记录。这正是 AOP 擅长的事情。您可能想从[Log4PostSharp](http://code.google.com/p/postsharp-user-plugins/wiki/Log4PostSharp)开始- 一个专门用于日志记录的插件。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-26T22:56:07.000

这是面向方面编程的经典示例。请参阅 PostSharp 以获得非常好的基于 CLR 的库。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-26T23:23:45.873

这是 AoP 的教科书之一（不确定哪本教科书中有 AoP，但你明白了）AoP 的示例 - 记录：你想在方法之前和之后粘贴一些东西。

您可能想探索 AoP 路线，[PostSharp](http://www.postsharp.org/)是最受欢迎的路线之一，还有 Microsoft Unity（也是 IoC）、Castle。

AoP 的一个简单示例是在方法之前和之后添加代码，而不是在实际方法中添加方法调用。当您使用 C# 标记问题时，您可能只想考虑制作一个扩展方法来记录它，这已经在[这个问题](https://stackoverflow.com/questions/271398/post-your-extension-goodies-for-c-net-codeplexcomextensionoverflow)中。

我会采取一种实用的方法：你在做多少实际的日志记录？你能不能只用一个扩展方法而不是让阅读你代码的人眼花缭乱。[.NET 框架中内置](https://stackoverflow.com/questions/147557/error-logging-in-c/148117#148117)的日志记录已经很不错了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T23:26:29.877

除了 Jon 提到的日志记录方法之外，它可能还值得注意 VS 中用于跟踪程序流的另一个有用功能，那就是具有不间断断点的能力，该断点将在命中时简单地输出消息或运行宏（注意您也可以打印变量值）

右键单击断点并选择 When Hit... 上下文菜单项。

当然，另一个非常有用的特性是 System.Diagnostics 中的 Trace 对象和 Trace Listners。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-21T19:44:41.150

我最近编写了一个日志库，它使用 IDisposable 接口来包装带有日志上下文的区域。基本上，您可以像这样使用 LogSite 一次性对象：

```
using(var logger = new LogSite("methodName", new object[] { p1, p2, p3 })
{
    // code that does stuff goes here
} 
```

LogSite 对象为构造函数提供了一堆方便的重载，例如 MethodBase，因此您可以使用 MethodBase.GetCurrentMethod() 并使用反射来获取方法和参数的实际名称（而不是硬编码的字符串）。

它的工作方式是这样的——在构造函数中，它将所有跟踪信息写入日志，以表明它进入了块。在 Dispose 方法中，它写入一个退出条目。

在处理时，它还会检查 Marshal.GetExceptionCode() 的非零值，以查看 using 中的代码是否抛出异常或正常退出。它不会给您异常，因此必须在 catch 处理程序中显式记录，但它确实指示该区域的“通过/失败”。这允许您的日志记录范围比方法更具体，因为您可以在一个方法中拥有很多这样的块，并且知道哪个块准确地引发了异常。

此外，由于现在有一个“记录器”对象可用，您的 catch 处理程序看起来像：

```
try { ... } 
catch (Exception ex)
{ 
    logger.LogException(ex);
} 
```

记录器已经知道方法名称、参数信息和所有这些，并且具有用于格式化异常信息的内部方法。

进入这个高级对象下面的架构，有一个“LogDisposition”的概念，它处理我们之前确定的“通过/失败”，还有一个“LogEntryType”的概念，它是一个过滤器（用 Flags 枚举实现），它表示正在传递什么样的日志条目（错误、跟踪等）。

实际进行日志记录的只是发布者/侦听器模式。发布者获取传入的日志条目，就像多播委托一样，保留 LogListener 实例的注册表（应在程序开始时设置，或根据需要动态添加），并将日志条目传递给这些实例.

LogListeners 依次过滤掉他们关心的日志条目类型。因此，如果您不希望非错误条件的方法入口和出口点，它们不必显示在日志中。这可以在运行时进行控制，以允许用户随意打开和关闭详细日志记录。由于发布者可以写入各种日志侦听器，因此您可以连接写入文件、写入数据库或在 GUI 中显示错误通知等的内容。

这是一个相当不错的系统，并且需要相对较少的编码来获得相对丰富的日志记录。

如果您愿意，我可以给您一个代码示例...您可以通过我的（几乎完全不活跃的）博客与我联系（请参阅我的帐户资料）。

希望有帮助。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-28T04:22:56.673

我在所有项目中都使用开源[Apache log4net](http://logging.apache.org/log4net/index.html)。这是一个非常简单的实现，带有各种扩展，允许您登录到数据库、zip 文件、滚动日志文件、RRS 提要、telnet 客户端等。日志记录基本上很简单：

```
'Will print stack trace after message'
log.err(ex.message,ex)

log.warn("warn")
log.info("info")
log.debug("debug") 
```

输出格式和要输出的日志级别等日志记录参数都是在您的应用程序运行时实时读取的。

# c# - 在同一台计算机上的两个程序之间发送和接收 UDP 数据包

> ID：687868
> 
> 赞同：38
> 
> 时间：2009-03-26T22:55:07.737
> 
> 标签：c#, udp, localhost, port

是否可以通过 localhost/127 让两个单独的程序在同一台计算机上通过 UDP 进行通信（仅单向）...通过共享相同的端口#？

我们正在开展一个学生项目，在该项目中，我们需要在两台计算机之间发送包含一些遥测数据的 UDP 数据包。生成这些数据包的程序是专有的，但我正在使用 C# 自己使用*System.Net.Sockets.UdpClient*和*System.Net.IPEndPoint*编写接收器程序。

当我们连接多台计算机时，这在我们小组会议期间工作得很好，我们可以在这些计算机上分别运行这两个程序。但是当我在家并尝试扩展遥测处理程序时，它并不是很有用，因为我只有一台计算机（我需要一个供稿来测试处理程序）。我也无法在学校的任何计算机上安装该程序。

当我尝试同时在我的计算机上运行这两个程序时（最后启动我的程序），我收到一个 SocketException，说*通常*只允许使用每个端口一次。这使我相信必须有某种方法来共享端口（尽管在任何时候只有一个程序可以使用计算机上的端口是有道理的，但我同时运行多个互联网浏览器没有问题（而且我假设他们将端口 80 用于 http))。

重新编辑编辑：

sipwiz 是对的，感谢 Kalmi 提供指向 UdpClient.Client.Bind() 的指针。不过，当时，我们正在考虑使用另一个程序来生成类似的数据包，并且我们可以使用我的第一个（虽然幼稚）方法与 ctor 中的 UDP 客户端绑定在同一台计算机上共享端口。很抱歉不得不取消标记您的答案，sysrqb。

* * *

## 回答 #1

> 赞同：80
> 
> 时间：2009-03-26T23:08:04.007

您可以使用 ReuseAddress 套接字选项多次绑定到一个端口。

```
UdpClient udpClient = new UdpClient();
udpClient.Client.SetSocketOption(SocketOptionLevel.Socket, SocketOptionName.ReuseAddress, true); 
```

您还需要在 UDP 服务器套接字上设置相同的选项。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-03-27T21:52:59.640

我没想到这是可能的，但是.. 好吧.. **sipwiz**是对的。

它可以很容易地完成。**（请投票给 sipwiz 的答案！）**

```
IPEndPoint localpt = new IPEndPoint(IPAddress.Any, 6000);

//Failed try
    try
    {
        var u = new UdpClient(5000);
        u.Client.SetSocketOption(SocketOptionLevel.Socket, SocketOptionName.ReuseAddress, true);

        UdpClient u2 = new UdpClient(5000);//KABOOM
        u2.Client.SetSocketOption(SocketOptionLevel.Socket, SocketOptionName.ReuseAddress, true);
    }
    catch (Exception)
    {
        Console.WriteLine("ERROR! You must call Bind only after setting SocketOptionName.ReuseAddress. \n And you must not pass any parameter to UdpClient's constructor or it will call Bind.");
    }

//This is how you do it (kudos to sipwiz)
    UdpClient udpServer = new UdpClient(localpt); //This is what the proprietary(see question) sender would do (nothing special) 

    //!!! The following 3 lines is what the poster needs...(and the definition of localpt (of course))
    UdpClient udpServer2 = new UdpClient();
    udpServer2.Client.SetSocketOption(SocketOptionLevel.Socket, SocketOptionName.ReuseAddress, true);
    udpServer2.Client.Bind(localpt); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2014-10-29T16:49:49.887

以下是 Tarnay Kálmán 和 sipwiz 回答的完整代码：

服务器代码：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Net;
using System.Net.Sockets;
using System.Text;
using System.Threading.Tasks;

namespace UdpBroadcastTest
{
    class Program
    {
        static void Main(string[] args)
        {

            Console.WriteLine("Sender");
            // This constructor arbitrarily assigns the local port number.

            UdpClient udpClient = new UdpClient();
            udpClient.Client.SetSocketOption(SocketOptionLevel.Socket, SocketOptionName.ReuseAddress, true);
            udpClient.Connect("localhost", 11000);
            try
            {
                string message = String.Empty;
                do
                {
                    message = Console.ReadLine();
                    // Sends a message to the host to which you have connected.
                    Byte[] sendBytes = Encoding.ASCII.GetBytes(message);

                    udpClient.Send(sendBytes, sendBytes.Length);
                } while (message != String.Empty);

                udpClient.Close();
            }
            catch (Exception e)
            {
                Console.WriteLine(e.ToString());
            }

            Console.WriteLine("Press Any Key to Continue");
            Console.ReadKey();
        }
    }
} 
```

客户端代码：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Net;
using System.Net.Sockets;
using System.Text;
using System.Threading.Tasks;

namespace UdpReciever
{
    class Program
    {
        static void Main(string[] args)
        {
            Console.WriteLine("Receiver");
            // This constructor arbitrarily assigns the local port number.
            UdpClient udpClient = new UdpClient();
            udpClient.Client.SetSocketOption(SocketOptionLevel.Socket, SocketOptionName.ReuseAddress, true);
            udpClient.Client.Bind(new IPEndPoint(IPAddress.Any, 11000));
            try
            {
                //IPEndPoint object will allow us to read datagrams sent from any source.
                IPEndPoint RemoteIpEndPoint = new IPEndPoint(IPAddress.Any, 0);

                string message = String.Empty;
                do
                {

                    // Blocks until a message returns on this socket from a remote host.
                    Byte[] receiveBytes = udpClient.Receive(ref RemoteIpEndPoint);
                    message = Encoding.ASCII.GetString(receiveBytes);

                    // Uses the IPEndPoint object to determine which of these two hosts responded.
                    Console.WriteLine("This is the message you received: " +
                                                 message);
                    //Console.WriteLine("This message was sent from " +
                    //                            RemoteIpEndPoint.Address.ToString() +
                    //                            " on their port number " +
                    //                            RemoteIpEndPoint.Port.ToString());
                }
                while (message != "exit");
                udpClient.Close();
                //udpClientB.Close();

            }
            catch (Exception e)
            {
                Console.WriteLine(e.ToString());
            }

            Console.WriteLine("Press Any Key to Continue");
            Console.ReadKey();
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-26T23:11:48.867

您也许可以在您的网卡上放置多个 IP 地址，或者环回，并将服务器和客户端绑定到不同的 IP 地址？

否则虚拟机方法肯定会奏效。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-26T22:58:53.517

一次只能有一个程序*绑定*到一个端口。多个程序可以*连接*到另一个系统上的一个端口，但是您的不同 Web 浏览器绑定到的本地端口是随机分配的。

除非您想做一些丑陋的进程间通信或数据包嗅探，否则无法将多个程序绑定到一个端口。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-02-02T22:30:04.853

即使更改您的代码以便我可以传递一个 IP 地址，我也会收到相同的错误消息，您似乎无法绑定到同一个端口，并且这里只能使用一个端口是我使用您的示例并更改它的示例代码从我的本地机器捕获我的 ip.. IPAddress ipAddress = Dns.Resolve(Dns.GetHostName()).AddressList[0]; IPEndPoint ipLocalEndPoint = new IPEndPoint(ipAddress, 11000);

```
 //IPEndPoint localpt = new IPEndPoint(ipLocalEndPoint);

        UdpClient udpServer = new UdpClient(ipLocalEndPoint);
        udpServer.Client.SetSocketOption(
            SocketOptionLevel.Socket, SocketOptionName.ReuseAddress, true);
        udpServer.Connect(ipLocalEndPoint);
        UdpClient udpServer2 = new UdpClient();
        udpServer2.Client.SetSocketOption(
            SocketOptionLevel.Socket, SocketOptionName.ReuseAddress, true);

        udpServer2.Client.Bind(ipLocalEndPoint); // <<---------- Exception here 
```

这将在 Bind () 方法上产生异常。抱歉。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-27T00:24:21.487

我的建议：不要将端口号传递给 UdpClient 构造函数。从[文档](http://msdn.microsoft.com/en-us/library/system.net.sockets.udpclient.udpclient.aspx)来看，（有点稀疏，我知道......）看起来如果你这样做，UdpClient 将尝试*绑定*到该端口（正如 sysrqb 提到的那样，这是不允许的）。（如果你不这样做，我相信 UdpClient 会在随机端口上监听任何回复。你也可以选择一个你知道未使用的端口。）

当您调用 Connect() 时，您需要传入服务器正在*侦听*的端口号。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-08-02T09:40:53.823

将两个程序（即发送方和接收方）绑定到 localhost.dat 上的同一端口，这是简单的答案。

# oracle - PL/SQL 触发器 - 动态引用 :NEW 或 :OLD

> ID：687882
> 
> 赞同：1
> 
> 时间：2009-03-26T23:00:29.440
> 
> 标签：oracle, plsql, triggers

是否可以动态引用 :NEW/OLD 伪记录或复制它们？

我正在为一个非常宽的表做一个审计触发器，所以想避免为插入/删除/更新设置单独的触发器。

更新/插入时，我想在审计表中记录 :NEW 值，删除时我想记录 :OLD 值。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-10-30T16:16:54.273

`audit_tgr` 在“table_name”上插入、更新或删除之前创建或替换触发器

```
for each row
 begin
  if (inserting or updating) then
   insert into audit table (a,b,c) values(:new.a,:new.b,:new.c);
  else
   insert into audit table (a,b,c) values(:old.a,:old.b,:old.c);
end; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T11:01:21.767

你可以试试：

```
declare
  l_deleting_ind varchar2(1) := case when DELETING then 'Y' end;
begin
  insert into audit_table (col1, col2)
  values
   ( CASE WHEN l_deleting_ind = 'Y' THEN :OLD.col1 ELSE :NEW.col1 END
   , CASE WHEN l_deleting_ind = 'Y' THEN :OLD.col2 ELSE :NEW.col2 END
   );
end; 
```

我发现该变量是必需的——您不能在插入语句中直接访问 DELETING。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-27T19:05:47.310

哇，您只想在触发器中插入一个以避免什么？

*“我有一个插入语句 INSERT INTO HIST (EMP_ID, NAME ) VALUES (:NEW.EMP_ID , :NEW.NAME) ；但在删除时，我想使用 :OLD ，而不是没有单独的插入语句。”*

这是一张宽大的桌子。所以？这不像文本编辑器中没有 REPLACE，您不会再次编写 Insert，只需复制、粘贴、选择、将 :NEW 替换为 :OLD。

Tony 确实有一个解决方案，但我严重怀疑其性能是否优于 2 次插入。

有什么大不了的？

* * *

**编辑**

*我要避免的主要事情是在表更改时必须管理 2 次插入。——马修·沃森*

我一直在与这种态度作斗争。那些编写 Java 或 C++ 或 .Net 的人有一个内置的 RBO……这样做，这很好。不要那样做，那样不好。他们根据这些规则编写代码，这很好。问题是这些规则何时应用于数据库。数据库的行为方式与代码不同。

在代码世界中，在两个“地方”拥有本质上相同的代码是不好的。我们避免它。可以将该代码抽象为一个函数并从两个位置调用它，从而避免对其进行两次维护，并可能遗漏一次，等等。我们都知道这个练习。

在这种情况下，虽然最后我推荐了两个插入，但它们由 ELSE 分隔*。*你不会改变一个而忘记另一个。**它就在那儿**。它不在不同的包中，不在某些已编译的代码中，甚至不在同一个触发器中的其他地方。它们就在彼此旁边，有一个 ELSE，并且插入以 :NEW 重复，而不是 :OLD。为什么我对这个如此疯狂？这里真的有区别吗？我知道两个插入不会比其他想法差，而且可能会更好。

真正的原因是为重要的时代做好准备。如果您只是为了维护而避免两次插入，那么您将错过这会产生巨大差异的时代。

```
INSERT INTO log
SELECT * FROM myTable 
WHERE flag = 'TRUE'

ELSE                          -- column omitted for clarity

INSERT INTO log
SELECT * FROM myTable 
WHERE flag = 'FALSE' 
```

包括 Matthew 在内的一些人会说这是糟糕的代码，有两个插入。我可以很容易地用绑定变量替换 'TRUE' 和 'FALSE' 并随意翻转它。这就是大多数人会做的事情。但是如果 True 是 0.1% 的值并且 99.9% 是 False，那么您需要两个插入，因为您需要两个执行计划。一个最好用索引，另一个用 FTS。所以，是的，你确实有两个插入要维护。这并不总是坏事，在这种情况下它是好的和可取的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T00:22:50.663

您可以使用复合触发器并以编程方式检查它是否使用 I/U/D。

[复合触发器](http://download.oracle.com/docs/cd/B28359_01/appdev.111/b28370/triggers.htm#CIHEFGFD)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T00:05:47.457

为什么不使用 Oracle 内置的标准或细粒度审计？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T19:38:03.910

正如其他人所建议的那样，使用复合触发器。根据需要将旧值或新值保存到变量中，并在插入语句中使用变量：

```
declare
  v_col1  table_name.col1%type;
  v_col2  table_name.col2%type;
begin
  if deleting then
    v_col1 := :old.col1;
    v_col2 := :old.col2;
  else
    v_col1 := :new.col1;
    v_col2 := :new.col2;
  end if;

  insert into audit_table(col1, col2)
  values(v_col1, v_col2);
end; 
```

# xsd - 在 XSD 文件中使用 Guid 类型的正确方法是什么？

> ID：687884
> 
> 赞同：27
> 
> 时间：2009-03-26T23:02:47.157
> 
> 标签：xsd, guid, xsd.exe

我有一个 .xsd 文件，用于使用 Visual Studio 中的 xsd.exe 工具生成代码。一些类成员是 Guid，xsd.exe 工具给出 2 个警告：

命名空间“ [http://microsoft.com/wsdl/types/](http://microsoft.com/wsdl/types/) ”不可在此架构中引用。未声明类型“ [http://microsoft.com/wsdl/types/:guid ”。](http://microsoft.com/wsdl/types/:guid)

由于生成的 C# 文件有效且有效，因此可以识别 Guid 类型。任何人都知道如何摆脱这些警告？

要验证 XSD 并将类成员生成为 System.Guid 的正确语法是什么？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-04-06T20:20:34.453

谢谢大家，我找到了如何删除警告。

正如[sysrqb](https://stackoverflow.com/users/3694/sysrqb)所说，wsdl 命名空间要么已被删除，要么从未存在。xsd.exe 工具似乎在内部知道 Guid 定义，但它无法验证 xsd 架构。

正如[boj](https://stackoverflow.com/users/72563/boj)指出的那样，验证带有 Guid 的模式的唯一方法是在模式中（重新）定义该类型。这里的技巧是将 Guid 类型添加到相同的“ [http://microsoft.com/wsdl/types](http://microsoft.com/wsdl/types) ”命名空间。这样，xsd.exe 将在[http://microsoft.com/wsdl/types:Guid](http://microsoft.com/wsdl/types:Guid)和 System.Guid之间进行正确关联

我为 guid 类型创建了一个新的 xsd 文件：

```
<?xml version="1.0" encoding="utf-8"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"
    targetNamespace="http://microsoft.com/wsdl/types/" >
    <xs:simpleType name="guid">
        <xs:annotation>
            <xs:documentation xml:lang="en">
                The representation of a GUID, generally the id of an element.
            </xs:documentation>
        </xs:annotation>
        <xs:restriction base="xs:string">
            <xs:pattern value="\{[a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}\}"/>
        </xs:restriction>
    </xs:simpleType>
</xs:schema> 
```

然后，我使用我的原始 xsd 文件和这个新的 xsd 文件运行 xsd.exe：

```
xsd.exe myschema.xsd guid.xsd /c 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T23:16:47.590

[从这里](http://www.bristowe.com/blog/permalink.aspx?guid=ef4da1fc-a195-4430-8b42-0eeb69a2919a "这里")引用：

```
 XmlSchema guidSchema = new XmlSchema();
   guidSchema.TargetNamespace = "http://microsoft.com/wsdl/types/";

   XmlSchemaSimpleTypeRestriction guidRestriction = new XmlSchemaSimpleTypeRestriction();
   guidRestriction.BaseTypeName = new XmlQualifiedName("string", XmlSchema.Namespace);

   XmlSchemaPatternFacet guidPattern = new XmlSchemaPatternFacet();
   guidPattern.Value = @"[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}";
   guidRestriction.Facets.Add(guidPattern);

   XmlSchemaSimpleType guidType = new XmlSchemaSimpleType();
   guidType.Name = "guid";
   guidType.Content = guidRestriction;
   guidSchema.Items.Add(guidType);

   schemaSet.Add(guidSchema);

   XmlSchema speakerSchema = new XmlSchema();
   speakerSchema.TargetNamespace = "http://www.microsoft.com/events/teched2005/";

   // ...

   XmlSchemaElement idElement = new XmlSchemaElement();
   idElement.Name = "ID";

   // Here's where the magic happens...

   idElement.SchemaTypeName = new XmlQualifiedName("guid", "http://microsoft.com/wsdl/types/"); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T23:10:12.553

看起来那个 wsdl 命名空间扩展页面被删除了，所以它找不到你需要的类型信息。

# .net - NHibernate 代理阻止 Castle.Validator 组件完成它的工作

> ID：687889
> 
> 赞同：0
> 
> 时间：2009-03-26T23:05:33.453
> 
> 标签：.net, nhibernate, validation, reflection, castle

我遇到了使用 Castle.Validator 组件进行 NHibernate 代理验证的问题。看起来验证器无法从实体代理的属性中获取属性。

我尝试使用 Inherited = true 定义验证属性，而 Castle.Validator runner 使用以下语句获取 em：

```
property.GetCustomAttributes(typeof(IValidatorBuilder), true); 
```

所以它应该从我的实体中获取属性，而它们在技术上是验证对象（代理）的基类？为什么它不起作用？GetCustomAttribute 始终返回空数组。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T23:38:51.220

这样的事情我也经历过。问题是 NHibernate 在创建代理时不继承属性。我发现的只是这个[论坛帖子](http://forum.castleproject.org/viewtopic.php?t=4670&sid=7fbc82d3a430608e457e73708043f793)，其中问题被识别并提供了一个简单的解决方法（只是在验证时不要使用代理），这就是我最终做的事情。

我可以推荐这个验证库：[Fluent Validation](http://www.codeplex.com/FluentValidation)，我还没有使用它，但我打算使用它，主要是因为我厌倦了使用属性（因为这样的问题）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T00:10:39.130

属性很好，因为它们确实是领域模型的一部分。

我想我找到了解决问题的方法。我已经修补了 Castle.Validator 这样做的想法。这太疯狂了，但是这段代码：

```
property.GetCustomAttributes(true /*inherit*/); 
```

返回空数组，而在我看来完全等效的代码返回属性：

```
System.Attribute.GetCustomAttributes(property); 
```

@#$​​% 是什么？

# powershell - 调用 Workbooks.Add() 时使用 Powershell 自动执行 Excel 2007 的异常

> ID：687891
> 
> 赞同：6
> 
> 时间：2009-03-26T23:05:58.427
> 
> 标签：powershell, excel-2007

以下代码在 Powershell V1 (Excel 2007) 中引发异常：

```
$E = New-Object -COM "Excel.Application"
$E.Visible = $True
$wb = $E.Workbooks.Add() #<<<Exception here 
```

该错误表示格式可能是旧的或类型库无效（从西班牙语翻译）。Word 的类似脚本工作得很好。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-27T01:04:35.727

当当前文化不是 en-US 时，Office 互操作程序集似乎存在此问题。显而易见的解决方法是设置文化。

在交互式控制台上将整个操作作为单个命令运行非常重要，因为 PowerShell V1 总是为每个命令调用创建一个新线程。

```
PS C:\Users\jachymko> $e = new-object -com excel.application
PS C:\Users\jachymko> $e.workbooks.add()
Exception calling "Add" with "0" argument(s): "Old format or invalid type library. (Exception from HRESULT: 0x80028018 (TYPE_E_INVDATAREAD))"
At line:1 char:17
+ $e.workbooks.add <<<< ()
    + CategoryInfo          : NotSpecified: (:) [], MethodInvocationException
    + FullyQualifiedErrorId : ComMethodTargetInvocation

PS C:\Users\jachymko> & {
>> [threading.thread]::CurrentThread.CurrentCulture = 'en-US'
>> $e = new-object -com excel.application
>> $e.workbooks.add()
>> $e.visible=1
>> }
>> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-28T17:05:31.867

[改编自MS 帮助和支持文章 320369](http://support.microsoft.com/default.aspx?scid=kb;en-us;320369)中提出的解决方案之一的 Powershell 。

```
$ci = new-object system.globalization.cultureinfo "en-US"

$e = New-Object -COM "Excel.Application"
$e.Visible = $True
$e.UserControl= $True
$books = $e.Workbooks
$books.PSBase.GetType().InvokeMember( `
       "Add", `
       [system.reflection.bindingflags]::InvokeMethod, `
       $null, $books, $null, $ci) 
```

来自同一篇文章：

> 当您对区域设置与 Office 的当前语言版本不匹配的计算机使用这些解决方法之一时，您应该熟悉 Excel 的行为方式以及 Excel 如何解释可能针对特定区域设置格式化的数据。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2015-01-19T11:08:02.633

我在尝试打开工作簿时遇到了这个问题。我添加了这一行：

```
[threading.thread]::CurrentThread.CurrentCulture = 'en-US' 
```

# sql - 在 Visual Studio 2008 中使用设计器将逗号分隔列表作为参数传递给 db2 查询的 IN 子句

> ID：687892
> 
> 赞同：1
> 
> 时间：2009-03-26T23:06:01.157
> 
> 标签：sql, vb.net, data-access-layer

我想将逗号分隔的值列表作为参数传递给我正在使用 Visual Studio 2008 中的设计器基于我正在经历的一些强类型 DAL 教程构建的查询。该查询针对的是 DB2 数据库。这是我想要做的：

从客户所在的价格中选择 *（？）

我在 123456 中通过它的工作正常吗？

但是当我传入 '123456' 时失败（这是一个字符字段，所以我不知道为什么这不起作用；它必须在幕后添加这些）或 123456、123457 或 '123456'、'123457'

我将此页面添加到一个门户，其中所有数据访问都是基于 DAL 设计器模型和调用它的 BLL 完成的，因此我想以这种方式进行操作以保持一致性。这是可能的，还是工具不够灵活，无法完成我需要它做的事情？谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T23:21:04.553

这是人们使用参数化查询时常犯的一个错误。您必须记住，单个参数占位符“ `?`”是**单个值**的替代品。

请参阅下面的问题链接，以获取 Joel Spolsky 针对此问题的巧妙解决方案。

“[参数化 SQL IN 子句？](https://stackoverflow.com/questions/337704/parameterizing-a-sql-in-clause) ”

还有一堆其他人回答了同样的问题，重申标准解决方案是动态构建 SQL 查询，为您需要传递的每个值附加一个参数占位符。

# html - 网页中的窄单列文本

> ID：687893
> 
> 赞同：6
> 
> 时间：2009-03-26T23:06:08.520
> 
> 标签：html

我正在制作一个非常简单的仅包含文本的 html 网页。如何缩小单列以使读者更容易阅读？

我希望文本的主体大致位于页面的中心并左对齐，左右两边留有空白（大致相等）的边距。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-26T23:09:06.253

通过将文本放在 DIV 中并使用样式来控制宽度：

```
<DIV style="width: 300px">
    Text goes here.
</DIV> 
```

对于居中，根据安吉拉在评论中的建议：

```
<DIV style="width: 300px; margin: 0 auto">
   Text goes here.<br>
    And another line which is much longer.
</DIV> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-26T23:35:58.013

## 完整的跨浏览器解决方案

的HTML：

```
<div id="centered"><!-- put your content here --></div> 
```

CSS：

```
body {
   text-align:center; /* this is required for old versions of IE */
}
#centered {
   width:400px; /* this is the width of the center column (px, em or %) */
   text-align:left; /*resets the text alignment back to left */
   margin:0 auto; /* auto centers the div in standards complaint browsers */
} 
```

就是这样，享受！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T23:09:18.297

使用 CSS...

```
body {
  margin:0 auto;
  width:600px;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T23:13:30.890

别人给出的宽度建议是关键。从可用性的角度来看，您肯定希望确保您没有报纸样式的多个列——人们只是不习惯以这种方式阅读网页。不过，对于不相关的内容没关系。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T23:15:34.740

如果您想要多个列，您可以在 Earwicker 的答案的基础上进行如下操作：

```
<div style="float: left; width: 300px">
   First Column
</div>
<div style="float: left; width: 300px; margin-left: 1em;">
   Second Column
</div> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-03-23T06:54:44.737

这是一个更灵活的现代解决方案：设置最大宽度允许列在窄视口中显示时更小。它还使用`rem`, 这是字符的宽度，是文本的更好单位。在此布局中触发的示例中为 20rem，但对于文本行，通常建议使用 60 到 80 之类的值。

```
p {
  max-width: 20rem;
  margin: auto;
}
```

```
<html>

<body>

  <p>
    AT&T and Johnson & Johnson, among the biggest advertisers in the United States, were among several companies to say Wednesday that they would stop their ads from running on YouTube and other Google properties amid concern that Google is not doing enough
    to prevent brands from appearing next to offensive material, like hate speech.
  </p>

</body>

</html>
```

# .net-3.5 - 是否可以在不升级 Visual Studio 版本的情况下以某种方式升级 .NET 版本？

> ID：687908
> 
> 赞同：3
> 
> 时间：2009-03-26T23:12:29.397
> 
> 标签：.net-3.5, visual-studio-2005, .net-2.0

我目前在所有个人项目中都使用 Visual Studio 2005，这意味着我也在使用 .NET 2.0 框架。可以想象，它给人一种过时的感觉。我在校时通过MSDN的学术联盟计划免费获得了这个版本的VS。现在我离开学校了，很遗憾我无法访问 MSDNAA，所以软件不再是免费的。

这让我们想到了我的问题。我一直在关注当前版本的 .NET 中的一些新功能。是否可以将 VS2005 升级为使用 .NET 3.5，还是硬连线只能使用 2.0？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-26T23:14:02.027

不，您不能将 VS2005 与 .NET 3.5 一起使用。但是，您当然可以免费下载[Visual Studio 2008 Express](http://www.microsoft.com/Express/)版本的 onoe。这可以毫无问题地与 Visual Studio 2005 共存。

这当然是我要去做的——即使你能以某种方式让 VS2005 与 3.5*框架*一起工作，你也不会得到*语言*特性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T23:15:31.883

Visual Studio 2008 允许您使用项目属性窗口下的目标框架在 .NET 2.0、3.0 和 3.5 之间轻松切换。

下载 Visual Studio 2008 速成版

该死，我只是被乔恩·斯基特（Jon Skeeted）......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T23:16:30.617

您可以在 VS 2005 中使用 .NET 3.5 库，但没有设置环境和编译器来利用它们。这使得使用 3.5 的许多特性变得非常困难（通常根本不值得）。

不过，在某些情况下，这很好。如果您只是在访问 3.5 中的一两个功能之后，引用框架的这些部分可以正常工作。

一般来说，我建议改用 VS 2008 Express。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T23:15:34.553

真正好的新特性是在语言中，尤其是 VB 和 C# 中的 Linq。旧的 IDE 在尝试为它们提供智能感知时会感到非常困惑，即使您可以让它启动新的编译器。所以我认为这不太可能奏效。

# xml - SSIS 可以从中提取数据的最大 XML 文件是什么？

> ID：687913
> 
> 赞同：5
> 
> 时间：2009-03-26T23:14:33.323
> 
> 标签：xml, ssis

我们有一个架构，我们使用 SSIS 将 XML 批处理文件中的数据提取到暂存数据库中进行验证，然后再将其导出到生产环境中。

我们在一定程度上控制了 XML 格式，并且有人要求我确定 XML 批处理文件应包含的最大记录数。基于 XML 模式和一些示例数据，我可以估计平均记录大小并从中进行一些预测。

但是，从另一个角度来看，我想了解一下 SSIS 在处理大型 XML 文件时的技术限制。

我知道 SSIS 会将 XML 文档展平并将其转换为它自己的表格、内存中表示，因此 RAM 成为一个明显的限制因素，但比例是多少？

你能说类似的话，SSIS 需要至少 2.5 倍于你试图加载的文件大小的东西，在可用内存中？假设我有一个 32GB 的盒子专用于这个数据加载功能，我的 XML 文件可以有多大？

我知道可能还包括其他因素，例如架构的复杂性、嵌套元素的数量等，但有一个起点会很好。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T08:03:16.280

Xml Source 不会将整个文档加载到内存中，而是在从 XML 文件中读取数据时将数据流式传输出去。因此，如果您正在读取 XML 并将其写入例如文本文件而无需复杂的转换，则您需要的内存相对较少。此外，当 XML 文件增长时，您需要的内存量（在某个阈值之后）停止增长 - 因此您可以处理潜在的无限 XML 文件。

例如，这个人导出了整个维基百科内容（20Gb XML 文件）： [http ://www.ideaexcursion.com/2009/01/26/import-wikipedia-articles-into-sql-server-with-ssis/](http://www.ideaexcursion.com/2009/01/26/import-wikipedia-articles-into-sql-server-with-ssis/)

当然，您可能会对这些数据做一些事情，例如加入来自 XML 源的多个流。根据您的需要，您可能需要大量内存，因为某些转换确实将整个数据集保存在内存中，或者如果您有足够的内存用于整个数据集，则性能会更好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T23:47:51.603

没那么简单。

首先，请注意，SSIS “扁平化”了 XML，使得通过 XML 的每条路径都有一个来自 XML 源的输出。一个简单的例子是

`<Parent><Child><Grandchild/></Child></Parent>`

将产生三个输出和三个错误输出。情况变得更糟：

`<Parent><Child><Grandchild><Notes/></Grandchild><Notes/></Child><Notes/></Parent>`

这将产生 Parent、Child、Grandchild、Parent-Child-Grandchild-Notes、Parent-Child-Notes 和 Parent-Notes 输出，包括正常输出和错误输出。

我参与的一个项目开始时有大约 203 个输出。我能够展平 XML 模式并仅生成 19 个左右。考虑到每个输出都需要完成自己的处理，这仍然很多。

此外，XML 任务无法处理 1GB 或更多的 XML。实际上，它确实将整个文档加载到内存中。尝试对此类文件执行 XmlDocument.Load 并观察会发生什么——这就是 SSIS 发生的事情。

我必须自己创建一个“XML 元素源”，一次处理一个根元素的子元素。这使我能够扁平化 XML 以及处理大型文档（一个 10GB 的测试文档有效）。

取决于你想对结果数据做什么，会有更多的乐趣。就我而言，我们必须将每个输出发送到临时表。这不是一件坏事，但您必须意识到输出中的数据是异步的。单个子元素（带有后代）将一次到达输出路径的末端，并且您永远不会知道所有后代何时都已完成处理。这使得不可能一次处理一个基于事务的处理。

相反，SSIS 为每个子元素添加了一个代理键（我认为这就是它的名称）。将有一个 ParentID 添加到父级，一个 ChildID 到子级，还有一个 ChildParentID 也添加到子级，以引用子级的父级。这些可用于“将元素重新组合在一起”，但前提是所有数据都已完成写入临时表。这是您唯一可以确定任何给定元素已被完全处理的时间 - 当它们都已处理*时*！

# asp.net - 绝对定位是最佳实践还是应该避免？

> ID：687938
> 
> 赞同：4
> 
> 时间：2009-03-26T23:27:24.087
> 
> 标签：asp.net, css

我正在观看[http://www.asp.net/learn/3.5-videos/video-13.aspx](http://www.asp.net/learn/3.5-videos/video-13.aspx)上的 ASP.NET 学习视频 ，它显示您可以使用绝对定位在页面上放置控件。我只是想知道这是否是最佳做法，还是应该避免绝对定位？这似乎是一个不错的、简单的功能，但是在 VS IDE 中默认没有选择它肯定是有原因的。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-26T23:39:10.347

许多用户通过配置浏览器设置来更改页面的字体大小。如果您使用绝对定位，事情将无法正确对齐。

在绝对定位中，当您的页面变得更复杂时，一个设计决策将要求您重新定位所有元素，但在相对定位中，您只需更改一个值，所有其他元素都会相应调整。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T23:43:14.220

绝对定位将元素从文档流中取出。这意味着它将不再与其他元素对齐。有时这样做有很好的理由，但通常你想避免它。

ASP.NET 因使用不良的 HTML/CSS 做法而臭名昭著。该框架是为“快速开发”而不是“优雅的 Web 标准开发”而设计的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-01-25T14:36:13.373

你怀疑是对的:)

基本上，不要将它用于控件。

我只将它用于对话框或其他可以计算相对于页面大小的正确位置的功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T00:05:24.837

我认为这个问题更多的是关于 CSS 而不是视觉工作室。由于其他答案中解释的原因，您应该尽可能使用相对定位。

这并不意味着绝对定位根本没有用。查看[http://csszengarden.com/](http://csszengarden.com/)，了解如何使用简单的 html 结构并仍然使用一些非常有趣的设计。

# forms - 您使用哪些应用程序通过 ODBC 输入和检索数据？

> ID：687940
> 
> 赞同：5
> 
> 时间：2009-03-26T23:28:41.557
> 
> 标签：forms, postgresql, odbc, data-entry

您使用哪些应用程序或工具将数据输入数据库？我正在尝试改进我们现有的（繁琐的）系统，该系统使用基于 php 网络的系统来输入数据一个……项目……在……一次……时间。

我目前的解决方案是使用电子表格。它适用于人类可读的文本和数字，但不适用于用于连接其他表行的外键。

想象一下，我想要一行数据来包含某人居住的城市。包含此数据的列是 id_city，它被键入“城市”表，该表有两列：id（序列）和名称（文本）。

我设想能够扩展电子表格功能以包括 id_city 列的每一行的下拉菜单，这将允许用户选择哪个城市（显示城市名称的文本），但实际上存储所选的城市 ID。这样，电子表格将：
(1) 在每个屏幕上显示大量数据，
(2) 可以导出为 csv 文件并扔到我们现有的脚本中，手动将行插入数据库。

我一直在玩 MS Excel 和 Access，以及 OpenOffice 的套件，但没有找到可以提供我上面提到的功能的东西。

我的愿望清单上的其他项目：
（1）动态获取用户可以选择的城市名称。
(2) 允许用户将数据直接推送到后端（而不是通过外部文件/脚本。
(3) 如果后端数据行的任何列发生变化，用户可以刷新屏幕上的数据以反映最近的任何变化。

你知道我可以如何改进数据输入的过程吗？你用什么工具？我使用 PostgreSQL 作为后端，并且可以访问 MS Office、OpenOffice 以及基于 Web 的解决方案。我想要一个灵活、强大且不需要太多时间来开发或部署的解决方案（我知道，梦想着......）

我知道 pgAdmin3 具有类似的功能，但据我所见，它更像是一种管理工具，而不是供用户使用的东西。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2012-06-01T21:17:37.290

正如 j_random_hacker 所指出的，我已经使用 MS Access 多年（从 Access 97 开始）连接到 ODBC 数据源。

您可以通过链接到外部表来做到这一点：（在 Access 2010 中：）

```
New -> Blank Database
External Data -> ODBC Database -> Link to Data Source
Machine Data Source -> New -> System Data Source -> Select Driver (Oracle, or whatever) -> Finish
Enter a new name for your DSN, the all of the connection parameters, then click OK
Select newly created DSN, hit ok. 
```

一旦 Access 将您的外部表视为链接表，您就可以做很多事情，包括排序、过滤等。有一个警告：据我所知，除非您使用直通，否则所有操作都发生在客户端询问。如果您正在查看包含 3000 条记录的表，那很好。有 2,000,000 条记录，这很痛苦。需要明确的是，表中的所有数据都归结到工作站，对于所有要连接的表，并且连接发生在客户端，而不是服务器端。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T23:35:02.663

通常有用于基本数据库管理的独立工具——例如，对于 Oracle 和 MySQL，一个名为 SQL Developer 的免费工具足以用于基本数据库数据输入。

对于更复杂的类型（尤其是涉及到 clob），如果我们已经在 J​​ava 端提供了模型和 DAO，我通常可以在一天内用 Java+SWT 将一个应用程序组合在一起。是的，您必须付出一些努力，但是如果将来会定期使用它，那可能是值得的。

在您的情况下（好吧，在您有大量数据导入的情况下）敲一些从 CSV 读取的 Perl 并执行城市 ID 查找将是微不足道的。也许一次性的东西浪费了？取决于要导入的数据量。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-31T03:53:58.217

如果 MS Access 无法满足您的需求，我会感到惊讶——这基本上就是它的*确切*用例。即，快速为一个简单的 CRUD DB 应用程序组合一个漂亮的 UI，而电子表格并不能很好地扩展到该应用程序。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-06-01T21:06:00.673

从技术上讲，这是一个答案，但不是建议：

我使用 Excel 和 SSIS 将简单的数据输入文件导入 MS SQL，但这还不够——控制数据的能力非常小，而且 SSIS 非常敏感，尤其是在使用 Excel 时。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2013-11-07T21:07:57.097

MS Access 不适用于某些非 Microsoft 数据库。您可能想尝试一个名为 Apache OpenOffice Base 的开源等效项。

# c# - C# 中的 Java Map 等效项

> ID：687942
> 
> 赞同：157
> 
> 时间：2009-03-26T23:30:14.923
> 
> 标签：c#, java, generics, collections

我正在尝试使用我选择的键来保存集合中的项目列表。在 Java 中，我会简单地使用 Map 如下：

```
class Test {
  Map<Integer,String> entities;

  public String getEntity(Integer code) {
    return this.entities.get(code);
  }
} 
```

在 C# 中是否有等效的方法？ `System.Collections.Generic.Hashset`不使用哈希，我无法定义自定义类型键 `System.Collections.Hashtable`不是泛型类
`System.Collections.Generic.Dictionary`没有`get(Key)`方法

* * *

## 回答 #1

> 赞同：192
> 
> 时间：2009-03-26T23:33:07.240

你可以索引字典，你不需要'get'。

```
Dictionary<string,string> example = new Dictionary<string,string>();
...
example.Add("hello","world");
...
Console.Writeline(example["hello"]); 
```

测试/获取值的一种有效方法是`TryGetValue`（感谢 Earwicker）：

```
if (otherExample.TryGetValue("key", out value))
{
    otherExample["key"] = value + 1;
} 
```

使用此方法，您可以快速且无异常地获取值（如果存在）。

资源：

[字典键](http://dotnetperls.com/Content/Dictionary-Keys.aspx)

[尝试获取价值](http://dotnetperls.com/Content/TryGetValue.aspx)

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-03-26T23:34:15.007

Dictionary<,> 是等价的。虽然它没有 Get(...) 方法，但它确实有一个名为 Item 的索引属性，您可以在 C# 中使用索引表示法直接访问该属性：

```
class Test {
  Dictionary<int,String> entities;

  public String getEntity(int code) {
    return this.entities[code];
  }
} 
```

如果要使用自定义键类型，则应考虑实现 IEquatable<> 并覆盖 Equals(object) 和 GetHashCode()，除非默认（引用或结构）相等性足以确定键的相等性。您还应该使您的键类型不可变，以防止在将键插入字典后发生突变时发生奇怪的事情（例如，因为突变导致其哈希码发生变化）。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-03-26T23:36:08.667

```
class Test
{
    Dictionary<int, string> entities;

    public string GetEntity(int code)
    {
        // java's get method returns null when the key has no mapping
        // so we'll do the same

        string val;
        if (entities.TryGetValue(code, out val))
            return val;
        else
            return null;
    }
} 
```

# bash - 在 bash 中超时一个命令而没有不必要的延迟

> ID：687948
> 
> 赞同：330
> 
> 时间：2009-03-26T23:32:49.457
> 
> 标签：bash, command-line, timeout, utilities

这个对命令行命令的[回答](https://stackoverflow.com/questions/601543#637753)[在一定时间后自动终止命令](https://stackoverflow.com/questions/601543)

提出了一种 1 行方法来使 bash 命令行中的长时间运行的命令超时：

```
( /path/to/slow command with options ) & sleep 5 ; kill $! 
```

但是给定的“长时间运行”命令可能会在超时之前完成。
（让我们称其为“通常长时间运行但有时很快”的命令，或*tlrbsf*来表示乐趣。）

所以这个漂亮的 1-liner 方法有几个问题。
首先，`sleep`不是有条件的，因此对序列完成所需的时间设置了一个不希望的下限。*当tlrbsf*命令在 2 秒内完成时，考虑 30s 或 2m 甚至 5m 的睡眠时间——非常不受欢迎。
其次，它`kill`是无条件的，所以这个序列将试图杀死一个非运行的进程并抱怨它。

所以...

**有没有办法**让一个通常长时间运行但有时快速（*“tlrbsf”*）命令超时

*   有一个 bash 实现（另一个问题已经有 Perl 和 C 的答案）
*   将在两者中的较早者终止：*tlrbsf*程序终止，或超时已过
*   不会杀死不存在/未运行的进程（或者，可选：不会*抱怨*错误的杀死）
*   不必是 1-liner
*   可以在 Cygwin 或 Linux 下运行

...并且，对于奖励积分

*   在前台运行*tlrbsf*命令
*   后台的任何“睡眠”或额外进程

这样*tlrbsf*命令的 stdin/stdout/stderr 可以被重定向，就像它直接运行一样？

如果是这样，请分享您的代码。如果不是，请解释原因。

我花了一段时间试图破解上述示例，但我的 bash 技能已达到极限。

* * *

## 回答 #1

> 赞同：614
> 
> 时间：2011-01-03T03:04:41.683

您可能正在 coreutils 中寻找该`timeout`命令。由于它是 coreutils 的一部分，因此在技术上它是一个 C 解决方案，但它仍然是 coreutils。`info timeout`更多细节。这是一个例子：

```
timeout 5 /path/to/slow/command with options 
```

* * *

## 回答 #2

> 赞同：163
> 
> 时间：2009-03-26T23:57:56.073

我认为这正是您所要求的：

[http://www.bashcookbook.com/bashinfo/source/bash-4.0/examples/scripts/timeout3](http://www.bashcookbook.com/bashinfo/source/bash-4.0/examples/scripts/timeout3)

```
#!/bin/bash
#
# The Bash shell script executes a command with a time-out.
# Upon time-out expiration SIGTERM (15) is sent to the process. If the signal
# is blocked, then the subsequent SIGKILL (9) terminates it.
#
# Based on the Bash documentation example.

# Hello Chet,
# please find attached a "little easier"  :-)  to comprehend
# time-out example.  If you find it suitable, feel free to include
# anywhere: the very same logic as in the original examples/scripts, a
# little more transparent implementation to my taste.
#
# Dmitry V Golovashkin <Dmitry.Golovashkin@sas.com>

scriptName="${0##*/}"

declare -i DEFAULT_TIMEOUT=9
declare -i DEFAULT_INTERVAL=1
declare -i DEFAULT_DELAY=1

# Timeout.
declare -i timeout=DEFAULT_TIMEOUT
# Interval between checks if the process is still alive.
declare -i interval=DEFAULT_INTERVAL
# Delay between posting the SIGTERM signal and destroying the process by SIGKILL.
declare -i delay=DEFAULT_DELAY

function printUsage() {
    cat <<EOF

Synopsis
    $scriptName [-t timeout] [-i interval] [-d delay] command
    Execute a command with a time-out.
    Upon time-out expiration SIGTERM (15) is sent to the process. If SIGTERM
    signal is blocked, then the subsequent SIGKILL (9) terminates it.

    -t timeout
        Number of seconds to wait for command completion.
        Default value: $DEFAULT_TIMEOUT seconds.

    -i interval
        Interval between checks if the process is still alive.
        Positive integer, default value: $DEFAULT_INTERVAL seconds.

    -d delay
        Delay between posting the SIGTERM signal and destroying the
        process by SIGKILL. Default value: $DEFAULT_DELAY seconds.

As of today, Bash does not support floating point arithmetic (sleep does),
therefore all delay/time values must be integers.
EOF
}

# Options.
while getopts ":t:i:d:" option; do
    case "$option" in
        t) timeout=$OPTARG ;;
        i) interval=$OPTARG ;;
        d) delay=$OPTARG ;;
        *) printUsage; exit 1 ;;
    esac
done
shift $((OPTIND - 1))

# $# should be at least 1 (the command to execute), however it may be strictly
# greater than 1 if the command itself has options.
if (($# == 0 || interval <= 0)); then
    printUsage
    exit 1
fi

# kill -0 pid   Exit code indicates if a signal may be sent to $pid process.
(
    ((t = timeout))

    while ((t > 0)); do
        sleep $interval
        kill -0 $$ || exit 0
        ((t -= interval))
    done

    # Be nice, post SIGTERM first.
    # The 'exit 0' below will be executed if any preceeding command fails.
    kill -s SIGTERM $$ && kill -0 $$ || exit 0
    sleep $delay
    kill -s SIGKILL $$
) 2> /dev/null &

exec "$@" 
```

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2012-06-15T18:29:48.373

无论 bash 监视器模式如何，此解决方案都有效。您可以使用适当的信号来终止 your_command

```
#!/bin/sh
( your_command ) & pid=$!
( sleep $TIMEOUT && kill -HUP $pid ) 2>/dev/null & watcher=$!
wait $pid 2>/dev/null && pkill -HUP -P $watcher 
```

观察者在给定超时后杀死 your_command；脚本等待慢任务并终止观察者。请注意，这`wait`不适用于作为不同 shell 的子进程的进程。

## 例子：

*   your_command 运行超过 2 秒并被终止

> your_command 中断

```
( sleep 20 ) & pid=$!
( sleep 2 && kill -HUP $pid ) 2>/dev/null & watcher=$!
if wait $pid 2>/dev/null; then
    echo "your_command finished"
    pkill -HUP -P $watcher
    wait $watcher
else
    echo "your_command interrupted"
fi 
```

*   your_command 在超时前完成（20 秒）

> your_command 完成

```
( sleep 2 ) & pid=$!
( sleep 20 && kill -HUP $pid ) 2>/dev/null & watcher=$!
if wait $pid 2>/dev/null; then
    echo "your_command finished"
    pkill -HUP -P $watcher
    wait $watcher
else
    echo "your_command interrupted"
fi 
```

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2018-10-24T17:46:02.603

要`slowcommand`在 1 秒后超时：

`timeout 1 slowcommand || echo "I failed, perhaps due to time out"`

判断命令是否因自身原因超时或失败，查看状态码是否为124：

```
# ping the address 8.8.8.8 for 3 seconds, but timeout after only 1 second
timeout 1 ping 8.8.8.8 -w3
EXIT_STATUS=$?
if [ $EXIT_STATUS -eq 124 ]
then
echo 'Process Timed Out!'
else
echo 'Process did not timeout. Something else went wrong.'
fi
exit $EXIT_STATUS 
```

请注意，当退出状态为 124 时，您不知道它是否由于您的`timeout`命令而超时，或者命令本身是否由于其自身的某些内部超时逻辑而终止然后返回 124。您可以放心地假设在任何一种情况下，但是，发生了某种超时。

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2016-03-06T17:34:47.197

你去：

```
timeout --signal=SIGINT 10 /path/to/slow command with options 
```

您可以根据需要更改`SIGINT`and `10`;)

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2015-03-02T07:00:41.057

你可以完全做到这一点`bash 4.3`及以上：

```
_timeout() { ( set +b; sleep "$1" & "${@:2}" & wait -n; r=$?; kill -9 `jobs -p`; exit $r; ) } 
```

*   例子：`_timeout 5 longrunning_command args`
*   例子：`{ _timeout 5 producer || echo KABOOM $?; } | consumer`
*   例子：`producer | { _timeout 5 consumer1; consumer2; }`
*   例子：`{ while date; do sleep .3; done; } | _timeout 5 cat | less`

*   需要 Bash 4.3`wait -n`

*   如果命令被杀死，则返回 137，否则返回命令的值。
*   适用于管道。（你不需要在这里走到前台！）
*   也适用于内部 shell 命令或函数。
*   在子 shell 中运行，因此没有变量导出到当前 shell，抱歉。

如果您不需要返回码，这可以更简单：

```
_timeout() { ( set +b; sleep "$1" & "${@:2}" & wait -n; kill -9 `jobs -p`; ) } 
```

笔记：

*   严格来说，您不需要`;`in `; )`，但是它使事情与`; }`-case 更加一致。并且`set +b`可能也可以忽略，但安全总比后悔好。

*   除了`--forground`（可能）您可以实现所有变体`timeout`支持。 `--preserve-status`不过，这有点困难。这留给读者练习；）

这个配方可以在 shell 中“自然地”使用（与 for 一样自然`flock fd`）：

```
(
set +b
sleep 20 &
{
YOUR SHELL CODE HERE
} &
wait -n
kill `jobs -p`
) 
```

但是，如上所述，您不能以这种方式自然地将环境变量重新导出到封闭的外壳中。

编辑：

现实世界的例子：超时`__git_ps1`以防它花费太长时间（对于慢速 SSHFS-Links 之类的事情）：

```
eval "__orig$(declare -f __git_ps1)" && __git_ps1() { ( git() { _timeout 0.3 /usr/bin/git "$@"; }; _timeout 0.3 __orig__git_ps1 "$@"; ) } 
```

编辑2：错误修复。我注意到这`exit 137`是不需要`_timeout`的，同时也变得不可靠。

Edit3：`git`是一个顽固的人，所以它需要一个双重技巧才能令人满意地工作。

Edit4：`_`第一次忘记了`_timeout`真实世界的 GIT 示例。

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2010-08-15T10:05:52.960

我更喜欢“timelimit”，它至少在 debian 中有一个包。

[http://devel.ringlet.net/sysutils/timelimit/](http://devel.ringlet.net/sysutils/timelimit/)

它比 coreutils 的“超时”要好一点，因为它在终止进程时会打印一些东西，并且默认情况下它还会在一段时间后发送 SIGKILL。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2010-02-02T12:42:28.650

另请参阅[http://www.pixelbeat.org/scripts/timeout](http://www.pixelbeat.org/scripts/timeout)脚本，其功能已集成到较新的 coreutils

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2015-04-18T13:34:52.837

*timeout*可能是第一种尝试的方法。如果超时，您可能需要通知或执行其他命令。经过相当多的搜索和试验，我想出了这个*bash*脚本：

```
if 
    timeout 20s COMMAND_YOU_WANT_TO_EXECUTE;
    timeout 20s AS_MANY_COMMANDS_AS_YOU_WANT;
then
    echo 'OK'; #if you want a positive response
else
    echo 'Not OK';
    AND_ALTERNATIVE_COMMANDS
fi 
```

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2009-03-26T23:55:33.037

有点hacky，但它有效。如果您有其他前台进程则不起作用（请帮我解决这个问题！）

```
sleep TIMEOUT & SPID=${!}; (YOUR COMMAND HERE; kill ${SPID}) & CPID=${!}; fg 1; kill ${CPID} 
```

实际上，我认为您可以扭转它，满足您的“奖金”标准：

```
(YOUR COMMAND HERE & SPID=${!}; (sleep TIMEOUT; kill ${SPID}) & CPID=${!}; fg 1; kill ${CPID}) < asdf > fdsa 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2017-06-28T20:44:54.193

代码清晰的简单脚本。保存到`/usr/local/bin/run`：

```
#!/bin/bash

# run
# Run command with timeout $1 seconds.

# Timeout seconds
timeout_seconds="$1"
shift

# PID
pid=$$

# Start timeout
(
  sleep "$timeout_seconds"
  echo "Timed out after $timeout_seconds seconds"
  kill -- -$pid &>/dev/null
) &
timeout_pid=$!

# Run
"$@"

# Stop timeout
kill $timeout_pid &>/dev/null 
```

使运行时间过长的命令超时：

```
$ run 2 sleep 10
Timed out after 2 seconds
Terminated
$ 
```

对于完成的命令，立即结束：

```
$ run 10 sleep 2
$ 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2012-02-01T13:56:10.127

如果您已经知道程序的名称（假设`program`）在超时（例如`3`秒）后终止，我可以提供一个简单且有点脏的替代解决方案：

```
(sleep 3 && killall program) & ./program 
```

如果我用系统调用调用基准过程，这将非常有效。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2013-03-12T11:58:28.940

还有`cratimeout`Martin Cracauer（用 C 语言为 Unix 和 Linux 系统编写）。

```
# cf. http://www.cons.org/cracauer/software.html
# usage: cratimeout timeout_in_msec cmd args
cratimeout 5000 sleep 1
cratimeout 5000 sleep 600
cratimeout 5000 tail -f /dev/null
cratimeout 5000 sh -c 'while sleep 1; do date; done' 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2015-06-30T19:33:12.663

OS X 还没有使用 bash 4，也没有 /usr/bin/timeout，所以这里有一个在 OS X 上工作的函数，没有 home-brew 或 macports，类似于 /usr/bin/timeout（基于 Tino 的回答）。对其他信号的参数验证、帮助、使用和支持是读者的练习。

```
# implement /usr/bin/timeout only if it doesn't exist
[ -n "$(type -p timeout 2>&1)" ] || function timeout { (
    set -m +b
    sleep "$1" &
    SPID=${!}
    ("${@:2}"; RETVAL=$?; kill ${SPID}; exit $RETVAL) &
    CPID=${!}
    wait %1
    SLEEPRETVAL=$?
    if [ $SLEEPRETVAL -eq 0 ] && kill ${CPID} >/dev/null 2>&1 ; then
      RETVAL=124
      # When you need to make sure it dies
      #(sleep 1; kill -9 ${CPID} >/dev/null 2>&1)&
      wait %2
    else
      wait %2
      RETVAL=$?
    fi
    return $RETVAL
) } 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2017-04-06T15:35:01.597

这是一个不依赖于产生子进程的版本 - 我需要一个嵌入此功能的独立脚本。它还执行分数轮询间隔，因此您可以更快地进行轮询。超时本来是首选-但我被困在旧服务器上

```
# wait_on_command <timeout> <poll interval> command
wait_on_command()
{
    local timeout=$1; shift
    local interval=$1; shift
    $* &
    local child=$!

    loops=$(bc <<< "($timeout * (1 / $interval)) + 0.5" | sed 's/\..*//g')
    ((t = loops))
    while ((t > 0)); do
        sleep $interval
        kill -0 $child &>/dev/null || return
        ((t -= 1))
    done

    kill $child &>/dev/null || kill -0 $child &>/dev/null || return
    sleep $interval
    kill -9 $child &>/dev/null
    echo Timed out
}

slow_command()
{
    sleep 2
    echo Completed normally
}

# wait 1 sec in 0.1 sec increments
wait_on_command 1 0.1 slow_command

# or call an external command
wait_on_command 1 0.1 sleep 10 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-01-03T20:56:17.030

```
#! /bin/bash
timeout=10
interval=1
delay=3
(
    ((t = timeout)) || :

    while ((t > 0)); do
        echo "$t"
        sleep $interval
        # Check if the process still exists.
        kill -0 $$ 2> /dev/null || exit 0
        ((t -= interval)) || :
    done

    # Be nice, post SIGTERM first.
    { echo SIGTERM to $$ ; kill -s TERM $$ ; sleep $delay ; kill -0 $$ 2> /dev/null && { echo SIGKILL to $$ ; kill -s KILL $$ ; } ; }
) &

exec "$@" 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-01-11T02:40:54.413

我遇到了一个保留 shell 上下文并允许超时的问题，唯一的问题是它会在超时时停止脚本执行 - 但它可以满足我提出的需求：

```
#!/usr/bin/env bash

safe_kill()
{
  ps aux | grep -v grep | grep $1 >/dev/null && kill ${2:-} $1
}

my_timeout()
{
  typeset _my_timeout _waiter_pid _return
  _my_timeout=$1
  echo "Timeout($_my_timeout) running: $*"
  shift
  (
    trap "return 0" USR1
    sleep $_my_timeout
    echo "Timeout($_my_timeout) reached for: $*"
    safe_kill $$
  ) &
  _waiter_pid=$!
  "$@" || _return=$?
  safe_kill $_waiter_pid -USR1
  echo "Timeout($_my_timeout) ran: $*"
  return ${_return:-0}
}

my_timeout 3 cd scripts
my_timeout 3 pwd
my_timeout 3 true  && echo true || echo false
my_timeout 3 false && echo true || echo false
my_timeout 3 sleep 10
my_timeout 3 pwd 
```

输出：

```
Timeout(3) running: 3 cd scripts
Timeout(3) ran: cd scripts
Timeout(3) running: 3 pwd
/home/mpapis/projects/rvm/rvm/scripts
Timeout(3) ran: pwd
Timeout(3) running: 3 true
Timeout(3) ran: true
true
Timeout(3) running: 3 false
Timeout(3) ran: false
false
Timeout(3) running: 3 sleep 10
Timeout(3) reached for: sleep 10
Terminated 
```

当然我假设有一个目录叫做`scripts`

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2015-07-16T18:48:43.983

我的问题可能有点不同：我在远程机器上通过 ssh 启动命令，如果命令挂起，我想杀死 shell 和子进程。

我现在使用以下内容：

```
ssh server '( sleep 60 && kill -9 0 ) 2>/dev/null & my_command; RC=$? ; sleep 1 ; pkill -P $! ; exit $RC' 
```

这样命令在超时时返回 255 或在成功的情况下返回命令的返回码

请注意，从 ssh 会话中终止进程的处理方式与交互式 shell 不同。但是你也可以使用 -t 选项来 ssh 分配一个伪终端，所以它就像一个交互式 shell

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2020-07-15T16:23:30.090

timeout 命令本身有一个`--foreground`选项。这让命令“在不直接从 shell 提示符运行超时时”与用户交互。

```
timeout --foreground the_command its_options 
```

我认为提问者一定已经知道该`timeout`命令的非常明显的解决方案，但出于这个原因要求提供替代解决方案。`timeout`当我使用它调用它时对我不起作用`popen`，即'不是直接来自外壳'。但是，让我不要假设这可能是提问者案件的原因。看看它的[手册页](https://man7.org/linux/man-pages/man1/timeout.1.html)。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2021-10-13T20:48:08.030

如果您想在脚本中执行此操作，请将其放在那里：

```
parent=$$
( sleep 5 && kill -HUP $parent ) 2>/dev/null & 
```

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2009-03-27T07:34:16.087

在 99% 的情况下，答案是不实现任何超时逻辑。超时逻辑几乎在任何情况下都是一个红色警告信号，表明其他*地方*有问题，应该*改正*。

您的进程有时会在 n 秒后挂起或中断吗？然后找出原因并改正它。

顺便说一句，要正确执行 strager 的解决方案，您需要使用 wait "$SPID" 而不是 fg 1，因为在脚本中您没有作业控制（并且试图打开它是愚蠢的）。此外，fg 1 依赖于您之前没有在脚本中启动任何其他工作的事实，这是一个不好的假设。

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2018-08-30T23:04:44.863

以[@loup 的回答](https://stackoverflow.com/a/9096953/337735)为基础...

如果要使进程超时并使 kill 作业/pid 输出静音，请运行：

```
( (sleep 1 && killall program 2>/dev/null) &) && program --version 
```

这会将后台进程放入子外壳中，因此您看不到作业输出。

* * *

## 回答 #23

> 赞同：-2
> 
> 时间：2015-02-16T10:29:18.847

一个非常简单的方法：

```
# command & sleep 5; pkill -9 -x -f "command" 
```

使用*pkill*（选项**-f**），您可以使用参数终止您的特定命令或指定 -n 以避免终止旧进程。

* * *

## 回答 #24

> 赞同：-5
> 
> 时间：2018-10-03T15:50:04.683

我有一个调用 php 脚本的 cron 作业，有时它会卡在 php 脚本上。这个解决方案对我来说是完美的。

我用：

```
scripttimeout -t 60 /script.php 
```

# entity-framework - 在 ADO.NET 实体框架 UpdateException 方面需要帮助

> ID：687952
> 
> 赞同：0
> 
> 时间：2009-03-26T23:34:02.107
> 
> 标签：entity-framework, ado.net, entity-relationship, ado.net-entity-data-model, objectcontext

我的数据库中有一个联系人表和一个电话表，在电话表中有一个“ContactId”列，其中一个键将电话引用到联系人。

在服务器的关键选项中，我将其删除选项设置为“级联”。

现在，当我尝试使用上下文删除联系人时：

```
Dim contact As Contact 'The contact I want to delete.
Dim context As New Entities 'The ObjectContext.
context.DeleteObject(contact)
context.SaveChanges() 
```

上面的语句引发了一个 UpdateException，让我知道联系人仍有电话记录，其 ContactId col 设置为其 ID。

现在我知道我可以手动完成并首先删除所有相关电话然后删除联系人，但我正在寻找一种更有效的方法，我希望这一切都应该自动完成。

欢迎任何建议和实践。

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T11:56:32.523

您不需要先手动删除电话记录，但确实需要加载它们。加载记录后，实体框架将确定要做什么。

此外，这篇博文还有[一种方法可以在实体框架中删除对象，而无需先检索它们](http://blogs.msdn.com/alexj/archive/2009/03/27/tip-9-deleting-an-object-without-retrieving-it.aspx "技巧 9 – 删除对象而不检索它")。讨论了删除引用相关对象的对象的问题。它可能会帮助您了解引擎盖下发生的事情。

# xpath - 为 Selenium 中没有 ID 或名称的元素编写 XPath

> ID：687956
> 
> 赞同：0
> 
> 时间：2009-03-26T23:35:10.307
> 
> 标签：xpath, selenium

我正在尝试自动测试代码......好吧，编写时没有考虑测试（许多元素上没有ID，并且许多元素具有相同的类名）。我会很感激任何帮助（问题在代码下方）：

```
<div id="author-taxonomies" class="menu-opened menu-hover-opened-inactive" onmouseover="styleMenuElement(this)" onmouseout="styleMenuElement(this)" onclick="toggleSFGroup(this)">Author</div>
<div id="author-taxonomies-div" class="opened">
    <div id="top-level-menu" class="opened">
        <div id="top-level-menu-item-1" class="as-master">
            <div class="filter-label"> Name</div>
        </div>
        <div id="top-level-menu-item-1" class="as-slave"
            style="top: 525px; left: 34px; z-index: 100; display: none;"> </div>
        <div id="top-level-menu-item-2" class="as-master">
            <div class="filter-label">Title</div>
        </div>
        <div id="top-level-menu-item-2" class="as-slave">
            <div id="top-level-menu-item-2" class="as-slave-title as-slave-title-subgroup"
                >Title</div>
            <div id="top-level-menu-item-2" class="as-slave-body"> </div>
            <div class="as-slave-buffer"> </div>
        </div>
        <div id="top-level-menu-item-3" class="as-master">
            <div class="filter-label">Location</div>
        </div>
        <div id="top-level-menu-item-3" class="as-slave"> </div>
    </div>
</div> 
```

问题是：如何使用 xPath 表达式引用此菜单的特定标签和属性？例如，如果我想：

1.  验证“位置”标签是否存在
2.  检查当前是否不可见具有“as-slave”类的“Title”

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T00:22:40.757

这将类似于：

1.  //div[@id="top-level-menu-item-3"]/div[@class="filter-label"]
2.  //div[@id="top-level-menu1"] --- 并检查代码以显示：无 ...假设您使用的是 selenium rc

更新：还请务必安装以下 firefox 插件，在站点[https://addons.mozilla.org/en-US/firefox/addon/1095上尝试不同的 xpath 表达式时非常有用](https://addons.mozilla.org/en-US/firefox/addon/1095)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-29T18:54:08.383

附带说明：如果可能，尽量避免在 Selenium 中使用 xpath 定位器。如果您有一个较长的 xpath 表达式，与使用其唯一 ID 识别它相比，Selenium 查找元素的速度可能会慢 20 倍。当然，有时除了使用 xpath 之外别无他法。但是，当您使用它时，请尽量减少 '//' 表达式 - 这是一个真正的性能杀手。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-27T00:12:23.807

如果您刚开始使用 Selenium，请下载 Firefox 的[selenium 插件](https://addons.mozilla.org/en-US/firefox/addon/2079)。当您单击 DOM 元素时，Selenium 会向您显示访问它的 xpath。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-08-05T05:19:16.030

我目前正在开发一个开源库，用于通过流畅的 .Net API 生成 xpath 表达式。这个想法是能够生成基于 xpath 的 selenium 定位器，而无需知道 xpath。

以下是如何在您的情况下使用该库的示例：

XPathFinder.Find.Tag("div").With.Attribute("id", "top-level-menu-item-3").And.Child("div").With.Attribute("class", "过滤标签").ToXPathExpression();

这将产生以下 xpath：“//div[@id='top-level-menu-item-3']/div[@class='filter-label']”

[在http://code.google.com/p/xpathitup/](http://code.google.com/p/xpathitup/)上查看

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-04-27T05:33:26.203

You can use firepath that can be installed over firebug(both firefox plugin). When you get a xpath, dont forget to append `//` before using it. Either in code or in selenium IDE. You are not appending it thats why its unusable. There are two types of xpath absolute and relative. If you use absolute then it will take care of dynamic ids. But if you use relative it will break with each run.

# iphone - iphone日历示例

> ID：687959
> 
> 赞同：0
> 
> 时间：2009-03-26T23:37:30.973
> 
> 标签：iphone, calendar

我想要一个 iphone 应用程序......我希望能够拥有某种日历，您可以在其中选择任何一天并填写信息（并将其保存在该日期下）我知道我需要数据库，但我我不确定我该怎么做？计划是使用日期作为主键，但我有点困惑如何让它工作？任何指针？谢谢你

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-18T01:47:21.770

iPhone SDK 允许您使用 SQLite 作为数据库；这为您提供了一个相当强大的数据库，对于您所描述的应用程序来说应该绰绰有余。

[此链接](http://dblog.com.au/iphone-development-tutorials/iphone-sdk-tutorial-reading-data-from-a-sqlite-database/)将带您到一个相当不错的教程，将 SQLite 数据库添加到 iPhone 应用程序。

# objective-c - 我需要释放使用@“...”生成的 NSString 吗？

> ID：687962
> 
> 赞同：17
> 
> 时间：2009-03-26T23:39:14.837
> 
> 标签：objective-c

如果我使用下面的代码创建一个 NSString，我需要释放 someString 吗？

```
NSString *someString = @"somestring"; 
```

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-26T23:52:30.377

不，它是一个编译时常量字符串对象，所以它不需要释放。这是 char *c = "hello world" 的道德等价物——字符串 hello world 在全局数据中，并且您将此数据的地址分配给指针 c。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2010-09-02T21:25:35.960

`alloc`如果您通过包含、`retain`或`copy`或以`new`(NARC = "narc")开头的方法调用创建了一个对象，那么*您应对`releasing`该对象*负责。如果不是这种情况，那么您可以忽略该对象。

所以在字符串的情况下：

```
NSString * myString = @"This is a string"; 
```

我没有看到对 NARC 方法的调用，因此您不负责发布它。真的就是这么简单。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-27T06:04:08.360

不，因为它是一个编译时常量字符串，你不需要释放它。事实上，这样做很可能会导致运行时错误。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-09-02T20:56:41.530

我检查了[这种情况](http://developer.apple.com/safari/articles/creatingrestfulclients.html)与`NSString *someThing = @"someThing";` 他们应该释放 urlString 不同，因为

```
[[NSString alloc] initWithFormat:@"%@%@", baseURLString, queryTerm]; 
```

无论你在哪里使用 alloc/init，你都会释放它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-02-24T14:37:11.137

[因此，请在以下链接](http://developer.apple.com/safari/articles/creatingrestfulclients.html)中查看 Apple 在“使用 POST 请求插入数据”部分下的操作：

我看到了`[urlString release];`，为什么？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-11-22T03:44:26.197

如果它是编译时常量字符串，则也不需要保留它。这是正确的吗？

# .net - 如何从 LINQ-to-SQL 或 SQL Server 中获取存储过程错误的完整错误信息？

> ID：687964
> 
> 赞同：0
> 
> 时间：2009-03-26T23:41:28.810
> 
> 标签：.net, sql-server, linq, linq-to-sql, stored-procedures

我正在通过 LINQ-to-SQL 调用存储过程（是的，我知道它已被弃用）。我收到一个错误，但 IExecuteResult 似乎只能为我提供一个数字，当我想要完整的字符串错误描述时（就像你在 SQL Management Studio 中手动执行 SQL 时会得到的一样）。或者，在某个地方我可以找到记录的这些信息吗？我查看了数据库中的管理/日志内容，它似乎只保存登录和同步信息。

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T23:57:21.923

其中一些错误可能已记录到 SQL Server 日志中。对于其余部分，您可能必须使用 SQL Profiler 并打开显示错误和异常的模板之一。

或者，如果您可以重现该错误，您可以编写一些 ADO.NET 代码以使用相同的参数执行相同的 SP，然后捕获产生的 SqlException。它将包含您可能想要的所有错误详细信息，包括一个错误列表（如果有多个错误）。您还可以捕获可能返回的信息消息（PRINT 语句等）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T00:15:05.533

我叫错树了。SP 没有返回任何东西 :) 感谢分析器上的提示，我以前从未看过它！

# linq-to-sql - 需要一些 groupby Linq2Sql 帮助，请

> ID：687968
> 
> 赞同：0
> 
> 时间：2009-03-26T23:43:16.513
> 
> 标签：linq-to-sql

我需要`Products`按天、周、月和年显示我们销售的所有历史记录。该数据将被发送到谷歌图表 API 以显示结果的折线图。

因此，如果我有一个名为的表`Products`，它看起来像：-

### 产品

```
ProductID INT
DateCreated DATETIMEOFFSET 
```

并且用户要求查看 ProductID 1 的历史记录。我怎样才能检索到这个？例如输出。

### 图 1（日期与销售数量）

```
Monday 1st Dec: 0
Tuesday 2nd Dec: 3
Wed 3rd Dec: 1 
```

### 图 2（周数与销售数）

```
Week 49 2008: 21
Week 50 2008: 11
Week 51 2008: 45
Week 52 2008: 0 
```

### 图 3（月数与销售数）

```
Dec 08: 102
Jan 09: 23 
```

我不确定“按天”是否可以完成......或其中任何一个。

干杯:)

## 更新 1：让它的一部分工作......

花了一点时间后，我得到了第一个工作......但仍然需要其他两个的帮助，并使其成为一个查询的一部分......

```
from p in Products
where p.ProductId == 69
group p.DateCreated by p.DateCreated.Date into grouping
orderby grouping.Key
select new { Date = grouping.Key, Count = grouping.Count() } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T00:11:01.173

```
var data = from p in ctx.Products
           where p.ProductID == *productId*
           group p by p.DateCreated.DayOfWeek into groupedProducts
           select new { DayOfWeek = groupedProducts.Key, Count = groupedProcuts.Count() }; 
```

未经测试，我认为这可能对您有用

每年做这样的事情：

```
var data = from p in ctx.Products
           where p.ProductID == *productId*
           group p by n.CreateDate.Year into gn
           select new {
            Count = from a in gn
                 group a by a.CreateDate.DayOfYear into aa
                 select new { Count = aa.Count(), Key = new DateTime(gn.Key , 1, 1).AddDays(aa.Key) }
           }; 
```

（对不起变量名：P）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T23:55:00.697

我不知道如何使用 LINQ 表达式，但您可以使用 PIVOT 运算符编写存储过程。请参阅[使用 PIVOT 和 UNPIVOT](http://technet.microsoft.com/en-us/library/ms177410.aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T00:28:23.380

使用 DateTime.Date、DateTime.Month 和 DateTime.Year。但是，LINQ-to-SQL 中有一个错误，有时会将这些错误转换为无效的 SQL。作为一种解决方法，您可以按“1980-01-01”中的 SqlMethods.DateDiffDay、SqlMethods.DateDiffMonth 和 SqlMethods.DateDiffYear 分组。

一周的部分并不那么容易。一周的开始取决于 Sql Server 设置，因此它不可靠。或者，您可以使用 SqlMethods.DateDiffDay 从某个日期开始您的情况，并将日差除以 7。如果您需要给定年份的周数，您应该计算最近一周开始日的日差，即小于或等于年初。

# eclipse - 监控 Eclipse 插件堆大小*以编程方式*

> ID：687971
> 
> 赞同：2
> 
> 时间：2009-03-26T23:45:11.580
> 
> 标签：eclipse, plugins, size, heap-memory

我知道我们可以*手动*监控堆大小，

```
"Show heap status" under Window -> Preferences -> General 
```

那么有没有说自动抓取我的eclipse插件中使用的最高内存？这对我来说很方便，因为我的插件可以运行很长时间，手动监控是不可行的。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T14:10:10.253

您在这里有一个[简单的堆大小监视器](http://www.blognote-info.com/index.php?2007/06/14/602-simple-heap-size-monitor)；

```
long total = Runtime.getRuntime().totalMemory();
long free = Runtime.getRuntime().freeMemory(); 
```

在线程中启动并在文件中记录总内存和可用内存。

如果你将它封装在一个 Eclipse 插件中，你可以启动一个自定义的 Eclipse，默认激活它并记录你需要的东西。

* * *

另一种（更简单的）技术是将一个 JConsole 附加到您的 Eclipse 会话，该[JConsole](http://www.oracle.com/technetwork/articles/java/jconsole-1564139.html)配置为将其[监视](https://web.archive.org/web/1/http://blogs.techrepublic%2ecom%2ecom/programming-and-development/?p=678)的内容记录到文件中。

![www.oracle.com/ocom/groups/public/@otn/documents/digitalasset/1564119.jpg 上的内存不足检测](https://i.stack.imgur.com/onN2U.jpg)

[JVMStat](http://www.oracle.com/technetwork/java/jvmstat-142257.html)（尤其是[jstat](http://docs.oracle.com/javase/6/docs/technotes/tools/share/jstat.html)）也可以是一个很好的解决方案。

# sql - 组合两个 MySQL 查询（一个选择另一个的内容）

> ID：687979
> 
> 赞同：1
> 
> 时间：2009-03-26T23:49:12.380
> 
> 标签：sql, mysql

我将如何结合以下两个查询来产生两者的组合？

```
SELECT * 
FROM post_attributes 
WHERE name IN ('title', 'body');

SELECT id, url, created_at, name, value 
FROM posts, post_attributes 
WHERE posts.id = post_attributes.post_id
ORDER BY id; 
```

想法是从博客引擎 Chyrp 中提取帖子编号、网址、创建时间、博客帖子的标题和正文，但忽略存储在同一数据库中的其他数据。

我在想我正在以错误的方式解决这个问题。会有更合适的功能使用吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T23:55:45.407

```
SELECT posts.id, posts.url, posts.created_at, posts.name, posts.value 
  FROM posts, post_attributes 
 WHERE posts.id = post_attributes.post_id
 AND post_attributes.name IN ('title', 'body')
 ORDER BY id; 
```

`post_attributes.*`如果您想要帖子属性中的所有字段，请在末尾添加一个。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T23:55:26.203

您是否正在寻找这个：

```
SELECT id, url, created_at, name, value, post_attributes.*
  FROM posts, post_attributes 
 WHERE posts.id = post_attributes.post_id
   AND name IN ('title', 'body')
 ORDER BY id; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T23:55:36.483

不确定这是否是最有效的，但这应该有效（假设 post_attributes 有一个名为 'value' 的列存储属性值）。

```
SELECT id, url, created_at, name, value, p_title.value, p_body.value
FROM posts p
INNER JOIN post_attributes p_title on p.id = p_title.post_id 
INNER JOIN post_attributes p_body on p.id = p_body.post_id
ORDER BY p.id; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T00:05:09.473

精彩表现：

```
select p.id, pa.title, pa.body, pa.created_at, pa.name, pa.value from post_attributes pa, posts p where p.id = pa.post_id and (pa.name = 'title' or pa.name = 'body') 
```

# database - 创建数据库索引有哪些最佳实践和“经验法则”？

> ID：687986
> 
> 赞同：20
> 
> 时间：2009-03-26T23:55:10.713
> 
> 标签：database, database-design, indexing

我有一个应用程序，它循环遍历数据库表中的大量记录，并对该数据库中的记录执行许多 SQL 和 .Net 操作（目前我在 PostgreSQL 上使用 Castle.ActiveRecord）。

我在几个字段上添加了一些基本的 btree 索引，正如您所料，SQL 操作的性能显着提高。想要充分利用 dbms 性能，我想对我应该在所有项目中索引的内容做出一些更好的选择。

我知道在执行插入时会降低性能（因为数据库需要更新索引以及数据），但是在创建数据库索引时我应该考虑哪些建议和最佳实践？如何最好地为一组数据库索引选择字段/字段组合（经验法则）？

另外，如何最好地选择将哪个索引用作聚集索引？当涉及到访问方法时，在什么条件下我应该在哈希或 gist 或 gin 上使用 btree（它们到底是什么？）。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-03-27T00:05:11.920

我的一些经验法则：

*   索引所有主键（我认为大多数 RDBMS 在创建表时都会这样做）。
*   索引所有外键列。
*   仅在以下情况下创建更多索引：
    *   查询很慢。
    *   您知道数据量将显着增加。
*   在表中填充大量数据时运行统计信息。

如果查询很慢，请查看执行计划并：

*   如果一个表的查询只使用了几列，将所有这些列放入一个索引中，那么您可以帮助 RDBMS 只使用索引。
*   不要浪费资源索引小表（数百条记录）。
*   按从高基数到低基数的顺序索引多个列。这意味着：首先索引具有更多不同值的列，然后是具有较少不同值的列。
*   如果一个查询需要访问超过 10% 的数据，那么完全扫描通常比索引更好。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-26T23:59:56.567

这是一个稍微简单的概述：由于索引的存在，确实存在数据修改的开销，但您应该考虑对数据的相对读取和写入次数。一般来说，读取次数远高于写入次数，在定义索引策略时应该考虑到这一点。

当谈到索引哪些列时，我一直认为设计人员应该对业务有足够的了解，以便能够很好地初步了解哪些列可能会受益。除此之外，它实际上归结为程序员的反馈、全面测试和系统监控（最好使用广泛的内部性能指标来捕获长时间运行的操作），

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-27T00:09:39.553

正如@David Aldridge 所提到的，大多数数据库执行的读取操作比写入操作多得多，此外，即使在执行 INSERTS（以确定插入的正确位置）时，通常也会使用适当的索引。

未知生产工作负载下的关键索引通常难以猜测/估计，不应将一组索引视为设置一次就忘记。索引应该随着工作负载的变化而被监控和改变（例如，新的杀手报告）。

没有什么比分析更重要的了；如果您猜测您的索引，您通常会错过真正重要的索引。

作为一般规则，如果我不知道如何查询数据库，那么我将在所有外键上创建索引，在工作负载下配置文件（想想 UAT 版本）并删除那些没有被使用的，以及创建重要的缺少索引。

此外，请确保还创建了计划的索引维护计划。

# build-process - 嵌入式开发/交叉编译的最佳构建系统

> ID：687989
> 
> 赞同：6
> 
> 时间：2009-03-26T23:55:33.597
> 
> 标签：build-process, embedded, makefile, scons, build-system

我现在正在使用 dsPIC 进行一些开发，但我并不完全喜欢 MPLAB。我实际上是在使用带有 makefile 项目的 Visual Studio。目前我正在使用 SCons，它似乎工作得相当好，在找到一个[有用的指南来设置使用备用编译器](http://quirkygba.blogspot.com/2008/10/alternatives-to-make-part-ii.html)之后。尽管如此，我还是忍不住想知道，有没有更好的构建系统呢？还有，有没有更好的方法让 Scons 做到这一点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-27T00:05:13.683

只需使用 vim、makefile 并自己调用 MPLAB 命令行编译器。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-11-08T10:56:39.350

您可以使用很多构建系统：

*   Buildroot [http://www.buildroot.net/](http://www.buildroot.net/)
*   Buildroot-ng [http://wiki.openwrt.org/](http://wiki.openwrt.org/)
*   交叉工具-NG [http://www.crosstool-ng.org/](http://www.crosstool-ng.org/)
*   PTXdist [http://www.ptxdist.org/](http://www.ptxdist.org/)
*   OpenEmbedded [http://www.openembedded.org/](http://www.openembedded.org/)
*   OE-lite [http://oe-lite.org/](http://oe-lite.org/)
*   混淆[https://code.google.com/p/muddle/](https://code.google.com/p/muddle/)
*   Poky [http://pokylinux.org/](http://pokylinux.org/)
*   OpenBricks [http://www.openbricks.org/](http://www.openbricks.org/)
*   Yocto 项目[http://www.yoctoproject.org/](http://www.yoctoproject.org/)
*   Scratchbox [http://www.scratchbox.org/](http://www.scratchbox.org/)
*   从零开始跨 Linux [http://www.cross-lfs.org/](http://www.cross-lfs.org/)
*   原住民 Linux [http://landley.net/aboriginal/](http://landley.net/aboriginal/)

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-03-28T15:38:11.483

进行嵌入式开发的最简单方法是使用您最喜欢的代码编辑器编写代码，然后切换到编译器的 IDE 来构建代码并将其下载到处理器。

很明显，代码编辑器和编译器IDE可能是一回事，就更简单了！

# html - IE6中的2列全高布局

> ID：687992
> 
> 赞同：2
> 
> 时间：2009-03-26T23:55:54.860
> 
> 标签：html, css, layout, internet-explorer-6

所以我试图在 IE6 中复制它：http: [//lynet.ca/~alumb/layout.html](http://lynet.ca/~alumb/layout.html)
它在 FF 和 Chrome 中完美运行，但在 IE6 中失败了。有什么建议么？

这是完整的要求：

```
+-----------------------------+
| NavBar                      |
|-----------------------------|
|Menu | Content               |
|     |                       |
|     |                       |
|     |                       |
|     |                       |
|     |                       |
|     |                       |
+-----------------------------+ 
```

*   NavBar 是 EM 中的设定高度（比如 2em）
*   菜单是 EM 中的设定宽度（例如 10em）并填充到页面底部
*   不应该有全局页面滚动条
*   菜单必须滚动到位并且不覆盖导航栏（如溢出：滚动）
*   content 是一个填充可用空间的 iFrame。
*   布局必须能够适应浏览器

我已经尝试过 css，但它会导致大量 css，我仍然无法让 iframe 正确填充空间。
我已经尝试过表格，但我无法让菜单以正确的方式滚动。
我唯一的解决方案涉及框架，但这并不是我真正想要的路线。

* * *

解决方案：
因此，经过大约 36 个小时的抨击，我终于有了一个解决方案。我可以让它工作的唯一方法是使用基于表格的布局。但是，Firefox 中有一个怪癖导致 height:100% 的计算方式与其他浏览器不同，因此我还必须添加 position:fixed 样式。IE6 大多忽略了这一点，它依赖于基于表格的布局。

最终布局的一个例子可以在这里看到：http: [//lynet.ca/~alumb/working.html](http://lynet.ca/~alumb/working.html)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-27T00:07:23.040

解决方案很简单。使用绝对定位。

```
body {
    margin: 0;
    padding: 0;
    overflow: hidden;
}

#NavBar {
}

#Menu, #Content {
    position: absolute;
    top: 3em;
    bottom: 0;
    overflow: auto;
}

#Menu {
    width: 10em;
}

#Content {
    overflow: hidden;
    left: 10em;           /* #menu.width */
    right: 0;
}

iframe {
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 100%;
} 
```

要让 IE 正常工作，请确保您设置了文档类型。例如，将其插入 HTML 文件的顶部：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd"> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T00:03:35.153

很难用 CSS 混合尺寸，特别是垂直方向。导航栏是 2 ems 高，菜单是 100% - 2ems 高 - 这最后的高度很难用纯 CSS 做。您可能需要使用 JavaScript 计算它。

另一种解决方案是使页面表现得像设计的普通网页一样（所有滚动一体）。这是一个可能有帮助的示例布局：[左菜单布局（em 宽度）](http://matthewjamestaylor.com/blog/ultimate-2-column-left-menu-ems.htm)

# sql - 在 SQL 中存储线程消息列表/树的最佳方法是什么？

> ID：687995
> 
> 赞同：1
> 
> 时间：2009-03-26T23:59:36.053
> 
> 标签：sql

我正在寻找在 SQL 中存储一组“帖子”以及对这些帖子的评论的最佳方式。想象一个类似于 Facebook 上的“墙”的设计，用户可以在他们的墙上写帖子，其他用户可以评论这些帖子。我需要能够显示所有墙贴以及评论。

刚开始的时候，我想出了一个表格，例如：

```
CREATE Table wallposts
(
 id uuid NOT NULL,
 posted timestamp NOT NULL,
 userid uuid NOT NULL,
 posterid uuid NOT NULL,
 parentid uuid NOT NULL,
 comment text NOT NULL
) 
```

id 是唯一的，如果该行是对现有帖子的评论，则 parentid 在原始帖子上将为空，并指向一个 id。插入新数据足够简单且超快。但是，做一个会返回我的选择：

```
POST 1
COMMENT 1
COMMENT 2
POST 2
COMMENT 1
COMMENT 2 
```

无论数据库中存在的行的顺序如何，都被证明是极其困难的。我显然不能只按日期排序，因为有人可能会在帖子 2 发布后对帖子 1 发表评论。如果我执行 LEFT JOIN 以获取所有行上的父帖子，然后首先按该日期排序，所有原始帖子都会组合在一起，因为它们的值为 null。

然后我有了这个想法：

```
CREATE TABLE wallposts
(
 id uuid NOT NULL,
 threadposted timestamp,
 posted timestamp,
 ...
 comment text
) 
```

在原始帖子上，主题发布和发布将是相同的。在评论中，时间戳将是原始帖子的发布时间，而“已发布”将是对该线程的评论发布的时间。现在我可以这样做：

```
select * from wallposts order by threadposted, posted; 
```

这很好用，但有一件事让我很恼火。如果两个人同时创建一个帖子，则两个帖子的评论将被合并在一起，因为它们具有相同的时间戳。我可以使用“滴答声”而不是日期时间，但准确度仍然只有 1/1000 秒。我还可以对 threadposted 和 posted 设置一个独特的约束，这使得插入更加昂贵，但是如果我在一个场中有多个数据库服务器，那么发生冲突的机会仍然存在。无论如何，我几乎要继续这样做，因为发生这种情况的机会非常小，但我想看看我是否可以吃掉我的蛋糕并且仍然拥有它。主要是为了我自己的教育好奇心。

第三种解决方案是以图表的形式存储这些数据。每个节点都有一个 v-left 和 v-right 指针。我可以按“左”排序，它会按照我需要的顺序遍历树。但是，每次有人插入评论时，我都必须重新平衡整个树。如果站点非常繁忙，这将产生大量的行锁定以及各种问题。另外，这有点极端，也会导致复制问题。所以我很快就放弃了这个想法。

我还考虑过只存储原始帖子，然后以二进制形式序列化评论，因为谁在乎个人评论。这将非常快，但是如果用户想要删除他们的评论或在末尾附加新评论，我必须反序列化这些数据，修改结构，然后将其序列化并更新行。如果一群人同时评论同一个帖子，我可能会遇到随机问题。

所以这就是我最终所做的。我查询所有按输入日期排序的帖子。在中间件层，我遍历记录集并创建原始帖子的“堆栈”，堆栈上的每个节点都指向一个链接的评论列表。当我遇到原始帖子时，我将一个新节点推送到堆栈上，当我遇到评论时，我将一个节点添加到链接列表中。我将它组织在内存中，这样我就可以遍历记录集一次并获得 O(n)。在我创建了墙的内存表示之后，我再次遍历这个数据结构并写出 HTML。这很好用，并且具有超快的插入和超快的选择，并且没有奇怪的行锁定问题；但是它在我的表示层上有点重，并且需要我建立用户墙的内存表示来移动东西所以它' s 以正确的顺序。不过，我相信这是迄今为止我发现的最好的方法。

我想我会咨询其他 SQL 专家，看看是否有更好的方法来使用一些奇怪的 JOINS 或 UNIONS 或其他对数百万用户仍然有效的方法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T00:23:26.543

我认为您最好在评论上使用带有“ParentID”的更简单模型以允许嵌套评论。我认为使用日期时间作为键通常不是一个好习惯，尤其是在这种情况下，您实际上并不需要这样做，并且身份 ID 就足够了。这是一个可能有效的基本示例：

```
Post
----
ID (PK)
Timestamp
UserID (FK)
Text 

Comment
-------
ID (PK)
Timestamp
PostID (FK)
ParentCommentID (FK nullable) -- allows for nested comments
Text 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T01:55:05.247

If we stick to your table design … I think you would need some special value in the parentid column to separate original posts from comments (maybe just NULL, if you change definition of that column to nullable). Then, self-join will work. Something like this:

```
SELECT  posts.comment as [Original Post],
comments.comment as Comment 
FROM   wallposts AS posts
LEFT OUTER JOIN wallposts AS comments 
ON posts.id=comments.parentID
WHERE posts.parentID IS NULL
ORDER BY posts.posted, comments.posted 
```

The result set shows Original Post before every comment, and has the right order.

(This was done using SQL Server, so I'm not sure if it works in your environment.)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T00:33:34.567

您应该查看“嵌套集”。它们允许使用单个查询非常轻松地检索层次结构。 [这](http://www.dbazine.com/oracle/or-articles/tropashko4)是一篇关于它们的文章

如果您使用的是 SQL Server 2008，它通过“ [hierarchyID](http://technet.microsoft.com/en-us/library/bb677290.aspx) ”类型内置了对它的支持。

如果您没有内置支持，则插入和更新会更加昂贵和复杂），但查询会更快更容易。

编辑：该死的，错过了你已经知道的部分。（正在通过手机查看）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-27T00:37:24.153

您是否希望人们能够评论其他评论，即树是否具有无限深度？

如果您只想发布帖子然后对这些帖子发表评论，那么您一开始就在正确的路线上，我相信以下 SQL 将满足该要求（未经测试，因此可能是拼写错误）

```
SELECT posts.id,
       posts.posted AS posted_at,
       posts.userid AS posted_by,
       posts.posterid,
       posts.comment AS post_text,
       comments.posted AS commented_at,
       comments.userid AS commented_by,
       comments.comment AS comment_text
FROM   wallposts AS posts
LEFT OUTER JOIN wallposts AS comments ON comments.parent_id = posts.id
ORDER BY posts.posted, comments.posted 
```

这种技术，即自连接，只是使用表别名将表连接到自身，以指定连接。

# jquery - 自动调整大小的动态文本以填充固定大小的容器

> ID：687998
> 
> 赞同：322
> 
> 时间：2009-03-27T00:00:09.373
> 
> 标签：jquery, html, css

我需要将用户输入的文本显示到固定大小的 div 中。我想要的是自动调整字体大小，以便文本尽可能地填充框。

所以 - 如果 div 是 400px x 300px。如果有人输入ABC，那么它的字体真的很大。如果他们输入一个段落，那么它将是一个小字体。

我可能想从最大字体大小开始 - 可能是 32 像素，虽然文本太大而无法容纳容器，但缩小字体大小直到适合。

* * *

## 回答 #1

> 赞同：171
> 
> 时间：2009-03-27T02:52:03.347

感谢[攻击](https://stackoverflow.com/a/688223/662581)。我想使用 jQuery。

您为我指明了正确的方向，这就是我最终得到的结果：

这是插件的链接：[https](https://plugins.jquery.com/textfill/)
://plugins.jquery.com/textfill/ 和源链接：http: [//jquery-textfill.github.io/](http://jquery-textfill.github.io/)

```
;(function($) {
    $.fn.textfill = function(options) {
        var fontSize = options.maxFontPixels;
        var ourText = $('span:visible:first', this);
        var maxHeight = $(this).height();
        var maxWidth = $(this).width();
        var textHeight;
        var textWidth;
        do {
            ourText.css('font-size', fontSize);
            textHeight = ourText.height();
            textWidth = ourText.width();
            fontSize = fontSize - 1;
        } while ((textHeight > maxHeight || textWidth > maxWidth) && fontSize > 3);
        return this;
    }
})(jQuery);

$(document).ready(function() {
    $('.jtextfill').textfill({ maxFontPixels: 36 });
}); 
```

我的html是这样的

```
<div class='jtextfill' style='width:100px;height:50px;'>
    <span>My Text Here</span>
</div> 
```

这是我的第一个 jquery 插件，所以它可能没有它应该的那么好。指针当然是受欢迎的。

* * *

## 回答 #2

> 赞同：53
> 
> 时间：2011-11-01T10:49:05.763

由于性能不佳，我没有发现以前的任何解决方案都足够充分，所以我自己制作了一个使用简单数学而不是循环的解决方案。在所有浏览器中也应该可以正常工作。

根据[这个性能测试用例](http://jsperf.com/jquery-textfill)，它比这里找到的其他解决方案要快得多。

```
(function($) {
    $.fn.textfill = function(maxFontSize) {
        maxFontSize = parseInt(maxFontSize, 10);
        return this.each(function(){
            var ourText = $("span", this),
                parent = ourText.parent(),
                maxHeight = parent.height(),
                maxWidth = parent.width(),
                fontSize = parseInt(ourText.css("fontSize"), 10),
                multiplier = maxWidth/ourText.width(),
                newSize = (fontSize*(multiplier-0.1));
            ourText.css(
                "fontSize", 
                (maxFontSize > 0 && newSize > maxFontSize) ? 
                    maxFontSize : 
                    newSize
            );
        });
    };
})(jQuery); 
```

如果您想贡献我已[将此添加到 Gist](https://gist.github.com/1263939)。

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2009-03-27T01:47:59.380

尽管我很喜欢这个答案偶尔得到的支持（谢谢！），但这确实不是解决这个问题的最佳方法。请在此处查看其他一些精彩的答案，尤其是那些在没有循环的情况下找到解决方案的答案。

* * *

不过，为了参考，这里是我**原来的答案**：

```
<html>
<head>
<style type="text/css">
    #dynamicDiv
    {
    background: #CCCCCC;
    width: 300px;
    height: 100px;
    font-size: 64px;
    overflow: hidden;
    }
</style>

<script type="text/javascript">
    function shrink()
    {
        var textSpan = document.getElementById("dynamicSpan");
        var textDiv = document.getElementById("dynamicDiv");

        textSpan.style.fontSize = 64;

        while(textSpan.offsetHeight > textDiv.offsetHeight)
        {
            textSpan.style.fontSize = parseInt(textSpan.style.fontSize) - 1;
        }
    }
</script>

</head>
<body onload="shrink()">
    <div id="dynamicDiv"><span id="dynamicSpan">DYNAMIC FONT</span></div>
</body>
</html> 
```

* * *

这是一个带有**类**的版本：

```
<html>
<head>
<style type="text/css">
.dynamicDiv
{
    background: #CCCCCC;
    width: 300px;
    height: 100px;
    font-size: 64px;
    overflow: hidden;
}
</style>

<script type="text/javascript">
    function shrink()
    {
        var textDivs = document.getElementsByClassName("dynamicDiv");
        var textDivsLength = textDivs.length;

        // Loop through all of the dynamic divs on the page
        for(var i=0; i<textDivsLength; i++) {

            var textDiv = textDivs[i];

            // Loop through all of the dynamic spans within the div
            var textSpan = textDiv.getElementsByClassName("dynamicSpan")[0];

            // Use the same looping logic as before
            textSpan.style.fontSize = 64;

            while(textSpan.offsetHeight > textDiv.offsetHeight)
            {
                textSpan.style.fontSize = parseInt(textSpan.style.fontSize) - 1;
            }

        }

    }
</script>

</head>
<body onload="shrink()">
    <div class="dynamicDiv"><span class="dynamicSpan">DYNAMIC FONT</span></div>
    <div class="dynamicDiv"><span class="dynamicSpan">ANOTHER DYNAMIC FONT</span></div>
    <div class="dynamicDiv"><span class="dynamicSpan">AND YET ANOTHER DYNAMIC FONT</span></div>
</body>
</html> 
```

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2013-07-02T18:47:52.197

大多数其他答案使用循环来减小字体大小，直到它适合 div，这非常慢，因为每次字体更改大小时页面都需要重新渲染元素。我最终不得不编写自己的算法，使其以一种允许我定期更新其内容而不会冻结用户浏览器的方式执行。我添加了一些其他功能（旋转文本、添加填充）并将其打包为 jQuery 插件，您可以在以下位置获得它：

[https://github.com/DanielHoffmann/jquery-bigtext](https://github.com/DanielHoffmann/jquery-bigtext)

只需调用

```
$("#text").bigText(); 
```

它会很好地适合您的容器。

在这里查看它的实际效果：

[http://danielhoffmann.github.io/jquery-bigtext/](http://danielhoffmann.github.io/jquery-bigtext/)

目前它有一些限制，div 必须具有固定的高度和宽度，并且不支持将文本换行成多行。

我将努力获得一个设置最大字体大小的选项。

编辑：我发现插件还有一些问题，除了标准的盒子模型之外，它不处理其他盒子模型，并且 div 不能有边距或边框。我会努力的。

Edit2：我现在已经解决了这些问题和限制，并添加了更多选项。您可以设置最大字体大小，也可以选择使用宽度、高度或两者来限制字体大小。我将努力接受包装元素中的最大宽度和最大高度值。

Edit3：我已将插件更新到版本 1.2.0。主要清理代码和新选项（verticalAlign、horizo​​ntalAlign、textAlign）并支持 span 标签内的内部元素（如换行符或字体真棒图标。）

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-11-08T14:57:57.477

这是基于 GeekyMonkey 上面发布的内容，并进行了一些修改。

```
; (function($) {
/**
* Resize inner element to fit the outer element
* @author Some modifications by Sandstrom
* @author Code based on earlier works by Russ Painter (WebDesign@GeekyMonkey.com)
* @version 0.2
*/
$.fn.textfill = function(options) {

    options = jQuery.extend({
        maxFontSize: null,
        minFontSize: 8,
        step: 1
    }, options);

    return this.each(function() {

        var innerElements = $(this).children(':visible'),
            fontSize = options.maxFontSize || innerElements.css("font-size"), // use current font-size by default
            maxHeight = $(this).height(),
            maxWidth = $(this).width(),
            innerHeight,
            innerWidth;

        do {

            innerElements.css('font-size', fontSize);

            // use the combined height of all children, eg. multiple <p> elements.
            innerHeight = $.map(innerElements, function(e) {
                return $(e).outerHeight();
            }).reduce(function(p, c) {
                return p + c;
            }, 0);

            innerWidth = innerElements.outerWidth(); // assumes that all inner elements have the same width
            fontSize = fontSize - options.step;

        } while ((innerHeight > maxHeight || innerWidth > maxWidth) && fontSize > options.minFontSize);

    });

};

})(jQuery); 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2015-07-07T21:34:42.107

这是一种改进的循环方法，它使用二进制搜索以尽可能少的步骤找到适合父级的最大可能大小（这比按固定字体大小步进更快、更准确）。该代码还以多种方式进行了性能优化。

默认情况下，将执行 10 个二进制搜索步骤，这将在最佳大小的 0.1% 范围内。您可以改为将 numIter 设置为某个值 N 以达到最佳大小的 1/2^N 以内。

使用 CSS 选择器调用它，例如：`fitToParent('.title-span');`

```
/**
 * Fit all elements matching a given CSS selector to their parent elements'
 * width and height, by adjusting the font-size attribute to be as large as
 * possible. Uses binary search.
 */
var fitToParent = function(selector) {
    var numIter = 10;  // Number of binary search iterations
    var regexp = /\d+(\.\d+)?/;
    var fontSize = function(elem) {
        var match = elem.css('font-size').match(regexp);
        var size = match == null ? 16 : parseFloat(match[0]);
        return isNaN(size) ? 16 : size;
    }
    $(selector).each(function() {
        var elem = $(this);
        var parentWidth = elem.parent().width();
        var parentHeight = elem.parent().height();
        if (elem.width() > parentWidth || elem.height() > parentHeight) {
            var maxSize = fontSize(elem), minSize = 0.1;
            for (var i = 0; i < numIter; i++) {
                var currSize = (minSize + maxSize) / 2;
                elem.css('font-size', currSize);
                if (elem.width() > parentWidth || elem.height() > parentHeight) {
                    maxSize = currSize;
                } else {
                    minSize = currSize;
                }
            }
            elem.css('font-size', minSize);
        }
    });
}; 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2013-11-12T08:19:47.023

我为 AngularJS 创建了一个指令——受到 GeekyMonkey 的回答的极大启发，但没有 jQuery 依赖项。

**演示：** [http ://plnkr.co/edit/8tPCZIjvO3VSApSeTtYr?p=preview](http://plnkr.co/edit/8tPCZIjvO3VSApSeTtYr?p=preview)

**标记**

`<div class="fittext" max-font-size="50" text="Your text goes here..."></div>`

**指示**

```
app.directive('fittext', function() {

  return {
    scope: {
      minFontSize: '@',
      maxFontSize: '@',
      text: '='
    },
    restrict: 'C',
    transclude: true,
    template: '<div ng-transclude class="textContainer" ng-bind="text"></div>',
    controller: function($scope, $element, $attrs) {
      var fontSize = $scope.maxFontSize || 50;
      var minFontSize = $scope.minFontSize || 8;

      // text container
      var textContainer = $element[0].querySelector('.textContainer');

      angular.element(textContainer).css('word-wrap', 'break-word');

      // max dimensions for text container
      var maxHeight = $element[0].offsetHeight;
      var maxWidth = $element[0].offsetWidth;

      var textContainerHeight;
      var textContainerWidth;      

      var resizeText = function(){
        do {
          // set new font size and determine resulting dimensions
          textContainer.style.fontSize = fontSize + 'px';
          textContainerHeight = textContainer.offsetHeight;
          textContainerWidth = textContainer.offsetWidth;

          // shrink font size
          var ratioHeight = Math.floor(textContainerHeight / maxHeight);
          var ratioWidth = Math.floor(textContainerWidth / maxWidth);
          var shrinkFactor = ratioHeight > ratioWidth ? ratioHeight : ratioWidth;
          fontSize -= shrinkFactor;

        } while ((textContainerHeight > maxHeight || textContainerWidth > maxWidth) && fontSize > minFontSize);        
      };

      // watch for changes to text
      $scope.$watch('text', function(newText, oldText){
        if(newText === undefined) return;

        // text was deleted
        if(oldText !== undefined && newText.length < oldText.length){
          fontSize = $scope.maxFontSize;
        }
        resizeText();
      });
    }
  };
}); 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2012-10-24T10:15:16.403

我从 Marcus Ekwall 复制了上面的脚本：[https](https://gist.github.com/3945316) : //gist.github.com/3945316 并根据我的喜好对其进行了调整，现在它会在调整窗口大小时触发，以便孩子始终适合其容器。我已经粘贴了下面的脚本以供参考。

```
(function($) {
    $.fn.textfill = function(maxFontSize) {
        maxFontSize = parseInt(maxFontSize, 10);
        return this.each(function(){
            var ourText = $("span", this);
            function resizefont(){
                var parent = ourText.parent(),
                maxHeight = parent.height(),
                maxWidth = parent.width(),
                fontSize = parseInt(ourText.css("fontSize"), 10),
                multiplier = maxWidth/ourText.width(),
                newSize = (fontSize*(multiplier));
                ourText.css("fontSize", maxFontSize > 0 && newSize > maxFontSize ? maxFontSize : newSize );
            }
            $(window).resize(function(){
                resizefont();
            });
            resizefont();
        });
    };
})(jQuery); 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2016-02-15T23:22:41.460

这是我对OP答案的修改。

简而言之，许多试图对此进行优化的人抱怨正在使用循环。是的，虽然循环可能很慢，但其他方法可能不准确。

因此，我的方法使用**二进制搜索**来找到最佳字体大小：

```
$.fn.textfill = function()
{
    var self = $(this);
    var parent = self.parent();

    var attr = self.attr('max-font-size');
    var maxFontSize = parseInt(attr, 10);
    var unit = attr.replace(maxFontSize, "");

    var minFontSize = parseInt(self.attr('min-font-size').replace(unit, ""));
    var fontSize = (maxFontSize + minFontSize) / 2;

    var maxHeight = parent.height();
    var maxWidth = parent.width();

    var textHeight;
    var textWidth;

    do
    {
        self.css('font-size', fontSize + unit);

        textHeight = self.height();
        textWidth = self.width();

        if(textHeight > maxHeight || textWidth > maxWidth)
        {
            maxFontSize = fontSize;
            fontSize = Math.floor((fontSize + minFontSize) / 2);
        }
        else if(textHeight < maxHeight || textWidth < maxWidth)
        {
            minFontSize = fontSize;
            fontSize = Math.floor((fontSize + maxFontSize) / 2);
        }
        else
            break;

    }
    while(maxFontSize - minFontSize > 1 && maxFontSize > minFontSize);

    self.css('font-size', fontSize + unit);

    return this;
}

function resizeText()
{
  $(".textfill").textfill();
}

$(document).ready(resizeText);
$(window).resize(resizeText); 
```

这也允许元素指定最小和最大字体：

```
<div class="container">
    <div class="textfill" min-font-size="10px" max-font-size="72px">
        Text that will fill the container, to the best of its abilities, and it will <i>never</i> have overflow.
    </div>
</div> 
```

此外，该算法是无单位的。您可以指定`em`, `rem`,`%`等，它将使用它作为最终结果。

这是小提琴：[https ://jsfiddle.net/fkhqhnqe/1/](https://jsfiddle.net/fkhqhnqe/1/)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-03-21T15:12:25.390

我的网站遇到了完全相同的问题。我有一个显示在投影仪、墙壁、大屏幕上的页面..

由于我不知道我的字体的最大大小，我重新使用了@GeekMonkey 上面的插件，但增加了 fontsize ：

```
$.fn.textfill = function(options) {
        var defaults = { innerTag: 'span', padding: '10' };
        var Opts = jQuery.extend(defaults, options);

        return this.each(function() {
            var ourText = $(Opts.innerTag + ':visible:first', this);
            var fontSize = parseFloat(ourText.css('font-size'),10);
            var doNotTrepass = $(this).height()-2*Opts.padding ;
            var textHeight;

            do {
                ourText.css('font-size', fontSize);
                textHeight = ourText.height();
                fontSize = fontSize + 2;
            } while (textHeight < doNotTrepass );
        });
    }; 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-09-22T00:37:33.413

这是接受的答案的一个版本，它也可以采用 minFontSize 参数。

```
(function($) {
    /**
    * Resizes an inner element's font so that the inner element completely fills the outer element.
    * @author Russ Painter WebDesign@GeekyMonkey.com
    * @author Blake Robertson 
    * @version 0.2 -- Modified it so a min font parameter can be specified.
    *    
    * @param {Object} Options which are maxFontPixels (default=40), innerTag (default='span')
    * @return All outer elements processed
    * @example <div class='mybigdiv filltext'><span>My Text To Resize</span></div>
    */
    $.fn.textfill = function(options) {
        var defaults = {
            maxFontPixels: 40,
            minFontPixels: 10,
            innerTag: 'span'
        };
        var Opts = jQuery.extend(defaults, options);
        return this.each(function() {
            var fontSize = Opts.maxFontPixels;
            var ourText = $(Opts.innerTag + ':visible:first', this);
            var maxHeight = $(this).height();
            var maxWidth = $(this).width();
            var textHeight;
            var textWidth;
            do {
                ourText.css('font-size', fontSize);
                textHeight = ourText.height();
                textWidth = ourText.width();
                fontSize = fontSize - 1;
            } while ((textHeight > maxHeight || textWidth > maxWidth) && fontSize > Opts.minFontPixels);
        });
    };
})(jQuery); 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-07-13T20:16:20.233

提出的迭代解决方案可以在两个方面显着加快：

1) 将字体大小乘以某个常数，而不是加或减 1。

2）首先，使用课程常数为零，例如，每个循环的大小加倍。然后，大致了解从哪里开始，通过更精细的调整来做同样的事情，比如乘以 1.1。虽然完美主义者可能想要理想字体的确切整数像素大小，但大多数观察者并没有注意到 100 和 110 像素之间的差异。如果您是完美主义者，请重复第三次，并进行更精细的调整。

与其编写一个特定的例程或插件来回答确切的问题，我只是依靠基本思想并编写代码的变体来处理各种布局问题，而不仅仅是文本，包括拟合 div、span、图像等。 ..按宽度，高度，面积，......在一个容器内，匹配另一个元素......

这是一个例子：

```
 var                           nWindowH_px             = jQuery(window).height();
  var                           nWas                    = 0;
  var                           nTry                    = 5;

  do{
   nWas = nTry;
   nTry *= 2;
   jQuery('#divTitle').css('font-size' ,nTry +'px');
  }while( jQuery('#divTitle').height() < nWindowH_px );

  nTry = nWas;

  do{
   nWas = nTry;
   nTry = Math.floor( nTry * 1.1 );
   jQuery('#divTitle').css('font-size' ,nTry +'px');
  }while( nWas != nTry   &&   jQuery('#divTitle').height() < nWindowH_px );

  jQuery('#divTitle').css('font-size' ,nWas +'px'); 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-09-20T08:07:44.593

您可以使用**[FitText.js](http://fittextjs.com/)**（[github 页面](https://github.com/davatron5000/FitText.js)）来解决这个问题。与 TextFill 相比，它确实小而高效。TextFill 使用昂贵的 while 循环，而 FitText 不使用。

FitText 也更灵活（我在具有非常特殊要求的项目中使用它，并且像冠军一样工作！）。

HTML：

```
<div class="container">
  <h1 id="responsive_headline">Your fancy title</h1>
</div>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<script src="jquery.fittext.js"></script>
<script>
  jQuery("#responsive_headline").fitText();
</script> 
```

您还可以为其设置选项：

```
<script>
  jQuery("#responsive_headline").fitText(1, { minFontSize: '30px', maxFontSize: '90px'});
</script> 
```

CSS：

```
#responsive_headline {
   width: 100%;
   display: block;
} 
```

如果您需要，FitText 也有一个[非 jQuery 版本](https://github.com/adactio/FitText.js)。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2014-01-21T19:05:05.740

编辑：此代码用于在 HTML5 视频顶部显示注释。它会在调整视频大小时即时更改字体大小（当调整浏览器窗口大小时）。注释已连接到视频（就像 YouTube 上的注释一样），这就是代码使用实例而不是 DOM 句柄的原因直接地。

根据要求，我将提供一些用于实现此目的的代码。（HTML5 视频上的文本框。）代码是很久以前写的，坦率地说，我认为它相当混乱。由于问题已经得到解答，并且很久以前就已经接受了答案，所以我不会费心重写它。但是，如果有人想稍微简化一下，欢迎您！

```
// Figure out the text size:
var text = val['text'];
var letters = text.length;
var findMultiplier = function(x) { // g(x)
    /* By analysing some functions with regression, the resulting function that
     gives the best font size with respect to the number of letters and the size
     of the note is:
     g(x) = 8.3 - 2.75x^0.15 [1 < x < 255]
     f(x) = g(letters) * (x / 1000)^0.5
     Font size = f(size)
     */
    return 8.3 - 2.75 * Math.pow(x, 0.15);
};

var findFontSize = function(x) { // f(x)
    return findMultiplier(letters) * Math.pow(x / 1000, 0.5);
};

val.setFontSizeListener = function() {
    p.style.fontSize = '1px'; // So the text should not overflow the box when measuring.
    var noteStyle = window.getComputedStyle(table);
    var width = noteStyle.getPropertyValue('width');
    var height = noteStyle.getPropertyValue('height');
    var size = width.substring(0, width.length - 2) * height.substring(0, height.length - 2);
    p.style.fontSize = findFontSize(size) + 'px';
};
window.addEventListener('resize', val.setFontSizeListener); 
```

您可能需要将这些数字从 font-family 调整为 font-family。一个很好的方法是下载一个名为 GeoGebra 的免费图形可视化工具。更改文本的长度和框的大小。然后你手动设置大小。将手动结果绘制到坐标系中。然后输入我在此处发布的两个等式并调整数字，直到“我的”图形适合您自己手动绘制的点。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2018-12-11T09:34:35.380

只是想为 contenteditables 添加我的版本。

```
$.fn.fitInText = function() {
  this.each(function() {

    let textbox = $(this);
    let textboxNode = this;

    let mutationCallback = function(mutationsList, observer) {
      if (observer) {
        observer.disconnect();
      }
      textbox.css('font-size', 0);
      let desiredHeight = textbox.css('height');
      for (i = 12; i < 50; i++) {
        textbox.css('font-size', i);
        if (textbox.css('height') > desiredHeight) {
          textbox.css('font-size', i - 1);
          break;
        }
      }

      var config = {
        attributes: true,
        childList: true,
        subtree: true,
        characterData: true
      };
      let newobserver = new MutationObserver(mutationCallback);
      newobserver.observe(textboxNode, config);

    };

    mutationCallback();

  });
}

$('#inner').fitInText();
```

```
#outer {
  display: table;
  width: 100%;
}

#inner {
  border: 1px solid black;
  height: 170px;
  text-align: center;
  display: table-cell;
  vertical-align: middle;
  word-break: break-all;
}
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<div id="outer">
  <div id="inner" contenteditable=true>
    TEST
  </div>
</div>
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2019-10-25T19:56:26.173

这是我创建的最优雅的解决方案。它使用二进制搜索，进行 10 次迭代。天真的方法是做一个while循环并将字体大小增加1，直到元素开始溢出。**您可以使用element.offsetHeight**和**element.scrollHeight**确定元素何时开始溢出。如果scrollHeight 大于offsetHeight，则字体大小太大。

二进制搜索是一个更好的算法。它还受到您要执行的迭代次数的限制。只需调用 flexFont 并插入 div id，它就会在*8px*和*96px*之间调整字体大小。

我花了一些时间研究这个主题并尝试了不同的库，但最终我认为这是最简单、最直接的解决方案，并且可以实际工作。

请注意，如果您愿意，您可以更改为使用`offsetWidth`and `scrollWidth`，或将两者都添加到此函数中。

```
// Set the font size using overflow property and div height
function flexFont(divId) {
    var content = document.getElementById(divId);
    content.style.fontSize = determineMaxFontSize(content, 8, 96, 10, 0) + "px";
};

// Use binary search to determine font size
function determineMaxFontSize(content, min, max, iterations, lastSizeNotTooBig) {
    if (iterations === 0) {
        return lastSizeNotTooBig;
    }
    var obj = fontSizeTooBig(content, min, lastSizeNotTooBig);

    // if `min` too big {....min.....max.....}
    // search between (avg(min, lastSizeTooSmall)), min)
    // if `min` too small, search between (avg(min,max), max)
    // keep track of iterations, and the last font size that was not too big
    if (obj.tooBig) {
        (lastSizeTooSmall === -1) ?
            determineMaxFontSize(content, min / 2, min, iterations - 1, obj.lastSizeNotTooBig, lastSizeTooSmall) :
                determineMaxFontSize(content, (min + lastSizeTooSmall) / 2, min, iterations - 1, obj.lastSizeNotTooBig, lastSizeTooSmall);

    } else {
        determineMaxFontSize(content, (min + max) / 2, max, iterations - 1, obj.lastSizeNotTooBig, min);
    }
}

// determine if fontSize is too big based on scrollHeight and offsetHeight, 
// keep track of last value that did not overflow
function fontSizeTooBig(content, fontSize, lastSizeNotTooBig) {
    content.style.fontSize = fontSize + "px";
    var tooBig = content.scrollHeight > content.offsetHeight;
    return {
        tooBig: tooBig,
        lastSizeNotTooBig: tooBig ? lastSizeNotTooBig : fontSize
    };
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2017-02-23T10:19:48.047

我选择了 geekMonkey 解决方案，但它太慢了。他所做的是将字体大小调整为最大（maxFontPixels），然后检查它是否适合容器。否则它将字体大小减小 1px 并再次检查。为什么不简单地检查前一个容器的高度并提交该值？（是的，我知道为什么，但我现在提出了一个解决方案，它只适用于高度并且还有一个最小/最大选项）

这是一个更快的解决方案：

```
var index_letters_resize;
(index_letters_resize = function() {
  $(".textfill").each(function() {
    var
      $this = $(this),
      height = Math.min( Math.max( parseInt( $this.height() ), 40 ), 150 );
    $this.find(".size-adjust").css({
      fontSize: height
    });
  });
}).call();

$(window).on('resize', function() {
  index_letters_resize();
); 
```

这将是 HTML：

```
<div class="textfill">
  <span class="size-adjust">adjusted element</span>
  other variable stuff that defines the container size
</div> 
```

同样：此解决方案仅检查容器的高度。这就是为什么这个函数不需要检查元素是否适合里面。但我也实现了一个最小值/最大值（40min，150max），所以对我来说这非常好（并且也适用于窗口调整大小）。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2017-06-11T01:34:10.830

我遇到了同样的问题，解决方案基本上是使用 javascript 来控制字体大小。在 codepen 上查看此示例：

[https://codepen.io/ThePostModernPlatonic/pen/BZKzVR](https://codepen.io/ThePostModernPlatonic/pen/BZKzVR)

此示例仅用于高度，也许您需要添加一些关于宽度的 if。

> 尝试调整它的大小

```
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Documento sem título</title>
<style>
</style>
</head>
<body>
<div style="height:100vh;background-color: tomato;" id="wrap">        
  <h1 class="quote" id="quotee" style="padding-top: 56px">Because too much "light" doesn't <em>illuminate</em> our paths and warm us, it only blinds and burns us.</h1>
</div>
</body>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
<script>
  var multiplexador = 3;
  initial_div_height = document.getElementById ("wrap").scrollHeight;
  setInterval(function(){ 
    var div = document.getElementById ("wrap");
    var frase = document.getElementById ("quotee");
    var message = "WIDTH div " + div.scrollWidth + "px. "+ frase.scrollWidth+"px. frase \n";
    message += "HEIGHT div " + initial_div_height + "px. "+ frase.scrollHeight+"px. frase \n";           
    if (frase.scrollHeight < initial_div_height - 30){
      multiplexador += 1;
      $("#quotee").css("font-size", multiplexador); 
    }
    console.log(message);          
  }, 10);
</script>
</html> 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2018-04-16T08:35:26.827

我喜欢

```
let name = "Making statements based on opinion; back them up with references or personal experience."
let originFontSize = 15;
let maxDisplayCharInLine = 50; 
let fontSize = Math.min(originFontSize, originFontSize / (name.length / maxDisplayCharInLine)); 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2018-12-27T12:14:57.707

我找到了一种方法来防止使用循环来缩小文本。它通过将字体大小乘以容器宽度和内容宽度之间的比率来调整字体大小。所以如果容器的宽度是内容的 1/3，那么 font-size 会减少 1/3 并且会变成容器的宽度。为了扩大规模，我使用了一个 while 循环，直到内容大于容器。

```
function fitText(outputSelector){
    // max font size in pixels
    const maxFontSize = 50;
    // get the DOM output element by its selector
    let outputDiv = document.getElementById(outputSelector);
    // get element's width
    let width = outputDiv.clientWidth;
    // get content's width
    let contentWidth = outputDiv.scrollWidth;
    // get fontSize
    let fontSize = parseInt(window.getComputedStyle(outputDiv, null).getPropertyValue('font-size'),10);
    // if content's width is bigger than elements width - overflow
    if (contentWidth > width){
        fontSize = Math.ceil(fontSize * width/contentWidth,10);
        fontSize =  fontSize > maxFontSize  ? fontSize = maxFontSize  : fontSize - 1;
        outputDiv.style.fontSize = fontSize+'px';   
    }else{
        // content is smaller than width... let's resize in 1 px until it fits 
        while (contentWidth === width && fontSize < maxFontSize){
            fontSize = Math.ceil(fontSize) + 1;
            fontSize = fontSize > maxFontSize  ? fontSize = maxFontSize  : fontSize;
            outputDiv.style.fontSize = fontSize+'px';   
            // update widths
            width = outputDiv.clientWidth;
            contentWidth = outputDiv.scrollWidth;
            if (contentWidth > width){
                outputDiv.style.fontSize = fontSize-1+'px'; 
            }
        }
    }
} 
```

这段代码是我上传到 Github [https://github.com/ricardobrg/fitText/的测试的一部分](https://github.com/ricardobrg/fitText/)

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2014-06-04T01:01:30.903

这是此解决方案的另一个版本：

```
shrinkTextInElement : function(el, minFontSizePx) {
    if(!minFontSizePx) {
        minFontSizePx = 5;
    }
    while(el.offsetWidth > el.parentNode.offsetWidth || el.offsetHeight > el.parentNode.offsetHeight) {

        var newFontSize = (parseInt(el.style.fontSize, 10) - 3);
        if(newFontSize <= minFontSizePx) {
            break;
        }

        el.style.fontSize = newFontSize + "px";
    }
} 
`````**********