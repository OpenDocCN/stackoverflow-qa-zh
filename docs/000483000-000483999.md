# StackOverflow 问答 000483000-000483999

# c# - 佳能远程 SDK 替代方案？

> ID：483000
> 
> 赞同：2
> 
> 时间：2009-01-27T11:04:51.790
> 
> 标签：c#, camera, edsdk

有其他供应商的解决方案吗？（使用另一台相机？）佳能不再支持 SDK。

解决方案应包含实时预览、缩放和可配置的 Flash。一个 c# 接口就可以了。

我知道，WIA 接口，但它不够强大。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T14:39:02.420

你看过[gphoto2](http://www.gphoto.org/)吗？这仅在类 Unix 系统（Linux、BSD 和可能的 MacOS）下运行，因此在 Windows 下可能无济于事。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-28T22:31:32.060

越来越多的佳能 SDK 用户`http://canonsdk.com` ^(可以) 帮助您解决佳能相机问题并克服佳能缺乏支持的问题。

¹已经不存在了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-25T15:58:43.077

Canon has stated that they will no longer support the powershot sdk. But the EOS SDK will continue to be supported. You will need to buy EOS Cameras, but there are some in the same price range as the Gx powershots.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-03-14T01:54:42.220

另一个答案提到 gphoto2 但是如果您的相机是最近的佳能 PowerShot 型号，这将不起作用。

此页面列出了 gphoto2 支持和不支持远程控制/捕获的相机列表：[http ://www.gphoto.org/doc/remote/](http://www.gphoto.org/doc/remote/)

以下是佳能与其 SDK 兼容性的完整相机列表：

[http://www.usa.canon.com/cusa/consumer/standard_display/sdk_homepage](http://www.usa.canon.com/cusa/consumer/standard_display/sdk_homepage)

如问题所述，佳能已决定停止支持 SDK，因此他们较新的 PowerShot 相机将无法工作。对于最近的一个项目，我在 eBay 上以合理的价格找到了一个较旧的受支持的 (S70)。

# wpf - ListView 与 ListViewItem 的“IsSelected”属性绑定

> ID：483005
> 
> 赞同：6
> 
> 时间：2009-01-27T11:08:37.197
> 
> 标签：wpf, data-binding, listview

我有以下课程

```
 public abstract class AbsTrinityEvent
   {
    public event IsSelected OnSelectedEvent; 

    bool _IsSelected;
    ITrinityEvent _objTrinityEvent;
    public AbsTrinityEvent(ITrinityEvent objTrinityEvent)
    {
        _objTrinityEvent = objTrinityEvent;
    }

    public ITrinityEvent TrinityEventObj
    {

        set
        {
            _objTrinityEvent = value;
        }

        get
        {
            return _objTrinityEvent;
        }
    }

    public int EventRefID
    {
        get
        {
            return _objTrinityEvent.EventRefID;
        }
    }

    public string EventDescription
    {
        get
        {
            return _objTrinityEvent.EventDescription;
        }
    }

    public string EventDateTime
    {
        get
        {
            return _objTrinityEvent.EventDateTime;
        }
    }

    public string Site
    {
        get
        {
            return _objTrinityEvent.Site;
        }
    }

    public int Priority
    {
        get
        {
            return _objTrinityEvent.Priority;
        }
    }

    public string DeviceName
    {
        get
        {
            return _objTrinityEvent.DeviceName;
        }
    }

    public bool IsAlarm
    {
        get
        {
            return _objTrinityEvent.IsAlarm;
        }
    }

    public string OperatorName
    {
        get
        {
            return _objTrinityEvent.OperatorName;
        }
    }

    public int SiteID
    {
        get
        {
            return _objTrinityEvent.SiteID;
        }
    }

    public int EventSrcInstanceID
    {
        get
        {
            return _objTrinityEvent.EventSrcInstanceID;
        }
    }

    public int EventSrcInstanceMasterDeviceID
    {
        get
        {
            return _objTrinityEvent.EventSrcInstanceMasterDeviceID;
        }
    }

    public bool IsSelected
    {
        set
        {
            _IsSelected = value;
            ItemSelectedEventArgs obj = new ItemSelectedEventArgs(_objTrinityEvent);
            OnSelectedEvent(this, obj);                                        
        }
        get
        {
            return _IsSelected;
        }
    }      

}

public class ItemSelectedEventArgs : EventArgs
{
    private ITrinityEvent _objItem;

    public ItemSelectedEventArgs(ITrinityEvent objItem)
    {
        _objItem = objItem;

    }

    public ITrinityEvent SlectedNode
    {
        get
        {
            return _objItem;
        }
    }
}

public sealed class TrinityEventData : AbsTrinityEvent
{
    public TrinityEventData(ITrinityEvent objEvent)
        : base(objEvent)
    {
    }
} 
```

我使用以下函数将它绑定到我的列表视图中的代码后面（不在 XAML 中）

```
 public void SetupColumnsForUnAcklist()
    {
        //Create Columns for listview
        GridView grdView = new GridView();
        grdView.Columns.Add(new GridViewColumn() { DisplayMemberBinding = new Binding() { Path = new PropertyPath("EventDescription") }, Header = "Description" });
        grdView.Columns.Add(new GridViewColumn() { DisplayMemberBinding = new Binding() { Path = new PropertyPath("EventDateTime") }, Header = "Date:Time" });
        grdView.Columns.Add(new GridViewColumn() { DisplayMemberBinding = new Binding() { Path = new PropertyPath("Site") }, Header = "Site" });
        grdView.Columns.Add(new GridViewColumn() { DisplayMemberBinding = new Binding() { Path = new PropertyPath("DeviceName") }, Header = "Device" });
        grdView.Columns.Add(new GridViewColumn() { DisplayMemberBinding = new Binding() { Path = new PropertyPath("Priority") }, Header = "Priority" });

        lstview_Unack.View = grdView;                   

        //Do Binding 
        if (_alarmUnAckList != null)
        {

            lstview_Unack.SetBinding(ListView.ItemsSourceProperty, new Binding() { Source = _alarmUnAckList });
            lstview_Unack.SetBinding(ListView.IsSelectedProperty, new Binding() { Path = new PropertyPath("IsSelected") });
        }

        lstview_Unack.ContextMenu = contextMenu;

        foreach (GridViewColumn col in grdView.Columns)
        {
            comboColumnList.Items.Add(col.Header as string);
        }           
    } 
```

我的问题是，我想将 ListViewItem“IsSelected”属性绑定到 TrinityEventData 的“IsSelected”属性。我应该如何在后面的代码中做到这一点？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-30T20:17:35.273

首先，最好在 XAML 中执行此操作。它使事情变得更加清晰和简短。我将在 XAML 和代码隐藏中回答以证明这一点。

最简单的方法是将 Style 应用于 ListViewItem 并使用 Setter 来应用绑定。在 ListViewItem 上，DataContext 将成为您的绑定项（在本例中为 TrinityEventData）。

假设您在 XAML 中有 ListView：

```
<ListView x:Name="lstview_Unack">
    <ListView.Resources>
        <Style TargetType="{x:Type ListViewItem}">
            <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}"/>
        </Style>
    </ListView.Resources>
</ListView> 
```

在代码中，您必须手动构造 Style、Setter 和 Binding：

```
Style listViewItemStyle = new Style { TargetType = typeof(ListViewItem) };
listViewItemStyle.Setters.Add(new Setter
{
    Property = ListViewItem.IsSelectedProperty,
    Value = new Binding { Path = new PropertyPath("IsSelected") }
});
lstview_Unack.Resources.Add(typeof(ListViewItem), listViewItemStyle); 
```

然而，这和虚拟化存在问题。如果您的 ListViewItems 被虚拟化，您可能会取消选择 ListView 中的项目，但不会触发绑定，因为您的 ListViewItem 将不存在。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2018-11-08T14:26:41.433

对我有用的是：

```
<ListView x:Name="lstview_Unack">
    <ListView.ItemContainerStyle>
        <Style TargetType="{x:Type ListViewItem}">
            <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}"/>
        </Style>
    </ListView.ItemContainerStyle>
</ListView> 
```

# sql - 为什么我的 LIKE '%\_' 查询返回所有行，而不仅仅是那些以下划线结尾的行？

> ID：483011
> 
> 赞同：11
> 
> 时间：2009-01-27T11:11:25.740
> 
> 标签：sql, postgresql

我目前在 Postgres 上运行查询：

```
SELECT * FROM addenda.users WHERE users.username LIKE '%\_' 
```

但不是只返回以下划线结尾的条目，而是返回所有结果，无论它是否包含下划线。

运行下面的查询会返回一个用户名，它只是一个下划线，所以转义确实有效：

```
SELECT * FROM addenda.users WHERE users.username LIKE '\_' 
```

运行下面的查询会返回一个以特定字母结尾的用户名：

```
SELECT * FROM addenda.users WHERE users.username LIKE '%s' 
```

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-27T11:28:48.153

你的反斜杠没有通过 PostgreSQL 吗？如果您将字符串通过另一个将反斜杠视为转义字符的层（例如 Java 字符串），那么该层可能正在删除反斜杠，并且您可能需要为该层转义您的反斜杠。

你有更多的单字符用户名吗？如果反斜杠没有通过 PostgreSQL，那么它们也会匹配`'_'`

您也许可以尝试[ESCAPE 子句](http://www.postgresql.org/docs/8.3/interactive/functions-matching.html#FUNCTIONS-LIKE)：`username LIKE '%!_' ESCAPE '!'`

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-27T14:41:10.857

`"_"`是大多数 SQL 变体中的单字符通配符。如果要匹配实际`"_"`字符，则必须对其进行转义。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-27T11:46:52.753

自从我使用 postgres 已经有一段时间了，但我认为你可以做 '%[_]' 来得到你想要的。这当然适用于 SQL 服务器，虽然我现在没有 postgres 数据库设置来尝试它

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-06-17T10:12:39.330

您必须将查询中的反斜杠替换为双反斜杠，如下所示： 您仍然可能*在字符串文字*

`SELECT * FROM addenda.users WHERE users.username LIKE '%\\_'`

警告中得到非标准的 \\ 使用，但查询将被执行。在 Postgres 8.4 中测试。

 *# c# - 生成低位深度的图像文件？

> ID：483014
> 
> 赞同：11
> 
> 时间：2009-01-27T11:12:03.697
> 
> 标签：c#, vb.net, bitmap, imaging

**bpp** = 每像素位数，因此 32bpp 表示 R/G/B/A 为 8/8/8/8。

就像 .NET 对这些“System.Drawing.Imaging.PixelFormat”有一个枚举。

现在，一旦我的图形有一个**位图**或**图像**对象，我**将如何将其保存**到文件/我将使用什么格式？

什么图像文件格式（JPEG/GIF/PNG）支持低位深度，如 16bpp 或 8bpp *（而不是通常的 32bpp 或 24bpp）*

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-10-07T18:32:20.847

我不认为其他人的回答测试了他们的代码，因为 GDI+ PNG 不支持 Encoder.BitDepth EncoderParameter。事实上，唯一能做到的编解码器是 TIFF。

您需要在保存之前更改图像的 PixelFormat 才能对输出产生任何影响。这不会总是产生您期望的 PixelFormat。有关PixelFormats 变成什么的更多信息，请参阅[我的帖子。](https://web.archive.org/web/20140729141035/http://www.atalasoft.com/cs/blogs/rickm/archive/2009/10/07/system-drawing-round-trip-pixelformat-stability.aspx)

至于 PixelFormat 转换，如下所示：

```
private Bitmap ChangePixelFormat(Bitmap inputImage, PixelFormat newFormat)
{
  Bitmap bmp = new Bitmap(inputImage.Width, inputImage.Height, newFormat);
  using (Graphics g = Graphics.FromImage(bmp))
  {
    g.DrawImage(inputImage, 0, 0);
  }
  return bmp;
} 
```

不幸的是，这些转换会产生一些非常糟糕的输出。在执行有损转换（从高位深度到较低位深度）的情况下尤其如此。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2015-08-19T21:50:35.883

## 每像素一位

这仅从 .Net 生成最小的可能 PNG。请注意，它是黑白的 - 甚至不是灰度。对文档很有用。

消费者代码：

```
Dim src = (the original bitmap)
Using img = New Bitmap(src.Width, src.Height, PixelFormat.Format16bppRgb555) ' Provided Make1bpp function requires this
  img.SetResolution(src.HorizontalResolution, src.VerticalResolution)
  Using g = Graphics.FromImage(img)
    g.Clear(Color.White) ' remove transparancy
    g.DrawImage(src, 0, 0, src.Width, src.Height)
  End Using

  Using img2 As Bitmap = Make1bpp(img)
    img2.SetResolution(src.HorizontalResolution, src.VerticalResolution)

    Dim myencoder = (From parm In ImageCodecInfo.GetImageEncoders() Where parm.MimeType = "image/png").First()
    Dim encoderParams = New EncoderParameters(1)
    encoderParams.Param(0) = New EncoderParameter(Encoder.ColorDepth, 8L)
    If IO.File.Exists(pngName) Then
      IO.File.Delete(pngName)
    End If
    img2.Save(pngName, myencoder, encoderParams)
  End Using
End Using 
```

### 制作1bpp

这就是 PNG 编码器所关心的

```
Function Make1bpp(ByVal bmpIN As Bitmap) As Bitmap
    Dim bmpOUT As Bitmap
    bmpOUT = NewBitmap(bmpIN.Width, bmpIN.Height, PixelFormat.Format1bppIndexed)
    bmpOUT.SetResolution(bmpIN.HorizontalResolution, bmpIN.VerticalResolution)

    ' seems like I've got this crap in this program about 100x.
    If bmpIN.PixelFormat <> PixelFormat.Format16bppRgb555 Then
      Throw New ApplicationException("hand-coded routine can only understand image format of Format16bppRgb555 but this image is " & _
        bmpIN.PixelFormat.ToString & ". Either change the format or code this sub to handle that format, too.")
    End If

    ' lock image bytes
    Dim bmdIN As BitmapData = bmpIN.LockBits(New Rectangle(0, 0, bmpIN.Width, bmpIN.Height), _
        Imaging.ImageLockMode.ReadWrite, bmpIN.PixelFormat)
    ' lock image bytes
    Dim bmdOUT As BitmapData = bmpOUT.LockBits(New Rectangle(0, 0, bmpOUT.Width, bmpOUT.Height), _
        Imaging.ImageLockMode.ReadWrite, bmpOUT.PixelFormat)

    ' Allocate room for the data.
    Dim bytesIN(bmdIN.Stride * bmdIN.Height) As Byte
    Dim bytesOUT(bmdOUT.Stride * bmdOUT.Height) As Byte
    ' Copy the data into the PixBytes array. 
    Marshal.Copy(bmdIN.Scan0, bytesIN, 0, CInt(bmdIN.Stride * bmpIN.Height))
    ' > this val = white pix. (each of the 3 pix in the rgb555 can hold 32 levels... 2^5 huh.)
    Dim bThresh As Byte = CByte((32 * 3) * 0.66)
    ' transfer the pixels
    For y As Integer = 0 To bmpIN.Height - 1
      Dim outpos As Integer = y * bmdOUT.Stride
      Dim instart As Integer = y * bmdIN.Stride
      Dim byteval As Byte = 0
      Dim bitpos As Byte = 128
      Dim pixval As Integer
      Dim pixgraylevel As Integer
      For inpos As Integer = instart To instart + bmdIN.Stride - 1 Step 2
        pixval = 256 * bytesIN(inpos + 1) + bytesIN(inpos) ' DEPENDANT ON Format16bppRgb555
        pixgraylevel = ((pixval) And 31) + ((pixval >> 5) And 31) + ((pixval >> 10) And 31)
        If pixgraylevel > bThresh Then ' DEPENDANT ON Format16bppRgb555
          byteval = byteval Or bitpos
        End If
        bitpos = bitpos >> 1
        If bitpos = 0 Then
          bytesOUT(outpos) = byteval
          byteval = 0
          bitpos = 128
          outpos += 1
        End If
      Next
      If bitpos <> 0 Then ' stick a fork in any unfinished busines.
        bytesOUT(outpos) = byteval
      End If
    Next
    ' unlock image bytes
    ' Copy the data back into the bitmap. 
    Marshal.Copy(bytesOUT, 0, _
        bmdOUT.Scan0, bmdOUT.Stride * bmdOUT.Height)
    ' Unlock the bitmap.
    bmpIN.UnlockBits(bmdIN)
    bmpOUT.UnlockBits(bmdOUT)
    ' futile attempt to free memory.
    ReDim bytesIN(0)
    ReDim bytesOUT(0)
    ' return new bmp.
    Return bmpOUT
  End Function 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T12:01:36.980

试试这个：

```
ImageCodecInfo pngCodec = ImageCodecInfo.GetImageEncoders().Where(codec => codec.FormatID.Equals(ImageFormat.Png.Guid)).FirstOrDefault();
if (pngCodec != null)
{
    EncoderParameters parameters = new EncoderParameters();
    parameters.Param[0] = new EncoderParameter(Encoder.ColorDepth, 8);
    myImage.Save(myStream, pngCodec, parameters);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T12:14:02.900

所有图像格式都有效地支持低位深度。如果不需要，您只需保留最后几位未使用。GIF 只支持低色；你被限制为 256 种颜色。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-01-27T11:26:34.320

未经测试的代码 -

```
Image myImage = new Image();
EncoderParameters parameters = new EncoderParameters(1);   
parameters.Param[0] = new EncoderParameter(Encoder.ColorDepth, 8);
myImage.Save(somestream, ImageFormat.Png, parameters); 
```

查看 System.Drawing.Imaging 命名空间，玩转 Encoder.xxx 参数设置和 image.Save 方法。HTH。

**更新** 还值得注意的是，如果您想要一个小图像（低字节数），您可以尝试使用 Encoder.Compression 压缩保存为 JPEG，但会以图像质量为代价。

# asp.net - 单击时的asp.net跨页回发不运行

> ID：483015
> 
> 赞同：1
> 
> 时间：2009-01-27T11:12:24.477
> 
> 标签：asp.net

我正在尝试让跨页回发在 asp.net 2.0 中工作，我似乎遇到的问题是我按下的按钮是为了使用它的点击事件来根据其他控件的值存储一些会话变量。此按钮具有相关页面的跨页回发属性。

点击事件似乎根本没有运行，它似乎只是立即执行回发到另一个页面。

这是标准行为吗？有什么解决办法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T11:17:56.460

我想我找到了答案

[http://community.sgdotnet.org/blogs/chuawenching/archive/2007/03/08/ASP.NET-2.0-DataGrid_2F00_GridView-CrossPage-PostBack-.aspx](http://community.sgdotnet.org/blogs/chuawenching/archive/2007/03/08/ASP.NET-2.0-DataGrid_2F00_GridView-CrossPage-PostBack-.aspx)

似乎传输将是即时的，不会运行 onClick 事件。另一种方法是在 onClick 事件中使用 Server.Transfer。

任何其他意见表示赞赏。

# c - Secure C 和大学 - 受过缓冲区溢出培训

> ID：483018
> 
> 赞同：3
> 
> 时间：2009-01-27T11:12:50.090
> 
> 标签：c, security, buffer-overflow

我最近完成了 C 的大学课程。因此，我当然缺乏经验。

一些大学倾向于教他们的学生安全编程，[或者至少教一些元素](http://www.courses.fas.harvard.edu/~cs50/get/podcasts/2007/lectures/notes9m.pdf)。甚至还有[一段视频](http://www.courses.fas.harvard.edu/~cs50/get/podcasts/2007/lectures/week9m.mov)（取自[这里](http://cs50.tv/)）。

在 C 语言中，复制字符串需要 - 据我所知 - strcpy 或 string.h 函数。您如何在日常编程中安全地使用它？你有一些函数来处理分配以防止缓冲区溢出吗？有[C 的 CERT 安全编码标准](https://www.securecoding.cert.org/confluence/display/seccode/CERT+C+Secure+Coding+Standard;jsessionid=9542D1D823E37EE711407D3FEFF18548)。它提供了示例和合规的解决方案：

```
int main(int argc, char *argv[]) {
  /* ... */
  char prog_name[128];
  strcpy(prog_name, argv[0]);
  /* ... */
} 
```

他们的替代方案是：

```
int main(int argc, char *argv[]) {
  /* ... */
  char *prog_name = (char *)malloc(strlen(argv[0])+1);
  if (prog_name != NULL) {
    strcpy(prog_name, argv[0]);
  }
  else {
    /* Couldn't get the memory - recover */
  }
  /* ... */
} 
```

取自这里，[第二个例子](https://www.securecoding.cert.org/confluence/display/seccode/STR31-C.+Guarantee+that+storage+for+strings+has+sufficient+space+for+character+data+and+the+null+terminator)。

但据我所知，这只是更具挑战性、更多代码、更多工作。为什么没有人改变图书馆本身？或者至少为什么没有人提供安全的替代库或函数，以正确的方式处理这个问题？

感谢阅读，祝

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-27T11:25:55.243

用于此的 Posix 函数（几乎在每个系统上都可用）是`strdup()`. `strcpy()`如果您不想分配新内存并且已经有一个要使用的缓冲区，则使用它，但是您会更好地知道该缓冲区有多大以及字符串是否适合它。如果您不知道字符串是否合适，那么`strncpy()`它只是复制给定数量的字符。因此，您可以将复制的数量限制为缓冲区大小。

除此之外，还有许多以不同方式管理字符串大小的 sting 库。

并且由于您将其标记为 C++：它`std::string`为您完成了所有的内存管理，并且不会给您带来这些问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T11:27:24.320

使用[`strncpy`](http://opengroup.org/onlinepubs/007908775/xsh/strncpy.html)：

```
#define BUFSIZE 127
int main(int argc, char *argv[]) {
  /* ... */
  char prog_name[BUFSIZE + 1];
  strncpy(prog_name, argv[0], BUFSIZE);
  progname[BUFSIZE]= '\0';
  /* ... */
} 
```

大多数功能都有`*n*`版本。`str*`

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-27T13:27:22.237

*OpenBSD*中的*l* (strlcpy, strlcat) 函数通常比*n*函数更好，它们更快更容易安全使用，但它们是非标准的。但是，它们是 BSD 许可的，因此您可以在任何程序中包含已知的良好实现，这样您就可以跨平台和安全。

 **对于 Windows，如果不关心可移植性，可以使用 *_s 函数。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-29T00:02:09.397

如果我理解正确，你真正的问题是为什么 API 函数没有变得更安全。

原因之一是 C 库是遗留的（现在更改它为时已晚）。

然而，主要原因是该库被设计为极简主义，因此它只做最低限度的工作，并且用户有责任确保正确调用它。如果它进行了任何过多的检查，那么每次调用它都会付出代价，即使用户可以出于其他原因保证不会发生任何问题。这在许多 API 中非常常见。

话虽如此，有足够多的库可以提供更安全的替代方案，它们只是不是标准库的一部分。此外，许多从事更高级别工作的人使用 C++，其中有许多用于这些事情的标准类库。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T11:19:32.010

实际上，Microsoft 确实提供了 CRT 功能的安全替代方案。我认识的每个人都讨厌它们，并禁用了你不应该使用旧功能的警告。如果你想要一些安全的东西，也许你应该使用 C++。然后是 STL 字符串或类似 Qt 的东西。

好吧，或者您使用 .NET 或 Java 之类的平台，它们通常不会遇到这些问题（您的应用程序可能会崩溃，但无法通过缓冲区溢出将代码注入您的应用程序）。

编辑：启用数据执行保护/NX（Vista 和 .NET 的默认设置），这对于传统平台也不应该是问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T15:09:45.510

```
int main
(
    int argc, 
    char *argV[]
) 
{
   char prog_name[128];
   if (strlen(argV[0]) < sizeof(prog_name))
   {
       strcpy(prog_name, argV[0]);
   }
   else
   {
       printf("%s is too large for the internal buffer\n", argV[0]);
   }

   return 0;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-28T23:45:54.283

也许你会找到[这个问题的有用阅读答案](https://stackoverflow.com/questions/486383/safer-alternatives-to-the-c-standard-library#487864)

# .net - 用于单元测试的内存 DBMS

> ID：483021
> 
> 赞同：10
> 
> 时间：2009-01-27T11:13:18.827
> 
> 标签：.net, data-access-layer, embedded-database, in-memory

我正在寻找令人满意的选项来对我的 .NET DAL 类进行单元测试；因为它们是 DAL 类，所以它们直接使用 ADO.NET 访问数据库。目前我使用 MSSQL 数据库的实例进行测试，但想知道有哪些更快的选项——因为单元测试需要尽快运行，内存中的解决方案将是理想的。

我还应该提到我已经将自己绑定到 TSQL，因为我只会使用 Microsoft 平台。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T11:22:48.323

鉴于您声明：

> 我还应该提到我已经将自己绑定到 TSQL，因为我只会使用 Microsoft 平台。

然后使用 SqlServer 精简版可能会很好地满足您的需求。它不会完全在内存中运行，但可以在只读模式下运行（不会对主数据库文件进行编辑，因此可以同时被多个测试使用）

有一些陷阱，不支持存储过程，需要翻译一些数据类型，并且某些数据类型有严格的限制（特别是 varchar，它只能达到 4000 个字符） Linq to Sql 也没有得到适当的支持。

尽管如此，我还是使用 SqlServer Compact Edition 作为适当的 Sql Server 数据库的几乎完全替代品，效果很好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T18:55:38.237

我发现[SQLite](http://www.sqlite.org/)是最好的选择。虽然，我使用的是 nHibernate，但它是零配置，所以只需要一秒钟的时间来设置。但是，您必须意识到这些类型的引擎通常缺少您可能需要的一些东西（例如，如果您使用 ADO 提供程序，当您在表名中有空格时，SQLite 会爆炸）

当然，@TopBanana 关于不使用“实际”数据库的一些问题是正确的。然而，内存中的 RDBMS 非常适合那些想要快速运行的测试（例如，增量或 CI 构建的签入测试）。

另一个巨大的优势是您不必担心设置或拆卸。由于开发人员 A 破坏了您的开发数据库，​​因此您的签入失败是非常低效的；-)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T11:39:04.390

SQL Server**真的**是单元测试的瓶颈吗？

我是说：

1.  您是否分析了您的单元测试（使用 SQL Profiler 之类的工具）。他们都慢吗？有几个慢？为什么？
2.  你的单元测试做得太多了吗？设置和拆卸代码是否过于繁重？
3.  如果 SQL 是你的瓶颈，你是否考虑过一个模拟[框架](http://ayende.com/projects/rhino-mocks.aspx)，所以你模拟出所有的 SQL 调用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T13:06:36.960

听说windows有挂载ramdisk的软件（不记得url了，不好意思）。

在此基础上创建测试数据库可能会很有趣。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-11-18T14:18:48.590

我在使用 Oracle 时遇到了类似的挑战，我们做了以下事情：

*   确保我们有真正的单元测试没有触及数据库，而是使用模拟服务代替

*   实际需要 Oracle 的标记数据库测试与可以针对 HSQLDB 或 H2 或任何其他内存数据库运行的测试。所以我们可以单独运行它们。

*   在实际使用 Oracle 功能的测试中，我们使用了在 RAM 磁盘上运行的普通 Oracle 实例。

这使得测试相当快。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T11:41:54.603

我建议您对单元测试使用与生产相同的数据库。当您调试实时问题时，您真的不需要一些奇怪的差异。

如果您查看 NHibernate 的非常大的单元测试套件，您会发现它使用 SQL Server（基于磁盘），并且测试运行得非常快。考虑到比一般的单元测试集要多得多的表创建/删除，这更令人印象深刻，这不是 SQL Server 优化的目标。

# delphi - Delphi "EClassNotFound" 错误和损坏的 DFM 可能性

> ID：483022
> 
> 赞同：4
> 
> 时间：2009-01-27T11:14:04.080
> 
> 标签：delphi, dfm, eclassnotfound

我在我的 Delphi 2007 项目中遇到了一系列级联的“EClassNotFound”错误。似乎不是由缺少 Name 属性值引起的，因为通常情况下，虽然在初始化部分添加 RegisterClass(XXX) 修复了手头的 EClassNotFound 错误，但另一个似乎无限期地跟随它。

我终于在文本编辑器中打开了 DFM 文件，它看起来可能已经损坏（表单元素名称中有很多非 ASCII 字符，与我在 DFM 文件中看到的相比，看起来非常“非结构化” ）。（我会在这里发布相同的内容，但不确定是否可以，使用非 aSCII，所以会推迟）。

表单加载正常，似乎编译/语法检查也可以，但是一旦我运行它，麻烦。

回到 SVN 中的早期版本，它看起来已经处于这种状态有一段时间了，这让我认为要么 A）DFM 文件不是我的问题，要么 B）Delphi 表单流式处理是相当错误的-宽容/健壮（奖励问题：它是什么？）。

如果 DFM 文件是问题所在，并且已损坏，则回滚将必须是回滚方式，这将是昂贵的。鉴于 IDE 仍然可以加载它，是否有任何实用程序可以清理文件？

或者，我是否完全脱离了 DFM 作为主要嫌疑人的基础？

感谢大家的投入。忘记了带有 DFM 文件的二进制/文本选项，所以这很有帮助。看起来 DFM 本身没有损坏。

不过仍然有 EClassError 问题。回复：它缺少属性值，或引用不存在的属性等，还有一个问题：错误的类是给出的（当前是 TnxSqlUpdateObject，但如果到目前为止的经验是一致的，可能更多的等待时间）通常/总是真正的“罪魁祸首”类/对象？

例如，现在我的主窗体有四个对 TnxSqlUpdateObject 的引用，而这些引用实际上是放在窗体上的。如果我将 RegisterClass(TnxSqlUpdateObject) 放在初始化部分，它对于 EClassNotFound 错误运行良好，但随后会继续到下一个错误（在本例中为 TStringField）。

在这种情况下，我已经重新安装了 NexusDB 组件，并且还使用我认为可能是问题的一些组件构建了一个新项目。它编译并运行良好，直到我从我的真实项目中添加了另一种形式（不幸的是，它又引用了很多其他形式）。

所以，听起来我真正的问题是如何有条不紊地诊断和修复任何和所有 EClassNotFound 错误？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-27T13:26:33.487

如果组件在表单上，​​但在源文件的表单定义中也没有条目，我会收到此错误。大多数情况下，当我从另一个表单复制和粘贴时。最简单的解决方案是选择组件，剪切它，然后将其粘贴回去。当你保存时，组件的单元会被添加到源中，当你再次运行它时，一切都会好起来的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T11:20:50.090

好吧，dfm 文件可以是二进制文件或 tekst 文件（因为我在 4.0 版中是正确的）。

您可以通过右键单击表单并检查 Text DFM 标志来检查这一点。

如果 dfm 文件损坏，您可以尝试通过删除所有可疑行来修复它。确保保持对象 .. end 集完好无损，您可能只会丢失一些属性值。

顺便说一句，dfm 文件应该是这样的（了解一般结构）：

```
object Form5: TForm5
  Left = 0
  DesignSize = (
    426
    652)
  object Button1: TButton
    Left = 343
  end
  object Memo2: TMemo
    Anchors = [akLeft, akTop, akRight, akBottom]
  end
end 
```

如果看起来不是这样，您可能正在编辑二进制文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-27T11:37:57.903

如果您可以在 Delphi IDE 中加载表单，则 DFM 资源不会损坏。Delphi 使用与最终可执行文件相同的代码来加载 DFM，所以我认为这不是原因。

可以直接在Delphi IDE中打开DFM（如果对应的pas文件没有打开），也可以使用Alt+F12在DFM的表单视图和文本视图之间切换。在这种观点下，结构应该是健全的，具有正确的缩进等等。

正如[Gamecat](https://stackoverflow.com/questions/483022/delphi-eclassnotfound-errors-and-corrupted-dfm-possibility#483037)指出的那样，您可以使用表单弹出菜单中的命令来切换 DFM 存储格式。将其保留为 Delphi 5+ 的文本，它与 SVN 一起使用效果更好。

至于你的运行时问题的原因 - 我不知道......

**编辑：**在您排除 DFM 作为问题的根源之后，我只能假设使用列表中的一个重要单元丢失了，只有当您的表单上的所有组件都没有对应的成员字段时才会发生这种情况。您应该检查 DFM 中引用的所有组件是否也在表单中，即使您没有在代码中访问它们。这反过来会导致 Delphi 在保存文件时将任何缺少的单元添加到使用子句中。如果表单类引用了 DFM 中的所有组件，则不需要手动注册组件。

为了快速检查，您可以创建一个测试表单，将“问题”表单具有的所有组件放到它上面（一个实例就足够了），然后检查它是否有效。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-27T13:47:48.233

如果您有一个最近编译的可执行文件，您可以使用资源编辑器（如[PE Explorer](http://www.heaventools.com/)）来获取 dfm 定义。然后，您可以将 exe 中的那个与您现在拥有的那个进行比较。

我相信也有将二进制 dfm 文件转换为文本文件的工具。这将使您更好地查看文件，并帮助您确定它是否真的已损坏。我看到菲利克斯[在这个话题上](http://www.felix-colibri.com/papers/colibri_utilities/dfm_binary_to_text/dfm_binary_to_text.html)有一些东西。

如果 Delphi IDE 显示表单没有错误，我无法相信有损坏错误。会不会是包的问题？你使用运行时包吗？

更新：

您是否尝试过 Eurekalog 或 madExcept 或类似的东西来获得更详细的错误消息，调用堆栈和 memorydumt？也许这会给你一些关于这个问题的线索。

但通常我认为这个错误来自缺少运行时包，或者使用子句中缺少单元。如果您认为您知道 wwitch 组件会导致错误，请搜索对 RegisterClass() 的调用的来源，并查看该单元是否以某种方式包含在项目使用子句中。如果没有，请添加并重试。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-27T12:20:28.847

如果您更改了其中一个自定义组件并从中删除了属性，则可能会发生这种情况。该属性仍在 DFM 中，Delphi 尝试对其进行初始化。

尝试从 DFM 中手动移除部件，以便确定是哪个组件导致了问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-27T17:53:11.030

试试这个：

1.  先做好备份
2.  右键单击设计器中的表单；取消选中“文本 DFM”
3.  节省
4.  右键单击设计器中的表单；检查“文本 DFM”
5.  节省

# agile - Scrum：积压中的平均故事数是多少

> ID：483027
> 
> 赞同：4
> 
> 时间：2009-01-27T11:16:12.690
> 
> 标签：agile, scrum

我目前正在为 Scrum 团队开发一种生产力工具，并且想知道您在任何特定时间在产品积压中看到的平均故事数量是多少。

只是为了澄清这个数字不应该包括已完成的故事或将来“可能”分成多个故事的故事。此外，我对人们“正在”做什么而不是他们“应该”做什么感兴趣。

不幸的是，我没有足够的时间去其他人的实验室，所以只有真正了解我们正常情况的经验。

我猜这个网站上有很多顾问可能会比我看到更多的团队会议室。

现在我知道这是一个“一根绳子有多长”类型的问题，有些人有两个，有些人有两千个，但我只是在找一根码尺。

对于我们公司的团队，通常不到二十人。

问候，

克里斯

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T11:46:10.880

“只是为了澄清这个数字不应该包括已完成的故事”

了解。

“或者将来‘可能’分成多个故事的故事。”

什么？这是我们积压的一半。

官方积压中总是有 5 ± 2 个故事，因为这是我们产品负责人的大脑所能处理的全部内容。当我们完成一些时，最后会加上一些“好吧，我们可能也想看看这个”。

作为架构师，我可以预见另外 5 ± 2 个更具管理性、技术性的故事。

这些是我们积压的前 9 个故事。

另外，总是有定义模糊的故事“将来‘可能’分成多个故事”。有趣的是，这些似乎是 5 ± 2。

其中有 3 或 4 个，具体取决于您的“'可能'被分成多个故事”规则。

当然，除此之外，还有其他人想向我们讲述故事。例如，我们的销售人员有 5 ± 2 个故事是他希望看到的销售演示的一部分。它不是核心功能，而且含糊不清，而且“'可能'被分成多个故事”，所以我想这不算数。

我认为这很重要，顺便说一句。每个故事都必须被追踪。变化，变异，崩溃，但不可能从“可能崩溃”中辨别“真实”。这就是故事优先级的重点——模糊、大或定义不明确的概念可以作为积压工作进行跟踪，直到它们的优先级很低，以至于其他项目比未完成的积压工作更重要。

正确答案是（5 ± 2 个故事）× 利益相关者数量。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-27T11:46:25.343

如果你不考虑你提到的史诗，我会说你在一个冲刺中完成的故事的两倍。我认为根据故事的大小和团队的规模，这将在 20 到 30 之间变化。

目前，我们有 7 个故事不属于待办事项中的 sprint。但我们目前正在建立积压，所以没有太多的参考。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-27T12:40:07.077

刚刚快速浏览了我们的问题跟踪器：我们每个 sprint 完成大约 15-20 个故事，并为接下来的 3 个 sprint 制定了粗略的计划/分配。未分配的积压部分往往在 10-20 之间。因此，我们完整的待办事项大约包含 50 到 100 个故事。我想这会有很大的不同，这取决于我们离发布有多近（目前我们有大约 4 个冲刺；通常的发布周期大约是 15 个冲刺）——只是为了给你一个粗略的估计“我们团队中的字符串长度”:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-29T10:44:14.853

这真的取决于项目tbh。

对于未提交的积压工作；最低的项目大约是 5-10，最高的项目大约是 25-30。

sprint Backlogs 更加一致，通常每个春季大约有 7 个 backlog 项目（2 周 sprint）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T19:37:58.657

一个好的经验法则是花费团队 5% 的时间来维护产品待办事项——对 1 到 2 个 sprint 的故事进行全面梳理。对于我的团队来说，这通常对应于大约 15 到 25 个故事。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-09-21T15:28:06.837

令人惊讶的是，这些数字在海报之间实际上是多么一致。

对于 2 周的冲刺：3 - 7 个故事，取决于他们的重量。如果它的新功能更多故事，在构建或更改旧/现有功能时更少故事。

每个项目积压的故事：总共 25 - 40 个？

# c++ - 获取查询结果的最佳方式

> ID：483031
> 
> 赞同：0
> 
> 时间：2009-01-27T11:17:39.753
> 
> 标签：c++, qt4

我正在开发一个从 Internet 服务器获取大图像的应用程序，这是下载这些图像的最佳方式，而不冻结整个应用程序？我的意思是后台下载。我已经考虑在另一个线程中下载它。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-27T11:30:39.353

是的，您需要生成另一个线程来进行网络通信，然后当它完成读取时，您可以使用 volatile 布尔标志来指示工作已完成并且主/应用程序线程可以获取数据并合并它。如果您想逐块显示图像（就像浏览器一样），数据可能是图像的“一部分”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-04-25T05:28:34.307

后台线程可以工作，但要正确处理很棘手，而且通常不需要... Qt4 使得使用 QTcpSocket 类在主线程中执行非阻塞 I/O 变得非常容易——基本上你连接 QTcpSocket 对象的 readReady( ) 向您的程序的插槽发出信号，并让您的插槽在调用时从 QTcpSocket 读取新可用的数据。例如，查看 Qt 示例目录 ($QTDIR/examples/network/fortuneclient) 中的 fortuneclient 示例。

# .net - 如何将网站从 IIS 托管站点更改为 ASP.Net Development Server 托管站点？

> ID：483036
> 
> 赞同：0
> 
> 时间：2009-01-27T11:20:29.683
> 
> 标签：.net, asp.net, iis-6, asp.net-development-serv

在我以前的机器上，我安装了 IIS6，并使用 IIS 作为主机创建了一个 Web 项目。该项目已完成，发布到内部托管服务器并签入源代码控制。

我现在需要回去对项目做一个小改动，但与此同时我已经购买了一台新机器。在我的新机器上，我没有 IIS，而且我真的不希望重新使用 IIS，因为我发现 ASP.Net 开发服务器足以满足我的需要。

如果没有成为管理员并安装 IIS 6，我根本无法在 Visual Studio 中打开项目。有什么方法可以修改项目和解决方案文件以使其正常运行并改用 ASP.Net 开发服务器？

**编辑：**附加信息，这是作为**网站**而不是**网络项目**创建的，因此没有 .csproj 文件。

版本信息：Visual Studio 2008、.net 3.5。

谢谢你的帮助，

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T11:44:21.913

您可以开始一个新项目并使用“使用自定义 Web 服务器”选项吗？

就我个人而言，我会开始一个新项目并直接从源代码管理中获取文件 - 作为一个网站而不是项目，你不应该遇到任何问题，虽然你现在只需要做一个小改动，你可能需要做更多的小改动将来会发生变化，因此快速而方便地访问源可能会很有用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T11:48:41.827

如果是网站项目（没有 .proj 文件，没有将项目代码预编译成 dll），您可以尝试以下操作：

在选择的文本编辑器中打开 .sln 文件，并在“ProjectSection(WebsiteProperties)”中添加以下行：

```
VWDPort = "xxxx" 
```

其中 xxxx 是未使用的随机端口号 - 这似乎是使用正确服务器和使用开发服务器之间的唯一区别。

如果它是一个 Web 应用程序项目，您可以尝试以下操作：

在选择的文本编辑器中打开 .proj 文件，然后修改 WebProjectProperties：

假真 0 / 假

这可能会让你继续前进。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T11:46:07.683

环顾四周，您似乎可以独立运行开发服务器：

[http://blog.sb2.fr/post/2008/11/28/Use-Microsoft-NET-ASPNET-Development-Server-Standalone.aspx](http://blog.sb2.fr/post/2008/11/28/Use-Microsoft-NET-ASPNET-Development-Server-Standalone.aspx)

# ios - CIFilter 在 iOS 中可用吗？

> ID：483039
> 
> 赞同：4
> 
> 时间：2009-01-27T11:22:19.527
> 
> 标签：ios, quartz-graphics, core-image, cifilter

在我开始实现自己的过滤器（可能使用 opengl ES）之前，我想确定一下，但iOS 上是否提供[CIFilters ？](https://developer.apple.com/library/archive/documentation/GraphicsImaging/Reference/CoreImageFilterReference/)有什么类似的吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T14:28:29.867

目前 SDK 中不提供 CIFilter。如果您希望看到它，您应该[向 Apple 提出请求](http://bugreporter.apple.com)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-10-19T15:34:42.857

更新：CIFilters 现在[包含在 iOS 5](https://developer.apple.com/documentation/coreimage/cifilter)中。

# java - 从 Java 访问 gmail

> ID：483048
> 
> 赞同：12
> 
> 时间：2009-01-27T11:28:24.223
> 
> 标签：java, gmail

我需要一个允许我在 Gmail 中使用 Java 进行电子邮件操作（例如发送/接收邮件）的库。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-27T11:32:56.120

你见过[g4j - GMail API for Java](http://g4j.sourceforge.net/)吗？

> GMailer API for Java (g4j) 是一组允许 Java 程序员与 GMail 通信的 API。使用 G4J 程序员可以制作基于 GMail 巨大存储的基于 Java 的应用程序。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-27T12:27:16.227

您可以为此使用 Javamail。要记住的是，GMail 使用 SMTPS 而不是 SMTP。

```
import javax.mail.*;
import javax.mail.internet.*;

import java.util.Properties;

public class SimpleSSLMail {

    private static final String SMTP_HOST_NAME = "smtp.gmail.com";
    private static final int SMTP_HOST_PORT = 465;
    private static final String SMTP_AUTH_USER = "myaccount@gmail.com";
    private static final String SMTP_AUTH_PWD  = "mypwd";

    public static void main(String[] args) throws Exception{
       new SimpleSSLMail().test();
    }

    public void test() throws Exception{
        Properties props = new Properties();

        props.put("mail.transport.protocol", "smtps");
        props.put("mail.smtps.host", SMTP_HOST_NAME);
        props.put("mail.smtps.auth", "true");
        // props.put("mail.smtps.quitwait", "false");

        Session mailSession = Session.getDefaultInstance(props);
        mailSession.setDebug(true);
        Transport transport = mailSession.getTransport();

        MimeMessage message = new MimeMessage(mailSession);
        message.setSubject("Testing SMTP-SSL");
        message.setContent("This is a test", "text/plain");

        message.addRecipient(Message.RecipientType.TO,
             new InternetAddress("elvis@presley.org"));

        transport.connect
          (SMTP_HOST_NAME, SMTP_HOST_PORT, SMTP_AUTH_USER, SMTP_AUTH_PWD);

        transport.sendMessage(message,
            message.getRecipients(Message.RecipientType.TO));
        transport.close();
    }
} 
```

ref :[使用 SMTPS 发送电子邮件（例如 Google GMail）（Javamail）](http://www.rgagnon.com/javadetails/java-0570.html)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-27T12:30:56.627

这个问题的变体已在之前的几篇文章中得到解决：

*   [使用 IMAP 从 GMail 获取邮件到 Java 应用程序](https://stackoverflow.com/questions/61176/getting-mail-from-gmail-into-java-application-using-imap)
*   [如何使用 Gmail 从 Java 应用程序发送电子邮件？](https://stackoverflow.com/questions/46663/how-do-you-send-email-from-a-java-app-using-gmail)

一般的方法是通过[JavaMail](http://java.sun.com/products/javamail/)使用 IMAP/SMTP 。[常见问题解答](http://java.sun.com/products/javamail/FAQ.html)甚至有一个[使用 Gmail](http://java.sun.com/products/javamail/FAQ.html#gmail)的特殊条目。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-27T11:33:23.573

看看[GMail API for Java](http://g4j.sourceforge.net/)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-27T11:35:46.143

首先，将您的 Gmail 帐户配置为接受 POP3 访问。然后，只需使用 Javamail 访问您的邮件帐户！

# java - Java 管道流的内容“存储”在哪里？

> ID：483054
> 
> 赞同：0
> 
> 时间：2009-01-27T11:31:24.890
> 
> 标签：java, memory, stream, profiler

我在探查器下运行我的应用程序。内存消耗最多的“类”`char[]`在我的应用程序中约为 10 kB。

然后我创建了一个`InputStream`（`PipedInputStream`确切地说），它包含一个 300 MB 的字节数组数据。

然后我看了一下我的分析器，我没有看到任何显着的变化（看不到任何东西占用了 300 MB）。

问题是，如果 300 MB 的字节数组不在内存中，Java 将它保存在哪里？

**[更新]** 关于我如何获得 300 MB 的附加信息`PipedInputStream`：

我正在开发一个具有文件上传机制的网络应用程序。在文件上传的其中一个过程中，我创建了一个输入流 ( `PipedInputStream`)。基本上，

1.  我读取了多部分文件的输入流（一次几 KB 字节 []），
2.  创建了一个`PipedOutputStream`
3.  创建了一个`PipedInputStream`（将最近创建的输出流传递给构造函数）
4.  将多部分的输入流写入我的`PipedOutputStream`（在单独的线程上运行；在退出线程之前刷新并关闭该输出流）。*此时，我现在在自己的输入流中拥有了多部分字节的副本*
5.  然后（意外地）将该输入流存储在我的 http 会话中（关于这是否是一个好主意的讨论/辩论将是另一个问题）

那么问题又来了，Java 将我`InputStream`的内容保存在哪里（我在分析器中的任何地方都看不到它）？

**[更新#2]**

我有一个从文件`FileOutputStream`中读取`PipedInputStream`并写入文件的文件。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T11:35:03.120

A`PipedInputStream`仅在其连接到的输出流写入数据时才使数据可用。只要您从输入流中读取数据的速度与从输出流中接收数据的速度一样快，就不会有太多数据需要缓冲。

如果这没有帮助，您将需要提供有关您正在使用管道输入流做什么的更多信息 - 它连接到什么输出流，以及从中读取什么？

**编辑：**你还没有说从你的`PipedInputStream`. 必须有一些东西，否则`PipedOutputStream`会阻塞 -`PipedInputStream`只有一个相当小的缓冲区（默认情况下）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T11:35:16.097

A[`PipedInputStream`](http://java.sun.com/j2se/1.5.0/docs/api/java/io/PipedInputStream.html)根本不存储任何数据。另外，您从哪里获得 300 MB 字节数组？

# streaming - 流数据

> ID：483055
> 
> 赞同：2
> 
> 时间：2009-01-27T11:32:05.870
> 
> 标签：streaming

我在 Google 上搜索了对流数据及其特征的良好定义和理解，但没有成功。我的问题是：

1.  什么是流数据？
2.  如何检测？

**更正：**

“如何检测”不是一个合适的问题。相反，我的问题是：

它与缓冲数据和其他数据传输机制有何不同？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T11:39:55.433

这取决于您的意思是什么上下文，但基本上*流数据*类似于*异步数据*。以网络为例。Web（或特别是 HTTP）（基本上）是一种请求-响应机制，因为客户端发出请求并接收响应（通常是某种网页）。

HTTP 本身并不支持服务器将内容推送到客户端的能力。有很多方法可以伪造，包括：

*   **轮询：**强制客户端重复请求，通常不引人注意（就客户端而言）；
*   **长期连接：**这是客户端发出普通 HTTP 请求但服务器不会立即返回的地方，而是挂在请求上，直到有东西要发回。当请求超时或发送响应时，客户端会发送另一个请求。这样就可以伪造服务器推送；
*   **插件：**可以使用 Java 小程序、Flash、Silverlight 等来实现这一点。

服务器有效地将数据发送到客户端（而不是客户端请求它）的任何内容——无论机制如何，客户端是否正在轮询该数据——都可以被描述为*流数据*。

使用非 HTTP 传输（例如 vanilla TCP），服务器推送通常更容易（但仍可能与防火墙等发生冲突）。这方面的一个示例可能是从提供商处接收市场信息的共享交易应用程序。那是流数据。

你如何检测它？有点模糊的问题。我不太确定你在说什么。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T11:52:41.227

当您说流数据时，我想到了以下内容，尽管我不确定这是否是您的意思。对我来说，它在下载时正在播放视频/音频文件。当您访问 YouTube 并观看视频并开始播放时，即使您尚未下载整个视频，也会发生这种情况。但是你可以看到视频下载——我相信你对随着文件下载而填充的搜索栏很熟悉。它不一定是视频或音频文件，但这是最常见的。

# xml - 是否有可以通过示例创建 XSLT 的 XSL 代码生成器？

> ID：483064
> 
> 赞同：10
> 
> 时间：2009-01-27T11:33:36.867
> 
> 标签：xml, xslt, editor, generator

给定一个源 XML 文档和它在转换后应该是什么样子的示例，是否有一个代码生成器可以创建一个 XSL 转换来完成它。

我并不期望它是完美的，但是，就像可以从示例 XML 创建 XSD 的代码生成器一样，这将是一个很好的起点，然后手动改进。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-10-23T18:39:20.420

[XSLTGen](http://people.eng.unimelb.edu.au/baileyj/xsltgen/XSLTGen.htm)看起来很有前途，正是您正在寻找的东西。

* * *

*更新：（2015 年 4 月 4 日）* *将链接更新为指向的正确链接：@user326608*

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-27T22:04:24.737

本质上，您要问的是，“给定一组输入数据和一个输出，是否可以推断出将产生该输出的程序的逻辑？” 除了微不足道的情况——程序产生所提供的输出而不考虑输入——答案是“否”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-09T07:09:54.070

尝试 ALTOVA MapForce ( [http://www.altova.com/mapforce.html](http://www.altova.com/mapforce.html) )

# wpf - 查看 WPF 窗口是否已加载（已触发 Loaded 事件）

> ID：483066
> 
> 赞同：2
> 
> 时间：2009-01-27T11:34:46.800
> 
> 标签：wpf

是否可以查明是否已加载 WPF 窗口？我有一个接受窗口并将“加载”事件挂钩的方法。如果 window 已经加载，则不会触发该事件。接受论证时是否可以知道这一点？

谢谢你。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-27T11:45:36.547

你有 Window 的 IsLoaded 属性

# python - 为什么我的班级表现得像一个静态班级？

> ID：483072
> 
> 赞同：0
> 
> 时间：2009-01-27T11:36:21.867
> 
> 标签：python

我有一个模块（实际上是一个 .py 文件），有一个名为 HashedDir 的类。

当我导入文件并实例化该类的 2 个实例时，当我检查对象的字段时，它们总是相同的，即使两个对象应该不同。

例如：

```
 h1 = HashedDir('/path/to/dir')
 print h1.getList()['files'] # /path/to/dir
 h2 = HashedDir('some/other/path')
 print h1.getList()['files'] # some/other/path
 print h2.getList()['files'] # some/other/path 
```

任何的想法？

这是课程：

```
from os  import walk
from os import path
from hashlib import md5
import re

class HashedDir:
    """
    A list of files with associated md5 hashes generated retrieving thou
    a recursive walk in the directory tree starting from a provided root
    directory. Also stores the dirs in each dir
    """

    #  {'files': [
    #    ('/path/to/file1', '52bc309e11259af15e4623c7a0abc28c'),
    #    ('/path/to/file2', '52bc309e11259af15e4623c7a0abc28c'),
    #    ('/path/to/dir/file3', '52bc309e11259af15e4623c7a0abc28c')
    #   ],
    #   'dirs': ['/path/to/dir1', '/path/to/dir2']
    #  }
    fileList = {'files': [], 'dirs': []}
    ignoreList = []

    def __init__(self, rootDir, ignoreList=[]):
        """
        ignoreList is a list of regular expressions. If a file or a dir matches
        that regular expression, don't count it
        """
        self.ignoreList = ignoreList

        for dirpath, dirnames, filenames in walk(rootDir):
            for fileName in filenames:
                completeName = path.join(dirpath,fileName)
                hash = md5(open(completeName).read()).hexdigest()
                relativePath = self._relativePath(completeName, rootDir)
                if not self._toBeIgnored(relativePath):
                    self.fileList['files'].append((relativePath, hash))
            for dirName in dirnames:
                completeName = path.join(dirpath, dirName)
                relativePath = self._relativePath(completeName, rootDir)
                if not self._toBeIgnored(relativePath):
                    self.fileList['dirs'].append(relativePath)

    def _relativePath(self, path, base):
        return path.replace(base, '')

    def _toBeIgnored(self, path):
        for regex in self.ignoreList:
            if re.compile(regex).search(path) != None:
                return True
        return False

    def getList(self):
        return self.fileList 
```

提前致谢

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-27T12:11:26.713

类中有两种变量：

*   类变量，在类级别定义，对所有实例通用

*   实例变量，在类方法中定义（通常`__init__`）并由实例限定（通常`self.`）。

例子

```
class SomeClass( object ):
    classVariable = 0
    def __init__( self ):
        self.instanceVariable= 0 
```

命名的变量`classVariable`是类的一部分，对所有实例都是通用的。由于 Python 进行搜索的方式，它可以作为 . 和 . 的成员`self.classVariable`使用`SomeClass.classVariable`。

命名的变量`instanceVariable`是实例 ( `self.`) 的一部分，并且对于每个实例都是唯一的。

笔记。还有第三种，全球性的，但这不是你要问的。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-27T11:53:11.600

你说的是fileList吗？您将其作为类变量，使其成为您需要执行的实例变量：

```
self.fileList = {'files': [], 'dirs': []} 
```

在你的 __ init __ 函数中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-27T14:27:15.300

块中声明的东西`class`是类属性，类属性也可以通过实例访问。（事实上​​，这个原则就是方法的绑定方式。）不仅如此，函数的默认参数仅在定义函数时才被评估。因此，举一个说明这两点的例子：

```
class C(object):
    list_a = []
    def __init__(self, list_b=[]):
        self.list_b = list_b

    def __str__(self):
        return '%r %r' % (self.list_a, self.list_b)

c1 = C()
c2 = C()
c2.list_a = []
c3 = C([])

c1.list_a.append(1)
c1.list_b.append(2)
print c1
print c2
print c3 
```

输出是：

```
[1] [2]
[] [2]
[1] [] 
```

c1 和 c3 共享相同`list_a`，因为它是一个类属性；它不会像在 c2 上那样被实例属性所遮蔽。c1 和 c2 共享相同，因为在;`list_b`中只有一个`list_b`默认值。`__init__`每次调用函数时都不会创建一个新列表，但传入您自己的新列表是可行的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T12:00:36.327

如果你在类方法之外声明你的变量，在类的主体内，它们将成为“类变量”并且对所有类实例都是通用的。要获取实例变量，请在**init**函数中声明它们并将它们绑定到“self”，即当前实例的处理程序。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-27T16:25:41.533

正如其他人指出的那样，您的问题是 fileList 是您正在变异的类变量。

然而，值得注意的是您的代码中可能导致类似问题的另一个潜在陷阱（尽管在您的具体示例中没有）：

```
def __init__(self, rootDir, ignoreList=[]): 
```

谨防将可变参数（例如此列表）作为默认参数传递。该列表仅创建一次（当您定义`__init__`函数时。这意味着使用默认构造的类的所有实例都将使用相同的列表。

在您的示例中，列表永远不会被修改，因此这不会产生任何影响，但是如果（就像您对 fileList 所做的那样）附加到 self.ignoreList，那么这将影响所有此类实例，从而导致与该实例类似的问题你看到了。

这是一个非常常见的初学者陷阱 - 为了避免它，最好编写如下代码：

```
def __init__(self, rootDir, ignoreList=None):
    if ignoreList is None:
        ignoreList = []  # This will create a new empty list for every instance. 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T12:05:52.340

如果您可以发布完整的工作（或失败！）示例，这可能会很有用。

如果我做我认为必要的事情（即，将其包装在 Class HashedDir(object): 中并在**init**中设置 self.fileList = {'files': [], 'dirs': []}那么它似乎确实有效。

您将哪些项目称为 self.value？根据 sykora 上一篇文章，您需要区分为每个实例（在**init**中）运行的代码和所有实例共有的代码。

# javascript - 更好地理解 JavaScript 中的回调函数

> ID：483073
> 
> 赞同：164
> 
> 时间：2009-01-27T11:36:48.327
> 
> 标签：javascript, function, callback

我理解将一个函数作为回调传递给另一个函数并让它执行，但我不了解执行此操作的最佳实现。我正在寻找一个非常基本的示例，如下所示：

```
var myCallBackExample = {
    myFirstFunction : function( param1, param2, callback ) {
        // Do something with param1 and param2.
        if ( arguments.length == 3 ) {
            // Execute callback function.
            // What is the "best" way to do this?
        }
    },
    mySecondFunction : function() {
        myFirstFunction( false, true, function() {
            // When this anonymous function is called, execute it.
        });
    }
}; 
```

在 myFirstFunction 中，如果我确实返回了新的回调（），那么它会工作并执行匿名函数，但这对我来说似乎不是正确的方法。

* * *

## 回答 #1

> 赞同：133
> 
> 时间：2009-01-27T11:43:35.537

你可以说

```
callback(); 
```

`call`或者，如果您想`this`在回调中调整 的值，您可以使用该方法。

```
callback.call( newValueForThis); 
```

函数内部`this`将是任何`newValueForThis`内容。

* * *

## 回答 #2

> 赞同：91
> 
> 时间：2011-03-22T17:11:50.303

您应该检查回调是否存在，并且是一个可执行函数：

```
if (callback && typeof(callback) === "function") {
    // execute the callback, passing parameters as necessary
    callback();
} 
```

许多库（jQuery、dojo 等）对它们的异步函数使用类似的模式，以及对所有异步函数使用 node.js（nodejs 通常传递`error`和`data`回调）。查看他们的源代码会有所帮助！

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2009-01-27T11:52:30.400

执行函数有 3 种主要可能性：

```
var callback = function(x, y) {
    // "this" may be different depending how you call the function
    alert(this);
}; 
```

1.  回调（argument_1，argument_2）；
2.  callback.call(some_object, argument_1, argument_2);
3.  callback.apply(some_object, [argument_1, argument_2]);

您选择的方法取决于：

1.  您将参数存储在数组中或作为不同的变量。
2.  您想在某个对象的上下文中调用该函数。在这种情况下，在回调中使用“this”关键字将引用在 call() 或 apply() 中作为参数传递的对象。如果您不想传递对象上下文，请使用 null 或 undefined。在后一种情况下，全局对象将用于“this”。

[Function.call](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Function/call) , [Function.apply](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Objects/Function/apply)的文档

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-27T11:43:31.120

回调是关于信号的，而“new”是关于创建对象实例的。

在这种情况下，只执行“callback();”会更合适。而不是“return new callback()”，因为无论如何您都没有对返回值做任何事情。

*（而且 arguments.length==3 测试真的很笨重，fwiw，最好检查回调参数是否存在并且是一个函数。）*

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2011-03-03T12:21:07.873

正确的实施是：

```
if( callback ) callback(); 
```

这使得回调参数可选..

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-12-21T18:49:52.257

您可以使用：

```
if (callback && typeof(callback) === "function") {
    callback();
} 
```

下面的例子稍微全面一点：

```
function mySandwich(param1, param2, callback) {
  alert('Started eating my sandwich.\n\nIt has: ' + param1 + ', ' + param2);
  var sandwich = {
      toppings: [param1, param2]
    },
    madeCorrectly = (typeof(param1) === "string" && typeof(param2) === "string") ? true : false;
  if (callback && typeof(callback) === "function") {
    callback.apply(sandwich, [madeCorrectly]);
  }
}

mySandwich('ham', 'cheese', function(correct) {
  if (correct) {
    alert("Finished eating my " + this.toppings[0] + " and " + this.toppings[1] + " sandwich.");
  } else {
    alert("Gross!  Why would I eat a " + this.toppings[0] + " and " + this.toppings[1] + " sandwich?");
  }
});
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-04-06T16:06:53.283

```
function checkCallback(cb) {
  if (cb || cb != '') {
    if (typeof window[cb] === 'undefined') alert('Callback function not found.');
    else window[cb].call(this, Arg1, Arg2);
  }
}
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-03-24T15:08:56.923

这是一个解释`callback()`JavaScript 函数的基本示例：

```
var x = 0;

function testCallBack(param1, param2, callback) {
  alert('param1= ' + param1 + ', param2= ' + param2 + ' X=' + x);
  if (callback && typeof(callback) === "function") {
    x += 1;
    alert("Calla Back x= " + x);
    x += 1;
    callback();
  }
}

testCallBack('ham', 'cheese', function() {
  alert("Function X= " + x);
});
```

[JSFiddle](http://jsfiddle.net/Berguiga/f37ut5e4/2/)

# java - 覆盖 Guice 中的绑定

> ID：483087
> 
> 赞同：154
> 
> 时间：2009-01-27T11:42:11.170
> 
> 标签：java, unit-testing, guice

我刚刚开始使用 Guice，我能想到的一个用例是在测试中我只想覆盖单个绑定。我想我想使用其余的生产级绑定来确保一切设置正确并避免重复。

所以想象我有以下模块

```
public class ProductionModule implements Module {
    public void configure(Binder binder) {
        binder.bind(InterfaceA.class).to(ConcreteA.class);
        binder.bind(InterfaceB.class).to(ConcreteB.class);
        binder.bind(InterfaceC.class).to(ConcreteC.class);
    }
} 
```

在我的测试中，我只想覆盖 InterfaceC，同时保持 InterfaceA 和 InterfaceB 完好无损，所以我想要类似的东西：

```
Module testModule = new Module() {
    public void configure(Binder binder) {
        binder.bind(InterfaceC.class).to(MockC.class);
    }
};
Guice.createInjector(new ProductionModule(), testModule); 
```

我也尝试了以下方法，但没有运气：

```
Module testModule = new ProductionModule() {
    public void configure(Binder binder) {
        super.configure(binder);
        binder.bind(InterfaceC.class).to(MockC.class);
    }
};
Guice.createInjector(testModule); 
```

有谁知道是否有可能做我想做的事，还是我完全吠错了树？

--- 跟进：如果我在接口上使用@ImplementedBy 标签然后在测试用例中提供一个绑定，这似乎可以实现我想要的，当两者之间存在 1-1 映射时效果很好接口和实现。

此外，在与同事讨论后，我们似乎会走上覆盖整个模块并确保我们正确定义模块的道路。尽管绑定在模块中放错位置并且需要移动，但这似乎可能会导致问题，因此可能会破坏大量测试，因为绑定可能不再可以被覆盖。

* * *

## 回答 #1

> 赞同：164
> 
> 时间：2009-02-10T05:04:02.503

这可能不是您正在寻找的答案，但如果您正在编写单元测试，您可能不应该使用注入器，而应该手动注入模拟或假对象。

另一方面，如果你真的想替换单个绑定，你可以使用`Modules.override(..)`：

```
public class ProductionModule implements Module {
    public void configure(Binder binder) {
        binder.bind(InterfaceA.class).to(ConcreteA.class);
        binder.bind(InterfaceB.class).to(ConcreteB.class);
        binder.bind(InterfaceC.class).to(ConcreteC.class);
    }
}
public class TestModule implements Module {
    public void configure(Binder binder) {
        binder.bind(InterfaceC.class).to(MockC.class);
    }
}
Guice.createInjector(Modules.override(new ProductionModule()).with(new TestModule())); 
```

[在此处](http://google-guice.googlecode.com/git/javadoc/com/google/inject/util/Modules.html#override%28com.google.inject.Module...%29)查看详细信息。

但正如 javadoc 所`Modules.overrides(..)`建议的那样，您应该以不需要覆盖绑定的方式设计您的模块。在您给出的示例中，您可以通过将绑定移动`InterfaceC`到单独的模块来完成此操作。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2014-08-27T13:19:13.253

为什么不使用继承？您可以在方法中覆盖您的特定绑定`overrideMe`，将共享实现留在`configure`方法中。

```
public class DevModule implements Module {
    public void configure(Binder binder) {
        binder.bind(InterfaceA.class).to(TestDevImplA.class);
        overrideMe(binder);
    }

    protected void overrideMe(Binder binder){
        binder.bind(InterfaceC.class).to(ConcreteC.class);
    }
};

public class TestModule extends DevModule {
    @Override
    public void overrideMe(Binder binder) {
        binder.bind(InterfaceC.class).to(MockC.class);
    }
} 
```

最后以这种方式创建您的注射器：

```
Guice.createInjector(new TestModule()); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2015-01-06T16:34:16.113

如果您不想更改您的生产模块，并且如果您有一个默认的类似 Maven 的项目结构，例如

```
src/test/java/...
src/main/java/... 
```

您可以`ConcreteC`使用与原始类相同的包在测试目录中创建一个新类。Guice 然后将从您的测试目录绑定`InterfaceC`到`ConcreteC`，而所有其他接口将绑定到您的生产类。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-11-11T11:35:03.440

您想使用[Juckito](http://jukito.arcbees.com/)，您可以在其中为每个测试类声明自定义配置。

```
@RunWith(JukitoRunner.class)
class LogicTest {
    public static class Module extends JukitoModule {

        @Override
        protected void configureTest() {
            bind(InterfaceC.class).to(MockC.class);
        }
    }

    @Inject
    private InterfaceC logic;

    @Test
    public testLogicUsingMock() {
        logic.foo();
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-04-27T17:10:20.177

在不同的设置中，我们在单独的模块中定义了多个活动。注入的活动位于 Android 库模块中，在 AndroidManifest.xml 文件中具有自己的 RoboGuice 模块定义。

设置看起来像这样。在库模块中有以下定义：

AndroidManifest.xml：

```
<application android:allowBackup="true">
    <activity android:name="com.example.SomeActivity/>
    <meta-data
        android:name="roboguice.modules"
        android:value="com.example.MainModule" />
</application> 
```

然后我们注入了一个类型：

```
interface Foo { } 
```

Foo 的一些默认实现：

```
class FooThing implements Foo { } 
```

MainModule 为 Foo 配置 FooThing 实现：

```
public class MainModule extends AbstractModule {
    @Override
    protected void configure() {
        bind(Foo.class).to(FooThing.class);
    }
} 
```

最后，一个消耗 Foo 的 Activity：

```
public class SomeActivity extends RoboActivity {
    @Inject
    private Foo foo;
} 
```

在消费的 Android 应用程序模块中，我们想使用`SomeActivity`但出于测试目的，注入我们自己的`Foo`.

```
public class SomeOtherActivity extends Activity {
    @Override
    protected void onResume() {
        super.onResume();

        Intent intent = new Intent(this, SomeActivity.class);
        startActivity(intent);
    }
} 
```

有人可能会争论将模块处理暴露给客户端应用程序，但是，我们需要隐藏被注入的组件，因为库模块是一个 SDK，并且暴露部分具有更大的含义。

（记住，这是为了测试，所以我们知道 SomeActivity 的内部结构，并且知道它消耗了一个（包可见的）Foo）。

我发现可行的方式是有道理的；使用建议的覆盖进行*测试*：

```
public class SomeOtherActivity extends Activity {
    private class OverrideModule
            extends AbstractModule {

        @Override
        protected void configure() {
            bind(Foo.class).to(OtherFooThing.class);
        }
    }

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
        RoboGuice.overrideApplicationInjector(
                getApplication(),
                RoboGuice.newDefaultRoboModule(getApplication()),
                Modules
                        .override(new MainModule())
                        .with(new OverrideModule()));
    }

    @Override
    protected void onResume() {
        super.onResume();

        Intent intent = new Intent(this, SomeActivity.class);
        startActivity(intent);
    }
} 
```

现在，当`SomeActivity`启动时，它将获取`OtherFooThing`其注入的`Foo`实例。

这是一种非常特殊的情况，在我们的例子中，OtherFooThing 用于内部记录测试情况，而 FooThing 默认用于所有其他用途。

请记住，我们在单元测试*中*使用`#newDefaultRoboModule`它，它完美无缺。

# asp.net-mvc - 如何将 ASP.NET MVC 视图呈现为字符串？

> ID：483091
> 
> 赞同：504
> 
> 时间：2009-01-27T11:43:56.953
> 
> 标签：asp.net-mvc, rendering

我想输出两个不同的视图（一个作为将作为电子邮件发送的字符串），另一个是显示给用户的页面。

这在 ASP.NET MVC beta 中可行吗？

我尝试了多个示例：

**1\.** [ASP.NET MVC Beta 中的 RenderPartial 到 String](http://brightmix.com/blog/how-to-renderpartial-to-string-in-asp-net-mvc/)

> 如果我使用此示例，我会收到“发送 HTTP 标头后无法重定向。”。

**2\.** [MVC 框架：捕获视图的输出](http://mikehadlow.blogspot.com/2008/06/mvc-framework-capturing-output-of-view_05.html)

> 如果我使用它，我似乎无法执行redirectToAction，因为它试图呈现一个可能不存在的视图。如果我确实返回视图，它就会完全混乱并且看起来根本不正确。

有没有人对我遇到的这些问题有任何想法/解决方案，或者对更好的问题有任何建议？

非常感谢！

下面是一个例子。我要做的是创建**GetViewForEmail 方法**：

```
public ActionResult OrderResult(string ref)
{
    //Get the order
    Order order = OrderService.GetOrder(ref);

    //The email helper would do the meat and veg by getting the view as a string
    //Pass the control name (OrderResultEmail) and the model (order)
    string emailView = GetViewForEmail("OrderResultEmail", order);

    //Email the order out
    EmailHelper(order, emailView);
    return View("OrderResult", order);
} 
```

**Tim Scott 接受的回答（我做了一些修改和格式化）：**

```
public virtual string RenderViewToString(
    ControllerContext controllerContext,
    string viewPath,
    string masterPath,
    ViewDataDictionary viewData,
    TempDataDictionary tempData)
{
    Stream filter = null;
    ViewPage viewPage = new ViewPage();

    //Right, create our view
    viewPage.ViewContext = new ViewContext(controllerContext, new WebFormView(viewPath, masterPath), viewData, tempData);

    //Get the response context, flush it and get the response filter.
    var response = viewPage.ViewContext.HttpContext.Response;
    response.Flush();
    var oldFilter = response.Filter;

    try
    {
        //Put a new filter into the response
        filter = new MemoryStream();
        response.Filter = filter;

        //Now render the view into the memorystream and flush the response
        viewPage.ViewContext.View.Render(viewPage.ViewContext, viewPage.ViewContext.HttpContext.Response.Output);
        response.Flush();

        //Now read the rendered view.
        filter.Position = 0;
        var reader = new StreamReader(filter, response.ContentEncoding);
        return reader.ReadToEnd();
    }
    finally
    {
        //Clean up.
        if (filter != null)
        {
            filter.Dispose();
        }

        //Now replace the response filter
        response.Filter = oldFilter;
    }
} 
```

**示例用法**

假设控制器调用以获取订单确认电子邮件，并传递 Site.Master 位置。

```
string myString = RenderViewToString(this.ControllerContext, "~/Views/Order/OrderResultEmail.aspx", "~/Views/Shared/Site.Master", this.ViewData, this.TempData); 
```

* * *

## 回答 #1

> 赞同：587
> 
> 时间：2010-05-03T17:26:35.870

这是我想出的，它对我有用。我将以下方法添加到我的控制器基类中。（您总是可以在其他地方制作这些静态方法，我想这些方法接受控制器作为参数）

**MVC2 .ascx 风格**

```
protected string RenderViewToString<T>(string viewPath, T model) {
  ViewData.Model = model;
  using (var writer = new StringWriter()) {
    var view = new WebFormView(ControllerContext, viewPath);
    var vdd = new ViewDataDictionary<T>(model);
    var viewCxt = new ViewContext(ControllerContext, view, vdd,
                                new TempDataDictionary(), writer);
    viewCxt.View.Render(viewCxt, writer);
    return writer.ToString();
  }
} 
```

**剃刀 .cshtml 样式**

```
public string RenderRazorViewToString(string viewName, object model)
{
  ViewData.Model = model;
  using (var sw = new StringWriter())
  {
    var viewResult = ViewEngines.Engines.FindPartialView(ControllerContext,
                                                             viewName);
    var viewContext = new ViewContext(ControllerContext, viewResult.View,
                                 ViewData, TempData, sw);
    viewResult.View.Render(viewContext, sw);
    viewResult.ViewEngine.ReleaseView(ControllerContext, viewResult.View);
    return sw.GetStringBuilder().ToString();
  }
} 
```

编辑：添加 Razor 代码。

* * *

## 回答 #2

> 赞同：71
> 
> 时间：2013-09-24T09:42:01.873

这个答案不在我的路上。这最初来自[https://stackoverflow.com/a/2759898/2318354](https://stackoverflow.com/a/2759898/2318354) 但在这里我展示了将它与“静态”关键字一起使用以使其对所有控制器通用的方法。

为此，您必须`static`在类文件中创建类。（假设您的类文件名是 Utils.cs ）

此示例适用于 Razor。

**实用程序.cs**

```
public static class RazorViewToString
{
    public static string RenderRazorViewToString(this Controller controller, string viewName, object model)
    {
        controller.ViewData.Model = model;
        using (var sw = new StringWriter())
        {
            var viewResult = ViewEngines.Engines.FindPartialView(controller.ControllerContext, viewName);
            var viewContext = new ViewContext(controller.ControllerContext, viewResult.View, controller.ViewData, controller.TempData, sw);
            viewResult.View.Render(viewContext, sw);
            viewResult.ViewEngine.ReleaseView(controller.ControllerContext, viewResult.View);
            return sw.GetStringBuilder().ToString();
        }
    }
} 
```

现在，您可以通过将“this”作为参数传递给控制器​​，在控制器文件中添加名称空间，从而从控制器调用此类。

```
string result = RazorViewToString.RenderRazorViewToString(this ,"ViewName", model); 
```

正如@Sergey 给出的建议，这个扩展方法也可以从控制器调用，如下所示

```
string result = this.RenderRazorViewToString("ViewName", model); 
```

我希望这对您使代码干净整洁有用。

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2009-01-27T19:48:12.297

这对我有用：

```
public virtual string RenderView(ViewContext viewContext)
{
    var response = viewContext.HttpContext.Response;
    response.Flush();
    var oldFilter = response.Filter;
    Stream filter = null;
    try
    {
        filter = new MemoryStream();
        response.Filter = filter;
        viewContext.View.Render(viewContext, viewContext.HttpContext.Response.Output);
        response.Flush();
        filter.Position = 0;
        var reader = new StreamReader(filter, response.ContentEncoding);
        return reader.ReadToEnd();
    }
    finally
    {
        if (filter != null)
        {
            filter.Dispose();
        }
        response.Filter = oldFilter;
    }
} 
```

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2009-08-06T20:32:57.443

我找到了一个新的解决方案，它可以将视图呈现为字符串，而不必弄乱当前 HttpContext 的响应流（它不允许您更改响应的 ContentType 或其他标头）。

基本上，你所做的就是创建一个假的 HttpContext 来让视图自己呈现：

```
/// <summary>Renders a view to string.</summary>
public static string RenderViewToString(this Controller controller,
                                        string viewName, object viewData) {
    //Create memory writer
    var sb = new StringBuilder();
    var memWriter = new StringWriter(sb);

    //Create fake http context to render the view
    var fakeResponse = new HttpResponse(memWriter);
    var fakeContext = new HttpContext(HttpContext.Current.Request, fakeResponse);
    var fakeControllerContext = new ControllerContext(
        new HttpContextWrapper(fakeContext),
        controller.ControllerContext.RouteData,
        controller.ControllerContext.Controller);

    var oldContext = HttpContext.Current;
    HttpContext.Current = fakeContext;

    //Use HtmlHelper to render partial view to fake context
    var html = new HtmlHelper(new ViewContext(fakeControllerContext,
        new FakeView(), new ViewDataDictionary(), new TempDataDictionary()),
        new ViewPage());
    html.RenderPartial(viewName, viewData);

    //Restore context
    HttpContext.Current = oldContext;    

    //Flush memory and return output
    memWriter.Flush();
    return sb.ToString();
}

/// <summary>Fake IView implementation used to instantiate an HtmlHelper.</summary>
public class FakeView : IView {
    #region IView Members

    public void Render(ViewContext viewContext, System.IO.TextWriter writer) {
        throw new NotImplementedException();
    }

    #endregion
} 
```

这适用于 ASP.NET MVC 1.0，以及 ContentResult、JsonResult 等（更改原始 HttpResponse 上的标头不会引发“*服务器无法在发送 HTTP 标头后设置内容类型*”异常）。

**更新：**在 ASP.NET MVC 2.0 RC 中，代码发生了一些变化，因为我们必须传入`StringWriter`用于将视图写入的`ViewContext`:

```
//...

//Use HtmlHelper to render partial view to fake context
var html = new HtmlHelper(
    new ViewContext(fakeControllerContext, new FakeView(),
        new ViewDataDictionary(), new TempDataDictionary(), memWriter),
    new ViewPage());
html.RenderPartial(viewName, viewData);

//... 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2014-10-02T07:13:55.033

[本文](http://www.codemag.com/Article/1312081)介绍了不同场景下如何将 View 渲染为字符串：

1.  MVC 控制器调用另一个自己的 ActionMethods
2.  MVC 控制器调用另一个 MVC 控制器的 ActionMethod
3.  WebAPI 控制器调用 MVC 控制器的 ActionMethod

解决方案/代码作为一个名为**ViewRenderer**的类提供。它是[GitHub 上 Rick Stahl 的 WestwindToolkit 的](https://github.com/RickStrahl/WestwindToolkit/blob/master/Westwind.Web.Mvc/Utils/ViewRenderer.cs)一部分。

**用法**（3\. - WebAPI 示例）：

```
string html = ViewRenderer.RenderView("~/Areas/ReportDetail/Views/ReportDetail/Index.cshtml", ReportVM.Create(id)); 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2013-09-18T19:49:01.640

如果你想完全放弃 MVC，从而避免所有的 HttpContext 混乱......

```
using RazorEngine;
using RazorEngine.Templating; // For extension methods.

string razorText = System.IO.File.ReadAllText(razorTemplateFileLocation);
string emailBody = Engine.Razor.RunCompile(razorText, "templateKey", typeof(Model), model); 
```

这里使用了很棒的开源 Razor 引擎： [https ://github.com/Antaris/RazorEngine](https://github.com/Antaris/RazorEngine)

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2019-09-28T08:19:18.980

ASP NET CORE 的附加提示：

界面：

```
public interface IViewRenderer
{
  Task<string> RenderAsync<TModel>(Controller controller, string name, TModel model);
} 
```

执行：

```
public class ViewRenderer : IViewRenderer
{
  private readonly IRazorViewEngine viewEngine;

  public ViewRenderer(IRazorViewEngine viewEngine) => this.viewEngine = viewEngine;

  public async Task<string> RenderAsync<TModel>(Controller controller, string name, TModel model)
  {
    ViewEngineResult viewEngineResult = this.viewEngine.FindView(controller.ControllerContext, name, false);

    if (!viewEngineResult.Success)
    {
      throw new InvalidOperationException(string.Format("Could not find view: {0}", name));
    }

    IView view = viewEngineResult.View;
    controller.ViewData.Model = model;

    await using var writer = new StringWriter();
    var viewContext = new ViewContext(
       controller.ControllerContext,
       view,
       controller.ViewData,
       controller.TempData,
       writer,
       new HtmlHelperOptions());

       await view.RenderAsync(viewContext);

       return writer.ToString();
  }
} 
```

登记在`Startup.cs`

```
...
 services.AddSingleton<IViewRenderer, ViewRenderer>();
... 
```

以及在控制器中的用法：

```
public MyController: Controller
{
  private readonly IViewRenderer renderer;
  public MyController(IViewRendere renderer) => this.renderer = renderer;
  public async Task<IActionResult> MyViewTest
  {
    var view = await this.renderer.RenderAsync(this, "MyView", model);
    return new OkObjectResult(view);
  }
} 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2015-03-23T12:47:24.880

您可以使用这种方式获取字符串中的视图

```
protected string RenderPartialViewToString(string viewName, object model)
{
    if (string.IsNullOrEmpty(viewName))
        viewName = ControllerContext.RouteData.GetRequiredString("action");

    if (model != null)
        ViewData.Model = model;

    using (StringWriter sw = new StringWriter())
    {
        ViewEngineResult viewResult = ViewEngines.Engines.FindPartialView(ControllerContext, viewName);
        ViewContext viewContext = new ViewContext(ControllerContext, viewResult.View, ViewData, TempData, sw);
        viewResult.View.Render(viewContext, sw);

        return sw.GetStringBuilder().ToString();
    }
} 
```

我们以两种方式调用此方法

```
string strView = RenderPartialViewToString("~/Views/Shared/_Header.cshtml", null) 
```

或者

```
var model = new Person()
string strView = RenderPartialViewToString("~/Views/Shared/_Header.cshtml", model) 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2017-03-02T15:32:05.603

要在服务层中将视图呈现给字符串而不必传递 ControllerContext，这里有一篇很好的 Rick Strahl 文章[http://www.codemag.com/Article/1312081](http://www.codemag.com/Article/1312081)，它创建了一个通用控制器。代码摘要如下：

```
// Some Static Class
public static string RenderViewToString(ControllerContext context, string viewPath, object model = null, bool partial = false)
{
    // first find the ViewEngine for this view
    ViewEngineResult viewEngineResult = null;
    if (partial)
        viewEngineResult = ViewEngines.Engines.FindPartialView(context, viewPath);
    else
        viewEngineResult = ViewEngines.Engines.FindView(context, viewPath, null);

    if (viewEngineResult == null)
        throw new FileNotFoundException("View cannot be found.");

    // get the view and attach the model to view data
    var view = viewEngineResult.View;
    context.Controller.ViewData.Model = model;

    string result = null;

    using (var sw = new StringWriter())
    {
        var ctx = new ViewContext(context, view, context.Controller.ViewData, context.Controller.TempData, sw);
        view.Render(ctx, sw);
        result = sw.ToString();
    }

    return result;
}

// In the Service Class
public class GenericController : Controller
{ }

public static T CreateController<T>(RouteData routeData = null) where T : Controller, new()
{
    // create a disconnected controller instance
    T controller = new T();

    // get context wrapper from HttpContext if available
    HttpContextBase wrapper;
    if (System.Web.HttpContext.Current != null)
        wrapper = new HttpContextWrapper(System.Web.HttpContext.Current);
    else
        throw new InvalidOperationException("Cannot create Controller Context if no active HttpContext instance is available.");

    if (routeData == null)
        routeData = new RouteData();

    // add the controller routing if not existing
    if (!routeData.Values.ContainsKey("controller") &&
        !routeData.Values.ContainsKey("Controller"))
        routeData.Values.Add("controller", controller.GetType().Name.ToLower().Replace("controller", ""));

    controller.ControllerContext = new ControllerContext(wrapper, routeData, controller);
    return controller;
} 
```

然后在服务类中渲染视图：

```
var stringView = RenderViewToString(CreateController<GenericController>().ControllerContext, "~/Path/To/View/Location/_viewName.cshtml", theViewModel, true); 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-07-13T20:44:07.033

我正在使用 MVC 1.0 RTM，但上述解决方案都不适合我。但是这个做到了：

```
Public Function RenderView(ByVal viewContext As ViewContext) As String

    Dim html As String = ""

    Dim response As HttpResponse = HttpContext.Current.Response

    Using tempWriter As New System.IO.StringWriter()

        Dim privateMethod As MethodInfo = response.GetType().GetMethod("SwitchWriter", BindingFlags.NonPublic Or BindingFlags.Instance)

        Dim currentWriter As Object = privateMethod.Invoke(response, BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.InvokeMethod, Nothing, New Object() {tempWriter}, Nothing)

        Try
            viewContext.View.Render(viewContext, Nothing)
            html = tempWriter.ToString()
        Finally
            privateMethod.Invoke(response, BindingFlags.NonPublic Or BindingFlags.Instance Or BindingFlags.InvokeMethod, Nothing, New Object() {currentWriter}, Nothing)
        End Try

    End Using

    Return html

End Function 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2012-02-20T21:34:56.970

我从另一个网站看到了 MVC 3 和 Razor 的实现，它对我有用：

```
 public static string RazorRender(Controller context, string DefaultAction)
    {
        string Cache = string.Empty;
        System.Text.StringBuilder sb = new System.Text.StringBuilder();
        System.IO.TextWriter tw = new System.IO.StringWriter(sb); 

        RazorView view_ = new RazorView(context.ControllerContext, DefaultAction, null, false, null);
        view_.Render(new ViewContext(context.ControllerContext, view_, new ViewDataDictionary(), new TempDataDictionary(), tw), tw);

        Cache = sb.ToString(); 

        return Cache;

    } 

    public static string RenderRazorViewToString(string viewName, object model)
    {

        ViewData.Model = model;
        using (var sw = new StringWriter())
        {
            var viewResult = ViewEngines.Engines.FindPartialView(ControllerContext, viewName);
            var viewContext = new ViewContext(ControllerContext, viewResult.View, ViewData, TempData, sw);
            viewResult.View.Render(viewContext, sw);
            return sw.GetStringBuilder().ToString();
        }
    } 

    public static class HtmlHelperExtensions
    {
        public static string RenderPartialToString(ControllerContext context, string partialViewName, ViewDataDictionary viewData, TempDataDictionary tempData)
        {
            ViewEngineResult result = ViewEngines.Engines.FindPartialView(context, partialViewName);

            if (result.View != null)
            {
                StringBuilder sb = new StringBuilder();
                using (StringWriter sw = new StringWriter(sb))
                {
                    using (HtmlTextWriter output = new HtmlTextWriter(sw))
                    {
                        ViewContext viewContext = new ViewContext(context, result.View, viewData, tempData, output);
                        result.View.Render(viewContext, output);
                    }
                }
                return sb.ToString();
            } 

            return String.Empty;

        }

    } 
```

更多关于[Razor 渲染 - MVC3 视图渲染到字符串](http://akinyusufer.blogspot.co.nz/2011/05/razor-render-mvc3-view-render-to-string.html)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-06-15T16:42:27.087

小建议

对于强类型模型，只需将其添加到 ViewData.Model 属性，然后再传递给 RenderViewToString。例如

```
this.ViewData.Model = new OrderResultEmailViewModel(order);
string myString = RenderViewToString(this.ControllerContext, "~/Views/Order/OrderResultEmail.aspx", "~/Views/Shared/Site.Master", this.ViewData, this.TempData); 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-03-31T15:58:05.017

要重复一个更未知的问题，请查看[MvcIntegrationTestFramework](http://blog.codeville.net/2009/06/11/integration-testing-your-aspnet-mvc-application/)。

它可以节省您编写自己的助手来流式传输结果，并且被证明可以很好地工作。我假设这将在一个测试项目中，作为奖励，一旦你有了这个设置，你就会拥有其他测试功能。主要麻烦可能是整理依赖链。

```
 private static readonly string mvcAppPath = 
     Path.GetFullPath(AppDomain.CurrentDomain.BaseDirectory 
     + "\\..\\..\\..\\MyMvcApplication");
 private readonly AppHost appHost = new AppHost(mvcAppPath);

    [Test]
    public void Root_Url_Renders_Index_View()
    {
        appHost.SimulateBrowsingSession(browsingSession => {
            RequestResult result = browsingSession.ProcessRequest("");
            Assert.IsTrue(result.ResponseText.Contains("<!DOCTYPE html"));
        });
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2016-06-09T11:28:41.753

这是我为 ASP.NETCore RC2 编写的一个类。我使用它，所以我可以使用 Razor 生成 html 电子邮件。

```
using Microsoft.AspNetCore.Http;
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Mvc.Abstractions;
using Microsoft.AspNetCore.Mvc.ModelBinding;
using Microsoft.AspNetCore.Mvc.Rendering;
using Microsoft.AspNetCore.Mvc.ViewEngines;
using Microsoft.AspNetCore.Mvc.ViewFeatures;
using Microsoft.AspNetCore.Routing;
using System.IO;
using System.Threading.Tasks;

namespace cloudscribe.Web.Common.Razor
{
    /// <summary>
    /// the goal of this class is to provide an easy way to produce an html string using 
    /// Razor templates and models, for use in generating html email.
    /// </summary>
    public class ViewRenderer
    {
        public ViewRenderer(
            ICompositeViewEngine viewEngine,
            ITempDataProvider tempDataProvider,
            IHttpContextAccessor contextAccesor)
        {
            this.viewEngine = viewEngine;
            this.tempDataProvider = tempDataProvider;
            this.contextAccesor = contextAccesor;
        }

        private ICompositeViewEngine viewEngine;
        private ITempDataProvider tempDataProvider;
        private IHttpContextAccessor contextAccesor;

        public async Task<string> RenderViewAsString<TModel>(string viewName, TModel model)
        {

            var viewData = new ViewDataDictionary<TModel>(
                        metadataProvider: new EmptyModelMetadataProvider(),
                        modelState: new ModelStateDictionary())
            {
                Model = model
            };

            var actionContext = new ActionContext(contextAccesor.HttpContext, new RouteData(), new ActionDescriptor());
            var tempData = new TempDataDictionary(contextAccesor.HttpContext, tempDataProvider);

            using (StringWriter output = new StringWriter())
            {

                ViewEngineResult viewResult = viewEngine.FindView(actionContext, viewName, true);

                ViewContext viewContext = new ViewContext(
                    actionContext,
                    viewResult.View,
                    viewData,
                    tempData,
                    output,
                    new HtmlHelperOptions()
                );

                await viewResult.View.RenderAsync(viewContext);

                return output.GetStringBuilder().ToString();
            }
        }
    }
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-08-12T16:33:38.907

当我使用上述方法出错时，我找到了一种更好的方法来呈现剃刀视图页面，这个解决方案适用于 web 表单环境和 mvc 环境。不需要控制器。

这是代码示例，在此示例中，我使用异步 http 处理程序模拟了 mvc 操作：

```
 /// <summary>
    /// Enables processing of HTTP Web requests asynchronously by a custom HttpHandler that implements the IHttpHandler interface.
    /// </summary>
    /// <param name="context">An HttpContext object that provides references to the intrinsic server objects.</param>
    /// <returns>The task to complete the http request.</returns>
    protected override async Task ProcessRequestAsync(HttpContext context)
    {
        if (this._view == null)
        {
            this.OnError(context, new FileNotFoundException("Can not find the mvc view file.".Localize()));
            return;
        }
        object model = await this.LoadModelAsync(context);
        WebPageBase page = WebPageBase.CreateInstanceFromVirtualPath(this._view.VirtualPath);
        using (StringWriter sw = new StringWriter())
        {
            page.ExecutePageHierarchy(new WebPageContext(new HttpContextWrapper(context), page, model), sw);
            await context.Response.Output.WriteAsync(sw.GetStringBuilder().ToString());
        }
    } 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-11-19T17:59:21.110

对我来说最简单的方法是：

```
 public string GetFileAsString(string path)
  {
        var html = "";                        

        FileStream fileStream = new FileStream(path, FileMode.Open);

        using (StreamReader reader = new StreamReader(fileStream))
        {
            html += reader.ReadLine();
        }

        return html;
   } 
```

我将它用于电子邮件并确保文件仅包含 CSS 和 HTML

# delphi - 兑换 - 查找公用文件夹

> ID：483095
> 
> 赞同：0
> 
> 时间：2009-01-27T11:44:38.717
> 
> 标签：delphi, outlook, exchange-server, outlook-redemption

使用 Redemption 我需要将草稿电子邮件放在特定的公共文件夹中。我知道文件夹的完整路径，但我不知道如何使用 RDO 到达那里。例如。文件夹路径是“\\Public Folders\All Public Folders\XXXX\Drafts”

我正在使用 Delphi2006 和 Exchange 2007，但这没关系......

```
oSession := CreateOleObject('Redemption.RDOSession');
oSession.LogonExchangeMailbox('xxxxx@xxxxxx.co.uk','ServerName');
oStore := oSession.Stores.FindExchangePublicFoldersStore; 
```

关于如何从这里得到的任何指示？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-08T00:47:35.750

只需使用`oSession.GetFolderFromPath`. 您甚至不需要先找到 PF 商店。

有关对象的文档，请参阅[http://dimastr.com/redemption/rdo/rdosession.htm](http://dimastr.com/redemption/rdo/rdosession.htm)`RDOSession`。

# php - 基于 php .tpl 的内容管理系统——优点和缺点

> ID：483096
> 
> 赞同：0
> 
> 时间：2009-01-27T11:44:42.337
> 
> 标签：php, templates, content-management-system

我在一家公司工作，该公司使用基于 php 模板的遗留内容管理系统。我受够了它，因为它远不如现代 CMS（即 Drupal），特别是由于 AJAX 实现能力差和分支模板树的普遍混乱。只要我有可靠的论据支持它，我就有能力切换到更新的 CMS。我决定求助于这个网站上的人，因为我主要不是编码员。放弃旧系统的主要原因是什么？

此致，

麦克风

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T11:55:27.493

我认为这个旧版 CMS 是定制开发的？您可能会争辩说，由于正在进行的开发和支持，使用已建立的开源 CMS 是一个更好的选择 - 而且，一般来说，每当需要一些附加功能时，很有可能已经开发了一个插件或模块来提供那个功能。

因此，我的主要论点是支持和发展收益。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T12:00:53.877

你甚至可以争辩说雅虎！正在使用 Drupal。

# ruby-on-rails - 是否可以测试acts_as_tree的模型

> ID：483103
> 
> 赞同：0
> 
> 时间：2009-01-27T11:47:05.340
> 
> 标签：ruby-on-rails, unit-testing

如何测试`acts_as_tree`单元测试中的模型？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-27T11:53:32.443

您可以使用一些随机值对其进行初始化，并查看[以几种不同的方式](http://www.niksula.cs.hut.fi/~trakla/book/english/node4.html)（例如 preorder、postorder、inorder 和 level order）遍历它是否会产生相同的结果。

# architecture - MSMQ 与临时表转储

> ID：483108
> 
> 赞同：7
> 
> 时间：2009-01-27T11:48:45.883
> 
> 标签：architecture, msmq, message-queue

我知道以前有人问过这个问题。但是环顾四周，我仍然无法决定我应该走哪条路线。这是我的场景，希望你能帮忙：

我们将拥有一系列 Web 服务，这些服务将按计划被数百个移动应用程序访问。这些服务将在设备上提供数据，其中包含进入设备和从设备返回的新信息。从设备返回的数据将需要更新一个中央 SQL 服务器数据库，该数据库还为多个桌面应用程序和一个网站提供数据。

为了减少这些服务的请求/响应时间，我们决定在事后处理来自设备的数据，要么将它们粘贴在 MSMQ 实例中，要么将序列化对象存储在临时数据存储中并拥有Windows 服务稍后处理它们。

所以这是我的选择，但除此之外，还有一些可能会帮助你们给我建议的事情：

*   从设备返回的数据不会以较小的消息包的形式返回，需要在服务器端订购。
*   我对 MSMQ 一无所知，但我以前写过 Windows 服务。尽管如果需要，我可以毫无问题地选择 MSMQ。
*   我想将设备的响应保留在某些地方，以防由于数据引起的某种原因处理失败。通过这种方式，我可以查询数据并查看是否存在问题，即设备允许用户添加评论，以扩展服务器端数据库中相关字段的长度。

有了这些信息，您认为值得我学习 MSMQ 还是我应该坚持使用更简单的解决方案？

克里斯。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-27T15:17:53.857

MSMQ 不是一个糟糕的选择，而且绝对不难学习，但请记住，您应该注意一些限制。

**缺点：**

*   每个队列只能是 2GB。
*   每条消息 4MB（尽管可以通过将 MSMQ 与 WCF 一起使用来修复 4MB 的限制）。
*   仅适用于 Windows，因此您只能将其与 .NET、C/C++ 或 COM 库一起用于支持 COM 的环境。

**优点：**

*   支持 Windows 网络负载均衡器。
*   支持微软集群服务。
*   与活动目录集成。
*   随 Windows 一起提供。
*   支持交易。
*   MSMQ 消息可以通过 Windows 事件日志中的审核消息进行跟踪。
*   消息可以在发送时自动进行身份验证（签名）或加密，并在接收时进行验证和解密。

您可能要考虑的另一种方法是将数据写入临时表。这可能是一个好主意，因为您希望有一个消息回溯日志。

当我不了解系统的其余架构时，很难给出建议，但我希望这个答案能有所帮助。

**有用的链接**

[在 .NET 中编程 MSMQ - 第 1 部分](http://www.codeproject.com/KB/dotnet/mgrmsmq.aspx)
[将 MSMQ 与 WCF 结合使用](http://code.msdn.microsoft.com/msmqpluswcf)

# perl - 如何判断另一个进程何时停止写入 Perl 中的文件？

> ID：483110
> 
> 赞同：4
> 
> 时间：2009-01-27T11:49:39.937
> 
> 标签：perl, file

我有一个使用 FTP 将文件写入文件夹的系统。我需要复制这些文件，但前提是它们的 FTP 系统完成。如何判断第一个进程何时完成写入。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-27T12:07:11.853

另一种可能性是让上传文件的过程以临时名称上传文件，然后重命名它们。

重命名以原子方式进行，因此不会出现文件在其最终名称下不完整的情况。

复制过程可能会忽略临时命名文件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-27T12:01:48.370

扩展zoul的想法：有一个文件表明目标最后一次更新的时间。每次上传后，您都会触摸该文件。

然后，另一端的 cron 进程可以定期检查更新并完成其工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T11:52:29.107

最简单的方法是创建一个指示传输完成的文件？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T19:55:56.570

你应该使用[Linux::Inotify2](http://search.cpan.org/perldoc?Linux::Inotify2)，它就是为这种事情而设计的！:)

只需观看 FTP 目录上的“IN_CLOSE”事件...

# c# - 带有特殊字符的 Asp.net C# 电子邮件地址

> ID：483115
> 
> 赞同：4
> 
> 时间：2009-01-27T11:51:13.867
> 
> 标签：c#, asp.net, email, encoding, special-characters

我正在使用集成的 System.Net.Mail 发送电子邮件

我真的很喜欢

```
MailAddress abs = new System.Net.Mail.MailAddress("my@email.com", "Web Präsenz", System.Text.Encoding.UTF8); 
```

当电子邮件到达客户时，“ä”字符丢失。似乎有些编码问题。

有人知道如何解决吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T15:29:03.270

尝试添加这些：

```
message.BodyEncoding =  System.Text.Encoding.UTF8;
message.SubjectEncoding = System.Text.Encoding.UTF8; 
```

也可能是邮件服务器问题。尝试将其发送到各种电子邮件地址；POP3、WebMail 等

这里有更多信息，尽管您可能已经看过这里：

[http://msdn.microsoft.com/en-us/library/system.net.mail.smtpclient.aspx](http://msdn.microsoft.com/en-us/library/system.net.mail.smtpclient.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-13T16:28:28.340

我刚刚花了5个小时调试一个类似的问题，我找到的解决方案可能也是这个问题的解决方案。由于没有人发布任何其他解决方案，我将贡献我的发现。

.NET2.0 Mail API 中似乎有一个微妙的错误，它导致邮件标头中收件人姓名的编码失败。如果在发送消息之前访问 MailMessage 实例的 To 属性（可能还有其他属性），则会发生这种情况。

以下示例将导致发送 To 标头而不进行编码，至少导致我的邮件客户端将名称显示为“??????...”：

```
MailMessage message = new MailMessage();
message.To.Add(new MailAddress("address@example.com", "ÆØÅ Unicode Name"));
message.Subject = "Subject";
message.Body = "Body";
Console.WriteLine(message.To[0]);
smtpClient.Send(message); 
```

但是，将 WriteLine 移动到发送行下方，会导致 To 标头被正确编码：

```
MailMessage message = new MailMessage();
message.To.Add(new MailAddress("address@example.com", "ÆØÅ Unicode Name"));
message.Subject = "Subject";
message.Body = "Body";
smtpClient.Send(message);
Console.WriteLine(message.To[0]); 
```

我假设这个错误也会发生在 Cc 和 Bcc 属性上，所以要小心这一点。希望任何人都觉得这很有用。

# biztalk - BTSTask ImportBindings

> ID：483116
> 
> 赞同：0
> 
> 时间：2009-01-27T11:51:45.957
> 
> 标签：biztalk

我有一个简单的批处理文件，它在以前导出的绑定文件上执行 BTSTask ImportBindings。似乎没有抛出任何错误。发送/接收端口和编排创建正常。问题是编排没有绑定并且主机没有设置。

我检查了绑定文件，看起来没问题。在 BindingInfo\ModuleRefCollection\ModuleRef\Services\Service 我有编排，这些有 Ports\Port 元素，其中包含 SendPortRef / ReceivePortRef 的有效值。

解决此问题的最佳方法是什么？正如我所说。当我运行 BTSTask ImportBindings 时，命令行没有抛出错误。

非常感谢

抢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T17:34:00.810

感谢您的回答理查德，但我确实尝试通过 BizTalk 管理控制台手动导入绑定文件，这很好。

经过进一步调查，我的同事（感谢 Brad）发现失败的绑定文件与以前的工作版本之间的唯一显着区别在于发送端口的节点。似乎我已经在 XML Spy 中打开了绑定文件并点击了漂亮的打印按钮，这会在通常混乱的节点中插入空格，而这些空格似乎会导致问题

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T19:22:44.357

我遇到了与发送端口上的过滤器元件无关的问题。它可能适用于编排。在过滤器的情况下，文本必须在元素名称之后开始......没有CRLF。过滤器的最后一行，最后一个字符，必须紧挨着结束元素标签。没有 CRLF！这很令人沮丧。绑定将导入，但发送端口将无法以模糊错误启动。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T07:32:39.520

对失败的 BTSTask ImportBindings 操作进行故障排除的最佳方法是手动导入查找文件。右键单击*Applications* -节点或特定应用程序的节点，然后选择*Import Bindings*。然后通常会看到尝试绑定时可能发生的错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T20:45:09.227

我同意 Riri，导入，修复错误然后重新导出绑定文件 - 您可以花费数小时尝试发现绑定文件中的错误。

# c# - C# - 集合和强制转换

> ID：483119
> 
> 赞同：1
> 
> 时间：2009-01-27T11:52:31.087
> 
> 标签：c#, collections, casting

我有一个基类 BaseObject 和许多从 BaseObject 派生的类（DerivedObject1、DerivedObject2 等）

我有一个 BaseObjects 集合，我在其中存储派生对象。我用来执行此操作的代码是：

```
// declaring and initializing the idictionary
public IDictionary<ulong, BaseObject> ObjectList = new Dictionary<ulong, BaseObject>();
// how i add derived objects to the collection
ObjectList.Add(TempObject.Guid, new DerivedObject1(this, TempObject.BaseAddress));
ObjectList.Add(TempObject2.Guid, new DerivedObject2(this, TempObject2.BaseAddress)); 
```

在保存集合的类中，我声明对集合中重要对象的引用，如下所示：

```
// in the class
public DerivedObject3 LocalPlayer;
// in a method inside a class
LocalPlayer = (DerivedObject3)ObjectList[TempObject.Guid]; 
```

在调用分配 LocalPlayer 对 Idictionary 中保存的对象的引用的方法后，我尝试在我的主要方法中访问有关 LocalPlayer 的信息（特定于“DerivedObject3”）：

```
static void Main()
{
    ObjectManager OM = new ObjectManager();
    OM.LoadAddresses();
    OM.PopulateList();
    Console.WriteLine(OM.LocalPlayer.Type);
    Console.ReadLine();
} 
```

然而，这只是返回'0'。我想我一定是不小心“重置”了这个对象。一般来说，我对 .NET 或 OOP 不太熟悉（这是一种爱好）。

如有必要，我可以发布更多代码（真实代码，而不是“BaseObject”等）。谢谢你。

**编辑** 在我需要发布更多代码的评论之后（我不确定哪些位与问题有关）我将发布更多代码（并且不再使用“BaseObject”等）WowObject 类：

```
class WowObject
{
    protected const uint GuidOffset = 0x30,
        NextObjectOffset = 0x3C,
        TypeOffset = 0x14,
        XPositionOffset = 0x7D0,
        YPositionOffset = 0x7D4,
        ZPositionOffset = 0x7D8,
        RotationOffset = 0x7DC,
        DescriptorFieldsOffset = 0x8;

    protected uint baseAddress;
    protected ObjectManager OM;

    public WowObject(ObjectManager OM, uint baseAddress)
    {
        this.baseAddress = baseAddress;
        this.OM = OM;
    }

    public uint BaseAddress
    {
        get { return baseAddress; }
        set { baseAddress = value; }
    }

    public uint DescriptorFields
    {
        get { return OM.ReadUInt32((IntPtr)(BaseAddress + DescriptorFieldsOffset)); }
    }

    public int Type
    {
        get { return OM.ReadInt32((IntPtr)(BaseAddress + TypeOffset)); }
    }

    public virtual ulong Guid
    {
        get { return OM.ReadULong((IntPtr)(BaseAddress + GuidOffset)); }
        set { return;  }
    }

    public virtual float XPos
    {
        get { return OM.ReadFloat((IntPtr)(BaseAddress + XPositionOffset)); }
    }

    public virtual float YPos
    {
        get { return OM.ReadFloat((IntPtr)(BaseAddress + YPositionOffset)); }
    }

    public virtual float ZPos
    {
        get { return OM.ReadFloat((IntPtr)(BaseAddress + ZPositionOffset)); }
    }

    public float Rotation
    {
        get { return OM.ReadFloat((IntPtr)(BaseAddress + RotationOffset)); }
    }
}

class CreatureObject : WowObject
{
    protected const uint LevelOffset = 0x35 * 4,
        CurrentHealthOffset = 0x17 * 4,
        MaxHealthOffset = 0x1F * 4,
        CurrentManaOffset = 0x18 * 4,
        MaxManaOffset = 0x20 * 4,
        TargetGuidOffset = 0x12*4;
    private CreatureObject targetObject;

    public CreatureObject(ObjectManager OM, uint BaseAddress)
        : base(OM, BaseAddress)
    { }

    public CreatureObject TargetObject
    {
        get { return targetObject; }
        set { targetObject = value; }
    }

    public ulong TargetGuid
    {
        get { return OM.ReadULong((IntPtr)(BaseAddress + TargetGuid)); }
    }

    public int Level
    {
        get { return OM.ReadInt32((IntPtr)(DescriptorFields + LevelOffset)); }
    }

    public int CurrentHealth
    {
        get { return OM.ReadInt32((IntPtr)(DescriptorFields + CurrentHealthOffset)); }
    }

    public int MaxHealth
    {
        get { return OM.ReadInt32((IntPtr)(DescriptorFields + MaxHealthOffset)); }
    }

    public int CurrentMana
    {
        get { return OM.ReadInt32((IntPtr)(DescriptorFields + CurrentMana)); }
    }

    public int MaxMana
    {
        get { return OM.ReadInt32((IntPtr)(DescriptorFields + MaxManaOffset)); }
    }

    public int HealthPercent
    {
        get
        {
            double percentage = CurrentHealth / MaxHealth;
            percentage = percentage * 100;
            return (int)Math.Round(percentage);
        }
    }
}

class NpcObject : CreatureObject
{
    protected const uint SummonedByOffset = 0xE * 4,
        AttackingGuidOffset = 0x0A38;

    public NpcObject(ObjectManager OM, uint BaseAddress)
        : base(OM, BaseAddress)
    { }

    public ulong AttackingGuid
    {
        get { return OM.ReadULong((IntPtr)(BaseAddress + AttackingGuidOffset)); }
    }

    public ulong SummonedBy
    {
        get { return OM.ReadULong((IntPtr)(DescriptorFields + SummonedByOffset)); }
    }
}

class PlayerObject : CreatureObject
{
    protected const uint CurrentRageOffset = 0x19 * 4,
        CurrentEnergyOffset = 0x1B * 4,
        MaxEnergyOffset = 0x23 * 4;

    public PlayerObject(ObjectManager OM, uint BaseAddress)
        : base(OM, BaseAddress)
    { }

    public int CurrentRage
    {
        get
        {
            int RageTemp = OM.ReadInt32((IntPtr)(DescriptorFields + CurrentRageOffset));
            return (int)(Math.Floor((double)(RageTemp / 10)));
        }
    }

    public int MaxRage
    {
        get { return 100; }
    }

    public int CurrentEnergy
    {
        get { return OM.ReadInt32((IntPtr)(DescriptorFields + CurrentEnergyOffset)); }
    }

    public int MaxEnergy
    {
        get { return OM.ReadInt32((IntPtr)(DescriptorFields + MaxEnergyOffset)); }
    }
}

class LocalCharacter : PlayerObject
{
    private ulong guid = 0;

    public LocalCharacter(ObjectManager OM, uint BaseAddress)
        : base(OM, BaseAddress)
    { }

    public override ulong Guid
    {
        get { return guid; }
        set { guid = value; }
    }
}

class GameObject : WowObject
{
    protected const uint gameObject_XPos = 0x10 * 4,
        gameObject_YPos = 0x11 * 4,
        gameObject_ZPos = 0x12 * 4;

    public GameObject(ObjectManager OM, uint BaseAddress)
        : base(OM, BaseAddress)
    { }

    public override float XPos
    {
        get { return OM.ReadFloat((IntPtr)(DescriptorFields + gameObject_XPos)); }
    }

    public override float YPos
    {
        get { return OM.ReadFloat((IntPtr)(DescriptorFields + gameObject_YPos)); }
    }

    public override float ZPos
    {
        get { return OM.ReadFloat((IntPtr)(DescriptorFields + gameObject_ZPos)); }
    }
}

class DynamicObject : WowObject
{
    protected const uint dynamicObject_XPos = 0xB * 4,
        dynamicObject_YPos = 0xC * 4,
        dynamicObject_ZPos = 0xD * 4;

    public DynamicObject(ObjectManager OM, uint BaseAddress)
        : base(OM, BaseAddress)
    { }

    public override float XPos
    {
        get { return OM.ReadFloat((IntPtr)(DescriptorFields + dynamicObject_XPos)); }
    }

    public override float YPos
    {
        get { return OM.ReadFloat((IntPtr)(DescriptorFields + dynamicObject_YPos)); }
    }

    public override float ZPos
    {
        get { return OM.ReadFloat((IntPtr)(DescriptorFields + dynamicObject_ZPos)); }
    }
}

class CorpseObject : WowObject
{
    protected const uint corpseObject_XPos = 0xB * 4,
            corpseObject_YPos = 0xC * 4,
            corpseObject_ZPos = 0xD * 4;

    public CorpseObject(ObjectManager OM, uint BaseAddress)
        : base(OM, BaseAddress)
    { }

    public override float XPos
    {
        get { return OM.ReadFloat((IntPtr)(DescriptorFields + corpseObject_XPos)); }
    }

    public override float YPos
    {
        get { return OM.ReadFloat((IntPtr)(DescriptorFields + corpseObject_YPos)); }
    }

    public override float ZPos
    {
        get { return OM.ReadFloat((IntPtr)(DescriptorFields + corpseObject_ZPos)); }
    }
} 
```

对象管理器 - 扩展了一个内存读取类（这是 ReadUInt32 等的来源）

```
class ObjectManager : Memory
{
    public IDictionary<ulong, WowObject> ObjectList = new Dictionary<ulong, WowObject>();

    public LocalCharacter LocalPlayer;

    private const uint staticClientConnection = 0x011CA310,     // static client connection, same address every boot
        objectManagerOffset = 0x28A4,                           // offset from the ClientConnection to the object manager
        localGuidOffset = 0xC0,                                 // offset from the object manager to the local guid
        firstObjectOffset = 0xAC,                               // offset from the object manager to the first object
        nextObjectOffset = 0x3C;                                // offset from
    private uint objectManagerBase;                             // the address off the object manager

    public void LoadAddresses()
    {
        objectManagerBase = ReadUInt32((IntPtr)(ReadUInt32((IntPtr)(staticClientConnection)) + objectManagerOffset));
        LocalPlayer = new LocalCharacter(this, ReadUInt32((IntPtr)(objectManagerBase + localGuidOffset)));
    }

    public void PopulateList()
    {
        WowObject TempObject = new WowObject(this, ReadUInt32((IntPtr)(objectManagerBase + firstObjectOffset)));

        while (TempObject.BaseAddress != 0 && TempObject.BaseAddress % 2 == 0)
        {
            if (TempObject.Type == 3)
                ObjectList.Add(TempObject.Guid, new NpcObject(this, TempObject.BaseAddress));
            if (TempObject.Type == 4)
            {
                if (TempObject.Guid != LocalPlayer.Guid)
                    ObjectList.Add(TempObject.Guid, new PlayerObject(this, TempObject.BaseAddress));
                else
                {
                    ObjectList.Add(TempObject.Guid, new PlayerObject(this, TempObject.BaseAddress));
                    LocalPlayer = (LocalCharacter)ObjectList[TempObject.Guid];
                }
            }

            TempObject.BaseAddress = ReadUInt32((IntPtr)(TempObject.BaseAddress + nextObjectOffset));
        }
    }
} 
```

主要方法：

```
static void Main()
{
    ObjectManager OM = new ObjectManager();
    OM.SetProcess("Wow", "Read");
    OM.LoadAddresses();
    OM.PopulateList();
    Console.WriteLine(OM.LocalPlayer.Type);
    Console.ReadLine();
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-27T12:00:18.637

将基类中的方法设为虚拟方法，将派生类中的方法设为覆盖。根据经验，避免向下转换为特定类型，您应该使用基类中的属性/方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T14:35:34.893

如果您在一个集合中存储多个相同基类型的对象，通常您永远不想指定对象的确切类型。看看这篇[关于 OOD 原则的博文](http://www.noctovis.net/blog/index.php/2009/01/15/design-principles/)。具体来说，您违反了 Liskov Substitution 原则，该原则在本文中进行了简要说明，并且链接到了更深入的说明。

我建议多读几遍这篇文章，花一些时间在该博客和维基百科中包含的链接上探索 OOD，因为它是一个非常技术性的主题。这不是通常可以在一次阅读中学到的东西。即使在您理解了这些概念之后，它也需要有意识地努力正确使用，但在当今编写软件时它基本上是必不可少的。

# web-applications - 如何开始为 Web 应用程序建模？

> ID：483121
> 
> 赞同：7
> 
> 时间：2009-01-27T11:53:06.453
> 
> 标签：web-applications, modeling

我问这个，因为明天是我与客户的第一次会面，她告诉我，她现在（手动）在做什么以及它是什么，新的 Web 应用程序最终应该做什么。

我想知道，在她向我展示了该过程的步骤期间，我做了什么。我是否能够识别用例并直接对其建模？我是否在 prosa 中描述了这个过程？我如何将过程从现实世界描述/转录为模型，然后作为代码的基础？

对您来说，开始新开发的最佳实践是什么？有小费吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-27T12:15:11.680

这全都与**流程**和**管理期望**有关，与技术无关。大多数客户（尤其是小型咨询公司）犯的错误（恕我直言）是他们选择了固定价格合同（可能需要支付 T&M 支持：时间和材料）。他们这样做是为了进行风险管理，所以这是可以理解的。

问题是他们以三种方式为较低的风险付出代价：

*   您为较低的风险支付溢价。这是一个基本原则，在软件开发和金融市场中同样适用；
*   开发人员面临的风险如此之大，以至于成本呈天文数字上升，而这恰恰对任何人都没有好处（好吧，它对开发人员有利，直到事情发生灾难性错误，他们最终几乎总是这样做）；和
*   您花费了大量时间来开发规范并正式确定您忘记的可交付成果和验收标准，因此您只花了 30 万美元编写了 300 页的 Word 文档，而不是，您知道，编码一些东西。

所有这些都使最终结果对客户来说更加昂贵，使开发人员失去动力（谁想写 300 页的 Word 文档？说真的！）并且延迟了客户实际获得任何东西（从而增加了范围蔓延的风险，这与项目的长度成正比）。

通过采用 T&M 方法并结合某种形式的快速原型制作方法，并在不超过 4-6 周的时间内定期向客户交付或演示，双方通常会得到更好的服务。这有助于管理预期。如果客户可以看到正在发生的事情，它会让他们放心并让您继续工作（而不是在会议中通过甘特图等待时间）。

所以你应该做的是尝试说服你的客户采用渐进式方法（婴儿步骤），他们可以看到他们得到了什么，它是如何发展的，并参与到这个过程中。它可以更快地获得结果并且最终更便宜（双方分担风险负担）。

许多开发商似乎也忘记了一件事，那就是他们就像 15 世纪法国的皇室臣民。他们可能拥有特权，甚至财富和许多特权，但他们为国王（或王后）服务，他们可以随心所欲地斩首他们。我的意思是客户最终掌握了权力，而您作为开发人员的存在是为了让他们的生活更轻松，而不是相反。

如果客户想要在老板的 iPhone 上的虚拟 Vax/VMS 服务器上运行在 Cobol on Rails 上开发的粉红色和绿色网站，这就是他们得到的。现在，您可以利用您的专业知识和经验来尝试说服他们这不是一个好主意，但最终如果这是他们想要的，您有两个选择：给他们或步行。

太多的开发人员陷入了给人们他们认为应该拥有的东西，而不是他们要求的东西的陷阱。大错。这个过程的一部分是保持与客户的沟通渠道畅通，这样当他们期待完全不同的东西时，你就不会偏离地认为他们想要一些东西（或决定他们应该拥有一些东西）。

即使是一个小型的软件开发项目也很容易跑到 6 位数。对于为此付费的人来说，这通常是一笔巨大的投资。他们有权不紧张，你有责任让他们开心。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T12:01:44.627

大多数开发人员不会花时间这样做，而是直接跳入建模类图和系统架构，但我想说的最重要的是写下她提到的每一个特性。不要担心分组，或者它们如何组合在一起。当时，您只需要从她那里获得所有可能的功能。当您离开并开始考虑应用程序时，您将开始绘制功能块之间的相关性，这些功能最终将分组为具有属性和方法的对象。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-03-10T03:49:11.230

我可以衷心推荐 Eric Evans 的“[领域驱动设计](http://domaindrivendesign.org/books/evans_2003)”。它解释了如何对问题域进行建模，并在此过程中建立一种普遍存在的语言，您和客户可以通过该语言就应用程序的功能进行清晰的沟通。

Also, see if you can find a rapid development tool for your target platform, so that you can get something in front of your client quickly for early feedback. For example if you're using Java EE, check out [Spring Roo](http://www.springsource.org/roo), which supports round-tripping.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T11:59:37.280

我认为你的客户不想和你谈论这些事情……我敢打赌，她会向你展示一些关于页面应该如何组织以及她希望事情如何运作的图纸。

您应该按照她的演示提出问题（始终从用户的角度出发），这样您就可以按照她的期望完成工作。把技术的东西留给自己；）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T12:16:14.347

用户对它的工作方式不感兴趣。对他们来说，这一切都与界面的组织和执行操作的必要步骤有关。我同意上述建议，写下功能和接口要求，然后他们看看如何以及是否可以对其进行建模。

分析后再次与她讨论您能做什么和不能做什么，并提出解决方案或改进方案。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T12:21:03.120

客户很可能在您与他们交谈的前 5 分钟内告诉您他们想要什么。之后的任何事情都只是枕边谈话。

# c# - 您如何在敏捷项目中进行版本编号？

> ID：483122
> 
> 赞同：8
> 
> 时间：2009-01-27T11:53:11.193
> 
> 标签：c#, agile, versioning

目前，我们为 C# winforms 项目使用以下版本编号方案：

“主要版本”。“次要版本”。“迭代编号”。“该迭代中的内部版本号”

我们希望能够仅通过查看版本号来识别该迭代中的迭代号和内部版本号。

过去，我们做过类似的事情：“主要版本”、“次要版本”、“1.0 的顺序内部版本号”。例如，“4.0.648”意味着自 1.0 以来有 648 次构建 - 但这些信息相当无用和轶事，这就是为什么我们改变以反映迭代和迭代内的构建。

因此，考虑到这个新的敏捷版本编号，我们现在遇到了一个问题，即不同的产品组想要在他们的迭代中为我们的项目进行更改。在这种情况下，版本号没有意义，因为它们的迭代和内部版本号不对应。例如，我的项目的最后一次构建是 1.0.5.1，表示第 5 次迭代的第一次构建。现在，在第 3 次迭代中的另一个项目想要对我的项目进行更改并重新构建。

我该如何应对这种情况？您如何在敏捷项目中进行版本编号？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-27T12:04:50.127

我跟踪敏捷项目的迭代，而不是软件项目的迭代。如果一个较晚的启动端项目在另一个项目之后加入，它将因此与当前的敏捷项目迭代一起启动，并且不会出现错位。

敏捷项目领域之外的技术项目应该不可能与领域内的项目进行交互。这将是流程的 PM 故障，并且应该在共享代码库与分支一起使用的所有情况下消除，以便在项目完成后作为清理步骤修补到主干中。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-11-12T15:15:58.007

就个人而言，我认为我最喜欢的发布版本是`major.minor`完全取消所有东西。我认为这仅对内部应用程序真正可行，但为此，它使生活变得更加轻松。

通常，如果您正在开发面向内部的应用程序，我注意到业务从不真正关心他们使用的主要/次要版本。相反，他们往往想知道 a) 下一个版本是什么时候，b) 什么时候发布或发布——仅此而已。试图保持你正在工作的事实，`FOO-4.34.0.1-a`而`BAR-3.19.4.1`当没有人关心时只会使沟通复杂化。

在之前的小组中，除了项目启动之外，我们并没有真正的主要版本。每个版本都与前一个版本一样“重要”。

因此，我认为他们做了明智的事情，而是以`PROJECT_RELEASENUM`. 每次我们发布版本时，版本号都会增加“1”，补丁为`PROJECT_RELEASENUM_PATCHNUM`，它也增加“1”。

它很好地适用于开发作为一系列连续冲刺完成的概念，直到业务拥有他们需要的所有功能（实际上这从未发生过 - 他们总是想要更多的东西）*。*企业主理解它，开发人员可以交流它，它自然而然地适用于我们拥有的持续开发模型。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-27T12:10:14.373

我更喜欢`Major.Minor.Build.Revision`哪里`Build`- 公开发布的数量，`Revision`- 来自源版本系统的修订

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-27T16:17:02.037

我更喜欢将构建和发布过程与团队开发过程分开，因此我几乎不会在版本中添加迭代、冲刺或类似内容。您的案例是一个很好的例子，说明如何将这两种东西混合起来并不容易管理。如果您在项目中间更改方法（无论原因是什么）怎么办？

回答你的问题，我们已经使用 Scrum 两年了，我们的版本格式是经典的 Major.Minor.Upgrade.Build（我们只在错误修复上使用升级）。最后，使用内部版本号并不是强制性的，因为您只需要它来区分来自同一版本的不同包，但您可以使用另一个代表某种私有版本的符号。

# c# - 取消 ComboBox 下拉关闭

> ID：483125
> 
> 赞同：0
> 
> 时间：2009-01-27T11:53:40.303
> 
> 标签：c#, winforms, combobox

如果用户选择特定项目，我想取消此操作，因为我不想强制用户再次打开下拉菜单。这可以做到吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T11:57:38.987

如果您不允许用户选择它，为什么要将该项目放入下拉列表中？您可以修改您的设计以提供更有用的用户界面吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T11:57:58.330

也许您可以只使用[ListBox](http://msdn.microsoft.com/en-us/library/system.windows.forms.listbox.aspx)控件？防止组合框关闭是一个糟糕的 UI 设计理念......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T12:05:07.893

您将覆盖公共控件的预期行为，这不是一个好主意。如果您想提供某种分层选择，请使用 ListBox 或 TreeView。

# ruby - 用于自动测试的漂亮 GUI

> ID：483128
> 
> 赞同：1
> 
> 时间：2009-01-27T11:57:28.033
> 
> 标签：ruby, autotest, zentest

我想知道是否有人知道任何用于自动测试的好 GUI？

我已经知道所有随 autotest 分发的插件（咆哮，knotify 等），我想要的是更多。

我想要一个始终显示失败测试总数的 GUI。我希望 GUI 允许我点击进入失败的测试（让他们在 vim 中打开它们）我想在每个失败的测试旁边看到堆栈跟踪。但我不希望视图太混乱。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T13:30:23.807

因为它是一个完整的 IDE，所以很有可能它不是您想要的，但是 Netbeans 有一些非常简洁的 Ruby 测试支持： http: [//www.netbeans.org/features/ruby/index.html](http://www.netbeans.org/features/ruby/index.html)

> 直接支持 Ruby 中的内置测试框架 Test::Unit。您可以从 New 菜单创建新的单元测试。您只需在文件上调用 Run File (Shift-F6) 即可运行单元测试。这将打开一个测试结果窗口，其中包含执行单元测试和测试结果统计的输出。双击统计面板中的节点会将您带到编辑器中的相应声明位置，您可以使用箭头按钮导航到下一个/上一个故障。

[替代文字 http://wiki.netbeans.org/attach/RubyTesting/testrunner-1%20.png](http://wiki.netbeans.org/attach/RubyTesting/testrunner-1%20.png)

您还可以获得测试覆盖率（它也会对您的文件进行颜色编码，因此您可以立即查看哪些行已测试，哪些行未测试）：

[替代文字 http://blogs.sun.com/tor/resource/ruby-coveragereport.png](http://blogs.sun.com/tor/resource/ruby-coveragereport.png)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T22:54:45.697

FWIW 我在 github 上开始了一个[新项目](http://github.com/SamSaffron/autotest-shoes-gui/tree/master)，旨在解决这个问题。目前它真的很基本，但它对我有用。

这是一张照片

![图片](https://i.stack.imgur.com/dLeHY.png)

# c++ - 在 SELECT 中拆分 varbinary

> ID：483136
> 
> 赞同：0
> 
> 时间：2009-01-27T12:00:20.917
> 
> 标签：c++, sql, sql-server, tsql, odbc

我的一张表中有一个大的 varbinary 字段，我想分批下载以在我的应用程序中显示下载进度指示器。

如何拆分 SELECT 查询中发送的数据？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T12:10:42.157

请参阅[SqlDataReader.GetBytes](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqldatareader.getbytes.aspx)和 CommandBehavior SequentialAccess。

它将允许您通过多个调用从 varbinary(max) 中读取。然后您可以显示通话之间的进度。

对于 ODBC，请参阅[ISequentialStream](http://www.microsoft.com/technet/prodtechnol/sql/2000/reskit/part3/c1161.mspx?mfr=true)（也可以[在这里](http://msdn.microsoft.com/en-us/library/aa380010.aspx)），您也可以分块阅读它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T18:03:16.697

您可以只使用 SQLGetData ODBC 调用来执行此操作。如果您提供的缓冲区大小小于总 varbinary 大小，它将填充缓冲区并返回 SQL_SUCCESS_WITH_INFO 和 SQLSTATE 01004。如果再次调用它，它将返回下一段数据。您只需重复直到检索到所有数据。要以百分比的形式了解您的进度，您可以选择长度作为另一列。

[有关获取长数据](http://msdn.microsoft.com/en-us/library/ms712426(VS.85).aspx)的许多技巧，请参见此处。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T12:16:26.017

我在 C++ 应用程序中使用 ODBC 和 Qt4。我想我需要在 SELECT 语句中拆分数据来实现这一点。

不管怎么说，还是要谢谢你。

# .net - 从 VS 2008 网站转换为 Web 应用程序项目

> ID：483138
> 
> 赞同：2
> 
> 时间：2009-01-27T12:00:50.587
> 
> 标签：.net, asp.net-2.0, code-behind

我正在将 VS 2008 网站转换为 Web 应用程序项目。我已按照[MSDN](http://msdn.microsoft.com/en-us/library/bb907624.aspx)网站上的说明进行操作，但现在遇到了一大堆奇怪的错误。我应该提一下，大约一周前我为另一个项目做了这个，没有任何问题。我得到的错误是：

“XXX”类型已包含“XXX”的定义。

此错误适用于后面代码中的每个私有成员或方法。我的网站目前有 218 个这样的错误。

想法？

编辑：我想我会补充一点，我确实看到[了这个 ASP.NET 论坛](http://forums.asp.net/t/1361511.aspx)关于类似问题的帖子，他们修复它的方法是将所有代码隐藏推送到一个单独的类库。虽然我确信这会奏效，但在我看来它可能只是某个地方的简单设置时，这将是大量的工作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T12:33:57.273

好吧，我想密切关注您的网站是值得的。我从以前的员工那里继承了这个网站，看起来有多个同名的页面。由于从网站迁移到 Web 应用程序项目，代码隐藏都在同一个命名空间中，因此这些部分类试图“组合”成一个主要类，因此会发生冲突。寻求帮助后，请务必找出问题的答案。不管怎么说，还是要谢谢你。

因此，为了澄清，我只需要用适当的名称空间包装我所有的代码隐藏。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T01:43:01.067

我个人喜欢[Web 部署项目](http://weblogs.asp.net/scottgu/archive/2008/01/28/vs-2008-web-deployment-project-support-released.aspx)。我喜欢项目管理的网站风格，因为它不像 Web 应用程序项目那样死板，但我喜欢正式构建、预编译、持续集成等的最终解决方案。它是一个很好的混合体，IMO。

# c# - 为什么我不能将数据绑定到字段？

> ID：483148
> 
> 赞同：3
> 
> 时间：2009-01-27T12:02:57.447
> 
> 标签：c#, data-binding

我刚刚（艰难地）了解到数据绑定不适用于字段。考虑到自动属性的简单程度，这不是问题，但我想知道为什么会这样。谁能解释一下？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-27T12:11:51.157

[我在这里](http://www.nikhilk.net/DataBindingToPublicFields.aspx)找到了一个很好的解释：

> ...因为公共领域不是推荐的做法。虽然它们可能便于快速和肮脏的代码，但它们没有版本。相反，使用属性允许您更改访问逻辑和幕后的数据存储，以及在分配值时添加验证逻辑。此外，访问属性的感觉几乎相同，并且没有任何性能开销。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T13:34:29.557

实际上，如果您使用[自定义描述符](http://www.codeproject.com/KB/cs/bind_entities.aspx)，您**可以**绑定到字段。但我不会推荐它

但是数据绑定被设计为双向；有一个字段，不可能有通知。

# unit-testing - 时间单元测试的想法和技巧？

> ID：483153
> 
> 赞同：9
> 
> 时间：2009-01-27T12:04:10.877
> 
> 标签：unit-testing

有人做过时间单元测试吗？

我什至不确定这种术语是否被创造出来，但关键是要测试操作是否在时间限制内执行。我有一些算法，我想测试它们的执行时间是否按预期增加，我猜类似的测试可以用于 IO，而不是类似 test_timeout 之类的东西。

但是，由于硬件会影响执行速度，因此它似乎并非微不足道。所以我想知道是否有人以前尝试过这种事情，是否可以分享他们的经验。

谢谢

**编辑：**尝试编制在这种情况下需要注意的事项列表

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-27T13:59:43.530

只是我的经验中的一些注释......我们关心我们许多组件的性能，并且有一个非常类似于单元测试的框架来练习和计时（事后看来，我们应该只是使用`CppUnit`或`boost::test`像我们对单元测试所做的那样）。我们将这些称为“组件基准测试”而不是单元测试。

*   我们没有指定时间上限，然后通过/失败......我们只是记录时间（这部分与客户不愿实际给出硬性能要求有关，尽管性能是他们非常关心的事情！） . （我们过去曾尝试过通过/失败，但体验很糟糕，尤其是在开发人员机器上......因为电子邮件到达或后台索引的东西太多误报）
*   从事优化工作的开发人员只需缩短相关的基准测试时间，而无需构建整个系统（与单元测试让您专注于代码库的一部分非常相似）。
*   大多数基准测试测试某物的多次迭代。资源的延迟创建可能意味着组件的首次使用可能会有相当多的“设置时间”与之相关。我们注销“第一次”、“平均后续”和“平均所有”时间。确保您了解这些之间任何显着差异的原因。在某些情况下，我们将设置时间明确地作为个别情况进行基准测试。
*   应该很明显，但是：只为您真正关心的代码计时，而不是测试环境设置时间！
*   对于基准测试，您最终测试“真实”用例的次数比在单元测试中要多得多，因此测试设置和测试运行时间往往要**长得多**。
*   我们有一台自动测试机器每晚运行所有基准测试并发布所有结果的日志。理论上，我们可以绘制图表或让它标记低于目标性能的组件。在实践中，我们还没有时间设置类似的东西。
*   您确实希望这样的自动测试机器完全没有其他职责（例如，如果它也是您的 SVN 服务器，那么进行大检查的人会使其看起来像您的性能大幅下降）。
*   考虑除时间之外您可能想要进行基准测试的其他标量，并计划从一开始就支持它们。比如“实现的压缩比”、“天网AI IQ”……
*   不要让人们对低于最低规格硬件的基准数据进行任何分析。我已经看到由于在某人的垃圾笔记本上运行基准测试而做出的设计决策浪费了时间，而在目标平台（高端服务器）上运行会表明完全不同的东西！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T13:00:49.747

我所知道的最接近单元测试框架的内容是*在JUnit 4 中添加的*[定时测试](http://www-128.ibm.com/developerworks/java/library/j-junit4.html#N101C0)。这可用于确保算法的性能不会随着输入大小的增加而降低。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T12:12:41.373

如果要检查时间是否增加，不同机器的硬件应该无关紧要，如果您不检查绝对值，而是检查相对变化。或者我在这里错过了什么？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T12:33:12.813

我认为您可以对单元测试运行时数据进行回归检查。使用许多单元测试框架，您通常可以获得一份报告，其中包含测试名称、执行时间。我知道 junit/surefire 做到了。因此，基本上您可以将其与之前的运行进行比较，并确定是否发生了任何重大变化。如果您将所有这些保存在数据库中（使用主机名），您可以将相同运行时环境的执行时间与之前的测试运行进行比较。通过这种方式，您并没有真正编写性能测试，而只是单独断言执行时间没有重大变化。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T14:10:38.313

如果您使用 C++ 工作，请查看[http://unittest-cpp.sourceforge.net/](http://unittest-cpp.sourceforge.net/)

我没有使用时间的东西，但它是我发现的最好（最简洁）的单元测试框架。

# c++ - 寻找基准测试代码片段 (c++)

> ID：483164
> 
> 赞同：25
> 
> 时间：2009-01-27T12:09:34.937
> 
> 标签：c++, windows, time, benchmarking

我的程序中的一些加载例程需要很长时间才能完成。我想要一个快速的小片段来检查函数执行所需的时间。小我的意思是“最好没有第 3 方库”。

也许像占用系统时间一样简单？

```
start = current_system_time()
load_something()
delta = current_system_time()-start
log_debug("load took "+delta) 
```

**编辑：**有问题的目标操作系统是 Windows。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-27T12:51:36.960

你的回答：是的

警告：这**不适**用于多线程代码或多核机器，您需要一个强大的挂钟计时器。所以我推荐你使用 omp 的挂钟。OMP 包含在 VC 和 GCC 中，大多数编译器和它的标准你不必担心消失

```
#include <omp.h>

// Starting the time measurement
double start = omp_get_wtime();
// Computations to be measured
...
// Measuring the elapsed time
double end = omp_get_wtime();
// Time calculation (in seconds) 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-01-27T13:19:16.013

```
#if defined(_WIN32) || defined(__WIN32__) || defined(WIN32)

namespace win32 {
    #include <windows.h>
}

class timer
{
    win32::LARGE_INTEGER start_time_;
public:
    timer() { QueryPerformanceCounter( &start_time_ ); }
    void   restart() { QueryPerformanceCounter( &start_time_ ); }
    double elapsed() const
    {
        win32::LARGE_INTEGER end_time, frequency;
        QueryPerformanceCounter( &end_time );
        QueryPerformanceFrequency( &frequency );
        return double( end_time.QuadPart - start_time_.QuadPart )
            / frequency.QuadPart;
    }
};

#else

#include <ctime>

class timer
{
    clock_t _start_time;
public:
    timer() { _start_time = clock(); }
    void   restart() { _start_time = clock(); }
    double elapsed() const
    {
        return double(clock() - _start_time) / CLOCKS_PER_SEC;
    }
};

#endif

template< typename Func >
double measure_time( Func f )
{
    timer t;
    f();
    return t.elapsed();
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-27T12:25:23.783

这是一种对 C/C++ 代码块进行计时的快速而肮脏的方法。你需要`#include <sys/time.h>`，这应该是一个标准的标题......

```
struct timeval start, end;
gettimeofday(&start, NULL);
// benchmark code
gettimeofday(&end, NULL);
long long time =   (end.tv_sec * (unsigned int)1e6 +   end.tv_usec) - 
                 (start.tv_sec * (unsigned int)1e6 + start.tv_usec); 
```

这应该在现代 Linux 系统上提供 1-2µs 的分辨率（您使用的是什么操作系统？），这意味着它不太适合学习小于 10µs 的项目。但是，您似乎并不处于那种情况。

**更新：**基于指定的操作系统... [gettimeofday() 的 Windows 实现](http://www.openasthra.com/c-tidbits/gettimeofday-function-for-windows/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T13:42:27.947

我为此使用了一个类，它旨在测量执行函数所需的时间并将其写入 uth-16le 文本文件（我需要更新它以使用我为此创建的新类......但是 nm）。

在函数顶部创建一个新实例，例如 jProfiler(L"myFunction")，如果您想确定新实例并自己删除它，则函数末尾的清理将完成其余的工作。对于一个小测试来说有点矫枉过正，但可能会有所帮助：

```
// start header

/* jProfiler class by Semi Essessi
 *
 * (class description goes here)
 *
 */

#ifndef __JPROFILER_H
#define __JPROFILER_H

#include <stdio.h>
#include <windows.h>

class jProfiler
{
private:
    wchar_t*        str;
    LARGE_INTEGER   start;
    LARGE_INTEGER   tps;
    LARGE_INTEGER   buf;

    static FILE*    f;
    static int      instCount;

    static void     Initialise();
    static void     Shutdown();
public:
    jProfiler(const wchar_t* msg);
    ~jProfiler();
};

#endif

// - end header

/* jProfiler class by Semi Essessi
 *
 * (class description goes here)
 *
 */

#include "jProfiler.h"

#include <windows.h>

FILE* jProfiler::f = 0;
int jProfiler::instCount = 0;

jProfiler::jProfiler(const wchar_t* msg)
{
    // constructor code for menuVar
    int i = (int)wcslen(msg)+1;
    str = new wchar_t[i];
    memcpy(str, msg, sizeof(wchar_t)*i);
    str[i-1] =  0;

    QueryPerformanceFrequency(&tps);
    QueryPerformanceCounter(&start);

    instCount++;
    Initialise();
}

jProfiler::~jProfiler()
{
    // destructor code for menuVar
    QueryPerformanceCounter(&buf);
    // work out change in time
    double dt=((float)buf.QuadPart - (float)start.QuadPart)/(float)tps.QuadPart;
    fwprintf(f, L"%s : %.20f\r\n", str, dt);

    if(str) delete[] str;
    instCount--;
    Shutdown();
}

void jProfiler::Initialise()
{
    if(!f)
    {
        f = _wfopen(L"profilerlog.txt", L"wb");
        unsigned short a = 0xFEFF;
        fwrite(&a, sizeof(unsigned short), 1, f);
    }
}

void jProfiler::Shutdown()
{
    if(instCount==0) if(f) fclose(f);
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-02-18T10:54:11.883

[我的sweet.hpp](https://github.com/burner/sweet.hpp)库中有一个**benchmark.hpp**标头。它有两个基准测试工具。第一个是一个简单的手动启动停止计时

```
Bench b;
...
b.stop();
b.milli(); // returns an uint with passed millisec. Also has sec and micro sec 
```

另一个更复杂一些。您可以像这样编写函数或块语句。

```
void myFunc() {
    BENCH(someName);
    ...
} 
```

并最终调用`sweet::Benchmark::printResults();`以打印所花费的时间和调用次数。

编辑：我添加了一个函数，所以你可以这样调用它。

```
double c = BENCHMARK_CNT(25, yourFunctionCallHere()); 
```

# java - 如何让我的基本 SWT 应用程序在 Mac OS X 10.5.6 中正确退出？

> ID：483173
> 
> 赞同：12
> 
> 时间：2009-01-27T12:11:52.390
> 
> 标签：java, macos, swt

我有以下 SWT 测试代码：

```
public static void main(String[] args) {
    shell = new Shell();
    shell.setText(APP_NAME + " " + APP_VERSION);
    shell.addShellListener(new ShellListener() {
        public void shellActivated(ShellEvent event) { }
        public void shellClosed(ShellEvent event) { exit(); }
        public void shellDeactivated(ShellEvent event) { }
        public void shellDeiconified(ShellEvent event) { }
        public void shellIconified(ShellEvent event) { }
    });     
    shell.open();
    display = shell.getDisplay();
    while (!shell.isDisposed()) {
        if (!display.readAndDispatch()) {
            display.sleep();
        }
    }
    display.dispose();
} 
```

我的 exit() 方法如下：

```
private void exit() {
    System.exit(0);
} 
```

我尝试通过关闭外壳（“窗口”）或拉下应用程序菜单（标记为“SWT”）并选择“退出”来退出应用程序。

当我这样做时，在 Dock 中留下了一个 SWT 存根，并且 SWT 应用程序实际上并没有退出。我必须通过 Eclipse 或 Force Quit 手动终止 SWT 应用程序。

我已经在 Mac OS X 10.5.6 (Intel) 下的 Eclipse 3.4.1 下使用 v3.4 和 v3.5 SWT jar 进行了尝试。

当我关闭 shell 时，我需要做额外的工作才能退出应用程序吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-27T13:03:02.600

您没有正确释放本机资源 - 您有资源泄漏。

你不需要这样做：

```
private void exit() {
    System.exit(0);
} 
```

main 方法将在 shell 被释放时退出。如果*必须*使用退出方法，请在处理完所有 SWT 资源后调用它：

```
 Display display = new Display();
    try {
        Shell shell = new Shell(display);
        try {
            shell.open();
            while (!shell.isDisposed()) {
                if (!display.readAndDispatch()) {
                    display.sleep();
                }
            }
        } finally {
            if (!shell.isDisposed()) {
                shell.dispose();
            }
        }
    } finally {
        display.dispose();
    }
    System.exit(0); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T14:36:34.390

当您分配外壳时：

`shell = new Shell();`

一些本地资源也随之分配。在退出应用程序之前，您必须处理这些资源：

```
私人无效退出（）{
    shell.dispose();
    System.exit(0);
}

```

当然，您必须为您的 exit() 方法提供“shell”变量才能执行此操作。

请注意，我认为您不需要处置 Display，因为您没有使用“ `new Display()`”创建它。但是，您使用 SWT 创建的任何内容（JavaDoc 中记录的少数项目除外）`new`都必须在完成后处理掉。否则你会泄露原生资源。

# jquery - JQuery 超时问题

> ID：483176
> 
> 赞同：0
> 
> 时间：2009-01-27T12:13:27.050
> 
> 标签：jquery, timeout

我发现使用 JQuery 超时有问题，我有一个带有脚本的页面，它设置了超时并等待服务器的响应。问题是当超时必须执行时，简而言之，它“没有动作”。我认为该脚本不会中断与服务器的连接并等待服务器响应，因为在服务器端连接开启 10 秒（但超时设置为 5 秒）。当服务器在不同的域名和客户端工作时，我看到了这个问题，而当服务器和客户端在本地工作时，这个问题就不存在了。

您是否有一个想法，因为发生了此错误或如何关闭脚本连接？

```
// client 

$.ajax({

    type: "GET",

    url: "some.php",

    data: "name=John&location=Boston",

    timeout: 5000,

    success: function(msg){

        alert( "Data Saved: " + msg );

    },
    error: function(request, errorType, errorThrown){

        alert("opppsssss .... ");
    }
}); 
```

和服务器代码：

```
//some.php

< ?

//simulate long task

sleep(10); //sleep 10 seconds

//send response

echo "some test data";

? > 
```

最好的祝福

多梅尼科

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-28T17:08:08.967

从外观上看，您是从后到前进行的。您已将超时设置为 5000 毫秒（5 秒），因此如果服务器端代码的响应时间超过 5 秒，它将超时。你在睡觉(10); 它休眠 10 秒，是指定超时时间的两倍。解决此问题的方法是执行以下操作：

```
// client 
$.ajax({
    type: "GET",
    url: "some.php",
    data: "name=John&location=Boston",
    timeout: 10000,

    success: function(msg){
        alert( "Data Saved: " + msg );
    },
    error: function(request, errorType, errorThrown){
        alert("opppsssss .... ");
    }
}); 
```

和服务器代码：

```
//some.php
< ?
    //simulate long task
    sleep(5); // sleep 5 seconds!
    //send response
    echo "some test data";
? > 
```

希望这会有所帮助。

# sql-server - 将数据库更改推送到服务器的脚本

> ID：483184
> 
> 赞同：1
> 
> 时间：2009-01-27T12:14:39.840
> 
> 标签：sql-server

这可能是最经典的数据库问题。

我有一个电子商务软件解决方案托管在用于数据的 SQL 服务器和用于前端的 Web 服务器上。每个实例/客户在 SQL Server 2008 上都有自己的数据库。

在下一个版本的开发过程中，我可能会更改或添加表、视图、存储过程等。

如何在不丢失数据的情况下将此更改发布到所有数据库？它应该通过脚本或类似的东西来完成。集中管理是关键...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T12:32:56.170

也许这是您已经考虑过的事情，但我的公司使用 Red Gate ( [http://www.red-gate.com/](http://www.red-gate.com/) ) 的软件，它比较我们的数据库开发版本和生产版本，生成并执行脚本以带来生产与发展同步。

*（我不是 Red Gate 的销售人员，但我认为这可能是您要找的）*

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T12:33:34.530

我使用[SQL 比较](http://www.red-gate.com/products/SQL_Compare/index.htm)进行架构更改，使用[SQL 数据比较](http://www.red-gate.com/help/sqldatacompare/sqldatacompare.htm)进行数据更改。奇迹般有效！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T12:18:09.147

db admin 应该在 sql server 机器上执行一个脚本。

此类 scipt 的主要算法是即将创建备份，循环锁定每个表的表，更改它，释放。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T12:35:17.817

这个问题本质上是自动化登录到 SQL Server 的手动过程之一，并针对一个或多个数据库运行脚本，这会完成您需要的修改。

当然，如果您需要更新的 SQL Server 实例离您很远，因此无法直接访问，情况会变得更糟。

确保脚本按顺序应用也很重要——在“创建表”脚本之前运行“添加索引”脚本是没有意义的。

我们解决这个问题的方法是使用将脚本文件打包为数据集的 Web 服务，并在远程系统调用时以正确的顺序将它们传送到远程系统。

在远程 SQL Server 上，我们有一个 .NET 应用程序，它调用 Web 服务、下载脚本文件、解压缩它们并将它们应用到数据库。

当远程系统调用时，它会提供它最近升级的 ID。当 Web 服务完成时，它知道它交付的最后一个。因此，知道远程系统处于什么级别是微不足道的。

唯一需要的手动干预是首先创建脚本，然后将它们上传到中央服务器。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T12:41:12.487

另一张海报提到了 Red Gate 产品，我将在那里推出另一个商业产品 - Quest Change Director：

[http://www.quest.com/change-director-for-sql-server/](http://www.quest.com/change-director-for-sql-server/)

免责声明：我为 Quest 工作，尽管我不从事销售工作。Change Director 进行比较、同步、链接到变更管理系统，可以使用您的 dev/qa 服务器作为源或使用 T-SQL 脚本，具有审计跟踪和回滚功能等。

就像你说的，中央管理是关键，这个产品就是专注于此。

# sql - 如何列出引用 SQL Server 中给定表的所有外键？

> ID：483193
> 
> 赞同：866
> 
> 时间：2009-01-27T12:17:59.193
> 
> 标签：sql, sql-server, tsql

我需要删除 SQL Server 数据库中高度引用的表。如何获取删除表所需删除的所有外键约束的列表？

（SQL 回答比在管理工作室的 GUI 中单击 about 更可取。）

* * *

## 回答 #1

> 赞同：1295
> 
> 时间：2012-10-18T13:53:51.140

不知道为什么没有人建议，但我`sp_fkeys`用来查询给定表的外键：

```
EXEC sp_fkeys 'TableName' 
```

您还可以指定架构：

```
EXEC sp_fkeys @pktable_name = 'TableName', @pktable_owner = 'dbo' 
```

在不指定架构的情况下，[文档](https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sp-fkeys-transact-sql)说明以下内容：

> 如果未指定 pktable_owner，则应用底层 DBMS 的默认表可见性规则。
> 
> 在 SQL Server 中，如果当前用户拥有具有指定名称的表，则返回该表的列。如果未指定 pktable_owner 并且当前用户不拥有具有指定 pktable_name 的表，则该过程将查找数据库所有者拥有的具有指定 pktable_name 的表。如果存在，则返回该表的列。

* * *

## 回答 #2

> 赞同：250
> 
> 时间：2009-01-27T12:43:35.477

我会使用 SQL Server Management Studio 中的数据库图表功能，但由于您排除了这一点 - 这在 SQL Server 2008 中对我有用（没有 2005）。

要获取引用表和列名的列表...

```
select 
    t.name as TableWithForeignKey, 
    fk.constraint_column_id as FK_PartNo, c.
    name as ForeignKeyColumn 
from 
    sys.foreign_key_columns as fk
inner join 
    sys.tables as t on fk.parent_object_id = t.object_id
inner join 
    sys.columns as c on fk.parent_object_id = c.object_id and fk.parent_column_id = c.column_id
where 
    fk.referenced_object_id = (select object_id 
                               from sys.tables 
                               where name = 'TableOthersForeignKeyInto')
order by 
    TableWithForeignKey, FK_PartNo 
```

获取外键约束的名称

```
select distinct name from sys.objects where object_id in 
(   select fk.constraint_object_id from sys.foreign_key_columns as fk
    where fk.referenced_object_id = 
        (select object_id from sys.tables where name = 'TableOthersForeignKeyInto')
) 
```

* * *

## 回答 #3

> 赞同：242
> 
> 时间：2013-09-21T07:14:48.810

这给了你：

*   FK 本身
*   FK所属的Schema
*   “*引用表*”或具有 FK 的表
*   “*引用列*”或引用表中指向 FK 的列
*   “*引用表*”或具有 FK 指向的键列的表
*   “*引用列*”或您的 FK 指向的键的列

下面的代码：

```
SELECT  obj.name AS FK_NAME,
    sch.name AS [schema_name],
    tab1.name AS [table],
    col1.name AS [column],
    tab2.name AS [referenced_table],
    col2.name AS [referenced_column]
FROM sys.foreign_key_columns fkc
INNER JOIN sys.objects obj
    ON obj.object_id = fkc.constraint_object_id
INNER JOIN sys.tables tab1
    ON tab1.object_id = fkc.parent_object_id
INNER JOIN sys.schemas sch
    ON tab1.schema_id = sch.schema_id
INNER JOIN sys.columns col1
    ON col1.column_id = parent_column_id AND col1.object_id = tab1.object_id
INNER JOIN sys.tables tab2
    ON tab2.object_id = fkc.referenced_object_id
INNER JOIN sys.columns col2
    ON col2.column_id = referenced_column_id AND col2.object_id = tab2.object_id 
```

* * *

## 回答 #4

> 赞同：170
> 
> 时间：2009-01-27T12:41:22.160

试试这个 ：

```
sp_help 'TableName' 
```

* * *

## 回答 #5

> 赞同：50
> 
> 时间：2013-04-01T09:10:09.580

您还应该注意对其他对象的引用。

如果该表被其他表高度引用，则它可能也被其他对象（例如视图、存储过程、函数等）高度引用。

我真的会推荐 GUI 工具，例如 SSMS 中的“查看依赖项”对话框或免费工具（例如[ApexSQL Search](http://www.apexsql.com/sql_tools_search.aspx)），因为如果您只想使用 SQL 来搜索其他对象中的依赖项，则可能容易出错。

如果 SQL 是唯一的选择，您可以尝试这样做。

```
select O.name as [Object_Name], C.text as [Object_Definition]
from sys.syscomments C
inner join sys.all_objects O ON C.id = O.object_id
where C.text like '%table_name%' 
```

* * *

## 回答 #6

> 赞同：23
> 
> 时间：2015-02-12T00:23:47.793

最初的问题要求将所有外键的列表放入一个高度引用的表中，以便可以删除该表。

这个小查询返回将所有外键删除到特定表中所需的所有“删除外键”命令：

```
SELECT 
   'ALTER TABLE ['+sch.name+'].['+referencingTable.Name+'] DROP CONSTRAINT ['+foreignKey.name+']' '[DropCommand]'
FROM sys.foreign_key_columns fk
    JOIN sys.tables referencingTable ON fk.parent_object_id = referencingTable.object_id
    JOIN sys.schemas sch ON referencingTable.schema_id = sch.schema_id
    JOIN sys.objects foreignKey ON foreignKey.object_id = fk.constraint_object_id
    JOIN sys.tables referencedTable ON fk.referenced_object_id = referencedTable.object_id
WHERE referencedTable.name = 'MyTableName' 
```

示例输出：

```
[DropCommand]
ALTER TABLE [dbo].[OtherTable1] DROP CONSTRAINT [FK_OtherTable1_MyTable]
ALTER TABLE [dbo].[OtherTable2] DROP CONSTRAINT [FK_OtherTable2_MyTable] 
```

省略 WHERE 子句以获取当前数据库中所有外键的删除命令。

* * *

## 回答 #7

> 赞同：21
> 
> 时间：2017-05-03T09:35:51.310

这是我将使用的 SQL 代码。

```
SELECT 
   f.name AS 'Name of Foreign Key',
   OBJECT_NAME(f.parent_object_id) AS 'Table name',
   COL_NAME(fc.parent_object_id,fc.parent_column_id) AS 'Fieldname',
   OBJECT_NAME(t.object_id) AS 'References Table name',
   COL_NAME(t.object_id,fc.referenced_column_id) AS 'References fieldname',

   'ALTER TABLE [' + OBJECT_NAME(f.parent_object_id) + ']  DROP CONSTRAINT [' + f.name + ']' AS 'Delete foreign key',

   'ALTER TABLE [' + OBJECT_NAME(f.parent_object_id) + ']  WITH NOCHECK ADD CONSTRAINT [' + 
        f.name + '] FOREIGN KEY([' + COL_NAME(fc.parent_object_id,fc.parent_column_id) + ']) REFERENCES ' + 
        '[' + OBJECT_NAME(t.object_id) + '] ([' +
        COL_NAME(t.object_id,fc.referenced_column_id) + '])' AS 'Create foreign key'
    -- , delete_referential_action_desc AS 'UsesCascadeDelete'
FROM sys.foreign_keys AS f,
     sys.foreign_key_columns AS fc,
     sys.tables t 
WHERE f.OBJECT_ID = fc.constraint_object_id
AND t.OBJECT_ID = fc.referenced_object_id
AND OBJECT_NAME(t.object_id) = 'Employees'      --  Just show the FKs which reference a particular table
ORDER BY 2 
```

不是特别清楚SQL，我们来看一个例子。

因此，假设我想删除`Employees`Microsoft 钟爱的`Northwind`数据库中的表，但 SQL Server 告诉我一个或多个外键阻止我这样做。

上面的 SQL 命令将返回这些结果...

[![外键](https://i.stack.imgur.com/qDHxZ.png)](https://i.stack.imgur.com/qDHxZ.png)

它告诉我有 3 个引用该`Employees`表的外键。换句话说，在这三个外键首先被删除之前，我不会被允许删除（删除）这个表。

在结果中，第一行是以下外键约束在结果中的显示方式。

```
ALTER TABLE [dbo].[Employees]  WITH NOCHECK 
ADD CONSTRAINT [FK_Employees_Employees] FOREIGN KEY([ReportsTo])
REFERENCES [dbo].[Employees] ([EmployeeID]) 
```

倒数第二列显示了我需要用来*删除*这些外键之一的 SQL 命令，例如：

```
ALTER TABLE [Employees] DROP CONSTRAINT [FK_Employees_Employees] 
```

...并且右侧的列显示了*创建*它的 SQL...

```
ALTER TABLE [Employees] WITH NOCHECK 
ADD CONSTRAINT [FK_Employees_Employees] 
FOREIGN KEY([ReportsTo]) REFERENCES [Employees] ([EmployeeID]) 
```

使用所有这些命令，您就拥有了删除相关外键以允许您删除表，然后稍后重新创建它们所需的一切。

呸。希望这可以帮助。

* * *

## 回答 #8

> 赞同：21
> 
> 时间：2018-10-22T07:30:41.723

最简单的一种是在 SQL 中使用 sys.foreign_keys_columns。在这里，该表包含所有外键的对象 ID，包括它们的引用列 ID 引用表 ID 以及引用列和表。由于 Id 保持不变，因此结果对于 Schema 和表中的进一步修改将是可靠的。

询问：

```
SELECT    
OBJECT_NAME(fkeys.constraint_object_id) foreign_key_name
,OBJECT_NAME(fkeys.parent_object_id) referencing_table_name
,COL_NAME(fkeys.parent_object_id, fkeys.parent_column_id) referencing_column_name
,OBJECT_SCHEMA_NAME(fkeys.parent_object_id) referencing_schema_name
,OBJECT_NAME (fkeys.referenced_object_id) referenced_table_name
,COL_NAME(fkeys.referenced_object_id, fkeys.referenced_column_id) 
referenced_column_name
,OBJECT_SCHEMA_NAME(fkeys.referenced_object_id) referenced_schema_name
FROM sys.foreign_key_columns AS fkeys 
```

我们也可以使用 'where' 添加过滤器

```
WHERE OBJECT_NAME(fkeys.parent_object_id) = 'table_name' AND 
OBJECT_SCHEMA_NAME(fkeys.parent_object_id) = 'schema_name' 
```

* * *

## 回答 #9

> 赞同：18
> 
> 时间：2009-08-06T13:52:48.660

```
SELECT PKTABLE_QUALIFIER = CONVERT(SYSNAME,DB_NAME()),
       PKTABLE_OWNER = CONVERT(SYSNAME,SCHEMA_NAME(O1.SCHEMA_ID)),
       PKTABLE_NAME = CONVERT(SYSNAME,O1.NAME),
       PKCOLUMN_NAME = CONVERT(SYSNAME,C1.NAME),
       FKTABLE_QUALIFIER = CONVERT(SYSNAME,DB_NAME()),
       FKTABLE_OWNER = CONVERT(SYSNAME,SCHEMA_NAME(O2.SCHEMA_ID)),
       FKTABLE_NAME = CONVERT(SYSNAME,O2.NAME),
       FKCOLUMN_NAME = CONVERT(SYSNAME,C2.NAME),
       -- Force the column to be non-nullable (see SQL BU 325751)
       --KEY_SEQ             = isnull(convert(smallint,k.constraint_column_id), sysconv(smallint,0)),
       UPDATE_RULE = CONVERT(SMALLINT,CASE OBJECTPROPERTY(F.OBJECT_ID,'CnstIsUpdateCascade') 
                                        WHEN 1 THEN 0
                                        ELSE 1
                                      END),
       DELETE_RULE = CONVERT(SMALLINT,CASE OBJECTPROPERTY(F.OBJECT_ID,'CnstIsDeleteCascade') 
                                        WHEN 1 THEN 0
                                        ELSE 1
                                      END),
       FK_NAME = CONVERT(SYSNAME,OBJECT_NAME(F.OBJECT_ID)),
       PK_NAME = CONVERT(SYSNAME,I.NAME),
       DEFERRABILITY = CONVERT(SMALLINT,7)   -- SQL_NOT_DEFERRABLE
FROM   SYS.ALL_OBJECTS O1,
       SYS.ALL_OBJECTS O2,
       SYS.ALL_COLUMNS C1,
       SYS.ALL_COLUMNS C2,
       SYS.FOREIGN_KEYS F
       INNER JOIN SYS.FOREIGN_KEY_COLUMNS K
         ON (K.CONSTRAINT_OBJECT_ID = F.OBJECT_ID)
       INNER JOIN SYS.INDEXES I
         ON (F.REFERENCED_OBJECT_ID = I.OBJECT_ID
             AND F.KEY_INDEX_ID = I.INDEX_ID)
WHERE  O1.OBJECT_ID = F.REFERENCED_OBJECT_ID
       AND O2.OBJECT_ID = F.PARENT_OBJECT_ID
       AND C1.OBJECT_ID = F.REFERENCED_OBJECT_ID
       AND C2.OBJECT_ID = F.PARENT_OBJECT_ID
       AND C1.COLUMN_ID = K.REFERENCED_COLUMN_ID
       AND C2.COLUMN_ID = K.PARENT_COLUMN_ID 
```

* * *

## 回答 #10

> 赞同：15
> 
> 时间：2011-11-04T03:50:59.857

```
SELECT
  object_name(parent_object_id),
  object_name(referenced_object_id),
  name 
FROM sys.foreign_keys
WHERE parent_object_id = object_id('Table Name') 
```

* * *

## 回答 #11

> 赞同：12
> 
> 时间：2015-08-03T06:26:46.507

我正在使用此脚本来查找与外键相关的所有详细信息。我正在使用 INFORMATION.SCHEMA。下面是一个 SQL 脚本：

```
SELECT 
    ccu.table_name AS SourceTable
    ,ccu.constraint_name AS SourceConstraint
    ,ccu.column_name AS SourceColumn
    ,kcu.table_name AS TargetTable
    ,kcu.column_name AS TargetColumn
FROM INFORMATION_SCHEMA.CONSTRAINT_COLUMN_USAGE ccu
    INNER JOIN INFORMATION_SCHEMA.REFERENTIAL_CONSTRAINTS rc
        ON ccu.CONSTRAINT_NAME = rc.CONSTRAINT_NAME 
    INNER JOIN INFORMATION_SCHEMA.KEY_COLUMN_USAGE kcu 
        ON kcu.CONSTRAINT_NAME = rc.UNIQUE_CONSTRAINT_NAME  
ORDER BY ccu.table_name 
```

* * *

## 回答 #12

> 赞同：10
> 
> 时间：2019-11-27T13:20:49.577

**引用 SQL Server 中给定表的所有外键列表：**

您可以通过以下查询获取引用表名和列名...

```
SELECT 
   OBJECT_NAME(f.parent_object_id) TableName,
   COL_NAME(fc.parent_object_id,fc.parent_column_id) ColName
FROM 
   sys.foreign_keys AS f
INNER JOIN 
   sys.foreign_key_columns AS fc 
      ON f.OBJECT_ID = fc.constraint_object_id
INNER JOIN 
   sys.tables t 
      ON t.OBJECT_ID = fc.referenced_object_id
WHERE 
   OBJECT_NAME (f.referenced_object_id) = 'TableName' 
```

**以下截图供您理解...**

[![在此处输入图像描述](https://i.stack.imgur.com/OAx5u.png)](https://i.stack.imgur.com/OAx5u.png)

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2017-10-16T12:28:53.320

第一的

```
EXEC sp_fkeys 'Table', 'Schema' 
```

然后使用[NimbleText](http://nimbletext.com/ "灵活的文本")来处理你的结果

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2012-01-26T01:36:10.330

```
 SELECT OBJECT_NAME(fk.parent_object_id) as ReferencingTable, 
        OBJECT_NAME(fk.constraint_object_id) as [FKContraint]
  FROM sys.foreign_key_columns as fk
 WHERE fk.referenced_object_id = OBJECT_ID('ReferencedTable', 'U') 
```

这仅在是外键约束时才显示关系。我的数据库显然早于 FK 约束。一些表使用触发器来强制引用完整性，有时只有一个类似命名的列来指示关系（并且根本没有引用完整性）。

幸运的是，我们确实有一个一致的命名场景，所以我能够找到这样的引用表和视图：

```
SELECT OBJECT_NAME(object_id) from sys.columns where name like 'client_id' 
```

我使用此选择作为生成脚本的基础，该脚本执行我需要在相关表上执行的操作。

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2012-04-25T14:28:16.330

上面有一些很好的答案。但我更喜欢*一个*问题的答案。这段代码取自 sys.sp_helpconstraint (sys proc)

如果有与 tbl 相关联的外键，Microsoft 就是这样查找的。

```
--setup variables. Just change 'Customer' to tbl you want
declare @objid int,
    @objname nvarchar(776)
select @objname = 'Customer'    
select @objid = object_id(@objname)

if exists (select * from sys.foreign_keys where referenced_object_id = @objid)
    select 'Table is referenced by foreign key' =
        db_name() + '.'
        + rtrim(schema_name(ObjectProperty(parent_object_id,'schemaid')))
        + '.' + object_name(parent_object_id)
        + ': ' + object_name(object_id)
    from sys.foreign_keys 
    where referenced_object_id = @objid 
    order by 1 
```

答案将如下所示：test_db_name.dbo.Account: FK_Account_Customer

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2013-04-18T13:18:10.860

```
SELECT
OBJECT_NAME(parent_object_id) 'Parent table',
c.NAME 'Parent column name',
OBJECT_NAME(referenced_object_id) 'Referenced table',
cref.NAME 'Referenced column name'
FROM 
sys.foreign_key_columns fkc 
INNER JOIN 
sys.columns c 
   ON fkc.parent_column_id = c.column_id 
      AND fkc.parent_object_id = c.object_id
INNER JOIN 
sys.columns cref 
   ON fkc.referenced_column_id = cref.column_id 
      AND fkc.referenced_object_id = cref.object_id  where   OBJECT_NAME(parent_object_id) = 'tablename' 
```

如果要获取所有表的外键关系，请排除`where`子句，否则请编写表名而不是`tablename`

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2019-05-06T09:16:05.853

Mysql 服务器有`information_schema.REFERENTIAL_CONSTRAINTS`表仅供参考，您可以通过表名或引用的表名对其进行过滤。

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2019-11-22T20:56:14.140

@BankZ 的最佳答案

```
sp_help 'TableName' 
```

另外对于不同的模式

```
sp_help 'schemaName.TableName' 
```

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2011-11-04T01:07:05.957

根据@Gishu 所做的工作，我能够在 SQL Server 2005 中生成和使用以下 SQL

```
SELECT t.name AS TableWithForeignKey, fk.constraint_column_id AS FK_PartNo, 
       c.name AS ForeignKeyColumn, o.name AS FK_Name 
  FROM sys.foreign_key_columns AS fk
       INNER JOIN sys.tables AS t ON fk.parent_object_id = t.object_id
       INNER JOIN sys.columns AS c ON fk.parent_object_id = c.object_id 
                                  AND fk.parent_column_id = c.column_id
       INNER JOIN sys.objects AS o ON fk.constraint_object_id = o.object_id
  WHERE fk.referenced_object_id = (SELECT object_id FROM sys.tables 
                                        WHERE name = 'TableOthersForeignKeyInto')
  ORDER BY TableWithForeignKey, FK_PartNo; 
```

在 1 个查询中显示所有表、列和外键名称。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2013-04-03T20:30:06.913

**确定数据库中所有表的主键和唯一键...**

这应该列出所有约束，最后您可以放置​​过滤器

```
/* CAST IS DONE , SO THAT OUTPUT INTEXT FILE REMAINS WITH SCREEN LIMIT*/
WITH   ALL_KEYS_IN_TABLE (CONSTRAINT_NAME,CONSTRAINT_TYPE,PARENT_TABLE_NAME,PARENT_COL_NAME,PARENT_COL_NAME_DATA_TYPE,REFERENCE_TABLE_NAME,REFERENCE_COL_NAME) 
AS
(
SELECT  CONSTRAINT_NAME= CAST (PKnUKEY.name AS VARCHAR(30)) ,
        CONSTRAINT_TYPE=CAST (PKnUKEY.type_desc AS VARCHAR(30)) ,
        PARENT_TABLE_NAME=CAST (PKnUTable.name AS VARCHAR(30)) ,
        PARENT_COL_NAME=CAST ( PKnUKEYCol.name AS VARCHAR(30)) ,
        PARENT_COL_NAME_DATA_TYPE=  oParentColDtl.DATA_TYPE,        
        REFERENCE_TABLE_NAME='' ,
        REFERENCE_COL_NAME='' 

FROM sys.key_constraints as PKnUKEY
    INNER JOIN sys.tables as PKnUTable
            ON PKnUTable.object_id = PKnUKEY.parent_object_id
    INNER JOIN sys.index_columns as PKnUColIdx
            ON PKnUColIdx.object_id = PKnUTable.object_id
            AND PKnUColIdx.index_id = PKnUKEY.unique_index_id
    INNER JOIN sys.columns as PKnUKEYCol
            ON PKnUKEYCol.object_id = PKnUTable.object_id
            AND PKnUKEYCol.column_id = PKnUColIdx.column_id
     INNER JOIN INFORMATION_SCHEMA.COLUMNS oParentColDtl
            ON oParentColDtl.TABLE_NAME=PKnUTable.name
            AND oParentColDtl.COLUMN_NAME=PKnUKEYCol.name
UNION ALL
SELECT  CONSTRAINT_NAME= CAST (oConstraint.name AS VARCHAR(30)) ,
        CONSTRAINT_TYPE='FK',
        PARENT_TABLE_NAME=CAST (oParent.name AS VARCHAR(30)) ,
        PARENT_COL_NAME=CAST ( oParentCol.name AS VARCHAR(30)) ,
        PARENT_COL_NAME_DATA_TYPE= oParentColDtl.DATA_TYPE,     
        REFERENCE_TABLE_NAME=CAST ( oReference.name AS VARCHAR(30)) ,
        REFERENCE_COL_NAME=CAST (oReferenceCol.name AS VARCHAR(30)) 
FROM sys.foreign_key_columns FKC
    INNER JOIN sys.sysobjects oConstraint
            ON FKC.constraint_object_id=oConstraint.id 
    INNER JOIN sys.sysobjects oParent
            ON FKC.parent_object_id=oParent.id
    INNER JOIN sys.all_columns oParentCol
            ON FKC.parent_object_id=oParentCol.object_id /* ID of the object to which this column belongs.*/
            AND FKC.parent_column_id=oParentCol.column_id/* ID of the column. Is unique within the object.Column IDs might not be sequential.*/
    INNER JOIN sys.sysobjects oReference
            ON FKC.referenced_object_id=oReference.id
    INNER JOIN INFORMATION_SCHEMA.COLUMNS oParentColDtl
            ON oParentColDtl.TABLE_NAME=oParent.name
            AND oParentColDtl.COLUMN_NAME=oParentCol.name
    INNER JOIN sys.all_columns oReferenceCol
            ON FKC.referenced_object_id=oReferenceCol.object_id /* ID of the object to which this column belongs.*/
            AND FKC.referenced_column_id=oReferenceCol.column_id/* ID of the column. Is unique within the object.Column IDs might not be sequential.*/

)

select * from   ALL_KEYS_IN_TABLE
where   
    PARENT_TABLE_NAME  in ('YOUR_TABLE_NAME') 
    or REFERENCE_TABLE_NAME  in ('YOUR_TABLE_NAME')
ORDER BY PARENT_TABLE_NAME,CONSTRAINT_NAME; 
```

供参考，请阅读 - [http://blogs.msdn.com/b/sqltips/archive/2005/09/16/469136.aspx](http://blogs.msdn.com/b/sqltips/archive/2005/09/16/469136.aspx)

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2015-03-19T20:56:46.533

我在 2008 年及以后一直在使用它。它类似于列出的其他一些解决方案，但字段名称是正确大小写的以处理特定于大小写的 (LatBin) 排序规则。此外，您可以为其提供一个表名并仅检索该表的信息。

```
-->>SPECIFY THE DESIRED DB
USE ???
GO

/*********************************************************************************************

    LIST OUT ALL PRIMARY AND FOREIGN KEY CONSTRAINTS IN A DB OR FOR A SPECIFIED TABLE

*********************************************************************************************/
DECLARE @tblName VARCHAR(255) 

/*******************/

    SET @tblName = NULL-->NULL will return all PK/FK constraints for every table in the database

/*******************/

SELECT PKTABLE_QUALIFIER = CONVERT(SYSNAME,DB_NAME()), 
       PKTABLE_OWNER = CONVERT(SYSNAME,SCHEMA_NAME(O1.schema_id)), 
       PKTABLE_NAME = CONVERT(SYSNAME,O1.name), 
       PKCOLUMN_NAME = CONVERT(SYSNAME,C1.name), 
       FKTABLE_QUALIFIER = CONVERT(SYSNAME,DB_NAME()), 
       FKTABLE_OWNER = CONVERT(SYSNAME,SCHEMA_NAME(O2.schema_id)), 
       FKTABLE_NAME = CONVERT(SYSNAME,O2.name), 
       FKCOLUMN_NAME = CONVERT(SYSNAME,C2.name), 
       -- Force the column to be non-nullable (see SQL BU 325751) 
       KEY_SEQ             = isnull(convert(smallint,K.constraint_column_id),0), 
       UPDATE_RULE = CONVERT(SMALLINT,CASE OBJECTPROPERTY(F.object_id,'CnstIsUpdateCascade')  
                                        WHEN 1 THEN 0 
                                        ELSE 1 
                                      END), 
       DELETE_RULE = CONVERT(SMALLINT,CASE OBJECTPROPERTY(F.object_id,'CnstIsDeleteCascade')  
                                        WHEN 1 THEN 0 
                                        ELSE 1 
                                      END), 
       FK_NAME = CONVERT(SYSNAME,OBJECT_NAME(F.object_id)), 
       PK_NAME = CONVERT(SYSNAME,I.name), 
       DEFERRABILITY = CONVERT(SMALLINT,7)   -- SQL_NOT_DEFERRABLE 
FROM   sys.all_objects O1, 
       sys.all_objects O2, 
       sys.all_columns C1, 
       sys.all_columns C2, 
       sys.foreign_keys F 
       INNER JOIN sys.foreign_key_columns K 
         ON (K.constraint_object_id = F.object_id) 
       INNER JOIN sys.indexes I 
         ON (F.referenced_object_id = I.object_id 
             AND F.key_index_id = I.index_id) 
WHERE  O1.object_id = F.referenced_object_id 
       AND O2.object_id = F.parent_object_id 
       AND C1.object_id = F.referenced_object_id 
       AND C2.object_id = F.parent_object_id 
       AND C1.column_id = K.referenced_column_id
       AND C2.column_id = K.parent_column_id
       AND (   O1.name = @tblName 
            OR O2.name = @tblName
            OR @tblName IS null)
ORDER BY PKTABLE_NAME,FKTABLE_NAME 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2014-08-18T18:25:43.307

这将获取涉及所选表的任何外键。*假定为 _FIRSTABLENAME_SECONDTABLENAME 格式。

```
 declare @tablename as varchar(MAX)
 SET @tablename = 'yourtablename'
 SELECT name
 FROM YOURDATABASE.sys.objects
 WHERE type_desc = 'FOREIGN_KEY_CONSTRAINT' and (name LIKE '%_' + @tablename + 'empdb_%' or name LIKE '%_' + @tablename ) 
```

这是更一般的形式：

```
 SELECT name
 FROM YOURDATABASE_PROD.sys.objects
 WHERE type_desc = 'FOREIGN_KEY_CONSTRAINT' and name LIKE '%' + @tablename + '%' and
 name NOT LIKE '[a-zA-Z0-9]' + @tablename + '%' and name NOT LIKE '%' + @tablename + '[a-zA-Z0-9]' 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2015-10-20T14:49:57.487

有如何计算所选 ID 的所有责任。只需更改@dbTableName 值、@dbRowId 值及其类型（如果 int，您需要删除第 82 行中的 '' (..SET @SQL = ..)）。享受。

```
DECLARE @dbTableName varchar(max) = 'User'
DECLARE @dbRowId uniqueidentifier = '21d34ecd-c1fd-11e2-8545-002219a42e1c'

DECLARE @FK_ROWCOUNT int
DECLARE @SQL nvarchar(max)

DECLARE @PKTABLE_QUALIFIER sysname
DECLARE @PKTABLE_OWNER sysname
DECLARE @PKTABLE_NAME sysname
DECLARE @PKCOLUMN_NAME sysname
DECLARE @FKTABLE_QUALIFIER sysname
DECLARE @FKTABLE_OWNER sysname
DECLARE @FKTABLE_NAME sysname
DECLARE @FKCOLUMN_NAME sysname
DECLARE @UPDATE_RULE smallint
DECLARE @DELETE_RULE smallint
DECLARE @FK_NAME sysname
DECLARE @PK_NAME sysname
DECLARE @DEFERRABILITY sysname

IF OBJECT_ID('tempdb..#Temp1') IS NOT NULL
    DROP TABLE #Temp1;
CREATE TABLE #Temp1 ( 
    PKTABLE_QUALIFIER sysname,
    PKTABLE_OWNER sysname,
    PKTABLE_NAME sysname,
    PKCOLUMN_NAME sysname,
    FKTABLE_QUALIFIER sysname,
    FKTABLE_OWNER sysname,
    FKTABLE_NAME sysname,
    FKCOLUMN_NAME sysname,
    UPDATE_RULE smallint,
    DELETE_RULE smallint,
    FK_NAME sysname,
    PK_NAME sysname,
    DEFERRABILITY sysname,
    FK_ROWCOUNT int
    );
DECLARE FK_Counter_Cursor CURSOR FOR
    SELECT PKTABLE_QUALIFIER = CONVERT(SYSNAME,DB_NAME()),
       PKTABLE_OWNER = CONVERT(SYSNAME,SCHEMA_NAME(O1.SCHEMA_ID)),
       PKTABLE_NAME = CONVERT(SYSNAME,O1.NAME),
       PKCOLUMN_NAME = CONVERT(SYSNAME,C1.NAME),
       FKTABLE_QUALIFIER = CONVERT(SYSNAME,DB_NAME()),
       FKTABLE_OWNER = CONVERT(SYSNAME,SCHEMA_NAME(O2.SCHEMA_ID)),
       FKTABLE_NAME = CONVERT(SYSNAME,O2.NAME),
       FKCOLUMN_NAME = CONVERT(SYSNAME,C2.NAME),
       -- Force the column to be non-nullable (see SQL BU 325751)
       --KEY_SEQ             = isnull(convert(smallint,k.constraint_column_id), sysconv(smallint,0)),
       UPDATE_RULE = CONVERT(SMALLINT,CASE OBJECTPROPERTY(F.OBJECT_ID,'CnstIsUpdateCascade') 
                                        WHEN 1 THEN 0
                                        ELSE 1
                                      END),
       DELETE_RULE = CONVERT(SMALLINT,CASE OBJECTPROPERTY(F.OBJECT_ID,'CnstIsDeleteCascade') 
                                        WHEN 1 THEN 0
                                        ELSE 1
                                      END),
       FK_NAME = CONVERT(SYSNAME,OBJECT_NAME(F.OBJECT_ID)),
       PK_NAME = CONVERT(SYSNAME,I.NAME),
       DEFERRABILITY = CONVERT(SMALLINT,7)   -- SQL_NOT_DEFERRABLE
    FROM   SYS.ALL_OBJECTS O1,
           SYS.ALL_OBJECTS O2,
           SYS.ALL_COLUMNS C1,
           SYS.ALL_COLUMNS C2,
           SYS.FOREIGN_KEYS F
           INNER JOIN SYS.FOREIGN_KEY_COLUMNS K
             ON (K.CONSTRAINT_OBJECT_ID = F.OBJECT_ID)
           INNER JOIN SYS.INDEXES I
             ON (F.REFERENCED_OBJECT_ID = I.OBJECT_ID
                 AND F.KEY_INDEX_ID = I.INDEX_ID)
    WHERE  O1.OBJECT_ID = F.REFERENCED_OBJECT_ID
           AND O2.OBJECT_ID = F.PARENT_OBJECT_ID
           AND C1.OBJECT_ID = F.REFERENCED_OBJECT_ID
           AND C2.OBJECT_ID = F.PARENT_OBJECT_ID
           AND C1.COLUMN_ID = K.REFERENCED_COLUMN_ID
           AND C2.COLUMN_ID = K.PARENT_COLUMN_ID
           AND O1.NAME = @dbTableName
OPEN FK_Counter_Cursor;
FETCH NEXT FROM FK_Counter_Cursor INTO @PKTABLE_QUALIFIER, @PKTABLE_OWNER, @PKTABLE_NAME, @PKCOLUMN_NAME, @FKTABLE_QUALIFIER, @FKTABLE_OWNER, @FKTABLE_NAME, @FKCOLUMN_NAME, @UPDATE_RULE, @DELETE_RULE, @FK_NAME, @PK_NAME, @DEFERRABILITY;
WHILE @@FETCH_STATUS = 0
   BEGIN
        SET @SQL = 'SELECT @dbCountOut = COUNT(*) FROM [' + @FKTABLE_NAME + '] WHERE [' + @FKCOLUMN_NAME + '] = ''' + CAST(@dbRowId AS varchar(max)) + '''';
        EXECUTE sp_executesql @SQL, N'@dbCountOut int OUTPUT', @dbCountOut = @FK_ROWCOUNT OUTPUT;
        INSERT INTO #Temp1 (PKTABLE_QUALIFIER, PKTABLE_OWNER, PKTABLE_NAME, PKCOLUMN_NAME, FKTABLE_QUALIFIER, FKTABLE_OWNER, FKTABLE_NAME, FKCOLUMN_NAME, UPDATE_RULE, DELETE_RULE, FK_NAME, PK_NAME, DEFERRABILITY, FK_ROWCOUNT) VALUES (@FKTABLE_QUALIFIER, @PKTABLE_OWNER, @PKTABLE_NAME, @PKCOLUMN_NAME, @FKTABLE_QUALIFIER, @FKTABLE_OWNER, @FKTABLE_NAME, @FKCOLUMN_NAME, @UPDATE_RULE, @DELETE_RULE, @FK_NAME, @PK_NAME, @DEFERRABILITY, @FK_ROWCOUNT)
      FETCH NEXT FROM FK_Counter_Cursor INTO @PKTABLE_QUALIFIER, @PKTABLE_OWNER, @PKTABLE_NAME, @PKCOLUMN_NAME, @FKTABLE_QUALIFIER, @FKTABLE_OWNER, @FKTABLE_NAME, @FKCOLUMN_NAME, @UPDATE_RULE, @DELETE_RULE, @FK_NAME, @PK_NAME, @DEFERRABILITY;
   END;
CLOSE FK_Counter_Cursor;
DEALLOCATE FK_Counter_Cursor;
GO
SELECT * FROM #Temp1
GO 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2018-07-12T14:53:55.777

以下解决方案对我有用：

```
--Eliminar las llaves foraneas
declare @query varchar(8000)
declare cursorRecorrerTabla cursor for

SELECT  'ALTER TABLE [PoaComFinH].['+sch.name+'].['+referencingTable.Name+'] DROP CONSTRAINT ['+foreignKey.name+']' 'query'
FROM PoaComFinH.sys.foreign_key_columns fk
JOIN PoaComFinH.sys.tables referencingTable ON fk.parent_object_id = referencingTable.object_id
JOIN PoaComFinH.sys.schemas sch ON referencingTable.schema_id = sch.schema_id
JOIN PoaComFinH.sys.objects foreignKey ON foreignKey.object_id = fk.constraint_object_id
JOIN PoaComFinH.sys.tables referencedTable ON fk.referenced_object_id = referencedTable.object_id

--3ro. abrir el cursor.
open cursorRecorrerTabla
fetch next from cursorRecorrerTabla
into @query
while @@fetch_status = 0
begin
--inicio cuerpo del cursor
    print @query
    exec(@query)
--fin cuerpo del cursor
fetch next from cursorRecorrerTabla
into @query
end
--cerrar cursor
close cursorRecorrerTabla
deallocate cursorRecorrerTabla 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2019-06-20T06:36:07.230

您可以通过以下查询找到：

```
 SELECT OBJECT_NAME (FK.referenced_object_id) 'Referenced Table', 
      OBJECT_NAME(FK.parent_object_id) 'Referring Table', FK.name 'Foreign Key', 
      COL_NAME(FK.referenced_object_id, FKC.referenced_column_id) 'Referenced Column',
      COL_NAME(FK.parent_object_id,FKC.parent_column_id) 'Referring Column'
     FROM sys.foreign_keys AS FK
             INNER JOIN sys.foreign_key_columns AS FKC 
                 ON FKC.constraint_object_id = FK.OBJECT_ID
     WHERE OBJECT_NAME (FK.referenced_object_id) = 'YourTableName'
     AND COL_NAME(FK.referenced_object_id, FKC.referenced_column_id) = 'YourColumnName'
     order by  OBJECT_NAME(FK.parent_object_id) 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2019-09-18T10:11:17.880

也试试。

```
EXEC sp_fkeys 'tableName', 'schemaName' 
```

您不仅可以通过 pk 表名和架构过滤结果，`sp_fkeys`还可以使用 fk 表名和架构过滤结果。[关联](https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/sp-fkeys-transact-sql?view=sql-server-2017)

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2021-05-14T23:59:24.070

```
with tab_list as (
    select t.name AS Table_Name, t.object_id, s.name AS Table_Schema  from sys.tables t, sys.schemas s 
     where t.schema_id = s.schema_id
       and s.name = 'your schema') 
select IIF(col.column_id = 1, tab.TABLE_SCHEMA + '.' + tab.TABLE_NAME, NULL) Table_Name,
       col.Name AS Column_Name, IIF(col.IS_NULLABLE= 0, 'NOT NULL', '') Nullable, st.name Type,
       CASE WHEN st.name = 'decimal' THEN CONVERT(NVARCHAR(4000), col.Precision) + ',' + CONVERT(NVARCHAR(4000), col.Scale) 
            WHEN col.max_length = -1 THEN 'max'
            WHEN st.name in ('int', 'bit', 'bigint', 'datetime2') THEN NULL
       ELSE CONVERT(NVARCHAR(4000), col.max_length / 2)
       END
       AS Length,
       ss.name + '.' + stab.name Referenced_Table, scol.name Referenced_Column 
from sys.COLUMNS col  
    INNER JOIN tab_list tab ON col.object_id = tab.object_id
    INNER JOIN sys.types st ON col.system_type_id = st.system_type_id AND col.user_type_id = st.user_type_id 
    LEFT JOIN [sys].[foreign_key_columns] sfkc ON col.object_id = sfkc.parent_object_id AND col.column_id = sfkc.parent_column_id
    LEFT JOIN sys.tables stab ON sfkc.referenced_object_id = stab.object_id
    LEFT JOIN sys.columns scol ON sfkc.referenced_object_id = scol.object_id AND sfkc.referenced_column_id = scol.column_id 
    LEFT JOIN sys.schemas ss ON ss.schema_id = stab.schema_id 
```

* * *

## 回答 #28

> 赞同：-1
> 
> 时间：2021-11-15T09:53:37.577

此答案建立[在](https://stackoverflow.com/a/18929992)但格式类似于`sp_fkeys`，适用于多列并列出它们的顺序。

```
SELECT fk_obj.name    AS FK_NAME,
       pk_schema.name AS PKTABLE_OWNER,
       pk_table.name  AS PKTABLE_NAME,
       pk_column.name AS PKCOLUMN_NAME,
       fk_schema.name AS FKTABLE_OWNER,
       fk_table.name  AS FKTABLE_NAME,
       fk_column.name AS FKCOLUMN_NAME,
       ROW_NUMBER() over (
           PARTITION BY fk_obj.name, fk_schema.name
           ORDER BY fkc.constraint_column_id
           )          AS KEY_SEQ
FROM sys.foreign_key_columns fkc
         INNER JOIN sys.objects fk_obj
                    ON fk_obj.object_id = fkc.constraint_object_id
         INNER JOIN sys.tables fk_table
                    ON fk_table.object_id = fkc.parent_object_id
         INNER JOIN sys.schemas fk_schema
                    ON fk_table.schema_id = fk_schema.schema_id
         INNER JOIN sys.columns fk_column
                    ON fk_column.column_id = parent_column_id
                        AND fk_column.object_id = fk_table.object_id
         INNER JOIN sys.tables pk_table
                    ON pk_table.object_id = fkc.referenced_object_id
         INNER JOIN sys.schemas pk_schema
                    ON pk_table.schema_id = pk_schema.schema_id
         INNER JOIN sys.columns pk_column
                    ON pk_column.column_id = fkc.referenced_column_id
                        AND pk_column.object_id = pk_table.object_id; 
```

# c# - “隐藏”密码短语、初始化向量等的最佳方式，用于在类库中进行加密

> ID：483197
> 
> 赞同：2
> 
> 时间：2009-01-27T12:20:03.387
> 
> 标签：c#, security, dll, encryption

我正在向类库 (C# 2.0) 添加一些加密方法，并且想知道放置所需密码、盐值和初始化向量的最佳位置。将它们硬编码到 DLL 中是一个非常糟糕的主意，还是我应该对它们进行编码并将它们存储在其他地方？

谢谢。

**编辑：**更多信息 - 数据库中的个人信息（地址、电话号码等）需要加密，没有银行/医疗类型信息，因此解决方案不需要太硬核。类库将在服务器上用于 Web 应用程序，在数据层中使用加密方法。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-27T12:23:05.643

如果您将初始化向量和密钥硬编码到 DLL 中，那么您真的可以完全放弃加密。如果你能告诉我们更多关于你在这里使用加密的原因以及如何精确访问数据，也许我可以建议你如何确保它的安全。

编辑：您可能希望为此目的使用公钥加密（特别是 RSA 算法，因为它被认为是安全的，并且完全在 .NET 框架中实现）。它是非对称的，这意味着它需要不同的密钥来加密（公共）和解密（私有）数据。尽管我仍然不能完全确定您的系统是如何工作的，但我怀疑您只需要将对私钥的访问权限限制为只有能够查看数据库信息的人 - 您当然不想将其存储在与数据库相同的位置。公钥基本上可以提供给任何人，因为它只允许您加密要放入数据库的数据（假设对数据库的写访问受到适当限制）。无论如何，这里有一些链接可以帮助您入门：

*   [在 C# 中实现 RSA](https://stackoverflow.com/questions/384401/implementing-rsa-in-c)
*   [http://www.dotnetspider.com/resources/692-RSA-Encryption-C.aspx](http://www.dotnetspider.com/resources/692-RSA-Encryption-C.aspx)
*   [http://msdn.microsoft.com/en-us/library/system.security.cryptography.rsacryptoserviceprovider.aspx](http://msdn.microsoft.com/en-us/library/system.security.cryptography.rsacryptoserviceprovider.aspx)

希望有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T14:24:45.243

除非您担心您的数据层暴露在 Web 服务上并且您担心数据可能被拦截，否则听起来您需要做的就是在数据库本身上实施加密，而不用担心应用程序。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T11:37:42.317

如果您使用公钥加密，那么您将希望自由分发公钥（很可能）并保持对私钥的访问受到高度限制（仅在您知道安全的存储介质上）。无论哪种方式，通常将密钥作为 base64 编码的字符串存储在 XML 文件中。我相信 RSACryptoServiceProvider 类具有执行此操作的内置功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T15:52:49.213

我想到在基本实用程序方法中使用加密主要用于数据库，但也用于 xml 文件等中的配置数据等。以及出现的任何其他内容。

无论您使用哪种加密都需要一种或另一种密钥或密码短语，我想知道您在哪里以及如何存储这些字符串。

谢谢。

# c++ - OpenCV 的奇怪行为

> ID：483199
> 
> 赞同：2
> 
> 时间：2009-01-27T12:20:45.413
> 
> 标签：c++, visual-studio-2005, opencv

当我在 Visual C++ 2005 中编译我的 Windows 应用程序（称为 CrosslinesDetection）（包括计算机视觉库 OpenCV 1.1）时，我没有收到任何编译或链接错误，但是当我运行它时，它到达一个点并冻结，并且 Windows说：

```
"Unhandled exception at 0x7c915223 in CrosslinesDetection.exe:
0xC0000005: Access violation writing location 0x00030ffc." 
```

该程序是一个常见的 C++ Windows 应用程序，带有两行 OpenCV 代码：

```
IplImage *img = cvCreateImage( cvSize( 1024, 768 ), IPL_DEPTH_8U, 1 );
cvReleaseImage( &img ); 
```

现在奇怪的行为是，如果我 - 包括 OpenCV 行，程序抛出异常 - 排除 OpenCV 行，程序正常工作。

我在另一个项目中使用了 OpenCV 库，没有任何问题。特别是，我为 GUI 制作了一个 C# 项目，并在后台编译为 DLL 的 C++ 项目。如果我为上述行创建这样的解决方案，我在执行过程中没有问题。

有谁知道，什么可能导致这个错误？

感谢您的帮助，斯特凡

* * *

感谢您的评论。

同时，我使用一个最小的项目进行测试。

我仍然不完全理解这个问题，但与此同时，我发现当我包含第三方库（来自 uEye）时会发生异常。

如果我在项目中使用来自 OpenCV 和 uEye 库的单个函数，则会发生异常。如果我使用来自 OpenCV 或 uEye 的单个函数，则不会引发异常。因此，这些与库似乎有些不兼容，或者还有另一个问题。但是，我不知道如何检测它。

* * *

不，不是在这一点上。在最小示例中，功能是不相关的。一个函数初始化相机，另一个函数初始化图像结构。

* * *

但也许错误在其他地方......

我在 Visual Studio 中创建了一个 C++ Windows 窗体应用程序。我在 Form1.h 文件中添加了一个按钮以及相应的功能：

```
private: System::Void Form1_Click(System::Object^  sender, System::EventArgs^  e) {
  OpenCamera();
  IplImage * img = cvCreateImageHeader( cvSize( 1024, 768 ), IPL_DEPTH_8U, 1);
  cvReleaseImage( &img );
  CloseCamera();
} 
```

我在 Form1.h 的开头添加了标题：

```
#include "CameraControl.h"
#include "cv.h" 
```

然后，我必须关闭预编译头选项，并且必须从 /clr:pure 更改为 /clr 选项才能成功编译和链接项目。

但是，然后我运行程序，上面提到的异常被抛出......

我想知道，如果我滥用 C++ Windows 窗体应用程序并且我不应该包含我的纯 C++ 代码，或者 OpenCV 或 uEye 库是否真的存在问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T08:40:18.213

我建议在本机项目中测试相同的代码，而不使用托管代码。MFC 或 Win32 控制台应用程序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T22:09:30.937

是不是

```
cvReleaseImage( img ); 
```

? （和号已删除）您还应该检查正确的调用约定。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T22:25:05.180

我刚刚使用 OpenCV 1.0 和 Visual Studio 2008 运行并编译了这些确切的行，没有任何错误。也许尝试创建一个空项目，它什么都不做，只包含 cxcore.h 标头，然后运行这两行。

也只是对另一张海报：没有＆符号是规范的一部分，他在那里是正确的。抱歉，我会将此作为评论发布，但目前还不能。

# python - 如何停止 Python 脚本而不在 shell 上显示错误消息？

> ID：483208
> 
> 赞同：0
> 
> 时间：2009-01-27T12:24:42.613
> 
> 标签：python, error-handling

我想在看到错误消息时停止 Python 脚本。
我不希望 shell 上有任何错误消息，例如 exit()。
怎么做 ？？？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-27T12:35:43.403

当您发送`CTRL+C`到 Python 脚本时，它会引发`KeyboardInterrupt`异常，因此您可以执行类似的操作

```
try:
    ... Work goes here ...
except KeyboardInterrupt:
    sys.exit(0) 
```

# html - 从垃圾邮件机器人隐藏电子邮件的有效方法

> ID：483212
> 
> 赞同：217
> 
> 时间：2009-01-27T12:25:54.857
> 
> 标签：html, algorithm, email, spam

在我的主页上，我正在使用这种方法从垃圾邮件机器人中隐藏我的电子邮件：

```
<a href="admin [at] example.com"
   rel="nofollow"
   onclick="this.href='mailto:' + 'admin' + '@' + 'example.com'">Contact me</a> 
```

你怎么看待这件事？它有效吗？您还知道或使用过哪些其他方法？

# javascript - 原型上的 Javascript 私有成员

> ID：483213
> 
> 赞同：17
> 
> 时间：2009-01-27T12:26:17.757
> 
> 标签：javascript, prototype, private

好吧，我试图弄清楚这是否有可能。这是代码：

```
a=function(text)
{
   var b=text;
   if (!arguments.callee.prototype.get)
      arguments.callee.prototype.get=function()
    {
         return b;
    }
    else
      alert('already created!');
}

var c=new a("test");  // creates prototype instance of getter
var d=new a("ojoj");  // alerts already created
alert(c.get())        // alerts test 
alert(d.get())        // alerts test from context of creating prototype function :( 
```

如您所见，我尝试创建原型吸气剂。为了什么？好吧，如果你写这样的东西：

```
a=function(text)
{
    var b=text;
    this.getText=function(){ return b}
} 
```

...一切都应该没问题..但实际上每次我创建对象时 - 我都会创建使用内存的 getText 函数。我想在内存中有一个原型函数，它会做同样的事情......有什么想法吗？

编辑：

我尝试了 Christoph 给出的解决方案，它似乎是目前唯一已知的解决方案。它需要记住 id 信息才能从上下文中检索值，但整个想法对我来说很好:) id 只是要记住的一件事，其他所有内容都可以在内存中存储一​​次。事实上，你可以通过这种方式存储很多私有成员，并且任何时候都只使用一个 id。实际上这让我很满意:)（除非有人有更好的主意）。

```
someFunc = function()
{
  var store = new Array();
  var guid=0;
  var someFunc = function(text)
  {
    this.__guid=guid;
    store[guid++]=text;
  }

  someFunc.prototype.getValue=function()
  {
    return store[this.__guid];
  }

  return someFunc;
}()

a=new someFunc("test");
b=new someFunc("test2");

alert(a.getValue());
alert(b.getValue()); 
```

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-01-27T12:55:56.513

JavaScript 传统上不提供属性隐藏机制（“私有成员”）。

由于 JavaScript 是词法范围的，您始终可以通过使用构造函数作为“私有成员”的闭包并在构造函数中定义您的方法，在每个对象级别上模拟它，但这不适用于定义在构造函数的原型属性。

当然，有一些方法可以解决这个问题，但我不推荐它：

```
Foo = (function() {
    var store = {}, guid = 0;

    function Foo() {
        this.__guid = ++guid;
        store[guid] = { bar : 'baz' };
    }

    Foo.prototype.getBar = function() {
        var privates = store[this.__guid];
        return privates.bar;
    };

    Foo.prototype.destroy = function() {
        delete store[this.__guid];
    };

    return Foo;
})(); 
```

`Foo`这会将“私有”属性存储在与您的实例分开的另一个对象中。确保`destroy()`在完成对象后调用：否则，您刚刚创建了内存泄漏。

* * *

**编辑 2015-12-01：** ECMAScript6 使不需要手动对象破坏的改进变体成为可能，例如通过使用[Wea​​kMap](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WeakMap)或最好是[Symbol](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol)，完全避免了对外部存储的需要：

```
var Foo = (function() {
    var bar = Symbol('bar');

    function Foo() {
        this[bar] = 'baz';
    }

    Foo.prototype.getBar = function() {
        return this[bar];
    };

    return Foo;
})(); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-10-06T13:59:32.263

现代浏览器采用了一些 ES6 技术，您可以使用`WeakMap`它来解决 GUID 问题。这适用于 IE11 及更高版本：

```
// Scope private vars inside an IIFE
var Foo = (function() { 
    // Store all the Foos, and garbage-collect them automatically
    var fooMap = new WeakMap();

    var Foo = function(txt) { 
        var privateMethod = function() { 
            console.log(txt); 
        };
        // Store this Foo in the WeakMap
        fooMap.set(this, {privateMethod: privateMethod}); 
    } 

    Foo.prototype = Object.create(Object.prototype); 
    Foo.prototype.public = function() { 
        fooMap.get(this).p(); 
     } 
     return Foo; 
 }());

 var foo1 = new Foo("This is foo1's private method");
 var foo2 = new Foo("This is foo2's private method");
 foo1.public(); // "This is foo1's private method"
 foo2.public(); // "This is foo2's private method" 
```

`WeakMap`在被删除或超出范围后不会存储对任何对象的引用`Foo`，并且由于它使用对象作为键，因此您不需要将 GUID 附加到对象。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-27T12:36:08.597

原型上的方法不能访问“私有”成员，因为它们存在于 javascript 中；你需要某种特权访问者。由于您声明`get`了它可以在哪里看到`b`，它总是会返回`b`创建时的内容。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-12-11T07:43:55.617

在受到 Christoph 的变通方法的极大启发后，我想出了一个稍微修改的概念，它提供了一些增强功能。同样，这个解决方案很有趣，但不一定推荐。这些增强功能包括：

*   不再需要在构造函数中执行任何设置
*   不再需要在实例上存储公共 GUID
*   添加了一些语法糖

本质上，这里的技巧是使用实例对象本身作为访问关联私有对象的关键。通常这对于普通对象是不可能的，因为它们的键必须是字符串。`({} === {})`但是，我能够使用表达式返回的事实来完成此操作`false`。换句话说，比较运算符*可以*辨别唯一对象实例。

长话短说，我们可以使用两个数组来维护实例及其关联的私有对象：

```
Foo = (function() {
    var instances = [], privates = [];

    // private object accessor function
    function _(instance) {
        var index = instances.indexOf(instance), privateObj;

        if(index == -1) {
            // Lazily associate instance with a new private object
            instances.push(instance);
            privates.push(privateObj = {});
        }
        else {
            // A privateObject has already been created, so grab that
            privateObj = privates[index];
        }
        return privateObj;
    }

    function Foo() {
        _(this).bar = "This is a private bar!";
    }

    Foo.prototype.getBar = function() {
        return _(this).bar;
    };

    return Foo;
})(); 
```

你会注意到`_`上面的函数。这是获取私有对象的访问器函数。它工作得很慢，所以如果你用一个新实例调用它，它会动态创建一个新的私有对象。

如果您不想`_`为每个类复制代码，可以通过将其包装在工厂函数中来解决此问题：

```
function createPrivateStore() {
    var instances = [], privates = [];

    return function (instance) {
        // Same implementation as example above ...
    };
} 
```

现在您可以将每个类减少到一行：

```
var _ = createPrivateStore(); 
```

同样，您必须**非常小心地**使用此解决方案，因为如果您不实现并在必要时调用销毁函数，它*可能会造成内存泄漏。*

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-04-17T13:16:43.953

就个人而言，我不太喜欢使用 guid 的解决方案，因为它迫使开发人员在 store 之外声明它并在构造函数中增加它。在大型 javascript 应用程序中，开发人员可能会忘记这样做，这很容易出错。

我非常喜欢彼得的回答，因为您可以使用上下文（this）访问私有成员。但让我非常困扰的一件事是，对私有成员的访问是在 ao(n) 复杂度中完成的。实际上，在数组中查找对象的索引是一种线性算法。假设您想将此模式用于实例化 10000 次的对象。然后，您可能会在每次想要访问私有成员时迭代 10000 个实例。

为了以 ao(1) 复杂性访问私有存储，除了使用 guid 之外别无他法。但为了不打扰 guid 声明和增量，并为了使用上下文访问私有存储，我修改了 Peters 工厂模式，如下所示：

```
createPrivateStore = function () {
var privates = {}, guid = 0;

return function (instance) {
    if (instance.__ajxguid__ === undefined) {
        // Lazily associate instance with a new private object
        var private_obj = {};
        instance.__ajxguid__ = ++guid;
        privates[instance.__ajxguid__] = private_obj;
        return private_obj;
    }

    return privates[instance.__ajxguid__];
} 
```

}

这里的技巧是考虑到尚未处理没有**ajxguid属性的对象。**确实，可以在第一次访问商店之前手动设置属性，但我认为没有神奇的解决方案。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-08-17T03:41:39.413

我认为真正的隐私被高估了。只需要虚拟隐私即可。我认为使用 _privateIdentifier 是朝着正确方向迈出的一步，但还不够远，因为您仍然会看到智能感知弹出窗口中所有 _privateIdentifiers 的列表。更进一步和更好的步骤是在原型和/或构造函数中创建一个对象，用于将您的虚拟私有字段和方法隔离在视线之外，如下所示：

```
 // Create the object
  function MyObject() {}

  // Add methods to the prototype
  MyObject.prototype = {

    // This is our public method
    public: function () {
      console.log('PUBLIC method has been called');
    },

    // This is our private method tucked away inside a nested privacy object called x
    x: {
      private: function () {
        console.log('PRIVATE method has been called');
      }
    },

  }

// Create an instance of the object
var mo = new MyObject(); 
```

现在当编码器键入“mo”时。智能感知只会显示公共函数和“x”。因此，所有私有成员都没有显示，而是隐藏在“x”后面，这使得编码人员不太可能意外调用私有成员，因为他们必须特意输入“mo.x”。查看私人会员。此方法还避免了智能感知列表中的多个私有成员名称混乱，将它们全部隐藏在单个项目“x”后面。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-09-22T19:36:24.977

我知道这个线程现在真的很老了，但我认为这个解决方案可能会让路过的任何人感兴趣：

```
const Immutable = function ( val ) {
    let _val = val;

    this.$ = {
        _resolve: function () {
            return _val;
        }
    };
};
Immutable.prototype = {
    resolve: function () {
        return this.$._resolve();
    }
}; 
```

本质上隐藏了内部*_val*使其不被操纵并使该对象的实例不可变。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2014-01-16T16:15:08.287

我创建了一个新库，用于在原型链上启用私有方法。 [https://github.com/TremayneChrist/ProtectJS](https://github.com/TremayneChrist/ProtectJS)

例子：

```
var MyObject = (function () {

  // Create the object
  function MyObject() {}

  // Add methods to the prototype
  MyObject.prototype = {

    // This is our public method
    public: function () {
      console.log('PUBLIC method has been called');
    },

    // This is our private method, using (_)
    _private: function () {
      console.log('PRIVATE method has been called');
    }
  }

  return protect(MyObject);

})();

// Create an instance of the object
var mo = new MyObject();

// Call its methods
mo.public(); // Pass
mo._private(); // Fail 
```

# c# - 如何在 .NET 3.5 中进行动态对象创建和方法调用

> ID：483215
> 
> 赞同：2
> 
> 时间：2009-01-27T12:26:44.293
> 
> 标签：c#, .net, dynamic, clr, invocation

创建类对象的代码看起来如何：

```
string myClass = "MyClass"; 
```

以上类型，然后调用

```
string myMethod = "MyMethod"; 
```

在那个物体上？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-27T12:31:54.690

*   用于[`Type.GetType(string)`](http://msdn.microsoft.com/en-us/library/system.type.gettype.aspx)获取类型对象。
*   用于[`Activator.CreateInstance(Type)`](http://msdn.microsoft.com/en-us/library/system.activator.createinstance.aspx)创建实例。
*   用于[`Type.GetMethod(string)`](http://msdn.microsoft.com/en-us/library/system.type.getmethod.aspx)检索方法。
*   用于[`MethodBase.Invoke(object, object[])`](http://msdn.microsoft.com/en-us/library/system.reflection.methodbase.invoke.aspx)调用对象上的方法

示例，但没有错误检查：

```
using System;
using System.Reflection;

namespace Foo
{
    class Test
    {
        static void Main()
        {
            Type type = Type.GetType("Foo.MyClass");
            object instance = Activator.CreateInstance(type);
            MethodInfo method = type.GetMethod("MyMethod");
            method.Invoke(instance, null);
        }
    }

    class MyClass
    {
        public void MyMethod()
        {
            Console.WriteLine("In MyClass.MyMethod");
        }
    }
} 
```

每一步都需要仔细检查——你可能找不到类型，它可能没有无参数构造函数，你可能找不到方法，你可能用错误的参数类型调用它。

需要注意的一点：Type.GetType(string) 需要类型的程序集限定名称，除非它在当前执行的程序集或 mscorlib 中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-27T17:30:47.207

我创建了一个使用 .NET 简化动态对象创建和调用的库，您可以在 google 代码中下载该库和代码：[Late Binding Helper](http://code.google.com/p/latebindinghelper/) 在项目中，您将找到一个[Wiki 页面，其中包含该用法](http://code.google.com/p/latebindinghelper/wiki/Usage)，或者您也可以检查这个[CodeProject 中的文章](http://www.codeproject.com/KB/cs/LateBindingHelper.aspx)

使用我的库，您的示例将如下所示：

```
IOperationInvoker myClass = BindingFactory.CreateObjectBinding("MyClassAssembly", "MyClass");
myClass.Method("MyMethod").Invoke(); 
```

甚至更短：

```
BindingFactory.CreateObjectBinding("MyClassAssembly", "MyClass")
     .Method("MyMethod")
     .Invoke(); 
```

它使用流畅的界面，真正简化了这种操作。我希望你能发现它有用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-27T12:32:03.380

下面假设一个对象具有一个公共构造函数和一个返回一些值但不带参数的公共方法。

```
var object = Activator.CreateInstance( "MyClass" );
var result = object.GetType().GetMethod( "MyMethod" ).Invoke( object, null ); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T12:34:40.270

假设你的类在你执行的程序集中，你的构造函数和你的方法是无参数的。

```
Type clazz = System.Reflection.Assembly.GetExecutingAssembly().GetType("MyClass");

System.Reflection.ConstructorInfo ci = clazz.GetConstructor(new Type[] { });
object instance = ci.Invoke(null); /* Send parameters instead of null here */

System.Reflection.MethodInfo mi = clazz.GetMethod("MyMethod");
mi.Invoke(instance, null); /* Send parameters instead of null here */ 
```

# compilation - 如何让 Intersystems Caché 使用新编译的类而不是旧的？

> ID：483249
> 
> 赞同：3
> 
> 时间：2009-01-27T12:38:57.063
> 
> 标签：compilation, intersystems-cache

我在加载和编译现有类的新版本时遇到问题。在加载它们时，没有任何对它们的引用。“Test.Extended”类扩展了“Test.Base”类。“Extended”类调用“Base”类的 ClassMethod。问题是，即使在两个类上加载并执行强制编译之后，被调用的“Base”中的 ClassMethod**也不**是新编译类的方法，而是它的旧版本（通过写入控制台确认）。

为了编译两者，我在终端使用以下命令（f：表示强制，c：表示加载时编译）：

```
NAMESPACE>w $system.OBJ.Load("C:\Test.Base.cls.xml","fc")

Load started on 01/27/2009 10:10:34
Loading file C:\Test.Base.cls.xml as xml
Imported class: Test.Base
Compiling class Test.Base ..................
Compiling routine Test.Base.1
Load finished successfully.
1

NAMESPACE>w $system.OBJ.Load("C:\Test.Extended.cls.xml","fc")

Load started on 01/27/2009 10:10:34
Loading file C:\Test.Extended.cls.xml as xml
Imported class: Test.Extended
Compiling class Test.Extended ..................
Compiling routine Test.Extended.1
Compiling routine Test.Extended.2
Load finished successfully.
1 
```

我们需要系统自动加载和编译这两个文件，但我们不能这样做，因为系统一直在使用旧版本。有人知道如何强制 Intersystems Caché 使用最新版本的编译类吗？

谢谢，路易斯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-11T15:23:13.627

这里有几件事可以尝试：

不要单独加载/编译每个类，而是在不编译的情况下加载它们，然后同时编译它们。

像这样：

```
W $SYSTEM.OBJ.Load("C:\Test.Base.cls.xml")
W $SYSTEM.OBJ.Load("C:\Test.Extended.cls.xml")
W $SYSTEM.OBJ.CompileList("Test.Base.cls,Test.Extended.cls","ckf") 
```

“k”标志告诉编译器保留类的生成源（.INT 文件）。这将让您看到 Cache 实际生成的内容（在 Studio 中：查看->查看其他代码）。你的方法被编译成以“z”为前缀的标签，所以方法 ABC 变成了标签 zABC。编译后的源代码中还有一个时间戳，可以帮助确认它确实做了什么。

“b”标志也可能有帮助。（包括子类）。

# .net - 实现和使用 ICommand 接口，MVVM

> ID：483250
> 
> 赞同：7
> 
> 时间：2009-01-27T12:39:06.080
> 
> 标签：.net, wpf, mvvm, command

尽管我深深地爱上了 MVVM 模式，但似乎有很多问题我（还）无法自己解决。

我想知道 IComamnd 接口的方法的参数有什么用

例如`void Execute(object parameter);`

我像这样将我的视图与视图模型联系起来

```
<Button Command="{Binding SomeCommand}" ... /> 
```

所以“ `parameter`”将永远为空。

欢迎任何提示。

谢谢！

**更新：** 该死，在我发布这个问题一分钟后，我在[Stackoverflow](https://stackoverflow.com/questions/335849/wpf-commandparameter-is-null-first-time-canexecute-is-called)上找到了答案。显然控件确实有一个 CommandParameter 属性。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-27T12:45:58.873

您可以添加 CommandParameter="" 来传递参数。通常你会传入绑定，或者作为绑定一部分的 id，所以命令知道要使用什么记录。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-01T17:48:01.767

我只是开发了一些有用的东西来做到这一点

[http://thibaud60.blogspot.com/2009/02/convert-clr-method-to-icommand-with.html](http://thibaud60.blogspot.com/2009/02/convert-clr-method-to-icommand-with.html)

它是一个名为 {MethodCommand} 的新标记扩展，它将当前 DataContext 的公共方法转换为 ICommand 实例...

这只是一个想法:-)

最好的祝福

# c++ - 用纯虚方法覆盖（常规）虚方法有什么影响？

> ID：483255
> 
> 赞同：3
> 
> 时间：2009-01-27T12:40:43.970
> 
> 标签：c++, overriding, pure-virtual

假设我们有

```
class A {    
public:    
    virtual int foo() { cout << "foo!"; }    
}

class B : public A {
public:    
    virtual int foo() =0;
}

class C : public B {
public:
    virtual int foo() { cout << "moo!"; }
} 
```

这真的是*压倒一切*的吗？我认为这实际上是**重载**。从设计角度来看，制作这样的东西有什么意义？

我们得到了一个基类 A。然后我们得到了一个派生自具体类 A 的抽象派生类 B，然后是通过 C 实现的 B。

我们在这里做什么，这有意义吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T13:05:43.310

重载意味着你有两个同名但参数不同的函数。这不是这里的情况。

例子：

```
int functionA() { /*...*/ };
int functionA(int someParameter) { /*...*/ }; 
```

重写意味着在子类中重写具有相同参数的函数。这就是你作为例子提出的。

这就是定义部分。现在开始设计：

当你有一个纯虚函数时，具体的子类必须覆盖它。因此，通过添加纯虚函数，您可以确保所有子类都提供相同的一组函数（=interface）。示例代码中似乎就是这种情况。

但这不是一个很好的例子，因为具体的超类已经实现了 foo() 的默认功能。当有一个抽象子类将其重新定义为纯虚拟时，这对我来说表明类层次结构存在缺陷，因为子类（以及 foo() 的调用者）通常应该能够回退到默认实现。用这样一个抽象的例子来解释有点困难，但是像这样的层次结构在我看来有点可疑。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T12:48:44.827

在我看来，这里纯虚方法的唯一作用就是让 B 成为一个抽象类。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T12:51:19.377

它仍然是重写的，因为当你有一个指向class 实例的指针`p`时，仍然调用`A*``C``p->foo()``C::foo()`

可能，设计者想要在派生自某个具体类的层次结构中插入一个抽象类，并强制覆盖子类中的方法。我不认为这是非常明智的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T15:50:05.383

您是说从 B 派生的类必须实现*int foo();* . 您可能想做这样的事情来迫使其他程序员考虑他们希望*foo()*的行为方式，但我认为这是一个坏主意 - 实际上他们很可能通过调用*A::foo()*来实现。

如果您只想使*B*抽象，请给它一个纯虚拟析构函数 - 您还需要提供析构函数的实现以避免链接错误。

# .net - 如何阻止 .NET WebBrowser 控件中的下载？

> ID：483262
> 
> 赞同：17
> 
> 时间：2009-01-27T12:42:11.580
> 
> 标签：.net, browser, download

我需要阻止 .NET WebBrowser 控件显示任何“您要打开还是保存此文件？” 和“另存为”对话框。相反，我想显示一个消息框，告诉用户出于安全原因禁用文件下载。

我从 的`FileDownload`事件开始`WebBrowser`，但它不允许取消。然后，我使用[CodeProject 中的方法：Extended .NET 2.0 WebBrowser Control](http://www.codeproject.com/KB/cpp/ExtendedWebBrowser.aspx?fid=285594&select=2560552)在原始 COM 调用的基础上使用 interface 实现我自己的事件`DWebBrowserEvents2`。当我根据[有关 FileDownload 签名错误的 MS 知识库条目](http://support.microsoft.com/?scid=kb%3Ben-us%3B325204&x=15&y=12)修复代码时，事件处理程序被调用并且我能够取消下载。

但是，这不适用于所有下载：下载指向 URL 的 URL，包括`.exe`引发事件，并且可以在对话框出现之前取消 - 但对于其他人（如`.do`），事件处理程序在用户单击之前不会被调用`Open`，`Save`或者`Cancel`在对话。

一个可能的解决方案可能是在[向用户显示之前](http://www.codeproject.com/KB/shell/WebBrowserControlDialogs.aspx)[拦截`WH_CALLWNDPROCRET`](http://www.codeproject.com/KB/shell/WebBrowserControlDialogs.aspx)消息并“回答”对话框，但这听起来很费力，我也更喜欢更清洁的解决方案......

有人知道如何可靠地阻止所有下载吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2013-06-17T21:44:03.770

唯一可靠的方法似乎是挂接到 Windows 事件队列并抑制对话框（因为各种事情都可以让用户访问）。这就是我们的助手类所做的：

```
 void ListenForDialogCreation()
    {
        // Listen for name change changes across all processes/threads on current desktop...
        _WinEventHook = WinAPI.SetWinEventHook(WinAPI.EVENT_OBJECT_CREATE, procDelegate);
    }
    void StopListeningForDialogCreation()
    {
        WinAPI.UnhookWinEvent(_WinEventHook);
    }

    void WinEventProc(IntPtr hWinEventHook, uint eventType, IntPtr hwnd, int idObject, int idChild, uint dwEventThread, uint dwmsEventTime)
    {
        const uint OBJID_WINDOW = 0;
        const uint CHILDID_SELF = 0;

        // filter out non-HWND, and things not children of the current application
        if (idObject != OBJID_WINDOW || idChild != CHILDID_SELF)
            return;

        //Get the window class name
        StringBuilder ClassName = new StringBuilder(100);
        WinAPI.GetClassName(hwnd, ClassName, ClassName.Capacity);

        // Send close message to any dialog
        if (ClassName.ToString() == "#32770")
        {
            WinAPI.SendMessage(hwnd, WinAPI.WM.CLOSE, IntPtr.Zero, IntPtr.Zero);
            if (OnDialogCancelled != null)
                OnDialogCancelled();
        }
        if (ClassName.ToString() == "#32768")
        {
            WinAPI.SendMessage(hwnd, WinAPI.WM.CLOSE, IntPtr.Zero, IntPtr.Zero);
            if (OnDialogCancelled != null)
                OnDialogCancelled();
        }

    }

    public delegate void OnDialogCancelledEvent();
    public event OnDialogCancelledEvent OnDialogCancelled; 
```

*   #32770 是 Dialog 类
*   #32768 是弹出菜单
*   WinAPI 命名空间是我们的 pinvoke 包装器。

如果您不想阻止所有 Dialogs，您需要在上完课程后添加一些额外的过滤器。这取决于您需要有多安全。在 $WORK，我们需要阻止所有上传和下载。

抑制弹出菜单是必要的，因为它可以访问帮助应用程序，该应用程序提供指向微软网站的链接，从而可以启动 IE 的完整实例。然后他们可以为所欲为。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-28T07:22:09.417

您可以使用`Navigating`允许取消的事件。

在此事件中，您可以尝试连接到自己正在导航的 URL，检查 http 响应标头并在检测到不适当的 ContentType 时取消导航。

```
System.Net.WebRequest request = System.Net.WebRequest.Create(e.Url);

// we need only header part of http response
request.Method = "HEAD";

System.Net.WebResponse response = request.GetResponse();

// only text/html, text/xml, text/plain are allowed... extend as required
if (!response.ContentType.StartsWith("text/"))
{
  e.Cancel = true;
  MessageBox.Show("Not allowed for security resons...");
} 
```

显然，这不是万无一失的解决方案，但可以让您了解如何开始（如果您不介意为了检索 http 响应标头而进行额外的微小往返）。

> **延斯班曼写道：**
> 
> 这并不理想，因为我正在处理额外请求可能触发执行两次操作的 Web 应用程序:-(

然后，我将创建一些简单的代理服务器来检查所有接收到的数据，并过滤掉所有可能触发 Web 浏览器控件中的“另存为”对话框的 http 响应。

简单地说，不要让您的网络浏览器控制直接访问互联网，而是将所有 http 请求委托给您的特殊代理服务器，该代理服务器将过滤掉来自网络的所有不安全响应。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-01-21T20:18:01.267

这个项目 - [http://www.codeproject.com/Articles/157329/Http-Monitor-for-Webbrowser-Control](http://www.codeproject.com/Articles/157329/Http-Monitor-for-Webbrowser-Control)允许拦截和检查来自 WebBrowser 控件的 HTTP 流量。

然后你可以通过 MIME 过滤数据，只允许 html、图像、脚本等。

# iphone - 在 cocos2d 中带键盘的 TextField ！

> ID：483264
> 
> 赞同：1
> 
> 时间：2009-01-27T12:42:47.430
> 
> 标签：iphone, objective-c, cocoa-touch, cocos2d-iphone

我正在尝试使用 cocos2d 开发一个 iphone 应用程序。我创建一个带有文本字段的警报视图。当我触摸文本字段时，键盘出现了。但我希望当警报打开时，同时选择文本字段并且键盘出现（没有任何触摸）。怎么可能？对不起，我的英语不好。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T15:09:30.907

[myTextField becomeFirstResponder] 可能会做你想做的事。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T15:14:55.780

这样做会有点棘手。iPhone 中的控件使用“第一响应者”的概念。任何事件都将由控制器中的第一响应者处理。现在，当显示警报视图时，它会成为第一响应者，因此它可以响应按钮单击。当用户选择文本字段时，键盘将获得控制权。所以我想你想要实现的目标可以通过在显示警报后使文本字段成为第一响应者来完成（[txtField becomeFirstResponder]）

但我不知道警报视图的响应将如何处理。在键盘被关闭并且您辞去文本字段的第一响应者之前，您将无法单击警报视图上的“确定”按钮。([txtField resignFirstResponder]) （这只是一个猜测，您必须检查最终行为）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T00:00:28.513

[myTextField becomeFirstResponder] 有效——我对其进行了测试。

# sql-server - 服务器资源管理器不可用（VS2008Pro）

> ID：483273
> 
> 赞同：4
> 
> 时间：2009-01-27T12:46:12.850
> 
> 标签：sql-server, visual-studio-2008, entity-framework

我最近在使用 VS 2008 时遇到了一些问题，建议重新安装。为了确保重新安装能解决我的问题，我手动卸载了所有可能与 VS 和 SQL Server 相关的东西（我安装了 2008 Express 版）。

现在，当我重新安装 SQL Server 和 Visual Studio 时，VS 中的服务器资源管理器已经死了。当我单击菜单选项“查看\服务器资源管理器”时，我在输出窗口中收到一条错误消息：

> 由于先前的错误，Visual Studio Explorers and Designers Package ({8D8529D3-625D-4496-8354-3DAD630ECC1B}) 未加载。如需帮助，请联系包装供应商。要尝试再次加载此包，请在命令提示符处键入“devenv /resetskippkgs”。

我运行了建议的命令，但是当我再次尝试时，我得到了完全相同的错误消息。

我该如何解决这个问题？当我使用实体框架时，VS 可以连接到我的数据库至关重要......非常感谢任何帮助！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T23:53:35.937

在互联网上来回查看后，遇到了*很多*不同的答案，我终于设法让它工作了。这是我的解决方案：

1.  关闭所有打开的 Visual Studio 实例。

2.  **通过导航到Start\All Programs\Accessories**，右键单击**Command Prompt**并选择**Run as Administrator**，在管理员上下文中打开命令提示符。

3.  导航到 VS2008 的安装路径 - 在我的情况下（在 Vista x64 上默认）它是 **C:\Program Files (x86)\Microsoft Visual Studio 2008 9.0\Common7\IDE**

4.  运行命令**devenv /setup**。这需要一点时间，但请耐心等待。

5.  启动 Visual Studio。

执行这些步骤后，设置将重置为默认设置，因此您必须重新配置所有启动选项、文本编辑器的字体等。这可能会通过运行**devenv /resetskippkgs**来帮助，但它没有在我的机器上。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T17:06:32.987

我在 Visual Studio 2008 中也遇到过这个问题。运行 devenv 命令行语句并没有帮助我。在 Visual Studio 2008 Service Pack 1 出现之前，我基本上不得不忍受它。自安装 Service Pack 1 以来，我在使用 Server Explorer 时没有遇到任何问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-07-07T16:48:04.870

如上所述运行“devenv /setup”。现在，在不打开任何解决方案或项目文件的情况下启动 Visual Studio。如果此时服务器资源管理器打开，请从那里删除所有数据连接和服务器。现在，退出并重新启动 Visual Studio。然后，打开解决方案或项目文件，错误就消失了。这对我有用。

# excel - VBA UserForms-工具和/或技术的自动化测试？

> ID：483274
> 
> 赞同：7
> 
> 时间：2009-01-27T12:47:46.013
> 
> 标签：excel, testing, vba, automated-tests, regression-testing

我希望在一个相当大的 Excel 加载项上开始自动回归测试，该加载项围绕一个由几个带有标准控件的模态用户窗体组成的 GUI。

主要问题是我研究过的大多数自动化测试工具（Rational *Robot*、AutomatedQA *TestComplete*、Network Automation *Automate*等）并不完全支持 VBA 控件，因此他们的测试最终会重播鼠标点击和按键操作，所以不是t 真的可以维护。理想情况下，我需要一个能够识别 VBA 表单控件的测试工具，所以我可以说“按下此按钮并等待此列表框更改”而不是“单击 (237, 58) 并等待 500 毫秒”。

我还考虑将测试自动化作为 VBA 构建到加载项中，但用户的大部分时间都花在与模式对话框交互上，该对话框会阻止 VBA 在后台运行，所以这几乎是不可能的。

我的问题 - 这里有没有人有任何使用自动化测试工具的经验

a) 识别 VBA 用户表单控件并能可靠地与它们交互

b) 支持带有条件分支和成功/失败日志的测试脚本，而不仅仅是记录和回放？

或者，有谁知道我可以解决模式对话框暂停 VBA 执行的问题，以便我可以从 VBA 中驱动加载项？

我花了一段时间在 QA 论坛上四处寻找，但在那里没有找到任何东西，所以任何帮助或线索将不胜感激。

谢谢你的帮助，

-马丁

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T13:11:09.977

我不知道有什么工具可以按照您所说的进行，但是您是否考虑过从不同的方向进行攻击？

我在这里推测一下，有多少逻辑可以被推入“普通”VB/VBA 类中，从而可以对单个方法进行单元测试。也许这样的类甚至可能会暴露事件，因此为了进行测试，您可以将表单替换为提供必要刺激并收集响应以进行检查的测试工具。

它不会解决（现在非常轻量级的）表单本身与底层类的连接，但它至少会最小化未测试的区域。

我真的只是在想“大声”，但你认为这会奏效吗？

# c++ - 如果 com dll 未注册，如何防止崩溃

> ID：483276
> 
> 赞同：2
> 
> 时间：2009-01-27T12:48:25.373
> 
> 标签：c++, com

从我尝试使用 com dll 的一些旧 c++ 代码中，注册 dll 时它可以正常工作，但如果 dll 未注册，它会崩溃。

// 初始化 COM。HRESULT hr = CoInitialize(NULL);

IGetTestPtr ptest(__uuidof(tester));

*“使用 dll 中的方法”*

// 取消初始化 COM。联合初始化（）；

在调用 IGetTestPtr ptest(__uuidof(tester)) 之前是否要检查 dll 是否已注册？

或者防止崩溃的正确方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T13:02:17.780

在您的对象上调用 CreateInstance 将返回一个 HRESULT，可以测试它是否成功：

```
IGetTestPtr p = null; 
HRESULT hRes = p.CreateInstance( __uuidof(tester) );
bool bSuccess = SUCCEEDED(hRes); 
```

这假设您已经使用 Visual Studio 在类型库周围创建了一个接口包装器，其中在接口中使用了 COM 智能指针（这为您提供了 CreateInstance 方法）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T12:54:19.870

如果 DLL 已注册，则在`HKCR/CLSID/{uuidof(tester)}`（大括号很重要）中有一条记录。

实际上，如果不是，那么`CoCreateInstance`将返回错误。在使用指针之前检查此错误。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-27T13:18:02.320

如果未注册 COM 类，则 CoCreateInstance 将返回 REGDB_E_CLASSNOTREG。您应该使用 SUCCEEDED() 或 FAILED() 宏检查一般成功或失败。您还需要正确地创建对象 - 请参阅 MDSN 了解[COM 的介绍](http://msdn.microsoft.com/en-us/library/ms680573(VS.85).aspx)。例如：

```
HRESULT hr = CoInitialize(NULL);
if (SUCCEEDED(hr))
{
    IGetTestPtr ptr = NULL;
    hr = CoCreateInstance(CLSID_MyObjectNULL, CLSCTX_INPROC_SERVER, IID_IMyInterface, ptr)
    if (SUCCEEDED(hr))
    {
        Do something with your COM object
        ...

        // Don't forget to release your interface pointer or the object will leak
        ptr->Release();
    }

    hr = CoUninitialize();
}
return hr; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T14:09:02.183

如果我没记错的话，这个“#import”风格的 COM 框架会引发异常。在代码周围添加一个 try-catch 块。谷歌告诉我例外是 _com_error 类型。

除非您在 #import 上调整参数以防止这种情况发生，否则所有失败的 COM 调用都会引发异常。您将不得不关闭它（我认为#import "raw" 接口可以做到这一点-查看#import 文档）或真正熟悉这些异常。

# java - 创建自定义 JAXB 注释

> ID：483281
> 
> 赞同：2
> 
> 时间：2009-01-27T12:50:28.787
> 
> 标签：java, xml, xsd, jaxb

人们对我如何编写自己的自定义 JAXB 注释处理类以支持在 xsd 模式中生成 xs:annotation/xs:documentation 元素有任何建议吗？我想创建一个新的 java 注释“@XmlAnnotation”，其中包含一个“文档”属性。然后，我将通过类路径将这些类提供给 JAXB 模式生成器。然后，模式生成器将采用这个示例 java 代码

```
@XmlRootElement(name="ClientData")
public class ClientData {

/**
 * The first address field of the person
 */
@XmlAnnotation(documentation="The first address field of the client")
private String address1 = null;
} 
```

并创建此 xsd 架构

```
<xs:complexType name="clientData">
  <xs:sequence>
<xs:element minOccurs="0" name="address1" type="xs:string">
    <xs:annotation>
  <xs:documentation>The first address field of the client</xs:documentation>
</xs:annotation> 
```

从现有的 @XmlElement 注释类扩展，并且只添加对额外文档属性的支持会更容易吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T20:43:12.153

这个 XmlRootElement 几乎是空的（[http://docjar.org/src/api/javax/xml/bind/annotation/XmlRootElement.java](http://docjar.org/src/api/javax/xml/bind/annotation/XmlRootElement.java)，里面没有“活动”代码

**主要修改是使用**此注释更改代码并生成 xsd 文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-10T16:45:05.290

那将只允许根元素的构造。它在几乎所有 xs 命名空间元素中都有效。

我不明白为什么它不被支持为标准。

# jdbc - 使用 JDBC 和 ODBC 将 TEXT 列插入 Informix 数据库的一致方法

> ID：483284
> 
> 赞同：6
> 
> 时间：2009-01-27T12:51:13.497
> 
> 标签：jdbc, odbc, informix

当我尝试通过 JDBC 向 Informix TEXT 列插入一些数据时出现问题。在 ODBC 中，我可以像这样简单地运行 SQL：

```
INSERT INTO test_table (text_column) VALUES ('insert') 
```

但这在 JDBC 中不起作用，我得到了错误：

```
617: A blob data type must be supplied within this context. 
```

我搜索了这样的问题，发现了 2003 年的消息：

[http://groups.google.com/group/comp.databases.informix/browse_thread/thread/4dab38472e521269?ie=UTF-8&oe=utf-8&q=Informix+jdbc+%22A+blob+data+type+must+be+提供+在+这个%22](http://groups.google.com/group/comp.databases.informix/browse_thread/thread/4dab38472e521269?ie=UTF-8&oe=utf-8&q=Informix+jdbc+%22A+blob+data+type+must+be+supplied+within+this%22)

我将代码更改为使用 PreparedStatement。现在它适用于 JDBC，但在 ODBC 中，当我尝试使用 PreparedStatement 时出现错误：

```
Error: [Informix][Informix ODBC Driver][Informix]
Illegal attempt to convert Text/Byte blob type.
[SQLCode: -608], [SQLState: S1000] 
```

测试表是通过以下方式创建的：

```
CREATE TABLE _text_test (id serial PRIMARY KEY, txt TEXT) 
```

用于测试两个驱动程序的 Jython 代码：

```
# for Jython 2.5 invoke with --verify
# beacuse of bug: http://bugs.jython.org/issue1127

import traceback
import sys
from com.ziclix.python.sql import zxJDBC

def test_text(driver, db_url, usr, passwd):
    arr = db_url.split(':', 2)
    dbname = arr[1]
    if dbname == 'odbc':
        dbname = db_url
    print "\n\n%s\n--------------" % (dbname)
    try:
        connection = zxJDBC.connect(db_url, usr, passwd, driver)
    except:
        ex = sys.exc_info()
        s = 'Exception: %s: %s\n%s' % (ex[0], ex[1], db_url)
        print s
        return
    Errors = []
    try:
        cursor = connection.cursor()
        cursor.execute("DELETE FROM _text_test")
        try:
            cursor.execute("INSERT INTO _text_test (txt) VALUES (?)", ['prepared', ])
            print "prepared insert ok"
        except:
            ex = sys.exc_info()
            s = 'Exception in prepared insert: %s: %s\n%s\n' % (ex[0], ex[1], traceback.format_exc())
            Errors.append(s)
        try:
            cursor.execute("INSERT INTO _text_test (txt) VALUES ('normal')")
            print "insert ok"
        except:
            ex = sys.exc_info()
            s = 'Exception in insert: %s: %s\n%s' % (ex[0], ex[1], traceback.format_exc())
            Errors.append(s)
        cursor.execute("SELECT id, txt FROM _text_test")
        print "\nData:"
        for row in cursor.fetchall():
            print '[%s]\t[%s]' % (row[0], row[1])
        if Errors:
            print "\nErrors:"
            print "\n".join(Errors)
    finally:
        cursor.close()
        connection.commit()
        connection.close()

#test_varchar(driver, db_url, usr, passwd)
test_text("sun.jdbc.odbc.JdbcOdbcDriver", 'jdbc:odbc:test_db', 'usr', 'passwd')
test_text("com.informix.jdbc.IfxDriver", 'jdbc:informix-sqli://169.0.1.225:9088/test_db:informixserver=ol_225;DB_LOCALE=pl_PL.CP1250;CLIENT_LOCALE=pl_PL.CP1250;charSet=CP1250', 'usr', 'passwd') 
```

JDBC 或 ODBC 中是否有任何设置为两个驱动程序提供一个版本的代码？

版本信息：

*   服务器：IBM Informix 动态服务器版本 11.50.TC2DE
*   客户：
    *   ODBC 驱动程序 3.50.TC3DE
    *   适用于 IBM Informix Dynamic Server 3.50.JC3DE 的 IBM Informix JDBC 驱动程序

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-28T03:21:23.630

首先，您确定要使用 Informix TEXT 类型吗？该类型使用起来很麻烦，部分原因是您面临的问题。它早于任何 SQL 标准中关于大对象的任何内容（TEXT 在 SQL-2003 中仍然没有——尽管近似等效的结构 CLOB 和 BLOB 是）。而且 BYTE 和 TEXT blob 的功能从那时起就没有改变过——哦，假设是 1996 年，尽管我怀疑有可能选择更早的日期，比如 1991 年。

特别是，您计划在 TEXT 列中存储多少数据？您的示例显示了字符串“插入”；也就是说，我想，比你真正使用的要小得多。您应该知道 BYTE 或 TEXT 列使用表中的 56 字节描述符加上单独的页面（或页面集）来存储实际数据。因此，对于像这样的小字符串，这是对空间和带宽的浪费（因为 BYTE 或 TEXT 对象的数据将与行的其余部分分开在客户端和服务器之间传送）。如果您的大小不会超过 32 KB，那么您应该考虑使用 LVARCHAR 而不是 TEXT。如果您将使用高于此的数据大小，那么 BYTE 或 TEXT 或 BLOB 或 CLOB 是明智的选择，但是您应该考虑配置 blob 空间（用于 BYTE 或 TEXT）或智能 blob 空间（用于 BLOB 或 CLOB）。您可以并且正在使用 TEXT IN TABLE，而不是在 blob 空间中；请注意，这样做会影响您的逻辑日志，而使用 blob 空间不会对它们产生任何影响。

大约十年来我一直在宣传的功能之一是能够将 SQL 语句中的字符串文字作为 TEXT 文字（或 BYTE 文字）传递。这部分是因为像你这样的人的经历。我还没有成功地将其优先于需要进行的其他更改。当然，您需要注意 SQL 语句的最大大小为 64 KB 文本，因此如果您不小心，可能会创建太大的 SQL 语句；SQL 中的占位符（问号）通常可以防止这是一个问题——增加 SQL 语句的大小是我一直在争取的另一个功能请求，但不那么热情。

好的，假设您有充分的理由使用 TEXT ......下一步是什么。我不清楚 Java（JDBC 驱动程序）在幕后做了什么——除了太多——但可以肯定的是，它注意到需要一个 TEXT 'locator' 结构并且正在以正确的方式传送参数格式。看来 ODBC 驱动程序并没有让您沉迷于类似的恶作剧。

在我通常工作的 ESQL/C 中，代码必须以不同于其他所有内容的方式处理 BYTE 和 TEXT（并且必须再次以不同方式处理 BLOB 和 CLOB）。但是您可以创建和填充定位器结构（locator.h 中的 loc_t 或 ifx_loc_t - 它可能不在 ODBC 目录中；默认情况下它在 $INFORMIXDIR/incl/esql 中）并将其传递给 ESQL/C 代码作为SQL 语句中相关占位符的宿主变量。原则上，可能有一种可用于 ODBC 的并行方法。不过，您可能必须查看 Informix ODBC 驱动程序手册才能找到它。

# jdbc - 是否可以通过 SSIS 建立 JDBC 连接？

> ID：483289
> 
> 赞同：2
> 
> 时间：2009-01-27T12:53:17.453
> 
> 标签：jdbc, ssis

我以前从未使用过 JDBC 连接，并且只熟悉 ODBC 连接。我们有一个只支持 JDBC 的供应商。他们认为 ODBC 是“开源的”，因此不支持通过 ODBC 连接连接到他们的数据库。有谁知道是否可以通过 JDBC 创建 SSIS 连接？从我最初的在线研究中，我没有得到任何结果。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-27T13:05:18.787

不，SSIS 没有执行此操作所需的 java 接口。您必须使用 ADO.Net 或 OLEDB 驱动程序，或 ODBC 的 OLEDB 提供程序才能连接到数据库。

您可以编写一个 java 程序，将数据提取到一个文件中，然后从该文件中读取数据。您可以从 SSIS 执行一个进程，该进程可用于运行 Java 程序。

# plugins - 如何从 Dynamics CRM 发送内容

> ID：483291
> 
> 赞同：0
> 
> 时间：2009-01-27T12:55:07.420
> 
> 标签：plugins, dynamics-crm-4, crm

我想开发一种从 Microsoft Dynamics CRM 4.0 发送文本消息 (SMS) 的方法。

例如：单击按钮将打开一个窗口，我可以在其中输入我的消息。单击发送将向我正在使用的 SOAP XML Web 服务发送一个请求，其中包含联系人的手机号码和我的文本。我还希望能够将它安装在我的一些客户的 CRM 服务器上。

最好的方法是什么？我应该开发插件还是使用 JScript 并将其集成到工作流中？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-28T23:15:58.943

我假设您想将消息存储在 CRM 中。您可以创建文本消息自定义实体或修改其中一个活动实体以存储该数据。

从那里开始，这取决于您最喜欢什么。您可以从 javascript 或自定义工作流程调用 Web 服务。自定义工作流程往往允许更好的可测试性和调试，但设置和安装工作量更大（不难，只是更多的工作）。但是，如果没有某种框架（JQuery、Prototype），使用 javascript 与 Web 服务进行通信可能会很乏味。

我的意见：使用自定义工作流程。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T11:22:34.003

最好的方法之一是使用 Microsoft Biztalk Server

# c# - 使用线程时内存泄漏

> ID：483295
> 
> 赞同：2
> 
> 时间：2009-01-27T12:56:51.143
> 
> 标签：c#, .net, multithreading, memory, timer

我似乎在这段代码中有内存泄漏。它是一个控制台应用程序，它创建了几个类（WorkerThread），每个类都以指定的时间间隔写入控制台。Threading.Timer 用于执行此操作，因此写入控制台是在单独的线程中执行的（在从 ThreadPool 获取的单独线程中调用 TimerCallback）。更复杂的是，MainThread 类与 FileSystemWatcher 的 Changed 事件挂钩；当 test.xml 文件更改时，会重新创建 WorkerThread 类。

每次保存文件时（每次重新创建 WorkerThread 并因此重新创建 Timer），任务管理器中的内存都会增加（Mem Usage，有时还会增加 VM Size）；此外，在 .Net Memory Profiler (v3.1) 中，WorkerThread 类的 Undisposed Instances 增加了两个（但这可能是一个红鲱鱼，因为我读过 .Net Memory Profiler 有一个错误，它很难检测到处置的类。

无论如何，这是代码 - 有人知道出了什么问题吗？

**编辑**：我已经将类创建移出 FileSystemWatcher.Changed 事件处理程序，这意味着 WorkerThread 类总是在同一个线程中创建。我为静态变量添加了一些保护。我还提供了线程信息以更清楚地显示正在发生的事情，并且一直在使用 Timer 与使用显式线程进行交换；但是，内存仍在泄漏！Mem Usage 一直在缓慢增加（这仅仅是由于控制台窗口中的额外文本吗？），并且当我更改文件时 VM Size 会增加。这是最新版本的代码：

**编辑**这似乎主要是控制台使用内存的问题，因为您写入它。显式编写的线程仍然存在增加内存使用量的问题。请参阅[下面的答案](https://stackoverflow.com/questions/483295/memory-leak-while-using-threads/553057#553057)。

```
class Program
{
    private static List<WorkerThread> threads = new List<WorkerThread>();

    static void Main(string[] args)
    {
        MainThread.Start();

    }
}

public class MainThread
{
    private static int _eventsRaised = 0;
    private static int _eventsRespondedTo = 0;
    private static bool _reload = false;
    private static readonly object _reloadLock = new object();
    //to do something once in handler, though
    //this code would go in onStart in a windows service.
    public static void Start()
    {
        WorkerThread thread1 = null;
        WorkerThread thread2 = null;

        Console.WriteLine("Start: thread " + Thread.CurrentThread.ManagedThreadId);
        //watch config
        FileSystemWatcher watcher = new FileSystemWatcher();
        watcher.Path = "../../";
        watcher.Filter = "test.xml";
        watcher.EnableRaisingEvents = true;
        //subscribe to changed event. note that this event can be raised a number of times for each save of the file.
        watcher.Changed += (sender, args) => FileChanged(sender, args);

        thread1 = new WorkerThread("foo", 10);
        thread2 = new WorkerThread("bar", 15);

        while (true)
        {
            if (_reload)
            {
                //create our two threads.
                Console.WriteLine("Start - reload: thread " + Thread.CurrentThread.ManagedThreadId);
                //wait, to enable other file changed events to pass
                Console.WriteLine("Start - waiting: thread " + Thread.CurrentThread.ManagedThreadId);
                thread1.Dispose();
                thread2.Dispose();
                Thread.Sleep(3000); //each thread lasts 0.5 seconds, so 3 seconds should be plenty to wait for the 
                                    //LoadData function to complete.
                Monitor.Enter(_reloadLock);
                thread1 = new WorkerThread("foo", 10);
                thread2 = new WorkerThread("bar", 15);
                _reload = false;
                Monitor.Exit(_reloadLock);
            }
        }
    }

    //this event handler is called in a separate thread to Start()
    static void FileChanged(object source, FileSystemEventArgs e)
    {
        Monitor.Enter(_reloadLock);
        _eventsRaised += 1;
        //if it was more than a second since the last event (ie, it's a new save), then wait for 3 seconds (to avoid 
        //multiple events for the same file save) before processing
        if (!_reload)
        {
            Console.WriteLine("FileChanged: thread " + Thread.CurrentThread.ManagedThreadId);
            _eventsRespondedTo += 1;
            Console.WriteLine("FileChanged. Handled event {0} of {1}.", _eventsRespondedTo, _eventsRaised);
            //tell main thread to restart threads
            _reload = true;
        }
        Monitor.Exit(_reloadLock);
    }
}

public class WorkerThread : IDisposable
{
    private System.Threading.Timer timer;   //the timer exists in its own separate thread pool thread.
    private string _name = string.Empty;
    private int _interval = 0;  //thread wait interval in ms.
    private Thread _thread = null;
    private ThreadStart _job = null;

    public WorkerThread(string name, int interval)
    {
        Console.WriteLine("WorkerThread: thread " + Thread.CurrentThread.ManagedThreadId);
        _name = name;
        _interval = interval * 1000;
        _job = new ThreadStart(LoadData);
        _thread = new Thread(_job);
        _thread.Start();
        //timer = new Timer(Tick, null, 1000, interval * 1000);
    }

    //this delegate instance does NOT run in the same thread as the thread that created the timer. It runs in its own
    //thread, taken from the ThreadPool. Hence, no need to create a new thread for the LoadData method.
    private void Tick(object state)
    {
        //LoadData();
    }

    //Loads the data. Called from separate thread. Lasts 0.5 seconds.
    //
    //private void LoadData(object state)
    private void LoadData()
    {
        while (true)
        {
            for (int i = 0; i < 10; i++)
            {
                Console.WriteLine(string.Format("Worker thread {0} ({2}): {1}", _name, i, Thread.CurrentThread.ManagedThreadId));
                Thread.Sleep(50);
            }
            Thread.Sleep(_interval);
        }
    }

    public void Stop()
    {
        Console.WriteLine("Stop: thread " + Thread.CurrentThread.ManagedThreadId);
        //timer.Dispose();
        _thread.Abort();
    }

    #region IDisposable Members

    public void Dispose()
    {
        Console.WriteLine("Dispose: thread " + Thread.CurrentThread.ManagedThreadId);
        //timer.Dispose();
        _thread.Abort();
    }

    #endregion
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-27T14:34:19.153

你有两个问题，都是分开的：

在 Watcher.Changed 的​​处理程序中，您调用 Thread.Sleep(3000); 这是您不拥有的线程的回调中的不良行为（因为它是由观察者拥有/使用的池提供的。但这不是问题的根源。这直接违反了[使用指南](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx)

你到处都使用静力学，这很可怕，很可能导致你陷入这个问题：

```
static void test()
{
    _eventsRaised += 1;
    //if it was more than a second since the last event (ie, it's a new save), then wait for 3 seconds (to avoid 
    //multiple events for the same file save) before processing
    if (DateTime.Now.Ticks - _lastEventTicks > 1000)
    {
        Thread.Sleep(3000);
        _lastEventTicks = DateTime.Now.Ticks;
        _eventsRespondedTo += 1;
        Console.WriteLine("File changed. Handled event {0} of {1}.", _eventsRespondedTo, _eventsRaised);
        //stop threads and then restart them
        thread1.Stop();
        thread2.Stop();
        thread1 = new WorkerThread("foo", 20);
        thread2 = new WorkerThread("bar", 30);
    }
} 
```

此回调可以在多个不同的线程上重复触发（它为此使用系统线程池）您的代码假定一次只有一个线程将执行此方法，因为可以创建线程但不能停止。

想象一下：线程 A 和 B

1.  线程1.Stop()
2.  一个thread2.Stop()
3.  B线程1.Stop()
4.  B thread2.Stop()
5.  线程 1 = 新的 WorkerThread()
6.  线程 2 = 新的 WorkerThread()
7.  B 线程 1 = 新的 WorkerThread()
8.  B 线程 2 = 新的 WorkerThread()

您现在在堆上有 4 个 WorkerThread 实例，但只有两个变量引用它们，由 A 创建的两个变量已经泄漏。定时器的事件处理和回调注册意味着这些泄漏的 WorkerThreads 保持活动状态（在 GC 意义上），尽管您在代码中没有引用它们。他们永远被泄露。

设计中还有其他缺陷，但这是一个关键缺陷。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-29T16:02:47.613

不，不，不，不，不，不，不，不。永远不要使用 Thread.Abort()。

阅读[MSDN 文档](http://msdn.microsoft.com/en-us/library/ty8d3wta.aspx)。

* * *

*不保证线程立即中止，或者根本不中止。如果线程在作为 abort 过程的一部分调用的 finally 块中执行无限量的计算，则可能会发生这种情况，从而无限期地延迟 abort。要等到线程中止，您可以在调用 Abort 方法后在线程上调用 Join 方法，但不能保证等待会结束。*

* * *

结束线程的正确方法是向它发出它应该结束的信号，然后在该线程上调用 Join()。我通常会做这样的事情（伪代码）：

```
public class ThreadUsingClass
{
    private object mSyncObject = new object();
    private bool mKilledThread = false;
    private Thread mThread = null;

    void Start()
    {
        // start mThread
    }

    void Stop()
    {
        lock(mSyncObject)
        {
            mKilledThread = true;
        }

        mThread.Join();
    }

    void ThreadProc()
    {
        while(true)
        {
            bool isKilled = false;
            lock(mSyncObject)
            {
                isKilled = mKilledThread;
            }
            if (isKilled)
                return;
        }
    }    
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-16T11:45:12.077

好吧，有一些时间再次调查这个问题，看来内存泄漏有点像红鲱鱼。*当我停止写入控制台时，内存使用量停止增加*。

但是，还有一个问题是每次我编辑 test.xml 文件（它会在 FileSystemWatcher 上触发 Changed 事件，其处理程序设置的标志会导致工作类被更新，因此线程/计时器被停止），内存增加了大约 4K，前提是我使用的是显式线程，而不是计时器。当我使用定时器时，没有问题。但是，鉴于我宁愿使用计时器而不是线程，这对我来说不再是问题，但我仍然会对它发生的原因感兴趣。

请参阅下面的新代码。我创建了两个类 - WorkerThread 和 WorkerTimer，其中一个使用线程，另一个使用定时器（我尝试了两个定时器，System.Threading.Timer 和 System.Timers.Timer。在打开控制台输出的情况下，你可以看到这与引发滴答事件的线程有关）。只需注释/取消注释 MainThread.Start 的相应行即可使用所需的类。由于上述原因，建议将 Console.WriteLine 行注释掉，除非您想检查一切是否按预期工作。

```
class Program
{
    static void Main(string[] args)
    {
        MainThread.Start();

    }
}

public class MainThread
{
    private static int _eventsRaised = 0;
    private static int _eventsRespondedTo = 0;
    private static bool _reload = false;
    private static readonly object _reloadLock = new object();
    //to do something once in handler, though
    //this code would go in onStart in a windows service.
    public static void Start()
    {
        WorkerThread thread1 = null;
        WorkerThread thread2 = null;
        //WorkerTimer thread1 = null;
        //WorkerTimer thread2 = null;

        //Console.WriteLine("Start: thread " + Thread.CurrentThread.ManagedThreadId);
        //watch config
        FileSystemWatcher watcher = new FileSystemWatcher();
        watcher.Path = "../../";
        watcher.Filter = "test.xml";
        watcher.EnableRaisingEvents = true;
        //subscribe to changed event. note that this event can be raised a number of times for each save of the file.
        watcher.Changed += (sender, args) => FileChanged(sender, args);

        thread1 = new WorkerThread("foo", 10);
        thread2 = new WorkerThread("bar", 15);
        //thread1 = new WorkerTimer("foo", 10);
        //thread2 = new WorkerTimer("bar", 15);

        while (true)
        {
            if (_reload)
            {
                //create our two threads.
                //Console.WriteLine("Start - reload: thread " + Thread.CurrentThread.ManagedThreadId);
                //wait, to enable other file changed events to pass
                //Console.WriteLine("Start - waiting: thread " + Thread.CurrentThread.ManagedThreadId);
                thread1.Dispose();
                thread2.Dispose();
                Thread.Sleep(3000); //each thread lasts 0.5 seconds, so 3 seconds should be plenty to wait for the 
                //LoadData function to complete.
                Monitor.Enter(_reloadLock);
                //GC.Collect();
                thread1 = new WorkerThread("foo", 5);
                thread2 = new WorkerThread("bar", 7);
                //thread1 = new WorkerTimer("foo", 5);
                //thread2 = new WorkerTimer("bar", 7);
                _reload = false;
                Monitor.Exit(_reloadLock);
            }
        }
    }

    //this event handler is called in a separate thread to Start()
    static void FileChanged(object source, FileSystemEventArgs e)
    {
        Monitor.Enter(_reloadLock);
        _eventsRaised += 1;
        //if it was more than a second since the last event (ie, it's a new save), then wait for 3 seconds (to avoid 
        //multiple events for the same file save) before processing
        if (!_reload)
        {
            //Console.WriteLine("FileChanged: thread " + Thread.CurrentThread.ManagedThreadId);
            _eventsRespondedTo += 1;
            //Console.WriteLine("FileChanged. Handled event {0} of {1}.", _eventsRespondedTo, _eventsRaised);
            //tell main thread to restart threads
            _reload = true;
        }
        Monitor.Exit(_reloadLock);
    }
}

public class WorkerTimer : IDisposable
{
    private System.Threading.Timer _timer;   //the timer exists in its own separate thread pool thread.
    //private System.Timers.Timer _timer;
    private string _name = string.Empty;

    /// <summary>
    /// Initializes a new instance of the <see cref="WorkerThread"/> class.
    /// </summary>
    /// <param name="name">The name.</param>
    /// <param name="interval">The interval, in seconds.</param>
    public WorkerTimer(string name, int interval)
    {
        _name = name;
        //Console.WriteLine("WorkerThread constructor: Called from thread " + Thread.CurrentThread.ManagedThreadId);
        //_timer = new System.Timers.Timer(interval * 1000);
        //_timer.Elapsed += (sender, args) => LoadData();
        //_timer.Start();
        _timer = new Timer(Tick, null, 1000, interval * 1000);
    }

    //this delegate instance does NOT run in the same thread as the thread that created the timer. It runs in its own
    //thread, taken from the ThreadPool. Hence, no need to create a new thread for the LoadData method.
    private void Tick(object state)
    {
        LoadData();
    }

    //Loads the data. Called from separate thread. Lasts 0.5 seconds.
    //
    private void LoadData()
    {
        for (int i = 0; i < 10; i++)
        {
            //Console.WriteLine(string.Format("Worker thread {0} ({2}): {1}", _name, i, Thread.CurrentThread.ManagedThreadId));
            Thread.Sleep(50);
        }
    }

    public void Stop()
    {
        //Console.WriteLine("Stop: called from thread " + Thread.CurrentThread.ManagedThreadId);
        //_timer.Stop();
        _timer.Change(Timeout.Infinite, Timeout.Infinite);
        //_timer = null;
        //_timer.Dispose();
    }

    #region IDisposable Members

    public void Dispose()
    {
        //Console.WriteLine("Dispose: called from thread " + Thread.CurrentThread.ManagedThreadId);
        //_timer.Stop();
        _timer.Change(Timeout.Infinite, Timeout.Infinite);
        //_timer = null;
        //_timer.Dispose();
    }

    #endregion
}

public class WorkerThread : IDisposable
{
    private string _name = string.Empty;
    private int _interval = 0;  //thread wait interval in ms.
    private Thread _thread = null;
    private ThreadStart _job = null;
    private object _syncObject = new object();
    private bool _killThread = false;

    public WorkerThread(string name, int interval)
    {
        _name = name;
        _interval = interval * 1000;
        _job = new ThreadStart(LoadData);
        _thread = new Thread(_job);
        //Console.WriteLine("WorkerThread constructor: thread " + _thread.ManagedThreadId + " created. Called from thread " + Thread.CurrentThread.ManagedThreadId);
        _thread.Start();
    }

    //Loads the data. Called from separate thread. Lasts 0.5 seconds.
    //
    //private void LoadData(object state)
    private void LoadData()
    {
        while (true)
        {
            //check to see if thread it to be stopped.
            bool isKilled = false;

            lock (_syncObject)
            {
                isKilled = _killThread;
            }

            if (isKilled)
                return;

            for (int i = 0; i < 10; i++)
            {
                //Console.WriteLine(string.Format("Worker thread {0} ({2}): {1}", _name, i, Thread.CurrentThread.ManagedThreadId));
                Thread.Sleep(50);
            }
            Thread.Sleep(_interval);
        }
    }

    public void Stop()
    {
        //Console.WriteLine("Stop: thread " + _thread.ManagedThreadId + " called from thread " + Thread.CurrentThread.ManagedThreadId);
        //_thread.Abort();
        lock (_syncObject)
        {
            _killThread = true;
        }
        _thread.Join();
    }

    #region IDisposable Members

    public void Dispose()
    {
        //Console.WriteLine("Dispose: thread " + _thread.ManagedThreadId + " called from thread " + Thread.CurrentThread.ManagedThreadId);
        //_thread.Abort();
        lock (_syncObject)
        {
            _killThread = true;
        }
        _thread.Join();
    }

    #endregion
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T13:05:23.000

好吧，您实际上从未调用`dispose`过 WorkerThread 实例。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T13:07:28.673

当监视的文件事件发生时，实际的工作线程不会被释放。我想我会重写它，这样就不会创建新线程，而是重新初始化它们。与其调用`Stop`和重新创建线程，不如调用一个新`Restart`方法来停止并重置计时器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T13:31:36.143

您永远不会终止线程 - 使用 Process Explorer 之类的东西来检查线程计数是否在增加以及内存。在您的 Stop() 方法中添加对 Abort() 的调用。

编辑：你做到了，谢谢。

# com - 是否可以将免注册 COM 与 HTA 应用程序一起使用？

> ID：483306
> 
> 赞同：4
> 
> 时间：2009-01-27T13:00:44.460
> 
> 标签：com, manifest, hta, regfreecom

由于 HTA 应用程序托管在 MSHTA.exe 中，如何提供清单？另外，我假设提供 MSHTA.exe.manifest 可能会破坏其他 HTA 应用程序？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-19T09:03:12.057

在 Vista+ 上，MSHTA.exe 有一个嵌入式清单，它优先于外部清单，因此您的建议不是一个选项。

在 XP/2003 上，是的，您的建议会起作用，尽管它的形式会很糟糕，就像在 System32 中删除文件以修改系统二进制文件的行为一样（特别是确保您在清单中放置的任何注册都是您的对象只有一个关心）。

在 Win2003 及更高版本上可用的正确解决方案是使用[Microsoft.Windows.ActCtx](http://msdn.microsoft.com/en-us/library/aa375644(VS.85).aspx)对象在给定显式清单引用的情况下实例化您的对象。

例如：

```
var actCtx = WScript.CreateObject("Microsoft.Windows.ActCtx");
actCtx.Manifest = "myregfree.manifest";
var obj =  actCtx.CreateObject("MyObj"); 
```

也许，如果这也必须在 XP 上工作，那么您可能采取的路径是两种解决方案的组合。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T21:19:48.793

**编辑：**我的答案是错误的，但我会把它留在这里以避免任何类似的错误答案:)

* * *

如果您的问题是您是否可以在不在机器上注册的情况下访问 COM 对象，那么我认为答案是暂定的。但是，您需要做的工作将是大量的，并且意味着实现大多数开发工具理所当然地为您提供的许多低级代码（Delphi、.NET、JAVA）。您需要直接与 dll 交互（就像您使用普通 dll 一样），查询其接口并调用您的方法。

如果您有 C、C++ 知识，那么从这些语言访问 COM 的方式会给您一些指导。

对不起，我不能再提供任何帮助了。

# html - 为什么我的 Aspx 页面在 FireFox 和 IE 中呈现不同的 HTML

> ID：483313
> 
> 赞同：1
> 
> 时间：2009-01-27T13:01:46.813
> 
> 标签：html, internet-explorer, firefox, asp.net-3.5, rendering

我遇到了一个问题，我的 asp.net 代码在 Firefox 和 IE 上呈现不同。当我说不同时，我的意思是，IE 中的链接按钮呈现为锚标记。然而，在 Firefox 上，它呈现为一个跨度

代码示例

```
<ItemTemplate>
   <div id="<%#Eval("Id","{0}") %>">
     <asp:LinkButton ID="ProductName" runat="server" CommandName="Listing" 
       CommandArgument='<%# Bind("Id") %>' Text='<%# Bind("Name") %>PostBackUrl=""></asp:LinkButton>
     <asp:Label ID="lbl_pricePerUnit" runat="server" Text="" />
   </div>
</ItemTemplate> 
```

其他一些控件虽然可见，但根本不呈现。[![替代文字](https://i.stack.imgur.com/Hoh9v.jpg)](https://i.stack.imgur.com/Hoh9v.jpg) [![替代文字](https://i.stack.imgur.com/0BrYc.jpg)](https://i.stack.imgur.com/0BrYc.jpg)

我不知道这里发生了什么，我以前从未见过这种情况。我正在使用最新版本的浏览器，并且我有 asp.net 3.5 和 VS2008

更新：好的，这是一个 AJAX 页面，gridview 位于更新面板内，该面板对 LinkBut​​ton 的 OnCommand 事件作出反应。该代码显然可以编译，并且在 IE 上运行良好。

我已经在 Firefox 上检查了页面源，它​​与图像相同。关于包含的 DIV 标签上缺少 ID 的观点很好。嵌入式脚本是否会导致 FireFox 出现问题？id 以数字开头呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T13:12:12.550

这肯定是由自适应渲染引起的，ASP.Net 发出为浏览器量身定制的 html？

[http://aspnetresources.com/blog/adaptive_rendering.aspx](http://aspnetresources.com/blog/adaptive_rendering.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T13:22:28.767

在您的代码示例中，asp:LinkBut​​ton 标记的格式不正确 - 缺少“<”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T13:52:29.987

您的模板似乎还有其他一些问题。

正如克里斯在评论中所说的“如果链接没有href？”

查看在 Firefox 中生成的 html，包含的 div 上也没有 ID - 而在 IE 中有。

请记住，使用 Firebug 在 Firefox 中查看源代码和实际查看源代码（右键单击|查看页面源代码）是两件不同的事情 - Firebug 将显示由浏览器解析和处理的源代码，以及任何添加JavaScript 或浏览器引擎已添加/更改 - 使用查看页面源将向您显示在任何处理发生之前从服务器返回的实际源 - 该代码是否正确/相同？

BrowserCaps 曾经在 1.x 世界中将各种控件弄得一团糟——但是它们已更新为使用 ASP.NET 2.0 支持 Firefox 等，因此它们不应该影响这里的东西。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T14:44:44.843

我很不好意思承认我犯了最心不在焉的错误

**Jay S**非常正确地指出，我应该确保我正在查看正确的代码实例。本地版本上的一些链接指向 Dev Server 上的 Dev 版本。它不是最新的，实际上在产品名称转换为链接之前运行的旧代码。

为浪费集体脑力而道歉，并感谢大家的回复。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T13:35:44.810

根据 Microsof 的 LinkBut​​ton“在网页上显示超链接样式的按钮控件。”。因此，我不希望自适应渲染将其从超链接更改为跨度。我从未见过这种行为。

如果这确实是正在发生的事情，那么您可能需要检查几个问题：

1.  页面发布后是否有任何 DHTML 或 JS 加载会更改 HTML？
2.  是否安装了任何程序集/服务器控件来覆盖链接按钮的默认行为？
3.  尝试使用绑定链接按钮进行空白独奏并尝试重现，然后通过向项目添加组件和控件来回溯以确定导致问题的原因。

不幸的是，您的代码和屏幕截图中没有足够的信息在这个阶段给您一个明确的答案。

# asp.net - 如何为 Web 统计模块处理大量数据

> ID：483319
> 
> 赞同：2
> 
> 时间：2009-01-27T13:04:55.777
> 
> 标签：asp.net, database-design, aggregate, olap

我正在为我的网站开发一个统计模块，它将帮助我衡量转化率和其他有趣的数据。

我使用的机制是 - 将数据库条目存储在统计表中 - 每次用户进入我的数据库中的特定区域时（我在 cookie 的帮助下避免重复记录）。

例如，我有以下区域：

1.  网站 - 一个用于统计唯一用户的通用区域，因为我最近不再信任 Google Analytics。
2.  类别 - 自我描述。
3.  Minisite - 自我描述。
4.  产品图片 - 每当用户看到产品和潜在客户提交表单时。

问题是一个月后，我的统计表挤满**了很多**行，而我为解析数据而编写的 ASP.NET 页面加载速度**真的很**慢。

我想也许可以编写一个以某种方式解析数据的服务，但我看不出有任何方法可以做到这一点而不会失去灵活性。

我的问题：

1.  大规模数据解析应用程序（如 Google Analytics）如何快速加载数据？
2.  对我来说最好的方法是什么？
3.  也许我的数据库设计是错误的，我应该只将数据存储在一张表中？

感谢任何帮助的人，

伊坦。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T13:23:14.883

您正在寻找的基本方法称为**聚合**。

您对根据您的数据计算的某些函数感兴趣，而不是在启动显示网站时“在线”计算数据，而是在夜间通过批处理或在写入日志记录时增量计算它们。

一个简单的增强是存储每个用户/会话的计数，而不是存储每个命中并计算它们。这会将您的分析处理要求降低一个因素，以每个会话的命中顺序为准。当然，在插入日志条目时会增加处理成本。

另一种聚合称为[在线分析处理](http://en.wikipedia.org/wiki/Online_analytical_processing)，它只聚合数据的某些维度，让用户以浏览模式聚合其他维度。这权衡了性能、存储和灵活性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-28T06:21:55.763

使用两个数据库似乎可以做得很好。一种是用于事务数据，它处理所有的 INSERT 语句。另一个用于报告并处理您的所有查询请求。

您可以从报告数据库中索引鼻涕，和/或对数据进行非规范化，以便在查询中使用更少的连接。定期将数据从交易数据库导出到报告数据库。该法案将连同前面提到的聚合想法一起改善报告响应时间。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T19:43:10.653

另一个要知道的技巧是*分区*。在您选择的数据库中查看这是如何完成的 - 但基本上这个想法是您告诉您的数据库将一个表划分为几个子表，每个子表都有一个相同的定义，基于某个值。

在您的情况下，*非常*有用的是“范围分区” - 根据值所在的范围选择分区。如果您按日期范围进行分区，您可以为每周（或每天或每月 - 取决于您如何使用数据以及数据量）创建单独的子表。

这意味着，如果您在发出查询时指定了日期范围，则甚至不会考虑超出该范围的数据；这可以节省大量时间，甚至比索引更好（索引必须考虑每一行，因此它会随着您的数据而增长；一个分区是每天一个）。

这使得在线查询（当您点击 ASP 页面时发出的查询）和用于预先计算必要统计信息的聚合查询都快得多。

# sql-server - 存储与数据库无关的模式

> ID：483331
> 
> 赞同：5
> 
> 时间：2009-01-27T13:08:22.807
> 
> 标签：sql-server, database, ms-access, schema, xsd

我们有一组应用程序可以与包括 Sql Server 和 Access 在内的多个数据库引擎一起工作。每个模式都是单独维护的，不以文本形式存储，使得源代码控制变得困难。我们有兴趣转移到架构以某种基于文本的格式（例如 XML 或 YAML）存储的系统，其中包含字段数据类型、外键关系等的描述。

总而言之，我们希望在源代码控制中拥有一个单独的文本文件，该文件可用于生成一个干净的数据库，该数据库至少可以与 SQL Server、Access 一起使用（最好能够与 Oracle、DB2 和其他引擎）。

我敢肯定，有一些工具或库可以让我们至少部分实现目标。一方面，我发现[Altova MapForce](http://www.altova.com/products/mapforce/data_mapping.html)看起来可以解决问题，但我有兴趣了解任何替代工具或库，甚至是针对处于相同困境中的人的完全不同的解决方案。

注意：应用程序是用 C++ 编写的，而 ORM 解决方案在 C++ 中都不容易获得，并且需要很长时间才能集成到我们老化的产品中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T13:15:59.077

如果您不使用执行此操作的[对象关系映射器](http://en.wikipedia.org/wiki/Object-relational_mapping)（以及为您执行许多其他操作），最简单的方法可能是创建一些结构以某种形式的（静态）代码定义您的表和属性并编写小生成器从该描述创建实际的数据库。

这使得源代码控制变得容易，如果您在设计这些结构时很小心，如果需要，您可以轻松地将它们重新用于其他数据库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T13:49:51.427

当我问[一个类似（如果更天真）的问题](https://stackoverflow.com/questions/347155/external-library-or-mini-language-for-reading-database-schema)时，共识似乎是使用原始 SQL，并使用附加层来管理 RDMS 依赖项。祝你好运。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-12-13T23:03:14.547

您正在寻找的工具是[liquibase](http://www.liquibase.org/)。虽然不支持 Access...

# c# - 如何从程序集中只公开一个特定的类？

> ID：483333
> 
> 赞同：1
> 
> 时间：2009-01-27T13:08:26.660
> 
> 标签：c#, oop, assemblies

假设程序集 Assembly1.dll 包含 3 个类：C1 类、C2 类、C3 类。

我只想将 C1 类暴露给外界。C2 和 C3 类将无法访问。如何实现这一目标？

注意：将 C2 和 C3 类设为私有不是一种选择，因为这会使它们在程序集本身内部无法访问。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-27T13:09:47.873

将 C2 和 C3 类设为内部，如下所示：

```
internal class C2
{
//...
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-27T13:15:43.120

正如其他人所说，您使用`internal`可见性。不过还有几点：

*   对于非嵌套类型，internal 实际上是 C# 中的默认值，因此您不必*指定*它。您是否明确指定默认访问权限是个人喜好问题。（我目前处于观望状态，倾向于明确。）

*   首先，只有嵌套类型可以是私有的——同样，这是嵌套类型的默认可见性。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-27T13:10:13.910

“internal”关键字指定类只能在其自己的程序集中访问。也许你应该用这个标记 C2 和 C3。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T13:12:31.177

使用[internal](http://msdn.microsoft.com/en-us/library/7c5ka91b.aspx)关键字。

还有一些链接。

[可访问性级别（C# 参考）](http://msdn.microsoft.com/en-us/library/ba0a1yw2.aspx)
[访问修饰符（C# 编程指南）](http://msdn.microsoft.com/en-us/library/ms173121.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-27T13:13:30.300

您可以使用“内部”访问器而不是“私有”访问器，因此您的类可见性将仅限于程序集级别而不是外部。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-27T20:21:35.100

`internal`是要走的路。如果你想从不同的程序集中测试你的类 C2 和 C3，你可以通过在你的程序集中设置[InternalsVisibleTo](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.internalsvisibletoattribute.aspx)属性来做到这一点。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-09-30T20:16:56.573

如果您不想将类公开给程序集之外的 COM 和 .NET，则 internal 关键字可以正常工作。

但是，如果您想更好地控制向 COM 公开的内容，方法是让您的类公开，取消选中项目属性中的“使程序集 COM 可见”（这会更改 AssemblyInfo.cs），然后添加一个属性到你想暴露给 COM 的类。像这样的东西：

```
[Guid("12338758-70B4-40B7-75FA-50300015DAC9")]
[ClassInterface(ClassInterfaceType.AutoDual)]
[ComVisible(true)]
public class MyClassToExpose 
```

# c++ - C++：string.empty() 是否总是等价于 string == ""？

> ID：483337
> 
> 赞同：51
> 
> 时间：2009-01-27T13:10:26.187
> 
> 标签：c++, string

我可以假设给定

```
std::string str;
... // do something to str 
```

以下陈述总是正确的吗？

```
(str.empty() == (str == "")) 
```

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-01-27T13:17:27.267

### 回答

是的。这是来自的相关实现`bits/basic_string.h`，代码`basic_string<_CharT, _Traits, _Alloc>`：

```
 /**
   *  Returns true if the %string is empty.  Equivalent to *this == "".
   */
  bool
  empty() const
  { return this->size() == 0; } 
```

### 讨论

尽管这两种形式对于 是等价的`std::string`，但您*可能*希望使用它，`.empty()`因为它更通用。

事实上，[JF Sebastian](https://stackoverflow.com/users/4279/j-f-sebastian)评论说，如果您切换到 using`std::wstring`而不是`std::string`，则`==""`甚至不会编译，因为您无法将字符串 of`wchar_t`与 of 中的一个进行比较`char`。但是，这与您最初的问题没有直接关系，我 99% 确信您不会切换到`std::wstring`.

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-27T14:10:02.930

它应该是。ANSI/ISO 标准在[21.3.3`basic_string`容量](http://www.open-std.org/jtc1/sc22/wg21/docs/wp/html/oct97/lib-strings.html#lib.string.capacity)中规定：

> `size_type size() const;`
> 
> **返回：**当前在字符串中的类似字符的对象的计数。
> 
> `bool empty() const;`
> 
> **回报：** `size() == 0`

但是，在[21.3.1`basic_string`构造函数](http://www.open-std.org/jtc1/sc22/wg21/docs/wp/html/oct97/lib-strings.html#lib.string.cons)的第 18 节中，它声明字符类型赋值运算符用于`traits::length()`确定受控序列的长度，因此如果您使用不同的`std::basic_string<>`.

我认为 100% 正确的说法是

```
(str.empty() == (str == std::string())) 
```

或类似的东西。如果你没有做任何奇怪的事情，那么`std::string("")`和`std::string()`应该是等价的

它们在逻辑上相似，但它们正在测试不同的东西。`str.empty()`正在检查字符串是否为空，而另一个正在检查 C 样式的空字符串是否相等。我会使用更适合您尝试做的事情。如果您想知道字符串是否为空，请使用`str.empty()`.

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-27T13:54:55.130

str.empty() 永远不会慢，但可能比 str == "" 快。这取决于实施。所以你应该使用 str.empty() 以防万一。

这有点像使用 ++i 而不是 i++ 来增加计数器（假设您不需要递增运算符本身的结果）。您的编译器可能会优化，但使用 ++i 不会损失任何东西，并且可能会有所收获，因此最好使用 ++i。

除了性能问题，您的问题的答案是肯定的；这两个表达式在逻辑上是等价的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-27T21:29:47.957

是`(str.empty() == (str == ""))`始终* 为真`std::string`。但请记住，a`string`可以包含`'\0'`字符。因此，即使表达式`s == ""`可能为假，`s.c_str()`仍可能返回一个空的 C 字符串。例如：

```
#include <string>
#include <iostream>
using namespace std;

void test( const string & s ) {
    bool bempty = s.empty();
    bool beq = std::operator==(s, ""); // avoid global namespace operator==
    const char * res = (bempty == beq ) ? "PASS" : "FAIL";
    const char * isempty = bempty ? "    empty " : "NOT empty ";
    const char * iseq = beq ? "    == \"\"" : "NOT == \"\"";
    cout << res << " size=" << s.size();
    cout << " c_str=\"" << s.c_str() << "\" ";
    cout << isempty << iseq << endl;
}

int main() {
    string s;          test(s); // PASS size=0 c_str=""     empty     == ""
    s.push_back('\0'); test(s); // PASS size=1 c_str="" NOT empty NOT == ""
    s.push_back('x');  test(s); // PASS size=2 c_str="" NOT empty NOT == ""
    s.push_back('\0'); test(s); // PASS size=3 c_str="" NOT empty NOT == ""
    s.push_back('y');  test(s); // PASS size=4 c_str="" NOT empty NOT == ""
    return 0;
} 
```

`operator==`**正如其他人所提到的，除非全局命名空间中的重载*

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-27T13:25:19.403

一些实现可能会测试空字符作为字符串中的第一个字符，从而导致计算字符串大小的速度略有增加。

然而，我相信这并不常见。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-27T13:32:46.143

通常，是的。

但是如果有人决定重新定义一个运算符，那么所有的赌注都没有了：

```
bool operator == (const std::string& a, const char b[])
{
    return a != b; // paging www.thedailywtf.com
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-27T13:20:57.680

是的，它是等效的，但允许核心代码根据操作系统/硬件/任何东西更改 empty() 实际含义的实现，并且根本不会影响您的代码。Java和.NET有类似的做法

# c# - 正则表达式匹配 2 个括号内的子字符串，例如 [我想要此文本] 但省略括号？

> ID：483341
> 
> 赞同：2
> 
> 时间：2009-01-27T13:11:40.273
> 
> 标签：c#, .net, regex

我已经设法找到正则表达式来获得几乎我想要的结果，即

```
Regex r1 = new Regex(@"\[(.*?)\]");
string row = HEADERNAMES[COL1,COL2,COL3,COL4];
Match match = r1.Match(row);
string result = match.ToString(); 
```

输出：“[COL1,COL2,COL3,COL4]”；

我知道我可以使用：

```
result.Replace("[", "");
result.Replace("]", ""); 
```

得到我想要的东西，但我想知道是否有办法在不执行字符串方法的情况下从正则表达式结果中省略分隔符 [ 和 ]。

我会认为使用 Regex 本身有一个更优雅的解决方案？

提前致谢。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-27T13:17:44.520

```
Regex r1 = new Regex(@"\[(.+)\]");
string row = "HEADERNAMES[COL1, COL2, COL3, COL4]";
// Regex puts capture groups (i.e. things captured between ( and ) ) 
// in Groups collection
string match = r1.Match(row).Groups[1].Value;
//match = "COL1, COL2, COL3, COL4" 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T13:40:14.800

在“Aku”提出的解决方案中有一个要点需要观察（我还没有代表发表评论）

您应该注意到 Groups 集合中的第二项提供了您需要的值。第一项（Groups(0)）等价于整个匹配字符串（Match.ToString() 或 Match.Value）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T14:24:11.950

另一种方法是这样的，虽然我认为它比 aku 的例子慢一点：

```
 Regex r1 = new Regex(@"(?<=\[).*(?=\])");
        string row = "HEADERNAMES[COL1, COL2, COL3, COL4]";
        Match match = r1.Match(row);
        Console.WriteLine(match.ToString());

        /* Output:
        COL1, COL2, COL3, COL4
        */ 
```

我不知道，但我怀疑您可能在列名之后并且即将对结果字符串执行 .Split。您是否知道可以使用这样的单个正则表达式单独获取所有列名？

```
 Regex r1 = new Regex(@"\[(?:(?<colName>[^,\]]*)(?:,\s)?)*\]");
        string row = "HEADERNAMES[COL1, COL2, COL3, COL4]";
        Match match = r1.Match(row);

        foreach(Capture c in match.Groups["colName"].Captures)
            Console.WriteLine(c.ToString());

        /* Output:
        COL1
        COL2
        COL3
        COL4
        */ 
```

# sql - 在实时环境中有效地将数据从一个 SQL 数据库转换到另一个

> ID：483347
> 
> 赞同：0
> 
> 时间：2009-01-27T13:12:52.703
> 
> 标签：sql, sql-server-2005, visual-foxpro, foxpro

我们有一些混乱的数据库情况。

我们的主要后台系统是用 Visual Fox Pro 编写的，带有本地数据（是的，我知道！）

为了有效地处理我们网站中的数据，我们选择定期将数据导出到 SQL 数据库。但是，执行此操作的过程基本上每次都会清除表并重新插入。

这意味着我们有两个 SQL 数据库——一个是 FoxPro 导出过程写入的，另一个是我们的网站读取的。

这个问题与从一个 SQL 数据库到另一个（SqlFoxProData -> SqlWebData）的转换有关。

对于一个特定的表（我们的主要应用程序表之一），因为在这个过程中会发生各种数据转换，所以它不是使用自连接的简单的 UPDATE、INSERT 和 DELETE 语句，而是我们不得不使用游标代替（我知道！）

这已经运行了好几个月，但现在我们开始在更新时遇到性能问题（这可能在白天经常发生）

基本上，当我们从 SqlFoxProData.ImportantTable 更新 SqlWebData.ImportantTable 时，它​​会导致实时网站上偶尔出现连接超时/死锁/其他问题。

我一直在努力优化查询、缓存等，但现在我正在寻找另一种更新数据的策略。

想到的一个想法是拥有两份重要表（A 和 B），一些关于哪个表当前“活动”的概念，更新非活动表，然后切换当前活动表

即当我们更新ImportantTableB 时网站从ImportantTableA 读取，然后我们切换网站以从ImportantTableB 读取。

问题是，这是可行的还是个好主意？我以前做过类似的事情，但我不相信它一定对优化/索引等有好处。

欢迎任何建议，我知道这是一个混乱的情况......长期目标是让我们的 FoxPro 应用程序指向 SQL。

（如果有帮助，我们将使用 SQL 2005）

我应该补充一点，数据一致性在实例中并不是特别重要，因为数据总是有点过时

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T14:50:29.637

有很多方法可以给这只猫剥皮。

我将首先解决锁定问题。我很少使用 CURSORS，我认为提高性能和锁定行为可能会解决你的很多问题。

我希望我会通过使用两个单独的临时表来解决它。一种用于 SQL 中的 FoxPro 导出，另一种用于并行转换为 SQL 中的最终格式。然后使用 sp_rename 将最终表交换为生产，或者仅使用 3 个 INSERT/UPDATE/DELETE 事务将最终表中的所有更改应用于生产。无论哪种方式，那里都会有一些锁定，但我们在谈论多大？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T13:39:25.863

您应该能够为网站维护一个数据库，然后从另一个 sql 数据库表复制到该表。

这是假设您不更新网站本身的任何数据。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T16:15:17.983

“对于一个特定的表（我们的主要应用程序表之一），由于在此过程中会发生各种数据转换，这不是使用自连接的简单的 UPDATE、INSERT 和 DELETE 语句，而是我们不得不使用游标（我知道！）”

我想不出我需要使用游标执行插入、更新或删除的情况。如果可以为游标编写选择，就可以将其转换为插入、更新或删除。您可以在这些语句中加入其他表，并使用 case 语句进行条件处理。花时间以基于集合的方式执行此操作可能会解决您的问题。

如果您有大量数据要移动，您可能会考虑一件事。我们偶尔会为我们想要的数据创建一个视图，然后有两个表 - 一个是活动的，另一个是数据将被加载到的表。当数据完成加载时，作为流程的一部分，运行一个简单的命令来将视图使用的表切换到刚刚完成加载的表。这样，用户最多只能停机几秒钟。您不会在他们试图在您加载时访问数据的情况下创建锁定问题。

您还可以考虑使用 SSIS 移动数据。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T13:49:52.440

您是否可以选择使更新更具原子性，而不是声明的“清除并重新插入”？我认为 Visual Fox Pro 支持触发器，对吗？对于您的关键表，您是否可以向更新/插入/删除添加触发器以捕获更改记录的 ID，然后仅移动（或删除）这些记录？

或者如何将所有更改写入脱机数据库，并让 SQL Server 复制负责同步？

*[对不起，如果我有足够的声誉，这将是一个评论！]*

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T14:57:11.587

根据您在上面对 Ernie 的回复，您询问了如何复制数据库。这是[Microsoft 关于 SQL2005 中复制的操作指南。](http://technet.microsoft.com/en-us/library/ms151198.aspx)

但是，如果您询问复制以及如何进行复制，这表明您对 SQL Server 的经验有些浅薄。话虽这么说，把事情搞砸是相当容易的，虽然我完全是为了从经验中学习，但如果这是关键任务数据，你可能最好聘请 DBA 或至少测试#$@#$ % 在你实际实施它之前。

# java - 查找句子边界的 Java 库

> ID：483348
> 
> 赞同：7
> 
> 时间：2009-01-27T13:13:29.113
> 
> 标签：java, string, nlp, text-segmentation

有谁知道处理查找句子边界的 Java 库？我认为这将是一个智能 StringTokenizer 实现，它知道语言可以使用的所有句子终止符。

这是我使用 BreakIterator 的经验：

[在这里](http://java.sun.com/docs/books/tutorial/i18n/text/examples/BreakIteratorDemo.java)使用示例：我有以下日语：

```
今日はパソコンを買った。高性能のマックは早い！とても快適です。 
```

在 ascii 中，它看起来像这样：

```
\ufeff\u4eca\u65e5\u306f\u30d1\u30bd\u30b3\u30f3\u3092\u8cb7\u3063\u305f\u3002\u9ad8\u6027\u80fd\u306e\u30de\u30c3\u30af\u306f\u65e9\u3044\uff01\u3068\u3066\u3082\u5feb\u9069\u3067\u3059\u3002 
```

这是我更改的示例的一部分： static void sentenceExamples() {

```
 Locale currentLocale = new Locale ("ja","JP");
  BreakIterator sentenceIterator = 
     BreakIterator.getSentenceInstance(currentLocale);
  String someText = "今日はパソコンを買った。高性能のマックは早い！とても快適です。"; 
```

当我查看边界索引时，我看到了：

```
0|13|24|32 
```

但是这些索引不对应于任何句子终止符。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T13:16:18.327

您想查看国际化的 BreakIterator 类。[句子边界](http://java.sun.com/docs/books/tutorial/i18n/text/sentence.html)的一个很好的起点。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-27T16:13:23.137

你写了：

> 我认为这将是一个智能 StringTokenizer 实现，它知道语言可以使用的所有句子终止符。

这里的一个基本问题是句子终止符取决于上下文，请考虑：

> 琼斯博士是如何计算 5 的！没有递归？

这应该被识别为一个句子，但是如果您只是拆分可能的句子终止符，您将得到三个句子。

所以这是一个比人们一开始想象的更复杂的问题。可以使用机器学习技术来处理它。例如，您可以查看[OpenNLP](http://opennlp.sourceforge.net/)项目，特别是[SentenceDetectorME](http://opennlp.sourceforge.net/api/opennlp/tools/sentdetect/SentenceDetectorME.html)类。

# asp.net - 使用面板或占位符

> ID：483352
> 
> 赞同：155
> 
> 时间：2009-01-27T13:14:09.190
> 
> 标签：asp.net, panel, placeholder

`<asp:Panel >`和`<asp:PlaceHolder >`ASP.NET有什么区别？

什么时候应该使用其中一种？

* * *

## 回答 #1

> 赞同：162
> 
> 时间：2009-01-27T13:15:36.800

面板扩展为跨度（或 div），其中包含内容。占位符就是这样，一个占位符，它被您放入其中的任何内容所取代。

* * *

## 回答 #2

> 赞同：63
> 
> 时间：2009-01-27T13:17:21.337

占位符不会为自己呈现任何标签，因此非常适合对内容进行分组，而不会产生外部 HTML 标签的开销。

Panel 确实有外部 HTML 标签，但也有一些很酷的额外属性。

*   BackImageUrl：获取/设置面板的背景图像的 URL

*   Horizo​​ntalAlign：获取/设置
    父内容的水平对齐方式

*   Wrap：获取/设置
    面板的内容是否换行

startvbnet[这里](http://www.startvbdotnet.com/aspsite/controls/panel.aspx)有一篇很好的文章。

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2009-01-27T13:22:31.857

## [占位符控件](http://msdn2.microsoft.com/en-us/library/system.web.ui.webcontrols.placeholder.aspx)

使用 PlaceHolder 控件作为容器来存储动态添加到网页的服务器控件。PlaceHolder 控件不产生任何可见的输出，仅用作网页上其他控件的容器。您可以使用该`Control.Controls`集合在 PlaceHolder 控件中添加、插入或删除控件。

## [面板控制](http://msdn2.microsoft.com/en-us/library/system.web.ui.webcontrols.panel.aspx)

**Panel 控件是其他控件的**容器。当您想要以编程方式生成控件、隐藏/显示一组控件或本地化一组控件时，它特别有用。

该`Direction`属性可用于本地化 Panel 控件的内容以显示从右到左书写的语言的文本，例如阿拉伯语或希伯来语。

Panel 控件提供了几个属性，允许您自定义其内容的行为和显示。使用`BackImageUr`l 属性显示 Panel 控件的自定义图像。使用该`ScrollBars`属性为控件指定滚动条。

呈现 HTML 时的细微差别：PlaceHolder 控件将不呈现任何内容，但 Panel 控件将呈现为`<div>`.

更多信息，请访问[ASP.NET 论坛](http://forums.asp.net/p/1162201/1929627.aspx#1929627)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-10-13T15:21:54.463

我在 Visual Studio 2010 中出现了奇怪的错误*，如果您将控件放在占位符内，它不会在设计视图模式下呈现它们。

对于隐藏字段和空标签尤其如此。

我很想使用占位符而不是面板，但我讨厌在 GUI 的设计时不能将其他控件放在占位符中的事实。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2017-10-19T18:52:43.123

正如其他答案中提到的，Panel 会生成`<div>`HTML，而 PlaceHolder 不会。但是，您可以选择其中任何一个的原因还有很多。

**为什么是占位符？**

由于它不会生成自己的标签，因此您可以在其他不能包含 a 的元素中安全地使用它`<div>`，例如：

```
<table>
    <tr>
        <td>Row 1</td>
    </tr>
    <asp:PlaceHolder ID="PlaceHolder1" runat="server"></asp:PlaceHolder>
</table> 
```

您还可以使用 PlaceHolder 来控制一组控件的可见性，而无需将其包装在`<div>`

```
<asp:PlaceHolder ID="PlaceHolder1" runat="server" Visible="false">
    <asp:Label ID="Label1" runat="server" Text="Label"></asp:Label>
    <br />
    <asp:TextBox ID="TextBox1" runat="server"></asp:TextBox>
</asp:PlaceHolder> 
```

**为什么是面板**

它生成它自己的`<div>`，也可以用来包装一组 Contols。但是 Panel 有更多的属性可以用来格式化它的内容：

```
<asp:Panel ID="Panel1" runat="server" Font-Bold="true"
    BackColor="Green" ForeColor="Red" Width="200"
    Height="200" BorderColor="Black" BorderStyle="Dotted">
    Red text on a green background with a black dotted border.
</asp:Panel> 
```

但最有用的功能是`DefaultButton`属性。`enter`当 ID 与 Panel 中的 Button 匹配时，它会在 TextBox 内按下时触发带有验证的 Form Post 。现在用户可以在不按按钮的情况下提交表单。

```
<asp:Panel ID="Panel1" runat="server" DefaultButton="Button1">
    <asp:TextBox ID="TextBox1" runat="server"></asp:TextBox>
    <br />
    <asp:RequiredFieldValidator ID="RequiredFieldValidator1" runat="server"
        ErrorMessage="Input is required" ValidationGroup="myValGroup"
        Display="Dynamic" ControlToValidate="TextBox1"></asp:RequiredFieldValidator>
    <br />
    <asp:Button ID="Button1" runat="server" Text="Button" ValidationGroup="myValGroup" />
</asp:Panel> 
```

按`enter`里面试试上面的代码片段`TextBox1`

# excel - Excel 专家：需要一个好的解决方案来将一些数据填充到复杂的 Excel 工作表中

> ID：483358
> 
> 赞同：0
> 
> 时间：2009-01-27T13:16:22.040
> 
> 标签：excel, oledb

我遇到了一个问题

要求是，有一个复杂的 Excel 文件（XLS）用作模板；它有宏并且所有工作表都被锁定或隐藏。当用户点击下载时，发生如下操作

*   解锁特定工作表，在某些单元格处填写一些数据，然后将其锁定。
*   取消隐藏工作表，在某些单元格处填写一些数据，然后将其隐藏。

我认为有两种选择可以解决它（如果有更多请告诉我）

1.  互操作库/Excel 对象库

2.  OLEDb 驱动程序

我无法使用选项 1，因为 web 服务器上没有安装 excel，而且我听说安装 MSOffice @ webserver 不是一个好的选择。

我的问题是我们可以使用 OLDb 来执行上述操作还是有其他选择？？？顺便说一句，Sharepoint 服务也不可用:(

请帮忙！！！！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T05:30:59.170

你可以试试 ExcelPackge。
请参阅本文：
[使用 .NET 3.0 和 Office Open XML 在服务器端创建 Excel 2007 文件](http://www.15seconds.com/issue/070111.htm)

另请参阅： [办公空间 - 构建 Office Open XML 文件](http://msdn.microsoft.com/en-us/magazine/cc163478.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T17:39:06.207

[SpreadsheetGear for .NET](http://www.spreadsheetgear.com/)将处理此问题，并具有与 Excel 非常相似的 API。您可以[在此处](https://www.spreadsheetgear.com/downloads/register.aspx)[查看我们的客户所说](http://www.spreadsheetgear.com/products/spreadsheetgear.net.aspx)的并下载免费的、功能齐全的评估版。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T13:22:46.757

查看我前段时间提出的[这个问题，了解选项的概述。](https://stackoverflow.com/questions/439580/best-way-to-programmatically-modify-excel-spreadsheets)我最终选择了 Aspose 库，我在原始帖子中链接到了该库。它并不便宜，但它的工作非常简单和优雅。它甚至内置了模板功能（称为 SmartMarkers，IIRC）。

# garbage-collection - 垃圾收集瓶颈的例子

> ID：483359
> 
> 赞同：2
> 
> 时间：2009-01-27T13:16:55.050
> 
> 标签：garbage-collection

我记得有人告诉我一个很好的。但我不记得了。我在谷歌上花了最后 20 分钟试图了解更多信息。

有哪些因垃圾收集而导致性能下降的坏/不好的代码示例？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T13:46:09.237

来自一个古老的[sun 技术提示](http://java.sun.com/developer/TechTips/1997/tt0903.html#tip2)——有时它有助于显式地取消引用，以使它们更早地符合垃圾收集的条件：

```
public class Stack {
  private static final int MAXLEN = 10;
  private Object stk[] = new Object[MAXLEN];
  private int stkp = -1;

  public void push(Object p) {stk[++stkp] = p;}

  public Object pop() {return stk[stkp--];}
} 
```

以这种方式重写 pop 方法有助于确保及时完成垃圾收集：

```
public Object pop() {
  Object p = stk[stkp];
  stk[stkp--] = null;
  return p;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-06-21T14:30:14.760

> 有哪些因垃圾收集而导致性能下降的坏/不好的代码示例？

使用分代垃圾收集器时，以下将是低效的：

1.  改变堆中的引用，因为写屏障比指针写要昂贵得多。考虑将堆分配和引用分别替换为值类型数组和数组中的整数索引。

2.  创造长寿的临时工。当它们在托儿所一代中存活下来时，它们必须被标记、复制并更新所有指向它们的指针。如果可以合并更新以重用集合的旧版本，请这样做。

3.  复杂的堆拓扑。同样，考虑用索引替换许多引用。

4.  深线程堆栈。尽量保持堆栈较浅，以使 GC 更容易整理全局根。

但是，我不会称这些为“坏”，因为它们在客观上没有任何问题。它们仅在与这种垃圾收集器一起使用时效率低下。使用手动内存管理，不会出现任何问题（尽管许多问题已被等效问题所取代，例如`malloc`vs 池分配器的性能）。对于其他类型的 GC，这些问题中的一些会消失，例如，一些 GC 没有写屏障，标记区域 GC 应该更好地处理长寿命的临时对象，并不是所有的 VM 都需要线程堆栈。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T13:35:00.473

当您有一些涉及创建新对象实例的循环时：如果循环数非常高，您会产生大量垃圾，导致垃圾收集器更频繁地运行，从而降低性能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T13:21:30.407

一个示例是保存在成员变量或静态变量中的对象引用。这是一个例子：

```
class Something {
  static HugeInstance instance = new HugeInstance();
} 
```

问题是垃圾收集器无法知道何时不再需要此实例。因此，通常最好将事物保存在局部变量中并具有小功能。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T13:45:53.667

```
String foo = new String("a" + "b" + "c"); 
```

我知道 Java 现在在这方面做得更好，但在早期这将涉及 3 或 4 个字符串对象的创建和销毁。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T13:50:43.097

我可以举一个适用于 .Net CLR GC 的示例：

如果你从一个类中重写了一个 finalize 方法并且不调用超类的 Finalize 方法，例如

```
 protected override void Finalize(){
    Console.WriteLine("Im done");
    //base.Finalize(); => you should call him!!!!!
} 
```

当你不小心复活了一个物体

```
 protected override void Finalize(){
    Application.ObjJolder = this;
}

class Application{
    static public object ObjHolder;
} 
```

当你使用一个使用 Finalize 的对象时，它需要两个 GC 集合来删除数据，并且在上述任何代码中你都不会删除它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-27T14:05:28.307

*   频繁的内存分配
*   缺乏内存重用（处理大内存块时）
*   保持对象比需要的时间长（保持对过时对象的引用）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-27T14:37:41.033

在大多数现代收集器中，任何使用终结都会减慢收集器的速度。并且不仅仅针对具有终结器的对象。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-27T15:43:49.543

您的自定义服务上没有负载限制器，因此：

*   出于某种原因，很多请求同时进入（每个人早上都登录说）
*   该服务需要更长的时间来处理每个请求，因为它现在有 100 个线程（每个请求 1 个）
*   然而，由于处理时间较长，会增加更多的部分处理请求。
*   处理请求的每个部分都创建了许多对象，这些对象一直存在到处理该请求结束。
*   垃圾收集器花费大量时间尝试释放内存，但由于上述原因，它不能。
*   然而，由于处理时间更长，更多的部分处理请求会增加……。（包括 GC 中的时间）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-09-22T09:03:06.810

我在 Python 中做一些基于并行单元的模拟时遇到了一个很好的例子。单元格在酸洗后被初始化并发送到工作进程以运行。如果您在任何时候有太多的单元格，主节点就会耗尽内存。诀窍是先将有限数量的单元打包并将它们发送到集群节点，然后再制作更多，记住将已发送的对象设置为“无”。除了计算能力之外，这允许您使用集群的总 RAM 执行大型模拟。

这里的应用是基于单元格的火灾模拟，只有活跃燃烧的单元格在任何时候都被保存为对象。

# wpf - 从 WinForms 应用程序打印的最佳实践是什么？

> ID：483365
> 
> 赞同：1
> 
> 时间：2009-01-27T13:20:04.937
> 
> 标签：wpf, winforms, printing

我正在寻找有关从 WinForms 应用程序打印的最佳实践。

*   有哪些陷阱？
*   哪些布局技术有效？
*   使用 WPF 进行打印会更容易（[MSDN WPF 打印概述](http://msdn.microsoft.com/en-us/library/ms742418.aspx)）吗？

在我的特殊情况下，我有一个需要扩展打印功能的现有 WinForms 应用程序。程序不应该只在屏幕上打印内容，而是将表单中的一些数据放入模板中并打印出来。

谢谢，埃吉尔。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T13:38:20.873

.NET 中有两种主要的打印方法。原始打印 api 涉及可重复地对方法进行回调，并且您正确设置参数 (HasMorePages) 以指示是否有更多页面要打印。使用这个 API 几乎是全有或全无。

第二个涉及 WPF 的使用，与以前的 API 不同。它们具有不同级别的复杂性，从在 WPF 表单的元素上使用 printvisual 方法到在常规打印 API 中的控制级别。

第三种选择，特别是对于 WinForms，是使用 VB Power Pack 3.0 中的打印机兼容性库，[它](http://www.microsoft.com/downloads/details.aspx?familyid=371368a8-7fdc-441f-8e7d-fe78d96d4063&displaylang=en)恢复了 Visual Basic 旧方法的简单性。尽管它专注于 Visual BASIC.NET，但它可以从任何 .NET 语言中引用。

另一种选择是使用 Crystal Reports 之类的东西进行打印。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T13:51:08.587

一种选择是使用 .net [reportViewer](http://msdn.microsoft.com/en-us/library/ms252104.aspx)控件和 .rdlc 报告...

# caching - 在代理中缓存和清除代理调用之间的关系

> ID：483369
> 
> 赞同：0
> 
> 时间：2009-01-27T13:21:04.403
> 
> 标签：caching

作为我正在开发的系统的一部分，我们在调用另一个系统的代理中放置了一层缓存。这个缓存的键是由代理调用中使用的键值对组成的。因此，如果使用相同的值调用代理，则将从缓存中检索项目，而不是从其他服务中检索。这很有效，而且相当简单。

清除缓存时会变得更加复杂，因为在更改项目时要清除哪些项目并不明显。如果对象 A 包含在节点集 B 中并且对象 A 被更改，我们如何知道节点集 B 是陈旧的。

我们通过让我们调用的服务返回节点集以在对象更改时清除该问题，从而解决了这个问题。然而，这打破了封装并增加了一层复杂性，因为我们必须查看响应以查看需要清除的内容。

有没有更好/标准的方法来处理这种情况。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T13:38:29.390

这不是可以（并且应该）用观察者模式处理的事情吗？也就是说，B 应该监听影响其活跃性的事件，在这种情况下是 A 的状态。

Map 是缓存的一种非常自然的抽象，Oracle Coherence 和 Terracotta 就是这样做的。我更熟悉的 Coherence 具有侦听一般或特定节点的缓存事件的机制。这可能是你应该效仿的。

您可能还想查看其中任何一个的文档，即使它只是作为指南或想法的来源。

你没有说你在什么平台上运行，但也许我们可以建议一些替代方法来滚动你自己的，这总是充满问题，特别是像缓存这样复杂的东西（不要搞错：缓存很复杂）。

# java - JBoss 中的内存泄漏

> ID：483379
> 
> 赞同：2
> 
> 时间：2009-01-27T13:23:33.367
> 
> 标签：java, soap, jboss

我在 JBoss 中有一个非常奇怪的行为，我想利用 SO Crowd 的集体智慧。

我们使用 JBoss（我认为是 4.0.4）来服务 SOAP 调用。事实上，它被用作美化的 RPC 服务器，仅此而已。当我们有 20 多个客户同时发送他们的请求时，我们的内存就会用完。这些请求由传入的相当小的请求（正确的 SOAP）和返回的结果包组成，该包本质上是一个长 SOAP 字符串（并且字符串的内容是 XML）。是的，我意识到这是次优的。不要问。

我已经将泄漏追踪到一个包含 400 万个对象（字符串和整数）的 org.jboss.axis.message.SAX2EventRecorder 实例。现在，即使是最长的响应也不携带 4MB 的数据。请求都小于 40K。那里有些可疑，但我在网上找不到任何文档。

谁能告诉我录音机是干什么用的？我该如何摆脱它？或者可以将其配置为更少占用内存？任何帮助表示赞赏。

* * *

更新：澄清一下——我确实做了内存转储，转储显示了一个数组或 4,000,000 多个对象、字符串和整数。该数组由 org.jboss.axis.message.SAX2EventRecorder 拥有，而后者又由这些人持有：

org.jboss.axis.message.SOAPEnvelopeAxisImpl@0x19c31fd8（141 字节）：现场记录器 org.jboss.axis.message.RPCParamElementImpl@0x19c32260（123 字节）：现场记录器 org.jboss.axis.message.SOAPBodyAxisImpl@0x19c32160（121 字节） ) : 现场记录器 org.jboss.axis.message.RPCElement@0x19c321e0 (124 字节) : 现场记录器 org.jboss.axis.encoding.DeserializationContextImpl@0x19c332f0 (67 字节) : 现场记录器 org.jboss.axis.message.SAX2EventRecorder$ objArrayVector@0x19c33398（24 字节）：字段 this$0

我们自己的应用程序的数据结构非常臃肿，但还没有到这种程度。

另一个更新：powers that be 找到了“powers-that-be-solution”：我们正在切换到 64 位内存。欢呼。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-27T13:35:51.253

使用 JVM arg -XX:-HeapDumpOnOutOfMemoryError 运行。当您用完内存时，这将为您提供堆转储。*然后，您可以使用jhat*工具（它与您的 JDK 一起提供）分析堆转储。或者，您可以使用*jconsole*工具（JDK 随附）随时使用内存管理 MBean 请求堆转储。

它会告诉你这 400 万个对象实际包含什么，这可能会让你深入了解软件为什么不释放内存。

编辑：

看来你不是唯一一个有这个问题的人。Axis 提交了 2 个错误报告

[AXIS-2698](https://issues.apache.org/jira/browse/AXIS-2698)

[AXIS-2749](https://issues.apache.org/jira/browse/AXIS-2749)

另请参阅[AXIS-1771](https://issues.apache.org/jira/browse/AXIS-1771)，它有一些关于反序列化和调解其影响的方法的有趣信息。您使用的是哪个版本的 Axis？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-05T13:17:03.040

如果可以，请在 Java 6 下运行应用程序。最新版本包括用于分析的[VisualVM 。](https://visualvm.dev.java.net/)它应该能够显示内存的增长。您可以附加到 Java 5 虚拟机，但它没有显示那么多。

# django - 反转多对多关系

> ID：483382
> 
> 赞同：2
> 
> 时间：2009-01-27T13:24:05.597
> 
> 标签：django, django-models

我有男孩和玩具。两个 Django 模型。玩具可以由多个男孩拥有，每个男孩可以拥有多个玩具......所以我在 Boy 中放置了一个 ManyToMany 字段。

如果我想要一个单身男孩拥有的玩具清单，这很容易。到目前为止这么好。

但现在我需要获取基于 Toy 实例的 Boys 列表。关系*应该*是对称的，但我不知道语法。

* * *

*注意：不，这些不是我的真实实体名称 - 我只是认为它可能更容易理解。*

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-27T14:13:48.337

它应该是：

toy_instance.boy_set.all()

看这里：

[http://docs.djangoproject.com/en/dev/topics/db/queries/#many-to-many-relationships](http://docs.djangoproject.com/en/dev/topics/db/queries/#many-to-many-relationships)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-27T14:14:34.403

```
from django.db import models

class Toy(models.Model):
    name = models.CharField('Name', max_length=250)

    def __unicode__(self):
        return self.name

class Boy(models.Model):
    name = models.CharField('Name', max_length=250)
    toys_owned = models.ManyToManyField(Toy, blank = True)

    def __unicode__(self):
        return self.name 
```

如果 toy = 是 Toy 类的实例，那么 toy.boy_set.all() 就是你要找的

# c# - 索引服务端点元素集合

> ID：483386
> 
> 赞同：0
> 
> 时间：2009-01-27T13:26:07.637
> 
> 标签：c#, .net

在以下配置文件摘录中，WCF 服务有两个端点。

```
 <service behaviorConfiguration="AtomTcpHub.Behavior" 
           name="AtomTcpHub.HubTcp">
    <endpoint address="" binding="netTcpBinding" 
              name="AtomHubEndpoint" contract="AtomLib.IAtomPublisher">
      <identity>
        <dns value="localhost" />
      </identity>
    </endpoint>
    <endpoint address="mex" binding="mexHttpBinding" 
              name="" contract="IMetadataExchange" />
    <host>
      <baseAddresses>
        <add baseAddress="http://localhost:8731/AtomTcpHub/" />
        <add baseAddress="net.tcp://dv-pw/AtomTcpHub/" />
      </baseAddresses>
    </host>
  </service> 
```

在我的代码中有发现逻辑，它通过回复 WCF 服务的连接 Uri 来响应 UDP 请求。获取端点集合很简单。

```
System.Configuration.Configuration config = System.Configuration
  .ConfigurationManager
  .OpenExeConfiguration(System.Configuration.ConfigurationUserLevel.None);
ServicesSection section = config.SectionGroups["system.serviceModel"]
  .Sections["services"] as ServicesSection;
ServiceEndpointElementCollection seec = 
  section.Services["AtomTcpHub.HubTcp"].Endpoints; 
```

问题是提取`ServiceEndpointElement`. 我们可以通过索引获得它：

```
ServiceEndpointElement see = seec[0]; 
```

但这很脆弱；如果节点的顺序发生变化，它将中断。Visual Studio 告诉我有另一个索引器允许对象值，但没有进一步的指示。实验告诉我这*不是*name 属性的值。

下面的代码*有效*，但它只是*可怕*的。

```
string serviceEndpointUri;
foreach(ServiceEndpointElement serviceEndpointElement in seec)
  if (serviceEndpointElement.Name == "AtomHubEndpoint")
  {
    _serviceEndpointUri = serviceEndpointElement.Address.AbsoluteUri;
    break;
  } 
```

有没有更直接或更优雅的方式来做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T17:14:16.757

您总是可以使用一些 Linq 来完成此操作，以简单地缩短一些时间。

```
ServiceEndpointElement element =
seec.OfType<ServiceEndpointElement>()
.FirstOrDefault(s => s.Name == "AtomHubEndpoint"); 
```

# sql-server - 为什么此查询返回不需要的结果？

> ID：483400
> 
> 赞同：0
> 
> 时间：2009-01-27T13:34:38.977
> 
> 标签：sql-server, sql-server-2005, pivot

早上好，

我对这个查询有疑问：

```
SELECT  
    P.txt_nome AS Pergunta,   
    IP.nome AS Resposta,   
    COUNT(*) AS Qtd   
FROM  
    tb_resposta_formulario RF   
    INNER JOIN formularios F ON  
        F.id_formulario = RF.id_formulario   
    INNER JOIN tb_pergunta P ON  
        P.id_pergunta = RF.id_pergunta   
    INNER JOIN tb_resposta_formulario_combo RFC ON  
        RFC.id_resposta_formulario = RF.id_resposta_formulario   
    INNER JOIN itens_perguntas IP ON  
        IP.id_item_pergunta = RFC.id_item_pergunta   
WHERE  
    RF.id_formulario = 2   
GROUP BY    
    P.txt_nome,   
    IP.nome 
```

这是此查询的实际结果：

|佩贡塔| 回复 |Qtd|
|产品 |组合 1MB | 3 |
|产品 |组合 2MB | 5 |
|产品 |组合 4MB | 1 |
|产品 |组合 6MB | 1 |
|产品 |组合 8MB | 4 |
|地区 |MG | 3 |
|地区 |公关 | 2 |
|地区 |RJ | 3 |
|地区 |SC | 1 |
|地区 |SP | 5 |

这些是我所期待的结果：

|产品 | 地区 |Qtd|
|组合1MB | 名爵 | 3 |
|组合2MB | SP | 5 |
|组合4MB | SC | 1 |
|组合6MB | RJ | 1 |
|组合 8MB | 公关 | 2 |

我正在使用 PIVOT 和 UNPIVOT 运算符，但结果并不令人满意。

以前有人遇到过这种情况吗？你有什么可以提供的见解吗？

我已经分析了这些链接：

*   [SQL Server 2005 以未知列数为中心](https://stackoverflow.com/questions/213702/sql-server-2005-pivot-on-unknown-number-of-columns)
*   [在 SQL Server 2000 中将一组行转换为列](https://stackoverflow.com/questions/152770/transpose-a-set-of-rows-as-columns-in-sql-server-2000)
*   [SQL Server 2005，将列变成行](https://stackoverflow.com/questions/428041/sql-server-2005-turn-columns-into-rows)
*   [数据透视表和连接列](https://stackoverflow.com/questions/159456/pivot-table-and-concatenate-columns-sql-problem#159803)
*   [sql 2005 中的 PIVOT](https://stackoverflow.com/questions/198716/pivot-in-sql-2005#199763)

阿特，佩莱格里尼

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T13:47:35.877

“显而易见”的答案是：因为查询不正确。我们真的对表结构和您想要实现的目标一无所知。

关于查询中的至少一个非常基本的问题：您期望`|Produto | Região |Qtd|`响应中的列，但查询明确选择列`Pergunta`,`Reposta`和`Qtd`，这与您得到的结果一致。

您对 SQL 的了解程度如何？阅读介绍性文本可能是值得的。我建议[这](http://philip.greenspun.com/sql/)是一个很好的介绍。（使用Oracle，但原理相同）

# sql-server - 如何在 T-SQL 中的事务之外执行插入和更新

> ID：483402
> 
> 赞同：7
> 
> 时间：2009-01-27T13:34:50.863
> 
> 标签：sql-server, tsql, transactions

我在 SQL Server T-SQL 中存储了在事务范围内从 .NET 调用的过程。

在我的存储过程中，我正在对一些审计表进行一些日志记录。我在审计表中插入一行，然后在事务中通过更新填充更多信息。

我发现，如果几个人同时尝试相同的事情，其中​​ 1 或 2 个将成为事务死锁的受害者。目前我假设当我插入审计表时发生了某种锁定。

我想在我正在执行的事务之外执行对审计表的插入和更新，这样审计无论如何都会发生，即使事务回滚。我希望这可能会阻止任何锁的发生，允许多人同时执行该过程。

谁能帮我在 T-SQL 中做到这一点？

谢谢，丰富

更新——我后来发现审计与事务死锁无关，这要归功于 Josh 建议使用 SQL Profiler 来追踪死锁的来源。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-27T14:04:17.060

TranactionScope 支持抑制：

```
using (TransactionScope scope = new TransactionScope())
{

    // Transactional code...

    // Call a SQL stored procedure (but suppress the transaction)
    using (TransactionScope suppress = new TransactionScope(TransactionScopeOption.Suppress))
    {
        using (SqlConnection conn = new SqlConnection(...))
        {
            conn.Open();
            SqlCommand sqlCommand = conn.CreateCommand();
            sqlCommand.CommandType = CommandType.StoredProcedure;
            sqlCommand.CommandText = "MyStoredProcedure";
            int rows = (int)sqlCommand.ExecuteScalar();
        }
    }

    scope.Complete();

} 
```

但我不得不质疑为什么日志记录/审计会在事务之外运行？如果事务回滚，您仍将提交审核/日志记录，这可能不是您想要的。

您没有提供太多关于如何记录的信息。您的审计表是否有外键指向您的主要活动表？如果是这样，请删除外键（假设审计记录仅来自“已知”应用程序）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-27T13:53:33.917

您可以将审计保存到表变量（不受事务影响），然后在 SP 结束时（在事务范围之外）将行插入审计表。

但是，听起来您正在尝试解决症状而不是问题。您可能想要追踪死锁并修复它们。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T13:40:21.557

为什么要更新审计表？如果您只进行插入，则可能有助于防止锁定升级。您是否还检查了死锁跟踪以确定您到底在死锁什么？

您可以通过启用[跟踪标志 1204](http://msdn.microsoft.com/en-us/library/aa260630(SQL.80).aspx)来做到这一点。或运行 SQL Profiler。这将为您提供详细信息，让您了解哪种死锁（锁、线程、并行等......）。

查看这篇关于[检测和结束死锁](http://msdn.microsoft.com/en-us/library/ms178104.aspx)的文章。

进行审计的另一种方法是通过将所有日志记录事件发送到应用程序层的队列来完全与业务事务分离，这可以最大限度地减少日志记录对您的业务事务的影响，但对于现有应用程序来说可能非常大。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2018-06-06T11:58:05.317

我有类似的要求，我需要将错误记录到错误日志表中，但发现回滚正在清除它们。

通过将先前插入的错误记录弹出到表变量中，调用 Rollback，然后将记录推回（插入）到表中，解决了这个问题。

像魅力一样工作，但代码很混乱，因为它必须是内联的。不能将 ROLLBACK 放入存储过程，否则会出现“执行后的事务计数...”错误。

# asp.net - 将单个 DB ASP.NET 站点转换为多租户 - 成员资格和角色困境

> ID：483414
> 
> 赞同：3
> 
> 时间：2009-01-27T13:39:56.190
> 
> 标签：asp.net, vb.net, roles, membership, provider-model

我正在将单个 SQL DB 网站 (ASP.NET/VB.NET) 更改为多租户应用程序，其中每个客户端都有自己的数据库。

在旧站点中，所有 ASP 角色、登录名和提供程序都指向单个数据库。

现在我们有多个数据库，我想知道最好使用什么架构/技术。有一个数据库可以配置租户，例如公司名称、各种设置（通常在 web.config 中）以及到租户数据库的连接字符串。

我们应该在配置租户的单个数据库中拥有所有成员资格和角色，还是在每个单独的租户数据库中拥有成员资格和角色？选项 2 似乎很棘手，因为我认为 ASP.NET 只喜欢 web.config 中定义的一组 RoleProviders。

有没有人尝试过这个或有任何建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T13:45:48.877

如果您将 ASP.Net Membership 模型与内置提供程序一起使用，那么将它们放入一个 DB 是您所指出的最简单的方法。

一种选择，我没有尝试过，是在您的 web.config 文件中为每个租户定义一个提供程序。这将允许每个租户拥有自己的会员数据库，并允许您避免租户之间的用户名冲突（如果这是一个要求）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-08-09T00:45:06.617

您应该能够在运行时配置 ASP.NET 成员数据库连接字符串。 [该线程](http://forums.asp.net/p/997608/2209437.aspx)有一些选项，包括自定义成员资格提供程序或在请求生命周期的早期通过 Global.asax.cs 更改值。

# wpf - 强制验证 WPF 中的绑定控件

> ID：483419
> 
> 赞同：65
> 
> 时间：2009-01-27T13:40:33.647
> 
> 标签：wpf, validation, business-objects

我有一个 WPF 对话框，上面有几个文本框。文本框绑定到我的业务对象并附加了 WPF 验证规则。

问题是用户可以完美地单击“确定”按钮并关闭对话框，而无需实际将数据输入到文本框中。验证规则永远不会触发，因为用户甚至没有尝试将信息输入到文本框中。

是否可以强制验证检查并确定某些验证规则是否被破坏？

当用户尝试关闭对话框并在任何验证规则被破坏时禁止他这样做时，我将能够做到这一点。

谢谢你。

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2009-03-21T06:49:07.223

在 3.5SP1 / 3.0SP2 中，他们还在 ValidationRule 基础中添加了一个新属性，即[ValidatesOnTargetUpdated="True"](http://msdn.microsoft.com/en-us/library/system.windows.controls.validationrule.validatesontargetupdated.aspx)。这将在绑定源对象后立即调用验证，而不是仅在更新目标控件时调用。这可能不是您想要的，但最初看到您需要修复的所有内容也不错。

像这样工作：

```
<TextBox.Text>
    <Binding Path="Amount" StringFormat="C">
        <Binding.ValidationRules>
            <validation:RequiredValidationRule 
                ErrorMessage="The pledge amount is required." 
                ValidatesOnTargetUpdated="True"  />
            <validation:IsNumericValidationRule 
                ErrorMessage="The pledge amount must be numeric." 
                ValidationStep="ConvertedProposedValue" 
                ValidatesOnTargetUpdated="True"  />
        </Binding.ValidationRules>
    </Binding>
</TextBox.Text> 
```

* * *

## 回答 #2

> 赞同：68
> 
> 时间：2009-01-30T19:28:21.643

我们的应用程序中也存在这个问题。验证仅在绑定更新时触发，因此您必须手动更新它们。我们在 Window 的[Loaded](http://msdn.microsoft.com/en-us/library/system.windows.frameworkelement.loaded(VS.95).aspx)事件中执行此操作：

```
public void Window_Loaded(object sender, RoutedEventArgs e)
{
    // we manually fire the bindings so we get the validation initially
    txtName.GetBindingExpression(TextBox.TextProperty).UpdateSource();
    txtCode.GetBindingExpression(TextBox.TextProperty).UpdateSource();
} 
```

这将使错误模板（红色轮廓）出现，并设置[Validation.HasError](http://msdn.microsoft.com/en-us/library/system.windows.controls.validation.haserror.aspx)属性，我们已触发 OK 按钮禁用该属性：

```
<Button x:Name="btnOK" Content="OK" IsDefault="True" Click="btnOK_Click">
    <Button.Style>
        <Style TargetType="{x:Type Button}">
            <Setter Property="IsEnabled" Value="false" />
            <Style.Triggers>
                <!-- Require the controls to be valid in order to press OK -->
                <MultiDataTrigger>
                    <MultiDataTrigger.Conditions>
                        <Condition Binding="{Binding ElementName=txtName, Path=(Validation.HasError)}" Value="false" />
                        <Condition Binding="{Binding ElementName=txtCode, Path=(Validation.HasError)}" Value="false" />
                    </MultiDataTrigger.Conditions>
                    <Setter Property="IsEnabled" Value="true" />
                </MultiDataTrigger>
            </Style.Triggers>
        </Style>
    </Button.Style>
</Button> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-06-24T23:00:53.160

这是一种不需要调用“UpdateSource()”或“UpdateTarget()”的替代方法：

```
var binding = thingToValidate.GetBinding(propertyToValidate);
foreach (var rule in binding.ValidationRules)
{
    var value = thingToValidate.GetValue(propertyToValidate);
    var result = rule.Validate(value, CultureInfo.CurrentCulture);
    if (result.IsValid) 
         continue;
    var expr = BindingOperations.GetBindingExpression(thingToValidate, propertyToValidate);
    if (expr == null)  
        continue;
    var validationError = new ValidationError(rule, expr);
    validationError.ErrorContent = result.ErrorContent;
    Validation.MarkInvalid(expr, validationError);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-07-25T11:57:12.167

使用 Robert Macnee 提出的上述方法。例如：

```
//force initial validation
foreach (FrameworkElement item in grid1.Children)
{
    if (item is TextBox)
    {
        TextBox txt = item as TextBox;
        txt.GetBindingExpression(TextBox.TextProperty).UpdateSource();
    }
} 
```

但是，请确保在此代码运行之前绑定的控件是可见的！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-05-24T16:32:12.097

以防万一有人碰巧发现这个老问题并正在寻找解决 Monstieur 关于 UI 指南的评论的答案，我做了以下事情：

Xaml

```
<TextBox.Text>
    <Binding Path="TextValue" Mode="TwoWay" UpdateSourceTrigger="PropertyChanged">
        <Binding.ValidationRules>
            <local:RequiredFieldValidationRule>
                    <local:RequiredFieldValidationRule.IsRequiredField>
                    <local:BoolValue Value="{Binding Data.Required, Source={StaticResource proxy}}" />
                </local:RequiredFieldValidationRule.IsRequiredField>
                <local:RequiredFieldValidationRule.ValidationFailed>
                    <local:BoolValue Value="{Binding Data.HasValidationError, Mode=TwoWay, Source={StaticResource proxy}}" />
                </local:RequiredFieldValidationRule.ValidationFailed>
            </local:RequiredFieldValidationRule>
        </Binding.ValidationRules>
    </Binding>
</TextBox.Text> 
```

必填字段验证规则：

```
public class RequiredFieldValidationRule : ValidationRule
{
    private BoolValue _isRequiredField;
    public BoolValue IsRequiredField
    {
        get { return _isRequiredField; }
        set { _isRequiredField = value; }
    }
    private BoolValue _validationFailed;
    public BoolValue ValidationFailed
    {
        get { return _validationFailed; }
        set { _validationFailed = value; }
    }

    public override ValidationResult Validate(object value, CultureInfo cultureInfo)
    {
        ValidationFailed.Value = IsRequiredField.Value && (value == null || value.ToString().Length == 0);
        return new ValidationResult(!ValidationFailed.Value, ValidationFailed.Value ? "This field is mandatory" : null);
    }
} 
```

在 Xaml 绑定到的类中

```
private bool _hasValidationError;
public bool HasValidationError
{
    get { return _hasValidationError; }
    set { _hasValidationError = value; NotifyPropertyChanged(nameof(HasValidationError)); }
}

public void InitialisationMethod() // Or could be done in a constructor
{
    _hasValidationError = Required; // Required is a property indicating whether the field is mandatory or not
} 
```

然后，如果我的任何对象具有 HasValidationError = true，我将使用绑定属性隐藏我的保存按钮。

希望这对某人有帮助。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2010-10-11T21:26:28.337

在您的数据对象上使用 INotifyPropertychanged

```
public class MyObject : INotifyPropertyChanged
{
    string _MyPropertyToBind = string.Empty;
    public string MyPropertyToBind
    {
        get
        {
            return _MyPropertyToBind;
        }
        set
        {
            _MyPropertyToBind = value;
            NotifyPropertyChanged("MyPropertyToBind");
        }
    }

    public void NotifyPropertyChanged(string property)
    {
        if (this.PropertyChanged != null)
        {
            this.PropertyChanged(this, new PropertyChangedEventArgs(property));
        }
    }
    #region INotifyPropertyChanged Members

    public event PropertyChangedEventHandler PropertyChanged;

    #endregion

} 
```

您可以将以下代码添加到您的控件

```
<TextBox Text="{Binding MyPropertyToBind, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" > 
```

文本框订阅 datacontext 对象（在我们的示例中为 MyObjet）的 propertychanged 事件，并假定在更新源数据时触发它

它会自动强制刷新控件

无需调用自己的 UpdateTarget 方法

# javascript - 导出最高 10 个值的子集数组的最简单方法？

> ID：483420
> 
> 赞同：1
> 
> 时间：2009-01-27T13:41:09.807
> 
> 标签：javascript

在javascript中，我有一个数组如下：

```
var foo = [2, 2, 4, 4, 128, 2, 2, 1, 4, 18, 27, 16, 2, 1, 18, 21, 5, 1, 128, 1, 2, 2, 1, 18, 12, 60, 2, 28, 1, 17, 2, 3, 4, 2, 2, 2, 1, 27, 2, 17, 7, 2, 2, 2, 5, 1, 2, 4, 7, 1, 2, 1, 1, 1, 2, 1, 5, 7, 2, 7, 6, 1, 7, 1, 5, 8, 4]; 
```

而且我有兴趣找到一种方法（在一个循环内，而不是多个循环内）来派生最高 10 个值的子集数组，其中值的前一个位置是“键”（因此模拟 Map 对象）：

例如：

```
var fooTopTen = [[4, 128], [18, 128], [25, 60], [27, 28], [10, 27], [37, 27], [15, 21], [9, 18], [14, 18], [23, 18]]; 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T14:06:53.140

我之前的答案使用了反向索引表，但包含一些错误 - 现在已修复 - 并且比以下代码更难理解。

这实际上是答案中给出的所有解决方案中最慢的 - 为了获得最佳性能，请查看我的其他答案。

```
var foo = [2, 2, 4, 4, 128, 2, 2, 1, 4, 18, 27, 16, 2, 1, 18, 21, 5, 1, 128, 1, 2, 2, 1, 18, 12, 60, 2, 28, 1, 17, 2, 3, 4, 2, 2, 2, 1, 27, 2, 17, 7, 2, 2, 2, 5, 1, 2, 4, 7, 1, 2, 1, 1, 1, 2, 1, 5, 7, 2, 7, 6, 1, 7, 1, 5, 8, 4];

var fooTopTen = [];

// add index to values
for(var i = 0, len = foo.length; i < len; ++i)
    fooTopTen.push([i, foo[i]]);

// sort first by value (descending order), then by index (ascending order)
fooTopTen.sort(function(t1, t2) {
    return t2[1] - t1[1] || t1[0] - t2[0];
});

// shorten array to correct size
fooTopTen.length = 10;

// output top ten to check result
document.writeln('[[' + fooTopTen.join('], [') + ']]'); 
```

不需要比较函数的第二部分（比较索引的部分），因为在大多数实现中是稳定的（[根据 MDC](https://developer.mozilla.org/En/Core_JavaScript_1.5_Reference/Global_Objects/Array/Sort)`sort()`，ECMA 不需要这样做）。我将把它作为一个例子来说明如何对多个需求进行排序......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T13:58:39.477

这是我之前使用索引表的答案的调试版本。我做了一些基准测试，对于问题中给出的输入，这个解决方案将比迄今为止在这个线程中建议的任何其他方法更快：

```
var foo = [2, 2, 4, 4, 128, 2, 2, 1, 4, 18, 27, 16, 2, 1, 18, 21, 5, 1, 128, 1, 2, 2, 1, 18, 12, 60, 2, 28, 1, 17, 2, 3, 4, 2, 2, 2, 1, 27, 2, 17, 7, 2, 2, 2, 5, 1, 2, 4, 7, 1, 2, 1, 1, 1, 2, 1, 5, 7, 2, 7, 6, 1, 7, 1, 5, 8, 4];

var indexTable = {}, uniqueValues = [];

// --- build reverse index table, find unique values

for(var i = foo.length; i--; ) {
    var value = foo[i];
    if(indexTable.hasOwnProperty(value))
        indexTable[value].push(i);
    else {
        indexTable[value] = [i];
        uniqueValues.push(value);
    }
}

// --- sort unique values in ascending order

uniqueValues.sort(function(i1, i2) {
    return i1 - i2;
});

// --- find ten greatest values

var fooTopTen = [], k = 0;

for(var i = uniqueValues.length; k < 10 && i--; ) {
    var value = uniqueValues[i],
        indices = indexTable[value];

    for(var j = indices.length; k < 10 && j--; )
        fooTopTen[k++] = [indices[j], value];
}

// --- output result

document.writeln('[[' + fooTopTen.join('], [') + ']]'); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T14:27:15.253

这会在它搜索的主数组中运行一次，在结果数组中的适当位置插入项目：

```
function top10(arr) {
  var results = [[0,Number.MAX_VALUE],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]];

  for (var i=0; i<arr.length; i++) {
    // search from back to front
    for (var j=9; j>=0; j--) {
       if (arr[i] <= results[j][1]) {
         if (j==9)
           break;
         results.splice(j+1, 0, [i, arr[i]]);
         results.pop();
         break;
      }
    }
  }
  return results.slice(1);
} 
```

对于大型数组，这甚至应该相当快，因为​​大多数时候内部循环应该只进行一次迭代。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T14:08:25.213

```
var foo = [2, 2, 4, 4, 128, 2, 2, 1, 4, 18, 27, 16, 2, 1, 18, 21, 5, 1, 128, 1, 2, 2, 1, 18, 12, 60, 2, 28, 1, 17, 2, 3, 4, 2, 2, 2, 1, 27, 2, 17, 7, 2, 2, 2, 5, 1, 2, 4, 7, 1, 2, 1, 1, 1, 2, 1, 5, 7, 2, 7, 6, 1, 7, 1, 5, 8, 4];

var index = 0;
var result = foo.map( function(a){ return [index++, a]; } )
         .sort( function(a,b){ return (a[1] < b[1]); } )
         .splice( 0, 10 );

document.write(result.join( '  ' )); 
```

如果 foo 与所需的结果大小相比非常大，则迭代 foo 插入-将每个元素排序到结果中可能会更快，因为我们遇到它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T14:19:12.163

```
// Sorting method
function sortNumber(a, b) {
    return a - b;
}

// Find the offset of an element in array
function findOffset(element, array) {
    for (var i = 0; i < array.length; i++) {
        if (array[i] == element) {
            // Make sure we don't find it again
            array[i] = null;
            return i;
        }
    }
}

var foo = [2, 2, 4, 4, 128, 2, 2, 1, 4, 18, 27, 16, 2, 1, 18, 21, 5, 1, 128, 1, 2, 2, 1, 18, 12, 60, 2, 28, 1, 17, 2, 3, 4, 2, 2, 2, 1, 27, 2, 17, 7, 2, 2, 2, 5, 1, 2, 4, 7, 1, 2, 1, 1, 1, 2, 1, 5, 7, 2, 7, 6, 1, 7, 1, 5, 8, 4];
// Copies
var bar = foo.slice();
var baz = foo.slice();
var fooTopTen = new Array(10);
// Sort
bar.sort(sortNumber).reverse();
// Create the results
for (var i = 0; i < 10; i++) {
    fooTopTen[i] = new Array(2);
    fooTopTen[i][0] = findOffset(bar[i], baz);
    fooTopTen[i][1] = bar[i];
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T14:28:37.607

计算机科学答案：

问题陈述：给定一个长度为 N 的大数组 X 和一个小数 m < N（这里 m=10），生成一个长度为 m 的数组 Y，其中 Y 的每个元素都包含对 {i,X[i]} 这样X{i} 的集合是 X 的 m 个最大元素。

如果 m 远小于 N，则遍历 X 的元素并将它们排序为 Y，丢弃对以保持最多 m 个元素。（即如月影所述）

对 X 进行排序将花费您 O(N log N) 个元素。遍历 X 并排序到 Y 应该只花费你 O(N log m) 个元素。

# c++ - 使用条件变量超时的读取器/写入器锁定

> ID：483426
> 
> 赞同：1
> 
> 时间：2009-01-27T13:43:02.970
> 
> 标签：c++, c, multithreading, locking

如何使用 C/C++ 中的条件变量编写具有超时的读取器/写入器锁？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T14:37:27.633

如果你只是在寻找一个库，[Boost.Thread](http://www.boost.org/doc/libs/1_37_0/doc/html/thread.html)可能会做你想做的事。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T14:17:15.617

您可以查看 Java 实现[ReentrantReadWriteLock](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/locks/ReentrantReadWriteLock.html)的来源。

只需抓住[JDK](https://cds.sun.com/is-bin/INTERSHOP.enfinity/WFS/CDS-CDS_Developer-Site/en_US/-/USD/ViewProductDetail-Start?ProductRef=jdk-6u11-oth-JPR@CDS-CDS_Developer)解压 src.zip 文件并搜索源代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T19:22:04.580

看看[Boost.Thread](http://www.boost.org/doc/libs/1_37_0/doc/html/thread.html)库。具体来说：`shared_mutex`和`upgradeable_mutex`对象。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T14:30:23.560

当前的标准 C++ 中不支持这些东西，尽管 C++0x 将有一些线程支持（我没有检查过多少）。因此，任何答案都必须依赖于平台，在非常普遍的意义上使用平台。

可以编写在不同底层系统中行为相似的库，并且有很多跨平台库。（当然，如果底层平台的功能不同，这些都会导致效率低下。）可能有一个普遍接受的 C++ 线程库，可以在基于 Windows 和 Unix 的系统上工作（这几乎是你正在运行的任何东西现在在桌面上），但我不知道有一个副手。

因此，这个问题不能真正按要求回答。有必要在特定的平台或库上回答它，并且没有指定。如果加上图书馆推荐的请求，这将是有意义的。

# c# - 垃圾回收操作

> ID：483427
> 
> 赞同：1
> 
> 时间：2009-01-27T13:43:34.670
> 
> 标签：c#, java, garbage-collection

有人可以解释一下垃圾收集是如何工作的吗？

（我正在使用 C# 和 Java）。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-27T13:48:16.843

一个简单的答案无法涵盖这个主题太复杂。

以下是推荐阅读清单：

*   [维基百科：垃圾收集（计算机科学）](http://en.wikipedia.org/wiki/Garbage_collection_(computer_science))
*   [垃圾收集：Microsoft .NET Framework 中的自动内存管理](http://msdn.microsoft.com/en-us/magazine/bb985010.aspx)
*   [垃圾收集：第 2 部分：Microsoft .NET Framework 中的自动内存管理](http://msdn.microsoft.com/en-us/magazine/bb985011.aspx)
*   [Java理论与实践：垃圾收集简史](http://www.ibm.com/developerworks/library/j-jtp10283/)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-27T13:48:06.533

垃圾收集背后的基本思想是您不必关心内存管理。垃圾收集器所做的是定期检查对象引用并找到不再使用（不再引用）的对象以回收它们的内存并压缩另一个。垃圾收集器使用各种算法来执行它们的工作，并且它们在某些细节上因语言而异。维基百科为您提供了一个很好的[起点](http://en.wikipedia.org/wiki/Garbage_collection_(computer_science))。如果您正在寻找有关各种垃圾收集器（Java、.NET、..）实际实现的更多深入信息，您可以[在此处](http://www.codeproject.com/KB/dotnet/garbagecollection.aspx)和[此处查看](http://www.devdaily.com/java/edu/pj/pj010008/pj010008.shtml)或搜索谷歌以获取更多信息。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-27T13:47:21.603

试试《[垃圾收集：自动动态内存管理算法](http://www.amazon.co.uk/Garbage-Collection-Algorithms-Automatic-Management/dp/0471941484/ref=sr_1_1?ie=UTF8&s=books&qid=1233063949&sr=8-1)》一书。它不会包含更新的内容，但它会让你继续前进。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T14:56:15.647

Perfmon 为 GC 相关性能提供了许多计数器...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T14:12:51.943

[这是一个很好的网络广播，它讨论了简单的标记和清除（非分代）垃圾收集](http://whitepapers.techrepublic.com.com/abstract.aspx?docid=278895)，并配有漂亮的动画来帮助阐明这个概念。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T15:07:12.957

我认为您需要知道垃圾收集器是在您的程序上运行的线程，用于释放其引用使其无法访问的对象所占用的内存。您还需要知道 int GC 运行的时刻无法预测，您可以调用 来`System.gc()`建议***GC***运行而**不是*让它运行***，这是 JVM 会接受的决定。

如果你有： `Object objectReference = null;`

objectReference 引用的 Object 是 GC 诱饵。“孤立岛”的主题以及`finalize(`) 方法的工作原理是值得阅读的有趣主题。我建议对两者进行快速谷歌搜索。

# ruby - Ruby 中的类型转换：“正确”的方式？

> ID：483428
> 
> 赞同：7
> 
> 时间：2009-01-27T13:43:38.040
> 
> 标签：ruby, types

我正在尝试确定字符串是否是 Ruby 中的数字。这是我的代码

```
whatAmI = "32.3a22"
puts "This is always false " + String(whatAmI.is_a?(Fixnum));
isNum = false;
begin
  Float(whatAmI)
  isNum = true;
rescue Exception => e
  puts "What does Ruby say? " + e
  isNum = false;
end
puts isNum 
```

我意识到我可以用 RegEx**来做到这一点，但是有没有我错过的标准方法呢？**我见过can_convert？方法，但我好像没有。

**有没有办法添加一个can_convert？所有字符串的方法？**我知道这在 Ruby 中是可能的。我也明白这可能是完全不必要的......

**编辑**to_f 方法不起作用，因为它们从不抛出异常，而是在不起作用时返回 0。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-27T14:48:18.673

你有正确的想法。不过，它可以做得更紧凑一些：

```
isNum = Float(whatAmI) rescue nil 
```

内联“救援”非常有趣。如果您将要救援的部分放在更多东西的中间，请用括号括起来，例如：

```
if (isNum = Float(whatAmI) rescue nil) && isNum > 20
  ... 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-27T14:49:06.380

这听起来可能过于关键，但根据您的描述，您几乎肯定在做“错误”的事情......为什么您需要检查字符串是否是 a 的有效表示`Float`但实际上不转换字符串？

这只是一种预感，但描述您要完成的工作可能很有用。可能有一个“更好”的方法。

例如，您可能希望将字符串插入数据库并使用字符串连接组合一个 sql 语句。最好转换为浮点数并使用准备好的语句。

如果您只需要检查字符串的“形状”，则最好使用正则表达式，因为正如 dylan 指出的那样，浮点数可以用多种可能合适或不合适的方式表示。

您可能还必须处理国际输入，在欧洲，使用逗号而不是句点作为小数分隔符，但 Ruby Floats 必须使用 (.)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-27T13:49:33.113

我不知道该`can_convert`方法，但通常一个类会定义诸如`to_s`,`to_i`等方法`to_hash`。这些方法返回对象的不同表示，例如，`to_s`方法将返回对象的字符串表示。

至于实际的转换，我相信其他人可以比我更好地回答这个问题。

另一方面，如果您想知道是否可以为所有字符串添加方法，您可以。只需打开`String`课程并添加它！

```
class String
  def can_convert?
    ...
  end
end 
```

**编辑：**包含指数符号的字符串由`to_f`.

```
>> "6.02e23".to_f
=> 6.02e+23 
```

# string - 如何在字符串列表/数组中找到相似的模式

> ID：483429
> 
> 赞同：6
> 
> 时间：2009-01-27T13:44:17.633
> 
> 标签：string, pattern-matching

我正在寻找在字符串列表或数组中查找匹配模式的方法，特别是在 .NET 中，但来自其他语言的算法或逻辑会有所帮助。

假设我有 3 个数组（或者在这种特定情况下为 List(Of String)）

```
Array1
"Do"
"Re"
"Mi"
"Fa"
"So"
"La"
"Ti"

Array2
"Mi"
"Fa"
"Jim"
"Bob"
"So"

Array3
"Jim"
"Bob"
"So"
"La"
"Ti" 
```

我想报告以下比赛的发生情况

```
("Mi", "Fa") In Arrays (1,2)
("So") In Arrays (1,2,3)
("Jim", "Bob", "So") in Arrays (2,3)
("So", "La", "Ti") in Arrays (1, 3) 
```

...以及任何其他人。

我正在使用它来解决问题，而不是专门制作它的商业产品，并且宁愿不手工完成（有大约 100-200 个项目的 110 个列表）。

是否有任何算法、现有代码或想法可以帮助我找到所描述的结果？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T13:59:04.747

最简单的编码方法是构建一个 Dictionary 然后循环遍历每个数组中的每个项目。对于每个项目，请执行以下操作：

检查项目是否在字典中，如果是，则将列表添加到数组中。如果该项目不在字典中，请添加它和列表。

正如你所说，这是非生产代码性能并不重要，所以这种方法应该可以正常工作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-27T14:40:19.063

这是使用[SuffixTree](http://hkn.eecs.berkeley.edu/~dyoo/python/suffix_trees/)模块定位子序列的解决方案：

```
#!/usr/bin/env python
from SuffixTree  import SubstringDict
from collections import defaultdict
from itertools   import groupby
from operator    import itemgetter
import sys

def main(stdout=sys.stdout):
    """
    >>> import StringIO
    >>> s = StringIO.StringIO()
    >>> main(stdout=s)
    >>> print s.getvalue()
    [['Mi', 'Fa']] In Arrays (1, 2)
    [['So', 'La', 'Ti']] In Arrays (1, 3)
    [['Jim', 'Bob', 'So']] In Arrays (2, 3)
    [['So']] In Arrays (1, 2, 3)
    <BLANKLINE>
    """
    # array of arrays of strings
    arr = [
        ["Do", "Re", "Mi", "Fa", "So", "La", "Ti",],
        ["Mi", "Fa", "Jim", "Bob", "So",],
        ["Jim", "Bob", "So", "La", "Ti",],
    ]

####    # 28 seconds  (27 seconds without lesser substrs inspection (see below))
####    N, M = 100, 100
####    import random
####    arr = [[random.randrange(100) for _ in range(M)] for _ in range(N)]

    # convert to ASCII alphabet (for SubstringDict)
    letter2item = {}
    item2letter = {}
    c = 1
    for item in (i for a in arr for i in a):
        if item not in item2letter:
            c += 1
            if c == 128:
                raise ValueError("too many unique items; "
                                 "use a less restrictive alphabet for SuffixTree")
            letter = chr(c)
            letter2item[letter] = item
            item2letter[item] = letter
    arr_ascii = [''.join(item2letter[item] for item in a) for a in arr]

    # populate substring dict (based on SuffixTree)
    substring_dict = SubstringDict()
    for i, s in enumerate(arr_ascii):
        substring_dict[s] = i+1

    # enumerate all substrings, save those that occur more than once
    substr2indices = {}
    indices2substr = defaultdict(list)
    for str_ in arr_ascii:
        for start in range(len(str_)):
            for size in reversed(range(1, len(str_) - start + 1)):
                substr = str_[start:start + size]
                if substr not in substr2indices:
                    indices = substring_dict[substr] # O(n) SuffixTree
                    if len(indices) > 1:
                        substr2indices[substr] = indices
                        indices2substr[tuple(indices)].append(substr)
####                        # inspect all lesser substrs
####                        # it could diminish size of indices2substr[ind] list
####                        # but it has no effect for input 100x100x100 (see above)
####                        for i in reversed(range(len(substr))):
####                            s = substr[:i]
####                            if s in substr2indices: continue
####                            ind = substring_dict[s]
####                            if len(ind) > len(indices):
####                                substr2indices[s] = ind
####                                indices2substr[tuple(ind)].append(s)
####                                indices = ind
####                            else:
####                                assert set(ind) == set(indices), (ind, indices)
####                                substr2indices[s] = None
####                        break # all sizes inspected, move to next `start`

    for indices, substrs in indices2substr.iteritems():
        # remove substrs that are substrs of other substrs
        substrs = sorted(substrs, key=len) # sort by size
        substrs = [p for i, p in enumerate(substrs)
                   if not any(p in q  for q in substrs[i+1:])]
        # convert letters to items and print
        items = [map(letter2item.get, substr) for substr in substrs]
        print >>stdout, "%s In Arrays %s" % (items, indices)

if __name__=="__main__":
    # test
    import doctest; doctest.testmod()
    # measure performance
    import timeit
    t = timeit.Timer(stmt='main(stdout=s)',
                     setup='from __main__ import main; from cStringIO import StringIO as S; s = S()')
    N = 1000
    milliseconds = min(t.repeat(repeat=3, number=N))
    print("%.3g milliseconds" % (1e3*milliseconds/N)) 
```

处理 100 个包含 100 个项目的列表大约需要 30 秒。`SubstringDict`在上面的代码中可能会被`grep -F -f`.

旧解决方案：

* * *

在 Python 中（将其保存到 'group_patterns.py' 文件）：

```
#!/usr/bin/env python
from collections import defaultdict
from itertools   import groupby

def issubseq(p, q):
    """Return whether `p` is a subsequence of `q`."""
    return any(p == q[i:i + len(p)] for i in range(len(q) - len(p) + 1))

arr = (("Do", "Re", "Mi", "Fa", "So", "La", "Ti",),
       ("Mi", "Fa", "Jim", "Bob", "So",),
       ("Jim", "Bob", "So", "La", "Ti",))

# store all patterns that occure at least twice
d = defaultdict(list) # a map: pattern -> indexes of arrays it's within
for i, a in enumerate(arr[:-1]):
    for j, q in enumerate(arr[i+1:]): 
        for k in range(len(a)):
            for size in range(1, len(a)+1-k):
                p = a[k:k + size] # a pattern
                if issubseq(p, q): # `p` occures at least twice
                    d[p] += [i+1, i+2+j]

# group patterns by arrays they are within
inarrays = lambda pair: sorted(set(pair[1]))
for key, group in groupby(sorted(d.iteritems(), key=inarrays), key=inarrays):
    patterns = sorted((pair[0] for pair in group), key=len) # sort by size
    # remove patterns that are subsequences of other patterns
    patterns = [p for i, p in enumerate(patterns)
                if not any(issubseq(p, q)  for q in patterns[i+1:])]
    print "%s In Arrays %s" % (patterns, key) 
```

以下命令：

```
$ python group_patterns.py 
```

印刷：

```
[('Mi', 'Fa')] In Arrays [1, 2]
[('So',)] In Arrays [1, 2, 3]
[('So', 'La', 'Ti')] In Arrays [1, 3]
[('Jim', 'Bob', 'So')] In Arrays [2, 3] 
```

该解决方案非常低效。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-27T14:06:09.680

正如其他人提到的那样，您想要的功能是相交。如果您使用的是 .NET 3.0，请考虑使用 LINQ 的 Intersect 函数。

有关更多信息，请参阅[以下帖子](http://blogs.conchango.com/simonmunro/archive/2008/10/23/12904.aspx)

考虑使用 LinqPAD 进行实验。

[www.linqpad.net](http://www.linqpad.net/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-27T19:10:37.520

我在大约 10 分钟的 Perl 中破解了下面的程序。它并不完美，它使用一个全局变量，它只是打印出程序在每个列表中看到的每个元素的计数，但它很好地近似于你想要做的事情，而且非常容易编码。

你真的想要每个数组共有元素的所有子集的所有组合吗？如果您愿意，您可以以更智能的方式枚举所有元素，但如果您只想在每个数组中至少存在一次的所有元素，您可以在下面的输出中使用 Unix 命令“grep -v 0”，这将显示你是所有数组共有的所有元素的交集。您的问题缺少一些细节，因此我无法完美地实施解决您问题的方法。

如果你做的数据分析多于编程，那么脚本对于从文本数据中提出问题非常有用。如果您不知道如何使用这样的脚本语言编写代码，我会花一两个月时间阅读有关如何使用 Perl、Python 或 Ruby 编写代码的文章。它们对于像这样的一次性黑客来说非常棒，尤其是在你不知道自己想要什么的情况下。编写这样一个程序的时间和大脑成本非常低，因此（如果你速度很快）你可以编写并重新编写多次，同时仍在探索你的问题的定义。

```
#!/usr/bin/perl -w

use strict;

my @Array1 = ( "Do", "Re", "Mi", "Fa", "So", "La", "Ti");
my @Array2 = ( "Mi", "Fa", "Jim", "Bob", "So" );
my @Array3 = ( "Jim", "Bob", "So", "La", "Ti" );

my %counts;
sub count_array {
    my $array = shift;
    my $name  = shift;
    foreach my $e (@$array) {
        $counts{$e}{$name}++;
    }
}

count_array( \@Array1, "Array1" );
count_array( \@Array2, "Array2" );
count_array( \@Array3, "Array3" );

my @names = qw/ Array1 Array2 Array3 /;
print join ' ', ('element',@names);
print "\n";

my @unique_names = keys %counts;
foreach my $unique_name (@unique_names) {
    my @counts = map {
        if ( exists $counts{$unique_name}{$_} ) {
            $counts{$unique_name}{$_};
        } else {
            0;
        }
    }
    @names;

    print join ' ', ($unique_name,@counts);
    print "\n";
} 
```

该程序的输出是：

```
element Array1 Array2 Array3
Ti 1 0 1
La 1 0 1
So 1 1 1
Mi 1 1 0
Fa 1 1 0
Do 1 0 0
Bob 0 1 1
Jim 0 1 1
Re 1 0 0 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-27T13:56:05.610

看起来您想对数据集使用交集函数。交集挑选出两个（或更多）集合中共有的元素。

这个观点的问题是集合不能包含超过一个元素，即每个集合不超过一个 Jim，它也不能识别一行中的多个元素作为模式，但是您可以修改比较函数以进一步查看看到这一点。

有一些像 intersect 这样的函数适用于包（这有点像集合，但容忍相同的元素）。

这些函数在大多数语言中应该是标准的，或者很容易自己编写。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-27T14:08:57.303

我敢肯定有一种更优雅的方式，但是......

既然这不是生产代码，为什么不直接修改它并将每个数组转换为分隔字符串，然后在每个字符串中搜索您想要的模式？IE

```
 private void button1_Click(object sender, EventArgs e)
        {

            string[] array1 = { "do", "re", "mi", "fa", "so" };
            string[] array2 = { "mi", "fa", "jim", "bob", "so" };
            string[] pattern1 = { "mi", "fa" };
            MessageBox.Show(FindPatternInArray(array1, pattern1).ToString());
            MessageBox.Show(FindPatternInArray(array2, pattern1).ToString());

        }

        private bool FindPatternInArray(string[] AArray, string[] APattern)
        {
            return string.Join("~", AArray).IndexOf(string.Join("~", APattern)) >= 0;
        } 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-27T14:19:23.117

首先，从计算每个项目开始。您制作了一个临时列表：“Do” = 1、“Mi” = 2、“So” = 3 等。您可以从临时列表中删除所有匹配 = 1 的列表（例如：“Do”）。临时列表包含非唯一项目的列表（将其保存在某处）。

现在，您尝试从临时列表中的一个和原始列表中的后续列表中创建两个列表。“So” + “La” = 2、“Bob” + “So” = 2 等。删除 = 1 的那些。你有至少出现两次的情侣列表（保存在某处）。

现在，尝试列出 3 个项目，从临时列表中获取一对，并从原始列表中获取以下内容。("Mi", "Fa") + "So" = 1, ("Mi", "Fa") + "Jim" = 1, ("So", "La") + "Ti" = 2 去掉那些with = 1。您有至少出现两次的 3 个项目的列表（保存它）。

然后你继续这样，直到临时列表为空。

最后，您获取所有已保存的列表并将它们合并。

这个算法不是最优的（我认为我们可以用合适的数据结构做得更好），但它很容易实现:)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-28T06:56:20.947

假设密码由来自英文字母表的九个字符（26 个字符）组成。如果可以在一毫秒内测试每个可能的密码，那么测试所有可能的密码需要多长时间？

# svn - 如何在客户端机器上使用 SVNLook 功能

> ID：483436
> 
> 赞同：1
> 
> 时间：2009-01-27T13:46:31.777
> 
> 标签：svn, msbuild, teamcity

全部

我希望使用 Exec 命令从我的 MSbuild 脚本中调用 svnlook 命令行，但是我阅读的所有文档似乎都表明这只能在拥有存储库本身的机器（即服务器）上运行。

有谁知道我如何从客户端机器访问此功能，是否有用于调用此功能的客户端包装器（即 svn log 和 svn info 的组合）？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T16:45:43.850

svnlook 直接在存储库数据库上工作。该数据库在客户端计算机上不可用（通常，除非您通过 file:/// 访问存储库）。所以没有办法使用svnlook。

您可以使用 svn 客户端获取大部分信息。

你没有提到你想要什么信息，但我建议使用

```
svn log
svn diff
svn info 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-09-01T22:37:58.053

svn log -rev 'head' -v url

这显示了来自 svnlook 的类似 dirs_changed

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-07-07T09:49:58.813

```
svn merge –dry-run -r BASE:HEAD . 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-02-21T15:08:23.830

我使用简单的脚本`svn-report.sh`来获取修订间隔的更改（不带参数的运行脚本返回最新修订）：

```
#!/bin/bash
# Reports SVN commits from version (parameter1) to version (parameter2)

if [ "$#" = "2" ]; then
    echo "SVN commits for versions" $1 "till" $2
    for (( i=$1; i<=$2; i++ ))
    do
        svn log -r $i -v
        echo ""
    done
else
    echo "Usage: svn-report [from earlier revision number] [to latest revison number]"
    echo "Example: ./svn-report.sh 30 35"
    echo "Latest revison is:"
    svn log -r head
fi 
```

# git - 当您的原始存储库在 Git 中时，如何从 svn 部署

> ID：483437
> 
> 赞同：7
> 
> 时间：2009-01-27T13:46:40.840
> 
> 标签：git, svn

我的团队使用 Git 进行开发，充分利用了它的许多功能。我们使用 git 和 svn 的效率明显更高。

然而，我们当前的客户希望我们从 svn 存储库部署代码，这意味着我们需要以某种方式定期将代码从 git 移动到 svn。

目前我们正在维护一个既是 svn checkout 又是 git repo（包含 .git 等）的目录，然后我们可以执行 git pull；svn 提交

当然，这个过程有点复杂，因为我们想使用标签来记录发布点，并且在 git 创建的文件上运行 svn add 会产生开销。

做这个的最好方式是什么？

git-svn 能解决这个问题吗？除了允许单个开发人员在使用 SVN 存储库时在本地使用 git 工具之外，我从未见过它被使用过。我不知道它与在多个分支上工作的多个开发人员一起工作的效果如何......

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-27T14:15:15.387

如果一个人被认为是 SVN 的所有代码的集成者，并且您知道没有其他人为 SVN 存储库做出贡献，您可以让他`git-svn`用来推动更改：

1.  Integrator 使用他`master`作为 svn 的跟踪分支（例如 git svn clone $REPO）。 **他从不在这个分支上工作**
2.  开发人员正常工作（大概在主题分支上，有一些主线集成分支）
3.  当您想要发布时，集成商会将所有开发人员代码拉到他的主分支（不是`master`，而是类似的东西`integration`）
4.  Integrator 尽一切努力确保发布顺利进行
5.  积分器`integration`与他的合并`master`
6.  集成商可以`git svn dcommit`

如果其他人为 SVN 做出贡献，您仍然可以这样做，但集成商必须定期从 SVN 中提取这些更改并将这些更改提供给开发人员，以避免合并冲突。

无论如何，将代码轻松导入 SVN 是主要问题。您可以在没有本地结帐的情况下在 SVN 中标记和分支，因此集成商可以进行标记（不确定是否`git svn`会将标记发送到 SVN）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T17:04:41.503

davetron5000 的回答可能基本上就是你想要的。不过，设置它会有一个技巧。如果您设置了集成器树，以便它具有 svn 存储库的遥控器和原始 git 树的遥控器，我怀疑 git 不会将它们识别为相关的。您可能需要设置一个移植文件，向 git 解释他们有一个共享的历史记录。否则合并总会有冲突。

这篇文章看起来可能有助于弄清楚如何正确设置它，[使用 git grafts 来恢复 svn merge history](http://community.livejournal.com/evan_tech/255341.html)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-01-06T21:24:12.690

> 当前客户希望我们从 svn 存储库部署代码...

...您能否通过从 GIT 存储库进行所有开发并运行构建脚本来检查构建到 Subversion 的快照来满足该要求？

如果是这样，那么这将对依赖于 Subversion 存储库中的代码的现有构建脚本进行最小的更改。它使用 svn 客户端访问 Git

```
> svn co https://github.com/restOfProjectURL/tags/BUILD-TAG-JAN-1-2015 
```

或者

```
> svn co https://github.com/restOfProjectURL/branches/DEV-BRANCH-FIXES 
```

如果您的构建脚本包含此检查（或类似内容）以创建本地工作目录，然后从那里部署，从技术上讲，您是从 Subversion 部署的，您可以利用 Git 进行其他所有操作。

（这是在[https://help.github.com/articles/support-for-subversion-clients/](https://help.github.com/articles/support-for-subversion-clients/)的帮助下）

# php - Internet Explorer 8 不会为 ajax 请求传递会话 cookie

> ID：483445
> 
> 赞同：6
> 
> 时间：2009-01-27T13:48:06.720
> 
> 标签：php, ajax, internet-explorer, session

我有一个简单的 php 应用程序，它适用于除 IE8 beta 2 之外的所有浏览器，当我尝试使用 Ajax 调用（jQuery post 方法）更新表字段时出现问题。使用 IE8 调试器我发现 IE8 不发送会话 cookie，因此 php 脚本重定向到登录页面而不是执行请求的操作。

我能做些什么来完成这项工作。

编辑：我没有提到我正在使用 Code Igniter，所以我通过将 Code Igniter 默认会话实现替换为原生会话实现来解决了这个问题。代码点火器默认会话实现使用 cookie 来存储所有数据。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-05-18T06:59:18.097

昨天我遇到了类似的问题并找到了解决方案。我希望这对其他人也有帮助。

**问题：**假设其中有一个网站**www.somewebsite.com和 IFRAME，它从我的服务器****www.myserver.com/welcome.php**加载 php 文件。网站和我的欢迎页面都加载成功，它显示了“Hello Bob”之类的内容，因此它成功找到了用户并让他登录。

之后我的 JavaScript 对另一个 PHP 文件进行 AJAX 调用，响应处于“未授权”状态，因此 SESSION 数据完全丢失。页面刷新后，一切正常。这仅在 IE8 下发生！

我认为问题在于将会话 cookie 发送到服务器，但是当我安装[Fiddler](http://www.fiddler2.com/fiddler2/)时，我发现 IE8 正在正确发送 cookie 以及 PHPSESSID，但服务器有点无法检测到正确的 SESSION 对象。另一个奇怪的事情是第二次服务器发送了以下标头：

**P3P: CP="IDC DSP COR ADM DEVi TAIi PSA PSD IVAi IVDi CONi HIS OUR IND CNT"**

但第一次没有。在 PHP 脚本中手动添加该标题后，一切都像魅力一样！

然后，当我用谷歌搜索“p3p abracadabra”时，我发现了以下网站：

[http://adamyoung.net/IE-Blocking-iFrame-Cookies](http://adamyoung.net/IE-Blocking-iFrame-Cookies)

**结论：**确保您在设置 cookie 的每个页面上都发送标头。

这**不仅**与**IE8 + PHP组合有关，在****IE8 + ASP.NET**、**IE8 + JSP**等情况下也会出现同样的问题。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-04T16:36:49.717

我自己没有 IE8，但您的 cookie 可能会被 Internet Explorer 奇怪的安全策略阻止。一种可能的解决方法是使用[P3P](http://en.wikipedia.org/wiki/P3P)（这也是让 cookie 在 IFRAME 中工作的方法）。

生成正确的 P3P 策略可能需要一些工作，但您应该能够在[http://www.p3ptoolbox.org/找到所需的信息](http://www.p3ptoolbox.org/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T17:51:00.943

我在 IE8 RC1 中遇到了同样的问题：

1）用户进入登录页面并设置了空白会话 cookie
2）用户登录并设置了经过验证的会话 cookie，javascript 打开一个新窗口并关闭当前窗口。
3) 新窗口打开并包含一个空白会话 cookie。
4）用户被重定向到登录页面

我更改了第 1 步，因此未设置空白 cookie - 如果会话 cookie 被验证，我只会发送它。这解决了我的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-07T17:19:13.867

我无法让 IE8 使用 SSL 证书 (PK12) 文件作为授权手段。如果我想保护目录并在授予访问权限之前强制在浏览器中显示匹配的 Web 证书。它适用于 IE7 和所有版本的 Mozilla - 只是不适用于 IE8。它使我妻子的听写系统变得毫无用处。我注意到的另一件事是，当它设置 PHPSESSID cookie 时，它​​将域列为 .net 而不是 mydomain.net。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2009-01-27T14:13:00.507

作为一种解决方法，您可以将 SessionID 作为参数嵌入到 uri 中。

请参阅php 手册中的[传递会话 ID](http://ca2.php.net/manual/en/session.idpassing.php)。

# asp.net - IIS重新启动时如何返回同一页面？

> ID：483453
> 
> 赞同：0
> 
> 时间：2009-01-27T13:50:30.443
> 
> 标签：asp.net, iis

假设我已经登录到一个 Web 应用程序。我在页面 Default.aspx 上。如果 iis 重新启动，那么我需要重新登录才能使用该应用程序。

如果 IIS 重新启动，是否可以返回同一页面？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T13:53:58.800

你如何验证你的用户？使用表单身份验证会存储一个客户端 cookie，该 cookie 可以在 IIS 重置后继续存在。您是否在会话状态中存储任何身份验证信息？

# 编辑

只是为了添加，您还可以将用户重定向到与登录页面不同的页面。采取以下网址`http://example.com/Login.aspx?ReturnUrl=%2fDefault.aspx`。

此 URL 可用于在用户登录后将其重定向到 Default.aspx 页面。假设您使用 Forms 身份验证，则可以使用 FormsAuthentication.RedirectFromLoginPage(userName, false); 重定向它们 false 参数可防止创建持久性 cookie。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T13:55:42.803

如果您在用户访问的每个页面上设置一个 cookie，说明他们在哪个页面上，那么在您的 OnLoggedIn 事件中，您可以检查此 cookie 的存在，并将用户重定向到该页面 - 我们使用类似的循环机制一次登录多个域。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T06:15:02.640

如果您的意思是 ASP.Net 应用程序域回收，那么您的问题是您正在丢失会话状态数据，对吗？如果是这样，那么将会话数据存储在 StateServer 或 SQL Server 中怎么样？默认值为“处理中”，因此当应用程序域回收时它会被清除。

# linux - 如何像 Nautilus 那样从命令行挂载？

> ID：483460
> 
> 赞同：41
> 
> 时间：2009-01-27T13:51:23.733
> 
> 标签：linux, gnome, mount

在我的 Ubuntu linux 机器上，我可以轻松地安装 USB 连接的驱动器或 CDROM，单击桌面上的设备图标。

例如，如果我单击 USB 连接的驱动器图标，则会发生以下情况：

*   自动创建 /media/LABEL 目录（其中 LABEL 是磁盘的标签，可能因磁盘而异）
*   设备上的文件系统安装在 /media/LABEL

`mount`这个过程与使用命令挂载有很大不同。尤其：

*   你不需要是root（或者你不需要修改/etc/fstab来允许普通用户挂载设备）
*   /media/LABEL 目录是自动创建的
*   目录的名称根据卷标而改变。

有一个命令行命令的行为类似于 Gnome GUI 安装工具吗？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2011-05-12T11:04:14.567

您正在寻找的是`gio mount`（它最近被替换`gvfs-mount`，它被替换`gnome-mount`）。

这里有一个[手册页，](http://manpages.ubuntu.com/manpages/disco/man1/gio.1.html)或者您可以输入`gio help mount`详细信息

基本用法是：

`gio mount --list --detail`获取已安装和可安装卷的列表

`gio mount [-u] <volume>`[un] 挂载它，例如`gio mount smb://server/share`or `gio mount WINDOWS`。

可悲的是，似乎有一个错误导致“错误安装位置：卷未实现安装”消息尝试按卷名安装，但`gvfs-mount -d /dev/<devicename>`可能有效。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2013-01-26T11:01:58.337

在现代发行版中，不再使用 HAL。`pmount`仍然存在，但已被弃用。采用：

```
udisks --mount /dev/sdXN 
```

## 答案更新：

该`udisksctl`命令被用作该命令的替代品`udisks`。这可以使用相同的方式，`-b`只是被附加来定义块设备。

```
udisksctl mount -b /dev/sdXN 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-01-27T13:56:58.277

[`pmount`](http://manpages.ubuntu.com/manpages/natty/man1/pmount.1.html)有关使用信息，请参阅命令

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-29T19:21:31.940

就在这里。它被称为[ivman](http://ivman.sourceforge.net/)并处理所有 HAL 事件。我在运行[ion3](http://www.modeemi.fi/~tuomov/ion/)时启动它。我只是从`ivman`一个守护进程开始，但已将该程序添加到我的 sudoers 文件中：

```
cat /etc/sudoers
[...]
ivman {hostname}=(root) NOPASSWD: /sbin/init, /usr/sbin/hibernate
[...] 
```

这样它也可以管理电源设置。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T14:01:56.007

我不相信 Gnome 本身会处理安装——它是 HAL。因此，如果 HAL 正在运行，您应该能够自动挂载。我假设`pmount`以某种方式与 HAL 对话，这将是处理卸载的方法。我希望这至少能让你开始。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-29T19:26:13.987

您还可以使用 gnome-mount 从命令行挂载/卸载。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-29T19:50:30.740

我插入我的 USB 设备，输入“gnome-volume-manager”，这似乎符合您的要求。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-12-26T12:18:31.907

那将是“ `devkit-disks --mount /dev/sdxx`”，`xx`要挂载的分区的字母和编号在哪里...

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-11-02T01:46:44.113

我有一个脚本可以做你想做的事。

```
#!/bin/bash
#====================================================================
# udmount.sh - mounts partitons by volume label.
#  usage: udmount.sh <label> [rw|ro|u]
#   rw - mount read-only (default) 
#   rw - mount read-write 
#   u  - unmount
# 
# Mounts on /media/<label>. Tested on Mint 13 and Fedora 19.
# Use and/or modify at your own risk. Your mileage may vary.
# Caveats:
#   * No spaces in volume label. Won't work.
#   * If the mount point (/media/<label>) already exists,
#     (usually from an unclean shutdown), udmount will mount
#     the volume on /media/<label>_  
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You can view the GNU General Public License for this program at
# http://www.gnu.org/licenses/gpl.txt
# Copyright 2013 maxdev137@sbcglobal.net
#====================================================================

BEEP=$'\a'
VLABEL="$1"     # volume label
MPOINT="/media" # default mount point for gnome-mount/udisks
YN=""           # yes/no string

c_red() { echo -n $(tput setaf 1)$1$(tput sgr0) ; }
c_grn() { echo -n $(tput setaf 2)$1$(tput sgr0) ; }
c_yel() { echo -n $(tput setaf 3)$1$(tput sgr0) ; }
c_blu() { echo -n $(tput setaf 4)$1$(tput sgr0) ; }
c_pur() { echo -n $(tput setaf 5)$1$(tput sgr0) ; }
c_aqu() { echo -n $(tput setaf 6)$1$(tput sgr0) ; }
c_wht() { echo -n $(tput setaf 7)$1$(tput sgr0) ; }

Y="YEP " ; Y_c=$(c_grn "$Y")
N="NOPE" ; N_c=$(c_red "$N")
SNAME=`echo "$0" | sed -e 's|.*/\(.*\)$|\1|'`

#--------------------------------------------------
AMV_LABEL=""    # already mounted volume label
MMSG=""         # "is mounted on" msg
AMF=0           # already mounted flag
AMV=""          # already mounted volume (from "mount -l")
AMV_DETAILS=""  # already mounted volume details
AMV_HELPER=""   # "uhelper" subsystem for mount/unmount ("hal" or "udisks")
COPT="$2"       # command line option
MOPT="ro"       # user input for mount option
UOPT="ro"       # udisk mount options

#--------------------------------------------------
_usage ()      { echo "usage: $SNAME LABEL [rw|ro|u]" ; }
_error()       { echo "!!! Error: $1\. !!!" >&2 ; echo -n "$BEEP"; _usage ; exit 1 ; }
_error_parm()  { _error "$2 Parameter Missing [$1]" ; }
_error_parm2() { _error "Command is wrong (only \"rw, ro, or u\") is alowed, not \"$1\"" ; }

_unmount () {
  ### unmount ###
  if [ "$COPT" = "u" ] ; then
    MPOINT=`echo "$AMV" | grep "\[$VLABEL\]" |sed -e 's|^.* \(/.*\) type.*$|\1|'`
    #echo "unmount MPOINT = [$MPOINT]"
    if [ -z "$MPOINT" ] ; then
      echo "$N_c - $VLABEL not mounted."
    else
      _MSG=`umount "$MPOINT" 2>&1`
      _STATUS=$?
      if [ "$_STATUS" -eq 0 ] ; then
        echo "$Y_c - \"$MPOINT\" is now unmounted"
      else echo "$N_c - unmount \"$MPOINT\" failed ($_MSG)"
      fi
    fi
  fi
}

#--------------------------------------------------
[ -n "$VLABEL" ]  || _error_parm "$VLABEL" "Volume Label"

### command line option checck
case "$COPT" in
  "ro" ) ;;
  "rw" ) ;;
  "u"  ) ;;
     * ) _error_parm2 "$COPT" ;;
esac

### is VLABEL already mounted?
AMV=$(mount -l | grep "\[$VLABEL\]")
AMF=$?

### VLABEL is mounted somewhere
if  [ $AMF -eq 0 ] ; then
  AMV_LABEL=$(echo "$AMV" | sed 's/^.* \[\(.*\)\]$/\1/')
  AMV_DETAILS=$(echo $AMV | sed 's|^.*on \(.*\) \[.*$|on \"\1\"|')
  AMV_UHELPER=$(echo $AMV | grep uhelper | sed 's/^.*uhelper=\(.*\)).*$/\1/')
  #echo "AMV = [$AMV]"
  #echo "AMV_LABEL = [$AMV_LABEL]"
  #echo "AMV_DETAILS = [$AMV_DETAILS]"
  #echo "AMV_UHELPER = [$AMV_UHELPER]"

  ### unmount ###
  [ "$COPT" = "u" ] && _unmount && exit $?

  ### mounted on MPOINT (usually /media)
  if [ -d "$MPOINT/$VLABEL" ] ; then
    MOPT="ro" ; YN="$N_c"
    [ -w "$MPOINT/$VLABEL" ] && MOPT="rw"
    [ "$MOPT" = "$COPT" ]     && YN="$Y_c"
  ### mounted somewhere else
  else
    MOPT=$(echo "$AMV_DETAILS" | sed 's/^.*(\(.*\)).*$/\1/')
  fi
  echo "$N_c - $VLABEL is already mounted \"$MOPT\" $AMV_DETAILS"

### $VLABEL is not mounted anywhere, decide on "rw" or "ro"
else
  if [ "$COPT" = "u" ] ; then
    echo "$N_c - \"$VLABEL\" is not mounted"
  else
    MOPT="ro"
    [ "$COPT" = "rw" ] && MOPT="rw"
    echo "udisks --mount /dev/disk/by-label/$VLABEL $UOPT"
    udisks --mount /dev/disk/by-label/"$VLABEL" --mount-options "$MOPT"
    _STATUS=$?
    [ $_STATUS -eq 0 ] && echo "$Y_c - $MPOINT/$VLABEL mounted ($MOPT)"
    [ $_STATUS -ne 0 ] && echo "$N_c - \"$VLABEL\""
  fi
fi
#==================================================================== 
```

# visual-studio-2008 - 1.1 专用机器上的解决方案——如何最好地移动它？

> ID：483462
> 
> 赞同：1
> 
> 时间：2009-01-27T13:51:49.537
> 
> 标签：visual-studio-2008, migration, .net-1.1

我们有一个使用 VS2003 和 Dot Net 1.1 需要偶尔维护的旧项目。它位于一台已成为“专用”机器的机器上，因为没有人想弄乱它。我们需要将这台机器用于其他目的——所以我试图将它转移到另一台计算机上，尽可能减少麻烦。

我已经考虑为它创建一个虚拟机——因为我不需要 VS2003（VS2008 在所有其他机器上）或组件（我们使用 Devex、Infragistics 和其他一些卡在这个系统上的旧版本上的组件）。我应该能够追踪各种组件以进行重新安装 - 但不喜欢这个概念。有没有人听说过从现有的 Windows 安装创建 VM？还有其他选择吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T13:58:55.717

这可能是您正在寻找的：[VMware vCenter 转换器](http://www.vmware.com/products/converter/)

> 将物理机转换为虚拟机——免费！

还有一个稍微[相关的教程](http://www.howtoforge.com/vmware_converter_windows_linux)..

# algorithm - 仅通过公共交通找到最佳路线的策略？

> ID：483488
> 
> 赞同：47
> 
> 时间：2009-01-27T14:00:59.750
> 
> 标签：algorithm, optimization, data-structures

查找汽车的路线非常容易：您存储所有道路的加权图，并且可以使用[Djikstra 算法](http://en.wikipedia.org/wiki/Djikstra%27s_algorithm)[1]。公交路线不太明显。对于公共汽车，您必须表示诸如“等待 10 分钟等待下一班车”或“步行一个街区到另一个公共汽车站”之类的内容，并将其输入到您的寻路算法中。

对于汽车来说，这甚至并不总是那么简单。在一些城市，有些道路早上单向进城，晚上单向出城。一些先进的 GPS 知道如何在高峰时段避开繁忙的路线。

您将如何有效地表示这种与时间相关的图并找到路线？不需要可证明的最佳解决方案；如果旅行者想准时到达，他们会买一辆车。;-)

[1] 一个很棒的算法可以在一个例子中提及，因为每个人都听说过它，尽管 A* 是这个应用程序的一个更可能的选择。

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-02-18T00:53:30.067

我参与了瑞典斯德哥尔摩公共交通的一个行程规划系统的开发。它基于 Djikstra 算法，但在访问系统中的每个节点之前终止。今天，当每个站点都有可靠的坐标可用时，我想 A* 算法将是选择。

有关即将到来的流量的数据定期从多个数据库中提取，并编译成加载到我们的搜索服务器集群内存中的大表。

成功算法的一个关键是使用基于旅行和等待时间乘以不同权重的路径成本函数。在瑞典语中称为“kresu”时间，这些加权时间反映了这样一个事实，例如，一分钟的等待时间在“不便”方面通常等同于两分钟的旅行时间。

## KRESU 重量表

*   x1 - 旅行时间
*   x2 - 在停靠站之间行走
*   x2 - 在旅途中的停靠站等候。屋顶下的车站、商店等可以稍微降低权重，而拥挤的车站则更高，以调整算法。
*   第一站等待时间的权重是交通强度的函数，可以在 0.5 到 3 之间。

## 数据结构

**区域** 您可以开始或结束旅程的指定区域。一个巴士站可能是一个有两个站的区域。具有多个站台的较大车站可能是一个区域，每个站台只有一个站点。数据：名称、所在区域

**站点 包含所有公共汽车站、火车站和地铁站的阵列**。**请注意，您通常需要两个站点，每个方向一个站点，因为过马路或步行到另一个平台需要一些时间。数据：名称、链接、节点**

 ****链接** 您可以从该站点步行到达的其他站点列表。数据：其他站点，步行到其他站点的时间

**线路/旅游** 您在公共汽车上有一个号码和一个目的地。巴士从一站出发，在前往目的地的途中经过几个站。数据：号码、姓名、目的地

**节点** 通常你有一个时间表，它应该在巡回赛的第一站和最后一站的时间最短。每次公共汽车/火车经过车站时，您都会向数组添加一个新节点。该表每天可以有数百万个值。数据：线路/行程、停靠点、到达时间、出发时间、误差范围、行程中的下一个节点

**搜索** 数组，其大小与用于存储您到达那里的方式和路径成本的节点数组相同。数据：与前一个节点的反向链接（如果节点未访问，则不设置），路径成本（未访问的无限）

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-01-27T17:40:23.520

您所说的比可以用图形等简单数据结构和 Djikstra 等“简单”算法描述的数学模型更复杂。您所要求的是一个更复杂的问题，例如在自动化物流管理领域中遇到的问题。

一种思考方式是，您要问的是一个多维问题，您需要能够计算：

1.  距离优化
2.  时间优化
3.  路线优化
4.  “时间范围”优化（如果是 5:25 并且公交车只在 7:00 出现，请选择另一条路线。）

鉴于所有这些情况，您可以尝试使用复杂的多层数据结构进行确定性建模。例如，您仍然可以使用加权有向图来表示现有的潜在路线，其中每个节点还包含一个有限状态自动机，它根据时间值向路线添加权重偏差（因此通过在 5:25 穿越节点你得到的值与你的模拟在 7:00 越过它时不同。）

但是，我认为此时您会发现自己的模拟越来越复杂，当建议转移到现实世界时，它很可能无法提供最佳路线的“很好”近似值。事实证明，当遇到现实世界的混沌行为和动态时，软件和数学建模和仿真充其量只是一个薄弱的工具。

我的建议是使用替代策略。我会尝试使用遗传算法，其中个体的 DNA 计算出一条潜在的路线，然后我会创建一个适应度函数，它以更“易于维护”的查找表方式编码成本和权重。然后我会让遗传算法尝试为公共交通路线查找器收敛到一个接近最优的解决方案。在现代计算机上，像这样的 GA 可能会表现得相当好，并且它应该至少对现实世界的动态性相对稳健。

我认为大多数做这种事情的系统都采取“简单的方法”，简单地做一些类似 A* 搜索算法的事情，或者类似于贪婪成本加权有向图步行的事情。要记住的是，公共交通的用户自己并不知道最佳路线*是*什么，因此 90% 的最佳解决方案对于一般情况来说仍然是一个很好的解决方案。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-17T23:48:40.003

公共交通领域需要注意的一些数据点：

1.  在骑手的脑海中，每次转移都会受到 10 分钟的罚款（除非是定时转移）。也就是说，从心理上来说，单次公交车40分钟的行程大致相当于30分钟的换乘行程。
2.  大多数人愿意步行到公共汽车站的最大距离是 1/4 英里。火车站/轻轨约 1/2 英里。
3.  距离与乘坐公共交通工具的人无关。（只有时间很重要）
4.  频率很重要（如果错过了一个连接，直到下一班车多长时间）。如果替代方案在下一班快车上滞留一小时，乘客会更喜欢更频繁的服务选择。
5.  铁路比公共汽车有更高的偏好（更有信心火车会朝正确的方向前进）
6.  不得不支付新的票价是一个很大的打击。（增加约 15-20 分钟的罚款）
7.  总行程时间也很重要（有上述处罚）
8.  连接有多无缝？骑手是否必须存在穿过繁忙街道的火车站？还是只是下火车，步行 4 步到公共汽车？
9.  穿过繁忙的街道 - 转移的另一个重大处罚 - 可能会因为无法足够快地穿过街道而错过连接。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-16T18:52:28.713

如果行程的每一段的成本是按时间衡量的，那么唯一的复杂因素就是考虑时间表 - 这只是将每个节点的成本更改为当前时间 t 的函数，其中 t 只是总行程时间，所以远（假设时间表被标准化为从 t=0 开始）。

因此，节点 A 的成本不是 10 分钟，而是 f(t) 的成本定义为：

*   t1 = nextScheduledStop(t); // 在时间 t 或之后获取下一个停止时间
*   baseTime for leg = 10 //例如 10 分钟的行程
*   返回 (t1-t)+baseTime

因此，等待时间动态包含在每条腿的成本中，并且在公交车站之间的步行只是具有恒定时间成本的弧线

使用这种表示，您应该能够直接应用 A* 或 Dijkstra 算法

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-12T20:45:00.610

> 查找汽车路线非常简单：您存储所有道路的加权图，然后可以使用 Djikstra 算法。公交路线不太明显。

这可能不太明显，但现实情况是，这只是汽车问题的另一个维度，加上无限成本计算。

例如，您将时间已过的公共汽车标记为具有无限成本 - 然后它们不包括在计算中。

然后，您可以决定如何加权每个方面。

转运时间可能会加权 1 等待时间可能会加权 1 转移可能会加权 0.5（因为我宁愿早点到达那里并进行额外的转移）

然后，您使用任何常用的成本算法并加上无限成本来计算图中的所有路线：

每次沿着边缘移动时，您都必须跟踪“当前”时间（将运输时间相加），如果您到达一个向量，您必须为当前时间之前的任何公共汽车分配无限成本。当前时间增加了该向量处的等待时间，直到下一辆公共汽车离开，然后您可以自由地沿着另一条边移动并找到新的成本。

换句话说，有一个新的约束条件，“当前时间”，它是第一辆公共汽车开始的时间，加上所有公共汽车的过境和等待时间以及所行驶的站点。

它使算法稍微复杂了一点，但算法还是一样的。您可以看到大多数算法都可以应用于此，有些可能需要多次通过，而有些则无法工作，因为您无法在线添加时间-->无限成本计算。但大多数应该工作得很好。

您可以通过简单地假设公共汽车按计划运行来进一步简化它，并且总是有另一辆公共汽车，但这会增加等待时间。算法是否只增加过境成本，然后再次遍历树并根据下一辆公共汽车何时到来添加等待成本。它有时会导致效率较低的版本，但即使是大城市的总图实际上也很小，所以这不是一个真正的问题。在大多数情况下，一两条路线将是明显的赢家。

谷歌有这个，但也包括从一个公共汽车站步行到另一个的额外优势，因此如果您愿意在拥有大型公共汽车系统的城市中行走，您可能会找到一条更理想的路线。

-亚当

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-14T16:18:56.380

我对这个问题的看法是，最终你试图优化从起点到终点的平均速度。特别是，如果[好]不挡路可以节省时间，那么您根本不关心行驶的总距离。因此，解决方案空间的一个基本部分将需要确定有效的可用路线，以在起点和终点之间以相对较高的速度覆盖总距离的重要部分。

就您最初的观点而言，GPS 导航单元用于驾车旅行的典型汽车路线算法是目标最佳总时间和最佳路线评估的良好界限。换句话说，您的基于巴士的旅行将非常适合采用基于汽车的解决方案。显然，基于公交路线的系统将比基于汽车的解决方案有更多的限制，但是以汽车解决方案作为参考（时间和距离）为公交算法提供了一个框架来优化*。因此，松散地说，您希望以迭代方式将汽车解决方案转变为可能的总线解决方案集，或者更有可能采用可能的总线解决方案并将它们与基于汽车的解决方案进行评分，以了解您是否做得“好” .

让这一点更具体一点，对于特定的出发时间，在任何合理的时间内只有有限数量的公共汽车可以覆盖您总距离的很大一部分。基于直接的汽车分析*，合理的时间段*和*相当大的距离百分比*可以使用一些温和的主观指标来量化。当然，在更绝对的意义上对每种可能性相对于另一种可能性进行评分变得更容易。

一旦您在解决方案中获得了一组可能的主要部分作为可能的答案，您就需要将它们与其他可能的步行和等待路径联系在一起......或者如果相距足够远，则递归选择额外的短途公交车. *直觉上，由于约束悖论*（见下面的脚注），这里似乎并没有真的会有一组令人望而却步的选择。即使你不能从那里暴力破解所有可能的组合，剩下的应该能够使用[模拟退火](http://en.wikipedia.org/wiki/Simulated_annealing)(SA) 类型的算法进行优化。[蒙特卡洛方法](http://en.wikipedia.org/wiki/Monte_Carlo_method)将是另一种选择。

我们将问题分解到这一点的方式给我们留下了一些非常类似于 SA 算法如何应用于 ASIC 芯片、FPGA 的自动布局和布线以及印刷电路板的布局和布线的东西。关于优化这种类型的问题形式的[已发表](http://portal.acm.org/citation.cfm?id=317825.317977)的相当多的工作。

** 注意：我通常将此称为“约束悖论”——我的术语。虽然人们自然会认为受约束的问题更难解决，但约束减少了选择，而选择越少意味着更容易暴力破解。当您可以蛮力时，即使是最佳解决方案也是可用的。*

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-27T14:26:26.410

基本上，图表中的一个节点不仅应该代表一个位置，还应该代表你可以到达那里的最早时间。您可以将其视为（地点，时间）空间中的图形探索。此外，如果您有 (place, t1) 和 (place,t2) 其中 t1<t2，则丢弃 (place,t2)。

从理论上讲，这将从您的起始节点获得所有可能目的地的最早到达时间。在实践中，您需要一些启发式方法来修剪使您远离目的地的道路。

您还需要一些启发式方法来在不太有希望的路线之前考虑有希望的路线 - 如果一条路线远离您的目的地，它不太可能（但并非完全不可能）是好的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-07-21T11:38:47.290

我认为您的问题比您预期的要复杂。最近的 COST 行动专注于解决这个问题： http: [//www.cost.esf.org/domains_actions/tud/Actions/TU1004](http://www.cost.esf.org/domains_actions/tud/Actions/TU1004)：“智能交通系统时代的公共交通客流建模”。

从我的角度来看，常规的 SPS 算法不适合这个。您有动态的网络状态，其中某些向前行驶的选项是不连续的（对于汽车、自行车、行人，路线始终“开放”，而公交连接仅在特定停留时间可用）。

我认为这里需要新的多标准（时间、可靠性、成本、舒适度和更多标准）方法。它需要实时计算以 1）在短时间内向最终用户发布信息 2）能够实时调整路径（基于实时交通状况 - 来自 ITS）。

我将在接下来的几个月里考虑这个问题（甚至可能在整个博士论文中）。

问候拉法尔

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-27T14:53:26.883

我不认为有任何其他特殊的数据结构可以满足这些特定需求，但您仍然可以使用像链表这样的普通数据结构，然后根据给定因素进行路线计算——您将需要某种输入到您的影响结果的变量的应用程序，然后根据输入进行相应的计算。

至于等待和其他东西，这些都是与特定节点相关的因素，对吧？您可以将此因素转换为连接到节点的每个分支的路由节点。例如，您可以说对于来自节点 X 的每个分支，如果在节点 X 上等待 m 分钟，则将分支的权重按 [m/Some base value*100]% 扩大（只是一个示例）。通过这种方式，您统一考虑了其他因素，但同时保持了您想要解决的问题的简单表示。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-28T01:45:49.687

如果我要解决这个问题，我可能会从带注释的图表开始。图表上的每个节点将代表城市中的每个十字路口，无论公共交通系统是否停在那里 - 这有助于说明步行的需要等。在有交通服务的十字路口，您可以使用停止标签来注释这些 - 标签允许您可以查找站点的服务时间表。

然后你就可以做出选择了。您需要最好的路线，还是仅仅需要一条路线？您是实时显示路线，还是可以计算和缓存解决方案？

如果您需要“实时”计算，您可能想要使用某种贪心算法，我认为[A* 算法](http://en.wikipedia.org/wiki/A_star)可能会非常适合这个问题域。

如果您需要最佳解决方案，您应该查看图形的[动态规划](http://en.wikipedia.org/wiki/Dynamic_programming)解决方案......最佳解决方案可能需要更长的时间来计算，但您只需要找到它们一次，然后它们就可以被缓存。也许您的 A* 算法可以使用预先计算的最佳路径来告知其关于“相似”路线的决策。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-28T03:11:11.247

一种可能会奏效的极其低效的方法是为一天中的每一分钟存储城市中每个十字路口的副本。从 Elm St. and 2nd 到 Main St. and 25th 的公交路线将表示为，例如，

```
elm_st_and_2nd[12][30].edges :
 elm_st_and_1st[12][35] # 5 minute walk to the next intersection
   time = 5 minutes
   transport = foot
 main_st_and_25th[1][15] # 40 minute bus ride
   time = 40 minutes
   transport = bus
 elm_st_and_1st[12][36] # stay in one place for one minute
   time = 1 minute
   transport = stand still 
```

在这个图上运行你最喜欢的寻路算法，并祈求一个好的虚拟内存实现。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-14T17:31:46.733

你自己回答这个问题。使用 A* 或 Dijkstra 算法，您需要做的就是确定每条路线的每个部分的合理成本。

对于巴士路线，您的意思是您不想要最短的路线，而是最快的路线。因此，路线每个部分的成本必须包括该部分公共汽车的平均行驶速度，以及在公共汽车站的任何等待。

找到最合适路线的算法仍然和以前一样。使用 A*，所有的魔法都发生在成本函数中......

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-17T20:07:02.750

您需要以不同的方式加重双腿的重量。例如 - 在下雨天，我认为有人可能更喜欢在车辆中旅行而不是在雨中行走。此外，讨厌步行或无法步行的人可能会比不介意步行的人进行不同/更长的旅行。

这些优势是成本，但我认为您可以扩展成本的概念/概念，它们可以具有不同的相对值。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-17T20:09:44.990

该算法保持不变，您只需根据不同的场景（巴士时刻表等）增加每个图边的权重。

不久前，我整理了一个地铁路线查找器作为图形路径查找的练习：

[http://gfilter.net/code/pathfinderDemo.aspx](http://gfilter.net/code/pathfinderDemo.aspx)

# cocoa - 如何在 Xcode 中显示 Logged Messages 窗口

> ID：483493
> 
> 赞同：22
> 
> 时间：2009-01-27T14:03:39.793
> 
> 标签：cocoa, arrays, xcode, logging

我是一个非常新的 Cocoa 用户，遇到了各种各样的问题......

我正在尝试获取 Array 的内容并找到此代码来执行此操作。

> NSLog(@"array : %@",collection);

问题是，我没有得到任何显示此“回声”的控制台或跟踪器窗口

我应该使用另一个命令吗？我尝试打开所有窗口，但没有看到应该显示的消息。我知道这个调用所在的函数被执行了，所以引用是正确的。

感谢并为这些初学者问题感到抱歉......使用stackoverflow比阅读苹果关于该主题的所有文档要快得多。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2012-07-31T14:14:56.600

在更高版本的 xcode 中，执行 shift + cmd + R。

或者去查看 -> 调试区 -> 激活控制台

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-27T14:12:42.100

当 Xcode 运行您的项目时，编辑器会更改为显示一个带有字母“GDB”的黑色小按钮。单击它以查看其中包含控制台的调试器。

祝你好运！

哦，我会阅读 Apple 的文档。它没有那么坏。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-27T14:24:39.877

从“运行”菜单中，选择“控制台” - 键盘快捷键是 Shift-Cmd-R。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2021-02-16T13:25:08.323

在 Xcode 12 中，转到查看 > 调试区域 > 激活控制台

[![在此处输入图像描述](https://i.stack.imgur.com/2jZgT.png)](https://i.stack.imgur.com/2jZgT.png)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-27T14:25:45.817

在 Xcode 菜单中点击**Run** - **Console**。这是 NSLog / print / printf 等语句输出的地方。

键盘命令是**Command + Shift + R**。

可可**toString()**方法也称为**描述**。

```
NSLog(@"array : %@",collection); 
```

将执行

```
NSLog(@"array : %@",[collection description]); 
```

然后它将调用每个集合元素的描述。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-27T17:02:56.983

如果您想在每次运行应用程序时看到它，请从首选项窗口中选择“调试”选项卡，然后将“启动时”框更改为“显示控制台”。此外，我喜欢选中“自动清除调试控制台”复选框，该复选框将在启动应用程序时清除输出文本。

# testing - 我怎样才能像用户一样思考？

> ID：483495
> 
> 赞同：12
> 
> 时间：2009-01-27T14:03:50.730
> 
> 标签：testing, user-interface

我们现在正忙于一个项目，时间安排很紧（但合理）。我们的总体策略是完成一个强大的测试版，发布它进行测试，并从我们的测试人员那里获得反馈。

很多时候，我们会受到一些小事的打击，这些小事会演变成长时间的、耗费时间的讨论。它们都归结为一件事：虽然我们知道我们需要什么功能，但我们在一些小细节上遇到了麻烦，比如“这条消息应该去哪里”和“他们是否需要立即获得这个反馈，或者它会破坏他们的流程，所以我们应该推迟”？

这些都是我们的测试人员应该捕捉到的东西，但是

a) 每个像这样的“低优先级”错误都会消耗关键问题的时间

b) 我们希望拥有尽可能强大的产品

和

c) 即使是最好的测试组也会时不时地错过一些东西。

我们使用我们的产品，并且我们知道我们的用户如何使用旧版本......但是当我们尝试使用新版本（具有重要的图形和潜在的变化）。

编辑 - 更多背景：

我们正在编写一个广泛分布的用户群使用的网络应用程序。我们的应用程序是他们工作的重要组成部分，但不是最大的（当然，我们只在它不起作用时才对他们重要）。让实际用户使用我们的产品很困难，因为我们在地理上距离作为最终用户的最近位置很远（我们在俄亥俄州，我认为我们服务的最近位置是 3 个多小时的路程）。

我们能得到的最接近的是我们的客户服务团队（他们确实帮了很大的忙），但他们的想法也不像用户。他们还充当我们的测试人员（当他们知道他们没有找到的任何错误可能意味着调用数量大幅增加时，这确实激励他们去寻找错误）。我们在一周的大部分时间里都有三名（总共约 12 名）客户服务代表回到这里进行一些初步测试……他们也参与了讨论。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-27T14:13:35.530

观看某人使用该应用程序对我来说是一个巨大的好处。可能是对它不完全熟悉的人。

看看他们如何尝试导航，他们如何尝试输入信息或大小窗口。在日复一日地创建/运行应用程序后，我们认为理所当然的事情。

用户总是会尝试做你从未预料到的事情，观察他们的行动可能会揭示你如何改变一些看似微不足道但真正对他们产生重大影响的事情。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-27T14:10:09.327

阅读[不要让我思考](http://www.sensible.com/chapter.html)。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-27T14:08:27.757

一般来说，你不能。没有任何方法可以关闭大脑的“程序员”部分并像用户一样思考。

你是对的（c），测试组不一定能捕捉到所有的错误。但是你能做的最好的事情是让一个由真实的、诚实的最终用户组成的测试组，并重视他们的反馈。从他们的一般性评论中得出进一步的结论。

如果您想知道您的用户将如何看待您的系统，您可以获得的最接近的方法是与真实用户进行可用性测试。其他一切都只是启发式和经验，也容易出错。没有没有错误的产品，但你应该能够通过可用性测试获得“强大”的产品。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-27T14:09:07.427

购买便宜且易于使用的摄像机，并使用该应用程序记录您的测试人员。更好的是，让一些不熟悉该应用程序的人。使用它并对它们进行录像。它相对便宜，你会惊讶于它会突出什么。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-27T14:16:08.410

我喜欢“吃你自己的狗粮”的政策（“ [http://en.wikipedia.org/wiki/Eat_one](http://en.wikipedia.org/wiki/Eat_one) 's_own_dog_food）。它让你更近了一步，因为你成为了一个用户，尽管你可能会想一个。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-27T14:21:45.873

重要的是获得足够的信息，让你自己[成为“用户”](http://www.codinghorror.com/blog/archives/001066.html)。一旦你这样做了，你就可以自己回答大多数问题。

我总是这样做的方式是与他们讨论他们需要做什么，他们通常做什么，以及他们如何使用他们当前的工具来做到这一点。然后（**非常重要**）在他们做的时候和他们坐在一起。确保您与他们相处得很好，以便您可以回过头来询问他们如何处理您稍后想到的边缘情况（通常答案将是令人震惊的“我们为此手动绕过系统”）。

我几乎总是会注意到他们正在做的事情是他们没有提出的皇家 PITA，因为他们已经习惯了这样做并且不知道更好。我总是*会*注意到他们的 %90 典型工作流程并不是工具提供的最简单的工作流程。

您不能真正依靠单纯的老式需求收集本身，因为这要求他们像*开发人员*一样思考。他们通常不知道您的软件可以做什么，什么容易，什么难。此外，他们通常对 GUI 设计原则一无所知。如果您要求他们提供设计输入，他们只会告诉您将任何新控件放在他们最喜欢的页面上，直到看起来像 747 控制面板。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-01-27T14:26:54.253

当您非常着急时尝试使用您的应用程序（例如，您有人在等晚餐）。你会看到所有这些小东西，因为你必须等待，你必须回到键盘上的鼠标，等等。

而且，让你的妻子使用它。或者你妈妈。

另一个有用的测试：通过电话帮助某人使用它。如果他找不到带有您的指示的按钮，那可能是一个错误。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-01-27T14:36:47.713

问题通常是即使用户在实际使用该软件之前也不知道他们想要什么。有时，一个小的疏忽可能是一个很大的可用性问题，有时许多用户要求的经过深思熟虑的功能却很少使用。

我的建议是降低未实现正确可用性功能的风险：

*   看看实际在进行日常工作的用户。即使他们使用其他软件或根本没有软件。您将能够确定他们完成工作经常需要的工件。您将看到他们经常需要哪些数据。专注于最常用的工件、数据和工作流。它们应该是最有用的。对于用户来说，异国情调的工作流程可能比常用的工作流程更耗时。

*   使用 GUI 的工作原型让用户完成一个现实的工作流程。观察他们并注意是什么阻碍了他们，什么是有效的。相应地调整您的原型。

*   如果您的软件经常使用的部分出现问题，现在是时候详细讨论它了。如果问题涉及很少使用的部件，请将其设为低优先级问题，并在有时间的情况下进行讨论。如果问题或建议的优先级较低，则应保持低优先级。如果您无法确定解决方案 A 还是解决方案 B 是最好的，请不要一遍又一遍地用相同的论点绕圈子。只需实施其中一种解决方案，看看 beta 测试人员是否喜欢它。你能做的最糟糕的事情就是把时间浪费在小问题上，而大问题需要解决。

*   软件永远不会完美，因为用户的观点不同。一些用户会认为一个小问题会破坏整个应用程序。其他人甚至会遇到严重的可用性问题。人们倾向于倾听那些争论最大的人。了解您的用户，将“响亮”的问题与重要的问题区分开来。做到这一点需要经验，有时你会做出错误的决定，但没有完美的方法，只有稳步改进的方法之一。

*   如果可以，请为软件的推出阶段留出一定数量的可用性开发资源。当人们开始在真实的生产环境中使用它时，就会出现可用性问题。有时，展示完美的软件并不重要，重要的是要在问题出现时迅速解决。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-27T14:09:35.397

关于如何像用户一样思考的轻率（但有些准确）的答案是把一根织针放在你的耳朵里，然后用力推。

更长的回应是我们作为程序员是不正常的，我的意思是在一个好的方面。我对仍然运行他们通过电子邮件从陌生人那里收到的可执行文件的人数感到头疼，然后想知道他们的计算机是如何被感染的。

任何一群人都会及时发展出他们自己的行话、惯例、实践和期望。作为程序员，您对操作系统的期望与 Joe User 的期望不同。这是很自然的，可以预料但很难解决。

这也是存在 BA（业务分析师）的原因。他们通常来自商业或测试背景，不像程序员那样思考。它们是您与用户的链接。

但实际上，您应该与您的用户交谈。没有必要争论用户做什么。只需拖动一些，看看他们做了什么。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-27T14:15:57.973

可用性测试组将提供帮助。测试的重点不是发现错误，而是关注新设计的学习曲线，由一组用户而不是程序员进行。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-27T14:29:28.413

我把所有用户都当作恶意的白痴。

恶意，因为我假设所有用户都会尝试破坏我的代码，做不允许的事情，避免输入有效数据，并且会尽其所能让我的生活陷入困境。

白痴，因为我不能假设他们会理解电话格式等简单的东西，如果有很多选择会尖叫着逃跑，并且不会对复杂的指令做出任何信念的飞跃。目标是全程牵着他们的手。

同时，确保用户没有意识到您认为他们是白痴也很重要。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-01-27T14:32:48.487

像用户一样思考，成为其中的一员。但是这些实际上是您的测试人员报告的错误吗？或者他们是“增强请求”？如果软件按照要求的设计运行并且他们只是不喜欢它的运行方式，那不是错误。这是需求和设计的失败。让它工作，让它坚如磐石，让它容易改变，你就可以让它成为你的用户想要的。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-01-27T15:15:08.790

我在这里看到了一些很好的建议，尤其是观察人们试图使用你的应用程序。我建议的一件事是查看在纸质表单上呈现给用户的顺序（如果他们使用这些来进行数据输入），并使最终的数据输入页面尽可能地模仿该顺序。如此多的数据输入错误（以及数据输入速度的损失）是由于他们不得不在页面上跳转并失去其位置。今年我为一场政治运动做了一些工作，在每种情况下，输入数据都变得更加困难，因为电脑屏幕的操作顺序与纸质输入的顺序不同。如果表格是无法更改的（例如选民登记表，竞选活动必须使用国家提供的表格）以匹配计算机屏幕，这一点尤其重要。如果可能，还要在屏幕之间保持一致。如果在一个表格上是名字姓氏，则在下一个表格上将其设为姓氏名字会混淆人们并保证数据输入错误。

如果您真的对了解用户感兴趣，我强烈建议您参加人因工程课程。这是一种启发性的体验。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-27T14:10:29.717

做到这一点的“正确”方法是原型化（或模拟）您的新界面功能，并观察您的用户尝试使用它们。没有什么比看到真实用户尝试使用新功能更有启发性了。

不幸的是，考虑到大多数项目的时间和资源，这是不可能的。如果这是你所处的位置，我建议你在最了解可用性的团队中讨论，然后让他们对可用性决策负责——但是那个人需要定期咨询真实用户以确保他/她的想法与用户想要的一致。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-27T14:10:53.787

我建议进行某种形式的可用性测试；我过去参加过这样的活动，发现它们非常有用。

例如，如果您正在编写票务系统，请调出任务，并提出诸如“您将如何更新此票证”或“如果单击此按钮会发生什么”之类的问题。

您也不一定需要完整的应用程序，在某些地方可以使用屏幕截图。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-01-27T14:11:12.163

您可以采用 TDD/BDD 方法并在 beta 之前让用户参与进来，让他们在您编写单元测试时与您一起细化需求。我们开始将其中一些趋势融入我们当前的项目中，并且在我们之前让用户参与的领域中，我们看到的错误越来越少。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-01-27T14:24:05.337

没有“像用户一样思考”的技术，让你接触对项目一无所知的人，然后把你所做的事情扔给他们。

这是查看外观+感觉+功能如何呈现给最终用户的唯一方法。

一旦你震惊了那个对产品一无所知的人，倾听他们所有愚蠢的（或者你认为他们是）抱怨，修复它们，安排他们指出的每一个愚蠢的装饰性事情（通过修复 UI 或通过改进任何文档你有过）..

在你满足了你选择从第一轮零知识看你的应用程序的人之后，选择另一个......然后另一个......直到他们看到它时不再感到震惊，并且他们不会卡住on.. “ok.. 这是做什么的？” 种阶段。

您（作为项目的成员，无论是项目经理、开发人员等）永远不会认为用户是我对这个问题的回答。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-01-27T14:33:05.210

古语说：你可以做一些“傻瓜证明”，但你不能让它成为“该死的傻瓜证明”。

另外：当您制作“白痴证明”时，世界会发明一个更好的白痴。

除此之外，我同意其他人所说的。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-01-27T14:59:05.720

让完全没有知识、洞察力或编程经验的人使用该程序并尝试弄清楚该程序的每个功能。

永远不会使用此类程序的人最有可能发现错误。

将其视为尝试将 URL 放入搜索字段的新 Safari 用户（或 FF）... 作为程序员，您猜没有人会那么愚蠢（或者，嗯.. 不知道），但实际上人们有时会发现自己在这些情况下。作为程序员，我们错过了这些东西。

# wmi - 在哪里可以找到 WMI 文档？

> ID：483501
> 
> 赞同：4
> 
> 时间：2009-01-27T14:06:46.980
> 
> 标签：wmi

谷歌让我失望了，我在 MSDN 上找不到。`man wmi`在 windows shell 中不起作用...我正在寻找可以查询的对象列表，以及如何构造查询。

对于 WMI，我的意思是查询语言来查询诸如“Win32_Process”之类的东西

我知道类和示例查询，但我正在寻找所有可能查询对象的完整列表。

我已经使用调试器找到了我正在寻找的东西，但是查看完整的概述以了解 WMI 的可能性仍然很有趣。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-27T14:18:23.227

[MSDN WIN32 类](http://msdn.microsoft.com/en-us/library/aa394572(VS.85).aspx) ，您可以在此处找到要在查询中使用的类列表以及示例查询

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-30T19:06:36.943

你知道这个工具[WMI Code Creator](http://www.microsoft.com/downloads/details.aspx?familyid=2cc30a64-ea15-4661-8da4-55bbc145c30e&displaylang=en)吗，非常适合学习 WMI。
另一个类似的工具[Scriptomatic 2.0](http://www.microsoft.com/download/en/details.aspx?id=12028)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-27T14:57:14.490

没有可以查询的 WMI 类的文档化“完整”列表，因为程序可以注册自己的 WMI 提供程序，并且这可以在版本之间更改。

使用 WBEMTEST 并按下“枚举类”按钮...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T14:19:21.133

MSDN 上有[查询语言指南](http://msdn.microsoft.com/en-us/library/aa392902.aspx)、[查询语言参考](http://msdn.microsoft.com/en-us/library/aa394606(VS.85).aspx)和[WMI 主文档页面](http://msdn.microsoft.com/en-us/library/aa394582.aspx)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-12T14:59:19.917

Microsoft TechNet 脚本中心拥有[WMI Scripting Primer](http://www.microsoft.com/technet/scriptcenter/guide/sas_wmi_overview.mspx)和许多其他丰富的[WMI 资源](http://technet.microsoft.com/en-us/scriptcenter/dd742341.aspx)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-02-09T15:11:42.237

您可以使用 WMIViewer 在[http://iaas.ao-is.com/](http://iaas.ao-is.com/Download)上浏览 WMI 类，下载它是开源的，甚至可以为您生成 powershell 代码。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-12-12T22:14:52.683

正如前面提到的，WBEMTest 是一个很好的工具，它内置在 windows 中，可帮助您在 msdn WMI 文档之上进行探索。

就个人而言，尽管我发现 WMI Studio 是最完整的工具，可以帮助理解每个 WMI 类的真正作用以及它的行为方式。

WMI Studio 有点像 Studio。它作为 IE 的 ActiveX 插件运行。

它可能无法与 IE11 一起编译，因此您可能必须关闭 IE11 中的增强保护模式才能使其正常工作。

[WMI 工作室。](http://www.microsoft.com/en-us/download/details.aspx?id=24045)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-10-18T09:22:21.543

我通常将[WMI Explorer](https://wmie.codeplex.com/)用于我的项目[Services+](https://servicesplus.codeplex.com/)，其中包含有关 WMI 查询和方法的完整信息。

# inversion-of-control - Castle Windsor 如何响应实现多个接口的类？

> ID：483515
> 
> 赞同：5
> 
> 时间：2009-01-27T14:09:27.957
> 
> 标签：inversion-of-control, castle-windsor, ioc-container

例如，我有两个接口：ICustomerService 和 IOrderService，每个接口都有几个函数，如 GetCustomer、GetOrder 等。

我想要一个类来实现这两个接口：服务器。

温莎城堡对此有何回应？一开始有可能吗？当我基于两个接口之一解析服务器对象时，我会得到相同的对象吗？当我有一个在其参数中具有两个接口的构造函数时会发生什么？是否仍会构造一个对象。

假设 LifeStyle 保留其默认值：Singleton。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2011-04-23T03:42:52.693

CLR 类型和 Windsor 服务或组件之间没有硬性的一对一映射（[如果需要的话，这里有词汇表](https://github.com/castleproject/Windsor/blob/master/docs/services-and-components.md)）。

所以你可以有以下任何一种情况：

*   许多具有不同实现类型的组件公开一个服务

    ```
    container.Register(
       Component.For<IFoo>().ImplementedBy<Foo1>(),
       Component.For<IFoo>().ImplementedBy<Foo2>()
    ); 
    ```

*   许多具有相同实现类型的组件公开一个服务

    ```
    container.Register(
       Component.For<IFoo>().ImplementedBy<Foo1>(),
       Component.For<IFoo>().ImplementedBy<Foo1>().Named("second")
    ); 
    ```

*   许多具有相同实现类型的组件暴露了不同的服务

    ```
    container.Register(
       Component.For<IFoo>().ImplementedBy<Foo1>(),
       Component.For<IBar>().ImplementedBy<Foo1>().Named("second")
    ); 
    ```

*   单个组件暴露不同的服务

    ```
    container.Register(
       Component.For<IFoo, Bar>().ImplementedBy<Foo1>()
    ); 
    ```

正如您所看到的，是的 - 这是可能的，您是否会获得相同的实例（假设为单例）取决于您选择的选项 - 两个服务是否将由同一个组件公开。

# wpf - 如何在另一个 XAML 文件中引用 Canvas？

> ID：483519
> 
> 赞同：2
> 
> 时间：2009-01-27T14:10:28.453
> 
> 标签：wpf, vb.net, xaml, canvas

我在弄清楚如何在我的项目的另一个 XAML 文件中引用 Canvas 时遇到问题。

例如，有一个包含一些标签的 Canvas 对象，称为 MyLayout 的图像并存储在 MyLayout.xaml

我想在 Window.xaml 中的应用程序的主窗口中使用这个 Canvas。如何才能做到这一点？将需要将多个布局加载到窗口中。

所有 XAML 都在项目中并编译它不能从文件加载。

如何在 Window.xaml 中的 MyLayout.xaml 文件中引用 Canvas 对象？

这可以在 XAML、VB.NET 代码甚至 C# 中。

我已经搜索了几个小时试图弄清楚这一点。如何在另一个 XAML 文件中使用一个对象？这是怎么做到的？

提前致谢。我希望有人知道如何做到这一点。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T14:39:18.443

您是否考虑过使用 UserControl 或 ControlTemplate？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-29T20:11:21.790

由于您的 Canvas 对象实际上是 Canvas 的子类，因此该子类在您的程序集中定义。`xmlns`您可以通过向根 XAML 对象添加另一个属性来引用在其他命名空间中定义的对象。

像这样的东西（假设你的 Canvas 子类`MyCanvas`在`MyNamespace`命名空间中被调用）：

```
<Window x:Class="MyNamespace.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:MyNamespace">
    <local:MyCanvas />
</Window> 
```

您可以像设置任何其他对象一样设置 MyCanvas 类的属性。

# .net - 使用基类进行单元测试设置和拆卸

> ID：483526
> 
> 赞同：12
> 
> 时间：2009-01-27T14:11:39.043
> 
> 标签：.net, unit-testing, mstest

假设 Visual Studio.NET 2008 和 MsTest 用于运行单元测试。当系统基于服务容器和依赖注入时，单元测试自然需要设置服务。

这些服务是否应该设置在所有单元测试都派生自每个单元测试类或在每个单元测试类中的基类中。如果它们应该在基类中，有没有一种方法可以在不需要从派生类中调用它们的情况下执行`TestInitialize`and方法，例如 base.Initialise？`ClassInitialize`

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-27T14:19:29.433

MSTest 框架将在整个对象（所有基类）中搜索标记为 的方法`Test*`。就像在单元测试类中声明它们一样，您不必显式调用它们。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-14T06:50:06.683

使用 2008，您应该能够在基类上使用 [TestInitialize]，并且只要您不在层次结构中的某个位置添加另一个 [TestInitialize]，就应该调用它。你也可以用虚方法来做事。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T14:16:15.680

我更喜欢在实际的单元测试类中使用`Test*`和标记的方法。`Class*`如果在基类上定义它们，则不能向它们添加测试特定活动。相反，在您的基类上使用静态和实例构造函数和终结器。

# sql-server - 查询在日期时间字段上因 INNER JOIN 挂起

> ID：483535
> 
> 赞同：0
> 
> 时间：2009-01-27T14:15:57.117
> 
> 标签：sql-server, ms-access

从 SQL Server 2005 和 MS Access 2003 连接表时，我们遇到了一个奇怪的问题。

服务器上有一个大表，Access 本地有一个很小的表。这些表通过 3 个字段连接，其中一个是日期时间字段（包含一天；想法是（每天）从大型服务器表中获取其他数据以将数据添加到本地表中）。

直到周末，这每天都运行良好。从昨天开始，我们在使用此查询的 Access 中遇到了奇怪的非超时。Non-time-out 意味着查询在相当高的网络传输下永远运行，但不会发生超时。Access 甚至不显示进度条。服务器跟踪告诉我们，相同的查询在 SQL 服务器上一遍又一遍地执行，没有错误，但也没有结果。我们已将其范围缩小到看似使用大表访问服务器表并且 JOIN 或 WHERE 包含日期的问题，但我们无法真正缩小范围。我们已经重建了索引，目前正在恢复备份数据，但也许这里有人有我们可以尝试的任何指示。

谢谢，迈克。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T14:57:22.850

感谢您的快速答复！

实际查询非常庞大；你不会满意的:)

但是，我们将其范围缩小为一个简单的：

```
SELECT * FROM server_table INNER JOIN access_table ON server_table.date = local_table.date; 
```

如果 server_table 是一个大表（很难说，我们有 150 万行；有 10 行左右的测试表已经工作）并且 local_table 是一个包含日期的单个单元格的表。这永远运行。它不仅慢，而且除了 - 似乎 - 导致网络流量并且没有超时之外什么都不做（这是我觉得很奇怪的；通常你会超时，但这只是继续运行）。

我们刚刚找到知识库文章 828169；似乎是我们的问题，我们会调查的。谢谢你的帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-23T18:39:50.893

如果您将 Access 中的本地表连接到 SQL Server 中的链接表，并且根据连接到链接数据的特定限制，查询并不是很简单，那么 Access 很可能会从 SQL Server 中提取整个表并执行在本地加入整个集合。这是一个已知问题。

这并不能直接解决您提出的问题，但是您距离将所有数据集中在一个位置（SQL Server）还有多远？恕我直言，只要您在每个系统中都有一些数据，您就可以预料到同样类型的性能问题会困扰您。

如果全部都在 SQL Server 中，则传递查询将优化和使用可用索引等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-23T08:37:45.003

尝试另一种语法？类似于： `SELECT * FROM BigServerTable b WHERE b.DateFld in (SELECT DISTINCT s.DateFld FROM SmallLocalTable s)`
您的问题描述中的奇怪之处是“直到周末，每天都运行良好”。
这意味着问题确实出在其他地方。
您是否尝试过创建一个新的空白 Access 数据库并从旧数据库中导入所有内容？
或者只是刷新所有链接？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T14:27:47.093

请发布正在执行此操作的查询，仅仅因为您有索引并不意味着它们将被使用。如果您的`WHERE`or`JOIN`子句不是 sargable 则不会使用索引

以此为例

```
WHERE CONVERT(varchar(49),Column,113) =  CONVERT(varchar(49),OtherColumn,113) 
```

不会使用索引

或这个

```
WHERE YEAR(Column) = 2008 
```

运算符左侧的函数（即在列本身上）将使优化器进行索引扫描而不是查找，因为它不知道该函数的结果

> 我们已经重建了索引，目前正在恢复备份数据，但也许这里有人有我们可以尝试的任何指示。

访问可以扼杀很多好东西....您是否考虑过阻止

跑

```
exec sp_who2 
```

看看`BlkBy`列，看看谁在阻止什么

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-19T19:53:28.307

使用 DATEDIFF 函数比较两个日期，如下所示：

' 如果基于 datepart 参数的日期相同，则 DATEDIFF 返回 0，在本例中为 d

```
WHERE DATEDIFF(d,Column,OtherColumn) = 0 
```

DATEDIFF 已针对日期进行了优化。如果任一日期为 NULL，则比较等号 (=) 两边的 CONVERT 函数的结果可能会导致表扫描。

希望这可以帮助，

账单

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-01-27T22:40:26.940

只是一个想法，但在 SQL Server 中，您可以附加您的 Access 数据库并在那里使用该表。然后，您可以在服务器上创建一个视图以在 SQL Server 中进行全部连接。知识库文章中提出的解决方案对我来说似乎有问题，因为它是一个杂项（如果 LIKE 有效，那么 = 应该也有效）。

如果我的建议有效，我会说它在可维护性方面是一个更强大的解决方案。

# c# - 它是否从数据库加载数据？

> ID：483538
> 
> 赞同：4
> 
> 时间：2009-01-27T14:16:15.023
> 
> 标签：c#, .net, linq-to-sql

假设我们有这样的方法：

```
public IEnumerable<T> FirstMethod()
{
    var entities = from t in context.Products
                   where {some conditions}
                   select t;

    foreach( var entity in entities )
    {
        entity.SomeProperty = {SomeValue};
        yield return entity;   
    }
} 
```

其中 context 是由 Linq to SQL 设计器生成的 DataContext。

“FirstMethod”是否将数据从数据库加载到内存中（因为 foreach 循环），还是会延迟加载它，直到在另一个方法中找到另一个没有“yield return”的 foreach 循环，如下所示？

```
public void SecondMethod()
{
    foreach( var item in FirstMethod() )
    {
        {Do Something}
    }
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-27T14:20:30.773

后者（延期）；`FirstMethod`是一个迭代器块（因为`yield return`）；这意味着您有一个迭代器链。**在最终调用者**开始迭代数据之前，什么都不会被读取；**然后在最终调用者** `foreach`（在它们之间打开连接/命令）期间依次读取每条记录。

`using`包围（在引擎盖下`foreach`）确保连接在`foreach`中途放弃时关闭。

如果您**想**更早地加载数据，请使用`.ToList()`或`.ToArray()`在本地缓冲数据 - 但请注意，这会破坏“组合” - 即调用者不能再添加额外的`Where`etc 子句（如果它返回 raw 则可以添加`IQueryable<T>`）。

* * *

回复你的问题：

```
public IEnumerable<T> FirstMethod()
{
    var entities = from t in context.Products
                   where {some conditions}
                   select t;

    foreach( var entity in entities.AsEnumerable() )
    {
        entity.SomeProperty = {SomeValue};
        yield return entity;   
    }
} 
```

是这里`AsEnumerable`的关键；它结束可组合`IQueryable<T>`链，其余部分使用 LINQ-to-Objects。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T14:22:10.113

In short, it doesn't load until SecondMethod performs the iteration...

Read [here](http://rapidapplicationdevelopment.blogspot.com/2008/03/how-systemlinqwhere-really-works.html) for more...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T14:21:30.723

Loading is deferred until the **GetEnumerator** method is called on the **entities** query and that won't happen until the **GetEnumerator** method is called on the **IEnumerable<T>** you're returning.

# wpf - 带有 ItemTemplate（和 ScrollBar！）的 ListBox

> ID：483542
> 
> 赞同：34
> 
> 时间：2009-01-27T14:17:44.197
> 
> 标签：wpf, xaml, listbox, scroll

我有一个数据绑定和 itemtemplated 列表框：

```
<ListBox x:Name="lbLista" 
         ScrollViewer.VerticalScrollBarVisibility="Visible">
    <ListBox.ItemTemplate>
      <DataTemplate>
        <StackPanel Orientation="Horizontal">
          <CheckBox IsChecked="{Binding Deleteable, Mode=TwoWay}" />
          <Label Content="{Binding Name}" />
        </StackPanel>
      </DataTemplate>
    </ListBox.ItemTemplate>
</ListBox> 
```

这些项目显示良好，它们来自 ObservableCollection。

**问题**是出现但无法使用的滚动**条**- 它没有可抓取的手柄。我尝试在 ListBox 上设置一些 ScrollView 附加属性，但它们不会影响情况。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-01-27T14:32:50.653

我将您的代码粘贴到测试项目中，添加了大约 20 个项目，我得到了可用的滚动条，没问题，它们按预期工作。当我只添加几个项目（不需要滚动）时，我没有可用的滚动条。会是这样吗？你没有添加足够的项目？

如果您删除，`ScrollViewer.VerticalScrollBarVisibility="Visible"`则滚动条仅在您需要它们时出现。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-27T14:40:10.500

ListBox 将尝试扩展可用的高度。当您设置 ListBox 的 Height 属性时，您会得到一个实际工作的滚动查看器...

如果您希望您的列表框适应可用的高度，您可能想尝试从您的父控件调节高度。例如，在网格中，在 RowDefinition 中将高度设置为自动可能会奏效...

高温高压

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-04-28T21:27:01.073

我从来没有在堆栈面板内放置任何可滚动内容（任何从 ScrollableContainer 派生的内容。堆栈面板有一个奇怪的布局机制，当测量操作完成时会混淆子控件，我发现垂直大小最终是无限的，因此不受限制- 所以它超出了容器的边界并最终被剪裁。滚动条不显示，因为控件认为它拥有世界上所有的空间，而实际上它没有。

您应该始终将可滚动内容放置在可以在运行时的布局操作期间解析为已知高度的容器中，以便滚动条的大小适当。可视树中的父容器必须能够解析为实际高度，如果您将 RowDefinition o 的高度设置为自动或固定，则会在网格中发生这种情况。

这也发生在 Silverlight 中。

-em-

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T14:50:14.363

谢谢回答。我自己也尝试过一个空项目，并且 - 看哪，天堂和七海的全能创造者 - 它奏效了。我最初有 ListBox 在里面，它在 root 里面。出于某种原因，ListBox 根本不喜欢在 StackPanel 中！=)

-pom-

# c# - 在 ASP.net MVC 中实现表单

> ID：483545
> 
> 赞同：3
> 
> 时间：2009-01-27T14:18:41.337
> 
> 标签：c#, .net, asp.net-mvc, forms, views

我在视图页面上有一个简单的表单，实现为用户控件，看起来像这样：

```
<%=Html.BeginForm("List", "Building", FormMethod.Post) %>

//several fields go here

<%Html.EndForm(); %> 
```

我想解决两个问题，第一个是我希望接收这个的控制器方法采用用户控件的类型参数。目标是避免将表单的所有字段放入方法的参数列表中。控制器方法当前如下所示：

```
[AcceptVerbs("Post")]
    public ActionResult List(string capacityAmount)
    {
        ProfilerDataDataContext context = new ProfilerDataDataContext();
        IEnumerable<Building> result = context.Buildings.OrderBy(p => p.SchoolName);
        ViewData["Boroughs"] = new SelectList(Boroughs.BoroughsDropDown());

        return View(result);
    } 
```

表单中的其余字段将用于对建筑物类型进行搜索。

表单发布得很好，我可以按照您期望的方式搜索容量，但是当我在搜索中添加参数时，我可以闻到前面的丑陋。

其次，较小的问题是，当页面呈现 BeginForm 标记时，会将字符串“System.Web.Mvc.Form”呈现给页面。我怎样才能让它消失？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-27T14:29:40.927

1) 使用 FormCollection 作为参数：

```
public ActionResult List(FormCollection searchQuery) 
```

现在您可以迭代 FormCollection 并从您的搜索表单中获取键/值搜索词。

2）从BeginForm中删除“=”：

```
<% Html.BeginForm("List", "Building", FormMethod.Post) %> 
```

也就是说，你[真的应该使用](http://weblogs.asp.net/scottgu/archive/2008/10/16/asp-net-mvc-beta-released.aspx "ASP.NET MVC 测试版发布")，嗯......使用：

```
<% using (Html.BeginForm("List", "Building", FormMethod.Post)) { %>
<% } %> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T19:28:05.567

如果我正确理解了您的问题，您可以使用 html 帮助程序并创建名为：

```
<%=Html.TextBox("building.FieldNumber1")%>
<%=Html.TextBox("building.FieldNumber2")%> 
```

您应该能够使用以下方式访问数据：

```
public ActionResult List(Building building)
{
   ...
   var1 = building.FieldNumber1;
   var2 = building.FieldNumber2;
   ...
} 
```

如果您的操作是根据是否提交表单来做两件不同的事情：

```
public ActionResult List()
{
    //some code here
}

[AcceptVerbs(HttpVerbs.Post)]
public ActionResult List(Building building)
{
   ...
   var1 = building.FieldNumber1;
   var2 = building.FieldNumber2;
   ...
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T03:28:01.197

如果有人对 Html.BeginForm 的整个“使用”模式持怀疑态度 - 请意识到 IDE 足够聪明，可以将开头`'{'`与结尾相匹配，`'}'`这使得很容易看到表单的开始和结束位置。

还有 <% Html.EndForm(); %> 需要一个分号，我不确定我是否喜欢 :)

# asp.net - 如何在 Mac 上为我的 Flash 开发人员设置 ASP.Net/IIS 开发环境？

> ID：483547
> 
> 赞同：0
> 
> 时间：2009-01-27T14:19:20.307
> 
> 标签：asp.net, flash, macos, development-environment

不，不，我没有荨麻疹；）。

我能够在 IIS 上运行我的 .NET 3.5 站点的本地版本并在开发时进行故障排除。但是，当我的 Flash 开发人员想要查看他的工作情况时，他不得不登录到我们的 Windows 2003 并与我们的暂存服务器发生冲突。这是不可接受的，我理解，但现在有时间问题，所以这个黑客将不得不飞行一点。

如何为我的 Flash 开发人员设置一个开发环境，以便能够在他的本地计算机上工作？我相信这在其他地方也能做到。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-27T14:21:58.460

VMWare Fusion 或 Parallels，或者给他一个虚拟机/PC，他可以从他的 Mac 远程桌面。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T14:58:37.717

不要听起来很傻，但 Flash 不是不依赖于平台的吗？Flash 开发人员是否在做比连接到远程客户端来更新 .swf 文件更复杂的事情？您“不需要”运行 windows/iis 来将文件从 mac 复制到 windows。您可以尝试远程桌面客户端：

[http://www.microsoft.com/mac/products/remote-desktop/default.mspx](http://www.microsoft.com/mac/products/remote-desktop/default.mspx)

或为他设置一个 FTP 帐户（在有问题的登台服务器上？）。我同意上述关于使用 Parallels 或 VMWare 的观点。它不一定是您可以在多个平台上使用和测试的“hack”或“解决方法”。这是一个巨大的优势！作为VMWare的用户和前并行用户，我推荐VMWare。在 Mac 上启动并运行“安装 Windows”大约需要很长时间，如果您愿意，可以通过桌面（或其他）上的“文档”获得来自 Mac 的资源。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-29T13:58:17.723

在 VMWare Fusion 虚拟机中设置 IIS。进行 Windows XP 的简化安装，它应该运行良好。

这样，您就可以从 Mac OS X 或本地网络上任何地方的其他 PC 与 IIS 服务器进行交互。

我使用 Vmware Fusion 来运行 subversion 和 Apache 服务器，它运行良好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T14:32:18.393

它是什么类型的 Mac？英特尔的可以本地运行 Windows。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-27T15:19:20.093

[使用Boot Camp](http://www.apple.com/macosx/features/bootcamp.html)在他的 Mac 上双启动 Windows ？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-10T13:15:29.897

我刚刚发现了 http://www.virtualbox.org">VirtualBox，它是 Parallels 和 Bootcamp 的免费替代品。我在我的 MacBook 上运行 Windows XP pro 完全没有问题 - 请注意，它仅适用于 Intel Mac。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-27T14:42:07.733

另一个选择是[Q Emulator](http://www.kju-app.org/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-27T15:30:06.217

实际问题是什么？如我所见，Flash dev。制作一个 Flash 电影，并在本地对其进行测试，如果它需要与服务器通信，它就是这样做的。如果 Flash 开发。想要在页面中查看它，或者查看它如何与周围的 HTML 和 Javascript 进行通信，他使用普通的 Windows 共享（又名 Samba 共享）或 FTP 或其他任何东西将文件上传到服务器，然后就可以了。

# wmi - 用于监控文件更改的 WQL 查询

> ID：483552
> 
> 赞同：0
> 
> 时间：2009-01-27T14:19:48.467
> 
> 标签：wmi, wmi-query

我需要一些帮助，因为我是 WMI Events 的新手。我正在尝试编写 WQL 查询来监视放置在特定文件夹（C:\Data）中的文件中发生的任何更改我想出了以下查询，但 WMIEvent 从未发生。

```
SELECT * FROM __InstanceModificationEvent WITHIN 1 WHERE TargetInstance ISA "CIM_DataFile" AND TargetInstance.Drive="C:" AND TargetInstance.Path="\\Data" 
```

请您向我提供任何反馈，我做错了什么，或者如果您知道其他查询文件更改的方法，我也会很感激:)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-27T15:24:04.513

我认为问题在于您没有将查询中的 \ 字符加倍。\ 是 WQL 中的保留字符，因此您必须改用 \。下面是我使用的 VBScipt 并且能够开始工作。我希望这是有帮助的！

```
Main

Sub Main()

    WScript.Echo "Initializing WMI..."

    strComputer = "." 
    Set objWMIService = GetObject("winmgmts:\\" & _
        strComputer & "\root\CIMV2") 
    Set EventSink = WScript.CreateObject( _
        "WbemScripting.SWbemSink","SINK_")

    WScript.Echo "WMI Initialized."

    query = "SELECT * FROM __InstanceModificationEvent WITHIN 1 WHERE TargetInstance ISA 'CIM_DataFile' AND TargetInstance.Path='\\data\\'"

    WScript.Echo "Executing Query..."
    set results = objWMIservice.ExecNotificationQuery(query)
    WScript.Echo "Query Returned."

    Do
        WScript.Echo "Waiting on events..."
        Set evt = results.NextEvent
        WScript.Echo "Modified Path:" + evt.TargetInstance.Path
        WScript.Echo "Modified Path:" + evt.TargetInstance.Name
    Loop
End Sub 
```

您可能也有兴趣通过一些 .NET 语言（例如 VB.NET 或 C#）使用[FileSystemWatcher来做同样的事情。](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx)

# asp.net - 如何在 ASP.Net 中配置密码恢复控件？

> ID：483562
> 
> 赞同：2
> 
> 时间：2009-01-27T14:22:11.033
> 
> 标签：asp.net

我有一个密码恢复控件，设置为询问用户他们的安全问题。我已经配置了发件人电子邮件和主题，但我收到一个运行时错误，指出未指定 SMTP 主机。

有人可以告诉我我需要在哪里设置主机吗？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T14:25:48.140

使用以下内容将 system.net 部分添加到您的 web.config：

```
<system.net>
    <mailSettings>
        <smtp deliveryMethod="Network">
            <network host="yourmailserveraddress"/>
        </smtp>
    </mailSettings>
</system.net> 
```

# java - Eclipse buildpath 自动获取内部目录的所有 JAR

> ID：483563
> 
> 赞同：20
> 
> 时间：2009-01-27T14:22:53.093
> 
> 标签：java, eclipse

如何配置我的项目构建路径以使位于同一目录中的一组 .jar 文件自动包含在构建路径中？这意味着将新的 .jar 文件添加到此目录（并刷新项目）会更新构建路径？Rem：我不是在 Web 应用程序中工作，而是在独立的 Java 应用程序中工作。我知道在动态 Web 项目中可以将位于 WEB-INF/lib 中的所有 .jar 包含在构建路径中。是否可以在独立应用程序中做同样的包含？

我正在使用 Eclipse 3.4

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-27T14:39:31.047

AFAIK，没有正常的方法可以做到这一点。

如果你真的想要，有一个小技巧。Eclipse .classpath 文件是一个非常简单的 XML。您可以编写遍历目录、更新 .classpath xml 并刷新项目的脚本或 ant 任务。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-27T15:53:26.623

使用自制的“ClassPath Container”可以解决问题，但需要您构建一个 Eclipse 插件：[http ://www.ibm.com/developerworks/edu/os-dw-os-eclipse-classpath.html](http://www.ibm.com/developerworks/edu/os-dw-os-eclipse-classpath.html)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-05-31T15:01:02.703

我的同事实现了一个类路径容器，它递归地在工作空间内的给定目录中查找 jar，看看[http://openscada.org/2010/05/31/adding-a-directory-as-class-path-to -蚀/](http://openscada.org/2010/05/31/adding-a-directory-as-class-path-to-eclipse/)

更新站点可以在[http://repo.openscada.org/p2/bob/R找到](http://repo.openscada.org/p2/bob/R)

该插件在 LGPL V3 下获得许可，您可以在[https://github.com/ctron/org.openscada.bob下找到源代码](https://github.com/ctron/org.openscada.bob)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-27T17:40:57.593

使用 Maven2，并使用 Eclipse Maven2 插件。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-27T14:40:15.617

> 这意味着将新的 .jar 文件添加到此目录（并刷新项目）会更新构建路径

抱歉，Eclipse 不支持这个。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-01-25T21:31:47.317

I built a tool which generates the .classpath (and .project), but it requires you to specify the list of jars in your ant build. It could probably be extended to read a list of jar files.

[http://sweetened.googlecode.com/](http://sweetened.googlecode.com/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-08-17T11:48:07.900

您可以使用 Eclipse 中的用户库来组织一组 jar 文件。如果您有一组在多个项目中使用的 jar 文件，您可以创建一个用户库来引用这组 jar 文件。因此，您需要在项目的构建路径中包含的只是用户库，而不是所有单独的 jar 文件。

```
<classpathentry kind="con" path="org.eclipse.jdt.USER_LIBRARY/User Library name"/> 
```

[http://www.avajava.com/tutorials/lessons/what-is-a-user-library-and-how-do-i-use-it.html;jsessionid=ACD75E0A035BDC3AC656B481A7830FB6](http://www.avajava.com/tutorials/lessons/what-is-a-user-library-and-how-do-i-use-it.html;jsessionid=ACD75E0A035BDC3AC656B481A7830FB6)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-01T02:55:56.167

在 Windows 机器上，您可以在命令行上使用单行符执行 uzhin 所说的操作。

假设您在 Eclipse 中设置了一个名为 AXIS2_HOME 的变量，该变量指向 c:\javalibs\axis2-1.4.1，此示例使用“for”命令迭代 c:\javalibs\axis\ 中的所有 .jar 文件lib 目录并将 .classpath 节点写入一个名为 addto.classpath 的文件。（注意：克拉字符 ^ 在命令行中转义了 < 和 >，因此它们不会像通常那样做。）

```
for %i in (c:\javalibs\axis2-1.4.1\lib\*.jar) do @echo     ^<classpathentry kind="var" path="AXIS2_HOME/lib/%~ni%~xi"/^>  >> addto.classpath 
```

你最终在文件中得到这样的东西......

```
<classpathentry kind="var" path="AXIS2_HOME/lib/activation-1.1.jar"/>
<classpathentry kind="var" path="AXIS2_HOME/lib/annogen-0.1.0.jar"/>
<classpathentry kind="var" path="AXIS2_HOME/lib/axiom-api-1.2.7.jar"/>
<classpathentry kind="var" path="AXIS2_HOME/lib/axiom-dom-1.2.7.jar"/>
... 
```

因此，您可以复制这些行并将它们粘贴到实际 .classpath 文件的明显位置。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-03-12T09:59:32.290

我正在使用我在阅读[类似问题](https://stackoverflow.com/questions/1194119/jar-file-folder-for-eclipse-projects)后开发的解决方法。我把它贴在这里，因为这个问题的范围有点不同，如何使用那里写的建议可能并不明显。

1.  创建新的动态 Web 项目（默认设置可以，所以速度很快）
2.  删除WebContent/WEB-INF/下的目录“lib”
3.  重新创建该目录，但将其创建为指向您的 jar 所在的主项目中的目录的链接
4.  在项目的 Java 构建路径设置中的 Order and Export 选项卡上检查 Web App Libraries 选项
5.  将此新创建的项目作为依赖项添加到您的主项目

对项目中的每个 lib 目录执行此操作很烦人，但它比每次执行 svn update 时手动添加 jars 更好（来自使用 Idea 的幸运同事）。遗憾的是 Eclipse 没有这个特性。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2009-01-27T14:27:55.250

您是否尝试过在类路径中使用通配符？所以你会使用类似的东西：

```
javac MyApp.java -cp /some/path/to/libraries/*.jar 
```

我有一段时间没有使用 java，所以不确定上述是否可行，但这是我期望的语法。

# sql-server - 如何在 SQL Server Management Studio 2008 中自动执行“生成脚本”任务？

> ID：483568
> 
> 赞同：106
> 
> 时间：2009-01-27T14:24:14.090
> 
> 标签：sql-server, visual-studio-2008, automation, ssms, sql-server-2008

我想在 SQL Server Management Studio 2008 中自动生成脚本。

现在我要做的是：

*   右键单击我的数据库，任务，“生成脚本...”
*   手动选择我需要的所有导出选项，然后在“选择对象”选项卡上点击全选
*   选择导出文件夹
*   最终点击“完成”按钮

有没有办法自动化这个任务？

编辑：我想生成**创建**脚本，而不是更改脚本。

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2012-07-25T17:27:06.717

与 SSMS 中的脚本生成相比，SqlPubwiz 的选项非常有限。相比之下，[SMO](http://msdn.microsoft.com/en-us/library/ms220218)可用的选项几乎与 SSMS 中的选项完全匹配，这表明它甚至可能是相同的代码。（我希望 MS 没有写两次！）在 MSDN 上有几个像[这样](http://msdn.microsoft.com/en-us/library/ms162153)的例子，将脚本表显示为单独的对象。但是，如果您希望使用包含“DRI”（声明性引用完整性）对象（如外键）的“完整”架构正确编写所有脚本，那么单独编写脚本表无法正确解决依赖关系。我发现有必要收集所有 URN 并将它们作为数组交给脚本编写者。此代码，从示例修改，

```
 using Microsoft.SqlServer.Management.Smo;
    using Microsoft.SqlServer.Management.Sdk.Sfc;
    // etc...

    // Connect to the local, default instance of SQL Server. 
    Server srv = new Server();

    // Reference the database.  
    Database db = srv.Databases["YOURDBHERE"];

    Scripter scrp = new Scripter(srv);
    scrp.Options.ScriptDrops = false;
    scrp.Options.WithDependencies = true;
    scrp.Options.Indexes = true;   // To include indexes
    scrp.Options.DriAllConstraints = true;   // to include referential constraints in the script
    scrp.Options.Triggers = true;
    scrp.Options.FullTextIndexes = true;
    scrp.Options.NoCollation = false;
    scrp.Options.Bindings = true;
    scrp.Options.IncludeIfNotExists = false;
    scrp.Options.ScriptBatchTerminator = true;
    scrp.Options.ExtendedProperties = true;

    scrp.PrefetchObjects = true; // some sources suggest this may speed things up

    var urns = new List<Urn>();

    // Iterate through the tables in database and script each one   
    foreach (Table tb in db.Tables)
    {
        // check if the table is not a system table
        if (tb.IsSystemObject == false)
        {
            urns.Add(tb.Urn);
        }
    }

    // Iterate through the views in database and script each one. Display the script.   
    foreach (View view in db.Views)
    {
        // check if the view is not a system object
        if (view.IsSystemObject == false)
        {
            urns.Add(view.Urn);
        }
    }

    // Iterate through the stored procedures in database and script each one. Display the script.   
    foreach (StoredProcedure sp in db.StoredProcedures)
    {
        // check if the procedure is not a system object
        if (sp.IsSystemObject == false)
        {
            urns.Add(sp.Urn);
        }
    }

    StringBuilder builder = new StringBuilder();
    System.Collections.Specialized.StringCollection sc = scrp.Script(urns.ToArray());
    foreach (string st in sc)
    {
        // It seems each string is a sensible batch, and putting GO after it makes it work in tools like SSMS.
        // Wrapping each string in an 'exec' statement would work better if using SqlCommand to run the script.
        builder.AppendLine(st);
        builder.AppendLine("GO");
    }

    return builder.ToString(); 
```

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2010-05-06T18:06:16.380

Brann 在 Visual Studio 2008 SP1 Team Suite 中提到的是 1.4 版的数据库发布向导。它与 sql server 2008（也许只有专业版？）一起安装到 \Program Files\Microsoft SQL Server\90\Tools\Publishing\1.4。来自服务器资源管理器的 VS 调用只是调用它。您可以通过命令行实现相同的功能，例如：

```
sqlpubwiz help script 
```

我不知道 v1.4 是否有与 v1.1 相同的麻烦（用户被转换为角色，没有按正确的顺序创建约束），但这对我来说不是解决方案，因为它没有脚本对象到不同的文件，如 SSMS 中的 Tasks->Generate Scripts 选项。我目前正在使用 Scriptio 的修改版本（使用 MS SMO API）作为数据库发布向导 (sqlpubwiz.exe) 的改进替代品。它目前无法从命令行编写脚本，我可能会在未来添加该贡献。

Scriptio 最初发布在 Bill Graziano 的博客上，但随后由 Bill 发布到 CodePlex 并由其他人更新。阅读讨论以了解如何编译以用于 SQL Server 2008。

[http://scriptio.codeplex.com/](http://scriptio.codeplex.com/)

编辑：我已经开始使用 RedGate 的 SQL 比较产品来做到这一点。它是所有 sql 发布向导的一个很好的替代品。您选择数据库、备份或快照作为源，并选择文件夹作为输出位置，它会将所有内容都很好地转储到文件夹结构中。它恰好与他们的其他产品 SQL Source Control 使用的格式相同。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2013-09-06T17:17:51.120

[我编写了一个名为SchemaZen](https://github.com/sethreno/schemazen#schemazen---script-and-create-sql-server-objects-quickly)的开源命令行实用程序来执行此操作。它比管理工作室的脚本要快得多，而且它的输出对版本控制更友好。它支持脚本模式和数据。

要生成脚本运行：

```
schemazen.exe 脚本 --server localhost --database db --scriptDir c:\somedir
```

然后从脚本运行重新创建数据库：

```
schemazen.exe 创建 --server localhost --database db --scriptDir c:\somedir
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-01-27T14:41:51.340

您可以使用 SQL Server 管理对象 (SMO) 自动执行 SQL Server 2005 管理任务，包括生成脚本：[http://msdn.microsoft.com/en-us/library/ms162169.aspx](http://msdn.microsoft.com/en-us/library/ms162169.aspx)。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-01-27T15:01:46.133

如果您是开发人员，请务必选择 SMO。这是 Scripter 类的链接，这是您的起点：

[脚本类](http://msdn.microsoft.com/en-us/library/ms162153.aspx)

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2011-10-13T06:55:46.643

我没有看到任何这些答案中提到的带有 SQLPSX 的 powershell ......我个人没有玩过它，但它看起来非常简单易用，非常适合这种类型的自动化任务，任务如下：

```
Get-SqlDatabase -dbname test -sqlserver server | Get-SqlTable | Get-SqlScripter | Set-Content -Path C:\script.sql
Get-SqlDatabase -dbname test -sqlserver server | Get-SqlStoredProcedure | Get-SqlScripter
Get-SqlDatabase -dbname test -sqlserver server | Get-SqlView | Get-SqlScripter 
```

（参考：[http](http://www.sqlservercentral.com/Forums/Topic1167710-1550-1.aspx#bm1168100) ://www.sqlservercentral.com/Forums/Topic1167710-1550-1.aspx#bm1168100 ）

项目页面：[http ://sqlpsx.codeplex.com/](http://sqlpsx.codeplex.com/)

这种方法的主要优点是它结合了直接使用 SMO 的可配置性/可定制性，以及使用简单的现有工具（如数据库发布向导）的便利性和可维护性。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-01-27T14:27:24.863

在“工具”>“选项”>“设计器”>“表和数据库设计器”中，有一个“自动生成更改脚本”选项，它将为您在保存时所做的每个更改生成一个。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-01-27T14:36:13.440

您可以使用 INFORMATION_SCHEMA 表使用 T-SQL 代码来完成此操作。

还有第三方工具——我喜欢 Apex SQL Script 正是因为你正在谈论的用途。我完全从命令行运行它。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-01-27T14:57:44.363

如果您想要 Microsoft 解决方案，您可以尝试：Microsoft SQL Server Database Publishing Wizard 1.1

[http://www.microsoft.com/downloads/details.aspx?FamilyId=56E5B1C5-BF17-42E0-A410-371A838E570A&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyId=56E5B1C5-BF17-42E0-A410-371A838E570A&displaylang=en)

它创建了一个批处理过程，您可以在需要重建脚本时随时运行。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2019-01-29T12:35:48.447

尝试**新的 SQL Server 命令行工具来生成 T-SQL 脚本**并监控动态管理视图。

像魅力一样为我工作。它是 Microsoft 的一个新的基于 python 的工具，可以从命令行运行。一切都像微软页面上描述的那样工作（见下面的链接）为我工作了 SQL 2012 服务器。

你用 pip 安装它：

> $pip 安装 mssql-scripter

像往常一样使用 h 获取帮助的命令参数概述：

> mssql-scripter -h

提示：如果您通过 Windows 身份验证登录 SQL-Server，只需留下用户名和密码。

[https://cloudblogs.microsoft.com/sqlserver/2017/05/17/try-new-sql-server-command-line-tools-to-generate-t-sql-scripts-and-monitor-dynamic-management-意见/](https://cloudblogs.microsoft.com/sqlserver/2017/05/17/try-new-sql-server-command-line-tools-to-generate-t-sql-scripts-and-monitor-dynamic-management-views/)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-11-30T08:30:14.747

我一直在使用 DB Comparer - 它的整个 DB 免费且无需大惊小怪的脚本，可以与另一个 DB 进行比较，还可以生成 Diff 脚本。非常适合从开发到生产更改脚本。 [http://www.dbcomparer.com/](http://www.dbcomparer.com/)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-11-27T14:04:32.677

我还为我的需要构建了这个简单的命令行工具。
[http://mycodepad.wordpress.com/2013/11/18/export-ms-sql-database-schema-with-c/](http://mycodepad.wordpress.com/2013/11/18/export-ms-sql-database-schema-with-c/)

它可以导出整个数据库，并尝试导出加密对象。一切都存储在文件夹和单独的 sql 文件中，以便于文件比较。

代码也可以在 github 上找到。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-27T15:12:18.797

从 Visual Studio 2008 SP1 团队套件：

在服务器资源管理器/数据连接选项卡中，有一个发布到提供程序工具，其功能与“Microsoft SQL Server 数据库发布向导”相同，但与 MS Sql Server 2008 兼容。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-07-07T07:44:21.177

我正在使用 VS 2012（对于 MSSQL Server 2008 上的数据库）比较数据库有一个保存它的选项，比较和选项。这基本上是您的交付设置。之后，您可以更新或生成脚本。

我只是觉得稍后从文件中加载它有点尴尬（从 Windows 资源管理器拖放），因为我在解决方案资源管理器中看不到该文件。

# visual-studio-2008 - ASP.Net 图表不可用

> ID：483572
> 
> 赞同：1
> 
> 时间：2009-01-27T14:25:01.747
> 
> 标签：visual-studio-2008, charts

我现在不知所措了，我已经用谷歌搜索了这个，但一无所获。

我安装了带有 Service Pack 1 的 Visual Studio 2008 Professional。显然，我还安装了 .Net Framework 3.5 SP1。我已经安装了 ASP.Net Charting 以及 VS08 插件。但是我无法在任何地方找到控件。我尝试从已安装的 DLL 添加控件，但出现错误：“在此程序集中找不到控件”。我什至在我的机器上卸载并重新安装了所有东西。

我做错了什么还是我完全看错了地方？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T14:39:19.207

我遇到了工具没有出现的问题，我手动添加了工具。当您浏览 dll 时，该文件夹中应该有 4 个 dll，2 个用于 web 和 2 个用于 windows 窗体，在 2 个 dll 中，命名空间中有一个设计，您想要另一个。抱歉，它有点神秘，我无法在分钟时访问带有它的电脑，但稍后会检查全名。

# c# - 下一个方法的术语名称是什么：A a = new A { Prop1 = a, Prop2 = b };

> ID：483574
> 
> 赞同：0
> 
> 时间：2009-01-27T14:25:33.960
> 
> 标签：c#, .net, properties, constructor

您能否提示如何正确命名在对象创建时设置公共属性值的对象构造方法？

例如，

```
SqlCommand command = new SqlCommand { Connection = connection, CommandType = CommandType.Text }; 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-27T14:27:13.957

我相信这些被称为对象初始化器......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T14:30:03.453

JPunyon 是正确的..

有关详细信息，请参阅[http://msdn.microsoft.com/en-us/library/bb384062.aspx](http://msdn.microsoft.com/en-us/library/bb384062.aspx)

# php - 用php修剪或转换mysql日期字段

> ID：483579
> 
> 赞同：0
> 
> 时间：2009-01-27T14:26:30.073
> 
> 标签：php, mysql

我正在使用 php 的表中显示 mysql 中日期时间字段的内容，并且只想显示日期。有没有办法转换或执行此操作，或者必须编辑或修剪实际的字符串？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T14:31:14.463

## 使用 strtotime...

一个简单的方法是这样的：

```
$date="2009-01-27 14:30:22";
echo strftime("%d %m %Y", strtotime($date)); 
```

[即使用strtotime](http://php.net/strtotime)将您的 mysql 日期转换为时间值，然后使用[strftime](http://php.net/strftime)重新格式化它。

但是，这仅适用于可以由[unix 时间戳](http://en.wikipedia.org/wiki/Unix_time)表示的日期 - 因此没有 1970 年 1 月 1 日之前或[2038年之后的日期](http://en.wikipedia.org/wiki/Year_2038_problem)

## 使用 PEAR 的 Date 类...

[PEAR Date 类](http://pear.php.net/package/Date/docs/1.5.0a1/Date/Date.html)用于更彻底的方法，应该更好地处理历史日期：

```
$date=new void Date("2009-01-27 14:30:22");
echo $date->format("%d %m %Y"); 
```

## ...或使用您的数据库

或者，让您的数据库使用[DATE_FORMAT为您格式化](http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html#function_date-format)

```
SELECT col1,col2,DATE_FORMAT(col2, '%W %M %Y') as col2readable FROM mytable; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T14:35:36.763

你可以用 PHP 来做，但如果你不需要额外的包袱，你可以考虑在你的查询中做，只返回你需要的。此示例使用[DATE_FORMAT()](http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html#function_date-format)：

```
"SELECT col1, col2, DATE_FORMAT(dateCol, '%d-%m-%Y') as 'newDate' 
 FROM tablename" 
```

# javascript - EXTJS 组合框在展开后未按 valueField 选择

> ID：483591
> 
> 赞同：5
> 
> 时间：2009-01-27T14:28:21.333
> 
> 标签：javascript, combobox, extjs

我已经编写了一些运行良好的代码，但是我有一个奇怪的错误这里是一个例子......

* * *

## **[请观看我的 COMBOBOX BUG 视频](http://vimeo.com/3112710)**

* * *

就像我说的，每次触发 datachanged 时效果都很好 - 选择了正确的索引并显示了 displayField，但是每次我在组合框中键入一些文本之后，当“datachanged”触发时，它不会显示 displayField。相反，它显示来自我启动的 setValue 方法的值。

奇怪的是，如果我不输入文本并用鼠标更改选择，就没有错误。最后，这仅在我在组合框中键入文本时出现。

有没有人听说过这个错误，有解决方案或一些明智的建议？

## 编码 ！

**两个数据存储**：

```
ficheDataStore = new Ext.data.Store({
    id: 'ficheDataStore',
    autoLoad: true,
    proxy: new Ext.data.HttpProxy({
        url: 'ficheDetail.aspx',      // File to connect to
        method: 'GET'
    }),
    baseParams: { clientId: clientId, Type: 'Fiche' }, // this parameter asks for listing
    reader: new Ext.data.JsonReader({   // we tell the datastore where to get his data from
        root: 'results'
    }, [
        { name: 'GUID', type: 'string', mapping: 'GUID' },
        { name: 'TagClient', type: 'string', mapping: 'TagClient' },
        { name: 'Nom', type: 'string', mapping: 'Nom' },
        { name: 'Compteur', type: 'string', mapping: 'CompteurCommunes' },
        { name: 'CompteurCommunesFacturation', type: 'string', mapping: 'CompteurCommunesFacturation' },
        { name: 'AdresseFacturation', type: 'string', mapping: 'AdresseFacturation' },
        { name: 'Codes', type: 'string', mapping: 'Codes' },
        { name: 'Observations', type: 'string', mapping: 'Observations' },
        { name: 'Adresse', type: 'string', mapping: 'Adresse' }

      ])
});

 communesDataStore = new Ext.data.Store({
    autoLoad: true,
    proxy: new Ext.data.HttpProxy({ url: 'ficheDetail.aspx?Type=Communes' }),
    reader: new Ext.data.JsonReader({ root: 'results' }, [{ name: 'Compteur' }, { name: 'Localisation'}])
}); 
```

* * *

> 谁首先返回这样的东西：

```
 {results:[{"Nom":"cercle interieur"},{"Observations":""},{"Codes":" "},{"Adresse":"dd"},{"CompteurCommunes"
    :"1"},{"TagClient":"3-56"},{"GUID":"443609c6-d064-4676-a492-7baa7b4288d1"},{"AdresseFacturation":""}
    ,{"CompteurCommunesFacturation":"1"}]} 
```

> 对于后者 ：

```
{"results":[{ "Compteur" : "1","Localisation" : "6200  ST ISIDORE"},{ "Compteur" : "2","Localisation"
 : "21340 CHANGE"},{ "Compteur" : "3","Localisation" : "1200  ELOISE"},{ "Compteur" : "4","Localisation"
 : "1200  ST GERMAIN SUR RHONE"},{ "Compteur" : "5","Localisation" : "75000 PARIS"},{ "Compteur" : "6"
,"Localisation" : "75001 PARIS 1ER ARRONDISSEMENT"}]} 
```

* * *

**一个`Combobox`**：

```
 var comb = new Ext.form.ComboBox(
             {
               store: communesDataStore,
               fieldLabel: 'Code postal',
               // hiddenName: 'Compteur',
               name: 'CompteurCommune',
               id: 'CompteurCommunes',
               width: 300,
               typeAhead: true,
               mode: 'local',
               minChars: 0,
               selecOnFocus: true,
               forceSelection: true,
               valueField: 'Compteur',
               displayField: 'Localisation',
               autocomplete: true,
               emptyText: 'Selectionnez un code postal',
               triggerAction: 'all',
               value: ''
              }); 
```

如果**`datachanged`**我设置了**`Combobox`**“CompteurCommunes”的新值：

```
 ficheDataStore.addListener('datachanged', handleDatachangedEvent);

     function handleDatachangedEvent() 
       {
        try {
              comb.setValue(ficheDataStore.getAt(4).data.Compteur);                                                                                 
            }
        catch (err) { }
        } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-07T12:18:43.033

这可能是因为当您在组合中输入随机数据时，它可能无法每次都找到正确的 fieldValue。然后它*停留*在最后一个不存在的值。

在 datachanged 事件处理程序中执行 new setValue() 之前，尝试将 ComboBox 设置为任何*现有值（在组合的数据存储中）。*或者您可以尝试使用 clearValue() 方法重置之前的（未定义的）valueField。

还有 initList() 方法将组合重置为初始状态。

编辑：经过一些测试，我发现： **combo.store.clearFilter();** 必须在外部事件处理程序中的 setValue 之前使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-04-21T18:27:47.710

```
function formatComboBox(value, metaData, record, rowIndex, colIndex, store) {
        myStore = Ext.getCmp('myComboBox');
        myStore.clearFilter();
        var idx = myStore.find('value',value);
        return (idx != '-1') ? myStore.getAt(idx).data.label : value;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-06T19:10:44.590

首先，Ext JS 组合框应该自动应用值并在选择项目时显示，除非您已分配商店并告诉 Ext 该字段需要一个值。

您似乎要求的值 (CompteurCommunes) 不会出现在您的读者定义中，因此它将是数据存储中记录的一部分。

您尝试为 ComboBox 设置此值的根本原因是什么？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-07T12:47:14.363

你可以看看 Ext.form.ComboBox 的 hiddenName 和 hiddenId 参数。如果您设置与组合框链接的隐藏表单字段的值，那么组合框将呈现该值的标签而不是值本身。

当您需要在服务器端设置值并将用户定向到页面时，这很有用。

另一个有用的方法是 selectByValue。此方法将选择值等于传递参数的元素。

在您的 dataChangedListener 中，您应该设置与 ComboBox 关联的值隐藏表单字段，而不是设置组合框的值。此外，在设置隐藏字段的值后，您可能必须触发 selectByValue 方法。

您可以查看 ExtJS API 文档以供进一步参考。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-06-24T06:02:58.227

万一有人 - 像我一样 - 通过谷歌到达这里，因为它与他们的 ComboBox ft. setValue() 问题最相似：

经过一个小时的深入了解 Ext 的内部结构后，我发现我需要为组合框设置**lazyInit: false**。它默认为 true，如果您不知道这一点，则为 true 可能会导致不合逻辑的行为。你为什么要这样做？默认情况下，其他任何东西似乎都不是懒惰的。

# php - 获取 Wordpress Rss 文件

> ID：483594
> 
> 赞同：0
> 
> 时间：2009-01-27T14:28:40.820
> 
> 标签：php, wordpress, rss

我正在运行一个 wordpress 博客，并希望访问创建提要的实际文件。不幸的是，当我这样做时，它会引发很多错误，因为它使用了很多功能。

我目前最好的想法是制作一个不需要这些功能或硬编码的重复文件，但我想对此获得第二意见。

我正在运行 WP2.7。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T14:56:38.843

将文件移动到单个文件中是显而易见的解决方案。问题是你为什么首先需要这个文件？

如果您只想轻松地从数据库中提取帖子并将它们格式化为 RSS 提要，您可以完全放弃 WP 并使用少于 30 行代码的文件来完成这一切。

罗伊。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T14:56:54.333

*   找到文件“wp-includes/feed-rss2.php”（交换您想要使用的任何提要）
*   创建文件的第二个版本，这样您就不会覆盖任何 WP 内容，然后打开所述文件。
*   在执行任何其他代码之前添加以下代码：

    ```
    if (file_exists('../wp-blog-header.php'))
       require('../wp-blog-header.php');
    elseif (file_exists('blog/wp-blog-header.php'))
       require('blog/wp-blog-header.php');
    //The second line is needed if you are including this file from somewhere else 
    ```

此解决方案比 RoyPel 的解决方案实施得更快，但不如 RoyPel 的解决方案那么好。

# asp.net - 屏蔽外部 URL

> ID：483596
> 
> 赞同：1
> 
> 时间：2009-01-27T14:29:20.647
> 
> 标签：asp.net, security-by-obscurity

我需要能够在我的网站中打开一个外部 URL，而不向我的用户（在浏览器和源中）显示它。我不希望他们能够复制 URL 并根据自己的喜好编辑查询字符串。有没有办法在 iframe 或类似的东西中打开 URL，并隐藏/屏蔽其来源？

这是一个asp.net 2.0 网站。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T14:31:39.830

不可以。如果您让客户端机器做某事（即，将他们的浏览器指向一个网页），您不能向他们隐瞒这些信息。

您可以在 Flash 小部件或其他容器中呈现该页面服务器端，但您不能在客户端计算机上执行此操作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-27T14:55:31.420

你能做到以下几点：

1.  接受来自用户的参数。
2.  有一个网页或后端进程使用它来将 PDF 下载到临时商店。
3.  然后将其流式传输到客户端，因此他们不知道生成 PDF 的 URL？（或直接流式传输，无需临时下载。）

这样用户就永远不会知道其他站点，并且它应该更加安全。

这也可以使用一些验证/身份验证，因此用户无法更改传递的参数以检索其他用户的 PDF。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T14:37:00.130

最佳选择：您可以发出服务器端 XMLHTTP 请求，获取响应并使用 AJAX 反馈回您的页面。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T14:38:08.617

您可以通过以下方式在服务器端进行：

1.  打开到您想要的站点的网络连接
2.  从 URL 上的 HTML/Get 请求中获取 HTML
3.  将其插入服务器端的页面

不过，这可能会大大减慢您的页面加载速度，并且可能会伴随法律问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-27T14:58:41.740

不久前我自己也遇到了类似的问题，并按照这些思路做了一些事情（C# .NET 2.0）；

```
 public void StreamURLContents(string URL)
    {
        WebRequest req = WebRequest.Create(URL);

        using (HttpWebResponse resp = (HttpWebResponse)req.GetResponse())
        using (Stream dataStream = resp.GetResponseStream())
        using (StreamReader reader = new StreamReader(dataStream))
        {
            string currentLine = reader.ReadLine();
            while (currentLine != null)
            {
                Response.Write(currentLine);
                currentLine = reader.ReadLine();
            }
        }
    } 
```

显然，您必须调整 HTML 的编写以适合您的特定应用程序，并且您会破坏目标站点中的所有相关链接（图像 URL、CSS 链接等），但如果您只追求简单的文本HTML 并希望您的 Web 应用程序在服务器端获取它，那么这是一个不错的方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-28T06:09:26.193

您可以通过执行以下操作创建一次性 URL：

1.  将 GUID 存储在数据库中
2.  允许客户端通过超链接或其他方式请求 GUID。在 URL 中使用 GUID 作为假页面；示例： http: [//www.company.com/foo/abc-123-efg-456.aspx](http://www.company.com/foo/abc-123-efg-456.aspx)
3.  使用 URL 重写来捕获和检查对目录“foo”的所有请求并重定向到您的处理程序。
4.  确认 GUID 有效，然后在数据库中将其标记为“过期”
5.  将适当的数据（PDF？）作为对请求的响应发送给客户端。
6.  对同一 URL 的任何后续请求都会失败。

# c++ - 如何在 C++ 中将十六进制数字转换为二进制？

> ID：483609
> 
> 赞同：12
> 
> 时间：2009-01-27T14:32:37.473
> 
> 标签：c++, binary, hex

我正在上一门 C++ 入门课程，并且想在十六进制表示和二进制之间转换字母。我可以使用以下方法打印出十六进制数字：

```
for(char c = 'a'; c <= 'z'; c++){
    cout << hex << (int)c;
} 
```

但我不能对二进制做同样的事情。没有`std::bin`我可以用来将十进制数字转换为二进制的。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-01-27T14:43:23.957

像这样：

```
for(char c = 'a'; c <= 'z'; c++){
        std::bitset<sizeof(char) * CHAR_BIT> binary(c); //sizeof() returns bytes, not bits!
        std::cout << "Letter: " << c << "\t";
        std::cout << "Hex: " << std::hex << (int)c << "\t";
        std::cout << "Binary: " << binary << std::endl;
    } 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-27T14:35:30.493

C++ 中没有二进制 io 操纵器。您需要手动执行覆盖，可能使用位移运算符。实际的转换不是一项艰巨的任务，因此应该在 C++ 初学者的能力范围内（而它未包含在标准库中的事实可能不是:)）

编辑：很多其他人都举了例子，所以我要给出我喜欢的方法

```
void OutputBinary(std::ostream& out, char character)
{
  for (int i = sizeof(character) - 1; i >= 0; --i)
  {
    out << (character >> i) & 1;
  }
} 
```

这也可能被模板化为任何数字类型。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-27T14:39:30.827

对于多样性，您也可以使用 16 元素查找表来完成。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-27T14:39:52.700

您可以轻松地编写十六进制字符与其二进制“半字节”之间的映射：

```
std::string HexCharToNibble( char c ) {
switch (c) {
  case '0': return "0000";
  case '1': return "0001";
  //... fill in the rest
  case 'f': return "1111";
  default: assert(false); return "bad input";
}; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-27T14:39:45.103

你可以这样做：

```
for(char c = 'a'; c <= 'z'; c++){
    // char is 8 bits.  print 4 bits
    // at a time, starting with the MSB
    for (int i = 4; i>=0; i-=4) {
        switch (((int)c >> i) & 0xf) {
            case 0:
                cout << "0000";
                break;
            case 1:
                cout << "0001";
                break;
            .
            .
            .
            case 0xf:
                cout << "1111";
                break;

        }
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T14:51:26.233

这听起来像是一项作业，在这种情况下，你真的应该向你的老师寻求帮助。从长远来看，从互联网上寻求家庭作业的解决方案并不能真正帮助你（除非你进入项目管理领域）。

在评论中回答 chustar（OQ'er），我必须同意，如果您了解如何做到这一点，它如何/为什么起作用，以及将来如何自己弄清楚，那么是的，那将是一件好事。

然而，他标记为“正确”的答案证明了这一论点是谎言。它只包含代码，以“Like so”开头。很明显，OQ'er 寻找的*不是*解释，而是有人为他编写代码。

# perl - 如何在 Perl 中捕获鲤鱼的输出？

> ID：483622
> 
> 赞同：13
> 
> 时间：2009-01-27T14:36:05.297
> 
> 标签：perl, warnings, try-catch

我正在编写一个 Perl 模块，并且我正在使用 carp 向调用程序抛出一个非致命警告。

carp 警告工作正常 - 我正在检查输入参数是否满足特定条件 - 如果它不满足条件，则会使用 carp 发送警告，并且模块继续使用参数的默认值而不是调用程序的参数通过了。警告只是通知正在使用默认参数而不是传入的参数。

我的问题是我的测试脚本。我的测试脚本向模块发送了一个错误的参数，我试图捕捉返回的警告消息并确保我得到了正确的警告消息。

我的模块看起来像这样：

```
else {
  carp "value must be numeric - using default value";
} 
```

我的测试脚本如下所示：

```
eval {
  #call to my module
};
like (
    $@,
    qr/value must be numeric/,
    "Should abort on non-numeric value"
); 
```

当我运行测试时，我可以在屏幕上看到警告（它必须进入 STDERR），但 $@ 变量的内容是 '' - 空白。

这是我的测试脚本的输出：

```
t/04bad_method_calls....ok 10/12value must be numeric - using default value at ...
#   Failed test 'Should abort on non-numeric value'
#   at t/04bad_method_calls.t line 98.
t/04bad_method_calls....NOK 12
#                   '' doesn't match '(?-xism:value must be numeric)'
# Looks like you failed 1 test of 12. 
```

如果我将鲤鱼改为呱呱，我的测试脚本就可以工作——它会捕获错误消息（但我只想警告，而不是中止）。

老实说，我对 eval 没有最好的理解——也许这不是捕捉 carp 警告输出的最佳方法。我尝试使用 $SIG{__WARN__}，但那也是空的。

有什么方法可以捕获鲤鱼的输出吗？这不是最大的问题，因为这只是在我的测试脚本中，但我仍然想让我的测试脚本正常工作。

提前致谢！

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-27T15:00:44.217

在此页面[http://perldoc.perl.org/perlvar.html](http://perldoc.perl.org/perlvar.html)中，您似乎希望将本地设置`$SIG{__WARN__}`为一个子例程，该子例程会将警告转换为测试脚本的致命错误。他们给出的例子是：

```
local $SIG{__WARN__} = sub { die $_[0] };
eval $proggie; 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-27T16:06:23.943

如何捕获警告以及所有`STDERR`输出的另一种方法：

```
my $stderr = '';
{
    local *STDERR;
    open STDERR, '>', \$stderr;
    do_stuf_here();
}
like( $stderr, qr/my result/, 'test stderr output' ); 
```

可以制作花哨的测试功能：

```
sub stderr_test (&$$) {
    my ( $code, $pattern, $text ) = @_;
    my $result = '';
    {
        local *STDERR;
        open STDERR, '>', \$result;
        $code->();
    }
    if ( UNIVERSAL::isa( $pattern, 'Regexp' ) ) {
        like( $result, $pattern, $text );
    }
    else {
        is( $result, $pattern, $text );
    }
}

# usage
stderr_test {do_stuf_here} qr/my expected STDERR output/,
    'stderr is like';
stderr_test {do_stuf_here} 'my expected STDERR output',
    'stderr is exactly'; 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-27T18:09:01.467

如果您从测试脚本执行此操作，则可以使用为您捕获输出的 Test::* 模块。我倾向于喜欢[Test::Output](http://search.cpan.org/dist/Test-Output)。

# c++ - C++ 中的 XA 分布式事务

> ID：483652
> 
> 赞同：1
> 
> 时间：2009-01-27T14:43:23.630
> 
> 标签：c++, xa

有没有很好的 C++ 框架来实现 XA 分布式事务？

术语“好”是指可用、简单（并不意味着“容易”）、结构良好。

由于学习原因，目前我正在按照 X/Open XA 规范进行个人实现。

先感谢您。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T15:09:38.490

我不知道有任何成熟度的开源或免费事务监视器，尽管[这个链接](http://linuxfinances.info/info/tpmonitor.html)确实有一些扇出。现有的商业产品是[BEA 的 Tuxedo、](http://www.bea.com/framework.jsp?CNT=index.htm&FP=/content/products/tux/) Tibco 的[Enterprise Message Service](http://www.tibco.com/software/messaging/enterprise_messaging_service/default.jsp)（实际上是一个像 IBM 的 MQ 一样的事务性消息队列管理器）和 Transarc 的[Encina](http://publib.boulder.ibm.com/infocenter/txformp/v5r1/index.jsp?topic=/com.ibm.txseries510.doc/aetgpk0012.htm)（现在归 IBM 所有）。这些系统都*非常*昂贵。

如果您想自己制作（顺便通过填补开源软件领域的空白来为自己赢得一点名气），请获取[Gray and Reuter](https://rads.stackoverflow.com/amzn/click/com/1558601902)的副本。这是关于事务处理系统架构的权威著作，由该领域的两位最重要的专家撰写。

有趣的是，他们声称可以在大约 10,000 行 C 中实现一个有效的 TP 监视器。这实际上听起来很合理，因为它所做的并不是那么复杂。有时我很想尝试。

本质上，您需要创建一个作为守护进程运行的分布式事务协调器。您将需要让资源管理器协议从中工作，因此将其作为原型开始可能是一个好的开始。如果您可以让它独立回滚或提交事务，那么您就有了 TM-RM 接口的基础。

规范中定义的 XA API 是控制事务管理器的 API。严格来说，你不需要创建一个 3 层架构来使用这种分布式事务，但是如果没有 TP 监视器，它们或多或少是没有意义的。您如何从前端到中间层进行通信可以留给读者作为练习。您可能最好使用现有的 ORB，其中有几个很好的开源实现可用。

根据您是否要使 DTC 和应用程序服务器分离进程（这可能是出于稳定性考虑，但并非绝对必要），您还可以使用 ACE 作为 DTC 服务器的基础。

如果您想制作高性能的中间层服务器，请查看 Douglas Schmidt 的[ACE 框架](http://www.cs.wustl.edu/~schmidt/ACE-overview.html)。它带有一个称为 TAO 的 ORB，并且足够灵活，可以让您或多或少地使用您喜欢的任何线程模型。使用它是在学习它和自己编写和调试所有同步和并发问题之间的权衡。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-01-15T20:33:10.013

您的任务可能很晚，但它对其他用户可能有用：[LIXA](https://sourceforge.net/projects/lixa/)不是“框架”，但它提供了 TX 事务划分规范的实现并支持大多数 XA 功能。TX 规范适用于 C 和 COBOL 语言，但 C 版本在 C++ 项目中的集成应该毫不费力。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2019-06-28T10:27:06.123

其他选择是开源[Enduro/X 分布式事务处理框架](https://github.com/endurox-dev/endurox)，它允许编写简单的 C/C++ 服务，这些服务可以与资源管理器（例如数据库）一起操作，并提供提交或中止由相同/不同物理服务器上的多个不同可执行文件完成的工作的能力使用不同的资源/数据库。

内部使用 XA 2PC。

# perl - 如何在 Perl 中将二进制字符串转换为数字？

> ID：483655
> 
> 赞同：38
> 
> 时间：2009-01-27T14:43:29.573
> 
> 标签：perl, binary

如何在 Perl中将二进制字符串`$x_bin="0001001100101"`转换为其数值？`$x_num=613`

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2009-01-27T14:56:31.357

我的首选方式是：

```
$x_num = oct("0b" . $x_bin); 
```

* * *

引自`man perlfunc`：

```
    十月 EXPR
    oct 将 EXPR 解释为八进制字符串并返回
            对应的值。（如果 EXPR 恰好启动
            用“0x”关闭，将其解释为十六进制字符串。如果
            EXPR 以“0b”开头，它被解释为
            二进制字符串。前导空格被忽略
            所有三种情况。）

```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-01-27T14:46:50.313

```
sub bin2dec {
    return unpack("N", pack("B32", substr("0" x 32 . shift, -32)));
} 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-01-27T16:23:31.540

像往常一样，这里还应该提到一个出色的 CPAN 模块：[Bit::Vector](http://search.cpan.org/~stbey/Bit-Vector/Vector.pod)。

转换看起来像这样：

```
use Bit::Vector;

my $v = Bit::Vector->new_Bin( 32, '0001001100101' );
print "hex: ", $v->to_Hex(), "\n";
print "dec: ", $v->to_Dec(), "\n"; 
```

二进制字符串几乎可以是任意长度，您可以执行其他简洁的操作，例如位移等。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-01-28T00:28:10.593

实际上你可以在前面贴上'0b'，它被视为二进制数。

```
perl -le 'print 0b101'
5 
```

但这仅适用于裸词。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-01-30T20:56:09.287

您可以使用该`eval()`方法来解决裸字限制：

```
eval "\$num=0b$str;"; 
```

# web-services - MIME 类型 Web 服务的文件扩展名？

> ID：483656
> 
> 赞同：11
> 
> 时间：2009-01-27T14:43:45.657
> 
> 标签：web-services, language-agnostic, mime-types, file-extension

是否有任何 Web 服务允许我提供文件扩展名并返回可能的 MIME 类型列表？

例如：

```
http://mimetype.com/getMime/doc 
```

哪个可以返回：

```
application/msword,application/docappl/text,application/vnd.msword,application/vnd.ms-word,application/winword,application/word,application/x-msw6,application/x-msword 
```

我不想使用[Urlmon.dll](https://stackoverflow.com/questions/58510/in-c-how-can-you-find-the-mime-type-of-a-file-based-on-the-file-signature-not-th)，而且我不想让我自己的列表保持最新。

谢谢

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-08-19T08:14:17.540

我刚刚创建了它作为我的 mimetype <-> 图标服务的一部分

[http://stdicon.com/](http://stdicon.com/)

例如 ：

[http://stdicon.com/ext/html](http://stdicon.com/ext/html)

它在 appengine 上运行，因此它应该具有高可用性。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-30T11:14:29.813

我唯一能想到的就是解析 apache 服务器 [mime.types](http://svn.apache.org/repos/asf/httpd/httpd/branches/2.0.x/docs/conf/mime.types)附带的列表。该列表由 Apache 软件基金会维护，取决于[www.iana.org](http://www.iana.org)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-30T10:38:08.470

虽然它并不完全符合您的要求，但可以通过[PRONOM](http://www.nationalarchives.gov.uk/PRONOM/)注册表中[的格式搜索获得此信息。](http://www.nationalarchives.gov.uk/PRONOM/Format/proFormatSearch.aspx?status=new)结果比 MIME 类型更细粒度，但如果结果可用，您可以获得 MIME 信息（例如[，](http://www.nationalarchives.gov.uk/PRONOM/Format/proFormatSearch.aspx?status=detailReport&id=733)在“标识符”部分中）。还有[DROID 工具](http://droid.sourceforge.net/)可用于通过 GUI、Java API 或命令行界面访问此信息。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-30T10:20:30.907

抱歉，我手头的任务没有网络服务，但是如果您可以以编程方式查询扩展名，您可以使用[fileext页面并解析响应。](http://filext.com/index.php)也许是朝着正确方向迈出的第一步。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-30T10:42:10.550

这个 Web 服务可以非常简单，一个小的 DB / 内存存储，它可以像 a 一样简单`Dictionary<String, String>`，只需执行键查找并返回结果。

第一个数据集可以（例如）基于[http://www.webmaster-toolkit.com/mime-types.shtml](http://www.webmaster-toolkit.com/mime-types.shtml)。

问题可能是托管这样的网络服务。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-30T11:44:22.627

我不知道是否有可以执行此操作的 Web 服务，但 libmagic 库 ( [http://en.wikipedia.org/wiki/Libmagic](http://en.wikipedia.org/wiki/Libmagic) ) 用于识别文件类型，可能对您有所帮助。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-30T10:43:13.730

唯一想到的是解析[http://www.file-extensions.org/的输出](http://www.file-extensions.org/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-30T11:33:28.327

它不会为您提供 MIME 类型，但好的旧版 Microsoft 文件关联 Web 服务仍然可以帮助您。您可以通过以下方式访问它：

> [http://shell.windows.com/fileassoc/0409/xml/redir.asp?Ext=xls](http://shell.windows.com/fileassoc/0409/xml/redir.asp?Ext=xls)

其中 0409 表示英语（美国），xls 是文件扩展名。从好的方面来说，它会在那里并不断更新......好吧，直到微软决定拔掉插头。这可能随时发生。

# c# - 为什么我不能在 ASP.NET 2.0 中使用对象初始化器？

> ID：483658
> 
> 赞同：1
> 
> 时间：2009-01-27T14:43:57.747
> 
> 标签：c#, asp.net, object-initializers

为什么我可以`Object Initializers`在针对 .NET 2.0 的 Visual Studio 2008 Windows 项目等中使用，但不能在针对 .NET 2.0 的 ASP.NET 项目中使用？

我知道这是 C# 3.0 功能，但不知道 - 为什么这可能在 .NET 2.0 项目中使用。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-27T14:49:57.577

可能是因为针对 2.0 框架的 ASP.Net 东西假定它将以可能必须即时编译一些代码的模式运行。由于它在 2.0 模式下运行，它将在该阶段获得 2.0 编译器（因此任何依赖于 3.0 编译器的东西都会失败）

当从“正常”项目中定位 2.0 代码库时，编译就完成了，因此依赖 3.0 编译器功能就可以了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T14:50:14.473

当您以 .NET 2.0 运行时为目标时，您也以 C# 2.0 编译器为目标。那个版本的编译器不理解 3.0 的特性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T14:50:25.300

这是一个处理在 .NET 2.0 项目中使用 C# 3.0 功能的现有[问题。](https://stackoverflow.com/questions/173080/c-net-3-0-3-5-features-in-2-0-using-visual-studio-2008)它解释了哪些 C# 3.0 功能可用，哪些不可用以及如何使用它们。

为了帮助您解决任何特定的困难，我们需要具体的细节。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T14:51:44.750

关于 C# 中的高级特性以及它们如何从 C# 1.0 发展到 3.0 的最佳信息来源是[Jon Skeet 的书](https://rads.stackoverflow.com/amzn/click/com/1933988363)。他经常在这里，甚至可能提供一些额外的见解。但是，您确实应该拥有这本书。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T15:08:46.230

一个普通的 ASP.NET 网站会即时编译，这意味着它将使用可用于您的 Web 服务器上的虚拟目录的编译器。如果设置为 ASP.NET 2.0，它将使用 2.0 编译器（而不是针对 .NET 2.0 的 3.0 编译器）。我假设当您将您的网站转换为 Web 应用程序时，您将能够以 3.0 为目标并且仍然使用 3.0 的一些功能。我建议尝试一下，我会的，但我现在没有时间。让我们知道它是否有效；-)

# windows - ACM - 音频压缩管理器

> ID：483663
> 
> 赞同：0
> 
> 时间：2009-01-27T14:44:45.733
> 
> 标签：windows, audio

谁能解释如何使用 Windows 音频压缩管理器（使用 VC++）？谢谢，在我开始之前我需要先学习哪些领域..

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T16:19:33.903

除了 Stu 所说的之外，您还需要了解 WAVEFORMATEX 结构的格式，以适应您想要使用的任何压缩类型。如果你有 WAV 文件，它们已经包含你可以直接使用的 WAVEFORMATEX 结构，但是如果你想使用 ACM 解压缩 MP3 文件，你需要自己构建 WAVEFORMATEX，这通常很重要（谷歌是你的朋友）。

其次，使用恒定比特率压缩更容易使用 ACM，因为您知道输入多少会产生多少，并且您可以转换整个块。使用 VBR，您可能需要处理源缓冲区中的“剩余物”。

第三，您需要意识到转换通常不能一步完成。所有压缩格式都会对 PCM 进行解压缩，但是您可能需要执行二次转换才能获得所需的采样率或比特率。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T15:16:17.180

您的第一个调用点应该是 MSDN 中的[相关条目](http://msdn.microsoft.com/en-us/library/ms705349(VS.85).aspx)，其中非常详细地解释了 ACM 的使用，并提供了示例代码和教程。

它实际上是一个非常易于使用的 API——您只需创建一个压缩流，指定所需的输入和输出格式，然后创建源缓冲区和目标缓冲区。您将源数据写入源缓冲区并将它们交给 ACM 进行处理。然后，ACM 会将处理后的输出缓冲区返回给您提供的回调函数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-06-18T04:48:34.397

MSDN实际上有两个分支解释（入门级）

首先它解释了如何编写你自己的 acm-driver（它解释了如何编写一个作为编解码器的程序）；

其次，它展示了如何在您的系统上使用 acm 驱动程序。

# cocoa - 使用函数后如何在 Cocoa 中声明函数？

> ID：483664
> 
> 赞同：3
> 
> 时间：2009-01-27T14:45:38.303
> 
> 标签：cocoa, xcode, function, declaration

我正在慢慢地将我的应用程序构建到工作状态。

我正在使用两个名为`setCollection`and的函数`addToCollection`。这些函数都接受`NSArray`作为输入。

我还有一个函数`add`，我在其中使用了这两个函数。当我尝试编译时，Xcode 显示错误：

> 'setCollection' 未声明（在此函数中首次使用）

我想这与在活动函数下方定义的函数有关。另一个猜测是这些函数应该被全球化以便在我的函数中可用`add`。

我通常是一个 php 编码器。Php 处理这个的方式是第一个。调用的函数应该在使用它们的函数之前，否则它们就不存在了。有没有办法让函数在运行时仍然可用，或者我应该重新排列所有函数以使其正常运行？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-27T14:52:54.717

您可以提前声明函数，如下所示：

```
void setCollection(NSArray * array);
void addToCollection(NSArray * array);

//...

// code that calls setCollection or addToCollection

//...

void setCollection(NSArray * array)
{
    // your code here
}

void addToCollection(NSArray * array)
{
    // your code here
} 
```

如果您正在创建自定义类，并且这些是成员函数（在 Objective-C 中通常称为方法），那么您将在类头文件中声明这些方法并在类源文件中定义它们：

```
//MyClass.h:
@interface MyClass : NSObject
{

}

- (void)setCollection:(NSArray *)array;
- (void)addToCollection:(NSArray *)array;

@end 
```

```
//MyClass.m:

#import "MyClass.h"

@implementation MyClass

- (void)setCollection:(NSArray *)array
{
    // your code here
}

- (void)addToCollection:(NSArray *)array
{
    // your code here
}

@end 
```

```
//some other source file

#import "MyClass.h"

//...

MyClass * collection = [[MyClass alloc] init];
[collection setCollection:someArray];
[collection addToCollection:someArray];

//... 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-27T15:00:22.893

如果您的函数是全局的（不是类的一部分），您只需将声明放在使用之前，就像 eJames 建议的那样。

如果您的函数实际上是方法（类的一部分），则必须在实现之前声明类的匿名类别并将方法声明放在此接口中：

```
@interface Myclass()
- (void) setCollection:(NSArray*)array;
- (void) addToCollection:(NSArray*)array;
@end

@implementation Myclass

// Code that calls setCollection or addToCollection

- (void) setCollection:(NSArray*)array
{
    // your code here
}

- (void) addToCollection:(NSArray*)array
{
    // your code here
}

@end 
```

这样，您就不需要在`MyClass`.

# python - 反转/反转字典映射

> ID：483666
> 
> 赞同：869
> 
> 时间：2009-01-27T14:46:09.893
> 
> 标签：python, dictionary, mapping, reverse

给定这样的字典：

```
my_map = {'a': 1, 'b': 2} 
```

如何反转这张地图以获得：

```
inv_map = {1: 'a', 2: 'b'} 
```

* * *

## 回答 #1

> 赞同：1254
> 
> 时间：2009-01-27T15:24:56.603

Python 3+：

```
inv_map = {v: k for k, v in my_map.items()} 
```

蟒蛇2：

```
inv_map = {v: k for k, v in my_map.iteritems()} 
```

* * *

## 回答 #2

> 赞同：191
> 
> 时间：2009-01-27T14:50:22.757

假设 dict 中的值是唯一的：

蟒蛇 3：

```
dict((v, k) for k, v in my_map.items()) 
```

蟒蛇2：

```
dict((v, k) for k, v in my_map.iteritems()) 
```

* * *

## 回答 #3

> 赞同：173
> 
> 时间：2009-01-27T21:33:26.483

如果中的值`my_map`不是唯一的：

蟒蛇 3：

```
inv_map = {}
for k, v in my_map.items():
    inv_map[v] = inv_map.get(v, []) + [k] 
```

蟒蛇2：

```
inv_map = {}
for k, v in my_map.iteritems():
    inv_map[v] = inv_map.get(v, []) + [k] 
```

* * *

## 回答 #4

> 赞同：51
> 
> 时间：2009-11-05T10:41:30.830

要在保留映射类型的同时执行此操作（假设它是一个`dict`或一个`dict`子类）：

```
def inverse_mapping(f):
    return f.__class__(map(reversed, f.items())) 
```

* * *

## 回答 #5

> 赞同：43
> 
> 时间：2009-01-27T14:49:46.300

试试这个：

```
inv_map = dict(zip(my_map.values(), my_map.keys())) 
```

（请注意，[字典视图上的 Python 文档](https://docs.python.org/library/stdtypes.html#dictionary-view-objects)明确保证了这一点，`.keys()`并且`.values()`它们的元素以相同的顺序排列，这使得上述方法可以工作。）

或者：

```
inv_map = dict((my_map[k], k) for k in my_map) 
```

或使用 python 3.0 的 dict 理解

```
inv_map = {my_map[k] : k for k in my_map} 
```

* * *

## 回答 #6

> 赞同：37
> 
> 时间：2014-02-26T16:35:03.473

另一种更实用的方式：

```
my_map = { 'a': 1, 'b':2 }
dict(map(reversed, my_map.items())) 
```

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2016-12-26T23:01:25.460

我们还可以使用以下方法反转具有重复键的字典`defaultdict`：

```
from collections import Counter, defaultdict

def invert_dict(d):
    d_inv = defaultdict(list)
    for k, v in d.items():
        d_inv[v].append(k)
    return d_inv

text = 'aaa bbb ccc ddd aaa bbb ccc aaa' 
c = Counter(text.split()) # Counter({'aaa': 3, 'bbb': 2, 'ccc': 2, 'ddd': 1})
dict(invert_dict(c)) # {1: ['ddd'], 2: ['bbb', 'ccc'], 3: ['aaa']} 
```

见[这里](https://docs.python.org/3/library/collections.html#collections.defaultdict)：

> 这种技术比使用`dict.setdefault()`.

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2012-10-24T20:40:19.283

这扩展了[Robert](https://stackoverflow.com/a/485368/)的答案，适用于 dict 中的值不唯一的情况。

```
class ReversibleDict(dict):

    def reversed(self):
        """
        Return a reversed dict, with common values in the original dict
        grouped into a list in the returned dict.

        Example:
        >>> d = ReversibleDict({'a': 3, 'c': 2, 'b': 2, 'e': 3, 'd': 1, 'f': 2})
        >>> d.reversed()
        {1: ['d'], 2: ['c', 'b', 'f'], 3: ['a', 'e']}
        """

        revdict = {}
        for k, v in self.iteritems():
            revdict.setdefault(v, []).append(k)
        return revdict 
```

实施受到限制，因为您不能使用`reversed`两次并取回原始文件。它本身不是对称的。它使用 Python 2.6 进行了测试。[这](https://pastebin.com/vMf7tNA5)是我如何使用打印结果字典的用例。

如果您宁愿使用 a 而`set`不是 a `list`，并且可能存在无序的应用程序对此有意义，而不是`setdefault(v, []).append(k)`使用`setdefault(v, set()).add(k)`.

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2018-04-19T03:24:11.217

列表和字典理解的结合。可以处理重复的键

```
{v:[i for i in d.keys() if d[i] == v ] for k,v in d.items()} 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2019-01-10T05:55:16.853

例如，您有以下字典：

```
dict = {'a': 'fire', 'b': 'ice', 'c': 'fire', 'd': 'water'} 
```

你想以这种倒置的形式得到它：

```
inverted_dict = {'fire': ['a', 'c'], 'ice': ['b'], 'water': ['d']} 
```

**第一个解决方案**。要反转字典中**的键值**对，请使用`for`-loop 方法：

```
# Use this code to invert dictionaries that have non-unique values

inverted_dict = dict()
for key, value in dict.items():
    inverted_dict.setdefault(value, list()).append(key) 
```

**第二种解决方案**。使用*字典理解*方法进行反转：

```
# Use this code to invert dictionaries that have unique values

inverted_dict = {value: key for key, value in dict.items()} 
```

**第三个解决方案**。使用*还原反转*方法（依赖于第二种解决方案）：

```
# Use this code to invert dictionaries that have lists of values

dict = {value: key for key in inverted_dict for value in my_map[key]} 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2021-01-10T22:00:08.717

字典值是一个集合的情况。像：

```
some_dict = {"1":{"a","b","c"},
        "2":{"d","e","f"},
        "3":{"g","h","i"}} 
```

反过来想：

```
some_dict = {vi: k  for k, v in some_dict.items() for vi in v} 
```

输出是这样的：

```
{'c': '1',
 'b': '1',
 'a': '1',
 'f': '2',
 'd': '2',
 'e': '2',
 'g': '3',
 'h': '3',
 'i': '3'} 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2021-03-01T13:15:35.393

很多答案，但如果我们谈论**的是具有非唯一值的字典，**则没有找到任何干净的东西。

一个解决方案是：

```
from collections import defaultdict

inv_map = defaultdict(list) 
for k, v in my_map.items(): 
    inv_map[v].append(k) 
```

### 例子：

如果初始字典`my_map = {'c': 1, 'd': 5, 'a': 5, 'b': 10}`

然后，运行上面的代码将给出：

```
{5: ['a', 'd'], 1: ['c'], 10: ['b']} 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2014-09-28T06:50:44.103

我认为最好的方法是定义一个类。这是“对称字典”的实现：

```
class SymDict:
    def __init__(self):
        self.aToB = {}
        self.bToA = {}

    def assocAB(self, a, b):
        # Stores and returns a tuple (a,b) of overwritten bindings
        currB = None
        if a in self.aToB: currB = self.bToA[a]
        currA = None
        if b in self.bToA: currA = self.aToB[b]

        self.aToB[a] = b
        self.bToA[b] = a
        return (currA, currB)

    def lookupA(self, a):
        if a in self.aToB:
            return self.aToB[a]
        return None

    def lookupB(self, b):
        if b in self.bToA:
            return self.bToA[b]
        return None 
```

如果需要，删除和迭代方法很容易实现。

此实现比反转整个字典（这似乎是此页面上最流行的解决方案）更有效。更不用说，您可以根据需要在 SymDict 中添加或删除值，并且您的逆向字典将始终保持有效 - 如果您只是将整个字典反转一次，则情况并非如此。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2017-01-25T20:23:49.610

这可以处理非唯一值并保留独特案例的大部分外观。

```
inv_map = {v:[k for k in my_map if my_map[k] == v] for v in my_map.itervalues()} 
```

对于 Python 3.x，替换`itervalues`为`values`.

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2020-09-08T23:03:24.537

我发现这个版本比具有 10000 个键的字典的公认版本快 10% 以上。

```
d = {i: str(i) for i in range(10000)}

new_d = dict(zip(d.values(), d.keys())) 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2021-01-14T14:29:22.557

我知道这个问题已经有很多很好的答案，但我想分享这个非常简洁的解决方案，它也可以处理重复值：

```
def dict_reverser(d):
    seen = set()
    return {v: k for k, v in d.items() if v not in seen or seen.add(v)} 
```

这依赖于总是在 Python中`set.add`返回的事实。`None`

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2010-04-17T20:14:06.983

如果值不是唯一的，并且您有点铁杆：

```
inv_map = dict(
    (v, [k for (k, xx) in filter(lambda (key, value): value == v, my_map.items())]) 
    for v in set(my_map.values())
) 
```

特别是对于大型字典，请注意，此解决方案的效率远低于[Python reverse / invert a mapping](https://stackoverflow.com/questions/483666/python-reverse-inverse-a-mapping/485368#485368)的答案，因为它会循环`items()`多次。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2013-04-09T19:20:58.913

除了上面建议的其他函数，如果你喜欢 lambdas：

```
invert = lambda mydict: {v:k for k, v in mydict.items()} 
```

或者，您也可以这样做：

```
invert = lambda mydict: dict( zip(mydict.values(), mydict.keys()) ) 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2020-12-03T23:07:45.107

这是另一种方法。

```
my_map = {'a': 1, 'b': 2}

inv_map= {}
for key in my_map.keys() :
    val = my_map[key]
    inv_map[val] = key 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2021-12-11T22:05:44.443

```
dict([(value, key) for key, value in d.items()]) 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2014-03-06T20:50:11.423

非双射映射的快速函数解决方案（值不唯一）：

```
from itertools import imap, groupby

def fst(s):
    return s[0]

def snd(s):
    return s[1]

def inverseDict(d):
    """
    input d: a -> b
    output : b -> set(a)
    """
    return {
        v : set(imap(fst, kv_iter))
        for (v, kv_iter) in groupby(
            sorted(d.iteritems(),
                   key=snd),
            key=snd
        )
    } 
```

从理论上讲，这应该比在[命令式解决方案](https://stackoverflow.com/a/485368/711694)中一个一个地添加到集合（或附加到列表）要快。

不幸的是，这些值必须是可排序的，groupby 需要排序。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2014-07-25T09:31:58.790

试试这个 python 2.7/3.x

```
inv_map={};
for i in my_map:
    inv_map[my_map[i]]=i    
print inv_map 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2014-09-24T12:23:00.220

函数对于 list 类型的值是对称的；执行 reverse_dict(reverse_dict(dictionary)) 时，元组被转换为列表

```
def reverse_dict(dictionary):
    reverse_dict = {}
    for key, value in dictionary.iteritems():
        if not isinstance(value, (list, tuple)):
            value = [value]
        for val in value:
            reverse_dict[val] = reverse_dict.get(val, [])
            reverse_dict[val].append(key)
    for key, value in reverse_dict.iteritems():
        if len(value) == 1:
            reverse_dict[key] = value[0]
    return reverse_dict 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2016-01-09T01:26:12.090

由于字典在字典中需要一个唯一的键，而不是值，因此我们必须将反转的值附加到排序列表中，以包含在新的特定键中。

```
def r_maping(dictionary):
    List_z=[]
    Map= {}
    for z, x in dictionary.iteritems(): #iterate through the keys and values
        Map.setdefault(x,List_z).append(z) #Setdefault is the same as dict[key]=default."The method returns the key value available in the dictionary and if given key is not available then it will return provided default value. Afterward, we will append into the default list our new values for the specific key.
    return Map 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2020-06-16T15:03:18.993

当前 python 3.x 版本的 lambda 解决方案：

```
d1 = dict(alice='apples', bob='bananas')
d2 = dict(map(lambda key: (d1[key], key), d1.keys()))
print(d2) 
```

结果：

```
{'apples': 'alice', 'bananas': 'bob'} 
```

此解决方案不检查重复项。

一些备注：

*   lambda 构造可以从外部范围访问 d1，因此我们只传入当前键。它返回一个元组。
*   dict() 构造函数接受一个元组列表。它还接受映射的结果，因此我们可以跳过转换为列表。
*   该解决方案没有显式`for`循环。它还避免了`list comprehension`对数学不好的人使用 a ;-)

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2021-12-22T23:51:48.963

接受高度投票的答案开始[If the values in my_map are not unique:](https://stackoverflow.com/a/485368/11154841)，我遇到了一个问题，不仅值不是唯一的，而且它们是一个列表，列表中的每个项目再次由一个三个元素的列表：一个字符串值、一个数字和另一个数字。

例子：

`mymap['key1']`给你：

```
[('xyz', 1, 2),
 ('abc', 5, 4)] 
```

我只想用键切换字符串值，将两个数字元素保持在同一个位置。你只需要另一个嵌套的 for 循环然后：

```
inv_map = {}
for k, v in my_map.items():
    for x in v:
        # with x[1:3] same as x[1], x[2]:
        inv_map[x[0]] = inv_map.get(x[0], []) + [k, x[1:3]] 
```

例子：

`inv_map['abc']`现在给你：

```
[('key1', 1, 2),
 ('key1', 5, 4)] 
```

* * *

## 回答 #27

> 赞同：-1
> 
> 时间：2017-04-26T14:28:34.130

我会在 python 2 中这样做。

```
inv_map = {my_map[x] : x for x in my_map} 
```

* * *

## 回答 #28

> 赞同：-1
> 
> 时间：2017-08-30T10:11:43.783

```
def invertDictionary(d):
    myDict = {}
  for i in d:
     value = d.get(i)
     myDict.setdefault(value,[]).append(i)   
 return myDict
 print invertDictionary({'a':1, 'b':2, 'c':3 , 'd' : 1}) 
```

这将提供如下输出：{1: ['a', 'd'], 2: ['b'], 3: ['c']}

* * *

## 回答 #29

> 赞同：-1
> 
> 时间：2017-12-18T16:11:44.013

```
 def reverse_dictionary(input_dict):
      out = {}
      for v in input_dict.values():  
          for value in v:
              if value not in out:
                  out[value.lower()] = []

      for i in input_dict:
          for j in out:
              if j in map (lambda x : x.lower(),input_dict[i]):
                  out[j].append(i.lower())
                  out[j].sort()
      return out 
```

这段代码是这样的：

```
r = reverse_dictionary({'Accurate': ['exact', 'precise'], 'exact': ['precise'], 'astute': ['Smart', 'clever'], 'smart': ['clever', 'bright', 'talented']})

print(r)

{'precise': ['accurate', 'exact'], 'clever': ['astute', 'smart'], 'talented': ['smart'], 'bright': ['smart'], 'exact': ['accurate'], 'smart': ['astute']} 
```

* * *

## 回答 #30

> 赞同：-2
> 
> 时间：2016-08-02T18:08:53.137

没有完全不同的东西，只是从食谱中重写了一点食谱。它通过保留`setdefault`方法进一步优化，而不是每次都通过实例获取它：

```
def inverse(mapping):
    '''
    A function to inverse mapping, collecting keys with simillar values
    in list. Careful to retain original type and to be fast.
    >> d = dict(a=1, b=2, c=1, d=3, e=2, f=1, g=5, h=2)
    >> inverse(d)
    {1: ['f', 'c', 'a'], 2: ['h', 'b', 'e'], 3: ['d'], 5: ['g']}
    '''
    res = {}
    setdef = res.setdefault
    for key, value in mapping.items():
        setdef(value, []).append(key)
    return res if mapping.__class__==dict else mapping.__class__(res) 
```

设计为在 CPython 3.x 下运行，对于 2.x 替换`mapping.items()`为`mapping.iteritems()`

在我的机器上运行比这里的其他示例快一点

* * *

## 回答 #31

> 赞同：-2
> 
> 时间：2016-08-05T19:47:24.360

我在循环'for'和方法'.get（）'的帮助下写了这个，我将字典的名称'map'更改为'map1'，因为'map'是一个函数。

```
def dict_invert(map1):
    inv_map = {} # new dictionary
    for key in map1.keys():
        inv_map[map1.get(key)] = key
    return inv_map 
```

* * *

## 回答 #32

> 赞同：-2
> 
> 时间：2017-01-10T10:37:35.730

如果值不是唯一的并且可能是哈希（一维）：

```
for k, v in myDict.items():
    if len(v) > 1:
        for item in v:
            invDict[item] = invDict.get(item, [])
            invDict[item].append(k)
    else:
        invDict[v] = invDict.get(v, [])
        invDict[v].append(k) 
```

如果您需要更深入地挖掘，则使用递归，那么只需一维：

```
def digList(lst):
    temp = []
    for item in lst:
        if type(item) is list:
            temp.append(digList(item))
        else:
            temp.append(item)
    return set(temp)

for k, v in myDict.items():
    if type(v) is list:
        items = digList(v)
        for item in items:
            invDict[item] = invDict.get(item, [])
            invDict[item].append(k)
    else:
        invDict[v] = invDict.get(v, [])
        invDict[v].append(k) 
```

# c# - 如何将字符串从一个 aspx.cs 页面带到另一个页面？

> ID：483669
> 
> 赞同：0
> 
> 时间：2009-01-27T14:47:04.650
> 
> 标签：c#, .net, asp.net

我想将我在一个 aspx.cs 文件中一直使用的字符串用于另一个文件。我知道这很容易，但我该怎么做呢？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-27T14:50:59.260

您可以在查询字符串中执行此操作。在您的第一页上：

```
Response.Redirect("Second.aspx?book=codecomplete"); 
```

在第二页

```
string book = Request["book"]; 
```

此方法将允许您的用户看到您传递到第二页的内容。或者，您可以将其放在会话对象中。放置它使用：

```
Session["book"] = "codecomplete"; 
```

并将其取回使用：

```
string book = Session["book"] as string; 
```

作为第三种选择，您可以使用 Server.Transfer。如果要转到服务器端的第二页，请使用此方法。但请注意，您的用户将继续在地址栏上看到第一页的 url。

在第 1 页：

```
this.SomeProperty = "codecomplete";
Server.Transfer("SecondPage.aspx"); 
```

在第 2 页：

```
string book = (PreviousPage as Page1).SomeProperty; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T14:49:39.200

您可以使用查询字符串发送它，也可以定义一个会话变量来存储它。

最佳选择取决于您要使用该字符串的目的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T14:50:53.177

请求参数

```
Response.Redirect(page.aspx?val=whatever); 
```

然后在 page.aspx

```
string myval = Request["whatever"] 
```

或者

```
Server.Transfer("page.aspx", true); 
```

如果您不想使页面切换透明，将保留第一页的表单值

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T14:53:47.493

另一种选择是跨页回发。

[http://msdn.microsoft.com/en-us/library/ms178139.aspx](http://msdn.microsoft.com/en-us/library/ms178139.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T14:56:40.967

我强烈建议您仅在绝对必要时才使用会话，它会占用宝贵的服务器资源。

使用QueryString，使用起来真的很简单，你只要加一个“？” 在 aspx 之后并写下您要传递的值，例如：

page.aspx?val=this_is_a_value_passed_to_this_page。

在 page.aspx 中，您读取查询字符串值，如下所示： string val = Request.QueryString["val"]; Response.Write(val);

这将生成以下响应：this_is_a_value_passed_to_this_page

更复杂的解释可以在这里找到：http: [//aspnet.4guysfromrolla.com/articles/020205-1.aspx](http://aspnet.4guysfromrolla.com/articles/020205-1.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T14:59:16.547

使用 QueryString 参数或 Session 变量。

请记住，在接收页面上，在检查 Request 或 Session 对象时，应确保该值不为空，然后再尝试使用它以避免意外错误。

```
if (Session["VariableName"] != null) {
  string varName = Session["VariableName"].ToString();
  // use varName
} 
```

或者

```
string varName = (Session["VariableName"] ?? "").ToString(); 
```

同样，如果您要传递一个数值，请在转换或转换和使用它之前确保它是正确的数据类型。

```
if (Session["IDValue"] != null) {
  string idVlaueString= Session["IDValue"].ToString();
  int idValue = 0;
  bool isInt = int.TryParse(idValueString, out idValue);
  if (isInt) {
    // use idValue
  }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-27T15:08:26.510

如果您只希望变量在对另一页面的调用中持续存在，我建议使用 Context.

在第一页使用：

```
Context.Items.Add("varName", varData); 
```

然后在被调用的页面上使用：

```
Context.Items("varName") 
```

阅读本文了解更多信息：[http ://steveorr.net/articles/PassData.aspx](http://steveorr.net/articles/PassData.aspx)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-27T15:49:38.533

查看关于 Alliance 的一篇题为[“以 .NET 方式传递数据”](http://aspalliance.com/151)的文章，该文章展示了如何实现这一点。该解决方案最好的部分是它不使用用户可以看到的任何查询字符串变量，也不需要您将其置于会话状态。

它的短处是：

在第一页 (Default.aspx) 创建一个隐藏文本框 (txtMessage)：

```
<asp:TextBox ID="txtMessage" runat="server" Visible="False" Text="" /> 
```

然后在后面的代码中添加一个方法：

```
Public ReadOnly Property MessageForwarded() As String
    Get
        Return txtMessage.Text
    End Get
End Property 
```

最后，可以动态设置隐藏文本框的值

```
txtMessage.text = "Hello there" 
```

在第二页添加参考：

```
<%@ Reference Page="Default.aspx" %> 
```

然后使用以下语法从第一页加载数据：

```
Dim objSource As Source = CType(Context.Handler, Source)
If Not (objSource Is Nothing) Then
    Response.Write(objSource.MessageForwarded)
End If 
```

我已经使用了一段时间没有任何问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-06T10:41:05.703

查询字符串是传递字符串值的好方法。检查此解决方案并尝试

```
response.redirect("link to your redirect page.aspx?userName="+string+""); 
```

这里 userName 是你想在另一个页面中获取的字符串的名称。

该字符串是您要传递到下一页的字符串。

然后通过使用取回该字符串

```
string str = Request.QueryString["userName"]; 
```

这是获取字符串值的简单方法。

# .net - 是否可以在运行时动态/在运行时评估包含有效 LINQ 的字符串？

> ID：483672
> 
> 赞同：6
> 
> 时间：2009-01-27T14:47:31.483
> 
> 标签：.net, linq, c#-3.0

基本思想是获取一个字符串并根据 XML 文件（或任何 LINQed 提供程序）对其进行评估

我找到了这个[LINQ 动态查询库](http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx)。只是粗略地浏览了下载包中的单页文档。这似乎是添加扩展方法来参数化部分 LINQ 查询。有谁知道这是否进行动态评估？

有什么办法可以做（假设有某种方法可以使用 XML 文件中的数据为类播种）？

```
ClassFromWishfulThinking.Evaluate(sLinqQuery); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T15:11:48.127

这一定是可能的，因为[Linqpad](http://www.linqpad.net/)做到了！

看看[它是如何工作的页面](http://www.linqpad.net/HowLINQPadWorks.aspx)有点让人费解，我不确定这是你想要对生产代码做的事情，除非你真的无法避免。

没有一种框架方法可以满足您的需求，我可以说，由于 .net 的工作方式，我对此很有信心。您必须像 LinqPad 那样使用[csharpcodeprovider调用编译器。](http://msdn.microsoft.com/en-us/library/microsoft.csharp.csharpcodeprovider.aspx)

您也许可以更改 Linq 动态查询库以执行您需要的操作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T15:22:22.147

我在 VB 中有这段代码，用于在运行时评估字符串中包含的代码……您需要将其转换为 C#，但没有理由不能只传入包含 LINQ 表达式的字符串。您需要稍微修改 FuncString 以允许使用 LINQ，因为我只引用 System.Math。我用它在运行时评估（主要是数学）表达式，但我想它可以被修改/扩展以评估.NET框架中的几乎任何东西......

```
Function Evaluate(ByVal Expression As String, ByVal Args() As Object) As Object

    If Expression.Length > 0 Then

        'Replace each parameter in the calculation expression with the correct values
        Dim MatchStr = "{(\d+)}"
        Dim oMatches = Regex.Matches(Expression, MatchStr)
        If oMatches.Count > 0 Then
            Dim DistinctCount = (From m In oMatches _
                                 Select m.Value).Distinct.Count
            If DistinctCount = Args.Length Then
                For i = 0 To Args.Length - 1
                    Expression = Expression.Replace("{" & i & "}", Args(i))
                Next
            Else
                Throw New ArgumentException("Invalid number of parameters passed")
            End If
        End If

        Dim FuncName As String = "Eval" & Guid.NewGuid.ToString("N")
        Dim FuncString As String = "Imports System.Math" & vbCrLf & _
                                   "Namespace EvaluatorLibrary" & vbCrLf & _
                                   "  Class Evaluators" & vbCrLf & _
                                   "    Public Shared Function " & FuncName & "() As Double" & vbCrLf & _
                                   "      " & Expression & vbCrLf & _
                                   "    End Function" & vbCrLf & _
                                   "  End Class" & vbCrLf & _
                                   "End Namespace"

        'Tell the compiler what language was used
        Dim CodeProvider As CodeDomProvider = CodeDomProvider.CreateProvider("VB")

        'Set up our compiler options...
        Dim CompilerOptions As New CompilerParameters()
        With CompilerOptions
            .ReferencedAssemblies.Add("System.dll")
            .GenerateInMemory = True
            .TreatWarningsAsErrors = True
        End With

        'Compile the code that is to be evaluated
        Dim Results As CompilerResults = _
            CodeProvider.CompileAssemblyFromSource(CompilerOptions, FuncString)

        'Check there were no errors...
        If Results.Errors.Count > 0 Then
        Else
            'Run the code and return the value...
            Dim dynamicType As Type = Results.CompiledAssembly.GetType("EvaluatorLibrary.Evaluators")
            Dim methodInfo As MethodInfo = dynamicType.GetMethod(FuncName)
            Return methodInfo.Invoke(Nothing, Nothing)
        End If

    Else
        Return 0

    End If

    Return 0

End Function

Sub Main()
    'In a real application, this string would be loaded from a database
    'it would be stored by some calculation administrator...
    Dim Expr As String = "  If ({0} < 20000) Then" & vbCrLf & _
                         "    Return Max(15, Min(75,0.12*{0}))" & vbCrLf & _
                         "  Else" & vbCrLf & _
                         "    Return Max(75,0.05*{0})" & vbCrLf & _
                         "  End If"

    Dim Args As New List(Of String)
    While True
        'This value would be loaded from some data interpreter for inclusion
        'in the calculation...
        Dim Val As String = Console.ReadLine
        Args.Clear()
        If IsNumeric(Val) Then
            Args.Add(Val)
            Dim dblOut As Object = Evaluate(Expr, Args.ToArray)
            Console.WriteLine(dblOut)
        Else
            Exit While
        End If
    End While

End Sub 
```

没有理由不能稍微修改函数定义，以便它可以作为字符串的扩展来允许您像这样调用它：

```
Dim LinqString = "from c in myLinqData where c.SomeField.Equals(""somevalue"") select c"
Dim output = LinqString.Evaluate 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T14:57:17.860

无论如何，大部分[LinqToXml](http://msdn.microsoft.com/en-us/library/system.xml.linq.aspx)都是由字符串驱动的。例如，[Elements 扩展方法](http://msdn.microsoft.com/en-us/library/bb351784.aspx)将采用一个字符串并查找具有该名称的所有子元素。

如果您的查询以字符串开头（而不是作为 Queryable/Enumerable 上的方法调用），那么它并不是真正的 linq 查询 - 而是别的东西。也许[XPath](http://msdn.microsoft.com/en-us/library/system.xml.xpath.aspx)可以提供帮助。

# rss - RSS 提要中的图像

> ID：483675
> 
> 赞同：28
> 
> 时间：2009-01-27T14:49:04.490
> 
> 标签：rss

每当我在 RSS 提要中看到图像时，它们都嵌入在 CDATA 中，而不是被标签包围。

在我的提要中，我希望在不这样做的情况下显示图像。

无论是在浏览器中、提要阅读器 (Bloglines) 还是通过 FeedBurner，以下结构都不会显示图像，尽管它是有效的 RSS。有人对此有经验吗？

```
<item>
<category>Viewbook</category>
<title>Widget</title>
<description>Learn more about our widgets.</description>
<link>http://www.widget.com/Default.aspx</link>
<image>
<url>http://www.widget.com/images/thumb.gif</url>
<title>Widget</title>
<link>http://www.widget.com/Default.aspx</link>
<description>Learn more about our widgets.</description>
</image>
</item> 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-27T15:09:59.817

在 Colonol Sponsz 的提示下，我研究了：

项目没有图像标签，仅适用于频道。所以你*必须*通过 CDATA 标签来做。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2011-06-13T14:44:52.727

为了完整性：在 RSS 2.0 中，您可以在一个项目内有一个单独的外壳，这符合规范。可以用于单个图像。但是，我知道提要聚合器之间的支持各不相同。更典型地，这用于播客之类的东西。RSS 2.0 标准规定：

> ```
> <enclosure> is an optional sub-element of <item>. 
> ```
> 
> 它具有三个必需的属性。url 表示外壳所在的位置，length 表示它有多大（以字节为单位），type 表示它的类型是什么，一个标准的 MIME 类型。url 必须是 http url。

请注意，您必须包括项目的大小以及 URL 和 mime 类型。

然而，正如其他人所指出的，包括 CDATA 中的图片更为常见。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-02-27T17:05:17.550

我相信您可以使用 `<media:content ....>`得到大多数 rss 读者良好支持的项目，它在 mailchimp（rss 到电子邮件时事通讯）上对我们来说完美无缺。

请参阅[http://kb.mailchimp.com/article/how-can-i-format-the-image-content-in-my-rss-to-email-campaigns](https://web.archive.org/web/20130318122537/http://kb.mailchimp.com/article/how-can-i-format-the-image-content-in-my-rss-to-email-campaigns)

编辑：这是一个实时链接：[https ://blog.mailchimp.com/rss-to-email-enhancement-for-publishers/](https://blog.mailchimp.com/rss-to-email-enhancement-for-publishers/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-08-24T20:27:57.143

`media:content`您可以在. [_](http://www.rssboard.org/media-rss#media-content)`item`

如果没有为整个 RSS 提要声明它，请确保为该元素声明 MRSS（媒体 RSS）命名空间（`xmlns:media`属性，如下），否则它不会验证。（例如，开箱即用的 WordPress。）

```
 <media:content 
        xmlns:media="http://search.yahoo.com/mrss/" 
        url="http://www.widget.com/images/thumb.gif" 
        medium="image" 
        type="image/jpeg" 
        width="150" 
        height="150" /> 
```

这可能会或可能不会按您的意愿显示；你必须进行实验。以这种方式嵌入内容更简单，尽管这条路线有助于[MailChimp 集成](https://blog.mailchimp.com/rss-to-email-enhancement-for-publishers/)（h/t [this answer](https://stackoverflow.com/a/9469050/241244)）或其他自定义解决方案。

WordPress的示例实现[在我的回答中](https://wordpress.stackexchange.com/a/278043/68816)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2018-09-05T06:41:36.580

使用，例如：

```
<enclosure url="http://www.scripting.com/mp3s/weatherReportSuite.mp3" length="12216320" type="audio/mpeg" /> 
```

文档[在这里](http://www.rssboard.org/rss-specification#ltenclosuregtSubelementOfLtitemgt)

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2009-01-27T15:00:45.637

正如您所说，它与单独的标签一起使用。问题在于 2.0 版的规范。

我知道，出于带宽原因，有一些提要阅读器会抑制图像。

来源：通过维基百科[的 RSS 规范 2.0](http://www.rssboard.org/rss-specification#ltimagegtSubelementOfLtchannelgt)

# javascript - Javascript 桥接到 Flash 以在 Flash 中存储 SO“cookies”

> ID：483678
> 
> 赞同：2
> 
> 时间：2009-01-27T14:49:16.190
> 
> 标签：javascript, flash, cookies

在阅读了关于[如何唯一标识访问我的网站的计算机的问题之后？](https://stackoverflow.com/questions/216542/how-do-i-uniquely-identify-computers-visiting-my-web-site#216599) ：

> 一种可能是使用 Flash cookie：
> 
> ```
> Ubiquitous availability (95 percent of visitors will probably have 
> ```
> 
> 闪光）
> 
> ```
> You can store more data per cookie (up to 100 KB)
> 
> Shared across browsers, so more likely to uniquely identify a machine
> 
> Clearing the browser cookies does not remove the flash cookies. 
> ```
> 
> 您需要构建一个小的（隐藏的）Flash 电影来读取和写入它们。

我试图找出是否有人已经做过这样的事情，所以我不必重新发明轮子。到目前为止，没有运气（也许我不知道要搜索的正确术语），除了[闪存端的代码](http://blog.circlecube.com/2008/04/tutorial/shared-object-utilizing-the-flash-cookie/)

我这样做的用途是防止用户多次回答测验，但未来的用途可能会禁止巨魔。

有谁知道这样做并允许我通过 javascript 访问的开源库？

警告：我不知道 flash，我没有许可证。

**编辑：您可以使用[evercookie](http://samy.pl/evercookie/)来做到这一点。这有点邪恶，但有效。**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T15:11:50.873

我很犹豫要不要回答你的问题，因为这听起来像是在危险地接近邪恶……而且，它注定要失败。如果您真的想阻止用户多次回答测验，您可以做的最好的事情是让他们注册一个用户帐户。如果您想阻止他们注册多个用户帐户，您可以让他们通过信用卡或蜗牛邮件验证某些内容，这两种方法通常都是站不住脚的。简而言之，互联网是匿名的。

无论如何，如果你真的想继续这个计划，你可以相当简单地在 Flex（Flash 的一个变体）中构建你的应用程序。Adobe 网站上有大量文档。其中一些相当稀疏和烦人，特别是集合 API，但它足以满足您的目的。ActionScript（Flash 和 Flex 的底层编程语言）与 JavaScript 非常相似，并且易于学习。Flex 有一个免费的 SDK（通常在页面上的一个小链接中提供，告诉您获取昂贵的 Flex Builder；Flex Builder 主要是一个 GUI 工具，而您将在没有 IDE 的情况下仅使用 SDK 编写直接代码），所以执照应该不是问题。JavaScript 到 Flash 的桥接也有很好的文档记录。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T16:19:53.370

为了建立*rmeador*所说的内容并帮助您入门，您将需要知道如何使用 FLEX3 API 中的两个类[SharedObject](http://livedocs.adobe.com/flex/3/langref/) 和[ExternalInterface](http://livedocs.adobe.com/flex/3/langref/)。

**SharedObject**将允许您从客户端计算机存储和检索数据，而**ExternalInterface**将允许您的操作脚本与您的 javascript 进行通信。

使用共享对象很简单。

要将数据放到用户机器上，只需创建一个 SharedObject 并将属性添加到 sharedObject 的数据属性中。

```
 private var sharedObject : SharedObject = SharedObject.getLocal("myCookie");
  sharedObject.data.DATA_FOR_THE_COOKIE = DATA; 
```

从 SharedObject 检索数据同样简单。确保 SharedObject 的大小大于 0（确保 SharedObject 存在）并且只需通过 SharedObject 的数据属性查找属性名称。

```
if(sharedObject.size > 0)
       // access data from cookie with -> sharedObject.data.DATA_FROM_THE_COOKIE; 
```

要将存储在 SharedObject 中的数据传递给您的 javascript，您需要使用 ExternalInterface。

假设您有一个 javascript 函数来检索变量

```
function retrieveVars( vars ){
   // Do something with vars.
} 
```

要从 actionscript 调用此函数，您将使用

```
ExternalInterface.call("retrieveVars", DATA_ITEM_1, DATA_ITEM_2, ...); 
```

就这么简单。

*请注意，如果客户端的 Flash 播放器的存储设置设置为 0，或者客户端的浏览器没有 ActiveX 或 NPRuntime，则此技术将不起作用。*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-07-04T21:21:38.327

[BakedGoods](https://github.com/klawson88/Baked-Goods)似乎正是您所需要的（或者更确切地说，是您*所需要*的）；它是一个 Javascript 库，它建立了一个统一的接口，可用于在所有本地和一些非本地存储设施中执行常见的存储操作，包括 Flash 本地共享对象（您所说的“cookie”）。

有了它，创建 LSO 可以使用以下简单的代码来完成：

```
bakedGoods.set({
    data: [{key: "key", value: "value"}],
    storageTypes: ["flash"],
    complete: function(byStorageTypeRemovedItemKeysObj, byStorageTypeErrorObj){/*code*/}
}); 
```

检索和删除数据同样简单。相信我，我会知道的；我是它的维护者:)

* * *

如果出于某种原因您希望推出自己的解决方案，rmeador 和 ForYourOwnGood 已经为您提供了足够的信息来帮助您入门。

然而，他们忘记告诉您如何做一件非常重要的事情：**如何使用 Javascript 访问将处理共享对象的 Actionscript 代码**。

首先，您需要将 ActionScript 代码封装在一个方法中，然后将该方法注册为其父应用程序的 ExternalInterface 的一部分：

```
function handleObjects(/*param1, param2, ... */):void {/*code*/}
ExternalInterface.addCallback("handleObjects"); 
```

其次，您需要编译 Actionscript 应用程序（您的代码），并在 HTML 中创建一个引用生成的 .swf 文件的元素。

然后，假设上述 HTML 元素表示为名为 的 DOMElement `flashDOMElement`，您可以使用 DOMElement 调用您的方法：

```
flashDOMElement.handleSharedObjects(/*arg1, arg2, ... */); 
```

就是这样！有几件事我们没有提及或略过，但总而言之，推出自己的解决方案并不难。然而，推出你自己的**可靠**解决方案是另一回事，这也是我建议你使用 BakedGoods 的部分原因。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-11-21T22:40:25.737

对于现在搜索此内容的人，请务必查看[evercookie](http://samy.pl/evercookie/)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-02-17T23:57:46.990

Evercookie 绝对可以完成工作，但这更接近您最初要求的内容：[https](https://github.com/nfriedly/Javascript-Flash-Cookies) ://github.com/nfriedly/Javascript-Flash-Cookies MIT 许可证。

# c# - 如何将此字符串拆分为数组？

> ID：483702
> 
> 赞同：5
> 
> 时间：2009-01-27T14:53:57.850
> 
> 标签：c#, string

我的字符串如下：

```
smtp:jblack@test.com;SMTP:jb@test.com;X400:C=US;A= ;P=Test;O=Exchange;S=Jack;G=Black; 
```

我需要回来：

```
smtp:jblack@test.com
SMTP:jb@test.com
X400:C=US;A= ;P=Test;O=Exchange;S=Jack;G=Black; 
```

问题是分号分隔地址以及 X400 地址的一部分。谁能建议如何最好地分割这个？

PS我应该提到顺序不同，所以它可能是：

```
X400:C=US;A= ;P=Test;O=Exchange;S=Jack;G=Black;;smtp:jblack@test.com;SMTP:jb@test.com 
```

可以有超过 3 个地址，4、5.. 10 等，包括 X500 地址，但它们都以 smtp: SMTP: X400 或 X500 开头。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-27T14:59:04.517

编辑：有了更新的信息，这个答案肯定不会奏效——但它仍然可能有用，所以我把它留在这里。

你总是有三个部分，你只想在前两个分号上分开吗？

如果是这样，只需使用 Split 的重载，它可以让您指定要返回的子字符串的数量：

```
string[] bits = text.Split(new char[]{';'}, 3); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-27T15:49:07.507

我可以建议建立一个正则表达式吗

```
(smtp|SMTP|X400|X500):((?!smtp:|SMTP:|X400:|X500:).)*;? 
```

或无协议

```
.*?:((?![^:;]*:).)*;? 
```

换句话说，找到以您的协议之一开头的任何内容。匹配冒号。只要您不匹配您的协议之一，就继续匹配字符。以分号结尾（可选）。

然后，您可以解析在“：”上拆分的匹配列表，您将拥有您的协议。此外，如果您想添加协议，只需将它们添加到列表中即可。

但是，您可能希望将整个内容指定为不区分大小写，并且仅以大写或小写版本列出协议。

无协议版本不关心协议的名称是什么。它只是通过匹配所有内容来发现它们都是一样的，但不包括后跟冒号或分号的字符串。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-27T15:52:43.740

按以下正则表达式模式拆分

```
string[] items = System.Text.RegularExpressions.Split(text, ";(?=\w+:)"); 
```

编辑：更好的人可以在协议名称中接受更多特殊字符。

```
string[] items = System.Text.RegularExpressions.Split(text, ";(?=[^;:]+:)"); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T15:00:03.657

[http://msdn.microsoft.com/en-us/library/c1bs0eda.aspx](http://msdn.microsoft.com/en-us/library/c1bs0eda.aspx) 检查那里，你可以指定你想要的分割数。所以在你的情况下你会做

```
string.split(new char[]{';'}, 3); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-27T15:04:54.303

**这引起了我的好奇心**....所以这段代码确实可以完成这项工作，但同样需要整理:)

*我的最后一次尝试*——停止改变你需要的东西；=）

```
static void Main(string[] args)
{
    string fneh = "X400:C=US400;A= ;P=Test;O=Exchange;S=Jack;G=Black;x400:C=US400l;A= l;P=Testl;O=Exchangel;S=Jackl;G=Blackl;smtp:jblack@test.com;X500:C=US500;A= ;P=Test;O=Exchange;S=Jack;G=Black;SMTP:jb@test.com;";

    string[] parts = fneh.Split(new char[] { ';' });

    List<string> addresses = new List<string>();
    StringBuilder address = new StringBuilder();
    foreach (string part in parts)
    {
        if (part.Contains(":"))
        {
            if (address.Length > 0)
            {
                addresses.Add(semiColonCorrection(address.ToString()));
            }
            address = new StringBuilder();
            address.Append(part);
        }
        else
        {
            address.AppendFormat(";{0}", part);
        }
    }
    addresses.Add(semiColonCorrection(address.ToString()));

    foreach (string emailAddress in addresses)
    {
        Console.WriteLine(emailAddress);
    }
    Console.ReadKey();
}
private static string semiColonCorrection(string address)
{
    if ((address.StartsWith("x", StringComparison.InvariantCultureIgnoreCase)) && (!address.EndsWith(";")))
    {
        return string.Format("{0};", address);
    }
    else
    {
        return address;
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-27T15:46:10.350

如果您经常这样做，这不是最快的，但我相信它适用于所有情况。

```
 string input1 = "smtp:jblack@test.com;SMTP:jb@test.com;X400:C=US;A= ;P=Test;O=Exchange;S=Jack;G=Black;";
        string input2 = "X400:C=US;A= ;P=Test;O=Exchange;S=Jack;G=Black;;smtp:jblack@test.com;SMTP:jb@test.com";
        Regex splitEmailRegex = new Regex(@"(?<key>\w+?):(?<value>.*?)(\w+:|$)");

        List<string> sets = new List<string>();

        while (input2.Length > 0)
        {
            Match m1 = splitEmailRegex.Matches(input2)[0];
            string s1 = m1.Groups["key"].Value + ":" + m1.Groups["value"].Value;
            sets.Add(s1);
            input2 = input2.Substring(s1.Length);
        }

        foreach (var set in sets)
        {
            Console.WriteLine(set);
        }

        Console.ReadLine(); 
```

当然很多人会声称 Regex：现在你有两个问题。甚至可能有比这更好的正则表达式答案。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-27T15:48:22.170

您总是可以在冒号上拆分并有一点逻辑来获取键和值。

```
string[] bits = text.Split(':');
List<string> values = new List<string>();
for (int i = 1; i < bits.Length; i++)
{
    string value = bits[i].Contains(';') ? bits[i].Substring(0, bits[i].LastIndexOf(';') + 1) : bits[i];
    string key = bits[i - 1].Contains(';') ? bits[i - 1].Substring(bits[i - 1].LastIndexOf(';') + 1) : bits[i - 1];
    values.Add(String.Concat(key, ":", value));
} 
```

用你的两个样品测试它，它工作正常。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-27T17:07:07.287

这行得通！

```
 string input =
        "smtp:jblack@test.com;SMTP:jb@test.com;X400:C=US;A= ;P=Test;O=Exchange;S=Jack;G=Black;";
    string[] parts = input.Split(';');
    List<string> output = new List<string>();
    foreach(string part in parts)
    {
        if (part.Contains(":"))
        {
            output.Add(part + ";");
        }
        else if (part.Length > 0)
        {
            output[output.Count - 1] += part + ";";
        }
    }
    foreach(string s in output)
    {
        Console.WriteLine(s);
    } 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-27T16:16:16.810

很多尝试。这是我的；）

```
string src = "smtp:jblack@test.com;SMTP:jb@test.com;X400:C=US;A= ;P=Test;O=Exchange;S=Jack;G=Black;";

Regex r = new Regex(@"
   (?:^|;)smtp:(?<smtp>([^;]*(?=;|$)))|
   (?:^|;)x400:(?<X400>.*?)(?=;x400|;x500|;smtp|$)|
   (?:^|;)x500:(?<X500>.*?)(?=;x400|;x500|;smtp|$)",
RegexOptions.IgnoreCase | RegexOptions.IgnorePatternWhitespace);

foreach (Match m in r.Matches(src))
{
    if (m.Groups["smtp"].Captures.Count != 0)
        Console.WriteLine("smtp: {0}", m.Groups["smtp"]);
    else if (m.Groups["X400"].Captures.Count != 0)
        Console.WriteLine("X400: {0}", m.Groups["X400"]);
    else if (m.Groups["X500"].Captures.Count != 0)
        Console.WriteLine("X500: {0}", m.Groups["X500"]);   
} 
```

这会以任何出现顺序查找字符串中的所有 smtp、x400 或 x500 地址。它还识别准备进一步处理的地址类型。地址本身中文本 smtp、x400 或 x500 的出现不会破坏模式。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-27T15:40:08.240

试试这些正则表达式。您可以使用命名组提取您要查找的内容。

```
X400:(?<X400>.*?)(?:smtp|SMTP|$)
smtp:(?<smtp>.*?)(?:;+|$)
SMTP:(?<SMTP>.*?)(?:;+|$) 
```

确保在构造它们时指定不区分大小写。他们似乎与您提供的样本一起工作

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2009-01-27T16:15:41.413

这是另一种可能的解决方案。

`string[] bits = text.Replace(";smtp", "|smtp").Replace(";SMTP", "|SMTP").Replace(";X400", "|X400").Split(new char[] { '|' });`

bits[0]、bits[1] 和 bits[2] 将按原始字符串的顺序包含这三个部分。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2009-01-27T15:03:44.570

执行分号 (;) 拆分，然后循环遍历结果，将没有冒号 (:) 的每个元素与前一个元素重新组合。

```
string input = "X400:C=US;A= ;P=Test;O=Exchange;S=Jack;G="
  +"Black;;smtp:jblack@test.com;SMTP:jb@test.com";

string[] rawSplit = input.Split(';');

List<string> result = new List<string>();
  //now the fun begins
string buffer = string.Empty;
foreach (string s in rawSplit)
{
  if (buffer == string.Empty)
  {
    buffer = s;
  }
  else if (s.Contains(':'))
  {   
    result.Add(buffer);
    buffer = s;
  }
  else
  {
    buffer += ";" + s;
  }
}
result.Add(buffer);

foreach (string s in result)
  Console.WriteLine(s); 
```

# vb.net - 如何正确设置启用 Silverlight 的 WCF 服务？

> ID：483703
> 
> 赞同：3
> 
> 时间：2009-01-27T14:54:18.677
> 
> 标签：vb.net, silverlight, wcf, web-services, interface

**编辑**：我开始对这个问题进行非公开投票，因为我解决了这个问题。我做的一切都很好，但是对我不久前下载和卸载的 ASP URL 重写器的引用在 IIS 中仍然有引用。[Waclaw Stypula](http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/e56a7768-b8a5-421e-98d9-5bd9f013bfee/)（有台阶的那个）的这个论坛帖子帮助我偶然发现了这一点。当我启动运行命令时，IIS 告诉我它（显然）找不到重写器 DLL。我删除了引用，之后应用程序运行良好。

* * *

我正在关注[Jesse Liberty的](http://jesseliberty.com/)[silverlight.net](http://silverlight.net/learn/tutorials.aspx)教程。目前我正在尝试做[第三个教程](http://silverlight.net/learn/tutorials/sqldatagrid_vb.aspx)，但我在“**创建网络服务**”标题下遇到了一面墙（大约一半）。

 **首先，当我通过将新服务添加到解决方案中来创建新服务时，教程指出应该创建三个文件；`IService1.vb`, `Service1.svc`, 和`Service1.svc.vb`. `IService1.vb`当我将服务添加到解决方案时，我没有得到文件。我[下载](http://download.microsoft.com/download/f/a/9/fa9bafe9-3434-4af0-b428-d990bc9fbfaf/3-SQLDB_Source_VB.zip)了他们提供的项目的副本，`Service1.svc.vb`文件在里面，所以我手动添加了一份并复制了文件的内容。该教程说它是一个 VB 教程，但在随附的屏幕截图中[显示了 C#](http://silverlight.net/themes/silverlight/images/learn/tutorials/Beta2SQLData_7.png)，所以这可能是问题所在。

在我像教程一样完成所有文件之后（复制/粘贴以确保我没有拼写错误），我尝试添加服务引用并收到以下错误：

> `The service class of type KeyboardControl_Web.Service1 both defines a ServiceContract and inherits a ServiceContract from type KeyboardControl_Web.IService1\. Contract inheritance can only be used among interface types. If a class is marked with ServiceContractAttribute, it must be the only type in the hierarchy with ServiceContractAttribute. Consider moving the ServiceContractAttribute on type KeyboardControl_Web.IService1 to a separate interface that type KeyboardControl_Web.IService1 implements.`

我尝试用谷歌搜索邮件的不同部分，但没有找到太多有用的信息。

以下是不同文件的代码：

```
//IService1.vb
Imports System.ServiceModel

' NOTE: If you change the class name "IService1" here, you must also update
'       the reference to "IService1" in Web.config.
<ServiceContract()> _
Public Interface IService1

    <OperationContract()> _
   Function GetAllLocations() As List(Of Address)

End Interface

//Service1.svc.vb
Imports Microsoft.VisualBasic
Imports System
Imports System.Collections.Generic
Imports System.Linq
Imports System.Runtime.Serialization
Imports System.ServiceModel
Imports System.Text

' NOTE: If you change the class name "Service1" here, you must also
'       update the reference to "Service1" in Web.config and in the
'       associated .svc file.

Public Class Service1
    Implements IService1
    Public Function GetAllLocations() As List(Of Address) Implements IService1.GetAllLocations
        Dim db As New DataClasses1DataContext()
        Dim matchingCustomers = From cust In db.userControlDemos Select cust
        'Return matchingCustomers.ToList()
    End Function
End Class 
```

我一般是 Silverlight/WCF 以及接口和服务的新手。你们能帮我走上正轨吗？

编辑：我应该补充一点，我在 Windows Vista Business SP1 上使用 Visual Studio 2008。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T15:53:26.780

如果您安装了适用于 Visual Studio 的 Silverlight 工具，而不是使用默认的 WCF 模板，请考虑使用“启用 Silverlight 的 WCF 服务”，它可以为您简化事情并放置所有必需的配置。这个新模板是在 Beta 2 中引入的，并且仍然存在（参考：[http://timheuer.com/blog/archive/2008/06/06/changes-to-accessing-services-in-silverlight-2-beta-2\. .aspx](http://timheuer.com/blog/archive/2008/06/06/changes-to-accessing-services-in-silverlight-2-beta-2.aspx)）。

# c# - 将对象添加到 SortedBindingList

> ID：483709
> 
> 赞同：0
> 
> 时间：2009-01-27T14:56:34.350
> 
> 标签：c#, winforms, csla

我有一个 WinForm，其中包含一个 DataGridView 和一个组中的成员列表。该表单包含用于添加新成员和更改当前成员角色的功能 (bindingNavigator)。我希望能够对成员进行排序并通过在组合中引入**SortedBindingList**来实现这一点。然而，不幸的是，这使我无法向团队添加新成员。我得到以下异常：

> System.InvalidOperationException 发生
> 
> Message="无法将项目添加到只读或固定大小的列表中。"

我理解这个错误，但有什么办法可以解决这个问题，还是我必须找到其他方法来对列表进行排序？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-12T18:19:45.887

[使用Binding List View](http://blw.sourceforge.net/)我很幸运。只需将您的对象保存在通用列表中，然后像这样设置 DataSource：

```
public void BindGenericList<T>(List<T> list)
{
    DataSource = new BindingListView<T>(list);
} 
```

将实际对象从列表中取出很简单：

```
public void GetObjectFromRow<T>(int rowIndex)
{
    BindingListView<T> bindingListView = DataSource as BindingListView<T>;

    return (null != bindingListView) ? bindingListView[rowIndex].Object : default(T);
} 
```

使用 BLV 排序实际上[比使用 DataView 更快](http://blogs.warwick.ac.uk/andrewdavey/entry/bindinglistview_speedy_sorting/)。

# javascript - 如何确定哪个html页面元素有焦点？

> ID：483741
> 
> 赞同：71
> 
> 时间：2009-01-27T15:03:30.030
> 
> 标签：javascript, html

> **可能重复：**
> [如何找出哪个 DOM 元素具有焦点？](https://stackoverflow.com/questions/497094/how-do-i-find-out-which-dom-element-has-the-focus)

javascript中有没有办法确定哪个html页面元素具有焦点？

* * *

## 回答 #1

> 赞同：89
> 
> 时间：2009-01-27T15:29:38.277

**使用该[`document.activeElement`](https://developer.mozilla.org/en-US/docs/DOM/document.activeElement#Browser_compatibility)物业。**

Chrome 2+、Firefox 3+、IE4+、Opera 9.6+ 和 Safari 4+ 支持该`document.activeElement`属性。

请注意，此属性将仅包含接受击键的元素（例如表单元素）。

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2009-01-27T15:27:53.383

看看[这篇博文](http://ajaxandxml.blogspot.com/2007/11/emulating-activeelement-property-with.html)。它提供了一种解决方法，以便`document.activeElement`在所有浏览器中都可以使用。

```
function _dom_trackActiveElement(evt) {
    if (evt && evt.target) { 
        document.activeElement = evt.target == document ? null : evt.target;
    }
}

function _dom_trackActiveElementLost(evt) { 
    document.activeElement = null;
}

if (!document.activeElement) {
    document.addEventListener("focus",_dom_trackActiveElement,true);
    document.addEventListener("blur",_dom_trackActiveElementLost,true);
} 
```

需要注意的一点：

> 这个实现有点过于悲观了；如果浏览器窗口失去焦点，则将 activeElement 设置为 null（因为输入控件也失去焦点）。如果您的应用程序需要 activeElement 值，即使浏览器窗口没有焦点，您可以删除 blur 事件侦听器。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-05-17T14:51:22.747

只是为了记录，有点晚了，当然[旧浏览器不支持](https://developer.mozilla.org/En/DOM/Document.querySelector#Browser_compatibility)：

```
var element = document.querySelector(":focus"); 
```

应该适用于所有元素（例如锚点）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-27T15:20:55.020

也许[`document.activeElement`](https://developer.mozilla.org/En/DOM:element.activeElement)，不知道浏览器支持。似乎可以在 Firefox 和 IE7 中使用，但我想你也必须在 Opera 等中尝试它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T15:11:35.880

检查[底部的帖子](http://forums.devx.com/archive/index.php/t-7619.html)。我认为那会奏效...

# language-agnostic - 为什么大多数语言不允许二进制数？

> ID：483744
> 
> 赞同：17
> 
> 时间：2009-01-27T15:04:25.303
> 
> 标签：language-agnostic, binary, numbers

为什么大多数计算机编程语言不允许像十进制或十六进制那样使用二进制数？

*   在 VB.NET 中，你可以写一个像 &H4 这样的十六进制数
*   在 C 中，您可以编写一个十六进制数，例如 0x04

为什么不允许二进制数？

*   &B010101
*   0y1010

奖励积分！... 哪些语言允许二进制数*？*

* * *

**编辑**

哇！- 所以大多数人认为这是因为简洁和糟糕的旧“波浪”认为这是由于二进制表示的技术方面。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-01-27T15:08:11.567

因为十六进制（很少是八进制）文字更紧凑，使用它们的人通常可以比破译二进制数更快地在十六进制和二进制之间进行转换。

[Python 2.6+](http://docs.python.org/reference/lexical_analysis.html#integer-and-long-integer-literals)允许使用二进制文字，Ruby 和[Java 7](http://blogs.oracle.com/darcy/entry/project_coin_literal_grammar_hackery)也是如此，您可以使用下划线使字节边界变得明显。例如，十六进制值`0x1b2a`现在可以写为`0b00011011_00101010`.

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-27T15:08:39.413

[在具有用户定义文字](http://en.wikipedia.org/wiki/C%2B%2B0x#User-defined_literals)的 C++0x中将支持二进制数，我不确定它是否会成为标准的一部分，但最坏的情况是您可以自己启用它

```
int operator "" _B(int i);

assert( 1010_B == 10); 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-27T19:40:00.333

为了使位表示有意义，您需要知道如何解释它。您需要指定您正在使用的二进制数的类型（有符号/无符号、二进制恭维、一个恭维、有符号幅度）。

我曾经使用过的唯一正确支持二进制数的语言是硬件描述语言（Verilog、VHDL 等）。对于如何处理以二进制输入的数字，它们都有严格的（并且经常令人困惑）定义。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-27T16:38:17.267

请参阅[perldoc perlnumber](http://perldoc.perl.org/perlnumber.html#SYNOPSIS)：

```
NAME
   perlnumber - semantics of numbers and numeric operations in Perl

SYNOPSIS
       $n = 1234;              # decimal integer
       $n = 0b1110011;         # binary integer
       $n = 01234;             # octal integer
       $n = 0x1234;            # hexadecimal integer
       $n = 12.34e-56;         # exponential notation
       $n = "-12.34e56";       # number specified as a string
       $n = "1234";            # number specified as a string 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-01-27T19:41:53.590

有点离题，但较新版本的 GCC 添加了允许二进制文字的 C 扩展。因此，如果您只使用 GCC 进行编译，则可以使用它们。文档在[这里](http://gcc.gnu.org/onlinedocs/gcc-4.3.3/gcc/Binary-constants.html#Binary-constants)。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-27T15:19:15.693

Common Lisp 允许使用二进制数，使用 #b...（位从 2 的最高到最低的幂）。大多数情况下，使用十六进制数字至少同样方便（通过使用#x...），因为在您的脑海中转换十六进制数字和二进制数字相当容易。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-12-15T14:57:40.513

虽然 C 仅支持以 8、10 或 16 为基数，但实际上编写一个预处理器宏并不难，它使编写 8 位二进制数变得非常简单和易读：

```
#define BIN(d7,d6,d5,d4, d3,d2,d1,d0)                      \
(                                                          \
    ((d7)<<7) + ((d6)<<6) + ((d5)<<5) + ((d4)<<4) +        \
    ((d3)<<3) + ((d2)<<2) + ((d1)<<1) + ((d0)<<0)          \
)
int my_mask = BIN(1,1,1,0, 0,0,0,0); 
```

这也可以用于 C++。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-27T15:06:54.300

十六进制和八进制只是编写二进制的较短方法。您真的想要在您的代码中定义一个 64 字符长的常量吗？

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-01-27T15:25:14.217

普遍的看法认为，长的二进制数字字符串，例如一个 int 的 32 位，对于人们来说很难方便地解析和操作。十六进制通常被认为更容易，尽管我使用的任何一种都不足以形成偏好。

如前所述，Ruby 试图通过允许将 _ 自由插入到文字中来解决此问题，例如：

```
irb(main):005:0> 1111_0111_1111_1111_0011_1100
=> 111101111111111100111100 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-01-27T15:29:21.727

D 支持使用语法 0[bB][01]+ 的二进制文字，例如 0b1001。它还允许在数字文字中嵌入 _ 字符，以便更轻松地阅读它们。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-10-29T15:02:41.043

Java 7 现在支持二进制文字。所以你可以简单地写0b110101。关于此功能的文档不多。我能找到的唯一参考是[here](http://mail.openjdk.java.net/pipermail/coin-dev/2009-April/001627.html)。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-01-27T15:31:21.240

记录在案，并回答这个问题：

> 奖励积分！... 哪些语言允许二进制数？

Specman (aka e) 允许二进制数。虽然老实说，它并不是一种通用语言。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-08-08T02:47:51.500

*每种*语言都应该支持二进制文字。我疯了没有他们！

> 奖励积分！... 哪些语言允许二进制数？

[图标](http://www.cs.arizona.edu/icon/)允许从 2 到 16 的任何基数的文字，并且可能最多 36（我的记忆变得模糊）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-27T18:33:39.670

在 Smalltalk 中，它就像 2r1010。您可以使用最多 36 个左右的任何基数。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-27T19:27:06.287

十六进制不那么冗长，并且可以表达二进制数可以表达的任何内容。

如果你真的想要，Ruby 对二进制数有很好的支持。0b11011 等

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-01-27T16:22:53.677

从可读性和可用性的角度来看，十六进制表示似乎是定义二进制数的更好方法。他们不添加它的事实可能更多的是用户需要技术限制。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-01-27T16:34:29.207

我希望语言设计者只是没有看到足够的需要添加二进制数。在处理标志或位掩码时，普通编码器可以解析十六进制和二进制。一些语言支持二进制表示，这很好，但我认为平均而言它很少使用。虽然二进制——如果在 C、C++、Java、C# 中可用，可能会比八进制使用更多！

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-08-08T00:19:27.210

在 Pop-11 中，您可以使用由数字（2 到 32）+ 冒号组成的前缀来表示基数，例如

2:11111111 = 255

3:11111111 = 3280

16:11111111 = 286331153

31:11111111 = 28429701248

32:11111111 = 35468117025

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-08-08T01:11:48.370

尽管它不是直接的，但大多数语言也可以解析字符串。Java可以通过方法将“10101000”转换为int。

并不是说这是有效的或任何东西......只是说它在那里。如果它是在静态初始化块中完成的，它甚至可能在编译时完成，具体取决于编译器。

如果您擅长二进制，即使数字很短，也很容易将 0x3c 视为 4 个 1 后跟 2 个零，而即使二进制中的那个短数字也是 0b111100 ，这可能会让您的眼睛在确定之前受伤的数量。

0xff9f 正好是 4+4+1 个，2 个 0 和 5 个 1（看起来位掩码很明显）。试图数出 0b1111111110011111 更令人恼火。

我认为问题可能在于语言设计者总是在十六进制/八进制/二进制/其他方面投入巨资，并且只是这样想。如果您经验不足，我完全可以看到这些转换不会那么明显。

嘿，这让我想起了我在考虑基本转换时想到的一些东西。一个序列——我认为没有人能找出“下一个数字”，但一个人确实做到了，所以它是可以解决的。试试看：

```
10
11
12
13
14
15
16
21
23
31
111
? 
```

编辑：顺便说一句，这个序列可以通过将序列号输入到大多数语言的单个内置函数中来创建（当然是 Java）。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2010-10-06T13:47:49.770

Forth 总是允许使用任意基数的数量（当然要达到 CPU 的大小限制）。想要使用二进制：`2 BASE !`八进制：`8 BASE !`等。想要使用时间？`60 BASE !`这些示例都是从基组输入到十进制的 10。要更改基数，您必须代表当前数字基数所需的基数。如果在二进制中并且您想切换回十进制，那么`1010 BASE !`将起作用。大多数 Forth 实现都有“词”来转换到公共基础，例如`DECIMAL`、`HEX`、`OCTAL`和`BINARY`。

# javascript - 用通过 AJAX 检索的内容替换 HTML 页面

> ID：483745
> 
> 赞同：74
> 
> 时间：2009-01-27T15:04:50.277
> 
> 标签：javascript, html, ajax, dom

我有一个具有典型结构的 HTML 页面：

```
<html>
  <head>
   <script src="..." ></script>
   <style>...</style>
  </head>
  <body>
   content
  </body>
  <script>
    var success_callback = function(data) {
      // REPLACE PAGE CONTENT & STRUCTURE WITH "data"
    }
    ajax(url, params, success_callback);
  </script>
</html> 
```

你认为有可能吗？我已经尝试给 html 标签一个 id 并且`$(id).replace(data);`没有成功。

不要问我为什么，但这就是我所需要的（我正在与一个特殊的“mashup builder”网站合作……说来话长）。

**编辑**：我忘了说**必须执行接收到的内容中的**脚本，甚至包括使用的外部脚本`<script src="...">`。

* * *

## 回答 #1

> 赞同：167
> 
> 时间：2012-08-16T10:06:36.180

最简单的方法是使用以下方法设置新的 HTML 内容：

```
document.open();
document.write(newContent);
document.close(); 
```

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-01-27T15:18:03.933

**用jQuery**试试这个：

```
$('body').load( url,[data],[callback] ); 
```

[在docs.jquery.com/Ajax/load](http://docs.jquery.com/Ajax/load#urldatacallback)上阅读更多内容

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-01-27T15:15:13.067

以下是如何在[Prototype](http://prototypejs.org/api/element/update)中执行此操作：`$(id).update(data)`

和[jQuery](http://docs.jquery.com/Manipulation/replaceWith#content)：`$('#id').replaceWith(data)`

但`document.getElementById(id).innerHTML=data`也应该工作。

编辑：原型和 jQuery 自动为您评估脚本。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-27T15:07:31.317

你可以尝试做

```
document.getElementById(id).innerHTML = ajax_response 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2014-04-30T02:17:37.393

最简单的方法是

```
$("body").html(data); 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-27T18:01:46.160

您不能尝试用 document.body 处理程序替换正文内容吗？

如果您的页面是这样的：

```
<html>
<body>
blablabla
<script type="text/javascript">
document.body.innerHTML="hi!";
</script>
</body>
</html> 
```

只需使用 document.body 来替换正文。

这对我有用。BODY 标记的所有内容都被您指定的 innerHTML 替换。如果您甚至需要更改 html 标记和所有子项，则应检查“文档”的哪些标记。有能力这样做。

一个带有 javascript 脚本的例子：

```
<html>
<body>
blablabla
<script type="text/javascript">
var changeme = "<button onClick=\"document.bgColor = \'#000000\'\">click</button>";
document.body.innerHTML=changeme;
</script>
</body> 
```

这样您就可以在新内容中执行 javascript 脚本。不要忘记转义所有双引号和单引号，否则它将不起作用。可以通过遍历您的代码并在所有单引号和双引号前面加上反斜杠来完成 javascript 中的转义。

请记住，像 php 这样的服务器端脚本不能以这种方式工作。由于 PHP 是服务器端脚本，因此必须在加载页面之前对其进行处理。Javascript 是一种在客户端工作的语言，因此无法激活 php 代码的重新处理。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-27T15:22:39.773

我假设您正在使用 jQuery 或类似的东西。如果您使用的是 jQuery，那么以下应该可以工作：

```
<html>
<head>
   <script src="jquery.js" type="text/javascript"></script>
</head>
<body>
   content
</body>
<script type="text/javascript">
   $("body").load(url);
</script>
</html> 
```

# sql-server - 您如何处理 SQL Server 2008 等软件升级？

> ID：483748
> 
> 赞同：0
> 
> 时间：2009-01-27T15:04:59.310
> 
> 标签：sql-server, visual-studio-2008, visual-studio-2005

我问这个只是因为我发现随着年龄的增长，这成为我工作中更令人沮丧的一部分。

您如何处理新版本的软件，尤其是编码人员和 DBA 经常使用的软件？看来，就在我充实SQL2005的时候，SQL2008来了又去，SQL2010就来了。我错过了整个迭代，这并不是程序员和 DBA 特有的。

我绝不会为了升级而升级，所以除非那里有令人信服的功能，否则我倾向于放手。但不知何故，随着软件发布变得越来越频繁，我不禁觉得这是错误的方法。

**编辑补充：**
我想我所说的部分内容是新版本的发布几乎没有留下足够的时间成为以前版本的专家。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T15:13:49.590

这些升级很少需要重新学习。实际上，我几乎会争辩说，重新学习的数量与发布之间的时间量成正比。所以 SQL Server 2000 到 2005 是 5 年，而且发生了很大的变化。2005年到2008年，变化不大。2008 年到 2010 年，我猜不会有很多东西要学。我认为诀窍是保持领先地位。因为如果你退回了几个版本，赶上事情可能是一场噩梦。即使你只是玩弄它而不在现场项目中使用它，你也可能比很多人更领先。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T15:12:29.093

对于需要稳定的基于服务器的软件，点击“每个版本”并不是一件好事。您从新版本中获得的唯一好处是新功能（如果您不需要它们，则不必担心）以及*现在*发现所有可能*在下一个*版本中出现的不兼容性（除了包含在下一个版本）。

出于这个原因，我们仍然在我们的主要产品上支持 SQL 2000。我们已经针对 2005 年和 2008 年进行了移植和测试……但我们*没有*使用这些新功能。太多的客户端仍在运行 2000。我们最终希望在 2010 发布时减少对 2000 的支持，因为 10 年似乎是一个合理的时间段，所以我们最新的（不是一般发布，但与一些客户端一起使用）版本使用了 2005 的一些功能.

就我们的开发环境而言，我们确实在每个版本发布大约一年后移到了 2005 年和 2008 年（当第一个服务包发布时）。那是因为*客户*不在那儿的跑步机上，所以我们更具侵略性。2005 年和 2008 年的功能也很引人注目（我不使用 Linq to SQL，但我*喜欢*Linq to Objects）。我们还对较新版本的软件进行了大量原型设计，并将我们的内部项目保留在较新的软件上，以跟上计划和学习的技术特性。

就成为专家而言，我认为在所涉及的技术范围内，没有人是整个产品的专家。如果您了解查询优化引擎以及如何从中获得最后一点性能，那么您不太可能在复制引擎上花费大量时间。就个人而言，我认为您应该对所有东西都进行采样，但最终您必须开始工作：而且您的工作很少需要您成为所有方面的专家。只要知道这些功能就足够了，以至于您需要它们的那一天……您可以快速获得新技能并继续前进。

# pcm - YUV/PCM Visualizer 测量唇形同步

> ID：483770
> 
> 赞同：-1
> 
> 时间：2009-01-27T15:10:43.200
> 
> 标签：pcm, yuv

我有两个来自编码器的原始视频和原始音频转储文件，我希望能够测量“唇形同步”。想象一下锤子敲击铁砧的视频。我想逐帧查看，当锤子最终击中铁砧时，音轨上的振幅会出现尖峰。

由于一切发生的速度，我不能只听音频，我需要在时域中查看波形。

是否有任何工具可以让我同时看到视频和音频？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-06-02T16:28:28.573

如果您关心验证解码器，那么通常从验证的角度来看，目标是根据公共实时时钟检查音频和视频 PTS 值。

原始 YUV 和 PCM 文件不包括时间戳。**如果**您知道帧速率和采样率，则可以使用原始 yuv 文件查看器（我自己编写）来计算视频中给定帧的时间（从文件开始），以及 Audacity 之类的工具找出从文件开始到音频文件中音调开始的时间。这仍然可能无法告诉您全部情况，因为工具通常会在 ts/ps 文件中的音频和视频之间嵌入延迟。或者，您可以连接上 OScope 并继续上学。

# linux - 我应该如何从非 root Debian Linux 守护进程登录？

> ID：483781
> 
> 赞同：38
> 
> 时间：2009-01-27T15:13:09.903
> 
> 标签：linux, logging, debian, root

我正在编写一个新的守护进程，它将托管在 Debian Linux 上。

我发现 /var/log 只有 root 写权限，所以我的守护进程不能在那里写日志文件。

但是，如果它在那里写入，它似乎将获得自动日志轮换，并且还可以像用户期望的那样工作。

守护进程写入出现在 /var/log 中的日志条目而不必以 root 身份运行的推荐方法是什么？

守护进程是一个网络服务器，因此日志流量将类似于 Apache。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-01-27T15:19:29.360

您应该创建一个子目录，例如`/var/log/mydaemon`拥有守护程序的用户所有权

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-01-27T15:25:11.283

以 root 身份在此处创建一个日志文件并将文件所有者更改为网络服务器用户：

```
# touch /var/log/myserver.log
# chown wwwuser /var/log/myserver.log 
```

如果以用户身份运行，则服务器可以写入文件`wwwuser`。但是，它不会获得自动日志轮换。您必须将日志文件添加到`/etc/logrotate.conf`或`/etc/logrotate.d/...`让您的服务器在[logrotate](http://man.cx/logrotate)发出信号时重新打开日志文件。

[`syslog`](http://man.cx/syslog)如果更适合您的场景，您也可以用于日志记录。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-27T15:25:59.800

两种选择：

1.  以 开头`root`，打开文件，然后使用 删除权限`setuid`。（我不记得删除权限的确切系统调用。）如果你想绑定到 TCP 端口 80 或低于 1024 的任何端口，无论如何你都必须这样做。
2.  [正如WiseTechi 所说](https://stackoverflow.com/questions/483781/how-should-i-log-from-a-non-root-debian-linux-daemon#483817)，创建一个像 /var/log/mydaemon 这样具有守护进程用户所有权的子目录。

下的文件`/var/log`不会自动旋转；相反，旋转由`/etc/logrotate.conf`和 下的文件控制`/etc/logrotate.d`。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-05-24T10:13:51.153

使用“记录器”命令

[http://linux.die.net/man/1/logger](http://linux.die.net/man/1/logger)

# vb.net - 选择 Winforms Infragistics ComboBox 中的所有文本

> ID：483782
> 
> 赞同：1
> 
> 时间：2009-01-27T15:13:12.693
> 
> 标签：vb.net, winforms, infragistics, selectall

有没有办法做到这一点？我想模仿 Windows 窗体中 UltraTextBox.SelectAll 方法的行为。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-30T10:01:05.657

您可能需要提供 Infragistics Library 的确切版本...

做

`this.UltraCombo1.TextBox.SelectAll()`

做你想做的事？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-28T05:51:06.200

我认为您的问题是您将 HideSelection 设置为 true。如果将此设置为 false，则 textBox1.SelectAll 将按预期运行...或者，您需要在调用 SelectAll() 之前将焦点放在文本框上。

我不确定 SelectAll 如何适用于 UltraTextBox，但我认为它只是选择了文本框中的所有文本。

# asp.net - Visual Studio IDE 和 IIS 之间的 CSS 问题

> ID：483783
> 
> 赞同：2
> 
> 时间：2009-01-27T15:13:27.687
> 
> 标签：asp.net, css, visual-studio

我不是网络开发人员，所以对我来说似乎很奇怪的事情希望是一个简单的事情。

有一个现有的 ASP.NET 网站，我需要使用 VS 2008 对其进行修改。我在一个 aspx 页面上工作，不知何故 CSS 设置发生了变化，把页面弄得一团糟。我恢复了旧的 CSS 文件，现在页面在 IDE 中再次正常，但是当我运行项目时仍然一团糟。

任何想法将不胜感激

史蒂文·西格尔

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T15:17:52.157

您是否尝试过清除浏览器的缓存？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T15:20:29.340

会不会是，该网站需要身份验证（即 FormsAuthentication）？

如果是这样，Visual Studio ASP.NET 开发服务器还会阻止 css 文件和图像，使您的 Web 应用程序在 Visual Studio 中看起来像垃圾......但是 IIS 没有这种行为，所以当您部署您的网站时，一切看起来都很好并且整齐的...

# .net - 针对 SQL Server 2008 运行时，SqlDataReader.HasRows 中是否存在错误？

> ID：483787
> 
> 赞同：20
> 
> 时间：2009-01-27T15:14:15.657
> 
> 标签：.net, sql, sql-server, sql-server-2008, ado.net

看看这两个查询：

```
-- #1
SELECT * FROM my_table
WHERE CONTAINS(my_column, 'monkey')

-- #2
SELECT * FROM my_table
WHERE CONTAINS(my_column, 'a OR monkey')  -- "a" is a noise word 
```

当我在 Management Studio 中运行查询 #1 时，它会返回 20 行。
查询 #2 返回相同的 20 行，但我还在“消息”选项卡中看到以下内容：

> 信息性：全文搜索条件包含干扰词。

到目前为止，很无聊——这正是我所期望的。

现在，看看这个 C# 片段：

```
using (SqlConnection conn = new SqlConnection(...))
{
    SqlCommand cmd = conn.CreateCommand();
    // setup the command object...

    conn.Open();
    using (SqlDataReader dr = cmd.ExecuteReader())
    {
        if (dr.HasRows)
        {
            // get column ordinals etc...

            while (dr.Read())
            {
                // do something useful...
            }
        }
    }
} 
```

当我针对查询 #1 运行此代码时，一切都按预期运行 - 20 行中的每一行都点击了“做一些有用的事情”部分。

当我针对查询 #2 运行它时，什么也没有发生 - “做一些有用的事情”部分永远不会到达。

*现在这里的事情变得更有趣了......*

如果我删除`HasRows`检查，那么一切都会按预期工作 - 无论使用哪个查询，20 行中的每一行都会命中“做一些有用的事情”部分。

`HasRows`如果 SQL Server 生成消息，则似乎未正确填充该属性。结果被返回，并且可以通过使用`Read()`方法进行迭代，但`HasRows`属性将为 false。

这是 .NET 和/或 SQL Server 中的一个已知错误，还是我遗漏了一些明显的东西？
我正在使用 VS2008SP1、.NET3.5SP1 和 SQL2008。

**编辑：我很欣赏我的问题与**[这个](https://stackoverflow.com/questions/197220/sqldatareader-hasrows-returns-false-since-sql-2008-upgrade)问题非常相似，而且几乎可以肯定是同一个问题的表现，但是这个问题已经陷入了三个月没有明确的答案。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-06T10:49:41.527

我是引用问题（丢失登录）的原始发帖人，但从未设法弄清楚。最后，我把它归结为邪恶的巫毒教，牺牲了整洁并选择了类似的东西

```
bool readerHasRows=false;
while(reader.reader())
{
   readerHasRows=true;
   doStuffOverAndOver();
}
if (!readerHasRows)
{
   probablyBetterShowAnErrorMessageThen();
} 
```

真正奇怪的是，它在一个 aspx 页面中工作，而不是在另一个页面中工作，尽管代码块几乎与使用的存储过程相同。

不用说我从现在开始避免使用 .HasRows ;)

**编辑**- Management Studio 也在我项目中问题过程的消息选项卡中显示消息。所以这似乎是问题的原因。但是为什么它会搞砸.HasRows？

**EDIT2** - 确认，更改查询以避免警告消息，并且 .hasrows 现在为真。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T15:29:45.907

这当然是奇怪的行为 - 但我想知道为什么你需要检查`HasRows`你是否要简单地迭代结果集。

该`HasRows`属性封装了一个`_hasRows`字段，该字段由于许多不同的原因而被设置在许多不同的地方`true`或`false`内部。如果 private的方法返回一个指示数据存在的数字，则`SqlDataReader`这些位置中的大多数都设置为。`true``TdsParserStateObject``PeekByte`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-03T21:16:29.130

听起来 HasRows 是不能保证其值准确的属性之一......

我同意前两篇文章（关于直接进入 while(dr.Read()) 并在第一次迭代中获取序数）。另外，为什么不获取数据集而不是数据读取器？如果在这种情况下您只处理 20 行，与使用数据读取器相比，一次获取整个数据集可能不会对性能造成太大影响。我知道这并不能真正回答你的问题，而只是一个解决方法的想法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T21:58:20.700

尝试以下操作并报告是否成功：

```
using (SqlDataReader dr = cmd.ExecuteReader(CommandBehavior.SingleResult)) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T16:13:36.707

与 Andrew 一样，我不确定您为什么不只使用 while 循环，以避免额外的 GetOrdinal 调用对性能造成影响。您可以使用标志值在第一行执行 GetOrdinal 调用，然后可以跳过代码。

过去我注意到 HasRows 有类似的问题，并且采用了与上面列出的类似我的模式，但问题很少。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-12-04T20:33:58.980

如果怀疑有多个结果集导致此问题，我建议调用 NextResult 方法。由于第一个结果集看起来是空的，因此使用 CommandBehavior.SingleResult 不会改变行为，因为仍然会返回第一个（空）结果。你可以试试。无论如何，我听说这是一个错误，但我不记得我在哪里看到它，并且快速谷歌搜索没有产生任何结果。

# xml - JSON 作为数据库导出格式

> ID：483788
> 
> 赞同：4
> 
> 时间：2009-01-27T15:14:20.960
> 
> 标签：xml, json

问题。我们将事物记录到数据库中。为了限制磁盘空间的使用，我们从数据库导出到可以复制的文件，或者只是平面删除。我上面的一些权力希望将其视为 JSON。

我将单个 JSON 文件视为单个对象。因此，在这种情况下，我们将创建一个包含日志消息列表的对象。问题是，这个文件中可能有几百万个日志项，我想这会阻塞大多数解析器。所以我认为唯一的方法是让每个日志项都有自己的 JSON 对象。

这意味着 JSON 解析器无法处理文件。但是我们可以编写一个行解析器来读取文件并通过 JSON 解析器推送每一行。

这听起来正确吗？

我相信 XML 也会有同样的问题，但至少我们有 SAX.. 或者我们可以将它作为一堆迷你文档来做，所有这些文档都以它们的长度为前缀。

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-04T01:00:01.420

JSON 的整个想法与在文件中存储数百万个条目并不完全共存......

JSON 的全部意义在于消除 XML 造成的开销。如果您将每条记录写为 JSON 对象，那么您将返回存储没有意义的开销位。下一个合乎逻辑的步骤是写出一个带有标题记录的常规 CSV 文件，地球上的所有东西都知道如何导入。

如果出于某种原因，您有子记录，那么您应该查看常规 EDI 的工作方式。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-04T00:29:47.920

没错，我一直无法找到一个 json 解析器，它不需要整个过程一次都在内存中，至少在过程的某些部分（我有一个 json 格式的数据库转储，我需要解析.. .这是一场噩梦）。

当前完成此操作的常用方法是使用对象样式或 csv 样式

对象风格：

```
{"name":"bob","position":"ceo","start_date":"2007-08-10"}
{"name":"tom","position":"cfo","start_date":"2007-08-11"} 
```

，ETC。

.csv 样式：

```
["name","position","start_date"]
["bob","ceo","2007-08-10"]
["tom","cfo","2007-08-11"] 
```

使用对象样式会浪费大量磁盘空间，但每一行都是自包含的。

您可以使用 csv 样式节省磁盘空间，但您的数据与格式更紧密地耦合，除非您需要嵌套数据结构，例如：

```
["bill","cto","2007-08-12",{"projects":["foo","bar","baz"]}] 
```

您还不如实际使用 CSV 格式。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-02-16T21:42:35.963

您的策略听起来不错：在 JSON 中拥有单个对象并使用标准 JSON 工具生成/解析它们，并在 JSON 之外自己处理分组问题。

除了将所有数据转储到一个文件中之外，您可能还需要考虑其他策略。例如，您可以将每个对象保存在一个单独的文件中，或者（如果因为您说您有数百万个对象而这太过分了）将它们分批放入合理的组中的文件中，并根据您为这些对象拥有的某些标识符命名文件，或者只是主键（所以你得到“0-10000”，“10001-20000”等）或其他东西。例如，对于日志条目，日期/时间将是合适的。这样，如果某个可怜的灵魂有一天需要以任何形式使用或检查这些数据，它就更易于管理了。要将这些文件转换为存档格式，只需将它们压缩/压缩到一个文件中，JSON 作为文本数据应该可以很好地压缩。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T15:17:18.630

> 这意味着 JSON 解析器无法处理文件。但是我们可以编写一个行解析器来读取文件并通过 JSON 解析器推送每一行。
> 
> 这听起来正确吗？

这听起来很合理......所以你最终会得到一大堆由换行符分隔的行，每一行都由一个 JSON 对象组成。

# objective-c - OCMock：让存根做某事

> ID：483789
> 
> 赞同：1
> 
> 时间：2009-01-27T15:14:42.987
> 
> 标签：objective-c, cocoa, cocoa-touch

我已经习惯了 OCMock。来自 Java/JMock 背景，我现在正在寻找能够说出测试类中定义的位置的`[[[myMock stub] returnValueFromCustomMethod] someMockedMethod];`能力`returnValueFromCustomMethod`。我最初是按照以下条款思考的，`[[[myMock stub] usingSelector:@selector(myMethod:)] someMockedMethod];`但在写完之后，我想知道我的第一种方法是否更有意义。无论哪种方式，有人可以告诉我是否以及如何做到这一点？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-06T00:08:21.870

我最初的答案是偏离轨道：OCMock 不支持这个！如果你想改变 OCMock 来支持这个，你需要做一些事情，比如向`BOOL returnValueIsFromInvocation`OCMockRecorder 添加一个字段，并添加一个方法来设置它：

```
- (id)andReturnResultOfInvocation:(NSInvocation *)anInvocation {
  returnValueIsFromInvocation = 是；
  returnValueIsBoxed = 否；
  returnValueShouldBeThrown = 否；
  [返回值自动释放]；
  returnValue = [anInvocation 保留];
  回归自我；
}

```

然后教`setUpReturnValue`调用调用（更改以粗体显示）：

```
- (void)setUpReturnValue:(NSInvocation *)anInvocation
{
  如果（returnValueIsFromInvocation）{
    NSInvocation *returnValueInvocation = (NSInvocation *)returnValue;
    [returnValueInvocation 调用];
    void *buffer = malloc([[anInvocation methodSignature] methodReturnLength]);
    [returnValueInvocation getValue:buffer];
    [anInvocation setReturnValue:buffer];
    免费（缓冲区）；
  }
  否则如果（returnValueShouldBeThrown）
  {
    @抛出返回值；
  }
  否则如果（returnValueIsBoxed）
  {
    if(strcmp([[anInvocation methodSignature] methodReturnType],
              [(NSValue *)returnValue objCType]) != 0)
      [NSException 引发：NSInvalidArgumentException
                  format:@"返回值与方法签名不匹配。"];
    void *buffer = malloc([[anInvocation methodSignature] methodReturnLength]);
    [返回值获取值：缓冲区]；
    [anInvocation setReturnValue:buffer];
    免费（缓冲区）；
  }
  别的
  {
    const char *returnType = [[anInvocation methodSignature] methodReturnType];
    const char *returnTypeWithoutQualifiers = returnType + (strlen(returnType) - 1);
    if(strcmp(returnTypeWithoutQualifiers, @encode(id)) == 0)
      [anInvocation setReturnValue:&returnValue];   
  }
}

```

这种改变很难通过引入子类来实现，因为您必须重写返回 OCMockRecorder 的方法（如`stub`，`expect`等等），但是 OCMockObject 的具体子类（OCClassMockObject 和 OCProtocolMockObject）被框架隐藏了。

# .net - 将枚举转换为字符串

> ID：483794
> 
> 赞同：188
> 
> 时间：2009-01-27T15:15:40.333
> 
> 标签：.net, enums

在 .NET 3.5 中将枚举转换为字符串的首选方法是什么？

*   枚举.GetName
*   枚举格式
*   字符串

为什么我应该更喜欢其中之一而不是其他？一个表现更好吗？

* * *

## 回答 #1

> 赞同：164
> 
> 时间：2015-07-31T09:04:02.820

从 C#6 开始，获取枚举名称的最佳方法是 new`nameof`运算符：

```
nameof(MyEnum.EnumValue);

// Ouputs
> "EnumValue" 
```

这在编译时有效，枚举被编译结果中的字符串替换，这反过来意味着这是最快的方式。

如果您认为枚举名称的混淆是值得或重要的，那么枚举名称的任何使用都会干扰代码混淆 - 这可能是另一个问题。

* * *

## 回答 #2

> 赞同：98
> 
> 时间：2010-12-10T19:52:25.767

适用于我们的项目...

```
public static String convertToString(this Enum eff)
{
    return Enum.GetName(eff.GetType(), eff);
}

public static EnumType converToEnum<EnumType>(this String enumValue)  
{
    return (EnumType) Enum.Parse(typeof(EnumType), enumValue);
} 
```

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2013-06-10T23:55:29.190

在我的测试中，`Enum.GetName`速度更快，而且幅度很大。内部`ToString`调用`Enum.GetName`。[来自](http://www.dotnetframework.org/default.aspx/4@0/4@0/DEVDIV_TFS/Dev10/Releases/RTMRel/ndp/clr/src/BCL/System/Enum@cs/1305376/Enum@cs).NET 4.0 的源代码，要点：

```
public override String ToString()
{
     return Enum.InternalFormat((RuntimeType)GetType(), GetValue());
}

private static String InternalFormat(RuntimeType eT, Object value)
{
    if (!eT.IsDefined(typeof(System.FlagsAttribute), false))
    {
        String retval = GetName(eT, value); //<== the one
        if (retval == null)
            return value.ToString();
        else
            return retval;
    }
    else
    {
        return InternalFlagsFormat(eT, value);
    }
} 
```

我不能说这是肯定的原因，但测试状态一个比另一个快。这两个调用都涉及装箱（实际上它们是反射调用，您实际上是在检索字段名称）并且可能会因您的喜好而变慢。

> **测试设置**：有 8 个值的枚举，没有。迭代次数 = 1000000
> 
> **结果**：Enum.GetName => 700 毫秒，ToString => 2000 毫秒

如果速度不明显，我不会在意和使用，`ToString`因为它提供了更干净的通话。对比

```
Enum.GetName(typeof(Bla), value) 
```

和

```
value.ToString() 
```

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2013-04-18T13:39:32.537

## 枚举.GetName(...)

这是最优雅的方法。

```
var enumValueString = Enum.GetName(typeof (MyEnum), MyEnum.MyValue); 
```

虽然我没有看到调用的任何问题，`.ToString()`因为它只是更短。

```
var enumValueString = MyEnum.MyValue.ToString(); 
```

* * *

使用新的 C# 6 语法，您可以使用：

```
nameof(MyEnum.MyValue) 
```

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2009-01-27T15:45:06.733

所有这些在内部最终都会调用一个名为`InternalGetValueAsString`. `ToString`和之间的区别在于`GetName`必须`GetName`首先验证一些事情：

1.  您输入的类型不为空。
2.  您输入的类型实际上是一个枚举。
3.  您传入的值不为空。
4.  您传入的值是枚举实际上可以用作其基础类型的类型，或者是枚举本身的类型。它使用`GetType`值来检查这一点。

`.ToString`不必担心上述任何问题，因为它是在类本身的实例上调用的，而不是在传入的版本上调用，因此，由于该`.ToString`方法没有相同的验证问题作为静态方法，我认为这`.ToString`是将值作为字符串获取的最快方法。

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2009-01-27T15:35:55.927

我能找到的最好的是[MSDN 上的这个不相关的问题](http://social.msdn.microsoft.com/Forums/en-US/vstscode/thread/78f9dfe5-2d81-4f5d-b5a9-d0be5349276d/)，它包含一个回答这个问题的 XML 片段。这些方法中的任何一个都有相同的缺陷：它们调用，在使用[Dotfuscation](http://msdn.microsoft.com/en-us/library/ms227255.aspx)`enum.toString()`时无法正常工作。其他问题似乎与间接装箱（GetName 和 Format）有关。不幸的是，我找不到使用上述任何一种的任何性能原因。

从[xml 片段](http://social.msdn.microsoft.com/Forums/en-US/vstscode/thread/78f9dfe5-2d81-4f5d-b5a9-d0be5349276d/)中解释，

> 将盒装枚举传递给 string.Format() 或任何其他函数都可能导致`enum.ToString()`被调用。这会在 Dotfuscating 时引起问题。您不应使用`enum.ToString()`, `enum.GetNames()`, `enum.GetName()`,`enum.Format()`或`enum.Parse()`将枚举转换为字符串。相反，请使用 switch 语句，并在必要时将名称国际化。

* * *

## 回答 #7

> 赞同：16
> 
> 时间：2009-01-27T15:17:16.663

**`Enum.GetName()`**

`Format()`实际上只是一个`GetName()`带有一些格式化功能的包装器（或者`InternalGetValueAsString()`确切地说）。`ToString()`几乎相同`Format()`。我认为这`GetName()`是最好的选择，因为它对任何阅读源代码的人来说都是显而易见的。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2009-01-27T15:47:29.927

我创建了一个“描述”扩展方法并将其附加到枚举，以便我可以获得真正用户友好的命名，包括空格和大小写。我从不喜欢将枚举值本身用作可显示的文本，因为我们开发人员使用它来创建更具可读性的代码。它不适用于 UI 显示目的。我希望能够更改 UI 而无需遍历和更改枚举。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2009-01-27T15:27:06.893

我不知道“首选”方法是什么（询问 100 个人并获得 100 种不同的意见），但做最简单且有效的方法。 `GetName`工作，但需要更多的击键。 `ToString()`似乎做得很好。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2017-12-21T13:49:56.643

对于 VB 爱好者：

```
EnumStringValue = System.Enum.GetName(GetType(MyEnum), MyEnumValue) 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2021-04-06T08:41:20.007

对我来说，将*枚举*转换为*字符串*的最简单方法是：

```
// Sample for Enum.ToString(String)
using System;

class Sample
{
    enum Colors {Red, Yellow = 12};

    public static void Main()
    {
    Colors myColor = Colors.Yellow;

    Console.WriteLine("Colors.Red = {0}", Colors.Red.ToString("d"));
    Console.WriteLine("Colors.Yellow = {0}", Colors.Yellow.ToString("d"));

    Console.WriteLine("{0}myColor = Colors.Yellow{0}", Environment.NewLine);

    Console.WriteLine("myColor.ToString(\"g\") = {0}", myColor.ToString("g"));
    Console.WriteLine("myColor.ToString(\"G\") = {0}", myColor.ToString("G"));

    Console.WriteLine("myColor.ToString(\"x\") = {0}", myColor.ToString("x"));
    Console.WriteLine("myColor.ToString(\"X\") = {0}", myColor.ToString("X"));

    Console.WriteLine("myColor.ToString(\"d\") = {0}", myColor.ToString("d"));
    Console.WriteLine("myColor.ToString(\"D\") = {0}", myColor.ToString("D"));

    Console.WriteLine("myColor.ToString(\"f\") = {0}", myColor.ToString("f"));
    Console.WriteLine("myColor.ToString(\"F\") = {0}", myColor.ToString("F"));
    }
}
/*
This example produces the following results:
Colors.Red = 0
Colors.Yellow = 12

myColor = Colors.Yellow

myColor.ToString("g") = Yellow
myColor.ToString("G") = Yellow
myColor.ToString("x") = 0000000C
myColor.ToString("X") = 0000000C
myColor.ToString("d") = 12
myColor.ToString("D") = 12
myColor.ToString("f") = Yellow
myColor.ToString("F") = Yellow
*/ 
```

现在要将所选字符串转换回*Enum*，您只需*解析*它：

```
var myYellowEnum = Enum.Parse(typeof (Colors), "Yellow"); // Returns Yellow 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-03-02T12:09:07.220

这也行。

```
 List<string> names = Enum.GetNames(typeof(MyEnum)).ToList(); 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-11-21T12:41:54.763

`ToString()`从可读性的角度来看，给出了最**明显**`Enum.GetName()`的结果，而使用需要更多的心理分析才能快速理解它试图做什么（除非你一直看到模式）。

从纯粹的性能角度来看，正如@nawfal 的回答中已经提供的那样，`Enum.GetName()`更好。

如果性能确实是您的目标，那么事先提供查找（使用字典或其他映射）会更好。

在 C++/CLI 中，这看起来像

```
Dictionary<String^, MyEnum> mapping;
for each (MyEnum field in Enum::GetValues(MyEnum::typeid))
{
    mapping.Add(Enum::GetName(MyEnum::typeid), field);
} 
```

使用 100 个项目和 1000000 次迭代的枚举进行比较：

> Enum.GetName：~800ms
> .ToString()：~1600ms
> 字典映射：~250ms

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-10-05T15:09:16.350

有了新的 Roslyn 警告，这个问题让我开始思考。我的研究使我找到了 2 个图书馆。两者都显示出比内置 .NET 5 方法 ToString、GetName 等更好的性能。看看基准测试：

[枚举.NET](https://github.com/TylerBrinkley/Enums.NET)

[快速枚举](https://github.com/xin9le/FastEnum)

* * *

## 回答 #15

> 赞同：-3
> 
> 时间：2015-06-17T11:58:42.913

简单：将名称枚举到列表中：

```
List<String> NameList = Enum.GetNames(typeof(YourEnumName)).Cast<string>().ToList() 
```

# c++ - 使用 g++ 编译动态共享库

> ID：483797
> 
> 赞同：16
> 
> 时间：2009-01-27T15:16:44.107
> 
> 标签：c++, linux, g++, shared-libraries

我正在尝试使用 g++从[Program-Library-HOWTO编译以下简单的 DL 库示例代码。](http://tldp.org/HOWTO/Program-Library-HOWTO/dl-libraries.html)这只是一个示例，因此我可以学习如何使用和编写共享库。我正在开发的库的真实代码将用 C++ 编写。

```
#include <stdlib.h>
#include <stdio.h>
#include <dlfcn.h>

int main(int argc, char **argv) {
    void *handle;
    double (*cosine)(double);
    char *error;

    handle = dlopen ("/lib/libm.so.6", RTLD_LAZY);
    if (!handle) {
        fputs (dlerror(), stderr);
        exit(1);
    }

    cosine = dlsym(handle, "cos");
    if ((error = dlerror()) != NULL)  {
        fputs(error, stderr);
        exit(1);
    }

    printf ("%f\n", (*cosine)(2.0));
    dlclose(handle);
} 
```

如果我用 gcc 编译程序，它工作正常。

```
gcc -o foo foo.c -ldl 
```

当我将文件名和编译器更改为以下

```
g++ -o foo foo.cpp -ldl 
```

我收到以下错误：

> foo.cpp:16：错误：从 'void*' 到 'double (*)(double)' 的无效转换

我理解（我*想*我理解，如果这是错误的，请纠正我）我不能从 C++ 中的 void 指针进行隐式转换，但是 C 允许我，这就是为什么上面的代码将使用 gcc 编译但不使用克++。所以我通过将上面的第 16 行更改为：

```
cosine = (double *)dlsym(handle, "cos"); 
```

有了这个，我收到以下错误：

> foo.cpp:16: 错误：不能在赋值中将 'double*' 转换为 'double (*)(double)'

这些问题可能更多地与我自己对适当的 C++ 编码标准的普遍无知有关，而不是其他任何事情。谁能给我指出一个关于使用 C++ 示例代码为 Linux 开发动态库的好教程？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-01-27T15:38:04.673

C 允许隐式转换`void *`为任何指针类型（包括函数指针）；C++ 需要显式转换。正如 leiflundgren 所说，您需要将返回值`dlsym()`转换为所需的函数指针类型。

许多人发现 C 的函数指针语法很尴尬。一种常见的模式是 typedef 函数指针：

```
typedef double (*cosine_func_ptr)(double); 
```

您可以将函数指针变量定义`cosine`为您的类型的成员：

```
cosine_func_ptr cosine; 
```

并使用类型而不是笨拙的函数指针语法进行转换：

```
cosine = (cosine_func_ptr)dlsym(handle, "cos"); 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-27T15:29:56.263

`dlsym`返回一个指向符号的指针。（至于`void*`通用。）在您的情况下，您应该将其转换为函数指针。

```
 double (*mycosine)(double); // declare function pointer
 mycosine = (double (*)(double)) dlsym(handle, "cos"); // cast to function pointer and assign

 double one = mycosine(0.0); // cos(0) 
```

所以这是编译器错误是一个很好的线索的罕见情况之一。;)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T15:39:44.403

以您的代码编写方式，这实际上更像是一个 C 问题，但您可以让它在 C++ 中工作。我没有关于动态共享库的教程（您链接到的网页看起来不错），但这里是如何在 C++ 中修复您的代码：

*   将 my_cos 声明为将（最终）调用动态加载的余弦函数的函数：

    ```
    double my_cos(double); 
    ```

*   将函数指针分配给 my_cos

    ```
    my_cos = (double (*)(double)) dlsym(handle, "cos"); 
    ```

这有点复杂，但它为 my_cos 分配了返回双精度的东西，是取消引用另一个函数指针的结果，并将双精度作为参数。正如其他人所发布的，C++ 比 C 对代码的明确性要求更高。

*   用 std::cerr 或 std::cout 替换那个过时的 fputs 消息：

    ```
    std::cerr << "error loading library cos: " << error << std::endl; 
    ```

和

```
std::cout << "result is " << (*my_cos)(2.0)) << std::endl; 
```

希望对此有所帮助。如果那些奇怪的东西吓到你，我会推荐 van Linden 的 Deep C Secrets，当然还有 Kernighan 和 Ritchie Book on C。

编辑：关于您如何专门寻找 C++ 而不是 C 中的开发指南以避免此类问题的评论中的要点。我不知道 C++ 中的可比指南，但大约 99% 的 C 代码可以嵌入到 C++ 代码中并且工作得很好。这种函数指针情况是例外之一。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-02-07T21:07:56.947

在 C++ 中，您必须执行`reinterpret_cast`（不是 C 强制转换）：

```
typedef double (* double_from_double_function_t(double));
…
double_from_double_function_t cosine = reinterpret_cast<double_from_double_function_t>(dlsym(handle, "cos")); 
```

# sql-server - 在另一个数据库中创建存储过程

> ID：483798
> 
> 赞同：12
> 
> 时间：2009-01-27T15:17:09.020
> 
> 标签：sql-server, tsql, stored-procedures

任何想法是否可以单独使用 T-SQL 在另一个数据库中创建一个过程，其中数据库的名称事先不知道并且必须从表中读取？有点像这个例子：

```
Use [MasterDatabase]
Declare @FirstDatabase nvarchar(100)
Select Top 1 @FirstDatabase=[ChildDatabase] From [ChildDatabases]
Declare @SQL nvarchar(4000)
Declare @CRLF nvarchar(10) Set @CRLF=nchar(13)+nchar(10)
Set @SQL =
    'Use [+'@Firstdatabase+']'+@CRLF+
    'Go'+@CRLF+
    'Create Proc [Test] As Select 123'
Exec (@SQL) 
```

看看我想做什么？此示例失败，因为 Go 实际上不是 T-SQL 命令，而是查询分析器/SQL 管理工作室识别的内容并产生错误。删除 Go，它也失败了，因为 Create Proc 必须是脚本的第一行。啊啊啊！！

T-SQL 的语法不允许你做这样的事情：

创建 [OtherDatabase].[dbo].[Test]

这是一种耻辱，因为它会起作用！您可以使用 Select 语句来做到这一点，可惜它不一致：

选择 * 从 [OtherDatabase]..[TheTable]

干杯，罗布。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-01-27T15:32:24.840

这很痛苦，但这就是我所做的。我从我在 sqlteam 上找到的一个例子中得到了这个，我想 - 你可能对我不分青红皂白的方式有一些引用问题`REPLACE`：

```
DECLARE @sql AS varchar(MAX)
DECLARE @metasql as varchar(MAX)
DECLARE @PrintQuery AS bit
DECLARE @ExecQuery AS bit

SET @PrintQuery = 1
SET @ExecQuery = 0

SET @sql = 
'
CREATE PROCEDURE etc.
AS
BEGIN
END
'

SET @metasql = '
USE OtherDatabase
EXEC (''' + REPLACE(@sql, '''', '''''') + ''')
'

IF @PrintQuery = 1
    PRINT @metasql
IF @ExecQuery = 1
    EXEC (@metasql) 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-04-27T12:53:12.720

```
DECLARE @UseAndExecStatment nvarchar(4000),
        @SQLString nvarchar(4000)

SET @UseAndExecStatment = 'use ' + @DBName +' exec sp_executesql @SQLString'

SET @SQLString = N'CREATE Procedure [Test] As Select 123'

EXEC sp_executesql  @UseAndExecStatment,
            N'@SQLString nvarchar(4000)', @SQLString=@SQLString 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-11-11T10:38:29.520

这就是我使用 Alter Procedure 的方式：

```
DECLARE @metasql as varchar(MAX)
DECLARE @sql AS varchar(MAX)

SET @sql = 
'ALTER PROCEDURE [dbo].[GetVersion]
    AS 
        BEGIN
            SET NOCOUNT ON;
            SELECT TOP(1)[Version] from VersionTable                
        END'

SET @metasql = '
USE MyProdDb
IF (OBJECT_ID(''GetVersion'') IS NOT NULL  OR OBJECT_ID(''GetVersion'', ''P'') IS NOT  NULL)
BEGIN
  EXEC (''' + REPLACE(@sql, '''', '''''') + ''')
END
'
--PRINT @metasql
EXEC (@metasql) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T15:23:23.797

我想，你可以使用 xp_cmdshell 向 osql 发起攻击。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-28T12:56:49.473

我不认为这可以用 TSQL 来完成。

您可以使用循环名称并动态连接到服务器的 SSIS 包，从而创建您需要的架构 (procs)。

这可能是我会做的，因为这意味着它全部包含在包中。

配置可以通过使用包含要部署模式的服务器/数据库列表的表或外部 xml 文件来保持独立。

# wpf - WPF标签中的换行符？

> ID：483802
> 
> 赞同：92
> 
> 时间：2009-01-27T15:17:38.770
> 
> 标签：wpf, label, newline

如何在 WPF 中的标签文本中添加换行符，如下所示？

```
<Label>Lorem 
  ipsum</Label> 
```

* * *

## 回答 #1

> 赞同：123
> 
> 时间：2009-01-27T15:20:11.870

```
<Label><TextBlock>Lorem<LineBreak/>ipsum</TextBlock></Label> 
```

您需要使用 TextBlock，因为 TextBlock 接受 Inline 对象的集合作为子对象。因此，您为 TextBlock 元素提供了三个内联项：Run Text="Lorem"、LineBreak 和 Run Text="ipsum"。

您不能执行以下操作：

```
<Label>Lorem<LineBreak/>ipsum</Label>` 
```

因为标签接受一个内容子元素。

此外，不确定您的用例到底是什么，但请注意我在您的 Label 元素中放置了一个 TextBlock。是重复的吗？不是真的，看你的需要。这是一篇关于两个元素之间区别的好文章：[Label and TextBlock之间的区别](http://joshsmithonwpf.wordpress.com/2007/07/04/differences-between-label-and-textblock/)

* * *

## 回答 #2

> 赞同：114
> 
> 时间：2013-10-01T17:08:56.770

在 WPF 中，您可以使用该值`"&#10;"`或`"&#xA;"`

例如：

```
<Label Content="Lorem&#10;ipsum" /> 
```

（“10”是换行符的 ASCII 数字）

或者

```
<Label Content="Lorem&#xA;ipsum" /> 
```

（“A”是十六进制换行符的 ASCII 数字）

![示例，带有边框环绕标签以显示边界](https://i.stack.imgur.com/qpLNw.png)

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2016-02-01T09:49:12.860

在 ViewModel 或 Model 中执行此操作时，我发现使用 Environment.NewLine 具有最一致的结果，包括本地化。它也应该直接在视图中工作，但我还没有测试过。

例子：

在视图中

```
<Label Content="{Binding SomeStringObject.ParameterName}" /> 
```

在视图模型中：

```
SomeStringObject.ParameterName = "First line" + Environment.NewLine + "Second line"; 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2020-10-09T13:13:06.243

```
<Label xml:space="preserve">text content
another line</Label> 
```

似乎也有效

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2020-01-23T10:22:34.757

如何将具有多行的 ToolTip 添加到控件（例如按钮）的示例。工具提示的宽度有限，因此如果句子太宽，它会自动换行。

```
<!-- Button would need some properties to make it clickable.-->
<Button>
   <Button.ToolTip>
      <TextBlock Text="Line 1&#x0a;Line 2" MaxWidth="300" TextWrapping="Wrap"/>
    </Button.ToolTip>
</Button> 
```

在 VS2019 + .NET 4.6.1 + WPF 上测试。

# sql-server - Sql Server x64 和 x86 链接服务器

> ID：483811
> 
> 赞同：2
> 
> 时间：2009-01-27T15:19:00.607
> 
> 标签：sql-server, x86, 64-bit, foxpro, visual-foxpro

我有一个需要从 Sql Server 访问的 Visual FoxPro 表。在 Sql Server x86 中，我将只创建一个链接服务器。不幸的是，没有用于 VFP 的 x64 驱动程序 - 因此 Sql Server x64 无法为其创建链接服务器。

到目前为止，我已经提出了以下选项——其中没有一个是我特别喜欢的：

1.  设置一个 x86 Sql Server 用作中继，以便查询从 x64 -> x86 -> VFP。

> 我真的不关心这个，因为除了作为开发人员之外，我还是系统管理员。所以，这意味着我需要修补、维护和监控另一个 Sql Server - 可能还有另一个服务器（假设我不只是使用单独的实例）。
> 
> 此外，由于 VFP 提供程序不能使用 4 部分语法，因此我必须使用 OPENQUERY。想到将 OPENQUERY 语句嵌入到另一个 OPENQUERY 语句中所需要的所有单引号转义让我头晕目眩……

2.  创建一个 CLR 表值函数，尽管程序集（大概？）也是 x64 - 所以我必须退出 proc（IPC？Webservice？）才能实际运行查询

> 事实证明 TVF 需要一个模式，所以这个选项并不像我最初想象的那样干净。我做了一个峰值来让 WCF 客户端进入 MSSQL，它返回一个 XML 列，然后可以使用 Sql XML 数据类型函数对其进行解析。它可以工作，并且实际上比 OPENQUERY 更易于查询，因为它实际上将变量作为参数。这为我节省了大部分单引号和 EXEC 舞蹈。
> 
> 当然，Sql 中的 WCF 完全不受支持，而且闻起来像是一个相当大的 hack。我对性能和可靠性有相当严重的保留。

3.  停止从 Sql Server 到 VFP 的查询，并重写大量客户端代码

> 显然，这是“正确”的答案。但是，有很多客户端代码依赖于 Sql Server 表和 VFP 表之间的连接。重写这些东西以填充临时表或进行客户端连接似乎是一个相当大的负担。

这里希望有人能提出更好的选择，或一些类似的经验。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T15:22:13.253

这是一个讨厌的问题，我同意。

SSIS 在 32 位模式下运行以定期（可能是按需，在由同一 SP 触发的作业中）将数据导入 SQL Server 本机表是另一种选择，如果您可以忍受延迟的话。这将取决于数据更改的频率以及数据略微过时的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-10-29T04:40:03.817

我想我找到了替代方案。Microsoft 已发布[更新的 Access 驱动程序](http://www.microsoft.com/downloads/en/details.aspx?familyid=C06B8369-60DD-4B64-A44B-84B371EDE16D&displaylang=en)，该驱动程序有 32 位和 64 位两种版本。与原始的 Jet OleDB 驱动程序一样，这将允许您从 SQL Server x64[访问 dBase 文件格式。](http://epiclive.net/datalink/DBF.asp#p1)

唯一的限制是 DBF 必须是[ISAM 支持的其中一种 dBASE 格式](http://vblg.xocomp.net/ExternalDB.htm)。我已经使用 dBASE IV 格式进行了一些测试，并且使用以下连接字符串似乎可以正常工作。

```
Provider=Microsoft.ACE.OLEDB.12.0;Data Source=c:\folder;Extended Properties=dBASE IV;User ID=Admin;Password=; 
```

# winapi - Vista live thumbnail issue with SetWindowRgn

> ID：483812
> 
> 赞同：0
> 
> 时间：2009-01-27T15:19:01.670
> 
> 标签：winapi, windows-vista, thumbnails, minimize, dwm

I know I am probably missing something, but I can't seem to get windows to show the live thumbnail preview correctly when using a window that has a region. When hitting the minimize button the preview will clip to the minimized size (160x25) rather than showing the full preview (like it does with other windows).

Few points to make:

1) The preview works fine in Windows Live Messenger, so Microsoft figured out a way to do it.

2) If I call SetWindowRgn only before a window is visible, it works fine (so its not a fault of the DWM not knowing how to deal with regioned windows.) I can call SetWindowRgn many times before the window is visible and it works great.

3) I need to set the window region after I show the window in case of a resize. So a fix to just set it before will not work.

4) Even when using the default window procedure, the bug still happens. So it is not a fault of processing a message incorrectly (but could be a fault of 'not processing' one :) )

5) When minimizing by clicking the taskbar button (instead of the minimize button in the window), the preview normally works fine (even after setting the region when visible). Again proving that it does not how to deal with the preview.

The bug happens if I set a region after I have shown the window. Code to follow:

```
void create(HINSTANCE hInst)
{
    char* className = "default";

    /* Register
    */
    WNDCLASSEX wcex;
    memset(&wcex,0,sizeof(wcex));
    wcex.cbSize = sizeof(WNDCLASSEX);
    wcex.style          = CS_HREDRAW | CS_VREDRAW;
    wcex.lpfnWndProc    = DefWindowProc;
    wcex.hInstance      = hInst;
    wcex.hCursor        = LoadCursor(NULL, IDC_ARROW);
    wcex.hbrBackground  = (HBRUSH)(COLOR_WINDOW+1);
    wcex.lpszClassName  = className;
    RegisterClassEx(&wcex);

    /* Create
     */
    HWND hwnd = CreateWindow(className, className, WS_OVERLAPPEDWINDOW, CW_USEDEFAULT, 0, CW_USEDEFAULT, 0, NULL, NULL, hInst, NULL);

    /* 
     * Set the region
     * If set before the window is shown for the first time, minimize preview on vista works
     */

    RECT rect;
    GetWindowRect(hwnd,&rect);
    HRGN rgn = CreateRoundRectRgn(0,0,rect.right-rect.left,rect.bottom-rect.top,15,15);
    SetWindowRgn(hwnd,rgn,TRUE);

    /* Show the window
     */

    ShowWindow(hwnd,SW_SHOW);

    /* 
     * Set the region a second time.
     * Doing this will break minimize preview on vista
     */

    rgn = CreateRoundRectRgn(0,0,rect.right-rect.left,rect.bottom-rect.top,35,35);
    SetWindowRgn(hwnd,rgn,TRUE);
}

int APIENTRY _tWinMain(HINSTANCE hInstance,
                 HINSTANCE hPrevInstance,
                 LPTSTR    lpCmdLine,
                 int       nCmdShow)
{
    MSG msg;

    create(hInstance);

    while (GetMessage(&msg, NULL, 0, 0))
    {
        TranslateMessage(&msg);
        DispatchMessage(&msg);
    }

    return (int) msg.wParam;
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-09-28T16:27:22.870

Microsoft responded to a tech support incident and listed this as a bug within Vista.

# excel - 通过 VBA 修改 Word 文档中嵌入的 Excel 工作簿

> ID：483813
> 
> 赞同：8
> 
> 时间：2009-01-27T15:19:05.960
> 
> 标签：excel, vba, ms-word

我有一个 Word 文档，其中包含两个嵌入的 Excel 文件（使用插入 -> 对象 -> 从文件创建），我希望使用 Word VBA 对其进行修改。我已经到了能够打开嵌入文件进行编辑的地步（请参见下面的代码），但无法处理 Excel 工作簿，我可以使用它进行修改并保存嵌入文件。有人对此有解决方案吗？提前致谢。

```
Sub TestMacro()

    Dim lNumShapes As Long
    Dim lShapeCnt As Long
    Dim xlApp As Object
    Dim wrdActDoc As Document

    Set wrdActDoc = ActiveDocument

    For lShapeCnt = 1 To 1 'wrdActDoc.InlineShapes.Count
        If wrdActDoc.InlineShapes(lShapeCnt).Type = wdInlineShapeEmbeddedOLEObject Then
            If wrdActDoc.InlineShapes(lShapeCnt).OLEFormat.ProgID = "Excel.Sheet.8" Then
                'This opens the embedded Excel workbook using Excel
                wrdActDoc.InlineShapes(lShapeCnt).OLEFormat.Edit
            End If
        End If
    Next lShapeCnt

End Sub 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-01T10:18:56.817

哎呀，不要做你在评论中建议的事情。您可能最终会得到多个 Excel 实例（检查任务管理器并查看执行代码后有多少）。

首先，添加对 Excel 对象库的引用（Project->References & 选择 Microsoft Excel Object Library）。现在您可以将您的对象声明为真正的 Excel 类型并使用早期绑定，而不是将它们声明为“对象”并使用后期绑定。这不是绝对必要的，但除此之外，这意味着您在编辑代码时会获得 Intellisense。

在您执行 .OleFormat.Edit 之前，您一直在做正确的事情。（我个人会使用 .OleFormat.Activate 但由于我从未尝试过使用 .Edit 我不能说它有所作为）。

完成 .Activate（或者，大概是 .Edit）之后，您就可以访问 OleFormat.Object 成员了。由于嵌入的对象是 Excel 图表，“对象”将是 Excel 工作簿，因此您可以这样做：

```
将 oOleFormat 调暗为 OleFormat
设置 oOleFormat = ...

oOleFormat.Activate

将 oWorkbook 变暗为 Excel.Workbook
设置 oWorkbook = oOleFormat.Object

' 用工作簿做事
oWorkbook.Charts(1).ChartArea.Font.Bold = True

```

请注意，您不需要关闭 Excel，实际上您也不能 - Word“拥有”用于就地编辑的实例，并将决定何时关闭它。这实际上是一个问题，因为没有明显的方法可以强制取消激活嵌入的对象，因此在执行上述代码后图表将保持打开状态。

不过，有一种 hack-y 方法可以关闭图表。如果您添加告诉 Word 将其作为其他内容激活，它会首先将其停用。因此，如果您告诉它以无意义的方式激活它，您将获得正确的结果，因为它会停用它，然后无法重新激活它。因此，添加以下行：

```
oOleFormat.ActivateAs "This.Class.Does.Not.Exist"

```

请注意，这会引发错误，因此您需要使用 On Error Resume Next 暂时禁用错误处理。出于这个原因，我通常会创建一个 Deactivate 方法，以避免破坏我的 main 方法中的错误处理。如：

```
Private Sub DeactivateOleObject(ByRef oOleFormat as OleFormat)
    出错时继续下一步
    oOleFormat.ActivateAs "This.Class.Does.Not.Exist"
结束子

```

希望这可以帮助。加里

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T15:45:32.940

我有自己的问题的解决方案。任何进一步的评论将不胜感激 -

```
Sub TestMacro()

    Dim lNumShapes As Long
    Dim lShapeCnt As Long
    Dim xlApp As Object
    Dim wrdActDoc As Document

    Set wrdActDoc = ActiveDocument

    For lShapeCnt = 1 To 1 'wrdActDoc.InlineShapes.Count
        If wrdActDoc.InlineShapes(lShapeCnt).Type = wdInlineShapeEmbeddedOLEObject Then
            If wrdActDoc.InlineShapes(lShapeCnt).OLEFormat.ProgID = "Excel.Sheet.8" Then
                wrdActDoc.InlineShapes(lShapeCnt).OLEFormat.Edit
                Set xlApp = GetObject(, "Excel.Application")
                xlApp.Workbooks(1).Worksheets(1).Range("A1") = "This is A modified"
                xlApp.Workbooks(1).Save
                xlApp.Workbooks(1).Close
                xlApp.Quit
            End If
        End If
    Next lShapeCnt

End Sub 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-02-08T14:21:33.927

有另一种方法来关闭图表：只需使用查找功能在文档中查找不存在的内容。

例如

```
With Selection.Find
    .ClearFormatting
    .Text = "wiffleball"
    .Execute Forward:=True
End With 
```

这将使您退出嵌入文件，关闭实例并返回主文档，您可以从那里编写代码。

希望这会有所帮助，这个问题让我发疯。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-05-29T08:37:18.720

当您对 xlApp 进行毕业时，您不需要获取特定的工作簿。因此，如果您引用一个数字，您可能不在嵌入文件中。更好地使用 Activeworkbook。对我来说，workbook(1) 原来是我的个人隐藏 xl 文件，其中包含我的个人宏。

我不做测试，因为我的 .docx 中只有一个形状，但我认为数字“Excel.Sheet.8”对我来说是 0.12。

```
 Sub TestMacro()

        Dim lNumShapes As Long
        Dim lShapeCnt As Long
        Dim xlApp As Object
        Dim wrdActDoc As Document

        Set wrdActDoc = ActiveDocument

        For lShapeCnt = 1 To 1 'wrdActDoc.InlineShapes.Count
            If wrdActDoc.InlineShapes(lShapeCnt).Type = wdInlineShapeEmbeddedOLEObject Then
                If wrdActDoc.InlineShapes(lShapeCnt).OLEFormat.ProgID = "Excel.Sheet.8" Then
                    wrdActDoc.InlineShapes(lShapeCnt).OLEFormat.Edit
                    Set xlApp = GetObject(, "Excel.Application")
                    xlApp.ActiveWorkbook.Worksheets(1).Range("A1") = "This is A modified"
                    'xlApp.ActiveWorkbook.Save
                    'xlApp.ActiveWorkbook.Close
                    xlApp.Quit
                End If
            End If
        Next lShapeCnt

    End Sub 
```

当我退出 xlApp 时，焦点离开了嵌入的 xl。没问题。

# wpf - 如何将段落数据绑定到 TextBlock？

> ID：483834
> 
> 赞同：4
> 
> 时间：2009-01-27T15:24:56.960
> 
> 标签：wpf, data-binding, xaml, textblock, paragraph

我将如何获取一个`Paragraph`对象并将它们数据绑定到 TextBlock 以在 DataTemplate 中使用？一个普通的绑定什么都不做，只是一个`ToString()`Paragraph 对象。

InLines 属性可以让我手动添加组成段落的 TextRun 的列表，但这不能绑定，我真的可以使用基于绑定的解决方案。

*编辑问题以专注于我真正需要做的事情。*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-02T22:54:01.680

下面是一个使用嵌套 ItemsControl 的示例。不幸的是，它会为每个内联创建一个 TextBlock，而不是将整个段落放入一个 TextBlock：

```
<Grid xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:sys="clr-namespace:System;assembly=mscorlib"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Grid.Resources>
        <FlowDocument x:Key="document">
            <Paragraph><Run xml:space="preserve">This is the first paragraph.  </Run><Run>The quick brown fox jumps over the lazy dog.</Run></Paragraph>
            <Paragraph><Run xml:space="preserve">This is the second paragraph.  </Run><Run>Two driven jocks help fax my big quiz.</Run></Paragraph>
            <Paragraph><Run xml:space="preserve">This is the third paragraph.  </Run><Run>Sphinx of black quartz, judge my vow!</Run></Paragraph>
        </FlowDocument>
        <DataTemplate DataType="{x:Type Paragraph}">
            <ItemsControl ItemsSource="{Binding Inlines}" IsHitTestVisible="False">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
            </ItemsControl>
        </DataTemplate>
    </Grid.Resources>
    <ListBox ItemsSource="{Binding Blocks, Source={StaticResource document}}"/>
</Grid> 
```

如果您希望每个元素一个段落，您可能应该按照建议执行并使用只读 RichTextBox，或者[执行此人所做](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/b36a413f-e57e-4b60-bc08-bcf1f9c8bfd5/)的并从 TextBlock 派生，以便可以绑定 Inlines 属性。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-11T23:13:02.810

我有类似的需求，并按照安迪的回答解决了它......我创建了一个 BindableTextBlock：

```
class BindableTextBlock : TextBlock
{
    public Inline BoundInline
    {
        get { return (Inline)GetValue(BoundInlineProperty); }
        set { SetValue(BoundInlineProperty, value); }
    }

    public static readonly DependencyProperty BoundInlineProperty =
        DependencyProperty.Register("BoundInline", typeof(Inline), typeof(BindableTextBlock),
            new UIPropertyMetadata((PropertyChangedCallback)((d, e) => { ((BindableTextBlock)d).Inlines.Clear(); ((BindableTextBlock)d).Inlines.Add(e.NewValue as Inline); })));
} 
```

然后在我的 XAML 中，我可以绑定到 BoundInline 依赖属性：

```
 <DataTemplate x:Key="TempTemplate">
        <t:BindableTextBlock TextWrapping="Wrap" BoundInline="{Binding Path=TextInlines}" Grid.Column="1" Grid.Row="1" Grid.ColumnSpan="2" />
    </DataTemplate> 
```

这样做的一个缺点是您只能将单个根内联绑定到文本块，这对我的情况很有效，因为我的内容都包含在顶级 Span 中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-29T20:06:14.813

我不确定您是否可以将段落直接绑定到 TextBlock 的内联。但是，我能够找到可让您绑定到 Run 的 Text 属性的类[BindableRun 。](http://fortes.com/2007/03/bindablerun/)这对你有用吗？

编辑：修改了我的答案以反映已编辑的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-28T01:07:56.863

您可以尝试为 Paragraph 对象创建自己的 DataTemplate，将每个对象包装在自己的 FlowDocument 中，然后通过 RichTextBox 呈现（当然是只读的）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-04-08T09:06:28.593

我遇到了几乎相同的问题，并以与 joshperry 类似的方式回答它，将 TextBlock 子类化以使内联可绑定。此外，我在 xaml 标记字符串和 InlineCollection 之间编写了一个转换器。

[如何将 TextBlock 绑定到包含格式化文本的资源？](https://stackoverflow.com/questions/5565885/how-to-bind-a-textblock-to-a-resource-containing-formatted-text)

# windows-mobile - 从命令行创建 .inf 文件（使用 msbuild）

> ID：483836
> 
> 赞同：3
> 
> 时间：2009-01-27T15:25:06.710
> 
> 标签：windows-mobile, msbuild

我想使用 msbuild 命令行创建 .inf 文件（用于创建 .cab 文件）。

首先，我尝试使用 VS IDE 重建解决方案，并创建了 .inf 文件，该文件可用于创建 .cab 文件（移动设备包）。然后我尝试使用以下命令使用 msbuild 创建 .inf 文件：

```
msbuild solutionName.sln /p:platform="Windows Mobile 6 Professional SDK (ARMV4I)" /t:rebuild" 
```

它成功地重建了解决方案和所有项目，但没有在部署项目目录中创建 .inf 文件。

有谁知道如何从命令行创建 .inf 文件？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-27T16:41:47.837

我假设您的意思是该解决方案包含一个智能设备 CAB 项目并且该项目尚未构建？不幸的是，CAB 项目（以及与此相关的常规桌面安装）有些偏差。它们是 Studio 的插件，实际上不与 msbuild 交互，并且不能直接自动化。相反，你必须破解一个 Exec 命令来运行 devenv，传入参数，然后复制你的结果。 有关桌面安装程序的过程，[请参阅本文。](http://msdn.microsoft.com/en-us/library/ms404859.aspx)同样的过程也适用于设备项目。

这就是我们仍然手动构建 INF 并[独立运行 cabwiz](http://blog.opennetcf.com/ctacke/2008/09/18/AutomatingCABFileGenerationWithMSBUILD.aspx)的确切原因。

# .net - 什么时候应该选择独立存储与 AppData 文件存储？

> ID：483840
> 
> 赞同：5
> 
> 时间：2009-01-27T15:25:57.740
> 
> 标签：.net, isolatedstorage, appdata

我最近`IsolatedStorage`在 .net 中发现了这些工具，我想知道什么时候应该将它们用于我的应用程序数据，什么时候应该使用 (eg) `Application.LocalUserAppDataPath`。

我注意到的一件事是它`Application`不存在于 winforms 应用程序之外，因此`IsolatedStorage`对于需要一些特定存储的类库来说似乎是有意义的，特别是如果该库可能同时被 Web 应用程序和winform 应用程序。这是唯一的区别点，还是还有更多？

（作为一项规则，直到现在，当图书馆可能需要某种外部存储时，我已经让应用程序向图书馆提供文件流——一般来说，我不喜欢图书馆的想法调用者上下文之外的某种状态。）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-27T15:40:52.607

隔离存储有几个有趣的功能可能会让你选择它：

*   即使是信任度极低的应用程序（例如单击一次）也可以访问隔离存储。并非所有应用程序都可以访问 AppData。根据施加于应用程序的安全策略，IsolatedStorage 也可以受到限制，但它通常比 AppData/文件系统更易于访问。

*   隔离存储存储要求可以由管理员策略控制。

*   您不必知道隔离存储数据的存储位置或方式。它有一个统一的 API 可以在所有系统上访问它，您可以完全忽略它存储的底层路径。正如您所指出的，这对于可能不知道托管应用程序如何存储数据的库非常有用。

*   您还可以非常轻松地将数据存储在具有不同隔离级别的隔离存储中。有关详细信息，请参阅[IsolatedStorageScope 值](http://msdn.microsoft.com/en-us/library/system.io.isolatedstorage.isolatedstoragescope.aspx)。这是它的名字，所以我想我应该首先列出这一点:)

不利的一面：

*   隔离存储对您可以存储的数据量有一些明显的限制。例如，应用程序首选项会很好，但不适用于文档。

一些有用的链接：

*   [隔离存储简介](http://msdn.microsoft.com/en-us/library/3ak841sy(VS.80).aspx)
*   [执行隔离存储任务](http://msdn.microsoft.com/en-us/library/8dzkff1s(VS.80).aspx)

# javascript - 是否可以优雅地处理 Google Maps AJAX 请求超时？

> ID：483841
> 
> 赞同：2
> 
> 时间：2009-01-27T15:25:59.470
> 
> 标签：javascript, ajax, google-maps

我的网站使用[Google Maps API](http://code.google.com/apis/maps/)。在与 Google 的连接速度很慢且无法在合理时间内呈现地图的情况下，我希望调用 Javascript 回调方法，以便我可以向用户显示有用的消息，而不是“加载” ...'消息不断显示。

这是可以实现的吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T15:44:12.773

也许你可以有一个睡眠功能来检查页面是否已经加载，并在一段时间后采取某种行动。

请参阅此[帖子](http://www.ozzu.com/programming-forum/javascript-sleep-function-t66049.html)以了解与您的情况类似的情况

setTimeout 也可能有用。

所以，你会有：

```
setTimeout((function() 
           { /* test if the page is loaded, 
                if so, call another function 
                or set a flag to get out*/
           }),2000); //set for 2 seconds 
```

# java - java.util.zip.ZipException：ZIP 文件中的条目太多

> ID：483843
> 
> 赞同：7
> 
> 时间：2009-01-27T15:26:49.937
> 
> 标签：java, zip, large-files, unzip

我正在尝试编写一个 Java 类来提取一个包含 ~74000 个 XML 文件的大型 zip 文件。尝试使用 java zip 库解压缩时出现以下异常：

**java.util.zip.ZipException** : ZIP 文件中的条目太多

不幸的是，由于项目的要求，我无法在它到达我之前将其分解，并且解压缩过程必须是自动化的（没有手动步骤）。有没有办法利用 java.util.zip 或使用一些 3rd 方 Java zip 库来解决这个限制？

谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-27T15:35:22.010

使用`ZipInputStream`而不是`ZipFile`应该这样做。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-29T13:06:56.663

使用 apache IOUtils：

```
FileInputStream fin = new FileInputStream(zip);
ZipInputStream zin = new ZipInputStream(fin);
ZipEntry ze = null;

while ((ze = zin.getNextEntry()) != null) {
    FileOutputStream fout = new FileOutputStream(new File(
                    outputDirectory, ze.getName()));

    IOUtils.copy(zin, fout);

    IOUtils.closeQuietly(fout);
    zin.closeEntry();
}

IOUtils.closeQuietly(zin); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-10T06:42:20.147

Zip 标准在一个文件中最多支持 65536 个条目。除非 Java 库支持 ZIP64 扩展，否则如果您尝试读取或写入包含 74,000 个条目的存档，它将无法正常工作。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-08-03T14:31:49.927

我重新设计了该方法以更方便地处理目录结构并一次压缩一大堆目标。纯文件将添加到 zip 文件的根目录，如果您传递目录，则将保留底层结构。

```
def zip (String zipFile, String [] filesToZip){ 
    def result = new ZipOutputStream(new FileOutputStream(zipFile))
    result.withStream { zipOutStream ->
        filesToZip.each {fileToZip ->
            ftz = new File(fileToZip)
            if(ftz.isDirectory()){
                pathlength = new File(ftz.absolutePath).parentFile.absolutePath.size()
                ftz.eachFileRecurse {f ->               
                    if(!f.isDirectory()) writeZipEntry(f, zipOutStream, f.absolutePath[pathlength..-1]) 
                }
            }               
            else writeZipEntry(ftz, zipOutStream, '')
        }
    }
}

def writeZipEntry(File plainFile, ZipOutputStream zipOutStream, String path) {
    zipOutStream.putNextEntry(new ZipEntry(path+plainFile.name))
    new FileInputStream(plainFile).withStream { inStream ->
        def buffer = new byte[1024]
        def count
        while((count = inStream.read(buffer, 0, 1024)) != -1) 
            zipOutStream.write(buffer)                  
    }
    zipOutStream.closeEntry()
} 
```

# diff - 如何对两个源树使用 diff 命令

> ID：483849
> 
> 赞同：0
> 
> 时间：2009-01-27T15:27:11.730
> 
> 标签：diff, patch

我尝试对两个源目录运行“diff”，得到一个补丁文件，两个目录之间有一个“diff”。

```
diff -rupN flyingsaucer-R8pre2_b/ flyingsaucer-R8pre2/ > a.patch 
```

上面的命令似乎不起作用，它会生成所有内容的差异，我得到一个 13 MB 的文件，而实际上，它应该是一些更改。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T15:34:28.143

应该适用于任何最新版本的 gnu diff（在此处使用 gnu diff 2.8.1 进行测试。）

您可能想要添加 -b（也许还有 -B）来忽略空白区域的差异，这可能会不必要地生成大型补丁文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T15:33:01.890

我看不出有什么理由让它不起作用。尝试将“wb”添加到参数列表以忽略空格更改。你确定两边的斜线都一样吗？

# c# - 尝试在 Delphi 中访问 OleVariant 的无效变体操作异常 - 在 C# 中工作

> ID：483859
> 
> 赞同：0
> 
> 时间：2009-01-27T15:29:41.227
> 
> 标签：c#, delphi, com, ole

我试图在来自 ActiveX 库的回调中访问 OleVariant。

以下是事件处理程序在 TLB 中的定义：

```
procedure(ASender: TObject; var structQSnap: {??structVTIQSnap}OleVariant) of object; 
```

这是 TLB 中 structVTIQSnap 的定义：

```
structVTIQSnap = packed record
  bstrSymbol: WideString;
  bstrListingExch: WideString;
  bstrLastExch: WideString;
  fLastPrice: Double;
  nLastSize: Integer;
  bstrBbo: WideString;
  bstrBidExch: WideString;
  fBidPrice: Double;
  nBidSize: Integer;
  bstrAskExch: WideString;
  fAskPrice: Double;
  nAskSize: Integer;
  fHighPrice: Double;
  fLowPrice: Double;
  fOpenPrice: Double;
  fClosePrice: Double;
  nCumVolume: Integer;
  bstrTradeCondition: WideString;
  nQuoteCondition: Integer;
  bstrCompanyName: WideString;
  f52WeekHigh: Double;
  f52WeekLow: Double;
  fEps: Double;
  nSharesOutstanding: Integer;
  nSpCode: Integer;
  fBeta: Double;
  bstrExDivDate: WideString;
  nDivFreq: Integer;
  fDivAmt: Double;
  nAvgVolume: Integer;
  bstrCusip: WideString;
  fVwap: Double;
  bstrUpdateTime: WideString;
  bstrExch: WideString;
  nSharesPerContract: Integer;
end; 
```

它编译得很好，但是每次我尝试访问 bstrSymbol 时，我都会得到一个“无效的变体操作”：

```
 procedure TForm1.HandleVTIQuoteSnap(ASender: TObject; var structQSnap: OleVariant);
 var
    symbol: WideString;
 begin
    symbol := structQSnap.bstrSymbol; // this line causes the exception
 end; 
```

如何在 Delphi 中访问 structQSnap 及其属性？

在 C# 中，此函数适用于事件处理程序：

```
 void vtiQ_OnVTIQSnap(ref vtiLib.structVTIQSnap structQSnap)
    {
        MessageBox.Show("Got qsnap for " + structQuoteSnap.bstrSymbol);            
    } 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-27T17:12:11.957

我认为 Delphi 的 ActiveX 导入向导不知道如何正确处理 structVTIQSnap 类型（这似乎是一个记录），而只是使用默认的 OleVariant。生成的 ..._TLB.pas 文件中是否有名为 structVTIQSnap 或类似名称的类型声明？尝试使用它而不是 OleVariant，例如

```
procedure (ASender: TObject; var structQSnap: structVTIQSnap) of object; 
```

该类型可能会被声明为“打包记录”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T16:33:23.483

您可以尝试将*structQSnap*类型转换为指向该结构的指针。就像是

```
PstructVTIQSnap = ^structVTIQSnap;
structVTIQSnap = packed record
   bstrSymbol: WideString;
   // other stuff...
end; 
```

和

```
procedure TForm1.HandleVTIQuoteSnap(ASender: TObject;
  var structQSnap: OleVariant);
var
  ps: PstructVTIQSnap;
  symbol: WideString;
begi
  ps := PstructVTIQSnap(structQSnap.VPointer^);
  symbol := ps.bstrSymbol;
  ...
end; 
```

然而，我不明白的是：我从 C# 代码中的*ref*中得到结构应该被编组两次，一次从库到回调，第二次回到库。这意味着需要在 VType 中设置 varByRef 标志（$4000），但是您在评论中给出的值（3484）太小了？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T15:45:34.300

尝试查看 TVarData(structQSnap).VType 中返回的内容？

可能会起作用：

```
 var
   symbol: WideString;
   rec: structVTIQSnap;
 begin
    rec := structVTIQSnap(structQSnap);
    symbol := rec.bstrSymbol; 
 end; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T16:10:06.323

我不确定您为什么将“structVTIQSnap”视为“OleVariant”。对我来说似乎是一个奇怪的翻译。是不是它已经以某种形式（作为数组或类似形式）放入 OleVariant 中？

# windows - 仅用于文件大小的 Windows 命令

> ID：483864
> 
> 赞同：47
> 
> 时间：2009-01-27T15:30:54.093
> 
> 标签：windows, command-line

是否有一个 Windows 命令可以像这样输出指定文件的大小（以字节为单位）？

```
> filesize test.jpg
65212 
```

我知道该[`dir`](https://ss64.com/nt/dir.html)命令输出此信息，但它也输出其他信息。

我可以轻松编写这样的程序，但如果可能的话，我更愿意使用本机 Windows 命令，或者只使用全新安装的 Windows XP 中可用的命令。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-01-27T15:47:07.447

如果您在批处理脚本中，则可以使用参数变量技巧来获取文件大小：

文件大小.bat：

```
@echo off
echo %~z1 
```

这会给出与您在问题中建议的结果类似的结果。

类型

```
help call 
```

在命令提示符下查看所有疯狂的变量操作选项。另请参阅[本文](http://weblogs.asp.net/jgalloway/archive/2006/11/20/top-10-dos-batch-tips-yes-dos-batch.aspx)了解更多信息。

**编辑：** 这仅适用于 Windows 2000 及更高版本

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2009-01-27T16:18:31.923

如果您不想在批处理脚本中执行此操作，可以从命令行执行此操作，如下所示：

```
for %I in (test.jpg) do @echo %~zI 
```

丑陋，但它的工作原理。您还可以传入文件掩码以获取多个文件的列表：

```
for %I in (*.doc) do @echo %~znI 
```

将显示每个 .DOC 文件的大小、文件名。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2012-07-13T22:52:03.300

使用函数来摆脱`~z`运算符中的一些限制。`for`它对循环特别有用：

```
@echo off
set size=0
call :filesize "C:\backup\20120714-0035\error.log"
echo file size is %size%
goto :eof

:: Set filesize of first argument in %size% variable, and return
:filesize
  set size=%~z1
  exit /b 0 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-05-18T13:36:58.177

试试[forfiles](http://technet.microsoft.com/en-us/library/cc753551.aspx)：

```
forfiles /p C:\Temp /m file1.txt /c "cmd /c echo @fsize" 
```

该`forfiles`命令为目录`c`中的每个文件运行命令。`m``p`

该变量`@fsize`被替换为每个文件的大小。

如果文件`C:\Temp\file1.txt`为 27 字节，`forfiles`则运行以下命令：

```
cmd /c echo 27 
```

打印`27`到屏幕上。

作为副作用，它会清除您的屏幕，就像您运行了该`cls`命令一样。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-01-27T16:54:18.873

由于您使用的是 Windows XP，因此可以选择 Windows PowerShell。

```
(Get-Item filespec ).Length 
```

或作为一个函数

```
function Get-FileLength { (Get-Item $args).Length }
Get-FileLength filespec 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-01-27T11:37:04.743

```
C:\>FORFILES  /C "cmd /c echo @fname @fsize"

C:\>FORFILES  /?

FORFILES [/P pathname] [/M searchmask] [/S]
         [/C command] [/D [+ | -] {MM/dd/yyyy | dd}]

Description:
    Selects a file (or set of files) and executes a
    command on that file. This is helpful for batch jobs.

Parameter List:
    /P    pathname      Indicates the path to start searching.
                        The default folder is the current working
                        directory (.). 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-01-20T08:37:13.250

创建一个名为*filesize.cmd*的文件（并放入文件夹*C:\Windows\System32*）：

```
@echo %~z1 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-27T15:43:01.807

在 PowerShell 中，您可以执行以下操作：

```
$imageObj = New-Object System.IO.FileInfo("C:\test.jpg")    
$imageObj.Length 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-12-12T01:14:09.440

取自[这里](http://windowsdevcenter.com/pub/a/windows/excerpt/win_svr_ckbk/part1.html?page=2)：

以下命令在 D: 驱动器上查找大小超过 100 MB 的文件夹：

```
diruse /s /m /q:100 /d d: 
```

/s 选项导致搜索子目录，/m 选项以兆字节显示磁盘使用情况，/q:100 选项导致标记大于 100 MB 的文件夹，而 /d 选项仅显示超过阈值的文件夹由 /q 指定。

使用 diskuse 命令查找超过一定大小的文件。以下命令显示 D: 驱动器上大小超过 100 MB 的文件：

```
diskuse D: /x:104857600 /v /s 
```

/x:104857600 选项导致显示超过 104,857,600 字节的文件，并且仅在包含 /v 选项（详细）时才有效。/s 选项表示搜索来自指定路径（在本例中为 D: 驱动器）的子目录。

**使用 VBScript**

```
' This code finds all files over a certain size.
' ------ SCRIPT CONFIGURATION ------
strComputer = "**<ServerName>**" 
intSizeBytes = 1024 * 1024 * 500  ' = 500 MB
' ------ END CONFIGURATION ---------
set objWMI = GetObject("winmgmts:\\" & strComputer & "\root\cimv2")
set colFiles = objWMI.ExecQuery _
    ("Select * from CIM_DataFile where FileSize > '" & intSizeBytes & "'")
for each objFile in colFiles
    Wscript.Echo objFile.Name & "  " & objFile.Filesize / 1024 / 1024 & "MB"
next 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-10-20T19:44:45.403

这不是您要问的，它只能从命令行使用（并且在批处理文件中可能没用），但是检查文件大小的一种快速方法就是使用`dir`：

```
> dir Microsoft.WindowsAzure.Storage.xml 
```

结果是：

```
Directory of C:\PathToTheFile

08/10/2015  10:57 AM         2,905,897 Microsoft.WindowsAzure.Storage.xml
               1 File(s)      2,905,897 bytes
               0 Dir(s)  759,192,064,000 bytes free 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-05-28T05:30:13.087

在批处理文件中，以下内容适用于本地文件，但不适用于网络硬盘驱动器上的文件

```
for %%I in ("test.jpg") do @set filesize=%~z1 
```

但是，它是劣质代码，因为它不适用于保存在网络驱动器上的文件（例如`\\Nas\test.jpg`和`\\192.168.2.40\test.jpg`）。下面的代码适用于任何位置的文件，我自己编写的。

我确信有更有效的方法可以使用[VBScript](http://en.wikipedia.org/wiki/VBScript)或 PowerShell 或其他方式来执行此操作，但我不想这样做；对我来说很好！

```
set file=C:\Users\Admin\Documents\test.jpg
set /a filesize=
set fileExclPath=%file:*\=%

:onemoretime
set fileExclPath2=%fileExclPath:*\=%
set fileExclPath=%fileExclPath2:*\=%
if /i "%fileExclPath%" NEQ "%fileExclPath2%" goto:onemoretime

dir /s /a-d "%workingdir%">"%temp%\temp.txt"
findstr /C:"%fileExclPath%" "%temp%\temp.txt" >"%temp%\temp2.txt"

set /p filesize= <"%temp%\temp2.txt"

echo set filesize=%%filesize: %fileExclPath%%ext%=%% >"%temp%\temp.bat"
call "%temp%\temp.bat"

:RemoveTrailingSpace
if /i "%filesize:~-1%" EQU " " set filesize=%filesize:~0,-1%
if /i "%filesize:~-1%" EQU " " goto:RemoveTrailingSpace

:onemoretime2
set filesize2=%filesize:* =%
set filesize=%filesize2:* =%
if /i "%filesize%" NEQ "%filesize2%" goto:onemoretime2

set filesize=%filesize:,=%
echo %filesize% bytes

SET /a filesizeMB=%filesize%/1024/1024
echo %filesizeMB% MB

SET /a filesizeGB=%filesize%/1024/1024/1024
echo %filesizeGB% GB 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-22T13:38:52.113

在 PowerShell 中，您*应该*这样做：

```
(Get-ChildItem C:\TEMP\file1.txt).Length 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-09-08T07:42:12.913

我不确定远程的，但对于本地 Windows 槽 {文件共享/网络}，`%~z`确实有效

```
for %%x in ("\\ComputerName\temp\temp.txt") do set "size=%%~zx" 
```

更通用的[版本](https://stackoverflow.com/a/37495552/12669337)。以前的版本可能不需要`enableDelayedExpansion enableExtensions`，但不能`for`循环运行。

*   一些澄清——
    *   `|`不能用于将输出值传递给`set`; `for /f`如果没有文本内转义，则不支持其主题值（编辑路径）中的某些字符；`for /l`不允许更改计数/条件值（启动后）；`!<<variableName>>:<<escaped text>>*!`不工作。
    *   在 keepOnlyAllBefore1stSpace 处，`%%%%x`被传递而不是`!nu_f!`，因为出于与`%%%%x`创建相同的原因/用途而需要这样做。

```
@setLocal enableDelayedExpansion enableExtensions
@echo off

set "file=C:\Users\Admin\Documents\test.jpg"

for %%x in ("!file!") do set "name=%%~nxx"
for %%x in ("!file!") do set "storage=%%~pdx"
    set "storage=!storage:~0,-1!"

dir "!storage!" > "!temp!\fileInfo.txt"

findstr /c:"!name!" "!temp!\fileInfo.txt" > "!temp!\fileInfo_1.txt"
    del "!temp!\fileInfo.txt"
set /p "size=" < "!temp!\fileInfo_1.txt"
    del "!temp!\fileInfo_1.txt"

call :for 1 2 "call :deleteCollumnFromStart size"

call :for 1 1 "call :keepOnlyAllBefore1stSpace %%%%x size"

:removeSpacesFromEnd
    if /i "!size:~-1!" equ " " set "size=!size:~0,-1!"
    if /i "!size:~-1!" equ " " goto removeSpacesFromEnd

echo(!size:,= ! bytes

pause
exit /b

:deleteCollumnFromStart
    set "%~1=!%~1:* =!"
    :removeAllSpacesFromStart
        if /i "!%~1:~0,1!" equ " " set "%~1=!%~1:~1!"
        if /i "!%~1:~0,1!" equ " " goto removeAllSpacesFromStart
goto :eof

:keepOnlyAllBefore1stSpace
    if /i "!%~2:~%~1,1!" equ " " (
        set "%~2=!%~2:~0,%~1!"
    ) else (
        set /a "nu1_f= !nu1_f! + 1"
    )
goto :eof

:for
    set "nu_f=%~1"
    set "nu1_f=%~2"
    :f_repeatTimes
        if not !nu1_f! lss !nu_f! (
            rem echo(f_repeatTimes !nu_f! !nu1_f! %*
            for %%x in (!nu_f!) do (
                %~3
            )
            set /a "nu_f= !nu_f! + 1"
            goto f_repeatTimes
        )
goto :eof 
```

# c# - 将 PDF 流式传输到网页失败

> ID：483865
> 
> 赞同：2
> 
> 时间：2009-01-27T15:30:55.310
> 
> 标签：c#, asp.net, pdf

我有一个 PDF 的 URL，我想将 PDF 提供给我的页面查看器。

我可以成功（我认为）检索 PDF 文件。然后，当我执行 Response.BinaryWrite() 时，我从 adobe 阅读器收到“文件已损坏且无法修复”错误。

这是我的代码：

```
protected void Page_Load(object sender, EventArgs e)
    {
        if (IsPostBack)
        {
            byte[] output = DoWork("Http://localhost/test.pdf");
            Response.Clear();
            Response.ContentType = "application/pdf";
            Response.AddHeader("content-disposition", "inline; filename=MyPDF.PDF");
            Response.AddHeader("content-length", output.Length.ToString());
            Response.BinaryWrite(output);
            Response.End();
        }
    }

    public byte[] DoWork(string requestUrl)
    {
        byte[] responseData;
        HttpWebRequest req = null;
        HttpWebResponse resp = null;
        StreamReader strmReader = null;

        try
        {
            req = (HttpWebRequest)WebRequest.Create(requestUrl);

            using (resp = (HttpWebResponse)req.GetResponse())
            {
                byte[] buffer = new byte[resp.ContentLength];
                BinaryReader reader = new BinaryReader(resp.GetResponseStream());
                reader.Read(buffer, 0, buffer.Length);
                responseData = buffer;
            }
        }
        finally
        {
            if (req != null)
            {
                req = null;
            }

            if (resp != null)
            {
                resp.Close();
                resp = null;
            }
        }

        return responseData;

    } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T16:12:44.853

显然，我需要使用 ReadBytes() 出于某种原因，当从 URL 读取 PDF 时，您不会获得您请求的所有字节。

```
 protected void Page_Load(object sender, EventArgs e)
    {
        if (IsPostBack)
        {
            byte[] output = DoWork("Http://localhost/test.pdf");
            Response.Clear();
            Response.ContentType = "application/pdf";
            Response.AddHeader("content-disposition", "attachment");
            Response.AddHeader("content-length", output.Length.ToString());
            Response.BinaryWrite(output);
            Response.End();
        }
    }

    public byte[] DoWork(string requestUrl)
    {
        byte[] responseData;
        HttpWebRequest req = null;
        HttpWebResponse resp = null;
        StreamReader strmReader = null;

        try
        {
            req = (HttpWebRequest)WebRequest.Create(requestUrl);

            using (resp = (HttpWebResponse)req.GetResponse())
            {
                byte[] buffer = new byte[resp.ContentLength];
                using (BinaryReader reader = new BinaryReader(resp.GetResponseStream()))
                {
                    buffer = reader.ReadBytes(buffer.Length);
                    reader.Close();
                }
                responseData = buffer;
            }
        }
        finally
        {
            if (req != null)
            {
                req = null;
            }

            if (resp != null)
            {
                resp.Close();
                resp = null;
            }
        }

        return responseData;

    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T15:49:13.917

尝试将生成的文件保存到您的磁盘。然后使用文本编辑器打开文件。也许您的脚本/源文件中有一些错误。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-30T21:55:50.207

您也可以尝试使用 FileStream 读取文件

```
 string strPath = Request.PhysicalApplicationPath 
                  + "\\document\\Test.pdf";
 FileStream fStream = new FileStream
            (strPath, FileMode.Open, FileAccess.Read);
 StreamReader sReader = new StreamReader(fStream); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T16:29:51.027

前几天我在 Perl 中执行此操作时（作为我们内部网的快速*破解*），脚本的关键是：

```
binmode(STDOUT);
print "Content-type: application/pdf\n\n";
binmode(FILE);
print <FILE>;
close(FILE); 
```

关键是要确保输入*和*输出流处于二进制模式，即如您所见，PDF 需要在整个链中被解释为二进制数据。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T15:34:56.753

尝试在二进制写入后刷新响应...

```
Response.BinaryWrite(output);
Response.Flush();
Response.End(); 
```

或者，尝试将 PDF 输出为附件，而不是内联：

```
Response.AddHeader("Content-Disposition", "attachment;filename=MyPDF.PDF"); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-28T05:57:00.010

您可能可以通过使用 WebClient 类来大大简化您的代码

[这是 MSDN 文档。](http://msdn.microsoft.com/en-us/library/system.net.webclient(VS.80).aspx)它不像较低级别的 HttpWebRequest 类那样繁琐。

# ruby-on-rails - 有人知道在 Amazon S3 上存储 Rails 页面缓存的简单方法吗？

> ID：483869
> 
> 赞同：2
> 
> 时间：2009-01-27T15:32:28.117
> 
> 标签：ruby-on-rails, ruby, rubygems

我正在寻找一种简单且自动化的方式来将页面缓存存储在 S3（当然还有云端）上。我知道有一个插件可以使用片段缓存执行此操作，但在我自己创建它之前，想利用集体智慧这里 ：）

编辑：为了让自己更清楚，我不希望使用 S3 来提供文件，而是使用 CloudFront CDN。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T06:27:43.410

为了在 CloudFront 中放置一些东西，您必须首先在 S3 中拥有它。有关所有步骤，请参阅[Amazon 的介绍](http://aws.amazon.com/cloudfront/#functionality)。基本上，您将文档放在 S3 上的存储桶中，然后进行 API 调用以注册您的存储桶以进行分发（您使用他们提供的 perl 脚本来执行此操作）。那时，它们会将您存储桶的内容传输到边缘服务器以进行高性能分发。您可以每小时更改一次存储桶的内容。

无论如何，为了使用 CloudFront，您真正需要做的是将渲染页面的内容放入 S3。一旦您的分配启动并运行，这就是您在 CloudFront 中管理内容的方式。

在 S3 中管理缓存的最简单方法可能是为您的缓存创建一个模型并使用[attachment_fu 插件](http://github.com/technoweenie/attachment_fu/tree/master)将页面内容存储在 s3 中。然后，您可以使用[ActiveRecord 的 Observer 功能](http://api.rubyonrails.org/classes/ActiveRecord/Observer.html)来使缓存失效并根据您的应用程序重新填充缓存。另一个棘手的问题是进入 ActionView 以访问呈现页面的结果，但我敢打赌，您可以从默认页面缓存系统本身中复制一些代码。

如果您真的愿意，您可能可以将所有这些功能打包到一个插件中，这样您和其他人就可以轻松地在应用程序中重复使用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T16:56:49.617

我读了标题，并打算告诉你亚马逊几周前开始做 CDN。但很明显，你已经知道了。:)

有一个 Python 包，看起来像是包装了 CloudFront，[botto](http://github.com/t11e/boto/tree/master)。但这就是我能找到的全部。

我认为你是第一个...去开始吧。让我知道它在哪里，我可能会分叉它。

# sql-server - SQL Reporting Services 2005 - 非查询报表参数

> ID：483873
> 
> 赞同：2
> 
> 时间：2009-01-27T15:33:41.187
> 
> 标签：sql-server, reporting-services

我正在 Reporting Services 中处理报告，但我无法弄清楚为什么我在使用非查询报告参数时遇到问题。

我正在尝试获取当前年份并尝试过：

```
=YEAR(TODAY())    
=DATEPART("yyyy",TODAY()) 
```

我也试过 TODAY 而不是 TODAY()

所有这些似乎都打破了我报告中的年份下拉列表。我想如果出了什么问题，它就不会得到正确的默认值……但是不，它破坏了整个领域。

有什么想法吗？文章？

**更新：**
等等，等等，等等……最奇怪的事情。Year 参数是此报告的第二个参数。并且它变灰（没有值）直到我选择第一个参数（我的情况是“类别”）。我是否以某种方式告诉 Year 参数这样做？或者 SSRS 2005 是否按顺序处理参数？我想我以前从来没有注意到这一点。

**更新2：**
请查看所有评论

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T15:45:33.690

尝试：

```
=Year(Now) 
```

我不确定这是否是您需要的，但它对我有用。我用它来形成一个日期字符串，所以我使用了 =Year(Now).ToString()。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T15:54:51.270

```
=DateTime.Today.Year 
```

应该也可以。

编辑：布鲁诺 - 我的行为和你看到的一样。我创建了一个示例报告，其中包含没有默认值的字符串第一个参数，以及默认值为 =DateTime.Today.Year 的字符串第二个参数。当我将默认设置为订单中的第二个参数时，它显示为空且已禁用。

我可以通过两种方式解决这个问题：首先，将默认值 =String.Empty 添加到我的第一个参数中，第二种方法是更改​​参数的顺序。

不确定这种行为是设计使然还是错误-但就像您说的那样，直到今天您在问题中指出它时，我才注意到它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-28T04:30:14.257

SSRS 确实按顺序处理报告参数 - 如果您的参数之间存在依赖关系，则顺序可能很重要。

> 来自 MSDN：“当您具有级联参数时，或者当您希望在用户为其他参数选择值之前向用户显示一个参数的默认值时，参数顺序很重要。”

因此，它会一直等到您为第一个参数设置默认值或输入第一个参数的值，然后再处理下一个参数，依此类推。

[http://msdn.microsoft.com/en-us/library/cc281392.aspx](http://msdn.microsoft.com/en-us/library/cc281392.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T00:26:39.210

我通过确保我的所有参数至少有一些默认值来找到它，那么您将不会遇到它们变灰的日期时间选择器。因此，您的日期时间参数之前的每个参数都需要有一个（默认）值，否则它将不起作用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-02T13:28:25.180

Def 由于参数评估的顺序。

简单的解决方法；在参数选项卡中，您可以更改参数的顺序 - 这会将日期选择器移动到列表顶部，然后至少在我的服务器上立即启用。

有人提出了基于查询的默认值的日期过滤器的问题 - 如果您这样做，您会注意到在您有机会重新查询报告之前，任何时候日期更改时都会刷新屏幕的非常烦人的连锁反应.

# sql - 查询最近使用 Linq-to-Sql 过多的人的帮助

> ID：483874
> 
> 赞同：0
> 
> 时间：2009-01-27T15:34:06.960
> 
> 标签：sql

```
Patient 
-------
PatientID

Visit
-----
VisitID
PatientID
HeartRate
VisitDate 
```

如何选择所有就诊的患者、首次就诊的日期以及**首次****就诊**时的心率？

 *** * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-27T15:42:20.763

```
SELECT
  p.PatientID,
  v.VisitID,
  v.HeartRate,
  v.VisitDate
FROM
  Patient p
  INNER JOIN Visit v ON p.PatientID = v.PatientID
WHERE
  v.VisitDate = (
    SELECT MIN(VisitDate) 
    FROM Visit 
    WHERE PatientId = p.PatientId
  ) 
```

* * *

编辑：替代版本。一样。（不太明显，因此不太理想恕我直言）

```
SELECT
  p.PatientID,
  v.VisitID,
  v.HeartRate,
  v.VisitDate
FROM
  Patient p
  INNER JOIN Visit v ON p.PatientID = v.PatientID
  INNER JOIN (
    SELECT PatientID, MIN(VisitDate) VisitDate 
    FROM Visit 
    GROUP BY PatientID
  ) f ON f.PatientID = p.PatientID AND f.VisitDate = v.VisitDate 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T15:38:17.200

这是你想要的吗？当然，这里不需要加入，因为 Patient 中没有额外的字段。但我想IRL有。

```
select PatientId, HeartRate, VisitDate from Patient p
left join Visit v on p.PatientID = v.PatientId 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T16:00:38.153

最后的查询

```
declare @practiceID int 
select 
    isnull(sum(isResponder),0) as [Responders],
    isnull(count(*) - sum(isResponder),0) as [NonResponders]
from (  
    select 
        v.patientID
        ,firstVisit.hbLevel as startHb
        ,maxHbVisit.hblevel as maxHb
        , case when (maxHbVisit.hblevel - firstVisit.hbLevel >= 1) then 1 else 0 end as isResponder
    from patient p 
        inner join visit v on v.patientid = v.patientid 
        inner join practice on practice.practiceid = p.practiceid
        inner join (
            SELECT
              p.PatientID
              ,v.VisitID
              ,v.hblevel 
              ,v.VisitDate 
            FROM Patient p
              INNER JOIN Visit v ON p.PatientID = v.PatientID
            WHERE
                v.VisitDate = (
                    SELECT MIN(VisitDate) 
                    FROM Visit 
                    WHERE PatientId = p.PatientId
                 )
        ) firstVisit on firstVisit.patientID = v.patientID
        inner join (
            select 
                p.patientID
                ,max(v.hbLevel) as hblevel
            from Patient p
                 INNER JOIN Visit v ON p.PatientID = v.PatientID
            group by
                p.patientID
        ) MaxHbVisit on maxHbVisit.patientid = v.patientId
    where
        p.practiceID = isnull(@practiceID, p.practiceID)
    group by
        v.patientID
        ,firstVisit.hbLevel
        ,maxHbVisit.hblevel
    having
        datediff(
            d,
            dateadd(
                day
                ,-DatePart(
                    dw
                    ,min(v.visitDate)
                ) + 1
                ,min(v.visitDate)
            )
            , max(v.visitDate)
        ) >= (7 * 8)
) responders 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-01-27T15:36:40.417

```
SELECT TOP(1) PatientID, VisitDate, HeartRate FROM Visit ORDER BY VisitDate ASC 
```

患者只有 PatientID？不是名字之类的吗？

# url-rewriting - 如何避免通过 url 重写破坏 TinyMCE 弹出窗口？

> ID：483881
> 
> 赞同：1
> 
> 时间：2009-01-27T15:35:47.907
> 
> 标签：url-rewriting, tinymce

我有一个使用 TinyMCE 文本框进行编辑的网站。它工作正常，除了打开弹出窗口的工具栏选项，因为它似乎被我在 .htaccess 文件中重写的 url 捕获。他们每个人都显示我的 404 页。设置 url 重写，以便将所有 url（除了 ajax 调用）发送到 index.php 文件。很明显，弹出窗口也被这个捕获了，但我不知道在 .htaccess 文件中要查找什么 url 信号，所以有人知道我可以匹配哪种模式？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T15:46:23.907

正如[@andyk](https://stackoverflow.com/questions/483881/how-to-avoid-ruining-tinymce-popups-with-url-rewriting#483899)指出的那样，您可以在 TinyMCE 文件夹中使用 .htaccess 来覆盖正在执行 URL 重写的全局设置。我过去自己这样做是为了解决同样的问题。

如果由于某种原因这对您没有吸引力，另一种选择是排除 tinyMCE 文件夹，如下所示：

```
# if URL starts with /TinyMCE, stop processing here
RewriteCond %{REQUEST_URI} ^/TinyMCE [NC]
RewriteRule .* - [L] 
```

这设置了一个重写条件来检查 TinyMCE 所在的目录，如果找到，则规则 .* - 表示对于所有 URL，什么都不做，[L] 表示在此处停止处理。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T15:41:23.840

尝试在您的 htaccess 中为 tinyMCE 文件夹设置一个异常？

# algorithm - 如何计算线性时间的排列，有一个扭曲

> ID：483890
> 
> 赞同：7
> 
> 时间：2009-01-27T15:38:34.593
> 
> 标签：algorithm, permutation

我在 Java 中有一个资源调度问题，需要对事物进行排序，但是对于哪些资源可以彼此相邻存在限制。一个很好的类比是一串“数字”，其中只有某些数字可以彼此相邻。我的解决方案是递归的，适用于小字符串，但运行时间为 O(X^N)，其中 X 是可能的位数（基数），N 是字符串的长度。它很快变得无法管理。

使用下面的兼容性矩阵，这里有一些允许字符串的示例
长度为 1：0、1、2、3、4
长度为 2：02、03、14、20、30、41
长度为 3：020、030、 141、202、203、302、303、414

```
     0 1 2 3 4
   ---------------------
0| 0 0 1 1 0
1| 0 0 0 0 1
2| 1 0 0 0 0
3| 1 0 0 0 0
4| 0 1 0 0 0

```

我计算所有长度为 N 的字符串的解决方案是从一个空字符串开始，置换第一个数字，然后递归调用所有长度为 N-1 的字符串。递归调用检查添加的最后一个数字并尝试该数字旁边的所有排列。进行了一些优化，因此我不会每次都尝试置换 00、01、04，例如 - 只有 02、03，但性能仍然很差，因为它从基数 5（示例）扩展到基数 4000。

除了尝试枚举所有排列之外，还有什么更好的方法来计算排列吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-01-27T16:35:42.560

如果您只想要一定长度的字符串的数量，您可以将兼容性矩阵与自身相乘几次，然后将其值相加。

> *n* =*字符串长度*
> *A* =*兼容性矩阵*
> *可能字符串的数量=* *A* ^(*n*) ^(-1)的总和

 *几个例子：

```
n = 1
| 1 0 0 0 0 |
| 0 1 0 0 0 |
| 0 0 1 0 0 |
| 0 0 0 1 0 |
| 0 0 0 0 1 |
sum: 5

n = 3
| 2 0 0 0 0 |
| 0 1 0 0 0 |
| 0 0 1 1 0 |
| 0 0 1 1 0 |
| 0 0 0 0 1 |
sum: 8

n = 8
| 0 0 8 8 0 |
| 0 0 0 0 1 |
| 8 0 0 0 0 |
| 8 0 0 0 0 |
| 0 1 0 0 0 |
sum: 34 
```

原始矩阵（第*i行，第**j*列）可以被认为是以符号*i*开头的字符串的数量，其下一个符号是符号*j*。或者，您可以将其视为长度为**2的字符串数，以符号***i*开头并以符号*j*结尾。

矩阵乘法保留了这个不变量，因此在求幂之后，*A* ^(*n* -1)将包含以符号*i*开头、长度为*n*并以符号*j*结尾的字符串的数量。

参见[Wikipedia: Exponentiation by squareing](http://en.wikipedia.org/wiki/Exponentiation_by_squaring)以了解更快计算矩阵幂的算法。

（感谢 stefan.ciobaca）

这种特殊情况简化为公式：

> *可能的字符串数*= *f* ( *n* ) = 4 + Σ [*k* =1.. *n*] 2 ^(⌊ ^(*k* -1) ⁄ [2] ⌋) = *f* ( *n* -1) + 2 ^(⌊ ^(*n* -1) ⁄ [2] ⌋)

```
n       f(n)
----    ----
   1       5
   2       6
   3       8
   4      10
   5      14
   6      18
   7      26
   8      34
   9      50
  10      66 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-27T16:05:48.783

您是否只想知道使用给定矩阵中的规则可以构建多少个给定长度的字符串？如果是这样，那么这样的方法应该有效：

```
n = 5
maxlen = 100

combine = [
      [0, 0, 1, 1, 0],
      [0, 0, 0, 0, 1],
      [1, 0, 0, 0, 0],
      [1, 0, 0, 0, 0],
      [0, 1, 0, 0, 0]
   ]

# counts of strings starting with 0,1,...,4, initially for strings of length one:
counts = [1, 1, 1, 1, 1]

for size in range(2, maxlen+1):
   # calculate counts for size from count for (size-1)
   newcount = []
   for next in range(n):
      total = 0
      for head in range(n):
         if combine[next][head]:
            # |next| can be before |head|, so add the counts for |head|
            total += counts[head]
      # append, so that newcount[next] == total
      newcount.append(total)
   counts = newcount
   print "length %i: %i items" % (size, sum(counts)) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-27T16:06:05.100

您的算法似乎是最佳的。

你是如何使用这些排列的？您是将它们累积在一个列表中，还是一个一个地使用它？由于存在大量此类排列，因此性能不佳可能是由于内存使用量大（如果您正在收集所有这些排列），或者只是花费了太多时间。您无法在微不足道的时间内完成数十亿次循环。

**回复评论：**

如果您只想计算它们，那么您可以使用动态编程：

令 count[n][m] 是一个数组，其中 count[l][j] 是长度为 l 并以 j 结尾的此类排列的数量，

那么 count[l][i] = count[l-1][i1]+count[l-1][i2]+...，其中 i1, i2, ... 是可以在 i 之前的数字（这可以保存在预先计算的数组中）。

count 的每个单元格都可以通过对 K 个数字求和来填充（K 取决于兼容矩阵），因此复杂度为 O(KMN)，M 是排列的长度，N 是总位数。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T15:53:37.013

也许我不明白这一点，但如果有一个列表表，对于每个数字都有一个可以跟随它的有效数字列表，这难道不可以吗？

然后，您要生成的例程将采用累积结果、数字编号和当前数字。就像是：

```
// not really Java - and you probably don't want chars, but you'll fix it
void GenerateDigits(char[] result, int currIndex, char currDigit)
{
    if (currIndex == kMaxIndex) {
        NotifyComplete(result);
        return;
    }
    char[] validFollows = GetValidFollows(currDigit); // table lookup
    foreach (char c in validFollows) {
        result[currIndex] = c;
        GenerateDigits(result, currIndex+1, c);
    }
} 
```

复杂性随着要生成的位数而增加，但该函数取决于任何一位数的有效跟随总数。如果每个数字的跟随总数相同，例如 k，那么生成所有可能的排列的时间将是 O(k^n)，其中 n 是数字的数量。对不起，我不能改变数学。生成以 10 为底的 n 位数字的时间是 10^n。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-27T16:18:05.623

我不确定你在问什么，但因为可能有 n! 一串 n 位数字的排列，您将无法比 n 更快地列出它们！我不确定你认为你是如何获得 O(n^2) 的运行时间的。

# c# - 任务管理器显示 9MB 内存使用情况，而执行服务功能的线程正在休眠

> ID：483892
> 
> 赞同：0
> 
> 时间：2009-01-27T15:39:18.837
> 
> 标签：c#, multithreading, windows-services, service

我正在用 VB9 (VS2008) 开发一个桌面搜索引擎。

当服务中涉及的唯一线程处于休眠状态时，服务占用 9MB 内存是否正常？

该代码包括以下导入语句...

```
Imports System
Imports System.IO
Imports Microsoft.Win32
Imports System.Threading 
```

Service 类中有几个类变量

```
Private serviceStarted As Boolean = False
Dim workerThread As Thread
Dim DSEKey As RegistryKey
Dim indexFolder As String
Dim tempFolder As String
Dim docFolders As String()
Dim interval As Integer 
```

OnStart 方法采用以下形式：

```
protected override void OnStart(string[] args)
{

   ThreadStart st = new ThreadStart(WorkerFunction);
   workerThread = new Thread(st);

    serviceStarted = true;

    workerThread.Start();
} 
```

WorkerFunction 采用以下形式：

```
private void WorkerFunction()
{

   while (serviceStarted)
   {

      // Desired function - STARTS

      // Desired function - ENDS

      // Close all open objects

      if (serviceStarted)
      {
         Thread.Sleep(new TimeSpan(0, interval, 0);
      }
   }

   Thread.CurrentThread.Abort();
} 
```

[Process Explorer](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)将物理内存使用描述为：

```
Working Set: 9,440 K
    WS Private:   2,356 K
    WS Shareable: 7,084 K
    WS Shared:    6,440 K 
```

这是正常的还是我做错了什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T15:45:30.570

从中我可以从内存使用情况中看出，您只使用了大约 2.3 mb 的实际内存，共享/可共享集本质上是一个“缓存”的内存集合，这意味着应用程序已将其指定为以防万一它需要它。

考虑到您确实有许多将占用一些内存的私有成员，您的应用程序内存使用情况很可能不会那么糟糕。

我很可能不会担心它，但是，如果您希望真正优化和识别内存使用的来源，您可以使用 RedGate 的 ANTS Profiler 来调查内存中的各个对象。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T15:55:15.853

这是由 CLR/GC 和 Windows 内存管理器协商内存引起的。CLR/GC 将从窗口分配比它需要的更多的内存，从而使工作集看起来很高。但是，如果 Windows 内存管理器（在操作系统级别）检测到需要更多内存，它将尝试根据需要从应用程序的进程中获取更多内存。现在，如果您想强制该工作集变低，您可以尝试将[Porcess.MaxWorkingSet](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.maxworkingset.aspx)属性设置为 -1。这指示 Windows 立即尝试将工作集“修剪”到可能的最小内存量。或者，您可以使用相应的 Windows API [SetProcessWorkingSetSize](http://msdn.microsoft.com/en-us/library/ms686234(VS.85).aspx)。

然而，缺点是这需要一些更高的权限（FullTrust for Working Set，Unmanaged/P/Invoke access for SetProcessWorkingSetSize）并且CLR在下次需要内存时分配内存的速度可能会变慢，因为它必须回到操作系统以获得更多内存。

[顺便说一句：您可以在底层相应 Windows API SetProcessWorkingSetSize](http://msdn.microsoft.com/en-us/library/ms686234(VS.85).aspx)的 MSDN 文档中看到这种行为的证据。请注意以下内容：

> 如果 dwMinimumWorkingSetSize 和 dwMaximumWorkingSetSize 的值都为 (SIZE_T)–1，则该函数会从指定进程的工作集中删除尽可能多的页面。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T15:46:36.560

请允许我以 a) 我对 VB 一无所知，以及 b) 我对 windows 内存模型知之甚少作为开头。但是，如果我在 linux 系统上看到这一点，我会说您只需要关注 Private 内存使用情况。共享/可共享的东西很可能是由 VB（.net？）运行时加载的 DLL，而不是问题，因为它们在应用程序之间共享。2MB 对于 VB 应用程序来说似乎并不过分，即使是没有太多数据的应用程序。如果它是 C++ 应用程序，我会担心，但对于解释型语言，我认为这与课程的标准差不多。我认为这主要是开销，实际上并没有在你的几个变量中分开。另外，您是在运行调试版本还是发布版本？这可能会严重影响内存占用。

只是我的 0.02 美元。带上一大粒盐，因为我可能完全不在话下。

**编辑**：我最初忘了提到，你的线程是醒着还是睡着都没关系。除非系统内存不足，否则它不会调出睡眠线程的内存，即使那样谁知道它使用什么算法（如果内存不足，它也可能调出正在运行的线程......） . 此外，即使它被调出，它仍然会显示为已使用的内存（尽管你说这是物理内存测量，它可能会显示在其他地方）。

# css - 相对大小的 CSS 问题

> ID：483898
> 
> 赞同：1
> 
> 时间：2009-01-27T15:40:59.707
> 
> 标签：css, font-size

我有这个代码

```
<html>
 <head>
  <style type="text/css">
   .frame                  {width: 50em; border: 1px solid black}
   .frame  label           {width: 20em; display: block; text-align:right; border: 1px solid green} 
   .frame label span       {width: 20em; display: block; font-size: .5em; border: 1px solid red; text-align: right}
  </style>
 </head>
 <body>
  <div class="frame">
   <label>
    Label
    <span>
     Span
    </span>
   </label>
  </div>
 </body> 
```

红色`<span>`设置为`20em`。但它应该和绿色一样大`<label>`。不过，我想在红色部分保持较小的字体大小。不幸的是，即使它`font-size`是原来的一半，我也无法使用它`40em`来获得相同的尺寸。知道如何解决这个问题吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T15:46:57.837

px 不是一个选项，因为我确实希望保持设计“可扩展”。我刚刚发现，它适用于跨度的“宽度：100%”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T16:00:43.440

如果您没有为`SPAN`元素（或`width:100%`）声明宽度，它的属性`display:block`已经确保它的宽度是完整的可用宽度。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T16:21:43.133

请注意，使用 em 是[相对于包含 em 大小的](http://en.wikipedia.org/wiki/Em_(typography))。使用 px 或 pt 时，您的尺寸与屏幕分辨率相关。这就是为什么在`span`20em 标签内时红色的宽度为 20em。

# .net - 使用 F# 查询 Entity Framework 的示例

> ID：483900
> 
> 赞同：7
> 
> 时间：2009-01-27T15:41:29.830
> 
> 标签：.net, entity-framework, f#

我在 Google 上到处寻找有关使用 F# 查询实体数据源的示例或教程。

老实说，我没有找到太多。你们有谁有运气吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-27T22:16:02.357

[以下是我能够从我在此博客](http://bloggemdano.blogspot.com/2008/11/linq-to-sql-in-f.html)上找到的内容拼凑而成的示例

```
open Microsoft.FSharp.Linq.QuotationEvaluation
open Microsoft.FSharp.Linq

let IsPermited (serviceName:string) =
  //Instantiate the Entity 
  let data = new BusModelContainer()

  //Build your query
  let services = Query.query <@ seq{ for service in data.ServiceSet do
                         service.Name.Equals(serviceName) && service.IsEnabled then
                               yield service } @>
  if Seq.is_empty services then 
    false
  else
    true 
```

这是博客中的代码，它向我展示了如何从实体中进行选择

```
 let db = new FSharpSampleDB(connString)  

  Query.query <@ seq { for c in db.Customers do  
                       if id = c.CustomerId then  
                          yield (new Customer(c.CustomerId, c.Name, c.Balance))}   
              |> Seq.hd @> :> ICustomer 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2020-06-19T04:26:16.163

[这里](https://github.com/dotnet/docs/blob/master/docs/fsharp/language-reference/query-expressions.md)有很多例子

返回记录类型

```
type T1 = {F1: int32; F2: string}
let q = query {
  for t in ctx.SomeTable do 
  select { F1 = t.F1
           F2 = t.F2 } 
}; 
```

返回匿名类型，{| ... |}，仍然存在一些错误，丑陋的解决方法是将 .ToList() 附加到表中。

```
let q = query {
  for t in ctx.SomeTable.ToList() do 
  select 
        {| F1 = t.F1
           F2 = t.F2 
        |} 
}; 
```

更新 EF Core 中的记录

```
let obj = ctx.SomeTable.Where(fun t->t.ID = 123).Single()
obj.FieldX <- "new Value"
ctx.SaveChanges() |> ignore 
```

# .net - 运算符和参数中的 HQL

> ID：483901
> 
> 赞同：4
> 
> 时间：2009-01-27T15:42:10.920
> 
> 标签：.net, nhibernate, orm

需要为实体的多个实例查询 NHibernate。我尝试过以下代码，但由于有线 NRE 深入 NHibernate 而失败。

```
var query = NHibernateSession.CreateQuery("from User u where u.id in (:ids)");
query.SetParameterList("ids", new Guid[]);
query.ToList(); 
```

它看起来像常见问题 - 有什么建议吗？

*更新*仅当数组为空时才会发生这种情况 - 问题已关闭。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T15:46:53.797

:ids 将是一个空的 Guid 数组，不是吗？您要求 NHibernate 为您提供 id 在未初始化的 Guid 数组中的用户。

# c# - PropertyGrid - Ilist Collection Remove 未按预期触发

> ID：483903
> 
> 赞同：0
> 
> 时间：2009-01-27T15:42:42.853
> 
> 标签：c#, collections, propertygrid, ilist, collectioneditor

我有一个实现 IList 的集合对象。在集合中，我使用了一个列表来收集项目。在 PropertyGrid 内部（在运行时），它正确绑定并打开集合编辑器。我可以编辑，我可以正确添加项目，当它们在集合类中使用时我可以捕获这些方法。

但是，如果您尝试删除任何项目，它们会从集合中删除，但我的集合中似乎没有使用 IList.Remove 或 IList.RemoveAt。删除的项目也意味着从数据库中删除，这是我在 Remove 方法中实现的行为。

我还从 remove 方法中删除了所有逻辑，并将它们留给 throw new NotImplmented()，而这些根本不会被触发！

我也有一个由自己的 CollectionEditor 实现，但仍然看不到挂钩到我的对象的方法。

那么，我应该在哪里寻找相关的方法呢？我是否也需要更改我的物品的行为？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-27T16:26:27.587

集合编辑器不使用**Remove**或**RemoveAt**。相反，当用户按下 OK 按钮时，它会调用**IList.Clear**方法，然后调用**IList.Add**以添加集合将包含的所有项目。并不是说它适用于**IList**的非通用版本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T17:21:08.177

好吧，老鼠！

在我的 CollectionEditor 中，有没有办法获取实际的收藏？我想我会得到集合，然后在按下 OK 后进行比较，然后从那里删除记录。

失败了，把矩阵屏保掸掉，挖出一本好书，告诉大家它正在编译。

# delphi - 用于清理用户输入的 URL 的 Delphi 代码

> ID：483906
> 
> 赞同：2
> 
> 时间：2009-01-27T15:43:57.330
> 
> 标签：delphi, url

我需要一个用户能够输入一个 URL，并希望确保它尽可能健康。比如检查前面是否有 http://，没有双点，可能是有效的 TLD，尾部斜杠（我必须添加最后一页）。

我认为这是一个如此普遍的要求，它必须已经存在。建议？

[编辑：] 明确地说，这是 Windows 服务中的运行时要求。目的是从配置中读取的 URL 中获得最佳效果，而不是验证用户输入的内容。本质上，如果我可以调整 URL 并使其工作，那么这就是我想做的。下载将是一个特定的文件，所以如果一切都出错了，它不会从另一个服务器错误地得到错误的东西。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T17:18:48.493

在 Windows API 中使用[PathIsURL函数怎么样？](http://msdn.microsoft.com/en-us/library/bb773724.aspx)

更新：这已经包含在 ShLwApi 单元的 Delphi RTL 中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-27T16:28:26.803

您是否看过“[检查字符串是否为有效 URL 的最佳正则表达式是什么](https://stackoverflow.com/questions/161738/what-is-the-best-regular-expression-to-check-if-a-string-is-a-valid-url)”？它不是 Delphi 特有的，但可以帮助您入门。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-27T16:54:42.350

[也许这里](https://stackoverflow.com/questions/124170/a-delphi-freepascal-lib-or-function-that-emulates-the-phps-function-parseurl)的一些建议可能会有所帮助。

# git - Git 最佳实践：如何将修订标记为“TESTED”或“REJECTED”

> ID：483915
> 
> 赞同：4
> 
> 时间：2009-01-27T15:45:58.823
> 
> 标签：git

我想根据某些回归测试的成功将某些提交标记为*“已测试”*或*“已拒绝”*（类似于 clearcase 标签）

回归测试本身不是自动化的（不幸的是，这些是长时间运行的测试）。

但是，我想在尝试签出已被拒绝或根本未测试的旧提交时*发出警告。*

如果从存储库中提取的任何人也能获得标签（以及在签出被拒绝的版本时出现类似的警告），那就太好了。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T17:10:00.807

如果您想做“已知良好”选项，您可以重命名分支。因此，您有一个`stable`和一个`unstable`（或只是当前主人的 HEAD），并且`stable`只要有一个新的已知良好“通过”修订版，您就可以移动分支。像这样的东西：

```
git branch -m stable master 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-27T16:48:04.640

`git push --tags`如果您指定它们应该 ( ) ，Git 的标签将跨越存储库。不会有自动警告，但也许可以建立。

但是你问的是最佳实践：

我不认为非团队成员挑选樱桃是最佳做法。一般来说，人们会宣布他们的存储库的哪些分支包含“已知良好”的代码。他们还将恢复“已知错误”的提交。如果你只看一次提交，你就会错过恢复。

我想说一个进一步的最佳实践是使用多个沟通渠道：

*   在邮件列表或论坛上宣布发布和分支
*   问题跟踪器中的交叉引用提交和问题

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T16:46:08.450

您可以从远程存储库中获取标签，`git fetch <remote> --tags`. 这确实取决于有人自己做。

# c++ - CTreeCtrl - 获取项目位置

> ID：483919
> 
> 赞同：1
> 
> 时间：2009-01-27T15:46:42.970
> 
> 标签：c++, mfc

有没有办法在 CTreeCtrl 中获取项目的位置（索引）？
我对特定级别的节点索引感兴趣。

我正在考虑在项目“数据”字段中维护项目位置，但问题是我的树已排序，我无法预测项目将收到的位置（好吧，只有当我提前对项目进行排序时，我想要避免）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T15:59:25.800

我不认为你可以。我假设也许控件可以被视为一个数组（也许它仍然可以，但我找不到参考）。

无论如何，没有成员函数（根据[MFC API](http://msdn.microsoft.com/en-us/library/7w95665f(VS.80).aspx)）可以让您访问该信息

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2018-08-07T09:17:16.540

```
 /// there is another way if you "Use Unicode Character Set" (visual studio)
 /// Properties->General->Character Set

    CPoint point;
    GetCursorPos(&point);
    m_Tree.ScreenToClient(&point);
    UINT nHitFlags;
    HTREEITEM hItem = m_Tree.HitTest(point, &nHitFlags);

    int idx = m_Tree.MapItemToAccId(hItem); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T15:59:40.247

获取节点句柄，然后遍历 elem 遍历所有元素，同时计算元素，直到找到正确的项目？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-08-07T09:05:59.273

```
int GetIndex(const CString & a_Cstr)
{
    int idx = 0;
    std::vector<CString>::const_iterator _begIt = m_RulesVec.begin();
    std::vector<CString>::const_iterator _PosIt = find(m_RulesVec.begin(),      m_RulesVec.end(), a_Cstr);
    if (_PosIt == m_RulesVec.end()) {
        return -1;
    }
    else {
        while (_begIt != _PosIt) {
            ++idx;
            ++_begIt;
        }
        return idx;
    }
}

/// it can(must) be done in this function
/// OnNMClickRulesTree(NMHDR *pNMHDR, LRESULT *pResult)

    // Create vector like this
    std::vector<CString> Vec{"first", "second", "third" };

    // OnInit insert items to CtreeCtrl like this
    m_Tree.InsertItem("first", hItem);
    m_Tree.InsertItem("second", hItem);
    m_Tree.InsertItem("third", hItem);

    // then get cur selected item like this
    CPoint point;
    GetCursorPos(&point);
    m_Tree.ScreenToClient(&point);
    UINT nHitFlags;
    HTREEITEM hItem = m_Tree.HitTest(point, &nHitFlags);

    // get item text
    CString Cstr = m_Tree.GetItemText(hKid);
    int idx = GetIndex(Cstr); 
```

# oracle - VB6 Oracle 将 Clob 检索到数组中

> ID：483936
> 
> 赞同：1
> 
> 时间：2009-01-27T15:50:25.007
> 
> 标签：oracle, vb6, ado, recordset, clob

我正在尝试将数据类型为 clob 的 oracle 字段检索到 VB 数组中，而无需重新格式化检索 SQL 字符串（只需 SELECT * FROM my_table）。我正在使用 ADO 记录集。

当我关闭连接或对记录集执行任何其他操作时，clob 值会丢失。我怎样才能做到这一点。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-28T20:12:47.347

在我的一个项目中，我尝试使用 ADO 操作 BLOB 和 CLOB，但没有任何成功，直到我切换到[Oracle Objects 4 OLE](http://www.oracle.com/technology/tech/windows/ole/index.html)。您需要在您的机器上安装和配置 Oracle 客户端，在项目引用中添加“Oracle InProc Server 4.0 类型库”。

这是我用于 BLOB 的示例代码：

```
Dim OraSession  As OracleInProcServer.OraSessionClass
Dim OraDatabase As OracleInProcServer.OraDatabase
Dim OraDynaset  As OracleInProcServer.OraDynaset
Dim srcImg As OraBlob

Set OraSession = CreateObject("OracleInProcServer.XOraSession")
Set OraDatabase = OraSession.DbOpenDatabase("myDBName", "login/password", 0&)

Set OraDynaset = OraDatabase.DbCreateDynaset("SELECT src_id, src_image from Sources where src_file_name like '%.png'", 0&)
With OraDynaset
    If .RecordCount > 0 Then
        .MoveFirst
        While (Not .EOF Or .BOF)
            Set srcImg = .Fields("src_image").Value
            srcImg.CopyToFile ("C:\sources\" & srcID & ".png")
            .MoveNext
        Wend

    End If
End With

Set OraDynaset = Nothing
Set OraDatabase = Nothing
Set OraSession = Nothing 
```

# mobile - 是否有任何 PDA 或 Outlook 同步框架？

> ID：483937
> 
> 赞同：2
> 
> 时间：2009-01-27T15:51:02.760
> 
> 标签：mobile, outlook, data-synchronization, handhelddevice

我们有一个处理一些常见销售实体（联系人、约会、地址、便笺等）的 Web 应用程序。我们需要保留我们的应用程序、Outlook 以及它们可能已同步的任何设备。

是否有任何可以帮助我们与 PDA 集成的框架？任何想法或建议表示赞赏。谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T17:33:38.840

我认为 Wikipedia 上的[SyncML](http://en.wikipedia.org/wiki/SyncML)文章将是一个好的开始。

[Funambol](http://en.wikipedia.org/wiki/Funambol)拥有多个平台的客户端，核心项目是免费和开源的。

Plaxo.com 为其客户定制了一个 funambol Windows Mobile 客户端。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-28T08:34:09.630

我会看看微软同步框架。Whitch 有许多“提供者”，其中一些包括在内，一些是开源的，一些是第 3 部分。提供者就像是到数据源的标准化“连接”，例如 Outlook 邮件、Outlook 联系人、文件系统、数据库或任何您能想象到的东西。或者正如微软所说：

> Microsoft Sync Framework 是一个全面的同步平台，支持应用程序、服务和设备的协作和离线访问。它具有支持漫游、共享和离线数据的技术和工具。使用 Microsoft Sync Framework，开发人员可以构建同步生态系统，将任何应用程序与来自任何商店的任何数据在任何网络上使用任何协议进行集成。
> 
> Microsoft Sync Framework 的一个关键方面是能够创建自定义同步提供程序。提供者是代表同步副本的软件组件。副本是要同步的特定信息存储库，例如手持设备上的文件系统。在表示数据源时，提供者会从其副本中枚举更改。表示目的地时，提供者将更改应用于其副本。如果源和目标的数据在类型或架构上不同，则每个提供程序都会执行任何必要的映射或转换。

**Microsoft 同步框架主页：http:**
[//msdn.microsoft.com/en-us/sync/default.aspx](http://msdn.microsoft.com/en-us/sync/default.aspx)

**简介：http:**
[//msdn.microsoft.com/en-us/sync/bb821992.aspx](http://msdn.microsoft.com/en-us/sync/bb821992.aspx)

**联系人同步示例 - Outlook 同步**
此示例说明如何创建自定义提供程序以在不同数据源之间同步内容。在此示例中，我们将在 Microsoft Outlook、Vista 联系人和 VCard 文件之间同步联系人。此演示的一个关键方面是数据映射功能，它使不同的数据源和数据类型能够通过 Sync Framework 进行适当的映射：

[http://code.msdn.microsoft.com/Release/ProjectReleases.aspx?ProjectName=sync&ReleaseId=613](http://code.msdn.microsoft.com/Release/ProjectReleases.aspx?ProjectName=sync&ReleaseId=613)

**Microsoft Sync Framework v1.0 CTP1 - 设备**
托管 (.NET Compact Framework) 和非托管/本机 (ARM)
支持的平台是 Windows Mobile 5 和 6（仅 CTP1 中的 ARM 处理器）

[http://www.microsoft.com/downloads/details.aspx?FamilyID=a7c01a89-9af8-4eee-ab04-6a3ad098a03f&DisplayLang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=a7c01a89-9af8-4eee-ab04-6a3ad098a03f&DisplayLang=en)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T20:01:01.833

我已经使用 Microsoft .NET Compact Framework 完成了这项工作，并取得了出色的成果。SQLCE 可以在 PDA 上提供本地存储。可以使用 Web 服务上的自定义代码或使用 SQL Server Replication 之类的东西来执行同步。

另一种策略是设计第二个 Web 门户，其 UI 专门针对具有小屏幕的移动设备。基于智能手机的用户可以使用任何网络浏览器访问移动门户。这可能是最具成本效益的解决方案。

# sql - Oracle9i：过滤器表达式无法在运行时排除数据

> ID：483940
> 
> 赞同：0
> 
> 时间：2009-01-27T15:51:21.417
> 
> 标签：sql, oracle

我在必须维护的 VB6 程序中有一个相对简单的选择语句。（抑制你发抖的自然倾向；我继承了这件事，不是我写的。）

该声明很简单（为清楚起见重新格式化）：

```
select distinct 
   b.ip_address 
from 
   code_table a, 
   location b 
where 
   a.code_item = b.which_id and 
   a.location_type_code = '15' and 
   a.code_status = 'R' 
```

有问题的表返回数据库中的 IP 地址列表。有问题的关键列是`code_status`. 前段时间，我们意识到其中一个 IP 地址不再有效，因此我们将其状态更改为`I`（无效）以将其排除在查询结果中。

当您在 SQL Plus 或 SQL Developer 中执行上述查询时，一切都很好。但是当你从 VB6 中执行它时，检查`code_status`被忽略，无效的 IP 地址出现在结果集中。

我的第一个猜测是结果被缓存在某个地方。但是，不是甲骨文专家，我不知道去哪里找。

这是*古老*的VB6 代码。SQL 嵌入在应用程序中。目前，我没有时间将其重写为存储过程。（如果有机会，我会有一天。）但是，我需要知道是什么导致了这种行为差异以及如何消除它。如果它发生在这里，它很可能发生在其他地方。

如果有人能推荐一个看的好地方，我会非常感激。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T16:08:26.560

一些随机的想法：

*   您确定您提交了使 IP 地址无效的更改吗？其他人（使用另一个数据库连接/用户）可以看到更改后的 code_status 吗？

*   你确定结果从数据库返回后没有修改吗？

*   您确定您在 SQLPlus 中使用与代码（数据库、用户等）中“相同”的数据库连接吗？

*   您确定那确实是发送到数据库的 SQL 吗？（您可以通过跟踪 Oracle 服务器或调试 VB 代码来检查）。重新格式化可能改变了“某些东西”。

在我的脑海中，我想不出任何可能“重新插入”不需要的 ip 的“缓存”。希望上面的内容能给你一些关于在哪里看的想法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T16:16:01.413

除了 IronGoofy 提出的建议之外，您是否尝试过交换最后两个子句？

```
where
   a.code_item = b.wich_id and
   a.code_status = 'R' and
   a.location_type_code = '15' 
```

如果你得到一组不同的结果，那么这可能表明发生了某种争论，导致不可靠的 SQL 实际上被发送到数据库。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T18:35:23.100

存在导致错误答案的 Oracle 错误。这肯定不是那个时代之一。通常它们涉及视图和功能以及 dblink 和月相的一些奇怪组合......

它没有缓存在任何地方。Oracle 直到 11 点才缓存结果，即便如此，它也知道在答案可能发生变化时更改缓存。

我猜这是一个数据问题。您在查询中的 IP 地址上有一个 DISTINCT，为什么？如果没有唯一约束，您的 IP 地址可能不止一份，而您只修复了其中一份。

而且您的 Code_status 与您的 IP 地址位于完全不同的表中。您在代码表中将状态设置为“I”，然后从 Location 表中获取 IP 列表。

停止思考斑马，开始思考马。这几乎可以肯定只是您不完全理解的数据。

运行这个

```
select 
   a.location_type_code, 
   a.code_status 
from 
   code_table a, 
   location b 
where 
   a.code_item = b.which_id and 
   b.ip_address = <the one you think you fixed> 
```

我敢打赌，你会得到一排带有“I”和另一排带有“R”的

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T22:22:33.607

我建议您查看 V$SQL 系统视图以确认您认为 VB6 代码正在运行的查询实际上是它正在运行的查询。

类似的东西

```
select sql_text, fetches
where sql_text like '%ip_address%' 
```

验证 SQL_TEXT 是否是您期望的，并且在您执行代码时 FETCHES 计数是否增加。

# c# - 是否有充分的理由说明闭包在 C# 中不是不可变的？

> ID：483944
> 
> 赞同：6
> 
> 时间：2009-01-27T15:52:16.017
> 
> 标签：c#, closures, mutable

我一直在脑海中一遍又一遍地思考这个问题，我似乎无法想出一个很好的理由来解释为什么 C# 闭包是可变的。如果您不知道到底发生了什么，这似乎是一种获得一些意想不到的后果的好方法。

也许有更多知识的人可以解释为什么 C# 的设计者会允许状态在闭包中改变？

例子：

```
var foo = "hello";
Action bar = () => Console.WriteLine(foo);
bar();
foo = "goodbye";
bar(); 
```

这将为第一次调用打印“hello”，但在第二次调用时外部状态会发生变化，打印“goodbye”。闭包的状态已更新以反映对局部变量的更改。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-27T16:43:18.660

C# 和 JavaScript，以及 O'Caml 和 Haskell 以及许多其他语言，都有所谓的*词法闭包*。这意味着内部函数可以访问封闭函数中局部变量的*名称*，而不仅仅是*值*的副本。当然，在具有不可变符号的语言中，例如 O'Caml 或 Haskell，封闭名称与封闭值相同，因此两种封闭类型之间的差异消失了；然而，这些语言就像 C# 和 JavaScript 一样具有词法闭包。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-27T16:20:36.803

并非所有闭包的行为都相同。[语义](http://en.wikipedia.org/wiki/Closure_(computer_science)#Differences_in_semantics)上有区别。

请注意，提出的第一个想法与 C# 的行为相匹配……您的闭包语义概念可能不是主要概念。

至于原因：我认为这里的关键是ECMA，一个标准组织。在这种情况下，微软只是遵循他们的语义。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-27T16:30:11.917

这实际上是一个很棒的功能。这让你有一个闭包来访问通常隐藏的东西，比如一个私有类变量，并让它以受控的方式操作它，作为对事件之类的响应。

您可以通过创建变量的本地副本并使用它来轻松模拟您想要的内容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T16:51:09.923

您还必须记住，在 C# 中确实没有不可变类型的概念。因为 .Net 框架中的整个对象不会被复制（您必须显式实现 ICloneable 等），所以即使在闭包中复制了“指针”foo，这段代码也会打印“再见”：

```
class Foo
{
    public string Text;
}    
var foo = new Foo();
foo.Text = "Hello";
Action bar = () => Console.WriteLine(foo.Text);
bar();
foo.Text = "goodbye";
bar(); 
```

因此，如果在当前行为中更容易产生意想不到的后果，那就值得怀疑了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T17:06:59.143

创建闭包时，编译器会为您创建一个类型，该类型具有每个捕获变量的成员。在您的示例中，编译器将生成如下内容：

```
[CompilerGenerated]
private sealed class <>c__DisplayClass1
{
    public string foo;

    public void <Main>b__0()
    {
        Console.WriteLine(this.foo);
    }
} 
```

为您的委托提供对此类型的引用，以便以后可以使用捕获的变量。不幸的是，本地实例`foo`也被更改为指向此处，因此本地的任何更改都会影响委托，因为它们使用相同的对象。

如您所见，持久性`foo`是由公共字段而不是属性处理的，因此在当前实现中甚至没有不变性选项。我认为你想要的必须是这样的：

```
var foo = "hello";
Action bar = [readonly foo]() => Console.WriteLine(foo);
bar();
foo = "goodbye";
bar(); 
```

请原谅笨拙的语法，但想法是表示`foo`以一种方式捕获`readonly`它，然后提示编译器输出这个生成的类型：

```
[CompilerGenerated]
private sealed class <>c__DisplayClass1
{
    public readonly string foo;

    public <>c__DisplayClass1(string foo)
    {
        this.foo = foo;
    }

    public void <Main>b__0()
    {
        Console.WriteLine(this.foo);
    }
} 
```

这将以某种方式为您提供您想要的东西，但需要更新编译器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-11-09T06:35:08.227

关于**为什么**C# 中的闭包是可变的，你不得不问，“你想要简单（Java）还是复杂的功能（C#）？”

可变闭包允许您定义一次并重用。例子：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace ClosureTest
{
    class Program
    {   
        static void Main(string[] args)
        {
            string userFilter = "C";            
            IEnumerable<string> query = (from m in typeof(String).GetMethods()
                                         where m.Name.StartsWith(userFilter)
                                         select m.Name.ToString()).Distinct();

            while(userFilter.ToLower() != "q")
            {
                DiplayStringMethods(query, userFilter);
                userFilter = GetNewFilter();
            }
        }

        static void DiplayStringMethods(IEnumerable<string> methodNames, string userFilter)
        {
            Console.WriteLine("Here are all of the String methods starting with the letter \"{0}\":", userFilter);
            Console.WriteLine();

            foreach (string methodName in methodNames)
                Console.WriteLine("  * {0}", methodName);
        }

        static string GetNewFilter()
        {
            Console.WriteLine();
            Console.Write("Enter a new starting letter (type \"Q\" to quit): ");
            ConsoleKeyInfo cki = Console.ReadKey();
            Console.WriteLine();
            return cki.Key.ToString();
        }
    }
} 
```

如果您不想定义一次并重用，因为您担心意外后果，您可以简单地使用变量的*副本。*将上面的代码改成如下：

```
 string userFilter = "C";
        string userFilter_copy = userFilter;
        IEnumerable<string> query = (from m in typeof(String).GetMethods()
                                     where m.Name.StartsWith(userFilter_copy)
                                     select m.Name.ToString()).Distinct(); 
```

现在查询将返回相同的结果，无论什么`userFilter`等于。

[Jon Skeet对 Java 和 C# 闭包之间的区别进行](http://csharpindepth.com/Articles/Chapter5/Closures.aspx)了很好的介绍。

# optimization - vbscript 优化：如何获得更快的文件写入

> ID：483945
> 
> 赞同：0
> 
> 时间：2009-01-27T15:52:35.953
> 
> 标签：optimization, vbscript

以下是我在很多 vbscripts 中使用的常用日志功能，我对此进行了相应修改。感觉写得太慢了。我有 3 个问题：

1.  关于如何优化它以使其写入更快的任何想法？
2.  首先将所有文本存储在字符串中然后运行函数 OutputToLog 会更快，还是每次我需要将字符串插入文本文件时执行 OutputToLog 会更快？
3.  如果驱动器空间不是一个因素，在执行期间写入文本文件时是否可能会耗尽内存......导致脚本执行速度越来越慢？

这是我的 vbscript 函数

```
Function OutputToLog (strToAdd)  
    Dim strDirectory,strFile,strText, objFile,objFolder,objTextFile,objFSO
    strDirectory = "c:\log"
    strFile = "\log-"& StampNow &  ".bat"
    'strText = "test"
    strText = strToAdd

    ' Create the File System Object
    Set objFSO = CreateObject("Scripting.FileSystemObject")

    ' Check that the strDirectory folder exists
    If objFSO.FolderExists(strDirectory) Then
       Set objFolder = objFSO.GetFolder(strDirectory)
    Else
       Set objFolder = objFSO.CreateFolder(strDirectory)
       'WScript.Echo "Just created " & strDirectory
    End If

    If objFSO.FileExists(strDirectory & strFile) Then
       Set objFolder = objFSO.GetFolder(strDirectory)
    Else
       Set objFile = objFSO.CreateTextFile(strDirectory & strFile)
       'Wscript.Echo "Just created " & strDirectory & strFile
    End If

    set objFile = nothing
    set objFolder = nothing
    ' OpenTextFile Method needs a Const value
    ' ForAppending = 8 ForReading = 1, ForWriting = 2
    Const ForAppending = 8

    Set objTextFile = objFSO.OpenTextFile _
    (strDirectory & strFile, ForAppending, True)

    ' Writes strText every time you run this VBScript
    objTextFile.WriteLine(strText)
    objTextFile.Close
End Function 
```

提前致谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T18:07:26.937

我认为您既希望创建 FSO 对象，又希望在 OutputToLog 函数之外打开日志文件。它可能不会节省太多时间，但为什么要在每次写入时创建对象、打开和关闭文件呢？

否则，如果您想保持功能不变，只写一次应该会更快。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-02T18:17:58.273

不要在调用之间关闭文件，让 textstream-object 在它终止时负责关闭。

```
Dim OutputToLogFileObject
Function OutputToLog (strToAdd)  
    Dim strDirectory,strFile,strText, objFile,objFolder,objTextFile,objFSO
    If IsEmpty(OutputToLogFileObject) Then
        strDirectory = "c:\log"
        strFile = "\log-"& StampNow &  ".bat"
        'strText = "test"
        strText = strToAdd

        ' Create the File System Object
        Set objFSO = CreateObject("Scripting.FileSystemObject")

        ' Check that the strDirectory folder exists
        If objFSO.FolderExists(strDirectory) Then
           Set objFolder = objFSO.GetFolder(strDirectory)
        Else
           Set objFolder = objFSO.CreateFolder(strDirectory)
           'WScript.Echo "Just created " & strDirectory
        End If

        If objFSO.FileExists(strDirectory & strFile) Then
           Set objFolder = objFSO.GetFolder(strDirectory)
        Else
           Set objFile = objFSO.CreateTextFile(strDirectory & strFile)
           'Wscript.Echo "Just created " & strDirectory & strFile
        End If

        set objFile = nothing
        set objFolder = nothing
        ' OpenTextFile Method needs a Const value
        ' ForAppending = 8 ForReading = 1, ForWriting = 2
        Const ForAppending = 8

        Set OutputToLogFileObject = objFSO.OpenTextFile _
        (strDirectory & strFile, ForAppending, True)
    End If
    OutputToLogFileObject.WriteLine strText
 End Function 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T16:08:23.393

如果您正在进行大量小型写入，那么重构对 FolderExists 和 FileExists 的检查会有所帮助。也许尝试写入文件，捕获任何错误，并在错误处理程序中检查 FolderExists 和 FileExists 并在必要时创建它们？

输出一个大字符串而不是几个小字符串会更快，但是如果程序崩溃，您必须平衡它与丢失日志条目的可能性。

除非您将巨大的字符串写入文件，否则内存应该不是问题**，**甚至可能不是。

因为您要附加到文件，所以日志文件越长，写入所需的时间就越长，因为（AFAIK）每次都必须重写整个文件。这是减少编写较长字符串的另一个原因。

您可以改用 Windows 的事件日志吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T16:14:24.007

在准备功能中检查和创建所有文件夹/文件一次，然后您可以安全地附加到日志文件中，知道它会在那里吗？此外，您应该能够只创建一次 fso 对象。

类似于以下内容（未经测试的代码）

```
Dim loggerFSO

Function PrepLog
    dim objFolder
    ' Create the File System Object
    if loggerFSO is nothing then Set loggerFSO = CreateObject("Scripting.FileSystemObject")

    ' Check that the strDirectory folder exists
    If loggerFSO.FolderExists(strDirectory) Then
       Set objFolder = loggerFSO.GetFolder(strDirectory)
    Else
       Set objFolder = loggerFSO.CreateFolder(strDirectory)
       'WScript.Echo "Just created " & strDirectory
    End If

    If loggerFSO.FileExists(strDirectory & strFile) Then
       ' do nothing
    Else
       loggerFSO.CreateTextFile(strDirectory & strFile)
       'Wscript.Echo "Just created " & strDirectory & strFile
    End If
End function

Function OutputToLog (strToAdd)  
    Dim strDirectory,strFile,strText, objTextFile
    strDirectory = "c:\log"
    strFile = "\log-"& StampNow &  ".bat"
    'strText = "test"
    strText = strToAdd

    ' Create the File System Object
    if loggerFSO is nothing then Set loggerFSO = CreateObject("Scripting.FileSystemObject")

    ' OpenTextFile Method needs a Const value
    ' ForAppending = 8 ForReading = 1, ForWriting = 2
    Const ForAppending = 8

    Set objTextFile = loggerFSO.OpenTextFile _
    (strDirectory & strFile, ForAppending, True)

    ' Writes strText every time you run this VBScript
    objTextFile.WriteLine(strText)
    objTextFile.Close
End Function 
```

# ruby - Ruby 中的 RegEx：只有一场比赛？

> ID：483952
> 
> 赞同：0
> 
> 时间：2009-01-27T15:54:23.173
> 
> 标签：ruby, regex

我试图弄清楚如何检查字符串是否与正则表达式匹配，**但我想知道整个字符串是否只匹配一次**。这是我的代码，但看起来很长

```
def single_match(test_me, regex)
  ret_val = false
  test = regex.match(test_me)
  if (test.length==1 && test[0].length == test_me.length)
      ret_val = true
  end
  return ret_val
end 
```

有没有更简单的方法来做到这一点？

PS这是我真正想写的方法，因为这些天人们似乎总是问我为什么想要枪：

```
def is_int(test_me)
  return single_match(test_me, /[0-9]*/)
end 
```

**编辑**谢谢大家。[这是我真正使用它的地方](https://stackoverflow.com/questions/230335/why-do-i-need-to-work-harder-to-make-my-rails-application-fit-into-a-restful-arch#486133)，但是这个正则表达式的东西总是很有趣。感谢您的精彩和教育性答案。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-27T15:57:28.223

您不需要这样做，您的方法可以通过使用`/^[0-9]*$/`. 告诉它匹配行的`^`开头并`$`告诉它匹配行的结尾。所以它将匹配：行首，0 到 0 到 9 范围内的任何值，最后是行尾。

```
def is_int(test_me)
  test_me =~ /^[0-9]*$/
end 
```

而且你不需要 return 语句，Ruby 隐式返回最后一个语句。

**编辑：**

[`to_i`](http://www.ruby-doc.org/core/classes/String.html#M000802)使用类的实例方法可能会更容易，看起来更好[`String`](http://www.ruby-doc.org/core/classes/String.html)。

```
def is_int(test_me)
  test_me.to_i.to_s == test_me
end 
```

**编辑：（**做了一些测试）

比较两种方法的性能表明这种`.to_i.to_s ==`方式快了 5%。因此，如果您想处理前导零，则取决于个人喜好。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-27T16:00:34.533

做你真正想做的事情应该更简单

```
def is_int(test_me)
  test_me.to_i.to_s == test_me
end 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-27T15:56:38.490

这？

```
def single_match(str, regex)
  str.match(regex).to_s == str
end 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-27T20:30:32.070

为了回答你原来的问题，为了人们在搜索中找到这个页面，“扫描”将返回一个匹配数组，所以如果你想找出一些正则表达式匹配的次数，例如有多少位数的运行， 你可以做：

```
mystring.scan(/\d+/).size 
```

# vim - 是否可以在 NetBeans 中使用 VI 或 VIM 键盘映射？

> ID：483962
> 
> 赞同：19
> 
> 时间：2009-01-27T15:57:42.230
> 
> 标签：vim, netbeans, vi, jvi

Vim 是我最喜欢的 OSX 编程工具，但我的队友都使用 NetBeans。其中一些使用 Eclipse Keymap。在 NetBeans 6.5 中启用 VI 命令的任何建议插件？

### 有关的：

> [是否有任何 IDE 有 vi 键绑定选项？](https://stackoverflow.com/questions/294613/does-any-ide-have-a-vi-keybindings-options)

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-01-27T16:03:38.177

检查[jVi](http://jvi.sourceforge.net/)，一个 NetBeans 的 Vi 模拟器。

我还找到[了 ViEx](http://sourceforge.net/projects/viex/)，该项目似乎非常活跃......

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2015-04-30T13:58:05.043

[jVi](http://jvi.sourceforge.net/)可以使用 NetBeans 插件管理器安装；从NB做

```
Menu>Tools>Plugins 
```

选择选项卡“可用插件”，在搜索中输入“jvi”。先安装“jVi for NB-xx Update Center”，然后就可以安装jVi了。

# java - Tomcat/IIS 在 http 响应完成后关闭套接字

> ID：483963
> 
> 赞同：1
> 
> 时间：2009-01-27T15:58:30.730
> 
> 标签：java, iis, tomcat, jboss, tcp

我正在使用具有 Tomcat Servlet Container 5.5 的 JBoss 4.0.4 GA。我也有 IIS 6.0 重定向到这个 JBoss。（通过 IIS tomcat 连接器，在 IIS 中用作 ISAPI 过滤器）。一切正常，按照描述配置工作人员。

这是连接器的一个 workers.properties 文件：

```
#
# Defining a worker named ajp13 and of type ajp13
# Note that the name and the type do not have to match.
#
worker.jboss0_ajp13.port=8009
worker.jboss0_ajp13.type=ajp13
worker.jboss0_ajp13.host=localhost
worker.jboss0_ajp13.socket_keepalive=1
worker.jboss0_ajp13.socket_timeout=300 
```

但是当通过 IIS（端口 80）连接到应用程序时，对于 HTTP 请求的每个完成的 HTTP 响应，套接字都会关闭（在 TCP 层发送 FIN）。这会导致严重的减速，因为应用程序在 WAN 上运行。（每关闭一个socket，需要再建立一个，耗时500ms）。

当直接连接到 JBoss Web 服务器时不会发生这种情况，当连接到 IIS 的同一个 WebServer 实例上的不同虚拟目录时也不会发生这种情况（即也配置了 IIS 中的 Keep-Alive）。

最新版本的 tomcat IIS 连接器会发生这种情况。

不知道是不是连接器有bug，还是我的配置有问题？

在此先感谢，
亨利。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T12:38:37.853

我在 Bugzilla 中为 tomcat IIS 重定向器提交了一个错误，这就是我得到的答案：

> *直到 1.2.27，这是 IIS 连接器的行为（IIS 强制所有 ISAPI 扩展实现它们自己的 HTTP 保持活动状态，而 IIS 连接器没有这样做）。*
> 
> *在 1.2.27 中，有实验性的构建时支持 HTTP 1.1 分块编码，这应该允许持久连接。（我已经在生产系统中使用几乎相同的代码大约 4 年了，但是在 JK 代码库中它应该被认为是实验性的，直到它稳定了一段时间）。*
> 
> *从一个下载镜像中获取 -chunked 二进制文件，并在 1.2.27 发行说明中了解如何配置分块编码（您必须获得正确的构建，并在您的配置中启用它）。您可以验证连接器是否在调试登录时使用分块编码，并且 TCP/Wireshark 跟踪应显示连接被重用。*
> 
> *如果您仍然获得关闭的连接，并且日志显示连接器正在尝试（或应该尝试）分块编码，那么最好在用户列表上进行讨论，然后在您使用另一个 Wireshark 跟踪 + 连接器调试日志重新打开'确定有问题。*

所以，我做了什么：

1.  放置带有分块支持的 isapi_redirect.dll。
2.  使用以下内容配置 isapi_redirect.properties：

    `enable_chunked_encoding=1`

3.  重新启动 IIS。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T16:27:06.367

套接字可能已被 IIS 关闭。JBoss 和 IIS 之间的连接*应该*与是否持久化 HTTP 套接字无关。确保将 IIS 配置为支持持久 HTTP/1.1 套接字。

但是，您指出 IIS 中的另一个虚拟目录没有相同的问题。有问题的特定虚拟目录可能有问题。但是，它*也*可能在 IIS/Tomcat 连接器中。

要调查是否是 IIS/Tomcat 连接器，请尝试设置

worker.jboss0_ajp13.connection_pool_size=10 worker.jboss0_ajp13.connection_pool_timeout=600

看看它是否有任何区别。请参阅[Tomcat Workers Docs](http://tomcat.apache.org/connectors-doc/generic_howto/workers.html)（包括底部的“A sample worker.properties”部分）。看看那里提到的任何参数是否对您有帮助。

# c++ - 为什么我的 ReadDirectoryChangesW 没有拾取更改的文件？

> ID：483971
> 
> 赞同：2
> 
> 时间：2009-01-27T16:01:12.677
> 
> 标签：c++, readdirectorychangesw

我确定我只是在做一些非常愚蠢的事情而没有看到它，但是谁能告诉我为什么下面的代码不会在传入的目录中获取更改？

调用此代码时，忽略在传入的 m_directory 中创建和修改文件或目录。但如果我打电话

```
PostQueuedCompletionStatus( m_hCompletionPort, 0, 0, NULL ); 
```

然后 GetQueuedCompletionStatus 正确退出。有谁看到我做错了什么？这是代码：

```
// create handle to log dir
HANDLE logDirHandle = CreateFile(m_directory, 
    FILE_LIST_DIRECTORY, 
    FILE_SHARE_READ | FILE_SHARE_WRITE,
    NULL,
    OPEN_EXISTING,
    FILE_FLAG_BACKUP_SEMANTICS |
    FILE_FLAG_OVERLAPPED,
    NULL);

// create the completion port
m_hCompletionPort = CreateIoCompletionPort(logDirHandle, NULL, 0, 1);

// initial registration for changes
DWORD                   dwBufLength;
FILE_NOTIFY_INFORMATION notifyInfo;
OVERLAPPED              overlapped;

ReadDirectoryChangesW(logDirHandle,
    &notifyInfo,
    MAX_BUFFER,
    TRUE,
    FILE_NOTIFY_CHANGE_LAST_WRITE|FILE_NOTIFY_CHANGE_CREATION,      
    &dwBufLength,
    &overlapped,
    NULL);

// wait for a change
LPOVERLAPPED    lpOverLapped;
ULONG           key;
DWORD           numBytes;

GetQueuedCompletionStatus(m_hCompletionPort, &numBytes, &key, &lpOverLapped, INFINITE)) 
```

**编辑：**
好的，我认为 ReadDirectoryChangesW() 肯定会返回 TRUE，但事实并非如此。GetLastError() 告诉我错误是 ERROR_INVALID_HANDLE (6)。奇怪的是，logDirHandle 似乎是有效的，并且在调用 CreateFile() 时没有发生错误。

此外，我稍微重构以调用同步 ReadDirectoryChangesW 保持一切相同，除了丢失 OVERLAPPED 的东西，它工作正常。所以我猜我错误地实现了 OVERLAPPED 的东西？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T16:41:38.867

你检查了返回值吗？这是通过网络吗？

编辑：您可能希望将 OVERLAPPED 初始化为零。

# c# - .net 客户端应用程序的最佳本地 sql 数据库是什么？

> ID：483973
> 
> 赞同：0
> 
> 时间：2009-01-27T16:02:22.643
> 
> 标签：c#, sql, linq, desktop

我正在开发一个需要使用本地 sql 数据库的应用程序。数据库需要封装在一个文件中，因为它们需要能够轻松地将数据移动到网络上、移动到 U 盘上、刻录到 cd/dvd 等上。

我们的旧应用程序都使用了访问，这对我们来说非常有用，但我想使用更新的 .net 工具，例如 linq，我相信它只会离开 sql ce 版本（它似乎不支持 x64）。

你是如何处理这个问题的？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-27T16:06:47.440

[从3.5 SP1](http://www.microsoft.com/downloads/details.aspx?FamilyID=dc614aee-7e1c-4881-9c32-3a6ce53384d9&displaylang=en)开始，SQL Compact[确实支持 x64](http://blogs.msdn.com/stevelasker/archive/2008/08/07/sql-server-compact-3-5-sp1-released.aspx)（它适用于桌面应用程序）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T16:06:34.333

除了精简版，SQLite 拥有强大的追随者。不过，不确定它与 linq/64 位的效果如何。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T16:07:04.270

不确定你在这个应用程序上需要什么样的性能，但是如果你需要你的整个数据库是完全可移植的，你可以使用 sqlite - .NET 可以连接到它，并且由于整个数据库将被存放在一个文件中将非常容易四处走动。

# .net - 减轻双重映射模型开销

> ID：483976
> 
> 赞同：0
> 
> 时间：2009-01-27T16:04:29.423
> 
> 标签：.net, vb.net, linq-to-sql, poco

经过深思熟虑，我决定使用 Linq To SQL 作为我的项目的 DAL，但将业务对象保留为 POCO 对象。

这将提供一些灵活性，因为数据库模式很旧并且有一些无法解决的问题，因为向后兼容。

我正在考虑制作一些方法来使用反射将 LINQ 对象检索或完成到 POCO 对象中。此方法必须尝试使用​​相同名称填充所有属性。

问题：
**你知道做映射的更好方法吗？**

澄清：
1.我不想使用NHibernate，实体等
。2.我知道反射很慢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-11T05:50:30.503

您可能想研究一下 Jimmy Bogard 的[AutoMapper](http://www.lostechies.com/blogs/jimmy_bogard/archive/2009/01/22/automapper-the-object-object-mapper.aspx)之类的东西，它几乎可以满足您的要求。如果您想看一下，他已将其加载到[CodePlex](http://www.codeplex.com/AutoMapper)和[GoogleCode上。](http://code.google.com/p/automapperhome/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T16:36:22.730

创建一个静态类“复印机”。该类的静态构造函数可以反映在 T 和 U 上，并使用 DynamicMethod 发出代码（循环遍历每个属性，查看哪些排列）。这样反射价格就支付一次。从那里开始，它将是一个普通的委托调用，应该很快。

您可能会遇到的问题是，当事情不完全匹配时，简单地复制同名字段会变得有些限制。您可能会考虑使用反射并生成为您进行转换的代码，然后手动修复它们。

# version-control - 在 Team Foundation Server 中查找未添加的文件

> ID：483977
> 
> 赞同：40
> 
> 时间：2009-01-27T16:04:44.103
> 
> 标签：version-control, tfs

我们使用团队基础服务器进行源代码控制。我经常将文件放入我的项目中（在源代码控制下）并且忘记在 TFS 方面“添加”它们。在某些情况下，TFS 不会获取新文件（在项目中复制并粘贴文件）。

有没有办法可以列出所有未标记为“添加”的文件，以便我可以验证所有预期的签入是否发生？

这真让我抓狂！我们还没有为这个项目设置持续集成，而且我一直丢失文件。直到有人问我文件在哪里，我才知道。

在 Subversion 中，这非常简单。

我知道一个解决方案是检查第二个副本，但这并不是真正的最佳解决方法。

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2011-01-26T12:30:40.673

转到源代码管理资源管理器，右键单击您感兴趣的文件夹并选择比较。

这将显示未添加的文件以及未经检查而修改的文件。

此解决方案不需要电动工具

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-01-28T10:02:09.500

您可能需要确保安装了最新版本的 TFS 客户端（[VS 2008 SP1](http://www.microsoft.com/downloads/details.aspx?familyid=9e40a5b6-da41-43a2-a06d-3cee196bfe3d)），因为这样可以更轻松地处理文件。此外，请查看[TFS 电动工具](http://msdn.microsoft.com/en-us/tfs2008/bb980963.aspx)- 尤其是 tfpt 在线命令。

tfpt 命令行有一堆方便的 TFS 实用程序。安装 TFS 电动工具后，在 Visual Studio 2008 命令提示符处键入“tfpt help”以获取列表。如果您在解决方案的根目录中执行“tfpt online /r”，它将检测可在本地文件系统中写入的文件并为它们挂起添加或编辑。您可能希望限制该命令，使其仅查找源文件 - 例如“tfpt online /r *.cs”。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-01-27T16:19:59.300

就在这里。导航到源代码管理资源管理器。单击您感兴趣的项目。单击“将项目添加到文件夹”按钮。距离刷新按钮有两个。这将为您提供文件夹中但未添加到源代码管理的所有文件的列表。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2016-05-17T15:36:12.737

在 VS 2015 中，这帮助我将文件添加到版本控制

1.  在源代码管理资源管理器中打开“将项目添加到文件夹...”上下文菜单项

2.  添加必要的文件

[![截屏](https://i.stack.imgur.com/muBfG.png)](https://i.stack.imgur.com/muBfG.png)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-02-01T09:02:06.987

[受到这个答案](https://stackoverflow.com/questions/1660259/how-to-browse-and-view-files-stored-in-a-team-foundation-server-without-using-vis/1955573#1955573)的“启发”

[TFS Power Tools](https://www.microsoft.com/en-us/download/details.aspx?id=15836) )现在 具有 Windows Shell 扩展，因此您只需使用 Windows 资源管理器即可操作源代码控制文件。

您所追求的选项是与工作区版本比较 - 这也可以递归地工作，并允许有选择地添加/删除等（是的，`tf.exe`可能会有一个等价物）

[![替代文字](https://i.stack.imgur.com/cEB1w.png)](https://i.stack.imgur.com/cEB1w.png)
[（来源：[msdn.com](http://blogs.msdn.com/blogfiles/bharry/WindowsLiveWriter/PreviewofthenextTFSPowerToolsrelease_72E3/image_thumb_11.png)）]

[![替代文字](https://i.stack.imgur.com/eI8m0.png)](https://i.stack.imgur.com/eI8m0.png)
[（来源：[msdn.com](http://blogs.msdn.com/blogfiles/bharry/WindowsLiveWriter/PreviewofthenextTFSPowerToolsrelease_72E3/image_20.png)）]

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-07-13T11:15:36.133

如果您使用的是 Visual Studio，则可以右键单击解决方案资源管理器中的文件夹并选择`Add > Existing item`. 不幸的是，由此产生的“添加文件对话框”不会自动限定您单击的文件夹。

但是，解决方案资源管理器中还有一个名为“显示所有文件”的按钮。单击此按钮后，将出现未包含在项目中的文件并获得“包含在项目中”上下文菜单项。包括它们通常会将它们自动放入 TFS 的“待更改”列表中作为“添加”。

[![在此处输入图像描述](https://i.stack.imgur.com/NmSAT.png)](https://i.stack.imgur.com/NmSAT.png)

（[来源](https://www.quora.com/Why-do-files-created-outside-of-Visual-Studio-not-show-up-in-the-Solution-Explorer-unless-you-add-them-manually)。）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-03-16T11:15:19.630

迁移到 git，就像微软正在做的那样 :)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-12-07T16:52:59.223

对于 Visual Studio 2017，这仍然是一个问题，但很容易修复：导航到 REFRESH 圆形箭头右侧的 SOLUTION EXPLORER 第二个按钮是：SHOW ALL FILES Click that

您的所有文件都将显示为淡出，但可见。右键单击每个并选择“包含在项目中”

完成所有工作后，蜗牛向 Microsoft 寄一封投诉信

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-01-04T12:05:15.787

如果我正确理解您的问题，以下 Powershell 脚本会吐出尚未添加的文件：

```
[hashtable] $lps = [hashtable]::new()

tf info . -recursive | findstr /r /c:"^  Local path :" | foreach-object {
    $lp = $_ -replace '^  Local path : ', ''
    if ($lp) {
        $lps[$lp.toLower()] = $null
    }
}

get-childItem -recurse | foreach-object {
    if (-not $lps.ContainsKey($_.fullName.toLower())) {
       (resolve-path -relative $_.fullName).toString()
    }
} 
```

# c# - IIS 7 托管模块无法获取 Content-Length 或发送的字节数

> ID：483979
> 
> 赞同：7
> 
> 时间：2009-01-27T16:05:15.257
> 
> 标签：c#, iis-7, module

我有一个用于 IIS 6 的 ISAPI 过滤器，它使用响应的字节发送字段进行一些自定义处理。我想为 IIS 7 更新它，但我遇到了问题。IIS 7 事件似乎都无法访问内容长度、发送的字节数或任何可以让我计算内容长度或发送的字节数的数据。（我知道发送的内容长度标头和字节不一样，但两者都可以用于此目的。）

据我所知，内容长度标头是在托管模块完成执行后由 HTTP.SYS 添加的。现在我有一个在 EndRequest 上运行的事件处理程序。如果我能得到输出流，我可以自己计算出我需要什么，但托管管道似乎也无法访问它。

是否有某种方法可以获取托管管道中发送的内容长度或字节？如果做不到这一点，有什么方法可以计算从托管管道中可用的对象发送的内容长度或字节数？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-08T20:46:35.857

要获取发送的字节，您可以使用该`[HttpResponse.Filter](http://msdn.microsoft.com/en-us/library/system.web.httpresponse.filter.aspx)`属性。正如 MSDN 文档所说，此属性获取或设置一个包装过滤器对象，该对象用于在传输之前修改 HTTP 实体主体。

您可以创建一个`[System.IO.Stream](http://msdn.microsoft.com/en-us/library/system.io.stream.aspx)`包装现有`HttpResponse.Filter`流的新流，并在传递它们之前计算传入方法的字节数`Write`。例如：

```
public class ContentLengthModule : IHttpModule
{
    public void Init(HttpApplication context)
    {
        context.BeginRequest += OnBeginRequest;
        context.EndRequest += OnEndRequest;
    }

    void OnBeginRequest(object sender, EventArgs e)
    {
        var application = (HttpApplication) sender;
        application.Response.Filter = new ContentLengthFilter(application.Response.Filter);
    }

    void OnEndRequest(object sender, EventArgs e)
    {
        var application = (HttpApplication) sender;
        var contentLengthFilter = (ContentLengthFilter) application.Response.Filter;
        var contentLength = contentLengthFilter.BytesWritten;
    }

    public void Dispose()
    {
    }
}

public class ContentLengthFilter : Stream
{
    private readonly Stream _responseFilter;

    public int BytesWritten { get; set; }

    public ContentLengthFilter(Stream responseFilter)
    {
        _responseFilter = responseFilter;
    }

    public override void Flush()
    {
        _responseFilter.Flush();
    }

    public override long Seek(long offset, SeekOrigin origin)
    {
        return _responseFilter.Seek(offset, origin);
    }

    public override void SetLength(long value)
    {
        _responseFilter.SetLength(value);
    }

    public override int Read(byte[] buffer, int offset, int count)
    {
        return _responseFilter.Read(buffer, offset, count);
    }

    public override void Write(byte[] buffer, int offset, int count)
    {
        BytesWritten += count;
        _responseFilter.Write(buffer, offset, count);
    }

    public override bool CanRead
    {
        get { return _responseFilter.CanRead; }
    }

    public override bool CanSeek
    {
        get { return _responseFilter.CanSeek; }
    }

    public override bool CanWrite
    {
        get { return _responseFilter.CanWrite; }
    }

    public override long Length
    {
        get { return _responseFilter.Length; }
    }

    public override long Position
    {
        get { return _responseFilter.Position; }
        set { _responseFilter.Position = value; }
    }
} 
```

# java - 获取未知类的 java bean 的属性

> ID：483980
> 
> 赞同：3
> 
> 时间：2009-01-27T16:05:46.817
> 
> 标签：java, javabeans

我希望能够在具有该方法的对象上调用“getProgram”，而不知道它们属于哪个类。我知道我应该在这里使用一个接口，但是我正在使用其他人的代码并且无法重新设计我正在使用的类。我认为 BeanUtils.getProperty 可能会帮助我，但它似乎只返回字符串。有没有类似 Beanutils.getProperty 的东西会返回一个可转换的对象？或者另一种更聪明的方式来处理两个不共享接口的相似类？谢谢，-摩根

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-27T16:32:18.650

使用 PropertyUtils（来自 apache commons-beanutils）而不是 BeanUtils。

它有一个 getProperty(Object bean, String name) 方法，该方法返回一个 Object 而不是 String。

有关更多信息，请参阅[JavaDoc](http://commons.apache.org/beanutils/api/org/apache/commons/beanutils/PropertyUtils.html)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T16:14:03.977

只需为此使用反射......以下示例显示了如何在没有公共接口的对象上执行此操作。

```
 public static void main(String[] args) throws Exception {
    doSomething(new A());
    doSomething(new B());
}

private static void doSomething(Object object) throws Exception {
    Method m = object.getClass().getMethod("doSomething", (Class[])null);
    m.invoke(object, (Object[])null);
}

private static class A {
    public void doSomething() {
        System.out.println("I'm doing it already!");
    }
}

private static class B {
    public void doSomething() {
        System.out.println("I'm doing it too!");
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T16:11:41.157

请参阅[反射 API](http://java.sun.com/docs/books/tutorial/reflect/index.html)：

使用 Class.getMethod()（或 getMethods()）找到合适的方法并调用它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T16:39:08.340

大概您有有限数量的类实现此方法，您可以直接链接到它们。所以你不需要反思。反射是邪恶的。

假设您有一组具有该方法的类：

```
public class LibA { public Program getProgram() { return program; } ... };
public class LibB { public Program getProgram() { return program; } ... };
... 
```

然后你只需要 instanceof/cast 对。你可以把它放在一个方法中，这样你只需要做一次。

```
public static Program getProgram(Object obj) {
    if        (obj instanceof LibA) {
        return              ((LibA)obj).getProgram();
    } else if (obj instanceof LibB) {
        return              ((LibB)obj).getProgram();
    } else {
        throw new IllegalArgumentException(obj+" doesn't have a known getProgram");
            // Or an appropriate application exception.
    }
} 
```

或者，您可能想要使用适配器：

```
public interface ProgramContainer { 
    Program getProgram();
    ...
}

public class LibAContainer implements ProgramContainer {
    private final LibA libA;
    public LibAContainer(LibA libA) {
        this.libA = libA;
    }
    public Program getProgram() {
        return libA.getProgram();
    }
    ...
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T16:59:57.720

一个非常简单的解决方案：使用实现接口的委托：

```
interface GetProgram
{
    String getProgram ();
}

class AWrapper implements GetProgram
{
    A a;
    public AWrapper (A a) { this.a = a;
    String getProgram () { return a.getProgram(); }
} 
```

现在您可以在代码中使用该接口，而无需触及原始类。

缺点：如果您的 A 是在您无法触及的某个地方创建的，则此方法效果不佳。如果 A 在您的控制下创建一次并且您可以立即包装它，则效果最好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-27T19:56:52.513

如果您有 Java 5+，则版本略短

```
public static void main(String[] args) throws Exception {
    System.out.println(invoke("toString", new A());
    System.out.println(invoke("toString", new B());
}

private static <R> R invoke(Object object, String methodName) throws Exception {
    return (R) object.getClass().getMethod(methodName).invoke(object);
} 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-01-27T16:22:31.947

[java.beans.Expression](http://java.sun.com/javase/6/docs/api/java/beans/Expression.html)会这样做，只要该方法在接收器的具体类中是可访问的。

```
public static void main(String[] args) throws Exception {
    new Expression(new A(), "doSomething", null).getValue();
    new Expression(new B(), "doSomething", null).getValue();
}

public static class A {
    public void doSomething() {
            System.out.println("I'm doing it already!");
    }
}

public static class B {
    public void doSomething() {
            System.out.println("I'm doing it too!");
    }
} 
```

# hibernate - 使用hibernate时如何动态添加字段

> ID：483981
> 
> 赞同：1
> 
> 时间：2009-01-27T16:05:48.767
> 
> 标签：hibernate

**问题**

使用 Hibernate 动态地向实体添加和删除字段。

我确信这是一个常见的场景，大多数企业应用程序都需要一定程度的定制。那么最好的方法是什么？理想情况下，它不应该需要重新编译并顺利创建/删除模式中的字段并允许应用程序继续工作。

如果它只是更新 xml 的问题，（我很确定需要代理类）那么架构如何重新加载？

感谢一百万的输入

注意：如果您认为有更好的解决方案，我也会全神贯注，谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-27T16:49:59.660

我不认为这是一个非常常见的用例，正如 Aaron 所建议的那样，您需要很长时间才能确定这一点。

架构更新也不会很简单。即使 Hibernate 确实提供了编程模式更改，它也仅限于添加/删除字段等简单的事情。这可能对您有用，但是如果列的数据类型或可空性发生更改，Hibernate 不会为您更新它。

您可能需要考虑 OneToMany 关系并将数据作为一行存储在单独的表中，假设您可以接受另一个联接的开销。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-27T16:40:53.657

我做过一次（挖掘我的记忆）。好的。做这个：

*   下载Hibernate的源码
*   查找加载 XML 配置的类

您会看到它创建了一个包含表定义的类。请注意所涉及的字段名称和类型。如果该字段是私有的，那么`Field.setAccessible(true)`就是您的朋友。

您需要做的是查询表列表的全局配置类，找到您的表，然后修改字段列表。问题始于将这些字段映射到某个类，因为您无法在运行时更改 Java 类）。

由于这非常复杂，这里有一个更简单的方法：创建一个包含所有字段的 Hibernate 映射，然后使用自定义查询仅加载一个子集。您可以使用 HQL 在运行时轻松创建这样的查询。仅指定您需要的列，Hibernate 不会尝试加载其余列。

# windows - 可以打开的窗户数量有限制吗？

> ID：483991
> 
> 赞同：3
> 
> 时间：2009-01-27T16:08:09.683
> 
> 标签：windows

我有一台非常强大的开发机器和三台显示器，所以经过一些密集的编码/问题修复后，我倾向于启动并运行大量程序。其中一些程序是标签式的；Visual Studio、FireFox、Notepad++ 等。如果我不努力关闭未使用的选项卡，那么似乎一段时间后 Windows 只是拒绝打开更多、错误的窗口。我可以通过关闭现有的来打开另一个，但除非我这样做，否则它只是拒绝打开任何东西。

有人见过这个吗？我认为对于可以同时处理多少个 Windows 来说，这是一个硬性限制。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-27T16:31:04.097

是的，如果我没记错的话，硬限制是整个系统上大约 32,700 个窗口句柄，或者每个进程 10,000 个。应该注意的是，不仅窗口消耗一个窗口句柄，而且每个窗口上的每个控件（每个按钮、面板、组合框等）都消耗一个窗口句柄。

我见过单个对话框（虽然重量太重）消耗超过 2000 个窗口句柄，但通常它们使用的要少得多。

您可以通过启用任务管理器中的“用户对象”列来了解进程消耗的窗口句柄数量，这包括窗口句柄。

有关背景信息，另请参阅：

*   [http://blogs.msdn.com/oldnewthing/archive/2007/07/18/3926581.aspx](http://blogs.msdn.com/oldnewthing/archive/2007/07/18/3926581.aspx)

*   [http://blogs.msdn.com/oldnewthing/archive/2005/03/15/395866.aspx](http://blogs.msdn.com/oldnewthing/archive/2005/03/15/395866.aspx)

*   [http://msdn.microsoft.com/en-us/library/ms725486(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms725486(VS.85).aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-27T16:14:24.350

Windows 可能会获得大量内存，但这不会改变可用系统资源的数量（例如句柄、计时器等）。这就是导致您看到的大多数问题的原因。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-27T16:15:00.713

虽然与编程无关，但这是我们作为程序员可以遇到的事情，[因为我也在其他地方回答过这个问题](https://stackoverflow.com/questions/372622/mdi-pros-cons#374249)

我知道一个事实，在像 mIRC 这样的程序中，有一小部分但不是很小比例的用户遇到了[这个 microsoft KB 项目](http://support.microsoft.com/kb/126962)中描述的问题，这会导致窗口无法打开，直到另一个被释放。

# nant - 如何最小化 NAnt 二进制文件

> ID：483996
> 
> 赞同：1
> 
> 时间：2009-01-27T16:09:13.550
> 
> 标签：nant

您如何仅使用最少的二进制文件设置 NAnt？

我已经开始为小型项目使用默认设置，松散地基于Thoughtworks 的[Tree Surgeon](http://www.codeplex.com/treesurgeon)，将 NAnt、MBunit/NUnit、NCover、NCoverExplorer 等放置在 Tools 文件夹中并在项目中签入。

NAnt 文件夹当前包含 NAnt 的完整安装，其中大部分从未使用过。我的 svn 存储库中也有很多小的一次性/spike/概念验证项目，我觉得包含所有 NAnt 有点浪费。

我记得在某处阅读了剥离大部分文件的指南，但我现在在任何地方都找不到。

如果您有此类文章的链接，或者您能够对这个问题有所了解，将不胜感激！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-27T21:12:22.720

我已经基于 NAnt 构建了分发机制，这是我发现的最精简的版本，同时提供了一组很好的任务：

*   log4net.dll
*   NAnt.Core.dll
*   NAnt.DotNetTasks.dll
*   NAnt.exe
*   NAnt.exe.config
*   NAnt.SourceControlTask​​s.dll（作为固有依赖项需要）
*   NAnt.Win32Tasks.dll

由于所有这些文件都位于同一个文件夹中并且该文件夹存在于您的路径中，您应该能够运行大部分任务。

希望这会有所帮助，祝你好运！**********