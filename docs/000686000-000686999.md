# StackOverflow 问答 000686000-000686999

# jquery - 带有大表行突出显示的 jQuery 缓慢

> ID：686012
> 
> 赞同：2
> 
> 时间：2009-03-26T14:24:33.873
> 
> 标签：jquery

我有这个小片段，用于在 XSLT 页面上突出显示行，该页面必须使用 onclick 事件来回发一些数据，但由于该行不是链接，我必须确保有一个手形光标以及该行被突出显示，以便用户了解它是可点击的以及他们所在的行。

```
<script type="text/javascript">
  $(document).ready(function() {
    $('#stocks tr:not(.exclude)').css('cursor', 'hand');
    $('#stocks tr:not(.exclude)').hover(function() {
      $(this).addClass('hover');
    }, function() {
      $(this).removeClass('hover');
    });
  });
</script> 
```

这些表很大，通常最多 5000 行。当有大量行时，此 jQuery 脚本使用的行突出显示会变得很慢。我写了`tr:not(.exclude)`选择器，但我想也许这就是导致它变慢的原因？关于如何加快速度的任何想法？

**编辑**：我看到很多答案都很好，但是它们并没有解决至少有超过 5,000 行的事实。

**编辑编辑**：您必须确保 IE7 至少设置了以下 doctype 才能使 tr:hover 工作。我的*仍然*很慢，但这必须归结为其他原因。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml"> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T15:10:26.150

这种效果只能通过 CSS 来实现。尝试类似：

```
#stocks tr:hover {
   cursor: pointer;
   background-color: khaki;
}

#stocks tr.exclude:hover {
   cursor: inherit;
   background-color: inherit;
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T14:34:39.357

添加这么多事件很慢，每行看起来像两个。相反，您需要使用 [事件委托](http://lab.distilldesign.com/event-delegation/)。您可以扮演自己的角色，或者该链接可能会有所帮助。基本思想是您只将一个或两个事件处理程序附加到表本身，并且在这些事件处理程序中，您可以查看输入了哪一行的信息并相应地更改视图。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T15:15:09.743

好的！这应该这样做：

```
$(document).ready(function() {
    $('tr:not(.exclude)', '#stocks')
    .css('cursor', 'hand')
    .live("mouseover", function() {
        $(this).addClass('hover');
    }).live("mouseout", function() {
        $(this).removeClass('hover');
    });
}); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T14:46:25.273

1.  按照建议使用 EventDelegation。在表上添加事件侦听器。并且
2.  使用明确的颜色，例如#dee9f3（而不是“蓝色”）
3.  直接分配样式，而不是通过 css 开关，例如

row.style.backgroundColor = '#dee9f3';

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T15:00:28.373

我很确定 live 使用了事件委托。这*可能*取决于鼠标悬停的不稳定程度。

试试这个：

```
$(document).ready(function() {
    $('tr', '#stocks')
    .not('.exclude')
    .css('cursor', 'hand')
    .find('td')
    .live("mouseover", function(){

          $(this).hover(function() {
          $(this).parent('tr').addClass('hover');  
        }, function() {
            $(this).parent('tr').removeClass('hover');
            $(this).unbind();  ////not sure about this part
        });
         $(this).trigger('hover');
    });
}); 
```

# asp.net - 只使用一次的功能应该放在 UserControl 中吗？

> ID：686016
> 
> 赞同：4
> 
> 时间：2009-03-26T14:25:15.900
> 
> 标签：asp.net, user-controls, webforms

如果这是对系统的轻微误用，请原谅我，但我希望 StackOverflow 的其他用户能够解决我和同事之间的争论。

作为一般规则，我更喜欢将每个单独的功能项封装在 UserControl 中*，即使我知道它只会被使用一次*。

在这种情况下，我的同事将避免创建 UserControl 并使用 WebForm，认为如果它只使用一次，那么创建 UserControl 有什么意义 - 它只会增加额外的、不必要的开销。

我认为额外的开销可以忽略不计，它可以使代码组织得更好，谁知道呢，你可能会在未来的某个时候重用这个功能。

**那么谁是对的呢？**

**编辑**

看起来我可能会收到很多回复 - 我和我的同事已经同意，我们将在一天内统计回复，并将正确答案奖励给获得最多票数的论点。

**进一步编辑**

看来我是赢家 :D

我忽略了暗示我们*都是*正确的帖子，并将支持每一方的答案计为+1，并且对该答案的每个赞成票也计为+1。我以 11-6 获胜。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-26T14:27:47.143

如果它使代码更好地组织，我将始终尝试创建单独的用户控件。

这确实使沟通更容易遵循。想想SRP。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-26T14:29:10.213

*当您确实*重用该功能时，为什么不将其留在 WebForm 中并重构为 UserControl ？记住：YAGNI。

当然，代码变得更有条理，但也需要平衡项目拥有的类/文件的数量——如果你太过分了，找到东西会让人望而生畏。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-26T14:30:12.457

我不会将它封装在 UserControl 中，很抱歉，但我同意你同事的意见。UserControls 专门用于可重用的内容（它是一个*控件*，对吧？）。保持简单，不要过度设计，不要为自己创造更多的工作，因为“你可能会在未来的某个时候重用这个功能”。你不可以。当你真正需要它时，你会让它成为一个控件。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-26T14:31:06.963

我也更喜欢将所有内容都放在用户控件中。一方面，它组织得更好，你不能确定你不想把那块 UI 放在你网站的其他地方。

简单的回答：你是对的，你的同事错了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-26T14:32:32.357

考虑一个页面上有几十个这样的代码的情况：这一切都存在于一个表单中是否有意义，或者每个表单都应该是它自己的控件？

并不是说你会 100% 正确，但这可能是在你的同事对此的看法中戳破洞的一种方式。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-26T15:18:10.410

即使您只使用一次代码 - 将代码放入用户控件中，您也可以选择片段缓存。如果您的应用程序对性能至关重要，那么我会支持用户控件。当您开始对应用程序进行性能测试时 - 您不太可能返回并将代码重构到用户控件中以获得片段缓存的好处。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-26T15:11:47.660

> 我认为额外的开销可以忽略不计

同意 - 尝试通过不使用 UserControls 来优化性能应该不被接受。

> 它使代码组织得更好，

它可以，并且如果它在您的特定环境中确实如此 - 那么，是的，这是一个好主意。

> 谁知道呢，你可能会在未来的某个时候重用这个功能。

是的，你可以。或者你可能不会。这是洗礼，最好被 Y(P)AGNI 驳斥（你（可能）不需要它）。

所以 - 总而言之，这取决于它是否真的有助于更好地组织代码。

# seo - SEO - 链接和 GET 查询字符串

> ID：686017
> 
> 赞同：2
> 
> 时间：2009-03-26T14:25:45.667
> 
> 标签：seo, http-status-code-301

如果我的网站有很多这样的链接：

```
www.domain.com/?linkid=101 
www.domain.com/?linkid=102
www.domain.com/?linkid=103, 
```

所有这些都被 301ed 到同一个页面，谷歌和其他搜索引擎会以与查询字符串没有区别的链接相同的方式处理这些吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T15:11:55.210

通过301，“链接汁”*略有*损失。因此，如果站点 A 具有以下页面（所有链接都指向它）：

```
www.example1.com/ 
```

站点 B 的这些页面带有指向以下内容的链接

```
www.example2.com/
www.example2.com/?linkid=101 (301ed to www.example2.com/)
www.example2.com/?linkid=102 (301ed to www.example2.com/)
www.example2.com/?linkid=103 (301ed to www.example2.com/) 
```

在其他条件相同的情况下，站点 A 的排名将略高于站点 B。

您可能还想考虑在您的页面上使用全新的规范链接元素而不是 301。这是来自 Google 的 Matt Cutts 的视频，解释了原因：

[http://www.youtube.com/watch?v=Cm9onOGTgeM&feature=channel_page](http://www.youtube.com/watch?v=Cm9onOGTgeM&feature=channel_page)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T15:11:18.363

是的，他们会因为 301 重定向是永久性的，所以本质上 SE 会忽略这些页面，并且只索引他们被重定向到的页面。

# ant - zip 名称的 Ant 增量内部版本号

> ID：686018
> 
> 赞同：4
> 
> 时间：2009-03-26T14:26:56.770
> 
> 标签：ant, build-numbers

我在 uni 做一个项目，想创建一个 zip 文件，每次成功构建后，其名称（只是一个内部版本号）都会增加。

最简单的方法是什么？是否必须编写自定义任务？或者是否有一些内置功能可以让我简单轻松地做到这一点？

我确实看过 Zip 任务手册，但找不到任何可能有用的东西。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-26T14:31:36.103

你看到[`BuildNumber`任务](http://ant.apache.org/manual/Tasks/buildnumber.html)了吗？

运行该任务，然后根据属性命名 zip 文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T14:51:04.090

一种简单的替代解决方案是在文件名中包含时间戳：

```
myapp_20090326-1522.zip for the build made on 2009-03-26 at 15:22. 
```

这就是许多项目所做的。如果多人可能在他们的机器上创建构建，也可以避免问题；您不需要协调内部版本号。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T15:12:48.440

如果您使用[Hudson](http://hudson-ci.org/) CI 服务器构建项目，则可以使用 Hudson 内部版本号。这是获取 BUILD_NUMBER 环境变量（由 Hudson 注入）的快速示例：

```
<property environment="env" description="System environment variables (including those set by Hudson)"/>
<!-- set the build number based on environment variable, otherwise blank -->
<condition property="buildNumber" value=".${env.BUILD_NUMBER}" else="">
    <isset property="env.BUILD_NUMBER" />
</condition> 
```

# asp.net - URL Rewriter.NET web.config 节点问题

> ID：686030
> 
> 赞同：0
> 
> 时间：2009-03-26T14:30:00.367
> 
> 标签：asp.net, url-rewriting, urlrewriter.net

我正在使用[URL Rewriter.NET](http://urlrewriter.net/)（与 URL Rewriting.NET 相比，我非常喜欢它 - 看起来更通用，不要误会我的意思，我喜欢 URL Rewriting.NET，但它似乎没有鉴于我对该工具的了解，以满足需求）。我正在尝试使用[default-documents](http://urlrewriter.net/index.php/support/reference/default-documents)节点重新定义站点的默认文档。我尝试将其添加到重写器节点，但出现 web.config 错误

```
Description: An error occurred during the processing of a configuration file required to service this request. Please review the specific error details below and modify your configuration file appropriately. 

Parser Error Message: The element 'default-documents' is not allowed.

Source Error: 

Line 187:
Line 188:   <rewriter>
Line 189:       <default-documents>
Line 190:           <document>default.aspx</document>
Line 191:           <document>index.aspx</document> 
```

过去有没有人使用过这个工具，有没有人知道把这个节点放在哪里（或正确使用）？

编辑：

我尝试了下面的建议，但它似乎并不完全正确。这是我的额外配置文件中的内容（这是配置文件中的唯一内容）

```
<rewriter>
        <rewrite url="^(/.+(\.gif|\.png|\.jpg|\.ico|\.pdf|\.css|\.js)(\?.+)?)$" to="$1" processing="stop" />
        <default-documents>
            <document>default.aspx</document>
            <document>index.aspx</document>
        </default-documents>
</rewriter> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T14:50:04.517

我以前使用过 urlrewriter，并且在实际设置默认文档时也遇到了一些问题。然而，最终我们通过将 urlrewriter 配置移动到与 web.config 不同的配置文件来让它（和其他小麻烦）工作。

```
<rewriter configSource="urlrewriter.config"/> 
```

请记住，您还必须禁用 IIS 中的默认文档才能使 urlrewriter 正常工作。这也引起了一系列烦人的问题。

编辑：不要忘记将此行添加到 web.config 中的配置部分

```
<section name="rewriter" requirePermission="false" type="Intelligencia.UrlRewriter.Configuration.RewriterConfigurationSectionHandler, Intelligencia.UrlRewriter"/> 
```

希望这可以帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T15:00:24.177

这个片段对我有用：

```
 <configSections>
        <section name="rewriter" 
                 requirePermission="false" 
                 type="Intelligencia.UrlRewriter.Configuration.RewriterConfigurationSectionHandler, Intelligencia.UrlRewriter" 
        />
    </configSections>

    <rewriter>
        <default-documents>
            <document>index.aspx</document>
        </default-documents>
    </rewriter> 
```

编辑：确保在添加通配符应用程序映射的位置，还取消选中“验证该文件是否存在”。如果你不这样做，default-documents 不会做任何事情。

另一个编辑：找到说明“验证该文件是否存在”复选框的安装步骤。[请参阅此处的](http://urlrewriter.net/index.php/support/installation/windows-server-2003)第 8 步：

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T16:28:28.213

我相信这个问题的解决方案是我在网站上使用的 .NET 版本。我使用的是 2.0 运行时，而 dll 是为 1.1 运行时构建的。我在网站上看到 2.0 运行时仍在 RC 中（自 2007 年中期以来），因此我不会在这个生产网站上使用它。相反，我想出了如何使用 URL Rewriting.NET 来实现相同的目标。

我添加了以下规则：

```
<add name="Redirect54" virtualUrl="~/content/myvirtualpage.aspx"
    rewriteUrlParameter="ExcludeFromClientQueryString"
    destinationUrl="~/content/mydestinationpage.aspx?id=9"
    redirect="None"   
    ignoreCase="true"  /> 
```

这会导致 myvirtualpage.aspx 上的 HTTP 200 响应，而不是重写。最终目标是让 mydestinationpage.aspx?id=9 有一个 301 到 myvirtualpage.aspx，然后它将为 myvirtualpage.aspx 提供 200 HTTP 响应。不过这有点不对劲。

# c# - 如何控制正则表达式分组？

> ID：686031
> 
> 赞同：0
> 
> 时间：2009-03-26T14:30:01.350
> 
> 标签：c#, regex

我有一个文本文件，其中都包含以下代码片段

```
Lines.Strings = (
  'test@test1.com'
  'test@test2.org'
  'test@test3.org'
  'test@test4.com') 
```

电子邮件地址将更改。Lines.String 的 Lines 部分也可以称为任何东西，例如 Test.Strings 或 ListBox.Strings

我想匹配此 Strings = ( ) 块中的所有文本；

这是我正在使用的代码

```
[a-zA-Z]+\.Strings\s+=\s+[\(]{1}(.+)[\)]{1} 
```

但这并没有捕捉到所有的比赛

我希望在找到第一个 ) 后停止分组。看起来它匹配第一个之后的任何字符（一直到文件末尾到最后一个）

任何帮助将不胜感激。

**编辑**：

我不是要匹配“电子邮件”；我想要开头（和结尾）之间的任何文字

我认为这被称为“非贪婪”匹配。我只希望匹配在找到第一个 ) 后结束。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T14:45:22.920

这可能会更好。

```
[a-zA-Z]+\.Strings\s*=\s*\(([^)])+)\) 
```

另外，你如何处理换行符？那可能是你的问题。从您提供的正则表达式来看，您似乎将所有行与空格连接在一起。如果没有，您需要考虑多行正则表达式。

回应您对自己问题的回答：

```
"[a-zA-Z]+\\.Strings\\s+=\\s+[\\(]{1}(.+?)\\){1}?", 
```

不必要地混乱，并且在某些情况下可能无法按预期工作。

*   你不需要写`{1}`，因为这是默认的
*   `[\)]`和刚才一样`\)`
*   你不会匹配`=`没有被空格包围的情况，即使这些空格通常是可选的
*   使最终成为`)`可选的并且不排除`)`在您的内部模式中意味着它将成为您捕获的一部分。

修复这些会导致：

```
"[a-zA-Z]+\\.Strings\\s*=\\s*\\(([^)]+)\\)" 
```

这正是我发布的内容，但反斜杠加倍以用于字符串。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T14:46:55.863

尝试

```
/\(([^\)]+)\)/

NODE                     EXPLANATION
----------------------------------------------------------------------
  \(                       '('
----------------------------------------------------------------------
  (                        group and capture to \1:
----------------------------------------------------------------------
    [^\)]+?                  any character except: '\)' (1 or more
                             times (matching the least amount
                             possible))
----------------------------------------------------------------------
  )                        end of \1
----------------------------------------------------------------------
  \)                       ')'
---------------------------------------------------------------------- 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T14:49:45.063

```
public static Regex regex = new Regex(
      "[a-zA-Z]+\\.Strings\\s+=\\s+[\\(]{1}(.+?)\\){1}?",
    RegexOptions.IgnoreCase
    | RegexOptions.Singleline
    | RegexOptions.CultureInvariant
    | RegexOptions.IgnorePatternWhitespace
    | RegexOptions.Compiled
    ); 
```

我好像明白了。

如果你能改善这一点；使用更新版本发布您自己的答案。

-- 注意 -- 以上工作。

# sql-server - Basic SQL / Entity Framework 1 to 0..1 实体模型题

> ID：686043
> 
> 赞同：0
> 
> 时间：2009-03-26T14:31:39.020
> 
> 标签：sql-server, entity-framework

在我的数据库中，我有 2 个表 A 和 B

A 具有列 ID、标题和 B_ID。B_ID 允许空值。B 中的列 ID 和 SomeText ID 都是主键标识 A 在 B_ID 上也有唯一索引

这似乎是说 A 可以有 0 或 1 B 行与之关联的基本方式，并且每个 B 都与 1 A 相关联。到目前为止是否正确？

当我创建该数据库的 ADO.NET Entity Framework 实体模型时，A 具有到 B 的导航属性，其多重性为 0..1。那讲得通。

实体 B 具有 A 的导航属性，但其多重性是 *(Many)。

我想我的数据库定义不会让一个 B 与许多 A 相关联，所以也许这不是问题，但是有没有办法定义数据库和/或修改实体模型，以便从 B 到 A 的导航属性具有1 的多重性？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T15:09:58.290

我不完全理解您的实体设置，但如果 B 具有包含 ID 值和任何其他字段的主键，或者根本没有主键关系，那么该关系是正确的，因为 Entity Framework 显示它。您可能会仔细检查您的架构，以确保一切都按照您的想法进行配置。

要使从 B 到 A 的多重性为 1，您需要在 B 中有一个主键，它只是用作 A 中的外键的 ID 值。

如果我对您的实体布局的解释不正确，请澄清您的问题，我会尽力提供帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T17:22:47.317

感谢 mwigdahl，答案实际上在数据库定义中。

我更改了表定义。表 A 具有列 ID、B_ID 和标题 表 B 具有列 A_ID 和 SomeText

ID 是表 A 的主键 A_ID 是表 B 的主键 表 A 中的 B_ID 是表 B 中列 A_ID 的外键引用

当我从该数据库定义创建实体框架模型时，我得到了 A 和 B 之间预期的 1 到 0..1 关系。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T17:50:11.947

听起来你应该在 A 的表中省略 B 的 ID（它与 A 的 ID 相同吗？？）你在做这样的事情吗？

```
CREATE TABLE dbo.People(PersonId int NOT NULL, Name varchar(50) NOT NULL)
CREATE TABLE dbo.BioData(PersonId int NOT NULL, ExtraInfo varchar(255) NOT NULL) 
```

# c# - C#、Linq2SQL：构建表达式

> ID：686044
> 
> 赞同：3
> 
> 时间：2009-03-26T14:31:49.287
> 
> 标签：c#, linq-to-sql

你怎么做呢？

我坐在这里，努力让自己和他人的事情变得更简单。但我似乎无法决定哪种方式是最好的。问题是这样的：

从数据上下文中的一些东西的集合开始，然后开始过滤掉一大堆不同的标准。如果是这样，那么那些或者也许是那些，除非那不是这个，而是那个，在那些之间和山上，除非什么都没有，然后向后，向上和超越。

好的，也许没有那么复杂......但我基本上需要建立这样的树：

```
 start
          |
          x
          |
          x
         / \
        x   x
        |   |
        x   x
         \ /
          x
         / \
        x   x
        |   |
        x   |
        |   |
        x   x
         \ /
          x
          |
        result 
```

其中`|`代表`And`和分支代表`Or`。由于`Or`替代路径，我无法`data.Where(...).Where(...).Where(...)`一直使用。并且使用诸如`Union`并且`Concat`有[崩溃倾向的](https://stackoverflow.com/questions/650847/linq2sql-help-with-sqlexception-about-union-intersect-and-except)东西（实际上还没有设法以工作方式使用它）。换句话说，我必须建立`Expression<Func<T, bool>>`实例。

我已经创建了扩展方法，用于将它们与`AndAlso`and相加`OrElse`（在[Marc](https://stackoverflow.com/users/23354/marc-gravell)[的大量帮助](https://stackoverflow.com/questions/569671/c-linq2sql-is-it-possible-to-concatenate-two-queryables-into-one)下。我已经开始创建一个谓词构建器类以使事情变得更简单。计划是创建-stuff 链，然后将它们放在一起……有点……：p`And``Or`

无论如何，我只是无法决定这些是否是好主意。我认为我现在开始的道路可能会在我编写这些链时为我提供一个不错的“工作环境”。但我很想知道其他人是如何解决这些问题的。我认为这可能很常见，至少在必须以各种奇怪的方式过滤和处理数据然后将它们显示给用户的应用程序中。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T14:39:32.090

有些人对[Predicate Builder](http://www.albahari.com/nutshell/predicatebuilder.aspx)发誓。就个人而言，我一直觉得`Expression`手动修改 s 就足够了——但也许我就是这样奇怪（此外，我已经使用`Expression`API 有一段时间了）。但只要你有合适的单元测试，我看不出这种方法有什么问题。当前最大的抱怨是 EF 对有限的支持`Expression.Invoke`- 请放心，这将是我在 4.0 进入“测试版”时检查的第一件事。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T15:18:13.543

它看起来不是特别干净，如果它是一个非常复杂的情况可能会变得更丑，但是对于简单的东西我有时会构建这样的查询

```
string MinOrMaxOption = "min";
int CompareValue = 5;
var Results = from row in MyData
              where (MinOrMaxOption=="min" && row.ValueA > CompareValue)
              || (MinOrMaxOption=="max" && row.ValueA < CompareValue)
              select row; 
```

这当然只有在查询可能性被预定义的情况下才有效。我不知道您的示例中是否是这种情况。

# javascript - 将插入符号位置保持在文本输入中的可见位置 - firefox 行为不端

> ID：686053
> 
> 赞同：4
> 
> 时间：2009-03-26T14:33:38.267
> 
> 标签：javascript, firefox, textinput

我正在玩弄我的文本输入框的想法，即单击包含“标签”选择的 div 以添加元内容。我的文本输入宽度为 35，但我希望它能够溢出。

我已经搜索并找到了将插入符号聚焦和定位在更新的输入内容末尾的方法，并且 chrome 和 IE 会自动滚动以在输入框的可见区域显示光标，但是当文本输入是full and overflows Firefox 3.0.7 将正确定位的插入符号放在右侧的视野之外（尽管如果您按键盘上的右箭头，您可以在不影响位置的情况下到达它）。

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T15:28:21.780

请参阅我对[这个问题](https://stackoverflow.com/questions/668720/how-do-i-shift-the-visible-text-in-a-narrow-input-element-to-see-the-cursor-at-th/668856#668856)的回答。虽然它比较笨拙，但您可以在 FF 中触发按键事件，输入将滚动到末尾（在您希望看到的位置显示插入符号）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-23T23:24:11.053

我在滚动到 FireFox 的文本区域中的选择时遇到了类似的问题。我无法发送“空格”然后是“退格”字符，因为这会覆盖文本区域中的选择。所以我找到了一种更好的方法，即在选择后立即虚拟地重新输入字符，这将强制选择可见。

这是代码：

```
function setSelRange(inputEl, selStart, selEnd) { 
     if (inputEl.createTextRange) {
        var range = inputEl.createTextRange(); 
        range.collapse(true); 
        range.moveEnd('character', selEnd); 
        range.moveStart('character', selStart); 
        range.select(); 
        //range.scrollIntoView();
    } else if (inputEl.setSelectionRange) {
        inputEl.focus(); 
        inputEl.setSelectionRange(selEnd, selEnd + 1);
        // ---- Firefox Workaround ----
        // Send a virtual key, which is the character immediately after the 
        // selected text. It justs rewrites the same character so that no unnecessary changes
        // are made to the content.
        // When the selection is at the end of the textarea, an extra space is appended
        // because the inputEl.value.charCodeAt(selEnd) would otherwise cause an error.
        var evt = document.createEvent("KeyboardEvent");
        if (inputEl.value.length == selEnd) {
            evt.initKeyEvent("keypress", true, true, null, false, false, false, false, 0, 32);
        } else {
            evt.initKeyEvent("keypress", true, true, null, false, false, false, false, 0, inputEl.value.charCodeAt(selEnd));
        }
        inputEl.dispatchEvent(evt);
        inputEl.setSelectionRange(selStart, selEnd);

    } 
} 
```

希望这可以帮助任何一直在寻找这个的人。我浪费了很多时间试图弄清楚这一点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-28T10:37:31.660

谢谢，这对我有用。将其与现有脚本相结合以将插入符号移动到 textinput 或 textarea 的末尾似乎涵盖了 IE7、FF3 和 chrome。

```
 function setCaretPosition(elemId, caretPos) {
        var elem = document.getElementById(elemId);

    if(elem != null) {
        if(elem.createTextRange) {
            var range = elem.createTextRange();
            range.move('character', caretPos);
            range.select();
        }
        else {
            if(elem.selectionStart) {
                elem.setSelectionRange(caretPos, caretPos);
                elem.focus();
                // Workaround for FF overflow no scroll problem
                // Trigger a "space" keypress.
                var evt = document.createEvent("KeyboardEvent");
                evt.initKeyEvent("keypress", true, true, null, false, false, false, false, 0, 32);
                elem.dispatchEvent(evt);
                // Trigger a "backspace" keypress.
                evt = document.createEvent("KeyboardEvent");
                evt.initKeyEvent("keypress", true, true, null, false, false, false, false, 8, 0);
                elem.dispatchEvent(evt);
            }
            else
                elem.focus();
        }
    }
}
 setCaretPosition(document.getElementById("searchinput").id, document.getElementById("searchinput").value.length); 
```

# asp.net - IIS 7 重写模块规则

> ID：686055
> 
> 赞同：1
> 
> 时间：2009-03-26T14:34:04.007
> 
> 标签：asp.net, url-rewriting

我正在使用 IIS 7 重写模块设置一些重写路径。

我只是无法理解这个。

我的友好 URL 应如下所示：
[http://localhost/5f3ff4a5-1fb4-4470-904f-bd55e4fabc5d/marketing_performance/dashboard/](http://localhost/5f3ff4a5-1fb4-4470-904f-bd55e4fabc5d/marketing_performance/dashboard/)

并重写为：
[http://localhost/marketing_performance/dashboard.aspx?account=5f3ff4a5-1fb4-4470-904f-bd55e4fabc5d](http://localhost/marketing_performance/dashboard.aspx?account=5f3ff4a5-1fb4-4470-904f-bd55e4fabc5d)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-06T22:05:36.260

只需在此规则中添加两个条件即可检查请求的 URL 是否不是文件，也不是目录。这样您的正常 html 链接将继续工作：

<条件>
<add input="{REQUEST_FILENAME}" matchType="isDirectory" negate="true" /> <add input="{REQUEST_FINENAME}" matchType="isFile" negate="true" /> </conditions>

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T16:54:45.967

我真的搞定了：
Pattern: ^([^/]+)/([^/]+)/([^/]+)/?$
Rewrite: {R:2}/{R:3}.aspx?帐户={R:1}

但是，当我有一个带有 href="../../test.aspx" 的普通 HTML 链接的页面时，它会失败，并出现以下错误：无法使用前导 .. 退出顶级目录。所以我想我必须重构我所有的链接，比如这个。

# java - 如何在 Java Web Start (JNLP) 下调试应用程序？

> ID：686061
> 
> 赞同：50
> 
> 时间：2009-03-26T14:35:51.430
> 
> 标签：java, debugging, jnlp, java-web-start

我知道如何使用 Eclipse 调试远程 Java VM，但如何使用 Java Web Start 程序进行调试。我有一个仅在 Java Web Start 中出现的问题。它必须与安全相关。

我需要一个适用于当前 Java VM（如 1.6.0_12）的解决方案。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-03-26T15:06:17.127

这与您想要远程调试的任何其他 Java 进程完全相同：您必须为 VM ( `-Xdebug -Xnoagent -Xrunjdwp:transport=dt_socket,server=n,suspend=y,address=12345` ) 设置一些参数，然后连接到给定的端口。在 Java webstart 6.0 中，这可以使用 -J 选项来完成，在早期版本中，通过环境变量 JAVAWS_VM_ARGS。[在此处](http://java.sun.com/j2se/1.5.0/docs/guide/javaws/developersguide/troubleshooting.03.06.html)查看详细信息。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-03-26T15:15:48.650

手动启动 JWS VM。这样您就可以提供启动参数来打开调试端口。这是一个[描述](http://icoloma.blogspot.com/2005/06/how-to-debug-jwsjnlp.html)，它是这样的：

```
set JAVAWS_TRACE_NATIVE=1
set JAVAWS_VM_ARGS="-Xdebug -Xnoagent -Djava.compiler=NONE -Xrunjdwp:transport=dt_socket,address=8989,server=y,suspend=n"
javaws http://server:port/descriptor.jnlp 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2014-11-06T12:36:39.423

至于较新版本的 Java（Java 8u20+ 和 Java 7u70+），我发现像 -Xrunjdwp 这样的参数不能直接传递，也不能使用 JAVAWS_VM_ARGS。消息 `Rejecting attempt to specify insecure property: -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=8000` 开始出现在控制台输出中。

对我有用的唯一解决方案是将这些参数传递给 JAVA_TOOL_OPTIONS 系统变量。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2013-05-21T08:11:07.247

您还可以使用 -J 选项为 javaws 可执行文件提供调试参数

例子：

```
javaws.exe -J-Xdebug -J-Xnoagent -J-Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=8000 http://server:port/descriptor.jnlp 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2017-08-07T17:13:11.910

您将需要执行以下操作：

1.  在 Java 控制面板 > 高级中启用 Java 日志和跟踪。 [![Java 控制面板：日志和跟踪](https://i.stack.imgur.com/ISYDd.jpg)](https://i.stack.imgur.com/ISYDd.jpg)

2.  启用调试 Java 的参数（可选但有用，即 tls/ssl 握手问题为 close_notify 或 handshake_failure）和启动 JNLP，有两种方法可以做到：

    2.a. 下载 JNLP 文件并从命令行执行它（`SET`在这种特殊情况下不需要该命令）。

    ```
    set JAVA_TOOL_OPTIONS=-Djavax.net.debug=all
    javaws -wait jnlp.jnlp 
    ```

    2.b。在 Java Control Panel > Java > View 中为 JVM添加参数（即`-Djavax.net.debug=all`）（这在本例中不是必需的），并从浏览器启动 JNLP 文件：

    [![Java 控制面板：jvm 参数](https://i.stack.imgur.com/B9stP.png)](https://i.stack.imgur.com/B9stP.png)

3.  日志和跟踪位于[Java 部署主页](http://docs.oracle.com/javase/7/docs/webnotes/tsg/TSG-Desktop/html/plugin.html#gcexde)`log`的目录中，我将这些位置粘贴到该目录中：

    一种。视窗XP：`%HOME%\Application Data\Sun\Java\Deployment`

    湾。视窗 7/Vista：`%APPDATA%\..\LocalLow\Sun\Java\Deployment`

    C。Linux/Solaris：`%HOME%/.java/deployment`

使用 javax.net.debug=all 如果 jnlp 中的 jar 是从 https 连接加载的，您将看到握手。这类问题很难调试。

```
...
%% No cached client session
*** ClientHello, TLSv1.2
...
***
... 
Java Web Start Main Thread, received EOFException: error
Java Web Start Main Thread, handling exception: javax.net.ssl.SSLHandshakeException: Remote host closed connection during handshake
Java Web Start Main Thread, SEND TLSv1.2 ALERT:  fatal, description = handshake_failure
Java Web Start Main Thread, WRITE: TLSv1.2 Alert, length = 2
Java Web Start Main Thread, called closeSocket()
#### Java Web Start Error: 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-06-14T16:49:50.763

要在 Linux 中调试 Web Start 应用程序，请在调试模式下使用 javaws 调用创建一个 shell 脚本 ~/bin/javaws-debug.sh，如上所述：

~/bin/javaws-debug.sh：

```
#!/bin/sh
export JAVAWS_TRACE_NATIVE=1
export JAVAWS_VM_ARGS="-Xdebug -Xnoagent -Djava.compiler=NONE 
  -Xrunjdwp:transport=dt_socket,address=8989,server=y,suspend=n"
javaws "$@" 
```

然后，在您的浏览器中，选择该脚本作为要在 jnlp 文件上调用的应用程序。

例如，在 Firefox 中，转到编辑→首选项→应用程序，内容类型：Java Web Start，然后在操作中选择“使用其他”，然后从“选择帮助应用程序”对话框中选择脚本。在 Chrome 中，您需要更改 Linux 系统设置。在 KDE 中，进入系统设置→文件关联，已知类型：application:x-java-jnlp-file，添加一个新的应用程序，从“为应用程序/x-java 选择应用程序”中选择 ~/bin/javaws-debug.sh -jnlp 文件”对话框。

配置好浏览器后，Java Web Start 应用程序将开始使用您的包装器，这将使调试器能够连接到端口 8989。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-07-12T00:12:54.237

在 Java 8 和 Windows 10 中，打开命令提示符 (cmd.exe) 并输入：

```
set JAVAWS_TRACE_NATIVE=1
set JAVA_TOOL_OPTIONS=-Xdebug -Xnoagent -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=8000
javaws java-app.jnlp 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-09-07T09:12:16.280

您可以在启用调试的情况下运行 JNLP：

```
javaws -Xnosplash -J-agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5009 <application>.jnlp 
```

输出： **在地址监听传输 dt_socket：5009**

使用您最喜欢的 IDE 附加到此，我使用 IntelliJ IDEA **Run>Attach to process**

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-26T15:12:36.333

您是否尝试过打印调试日志？无论如何，这是一件有用的事情，并且在这种情况下可能会有所帮助。

如果您想要真正的调试，请参见此处： [如何在 WebStart 下调试？](http://lopica.sourceforge.net/faq.html#debug)

# .net - WPF：交换 ListView 的整个视图

> ID：686063
> 
> 赞同：1
> 
> 时间：2009-03-26T14:36:28.213
> 
> 标签：.net, wpf

是否可以使用数据模板交换 Xaml 中 ListView 的整个视图？寻找一种方法来允许用户更改他们在 ListView 中查看数据的方式，我希望留在 Xaml 中。我找到了如何更改单个列/单元格的模板。

我想要完成的更多细节：我想要两个不同的 GridView，每个显示不同的列（第一个除外）。我想允许用户通过单选按钮选择要使用的视图。

部分原因是我尝试学习 WPF，所以我可能会要求一些无法完成的事情，或者我可能会让它变得比我需要做的更难。

谢谢，大卫

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T14:41:16.173

该`ListView.View`属性是一个依赖属性，因此您应该能够很容易地绑定它：

```
<ListView View="{Binding CurrentView}"/> 
```

因此，您需要做的就是为该属性分配适当`GridView`的值`CurrentView`，它应该可以正常工作。

# c# - 插件集成的最佳模型

> ID：686071
> 
> 赞同：2
> 
> 时间：2009-03-26T14:38:10.113
> 
> 标签：c#, integration

我们有许多插件应用程序，它们都可以独立运行，也可以在同一个主机容器中运行。用户可以使用一个或多个插件运行一个主机容器或多个主机容器。

我们有许多“集成”用例，人们想要

1.  将数据从一个插件发送到另一个插件
2.  将“动作”或“命令”发送到另一个应用程序（有时带有参数）

我们有几个选择：

1.  在容器级别有一个众所周知的事件总线，所有插件都知道并且可以发布和订阅定义良好的消息或对象

2.  将一个插件的 dll 嵌入另一个插件并从另一个插件调用一个插件的 API

3.  创建了解公共集成点的集成插件，这样每个单独的插件都是完全独立的，并且集成插件是唯一了解集成的东西。这是我们可以在没有任何无关依赖的情况下发布每个单独的插件。

想法或其他建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T15:23:56.590

我会看看微软目前正在开发的新的托管可扩展性框架 (MEF) 库。请参阅[Codeplex 网站](http://www.codeplex.com/MEF)。据我正确理解，VS 2010 也将使用此框架在 Visual Studio 中提供扩展点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T14:59:35.397

智能[客户端软件工厂](http://www.microsoft.com/downloads/details.aspx?FamilyId=3BE112CC-B2C1-4215-9330-9C8CF9BCC6FA&displaylang=en)是另一个需要考虑的指导。它大部分是 WinForms，可能比新的 WPF 版本（完全重新架构）稍微复杂一些。但是，它也会为您提供实现模块化目标的想法。链接和文档很好地涵盖了模块是如何分离的，但可以通过通用框架传递数据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T14:46:31.340

考虑 Microsoft 的[WPF 和 Silverlight 的模式和实践复合应用程序指南](http://www.codeplex.com/CompositeWPF)。即使它不完全是您所需要的，学习一些方法来完成模块化所需的一些方法（例如在模块之间共享数据）也是一个很好的模式。

# c# - 确保页面只能通过 SSL 访问

> ID：686073
> 
> 赞同：6
> 
> 时间：2009-03-26T14:38:53.230
> 
> 标签：c#, asp.net, ssl

如何确保我的用户不能物理输入 http: 来绕过我的 SSL 并确保每个页面都是 https:？

可能是我的母版页上的重定向？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-26T14:40:33.413

这通常通过 IIS 配置或使用 ISAPI 过滤器来处理，但如果您想在应用程序代码中执行此操作，您可以在母版页的 Page_Init 事件中放置类似的内容...

```
If Not Request.IsSecure
    Response.Redirect(Request.Url.AbsoluteUri.Replace("http://", "https://"))
End If 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T14:39:52.793

我会使用单独的页面将所有 http url 重定向到 https，或者在 IIS 配置中使用“需要安全通道”选项，如果有人尝试访问非 https 页面，则会显示错误。

[这是](http://blog.kyanmedia.com/archives/2007/6/28/forcing_https_in_iis_60/)一个站点，其中包含将错误页面重定向到您站点的 https URL 的指南。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-03-23T20:21:43.323

以下内容基于 Josh Stodolas 的回答 ( [IsSecureConnection](http://msdn.microsoft.com/en-us/library/system.web.httprequest.issecureconnection.aspx) )，但使用[UriBuilder](http://msdn.microsoft.com/en-us/library/system.uribuilder.aspx)将方案更改为 https 而不是字符串替换。这种方法的好处是它不会将 URL 中所有出现的“http”更改为“https”。

```
if (!Request.IsSecureConnection)
{
    UriBuilder newUri = new UriBuilder(Request.Url);
    newUri.Scheme = Uri.UriSchemeHttps;
    Response.Redirect(newUri.Uri.AbsoluteUri);
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T16:53:58.727

我使用 HTTPModule 完成了这项工作，这样您就不必担心将代码放在每个母版页中（如果您有多个母版页）。此版本还关闭了 localhost 的重定向，因此您不必在自己的机器上安装 SSL。基本上你会像这样创建一个新的 HTTP 模块：

```
Public Class RedirectToHttpsModule
    Implements IHttpModule

    Public Sub Dispose() Implements IHttpModule.Dispose

    End Sub

    Public Sub Init(ByVal context As HttpApplication) Implements IHttpModule.Init
        AddHandler context.BeginRequest, AddressOf context_BeginRequest
    End Sub

    Private Sub context_BeginRequest(ByVal sender As Object, ByVal e As EventArgs)
        Dim application As HttpApplication = TryCast(sender, HttpApplication)
        If Not application.Request.IsSecureConnection And Not application.Request.IsLocal Then
             application.Response.Redirect(application.Request.Url.ToString().Replace(application.Request.Url.Scheme, "https"))
        End If
    End Sub

End Class 
```

您还必须在 web.config 中为 HTTPModule 添加适当的行：

```
<httpModules>
      <add type="RedirectToHttpsModule" name="RedirectToHttpsModule" />
</httpModules> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T14:41:48.327

```
if(!String.Equals(Request.Url.Scheme,
                  "https",
                  StringComparison.OrdinalIgnoreCase)) { } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-26T15:44:20.597

如果您只想接受安全连接，请为*仅*重定向到 HTTPS 的端口 80 创建单独的服务。理想情况下，您会在 HTTP 重定向中保留请求的路径。

如果您只是想鼓励 HTTPS 连接进行浏览（并且不关心机器人，例如），请将其添加到您的页面：

```
<script type="text/javascript">
if(location.protocol=='http:')
  location=location.toString().replace(/^http:/,'https:');
</script> 
```

# wpf - WPF TabControl 数据绑定

> ID：686074
> 
> 赞同：27
> 
> 时间：2009-03-26T14:39:16.927
> 
> 标签：wpf, data-binding, tabcontrol

我正在尝试构建一个包含 TabControl 和 TextBlock 的 WPF 用户界面。

我想将这两个控件绑定到以下类的实例的基础集合：

```
class PageModel
{
  public string Title {get;set;}
  public string TabCaption {get;set;}
  public FrameworkElement TabContent {get;set}
} 
```

选项卡控件应为每个 PageModel 显示一个选项卡。

*   每个选项卡的标题应显示 TabCaption 属性
*   每个选项卡的内容都应该是 TabContent 属性。

TextBlock 应显示当前选定选项卡的标题。

我怎样才能达到这个结果？

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2009-03-26T14:45:25.243

```
<TabControl x:Name="_tabControl" ItemsSource="{Binding PageModels}">
    <TabControl.ItemContainerStyle>
        <Style TargetType="TabItem">
            <Setter Property="Header" Value="{Binding TabCaption}"/>
            <Setter Property="Content" Value="{Binding TabContent}"/>
        </Style>
    </TabControl.ItemContainerStyle>
</TabControl>
<TextBlock Text="{Binding SelectedItem.Title, ElementName=_tabControl}"/> 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2012-08-31T16:35:43.003

[我还在这里](https://stackoverflow.com/questions/589802/how-can-i-bind-a-list-collection-to-tabcontrol-headers-in-wpf)使用 ItemTemplate 和 ContentTemplate找到了另一个解决方案。

同样对于像我这样的任何 WPF 新手，在经历了一些头痛和沮丧之后，我意识到页面模型的集合需要是一个`ObservableCollection<PageModel>`而不是 a`List<PageModel>`或者对列表的任何更改都不会反映在选项卡上（即你不能添加或删除一个选项卡，如果它是一个列表）。

# java - 在 Java 中，静态类成员是否在程序之间共享？

> ID：686079
> 
> 赞同：20
> 
> 时间：2009-03-26T14:39:54.180
> 
> 标签：java, jvm

**我想不，他们不是，因为每个进程都有自己的内存空间，当然。**

但是整个 JVM 到底是如何工作的呢？对于我启动的每个 Java 程序，在单独的进程中是否有单独的 JVM？在系统中运行的 Java 程序是否共享任何东西？操作系统和 JVM 实现之间有区别吗？我可以*让*程序共享变量（即直接通过 JVM 而不是通常的 IPC 机制）吗？是否有更多用于特殊目的的奇异单进程 JVM？

一般来说，关于 JVM 内核的推荐读物有哪些？[规格](http://java.sun.com/docs/books/jls/third_edition/html/j3TOC.html)？_ 一些实现的源代码？网站？图书？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-03-26T15:15:59.883

> 在 Java 中，静态类成员是否在程序之间共享？

一个类由它的全名和加载它的类加载器定义。如果同一个类在同一个 JVM 进程中，并且两个程序通过同一个类加载器加载该类，那么静态成员是共享的。类加载规则非常重要。

> 我想不，他们不是，因为每个进程都有自己的内存空间，当然。

如果您使用两个单独的 JVM 来启动两个应用程序，那么您是正确的。但是以应用程序/servlet 容器为例，例如 tomcat：它们通过同一个进程（tomcat 主机进程）加载多个应用程序。

> 但是整个 JVM 到底是如何工作的呢？对于我启动的每个 Java 程序，在单独的进程中是否有单独的 JVM？在系统中运行的 Java 程序是否共享任何东西？

每次`>java -cp...`在命令行键入时，您都在创建一个新进程。请记住，当您运行 eclipse 或调用 ant java 任务时，`fork=true`您也在创建新进程。

> 操作系统和 JVM 实现之间有区别吗？我可以让程序共享变量（即直接通过 JVM 而不是通常的 IPC 机制）吗？是否有更多用于特殊目的的奇异单进程 JVM？

就像海报所说的那样，有像 Terracota 这样的项目可以为您提供便利。这种共享的一般方法是分布式缓存。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-26T14:43:59.380

不，静态变量不在 JVM 之间。是的，您运行的每个 Java 应用程序都有一个单独的 JVM 进程。

在某些实现中，我相信它们可能会共享*一些*资源（例如 JRE 类的 JITted 代码的内存），但我不确定。我相信正在进行更多的工作来实现更多的共享，但仍然是以一种稳健的方式。（您真的不希望一个 JVM 崩溃来影响其他 JVM。）

不，你不能让程序透明地共享变量。

我相信有关于 JVM 的书籍，但我不能推荐任何书籍。您最好查找 HotSpot 白皮书以了解详细信息。[这](http://java.sun.com/products/hotspot/whitepaper.html)是一个很好的起点。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-26T14:46:55.507

如果您的主要兴趣是如何实例化静态类成员，您可能应该在类加载领域进行更多搜索。

如果同一 VM 上的不同线程使用单独的类加载器，它们可能有自己的静态类成员实例。

这里的经典示例是[Apache Tomcat](http://tomcat.apache.org/)将不同的 Web 应用程序分开，尽管 lib jar 可能对所有应用程序都是通用的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-26T14:50:43.657

取决于实现，但是是的，有一些方法可以共享。正在/正在进行改变这种情况的工作，Sun（通过 Apple）在 VM 实例之间共享数据方面做了很多工作。有一个链接在[这里](http://www.javalobby.org/java/forums/t72620.html?start=30)讨论其中的一些内容。

进行任何类型的共享都需要 VM 实现者来完成，作为程序员，您无法做任何事情来实现它。

VM 规范在[这里](http://java.sun.com/docs/books/jvms/second_edition/html/VMSpecTOC.doc.html)，也有一些（较旧的）书籍关于它。您还可以查看非常小的[Kaffe的源代码。](http://www.kaffe.org/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-26T15:03:56.633

如果你想在 JVM 之间共享变量，你可以看看像[Terracotta](http://www.terracotta.org/web/display/orgsite/What+Is+Terracotta)这样的集群产品。它们将自己称为“网络附加内存”，并允许您使用复制技术在 JVM 之间共享对象引用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-26T14:44:15.357

你的假设是正确的。是的，每个 JVM 都是一个单独的进程。您可以通过在运行两个 Java 程序时打开任务管理器来确认这一点（按名称对进程进行排序并查找 java.exe 或 javaw.exe）。

可以使 JVM 相互连接（例如，使用本地套接字），但没有内置任何内容。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-26T15:23:54.077

继续 Kevin 提到的内容，据我所知，没有 JVM 实现允许您在 JVM 实例之间共享静态变量。正如先前的答案（正确地）所述 - 每个 JVM 实例都是它自己的进程。

Terracotta（这是一种集群技术，不是 JVM）允许跨 JVM 进程边界任意共享对象实例——包括共享静态变量。因此，绰号“网络附加内存”。出于所有意图和目的，当在您的 JVM 进程中使用 Terracotta 技术时，所有 VM 中的所有线程的行为就好像它们都在查看单个大型共享堆。（当然需要注意的是，由于这在物理上是不可能的，Terracotta 通过复杂的共享和复制算法来管理它，这些算法涉及网络 io 来移动数据 - 因此有时延迟和吞吐量无法与本机内存访问相比）

Terracotta 网站的 Cookbook 部分中有大量示例 - 我建议您从 Hello [Clustered Instance Recipe](http://www.terracotta.org/web/display/orgsite/Recipe?recipe=helloclusteredinstance)开始，以了解它的工作原理。

# asp.net - 来自 aspx 文件的 Asp.Net 用户控制事件连线

> ID：686080
> 
> 赞同：1
> 
> 时间：2009-03-26T14:39:58.470
> 
> 标签：asp.net, event-handling, controls

我有一个用户控件，它有一个可以订阅的事件。这有效（忽略语法）：

```
protected void Page_Load(object sender, EventArgs e)
{
   ucControl.Event += new Event(ucControl_Event);
} 
```

但是如果我删除了这一行并将事件线放在我的 aspx 页面中，它就不起作用了。前任：

```
<uc1:ucControl id="uc_Control1" runat="server" Event="ucControl_Event" /> 
```

当我在没有 ucControl.Event += 方法的情况下尝试时出现编译错误。

错误是该页面不包含“ucControl_Event”的定义，但它很明显。

如何将事件背后的代码与 aspx 文件匹配？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T14:42:55.110

您的事件处理程序的可见性是什么？如果它是私有的，那么方法 1 有效，方法 2 无效。如果它是受保护的或公开的，两者都有效。

# web-services - 从 WSDL 生成 HTML 文档

> ID：686103
> 
> 赞同：53
> 
> 时间：2009-03-26T14:45:50.203
> 
> 标签：web-services, documentation, wsdl, nant

从 WSDL 生成某种人类可读文档的方法是什么？过去我使用过[WSDL 查看器](http://tomi.vanek.sk/)（由 Tomi Vanek 编写），我对结果很满意，但我对任何可能的替代方案都很感兴趣。

我也听说过[x3sp](http://xml.fiforms.org/xs3p/)，但我还没有尝试过。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-09-24T11:26:36.233

我尝试了几种选择

*   [TechWriter for Web Services](https://techwriter.me/techwriter.aspx) : 非常强大，但 HTML 输出是（见评论）多文件。此外，评论表明它已退役，但情况不再如此。
*   [<oXygen/> XML 编辑器](http://www.oxygenxml.com/xml_editor/wsdl_documentation.html)：它不处理嵌入式模式。
*   [Altova XML Spy](http://www.altova.com/xmlspy/wsdl-editor.html)：它不处理匿名类型。

最后根据我的需要调整 WSDL 查看器。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2011-06-07T13:34:59.600

是的，有一个新的：[wsdl2html](https://github.com/chenjianjx/wsdl2html)。它专注于请求/响应并删除人们不关心的信息。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2011-02-25T13:55:37.217

使用[http://code.google.com/p/wsdl-viewer/](http://code.google.com/p/wsdl-viewer/)和 cygwin 的 xsltproc

```
xsltproc wsdl-viewer.xsl downloaded-wsdl.xml > documetnation.html 
```

奇迹般有效

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2016-05-12T14:11:11.980

这里没有列出，但是[SoapUI](https://www.soapui.org/)有一个有用的 wsdl 文档生成器。

右键单击您的项目并选择“生成文档”。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2014-07-08T10:29:46.683

现在，还有另外一种工具，称为“ [DocFlex/XML WSDLDoc](http://www.filigris.com/docflex-xml/wsdldoc/) ”。

它是一个新的 WSDL/XSD 文档生成器，允许您记录任意数量的 WSDL 和 XML 模式 (XSD) 文件以及它们之间的任何互连。

还有一个选项可以自动包含由 Altova XMLSpy 或 Oxygen XML 生成的 XSD 图。实际上，它们中的任何一个都可以用作动态链接的图表引擎。

**主要特点**

*   通过任意数量的**WSDL/XSD 文件**一起生成单框架（类似 Javadoc）的**HTML 文档。**（如果您有太多输入文件，您可以使用类似 Ant 的路径名模式来选择它们）。
***   处理任意数量的**XML 模式**（连同 WSDL），包括：
    *   以单独的 XSD 文件的形式
    *   嵌入在 WSDL 中的 XML 模式（在`<wsdl:definitons>/<wsdl:types>`元素内）*   处理任何**引用**的WSDL 文件和 XML 模式，特别是：
    *   正确处理在所有涉及的 WSDL/XSD 文件中找到的所有、`<wsdl:import>`、`<xs:import>`元素。`<xs:include>``<xs:redefine>`
    *   自动加载和处理（即包含在文档范围内）所有直接/间接引用的 WSDL/XSD 文件。*   **XSD 组件**的复杂文档（XML 模式文档）：
    *   支持任何 XML 模式设计模式。
    *   可以自动包含由[XMLSpy](http://www.altova.com/xmlspy.html)或[Oxygen XML](http://www.oxygenxml.com)生成的**XSD 图表**，并支持所有图表超链接。*   记录WSDL 定义和 XSD 组件之间 的所有**互连：**
    *   从 WSDL 消息到描述消息数据的 XSD 元素/类型的详细信息的超链接。
    *   在 XSD 元素/类型详细信息中，使用它们的所有 WSDL 定义的列表。
    *   将 XSD 元素/类型的注释复制到使用它们的那些 WSDL 消息（甚至操作）的文档中。*   **无限定制**的可能性。WSDLDoc 实际上是[DocFlex/XML](http://www.filigris.com/docflex-xml/)的模板集，这是一个软件系统，用于从存储在 XML 文件中的任何数据开发和执行高性能文档和报告生成器。**

 ****例子**

这是此类文档的演示（它由单个源文件生成：http: [//developer.ebay.com/webservices/latest/ebaySvc.wsdl](http://developer.ebay.com/webservices/latest/ebaySvc.wsdl)）：

![eBay 交易 API - WSDL 文档](https://i.stack.imgur.com/fICKV.png)

HTML 本身：[http ://www.filigris.com/docflex-xml/wsdldoc/examples/html/ebaySvc/index.html](http://www.filigris.com/docflex-xml/wsdldoc/examples/html/ebaySvc/index.html)

**链接**

[http://www.filigris.com/docflex-xml/wsdldoc/](http://www.filigris.com/docflex-xml/wsdldoc/)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-02-03T14:22:04.270

我刚刚发现安装了 Xml Tools 插件的 Notepad++ 也可以进行 xsl 转换。如果您向它提供前面提到的 wsdl-viewer.xsl 和 wsdl 文件，您将得到一个格式良好的 html。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-15T21:45:54.117

Altova 的 XMLSpy 确实从 WSDL 生成 HTML 文档……但它不是免费的；）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-27T00:18:22.700

我知道这是一个穷人的文档方法，但我已经使用在 Visual Studio 中打开 wsdl 的 XSD 并对其进行打印，并添加了注释和箭头以清楚起见，我们的客户似乎已经喜欢它而无需使用其他工具. 您也可能没有这个，但可以使用来自免费 VPC 或 MSDN 订阅的版本我还使用 BizTalk 架构编辑器来查看 XSD，并使用 snag-it 或其他屏幕捕获应用程序从那里记录它。我会尝试使用你所拥有的！

-布莱恩

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-08-04T16:05:16.333

您可以使用作为 JDK 一部分的“wsimport”并在生成的文件上运行 Javadoc。假设您已放入注释，它将把它们作为文档的一部分。

另一个工具是 Rational Application Developer，它允许您右键单击并生成带有漂亮超链接图片的 HTML 文档。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-09-12T12:23:42.233

您可以使用 iDocIt！记录 WSDL 并将文档导出为 HTML。它是一个开源 Eclipse 插件，可[在此处](http://code.google.com/p/idocit/)下载。

它提供了一种使用主题网格和主题角色创建文档的新方法，但您无需使用它们。您仍然可以将文档创建为纯文本。

# c# - 如何从一个客户端使用多个 WCF 服务

> ID：686112
> 
> 赞同：5
> 
> 时间：2009-03-26T14:47:37.297
> 
> 标签：c#, .net, wcf, wcf-client

我还在学习整个 WCF 的东西，所以请耐心等待。

我拥有的是使用 C# 和 VS 2008 创建的两个自托管服务：
Service # 1 添加两个数字并返回结果。
服务 #2 返回数字的平方。

我希望客户端能够将两个数字发送到服务 1，得到总和，然后将总和发送到服务 2 并得到平方。

我为这两个服务生成了两个代理，并且我可以在它们上使用 Intellisense，所以这部分应该可以工作。

现在如何配置我的 app.config 文件，以便我可以与这两个服务进行通信？现在，每次我尝试这样做时都会遇到异常。

[如果我一次只有一个应用程序文件中的配置，客户端可以正常工作，并尝试只调用该服务器。]

我想这是一个非常愚蠢的问题，答案可能是“以_____方式构造配置文件”，但谷歌似乎根本没有示例/指南。

有人知道怎么做吗？

注意：[从一个客户端客户端使用多个 WCF 服务](https://stackoverflow.com/questions/487662/consume-multiple-wcf-services-from-one-) 虽然听起来像重复不是我想要的。

**编辑：**感谢marc_s，我得到了它的工作

由于这两种服务都在不同的应用程序中运行，我不需要拆分服务器配置文件，但这是我对客户端配置文件所做的：首先使用 SvrUtil.exe 自动生成配置文件，然后以这种方式合并它们：

```
<bindings>
  <wsHttpBinding>

    <binding>
    ...
    </binding>

    <binding>
    ...
    </binding>

  </wsHttpBinding>
</bindings> 
```

...

```
 <endpoint> 
```

...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T14:58:31.390

我意识到您已经要求 App.Config 答案，但认为这可能会有所帮助。我通常会首先以编程方式配置客户端连接，因为它更简单，一旦你开始工作，你可以将它移动到你的 App.Config。

下面是如何配置 WCF 客户端的示例。

```
BasicHttpBinding binding = new BasicHttpBinding();
EndpointAddress address = new EndpointAddress(serverURL);
MyServiceClient myServiceProxy = new MyServiceClient(binding, address); 
```

然后你可以在你的 App.Config 中有类似下面的内容。

```
<client>
    <endpoint address="http://localhost/service1.asmx"
            binding="basicHttpBinding"
            bindingConfiguration="basicHttpBinding" 
            contract="IService1"
            name="Service1" />
    <endpoint address="http://localhost/service2.asmx" 
            binding="basicHttpBinding"
            bindingConfiguration="basicHttpBinding"
            contract="IService2"
            name="Service2" />
</client> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T17:25:02.163

如果您想在不同的端点/端口上运行这两个服务，请执行以下操作：

**服务器端：**

```
<service name="Service1">
    <endpoint address="http://localhost:8001/service1.asmx"
            binding="basicHttpBinding"
            contract="IService1" />
</service>
<service name="Service2">
    <endpoint address="http://localhost:8002/service2.asmx" 
            binding="basicHttpBinding"
            contract="IService2" />
</service> 
```

**客户端：**

```
<client>
    <endpoint address="http://localhost:8001/service1.asmx"
            binding="basicHttpBinding"
            contract="IService1"
            name="Service1" />
    <endpoint address="http://localhost:8002/service2.asmx" 
            binding="basicHttpBinding"
            contract="IService2"
            name="Service2" />
</client> 
```

这应该会在服务器上为您提供两个单独的端点和一个将与两者对话的客户端。

马克

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T14:55:52.253

你只是有端点冲突吗？例如，请确保两个服务未配置为侦听相同的端口号。如果您可以发布您的配置文件（或它的净化版本），那将有所帮助。

# c# - 就内部/本地/匿名类而言，Java 和 C# 之间的根本区别是什么？

> ID：686114
> 
> 赞同：5
> 
> 时间：2009-03-26T14:48:16.860
> 
> 标签：c#, java, class

**Java 和 C# 在内部/本地/匿名类**方面的根本区别是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-26T14:52:15.307

C# 没有 Java 内部类的等价物——它只有嵌套类型（如 Java 的“静态”嵌套类）。

访问规则略有不同——在 Java 中，外部类可以访问其嵌套类的私有成员，反之亦然。在 C# 中，嵌套类可以访问外部类的私有成员，但反之则*不行*。

C# 没有像 Java 这样的匿名内部类，但它*确实*有匿名方法和 lambda 表达式，这是实现*大多数*匿名内部类通常使用的更简洁的方法。这两种机制的变量捕获是不同的——有关更多详细信息，请参阅[我关于闭包的文章。](http://csharpindepth.com/Articles/Chapter5/Closures.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T14:53:36.503

在我看来，最大的区别是它们（java 中的匿名类与 C# 中的匿名方法）如何处理捕获。在java中，它捕获变量的当前**值**（原始值和捕获的值然后被隔离）。在 C# 中，您捕获变量本身。这是双刃剑，可能会导致问题 - 但正确使用时会非常强大。

# java - 正则表达式查找分隔符之间包含的字符串

> ID：686117
> 
> 赞同：0
> 
> 时间：2009-03-26T14:48:54.970
> 
> 标签：java, regex, csv

在本文中：

```
text text text [[st: aaa bbb ccc ddd eee fff]] text text
text text [[st: ggg hhh iii jjj kkk
lll mmm nnn]] 文本 文本 文本

```

我正在尝试获取 [[st: 并以 ]] 结尾的文本

我的程序应该输出：

```
aaa bbb ccc ddd eee fff (第一场比赛)
ggg hhh iii jjj kkk \n lll mmm nnn(第二场比赛)

```

但我只能让它返回第一个 [[st: 和最后一个 ]]，所以只有一个匹配而不是两个。有任何想法吗？

这是我的代码：

```
package com.s2i.egc.test;

import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class TestRegex {

    /**
     * @param args
     */
    public static void main(String[] args) {

        String bodyText = "text text text [[st: aaa bbb ccc ddd eee fff]] text text text text [[st: ggg hhh iii jjj kkk\n lll mmm nnn]] text text text";

        String currentPattern = "\\[\\[st:.*\\]\\]";

        Pattern myPattern = Pattern.compile(currentPattern, Pattern.DOTALL);

        Matcher myMatcher = myPattern.matcher(bodyText);

        int i = 1;

        while (myMatcher.find()) {
          String match = bodyText.substring(myMatcher.start() + 5, myMatcher.end() - 3);
          System.out.println(match + " (match #" + i + ")");
          i++;
        }                           

    }

} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T14:54:27.110

量词 *（0 或更多）默认是贪婪的，所以它匹配第二个 ]]。

尝试更改为不情愿的模式匹配：

```
String currentPattern = "\\[\\[st:.*?\\]\\]"; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T14:52:59.033

您应该对星号使用惰性模式

```
.* 
```

改用：

```
"\\[\\[st:.*?\\]\\]" 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T15:02:55.497

为了完整起见，没有非贪婪星，您可以匹配开头的 [[st:，后跟任何非] 字符，可能包括 ] 字符后跟非] 字符的序列，最后是 ]]：

```
\[\[st:([^\]]*(?:\][^\]]+)*)\]\] 
```

# c++ - C++ 有顺序搜索功能吗？

> ID：686131
> 
> 赞同：1
> 
> 时间：2009-03-26T14:53:06.973
> 
> 标签：c++, search

我有一个小的未排序数组，我想找到特定值的**索引。**C++ 是否为此内置了顺序搜索功能，还是每次出现循环时您都自己编写循环？

我专门使用 C 风格的数组，如：

```
std::string arr[5] = { "EVEN", "ODD", "NONE", "MARK", "SPACE" }; 
```

我需要用户提供的值的索引。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-26T14:55:22.723

[`std::find()`](http://en.cppreference.com/w/cpp/algorithm/find)从 STL-*算法*库或`find()`特定容器的 - 方法中使用。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-26T14:55:58.167

`std::find()`应该管用：

```
#include <stdio.h>
#include <algorithm>
#include <string>

using std::string;

std::string arr[5] = { "EVEN", "ODD", "NONE", "MARK", "SPACE" };

int main() {

    string* pArrEnd = arr + sizeof( arr)/sizeof(arr[0]);

    string* pFound = std::find( arr, pArrEnd, "MARK");

    if (pFound == pArrEnd) {
        printf( "not found\n");
    }
    else {
        printf( "%s was found at index %d\n", pFound->c_str(), pFound - arr);
        printf( "or using STL: %d\n", std::distance( arr, pFound));
    }

    return 0;
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-26T15:11:42.420

您可以在除 STL 容器之外的容器上使用 STL 算法。例如，您可以在 C 样式数组中使用 std::find() ：

```
// alloc the array
static const size_t numItems = 100000;
int * items = new int[numItems];

// fill the array
for( size_t n = 0; n < numItems; ++n )
    items[n] = n;

// find 42 using std::find()
int* found = std::find(&items[0], &items[numItems], 42);
if( found == &items[numItems] )
{
    // this is one past the end, so 42 was not found
    items[0] = 42;
}
else
{
    // we found the first instance of 42 at this location
    // change it to 43
    *found = 43;
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-26T15:11:36.257

我想你需要索引而不是迭代器。

```
int main()
{
    // for c++ vector
    typedef int Element;
    typedef std::vector<Element> CppVector;

    CppVector v;
    v.push_back( 2 );
    v.push_back( 4 );
    v.push_back( 8 );
    v.push_back( 6 );

    const Element el = 4;

    CppVector::const_iterator it = std::find( v.begin(), v.end(), el );
    if ( it == v.end() )
    {
        std::cout << "there is no such element" << std::endl;
    }
    else
    {
        const CppVector::size_type index = it - v.begin();
        std::cout << "index = " << index << std::endl;
    }

    // for C array
    typedef Element CVector[4];
    CVector cv;
    cv[0] = 2;
    cv[1] = 4;
    cv[2] = 8;
    cv[3] = 6;

    const std::size_t cvSize = sizeof( cv ) / sizeof( Element );

    std::cout << "c vector size = " << cvSize << std::endl;

    const Element* cit = std::find( cv, cv + cvSize, el );
    const std::size_t index = cit - cv;

    if ( index >= cvSize )
        std::cout << "there is no such element" << std::endl;
    else
        std::cout << "index = " << index << std::endl;
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-26T15:01:07.953

除了`std::find`已经提到的 STL 可能性 ( ) 之外，还有 POSIX 函数`lsearch`（具有 c 语义）。

# c# - 在没有焦点的情况下在 C# 中打开表单

> ID：686132
> 
> 赞同：11
> 
> 时间：2009-03-26T14:53:32.370
> 
> 标签：c#, winforms, forms, focus

我正在创建一些始终处于顶部的吐司作为表单，当我打开它们时，我希望它们在打开时不会从其他表单中转移注意力。我怎样才能做到这一点？

谢谢

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-26T14:57:40.550

```
protected override bool ShowWithoutActivation
{
    get
    {
        return true;
    }
} 
```

在您的表单代码中覆盖此属性，它应该为您解决问题。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2012-05-23T20:28:04.787

我花了几分钟使用上面的亚当和亚伦的信息，但我终于让它为我工作了。我必须做的一件事是确保表单的 Top Most 属性设置为 false。这是我使用的代码...

```
 protected override bool ShowWithoutActivation { get { return true; } }

    protected override CreateParams CreateParams
    {
        get
        {
            //make sure Top Most property on form is set to false
            //otherwise this doesn't work
            int WS_EX_TOPMOST = 0x00000008;
            CreateParams cp = base.CreateParams;
            cp.ExStyle |= WS_EX_TOPMOST;
            return cp;
        }
    } 
```

# python - Python中的URL树遍历器？

> ID：686147
> 
> 赞同：3
> 
> 时间：2009-03-26T14:57:13.360
> 
> 标签：python, tree, beautifulsoup, directory-walk

对于显示文件树的 URL，例如[Pypi 包](http://pypi.python.org/packages/2.5)，是否有一个小的实体模块来遍历 URL 树并列出它`ls -lR`？
我收集（纠正我）在 html`<A`属性中没有文件属性、链接类型、大小、日期......的标准编码，
因此在流沙上构建一个可靠的 URLtree 模块很困难。
但是这个轮子（ ）肯定`Unix file tree -> html -> treewalk API -> ls -lR or find`已经完成了吗？
（那里似乎有几个蜘蛛/网络爬虫/刮板，但到目前为止它们看起来很丑陋和临时，尽管使用 BeautifulSoup 进行解析）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T19:21:33.507

Apache 服务器非常常见，它们有一种比较标准的列出文件目录的方式。

这是一个足够简单的脚本，可以做你想做的事，你应该能够让它做你想做的事。

用法：python list_apache_dir.py

```
import sys
import urllib
import re

parse_re = re.compile('href="([^"]*)".*(..-...-.... ..:..).*?(\d+[^\s<]*|-)')
          # look for          a link    +  a timestamp  + a size ('-' for dir)
def list_apache_dir(url):
    try:
        html = urllib.urlopen(url).read()
    except IOError, e:
        print 'error fetching %s: %s' % (url, e)
        return
    if not url.endswith('/'):
        url += '/'
    files = parse_re.findall(html)
    dirs = []
    print url + ' :' 
    print '%4d file' % len(files) + 's' * (len(files) != 1)
    for name, date, size in files:
        if size.strip() == '-':
            size = 'dir'
        if name.endswith('/'):
            dirs += [name]
        print '%5s  %s  %s' % (size, date, name)

    for dir in dirs:
        print
        list_apache_dir(url + dir)

for url in sys.argv[1:]:
    print
    list_apache_dir(url) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-03T15:37:12.480

[其他人推荐 BeautifulSoup，但使用lxml](http://codespeak.net/lxml/)更好。尽管它的名字，它也用于解析和抓取 HTML。它比 BeautifulSoup 快得多。如果您不想学习 lxml API，它也有适用于 BeautifulSoup 的兼容性 API。

[Ian Blicking 同意](http://blog.ianbicking.org/2008/12/10/lxml-an-underappreciated-web-scraping-library/)。

没有理由再使用 BeautifulSoup，除非您使用的是 Google App Engine 或其他任何不纯 Python 的东西。

它也有 CSS 选择器，所以这种事情是微不足道的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-03T08:49:42.220

事实证明，像这样的 BeautifulSoup 单行程序可以将 <table> 行转换为 Python ——

```
from BeautifulSoup import BeautifulSoup

def trow_cols( trow ):
    """ soup.table( "tr" ) -> <td> strings like
        [None, u'Name', u'Last modified', u'Size', u'Description'] 
    """ 
    return [td.next.string for td in trow( "td" )]

def trow_headers( trow ):
    """ soup.table( "tr" ) -> <th> table header strings like
        [None, u'Achoo-1.0-py2.5.egg', u'11-Aug-2008 07:40  ', u'8.9K'] 
    """ 
    return [th.next.string for th in trow( "th" )]

if __name__ == "__main__":
    ...
    soup = BeautifulSoup( html )
    if soup.table:
        trows = soup.table( "tr" )
        print "headers:", trow_headers( trows[0] )
        for row in trows[1:]:
            print trow_cols( row ) 
```

与上面 sysrqb 的单行正则表达式相比，这...更长；谁说

> “您可以一直解析一些 html，或者在某些时候解析所有 html，但不能……”

# php - 删除 cookie

> ID：686155
> 
> 赞同：307
> 
> 时间：2009-03-26T14:59:15.990
> 
> 标签：php, cookies

当我想删除 Cookie 时，我会尝试

```
unset($_COOKIE['hello']); 
```

我在 Firefox 的 cookie 浏览器中看到该 cookie 仍然存在。我怎样才能真正删除cookie？

* * *

## 回答 #1

> 赞同：339
> 
> 时间：2013-11-14T07:54:04.317

你可以试试这个

```
if (isset($_COOKIE['remember_user'])) {
    unset($_COOKIE['remember_user']); 
    setcookie('remember_user', null, -1, '/'); 
    return true;
} else {
    return false;
} 
```

* * *

## 回答 #2

> 赞同：301
> 
> 时间：2009-03-26T15:02:51.147

将值设置为 "" 并将到期日期设置为昨天（或过去的任何日期）

```
setcookie("hello", "", time()-3600); 
```

然后 cookie 将在下次页面加载时过期。

* * *

## 回答 #3

> 赞同：246
> 
> 时间：2012-12-22T08:34:10.027

删除 cookie 的一种干净方法是清除`$_COOKIE`值和浏览器 cookie 文件：

```
if (isset($_COOKIE['key'])) {
    unset($_COOKIE['key']);
    setcookie('key', '', time() - 3600, '/'); // empty value and old timestamp
} 
```

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2013-07-15T22:16:13.537

要可靠地删除 cookie，将其设置为在过去的任何时间过期是不够的，这是由您的 PHP 服务器计算的。这是因为客户端计算机可以而且经常确实有与您的服务器不同的时间。

最佳实践是用一个空白 cookie 覆盖当前 cookie，该 cookie在 epoch（1970 年 1 月 1 日 00:00:00 UTC）之后的一秒后过期~~，如下所示：~~

```
setcookie("hello", "", 1); 
```

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2009-03-26T15:04:00.753

这将在您的代码中取消设置 cookie，但由于 $_COOKIE 变量在每次请求时都会刷新，它只会在下一页请求时返回。

要真正摆脱 cookie，请将过期日期设置为过去：

```
// set the expiration date to one hour ago
setcookie("hello", "", time()-3600); 
```

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2014-05-28T21:18:46.770

我在我的代码中遇到了同样的问题，发现这是一个 cookie 路径问题。查看此堆栈溢出帖子：[无法删除 php set cookie](https://stackoverflow.com/questions/6187132/cant-delete-php-set-cookie)

我已经使用路径值“/”设置了 cookie，但是当我尝试清除它时没有任何路径值，所以它没有清除。所以这是一个有效的例子：

设置cookie：

```
$cookiePath = "/";
$cookieExpire = time()+(60*60*24);//one day -> seconds*minutes*hours
setcookie("CookieName",$cookieValue,$cookieExpire,$cookiePath); 
```

清除 cookie：

```
setcookie("cookieName","", time()-3600, $cookiePath);
unset ($_COOKIE['cookieName']); 
```

希望有帮助。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-03-26T15:03:34.733

如果您将 cookie 设置为过去过期，浏览器会将其删除。请参阅[php.net 上的 setcookie() 删除示例](http://uk3.php.net/manual/en/function.setcookie.php)

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2009-03-26T15:03:20.553

请参阅PHP 文档中标记为“[示例 #2 setcookie() 删除示例”的示例。](http://ca.php.net/manual/en/function.setcookie.php)要从浏览器中清除 cookie，您需要告诉浏览器 cookie 已过期......然后浏览器将删除它。`unset`正如你所使用的那样，它只是从 COOKIE 数组中删除了 'hello' cookie。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2016-04-09T06:07:36.287

这就是 PHP v7 setcookie() 代码的工作方式：

```
<?php
    setcookie('user_id','');
    setcookie('session','');
?> 
```

在嗅探端口 80 时，从 tcpdump 的输出中，服务器向客户端（浏览器）发送以下 HTTP 标头：

```
Set-Cookie: user_id=deleted; expires=Thu, 01-Jan-1970 00:00:01 GMT; Max-Age=0
Set-Cookie: session=deleted; expires=Thu, 01-Jan-1970 00:00:01 GMT; Max-Age=0 
```

在以下请求中观察数据包，浏览器不再在标头中发送这些 cookie

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2019-11-12T08:59:04.263

只需将 cookie 的值设置`false`为即可取消设置，

```
setcookie('cookiename', false); 
```

PS：-这是最简单的方法。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2013-03-01T23:16:14.970

要删除 cookie，您只需将值设置为 NULL：

“如果您为过期时间、路径或域设置了具有非默认值的 cookie，则在删除 cookie 时必须再次提供相同的值，以便正确删除 cookie。” 引用自“学习 PHP5”一书。

所以这段代码应该可以工作（对我有用）：

设置cookie： `setcookie('foo', 'bar', time() + 60 * 5);`

删除 cookie： `setcookie('foo', '', time() + 60 * 5);`

但是我注意到每个人都将到期日期设置为过去，这是必要的，为什么？

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2018-09-13T16:11:54.723

如果您想从所有当前域中完全删除 cookie，那么下面的代码肯定会对您有所帮助。

```
unset($_COOKIE['hello']);
setcookie("hello", "", time() - 300,"/"); 
```

此代码将从您的所有域中完全删除 cookie 变量，即；“ /” - 它表示cookie变量的值全部设置为所有域，而不仅仅是当前域或路径。time() - 300 表示它设置为以前的时间，因此它将过期。

就这样被彻底删除了。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2013-11-28T20:14:16.753

要删除所有 cookie，您可以编写：

```
foreach ($_COOKIE as $key => $value) {
    unset($value);
    setcookie($key, '', time() - 3600);
} 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2014-03-02T01:02:25.487

我知道这个主题创建已经有很长时间了，但是我在这个解决方案中看到了一个小错误（我可以这样称呼它，因为它是一个细节）。我同意更好的解决方案可能是这个解决方案：

```
if (isset($_COOKIE['remember_user'])) {
            unset($_COOKIE['Hello']);
            unset($_COOKIE['HelloTest1']);
            setcookie('Hello', null, -1, '/');
            setcookie('HelloTest1', null, -1, '/');
            return true;
        } else {
            return false;
        } 
```

但是，在目前的情况下，您会在未设置功能起作用的所有情况下删除 cookie，并在未设置功能不起作用的情况下立即创建新的过期 cookie。

这意味着即使未设置功能起作用，它仍然会在计算机上保存 2 个 cookie。从逻辑的角度来看，所要求的目标是在可能的情况下删除 cookie，如果确实不是，则使其过期；获得“最干净”的结果。

所以，我认为我们最好应该这样做：

```
if (isset($_COOKIE['remember_user'])) {
            setcookie('Hello', null, -1, '/');
            setcookie('HelloTest1', null, -1, '/');
            unset($_COOKIE['Hello']);
            unset($_COOKIE['HelloTest1']);
            return true;
        } else {
            return false;
        } 
```

感谢，并有一个愉快的一天 ：）

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2014-07-05T12:53:20.037

如果要“删除” cookie，只需将过期日期设置为一小时前，如下所示：

```
setcookie ("TestCookie", "", time() - 3600); 
```

或者

```
setcookie ("TestCookie", "", time() - 3600, "/~rasmus/", "example.com", 1); 
```

来源：[http ://www.php.net/manual/en/function.setcookie.php](http://www.php.net/manual/en/function.setcookie.php)

您应该`filter_input()`对访问者可以输入/操作的所有全局变量使用该函数，如下所示：

```
$visitors_ip = filter_input(INPUT_COOKIE, 'id'); 
```

您可以在此处阅读更多信息：[http](http://www.php.net/manual/en/function.filter-input.php) ://www.php.net/manual/en/function.filter-input.php和此处：[http ://www.w3schools.com/php/func_filter_input.asp](http://www.w3schools.com/php/func_filter_input.asp)

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2015-08-22T15:02:30.953

```
$cookie_name = "my cookie";
$cookie_value = "my value";
$cookie_new_value = "my new value";

// Create a cookie,
setcookie($cookie_name, $cookie_value , time() + (86400 * 30), "/"); //86400 = 24 hours in seconds

// Get value in a cookie,
$cookie_value = $_COOKIE[$cookie_name];

// Update a cookie,
setcookie($cookie_name, $cookie_new_value , time() + (86400 * 30), "/");

// Delete a cookie,
setcookie($cookie_name, '' , time() - 3600, "/"); //  time() - 3600 means, set the cookie expiration date to the past hour. 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2015-11-29T10:46:06.837

这很简单！

```
setcookie("cookiename", "cookievalue", 1); 
```

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2018-11-18T11:07:42.640

当您输入`0`时间时，您的意思是浏览器的**“现在”**（从现在开始的 +0 实际上是现在），它会删除 cookie。

```
setcookie("key", NULL, 0, "/"); 
```

我在 chrome 浏览器中检查了它，它给了我：

```
Name: key
Content: Deleted
Created: Sunday, November 18, 2018 at 2:33:14 PM
Expires: Sunday, November 18, 2018 at 2:33:14 PM 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-03-26T17:43:54.770

您可以根据 cookie 值设置会话变量

```
session_start();

if(isset($_COOKIE['loggedin']) && ($_COOKIE['loggedin'] == "true") ){
$_SESSION['loggedin'] = "true";
}

echo ($_SESSION['loggedin'] == "true" ? "You are logged in" : "Please Login to continue"); 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2015-02-16T10:53:38.133

您可以简单地使用此自定义功能：

```
function unset_cookie($cookie_name) {
    if (isset($_COOKIE[$cookie_name])) {
        unset($_COOKIE[$cookie_name]);
        setcookie($cookie_name, null, -1);
    } else { return false; }
} 
```

如果要删除 $_COOKIE['user_account']。
只需使用：

```
unset_cookie('user_account'); 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2021-12-22T04:28:02.783

我发现在 Chrome 中，除非您在 cookie 中定义最后三个参数，否则无法取消设置 cookie... 域，它是安全的且仅 http...

```
if (isset($_COOKIE['user_id'])) {
unset($_COOKIE['user_id']); 
setcookie("user_id", "", time() - 3600, "/", 'yourdomain.com',true,true);
header('Location: /');
} else {
/* other code here */
} 
```

这就是我让它为我工作的方式。阅读文档：[关于官方 PHP 站点中的 cookie 的所有信息](https://www.php.net/manual/es/function.setcookie.php)

* * *

## 回答 #22

> 赞同：-2
> 
> 时间：2016-07-22T07:59:47.400

您必须在服务器中使用 php 删除 cookie，还必须在浏览器中使用 js 删除 cookie。（它们是用 php 制作的，但 cookie 文件也在浏览器客户端中）：

一个例子：

```
if ($_GET['action'] == 'exit'){
            // delete cookies with js and then in server with php:
            echo '
            <script type="text/javascript">
                var delete_cookie = function(name) {
                     document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:01 GMT;";
                };
                delete_cookie("madw");
                delete_cookie("usdw");
            </script>
            ';
unset($_COOKIE['cookie_name']);
unset($_COOKIE['cookie_time']); 
```

* * *

## 回答 #23

> 赞同：-5
> 
> 时间：2016-06-24T20:43:47.257

你们中的大多数人都忘记了这只能在本地机器上工作。在域上，您将需要像此示例这样的模式。

```
setcookie("example_cookie", 'password', time()-3600, "/", $_SERVER['SERVER_NAME']); 
```

# jquery - 如何从 jQuery 的 tr 标签中的最后一个 td 获取值？

> ID：686161
> 
> 赞同：0
> 
> 时间：2009-03-26T15:00:32.103
> 
> 标签：jquery

当我单击表格行时，我有一个表格，我可以使用它来获取该行，但是如何从 tr 标签中的最后一个 td 获取值？

```
$(this); // equals my hovered tr row 
```

我想到了这样的事情：

```
$(this:last-child).text(); 
```

或者应该是这样的：

```
$(this + ":last-child").text(); or with .html(); 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-26T15:03:06.230

您可以尝试：

```
$(this).find(':last-child').text(); 
```

或者 ：

```
$(':last-child', this).text(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T15:03:05.107

```
$('#' + this.id + ' :last-child').text(); 
```

是相同的：

```
$('#idOfMyTr :last-child').text(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-03-13T09:39:39.657

```
console.log($( "table#hello td:nth-last-child(1)" ).text())
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<table class="masteries" id='hello'>
        <tr class="p0">
            <td>1</td>
            <td>2</td>
            <td>3,</td
        </tr>
        <tr class="p4">
            <td>1</td>
            <td>2</td>
            <td>3,</td
        </tr>
        <tr class="p8">
            <td>1</td>
            <td>2</td>
            <td>3,</td
        </tr>
    <table>
```

# wpf - 如何在 WPFToolkit DataGrid 中获取当前单元格的绑定值

> ID：686165
> 
> 赞同：2
> 
> 时间：2009-03-26T15:01:21.180
> 
> 标签：wpf, data-binding

我想更改包含负数的单元格的前景色，但我不知道如何指定可以让我使用的 DataTrigger。我正在使用这样的东西：

```
<Style x:Key="NumberCellStyle" BasedOn="{StaticResource CellStyle}">
    <Style.Triggers>
        <DataTrigger Binding="{Binding Converter={StaticResourceExtension SignConverter}}" Value="-1">
            <Setter Property="TextBlock.Foreground" Value="Red"/> 
        </DataTrigger>
    </Style.Triggers>
</Style> 
```

但是在 SignConverter 转换器中，我得到了整个 ViewModel 而不是我想要转换的数值。我希望这可以在整个应用程序中使用，而无需为每个绑定指定正确的路径。

非常感谢你！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-28T17:22:17.333

更好的方法，编写自定义列。

以下代码适用于处于相同情况的任何人：

```
public class DataGridDecimalColumn : DataGridTextColumn
{
    Binding               foregroundBinding;
    DecimalBrushConverter brushConverter = new DecimalBrushConverter {
        NegativeBrush = Brushes.Red, 
        PositiveBrush = Brushes.Black, 
        ZeroBrush     = Brushes.Black,
    };

    protected override FrameworkElement 
    GenerateElement(DataGridCell cell, object dataItem)
    {
        var element = base.GenerateElement(cell, dataItem) as TextBlock;
        element.SetBinding(TextBlock.ForegroundProperty, GetForegroundBinding());
        return element;
    }

    Binding
    GetForegroundBinding()
    {
        if(foregroundBinding == null) {
            var binding       = (Binding)Binding;
            foregroundBinding = new Binding {
                Path      = binding.Path,
                Converter = BrushConverter,
            };
        }
        return foregroundBinding;
    }

    public DecimalBrushConverter 
    BrushConverter
    {
        get { return brushConverter; }
        set { brushConverter = value; }
    }
} 
```

DecimalBrushConverter 简单需要小数吗？并根据其值将其转换为指定的画笔之一。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T15:05:28.767

你也在应用什么控制风格？听起来你应用它的任何东西都没有为自己设置任何特定的绑定，所以它只是继承了它的父母的价值，最终成为你的`ViewModel`实例。

**更新**：根据评论，我认为您需要在样式的绑定表达式中指定一个路径。由于没有指定路径，它只使用 current `DataContext`，最终成为整个`ViewModel`实例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T16:53:08.113

好的，我没有找到解决原始问题的方法，但我将通过使用 DataGridTemplateColumn 和模板来解决它，这些模板根据绑定到它们的值正确设置前景色。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-30T11:31:27.670

您将如何获取此代码来读取 DataGrid 本身的 IsSelected 属性？我尝试了以下代码，但无法弄清楚如何将 bool 值获取到 ConverterParameter，其中 DecimalBrushConverter 读取参数并在 isSelected==true 时提供 SelectedBrush。

公共类 DataGridDecimalColumn : DataGridTextColumn { 私有只读 DecimalBrushConverter _brushConverter = new DecimalBrushConverter { NegativeBrush = Brushes.Red, PositiveBrush = Brushes.Black, ZeroBrush = Brushes.Black, SelectedBrush = Brushes.White };

```
 private Binding _foregroundBinding;

    private DecimalBrushConverter BrushConverter
    {
        get { return _brushConverter; }
    }

    protected override FrameworkElement GenerateElement(DataGridCell cell, object dataItem)
    {
        var element = base.GenerateElement(cell, dataItem) as TextBlock;

        if (element != null)
            element.SetBinding(TextBlock.ForegroundProperty, GetForegroundBinding());

        return element;
    }

    private Binding GetForegroundBinding()
    {
        if (_foregroundBinding == null)
        {
            var binding = (Binding) Binding;
            var bindingToRow = new Binding
                                   {
                                       Path = new PropertyPath("IsSelected"),
                                       RelativeSource=new RelativeSource(RelativeSourceMode.FindAncestor,typeof(DataGridRow),1)
                                   };
            _foregroundBinding = new Binding
                                     {
                                         Path = binding.Path,
                                         Converter = BrushConverter,
                                         ConverterParameter = bindingToRow
                                     };
        }
        return _foregroundBinding;
    }
} 
```

# c# - 将网格数据转换为 Excel 时出错

> ID：686177
> 
> 赞同：-2
> 
> 时间：2009-03-26T15:05:13.730
> 
> 标签：c#, .net, asp.net, excel, gridview

这是代码：

```
TextWriter writer = null;

HttpResponse response = new HttpResponse(writer);

response.ClearContent();
response.AddHeader("content-disposition", "attachment;filename=" + filename + ".xls");
// response.ContentType = "application/ms-excel";
StringWriter stringWriter = new StringWriter();
HtmlTextWriter htmlTextWriter = new HtmlTextWriter(stringWriter);
HtmlForm htmlForm = new HtmlForm();
GridView1.Parent.Controls.Add(htmlForm);
htmlForm.Attributes["runat"] = "server";
htmlForm.Controls.Add(GridView1);
htmlForm.RenderControl(htmlTextWriter);

response.Write(stringWriter.ToString()); 
```

如果我运行此代码，它会引发 NullReferenceException。我在业务逻辑层中使用了这些代码

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T15:28:36.093

当您点击该`response.Write`行时，您会遇到运行时错误，因为您将 null 作为响应流传入：

```
TextWriter writer = null;
HttpResponse response = new HttpResponse(writer); 
```

您发布的代码非常草率。我建议您从头开始重写该方法。如果你不这样做，一旦你通过了这个错误，你可能会遇到其他运行时错误。

# iphone - iPhone SDK：使用新行插入和更新 UITableView

> ID：686179
> 
> 赞同：2
> 
> 时间：2009-03-26T15:05:26.583
> 
> 标签：iphone, uitableview, sdk

我有一个 tableView 需要在从另一个视图插入信息后更新。如果我执行

```
[self.tableView reloadData]; 
```

下一次我在另一个视图中插入更多信息并尝试重新加载表时，所有当前可见的行都会重复。

换句话说，当我启动应用程序时，我有：

```
tableView:
    Row 1
    Row 2 
```

然后我提交了一些信息，这些信息也会显示在表格中，突然间我有了：

```
tableView
    Row 1
    Row 2
    Row 3 <- info I just added
    Row 1
    Row 2 
```

我的 numberOfRowsInSection 实现如下所示：

```
- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {
    return [ItemsController sharedItemsController].count;
} 
```

我的 cellForRowAtIndexPath 实现如下所示：

```
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {
    ItemsController* controller = [ItemsController sharedItemsController];
    NSMutableArray* recentItems = controller.listOfRecentItems;

    CustomCell *cell = nil;
    NSUInteger row = [indexPath row];

    if( row < recentItems.count )
    {
        Items*  item = [recentItems objectAtIndex:row];
        if( recentCellData == nil )
            recentCellData = [[NSMutableDictionary alloc] initWithCapacity:[indexPath length]];

        if( [recentCellData count] > 0 )
            cell = [recentCellData objectForKey:[NSString stringWithFormat:@"%d", row]];
        if (cell == nil) {
            UIViewController * view1 = [[UIViewController alloc] initWithNibName:@"CustomCell" bundle:nil];

            cell = (CustomCell*)[view1 view];

            [recentCellData setObject:cell forKey:[NSString stringWithFormat:@"%d",row]];
        }

       // do some other stuff here
    }
    // Set up the cell
    return cell;
} 
```

更新表并避免重复当前可见行的最佳方法是什么。提前感谢所有帮助！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T15:18:37.867

错误不在于您如何重新加载表，而在于您如何向其提供数据。在数据源方法和添加新行的方法中设置断点以查看哪里出错了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T16:22:57.163

`tableView:numberOfRowsinSection:`如果返回，您最终只会得到五个项目`5`。这就是您问题的简单答案，但我在这里看到了其他问题。我想知道你为什么要进行这个测试：`row < recentItems.count`。那个数组和 一样`[ItemsController sharedItemsController].count`吗？您确实需要为这两种方法使用相同的数组。

（另外，这不是语法错误，但您不应该将属性语法用于未声明为属性的事物。您应该`[recentItems count]`改为编写。）

我也对您用于设置单元格的代码感到困惑。细胞是可重复使用的。也就是说，您创建一个单元格，然后在每次执行`tableView:cellForRowAtIndexPath:`. 您的代码为列表中的每个项目创建一个单元格。这是非常低内存效率的，并且如果您像这样在内存中保留大量单元格，则可能会由于 iPhone 上的内存不足而使您的程序崩溃。

推荐的方法是调用`dequeueReusableCellWithIdentifier:`. 如果返回，那么您使用初始化程序`nil`设置一个单元格。`initWithFrame:reuseIdentifier:`表格视图非常智能，只会在需要时要求您重绘单元格。

你的`recentCellData`字典在我看来也很不稳定。如果您在带有 key 的项目之后插入一个项目`@"2"`怎么办？所有带有 key `@"3"`onward 的项目都需要向右移动一个元素才能按您期望的方式工作。这是大量的簿记，对我来说似乎相当不必要。如果你真的需要这样的东西——而且要清楚，我认为你不需要——你为什么不使用`NSMutableArray`更容易使用的 an 呢？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T15:52:09.937

我在上面添加了更多信息。

# php - 具有用户管理功能的网站的最佳起点

> ID：686185
> 
> 赞同：3
> 
> 时间：2009-03-26T15:08:03.740
> 
> 标签：php, user-management, login-script

我即将开始创建一个具有标准用户管理（客户登录和处理（更改客户详细信息等）+我自己的功能的新网站。我正在寻找最有效的方法。我知道 PHP/CSS/ jQuery相当不错。

我以 Drupal 为起点，发现它对我的需求来说太麻烦了。CodeIgniter 和 PHPcake 似乎效率不高，因为我会花时间学习平台而不是开发（我很想这样做，但目前不是）。

看来我需要的是一个简单地处理用户功能的 PHP 站点框架。令人惊讶的是我找不到一个。

您能否推荐一个起点，例如我可以轻松删除用户管理部分的开源网站代码？还是比学习新平台/框架更直接的选择？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T15:39:29.860

老实说，要开始使用像 CodeIgniter 这样的框架，您不需要超过 5 到 15 分钟的学习时间（CI“骨架”非常容易做到）。

是的，它可能有很多工具/助手/库，但在大多数情况下，学习曲线非常浅。

至于用户功能，有几个用户制作的库可能适合您的需求 - 可以在此处找到包含详细功能的完整列表：[what-c​​ode-igniter-authentication-library-is-best](https://stackoverflow.com/questions/346980/what-code-igniter-authentication-library-is-best)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T15:36:58.977

老实说，如果您要使用现有平台之一，您将不得不努力学习它的架构，然后适应它以进一步开发它。

此外，用户管理是一种痛苦，但实际上不应该花那么长时间来实施。如果这就是你想要的，我会说你自己的，因为那样你就会对它更加熟悉。别人写的任何东西，你都必须学习。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T18:29:27.063

如果您想要的只是授权，请从[Pear::Auth](http://pear.php.net/package/Auth)开始。它可能比您正在寻找的要少一点，但这可能比比您想要的更重的解决方案更可取。

# .net - 我将如何修改此正则表达式以提取英国邮政编码的左右部分？

> ID：686187
> 
> 赞同：2
> 
> 时间：2009-03-26T15:08:49.337
> 
> 标签：.net, regex

我有一个用于验证英国邮政编码的正则表达式，但现在我想提取代码的组成部分，但我很困惑。对于那些不知道英国邮政编码示例的人，“WC1 1AA”、“WC11 1AA”和“M1 1AA”。

`\s{0,}`下面的正则表达式（为格式化道歉）处理左右部分之间缺少空格（这是位）并且仍然有效（这很棒）。

```
(?:(?:A[BL]|B[ABDHLNRST]?|C[ABFHMORTVW]|D[ADEGHLNTY]|E[CHNX]?|F[KY]|G[LUY]?|H[ADGPRSUX]|I[GMPV]|JE|K[ATWY]|L[ADELNSU]?|M[EKL]?|N[EGNPRW]?|O[LX]|P[AEHLOR]|R[GHM]|S[AEGKLMNOPRSTWY]?|T[ADFNQRSW]|UB|W[ACDFNRSV]?|YO|ZE)\d(?:\d|[A-Z])?\s{0,}\d[A-Z]{2}) 
```

我现在希望能够提取左侧和右侧，并且我知道括号用于此目的，但是那里已经有括号并且正则表达式规范不容易阅读。所以我想这些支架需要更换，有人可以帮我重新加工我的支架吗？

我可以看到其他人会发现这个正则表达式的使用，所以请随意使用它来验证英国邮政地址。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T15:14:47.560

实际上，括号用于提取，而不是括号。表达式中的 (?: 构造是*防止*括号执行提取的方式。您会想要：

```
(?:((?:A[BL]|B[ABDHLNRST]?|C[ABFHMORTVW]|D[ADEGHLNTY]|E[CHNX]?|F[KY]|G[LUY]?|H[ADGPRSUX]|I[GMPV]|JE|K[ATWY]|L[ADELNSU]?|M[EKL]?|N[EGNPRW]?|O[LX]|P[AEHLOR]|R[GHM]|S[AEGKLMNOPRSTWY]?|T[ADFNQRSW]|UB|W[ACDFNRSV]?|YO|ZE)\d(?:\d|[A-Z])?)\s{0,}(\d[A-Z]{2})) 
```

顺便说一句，我也会做出这样的改变：

```
(?:((?:A[BL]|B[ABDHLNRST]?|C[ABFHMORTVW]|D[ADEGHLNTY]|E[CHNX]?|F[KY]|G[LUY]?|H[ADGPRSUX]|I[GMPV]|JE|K[ATWY]|L[ADELNSU]?|M[EKL]?|N[EGNPRW]?|O[LX]|P[AEHLOR]|R[GHM]|S[AEGKLMNOPRSTWY]?|T[ADFNQRSW]|UB|W[ACDFNRSV]?|YO|ZE)\d(?:\d|[A-Z])?)\s*(\d[A-Z]{2})) 
```

因为**\s{0,}**是一种愚蠢的写作方式**\s***。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-26T15:58:17.397

此外，我建议不要尝试如此彻底地检查邮政编码。有效邮政编码列表可以更改，因此您必须在 Post Office 每次更新 PAF 时维护表达式。

您还缺少一些“特殊邮政编码”，例如 BFPO、GIR、非地理邮政编码和海外领土。有关您可能需要处理的内容的概述，请参阅[wiki 。](http://en.wikipedia.org/wiki/Postal_codes_in_the_United_Kingdom)

一般来说，对于大多数目的来说，“它看起来合理吗？” 检查总比试图完全确定要好。没有什么比告诉客户他们不能使用您的服务更糟糕的了，因为他们的地址不存在。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T16:12:58.513

在处理像这样的大型正则表达式时，您应该使用该`/x`选项（我认为`RegexOptions.IgnorePatternWhitespace`在 C# 中调用它）。(?:) 不是捕捉，所以你需要做的就是`()`围绕你想要的部分。该选项的另一个好处`/x`是您可以使用行尾注释来注释正则表达式（它们以 开头`#`）。您可能还需要小心使用 \d 和 \s。它们可能比您预期的匹配更多（`\s`匹配所有空格，而不仅仅是空格，并且至少在 Perl 5.8 及更高版本中，`\d`匹配所有 UNICODE 数字字符，而不仅仅是`[0-9]`）

```
Regex exp = new Regex(@"
    (?:
        ( #capture first part
            (?:
                A[BL]        | B[ABDHLNRST]? | C[ABFHMORTVW]      |
                D[ADEGHLNTY] | E[CHNX]?      | F[KY]              |
                G[LUY]?      | H[ADGPRSUX]   | I[GMPV]            |
                JE           | K[ATWY]       | L[ADELNSU]?        |
                M[EKL]?      | N[EGNPRW]?    | O[LX]              |
                P[AEHLOR]    | R[GHM]        | S[AEGKLMNOPRSTWY]? |
                T[ADFNQRSW]  | UB            | W[ACDFNRSV]?       |
                YO           | ZE
            )
            \d
            (?:
                \d | [A-Z]
            )?
        ) #end capture of first part
        \s{0,}
        ( #capture second part
            \d[A-Z]{2}
        ) #end capture of second part
    )",
    RegexOptions.IgnorePatternWhitespace
); 
```

# java - Apache Ivy 如何解析 ivysettings.xml 文件中提供的工件模式中的变量？

> ID：686188
> 
> 赞同：3
> 
> 时间：2009-03-26T15:09:11.257
> 
> 标签：java, ant, ivy, dependency-management

如果我的 ivysettings.xml 文件包括：

```
<url name="com.springsource.repository.bundles.external">
    <ivy pattern="http://repository.springsource.com/ivy/bundles/external/[organisation]/[module]/[revision]/[artifact]-[revision].[ext]" />
    <artifact pattern="http://repository.springsource.com/ivy/bundles/external/[organisation]/[module]/[revision]/[artifact]-[revision].[ext]" />
</url> 
```

我的 ivy.xml 文件包括：

```
<dependency org="org.junit"
            name="com.springsource.org.junit" 
            rev="4.4.0" /> 
```

从我运行 Ivy 开始，我可以看出这可以解析为：[http://repository.springsource.com/ivy/bundles/external/org.junit/com.springsource.org.junit/4.4.0/com.springsource。 org.junit-sources-4.4.0.jar](http://repository.springsource.com/ivy/bundles/external/org.junit/com.springsource.org.junit/4.4.0/com.springsource.org.junit-sources-4.4.0.jar)

所以决议去：

```
[organization] => "org.junit"
[module] => "com.springsource.org.junit"
[revision] => "4.4.0"
[artifact] => "com.springsource.org.junit-sources"
[ext] => "jar" 
```

我看到 ivy 如何解析 URL 模式中的 [organisation]、[module] 和 [revision]（duh），但它如何解析 [artifact] 和 [ext]？

似乎缺少[有关 URL 解析器](http://ant.apache.org/ivy/history/trunk/resolver/url.html)的文档。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-27T06:08:25.870

Ivy 首先解析`<ivy pattern... />`, 并给出组织、模块和修订版本，`[artifact]`硬编码为“ivy”，`[ext]`硬编码为“xml”。这会产生一个 URL，在这种情况下：

[http://repository.springsource.com/ivy/bundles/external/org.junit/com.springsource.org.junit/4.4.0/ivy **-4.4.0**。**xml**](http://repository.springsource.com/ivy/bundles/external/org.junit/com.springsource.org.junit/4.4.0/ivy-4.4.0.xml)

这是这个模块的常春藤配置文件。除其他外，此 ivy 配置文件包含有关其他工件的信息，特别是：

```
<artifact name="com.springsource.org.junit-sources" type="src" ext="jar"/>
<artifact name="license" type="license" ext="txt"/> 
```

然后使用这两个来完成`<artifact pattern... />`部分 - 下载许可证和下载 jar 文件。

# c# - XmlTextReader - 它是否锁定文件？

> ID：686189
> 
> 赞同：5
> 
> 时间：2009-03-26T15:09:15.593
> 
> 标签：c#, .net, xmltextreader

这可能是一个非常简单的事情，但我一直无法找到它，我可能只是在寻找错误的东西......

XmlTextReader --> 它会锁定您正在阅读的文件吗？我正在使用 reader.Read() 就是这样。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-26T15:17:13.873

当您创建一个新的`XmlTextReader`提供 a`string`时，它将使用写锁（但不是读锁）锁定文件；但是，如果您提供它 a `Stream`，它将取决于流本身。

```
FileStream stream = new FileStream(@"myfile.xml", FileMode.Open,
                            FileAccess.Read, FileShare.ReadWrite);
XmlTextReader reader = new XmlTextReader(stream); 
```

您现在可以在没有锁的情况下阅读。

# asp.net-mvc - 如何使用 Wix 在 IIS 7 上安装 ASP.Net MVC 应用程序？

> ID：686190
> 
> 赞同：15
> 
> 时间：2009-03-26T15:09:18.260
> 
> 标签：asp.net-mvc, iis, iis-7, wix

对于 IIS6，我可以使用 Wix 中的 IIS 帮助程序来安装这样的 Web 应用程序：

```
<iis:WebAppPool 
    Id="AP_MyApp" 
    Name="My Application Pool" 
    Identity="networkService" />
<iis:WebApplication 
    Id="WA_MyApp" 
    Name="MyApp" 
    WebAppPool="AP_MyApp">
    <iis:WebApplicationExtension
        CheckPath="no"
        Executable="[NETFRAMEWORK20INSTALLROOTDIR]aspnet_isapi.dll"
        Verbs="GET,HEAD,POST"/>
</iis:WebApplication> 
```

不幸的是，这不适用于 IIS7。我们不想使用 aspnet_isapi.dll 机制，而是希望集成管道来处理请求路由。此脚本创建的应用程序池处于经典模式而不是集成模式，因此没有一个处理程序能够正确运行。

如何在 IIS 7 上正确安装 MVC 应用程序？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-01T23:56:26.727

我个人建议使用 AppCmd.exe（matthewthurlow 的第一个项目符号），因为您不必依赖正在安装的遗留管理组件，也不必冒险手动修改配置 XML。

如果您对 AppCmd 不满意，Mike Volodarsky 有一篇关于[AppCmd.exe 入门](http://learn.iis.net/page.aspx/114/getting-started-with-appcmdexe/)的精彩文章，并且 Microsoft [IIS 配置参考](http://www.iis.net/ConfigReference)非常出色，提供 UI、代码和 AppCmd 示例以修改每个配置项（例如[应用程序池](http://www.iis.net/ConfigReference/system.applicationHost/applicationPools)） . [IIS7 管理包](http://www.iis.net/extensions/AdministrationPack)还包括一个配置编辑器，允许您从任何现有配置[生成 AppCmd 脚本。](http://learn.iis.net/page.aspx/417/using-configuration-editor-generate-scripts/)

要将 AppCmd 集成到 WiX 中，您需要为每个命令创建和安排两个自定义操作。WiX v3 手册中有一般信息[记录此过程](http://wix.sourceforge.net/manual-wix3/qtexec.htm)，我在下面提供了一个具体示例。

首先，您需要设置一个立即操作来将命令行存储在一个属性中：

```
<CustomAction 
  Id="CreateAppPool_Cmd" 
  Property="CreateAppPool" 
  Execute="immediate" 
  Value="&quot;[WindowsFolder]system32\inetsrv\APPCMD.EXE&quot; add apppool /name:&quot;[APP_POOL_NAME]&quot;" /> 
```

接下来，您设置一个引用此属性的延迟操作：

```
<CustomAction 
  Id="CreateAppPool" 
  BinaryKey="WixCA" 
  DllEntry="CAQuietExec" 
  Execute="deferred" 
  Return="ignore" 
  Impersonate="no"/> 
```

最后，您需要安排这些。设置属性的即时操作似乎在 InstallFinalize 之后运行良好，而延迟操作在 InstallFiles 之后运行。我还没有弄清楚回滚动作。

MapGuide Open Source 广泛使用这种方法；[您可以在我们的MapGuide.wxs](http://trac.osgeo.org/mapguide/browser/trunk/Installer/Installers/MapGuide/MapGuide.wxs#L444)文件中看到 CA 调度，在我们的[IIS7.wxs](http://trac.osgeo.org/mapguide/browser/trunk/Installer/Libraries/MapGuide%20Web%20Extensions/IIS7.wxs#L9)文件中看到CA 定义。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-27T09:18:22.293

感谢@matthewthurlow，我能够使用 XML 工具来实现我需要做的事情：

```
<util:XmlFile 
    Id="ModifyAppPoolPipelineType"
    Action="setValue"
    ElementPath="//configuration/system.applicationHost/applicationPools/add[\[]@name='My Application Pool'[\]]/@managedPipelineMode"
    File="[WindowsFolder]System32\inetsrv\config\applicationHost.config"
    Value="Integrated"/> 
```

其余的操作似乎在 IIS 7 上运行良好。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T21:46:15.703

WIX 的 IIS 扩展不支持 IIS7。IIS 团队不断重写版本之间的元数据库。有很多东西不起作用，其中缺少集成的应用程序池。

在扩展被重写之前，您只有三个选项：

*   使用内置自定义操作调用 appcmd.exe
*   使用 XmlConfig 更新 applicationHost.config
*   编写您自己的自定义操作

我目前选择了 xmlconfig 选项，因为您可以在组件中执行此操作并将其绑定到功能。

# asp.net - 查找活动的 Visual Studio 2008 连接字符串

> ID：686196
> 
> 赞同：0
> 
> 时间：2009-03-26T15:10:55.697
> 
> 标签：asp.net, configuration, web-config, database-connection

有没有一种简单的方法来确定我的 web.config 中使用了哪些连接字符串。经过大量 LinqToSQL 测试后，我的 web.config 中有一些额外的连接字符串，我确定它们没有被使用，但我不确定哪些是/不是。任何快速的方法来挑出这些。显而易见的解决方案是把它们一个一个拉出来，对整个应用程序进行全面的调试。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T15:13:00.777

我想你回答了这个。您也可以在所有文件中进行查找，或者如果它是强类型的，则查找所有引用然后删除它们。最终我会依赖测试，即使它们只是一些全面的烟雾测试。

# sql-server - 帮助找出（接近）实时多维数据查询的方法

> ID：686199
> 
> 赞同：2
> 
> 时间：2009-03-26T15:11:24.043
> 
> 标签：sql-server, database, database-design, olap

我有一个涉及许多相关表的系统。考虑一个标准的类别/产品/订单/客户/订单项目场景。有些表是自引用的（如类别）。这些表都不是特别大（大约 100k 行，估计规模约为 100 万行）。我需要考虑这些数据的很多维度，但必须以近乎实时的方式进行查询。我也不知道特定用户对哪些维度感兴趣——它可以是众多表格中的一个或多个标准。事情可以从

1.  给我所有的夹克类别
2.  给我上个月在纽约购买的夹克 -> 红色派克大衣类别的所有东西
3.  给我所有不是在纽约购买的价值超过 100 美元的东西。

目前，我们有一个很长的 SP，它使用“级联数据”方法——我们逐个表，使用为该表指定的任何标准将所有内容过滤到一个临时表中。对于下一个表，我们将当前临时表连接到我们正在使用的任何表，并将一个新的过滤器集应用到一个新的临时表中。它可以工作，但可管理性和性能很慢。我需要更好的东西。

我需要一种新的方法来解决这个问题。显然需要 OLAP，可能使用星型模式。这可以实时工作吗？它可以配置为实时工作吗？我应该使用索引视图来创建一组非规范化表吗？我应该将其完全卸载到数据库之外吗？

仅供参考，我们正在使用 Sql Server。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T16:17:42.933

正如您所说，这非常适合 OLAP。使用 Sql Server 2005 和 2008，您可以设置几乎实时的解决方案。你应该：

*   创建非规范化星型模式
*   使用该模式构建 OLAP 多维数据集
*   启用主动缓存以在基础数据源更改时更新多维数据集。

这不是一件小事，您需要企业版的 Sql Server 才能使用主动缓存。您还需要一些前端工具（也许 excel 可以）来使用多维数据集。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T01:49:48.207

Your dilemma sounds to me like "Is it better to achieve the same result by performing complex processing every time I need it, or should I do it once only for each new piece of data?".

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T15:36:00.833

最好在您的代码中构建一个动态查询，其中包含您需要的所有连接，并针对每个单独的请求进行定制。（当然为了安全而适当地参数化）。

您将使用许多与现在相同的级联逻辑，但将其移至代码而不是数据库。然后，您只需提交您需要的确切查询。

使用所有临时表的性能会超过它，并且在运行一些查询后您可能会获得一些缓存优势。

# coding-style - 那里有任何代码干燥器工具吗？

> ID：686206
> 
> 赞同：6
> 
> 时间：2009-03-26T15:12:30.030
> 
> 标签：coding-style, dry

我有一个很大的代码库，到处都有很多重复的或几乎重复的代码，它几乎是代码可以得到的 unDRY，但是很难跟踪“重复”，所以我想知道是否有任何工具寻找潜在的 DRYable 代码，比如 diff 工具或 Hamming 距离分析器，不需要语言特定的知识或类似的东西。

那么像这样的工具有什么线索吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T15:22:04.737

[Visual Studio 的克隆侦探](http://www.codeplex.com/CloneDetectiveVS)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T15:18:13.577

如果你正在使用 ruby​​，那么你可以试试[这个](http://ruby.sadi.st/Ruby_Sadist.html)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T15:21:39.417

[Duplo](http://sourceforge.net/projects/duplo)（开源）适用于 C、C++、Java、C# 和 VB.Net。我尝试过一次，它发现了足够多的重复代码让我长期工作。

我听说过[Simian](http://www.redhillconsulting.com.au/products/simian/)（商业），但没有尝试过。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T15:32:25.960

我在 VS 中使用 Simian。这还不错，不是很好。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-26T16:38:23.633

Semantic Designs 的 Clone Dr 是一款商业产品，可以在大量不同的编程语言中查找重复代码。 [http://www.semdesigns.com/Products/Clone/index.html](http://www.semdesigns.com/Products/Clone/index.html)

大公司可以负担得起这种产品。个人……没那么多。我希望有一些像这样的开源项目。可能是一个有趣的项目。如果我们只知道一个程序员社区有一些时间......

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-03-09T10:56:41.400

Semantic Designs 的[CloneDR](http://www.semanticdesigns.com/Products/Clone)可以根据语言结构找到准确的和几乎错过的重复克隆，因此它不会被空格更改或换行符、插入/更改的注释甚至修改的变量名所迷惑。

它利用生产解析器前端与 C、C++、C#、Java、COBOL、PHP、Python、Fortran、Ada、...

网站上有许多不同语言的克隆分析报告示例。

# asp.net-mvc - 如何在 MVC 视图中检查空值？

> ID：686207
> 
> 赞同：4
> 
> 时间：2009-03-26T15:12:30.950
> 
> 标签：asp.net-mvc

我将 MVC 与 LINQ-to-SQL 类一起使用。

由于外键可以为空，我有一条记录具有 fk 空值，而其他记录具有值。

现在我通过索引视图在视图中显示它。

在索引视图中，我通过编写类似的代码来解析 fk

```
<%= Html.Encode(item.UserModified.UserName) %> 
```

现在我有一个问题，即“未设置对象引用”。

这是因为我们在 fk 字段之一中有空值！

那么我可以编写代码来检查关联对象是否指向空值或什么都没有？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T15:17:23.610

如有必要，您可以在视图中编写所需的任何代码，因此您可以这样做：

```
<%= Html.Encode(item.UserModified.UserName ?? string.Empty) %> 
```

您还可以制作一个 HtmlHelper 扩展来执行此操作：

```
public string SafeEncode(this HtmlHelper helper, string valueToEncode)
{
    return helper.Encode(valueToEncode ?? string.Empty);
} 
```

然后你可以简单地做：

```
<%= Html.SafeEncode(item.UserModified.UserName) %> 
```

当然，如果 UserModified 为 null 而不是 UserName，那么您将需要一些不同的逻辑。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T15:16:34.577

使用 C#，您可以使用条件运算符：

```
<%= Html.Encode(item.UserModified == null ? "" : item.UserModified.UserName) %> 
```

但是，将 UserName 属性移动为 item 的直接子项或将其放在 ViewData 中可能是更好的选择。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-09-18T09:20:56.653

首先考虑在您的模型中，用户的实例在没有名称的情况下是否有效。如果不是，那么您应该在构造函数中放置一个保护子句。

其次，过多和重复的空检查是代码异味。您应该使用重构[Replace Conditional with Polymorphism](http://www.refactoring.com/catalog/replaceConditionalWithPolymorphism.html)。您可以根据[Null Object Pattern](http://sourcemaking.com/design_patterns/null_object)创建一个 Null 对象。

这将确保您不必到处检查 Null。

# c# - C# 表单应用程序 - 模态对话框的父级错误

> ID：686213
> 
> 赞同：0
> 
> 时间：2009-03-26T15:14:41.117
> 
> 标签：c#, multithreading, winforms, windows-xp

我有一个应用程序，它内置了一个异步操作，它循环大量项目并对每个项目执行冗长的计算，因为发生这种情况时，某些条件会导致应用程序弹出一个模式对话框供用户输入。有趣的是，我今天在运行此程序时注意到，在一个应用程序实例中，模态对话框不知何故得到了错误的父窗体——而不是为我的应用程序提供模态块，对话框将 Digsby 聊天窗口作为其父窗体。

他们成为子级的 Digsby 窗口在创建第一个对话框的同时弹出（可能在同一时间），并且看起来他们线程以某种方式相互交叉，因为 Digsby 窗口在异步操作完成之前被完全阻塞. 考虑到每个进程线程的工作原理，我不知道这怎么可能，但它确实发生了。什么会导致这样的错误？顺便说一句，该应用程序是 C# .NET 3.5，带有在 Windows XP 上运行的 Windows 窗体。

简而言之，这是异步代码：

```
Action<List<ClubListing>> a = delegate(List<ClubListing> list)
        {
            for (int i = 0; i < list.Count; i++)
            {
                var cl = list[i];
                if (cl.MatchingClubListing == null)
                {
                    var compare = CompareNames(cl.Club.Name);
                    if (compare.Any(c => c.Value == 0 && c.Key.Club.State == cl.Club.State))
                    {
                        var match = compare.First(c => c.Value == 0 && c.Key.Club.State == cl.Club.State);
                        compareDialog.ClubA = cl.Club;
                        compareDialog.ClubB = match.Key.Club;
                        DialogResult dr = compareDialog.ShowDialog();
                        if (dr == DialogResult.Yes)
                        {
                            cl.MatchingClubListing = match.Key;
                            match.Key.MatchingClubListing = cl;
                        }
                        else if (dr == DialogResult.Abort)
                        {
                            break;
                        }
                    }
                }
                this.Invoke(new MethodInvoker(delegate()
                {
                    this.prbOperationProgress.Value = i;
                }));
            }
        };

        AsyncCallback callback = new AsyncCallback(SaveAndUpdate);
        var result = a.BeginInvoke(this.lbxLiveClubs.Items.Cast<ClubListing>().ToList(), callback, null); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T15:23:20.507

将父对话框作为参数添加到 compareDialog.ShowDialog()。例如：

```
Form parent = ...;
compareDialog.ShowDialog(parent); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T15:23:20.037

就像您调用`ProgressBar`更新一样，您需要`Invoke()`显示您的对话框。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T15:23:53.203

看起来您正在工作线程中显示比较对话框。我认为如果您使用调用`Invoke`来显示您的对话框，您可能会没事。

# http - HTTP标头值的最大值？

> ID：686217
> 
> 赞同：373
> 
> 时间：2009-03-26T15:15:07.607
> 
> 标签：http, http-headers

HTTP 标头是否有可接受的最大允许大小？如果是这样，它是什么？如果不是，这是特定于服务器的东西还是允许任何大小的标头的公认标准？

* * *

## 回答 #1

> 赞同：365
> 
> 时间：2009-03-26T15:20:25.363

不，HTTP 没有定义任何限制。然而，大多数 Web 服务器确实限制了它们接受的标头的大小。例如，在[Apache 中默认限制](http://httpd.apache.org/docs/2.2/mod/core.html#limitrequestfieldsize)为 8KB，在[IIS 中为 16K](http://support.microsoft.com/kb/260694)。如果标头大小超过该限制，服务器将返回`413 Entity Too Large`错误。

相关问题：[用户代理字符串可以有多大？](https://stackoverflow.com/questions/654921/how-big-can-a-user-agent-string-get)

* * *

## 回答 #2

> 赞同：240
> 
> 时间：2011-12-24T06:15:02.840

正如 vartec 上面所说，HTTP 规范没有定义限制，但是许多服务器默认情况下会这样做。这意味着，实际上，下限是**8K**。对于大多数服务器，此限制适用于**请求行和*所有*标头字段**的总和（因此请保持 cookie 简短）。

*   阿帕奇[2.0](http://httpd.apache.org/docs/2.0/mod/core.html#limitrequestfieldsize) , [2.2](http://httpd.apache.org/docs/2.2/mod/core.html#limitrequestfieldsize) : **8K**
*   [nginx](http://nginx.org/r/large_client_header_buffers)：**4K** - 8K
*   IIS：[因版本而异](https://stackoverflow.com/a/6160643/92629)，**8K** - 16K
*   Tomcat：[因版本而异](https://stackoverflow.com/a/6160643/92629)，**8K** - 48K (?!)

值得注意的是，nginx 默认使用系统页面大小，在大多数系统上为 4K。您可以使用这个小程序进行检查：

页面大小.c：

```
#include <unistd.h>
#include <stdio.h>

int main() {
    int pageSize = getpagesize();
    printf("Page size on your system = %i bytes\n", pageSize);
    return 0;
} 
```

编译`gcc -o pagesize pagesize.c`然后运行`./pagesize`。[我来自Linode](http://linode.com)的 ubuntu 服务器尽职尽责地告诉我答案是 4k。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2016-07-17T04:36:38.180

> HTTP 没有对每个标头字段的长度或整个标头部分的长度设置预定义限制，如第 2.5 节所述。在实践中发现了对单个头字段长度的各种特殊限制，通常取决于特定的字段语义。

HTTP Header 值受服务器实现的限制。Http 规范不限制标头大小。

> 接收到大于其希望处理的请求头字段或字段集的服务器必须以适当的 4xx（客户端错误）状态代码进行响应。忽略此类标头字段会增加服务器对请求走私攻击的脆弱性（第 9.5 节）。

发生这种情况时，大多数服务器将返回`413 Entity Too Large`或相应的 4xx 错误。

> 如果字段语义使得可以安全地忽略丢弃的值而不更改消息帧或响应语义，则客户端可以丢弃或截断接收到的大于客户端希望处理的头字段。

无上限的 HTTP 标头大小使服务器容易受到攻击，并可能降低其服务有机流量的能力。

[来源](https://www.rfc-editor.org/rfc/rfc7230)

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2020-03-10T18:24:17.500

这是最流行的网络服务器的限制

*   阿帕奇 - 8K
*   Nginx - 4K-8K
*   IIS - 8K-16K
*   雄猫 - 8K – 48K
*   节点 (<13) - 8K；(>13) - 16K

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2021-04-20T13:59:26.537

2011 年的 RFC 6265 规定了对 cookie 的具体限制。

[https://www.rfc-editor.org/rfc/rfc6265](https://www.rfc-editor.org/rfc/rfc6265) 6.1。限制

实际的用户代理实现对它们可以存储的 cookie 的数量和大小有限制。通用用户代理应该提供以下每个最低功能：

o 每个 cookie 至少 4096 字节（通过 cookie 的名称、值和属性的长度之和来衡量）。

o 每个域至少 50 个 cookie。

o 总共至少 3000 个 cookie。

服务器应该使用尽可能少和尽可能小的 cookie 以避免达到这些实现限制，并由于每个请求中都包含 Cookie 标头而最小化网络带宽。

如果用户代理未能在 Cookie 标头中返回一个或多个 cookie，服务器应该优雅地降级，因为用户代理可能会随时根据用户的命令驱逐任何 cookie。

--

RFC 的目标受众是用户代理或服务器必须支持的内容。似乎要调整您的服务器以支持浏览器允许的内容，您需要将 4096*50 配置为限制。正如下文所暗示的，这似乎远远超出了典型 Web 应用程序的需求。使用当前限制和 RFC 概述的上限并比较更高配置的内存和 IO 后果会很有用。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2017-02-05T15:48:20.570

我还发现，在某些情况下，502/400 在许多标头的情况下的原因可能是由于大量标头而不考虑大小。从文档

> tune.http.maxhdr 设置请求中的最大标头数。当请求带有多个大于此值的标头（包括第一行）时，它会被拒绝并显示“400 Bad Request”状态代码。同样，太大的响应会被“502 Bad Gateway”阻止。考虑到广泛部署的 Apache 服务器使用相同的限制，默认值是 101，这对于所有用法都足够了。进一步推动此限制以临时允许有缺陷的应用程序在修复时工作可能很有用。请记住，每个新标头会为每个会话消耗 32 位内存，因此不要将此限制推得太高。

[https://cbonte.github.io/haproxy-dconv/configuration-1.5.html#3.2-tune.http.maxhdr](https://cbonte.github.io/haproxy-dconv/configuration-1.5.html#3.2-tune.http.maxhdr)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2020-12-07T13:45:24.090

如果您要使用 Akamai 等任何 DDOS 提供程序，它们的响应标头大小最大限制为 8k。因此，基本上尝试将您的响应标头大小限制在 8k 以下。

# java - 快速读取文本文件的最后一行？

> ID：686231
> 
> 赞同：68
> 
> 时间：2009-03-26T15:17:32.783
> 
> 标签：java, file, io

从Java中的[非常非常大]文件中读取最后一行文本的最快和最有效的方法是什么？

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2011-09-06T15:44:55.687

**下面是两个函数，一个返回文件的最后一个非空白行而不加载或单步执行整个文件，另一个返回文件的最后 N 行而不单步执行整个文件：**

tail 所做的是直接缩放到文件的最后一个字符，然后逐个字符地后退，记录它看到的内容，直到找到换行符。一旦找到换行符，它就会跳出循环。反转记录的内容并将其放入字符串并返回。0xA 是新行，0xD 是回车。

如果您的行尾是`\r\n`或`crlf`或其他一些“双换行样式换行符”，那么您必须指定 n*2 行以获取最后 n 行，因为它为每行计算 2 行。

```
public String tail( File file ) {
    RandomAccessFile fileHandler = null;
    try {
        fileHandler = new RandomAccessFile( file, "r" );
        long fileLength = fileHandler.length() - 1;
        StringBuilder sb = new StringBuilder();

        for(long filePointer = fileLength; filePointer != -1; filePointer--){
            fileHandler.seek( filePointer );
            int readByte = fileHandler.readByte();

            if( readByte == 0xA ) {
                if( filePointer == fileLength ) {
                    continue;
                }
                break;

            } else if( readByte == 0xD ) {
                if( filePointer == fileLength - 1 ) {
                    continue;
                }
                break;
            }

            sb.append( ( char ) readByte );
        }

        String lastLine = sb.reverse().toString();
        return lastLine;
    } catch( java.io.FileNotFoundException e ) {
        e.printStackTrace();
        return null;
    } catch( java.io.IOException e ) {
        e.printStackTrace();
        return null;
    } finally {
        if (fileHandler != null )
            try {
                fileHandler.close();
            } catch (IOException e) {
                /* ignore */
            }
    }
} 
```

**但是你可能不想要最后一行，你想要最后 N 行，所以改用这个：**

```
public String tail2( File file, int lines) {
    java.io.RandomAccessFile fileHandler = null;
    try {
        fileHandler = 
            new java.io.RandomAccessFile( file, "r" );
        long fileLength = fileHandler.length() - 1;
        StringBuilder sb = new StringBuilder();
        int line = 0;

        for(long filePointer = fileLength; filePointer != -1; filePointer--){
            fileHandler.seek( filePointer );
            int readByte = fileHandler.readByte();

             if( readByte == 0xA ) {
                if (filePointer < fileLength) {
                    line = line + 1;
                }
            } else if( readByte == 0xD ) {
                if (filePointer < fileLength-1) {
                    line = line + 1;
                }
            }
            if (line >= lines) {
                break;
            }
            sb.append( ( char ) readByte );
        }

        String lastLine = sb.reverse().toString();
        return lastLine;
    } catch( java.io.FileNotFoundException e ) {
        e.printStackTrace();
        return null;
    } catch( java.io.IOException e ) {
        e.printStackTrace();
        return null;
    }
    finally {
        if (fileHandler != null )
            try {
                fileHandler.close();
            } catch (IOException e) {
            }
    }
} 
```

**像这样调用上述方法：**

```
File file = new File("D:\\stuff\\huge.log");
System.out.println(tail(file));
System.out.println(tail2(file, 10)); 
```

**警告** 在 unicode 的狂野西部，此代码可能会导致此函数的输出出错。例如“Mary?s”而不是“Mary's”。带有[帽子、重音、汉字](http://en.wikipedia.org/wiki/Diacritic)等的字符可能会导致输出错误，因为重音作为修饰符添加在字符之后。反转复合字符会在反转时改变字符身份的性质。您必须对计划使用的所有语言进行全面测试。

有关此 unicode 反转问题的更多信息，请阅读： [https ://codeblog.jonskeet.uk/2009/11/02/omg-ponies-aka-humanity-epic-fail/](https://codeblog.jonskeet.uk/2009/11/02/omg-ponies-aka-humanity-epic-fail/)

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2014-02-28T21:07:23.927

Apache Commons 有一个使用[RandomAccessFile](http://docs.oracle.com/javase/8/docs/api/java/io/RandomAccessFile.html)的实现。

它被称为[ReversedLinesFileReader](https://commons.apache.org/proper/commons-io/javadocs/api-release/org/apache/commons/io/input/ReversedLinesFileReader.html)。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-03-26T15:22:02.287

看看我[对 C# 的类似问题的](https://stackoverflow.com/questions/452902/how-to-read-a-text-file-reversely-with-iterator-in-c)回答。代码将非常相似，尽管 Java 中的编码支持有些不同。

基本上，一般来说，这并不是一件非常容易的事情。正如 MSalter 指出的那样，UTF-8 确实很容易发现，`\r`或者`\n`这些字符的 UTF-8 表示与 ASCII 相同，并且这些字节不会出现在多字节字符中。

所以基本上，取一个（比如说）2K的缓冲区，然后逐步向后读取（在你之前跳到2K，读取下一个2K）检查行终止。然后跳到流中正确的位置，`InputStreamReader`在顶部创建一个，然后在其上创建一个`BufferedReader`。然后只需调用`BufferedReader.readLine()`.

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-26T15:28:14.660

使用 FileReader 或 FileInputStream 将不起作用 - 您必须使用[FileChannel](http://java.sun.com/javase/6/docs/api/java/nio/channels/FileChannel.html)或[RandomAccessFile](http://java.sun.com/javase/6/docs/api/java/io/RandomAccessFile.html)从末尾向后循环文件。正如乔恩所说，编码将是一个问题。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-09-25T11:43:49.960

***您可以轻松更改以下代码以打印最后一行。***

**MemoryMappedFile 用于打印最后 5 行：**

```
private static void printByMemoryMappedFile(File file) throws FileNotFoundException, IOException{
        FileInputStream fileInputStream=new FileInputStream(file);
        FileChannel channel=fileInputStream.getChannel();
        ByteBuffer buffer=channel.map(FileChannel.MapMode.READ_ONLY, 0, channel.size());
        buffer.position((int)channel.size());
        int count=0;
        StringBuilder builder=new StringBuilder();
        for(long i=channel.size()-1;i>=0;i--){
            char c=(char)buffer.get((int)i);
            builder.append(c);
            if(c=='\n'){
                if(count==5)break;
                count++;
                builder.reverse();
                System.out.println(builder.toString());
                builder=null;
                builder=new StringBuilder();
            }
        }
        channel.close();
    } 
```

**RandomAccessFile 打印最后 5 行：**

```
private static void printByRandomAcessFile(File file) throws FileNotFoundException, IOException{
        RandomAccessFile randomAccessFile = new RandomAccessFile(file, "r");
        int lines = 0;
        StringBuilder builder = new StringBuilder();
        long length = file.length();
        length--;
        randomAccessFile.seek(length);
        for(long seek = length; seek >= 0; --seek){
            randomAccessFile.seek(seek);
            char c = (char)randomAccessFile.read();
            builder.append(c);
            if(c == '\n'){
                builder = builder.reverse();
                System.out.println(builder.toString());
                lines++;
                builder = null;
                builder = new StringBuilder();
                if (lines == 5){
                    break;
                }
            }

        }
    } 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2018-09-17T04:27:03.427

据我所知，读取文本文件最后一行的最快方法是使用“org.apache.commons.io”中的 FileUtils Apache 类。我有一个 200 万行的文件，通过使用这个类，我用了不到一秒钟的时间找到了最后一行。这是我的代码：

```
LineIterator lineIterator = FileUtils.lineIterator(newFile(filePath),"UTF-8");
String lastLine="";
while (lineIterator.hasNext()){
 lastLine=  lineIterator.nextLine();
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-05-08T04:30:48.250

```
try(BufferedReader reader = new BufferedReader(new FileReader(reqFile))) {

    String line = null;

    System.out.println("======================================");

    line = reader.readLine();       //Read Line ONE
    line = reader.readLine();       //Read Line TWO
    System.out.println("first line : " + line);

    //Length of one line if lines are of even length
    int len = line.length();       

    //skip to the end - 3 lines
    reader.skip((reqFile.length() - (len*3)));

    //Searched to the last line for the date I was looking for.

    while((line = reader.readLine()) != null){

        System.out.println("FROM LINE : " + line);
        String date = line.substring(0,line.indexOf(","));

        System.out.println("DATE : " + date);      //BAM!!!!!!!!!!!!!!
    }

    System.out.println(reqFile.getName() + " Read(" + reqFile.length()/(1000) + "KB)");
    System.out.println("======================================");
} catch (IOException x) {
    x.printStackTrace();
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-26T15:24:02.127

在**C#**中，您应该能够设置流的位置：

来自：[http ://bytes.com/groups/net-c/269090-streamreader-read-last-line-text-file](http://bytes.com/groups/net-c/269090-streamreader-read-last-line-text-file)

```
using(FileStream fs = File.OpenRead("c:\\file.dat"))
{
    using(StreamReader sr = new StreamReader(fs))
    {
        sr.BaseStream.Position = fs.Length - 4;
        if(sr.ReadToEnd() == "DONE")
            // match
    }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-06-24T14:43:41.423

```
Path path = Paths.get(pathString);
      List<String> allLines = Files.readAllLines(path);
      return allLines.get(allLines.size()-1); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-06-03T11:11:00.513

为了避免与恢复字符串（或 StringBuilder）相关的 Unicode 问题，正如[Eric Leschinski](https://stackoverflow.com/questions/686231/quickly-read-the-last-line-of-a-text-file/7322581#7322581)出色的回答中所讨论的那样，可以从文件末尾读取字节列表，将其恢复为字节数组，然后创建字符串从字节数组。

下面是对[Eric Leschinski](https://stackoverflow.com/questions/686231/quickly-read-the-last-line-of-a-text-file/7322581#7322581)答案代码的更改，以使用字节数组来完成。代码更改位于注释的代码行下方：

```
static public String tail2(File file, int lines) {
    java.io.RandomAccessFile fileHandler = null;
    try {
        fileHandler = new java.io.RandomAccessFile( file, "r" );
        long fileLength = fileHandler.length() - 1;
        //StringBuilder sb = new StringBuilder();
        List<Byte> sb = new ArrayList<>();
        int line = 0;

        for(long filePointer = fileLength; filePointer != -1; filePointer--){
            fileHandler.seek( filePointer );
            int readByte = fileHandler.readByte();

            if( readByte == 0xA ) {
                if (filePointer < fileLength) {
                    line = line + 1;
                }
            } else if( readByte == 0xD ) {
                if (filePointer < fileLength-1) {
                    line = line + 1;
                }
            }
            if (line >= lines) {
                break;
            }
            //sb.add( (char) readByte );
            sb.add( (byte) readByte );
        }

        //String lastLine = sb.reverse().toString();
        //Revert byte array and create String
        byte[] bytes = new byte[sb.size()];
        for (int i=0; i<sb.size(); i++) bytes[sb.size()-1-i] = sb.get(i);
        String lastLine = new String(bytes);
        return lastLine;
    } catch( java.io.FileNotFoundException e ) {
        e.printStackTrace();
        return null;
    } catch( java.io.IOException e ) {
        e.printStackTrace();
        return null;
    }
    finally {
        if (fileHandler != null )
            try {
                fileHandler.close();
            } catch (IOException e) {
            }
    }
} 
```

# c# - 在gridview中使整行可点击

> ID：686240
> 
> 赞同：12
> 
> 时间：2009-03-26T15:19:36.397
> 
> 标签：c#, asp.net, gridview

我有一个gridview，我需要在单击一行时触发一个事件。

我需要绑定一个现有的 GridView 事件来实现这一点吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-26T15:30:09.677

这是我之前准备的东西：

```
 public class RowClickableGridView : GridView
    {
        public Style HoverRowStyle
        {
            get { return ViewState["HoverRowStyle"] as Style; }
            set { ViewState["HoverRowStyle"] = value; }
        }

        public bool EnableRowClickSelection
        {
            get { return ViewState["EnableRowClickSelection"] as bool? ?? true; }
            set { ViewState["EnableRowClickSelection"] = value; }
        }

        public string RowClickCommand
        {
            get { return ViewState["RowClickCommand"] as string ?? "Select"; }
            set { ViewState["RowClickCommand"] = value; }
        }

        public string RowToolTip
        {
            get
            {
                if (!RowToolTipSet) return string.Format("Click to {0} row", RowClickCommand.ToLowerInvariant());
                return ViewState["RowToolTip"] as string;
            }
            set
            {
                ViewState["RowToolTip"] = value;
                RowToolTipSet = true;
            }
        }

        private bool RowToolTipSet
        {
            get { return ViewState["RowToolTipSet"] as bool? ?? false; }
            set { ViewState["RowToolTipSet"] = value; }
        }

        protected override void OnPreRender(EventArgs e)
        {
            base.OnPreRender(e);
            foreach (GridViewRow row in Rows)
            {
                if (row.RowType != DataControlRowType.DataRow) continue;

                if (EnableRowClickSelection && row.RowIndex != SelectedIndex && row.RowIndex != EditIndex)
                {
                    if (string.IsNullOrEmpty(row.ToolTip)) row.ToolTip = RowToolTip;
                    row.Style[HtmlTextWriterStyle.Cursor] = "pointer";

                    PostBackOptions postBackOptions = new PostBackOptions(this,
                                                                          string.Format("{0}${1}",
                                                                                        RowClickCommand,
                                                                                        row.RowIndex));
                    postBackOptions.PerformValidation = true;
                    row.Attributes["onclick"] = Page.ClientScript.GetPostBackEventReference(postBackOptions);

                    foreach (TableCell cell in row.Cells)
                    {
                        foreach (Control control in cell.Controls)
                        {
                            const string clientClick = "event.cancelBubble = true;{0}";
                            WebControl webControl = control as WebControl;
                            if (webControl == null) continue;
                            webControl.Style[HtmlTextWriterStyle.Cursor] = "Auto";
                            Button button = webControl as Button;
                            if (button != null)
                            {
                                button.OnClientClick = string.Format(clientClick, button.OnClientClick);
                                continue;
                            }
                            ImageButton imageButton = webControl as ImageButton;
                            if (imageButton != null)
                            {
                                imageButton.OnClientClick = string.Format(clientClick, imageButton.OnClientClick);
                                continue;
                            }
                            LinkButton linkButton = webControl as LinkButton;
                            if (linkButton != null)
                            {
                                linkButton.OnClientClick = string.Format(clientClick, linkButton.OnClientClick);
                                continue;
                            }
                            webControl.Attributes["onclick"] = string.Format(clientClick, string.Empty);
                        }
                    }
                }

                if (HoverRowStyle == null) continue;
                if (row.RowIndex != SelectedIndex && row.RowIndex != EditIndex)
                {
                    row.Attributes["onmouseover"] = string.Format("this.className='{0}';", HoverRowStyle.CssClass);
                    row.Attributes["onmouseout"] = string.Format("this.className='{0}';",
                                                                 row.RowIndex%2 == 0
                                                                     ? RowStyle.CssClass
                                                                     : AlternatingRowStyle.CssClass);
                }
                else
                {
                    row.Attributes.Remove("onmouseover");
                    row.Attributes.Remove("onmouseout");
                }
            }
        }

        protected override void Render(HtmlTextWriter writer)
        {
            base.Render(writer);
            foreach (GridViewRow row in Rows)
            {
                if (row.RowType == DataControlRowType.DataRow)
                {
                    Page.ClientScript.RegisterForEventValidation(row.ClientID);
                }
            }
        }
    } 

```

然后，您连接到标准行命令事件...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T15:26:36.177

为了实现这一点，需要一些 javascript 编程。

基本上，您将不得不处理该行的单击事件（某些浏览器该行没有单击事件，因此您可能必须处理 tds 的单击事件......是时候投资 ajax 框架了！）

然后，您将不得不从 javascript 中以行索引作为参数来触发回发。请参阅 encosia（一个很棒的 ASP.Net - ajax 实现站点）了解如何做到这一点。这是指向这些内容的文章的[链接](http://encosia.com/2007/07/13/easily-refresh-an-updatepanel-using-javascript/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2017-03-31T10:25:30.180

这可以通过`LinkButton`在 GridView 中添加一个没有文本的虚拟对象和`RowDataBound`. 页面上需要 LinkBut​​ton 以避免`Invalid postback or callback argument`错误。将可见性设置为`false`也会导致此错误。

LinkBut​​ton 还有一个`CommandArgument`带有当前行号的`OnCommand`事件和一个处理实际点击的事件。

```
<asp:TemplateField>
    <ItemTemplate>
        <asp:LinkButton ID="LinkButton1" runat="server" CommandArgument='<%# Container.DataItemIndex %>' OnCommand="LinkButton1_Command"></asp:LinkButton>
    </ItemTemplate>
</asp:TemplateField> 
```

OnRowDataBound 方法

```
protected void GridView1_RowDataBound(object sender, GridViewRowEventArgs e)
{
    //check if the row is a datarow
    if (e.Row.RowType == DataControlRowType.DataRow)
    {
        //find the linkbutton with findcontrol and cast it back to one
        LinkButton lb = e.Row.FindControl("LinkButton1") as LinkButton;

        //create the correct postback event with the UniqueID property of the linkbutton
        string href = "javascript:__doPostBack('" + lb.UniqueID + "','')";

        //add the onclick event with the correct href to the row
        e.Row.Attributes.Add("onclick", href);

        //to make it visible to the user that the row can be clicked
        e.Row.Attributes.Add("style", "cursor:pointer;");
    }
} 
```

以及命令方法，您可以在其中从 LinkBut​​ton 获取 CommandArgument 并用它做各种巧妙的事情。

```
protected void LinkButton1_Command(object sender, CommandEventArgs e)
{
    //the row index of the clicked row from the grid if needed
    int rowIndex = Convert.ToInt32(e.CommandArgument);

    //do stuff
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T15:23:56.400

没有现有的事件来处理整行点击。最好的办法是让一些 javascript（可能通过 ASP.NET Ajax）检测点击并自己触发事件。或者，您必须创建用户选择的按钮或复选框。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T15:25:15.103

您需要处理“SelectedIndexChanged”事件，然后可以在网格中查询 .SelectedRow。Alternativley 使用设置“e.NewSelectedIndex”的“SelectedIndexChanging”事件

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-26T15:26:26.303

查看Teemu 的[这篇文章](http://aspadvice.com/blogs/joteke/archive/2006/01/07/14576.aspx)，他在其中解释了单击 Gridview 中的一行并引发 RowClicked 事件。

这是代码的摘录：

```
Protected Overrides Sub RaisePostBackEvent(ByVal eventArgument As String)
            If eventArgument.StartsWith("rc") Then
                Dim index As Integer = Int32.Parse(eventArgument.Substring(2))
                Dim args As New GridViewRowClickedEventArgs(Me.Rows(index))
                OnRowClicked(args)
            Else
                MyBase.RaisePostBackEvent(eventArgument)
            End If

        End Sub

 Public Class GridViewRowClickedEventArgs
        Inherits EventArgs

        Private _row As GridViewRow
        Public Sub New(ByVal row As GridViewRow)
            _row = row
        End Sub
        Public ReadOnly Property Row() As GridViewRow
            Get
                Return _row
            End Get
        End Property
    End Class 
```

顺便说一句，它在 VB 而不是 C# 中。

# mysql - 如何将 MySQL 中的内容加载到 Flex 中的 Horizo ntalList

> ID：686241
> 
> 赞同：0
> 
> 时间：2009-03-26T15:19:49.593
> 
> 标签：mysql, apache-flex, flex3, horizontallist

如何将文本从 MySQL 加载到 Flex3 中的 Horizo​​ntalList？

**我在用 ：**

```
<mx:ControlBar x="10" y="40" width="460" height="230">
            <mx:HorizontalList id="dataGrid"
                    dataProvider="{dataArr}"
                    labelField="lbl"
                    iconField="src"
                    itemRenderer="CustomItemRenderer"
                    columnCount="4"
                    columnWidth="100"
                    rowHeight="100"
                    horizontalScrollPolicy="on"
                    width="439" height="230"/>
        </mx:ControlBar> 
```

**并在 CustomItemRenderer.mxml**

```
<mx:VBox horizontalAlign="center" verticalAlign="middle">

    <mx:Image source="{data.@thumbnailImage}" />

    <mx:Label text="{data.@nomept}" />

</mx:VBox> 
```

我还做了“从数据库创建应用程序..”并尝试与成功集成但没有成功。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-30T08:05:51.337

您需要使用“服务器端解决方案”，例如 php/rails/python/cf/etc... 以便将 mySQL 数据获取到 Flex。您不能直接从 actionscript/flex 执行 mySQL 查询，如果您使用 Adob​​e AIR，则可以与 sqlite3 通信

干杯

# c# - 使用 Repository(ies) 方法的帮助

> ID：686244
> 
> 赞同：0
> 
> 时间：2009-03-26T15:20:40.403
> 
> 标签：c#, design-patterns, domain-driven-design

我是这个存储库云雀的新手，因此非常感谢您的帮助。

我正在尝试设计一种方法来为我们所有的网站建立一个中央支付网站。这些站点将填充一个返回 GUID 的表。所有站点都将 GUID 传递给中央支付站点。中央支付站点将查看查询字符串并使用 GUID 检索有关订单的详细信息以及哪个站点调用它。我正在尝试使其灵活，因此以下 1) 可以在给定时间使用不同的支付提供商（即 Paypal、Google Check）而无需大麻烦 2) 可以使用不同的 DB(orm) 层（我们在时刻，但可以使用 LINQ 等）

我不确定如何实现这一点。有什么建议么？

谢谢

波奇

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T15:32:29.407

首先创建一个服务层，然后使用一个接口来抽象它——这将是我的开始建议。

```
public interface IPaymentService
{
  Guid PopulateTable();
  Order GetOrder(Guid id);
}

public class PayPalPaymentService : IPaymentService
{
  public Guid PopulateTable() { ... }
  public Order GetOrder(Guid id) { ... }
}

public class GooglePaymentService : IPaymentService
{
  public Guid PopulateTable() { ... }
  public Order GetOrder(Guid id) { ... }
} 
```

假设您可以将“存储库”替换为“服务”，因为我认为这就是您所追求的，但我认为您对存储库的想法有点不同。

我会使用存储库来处理对数据库的查询......

那些看起来更像：

```
T Get<T>(Guid id);
IList<T> FindAll<T>(Guid fid); 
```

PayPal 和 Google 服务（/存储库）将使用它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T16:47:08.027

首先考虑这是一个应用有界上下文的好地方：http: [//dddcommunity.org/discussion/messageboardarchive/BoundedContext.html](http://dddcommunity.org/discussion/messageboardarchive/BoundedContext.html)。理想情况下，您不应该通过数据库集成不同的（子）系统。这应该发生在 api 级别。你可能已经有这样的结构，假设：

*   所有站点正在填充的“表”并不是所有站点的单个共享信息。真正的目的是每个站点保存它需要的关于它即将开始的过程的任何信息，并获得一个将交给支付系统的 ID。
*   支付系统不应该在不同的网站上强制使用唯一的 ID。它可以强制每个网站在他们自己的上下文中发送一个唯一的 id。
*   如果支付系统需要额外的信息，它也应该在 API 级别需要它，而不是在所有站点和支付系统之间强制建立数据库关系。

您可以让网站调用支付网站上的 API 以启动支付流程，然后重定向到该网站。您可以使用每个网站控制的 ID，也可以使用支付网站在初始支付调用后返回的通用 ID。

考虑到这一点，存储库将在内部使用，并且由站点和支付服务独立使用以保存信息。这并不一定意味着它必须是数据库，因为您可以将信息保存到其他地方/机制。

# sql - 如何查找影响特定列的存储过程列表？

> ID：686247
> 
> 赞同：8
> 
> 时间：2009-03-26T15:21:30.790
> 
> 标签：sql, sql-server, sql-server-2005, stored-procedures

我正在研究这个大型数据库，它在 SP 中嵌入了很多业务知识[我知道！]，并且 SP 之间有很多链接。即一个存储过程调用另一个。

我想找出更新特定列的存储过程列表。我该怎么做。

[使用存储过程](https://stackoverflow.com/questions/283214/sql-table-and-column-parser-for-stored-procedures)的 SQL 表和列解析器中概述的 showplan_All 对我不起作用，因为这是一个共享的开发数据库。

如上所述使用来自主数据库扫描系统文本的 Sp 是不可行的，因为我无权访问主数据库。

那么我怎样才能找到这些信息呢？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-26T15:49:35.530

你试过这个吗：`EXEC sp_depends @objname = [table name of the column you are interested in]`。

因此，例如，如果您在名为`Price`的表中有一个名为 的列`Product`，您将执行以下操作`EXEC sp_depends @objname = N'Product'`：

只需执行此操作即可为您提供依赖于该特定表的所有 sps、视图等的列表。

我一直在使用它，因为我使用一个有 400 多个表的数据库:-)

[MSDN 上的 sp_depends 页面](https://msdn.microsoft.com/en-us/library/ms189487.aspx)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2012-01-06T11:29:27.333

从系统视图**sys.sql_dependencies**你可以得到列级别的依赖。

```
DECLARE @Schema SYSNAME
DECLARE @Table SYSNAME
DECLARE @Column SYSNAME

SET @Schema = 'dbo'
SET @Table = 'TableName'
SET @Column = 'ColumnName'

SELECT o.name
FROM sys.sql_dependencies AS d
  INNER JOIN sys.all_objects AS o ON o.object_id = d.object_id
  INNER JOIN sys.all_objects AS ro ON ro.object_id = d.referenced_major_id
  INNER JOIN sys.all_columns AS c ON c.object_id = ro.object_id AND c.column_id = d.referenced_minor_id
WHERE (SCHEMA_NAME(ro.schema_id)=@Schema) 
  and o.type_desc = 'SQL_STORED_PROCEDURE'
  and ro.name = @Table
  and c.name = @Column
GROUP BY o.name 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-26T15:28:19.480

尝试这样的事情：

```
use YourDatabase;

select [Name]    
from sys.procedures
where object_definition([object_id]) like '%YourColumnName%'; 
```

显然，根据列的名称，这有可能产生大量误报，但至少您将有一个程序列表进行筛选。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T15:30:05.280

这是在 SQL 2000+ 中工作的一个；请注意，正如 Andrew 在他的文章中所指出的，您会根据您的列名得到误报，但这是一个起点：

```
SELECT DISTINCT o.Name
FROM syscomments c
    JOIN sysobjects o ON c.ID = o.ID
WHERE c.Text LIKE '%ColumnName%'
ORDER BY o.Name 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-12-05T22:08:35.013

```
use msdb
go
select * from sysjobs j
inner join sysjobsteps s
on j.job_id=s.job_id
where command like '%HBR_INSTRUMENT%' 
```

# live-cd - 如何为应用程序创建 LIVE CD

> ID：686248
> 
> 赞同：6
> 
> 时间：2009-03-26T15:21:39.323
> 
> 标签：live-cd

有一些 Live CD 可以启动操作系统并允许您在不安装的情况下使用它。

我想知道是否有一种简单的方法可以自定义 Live CD，以便它只加载运行一个应用程序所需的内容，并运行该应用程序。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T15:28:45.640

在 Ubuntu 中，我使用[Ubuntu Customization Kit](http://uck.sourceforge.net/)定制了一张 Ubuntu Live CD，它在我的计算机中默认加载了我需要的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T15:31:23.730

对于“简单方法”的某些值，是的，但在大多数情况下不是。

如果所需的操作系统是 Windows，如果您查看[BartPE](http://www.nu2.nu/pebuilder/) ，您会发现很多信息。如果您不了解即使在 livecd 上也无法分发 Windows 操作系统，那么您将遇到许可问题，而每个副本都没有 MS 许可证。

Linux livecd 的创建有点复杂，但是有很多人让这个过程更容易，[http://www.linux-live.org/](http://www.linux-live.org/)是一个很好的入门资源。

-亚当

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T16:06:44.927

这取决于您所说的“简单方法”是什么意思。如果您愿意安装和管理操作系统以确保安全和稳定，那么使用您需要安装和自动运行的软件为该操作系统创建 LiveCD 应该不会有太多麻烦。更多细节在很大程度上取决于您尝试运行的操作系统和应用程序类型。

# eclipse - Eclipse RCP 应用程序 - 多显示器的多窗口设计

> ID：686265
> 
> 赞同：5
> 
> 时间：2009-03-26T15:26:28.080
> 
> 标签：eclipse, views, eclipse-rcp, rcp, perspectives

关于 Eclipse RCP 和整个透视图/视图/编辑器设计的问题 - 创建将在多个监视器上显示多个窗口的应用程序的最佳方法是什么？我见过的教程和书籍总是将 RCP/SWT 设计打包到单个应用程序窗口内的透视图中。

一个窗口应该统治所有其他窗口还是它们都应该相等（关闭最后一个退出应用程序）？如何处理观点和观点？还有其他我们应该知道的事情吗？

环境：Eclipse Ganymede，Windows XP。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-31T23:22:53.290

一个 Eclipse 工作台可以创建多个窗口。每个窗口都使用透视图进行布局，因此可以将不同的窗口设置为不同的透视图或相同的透视图，并且您可以独立于其他窗口在每个窗口中切换透视图。

您还可以为每个窗口设置输入。如果每个窗口都在处理不同的数据（例如，每个窗口可以连接到不同的服务器，或者可以显示来自不同数据库的数据，这些数据库都具有相同的架构但不同的数据），这将非常有用。

可能您只使用 Windows，以便您可以在不同的监视器上看到相同数据的不同视角。在这种情况下，您不需要以编程方式创建窗口，而只需添加工作台提供的操作。这可以通过修改 ActionBarAdvisor 类来完成：

添加到字段声明：

```
private IWorkbenchAction newWindowAction; 
```

添加到您进行操作的代码中（通常是一个名为 makeActions 的方法）：

```
 newWindowAction = ActionFactory.OPEN_NEW_WINDOW.create(window);
    register(newWindowAction); 
```

添加到创建菜单的代码中：

```
 menu.add(newWindowAction); 
```

其中 menu 通常是 Window 菜单。如果您的应用程序中还没有 Window 菜单并且想要创建一个，则以下行将起作用：

```
 MenuManager menu = new MenuManager(
      "&Window", 
      IWorkbenchActionConstants.M_WINDOW); 
```

这将为您提供一个菜单项，该菜单项将以与 Eclipse IDE 中的 Window->New Window 菜单项相同的方式创建一个新窗口。

另一方面，如果您希望每个窗口显示不同的数据，那么您需要以编程方式打开新窗口。这允许您为每个窗口设置不同的输入。您将需要一行代码，例如：

```
IWorkbenchPage newPage = window.openPage(inputObject); 
```

其中 inputObject 包含标识窗口中显示的数据的信息。如果要设置初始透视图，可以通过在页面上调用 setPerspective 来完成。

您需要在每个窗口中设置标题：

```
newPage.getWorkbenchWindow().getShell().setText(windowTitle); 
```

其中 windowTitle 是描述窗口输入的字符串。

您可以按如下方式获取窗口的输入：

```
window.getActivePage().getInput() 
```

然后，您可以将其转换为您用作窗口输入的任何类。

# php - php + mysql 行只返回 int

> ID：686272
> 
> 赞同：0
> 
> 时间：2009-03-26T15:28:07.657
> 
> 标签：php, mysql

嗨，我开始使用 php，我有以下脚本

```
<?php

$username = "firstleg_floa";
$password = "**";
$hostname = "***1";
$db = "firstleg_bank";
$guildUser = strtolower('grissiom');

$dbh = mysql_connect( $hostname, $username, $password) or die ("Unable To Connect");
$connectDB = mysql_select_db($db, $dbh);
$results = mysql_query("SELECT * FROM Bank where userId ='" .$guildUser."'");

$i = 0;
$rsArr = array();

While ($row = mysql_fetch_array($results, MYSQL_ASSOC))
{
    $rsArr [$i] [0] = $row{'userId'};
    $rsArr [$i] [1] = $row{'item'};
    $rsArr [$i] [2] = $row{'amount'};
    $rsArr [$i] [3] = $row{'position'};
    $i++;
}
?>
<?="ghdfdgdfg ". $rsArr[$i][1];}." ----";?>
    <? echo $rsArr[$i][0]; ?>
    <table>
    <tr><td>Item</td><td>Amount</td></tr>
    <?for ($x=0;$x <= $i; $x++)
    {?>
    <tr><td><?=$rsArr[$x][3];?></td><td><?=$rsArr[$x][2];?></td></tr>
    <?}?>
    </table>

<?php
mysql_close($dbh); ?> 
```

我在数据库中有以下数据

1 - grissiom - 丝绸 - 100 - 1

有了上面的数据和上面的脚本，我能做到的只是金额（100）和位置（1）我怎么不能把其他东西拿出来？有人能帮助我吗

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T15:38:27.943

这可能是因为您使用的是花括号而不是方括号。返回的行`mysql_fetch_array()`是 PHP 数组，而不是对象或字符串。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T15:41:01.930

可能的解决方案：

1）数据库中的那些列名有不同的大小写，例如**userId**可能只是**userid**

2）那些列不存在。

3）您使用的是大括号，而不是方括号：

```
 $rsArr [$i][0] = $row{'userId'}; //wrong
 $rsArr [$i] [0] = $row['userId']; //correct 
```

尝试用这个替换while循环，它会在数据库将每条记录传递给PHP时读出每条记录的内容：

```
while ($row = mysql_fetch_array($results, MYSQL_ASSOC))
{
    echo '<pre>' . var_dump($row) . </pre>;
} 
```

确切地查看从数据库返回的内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T15:40:46.907

循环结束后 $i 等于 1，但 $rsArr[$i] 没有定义，所以变量 $rsArr[$i][0] 和 $rsArr[$i][1] 不存在，尝试使用$rsArr[0][0] 和 $rsArr[0][1] 像这样：

```
<?="ghdfdgdfg ". $rsArr[0][1];}." ----";?>
    <? echo $rsArr[0][0]; ?>
    <table>
    <tr><td>Item</td><td>Amount</td></tr>
    <?for ($x=0;$x <= $i; $x++)
    {?>
    <tr><td><?=$rsArr[$x][3];?></td><td><?=$rsArr[$x][2];?></td></tr>
    <?}?>
    </table> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T15:40:28.920

对我来说似乎没问题，也许使用花括号会出现问题。

无论如何，我会使用一些更简单的语法，即：

```
<?php

$username = "firstleg_floa";
$password = "**";
$hostname = "***1";
$db = "firstleg_bank";
$guildUser = strtolower('grissiom');

$dbh = mysql_connect( $hostname, $username, $password) or die ("Unable To Connect");
$connectDB = mysql_select_db($db, $dbh);
$results = mysql_query("SELECT * FROM Bank where userId ='" .$guildUser."'");

$i = 0;
$rsArr = array();
while ($row = mysql_fetch_array($results, MYSQL_ASSOC))
{
    $rsArr[] = $row;
}
mysql_close($dbh);
echo '<table><tr><td>Item</td><td>Amount</td></tr>';
for ($i = 0;$i<count($rsArr);$i++){
    echo <<<EOF
    <tr><td>{$rsArr["item"]}</td><td>{$rsArr["amount"]}</td></tr>
EOF;
}
echo '</table>';
 ?> 
```

# iphone - glScissor 帮助 (iPhone OpenGL ES)

> ID：686277
> 
> 赞同：3
> 
> 时间：2009-03-26T15:28:57.997
> 
> 标签：iphone, cocoa-touch, opengl-es

我正在尝试使用 glScissor 仅隔离需要更新的屏幕部分。我有一个游戏区域，我需要更新每一帧，但 UI 区域需要更新的频率要低得多。游戏区域很好，但 UI 区域不断闪烁着看起来像是旧缓冲区数据的东西。

我错过了什么？

这是我的渲染代码：

```
[EAGLContext setCurrentContext:context];
glBindFramebufferOES(GL_FRAMEBUFFER_OES, viewFramebuffer);

if (needsUIUpdate)
{
   // clear entire screen
   glScissor(0, 0, 320, 480);

   glClear(GL_COLOR_BUFFER_BIT);

   needsUIUpdate = NO;
   [self updateUI];
}
else
{
   glScissor(0, 80, 320, 400);
   glClear(GL_COLOR_BUFFER_BIT);
}

for (Cell* c in allCells)
   [c animate];

glBindRenderbufferOES(GL_RENDERBUFFER_OES, viewRenderbuffer);
[context presentRenderbuffer:GL_RENDERBUFFER_OES]; 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-27T10:58:58.887

你`kEAGLDrawablePropertyRetainedBacking`在你的使用`CAEAGLLayer`吗？如果您不将此设置为`YES`，则不能保证在渲染后保留缓冲区的内容。换句话说，他们正在进行双缓冲渲染：有 2 个单独的缓冲区。一个正在显示，一个正在渲染。当您渲染一帧并显示它时，下一帧将渲染到另一个缓冲区，因此不会保留内容。（这就解释了为什么如果你不清除那块屏幕，你会看到垃圾。）如果你使用这个标志，图形系统可能会在翻转过程中复制数据，以便保留内容。

使用此标志将使您的应用程序占用更多内存和更多时间来渲染，因此对于上述优化可能不值得。您必须对其进行分析并查看。（有关更多信息，请参阅[Apple 文档](http://developer.apple.com/iphone/library/documentation/iPhone/Reference/EAGLDrawable_Ref/EAGLDrawable/EAGLDrawable.html)。）

您还可以查看[GLPaint](https://developer.apple.com/iphone/library/samplecode/GLPaint/index.html)演示 - 它使用此属性来避免每次都重绘屏幕。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T10:39:57.277

你绝对错过了：

```
glEnable(GL_SCISSOR_TEST); 
```

虽然我不确定这是否足以解释您所看到的文物，但只是想指出这一点。根据[文档](http://www.khronos.org/opengles/documentation/opengles1_0/html/glScissor.html)，默认情况下未启用剪刀测试。

# db2 - DB2 的 SQLLDR / BCP 等效项

> ID：686281
> 
> 赞同：1
> 
> 时间：2009-03-26T15:29:57.603
> 
> 标签：db2

我的产品需要支持 Oracle、SQLServer 和 DB2 v9。我们正在尝试找出定期将数据加载到数据库中的最有效方法。目前，单个插入语句需要 40 多分钟，但当我们使用 SQLLDR 或 BCP 时只需几分钟。DB2 中是否存在允许将 CSV 数据快速加载到数据库中的等效项？

我们的软件运行在windows上，所以我们需要假设数据库运行在远程系统上。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T15:37:13.733

加载：

[http://publib.boulder.ibm.com/infocenter/db2luw/v8/index.jsp?topic=/com.ibm.db2.udb.doc/core/r0008305.htm](http://publib.boulder.ibm.com/infocenter/db2luw/v8/index.jsp?topic=/com.ibm.db2.udb.doc/core/r0008305.htm)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-12-30T06:12:14.413

如果数据是 CSV 格式，请尝试使用分隔符将数据导入为 coma(,)

```
db2 import from <filename> of del modified by coldel, insert into <Table Nmae> 
```

否则你可以使用加载命令 - 从文件加载

```
db2 load client from /u/user/data.del of del
  modified by coldel, insert into mytable 
```

# asp.net-mvc - 如何在 ASP.NET MVC 1 中获取静态表达式 ActionLinks 等？

> ID：686284
> 
> 赞同：0
> 
> 时间：2009-03-26T15:30:11.830
> 
> 标签：asp.net-mvc

我读过很多例子

```
<li><%= Html.ActionLink("Home", "Index", "Home")%></li> 
```

被改写为

```
<li><%= Html.ActionLink<HomeController>(c => c.Index(), "Index")%></li> 
```

但是，对于一个新的 ASP MVC 项目，这不会编译。我读过它与需要添加 ASP MVC Futures 程序集有关。这是正确的，如果是这样，我从哪里得到它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T15:46:14.477

是的，您需要 ASP.NET MVC Futures 程序集，它在此处可用于 1.0：

[http://aspnet.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=24471](http://aspnet.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=24471)

# c# - 在库项目中查找使用的函数

> ID：686289
> 
> 赞同：1
> 
> 时间：2009-03-26T15:32:08.223
> 
> 标签：c#, function

我们有几个库项目，它们被引用为 using 语句，如下所示：

```
Using XYZ.Controllers;
namespace test
{
   Public partial class testing: System.Web.UI.Page 
   //...
   Private void aTest()
   {
      string Fred=AController.GetAName();
   }
   //...
} 
```

控制器 AController 将在另一个项目 (XYZ) 中创建，该项目如上所述从该项目中引用。我想做的是确定 XYZ 项目中哪些例程不再使用。（因为代码更改，新要求等）。

有谁知道找出哪些函数被调用和哪些没有被调用的方法？

西蒙

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T15:34:15.283

如果您愿意付费，[ReSharper可以做到这一点。](http://www.jetbrains.com/resharper/)

[FxCop](http://msdn.microsoft.com/en-us/library/bb429476.aspx)将为已编译的代码执行此操作。这是一个免费的实用程序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T15:37:45.480

好的，以下不是直截了当的，但很简单，应该会给出很好的结果：

1.  创建引用库的备份（如果您可以使用自己喜欢的 SCM 工具轻松恢复更改，则不需要）。
2.  将所有成员设为私有（搜索和替换）。
3.  编译和错误列表将显示所有使用的成员。

# javascript - 借用构造函数和原型链

> ID：686290
> 
> 赞同：1
> 
> 时间：2009-03-26T15:32:24.307
> 
> 标签：javascript

在许多书籍和在线教程中，都有通过借用方法模式将数据传递给超类构造函数的示例：

```
var Parent = function(name)
{
    this.name = name;
    this.my_parent = "parent_property";
    this.go = function()
    {
        alert("GO")
    }   

}

var Child = function(name)
{  
    this.name = name;
    this.my_child = "child_property";

    Parent.call(this);

    alert(this.hasOwnProperty("go")) // HERE TRUE!!!
}

var ChildChild = function(name)
{
    this.name = name;
    this.su = function(){}
}

// PSEUDO CLASSICAL ECMA STANDARD
Child.prototype = new Parent("PARENT"); 
ChildChild.prototype = new Child("CHILD"); 
var c = new ChildChild("CHILDCHILD"); 
```

现在我的问题是：这是正确的吗？在这种模式下，超类的属性被复制到 THIS 中，但在 OOP 系统中，我认为这些属性必须在其超类中。现在 BORROWING 构造函数只是进行某种继承的另一种模式，所以我不能使用原型，所以所有链超类属性都在最后一个子类中......但我认为它不是有效的。

那么，最后，我如何在没有这种模式的情况下将数据传递给超类？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-02T19:11:35.200

JavaScript 是一种**基于原型的**函数**式语言**，它伪装成 Java 的表亲。

以下是关于 JavasSript 的一些关键事项：

*   一切都是对象，包括函数
*   Object更像Hash，是键值对的集合
*   原型本身也是对象

**要回答关于“借用”原型性能的第一个问题：**

通常，一个 JavaScript 类包含一组*[name, function object]*对。当您借用*父类的**原型*时，您基本上是将父原型对象的值复制到子类的原型对象中。

 *复制是通过*引用*，复制函数时，不复制函数代码，只复制引用。这类似于 C 语言中的函数指针。

> 因此，唯一的性能损失是原型对象的复制，它占用的内存非常少。

**要回答如何以干净的方式将数据传递给父类的第二个问题：**

有许多库已经内置了一些 OOP 样式继承。您也可以自己滚动，但这不是微不足道的。

**我推荐一个名为[Joose](http://code.google.com/p/joose-js/)的框架。**

*   它支持类、继承、混合、特征、方法修饰符等。
*   稳定并在生产环境中使用。
*   优雅，将为您节省大量按键

> 使用 Joose，可以覆盖或扩充父构造函数，并且将提供 SUPER() 或 INNER() 方法来访问原始构造函数或子类构造函数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T15:56:17.167

通过调用 .call() 你不会继承这个词的经典意义，而是告诉 Child 将 Parent 原型应用于自身，因此 Child.prototype 已经从 Parent 克隆了属性和方法。这在性能方面没有任何问题，尽管出于效率原因放弃原型并不是一个正当理由。

老实说，我认为在 javascript 上强制执行 OO 范例是 javascript 开发人员可能犯的最大错误。就像必须学习处理函数式编程中的不变性一样，试图让 javascript 表现得像经典的 OO 一样，从长远来看只会对你不利。

它没有回答您的问题，但是有很多不同的方法可以将[超级功能应用于 javascript](http://www.google.nl/search?rlz=1C1GGLS_enNL311NL317&sourceid=chrome&ie=UTF-8&q=javascript+super+OO)，但我不推荐任何一种方法，因为没有确定的版本不会在未来的某个地方带来缺点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T16:10:53.527

JavaScript 没有对构建继承层次结构的固有支持。JavaScript 进行类型扩展的方式是将属性从“父类”添加到“子类”，即

```
function Parent(foo) {
    this.foo = foo;
}

Parent.prototype.sharedFoo = 'sharedFoo';

function Child(foo, bar) {
    // call the parent constructor
    Parent.call(this, foo);
    this.bar = bar;
}

Child.prototype.sharedBar = 'sharedBar';

// copy the properties of the parent class
for(var prop in Parent.prototype) {
    if(Parent.prototype.hasOwnProperty(prop))
        Child.prototype[prop] = Parent.prototype[prop];
} 
```

添加真正的原型继承也很容易，例如[像这样](http://mercurial.intuxication.org/hg/js-hacks/raw-file/tip/clone.js)。

通过使用该`clone()`函数，现在可以让“子类”的原型对象继承自“基类”的原型对象：

```
function Parent(foo) {
    this.foo = foo;
}

Parent.prototype.sharedFoo = 'sharedFoo';

function Child(foo, bar) {
    // call the parent constructor
    Parent.call(this, foo);
    this.bar = bar;
}

// inherit from the parent class
Child.prototype = clone(Parent.prototype);

Child.prototype.sharedBar = 'sharedBar'; 
```

# jquery - Jquery圆角和Div - 删除差距？

> ID：686295
> 
> 赞同：1
> 
> 时间：2009-03-26T15:33:34.397
> 
> 标签：jquery, html, rounded-corners

谁能告诉我如何从以下代码中删除在 div 中间生成的间隙：（粘贴并命名 test.html）

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
 <head>
   <script src="http://www.google.com/jsapi"></script>
   <script>google.load("jquery", "1.2.6")</script>
   <script src="jquery.corners.js"></script>
 </head>
<body>

<div id="divOuterOuter" style="width: 448px; height: 157px; padding-right:
0px;padding-left: 0px; padding-bottom: 0px; margin: 0px; padding-top: 0px;">

  <div style="width: 448px; height: 120px; background-color:#d1ddf1; padding-right: 
  0px; padding-left: 0px; padding-bottom: 0px; margin: 0px 0px 25px; padding-top: 
  0px;" 
  id="divOuter" class="rounded {20px}"> 
  </div>
</div>

 <script>$(document).ready( function(){
        $('.rounded').corners();
        });</script>
</body>
</html> 
```

提前致谢！

**问题** [示例 示例问题 http://image2.humyo.com/I/9176883-444407271/M2QyZmIxYThiMDVhM2NlODYwMjM4MDI2MDA0MmI5Y2I=/450/450/0/1238082866.jpg](http://image2.humyo.com/I/9176883-444407271/M2QyZmIxYThiMDVhM2NlODYwMjM4MDI2MDA0MmI5Y2I=/450/450/0/1238082866.jpg)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T15:57:42.593

角落插件（至少我在[http://www.malsup.com/jquery/corner/](http://www.malsup.com/jquery/corner/)中找到的那个）是用“角落”而不是“角落”调用的。

尝试改用这个：

```
<script type="text/javascript">
  $(document).ready( function(){
    $('.rounded').corner();
  });
</script> 
```

这对我来说在 IE 7 和 Opera 10 中运行良好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-29T02:27:56.810

移除 div#divOuter 上 25px 的下边距。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T02:43:46.507

出现有争议且可能没有帮助的答案：

采用：

```
-moz-border-radius      /* for firefox */
-webkit-border-radius   /* for webkit browsers */ 
```

并忽略 Internet Explorer。圆角是一种视觉上的精美，通常不是功能性元素，所以当其他体面的浏览器使它变得如此简单和可靠时，权衡你想要投入多少努力让它为 IE 用户工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-04T04:49:22.637

我相信泰勒有正确的答案。我想补充一点，我在 FireFox 中开发是出于这样的原因。使用[Firebug 插件](http://getfirebug.com/)可以更轻松地追踪此类 CSS 问题。您可以使用“检查”并选择有问题的对象并在 FireBug 中动态编辑 CSS 以确定导致间隙的原因。

# python - 使用 Python 将二进制数据写入套接字（或文件）

> ID：686296
> 
> 赞同：9
> 
> 时间：2009-03-26T15:33:57.547
> 
> 标签：python

假设我有一个套接字连接，而另一端的第 3 方侦听器希望看到数据以非常结构化的方式流动。例如，它查找一个表示正在发送的消息类型的无符号字节，然后是一个表示消息长度的无符号整数，然后是另一个无符号字节，它实际上是一个带有设置或未设置标志的位字段等。 .

我将如何在 python 中执行此操作？我只是想知道如何可靠地生成这些数据并确保我正确地发送它（即我真的在发送一个无符号字节而不是一个有符号整数或更糟的是一个字符串）。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-26T15:38:37.363

使用[struct](http://docs.python.org/library/struct.html)模块构建缓冲区并写入。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-26T16:16:57.740

处理 Python 对象和二进制表示（双向）之间的这些转换的一种非常优雅的方法是使用[Construct 库](http://construct.wikispaces.com/)。

在他们的文档中，您会发现许多使用它的好例子。几年来，我自己一直在使用它来进行串行通信协议和解码二进制数据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T15:52:26.303

在最低级别，套接字 I/O 包括读取或写入一串字节值到套接字。为此，我将要写入的信息编码为包含字节值的字符串，并将其写入套接字。我通过创建一个超字符串，然后一次附加一个字符来做到这一点。例如，要创建 Modbus/以太网读取请求：

```
 readRequest = """"""
    readRequest += chr(self.transactionID / 0x100)  # Transaction ID MSB         (0)
    readRequest += chr(self.transactionID % 0x100)  # Transaction ID LSB         (1)
    readRequest += chr(0)                           # Protocol ID MSB (Always 0) (2)
    readRequest += chr(0)                           # Protocol ID LSB (Always 0) (3)
    readRequest += chr(0)                           # Length MSB (Always 0)      (4)
    readRequest += chr(6)                           # Length LSB (Always 6)      (5)
    readRequest += chr(0)                           # Unit ID (Always 0)         (6)

    readRequest += chr(0x04)                        # Function code 4     (0)
    readRequest += chr(startOffset / 0x100)         # Starting offset MSB (1)
    readRequest += chr(startOffset % 0x100)         # Starting offset LSB (2)
    readRequest += chr(0)                           # Word count MSB      (3)
    readRequest += chr(2 * nToRead)                 # Word count LSB      (4)

    sockOutfile.write(readRequest) 
```

要将多字节值转换为字符串以便它们可以附加到 I/O 字符串中，请使用 struct 模块中的 'Pack()' 函数。此函数将一个或多个单个或多个字节值转换为一串单独的字节值。

当然，这种方法和锤子一样简单。当字符串中的默认字符编码是 Unicode 而不是 ASCII 时，需要修复它。

# oracle - 使用 impdp 导入选择性数据

> ID：686297
> 
> 赞同：6
> 
> 时间：2009-03-26T15:34:00.200
> 
> 标签：oracle, import, impdp

我有一个完整的数据库要作为转储导入到我自己的数据库中。我想从某些表中排除数据（主要是因为它们很大而且没用）。我不能完全排除这些表，因为我需要表对象本身（减去数据），如果这样做，我必须在我的模式中重新创建它们。同样在没有这些表对象的情况下，其他表上定义的各种其他外部约束也将无法导入，需要重新定义。所以我只需要排除某些表中的数据。我想要所有其他表中的数据.

impdp 是否有一组参数可以帮助我这样做？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-26T16:56:22.763

我会运行两次：第一次我只导入元数据：

`impdp ... CONTENT=METADATA_ONLY`

第二个将仅包含我感兴趣的表的数据：

`impdp ... CONTENT=DATA_ONLY TABLES=table1,table2...`

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-31T16:23:57.573

肯定跑2次。一种是创建所有表对象，但不是在第二次 impdp 运行中使用表，而是使用排除

```
impdp ... Content=data_only exclude=TABLE:"IN ('table1', 'table2')" 
```

另一种方法可行，但这种方法你只需要列出你不想要的表和你想要的所有表。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-01-11T09:27:46.530

句法：

```
EXCLUDE=[object_type]:[name_clause],[object_type]:[name_clause]
INCLUDE=[object_type]:[name_clause],[object_type]:[name_clause] 
```

运算符用法示例：

```
 EXCLUDE=SEQUENCE
or EXCLUDE=TABLE:"IN ('EMP','DEPT')"
or EXCLUDE=INDEX:"= 'MY_INDX'"
or INCLUDE=PROCEDURE:"LIKE 'MY_PROC_%'"
or INCLUDE=TABLE:"> 'E'" 
```

参数也可以存储在参数文件中，例如：`exp.par`

```
DIRECTORY = my_dir
DUMPFILE = exp_tab.dmp
LOGFILE = exp_tab.log
SCHEMAS = scott
INCLUDE = TABLE:"IN ('EMP', 'DEPT')" 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-08-11T06:37:20.433

如果表的大小对于导出导入来说很大，你可以在 expdp 命令中使用“SAMPLE”参数来导出你想要的任何百分比的表......

```
$ expdp tables=T100test DIRECTORY=expimp1 DUMPFILE=test12.dmp SAMPLE = 10; 
```

此命令将仅导出 T100test 表数据的 10% 数据。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-08-29T12:39:26.760

使用 impdp 查询参数导入时似乎可以直接排除

```
impdp [...] QUERY='TABLE_NAME:"WHERE rownum = 0"' 
```

参考：[community.oracle.com](https://community.oracle.com/thread/2336851)

# c++ - log4cpp 给出“未解决的外部”错误

> ID：686300
> 
> 赞同：1
> 
> 时间：2009-03-26T15:34:32.210
> 
> 标签：c++, logging, c++builder-2007

我正在尝试使用该库并运行 Borland Codegear 2007 上最新版本的 log4cpp 提供的测试，其中包含 Borland C++ Builder 5 的 bpr 项目，该项目旨在能够构建和运行不同的测试。问题是我试图用2007版本打开这个项目，它必须进行项目转换。我遇到了奇怪的“未解决的外部”错误。然后我尝试自己构建项目而不进行任何转换，但被困在同一点上。

我正在尝试运行以下测试：

```
#include <stdio.h>
#include "log4cpp/Portability.hh"
#ifdef LOG4CPP_HAVE_UNISTD_H
#include <unistd.h>
#endif
#include <iostream>
#include "log4cpp/Category.hh"
#include "log4cpp/Appender.hh"
#include "log4cpp/FileAppender.hh"
#include "log4cpp/OstreamAppender.hh"
#ifdef LOG4CPP_HAVE_SYSLOG
#include "log4cpp/SyslogAppender.hh"
#endif
#include "log4cpp/Layout.hh"
#include "log4cpp/BasicLayout.hh"
#include "log4cpp/Priority.hh"
#include "log4cpp/NDC.hh"

int main(int argc, char** argv) {
    log4cpp::Appender* appender;
#ifdef LOG4CPP_HAVE_SYSLOG
    log4cpp::SyslogAppender* syslogAppender;

    syslogAppender = new log4cpp::SyslogAppender("syslog", "log4cpp");
#else
    log4cpp::Appender* syslogAppender;

    syslogAppender = new log4cpp::OstreamAppender("syslogdummy", &std::cout);
#endif

    if (argc < 2) {
        appender = new log4cpp::OstreamAppender("default", &std::cout);
    } else {
        appender = new log4cpp::FileAppender("default", argv[1]);
    }

    syslogAppender->setLayout(new log4cpp::BasicLayout());
    appender->setLayout(new log4cpp::BasicLayout());

    log4cpp::Category& root = log4cpp::Category::getRoot();
    root.addAppender(syslogAppender);
    root.setPriority(log4cpp::Priority::ERROR);

    log4cpp::Category& sub1 = log4cpp::Category::getInstance(std::string("sub1"));
    sub1.addAppender(appender);

    log4cpp::Category& sub2 = log4cpp::Category::getInstance(std::string("sub1.sub2"));

    log4cpp::NDC::push(std::string("ndc1"));

    std::cout << " root prio = " << root.getPriority() << std::endl;
    std::cout << " sub1 prio = " << sub1.getPriority() << std::endl;
    std::cout << " sub2 prio = " << sub2.getPriority() << std::endl;

    root.error("root error");
    root.warn("root warn");
    sub1.error("sub1 error");
    sub1.warn("sub1 warn");
    sub2.error("sub2 error");
    sub2.warn("sub2 warn");

    sub1.setPriority(log4cpp::Priority::INFO);
    std::cout << " root prio = " << root.getPriority() << std::endl;
    std::cout << " sub1 prio = " << sub1.getPriority() << std::endl;
    std::cout << " sub2 prio = " << sub2.getPriority() << std::endl;

    std::cout << "priority info" << std::endl;
    root.error("root error");
    root.warn("root warn");
    sub1.error("sub1 error");
    sub1.warn("sub1 warn");
    sub2.error("sub2 error");
    sub2.warn("sub2 warn");

    sub2.warnStream() << "streamed warn";

    sub2 << log4cpp::Priority::WARN << "warn2" << " warn3" 
             << log4cpp::eol << " warn4";

    {
        for(int i = 0; i < 10000; i++) {
            char ndc2[20];
            sprintf(ndc2, "i=%d", i);
            log4cpp::NDC::push(ndc2);
            sub1.info("%s%d", "i = ", i);
            if ((i % 10) == 0) {
                sub1.log(log4cpp::Priority::NOTICE, "reopen log");
                if (log4cpp::Appender::reopenAll()) {
                    sub1.info("log reopened");
                } else {
                    sub1.warn("could not reopen log");
                }
            }
#ifndef WIN32
            sleep(1);
#endif
            log4cpp::NDC::pop();
        }
    }

    return 0;
} 
```

这些错误都是关于“未解决的外部”的，例如：

```
[ILINK32 Error] Error: Unresolved external 'log4cpp::Category::warn(const char *, ...)' referenced from C:\DOCUMENTS AND SETTINGS\MLERMA\MIS DOCUMENTOS\RAD STUDIO\PROJECTS\DEBUG\TESTMAIN.OBJ 
```

每次调用 log4cpp 函数时，我都会遇到这种错误，所有这些都指的是 TESTMAIN.OBJ 。

对此有什么想法吗？有没有人在 Borland 上使用过 log4cpp ？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T15:40:34.303

您是否在 log4cpp 库 (.LIB) 中进行链接？我不熟悉 BCB5 或 Codegear，但请检查项目设置中的链接库并确保包含 log4cpp 库。

如果是这样，那么您可能对编译器在哪里寻找库有疑问。通常，IDE 将具有项目级别或全局设置，说明编译器将在何处查找 .lib 文件。检查该设置并确保其中一个目录包含您的 log4cpp .lib 文件。

麦克风

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-01-21T06:36:45.797

尝试添加`#pragma comment(lib,"ws2_32.lib")`你的头文件。

# wpf - 确定导致 LayoutUpdate/ArrangeOverride 发生的原因？

> ID：686302
> 
> 赞同：5
> 
> 时间：2009-03-26T15:35:27.263
> 
> 标签：wpf

我有一个自定义面板，在调整大小时，它的 LayoutUpdated 事件和 ArrangeOverride 被调用了两次。

因此，最初 MeasureOverride 和 ArrangeOverride 在打开客户端窗口时执行它们的操作。然后，如果我最大化窗口，每个窗口都会被调用两次。每次迭代之间的可用和最终尺寸分别没有不同，所以我不确定是什么引发了这个。

有没有办法确定失效的原因？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-10-21T02:59:26.410

我认为它被调用了两次，因为高度和宽度发生了变化。我认为这两个属性都会影响 Measure，因此每个属性都有一个布局通道。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-11-03T04:07:06.847

> 有没有办法确定失效的原因？

失效通常是由 DependencyProperty 的更改引起的，其中 FrameworkPropertyMetadataOptions 具有标志 AffectsMeasure/AffectsOverride。

正如 Pavel 已经说过的 - 宽度和高度的变化很可能会触发失效。

无论如何，您不应该依赖这些失效的数量。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T16:01:43.503

我想说最简单的方法是为每个方法设置一个断点并观察调用堆栈。您将能够看到在调用您的方法之前发生了什么。

# c# - 将基类型列表转换为继承类型列表

> ID：686305
> 
> 赞同：20
> 
> 时间：2009-03-26T15:36:38.790
> 
> 标签：c#, generic-list

我敢肯定，这个问题解决了在上一个问题中提出的问题，但我找不到它。

C# 类中有一个方法将基类的通用列表作为参数。我需要传递一个继承类的列表，但不知道该怎么做。我在尝试中遇到错误。下面是说明这一点的示例代码：

```
public class A
{
   public static void MethodC(List<A>)
   {
       // Do Something here with the list
    }
}
public Class B : A
{
   // B inherits from A, A is the Base Class   
}

// Code utilizing the above method 
List<B> listOfB = new List<B>();
A.MethodC( (List<A>) listOfB );  // Error: this does not work
A.MethodC( listOfB.ToList<typeof(A)>() ); // Error: this does not work
A.MethodC( listOfB.ConvertAll<A>(typeof(A)) ); // Error: this does not work
// how can I accomplish this?  It should be possible I would think 
```

注意：这是我的最终工作方法作为参考。我的问题得到了更好的解决方案，但从技术上讲，这不是问题的答案，因为我的问题措辞不当。

```
 public static DataTable 
    ObjectCollectionToDataTable<GLIST>
      (List<GLIST> ObjectCollection) where GLIST 
              : BaseBusinessObject
        {
            DataTable ret = null;

            if (ObjectCollection != null)
            {
                foreach ( var b in ObjectCollection)
                {

                    DataTable dt = b.ToDataTable();
                    if (ret == null)
                        ret = dt.Clone();
                    if (dt.Rows.Count > 0)
                        ret.Rows.Add(dt.Rows[0].ItemArray);
                }
            }

            return ret;
        } 
```

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-03-26T15:38:58.767

如果你有可用的 linq，你可以做

```
var ListOfA = ListOfB.Cast<A>().ToList(); 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-26T15:41:14.287

你不能这样做。要理解为什么不允许它，想象一下如果在 a被强制转换为 a 之后`Add`调用它会发生什么。`List<Derived>``List<Base>`

此外，暗示 C# 4.0 将有所不同的答案是错误的。永远不会修改列表以允许您执行此操作。只会`IEnumerable`- 因为它不允许将项目添加到集合中。

更新：它在您所寻求的解决方案中起作用的原因是因为您不再传递相同的列表。您正在创建一个全新的列表，它是原始列表的副本。这就是我询问修改列表的原因；如果`MethodC`更改列表中的项目数量，这些更改将针对副本，而不是原始列表。

我认为适合您的理想解决方案如下：

```
public abstract class A
{
    public void MethodC<TItem>(List<TItem> list) where TItem : A
    {
        foreach (var item in list)
            item.CanBeCalled();
    }

    public abstract void CanBeCalled();
}

public class B : A
{
    public override void CanBeCalled()
    {
        Console.WriteLine("Calling into B");
    }
}

class Program
{
    static void Main(string[] args)
    {
        List<B> listOfB = new List<B>();

        A a = new B();

        a.MethodC(listOfB);
    }
} 
```

请注意，使用此解决方案，您可以`List<B>`直接将 a 传递给，`MethodC`而无需先对其进行奇怪的转换。所以没有不必要的复制。

之所以可行，是因为我们已经告诉我们`MethodC`要接受从 派生的任何内容的列表`A`，而不是坚持它必须是 的列表`A`。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-26T15:39:13.400

您正在解决当前 C# 版本中缺乏协方差的问题。这是一种方法：

```
listOfB.Cast<A>(); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-11-27T15:31:54.430

这是一个答案，它将排除您列表中错误类型的任何对象。在我看来，这是一种更安全的方式：

```
List<A> ListOfA  = ListOfB.OfType<A>().ToList(); 
```

OfType 方法将排除错误派生类的项目，因为 Cast 将引发错误。

# c# - DataGridView：编辑时更改编辑控件大小

> ID：686309
> 
> 赞同：8
> 
> 时间：2009-03-26T15:37:18.147
> 
> 标签：c#, datagridview, edit

在*DataGridView*中，我希望在编辑单元格时根据字符串长度扩展单元格大小。Excel 也是如此。

在*DataGridView*中，进入编辑模式时，在单元格位置放置一个*DataGridViewTextBoxEditingControl 。*我试图改变这个控件的边界/大小，但结果只是我想要的大小的短暂闪烁。它直接覆盖了原始的截断方式。

关于如何使它工作的任何想法？

谢谢，

蒂莫

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2014-05-16T20:07:24.240

这个问题很老了，但希望我的回答能帮助别人。我遇到了同样的问题，并且能够使用类似于以下的过程来使列宽在用户键入时动态更新，以确保文本适合列。

使用的事件：

*   `CellBeginEdit`
*   `CellEndEdit`
*   `EditingControlShowing`
*   `TextBoxKeyPressEvent`（即`KeyPress`）

**注意：**以下代码假定`AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.AllCells`

```
// ---------------------------------------------------------------------------

private void dataGridView1_CellBeginEdit(object sender, DataGridViewCellCancelEventArgs e)
{
    // Copies the original column width because switching to DataGridViewAutoSizeColumnMode.None
    // will automatically make the column a default width.
    int origColumnWidth = dataGridView1.Columns[e.ColumnIndex].Width;

    dataGridView1.Columns[e.ColumnIndex].AutoSizeMode = DataGridViewAutoSizeColumnMode.None;

    // Reverts back to the original width.
    dataGridView1.Columns[e.ColumnIndex].Width = origColumnWidth;
}

// ---------------------------------------------------------------------------

private void dataGridView1_CellEndEdit(object sender, DataGridViewCellEventArgs e)
{
    dataGridView1.Columns[e.ColumnIndex].AutoSizeMode = DataGridViewAutoSizeColumnMode.AllCells;
}

// ---------------------------------------------------------------------------

private void dataGridView1_EditingControlShowing(object sender, DataGridViewEditingControlShowingEventArgs e)
{
    if (e.Control is TextBox)
    {
        var tbox = (e.Control as TextBox);

        // De-register the event FIRST so as to avoid multiple assignments (necessary to do this or the event
        // will be called +1 more time each time it's called).
        tbox.KeyPress -= TextBoxKeyPressEvent;
        tbox.KeyPress += TextBoxKeyPressEvent;
    }
}

// ---------------------------------------------------------------------------

private void TextBoxKeyPressEvent(object sender, KeyPressEventArgs e)
{
    // Gets the text prior to the new character being added.  Appending an arbitrary "0" to the value
    // to account for the missing character when determining appropriate measurements.
    string prevText = dataGridView1.CurrentCell.EditedFormattedValue.ToString() + "0";

    Graphics editControlGraphics = dataGridView1.EditingControl.CreateGraphics();

    // Gets the length of the current text value.
    SizeF stringSize = editControlGraphics.MeasureString(prevText, dataGridView1.EditingControl.Font);

    int widthForString = (int)Math.Round(stringSize.Width, 0);

    // Makes the column width big enough if it's not already.
    if (dataGridView1.CurrentCell.OwningColumn.Width < widthForString)
    {
        dataGridView1.CurrentCell.OwningColumn.Width = widthForString;
    }
} 
```

**编辑：**更新`TextBoxKeyPressEvent`逻辑以考虑退格：

```
private void TextBoxKeyPressEvent(object sender, KeyPressEventArgs e)
        {
            string prevText;
            bool wasBackspaced = false;

            // The following logic will either add or remove a character to/from the text string depending if the user typed
            // an additional character or pressed the Backspace key.  At the end of the day, the cell will (at least) be
            // sized to the configured minimum column width or the largest row width in the column because we're using 
            // AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.AllCells.
            if (e.KeyChar == Convert.ToChar(Keys.Back))
            {
                prevText = dataGridView1.CurrentCell.EditedFormattedValue.ToString();

                if (prevText.Length == 0)
                {
                    // Don't try to make it any smaller...
                    return;
                }

                // Remove an arbitrary character for determining appropriate measurements.
                prevText = prevText.Remove(prevText.Length - 1);
                wasBackspaced = true;
            }
            else
            {
                // Gets the text prior to the new character being added.  Appending an arbitrary "0" to the value
                // to account for the missing character when determining appropriate measurements.
                prevText = dataGridView1.CurrentCell.EditedFormattedValue.ToString() + "0";
            }

            Graphics editControlGraphics = dataGridView1.EditingControl.CreateGraphics();

            // Gets the length of the current text value.
            SizeF stringSize = editControlGraphics.MeasureString(prevText, dataGridView1.EditingControl.Font);

            int widthForString = (int)Math.Round(stringSize.Width, 0);

            // Makes the column width big, or small, enough if it's not already.
            if (dataGridView1.CurrentCell.OwningColumn.Width < widthForString ||  // 1\. Applies when adding text
                (dataGridView1.CurrentCell.OwningColumn.Width > widthForString &&          // ---
                 dataGridView1.CurrentCell.OwningColumn.MinimumWidth < widthForString &&   // 2\. Applies when backspacing
                 wasBackspaced))                                                           // ---
            {
                dataGridView1.CurrentCell.OwningColumn.Width = widthForString;
            }
        } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-08-25T09:08:24.087

您需要首先覆盖[DataGridViewCell.PositionEditingPanel 方法](http://msdn.microsoft.com/en-us/library/system.windows.forms.datagridviewcell.positioneditingpanel.aspx)。您需要重新定义自己的列类型和自己的单元格类型才能访问此方法。

这是一个关于如何做到这一点的示例，它将编辑面板（拥有编辑控件的面板）的大小乘以 2：

```
dataGridView1.AutoGenerateColumns = false; // disable columns auto generation

... add all columns

// add your special column
col = new MyColumn();
col.DataPropertyName = "Text"; // bind with the corresponding property
dataGridView1.Columns.Add(col); // add the custom column

... add other columns

public class MyCell : DataGridViewTextBoxCell
{
    public override Rectangle PositionEditingPanel(Rectangle cellBounds, Rectangle cellClip, DataGridViewCellStyle cellStyle, bool singleVerticalBorderAdded, bool singleHorizontalBorderAdded, bool isFirstDisplayedColumn, bool isFirstDisplayedRow)
    {
        cellBounds.Width *= 2;
        cellClip.Width = cellBounds.Width;
        return base.PositionEditingPanel(cellBounds, cellClip, cellStyle, singleVerticalBorderAdded, singleHorizontalBorderAdded, isFirstDisplayedColumn, isFirstDisplayedRow);
    }
}

public class MyColumn : DataGridViewTextBoxColumn
{
    public MyColumn()
    {
        CellTemplate = new MyCell();
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-08-30T09:55:24.610

这对我有用：

启用`KeyPreview`表单的属性并将表单的`KeyPress`事件主体更改为：

```
private void Form1_KeyPress(object sender, KeyPressEventArgs e)
{
            if (e.KeyChar!='\b')   //discard backspace
            {
              dataGridView1.Columns[0].Width += 5;  //the column's index or name

            }
            else
            {
                dataGridView1.Columns[0].Width -= 5;  //for backspase pressing
            }
} 
```

`e.KeyChar`您可以使用;限制按下的键

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-06-30T02:27:51.833

这个解决方案（我的最新）使用与使用 2 个 datagridviews 的答案类似的技术，但它只使用一个 datagridview 来管理它。

它的作用是当在单元格中输入文本时，它会创建一个新行，并将该文本输入该行中相应列的该行。然后它会看到新的宽度应该是多少，并将列扩展到该宽度并删除该行。

这是对我所拥有的东西的编辑，它改进了它。因为事实证明我可以注释掉 cellbeginedit 和 cellendedit 方法。并且还发现，上一个虽然没问题，但是稍微修改一下就会出现黑格的bug，这里说一下。只要我自动调整所有列的大小，我就会避免使用黑色单元格。（就像我一样使用 EditingControl.Text ）

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace dgveditresize
{
    public partial class Form1 : Form
    {

        public Form1()
        {
            InitializeComponent();
        }

        private void Form1_Load(object sender, EventArgs e)
        {

            //DGVprocs.dgv = dataGridView1;
            dataGridView1.AllowUserToAddRows = false;

            autoshrinkwholedgv();

            //DGVprocs.autoshrink_off_wholedgv__preservewidths(); not necessary
            dataGridView1.Rows.Add(5);
            //dataGridView1.CellBeginEdit += OnCellBeginEditExpandCol;

             dataGridView1.EditingControlShowing += DataGridView1_EditingControlShowing;

          //  MessageBox.Show(dataGridView1.Columns[1].Width.ToString());
        }

        private void DataGridView1_EditingControlShowing(object sender, DataGridViewEditingControlShowingEventArgs e)
        {

           // MessageBox.Show(dataGridView1.Columns[1].Width.ToString());

            // http://stackoverflow.com/questions/37505883/how-can-i-dynamically-detect-the-characters-in-a-datagridview-cell-execute-co

            //if(DGVprocs.isshrinkon()==false) { MessageBox.Show("err ")}

            if (e.Control is TextBox)
            {
                var tbox = (e.Control as TextBox);

                // De-register the event FIRST so as to avoid multiple assignments (necessary to do this or the event
                // will be called +1 more time each time it's called).

                tbox.TextChanged -= A_Cell_TextChanged;
                tbox.TextChanged += A_Cell_TextChanged;
            }

        }

        private void A_Cell_TextChanged(object sender, EventArgs e)
        {

            dataGridView1.Rows.Add(1);

            //MessageBox.Show(dataGridView1.Rows.Count+" rows");

            int colindex = dataGridView1.CurrentCell.ColumnIndex;

            int oldcolwidth = dataGridView1.CurrentCell.Size.Width;
            //string stredit=dataGridView1.CurrentCell.EditedFormattedValue.ToString();
            string stredit = dataGridView1.EditingControl.Text;

            //dgvtest.Rows[0].Cells[0].Value = stredit;
            dataGridView1.Rows[dataGridView1.Rows.Count - 1].Cells[dataGridView1.CurrentCell.ColumnIndex].Value = stredit;
            //MessageBox.Show(dataGridView1.Rows.Count + " rows");
            //int newcolwidth = dgvtest.Rows[0].Cells[0].Size.Width;

            //autoshrinkcurrentcol(); // WORSE   (1)  WW
            autoshrinkwholedgv(); //added BETTER (2)  XX
            int newcolwidth = dataGridView1.Rows[dataGridView1.Rows.Count - 1].Cells[dataGridView1.CurrentCell.ColumnIndex].Size.Width;
            autoshrinkoff_wholedgv_preservewidths(); //added BETTER (3) YY
           // autoshrink_off_currentcol_preservewidth(); // WORSE (4)  ZZ
             /*               
             WAS ERROR WITH THIS ONE..
             IF YOU TYPE IN THE FIRST CELL THEN HIT DOWN ARROW TWICE
             THEN TYPE THEN IT GOES BLACK
             BUT PROBLEM RESOLVED  SINCE USING 2,3 RATHER THAN 1,4                    
              */
            // doing either  1,4  or 2,3
            // no comparison
            // 1,4 causes blackness.
            // 2,3 and it works
            // all of them is just same as 2,3 not surprising.
            // but funny that 1,4 causes blackness.

            //MessageBox.Show("removing row");

            if(dataGridView1.AllowUserToAddRows) { MessageBox.Show("programmer msg- issue in 'cell's textchanged method', allowusertoaddrows must be false otherwise an exception is thrown by the next line dataGridView1.Rows.RemoveAt(dataGridView1.Rows.Count - 1);"); Application.Exit(); }
                // requires user not add row set to true.
                dataGridView1.Rows.RemoveAt(dataGridView1.Rows.Count - 1);

            //MessageBox.Show(dataGridView1.Rows.Count + " rows");

            int headercellsize = dataGridView1.Columns[colindex].HeaderCell.Size.Width;

            // find biggest existing one
            int maxcellincol = headercellsize;

            int tempcelllength = 0;
            for (int i = 0; i < dataGridView1.Rows.Count; i++)
            {
                if (dataGridView1.Rows[i].Cells[colindex].Value == null) dataGridView1.Rows[i].Cells[colindex].Value = "";

                //length of all others but not current.
                tempcelllength = dataGridView1.Rows[i].Cells[colindex].Size.Width;

                if (tempcelllength > maxcellincol) maxcellincol = tempcelllength;
            }

            int diffcol = newcolwidth - oldcolwidth;

            // new isn't an ideal name.. 'cos it's not made new yet.. and 'cos if it's smaller than the max one then we won't make it the new one.. but it will be the new one if it's bigger than the max.

             txtdesc.Text = "";
            txtdesc.Text += "newcolwidth=" + newcolwidth + "\r\n";
            txtdesc.Text += "maxcellincol=" + maxcellincol + "\r\n";

            //if (newcolwidth < maxcellincol)  != even if = then fine.

            // say we move that earlier
            //dataGridView1.Rows.RemoveAt(dataGridView1.Rows.Count - 1);

            //DGVprocs.autoshrinkoff_preservecurrentcolwidth();

            //if (dataGridView1.Columns[colindex].Width == newcolwidth)
            if (oldcolwidth == newcolwidth)
            txtwidthcomp.Text="old width is equal to cur width diff="+diffcol;
            else
                txtwidthcomp.Text="old width is not equal to cur width diff="+diffcol;

            //shrink should never be on while there's an editbox showing.
            //if (diffcol>0) if (DGVprocs.isshrinkon() == true) MessageBox.Show("shrink is on this may be why it's not resizing");
            // when turning autoshrink off a)it should be done after the editbox it will freeze the editbox to the size that it was. b)when it is done it should be done in a preservational way. getting all col sizes beforehand and turning shrink off and setting all cols to that size that they were 
            // DGVprocs.autoshrinkoff();
            // shrink has to be off for the current column.. doesn't matter about the rest of it.
            // if(diffcol>0) if(DGVprocs.isshrinkoncurrentcol()==true) MessageBox.Show("shrink is on(cur col) this may be why it's not resizing");

            dataGridView1.Columns[colindex].Width = newcolwidth;
            dataGridView1.Width += diffcol;

            // i think autoshrink while the editbox is showing is wrong.
            // you need to autoshrink it to size of editbox.
//            DGVprocs.autoshrink();

        }

        public void autoshrinkwholedgv()
        {

            dataGridView1.AutoSizeRowsMode = DataGridViewAutoSizeRowsMode.AllCells;
            dataGridView1.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.AllCells;

            return;
        }

        public void autoshrinkcurrentcol()
        {

            dataGridView1.Columns[getcurrentcol()].AutoSizeMode = DataGridViewAutoSizeColumnMode.AllCells;

            //this may be optional.
            dataGridView1.AutoSizeRowsMode = DataGridViewAutoSizeRowsMode.AllCells;

            // DGVprocs.dgv.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.AllCells;

            return;
        }

        public int getcurrentcol()
        {
            if (dataGridView1.CurrentCell == null) { MessageBox.Show("Programmer msg - getcurrentcol() error, current cell not selected"); Application.Exit(); }
            if (dataGridView1.CurrentCell.Value == null) dataGridView1.CurrentCell.Value = "";

            return dataGridView1.CurrentCell.ColumnIndex;
        }

        public void autoshrink_off_currentcol_preservewidth()
        {
            int w =  dataGridView1.Columns[getcurrentcol()].Width;
            dataGridView1.Columns[getcurrentcol()].AutoSizeMode = DataGridViewAutoSizeColumnMode.None;
            dataGridView1.Columns[getcurrentcol()].Width = w;
        }

        public void autoshrinkoff_wholedgv_preservewidths()
        {
            // deal with the 73,100 bug.. whereby if you ave autoresize on immediately, then a DGV with Column1 Colum2, Column3 e.t.c. has width of 73\. But then when turning autoresize off it goes to 100\. 

            int[] colsizes = new int[dataGridView1.Columns.Count];

            for (int i = 0; i < dataGridView1.Columns.Count; i++)
                colsizes[i] = dataGridView1.Columns[i].Width;

            dataGridView1.AutoSizeRowsMode = DataGridViewAutoSizeRowsMode.None;
            dataGridView1.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.None;

            for (int i = 0; i < dataGridView1.Columns.Count; i++)
                dataGridView1.Columns[i].Width = colsizes[i];

            return;
        }

    }

} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-05-31T01:04:37.483

我为此找到了一些解决方案

一个使用 MeasureString 和一个 datagridview ，另一个创建另一个 datagridview 来确定单元格的正确宽度（如果单元格具有该内容）。另一个（我最新的）用一个 datagridview 管理它并添加和删除一行。

这是使用第二个 datagridview 的那个

在我给我的两列没有数据的表单上绘制一个 datagridview。

该代码将创建第二个 datagridview 也有两列没有数据。

当然，提问者遇到的问题是，如果没有自动调整大小的编辑，则不清楚设置列的宽度。此解决方案创建另一个 datagridview（称为 DGVb），这个未添加到表单中。然后它将数据写入 DGVb 中的一个单元格，查看该单元格的宽度，并使用该图作为将单元格设置到正确 DGV 中的图。

vine 涉及的另一个问题是，将单元格设置为自动调整大小时，您无法以编程方式设置列的宽度，因此您可以在触发 cellbeginedit 事件时将代码打开，将自动大小设置为无，并在何时将其重新打开cellendit 被触发，另一件事是，因为设置为 none 可能会立即稍微改变列大小，例如打开 autosize 的 column1 可能为 73，然后当您关闭 autosize 时，它​​变为 100，因此您可以在放置之前存储大小autosize 设置为 none，然后将 autosize 设置为 none 并将大小设置为原来的大小，这样可以保留不需要的大小更改。正如 Vine 所涵盖的，这就是这里所做的。

此代码扩展和缩小列，并且没有反向删除、向前删除或箭头键的弱点，尽管在撰写本文时，vine 的答案在这些键上有一些弱点。我使用 TextChanged 来避免这些问题。（相对于 keydown 等）

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace datagridviewexpandcelldynamically_with_second_dgv
{
    public partial class Form1 : Form
    {
        DataGridView dgvtest = new DataGridView();
        //  DataGridView dgvtest;

        public Form1()
        {
            InitializeComponent();
        }

        private void Form1_Load(object sender, EventArgs e)
        {

                dataGridView1.AllowUserToAddRows = false;
                dgvtest.AllowUserToAddRows = false;

                dataGridView1.CellBeginEdit += (object ssender, DataGridViewCellCancelEventArgs ee) =>
                {
                    //keep column width as it is for now but just change autosize to none so will be able to manually increase it
                    int origColumnWidth = dataGridView1.Columns[ee.ColumnIndex].Width;
                    dataGridView1.Columns[ee.ColumnIndex].AutoSizeMode = DataGridViewAutoSizeColumnMode.None;
                    dataGridView1.Columns[ee.ColumnIndex].Width = origColumnWidth;
                };

                dataGridView1.CellEndEdit += (object sssender, DataGridViewCellEventArgs eee) =>
                {
                    dataGridView1.Columns[eee.ColumnIndex].AutoSizeMode = DataGridViewAutoSizeColumnMode.AllCells;
                };

                dataGridView1.AutoSizeRowsMode = DataGridViewAutoSizeRowsMode.AllCells;
                dataGridView1.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.AllCells;

                dgvtest.AutoSizeRowsMode = DataGridViewAutoSizeRowsMode.AllCells;
                dgvtest.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.AllCells;

                dgvtest.Columns.Add("Column1", "Column1");
                dgvtest.Columns.Add("Column2", "Column2");

                dgvtest.Rows.Add(1);
                dataGridView1.Rows.Add(1);

                /*
                Form newfrm = new Form();
                newfrm.Show();
                newfrm.Controls.Add(dgvtest);
                dgvtest.Show();
                */

                //dgvtest.Rows[0].Cells[0].Value = "abc";

        }

        private void dataGridView1_EditingControlShowing(object sender, DataGridViewEditingControlShowingEventArgs e)
        {

            if (e.Control is TextBox)
            {
                var tbox = (e.Control as TextBox);

                // De-register the event FIRST so as to avoid multiple assignments (necessary to do this or the event
                // will be called +1 more time each time it's called).

                tbox.TextChanged -= TextBoxChanged;
                tbox.TextChanged += TextBoxChanged;
                //not KeyDown 'cos the character has not appeared yet in the box. and one would have to check what it was as a parameter, and if it's a backdelete then go back one.. and also forward delete isn't coutned as a keydown.
                //not KeyUp 'cos while yeah the character has at least appeared, there's a delay so if you hold backdelete then only after releasing it will it trigger the procedure, and updating the width of the cell then is a bit late.
                //not KeyPress 'cos has issues of keyup. 

            }

        }

        private void TextBoxChanged(object sender, EventArgs e)
        {

            int colindex = dataGridView1.CurrentCell.ColumnIndex;

            int oldcolwidth = dataGridView1.CurrentCell.Size.Width;
            //string stredit=dataGridView1.CurrentCell.EditedFormattedValue.ToString();
            string stredit=dataGridView1.EditingControl.Text;
            dgvtest.Rows[0].Cells[0].Value = stredit;

            int newcolwidth = dgvtest.Rows[0].Cells[0].Size.Width;

            int headercellsize = dataGridView1.Columns[colindex].HeaderCell.Size.Width;

            // find biggest existing one
            int maxcellincol = headercellsize;

            int tempcelllength = 0;
            for (int i = 0; i < dataGridView1.Rows.Count; i++)
            {
                if (dataGridView1.Rows[i].Cells[colindex].Value == null) dataGridView1.Rows[i].Cells[colindex].Value = "";

                //length of all others but not current.
                tempcelllength = dataGridView1.Rows[i].Cells[colindex].Size.Width;

                if (tempcelllength > maxcellincol) maxcellincol = tempcelllength;
            }

            int diffcol = newcolwidth - oldcolwidth;

            // new isn't an ideal name.. 'cos it's not made new yet.. and 'cos if it's smaller than the max one then we won't make it the new one.. but it will be the new one if it's bigger than the max.

            // txtdesc.Text = "";
            txtdesc.Text += "newcolwidth=" + newcolwidth + "\r\n";
            txtdesc.Text += "maxcellincol=" + maxcellincol + "\r\n";

            //if (newcolwidth < maxcellincol)  != even if = then fine.

            dataGridView1.Columns[colindex].Width = newcolwidth;
            dataGridView1.Width += diffcol;

        } 

    }

} 
```

在输入文本时扩展单元格的想法是一个非常糟糕的想法..但在视觉上似乎比这种替代方案更可取..这样做不那么棘手但看起来不太好，也就是说，只是让单元格扩展cellbeginedit 上的大小，（因此设置为自动调整为无，并将 col 宽度设置为某个大小，例如 = 50），并让它缩小到大小 - 自动调整 - 在 cellendedit 上）然后我想在 cellendedit 上增加 datagridview 宽度所以它不会没有滚动条。但是随后 datagridview col 的大小会跳跃，使用起来并不好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-05-31T01:16:29.320

我在另一个答案中提到我有两个解决方案，这个是 MeasureString 解决方案（与第二个 datagridview 解决方案相反）

对 textbox1-5.text 等的任何提及都已被评论为仅用于调试。

这个和另一个解决方案不仅调整了您正在编辑的列的大小，它还调整了 datagridview 的宽度和表单宽度，尽管如果您不想要这种行为，您可以轻松地评论。

我可能应该使用'uses'关键字来创建图形对象，但无论如何。

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace datagridviewexpandcelldynamically
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
        }

        private void dataGridView1_CellBeginEdit(object sender, DataGridViewCellCancelEventArgs e)
        {

            int origColumnWidth = dataGridView1.Columns[e.ColumnIndex].Width;

            dataGridView1.Columns[e.ColumnIndex].AutoSizeMode = DataGridViewAutoSizeColumnMode.None;

            dataGridView1.Columns[e.ColumnIndex].Width = origColumnWidth;

            if (dataGridView1.CurrentCell == null) dataGridView1.CurrentCell.Value = "";

        }

        private void dataGridView1_CellEndEdit(object sender, DataGridViewCellEventArgs e)
        {
            dataGridView1.Columns[e.ColumnIndex].AutoSizeMode = DataGridViewAutoSizeColumnMode.AllCells;
        }

        private void dataGridView1_EditingControlShowing(object sender, DataGridViewEditingControlShowingEventArgs e)
        {

            if (e.Control is TextBox)
            {
                var tbox = (e.Control as TextBox);

                // De-register the event FIRST so as to avoid multiple assignments (necessary to do this or the event
                // will be called +1 more time each time it's called).

                tbox.TextChanged -= TextBoxChanged;
                tbox.TextChanged += TextBoxChanged;

            }

        }

        private void TextBoxChanged(object sender, EventArgs e)
        {

            // try catch is helpful in a winforms program 'cos otherwise program might just stop.
            // http://stackoverflow.com/questions/1583351/silent-failures-in-c-seemingly-unhandled-exceptions-that-does-not-crash-the-pr

            try
            {
                int colindex = dataGridView1.CurrentCell.ColumnIndex;

                Graphics agraphics = this.CreateGraphics();

                SizeF headerTextSize = agraphics.MeasureString(dataGridView1.Columns[colindex].HeaderText, dataGridView1.EditingControl.Font);

                // sometimes it goes black and this link here says to use editing control http://stackoverflow.com/questions/3207777/datagridview-cell-turns-black-when-accessing-editedformattedvalue

                // string stredit=dataGridView1.CurrentCell.EditedFormattedValue.ToString();
                string stredit=myDataGridView.EditingControl.Text;
                SizeF curCellTextSize = agraphics.MeasureString(stredit, dataGridView1.EditingControl.Font);
                //SizeF curCellTextSize = agraphics.MeasureString(dataGridView1.CurrentCell.GetEditedFormattedValue.ToString(), dataGridView1.EditingControl.Font);
                int curCellTextSize_i = (int)Math.Round(curCellTextSize.Width, 0);

                int headerCellSize = dataGridView1.Columns[colindex].Width;

                textBox2.Text = headerTextSize.Width.ToString();
                textBox3.Text = headerCellSize.ToString();

                // find biggest existing one
                int maxcelltextincol = (int)Math.Round(headerTextSize.Width,0);
                // the max size, at least for the header, includes a bit of padding.. 
                maxcelltextincol += 20;
                int tempcelllength=0;
                for(int i=0; i<dataGridView1.Rows.Count;i++) {
                    if (dataGridView1.Rows[i].Cells[colindex].Value == null) dataGridView1.Rows[i].Cells[colindex].Value = "";

                    tempcelllength = (int)Math.Round(agraphics.MeasureString(dataGridView1.Rows[i].Cells[colindex].Value.ToString(), dataGridView1.EditingControl.Font).Width, 0);

                    if (tempcelllength > maxcelltextincol) maxcelltextincol = tempcelllength;       
                }

            //    textBox2.Text = "PRE curCellTextSize_i=" + curCellTextSize_i + " " + "dgvw=" + dataGridView1.Columns[colindex].Width.ToString() + " max=" + maxcelltextincol.ToString() +  " prevstringlength=";

                string txtinwhatiamediting = stredit;

                SizeF sizelengthoftxtinwhatiamediting = agraphics.MeasureString(txtinwhatiamediting, dataGridView1.Font); //intermediate
                int lengthoftxtinwhatiamediting=(int)Math.Round(sizelengthoftxtinwhatiamediting.Width,0);

                //if(lengthoftxtinwhatiamediting>maxcelltextincol) 
                int amountovermax = lengthoftxtinwhatiamediting - maxcelltextincol;    

                int oldcolwidth = dataGridView1.Columns[colindex].Width;
                if (amountovermax < 0) { dataGridView1.Columns[colindex].Width = maxcelltextincol; return; }

                dataGridView1.Columns[colindex].Width = maxcelltextincol + amountovermax;
                int newcolwidth = dataGridView1.Columns[colindex].Width;
                   //dataGridView1.Width += (int)Math.Round((double)amountovermax,0);
                dataGridView1.Width += newcolwidth - oldcolwidth;
                this.Width += newcolwidth - oldcolwidth;
                //   textBox2.Text = "curCellTextSize_i=" + curCellTextSize_i + " " + "dgvw=" + dataGridView1.Columns[colindex].Width.ToString() + " max=" + maxcellincol.ToString();

                if (curCellTextSize_i > maxcelltextincol) maxcelltextincol = curCellTextSize_i;

                  // textBox5.Text= "POST curCellTextSize_i=" + curCellTextSize_i + " " + "dgvw=" + dataGridView1.Columns[colindex].Width.ToString() + " max=" + maxcelltextincol.ToString() + "prevstring=" + prevString + " prevstringlength=" + prevtextsize + " diff=" + diff;
                 //  textBox5.Text = "POST curCellTextSize_i=" + curCellTextSize_i + " " + "dgvw=" + dataGridView1.Columns[colindex].Width.ToString() + " max=" + maxcelltextincol.ToString() + " diff=" + amountovermax;

            }
            catch (Exception ee) { MessageBox.Show(ee.ToString()); }                                
        }

        private void Form1_Load(object sender, EventArgs e)
        {
            try
            {
                //dataGridView1.AllowUserToAddRows = false;
                dataGridView1.Font = new System.Drawing.Font("David", 30.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, ((byte)(0)));
                dataGridView1.Rows.Add(1);

                dataGridView1.AutoSizeRowsMode = DataGridViewAutoSizeRowsMode.AllCells;
                dataGridView1.AutoSizeColumnsMode = DataGridViewAutoSizeColumnsMode.AllCells;                

                Graphics g = this.CreateGraphics(); // should be in a using.

                Font fontA = new System.Drawing.Font("David", 30.25F, System.Drawing.FontStyle.Bold, System.Drawing.GraphicsUnit.Point, ((byte)(0)));

                SizeF headerSize = g.MeasureString(dataGridView1.Columns[0].HeaderText, fontA);

                int totalcolwidth = dataGridView1.RowHeadersWidth + 40; // about 40+70
                //MessageBox.Show(totalcolwidth.ToString());
                for (int i = 0; i < dataGridView1.Columns.Count; i++)
                    totalcolwidth += dataGridView1.Columns[i].Width;

              //  MessageBox.Show(totalcolwidth.ToString());
              //  MessageBox.Show(dataGridView1.Width.ToString());
                int diff = totalcolwidth - dataGridView1.Width;
                dataGridView1.Width = totalcolwidth;
              //  MessageBox.Show(dataGridView1.Width.ToString());
                this.Width += diff;

            }
            catch (Exception exc)
            {
                MessageBox.Show("exception ");
                MessageBox.Show(exc.ToString());
            }
        }

    }
} 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-08-26T01:59:29.220

您想在键入时调整单元格的大小吗？或者您是否希望在输入文本并按下回车后调整其大小？第二种选择是公平的最简单的。

让我知道。

谢谢

# c# - C# .Net 4.0 命名和默认参数

> ID：686322
> 
> 赞同：3
> 
> 时间：2009-03-26T15:39:53.400
> 
> 标签：c#, c#-4.0

您认为命名参数和默认参数将在 C#.Net 4.0 中添加什么值？

这些（重载和覆盖尚未实现）有什么用处？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T15:44:48.770

它可以使构造函数更简单，特别是对于不可变类型（这对于线程很重要） -[请参阅此处以获取完整讨论](http://marcgravell.blogspot.com/2008/11/immutability-and-optional-parameters.html)。没有它*应该*的那么好，但比有很多重载要好。您显然不能将对象初始化程序与不可变对象一起使用，因此通常：

```
new Foo {Id = 25, Name = "Fred"} 
```

不可用；我会满足于：

```
new Foo (Id: 25, Name: "Fred") 
```

这可以扩展到简化重载的一般思想，但在*大多数*情况下，我更喜欢宣传合法组合的重载。IMO，构造函数有点不同，因为您只是（通常）定义初始状态。

COM 方面对很多人来说也很重要，但我根本不使用太多 COM 互操作 - 所以这对我来说并不*那么*重要。

* * *

编辑重新评论；为什么他们不使用与属性相同的语法？简单 - 它可能与其他成员/变量不明确（这不是属性的问题）；举个例子：

```
[XmlElement("foo", Namespace = "bar")] 
```

它使用一个常规参数（对于 ctor，“foo”）和一个命名赋值。因此，假设我们将其用于常规命名参数：

```
SomeMethod("foo", SecondArg = "bar"); 
```

（也可以是构造函数；为简单起见，我使用了一种方法）

现在...如果我们有一个名为 的变量或属性`SecondArg`怎么办？这在`SecondArg`用作 的命名参数`SomeMethod`、*将“bar”分配给`SecondArg`以及将“bar”作为常规参数传递*之间是不明确的。

为了说明，这在 C# 3.0 中是合法的：

```
 static void SomeMethod(string x, string y) { }
    static void Main()
    {
        string SecondArg;
        SomeMethod("foo", SecondArg = "bar");
    } 
```

显然，SecondArg 可以是属性、字段、变量等......

替代语法没有这种歧义。

* * *

编辑 - 280Z28 的此部分：很抱歉在此处添加此内容，但这并不是一个真正独特的答案，而且对于评论和包含代码来说太长了。您暗示了歧义，但您的示例并未突出决定性案例。我认为您给出的示例指出了一些可能令人困惑的东西，但是`{}`围绕对象初始化程序的要求可以防止潜在的语法歧义。我对以下代码的解释嵌入为多行块注释。

```
[AttributeUsage(AttributeTargets.Class)]
public sealed class SomeAttribute : Attribute
{
    public SomeAttribute() { }

    public SomeAttribute(int SomeVariable)
    {
        this.SomeVariable = SomeVariable;
    }

    public int SomeVariable
    {
        get;
        set;
    }
}

/* Here's the true ambiguity: When you add an attribute, and only in this case
 * there would be no way without a new syntax to use named arguments with attributes.
 * This is a particular problem because attributes are a prime candidate for
 * constructor simplification for immutable data types.
 */

// This calls the constructor with 1 arg
[Some(SomeVariable: 3)]
// This calls the constructor with 0 args, followed by setting a property
[Some(SomeVariable = 3)]
public class SomeClass
{
} 
```

* * *

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T15:45:47.723

这将有助于避免提供一个体面的 API 来处理 Office 应用程序的问题！:)

Office API 的某些部分还可以，但有些边缘情况显然是为使用带有可选/命名参数的语言而设计的。所以这就是 C# 必须拥有它们的原因。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T15:53:38.233

可选参数还避免了类提供几十个方法的问题，这些方法只是接受参数的变体。

考虑异常类。它不是一个带有可选参数的构造函数，而是针对“有消息”和“有内部异常”的每种组合有四个构造函数。没关系，但是现在考虑如果您向采用 innerException 的构造函数提供 null 值会发生什么？它的行为是否与没有innerException 参数的构造函数完全一样，有点像没有innerException 参数的构造函数，还是抛出空引用异常？

带有 2 个可选参数的单个构造函数会更明显地表明，传递 null innerException 等同于根本不包含它。默认参数的理想场所。

另外不要忘记，现在每个派生的 Exception 类还必须包含 4 个构造函数，这是一个没有意义的麻烦。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T15:40:35.783

这将使 COM 互操作更容易。

在 C# 4 之前，VB.Net 是一种更好的互操作语言。如果没有默认值，您将在 C# 中拥有大量虚拟 ref 参数列表。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T15:41:20.510

代码的简洁性是显而易见的。当您可以定义一个函数时，为什么还要定义多个重载。但是，如果您有两个相同类型的参数，则并不总是可以构造您可能需要的完整的重载集。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-01-23T12:47:45.263

这也不能编译：

```
[AttributeUsage(AttributeTargets.Property, Inherited = false, AllowMultiple = true)]
sealed class MyAttribute : Attribute
{
    public MyAttribute(object a = null)
    {

    }
}

class Test
{
    [My] // [My(a: "asd")]
    int prop1 { get; set; }
} 
```

虽然这样做：

```
[AttributeUsage(AttributeTargets.Property, Inherited = false, AllowMultiple = true)]
sealed class MyAttribute : Attribute
{
    public MyAttribute()
    {

    }

    public object a { get; set; }
}

class Test
{
    [My] // [My(a=null)]
    int prop1 { get; set; }
} 
```

# java - Component.getGraphicsConfiguration 线程安全吗？

> ID：686333
> 
> 赞同：1
> 
> 时间：2009-03-26T15:41:36.233
> 
> 标签：java, multithreading, swing, awt

如果您不在 AWT 事件线程上，则有许多方法不应该调用。这些通常是以某种方式操纵 UI 的方法。

Component 的 getGraphicsConfiguration(...) 是这种情况吗？它只是一个 getter，但如果事件线程正在等待调用此方法的线程，它似乎会导致死锁。

虽然解决死锁相当简单（避免在事件线程上使用等待或同步），但我是否应该只在传递给 SwingUtilities.invokeLater(...) 或 invokeAndWait(...) 的 Runnable 中调用 getGraphicsConfiguration？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T15:59:04.303

AWT 线程安全（必然）被破坏。只是不要靠近它。保持直线 AWT EDT

另请注意，仅仅因为方法在 中`java.awt.Component`，并不意味着对象（或由它引用的对象）不在 Swing 中，因此甚至根本不假装是线程安全的。（够不够？）

# java - 休眠和特殊字符

> ID：686336
> 
> 赞同：0
> 
> 时间：2009-03-26T15:43:32.860
> 
> 标签：java, database, oracle, hibernate

想象一下，我有一个带有一个表的数据库，该表只有一个名为“word”的字段和一些其他数据，还想象用户可以通过键入该字段的内容来搜索数据。我在这张桌子上有很多带有西班牙口音的单词。

## 单词示例

阿西多

汽车

卡米翁

## 问题

如果用户搜索“acido”或“ácido”字样，查询将返回“ácido”行。Hibernate 是如何做到这一点的？

## 编辑

我使用 Oracle 10g 作为 RDBMS 和 Hibernate 命名查询。

提前致谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T15:46:22.993

Hibernate 将简单地将搜索传递给数据库。如果您的数据库设置为以不同方式识别这些，那么 Hibernate 也将如此。

在 SQL Server 中，您可以为列（或表或数据库 - 由您选择）设置排序规则，以使该数据不区分重音。怀疑在其他 DBMS 中有类似的机制，我会说这将是你最好的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T17:19:10.120

最后，我在与此类似的命名查询中使用了 Oracle TRANSLATE 函数：

```
 <query name="queryName">
  <![CDATA[
        FROM Table
        WHERE 
          upper(TRANSLATE(nivell_1,'ÀàÉÈéèÍíÓóÒòÚú','AaEEeeIiOoOoUu')) LIKE
          upper(TRANSLATE(nivell_1,'ÀàÉÈéèÍíÓóÒòÚú','AaEEeeIiOoOoUu'))
  ]]>         
  </query> 
```

# asp.net - 沙盒化 Google 自定义搜索引擎的样式

> ID：686343
> 
> 赞同：1
> 
> 时间：2009-03-26T15:45:32.887
> 
> 标签：asp.net, css, google-custom-search

我正在尝试将[Google CSE](http://www.google.com/coop/cse/)合并到我的网站中。搜索工作正常。我在使用母版页的网站页面上使用 Nijhof 的 ASP.NET [Google CSE 搜索控件。](http://nijhof.com/Pages/SourceCode/GoogleSearchControl.aspx)问题在于 Google 的风格不仅影响页面上的 Google 搜索结果，还影响页面上的其他元素，例如我的导航。Google 注入了以下影响页面上其他元素的样式：

```
body, td, div, .p, a {Search.a...chStr=mmm (line 278)
font-family:arial,sans-serif;
}
div, td, .n a, .n a:visited {Search.a...chStr=mmm (line 278)
color:#000000;
} 
```

对于如何对搜索样式进行沙箱处理，我将不胜感激。谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T10:47:19.397

推翻 Google 样式的一种稍微“hacky”的方式是在您自己的样式上使用 !Important 标签。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T10:49:04.807

如果您自己的样式使用 ID 元素进行选择，它们将优先于 Google 规则。

例如，在代码周围使用 id 为“容器”的 div。

然后使用以#container 开头的CSS 规则来获得优先级。

# jquery - 在 jQuery 的帮助下嵌套 IF

> ID：686344
> 
> 赞同：0
> 
> 时间：2009-03-26T15:45:40.903
> 
> 标签：jquery

我是 JQuery 的新手 - 认为为我正在参与的项目选择它可能会很好。基本上我想创建一种表格，每次回答表格上的问题时，都会根据答案出现一个新问题。我已经为它编写了一些伪代码，并且可能会用 PHP 编写它。问题是当前版本有多个页面，其中包含每一种可能性。

我需要一种高效且易于维护和可修改的方法来创建它。

为了提供更多背景信息，这是它的工作原理。

每个问题都有一个是/否的答案。根据答案，在得出某个结论之前会提出另一个问题，依此类推。大约有 25 种不同的可能结果。

有谁知道我可以用来做这样的事情的任何参考资料，或者目前是否有类似的东西？

谢谢，肖恩

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-10-07T16:14:49.927

试试这个..未测试

```
<form>
<label id="id1">Do you like turkey?</label>
<input type="radio" name="group1" value="Y" onclick="ShowYes(1);">Yes
<input type="radio" name="group1" value="N" onclick="ShowNo(1);" >No
</ br>
<div id="Set2">
    <label id="id2">Do you like mirrors?</label>
    <input type="radio" name="group2" value="Y" onclick="ShowYes(2);">Yes
    <input type="radio" name="group2" value="N" onclick="ShowNo(2);" >No
</div>
<div id="Set3">
    <label id="id3">Do you like winter?</label>
    <input type="radio" name="group3" value="Y" onclick="ShowYes(3);">Yes
    <input type="radio" name="group3" value="N" onclick="ShowNo(3);" >No
</div>
<div id="Set4">
    <label id="id4">Do you like dogs?</label>
    <input type="radio" name="group4" value="Y" onclick="ShowYes(4);">Yes
    <input type="radio" name="group4" value="N" onclick="ShowNo(4);" >No
</div>
<div id="Set5">
    <label id="id4">Do you like winter?</label>
    <input type="radio" name="group5" value="Y" onclick="ShowYes(5);">Yes
    <input type="radio" name="group5" value="N" onclick="ShowNo(5);" >No
</div> 
```

```
function ShowYes(questionSet){
switch(questionSet)
{
    case 1:
      $(Set2).show();
      break;
    case 2:
      $(Set3).show();
        break;
    default:
      alert();
}}

function ShowNo(questionSet){
switch(questionSet)
{
    case 1:
      $(Set4).show();
      break;
    case 2:
      $(Set5).show();
        break;
    default:
      alert();
}} 
```

然后在您的 html 顶部添加 document.ready... 我确信隐藏所有 div 也可以在 .each() 中完成..

```
$(document).ready(function(){
 $('#Set2').hide();
 $('#Set3').hide();
 $('#Set4').hide();
 $('#Set5').hide();} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T15:51:47.987

如果您没有很多不同的问题，您可以将它们加载到 JS 数组中并从那里获取；无需使用 AJAX。

另一方面，如果您有很多问题并且会向浏览器加载数百 KB，那么您可能想要开发一个 AJAX 版本。

但是，我相信我仍然不明白这个问题......你到底有什么问题？jQuery？算法？阿贾克斯？如何创建标记来实现这一点？

也许发布您当前的代码可以让我们更好地帮助您。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T16:08:56.963

[jquery forms plugin](http://malsup.com/jquery/form/)可能是开始思考如何解决这个问题的好方法。我认为您会发现实施起来几乎是微不足道的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-12T18:09:46.563

考虑格式化数据的一种方法是使用 XML 树，每个可能的响应都列为“父”问题的子问题：

```
<question text="Is blue your favorite color" >
  <question answered="yes" text="Is 98.6 degrees your normal internal temperature"/>
  <question answered="no" text="Is green your favorite color">
    <question answered="yes" text="Do you have green eyes" />
    <question answered="no" text="Is your favorite color white"/>
  </question>
<question> 
```

# asp.net - ASP.NET 新手需要主/详细帮助。（也有截图）

> ID：686351
> 
> 赞同：1
> 
> 时间：2009-03-26T15:48:44.127
> 
> 标签：asp.net, master-detail

我只是在进行基本数据驱动的 ASP.NET 网络表单设计。我有表格的第一部分工作，但我不知道下一步该做什么。

请看我到目前为止创建的截图：http: [//www.twitpic.com/2gnmr](http://www.twitpic.com/2gnmr)

我需要帮助了解在主列表中使用哪种 HTML 元素，以及该元素上的什么事件/触发器用于触发“获取此选定项目的子记录”序列？

此外，ListView 甚至是呈现主列表的正确方法吗？目前，我不想提供任何编辑功能；我想我稍后会谈到。

我应该使用其他一些 ASP.NET 数据控件而不是像我正在做的那样手动编码列表视图吗？

我不想在每个客户名称旁边看到一个实际的“选择”链接项（看起来很傻）。我希望客户名称成为单击的链接。

因此，您可以在下面的代码中看到，我有一个 ListView 来显示 CustomersWithOpenOrders 的列表。但是，它只是一个静态列表，所以我如何使公司名称标签可点击，我还需要什么让它回火到一些代码隐藏来获取子记录。我已经有一个代码隐藏方法可以将传入的 CustomerNumber 的子记录获取到 DataTable 中，我想我知道如何将它绑定到子记录的网格或列表视图，但我不知道如何传递CustomerNumber 从主 ListView 到 UI 表单中的方法。

```
<asp:ListView ID="ListView1" runat="server">
    <LayoutTemplate>
      <table cellpadding="2" border="0" ID="tbl1" runat="server">
        <tr id="Tr1" runat="server" class="lvHeader">
          <th id="Th1" runat="server">Customer</th>
        </tr>
        <tr runat="server" id="itemPlaceholder" />
      </table>
    </LayoutTemplate>
    <ItemTemplate>
      <tr id="Tr2" runat="server">
        <td>
          <asp:Label ID="label2" class="FirstLine" runat="server" Text='<%# Eval("company") %>' />
          <br />
          <div class="SecondLine">
            <asp:Label ID="labelCustNo" runat="server" Text='<%# Eval("custno") %>'/>
            <asp:Label runat="server" Text='Ph: '></asp:Label>
            <asp:Label ID="label3" runat="server" Text='<% # Eval("phone") %>' />
          </div>
        </td>
      </tr>
    </ItemTemplate>
</asp:ListView> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T16:04:50.437

我个人还没有发现 ListView 不能解决我的需求的情况。如果要创建客户选择样式列表，可以使用链接按钮进行绑定。

```
<asp:ListView runat="server" id="CustomersList" ItemCommand="CustomersList_ItemCommand">
  <LayoutTemplate>
    <table cellpadding="2" border="0" ID="tbl1" runat="server">
      <tr id="Tr1" runat="server" class="lvHeader">
        <th id="Th1" runat="server">Customer</th>
      </tr>
      <tr runat="server" id="itemPlaceholder" />
    </table>
  </LayoutTemplate>
  <ItemTemplate>
    <tr id="Tr2" runat="server">
      <td>
        <asp:LinkButton ID="link1" class="FirstLine" runat="server" Text='<%# Eval("company") %>' CommandName="Select" />
        <br />
        <div class="SecondLine">
          <asp:Label ID="labelCustNo" runat="server" Text='<%# Eval("custno") %>'/>
          <asp:Label runat="server" Text='Ph: '></asp:Label>
          <asp:Label ID="label3" runat="server" Text='<% # Eval("phone") %>' />
        </div>
      </td>
    </tr>
  </ItemTemplate>
</asp:ListView>

<asp:ListView runat="server" ID="OrderList">
  <!-- Child Rows implementation -->
</asp:ListView> 
```

然后您需要将事件绑定到 ListView.ItemCommand。

```
protected void CustomersList_ItemCommand(object sender, ListViewCommandEventArgs e)
{
  if (e.CommandName = "Select")
  {
    if (e.Item.ItemType != ListViewItemType.DataItem) return;

    var dataItem = e.Item as ListViewDataItem;
    if (dataItem == null) return;

    var customer = dataItem.DataItem as Customer;
    if (customer == null) return;

    this.OrdersList.DataSource = GetChildRecords(customer.ID);
    this.OrdersList.DataBind();
  }
} 
```

# c++ - 随机浮点数生成

> ID：686353
> 
> 赞同：303
> 
> 时间：2009-03-26T15:49:14.797
> 
> 标签：c++, random, floating-point

如何在 C++ 中生成随机浮点数？

我想我可以把整数兰特除以某个东西，这样就足够了吗？

* * *

## 回答 #1

> 赞同：426
> 
> 时间：2009-03-26T15:54:11.680

`rand()`可用于在 C++ 中生成伪随机数。结合`RAND_MAX`一些数学知识，您可以在您选择的任意间隔内生成随机数。这对于学习目的和玩具程序来说已经足够了。如果您需要具有正态分布的*真正随机数，则需要采用更高级的方法。*

* * *

这将生成一个从 0.0 到 1.0 的数字，包括 0.0 到 1.0。

```
float r = static_cast <float> (rand()) / static_cast <float> (RAND_MAX); 
```

这将生成一个从 0.0 到任意值的数字`float`，`X`：

```
float r2 = static_cast <float> (rand()) / (static_cast <float> (RAND_MAX/X)); 
```

这将生成一个从任意`LO`到任意的数字`HI`：

```
float r3 = LO + static_cast <float> (rand()) /( static_cast <float> (RAND_MAX/(HI-LO))); 
```

* * *

请注意，`rand()`如果您需要真正的随机数，该功能通常是不够的。

* * *

在调用之前`rand()`，您必须首先通过调用“播种”随机数生成器`srand()`。这应该在程序运行期间完成一次——而不是每次调用`rand()`. 这通常是这样完成的：

```
srand (static_cast <unsigned> (time(0))); 
```

为了打电话`rand`还是`srand`你必须`#include <cstdlib>`。

为了打电话`time`，你必须`#include <ctime>`。

* * *

## 回答 #2

> 赞同：159
> 
> 时间：2013-07-22T22:09:56.197

C++11 为您提供了许多使用[`random`](http://en.cppreference.com/w/cpp/numeric/random). 关于这个主题的规范论文是[N3551, Random Number Generation in C++11](http://isocpp.org/blog/2013/03/n3551-random-number-generation)

要了解为什么使用`rand()`会出现问题，请参阅*Stephan T. Lavavej*在*GoingNative 2013*活动期间提供的[rand() 被认为有害](http://channel9.msdn.com/Events/GoingNative/2013/rand-Considered-Harmful)的演示材料。幻灯片在评论中，但这里是[直接链接](http://sdrv.ms/1e11LXl)。

 **因为遗留代码可能仍然需要它的支持，所以我也涵盖`boost`和使用。`rand`

下面的示例摘自 cppreference 站点，并使用[std::mersenne_twister_engine](http://en.cppreference.com/w/cpp/numeric/random/mersenne_twister_engine)引擎和[std::uniform_real_distribution](http://en.cppreference.com/w/cpp/numeric/random/uniform_real_distribution)生成`[0,10)`区间中的数字，其他引擎和分布被注释掉（*[现场查看](http://rextester.com/PQDR43690)*）：

```
#include <iostream>
#include <iomanip>
#include <string>
#include <map>
#include <random>

int main()
{
    std::random_device rd;

    //
    // Engines 
    //
    std::mt19937 e2(rd());
    //std::knuth_b e2(rd());
    //std::default_random_engine e2(rd()) ;

    //
    // Distribtuions
    //
    std::uniform_real_distribution<> dist(0, 10);
    //std::normal_distribution<> dist(2, 2);
    //std::student_t_distribution<> dist(5);
    //std::poisson_distribution<> dist(2);
    //std::extreme_value_distribution<> dist(0,2);

    std::map<int, int> hist;
    for (int n = 0; n < 10000; ++n) {
        ++hist[std::floor(dist(e2))];
    }

    for (auto p : hist) {
        std::cout << std::fixed << std::setprecision(1) << std::setw(2)
                  << p.first << ' ' << std::string(p.second/200, '*') << '\n';
    }
} 
```

输出将类似于以下内容：

```
0 ****
1 ****
2 ****
3 ****
4 *****
5 ****
6 *****
7 ****
8 *****
9 **** 
```

输出将根据您选择的分布而有所不同，因此，如果我们决定使用[std::normal_distribution ，其](http://en.cppreference.com/w/cpp/numeric/random/normal_distribution)*均值*和*stddev*的值都`2`为，例如，输出将与此类似（*[现场查看](http://rextester.com/KIZ75365)*）：**`dist(2, 2)`**

 **```
-6 
-5 
-4 
-3 
-2 **
-1 ****
 0 *******
 1 *********
 2 *********
 3 *******
 4 ****
 5 **
 6 
 7 
 8 
 9 
```

以下是`N3551`（*[现场查看](http://rextester.com/JGIZ32198)*）中提供的一些代码的修改版本：

```
#include <algorithm>
#include <array>
#include <iostream>
#include <random>

std::default_random_engine & global_urng( )
{
    static std::default_random_engine u{};
    return u ;
}

void randomize( )
{
    static std::random_device rd{};
    global_urng().seed( rd() );
}

int main( )
{
  // Manufacture a deck of cards:
  using card = int;
  std::array<card,52> deck{};
  std::iota(deck.begin(), deck.end(), 0);

  randomize( ) ;  

  std::shuffle(deck.begin(), deck.end(), global_urng());
  // Display each card in the shuffled deck:
  auto suit = []( card c ) { return "SHDC"[c / 13]; };
  auto rank = []( card c ) { return "AKQJT98765432"[c % 13]; };

  for( card c : deck )
      std::cout << ' ' << rank(c) << suit(c);

   std::cout << std::endl;
} 
```

结果将类似于：

> 5H 5S AS 9S 4D 6H TH 6D KH 2S QS 9H 8H 3D KC TD 7H 2D KS 3C TC 7D 4C QH QC QD JD AH JC AC KD 9D 5C 2H 4H 9C 8C JH 5D 4S 7C AD 3S 8S TS 2C 8D 3H 6C JS 7S 6S

**促进**

当然[Boost.Random](http://www.boost.org/doc/libs/1_55_0/doc/html/boost_random.html)也是一种选择，这里我使用的是[boost::random::uniform_real_distribution](http://www.boost.org/doc/libs/1_50_0/doc/html/boost/random/uniform_real_distribution.html)：

```
#include <iostream>
#include <iomanip>
#include <string>
#include <map>
#include <boost/random/mersenne_twister.hpp>
#include <boost/random/uniform_real_distribution.hpp>

int main()
{
    boost::random::mt19937 gen;
    boost::random::uniform_real_distribution<> dist(0, 10);

    std::map<int, int> hist;
    for (int n = 0; n < 10000; ++n) {
        ++hist[std::floor(dist(gen))];
    }

    for (auto p : hist) {
        std::cout << std::fixed << std::setprecision(1) << std::setw(2)
                  << p.first << ' ' << std::string(p.second/200, '*') << '\n';
    }
} 
```

**兰德（）**

如果您必须使用`rand()`，那么我们可以转到*C 常见问题解答*以获取有关[如何生成浮点随机数的指南？](http://c-faq.com/lib/fprand.html)，它基本上给出了一个与此类似的示例，用于在间隔上生成一个`[0,1)`：

```
#include <stdlib.h>

double randZeroToOne()
{
    return rand() / (RAND_MAX + 1.);
} 
```

并在以下范围内生成一个随机数`[M,N)`：

```
double randMToN(double M, double N)
{
    return M + (rand() / ( RAND_MAX / (N-M) ) ) ;  
} 
```

* * *

## 回答 #3

> 赞同：66
> 
> 时间：2009-03-26T15:53:18.577

看看[Boost.Random](http://www.boost.org/doc/libs/1_38_0/libs/random/index.html)。你可以这样做：

```
float gen_random_float(float min, float max)
{
    boost::mt19937 rng;
    boost::uniform_real<float> u(min, max);
    boost::variate_generator<boost::mt19937&, boost::uniform_real<float> > gen(rng, u);
    return gen();
} 
```

玩玩，你可能会更好地传递相同的 mt19937 对象，而不是每次都构造一个新对象，但希望你能明白这一点。

* * *

## 回答 #4

> 赞同：43
> 
> 时间：2016-04-10T07:39:04.447

在现代`c++`，您可以[`<random>`](http://en.cppreference.com/w/cpp/header/random)使用`c++11`.
要获得随机`float`的，您可以使用`std::uniform_real_distribution<>`.

您可以使用函数来生成数字，如果您**不希望数字始终相同**，请将引擎和分布设置为 `static`.
例子：

```
float get_random()
{
    static std::default_random_engine e;
    static std::uniform_real_distribution<> dis(0, 1); // rage 0 - 1
    return dis(e);
} 
```

最好将`float`'s 放在容器中，例如`std::vector`：

```
int main()
{
    std::vector<float> nums;
    for (int i{}; i != 5; ++i) // Generate 5 random floats
        nums.emplace_back(get_random());

    for (const auto& i : nums) std::cout << i << " ";
} 
```

示例输出：

```
0.0518757 0.969106 0.0985112 0.0895674 0.895542 
```

* * *

## 回答 #5

> 赞同：32
> 
> 时间：2009-03-26T15:55:20.943

用两个值调用代码`float`，代码在任何范围内都有效。

```
float rand_FloatRange(float a, float b)
{
    return ((b - a) * ((float)rand() / RAND_MAX)) + a;
} 
```

* * *

## 回答 #6

> 赞同：22
> 
> 时间：2009-12-05T05:04:47.507

如果您使用的是 C++ 而不是 C，请记住，在技术报告 1 (TR1) 和 C++0x 草案中，他们在头文件中添加了用于随机数生成器的工具，我相信它与 Boost.随机库，绝对比 C 库函数 rand 更灵活、更“现代”。

此语法提供了选择生成器（如[mersenne twister](http://en.wikipedia.org/wiki/Mersenne_twister) mt19937）然后选择分布（正态、伯努利、二项式等）的能力。

语法如下（无耻借用[本站](http://www.johndcook.com/cpp_TR1_random.html)）：

```
 #include <iostream>
  #include <random>

  ...

  std::tr1::mt19937 eng;  // a core engine class 
  std::tr1::normal_distribution<float> dist;     

  for (int i = 0; i < 10; ++i)        
      std::cout << dist(eng) << std::endl; 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-03-26T16:19:31.977

在某些系统上（目前想到的是带有 VC 的 Windows），`RAND_MAX`它非常小，即。e. 只有 15 位。除以`RAND_MAX`您时，仅生成 15 位的尾数，而不是 23 位可能的位。这对您来说可能是也可能不是问题，但在这种情况下您会遗漏一些值。

哦，刚刚注意到已经有针对该问题的评论。无论如何，这里有一些代码可以为你解决这个问题：

```
float r = (float)((rand() << 15 + rand()) & ((1 << 24) - 1)) / (1 << 24); 
```

未经测试，但可能有效:-)

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2013-09-03T10:13:34.207

[`drand48(3)`](http://linux.die.net/man/3/drand48)是POSIX标准方式。GLibC 还提供了可重入版本，[`drand48_r(3)`](http://linux.die.net/man/3/drand48_r).

该函数在 SVID 3 中被宣布为过时，但没有提供足够的替代方案，因此[IEEE Std 1003.1-2013](http://pubs.opengroup.org/onlinepubs/9699919799/functions/drand48.html)仍然包含它，并且没有任何说明它很快就会消失。

在 Windows 中，标准方法是[CryptGenRandom()](http://msdn.microsoft.com/en-us/library/windows/desktop/aa379942%28v=vs.85%29.aspx?ppud=4)。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-12-05T02:31:49.577

到目前为止，我对任何答案都不满意，所以我写了一个新的随机浮点函数。它对浮点数据类型进行按位假设。它仍然需要一个至少有 15 个随机位的 rand() 函数。

```
//Returns a random number in the range [0.0f, 1.0f).  Every
//bit of the mantissa is randomized.
float rnd(void){
  //Generate a random number in the range [0.5f, 1.0f).
  unsigned int ret = 0x3F000000 | (0x7FFFFF & ((rand() << 8) ^ rand()));
  unsigned short coinFlips;

  //If the coin is tails, return the number, otherwise
  //divide the random number by two by decrementing the
  //exponent and keep going. The exponent starts at 63.
  //Each loop represents 15 random bits, a.k.a. 'coin flips'.
  #define RND_INNER_LOOP() \
    if( coinFlips & 1 ) break; \
    coinFlips >>= 1; \
    ret -= 0x800000
  for(;;){
    coinFlips = rand();
    RND_INNER_LOOP(); RND_INNER_LOOP(); RND_INNER_LOOP();
    //At this point, the exponent is 60, 45, 30, 15, or 0.
    //If the exponent is 0, then the number equals 0.0f.
    if( ! (ret & 0x3F800000) ) return 0.0f;
    RND_INNER_LOOP(); RND_INNER_LOOP(); RND_INNER_LOOP();
    RND_INNER_LOOP(); RND_INNER_LOOP(); RND_INNER_LOOP();
    RND_INNER_LOOP(); RND_INNER_LOOP(); RND_INNER_LOOP();
    RND_INNER_LOOP(); RND_INNER_LOOP(); RND_INNER_LOOP();
  }
  return *((float *)(&ret));
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2013-07-03T16:05:44.890

在我看来，上面的答案确实给出了一些“随机”浮点数，但它们都不是真正的随机浮点数（即它们错过了浮点数表示的一部分）。在我急于实现我的实现之前，让我们先看一下浮点数的 ANSI/IEEE 标准格式：

|符号（1 位）| e (8 位) | f（23 位）|

这个词所代表的数字是 (-1 * sign) * 2^e * 1.f

请注意，“e”数字是一个有偏差（偏差为 127）的数字，因此范围从 -127 到 126。最简单（实际上也是最随机）的功能是将随机 int 的数据写入浮点数，因此

```
int tmp = rand();
float f = (float)*((float*)&tmp); 
```

请注意，如果您这样做`float f = (float)rand();`，它将整数转换为浮点数（因此 10 将变为 10.0）。

所以现在如果你想限制最大值，你可以做类似的事情（不确定这是否有效）

```
int tmp = rand();
float f = *((float*)&tmp);
tmp = (unsigned int)f       // note float to int conversion!
tmp %= max_number;
f -= tmp; 
```

但是如果您查看浮点数的结构，您会发现浮点数的最大值是（大约）2^127，它比 int 的最大值（2^32）大得多，因此排除了很大一部分可以用浮点数表示的数字。这是我的最终实现：

```
/**
 * Function generates a random float using the upper_bound float to determine 
 * the upper bound for the exponent and for the fractional part.
 * @param min_exp sets the minimum number (closest to 0) to 1 * e^min_exp (min -127)
 * @param max_exp sets the maximum number to 2 * e^max_exp (max 126)
 * @param sign_flag if sign_flag = 0 the random number is always positive, if 
 *              sign_flag = 1 then the sign bit is random as well
 * @return a random float
 */
float randf(int min_exp, int max_exp, char sign_flag) {
    assert(min_exp <= max_exp);

    int min_exp_mod = min_exp + 126;

    int sign_mod = sign_flag + 1;
    int frac_mod = (1 << 23);

    int s = rand() % sign_mod;  // note x % 1 = 0
    int e = (rand() % max_exp) + min_exp_mod;
    int f = rand() % frac_mod;

    int tmp = (s << 31) | (e << 23) | f;

    float r = (float)*((float*)(&tmp));

    /** uncomment if you want to see the structure of the float. */
//    printf("%x, %x, %x, %x, %f\n", (s << 31), (e << 23), f, tmp, r);

    return r;
} 
```

使用此函数`randf(0, 8, 0)`将返回一个介于 0.0 和 255.0 之间的随机数

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2015-03-19T22:04:21.493

如果您知道您的浮点格式是[IEEE 754](http://en.wikipedia.org/wiki/IEEE_floating_point#Basic_and_interchange_formats)（几乎所有现代 CPU，包括 Intel 和 ARM），那么您可以使用按位方法从随机整数构建随机浮点数。[`random`](http://en.cppreference.com/w/cpp/numeric/random)仅当您无法访问 C++11或[`Boost.Random`](http://www.boost.org/doc/libs/1_57_0/doc/html/boost_random.html)两者都更好时，才应考虑这一点。

```
float rand_float()
{
    // returns a random value in the range [0.0-1.0)

    // start with a bit pattern equating to 1.0
    uint32_t pattern = 0x3f800000;

    // get 23 bits of random integer
    uint32_t random23 = 0x7fffff & (rand() << 8 ^ rand());

    // replace the mantissa, resulting in a number [1.0-2.0)
    pattern |= random23;

    // convert from int to float without undefined behavior
    assert(sizeof(float) == sizeof(uint32_t));
    char buffer[sizeof(float)];
    memcpy(buffer, &pattern, sizeof(float));
    float f;
    memcpy(&f, buffer, sizeof(float));

    return f - 1.0;
} 
```

这将提供比使用除法更好的分布。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-08-21T10:44:51.690

`dist`对于 C++，它可以在变量指定的范围内生成实数浮点数

```
#include <random>  //If it doesnt work then use   #include <tr1/random>
#include <iostream>

using namespace std;

typedef std::tr1::ranlux64_base_01 Myeng; 
typedef std::tr1::normal_distribution<double> Mydist;

int main() { 
       Myeng eng; 
       eng.seed((unsigned int) time(NULL)); //initializing generator to January 1, 1970);
       Mydist dist(1,10); 

       dist.reset(); // discard any cached values 
       for (int i = 0; i < 10; i++)
       {
           std::cout << "a random value == " << (int)dist(eng) << std::endl; 
       }

       return (0);
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-26T15:54:16.627

rand() 返回一个介于 0 和 RAND_MAX 之间的整数。要获得 0.0 和 1.0 之间的随机数，首先将 rand() 返回的 int 转换为浮点数，然后除以 RAND_MAX。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2019-04-29T05:49:12.410

```
#include <cstdint>
#include <cstdlib>
#include <ctime>

using namespace std;

/* single precision float offers 24bit worth of linear distance from 1.0f to 0.0f */
float getval() {
    /* rand() has min 16bit, but we need a 24bit random number. */
    uint_least32_t r = (rand() & 0xffff) + ((rand() & 0x00ff) << 16);
    /* 5.9604645E-8 is (1f - 0.99999994f), 0.99999994f is the first value less than 1f. */
    return (double)r * 5.9604645E-8;
}

int main()
{
    srand(time(NULL));
... 
```

我无法发布两个答案，所以这是第二个解决方案。log2 随机数，大量偏向 0.0f，但它确实是 1.0f 到 0.0f 的随机浮点数。

```
#include <cstdint>
#include <cstdlib>
#include <ctime>

using namespace std;

float getval () {
    union UNION {
        uint32_t i;
        float f;
    } r;
    /* 3 because it's 0011, the first bit is the float's sign.
     * Clearing the second bit eliminates values > 1.0f.
     */
    r.i = (rand () & 0xffff) + ((rand () & 0x3fff) << 16);
    return r.f;
}

int main ()
{
    srand (time (NULL));
... 
```

# c# - 如何在 C# 中调用和使用 WSAAsyncSelect()？

> ID：686355
> 
> 赞同：2
> 
> 时间：2009-03-26T15:49:25.747
> 
> 标签：c#, asynchronous, callback

我在设置赏金时编辑了我的问题。我想从 WinAPI 调用/DllImport WSAAsyncSelect() 并像在 Delphi/C++ 中使用它一样使用它

例如 - 德尔福

```
//Async CallBack handler Declaration
procedure MessageHandler(var Msg:Tmessage);Message WM_WINSOCK_ASYNC_MSG;

//Where i setup the Async
dwError := WSAAsyncSelect(Sock, form1.handle, WM_WINSOCK_ASYNC_MSG, FD_CLOSE or FD_READ);

//Async Callback Handler
procedure Tform1.MessageHandler(var Msg:Tmessage);
begin
  case WSAGetSelectEvent(MSG.LParam) of //LParam is FD_READ/FR_CLOSE/FD_WRITE
    FD_READ: OnSocketRead(MSG.WParam); //WPARAM is the Socket itself.
    FD_CLOSE: OnSocketClose(MSG.WParam);
  end;
end; 
```

提前致谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-19T15:42:36.620

我做到了！最后！！！

WSAAsyncSelect() 结构

```
 [DllImport("wsock32.dll")]
    public static extern int WSAAsyncSelect(
    int socket,
    int hWnd,
    int wMsg,
    int lEvent
    ); 
```

WS2 类

```
public class WS2
{
    public static Socket sock;
    public static byte[] data = new byte[8096];
    public static int server = 0;
    public static bool forced = true;

    public static void Close()
    {
        //Extern.closesocket(sock.Handle.ToInt32());
        //Extern.WSACleanup();

        sock.Shutdown(SocketShutdown.Both);
        sock.Close();

        if (forced)
        {
            Connect();
        }
    }
    public static void ConnectTo(string ip,int port)
    {
        sock = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
        sock.Connect(ip, port);

        int handle = 0;
        var form1 = Form.ActiveForm as FormMain;
        if (form1 != null)
            handle = form1.GetHandle;
        if (handle == 0)
        {
            FormMain.PerformActionOnMainForm(form => form.memo.Text += "An error occured: Error code WS_01_ASYNC_HANDLE");
            return;
        }
        Extern.WSAAsyncSelect(sock.Handle.ToInt32(), handle, Values.MESSAGE_ASYNC, Values.FD_READ | Values.FD_CLOSE);
    }

    public static void Connect()
    {
        //Get IP && port
        string ip = GetIPFromHost("gwgt1.joymax.com");
        if (ip == "")
        {
            ip = GetIPFromHost("gwgt2.joymax.com");
            if (ip == "")
            {
            }
            server +=2;
        }
        else
            server +=1;

        int port = 15779;

        //
        ConnectTo(ip, port);
    }

    public static void Receive()
    {
        int size = sock.Receive(data);
        if (size == 0)
        {
            FormMain.PerformActionOnMainForm(form => form.memo.Text += "An error occured: Error Code WS_02_RECV_BEGN");
        }

        Main.Handle(data, size);
    }

    public static string GetIPFromHost(string HostName)
    {
        IPHostEntry ip;
        try
        {
            ip = Dns.GetHostEntry(HostName);
        }
        catch (Exception)
        {
            return "";
        }
        return ip.AddressList[0].ToString();
    }
} 
```

窗体类中的 WndProc。

```
 protected override void WndProc(ref Message m)
    {
        if (m.Msg == Values.MESSAGE_ASYNC)
        {

            switch (m.LParam.ToInt32())
            {
                case Values.FD_READ:
                    WS2.Receive();
                    break;
                case Values.FD_WRITE: break;
                case Values.FD_CLOSE:
                    WS2.Close();
                    break;
                default: break;
            }

        }
        else
        {
            base.WndProc(ref m);
        }
    } 
```

获取句柄：

```
 public int GetHandle
    {
        get
        {
            if (this.InvokeRequired)
            {
                return (int)this.Invoke((GetHandleDelegate)delegate
                {
                    return this.Handle.ToInt32();
                });
            }
            return this.Handle.ToInt32();
        }
    }
    private delegate int GetHandleDelegate(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T16:00:50.477

（编辑：主要与原始问题有关，在它被编辑并添加赏金之前）

我最近一直在研究这个问题 - 请参阅[Async without the pain](http://marcgravell.blogspot.com/2009/02/async-without-pain.html)。请注意最后关于使用委托版本的注释 - 这稍微简化了调用。

作为更新，最终代码如下所示，并且与 F# 在引擎盖下使用的代码非常相似：

```
public static void RunAsync<T>(
    Func<AsyncCallback, object, IAsyncResult> begin,
    Func<IAsyncResult, T> end,
    Action<Func<T>> callback) {
    begin(ar => {
        T result;
        try {
            result = end(ar); // ensure end called
            callback(() => result);
        } catch (Exception ex) {
            callback(() => { throw ex; });
        }
    }, null);
} 
```

# powershell - $macro 替换 - ExpandString 限制

> ID：686357
> 
> 赞同：2
> 
> 时间：2009-03-26T15:49:40.787
> 
> 标签：powershell, macros

我正在尝试基于[此讨论](http://www.powershellcommunity.org/Forums/tabid/54/aff/1/aft/3684/afv/topic/Default.aspx)来实现宏替换。基本上它可以工作，但似乎 ExpandString 有一些限制：

主.ps1：

```
$foo = 'foo'
$text = [IO.File]::ReadAllText('in.config')
$ExecutionContext.InvokeCommand.ExpandString($text) | out-file 'out.config' 
```

in.config（确定）：

```
$foo 
```

in.config（错误：“处理字符串标记时遇到行尾。”）：

```
" 
```

in.config（错误：“字符串末尾缺少 '。”）：

```
' 
```

该文档指出：

> 返回值：已完成所有变量和表达式替换的扩展字符串。

什么是“表达式替换”（可能是我的情况）？

有一些解决方法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T17:42:21.700

发生错误是因为引号（单引号和双引号）是 PowerShell 运行时的特殊字符。它们表示一个字符串，如果它们仅用作该字符，则需要对其进行转义。

一种可能的解决方法是使用反引号转义引号，具体取决于您想要的结果。

例如，如果我的文本文件有

```
'$foo' 
```

该字符串的结果扩展将是

```
PS>$text = [io.file]::ReadAllText('test.config')
PS>$ExecutionContext.InvokeCommand.ExpandString($text)
$foo 
```

如果您想扩展该变量，则需要转义这些引号。

```
`'$foo`'
PS>$text = [io.file]::ReadAllText('test.config')
PS>$ExecutionContext.InvokeCommand.ExpandString($text)
'foo' 
```

或者，如果您要使用不成对的单引号或双引号，则需要对其进行转义。

您可以对字符串执行 -replace 以转义这些字符，但您必须确保这是全面的预期效果。

```
PS>$single, $double = "'", '"'    
PS>$text = [io.file]::ReadAllText('test.config') -replace "($single|$double)", '`$1'
PS>$ExecutionContext.InvokeCommand.ExpandString($text) 
```

注意：在执行 ExpandString 调用后，您将不再有反引号。

# continuous-integration - 使用 HP Quality Center 进行持续集成是个好主意吗？

> ID：686358
> 
> 赞同：0
> 
> 时间：2009-03-26T15:49:41.067
> 
> 标签：continuous-integration, qtp, issue-tracking, hp-quality-center

我们需要在签入后编译我们的代码，在编译失败时收到通知，运行测试，收到测试结果通知并每天发布我们的应用程序（发布网站或为桌面应用程序创建 msi 文件）。

我们正在使用 SVN，并正在考虑使用 TeamCity 或 CruiseControl.NET 为我们的具有 msunit 测试的 .net 项目提供持续集成服务器。

我的项目经理提出了 HP Quality Center 和 Quick Test Professional（已购买）并建议将它们用于问题跟踪（目前我们正在使用 Jira）和持续集成。

是否有意义？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-10-27T20:41:02.413

**没有**。我现在在客户那里使用，**讨厌**它。它不支持非 MS 浏览器（ActiveX 等），所以在 OS X 上，我们被虚拟机等卡住了。此外，它的界面非常笨拙和缓慢。这是古老、可怕的遗留技术。有很多更好的选择。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T16:39:44.987

我们有很多客户将 QC 缺陷和测试跟踪集成到流水线持续集成中。但是 QC 并没有推动这个过程，它被集成到 CI 和 CID 过程中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-29T18:03:48.153

我们使用 QC 来运行所谓的测试集。我们以这种方式运行非常成功。您可以使用 QC 通知您执行失败。如果在 QTP 结束时没有编译某些内容，这当然会通知您。您还可以设置其他 QTP 和 LoadRunner 脚本以在脚本失败时运行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-11-29T23:55:01.923

不是一个好主意，我已经为 QC 和 Borland 工具（为 HP）做了一个 POC，虽然可能，但同步必须完美的区域太多，有时由于网络等原因，QC 的响应时间很慢要触发正确的文件，获得编译和发布的结果有点不稳定。再次通过 API 从技术上讲，它是完全可行的。

# .net - .Net 部署使用 Excel 的应用程序

> ID：686359
> 
> 赞同：1
> 
> 时间：2009-03-26T15:50:01.550
> 
> 标签：.net, vsto

我开发了一个在 .Net 3.5 中使用 Microsoft.Interop.Excel 版本 11 的应用程序

如何将它部署到没有安装 Microsoft Office 2003 的机器上？

我绝对需要完整的办公室许可证吗？我希望没有...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T15:53:21.353

您需要在运行它的机器上安装 excel。为此，您需要一个涵盖 Excel 的办公许可证。几乎所有类型的办公许可证都涵盖 Excel，尝试寻找最基本的版本（我认为它包含 word、excel、powerpoint）；

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T15:57:54.587

[上一个问题](https://stackoverflow.com/questions/449186/replacement-for-microsoft-office-interop-excel-dll-where-excel-is-not-required-c)讨论了一些替代方案，但我不知道它们是否适合您。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-26T16:25:19.533

不幸的是，要使用 Interop，您需要安装 Excel。如果您有兴趣，我最近制作了一个可以从 Excel 读取的 3rd 方库列表，因为我们需要服务器自动化（Interop 无法做到这一点）。

我们选择了 FlexCel，我很快就用它替换了我们的 Interop 调用，而且它非常易于使用，因为它具有出色的支持，而且成本非常低。 [Excel 阅读器](https://stackoverflow.com/questions/1273116/reading-excel-files-as-a-server-process)

# sql - SQL将数据从临时表插入到另外两个表

> ID：686360
> 
> 赞同：0
> 
> 时间：2009-03-26T15:50:23.733
> 
> 标签：sql

我有一个 CSV 上传到我的应用程序的情况，并且每一行基本上都需要放入数据库中。我读取每一行并构建一个数据表，然后 SqlBulkCopy 将该表复制到一个临时表。

暂存表如下所示：

```
UserID, GroupID, FirstName, LastName, EmailAddress 
```

我在数据库中有另外三个相关的表。联系人表、组表和联系人到组映射表。

```
Contacts:
ID, UserID, FirstName, LastName, EmailAddress

Groups
ID, UserID, Name, Description

ContactGroupMapping
ID, ContactID, GroupID 
```

ContactGroupMapping 表只是将联系人映射到组。希望临时表现在有意义，它包含每个导入联系人的详细信息以及它们也应该映射到的组。

我的计划是在 SqlBulkCopy 之后对数据库运行查询，以将数据从临时表移动到 Contacts 和 ContactGroupMapping 表。目前，我有一个看起来像这样的查询：

```
INSERT INTO Contacts (UserID, FirstName, LastName, EmailAddress)

SELECT DISTINCT [t1].UserID, [t1].EmailAddress, [t1].FirstName, [t1].LastName FROM ContactImportStaging as [t1]
WHERE NOT EXISTS 
(
    SELECT UserID, EmailAddress, FirstName, LastName FROM Contacts
    WHERE UserID = [t1].UserID AND EmailAddress = [t1].EmailAddress AND FirstName = [t1].FirstName AND LastName = [t1].LastName
) 
```

所以，我的问题是，虽然这会将所有不同的联系人插入到我的联系人表中，但我无法将关联的行添加到每个新插入的联系人的映射表中。

我能想出的唯一解决方案（可能是因为我不擅长 SQL）是在联系人表中添加一个额外的可空字段来标识联系人要与之关联的组并插入它。然后我可以运行第二个查询来选择在该列中具有值的所有联系人并插入到映射表中。

关于如何最有效地实现这类事情的任何想法？

谢谢。

**编辑：**详细说明对象模型：有任意数量的联系人和任意数量的组。联系人可以通过 ContactGroupMapping 表中的条目进入组。一个联系人可以在任意数量的组中。在数据库层面，这个模型关注的是三个表**Contacts**、**Groups**和**ContactGroupMapping**。我需要从临时表中移动一行并创建两行；一个在 Contacts 表中，一个在 ContactGroupMapping 表中。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T16:57:26.987

我只是将 CSV 批量复制到临时数据库表中。如果空间是一个问题，您可以稍后删除该表。

在将 CSV 复制到 StagingTable 之后，诀窍是将其拆分到其他表中。由于您的 CSV 现在可以在数据库中引用，您可以加入其他表以检索新表的 ID：

```
insert into ContactGroupMapping
select cont.ID, grp.ID
from StagingTable stag
inner join Contacts cont on cont.UserID = stag.UserID
inner join Groups grp on grp.GroupID = stag.GroupID 
```

一个更简单的解决方案是保留原始的 GroupID 和 UserID。填充 GroupContactMapping 将非常简单：

```
insert into ContactGroupMapping
select UserID, GroupID
from StagingTable stag 
```

# winforms - 如何检测在 winforms 控件上按住的鼠标按钮？

> ID：686371
> 
> 赞同：2
> 
> 时间：2009-03-26T15:53:41.573
> 
> 标签：winforms, scrollbars

我想实现一个自定义滚动条，但希望它像标准滚动条一样工作。因此，我需要检测鼠标按钮是否按住了栏末端的向上或向下箭头，以便用户可以使用栏末端滚动。

如何检测到按钮被按住？

MouseDown 仅在第一次按下按钮时触发一次。MouseUp 将在按钮被释放时触发，但有没有比在 MouseDown 和 MouseUp 之间定期触发某种计时器更好的方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T15:56:35.497

我认为您不会比使用 a 做得更好`Timer`（尽管我可能会感到惊讶）。

我以前用过`Timer`s 来达到同样的目的，它们的工作原理通常是这样的：

*   `Timer` `Start()`s，当按钮按下时使用~ ms `Interval`。`200`此时鼠标也是`Capture`d。
*   每个`Tick`效果一个卷轴。（第一个`Tick`也将间隔更改为〜`25`毫秒）
*   当鼠标出现时，`Timer.Stop()`s。

`Interval`从`200`到更改`25`意味着他们必须按住鼠标一段时间，但一旦他们这样做，滚动动作会更快/更顺畅地发生。

被“按住”的按钮实际上不是一个事件，它更多的是一种状态（即它不会在特定的时间点发生）。

# clojure - 为什么“（def vowel？（set“aeiou”））”有效？

> ID：686375
> 
> 赞同：15
> 
> 时间：2009-03-26T15:54:21.943
> 
> 标签：clojure

我在[这里](http://ociweb.com/jnb/jnbMar2009.html)查看优秀的 Clojure 教程。在其中一个示例中，它的 Clojure 代码如下：

```
(def vowel? (set "aeiou")) 
```

这使得元音对元音返回真，对辅音返回假：

```
(vowel? (first "abc")) ; => true
(vowel? (first "cba")) ; => false 
```

为什么是这样？我假设它与变量名后面的问号有关。在教程中找不到任何东西...

* * *

**编辑**我刚刚意识到`vowel?`不返回真或假，而是元素本身或零。看我自己的答案。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-26T17:33:41.333

这与地图（Clojure 中最自然的对象）的工作方式非常相似。当 map 作为函数调用时，它作为映射工作：

```
user=> (def ob {:foo "bar", :bar :baz, :qwerty 42})
#'user/ob
user=> (ob :foo)
"bar" 
```

因此，可以将 Clojure 集作为函数调用，并将作为成员资格测试工作是有道理的。顺便说一句，如果你使用关键字（那些以冒号开头的东西）作为映射的键，它们也可以作为类似的功能，所以你可以

```
user=> (:bar ob)
:baz 
```

甚至与关键字集相同的东西：

```
user=> (def vowel-keywords (set [:a :e :i :o :u]))
#'user/vowel-keywords
user=> (:a vowel-keywords)
:a
user=> (:b vowel-keywords)
nil 
```

但是，同样，后一种技巧仅适用于关键字，而不适用于您可能用作映射中的键或集合中的成员的任何其他东西。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-26T15:58:58.470

啊哈！我最终自己发现了。它实际上并不返回`true`or `false`，而是返回集合中的第一次出现，如果没有出现，则返回 nil 。

而且因为您可以将其用作条件（nil 被处理为 false，而非 nil 被处理为 true），所以这可以作为一个很好的小技巧来检查字符串是否包含字母。

```
(vowel? (first "abc")) ; => "a"
(vowel? (first "cba")) ; => nil

(if (vowel? (first "abc"))
       (println "yay")
       (println "oops"))  ; => "yay" 
```

# javascript - windows 命令行 javascript

> ID：686377
> 
> 赞同：11
> 
> 时间：2009-03-26T15:55:31.163
> 
> 标签：javascript, windows, command-line

我正在*尝试*通过脚本从 Windows 命令行运行 javascript

cscript //NoLogo test.js

但是，我找不到任何可用的预定义对象。我完全不知所措 - 无法让你好世界工作：

`System.print("Hello, World!")`

结果是`"System" is undefined`

我应该以另一种方式运行它 - 比如通过.NET运行时？

谢谢

杰夫

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-26T15:59:45.910

您正在使用 Windows 脚本宿主。

你可以这样说：

```
WScript.Echo("Hello, World."); 
```

它都是基于 COM 的，因此您可以实例化 ActiveX 控件以执行任何有用的操作：

```
var y = new ActiveXObject("Scripting.Dictionary");
y.add ("a", "test");
if (y.Exists("a"))
   WScript.Echo("true"); 
```

或者：

```
var fso, f1;
fso = new ActiveXObject("Scripting.FileSystemObject");
// Get a File object to query.
f1 = fso.GetFile("c:\\detlog.txt");   
// Print information.
Response.Write("File last modified: " + f1.DateLastModified); 
```

请参阅[Windows 脚本宿主](http://msdn.microsoft.com/en-us/library/9bbdkx3k(VS.85).aspx)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2013-11-26T14:58:54.143

如果你真的想在 shell 中运行 JavaScript，那么你应该考虑安装 Node.js

[http://javascript.cs.lmu.edu/notes/commandlinejs/](http://javascript.cs.lmu.edu/notes/commandlinejs/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-26T16:03:41.017

这实际上是 JScript，当使用`cscript`or运行时`wscript`，它在 Windows Scripting Host 环境下，与基于 Web 的 javascript 没有真正的相似之处。

[Windows 脚本宿主参考](http://msdn.microsoft.com/en-us/library/98591fh7.aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-26T15:58:50.857

尝试`WScript`：

```
WScript.Echo('hello world'); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-01-25T16:56:51.853

这是一个非常过时的线程，许多答案不完整和/或根本不起作用。在 shell 中运行 JS 的方法（不管你是否使用 windows）是使用*Node.js*。安装 Node 后，您可以从命令行使用它，如下所示：

```
$ node
> console.log('Hello, world');
Hello, world
undefined
> .exit 
```

或从文件中：

```
$ cat hello.js
#!/usr/bin/node
console.log('Hello, world');

$ ./hello.js
Hello, world 
```

或者从节点本身：

```
$ node hello.js
Hello, world 
```

# c++ - C++ 本地打包和解包字符串的方法

> ID：686378
> 
> 赞同：2
> 
> 时间：2009-03-26T15:55:33.987
> 
> 标签：c++, binary

按照我之前的[问题](https://stackoverflow.com/questions/684931/content-of-binary-output-file-created-with-output-stream)。有没有办法使用 C++ 本机习语在压缩/位版本中编写字符串。我在想像 Perl 的本机[pack 和 unpack](http://perldoc.perl.org/functions/pack.html)之类的东西。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T17:27:44.280

如果不出意外，我相信你总是可以折叠 perl 头文件和库。见[perlguts](http://search.cpan.org/perldoc?perlguts)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T18:41:58.273

根据阅读您之前的问题，我认为您的意思是说您想要二进制编码输出，而不是“压缩”输出。通常，“压缩”用于特指通过应用诸如 LZW 编码之类的算法减小了大小的数据。在您的情况下，您可能会发现输出在较小的意义上是“压缩的”，因为对于各种各样的数字，二进制表示比 ASCII 表示更有效，但这不是标准意义上的“压缩” ，这可能就是您无法获得所需答案的原因。

我认为您确实在问以下问题：

*给定一个 ASCII 格式的数字（例如存储在 std::string 中），我如何将它作为二进制编码整数写入文件？*

答案分为两部分。首先，您必须将 ASCII 编码字符串转换为整数值。您可以使用诸如 strtol 之类的函数，该函数将返回一个与您的 ASCII 编码数字等效的长整数。请注意，可能以长整数表示的数字的大小存在限制，因此如果您的数字非常非常大，您可能需要更有创意地翻译它们。

其次，您必须使用 ostream::write() 将数据写入输出流，它不会尝试格式化您给它的字节。如果您只是使用默认的 operator<<() 流操作来写入值，您会发现您的数字只是被转换回 ASCII 并以这种方式写出。像这样把这一切放在一起：

```
#include <stdlib.h>        // For strtol().
#include <arpa/inet.h>     // For htonl().
#include <fstream>         // For fstream.
#include <string>          // For string.

int main(int argc, char *argv[]) {
    char *dummy = 0;
    std::string value("12345");

    // Use strtol to convert to an int; "10" here means the string is 
    // in decimal, as opposed to, eg, hexadecimal or octol, etc.

    long intValue = strtol(value.c_str(), &dummy, 10);

    // Convert the value to "network order"; not strictly necessary, 
    // but it is good hygiene.  Note that if you do this, you will 
    // have to convert back to "host order" with ntohl() when you read 
    // the data back.

    uint32_t netValue = htonl(intValue);

    // Create an output stream; make sure to open the file in binary mode.

    std::fstream output;
    output.open("out.dat", std::fstream::out | std::fstream::binary);

    // Write out the data using fstream::write(), not operator<<()!

    output.write(reinterpret_cast<char *>(&netValue), sizeof(netValue));
    output.close();
} 
```

# vba - 从 Excel VBA 发送格式化的 Lotus Notes 富文本电子邮件

> ID：686384
> 
> 赞同：10
> 
> 时间：2009-03-26T15:57:23.060
> 
> 标签：vba, excel, lotus-notes, richtext, lotusscript

我几乎没有 Lotus Script 或 Notes/Domino 知识，但我有一个程序，很久以前从某个地方复制的，它允许我通过 VBA 的 Notes 发送电子邮件。我通常只将它用于格式并不重要的内部通知。

我现在想用它来向客户发送外部电子邮件，而公司类型更希望电子邮件符合我们的样式指南（基本上是无衬线字体）。

我正要告诉他们该代码仅适用于纯文本，但后来我注意到该例程确实引用了某种 CREATERICHTEXTITEM 对象。这是否意味着我可以在正文字符串传递给邮件例程*后*对其应用某种格式？除了维护我们宝贵的品牌价值外，这对我强调电子邮件中的某些段落非常方便。

我对“网络”进行了深入研究，以查看是否可以修改此代码，但不熟悉 Notes 的对象模型，并且在线 Notes 资源似乎反映了应用程序自身的迟钝这一事实，这意味着我没有得到远的。

编码：

```
Sub sendEmail（EmailSubject 作为字符串，EMailSendTo 作为字符串，EMailBody 作为字符串，MailServer 作为字符串）

    将 objNotesSession 调暗为对象
    将 objNotesMailFile 调暗为对象
    将 objNotesDocument 调暗为对象
    将 objNotesField 调暗为对象
    将 sendmail 调暗为布尔值

    '添加用于集成到报告工具中
    将 dbString 调暗为字符串

    dbString = "mail\" & Application.UserName & ".nsf"

出错时转到 SendMailError
    '建立与笔记的连接
    设置 objNotesSession = CreateObject("Notes.NotesSession")
出错时继续下一步
    '建立与邮件文件的连接
    设置 objNotesMailFile = objNotesSession.GETDATABASE(MailServer, dbString)
    '打开邮件
    objNotesMailFile.OPENMAIL
错误转到 0

    '创建新备忘录
    设置 objNotesDocument = objNotesMailFile.createdocument

    将 oWorkSpace 作为对象，oUIdoc 作为对象
    设置 oWorkSpace = CreateObject("Notes.NotesUIWorkspace")
    设置 oUIdoc = oWorkSpace.CurrentDocument

    '创建'主题字段'
    设置 objNotesField = objNotesDocument.APPENDITEMVALUE("Subject", EmailSubject)

    '创建'发送到'字段
    设置 objNotesField = objNotesDocument.APPENDITEMVALUE("SendTo", EMailSendTo)

    '创建'复制到'字段
    设置 objNotesField = objNotesDocument.APPENDITEMVALUE("CopyTo", EMailCCTo)

    '创建'盲复制到'字段
    设置 objNotesField = objNotesDocument.APPENDITEMVALUE("BlindCopyTo", EMailBCCTo)

    “创建”备忘录的“正文”
    设置 objNotesField = objNotesDocument.CREATERICHTEXTITEM("Body")

    使用 objNotesField
        .APPENDTEXT 电子邮件正文
        .ADDNEWLINE 1
    结束于

    '发送电子邮件

    调用 objNotesDocument.Save(True, False, False)
    objNotesDocument.SaveMessageOnSend = True
    'objNotesDocument.Save
    objNotesDocument.Send (0)

    '释放存储
    设置 objNotesSession = 无
    设置 objNotesMailFile = 无
    设置 objNotesDocument = 无
    设置 objNotesField = 无

    '设置返回码
    发送邮件 = 真

    退出子

发送邮件错误：
    暗消息
    Msg = "Error # " & Str(Err.Number) & " 由 " _ 生成
                & Err.Source & Chr(13) & Err.Description
    MsgBox Msg, , "错误", Err.HelpFile, Err.HelpContext
    发送邮件 = 假
结束子
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-26T17:00:25.373

简短的回答是肯定的。长长的回答是痛苦的。没有任何优秀的类可以用来操作 Notes 中的富文本项。但是，您可以研究的一些是 NotesRichTextStyle、NotesRichTextParagraphStyle 和 NotesRichTextTable 等等。这些类帮助您定义一些富文本元素并以编程方式将它们添加到富文本字段中。

由于您要发送电子邮件，因此另一种方法是使用 NotesMIMEEntity 类并使用 HTML 构建电子邮件（更容易）。这是一些示例代码：

```
Set s = New NotesSession
Dim docMail As NotesDocument
Dim body As NotesMIMEEntity
Dim stream As NotesStream

Set db = s.CurrentDatabase
s.ConvertMIME = False ' Do not convert MIME to rich text

'Create email to be sent
Set docMail = db.CreateDocument

With docMail
        .SendTo = SEND TO ADDRESS
        .From = FROM ADDRESS
        .Principal = FROM ADDRESS
        .ReplyTo = REPLY TO ADDRESS
        .Subject = SUBJECT
        .Form = "Memo"
End With

  Set stream = s.CreateStream
Set body = docMail.CreateMIMEEntity
Call stream.WriteText ("YOUR HTML CODE GOES HERE")

'ENC_IDENTITY_8BIT used because of technote found on notes.net
'http://www-10.lotus.com/ldd/nd6forum.nsf/55c38d716d632d9b8525689b005ba1c0/aeedaf28e47546ad85256f6a000a4b48?OpenDocument
Call body.SetContentFromText (stream, "text/html;charset=iso-8859-1",ENC_IDENTITY_8BIT) 

Call docMail.Send(False)
Set docMail = Nothing
Set body = Nothing
Set stream = Nothing

s.ConvertMIME = True ' Restore conversion 
```

本质上，您需要在 NotesSession 中关闭 ConvertMIME 设置。然后创建一个新文档，设置邮件属性等。该部分已经在您的 VBA 代码中。接下来，创建 MIMEEntity 和一个流来保存您的 HTML 文本。最后在您的 MIMEEntity 对象上调用 SetContentFromText 方法。然后发送您的电子邮件。请注意，最后一次调用是为 NotesSession 重新打开 ConvertMIME 功能。

我不确定这是否都可以通过 COM 工作，但它在 Notes 的 LotusScript 代理中运行良好。

我希望这有帮助！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-03-05T16:08:29.127

我喜欢它的本来面目。但是，我不得不更改 `dbString = "mail\" & Application.UserName & ".nsf"` 为 `dbString = "mail\" & Application.CurrentUser & ".nsf"`

第一条评论：我希望在发送时不必打开 Lotus Notes。

第二条评论：我希望我可以更改电子邮件的发件人（即，如果我要向 50 人发送报告，我希望它来自一个通用地址，而不是我的工作地址）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-03T02:10:59.477

要更改它的来源，请创建一个通用 Notes ID（例如 Auto Send/YourCompany）并使用该 ID 保存代理。

# xml - 使用 GZIP 增强 XML 解析

> ID：686390
> 
> 赞同：0
> 
> 时间：2009-03-26T15:58:37.957
> 
> 标签：xml, performance, gzip

我面临处理许多大于 70 MB 的 xml 文件的问题。验证和访问它们需要花费大量时间。现在我想知道以下步骤是否可以提高我的应用程序性能。

我可以在小于 1MB 的 gzip 文件中压缩 70MB 的 xml 文件。所以我只能保存 gzip 文件。可以像这样处理数据：

*   使用 java.io.File 使 gzip 可用（仅小文件）
*   使用例如 StringBufferInputStream 和 GZIPInputStream 来提取 RAM 中的内容
*   处理内容 (RAM)：解析、验证、...
*   在 RAM 中创建一个表示新 xml 内容 (RAM) 的字符串
*   使用GZIPOutputStream访问文件系统（又是小内容）

我可以这样做还是我的想法有误解？

提前谢谢！汉斯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T16:07:22.817

从 HD 读取 70 MB 应该不超过 1-2 秒（当然取决于您的硬件），所以如果您的延迟大于 4 秒，那么瓶颈不是您的 HD，而是 XML 处理以及你用它做的任何事情。

在开始编写您的 gzip 想法（听起来不错）之前，您可以将示例 XML 硬编码到您的代码中（是的，插入 70 MB 作为单个字符串），运行您的应用程序并使用一个漂亮的按钮说（“做它！”） -或者如果您在终端中等待用户输入 - 并查看 XML 处理需要多少时间。

这种方法会在处理之前将您的 70 megs 加载到内存中（作为代码），因此您应该能够看到消耗它真正需要多少。

之后，如果您看到它的处理速度足够快，那么问题显然出在 HD 上。如果没有，那么您应该尝试优化您的 XML 处理。

# sql - 需要一个工具来自动缩进和格式化 SQL Server 存储过程

> ID：686394
> 
> 赞同：14
> 
> 时间：2009-03-26T15:58:59.670
> 
> 标签：sql, sql-server, stored-procedures, formatting

在我当前的项目中，我继承了许多长（1200 多行）SQL Server 存储过程，这些过程带有一些可怕的缩进和格式，这使得它们几乎不可读。是否有一些工具可以用来自动格式化它们并使它们更具可读性？我不想手动浏览它并缩进它。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-26T16:03:10.113

这里有一对——不幸的是，不知道他们工作得有多好……

[http://www.wangz.net/gsqlparser/sqlpp/sqlformat.htm](http://www.wangz.net/gsqlparser/sqlpp/sqlformat.htm)（免费）

[http://www.sqlinform.com/](http://www.sqlinform.com/)（免费供个人使用）

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2013-03-06T10:25:23.100

尝试使用[ApexSQL 重构](http://www.apexsql.com/sql_tools_refactor.aspx)。它集成到 SSMS 中，是一个免费工具。它的好处是它允许保存格式选项并与团队共享它们，因此你们所有人都可以使用相同的代码设置。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-26T16:05:24.850

试试[redgate SQLPrompt](http://www.red-gate.com/products/SQL_Prompt/index.htm)。它有 14 天的试用期。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-26T16:05:57.627

[红门“SQL 重构”](http://www.red-gate.com/products/SQL_Refactor/index.htm)非常好。我们买了

或者

[SSMS 工具包](http://www.ssmstoolspack.com/)免费，但我们不使用布局功能

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-26T16:02:18.587

查看 Sql 辅助：

它有一些格式功能。

[http://www.roundpolygons.com/Default.aspx?PageContentID=5&tabid=92](http://www.roundpolygons.com/Default.aspx?PageContentID=5&tabid=92)

我建议下载评估版，看看它是否符合您的需要。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-30T06:09:16.607

试试 www.softfrontiers.com/Downloads/ReIndenter.shtml 免费（或捐赠）并下载。

适用于 C# 和 SQL Server 代码。

速度非常快并且不会更改代码，除了缩进和结束块注释缺失和可能的情况。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-02-29T11:42:46.580

我正在使用以下链接在线格式化和缩进您的 SQL Server 代码。[http://sqlserverlearner.com/online-tools/tsql-code-formatter](http://sqlserverlearner.com/online-tools/tsql-code-formatter)

它的工作很棒！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-06-22T17:44:08.100

我使用 dbForge SQL Complete 已经有一段时间了，对它很满意（99 美元和免费版）。格式化程序在 Visual Studio 和 SMSS 中工作。它还有一个方便的代码完成功能，比 SMSS 内置的标准功能更好。
[http://www.devart.com/dbforge/sql/sqlcomplete/ordering.html](http://www.devart.com/dbforge/sql/sqlcomplete/ordering.html)

# asp.net - 如何在 ASP.NET 中的代码隐藏文件中调用函数？

> ID：686396
> 
> 赞同：0
> 
> 时间：2009-03-26T15:59:21.900
> 
> 标签：asp.net, vb.net

我有`ShowValue`工作。现在，在最后一行我需要调用函数`newFunction`来重新填充事件`dropdownlist`上的对象。`onClick`

`dropdownlist`单击向下箭头 时出现错误。

如何让两人握手？

我的代码：

```
Public Sub ShowValue(ByVal sender As Object, ByVal e As System.EventArgs)

    lblupdatePanel.Text = DropDownList1.SelectedValue.ToString
    Dim LocationDescription2 As DropDownList = CType(dvContact.FindControl("LocationDescription2"), DropDownList)

    Dim LocationLogic As New LocationBLL
    LocationDescription2.DataSource = LocationLogic.GetUnitByUnitID(DropDownList1.SelectedValue.ToString)
    LocationDescription2.DataTextField = "LocationDescription"
    LocationDescription2.DataValueField = "LocationCode"
    LocationDescription2.SelectedValue = DropDownList1.SelectedValue.ToString
    LocationDescription2.DataBind()

    LocationDescription2.Attributes.Add("onclick", "newFunction(what to put here?);")

End Sub

Public Sub newFunction(ByVal sender As Object, ByVal e As System.EventArgs)

    Dim LocationDescription2 As DropDownList = CType(dvContact.FindControl("LocationDescription2"), DropDownList)
    Dim DivisionDescription1 As DropDownList = CType(dvContact.FindControl("DivisionDescription1"), DropDownList)

    Dim LocationLogic As New LocationBLL
    LocationDescription2.DataSource = LocationLogic.GetLocationByDivisionCode(DivisionDescription1.SelectedValue.ToString)
    LocationDescription2.DataTextField = "LocationDescription"
    LocationDescription2.DataValueField = "LocationCode"
    LocationDescription2.DataBind()

End Sub 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T16:08:36.107

`LocationDescription2.Attributes.Add("onclick", "newFunction(what to put here?);"`

添加不能调用 VB.NET 代码隐藏函数的客户端 javascript 事件处理程序。您需要在 VB.NET 中连接事件

因此它将触发一个回发，此时 ASP.NET 可以调用代码隐藏事件处理程序。

不过，最好在 Page_Load 中定义事件处理程序。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T16:16:01.877

`Attributes.Add`您调用的方法仅影响控件的*呈现 html*。渲染出来的 HTML 只能直接调用 javascript 函数。您需要在服务器上调用此代码。请记住将页面的 HTML/DOM 视图和页面的服务器视图分开在您的脑海中。

要在服务器视图中连接事件，vb.net 语法如下所示：

```
AddHandler LocationDescription2.[EventName], AddressOf newFunction 
```

不幸的是，DropDownList 控件没有单击事件，因此您需要将`EventName`我的示例中的事件替换为此处显示的事件之一：http:
[//msdn.microsoft.com/en-us/library/system.web.ui .webcontrols.dropdownlist_events.aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.dropdownlist_events.aspx)

您将不得不接受最后包含的事件，或者做一些复杂的 JavaScript 工作来模拟 Click 事件。

此外，重要的是要记住，当您处理服务器端事件时，不仅您的特定事件处理程序会运行，而且整个页面也会重新构建。它会进行完整的回发（暂时不考虑ajax）。您需要确保这确实是您想要的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T16:23:50.843

ASP.Net Ajax 工具包。查找级联下拉列表和相关示例。它也会看起来更好。

[ASP.Net Ajax 工具包](http://www.codeplex.com/Wiki/View.aspx?ProjectName=AjaxControlToolkit)

# java - 一个带有-Xmx1024m的Java进程怎么会占用3GB的常驻内存呢？

> ID：686397
> 
> 赞同：5
> 
> 时间：2009-03-26T15:59:33.913
> 
> 标签：java, memory-leaks

它是 Websphere6.1、Solaris 10、JDK 1.5.0_13 上的 Java Web 应用程序。我们将最大堆大小设置为 1024m。jmap 显示堆状态是健康的。堆内存使用率仅为 57%。根本没有OutOfMemory。

但是我们从 ps 看到这个 java 进程的 RSS 非常高（3GB）。pmap 显示一块 1.9G 的私有内存。

```
3785：/dmwdkpmmkg/was/610/java/bin/java -server -Dwas.status.socket=65370 -X
 地址千字节 RSS 匿名锁定 Pgsz 模式映射文件
...
0020A000 2008 2008 2008 - 8K rwx-- [堆]
00400000 1957888 1957888 1957888 - 4M rwx-- [堆]
8D076000 40 40 40 - 8K rw--R [堆栈 tid=10786]
...

```

它是本机代码中的 C 堆内存泄漏吗？推荐什么方法来找出根本原因？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T19:01:34.413

这份来自 Sun 的[内存泄漏故障排除](http://java.sun.com/javase/6/webnotes/trouble/TSG-VM/html/memleaks.html)文档可以帮助您找出导致 RSS 高的问题，特别是在第 3.4 节中。

当您运行 Websphere 时，也许您可​​以在 VM 上使用*-memorycheck*。有关详细信息，请参见[此处](http://publib.boulder.ibm.com/infocenter/javasdk/tools/index.jsp?topic=/com.ibm.java.doc.igaa/_1vg000121410cbe-1195c23a635-7ffd_1001.html)。

它不一定是本机代码的泄漏。如果您看[这里](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=5004956)，在 Solaris 上可能存在文件保持打开的问题。

这只是一堆链接和提示，但可能有助于追踪您的问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-04-21T20:20:02.133

即使没有本机内存泄漏（如未关闭的 zip 资源），也可能发生这种情况。

我遇到了同样的问题。这是 glibc >= 2.10 的已知问题

解决方法是设置这个环境变量 `export MALLOC_ARENA_MAX=4`

IBM 关于设置 MALLOC_ARENA_MAX 的文章 [https://www.ibm.com/developerworks/community/blogs/kevgrig/entry/linux_glibc_2_10_rhel_6_malloc_may_show_excessive_virtual_memory_usage?lang=en](https://www.ibm.com/developerworks/community/blogs/kevgrig/entry/linux_glibc_2_10_rhel_6_malloc_may_show_excessive_virtual_memory_usage?lang=en)

谷歌 MALLOC_ARENA_MAX 或在 SO 上搜索以找到很多参考资料。

您可能还想调整其他 malloc 选项以优化分配内存的低碎片：

```
# tune glibc memory allocation, optimize for low fragmentation
# limit the number of arenas
# requires glibc >= 2.16 since there was a bug in 
# MALLOC_ARENA_TEST parameter handling that cause MALLOC_ARENA_MAX not to work
export MALLOC_ARENA_MAX=2
# disable dynamic mmap threshold, see M_MMAP_THRESHOLD in "man mallopt"
export MALLOC_MMAP_THRESHOLD_=131072
export MALLOC_TRIM_THRESHOLD_=131072
export MALLOC_TOP_PAD_=131072
export MALLOC_MMAP_MAX_=65536 
```

您可以调用本机 malloc_info 函数来获取有关内存分配的信息。这是[使用 JNA 调用本机 malloc_info 方法](https://github.com/lhotari/java-buildpack-diagnostics-app/blob/907d204f21d011f0272c9d47cac9375e5395574b/src/main/groovy/io/github/lhotari/jbpdiagnostics/MallocInfo.java#L20-L28)的示例。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T16:39:22.553

堆大小 os Java 堆大小，仍然有 VM 和其他库是进程的一部分。

尝试运行具有 1024m 堆大小和“for(;;)”的 Hello World，看看它占用了多少。这应该为您提供总体内存使用情况的基准。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T16:24:31.060

你在使用 JNI 库吗？我不确定本机代码如何分配 RAM，但这就是我开始寻找的地方。

# stack - 堆喷射，堆溢出，堆溢出有什么区别？

> ID：686400
> 
> 赞同：6
> 
> 时间：2009-03-26T16:00:35.020
> 
> 标签：stack, buffer, heap-memory

堆喷射，堆溢出，堆溢出有什么区别？

这些术语可以用缓冲区喷射、缓冲区溢出、缓冲区溢出代替吗？

它们也有相同的定义吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-26T16:06:36.907

*   喷洒是将东西写入命名空间中的随机（或至少是任意）地址，从而破坏空间中的任意东西
*   溢出将更多的数据放入空间中，从而破坏相邻空间
*   溢出是将更多的数据放入空间子集（例如，在该空间中分配的对象）中，而不是为该子集分配的数据，从而破坏相邻对象。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-03T13:51:00.040

“堆”通常是指动态分配的内存。“缓冲区”可能位于堆上，但也可能是静态的或驻留在堆栈上。

# perl - 是否有将短字符串消化成短数字的 CPAN 模块？

> ID：686403
> 
> 赞同：4
> 
> 时间：2009-03-26T16:01:04.800
> 
> 标签：perl, hash, module, md5, cpan

我需要为一些短字符串创建唯一的数字 id。

```
some.domain.com    -> 32423421
another.domain.com -> 23332423
yet.another.com    -> 12131232 
```

是否有一个 Perl CPAN 模块可以做这样的事情？

我试过使用 Digest::MD5 但结果数字太长：

```
some.domain.com    -> 296800572457176150356613937260800159845 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-26T16:04:22.013

只需取 MD5 哈希的前 8 位数字。这是因为**MD5*均匀分布*在其散列地址空间**中。这意味着任何连续的 MD5 哈希数字序列本身将是一个均匀分布的哈希。

或者，只需使用其他一些返回 8 个数字的均匀分布的散列机制。对你来说最简单的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-26T16:57:45.210

鉴于字符串看起来像主机名，也许您只需将它们解析为 ip，并将 ip 呈现为整数？

有一些像：

```
perl -le 'my $ip = gethostbyname("depesz.com"); my $num = unpack("N", $ip); print $num'
1311657670 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-26T16:13:30.447

Digest [::CRC](http://search.cpan.org/~olimaul/Digest-CRC-0.14/lib/Digest/CRC.pm)或[String::CRC32](http://search.cpan.org/~soenke/String-CRC32-1.4/CRC32.pod)。第一个为您提供计算 8 位、16 位和 32 位校验和的选项，而第二个仅支持 32 位。

# sharepoint - PerformancePoint 和 Sharepoint 列表作为数据源

> ID：686409
> 
> 赞同：3
> 
> 时间：2009-03-26T16:04:16.430
> 
> 标签：sharepoint, performancepoint

我被要求使用仪表板设计器工具创建一个非常简单的仪表板，使用 Sharepoint 列表作为我的数据源。我可以创建数据源、检索列表并以表格格式查看数据。现在，当我尝试从该列表中创建 KPI 或记分卡时，我收到“无法检索列表”错误。有没有其他人遇到过这个？这似乎不是连接或权限问题。任何帮助，将不胜感激。

谢谢，-亚历克斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-13T02:30:08.903

您是否参加过[Performance Point 上的 MSDN 虚拟实验室](http://community.winsupersite.com/blogs/itprotips/archive/2008/02/20/microsoft-office-performance-point-server-2007-sharepoint-list-dashboards.aspx)？它具有创建列表和配置仪表板以与列表对话的完整演练。

# c# - C# 'is' 运算符性能

> ID：686412
> 
> 赞同：110
> 
> 时间：2009-03-26T16:04:52.950
> 
> 标签：c#, performance, clr, gettype

我有一个需要快速性能的程序。在它的一个内部循环中，我需要测试一个对象的类型以查看它是否继承自某个接口。

一种方法是使用 CLR 的内置类型检查功能。最优雅的方法可能是 'is' 关键字：

```
if (obj is ISpecialType) 
```

另一种方法是为基类提供我自己的虚拟 GetType() 函数，该函数返回一个预定义的枚举值（在我的情况下，实际上，我只需要一个布尔值）。这种方法会很快，但不太优雅。

我听说有一条专门针对“is”关键字的 IL 指令，但这并不意味着它在翻译成本机汇编时执行得很快。任何人都可以分享一些关于“is”与其他方法的性能的见解吗？

**更新：** 感谢所有知情的答案！似乎在答案中散布了一些有用的观点：安德鲁关于“是”自动执行演员的观点是必不可少的，但 Binary Worrier 和 Ian 收集的性能数据也非常有用。*如果编辑其中一个答案以包含所有*这些信息，那就太好了。

* * *

## 回答 #1

> 赞同：116
> 
> 时间：2009-03-26T16:09:01.130

`is`如果在检查类型后强制转换为该类型，则 使用会损害性能。`is`实际上将对象转换为您正在检查的类型，因此任何后续转换都是多余的。

如果你还是要投射，这里有一个更好的方法：

```
ISpecialType t = obj as ISpecialType;

if (t != null)
{
    // use t here
} 
```

* * *

## 回答 #2

> 赞同：78
> 
> 时间：2009-03-26T16:37:25.070

我和[伊恩](https://stackoverflow.com/questions/686412/c-is-keyword-performance/686456#686456)在一起，你可能不想这样做。

但是，正如您所知，两者之间几乎没有区别，超过 10,000,000 次迭代

*   枚举检查时间为**700** 毫秒（大约）
*   IS 检查以 **1000** 毫秒（大约）进入

我个人不会以这种方式解决这个问题，但如果我被迫选择一种方法，那就是内置的 IS 检查，性能差异不值得考虑编码开销。

我的基类和派生类

```
class MyBaseClass
{
    public enum ClassTypeEnum { A, B }
    public ClassTypeEnum ClassType { get; protected set; }
}

class MyClassA : MyBaseClass
{
    public MyClassA()
    {
        ClassType = MyBaseClass.ClassTypeEnum.A;
    }
}
class MyClassB : MyBaseClass
{
    public MyClassB()
    {
        ClassType = MyBaseClass.ClassTypeEnum.B;
    }
} 
```

**JubJub：根据要求提供有关测试的更多信息。**

我从控制台应用程序（调试版本）运行了两个测试，每个测试如下所示

```
static void IsTest()
{
    DateTime start = DateTime.Now;
    for (int i = 0; i < 10000000; i++)
    {
        MyBaseClass a;
        if (i % 2 == 0)
            a = new MyClassA();
        else
            a = new MyClassB();
        bool b = a is MyClassB;
    }
    DateTime end = DateTime.Now;
    Console.WriteLine("Is test {0} miliseconds", (end - start).TotalMilliseconds);
} 
```

在发行版中运行，我得到了 60 - 70 毫秒的差异，就像伊恩一样。

**进一步更新 - 2012 年 10 月 25 日**
几年后，我注意到了一些关于此的事情，编译器可以选择`bool b = a is MyClassB`在发行版中省略，因为 b 没有在任何地方使用。

这段代码。. .

```
public static void IsTest()
{
    long total = 0;
    var a = new MyClassA();
    var b = new MyClassB();
    var sw = new Stopwatch();
    sw.Start();
    for (int i = 0; i < 10000000; i++)
    {
        MyBaseClass baseRef;
        if (i % 2 == 0)
            baseRef = a;//new MyClassA();
        else
            baseRef = b;// new MyClassB();
        //bool bo = baseRef is MyClassB;
        bool bo = baseRef.ClassType == MyBaseClass.ClassTypeEnum.B;
        if (bo) total += 1;
    }
    sw.Stop();
    Console.WriteLine("Is test {0} miliseconds {1}", sw.ElapsedMilliseconds, total);
} 
```

. . . 始终显示`is`检查大约 57 毫秒，枚举比较大约 29 毫秒。

**注意** *，我还是更喜欢`is`支票，差别太小了，不在乎*

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-11-29T23:02:19.560

好的，所以我正在与某人聊天并决定对此进行更多测试。据我所知，与测试自己的成员或函数来存储类型信息相比，`as`和的性能都非常好。`is`

我用过`Stopwatch`，我刚学到的可能不是最可靠的方法，所以我也尝试了`UtcNow`。后来，我还尝试了处理器时间方法，这似乎类似于`UtcNow`包括不可预测的创建时间。我还尝试使基类不抽象，没有虚拟，但它似乎没有显着的效果。

我在配备 16GB RAM 的 Quad Q6600 上运行它。即使有 5000 万次迭代，数字仍然会在 +/- 50 毫秒左右反弹，所以我不会过多地解读细微的差异。

有趣的是，x64 创建速度更快但执行速度比 x86 慢

**x64 发布模式：**
秒表：
As：561ms
Is：597ms
基本属性：539ms
基本字段：555ms
基本 RO 字段：552ms
虚拟 GetEnumType() 测试：556ms
虚拟 IsB() 测试：588ms
创建时间：10416ms

UtcNow:
As: 499ms
Is: 532ms
Base property: 479ms
Base field: 502ms
Base RO field: 491ms
Virtual GetEnumType(): 502ms
Virtual bool IsB(): 522ms
Create Time : 285ms （这个数字在 UtcNow 中似乎不可靠。我也得到 109ms和 806 毫秒。）

**x86 发布模式：**
秒表：
As：391ms
Is：423ms
基本属性：369ms
基本字段：321ms
基本 RO 字段：339ms
虚拟 GetEnumType() 测试：361ms
虚拟 IsB() 测试：365ms
创建时间：14106ms

UtcNow:
As: 348ms
Is: 375ms
Base property: 329ms
Base field: 286ms
Base RO field: 309ms
Virtual GetEnumType(): 321ms
Virtual bool IsB(): 332ms
Create Time : 544ms (这个数字对于 UtcNow 来说似乎不可靠。)

这是大部分代码：

```
 static readonly int iterations = 50000000;
    void IsTest()
    {
        Process.GetCurrentProcess().ProcessorAffinity = (IntPtr)1;
        MyBaseClass[] bases = new MyBaseClass[iterations];
        bool[] results1 = new bool[iterations];

        Stopwatch createTime = new Stopwatch();
        createTime.Start();
        DateTime createStart = DateTime.UtcNow;
        for (int i = 0; i < iterations; i++)
        {
            if (i % 2 == 0) bases[i] = new MyClassA();
            else bases[i] = new MyClassB();
        }
        DateTime createStop = DateTime.UtcNow;
        createTime.Stop();

        Stopwatch isTimer = new Stopwatch();
        isTimer.Start();
        DateTime isStart = DateTime.UtcNow;
        for (int i = 0; i < iterations; i++)
        {
            results1[i] =  bases[i] is MyClassB;
        }
        DateTime isStop = DateTime.UtcNow; 
        isTimer.Stop();
        CheckResults(ref  results1);

        Stopwatch asTimer = new Stopwatch();
        asTimer.Start();
        DateTime asStart = DateTime.UtcNow;
        for (int i = 0; i < iterations; i++)
        {
            results1[i] = bases[i] as MyClassB != null;
        }
        DateTime asStop = DateTime.UtcNow; 
        asTimer.Stop();
        CheckResults(ref  results1);

        Stopwatch baseMemberTime = new Stopwatch();
        baseMemberTime.Start();
        DateTime baseStart = DateTime.UtcNow;
        for (int i = 0; i < iterations; i++)
        {
            results1[i] = bases[i].ClassType == MyBaseClass.ClassTypeEnum.B;
        }
        DateTime baseStop = DateTime.UtcNow;
        baseMemberTime.Stop();
        CheckResults(ref  results1);

        Stopwatch baseFieldTime = new Stopwatch();
        baseFieldTime.Start();
        DateTime baseFieldStart = DateTime.UtcNow;
        for (int i = 0; i < iterations; i++)
        {
            results1[i] = bases[i].ClassTypeField == MyBaseClass.ClassTypeEnum.B;
        }
        DateTime baseFieldStop = DateTime.UtcNow;
        baseFieldTime.Stop();
        CheckResults(ref  results1);

        Stopwatch baseROFieldTime = new Stopwatch();
        baseROFieldTime.Start();
        DateTime baseROFieldStart = DateTime.UtcNow;
        for (int i = 0; i < iterations; i++)
        {
            results1[i] = bases[i].ClassTypeField == MyBaseClass.ClassTypeEnum.B;
        }
        DateTime baseROFieldStop = DateTime.UtcNow;
        baseROFieldTime.Stop();
        CheckResults(ref  results1);

        Stopwatch virtMethTime = new Stopwatch();
        virtMethTime.Start();
        DateTime virtStart = DateTime.UtcNow;
        for (int i = 0; i < iterations; i++)
        {
            results1[i] = bases[i].GetClassType() == MyBaseClass.ClassTypeEnum.B;
        }
        DateTime virtStop = DateTime.UtcNow;
        virtMethTime.Stop();
        CheckResults(ref  results1);

        Stopwatch virtMethBoolTime = new Stopwatch();
        virtMethBoolTime.Start();
        DateTime virtBoolStart = DateTime.UtcNow;
        for (int i = 0; i < iterations; i++)
        {
            results1[i] = bases[i].IsB();
        }
        DateTime virtBoolStop = DateTime.UtcNow;
        virtMethBoolTime.Stop();
        CheckResults(ref  results1);

        asdf.Text +=
        "Stopwatch: " + Environment.NewLine 
          +   "As:  " + asTimer.ElapsedMilliseconds + "ms" + Environment.NewLine
           +"Is:  " + isTimer.ElapsedMilliseconds + "ms" + Environment.NewLine
           + "Base property:  " + baseMemberTime.ElapsedMilliseconds + "ms" + Environment.NewLine + "Base field:  " + baseFieldTime.ElapsedMilliseconds + "ms" + Environment.NewLine + "Base RO field:  " + baseROFieldTime.ElapsedMilliseconds + "ms" + Environment.NewLine + "Virtual GetEnumType() test:  " + virtMethTime.ElapsedMilliseconds + "ms" + Environment.NewLine + "Virtual IsB() test:  " + virtMethBoolTime.ElapsedMilliseconds + "ms" + Environment.NewLine + "Create Time :  " + createTime.ElapsedMilliseconds + "ms" + Environment.NewLine + Environment.NewLine+"UtcNow: " + Environment.NewLine + "As:  " + (asStop - asStart).Milliseconds + "ms" + Environment.NewLine + "Is:  " + (isStop - isStart).Milliseconds + "ms" + Environment.NewLine + "Base property:  " + (baseStop - baseStart).Milliseconds + "ms" + Environment.NewLine + "Base field:  " + (baseFieldStop - baseFieldStart).Milliseconds + "ms" + Environment.NewLine + "Base RO field:  " + (baseROFieldStop - baseROFieldStart).Milliseconds + "ms" + Environment.NewLine + "Virtual GetEnumType():  " + (virtStop - virtStart).Milliseconds + "ms" + Environment.NewLine + "Virtual bool IsB():  " + (virtBoolStop - virtBoolStart).Milliseconds + "ms" + Environment.NewLine + "Create Time :  " + (createStop-createStart).Milliseconds + "ms" + Environment.NewLine;
    }
}

abstract class MyBaseClass
{
    public enum ClassTypeEnum { A, B }
    public ClassTypeEnum ClassType { get; protected set; }
    public ClassTypeEnum ClassTypeField;
    public readonly ClassTypeEnum ClassTypeReadonlyField;
    public abstract ClassTypeEnum GetClassType();
    public abstract bool IsB();
    protected MyBaseClass(ClassTypeEnum kind)
    {
        ClassTypeReadonlyField = kind;
    }
}

class MyClassA : MyBaseClass
{
    public override bool IsB() { return false; }
    public override ClassTypeEnum GetClassType() { return ClassTypeEnum.A; }
    public MyClassA() : base(MyBaseClass.ClassTypeEnum.A)
    {
        ClassType = MyBaseClass.ClassTypeEnum.A;
        ClassTypeField = MyBaseClass.ClassTypeEnum.A;            
    }
}
class MyClassB : MyBaseClass
{
    public override bool IsB() { return true; }
    public override ClassTypeEnum GetClassType() { return ClassTypeEnum.B; }
    public MyClassB() : base(MyBaseClass.ClassTypeEnum.B)
    {
        ClassType = MyBaseClass.ClassTypeEnum.B;
        ClassTypeField = MyBaseClass.ClassTypeEnum.B;
    }
} 
```

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2012-07-17T08:46:36.650

我对两种类型比较的可能性进行了性能比较

1.  **myobject.GetType() == typeof(MyClass)**
2.  **我的对象是我的类**

**结果是：使用“is”大约快 10 倍！！！**

输出：

*类型比较时间：00:00:00.456*

*Is-比较时间：00:00:00.042*

我的代码：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Diagnostics;

namespace ConsoleApplication3
{
    class MyClass
    {
        double foo = 1.23;
    }

    class Program
    {
        static void Main(string[] args)
        {
            MyClass myobj = new MyClass();
            int n = 10000000;

            Stopwatch sw = Stopwatch.StartNew();

            for (int i = 0; i < n; i++)
            {
                bool b = myobj.GetType() == typeof(MyClass);
            }

            sw.Stop();
            Console.WriteLine("Time for Type-Comparison: " + GetElapsedString(sw));

            sw = Stopwatch.StartNew();

            for (int i = 0; i < n; i++)
            {
                bool b = myobj is MyClass;
            }

            sw.Stop();
            Console.WriteLine("Time for Is-Comparison: " + GetElapsedString(sw));
        }

        public static string GetElapsedString(Stopwatch sw)
        {
            TimeSpan ts = sw.Elapsed;
            return String.Format("{0:00}:{1:00}:{2:00}.{3:000}", ts.Hours, ts.Minutes, ts.Seconds, ts.Milliseconds);
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2009-03-26T16:15:15.327

安德鲁是正确的。事实上，通过代码分析，这会被 Visual Studio 报告为不必要的强制转换。

一个想法（不知道你在做什么有点在黑暗中拍摄），但我一直被建议避免像这样检查，而是有另一个类。因此，与其根据类型进行一些检查并采取不同的行动，不如让班级知道如何处理自己......

例如 Obj 可以是 ISpecialType 或 IType；

它们都定义了一个 DoStuff() 方法。对于 IType 它可以只返回或做自定义的东西，而 ISpecialType 可以做其他的东西。

然后，这完全消除了任何强制转换，使代码更清晰，更易于维护，并且该类知道如何完成它自己的任务。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2017-06-04T09:28:49.790

Point Andrew Hare 提出了当您执行`is`检查然后强制转换有效时性能损失，但在 C# 7.0 中，我们可以做的是检查女巫模式匹配以避免以后额外的强制转换：

```
if (obj is ISpecialType st)
{
   //st is in scope here and can be used
} 
```

此外，如果您需要在多种类型之间进行检查，C# 7.0 模式匹配构造现在允许您`switch`对类型执行以下操作：

```
public static double ComputeAreaModernSwitch(object shape)
{
    switch (shape)
    {
        case Square s:
            return s.Side * s.Side;
        case Circle c:
            return c.Radius * c.Radius * Math.PI;
        case Rectangle r:
            return r.Height * r.Length;
        default:
            throw new ArgumentException(
                message: "shape is not a recognized shape",
                paramName: nameof(shape));
    }
} 
```

[您可以在此处](https://docs.microsoft.com/en-us/dotnet/csharp/pattern-matching)的文档中阅读有关 C# 中模式匹配的更多信息。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2017-08-11T10:38:30.973

万一有人想知道，我已经在 Unity 引擎 2017.1 中进行了测试，脚本运行时版本 .NET4.6（实验）在 i5-4200U CPU 的笔记本电脑上进行。结果：

`Average Relative To Local Call LocalCall 117.33 1.00 is 241.67 2.06 Enum 139.33 1.19 VCall 294.33 2.51 GetType 276.00 2.35`

全文：[http ://www.ennoble-studios.com/tuts/unity-c-performance-comparison-is-vs-enum-vs-virtual-call.html](http://www.ennoble-studios.com/tuts/unity-c-performance-comparison-is-vs-enum-vs-virtual-call.html)

* * *

## 回答 #8

> 赞同：-3
> 
> 时间：2014-07-03T17:40:16.323

我一直被建议避免像这样检查，而是上另一堂课。因此，与其根据类型进行一些检查并采取不同的行动，不如让班级知道如何处理自己......

例如 Obj 可以是 ISpecialType 或 IType；

它们都定义了一个 DoStuff() 方法。对于 IType 它可以只返回或做自定义的东西，而 ISpecialType 可以做其他的东西。

然后，这完全消除了任何强制转换，使代码更清晰，更易于维护，并且该类知道如何完成它自己的任务。

# delphi - Delphi 字符串生成器

> ID：686413
> 
> 赞同：25
> 
> 时间：2009-03-26T16:05:13.573
> 
> 标签：delphi

Delphi 中是否存在类似于 Java 或 C# StringBuilder 的东西？或者Delphi不需要StringBuilder，`s := s + 'some string';`是很好的表达方式（主要在for、while循环中）。

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2009-03-26T16:09:13.610

是的，Delphi 提供 TStringBuilder（从 2009 版开始）：

```
procedure TestStringBuilder;
var
  I: Integer;
  StringBuilder: TStringBuilder;
begin
  StringBuilder := TStringBuilder.Create;
  try
    for I := 1 to 10 do
    begin
      StringBuilder.Append('a string ');
      StringBuilder.Append(66); //add an integer
      StringBuilder.Append(sLineBreak); //add new line
    end;

    OutputWriteLine('Final string builder length: ' +
                    IntToStr(StringBuilder.Length));
  finally
    StringBuilder.Free;
  end;
end; 
```

是的，你是对的。`s := s + 'text';`并不比使用 TStringBuilder 慢。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-26T16:30:40.203

在较旧的 Delphis 中，您可以使用[Hallvard Vassbotn](http://hallvards.blogspot.com "霍尔瓦德的博客")的 HVStringBuilder。我未能在他的博客上找到源代码，但您可以在[OmniThreadLibrary](http://code.google.com/p/omnithreadlibrary/source/browse/#svn/trunk/src)源代码树中获取它们，例如（您需要文件 HVStringBuilder.pas 和 HVStringData.pas）。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-30T16:30:58.407

Delphi 不“**需要**”字符串生成器类，但如果您愿意使用它，Delphi 2009 提供了一个。你的例子*s := s + 'some string';* 是一种典型的连接字符串的方法，在过去的几十年里一直在 Pascal/Delphi 中使用，没有任何重大问题。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-04-25T21:22:29.957

提到的*TStringBuilder*是要走的路。在您的特定情况下，串联可能没问题，但无论如何我都会尝试替代方案。

我正在内存中创建一个 EPUB 正文内容 xhtml 文件（Delphi XE），生成它需要很长时间，以至于我从来没有让它完成（放弃前大约**5 分钟）。**这是一个结合了大约 800,000 个字符的文本的真实示例。使用完全相同的代码并直接用*TStringBuilder.Append语句替换**s:=s+''*样式语句将其缩短到大约**3 seconds**。重申一下，除了从串联切换之外，没有任何逻辑变化。

 **** * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-27T03:38:12.907

我在下面列出了一些关于 Delphi 字符串的好资源。

正如其他人所说，使用 '+' 运算符与通用字符串类型的简单连接与使用 TStringbuilder 一样快（至少对于以下形式的操作：'s := s + [...]'）。不知道这是否属实，但性能至少足够接近，以至于下面的 [1] 断言“Delphi 中的字符串连接速度如此之快，以至于 Delphi 2009 中新优化的 StringBuilder 类无法击败它。” 这是因为字符串被原地修改，如果需要，Delphi 透明地为基本字符串分配更多内存，而不是对所有数据进行写时复制操作到内存中的新位置。

[1] [http://blog.marcocantu.com/blog/delphi_super_duper_strings.html](http://blog.marcocantu.com/blog/delphi_super_duper_strings.html)

[2] [http://conferences.codegear.com/he/article/32120](http://conferences.codegear.com/he/article/32120)

[3] [http://www.codexterity.com/delphistrings.htm](http://www.codexterity.com/delphistrings.htm)

[4] [http://www.monien.net/blog/index.php/2008/10/delphi-2009-tstringbuilder/](http://www.monien.net/blog/index.php/2008/10/delphi-2009-tstringbuilder/)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-07-20T15:43:22.743

我真的很惊讶在任何评论或示例中都没有提到您可以指示 TStringBuilder 在实例化期间预分配适合任务的缓冲区。换句话说，如果您可以对您可能需要多少内存进行简单的估计，稍微填充一下，并使用该值来实例化 TStringBuilder ，您就可以避免内存重新分配会减慢简单的字符串连接到爬行的速度：

```
buff := TStringBuilder.Create( tmpEstimatedSize ); 
```

我经常在新代码中使用 TStringBuilder 并优化旧代码，增量构建大字符串时的 CPU 节省是显着的。现在是透明的，如果我只有几个字符串要连接，我不会打扰 TStringBuilder。但是，如果我要序列化可能是大量数据的数据，那么 TStringBuilder 是显而易见的解决方案。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-03-18T09:41:05.563

s := s + 'some string' 如果你在循环中执行它可能会非常慢，因为涉及到内存分配。我做了一些测试，表明预分配内存可能快 132 倍（是的，你没看错）！！！！

代码是这样的：

```
 marker:= 1;
 CurBuffLen:= 0;
 for i:= 1 to Length(FileBody) DO
  begin
   if i > CurBuffLen then
    begin
     SetLength(s, CurBuffLen+ BuffSize);
     CurBuffLen:= Length(s)
    end;
   s[marker]:= FileBody[i];
   Inc(marker);
  end; 
```

有关详细信息，请参阅我的答案：[何时以及为什么应该使用 TStringBuilder？](https://stackoverflow.com/questions/1585760/when-and-why-should-i-use-tstringbuilder)

注意：我的代码针对

> s:= s+ c

其中 c 是一个字符，但您可以轻松调整它

> 对于 s:= s + '一些字符串'

.

# java - 在什么情况下，一个空的同步块可以实现正确的线程语义？

> ID：686415
> 
> 赞同：27
> 
> 时间：2009-03-26T16:05:52.540
> 
> 标签：java, multithreading, findbugs, synchronized

我正在查看有关我的代码库的[Findbugs](http://findbugs.sourceforge.net/)报告，并且触发的模式之一是针对空`synchronzied`块（即`synchronized (var) {}`）。[文档](http://findbugs.sourceforge.net/bugDescriptions.html#ESync_EMPTY_SYNC)说：

> 空同步块比大多数人认识到的要微妙和难以正确使用，并且空同步块几乎从来都不是比不那么做作的解决方案更好的解决方案。

在我的情况下，它发生是因为块的内容已被注释掉，但`synchronized`语句仍然存在。在什么情况下空`synchronized`块可以实现正确的线程语义？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-26T16:10:37.163

一个空的同步块将等到没有其他人使用该监视器。

这可能是您想要的，但是因为您没有保护同步块中的后续代码，所以没有什么可以阻止其他人在您运行后续代码时修改您正在等待的内容。这几乎不是你想要的。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2015-08-11T04:31:25.483

我认为早期的答案未能强调关于空`synchronized`块的最有用的事情：跨线程公开变量更改和其他操作。正如[jtahlborn 所](https://stackoverflow.com/a/686438/2402790)指出的，同步通过在编译器上施加*内存屏障来实现这一点。*不过，我没有找到 SnakE 应该在哪里讨论这个问题，所以在这里我解释一下我的意思。

```
int variable;

void test() // This code is INCORRECT
{
    new Thread( () ->  // A
    {
        variable = 9;
        for( ;; )
        {
            // Do other stuff
        }
    }).start();

    new Thread( () ->  // B
    {
        for( ;; )
        {
            if( variable == 9 ) System.exit( 0 );
        }
    }).start();
} 
```

上面的代码不正确。编译器可能会隔离线程 A 对变量的更改，从而有效地将其隐藏在 B 中，然后它将永远循环。

## 使用空`synchronized`块来暴露跨线程的更改

一种更正是向`volatile`变量添加修饰符。但这可能效率低下；它强制编译器公开所有更改，其中可能包括不感兴趣的中间值。`synchronized`另一方面，空块仅在关键点公开更改的值。例如：

```
int variable;

void test() // Corrected version
{
    new Thread( () ->  // A
    {
        variable = 9;
        synchronized( o ) {} // Force exposure of the change
        for( ;; )
        {
            // Do other stuff
        }
    }).start();

    new Thread( () ->  // B
    {
        for( ;; )
        {
            synchronized( o ) {} // Look for exposed changes
            if( variable == 9 ) System.exit( 0 );
        }
    }).start();
}

final Object o = new Object(); 
```

## 内存模型如何保证可见性

两个线程必须在同一个对象上同步以保证可见性。该保证依赖于[Java 内存模型](http://docs.oracle.com/javase/specs/jls/se8/html/jls-17.html#jls-17.4.4)，特别是“监视器 m 上的解锁操作与 m上的所有后续锁定操作*同步”并因此**发生在*这些操作之前的规则。因此，在 A 的`synchronized`块尾部解锁 o 的监视器*发生在*B 块头部的最终锁定之前。并且因为 A 的*write*先于其解锁而 B 的 lock 先于其*read*，所以保证扩展到包括 write 和 read —— *write happens-before read* —— 使得修改后的程序在内存模型方面是正确的。

我认为这是空`synchronized`块最重要的用途。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-26T17:23:23.743

过去的情况是，规范暗示发生了某些内存屏障操作。但是，规范现在已经更改，原始规范从未正确实施。它可以用来等待另一个线程释放锁，但是协调另一个线程已经获得锁会很棘手。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-30T06:45:01.607

同步不仅仅是等待，而不优雅的编码可以达到所需的效果。

来自[http://www.javaperformancetuning.com/news/qotm030.shtml](http://www.javaperformancetuning.com/news/qotm030.shtml)

> 1.  线程获取对象 this 的监视器上的锁（假设监视器已解锁，否则线程等待直到监视器解锁）。
> 2.  线程内存刷新其所有变量，即它的所有变量都有效地从“主”内存读取（JVM 可以使用脏集来优化这一点，以便仅刷新“脏”变量，但从概念上讲这是相同的。参见章节Java 语言规范的第 17.9 节）。
> 3.  代码块被执行（在这种情况下，将返回值设置为 i3 的当前值，它可能刚刚从“主”内存中重置）。
> 4.  （对变量的任何更改现在通常都会写入“主”内存，但对于 geti3() 我们没有任何更改。）
> 5.  线程释放对象 this 的监视器上的锁。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T18:58:21.253

如需深入了解 Java 的内存模型，请观看 Google 的“编程语言高级主题”系列视频： [http ://www.youtube.com/watch?v=1FX4zco0ziY](http://www.youtube.com/watch?v=1FX4zco0ziY)

它很好地概述了编译器可以（通常在理论上，但有时在实践中）对您的代码执行的操作。对于任何认真的 Java 程序员来说都是必不可少的东西！

# c++ - 如何计算调用堆栈帧的数量？

> ID：686419
> 
> 赞同：1
> 
> 时间：2009-03-26T16:06:37.517
> 
> 标签：c++, callstack

对于 C++ 调试应用程序，我希望能够轻松计算调用堆栈帧的数量。是否有操作系统功能可以做到这一点？

我需要这个用于 Windows 和 Posix，即跨平台。一个或两个平台的解决方案都会很棒。

我可以遍历堆栈以找到所有帧，但我想知道是否有一个简单的调用来执行此操作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T17:26:16.297

不，因为这是编译器的事情。

编译器可以自由定义自己的 ABI。这定义了如何定义调用堆栈（如果有）。除非您使用纯“C”，否则这并非易事，并且对于每个编译器都会有所不同。

此外，我听说（但尚未验证）MS 正在使用一种新方案，即堆栈帧随机放置在内存周围，以防止（更难）影响返回跳转的缓冲区溢出攻击。不完全相关，但一个有趣的事实。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-06T21:58:03.953

如果您使用 glibc (Linux)，您可以使用以下函数来获取堆栈跟踪：

```
#include <execinfo.h> 
int backtrace(void **buffer, int size); 
char **backtrace_symbols(void *const *buffer, int size); 
void backtrace_symbols_fd(void *const *buffer, int size, int fd); 
```

有关更多信息，请参阅回溯的手册页。

# ruby - Ruby 异常处理：无法抑制 NoMethodError

> ID：686420
> 
> 赞同：3
> 
> 时间：2009-03-26T16:06:41.697
> 
> 标签：ruby

我只是希望我的方法调用能够抑制它依次调用的方法中可能出现的所有“NoMethodError”异常。

```
def foo
  begin
    bar1
    bar2
  rescue Exception
    return '--'
  end
end 
```

但这不起作用。NoMethodError 不断被提升到顶层。

确切的错误是`undefined method`[]' for nil:NilClass' (NoMethodError)

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-26T16:08:52.907

```
class Object
    def method_missing(meth,*args)
        # do whatever you want here
        end
    end 
```

如果你想要一些不那么全局的东西，你可以在一个更窄的类，甚至是一个特定的实例上这样做：

```
class << my_object
    # and so forth 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T17:23:13.620

您给定的代码工作正常。

从你的错误推断，我猜你的实际代码更像是这样的：

```
class MyClass
  def [](arg)
    self.bim
    self.bam
    self.boom
  rescue Exception
    "--"
  end
end 
```

稍后您将尝试：

```
obj[ 'whatever' ] 
```

并得到`undefined method []' for nil:NilClass' (NoMethodError)`. 这不会发生 b/c 你`MyClass#[]`错误地定义了方法，它是 b/c 你`obj`不是 的实例`MyClass`，它是`nil`. 可能是因为之前的电话。

# nhibernate - NHibernate 没有任何侵入性的类装饰？

> ID：686421
> 
> 赞同：0
> 
> 时间：2009-03-26T16:06:42.163
> 
> 标签：nhibernate, key, composite

NHibernate 不需要太多的 POCO 修饰，但是不得不在我的域对象中放置代理键让我感觉有点不舒服。称我为过分热心——我更喜欢“意识形态一致”——但我的域对象肯定应该使用自然键，而不必求助于代理。

我不介意在我的数据库中使用代理，但我真的不想篡改我的工作域模型。我该如何规避这个问题？

我是否使用复合键对域类进行子类化，调整它们以便 NH 可以使用代理键，但我的域并不明智，只看到超类？

```
class DomainClass
{
     private ParentClass1 _p1; // These two form a composite key
     private ParentClass2 _p2; //
     private int _i;   

     public int SomeProp
     {
         get { return _i; }
     }
}

class NHDomainClass : DomainClass
{
    private long _surrogateKey
    private DomainClass _d;

    public int SomeProp
    {
         get { return  _d.SomeProp; }
    }
} 
```

在这个（仓促的、人为的）示例中，NH 看到 NHDomainClass 并且可以使用代理，但是因为它适应了 DomainClass，它仍然可以在特定于模型的代码中用作可行的 DomainClass。我相当确定这会起作用，只是想确保我不会错过一些明显更简单的方法，这些方法可以在很短的时间内实现相同的目标。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T22:41:51.433

我不确定您是否想要子类化您的常规域对象只是为了添加代理键。您最终会在查询中遇到很多代码噪音，因为您需要像这样使用 Nhibernate 熟悉的类型名称。

```
session.CreateCriteria(typeof(NHDomainClass)); 
```

相反，我可能会满足于将代理键（我更喜欢 guid 以便于复制和合并）作为私有字段或常规域类中的受保护属性。

# c# - C#中的真假运算符是什么？

> ID：686424
> 
> 赞同：18
> 
> 时间：2009-03-26T16:07:17.857
> 
> 标签：c#, operators

C#中`true`and`false` **运算符**的用途和作用是什么？关于这些的[官方文档](http://msdn.microsoft.com/en-us/library/eahhcxk2(VS.71).aspx)是无可救药的非解释性的。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-26T16:12:03.587

**如果您要定义一个专门的布尔值，您将重载`true`or运算符。`false`**然而，这通常不是必需的，这就是为什么它们似乎没有用。例如，在一个模糊逻辑布尔类中，你可能有这样的东西：

```
// Represents a boolean that can store truth values in a range from [0, 1], with
//   a value of one indicating complete metaphysical certitude and a value of
//   zero indicating complete impossibility.
public class FuzzyBoolean {
// ...
   public static bool operator true(FuzzyBoolean fb) {
      return fb.TruthValue > 0;
   }

   public static bool operator false(FuzzyBoolean fb) {
      return fb.TruthValue == 0;
   }
// ...
} 
```

请注意，如果您重载`true`，则还必须重载`false`（反之亦然）。

当然，还有`true`和`false` *literals*，您可以将这两个文字值分配给布尔实例。不要将这些与上面提到的运算符混淆。[**此处**](http://msdn.microsoft.com/en-us/library/aa664483%28VS.71%29.aspx)的 MSDN 文档中提供了一个更重要的示例，说明如何使用它，涉及数据库中的布尔值。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-03-26T16:19:27.250

可以重载 true 和 false 运算符，以允许类将其自己的状态表示为 true 或 false，例如：

```
public class MyClass
{
    //...
    public static bool operator true(MyClass op)
    {
        // Evaluation code...
    }

    public static bool operator false(MyClass op)
    {
        // Evaluation code...
    }
} 
```

您将能够在布尔表达式中使用运算符：

```
MyClass test = new MyClass(4, 3);
if (test)
    Console.WriteLine("Something true");
else
    Console.WriteLine("Something false");

string text = test ? "Returned true" : "Returned false"; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-26T16:10:36.103

请参阅文章中的参考示例

[C#语言规范——数据库布尔类型](http://msdn.microsoft.com/en-us/library/aa664483(VS.71).aspx)

本质上，这些运算符允许在布尔条件逻辑中使用类型的实例，例如`&&`and `||`。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-26T16:10:48.690

它们允许您使用运算符重载语法重载它们，以便您定义的类型可以解释为布尔值。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-05-17T06:52:04.947

在 C# 2.0 之前，true 和 false 运算符用于创建与 SqlBool 等类型兼容的用户定义的可为空值类型。但是，该语言现在提供了对可空值类型的内置支持，并且您应该尽可能使用它们，而不是重载 true 和 false 运算符。有关更多信息。对于可为空的布尔值，表达式 a != b 不一定等于 !(a == b)，因为其中一个或两个值可能为空。您需要分别重载 true 和 false 运算符以正确识别表达式中的空值。以下示例显示如何重载和使用 true 和 false 运算符。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-26T16:12:01.327

允许您使用自定义类型作为逻辑操作的一部分；例如，作为 if 或 while 语句的一部分。

# asp.net - 确定查询是否会在 SQL Server 中返回“太多记录”的有效方法

> ID：686426
> 
> 赞同：0
> 
> 时间：2009-03-26T16:07:38.217
> 
> 标签：asp.net, sql-server, search, forms, count

我有一个可能会返回数千条记录的搜索表单；如果查询返回超过 500 个左右，我想显示一条消息，并让用户优化搜索以获得更少的结果。

在运行实际查询之前，我是否坚持执行 Select Count？这里的最佳做法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T16:19:06.113

选择前 501 条记录。然后，您可以显示它们并告诉用户他们应该优化搜索。

[就是这样](http://www.4guysfromrolla.com/webtech/070605-1.shtml)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T16:11:21.310

```
SELECT COUNT(*)
FROM   (
       SELECT TOP 500 *
       FROM   mytable
       ) 
```

这比仅仅更有效`SELECT COUNT(*)`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T16:10:46.647

您还想向您的用户展示前 n 个结果吗？这可以通过编写“Select top n”（n 是您想要获取的最大行数）而不是“Select”来实现。有关更多详细信息，请参阅[此链接](http://channel9.msdn.com/forums/Coffeehouse/102407-SQL-Server-and-LIMIT-clauses-on-SELECT-statements/)。

# matlab - 为什么 24.0000 在 MATLAB 中不等于 24.0000？

> ID：686439
> 
> 赞同：69
> 
> 时间：2009-03-26T16:10:38.863
> 
> 标签：matlab, floating-point, precision

我正在编写一个程序，我需要删除存储在矩阵中的重复点。问题是，当检查这些点是否在矩阵中时，MATLAB 无法识别它们在矩阵中，尽管它们存在。

在以下代码中，`intersections`函数获取交点：

```
[points(:,1), points(:,2)] = intersections(...
    obj.modifiedVGVertices(1,:), obj.modifiedVGVertices(2,:), ...
    [vertex1(1) vertex2(1)], [vertex1(2) vertex2(2)]); 
```

结果：

```
>> points
points =
   12.0000   15.0000
   33.0000   24.0000
   33.0000   24.0000

>> vertex1
vertex1 =
    12
    15

>> vertex2    
vertex2 =
    33
    24 
```

应从结果中消除两点 (`vertex1`和)。`vertex2`它应该通过以下命令完成：

```
points = points((points(:,1) ~= vertex1(1)) | (points(:,2) ~= vertex1(2)), :);
points = points((points(:,1) ~= vertex2(1)) | (points(:,2) ~= vertex2(2)), :); 
```

这样做之后，我们得到了这个意想不到的结果：

```
>> points
points =
   33.0000   24.0000 
```

结果应该是一个空矩阵。如您所见，第一对（或第二对？）`[33.0000 24.0000]`已被淘汰，但不是第二对。

然后我检查了这两个表达式：

```
>> points(1) ~= vertex2(1)
ans =
     0
>> points(2) ~= vertex2(2)
ans =
     1   % <-- It means 24.0000 is not equal to 24.0000? 
```

问题是什么？

* * *

更令人惊讶的是，我制作了一个只有以下命令的新脚本：

```
points = [12.0000   15.0000
          33.0000   24.0000
          33.0000   24.0000];

vertex1 = [12 ;  15];
vertex2 = [33 ;  24];

points = points((points(:,1) ~= vertex1(1)) | (points(:,2) ~= vertex1(2)), :);
points = points((points(:,1) ~= vertex2(1)) | (points(:,2) ~= vertex2(2)), :); 
```

结果符合预期：

```
>> points
points =  
   Empty matrix: 0-by-2 
```

* * *

## 回答 #1

> 赞同：98
> 
> 时间：2009-03-26T16:14:52.020

您遇到的问题与[浮点数](https://www.mathworks.com/help/matlab/matlab_prog/floating-point-numbers.html)在计算机上的表示方式有关。浮点表示的更详细讨论出现在我的答案的末尾（“浮点表示”部分）。**TL;DR**版本：因为计算机的内存量是有限的，所以数字只能以有限的精度表示。因此，浮点数的精度被限制在一定的小数位（[双精度值](https://en.wikipedia.org/wiki/Double-precision_floating-point_format)大约 16 位有效数字，MATLAB 中使用的默认值）。

## 实际与显示的精度

现在解决问题中的具体示例......**虽然`24.0000`和以相同的`24.0000`方式*显示*，但在这种情况下，它们实际上相差很小的十进制数量。你看不到它，因为 MATLAB[默认只显示 4 位有效数字](https://www.mathworks.com/help/matlab/ref/format.html)，保持整体显示整洁。**如果您想查看完整的精度，您应该发出`format long`命令或查看数字的[十六进制表示](https://www.mathworks.com/help/matlab/ref/num2hex.html)：

```
>> pi
ans =
    3.1416
>> format long
>> pi
ans =
   3.141592653589793
>> num2hex(pi)
ans =
400921fb54442d18 
```

## 初始化值与计算值

由于浮点数只能表示有限数量的值，因此计算可能会产生介于这两种表示之间的值。在这种情况下，结果必须四舍五入到其中之一。这引入了一个小的[机器精度误差](https://en.wikipedia.org/wiki/Machine_epsilon)。这也意味着直接或通过一些计算初始化一个值可能会产生略有不同的结果。例如，该值`0.1`没有*精确的*浮点表示（即略微四舍五入），因此由于四舍五入误差的累积方式，您最终会得到这样的反直觉结果：

```
>> a=sum([0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1]);  % Sum 10 0.1s
>> b=1;                                               % Initialize to 1
>> a == b
ans =
  logical
   0                % They are unequal!
>> num2hex(a)       % Let's check their hex representation to confirm
ans =
3fefffffffffffff
>> num2hex(b)
ans =
3ff0000000000000 
```

## 如何正确处理浮点比较

由于浮点值的差异可能非常小，因此任何比较都应通过检查这些值是否在彼此的某个范围（即容差）内来完成，而不是彼此完全相等。例如：

```
a = 24;
b = 24.000001;
tolerance = 0.001;
if abs(a-b) < tolerance, disp('Equal!'); end 
```

将显示“相等！”。

然后，您可以将代码更改为：

```
points = points((abs(points(:,1)-vertex1(1)) > tolerance) | ...
                (abs(points(:,2)-vertex1(2)) > tolerance),:) 
```

* * *

# 浮点表示

浮点数（特别是[IEEE 754 浮点算术标准](https://en.wikipedia.org/wiki/IEEE_floating_point)）的一个很好的概述是David Goldberg的[*《每一个计算机科学家都应该知道的浮点算术》。*](http://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html)

二进制浮点数实际上由三个整数表示：符号位`s`、有效数（或系数/分数）`b`和指数`e`。[对于双精度浮点格式](https://en.wikipedia.org/wiki/Double-precision_floating-point_format)，每个数字由内存中的 64 位表示，如下所示：

[![在此处输入图像描述](https://i.stack.imgur.com/KTTPX.png)](https://i.stack.imgur.com/KTTPX.png)

然后可以使用以下公式找到实际值：

[![在此处输入图像描述](https://i.stack.imgur.com/nV0ly.png)](https://i.stack.imgur.com/nV0ly.png)

此格式允许 10^-308 到 10^308 范围内的数字表示。对于 MATLAB，您可以从[`realmin`](https://www.mathworks.com/help/matlab/ref/realmin.html)和获得这些限制[`realmax`](https://www.mathworks.com/help/matlab/ref/realmax.html)：

```
>> realmin
ans =
    2.225073858507201e-308
>> realmax
ans =
    1.797693134862316e+308 
```

由于用于表示浮点数的位数是有限的，因此在上述给定范围内可以表示的有限数只有这么多。计算通常会产生一个与这些有限表示之一不完全匹配的值，因此必须对这些值进行四舍五入。如上述示例中所讨论的，这些[机器精度误差](https://en.wikipedia.org/wiki/Machine_epsilon)以不同的方式表现出来。

为了更好地理解这些舍入误差，查看函数提供的相对浮点精度很有用[`eps`](https://www.mathworks.com/help/matlab/ref/eps.html)，它量化了从给定数字到下一个最大浮点表示的距离：

```
>> eps(1)
ans =
     2.220446049250313e-16
>> eps(1000)
ans =
     1.136868377216160e-13 
```

请注意，精度与所表示*的*给定数字的大小有关；较大的数字将在浮点表示之间具有较大的距离，因此小数点后的精度位数较少。对于某些计算，这可能是一个重要的考虑因素。考虑以下示例：

```
>> format long              % Display full precision
>> x = rand(1, 10);         % Get 10 random values between 0 and 1
>> a = mean(x)              % Take the mean
a =
   0.587307428244141
>> b = mean(x+10000)-10000  % Take the mean at a different scale, then shift back
b =
   0.587307428244458 
```

请注意，当我们将 的值`x`从 range`[0 1]`移到 range`[10000 10001]`时，计算一个平均值，然后减去平均偏移量以进行比较，我们得到一个与最后 3 位有效数字不同的值。这说明了数据的偏移或缩放如何改变对其执行的计算的准确性，这是某些问题必须考虑的问题。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-03-26T16:18:11.623

看这篇文章：[浮点的危险](http://www.lahey.com/float.htm)。尽管它的示例在 FORTRAN 中，但它几乎适用于任何现代编程语言，包括 MATLAB。您的问题（及其解决方案）在“安全比较”部分中进行了描述。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-03-26T21:14:29.210

类型

```
format long g 
```

此命令将显示数字的完整值。它可能类似于 24.00000021321 != 24.00000123124

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2011-12-14T18:55:46.443

尝试写作

> 0.1 + 0.1 + 0.1 == 0.3。

警告：您可能会对结果感到惊讶！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-26T16:17:23.760

也许这两个数字实际上是 24.0 和 24.000000001，但您没有看到所有小数位。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-26T16:25:45.287

查看[Matlab EPS 函数](https://www.mathworks.com/help/matlab/ref/eps.html)。

Matlab 使用高达 16 位精度的浮点数学运算（仅显示 5 位）。

# wpf - PowerShell 可以用作 WPF 的代码隐藏吗

> ID：686445
> 
> 赞同：4
> 
> 时间：2009-03-26T16:11:58.797
> 
> 标签：wpf, powershell, code-behind

我们可以使用 [Windows.Markup.XamlReader]::Load 在 PowerShell 中加载 XAML 文件，但是有没有办法将一些 PowerShell 脚本指定为后面的代码？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-26T17:57:09.683

PowerShell 可用于在 WPF 应用程序中提供功能。查看这些关于使用 PowerShell 和 WPF 的精彩博客文章...

HuddledMasses.Org - PowerBoots - 用于 PowerShell 的 WPF GUI 工具包

[PowerBoots - 适用于 PowerShell 的鞋子](http://huddledmasses.org/powerboots-shoes-for-powershell/)

[PowerBoots - 在 PowerShell 1.0 或 2.0 中加载 XAML Windows](http://huddledmasses.org/powerboots-loading-xaml-windows-in-powershell-10-or-20/)

Windows PowerShell 团队博客

[http://blogs.msdn.com/powershell/archive/2008/05/25/powershell-and-wpf-wtf.aspx](http://blogs.msdn.com/powershell/archive/2008/05/25/powershell-and-wpf-wtf.aspx)

[WPF 和 PowerShell – 第 1 部分（Hello World 和欢迎来到 WPF 周）](http://blogs.msdn.com/powershell/archive/2008/05/22/wpf-powershell-part-1-hello-world-welcome-to-the-week-of-wpf.aspx)

[WPF 和 PowerShell – 第 2 部分（使用脚本探索 WPF（和 .NET 的其余部分））](http://blogs.msdn.com/powershell/archive/2008/05/23/wpf-powershell-part-2-exploring-wpf-and-the-rest-of-net-with-scripts.aspx)

[WPF 和 PowerShell——第 3 部分（处理事件）](http://blogs.msdn.com/powershell/archive/2008/05/24/wpf-powershell-part-3-handling-events.aspx)

[WPF 和 PowerShell——第 4 部分（XAML 和显示控制）](http://blogs.msdn.com/powershell/archive/2008/05/25/wpf-powershell-part-4-xaml-show-control.aspx)

[WPF 和 PowerShell - 第 5 部分（使用 WPF 和 PowerShell 模块）](http://blogs.msdn.com/powershell/archive/2008/05/26/wpf-powershell-part-5-using-wpf-powershell-modules.aspx)

[WPF 和 PowerShell - 第 6 部分（在后台运行函数）](http://blogs.msdn.com/powershell/archive/2008/05/27/wpf-powershell-part-6-running-functions-in-the-background.aspx)

[WPF 和 PowerShell - 第 7 部分（共享主机）](http://blogs.msdn.com/powershell/archive/2008/05/28/wpf-powershell-part-7-sharing-hosts.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-04-28T20:32:36.843

现在在 PowerShellPack 中还有[WPK](http://code.msdn.microsoft.com/PowerShellPack)，这使得在 PowerShell 中创建 WPF UI 变得非常简单和有趣。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T16:22:53.217

虽然我不确定，但我猜不会。鉴于 Visual Studio 仅将 C# 和 VB 作为用于构建 WPF 应用程序的语言公开，这意味着需要在工具级别完成工作，以便为语言添加对 WPF 的支持。由于 .NET 语言没有“免费”获得 WPF 支持，因此 PowerShell 是否有能力成为 WPF UI 的代码是值得怀疑的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-05-07T21:50:03.413

当前要查看的位置是[http://showui.codeplex.com/SourceControl/list/changesets](http://showui.codeplex.com/SourceControl/list/changesets)。

抱歉 Show-UI 还没有发布。它是 PowerBoots 和 WPK 的继任者。

# c# - ASP.NET：使用嵌套集合进行数据绑定和更新对象

> ID：686449
> 
> 赞同：3
> 
> 时间：2009-03-26T16:12:11.793
> 
> 标签：c#, asp.net, data-binding

我用“Person”类做了一个小例子，其中包含一个宠物列表。此外，还有一个简单的存储库可以保存/删除/选择 Person 对象。现在我在我的表单上放置一个表单视图（或详细信息视图），选择一个指向我的存储库的对象数据源。到目前为止，它运行良好，我可以创建、更新、删除人......我什至可以在我的视图中的项目模板中显示我的宠物收藏。

但是当我更新一个人时，我的宠物收藏被清除了！当我查看对象绑定源的“更新”事件时，e.InputParameters 包含我输入的所有值，但 pets 集合始终包含 0 个项目。当我查看对象绑定源的 Selected 事件时，我的 e.ReturnValue 包含我选择的人，包括宠物，这是正确的。有任何想法吗？

这是我的个人课程和我的存储库。这是实际上是 linq2hibernate 项目的一个小示例。

```
public class Person 
{ 
    public int ID { get; set; } 
    public string Name { get; set; } 
    public int Age { get; set; } 

    public List<Pet> Pets { get; set; } 

    public Person() 
    { 
        Pets = new List<Pet>(); 
    } 
}

[DataObject] 
public class Repository 
{ 
    List<Person> people = new List<Person>(); 

    public Repository() 
    { 
         //Code to load the person list 
    } 

    public Person FindByID(int ID) 
    { 
        return people.SingleOrDefault(x => x.ID == ID); 
    } 

    public List<Person> FindAll() 
    {                         
        return people; 
    }         

    public void Save(Person person) 
    { 
       // code to save a person 
       // Here you can see a person's pets collection is always empty  
       // when this method is called by the objectdatasource 
    } 

    public void Delete(Person person) 
    { 
    }        

    public void Insert(Person person) 
    { 
    } 
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T01:32:14.940

我相信这是设计使然。传递给 Save 方法的对象与您正在编辑的对象不同。对象绑定源在调用 Save 方法时创建一个**新**的 Person 实例。它使用反射分配属性，并且仅分配在键/值集合中设置的属性。即那些您的DetailsView 具有数据绑定的数据，特别是来自DetailsViewUpdatedEventArgs.Keys、NewValues 和OldValues。

这是有道理的，因为您没有更新 Pets 集合，只有 Person 记录。我建议，在 Save 中调用 FindByID 并重新分配传递者的值——Pets 将保持不变。

我认为也有可能拥有宠物。如果我理解正确，则需要编写自定义序列化程序并将 Person 标记为可序列化。我还没有尝试过。

# c++ - 为非托管 C++ 客户端创建 WCF 服务

> ID：686452
> 
> 赞同：60
> 
> 时间：2009-03-26T16:14:10.557
> 
> 标签：c++, wcf, web-services, soap, wsdl

我需要让非托管 Windows C++ 客户端与 WCF 服务通信。C++ 客户端可以在 Win2000 及更高版本上运行。我可以控制 WCF 服务和正在使用的 C++ API。由于它是用于专有应用程序，因此最好尽可能使用 Microsoft 的东西，绝对不是 GNU 许可的 API。那些有它工作的人，你能分享一个如何让它工作的分步过程吗？

到目前为止，我已经研究了以下选项：

*   WWSAPI - 不好，不能在 Win 2000 客户端上工作。
*   ATL Server，使用[以下指南](http://icoder.wordpress.com/2007/07/25/consuming-a-wcf-service-with-an-unmanaged-c-client-with-credential-passing/)作为参考。我遵循了概述的步骤（删除策略引用并展平 WSDL），但是生成的 WSDL 仍然不能被 sproxy 使用

还有什么想法吗？请仅在您自己实际使用时才回答。

***Edit1***：我为任何我可能感到困惑的人道歉：我正在寻找的是一种从没有安装 .NET 框架的客户端调用 WCF 服务的方法，因此不能选择使用基于 .NET 的帮助程序库，它必须是纯非托管 C++

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2009-03-26T21:56:30.687

基本思想是用 C# 为您的客户端编写 WCF 代码（这种方式更简单），并使用 C++ 桥接 dll 来弥合非托管 C++ 代码和用 C# 编写的托管 WCF 代码之间的差距。

下面是使用 Visual Studio 2008 和 .NET 3.5 SP1 的分步过程。

1.  首先要做的是创建 WCF 服务和托管它的方法。如果您已经有这个，请跳到下面的第 7 步。[否则，请按照此处](https://stackoverflow.com/questions/593454/easiest-language-to-create-a-windows-service/593803#593803)的步骤创建 Windows NT 服务。使用 VS2008 为项目和添加到项目中的任何类提供的默认名称。此 Windows NT 服务将承载 WCF 服务。

    *   将名为 HelloService 的 WCF 服务添加到项目中。为此，右键单击解决方案资源管理器窗口中的项目并选择添加|新项目...菜单项。在“添加新项”对话框中，选择 C# WCF 服务模板并单击“添加”按钮。这会将 HelloService 以接口文件 (IHelloService.cs)、类文件 (HelloService.cs) 和默认服务配置文件 (app.config) 的形式添加到项目中。

    *   像这样定义 HelloService：

``

```
 [ServiceContract]
    public interface IHelloService
    {
        [OperationContract]
        string SayHello(string name);
    }
    public class HelloService : IHelloService
    {
        public string SayHello(string name)
        {
            return String.Format("Hello, {0}!", name);
        }
    } 
```

*   修改上面步骤 1 中创建的 Service1 类，如下所示：

    ```
    using System.ServiceModel;
    using System.ServiceProcess;
    public partial class Service1 : ServiceBase
    {
        private ServiceHost _host;
        public Service1()
        {
            InitializeComponent();
        }
        protected override void OnStart( string [] args )
        {
            _host = new ServiceHost( typeof( HelloService ) );
            _host.Open();
        }
        protected override void OnStop()
        {
            try {
                if ( _host.State != CommunicationState.Closed ) {
                    _host.Close();
                }
            } catch {
            }
        }
    } 
    ```

*   构建项目。

*   打开 Visual Studio 2008 命令提示符。导航到项目的输出目录。键入以下内容： `installutil WindowsService1.exe' 这会在您的本地机器上安装 Windows NT 服务。打开服务控制面板并启动 Service1 服务。为了使下面的步骤 9 起作用，这样做很重要。

    7.  打开另一个 Visual Studio 2008 实例并创建一个 MFC 应用程序，它与您可以从 WCF 获得的距离差不多。例如，我只是创建了一个对话框 MFC 应用程序并添加了一个 Say Hello！按钮。右键单击解决方案资源管理器中的项目，然后选择属性菜单选项。在常规设置下，将输出目录更改为 ..\bin\Debug。在 C/C++ General 设置下，将 ..\HelloServiceClientBridge 添加到 Additional Include Directories。在 Linker General 设置下，将 ..\Debug 添加到 Additional Library Directories。单击确定按钮。
*   从 File 菜单中，选择 Add|New Project... 菜单项。选择 C# 类库模板。将名称更改为 HelloServiceClient 并单击 OK 按钮。右键单击解决方案资源管理器中的项目，然后选择属性菜单选项。在 Build 选项卡中，将输出路径更改为 ..\bin\Debug，这样程序集和 app.config 文件将与 MFC 应用程序位于同一目录中。该库将包含服务引用，即 WCF 代理类，它指向托管在 Windows NT 服务中的 WCF Hello 服务。

*   在解决方案资源管理器中，右键单击 HelloServiceClient 项目的 References 文件夹，然后选择 Add Service Reference... 菜单选项。在地址字段中，输入 Hello Service 的地址。这应该等于上面第 2 步中创建的 app.config 文件中的基地址。单击“开始”按钮。Hello 服务应显示在服务列表中。单击“确定”按钮为 Hello 服务自动生成代理类。 ***笔记：*** *我似乎总是遇到此过程生成的 Reference.cs 文件的编译问题。我不知道我做错了还是有错误，但解决这个问题的最简单方法是直接修改 Reference.cs 文件。这个问题通常是一个命名空间问题，可以用最少的努力来解决。请注意，这是一种可能性。对于此示例，我已将 HelloServiceClient.ServiceReference1 更改为简单的 HelloService（以及任何其他必需的更改）。*

*   为了允许 MFC 应用程序与 WCF 服务交互，我们需要构建一个托管 C++“桥”DLL。从 File 菜单中，选择 Add|New Project... 菜单项。选择 C++ Win32 项目模板。将名称更改为 HelloServiceClientBridge 并单击 OK 按钮。对于应用程序设置，将应用程序类型更改为 DLL 并选中空项目复选框。单击完成按钮。

*   首先要做的是修改项目属性。右键单击解决方案资源管理器中的项目，然后选择属性菜单选项。在常规设置下，将输出目录更改为 ..\bin\Debug，并将公共语言运行时支持选项更改为公共语言运行时支持 (/clr)。在 Framework 和 References 设置下，添加对 .NET System、System.ServiceModel 和 mscorlib 程序集的引用。单击确定按钮。

*   将以下文件添加到 HelloServiceClientBridge 项目 - HelloServiceClientBridge.h、IHelloServiceClientBridge.h 和 HelloServiceClientBridge.cpp。

*   将 IHelloServiceClientBridge.h 修改为如下所示：

    ```
    #ifndef __IHelloServiceClientBridge_h__
    #define __IHelloServiceClientBridge_h__

    #include <string>

    #ifdef HELLOSERVICECLIENTBRIDGE_EXPORTS
    #define DLLAPI __declspec(dllexport)
    #else
    #define DLLAPI __declspec(dllimport)
    #pragma comment (lib, "HelloServiceClientBridge.lib") // if importing, link also
    #endif

    class DLLAPI IHelloServiceClientBridge
    {
    public:
        static std::string SayHello(char const *name);
    };

    #endif // __IHelloServiceClientBridge_h__ 
    ```

*   将 HelloServiceClientBridge.h 修改为如下所示：

    ```
    #ifndef __HelloServiceClientBridge_h__
    #define __HelloServiceClientBridge_h__

    #include <vcclr.h>
    #include "IHelloServiceClientBridge.h"

    #ifdef _DEBUG
    #using<..\HelloServiceClient\bin\Debug\HelloServiceClient.dll>
    #else
    #using<..\HelloServiceClient\bin\Release\HelloServiceClient.dll>
    #endif

    class DLLAPI HelloServiceClientBridge : IHelloServiceClientBridge
    { };

    #endif // __HelloServiceClientBridge_h__ 
    ```

*   .cpp 文件的语法使用托管 C++，这需要一些时间来适应。将 HelloServiceClientBridge.cpp 修改为如下所示：

    ```
    #include "HelloServiceClientBridge.h"

    using namespace System;
    using namespace System::Runtime::InteropServices;
    using namespace System::ServiceModel;
    using namespace System::ServiceModel::Channels;

    std::string IHelloServiceClientBridge::SayHello(char const *name)
    {
        std::string rv;
        gcroot<Binding^> binding = gcnew WSHttpBinding();
        gcroot<EndpointAddress^> address = gcnew EndpointAddress(gcnew String("http://localhost:8731/Design_Time_Addresses/WindowsService1/HelloService/"));
        gcroot<HelloService::HelloServiceClient^> client = gcnew HelloService::HelloServiceClient(binding, address);
        try {
            // call to WCF Hello Service
            String^ message = client->SayHello(gcnew String(name));
            client->Close();
            // marshal from managed string back to unmanaged string
            IntPtr ptr = Marshal::StringToHGlobalAnsi(message);
            rv = std::string(reinterpret_cast<char *>(static_cast<void *>(ptr)));
            Marshal::FreeHGlobal(ptr);
        } catch (Exception ^) {
            client->Abort();
        }
        return rv;
    } 
    ```

*   剩下要做的就是更新 MFC 应用程序以调用 SayHello() WCF 服务调用。在 MFC 窗体上，双击 Say Hello! 按钮以生成 ButtonClicked 事件处理程序。使事件处理程序如下所示：

    ```
    #include "IHelloServiceClientBridge.h"
    #include <string>
    void CMFCApplicationDlg::OnBnClickedButton1()
    {
        try {
            std::string message = IHelloServiceClientBridge::SayHello("Your Name Here");
            AfxMessageBox(CString(message.c_str()));
        } catch (...) {
        }
    } 
    ```

*   运行应用程序并单击 Say Hello! 按钮。这将导致应用程序调用托管在 Windows NT 服务中的 WCF Hello 服务的 SayHello() 方法（顺便说一下，它应该仍在运行）。然后返回值显示在消息框中。

希望您可以从这个简单的示例中推断出满足您的需求。如果这不起作用，请告诉我，以便我修复帖子。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-26T23:10:15.500

对于那些感兴趣的人，我找到了一个半工作的 ATL Server 解决方案。以下是主机代码，注意它使用的是 BasicHttpBinding，它是唯一与 ATL Server 一起工作的代码：

```
 var svc =  new Service1();
        Uri uri = new Uri("http://localhost:8200/Service1");
        ServiceHost host = new ServiceHost(typeof(Service1), uri);

        var binding = new BasicHttpBinding();
        ServiceEndpoint endpoint = host.AddServiceEndpoint(typeof(IService1), binding, uri);
        endpoint.Behaviors.Add(new InlineXsdInWsdlBehavior());

        host.Description.Behaviors.Add(new ServiceMetadataBehavior() { HttpGetEnabled = true });
        var mex = host.AddServiceEndpoint(typeof(IMetadataExchange), MetadataExchangeBindings.CreateMexHttpBinding(), "mex");
        host.Open();

        Console.ReadLine(); 
```

InlineXsdInWsdlBehavior 的代码可以在[这里](http://www.winterdom.com/weblog/2006/10/03/InlineXSDInWSDLWithWCF.aspx)找到。需要对 InlineXsdInWsdlBehavior 进行一项重要更改，以便在涉及复杂类型时它可以与 sproxy 一起正常工作。它是由 sproxy 中的错误引起的，它没有正确限定命名空间别名，因此 wsdl 不能有重复的命名空间别名，否则 sproxy 会出错。以下是需要更改的功能：

```
 public void ExportEndpoint(WsdlExporter exporter, WsdlEndpointConversionContext context)
    {
        int tnsCount = 0;

        XmlSchemaSet schemaSet = exporter.GeneratedXmlSchemas;

        foreach (WsdlDescription wsdl in exporter.GeneratedWsdlDocuments)
        {
            //
            // Recursively find all schemas imported by this wsdl
            // and then add them. In the process, remove any
            // <xsd:imports/>
            //
            List<XmlSchema> importsList = new List<XmlSchema>();
            foreach (XmlSchema schema in wsdl.Types.Schemas)
            {
                AddImportedSchemas(schema, schemaSet, importsList, ref tnsCount);
            }
            wsdl.Types.Schemas.Clear();
            foreach (XmlSchema schema in importsList)
            {
                RemoveXsdImports(schema);
                wsdl.Types.Schemas.Add(schema);
            }
        }
    }

    private void AddImportedSchemas(XmlSchema schema, XmlSchemaSet schemaSet, List<XmlSchema> importsList, ref int tnsCount)
    {
        foreach (XmlSchemaImport import in schema.Includes)
        {
            ICollection realSchemas = schemaSet.Schemas(import.Namespace);
            foreach (XmlSchema ixsd in realSchemas)
            {
                if (!importsList.Contains(ixsd))
                {
                    var new_namespaces = new XmlSerializerNamespaces();
                    foreach (var ns in ixsd.Namespaces.ToArray())
                    {
                        var new_pfx = (ns.Name == "tns") ? string.Format("tns{0}", tnsCount++) : ns.Name;
                        new_namespaces.Add(new_pfx, ns.Namespace);
                    }

                    ixsd.Namespaces = new_namespaces;
                    importsList.Add(ixsd);
                    AddImportedSchemas(ixsd, schemaSet, importsList, ref tnsCount);
                }
            }
        }
    } 
```

下一步是生成 C++ 头文件：

```
sproxy.exe /wsdl http://localhost:8200/Service1?wsdl 
```

然后 C++ 程序看起来像这样：

```
using namespace Service1;

CoInitializeEx( NULL, COINIT_MULTITHREADED  );

{
    CService1T<CSoapWininetClient> cli;
    cli.SetUrl( _T("http://localhost:8200/Service1") );

    HRESULT hr = cli.HelloWorld(); //todo: analyze hr
}

CoUninitialize();
return 0; 
```

生成的 C++ 代码可以很好地处理复杂类型，只是它不能将 NULL 分配给对象。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T22:00:06.807

我将创建一个 C# 托管类来完成 WCF 工作并将该类作为 COM 对象公开给 C++ 客户端。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T16:25:32.930

[您可以使用已弃用的MS Soap Toolkit](http://www.microsoft.com/downloads/details.aspx?familyid=c943c0dd-ceec-4088-9753-86f052ec8450&displaylang=en)轻松实现 SOAP 客户端。不幸的是，除了迁移到 .NET 之外，似乎没有替代品。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-04-16T23:27:06.500

您能否发布一个 REST Web 服务并使用 MSXML COM 库——应该已经安装，有一个 XML 解析器和一个 HTTP 库。

[http://msdn.microsoft.com/en-us/library/ms763742.aspx](http://msdn.microsoft.com/en-us/library/ms763742.aspx)

# java - 从 .XSD 文件生成 Java 类...？

> ID：686453
> 
> 赞同：140
> 
> 时间：2009-03-26T16:14:34.923
> 
> 标签：java, xml, xsd

我有一个巨大的 QuickBooks SDK .XSD 模式文件，它定义了我可以从 QuickBooks 发送/接收的 XML 请求/响应。

我希望能够轻松地从这些 .XSD 文件生成 Java 类，然后我可以使用这些文件将 XML 编组为 Java 对象，并将 Java 对象编组为 XML。

是否有捷径可寻...？

理想情况下，它在运行时不需要基本 Java 发行版之外的任何库。但是我很灵活...

* * *

## 回答 #1

> 赞同：125
> 
> 时间：2009-03-26T16:18:17.613

[JAXB](http://jaxb.java.net/)完全符合您的要求。从 1.6 开始，它内置在 JRE/JDK 中

* * *

## 回答 #2

> 赞同：125
> 
> 时间：2011-08-30T19:49:14.633

要扩展上面的“使用 JAXB”注释，

在 Windows 中 `"%java_home%\bin\xjc" -p [your namespace] [xsd_file].xsd`

例如， `"%java_home%\bin\xjc" -p com.mycompany.quickbooks.obj quickbooks.xsd`

稍等一下，如果您有一个格式良好的 XSD 文件，您将获得一些格式良好的 Java 类

* * *

## 回答 #3

> 赞同：43
> 
> 时间：2009-03-26T22:13:08.320

如果您想在 5 分钟内开始将 Java 编码到 XML 和 XML 到 Java，请尝试简单 XML 序列化。不要花时间学习 JAXB API [http://simple.sourceforge.net/download/stream/doc/tutorial/tutorial.php](http://simple.sourceforge.net/download/stream/doc/tutorial/tutorial.php)

但是，如果您真的热衷于学习 JAXB，这里有一个很好的教程 [http://blogs.oracle.com/teera/entry/jaxb_for_simple_java_xml](http://blogs.oracle.com/teera/entry/jaxb_for_simple_java_xml)

教程内容：

**用于简单 Java-XML 序列化的 JAXB**

在 Java 中有多种方法可以进行 XML 序列化。如果您想对解析和序列化进行细粒度控制，您可以使用 SAX、DOM 或 Stax 以获得更好的性能。然而，我经常想做的是 POJO 和 XML 之间的简单映射。但是，手动创建 Java 类来进行 XML 事件解析并非易事。我最近发现 JAXB 是一种快速方便的 Java-XML 映射或序列化。

JAXB 包含很多有用的特性，您可以在此处查看参考实现。[Kohsuke 的博客](https://www.java.net/blogs/kohsuke/)也是了解有关 JAXB 的更多信息的好资源。对于这篇博文，我将向您展示如何使用 JAXB 进行简单的 Java-XML 序列化。

**POJO 转 XML**

假设我有一个 Item Java 对象。我想将 Item 对象序列化为 XML 格式。我首先要做的是使用 javax.xml.bind.annotation.* 包中的一些 XML 注释来注释这个 POJO。参见 Item.java 的代码清单 1

从代码

*   `@XmlRootElement(name="Item")`表示我想成为根元素。
*   `@XmlType(propOrder = {"name", "price"})`表示我希望元素在 XML 输出中的排列顺序。
*   `@XmlAttribute(name="id", ...)`表示 id 是根元素的属性。
*   `@XmlElement(....)`表示我希望价格和名称成为 Item 中的元素。

我`Item.java`的准备好了。然后我可以继续创建用于编组项的 JAXB 脚本。

```
//creating Item data object
Item item = new Item();
item.setId(2);
item.setName("Foo");
item.setPrice(200);
.....

JAXBContext context = JAXBContext.newInstance(item.getClass());
Marshaller marshaller = context.createMarshaller();
//I want to save the output file to item.xml
marshaller.marshal(item, new FileWriter("item.xml")); 
```

如需完整的代码清单，请参阅代码清单 2 `main.java`。创建了输出代码清单 3`item.xml`文件。它看起来像这样：

```
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<ns1:item ns1:id="2" xmlns:ns1="http://blogs.sun.com/teera/ns/item">
  <ns1:itemName>Foo</ns1:itemName>
  <ns1:price>200</ns1:price>
</ns1:item> 
```

容易吧？您也可以通过简单地更改 marshal(...) 方法的参数（如

```
...
JAXBContext context = JAXBContext.newInstance(item.getClass());
Marshaller marshaller = context.createMarshaller();
// save xml output to the OutputStream instance
marshaller.marshal(item, <java.io.OutputStream instance>);

...
JAXBContext context = JAXBContext.newInstance(item.getClass());
Marshaller marshaller = context.createMarshaller();
StringWriter sw = new StringWriter();
//save to StringWriter, you can then call sw.toString() to get java.lang.String
marshaller.marshal(item, sw); 
```

**XML 到 POJO**

让我们颠倒这个过程。假设我现在有一段 XML 字符串数据，我想把它变成 Item.java 对象。XML 数据（代码清单 3）看起来像

```
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<ns1:item ns1:id="2" xmlns:ns1="http://blogs.sun.com/teera/ns/item">
  <ns1:itemName>Bar</ns1:itemName>
  <ns1:price>80</ns1:price>
</ns1:item> 
```

然后我可以将这个 xml 代码解组为 Item 对象

```
...
ByteArrayInputStream xmlContentBytes = new ByteArrayInputStream (xmlContent.getBytes());
JAXBContext context = JAXBContext.newInstance(Item.getClass());
Unmarshaller unmarshaller = context.createUnmarshaller();
//note: setting schema to null will turn validator off
unmarshaller.setSchema(null);
Object xmlObject = Item.getClass().cast(unmarshaller.unmarshal(xmlContentBytes));
return xmlObject;
... 
```

有关完整的代码清单，请参见代码清单 2 (main.java)。XML 源可以来自 Stream 和文件的多种形式。同样，唯一的区别是方法参数：

```
...
unmarshaller.unmarshal(new File("Item.xml")); // reading from file
...
// inputStream is an instance of java.io.InputStream, reading from stream
unmarshaller.unmarshal(inputStream); 
```

**使用 XML 模式进行验证**

我想在这里提到的最后一件事是在解组到 Java 对象之前使用模式验证输入 XML。我创建了一个名为 item.xsd 的 XML 模式文件。有关完整的代码清单，请参阅代码清单 4 (Item.xsd)。现在我要做的是注册这个模式进行验证。

```
...
Schema schema = SchemaFactory.newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI)
.newSchema(new File("Item.xsd"));
unmarshaller.setSchema(schema); //register item.xsd shcema for validation
... 
```

当我尝试将 XML 数据解组到 POJO 时，如果输入的 XML 不符合模式，则会捕获异常。有关完整的代码清单，请参阅代码清单 5 (invalid_item.xml)。

```
javax.xml.bind.UnmarshalException
- with linked exception:
javax.xml.bind.JAXBException caught: null
[org.xml.sax.SAXParseException: cvc-datatype-valid.1.2.1: 'item1' is
                                not a valid value for 'integer'.] 
```

在这里，我将“id”属性更改为字符串而不是整数。

如果 XML 输入对模式有效，则 XML 数据将成功解组到 Item.java 对象。

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2013-03-15T11:55:30.403

使用 Eclipse IDE：-

1.  将 xsd 复制到一个新的/现有的项目中。
2.  确保您的类路径中有 JAXB 所需的 JAR。[你可以在这里](http://jaxb.java.net/2.2.6/jaxb-ri-2.2.6.zip)下载一个。
3.  右键单击 XSD 文件 -> 生成 -> JAXB 类。

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2016-08-12T15:17:13.777

最简单的方法是使用命令行。只需输入 .xsd 文件的目录：

```
xjc myFile.xsd. 
```

所以，java 会生成所有的 Pojos。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2009-03-26T16:17:57.567

[XMLBeans](http://xmlbeans.apache.org/)会做到这一点。特别是“scomp”命令。

编辑：XMLBeans 已[退役](http://attic.apache.org/projects/xmlbeans.html)，请查看[此 stackoverflow 帖子](https://stackoverflow.com/questions/27727546/what-to-use-instead-of-xmlbeans-now-that-it-has-been-retired)以获取更多信息。

* * *

## 回答 #7

> 赞同：16
> 
> 时间：2013-04-29T06:53:59.360

Maven 可以用于此目的，您需要添加一些依赖项并清理您的应用程序。您将在目标文件夹中自动创建所有类。

只需将它们从目标复制到所需的位置，这是`pom.xml`我用来从`xsd`文件创建分类的：

```
<plugin>
    <groupId>org.codehaus.mojo</groupId>
    <artifactId>jaxb2-maven-plugin</artifactId>

    <executions>
        <execution>
            <goals>
                <goal>xjc</goal>
            </goals>
        </execution>
    </executions>
    <configuration>
        <schemaDirectory>src/main/webapp/schemas/</schemaDirectory>
    </configuration>
</plugin> 
```

只需将您的 xsd 文件放在下面`src/main/webapp/schemas/`，maven 就会在编译时找到它们。

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2011-09-13T06:22:08.060

那么最好的选择是`%java_home%\bin\xjc -p [your namespace] [xsd_file].xsd`。

如果我们可以选择在这里进行逆向工程，我还有一个问题。如果可以，我们可以从 pojo 类生成 xsd 吗？

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2009-03-26T16:19:08.297

如果您不介意使用外部库，我过去曾使用[Castor](http://castor-data-binding.github.io/castor/main/index.html)来执行此操作。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2010-04-27T15:34:11.133

JAXB 限制。

我在 JAXB 上工作，我认为它是处理 XML 和 Java 对象之间数据的好方法。积极的方面是它在运行时的性能和对数据的控制方面得到了证明并且更好。通过良好地使用内置工具或脚本，它将消除大量编码工作。

我发现配置部分不是一个直接的任务，并且花了几个小时来设置开发环境。

然而，由于我面临一个愚蠢的限制，我放弃了这个解决方案。我的 XML 模式定义 ( XSD ) 有一个名为“值”的属性/元素，我必须按原样使用 XSD。这个非常小的约束迫使我的绑定步骤 XJC 失败，并出现错误“已使用属性‘值’”。

这是由于 JAXB 实现，绑定过程尝试通过向每个类添加少量属性（其中一个是值属性）来从 XSD 创建 Java 对象。当它处理我的 XSD 时，它抱怨已经有一个具有该名称的属性。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2010-04-01T13:24:56.697

JAXB 的 XJC 不是对此的可能答案吗？我正在努力实现同样的目标。但仍处于“尝试”阶段。偶然发现了XJC，所以想到了分享。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-03-26T17:13:06.343

著名的[JAXB](http://jaxb.java.net)

有一个[maven 插件](http://jaxb.java.net/maven-jaxb-schemagen/)可以在您想要的任何构建阶段为您执行此操作。

你可以用两种方式来做这些事情：xsd <-> Java

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2010-06-13T17:44:00.983

谈到 JAXB 限制，当不同属性具有相同名称时，一个解决方案是将内联 jaxb 自定义添加到 xsd：

+

. . 有约束力的声明。.

或外部自定义...

您可以查看更多信息：http: [//jaxb.java.net/tutorial/section_5_3-Overriding-Names.html](http://jaxb.java.net/tutorial/section_5_3-Overriding-Names.html)

# javascript - 检测登录字段

> ID：686455
> 
> 赞同：4
> 
> 时间：2009-03-26T16:14:59.227
> 
> 标签：javascript, login

有没有办法使用javascript检测任何网站上的登录字段？IE 和 Firefox 能够“记住”我的用户名和密码。我想创建一个复制该功能的脚本。例如，当显示 GMail 的登录页面时，我如何“找到”用户名和密码字段并获取/设置它们？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T22:57:08.123

基本大纲：

1.  收集所有密码字段
2.  遍历所有这些
3.  在每次迭代中：
    1.  找到密码字段所在的 <form/>
    2.  查找表单中的第一个输入字段，即 1) 不是密码字段和 2) 除了 type="text" 之外的任何内容
4.  返回所有用户名/密码对的数组

* * *

示例输出：

```
[ [ <input id="username" /> , <input type="password" id="pswd" /> ] ] 
```

它将输出一个对数组，每对包含一个用户名和密码节点。显然，在大多数页面上，您只会得到一对，因为只有一个登录部分。

* * *

这里是：

```
function getLoginFields() {
    var fieldPairs = [],
        pswd = (function(){
            var inputs = document.getElementsByTagName('input'),
                len = inputs.length,
                ret = [];
            while (len--) {
                if (inputs[len].type === 'password') {
                    ret[ret.length] = inputs[len];
                }
            }
            return ret;
        })(),
        pswdLength = pswd.length,
        parentForm = function(elem) {
            while (elem.parentNode) {
                if(elem.parentNode.nodeName.toLowerCase() === 'form') {
                    return elem.parentNode;
                }
                elem = elem.parentNode;
            }
        };
    while (pswdLength--) {
        var curPswdField = pswd[pswdLength],
            parentForm = parentForm(curPswdField),
            curField = curPswdField;
        if (parentForm) {
            var inputs = parentForm.getElementsByTagName('input');
            for (var i = 0; i < inputs.length; i++) {
                if (inputs[i] !== curPswdField && inputs[i].type === 'text') {
                    fieldPairs[fieldPairs.length] = [inputs[i], curPswdField];
                    break;
                }
            }
        }
    }
    return fieldPairs;
}

// Usage:
var loginFields = getLoginFields()[0]; // or loop through results. 
```

* * *

在 Yahoo、Amazon、Google、Youtube 上成功测试...（各种帐户/登录页面）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-09-01T13:12:51.587

```
// Locate the username field in the form by searching backwards
// from the first passwordfield, assume the first text field is the
// username. We might not find a username field if the user is
// already logged in to the site.
for (var i = pwFields[0].index - 1; i >= 0; i--) {
  if (form.elements[i].type == "text") {
    usernameField = form.elements[i];
    break;
  }
} 
```

这就是火狐的做法：http: [//mxr.mozilla.org/firefox/source/toolkit/components/passwordmgr/src/nsLoginManager.js#655](http://mxr.mozilla.org/firefox/source/toolkit/components/passwordmgr/src/nsLoginManager.js#655)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T16:20:24.847

一种方法（我几乎可以肯定其中一个浏览器正在使用）是找到第一个 <input type="password">，然后在它之前搜索 <input type="text">。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T16:21:13.020

AFAIK，IE 和 Firefox 密码检测的东西松散地基于字段的名称，也就是说，它会提示您是否在 id 中有用户名和/或密码。

如果你使用 jQuery，你可以使用类似的东西。

```
$('input[id*=username]').css('background', 'red');
// or
$('input[id*=password]').css('background', 'red'); 
```

此外，您可以通过以下方式使用 jQuery 检查任何密码字段

```
$(':password').css('background', 'red'); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T16:21:01.037

我认为浏览器中的用户/密码记住功能是由表单中存在密码类型输入字段触发的。

接下来你要做的是寻找最常见的登录字段`name`d 'login'、'user'、'username'、'j_username'（如果有一个基于[JAAS](http://en.wikipedia.org/wiki/Java_Authentication_and_Authorization_Service)的站点）。如果不这样做，只需存储所有文本输入字段。;)

# .net - 如何使用值转换器将字节数组绑定到 WPF 中的图像？

> ID：686461
> 
> 赞同：18
> 
> 时间：2009-03-26T16:17:14.167
> 
> 标签：.net, wpf, data-binding, xaml, image

我正在尝试将我的数据库中的字节数组绑定到 WPF 图像。

我的 XAML：

```
<Window.Resources>
    <local:BinaryImageConverter x:Key="imgConverter" />
</Window.Resources>
...
<Image Source="{Binding Path=ImageData, Converter={StaticResource imgConverter}}" /> 
```

我已经修改了[Ryan Cromwell](http://cromwellhaus.com/blogs/ryanc/archive/2007/07/26/binding-to-the-byte-of-an-image-in-wpf.aspx)为值转换器发布的代码：

```
Class BinaryImageConverter
    Implements IValueConverter
    Private Function Convert(ByVal value As Object, ByVal targetType As Type, ByVal parameter As Object, ByVal culture As System.Globalization.CultureInfo) As Object Implements IValueConverter.Convert
        If value IsNot Nothing AndAlso TypeOf value Is Byte() Then
            Dim bytes As Byte() = TryCast(value, Byte())
            Dim stream As New MemoryStream(bytes)
            Dim image As New BitmapImage()
            image.BeginInit()
            image.StreamSource = stream
            image.EndInit()
            Return image
        End If
        Return Nothing
    End Function
    Private Function ConvertBack(ByVal value As Object, ByVal targetType As Type, ByVal parameter As Object, ByVal culture As System.Globalization.CultureInfo) As Object Implements IValueConverter.ConvertBack
        Throw New Exception("The method or operation is not implemented.")
    End Function
End Class 
```

BinaryImageConverter 的 Convert() 函数的 i`mage.EndInit()`行抛出此**NotSupportedException**：

> “未找到适合完成此操作的成像组件。”
> 
> InnerException：“来自 HRESULT 的异常：0x88982F50”

我不明白我做错了什么。我怎样才能得到这个工作？

* * *

## 更新

似乎问题出在数据库中的字节数上。我放它们的方式一定有问题。

请参阅下面的我的工作代码。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2011-12-08T14:56:04.793

您**可以**将 byte[] 绑定到图像。

这是一个示例：

xml:

```
<Image Source="{Binding UserImage}"/> 
```

代码：

```
private byte[] userImage;

public byte[] UserImage
   {
       get { return userImage; }
       set
       {
           if (value != userImage)
           {
               userImage = value;
               OnPropertyChanged("UserImage");
           }
       }
   } 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-03-26T19:14:10.513

感谢你的帮助。我现在已经开始工作了。我仍然不确定到底是什么问题。

这就是我将图像放入数据库的方式……

```
Private Sub ButtonUpload_Click(ByVal sender As System.Object, ByVal e As System.Windows.RoutedEventArgs)
    Dim FileOpenStream As Stream = Nothing
    Dim FileBox As New Microsoft.Win32.OpenFileDialog()
    FileBox.InitialDirectory = Environment.GetFolderPath(Environment.SpecialFolder.MyPictures)
    FileBox.Filter = "Pictures (*.jpg;*.jpeg;*.gif;*.png)|*.jpg;*.jpeg;*.gif;*.png|" & _
                     "All Files (*.*)|*.*"
    FileBox.FilterIndex = 1
    FileBox.Multiselect = False
    Dim FileSelected As Nullable(Of Boolean) = FileBox.ShowDialog(Me)
    If FileSelected IsNot Nothing AndAlso FileSelected.Value = True Then
        Try
            FileOpenStream = FileBox.OpenFile()
            If (FileOpenStream IsNot Nothing) Then

                Dim ByteArray As Byte()
                Using br As New BinaryReader(FileOpenStream)
                    ByteArray = br.ReadBytes(FileOpenStream.Length)
                End Using

                Dim g As New ZackGraphic
                g.Id = Guid.NewGuid
                g.ImageData = ByteArray
                g.FileSize = CInt(ByteArray.Length)
                g.FileName = FileBox.FileName.Split("\").Last
                g.FileExtension = "." + FileBox.FileName.Split(".").Last.ToLower
                g.DateAdded = Now

                Dim bmp As New BitmapImage
                bmp.BeginInit()
                bmp.StreamSource = New MemoryStream(ByteArray)
                bmp.EndInit()
                bmp.Freeze()

                g.PixelWidth = bmp.PixelWidth
                g.PixelHeight = bmp.PixelHeight

                db.AddToZackGraphic(g)
                db.SaveChanges()

            End If
        Catch Ex As Exception
            MessageBox.Show("Cannot read file from disk. " & Ex.Message, "Add a New Image", MessageBoxButton.OK, MessageBoxImage.Error, MessageBoxResult.OK)
        Finally
            If (FileOpenStream IsNot Nothing) Then
                FileOpenStream.Close()
            End If
        End Try
    End If
End Sub 
```

这是我用来将字节数组绑定到图像的值转换器……

```
Class BinaryImageConverter
    Implements IValueConverter
    Private Function Convert(ByVal value As Object, ByVal targetType As Type, ByVal parameter As Object, ByVal culture As System.Globalization.CultureInfo) As Object Implements IValueConverter.Convert
        If value IsNot Nothing AndAlso TypeOf value Is Byte() Then
            Dim ByteArray As Byte() = TryCast(value, Byte())
            Dim bmp As New BitmapImage()
            bmp.BeginInit()
            bmp.StreamSource = New MemoryStream(ByteArray)
            bmp.EndInit()
            Return bmp
        End If
        Return Nothing
    End Function
    Private Function ConvertBack(ByVal value As Object, ByVal targetType As Type, ByVal parameter As Object, ByVal culture As System.Globalization.CultureInfo) As Object Implements IValueConverter.ConvertBack
        Throw New Exception("The method or operation is not implemented.")
    End Function
End Class 
```

这是我使用转换器显示图像的 XAML……

```
<Window xmlns:local="clr-namespace:MyProjectName" ... >
    <Window.Resources>
        <local:BinaryImageConverter x:Key="imgConverter" />
    </Window.Resources>
...
<Image Source="{Binding Path=ImageData, Converter={StaticResource imgConverter}}" /> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T16:28:28.010

尝试使用这个

```
Dim imageSource as ImageSource
Dim bitmapDecoder = new PngBitmapDecoder(stream, BitmapCreateOptions.PreservePixelFormat, BitmapCacheOption.OnLoad);
imageSource = bitmapDecoder.Frames[0];
imageSource.Freeze();
Return imageSource 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T16:25:20.653

我相信这实际上是一个安全许可问题。尝试以管理员权限运行，看看是否可行，然后从那里开始。

编辑：我不同意反对票和评论。看看这个链接：

[http://social.expression.microsoft.com/Forums/en-US/wpf/thread/617f6711-0373-44cc-b72c-aeae20f0f7a8/](http://social.expression.microsoft.com/Forums/en-US/wpf/thread/617f6711-0373-44cc-b72c-aeae20f0f7a8/)

该用户有完全相同的错误，它是由安全设置引起的。因此，我坚持我的回答（这可能不是原因，但肯定值得一试）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-26T16:25:26.643

我的猜测是字节不是合法的图像格式。我相信错误代码对应于`WINCODEC_ERR_COMPONENTNOTFOUND`，这将与无效字节一致。

字节数组应该采用什么格式？你能把它保存到磁盘上，然后尝试用另一个成像程序打开它吗？

# wcf - 为什么 WCF 将并发连接数限制为 5？

> ID：686466
> 
> 赞同：13
> 
> 时间：2009-03-26T16:18:09.190
> 
> 标签：wcf, http, iis, concurrency

我在 Vista 的 II7 中托管了一个 WCF 服务（basicHttpBinding），我希望它可以同时处理许多请求。我正在尝试通过在测试应用程序中生成 200 个线程并调用 WCF 服务来加载测试服务。我已经在服务器所在的同一台机器以及多台其他计算机上运行了这个测试应用程序，我总是得到相同的结果——使用的工作人员不超过 5 个。这是 WCF、HTTP 还是 IIS 瓶颈？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-26T16:23:23.887

这是防止拒绝服务攻击的功能。WCF 开箱即用，旨在确保安全。检查服务行为，在 msdn 中查找 maxConcurrentCalls 和 maxConcurrentSessions 配置。我认为限制是 10，但我可能是错的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T16:26:01.930

不，这只是 WCF 中的默认限制设置。它在服务配置文件中行为的 serviceThrottling 元素中配置，该文件具有 maxConcurrentSessions 属性。默认为 5，但您可以将其设置为您想要的任何值。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T16:25:10.687

WCF 默认是安全的。这意味着默认设置限制了您可以使用 WCF 服务执行的操作，以避免诸如拒绝服务攻击之类的事情。这对于面向 Internet 的 Web 服务非常有用，但它有时会咬你一口。根据您使用的绑定和行为，它可能是其中任何一个中的设置。

[以下](http://weblogs.asp.net/paolopia/archive/2008/03/23/wcf-configuration-default-limits-concurrency-and-scalability.aspx)是这些设置的概述 - 您需要进行一些实验才能确定到底是什么在咬您。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-05-30T20:25:33.310

从 .NET 4.5 开始，默认连接数为（100 * 处理器数） - [ServiceThrottlingBehavior.MaxConcurrentSessions 属性](https://msdn.microsoft.com/en-us/library/system.servicemodel.description.servicethrottlingbehavior.maxconcurrentsessions(v=vs.110).aspx)

# postgresql - 恢复 Postgresql 数据库

> ID：686469
> 
> 赞同：5
> 
> 时间：2009-03-26T16:19:03.010
> 
> 标签：postgresql, database-restore, pg-dump

我是否总是必须删除然后创建一个数据库才能从 pg_dump 文件中恢复它？如果我不删除数据库，即使某些寄存器已经在数据库中，正在恢复的数据也会添加到数据库中的当前数据中（因此数据是重复的）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-26T17:02:00.317

您可以在运行 pg_dump 时使用 -c (--clean) 选项，因此转储将包含正确的 DROP ... 命令。

但总的来说，我建议走“硬路”：

```
dropdb ...
createdb ...
psql -d ... -f dump.file 
```

通过这种方式，您可以确定数据库中以前的任何内容都没有“剩余”。

# c++ - 为什么我的返回类型没有意义？

> ID：686470
> 
> 赞同：11
> 
> 时间：2009-03-26T16:19:04.087
> 
> 标签：c++, constants, const-correctness

我正在尝试使用`const MyClass * const`. 但是，我收到警告：

> 警告：#815-D：返回类型的类型限定符没有意义。

这不是有效类型吗？我想要一个无法更改的指针，并且我希望它指向的东西也不会被更改。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-26T16:23:15.900

指针本身具有值类型，因此将其设为 const 没有意义。调用函数对返回值的处理不受被调用函数的限制。这类似于尝试定义如下内容：

```
const int getInt(); 
```

在这种情况下，getInt() 只返回一个 int 值（不是引用）。它进入一个寄存器，然后调用函数接收它并用它做任何它想做的事情。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-26T16:35:18.897

我同意 Juliano 的回答，您希望指针的常量位于调用站点。

做你正在寻找的更好的方法是让你的函数返回一个对对象的 const 引用：

```
const MyClass& getMyClass()
{ 
  return myClass;
} 
```

根据定义，引用不能被修改，所以你会更好。

当然，如果您的函数试图**创建**MyClass 对象，这将不起作用。在这种情况下，您只需将额外的 const 移动到调用站点。

```
// function definition
const MyClass* createMyClass()
{ 
  return new MyClass("I Love C++");
}

// use of a const pointer to a MyClass which is const
const MyClass* const myClassInstance = creatMyClass(); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-26T16:24:35.180

你为什么关心指针是否改变？这样做就像在说：

```
const int f() {
   ...
} 
```

f() 返回的值是一个副本 - 更改它不会改变任何内容，因此将其设为 const 没有意义。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-26T16:34:13.627

确保定义所需返回类型的一种简单方法是始终在原始类型的右侧（而不是左侧）添加修饰符。

```
MyClass                 // MyClass object
MyClass const           // MyClass object which can't be modified
MyClass const &         // reference of an unmodifiable MyClass object 
MyClass const *         // pointer to an unmodifiable MyClass object
MyClass const * const   // unmodifiable pointer to an unmodifiable MyClass object
MyClass const * const & // reference of an unmodifiable pointer to an unmodifiable MyClass object 
```

这应该有助于确保您的返回类型不再毫无意义:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T16:23:10.940

const 限定符没有任何意义，因为您正在返回一个指针

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-27T05:54:56.167

为什么要返回一个常量值？考虑以下内容（请原谅缺乏想象力的变量名称）：

```
struct A { int a; };

A operator+(const A& a1, const A& a2) 
{
    A a3 = { a1.a + a2.a };
    return a3;
} 
```

鉴于 的声明`operator+`，我可以执行以下操作：

```
A a = {2}, b = {3}, c = {4}, d = ((a+b) = c); 
```

没错，我只是分配给了`A`由`operator+`. 的结果值为`d.a`4，而不是 5。更改返回类型`operator+`以`const A`阻止此赋值，从而导致表达式`(a+b) = c`生成编译器错误。

如果我尝试分配从函数返回的指针或整数，我的编译器 (MSVC) 会生成“左操作数必须是左值”错误，这似乎与 ARM 编译器告诉您指针的 constness 没有意义--无论如何都不能分配指针。但是对于类/结构，显然可以分配给非常量返回值。

# regex - Printing Certain Pages in MS Word

> ID：686476
> 
> 赞同：0
> 
> 时间：2009-03-26T16:20:46.560
> 
> 标签：regex, printing, ms-word

Using MS Word, is there a way to simply print only those pages which contain a certain search string. For example, I have a few hundred pages of transaction summaries and there is a certain string that reoccurs through out the transaction report. I can't throw a regular expression into the pages to print dialog or something?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T21:51:37.817

Use some VBA, which you can do entirely from within Word. Have a look at [this thread](http://www.tek-tips.com/viewthread.cfm?qid=1247406&page=1)

# enterprise - 大规模开发中最重要的基础设施组件是什么？

> ID：686480
> 
> 赞同：0
> 
> 时间：2009-03-26T16:21:53.347
> 
> 标签：enterprise, infrastructure

企业业务应用程序的基础构建块有哪些？我正在考虑多个应用程序共享的可重用组件：

1.  更快地扩大规模
2.  通过消除重建来加速开发
3.  通过最小化关键故障点提供稳定的基础架构

我在集中化/标准化方面看到的一些成功的概念示例：

*   日志记录
*   排队
*   调度

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T16:24:30.030

我会添加允许团队在应用程序中保持相同外观和感觉的 GUI 小部件。

同样，在一个大型项目中，多个团队必须在子系统上工作，这些子系统将在某个时候组合在一起，一组类似子系统的设计模式是非常宝贵的。

此外，创建一组通用库（或者在采用 Boost 的 C++ 中更好）是需要通用实用程序的地方，效果很好。

我也会在早期创建带有样本的测试框架。我发现如果你有一个用于测试子系统的模板，那么人们就会使用它。在早期没有任何测试框架的情况下，您一定会获得所有极端的开发人员测试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T17:21:35.667

当您说组件时，您是指代码组件还是基础架构组件？我认为基础设施（支持服务和流程），而不是代码，为质量、速度和易于开发带来了最大的好处。您提供的示例现在位于大多数语言的标准库中，或者非常特定于应用程序/用例。

我也只是假设版本控制是给定的，因为它对所有开发都是不可或缺的。

我想说*最*重要的基础设施是**持续构建/自动化测试**。这让人们可以编写他们想要的任何代码，将其签入，并确保它可以与其他所有人的代码一起使用。

第二个最重要的是**公共库**。这些让人们可以更快地开发并建立外观、感觉和设计的标准（希望是好的）。随着公共库的使用越来越多，持续构建的重要性增加，因为这些库的微小变化可能会导致回归。

但是，通用库的一个问题是，它们需要付出很多努力才能设计得很好——所以它们值得重用——而且需要很长时间才能达到这一点。大多数会从特定于一个项目开始，然后有人会将其破解到他们的项目中，然后进行一些分支，然后复制和粘贴。一段时间后，可能是几年后，有人会审核代码并开始将它们合并到一个共同的地方。应该为升级公共库以及如何（或是否）同时拥有它们的两个版本制定计划。另一个隐藏的缺点是它们在短期内允许更快的开发，但从长远来看会阻碍开发，因为人们会被锁定在旧版本中（第三方库更是如此）。

第三是**构建工具**。这意味着可以使用通用工具来简化构建、签出、搜索以及必须以任何方式与代码交互。当您提交补丁时自动将错误标记为已解决，或通知持续构建者依赖项已更改，或在您提交测试之前自动运行测试，使测试易于（且快速）运行。

第四是**密封构建**，它是构建工具的简单扩展。这意味着应用程序是自包含的。这有两个好处：1）机器重用更容易，更重要的是，2）开发人员上手非常容易 - 他们不需要安装额外的库，或更改 /etc 中的某些内容，或在他们的环境 - 它只是构建和运行。

其他一些我能想到的：

*   **监控**：如果一切都使用相同的监控方法，那么人们就不必黑盒监控公共库。由于所有数据都在一个地方，因此它还可以更轻松地识别问题。
*   **日志存储**：Grepping 和 groking 日志是一种痛苦。拥有一个所有日志以结构化格式存储的集中位置，可以轻松搜索和发现问题。
*   **分支管理**：在一个大型项目中，这让开发人员可以开发、测试人员测试和发布人员发布，而无需互相干预。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T16:26:34.957

不完全在基础设施领域：

*   定义的逻辑数据模型。
*   定义的业务流程（涵盖边缘案例）。

如果没有这些，您将拥有针对同一客户的一系列应用程序开发活动。

> *   日志记录
> *   排队
> *   调度

这些都应该是现成的，以适应使用它们的应用程序的需求。例如，J2EE 构建应用程序的日志记录解决方案将不同于 .NET 的。（在一个重要的企业中，单一文化本身就是一个问题。）

# php - 结合 cookie 和会话

> ID：686481
> 
> 赞同：3
> 
> 时间：2009-03-26T16:22:01.863
> 
> 标签：php, cookies, session

这个问题是我今天对 cookie 提出的各种问题的结果。

如您所知，使用 cookie 处理登录过程并不容易。

但是如何在我登录时设置 cookie 并在我重新启动浏览器时自动登录？

如果我根据 cookie 的存在进行重定向，这是很危险的，因为其他人可以创建一个 cookie。那么有什么办法来处理这个问题呢？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T16:24:53.743

是的，自动登录 cookie 确实存在漏洞，但您可以通过各种技术缓解其中一些漏洞，例如确保 cookie 值只能使用一次。

欲了解更多详情，请查看

*   [持久登录 Cookie 最佳实践](http://fishbowl.pastiche.org/2004/01/19/persistent_login_cookie_best_practice/)
*   [改进的持久登录 Cookie 最佳实践](http://jaspan.com/improved_persistent_login_cookie_best_practice)

并查看这些其他好的 StackOverflow 答案

*   [第一部分：如何登录](https://stackoverflow.com/questions/549/the-definitive-guide-to-website-authentication-beta/477578#477578)
*   [第二部分：如何保持登录状态——臭名昭著的“记住我”复选框](https://stackoverflow.com/questions/549/the-definitive-guide-to-website-authentication-beta/477579#477579)
*   [第三部分：使用秘密问题](https://stackoverflow.com/questions/549/the-definitive-guide-to-website-authentication-beta/477580#477580)
*   [第 IV 部分：忘记密码功能](https://stackoverflow.com/questions/549/the-definitive-guide-to-website-authentication-beta/477583#477583)
*   [第五部分：检查密码强度](https://stackoverflow.com/questions/549/the-definitive-guide-to-website-authentication-beta/477584#477584)
*   [第 VI 部分：更多 - 或：防止快速登录尝试](https://stackoverflow.com/questions/549/the-definitive-guide-to-website-authentication-beta/477585#477585)
*   [第七部分：分布式蛮力攻击](https://stackoverflow.com/questions/549/the-definitive-guide-to-website-authentication-beta/477586#477586)

# c# - C#：通过反射访问继承的私有实例成员

> ID：686482
> 
> 赞同：17
> 
> 时间：2009-03-26T16:22:29.850
> 
> 标签：c#, reflection

我是 C# 反射的绝对新手。我想使用反射来访问一个类中的所有私有字段，包括那些被继承的。

我已成功访问所有私有字段，不包括继承的字段，以及所有公共和受保护的继承字段。但是，我无法访问私有的继承字段。以下示例说明：

```
class A
{
    private string a;
    public string c;
    protected string d;
}

class B : A
{
    private string b;
}

class test
{
    public static void Main(string[] Args)
    {
        B b = new B();       
        Type t;
        t = b.GetType();
        FieldInfo[] fields = t.GetFields(BindingFlags.Public | BindingFlags.NonPublic
                                         | BindingFlags.Instance); 
        foreach(FieldInfo fi in fields){
             Console.WriteLine(fi.Name);
        }
        Console.ReadLine();
    }
} 
```

这找不到字段 Ba

甚至有可能做到这一点吗？显而易见的解决方案是将私有的、继承的字段转换为受保护的字段。然而，这目前是我无法控制的。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-26T16:47:51.737

正如李所说，你可以用递归来做到这一点。

```
private static void FindFields(ICollection<FieldInfo> fields, Type t) {
    var flags = BindingFlags.Public | BindingFlags.NonPublic | BindingFlags.Instance;

    foreach (var field in t.GetFields(flags)) {
        // Ignore inherited fields.
        if (field.DeclaringType == t)
            fields.Add(field);
    }

    var baseType = t.BaseType;
    if (baseType != null)
        FindFields(fields, baseType);
}

public static void Main() {
    var fields = new Collection<FieldInfo>();
    FindFields(fields, typeof(B));
    foreach (FieldInfo fi in fields)
        Console.WriteLine(fi.DeclaringType.Name + " - " + fi.Name);
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-26T16:32:47.907

没试过，不过应该可以通过Type.BaseType属性访问基类型私有成员，通过继承层次递归累加所有私有字段。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T16:25:43.757

您无法访问`A`使用类型的私有字段，`B`因为这些字段不存在于`B`- 它们仅存在于`A`. 您要么需要`A`直接指定 of 的类型，要么通过其他方式检索它（例如从 的类型中获取基类`B`）。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2010-06-24T04:31:26.353

您可以使用“嵌套类”从 B 类访问 A 类的私有成员。您将 A 类设为外部类，将 B 类设为内部类

```
Class A
{
 ...
 Class B
 {
.......
  }

} 
```

# c# - C# vs C - 巨大的性能差异

> ID：686483
> 
> 赞同：97
> 
> 时间：2009-03-26T16:22:40.487
> 
> 标签：c#, c, performance

我发现 C 和 C# 中类似代码之间存在巨大的性能差异。

C代码是：

```
#include <stdio.h>
#include <time.h>
#include <math.h>

main()
{
    int i;
    double root;

    clock_t start = clock();
    for (i = 0 ; i <= 100000000; i++){
        root = sqrt(i);
    }
    printf("Time elapsed: %f\n", ((double)clock() - start) / CLOCKS_PER_SEC);   

} 
```

C#（控制台应用程序）是：

```
using System;
using System.Collections.Generic;
using System.Text;

namespace ConsoleApplication2
{
    class Program
    {
        static void Main(string[] args)
        {
            DateTime startTime = DateTime.Now;
            double root;
            for (int i = 0; i <= 100000000; i++)
            {
                root = Math.Sqrt(i);
            }
            TimeSpan runTime = DateTime.Now - startTime;
            Console.WriteLine("Time elapsed: " + Convert.ToString(runTime.TotalMilliseconds/1000));
        }
    }
} 
```

使用上面的代码，C# 在 0.328125 秒（发布版）内完成，C 需要 11.14 秒运行。

正在使用 mingw 将 C 编译为 Windows 可执行文件。

我一直认为 C/C++ 更快或至少与 C#.net 相当。究竟是什么导致 C 代码运行速度慢了 30 倍以上？

编辑：看起来 C# 优化器正在删除根，因为它没有被使用。我将根分配更改为`root +=`并在最后打印出总数。我还使用 cl.exe 编译了 C，并将 /O2 标志设置为最大速度。

现在的结果是： C 为 3.75 秒 C# 为 2.61 秒

C 仍然需要更长的时间，但这是可以接受的。

* * *

## 回答 #1

> 赞同：171
> 
> 时间：2009-03-26T16:46:40.087

您必须比较调试版本。我刚刚编译了你的 C 代码，得到了

```
Time elapsed: 0.000000 
```

如果您不启用优化，那么您所做的任何基准测试都是毫无价值的。（如果你确实启用了优化，循环就会被优化掉。所以你的基准测试代码也有缺陷。你需要强制它运行循环，通常是通过总结结果或类似的，并在最后打印出来）

您所测量的似乎基本上是“哪个编译器插入了最多的调试开销”。事实证明答案是 C。但这并不能告诉我们哪个程序最快。因为当您想要速度时，您可以启用优化。

顺便说一句，如果您放弃任何语言比其他语言“更快”的概念，从长远来看，您将为自己省去很多麻烦。C# 没有比英语更快的速度。

C 语言中的某些东西即使在幼稚的非优化编译器中也是有效的，还有其他一些东西严重依赖编译器来优化所有内容。当然，C# 或任何其他语言也是如此。

执行速度由以下因素决定：

*   您正在运行的平台（操作系统、硬件、系统上运行的其他软件）
*   编译器
*   你的源代码

一个好的 C# 编译器会产生高效的代码。一个糟糕的 C 编译器会生成缓慢的代码。生成 C# 代码的 C 编译器如何，然后您可以通过 C# 编译器运行这些代码？那会跑多快？语言没有速度。你的代码可以。

* * *

## 回答 #2

> 赞同：122
> 
> 时间：2009-03-26T22:02:45.973

我会保持简短，它已经被标记为已回答。C# 具有定义良好的浮点模型的巨大优势。这恰好与 x86 和 x64 处理器上 FPU 和 SSE 指令集的本机操作模式相匹配。那里没有巧合。JITter 将 Math.Sqrt() 编译为一些内联指令。

本机 C/C++ 背负着多年的向后兼容性。/fp:precise、/fp:fast 和 /fp:strict 编译选项是最明显的。因此，它必须调用实现 sqrt() 的 CRT 函数并检查选定的浮点选项以调整结果。那很慢。

* * *

## 回答 #3

> 赞同：63
> 
> 时间：2009-03-26T16:26:19.903

由于您从不使用“root”，编译器可能已经删除了优化您的方法的调用。

您可以尝试将平方根值累加到累加器中，在方法结束时将其打印出来，然后看看发生了什么。

编辑：见下面[Jalf的回答](https://stackoverflow.com/questions/686483/c-vs-c-big-performance-difference/686617#686617)

* * *

## 回答 #4

> 赞同：61
> 
> 时间：2010-07-11T03:23:58.740

我是 C++ 和 C# 开发人员。从 .NET 框架的第一个 beta 版本开始，我就开发了 C# 应用程序，并且在开发 C++ 应用程序方面拥有 20 多年的经验。首先，C# 代码永远不会比 C++ 应用程序快，但我不会对托管代码、它如何工作、互操作层、内存管理内部、动态类型系统和垃圾收集器进行冗长的讨论。尽管如此，让我继续说这里列出的基准都产生了不正确的结果。

让我解释一下：我们需要考虑的第一件事是 C# (.NET Framework 4) 的 JIT 编译器。现在，JIT 使用各种优化算法为 CPU 生成本机代码（这往往比 Visual Studio 附带的默认 C++ 优化器更具侵略性），.NET JIT 编译器使用的指令集更接近实际 CPU在机器上，因此可以在机器代码中进行某些替换，以减少时钟周期并提高 CPU 流水线缓存中的命中率，并产生进一步的超线程优化，例如指令重新排序和与分支预测相关的改进。

这意味着除非您使用 RELEASE 构建（而不是 DEBUG 构建）的正确参数编译您的 C++ 应用程序，否则您的 C++ 应用程序可能比相应的基于 C# 或 .NET 的应用程序执行得更慢。在 C++ 应用程序上指定项目属性时，请确保启用“完全优化”和“喜欢快速代码”。如果您有 64 位机器，则必须指定生成 x64 作为目标平台，否则您的代码将通过转换子层 (WOW64) 执行，这将大大降低性能。

在编译器中执行正确优化后，C++ 应用程序获得 0.72 秒，C# 应用程序获得 1.16 秒（均在发布版本中）。由于 C# 应用程序非常基础，并且在堆栈上而不是堆上分配循环中使用的内存，因此它实际上比涉及对象、繁重计算和更大数据集的实际应用程序执行得更好。因此，提供的数据是偏向 C# 和 .NET 框架的乐观数据。即使存在这种偏差，C++ 应用程序的完成时间也仅比同等 C# 应用程序的一半多。请记住，我使用的 Microsoft C++ 编译器没有正确的管道和超线程优化（使用 WinDBG 查看汇编指令）。

现在，如果我们使用 Intel 编译器（顺便说一句，这是在 AMD/Intel 处理器上生成高性能应用程序的行业秘密），相同的代码对于 C++ 可执行文件的执行时间为 0.54 秒，而使用 Microsoft Visual Studio 2010 则为 0.72 秒. 所以最后，最终的结果是 C++ 为 0.54 秒，C# 为 1.16 秒。因此，.NET JIT 编译器生成的代码比 C++ 可执行文件花费的时间长 214%。在 0.54 秒内花费的大部分时间是从系统获取时间，而不是在循环本身！

统计数据中还缺少的是不包括在计时中的启动和清理时间。与 C++ 应用程序相比，C# 应用程序往往在启动和终止上花费更多时间。这背后的原因很复杂，与 .NET 运行时代码验证例程和内存管理子系统有关，该子系统在程序的开始（以及最终）执行大量工作以优化内存分配和垃圾集电极。

在测量 C++ 和 .NET IL 的性能时，查看汇编代码以确保所有计算都存在，这一点很重要。我发现，没有在 C# 中添加一些额外的代码，上面示例中的大部分代码实际上都从二进制文件中删除了。当您使用更积极的优化器（例如英特尔 C++ 编译器随附的优化器）时，C++ 也是如此。我在上面提供的结果是 100% 正确的，并且在组装级别得到了验证。

互联网上很多论坛的主要问题是，很多新手在不了解技术的情况下听微软的营销宣传，并谎称C#比C++快。声称在理论上，C# 比 C++ 更快，因为 JIT 编译器可以针对 CPU 优化代码。这个理论的问题在于 .NET 框架中存在很多降低性能的管道。C++ 应用程序中不存在的管道。此外，经验丰富的开发人员将知道用于给定平台的正确编译器，并在编译应用程序时使用适当的标志。在 Linux 或开源平台上，这不是问题，因为您可以分发源代码并创建使用适当优化编译代码的安装脚本。在 Windows 或闭源平台上，您将不得不分发多个可执行文件，每个可执行文件都有特定的优化。将部署的 Windows 二进制文件基于 msi 安装程序检测到的 CPU（使用自定义操作）。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-03-26T16:26:29.653

我的第一个猜测是编译器优化，因为你从不使用 root。您只需分配它，然后一次又一次地覆盖它。

编辑：该死的，快了 9 秒！

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-03-26T16:34:59.070

要查看循环是否被优化掉，请尝试将您的代码更改为

```
root += Math.Sqrt(i); 
```

在 C 代码中类似，然后在循环外打印 root 的值。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-03-26T16:26:42.227

也许 c# 编译器注意到你没有在任何地方使用 root，所以它只是跳过了整个 for 循环。:)

情况可能并非如此，但我怀疑无论原因是什么，它都取决于编译器实现。尝试使用带有优化和发布模式的 Microsoft 编译器（cl.exe，作为 win32 sdk 的一部分提供）编译您的 C 程序。我敢打赌，您会看到与其他编译器相比性能有所改进。

编辑：我认为编译器不能只优化 for 循环，因为它必须知道 Math.Sqrt() 没有任何副作用。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-03-26T16:54:55.247

无论时差。可能是，“经过的时间”是无效的。只有当您可以保证两个程序在完全相同的条件下运行时，它才是有效的。

也许你应该试试赢。相当于 $/usr/bin/time my_cprog;/usr/bin/time my_csprog

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-03-26T17:16:46.117

我在 C 和 C# 中（根据您的代码）组合了另外两个可比较的测试。这两个使用模数运算符编写了一个较小的数组进行索引（它增加了一点开销，但是，嘿，我们正在尝试比较性能[在粗略的水平上]）。

C代码：

```
#include <stdlib.h>
#include <stdio.h>
#include <time.h>
#include <math.h>

void main()
{
    int count = (int)1e8;
    int subcount = 1000;
    double* roots = (double*)malloc(sizeof(double) * subcount);
    clock_t start = clock();
    for (int i = 0 ; i < count; i++)
    {
        roots[i % subcount] = sqrt((double)i);
    }
    clock_t end = clock();
    double length = ((double)end - start) / CLOCKS_PER_SEC;
    printf("Time elapsed: %f\n", length);
} 
```

在 C# 中：

```
using System;

namespace CsPerfTest
{
    class Program
    {
        static void Main(string[] args)
        {
            int count = (int)1e8;
            int subcount = 1000;
            double[] roots = new double[subcount];
            DateTime startTime = DateTime.Now;
            for (int i = 0; i < count; i++)
            {
                roots[i % subcount] = Math.Sqrt(i);
            }
            TimeSpan runTime = DateTime.Now - startTime;
            Console.WriteLine("Time elapsed: " + Convert.ToString(runTime.TotalMilliseconds / 1000));
        }
    }
} 
```

这些测试将数据写入数组（因此不应允许 .NET 运行时剔除 sqrt 操作），尽管数组要小得多（不想使用过多的内存）。我在发布配置中编译了这些并从控制台窗口内运行它们（而不是通过 VS 启动）。

在我的计算机上，C# 程序在 6.2 和 6.9 秒之间变化，而 C 版本在 6.9 和 7.1 之间变化。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-03-26T19:46:09.377

如果您只是在汇编级别单步执行代码，包括逐步执行平方根例程，您可能会得到问题的答案。

无需有根据的猜测。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-03-26T16:33:46.950

此处可能存在问题的另一个因素是 C 编译器编译为您所针对的处理器系列的通用本机代码，而当您编译 C# 代码时生成的 MSIL 然后被 JIT 编译以针对您已经完成的确切处理器可能的优化。因此，从 C# 生成的本机代码可能比 C 快得多。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-03-26T16:30:14.107

在我看来，这与语言本身无关，而是与平方根函数的不同实现有关。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-03-26T16:38:35.880

实际上，伙计们，循环并没有被优化掉。我编译了 John 的代码并检查了生成的 .exe。循环的内容如下：

```
 IL_0005:  stloc.0
 IL_0006:  ldc.i4.0
 IL_0007:  stloc.1
 IL_0008:  br.s       IL_0016
 IL_000a:  ldloc.1
 IL_000b:  conv.r8
 IL_000c:  call       float64 [mscorlib]System.Math::Sqrt(float64)
 IL_0011:  pop
 IL_0012:  ldloc.1
 IL_0013:  ldc.i4.1
 IL_0014:  add
 IL_0015:  stloc.1
 IL_0016:  ldloc.1
 IL_0017:  ldc.i4     0x5f5e100
 IL_001c:  ble.s      IL_000a 
```

除非运行时足够聪明，可以意识到循环什么都不做并跳过它？

编辑：将 C# 更改为：

```
 static void Main(string[] args)
 {
      DateTime startTime = DateTime.Now;
      double root = 0.0;
      for (int i = 0; i <= 100000000; i++)
      {
           root += Math.Sqrt(i);
      }
      System.Console.WriteLine(root);
      TimeSpan runTime = DateTime.Now - startTime;
      Console.WriteLine("Time elapsed: " +
          Convert.ToString(runTime.TotalMilliseconds / 1000));
 } 
```

结果经过的时间（在我的机器上）从 0.047 变为 2.17。但这仅仅是添加 1 亿个加法运算符的开销吗？

# vb.net - VB.Net：测试多个值是否相等？

> ID：686485
> 
> 赞同：4
> 
> 时间：2009-03-26T16:22:43.390
> 
> 标签：vb.net, if-statement, equality

如何在一行中测试多个值是否相等？基本上我想做

```
if (val1 == val2 == val3 == ... valN) 
```

但在 VB.Net 中。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-26T16:26:12.570

```
If val1 = valN AndAlso val2 = valN AndAlso ... Then
End If 
```

当测试多个值时，这可能会变得很麻烦。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T16:26:22.477

没有办法像那样将它们链接在一起。您需要将其分解为由 AndAlso 链接的成对比较

```
if val1 = val2 AndAlso val2 = val3 AndAlso val1 = val3 Then 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-02T07:08:04.367

如果你有很多值要测试并且经常这样做，你可以给你写一个这样的助手：

```
Public Function AllTheSame(ByVal ParamArray values() As Object) As Boolean
    For index As Integer = 1 To values.Length - 1
        If values(0) <> values(index) Then Return False
    Next
    Return True
End Function

<Fact()> Public Sub testAllTheSame()
    Assert.True(AllTheSame("Test"))
    Assert.True(AllTheSame("Test", "Test"))
    Assert.True(AllTheSame("Test", "Test", "Test"))

    Assert.True(AllTheSame(1234))
    Assert.True(AllTheSame(1234, 1234, 1234))

    Assert.False(AllTheSame("Test", "Test2"))
    Assert.False(AllTheSame("Test", "Test", "Test3"))

    Assert.False(AllTheSame(1234, 1234, 987))
End Sub 
```

# python - 没有 Web 框架（Django/Rails）的 Flex + Python/Ruby 有什么用吗？

> ID：686490
> 
> 赞同：2
> 
> 时间：2009-03-26T16:23:17.600
> 
> 标签：python, ruby-on-rails, ruby, django, apache-flex

我经常听说 Flex 与后端的 Web 框架相结合。这个想法是 Flex 充当表示框架，而 Web 框架 (Django/Rails) 进行数据库查找并将数据发送到 Flex 以以 XML 的形式呈现。

但是，是否有过在没有 Web 框架作为中介的情况下将 Flex 和 Python/Ruby 结合起来的情况？在什么情况下这样的组合才有意义（如果有的话）？

（我正在尝试考虑脚本语言的功能将与 Flex 的功能互补的项目 - 以及是否有可能将两者结合起来而没有太多的麻烦）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T16:34:15.187

您仍然可以直接在 Python 中针对 WSGI 进行编码。如果那是你想走的路线，[PEP 333](http://www.python.org/dev/peps/pep-0333/)是唯一的出路。

话虽如此，这样做是一种很好的学习体验，但 WSGI 并不是真正打算直接使用的。如果你不想，你不必使用像 Django 这样的全栈框架。如果您想要更轻量级的东西，我可以建议[CherryPy](http://www.cherrypy.org/)或[web.py](http://webpy.org/)吗？它们比 Django 轻得多。

除了 WSGI 之外，还有其他选择，但它们几乎都有相同的警告。换句话说，它可以做到，但通常不推荐。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-27T06:47:12.237

Flash 播放器允许开发人员打开远程应用程序的套接字。您可以创建一个连接到远程服务器并传输二进制或序列化数据的 Flex 应用程序是可行的。这具有支持异步通信的额外好处，因此这样的事情对于多人游戏或聊天客户端可能是实用的。

Adobe 为此开发了一个名为 Flash Media Server 的应用程序（除非名称已更改）。

还有一个名为 Red5 的开源项目，具有类似的功能集。

最后，有几个库可以在语言之间实现闪存对象的序列化和传输。一些例子是 AMFPHP [http://www.amfphp.org/](http://www.amfphp.org/)和更高级的 Flex 数据服务[http://www.onflex.org/ted/2006/05/flex-data-services-part-1.php](http://www.onflex.org/ted/2006/05/flex-data-services-part-1.php) .

# apache-flex - Flex 3 排序对象字段

> ID：686500
> 
> 赞同：1
> 
> 时间：2009-03-26T16:24:54.570
> 
> 标签：apache-flex, sorting, object, field

**我在ActionScript3**代码中有一个对象，我需要对其进行排序。

我遍历对象并打印出每个值：

```
for (var i:String in columnData) { 
```

但是，我需要按字母顺序对正在迭代的数据进行排序。关于如何做到这一点的任何建议？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T16:36:02.377

您只能对数组/列表进行排序，而不能对对象中的字段进行排序。

如果您想要排序顺序，您首先需要遍历对象并将值推送到数组/列表中，*然后*对其进行排序。

**[编辑]：**好的，所以我假设您只需要数据。不，flex 不提供哈希图（如 TreeMap ala Java）。您可以做的是将名称值对作为对象存储在数组中。Array 提供了一种`SortOn()`方法让您对特定字段进行排序。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T18:46:28.647

[ActionScript Foundry](http://www.servebox.org/actionscript-foundry/actionscript-foundry-documentation/the-collections-framework/)有一些 Java 集合的AS 实现——看起来你可以在那里找到你需要的东西。

# c# - 更改为不同的 StreamWriter 构造函数导致输出错误

> ID：686502
> 
> 赞同：0
> 
> 时间：2009-03-26T16:25:15.130
> 
> 标签：c#, .net

我有这个代码

```
StreamWriter sw = new StreamWriter(this.FileName, true);
sw.WriteLine(text);
sw.Close(); 
```

我改成这个（因为争用问题）：

```
StreamWriter sw = new StreamWriter(
          new FileStream(this.FileName, FileMode.OpenOrCreate
               , FileAccess.ReadWrite, FileShare.Write)
          , Encoding.ASCII); 
sw.WriteLine(strLog);
sw.Close(); 
```

问题是第一个工作正常，输出了人类可读的正确文本（这是用于日志文本文件）。无论我使用哪种编码类型，第二个输出完全是螺旋式的输出。我试过 ASCII、UTF7、8、Unicode 和 Default。很明显，我缺少关于 FileStream 或 TextWriter 的一些基本内容。请教育我。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T16:37:52.387

我已经尝试过您的代码，但无法重现任何奇怪的行为。

一些想法：

*   您不会刷新 StreamWriter 或 FileStream。
*   您不会在 StreamWriter 和 FileStream 上调用 Dispose。尝试将这些包装在 using 语句中。
*   Ascii 编码是邪恶的。我认为这只是一个测试步骤。
*   FileMode.OpenOrCreate 将...打开或创建文件。它将打开一个已经存在的文件并覆盖第一个字节。您想使用 FileMode.Create 创建一个新文件，还是覆盖现有文件？

编辑：

根据对这篇文章的评论，该问题的解决方案是使用 FileMode.Append。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T16:45:42.773

只是为了检查显而易见的，你有：

```
sw.WriteLine(text); 
```

在第一个例子中

```
sw.WriteLine(strLog); 
```

在第二。没有看到你所有的代码，我不知道以下问题的答案，所以我不得不问：

*test 和 strLog 在您的源代码中是不同的东西，还是只是一个错字？*

# algorithm - 我如何在没有递归的情况下解决这个问题？

> ID：686505
> 
> 赞同：4
> 
> 时间：2009-03-26T16:25:27.033
> 
> 标签：algorithm, recursion

我正试图帮助我儿子解决一道数学题。这似乎是让他接触一些编程的好机会。我可以看到递归解决方案，但也许迭代解决方案更容易解释。到目前为止，他所学的语言是[SmallBasic](http://msdn.microsoft.com/en-us/devlabs/cc950524.aspx)，它不能很好地支持递归（没有局部变量）。我并不反对教授另一种语言，但仍然想了解是否有一种无需递归即可解决此问题的好方法。

问题是这样的：给定数字序列 1 2 3 4 5 6 7 8 9，在数字之间插入 + 和 - 使得结果加起来为 101。例如，1+23+4+5+ 67-8+9=101。

递归解决方案如下所示：

```
next(total, number, nextNumber, sequenceString)
{
    //add
    next(total + number, ...);

    //subtract
    next(total - number, ...);

    //do nothing (multiply)
    next(total, number * 10, ...);
} 
```

是否有一个不是非常复杂的迭代解决方案？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-26T16:51:46.097

考虑数字 1 2 3 4 5 6 7 8 9 之间的空格。有 8 个这样的间隙空间或插槽。

每个这样的空格都可以用 +、- 或任何内容填充（表示正在形成更长的数字）。

这是八个插槽中的每个插槽中的三种可能性。将数字分配给三个可能的填充符：

```
 0 --> +
 1 --> -
 2 --> (nothing) 
```

现在每个 8 位三进制字符串对应一个解。举些例子：

```
 00000000 --> 1+2+3+4+5+6+7+8+9
 00000001 --> 1+2+3+4+5+6+7+8-9
 00000002 --> 1+2+3+4+5+6+7+89
 22222222 --> 123456789 
```

现在编写一个简单的循环，从 00000000 到 22222222 三进制数。将沿途的每个数字解释为上述解决方案，一旦达到产生目标 101 的解决方案就停止，或者如果您到达终点但未达到目标值，则报告失败。

有 3^8（指数，不是异或，或 3**8 用于 fortranoids，或

```
 3*3*3*3*3*3*3*3 
```

对于强烈的字面意思）可能的解决方案。那只有6561；你可以很方便地用这种方式暴力破解它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-26T16:28:01.567

递归是计算机科学中的一个重要点。如果您这样做的目的是教您的儿子，为什么不立即向他解释递归？;)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T16:50:59.437

您有 3 个基本操作：

*   添加（选项“0”）；
*   减法（选项“1”）；
*   什么都不做（选项“2”）；

所以基本上你有 3^8 种可能的解决方案；试一试。

这是 PHP 代码，但包括转换其他基数的数字，这是一个 8 岁男孩可能不会很快理解的东西。也许你可以找到这个转折点：

```
<?php

$limit = pow(3, 8);
for($op = 0; $op < $limit; $op++){
  // Get this operation.
  $op_base3 = base_convert($op, 10, 3);

  // Fill leading 0's.
  $op_base3 = str_pad($op_base3, 8, "0", STR_PAD_LEFT);

  // Here you get something like 00212120, which would say:
  // 1[+]2[+]3[nothing]4[-]5[nothing]6[-]7[nothing]8[+]9
  // That's: 1+2+34-56-78+9

  // Compute and if result's correct, output solution.
}

?> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T16:29:36.557

当然可以通过简单的迭代来解决。您只需要将字符串转换为堆栈。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T16:29:06.323

鉴于递归深度有限，数组可以用作堆栈。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-26T16:30:40.797

它可以迭代地完成，但并不像这样简单。更重要的是，您是否打算以此为契机向您的儿子教授算法复杂性？

# stl - “自制”STL 性能？

> ID：686510
> 
> 赞同：4
> 
> 时间：2009-03-26T16:25:50.730
> 
> 标签：stl

[http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2007/n2271.html](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2007/n2271.html)

根据那篇文章，STL 不适合游戏开发。您对此有何看法？

我目前的方法是：使用 STL，如果导致与自制容器（或分配器）交换的性能问题（还没有来，但我不是在做高端 3d 游戏；））

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-26T16:29:08.617

在这种情况下，您的方法是唯一明智的选择。优化规则#1 是“除非您确切知道瓶颈在哪里，否则不要优化”。

以后您应该仍然能够相对轻松地交换您的容器，特别是如果您使用通过 typedef 定义的类型而不是直接使用 STL 容器。我的意思是：

```
#include <vector>

typedef std::vector<int> MyIntVectorType;

int main()
{
   MyIntVectorType theVector; 
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-26T16:30:01.127

您必须了解 STL 在幕后所做的事情。例如，如果您使用向量，例如，不要让它任意增长，请使用 vector::resize() 预先进行分配，以便它只分配一次。类似的东西。你的方法还不错——做你的功课。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T21:45:31.413

If you are just starting with game programming, go on and use STL, it's great and it's stable. You are better off with something that works and is stable than to start scratching for a fps or two. However, here are the two reasons why many major studio don't use it.

*   At some point, you'll want to push your system to the limit. If your engine is very large, optimizing container is a good way to gain everywhere (graphic, audio, physics, etc.). Optimizing with assembly, having different implementations of a container for different use will become a must. Templates aren't the leanest implementation ever.
*   STL have a different implementation on different plateforms (PS2, PS3, Wii, 360, PC etc.). If you are working crossplatform, sometimes those differences will create problems at the very root of your system, in the supposed "all-plateform code". When this happened to you once, you will want to move to something that you will be able to maintain in an easier way.

Having a custom version of container isn't a trivial job, do it only if it's worth it.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T16:29:37.070

使用 STL，如果它在可接受的性能范围内工作，请保留它。如果没有，请尝试其他方法。在尝试现有实现之前，您不想重写已经存在的东西。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-26T16:33:29.667

C++ 中许多与执行相关的问题已在[C++0x](http://en.wikipedia.org/wiki/C%2B%2B0x#Core_language_runtime_performance_enhancements)中得到修复。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-26T16:35:38.927

您可能想查看专门为游戏设计的[EASTL 之类的东西。](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2007/n2271.html)

编辑：抱歉，我认为问题中的链接是另一篇文章。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-26T16:49:37.757

有时需要替换的不是容器，而是包含的对象。我曾经有一个大的 std::map ，它有一个字符串作为键，它太慢了。我意识到我所有的键大小都一样，所以我用一个专门的版本替换了字符串类，我写的这个版本是一个固定大小的字符缓冲区的包装器，性能不再是问题。

知道你的瓶颈在哪里，不要假设你可以编写任何东西的更快版本，除非你可以做出巨大的简化假设。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-26T17:02:57.957

您还可以将 STL 容器中的分配器换成自定义的。

# javascript - 参考父窗口文档

> ID：686511
> 
> 赞同：5
> 
> 时间：2009-03-26T16:25:55.583
> 
> 标签：javascript, jquery, dom

我正在尝试从弹出窗口访问父窗口文档。

```
<script type='text/javascript'>
    $(document).ready(function(){
        var summary = window.parent.document.getElementById('summary');
        var content = summary.innerHTML;
    });
</script> 
```

甚至可能吗？有没有 jQuery 特定的方法来做到这一点？

谢谢

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-26T16:29:52.390

你不想`window.opener`（`window.parent`那是框架）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-01-28T07:10:15.070

您可以使用上下文来访问它：

```
<script type="text/javascript">
    $(document).ready(function(){
        var content = $("#summary",window.opener.document).html();
    });
</script> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T16:29:57.257

如果您使用 window.open(...) 打开了窗口，请查看[window.opener](https://developer.mozilla.org/en/DOM/window.opener)

# path - 在 Silverlight 2 中动态确定路径

> ID：686529
> 
> 赞同：1
> 
> 时间：2009-03-26T16:28:54.920
> 
> 标签：path, silverlight-2.0, clipping, pathgeometry

我在画布内有一个带圆角的边框，并希望在画布上添加一个剪切区域，以便我添加的任何内容都被剪切到边框内的区域。我知道我可以设置画布的 Clip 属性，但是由于画布和对象的大小是动态的，而不是在 XAML 中分配大小，我不知道如何计算要使用的路径。有什么方法可以从 UIElement （在这种情况下为边框）派生 PathGeometry 吗？如果不是，解决此问题的最佳方法是什么？这是我正在使用的测试页面的 XAML。

```
<UserControl x:Class="TimelinePrototype.Page"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
<Grid x:Name="LayoutRoot">
    <Grid.RowDefinitions>
        <RowDefinition Height="auto" />
        <RowDefinition />
    </Grid.RowDefinitions>
    <StackPanel Orientation="Horizontal" Margin="10">
        <Button x:Name="cmdDraw" FontSize="18" Click="cmdDraw_Click" Content="Draw" Margin="0,0,5,0" VerticalAlignment="Bottom" />
        <TextBlock x:Name="txtDateRange" FontSize="18" Margin="10,0,10,10" VerticalAlignment="Bottom" />
    </StackPanel>
    <Canvas x:Name="TimelineCanvas" Grid.Row="1" HorizontalAlignment="Stretch" 
                SizeChanged="TimelineCanvas_SizeChanged">
        <Border x:Name="TimelineBorder" 
                Background="LightGray" 
                BorderBrush="Black" 
                BorderThickness="2" 
                CornerRadius="15" 
                Margin="10"
                Grid.Row="1"
                VerticalAlignment="Top">
        </Border>
    </Canvas>
</Grid> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T16:34:49.117

尝试使用[ActualHeight](http://msdn.microsoft.com/en-us/library/system.windows.frameworkelement.actualheight.aspx)和[ActualWidth](http://msdn.microsoft.com/en-us/library/system.windows.frameworkelement.actualwidth.aspx)属性

```
var height = TimelineCanvas.ActualHeight;
var width = TimelineCanvas.ActualWidth; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T17:05:57.437

我最终使用了这段代码，但仍然对任何替代方法感兴趣。

```
RectangleGeometry clipRect = new RectangleGeometry();
clipRect.Rect = new Rect(TimelineBorder.Margin.Left, TimelineBorder.Margin.Top, TimelineCanvas.ActualWidth - (TimelineBorder.Margin.Left + TimelineBorder.Margin.Right), TimelineCanvas.ActualHeight - (TimelineBorder.Margin.Top + TimelineBorder.Margin.Bottom));
clipRect.RadiusX = TimelineBorder.CornerRadius.TopLeft;
clipRect.RadiusY = TimelineBorder.CornerRadius.TopLeft;
TimelineCanvas.Clip = clipRect; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T13:56:39.247

试试[黑光灯](http://www.codeplex.com/blacklight)

blacklight 工具包有一个圆角剪裁工具，并且是免费的。

# c# - 为什么不能更改 List 结构中的状态？

> ID：686532
> 
> 赞同：0
> 
> 时间：2009-03-26T16:29:21.017
> 
> 标签：c#

我知道这听起来很愚蠢。但我一定是在这里做错了。

说，

```
struct lala
{
    private bool state1;

    public lala(bool state1)
    {
        this.state1 = state1;
    }

    public void SetState1ToTrue()
    {
        this.state1 = true;
    }

    public bool GetState1()
    {
        return this.state1;
    }
} 
```

然后某处...

```
List<lala> lalas = new List<lala>();

lalas.Add(new lala(false));
lalas.Add(new lala(false));

lalas[0].SetState1ToTrue();

// Why is it False???
Console.WriteLine(lalas[0].GetState1()); 
```

除了将其更改为：

```
List<lala> lalas = new List<lala>();

lalas.Add(new lala(false));
lalas.Add(new lala(false));

lala newLala = lalas[0];
newLala.SetState1ToTrue();
lalas[0] = newLala;

// It's True, finally.
Console.WriteLine(lalas[0].GetState1()); 
```

这看起来很糟糕，不优雅并且浪费了 2 行代码。如果在说 1 行代码中有任何 Linq 式或函数式编程方式，那就太棒了。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-26T16:39:05.800

问题出在这一行：

```
lalas[0].SetState1ToTrue(); 
```

第一部分 lalas[0] 从列表中检索第一个 lala，并将其作为隐式变量中的新副本。因此，您的 SetState1ToTrue 对 lala 进行操作，然后立即丢弃该 lala，并且列表中的那个保持不变。这和这样做是一样的：

```
lala newLala = lalas[0];
newLala.SetState1ToTrue(); 
```

如果将 lala 设为类而不是结构，使其成为引用类型，则临时变量（显式或隐式）是对列表中 lala 的引用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T16:39:08.343

结构是值类型，因此它们是按值传递的。这意味着 lalas[0] 为您提供 lalas 中结构的副本。您正在更改副本，因此原件未更改。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T16:35:56.680

你的问题是你正在处理一个结构，它是一个值类型，而不是一个类，它是一个引用类型。您期望的行为是引用类型的行为。我建议将您的声明更改为一个类（仅给出简单的示例），您应该没有问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T17:17:10.623

因为`struct`始终是值类型，所以它本质上是不可变的。这意味着不要这样做：

```
lalas[0].SetState1ToTrue(); 
```

你应该做：

```
lalas[0] = lalas[0].SetState1ToTrue(); 
```

[Jon Skeet](http://www.yoda.arachsys.com/csharp/parameters.html)有一篇优秀的文章详细解释了值类型和引用类型之间的区别。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T17:40:38.383

如果不将其更改为类（这可能是正确的答案），您要求的 Linq-ish 方法将使结构不可变，因此“状态更改”方法将返回修改后的版本。这样，你就不会用错了。

```
struct lala
{
    private readonly bool state1; // note: readonly

    public lala(bool state1)
    {
        this.state1 = state1;
    }

    public lala SetState1ToTrue()
    {
        return new lala(true); // would copy any other fields, unchanged
    }

    public bool GetState1()
    {
        return this.state1;
    }
} 
```

然后你可以一次“改变”整个列表：

```
List<lala> changed = original.Select(l => l.SetState1ToTrue()).ToList(); 
```

虽然您确实创建了一个全新的列表 - 但这是适合您的结构。

# php - 使用 PHP 发送多部分/替代电子邮件的问题

> ID：686539
> 
> 赞同：8
> 
> 时间：2009-03-26T16:30:19.487
> 
> 标签：php, email

这是构建/发送电子邮件的脚本：

```
$boundary = md5(date('U'));

$to = $email;
$subject = "My Subject";

$headers = "From: myaddress@mydomain.com" . "\r\n".
           "X-Mailer: PHP/".phpversion() ."\r\n".
           "MIME-Version: 1.0" . "\r\n".
           "Content-Type: multipart/alternative; boundary=--$boundary". "\r\n".
           "Content-Transfer-Encoding: 7bit". "\r\n";

$text = "You really ought remember the birthdays";     
$html = '<html>
    <head>
      <title>Birthday Reminders for August</title>
    </head>
    <body>
      <p>Here are the birthdays upcoming in August!</p>
      <table>
        <tr>
          <th>Person</th><th>Day</th><th>Month</th><th>Year</th>
        </tr>
        <tr>
          <td>Joe</td><td>3rd</td><td>August</td><td>1970</td>
        </tr>
        <tr>
          <td>Sally</td><td>17th</td><td>August</td><td>1973</td>
        </tr>
      </table>
    </body>
    </html>
    ';

$message = "Multipart Message coming up" . "\r\n\r\n".
       "--".$boundary.
       "Content-Type: text/plain; charset=\"iso-8859-1\"" .
       "Content-Transfer-Encoding: 7bit".
       $text. 
       "--".$boundary. 
       "Content-Type: text/html; charset=\"iso-8859-1\"". 
       "Content-Transfer-Encoding: 7bit". 
       $html.
       "--".$boundary."--";

mail("toAddress@example.com", $subject, $message, $headers); 
```

它可以很好地发送消息，而我的收件人会收到它，但是他们以文本/纯文本而不是多部分/替代形式获取整个内容。查看收到的消息的来源给出了这个（删除了很​​多杂乱无章的东西）：

```
Delivered-To: myrecipient@example.com
Received: by 10.90.100.4 with SMTP id x4cs111413agb;
    Wed, 25 Mar 2009 16:39:32 -0700 (PDT)
Received: by 10.100.153.6 with SMTP id a6mr85081ane.123.1238024372342;
    Wed, 25 Mar 2009 16:39:32 -0700 (PDT)
Return-Path: <xxx@xxxx.com>
--- snip ---
Date: Wed, 25 Mar 2009 17:37:36 -0600 (MDT)
Message-Id: <200903252337.n2PNbaw2019541@www.xxxxxxx.com>
To: trevor@saturdayplace.com
Subject: My Subject
From: me@mydomain.com
X-Mailer: PHP/4.3.9
MIME-Version: 1.0
Content-Type: text/plain;
boundary="--66131caf569f63b24f43d529d8973560"
Content-Transfer-Encoding: 7bit
X-OriginalArrivalTime: 25 Mar 2009 23:38:30.0531 (UTC) FILETIME=[CDC4E530:01C9ADA2]
X-TM-AS-Product-Ver: SMEX-8.0.0.1181-5.600.1016-16540.005
X-TM-AS-Result: No--4.921300-8.000000-31
X-TM-AS-User-Approved-Sender: No
X-TM-AS-User-Blocked-Sender: No

Multipart Message coming up

--66131caf569f63b24f43d529d8973560
Content-Type: text/plain; charset="iso-8859-1"
Content-Transfer-Encoding: 7bit

You really ought remember the birthdays

--66131caf569f63b24f43d529d8973560
Content-Type: text/html; charset="iso-8859-1"
Content-Transfer-Encoding: 7bit

<html>
    <head>
      <title>Birthday Reminders for August</title>
    </head>
    <body>
      <p>Here are the birthdays upcoming in August!</p>
      <table>
        <tr>
          <th>Person</th><th>Day</th><th>Month</th><th>Year</th>
        </tr>
        <tr>
          <td>Joe</td><td>3rd</td><td>August</td><td>1970</td>
        </tr>
        <tr>
          <td>Sally</td><td>17th</td><td>August</td><td>1973</td>
        </tr>
      </table>
    </body>
    </html>

--66131caf569f63b24f43d529d8973560-- 
```

看起来内容类型标题正在从多部分/替代到文本/纯文本的过程中发生变化。我不是系统管理员，所以如果这是一个 sendmail 问题，我就无法理解了。有什么建议么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-26T16:36:39.847

线

```
"Content-Type: multipart/alternative; boundary=--$boundary". "\r\n". 
```

应该

```
"Content-Type: multipart/alternative; boundary=$boundary". "\r\n". 
```

您没有在标题中包含破折号。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-06-26T13:21:45.287

为了让它对我正常工作，我还需要在每个标题行的末尾添加一个“\r\n”，其中两个（“\r\n\r\n”）在行尾在文本和 html 正文之前，每个正文的末尾都有一个。这会导致这样的结果：

```
$message = "Multipart Message coming up" . "\r\n\r\n".
       "--".$boundary."\r\n".
       "Content-Type: text/plain; charset=\"iso-8859-1\""."\r\n".
       "Content-Transfer-Encoding: 7bit"."\r\n".
       $text."\r\n". 
       "--".$boundary."\r\n". 
       "Content-Type: text/html; charset=\"iso-8859-1\""."\r\n". 
       "Content-Transfer-Encoding: 7bit"."\r\n".
       $html."\r\n".
       "--".$boundary."--"; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-03-26T10:37:59.177

使用“\n”而不是“\r\n”看起来qmail有“\r”的问题

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T20:22:14.593

[只是一个想法，但简单地使用phpmailer](http://sourceforge.net/projects/phpmailer)或[Zend_Mail](http://framework.zend.com/manual/en/zend.mail.html)之类的东西可能会更容易。

# asp.net - 有什么方法可以使用 AutoGenerateColumns = true 来操作 GridView 中的列？

> ID：686544
> 
> 赞同：7
> 
> 时间：2009-03-26T16:30:51.187
> 
> 标签：asp.net, gridview

如果 AutoGenerateColumns = true，似乎无法操作 Gridview 的列。这是我的场景：

我有一个通用的 GridView，它根据用户的选择显示各种不同 LINQ 查询的结果。我喜欢 AutoGenerateColumns 像它应该的那样工作的事实，我不必指定所有的 BoundField、TemplateField 列等......

最重要的是，我还根据需要以编程方式添加其他列。以编程方式添加的列呈现在自动生成列的左侧。如果我想把它们移到右边怎么办？

GridView.Columns.Count 只计算那些编程的，而不是自动生成的，所以我不能重新排列我想要的列。我可以挂钩 RowDataBound 事件并在必要时“隐藏”某些内容，但我无法重新排列。

我是否只需要放弃 AutoGeneratedColumns=true，并为每个查询使用 BoundFields 布置它们？有什么我可以做的吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T16:47:33.267

你可以像这样操作数据绑定的东西：

```
Private Sub MyGrid_RowDataBound(ByVal sender As Object, ByVal e As System.Web.UI.WebControls.GridViewRowEventArgs) Handles Me.RowDataBound
  If Me.AutoGenerateColumns = True Then
    If e.Row.RowType = DataControlRowType.DataRow Then
          e.row.cells.add(some code here to add your special column)
    End If
    End If
End Sub 
```

您必须创建自己的标题，但这是非常可行的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T16:46:20.010

我不认为可以控制自动生成的列，至少使用当前的 GridView 是不可能的。

通过创建一个从 GridView 继承的新控件，您可能对创建列的方式有更多的控制，但我不确定它是否可行（可能仍然值得研究）

从 MSDN 文档：

> 当 AutoGenerateColumns 属性设置为 true 时，会为数据源中的每个字段自动创建一个 AutoGeneratedField 对象。然后，每个字段在 GridView 控件中显示为一列，按照字段在数据源中出现的顺序。此选项提供了一种方便的方式来显示数据源中的每个字段；但是，您对自动生成的列字段的显示或行为方式的控制有限。
> 
> 自动生成的绑定列字段不会添加到 Columns 集合中。
> 
> 您可以通过将 AutoGenerateColumns 属性设置为 false 然后创建自定义 Columns 集合来手动定义列字段，而不是让 GridView 控件自动生成列字段。除了绑定的列字段，您还可以根据自己的自定义模板显示按钮列字段、复选框列字段、命令字段、超链接列字段、图像字段或列字段。有关详细信息，请参阅列。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-07T18:37:34.760

布伦丹的回答让我想起了我有这个躺在身边.. 适合格式化。

**网格视图**...

```
<asp:GridView .... OnRowDataBound="myGridView_RowDataBound"> 
```

**代码背后**...

```
Sub myGridView_RowDataBound(ByVal sender As Object, ByVal e As GridViewRowEventArgs)
    If e.Row.RowType = DataControlRowType.DataRow Then
      ' Display the data in italics.
      e.Row.Cells(1).Text = "<i>" & e.Row.Cells(1).Text & "</i>"
    End If
End Sub 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-08-10T09:43:51.987

如果有人仍然需要答案：只需使用来自**RowDataBound的****e.Row.Cells.Count**。

 *** * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-07-29T00:36:04.200

在接受的答案的基础上，可以创建一个字典来从列名映射到 RowDataBound 事件中的列索引，以允许使用标题名称。还显示了列交换。

```
Dictionary<string, int> _columnIndiciesForAbcGridView = null;

protected void detailsReportGridView_RowDataBound(object sender, GridViewRowEventArgs e)
{
    if (_columnIndiciesForAbcGridView == null)
    {
        int index = 0;
        _columnIndiciesForAbcGridView = ((Table)((GridView)sender).Controls[0]).Rows[0].Cells
            .Cast<TableCell>()
            .ToDictionary(c => c.Text, c => index++);
    }

    // Add a column, this shifts the _columnIndiciesForAbcGridView though.

    TableCell cell = new TableCell();
    cell.Text = "new Column";
    e.Row.Cells.AddAt(2, cell);

    // Swap 0 and 1

    int c0 = _columnIndiciesForAbcGridView["ConfigId"];
    int c1 = _columnIndiciesForAbcGridView["CreatedUtc"];

    string text = e.Row.Cells[c0].Text;
    e.Row.Cells[c0].Text = e.Row.Cells[c1].Text;
    e.Row.Cells[c1].Text = text;
} 
```

# java - 为什么 javac 1.5 与 Eclipse 编译器相比运行如此缓慢？

> ID：686545
> 
> 赞同：8
> 
> 时间：2009-03-26T16:32:06.223
> 
> 标签：java, eclipse, maven-2, javac

我有一个 Java Maven 项目，其中包含大约 800 个源文件（一些由 javacc/JTB 生成），使用 javac 编译需要 25 分钟。

当我将 pom.xml 更改为使用 Eclipse 编译器时，编译大约需要 30 秒。

关于为什么 javac (1.5) 运行如此缓慢的任何建议？（我不想永久切换到 Eclipse 编译器，因为 Maven 的插件似乎有点小错误。）

我有一个很容易重现问题的测试用例。以下代码在默认包中生成了一些源文件。如果您尝试使用 javac 编译 ImplementingClass.java，它似乎会暂停很长时间。

```
import java.io.File;
import java.io.FileNotFoundException;
import java.io.PrintStream;

public class CodeGenerator
{
    private final static String PATH = System.getProperty("java.io.tmpdir");
    private final static int NUM_TYPES = 1000;

    public static void main(String[] args) throws FileNotFoundException
    {
        PrintStream interfacePs = new PrintStream(PATH + File.separator + "Interface.java");
        PrintStream abstractClassPs = new PrintStream(PATH + File.separator + "AbstractClass.java");
        PrintStream implementingClassPs = new PrintStream(PATH + File.separator + "ImplementingClass.java");
        interfacePs.println("public interface Interface<T> {");
        abstractClassPs.println("public abstract class AbstractClass<T> implements Interface<T> {");
        implementingClassPs.println("public class ImplementingClass extends AbstractClass<Object> {");

        for (int i=0; i<NUM_TYPES; i++)
        {
            String nodeName = "Node" + i;
            PrintStream nodePs = new PrintStream(PATH + File.separator + nodeName + ".java");
            nodePs.printf("public class %s { }\n", nodeName);
            nodePs.close();
            interfacePs.printf("void visit(%s node, T obj);%n", nodeName);
            abstractClassPs.printf("public void visit(%s node, T obj) { System.out.println(obj.toString()); }%n", nodeName);
        }
        interfacePs.println("}");
        abstractClassPs.println("}");
        implementingClassPs.println("}");
        interfacePs.close();
        abstractClassPs.close();
        implementingClassPs.close();
    }
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-08T12:03:57.063

Sun 通过电子邮件向我确认这是一个新错误（他们的错误数据库中的[6827648](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6827648)）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-08T03:53:02.843

您在 JDK 1.6 中得到相同的行为，包括更新 14、构建 04，使用 G1 不会改变行为（尽管 G1 似乎工作得很好）。

使用 jvisualvm 监控 javac，重复的线程转储显示主线程花费大量时间

```
at com.sun.tools.javac.code.Types.isSubSignature(Types.java:1846)
at com.sun.tools.javac.code.Symbol$MethodSymbol.overrides(Symbol.java:1108)
at com.sun.tools.javac.code.Symbol$MethodSymbol.implementation(Symbol.java:1159)
at com.sun.tools.javac.comp.Check.checkCompatibleConcretes(Check.java:1239)
at com.sun.tools.javac.comp.Check.checkCompatibleSupertypes(Check.java:1567)
at com.sun.tools.javac.comp.Attr.attribClassBody(Attr.java:2674)
at com.sun.tools.javac.comp.Attr.attribClass(Attr.java:2628)
at com.sun.tools.javac.comp.Attr.attribClass(Attr.java:2564)
at com.sun.tools.javac.main.JavaCompiler.attribute(JavaCompiler.java:1036)
at com.sun.tools.javac.main.JavaCompiler.compile2(JavaCompiler.java:765)
at com.sun.tools.javac.main.JavaCompiler.compile(JavaCompiler.java:730)
at com.sun.tools.javac.main.Main.compile(Main.java:353)
at com.sun.tools.javac.main.Main.compile(Main.java:279)
at com.sun.tools.javac.main.Main.compile(Main.java:270)
at com.sun.tools.javac.Main.compile(Main.java:69)
at com.sun.tools.javac.Main.main(Main.java:54) 
```

并搅动这些类的大量短暂实例：

```
com.sun.tools.javac.code.Types$Subst
com.sun.tools.javac.util.List
com.sun.tools.javac.code.Types$MethodType 
```

我怀疑代码是通过`com.sun.tools.javac.comp.Check.checkCompatibleConcretes`将每种方法与其他所有方法进行比较 来搅动的

该方法的javadoc：

```
/** Check that a class does not inherit two concrete methods
 *  with the same signature.
 */ 
```

可能是 Eclipse 的编译器要么不执行该检查，要么不以相同的方式执行它。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-03T14:48:09.410

可能是 javac 编译器在其堆限制（64MB 左右）附近运行。在这种情况下，它大部分时间都在垃圾收集器中。给编译器一大块内存，比如 256M 或 512M，看看它是否运行得更快。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-27T08:44:27.553

您使用生成的源代码这一事实、速度上的*巨大*差异以及`StackOverflowError`可能表明您的一个（或多个）文件有一些`javac`解析器不同意的结构。

您能否尝试仅编译代码的子集，并查看是否有任何一个类/包会特别减慢进程（可能是生成的类/包之一）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-26T17:19:47.497

对于 Sun 编译器，您正在为要编译的每个文件启动一个完整的 JVM 进程。对于 Eclipse 编译器，它只是连接到一个守护进程。我建议将 fork 设置为 false，尽管它可能仍然没有那么快。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-26T16:42:02.377

也许 Eclipse 构建只是编译修改过的源代码。如果你在清理之后在eclipse中编译它会发生什么？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-03T20:05:59.273

我不知道 maven 如何调用编译器，但您提到的性能数字表明 javac 是在它自己的进程/VM 中执行的，正如另一个答案中已经建议的那样。由于为您编译的每个文件启动一个新进程/VM 的成本非常高，您需要确保将编译器配置为使用您可能已经拥有的 VM。我知道 ANT 提供了，但我自己没有使用过 maven。鉴于它很受欢迎，我怀疑它缺乏如此重要的功能。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-06T18:08:49.670

我认为正在发生以下情况：Maven forks javac, JVM processes for different steps in its life-cycle: [Maven Build Life-cycle](http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html)

Eclipse 通常在后台（保存时）运行其编译，因此该步骤将被添加到编译阶段。如果存在大量依赖关系，这就是您失去吞吐量的地方。

此外（取决于 mvn 配置）每个测试方法都有自己的 JVM。由于测试通道是打包阶段的先决条件，因此您可能会在 JUnit 测试执行上浪费时间（特别是如果它们是运行缓慢的测试）。如果您的源代码树中有大量测试代码，这可能是罪魁祸首。

最有可能的是，您的班级执行了大量的文件 I/O，因此这是一个机会领域。看起来您的循环在每个文件发现事件中执行 1000 次，这意味着循环主体中有 800*1000 =800,000 个 PrintStream 创建。

# ado.net - 在 ADO.NET 中对数据表进行排序的最佳方法是什么

> ID：686547
> 
> 赞同：1
> 
> 时间：2009-03-26T16:32:21.057
> 
> 标签：ado.net, sorting, sql-order-by

从性能和代码可读性的角度来看，在 c# 中对数据表进行排序的最佳方法是：

```
personsDT.OrderBy(person => person.PersonName); 
```

或者：

```
personsDT.DefaultView.Sort = "PersonName ASC"; 
```

personDT 是从 SharePoint 列表构建的，因此无法使用 SQL（我知道 SQL SELECT 语句中的 ORDER BY 克劳德将是最好的方法）。考虑到性能，我担心 OrderBy<> 子句可能比数据视图中的 Sort 慢。你知道这样的性能影响吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T16:41:09.057

我会更喜欢第一个选项。

1）对于代码的可读性观点，我认为 Lambda 比第二个更清晰。

2）在第一种情况下，您使用强类型的方式对您的实体进行排序，这很好。

3）在第二种情况下，您正在传递字段并且字符串中的顺序 mmmm 不喜欢它。

去拉姆达斯！！！

问候！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T16:39:39.043

提问的目的是什么？性能几乎可以肯定不是问题。如果没有，您需要在您的上下文中对其进行测试。我认为如果您为 SQL 语句指定排序，它应该在 SQL 语句中；如果可能的话，我更愿意避免按字符串构造 SQL 语句。你更喜欢哪个审美？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-02-04T07:26:17.043

把我的 2c 扔进锅里：

来自 sql 背景，我个人觉得 sql 方式更直观——但这不是遵循它的理由。lambda 方法有几个很好的建议：

正如 MRFerocius （遗漏的 'o' 是故意的吗？）指出 - lambda 方法是强类型的。这是好事。

然后就是这样 - 如果您的排序标准变得更加复杂，lambda 方法将允许您处理 sql 方法无法处理的额外和深奥的条件。

在性能方面，对于像这样的简单条件，它们应该大致相等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T16:45:02.167

好吧，如果性能非常重要，请在获取数据之前在 SQL DB 上对其进行排序。

# c# - 当生成的查询只需要 1/2 秒时，为什么 Entity Framework 需要 30 秒来加载记录？

> ID：686554
> 
> 赞同：17
> 
> 时间：2009-03-26T16:33:33.737
> 
> 标签：c#, .net, entity-framework, linq-to-entities

下面的executeTime第一次是30秒，下次我执行同一组代码时是25秒。在 SQL Profiler 中观看时，我立即看到一个登录名，然后它就在那里停留了大约 30 秒。然后，只要运行 select 语句，应用程序就会完成 ToList 命令。当我从 Management Studio 运行生成的查询时，数据库查询只需要大约 400 毫秒。它返回 14 行和 350 列。看起来将数据库结果转换为实体所需的时间是如此之小以至于不明显。

那么在进行数据库调用之前的 30 秒内发生了什么？

如果实体框架这么慢，我们是不可能使用它的。有什么我做错了或者我可以改变什么来大大加快速度吗？

**更新：** 好吧，如果我使用编译查询，第一次需要 30 秒，第二次需要 1/4 秒。我能做些什么来加快第一次通话的速度吗？

```
using (EntitiesContext context = new EntitiesContext()) 
{ 
    Stopwatch sw = new Stopwatch(); 
    sw.Start(); 
    var groupQuery = (from g in context.Groups.Include("DealContract") 
                    .Include("DealContract.Contracts") 
                    .Include("DealContract.Contracts.AdvertiserAccountType1") 
                    .Include("DealContract.Contracts.ContractItemDetails") 
                    .Include("DealContract.Contracts.Brands") 
                    .Include("DealContract.Contracts.Agencies") 
                    .Include("DealContract.Contracts.AdvertiserAccountType2") 
                    .Include("DealContract.Contracts.ContractProductLinks.Products") 
                    .Include("DealContract.Contracts.ContractPersonnelLinks") 
                    .Include("DealContract.Contracts.ContractSpotOrderTypes") 
                    .Include("DealContract.Contracts.Advertisers") 
                where g.GroupKey == 6 
                select g).OfType<Deal>(); 
    sw.Stop(); 
    var queryTime = sw.Elapsed; 
    sw.Reset(); 
    sw.Start(); 
    var groups = groupQuery.ToList(); 
    sw.Stop(); 
    var executeTime = sw.Elapsed; 
} 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-28T23:11:04.187

我遇到了同样的问题，我的查询需要 40 秒。

我发现问题出在`.Include("table_name")`功能上。我拥有的越多，情况就越糟。相反，我将我的代码更改为在查询后立即延迟加载我需要的所有数据，这将总时间从 40 秒减少到大约 1.5 秒。据我所知，这完成了完全相同的事情。

因此，对于您的代码，它将是这样的：

```
var groupQuery = (from g in context.Groups
            where g.GroupKey == 6 
            select g).OfType<Deal>(); 

var groups = groupQuery.ToList();

foreach (var g in groups)
{
    // Assuming Dealcontract is an Object, not a Collection of Objects
    g.DealContractReference.Load();
    if (g.DealContract != null)
    {
        foreach (var d in g.DealContract)
        {
            // If the Reference is to a collection, you can just to a Straight ".Load"
            //  if it is an object, you call ".Load" on the refence instead like with "g.DealContractReference" above
            d.Contracts.Load();
            foreach (var c in d.Contracts)
            {
                c.AdvertiserAccountType1Reference.Load();
                // etc....
            }
        }
    }
} 
```

顺便说一句，如果您要在当前代码的查询上方添加这行代码，它会将时间缩短到大约 4-5 秒（在我的选项中仍然太长）据我了解，该`MergeOption.NoTracking`选项禁用了很多更新和将内容插入数据库的跟踪开销：

```
context.groups.MergeOption = MergeOption.NoTracking; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-26T17:16:44.977

这是因为包含。我的猜测是您急于将大量对象加载到内存中。构建与您的数据库实体相对应的 c# 对象需要很长时间。

我对您的建议是尝试仅延迟加载您需要的数据。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T20:57:12.590

据我所知，使查询的初始编译更快的唯一方法是使查询不那么复杂。[有关实体框架](http://msdn.microsoft.com/en-us/library/cc853327.aspx)和[编译查询](http://msdn.microsoft.com/en-us/library/bb896297.aspx)的性能注意事项的 MSDN 文档并未表明有任何方法可以保存已编译查询以在不同的应用程序执行会话中使用。

我要补充一点，我们发现拥有大量包含可以使查询执行比拥有更少的包含和稍后在相关实体上执行更多加载更慢。需要一些试验和错误才能找到正确的介质。

但是，我不得不问你是否真的需要你在这里包含的每个实体的每个属性。在我看来，这个查询中有大量不同的实体类型，因此实现它们可能会非常昂贵。如果您只是想获得您不打算更新的表格结果，那么出于各种原因，将您实际需要的（相对）较少数量的字段投影到平面匿名类型中应该会明显更快。此外，这使您不必担心急切加载、调用 Load/IsLoaded 等。

您当然可以通过预编译实体视图来加速初始视图的生成。[MSDN 上](http://msdn.microsoft.com/en-us/library/bb896240.aspx)有这方面的文档。但是由于您在执行第一个查询时支付了该费用，因此您对简单查询的测试表明，这对您来说运行时间约为 2 秒。说 2 秒很好，但它不会保存任何其他内容。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T18:55:56.830

EF 需要一段时间才能启动。它需要从 xml 构建元数据，并可能生成用于映射的对象。所以启动需要几秒钟，我认为没有办法解决这个问题，除非永远不要重新启动你的程序。

# serialization - 谷歌可视化 API .net？

> ID：686566
> 
> 赞同：2
> 
> 时间：2009-03-26T16:36:10.317
> 
> 标签：serialization, json.net

如何在我的 .NET 应用程序中使用谷歌可视化 api json 格式的数据？目前无法想象如何使用这些数据。

我必须自己将json解析为对象吗？我可以使用[Json.NET](http://json.codeplex.com/)反序列化它吗？现在我不知道如何开始。任何帮助表示赞赏。

数据如下所示：

```
{
  cols: [
    {id: '1', label: 'Name', type: 'string'},
    {id: '2', label: 'Age', type: 'number'},
    {id: '3', label: 'Birthdate', type: 'date'}
  ],
  rows: [
    {c:[{v: 'Dan'}, {v: 18.0, f: 'eighteen'}, {v: new Date(2008, 1, 28, 0, 31, 26), f: '2/28/08 12:31 AM'}]},
    {c:[{v: 'Frank'}, {v: 19.0, f: 'nineteen'}, {v: new Date(2008, 2, 30, 0, 31, 26), f: '3/30/08 12:31 AM'}]},
    {c:[{v: 'Esther'}, {v: 20.0, f: 'twenty'}, {v: new Date(2008, 3, 30, 0, 31, 26), f: '4/30/08 12:31 AM'}]}
  ]
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T17:20:16.903

> 我可以使用 Json.NET 反序列化它吗？

是的。这就是它的用途。

> 现在我不知道如何开始。任何帮助表示赞赏。

[手册](http://james.newtonking.com/projects/json/help/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-08T21:29:12.233

您可以通过 System.Runtime.Serialization.Json 命名空间中的 DataContractJsonSerializer 类使用 Json 反序列化。它与 XML 序列化非常相似，因为您创建了一堆数据类，用属性修饰它们并将 Json 放入反序列化器中。

下面的文章通过一个 Google 网络搜索示例解释了如何使用 Json：

[http://www.ben-morris.com/google-search-api-deserialize-json-output-net](http://www.ben-morris.com/google-search-api-deserialize-json-output-net)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-05-07T09:42:47.413

我知道我迟到了，但对于未来的求职者来说，请看这里：

[https://code.google.com/p/bortosky-google-visualization/](https://code.google.com/p/bortosky-google-visualization/)

我使用它没有任何问题。

示例代码：

```
 DataTable tbl = DatabaseEnquiry(sqlcommand, DATE_IN, DATE_OUT, "dd/MM/yyyy HH:mm:ss", true);
 return new Bortosky.Google.Visualization.GoogleDataTable(tbl).GetJson().ToString(); 
```

或者，您可以使用 JavaScriptSerializer：

```
DataTable tbl = DatabaseEnquiry(sqlcommand, DATE_IN, DATE_OUT, "dd/MM/yyyy HH:mm:ss", true);
JavaScriptSerializer js = new JavaScriptSerializer();
StringBuilder sb = new StringBuilder();
try
{
    var linqResults = from DataRow row in tbl.AsEnumerable()
                      select new
                      {
                          avgft = row.Field<object>("AVG FT"),
                          minft = row.Field<object>("MIN FT"),
                          maxft = row.Field<object>("MAX FT"),
                          avgffc = row.Field<object>("AVG FFC"),
                          minffc = row.Field<object>("MIN FFC"),
                          maxffc = row.Field<object>("MAX FFC"),
                          avgtt = row.Field<object>("AVG TT"),
                          mintt = row.Field<object>("MIN TT"),
                          maxtt = row.Field<object>("MAX TT"),
                          avgtfc = row.Field<object>("AVG TFC"),
                          mintfc = row.Field<object>("MIN TFC"),
                          maxtfc = row.Field<object>("MAX TFC")
                      };
    js.Serialize(linqResults, sb);
}
catch (InvalidCastException e)
{
    logger.Debug(e.StackTrace);
    return null;
}
return sb.ToString(); 
```

}

# nhibernate - NHibernate 多对多关系，包括关系的一侧

> ID：686569
> 
> 赞同：0
> 
> 时间：2009-03-26T16:36:55.383
> 
> 标签：nhibernate, architecture, fluent-nhibernate

鉴于此数据库架构（它已传给我）：

[![图式](https://i.stack.imgur.com/5eySv.png)](https://i.stack.imgur.com/5eySv.png)
[（来源：[robtennyson.us](http://files.robtennyson.us/2009/2009-03-26_1114.png)）]

**我想要关于如何建模和使用 fluent-nhibernate 映射它的建议。**

我唯一能想到的是一种非常活跃的建模记录风格（每个表都有一个类和明显的关联）。

不过暂时忽略数据库，我想我希望每个设施都始终拥有所有合规标志的列表。这样我就可以询问工厂标志“XX”的合规日期是什么。

任何帮助都将不胜感激，即使它只是朝着正确的方向轻轻推动。

谢谢，罗伯

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T12:23:23.877

我认为最好的方法是您已经建议的方法，将每个表映射为一个实体。如果您在连接表中没有其他数据，则不需要，但是当您这样做时，它们实际上应该是单独的实体。

您将拥有三个实体。Facility and Compliance 将有一个`HasMany`to Facil_Compliance。您还可以`References`从 Facil_Compliance 返回到每个表。如果你只需要走一条路，你可以选择从这种关系中删除一个方向。

# c# - 为什么 Assert.IsInstanceOfType(0.GetType(), typeof(int)) 失败？

> ID：686571
> 
> 赞同：46
> 
> 时间：2009-03-26T16:37:13.027
> 
> 标签：c#, unit-testing, mstest

我对单元测试有点陌生，使用`Microsoft.VisualStudio.TestTools.UnitTesting`;

`0.GetType()`实际上是`System.RuntimeType`，所以我需要写什么样的测试才能通过`Assert.IsInstanceOfType(0.GetType(), typeof(int))`？

---跟进，这是我自己的用户错误......`Assert.IsInstanceOfType(0, typeof(int))`

* * *

## 回答 #1

> 赞同：80
> 
> 时间：2009-03-26T16:42:01.283

将调用更改为以下内容

```
Assert.IsInstanceOfType(0, typeof(int)); 
```

第一个参数是被测试的对象，而不是被测试对象的类型。通过传递 0.GetType()，您说的是“RunTimeType”是 System.int 的一个实例，它是错误的。在幕后，他们的电话只是解决

```
if (typeof(int).IsInstanceOfType(0)) 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-03-26T16:42:02.877

看起来应该是

```
Assert.IsInstanceOfType(0, typeof(int)) 
```

您的表达式当前正在评估 RunTimeType 是否是 RunTimeType 的一个实例，但它不是。

# wpf - 为什么这不会改变我的 WPF Datagrid 标题的颜色？

> ID：686572
> 
> 赞同：0
> 
> 时间：2009-03-26T16:37:13.417
> 
> 标签：wpf, xaml, datagrid, wpfdatagrid

我在后面的代码中填充我的数据网格，如下所示：

```
var customers = from c in _db.Customers
                select c;
TheDataGrid.ItemsSource = customers.ToList(); 
```

在我下面的 XAML 中，DataGrid.RowBackground 有效，但DataGridHeaderBorder在运行时的代码隐藏中**收到错误“在使用 ItemsSource 之前，项目列表必须为空” 。**

这很奇怪，因为我只是想更改 Datagrid 标题的颜色，但 ItemsSource 有问题。如果我取出 DataGridHeaderBorder 行，它工作正常。

**那么如何简单地更改 Datagrid 上列标题的颜色呢？**

```
 <toolkit:DataGridHeaderBorder Background="yellow"/>

        <toolkit:DataGrid.RowBackground>
            <LinearGradientBrush EndPoint="-0.136,-0.163" StartPoint="1.291,1.248">
                <GradientStop Color="#FFA8A929" Offset="0.004"/>
                <GradientStop Color="#FFF7F7ED" Offset="0.991"/>
            </LinearGradientBrush>
        </toolkit:DataGrid.RowBackground> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T19:57:48.723

每当您将元素放入元素中时，XAML 解析器都必须确定子元素是否是复杂的属性分配（正如您正在尝试做的那样），或者您是否打算将子元素作为父元素的“内容”元素。因为您的问题“DataGridHeaderBorder”标签不是以“toolkit:DataGrid”开头，所以假设您正在尝试将 DataGrid 的 content 属性（恰好是 Items）设置为此值。

我无法尝试此操作，但我猜您需要将问题标签替换为以下内容：

```
<toolkit:DataGrid.RowHeaderStyle>
    <Style TargetType="{x:Type toolkit:DataGridRowHeader}">
        <Setter Property="Background" Value="Yellow" />
    </Style>
</toolkit:DataGrid.RowHeaderStyle> 
```

# toolbar - 从工具栏提交 SAS 代码或宏

> ID：686581
> 
> 赞同：5
> 
> 时间：2009-03-26T16:39:08.483
> 
> 标签：toolbar, sas, sas-macro, dm, display-manager

是否可以将 SAS 脚本或宏分配给 Base SAS 中的工具栏按钮？即你能'dm'一个宏或sas脚本吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-26T19:29:57.887

当然。这是一种方法：

1.  转到工具-> 自定义。
2.  选择自定义选项卡
3.  通过单击“添加工具”创建一个新的空白按钮（最左边的按钮，在“命令”一词的正上方
4.  使用“更改图标”按钮为新按钮选择一个图标（否则它将为空白且不会显示在工具栏中）
5.  要让按钮提交已编译的宏，请在命令字段中输入以下内容（当然要替换您的宏名称）：

    %宏名称；运行；

6.  要让按钮提交外部 sas 文件，您可以在命令字段中输入如下内容：

    %include "C:\path-to-file\name-of-program.sas";运行;

7.  在帮助文本和提示文本字段中添加您想要的任何内容

8.  点击确定然后保存

# java - Java 豆机

> ID：686588
> 
> 赞同：1
> 
> 时间：2009-03-26T16:40:27.747
> 
> 标签：java, arrays

这是我想完成的事情：

> 编写一个刺激 [豆机](http://en.wikipedia.org/wiki/Bean_machine)的程序 您的程序应该提示用户输入机器中的球数和槽数。通过打印每个球的路径来模拟每个球的下落。
> 
> 前任。
> 
> 输入球数：5
> 输入槽数：7
> 
> LRLRLRL
> RRLRLLL
> LLRRLLR
> LRLLRLR
> RRRLRRL
> _ _ 0
> _ _ 0
> 0 0 0

到目前为止，这是我的代码：

```
import javax.swing.JOptionPane;        
public static void main(String[] args) {
            int balls=0;
            int slots=0;
            char [] direction= new char [slots];
            int slot=0;
            int i=0;
            int path=0;

            balls= Integer.parseInt(JOptionPane.showInputDialog("Enter" +
                    " the number of balls to be dropped:"));
            slots= Integer.parseInt (JOptionPane.showInputDialog("Enter " +
                    "the number of slots:"));

            for (int j=1;j<=balls;j++){
                while(i<slots){
                    path= (int)(Math.random()*100);
                    if (path <50){
                        direction [slots]='L';
                    }
                    else{
                        direction [slots]='R';
                    }
                i++;
                slot++;
            }
            System.out.println("The pathway is" +direction[0]+direction[1]+direction[2]+direction[3]+direction[4]);

       }
    } 
```

我遇到了一些问题：

1.  在我尝试打印路径的代码的最后一行中，我必须基本上猜测用户选择的插槽数量。有没有更好的打印方法？
2.  如何打印用户在上面显示的模式中输入的数字“球”？
3.  我的代码还有其他问题吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T16:51:03.617

好吧，对于初学者来说，我得到了一致`ArrayIndexOutOfBoundsException`的在线`direction[slots] = 'L';`（或`'R'`）。那是因为`direction`它的长度始终为 0，因为您将它初始化为 0`slots`时`slots`。移动线

```
char [] direction= new char [slots]; 
```

之后`slots`是输入。

接下来，您总是将“L”或“R”分配到数组末尾之后的位置。`ArrayIndexOutOfBoundsException`这是我得到的另一个原因。将分配更改为

```
direction[i] = 'L'; // or 'R' 
```

接下来，您不会`i`在`while`循环后重置。因此，仅计算第一个球的路径，然后将其重用于所有其他球。我会把它变成一个`for`循环，就像这样：

```
for (i = 0; i < slots; i++) {
    // your code here (make sure you don't change i inside the loop)
} 
```

最后，正如其他人所说，您应该使用循环来打印路径。您知道`direction`数组有多长（`direction.length`如果您不知道，它是 ），因此您可以循环遍历它并打印出每个字母。

完成这些更改后，您的程序应该可以工作（**编辑：**除了它不跟踪每个球最终进入哪个插槽）。它仍然有一些改进的空间，但找到这些东西是乐趣的一部分——不是吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T16:52:43.240

> 在我尝试打印路径的代码的最后一行中，我必须基本上猜测用户选择的插槽数量。有没有更好的打印方法？

使用 for 循环，`System.out.print()`因此您不会在每一步之后都换行。

> 如何打印用户在上面显示的模式中输入的数字“球”？

对于每个插槽，您需要记录最终进入该插槽的球数，以及任何插槽的最大值。给定这两个值，您可以遍历每个插槽，并使用嵌套循环打印适当次数的“_”或“0”。

> 我的代码还有其他问题吗？

您似乎只是在打印最后一个球落下的路径，而不是每个球，但这可能只是您的压痕松软。发布格式正确，完整的代码。

您的示例输出似乎是从控制台读取输入，而不是使用 swing。

您过早地声明变量。最好在第一次使用时声明变量，如果它们不改变标记它们`final`。如果你有：

```
final int slots= Integer.parseInt (... 
```

代替

```
int slots = 0;
...
slots= Integer.parseInt (... 
```

那么至少你的一个错误将被编译器捕获。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T16:56:37.457

一些答案：

1.  再想想`for loop`。 `System.out.print`或 `System.out.printf`会有所帮助。
2.  `System.out.println("Number of balls: "+ something that makes an int into a string`（那会是什么？）
3.  你为什么把结果 `Math.random()`放入一个`int`？如果你使用会发生什么：

    ```
    if(Math.random() < 0.5) { // do something  
    } else {  // do the opposite  
    } 
    ```

# javascript - 有没有办法在 Javascript 中定义符号常量？

> ID：686590
> 
> 赞同：3
> 
> 时间：2009-03-26T16:41:12.283
> 
> 标签：javascript, constants

我搜索了 JavaScript 是否提供了定义符号常量的方法，但没有找到任何东西。我错过了什么 ？

改用 const var 是一种常见的做法吗？

```
var const MAXIMUM_VALUE = 100; 
```

谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-26T16:44:54.850

`const`IE不支持，所以如果你想支持IE那是不可能的。

据我所知，为了简单起见，最好的方法是为你的常量设置一个命名约定，比如流行的 ALL UPPERCASE。有一些例子可以强制使用常量，但在大多数情况下它们并不值得。或者，您可以使用一个函数：

```
function myConst() { return 'myValue'; } 
```

当然，这仍然可以被覆盖，但我已经看到它使用过。

另见：

> *   [Javascript中有常量吗？](https://stackoverflow.com/questions/130396/are-there-constants-in-javascript)
> *   [是否可以使用闭包模拟 Javascript 中的常量？](https://stackoverflow.com/questions/622906/is-it-possible-to-simulate-constants-in-javascript-using-closures)
> *   [Javascript：最终/不可变的全局变量？](https://stackoverflow.com/questions/664829/javascript-final-immutable-global-variables)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-26T16:45:30.557

是的。但是你删除了var。const 替换 var。

```
const MAXIMUM_VALUE = 100; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-02-16T00:56:39.543

```
Object.defineProperty(window, 'CONSTANT_NAME', {value: CONSTANT_VALUE});

// usage
console.log(CONSTANT_NAME); 
```

[`Object.defineProperty()`](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty)创建具有以下默认属性的属性：

*   **`configurable`**当且仅当此属性描述符的类型可以更改并且可以从相应对象中删除该属性时才为 true。 **默认为假。**

*   **`enumerable`**当且仅当在枚举相应对象的属性期间显示此属性时才为 true。**默认为假。**

*   **`writable`**当且仅当与属性关联的值可以使用赋值运算符更改时才为真。**默认为假。**

如果“常量”是一个对象，您可能还想通过冻结它使其不可变。`obj =`[`Object.freeze(obj)`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze). 请记住，子属性对象不会自动冻结。

# java - 有没有办法在 web.xml 文件中解析系统属性？

> ID：686591
> 
> 赞同：5
> 
> 时间：2009-03-26T16:41:34.123
> 
> 标签：java, servlets, jboss, web.xml

我在 JBOSS 的 run.conf 中添加了一个系统属性，如下所示：

```
JAVA_OPTS="$JAVA_OPTS -Dfoo=bar" 
```

现在我的问题是，是否有办法以如下方式解决 web.xml 文件中的此属性：

```
...
<context-param>
  <param-name>contextConfigLocation</param-name>
  <param-value>
    classpath:applicationContext-common.xml
    classpath:conf/${foo}/applicationContext-local.xml
  </param-value>
</context-param>
... 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2015-04-22T09:00:11.063

您必须将standalone.xml 中*的spec-descriptor-property-replacement设置为***true**

```
 <subsystem xmlns="urn:jboss:domain:ee:1.2">
        <spec-descriptor-property-replacement>true</spec-descriptor-property-replacement>
        <jboss-descriptor-property-replacement>true</jboss-descriptor-property-replacement>
    </subsystem> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-12T04:10:10.960

由于 JBoss 在内部使用 tomcat web-container，它应该像您的示例 (${foo}/applicationContext-local.xml) 一样工作。我没有尝试过 JBoss 案例，但我们在 Tomcat 中一直使用这种技术。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T17:17:30.903

web.xml 应仅适用于单个 Web 应用程序。它不应该有全局配置。所以不行。无论如何，当服务器和你的 web 应用程序加载完毕时，开始播放命令行参数已经太晚了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T16:50:53.417

我不知道有什么可能。但在我看来，这应该在应用程序中实现。为什么要增加间接性？通常，您可以从应用程序 (app > web.xml) 中访问 web.xml 的内容。为什么这样做：app > web.xml > 环境变量？

# asp.net-mvc - ASP.NET MVC jQueryUI 日期选择器在使用 AJAX.BeginForm 时不起作用

> ID：686595
> 
> 赞同：5
> 
> 时间：2009-03-26T16:42:03.220
> 
> 标签：asp.net-mvc, jquery-ui-datepicker

我有一个 ASP.NET MVC 部分视图，其中包含一个配置为使用来自 JQueryUI 的日期选择器的 Html.TextBox。这是通过确保将样式设置为 .datepicker 来完成的。这一切都很好。但是，我已将表单更改为 Ajax.BeginForm 并包含一个 Ajax.ActionLink，在单击链接后显示它。由于添加此日期选择器不显示。事实上，在从控制器返回局部视图之后，现在甚至没有调用以前工作的 JavaScript。即使我将 JavaScript/JQuery 放在局部视图本身中，它仍然不会使用它。我真的很困惑，有人可以帮忙吗？

示例如下所示

```
<div id="claims">
        <div id="divViewClaims">
            <% Html.RenderPartial("ViewClaim", Model.Claims ?? null); %>
        </div>
        <br /><br />
        <div id="claim">
            <% Html.RenderPartial("AddEditClaim", new Claim()); %>          
        </div>
    </div> 
```

Action Link，当 clickon 调用 Controller Action 以返回 PartialView 时，OnSuccess 上调用的 JavaScript 会触发，但没有其他内容，这之前是由 document.ready 函数连接的。我所有的脚本都在单独的文件中，并在母版页中引用。

```
<%= Ajax.ActionLink(string.Format("Add A{0} Claim", Model.Count > 0 ? "nother" : string.Empty), "AddClaim", "Driver", new AjaxOptions { HttpMethod = "GET", UpdateTargetId = "claim", OnSuccess="showAddClaim" }, new { @class = "ControlLink" })%> 
```

控制器动作

```
public ActionResult AddClaim()
{
      return PartialView("AddEditClaim", new Claim());
} 
```

部分视图，显示样式设置为 datepicker 的文本框

```
<% var ajaxOptions = new AjaxOptions { HttpMethod = "POST", UpdateTargetId = "divViewClaims", InsertionMode = InsertionMode.Replace, OnSuccess="hideAddClaim" }; %>
        <% using (Ajax.BeginForm("AddEditClaim", "Claim", ajaxOptions, new { @name = "ClaimControl", @id = "ClaimControl" }))
           { %>

    <fieldset>  
        <legend><%= Model.Id==0?"Add":"Edit" %> Claim</legend> 
        <p>
            <label for="Title">Claim Date</label>
            <%= Html.TextBox("Date", Model.Date.ToString().TrimEnd('0', ':', ' ') ?? "", new { @class = "datepicker" })%>  
        </p> 
```

我很感激这方面的任何帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-11-03T14:15:14.363

如果元素是在`document.ready`你应该重新匹配元素到 jQuery 之后创建的。

查看[jQuery Live](http://docs.jquery.com/Events/live)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-09-08T12:41:01.977

对我有用的是使用`OnSuccess`AjaxOptions 中的属性。所以，你的代码可能是这样的：

```
using (Ajax.BeginForm("AddEditClaim", "Claim", ajaxOptions, new { @name = "ClaimControl", @id = "ClaimControl", OnSuccess="the_javascript_function_below" }) 
```

`the_javascript_function`执行此操作的函数的名称在哪里：

```
$(".datepicker").datepicker(); 
```

# c# - 另一个页面的asp.net线程监控

> ID：686596
> 
> 赞同：1
> 
> 时间：2009-03-26T16:42:07.243
> 
> 标签：c#, asp.net, multithreading, monitoring

在 asp.net 2.0 中，c#.

是否可以从一个页面启动一个线程，例如当单击一个 asp:button 并从另一个页面检查该线程是否已退出？

原因：我们有一个页面，当单击一个按钮时，它会启动一个很长的服务器端脚本。但是，由于我们不想等待该页面上的脚本结束，我们考虑创建一个执行脚本的线程，然后获取线程 ID 并将用户重定向到“请稍候”页面上，该页面刷新检查每个5 秒检查线程是否已退出。

关于如何实现这一目标有更好的想法吗？

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T16:50:21.357

这可以做到，但是我会使用 Ajax 来改善体验。

基本上，你会调用你的方法，它会返回线程的标识符。它不一定是线程 ID，但您需要某种可以在页面/调用之间传递的唯一标识符。

在从该调用/页面返回之前，您将执行您的线程。

然后，当您的客户端检查状态时，它会检查会话或其他一些共享状态，这会将结果键入您之前返回的 id。

如果它找到与该键对应的值，则显示结果（并将结果从共享状态中删除），否则，它会在指定的时间段内再次检查。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T17:40:45.653

ASP.NET 中已经内置了一种方法来做这种事情——它是异步页面模型。有 2 种方法可以实现这一点，您可以在[此处](http://msdn.microsoft.com/en-us/magazine/cc163725.aspx)找到有关它们的详细信息，并解释所有好处。

# winforms - ADO.NET 数据绑定错误 - BindingSource.EndEdit() 更改当前位置

> ID：686597
> 
> 赞同：2
> 
> 时间：2009-03-26T16:42:20.190
> 
> 标签：winforms, data-binding, dataset, bindingsource, tableadapter

[使用BindingSource](http://msdn.microsoft.com/en-us/library/system.windows.forms.bindingsource.aspx)、[DataSet](http://msdn.microsoft.com/en-us/library/system.data.dataset.aspx)和[TableAdapter](http://msdn.microsoft.com/en-us/library/7zt3ycf2%28v=vs.80%29.aspx)从数据绑定控件处理插入的正确顺序是什么？这让我永远感到困惑。

我有一个用于添加新行的表单。

在显示表格之前，我调用：

```
bindingSource.AddNew();
bindingSource.MoveLast(); 
```

保存后，我调用：

```
bindingSource.EndEdit();
tableAdapter.Insert([the row given to me as bindingSource.Current]); 
```

问题是

*   如果我不调用`EndEdit()`，则当前焦点的 TextBox 的更改不会保存
*   如果我调用`EndEdit()`，BindingSource 的 Current 成员不再指向我刚刚添加的行。

我当然可以`Insert()`使用表单中的值而不是由 BindingSource 更新的 DataTable 调用，但这违背了使用数据绑定的目的。我需要做什么才能使它正常工作？

我知道我可以调用`TableAdapter.Update()`整个数据集，因为我使用的是强类型数据集。不过，我在表中有未绑定数据的外键，并且我在调用 Insert() 之前添加了这些外键。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T18:38:53.017

事实证明，这是[.NET](http://en.wikipedia.org/wiki/.NET_Framework)框架的“功能”。我之前曾在[connect.microsoft.com](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=355183)上报告过，但该问题因“无法修复”而关闭。不过，有一个[解决方法](https://connect.microsoft.com/VisualStudio/feedback/Workaround.aspx?FeedbackID=355183)。

我正在使用以下 C# 代码来重置 ListChanged 事件处理程序中的位置：

```
 [...]
        bindingSource.ListChanged += 
            new ListChangedEventHandler(PreserveCurrentPosition);
    [...]

    private void PreserveCurrentPosition(object sender, ListChangedEventArgs e)
    {
        if (e.ListChangedType == System.ComponentModel.ListChangedType.ItemAdded &&
            ((BindingSource)sender).Count - e.NewIndex > 1)
        {
            ((BindingSource)sender).Position = e.NewIndex;
        }
    } 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2010-05-21T15:11:20.977

您现在可能已经弄清楚了，但是您不需要调用表适配器的插入方法。只需调用 update 方法，它就会判断是否有任何新的或更改的记录并采取相应的行动。

# ruby-on-rails - 块总是返回真

> ID：686598
> 
> 赞同：1
> 
> 时间：2009-03-26T16:42:33.390
> 
> 标签：ruby-on-rails

将始终返回 true 并擦除整个数组

```
<% users.delete_if do |user| %>
  <% false %>
<% end %> 
```

另一方面

```
<%
users.delete_if do |user|
  false
end
%> 
```

有效并且不会删除数组。

我可以在我的视图中以某种方式使用 delete_if 语句并且仍然能够插入 html 吗？

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-26T17:05:46.873

您根本不应该在视图中修改数据——而是在您的控制器或模型中执行此操作。仅使用视图来反映数据库的当前状态，而不是更改它。

如果您随后在其中任何一个地方使用您的代码的第二个版本，这个问题就会消失。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-27T01:34:00.133

忽略视图中的副作用方面，这就是*块*`%>`“返回”一个值的原因：在“ ”和“ ”之间有一个生成的打印语句作为 ERB 模板生成代码的一部分`<% end`。此生成的代码留下的任何值都将用作块中的最终语句/表达式，因此它的值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T00:52:33.850

我认为，如果您在第一种形式中使用“yield”，我将不得不对其进行测试，它会起作用。

```
<% users.delete_if do |user| %>
  <% yield false %>
<% end %> 
```

但是，正如第一张海报所说，您不应该更改视图中的数据。

# c# - 具有多个调用的构造函数链接

> ID：686601
> 
> 赞同：0
> 
> 时间：2009-03-26T16:43:14.837
> 
> 标签：c#, .net, constructor, chaining

鉴于下面的代码，第一个 WebTestingApp 构造函数可以在返回新实例之前调用第二个构造函数吗？我想在构造函数中设置一些只读字段，并且没有复制/粘贴，我看不出我怎么做。

我觉得答案与构造函数链接有关，但我不知道该怎么做，因为第二个 WebTestingApp 构造函数隐式调用 base() （这很重要，因为类的外部用户不应该有提供 IRemoteFile 和 IWebServiceGateway 实例）。

```
 internal WebTestingApp(Result result, BrowserApp browserApp, IRemoteFile remoteFile, IWebServiceGateway webServiceGateway) : base(remoteFile, webServiceGateway)
    {
        // TODO: Need to invoke WebTestingApp(Result result, BrowserApp browserApp)
    }

    public WebTestingApp(Result result, BrowserApp browserApp)
    {
        // Set readonly vars here
    } 
```

这是基类 TestingApp 的构造函数：

```
 protected TestingApp() : this(S3File.Instance, WebServiceGateway.Instance) { }

    internal TestingApp(IRemoteFile remoteFile, IWebServiceGateway webServiceGateway)
    {
        this.remoteFile = remoteFile;
        this.webServiceGateway = webServiceGateway;
    } 
```

WebTestingApp 派生自 TestingApp。S3File 和 WebServiceGateway 是单例。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T16:47:11.897

您可以像这样切换逻辑回合：

```
internal WebTestingApp(Result result, BrowserApp browserApp, IRemoteFile remoteFile, IWebServiceGateway webServiceGateway) : base(remoteFile, webServiceGateway)
{
    // Set readonly vars here
}

public WebTestingApp(Result result, BrowserApp browserApp) : this(result, browserApp, S3File.Instance, WebServiceGateway.Instance)
{
} 
```

这也不是一个完美的解决方案，因为它复制了对两个类中单例的调用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T16:57:49.000

抱歉，我想我可能已经找到了答案，通过切换它们并让第二个构造函数使用默认的 IRemoteFile 和 IWebServiceGateway 实例调用第一个构造函数，我可以将它们链接在一起并包含所有 4 个构造函数。

```
 internal WebTestingApp(Result result, BrowserApp browserApp, IRemoteFile remoteFile, IWebServiceGateway webServiceGateway) : base(remoteFile, webServiceGateway)
    {
        // Set readonly fields here
    }

    public WebTestingApp(Result result, BrowserApp browserApp) : this(result, browserApp, S3File.Instance, WebServiceGateway.Instance) {} 
```

# exception - Word Automation InvalidCastException RPC / COM 异常

> ID：686604
> 
> 赞同：2
> 
> 时间：2009-03-26T16:43:27.520
> 
> 标签：exception, com, automation, ms-word, rpc

我正在开发文字自动化应用程序，但遇到了意外的 RPC/COM 转换异常的严重问题

> [System.InvalidCastException: Nie można rzutować obiektu modelu COM typu 'System.__ComObject' na typ interfejsu 'Microsoft.Office.Interop.Word._Application'。Ta Operacja NiePowiodłaSićżpż威沃韦·莫德QueryInterface DLASkładnikaModelu Com Com C Com Com Com o IdentyFikatorze IID'{00020970-000000C46}'NiePowiodłoSięZPOWODUNASTęPUJİCOGŁęDU：Serwer RPC jestniedostępny。(Wyjątek od HRESULT: 0x800706BA)。]

从波兰语到英语的翻译：

> 无法将 System.__ComObject 转换为 Microsoft.Office.Interop.Word._Application。原因是 IID '{00020970-0000-0000-C000-000000000046}' 的 QueryInterface 失败 - RPC 服务器不可用 - 错误代码 HRESULT: 0x800706BA

这里是wordapp模块的简介：

初始化 - 用户登录后。

```
using Microsoft.Office.Interop.Word;

    public class WordApp       
    {
        Application app = null;
        object m = System.Reflection.Missing.Value; 
        object oFalse = false;  
        object oTrue = true; 
```

……

```
 app = Activator.CreateInstance(Type.GetTypeFromProgID("Word.Application.12")) as Application;
            app.Visible = false;
            app.DisplayAlerts = WdAlertLevel.wdAlertsNone;
            app.PrintPreview = false; 
```

我使用的是 Activator.CreateInstance 而不是 app = new Application() - 这里是[解释](http://support.microsoft.com/kb/244264)。

然后用户可以在 wordapp 模块中执行 2 个动作

a) 打印准备好的 docx 文档

```
 System.Windows.Forms.PrintDialog pd = new System.Windows.Forms.PrintDialog();
        ...

        this.app.ActivePrinter = pd.PrinterSettings.PrinterName;
        object oNumcopies = pd.PrinterSettings.Copies;
        object oRange = WdPrintOutRange.wdPrintAllDocument;
        object inputname = fullPath;
        Document doc = app.Documents.Add(
                              ref inputname,
                              ref m,
                              ref m,
                              ref m);
        try
        {
            // Print the document 
            doc.PrintOut(ref oFalse, ref oFalse, ref oRange,
                    ref m, ref m, ref m,
                    ref m, ref oNumcopies, ref m, ref m,
                    ref oFalse, ref m, ref m,
                    ref m, ref m, ref m, ref m,
                    ref m);
        }
        finally
        {
            doc.Close(ref oFalse, ref m, ref m);
            doc = null;
        } 
```

b) 将 docx 转换为 mht

```
 object inputname = docxname;
        object outputname = htmlname;
        object fileType = WdSaveFormat.wdFormatWebArchive;

        Document doc = app.Documents.Add( 
                              ref inputname,
                              ref m,
                              ref m,
                              ref m);
        try
        {
            doc.SaveAs(ref outputname, ref fileType,
                ref m, ref m, ref m, ref m, ref m, ref m, ref m,
                ref m, ref m, ref m, ref m, ref m, ref m, ref m);
        }
        finally
        {
            doc.Close(ref oFalse, ref m, ref m);
            doc = null;
        } 
```

当用户注销时，我释放单词实例：

```
 object oSaveChanges = WdSaveOptions.wdDoNotSaveChanges;
            app.Quit(
         ref oSaveChanges,
         ref m,
         ref m); 
```

异常会在随机位置抛出 - 但最常见的位置是 app.Documents.Add 附近。在该异常之后，无法 app.Quit。看来这个词实例已经死了。

我在事件日志（应用程序范围）中找到了那个东西：

> EventType offdiag12, P1 585d8a02-f370-4c04-85b6-fccad7e80459255ec053-6dbd-4a22-9e59-112a79de8c6a, P2 NIL, P3 NIL, P4 NIL, P5 NIL, P6 NIL, P7 NIL, P8 NIL, P9 NIL, P10 NIL。

我运行办公室诊断，它没有发现任何错误。

是否可以从系统中启用/查找更多错误信息？

这段代码在我的开发机器（vista）上运行得很好。该问题发生在客户机器上（通常是 winxp sp2/sp3）。

我的代码有错误还是什么？

我需要添加的唯一一件事。WordModule init/close/print 函数从主线程调用，savetomht 从 backgroundworkders 线程调用。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-27T05:08:14.173

您所描述的通常是指以下情况。您使用 COM out-proc 服务器（在单独的进程中实例化的 COM 对象，而不是在与您的程序相同的进程中），并且由于某种原因，COM 服务器遇到致命错误并意外终止。您使用的 COM 对象不再存在。由于 RPC 用于与 out-proc COM 服务器交互，并且服务器端在终止后不再存在，您会收到错误消息，指出 RPC 服务器不可用，这是真的，但看起来令人困惑。

您必须研究并消除COM服务器终止的原因。最可能的原因如下：

*   您传递给调用的一些不合理的输入值和
*   an unhandled exception in an event handler. If you have any handling for events fired from a COM component you should catch all the exceptions that may be thrown inside your handler and not let them propagate outside the handler.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T17:43:11.963

我不知道，但这里有一些基于一般经验的建议。您可能会尝试使用 distinct `m`s 而不是在所有参数之间共享一个（想法是，如果值在内部被弄乱，则可能会产生不可预测的结果）。您可能还想尽可能提供合理的值（而不是`m`s）。API 的某些版本可能比其他版本更宽容。

# visual-studio - Visual Studio 2008 不显示任何“过时”警告

> ID：686605
> 
> 赞同：3
> 
> 时间：2009-03-26T16:43:45.710
> 
> 标签：visual-studio, visual-studio-2008, .net-2.0, migration, .net-1.1

**重复：** [为什么在 C# 集合属性上调用属性时没有将其标记为过时？](https://stackoverflow.com/questions/577132/why-are-c-collection-properties-not-flagged-as-obsolete-when-calling-properties)

我刚刚使用 Visual Studio 2008 将 .NET 1.1 项目迁移到 .NET 2.0。我知道项目中有对过时方法的引用。

但是 Visual Studio 在构建后不会显示“过时”警告。构建成功并且仅显示来自分配了从未使用的值的成员的 3 个警告。当我删除这些成员时，根本没有任何警告。

我需要这些“过时”的警告

警告级别为 4（最大），警告已启用。

只有一个样本：

```
protected internal DataConnector()
{
    _connectionString = ConfigurationSettings.AppSettings["ProductConnectionString"];
} 
```

所有应该导致“过时”警告的引用都指向 .NET Framework 类的成员。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T16:49:20.847

调用过时方法的代码本身是否被标记为过时？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T16:49:21.127

在这里只是在黑暗中拍摄，但是在您正在参考的项目中使用过时的成员，并且当您构建它时实际上并没有重新构建该项目？如果有可能，我会尝试手动构建正在使用的项目，或者只是重建整个解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T16:55:25.120

确保您正在对项目进行完整构建，而不仅仅是增量构建。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-02T12:29:04.970

Jeff Yates 是对的，这是[为什么 C# 集合属性在调用它们的属性时没有标记为过时的重复？](https://stackoverflow.com/questions/577132/why-are-c-collection-properties-not-flagged-as-obsolete-when-calling-properties)

这是此处报告的 C# 3.5 编译器中的错误： [https ://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=417159](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=417159)

我检查了它：将 csc.exe 命令行从输出窗口复制到 cmd 控制台。当我将目录更改为 .NET 2.0 目录（使用 C# 2.0 编译器）时，它会显示警告。Microsoft 知道这个错误并在 C# 4.0 中修复了它，但不会在 3.5 版本中修复它。

# eclipse - 来自 Eclipse 的 svn 命令行

> ID：686611
> 
> 赞同：8
> 
> 时间：2009-03-26T16:45:40.887
> 
> 标签：eclipse, svn

您好，有没有办法从 Eclipse 中使用 svn 命令行？

在我的项目浏览器中的 Eclipse 中，我可以右键单击，然后单击团队，然后我有类似 svn 的东西。不确定是哪个插件。但它没有按钮，例如忽略上传文件。这就是为什么我想使用命令行。我的问题是如何做到这一点。

好的，那么我如何在 windows xp 的命令行中使用它呢？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-31T13:32:27.890

您可能使用的插件是[Subclipse](http://subclipse.tigris.org)。它应该有一个“添加到 svn:ignore”选项。如果没有，请尝试更新到最新版本的 Eclipse 和 Subclipse。一般来说 subclipse 应该足够了，不需要命令行。

对于 Windows XP，我推荐[Tortoise SVN](http://tortoisesvn.tigris.org)。它与 Windows 资源管理器集成，为您提供满足您所有需求的图形环境。我会说它比 subclipse 稳定得多，并且非常易于使用。

如果您确实想使用命令行工具，请从[此处](http://subversion.apache.org/packages.html)下载并安装 svn-win32 。命令行工具可能有助于合并和复制操作。

我还应该指出，这些方法都不会相互干扰。您可以使用 Tortoise SVN 或命令行，并且 subclipse 不会受到影响。所有 svn 客户端都通过从名为 .svn 的隐藏目录中写入和读取来工作。在源代码管理下的每个文件夹中都有一个这样的目录。只要 svn 客户端软件版本相同，一个 svn 客户端可以写入这些隐藏文件夹，另一个可以读取。如果其中一个客户端更新到使用不同协议写入 .svn 文件夹的版本，则可能会出现问题。在这种情况下，老客户将无法读取存储在那里的信息。将它们升级到最新版本将解决问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T16:56:39.877

不确定您要做什么；有时最好描述目标，而不是你计划实现它的方法。

你试过[Subeclipse](http://subclipse.tigris.org/)吗？它允许您在 Eclipse 中使用 SVN；这很棒。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T18:07:19.440

我不确定您是否可以*从*Eclipse 中使用它，但没有什么能阻止您*使用*它。从 cmd / xterm / 随便什么。无论如何，它不会干扰 Eclipse，也不会干扰 Subclipse（我假设您正在使用它）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T23:31:19.850

我正在使用 subclipse，一般来说效果很好。

但是，我想这是您的问题，默认情况下，团队同步想要添加我项目中的**所有**文件，而不仅仅是我添加到版本控制中的文件。这是蹩脚和令人沮丧的，显然没有办法将其关闭。*然而，旧*版本的屏幕截图暗示了关闭“功能”的可能性。令人沮丧！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-03-26T03:07:03.890

我个人不是 Subclipse 的粉丝——它让 IDE 的速度太慢了，不符合我的口味。这是使用外部工具和 TortoiseSVN 的替代方法

1.  创建一个新的外部工具
2.  称之为**SVN 提交**
3.  将位置设置为 \bin\TortoiseProc.exe（我的是 C:\Program Files\TortoiseSVN\bin\TortoiseProc.exe）
4.  将参数设置为**/command:commit /path:"${selected_resource_loc}"**
5.  打开您要提交的文件/目录并运行外部工具。

交换第四步中的**提交以获取其他命令。**您还可以将特定工具添加到收藏夹，并将它们放在工具栏上的下拉列表中。 [此处的其他参数](http://tortoisesvn.net/docs/nightly/TortoiseSVN_en/tsvn-cli-main.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-01T02:14:34.237

在这里并不打算太冒昧，但我认为您应该看看 Subversive 或 Subclipse 是否实际上以与您预期不同的方式解决了问题。例如，通过 Subclipse 很可能忽略签入的文件和目录。

另一方面，如果您真的想通过 Eclipse 的命令提示符进行破解，则必须安装[Target Management 项目](http://www.eclipse.org/dsdp/tm/)（支持 Eclipse Europa 和 Ganymede）。安装完成后，您可以在本地计算机上启动一个远程 shell，然后[在命令行上键入](http://dsdp.eclipse.org/help/latest/index.jsp?topic=/org.eclipse.rse.doc.user/gettingstarted/g_start.html):)。

PS：我从来没有使用过这种方法；Subversive 满足了我对 Eclipse 中 SVN 插件的所有要求。

# c# - TCP 客户端异步套接字回调

> ID：686618
> 
> 赞同：0
> 
> 时间：2009-03-26T16:46:44.317
> 
> 标签：c#, asynchronous, sockets, client

**请注意，问题是关于仅在套接字上使用异步回调模式**！

我想构建一个 TCP 客户端，它会在收到数据包以及关闭套接字时通知我，因为 NET 提供的 beginRecv、endRecv 功能不会通知连接是否仍然可用。

我的问题：有没有办法像使用 WinAPI 一样创建 TCP 客户端？

我的意思是使用消息调用 WSAAsyncSelect，当收到消息时，它会调用您在 WSAAsyncSelect 中调用的函数，然后您可以通过 WParams FD_CLOSE FD_READ FD_WRITE 查看连接是否已关闭或有新数据包。

如果没有。我不能同时控制我的连接和传入的数据包吗？我不想一直打电话给 BeginRecv EndRecv。-.-

提前致谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T16:53:48.743

你的问题不是很清楚。从你的问题的语气来看，你似乎不想做任何额外的工作。如果没有一些额外的工作，您将无法执行异步操作。

最好的方法是使用 Microsoft 的异步 API，使用 BeginReceive/EndReceive。这些将在套接字关闭时调用您的回调。但是，您不能通过这样做轻松地使用 .NET 中的 IO 流支持，因此会涉及一些额外的工作。

如果你想要更多的控制，你必须做更多的工作。这里的所有都是它的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T21:41:20.690

如果您传递一个包含对您的套接字的引用的状态对象，您将可以访问套接字本身。

```
public class SocketState
{
  public SocketState(Socket s)
  {
    this._socket = s;
  }

   private Socket _socket;
   public Socket Socket
   {
     get{return _socket;}
   }
}

void SomeFunction()
{
//do some stuff in your code

SocketState stateObject = new SocketState(mySocket);
mySocket.BeginReceive(buffer, offset, size, flags, CallBack, stateObject);
//do some other stuff
}

public void CallBack(IAsyncResult result)
{
  SocketState state = (SocketState)result.AsyncState;
  state.Socket.EndReceive(result);

  //do stuff with your socket.
  if(state.Socket.Available)
    mySocket.BeginReceive(buffer, offset, size, flags, CallBack, state);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T16:57:16.177

您还可以编写一个简单的线程版本来监视套接字并为您提供事件并调用回调。

[服务器类型代码](http://codeidol.com/csharp/csharp-network/Using-Threads/Using-Threads-in-a-Server/)

[简单的套接字代码](http://www.devarticles.com/c/a/C-Sharp/Network-Programming-in-C-sharp/1/)

# user-interface - 浏览器 UI 元素如何在手机平台上可用？

> ID：686622
> 
> 赞同：1
> 
> 时间：2009-03-26T16:47:42.957
> 
> 标签：user-interface, mobile, browser

我正在为高端手机设计一个网站，我想知道不同的 UI 元素（例如按钮、复选框、列表框、文本字段等）在不同的移动浏览器（例如 safari、webkit、IE）上的外观等）在不同的设备（例如诺基亚、iPhone 等）上。您能否提供一些建议，我如何无需购买设备或使用一些在线模拟器就可以访问这些？

此外，我不太清楚平台上可用的这些基本 UI 元素是如何工作的——移动浏览器是使用自己的 UI 元素还是从设备操作系统中获取 UI 元素并应用一些视觉样式（例如 safari 中的复选框看起来与桌面浏览器上的 IE 不同）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-12T20:38:07.983

You can download emulators for most platforms. Here are a couple:

Blackberry: [http://na.blackberry.com/eng/developers/resources/simulators.jsp](http://na.blackberry.com/eng/developers/resources/simulators.jsp)

Windows: [http://www.microsoft.com/downloads/details.aspx?FamilyId=C62D54A5-183A-4A1E-A7E2-CC500ED1F19A&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyId=C62D54A5-183A-4A1E-A7E2-CC500ED1F19A&displaylang=en)

Nokia: [http://www.forum.nokia.com/info/sw.nokia.com/id/d57da811-c7cf-48c8-995f-feb3bea36d11/Nokia_Mobile_Internet_Toolkit_4.1.html](http://www.forum.nokia.com/info/sw.nokia.com/id/d57da811-c7cf-48c8-995f-feb3bea36d11/Nokia_Mobile_Internet_Toolkit_4.1.html)

Just noticed that this was previously asked/answered here: [https://stackoverflow.com/questions/464089/simulators-emulators-for-mobile-browser-testing](https://stackoverflow.com/questions/464089/simulators-emulators-for-mobile-browser-testing)

# ruby-on-rails - Ruby on Rails：运行测试

> ID：686625
> 
> 赞同：8
> 
> 时间：2009-03-26T16:49:05.777
> 
> 标签：ruby-on-rails, unit-testing, testing

当我想运行所有单元测试时，我运行 rake test:units。为了运行我所有的功能测试，我运行 rake test:functionals。如果我想在一个文件中运行所有测试用例，我运行

ruby test/unit/username_test.rb

一些人一直在告诉我我应该运行 rake，例如

rake test:units TEST=test/unit/username_test.rb

对于运行测试，他们说我应该总是运行 rake。我知道如果我要测试所有单元测试，我应该运行 rake。但是，如果它只是一个文件或我正在测试的文件中的一种特定测试方法怎么办？我还应该使用耙子吗？两者有什么区别吗？在 ruby​​ 上运行 rake 有什么好处吗？运行 ruby​​ 而不是 rake 有什么缺点吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-26T17:29:40.157

可悲的是，两者并不相同。与直接运行测试相比，在 rake 下运行测试可能会从不同的地方拉取东西（当你的系统上有多个版本的 gem 等时，问题就更大了）。

目的是在 rake 下运行的测试应该在与 rails 产生的环境相匹配的环境中；我无法证明它们的匹配程度有多接近，但我看到直接运行时通过但通过 rake 或 rails 运行时失败的测试（反之亦然）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T17:34:21.003

至少在办理登机手续之前，我建议您跑去`rake`打所有东西，以确保没有任何意外发生。

普通 ruby​​ 似乎非常适合在迭代期间快速测试单个文件。

请注意，通过 rake 运行所有内容可能会产生与单独运行所有内容不同的结果，正如我最近发现的困惑 - 我在一个单独成功运行的测试中做了一些轻微的错误，但给后续测试留下了一个问题仅在我使用 rake 时出现。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T17:12:54.783

不，我不这么认为。Rake 似乎是运行所有测试、所有单元测试或所有功能/控制器测试的便捷方式。对于单个文件，我使用这种`ruby object_test.rb`方法.. 更短，并且适用于我的 rails home 项目。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-01-13T19:40:30.813

两者不一样。Rake 会做一些初步的测试加载。

目的是在 rake 下运行的测试应该在与 rails 产生的环境相匹配的环境中；

我注意到的一个区别是 rake 会发生一些夹具加载，这可能会被 ruby​​ 绕过。

我建议使用 rake，除非您使用 ruby​​ 命令行使用 -n 选项在文件中进行一项测试。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-04-11T19:10:21.240

它们应该是相同的。如果他们不是，你肯定做错了什么。

正如我在其他评论中所说，如果您的测试通过了其中一个，但在另一个中失败了，那么您做错了什么；这表明测试设置不佳，通常是由两种测试方法之间的不同测试运行顺序引起的；其中之一导致测试失败。

通常造成这种情况的原因是您没有使用事务和/或测试没有自行清理。例如，不正确地要求他们稍后测试的固定装置，而是依赖于预先存在的数据库状态。

您可以自由使用任何一种方法。如果出现问题，那么您在测试中做错了什么，您应该修复您的代码。

# c# - 静态泛型类作为字典

> ID：686630
> 
> 赞同：17
> 
> 时间：2009-03-26T16:50:13.480
> 
> 标签：c#, .net, generics, dictionary, clr

泛型类中的静态字段对于泛型参数的每个组合都有一个单独的值。因此它可以用作 Dictionary<Type,*不管*>

这比静态 Dictionary<Type,*不管*> 好还是坏？

换句话说，这些实现中哪一个更有效？

```
public static class MethodGen<TParam> {
    public static readonly Action<TParam> Method = CreateMethod();
    static Action<TParam> CreateMethod() { /*...*/ }
} 
```

或者，

```
public static class MethodGen {
    static readonly Dictionary<Type, Delegate> methods 
              = new Dictionary<Type, Delegate>();

    public static Action<T> GetMethod<T>() {
        //In production code, this would ReaderWriterLock

        Delegate method;
        if(!methods.TryGetValue(typeof(T), out method)
            methods.Add(typeof(t), method = CreateMethod<T>());
        return method;
    }

    static Action<T> CreateMethod<T>() { /*...*/ }
} 
```

具体来说，CLR 如何通过泛型类型参数查找静态字段？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-26T17:01:28.587

我喜欢以这种方式使用泛型类型。特别是，我经常为此目的使用私有嵌套泛型类。

我喜欢它的主要一点是，考虑到类型初始化的工作方式，很难*不*以这种方式进行初始化（就线程安全而言）。唯一的问题是如果初始化失败该怎么办——有时我会求助于记住一个异常来抛出第一次必要的访问，但这种情况很少见。

我不想猜测CLR*究竟是*如何通过类型参数查找类型的，但我很确定它会被优化以返回 :)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T17:05:15.347

我相信通用（第一个）版本会在编译时进行字典查找，因此在运行时执行得更好。

但是，它可能会使用更多内存。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T17:09:21.407

I haven't profiled it (which is the only way to really answer this question - the difference in performance may be so small as to be meaningless) but I would hazard a guess that the locking is the expensive part. The CLR does do the locking for you - and does so in a way defined by experts in this field! - so I expect if there is a difference, it would be in favour of using the language feature rather than building it yourself with `Dictionary` + locking.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T16:56:10.767

它不会为每个泛型类型参数存储值，因为它实际上创建（无论如何在概念上）N 个不同的类 - 一个用于您使用它的每种类型 T。

# linq-to-sql - 根据相关数据库列验证字符串长度

> ID：686633
> 
> 赞同：2
> 
> 时间：2009-03-26T16:50:35.773
> 
> 标签：linq-to-sql, tsql, language-agnostic, validation, schema

在我的 Web 应用程序的一端，我有一个存储大量文本的数据库表。

在中间，我有一个分离应用程序层的 API。

在另一端，我有一个由许多`TextBox`es（或`input type=text`表单元素，如果您愿意的话）组成的用户界面。

我需要 es 的`maxlength`属性`TextBox`与各种相关数据库表列中的最大字符串长度相同。我还想对我的 API 进行字符串长度验证。

当然我可以手动实现这一点，但是有没有人知道任何平台上的技术可以帮助自动设置任何部分？

在我的场景中，我使用的是 ASP.NET 3.5 WebForms、LINQ to SQL 和 SQL Server 2005。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T12:41:37.250

冒着根本不回答问题的风险......

您似乎有一条业务规则说“此特定字段最多应包含 N 个字符”。

我认为数据库列的大小和文本框的最大长度都是这个业务规则的独立结果。将一个与另一个固定在一起会混淆相关性和因果关系。

此外，通过检查数据库列的最大长度来执行此业务规则还有其他效果：

*   您每次都会访问数据库，否则可能是内存验证操作；

*   如果您的业务规则略有变化（例如：N 从 100 个字符变为 80 个字符），那么您需要进行模式级别的更改；

*   一些使用可变长度字符编码（如 UTF8）的数据库只能模糊定义给定列中甚至可以容纳多少个字符；

*   更广泛地说，您将业务规则与实现工件耦合——如果您以后决定使用对象数据库怎么办？

我并不是建议您不要明智地调整数据库列的大小（您应该），只是将业务规则与数据库实现分离。如果您可以在应用程序代码中进行简单的固定长度检查，我会建议您这样做。

**编辑**更仔细地阅读了您的问题，对于您的文本字段最大长度，您在验证之前需要 N 。尽管如此，这仍然是一个业务规则——你能`MaximumLength`为你的字段访问器编写一个属性并询问它吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T16:55:36.680

我知道您要的是 SQL Server，但在 MYSQL 中，您可以从

```
SELECT * FROM information_schema.`COLUMNS` C; 
```

在那里，您可以看到一个 CHARACTER_MAXIMUM_LENGTH 字段，它可以准确地为您提供所需的内容。

我相信你可以为 SQL Server 找到类似的东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-29T17:13:52.493

我认为没有任何开箱即用的解决方案。但是，您可以轻松地在文本框的 MaxLength 属性中添加特殊格式的注释，例如

```
<asp:TextBox runat="server" MaxLength="<%--<TABLENAME>.<COLUMNNAME>--%>" /> 
```

然后，您可以编写另一个程序或 VS 宏来检查您的 aspx 文件并将 MaxLength 设置为该列的长度，以便它变为。

```
<asp:TextBox runat="server" MaxLength="20<%--<TABLENAME>.<COLUMNNAME>--%>" /> 
```

您可以在添加新字段或更改列大小等时运行此程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T16:51:54.083

通常，您可以从数据库请求架构信息以找出给定列的最大长度。

看看 SqlDataReader.GetSchemaTable()。它将返回每列的列大小（以及许多其他数据）。调用 Make ExecuteReader() 时将行为参数设置为 KeyInfo。

另一种方法是直接在sql server中查询数据字典。已经有一段时间了，但我认为 sys （可能是 sys.columns ）中的某些内容会包含您正在寻找的信息。

然后您可以更新文本框属性。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T16:59:41.880

在 SQL Server 2005（可能还有 2000 和 2008，尽管我没有测试过）中，您可以使用以下查询来查找`varchar`给定表名和列名的字段长度：

```
select 
    t.name TableName,
    c.name ColumnName,
    c.max_length ColumnSize
from sys.columns c
inner join sys.tables t on (c.object_id = t.object_id)
where t.name = 'MyTableName'
    and c.name = 'MyFieldName' 
```

中的`max_length`字段`sys.columns`将为您提供文本表单输入字段所需的内容。

我意识到这并不能回答您通过 API 实现这一点的问题，它应该让您上路。

# rest - SOAP - 有什么意义？

> ID：686634
> 
> 赞同：53
> 
> 时间：2009-03-26T16:50:42.777
> 
> 标签：rest, soap

我的意思是，真的，SOAP 的意义何在？

Web 服务已经存在了一段时间，并且有一段时间似乎“SOAP”和“Web 服务”这两个术语在很大程度上可以互换。然而 SOAP 对我来说总是显得笨重且过于复杂。

然后 REST 出现了，Web 服务突然变得有意义。

正如 Joel Spolsky 所说，给程序员一个 REST URL，他们可以立即开始使用该服务，弄清楚它。

SOAP 在 WSDL 和大量冗长的 XML 后面被混淆了，尽管它是基于 Web 的，但您无法做任何像使用 Web 浏览器访问 SOAP 服务这样简单的事情。

所以我的问题的本质是：

*   是否有充分的理由选择 SOAP 而不是 REST？
*   您现在正在使用 SOAP 吗？如果接口是REST会更好吗？
*   我错了吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-26T17:20:00.960

> 正如 Joel Spolsky 所说，给程序员一个 REST URL，他们可以立即开始使用该服务，弄清楚它。

而如果服务有一个明确的、机器可读的合同，那么程序员就不必浪费任何时间来弄清楚它。

（并不是说 WSDL/SOAP 一定是一个很好地实现明确指定的合同的例子，但这就是 WSDL 的重点）

最初，SOAP 是一个简单的协议，它允许您向消息添加标头，并且具有对象实例到 XML 结构的标准化映射。将处理元数据放入消息中简化了客户端代码，这意味着您可以非常简单地持久化和排队消息。

当我在 2001 年构建 SOAP 服务时，我从不需要标头处理细节。这是 WSDL 之前的版本，然后使用 GET 获取信息和查询是正常的（与大多数声称是 REST 的应用程序没有什么不同；REST 有更多在使用超链接进行服务发现方面）和带有 SOAP 有效负载的 POST 来执行操作。那些创建资源的动作会将创建的资源的 URL 返回给客户端，然后客户端可以 GET 资源。我认为事实上，WSDL 使得只考虑 RPC 而不是创建资源的操作使 SOAP 失去作用变得容易。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-26T16:56:07.553

这个话题在[为什么肥皂被认为是厚](https://stackoverflow.com/questions/676123/why-is-http-soap-considered-to-be-thick)的中得到了很好的讨论。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-26T16:56:34.993

在我看来，SOAP 可能更“灵活”，但结果就是太复杂了（您提到了 WSDL，这对我个人来说始终是一个绊脚石）。

我**得到**了休息。很**简单**。我可能看到的唯一缺点是您将自己限制在针对单个资源的这 4 个基本操作中，这可能不完全适合您查看数据的方式。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-27T09:53:09.247

在做一些研究以了解这里的一些答案（尤其是约翰桑德斯）时，我发现这篇文章[http://harmful.cat-v.org/software/xml/soap/simple](http://harmful.cat-v.org/software/xml/soap/simple) SOAP 比我想象的更疯狂......

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-26T16:56:32.107

WSDL 的重点是自动发现。这个想法是您不必编写客户端代码，它将自动生成。

顺便提一句。超越 WSDL 的下一步是[语义 Web 服务](http://en.wikipedia.org/wiki/Semantic_Web_Services)。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-26T17:52:00.697

如果不需要 WS-* 系列协议的特性；如果您不需要自我描述服务；如果您的服务不能完全描述为 HTTP 协议所定义的资源；如果您不喜欢为与服务的每次交互都编写 XML，然后再对其进行解析；那么你需要 SOAP。

否则，当然，使用 REST。

* * *

关于自我描述服务的价值存在一些问题。当我想像任何人都无法理解这一点时，我的想象力让我失望。那在我身上。尽管如此，我不得不认为，任何曾经使用过比“Hello, world”复杂得多的服务的人都会知道为什么让其他人编写接受参数的代码、创建要发送到服务的 XML、发送它，接收响应，然后将其转换回对象。

现在，我想在使用 RESTful 服务时这可能不是必需的；至少不能使用不处理复杂对象的 RESTful 服务。即使使用像[http://www.earthtools.org/webservices.htm](http://www.earthtools.org/webservices.htm)这样相对简单的服务（我已将其用作调用 RESTful 服务的示例），了解返回数据的结构也会从中受益。甚至上述服务也提供了一个 XML 模式——遗憾的是它没有描述整个响应。鉴于该模式，仍然必须手动处理 XML，或者使用一种工具从模式中生成可序列化的类。

当服务在 WSDL 中描述并且您使用 Visual Studio 中的“添加服务引用”或 svcutil.exe 程序或 I-forget-what-the-command-is- 之类的工具时，所有这一切都会发生在您身上在日食中。

如果您需要示例，请从[EarthTools](http://www.earthtools.org/webservices.htm)服务开始，然后继续使用具有更复杂消息传递的任何其他服务。

顺便说一句，需要自我描述的另一件事是描述服务支持的消息传递模式和协议。当唯一的选择是 HTTP 动词而不是 HTTP 或 HTTPS 时，可能不需要这样做。如果您使用 WS-Security 和朋友，生活会变得更加复杂。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-07-04T07:13:22.347

我发现当企业现成 (COTS) 软件很可能使用服务时，SOAP 最适合。由于 SOAP/WSDL 采用了明确指定的契约，大多数 COTS 包都内置了使用此类服务​​的功能。这可以使 BPM/工作流工具等轻松使用已定义的服务而无需定制。除了那个服务用例之外，REST 往往是我的应用程序的 goto Web 服务实现。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-01-11T15:06:00.653

现在看来，[WSI](http://en.wikipedia.org/wiki/Web_Services_Interoperability)同意 SOAP 不再有意义，因为他们已宣布将不再作为独立实体存在。

关于公告的有趣文章和一些评论：http: [//blogs.computerworlduk.com/simon-says/2010/11/the-end-of-the-road-for-web-services/index.htm](http://blogs.computerworlduk.com/simon-says/2010/11/the-end-of-the-road-for-web-services/index.htm)

编辑为完全准确以回应约翰桑德斯。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-07-04T06:18:51.873

我认为 SOAP 吸引了 Java 和 .net 人群，他们可能更熟悉旧的 CORBA 和 COM，而不太熟悉 Internet 技术。

REST 也有一个主要缺点：关于如何实际实现这样一个系统的指导很少。您会发现在设计了多少公共 RESTful API 方面存在显着差异。事实上，许多违反了 REST 的关键方面（例如使用 GET 进行操作或使用 POST 进行检索），并且在基本用法上存在分歧（POST/GET 与 POST/GET/PUT/DELETE）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-26T16:59:16.313

> 我错了吗？

“你没有错，沃尔特，你只是…… :)”

> 是否有充分的理由选择 SOAP 而不是 REST？

SOAP，据我了解，遵守合同，因此可以进行类型检查。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-10-05T08:05:01.457

SOAP 是一种轻量级的基于 XML 的结构化协议规范，用于实现服务。它用于在分散的分布式环境中交换结构化信息。SOAP 使用 XML 技术通过任何传输层协议交换信息。它独立于任何特定的编程模型和其他实现特定的语义。了解有关 XML SOAP 消息传递框架的更多信息

1) 可扩展的基于 XML 的消息传递框架：简单性仍然是 SOAP 的主要设计目标之一。SOAP 定义了一个通信框架，允许稍后将诸如安全性、路由和可靠性等特性添加为分层扩展

2) 互操作性：SOAP 可用于任何传输协议，例如 TCP、HTTP、SMTP。如今，SOAP 为 HTTP 提供了显式绑定。

3) 独立：SOAP 允许任何编程模型，并且不依赖于远程过程调用 (RPC)。SOAP 定义了一种用于处理单个单向消息的模型。SOAP 还允许任意数量的消息交换模式 (MEP)。了解有关[SOAP的更多信息](http://www.mssql-dotnetservices.com/2016/07/soap.html)

# java - 我的 applicationContext 中是否可以有多个 PropertyPlaceHolderConfigurer？

> ID：686635
> 
> 赞同：61
> 
> 时间：2009-03-26T16:50:45.147
> 
> 标签：java, spring

`applicationContext.xml`我需要根据给定的系统属性加载特定的文件。这本身会加载具有实际配置的文件。因此我需要两个`PropertyPlaceHolderConfigurer`，一个解决系统参数，另一个在实际配置中。

任何想法如何做到这一点？

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2009-03-27T02:47:05.637

是的，你可以做不止一个。请务必设置[ignoreUnresolvablePlaceholders](http://static.springframework.org/spring/docs/2.5.x/api/org/springframework/beans/factory/config/PropertyPlaceholderConfigurer.html#setIgnoreUnresolvablePlaceholders(boolean))以便第一个将忽略它无法解析的任何占位符。

```
<bean id="ppConfig1" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
   <property name="ignoreUnresolvablePlaceholders" value="true"/>
   <property name="locations">
    <list>
             <value>classpath*:/my.properties</value>
    </list>
  </property>
</bean>

<bean id="ppConfig2" class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
   <property name="ignoreUnresolvablePlaceholders" value="false"/>
   <property name="locations">
    <list>
             <value>classpath*:/myOther.properties</value>
    </list>
  </property>
</bean> 
```

根据您的应用程序，您应该研究 systemPropertiesMode，它允许您从文件加载属性，但如果设置，则允许系统属性覆盖属性文件中的值。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-09-24T18:20:28.080

当心 - 可能存在与多个配置器相关的错误。有关更多详细信息，请参阅[http://jira.spring.io/browse/SPR-5719](http://jira.spring.io/browse/SPR-5719)。

我无法让多个人在本地工作……但我还没有责怪任何人，除了我自己。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-02-28T09:30:32.463

另一种解决方案是使用 PropertyPlaceholderConfigurer 的 placeholderPrefix 属性。您为第二个（第三个，第四个......）配置器指定它，然后为所有相应的占位符添加前缀，因此不会有冲突。

```
<bean id="mySecondConfigurer"
        class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"
        p:location="classpath:/myprops.properties" 
        p:placeholderPrefix="myprefix-"/>

<bean class="com.mycompany.MyClass" p:myprop="${myprefix-value.from.myprops}"/> 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-08-14T18:15:55.897

您不能直接执行此操作，Spring 的这个 JIRA 问题解释了原因（查看 Chris Beams 的评论以获得详细解释）：

[https://jira.springsource.org/browse/SPR-6428](https://jira.springsource.org/browse/SPR-6428)

但是，他确实提供了使用 Spring 3.1 或更高版本的解决方法，即使用 PropertySourcesPlaceholderConfigurer 类而不是 PropertyPlaceholderConfigurer 类。

您可以从 Spring 框架问题 github 下载一个基于 Maven 的项目来演示该问题和解决方案：

[https://github.com/SpringSource/spring-framework-issues](https://github.com/SpringSource/spring-framework-issues)

在下载的项目中查找问题编号 SPR-6428。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-04-24T13:00:57.950

在我自己方面，使用 PropertyPlaceholderConfigurer 两个属性：

*   顺序（对于第一次访问/解析的 PPC 应该更低）
*   ignoreUnresolvablePlaceholders（第一次访问/解析的 PPC 为“false”，下一个为“true”）

*   并为两个 PPC 提供 2 个不同的 id（以避免一个被另一个覆盖）

完美运行

希望能帮助到你

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-12-06T19:20:46.573

我们有以下工作方法：

```
<util:properties id="defaultProperties">
    <prop key="stand.name">DEV</prop>
    <prop key="host">localhost</prop>
</util:properties>
<context:property-placeholder 
    location="file:${app.properties.path:app.properties}" 
    properties-ref="defaultProperties"/> 
```

系统属性`app.properties.path`可用于覆盖配置文件的路径。

并且应用程序捆绑了一些占位符的默认值，这些默认值无法在通用模块中使用默认值定义。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-02-08T07:37:26.363

只需提供 2 个不同的 id 对我有用。我正在使用弹簧 3.0.4。

希望有帮助。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-07-22T18:15:53.360

万一，您需要定义两个 PPC（就像我的情况一样）并独立使用它们。通过设置属性***placeholderPrefix***，您可以从所需的 PPC 中检索值。当两组 PPC 的属性具有相同的键时，这将很方便，如果您不使用它，ppc2 的属性将覆盖 ppc1。

定义你的xml：

```
<bean name="ppc1"
    class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <property name="properties" ref="ref to your props1" />
        <property name="placeholderPrefix" value="$prefix1-{" />
    </bean>
<bean name="ppc2"
    class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <property name="properties" ref="ref to your props2" />
        <property name="placeholderPrefix" value="$prefix2-{" />
    </bean> 
```

在运行时检索：

```
@Value(value = "$prefix1-{name}")
private String myPropValue1;

@Value(value = "$prefix2-{name}")
private String myPropValue2; 
```

# image - 使用存储过程的水晶报告中没有图像

> ID：686639
> 
> 赞同：0
> 
> 时间：2009-03-26T16:51:12.947
> 
> 标签：image, crystal-reports, report

我在该应用程序上有一个在 asp.net 2.0 中的 web 应用程序，我正在使用水晶报表显示来自 oracle 数据库的图像。在该报告上，我使用带有存储过程的数据集 xsd 在水晶报告中显示数据。但问题是，当我使用存储过程时，如果我使用简单的 sql，则图像不会显示在报告中，以防图像出现在报告中。

请给我解决方案

谢谢， 普拉杜特

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-10-23T20:02:38.820

Crystal Reports 并不真正支持 .GIF 图像；只有当它们是 .JPG 或 .PNG 格式时，我才能使用存储过程在报告中显示它们。把图片格式改成.JPG，重新存入数据库试试。！

# google-analytics - 谷歌分析，为什么有两个脚本块？

> ID：686640
> 
> 赞同：10
> 
> 时间：2009-03-26T16:51:28.140
> 
> 标签：google-analytics, javascript

为什么我添加到网页的 Google Analytics 脚本需要分成两个脚本块？

```
<script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-xxxxxxx-xx");
        pageTracker._trackPageview();
    } catch (err) { } 
</script> 
```

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-26T16:55:22.687

上面引用中的第一个脚本将一个新的`<script>`加载标签写入文档。第二个块具有由动态编写的脚本标记加载的依赖项，因此浏览器必须有机会在第二个块运行之前加载和解析脚本。如果一切都在一个块中，则脚本加载将在第一个脚本部分结束之前进行。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-12-04T22:47:46.410

您现在可能希望使用[Google Analytics](http://googlecode.blogspot.com/2009/12/google-analytics-launches-asynchronous.html)的最新更新。这提供了性能改进，增强了数据收集并防止了跟踪代码错误。

# javascript - ASP.NET MVC Ajax.ActionLink

> ID：686644
> 
> 赞同：2
> 
> 时间：2009-03-26T16:52:05.910
> 
> 标签：javascript, ajax, asp.net-mvc

当我单击显示局部视图的 Ajax.ActionLink 时，为什么与局部视图关联的 javascritp 都没有触发？在我使用 Html.ActionLink 之前，这一切都有效。我在母版页中引用了一系列脚本，其中包括 $document.Ready 函数。我也尝试将脚本添加到部分视图中，但它们仍然没有触发。有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-09-30T14:49:15.617

动态加载到 div 中的 javascript 代码不会被识别为可执行代码。

将代码放在单独的 .js 文件中的函数中，将其加载到您的 site.master 并通过添加

```
new AjaxOptions { oncomplete="myJavascriptFunction" } 
```

到你的 Ajax.Actionlink

# asp.net - 用户控件上的 SkinID

> ID：686646
> 
> 赞同：0
> 
> 时间：2009-03-26T16:52:32.337
> 
> 标签：asp.net, user-controls, themes, skin

我创建了一个用户控件（自定义按钮控件），如何在该控件上应用皮肤。在皮肤文件中写什么，例如我将写的 asp:button `<asp:button SkinID ="btnSkinBlue" runat = "server"/>`。

为用户控件写什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T20:10:17.320

我没有使用带有 Web 自定义控件的皮肤，但我希望它能够像这样工作：

在 aspx 上：

```
<yourTag:CustomButton SkinID ="btnSkinBlue" runat = "server"/> 
```

在皮肤文件上：

```
<yourTag:CustomButton SkinID ="btnSkinBlue" runat = "server" CssClass="someclass" /> 
```

在皮肤文件中，对于默认值：

```
<yourTag:CustomButton runat = "server" CssClass="defaultClass" /> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-30T14:21:59.170

我们需要注册标签 <%@ Register Src="../../UserControls/RoundedButton.ascx" TagName="RoundedButton" TagPrefix="ttl" %>

# tsql - 只选择一半的记录

> ID：686648
> 
> 赞同：9
> 
> 时间：2009-03-26T16:53:40.413
> 
> 标签：tsql

我试图弄清楚如何选择 ID 为空的一半记录。我想要一半，因为我将使用该结果集来更新另一个 ID 字段。然后，我将使用该 ID 字段的另一个值更新其余部分。

所以基本上我想用一个数字更新一半的记录 someFieldID ，其余的用另一个数字将更新基本上分为我要更新的字段的 someFieldID 的两个值。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-26T16:58:26.923

在 oracle 中，您可以使用 ROWNUM 伪列。我相信在 sql server 中你可以使用 TOP。例子：

```
select TOP 50 PERCENT * from table 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-26T16:59:46.890

您可以按百分比选择：

```
 SELECT TOP 50 PERCENT *fields* FROM YourTable WHERE ... 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-26T17:01:12.720

```
update x set id=@value from (select top 50 percent * from table where id is null) x 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-18T17:18:16.683

以下 SQL 将返回表前半部分的 col_ids。

```
SELECT col_id FROM table
WHERE rownum <= (SELECT count(col_id)/2 FROM table); 
```

如果 col_ids 的总数是奇数，那么您将得到前半部分 - 1。这是因为，例如，我们有 51 条记录，count(col_id)/2 返回 25.5，因为没有 rownum 等于对于这个结果，我们得到等于 25 及以下的所有值。这意味着其他 26 个不会被退回。

但是，我还没有看到相反的语句起作用：

```
SELECT col_id FROM table
WHERE rownum > (SELECT count(col_id)/2 FROM table); 
```

所以如果你想要表的另一半，你可以将第一个结果存储到一个临时表中，我们称之为 TABLE_A。然后只需在该表的原始表上执行 MINUS ：

`SELECT col_id FROM table`
减
`SELECT col_id FROM table_a`

希望这可以帮助某人。

# windows-mobile - 检测 Compact Framewok 是否安装在移动设备上

> ID：686651
> 
> 赞同：2
> 
> 时间：2009-03-26T16:54:05.030
> 
> 标签：windows-mobile, compact-framework, mobile, embedded

我使用 .net 紧凑框架编写了一个应用程序。要求之一是在应用程序运行之前运行检查以查看是否安装了紧凑框架。如果不是，我应该向他们提示并将他们重定向到 cf 下载位置。

什么是最好的最常见的方法来做到这一点。显然，如果未安装 .net cf，我的 .net 将不会首先运行，我需要在 eVc++ 中编写它吗？

非常感谢您对托尼的想法

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T07:11:26.420

[这](http://msdn.microsoft.com/en-us/library/aa446531.aspx)是一篇关于创建检测和更新 .NET Compact Framework（如果需要）的 MSI 包的 MSDN 文章。它已经很老了，但原则仍然适用。您需要编写一个将在手机中运行的 dll。您首先搜索紧凑框架的 dll 文件，然后您可以从注册表项中获取版本。您还可以检测设备类型并安装适当的紧凑框架 cab 文件。

如果你想用 cab 文件来做，过程还是一样的。请参阅此[链接](http://msdn.microsoft.com/en-us/library/aa924308.aspx)，了解如何从 cab 文件运行设置 dll。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-04-09T11:48:31.913

还可以查看[Mobile Packager](http://www.mobilepackager.com)。我们已经使用它来捆绑多个 CAB 部署，包括 .NET 紧凑框架，并且仅在尚未安装时才安装它。

# zend-framework - 在 Zend_Form 中设置标签的 id

> ID：686666
> 
> 赞同：2
> 
> 时间：2009-03-26T16:56:43.840
> 
> 标签：zend-framework, zend-form, zend-form-element

我正在尝试为我的表单标签之一设置一个 id，以便以后可以用 jquery 隐藏它。这是我的元素：

```
$password = new Zend_Form_Element_Password('password');
$password->setLabel('Password:')
    ->setRequired(true)
    ->addFilter('StripTags')
    ->addFilter('StringTrim')
    ->addValidator('NotEmpty')
    ->setAttrib( "id", "password" ); 
```

在源代码中，它看起来像这样：

```
<dt>
<label for="password" class="required">Password:</label>
</dt>

<dd>
<input type="password" name="password" id="password" value="">
</dd> 
```

我需要标签看起来像：

```
<label id="pass_label" for="password" class="required">Password:</label> 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T17:45:11.320

使用装饰器似乎无法更改标签的 id，但您可以轻松添加类名

```
$decorators = array(
        array('ViewHelper'),
        array('Errors'),
        array('Description', array('tag' => 'p', 'class' => 'description')),
        array('HtmlTag', array('tag' => 'dd')),
        array('Label', array('tag' => 'dt', 'class' => 'pass_label')),
    );

    $password->setDecorators($decorators); 
```

这导致

```
<label class="pass_label optional" for="password">Password</label> 
```

我尝试以相同的方式设置 id，但这不起作用。如果您将 id 作为选项数组传入，这会更改“for”属性的值

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-05-07T15:36:51.713

我知道我迟到了，但如果你想使用 jQuery 隐藏它，你可以根据 for 属性进行选择，如下所示：

```
$('label[for="password"]').hide(); 
```

应该做的伎俩。根据 jQuery 的版本，您可能需要也可能不需要 @ 在属性之前，如下所示：

```
$('label[@for="password"]').hide(); 
```

# wcf - WCF:NetworkCredential 和 Impersonation 之间的关系

> ID：686675
> 
> 赞同：2
> 
> 时间：2009-03-26T16:59:09.777
> 
> 标签：wcf, impersonation

我在集成模式下的默认应用程序池中托管在 IIS 7 中的 WCF 服务，禁用匿名访问并启用 Windows 身份验证。

我在我的接口的方法实现中添加了以下属性。

```
[OperationBehavior(Impersonation = ImpersonationOption.Required)] 
```

如果我在调用我的服务时不提供网络凭据，我会得到预期的行为，因为以下情况属实：

ServiceSecurityContext.Current.WindowsIdentity.Name = myDomain\myUser
ServiceSecurityContext.Current.PrimaryIdentity.Name = myDomain\myUser
Thread.CurrentPrincipal.Identity.Name = myDomain\myUser
我可以使用 SSPI 和 myDomain\myUser 身份验证连接到远程系统上的数据库.
WindowsIdentity.GetCurrent().Name = myDomain\myUser
我可以使用 Thread.CurrentPrincipal.IsInRole() 来验证用户是否处于角色中。
我可以使用 WindowsIdentity.GetCurrent().Groups 来检索用户的组列表。

但是，如果我使用以下内容提供网络凭据：

```
var networkCredential = new NetworkCredential(user, pwd, dom);
base.ClientCredentials.Windows.ClientCredential = networkCredential;
base.ClientCredentials.Windows.AllowNtlm = true;      
base.ClientCredentials.Windows.AllowedImpersonationLevel 
          = System.Security.Principal.TokenImpersonationLevel.Delegation; 
```

那么以上所有内容都是相同的，除了数据库连接和列出的两个组不同。正在使用 NT Authority\Anonymous 登录用户连接到数据库。使用 NetworkCredentials 将用户置于 NT Authority\Network 组而不是 NT Authority\Interactive 中，此外还删除了 LOCAL 组。

我的目标是使用 NetworkCredential 传递的凭据建立与数据库的连接，任何建议都将不胜感激。

肖恩持有人

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T18:18:13.003

听起来像是典型的双跳问题。

我猜在您的工作场景中，默认情况下会使用 Kerberos，这将为您提供远程服务器上的委托令牌。

在第二种情况下，由于提供了用户/通行证，它不使用 Kerberos，并且不支持获取委托令牌。

我知道的在远程服务器上获取委托令牌的唯一其他方法是使用基本身份验证（使用 SSL），这完全是一种痛苦。

[关于凭证双跳问题](http://blogs.msdn.com/nunos/archive/2004/03/12/88468.aspx)

# asp.net - URL 重写从 /default.aspx 到 /

> ID：686681
> 
> 赞同：14
> 
> 时间：2009-03-26T16:59:49.167
> 
> 标签：asp.net, iis-6, urlrewriting.net

我在 IIS 6 中使用 URL Rewriting.NET 工具。我在 IIS 中为 default.aspx 设置了默认页面内容。我想要做的是让 /default.aspx 提供一个 301 重定向到根目录（www.example.com/default.aspx -> www.example.com）。我试过关闭默认文档，但无济于事。

我希望做的是使用几个 URL Rewriting.NET 规则来实现这个目标。有什么想法吗？

编辑：

对不起，我忘了澄清。如果我在默认文档打开的情况下从 /default.aspx 重定向到 /（我想让它们保持打开状态），那么我会得到一个无限循环的 default -> / -> default

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-06-02T15:16:30.533

最后，我最终使用了带有 URL 重写模块的 IIS 7，它允许您正确地执行此重定向。

编辑 ：

规则是

```
<rule name="Default Redirect" stopProcessing="true">
    <match url="^default\.aspx$" />
    <action type="Redirect" url="/" redirectType="Permanent" />
</rule> 
```

您可以为每个文件夹使用单独的规则，也可以使用

```
<rule name="All Redirect">
    <match url="^(.*\/)*default\.aspx$" />
    <action type="Rewrite" url="{R:1}" />
</rule> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-11-28T01:07:24.557

不久前，我在试图弄清楚为什么某些 IIS 安装可以重定向 /default.aspx 并且某些会退化为终端循环时遇到了这个问题。

我发现答案是 asp.net 是否被“通配符”映射为在 IIS 中运行所有请求。

简而言之，如果您有一个开箱即用的 IIS 设置，它将始终将默认文档附加到对站点根目录的任何请求中。因此，当您在 ASP.NET 中检查 Request.Url 时，example.com 变为 example.com/default.aspx。因此，如果您检测到这种情况并尝试重定向并返回到 example.com，IIS 会这样做，附加 /default.aspx 并且您的代码会陷入它自己制作的循环中。

例外情况是，如果您设置通配符映射，以便通过 asp.net 管道处理所有请求。在这种情况下，IIS 不再将默认文档附加到 Request.Url 级别的每个请求中。因此，您可以进行重定向。

我把它全部放在这篇博文中：[301 Redirecting from /default.aspx to the site root - 最后一句话](http://www.ifinity.com.au/Blog/EntryId/45/301-Redirecting-from-default-aspx-to-the-site-root-the-final-word)- 但这是几年前写的，IIS7 中的更改可能已经解决了这个问题，正如当前接受的答案所提供的那样。

但是，如果您正在与这个问题作斗争，那么查看通配符映射状态是正确的起点。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-07-14T20:47:51.590

我有同样的问题。对于那些想知道为什么有人想要这样做的人来说，这是 SEO 的问题。如果谷歌索引你的主页最后有和没有 default.aspx，PageRank 和链接流行度将在两个 URL 之间分开。现在，如果您遇到此问题，并且您能够合并这两个 URL，那么您可能会在搜索排名中得到提升。要记住的另一件事是，如果您遇到麻烦，您必须使用 301 重定向让 Google 在两个 URL 之间合并他们的索引。否则你的努力将是徒劳的。

这有点太晚了，因为您已经通过升级到 IIS7 解决了这个问题。但我只想补充一点，我为 IIS6 提出的解决这个问题的唯一方法是添加一个 ISAPI 过滤器。

我在这里记录了完整的解决方案... [http://swortham.blogspot.com/2008/12/redirecting-default-page-defaultaspx-to.html](http://swortham.blogspot.com/2008/12/redirecting-default-page-defaultaspx-to.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T11:53:15.417

如果我理解正确，您不想在有人进入包含该文档的文件夹时显示“default.aspx”。

因此，如果他们确实击中了它，您想自动重定向到“/”并加载默认文档吗？

如果是这种情况，那么如上所述，您将面临无限循环的风险。第二条评论给了你一个答案，但我想将它扩展到重写引擎你想要的是：

关闭默认文档向重写引擎注册每个文件夹当请求该文件夹时，根据您的目标规则加载 default.aspx 文件

这听起来对吗？

我不得不问，你为什么要这样做？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T17:06:04.363

我不确定我是否理解问题所在。

尽管如果您关闭默认文档，那么 / 将只是指向目录而不是 default.aspx 页面。

保留默认文档并根据 default.aspx 是否在请求的 url 中进行重定向。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-21T00:54:14.307

那么你可以使用常规的.net来检查httprequest url，如果它有“default.aspx”，你可以重定向到“/”，不会有无限循环，你最好在预加载时这样做，然后结束响应，尽量减少处理时间

# .net - 嵌入 Python 脚本

> ID：686690
> 
> 赞同：1
> 
> 时间：2009-03-26T17:01:42.017
> 
> 标签：.net, python, vb.net, visual-studio, deployment

我有一些 Python 脚本，我想从我的 VB.NET 类库中使用它们，但是可以将脚本嵌入到 Visual Studio 中的项目/dll 中，然后运行脚本，而不是增加我分发的文件数量我的程序运行时的dll？

谢谢你的帮助。

抢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T17:06:51.023

[是的，这是可能的](http://docs.python.org/extending/embedding.html)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T17:28:15.777

我相信你可能[正在寻找这个](http://www.vb-helper.com/howto_net_embedded_resources.html)，但我不确定。然而，这是可能的。

上面的链接向您展示了如何将文件/脚本添加为嵌入式资源。如果这不是您所追求的，[vartec 的帖子](https://stackoverflow.com/questions/686690/embed-python-script/686705#686705)描述了如何直接嵌入 python 运行时。

# ruby-on-rails - activeresource 错误状态和响应正文

> ID：686691
> 
> 赞同：2
> 
> 时间：2009-03-26T17:01:42.203
> 
> 标签：ruby-on-rails, activeresource

我正在对服务进行 activeresource 调用，并且我想要一些自定义错误消息作为反馈。我有一些不是正常模型验证的验证，所以我不能只返回@object.errors。

因此，例如，我的验证之一就是这个。两个对象具有多对多关系，但我想将一个对象限制为与其他对象仅具有有限数量（例如 2 个）的关系。这是一些代码：

在客户端：

```
response = Customer.find(customer_id).put(:add_user, :user_id => user_id) 
```

这会请求将用户添加到客户。然后在服务中我想检查这个添加是否有效。

```
def add_user    
 @user = User.find(params[:user_id])
 @customer = Customer.find(params[:id])
 if @customer.users.length > 2
  render :xml => "ERR_only_2_users_allowed", :status => :unprocessable_entity
 end
end 
```

这是我的问题。在活动资源中，如果返回状态为错误，则客户端完全失败。我可以将状态更改为 200，然后我可以很好地取回 body err msg，但这似乎违背了错误响应代码的目的。

我可以将来自客户端的整个请求调用放在开始/救援块中

```
begin
    response = Customer.find(customer_id).put(:add_user, :user_id => user_id)
  rescue ActiveResource::ResourceInvalid => e
    #return error code
end 
```

但是当我捕捉到 422 (unprocessable_entity) 响应时，我什么也没得到，所以我没有收到我的自定义错误消息。响应 = 无

有谁知道我如何使用正确的响应代码来实现这些自定义错误消息？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-07-19T00:41:05.060

这可能是您的问题，也可能不是，但我们俩似乎都非常接近。我正在使用自定义 put 方法，但他也应该为您工作。发生了什么是执行此操作的代码：

```
rescue ResourceInvalid => error
     errors.from_xml(error.response.body)
end 
```

仅使用标准保存方法。如果您想在调用其他方法时添加错误，看起来您需要自己做。

我不得不将它添加到 vendor/rails/activeresource/lib/active_resource/custom_methods.rb

这是我与 git 的差异：旧代码：

```
def put(method_name, options = {}, body = '')
  connection.put(custom_method_element_url(method_name, options), body, self.class.headers)
end 
```

新代码：

```
def put(method_name, options = {}, body = '')
  begin
    connection.put(custom_method_element_url(method_name, options), body, self.class.headers)
  rescue ResourceInvalid => error
    errors.from_xml(error.response.body)
  end
  self 
end 
```

因此，在获取 422 引发的异常时查看堆栈跟踪，看看它到底调用了哪个方法。然后添加类似我所拥有的东西，你应该很高兴。

不要问我为什么 activeresource 的人认为验证只适用于他们的 save 方法。保存方法执行创建或更新，但调用“放置或发布”是完全相同的事情，IMO。如果我们希望验证在保存时起作用，我们希望它们在放置和发布时起作用……无论如何，试一试。

我不确定我最后是否需要自我……我可能不需要。我还没有完全完成这个，因为我只是想出了如何让它工作。埃里克

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-29T18:59:32.280

我认为您的问题可能是响应不是 xml 文档，而只是一个纯字符串。尝试将您的渲染语句更改为：

```
render :xml => { :error => "ERR_only_2_users_allowed" }, :status => :unprocessable_entity 
```

# performance - 你为你的 webapps 使用什么性能测试方法？

> ID：686694
> 
> 赞同：0
> 
> 时间：2009-03-26T17:02:48.723
> 
> 标签：performance, web-applications, methodology

我想对一个典型的 Web 应用程序进行性能测试。该应用程序提供了一些 web2.0 功能，例如写博客、wiki、搜索内容等等。我分析了访问日志，了解了用户真正经常做的事情。

我脑中的空白是如何进行的？我想到了以下方法：

*   (A) 将功能拆分为事务（撰写博文、查看维基页面等）
*   (B) 随着用户数量的增加运行这些交易
*   (C) 做一些报告：“使用硬件 x 浏览 wikipage 可以由 y 个用户同时执行，而内存是边界资源”
*   (D) 尝试将多个事务混合到一个场景中，这应该是真实用户负载的真实映射
*   (E) 在用户增加的情况下运行此场景，制作与 C 中相同的报告

您对此有何看法，您的方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T17:21:15.700

您将遇到的问题是如何以可重复的方式测试所有内容。不可重现的测试（即手动测试）的实用性受到严格限制。

看看[watir](http://wtr.rubyforge.org/)（读作“水”）；它提供了良好的覆盖范围并且*非常*可编写脚本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T17:32:07.093

您首先需要知道可以在您的网站上执行哪些活动，更重要的是需要了解该活动在您的总流量中所占的比例。对于一个简单的博客，您可能会说它看起来像这样：

*   阅读索引页：30%
*   阅读帖子页面：65%
*   创建评论：4%
*   创建帖子：1%

然后，您可以使用某种测试框架来模拟此负载并了解每分钟每秒可以承受多少请求。这会给你一些关于容量的硬性数字。您还可以分析您的内存/cpu/网络/任何东西，以查看它们在这段时间内的使用情况。

然而，不要跳过实际的可用性测试真的很重要。在标准的动态网站中，如果加载页面需要超过半秒的时间，就会开始感觉很慢。在启用 AJAX 的站点中，您会发现可供用户使用的反馈数量的增加使他们对延迟具有更高的容忍度，而可接受的限制将需要人工调查才能判断。

# java - 在 windows 上从 java 调用 rsync+ssh 的问题

> ID：686701
> 
> 赞同：1
> 
> 时间：2009-03-26T17:05:55.907
> 
> 标签：java, ssh, rsync

我在安装了 cygwin 的 windows vista 上从 java 调用 rsync 时遇到问题。将完全相同的命令粘贴到命令外壳中可以正常工作，这很奇怪。

我的测试 java 调用看起来像这样。

```
String[] envVars = {"PATH=c:/cygwin/bin;%PATH%"};
File workingDir = new File("c:/cygwin/bin/");
Process p = Runtime.getRuntime().exec("c:/cygwin/bin/rsync.exe -verbose -r -t -v --progress -e ssh /cygdrive/c/Users/dokeeffe/workspace/jrsync/ www.servername.net:/home/dokeeffe/rsync/",envVars,workingDir); 
```

然后我启动 2 个流读取器线程来捕获并记录 Process p 的 inputStream 和 errorStream。

这是输出....

```
DEBUG: com.mddc.client.rsync.StreamGobbler - opening connection using: ssh www.servername.net rsync --server -vvtre.iLs . /home/dokeeffe/rsync/
DEBUG: com.mddc.client.rsync.StreamGobbler - rsync: pipe: Operation not permitted (1)
DEBUG: com.mddc.client.rsync.StreamGobbler - rsync error: error in IPC code (code 14) at /home/lapo/packaging/rsync-3.0.4-1/src/rsync-3.0.4/pipe.c(57) [sender=3.0.4] 
```

发生错误的 rsync 代码是 pipe.c(57) 就是这样。

```
if (fd_pair(to_child_pipe) < 0 || fd_pair(from_child_pipe) < 0) {
    rsyserr(FERROR, errno, "pipe");
    exit_cleanup(RERR_IPC);
} 
```

因此，由于某种原因 fd_pair(to_child_pipe) < 0 或 fd_pair(from_child_pipe) < 0。

如果有人有任何建议，那就太好了，因为我现在被困住了。谢谢，

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T17:29:19.783

您是否在某处忘记了 ssh 私有/公共密钥库？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T21:16:47.053

我从来没有尝试过使用不同的线程读/写，只有执行命令的同一个线程。这会导致您的问题吗？

您也可以尝试将 -v 传递给 ssh 以获取调试输出。这在过去帮助我解决了 ssh 连接问题。你会通过`-e "ssh -v"`的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T21:17:20.357

cygwin 的 rsync 二进制分发版能识别 ssh 命令吗？当您放入 shell 时，您尝试执行的命令可能工作正常，因为 bash 之类的东西知道如何解释 ssh 命令以建立连接，即使用 ssh 程序为 rsync 程序创建连接。从您的调试信息中，我认为 rsync 正在等待连接，而是收到了一个无法通过管道传输的字符串“ssh ...”。

要解决这个问题，您必须让 bash 为您完成工作。在线程部分中查看[此页面](http://mindprod.com/jgloss/exec.html)以照顾孩子。您需要派生一个命令外壳的实例并将您的命令写入外壳子进程。所以是这样的：

```
Process p = Runtime.getRuntime().exec("c:/cygwin/bin/bash.exe");
OutputStreamWriter osw = new OutputStreamWriter(p.getOutputStream());
BufferedWriter bw = new BufferedWriter( osw, 100);
try{
    bw.write(command);
    bw.close();
}catch(IOExeception e){
    System.out.println("Problem writing command.");
} 
```

您可能还想阅读进程输出，因为如果您不阅读它，它将停止执行。提供的链接很好地涵盖了该主题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T23:22:50.493

谢谢大家，尤其是丹尼尔。你发给我的链接很棒。最后我使用了 ProcessBuilder 而不是 Runtime.exec。如果对任何人有帮助，这是代码......

```
 ProcessBuilder pb = new ProcessBuilder(new String[]{"c:/cygwin/bin/rsync.exe"
                                                                ,"-verbose",
                                                                "-r",
                                                                "-t",
                                                                "-v",
                                                                "--progress",
                                                                "-e",
                                                                "ssh",
                                                                "/cygdrive/c/Users/dokeeffe/workspace/jrsync/",
                                                                "www.servername.net:/home/dokeeffe/rsync/"});
        Map<String, String> env = pb.environment();
        env.put("PATH","/cygwin/bin;%PATH%");
        pb.directory(new File("c:/cygwin/bin/"));
        Process p = pb.start();
        StreamGobbler outputGobbler = new StreamGobbler(p.getInputStream(),"OUTPUT");
        StreamGobbler errorGobbler = new StreamGobbler(p.getErrorStream(),"ERROR");
        outputGobbler.start();
        errorGobbler.start();
        int val = p.waitFor();
        if(val!=0){
            throw new Exception("Rsync return code="+val);
        } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-08-01T05:24:22.603

我对类似问题的经验：

**我的常数：**

1.  构建系统是 ANT，在 Hudson 运行

2.  构建服务器是 Windows Server

3.  远程测试服务器是 Linux

4.  不允许使用 rsync 守护进程，仅 rsync over ssh

**我们做了什么**

1.  将 DeltaCopy 安装到 windows 服务器

2.  按照这些说明设置 DeltaCopy，以便它可以与 SSH 一起使用

    *   [http://www.aboutmyip.com/AboutMyXApp/DisplayFAQ.do?fid=1](http://www.aboutmyip.com/AboutMyXApp/DisplayFAQ.do?fid=1)

    *   [http://troy.jdmz.net/rsync/index.html](http://troy.jdmz.net/rsync/index.html)

3.  我构建了以下 ANT 宏，并在 hudson 中运行它。起初，这挂在我身上，没有任何反应。

    添加`-vvv`而不是`-v`做出不同的。这导致更多信息被添加到 hudson 日志中。

    ```
    <macrodef name="rsync">
    <attribute name="username"/>
    <attribute name="remoteServer"/>
    <attribute name="remoteDir"/>
    <attribute name="sourceDir"/> <!-- relative to basedir start and end with / (e.g. "/html/resources/" -->
    <sequential>
        <echo message="Starting rsync @{sourceDir} to @{remoteDir} on server @{remoteServer} as user @{username} at ${release.start}"/>

        <pathconvert property="cygwinbasepath" dirsep="/" pathsep="" description="Replace ':' '\' with '/' and assign value to property">
            <path path="${basedir}" description="Original version" />
            <!--Pathconvert will try to add the root directory to the "path", replace with empty string --> 
            <filtermapper> 
                <replacestring from=":" to="" />  
            </filtermapper>
        </pathconvert>
        <echo message="${basedir} converted to ${cygwinbasepath}"/>

        <property name="rsync.cygwinSourcePath" value="/cygdrive/${cygwinbasepath}@{sourceDir}" />
        <!-- ${rsync.user}@${rsync.server}:${rsync.dir} -->
        <property name="rsync.remoteDestinationPath" value="@{remoteServer}:@{remoteDir}" />

        <echo message="trying to run:" />
        <!-- &quot; is escaped quote -->
        <echo>cmd /C rsync -avz -e &quot;ssh -v -l ${deployment.rsync.username} -i /cygdrive/C/cygwin/home/service-tomcat/.ssh/id_rsa&quot; --recursive --chmod=a=rw,Da+x ${rsync.cygwinSourcePath} ${rsync.remoteDestinationPath}</echo>
        <echo>
        </echo>
        <!-- 10 minute timeout -->
        <exec executable="C:\cygwin\bin\mintty.exe"
            timeout="300000"
        >
            <arg value="rsync"/>
              <arg value="-avvvz"/>
              <arg value="-e" />
              <arg value="ssh -v -l ${deployment.rsync.username} -i /cygdrive/C/cygwin/home/vj-service-tomcat/.ssh/id_rsa" />
              <arg value="--recursive"/>
              <arg value="--chmod=a=rw,Da+x"/> 
              <arg value="${rsync.cygwinSourcePath}"/>
              <arg value="${rsync.remoteDestinationPath}"/>
        </exec>

        <echo>
        </echo>

    </sequential> 
    ```

    让它发挥作用的关键是执行`C:\cygwin\bin\mintty.exe`而不是`cmd`.

4.  然后，我在 Windows 服务器上手动运行 rsync 命令，其 known_hosts 文件已使用远程主机进行更新。这必须以 hudson 用户的身份完成。我们在 windows 中使用 runas 命令以 hudson 用户身份启动 cygwin 控制台。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-10-25T16:28:17.030

我最近实现了类似的东西，并认为我会分享我的经验，因为调试问题需要相当长的时间。这个问题是谷歌上这个问题的唯一实例之一。

我的应用程序作为服务启动。运行 whoami 命令时，结果是“nt authority\system”。在 /home/myusername/.ssh 下设置了我的 SSH 密钥后，rsync 命令失败，因为 /home/SYSTEM/.ssh 下没有设置任何配置。

将我的 /home/myusername/.ssh 目录复制到 /home/SYSTEM/.ssh 并使用以下字符串数组可以满足我的目的。将 PORT 替换为您的 ssh 端口。

```
new String[]{"rsync", "-z", "-I", "-e", "ssh -p PORT", server + ":" + serverPath, clientPath} 
```

[如果这是您的问题，请参阅此处](https://stackoverflow.com/questions/77528/how-do-you-run-cmd-exe-under-the-local-system-account)的链接以获取有关在系统权限下启动 cmd.exe 以进行测试的详细信息。

# asp.net - 禁用 ASP.Net 2.0 Web 事件

> ID：686708
> 
> 赞同：4
> 
> 时间：2009-03-26T17:07:59.520
> 
> 标签：asp.net, asp.net-2.0

未处理 Web 应用程序的某些异常（Web 服务调用），因为我想在自定义错误页面上显示它们，从 Application_Exception 方法传递。将我的 Web 应用程序移植到 ASP.Net 2.0，这些事件开始出现在事件查看器中（Web 事件，ASP.Net 2.0 的新功能）。

有没有办法禁用 ASP.Net 2.0 Web 事件，或者避免在事件查看器中自动记录？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T17:19:25.250

我认为您可以在框架文件夹内的 web.config 中禁用[HealtMonitoring](http://msdn.microsoft.com/en-us/library/2fwh2ss9.aspx)，或者更改规则以记录一些异常

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T17:47:33.733

您可能想要配置健康监控而不是禁用它。对于您*不*希望在自定义错误页面上显示的异常，您需要默认运行状况监控配置记录的详细信息。

# python - Python：为什么我不能使用 locals() 修改函数内的当前范围？

> ID：686715
> 
> 赞同：2
> 
> 时间：2009-03-26T17:10:21.373
> 
> 标签：python, scope, introspection

为什么创建/修改 locals() 的成员在函数中不起作用？

```
Python 2.5 (release25-maint, Jul 20 2008, 20:47:25)
[GCC 4.1.2 20061115 (prerelease) (Debian 4.1.1-21)] on linux2
Type "help", "copyright", "credits" or "license" for more information.

>>> # Here's an example of what I expect to be possible in a function:
>>> a = 1
>>> locals()["a"] = 2
>>> print a
2

>>> # ...and here's what actually happens:
>>> def foo():
...  b = 3
...  locals()["b"] = 4
...  print b
...
>>> foo()
3 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-26T17:15:32.733

为什么会呢？它旨在返回一个表示，并且从未打算用于编辑本地人。[正如文档](http://docs.python.org/library/functions.html#locals)警告的那样，它永远不能保证作为这样的工具工作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T17:40:19.117

locals() 返回命名空间的副本（与 globals() 的作用相反）。这意味着您对 locals() 返回的字典执行的任何更改都将无效。在示例 4.12中[深入了解 Python 。](http://www.faqs.org/docs/diveintopython/dialect_locals.html)

# python - Python，将 9 个元组 UTC 日期转换为 MySQL 日期时间格式

> ID：686717
> 
> 赞同：12
> 
> 时间：2009-03-26T17:10:34.430
> 
> 标签：python, sql, mysql, datetime, tuples

我正在使用此处指定的格式解析 RSS 提要：[http ://www.feedparser.org/docs/date-parsing.html](http://www.feedparser.org/docs/date-parsing.html)

日期元组 (2009, 3, 23, 13, 6, 34, 0, 82, 0)

我对如何将其转换为 MySQL 日期时间格式 (Ymd H:M:S) 感到有些困惑？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-26T17:14:59.207

```
tup = (2009, 3, 23, 13, 6, 34, 0, 82, 0)
import datetime 
d = datetime.datetime(*(tup[0:6]))
#two equivalent ways to format it:
dStr = d.isoformat(' ')
#or
dStr = d.strftime('%Y-%m-%d %H:%M:%S') 
```

# asp.net - ASP.NET GUID 作为唯一标识符 - URL 重写

> ID：686719
> 
> 赞同：1
> 
> 时间：2009-03-26T17:10:49.780
> 
> 标签：asp.net

你能帮我吗？我有一个数据库，唯一标识符是 GUIDS - 我们需要实现 URL 重写，但是页面名称看起来很糟糕，例如：

testpage-2668FF87-0A3A-4cac-B9AB-2367D17A76C3.aspx 页面标题/唯一标识符

我设置的数据库我使用 Ints 作为唯一标识符，所以我从来没有遇到过这个问题：

testpage-1.aspx 页面标题/唯一标识符（int）

你有什么建议？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T17:16:24.743

将带有 GUIDS 的映射表创建为较短名称或表中名称较短的列。Guid 保证是唯一的，但这并不意味着它们是最好的唯一标识符。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-06-23T19:02:09.147

我见过很多不是暴露实际的guid，而是base64对其进行编码并更改一些字符：

```
public String ConvertBase64( Guid input ) {
    String sResult = Convert.ToBase64String(input.ToByteArray(), Base64FormattingOptions.None);
    sResult = sResult.Replace("/", "_").Replace("+", "-");
    sResult = sResult.Substring(0, 22);
    return sResult;
} // method::ConvertBase64(guid) 
```

将其转换回来时，您会做相反的事情。

```
public String Base64ToGuid( String input) {
    input = input.Replace("_", "/").Replace("-", "+");
    result = new Guid(Convert.FromBase64String(input + "=="));
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-23T18:50:32.807

面向公众的 URL 应始终清晰易读。（使用“slugs”，如上）这可确保您的每个页面为用户生成一致的内容（即，它不是基于会话的），并且以他们可以理解的方式对搜索引擎可见。

在数据库方面，只需跟踪额外的“url”列并编写查询以利用它而不是“视图”的 GUID，但在内部使用 GUID 进行 UPDATE 查询。:)

# sql-server - SQL Server 中的“with (nolock)”是什么？

> ID：686724
> 
> 赞同：653
> 
> 时间：2009-03-26T17:13:35.640
> 
> 标签：sql-server, nolock

有人可以解释使用`with (nolock)`查询的含义，什么时候应该/不应该使用它？

例如，如果您的银行应用程序具有高交易率并且某些表中有大量数据，那么在哪些类型的查询中可以使用 nolock？是否存在您应该始终使用它/从不使用它的情况？

* * *

## 回答 #1

> 赞同：501
> 
> 时间：2009-03-26T17:16:28.050

WITH (NOLOCK) 相当于使用 READ UNCOMMITED 作为事务隔离级别。因此，您将面临读取随后回滚的未提交行的风险，即从未进入数据库的数据。因此，虽然它可以防止读取被其他操作死锁，但它带来了风险。在具有高交易率的银行应用程序中，它可能不会成为您试图用它解决的任何问题的正确解决方案，恕我直言。

* * *

## 回答 #2

> 赞同：177
> 
> 时间：2009-03-26T18:08:58.547

问题是更糟糕的是什么：

*   僵局，或
*   错误的值？

对于金融数据库，死锁比错误的值要糟糕得多。我知道这听起来倒退了，但请听我说完。数据库事务的传统示例是更新两行，从其中减去并添加到另一行。那是错的。

在财务数据库中，您使用业务交易。这意味着向每个帐户添加一行。最重要的是这些事务完成并且行被成功写入。

暂时弄错账户余额没什么大不了的，这就是日终对账的目的。由于同时使用两台 ATM，而不是未提交的数据库读取，账户透支的可能性要大得多。

也就是说，SQL Server 2005 修复了大部分`NOLOCK`必要的错误。因此，除非您使用的是 SQL Server 2000 或更早版本，否则您不需要它。

**进一步阅读**
[行级版本控制](http://www.sqlservercentral.com/articles/SQL+Server+2005/62464/)

* * *

## 回答 #3

> 赞同：63
> 
> 时间：2011-03-29T07:30:20.630

不幸的是，这不仅仅是读取未提交的数据。在后台，您可能最终会阅读两次页面（在页面拆分的情况下），或者您可能会完全错过这些页面。所以你的结果可能会严重偏斜。

查看[Itzik Ben-Gan 的文章](http://www.itprotoday.com/software-development/quaere-verum-clustered-index-scans-part-iii)。这是一段摘录：

> " 使用 NOLOCK 提示（或将会话的隔离级别设置为 READ UNCOMMITTED），您告诉 SQL Server 您不期望一致性，因此无法保证。请记住，“不一致的数据”不仅意味着您可能会看到后来回滚的未提交更改，或者事务的中间状态中的数据更改。**这也意味着在扫描所有表/索引数据的简单查询中，SQL Server 可能会丢失扫描位置，或者您可能最终会两次获得同一行**。”

* * *

## 回答 #4

> 赞同：56
> 
> 时间：2009-03-26T17:55:26.583

nolock 提示合法使用的教科书示例是针对高更新 OLTP 数据库的报告抽样。

举一个话题的例子。如果一家大型美国商业街银行想要运行每小时报告，以寻找银行出现城市级别挤兑的最初迹象，则 nolock 查询可以扫描交易表，汇总每个城市的现金存款和现金取款。对于这样的报告，由回滚更新事务引起的错误的微小百分比不会降低报告的价值。

* * *

## 回答 #5

> 赞同：33
> 
> 时间：2010-03-03T17:01:05.540

不知道为什么您不将金融交易包装在数据库交易中（例如当您将资金从一个帐户转移到另一个帐户时 - 您不会一次提交交易的一侧 - 这就是存在显式交易的原因）。即使您的代码听起来像是对业务事务脑死亡，但所有事务数据库都有可能在发生错误或失败时进行隐式回滚。我认为这个讨论超出了你的想象。

如果您遇到锁定问题，请实施版本控制并清理您的代码。

无锁不仅会返回错误的值，还会返回幻像记录和重复项。

一个常见的误解是它总是使查询运行得更快。如果表上没有写锁，则没有任何区别。如果表上有锁，它可能会使查询更快，但首先发明锁是有原因的。

公平地说，这里有两种特殊情况，其中 nolock 提示可以提供实用程序

1) 需要对实时 OLTP 数据库运行长查询的 2005 年之前的 sql server 数据库，这可能是唯一的方法

2) 写得很糟糕的应用程序会锁定记录并将控制权返回给 UI，并且阅读器会被无限期地阻塞。如果无法修复应用程序（第三方等）并且数据库是 2005 之前的版本或无法打开版本控制，则 Nolock 在这里会很有帮助。

* * *

## 回答 #6

> 赞同：24
> 
> 时间：2009-03-26T17:43:25.847

`NOLOCK`等同于`READ UNCOMMITTED`，但微软表示您不应将其用于`UPDATE`or`DELETE`语句：

> 对于 UPDATE 或 DELETE 语句：此功能将在 Microsoft SQL Server 的未来版本中删除。避免在新的开发工作中使用此功能，并计划修改当前使用此功能的应用程序。

[http://msdn.microsoft.com/en-us/library/ms187373.aspx](http://msdn.microsoft.com/en-us/library/ms187373.aspx)

本文适用于 SQL Server 2005，因此`NOLOCK`如果您使用的是该版本，则存在对的支持。为了使您的代码适应未来（假设您决定使用脏读），您可以在存储过程中使用它：

`SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED`

* * *

## 回答 #7

> 赞同：23
> 
> 时间：2009-03-26T17:15:14.497

您可以在仅读取数据时使用它，并且您并不真正关心是否可能会取回尚未提交的数据。

读取操作可以更快，但我不能说多少。

一般来说，我建议不要使用它——读取未提交的数据充其量可能有点令人困惑。

* * *

## 回答 #8

> 赞同：18
> 
> 时间：2009-03-26T17:19:44.890

另一种通常没问题的情况是在报告数据库中，其中数据可能已经老化并且不会发生写入。但是，在这种情况下，管理员应该通过更改默认隔离级别在数据库或表级别设置该选项。

在一般情况下：当您*非常*确定可以读取旧数据时，您可以使用它。要记住的重要一点是，它*很容易出错*。例如，即使在您编写查询时没问题，您确定将来数据库中不会更改某些内容以使这些更新更重要吗？

我也会认为这在银行应用程序中可能*不是*一个好主意。或库存应用程序。或者您正在考虑交易的任何地方。

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2009-03-26T18:08:33.650

简单的答案 - 只要您的 SQL 没有更改数据，并且您的查询可能会干扰其他活动（通过锁定）。

对于用于报告的任何查询，都值得考虑，尤其是在查询时间超过 1 秒的情况下。

如果您有针对 OLTP 数据库运行的 OLAP 类型的报告，这将特别有用。

不过，要问的第一个问题是“我为什么要担心这个？” 根据我的经验，当有人处于“尝试任何东西”模式时，通常会伪造默认锁定行为，这是一种不太可能出现意外后果的情况。这往往是过早优化的情况，并且很容易被嵌入到应用程序中“以防万一”。重要的是要了解你为什么这样做，它解决了什么问题，以及你是否真的有问题。

* * *

## 回答 #10

> 赞同：14
> 
> 时间：2016-02-05T15:54:17.980

**简短的回答：**

仅`WITH (NOLOCK)`在具有聚集索引的表上的 SELECT 语句中使用。

**长答案：**

WITH(NOLOCK) 通常被用作加快数据库读取速度的神奇方法。

结果集可以包含尚未提交的行，这些行通常稍后会回滚。

如果将 WITH(NOLOCK) 应用于具有非聚集索引的表，则当行数据流式传输到结果表时，其他事务可以更改行索引。这意味着结果集可能会丢失行或多次显示同一行。

READ COMMITTED 增加了一个额外的问题，即多个用户同时更改同一单元格的单个列中的数据损坏。

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2010-07-13T01:48:50.920

`WITH (NOLOCK`我的 2 美分 -当您需要生成报告时使用 ) 是有意义的。在这一点上，数据不会有太大变化并且您不想锁定这些记录。

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2009-03-26T17:17:58.717

如果您正在处理金融交易，那么您将永远不想使用`nolock`. `nolock`最好用于从具有大量更新的大型表中进行选择，并且您不在乎您获得的记录是否可能已过时。

对于财务记录（以及大多数应用程序中的几乎所有其他记录）`nolock`会造成严重破坏，因为您可能会从正在写入的记录中读取数据而无法获得正确的数据。

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2009-03-26T17:17:09.220

我曾经为要做的事情检索“下一批”。在这种情况下，确切的项目并不重要，我有很多用户运行相同的查询。

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2009-03-26T17:16:58.033

当您对“脏”数据没问题时，请使用 nolock。这意味着 nolock 也可以读取正在修改和/或未提交数据的过程中的数据。

在高事务环境中使用它通常不是一个好主意，这就是为什么它不是查询的默认选项。

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2009-03-26T17:24:44.473

我使用 with (nolock) 提示，特别是在具有高活动性的 SQLServer 2000 数据库中。但是，我不确定 SQL Server 2005 是否需要它。我最近应客户 DBA 的请求在 SQL Server 2000 中添加了该提示，因为他注意到了很多 SPID 记录锁。

我只能说，使用提示并没有伤害到我们，而且似乎已经解决了锁定问题。该特定客户的 DBA 基本上坚持我们使用提示。

顺便说一句，我处理的数据库是企业医疗索赔系统的后端，所以我们谈论的是数百万条记录和 20 多个表在许多连接中。我通常为连接中的每个表添加 WITH (nolock) 提示（除非它是派生表，在这种情况下您不能使用该特定提示）

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2016-05-20T09:49:09.507

最简单的答案是一个简单的问题——你需要你的结果是可重复的吗？如果是，那么 NOLOCKS 在任何情况下都不合适

如果您不需要可重复性，那么 nolocks 可能很有用，特别是如果您无法控制连接到目标数据库的所有进程。

# c# - 嵌套用户控件中的 EnableViewState 问题 - ASP.NET

> ID：686726
> 
> 赞同：1
> 
> 时间：2009-03-26T17:14:10.600
> 
> 标签：c#, asp.net

我有一个带有 (EnableViewState = "true") 的页面，它有一个带有 (EnableViewState = "true") 的父控件。父控件加载一个子控件。

在子控件中，我有一个在回发时被分配为 null 的 viewstate 对象。奇怪的是，如果我在子控件上设置 EnableViewState = "true"，那么一切正常。

我的理解是这个指令默认是真的。我是否明确设置它有什么关系。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T18:34:13.963

如果您使用 LoadControl() 加载控件，asp.net 不知道如何在回发时恢复这些控件。但是，如果您确保所有控件都加载到 Page_Init 中，则视图状态将加载到控件中。

此[控件](http://www.denisbauer.com/ASPNETControls/DynamicControlsPlaceholder.aspx)为您执行其中一些操作

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T17:24:52.867

是否在 web.config 中关闭了 ViewState？

# jquery - 如何在 jQuery 中淡入然后设置焦点？

> ID：686743
> 
> 赞同：3
> 
> 时间：2009-03-26T17:18:17.563
> 
> 标签：jquery, html, css, animation

我有这个 jQuery 的小片段：

```
$('#showlink').click(function(){ 
 $('#linkwindow').show('fast');
    $('#linkwindow input').focus();
} 
```

仅在淡入淡出结束后如何调用焦点？有时它会稍微发生在之前，我最终会遇到一个奇怪的渲染错误。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-26T17:21:12.173

试试这个，使用[回调](http://docs.jquery.com/Effects/show#speedcallback)参数。

```
$('#showlink').click(function(){  
  $('#linkwindow').show('fast', function() {
    $('#linkwindow input').focus();
  });
}); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-26T17:21:13.313

您可以向该方法添加回调`show`：

```
$('#showlink').click(function(){ 
    $('#linkwindow').show('fast', function() {
        $('#linkwindow input').focus();
    });
}) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T17:21:31.643

使用回调第二个参数。

就像是：

```
$('#linkwindow').show('fast', function() { 
    $('#linkwindow input').focus(); 
}); 
```

# windows - 将 IIS 设置克隆到新服务器的最佳方法？

> ID：686745
> 
> 赞同：9
> 
> 时间：2009-03-26T17:19:05.970
> 
> 标签：windows, iis

我有许多 asp 和 asp.net 2.0 应用程序，我需要将它们移到新的 Win2003 服务器上。

我创建了一个测试套件来验证是否正确安装和配置了不同的方面，但是除了从两台服务器导出 IIS 元数据库并手动比较之外，是否还有我缺少的工具或技术？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T13:43:59.753

[Microsoft Web 部署工具](http://learn.iis.net/page.aspx/346/web-deployment-tool/)应该允许您做几乎任何您想做的事情。

从链接的网站：

> Web 部署工具是一种用于简化 Web 应用程序、站点甚至整个服务器的部署、管理和迁移的工具。开发人员可以打包一个网站，自动包括内容、配置、证书和数据库。这些包可以直接部署到服务器上，也可以打包并与他人共享。IT 专业人员可以使开发人员能够将这些包部署到服务器并将访问权限委托给非管理员。IT 专业人员还可以在其基础架构中使用该工具轻松同步 IIS 6.0 和 IIS 7.0 上的服务器，甚至完成从 IIS 6.0 到 IIS 7.0 的迁移。

当涉及元数据库编辑时，它允许您轻松获取站点所依赖的所有设置的列表，并将这些设置同步到目标服务器（完成一个方便的“假设”模式）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T17:27:00.240

什么版本的 IIS？（这将影响提取步骤。）

您可以从 IIS 管理器导出设置并导入。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T17:30:23.273

如果您是手动操作，那么我会使用[BeyondCompare 之](http://www.scootersoftware.com/)类的工具来让您的生活更轻松。

您可以使用 System.DirectoryService 编写一些代码以编程方式比较两个服务器设置，或者将给定服务器与 Xml 文件进行比较，看看[这个](http://www.eggheadcafe.com/software/aspnet/31227147/creating-website-via-dire.aspx)

查看 MSBuild 的[sdc](http://www.codeplex.com/sdctasks)扩展，它们允许您在 msbuild 文件中创建网站，因此如果您可以验证是否可以正确创建它，您只需将其添加到您的构建脚本中即可。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T17:30:36.300

使用将您的应用程序移动到另一个 IIS。

*   1）首先使用ntbackup，备份applicaton文件夹。
*   2) 将应用程序配置导出到 IIS 中的文件。
*   3) 在另一台服务器上使用 ntbackup 命令，然后将文件恢复到同一路径。
*   4) 从配置文件创建应用程序。
*   5) 调整可能错过的配置。
*   6 就是这样。

    在我们公司，我们正在将许多 .NET 应用程序从我们的测试服务器迁移到生产服务器，我们遵循本指南。

最好的祝福！

# sql-server-2008 - SQL Server 2008 合并软删除错误

> ID：686747
> 
> 赞同：2
> 
> 时间：2009-03-26T17:19:22.177
> 
> 标签：sql-server-2008, merge

我正在尝试使用 SQL server 2008 MERGE 命令对目标表中的一行执行软删除。

我认为这应该属于“当与源不匹配时”部分，因为源缺少该行而目标仍然有它。我想要做的就是将 IsActive 位设置为 false，但我得到了一个错误。

> “试图将非 NULL 列的值设置为 NULL。”

我错过了什么？

用户表是：

```
[ID] [nvarchar](50) NOT NULL,
[FirstName] [nvarchar](200) NULL,
[LastName] [nvarchar](200) NULL,
[EmailAddress] [nvarchar](200) NULL,
[IsActive] [bit] NOT NULL 
```

合并语句是：

```
merge into Users
using TempUserTable lu
on Users.ID = TempUserTable.ID
when matched then
update set
    ID = lu.ID,
    FirstName = lu.FirstName,
    LastName = lu.LastName,
    EMailAddress = lu.EmailAddress,
    IsActive = lu.Status

when not matched then
    insert (ID, FirstName, LastName, EmailAddress, IsActive)
    values (lu.ID, lu.FirstName, lu.LastName, lu.EmailAddress, lu.Status)
when not matched by source then
    update set  IsActive = 0; 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2015-01-20T04:53:14.347

你*可以*让它完全按照你的意愿工作，但对我来说，我需要在 NOT MATCHED 行中添加一个条件。

所以尝试类似...

```
WHEN NOT MATCHED BY SOURCE 
                    AND TARGET.[IsActive] = 1 
                    AND TARGET.[DeletedOn] IS NULL 
    THEN UPDATE
    SET 
      TARGET.[IsActive] = 0, 
      TARGET.[DeletedOn] = SYSDATETIMEOFFSET() 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T03:35:47.950

看来您的临时表在列或列`TempUserTable`中有一个。`NULL``IsActive``ID`

# c# - ASP.NET MVC：如何创建一个动作过滤器来输出 JSON？

> ID：686753
> 
> 赞同：4
> 
> 时间：2009-03-26T17:20:56.730
> 
> 标签：c#, asp.net-mvc, json, action-filter

我使用 ASP.NET MVC 的第二天和我对 SO 代码的第一个请求（是的，走捷径）。

我正在寻找一种方法来创建一个过滤器，该过滤器拦截来自 Action 的当前输出，而是输出 JSON（我知道[替代方法](http://weblogs.asp.net/omarzabir/archive/2008/10/03/create-rest-api-using-asp-net-mvc-that-speaks-both-json-and-plain-xml.aspx)，但这是为了帮助我理解过滤器）。我想忽略与该操作相关的任何视图，只获取 ViewData["Output"]，将其转换为 JSON 并将其发送到客户端。需要填写的空白：

`TestController.cs:`

```
[JSON]
public ActionResult Index()
{
    ViewData["Output"] = "This is my output";
    return View();
} 
```

`JSONFilter.cs:`

```
public override void OnActionExecuting(ActionExecutingContext filterContext)
{
   /*
    * 1\. How to override the View template and set it to null?
    * ViewResult { ViewName = "" } does not skip the view (/Test/Index)
    * 
    * 2\. Get existing ViewData, convert to JSON and return with appropriate
    * custom headers
    */
} 
```

更新：社区回答导致[JSON/POX 过滤器](http://aleembawany.com/2009/03/27/aspnet-mvc-create-easy-rest-api-with-json-and-xml/)的更全面实施。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T18:03:33.537

我建议您真正想要做的是使用模型而不是任意`ViewData`元素并覆盖`OnActionExecuted`而不是`OnActionExecuting`. `JsonResult`这样，您只需在结果被执行并因此呈现给浏览器之前将结果替换为您的结果。

```
public class JSONAttribute : ActionFilterAttribute
{
   ...

    public override void OnActionExecuted( ActionExecutedContext filterContext)
    {
        var result = new JsonResult();
        result.Data = ((ViewResult)filterContext.Result).Model;
        filterContext.Result = result;
    }

    ...
}

[JSON]public ActionResult Index()
{
    ViewData.Model = "This is my output";
    return View();
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T18:35:55.847

您没有提到仅有条件地返回 JSON，所以如果您希望操作每次都返回 JSON，为什么不使用：

```
public JsonResult Index()
{
    var model = new{ foo = "bar" };
    return Json(model);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T18:34:18.300

也许这篇[文章](https://stackoverflow.com/questions/320291/how-to-post-an-array-of-complex-objects-with-json-jquery-to-asp-net-mvc-controll)可以帮助你正确的方式。上面的帖子也是一个方法

# c# - WebService 参数对象被重命名

> ID：686754
> 
> 赞同：0
> 
> 时间：2009-03-26T17:21:09.350
> 
> 标签：c#, web-services

这是我第一次将 Web 服务用于任何事情，所以这个问题可能有点基本。无论如何，我有一个网络服务作为我们供应商网站的代理。它简化了我们通常必须做的“屏幕抓取”。网络服务功能如下所示：

```
命名空间 foo  
{  
  公共类 MyService : WebService  
  {
     [网络方法]  
     公共字符串 UploadFile(System.IO.FileStream fileToUpload)  
     {
        返回 _obj.Upload(fileToUpload);  
     }  
  }  
}    

```

当您尝试向其提供方法要求的 FileStream 时，客户端会引发错误。在某处编译时，webservice 将参数的类型从 System.IO.FileStream 更改为 foo.FileStream。有没有人知道我是如何对自己这样做的？

提前致谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T17:38:44.050

在 .NET 中，当您跨应用程序域进行调用时（就像您在此处一样），您无法传递特定于该应用程序域的数据。

一般版本是，当您在两个独立的进程之间进行调用时，您不能将特定的信息（即仅在该上下文中具有重要性）发送到该进程并期望它在另一个进程中具有重要性。

这就是您对文件流所做的事情。文件流是操作系统上特定于进程的文件的句柄。不能保证同一台计算机上的进程，更不用说另一台机器上的进程能够理解这一点。

这是一个 Web 服务，这正是您所遇到的情况，因为您在不同的机器上有两个进程。

为了解决这个问题，您发送的数据必须是独立的。在这种特定情况下，这意味着发送整个文件的内容。

您应该将参数更改为字节数组，然后在您的方法中适当地处理字节。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T17:44:00.823

ASMX Web 服务不支持使用`System.IO.Stream`或任何派生类型的`Stream`. 为此，您将需要 WCF。

# html - 对比 在清算中

> ID：686766
> 
> 赞同：23
> 
> 时间：2009-03-26T17:23:47.643
> 
> 标签：html, xhtml

有什么不同

```
<br style="clear:both;"/> 
```

对比

```
<div style="clear:both;"/> 
```

??

还有，我以为

```
<div style="clear:both;"/> 
```

是一种很好的清理方式，但是

```
<div style="clear:both;"> </div> 
```

正确的方法？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-03-26T17:25:04.113

不同之处在于您继承了哪些*其他*样式属性。当然，一个继承自`<br>`，另一个继承自`<div>`。

*除了表示换行符和一些非零高度（链接到当前字体高度）之外，*通常*`<div>`没有特殊的样式含义。`display:block``<br>`*

 *但通常（例如，使用无处不在的`css-reset`技术）几乎没有区别。因此，选择最具有*语义*意义的那个。

[更新]

对于结束标签，使用`<div></div>`and not `<div/>`。 [这就是为什么](http://dusan.fora.si/blog/self-closing-tags)。

感谢评论员[Sebastian Celis](https://stackoverflow.com/users/65778/sebastian-celis)和[ehemient](https://stackoverflow.com/users/20713/ephemient)的“结束标签”更正。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-26T17:37:58.013

这是我用于清除的样式：

```
.Clear { clear: both; height: 0; overflow: hidden; } 
```

用法：

```
<div class="Clear"></div> 
```

由于高度为零，这不会占用页面中的任何额外空间。

Internet Explorer 有一个奇怪的想法，即每个元素的内容必须至少有一个字符高，另一个奇怪的想法是每个元素都应该与其内容一样高。使用`overflow: hidden`可以防止内容影响元素的大小。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-04-20T10:42:23.693

我会使用：

```
<p class="clear"></p> 
```

并在您的 CSS 中添加：

```
.clear {clear:both; height:0px; font-size:1px;}
/* font-size:0px; does not work well on IE7, it works in IE8 and all other browsers. */ 
```

你可能会说，为什么不：

```
<br class="clear"> 
```

我通常在元素`clear`之后使用类，当使用而不是在 IE7 上它们似乎不能正常工作时，它们并没有按预期清除，并且在 Safari4/Chrome 上它们添加了不需要的空间。我没有时间更好地研究这个，所以这可能只是我的设计上的一个错误，我所知道的在这种情况下似乎更像是跨浏览器。`float:left``<br>``<p>``<p>`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T17:26:39.680

嗯，没有区别，取决于继承的样式。

这个链接说的更多，并推荐： [http ://www.positioniseverything.net/easyclearing.html](http://www.positioniseverything.net/easyclearing.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-26T17:31:21.197

我在这里能想到的唯一区别是它`<div>`是块级元素，`<br>`而是内联级元素。

但`<br>`实际上它的行为有点像块级元素，除了它受 CSS 属性影响`line-height`之外`font-size`。

在我看来，`<br style="clear:both;"/>`在页面中放置换行符是更合适的方法，主要是因为它被广泛接受并且可能不熟悉您的标记的其他人很容易识别。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-26T17:26:43.597

如果您正在编写（有效的）XHTML，则不需要使用结束标记，但自闭合 div 标记并非在所有浏览器中都有效，因此您仍应使用它。即你的例子：

```
`<div style="clear:both;"> </div>` 
```

这是有效的 XHTML（请参阅[html vs xhtml](http://www.w3schools.com/XHTML/xhtml_html.asp)），但不适用于所有浏览器，因此您应该坚持上述内容：

~~`<div style="clear:both;" />`~~

此外，对于`<br>`标签的价值，不推荐使用标签以支持`<line>`标签（请参阅标签[上](http://www.w3.org/TR/2002/WD-xhtml2-20020805/mod-text.html#sec_8.5.)[的 w3.org 条目`<br/>`](http://www.w3.org/TR/2002/WD-xhtml2-20020805/mod-text.html#sec_8.5.)）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-26T17:29:27.397

这是我一直使用的：

```
<style type="text/css">
.clearing {
height: 0;
line-height: 0;
font-size: 0;
clear: both;
overflow:hidden;
}
</style> 
```

我需要清理的地方：

```
<div class="clearing"></div> 
```

您可能还对自动清算容器感兴趣：[http ://www.positioniseverything.net/easyclearing.html](http://www.positioniseverything.net/easyclearing.html)

**编辑**：根据另一个答案海报的建议添加了“溢出：隐藏”。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-26T19:00:14.057

您确实需要小心标签上的 / 。

<script> 标签上的斜杠由 <​​script language="javascript" src="MyScripts.js" /> 方式终止，我遇到了问题。虽然，大多数符合 xml 的解析器都会接受这两者。

<script> 必须由 </script> 终止

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-26T19:25:19.737

.clear { 明确：两者；字体大小：0px；行高：0px；高度：0px；溢出：隐藏；}

用法

"br" 在 Opera 和 IE 浏览器中有时会有副作用，所以你应该避免使用它

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-27T00:06:48.110

`<br />`是一个内联元素，其中 as`<div>`是一个块元素。反正我个人比较喜欢用`<hr class="clear">`，感觉语义上比较合适。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-27T12:54:20.183

所有的方法都是坏的。使用 CSS 更改页面的外观。有许多方法可以用 CSS 完成相同的任务。如给出“溢出：隐藏；” 在父元素上。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-27T13:21:29.400

你也可以用..

* * *

通过添加 CSS 规则，它可以完成这项工作，并且达到了这个目的。

# html - 为什么 HTML 的 IMG 标签在 Firefox 上呈现为空？

> ID：686772
> 
> 赞同：2
> 
> 时间：2009-03-26T17:26:10.227
> 
> 标签：html, tags

```
<html>
<body>

    <img id="j_id58" width="800" border="0" height="400" src="c:/test/tmp/imageEE3A7BA3F55BC67061FD778F1B0136D6.png"/>
</body>
</html> 
```

为什么当我在 Firefox 上打开它但在 IE 6 上打开它时不会呈现任何图像？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T17:30:20.980

我敢打赌，如果您使用`file://`URL 而不是文件名，这将起作用。

```
<html>
<body>
<img id="j_id58" width="800" border="0" height="400"
     src="file:///c/test/tmp/imageEE3A7BA3F55BC67061FD778F1B0136D6.png"/>
</body>
</html> 
```

试试看。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T17:30:22.150

Firefox 不支持使用`"C:/"`-style 路径。

而是使用相对 URL 或真实 URL 指向由 Web 服务器托管的文件。

IE6 确实支持这一点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T17:30:56.580

Firefox 在引用本地文件时需要“file:///”-前缀。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T17:36:25.617

除了上面的答案之外，如果您从 HTTP 服务器加载 HTML，这可能会失败。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T17:30:10.903

这可能是因为您需要一个带有 file:\\ 方案的*src属性。*

*在src*中尝试 file:///C://test/tmp/imageEE3A7BA3F55BC67061FD778F1B0136D6.png看看它是否有效。

# excel - 如何关闭 Excel com 对象并保存工作？

> ID：686789
> 
> 赞同：1
> 
> 时间：2009-03-26T17:30:18.890
> 
> 标签：excel

这让我发疯。我在这里找到了关于 Excel com 对象的类似帖子，但是在我的代码完成运行后，我尝试的解决方案都无法成功关闭 Excel。Excel.dll 将停留在 TaskManager 上。

有人可以看看我下面的代码，让我知道为什么 Excel 不会关闭吗？

```
Try
        'First get an application instance
        xlApp = New Excel.Application()
        'Second open the workbook you need
        xlBook = xlApp.Workbooks.Open(_FileInfo.FullName)
        xlSheet = xlBook.Worksheets(sheetName)
        'set visibility
        xlApp.Visible = False
        Dim row As Integer = 2
        For Each t In upsRecordList
            While (row < upsRecordList.Count + 2)
                xlSheet.Cells(row, 1) = t.StartDate
                xlSheet.Cells(row, 2) = t.AccountTypeCode
                row += 1
            End While
        Next
    Catch ex As Exception
        Throw ex
    Finally
        If Not xlApp Is Nothing Then
            GC.Collect()
            GC.WaitForPendingFinalizers()
            GC.Collect()
            GC.WaitForPendingFinalizers()
            NAR(xlSheet)
            If Not xlBook Is Nothing Then
                xlBook.Close(SaveChanges:=True)
                NAR(xlBook)
            End If
            xlApp.Quit()
            NAR(xlApp)
        End If
    End Try

 Private Sub NAR(ByVal o As Object)
    Try
        Marshal.FinalReleaseComObject(o)
    Catch
    Finally
        o = Nothing
    End Try
End Sub 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T17:43:11.573

这是我所做的：

保持您的 Excel 实例为单例：

```
// Our singleton excel instance
private static Excel.Application instance;

/// <summary>
/// Returns an instance of an Excel Application.
/// This instance is a singleton.
/// </summary>
public static Excel.Application GetInstance
{
    get
    {
        if (instance == null)
        {
            try
            {
                instance = new Excel.Application();
                // Give the app a GUID so we can kill it later
                instance.Caption = System.Guid.NewGuid().ToString().ToUpper(CultureInfo.CurrentCulture);
                instance.Visible = false;
            }
            catch (COMException ce)
            {
                ShowMessage(ce.Message, MessageBoxIcon.Error);
            }
        }
        return instance;
    }
} 
```

完成后，您可以销毁它：

```
 public static void DestroyInstance()
    {
        if (instance != null)
        {
            // Close the workbooks
            object missing = Type.Missing;
            foreach (Excel.Workbook book in GetInstance.Workbooks)
            {
                book.Close(false, book.FullName, missing);
            }

        String appVersion = instance.Version;
        String appCaption = instance.Caption;
        IntPtr appHandle = IntPtr.Zero;
        if (Convert.ToDouble(appVersion, CultureInfo.CurrentCulture) >= 10)
        {
            appHandle = new IntPtr(instance.Parent.Hwnd);
        }

        // Quit and release the object
        instance.Workbooks.Close();
        instance.Quit();
        Release(instance);

        // Force a cleanup.  MSDN documentation shows them making
        // two sets of collect and wait calls.
        System.GC.Collect();
        System.GC.WaitForPendingFinalizers();
        System.GC.Collect();
        System.GC.WaitForPendingFinalizers();

        EnsureProcessKilled(appHandle, appCaption);
    }
} 
```

EnsureProcessKilled 方法如下所示：

```
/// <summary>
/// This method contains a number of ways to try and kill
/// the Excel process created when an instance is instantiated.
/// </summary>
/// <param name="windowHandle">Handle of the application window</param>
/// <param name="caption">A custom GUI stored as the app's caption</param>
public static void EnsureProcessKilled(IntPtr windowHandle, String caption)
{
    NativeMethods.SetLastError(0);
    if (IntPtr.Equals(windowHandle, IntPtr.Zero))
    {
        windowHandle = NativeMethods.FindWindow(null, caption);
    }
    if (IntPtr.Equals(windowHandle, IntPtr.Zero))
    {
        // Can't find the window; assumed it's closed
        return;
    }
    int resourceId;
    int processId = 0;
    resourceId = NativeMethods.GetWindowThreadProcessId(windowHandle, ref processId);
    if (processId == 0)
    {
        // Can't get process id
        if (NativeMethods.EndTask(windowHandle) != 0)
        {
            return; // Success
        }
    }
    // Couldn't end it nicely, let's kill it
    System.Diagnostics.Process process;
    process = System.Diagnostics.Process.GetProcessById(processId);
    process.CloseMainWindow();
    process.Refresh();
    if (process.HasExited)
    {
        return;
    }
    // If we get here, it's being really stubborn.  Say goodbye, EXCEL.EXE!
    process.Kill();
} 
```

你将需要 NativeMethods 类：

```
public static class NativeMethods
{

    [DllImport("user32.dll")]
    internal static extern int EndTask(IntPtr windowHandle);

    [DllImport("user32.dll", CharSet = CharSet.Unicode)]
    internal static extern IntPtr FindWindow(String className, String windowName);

    [DllImport("user32.dll")]
    internal static extern int GetWindowThreadProcessId(IntPtr windowHandle, ref int processId);

    [DllImport("kernel32.dll")]
    internal static extern IntPtr SetLastError(int errorCode);

} 
```

还有一个小助手功能：

```
public static void Release(Object releasable)
{
    System.Runtime.InteropServices.Marshal.ReleaseComObject(releasable);
    releasable = null;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-27T18:38:22.727

从 Quit 语句中删除括号：xlApp.Quit

在该行之后，立即添加： Set xlApp = Nothing

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T20:16:11.557

我又来了（现已注册）。另一件事 - 不要将括号用于 Excel 参数，除非您将值传递给变量。代码应该是这样的：

```
 If Not xlApp Is Nothing Then
        GC.Collect()
        GC.WaitForPendingFinalizers()
        GC.Collect()
        GC.WaitForPendingFinalizers()
        NAR(xlSheet)
        If Not xlBook Is Nothing Then
            xlBook.Close True
            xlBook = Nothing
        End If
        xlApp.Quit
        xlApp = Nothing
    End If 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T17:36:28.063

你的代码很好。当您释放对象时，甚至使用 Quit 方法时，Excel 并不总是完全关闭。

我想你可以遍历正在运行的任务，强行终止它，但我不建议这样做。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T17:53:44.997

这是我的finally块；AFAIK 这并没有在我们的应用程序中发布 Excel。我们让 Excel 保持打开状态并依靠用户来关闭它。对 Marshal.FinalReleaseComObject 的调用需要针对您引用的 Excel 对象进行自定义。

```
 finally
        {
            GC.Collect();
            GC.WaitForPendingFinalizers();
            GC.Collect();
            GC.WaitForPendingFinalizers();
            // Calls are needed to avoid memory leak
            Marshal.FinalReleaseComObject(sheet);
            Marshal.FinalReleaseComObject(book);
            Marshal.FinalReleaseComObject(excel);
        } 
```

# python - pygame 搞砸了 ctypes

> ID：686798
> 
> 赞同：1
> 
> 时间：2009-03-26T17:31:25.410
> 
> 标签：python, winapi, pygame, ctypes

```
import mymodule, ctypes
#import pygame

foo = ctypes.cdll.MyDll.foo

print 'success' 
```

如果我取消注释`import pygame`这将失败`WindowsError: [Errno 182] The operating system cannot load %1`。堆栈框架在 ctypes python 代码中，试图加载 MyDll。win32 错误代码 182 是`ERROR_INVALID_ORDINAL`. 如果 pygame 导入不存在，则脚本运行成功。

更新：如果我在调试器之外运行它，%1 会充满“libpng13.dll”，它位于工作目录中并由 MyDll 引用，并且 pygame 肯定会加载某些版本的 libpng。我不知道我将如何解决这个问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T17:56:51.993

这听起来像一个dll冲突。似乎`import pygame`加载了一些与需要的 dll 不兼容的 dll `MyDll`。您应该尝试使用 sysinternals ProcessExplorer 进行调试，它可以显示进程加载了哪些 dll；在这两种情况下寻找不同的 dll。

另一个调试 dll 问题的有用工具是dependencywalker，来自[www.dependencywalker.com](http://www.dependencywalker.com)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-29T14:17:07.283

更新记录：我相信不同的模块（pygame和mydll）加载了多个版本的libpng。我使用多处理来分离两个模块，一切都很花哨。

# msbuild - msbuild 超时

> ID：686806
> 
> 赞同：1
> 
> 时间：2009-03-26T17:33:40.567
> 
> 标签：msbuild

好吧，我有一个相当大的项目，msbuild 一直在超时。

我们如何阻止 msbuild 超时？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T17:39:20.163

如果您**想**获得超时，您可以使用 cruiscontrol.net 或 Nant 或其他构建平台，您可以在那里指定超时。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T17:37:10.230

您可能想查看[MS 的此修补程序](http://code.msdn.microsoft.com/KB948677)。

根据修补程序信息：如果构建时间超过 59 分钟，那么它将超时。

# c# - ASP.net C# Silverlight 服务器组件和 firefox 中的 ajax 模式

> ID：686810
> 
> 赞同：0
> 
> 时间：2009-03-26T17:34:21.423
> 
> 标签：c#, asp.net, silverlight, firefox

我在带有 silverlight 控件的更新面板内有一个模式弹出窗口。

视频在 IE 7/8 中显示正常，但在 Firefox 中我得到的只是白屏

我正在使用[链接文本中的以下视频皮肤](http://sl2videoplayer.codeplex.com/)

```
 <div style="height:360px;">
                <asp:Silverlight
                  ID="myVideoPlayer"
                  runat="server"
                  Source="~/Videos/VideoPlayer.xap" 
                  Width="640px"
                  Height="360px" 
                  InitParameters="m=Efficiency.wmv"
                  Windowless="true" />
                </div> 
```

我知道当我使用普通的 <object> 方法时它会起作用，但这不起作用，因为我需要根据他们选择的视频类别从后面的代码中设置 Initparams。

我已经咨询了谷歌之神，他们并没有那么有帮助。希望你们能帮我解决这个问题。谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T17:51:59.727

我使用 Object 标记，并将 init 参数注入到 aspx 中，如下所示：

```
<%= initparams %> 
```

initparams 是我的 Page 类的受保护变量：

```
public partial class _Default : System.Web.UI.Page
{
    protected string initparams;

    protected void Page_Load(object sender, EventArgs e)
    {
        initparams = "m=video.asx";
    } 
```

您也可以在任何情况下更改该变量，它将被注入到呈现的 HTML 中。

# javascript - 从数据绑定数组中删除项目

> ID：686813
> 
> 赞同：0
> 
> 时间：2009-03-26T17:35:40.953
> 
> 标签：javascript, arrays, actionscript

如何从数据绑定数组中删除项目？我的代码如下。

```
for(var i = 0; i < listBox.selectedIndices.length; i++) {
  var toRemove = listFiles.selectedIndices[i];
  dataArray.splice(toRemove, 1);
} 
```

提前致谢！

**编辑**这是我的瑞士法郎。添加照片有效，除非您删除项目。 [http://www.3rdshooter.com/Content/Flash/PhotoUploader.html](http://www.3rdshooter.com/Content/Flash/PhotoUploader.html)

1.  添加 3 张不同的照片。
2.  删除第二张照片。
3.  添加不同的照片。
4.  SWF 将第二张照片添加到末尾。

关于为什么会这样做的任何想法？

**编辑 2**这是我的代码

```
private function OnSelectFileRefList(e:Event):void
{
    Alert.show('addstart:' + arrayQueue.length);
    for each (var f:FileReference in fileRefList.fileList)
    {
         var lid:ListItemData = new ListItemData();
         lid.fileRef = f;
         arrayQueue[arrayQueue.length]=lid;
    }
    Alert.show('addcomplete:' + arrayQueue.length);
    listFiles.executeBindings();
    Alert.show(ListItemData(arrayQueue[arrayQueue.length-1]).fileRef.name);
    PushStatus('Added ' + fileRefList.fileList.length.toString() + ' photo(s) to queue!');
    fileRefList.fileList.length = 0;
    buttonUpload.enabled = (arrayQueue.length > 0);
}

private function OnButtonRemoveClicked(e:Event):void
{
    for(var i:Number = 0; i < listFiles.selectedIndices.length; i++) {
        var toRemove:Number = listFiles.selectedIndices[i];
        //Alert.show(toRemove.toString());
        arrayQueue.splice(toRemove, 1);
    }
    listFiles.executeBindings();
    Alert.show('removecomplete:' + arrayQueue.length);
    PushStatus('Removed photos from queue.');
    buttonRemove.enabled = (listFiles.selectedItems.length > 0);
    buttonUpload.enabled = (arrayQueue.length > 0);
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-31T16:58:42.933

知道两件事肯定会有所帮助：

1.  您的目标是哪个版本的 ActionScript？

2.  从您的应用程序的行为来看，当用户从要上传的文件列表中删除项目时，不会发生错误。当用户向列表中添加新项目时，看起来更像是您的逻辑问题。您也有机会发布该代码吗？

**更新**：

代替：`arrayQueue[arrayQueue.length]=lid`

尝试：`arrayQueue.push(lid)`

这将在数​​组的末尾添加一个新项目并将该项目推入该位置。

**更新 2**：

好的，做了更多的挖掘。事实证明，每次打开对话框时 fileList 都不会被清除（如果您每次用户选择新文件时都没有创建 FileReferenceList 的新实例）。将每个文件添加到数组后，您需要在 fileList 上调用 splice()。

在你的 AddFile() 方法中尝试这样的事情......

```
for(var j:int=0; j < fileRefList.fileList.length; j++)
{
     arrayQueue.push(fileRefList.fileList[j]);
     fileRefList.fileList.splice(j, 1);
} 
```

这将使 fileList 保持最新，而不是保留以前的选择。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T15:43:44.020

我看到一个问题。从数组中拼接出第一个元素后，选定的索引将不再有效。但这仅在一次删除多个项目时才是问题。

我认为我们需要查看更多关于您如何处理上传的代码，然后才能弄清楚发生了什么。在我看来，您持有对已删除 FileReference 或其他内容的引用。所描述的问题是在您上传新文件时发生的，而不是在您删除所选文件时发生的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T17:38:20.843

您的意思是使用`listBox`和`listFiles`指代同一事物吗？

我在这里迈出了一步，因为我没有大量的 JavaScript 经验，但我会像在 C、C++ 或 Java 中那样做：通过复制剩余的数组元素向下移动到它们的新位置。

假设它`listFiles.selectedIndices`已排序（并且它的内容是 dataArray 的有效索引），代码将类似于以下内容：

**（警告：未经测试的代码如下。）**

```
// Don't bother copying any elements below the first selected element.
var writeIndex = listFiles.selectedIndices[0];
var readIndex = listFiles.selectedIndices[0] + 1;
var selectionIndex = 1;
while(writeIndex < (dataArray.length - listFiles.selectedIndices.length)) {
  if (selectionIndex < listFiles.selectedIndices.length) {
    // If the read pointer is currently at a selected element,
    // then bump it up until it's past selected range.
    while(selectionIndex < listFiles.selectedIndices.length && 
          readIndex == listFiles.selectedIndices[selectionIndex]) {
      selectionIndex++;
      readIndex++;
    }
  }
  dataArray[writeIndex++] = dataArray[readIndex++];
}

// Remove the tail of the dataArray
if (writeIndex < dataArray.length) {
  dataArray.splice(writeIndex, dataArray.length - writeIndex);
} 
```

**编辑 2009/04/04：**您的删除算法仍然存在以下缺陷：当您删除 中的项目时，您会破坏 中的索引和 中`listFiles.selectedIndices`的索引之间的对应关系。`arrayQueue``listFiles.selectedIndices`

要看到这一点，请尝试添加 3 个文件，然后执行“全选”，然后点击删除。它将首先删除列表中的第一个文件（索引 0）。现在列表**中**的第 2 和第 3 个文件位于索引 0 和 1 处。从中获取的下一个值`listFiles.selectedIndices`是 1 - 但现在，**第 3 个**文件位于索引 1 处。所以前文件 #3 被拼接离开数组，保留前第二个文件未删除并位于索引 0。（使用更多文件，您会看到此实现仅删除数组中的所有其他文件。）

这就是为什么我的 JavaScript 代码（上面）使用 a`readIndex`和 a`writeIndex`来复制数组中的条目，跳过`readIndex`要删除的索引。该算法避免了数组索引之间失去对应关系的问题。（确实需要仔细编码以防止各种边缘条件。）我尝试了一些**类似于**我上面写的 JavaScript 代码；它对我有用。

我怀疑您原始测试用例中的问题（删除第二个文件，然后添加另一个文件）是类似的。由于您只显示了部分代码，因此我无法判断数组索引和 , 和 中的数据`listFiles.selectedIndices`是否`arrayQueue`总是`fileRefList.fileList`会适当匹配。（但我怀疑问题在于他们没有。）

顺便说一句，即使您`splice()`通过适当调整数组索引值来解决使用问题，在一般情况下它仍然是 O(N ² ) 算法。数组复制算法是 O(N)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-07T01:37:15.237

我真的需要查看整个类以提供一个明确的答案，但我会编写一个方法来处理从 dataProvider 中删除多个对象并可能分配一个新数组作为列表的 dataProvider 而不是玩弄绑定和使用持续时间相同的列表。就像我说的那样，这可能效率低下，并且需要查看问题的上下文，但这就是我会做的 9 除非您在这种情况下非常需要绑定）

```
/**
* Returns a new Array with the selected objects removed 
*/
private function removeSelected(selectedItems:Array):Array
{
    var returnArray:Array = []
    for each(var object:Object in this.arrayQueue)
    {
        if( selectedItems.indexOf(object)==-1 )
            returnArray.push( object )
    }
    return returnArray;
} 
```

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-04-05T22:22:11.160

您可能会对这篇关于 Java 语言中缺少健壮迭代器这一事实的[博客条目](http://michaelscharf.blogspot.com/2008/10/concurrentmodificationexception-why-do.html)感兴趣。

编程语言，你提到的 Javascript，不是问题，我想指出的是健壮迭代器的概念（这篇论文实际上是关于 C++ 作为编程语言）。

关于为 ET++ C++ 框架提供健壮迭代器的 [研究文档]() 可能仍然有助于解决您的问题。我相信该文档可以为您提供解决问题的必要想法。

# integration - Lotus Notes 与 Java 门户平台的集成

> ID：686817
> 
> 赞同：1
> 
> 时间：2009-03-26T17:36:40.450
> 
> 标签：integration, lotus-notes, portal

我正在使用基于 Java 的门户平台。我需要在我的门户中显示存储在 Lotus Notes 中的信息。考虑到安全问题，推荐的方法是什么？

是否有任何与 Lotus Notes 集成的开源 JSR 168 portlet？

从我的门户平台，我可以调用 Web 服务来获取此信息。这是推荐的吗？如果是这样，我在哪里可以找到有关可用于 Lotus Notes 的 Web 服务 API 的信息？

是否可以在我的门户平台上安装任何 Java 组件，以提供 Java API 来访问 Lotus Notes 信息？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-27T11:08:43.993

您有两个主要选择。

首先，您可以通过 IIOP 直接使用 CORBA java 接口与 Domino（Notes 是客户端，Domino 是服务器）对话。这将使您可以完全访问 Domino 对象模型，并允许您编写代码来执行您需要在 Java 平台中执行的任何操作。

其次，您可以通过网络服务。这将更容易设置，但您必须为您想要在 Domino 服务器上执行的任何操作部署代码。在 ND7 及更高版本中，Domino 将从 WSDL 或方法存根为您构建所有 Web 服务元素。

从安全的角度来看，连接到服务的用户需要通过 Domino 进行身份验证。如果您可以代理登录，这可能是系统帐户或实际用户。

我看到的另一个角度是通过 portlet 将 HTTP 调用代理到 ​​Domino。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-08T20:28:58.500

假设您在门户和 domino 之间设置了 SSO，最简单的解决方案是使用门​​户中包含的 Notes View Portlet。如果您需要以更自定义的格式显示数据，那么我建议使用 portlet factory。如果以前的工作都不适合您，那么您应该能够使用 RAD 和注释 java api 开发自定义 portet。

# java - 主动渲染和 EDT（Swing 动画）

> ID：686822
> 
> 赞同：2
> 
> 时间：2009-03-26T17:38:34.847
> 
> 标签：java, swing, animation, applet, edt

我应该如何在 Swing 小程序中运行动画？

我有一个执行主动渲染的动画线程，它最初的动画效果很好。有时（从 1 分钟到 2 小时后）它开始无法更新屏幕，只出现声音。我相信这是由于没有从 EDT 执行绘制导致某种并发问题。

那么，是否应该只从 EDT 调用活动渲染（即 getGraphics() 和绘画）？这样做的一个问题是 Swing 计时器缺乏精度。

或者有没有人在不使用 EDT 的情况下成功地进行主动渲染，并完全禁用对页面的任何 EDT 更新（可能使用 Canvas / 或忽略 JPanel 上的重绘）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T18:04:48.793

您可以在另一个线程中将图形绘制到您自己的屏幕外图像中，然后在 EDT 中复制到屏幕上。但是对于单线程的东西，我希望你的帧速率足够高，能够在 EDT 中完成。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T21:30:25.677

需要注意的几件事是确保您只重新绘制需要重新绘制的内容，而不是每次都重新绘制整个图形上下文，除非有必要。还有一个[计时框架](https://timingframework.dev.java.net/)，您可以使用它来处理一些动画。我不认为它正在积极开发中，但上次我查看它时，它有一些不错的 api 可用于动画。

在不知道您的具体用例的情况下，这就是我所能想到的。

# ide - Sybase Powerbuilder 的替代 IDE

> ID：686846
> 
> 赞同：14
> 
> 时间：2009-03-26T17:46:06.980
> 
> 标签：ide, powerbuilder

有谁知道 Sybase Powerbuilder 的替代 IDE？在使用 VS2008 和 Eclipse 之后，感觉很笨拙。

如果没有，是否有人在 IDE 之外成功使用过这种语言？我并不反对使用简单的文本编辑器，但我发现 edit-import-regenerate-test-export-edit 比简单地使用 Powerbuilder 编辑器更笨拙。

迄今为止，我使用过的唯一工具是：

*   PowerGen，用于构建（使用 NUnit 和 CruiseControl.NET）
*   ConTEXT，为 Powerbuilder 提供语法高亮显示
*   PBL Peeper，它具有一些 IDE 中不存在的有趣功能

编辑：我添加了一个赏金来引起对这个问题的更广泛的关注。如果它存在，那将是一件非常好的事情。

编辑：那很令人失望。赏金显然没有让 1 个新人看到这个问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-26T20:08:04.393

PowerBuilder IDE**很**笨重，但我认为完全在 PowerBuilder IDE 之外进行开发并不是一个好主意。我认为现在有太多的依赖关系。

但是，PowerBuilder 12 的 IDE 将使用 Microsoft 的 Visual Studio 隔离 Shell 构建，因此在发布时应该会更好。另外，我相信他们将取消 PBL 格式，这应该使源代码管理更容易使用。

当然值得一看。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-26T21:04:33.650

我不知道，尽管您可以使用源代码控制工具，在您的源代码控制存储库中进行编辑，并从 PB IDE 获取最新版本以缩短您的文本编辑器周期。请注意，编辑超过 128 ASCII 的任何内容都需要 hack。（我的猜测是，这是为了让所有 Unicode 都可以在最严格的源代码控制工具中进行源代码控制。）

正如 Paul 所说，PB12 是基于 Visual Studio shell 的，将包括可折叠代码块、Intellisense 等。但是，对于 PB12，这将仅用于 WPF 目标和一些 .NET-类型目标（如程序集），我最后一次听说。Win32 目标将继续使用“经典”IDE。

祝你好运，

特里。

* * *

PS 感谢 PBL Peeper 的赞美。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-11-09T23:30:15.703

我所做的是右键单击对象并编辑源。然后我复制文本并将其粘贴到 Notepad++ 中进行编辑。我复制并粘贴回 PowerBuilder，然后我可以保存并查看任何错误。如果有人感兴趣，我有一个相当不错的 PowerScript 用户定义语言。

补充：请注意我已经看到 PB Source 编辑器损坏了 DataWindows。它们都是大型 DataWindows。为了安全起见，请始终导出 DataWindows 进行编辑。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-30T12:35:31.280

最有可能使您的 PB 体验更好的一个工具是 Visual Expert，它提供了一个很好的源浏览器。这样的工具早就应该集成到 PB IDE 中了，恕我直言。唯一的问题是它不是免费的，与您提到的其他工具相反。

关于使用外部源代码编辑器，您可能可以利用 OrcaScript，这是一种脚本语言，可让您从 IDE 外部执行诸如导出和导入 PB 对象之类的操作。这将需要一些努力，但您可以使用带有 ORCA 脚本和一些其他外部工具的批处理文件来设置基本的开发环境。但是，此设置将缺乏任何可视化编辑功能，这意味着没有（可行的）GUI 或 DW 工作。如果您主要关注 NVO，它可能会起作用。但是，如果是这样的话，为什么要首先使用 PB 呢？...

我也听说 PB12 对 VS 的使用将仅限于一些 .NET 东西，这可能只会使 PB 程序员社区中的一小部分受益。恐怕我们其他人在未来几年都被糟糕的 IDE 所困。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-31T04:16:06.067

除了导出源代码并对其进行编辑之外，我不知道其他 IDE 用于 PB。您可能遇到的一个问题是导出的源代码包含许多手册中未记录的语法。PB IDE 会生成此代码，但不支持手动创建它。我认为你被 PB IDE 困住了

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-12-30T12:31:49.173

在我从 Powerbuilder 5/6 开始到现在使用 PB 10 的五年经验中，我很想：

*   基于 Powerbuilder 从 classdefinition 对象构建我自己的浏览器
*   尝试使用自动热键以舒适地打开数据窗口（我们在项目中有数千个，我是两指驱动的）
*   使用由 sybase 破坏的 autohotkey 脚本支持的外部编辑器/IDE 真正研究了这个想法，只允许鼠标单击使用 PB
*   使用既不是真正集成到 IDE 中的 Visual Expert，也不是真正值得分析 datwindow/powerscript 交互
*   以建立对 PB12 Visual Studio 的希望结束，它缺乏 - 取决于兼容性问题 - ...

...我得出的结论是，没有机会将 Powerbuilder 改进为最先进的语言

在我的哲学中——我在那些年中获得的——我区分了两种面向 OOP 的语言：

*   使用 C#、Python、Ruby (C++) 等面向对象的奖励，以及**Java-Eclipse/Netbeans-Universe**所做的非常多的事情
*   例如，另一个使用 Powerbuilder 和旧 Visual Basic 等面向对象的惩罚（这是导致 OOP-Idea 之后出现并被“插入”的原因）。尤其是所有对象都应该总是被编译（重新生成）并且你不能同时使用祖先和分离对象的需求使得使用真正的 OOP 变得很痛苦。

...纪念过去美好的 Unix(Solaris)/C++ 日子...

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-03-15T17:17:41.790

我正在研究一种类似于 PowerBuilder 的替代解决方案，我遇到了两个引起我注意的解决方案。

第一个是我通过 Alternativeto.net 找到的“React Studio” [https://reactstudio.com/ 。](https://reactstudio.com/)

第二个是来自一些谷歌搜索顶部的广告，但它足够相似，乍一看看起来足够好，让我想仔细看看它，它被称为“Servoy” [https://servoy。 com/](https://servoy.com/) .

仍在研究，但我目前将 React Studio 放在我们列表的顶部。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-11-23T13:14:09.540

TextPad 编辑器有一个由 anr@aon.at 提供的 PowerBuilder 6.x 语法定义文件，我在几年前免费下载并定制了该文件。它适用于更高版本（包括 8），在 PowerScript srx 文件上进行关键字颜色突出显示。在 PB 中编辑大型源文件可能会导致崩溃，因此导出到 srx 文件，在 IDE 外部编辑然后重新导入通常更安全、更快、更方便。

# .net - .NET 中的 base_convert

> ID：686847
> 
> 赞同：7
> 
> 时间：2009-03-26T17:46:19.430
> 
> 标签：.net, integer, base-conversion

.NET 是否具有与 PHP 的[base_convert](http://php.net/base_convert)等效的本机函数，还是我需要自己编写？我想从任何基数转换为任何其他基数——“到”基数或“从”基数可以是 2-36 的任何整数。

PHP 函数示例：base_convert($number_to_convert, $from_base, $to_base)

```
// convert 101 from binary to decimal
echo base_convert('101', 2, 10);
// 5 
```

正如 Luke 在 Jon Skeet 回答的评论中指出的那样：Convert.ToString 无法处理与任意基数之间的转换，只有 2、8、10 和 16

**更新：**显然，答案是：不，没有原生方式。下面，Erik 展示了一种方法来做到这一点。另一个实现在这里： http: [//www.codeproject.com/KB/macros/Convert.aspx](http://www.codeproject.com/KB/macros/Convert.aspx)

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-26T17:47:29.287

**编辑：这个答案非常方便，但仅适用于基数 2、8、10 和 16**

您可以使用[`Convert.ToInt32(text, base)`](http://msdn.microsoft.com/en-us/library/1k20k614.aspx)然后[`Convert.ToString(number, base)`](http://msdn.microsoft.com/en-us/library/14kwkz77.aspx)：

```
using System;

class Test
{
    static void Main()
    {
        int number = Convert.ToInt32("101", 2);
        string text = Convert.ToString(number, 10);
        Console.WriteLine(text); // Prints 5
    }
} 
```

如果您要转换为以 10 为基数，则无需指定 - 这是默认值。

请注意，这仅适用于基数 2、8、10 和 16。如果您需要其他任何内容，则必须编写自己的解析器/格式化程序。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-26T18:34:11.843

下面是一些代码，可以将整数转换为最多 36 的任意基数，并将基数 x 值的字符串表示形式转换为整数（给定基数）：

```
class Program {
    static void Main(string[] args) {
        int b10 = 123;
        int targetBase = 5;

        string converted = ConvertToBase(b10, targetBase);
        int convertedBack = ConvertFromBase(converted, targetBase);

        string base3 = "212210";
        string base7 = ConvertFromBaseToBase(base3, 3, 7);

        Console.WriteLine(converted);
        Console.WriteLine(convertedBack);
        Console.WriteLine(base7);
        Console.ReadLine();
    }

    private const string chars = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";

    private static string ConvertToBase(int b10, int targetBase) {
        if (targetBase < 2) throw new ArgumentException("Target base must be greater than 2.", "targetBase");
        if (targetBase > 36) throw new ArgumentException("Target base must be less than 36.", "targetBase");

        if (targetBase == 10) return b10.ToString();

        StringBuilder result = new StringBuilder();

        while (b10 >= targetBase) {
            int mod = b10 % targetBase;
            result.Append(chars[mod]);
            b10 = b10 / targetBase;
        }

        result.Append(chars[b10]);

        return Reverse(result.ToString());
    }

    private static int ConvertFromBase(string bx, int fromBase) {
        if (fromBase < 2) throw new ArgumentException("Base must be greater than 2.", "fromBase");
        if (fromBase > 36) throw new ArgumentException("Base must be less than 36.", "fromBase");

        if (fromBase == 10) return int.Parse(bx);

        bx = Reverse(bx);
        int acc = 0;

        for (int i = 0; i < bx.Length; i++) {
            int charValue = chars.IndexOf(bx[i]);
            acc += (int)Math.Pow(fromBase, i) * charValue;
        }

        return acc;
    }

    public static string ConvertFromBaseToBase(string bx, int fromBase, int toBase) {
        int b10 = ConvertFromBase(bx, fromBase);
        return ConvertToBase(b10, toBase);
    }

    public static string Reverse(string s) {
        char[] charArray = new char[s.Length];
        int len = s.Length - 1;
        for (int i = 0; i <= len; i++)
            charArray[i] = s[len - i];
        return new string(charArray);
    }
} 
```

如果你不关心显示这些值，你可以在你的字符集中使用扩展字符——如果你坚持纯 ascii，理论上你可以有 base256 值。除此之外，我建议不要使用字符，而是使用其他一些唯一可识别的值——尽管我看不到它的价值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-29T15:17:31.330

在 ConvertToBase 中，以下行：

而 (b10 > targetBase)

...应该：

而 (b10 >= targetBase)

它负责在转换后的数字中弹出基数（例如，将“3”转换为基数 3 产生“3”而不是“10”）。

# mysql - 回滚失败的 Rails 迁移

> ID：686852
> 
> 赞同：82
> 
> 时间：2009-03-26T17:49:34.397
> 
> 标签：mysql, ruby-on-rails, rails-activerecord, rails-migrations

如何回滚失败的 Rails 迁移？我希望这`rake db:rollback`会撤消失败的迁移，但是不，它会回滚先前的迁移（失败的迁移减去一）。而且`rake db:migrate:down VERSION=myfailedmigration`也不行。我遇到过几次，这非常令人沮丧。这是我为复制问题所做的一个简单测试：

```
class SimpleTest < ActiveRecord::Migration
  def self.up
    add_column :assets, :test, :integer
    # the following syntax error will cause the migration to fail
    add_column :asset, :test2, :integer
  end

  def self.down
    remove_column :assets, :test
    remove_column :assets, :test2
  end
end 
```

结果：

```
== SimpleTest：迁移============================================== ========
-- add_column(:assets, :test, :integer)
   -> 0.0932 秒
-- add_column(:asset, :error)
耙中止！
发生错误，所有后续迁移均已取消：

参数数量错误（2 对 3）

```

好的，让我们回滚：

```
$ 耙分贝：回滚
== AddLevelsToRoles：还原 ============================================= ==
-- remove_column(:roles, :level)
   -> 0.0778 秒
== AddLevelsToRoles：恢复（0.0779s）=======================================

```

嗯？那是我在 SimpleTest 之前的最后一次迁移，而不是失败的迁移。（哦，如果迁移输出包含版本号，那就太好了。）

因此，让我们尝试为失败的迁移 SimpleTest 运行 down：

```
$ rake db:migrate:down VERSION=20090326173033
$

```

什么也没有发生，也没有输出。但也许它还是运行了迁移？因此，让我们修复 SimpleTest 迁移中的语法错误，并尝试再次运行它。

```
$ rake db:migrate:up VERSION=20090326173033
== SimpleTest：迁移============================================== ========
-- add_column(:assets, :test, :integer)
耙中止！
Mysql::Error: Duplicate column name 'test': ALTER TABLE `assets` ADD `test` int(11)

```

没有。显然 migrate:down 没有用。它没有失败，它只是没有执行。

除了手动进入数据库并删除它，然后运行测试之外，没有办法摆脱那个重复的表。一定有比这更好的方法。

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2009-03-26T18:26:32.687

不幸的是，您必须手动清理 MySQL 的失败迁移。MySQL 不支持事务性数据库定义更改。

Rails 2.2 包含 PostgreSQL 的事务迁移。Rails 2.3 包含 SQLite 的事务迁移。

这并不能真正帮助您解决现在的问题，但是如果您在未来的项目中可以选择数据库，我建议您使用支持事务性 DDL 的数据库，因为它使迁移更加愉快。

*更新 - 这在 2017 年仍然如此，在 Rails 4.2.7 和 MySQL 5.7 上，由 Alejandro Babio 在此处的另一个答案中报告。*

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-03-26T18:00:38.957

要转到指定版本，只需使用：

```
rake db:migrate VERSION=(the version you want to go to) 
```

但是，如果迁移中途失败，您必须先清理它。一种方法是：

*   编辑`down`迁移方法以撤消`up`有效的部分
*   迁移回之前的状态（你开始的地方）
*   修复迁移（包括撤消对 的更改`down`）
*   再试一次

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2011-03-29T01:01:15.227

好的，伙计们，这就是你实际的做法。我不知道上面的答案在说什么。

1.  找出向上迁移的哪一部分有效。把那些注释掉。
2.  还要注释掉/删除破坏的迁移部分。
3.  再次运行迁移。现在它将完成迁移的未损坏部分，跳过已经完成的部分。
4.  取消注释您在步骤 1 中注释掉的迁移位。

如果您想验证您现在是否拥有它，您可以向下迁移并再次备份。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2010-12-10T10:09:53.173

我同意你应该尽可能使用 PostgreSQL。但是，当您被 MySQL 卡住时，您可以通过首先在测试数据库上尝试迁移来避免大多数这些问题：

```
rake db:migrate RAILS_ENV=test 
```

您可以恢复到以前的状态，然后再试一次

```
rake db:schema:load RAILS_ENV=test 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2015-04-29T11:58:20.713

在 2015 年，使用 Rails 4.2.1 和 MySQL 5.7，无法使用 Rails 提供的标准 rake 操作修复失败的迁移，就像 2009 年一样。

MySql 不支持回滚 DDL 语句（在[MySQL 5.7 Manual](https://dev.mysql.com/doc/refman/5.7/en/cannot-roll-back.html)中）。而 Rails 对此无能为力。

此外，我们可以检查 Rails 是如何完成这项工作的：迁移被[包装在事务中，](https://github.com/rails/rails/blob/v4.2.1/activerecord/lib/active_record/migration.rb#L1038-L1051)具体取决于连接适配器如何响应`:supports_ddl_transactions?`. 在 rails 源码（v 4.2.1）搜索了这个动作后，发现只有[Sqlite3](https://github.com/rails/rails/blob/v4.2.1/activerecord/lib/active_record/connection_adapters/sqlite3_adapter.rb#L141)和[PostgreSql](https://github.com/rails/rails/blob/v4.2.1/activerecord/lib/active_record/connection_adapters/postgresql_adapter.rb#L319)支持事务，[默认](https://github.com/rails/rails/blob/v4.2.1/activerecord/lib/active_record/connection_adapters/abstract_adapter.rb#L185)不支持。

**编辑** 因此，对原始问题的当前答案：必须手动修复失败的 MySQL 迁移。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-04-01T17:41:30.343

执行此操作的简单方法是将所有操作包装在事务中：

```
class WhateverMigration < ActiveRecord::Migration

 def self.up
    ActiveRecord::Base.transaction do
...
    end
  end

  def self.down
    ActiveRecord::Base.transaction do
...
    end
  end

end 
```

正如 Luke Francl 所指出的，“MySql['s MyISAM 表不] 支持事务”——这就是为什么您可以考虑总体上避免使用 MySQL 或至少特别避免使用 MyISAM。

如果您使用的是 MySQL 的 InnoDB，那么上面的方法就可以了。up 或 down 中的任何错误都将退出。

**请注意**，某些类型的操作无法通过交易恢复。通常，表更改（删除表、删除或添加列等）无法回滚。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-01-24T22:37:05.153

从控制台运行向下迁移：

[http://gilesbowkett.blogspot.com/2007/07/how-to-use-migrations-from-console.html](http://gilesbowkett.blogspot.com/2007/07/how-to-use-migrations-from-console.html)（点击进入他的馅饼）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-03-02T10:04:42.760

我有一个错字（在“add_column”中）：

> def self.up
> 
> ```
> add_column :medias, :title, :text
> add_colunm :medias, :enctype, :text 
> ```
> 
> 结尾
> 
> def self.down
> 
> ```
> remove_column :medias, :title
> remove_column :medias, :enctype 
> ```
> 
> 结尾

然后是您的问题（无法撤消部分失败的迁移）。在谷歌搜索失败后，我运行了这个：

> def self.up
> 
> ```
> remove_column :medias, :title
> add_column :medias, :title, :text
> add_column :medias, :enctype, :text 
> ```
> 
> 结尾
> 
> def self.down
> 
> ```
> remove_column :medias, :title
> remove_column :medias, :enctype 
> ```
> 
> 结尾

如您所见，我只是手动添加了校正线，然后在签入之前再次将其删除。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-05-01T18:07:02.147

Alejandro Babio 上面的回答提供了当前最好的答案。

我想补充的一个额外细节：

当`myfailedmigration`迁移失败时，它不被认为是应用，这可以通过运行来验证`rake db:migrate:status`，它会显示类似于以下的输出：

```
$  rake db:migrate:status
database: sample_app_dev

 Status   Migration ID    Migration Name
--------------------------------------------------
   up      20130206203115  Create users
   ...
   ...
   down    20150501173156  Test migration 
```

对失败的迁移执行的剩余影响`add_column :assets, :test, :integer`必须在数据库级别通过`alter table assets drop column test;`查询来逆转。

# multiple-domains - 国家域名、One.com 和 google

> ID：686855
> 
> 赞同：1
> 
> 时间：2009-03-26T17:50:26.440
> 
> 标签：multiple-domains

嗨，我有一个公司的多个国家域和一个顶级 .com 域。我希望通过拥有 www.mydomain.com/us /uk /fr 等来巩固这些，并将国家域指向每个部分，但不想失去谷歌排名。我还在每个国家/地区域上添加了单词帐户。我想知道构建所有这些的最佳方法是什么？？？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T17:51:32.850

301 在每个国家域上重定向到相应的页面。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T18:27:57.690

使用 mod rewrite .htaccess 这应该会保留您网页的 Google Page Ranks。 [http://httpd.apache.org/docs/1.3/mod/mod_rewrite.html](http://httpd.apache.org/docs/1.3/mod/mod_rewrite.html)

# open-source - 我可以根据 GPL 规则发布链接到闭源产品的开源库吗？

> ID：686857
> 
> 赞同：5
> 
> 时间：2009-03-26T17:50:42.103
> 
> 标签：open-source, licensing, gpl

我开始构建一个使用开源库的商业应用程序。我一直在研究各种文件和帖子，但我仍然遇到问题。据我了解，我需要“隔离”开源部分。做到这一点的一种方法是提供一个通过“vanilla”链接与开源通信的类。

建议的解决方案是修改开源（命令行实用程序），为其提供某种 API。然后开发使用 API 与开源程序通信的包装器或代理程序。将修改后的源代码和包装器作为开放源代码发布，但保持源代码的其余部分关闭。请注意，开源部分将与代码一起交付并作为静态或动态链接库执行。

这在 GPL 下有效吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T17:55:45.397

不，如果它是 GPL 并且您与之链接，那么您的代码也将成为 GPL。如果是 LGPL，情况就不同了（您可以构建与 LGPL 许可库链接的商业应用程序），但这里的情况似乎并非如此。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T18:04:58.603

如果你不链接它，你就很清楚了。因此，无需为这个开源命令行工具开发 API，只需编写一个小包装器，直接在命令行上与程序交互即可。

由于您没有链接，现在只是执行二进制文件，因此您的代码不必在 GPL 下发布。

您可以使用 fork、pipe、exec 和朋友来执行此操作！这是一个简单的解决方案，取决于应用程序如何期望它在命令行上的输入，它可以很好地工作（基于诅咒的东西更难......需要某种终端）

编辑：

从评论看来，即使这也是无效的，仍然可能导致问题。我建议联系律师以确保您清楚，他将能够解释 GPL 并告诉您您可以使用 GPL 代码做什么和不可以做什么。

我认为仅执行 GPL 程序然后向其发送数据（ala 管道数据）不应导致您的程序也被 GPL 程序。

GPL 太复杂了，如果我使用命令行工具来执行它并将数据传输到它，我的程序仍然可以成为 GPL。这很奇怪。一天中的任何时候都给我 BSD 或 MIT，这样更容易理解。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T18:20:00.457

不要相信那些谈论远程过程调用 (COM) 或标准 IO 的人。如果有任何东西的话，标准的 IO 东西来自遗留情况，例如将输出管道传输到 grep 并将其管道传输到其他应用程序。

相反，请这样想： **您的应用程序是 GPL 组件的派生作品吗？** 您能否向一个相当聪明的外行解释一下为什么您的应用程序不是开源库的衍生品。您可以解释 stdio 包装器和 COM 接口，直到您脸色发青，但您的律师、法官、客户或任何人不会购买它。相反，您必须证明删除该 GPL 库不会显着修改应用程序的操作。如果你不能做到这一点，那么，对不起，但你如履薄冰。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T18:03:55.317

在开始之前，我应该说我不是律师，这不应被视为法律建议。如果您需要法律建议，您应该聘请律师。

只要您将程序链接到 GPL 软件，您的软件就被视为 GPL 软件的衍生作品。

如果您希望使用 GPL 软件，您应该在 GPL 或与 GPL 兼容的许可下发布您的软件。否则，您应该找到另一个软件来满足您的需求，或者自己编写。GPL 的重点是许可的价格是您还可以根据自由软件许可发布衍生作品的源代码。如果您在不支付适当许可费用的情况下不考虑使用专有软件，则不应使用 GPL

您可以隔离它的唯一方法是拥有一个完全独立的可执行文件，该可执行文件通过通用接口（套接字、管道或其他东西）进行通信，以便您的软件或 GPL 软件可以轻松替换。它通信的接口需要非常通用；它不能依赖于 GPL 软件的实现细节，例如内部数据布局或任何类似的东西。基本上，如果它通过可用作通用标准的协议进行通信，那么您的软件可以与 GPL 软件进行通信，而不会被视为衍生作品。

无论如何，虽然可以通过专有软件与 GPL 软件进行通信，但您不应该特意这样做。您将违反 GPL 的精神，并且必须非常小心地使接口具有足够的通用性，以免被视为侵权。相反，您应该找到一个具有不同许可证的软件来满足您的需要，自己编写它，或者在与 GPL 兼容的许可证下发布您的软件。

**编辑**：Linux Weekly News 上有一篇关于这个主题的[有趣文章。](http://lwn.net/SubscriberLink/325899/e46ac43e803eebd0/)根据文章中的分析，即使您分离出一个可以在命令行上与 GPL 软件通信的接口，您也应该将其作为与 GPL 代码一起使用的一组洁净室实现，一组执行其他软件，并且在它们之间传递的所有规范都由律师过滤。所以，真的，麻烦多于它的价值。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T18:05:05.657

对于 GPL，我认为唯一的出路是将其包装在 COM 对象之类的东西中（这也需要是 GPL 或兼容的），并在运行时连接到该对象。由于这使您无法（静态地）与 GPL 代码链接，因此您将摆脱困境。

该技巧适用于 GPL v2 代码，但可能不适用于 GPL v3。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-26T18:22:13.213

请注意，对 GPL 的不同解释几乎与人一样多。

我不是律师，但我曾就这个问题与律师谈过。这不是法律建议。

有律师认为，动态链接违反 GPL 是可以的，并不构成衍生作品。其他人，如 RMS 和他的律师认为，动态链接是不行的，并且确实构成了派生作品。大多数人认为静态链接是衍生作品。

关于这个主题有很多争论，并且没有明确的判例法来定义在这方面什么是衍生作品，什么不是衍生作品。

参见，例如[这篇文章](http://www.novell.com/coolsolutions/feature/1532.html)

# php - 使用 PHP 的网页截图？

> ID：686858
> 
> 赞同：5
> 
> 时间：2009-03-26T17:51:10.650
> 
> 标签：php, unix, command-line, screenshot

我知道没有直接的方法可以用 PHP 截取网页的屏幕截图。实现此目的最直接的方法是什么？是否有任何命令行工具可以做到这一点，我可以从 PHP 脚本执行（我在想一些可以在'NIX OS（特别是 OS X 和/或 Linux）中运行的东西）？

编辑：或者我可以通过 SOAP 或 REST 访问的某种 Web 服务或......

编辑#2：我发现了一个讨论 CLI 选项的[相关问题](https://stackoverflow.com/questions/125951/command-line-program-to-create-website-screenshots-on-linux)，但如果有人知道任何事情，我仍然愿意接受其他方法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T17:58:07.623

[http://www.thumbshots.org/](http://www.thumbshots.org/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T18:19:19.803

[html2ps](http://freshmeat.net/projects/html2ps_php/)在相对简单的页面上做得不错，而且它对外部二进制文件的需求很少，这意味着它非常易于安装/使用。如果您控制要捕获的页面，则可以确保它们在 html2ps 中正确呈现。但是，如果您希望捕获任意 URL，我不确定 HTML2PS 的 PHP 端口是否能胜任这项任务。它也不是世界上最快的东西（复杂页面的渲染时间预计在几秒钟内），但这对于某些应用程序来说并不重要。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-28T23:06:33.590

有关执行此操作的 OSX 命令行程序，请参阅[webkit2png 。](http://www.paulhammond.org/webkit2png/)

该页面还提到了 Linux 替代方案。

[编辑]：[wkhtml2image](http://code.google.com/p/wkhtmltopdf/downloads/list)是镇上最新的孩子，它比我用过的其他任何东西都好用。

[edit2]：截至 2014 年，[PhantomJS](http://phantomjs.org/screen-capture.html)似乎是要走的路，因为它拥有我所知道的替代方案的最新 webkit 版本。

[edit3]：在 2019 年，[Puppeteer](https://github.com/GoogleChrome/puppeteer)是要走的路。官方无头镀铬，始终保持最新。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T17:54:38.083

不确定这对你来说是否足够，因为它在那里添加了一些东西，但值得一试：[http ://www.snap.com](http://www.snap.com)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T17:56:10.280

您可以使用 GD 功能[`imagegrabscreen()`](http://www.php.net/imagegrabscreen)或[`imagegrabwindow()`](http://www.php.net/imagegrabwindow)截屏，但它们目前仅在 Windows 上可用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-08-19T21:35:18.157

可以使用 Google pagespeed api 获取网站的 base64 编码图像。您可以指定桌面或移动视图，但仅限于特定大小的图像。

# c# - ASP.NET MVC 1.0 + 单声道 2.4

> ID：686865
> 
> 赞同：9
> 
> 时间：2009-03-26T17:52:03.050
> 
> 标签：c#, asp.net-mvc, mono

试图让 MVC 在 Mono 2.4 上运行（根据这里的一些线程，这是可能的），但运气不佳。我无法克服这个：

```
Compilation Error

Description: Error compiling a resource required to service this request. Review your source file and modify it to fix this error.

Compiler Error Message: : ** (/usr/local/lib/mono/2.0/gmcs.exe:5232): WARNING **: The class System.Web.Management.WebRequestErrorEvent could not be loaded, used in System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a
~/Global.asax

Show Detailed Compiler Output: //etc 
```

我已将 System.Web.dll（以及项目中的每个引用）添加到 bin 文件夹中 - 仍然不行。

有任何想法吗？

链接：

Miguel de Icaza 说这是可能的：[Twitter](http://explore.twitter.com/migueldeicaza/status/1351409209) [SO 1](https://stackoverflow.com/questions/678212/asp-net-mvc-on-mono-2-2) [SO 2](https://stackoverflow.com/questions/202430)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-30T16:53:29.350

您不需要编译 MVC（或 Mono），但您将需要 Mono 2.4，它可在 Mono 下载站点上获得。

您需要的唯一 DLL 是 System.Web.Mvc.dll。在 VS 中处理此问题的最简单方法是将该程序集的“Copy Local”设置为 true。不要复制本地任何其他 System.* 引用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-28T07:46:56.797

System.Web 引用的任何 DLL 怎么样。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-28T19:02:54.533

根据 System.Web 的[单声道状态页面](http://go-mono.com/status/status.aspx?reference=3.5&profile=2.0&assembly=System.Web)，上述类尚未实现。也许您可以包含一个链接，指向可以让它运行的线程？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-30T16:22:52.200

我不知道 ASP.NET MVC 或 Mono。

但是，看起来 DLL 应该在 GAC 或类似的地方（不确定在 Mono 的情况下使用什么术语）。DLL 具有 publickeytoken，这使其成为 GAC 的候选对象。

这有帮助吗？

# java - 平面性测试/平面嵌入的Java实现

> ID：686868
> 
> 赞同：4
> 
> 时间：2009-03-26T17:52:33.563
> 
> 标签：java, graph-layout, graph-drawing

是否有任何主要[平面性测试](http://en.wikipedia.org/wiki/Planarity_testing)算法的免费 Java 实现？Boyer-Myrvold，de Fraysseix-Rosenstiehl，见鬼，甚至是 Hopcroft-Tarjan。我一直在阅读这些论文，它们看起来都相当复杂，如果其他人已经这样做了，我宁愿跳过自己实施它们的所有工作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T18:21:18.237

[JGraphEd](http://www.jharris.ca/JGraphEd/)有一些平面性测试，但我没有使用它。

# c# - 对openGl显示进行单元测试

> ID：686871
> 
> 赞同：2
> 
> 时间：2009-03-26T17:54:35.277
> 
> 标签：c#, unit-testing, opengl

我有一个 openGL 显示器，我想为其编写单元测试。但是，我不确定应该编写什么样的测试来确保我的显示器正常工作？我知道我可以测试上下文是否已成功创建。但是，因为它是一个图形元素，并且工作正常取决于显示的内容，所以其他一切都需要手动测试吗？我应该只使用一堆调用 glGetError 吗？

这可能是一个愚蠢的问题，但我想我会问你要说什么。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T18:00:15.340

这取决于你在做什么。

您可以使用 glGetError 等对调用本身进行单元测试。这通常很有用，但通常只有一点用处。

我过去也这样做过，提前写了一系列图像，并将它们用作参考图像。然后，您可以处理您的显示，并执行诸如渲染到纹理之类的操作，并与您的参考图像进行逐个像素的比较。请注意，您可能需要在比较中具有某种程度的“模糊性”，因为不同的驱动程序对于相同的渲染可能不是像素相同的。

[例如， VTK](http://vtk.org/)在他们的仪表板测试中使用这种方法。许多测试会写入图像并将它们与“正确”的参考图像进行比较。

# asp.net - 允许网络场中的会话？StateServer 是否足够好？

> ID：686873
> 
> 赞同：22
> 
> 时间：2009-03-26T17:54:53.403
> 
> 标签：asp.net, session-state, web-farm

首先给大家介绍一下当前环境的背景。我们有许多 ASP.NET 应用程序，所有这些应用程序都在某些方面使用会话。由于流量级别，我们在多个服务器上进行了“负载平衡”，但是，我们的负载平衡设置为使用“粘性会话”，因为当前所有 Web 应用程序都设置为使用“InProc”作为会话状态。

我们正在考虑能够删除负载均衡器上的“粘性会话”配置，因为由于我们的流量负载，服务器可能而且确实会超载。我们希望采用更平衡的方法，但必须能够使用会话。

我知道用于会话状态的 SqlServer 可以工作，但是由于我们无法控制的原因，我们不能使用 SqlServer 来存储我们的状态。在研究中，StateServer 似乎是我们最好的选择。我们有一个额外的服务器，周围有大量的内存。这个服务器可以是我们整个 Web 集群的 StateServer。我们只想知道以下几点。

1.) 除了从 InProc 切换到 StateServer 的任何潜在的序列化问题之外，是否存在与上述环境丢失会话对象或生成错误有关的任何重大已知问题？

2.) 除了单点故障和稍慢的性能外，我们在使用 StateServer 时还需要注意其他任何问题。

3.) 是否有任何指标可以显示三种状态存储之间的性能差异？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-26T19:15:12.257

这是关于 asp.net 状态的一个不错的常见问题解答：[http ://www.eggheadcafe.com/articles/20021016.asp](http://www.eggheadcafe.com/articles/20021016.asp)

从那篇文章中，这里有一些关于 StateServer 的信息：

*   在网络场中，确保所有网络服务器中的 MachineKey 都相同。请参阅[KB 313091](http://support.microsoft.com/default.aspx?scid=kb;EN-US;q313091)了解如何操作。
*   另外，请确保您的对象是可序列化的。有关详细信息，请参阅[KB 312112](http://support.microsoft.com/default.aspx?scid=kb;EN-US;q312112)。
*   为了在 Web 场中的不同 Web 服务器之间维护会话状态，IIS 元数据库中网站的应用程序路径（例如 \LM\W3SVC\2）在 Web 场中的所有 Web 服务器中应该相同。有关详细信息，请参阅[KB 325056](http://support.microsoft.com/default.aspx?scid=kb;EN-US;q325056)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T19:56:21.427

我只使用过sql和in-proc。但是使用 sql server 时适用的这 3 个也适用：

*   避免在会话中存储太多信息，因为它会影响序列化和通过网络传输的数据。
*   确保您没有任何依赖于 Session_onEnd 的内容。这不适用于进程外会话。
*   关闭不使用它的页面上的会话。这对进程内会话没有影响，但对于进程外它会为您节省很多。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T19:57:06.090

确保您的服务器 etag id 在整个网络场中同步，否则客户端浏览器的缓存将被打乱。

您是否仔细检查了您的代码，以确保所有内容都可以在进程外有效地通过 LAN 进行序列化？

您是否正在解决系统中的主要性能问题？我问是因为数据库是典型的争用源。

我摆脱粘性会话的主要动机是操作灵活性，即关闭有问题的服务器或部署软件升级。因此，实施中央会话状态服务后，请确保您从操作的角度充分利用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-02T05:57:08.627

根据我的经验，我们发现本机状态服务器甚至使用 SQL Server 进行会话是一个非常可怕的场景，因为两者都有问题（主要是性能）。顺便说一句，我们也在使用粘性会话。

我认为您可以为此探索其他产品以达到绝对最佳效果。一个免费的选项是[Velocity](http://msdn.microsoft.com/en-us/library/cc645013.aspx)，但它仍然没有发布。另一个全面但经过验证的产品将是（实际上非​​常昂贵）[NCache](http://www.alachisoft.com/ncache/)。这甚至会以更低的成本帮助您进行序列化，如果您使用他们的 API，它将获得更好的结果。

看看哪个最适合您。

关于 SQL Server，如果你有足够数量的点击量，你的服务器很快就会死掉（我相信你已经有一些点击量让你做 Web Farm 或者你只是为了冗余而这样做）

底线：我们正在评估 Velocity，因为 NCAchce 非常昂贵。不过优势是巨大的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T19:08:17.470

我们将 StateServer 用于一个非常小的网络场，只有两个节点可供数百名用户使用。

我不负责它的运行，但我记得两年内只有两个问题因为服务崩溃而不得不重新启动。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-04-09T08:46:37.827

我想再强调一点接受的答案：

*   确保框架 dll 的版本相同。

在我的情况下，System.Web dll 版本不同，因为在场的一台服务器上跳过了一些 Windows 更新。

# sql-server - 在 SQL Server 中搜索全文字段以检测抄袭

> ID：686874
> 
> 赞同：0
> 
> 时间：2009-03-26T17:54:54.260
> 
> 标签：sql-server, full-text-search, plagiarism-detection

我将论文存储在 SQL Server 2005 中，并正在寻找一种粘贴论文文本的方法，然后在数据库中搜索潜在的抄袭（复制的内容）。

解决这个问题的最佳方法是什么？对于几段内容，有没有办法使用全文索引来衡量某事物与其他事物的相似程度？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T19:59:55.800

你为什么不安装谷歌桌面并让它只索引那个目录

然后你可以让谷歌为你做索引

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T18:04:01.680

这并不是 SQL Server 中的全文索引旨在解决的问题。SQL Server 没有内置任何东西可以真正帮助您解决此问题。

有许多专门的剽窃检测工具，谷歌搜索会为你找到。这可能是你最好的选择。

# java - Swing：如何将组件高度设置为容器的高度？

> ID：686882
> 
> 赞同：4
> 
> 时间：2009-03-26T17:57:18.157
> 
> 标签：java, swing

我想让一个组件占据Container的maximumAvailableHeight。例如，在下面粘贴的代码中，我将根帧设置为 800,600。我只想设置该帧的高度/宽度（我不想尝试对其子项进行像素化）。如果我运行它，我会看到一个对齐错误的 UI。

首先，我想要一个面板（位于根框架内）占据框架的 100% 高度（在本例中为 800 像素减去绘制框架标题所需的小空间）。

其次，在面板内我有一个树和文本区域。我希望它们都占据 100% 的高度，让树占据 30%，textArea 占据 70% 的宽度（如果树扩展到 10 级，那么我可以使用 ScrollPane）。

了解这在 HTML 中最容易实现。只需说 height=100% 和 width 为 30% 等，我们就完成了。有人知道这是否可以在 Swing 中完成？（我可以通过设置像素高度和布局管理器来实现这一点，但我正在寻找最简洁的解决方案来设置百分比高度和宽度。）

```
package com.ekanathk.logger.gui;

import javax.swing.*;
import javax.swing.tree.DefaultMutableTreeNode;

public class TestFrame extends JFrame {
    public TestFrame() {
        super("Top Frame");
        setDefaultCloseOperation(EXIT_ON_CLOSE);
        JPanel panel = new JPanel();
        JTree env = getEnvironmentTree();
        env.expandRow(0);
        panel.add(new JScrollPane(env));
        panel.add(new JTextArea("Some contents"));
        getContentPane().add(panel);
        setSize(800, 600);
        SwingUtil.centerComponentOnScreen(this);
        setVisible(true);
    }

    private JTree getEnvironmentTree() {
        DefaultMutableTreeNode root = new DefaultMutableTreeNode("Root");
        JTree tree = new JTree(root);
        DefaultMutableTreeNode one = new DefaultMutableTreeNode("One");
        root.add(one);
        one.add(new DefaultMutableTreeNode("under one.1"));
        one.add(new DefaultMutableTreeNode("under one.2"));
        root.add(new DefaultMutableTreeNode("two"));
        root.add(new DefaultMutableTreeNode("three"));
        return tree;
    }

    public static void main(String[] args) {
        new TestFrame();
    }
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T18:40:47.973

这使用 GridBagLayout 来做你想做的事情。您可能会使用组件的 setMinimumSize 和 setPreferedSize。

```
import java.awt.GridBagConstraints;
import java.awt.GridBagLayout;

import javax.swing.*;
import javax.swing.tree.DefaultMutableTreeNode;

public class TestFrame extends JFrame {
    private static final long serialVersionUID = 1L;

    public TestFrame()  {
        super("Top Frame");
        setDefaultCloseOperation(EXIT_ON_CLOSE);
        JPanel panel = new JPanel(new GridBagLayout());

        JTree env = getEnvironmentTree();
        env.expandRow(0);

        GridBagConstraints c = new GridBagConstraints();
        c.fill = GridBagConstraints.BOTH;
        c.weightx=.7;
        c.weighty=1;

        c.gridx=0;
        c.gridy=0;
        c.gridheight=1;
        c.gridwidth=7;
        panel.add(new JScrollPane(env),c);

        c.weightx=.3;
        c.gridx=7;
        c.gridy=0;
        c.gridheight=1;
        c.gridwidth=GridBagConstraints.REMAINDER;
        panel.add(new JTextArea("Some contents"),c);

        add(panel);
        setSize(800, 600);
        setLocationRelativeTo(null);
        setVisible(true);
    }

    private JTree getEnvironmentTree() {
        DefaultMutableTreeNode root = new DefaultMutableTreeNode("Root");
        JTree tree = new JTree(root);
        DefaultMutableTreeNode one = new DefaultMutableTreeNode("One");
        root.add(one);
        one.add(new DefaultMutableTreeNode("under one.1"));
        one.add(new DefaultMutableTreeNode("under one.2"));
        root.add(new DefaultMutableTreeNode("two"));
        root.add(new DefaultMutableTreeNode("three"));
        return tree;
    }

    public static void main(String[] args) {
        new TestFrame();
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T18:52:57.787

有许多[布局管理器](http://java.sun.com/docs/books/tutorial/uiswing/layout/visual.html)可以实现这一点——GridLayout（1x1 网格）、GridBagLayout，也许还有 BorderLayout。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T18:54:58.767

这是使用 SpringLayout 的另一种方法。我无法让 Spring.width 和 Spring.height 工作，所以我使用了更详细的方式

```
import java.awt.BorderLayout;
import java.awt.Color;

import javax.swing.JFrame;
import javax.swing.JPanel;
import javax.swing.JScrollPane;
import javax.swing.JTextArea;
import javax.swing.JTree;
import javax.swing.Spring;
import javax.swing.SpringLayout;
import javax.swing.tree.DefaultMutableTreeNode;

public class TestFrame extends JFrame {
    private static final long serialVersionUID = 1L;

    public TestFrame()  {
        super("Top Frame");
        setDefaultCloseOperation(EXIT_ON_CLOSE);        
        SpringLayout layout = new SpringLayout();
        JTree env = getEnvironmentTree();
        env.expandRow(0);
        JPanel contentPane = new JPanel(layout);
        contentPane.setLayout(layout);
        JScrollPane treePane = new JScrollPane(env);
        JTextArea area = new JTextArea("Some contents");
        contentPane.add(treePane);
        contentPane.add(area);        
        setLayout(new BorderLayout());
        add(contentPane);
        setSize(800, 600);

        SpringLayout.Constraints  cons;
        cons = layout.getConstraints(treePane);
        cons.setX(Spring.constant(0));
        cons.setY(Spring.constant(0));
        cons.setWidth(Spring.scale(layout.getConstraint(SpringLayout.EAST, contentPane), .7f));
        cons.setHeight(layout.getConstraint(SpringLayout.SOUTH, contentPane));

        cons = layout.getConstraints(area);
        cons.setX(layout.getConstraint(SpringLayout.EAST, treePane));
        cons.setY(Spring.constant(0));
        cons.setWidth(Spring.scale(layout.getConstraint(SpringLayout.EAST, contentPane), .3f));
        cons.setHeight(layout.getConstraint(SpringLayout.SOUTH, contentPane));
        setPreferredSize(getSize());
        setLocationRelativeTo(null);
        pack();
        setVisible(true);
    }

    private JTree getEnvironmentTree() {
        DefaultMutableTreeNode root = new DefaultMutableTreeNode("Root");
        JTree tree = new JTree(root);
        DefaultMutableTreeNode one = new DefaultMutableTreeNode("One");
        root.add(one);
        one.add(new DefaultMutableTreeNode("under one.1"));
        one.add(new DefaultMutableTreeNode("under one.2"));
        root.add(new DefaultMutableTreeNode("two"));
        root.add(new DefaultMutableTreeNode("three"));
        return tree;
    }

    public static void main(String[] args) {
        new TestFrame();
    }
} 
```

# sharepoint - 如何将自定义构建的 web 部件添加到列表定义项目中的自定义视图 aspx 页面

> ID：686885
> 
> 赞同：3
> 
> 时间：2009-03-26T17:58:20.180
> 
> 标签：sharepoint, sharepoint-2007

我开发了一个列表定义项目并创建了一个自定义视图 aspx 页面作为列表的默认视图。我现在想添加一个要在自定义视图 aspx 页面中显示的自定义 web 部件。关于如何完成的任何想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T18:22:00.967

您可以在功能激活期间使用功能接收器并管理 Web 部件的添加。这里有一个存根，可以帮助您入门。

在功能激活方法调用代码类似如下：

```
 // Add web parts to the .aspx page that was provisioned
        SPFile page = site.GetFile(<<page url>>);

        Hashtable hashWebPartsOnPage = new Hashtable();

        using (SPLimitedWebPartManager mgr = page.GetLimitedWebPartManager(PersonalizationScope.Shared))
        {
            try
            {
                // First, let's clear the existing web parts off of the form
                foreach (System.Web.UI.WebControls.WebParts.WebPart webPart in mgr.WebParts)
                {
                    hashWebPartsOnPage.Add(webPart.ID, webPart);
                }

                foreach (string webPartName in hashWebPartsOnPage.Keys)
                {
                    System.Web.UI.WebControls.WebParts.WebPart webPart = hashWebPartsOnPage[webPartName] as System.Web.UI.WebControls.WebParts.WebPart;
                    mgr.DeleteWebPart(webPart);
                }

                // Add Part to the proper Zone
                MyWebPart myWebPart = new MyWebPart();
                //set web part properties
                mgr.AddWebPart(myWebPart, "FullPage", 1);
            }
            finally
            {
                mgr.Web.Dispose();
            }

        }
        page.Update(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-07-07T09:57:41.977

在 SharePoint 2010 上，您可以在**List 定义的****Schema.xml**内的同一视图定义中添加自定义 Web 部件或 SharePoint WebPart （我不是在谈论 List 实例）。

 **尽管 MSDN 没有直接解释，并且如果您查看 View Schema，您看不到“<WebParts>”定义，您实际上可以执行以下操作：

```
<View BaseViewID="7" Type="HTML" WebPartZoneID="Main" DisplayName="$Resources:CILSS_defaultView" DefaultView="TRUE" MobileView="FALSE" MobileDefaultView="FALSE" SetupPath="pages\viewpage.aspx" ImageUrl="/_layouts/images/generic.png" Url="CI_Projects.aspx">
        <Toolbar Type="Standard" />
        <XslLink Default="TRUE">main_cilss.xsl</XslLink>
        <RowLimit Paged="TRUE">30</RowLimit>
        <ViewFields>
          <FieldRef Name="Attachments"></FieldRef>
          <FieldRef Name="LinkTitle"></FieldRef>
          <FieldRef Name="CILSS_ProjectDescription"></FieldRef>
        </ViewFields>
        <Query>
          <OrderBy>
            <FieldRef Name="LinkTitle" Ascending="TRUE"></FieldRef>
          </OrderBy>
        </Query>
        <ParameterBindings>
          <ParameterBinding Name="NoAnnouncements" Location="Resource(wss,noXinviewofY_LIST)" />
          <ParameterBinding Name="NoAnnouncementsHowTo" Location="Resource(wss,noXinviewofY_DEFAULT)" />
        </ParameterBindings>
        <WebParts>
          <AllUsersWebPart WebPartZoneID="Main" WebPartOrder="2">
            <![CDATA[<WebPart xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://schemas.microsoft.com/WebPart/v2">
  <Title>Default Home Webpart</Title>
  <FrameType>None</FrameType>
  <Description>Use for formatted text, tables, and images.</Description>
  <IsIncluded>true</IsIncluded>
  <ZoneID>Left</ZoneID>
  <PartOrder>0</PartOrder>
  <FrameState>Normal</FrameState>
  <Height />
  <Width />
  <AllowRemove>true</AllowRemove>
  <AllowZoneChange>true</AllowZoneChange>
  <AllowMinimize>true</AllowMinimize>
  <AllowConnect>true</AllowConnect>
  <AllowEdit>true</AllowEdit>
  <AllowHide>true</AllowHide>
  <IsVisible>true</IsVisible>
  <DetailLink />
  <HelpLink />
  <HelpMode>Modeless</HelpMode>
  <Dir>Default</Dir>
  <PartImageSmall />
  <MissingAssembly>Cannot import this Web Part.</MissingAssembly>
  <PartImageLarge>/_layouts/images/mscontl.gif</PartImageLarge>
  <IsIncludedFilter />
  <Assembly>Microsoft.SharePoint, Version=12.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c</Assembly>
  <TypeName>Microsoft.SharePoint.WebPartPages.ContentEditorWebPart</TypeName>
  <ContentLink xmlns="" />
  <Content xmlns="http://schemas.microsoft.com/WebPart/v2/ContentEditor">
  <Value>&lt;div&gt;Create and view Project documents:&lt;/div&gt;
&lt;br/&gt;</Value></Content>
  <PartStorage xmlns="http://schemas.microsoft.com/WebPart/v2/ContentEditor" />
</WebPart>]]>
          </AllUsersWebPart>
        </WebParts>
      </View> 
```

此视图定义在名为“CI_Projects.aspx”的列表视图中包含一个内容编辑器 Web 部件，请记住分配 WebPartZoneId 并分配与列表定义中包含的默认视图不同的 BaseViewID。

Webpart 将在您将使用此列表定义创建的每个列表上进行配置。（显然仅在您定义的命名 view.aspx 上）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T13:54:19.777

好吧，我想访问我认为无法使用上述 site.GetFile() 方法访问的列表定义视图页面。您认为我们可以使用的任何其他选项来实现它。我尝试了以下步骤：

1.  复制OOB“ViewPage.aspx”并将其放在与“CustomViewPage.aspx”相同的文件夹中

2.  创建自定义 Web 部件，该部件使用您的自定义方法显示视图的项目。

3.  创建一个功能来配置“CustomViewpage.aspx”以及您的自定义 Web 部件。

4.  创建自定义列表定义。在所有视图定义的 schema.xml 文件中，提及“SetupPath”以引用您的“CustomViewPage.aspx”。通过此步骤，列表定义中提到的所有视图都将使用“CustomViewPage.aspx”来创建视图页面，并且您在创建列表后创建的所有视图都将使用“customViewPage.aspx”作为基础page 以创建视图页面。

步骤1：

只需复制 OOB“ViewPage.aspx”并将其作为“CustomViewPage.aspx”放在 C:\Program Files\Common Files\Microsoft Shared\web server extensions\12\TEMPLATE\Pages 文件夹中

第2步：

创建自定义 Web 部件，该部件使用您的自定义方法显示视图的项目。基本上使用 GetViewfromUrl(“Lists//”) 方法获取视图，然后检索 Web 部件中的项目。自定义 Web 部件的代码片段如下所示：

SPList 列表 = SPContext.Current.List;

字符串 strViewName =

SPView view = SPContext.Current.Web.GetViewFromUrl("Lists/list/ "+strViewName);

SPListItemCollection listItems = list.GetItems(view);

. .

.

.

获取列表项后，请执行显示项目的自定义方法。

构建 Web 部件 DLL 并将其放置在 GAC 中。

第 3 步：

创建一个功能来预配“CustomViewPage.aspx”以及您的自定义 Web 部件。通过激活此功能，“Customviewpage.aspx”将嵌入到您的自定义 Web 部件中。元素清单文件内容如下所示：

```
<File Url="Pages/CustomViewPage.aspx" Type="Ghostable">

  <AllUsersWebPart WebPartZoneID="Main" WebPartOrder="1">

    <![CDATA[

               <WebPart xmlns="http://schemas.microsoft.com/WebPart/v2">

                    <Assembly>CustomWebpartforView, Version=1.0.0.0, Culture=neutral, PublicKeyToken=e3483ddc8b0d437a</Assembly>

                    <TypeName> CustomWebpartforView.MyCustomview</TypeName>

                    <FrameType>None</FrameType>

                                            <IsVisible>true</IsVisible>

                    <Title>Custom Web part for View</Title>                                 

               </WebPart>

               ]]>

  </AllUsersWebPart>

</File> 
```

**此步骤为我通过在文件标记中提供 Path 属性而修改的源文件路径给出错误**

第4步：

现在，基本自定义视图页面与 Web 部件一起可用。现在如何将自定义视图页面与列表定义集成。创建自定义列表定义，并为架构中定义的所有视图提及“SetupPath”以使用“CustomViewPage.aspx”。现在自定义视图页面将用作列表定义中定义的所有视图的基本视图页面，以及稍后创建的视图也将使用“CustomViewpage.aspx”作为基本页面。在 schema.xml 中声明视图的示例片段如下：

安装并激活自定义列表定义的功能。

现在通过所有这些步骤，当您基于此自定义列表定义创建列表时，创建的所有视图都将使用“CustomViewPage.aspx”来创建视图页面，并且您的自定义 Web 部件将被呈现，而不是 OOB dataformwebpart。您将在创建列表（通过 UI，通过对象模型）之后创建的视图也将使用“CustomViewpage.aspx”作为基本页面来创建视图页面。

**出于某种原因，我仍然无法通过我的自定义 webpart 看到 CustomViewPage.aspx。我是否遗漏了什么，或者这篇文章中遗漏了什么。**

# asp.net - 如何绕过强制登录令牌认证服务？

> ID：686889
> 
> 赞同：0
> 
> 时间：2009-03-26T18:00:36.447
> 
> 标签：asp.net, login

好的，所以每当有人访问我们的网站但未登录时，它就会推送到登录页面并让他们登录，然后将他们推送回他们尝试访问的页面。我的任务是创建一个通过 xml 返回报告数据的服务（使用 ASHX）。这一切都完成了，但是为了访问它，你必须登录。我将让他们通过查询字符串传递一个令牌来验证它是一个有效的请求，而不是登录。但是我不确定如何绕过强制登录。这太模糊了还是有人有任何想法？我想最后的努力是在 ISS 中创建一个完全独立的站点，但如果可能的话，我想避免这种情况。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T18:03:24.210

在同一站点中执行此操作的一种方法是让您的服务匿名访问，然后在服务内部针对令牌进行自己的身份验证。

编辑：

要允许匿名，请在 web.config 中添加一个部分，以允许对包含您的服务的目录进行完全访问。例如，您的服务是[http://www.foo.com/Services/bar.asmx](http://www.foo.com/Services/bar.asmx) .. 将此添加到您的 web.config 中，您的其他授权部分是：

```
<location path="Services">
    <system.web>
        <authorization>
            <allow users="*" />
        </authorization>
    </system.web>
</location> 
```

然后，在您的服务中，验证您传入的令牌，无论您想要什么。如果身份验证未通过，则抛出 SoapException。如何进行身份验证取决于您当前在登录页面中的身份验证方式。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T18:48:25.943

只需更改您的登录页面以查看推荐人或 URL 以获取您的详细信息。

如果找到它，则自动使其验证您已设置的此用户。

例如。

```
// In your signin aspx file
bool bYourCriteriaIsMet = true; // do something here like check the referrer or querystring etc..";
if (bYourCriteriaIsMet)
{
    FormsAuthentication.RedirectFromLoginPage("Your Temp User Name", false);
} 
```

只需弄清楚您需要验证的内容，然后手动进行重定向。

您也可以只在非安全区域中访问您想要访问的页面，例如您的登录页面所在的位置，然后任何人都可以访问它，而不必担心所有这些重定向和身份验证内容。

# svn - 如何像 Google Code Hosting 那样实现 /svn-history/ 路径？

> ID：686892
> 
> 赞同：9
> 
> 时间：2009-03-26T18:01:48.707
> 
> 标签：svn, http

当您通过 Apache Httpd 发布 Subversion 存储库时，您获得了一项额外功能：您可以使用任何 HTTP 客户端浏览源代码的 HEAD 版本。

例如，我们有这个存储库：

```
http://trash-cli.googlecode.com/svn/trunk/ 
```

使用任何 HTTP 客户端（例如 Firefox），您都可以浏览 HEAD 版本的文件。svnbook 很好地解释了如何做到这一点。

但是谷歌代码托管提供了一个额外的功能：您还可以浏览过去的修订。例如，您可以浏览 r10 修订版：

```
http://trash-cli.googlecode.com/svn-history/r10/trunk/ 
```

你知道谷歌是怎么做到的吗？我也希望在我的公司存储库中使用此功能！:)

谢谢

**更新 1**

以下行为可能有助于我们解决问题。例如，如果我访问存储库中不存在的路径

```
http://trash-cli.googlecode.com/svn-history/r10/non-existent 
```

我收到以下 404 错误：

> 未找到
> 
> 在此服务器上找不到请求的 URL /svn/!svn/bc/10/non-existent。

我怀疑场景下有URL重写规则。

**更新 2**

请注意，这与[这个问题](https://stackoverflow.com/questions/651305/how-do-i-browse-an-old-revision-of-a-subversion-repository-through-the-web-view/651322)不同。我想以一种让用户感到舒适的方式在我的公司存储库中公开此服务，就像 Google 代码所做的那样，我对如何在没有此功能的外部存储库中获取旧版本不感兴趣。我使用的是服务提供者的视角，而不是用户的视角。我想让我的同事们的生活更轻松。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-26T22:08:18.443

从[颠覆 1.6 发行说明](http://subversion.tigris.org/svn_1.6_releasenotes.html#historical-uris)：

> **`mod_dav_svn`（服务器）的新公共“历史”HTTP URI 语法**
> 
> `mod_dav_svn`现在支持新的公共 URI 语法来检查旧版本的文件或目录。这里的目的是允许用户在不使用 svn 客户端的情况下检查历史记录，并使第 3 方工具（例如代码审查服务）更容易直接针对存储库工作而不使用 svn 库。
> 
> [http://host/repos/path?[p=PEG][&r=REV]](http://host/repos/path?[p=PEG][&r=REV])

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T18:10:06.517

我相信基本安装（来自 SubVersion 团队）并没有开箱即用这个功能。我相信人们已经在 Subversion 客户端之上或与之结合构建了扩展或程序来获得该功能。

如果您运行存储库，您可能可以安装 WebSVN ( [http://websvn.tigris.org/](http://websvn.tigris.org/) ) 来获得您需要的东西。我敢肯定，还有其他选择。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T18:11:50.397

将类似这样的内容附加到您的存储库 URL：

```
!svn/bc/<revision_number>/ 
```

例如

```
http://www.example.com/svnrepository/!svn/bc/3/ 
```

**重复：** [如何通过 Web 视图浏览 Subversion 存储库的旧版本？](https://stackoverflow.com/questions/651305/how-do-i-browse-an-old-revision-of-a-subversion-repository-through-the-web-view/651322)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T18:20:54.667

我研究[了 Apache 文档](http://httpd.apache.org/docs/2.0/rewrite/rewrite_guide.html)，我认为可以使用 httpd.conf 中的这个规则来解决它。

```
RewriteRule ^/svn-history/r([0-9]+)/(.*) /svn/!svn/bc/$1/$2 
```

我还没有测试它。我稍后会测试它。

# java - Eclipse 3.4.2 在 Mac OSX 上编译 Java 1.6

> ID：686893
> 
> 赞同：4
> 
> 时间：2009-03-26T18:01:52.327
> 
> 标签：java, eclipse, macos

我的 Eclipse 3.4.2 不能在 Mac OS 10.5.6 上编译 Java 1.6，这里有人让它工作吗？似乎无论我选择哪个 JRE，它都在使用 1.5 进行编译。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T18:09:21.653

您可以进入您的应用程序属性。

右击项目->属性->Java编译器

然后单击“启用项目特定设置”。并选择编译器合规级别：1.6

另一件需要注意的事情：注意你的 Eclipse 使用的是什么编译器。我最近安装了 Fedora 10，并且安装的 Eclipse：“yum install eclipse”附带了一些 IBM javac，尽管它声称与 1.6 兼容，但拒绝编译一些 java 1.6 特定代码。

当然：查看安装了哪些 java 和 javac 版本。

哪个java

哪个javac

在终端。

此外，切换 JRE 并不能解决这个问题，因为那是运行时环境，而不是编译器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T18:31:38.307

问：你确定你已经安装了 Java 6 吗？

要验证，请查看：

```
/System/Library/Frameworks/JavaVM.framework/Versions 
```

你应该看到 1.6。

如果有 1.6，您是否在 Eclipse 中将其安装为 JRE？

要验证这一点：Pref -> Java -> Installed JREs（JDK 6 应该在那里），但要确保它指向：

```
/System/Library/Frameworks/JavaVM.framework/Versions/1.6/Home 
```

除此之外，在 Mac 上使用 Eclipse 编译 1.6 的 Java 代码没有任何其他要求。

注意：确保您也按照上面的建议检查项目级别。

如果一切都失败了，您也可以尝试[SoyLatte JDK](http://landonf.bikemonkey.org/static/soylatte/)，它是基于 OpenJDK 项目的 BSD 端口的 Mac 版 Java 的开源版本。

# css - 可变大小内容周围的CSS不规则框架？

> ID：686894
> 
> 赞同：1
> 
> 时间：2009-03-26T18:01:55.787
> 
> 标签：css, html

为这个草图道歉，但似乎最好地表达了我的问题：

```
 +---------------+----------------+-----+
        |      div      |      v.div     |  d  |
        |               |                |  i  |
        +----+----------+----------------+  v  |
        | v  |                           |     |
        | .  |                           +-----+
        | d  |                           |  v  |
        | i  |            DIV            |  .  |
        | v  |         (content)         |  d  |
        |    |       variable size       |  i  |
        +----+                           |  v  |
        | d  |                           |     |
        | i  +------------------------+--+-----+
        | v  |          v.div         |   div  |
        +----+------------------------+--------+ 
```

我试图找出围绕一些可变大小内容的 8 个 DIV 的 CSS。这些 DIV 中的每一个都有一个背景图像，因此这看起来都像一个包围中心内容的带角的相框。外部，尤其是角落 DIV 也需要是透明的，所以我之前使用的一些技巧不能很好地工作。显然，标有“v.div”的 DIV 必须扩展以填充可变的高度和宽度；角落 DIV 是固定大小的。

通过一些图像剪切和粘贴，我可能会将问题限制在这样的事情上，如果前一个无法完成：

```
 +---------------+--------------+-------+
        |      div      |      v.div   |  div  |
        |               |              |       |
        +----+----------+--------------+-+-----+
        | v  |                           |     |
        | .  |            DIV            |  v  |
        | d  |         (content)         |  .  |
        | i  |       variable size       |  d  |
        | v  |                           |  i  |
        |    |                           |  v  |
        +----+---+--------------------+--+-----+
        |   div  |         v.div      |  div   |
        +--------+--------------------+--------+ 
```

有人做过这样的事情愿意分享他们的解决方案或替代方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T18:20:25.510

这不能通过使用背景颜色/背景图像、填充和边框来解决吗？

```
<style>

#variableSize {padding: 1em;
               border: 3px solid #000;
               background-color: rgba(215,215,215,0.5);
               background-image: url(path/to/img.png);
               background-repeat: repeat;
               background-position: 0 0;
               -moz-border-radius: 2em;
               -webkit-border-radius: 2em;
              }

</style>

<div id="variableSize">
   <p>Variable size content.</p>
</div> 
```

我承认，它存在兼容性问题，但是 rgba() 的使用可以只替换为（部分）透明 png 以确保一些跨浏览器支持？

> 我不太明白这个 css 如何容纳可变大小的内容。我认为至少有 4 个固定图像 div（角）和 4 个重复图像（X 中 2 个，Y 中 2 个）。真正的问题是如何安排浮动，以及如何让重复的 div 填充可用空间 – Scott Evernden

我想我误解了这个问题，很遗憾。虽然我上面的示例确实/应该工作，但它不会提供您所追求的图像角落。

如果您使用上述建议，但在内容中包含图像作为图像角，那么它可能会起作用：

```
<style>

#variableSize {padding: 1em;
               border: 3px solid #000;
               background-color: rgba(215,215,215,0.5);
               background-image: url(path/to/img.png);
               background-repeat: repeat;
               background-position: 0 0;
               -moz-border-radius: 2em;
               -webkit-border-radius: 2em;
               position: relative;
              }

#variableSize .topLeftImg
              {border: 0 none transparent;
               position: absolute;
               top: 0;
               left: 0;
               }

#variableSize .topRightImg
              {border: 0 none transparent;
               position: absolute;
               top: 0;
               right: 0;
               }

#variableSize .bottomLeftImg
              {border: 0 none transparent;
               position: absolute;
               bottom: 0;
               left: 0;
               }

#variableSize .bottomRightImg
              {border: 0 none transparent;
               position: absolute;
               bottom: 0;
               right: 0;
               }

</style>

<div id="variableSize">
   <img class="topLeftImg" src="path/to/image.png" />
   <img class="topRightImg" src="path/to/image.png" />
   <img class="bottomLeftImg" src="path/to/image.png" />
   <img class="bottomRightImg" src="path/to/image.png" />
   <p>Variable size content.</p>
</div> 
```

#variableSize 上的填充必须等于或大于图像的宽度/高度。但应该工作吗？我今晚回家试试，如果你不先试试。

好的，工作演示，结束：[一个站点](http://www.davidrhysthomas.co.uk/so/so-css-irregular-frame-question.html "工作示例。")，某处。:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T18:09:02.963

也许这会有所帮助： http: [//www.neuroticweb.com/recursos/3-columns-layout/](http://www.neuroticweb.com/recursos/3-columns-layout/)？

或者这个：[http ://www.tanfa.co.uk/css/layouts/css-3-column-layout-v1.asp](http://www.tanfa.co.uk/css/layouts/css-3-column-layout-v1.asp)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-11-12T07:52:38.757

我相信使用 CSS3 可以通过一个 div 和多个背景来实现预期的效果。宽度、高度和最后一个背景颜色可以更改，但请记住以顶层优先顺序声明背景图像，因此在下面的示例中 topleft.png 位于其他背景图像的“前面”。

希望有帮助！

**HTML**

```
 <div class="myframedimage"></div> 
```

**CSS**

```
.myframedimage { 
  width: 100%;
  height: 100%;
  background:
    url(topleft.png) top left no-repeat,    
    url(topright.png) top right no-repeat,       
    url(bottomleft.png) bottom left no-repeat,   
    url(bottomright.png) bottom right no-repeat, 
    url(top.png) top repeat-x,             
    url(bottom.png) bottom repeat-x,        
    url(left.png) left repeat-y,            
    url(right.png) right repeat-y,     
    url(image.png) center center no-repeat,
    #5d5d5d
} 
```

[http://jsfiddle.net/jlynchdotco/2Pkg6/](http://jsfiddle.net/jlynchdotco/2Pkg6/)

# .net - Web 服务中错误处理的最佳实践

> ID：686896
> 
> 赞同：6
> 
> 时间：2009-03-26T18:02:46.893
> 
> 标签：.net, web-services, error-handling

我现在正在使用 .NET 框架（.asmx 文件，而不是 WCF）来玩弄 WebServices。我想知道告诉用户在方法调用中发生了某种业务错误的最佳实践是什么。

我的小测试用例：

我有需要向中央服务器注册的测量探针。每个探针应该有不同的物理地址。要注册，他们应该调用（通过网络服务）：

```
[WebMethod]
public void RegisterReadingStation(out Guid sessionId, Int64 physicalAddress) 
```

现在，签名并不是一成不变的——实际上，这就是我想要弄清楚的。:) 如果探测器试图使用已经占用的物理地址进行自我注册，我需要以某种方式提醒它。

在我看来，我有几种可能性：

*   抛出包含信息的 SoapException。但是，对 string::message 进行编程检查并不是那么容易。
*   使用某种值类作为返回参数（或者更简单的枚举）。如果我这样做，我想我必须手动序列化/反序列化服务器/客户端上的类？

对此有什么想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T18:06:40.160

我从每个 WebMethod 中返回一个名为 ResultSet 的小类，其中包含一个 int 错误代码和一个字符串错误消息。

这使您可以轻松检查错误/成功，并在出现问题时提供一些详细信息。

如果 WebMethod 需要返回数据，我将继承 ResultSet 以提供特定的 ResultSet 以包含数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T18:06:21.160

我认为共同的共识是使用自定义返回码（整数）。只要服务记录了可能的返回代码是什么，这应该是可行的。

# java - 在 Java 中是否可以进行类似 C++ 的资源管理

> ID：686897
> 
> 赞同：5
> 
> 时间：2009-03-26T18:02:47.970
> 
> 标签：java, raii, resource-management

在 C++ 中，我们有**资源获取即初始化**(RAII) 模式，它极大地简化了资源管理。这个想法是为任何类型的资源提供一些包装对象。包装对象的析构函数然后负责释放资源，当它超出其范围时。例如：

```
{
    auto_ptr<int> smartPointer = new int;
    // some other code

} // the memory allocated for the int is released automatically
  // by smartPointer's destructor 
```

最常见的用法是智能指针。但是，还有许多其他类型的资源（文件、互斥体、套接字等）可以以完全相同的方式进行管理。

在 Java 中，不必担心内存管理。但所有其他类型的资源仍然存在。有**finally**块，但是它的使用相当不方便，尤其是当可以抛出许多不同的异常时。

所以，我的问题是，是否有任何 Java 模式提供与 C++ RAII 等效的功能？如果没有，请分享您在该领域的最佳实践（而不是 finally，除非它使用了一些复杂的方式）。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-26T18:06:36.963

您可以使用通常的`acquire; try { use; } finally { release; }`. [或者，您可以使用Execute Around idiom](https://stackoverflow.com/questions/341971/what-is-the-execute-around-idiom)抽象资源处理。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-26T18:28:15.163

Joshua Bloch 提议在 Project Coin 中添加一个名为[Automatic Resource Management](http://mail.openjdk.java.net/pipermail/coin-dev/2009-February/000011.html)的机制到 Java（JDK 7 的小语言更改）：

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-26T18:03:40.557

最接近的等价物是`try/finally`，请参阅[http://java.sun.com/docs/books/tutorial/essential/exceptions/finally.html](http://java.sun.com/docs/books/tutorial/essential/exceptions/finally.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T19:37:48.617

对于许多编码人员来说，RAII 习惯用法的优势在于，底层资源的生命周期与作用域块相关联，使事情更容易制作和维护；最终减少因未能释放该资源而导致的错误。

不幸的是，您无法在 Java 中模仿这种行为，因为您无法创建自己的范围绑定结构。尝试解决这个问题的一种类似于 Java 的语言是 C#：

```
// explicit release
MyClass obj = MyClass();
obj.UseIt();
obj.Dispose();

// RAII-like (scope-bound) release
using(MyClass obj = new MyClass())
{
    obj.UseIt();
} 
```

也许我们将来会看到这样的功能。

# mediawiki - 如何在 mediawiki 中的模板后停止自动换行？

> ID：686898
> 
> 赞同：10
> 
> 时间：2009-03-26T18:02:58.470
> 
> 标签：mediawiki

在 mediawiki 中，每当您将模板嵌入文章中时，它总是以换行符进行（据我所知）。有什么方法可以防止这种情况发生，以便我可以将模板彼此相邻放置，而第二个模板不在新行上？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-26T18:49:38.747

如果您还没有使用该[`<includeonly>`标签，请确保不要在模板中添加任何返回](http://www.mediawiki.org/wiki/Help:Templates#Control_template_inclusion)`</includeonly>`

所以

```
<includeonly>This is a template. </includeonly> 
```

使 {{Template}}{{Template}} 输出为

```
This is a template. This is a template 
```

但，

```
<includeonly>This is a template. 

</includeonly> 
```

使 {{Template}}{{Template}} 输出为

```
This is a template. 

This is a template 
```

即使是单次退货也很危险。如果模板 A 包含：

```
<includeonly>{{B}}
</includeonly> 
```

模板 B 包含：

```
<includeonly>Text
</includeonly> 
```

然后，当您将 {{A}} 插入页面时，两个返回都是后续的并给出段落分隔符。

# python - 在python中重定向函数定义

> ID：686899
> 
> 赞同：1
> 
> 时间：2009-03-26T18:03:08.577
> 
> 标签：python, class-attributes

将类方法指向实例方法显然会导致问题：

```
class A(dict):          
    def __getitem__(self, name):
        return dict.__getitem__(self, name)

class B(object):
    def __init__(self):
        self.a = A()
        B.__getitem__ = self.a.__getitem__ 

b1 = B()
b1.a['a'] = 5
b2 = B()
b2.a['b'] = 10

c = b1['a']
d = b2['b'] 
```

给出这个错误：

```
 File ... in __getitem__
    return dict.__getitem__(self, name)
KeyError: 'a' 
```

我应该在这里做什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-26T18:13:06.777

`__getitem__`只在课堂上工作。您不能在实例基础上覆盖它。

这有效：

```
class A(dict):                  
    def __getitem__(self, name):
        return dict.__getitem__(self, name)

class B(object):
    def __init__(self):
        self.a = A()

    def __getitem__(self, item):
        return self.a[item]

b1 = B()
b1.a['a'] = 5
b2 = B()
b2.a['b'] = 10

c = b1['a']
d = b2['b'] 
```

如果`__init__`出于某种奇怪的原因要在其中定义它，则必须创建一个描述符：

```
def __init__(self):
    self.a = A()
    def mygetitem(self, item):
        return self.a[item]
    B.__getitem__ = types.MethodType(mygetitem, None, B) 
```

# .net - 有没有办法减轻维护 .NET 程序集引用的痛苦？

> ID：686903
> 
> 赞同：0
> 
> 时间：2009-03-26T18:03:41.650
> 
> 标签：.net, asp.net, reflection, assemblies, metadata

我目前正在开发一个涉及多个程序集的 Web 项目，其结构如下：

```
WebProject
 |
 +--> A (external assembly, Version 1.0.0.0)
 |
 +--> B (external assembly, Version 1.0.0.0) 
```

困难在于，为了跟踪部署的内容，我想在每次构建时更新程序集 A 和 B 的版本号。现在我正在使用该`[assembly: AssemblyVersion("1.0.*")]`技术进行此操作，但它在 WebProject 项目中造成严重破坏，因为它包含许多引用程序集 A 和 B 中的类型的 ASP.NET 页面和母版页。

除了手动更新这些引用之外，还有更简单的方法吗？

**更新**：程序集 A 和 B 存在于一个解决方案中，而 WebProject 存在于另一个解决方案中。此外，A 和 B 被强烈命名，因为它们被部署到 IIS/SharePoint 服务器。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T18:10:20.527

您是否直接引用已编译的程序集？考虑将它们添加到您的解决方案中，并将它们作为项目参考。

如果你做得对，这也适用于多个应用程序使用的程序集，因为每个“父”解决方案都可以包含引用。当然，这导致了不可避免的挑战，即了解“此更改是否会破坏任何其他应用程序”，这需要大量计划。通过对接口和/或抽象类进行编码并将无法通过重载完成的任何签名更改视为“破坏性更改”，从而需要对使用这些程序集的其他应用程序进行回归，可以稍微缓解这个问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T18:11:24.860

对于同一解决方案中的项目引用，这是自动完成的。

如果 A 和 B 不在同一个解决方案中，那么您可以将它们的引用设置为不需要特定版本（查看引用属性） - 但请注意，这仅用于编译时，因此您仍然需要重新编译A 或 B 更新时的 web 项目。

如果失败，您可能会查看程序集绑定重定向。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-12T17:29:17.960

在 Cedaron 的构建过程中，我们通过构建脚本将它们复制到 Web 项目的 bin 目录中来维护 Web 项目中的引用，而不是声明引用。

你不会认为这会奏效，但它确实有效。如果它们在 bin 目录中，则可以使用它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-24T20:24:26.127

结果我发现了一个博客，描述了一种使用 TortoiseSVN 附带的 subwcrev 工具将 1.0.0.$REV$ 替换为 1.0.0.25 或其他内容的方法。这几乎是我想要的。这是理智的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-12T17:11:50.393

我使用 powershell 脚本来做同样的事情，独立于 SVN 或任何特定版本控制系统的使用。

```
# SetVersion.ps1
#
# Set the version in all the AssemblyInfo.cs or AssemblyInfo.vb files in any subdirectory.
#
# usage:  
#  from cmd.exe: 
#     powershell.exe SetVersion.ps1  2.8.3.0
# 
#  from powershell.exe prompt: 
#     .\SetVersion.ps1  2.8.3.0
#
# last saved Time-stamp: <2009-February-11 22:18:04>
#

function Usage
{
  echo "Usage: ";
  echo "  from cmd.exe: ";
  echo "     powershell.exe SetVersion.ps1  2.8.3.0";
  echo " ";
  echo "  from powershell.exe prompt: ";
  echo "     .\SetVersion.ps1  2.8.3.0";
  echo " ";
}

function Update-SourceVersion
{
  Param ([string]$Version)

  $NewVersion = 'AssemblyVersion("' + $Version + '")';
  $NewFileVersion = 'AssemblyFileVersion("' + $Version + '")';

  foreach ($o in $input) 
  {

    #### !! do Version control checkout here if necessary 
    Write-output $o.FullName
    $TmpFile = $o.FullName + ".tmp"

     get-content $o.FullName | 
        %{$_ -replace 'AssemblyVersion\("[0-9]+(\.([0-9]+|\*)){1,3}"\)', $NewVersion } |
        %{$_ -replace 'AssemblyFileVersion\("[0-9]+(\.([0-9]+|\*)){1,3}"\)', $NewFileVersion }  > $TmpFile

     move-item $TmpFile $o.FullName -force
  }
}

function Update-AllAssemblyInfoFiles ( $version )
{
  foreach ($file in "AssemblyInfo.cs", "AssemblyInfo.vb" ) 
  {
    get-childitem -recurse |? {$_.Name -eq $file} | Update-SourceVersion $version ;
  }
}

# validate arguments 
$r= [System.Text.RegularExpressions.Regex]::Match($args[0], "^[0-9]+(\.[0-9]+){1,3}$");

if ($r.Success)
{
  Update-AllAssemblyInfoFiles $args[0];
}
else
{
  echo " ";
  echo "Bad Input!"
  echo " ";
  Usage ;
} 
```

# html - 标签文件上传按钮

> ID：686905
> 
> 赞同：52
> 
> 时间：2009-03-26T18:03:54.770
> 
> 标签：html, internationalization, dialog

如何国际化文件选择器的按钮文本？例如，此代码向用户呈现的内容：

```
 <input type="file" .../> 
```

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-03-26T18:27:40.267

它通常由浏览器提供并且很难更改，因此解决它的唯一方法是 CSS/JavaScript hack，

有关一些方法，请参见以下链接：

*   [http://www.shauninman.com/archive/2007/09/10/styling_file_inputs_with_css_and_the_dom](http://www.shauninman.com/archive/2007/09/10/styling_file_inputs_with_css_and_the_dom)
*   [http://www.quirksmode.org/dom/inputfile.html](http://www.quirksmode.org/dom/inputfile.html)
*   [http://www.dreamincode.net/forums/showtopic15621.htm](http://www.dreamincode.net/forums/showtopic15621.htm)

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2016-03-03T09:02:32.357

纯 CSS 解决方案：

```
.inputfile {
  /* visibility: hidden etc. wont work */
  width: 0.1px;
  height: 0.1px;
  opacity: 0;
  overflow: hidden;
  position: absolute;
  z-index: -1;
}
.inputfile:focus + label {
  /* keyboard navigation */
  outline: 1px dotted #000;
  outline: -webkit-focus-ring-color auto 5px;
}
.inputfile + label * {
  pointer-events: none;
}
```

```
<input type="file" name="file" id="file" class="inputfile">
<label for="file">Choose a file (Click me)</label>
```

来源：[http ://tympanus.net/codrops](http://tympanus.net/codrops/2015/09/15/styling-customizing-file-inputs-smart-way/)

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2015-07-27T09:56:58.280

退后一步！首先，您假设用户在他们的设备上使用外国语言环境，这不是一个合理的假设来证明接管文件选择器的按钮文本并使其说出***您***想要的内容。

您希望控制页面上可见的每一项语言是合理的。文件上传控件的内容不是 HTML 的一部分。这个控件后面还有更多的内容，比如在WebKit中，按钮旁边也写着“No file selected”。

有很多 hacky 变通办法可以尝试这样做（例如，@ChristopheD 的回答中提到的那些），但它们都没有真正成功：

*   对于屏幕阅读器，文件控件仍会说“浏览...”或“选择文件”，并且自定义文件上传不会被宣布为文件上传控件，而只是一个按钮或文本输入。
*   他们中的许多人无法显示选择的文件，或者显示用户不再选择文件
*   它们中的许多看起来与本机控件完全不同，因此在非标准设备上可能看起来很奇怪。
*   键盘支持通常很差。
*   一个作者创建的 UI 组件永远不会像它的原生等效组件那样功能齐全（你越接近它在 Windows 7 上假设 IE10 的行为，它就越会偏离其他浏览器和操作系统组合）。
*   现代浏览器支持拖放到本机文件上传控件。
*   某些技术可能会触发安全软件中的启发式算法，作为潜在的“点击劫持”尝试诱骗用户上传文件。

偏离本机控件始终是一件冒险的事情，您的用户可以使用大量不同的设备，无论您选择哪种解决方法，您都不会在每一个设备上都对其进行测试。

然而，从用户体验的角度来看，所有尝试都失败的一个更大的原因是：在这个控件后面还有更多的非本地化内容，即文件选择对话框本身。一旦用户受制于遍历他们的文件系统或不选择要上传的文件，他们将受制于主机操作系统区域设置。

您确定您通过偏离本机控制来为您的用户提供任何正义，只是为了本地化文本，当他们单击它时，他们无论如何都会获得操作系统区域设置？

您可以为您的用户做的最好的事情是确保您有足够的本地化指导来围绕您的文件输入控件。（例如表单字段标签、提示文本、工具提示文本）。

对不起。:-(

--

这个答案适用于那些寻找任何理由*不*本地化文件上传控件的人。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-03-26T18:05:45.763

您将获得按钮的浏览器语言。没有办法以编程方式更改它。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2017-10-29T11:05:15.207

更容易使用它

```
<input type="button" id="loadFileXml" value="Custom Button Name"onclick="document.getElementById('file').click();" />
<input type="file" style="display:none;" id="file" name="file"/> 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-03-05T04:36:28.213

我可以使用带有以下代码的 jQueryMobile 实现一个按钮：

```
<label for="ppt" data-role="button" data-inline="true" data-mini="true" data-corners="false">Upload</label>
<input id="ppt" type="file" name="ppt" multiple data-role="button" data-inline="true" data-mini="true" data-corners="false" style="opacity: 0;"/> 
```

上面的代码创建了一个“上传”按钮（自定义文本）。单击上传按钮后，将启动文件浏览。通过 Chrome 25 和 IE9 测试。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-08-19T20:29:18.193

要制作自定义“浏览按钮”解决方案，只需尝试制作隐藏的浏览按钮、自定义按钮或元素以及一些 Jquery。这样我就不会修改依赖于每个浏览器/版本的实际“浏览按钮”。这是一个[例子。](http://jsfiddle.net/nimjox/r5vmaqhx/1/)

HTML：

```
<div id="import" type="file">My Custom Button</div>
<input id="browser" class="hideMe" type="file"></input> 
```

CSS：

```
#import {
  margin: 0em 0em 0em .2em;
  content: 'Import Settings';
  display: inline-block;
  border: 1px solid;
  border-color: #ddd #bbb #999;
  border-radius: 3px;
  padding: 5px 8px;
  outline: none;
  white-space: nowrap;
  -webkit-user-select: none;
  cursor: pointer;
  font-weight: 700;
  font: bold 12px/1.2 Arial,sans-serif !important;
  /* fallback */
  background-color: #f9f9f9;
  /* Safari 4-5, Chrome 1-9 */
  background: -webkit-gradient(linear, 0% 0%, 0% 100%, from(#C2C1C1), to(#2F2727));
}

.hideMe{
    display: none;
} 
```

JS：

```
$("#import").click(function() {
    $("#browser").trigger("click");
    $('#browser').change(function() {
            alert($("#browser").val());
    });
}); 
```

# javascript - 灯箱出现问题

> ID：686908
> 
> 赞同：0
> 
> 时间：2009-03-26T18:04:09.153
> 
> 标签：javascript, css

好的，当我尝试在页面上使用它时，我下载了所有文件并将它们放入名为“灯箱”的 m 服务器上的目录中，图像弹出在页面底部，而不是像模态一样重叠。我更改了 lightbox.js 文件中的图像源以包含 lightbox/ 目录。css 文件中的图像仍然与 css 文档相关。所以我不确定为什么它不能正常工作。这是[Clicky页面的链接](http://www.kranichs.com/K_product_lightbox.php?pid=555 "只需点击下方的缩略图")

有谁知道我做错了什么？

谢谢！！

**更新**位于此处的文本页面：位于灯箱目录内的[clicky工作正常。](http://www.kranichs.com/lightbox/index.html)所以我很确定这种情况正在发生，因为我将文件放在服务器上的文件夹中，而不是仅仅放在服务器上，但我想保持文件井井有条，所以如果有人知道如何让它在目录中工作？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-27T06:55:09.737

js文件中有一些图片路径。您可以在那里修改它们......或者更好的是在 lightbox.js 脚本之前添加它

```
<script type="text/javascript">
LightboxOptions = {
    fileLoadingImage: '/lightbox/images/loading.gif',     
    fileBottomNavCloseImage: '/lightbox/images/closelabel.gif'
};
</script>

<script src="js/lightbox.js" type="text/javascript"></script> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-30T18:50:10.850

这很愚蠢，但我为 javascript 文件输入了正确的地址，但在更正它工作后，我为 CSS 文件输入了错误的地址。

# iphone - 在我的 UiTableView 中看不到最后一行

> ID：686910
> 
> 赞同：1
> 
> 时间：2009-03-26T18:04:36.063
> 
> 标签：iphone, uitableview

我在 InterfaceBuilder 中添加了一个 UITableView。我的应用程序在 LandScape 中运行。因为我无法使用自动旋转（仍然无法弄清楚）。我现在正在使用转换它。话虽如此，我现在必须将 UITableView 放在某个奇怪的位置，以便在转换后看起来正确

我的表很好，但我无法到达表中的最后几行。它几乎看起来像是它的切断。

什么设置会导致这种情况？

首先十分感谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-26T18:28:41.467

您是否尝试过记录视图的宽度和高度？也许视图太大并且将 UITableView 缩放到很大？

到目前为止，我对 UITableViews 和旋转没有任何问题。

# c# - 如何确保在 IDisposable 对象上调用 Dispose 方法，并在可能的情况下将其集成到持续集成中？

> ID：686923
> 
> 赞同：2
> 
> 时间：2009-03-26T18:06:09.583
> 
> 标签：c#, unit-testing

通常不调用 Dispose 表示可能的错误或草率的代码，并可能导致一些难以发现的错误。理想情况下，我想发现在单元测试期间是否未调用 Disposed。

我们使用的一种方法是将 Debug.Assert 放入 Finalizer

```
#if DEBUG
~MyClass()
{
    Debug.Assert(false, “MyClass.Dispose() was not called”);
}
#endif 
```

我们发现自己点击了断言消息框，但它不适用于忽略弹出窗口的持续集成构建。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T18:22:55.130

如果您以某种方式记录它而不是使用 Debug.Assert，并使用依赖注入来指定您的记录器实现，那么您可以使用模拟测试来捕获它。因此，您的类可能在其构造函数中采用一个记录器实例，或者提供一个默认实例，然后行为如下：

```
public MyClass : IDisposable
{

IEventLogger _eventLogger;

public MyClass() : this(EventLogger.CreateDefaultInstance())
{
}

public MyClass(IEventLogger eventLogger)
{
    _eventLogger = eventLogger;
}

// IDisposable stuff...

#if DEBUG
~MyClass()
{
    _eventLogger.LogError("MyClass.Dispose() was not called");
}
#endif

} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T21:15:46.367

可以编写 fxCop 规则来检测此问题。

此外，确保 IDisposable 的所有用法都在 using{} 块中使用，这样更容易处理。

我检查过的规则是手动调用 Dispose() 还是使用 using{}

当然，手动调用 dispose 在所有情况下都更难检测到，因为可能存在可能阻止调用发生的流控制或异常。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-27T19:00:54.797

您可以使用 Mock 对象框架（如 RhinoMocks）来确保调用 IDisposable.Dispose()。如果未调用 Dispose()，则框架将自动使构建失败。

# php - 使用 PHP 模板或 jQuery AJAX 调用？

> ID：686924
> 
> 赞同：0
> 
> 时间：2009-03-26T18:06:09.990
> 
> 标签：php, jquery, ajax

这是我`index.php`页面的一个片段，我在其中显示了一个包含三个 HTML 链接的菜单。

选择菜单项定义页面参数，然后 PHP 模板逻辑将加载该参数并填充到`<div id="main">`.

```
<div class="span-24" id="menu">
  <table>
    <tr>
      <td><a href="index.php?page=races">Races</a></td>
      <td><a href="index.php?page=runners">Runners</a></td>
      <td><a href="index.php?page=searchRunners">Search</a></td>
    </tr>
  </table>
<br/>
</div>

<!-- main content -->
<div class="span-24" id="main">
<?php 
  $MYROOT=$_SERVER['DOCUMENT_ROOT'];
  if(isset($_GET['page']))
  {
    $page=$_GET['page'];
    @ require_once($MYROOT."/$page.php");
  }
  else
  {
    @ require_once($MYROOT."/races.php");
  }
?>
</div> 
```

该解决方案工作正常，但我担心随着我添加更多页面并有更多页面参数要跟踪，这种方法将变得难以使用各种 PHP `require()`/`require_once()`方法调用来维护。

我也有可用的 jQuery，我想知道仅使用基于 AJAX 的查询来为`<div id="main">`.

我认为使用 AJAX 可能是一个更好的解决方案，因为我可以在可以调用的页面以及可以在 AJAX 调用中传递哪些参数方面拥有更大的灵活性。

我知道 PHP 和 AJAX 可以一起使用，但是如果你开始这种类型的项目，你会怎么做呢？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-26T18:08:28.377

你不想这样做。AJAX 很好，但是这将是滥用它。它不仅会不必要地使禁用 Javascript 的人无法访问该网站（我相信您已经知道），它还会破坏您网站上的网络导航标准。那么，如何将链接发送给朋友以查看 Races 页面呢？如何在页面之间来回切换？有解决方法，但不值得。您更适合只重构您的 PHP 代码，以便它是动态的，同时包含您想要的内容是安全的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-26T18:11:27.153

为了扩展 Paolo 所说的内容，Google 和其他搜索引擎无法“抓取”通过 javascript 加载的任何内容。这意味着只有页面上的静态信息会被索引，你的页面排名几乎不存在。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T18:11:06.483

如果您使用 ajax，您仍将与需要为请求的任务设置的 php 交谈，因此没有任何改变。我想我想知道为什么您将参数传递回单个 php 脚本，而不是像这样调用不同的 php 文件：

```
<td><a href="races.php">Races</a></td>
<td><a href="runners.php">Runners</a></td>
<td><a href="searchrunners.php">Search</a></td> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T18:42:52.850

使它们成为单独的页面。使用模板系统。一个非常简单的使用方法是[http://andy.greyledge.net/voot/index.php](http://andy.greyledge.net/voot/index.php)

您从一个带有替换器的 HTML 模板页面开始，例如“%HEADER%”或 %FOOTER% 或 %BODY%。

您将此页面导入 php 页面，设置这些变量，然后呈现页面。

如果要添加更多页面，请将其添加到 HTML 模板中的菜单中，它会针对每个页面显示。

其他人所说的一切都是正确的。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-05T03:24:33.143

另一种选择是使用您想要的页面数组：

```
<?php 
    $pages = array('page', 'races');
    $MYROOT=$_SERVER['DOCUMENT_ROOT'];
    if(isset($pages[$_GET['page']])){
        @require_once($_GET['page'].'.php');
    }
?> 
```

但是，如果您打算这样做，您可能需要考虑转向 MVC 框架，因为这似乎是您尝试重新创建的内容

# c# - IsInvokeRequired 有多贵

> ID：686929
> 
> 赞同：2
> 
> 时间：2009-03-26T18:06:54.793
> 
> 标签：c#, multithreading

是否有任何文件说明它到底有多贵：

```
if (x.IsInvokeRequired)
{
    beginInvoke . . . .
} 
```

*   如果您有 90% 的时间在后台线程上（因此是必需的）的情况，是否值得？
*   如果您遇到 90% 的时间都在 UI 线程上（因此不需要）的情况，是否值得？

任何与此相关的指标都会很棒。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-26T18:12:45.373

## 真实答案：

使用分析器

## 模糊答案：

我认为您需要考虑这两个功能的相对成本与 InvokeRequired 的绝对成本。

InvokeRequired for Control 本质上是将当前的 ThreadId 与预期的 ThreadId 进行比较。如果您查看反射器，代码会稍微复杂一些，但实际上这就是它正在做的事情。这相当便宜，因为它只是几个函数调用和比较。

BeginInvoke 涉及获取多个锁、将委托添加到调用队列以及线程之间可能的 Marshal。相对于实际的 InvokeRequired 调用（可能是一个数量级或 2），此代码要昂贵得多。您将需要更多调用，其中 InvokeRequired 返回 true，然后才能通过直接访问 BeignInvoke 看到任何收益。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T18:16:02.493

没有指标，但快速浏览 Reflector 告诉我们调用很可能根本不是很昂贵：

```
[SRDescription("ControlInvokeRequiredDescr"), DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden), Browsable(false), EditorBrowsable(EditorBrowsableState.Advanced)]
        public bool InvokeRequired
        {
            get
            {
                using (new MultithreadSafeCallScope())
                {
                    HandleRef ref2;
                    int num;
                    if (this.IsHandleCreated)
                    {
                        ref2 = new HandleRef(this, this.Handle);
                    }
                    else
                    {
                        Control wrapper = this.FindMarshalingControl();
                        if (!wrapper.IsHandleCreated)
                        {
                            return false;
                        }
                        ref2 = new HandleRef(wrapper, wrapper.Handle);
                    }
                    int windowThreadProcessId = SafeNativeMethods.GetWindowThreadProcessId(ref2, out num);
                    int currentThreadId = SafeNativeMethods.GetCurrentThreadId();
                    return (windowThreadProcessId != currentThreadId);
                }
            }
        } 
```

无论使用情况如何，最好都进行检查，因为这种微优化带来的任何性能提升都将被出现问题的风险所抵消。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T18:09:16.113

InvokeRequired 的成本取决于哪个类正在实现 ISynchronizeInvoke，以及具体的用例。“成本”将很大程度上取决于您使用的实现。但是，一般来说，这通常是一个相当低的开销调用。（在很多情况下，可以很简单地检查当前线程是否与原始线程相同。）

话虽这么说，如果你需要它，它总是值得的。即使只需要 1% 的时间，也应该包括在内。否则，您将要求崩溃、锁定或其他一些非常不受欢迎的行为。大多数情况下，您可以使用它，您应该始终包含此成本。

最常见的用例是将委托同步到 UI 线程。在这种情况下，你必须使用它，否则会发生非常糟糕的事情......而且，这种情况下，与等待 UI 交互的消息泵相比，成本非常低，所以真的不值得担心。

如果您将它与 ISynchronizeInvoke 的自定义实现一起使用，并且它发生在一个紧密的循环中，并且您已经分析并发现它给您带来了问题，那么可能值得担心。不过，在这种情况下，我建议尝试重新设计算法本身，以尽可能避免同步的需要，但仍根据需要使用 InvokeRequired。

# syntax - Lua中是否使用大括号？

> ID：686931
> 
> 赞同：18
> 
> 时间：2009-03-26T18:07:07.773
> 
> 标签：syntax, lua

如果在 Lua 中使用大括号（'{' 和 '}'），它们是做什么用的？

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-03-26T21:31:06.317

表文字。

表是 Lua 中的中心类型，可以被视为关联数组（哈希表或字典）或普通数组。键可以是除 之外的任何 Lua 类型的值，`nil`表的元素可以包含除 之外的任何值`nil`。

数组成员访问比后台哈希键访问更有效，但细节通常并不重要。这实际上使得处理稀疏数组很方便，因为只需要为那些包含值的单元格分配存储空间。

这确实导致了一个通用的基于 1 的数组习语，这对 C 程序员来说有点奇怪。

例如

```
a = { 1, 2, 3 } 
```

创建一个存储在变量中的数组，其中`a`包含三个元素（巧合地）与它们的索引具有相同的值。因为元素存储在从 1 开始的顺序索引中，所以`a`（由`#a`or给出`table.getn(a)`）的长度为 3。

可以像这样使用非整数键初始化表：

```
b = { one=1, pi=3.14, ["half pi"]=1.57, [function() return 17 end]=42 } 
```

where`b`将有名为“one”、“pi”、“half pi”的条目和一个匿名函数。当然，在不迭代表的情况下查找最后一个元素可能会很棘手，除非该函数的副本存储在其他变量中。

花括号出现的另一个地方实际上是相同的语义含义，但它被隐藏在一些语法糖后面（对于 Lua 的新用户）。编写带有单个参数的函数是很常见的，该参数应该是一个表。在这种情况下，调用函数不需要使用括号。这导致代码似乎包含混合`()`并`{}`显然用作函数调用运算符。

```
btn = iup.button{title="ok"} 
```

相当于

```
btn = iup.button({title="ok"}) 
```

但对眼睛的伤害也较小。顺便说一句，使用文字值调用单参数函数也适用于字符串文字。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-26T18:08:32.200

列表/字典构造函数（即表类型构造函数）。

如果这就是您的意思，它们不用于代码块。为此，Lua 只需使用 end 关键字来结束块。

[看这里](http://merd.sourceforge.net/pixel/language-study/syntax-across-languages-per-language/Lua.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-06T12:22:11.780

它们用于表文字，就像您在 C 中使用的那样：

```
t = {'a', 'b', 'c'} 
```

这是唯一常见的情况。它们不用于块分隔符。在 lua 表中，您可以放置​​不同类型的值：

```
t={"foo", 'b', 3} 
```

您也可以将它们用作字典，就像 Python 一样：

```
t={name="foo", age=32} 
```

# perl - 为什么 File::Find 不处理我损坏的符号链接？

> ID：686934
> 
> 赞同：2
> 
> 时间：2009-03-26T18:08:25.273
> 
> 标签：perl, symlink, file-find

我正在使用 Perl 的 File::Find 模块来扫描文件、目录和链接。除其他外，我希望我正在编写的实用程序报告损坏的（悬在 File::Find 的说法中）符号链接。理论上，这是通过创建一个子例程来支持的，当发现断开的链接时调用该子例程，并`find`使用适当值的哈希引用调用该方法，例如：

```
my %options = (
   wanted            => \&ProcessFile,
   follow            => 1,
   follow_skip       => 2,
   dangling_symlinks => \&Dangling
);

find(\%options, @ARGV); 
```

尽管故意创建一个断开的链接来测试它，但 File::Find 永远不会调用 subroutine `Dangling`。除此功能外，其他所有功能均有效，即`ProcessFile`按预期调用子程序，跟踪链接等。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T20:07:43.707

我做了一个快速测试来弄清楚悬挂符号链接表现出什么行为，结果表明符号链接的定义是我所能理解的

1.  -l 返回真
2.  -e 返回 undef # 因为 -e 作用于链接文件

因此，使用 File::Find::Rule 你似乎想要做的事情相对简单：

```
#!/usr/bin/perl 

use strict;
use warnings;
use File::Find::Rule ();

my @files = File::Find::Rule->symlink->exec(sub{ !-e $_ })->in('/tmp/test');

print "$_,\n" for @files; 
```

此代码片段能够检测到我能分辨出的所有损坏的符号链接。

如果您希望我运行的测试得出以下结论：

```
#!/usr/bin/perl 

use strict;
use warnings;
use File::Path ();
use Carp       ();

my $testdir = "/tmp/test";

# Generating test

# Making Dirs
dirmk($_)
  for (
    qw(
    /realdir/
    /deleteddir/
    )
  );

#"Touching" some files
generate($_)
  for (
    qw(
    /realfile
    /deletedfile
    /realdir/realfile
    /realdir/deletedfile
    /deleteddir/afile
    )
  );

# Symlink them
{
    lns( '/realfile',            '/realfile_symlink' );
    lns( '/deletedfile',         '/deletedfile_symlink' );
    lns( '/realdir',             '/realdir_symlink' );
    lns( '/deleteddir',          '/deleteddir_symlink' );
    lns( '/realdir/realfile',    '/realdir_realfile_symlink' );
    lns( '/realdir/deletedfile', '/realdir_deletedfile_symlink' );
    lns( '/deleteddir/afile',    '/deleteddir_file' );
}

# Make the deletions
del($_)
  for (
    qw(
    /deletedfile
    /deleteddir/afile
    /realdir/deletedfile
    /deleteddir/
    )
  );

statify($_)
  for (
    '', qw(
    /realfile
    /realfile_symlink
    /deletedfile_symlink
    /realdir
    /realdir_symlink
    /deleteddir_symlink
    /realdir/realfile
    /realdir_realfile_symlink
    /realdir_deletedfile_symlink
    /deleteddir_file
    )
  );

sub statify {
    my $fn = $testdir . shift;
    printf(
        "r: %3s e: %3s s: %3s f: %3s d: %3s l: %3s | %s \n",
        -r $fn || 0,
        -e $fn || 0,
        -s $fn || 0,
        -f $fn || 0,
        -d $fn || 0,
        -l $fn || 0,
        $fn
    );

}

sub generate {
    my $fn = $testdir . shift;
    open my $fh, '>', $fn or Carp::croak("Error Creating $fn $! $@");
    print $fh "This is $fn \n";
    close $fh or Carp::carp("Error on close for $fn $! $@");
    return;
}

sub lns {
    my $x = $testdir . shift;
    my $y = $testdir . shift;
    if ( -e $y ) {
        unlink $y;
    }
    symlink $x, $y or Carp::croak("Error ln $x => $y , $! $@");
}

sub del {
    my $fn = $testdir . shift;
    if ( -f $fn ) {
        unlink $fn;
    }
    if ( -d $fn ) {
        rmdir $fn;
    }
}

sub dirmk {
    my $fn = $testdir . shift;
    File::Path::mkpath($fn);
} 
```

这是输出：

```
r：1 e：1 s：220 f：0 d：1 l：0 | /tmp/测试
r：1 e：1 s：28 f：1 d：0 l：0 | /tmp/test/realfile
r：1 e：1 s：28 f：1 d：0 l：1 | /tmp/test/realfile_symlink
r：0 e：0 s：0 f：0 d：0 l：1 | /tmp/test/deletedfile_symlink
r: 1 e: 1 s: 60 f: 0 d: 1 l: 0 | /tmp/test/realdir
r：1 e：1 s：60 f：0 d：1 l：1 | /tmp/test/realdir_symlink
r：0 e：0 s：0 f：0 d：0 l：1 | /tmp/test/deleteddir_symlink
r：1 e：1 s：36 f：1 d：0 l：0 | /tmp/test/realdir/realfile
r：1 e：1 s：36 f：1 d：0 l：1 | /tmp/test/realdir_realfile_symlink
r：0 e：0 s：0 f：0 d：0 l：1 | /tmp/test/realdir_deletedfile_symlink
r：0 e：0 s：0 f：0 d：0 l：1 | /tmp/test/deleteddir_file

```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T18:16:47.080

`test.pl`在我的主目录中创建：

```
#!/usr/bin/perl

use File::Find;

my %options = ( wanted => \&ProcessFile,
                follow => 1,
                follow_skip => 2,
                dangling_symlinks => \&Dangling );

find(\%options, @ARGV);

sub ProcessFile {
  print "ProcessFile ($File::Find::name in $File::Find::dir)\n";
}

sub Dangling {
  my ($name, $dir) = @_;
  print "Dangling ($name in $dir)\n";
} 
```

然后：

```
    $ chmod 755 测试.pl

    $ mkdir /tmp/findtest
    $ cd /tmp/findtest
    $ ln -s /tmp/doesnotexist linkylink
    $ ~/test.pl 。

```

结果是：

```
ProcessFile (. in .)
悬空（./ 中的链接链接）
ProcessFile (./linkylink in .)

```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T18:22:02.790

我喜欢[`File::Find::Rule`](http://search.cpan.org/dist/File-Find-Rule/lib/File/Find/Rule.pm)在使用中看到，但在这里没有区别。

话虽如此，

```
$ mkdir test
$ cd test
$ ln -s a b
$ perl -w -MFile::Find -e'find({wanted=>sub{print"wanted $_\n"},dangling_symlinks=>sub{print"dangling $_[0] in $_\n"},follow=>1},".")'
wanted .
dangling b in .
wanted b 
```

为我工作。

是什么`perl -MFile::Find -e'print"$File::Find::VERSION\n"'`？

### 更新

查看 Perl 的 RT，我发现[#28929: File::Find follow_fast => 1 lost dangling symlink](http://rt.perl.org/rt3/Public/Bug/Display.html?id=28929)。它显然会影响`File::Find`1.07 及更早版本，该版本与 Perl 5.8.7 及更早版本捆绑在一起（以及 5.9.x 开发线中的 5.9.1 及更早版本）。

我建议您说服您的系统管理员更新 Perl，或至少更新一些模块（并`File::Find::Rule`在他们使用时添加），但如果失败，您可以制作自己的[`$PERL5LIB`](http://perldoc.perl.org/perlrun.html#ENVIRONMENT)并将更新的模块放在那里。

# .net - VBPROJ / CSPROJ

> ID：686944
> 
> 赞同：6
> 
> 时间：2009-03-26T18:09:19.547
> 
> 标签：.net, asp.net, visual-studio, visual-studio-2008, visual-studio-2005

我正在尝试深入研究 VBPROJ 文件的 XML。有谁知道我在哪里可以找到解释结构和属性用法的好资源？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-26T18:36:51.430

csproj 或 vbproj 文件只不过是 msbuild xml 文件，它们将被`msbuild.exe`. 这些 xml 文件遵循 msbuild 架构，即：`Microsoft.Build.xsd`.

1.  有关 msbuild 架构参考，请参阅[http://msdn.microsoft.com/en-us/library/5dy88c2e.aspx](https://docs.microsoft.com/en-us/previous-versions/visualstudio/visual-studio-2015/msbuild/msbuild-project-file-schema-reference?view=vs-2015&redirectedfrom=MSDN)。
2.  阅读[Sara Ford 关于在 VS IDE 中编辑 csproj/vbproj 文件的博文](https://docs.microsoft.com/en-us/archive/blogs/saraford/did-you-know-how-to-edit-a-csproj-or-vbproj-project-file-within-the-ide-332)
3.  [MSBuild 架构文件在哪里？](https://docs.microsoft.com/en-us/archive/blogs/msbuild/)
4.  [msdn 博客上关于编辑 csproj/vbproj 文件的](https://docs.microsoft.com/en-us/archive/blogs/msbuild/)另一篇文章

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-26T18:51:59.583

如果您正在寻找此信息以便以编程方式翻阅一些 vbproj 文件，您可能需要查看`Microsoft.Build.Engine.dll`. 引用此组件可让您访问 MSBuild 对象模型，该模型可用于读取和操作 MSBuild 文件（csproj 和 vbproj 文件是）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T18:43:30.837

看看[这段代码](http://code.google.com/p/projectpilot/source/browse/#svn/trunk/Flubu/Builds/VSSolutionBrowsing)。它包含一个简单的 VS 解决方案和 csproj 文件解析器。Vbproj 应该没有太大不同，因此您应该能够根据需要对其进行扩展。它在 MIT 许可下获得许可。

# sql - SSIS - 从目的地建议类型

> ID：686947
> 
> 赞同：0
> 
> 时间：2009-03-26T18:09:36.627
> 
> 标签：sql, ssis

有没有办法让 SSIS (<cough>hateit</cough>) 从目标表中建议平面文件连接管理器上的类型？

所以问题是我有一个包含大量文本字段的大表，即使使用建议类型，它有时也会将这些字段的长度设置为小于目标列。当然，这对于当前的数据集来说很好，但是如果我希望将来在另一个文件上再次使用这个包，这个文件可能在这个特定领域有更多的数据，那么我自己就有问题了。

是的，我可以手动完成并设置它们（<cough>sucks</cough>），但我希望我在某个地方缺少一个功能，我可以说，“根据那里的表格定义这个这里文件”。

想法？想法？关于 SSIS 的咆哮？

* * *

## 回答 #1

> 赞同：-2
> 
> 时间：2009-03-26T18:20:06.417

您还应该尝试使用高级属性设置您的字段（右键单击数据源）

# c# - 大对象堆碎片

> ID：686950
> 
> 赞同：98
> 
> 时间：2009-03-26T18:10:20.183
> 
> 标签：c#, .net, memory-management, memory-leaks, windbg

我正在处理的 C#/.NET 应用程序正在遭受缓慢的内存泄漏。我已经使用 CDB 和 SOS 来尝试确定正在发生的事情，但数据似乎没有任何意义，所以我希望你们中的一个人以前可能经历过这种情况。

该应用程序在 64 位框架上运行。它不断地计算数据并将数据序列化到远程主机，并且相当大的对象堆（LOH）。但是，我希望大多数 LOH 对象是瞬态的：一旦计算完成并发送到远程主机，就应该释放内存。然而，我看到的是大量（活动）对象数组与空闲内存块交错，例如，从 LOH 中获取一个随机段：

```
0:000> !DumpHeap 000000005b5b1000  000000006351da10
         Address               MT     Size
...
000000005d4f92e0 0000064280c7c970 16147872
000000005e45f880 00000000001661d0  1901752 Free
000000005e62fd38 00000642788d8ba8     1056       <--
000000005e630158 00000000001661d0  5988848 Free
000000005ebe6348 00000642788d8ba8     1056
000000005ebe6768 00000000001661d0  6481336 Free
000000005f214d20 00000642788d8ba8     1056
000000005f215140 00000000001661d0  7346016 Free
000000005f9168a0 00000642788d8ba8     1056
000000005f916cc0 00000000001661d0  7611648 Free
00000000600591c0 00000642788d8ba8     1056
00000000600595e0 00000000001661d0   264808 Free
... 
```

显然，如果我的应用程序在每次计算期间都创建了长期存在的大型对象，我希望会出现这种情况。（它确实这样做了，我接受会有一定程度的 LOH 碎片，但这不是这里的问题。）问题是你可以在上面的转储中看到的非常小的（1056 字节）对象数组，我在代码中看不到正在被创建并且以某种方式保持扎根。

另请注意，当堆段被转储时，CDB 没有报告类型：我不确定这是否相关。如果我转储标记的 (<--) 对象，CDB/SOS 会正常报告：

```
0:015> !DumpObj 000000005e62fd38
Name: System.Object[]
MethodTable: 00000642788d8ba8
EEClass: 00000642789d7660
Size: 1056(0x420) bytes
Array: Rank 1, Number of elements 128, Type CLASS
Element Type: System.Object
Fields:
None 
```

对象数组的元素都是字符串，并且可以从我们的应用程序代码中识别出这些字符串。

此外，我无法找到它们的 GC 根，因为 !GCRoot 命令挂起并且再也没有回来（我什至尝试过让它过夜）。

所以，如果有人能解释为什么这些小（<85k）对象数组最终会出现在 LOH 上，我将非常感激：.NET 在什么情况下会在其中放置一个小对象数组？另外，有没有人碰巧知道确定这些对象的根源的另一种方法？

* * *

更新 1

我昨天晚些时候提出的另一个理论是，这些对象数组开始时很大，但已经缩小，留下了内存转储中明显的空闲内存块。让我怀疑的是，对象数组似乎总是 1056 字节长（128 个元素），128 * 8 的引用和 32 字节的开销。

这个想法是，库或 CLR 中的某些不安全代码可能会破坏数组标头中的元素数量字段。我知道有点远射...

* * *

更新 2

感谢 Brian Rasmussen（请参阅已接受的答案），该问题已被确定为由字符串实习生表引起的 LOH 碎片！我写了一个快速测试应用程序来确认这一点：

```
static void Main()
{
    const int ITERATIONS = 100000;

    for (int index = 0; index < ITERATIONS; ++index)
    {
        string str = "NonInterned" + index;
        Console.Out.WriteLine(str);
    }

    Console.Out.WriteLine("Continue.");
    Console.In.ReadLine();

    for (int index = 0; index < ITERATIONS; ++index)
    {
        string str = string.Intern("Interned" + index);
        Console.Out.WriteLine(str);
    }

    Console.Out.WriteLine("Continue?");
    Console.In.ReadLine();
} 
```

应用程序首先在循环中创建和取消引用唯一字符串。这只是为了证明在这种情况下内存没有泄漏。显然它不应该也不应该。

在第二个循环中，创建并保留唯一字符串。此操作将它们植根于实习生表。我没有意识到实习生表是如何表示的。它似乎由一组页面组成——128 个字符串元素的对象数组——在 LOH 中创建。这在 CDB/SOS 中更为明显：

```
0:000> .loadby sos mscorwks
0:000> !EEHeap -gc
Number of GC Heaps: 1
generation 0 starts at 0x00f7a9b0
generation 1 starts at 0x00e79c3c
generation 2 starts at 0x00b21000
ephemeral segment allocation context: none
 segment    begin allocated     size
00b20000 00b21000  010029bc 0x004e19bc(5118396)
Large object heap starts at 0x01b21000
 segment    begin allocated     size
01b20000 01b21000  01b8ade0 0x00069de0(433632)
Total Size  0x54b79c(5552028)
------------------------------
GC Heap Size  0x54b79c(5552028) 
```

对 LOH 段进行转储揭示了我在泄漏应用程序中看到的模式：

```
0:000> !DumpHeap 01b21000 01b8ade0
...
01b8a120 793040bc      528
01b8a330 00175e88       16 Free
01b8a340 793040bc      528
01b8a550 00175e88       16 Free
01b8a560 793040bc      528
01b8a770 00175e88       16 Free
01b8a780 793040bc      528
01b8a990 00175e88       16 Free
01b8a9a0 793040bc      528
01b8abb0 00175e88       16 Free
01b8abc0 793040bc      528
01b8add0 00175e88       16 Free    total 1568 objects
Statistics:
      MT    Count    TotalSize Class Name
00175e88      784        12544      Free
793040bc      784       421088 System.Object[]
Total 1568 objects 
```

请注意，对象数组大小为 528（而不是 1056），因为我的工作站是 32 位的，而应用程序服务器是 64 位的。对象数组仍然是 128 个元素长。

所以这个故事的寓意是要非常小心地实习。如果不知道您正在实习的字符串是有限集的成员，那么您的应用程序将由于 LOH 的碎片而泄漏，至少在 CLR 的版本 2 中。

在我们的应用程序的案例中，反序列化代码路径中有通用代码在解组期间实习实体标识符：我现在强烈怀疑这是罪魁祸首。然而，开发人员的意图显然是好的，因为他们想确保如果同一个实体被多次反序列化，那么只有一个标识符字符串的实例将保留在内存中。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-03-26T19:10:04.750

CLR 使用 LOH 预分配一些对象（例如[用于内部字符串的数组](https://stackoverflow.com/questions/372547/where-do-java-and-net-string-literals-reside/372559#372559)）。其中一些小于 85000 字节，因此通常不会在 LOH 上分配。

这是一个实现细节，但我认为这样做的原因是为了避免不必要的实例垃圾收集，这些实例应该在它自己的进程中存活。

同样由于有些深奥的优化，`double[]`1000 个或更多元素中的任何一个也被分配在 LOH 上。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2015-01-02T07:22:46.090

.NET Framework 4.5.1 能够在垃圾回收期间显式压缩大对象堆 (LOH)。

```
GCSettings.LargeObjectHeapCompactionMode = GCLargeObjectHeapCompactionMode.CompactOnce;
GC.Collect(); 
```

[在GCSettings.LargeObjectHeapCompactionMode](http://msdn.microsoft.com/en-us/library/system.runtime.gcsettings.largeobjectheapcompactionmode(v=vs.110).aspx)中查看更多信息

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-26T19:35:50.977

当阅读关于 GC 工作原理的描述，以及关于长寿命对象如何在第 2 代中结束的部分，以及 LOH 对象的收集仅在完全收集时发生 - 就像第 2 代的收集一样，脑海中浮现的想法是。 .. 为什么不把第 2 代和大对象放在同一个堆中，因为它们会被收集在一起？

如果这就是实际发生的情况，那么它将解释小物体如何最终与 LOH 在同一个地方 - 如果它们的寿命足够长以最终出现在第 2 代。

所以你的问题似乎是对我想到的想法的一个很好的反驳——它会导致 LOH 的碎片化。

摘要：您的问题*可以*通过 LOH 和第 2 代共享相同的堆区域来解释，尽管这决不能证明这是解释。

**更新：**输出`!dumpheap -stat`几乎将这个理论从水中吹了出来！第 2 代和 LOH 有自己的区域。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T18:36:53.427

如果该格式可识别为您的应用程序，为什么您没有识别生成此字符串格式的代码？如果有多种可能性，请尝试添加唯一数据以确定哪个代码路径是罪魁祸首。

数组与大的释放项目交错的事实让我猜测它们最初是配对的或至少是相关的。尝试识别被释放的对象以找出生成它们的原因以及相关的字符串。

一旦您确定了生成这些字符串的原因，请尝试找出阻止它们被 GC 的原因。也许它们被塞进了一个被遗忘或未使用的列表中，用于记录或类似的目的。

* * *

编辑：暂时忽略内存区域和特定的数组大小：只需弄清楚这些字符串正在做什么以导致泄漏。当您的程序创建或操作这些字符串一两次时，尝试使用 !GCRoot，此时要跟踪的对象较少。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-01-15T11:05:59.023

很好的问题，我通过阅读问题来学习。

我认为反序列化代码路径的其他部分也在使用大对象堆，因此存在碎片。如果所有的字符串都在同一时间被实习，我想你会没事的。

**鉴于 .net 垃圾收集器有多好，让反序列化代码路径创建普通字符串对象可能就足够了。在证明需要之前不要做任何更复杂的事情。**

我最多会考虑保留您看到的最后几个字符串的哈希表并重用它们。通过限制哈希表大小并在创建表时传递大小，您可以停止大多数碎片。然后，您需要一种方法从哈希表中删除您最近未见过的字符串以限制其大小。 **但是，如果反序列化代码路径创建的字符串无论如何都是短暂的，那么您将不会获得太多收益。**

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-04-04T01:16:05.967

这里有几种方法可以识别[LOH](http://naveensrinivasan.com/2010/04/02/get-managed-and-native-call-stacks-from-event-tracing-for-windows-etw/)分配的确切[调用堆栈。](http://naveensrinivasan.com/2010/02/14/identifying-high-cpu-in-gc-net-because-of-loh-using-windbg/)

并避免 LOH 碎片预分配大量对象并固定它们。在需要时重复使用这些对象。这是关于 LOH 碎片的[帖子。](http://blogs.msdn.com/yunjin/archive/2004/01/27/63642.aspx)这样的事情可以帮助避免 LOH 碎片。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-02-21T04:09:56.583

根据[http://webcache.googleusercontent.com/search?q=cache:l3Ppy_eFoAAJ:www.wintellect.com/devcenter/sloscialo/hey-who-stole-all-my-memory+&cd=5&hl=en&ct=clnk&gl= mx&client=firefox-b](http://webcache.googleusercontent.com/search?q=cache:l3Ppy_eFoAAJ:www.wintellect.com/devcenter/sloscialo/hey-who-stole-all-my-memory+&cd=5&hl=en&ct=clnk&gl=mx&client=firefox-b)

```
GCSettings.LargeObjectHeapCompactionMode = GCLargeObjectHeapCompactionMode.CompactOnce;
GC.Collect(); 
```

# iphone - 您可以在运行时覆盖 iPhone 键盘语言环境吗？

> ID：686952
> 
> 赞同：2
> 
> 时间：2009-03-26T18:10:52.273
> 
> 标签：iphone, internationalization

我需要创建一个支持多种语言用户输入的 iPhone 应用程序。用户需要能够在运行时在英语、西班牙语、中文、日语等之间更改他的输入语言。有没有办法通过 iPhone SDK 显示用户默认语言以外的语言的键盘？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-29T20:17:20.103

不，您不能以编程方式更改键盘。

但是您可以完全忽略系统键盘并使用自己的自定义键盘。如果您从头开始设计键盘，则可以完全控制它。

这是很多工作，但由于我已经看到一些使用自定义键盘的应用程序，我想 Apple 规则没问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-26T20:47:14.923

不，但请注意，如果用户在“设置”中打开了多个键盘，则空格键旁边有一个小按钮可让他们切换语言。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T19:31:04.903

不，您的应用程序无法控制用户的首选语言（因此也无法控制键盘的输入法）——对此没有编程控制。

# asp.net - DataTable Wrapper 或如何将 UI 与业务逻辑分离

> ID：686960
> 
> 赞同：4
> 
> 时间：2009-03-26T18:13:04.060
> 
> 标签：asp.net, gridview, webforms, datatable, decoupling

我正在使用网络表单、C#、Asp.net。众所周知，在这个模型中，UI和业务逻辑经常混在一起，如何有效的将它们分开呢？

我想使用的示例是：我有一个 GridView 和一个 DataTable（GridView 绑定到 DataTable 并且 DataTable 是从存储过程提供的）。

我希望将 GridView (UI) 和 DataTable (业务逻辑) 解耦。

为 DataTable 编写包装器是否值得？是否有经过验证和测试的实用模式可供您推荐遵循？

如果有经验的人能解释一下，那就太棒了。而且，作为最后一点，我想说 ASP MVC 现在不是一个选项，所以不推荐它。

我的数据库访问层返回一个 DataTable。请注意，我必须使用此数据库层，因为这是公司政策。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T18:25:01.583

我最近经历了这个，同时将很多相同的东西与我们的 UI 层解耦。

[你可以在这里](https://stackoverflow.com/questions/583689/dictionaryt-of-listt-and-listviews-in-asp-net)和[这里](https://stackoverflow.com/questions/609276/listview-dataitem-shows-null)看到我的进步。

**在我**看来，A`DataTable`不代表业务逻辑。具体来说，它是直接从数据库中提取的数据。业务逻辑将这些数据转化为真正有用的业务对象。

 **那么，第一步是将 DataTable 与 Business 对象分离。

您可以通过创建对象并`List<object>`组成 DataTables 和 DataTables 集合来做到这一点，然后您可以创建一个显示这些对象的 ListView。我在上面发布的链接中介绍了后面的步骤。前面的步骤如下所示：

1.  创建一个代表您的对象的类。
2.  遍历您的 DataTable（或 DataSet，或者您检索数据）并将这些字段推入该对象（或该对象`List<T>`）的属性中；
3.  将该列表返回到要显示的 Gridview 或 ListView。

这样，您的 ListView 或 Gridview 将不会与您检索数据的方法紧密耦合。如果您决定稍后从 JSON 查询或 XML 文件中获取数据，会发生什么？然后你必须把它建在那里。

### 第 1 步 - 从数据库中获取数据

有多种方法可以从数据库中获取数据，我无法在此处查看所有方法。我假设您已经知道如何从数据库中检索数据，如果您不知道，则有[很多链接](http://www.google.com/search?hl=en&q=Get+Data+from+Database+C%23&btnG=Google+Search&aq=f&oq=)可供参考。假设您已连接到数据库，并正在使用 an`SQLDataReader`来检索数据。我们会在那里接。

### 类图

```
Foo
----
id
Name
Description 
```

这是方法：

```
 private void FillDefault(SqlDataReader reader, Foos foo)
        {
            try
            {
                foo.id = Convert.ToInt32(reader[Foo.Properties.ID]);
                foo.Name = reader[Foo.Properties.NAME].ToString();

             if (!string.IsNullOrEmpty(
                reader[Foo.Properties.DESCRIPTION].ToString()))
                 foo.Description = 
                 reader[Foo.Properties.DESCRIPTION].ToString();
             else foo.Description = string.Empty;
            }
            catch (Exception ex)
            {
               throw new Exception(
               string.Format("Invalid Query. 
               Column '{0}' does not exist in SqlDataReader.", 
               ex.Message));
            }
        } 
```

一旦发生这种情况，您可以通过在以该函数`while`为目标的循环中执行该过程来返回一个列表。`SQLDataReader.Read()`

一旦你这样做了，让我们假设你`Foo`被返回的是一个列表。如果你这样做，并按照我上面给出的第一个链接，你可以替换`Dictionary<TKey, TValue>`为`List<T>`并获得相同的结果（略有不同）。该类`Properties`只包含数据库中的列名，因此您可以在一个地方更改它们（以防万一）。

### DataTable - 根据评论更新

您始终可以插入中间对象。在本例中，我将在 DataTable 和 UI 之间插入一个业务层，并且我已经在上面讨论了我要做什么。但是 DataTable 不是业务对象；它是数据库的可视化表示。您不能将其传输到 UI 层并将其称为解耦。他们说您必须使用 DataTable，他们是否说您*必须*将该 DataTable 传输到 UI？我无法想象他们会。如果你这样做了，那么你将永远不会解耦。在 DataTable 和 UI 层之间总是需要一个中间对象。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T18:26:13.077

我首先将数据表解耦到垃圾桶中。构建一个领域层，然后是某种类型的处理数据库的数据访问层（推荐使用 ORM）。

然后构建一个向 UI 提供数据的服务层。所有业务逻辑都应该在服务或实体本身内。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T18:26:45.573

考虑实现 MVP（模型视图展示器）模式。它通过演示者界面为您提供了商业逻辑的分离，这也允许更好的单元测试能力。然后，您的 aspx 页面代码隐藏只是事件的连接器和属性的 getter/setter。您可以在 MS 模式和实践企业应用程序块（CAB - 复合应用程序块 - 如果我没记错的话）中找到它。
您可以在此处阅读有关它的更多信息：http: [//msdn.microsoft.com/en-us/magazine/cc188690.aspx](http://msdn.microsoft.com/en-us/magazine/cc188690.aspx)
但从 DataTable/DataSets 到对象 (POCO) 也是首选。

# jquery - jQuery自动完成：在结果中选择某些内容后如何调用getJson？

> ID：686965
> 
> 赞同：1
> 
> 时间：2009-03-26T18:15:07.893
> 
> 标签：jquery

我有一个表单，“名称”输入文本使用 jQuery 自动完成。我需要的是，当我在自动完成的列表结果中选择一个名字时，我会根据所选的名字填写其他输入文本（出生日期、电话等）。

有谁知道在选择名称后如何进行第二个 ajax 调用？

谢谢！！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-26T18:25:44.407

假设名称所在的选择 ID 是“thenames”，您可以执行以下操作：

```
$("#thenames").change(function (){
  var params = {
    "id": $(this).val()
  };

  $.getJSON("person_details.php", params, function (jsonData){
    // Fill the rest of input texts.
  });
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-04-25T02:11:46.403

您需要为应用了自动完成插件的输入提供一个 ID。例如，“我的名字”。其他可能是“myDOB”和“myTelephoneNum”。

```
$("#myNames").change(function() {
  $.ajax({
    url: "getRestOfData.cfm",
    data: {newSelection:$(this).val()},
    success: function(data) {
      data = $.trim(data);
      //from here just fill in the rest of the fields with the received data
      //$("myDOB").val("");
      //$("myTelephoneNum").val("")
    }
  });
}); 
```

# sql - 如何在 SQL Server 2005 表的 NTEXT 字段中找到 Unicode/非 ASCII 字符？

> ID：686967
> 
> 赞同：41
> 
> 时间：2009-03-26T18:15:27.177
> 
> 标签：sql, sql-server, sql-server-2005

我有一张有几千行的桌子。描述和摘要字段是 NTEXT，有时其中包含非 ASCII 字符。如何找到所有非 ASCII 字符的行？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2010-04-21T13:54:42.213

我有时一直在使用这个“cast”语句来查找“奇怪的”字符

```
select 
    *
from 
    <Table>
where 
    <Field> != cast(<Field> as varchar(1000)) 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-03-26T18:36:51.307

首先构建一个包含所有您不感兴趣的字符的字符串（该示例使用 0x20 - 0x7F 范围，或不带控制字符的 7 位。）每个字符都以 | 为前缀，以便稍后在转义子句中使用。

```
-- Start with tab, line feed, carriage return
declare @str varchar(1024)
set @str = '|' + char(9) + '|' + char(10) + '|' + char(13)

-- Add all normal ASCII characters (32 -> 127)
declare @i int
set @i = 32
while @i <= 127
    begin
    -- Uses | to escape, could be any character
    set @str = @str + '|' + char(@i)
    set @i = @i + 1
    end 
```

下一个片段搜索不在列表中的任何字符。% 匹配 0 个或多个字符。[] 匹配 [] 内的字符之一，例如 [abc] 将匹配 a、b 或 c。^ 否定列表，例如 [^abc] 将匹配不是 a、b 或 c 的任何内容。

```
select *
from yourtable
where yourfield like '%[^' + @str + ']%' escape '|' 
```

转义字符是必需的，否则搜索 ]、% 或 _ 等字符会弄乱 LIKE 表达式。

希望这很有用，并感谢 JohnFX 对另一个答案的评论。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2015-11-05T23:33:58.643

给你：

```
SELECT *
FROM Objects
WHERE 
    ObjectKey LIKE '%[^0-9a-zA-Z !"#$%&''()*+,\-./:;<=>?@\[\^_`{|}~\]\\]%' ESCAPE '\' 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-06-02T20:55:06.900

从技术上讲，我相信 NCHAR(1) 是有效的 ASCII 字符 IF & Only IF UNICODE(@NChar) < 256 和 ASCII(@NChar) = UNICODE(@NChar) 虽然这可能不是你想要的。因此，这将是一个正确的解决方案：

```
;With cteNumbers as
(
    Select ROW_NUMBER() Over(Order By c1.object_id) as N
    From sys.system_columns c1, sys.system_columns c2
)
Select Distinct RowID
From YourTable t
    Join cteNumbers n ON n <= Len(CAST(TXT As NVarchar(MAX)))
Where UNICODE(Substring(TXT, n.N, 1)) > 255
    OR UNICODE(Substring(TXT, n.N, 1)) <> ASCII(Substring(TXT, n.N, 1)) 
```

这也应该非常快。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-26T18:36:53.583

这可能不是最好的解决方案，但可能是这样的查询：

```
SELECT *
FROM yourTable
WHERE yourTable.yourColumn LIKE '%[^0-9a-zA-Z]%' 
```

将“0-9a-zA-Z”表达式替换为捕获完整 ASCII 集（或数据包含的子集）的内容。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-04-17T02:15:44.043

我从@CC1960 的解决方案开始，但发现了一个有趣的用例导致它失败。似乎 SQL Server 会将某些 Unicode 字符等同于它们的非 Unicode 近似值。例如，当在 WHERE 子句中进行比较时，SQL Server 将 Unicode 字符“全角逗号”( [http://www.fileformat.info/info/unicode/char/ff0c/index.htm](http://www.fileformat.info/info/unicode/char/ff0c/index.htm) ) 视为标准 ASCII 逗号。

为了解决这个问题，让 SQL Server 将字符串作为二进制进行比较。但请记住，nvarchar 和 varchar 二进制文件不匹配（16 位与 8 位），因此在进行二进制比较之前，您需要再次将 varchar 转换回 nvarchar：

```
select *
from my_table
where CONVERT(binary(5000),my_table.my_column) != CONVERT(binary(5000),CONVERT(nvarchar(1000),CONVERT(varchar(1000),my_table.my_column))) 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-09-22T15:06:13.377

如果您正在寻找特定的 unicode 字符，则可以使用如下所示的内容。

```
 select  Fieldname from 
     (
      select Fieldname,
             REPLACE(Fieldname COLLATE Latin1_General_BIN,
             NCHAR(65533) COLLATE Latin1_General_BIN,
             'CustomText123') replacedcol
      from table
     ) results where results.replacedcol like '%CustomText123%' 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-26T18:52:22.767

我之前的回答是混淆 UNICODE/非 UNICODE 数据。这是一个适用于所有情况的解决方案，尽管我仍然遇到一些异常情况。上标字符的某些非 ASCII Unicode 字符似乎与实际的数字字符混淆了。您可能可以使用排序规则来解决这个问题。

希望您的数据库中已经有一个数字表（它们可能非常有用），但以防万一我也包含了部分填充它的代码。

您可能还需要使用数字范围，因为 unicode 字符可以超过 255。

```
CREATE TABLE dbo.Numbers
(
    number  INT NOT NULL,
    CONSTRAINT PK_Numbers PRIMARY KEY CLUSTERED (number)
)
GO
DECLARE @i INT

SET @i = 0

WHILE @i < 1000
BEGIN
    INSERT INTO dbo.Numbers (number) VALUES (@i)

    SET @i = @i + 1
END
GO

SELECT *,
    T.ID, N.number, N'%' + NCHAR(N.number) + N'%'
FROM
    dbo.Numbers N
INNER JOIN dbo.My_Table T ON
    T.description LIKE N'%' + NCHAR(N.number) + N'%' OR
    T.summary LIKE N'%' + NCHAR(N.number) + N'%'
and t.id = 1
WHERE
    N.number BETWEEN 127 AND 255
ORDER BY
    T.id, N.number
GO 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-05-28T15:46:35.807

-- 这是一种非常、非常低效的方法，但对于 -- 小桌子应该没问题。它使用根据 Itzik Ben-Gan 的辅助数字表，并且简单地 - 查找设置了第 7 位的字符。

```
SELECT  *
FROM    yourTable as t
WHERE   EXISTS ( SELECT *
                 FROM   msdb..Nums as NaturalNumbers
                 WHERE  NaturalNumbers.n < LEN(t.string_column)
                        AND ASCII(SUBSTRING(t.string_column, NaturalNumbers.n, 1)) > 127) 
```

# ms-access - 为什么 AccessDataSource 会返回不同的结果以在 Access 中查询？

> ID：686970
> 
> 赞同：1
> 
> 时间：2009-03-26T18:16:46.643
> 
> 标签：ms-access

我有一个查询要从 Access 数据库中返回随机不同的行。这是查询：

```
SELECT * FROM 
(SELECT DISTINCT m.MemberID, m.Title, m.FullName, m.Address, 
        m.Phone, m.EmailAddress, m.WebsiteAddress FROM Members AS m INNER JOIN MembersForType AS t ON m.MemberID = t.MemberID WHERE 
(Category = 'MemberType1' OR Category = 'MemberType2')) as Members 
ORDER BY RND(members.MemberID) DESC 
```

当我在 Access 中运行它时，它每次都会按照随机排序顺序以不同的顺序返回行。当我通过我的网络应用程序运行它时，行每次都以相同的顺序返回。这是我在代码隐藏中的调用方式：

```
private void BindData()
{
    using (AccessDataSource ds = new AccessDataSource("~/App_Data/mydb.mdb", GetSQLStatement()))
    {
        ds.DataSourceMode = SqlDataSourceMode.DataReader;
        ds.CacheDuration = 0;
        ds.CacheExpirationPolicy = DataSourceCacheExpiry.Absolute;
        ds.EnableCaching = false;            
        listing.DataSource = ds.Select(new DataSourceSelectArguments());
        listing.DataBind();
        if (listing.Items.Count == 0)
            noResults.Visible = true;
        else
            noResults.Visible = false;
    }
} 
```

我添加了所有关于缓存的内容，因为我认为查询可能正在被缓存，但结果是相同的。我在代码中放置了一个断点，以确保查询与上面相同，并且确实如此。

有任何想法吗？这让我发疯了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-27T08:33:33.523

当针对新连接执行 ACE/Jet RND 函数时，每次都使用相同的种子值。使用 MS Access 时，您每次都使用相同的连接，这解释了为什么您每次都获得不同的值。

考虑这些 VBA 示例：第一个在每次迭代中使用一个新连接：

```
Sub TestDiff()

  Dim con As Object
  Set con = CreateObject("ADODB.Connection")
  With con
    .ConnectionString = _
        "Provider=MSDataShape;Data " & _
        "Provider=Microsoft.ACE.OLEDB.12.0;" & _
        "Data Source=C:\Tempo\Test_Access2007.accdb"
    .CursorLocation = 3

    Dim i As Long
    For i = 0 To 2

      .Open
      Debug.Print .Execute("SELECT RND FROM OneRowTable;")(0)
      .Close
    Next
  End With

End Sub 
```

输出：

```
 0.705547511577606 
 0.705547511577606 
 0.705547511577606 
```

每次注意相同的值。

第二个示例在每次迭代中使用相同的连接（.Open 和 .Close 语句被重新定位在循环之外）：

```
Sub TestSame()

  Dim con As Object
  Set con = CreateObject("ADODB.Connection")
  With con
    .ConnectionString = _
        "Provider=MSDataShape;Data " & _
        "Provider=Microsoft.ACE.OLEDB.12.0;" & _
        "Data Source=C:\Tempo\Test_Access2007.accdb"
    .CursorLocation = 3

    .Open

    Dim i As Long
    For i = 0 To 2
      Debug.Print .Execute("SELECT RND FROM OneRowTable;")(0)
    Next

    .Close

  End With

End Sub 
```

输出：

```
 0.705547511577606 
 0.533424019813538 
 0.579518616199493 
```

每次注意不同的值。

在 VBA 代码中，您可以使用 Randomize 关键字来播种 Rnd() 函数，但我认为这不能在 ACE/Jet 中完成。一种解决方法是使用 ACE/Jet NOW() niladic 函数的最低有效小数部分，例如：

```
SELECT CDBL(NOW()) - ROUND(CDBL(NOW()), 4) FROM OneRowTable 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-26T21:28:48.537

我会将 RND 移到内部 SELECT

```
SELECT * FROM 
    (SELECT DISTINCT m.MemberID, RND(m.MemberID) as SortOrder, m.Title, 
    m.FullName, m.Address, m.Phone, m.EmailAddress, m.WebsiteAddress 
    FROM Members AS m 
    INNER JOIN MembersForType AS t ON m.MemberID = t.MemberID 
    WHERE 
        (Category = 'MemberType1' OR Category = 'MemberType2')) as Members 
ORDER BY 
    Members.SortOrder DESC 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-05-22T05:28:14.507

您可以将时间用作 RND 字段的一个参数

现在变暗为 DateTime = DateTime.Now

Dim millSec As Integer = Now.Millisecond

finalQuery = "SELECT * FROM wordInfo ORDER BY Rnd(-(1000* ROUND(" + millSec.ToString("N") + ", 0)) * [ID])"

因此，这里从日期和时间值中获取毫秒值，该值将是整数，并通过四舍五入在 sql 查询中使用。

wordInfo 是表名 ID 是数据库表中的列名

这每次都会给出随机顺序（因为毫秒值不同），无论是相同的连接还是新的连接。

# sql - 寻找缺失的记录

> ID：686980
> 
> 赞同：0
> 
> 时间：2009-03-26T18:20:07.523
> 
> 标签：sql, ms-access, null, crosstab

说到 MS Access，我有点生疏，我希望有人能帮助我......

我有一份清单，列出了 UPC 在一个月内每个商店已扫描（购买）的所有商品。我也有一组我想要数据的特定 UPC。我想要得到的是没有被扫描的项目。显然，未扫描的项目不会出现在扫描项目列表中。

首先，我尝试进行交叉表查询……这很好，但我只想查看“0”值。理想情况下，我想将交叉表中的“0”值放入一个列出商店和 UPC 的简单表中。我也尝试做一个不匹配的查询，但只返回 UPC....我需要知道它没有扫描到哪个商店....

我想我可能会有点不对劲。就像我说的，我已经多年没有使用 Access，如果我问的是一个非常简单的问题，我深表歉意。

任何人都可以提供一些帮助？

先感谢您！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-26T19:35:08.653

我会使用：

```
SELECT ul.upc FROM upc_list ul 
LEFT JOIN upc_scanned us
ON ul.upc = us.upc
WHERE us.upc Is Null 
```

使用您的表格和字段：

```
SELECT [Master UPC List].UPC 
FROM [Master UPC List] LEFT JOIN [No Scans] 
ON [Master UPC List].UPC = [No Scans].UPC 
WHERE [No Scans].UPC Is Null; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T18:27:53.247

我想你正在寻找这样的东西。显然，您将需要更改表名和字段以匹配您的架构。

```
select UL.UPC from UPC_LIST UL where UL.UPC not in (
    select US.UPC from UPC_SCANNED US
) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T18:25:32.707

你能给我们一些关于所涉及的表格的想法吗？如果您只有两张表，一张包含扫描的每件商品及其扫描的商店，一张列出所有商品，那么您的不匹配查询返回的任何商品都没有在任何商店中扫描，这是您想要的吗？您似乎在要求它告诉您要在哪个商店进行扫描:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T19:29:17.857

为了回答您的问题 pipTheGeek，我正在寻找哪些 UPC（如果有）未在哪些商店中扫描。

例如，如果有 100 家商店，并且每个商店都应该提供 Alpo 狗粮，我需要了解是否有任何商店在一个月内没有销售任何 Alpo 狗粮，以及那些商店号码是。一旦我有了这些商店号码，我就可以进一步调查它为什么没有卖掉。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-31T17:24:10.033

雷穆 -

你给我的编辑过的sql：

SELECT [Master UPC List].UPC FROM [Master UPC List] LEFT JOIN [No Scans] ON [Master UPC List].UPC = [No Scans].UPC WHERE [No Scans].UPC 为 Null；

也返回0条记录.....

# jquery - 捕捉粘贴输入

> ID：686995
> 
> 赞同：217
> 
> 时间：2009-03-26T18:24:52.847
> 
> 标签：jquery, paste, sanitize

我正在寻找一种方法来清理我粘贴到浏览器中的输入，这可能与 jQuery 相关吗？

到目前为止，我已经设法想出了这个：

```
$(this).live(pasteEventName, function(e) {
 // this is where i would like to sanitize my input
 return false;
} 
```

不幸的是，由于这个“小”问题，我的发展陷入了困境。如果有人能指出我正确的方向，我真的会让我成为一个快乐的露营者。

* * *

## 回答 #1

> 赞同：347
> 
> 时间：2009-10-01T11:35:57.767

好的，只是遇到了同样的问题..我走了很长一段路

```
$('input').on('paste', function () {
  var element = this;
  setTimeout(function () {
    var text = $(element).val();
    // do something with text
  }, 100);
}); 
```

在 .val() 函数可以被填充之前只是一个小的超时。

E.

* * *

## 回答 #2

> 赞同：77
> 
> 时间：2015-04-23T18:30:21.283

您实际上可以直接从[事件](http://www.w3.org/TR/clipboard-apis)中获取价值。但是，如何到达它有点迟钝。

如果您不希望它通过，请返回 false。

```
$(this).on('paste', function(e) {

  var pasteData = e.originalEvent.clipboardData.getData('text')

}); 
```

* * *

## 回答 #3

> 赞同：44
> 
> 时间：2012-04-10T08:28:00.117

为了跨平台兼容性，它应该处理 oninput 和 onpropertychange 事件：

```
$ (something).bind ("input propertychange", function (e) {
    // check for paste as in example above and
    // do something
}) 
```

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2009-03-27T05:47:19.120

我通过使用以下代码修复了它：

```
$("#editor").live('input paste',function(e){
    if(e.target.id == 'editor') {
        $('<textarea></textarea>').attr('id', 'paste').appendTo('#editMode');
        $("#paste").focus();
        setTimeout($(this).paste, 250);
    }
}); 
```

现在我只需要存储插入符号的位置并附加到那个位置然后我就准备好了......我想:)

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-03-26T18:37:45.047

嗯...我*认为*您可以使用它`e.clipboardData`来捕获正在粘贴的数据。如果没有成功，请看[这里](http://www.quirksmode.org/dom/events/tests/cutcopypaste.html)。

```
$(this).live("paste", function(e) {
    alert(e.clipboardData); // [object Clipboard]
}); 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2010-08-26T16:18:35.317

监听粘贴事件并设置一个 keyup 事件监听器。在 keyup 上，捕获值并删除 keyup 事件侦听器。

```
$('.inputTextArea').bind('paste', function (e){
    $(e.target).keyup(getInput);
});
function getInput(e){
    var inputText = $(e.target).val();
    $(e.target).unbind('keyup');
} 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2017-02-21T12:55:05.940

```
$("#textboxid").on('input propertychange', function () {
    //perform operation
        }); 
```

它会正常工作。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-03-26T18:57:05.327

这越来越接近您可能想要的。

```
function sanitize(s) {
  return s.replace(/\bfoo\b/g, "~"); 
};

$(function() {
 $(":text, textarea").bind("input paste", function(e) {
   try {
     clipboardData.setData("text",
       sanitize(clipboardData.getData("text"))
     );
   } catch (e) {
     $(this).val( sanitize( $(this).val() ) );
   }
 });
}); 
```

请注意，当没有找到 clipboardData 对象时（在 IE 以外的浏览器上），您当前正在获取元素的完整值 + 剪贴板的值。

如果您真的只是在真正将数据粘贴到元素中之后，您可能可以做一些额外的步骤来区分两个值，在输入之前和输入之后。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2014-10-07T16:49:14.757

```
 $('').bind('input propertychange', function() {....}); 
```

这将适用于鼠标粘贴事件。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2013-05-06T18:15:42.707

如何比较字段的原始值和字段的更改值，并将差值作为粘贴值扣除？即使字段中存在现有文本，这也会正确捕获粘贴的文本。

[http://jsfiddle.net/6b7sK/](http://jsfiddle.net/6b7sK/)

```
function text_diff(first, second) {
    var start = 0;
    while (start < first.length && first[start] == second[start]) {
        ++start;
    }
    var end = 0;
    while (first.length - end > start && first[first.length - end - 1] == second[second.length - end - 1]) {
        ++end;
    }
    end = second.length - end;
    return second.substr(start, end - start);
}
$('textarea').bind('paste', function () {
    var self = $(this);
    var orig = self.val();
    setTimeout(function () {
        var pasted = text_diff(orig, $(self).val());
        console.log(pasted);
    });
}); 
```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2014-12-07T16:34:20.050

此代码对我有用，可以通过右键单击粘贴或直接复制粘贴

```
 $('.textbox').on('paste input propertychange', function (e) {
        $(this).val( $(this).val().replace(/[^0-9.]/g, '') );
    }) 
```

当我粘贴`Section 1: Labour Cost`它变成`1`在文本框中。

为了只允许浮点值，我使用此代码

```
 //only decimal
    $('.textbox').keypress(function(e) {
        if(e.which == 46 && $(this).val().indexOf('.') != -1) {
            e.preventDefault();
        } 
       if (e.which == 8 || e.which == 46) {
            return true;
       } else if ( e.which < 48 || e.which > 57) {
            e.preventDefault();
      }
    }); 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2014-12-23T05:44:28.750

```
document.addEventListener('paste', function(e){
    if(e.clipboardData.types.indexOf('text/html') > -1){
        processDataFromClipboard(e.clipboardData.getData('text/html'));
        e.preventDefault();

        ...
    }
}); 
```

## 更远：

*   [剪贴板 API 和事件](http://www.w3.org/TR/clipboard-apis/#events)

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-03-26T18:45:50.627

见这个例子：[http ://www.p2e.dk/diverse/detectPaste.htm](http://www.p2e.dk/diverse/detectPaste.htm)

它本质上使用 oninput 事件跟踪每个更改，然后通过字符串比较检查它是否是粘贴。哦，在 IE 中有一个 onpaste 事件。所以：

```
$ (something).bind ("input paste", function (e) {
    // check for paste as in example above and
    // do something
}) 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-06-19T16:12:34.413

此方法使用 jquery contents().unwrap()。

1.  一、检测粘贴事件
2.  向我们要粘贴的元素中已经存在的标签添加一个唯一的类。
3.  在给定的超时后扫描所有内容，展开没有您之前设置的类的标签。注意：此方法不会像
    **以下示例一样删除自闭合标签。**

    ```
    //find all children .find('*') and add the class .within .addClass("within") to all tags
    $('#answer_text').find('*').each(function () {
    $(this).addClass("within");
    });
    setTimeout(function() {
    $('#answer_text').find('*').each(function () {
        //if the current child does not have the specified class unwrap its contents
        $(this).not(".within").contents().unwrap();
    });
    }, 0); 
    ```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2012-12-16T22:32:11.217

使用类 portlet-form-input-field 从所有字段中删除特殊字符的脚本：

```
// Remove special chars from input field on paste
jQuery('.portlet-form-input-field').bind('paste', function(e) {
    var textInput = jQuery(this);
    setTimeout(function() {
        textInput.val(replaceSingleEndOfLineCharactersInString(textInput.val()));
    }, 200);
});

function replaceSingleEndOfLineCharactersInString(value) {
    <%
        // deal with end-of-line characters (\n or \r\n) that will affect string length calculation,
        // also remove all non-printable control characters that can cause XML validation errors
    %>
    if (value != "") {
        value = value.replace(/(\x00|\x01|\x02|\x03|\x04|\x05|\x06|\x07|\x08|\x0B|\x0C|\x0E|\x0F|\x10|\x11|\x12|\x13|\x14|\x15|\x16|\x17|\x18|\x19|\x1A|\x1B|\x1C|\x1D|\x1E|\x1F|\x7F)/gm,'');
        return value = value.replace(/(\r\n|\n|\r)/gm,'##').replace(/(\#\#)/gm,"\r\n");
    }
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-07-22T17:44:45.520

这被证明是非常虚幻的。在粘贴事件函数内的代码执行之前，输入的值不会更新。我尝试从粘贴事件函数中调用其他事件，但输入值仍未使用任何事件函数内的粘贴文本更新。这是除了 keyup 之外的所有事件。如果您从粘贴事件函数中调用 keyup，您可以从 keyup 事件函数中清理粘贴的文本。像这样...

```
$(':input').live
(
    'input paste',
    function(e)
    {
        $(this).keyup();
    }
);

$(':input').live
(
    'keyup',
    function(e)
    {
        // sanitize pasted text here
    }
); 
```

这里有一个警告。在 Firefox 中，如果您在每个键位上重置输入文本，如果文本长于输入宽度允许的可视区域，则在每个键位上重置值会破坏浏览器功能，该功能会自动将文本滚动到插入符号位置文本的结尾。相反，文本滚动回到开头，使插入符号不在视野范围内。

* * *

## 回答 #17

> 赞同：-2
> 
> 时间：2010-05-21T12:18:01.243

> 这里有一个警告。在 Firefox 中，如果您在每个键位上重置输入文本，如果文本长于输入宽度允许的可视区域，则在每个键位上重置值会破坏浏览器功能，该功能会自动将文本滚动到插入符号位置文本的结尾。相反，文本滚动回到开头，使插入符号不在视野范围内。

```
function scroll(elementToBeScrolled) 
{
     //this will reset the scroll to the bottom of the viewable area. 
     elementToBeScrolled.topscroll = elementToBeScrolled.scrollheight;
} 
```

# sql-server-2005 - 为什么 varchar 的最大长度小于 8,000 字节？

> ID：686996
> 
> 赞同：3
> 
> 时间：2009-03-26T18:24:56.123
> 
> 标签：sql-server-2005, stored-procedures, types

所以我在 SQLServer 2005 数据库中有一个存储过程，它从表中检索数据，将数据格式化为字符串并将其放入 varchar(max) 输出变量中。

但是，我注意到虽然 len(s) 报告字符串 > 8,000，但我收到的实际字符串（通过 SQLServer 输出窗口）总是被截断为 < 8,000 字节。

有谁知道这可能是什么原因？非常感谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-26T18:29:38.640

输出窗口本身很可能会截断您的数据。变量本身保存数据，但窗口仅显示前 X 个字符。

例如，如果您要从 .NET 应用程序中读取该输出变量，您将看到完整的值。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-26T18:30:51.007

您在谈论 SQL Server Management Studio 吗？如果是这样，有一些选项可以控制返回多少个字符（我面前只有 2008，但是设置在工具|选项|查询结果|SQL Server|结果到网格|最大检索字符和结果到文本中|每列中显示的最大字符数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-26T18:33:21.437

数据都在那里，但管理工作室并未显示所有数据。

在这种情况下，我使用 MS Access 链接到表并读取数据。很遗憾，您必须使用 Access 而不是 Management Studio 或 Query Analyzer 来查看数据，但似乎确实如此。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T18:45:55.043

*但是，我注意到虽然 len(s) 报告字符串 > 8,000*

我也陷入了 SQL Studio 问题:) 但 varchar 的最大长度不是 8,000 字节，或者 nvarchar (unicode) 的最大长度不是 4,000。

Any chance the column data type is actually **text** or **ntext** and you're converting to **varchar**?

# sql-server - 从 DDL 触发器获取数据库名称

> ID：686998
> 
> 赞同：1
> 
> 时间：2009-03-26T18:25:02.520
> 
> 标签：sql-server, triggers

我正在 SQL 2008 中创建服务器级触发器来记录表的创建和删除。我需要记录在其中创建/删除表的数据库。首先，我创建了一个默认值为 db_name() 的列，但这始终记录为 master。接下来我尝试在我的插入语句中使用它：

```
EVENTDATA().value('(/EVENT_INSTANCE/DatabaseName)[1]','nvarchar(max)') 
```

这工作了一段时间，但突然它开始记录所有表创建和删除的主控表，而不管表所在的数据库。所有表删除都是使用 SSMS 完成的。有谁知道我为什么会看到这种行为？更重要的是，有人知道如何记录正确的数据库吗？

编辑：我发现一篇文章让我觉得我在做的是不正确的。显然，您应该只从数据库范围的触发器中捕获 create_table 和 drop_table，而不是从 server_scoped 触发器中捕获。我仍然想留下这个问题，但万一有人知道如何解决这个问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T19:15:40.260

你好，

您是对的，应该从在数据库级别定义的 DDL 触发器中记录 CREATE TABLE 和 DROP TABLE 事件。

服务器级触发器用于服务器范围的事件，例如发生登录时。

这是一篇出色的文章，可以帮助您进行开发。

[http://www.developer.com/db/article.php/3552096](http://www.developer.com/db/article.php/3552096)

以下参考详细说明了可以在数据库或服务器范围内触发哪些 DDL 事件。

[http://msdn.microsoft.com/en-us/library/ms189871(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms189871(SQL.90).aspx) 干杯，*****************