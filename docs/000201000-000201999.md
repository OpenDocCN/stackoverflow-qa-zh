# StackOverflow 问答 000201000-000201999

# wcf - 为什么我不能使用 net.tcp 连接到 WCF 服务，但我可以使用 http？

> ID：201004
> 
> 赞同：21
> 
> 时间：2008-10-14T12:47:06.607
> 
> 标签：wcf, tcp, iis-6

我有一个使用 ServiceHostFactory 在 IIS 上运行的 WCF 服务。它与 WSHttpBinding 一起运行良好，但由于速度和一切都在同一个网络上（没有防火墙），我想使用 NetTcpBinding 来加快速度。

当我尝试这样做时，我收到此错误：

> 无法连接到 net.tcp://zzz.xxx.yyy/MyService.svc。连接尝试持续了 00:00:01.0464395 的时间跨度。TCP 错误代码 10061：无法建立连接，因为目标机器主动拒绝 xxxx:808。

我`SecurityMode.None`只是为了确保这不会让我感到困惑，而且我在两种不同的尝试中尝试了其中任何一种：

```
binding.Security.Message.ClientCredentialType = MessageCredentialType.None;
binding.Security.Message.ClientCredentialType = TcpClientCredentialType.Windows;, 
```

另外我应该指出，我从一个服务调用中提取了相当多的数据，所以我也放了这些（在 http 和 tcp 尝试上 - 将 maxMessageSize 设置为 1000000）

```
binding.MaxReceivedMessageSize = maxMessageSize;
binding.ReaderQuotas.MaxArrayLength = maxMessageSize; 
```

让它工作应该很容易，所以我错过了什么？

更新：我将 TCP 端口 808 添加到网站身份并再次尝试。现在我得到这个错误：

> 您尝试为不支持 .Net 框架的服务创建通道。您可能会遇到 HTTP 端点。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-04-23T09:25:18.740

如果您使用的是 Vista，请确保 WAS 和 Net.Tcp 侦听器适配器服务正在运行。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2012-03-16T10:44:45.060

对于遇到此问题的任何人，我的 net.tcp WCF 问题故障排除指南如下：

1.  检查 net.tcp 是否为网站启用的协议（在 IIS 中，右键单击该网站，转到高级设置，并确保启用的协议包括“net.tcp”
2.  我不确定这是否是偏执狂，我也一直需要通过命令行以及步骤 1 为站点启用 net.tcp。打开命令提示符，然后从`c:\windows\system32\inetsrv`输入`appcmd.exe set app "NameOfWebsite/" /enabledProtocols:http,net.tcp`
3.  检查 IIS 中网站的绑定是否有 net.tcp 条目，并且您已将其绑定到正确的端口号（对我来说，我使用 9000:* 作为与端口 9000 的绑定）。还要检查 IIS 中没有其他网站使用相同的 net.tcp 绑定到该端口
4.  检查“Net.TCP 侦听器适配器”服务是否正在运行。

完毕。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-10-14T13:01:07.203

查看[这篇](https://web.archive.org/web/20160611103146/http://marc.bloggingabout.net/2007/10/23/wcf-hosting-non-http-protocols-in-iis-7-0/)关于在 IIS 7.0 中启用非 HTTP 绑定的帖子。默认情况下，您必须在 IIS 7.0 中显式启用 net.tcp。

希望这可以帮助。

更新：

看到您的评论 - 不幸的是，IIS 6.0 不支持 net.tcp。查看[此链接](http://msdn.microsoft.com/en-us/library/ms730158.aspx)，其中详细介绍了各种主机（包括自托管、WAS 和 IIS）支持的 WCF 绑定。看起来只有 HTTP 绑定在 IIS 6.0 中有效。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-10-15T19:54:35.407

一旦我启动 Net.Tcp 侦听器适配器服务，服务对我来说工作正常。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-14T12:49:27.757

会不会像服务主机上的防火墙规则不允许端口 808 一样简单？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-12-13T14:30:55.970

检查 IIS 是否有两个协议都指向相同的端口号，我刚刚发现如果是这种情况，它将无法工作。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-03-30T12:00:28.967

我在 Window Server 2008 R2 上也遇到了这个问题

只需确保 Net.Tcp 端口共享服务也已启动，因为它是 Net.Tcp 侦听器适配器的依赖项。

# prototype - DAO 通常应该具有哪个范围

> ID：201022
> 
> 赞同：1
> 
> 时间：2008-10-14T12:50:59.080
> 
> 标签：prototype, dependency-injection, singleton, dao

道不会拥有任何状态，这是毫无疑问的。

但是，为了最容易地访问该类，使用原型（=每次都新建）还是单例更好？

简单的对象创建对于 dao 来说很便宜。它通常只拥有一个 sessionfactory，从单例列表中访问对象可能同样昂贵。

澄清：这个问题的重点是，如果对 daos 的范围界定有一个共同的约定。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-14T12:54:23.973

如果您的问题是关于**架构**的，我会将 DAO 范围限定为您正在执行**的工作单元或事务。**这**减少**了**交叉事务污染**和**线程问题**的可能性。

如果您的问题是关于**性能**的，那么答案就在**分析器**中，它可以为您的特定**工作负载提供****准确**的数字。

 *** * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-05-18T10:09:00.550

或者将原型与池结合使用，如下所述：

[http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/aop-api.html#aop-ts-pool](http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/aop-api.html#aop-ts-pool)

或者在这里：

[http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/classic-aop-spring.html#classic-aop-ts-pool](http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/classic-aop-spring.html#classic-aop-ts-pool)

编辑：显然，我假设这里使用了弹簧。否则我道歉

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T16:02:40.323

我得出的结论是，没有“完美”的方式来决定这一点。单例范围很可能是在 Web 应用程序中执行此操作的错误方式，因为您将有不同的会话 - 每个请求一个。所以在 webapp 中 - 请求范围可能是正确的答案，但前提是您仅在请求中而不是在后台任务中使用它。原型范围是可行的——但前提是你没有在那里保存复杂的数据。

# java - Hibernate Union 替代方案

> ID：201023
> 
> 赞同：62
> 
> 时间：2008-10-14T12:51:21.810
> 
> 标签：java, sql, hibernate, union

使用休眠实现联合查询有哪些替代方法？我知道hibernate目前不支持联合查询，现在我看到的唯一方法是使用视图表。

另一种选择是使用普通的 jdbc，但这样我会丢失我所有的示例/条件查询好东西，以及休眠对表/列执行的休眠映射验证。

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2010-10-15T07:59:14.507

你可以使用`id in (select id from ...) or id in (select id from ...)`

例如，而不**是非工作**

```
from Person p where p.name="Joe"
union
from Person p join p.children c where c.name="Joe" 
```

你可以做

```
from Person p 
  where p.id in (select p1.id from Person p1 where p1.name="Joe") 
    or p.id in (select p2.id from Person p2 join p2.children c where c.name="Joe"); 
```

不过，至少使用 MySQL，您稍后会遇到性能问题。有时在两个查询上做一个穷人的连接会更容易：

```
// use set for uniqueness
Set<Person> people = new HashSet<Person>((List<Person>) query1.list());
people.addAll((List<Person>) query2.list());
return new ArrayList<Person>(people); 
```

做两个简单的查询通常比做一个复杂的查询要好。

编辑：

举个例子，这里是来自 subselect 解决方案的 MySQL 查询的 EXPLAIN 输出：

```
mysql> explain 
  select p.* from PERSON p 
    where p.id in (select p1.id from PERSON p1 where p1.name = "Joe") 
      or p.id in (select p2.id from PERSON p2 
        join CHILDREN c on p2.id = c.parent where c.name="Joe") \G
*************************** 1\. row ***************************
           id: 1
  select_type: PRIMARY
        table: a
         type: ALL
possible_keys: NULL
          key: NULL
      key_len: NULL
          ref: NULL
         rows: 247554
        Extra: Using where
*************************** 2\. row ***************************
           id: 3
  select_type: DEPENDENT SUBQUERY
        table: NULL
         type: NULL
possible_keys: NULL
          key: NULL
      key_len: NULL
          ref: NULL
         rows: NULL
        Extra: Impossible WHERE noticed after reading const tables
*************************** 3\. row ***************************
           id: 2
  select_type: DEPENDENT SUBQUERY
        table: a1
         type: unique_subquery
possible_keys: PRIMARY,name,sortname
          key: PRIMARY
      key_len: 4
          ref: func
         rows: 1
        Extra: Using where
3 rows in set (0.00 sec) 
```

最重要的是，1\. row 不使用任何索引并考虑 200k+ 行。坏的！此查询的执行耗时 0.7 秒，其中两个子查询都以毫秒为单位。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2008-10-15T00:37:08.063

使用视图。可以使用实体名称将相同的类映射到不同的表/视图，因此您甚至不会有太多重复。在那里，做到这一点，工作正常。

普通 JDBC 有另一个隐藏的问题：它不知道 Hibernate 会话缓存，因此如果某些内容被缓存到事务结束并且没有从 Hibernate 会话中刷新，则 JDBC 查询将找不到它。有时可能非常令人费解。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-15T20:30:52.863

我必须同意弗拉基米尔的观点。我也研究过在 HQL 中使用 UNION 并且找不到解决方法。奇怪的是，我可以发现（在 Hibernate 常见问题解答中）UNION 不受支持，与 UNION 有关的错误报告标记为“已修复”，人们的新闻组说这些语句将在 UNION 被截断，以及其他新闻组的人报告它有效很好......经过一天的磨合后，我最终将我的 HQL 移植回纯 SQL，但在数据库中的视图中执行此操作将是一个不错的选择。在我的例子中，部分查询是动态生成的，所以我不得不在代码中构建 SQL。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2015-05-29T12:41:29.637

我有一个针对 HQL 中的 union 的关键场景（我为此付出了很多努力）的解决方案。

**例如，而不是不工作： -**

```
select i , j from A a  , (select i , j from B union select i , j from C) d where a.i = d.i 
```

或者

```
select i , j from A a  JOIN (select i , j from B union select i , j from C) d on a.i = d.i 
```

**你可以在 Hibernate HQL 中做 ->**

```
Query q1 =session.createQuery(select i , j from A a JOIN B b on a.i = b.i)
List l1 = q1.list();

Query q2 = session.createQuery(select i , j from A a JOIN C b on a.i = b.i)
List l2 = q2.list(); 
```

然后你可以添加两个列表->

```
l1.addAll(l2); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-16T18:44:32.593

视图是一种更好的方法，但由于 hql 通常返回 List 或 Set...您可以执行 list_1.addAll(list_2)。与工会相比完全糟糕，但应该工作。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-03-09T18:40:29.903

也许我有一个更直接的问题要解决。我的“例如”在 JPA 中，Hibernate 作为 JPA 提供者。

我将三个选择（在第二种情况下是两个）拆分为多个选择，并组合了我自己返回的集合，有效地替换了“联合全部”。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-23T01:44:18.453

我也经历过这种痛苦——如果查询是动态生成的（例如Hibernate Criteria），那么我找不到可行的方法来做到这一点。

对我来说好消息是我只是在调查联合以解决在 Oracle 数据库中使用“或”时的性能问题。

帕特里克发布的解决方案（使用集合以编程方式组合结果）虽然丑陋（特别是因为我也想做结果分页）对我来说已经足够了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-11-18T10:43:13.990

正如帕特里克所说，从每个**SELECT中附加****LIST**是一个好主意，但请记住它的行为类似于**UNION ALL**。为避免这种副作用，只需控制对象是否已添加到最终集合中。如果没有，那么添加它。 您应该关心的另一件事是，如果您在每个**SELECT中有任何****JOIN**，则结果将是对象数组（）的列表，因此您必须对其进行迭代以仅保留您需要的对象。 希望它有效。 **********`List<Object[]>`********** 

 ***** * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-07-14T04:44:48.890

这是一个特殊情况，但可能会激发您创建自己的工作。此处的目标是计算两个不同表中记录满足特定条件的记录总数。我相信这种技术适用于您需要跨多个表/源聚合数据的任何情况。

我有一些特殊的中间类设置，所以调用命名查询的代码很短而且很好用，但是你可以使用你通常使用的任何方法来执行你的查询。

```
QueryParms parms=new QueryParms();
parms.put("PROCDATE",PROCDATE);

Long pixelAll = ((SourceCount)Fetch.row("PIXEL_ALL",parms,logger)).getCOUNT(); 
```

正如您在此处看到的，命名查询开始看起来非常像联合语句：

```
@Entity
@NamedQueries({
        @NamedQuery(
            name  ="PIXEL_ALL",
            query = "" +
                    "  SELECT new SourceCount(" +
                    "     (select count(a) from PIXEL_LOG_CURR1 a " +
                    "       where to_char(a.TIMESTAMP, 'YYYYMMDD') = :PROCDATE " +
                    "     )," +
                    "     (select count(b) from PIXEL_LOG_CURR2 b" +
                    "       where to_char(b.TIMESTAMP, 'YYYYMMDD') = :PROCDATE " +
                    "     )" +
                    ") from Dual1" +
                    ""
    )
})

public class SourceCount {
    @Id
    private Long   COUNT;

    public SourceCount(Long COUNT1, Long COUNT2) {
        this.COUNT = COUNT1+COUNT2;
    }

    public Long getCOUNT() {
        return COUNT;
    }

    public void setCOUNT(Long COUNT) {
        this.COUNT = COUNT;
    }
} 
```

这里的部分魔法是创建一个虚拟表并将一条记录插入其中。在我的例子中，我将它命名为 dual1，因为我的数据库是 Oracle，但我认为你称之为虚拟表并不重要。

```
@Entity
@Table(name="DUAL1")
public class Dual1 {
    @Id
    Long ID;
} 
```

不要忘记插入您的虚拟记录：

```
SQL> insert into dual1 values (1); 
```

# sql - 我可以在 MS SQL Server 2005 中读取二进制字段

> ID：201025
> 
> 赞同：0
> 
> 时间：2008-10-14T12:51:56.037
> 
> 标签：sql, binary, field

我尝试读取数据库中的二进制字段（Project Server 2007; dbo.MSP_CALENDAR）。MS 不会在 PSI 中实现任何功能。

大家有什么建议吗？

提前致谢

SPO

在 Database Piblished 中，在表 dbo.MSP_CALENDAR 中，我找到了一个名为 CAL_DATA 的字段，该字段是 BINARY。我尝试将此字段 CAST 或 CONVERT 转换为字符串或 DateTime....... Microsoft 使用此字段来保存资源个人日历，但我无法仅在 Microsoft Office Project Pro 2007 中检索数据。在早期版本中，日历在日期时间。现在使用新版本的 Project 2007 Ms 将信息放在 Binary 字段中。我试图找到任何解决方案来阅读此信息。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T18:52:50.887

只需使用[CAST](http://msdn.microsoft.com/en-us/library/aa226054.aspx)语句

例如：

```
CREATE TABLE [dbo].[Table_1]([ID] INTEGER NOT NULL, [BIN] [binary](20) NULL);
INSERT INTO table_1 values (1, cast('I am a binary field' as BINARY));
SELECT ID, BIN, CAST(BIN AS VARCHAR(20)) AS BINTEXT FROM TABLE_1;

ID          BIN                                        BINTEXT
----------- ------------------------------------------ --------------------
1           0x4920616D20612062696E617279206669656C6400 I am a binary field 
```

# dns - 实体视角

> ID：201033
> 
> 赞同：4
> 
> 时间：2008-10-14T12:53:30.370
> 
> 标签：dns, domain-driven-design, entity

背景：所以，我正在尝试构建一个复杂得离谱的领域模型。与用户交谈，系统的使用方式有多种（例如：一种是从员工的角度；另一种是从雇主的角度）。实际上，它们是重用核心域的多个应用程序。

问题：从多个角度创建域是错误的吗？例如，在业务运行时构建域意味着创建各种关系类，这些关系类包含有关实体的额外信息等等......但是，从特定角度运行时，情况会更加清晰，因为大多数关系类可以滚动到它们的父实体中。

想法？反驳？我完全脱离基地了吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-14T13:08:22.807

不，这绝对合适。Evan 在他的书中称这些“观点”为限界上下文。

与其拥有一个非常复杂的域模型，不如尝试构建一个以特定方式很好地解决域的简单模型。限界上下文可以链接在一起，形成一个更小、更简单、直接的领域模型的网络。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T13:07:06.520

我认为您不应该尝试预先定义“核心域”。让它出现在开发过程中。此外，任何对 2 个（或更多）观点不常见的东西都不应该在“核心”中。

例如，从员工的角度构建系统的一部分。这可能会提示您创建“项目”、“任务”和“客户”等实体。然后从员工的角度构建一部分。这可能会提示您构建新实体，并重用“项目”和“任务”。那时我会将“项目”和“任务”移动到系统其余部分共享的“核心库”。

有时您会发现共同的实体，但以不同的方式相关。在这种情况下，关系应该由上下文注入，而不是内置于实体本身。

# c# - 是否有两种颜色的感知 DeltaRGB 比较（即，如 DeltaE2000）？

> ID：201037
> 
> 赞同：0
> 
> 时间：2008-10-14T12:54:33.537
> 
> 标签：c#, image-processing, colors, rgb

是否有可靠的 Delta RGB 公式或代码片段可以对完整的 RGB tri stim 值进行着色，例如 DeltaE 2000/cmc 如何考虑*感知*差异的 Lab/Lch？

RGB 颜色空间可以是任何颜色空间，但如果它需要是特定的颜色空间，我可以将其保留为 sRGB 用于计算。C# 是首选，但我可以从任何语言转换。

我目前有一个非常基本的 RGB 增量公式，但我想实现一些能够更真实地感知感知色差的东西。目前是

```
float delta = Math.Sqrt(Math.Pow(r1-r2, 2) + Math.Pow(g1-g2, 2) + Math.Pow(b1-b2, 2)); 
```

这与 DeltaE 76(lab) 类似，但它具有相同的缺点，即不考虑感知差异。

请不要只进行 Google 搜索并粘贴您看到的第一件事！可以找到很多 Delta RGB 公式，但不要考虑感知差异。如果您对此有所了解，请评论和/或粘贴任何指向代码示例的链接。另外，我已经从 RGB 转换为 Lab/Lch，然后转换为 De2000/cmc。我不是在寻找那个。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-16T08:58:33.510

恐怕您已经给出了唯一正确的答案：转换为感知色彩空间，其中简单的 delta 公式是有意义的。

一个多世纪以来，杰出的色彩科学家一直在试图回答感知色彩差异的问题。他们一直在寻找一个有效的简单 RGB 公式，但人类的感知太复杂了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-09T13:40:22.440

以防万一您没有找到它们：

*   [http://www.easyrgb.com/index.php?X=FAQS&H=05#text5](http://www.easyrgb.com/index.php?X=FAQS&H=05#text5)
*   [http://www.easyrgb.com/index.php?X=DELT](http://www.easyrgb.com/index.php?X=DELT)

# build-process - 何时使用构建工具？

> ID：201038
> 
> 赞同：8
> 
> 时间：2008-10-14T12:55:24.970
> 
> 标签：build-process, development-process

一个初学者的问题，请耐心等待：我只是想知道在什么情况下应该使用像 nant 或 msbuild 这样的构建工具？我正在开发一个中型应用程序（.net 3.0），每个开发人员都在做他的工作，并在他的机器上构建，检查他的代码更改到存储库中。一旦我们都完成了，我将从存储库中获取所有代码，在我的机器上进行干净的构建，然后部署二进制文件。只是出于好奇，构建工具在哪里？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-14T12:58:16.883

简短的回答总是。

每个开发人员都应该在签入代码之前使用构建脚本进行构建。构建版本的人员应该使用构建脚本来构建版本。您的构建机器人应该使用构建脚本来构建和测试已签入的代码。

这样做可以让所有开发人员、测试人员和构建机器人拥有一致的、可重复的构建。毕竟，[F5 键不是构建过程](https://blog.codinghorror.com/the-f5-key-is-not-a-build-process/)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-14T13:11:54.687

听起来您正在使用 IDE 进行构建。它本质上是一个构建工具；您已经在使用一个。当您使用的工具成为问题而非解决方案时，您应该切换工具。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-14T13:01:18.840

当您的构建过程超过一个命令时，应使用构建工具。它应该用于将您的标准构建过程归结为一个命令。如果您的构建过程比一个命令长，那么您就有机会从构建期间执行的错过/重复/不正确的命令中爬出错误。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-14T13:01:05.363

我认为任何重要的应用程序都需要一个“构建工具”。我们在我工作的地方使用术语持续集成。有非常特殊的情况（例如：我正在构建一个示例应用程序来了解功能 X 的工作原理），但除此之外，您永远不会后悔拥有一个可靠的构建过程。

我想如果开发团队由一个人组成……我*仍然*会建立一个构建系统，包括一个存储库、一个构建工具和多套测试。是的，维护构建系统需要时间和金钱，但它会得到回报（我已经为一个由 6 个开发人员开始的项目工作了 40 个月，现在包括大约 30 个开发人员；它确实为我们带来了很多回报次）在质量控制方面，越早发现质量问题，解决问题的成本就越低。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-14T14:04:27.810

When you start doing releases or when your build exceeds certain number of manual steps (you'll notice when it starts getting annoying.) I've written an old [blog entry](http://foobarbazqux.blogspot.com/2007/11/building-tools.html) on this topic which you might find interesting.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-14T12:59:55.520

如果你想自动化任何事情，最好使用 nant/msbuild。例如：1.签入 2.构建 3.测试和代码覆盖率

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-14T13:00:04.553

您是否使用 Visual Studio 进行开发？在这种情况下，您已经在使用 msbuild，因为它是 Visual Studio 的底层构建引擎。实际上，Visual Studio 项目文件只不过是一个 msbuild 脚本。

除此之外，您可以在专用的构建系统上使用构建引擎，这样您的二进制文件就可以在无人看管的情况下构建，而无需安装 Visual Studio。您也可以将其用于单元测试。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-14T13:04:31.707

同意并扩展 zacherates 的回答……是的，您应该始终有一些可重复的构建过程。虽然从技术上讲，Visual Studio 项目是 MSBuild 文件，但最好将“官方”构建过程与开发环境分开。

在我看来，无论团队有多大（或多小）都是如此。*我在家里*使用 NAnt 和 CruiseControl.NET ，我倾向于从事的只是临时项目和实验。在工作中，我们使用类似的设置，但在 NAnt 脚本的组合方式上更加结构化。

绝对值得您花时间研究它。这不是万灵药，但它是准确了解哪个版本何时发布以及什么是野外发布的最佳实践。能够识别您的编译代码是故障排除战的一半！:)

# asp.net - 如何在一台 Web 服务器上的 ASP.NET 网站和 ASP.NET Web 服务之间同步对文件的访问

> ID：201066
> 
> 赞同：1
> 
> 时间：2008-10-14T13:02:22.613
> 
> 标签：asp.net, web-services, multithreading

我已经在同一个 Web 服务器上部署了 ASP.NET 网站和 ASP.NET Web 服务。他们都需要访问共享文件。

如何实现/共享支持单写多读的锁？如果有人阅读，没有人可以写作，但所有人仍然可以阅读。如果有人写，没有人可以读/写。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T13:17:14.723

要打开文件进行写入并允许其他线程读取它，请使用 System.IO.File.Open 方法和 System.IO.FileShare.Read。IE。：

```
System.IO.File.Open("path.txt",System.IO.FileMode.OpenOrCreate,System.IO.FileAccess.ReadWrite,System.IO.FileShare.Read) 
```

其他（读取）线程应使用 System.IO.FileAccess.Read

Open方法的签名：

```
public static FileStream Open(string path, FileMode mode, FileAccess access, FileShare share); 
```

更新如果您需要所有实例偶尔写入文件。使用 Mutex 类来保留文件写入。IE。：

```
 Mutex mut = new Mutex("filename as mutex name");
    mut.WaitOne();
    //open file for write, 
    //write to file
    //close file
    mut.ReleaseMutex(); 
```

希望能帮助到你。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-20T21:16:52.440

使用 System.Threading 命名空间中的 ReaderWriterLock 或 ReaderWriterLockSlim (.NET 2.0) 类来处理单个写入器/多个读取器的情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T13:21:01.983

好吧，你可以这样做：

```
public class yourPage {
    static object writeLock = new object();
    void WriteFile(...) {
         lock(writeLock) {
              var sw = new StreamWriter(...);
              ... write to file ...
         }
} 
```

基本上，此解决方案仅适用于打开文件以进行短时间写入的情况。您可能需要考虑为读者缓存文件，或将文件写入临时文件，然后重命名以最大程度地减少争用。

# .net - SQLNCLI 和用于 SQL Server 的 .NET Framework 数据提供程序有什么区别

> ID：201068
> 
> 赞同：2
> 
> 时间：2008-10-14T13:04:09.523
> 
> 标签：.net, sql-server

我有一个使用 UDL 文件的应用程序，其中连接字符串指定“Provider=SQLNCLI.1”，由于未安装 sqlncli.dll，因此该文件在特定机器上不起作用。

然而，另一个 .Net 应用程序的连接字符串位于 app.config 中，并且没有具体显示提供程序确实有效。Visual Studio 中的“更改数据源”对话框将数据提供程序显示为“.NET Framework Data Provider for SQL Server”。即使未安装 sqlncli.dll，此应用程序也可以工作。

为什么？它使用什么提供商？它会以某种方式回退到 sqloledb.dll 吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T13:26:42.440

The SQL Server Native client is an independent data access API that was introduced in SQL Server 2005\.

From MSDN

> It also provides new functionality above and beyond that supplied by the Windows Data Access Components (Windows DAC, formerly Microsoft Data Access Components, or MDAC). SQL Server Native Client can be used to create new applications or enhance existing applications that need to take advantage of features introduced in SQL Server 2005, such as multiple active result sets (MARS), user-defined data types (UDT), query notifications, snapshot isolation, and XML data type support.

Read more about it and how it compares to MDAC/WDAC which is used by the ADO.Net SQL Server providers [here](http://msdn.microsoft.com/en-us/library/ms130892.aspx).

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2019-04-16T00:54:56.673

Microsoft Docs 有一篇关于此的有用文章：[何时使用 SQL Server Native Client](https://docs.microsoft.com/en-us/sql/relational-databases/native-client/when-to-use-sql-server-native-client?view=sql-server-2017)。

去引用：

> ***对于新应用程序***，如果您使用 Microsoft Visual C# 或 Visual Basic 等托管编程语言，并且需要访问 SQL Server 中的新功能，则应***使用 .NET Framework Data Provider for SQL Server***，它***是.NET 框架的***。
> 
> 如果您正在开发基于 COM 的应用程序并需要访问 SQL Server 中引入的新功能，则应使用 SQL Server Native Client。如果您不需要访问 SQL Server 的新功能，可以继续使用 Windows 数据访问组件 (WDAC)。
> 
> 对于现有的 OLE DB 和 ODBC 应用程序，主要问题是您是否需要访问 SQL Server 的新功能。如果你有一个成熟的应用程序，不需要 SQL Server 的新功能，你可以继续使用 WDAC。但如果您确实需要访问这些新功能，例如 xml 数据类型，您应该使用 SQL Server Native Client。

因此，***用于 SQL Server 的 .NET Framework 数据提供程序***是 .NET 的一部分，与 SQL Server Native Client 完全分离。将其用于新的开发。您只需将 SQL Server Native Client 用于使用 OLE DB 或 ODBC 的旧应用程序。

# .net - 如何解码 CSR 文件？

> ID：201070
> 
> 赞同：28
> 
> 时间：2008-10-14T13:04:20.660
> 
> 标签：.net, digital-certificate, csr

我遇到了一个 CSR 文件（证书签名请求），我需要从中提取一些信息。

有一种方法可以使用 .NET Framework 对其进行解码吗？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-12-09T17:14:08.913

它不是 .NET，但对于交互式使用，请尝试使用 OpenSSL 实用程序。具体来说：

```
openssl req -text -in request.csr 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-02-29T05:10:26.437

如果使用[OpenSSL.NET](http://openssl-net.sourceforge.net)库，解码 CSR 很容易：

```
// Load the CSR file
var csr = new X509Request(BIO.File("C:/temp/test.csr", "r"));
OR
var csr = new X509Request(@"-----BEGIN CERTIFICATE REQUEST-----...");

// Read CSR file properties
Console.WriteLine(csr.PublicKey.GetRSA().PublicKeyAsPEM);
Console.WriteLine(csr.Subject.SerialNumber);
Console.WriteLine(csr.Subject.Organization);
.
.
. 
```

X509Request 类型具有从 CSR 文件文本中获取所有内容的属性。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2019-11-18T13:12:48.263

```
certutil -dump file.csr 
```

还将转储所有相关信息。默认情况下内置在 Windows 中。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-12-22T11:04:38.223

试试[戴丽萍的网站](http://lipingshare.com/Asn1Editor/)。他的 LCLib 具有用 C# 编写的 ASN1 Parser。它可以解码 CSR。为我工作。

# java - 安全发布的单元测试

> ID：201078
> 
> 赞同：4
> 
> 时间：2008-10-14T13:07:17.597
> 
> 标签：java, unit-testing, concurrency, junit

## 您将如何对 Java 中的安全发布保证进行单元测试？

具体来说：

我有一个 Cache 接口，它有一个方法 getOrLoad(K key, ObjectLoader loader)。问题是，如果缓存找不到给定键的对象，那么它必须从 ObjectLoader 实例加载它。但是，缓存需要保证从加载器加载对象并将其放入缓存中的行为构成安全发布。

我现在正在为此 Cache 接口编写一个通用的 junit 测试，我想知道如何测试 Cache 实现是否遵守这个安全发布保证。

有任何想法吗？实际代码位于[代码存储库](http://github.com/karmazilla/nanocaching/tree/master)的 test-systest 模块部分，以防您想要查看真实文件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T15:59:32.227

也许您可以使用[ConTest](http://www.alphaworks.ibm.com/tech/contest)至少让您更加确信您的代码是正确的。

您需要实现几个同时运行多个线程的测试。然后，ConTest 将增加通过检测字节码（添加启发式控制的条件睡眠和产生指令）实际揭示并发错误的可能性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T19:13:26.313

我发现了Bill Pugh、Brian Goetz 和 Cliff Click 关于测试并发代码主题的[JavaOne 演示。](http://developers.sun.com/learning/javaoneonline/j1sessn.jsp?sessn=TS-2220&yr=2007&track=5)他们建议了这种方法，我认为这是我听过的最好的方法：

许多生产者使用状态相关的 hashCode 实现创建有状态和线程不安全的对象。当对象通过假定的同步点发送时，hashCodes 被总结（线程本地）。同样，门另一边的消费者对 hashCode 进行总结。

在测试结束时，我们分别总结了生产者和消费者的所有结果。如果两个和相等，则测试通过。

我们也可以使用 XOR 作为 sum 的替代方案。事实上，任何交换运算都可以。请记住，测试工具本身不得引入任何额外的同步。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T13:29:42.653

实际上由于不安全的发布而出错是非常困难的（如果有人知道怎么做，请告诉我）。静态分析是自动化解决方案的最佳选择。我会坚持代码审查，而不是过度担心它。

# sql-server - 如何从文本文件中删除最后一行？

> ID：201082
> 
> 赞同：2
> 
> 时间：2008-10-14T13:08:28.483
> 
> 标签：sql-server, text-files, ssis

使用 SQL Server Integration Services 从文本文件中删除最后一行的最简单方法是什么？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T14:28:07.840

因为 SSIS 是基于管道的，所以没有好的方法可以提前知道一行是最后一行。

但是，根据您的实际目标，有多种方法可以实现这一目标：

*   如果最后一行有一些识别信息，可以使用内置的过滤器组件简单地过滤掉。
*   您可以创建一个自定义组件，它会稍微缓冲管道并保留最后一行。
*   您可以添加行计数器，将文件输出到原始文件，然后读取原始文件，使用过滤器排除最后一行

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-07-26T21:52:27.950

Cade 有一些很好的答案，但只是为了添加另一个选项，您可能希望使用更通用的语言（如 PowerShell 或 Python）对文件进行预处理，以创建一个新版本，在将其引入 SQL 之前省略有问题的最后一行。

# visual-studio-2008 - 拥有测试版后无法安装 Visual Studio 2008

> ID：201087
> 
> 赞同：1
> 
> 时间：2008-10-14T13:09:09.590
> 
> 标签：visual-studio-2008, installation

尝试安装 Visual Studio 2008 时，我立即收到以下消息：

> “您必须按特定顺序卸载所有预发布产品，然后才能继续安装。”

然后它给了我[这个关于如何做到这一点的链接](http://www.microsoft.com/express/support/uninstall/)。

我已经研究这个问题很长一段时间了，尽我所能卸载组件（我的列表实际上与微软的列表不匹配），我在任何地方都找不到 3.5 框架的 beta 软件的踪迹。

但是，我只记得在安装 3.5 beta 2 后我必须“安装”以使我的 AJAX 1.0 继续工作 - [**ScottGu 提供的批处理脚本**](http://weblogs.asp.net/scottgu/archive/2007/07/26/vs-2008-and-net-3-5-beta-2-released.aspx)。我不太了解它的实际作用，但也许这是我必须撤消才能使安装工作的东西？！

我正在寻找一种解决方案来撤消批处理所做的事情，如果这没有帮助，我需要更多关于如何定位问题所在的提示，以便我最终可以安装 Visual Studio 2008。

ScottGu 的批次内容：

```
@ECHO OFF

ECHO Disabling publisher policy for System.Web.Extensions.
IF EXIST %windir%\assembly\GAC_MSIL\policy.1.0.System.Web.Extensions\3.5.0.0__31bf3856ad364e35\policy.1.0.System.Web.Extensions.cfg (
    REN %windir%\assembly\GAC_MSIL\policy.1.0.System.Web.Extensions\3.5.0.0__31bf3856ad364e35\policy.1.0.System.Web.Extensions.cfg policy.1.0.System.Web.Extensions.cfg.disabled
    IF ERRORLEVEL 1 (
        ECHO On Windows Vista this script must be run as administrator.
        GOTO :END
    )
)

ECHO Disabling publisher policy for System.Web.Extensions.Design.
IF EXIST %windir%\assembly\GAC_MSIL\policy.1.0.System.Web.Extensions.Design\3.5.0.0__31bf3856ad364e35\policy.1.0.System.Web.Extensions.Design.cfg (
    REN %windir%\assembly\GAC_MSIL\policy.1.0.System.Web.Extensions.Design\3.5.0.0__31bf3856ad364e35\policy.1.0.System.Web.Extensions.Design.cfg policy.1.0.System.Web.Extensions.Design.cfg.disabled
    IF ERRORLEVEL 1 (
        ECHO On Windows Vista this script must be run as administrator.
        GOTO :END
    )
)

:END
PAUSE 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T13:20:43.093

For me I had to uninstall VSS Report Services for SQL Server. Then uninstall everything SQL Express related, then uninstall Visual Studio. Clean out the registry hive for VS 9.0 and 9.0EXP. THEN it would reinstall. The VS 2008 SP1 RC attempted to update SQL Server Express to 2008 as well. That screwed up a lot of stuff on my box.

I have also read about Silverlight tools causing a conflict. If you installed an RC of them - get it out as well.

The only thing that batch file is doing is overwriting some policy files from 3.5 back to 1.0\. Probably because the VS 2008 installer doesn't expect them to have already been updated.

And hopefully this goes back to the old adage - never install Microsoft prerelease on anything by a VM.... (I never do this though)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T13:05:21.450

我有一个不同的问题 - 无法卸载团队套装版本。在我能够安装 VS 2008 开发人员版之后，这篇[SO 帖子](https://stackoverflow.com/questions/114332/visual-studio-setup-problem-a-problem-has-been-encountered-while-loading-the-se)和[这个工具帮助我自动卸载。](http://msdn.microsoft.com/en-us/vs2008/bb968856.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T13:49:46.717

也许这里有一些东西可以帮助你： [Visual Studio 2008 InstallFest](http://www.brokenwire.net/bw/Programming/58/visual-studio-2008-installfest-problems-with-the-visual-web-developer)

当我在“脏”电脑上安装 Visual Studio 2008 时遇到问题时，我写道。

# asp.net - How do I handle exceptions thrown by asmx services?

> ID：201095
> 
> 赞同：4
> 
> 时间：2008-10-14T13:11:55.590
> 
> 标签：asp.net, error-handling

ASP.NET ASMX service occasionally throws exceptions. However, global.asax Application_Error method do not seem to catch them. The question is, how to configure global error handler to catch and log these exceptions?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-19T18:29:59.813

ASMX Web 服务的基本问题（这不是问题）是服务层后面的任何异常都会作为 SOAP 异常抛出给客户端。您需要捕获 SOAP 异常，然后在那里寻找内部异常。

更好更干净的方法是在应用程序中实现 SOAP 处理程序。通过此序列化 SOAP 异常并在客户端反序列化它。这样，您将完全控制异常流，而不是 .net 框架。

高温高压

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T13:19:19.133

Is it the ASMX or the AJAX JavaScript which is throwing the exception?

If it's the Javascript, you'll need to write exception handling into your JS, and then push that back to the server to be tracked in your error datastore--possibly via another call to your webservice.

If it's the ASMX then it's probably getting caught by your Application_Error, BUT as ASMX returns XML or JSON it won't necessarily get displayed on your UI unless you're looking for it.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T13:23:31.573

Client-side I Would simply wrap your call to the service in a JavaScript. On the server-side the error should be logged in your server log as an. http 500 error

# c - 如何将数组的所有成员初始化为相同的值？

> ID：201101
> 
> 赞同：1091
> 
> 时间：2008-10-14T13:13:40.783
> 
> 标签：c, arrays, initialization, array-initialize

我在**C**中有一个大数组（如果有区别，不是**C++ ）。**我想初始化相同值的所有成员。

我可以发誓我曾经知道一个简单的方法来做到这一点。我可以`memset()`在我的情况下使用，但是没有一种内置于 C 语法中的方法吗？

* * *

## 回答 #1

> 赞同：1393
> 
> 时间：2008-10-14T13:17:23.130

除非该值为 0（在这种情况下，您可以省略初始化程序的某些部分并且相应的元素将被初始化为 0），否则没有简单的方法。

但是，不要忽视明显的解决方案：

```
int myArray[10] = { 5, 5, 5, 5, 5, 5, 5, 5, 5, 5 }; 
```

缺失值的元素将被初始化为 0：

```
int myArray[10] = { 1, 2 }; // initialize to 1,2,0,0,0... 
```

所以这会将所有元素初始化为0：

```
int myArray[10] = { 0 }; // all elements 0 
```

在 C++ 中，一个空的初始化列表也会将每个元素初始化为 0。这在 C 中是[不允许](https://stackoverflow.com/a/17589839)的：

```
int myArray[10] = {}; // all elements 0 in C++ 
```

请记住，如果未指定初始化程序，则具有静态存储持续时间的对象将初始化为 0：

```
static int myArray[10]; // all elements 0 
```

而且那个“0”并不一定意味着“所有位为零”，所以使用上面的方法比 memset() 更好，更便携。（浮点值将被初始化为 +0，指向空值的指针等）

* * *

## 回答 #2

> 赞同：436
> 
> 时间：2008-10-16T07:38:46.837

如果您的编译器是 GCC，您可以使用以下“GNU 扩展”语法：

```
int array[1024] = {[0 ... 1023] = 5}; 
```

查看详细说明： http: [//gcc.gnu.org/onlinedocs/gcc-4.1.2/gcc/Designated-Inits.html](http://gcc.gnu.org/onlinedocs/gcc-4.1.2/gcc/Designated-Inits.html)

* * *

## 回答 #3

> 赞同：190
> 
> 时间：2009-10-14T10:27:56.417

对于静态初始化具有相同值的大型数组，无需多次复制粘贴，您可以使用宏：

```
#define VAL_1X     42
#define VAL_2X     VAL_1X,  VAL_1X
#define VAL_4X     VAL_2X,  VAL_2X
#define VAL_8X     VAL_4X,  VAL_4X
#define VAL_16X    VAL_8X,  VAL_8X
#define VAL_32X    VAL_16X, VAL_16X
#define VAL_64X    VAL_32X, VAL_32X

int myArray[53] = { VAL_32X, VAL_16X, VAL_4X, VAL_1X }; 
```

如果您需要更改该值，则只需在一处进行替换。

## 编辑：可能有用的扩展

（[乔纳森·莱弗勒](https://stackoverflow.com/users/15168/jonathan-leffler)提供）

您可以通过以下方式轻松概括这一点：

```
#define VAL_1(X) X
#define VAL_2(X) VAL_1(X), VAL_1(X)
/* etc. */ 
```

可以使用以下方法创建变体：

```
#define STRUCTVAL_1(...) { __VA_ARGS__ }
#define STRUCTVAL_2(...) STRUCTVAL_1(__VA_ARGS__), STRUCTVAL_1(__VA_ARGS__)
/*etc */ 
```

适用于结构或复合数组。

```
#define STRUCTVAL_48(...) STRUCTVAL_32(__VA_ARGS__), STRUCTVAL_16(__VA_ARGS__)

struct Pair { char key[16]; char val[32]; };
struct Pair p_data[] = { STRUCTVAL_48("Key", "Value") };
int a_data[][4] = { STRUCTVAL_48(12, 19, 23, 37) }; 
```

宏名称可协商。

* * *

## 回答 #4

> 赞同：64
> 
> 时间：2008-10-14T18:30:25.917

如果要确保数组的每个成员都被显式初始化，只需在声明中省略维度：

```
int myArray[] = { 1, 2, 3, 4, 5, 6, 7, 8, 9 }; 
```

编译器将从初始化列表中推导出维度。不幸的是，对于多维数组，只有最外层的维度可以省略：

```
int myPoints[][3] = { { 1, 2, 3 }, { 4, 5, 6 }, { 7, 8, 9} }; 
```

可以，但是

```
int myPoints[][] = { { 1, 2, 3 }, { 4, 5, 6 }, { 7, 8, 9} }; 
```

不是。

* * *

## 回答 #5

> 赞同：56
> 
> 时间：2012-03-21T21:02:23.920

我看到了一些使用这种语法的代码：

```
char* array[] = 
{
    [0] = "Hello",
    [1] = "World"
}; 
```

如果您正在制作一个使用枚举作为索引的数组，它变得特别有用的地方：

```
enum
{
    ERR_OK,
    ERR_FAIL,
    ERR_MEMORY
};

#define _ITEM(x) [x] = #x

char* array[] = 
{
    _ITEM(ERR_OK),
    _ITEM(ERR_FAIL),
    _ITEM(ERR_MEMORY)
}; 
```

即使您碰巧乱写了一些枚举值，这也会使事情井井有条。

可以在[此处](http://publib.boulder.ibm.com/infocenter/lnxpcomp/v8v101/index.jsp?topic=/com.ibm.xlcpp8l.doc/language/ref/aryin.htm)和[此处](http://stupefydeveloper.blogspot.com/2008/10/c-initializing-arrays.html)找到有关此技术的更多信息。

* * *

## 回答 #6

> 赞同：23
> 
> 时间：2008-10-14T13:34:02.830

```
int i;
for (i = 0; i < ARRAY_SIZE; ++i)
{
  myArray[i] = VALUE;
} 
```

我认为这比

```
int myArray[10] = { 5, 5, 5, 5, 5, 5, 5, 5, 5, 5... 
```

以防数组的大小发生变化。

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2008-10-14T13:29:25.633

您可以按照上面详述的方式完成整个静态初始化程序，但是当您的数组大小发生变化时（当您的数组发生变化时，如果您不添加适当的额外初始化程序，您会得到垃圾），这可能是一个真正的麻烦。

memset 为您的工作提供运行时命中，但没有正确完成的代码大小命中不受数组大小更改的影响。当数组大于例如几十个元素时，我会在几乎所有情况下使用此解决方案。

如果静态声明数组真的很重要，我会编写一个程序来为我编写程序并使其成为构建过程的一部分。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2008-10-14T22:12:52.923

这是另一种方式：

```
static void
unhandled_interrupt(struct trap_frame *frame, int irq, void *arg)
{
    //this code intentionally left blank
}

static struct irqtbl_s vector_tbl[XCHAL_NUM_INTERRUPTS] = {
    [0 ... XCHAL_NUM_INTERRUPTS-1] {unhandled_interrupt, NULL},
}; 
```

看：

[C-扩展](http://gcc.gnu.org/onlinedocs/gcc-4.1.2/gcc/C-Extensions.html#C-Extensions)

指定初始化

然后问一个问题：什么时候可以使用 C 扩展？

上面的代码示例是在嵌入式系统中，永远不会看到来自另一个编译器的光芒。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2009-10-14T10:33:06.930

有点半开玩笑的回答；写声明

```
array = initial_value 
```

使用您最喜欢的支持数组的语言（我的是 Fortran，但还有很多其他语言），并将其链接到您的 C 代码。你可能想把它包装成一个外部函数。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2008-10-14T13:17:39.197

对于初始化“普通”数据类型（如 int 数组），您可以使用方括号表示法，但如果数组中仍有空间，它会将最后一个值之后的值归零：

```
// put values 1-8, then two zeroes
int list[10] = {1,2,3,4,5,6,7,8}; 
```

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2019-02-13T09:44:13.030

我知道最初的问题明确提到了 C 而不是 C++，但是如果你（像我一样）来这里寻找 C++ 数组的解决方案，这里有一个巧妙的技巧：

如果您的编译器支持[折叠表达式](https://en.cppreference.com/w/cpp/language/fold)，您可以使用模板魔术并使用`std::index_sequence`您想要的值生成初始化列表。你甚至`constexpr`可以感觉自己像个老板：

```
#include <array>

/// [3]
/// This functions's only purpose is to ignore the index given as the second
/// template argument and to always produce the value passed in.
template<class T, size_t /*ignored*/>
constexpr T identity_func(const T& value) {
    return value;
}

/// [2]
/// At this point, we have a list of indices that we can unfold
/// into an initializer list using the `identity_func` above.
template<class T, size_t... Indices>
constexpr std::array<T, sizeof...(Indices)>
make_array_of_impl(const T& value, std::index_sequence<Indices...>) {
    return {identity_func<T, Indices>(value)...};
}

/// [1]
/// This is the user-facing function.
/// The template arguments are swapped compared to the order used
/// for std::array, this way we can let the compiler infer the type
/// from the given value but still define it explicitly if we want to.
template<size_t Size, class T>
constexpr std::array<T, Size> 
make_array_of(const T& value) {
    using Indices = std::make_index_sequence<Size>;
    return make_array_of_impl(value, Indices{});
}

// std::array<int, 4>{42, 42, 42, 42}
constexpr auto test_array = make_array_of<4/*, int*/>(42);
static_assert(test_array[0] == 42);
static_assert(test_array[1] == 42);
static_assert(test_array[2] == 42);
static_assert(test_array[3] == 42);
// static_assert(test_array[4] == 42); out of bounds 
```

您可以查看[工作中的代码](https://wandbox.org/permlink/Z1E9hTYWWXZxIOs6)（在 Wandbox）

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2008-10-14T13:59:30.517

如果数组恰好是 int 或具有 int 大小的任何东西，或者您的 mem-pattern 的大小恰好适合 int 的时间（即全零或 0xA5A5A5A5），最好的方法是使用[memset()](http://www.cplusplus.com/reference/clibrary/cstring/memset.html)。

否则在移动索引的循环中调用 memcpy()。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2015-07-29T00:17:30.523

有一种快速的方法可以用给定的值初始化任何类型的数组。它适用于大型阵列。算法如下：

*   初始化数组的第一个元素（通常的方式）
*   将已设置的部分复制到尚未设置的部分，每次下一次复制操作将大小加倍

* * *

对于`1 000 000`元素`int`数组，它比常规循环初始化（i5、2 核、2.3 GHz、4GiB 内存、64 位）快 4 倍：

`loop runtime 0.004248 [seconds]`

`memfill() runtime 0.001085 [seconds]`

* * *

```
#include <stdio.h>
#include <time.h>
#include <string.h>
#define ARR_SIZE 1000000

void memfill(void *dest, size_t destsize, size_t elemsize) {
   char   *nextdest = (char *) dest + elemsize;
   size_t movesize, donesize = elemsize;

   destsize -= elemsize;
   while (destsize) {
      movesize = (donesize < destsize) ? donesize : destsize;
      memcpy(nextdest, dest, movesize);
      nextdest += movesize; destsize -= movesize; donesize += movesize;
   }
}    
int main() {
    clock_t timeStart;
    double  runTime;
    int     i, a[ARR_SIZE];

    timeStart = clock();
    for (i = 0; i < ARR_SIZE; i++)
        a[i] = 9;    
    runTime = (double)(clock() - timeStart) / (double)CLOCKS_PER_SEC;
    printf("loop runtime %f [seconds]\n",runTime);

    timeStart = clock();
    a[0] = 10;
    memfill(a, sizeof(a), sizeof(a[0]));
    runTime = (double)(clock() - timeStart) / (double)CLOCKS_PER_SEC;
    printf("memfill() runtime %f [seconds]\n",runTime);
    return 0;
} 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2015-07-29T01:21:32.187

1.  如果您的数组被声明为静态数组或全局数组，则数组中的所有元素都已经具有默认值 0。
2.  一些编译器在调试模式下将数组的默认值设置为 0。
3.  将默认值设置为 0 很容易： int array[10] = {0};
4.  但是，对于其他值，您可以使用 memset() 或循环；

示例：int数组[10]；memset(array,-1, 10 *sizeof(int));

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2021-01-10T11:10:18.363

整数数组[1024] = {[0 ... 1023] = 5}; 由于上述工作正常，但请确保 ... 点之间没有空格

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2016-02-06T15:24:42.237

没有人提到访问初始化数组元素的索引顺序。我的示例代码将给出一个说明性的例子。

```
#include <iostream>

void PrintArray(int a[3][3])
{
    std::cout << "a11 = " << a[0][0] << "\t\t" << "a12 = " << a[0][1] << "\t\t" << "a13 = " << a[0][2] << std::endl;
    std::cout << "a21 = " << a[1][0] << "\t\t" << "a22 = " << a[1][1] << "\t\t" << "a23 = " << a[1][2] << std::endl;
    std::cout << "a31 = " << a[2][0] << "\t\t" << "a32 = " << a[2][1] << "\t\t" << "a33 = " << a[2][2] << std::endl;
    std::cout << std::endl;
}

int wmain(int argc, wchar_t * argv[])
{
    int a1[3][3] =  {   11,     12,     13,     // The most
                        21,     22,     23,     // basic
                        31,     32,     33  };  // format.

    int a2[][3] =   {   11,     12,     13,     // The first (outer) dimension
                        21,     22,     23,     // may be omitted. The compiler
                        31,     32,     33  };  // will automatically deduce it.

    int a3[3][3] =  {   {11,    12,     13},    // The elements of each
                        {21,    22,     23},    // second (inner) dimension
                        {31,    32,     33} };  // can be grouped together.

    int a4[][3] =   {   {11,    12,     13},    // Again, the first dimension
                        {21,    22,     23},    // can be omitted when the 
                        {31,    32,     33} };  // inner elements are grouped.

    PrintArray(a1);
    PrintArray(a2);
    PrintArray(a3);
    PrintArray(a4);

    // This part shows in which order the elements are stored in the memory.
    int * b = (int *) a1;   // The output is the same for the all four arrays.
    for (int i=0; i<9; i++)
    {
        std::cout << b[i] << '\t';
    }

    return 0;
} 
```

输出是：

```
a11 = 11                a12 = 12                a13 = 13
a21 = 21                a22 = 22                a23 = 23
a31 = 31                a32 = 32                a33 = 33

a11 = 11                a12 = 12                a13 = 13
a21 = 21                a22 = 22                a23 = 23
a31 = 31                a32 = 32                a33 = 33

a11 = 11                a12 = 12                a13 = 13
a21 = 21                a22 = 22                a23 = 23
a31 = 31                a32 = 32                a33 = 33

a11 = 11                a12 = 12                a13 = 13
a21 = 21                a22 = 22                a23 = 23
a31 = 31                a32 = 32                a33 = 33

11      12      13      21      22      23      31      32      33 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2016-11-05T16:12:23.577

通过所有的讨论，简短的回答是，如果你在编译时打开优化，你不会比这做得更好：

```
int i,value=5,array[1000]; 
for(i=0;i<1000;i++) array[i]=value; 
```

额外的好处：代码实际上是清晰的:)

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2018-01-28T19:30:24.640

我知道用户`Tarski`以类似的方式回答了这个问题，但我添加了更多细节。原谅我的一些 C，因为我对它有点生疏，因为我更倾向于使用 C++，但是就这样吧。

* * *

如果您提前知道数组的大小...

```
#include <stdio.h>

typedef const unsigned int cUINT;
typedef unsigned int UINT;

cUINT size = 10;
cUINT initVal = 5;

void arrayInitializer( UINT* myArray, cUINT size, cUINT initVal );
void printArray( UINT* myArray ); 

int main() {        
    UINT myArray[size]; 
    /* Not initialized during declaration but can be
    initialized using a function for the appropriate TYPE*/
    arrayInitializer( myArray, size, initVal );

    printArray( myArray );

    return 0;
}

void arrayInitializer( UINT* myArray, cUINT size, cUINT initVal ) {
    for ( UINT n = 0; n < size; n++ ) {
        myArray[n] = initVal;
    }
}

void printArray( UINT* myArray ) {
    printf( "myArray = { " );
    for ( UINT n = 0; n < size; n++ ) {
        printf( "%u", myArray[n] );

        if ( n < size-1 )
            printf( ", " );
    }
    printf( " }\n" );
} 
```

上面有一些警告；一个是`UINT myArray[size];`在声明时没有直接初始化，但是下一个代码块或函数调用确实将数组的每个元素初始化为您想要的相同值。另一个需要注意的是，您必须`initializing function`为每个`type`您将支持的类型编写一个，并且您还必须修改`printArray()`函数以支持这些类型。

* * *

您可以使用[此处](https://www.onlinegdb.com/online_c_compiler)的在线编译器尝试此代码。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2018-10-19T17:08:44.263

对于延迟初始化（即类成员构造函数初始化），请考虑：

```
int a[4];

unsigned int size = sizeof(a) / sizeof(a[0]);
for (unsigned int i = 0; i < size; i++)
  a[i] = 0; 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2020-09-08T08:03:28.833

如果事先知道数组的大小，可以使用 Boost 预处理器 C_ARRAY_INITIALIZE 宏来为您完成这项肮脏的工作：

```
#include <boost/preprocessor/repetition/enum.hpp>
#define C_ARRAY_ELEMENT(z, index, name) name[index]
#define C_ARRAY_EXPAND(name,size) BOOST_PP_ENUM(size,C_ARRAY_ELEMENT,name)
#define C_ARRAY_VALUE(z, index, value) value
#define C_ARRAY_INITIALIZE(value,size) BOOST_PP_ENUM(size,C_ARRAY_VALUE,value) 
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2017-10-26T08:31:24.983

```
#include<stdio.h>
int main(){
int i,a[50];
for (i=0;i<50;i++){
    a[i]=5;// set value 5 to all the array index
}
for (i=0;i<50;i++)
printf("%d\n",a[i]);
   return 0;
} 
```

它将给出 o/p 5 5 5 5 5 5 ...... 直到整个数组的大小

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2021-06-14T15:14:56.043

> 方法一：

```
int a[5] = {3,3,3,3,3}; 
```

形式初始化技术。

> 方法二：

```
int a[100] = {0}; 
```

但值得注意的是

```
int a[10] = {1}; 
```

*不会将所有值初始化为 1*

这种初始化方式专为0

如果你只是这样做

```
int a[100]; 
```

一些编译器倾向于采用垃圾值，因此它总是首选

```
int a[1000] = {0}; 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2021-08-03T07:49:16.163

用零初始化 -

```
 char arr[1000] = { 0 }; 
```

最好使用正常的“for循环”进行初始化，而不是0。

```
 char arr[1000];
  for(int i=0; i<arr.size(); i++){
     arr[i] = 'A';
  } 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2021-10-15T08:56:21.550

就像克莱门斯·西拉夫的回答一样。此版本需要 C++17。

```
template <size_t Cnt, typename T>                                               
std::array<T, Cnt> make_array_of(const T& v)                                           
{                                                                               
    return []<size_t... Idx>(std::index_sequence<Idx...>, const auto& v)        
    {                                                                           
        auto identity = [](const auto& v, size_t) { return v; };                
        return std::array{identity(v, Idx)...};                                 
    }                                                                           
    (std::make_index_sequence<Cnt>{}, v);                                       
} 
```

[您可以在这里](https://godbolt.org/z/oTfc41d8W)看到它的实际效果。

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2009-10-13T23:40:25.983

我在问题中没有看到任何要求，因此解决方案必须是通用的：初始化未指定的可能多维数组，该数组由具有初始成员值的未指定的可能结构元素构建：

```
#include <string.h> 

void array_init( void *start, size_t element_size, size_t elements, void *initval ){
  memcpy(        start,              initval, element_size              );
  memcpy( (char*)start+element_size, start,   element_size*(elements-1) );
}

// testing
#include <stdio.h> 

struct s {
  int a;
  char b;
} array[2][3], init;

int main(){
  init = (struct s){.a = 3, .b = 'x'};
  array_init( array, sizeof(array[0][0]), 2*3, &init );

  for( int i=0; i<2; i++ )
    for( int j=0; j<3; j++ )
      printf("array[%i][%i].a = %i .b = '%c'\n",i,j,array[i][j].a,array[i][j].b);
} 
```

结果：

```
array[0][0].a = 3 .b = 'x'
array[0][1].a = 3 .b = 'x'
array[0][2].a = 3 .b = 'x'
array[1][0].a = 3 .b = 'x'
array[1][1].a = 3 .b = 'x'
array[1][2].a = 3 .b = 'x' 
```

编辑： `start+element_size`更改为`(char*)start+element_size`

* * *

## 回答 #26

> 赞同：-1
> 
> 时间：2019-01-14T08:53:41.297

回到过去（我并不是说这是个好主意），我们设置了第一个元素，然后：

`memcpy (&element [1], &element [0], sizeof (element)-sizeof (element [0]);`

甚至不确定它是否会继续工作（这将取决于 memcpy 的实现），但它通过重复将初始元素复制到下一个元素来工作 - 甚至适用于结构数组。

# .net - What factors should effect the Data Access Layer I use on a new project?

> ID：201132
> 
> 赞同：3
> 
> 时间：2008-10-14T13:22:05.757
> 
> 标签：.net, asp.net, data-access-layer

I will be teaching a class sson, and I need to explain what factors should affect your decision of data access technology. I am familiar with many data access methods like Typed Data Sets, Linq to SQL, Linq to Entities, .netTiers, LLBLGen, and custom calls with SQL connection objects and command objects. Some of my clients will only allow stored procedures to be used, and they will NOT discuss anything else. Some of my clients are NOT ready to install .NET 3.5 yet. Some clients require a middle web service tier in any web application. Most of the time I use Types Data Sets and Custom Web Services, or I use .netTiers with CodeSmith. What else should I be thinking about?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-14T13:33:02.380

One important thing to remember is that a database is not necessarily just a backing data store for an application (in isolation). Other applications and process could eventually require access to the database, especially in large or “enterprise” databases (or applications) and especially given enough time.

It’s important to consider:

*   ETL/Loads/Migration*   External integration/synchronization (BizTalk/SSIS)*   Reuse by other applications (particularly web sites, mobile applications etc)*   Security/attack surface (is one approach less secure than another?)*   Maintenance tasks*   Availability - will the database be in use 24/7? Is one approach going to provide better availability than another, etc.

Also, some design consideration is in order. Are you tuning for faster selects, or faster writes? One data access design might perform better than another.

I’m not stating that there is a single silver bullet, but what I do caution is that any data access design pattern requires “big picture” thought - will it address today's concerns and what you can reasonably predict might be tomorrow's needs?

Also, will you be providing an external API or some framework for consistent data access? Will it be exposed directly or indirectly?

There’s a place, I think, for both the Entity Framework/LINQ to SQL, traditional Stored Procedures and other tools like NHibernate (etc), but you should justify and rationalise the choice of technology first, and try to ensure it is appropriate for the present and future needs.

EDIT: Sorry, I forgot the big one: maintainability. Some of the template driven solutions offer you some decent wins in being able to regenerate a DAL after schema changes, over others (like hand written stored procedures). It's worth weighing up the productivity gains vs the disadvantages.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T13:44:14.120

Like with all choice's in a software project : It depends... But in my opinion the most important factor is the environment of the project.

This consists of (I don't claim that this list is complete in anyway):

*   Available skills within development team AND maintenance team (if different)
*   Required features
*   Constraints set by clients (not all clients support all technologies available. This certainly something you should take into account when incrementally replacing a legacy system or introducing a new system to a environment)
*   Constraints set by legislation

hope this helps you.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T14:27:00.977

I think that between your original post and norbertB's additions you've covered just about everything. Start with the absolute constraints (and remember, that just because a client says no to something once - even if they say it's absolute - that doesn't mean you can't help change their mind...). Once you've narrowed down the field with the absolute constraints look at the other things.

One thing that did seem to be left out was flexibility. For example, if I were trying to choose between two similar technologies and I knew that one could support updateable views and the other couldn't, even if I had absolutely no need for updateable views at the time I would still lean towards that one "just in case".

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-14T13:39:37.343

I'm really only thinking of two things. The first is whether I going to have so much data that anything else matters. If you're not putting millions of rows into the tables, it probably doesn't matter which technology you're going to use because they'll all work fast enough.

The second thing is whether I can use LINQ, because I find that using LINQ (to SQL, to Entities, to LLBLGen, it doesn't matter) to query the database gives you two important things. The first is that it's very easy to write queries and second, it's moderately easy to switch between two frameworks that need LINQ, in case requirements change.

# sqlmetal - SQLmetal, is it only a mapper for linq to sql?

> ID：201135
> 
> 赞同：2
> 
> 时间：2008-10-14T13:23:23.930
> 
> 标签：sqlmetal

Is the code gen tool sqlmetal only a mapper to linq to sql?

I'm looking for something that will create common CRUD operations also like:

GetUserByID UpdateUserByID InsertUser GetAllUsers

etc.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T14:11:21.337

是的，SQLMetal 只创建映射文件。但是，一旦您在 LINQ to SQL 中设置了映射，大多数 CRUD 操作都是微不足道的。通常，在使用 LINQ to SQL 时，您不会使用这样的方法进行编码......例如，GetUserByID 将是：

```
using (var dc = new YourDataContext) {
     User u = dc.User.Single(u => u.ID == whateverID);
} 
```

对于真正琐碎的操作似乎更冗长，但是一旦您执行更复杂的操作，它就会变得非常强大，非常快。

# c++ - 如何在 C/C++ 中创建 JNIEnv 模拟

> ID：201141
> 
> 赞同：4
> 
> 时间：2008-10-14T13:27:02.300
> 
> 标签：c++, c, mocking, java-native-interface, cunit

我正在用 C 语言编写一些希望使用 cunit 进行测试的 JNI 代码。为了调用 JNI 函数，我需要创建一个有效的 JNIEnv 结构。

有谁知道是否有用于此目的的模拟框架，或者谁能给我一些关于如何自己创建模拟 JNIEnv 结构的指示？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-14T23:49:14.540

jni.h 包含 JNIEnv_ 的完整结构，包括“跳转表”JNINativeInterface_。您可以创建自己的 JNINativeInterface_ （指向模拟实现）并从中实例化 JNIEnv_ 。

针对评论进行编辑：（我没有查看您引用的其他 SO 问题）

```
#include "jni.h"
#include <iostream>

jint JNICALL MockGetVersion(JNIEnv *)
{
  return 23;
}

JNINativeInterface_ jnini = {
  0, 0, 0, 0, //4 reserved pointers
  MockGetVersion
};

// class Foo { public static native void bar(); }
void Java_Foo_bar(JNIEnv* jni, jclass)
{
  std::cout << jni->GetVersion() << std::endl;
}

int main()
{
  JNIEnv_ myjni = {&jnini};
  Java_Foo_bar(&myjni, 0);
  return 0;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T14:48:30.653

嘲笑 JNI 对我来说听起来像是一个痛苦的世界。我认为你可能会更好地模拟在 Java 中实现的调用，并使用 Junit 来测试 Java 端的功能

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-02-25T01:08:14.660

引用：“jnimock 是在 gmock 之上实现的。它提供了两个 C++ 类 'JNIEnvMock' 和 'JavaVMMock' 来分别模拟 'JNIEnv' 和 'JavaVM'。”

[https://github.com/ifokthenok/jnimock](https://github.com/ifokthenok/jnimock)

# algorithm - 高效遍历变更列表

> ID：201146
> 
> 赞同：1
> 
> 时间：2008-10-14T13:28:32.373
> 
> 标签：algorithm, complexity-theory, big-o

我有一个列表更改列表 - 添加和删除。列表可能很大——比如 10,000 项。

**我想知道更改 9'000 后列表的状态。**

我可以从一开始就遍历列表以更改 9'000。这对我来说似乎有点啰嗦。

我可以保留一个项目列表并记录它们何时被添加和何时被删除，然后遍历此列表以查看列表中特定更改的内容。如果添加和删除的可能性相同，我将需要遍历的列表元素数量减半......

但是大 O 表示法表示，将问题的大小减半并不能提高效率（如果我理解正确的话）。

我可以在每 100 次或第 1000 次更改时缓存列表的状态……但是，大 O 再次表示，将项目数除以“n”并不能提高效率。

那么这样做的有效方法是什么？有没有一种有效的方法来做到这一点？

**更多细节：** 具体来说，我正在跟踪自定义分配器中的内存分配/释放。每个分配/解除分配都是列表中的一个事件。每个分配都有一个唯一的 ID。我想知道（例如）9'000 个事件之后当前分配的内容。

我的第一个想法是为每个 id 存储分配的事件和解除分配的事件。然后将此列表遍历到分配事件大于 9000 的第一个分配。但是就像我说的，这只会使我需要遍历的项目数量减半。

我喜欢 Mike F 提出的观点——从最近的第 100 个项目步行是恒定的时间......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T13:38:05.240

如果您在每第 X 次更改时缓存列表的状态，那么您可以进行二进制切割以降低到限制您正在寻找的更改的两个缓存状态，然后您最多步行 X 个项目以到达项目本身。这或多或少是 O(log N)。

但更一般地说，降低大 O 复杂性是手段，而不是目的。如果您的列表通常包含 10,000 项，那么您应该担心在 N=10,000 时使其快速，无论是通过降低复杂性还是通过使其更快。

**编辑：**哎呀，我只是更仔细地阅读了你的问题。如果您每（例如）100 个项目缓存一次状态，那么您就不会进行搜索，因此您甚至不需要进行二进制切割 - 您只需直接跳转到最近的缓存状态并最多步行 100 个项目即可到达该项目本身。所以这是一个恒定时间算法，不是吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T13:36:36.540

您正在使用哪种结构？没有一种有效的方法来遍历一个通用的数据结构，但是对于特定的结构有成千上万的优化方法和有效的方法。

是的，如果你有一个 O(n) 时间复杂度的算法，将项目数量减半不会改变它的 O(n) 复杂度......但这意味着每个新项目只有一半的效果原来有。大 O 表示法是一种对算法进行分类的好方法，但它并没有真正提高效率，除了大量的数字（一个很好的例子是排序。在最坏的情况下，快速排序比合并排序更复杂......但你可以实现快速排序除了处理数百万个项目的排序之外，几乎所有应用程序都比合并排序更有效）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T13:52:20.673

'时间戳'或标记每个插入和删除，然后只需简单的遍历即可找到更改（O（n））。

# asp.net - Simple way to grab thumbnail of FLV in ASP.NET without changing permissions on server?

> ID：201147
> 
> 赞同：0
> 
> 时间：2008-10-14T13:28:55.727
> 
> 标签：asp.net, ffmpeg, flv, thumbnails, tao.ffmpeg

I'm looking for a simple way to grab thumbnails of FLVs in ASP.NET, without having to change any permissions/settings on the server. Ideally, nothing is installed on the server machine, but if necessary, small tools such as FFmpeg are fine.

I've tried FFmpeg using the command-line tool with Process.Start, but the same command that works in a Windows Forms application and from the command prompt does not work in ASP.NET (presumably because of permissions).

I've also tried using TAO.FFmpeg, and it seems to be working most of the time, but fails randomly, and does not start working again until the machine is restarted. Even when I use the sample code (decoder.cs), it sometimes fails when I try to open multiple videos in a single request.

If this isn't possible in a clean/straightforward way, I'm open to other suggestions.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T14:55:05.913

如果可以在页面上嵌入 Flash，显示 FLV 缩略图的最简单方法是将视频对象放在舞台上，通过动作脚本中的 NetStream 将视频附加到它，然后放入事件处理程序以暂停开始播放后立即移动。

例如，如果您在舞台上有一个名为“myVideo”的视频对象，并且您正在尝试显示“someVideo.flv”的缩略图，请尝试使用此 actionscript (2.0) 代码，

```
var connection_nc:NetConnection = new NetConnection();
connection_nc.connect(null);
var stream_ns:NetStream = new NetStream(connection_nc);
myVideo.attachVideo(stream_ns);
stream_ns.play("someVideo.flv");
stream_ns.seek(0);

stream_ns.onStatus = 函数（信息）
{
    if(info.code = "NetStream.Play.Start")
    {

        stream_ns.pause();
    }
}

```

在您的 ASPX 与您的 Flash 对话方面，您可以通过 FlashVars 将 FLV 视频名称传递给 Flash，以便您的 SWF 知道要显示什么缩略图。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T15:36:28.820

[在http://www.all4dotnet.com/](http://www.all4dotnet.com/)上试用 Media Manager Pro

# html - Do web applications need HTML header tags?

> ID：201148
> 
> 赞同：3
> 
> 时间：2008-10-14T13:28:59.143
> 
> 标签：html

The question is, should we design applications/forms using headers or stick to spans and divs? When the world was using html to link documents, these header tags looked like the 'Table of contents'. In the new era where html is used for applications, using header tags in the orthodox fashion (i.e. h1 contains h2, h2 contains h3 ...) doesn't make sense. Or does it?

The one place where these seem to make sense is in the context of text browsers or those with CSS disabled. Are there any implications of violating the nesting order (for e.g: h2 being the top level element instead of h1)

**Edit** By 'New era' I meant usage of html for interactive web applications. The notion of a header tag in a form or a mail application or a file sharing application is what I was questioning. I should avoid fancy names I guess, and I don't actually mean `<h1><h2>...</h2></h1>` It is more like the content organisation in MS Word.

I did work on some W3C compliant and AA compliant web pages, if it helps. The screen readers like dolphin supernova, just read the content, I fail to recognise how they distinguish headers or I may be missing some rather important feature.

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-14T13:31:25.677

h1, h2, h3, etc. are semantic. Divs and spans are not. Using headers means that agents can easily determine which pieces of content are headers, giving precedence to them in, for example, screen readers or search results.

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-14T13:35:41.970

首先，标题标签不应该嵌套。理想情况下，h1、h2 等应该只包含文本，而不是其他标签。

其次，作为指导原则，你应该每页只有一个 h1 标签，理想情况下应该与你的文档标题相匹配。

对标题使用标题标签而不是跨度或 div 是一种很好的做法。许多搜索引擎将这些标签中的关键字的权重高于其他标签中的关键字。页面摘要器也将使用这种结构。

通常，如果您有一个奇怪的标题标签排序，或者没有任何标签，您的页面结构可能有问题。（当然，您不必全部使用它们，但 h1 标签几乎总是一个好主意）。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-14T13:32:05.113

It does make MUCH sense. Your code should have a meaning (from a semantic point of view). If you want a header, hX is the tag you should use. A span or a div will work, but it is not a header.

Take a look at a [similar discussion](https://stackoverflow.com/questions/83073/div-vs-table).

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-14T13:32:35.550

为什么你觉得结构化标记没有意义？仅仅因为您可以根据您的设计意愿对任何元素进行样式设置，并不会使语义过时。一方面，不要忘记搜索引擎实际上为位于重要语义元素（例如标题）内的文本分配了不同的值。

回答你标题中的问题（哇，这是一个标题！谷歌使用它！）：**是**的。

顺便问一下，你说的这个“新时代”是什么？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-14T14:12:07.450

请注意，某些 Web 应用程序不需要标头，因为 HTML 旨在从语义上描述*文档*的结构，而不是 Web 应用程序。

理想情况下，将有一种单独的基于 XML 的语言，所有浏览器都支持专门用于 Web 应用程序的呈现。XUL 或 XAML 之类的东西可能适合这些要求。但是由于这不是我们今天制作 Web 应用程序的环境，所以您经常会被 HTML 所困扰，它充其量是通用的（div、span）并且在其他地方无关紧要（您不需要 Web 应用程序中的语义标头）。

因此，从实用的角度来看，最好的方法是在许多情况下忽略语义上有意义的 HTML 标记，而是使用类名和 id 来定义结构。这样，您仍将开发自己的语义环境并以将表示与内容分开的方式进行编程，这是 HTML 和 CSS 的好处之一，但不必“仅仅因为它是这样完成的”而将自己附加到格式上.

因此，此线程中的一些答案没有抓住重点：您正在开发一个 Web 应用程序，而 HTML 不是为该应用程序设计的。不要将方形钉子强行插入圆孔。

编辑：Bobby Jack 评论说，当然，仍然有一些 Web 应用程序定义了类似文档的视图，例如 Stack Overflow。因此，在这些情况下，当然，在相关的情况下，使用正确的语义标记。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-14T13:31:42.337

Other than the browsers where settings are such that the browser style overrides your CSS (user styles), I don't think that there are any other problems if you use h2 before h1 or vice versa.

Also, as you said using headers formats your document to an extent without even having CSS.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-14T14:05:45.420

为标题使用标题标签，并根据需要使用 CSS 设置样式以实现您想要的外观。排序应该反映文档的组织，但是您可以使用 CSS 为它们提供任何您想要的外观和感觉。不过，我会说，我会使用排版来反映组织而不是混淆它。

# c# - WCF client consuming multiple asmx service that uses HTTP Cookies

> ID：201153
> 
> 赞同：3
> 
> 时间：2008-10-14T13:30:08.457
> 
> 标签：c#, asp.net, wcf, cookies, asmx

I am trying to use the same http cookie (in effect a asmx sessionid), in multiple WCF client endpoints.

The server has several endpoints, one of them is:

AuthenticationService.asmx
Login() <- Creates a HTTP cookie that is the servers ASP.NET sessionid
Logout() <- Destroys the same cookies

SomeOtherService.asmx
DoSomeThing() <- Requeres a valid cookie from the AuthenticationService.asmx.

How can I share the HTTP Cookie across multiple endpoints.

I dont have control over the server code, and the must use WCF.

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-19T14:04:11.460

看看[这篇文章](http://blogs.msdn.com/drnick/archive/2008/01/17/custom-cookie-handling.aspx)。
它解释了如何在 WCF 客户端代理中手动管理 cookie。更准确地说，WCF 公开了一个 API，让您可以从 HTTP 响应中提取 cookie，并且以同样的方式，手动将 cookie 设置为 HTTP 请求。

您需要做的是利用此机制**从给定客户端代理收到的 HTTP 响应中手动提取 cookie，并将相同的 cookie 分配给另一个客户端代理发送给不同服务的 HTTP 请求。**

[MSDN 论坛上的这个线程](http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/624fb3f9-222d-4795-9140-fe9ef3934361/)解释了如何使用 WCF 消息检查器为应用程序中的每个服务调用执行此操作。

**更新：**

我写了一篇关于如何解决这个问题的博客文章。你可以[在这里](http://megakemp.wordpress.com/2009/02/06/managing-shared-cookies-in-wcf/)阅读。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T23:17:42.287

我刚刚遇到了同样的问题。如果 WCF 客户端只与一个 ASP.NET 服务通信，那么这很容易。只需将 BasicHttpBinding 上的 AllowCookies 属性设置为 true，服务代理就会自动处理 ASP.NET 会话 ID cookie。

但是我遇到了像你这样的情况，有 2 个 ASP.NET 服务需要我的 WCF 客户端与之通信。第一个发出一个 ASP.NET 会话 ID cookie，我需要能够将该 cookie 在调用中传递给第二个服务。有谁知道如何做到这一点？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-15T00:04:14.667

如果您启用了 asp.net 兼容模式，您可以从 WCF 服务中访问 http 会话，因此您不需要添加任何 cookie 来执行此操作。

[http://msdn.microsoft.com/en-us/library/ms752234.aspx](http://msdn.microsoft.com/en-us/library/ms752234.aspx)

# .net - 在添加/删除视觉/逻辑子项时收到通知

> ID：201170
> 
> 赞同：14
> 
> 时间：2008-10-14T13:36:30.300
> 
> 标签：.net, wpf

我目前正在寻找一种在将孩子添加到视觉或逻辑孩子时得到通知的方法。

我知道 Visual::OnVisualChildrenChanged 方法，但它不适用于我，因为我不能总是继承和覆盖这个函数。我正在寻找一个活动。

那么，有没有办法在添加孩子时通知 FrameworkElement/Visual 的所有者？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-10-19T14:56:24.047

是不是更容易扩展

```
System.Windows.Controls.UIElementCollection 
```

做通知和使用

```
protected override UIElementCollection CreateUIElementCollection(FrameworkElement logicalParent) 
```

?

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-11T23:22:26.877

编辑：

我只是想到了一些事情。如果您能够在可视化树中出现的每个元素上设置一个 Loaded 处理程序，也许可以使用这样的技术来完成（认为这是一个非常基本的想法，只是作为一个可能的解决方案的开始）：

```
public class ElementChildrenChangedEventArgs
{
    public ElementChildrenChangedEventArgs(FrameworkElement parent, FrameworkElement child)
    {
        Parent = parent;
        Child = child;
    }

    public FrameworkElement Parent { get; private set;}
    public FrameworkElement Child { get; private set;}
}

public delegate void ChildrenChanged(ElementChildrenChangedEventArgs args);

public static class ElementLoadedManager
{
    private static readonly HashSet<FrameworkElement> elements = new HashSet<FrameworkElement>();

    public static void Process_Loaded(FrameworkElement fe)
    {
        FrameworkElement feParent = VisualTreeHelper.GetParent(fe) as FrameworkElement;

        if (feParent != null)
        {
            if (elements.Contains(feParent))
            {
                InvokeChildrenChanged(feParent, fe);
            }
        }

        if (!elements.Contains(fe))
        {
            elements.Add(fe);
        }

        fe.Unloaded += Element_Unloaded;           
    }

    static void Element_Unloaded(object sender, RoutedEventArgs e)
    {
        FrameworkElement fe = sender as FrameworkElement;
        elements.Remove(fe);
        ClearUnloaded(fe);
    }

    static void ClearUnloaded(FrameworkElement fe)
    {
        fe.Unloaded -= Element_Unloaded;
    }

    public static event ChildrenChanged ChildrenChanged;

    private static void InvokeChildrenChanged(FrameworkElement parent, FrameworkElement child)
    {
        ElementChildrenChangedEventArgs args = new ElementChildrenChangedEventArgs(parent, child);

        ChildrenChanged changed = ChildrenChanged;

        if (changed != null) changed(args);
    }
} 
```

这个想法（和要求）是在每个元素的 Loaded 处理程序中调用 Process_Loaded(FrameworkElement) 方法，这可以通过一些样式/模板设置来完成。

由于 Loaded 是一个路由事件，您可以仅在父窗口上设置处理程序并检查 e.OriginalSource。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-18T04:17:33.297

我相信[FrameworkElement.Loaded](http://msdn.microsoft.com/en-us/library/system.windows.frameworkelement.loaded.aspx)和[FrameworkElement.Unloaded](http://msdn.microsoft.com/en-us/library/system.windows.frameworkelement.unloaded.aspx)分别在将控件添加到可视树和从可视树中删除时被触发。然而，有几次我试图对它们做任何事情，我无法让它们持续触发（当时我正在使用类事件处理程序，所以这可能与它有关）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-10T12:41:56.477

也许值得添加到子字段保持对父级的引用并在更改回它后发送通知？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-06-07T17:38:04.183

您可以在子元素上使用附加行为，以引发从子元素冒泡到其父元素的附加事件。或者，在孩子的加载事件中，您可以简单地在逻辑树上搜索父级，然后在那里调用一个方法或设置一个属性（例如增加一个孩子的计数），以表明孩子在那里，取决于你想在父母身上发生什么。如果您使用方法设置属性，则还必须处理 Unloaded。

Loaded 和 Unloaded 并不总是按预期提升。但是，如果您使用 DataTemplates 创建子控件，则应始终分别在创建和销毁控件时触发它们。

# c# - 接口不接受继承的成员（OO 问题）

> ID：201178
> 
> 赞同：2
> 
> 时间：2008-10-14T13:39:00.030
> 
> 标签：c#, oop

我觉得自己像个傻瓜，但这里有：

```
public interface IHasErrorController{
  ErrorController ErrorController { get; set; }
}

public class DSErrorController: ErrorController{yadi yadi ya}

public class DSWebsiteController : Controller, IHasErrorController{
    public DSErrorController ErrorController { get; set; }
} 
```

这给了我一个错误，说 DSWebsiteController.ErrorController 无法实现 IHasErrorController，尽管 DSErrorController 是从 ErrorController 继承的。

此外，欢迎提出更好的命名建议，以便 ErrorController 类型和字段 Errorcontroller 看起来不一样（命名很难）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-14T13:43:48.490

C#（目前）几乎没有 [co|contra]variance 支持；因此，接口实现必须*完全*匹配，包括返回类型。为了在类 API 上保留您的 concreate 类型，我将显式实现接口 - 即添加：

```
ErrorController IHasErrorControlloer.ErrorController {
  get {return this.ErrorController;}
  set {this.ErrorController = (DSErrorController)value;}
} 
```

或者，只需将属性的类型更改为`ErrorController`- 这可能（或可能不会）提供您需要的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T13:44:01.500

这是真的; 这是不允许的。（正确的名称是“协变返回类型”）

注意 DSWebsiteController.ErrorController 可以物理地返回一个 DSErrorController 对象；只是属性的返回值必须定义为ErrorController。

# visual-studio - 异常调试：如何解决“抛出时中断”

> ID：201182
> 
> 赞同：5
> 
> 时间：2008-10-14T13:40:40.570
> 
> 标签：visual-studio, debugging, exception-handling

我已经厌倦了清除 Debugging->Exceptions 选项`Break when thrown`以通过我正确处理的异常，然后设置`Break when thrown`选项以查找未正确处理的后续异常的来源。

我想要一种方法来排除某些 try 块`Break when thrown`，例如预处理器指令或其他东西。我尝试录制一个宏，但它所做的只是打开 Debugging->Exceptions 对话框。

即使在粗粒度的情况下，最好指定哪些方法可以免于`Break when thrown`调试。

这是白日梦吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-14T13:44:29.580

按 Alt-Ctrl-e 以调出例外窗口。

指定您希望忽略的异常。

# javascript - 如何确定两个 JavaScript 对象的相等性？

> ID：201183
> 
> 赞同：845
> 
> 时间：2008-10-14T13:41:07.357
> 
> 标签：javascript, object, equals, hashcode

严格相等运算符会告诉您两个对象**类型**是否相等。但是，有没有办法判断两个对象是否相等，**就像**Java 中的哈希码值一样？

堆栈溢出问题*[JavaScript 中是否有任何类型的 hashCode 函数？](https://stackoverflow.com/questions/194846)*与this question类似，但需要更学术的答案。上面的场景说明了为什么有必要拥有一个，我想知道是否有任何**等效的解决方案**。

* * *

## 回答 #1

> 赞同：631
> 
> 时间：2010-07-07T19:35:38.133

为什么要重新发明轮子？[试试](http://lodash.com/docs#isEqual)Lodash 。它具有许多必备功能，例如[isEqual()](http://lodash.com/docs#isEqual)。

```
_.isEqual(object, other); 
```

[它将使用ECMAScript 5](http://en.wikipedia.org/wiki/ECMAScript#Versions)和本机优化（如果它们在浏览器中可用）来强力检查每个键值 - 就像本页上的其他示例一样。

注意：以前这个答案推荐[Underscore.js](http://underscorejs.org/)，但[lodash](http://lodash.com)在修复错误和解决一致性问题方面做得更好。

* * *

## 回答 #2

> 赞同：216
> 
> 时间：2008-10-14T14:48:47.440

**简短的回答**

简单的答案是：不，没有通用的方法可以确定一个对象与您所说的另一个对象相等。例外情况是当您严格认为对象是无类型的时。

**长答案**

这个概念是 Equals 方法的概念，它比较对象的两个不同实例以指示它们在值级别是否相等。但是，如何`Equals`实现方法取决于具体类型。具有原始值的属性的迭代比较可能是不够的：一个对象可能包含与相等性无关的属性。例如，

```
 function MyClass(a, b)
 {
     var c;
     this.getCLazy = function() {
         if (c === undefined) c = a * b // imagine * is really expensive
         return c;
     }
  } 
```

在上述情况下，`c`确定 MyClass 的任何两个实例是否相等并不重要，仅`a`重要`b`的是。在某些情况下`c`，实例之间可能会有所不同，但在比较期间并不重要。

请注意，当成员本身也可能是一种类型的实例并且这些成员都需要具有确定相等性的方法时，此问题适用。

更复杂的是，在 JavaScript 中，数据和方法之间的区别是模糊的。

一个对象可能引用一个作为事件处理程序调用的方法，这可能不会被视为其“值状态”的一部分。而另一个对象很可能被分配一个执行重要计算的函数，从而使这个实例与其他实例不同，因为它引用了不同的函数。

如果一个对象的一个​​现有原型方法被另一个函数覆盖了呢？它是否仍然可以被认为与另一个相同的实例相同？这个问题只能在每种类型的每个特定情况下回答。

如前所述，异常将是严格无类型的对象。在这种情况下，唯一明智的选择是对每个成员进行迭代和递归比较。即便如此，人们也不得不问函数的“价值”是什么？

* * *

## 回答 #3

> 赞同：183
> 
> 时间：2009-05-20T03:48:14.083

JavaScript for Objects 中的默认相等运算符在它们引用内存中的相同位置时产生 true。

```
var x = {};
var y = {};
var z = x;

x === y; // => false
x === z; // => true 
```

如果您需要不同的相等运算符，`equals(other)`则需要向您的类添加一个方法或类似的东西，并且您的问题域的细节将确定这究竟意味着什么。

这是一个扑克牌示例：

```
function Card(rank, suit) {
  this.rank = rank;
  this.suit = suit;
  this.equals = function(other) {
     return other.rank == this.rank && other.suit == this.suit;
  };
}

var queenOfClubs = new Card(12, "C");
var kingOfSpades = new Card(13, "S");

queenOfClubs.equals(kingOfSpades); // => false
kingOfSpades.equals(new Card(13, "S")); // => true 
```

* * *

## 回答 #4

> 赞同：86
> 
> 时间：2013-09-27T16:13:13.530

如果您在[AngularJS](http://docs.angularjs.org)中工作，该`angular.equals`函数将确定两个对象是否相等。在[Ember.js 中](http://emberjs.com/api/)使用`isEqual`.

*   `angular.equals`- 有关此方法的更多信息，请参阅[文档](http://docs.angularjs.org/api/angular.equals)或[来源](https://github.com/angular/angular.js/blob/6c59e770084912d2345e7f83f983092a2d305ae3/src/Angular.js#L670)。它也对数组进行了深入比较。
*   Ember.js - 有关此方法的更多信息，`isEqual`请参阅[文档](http://emberjs.com/api/#method_isEqual)或[源代码。](https://github.com/emberjs/ember.js/blob/dfbdbea00bb94f3c1620bd09145540a8bbb8e224/packages/ember-runtime/lib/is-equal.js)它不对数组进行深度比较。

```
var purple = [{"purple": "drank"}];
var drank = [{"purple": "drank"}];

if(angular.equals(purple, drank)) {
    document.write('got dat');
}
```

```
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.5/angular.min.js"></script>
```

* * *

## 回答 #5

> 赞同：80
> 
> 时间：2013-05-28T09:28:49.833

这是我的版本。它使用 ES5 中引入的新[Object.keys](https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Object/keys)功能以及来自[+](https://stackoverflow.com/a/3849480/1414809)、[+](https://stackoverflow.com/a/6713782/1414809)和[+](https://stackoverflow.com/a/5522917/1414809)的想法/测试：

```
function objectEquals(x, y) {
    'use strict';

    if (x === null || x === undefined || y === null || y === undefined) { return x === y; }
    // after this just checking type of one would be enough
    if (x.constructor !== y.constructor) { return false; }
    // if they are functions, they should exactly refer to same one (because of closures)
    if (x instanceof Function) { return x === y; }
    // if they are regexps, they should exactly refer to same one (it is hard to better equality check on current ES)
    if (x instanceof RegExp) { return x === y; }
    if (x === y || x.valueOf() === y.valueOf()) { return true; }
    if (Array.isArray(x) && x.length !== y.length) { return false; }

    // if they are dates, they must had equal valueOf
    if (x instanceof Date) { return false; }

    // if they are strictly equal, they both need to be object at least
    if (!(x instanceof Object)) { return false; }
    if (!(y instanceof Object)) { return false; }

    // recursive object equality check
    var p = Object.keys(x);
    return Object.keys(y).every(function (i) { return p.indexOf(i) !== -1; }) &&
        p.every(function (i) { return objectEquals(x[i], y[i]); });
}

///////////////////////////////////////////////////////////////
/// The borrowed tests, run them by clicking "Run code snippet"
///////////////////////////////////////////////////////////////
var printResult = function (x) {
    if (x) { document.write('<div style="color: green;">Passed</div>'); }
    else { document.write('<div style="color: red;">Failed</div>'); }
};
var assert = { isTrue: function (x) { printResult(x); }, isFalse: function (x) { printResult(!x); } }
assert.isTrue(objectEquals(null,null));
assert.isFalse(objectEquals(null,undefined));
assert.isFalse(objectEquals(/abc/, /abc/));
assert.isFalse(objectEquals(/abc/, /123/));
var r = /abc/;
assert.isTrue(objectEquals(r, r));

assert.isTrue(objectEquals("hi","hi"));
assert.isTrue(objectEquals(5,5));
assert.isFalse(objectEquals(5,10));

assert.isTrue(objectEquals([],[]));
assert.isTrue(objectEquals([1,2],[1,2]));
assert.isFalse(objectEquals([1,2],[2,1]));
assert.isFalse(objectEquals([1,2],[1,2,3]));

assert.isTrue(objectEquals({},{}));
assert.isTrue(objectEquals({a:1,b:2},{a:1,b:2}));
assert.isTrue(objectEquals({a:1,b:2},{b:2,a:1}));
assert.isFalse(objectEquals({a:1,b:2},{a:1,b:3}));

assert.isTrue(objectEquals({1:{name:"mhc",age:28}, 2:{name:"arb",age:26}},{1:{name:"mhc",age:28}, 2:{name:"arb",age:26}}));
assert.isFalse(objectEquals({1:{name:"mhc",age:28}, 2:{name:"arb",age:26}},{1:{name:"mhc",age:28}, 2:{name:"arb",age:27}}));

Object.prototype.equals = function (obj) { return objectEquals(this, obj); };
var assertFalse = assert.isFalse,
    assertTrue = assert.isTrue;

assertFalse({}.equals(null));
assertFalse({}.equals(undefined));

assertTrue("hi".equals("hi"));
assertTrue(new Number(5).equals(5));
assertFalse(new Number(5).equals(10));
assertFalse(new Number(1).equals("1"));

assertTrue([].equals([]));
assertTrue([1,2].equals([1,2]));
assertFalse([1,2].equals([2,1]));
assertFalse([1,2].equals([1,2,3]));
assertTrue(new Date("2011-03-31").equals(new Date("2011-03-31")));
assertFalse(new Date("2011-03-31").equals(new Date("1970-01-01")));

assertTrue({}.equals({}));
assertTrue({a:1,b:2}.equals({a:1,b:2}));
assertTrue({a:1,b:2}.equals({b:2,a:1}));
assertFalse({a:1,b:2}.equals({a:1,b:3}));

assertTrue({1:{name:"mhc",age:28}, 2:{name:"arb",age:26}}.equals({1:{name:"mhc",age:28}, 2:{name:"arb",age:26}}));
assertFalse({1:{name:"mhc",age:28}, 2:{name:"arb",age:26}}.equals({1:{name:"mhc",age:28}, 2:{name:"arb",age:27}}));

var a = {a: 'text', b:[0,1]};
var b = {a: 'text', b:[0,1]};
var c = {a: 'text', b: 0};
var d = {a: 'text', b: false};
var e = {a: 'text', b:[1,0]};
var i = {
    a: 'text',
    c: {
        b: [1, 0]
    }
};
var j = {
    a: 'text',
    c: {
        b: [1, 0]
    }
};
var k = {a: 'text', b: null};
var l = {a: 'text', b: undefined};

assertTrue(a.equals(b));
assertFalse(a.equals(c));
assertFalse(c.equals(d));
assertFalse(a.equals(e));
assertTrue(i.equals(j));
assertFalse(d.equals(k));
assertFalse(k.equals(l));

// from comments on stackoverflow post
assert.isFalse(objectEquals([1, 2, undefined], [1, 2]));
assert.isFalse(objectEquals([1, 2, 3], { 0: 1, 1: 2, 2: 3 }));
assert.isFalse(objectEquals(new Date(1234), 1234));

// no two different function is equal really, they capture their context variables
// so even if they have same toString(), they won't have same functionality
var func = function (x) { return true; };
var func2 = function (x) { return true; };
assert.isTrue(objectEquals(func, func));
assert.isFalse(objectEquals(func, func2));
assert.isTrue(objectEquals({ a: { b: func } }, { a: { b: func } }));
assert.isFalse(objectEquals({ a: { b: func } }, { a: { b: func2 } }));
```

* * *

## 回答 #6

> 赞同：65
> 
> 时间：2008-10-14T14:11:01.400

如果您使用的是 JSON 库，则可以将每个对象编码为 JSON，然后比较结果字符串是否相等。

```
var obj1={test:"value"};
var obj2={test:"value2"};

alert(JSON.encode(obj1)===JSON.encode(obj2)); 
```

**注意：虽然此答案在许多情况下都有效，但正如一些人在评论中指出的那样，由于各种原因，它存在问题。在几乎所有情况下，您都希望找到更强大的解决方案。**

* * *

## 回答 #7

> 赞同：62
> 
> 时间：2015-10-03T11:36:42.053

简短的功能`deepEqual`实现：

```
function deepEqual(x, y) {
  return (x && y && typeof x === 'object' && typeof y === 'object') ?
    (Object.keys(x).length === Object.keys(y).length) &&
      Object.keys(x).reduce(function(isEqual, key) {
        return isEqual && deepEqual(x[key], y[key]);
      }, true) : (x === y);
} 
```

**编辑**：版本 2，使用 jib 的建议和 ES6 箭头函数：

```
function deepEqual(x, y) {
  const ok = Object.keys, tx = typeof x, ty = typeof y;
  return x && y && tx === 'object' && tx === ty ? (
    ok(x).length === ok(y).length &&
      ok(x).every(key => deepEqual(x[key], y[key]))
  ) : (x === y);
} 
```

* * *

## 回答 #8

> 赞同：28
> 
> 时间：2014-09-24T12:26:05.987

在 Node.js 中，您可以使用其 native `require("assert").deepStrictEqual`. 更多信息： [http ://nodejs.org/api/assert.html](http://nodejs.org/api/assert.html)

例如：

```
var assert = require("assert");
assert.deepStrictEqual({a:1, b:2}, {a:1, b:3}); // will throw AssertionError 
```

`true`返回/`false`而不是返回错误的另一个示例：

```
var assert = require("assert");

function deepEqual(a, b) {
    try {
      assert.deepEqual(a, b);
    } catch (error) {
      if (error.name === "AssertionError") {
        return false;
      }
      throw error;
    }
    return true;
}; 
```

* * *

## 回答 #9

> 赞同：26
> 
> 时间：2019-01-22T17:31:57.440

对于那些使用 Node 的人，有一个调用`isDeepStrictEqual`本机`util`库的便捷方法可以实现这一点。

```
const util = require('util');

const obj1 = {
  foo: "bar",
  baz: [1, 2]
};

const obj2 = {
  foo: "bar",
  baz: [1, 2]
};

obj1 == obj2 // false
util.isDeepStrictEqual(obj1, obj2) // true 
```

[https://nodejs.org/api/util.html#util_util_isdeepstrictequal_val1_val2](https://nodejs.org/api/util.html#util_util_isdeepstrictequal_val1_val2)

* * *

## 回答 #10

> 赞同：25
> 
> 时间：2008-10-14T13:59:48.880

您是否尝试测试两个对象是否相等？即：它们的属性是否相等？

如果是这种情况，您可能已经注意到这种情况：

```
var a = { foo : "bar" };
var b = { foo : "bar" };
alert (a == b ? "Equal" : "Not equal");
// "Not equal" 
```

你可能必须做这样的事情：

```
function objectEquals(obj1, obj2) {
    for (var i in obj1) {
        if (obj1.hasOwnProperty(i)) {
            if (!obj2.hasOwnProperty(i)) return false;
            if (obj1[i] != obj2[i]) return false;
        }
    }
    for (var i in obj2) {
        if (obj2.hasOwnProperty(i)) {
            if (!obj1.hasOwnProperty(i)) return false;
            if (obj1[i] != obj2[i]) return false;
        }
    }
    return true;
} 
```

显然，该功能可以进行相当多的优化，并且能够进行深度检查（处理嵌套对象：），`var a = { foo : { fu : "bar" } }`但您明白了。

正如 FOR 指出的那样，您可能必须根据自己的目的对其进行调整，例如：不同的类可能对“相等”有不同的定义。如果您只是使用普通对象，以上可能就足够了，否则自定义`MyClass.equals()`函数可能是要走的路。

* * *

## 回答 #11

> 赞同：24
> 
> 时间：2012-06-14T19:20:48.377

如果你有一个方便的深拷贝功能，你可以使用以下技巧在匹配属性顺序时*仍然*使用：`JSON.stringify`

```
function equals(obj1, obj2) {
    function _equals(obj1, obj2) {
        return JSON.stringify(obj1)
            === JSON.stringify($.extend(true, {}, obj1, obj2));
    }
    return _equals(obj1, obj2) && _equals(obj2, obj1);
} 
```

演示：http: [//jsfiddle.net/CU3vb/3/](http://jsfiddle.net/CU3vb/3/)

理由：

由于 的属性`obj1`被一一复制到克隆中，因此它们在克隆中的顺序将被保留。并且当 的属性`obj2`被复制到克隆时，由于已经存在的属性`obj1`将被简单地覆盖，因此它们在克隆中的顺序将被保留。

* * *

## 回答 #12

> 赞同：23
> 
> 时间：2017-10-09T11:35:53.247

**比较**对象、数组、字符串、整数等所有内容的****最简单**和**合乎逻辑的解决方案...****

 ****`JSON.stringify({a: val1}) === JSON.stringify({a: val2})`

笔记：

*   你需要用你的对象替换`val1`和`val2`
*   对于对象，您必须对两个侧面对象进行递归排序（按键）

* * *

## 回答 #13

> 赞同：16
> 
> 时间：2020-04-10T14:47:03.780

```
var object1 = {name: "humza" , gender : "male", age: 23}
var object2 = {name: "humza" , gender : "male", age: 23}
var result = Object.keys(object1).every((key) =>  object1[key] === object2[key]) 
```

如果 object1 在 object2 上具有相同的值，则结果将为**真。**

* * *

## 回答 #14

> 赞同：15
> 
> 时间：2016-03-06T01:04:07.763

我使用这个`comparable`函数来生成我的对象的副本，这些副本是 JSON 可比的：

```
var comparable = o => (typeof o != 'object' || !o)? o :
  Object.keys(o).sort().reduce((c, key) => (c[key] = comparable(o[key]), c), {});

// Demo:

var a = { a: 1, c: 4, b: [2, 3], d: { e: '5', f: null } };
var b = { b: [2, 3], c: 4, d: { f: null, e: '5' }, a: 1 };

console.log(JSON.stringify(comparable(a)));
console.log(JSON.stringify(comparable(b)));
console.log(JSON.stringify(comparable(a)) == JSON.stringify(comparable(b)));
```

```
<div id="div"></div>
```

在测试中派上用场（大多数测试框架都有一个`is`功能）。例如

```
is(JSON.stringify(comparable(x)), JSON.stringify(comparable(y)), 'x must match y'); 
```

如果发现差异，则会记录字符串，从而可以发现差异：

```
x must match y
got      {"a":1,"b":{"0":2,"1":3},"c":7,"d":{"e":"5","f":null}},
expected {"a":1,"b":{"0":2,"1":3},"c":4,"d":{"e":"5","f":null}}. 
```

* * *

## 回答 #15

> 赞同：15
> 
> 时间：2020-08-19T22:59:11.807

这个问题已经有30多个答案了。我将总结和解释它们（用“我的父亲”类比）并添加我建议的解决方案。

您有**4+1 类解决方案**：

* * *

# 1) 使用 hacky 不完整的快速单线

**如果您赶时间并且 99% 的正确性有效，那就太好了。**

这方面的例子是[Pratik Bhalodiya](https://stackoverflow.com/a/46645497/2321594)`JSON.stringify()`或Joel [Anair](https://stackoverflow.com/a/201305/2321594)或其他方法将您的对象转换为字符串，然后使用逐个字符比较两个字符串的方法。`JSON.encode` `.toString()``===`

然而，缺点是字符串中的对象没有全局标准的唯一表示。例如`{ a: 5, b: 8}`和`{b: 8 and a: 5 }`相等。

*   **优点：**快，快。
*   **缺点：** *希望*有效！ **如果环境/浏览器/引擎记住对象的顺序（例如 Chrome/V8）并且键的顺序不同**（感谢[Eksapsy](https://stackoverflow.com/users/1712332/eksapsy)），它将无法工作。因此，根本不能保证。在大型物体中性能也不会很好。

### 我的父亲比喻

说起我的爸爸，“**我高大帅哥**”和“**我高大帅哥爸爸**”是同一个人！但是这两个字符串不一样。

请注意，英语语法中实际上有一个**正确（标准方式）的形容词顺序，它**[说它](https://preply.com/en/blog/2014/02/18/the-correct-order-of-adjectives-in-english-rules-and-examples/#scroll-to-heading-1)应该是一个“英俊的高个子”，但如果你盲目地假设 iOS 8 Safari 的 Javascript 引擎也遵守同样的语法，盲目！#WelcomeToJavascriptNonStandards

* * *

# 2）编写自己的DIY递归函数

**很好，如果你正在学习。**

示例是[atmin 的解决方案](https://stackoverflow.com/a/32922084/2321594)。

最大的缺点是你肯定会错过一些边缘情况。您是否考虑过对象值中的[自引用？](https://stackoverflow.com/a/2787309/2321594)你考虑过`NaN`吗？您是否考虑过两个具有相同`ownProperties`但不同原型父对象的对象？

我只会鼓励人们在练习并且代码不会投入生产时这样做。这是*重新发明轮子*的唯一理由。

*   **优点：**学习机会。
*   **缺点：**不可靠。需要时间和担忧。

### 我的父亲比喻

这就像假设如果我父亲的名字是“John Smith”并且他的生日是“1/1/1970”，那么任何名为“John Smith”并且出生于“1970 年 1 月 1 日”的人都是我的父亲。

通常是这样，但如果那天有两个“约翰·史密斯”出生怎么办？如果您认为您会考虑他们的身高，那么这会提高准确性，但仍然不是一个完美的比较。

## 2.1 你有限的范围 DIY 比较器

与其疯狂地递归检查所有属性，不如考虑只检查“有限”数量的属性。例如，如果对象是`User`s，您可以比较它们的`emailAddress`字段。

它仍然不是一个完美的解决方案，但解决方案 #2 的好处是：

1.  它是可预测的，而且它不太可能崩溃。
2.  您正在推动平等的“定义”，而不是依赖于对象的狂野形式和形状及其原型和嵌套属性。

* * *

# 3）使用`equal`函数的库版本

**如果您需要生产级别的质量，并且您无法更改系统的设计，那就太好了。**

示例是`_.equal` [lodash](https://lodash.com/docs/4.17.15#isEqual)，已经在[coolaj86 的答案或](https://stackoverflow.com/a/3198202/2321594)[托尼·哈维（Tony Harvey）的答案或](https://stackoverflow.com/a/19055489/2321594)[拉斐尔·泽维尔（Rafael Xavier](https://stackoverflow.com/a/26016880/2321594) ）的节点中提到的Angular 或Ember 中。

*   **优点：**这是其他人所做的。
*   **缺点：**外部依赖性，这可能会花费您额外的内存/CPU/安全问题，甚至一点点。此外，仍然可能会遗漏一些边缘情况（例如，具有相同`ownProperties`但不同原型父对象的两个对象是否应被视为相同。）最后，**您*可能*会无意中解决一个潜在的设计问题；只是说！**

### 我的父亲比喻

这就像付钱找我的亲生父亲，根据他的电话、姓名、地址等。

它会花费更多，而且可能比我自己进行背景调查更准确，但不包括像我父亲是移民/庇护并且他的生日未知的极端情况！

* * *

# 4) 在对象中使用标识符

**如果您 [仍然] 可以更改系统的设计（您正在处理的对象）并且您希望您的代码能够持续很长时间，那就太好了。**

它并非在所有情况下都适用，并且性能可能不是很好。但是，如果你能做到的话，这是一个非常可靠的解决方案。

解决方案是，`object`系统中的每个都将具有**唯一**标识符以及所有其他属性。标识符的*唯一性*将在生成时得到保证。在比较两个对象时，您将使用此 ID（也称为 UUID/GUID --[全局/通用唯一标识符）。](https://en.wikipedia.org/wiki/Universally_unique_identifier)即当且仅当这些ID 相等时它们才相等。

ID 可以是简单的数字，也可以是通过[库](https://www.npmjs.com/package/uuid)（建议）或[一段代码](https://stackoverflow.com/questions/105034/how-to-create-guid-uuid)`auto_incremental`生成的字符串。您需要做的就是确保它始终是唯一的，如果它可以是内置的，或者在 UUID 的情况下，可以检查所有现有值（例如 MySQL 的列属性）或简单地检查（如果来自库) 依赖于给出极低的碰撞可能性。`auto_incremental``UNIQUE`

请注意，您还需要始终将 ID 与对象一起存储（以保证其唯一性），并且实时计算它可能不是最好的方法。

*   **优点：**可靠、高效、不脏、现代。
*   **缺点：**需要额外的空间。可能需要重新设计系统。

### 我的父亲比喻

就像知道我父亲的社会安全号码是 911-345-9283，所以任何拥有这个 SSN 的人都是我的父亲，任何声称是我父亲的人都必须有这个 SSN。

* * *

# 结论

为了准确性和可靠性，我个人更喜欢解决方案＃4（ID）。如果不可能的话，我会选择#2.1 以实现可预测性，然后选择#3。如果两者都不可能，则#2，最后是#1。

* * *

## 回答 #16

> 赞同：12
> 
> 时间：2015-08-25T05:14:37.110

这是 ES6/ES2015 中使用函数式方法的解决方案：

```
const typeOf = x => 
  ({}).toString
      .call(x)
      .match(/\[object (\w+)\]/)[1]

function areSimilar(a, b) {
  const everyKey = f => Object.keys(a).every(f)

  switch(typeOf(a)) {
    case 'Array':
      return a.length === b.length &&
        everyKey(k => areSimilar(a.sort()[k], b.sort()[k]));
    case 'Object':
      return Object.keys(a).length === Object.keys(b).length &&
        everyKey(k => areSimilar(a[k], b[k]));
    default:
      return a === b;
  }
} 
```

[演示可在此处获得](http://jsbin.com/yowasucube/edit?js,console)

* * *

## 回答 #17

> 赞同：11
> 
> 时间：2017-03-05T17:13:25.840

我不知道是否有人发布了与此类似的内容，但这是我为检查对象相等性所做的一个函数。

```
function objectsAreEqual(a, b) {
  for (var prop in a) {
    if (a.hasOwnProperty(prop)) {
      if (b.hasOwnProperty(prop)) {
        if (typeof a[prop] === 'object') {
          if (!objectsAreEqual(a[prop], b[prop])) return false;
        } else {
          if (a[prop] !== b[prop]) return false;
        }
      } else {
        return false;
      }
    }
  }
  return true;
} 
```

此外，它是递归的，因此它还可以检查深度相等，如果这就是你所说的。

* * *

## 回答 #18

> 赞同：8
> 
> 时间：2019-09-24T16:47:44.533

**ES6：**我能完成的最少代码是这样的。它通过对表示对象的所有键值数组进行字符串化来递归地进行深度比较，唯一的限制是不比较方法或符号。

```
const compareObjects = (a, b) => { 
  let s = (o) => Object.entries(o).sort().map(i => { 
     if(i[1] instanceof Object) i[1] = s(i[1]);
     return i 
  }) 
  return JSON.stringify(s(a)) === JSON.stringify(s(b))
}

console.log(compareObjects({b:4,a:{b:1}}, {a:{b:1},b:4}));
```

**重要提示：此函数在****ARRAY**中执行 JSON.stringfy，其中键已排序，而**不是**在其自身的对象中：

1.  ["a", ["b", 1]]
2.  [“b”，4]

* * *

## 回答 #19

> 赞同：5
> 
> 时间：2015-02-10T18:39:37.873

许多人没有意识到这个问题的一个简单解决方案是对 JSON 字符串（每个字符）进行排序。这通常也比这里提到的其他解决方案更快：

```
function areEqual(obj1, obj2) {
    var a = JSON.stringify(obj1), b = JSON.stringify(obj2);
    if (!a) a = '';
    if (!b) b = '';
    return (a.split('').sort().join('') == b.split('').sort().join(''));
} 
```

此方法的另一个有用之处是您可以通过将“替换器”函数传递给 JSON.stringify 函数来过滤比较（[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON /stringify#Example_of_using_replacer_parameter](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#Example_of_using_replacer_parameter)）。以下将仅比较名为“derp”的所有对象键：

```
function areEqual(obj1, obj2, filter) {
    var a = JSON.stringify(obj1, filter), b = JSON.stringify(obj2, filter);
    if (!a) a = '';
    if (!b) b = '';
    return (a.split('').sort().join('') == b.split('').sort().join(''));
}
var equal = areEqual(obj1, obj2, function(key, value) {
    return (key === 'derp') ? value : undefined;
}); 
```

* * *

## 回答 #20

> 赞同：5
> 
> 时间：2016-11-15T16:02:49.753

只是想利用一些 es6 功能贡献我的对象比较版本。它不考虑订单。在将所有 if/else 转换为三元后，我得到了以下内容：

```
function areEqual(obj1, obj2) {

    return Object.keys(obj1).every(key => {

            return obj2.hasOwnProperty(key) ?
                typeof obj1[key] === 'object' ?
                    areEqual(obj1[key], obj2[key]) :
                obj1[key] === obj2[key] :
                false;

        }
    )
} 
```

* * *

## 回答 #21

> 赞同：5
> 
> 时间：2018-03-20T18:28:18.163

您可以`_.isEqual(obj1, obj2)`从 underscore.js 库中使用。

这是一个例子：

```
var stooge = {name: 'moe', luckyNumbers: [13, 27, 34]};
var clone  = {name: 'moe', luckyNumbers: [13, 27, 34]};
stooge == clone;
=> false
_.isEqual(stooge, clone);
=> true 
```

从这里查看官方文档：http: [//underscorejs.org/#isEqual](http://underscorejs.org/#isEqual)

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2018-05-17T07:32:52.230

**假设对象中属性的顺序没有改变。**

[JSON.stringify()](https://www.w3schools.com/js/js_json_stringify.asp)适用于深度和非深度两种类型的对象，不太确定性能方面：

```
var object1 = {
  key: "value"
};

var object2 = {
  key: "value"
};

var object3 = {
  key: "no value"
};

console.log('object1 and object2 are equal: ', JSON.stringify(object1) === JSON.stringify(object2));

console.log('object2 and object3 are equal: ', JSON.stringify(object2) === JSON.stringify(object3));
```

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2010-05-27T12:00:59.313

需要比已发布的更通用的对象比较功能，我制作了以下内容。批评赞赏...

```
Object.prototype.equals = function(iObj) {
  if (this.constructor !== iObj.constructor)
    return false;
  var aMemberCount = 0;
  for (var a in this) {
    if (!this.hasOwnProperty(a))
      continue;
    if (typeof this[a] === 'object' && typeof iObj[a] === 'object' ? !this[a].equals(iObj[a]) : this[a] !== iObj[a])
      return false;
    ++aMemberCount;
  }
  for (var a in iObj)
    if (iObj.hasOwnProperty(a))
      --aMemberCount;
  return aMemberCount ? false : true;
} 
```

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2014-03-11T17:44:49.887

如果您要比较 JSON 对象，您可以使用[https://github.com/mirek/node-rus-diff](https://github.com/mirek/node-rus-diff)

```
npm install rus-diff 
```

用法：

```
a = {foo:{bar:1}}
b = {foo:{bar:1}}
c = {foo:{bar:2}}

var rusDiff = require('rus-diff').rusDiff

console.log(rusDiff(a, b)) // -> false, meaning a and b are equal
console.log(rusDiff(a, c)) // -> { '$set': { 'foo.bar': 2 } } 
```

如果两个对象不同，`{$rename:{...}, $unset:{...}, $set:{...}}`则返回一个与 MongoDB 兼容的类似对象。

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2016-09-13T17:21:36.540

我遇到了同样的问题，并决定编写自己的解决方案。但是因为我还想将数组与对象进行比较，反之亦然，所以我设计了一个通用的解决方案。我决定将这些函数添加到原型中，但可以轻松地将它们重写为独立函数。这是代码：

```
Array.prototype.equals = Object.prototype.equals = function(b) {
    var ar = JSON.parse(JSON.stringify(b));
    var err = false;
    for(var key in this) {
        if(this.hasOwnProperty(key)) {
            var found = ar.find(this[key]);
            if(found > -1) {
                if(Object.prototype.toString.call(ar) === "[object Object]") {
                    delete ar[Object.keys(ar)[found]];
                }
                else {
                    ar.splice(found, 1);
                }
            }
            else {
                err = true;
                break;
            }
        }
    };
    if(Object.keys(ar).length > 0 || err) {
        return false;
    }
    return true;
}

Array.prototype.find = Object.prototype.find = function(v) {
    var f = -1;
    for(var i in this) {
        if(this.hasOwnProperty(i)) {
            if(Object.prototype.toString.call(this[i]) === "[object Array]" || Object.prototype.toString.call(this[i]) === "[object Object]") {
                if(this[i].equals(v)) {
                    f = (typeof(i) == "number") ? i : Object.keys(this).indexOf(i);
                }
            }
            else if(this[i] === v) {
                f = (typeof(i) == "number") ? i : Object.keys(this).indexOf(i);
            }
        }
    }
    return f;
} 
```

该算法分为两部分；equals 函数本身和一个在数组/对象中查找属性的数字索引的函数。仅需要 find 函数，因为 indexof 仅查找数字和字符串而没有对象。

可以这样称呼它：

```
({a: 1, b: "h"}).equals({a: 1, b: "h"}); 
```

该函数返回真或假，在本例中为真。该算法还允许在非常复杂的对象之间进行比较：

```
({a: 1, b: "hello", c: ["w", "o", "r", "l", "d", {answer1: "should be", answer2: true}]}).equals({b: "hello", a: 1, c: ["w", "d", "o", "r", {answer1: "should be", answer2: true}, "l"]}) 
```

上面的示例将返回 true，即使属性具有不同的顺序。需要注意的一个小细节：此代码还检查相同类型的两个变量，因此“3”与 3 不同。

* * *

## 回答 #26

> 赞同：3
> 
> 时间：2021-04-16T18:49:44.063

下面是一个简短的实现，它使用`JSON.stringify`但按照@Jor[在此处](https://stackoverflow.com/a/53593328/2604492)建议的方式对键进行排序。

一些测试来自@EbrahimByagowi [here](https://stackoverflow.com/a/16788517/2604492)的回答。

当然，通过使用`JSON.stringify`，解决方案仅限于 JSON 可序列化类型（字符串、数字、JSON 对象、数组、布尔值、null）。不支持 , 等`Date`对象。`Function`

```
function objectEquals(obj1, obj2) {
  const JSONstringifyOrder = obj => {
    const keys = {};
    JSON.stringify(obj, (key, value) => {
      keys[key] = null;
      return value;
    });
    return JSON.stringify(obj, Object.keys(keys).sort());
  };
  return JSONstringifyOrder(obj1) === JSONstringifyOrder(obj2);
}

///////////////////////////////////////////////////////////////
/// The borrowed tests, run them by clicking "Run code snippet"
///////////////////////////////////////////////////////////////
var printResult = function (x) {
    if (x) { document.write('<div style="color: green;">Passed</div>'); }
    else { document.write('<div style="color: red;">Failed</div>'); }
};
var assert = { isTrue: function (x) { printResult(x); }, isFalse: function (x) { printResult(!x); } }

assert.isTrue(objectEquals("hi","hi"));
assert.isTrue(objectEquals(5,5));
assert.isFalse(objectEquals(5,10));

assert.isTrue(objectEquals([],[]));
assert.isTrue(objectEquals([1,2],[1,2]));
assert.isFalse(objectEquals([1,2],[2,1]));
assert.isFalse(objectEquals([1,2],[1,2,3]));

assert.isTrue(objectEquals({},{}));
assert.isTrue(objectEquals({a:1,b:2},{a:1,b:2}));
assert.isTrue(objectEquals({a:1,b:2},{b:2,a:1}));
assert.isFalse(objectEquals({a:1,b:2},{a:1,b:3}));

assert.isTrue(objectEquals({1:{name:"mhc",age:28}, 2:{name:"arb",age:26}},{1:{name:"mhc",age:28}, 2:{name:"arb",age:26}}));
assert.isFalse(objectEquals({1:{name:"mhc",age:28}, 2:{name:"arb",age:26}},{1:{name:"mhc",age:28}, 2:{name:"arb",age:27}}));
```

* * *

## 回答 #27

> 赞同：3
> 
> 时间：2021-09-22T14:19:02.033

```
let std1 = {
  name: "Abhijeet",
  roll: 1
}

let std2 = {
  name: "Siddharth",
  roll: 2
}

console.log(JSON.stringify(std1) === JSON.stringify(std2)) 
```

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2008-11-19T16:20:00.590

我建议不要散列或序列化（正如 JSON 解决方案所建议的那样）。如果您需要测试两个对象是否相等，那么您需要定义相等的含义。可能是两个对象中的所有数据成员都匹配，也可能是内存位置必须匹配（意味着两个变量引用内存中的同一个对象），或者可能是每个对象中只有一个数据成员必须匹配。

最近我开发了一个对象，它的构造函数在每次创建实例时都会创建一个新的 id（从 1 开始并递增 1）。该对象有一个 isEqual 函数，该函数将该 id 值与另一个对象的 id 值进行比较，如果它们匹配则返回 true。

在那种情况下，我将“相等”定义为表示 i​​d 值匹配。鉴于每个实例都有一个唯一的 id，这可以用来强化匹配对象也占用相同内存位置的想法。虽然这不是必需的。

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2010-08-28T19:52:42.323

如果两个对象的所有属性和递归所有嵌套对象和数组的值都相同，则认为它们相等是很有用的。我还认为以下两个对象相等：

```
var a = {p1: 1};
var b = {p1: 1, p2: undefined}; 
```

同样，数组可能有“缺失”元素和未定义元素。我也会同样对待它们：

```
var c = [1, 2];
var d = [1, 2, undefined]; 
```

实现此相等定义的函数：

```
function isEqual(a, b) {
    if (a === b) {
        return true;
    }

    if (generalType(a) != generalType(b)) {
        return false;
    }

    if (a == b) {
        return true;
    }

    if (typeof a != 'object') {
        return false;
    }

    // null != {}
    if (a instanceof Object != b instanceof Object) {
        return false;
    }

    if (a instanceof Date || b instanceof Date) {
        if (a instanceof Date != b instanceof Date ||
            a.getTime() != b.getTime()) {
            return false;
        }
    }

    var allKeys = [].concat(keys(a), keys(b));
    uniqueArray(allKeys);

    for (var i = 0; i < allKeys.length; i++) {
        var prop = allKeys[i];
        if (!isEqual(a[prop], b[prop])) {
            return false;
        }
    }
    return true;
} 
```

[源代码](http://code.google.com/p/pageforest/source/browse/appengine/static/src/js/base.js)（包括辅助函数、generalType 和 uniqueArray）： [Unit Test](http://code.google.com/p/pageforest/source/browse/appengine/static/src/js/tests/test-base.js)和[Test Runner here](http://pageforest.googlecode.com/hg/appengine/static/src/js/tests/test-runner.html#base)。

* * *

## 回答 #30

> 赞同：2
> 
> 时间：2013-09-27T01:07:00.463

我对这个函数做了以下假设：

1.  您控制您正在比较的对象，并且您只有原始值（即没有嵌套对象、函数等）。
2.  您的浏览器支持[Object.keys](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/keys)。

这应该被视为一个简单策略的演示。

```
/**
 * Checks the equality of two objects that contain primitive values. (ie. no nested objects, functions, etc.)
 * @param {Object} object1
 * @param {Object} object2
 * @param {Boolean} [order_matters] Affects the return value of unordered objects. (ex. {a:1, b:2} and {b:2, a:1}).
 * @returns {Boolean}
 */
function isEqual( object1, object2, order_matters ) {
    var keys1 = Object.keys(object1),
        keys2 = Object.keys(object2),
        i, key;

    // Test 1: Same number of elements
    if( keys1.length != keys2.length ) {
        return false;
    }

    // If order doesn't matter isEqual({a:2, b:1}, {b:1, a:2}) should return true.
    // keys1 = Object.keys({a:2, b:1}) = ["a","b"];
    // keys2 = Object.keys({b:1, a:2}) = ["b","a"];
    // This is why we are sorting keys1 and keys2.
    if( !order_matters ) {
        keys1.sort();
        keys2.sort();
    }

    // Test 2: Same keys
    for( i = 0; i < keys1.length; i++ ) {
        if( keys1[i] != keys2[i] ) {
            return false;
        }
    }

    // Test 3: Values
    for( i = 0; i < keys1.length; i++ ) {
        key = keys1[i];
        if( object1[key] != object2[key] ) {
            return false;
        }
    }

    return true;
} 
```

* * *

## 回答 #31

> 赞同：2
> 
> 时间：2013-11-29T11:34:44.827

为了比较简单键/值对对象实例的键，我使用：

```
function compareKeys(r1, r2) {
    var nloops = 0, score = 0;
    for(k1 in r1) {
        for(k2 in r2) {
            nloops++;
            if(k1 == k2)
                score++; 
        }
    }
    return nloops == (score * score);
}; 
```

比较密钥后，一个简单的附加`for..in`循环就足够了。

复杂度为 O(N*N)，其中 N 是键的数量。

我希望/猜测我​​定义的对象不会包含超过 1000 个属性...

* * *

## 回答 #32

> 赞同：2
> 
> 时间：2013-12-21T01:09:08.197

这是对以上所有内容的补充，而不是替代。如果您需要快速浅比较对象而不需要检查额外的递归情况。这是一个镜头。

这比较：1) 自身属性数量相等，2) 键名相等，3) 如果 bCompareValues == true，对应属性值及其类型相等（三重相等）

```
var shallowCompareObjects = function(o1, o2, bCompareValues) {
    var s, 
        n1 = 0,
        n2 = 0,
        b  = true;

    for (s in o1) { n1 ++; }
    for (s in o2) { 
        if (!o1.hasOwnProperty(s)) {
            b = false;
            break;
        }
        if (bCompareValues && o1[s] !== o2[s]) {
            b = false;
            break;
        }
        n2 ++;
    }
    return b && n1 == n2;
} 
```

* * *

## 回答 #33

> 赞同：2
> 
> 时间：2015-02-11T20:37:46.807

我知道这有点老了，但我想添加一个我为这个问题提出的解决方案。我有一个对象，我想知道它的数据何时发生变化。“类似于 Object.observe 的东西”，我所做的是：

```
function checkObjects(obj,obj2){
   var values = [];
   var keys = [];
   keys = Object.keys(obj);
   keys.forEach(function(key){
      values.push(key);
   });
   var values2 = [];
   var keys2 = [];
   keys2 = Object.keys(obj2);
   keys2.forEach(function(key){
      values2.push(key);
   });
   return (values == values2 && keys == keys2)
} 
```

这里可以复制并创建另一组数组来比较值和键。这非常简单，因为它们现在是数组，如果对象的大小不同，它们将返回 false。

* * *

## 回答 #34

> 赞同：2
> 
> 时间：2015-04-17T15:14:56.043

从我的个人图书馆中取出，我反复用于我的工作。下面的函数是一个宽松的递归深度相等，它**不检查**

*   阶级平等
*   继承的值
*   重视严格平等

我主要用它来检查我是否得到对各种 API 实现的相同回复。可能出现实现差异（如字符串与数字）和其他空值的地方。

它的实现非常简单和简短（如果所有评论都被剥离）

```
/** Recursively check if both objects are equal in value
***
*** This function is designed to use multiple methods from most probable 
*** (and in most cases) valid, to the more regid and complex method.
***
*** One of the main principles behind the various check is that while
*** some of the simpler checks such as == or JSON may cause false negatives,
*** they do not cause false positives. As such they can be safely run first.
***
*** # !Important Note:
*** as this function is designed for simplified deep equal checks it is not designed
*** for the following
***
*** - Class equality, (ClassA().a = 1) maybe valid to (ClassB().b = 1)
*** - Inherited values, this actually ignores them
*** - Values being strictly equal, "1" is equal to 1 (see the basic equality check on this)
*** - Performance across all cases. This is designed for high performance on the
***   most probable cases of == / JSON equality. Consider bench testing, if you have
***   more 'complex' requirments
***
*** @param  objA : First object to compare
*** @param  objB : 2nd object to compare
*** @param  .... : Any other objects to compare
***
*** @returns true if all equals, or false if invalid
***
*** @license Copyright by eugene@picoded.com, 2012.
***          Licensed under the MIT license: http://opensource.org/licenses/MIT
**/
function simpleRecusiveDeepEqual(objA, objB) {
	// Multiple comparision check
	//--------------------------------------------
	var args = Array.prototype.slice.call(arguments);
	if(args.length > 2) {
		for(var a=1; a<args.length; ++a) {
			if(!simpleRecusiveDeepEqual(args[a-1], args[a])) {
				return false;
			}
		}
		return true;
	} else if(args.length < 2) {
		throw "simpleRecusiveDeepEqual, requires atleast 2 arguments";
	}

	// basic equality check,
	//--------------------------------------------
	// if this succed the 2 basic values is equal,
	// such as numbers and string.
	//
	// or its actually the same object pointer. Bam
	//
	// Note that if string and number strictly equal is required
	// change the equality from ==, to ===
	//
	if(objA == objB) {
		return true;
	}

	// If a value is a bsic type, and failed above. This fails
	var basicTypes = ["boolean", "number", "string"];
	if( basicTypes.indexOf(typeof objA) >= 0 || basicTypes.indexOf(typeof objB) >= 0 ) {
		return false;
	}

	// JSON equality check,
	//--------------------------------------------
	// this can fail, if the JSON stringify the objects in the wrong order
	// for example the following may fail, due to different string order:
	//
	// JSON.stringify( {a:1, b:2} ) == JSON.stringify( {b:2, a:1} )
	//
	if(JSON.stringify(objA) == JSON.stringify(objB)) {
		return true;
	}

	// Array equality check
	//--------------------------------------------
	// This is performed prior to iteration check,
	// Without this check the following would have been considered valid
	//
	// simpleRecusiveDeepEqual( { 0:1963 }, [1963] );
	//
	// Note that u may remove this segment if this is what is intended
	//
	if( Array.isArray(objA) ) {
		//objA is array, objB is not an array
		if( !Array.isArray(objB) ) {
			return false;
		}
	} else if( Array.isArray(objB) ) {
		//objA is not array, objB is an array
		return false;
	}

	// Nested values iteration
	//--------------------------------------------
	// Scan and iterate all the nested values, and check for non equal values recusively
	//
	// Note that this does not check against null equality, remove the various "!= null"
	// if this is required

	var i; //reuse var to iterate

	// Check objA values against objB
	for (i in objA) {
		//Protect against inherited properties
		if(objA.hasOwnProperty(i)) {
			if(objB.hasOwnProperty(i)) {
				// Check if deep equal is valid
				if(!simpleRecusiveDeepEqual( objA[i], objB[i] )) {
					return false;
				}
			} else if(objA[i] != null) {
				//ignore null values in objA, that objB does not have
				//else fails
				return false;
			}
		}
	}

	// Check if objB has additional values, that objA do not, fail if so
	for (i in objB) {
		if(objB.hasOwnProperty(i)) {
			if(objB[i] != null && !objA.hasOwnProperty(i)) {
				//ignore null values in objB, that objA does not have
				//else fails
				return false;
			}
		}
	}

	// End of all checks
	//--------------------------------------------
	// By reaching here, all iteration scans have been done.
	// and should have returned false if it failed
	return true;
}

// Sanity checking of simpleRecusiveDeepEqual
(function() {
	if(
		// Basic checks
		!simpleRecusiveDeepEqual({}, {}) ||
		!simpleRecusiveDeepEqual([], []) ||
		!simpleRecusiveDeepEqual(['a'], ['a']) ||
		// Not strict checks
		!simpleRecusiveDeepEqual("1", 1) ||
		// Multiple objects check
		!simpleRecusiveDeepEqual( { a:[1,2] }, { a:[1,2] }, { a:[1,2] } ) ||
		// Ensure distinction between array and object (the following should fail)
		simpleRecusiveDeepEqual( [1963], { 0:1963 } ) ||
		// Null strict checks
		simpleRecusiveDeepEqual( 0, null ) ||
		simpleRecusiveDeepEqual( "", null ) ||
		// Last "false" exists to make the various check above easy to comment in/out
		false
	) {
		alert("FATAL ERROR: simpleRecusiveDeepEqual failed basic checks");
	} else { 
		//added this last line, for SO snippet alert on success
		alert("simpleRecusiveDeepEqual: Passed all checks, Yays!");
	}
})();
```

* * *

## 回答 #35

> 赞同：2
> 
> 时间：2018-10-02T18:04:07.570

我看到意大利面条代码答案。不使用任何第三方库，这很容易。

首先通过键名对两个对象进行排序。

```
let objectOne = { hey, you }
let objectTwo = { you, hey }

// If you really wanted you could make this recursive for deep sort.
const sortObjectByKeyname = (objectToSort) => {
    return Object.keys(objectToSort).sort().reduce((r, k) => (r[k] = objectToSort[k], r), {});
}

let objectOne = sortObjectByKeyname(objectOne)
let objectTwo = sortObjectByKeyname(objectTwo) 
```

然后只需使用一个字符串来比较它们。

```
JSON.stringify(objectOne) === JSON.stringify(objectTwo) 
```

* * *

## 回答 #36

> 赞同：2
> 
> 时间：2020-04-23T14:34:18.117

如何确定部分对象（Partial<T>）等于打字稿中的原始对象（T）。

```
function compareTwoObjects<T>(original: T, partial: Partial<T>): boolean {
  return !Object.keys(partial).some((key) => partial[key] !== original[key]);
} 
```

PS最初我打算创建一个带有答案的新问题。但是这样的问题已经存在并被标记为重复。

* * *

## 回答 #37

> 赞同：2
> 
> 时间：2021-03-19T11:06:56.427

这是使用 ES6+ 的解决方案

```
// this comparison would not work for function and symbol comparisons
// this would only work best for compared objects that do not belong to same address in memory
// Returns true if there is no difference, and false otherwise

export const isObjSame = (obj1, obj2) => {
    if (typeof obj1 !== "object" && obj1 !== obj2) {
        return false;
    }

    if (typeof obj1 !== "object" && typeof obj2 !== "object" && obj1 === obj2) {
        return true;
    }

    if (typeof obj1 === "object" && typeof obj2 === "object") {
        if (Array.isArray(obj1) && Array.isArray(obj2)) {
            if (obj1.length === obj2.length) {
                if (obj1.length === 0) {
                    return true;
                }
                const firstElemType = typeof obj1[0];

                if (typeof firstElemType !== "object") {
                    const confirmSameType = currentType =>
                        typeof currentType === firstElemType;

                    const checkObjOne = obj1.every(confirmSameType);
                    const checkObjTwo = obj2.every(confirmSameType);

                    if (checkObjOne && checkObjTwo) {
                        // they are primitves, we can therefore sort before and compare by index
                        // use number sort
                        // use alphabet sort
                        // use regular sort
                        if (firstElemType === "string") {
                            obj1.sort((a, b) => a.localeCompare(b));
                            obj2.sort((a, b) => a.localeCompare(b));
                        }
                        obj1.sort((a, b) => a - b);
                        obj2.sort((a, b) => a - b);

                        let equal = true;

                        obj1.map((element, index) => {
                            if (!isObjSame(element, obj2[index])) {
                                equal = false;
                            }
                        });

                        return equal;
                    }

                    if (
                        (checkObjOne && !checkObjTwo) ||
                        (!checkObjOne && checkObjTwo)
                    ) {
                        return false;
                    }

                    if (!checkObjOne && !checkObjTwo) {
                        for (let i = 0; i <= obj1.length; i++) {
                            const compareIt = isObjSame(obj1[i], obj2[i]);
                            if (!compareIt) {
                                return false;
                            }
                        }

                        return true;
                    }

                    // if()
                }
                const newValue = isObjSame(obj1, obj2);
                return newValue;
            } else {
                return false;
            }
        }

        if (!Array.isArray(obj1) && !Array.isArray(obj2)) {
            let equal = true;
            if (obj1 && obj2) {
                const allKeys1 = Array.from(Object.keys(obj1));
                const allKeys2 = Array.from(Object.keys(obj2));

                if (allKeys1.length === allKeys2.length) {
                    allKeys1.sort((a, b) => a - b);
                    allKeys2.sort((a, b) => a - b);

                    allKeys1.map((key, index) => {
                        if (
                            key.toLowerCase() !== allKeys2[index].toLowerCase()
                        ) {
                            equal = false;
                            return;
                        }

                        const confirmEquality = isObjSame(obj1[key], obj2[key]);

                        if (!confirmEquality) {
                            equal = confirmEquality;
                            return;
                        }
                    });
                }
            }

            return equal;

            // return false;
        }
    }
}; 
```

* * *

## 回答 #38

> 赞同：1
> 
> 时间：2015-07-24T19:54:48.870

我不是 Javascript 专家，但这里有一个简单的尝试来解决它。我检查三件事：

1.  是不是`object`，而且不是`null`因为`typeof null`是`object`。
2.  如果两个对象的属性计数相同？如果不是，它们就不相等。
3.  循环遍历一个对象的属性并检查相应属性在第二个对象中是否具有相同的值。

```
function deepEqual (first, second) {
  // Not equal if either is not an object or is null.
  if (!isObject(first) || !isObject(second) ) return false;

  // If properties count is different
  if (keys(first).length != keys(second).length) return false;

  // Return false if any property value is different.
  for(prop in first){
    if (first[prop] != second[prop]) return false;
  }
  return true;
}

// Checks if argument is an object and is not null
function isObject(obj) {
  return (typeof obj === "object" && obj != null);
}

// returns arrays of object keys
function keys (obj) {
  result = [];
  for(var key in obj){
    result.push(key);
  }
  return result;
}

// Some test code
obj1 = {
  name: 'Singh',
  age: 20
}

obj2 = {
  age: 20,
  name: 'Singh'
}

obj3 = {
  name: 'Kaur',
  age: 19
}

console.log(deepEqual(obj1, obj2));
console.log(deepEqual(obj1, obj3));
```

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2019-11-04T09:46:01.653

经过这么多搜索，我找到了以下工作解决方案

```
function isEquivalent(a, b) {
   // Create arrays of property names
   var aProps = Object.getOwnPropertyNames(a);
   var bProps = Object.getOwnPropertyNames(b);

  // If number of properties is different, objects are not equivalent
  if (aProps.length != bProps.length) {
     return false;
  }

  for (var i = 0; i < aProps.length; i++) {
     var propName = aProps[i];

    // If values of same property are not equal, objects are not equivalent
     if (a[propName] !== b[propName]) {
         return false;
     }
  }

// If we made it this far, objects are considered equivalent
return true; } 
```

更多信息：[JavaScript 中的对象平等](http://adripofjavascript.com/blog/drips/object-equality-in-javascript.html)

* * *

## 回答 #40

> 赞同：1
> 
> 时间：2020-06-04T19:37:39.980

我只是为了确保数组和对象都以清晰的方式进行比较而编写了这个方法。

这也应该可以解决问题！:)

```
public class Objects {
    /**
     * Checks whether a value is of type Object
     * @param value the value
     */
    public static isObject = (value: any): boolean => {
        return value === Object(value) && Object.prototype.toString.call(value) !== '[object Array]'
    }

    /**
     * Checks whether a value is of type Array
     * @param value the value
     */
    public static isArray = (value: any): boolean => {
        return Object.prototype.toString.call(value) === '[object Array]' && !Objects.isObject(value)
    }

    /**
     * Check whether two values are equal
     */
    public static isEqual = (objectA: any, objectB: any) => {
        // Objects
        if (Objects.isObject(objectA) && !Objects.isObject(objectB)) {
            return false
        }
        else if (!Objects.isObject(objectA) && Objects.isObject(objectB)) {
            return false
        }
        // Arrays
        else if (Objects.isArray(objectA) && !Objects.isArray(objectB)) {
            return false
        }
        else if (!Objects.isArray(objectA) && Objects.isArray(objectB)) {
            return false
        }
        // Primitives
        else if (!Objects.isArray(objectA) && !Objects.isObject(objectA)) {
            return objectA === objectB
        }
        // Object or array
        else {
            const compareObject = (objectA: any, objectB: any): boolean => {
                if (Object.keys(objectA).length !== Object.keys(objectB).length) return false

                for (const propertyName of Object.keys(objectA)) {
                    const valueA = objectA[propertyName]
                    const valueB = objectB[propertyName]

                    if (!Objects.isEqual(valueA, valueB)) {
                        return false
                    }
                }

                return true
            }
            const compareArray = (arrayA: any[], arrayB: any[]): boolean => {
                if (arrayA.length !== arrayB.length) return false

                for (const index in arrayA) {
                    const valueA = arrayA[index]
                    const valueB = arrayB[index]

                    if (!Objects.isEqual(valueA, valueB)) {
                        return false
                    }
                }

                return true
            }
            if (Objects.isObject(objectA)) {
                return compareObject(objectA, objectB)
            } else {
                return compareArray(objectA, objectB)
            }
        }
    }
} 
```

* * *

## 回答 #41

> 赞同：1
> 
> 时间：2021-06-25T12:14:00.077

尽管这个问题已经得到充分回答，但我缺少一种方法：`toJSON`界面。

通常你想通过对它们进行字符串化来与对象进行比较，因为这是最快的方法。但是由于属性的顺序，比较经常被认为是错误的。

```
const obj1 = {
  a: 1,
  b: 2,
  c: { 
    ca: 1,
    cb: 2
  }
}

const obj2 = {
  b: 2, // changed order with a
  a: 1,
  c: { 
    ca: 1,
    cb: 2
  }
}

JSON.stringify(obj1) === JSON.stringify(obj2) // false 
```

显然对象被认为是不同的，因为属性的顺序`a`和`b`不同。

为了解决这个问题，您可以实现`toJSON`接口并定义确定性输出。

```
const obj1 = {
  a: 1,
  b: 2,
  c: { 
    ca: 1,
    cb: 2
  },
  toJSON() {
    return {
      a: this.a,
      b: this.b,
      c: { 
        ca: this.c.ca,
        cb: this.c.ca
      }
    }
  }
}

const obj2 = {
  b: 2,
  a: 1,
  c: { 
    ca: 1,
    cb: 2
  },
  toJSON() {
    return {
      a: this.a,
      b: this.b,
      c: { 
        ca: this.c.ca,
        cb: this.c.ca
      }
    }
  }
}

JSON.stringify(obj1) === JSON.stringify(obj2) // true 
```

`obj1`等等： 和 的字符串表示`obj2`被认为是相同的。

**提示**

如果您无权访问对象的直接生成，则可以简单地附加该`toJSON`函数：

```
obj1.toJSON = function() {
  return {
    a: this.a,
    b: this.b,
    c: { 
      ca: this.c.ca,
      cb: this.c.ca
    }
  }
}

obj2.toJSON = function() {
  return {
    a: this.a,
    b: this.b,
    c: { 
      ca: this.c.ca,
      cb: this.c.ca
    }
  }
}

JSON.stringify(obj1) === JSON.stringify(obj2) // true 
```

* * *

## 回答 #42

> 赞同：1
> 
> 时间：2021-08-08T11:39:31.957

在对象（没有方法）中，我们需要检查`nested Objects`,`Arrays`和`primitive types`. 对象可以有其他对象和数组（数组也可以包含其他对象和数组），所以我们可以使用递归函数，如下所示：`arrayEquals`检查数组是否相等并`equals`检查对象是否相等：

```
function arrayEquals(a, b) {
    if (a.length != b.length) {
        return false;
    }
    for (let i = 0; i < a.length; i++) {
        if (a[i].constructor !== b[i].constructor) {
            return false;
        }

        if (a[i] instanceof Array && b[i] instanceof Array) {
            if (!arrayEquals(a, b)) {
                return false;
            }
        } else if (a[i] instanceof Object && b[i] instanceof Object) {
            if (!equals(a[i], b[i])) {
                return false;
            }
        } else if (a[i] !== b[i]) {
            return false;
        }
    }
    return true;
}

function equals(a, b) {
    for (let el in a) {
        if (b.hasOwnProperty(el)) {
            if (a[el].constructor !== b[el].constructor) {
                return false;
            }

            if (a[el] instanceof Array && b[el] instanceof Array) {
                if (!arrayEquals(a[el], b[el])) {
                    return false;
                }
            } else if (a[el] instanceof Object && b[el] instanceof Object) {
                if (!equals(a[el], b[el])) {
                    return false;
                }
            } else if (a[el] !== b[el]) {
                return false;
            }
        } else {
            return false;
        }
    }
    return true;
} 
```

假设你有两个对象：

```
let a = {
    a: 1,
    b: { c: 1, d: "test" },
    c: 3,
    d: [{ a: [1, 2], e: 2 }, "test", { c: 3, q: 5 }],
};

let b = {
    a: 1,
    b: { c: 1, d: "test" },
    c: 3,
    d: [{ a: [1, 2], e: 2 }, "test", { c: 3, q: 5 }],
}; 
```

在这里使用上述`equals`函数，您可以轻松地比较其中两个对象，如下所示：

```
if(equals(a, b)) {
    // do whatever you want
} 
```

* * *

## 回答 #43

> 赞同：1
> 
> 时间：2021-08-12T14:03:56.183

在 React 中，您可以使用`isEqual`from 'react-fast-compare'。这个答案可能不适用于纯 JavaScript，但在您使用 React 的情况下会很有用。

```
console.log(isEqual({ hello: 'world' }, { hello: 'world' })) // returns true 
```

> React 中最快的深度相等比较。也非常快速的通用深度比较。非常适合 React.memo 和 shouldComponentUpdate。

更多信息可以在这里找到：[https](https://www.npmjs.com/package/react-fast-compare) ://www.npmjs.com/package/react-fast-compare 。

* * *

## 回答 #44

> 赞同：1
> 
> 时间：2022-02-03T05:05:55.847

**对两个对象进行字符串化并进行比较**

if(JSON.stringify(object1) == JSON.stringify(object2))
{
如果两个对象相同，则为 true
}
else
{
如果不是同一对象，则为 false
}

* * *

## 回答 #45

> 赞同：1
> 
> 时间：2022-02-18T17:30:40.173

2022：

我想出了一个轻而易举的简单算法，可以解决大多数边缘情况。

脚步：

1.  将物体压平
2.  简单比较两个展平的对象并寻找差异

如果您保存了扁平对象，则可以重复使用它。

```
let obj1= {var1:'value1', var2:{ var1:'value1', var2:'value2'}};
let obj2 = {var1:'value1', var2:{ var1:'value11',var2:'value2'}} 

let flat1= flattenObject(obj1)
/*
{
 'var1':'value1',
 'var2.var1':'value1',
 'var2.var2':'value2'
}
*/
let flat2= flattenObject(obj2)
/*
{
 'var1':'value1',
 'var2.var1':'value11',
 'var2.var2':'value2'
}
*/
isEqual(flat1, flat2)
/*
 false
*/ 
```

当然，您可以为这些步骤提供您的实现。但这是我的：

#### 实现

```
function flattenObject(obj) {
 const object = Object.create(null);
 const path = [];
 const isObject = (value) => Object(value) === value;

 function dig(obj) {
  for (let [key, value] of Object.entries(obj)) {
    path.push(key);
    if (isObject(value)) dig(value);
    else object[path.join('.')] = value;
    path.pop();
  }
 }

 dig(obj);
 return object;
} 
```

```
 function isEqual(flat1, flat2) {
    for (let key in flat2) {
        if (flat1[key] !== flat2[key])
            return false
    }
    // check for missing keys
    for (let key in flat1) {
        if (!(key in flat2))
            return false
    }
    return true
} 
```

您还可以使用该方法来获取 和 之间的 Diff`obj1`对象`obj2`。

查看该答案以了解详细信息：[Generic deep diff between two objects](https://stackoverflow.com/a/71173966/1919821)

* * *

## 回答 #46

> 赞同：0
> 
> 时间：2008-10-14T13:54:31.993

取决于你所说的平等是什么意思。因此，作为类的开发者，您可以定义它们的相等性。

有时使用一种情况，如果两个实例指向内存中的同一位置，则它们被认为是“相等的”，但这并不总是您想要的。例如，如果我有一个 Person 类，如果两个 Person 对象具有相同的姓氏、名字和社会保险号（即使它们指向内存中的不同位置），我可能会认为它们是“相等的”。

另一方面，如果两个对象的每个成员的值相同，我们就不能简单地说两个对象相等，因为有时您不希望这样。换句话说，对于每个类，由类开发人员定义构成对象“身份”的成员并开发适当的相等运算符（通过重载 == 运算符或 Equals 方法）。

如果两个对象具有相同的哈希值，则说它们相等是一种出路。但是，您必须想知道如何为每个实例计算哈希值。回到上面的 Person 示例，如果哈希是通过查看 First Name、Last Name 和 Social Security Number 字段的值来计算的，我们可以使用这个系统。最重要的是，我们依赖于散列方法的质量（这本身就是一个很大的话题，但可以说并非所有的散列都是平等的，糟糕的散列方法会导致*更多*的冲突，这在这种情况会返回错误的匹配）。

* * *

## 回答 #47

> 赞同：0
> 
> 时间：2013-02-20T18:44:46.700

判断两个对象是否相似的快速“破解”方法是使用它们的 toString() 方法。如果您正在检查对象 A 和 B，请确保 A 和 B 具有有意义的 toString() 方法并检查它们返回的字符串是否相同。

这不是灵丹妙药，但有时在正确的情况下很有用。

* * *

## 回答 #48

> 赞同：0
> 
> 时间：2014-05-07T07:06:23.493

这是检查对象的“值相等”的一种非常基本的方法。

```
var john = {
    occupation: "Web Developer",
    age: 25
};

var bobby = {
    occupation: "Web Developer",
    age: 25
};

function isEquivalent(a, b) {
    // Create arrays of property names

    var aProps = Object.getOwnPropertyNames(a);
    var bProps = Object.getOwnPropertyNames(b);

    // If number of properties is different, objects are not equivalent

    if (aProps.length != bProps.length) {
        return false;
    }

    for (var i = 0; i < aProps.length; i++) {
        var propName = aProps[i];

        // If values of same property are not equal, objects are not equivalent
        if (a[propName] !== b[propName]) {
           return false;
        }
    }

    // If we made it this far, objects are considered equivalent
    return true;
}

// Outputs: true
console.log(isEquivalent(john, bobby)); 
```

[演示 - JSFiddle](http://jsfiddle.net/SUDHARSHAN_R/6beqR/)

如您所见，要检查对象的“值相等性”，我们基本上必须遍历对象中的每个属性以查看它们是否相等。虽然这个简单的实现适用于我们的示例，但它无法处理很多情况。例如：

*   如果其中一个属性值本身就是一个对象怎么办？
*   如果其中一个属性值是 NaN（JavaScript 中唯一不等于自身的值呢？）
*   如果 a 有一个值为 undefined 的属性，而 b 没有这个属性（因此计算结果为 undefined？）怎么办？

对于检查对象的“值相等”的稳健方法，最好依赖一个经过良好测试的库，该库涵盖各种边缘情况，如[Underscore](http://underscorejs.org/#isEqual)。

```
var john = {
    occupation: "Web Developer",
    age: 25
};

var bobby = {
    occupation: "Web Developer",
    age: 25
};

// Outputs: true
console.log(_.isEqual(john, bobby)); 
```

[演示 - JSFiddle](http://jsfiddle.net/SUDHARSHAN_R/RFYMh/)

* * *

## 回答 #49

> 赞同：0
> 
> 时间：2016-09-24T06:37:47.490

我的版本，其中包括发现差异的链条，以及差异是什么。

```
function DeepObjectCompare(O1, O2)
{
    try {
        DOC_Val(O1, O2, ['O1->O2', O1, O2]);
        return DOC_Val(O2, O1, ['O2->O1', O1, O2]);
    } catch(e) {
        console.log(e.Chain);
        throw(e);
    }
}
function DOC_Error(Reason, Chain, Val1, Val2)
{
    this.Reason=Reason;
    this.Chain=Chain;
    this.Val1=Val1;
    this.Val2=Val2;
}

function DOC_Val(Val1, Val2, Chain)
{
    function DoThrow(Reason, NewChain) { throw(new DOC_Error(Reason, NewChain!==undefined ? NewChain : Chain, Val1, Val2)); }

    if(typeof(Val1)!==typeof(Val2))
        return DoThrow('Type Mismatch');
    if(Val1===null || Val1===undefined)
        return Val1!==Val2 ? DoThrow('Null/undefined mismatch') : true;
    if(Val1.constructor!==Val2.constructor)
        return DoThrow('Constructor mismatch');
    switch(typeof(Val1))
    {
        case 'object':
            for(var m in Val1)
            {
                if(!Val1.hasOwnProperty(m))
                    continue;
                var CurChain=Chain.concat([m]);
                if(!Val2.hasOwnProperty(m))
                    return DoThrow('Val2 missing property', CurChain);
                DOC_Val(Val1[m], Val2[m], CurChain);
            }
            return true;
        case 'number':
            if(Number.isNaN(Val1))
                return !Number.isNaN(Val2) ? DoThrow('NaN mismatch') : true;
        case 'string':
        case 'boolean':
            return Val1!==Val2 ? DoThrow('Value mismatch') : true;
        case 'function':
            if(Val1.prototype!==Val2.prototype)
                return DoThrow('Prototype mismatch');
            if(Val1!==Val2)
                return DoThrow('Function mismatch');
            return true;
        default:
            return DoThrow('Val1 is unknown type');
    }
} 
```

* * *

## 回答 #50

> 赞同：0
> 
> 时间：2017-08-29T03:04:39.617

我已经实现了一个方法，它需要两个 json 并使用递归检查它们的键是否具有相同的值。我用[另一个问题](https://stackoverflow.com/questions/3115982/how-to-check-if-two-arrays-are-equal-with-javascript)来解决这个问题。

```
const arraysEqual = (a, b) => {
    if (a === b)
        return true;
    if (a === null || b === null)
        return false;
    if (a.length !== b.length)
        return false;

    // If you don't care about the order of the elements inside
    // the array, you should sort both arrays here.

    for (let i = 0; i < a.length; ++i) {
        if (a[i] !== b[i])
            return false;
    }
    return true;
};

const jsonsEqual = (a, b) => {

  if(typeof a !== 'object' || typeof b !== 'object')
      return false;

  if (Object.keys(a).length === Object.keys(b).length) { // if items have the same size
      let response = true;

      for (let key in a) {
          if (!b[key]) // if not key
              response = false;
          if (typeof a[key] !== typeof b[key]) // if typeof doesn't equals
              response = false;
          else {
              if (Array.isArray(a[key])) // if array
                  response = arraysEqual(a[key], b[key]);
              else if (typeof a[key] === 'object') // if another json
                  response = jsonsEqual(a[key], b[key]);
              else if (a[key] !== b[key])  // not equals
                  response = false;
          }
          if (!response) // return if one item isn't equal
              return false;
      }
  } else
      return false;

  return true;
};

const json1 = { 
  a: 'a', 
  b: 'asd', 
  c: [
    '1',
    2,
    2.5,
    '3', 
    {
      d: 'asd',
      e: [
        1.6,
        { 
          f: 'asdasd',
          g: '123'
        }
      ]
    }
  ],
  h: 1,
  i: 1.2,
};

const json2 = {
  a: 'nops',
  b: 'asd'
};

const json3 = { 
  a: 'h', 
  b: '484', 
  c: [
    3,
    4.5,
    '2ss', 
    {
      e: [
        { 
          f: 'asdasd',
          g: '123'
        }
      ]
    }
  ],
  h: 1,
  i: 1.2,
};

const result = jsonsEqual(json1,json2);
//const result = jsonsEqual(json1,json3);
//const result = jsonsEqual(json1,json1);

if(result) // is equal
  $('#result').text("Jsons are the same")
else
  $('#result').text("Jsons aren't equals")
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

<div id="result"></div>
```

* * *

## 回答 #51

> 赞同：0
> 
> 时间：2018-01-08T22:15:23.230

这是 stringify 技巧的一个版本，它输入更少，并且在很多情况下都适用于琐碎的 JSON 数据比较。

```
var obj1Fingerprint = JSON.stringify(obj1).replace(/\{|\}/g,'').split(',').sort().join(',');
var obj2Fingerprint = JSON.stringify(obj2).replace(/\{|\}/g,'').split(',').sort().join(',');
if ( obj1Fingerprint === obj2Fingerprint) { ... } else { ... } 
```

* * *

## 回答 #52

> 赞同：0
> 
> 时间：2018-01-14T17:48:10.507

这里有很多好的想法！这是我的深度平等版本。我将它发布在 github 上并围绕它编写了一些测试。很难涵盖所有可能的情况，有时也没有必要这样做。

我涵盖`NaN !== NaN`了循环依赖。

[https://github.com/ryancat/simple-deep-equal/blob/master/index.js](https://github.com/ryancat/simple-deep-equal/blob/master/index.js)

* * *

## 回答 #53

> 赞同：0
> 
> 时间：2018-09-15T18:52:02.070

取决于。如果对象中键的顺序不重要，我不需要知道所述对象的原型。使用总是做这项工作。

```
const object = {};
JSON.stringify(object) === "{}" will pass but {} === "{}" will not 
```

* * *

## 回答 #54

> 赞同：0
> 
> 时间：2019-09-09T17:40:16.043

这是一个简单的 Javascript 函数，用于比较具有简单键值对的两个对象。该函数将返回一个字符串数组，其中每个字符串是两个对象之间不等式的路径。

```
function compare(a,b) {
    var paths = [];
    [...new Set(Object.keys(a).concat(Object.keys(b)))].forEach(key=>{
        if(typeof a[key] === 'object' && typeof b[key] === 'object') {
            var results = compare(a[key], b[key]);
            if(JSON.stringify(results)!=='[]') {
                paths.push(...results.map(result=>key.concat("=>"+result)));
            }
        }
        else if (a[key]!==b[key]) {
            paths.push(key);
        }
    })
    return paths;
} 
```

如果你只想比较两个对象而不知道不等式的路径，你可以这样做：

```
if(JSON.stringify(compare(object1, object2))==='[]') {
   // the two objects are equal
} else {
   // the two objects are not equal
} 
```

* * *

## 回答 #55

> 赞同：0
> 
> 时间：2019-10-06T00:52:35.743

1.  对对象进行排序（字典）
2.  比较 JSON 字符串

    ```
    function areTwoDictsEqual(dictA, dictB) {
        function sortDict(dict) {
            var keys = Object.keys(dict);
            keys.sort();

            var newDict = {};
            for (var i=0; i<keys.length; i++) {
                var key = keys[i];
                var value = dict[key];
                newDict[key] = value;
            } 
            return newDict;
        }

        return JSON.stringify(sortDict(dictA)) == JSON.stringify(sortDict(dictB));
    } 
    ```

* * *

## 回答 #56

> 赞同：0
> 
> 时间：2020-11-24T13:41:41.147

另一种选择是使用`equals`Ramda[库](https://ramdajs.com/docs/#equals)：

```
const c = {a: 1, b: 2};
const d = {b: 2, a: 1};
R.equals(c, d); //=> true 
```

* * *

## 回答 #57

> 赞同：0
> 
> 时间：2021-02-13T16:47:57.767

```
const obj = {
  name: "Carl",
  age: 15
}
const obj2 = {
  name: "Carl",
  age: 15,
}

const compareObj = (objects) => {
  const res =  objects.map((item) => {
    return Object.entries(item).flat().join()
  })
  return res.every((a) => {
    return a === res[0]
  })
}

console.log(compareObj([obj,obj2]))
```

* * *

## 回答 #58

> 赞同：0
> 
> 时间：2021-03-14T18:08:50.300

如果您真的想比较并返回两个对象的差异。你可以使用这个包：[https ://www.npmjs.com/package/deep-diff](https://www.npmjs.com/package/deep-diff)

或者只使用这个包使用的代码

[https://github.com/flitbit/diff/blob/master/index.js](https://github.com/flitbit/diff/blob/master/index.js)

**只是不要将其转换为字符串进行比较。**

* * *

## 回答 #59

> 赞同：0
> 
> 时间：2021-08-28T06:24:40.777

**纯 JS 方法**：我的答案是基于生成一个字符串，无论属性顺序是否相同，它都会返回相同的值。设置对象可用于切换大小写和空白是否重要。（为了避免失去焦点，我不包括那些支持功能，或者我猜想应该在任何实用程序集中的 isObject。）

这里也没有展示，但是为了减少字符串比较时间，如果对象很大并且想要加快比较速度，您还可以对字符串进行哈希处理并比较子字符串；这仅适用于非常大的对象（当然，错误相等的可能性很小）。

然后你可以比较 genObjStr(obj1) ?= genObjStr(obj2)

```
function genObjStr(obj, settings) {
// Generate a string that corresponds to an object guarenteed to be the same str even if
// the object have different ordering. The string would largely be used for comparison purposes

var settings = settings||{};
var doStripWhiteSpace = defTrue(settings.doStripWhiteSpace);
var doSetLowerCase = settings.doSetLowerCase||false;

if(isArray(obj)) {
    var vals = [];
    for(var i = 0; i < obj.length; ++i) {
        vals.push(genObjStr(obj[i], settings));
    }
    vals = arraySort(vals);
    return vals.join(`,`);

} else if(isObject(obj)) {

    var keys = Object.keys(obj);
    keys = arraySort(keys);

    var vals = [];
    for(var key of keys) {

        var value = obj[key];

        value = genObjStr(value, settings);

        if(doStripWhiteSpace) {
            key = removeWhitespace(key);
            var value = removeWhitespace(value);
        };
        if(doSetLowerCase) {
            key = key.toLowerCase();
            value = value.toLowerCase();
        }

        vals.push(value);
    }
    var str = JSON.stringify({keys: keys, vals: vals});
    return str
} else {
    if(doStripWhiteSpace) {
        obj = removeWhitespace(obj);
    };
    if(doSetLowerCase) {
        obj = obj.toLowerCase();
    }
    return obj
} 
```

}

```
var obj1 = {foo: 123, bar: `Test`};
var obj2 = {bar: `Test`, foo: 123};

console.log(genObjStr(obj1) == genObjStr(obj1)) 
```

* * *

## 回答 #60

> 赞同：0
> 
> 时间：2021-11-03T18:36:24.987

如果您的问题是检查两个对象是否相等，那么此函数可能很有用

```
function equals(a, b) {
const aKeys = Object.keys(a)
const bKeys = Object.keys(b)
if(aKeys.length != bKeys.length) {
    return false
}
for(let i = 0;i < aKeys.length;i++) {
    if(aKeys[i] != bKeys[i]) {
        return false
    } 
}
for(let i = 0;i < aKeys.length;i++) {
    if(a[aKeys[i]] != b[bKeys[i]]) {
        return false
    }
}
return true
} 
```

首先我们检查这些对象的键列表的长度是否相同，如果不是，我们返回 false 来检查两个对象是否相等，它们必须具有相同的键（=names）和相同的键值，所以我们获取 objA 和 objB 的所有键，然后我们检查它们是否相等，一旦我们发现两个键不相等，然后我们返回 false，然后当所有键相等时，我们循环遍历其中一个键之一对象，然后我们检查它们是否相等，一旦它们不相等，我们返回 false，在两个循环完成后，这意味着它们相等，我们返回 true **注意：此函数仅适用于没有函数的对象**

* * *

## 回答 #61

> 赞同：0
> 
> 时间：2022-01-22T18:33:47.650

> **使用 JSON.stringify() 并不总是可靠的**。所以这种方法是您问题IMO的最佳解决方案

首先，**不**，没有通用的方法来确定一个对象是否相等！

但是有一个概念叫做**浅等式比较**。有一个[npm 库](https://www.npmjs.com/package/shallowequal)可以帮助你使用这个概念

**例子**

```
const shallowequal = require('shallowequal');

const object = { 'user': 'fred' };
const other = { 'user': 'fred' };

// Referential Equality Comparison (`strict ===`)
object === other; // → false

// Shallow Equality Comparison
shallowequal(object, other); // → true 
```

如果您想知道如何创建`shallowEqual`比较方法，请参阅[此处](https://github.com/facebook/fbjs/blob/master/packages/fbjs/src/core/shallowEqual.js#L39-L67)。它来自开源`fbjs`Facebook 库。

* * *

## 浅等式比较

`shallowequal(obj1, obj2)`

> `shallowEqual``obj1`在两个值（即和）之间执行浅层相等比较`obj2`以确定它们是否相等。

相等是通过遍历给定的键来执行的`obj1`，并且只要任何键的值在和`false`之间不严格相等就返回。否则，只要所有键的值严格相等，就返回。`obj1``obj2``true`

* * *

## 回答 #62

> 赞同：0
> 
> 时间：2022-02-01T00:03:32.090

我发现***在忽略属性顺序***的情况下比较两个 javascript 对象的***值***的一种简单方法是使用 JSON stringify 替换函数：

 **```
const compareReplacer = (key, value) => {
    if(typeof value === 'object' && !(value instanceof Array))
        return Object.entries(value).sort();
    return value;
}
export const compareObjects = (a, b) => JSON.stringify(a, compareReplacer) === JSON.stringify(b, compareReplacer); 
```

这将在每一步对属性进行排序，以便字符串结果对属性顺序保持不变。以前可能有人这样做过，但我只是想我会分享它以防万一:)。

* * *

## 回答 #63

> 赞同：-1
> 
> 时间：2010-01-12T13:54:39.733

我需要模拟 jQuery POST 请求，所以对我来说重要的平等是两个对象具有相同的属性集（两个对象中都没有丢失），并且每个属性值都是“相等的”（根据这个定义）。我不关心具有不匹配方法的对象。

这是我将要使用的，它应该足以满足*我的特定*要求：

```
function PostRequest() {
    for (var i = 0; i < arguments.length; i += 2) {
        this[arguments[i]] = arguments[i+1];
    }

    var compare = function(u, v) {
        if (typeof(u) != typeof(v)) {
            return false;
        }

        var allkeys = {};
        for (var i in u) {
            allkeys[i] = 1;
        }
        for (var i in v) {
            allkeys[i] = 1;
        }
        for (var i in allkeys) {
            if (u.hasOwnProperty(i) != v.hasOwnProperty(i)) {
                if ((u.hasOwnProperty(i) && typeof(u[i]) == 'function') ||
                    (v.hasOwnProperty(i) && typeof(v[i]) == 'function')) {
                    continue;
                } else {
                    return false;
                }
            }
            if (typeof(u[i]) != typeof(v[i])) {
                return false;
            }
            if (typeof(u[i]) == 'object') {
                if (!compare(u[i], v[i])) {
                    return false;
                }
            } else {
                if (u[i] !== v[i]) {
                    return false;
                }
            }
        }

        return true;
    };

    this.equals = function(o) {
        return compare(this, o);
    };

    return this;
} 
```

像这样使用：

```
foo = new PostRequest('text', 'hello', 'html', '<p>hello</p>');
foo.equals({ html: '<p>hello</p>', text: 'hello' }); 
```

* * *

## 回答 #64

> 赞同：-1
> 
> 时间：2012-08-25T05:05:52.590

我编写了一个在 Node.js 和名为 compare.js 的浏览器上运行的小型库。它为 JavaScript 的所有数据类型提供了常用的比较运算符，例如 ==、!=、>、>=、<、<= 和标识。

例如，您可以使用

```
cmp.eq(obj1, obj2); 
```

这将检查是否相等（使用深度相等的方法）。否则，如果你这样做

```
cmp.id(obj1, obj2); 
```

它将通过引用进行比较，因此检查身份。您还可以在对象上使用 < 和 >，这意味着子集和超集。

compare.js 包含近 700 个单元测试，因此希望它不会有太多错误 ;-)。

你可以在[https://github.com/goloroden/compare.js](https://github.com/goloroden/compare.js)免费找到它，它是在 MIT 许可下开源的。

* * *

## 回答 #65

> 赞同：-1
> 
> 时间：2013-06-23T12:55:51.873

以下一些解决方案在性能、功能和风格方面存在问题......他们没有经过足够的考虑，其中一些在不同的情况下失败了。我试图在自己的解决方案中解决这个问题，非常感谢您的反馈：

[http://stamat.wordpress.com/javascript-object-comparison/](http://stamat.wordpress.com/javascript-object-comparison/)

```
//Returns the object's class, Array, Date, RegExp, Object are of interest to us
var getClass = function(val) {
    return Object.prototype.toString.call(val)
        .match(/^\[object\s(.*)\]$/)[1];
};

//Defines the type of the value, extended typeof
var whatis = function(val) {

    if (val === undefined)
        return 'undefined';
    if (val === null)
        return 'null';

    var type = typeof val;

    if (type === 'object')
        type = getClass(val).toLowerCase();

    if (type === 'number') {
        if (val.toString().indexOf('.') > 0)
            return 'float';
        else
        return 'integer';
    }

    return type;
   };

var compareObjects = function(a, b) {
    if (a === b)
        return true;
    for (var i in a) {
        if (b.hasOwnProperty(i)) {
            if (!equal(a[i],b[i])) return false;
        } else {
            return false;
        }
    }

    for (var i in b) {
        if (!a.hasOwnProperty(i)) {
            return false;
        }
    }
    return true;
};

var compareArrays = function(a, b) {
    if (a === b)
        return true;
    if (a.length !== b.length)
        return false;
    for (var i = 0; i < a.length; i++){
        if(!equal(a[i], b[i])) return false;
    };
    return true;
};

var _equal = {};
_equal.array = compareArrays;
_equal.object = compareObjects;
_equal.date = function(a, b) {
    return a.getTime() === b.getTime();
};
_equal.regexp = function(a, b) {
    return a.toString() === b.toString();
};
//  uncoment to support function as string compare
//  _equal.fucntion =  _equal.regexp;

/*
 * Are two values equal, deep compare for objects and arrays.
 * @param a {any}
 * @param b {any}
 * @return {boolean} Are equal?
 */
var equal = function(a, b) {
    if (a !== b) {
        var atype = whatis(a), btype = whatis(b);

        if (atype === btype)
            return _equal.hasOwnProperty(atype) ? _equal[atype](a, b) : a==b;

        return false;
    }

    return true;
}; 
```

* * *

## 回答 #66

> 赞同：-1
> 
> 时间：2014-02-13T18:06:05.577

对象相等检查：`JSON.stringify(array1.sort()) === JSON.stringify(array2.sort())`

上述测试也适用于对象数组，在这种情况下，使用[http://www.w3schools.com/jsref/jsref_sort.asp中记录的排序函数](http://www.w3schools.com/jsref/jsref_sort.asp)

对于具有扁平 JSON 模式的小型数组可能就足够了。

* * *

## 回答 #67

> 赞同：-1
> 
> 时间：2014-11-19T10:30:57.033

当然，当我们这样做时，我会投入我自己对车轮的改造（我为使用的辐条和材料的数量感到自豪）：

```
////////////////////////////////////////////////////////////////////////////////

var equals = function ( objectA, objectB ) {
    var result = false,
        keysA,
        keysB;

    // Check if they are pointing at the same variable. If they are, no need to test further.
    if ( objectA === objectB ) {
        return true;
    }

    // Check if they are the same type. If they are not, no need to test further.
    if ( typeof objectA !== typeof objectB ) {
        return false;
    }

    // Check what kind of variables they are to see what sort of comparison we should make.
    if ( typeof objectA === "object" ) {
        // Check if they have the same constructor, so that we are comparing apples with apples.
        if ( objectA.constructor === objectA.constructor ) {
            // If we are working with Arrays...
            if ( objectA instanceof Array ) {
                // Check the arrays are the same length. If not, they cannot be the same.
                if ( objectA.length === objectB.length ) {
                    // Compare each element. They must be identical. If not, the comparison stops immediately and returns false.
                    return objectA.every(
                        function ( element, i ) {
                            return equals( element, objectB[ i ] );
                        }
                    );
                }
                // They are not the same length, and so are not identical.
                else {
                    return false;
                }
            }
            // If we are working with RegExps...
            else if ( objectA instanceof RegExp ) {
                // Return the results of a string comparison of the expression.
                return ( objectA.toString() === objectB.toString() );
            }
            // Else we are working with other types of objects...
            else {
                // Get the keys as arrays from both objects. This uses Object.keys, so no old browsers here.
                keysA = Object.keys( objectA );

                keysB = Object.keys( objectB );

                // Check the key arrays are the same length. If not, they cannot be the same.
                if ( keysA.length === keysB.length ) {
                    // Compare each property. They must be identical. If not, the comparison stops immediately and returns false.
                    return keysA.every(
                        function ( element ) {
                            return equals( objectA[ element ], objectB[ element ] );
                        }
                    );
                }
                // They do not have the same number of keys, and so are not identical.
                else {
                    return false;
                }
            }
        }
        // They don't have the same constructor.
        else {
            return false;
        }
    }
    // If they are both functions, let us do a string comparison.
    else if ( typeof objectA === "function" ) {
        return ( objectA.toString() === objectB.toString() );
    }
    // If a simple variable type, compare directly without coercion.
    else {
        return ( objectA === objectB );
    }

    // Return a default if nothing has already been returned.
    return result;
};

//////////////////////////////////////////////////////////////////////////////// 
```

它尽可能快地返回 false，但当然对于差异嵌套很深的大型对象，它可能不太有效。在我自己的场景中，很好地处理嵌套数组很重要。

希望它可以帮助需要这种“轮子”的人。

* * *

## 回答 #68

> 赞同：-1
> 
> 时间：2015-03-12T09:49:59.963

是的，另一个答案...

```
Object.prototype.equals = function (object) {
    if (this.constructor !== object.constructor) return false;
    if (Object.keys(this).length !== Object.keys(object).length) return false;
    var obk;
    for (obk in object) {
        if (this[obk] !== object[obk])
            return false;
    }
    return true;
}

var aaa = JSON.parse('{"name":"mike","tel":"1324356584"}');
var bbb = JSON.parse('{"tel":"1324356584","name":"mike"}');
var ccc = JSON.parse('{"name":"mike","tel":"584"}');
var ddd = JSON.parse('{"name":"mike","tel":"1324356584", "work":"nope"}');

$("#ab").text(aaa.equals(bbb));
$("#ba").text(bbb.equals(aaa));
$("#bc").text(bbb.equals(ccc));
$("#ad").text(aaa.equals(ddd));
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
aaa equals bbb? <span id="ab"></span> <br/>
bbb equals aaa? <span id="ba"></span> <br/>
bbb equals ccc? <span id="bc"></span> <br/>
aaa equals ddd? <span id="ad"></span>
```

* * *

## 回答 #69

> 赞同：-1
> 
> 时间：2016-07-29T14:24:13.070

我有一个更短的函数，它将深入到所有子对象或数组中。[如果顺序不同（如here所述](https://stackoverflow.com/a/1144249/1895428)） ，它与它一样有效，`JSON.stringify(obj1) === JSON.stringify(obj2)`但`JSON.stringify`将不起作用。

```
var obj1 = { a : 1, b : 2 };
var obj2 = { b : 2, a : 1 };

console.log(JSON.stringify(obj1) === JSON.stringify(obj2)); // false 
```

如果你想对不相等的值做一些事情，这个函数也是一个好的开始。

```
function arr_or_obj(v)
{ return !!v && (v.constructor === Object || v.constructor === Array); }

function deep_equal(v1, v2)
{
    if (arr_or_obj(v1) && arr_or_obj(v2) && v1.constructor === v2.constructor)
    {
        if (Object.keys(v1).length === Object.keys(v2).length) // check the length
        for (var i in v1)
        {
            if (!deep_equal(v1[i], v2[i]))
            { return false; }
        }
        else
        { return false; }
    }
    else if (v1 !== v2)
    { return false; }

    return true;
}

//////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////

var obj1 = [
    {
        hat : {
            cap : ['something', null ],
            helmet : [ 'triple eight', 'pro-tec' ]
        },
        shoes : [ 'loafer', 'penny' ]
    },
    {
        beers : [ 'budweiser', 'busch' ],
        wines : [ 'barefoot', 'yellow tail' ]
    }
];

var obj2 = [
    {
        shoes : [ 'loafer', 'penny' ], // same even if the order is different
        hat : {
            cap : ['something', null ],
            helmet : [ 'triple eight', 'pro-tec' ]
        }
    },
    {
        beers : [ 'budweiser', 'busch' ],
        wines : [ 'barefoot', 'yellow tail' ]
    }
];

console.log(deep_equal(obj1, obj2)); // true
console.log(JSON.stringify(obj1) === JSON.stringify(obj2)); // false
console.log(deep_equal([], [])); // true
console.log(deep_equal({}, {})); // true
console.log(deep_equal([], {})); // false
```

如果你想添加对`Function`,`Date`和的支持，你可以在（未测试）`RegExp`的开头添加这个：`deep_equal`

```
if ((typeof obj1 === 'function' && typeof obj2 === 'function') ||
(obj1 instanceof Date && obj2 instanceof Date) ||
(obj1 instanceof RegExp && obj2 instanceof RegExp))
{
    obj1 = obj1.toString();
    obj2 = obj2.toString();
} 
```

* * *

## 回答 #70

> 赞同：-1
> 
> 时间：2019-04-26T20:32:02.637

```
function isDeepEqual(obj1, obj2, testPrototypes = false) {
  if (obj1 === obj2) {
    return true
  }

  if (typeof obj1 === "function" && typeof obj2 === "function") {
    return obj1.toString() === obj2.toString()
  }

  if (obj1 instanceof Date && obj2 instanceof Date) {
    return obj1.getTime() === obj2.getTime()
  }

  if (
    Object.prototype.toString.call(obj1) !==
      Object.prototype.toString.call(obj2) ||
    typeof obj1 !== "object"
  ) {
    return false
  }

  const prototypesAreEqual = testPrototypes
    ? isDeepEqual(
        Object.getPrototypeOf(obj1),
        Object.getPrototypeOf(obj2),
        true
      )
    : true

  const obj1Props = Object.getOwnPropertyNames(obj1)
  const obj2Props = Object.getOwnPropertyNames(obj2)

  return (
    obj1Props.length === obj2Props.length &&
    prototypesAreEqual &&
    obj1Props.every(prop => isDeepEqual(obj1[prop], obj2[prop]))
  )
}

console.log(isDeepEqual({key: 'one'}, {key: 'first'}))
console.log(isDeepEqual({key: 'one'}, {key: 'one'}))
```

* * *

## 回答 #71

> 赞同：-1
> 
> 时间：2019-09-04T11:17:25.470

这是一个经典的 javascript 问题！我创建了一种方法来检查深层对象相等性，该方法具有能够从比较中选择要忽略的属性的功能。参数是要比较的两个对象，以及一个可选的字符串化属性数组以忽略相对路径。

```
function isObjectEqual( o1, o2, ignorePropsArr=[]) {
    // Deep Clone objects
    let _obj1 = JSON.parse(JSON.stringify(o1)),
        _obj2 = JSON.parse(JSON.stringify(o2));
    // Remove props to ignore
    ignorePropsArr.map( p => { 
        eval('_obj1.'+p+' = _obj2.'+p+' = "IGNORED"');
    });
    // compare as strings
    let s1 = JSON.stringify(_obj1),
        s2 = JSON.stringify(_obj2);
    // return [s1==s2,s1,s2];
    return s1==s2;
}

// Objects 0 and 1 are exact equals
obj0 = { price: 66544.10, RSIs: [0.000432334, 0.00046531], candles: {A: 543, B: 321, C: 4322}}
obj1 = { price: 66544.10, RSIs: [0.000432334, 0.00046531], candles: {A: 543, B: 321, C: 4322}}
obj2 = { price: 66544.12, RSIs: [0.000432334, 0.00046531], candles: {A: 543, B: 321, C: 4322}}
obj3 = { price: 66544.13, RSIs: [0.000432334, 0.00046531], candles: {A: 541, B: 321, C: 4322}}
obj4 = { price: 66544.14, RSIs: [0.000432334, 0.00046530], candles: {A: 543, B: 321, C: 4322}}

isObjectEqual(obj0,obj1) // true
isObjectEqual(obj0,obj2) // false
isObjectEqual(obj0,obj2,['price']) // true
isObjectEqual(obj0,obj3,['price']) // false
isObjectEqual(obj0,obj3,['price','candles.A']) // true
isObjectEqual(obj0,obj4,['price','RSIs[1]'])   // true 
```

* * *

## 回答 #72

> 赞同：-1
> 
> 时间：2019-10-04T12:27:31.120

```
const one={name:'mohit' , age:30};
//const two ={name:'mohit',age:30};
const two ={age:30,name:'mohit'};

function isEquivalent(a, b) {
// Create arrays of property names
var aProps = Object.getOwnPropertyNames(a);
var bProps = Object.getOwnPropertyNames(b);

// If number of properties is different,
// objects are not equivalent
if (aProps.length != bProps.length) {
    return false;
}

for (var i = 0; i < aProps.length; i++) {
    var propName = aProps[i];

    // If values of same property are not equal,
    // objects are not equivalent
    if (a[propName] !== b[propName]) {
        return false;
    }
}

// If we made it this far, objects
// are considered equivalent
return true;
}

console.log(isEquivalent(one,two)) 
```

* * *

## 回答 #73

> 赞同：-1
> 
> 时间：2019-11-25T05:46:16.707

虽然这个问题已经有很多答案了。我的尝试只是提供另一种实现方式：

```
const primitveDataTypes = ['number', 'boolean', 'string', 'undefined'];
const isDateOrRegExp = (value) => value instanceof Date || value instanceof RegExp;
const compare = (first, second) => {
    let agg = true;
    if(typeof first === typeof second && primitveDataTypes.indexOf(typeof first) !== -1 && first !== second){
        agg =  false;
    }
    // adding support for Date and RegExp.
    else if(isDateOrRegExp(first) || isDateOrRegExp(second)){
        if(first.toString() !== second.toString()){
            agg = false;
        }
    }
    else {
        if(Array.isArray(first) && Array.isArray(second)){
        if(first.length === second.length){
             for(let i = 0; i < first.length; i++){
                if(typeof first[i] === 'object' && typeof second[i] === 'object'){
                    agg = compare(first[i], second[i]);
                }
                else if(first[i] !== second[i]){
                    agg = false;
                }
            }
        } else {
            agg = false;
        }
    } else {
        const firstKeys = Object.keys(first);
        const secondKeys = Object.keys(second);
        if(firstKeys.length !== secondKeys.length){
            agg = false;
        }
        for(let j = 0 ; j < firstKeys.length; j++){
            if(firstKeys[j] !== secondKeys[j]){
                agg = false;
            }
            if(first[firstKeys[j]] && second[secondKeys[j]] && typeof first[firstKeys[j]] === 'object' && typeof second[secondKeys[j]] === 'object'){
                agg = compare(first[firstKeys[j]], second[secondKeys[j]]);
             } 
             else if(first[firstKeys[j]] !== second[secondKeys[j]]){
                agg = false;
             } 
        }
    }
    }
    return agg;
}

console.log('result', compare({a: 1, b: { c: [4, {d:5}, {e:6}]}, r: null}, {a: 1, b: { c: [4, {d:5}, {e:6}]}, r: 'ffd'}));  //returns false.
```

* * *

## 回答 #74

> 赞同：-1
> 
> 时间：2021-07-28T16:53:19.687

我之前添加了一个答案，但它并不完美，但这个会检查对象的相等性

```
function equalObjects(myObj1, myObj2){

let firstScore = 0;
let secondScore = 0;
let index=0;

let proprtiesArray = [];
let valuesArray = [];

let firstLength = 0;
let secondLength = 0;

for (const key in myObj1) {
    if (myObj1.hasOwnProperty(key)) {
        firstLength += 1;
        proprtiesArray.push(key);
        valuesArray.push(myObj1[key]);        
        firstScore +=1;
    }
}

for (const key in myObj2) {
    if (myObj2.hasOwnProperty(key)) {
        secondLength += 1;
        if (valuesArray[index] === myObj2[key] && proprtiesArray[index] === key) {
          secondScore +=1;
        }
        //console.log(myObj[key]);

        index += 1;
    }

}

if (secondScore == firstScore && firstLength === secondLength) {
   console.log("true", "equal objects");
   return true;
} else {
   console.log("false", "not equal objects");
   return false;
}

}

equalObjects({'firstName':'Ada','lastName':'Lovelace'},{'firstName':'Ada','lastName':'Lovelace'});

equalObjects({'firstName':'Ada','lastName':'Lovelace'},{'firstName':'Ada','lastName1':'Lovelace'});

equalObjects({'firstName':'Ada','lastName':'Lovelace'},{'firstName':'Ada','lastName':'Lovelace', 'missing': false});
```

* * *

## 回答 #75

> 赞同：-2
> 
> 时间：2013-04-19T05:32:28.790

```
function isEqual(obj1, obj2){
    type1 = typeof(obj1);
    type2 = typeof(obj2);
    if(type1===type2){
        switch (type1){
            case "object": return JSON.stringify(obj1)===JSON.stringify(obj2);
            case "function": return eval(obj1).toString()===eval(obj2).toString();
            default: return obj1==obj2;
        }
    }
    return false;
}//have not tried but should work. 
```

* * *

## 回答 #76

> 赞同：-2
> 
> 时间：2017-05-03T12:28:24.867

这是通用相等检查器函数，它接收元素数组作为输入并将它们相互比较。适用于所有类型的元素。

```
const isEqual = function(inputs = []) {
  // Checks an element if js object.
  const isObject = function(data) {
    return Object.prototype.toString.call(data) === '[object Object]';
  };
  // Sorts given object by its keys.
  const sortObjectByKey = function(obj) {
    const self = this;
    if (!obj) return {};
    return Object.keys(obj).sort().reduce((initialVal, item) => {
      initialVal[item] = !Array.isArray(obj[item]) &&
        typeof obj[item] === 'object'
        ? self.objectByKey(obj[item])
        : obj[item];
      return initialVal;
    }, {});
  };

  // Checks equality of all elements in the input against each other. Returns true | false
  return (
    inputs
      .map(
        input =>
          typeof input == 'undefined'
            ? ''
            : isObject(input)
                ? JSON.stringify(sortObjectByKey(input))
                : JSON.stringify(input)
      )
      .reduce(
        (prevValue, input) =>
          prevValue === '' || prevValue === input ? input : false,
        ''
      ) !== false
  );
};

// Tests (Made with Jest test framework.)
test('String equality check', () => {
  expect(isEqual(['murat'])).toEqual(true);
  expect(isEqual(['murat', 'john', 'doe'])).toEqual(false);
  expect(isEqual(['murat', 'murat', 'murat'])).toEqual(true);
});

test('Float equality check', () => {
  expect(isEqual([7.89, 3.45])).toEqual(false);
  expect(isEqual([7, 7.50])).toEqual(false);
  expect(isEqual([7.50, 7.50])).toEqual(true);
  expect(isEqual([7, 7])).toEqual(true);
  expect(isEqual([0.34, 0.33])).toEqual(false);
  expect(isEqual([0.33, 0.33])).toEqual(true);
});

test('Array equality check', () => {
  expect(isEqual([[1, 2, 3], [1, 2, 3]])).toEqual(true);
  expect(isEqual([[1, 3], [1, 2, 3]])).toEqual(false);
  expect(isEqual([['murat', 18], ['murat', 18]])).toEqual(true);
});

test('Object equality check', () => {
  let obj1 = {
    name: 'murat',
    age: 18
  };
  let obj2 = {
    name: 'murat',
    age: 18
  };
  let obj3 = {
    age: 18,
    name: 'murat'
  };
  let obj4 = {
    name: 'murat',
    age: 18,
    occupation: 'nothing'
  };
  expect(isEqual([obj1, obj2])).toEqual(true);
  expect(isEqual([obj1, obj2, obj3])).toEqual(true);
  expect(isEqual([obj1, obj2, obj3, obj4])).toEqual(false);
});

test('Weird equality checks', () => {
  expect(isEqual(['', {}])).toEqual(false);
  expect(isEqual([0, '0'])).toEqual(false);
}); 
```

[还有一个要点](https://gist.github.com/muratgozel/e916259cea2578bfb8f68cc681b88813)

* * *

## 回答 #77

> 赞同：-2
> 
> 时间：2018-11-24T12:38:46.863

```
 let user1 = {
        name: "John",
        address: {
            line1: "55 Green Park Road",
            line2: {
              a:[1,2,3]
            } 
        },
        email:null
        }

     let user2 = {
        name: "John",
        address: {
            line1: "55 Green Park Road",
            line2: {
              a:[1,2,3]
            } 
        },
        email:null
         }

    // Method 1

    function isEqual(a, b) {
          return JSON.stringify(a) === JSON.stringify(b);
    }

    // Method 2

    function isEqual(a, b) {
      // checking type of a And b
      if(typeof a !== 'object' || typeof b !== 'object') {
        return false;
      }

      // Both are NULL
      if(!a && !b ) {
         return true;
      } else if(!a || !b) {
         return false;
      }

      let keysA = Object.keys(a);
      let keysB = Object.keys(b);
      if(keysA.length !== keysB.length) {
        return false;
      }
      for(let key in a) {
       if(!(key in b)) {
         return false;
       }

       if(typeof a[key] === 'object') {
         if(!isEqual(a[key], b[key]))
           {
             return false;
           }
       } else {
         if(a[key] !== b[key]) {
           return false;
         }
       }
      }

      return true;
    }

console.log(isEqual(user1,user2));
```

* * *

## 回答 #78

> 赞同：-3
> 
> 时间：2013-05-28T15:28:43.953

这是一个非常干净的[CoffeeScript](http://en.wikipedia.org/wiki/CoffeeScript)版本，说明如何做到这一点：

```
Object::equals = (other) ->
  typeOf = Object::toString

  return false if typeOf.call(this) isnt typeOf.call(other)
  return `this == other` unless typeOf.call(other) is '[object Object]' or
                                typeOf.call(other) is '[object Array]'

  (return false unless this[key].equals other[key]) for key, value of this
  (return false if typeof this[key] is 'undefined') for key of other

  true 
```

以下是测试：

```
 describe "equals", ->

    it "should consider two numbers to be equal", ->
      assert 5.equals(5)

    it "should consider two empty objects to be equal", ->
      assert {}.equals({})

    it "should consider two objects with one key to be equal", ->
      assert {a: "banana"}.equals {a: "banana"}

    it "should consider two objects with keys in different orders to be equal", ->
      assert {a: "banana", kendall: "garrus"}.equals {kendall: "garrus", a: "banana"}

    it "should consider two objects with nested objects to be equal", ->
      assert {a: {fruit: "banana"}}.equals {a: {fruit: "banana"}}

    it "should consider two objects with nested objects that are jumbled to be equal", ->
      assert {a: {a: "banana", kendall: "garrus"}}.equals {a: {kendall: "garrus", a: "banana"}}

    it "should consider two objects with arrays as values to be equal", ->
      assert {a: ["apple", "banana"]}.equals {a: ["apple", "banana"]}

    it "should not consider an object to be equal to null", ->
      assert !({a: "banana"}.equals null)

    it "should not consider two objects with different keys to be equal", ->
      assert !({a: "banana"}.equals {})

    it "should not consider two objects with different values to be equal", ->
      assert !({a: "banana"}.equals {a: "grapefruit"}) 
```

# oracle - 通过删除旧行自动执行最大数据库表大小

> ID：201185
> 
> 赞同：2
> 
> 时间：2008-10-14T13:41:41.037
> 
> 标签：oracle

我有一个 Oracle 表，其中包含应用程序的事件日志消息。我们不希望这张表失去控制并占用太多空间，所以我们想将它可以包含的行数设置为一个大数字，比如一百万。

所以我们想告诉Oracle，当表变得太大时，它应该删除最旧的行，为新行腾出空间。

有没有办法做到这一点？我想我们可以通过触发器或使用存储过程进行所有插入来做到这一点，但是有什么更简单的吗？

编辑：有几个答案建议了涉及分区的解决方案。我们目前不对该表进行分区，但如有必要，我们可以这样做。然而，从调查这件事来看，似乎即使我们对表进行分区，我们仍然需要某种计划的作业来删除旧分区等。所以我们决定放弃分区，转而使用计划作业，每天检查一次行数并根据需要删除旧行。

谢谢大家的帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-14T13:52:24.230

根据您对更简单的定义...

我的偏见是安排一个定期（比如每晚）运行的作业，以删除最旧的行。如果您希望在一天内生成一百万个事件日志，您可能希望该作业更频繁地运行，但对于大多数人来说，每晚通常就足够了。这具有异步的优点，因此您不会在每次执行插入以确定是否必须清除某些数据时产生计算一百万行的开销。另一方面，它确实可能需要一些管理来设置工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T14:09:42.870

你有分区选项吗？

如果是这样，这是滚动分区窗口的良好候选者。随着警报日志的老化，您可以删除最旧的分区。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T14:47:15.493

您不能告诉 Oracle 将我的表保持在一定大小。如果这是新闻，那么分区可能不适合您。否则，我会完全同意尼克的观点。

请记住，1M 只是您决定保留的一个神奇数字，如果它在清理发生之前达到 1.1M 就可以了。如果你做滚动分区，你需要放弃你的 1M 号码保留几天。您将每天、每周创建任何分区，并根据您的标准删除最旧的分区。

在您的问题中添加评论以表明您是否有分区。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-16T15:57:06.893

如果你只有几千行，那么简单的删除肯定会起作用。但是，如果您期望增长或已经拥有大量数据，那么分区是您最好的方法。

*   删除可能容易出现撤消空间错误。
*   删除可能容易产生旧错误的快照。
*   删除不会减少表 HWM（高水位线）
*   删除可能需要一段时间，具体取决于数据大小。
*   删除会产生大量重做（取决于您实际删除的数据量）。
*   删除一个分区会产生很少的重做。
*   分区可以改进 Oracle 执行分区消除的一些查询。

我可能错过了一些功能等，分区将非常适合删除数据。它的速度很快，将使您的数据井井有条。并且可扩展到大数据量。

# java - 在 log4j xml 配置中使用系统环境变量

> ID：201188
> 
> 赞同：52
> 
> 时间：2008-10-14T13:42:44.110
> 
> 标签：java, xml, configuration, log4j, environment-variables

是否可以在 log4j xml 配置文件中引用系统环境变量（相对于 Java 系统属性）？

我希望能够做类似的事情：

```
<level value="${env.LOG_LEVEL}" /> 
```

并让它从系统环境变量中获取，这样我就可以避免使用 -D 参数传递这么多东西。

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2008-10-14T14:52:57.307

我最近尝试这样做，但无法正常工作。我最终做的是在启动时发送一个变量。假设你有一个名为 $LOG_LEVEL 的环境变量：

```
<level value="${log_level}" /> 
```

并在启动时...

```
java -Dlog_level=$LOG_LEVEL your_app 
```

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2015-03-29T13:49:03.370

此语法仅记录在 log4j 2.X 中，因此请确保您使用的是正确的版本。它不适用于 1.X 版本。

```
 <Appenders>
    <File name="file" fileName="${env:LOG_PATH}">
        <PatternLayout>
            <Pattern>%d %p %c{1.} [%t] %m %ex%n</Pattern>
        </PatternLayout>
    </File>
</Appenders> 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-15T07:24:32.030

我认为这是不支持的，但基本上你可以做两件事来引入你的环境变量：

1.  在配置 Log4J 之前使用 System.setProperty

2.  将（您的）环境变量转换为启动器中的系统属性

第一个选项基本上可以归结为：

```
for (Map<String,String>.Entry entry : System.getenv().entrySet()) {
  System.setProperty(entry.getKey(), entry.getValue());
} 
```

...但问题当然是把这段代码放在哪里。特别是如果您在某种 Tomcat 容器或类似容器中运行，这可能会很麻烦。

另一个很大程度上取决于您的环境。基本上，如果您有一个启动应用程序的 shell 脚本，您可以编写一些 shell 魔术来将所有环境变量设置为属性，或者只是您需要的那些，例如：

```
java -DMY_ENV=$MY_ENV -DMY_OTHER_ENV=$MY_OTHER_ENV -cp ... com.example.Main 
```

也可以更改您的服务器启动脚本以支持此功能，例如 catalina.sh 或类似文件。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-02-21T15:19:49.037

您需要在 env 和变量名称之间放置一个冒号，如下所示：

```
<level value="${env:LOG_LEVEL}" /> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-02-03T17:19:10.187

创建系统变量。我更喜欢将 setenv.bat 用于此类变量。

```
@echo off
rem app specific log dir
set "APP_LOG_ROOTDIR=../app/app-log"
exit /b 0 
```

在 log4j.xml 文件中添加引用

```
<appender name="fileAppender" class="org.apache.log4j.RollingFileAppender">
  <param name="Threshold" value="DEBUG" />
  <param name="MaxFileSize" value="512KB" />
  <param name="MaxBackupIndex" value="10" />
  <param name="File" value="${APP_LOG_ROOTDIR}/app.log"/>
  <layout class="org.apache.log4j.PatternLayout">
   <param name="ConversionPattern" value="%d %-5p %c{1} %m %n" />
  </layout>
</appender> 
```

# linq-to-sql - 如何在 Linq To SQL 中获取计算列

> ID：201191
> 
> 赞同：2
> 
> 时间：2008-10-14T13:43:26.090
> 
> 标签：linq-to-sql

我们将 Linq To SQL 与我们自己的数据上下文逻辑一起使用，该逻辑在多个数据库中执行一个 linq 查询。当我们得到结果时，我们需要每一行的数据库。所以...

我想在我的类上有一个属性，它将返回数据库名称（SQL Server，所以 DB_NAME()）。如何在 Linq To Sql 中执行此操作？

* * *

戴夫，感谢您的回答，但我们有数百个数据库，如果可能的话，不想添加视图。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T13:52:59.843

LINQ to SQL 允许您将视图和 UDF 映射到对象。创建一个执行 DB_NAME() 并将其作为列返回的 UDF 视图，使用设计器对其进行映射，您应该一切顺利。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T14:10:26.627

将此添加到部分 DataContext 类的手动部分

```
 [Function(Name = "DB_Name", IsComposable = true)]
    public string GetDBName()
    {
        return ((string)(this.ExecuteMethodCall(this, ((MethodInfo)(MethodInfo.GetCurrentMethod()))).ReturnValue));
    } 
```

# mfc - Vista 新功能指南

> ID：201198
> 
> 赞同：4
> 
> 时间：2008-10-14T13:44:54.400
> 
> 标签：mfc, documentation, windows-vista

我是一名 MFC 程序员。我刚刚第一次尝到了 Vista（在 VPC 上……是的，我迟到了）。我应该在未来几天深入评估事情。随便看看，我注意到两个主要变化：

*   外壳是新的
*   用户访问控制
*   事件查看器已更改（希望获得更多信息）

从程序员的角度来看，我还应该注意哪些其他新功能？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-14T14:40:25.473

根据您编写的软件类型，会有大量变化。

查看[Windows 徽标认证（适用于 Vista）](https://winqual.microsoft.com/)绝不是一个坏主意。[此处](http://download.microsoft.com/download/8/e/4/8e4c929d-679a-4238-8c21-2dcc8ed1f35c/Windows%20Vista%20Software%20Logo%20Spec%201.1.doc)有指向软件技术要求的链接。它总是让你知道要避免做什么（以及设计什么）。

在我看来，Vista 大多开始强制执行 [现有的] Logo 认证要求，特别是：

*   不要写信给HKLM*   不要将应用程序数据保存在 Program Files 目录下*   不要假设管理权限*   将数据保存到用户的应用程序数据目录

关于用户访问控制（Vista 的新功能），跨清单文件也是一个好主意。我能在他们身上找到的最好的东西就是这个[博客条目](http://channel9.msdn.com/posts/jmazner/How-To-Tell-Vistas-UAC-What-Privelege-Level-Your-App-Requires/)。

Windows 驱动程序在 Windows Vista 下受到更严格的审查，并且几乎需要认证恕我直言。

TCP/IP 堆栈被重写，音频子系统（和多媒体流等）也被重写。显然在图形方面取得了进步，加上包含 DirectX 10 和通常推出的更新媒体播放器等。

抱歉，我还忘了提到微软在 Vista 中用一个全新的框架取代了 ActiveSync（用于 Windows Mobile）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-14T13:50:45.980

Vista 对执行 XP 应该遵循的规则要严格得多。

例如，您不应该做任何需要对程序的安装文件夹进行写访问的事情。在 XP 中，很多程序员都成功地打破了这一点，因为有太多用户以管理员身份运行，但 Vista 实际上会强制执行它。一堆文件夹确实移动了（“用户”而不是“文档和设置”，我的文档不同等），但是如果您使用正确的方法来检索这些路径而不是假设它们总是在相同的地方你会没事的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-14T13:52:52.560

流程和资源具有“完整性级别”。一个进程只能访问其自身完整性级别或以下的资源。

如果您曾经使用 IE 扩展进行任何工作，当您想要访问某些内容并发现所有内容都具有比 IE 在受保护模式下（默认）更高的完整性级别时，这将成为一个 PITA。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-15T23:48:58.627

Perhaps wikipedia's [Features new to Windows Vista](http://en.wikipedia.org/wiki/Features_new_to_Windows_Vista) and possibly [Features removed from Windows Vista](http://en.wikipedia.org/wiki/Features_removed_from_Windows_Vista) will be of use to you.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-14T13:50:43.437

好吧，从程序员的角度来看，WPF 是“内置”到系统中的。这意味着如果您将应用程序定位到 .NET Framework 的 3.0 版本，它应该能够在没有 .NET Framework 安装的情况下安装在 Vista 上。

DirectX 10 在 Vista 中也是新的，但我假设如果您不知道，您可能不会针对它进行编程。

搜索无处不在。许多内核改进。SuperFetch（如果你有足够的 RAM，那就太棒了）。IMO Vista 比 XP 更容易和更可靠地进入睡眠和唤醒。I/O 优先级——现在像 AntiVirus 和搜索索引器这样的应用程序可以请求比 XP 或以前更低的磁盘访问优先级。当某些东西正在索引驱动器或正在运行扫描时，这使用户体验更加愉快。总而言之，如果你有大量的内存可以扔给它，Vista 是个好东西。我运行带有 4GB RAM 的 Vista x64，我真的很喜欢它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-14T14:01:48.343

音频子系统已经重新开发，所以如果你做任何与音频相关的事情，如果一切仍然正常，值得仔细检查。

尽管许多较旧的 API 调用仍然有效，但有些可能无法按预期工作。

举个简单的例子，声音设备的名称比 XP 中的名称更长且更具描述性，但如果您继续使用旧的 API，您可能会发现这些较长的名称被截断了。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-14T14:22:40.173

哦耶。有一个完全不同的驱动程序模型，其中大部分代码被踢出内核空间并返回到用户空间，以防止不良驱动程序践踏系统。因此，如果您从事任何驱动程序工作，几乎就像从头开始一样。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-14T13:47:52.617

1- 带有 Vista 的机器通常有更多的内存，这对你来说是个好消息 :)

2-“程序文件”的路径分为 2：\Program Files (x86)\ 和 \Program Files\

3- 我的文档已更改

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-14T14:24:11.060

虚拟化也是 vista 的一个有趣且必要的功能。

# asp.net - 如何在工作室中的多个 ASP.Net 项目之间共享内容文件夹？

> ID：201199
> 
> 赞同：4
> 
> 时间：2008-10-14T13:45:02.997
> 
> 标签：asp.net, resources, sharing

我想在解决方案中的多个 asp.net 项目之间共享 2 个内容文件夹（“样式表”和“图形”）。

有没有办法做到这一点并让工作室在设计时适当地显示图形等？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T13:51:14.530

不久前我对此进行了深入研究，发现在 Visual Studio.NET 中没有很好的解决方案。我最终做的是使用我的源代码控制系统来共享文件夹。

我使用 Subversion Externals 从 Subversion 中的单个源共享到多个工作副本。

[http://svnbook.red-bean.com/en/1.1/ch07s04.html](http://svnbook.red-bean.com/en/1.1/ch07s04.html)

我知道 Source Safe 和其他源代码控制系统中也有类似的共享概念。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T13:49:14.050

我还没有尝试过，但我相信如果你在 IIS 中将它设为两个网站的虚拟文件夹，它会在 VS 中正确显示（当然，这意味着使用 IIS 而不是内部的 VS 网络服务器）。

# java - “未找到消息目录”是什么意思？

> ID：201204
> 
> 赞同：1
> 
> 时间：2008-10-14T13:47:01.790
> 
> 标签：java, websphere, message-queue

我有一个在 WebSphere 中运行的 MDB，当它尝试从 MQ 队列中提取消息时，会引发以下异常：

com.ibm.mq.MQException：找不到消息目录

知道如何解决这个问题吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-17T14:31:17.973

将包含**mqji.properties**文件的目录添加到 CLASSPATH

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-15T00:33:41.220

谷歌说这是类路径中错过的条目： [http ://www.mqseries.net/phpBB2/viewtopic.php?t=5979&highlight=mqji](http://www.mqseries.net/phpBB2/viewtopic.php?t=5979&highlight=mqji)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-25T11:43:21.267

由于您将通过消息目录获得的错误消息*也*非常无用，因此这里有一个 mq.jar 的小补丁：

1.  厌烦
2.  拆开 MQException 和 MQInternalException （后者是必需的，因为它继承自 MQException；我们不会更改它）。
3.  将此代码添加到 MQException：

    ```
     // PATCH New fields
        private final static IntHashMap completionCodes = new IntHashMap ();
        private final static IntHashMap reasonCodes = new IntHashMap ();
        static
        {
            addCodes (completionCodes, "MQCC_");
            addCodes (reasonCodes, "MQRC_");
        }

        /**
         * PATCH Create a map of names for the MQ error codes
         * 
         * @param map
         * @param prefix
         */
        private static void addCodes(IntHashMap map, String prefix)
        {
            Field[] field = MQException.class.getFields();

            try
            {
                for (int i = 0; i < field.length; i++)
                {
                    String name = field[i].getName();
                    if (name.startsWith(prefix)) 
                    {
                        name = name.substring(prefix.length());
                        int value = field[i].getInt(null);
                        map.put (value, name);
                    }
                }
            }
            catch (IllegalArgumentException e) {
                throw new RuntimeException (e);
            }
            catch (IllegalAccessException e) {
                throw new RuntimeException (e);
            }
        } 
    ```

4.  替换`getMessage()`为以下代码：

    ```
     // PATCH Complete rewrite
        public String getMessage()
        {
            if(ostrMessage == null) {
                String rc = (String)reasonCodes.get(reasonCode);
                if (rc == null)
                    rc = "ReasonCode "+reasonCode;
                String cc = (String)completionCodes.get(completionCode);
                if (cc == null)
                    cc = "CompletionCode "+completionCode;

                String message = "MQJE001: "+cc+" "+rc;

                if(msgId == 0)
                    ostrMessage = message;
                else {
                    String s = msgId+" {0} {1}";
                    if (exceptionMessages != null) {
                        s = exceptionMessages.getString(Integer.toString(msgId));
                    }
                    if(numInserts > 0) {
                        Object as1[] = new String[numInserts];
                        if(numInserts > 0) as1[0] = insert1;
                        if(numInserts > 1) as1[1] = insert2;
                        s = MessageFormat.format(s, as1);
                    }

                    ostrMessage = message+"\n"+s;
                }

                if (underlyingException != null)
                    ostrMessage = ostrMessage + "\n" + underlyingException.getMessage();
            }

            return ostrMessage;
        } 
    ```

5.  要么将这两个类编译到一个新的 jar 中，要么修补原始的 mq.jar。

而不是 MQJE001: RC 2 CC 2035，你会得到“MQJE001: FAILED NOT_AUTHORIZED”

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-20T10:27:56.743

mqji.properties 文件已包含在 mq jar 文件中。

未找到消息目录异常作为“MQJMS2002：无法从 MQ 队列获取消息”的一部分引发。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-21T08:20:14.647

事实证明，这个错误被抛出是因为我在服务器级别（在 WebSphere v6 服务器上）定义了队列连接工厂，并且使用了错误的类加载器来加载上述属性文件。

我通过在单元级别重新定义工厂解决了这个问题。

# c# - Winforms - 动态加载/保存设置

> ID：201233
> 
> 赞同：1
> 
> 时间：2008-10-14T13:50:51.613
> 
> 标签：c#, winforms, dynamic, settings

我的 Winforms 应用程序中有一个名为 Settings.settings 的“设置文件”，其中包含用于自定义方法等的部分类。有没有办法根据任意键加载/保存动态设置？

例如，我的应用程序中有一些 ListView，我想在其中保存/加载列宽；而不是为每个列表视图的每列创建宽度设置，我想要一个简单的方法来自动加载/保存宽度。

以下是我尝试过的**保存**方法的示例：

```
internal sealed partial class Settings
{
    public void SetListViewColumnWidths(ListView listView)
    {
        String baseKey = listView.Name;
        foreach (ColumnHeader h in listView.Columns)
        {
            String key = String.Format("{0}-{1}", baseKey, h.Index);
            this[key] = h.Width;
        }
    }
} 
```

运行该代码时，我收到错误**“未找到设置属性'TestsListView-0'。”** 有什么我想念的吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-17T10:56:54.630

将列宽设置存储在 Xml 可序列化对象中。即，实现[IXmlSerializable](http://msdn.microsoft.com/en-us/library/system.xml.serialization.ixmlserializable.aspx)然后在 Settings.settings 中创建该类型的单个设置条目。

一个不错的选择可能是 Xml 可序列化字典。一个快速的[谷歌搜索](http://www.google.com.au/search?&q=xml+serializable+dictionary)发现了很多不同的博客文章，描述了如何实现它。

如其他答案所述，您需要确保此对象是用户设置。您可能还需要初始化设置实例。即，创建一个 XmlSerializableDictionary() 实例，如果设置为空，则将其分配给设置。设置子系统不会创建复杂设置对象的默认实例。

此外，如果您希望这些设置在程序集版本之间保持不变（即可升级），您将需要在应用程序启动时升级设置。这在[Miha Markič 的](http://cs.rthand.com/blogs/blog_with_righthand/archive/2005/12/09/246.aspx)博客和[Raghavendra Prabhu 的](http://blogs.msdn.com/rprabhu/articles/433979.aspx)博客中有详细描述。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T14:54:47.270

我认为错误

> 未找到设置属性“键”。

发生是因为您的设置文件中不存在“键”值（相当不言自明）。

据我所知，您无法以编程方式添加设置值，您可能需要研究将所有需要的设置添加到文件中，尽管一旦它们存在，我认为您将能够使用您提供的用于保存更改的代码。

要保存更改，您需要确保它们是“用户”设置，而不是“应用程序”。

设置文件是非常简单的 XML，因此您可以通过将 XML 直接写入文件来解决问题，但我从来没有这样做过，所以不能确定它会起作用，或者一定会推荐这种方法。

[http://msdn.microsoft.com/en-us/library/cftf714c.aspx](http://msdn.microsoft.com/en-us/library/cftf714c.aspx)是 MSDN 链接开始。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T16:45:04.273

您可以对用户设置执行 Settings.Save() 或类似操作，但请注意，此类设置不会像您期望的那样持久保存到应用目录中的 xxx.exe.config 文件中。它们实际上位于用户文件夹的深处（在您的驱动器中搜索 xxx.exe.config 以找到它）。下次您手动更改应用目录中的 xxx.exe.config 时，更改将神秘地不适用（系统仍在使用用户目录中保存的）。

# c# - 将 Active Directory 用户和组导入 SQL Server（可能通过 c#）

> ID：201235
> 
> 赞同：4
> 
> 时间：2008-10-14T13:51:33.263
> 
> 标签：c#, sql-server, active-directory

我需要将几个 OU 中的所有广告组导入 SQL Server 2008 中的表中。一旦有了这些，我需要将这些组的所有成员导入到不同的表中。我可以使用 c# 来完成这项工作并将数据传递给 SQL Server 或直接在 SQL Server 中完成。

有关解决此问题的最佳方法的建议？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-14T13:56:11.210

将链接服务器添加到您的 SQL Server 并通过 LDAP 查询查询 Active Directory。这里很好地描述了这一点：

[创建 AD 用户的 SQL Server 视图，Brendan Tompkins (MVP)](http://codebetter.com/blogs/brendan.tompkins/archive/2003/12/19/4746.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-16T09:27:09.693

阿里，

我不确切知道，但找到了一些可能对您有所帮助的链接。我认为最火的曲目是这样的表达：

```
"(&(objectCategory=Person)(memberOf=DN=GroupName, OU=Org, DC=domain,
DC=com))" 
```

我在ColdFusion 社区站点上的[组成员的 LDAP 查询中找到了它。](http://www.houseoffusion.com/groups/cf-talk/thread.cfm/threadid:55298)我或多或少确定过滤器可以轻松应用于您的查询。对不起，我无法测试它，因为我这里没有广告。

这个也可能有点（但不那么）有趣：

[http://forge.novell.com/pipermail/cldap-dev/2004-April/000042.html](http://forge.novell.com/pipermail/cldap-dev/2004-April/000042.html)

希望这有帮助，干杯，

马蒂亚斯

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-08-16T02:31:49.160

由于这个问题的 OP 似乎对其他技术开放（3 年前），我发布了一个演练，它使用 SSIS 作为为用户查询 AD、将这些用户写入表并对这些用户进行组查找的技术。 [Active Directory SSIS 数据源](http://billfellows.blogspot.com/2011/04/active-directory-ssis-data-source.html) 即使您对 SSIS 不感兴趣，源对象的 LDAP 查询和组成员身份的 C# 对于任何查看此问题的人来说都可能很方便。

# asp.net - 回发时在数据网格中找不到动态控件

> ID：201245
> 
> 赞同：0
> 
> 时间：2008-10-14T13:53:32.013
> 
> 标签：asp.net, datagrid, postback

使用 .NET 1.1，我有一个 DataGrid，每行包含三列。

第一行有一个带有一些文本的标签。

第三行总是有两个单选按钮和两个复选框，它们位于页面的 HTML 端。

第二行将有动态生成的控件（现在只是文本框），每行可以有 1 个或更多。这些将用于用户输入。

页面上有一个按钮，当用户单击该按钮时，我需要使用用户输入的新值更新 DataGrid 的源（我的 DataTable）。

问题是 DataGrid 似乎正在丢失 PostBack 上动态生成的控件。我可以遍历 DataGrid 中的每个项目，并且可以访问单选按钮和复选框，但文本框不存在。

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-14T13:57:45.357

请记住：每次回发发生时，您都在使用页面类的*新实例*。在上一次回发期间添加到页面的动态控件会在该回发的页面呈现给浏览器后立即与该页面实例的其余部分一起进入垃圾收集器。您需要在每次回发时重新创建动态控件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T14:00:03.183

您必须重新生成控件。您应该能够从 http 请求对象中获取它们的值

# c# - MarshalAsAttribute Sizeconst .NET

> ID：201255
> 
> 赞同：1
> 
> 时间：2008-10-14T13:56:41.430
> 
> 标签：c#, .net, marshalling

使用 C#，有谁知道如何在运行时获取 MarshalAsAttribute 的 Sizeconst 值？

例如。我想检索 10 的值。

```
[StructLayout[LayoutKind.Sequential, Pack=1]
Class StructureToMarshalFrom
{
    [MarshalAs(UnmanagedType.ByValArray, SizeConst = 10)]
    public byte[] _value1;
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-14T13:59:59.083

是的，有反思：

```
FieldInfo field = typeof(StructureToMarshalFrom).GetField("_value1");
object[] attributes = field.GetCustomAttributes(typeof(MarshalAsAttribute), false);
MarshalAsAttribute marshal = (MarshalAsAttribute) attributes[0];
int sizeConst = marshal.SizeConst; 
```

（未经测试，显然缺乏很多错误检查，但应该可以。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T14:07:25.870

```
var x = new StructureToMarshalFrom();
var fields = x.GetType().GetFields();

var att = (MarshalAsAttribute[])fields[0].GetCustomAttributes(typeof(MarshalAsAttribute), false);
if (att.Length > 0) {
    Console.WriteLine(att[0].SizeConst);
} 
```

# excel - 使 Excel 函数影响“其他”单元格

> ID：201261
> 
> 赞同：4
> 
> 时间：2008-10-14T13:58:30.147
> 
> 标签：excel, formula, vba

假设我创建了一个 Sub（不是函数），它的生命任务是获取活动单元格（即选择）并将相邻单元格设置为某个值。这工作正常。

当您尝试将该 Sub 转换为函数并尝试从电子表格中对其进行评估时（即将其公式设置为“=MyFunction()”），Excel 会因为您试图影响非活动的值而咆哮单元格，并简单地强制函数返回#VALUE而不接触相邻的单元格。

是否可以关闭这种保护行为？如果没有，有什么好办法绕过它？如果可能的话，我正在寻找一个有能力的开发人员可以在 1-2 周内完成的事情。

问候，艾伦。

注意：我使用的是 2002，所以我更喜欢适用于该版本的解决方案。话虽如此，如果未来的版本使这变得更加容易，我也想知道它。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-14T16:42:33.933

它不能完成，这是有道理的，因为：

*   调用工作表函数时，包含该函数的单元格不一定是活动单元格。所以你不能可靠地找到相邻的单元格。

*   Excel 在重新计算工作表时，需要维护单元格之间的依赖关系。所以它不能允许工作表函数任意修改其他单元格。

您可以做的最好的事情是其中之一：

*   处理 SheetChange 事件。如果包含您的函数的单元格正在更改，请修改相邻的单元格。

*   在相邻单元格中放置一个工作表函数以返回您想要的值。

**更新**

关于评论：“我希望这个函数在'空白'电子表格上工作，所以我不能真正依赖可能尚不存在但需要调用此函数的电子表格的 SelectionChange 事件”：

*   你能把你的函数放在 XLA 插件中吗？那么您的 XLA 加载项可以处理在该 Excel 实例中打开的所有工作簿的 Application SheetChange (*) 事件吗？

关于评论：“不过，如果您将 Excel 保持在 CalculationMode = xlManual 并仅填写值，您应该没问题”

*   即使 CalculationMode 为 xlManual，Excel 也需要维护单元格之间引用的依赖树，以便它可以按正确的顺序进行计算。如果其中一个函数可以更新任意单元格，这将打乱顺序。这大概就是 Excel 施加此限制的原因。

(*) 我最初在上面写了 SelectionChange，现在更正了 - 当然，正确的事件是工作簿或应用程序对象的 SheetChange，或者工作表对象的 Change。

**更新 2** [AlanR 的帖子](https://stackoverflow.com/questions/201261/making-excel-functions-affect-other-cells#208592) 上的一些评论描述了如何“有点”使用计时器使其工作：

*   目前尚不清楚计时器功能（“Woohoo”）如何知道要更新哪些单元格。您没有任何信息表明哪个单元格包含触发计时器的公式。

*   如果公式存在于多个单元格中（在相同或不同的工作簿中），则在重新计算期间将多次调用 UDF，覆盖 timerId。结果，您将无法可靠地销毁计时器，并且会泄漏 Windows 资源。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T15:05:41.633

我正在使用 Excel 2007，但它不起作用。Excel 提到它会创建一个循环引用。我认为您不能从函数中更改其他单元格，而只能返回一个值。

这是一种函数式编程，没有副作用。如果您只能更改函数内的其他单元格（从工作表中使用），那么 Excel 将无法知道顺序以及在单元格更改时要重新计算的内容。

[本文](http://msdn.microsoft.com/nl-be/library/bb687891(en-us).aspx)还包含大量有关 Excel 如何重新计算的信息。但它从来没有说其他细胞是冷冻的。

我不知道您要做什么，但是，您为什么不在相邻单元格中放置另一个函数，它将第一个单元格作为参数？

例子：

```
Public Function Bar(r As Range) As Integer
  If r.Value = 2 Then
    Bar = 0
  Else
    Bar = 128
  End If
End Function 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-14T16:09:01.863

根据[如何创建自定义用户定义的 Excel 函数](http://www.vertex42.com/ExcelArticles/user-defined-functions.html "如何创建自定义用户定义的 Excel 函数")：

> UDF 的局限性
> 
> *   不能在包含公式的单元格（或区域）以外的单元格中放置值。换句话说，UDF 旨在用作“公式”，而不一定是“宏”。

所以，看起来是做不到的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-16T13:37:02.747

谢谢大家的回复。有可能做到这一点！有点。我说“有点”是因为从技术上讲，“功能”不会影响它周围的细胞。然而，实际上，没有用户能分辨出其中的区别。

诀窍是使用 Win32 API 来启动计时器，一旦它关闭，您就可以对任何单元格执行您想要的操作并关闭计时器。

现在我不是 COM 线程如何工作的专家（尽管我知道 VBA 是单单元线程），但要小心你的 Timer 与你的 Excel 进程一起运行并使其崩溃。这真的不是我建议作为所有其他电子表格的解决方案。

只需使用以下内容制作一个模块：

```
Option Explicit

Declare Function SetTimer Lib "user32" (ByVal HWnd As Long, _
  ByVal IDEvent As Long, ByVal mSec As Long, _
  ByVal CallFunc As Long) As Long

Declare Function KillTimer Lib "user32" (ByVal HWnd As Long, _
  ByVal timerId As Long) As Long

Private timerId As Long

Private wb As Workbook
Private rangeName As String
Private blnFinished As Boolean

Public Sub RunTimer()

    timerId = SetTimer(0, 0, 10, AddressOf Woohoo)

End Sub

Public Sub Woohoo()

    Dim i As Integer

'    For i = 0 To ThisWorkbook.Names.Count - 1
'        ThisWorkbook.Names(i).Delete
'    Next

     ThisWorkbook.Worksheets("Sheet1").Range("D8").Value = "Woohoo"

     KillTimer 0, timerId

End Sub 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-27T17:07:50.727

虽然您不能在 Excel 中执行此操作，但在[Resolver One](http://www.resolversystems.com)中是可能的（尽管这仍然是一件很奇怪的事情）。

这是一个电子表格，允许您在 Python 中定义自定义函数，然后您可以从网格中的单元格公式调用这些函数。

作为您所要求的示例，您可能想要定义一个`safeDivide`函数（而不是引发 a `ZeroDivisionError`）通过着色分母单元格并在其旁边放置一条错误消息来告诉您问题。你可以这样定义它：

```
def safeDivide(numerator, cellRange):
    if not isinstance(cellRange, CellRange):
        raise ValueError('denominator must be a cell range')
    denominator = cellRange.Value
    if denominator == 0:
        cell = cellRange.TopLeft
        cell.BackColor = Color.Red
        cell.Offset(1, 0).Value = 'Tried to divide by zero'
        return 0
    return numerator / denominator 
```

还有一个额外的问题：传递单元格的函数只是传递了单元格值，因此为了解决这个问题，我们坚持传递一个单元格单元格范围作为分母。

如果您尝试使用不太适合 Excel 的电子表格做一些不寻常的事情，或者您有兴趣使用 Python 的强大功能来处理电子表格数据，那么值得一看 Resolver One。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-06T22:51:40.640

这是一个简单的 VBA 解决方法。对于此示例，打开一个新的 Excel 工作簿并将以下代码复制到`Sheet1`（不是`ThisWorkbook`VBA `Module`）的代码区域中。然后进入`Sheet1`并将一些东西放入工作表左上角的单元格之一。如果您输入一个数字并按 Enter，则右侧的单元格将更新为该数字的 4 倍，并且单元格背景将变为浅蓝色。任何其他值都会导致下一个单元格被清除。这是代码：

```
Dim busy As Boolean
Private Sub Worksheet_Change(ByVal Target As Range)
  If busy Then Exit Sub
  busy = True
  If Target.Row <= 10 And Target.Column <= 10 Then
    With Target.Offset(0, 1)
      If IsNumeric(Target) Then
        .Value = Target * 4
        .Interior.Color = RGB(212, 212, 255)
      Else
        .Value = Empty
        .Interior.ColorIndex = xlColorIndexNone
      End If
    End With
  End If
  busy = False
End Sub 
```

该子例程捕获工作表中的所有单元格更改事件。如果行和列都<= 10，则右侧的单元格设置为更改后的单元格的4倍（如果值为数字）；否则右边的单元格被清除。

# ms-access - 如何从 MS Access 数据库中获取表名？

> ID：201282
> 
> 赞同：38
> 
> 时间：2008-10-14T14:04:08.573
> 
> 标签：ms-access

Microsoft SQL Server 和 MySQL 有一个我可以查询的 INFORMATION_SCHEMA 表。但是它不存在于 MS Access 数据库中。

有没有我可以使用的等价物？

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2008-10-14T19:40:37.583

要以 Ilya 的回答为基础，请尝试以下查询：

```
SELECT MSysObjects.Name AS table_name
FROM MSysObjects
WHERE (((Left([Name],1))<>"~") 
        AND ((Left([Name],4))<>"MSys") 
        AND ((MSysObjects.Type) In (1,4,6)))
order by MSysObjects.Name 
```

（这个无需修改即可使用 MDB）

ACCDB 用户可能需要做这样的事情

```
SELECT MSysObjects.Name AS table_name
FROM MSysObjects
WHERE (((Left([Name],1))<>"~") 
        AND ((Left([Name],4))<>"MSys") 
        AND ((MSysObjects.Type) In (1,4,6))
        AND ((MSysObjects.Flags)=0))
order by MSysObjects.Name 
```

由于包含一个额外的表，它似乎是某种系统表。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-14T18:38:44.527

您可以在 Access 中使用架构。

```
Sub ListAccessTables2(strDBPath)
   Dim cnnDB As ADODB.Connection
   Dim rstList As ADODB.Recordset

   Set cnnDB = New ADODB.Connection

   ' Open the connection.
   With cnnDB
      .Provider = "Microsoft.Jet.OLEDB.4.0"
      .Open strDBPath
   End With

   ' Open the tables schema rowset.
   Set rstList = cnnDB.OpenSchema(adSchemaTables)

   ' Loop through the results and print the
   ' names and types in the Immediate pane.
   With rstList
      Do While Not .EOF
         If .Fields("TABLE_TYPE") <> "VIEW" Then
            Debug.Print .Fields("TABLE_NAME") & vbTab & _
               .Fields("TABLE_TYPE")
         End If
         .MoveNext
      Loop
   End With
   cnnDB.Close
   Set cnnDB = Nothing
End Sub 
```

来自： http: [//msdn.microsoft.com/en-us/library/aa165325 (office.10).aspx](http://msdn.microsoft.com/en-us/library/aa165325(office.10).aspx)

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2012-04-12T21:41:48.467

这是使用数据访问对象 (DAO) 在 Access 2010 VBA 中工作的更新答案。表的名称保存在 TableDef.Name 中。所有表定义的集合都保存在 TableDefs 中。这是一个遍历表名的快速示例：

```
Dim db as Database
Dim td as TableDef
Set db = CurrentDb()
For Each td In db.TableDefs
  YourSubTakingTableName(td.Name)
Next td 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-14T14:44:10.037

设计为非常接近 SQL-92 INFORMATION_SCHEMA 的架构信息可以通过 OLE DB 提供程序为 Jet/ACE 引擎（我假设您的意思是“访问”）获得。

看：

[OpenSchema 方法 (ADO)](http://msdn.microsoft.com/en-us/library/aa704826.aspx)

[支持的架构行集](http://msdn.microsoft.com/en-us/library/ms723054(VS.85).aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-14T14:08:53.137

获取表格列表：

```
SELECT 
    Table_Name = Name, 
FROM 
    MSysObjects 
WHERE 
    (Left([Name],1)<>"~") 
    AND (Left([Name],4) <> "MSys") 
    AND ([Type] In (1, 4, 6)) 
ORDER BY 
    Name 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-10-11T12:07:58.710

```
SELECT 
Name 
FROM 
MSysObjects 
WHERE 
(Left([Name],1)<>"~") 
AND (Left([Name],4) <> "MSys") 
AND ([Type] In (1, 4, 6)) 
ORDER BY 
Name 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-04-17T21:42:26.910

最好不要弄乱 msysObjects (恕我直言)。

```
CurrentDB.TableDefs
CurrentDB.QueryDefs
CurrentProject.AllForms
CurrentProject.AllReports
CurrentProject.AllMacros 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-07-29T18:13:19.637

我需要稍微修改 BIBD 发布的 SQL（需要通过在 from 子句中将 sys. 添加到 MSysObjects 来完全质量表名。

```
 String sqlString = "";
        sqlString += "SELECT MSysObjects.Name AS table_name \n";
        sqlString += "FROM sys.MSysObjects \n";
        sqlString += "WHERE (((Left([Name],1))<>\"~\")  \n";
        sqlString += "        AND ((Left([Name],4))<>\"MSys\")  \n";
        sqlString += "        AND ((MSysObjects.Type) In (1,4,6)) \n";
        sqlString += "        AND ((MSysObjects.Flags)=0)) \n";
        sqlString += "order by MSysObjects.Name \n"; 
```

完整的工作示例可在[https://github.com/NACHC-CAD/access-to-csv-tool](https://github.com/NACHC-CAD/access-to-csv-tool)获得。此示例还显示了使用 jdbc 连接到 MS Access 数据库并使用 Apache Commons CSV 将所有表导出为 csv。

# java - 如何获取从 ButtonGroup 中选择的 JRadioButton

> ID：201287
> 
> 赞同：84
> 
> 时间：2008-10-14T14:05:47.370
> 
> 标签：java, swing

我有一个摆动应用程序，其中包括表单上的单选按钮。我有`ButtonGroup`，但是，查看可用的方法，我似乎无法获得选定的名称`JRadioButton`。到目前为止，这是我能说的：

*   从 ButtonGroup，我可以执行 a`getSelection()`以返回`ButtonModel`. 从那里，我可以执行 a `getActionCommand`，但这似乎并不总是有效。我尝试了不同的测试并得到了不可预测的结果。

*   同样从`ButtonGroup`，我可以从`getElements()`. 但是，然后我将不得不遍历每个按钮，以检查它是否是选定的。

有没有更简单的方法来找出选择了哪个按钮？我在 Java 1.3.1 和 Swing 中对此进行了编程。

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2012-11-05T13:08:42.860

我遇到了类似的问题并解决了这个问题：

```
import java.util.Enumeration;
import javax.swing.AbstractButton;
import javax.swing.ButtonGroup;

public class GroupButtonUtils {

    public String getSelectedButtonText(ButtonGroup buttonGroup) {
        for (Enumeration<AbstractButton> buttons = buttonGroup.getElements(); buttons.hasMoreElements();) {
            AbstractButton button = buttons.nextElement();

            if (button.isSelected()) {
                return button.getText();
            }
        }

        return null;
    }
} 
```

它返回所选按钮的文本。

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2008-10-14T14:12:36.560

我会遍历你的`JRadioButtons`并调用`isSelected()`. 如果您真的想从模型出发，`ButtonGroup`您只能获得模型。您可以将模型与按钮相匹配，但是如果您可以访问按钮，为什么不直接使用它们呢？

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2014-08-11T15:11:11.990

您必须添加`setActionCommand`到`JRadioButton`then just do：

```
String entree = entreeGroup.getSelection().getActionCommand(); 
```

**例子：**

```
java = new JRadioButton("Java");
java.setActionCommand("Java");
c = new JRadioButton("C/C++");
c.setActionCommand("c");
System.out.println("Selected Radio Button: " + 
                    buttonGroup.getSelection().getActionCommand()); 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-14T15:34:57.067

我建议直接使用 Swing 中的模型方法。将组件放入面板和布局管理器后，甚至不必费心保留对它的特定引用。

如果你真的想要这个小部件，那么你可以用 测试每个`isSelected`，或者维护一个`Map<ButtonModel,JRadioButton>`.

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2016-06-14T03:27:33.183

您可以将 actionCommand 放到每个单选按钮（字符串）中。

```
this.jButton1.setActionCommand("dog");
this.jButton2.setActionCommand("cat");
this.jButton3.setActionCommand("bird"); 
```

假设它们已经在 ButtonGroup 中（在这种情况下为 state_group），您可以像这样获得选定的单选按钮：

```
String selection = this.state_group.getSelection().getActionCommand(); 
```

希望这可以帮助

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-01-20T17:43:37.253

以下代码显示在单击按钮时**从 Buttongroup 中选择了哪个 JRadiobutton。**
它是通过循环访问特定按钮组中的所有 JRadioButton 来完成的。

```
 JRadioButton firstRadioButton=new JRadioButton("Female",true);  
 JRadioButton secondRadioButton=new JRadioButton("Male");  

 //Create a radio button group using ButtonGroup  
 ButtonGroup btngroup=new ButtonGroup();  

 btngroup.add(firstRadioButton);  
 btngroup.add(secondRadioButton);  

 //Create a button with text ( What i select )  
 JButton button=new JButton("What i select");  

 //Add action listener to created button  
 button.addActionListener(this);  

 //Get selected JRadioButton from ButtonGroup  
  public void actionPerformed(ActionEvent event)  
  {  
     if(event.getSource()==button)  
     {  
        Enumeration<AbstractButton> allRadioButton=btngroup.getElements();  
        while(allRadioButton.hasMoreElements())  
        {  
           JRadioButton temp=(JRadioButton)allRadioButton.nextElement();  
           if(temp.isSelected())  
           {  
            JOptionPane.showMessageDialog(null,"You select : "+temp.getText());  
           }  
        }            
     }
  } 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2020-04-01T11:58:39.773

通常，需要一些与所选单选按钮关联的对象。它不一定是`String`代表按钮的标签。它可能是一个`Integer`包含按钮的索引或更复杂类型的对象`T`。`Map<ButtonModel, T>`您可以按照*Tom Hawtin*的建议填充和使用 a ，但我建议扩展模型并将对象放在那里。这`ButtonGroup`是使用这种方法的改进。

```
import javax.swing.*;

@SuppressWarnings("serial")
public class SmartButtonGroup<T> extends ButtonGroup {
    @Override
    public void add(AbstractButton b) {
        throw new UnsupportedOperationException("No object supplied");
    }

    public void add(JRadioButton button, T attachedObject) {
        ExtendedModel<T> model = new ExtendedModel<>(attachedObject);
        model.setSelected(button.isSelected());
        button.setModel(model);
        super.add(button);
    }

    @SuppressWarnings("unchecked")
    public T getSelectedObject() {
        ButtonModel selModel = getSelection();
        return selModel != null ? ((ExtendedModel<T>)selModel).obj : null;
    }

    public static class ExtendedModel<T> extends javax.swing.JToggleButton.ToggleButtonModel {
        public T obj;

        private ExtendedModel(T object) {
            obj = object;
        }
    }
} 
```

您可以使用此实用程序类而不是`ButtonGroup`. 创建该类的对象并向其添加按钮以及相关对象。例如，

```
SmartButtonGroup<Integer> group = new SmartButtonGroup<>();
JPanel panel = new JPanel();

for (int i = 1; i <= 5; i++) {
    JRadioButton button = new JRadioButton("Button #" + i, i == 3); // select the 3rd button
    group.add(button, i);
    panel.add(button);
} 
```

在此之后，您可以随时通过简单地调用来获取与当前选定按钮关联的对象`getSelectedObject()`，如下所示：

```
int selectedButtonIndex = group.getSelectedObject(); 
```

如果您只需要按钮本身，则可以使用下一个非泛型类。

```
import javax.swing.JRadioButton;

@SuppressWarnings("serial")
public class RadioButtonGroup extends SmartButtonGroup<JRadioButton> {
    public void add(JRadioButton button) {
        super.add(button, button);
    }

    @Override
    public void add(JRadioButton button, JRadioButton attachedObject) {
        throw new UnsupportedOperationException("Use the short form of addition instead");
    }

    public JRadioButton getSelectedButton() {
        return getSelectedObject();
    }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-14T14:20:30.740

您可以使用 ItemSelectable（ButtonModel 的超接口）的 getSelectedObjects()，它返回所选项目的列表。在单选按钮组的情况下，它只能是一个或根本没有。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-11-28T11:39:52.233

然后将单选按钮添加到按钮组：

buttonGroup.getSelection().getActionCommand

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-05-14T13:04:41.537

```
import javax.swing.Action;
import javax.swing.ButtonGroup;
import javax.swing.Icon;
import javax.swing.JRadioButton;
import javax.swing.JToggleButton;

public class RadioButton extends JRadioButton {

    public class RadioButtonModel extends JToggleButton.ToggleButtonModel {
        public Object[] getSelectedObjects() {
            if ( isSelected() ) {
                return new Object[] { RadioButton.this };
            } else {
                return new Object[0];
            }
        }

        public RadioButton getButton() { return RadioButton.this; }
    }

    public RadioButton() { super(); setModel(new RadioButtonModel()); }
    public RadioButton(Action action) { super(action); setModel(new RadioButtonModel()); }
    public RadioButton(Icon icon) { super(icon); setModel(new RadioButtonModel()); }
    public RadioButton(String text) { super(text); setModel(new RadioButtonModel()); }
    public RadioButton(Icon icon, boolean selected) { super(icon, selected); setModel(new RadioButtonModel()); }
    public RadioButton(String text, boolean selected) { super(text, selected); setModel(new RadioButtonModel()); }
    public RadioButton(String text, Icon icon) { super(text, icon); setModel(new RadioButtonModel()); }
    public RadioButton(String text, Icon icon, boolean selected) { super(text, icon, selected); setModel(new RadioButtonModel()); }

    public static void main(String[] args) {
        RadioButton b1 = new RadioButton("A");
        RadioButton b2 = new RadioButton("B");
        ButtonGroup group = new ButtonGroup();
        group.add(b1);
        group.add(b2);
        b2.setSelected(true);
        RadioButtonModel model = (RadioButtonModel)group.getSelection();
        System.out.println(model.getButton().getText());
    }
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-08-11T14:08:40.373

使用`isSelected()`方法。它会告诉您 radioButton 的状态。将它与循环（比如 for 循环）结合使用，您可以找到选择了哪一个。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-03-24T19:15:20.113

```
import java.awt.*;
import java.awt.event.*;
import javax.swing.*; 
public class MyJRadioButton extends JFrame implements ActionListener
{
    JRadioButton rb1,rb2;  //components
    ButtonGroup bg;
    MyJRadioButton()
{
    setLayout(new FlowLayout());
    setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);

    rb1=new JRadioButton("male");
    rb2=new JRadioButton("female");

    //add radio button to button group
    bg=new ButtonGroup();
    bg.add(rb1);
    bg.add(rb2);

    //add radio buttons to frame,not button group
    add(rb1);
    add(rb2);
    //add action listener to JRadioButton, not ButtonGroup
    rb1.addActionListener(this);
    rb2.addActionListener(this);
    pack();
    setVisible(true);
}
public static void main(String[] args)
{
    new MyJRadioButton(); //calling constructor
}
@Override
public void actionPerformed(ActionEvent e) 
{
    System.out.println(((JRadioButton) e.getSource()).getActionCommand());
} 
```

}

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-05-14T16:09:55.687

Ale Rojas 的回答很好：

作为替代方案，您也可以`My_JRadiobutton11.addActionListener(this);`在 JButton 上使用，然后像这样在 actionPerformed 函数中执行操作（它只使用一个您必须实例化的额外变量（例如私有字符串选择；），但这没什么大不了的）：

```
public void actionPerformed(ActionEvent arg0) {
      if(arg0.getSource() == My_JRadiobutton11){
          //my selection
          selection = "Become a dolphin";
      }else if(arg0.getSource() == My_JRadiobutton12){
          //my selection
          selection = "Become a Unicorn";
      } ..etc 
 } 
```

* * *

## 回答 #14

> 赞同：-3
> 
> 时间：2008-10-14T14:36:51.503

```
jRadioOne = new javax.swing.JRadioButton();
jRadioTwo = new javax.swing.JRadioButton();
jRadioThree = new javax.swing.JRadioButton(); 
```

...然后对于每个按钮：

```
buttonGroup1.add(jRadioOne);
jRadioOne.setText("One");
jRadioOne.setActionCommand(ONE);
jRadioOne.addActionListener(radioButtonActionListener); 
```

...听众

```
ActionListener radioButtonActionListener = new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                radioButtonActionPerformed(evt);
            }
        }; 
```

...做任何你需要的作为对事件的回应

```
protected void radioButtonActionPerformed(ActionEvent evt) {            
       System.out.println(evt.getActionCommand());
    } 
```

# oracle - 坏字符和 sql*loader

> ID：201288
> 
> 赞同：0
> 
> 时间：2008-10-14T14:06:17.727
> 
> 标签：oracle, sql-loader

使用 sqlloader 插入时如何找出错误字符（不支持，例如 Ω）？或列出恶意字符以避免垃圾数据？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T22:49:20.253

我不认为我理解这个问题。这是否：[http](http://www.akadia.com/services/ora_sql_loader_utf8.html) ://www.akadia.com/services/ora_sql_loader_utf8.html提供了答案？

此外，您还可以查看适用于您的 Oracle 版本的 Oracle® 数据库全球化支持指南：[http](http://www.oracle.com/technology/documentation/index.html) ://www.oracle.com/technology/documentation/index.html 。

# sql-server - 将数据库列表限制为具有 SQL Server 权限的列表

> ID：201292
> 
> 赞同：4
> 
> 时间：2008-10-14T14:08:24.540
> 
> 标签：sql-server, ssms, database-permissions, database-security

默认情况下，如果您通过有权访问 10 个数据库中的 1 个的帐户连接到远程 SQL Server。您仍然会在对象资源管理器中看到所有其他数据库，显然由于权限您无法实际查询它们，但您可以看到它们的名称。

我听说有一种方法可以禁用此行为，但我一直无法找到答案，有人知道该怎么做吗？举个例子，我有一个名为 MyDbServer 的 SQL Server，它有 4 个数据库，

1.  我的数据库
2.  你的数据库
3.  私有数据库
4.  真正的私人数据库

如果您通过仅具有“YourDatabse”权限的帐户连接，您仍将看到所有其他数据库的列表，尝试查询将授予“选择”权限被拒绝或类似错误。

出于安全考虑，我们不希望用户看到他们映射到的数据库以外的任何数据库。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T14:13:18.930

[这篇博客](https://web.archive.org/web/20061014155556/http://blogs.msdn.com/euanga/archive/2006/05/04/585513.aspx)讨论了隐藏 SQL 2000 和 SQL 2005 数据库的方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-15T21:19:38.350

在让我的客户与确定的资源斗争后，我进行了一些测试并创建了[这篇博客文章](https://web.archive.org/web/20081019021936/http://www.mitchelsellers.com/blogs/articletype/articleview/articleid/260/limit-sql-server-database-list.aspx)，其中包含更多上下文和关于如何使其工作的说明。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T14:17:39.500

它的短处是：

```
use master
go
deny VIEW any DATABASE to login1
go 
```

其中 login1 是您要限制的登录帐户。

# c# - 在 Windows 上挂载/卸载 USB 磁盘

> ID：201300
> 
> 赞同：3
> 
> 时间：2008-10-14T14:09:50.340
> 
> 标签：c#, windows, usb

在 Windows Server 上，默认情况下，外部 USB 磁盘并不总是被挂载。我希望我的程序（用 C# 编写）能够检测外部 USB 磁盘，识别它们，然后挂载它们。

完成后，它应该执行任何与“安全删除硬件”等效的程序，以刷新和卸载磁盘。

任何指针？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2019-10-13T08:50:59.293

您正在搜索功能[SetVolumeMountPointA](https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-setvolumemountpointa)和[DeleteVolumeMountPointW](https://docs.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-deletevolumemountpointw)。

为了找到卷，您可以使用[FindFirstVolumeW](https://docs.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-findfirstvolumew)和[FindNextVolumeW](https://docs.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-findnextvolumew)。

# java - 在 java String.format 中转义格式化字符

> ID：201312
> 
> 赞同：23
> 
> 时间：2008-10-14T14:12:34.937
> 
> 标签：java, string, string.format

这个问题与这个针对 java的[.Net 问题](https://stackoverflow.com/questions/91362/how-to-escape-brackets-in-a-format-string-in-net)几乎相同。

如何转义`%1$`java 中的字符`String.format`？

我需要这样做的原因是我正在构建一个字符串，稍后将在其中插入更多信息。我曾想过让其中一个 args 成为`"%1$"`，但这似乎不是很优雅？

抱歉，如果这很明显，我的 java 有点生锈了。

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2008-10-14T14:14:37.633

您可以将 % 翻倍

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T14:43:21.943

要么你可以使用 Draemon 的提议，要么你也可以看看[java.text.MessageFormat 类](http://java.sun.com/j2se/1.5.0/docs/api/java/text/MessageFormat.html)，它的格式化能力比 String.format() 更强大

# javascript - jQuery中最近的祖先节点

> ID：201314
> 
> 赞同：15
> 
> 时间：2008-10-14T14:12:40.210
> 
> 标签：javascript, jquery, dom

在我的 javascript 经验中，我发现这是一个非常常见的任务“搜索具有某种条件的元素的最近祖先（标签名称，类，...）”。jquery 的 parents() 方法可以完成这项工作吗？parents() 的返回元素的顺序是可预测的吗？是自上而下还是自下而上？目前我使用这个实用功能：

```
function ancestor(elem, selector) {
  var $elem = $( elem ).parent();
  while( $elem.size() > 0 ) {
    if( $elem.is( selector ) ) 
    return $elem;
    else
       $elem = $elem.parent();
  }
  return null;
} 
```

有人能告诉我是否有一种聪明的方法来完成这项工作吗？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-14T14:16:45.133

**编辑**：自 jQuery 1.3 以来，这已作为[`closest()`](http://api.jquery.com/closest)函数内置。例如：`$('#foo').closest('.bar');`

* * *

是的 - parents() 遍历树。

```
<div id="a">
    <div id="b">
        <p id="c">
            <a id="d"></a>
        </p>
    </div>
</div> 
```

`$('#d').parents("div:first");`将选择 div b。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-06-03T13:29:39.870

*添加到@ [nickf](https://stackoverflow.com/users/9021/nickf)的答案：*

jQuery 1.3 用`closest`.

给定一个 DOM：

```
<div id="a">
    <div id="b">
        <p id="c">
            <a id="d"></a>
        </p>
    </div>
</div> 
```

你可以做：

```
$('#d').closest("div"); // returns [ div#b ] 
```

> [ [Closest](http://docs.jquery.com/Traversing/closest)返回] 一组元素，其中包含与指定选择器匹配的最接近的父元素，包括起始元素。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-08-05T19:31:46.470

您应该使用`closest`, 因为`parents`如果您使用多个元素，它不会给您预期的结果。例如，假设你有这个：

```
 <div id="0">
        <div id="1">test with <b>nested</b> divs.</div>
        <div id="2">another div.</div>
        <div id="3">yet <b>another</b> div.</div>
    </div> 
```

并且您想将一个类添加到将`<b>`元素作为其直接子元素（即 1 和 3）的 div 中。如果你使用`$('b').parents('div')`，你会得到 div 0、1 和 3。如果你使用`$('b').parents('div:first')`，你只会得到 div 1。要得到 1 和 3，而不是 0，你必须使用`$('b').closest(elem)`。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-07-22T14:54:47.833

Closest() 从当前元素开始，如果您要查找的父元素与当前元素具有相同的标签（例如，两者都是 div），请使用 parent().closest()

# c# - 您将如何使用 .Net 2.0 通知客户有关服务器上更改的数据的信息？

> ID：201317
> 
> 赞同：0
> 
> 时间：2008-10-14T14:12:50.290
> 
> 标签：c#, .net, events, remoting, client-server

想象一个 WinForms 客户端应用程序，它显示相当复杂的计算数据，该数据是通过 HTTPChannel 使用 .Net Remoting 从服务器应用程序获取的。
由于客户端应用程序可能运行一整个工作日，我需要一种方法来通知客户端新数据可用，以便用户能够在需要时重新加载数据。
目前我正在使用远程 .Net 事件，将事件序列化到客户端，然后在客户端重新抛出事件。

我对这个设置不太满意，并计划重新实现它。
对我来说重要的是：

*   基于 .Net 2.0 的技术
*   易于使用
*   低复杂度
*   足够强大，可以在服务器或客户端重新启动后仍然有效

当仅限于 .Net 2.0 时，您将如何实现这样的功能？你会使用什么技术/库？
我正在寻找如何解决问题的灵感。

编辑：

客户端和服务器存在于同一个组织中，通常是 LAN，可能是 WAN/VPN 情况。
这种机制应该只让客户端知道有新数据可用。我想继续远程处理以将实际数据发送给客户端，因为它运行良好。MSMQ 带有 windows，不是吗？所以使用它应该没问题，但我愿意接受任何替代方案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T14:23:49.440

我已经使用 MSMQ 实现了类似的通知机制。客户端机器打开一个本地的公共队列，然后将它的队列名称通知服务器。当发生更改时，服务器会将通知推送到它知道的所有客户端队列中。这样客户端就会知道数据已经准备好了，即使在发送通知时它没有运行。

唯一的缺点是它需要客户端上的 MSMQ，因此如果您对客户端的机器没有这种控制权，这可能不起作用。

对于额外的冗余级别（例如，如果客户端计算机完全关闭，因此客户端队列不可用），您可以在将通知分发到客户端之前在服务器上排队。服务器队列中的通知仅在成功联系客户端时（或者可能在 3 次尝试失败后等）才会被删除

同样在这方面，如果服务器在一定时间段内未能将消息传递给客户端一定次数，则通知支持实体，发出错误警报，并将客户端队列从目标列表中删除. 当我说“测量”时，我的意思是对设置有意义的频率/持续时间。就我而言，这是 5 次重试，尝试之间的间隔为 5 分钟。

让客户端每隔一段时间“更新”它的通知订阅也可能是有意义的。如果没有发生更新，那么最终客户端队列会被服务中的“groomer”进程从目标列表中删除。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T21:31:52.587

如果你找不到任何内置的东西，并且假设你知道所有客户端的地址，你可以在数据发生变化时向它们发送一条 UDP 消息。使用 UdpClient，这很容易。如果客户端应用程序可以假设某个端口上的任何 UDP 数据意味着它需要从服务器获取新数据，则数据报甚至不需要包含任何数据。

如有必要，您甚至可以将其设为广播数据包（如果您不知道客户端是谁并且它们与服务器位于同一子网中），只要服务器不太“健谈”即可。

无论您决定采用何种解决方案，我都会敦促您避免让客户投票。这将产生大量不必要的网络流量，并且仍然不会表现得那么好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T14:21:42.813

听起来好像您需要实现基于消息队列的解决方案。易于实施，可以在重新启动后存活，并且该技术在服务器（MSMQ，MGQSeries）和客户端（System.Messaging）上都很成熟

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-14T14:26:17.220

我通常会在客户端使用 UI 计时器定期访问服务器以查看是否有新的或更新的数据。（假设您有一种机制来识别您有新数据，例如新行的时间戳、文件时间戳或具有最后计算日期的表格等）

这样服务器就不必知道客户端。客户可以在闲暇时查看等。

# wcf - 是否可以在 IIS6 托管服务中托管 TCP 端点？

> ID：201320
> 
> 赞同：6
> 
> 时间：2008-10-14T14:14:11.377
> 
> 标签：wcf, iis-6

我创建了一个基于 ServiceHostFactory 的 wcf 服务，并将其托管在 IIS6 中。如果我使用 HTTP 端点，一切正常，但是当我尝试切换到 TCP 时，它就坏了。

在 II6 中甚至可以做到这一点吗？

我在这里发布了一个更具体的问题，要求提供解决方案，但我会很高兴（如果不是的话，对于初学者来说）只回答这个问题（也许是一个例子） - 不太具体的问题。

[为什么我不能使用 net.tcp 连接到 WCF 服务，但我可以使用 http？](https://stackoverflow.com/questions/201004/why-cant-i-connect-to-a-wcf-service-with-nettcp-but-i-can-with-http)

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-14T14:37:07.133

IIS 5.1 和 IIS 6 只能承载 HTTP 绑定。IIS7 具有 WAS（Windows 激活服务），它允许托管绑定到任何传输协议的端点......所以它能够支持 TCP。

如果您必须使用 IIS 6 进行托管，那么您将无法使用 HTTP 绑定。如果没有，请考虑在 Windows 服务中自托管。

# regex - 如何使用正则表达式验证电子邮件地址？

> ID：201323
> 
> 赞同：3776
> 
> 时间：2008-10-14T14:14:34.980
> 
> 标签：regex, validation, email, email-validation, string-parsing

多年来，我慢慢开发了一个[正则表达式](http://en.wikipedia.org/wiki/Regular_expression)，可以正确验证*大多数*电子邮件地址，假设它们不使用 IP 地址作为服务器部分。

我在几个 PHP 程序中使用它，并且它大部分时间都可以工作。但是，有时有人在使用它的网站遇到问题时联系我，我最终不得不进行一些调整（最近我意识到我不允许使用四字符[TLD](https://en.wikipedia.org/wiki/Top-level_domain)）。

*您拥有或见过的用于验证电子邮件的最佳正则表达式是什么？*

我已经看到了几种使用使用几个较短表达式的函数的解决方案，但我宁愿在一个简单的函数中使用一个长而复杂的表达式，而不是在一个更复杂的函数中使用几个短表达式。

* * *

## 回答 #1

> 赞同：2962
> 
> 时间：2008-10-14T14:26:43.723

[完全符合 RFC 822](http://ex-parrot.com/~pdw/Mail-RFC822-Address.html)的正则表达式因其长度而效率低下且晦涩难懂。幸运的是，RFC 822 被两次取代，当前的电子邮件地址规范是[RFC 5322](http://www.ietf.org/rfc/rfc5322.txt)。RFC 5322 导致了一个正则表达式，如果研究几分钟就可以理解，并且对于实际使用来说足够高效。

可以在页面顶部[http://emailregex.com/](http://emailregex.com/)找到一个符合 RFC 5322 的正则表达式，但它使用在 Internet 上浮动的 IP 地址模式，但存在一个允许`00`任何无符号字节十进制值在点分隔的地址，这是非法的。其余部分似乎与 RFC 5322 语法一致，并使用 . 通过了多项测试`grep -Po`，包括案例域名、IP 地址、坏地址以及带引号和不带引号的帐户名。

纠正`00`IP 模式中的错误，我们获得了一个有效且相当快速的正则表达式。（为实际代码刮取渲染版本，而不是降价版本。）

> (?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/ =?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\ [\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0 -9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5) [0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}( ?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[ a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\ x01-\x09\x0b\x0c\x0e-\x7f])+)\])

或者：

```
(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\]) 
```

这是上述正则表达式的[有限状态机](https://en.wikipedia.org/wiki/Finite-state_machine)[图](https://regexper.com/#(%3F%3A%5Ba-z0-9!%23%24%25%26'*%2B%2F%3D%3F%5E_%60%7B%7C%7D~-%5D%2B(%3F%3A%5C.%5Ba-z0-9!%23%24%25%26'*%2B%2F%3D%3F%5E_%60%7B%7C%7D~-%5D%2B)*%7C%22(%3F%3A%5B%5Cx01-%5Cx08%5Cx0b%5Cx0c%5Cx0e-%5Cx1f%5Cx21%5Cx23-%5Cx5b%5Cx5d-%5Cx7f%5D%7C%5C%5C%5B%5Cx01-%5Cx09%5Cx0b%5Cx0c%5Cx0e-%5Cx7f%5D)*%22)%40(%3F%3A(%3F%3A%5Ba-z0-9%5D(%3F%3A%5Ba-z0-9-%5D*%5Ba-z0-9%5D)%3F%5C.)%2B%5Ba-z0-9%5D(%3F%3A%5Ba-z0-9-%5D*%5Ba-z0-9%5D)%3F%7C%5C%5B(%3F%3A(%3F%3A(2(5%5B0-5%5D%7C%5B0-4%5D%5B0-9%5D)%7C1%5B0-9%5D%5B0-9%5D%7C%5B1-9%5D%3F%5B0-9%5D))%5C.)%7B3%7D(%3F%3A(2(5%5B0-5%5D%7C%5B0-4%5D%5B0-9%5D)%7C1%5B0-9%5D%5B0-9%5D%7C%5B1-9%5D%3F%5B0-9%5D)%7C%5Ba-z0-9-%5D*%5Ba-z0-9%5D%3A(%3F%3A%5B%5Cx01-%5Cx08%5Cx0b%5Cx0c%5Cx0e-%5Cx1f%5Cx21-%5Cx5a%5Cx53-%5Cx7f%5D%7C%5C%5C%5B%5Cx01-%5Cx09%5Cx0b%5Cx0c%5Cx0e-%5Cx7f%5D)%2B)%5C%5D))，它比正则表达式本身更清晰 [![在此处输入图像描述](https://i.stack.imgur.com/YI6KR.png)](https://i.stack.imgur.com/YI6KR.png)

Perl 和 PCRE（例如 PHP 中使用的正则表达式库）中更复杂的模式可以[毫无障碍地正确解析 RFC 5322](https://stackoverflow.com/questions/201323/what-is-the-best-regular-expression-for-validating-email-addresses/1917982#1917982)。Python 和 C# 也可以做到这一点，但它们使用的语法与前两者不同。但是，如果您被迫使用许多功能较弱的模式匹配语言中的一种，那么最好使用真正的解析器。

同样重要的是要了解，根据 RFC 验证它绝对不会告诉您该地址是否实际存在于所提供的域中，或者输入地址的人是否是它的真正所有者。人们一直以这种方式将其他人注册到邮件列表。解决这个问题需要一种更高级的验证，包括向该地址发送一条消息，其中包含一个确认令牌，该确认令牌应与该地址在同一网页上输入。

确认令牌是知道您获得输入者地址的唯一方法。这就是为什么大多数邮件列表现在使用该机制来确认注册。毕竟，任何人都可以放下`president@whitehouse.gov`，这甚至会被解析为合法的，但不太可能是另一端的人。

对于 PHP，您不应该*使用*Validate [an E-Mail Address with PHP 中](http://www.linuxjournal.com/article/9585)给出的模式，这是我引用的正确方法：

> 存在一些危险，即常见用法和广泛的草率编码将为电子邮件地址建立一个事实上的标准，该标准比记录的正式标准更具限制性。

这并不比所有其他非 RFC 模式更好。[处理RFC 822](http://www.ietf.org/rfc/rfc0822.txt)甚至都不够聪明，更不用说 RFC 5322了。然而，[这个是。](https://stackoverflow.com/questions/201323/what-is-the-best-regular-expression-for-validating-email-addresses/1917982#1917982)

如果你想变得花哨和迂腐，[实现一个完整的状态引擎](http://cubicspot.blogspot.com/2012/06/correct-way-to-validate-e-mail-address.html)。正则表达式只能充当基本过滤器。正则表达式的问题在于，告诉某人他们完全有效的电子邮件地址无效（误报），因为您的正则表达式无法处理它，从用户的角度来看，这是粗鲁和不礼貌的。用于此目的的状态引擎可以验证甚至更正电子邮件地址，否则这些地址将被视为无效，因为它会根据每个 RFC 分解电子邮件地址。这可以带来更令人愉悦的体验，例如

> 指定的电子邮件地址“myemail@address,com”无效。您的意思是“myemail@address.com”吗？

另请参阅[验证电子邮件地址](http://worsethanfailure.com/Articles/Validating_Email_Addresses.aspx)，包括评论。或[比较电子邮件地址验证正则表达式](http://fightingforalostcause.net/misc/2006/compare-email-regex.php)。

[![正则表达式可视化](https://i.stack.imgur.com/SrUwP.png)](https://i.stack.imgur.com/SrUwP.png)

[调试演示](https://www.debuggex.com/r/aH_x42NflV8G-GS7)

* * *

## 回答 #2

> 赞同：826
> 
> 时间：2009-12-14T20:43:12.713

您不应使用正则表达式来验证电子邮件地址。

相反，在 C# 中使用[MailAddress](http://msdn.microsoft.com/en-us/library/system.net.mail.mailaddress.aspx)类，如下所示：

```
try {
    address = new MailAddress(address).Address;
} catch(FormatException) {
    // address is invalid
} 
```

该类`MailAddress`使用[BNF](https://en.wikipedia.org/wiki/Backus%E2%80%93Naur_form)解析器来验证完全符合 RFC822 的地址。

如果您打算使用`MailAddress`验证电子邮件地址，请注意此方法也接受电子邮件地址的显示名称部分，这可能不是您想要实现的。例如，它接受这些字符串作为有效的电子邮件地址：

*   “user1@hotmail.com；user2@gmail.com”
*   “user1@hotmail.com; user2@gmail.com; user3@company.com”
*   “用户显示名称 user3@company.com”
*   “user4@company.com”

在某些情况下，只有字符串的最后一部分被解析为地址；在此之前的其余部分是显示名称。要获得没有任何显示名称的普通电子邮件地址，您可以对照原始字符串检查规范化地址。

```
bool isValid = false;

try
{
    MailAddress address = new MailAddress(emailAddress);
    isValid = (address.Address == emailAddress);
    // or
    // isValid = string.IsNullOrEmpty(address.DisplayName);
}
catch (FormatException)
{
    // address is invalid
} 
```

`user@company.`此外， MailAddress 也接受末尾带有点的地址。

如果你真的想使用正则表达式，[这里是](http://www.ex-parrot.com/%7Epdw/Mail-RFC822-Address.html)：

```
(?:(?:\r\n)?[ \t])*(?:(?:(?:[^()<>@,;:\\".\[\] \000-\031 ]+(?:(?:(?:\r\n)?[ \t]
)+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\. |(?:(?:\r\n)?[ \t]))*"(?:(?:
\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\ \".\[\] \000-\031]+(?:(?:(
?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[ ^\"\r\\]|\\.|(?:(?:\r\n)?[
\t]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*(?: [^()<>@,;:\\".\[\] \000-\0
31]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\ ]]))|\[([^\[\]\r\\]|\\.)*\
](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^() <>@,;:\\".\[\] \000-\031]+
(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]) )|\[([^\[\]\r\\]|\\.)*\](?:
(?:\r\n)?[ \t])*))*|(?:[^()<>@,;:\\".\[\] \000-\031]+(?: (?:(?:\r\n)?[ \t])+|\Z
|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:( ?:\r\n)?[ \t]))*"(?:(?:\r\n)
?[ \t])*)*\<(?:(?:\r\n)?[ \t])*(?:@(?:[^()<>@,;:\\"。 \[\] \000-\031]+(?:(?:(?:\
r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\ ]\r\\]|\\.)*\](?:(?:\r\n)?[
 \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)
?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\ \]|\\.)*\](?:(?:\r\n)?[ \t]
)*))*(?:,@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \ 000-\031]+(?:(?:(?:\r\n)?[
 \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\] |\\.)*\](?:(?:\r\n)?[ \t])*
)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031 ]+(?:(?:(?:\r\n)?[ \t]
)+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\ .)*\](?:(?:\r\n)?[ \t])*))*)
*:(?:(?:\r\n)?[ \t])*)?(?:[^()<>@,;:\\".\[\] \000-\031]+ (?:(?:(?:\r\n)?[ \t])+
|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|( ?:(?:\r\n)?[ \t]))*"(?:(?:\r
\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\" .\[\] \000-\031]+(?:(?:(?:
\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\ "\r\\]|\\.|(?:(?:\r\n)?[ \t
]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*(?:[^ ()<>@,;:\\".\[\] \000-\031
]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\] ]))|\[([^\[\]\r\\]|\\.)*\](
?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<> @,;:\\".\[\] \000-\031]+(?
:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))| \[([^\[\]\r\\]|\\.)*\](?:(?
:\r\n)?[ \t])*))*\>(?:(?:\r\n)?[ \t])*)|(?:[^()<>@,; :\\".\[\] \000-\031]+(?:(?
:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(? :[^\"\r\\]|\\.|(?:(?:\r\n)?
[ \t]))*"(?:(?:\r\n)?[ \t])*)*:(?:(?:\r\n)?[ \t])*(?: (?:(?:[^()<>@,;:\\".\[\]
\000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\" .\[\]]))|"(?:[^\"\r\\]|
\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(? :(?:\r\n)?[ \t])*(?:[^()<>

@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[ "()<>@,;:\\".\[\]]))|"
(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t]
)*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t]) +|\Z|(?=[\["()<>@,;:\\
".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])* )(?:\.(?:(?:\r\n)?[ \t])*(?
:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z |(?=[\["()<>@,;:\\".\[
\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*| (?:[^()<>@,;:\\".\[\] \000-
\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[ \]]))|"(?:[^\"\r\\]|\\.|(
?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)*\<(?:(?:\r\ n)?[ \t])*(?:@(?:[^()<>@,;
:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["() <>@,;:\\".\[\]]))|\[([
^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r \n)?[ \t])*(?:[^()<>@,;:\\"
.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@, ;:\\".\[\]]))|\[([^\[\
]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*(?:,@(?:(?:\r\n )?[ \t])*(?:[^()<>@,;:\\".\
[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;: \\".\[\]]))|\[([^\[\]\
r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \ t])*(?:[^()<>@,;:\\".\[\]
\000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\" .\[\]]))|\[([^\[\]\r\\]
|\\.)*\](?:(?:\r\n)?[ \t])*))*)*:(?:(?:\r\n)?[ \t])* )?(?:[^()<>@,;:\\".\[\] \0
00-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\". \[\]]))|"(?:[^\"\r\\]|\\
.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(?:( ?:\r\n)?[ \t])*(?:[^()<>@,
;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["( )<>@,;:\\".\[\]]))|"(?
:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t ])*))*@(?:(?:\r\n)?[ \t])*
(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+| \Z|(?=[\["()<>@,;:\\".
\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)( ?:\.(?:(?:\r\n)?[ \t])*(?:[
^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|( ?=[\["()<>@,;:\\".\[\]
]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*\>( ?:(?:\r\n)?[ \t])*)(?:,\s*(
?:(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t]) +|\Z|(?=[\["()<>@,;:\\
".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(? :(?:\r\n)?[ \t])*)(?:\.(?:(
?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(? :\r\n)?[ \t])+|\Z|(?=[
\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\ n)?[ \t]))*"(?:(?:\r\n)?[ \t
])*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\ 031]+(?:(?:(?:\r\n)?[ \t
])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\ \.)*\](?:(?:\r\n)?[ \t])*)(?
:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+( ?:(?:(?:\r\n)?[ \t])+|
\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)* \](?:(?:\r\n)?[ \t])*))*|(?:
[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z| (?=[\["()<>@,;:\\".\[\
]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\ r\n)?[ \t])*)*\<(?:(?:\r\n)
?[ \t])*(?:@(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r \n)?[ \t])+|\Z|(?=[\["
()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r \n)?[ \t])*)(?:\.(?:(?:\r\n)
?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)? [ \t])+|\Z|(?=[\["()<>

@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)? [ \t])*))*(?:,@(?:(?:\r\n)?[
 \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \ t])+|\Z|(?=[\["()<>@,
;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[\ t])*)(?:\.(?:(?:\r\n)?[ \t]
)*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t]) +|\Z|(?=[\["()<>@,;:\\
".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])* ))*)*:(?:(?:\r\n)?[ \t])*)?
(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+| \Z|(?=[\["()<>@,;:\\".
\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:( ?:\r\n)?[ \t])*)(?:\.(?:(?:
\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\ r\n)?[ \t])+|\Z|(?=[\[
"()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n) ?[ \t]))*"(?:(?:\r\n)?[ \t])
*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031] +(?:(?:(?:\r\n)?[ \t])
+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\. )*\](?:(?:\r\n)?[ \t])*)(?:\
.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?: (?:(?:\r\n)?[ \t])+|\Z
|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\] (?:(?:\r\n)?[ \t])*))*\>(?:(
?:\r\n)?[ \t])*))*)?;\s*)
```

* * *

## 回答 #3

> 赞同：587
> 
> 时间：2008-10-14T19:40:10.347

这个问题被问了很多，但我认为你应该退后一步问问自己*为什么*要在语法上验证电子邮件地址？真正的好处是什么？

*   它不会捕获常见的拼写错误。
*   它不会阻止人们输入无效或虚构的电子邮件地址，或为此输入其他人的地址。

如果您想验证电子邮件是否正确，您别无选择，只能发送确认电子邮件并让用户回复。在许多情况下，出于安全原因或道德原因，您无论如何*都*必须发送确认邮件（例如，您不能违背某人的意愿签署服务）。

* * *

## 回答 #4

> 赞同：474
> 
> 时间：2008-10-14T14:42:25.487

这完全取决于您想要的准确程度。出于我的目的，我只是想避免诸如`bob @ aol.com`（电子邮件中的空格）或`steve`（根本没有域）或`mary@aolcom`（.com 之前没有句点）之类的东西，我使用

```
/^\S+@\S+\.\S+$/ 
```

当然，它会匹配无效的电子邮件地址，但这是一个常见的简单错误问题。

可以对该正则表达式进行任何数量的更改（有些在此答案的评论中），但它很简单，易于理解，并且是一个很好的第一次尝试。

* * *

## 回答 #5

> 赞同：362
> 
> 时间：2009-04-05T19:39:31.363

这取决于您的最佳含义：如果您要捕获每个有效的电子邮件地址，请使用以下内容：

```
(?:(?:\r\n)?[ \t])*(?:(?:(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t]
)+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:
\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(
?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ 
\t]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\0
31]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\
](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+
(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:
(?:\r\n)?[ \t])*))*|(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z
|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)
?[ \t])*)*\<(?:(?:\r\n)?[ \t])*(?:@(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\
r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[
 \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)
?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t]
)*))*(?:,@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[
 \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*
)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t]
)+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*)
*:(?:(?:\r\n)?[ \t])*)?(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+
|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r
\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:
\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t
]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031
]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](
?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?
:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?
:\r\n)?[ \t])*))*\>(?:(?:\r\n)?[ \t])*)|(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?
:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?
[ \t]))*"(?:(?:\r\n)?[ \t])*)*:(?:(?:\r\n)?[ \t])*(?:(?:(?:[^()<>@,;:\\".\[\] 
\000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|
\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>
@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"
(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t]
)*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\
".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?
:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[
\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*|(?:[^()<>@,;:\\".\[\] \000-
\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(
?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)*\<(?:(?:\r\n)?[ \t])*(?:@(?:[^()<>@,;
:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([
^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\"
.\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\
]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*(?:,@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\
[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\
r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] 
\000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]
|\\.)*\](?:(?:\r\n)?[ \t])*))*)*:(?:(?:\r\n)?[ \t])*)?(?:[^()<>@,;:\\".\[\] \0
00-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\
.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,
;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?
:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*
(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".
\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[
^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]
]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*\>(?:(?:\r\n)?[ \t])*)(?:,\s*(
?:(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\
".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(?:(
?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[
\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t
])*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t
])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?
:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|
\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*|(?:
[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\
]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)*\<(?:(?:\r\n)
?[ \t])*(?:@(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["
()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)
?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>
@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*(?:,@(?:(?:\r\n)?[
 \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,
;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t]
)*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\
".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*)*:(?:(?:\r\n)?[ \t])*)?
(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".
\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])*)(?:\.(?:(?:
\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z|(?=[\[
"()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:\r\n)?[ \t])
*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])
+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\
.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z
|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*\>(?:(
?:\r\n)?[ \t])*))*)?;\s*) 
```

（[http://www.ex-parrot.com/~pdw/Mail-RFC822-Address.html](http://www.ex-parrot.com/~pdw/Mail-RFC822-Address.html)）如果您正在寻找更简单但可以捕获大多数有效电子邮件地址的东西，请尝试以下操作：

```
"^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+$" 
```

编辑：从链接：

> 此正则表达式将仅验证已删除任何注释并替换为空格的地址（这是由模块完成的）。

* * *

## 回答 #6

> 赞同：311
> 
> 时间：2012-01-12T02:24:20.157

根据[W3C HTML5 规范](http://www.w3.org/TR/html5/forms.html#valid-e-mail-address)：

```
^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$ 
```

语境：

> 有效的**电子邮件地址**是与 ABNF 产生式 […] 匹配的字符串。
> 
> *注意：此要求是对 RFC 5322 的[故意违反](http://www.w3.org/TR/html5/introduction.html#willful-violation)，[RFC 5322](https://www.rfc-editor.org/rfc/rfc5322)定义的电子邮件地址语法同时过于严格（“@”字符之前）、过于模糊（“@”字符之后）和过于宽松（允许注释、空白字符和以大多数用户不熟悉的方式引用的字符串）在这里实际使用。*
> 
> *以下与 JavaScript 和 Perl 兼容的正则表达式是上述定义的实现。*
> 
>  *```
> /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/ 
> ```*

* * *

## 回答 #7

> 赞同：292
> 
> 时间：2009-02-10T16:13:28.143

[更新] 我在[http://isemail.info](http://isemail.info)整理了我所知道的关于电子邮件地址验证的所有信息，现在不仅可以验证，而且还可以诊断电子邮件地址的问题。我同意这里的许多评论，即验证只是答案的一部分；查看我的文章*[什么是有效的电子邮件地址？](http://isemail.info/about)*.

据我所知，is_email() 仍然是唯一可以明确告诉您给定字符串是否是有效电子邮件地址的验证器。我在[http://isemail.info/上传了一个新版本](http://isemail.info/)

我整理了来自 Cal Henderson、Dave Child、Phil Haack、Doug Lovell、[RFC 5322](https://en.wikipedia.org/wiki/Email#Message_format)和[RFC 3696](https://en.wikipedia.org/wiki/Email_address#Syntax)的测试用例。总共 275 个测试地址。我针对我能找到的所有免费验证器运行了所有这些测试。

随着人们增强他们的验证器，我将尝试使此页面保持最新。感谢 Cal、Michael、Dave、Paul 和 Phil 在编译这些测试以及对[我自己的验证器](http://code.google.com/p/isemail)的建设性批评方面提供的帮助和合作。

人们应该特别注意[针对 RFC 3696 的勘误表](http://www.rfc-editor.org/errata_search.php?rfc=3696)。其中三个规范示例实际上是无效地址。地址的最大长度是 254 或 256 个字符，**而不是**320。

* * *

## 回答 #8

> 赞同：204
> 
> 时间：2009-12-16T21:44:57.067

在 Perl 5.10 或更新版本中很容易：

```
/(?(DEFINE)
   (?<address>         (?&mailbox) | (?&group))
   (?<mailbox>         (?&name_addr) | (?&addr_spec))
   (?<name_addr>       (?&display_name)? (?&angle_addr))
   (?<angle_addr>      (?&CFWS)? < (?&addr_spec) > (?&CFWS)?)
   (?<group>           (?&display_name) : (?:(?&mailbox_list) | (?&CFWS))? ;
                                          (?&CFWS)?)
   (?<display_name>    (?&phrase))
   (?<mailbox_list>    (?&mailbox) (?: , (?&mailbox))*)

   (?<addr_spec>       (?&local_part) \@ (?&domain))
   (?<local_part>      (?&dot_atom) | (?&quoted_string))
   (?<domain>          (?&dot_atom) | (?&domain_literal))
   (?<domain_literal>  (?&CFWS)? \[ (?: (?&FWS)? (?&dcontent))* (?&FWS)?
                                 \] (?&CFWS)?)
   (?<dcontent>        (?&dtext) | (?&quoted_pair))
   (?<dtext>           (?&NO_WS_CTL) | [\x21-\x5a\x5e-\x7e])

   (?<atext>           (?&ALPHA) | (?&DIGIT) | [!#\$%&'*+-/=?^_`{|}~])
   (?<atom>            (?&CFWS)? (?&atext)+ (?&CFWS)?)
   (?<dot_atom>        (?&CFWS)? (?&dot_atom_text) (?&CFWS)?)
   (?<dot_atom_text>   (?&atext)+ (?: \. (?&atext)+)*)

   (?<text>            [\x01-\x09\x0b\x0c\x0e-\x7f])
   (?<quoted_pair>     \\ (?&text))

   (?<qtext>           (?&NO_WS_CTL) | [\x21\x23-\x5b\x5d-\x7e])
   (?<qcontent>        (?&qtext) | (?&quoted_pair))
   (?<quoted_string>   (?&CFWS)? (?&DQUOTE) (?:(?&FWS)? (?&qcontent))*
                        (?&FWS)? (?&DQUOTE) (?&CFWS)?)

   (?<word>            (?&atom) | (?&quoted_string))
   (?<phrase>          (?&word)+)

   # Folding white space
   (?<FWS>             (?: (?&WSP)* (?&CRLF))? (?&WSP)+)
   (?<ctext>           (?&NO_WS_CTL) | [\x21-\x27\x2a-\x5b\x5d-\x7e])
   (?<ccontent>        (?&ctext) | (?&quoted_pair) | (?&comment))
   (?<comment>         \( (?: (?&FWS)? (?&ccontent))* (?&FWS)? \) )
   (?<CFWS>            (?: (?&FWS)? (?&comment))*
                       (?: (?:(?&FWS)? (?&comment)) | (?&FWS)))

   # No whitespace control
   (?<NO_WS_CTL>       [\x01-\x08\x0b\x0c\x0e-\x1f\x7f])

   (?<ALPHA>           [A-Za-z])
   (?<DIGIT>           [0-9])
   (?<CRLF>            \x0d \x0a)
   (?<DQUOTE>          ")
   (?<WSP>             [\x20\x09])
 )

 (?&address)/x 
```

* * *

## 回答 #9

> 赞同：184
> 
> 时间：2008-10-14T14:17:44.570

我用

```
^\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$ 
```

这是 RegularExpressionValidator 在 ASP.NET 中使用的一种。

* * *

## 回答 #10

> 赞同：145
> 
> 时间：2008-10-14T14:17:59.200

我不知道最好的，但这[至少](http://ex-parrot.com/%7Epdw/Mail-RFC822-Address.html)是正确的，只要地址的评论被剥离并用空格代替。

严重地。您应该使用已经编写好的库来验证电子邮件。最好的方法可能是向该地址发送一封验证电子邮件。

* * *

## 回答 #11

> 赞同：127
> 
> 时间：2012-12-28T21:07:53.050

# 快速回答

使用以下正则表达式进行输入验证：

`([-!#-'*+/-9=?A-Z^-~]+(\.[-!#-'*+/-9=?A-Z^-~]+)*|"([]!#-[^-~ \t]|(\\[\t -~]))+")@[0-9A-Za-z]([0-9A-Za-z-]{0,61}[0-9A-Za-z])?(\.[0-9A-Za-z]([0-9A-Za-z-]{0,61}[0-9A-Za-z])?)+`

此正则表达式匹配的地址：

*   有一个严格符合 RFC 5321/5322 的本地部分（即@符号之前的部分），
*   有一个域部分（即@符号之后的部分）是一个主机名，至少有两个标签，每个标签的长度最多为 63 个字符。

第二个约束是对 RFC 5321/5322 的限制。

# 详尽的回答

使用识别电子邮件地址的正则表达式在各种情况下可能很有用：例如扫描文档中的电子邮件地址、验证用户输入或作为数据存储库的完整性约束。

但是应该注意的是，如果您想查明该地址是否实际上是指现有邮箱，则无法替代向该地址发送消息。如果您只想检查地址是否在语法上正确，那么您可以使用正则表达式，但请注意，这`""@[]`是一个语法正确的电子邮件地址，它肯定不引用现有邮箱。

电子邮件地址的语法已在各种[RFC](http://en.wikipedia.org/wiki/Request_for_Comments)中定义，最值得注意的是[RFC 822](https://www.rfc-editor.org/rfc/rfc822)和[RFC 5322](https://www.rfc-editor.org/rfc/rfc5322)。RFC 822 应被视为“原始”标准，而 RFC 5322 应被视为最新标准。RFC 822 中定义的语法是最宽松的，随后的标准对语法进行了越来越多的限制，其中较新的系统或服务应该识别过时的语法，但永远不会产生它。

在这个答案中，我将使用“电子邮件地址”来表示`addr-spec`RFC 中定义的含义（即`jdoe@example.org`，但不是`"John Doe"<jdoe@example.org>`，也不是`some-group:jdoe@example.org,mrx@exampel.org;`）。

将 RFC 语法翻译成正则表达式存在一个问题：语法不规则！这是因为它们允许电子邮件地址中的可选注释可以无限嵌套，而无限嵌套不能用正则表达式来描述。要扫描或验证包含评论的地址，您需要解析器或更强大的表达式。（请注意，像 Perl 这样的语言具有以类似正则表达式的方式描述上下文无关语法的构造。）在这个答案中，我将忽略注释，只考虑正确的正则表达式。

RFC 定义了电子邮件消息的语法，而不是电子邮件地址本身。地址可能出现在各种标题字段中，这是它们主要定义的地方。当它们出现在标题字段中时，地址可能包含（在词法标记之间）空格、注释甚至换行符。然而，这在语义上没有意义。通过从地址中删除此空格等，您将获得语义上等效的*规范表示*。因此， 的规范表示`first. last (comment) @ [3.5.7.9]`是`first.last@[3.5.7.9]`。

不同的语法应该用于不同的目的。如果要扫描（可能非常旧的）文档中的电子邮件地址，最好使用 RFC 822 中定义的语法。另一方面，如果要验证用户输入，则可能需要使用RFC 5322 中定义的语法，可能只接受规范表示。您应该决定哪种语法适用于您的具体情况。

假设 ASCII 兼容字符集，我在这个答案中使用 POSIX“扩展”正则表达式。

## RFC 822

我得出了以下正则表达式。我邀请大家尝试打破它。如果您发现任何误报或漏报，请将它们发布在评论中，我会尽快修复该表达式。

`([^][()<>@,;:\\". \x00-\x1F\x7F]+|"(\n|(\\\r)*([^"\\\r\n]|\\[^\r]))*(\\\r)*")(\.([^][()<>@,;:\\". \x00-\x1F\x7F]+|"(\n|(\\\r)*([^"\\\r\n]|\\[^\r]))*(\\\r)*"))*@([^][()<>@,;:\\". \x00-\x1F\x7F]+|\[(\n|(\\\r)*([^][\\\r\n]|\\[^\r]))*(\\\r)*])(\.([^][()<>@,;:\\". \x00-\x1F\x7F]+|\[(\n|(\\\r)*([^][\\\r\n]|\\[^\r]))*(\\\r)*]))*`

我相信它完全符合 RFC 822，包括[勘误表](http://www.rfc-editor.org/errata_search.php?rfc=822)。它只识别规范形式的电子邮件地址。对于识别（折叠）空格的正则表达式，请参见下面的推导。

推导显示了我是如何得出这个表达式的。我列出了 RFC 中的所有相关语法规则，它们完全按照它们出现的方式列出，然后是相应的正则表达式。在发布了勘误表的地方，我为更正的语法规则（标记为“勘误表”）提供了一个单独的表达式，并将更新的版本用作后续正则表达式中的子表达式。

如第 3.1.4 段所述。RFC 822 的可选线性空白可以插入词法标记之间。在适用的情况下，我扩展了表达式以适应此规则并用“opt-lwsp”标记结果。

```
CHAR        =  <any ASCII character>
            =~ .

CTL         =  <any ASCII control character and DEL>
            =~ [\x00-\x1F\x7F]

CR          =  <ASCII CR, carriage return>
            =~ \r

LF          =  <ASCII LF, linefeed>
            =~ \n

SPACE       =  <ASCII SP, space>
            =~  

HTAB        =  <ASCII HT, horizontal-tab>
            =~ \t

<">         =  <ASCII quote mark>
            =~ "

CRLF        =  CR LF
            =~ \r\n

LWSP-char   =  SPACE / HTAB
            =~ [ \t]

linear-white-space =  1*([CRLF] LWSP-char)
                   =~ ((\r\n)?[ \t])+

specials    =  "(" / ")" / "<" / ">" / "@" /  "," / ";" / ":" / "\" / <"> /  "." / "[" / "]"
            =~ [][()<>@,;:\\".]

quoted-pair =  "\" CHAR
            =~ \\.

qtext       =  <any CHAR excepting <">, "\" & CR, and including linear-white-space>
            =~ [^"\\\r]|((\r\n)?[ \t])+

dtext       =  <any CHAR excluding "[", "]", "\" & CR, & including linear-white-space>
            =~ [^][\\\r]|((\r\n)?[ \t])+

quoted-string  =  <"> *(qtext|quoted-pair) <">
               =~ "([^"\\\r]|((\r\n)?[ \t])|\\.)*"
(erratum)      =~ "(\n|(\\\r)*([^"\\\r\n]|\\[^\r]|(\r\n)?[ \t]))*(\\\r)*"

domain-literal =  "[" *(dtext|quoted-pair) "]"
               =~ \[([^][\\\r]|((\r\n)?[ \t])|\\.)*]
(erratum)      =~ \[(\n|(\\\r)*([^][\\\r\n]|\\[^\r]|(\r\n)?[ \t]))*(\\\r)*]

atom        =  1*<any CHAR except specials, SPACE and CTLs>
            =~ [^][()<>@,;:\\". \x00-\x1F\x7F]+

word        =  atom / quoted-string
            =~ [^][()<>@,;:\\". \x00-\x1F\x7F]+|"(\n|(\\\r)*([^"\\\r\n]|\\[^\r]|(\r\n)?[ \t]))*(\\\r)*"

domain-ref  =  atom

sub-domain  =  domain-ref / domain-literal
            =~ [^][()<>@,;:\\". \x00-\x1F\x7F]+|\[(\n|(\\\r)*([^][\\\r\n]|\\[^\r]|(\r\n)?[ \t]))*(\\\r)*]

local-part  =  word *("." word)
            =~ ([^][()<>@,;:\\". \x00-\x1F\x7F]+|"(\n|(\\\r)*([^"\\\r\n]|\\[^\r]|(\r\n)?[ \t]))*(\\\r)*")(\.([^][()<>@,;:\\". \x00-\x1F\x7F]+|"(\n|(\\\r)*([^"\\\r\n]|\\[^\r]|(\r\n)?[ \t]))*(\\\r)*"))*
(opt-lwsp)  =~ ([^][()<>@,;:\\". \x00-\x1F\x7F]+|"(\n|(\\\r)*([^"\\\r\n]|\\[^\r]|(\r\n)?[ \t]))*(\\\r)*")(((\r\n)?[ \t])*\.((\r\n)?[ \t])*([^][()<>@,;:\\". \x00-\x1F\x7F]+|"(\n|(\\\r)*([^"\\\r\n]|\\[^\r]|(\r\n)?[ \t]))*(\\\r)*"))*

domain      =  sub-domain *("." sub-domain)
            =~ ([^][()<>@,;:\\". \x00-\x1F\x7F]+|\[(\n|(\\\r)*([^][\\\r\n]|\\[^\r]|(\r\n)?[ \t]))*(\\\r)*])(\.([^][()<>@,;:\\". \x00-\x1F\x7F]+|\[(\n|(\\\r)*([^][\\\r\n]|\\[^\r]|(\r\n)?[ \t]))*(\\\r)*]))*
(opt-lwsp)  =~ ([^][()<>@,;:\\". \x00-\x1F\x7F]+|\[(\n|(\\\r)*([^][\\\r\n]|\\[^\r]|(\r\n)?[ \t]))*(\\\r)*])(((\r\n)?[ \t])*\.((\r\n)?[ \t])*([^][()<>@,;:\\". \x00-\x1F\x7F]+|\[(\n|(\\\r)*([^][\\\r\n]|\\[^\r]|(\r\n)?[ \t]))*(\\\r)*]))*

addr-spec   =  local-part "@" domain
            =~ ([^][()<>@,;:\\". \x00-\x1F\x7F]+|"(\n|(\\\r)*([^"\\\r\n]|\\[^\r]|(\r\n)?[ \t]))*(\\\r)*")(\.([^][()<>@,;:\\". \x00-\x1F\x7F]+|"(\n|(\\\r)*([^"\\\r\n]|\\[^\r]|(\r\n)?[ \t]))*(\\\r)*"))*@([^][()<>@,;:\\". \x00-\x1F\x7F]+|\[(\n|(\\\r)*([^][\\\r\n]|\\[^\r]|(\r\n)?[ \t]))*(\\\r)*])(\.([^][()<>@,;:\\". \x00-\x1F\x7F]+|\[(\n|(\\\r)*([^][\\\r\n]|\\[^\r]|(\r\n)?[ \t]))*(\\\r)*]))*
(opt-lwsp)  =~ ([^][()<>@,;:\\". \x00-\x1F\x7F]+|"(\n|(\\\r)*([^"\\\r\n]|\\[^\r]|(\r\n)?[ \t]))*(\\\r)*")((\r\n)?[ \t])*(\.((\r\n)?[ \t])*([^][()<>@,;:\\". \x00-\x1F\x7F]+|"(\n|(\\\r)*([^"\\\r\n]|\\[^\r]|(\r\n)?[ \t]))*(\\\r)*")((\r\n)?[ \t])*)*@((\r\n)?[ \t])*([^][()<>@,;:\\". \x00-\x1F\x7F]+|\[(\n|(\\\r)*([^][\\\r\n]|\\[^\r]|(\r\n)?[ \t]))*(\\\r)*])(((\r\n)?[ \t])*\.((\r\n)?[ \t])*([^][()<>@,;:\\". \x00-\x1F\x7F]+|\[(\n|(\\\r)*([^][\\\r\n]|\\[^\r]|(\r\n)?[ \t]))*(\\\r)*]))*
(canonical) =~ ([^][()<>@,;:\\". \x00-\x1F\x7F]+|"(\n|(\\\r)*([^"\\\r\n]|\\[^\r]))*(\\\r)*")(\.([^][()<>@,;:\\". \x00-\x1F\x7F]+|"(\n|(\\\r)*([^"\\\r\n]|\\[^\r]))*(\\\r)*"))*@([^][()<>@,;:\\". \x00-\x1F\x7F]+|\[(\n|(\\\r)*([^][\\\r\n]|\\[^\r]))*(\\\r)*])(\.([^][()<>@,;:\\". \x00-\x1F\x7F]+|\[(\n|(\\\r)*([^][\\\r\n]|\\[^\r]))*(\\\r)*]))* 
```

## RFC 5322

我得出了以下正则表达式。我邀请大家尝试打破它。如果您发现任何误报或漏报，请将它们发布在评论中，我会尽快修复该表达式。

`([-!#-'*+/-9=?A-Z^-~]+(\.[-!#-'*+/-9=?A-Z^-~]+)*|"([]!#-[^-~ \t]|(\\[\t -~]))+")@([-!#-'*+/-9=?A-Z^-~]+(\.[-!#-'*+/-9=?A-Z^-~]+)*|\[[\t -Z^-~]*])`

我相信它完全符合 RFC 5322，包括[勘误表](http://www.rfc-editor.org/errata_search.php?rfc=5322)。它只识别规范形式的电子邮件地址。对于识别（折叠）空格的正则表达式，请参见下面的推导。

推导显示了我是如何得出这个表达式的。我列出了 RFC 中的所有相关语法规则，它们完全按照它们出现的方式列出，然后是相应的正则表达式。对于包含语义上不相关（折叠）空格的规则，我给出了一个单独的正则表达式，标记为“（规范化）”，它不接受这个空格。

我忽略了 RFC 中的所有“obs-”规则。这意味着正则表达式仅匹配严格符合 RFC 5322 的电子邮件地址。如果您必须匹配“旧”地址（就像包括“obs-”规则在内的更宽松的语法那样），您可以使用上一段中的 RFC 822 正则表达式之一。

```
VCHAR           =   %x21-7E
                =~  [!-~]

ALPHA           =   %x41-5A / %x61-7A
                =~  [A-Za-z]

DIGIT           =   %x30-39
                =~  [0-9]

HTAB            =   %x09
                =~  \t

CR              =   %x0D
                =~  \r

LF              =   %x0A
                =~  \n

SP              =   %x20
                =~  

DQUOTE          =   %x22
                =~  "

CRLF            =   CR LF
                =~  \r\n

WSP             =   SP / HTAB
                =~  [\t ]

quoted-pair     =   "\" (VCHAR / WSP)
                =~  \\[\t -~]

FWS             =   ([*WSP CRLF] 1*WSP)
                =~  ([\t ]*\r\n)?[\t ]+

ctext           =   %d33-39 / %d42-91 / %d93-126
                =~  []!-'*-[^-~]

("comment" is left out in the regex)
ccontent        =   ctext / quoted-pair / comment
                =~  []!-'*-[^-~]|(\\[\t -~])

(not regular)
comment         =   "(" *([FWS] ccontent) [FWS] ")"

(is equivalent to FWS when leaving out comments)
CFWS            =   (1*([FWS] comment) [FWS]) / FWS
                =~  ([\t ]*\r\n)?[\t ]+

atext           =   ALPHA / DIGIT / "!" / "#" / "$" / "%" / "&" / "'" / "*" / "+" / "-" / "/" / "=" / "?" / "^" / "_" / "`" / "{" / "|" / "}" / "~"
                =~  [-!#-'*+/-9=?A-Z^-~]

dot-atom-text   =   1*atext *("." 1*atext)
                =~  [-!#-'*+/-9=?A-Z^-~]+(\.[-!#-'*+/-9=?A-Z^-~]+)*

dot-atom        =   [CFWS] dot-atom-text [CFWS]
                =~  (([\t ]*\r\n)?[\t ]+)?[-!#-'*+/-9=?A-Z^-~]+(\.[-!#-'*+/-9=?A-Z^-~]+)*(([\t ]*\r\n)?[\t ]+)?
(normalized)    =~  [-!#-'*+/-9=?A-Z^-~]+(\.[-!#-'*+/-9=?A-Z^-~]+)*

qtext           =   %d33 / %d35-91 / %d93-126
                =~  []!#-[^-~]

qcontent        =   qtext / quoted-pair
                =~  []!#-[^-~]|(\\[\t -~])

(erratum)
quoted-string   =   [CFWS] DQUOTE ((1*([FWS] qcontent) [FWS]) / FWS) DQUOTE [CFWS]
                =~  (([\t ]*\r\n)?[\t ]+)?"(((([\t ]*\r\n)?[\t ]+)?([]!#-[^-~]|(\\[\t -~])))+(([\t ]*\r\n)?[\t ]+)?|(([\t ]*\r\n)?[\t ]+)?)"(([\t ]*\r\n)?[\t ]+)?
(normalized)    =~  "([]!#-[^-~ \t]|(\\[\t -~]))+"

dtext           =   %d33-90 / %d94-126
                =~  [!-Z^-~]

domain-literal  =   [CFWS] "[" *([FWS] dtext) [FWS] "]" [CFWS]
                =~  (([\t ]*\r\n)?[\t ]+)?\[((([\t ]*\r\n)?[\t ]+)?[!-Z^-~])*(([\t ]*\r\n)?[\t ]+)?](([\t ]*\r\n)?[\t ]+)?
(normalized)    =~  \[[\t -Z^-~]*]

local-part      =   dot-atom / quoted-string
                =~  (([\t ]*\r\n)?[\t ]+)?[-!#-'*+/-9=?A-Z^-~]+(\.[-!#-'*+/-9=?A-Z^-~]+)*(([\t ]*\r\n)?[\t ]+)?|(([\t ]*\r\n)?[\t ]+)?"(((([\t ]*\r\n)?[\t ]+)?([]!#-[^-~]|(\\[\t -~])))+(([\t ]*\r\n)?[\t ]+)?|(([\t ]*\r\n)?[\t ]+)?)"(([\t ]*\r\n)?[\t ]+)?
(normalized)    =~  [-!#-'*+/-9=?A-Z^-~]+(\.[-!#-'*+/-9=?A-Z^-~]+)*|"([]!#-[^-~ \t]|(\\[\t -~]))+"

domain          =   dot-atom / domain-literal
                =~  (([\t ]*\r\n)?[\t ]+)?[-!#-'*+/-9=?A-Z^-~]+(\.[-!#-'*+/-9=?A-Z^-~]+)*(([\t ]*\r\n)?[\t ]+)?|(([\t ]*\r\n)?[\t ]+)?\[((([\t ]*\r\n)?[\t ]+)?[!-Z^-~])*(([\t ]*\r\n)?[\t ]+)?](([\t ]*\r\n)?[\t ]+)?
(normalized)    =~  [-!#-'*+/-9=?A-Z^-~]+(\.[-!#-'*+/-9=?A-Z^-~]+)*|\[[\t -Z^-~]*]

addr-spec       =   local-part "@" domain
                =~  ((([\t ]*\r\n)?[\t ]+)?[-!#-'*+/-9=?A-Z^-~]+(\.[-!#-'*+/-9=?A-Z^-~]+)*(([\t ]*\r\n)?[\t ]+)?|(([\t ]*\r\n)?[\t ]+)?"(((([\t ]*\r\n)?[\t ]+)?([]!#-[^-~]|(\\[\t -~])))+(([\t ]*\r\n)?[\t ]+)?|(([\t ]*\r\n)?[\t ]+)?)"(([\t ]*\r\n)?[\t ]+)?)@((([\t ]*\r\n)?[\t ]+)?[-!#-'*+/-9=?A-Z^-~]+(\.[-!#-'*+/-9=?A-Z^-~]+)*(([\t ]*\r\n)?[\t ]+)?|(([\t ]*\r\n)?[\t ]+)?\[((([\t ]*\r\n)?[\t ]+)?[!-Z^-~])*(([\t ]*\r\n)?[\t ]+)?](([\t ]*\r\n)?[\t ]+)?)
(normalized)    =~  ([-!#-'*+/-9=?A-Z^-~]+(\.[-!#-'*+/-9=?A-Z^-~]+)*|"([]!#-[^-~ \t]|(\\[\t -~]))+")@([-!#-'*+/-9=?A-Z^-~]+(\.[-!#-'*+/-9=?A-Z^-~]+)*|\[[\t -Z^-~]*]) 
```

请注意，某些来源（尤其是[W3C](http://www.w3.org/TR/html5/forms.html#valid-e-mail-address)）声称 RFC 5322 对本地部分（即 @-sign 之前的部分）过于严格。这是因为“..”、“a..b”和“a”。不是*有效*的点原子，但它们可以用作邮箱名称。然而，RFC*确实*允许像这样的本地部分，除了它们必须被引用。所以`a..b@example.net`你应该写而不是写`"a..b"@example.net`，这在语义上是等价的。

## 进一步的限制

SMTP（如[RFC 5321](https://www.rfc-editor.org/rfc/rfc5321)中所定义）进一步限制了一组有效的电子邮件地址（或实际上：邮箱名称）。强加这种更严格的语法似乎是合理的，以便匹配的电子邮件地址实际上可以用于发送电子邮件。

RFC 5321 基本上只留下“本地”部分（即@-sign 之前的部分），但对域部分（即@-sign 之后的部分）更为严格。它只允许用主机名代替点原子，用地址文字代替域文字。

RFC 5321 中的语法在涉及主机名和 IP 地址时过于宽松。我冒昧地“纠正”了有问题的规则，使用[这个草案](https://tools.ietf.org/id/draft-main-ipaddr-text-rep-01.txt)和[RFC 1034](https://www.rfc-editor.org/rfc/rfc1034)作为指导方针。这是生成的正则表达式。

`([-!#-'*+/-9=?A-Z^-~]+(\.[-!#-'*+/-9=?A-Z^-~]+)*|"([]!#-[^-~ \t]|(\\[\t -~]))+")@([0-9A-Za-z]([0-9A-Za-z-]{0,61}[0-9A-Za-z])?(\.[0-9A-Za-z]([0-9A-Za-z-]{0,61}[0-9A-Za-z])?)*|\[((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|IPv6:((((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){6}|::((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){5}|[0-9A-Fa-f]{0,4}::((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){4}|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):)?(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){3}|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){0,2}(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){2}|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){0,3}(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){0,4}(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::)((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3})|(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3})|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){0,5}(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3})|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){0,6}(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::)|(?!IPv6:)[0-9A-Za-z-]*[0-9A-Za-z]:[!-Z^-~]+)])`

请注意，根据用例，您可能不希望在正则表达式中允许“通用地址文字”。另请注意，我`(?!IPv6:)`在最终的正则表达式中使用了否定前瞻来防止“General-address-literal”部分匹配格式错误的 IPv6 地址。一些正则表达式处理器不支持负前瞻。`|(?!IPv6:)[0-9A-Za-z-]*[0-9A-Za-z]:[!-Z^-~]+`如果要取出整个“General-address-literal”部分，请从正则表达式中删除子字符串。

这是推导：

```
Let-dig         =   ALPHA / DIGIT
                =~  [0-9A-Za-z]

Ldh-str         =   *( ALPHA / DIGIT / "-" ) Let-dig
                =~  [0-9A-Za-z-]*[0-9A-Za-z]

(regex is updated to make sure sub-domains are max. 63 characters long - RFC 1034 section 3.5)
sub-domain      =   Let-dig [Ldh-str]
                =~  [0-9A-Za-z]([0-9A-Za-z-]{0,61}[0-9A-Za-z])?

Domain          =   sub-domain *("." sub-domain)
                =~  [0-9A-Za-z]([0-9A-Za-z-]{0,61}[0-9A-Za-z])?(\.[0-9A-Za-z]([0-9A-Za-z-]{0,61}[0-9A-Za-z])?)*

Snum            =   1*3DIGIT
                =~  [0-9]{1,3}

(suggested replacement for "Snum")
ip4-octet       =   DIGIT / %x31-39 DIGIT / "1" 2DIGIT / "2" %x30-34 DIGIT / "25" %x30-35
                =~  25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9]

IPv4-address-literal    =   Snum 3("."  Snum)
                        =~  [0-9]{1,3}(\.[0-9]{1,3}){3}

(suggested replacement for "IPv4-address-literal")
ip4-address     =   ip4-octet 3("." ip4-octet)
                =~  (25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}

(suggested replacement for "IPv6-hex")
ip6-h16         =   "0" / ( (%x49-57 / %x65-70 /%x97-102) 0*3(%x48-57 / %x65-70 /%x97-102) )
                =~  0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}

(not from RFC)
ls32            =   ip6-h16 ":" ip6-h16 / ip4-address
                =~  (0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3})|(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}

(suggested replacement of "IPv6-addr")
ip6-address     =                                      6(ip6-h16 ":") ls32
                    /                             "::" 5(ip6-h16 ":") ls32
                    / [                 ip6-h16 ] "::" 4(ip6-h16 ":") ls32
                    / [ *1(ip6-h16 ":") ip6-h16 ] "::" 3(ip6-h16 ":") ls32
                    / [ *2(ip6-h16 ":") ip6-h16 ] "::" 2(ip6-h16 ":") ls32
                    / [ *3(ip6-h16 ":") ip6-h16 ] "::"   ip6-h16 ":"  ls32
                    / [ *4(ip6-h16 ":") ip6-h16 ] "::"                ls32
                    / [ *5(ip6-h16 ":") ip6-h16 ] "::"   ip6-h16
                    / [ *6(ip6-h16 ":") ip6-h16 ] "::"
                =~  (((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){6}|::((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){5}|[0-9A-Fa-f]{0,4}::((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){4}|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):)?(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){3}|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){0,2}(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){2}|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){0,3}(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){0,4}(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::)((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3})|(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3})|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){0,5}(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3})|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){0,6}(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::

IPv6-address-literal    =   "IPv6:" ip6-address
                        =~  IPv6:((((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){6}|::((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){5}|[0-9A-Fa-f]{0,4}::((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){4}|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):)?(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){3}|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){0,2}(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){2}|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){0,3}(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){0,4}(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::)((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3})|(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3})|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){0,5}(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3})|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){0,6}(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::)

Standardized-tag        =   Ldh-str
                        =~  [0-9A-Za-z-]*[0-9A-Za-z]

dcontent        =   %d33-90 / %d94-126
                =~  [!-Z^-~]

General-address-literal =   Standardized-tag ":" 1*dcontent
                        =~  [0-9A-Za-z-]*[0-9A-Za-z]:[!-Z^-~]+

address-literal =   "[" ( IPv4-address-literal / IPv6-address-literal / General-address-literal ) "]"
                =~  \[((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|IPv6:((((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){6}|::((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){5}|[0-9A-Fa-f]{0,4}::((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){4}|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):)?(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){3}|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){0,2}(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){2}|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){0,3}(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){0,4}(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::)((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3})|(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3})|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){0,5}(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3})|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){0,6}(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::)|(?!IPv6:)[0-9A-Za-z-]*[0-9A-Za-z]:[!-Z^-~]+)]

Mailbox         =   Local-part "@" ( Domain / address-literal )
                =~  ([-!#-'*+/-9=?A-Z^-~]+(\.[-!#-'*+/-9=?A-Z^-~]+)*|"([]!#-[^-~ \t]|(\\[\t -~]))+")@([0-9A-Za-z]([0-9A-Za-z-]{0,61}[0-9A-Za-z])?(\.[0-9A-Za-z]([0-9A-Za-z-]{0,61}[0-9A-Za-z])?)*|\[((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3}|IPv6:((((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){6}|::((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){5}|[0-9A-Fa-f]{0,4}::((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){4}|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):)?(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){3}|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){0,2}(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){2}|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){0,3}(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){0,4}(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::)((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3})|(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])(\.(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])){3})|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){0,5}(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3})|(((0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}):){0,6}(0|[1-9A-Fa-f][0-9A-Fa-f]{0,3}))?::)|(?!IPv6:)[0-9A-Za-z-]*[0-9A-Za-z]:[!-Z^-~]+)]) 
```

## 用户输入验证

一个常见的用例是用户输入验证，例如在 html 表单上。在这种情况下，排除地址文字并要求主机名中至少有两个标签通常是合理的。以上一节中改进的 RFC 5321 正则表达式为基础，得到的表达式为：

`([-!#-'*+/-9=?A-Z^-~]+(\.[-!#-'*+/-9=?A-Z^-~]+)*|"([]!#-[^-~ \t]|(\\[\t -~]))+")@[0-9A-Za-z]([0-9A-Za-z-]{0,61}[0-9A-Za-z])?(\.[0-9A-Za-z]([0-9A-Za-z-]{0,61}[0-9A-Za-z])?)+`

我不建议进一步限制本地部分，例如通过排除带引号的字符串，因为我们不知道某些主机允许什么样的邮箱名称（比如`"a..b"@example.net`或什至`"a b"@example.net`）。

我也不建议针对文字顶级域列表进行显式验证，甚至不施加长度约束（记住 ".museum" 是如何失效的`[a-z]{2,4}`），但如果你必须：

`([-!#-'*+/-9=?A-Z^-~]+(\.[-!#-'*+/-9=?A-Z^-~]+)*|"([]!#-[^-~ \t]|(\\[\t -~]))+")@([0-9A-Za-z]([0-9A-Za-z-]{0,61}[0-9A-Za-z])?\.)*(net|org|com|info|`*ETC...*`)`

如果您决定走明确的顶级域验证的道路，请确保使您的正则表达式保持最新。

## 进一步的考虑

当只接受域部分中的主机名时（@-符号之后），上面的正则表达式只接受最多 63 个字符的标签，因为它们应该。但是，它们并没有强制要求整个主机名的长度最多为 253 个字符（包括点）。虽然这个约束严格来说仍然是规则的，但是制作一个包含这个规则的正则表达式是不可行的。

另一个考虑因素，尤其是在使用正则表达式进行输入验证时，是对用户的反馈。如果用户输入了错误的地址，最好提供比简单的“语法错误地址”多一点的反馈。使用“香草”正则表达式这是不可能的。

这两个考虑可以通过解析地址来解决。在某些情况下，主机名的额外长度限制也可以通过使用额外的正则表达式来检查它，并将地址与两个表达式匹配来解决。

此答案中的所有正则表达式均未针对性能进行优化。如果性能是一个问题，您应该查看是否（以及如何）您选择的正则表达式可以优化。

* * *

## 回答 #12

> 赞同：113
> 
> 时间：2009-01-02T15:29:28.193

我要验证的电子邮件地址将由 ASP.NET Web 应用程序使用，该应用程序使用`System.Net.Mail`命名空间向人员列表发送电子邮件。

因此，我没有使用一些非常复杂的正则表达式，而是尝试`MailAddress`从地址创建一个实例。如果地址格式不正确，`MailAddress`构造函数将抛出异常。这样，我知道我至少可以将电子邮件发送出去。当然这是服务器端验证，但至少你需要它。

```
protected void emailValidator_ServerValidate(object source, ServerValidateEventArgs args)
{
    try
    {
        var a = new MailAddress(txtEmail.Text);
    }
    catch (Exception ex)
    {
        args.IsValid = false;
        emailValidator.ErrorMessage = "email: " + ex.Message;
    }
} 
```

* * *

## 回答 #13

> 赞同：75
> 
> 时间：2008-10-14T14:18:58.873

互联网上有很多这样的例子（我认为甚至有一个完全验证了 RFC 的例子——但如果有记忆的话，它的长度是几十/几百行）。

人们往往会因验证这类事情而得意忘形。为什么不检查它有一个 @ 和至少一个`.`并满足一些简单的最小长度？输入假电子邮件并仍然匹配任何有效的正则表达式是微不足道的。我猜假阳性比假阴性更好。

* * *

## 回答 #14

> 赞同：63
> 
> 时间：2010-01-27T16:43:48.733

这个正则表达式来自 Perl 的[Email::Valid](https://metacpan.org/source/RJBS/Email-Valid-1.198/lib/Email/Valid.pm)库。我相信它是最准确的，它与所有[RFC 822](https://en.wikipedia.org/wiki/Email)匹配。而且，它基于 O'Reilly 书中的正则表达式：

> 使用 Jeffrey Friedl 在 *Mastering Regular Expressions* ( [http://www.ora.com/catalog/regexp/](http://www.ora.com/catalog/regexp/) ) 中的示例构建的正则表达式。

```
$RFC822PAT = <<'EOF';
[\040\t]*(?:\([^\\\x80-\xff\n\015()]*(?:(?:\\[^\x80-\xff]|\([^\\\x80-\
xff\n\015()]*(?:\\[^\x80-\xff][^\\\x80-\xff\n\015()]*)*\))[^\\\x80-\xf
f\n\015()]*)*\)[\040\t]*)*(?:(?:[^(\040)<>@,;:".\\\[\]\000-\037\x80-\x
ff]+(?![^(\040)<>@,;:".\\\[\]\000-\037\x80-\xff])|"[^\\\x80-\xff\n\015
"]*(?:\\[^\x80-\xff][^\\\x80-\xff\n\015"]*)*")[\040\t]*(?:\([^\\\x80-\
xff\n\015()]*(?:(?:\\[^\x80-\xff]|\([^\\\x80-\xff\n\015()]*(?:\\[^\x80
-\xff][^\\\x80-\xff\n\015()]*)*\))[^\\\x80-\xff\n\015()]*)*\)[\040\t]*
)*(?:\.[\040\t]*(?:\([^\\\x80-\xff\n\015()]*(?:(?:\\[^\x80-\xff]|\([^\
\\x80-\xff\n\015()]*(?:\\[^\x80-\xff][^\\\x80-\xff\n\015()]*)*\))[^\\\
x80-\xff\n\015()]*)*\)[\040\t]*)*(?:[^(\040)<>@,;:".\\\[\]\000-\037\x8
0-\xff]+(?![^(\040)<>@,;:".\\\[\]\000-\037\x80-\xff])|"[^\\\x80-\xff\n
\015"]*(?:\\[^\x80-\xff][^\\\x80-\xff\n\015"]*)*")[\040\t]*(?:\([^\\\x
80-\xff\n\015()]*(?:(?:\\[^\x80-\xff]|\([^\\\x80-\xff\n\015()]*(?:\\[^
\x80-\xff][^\\\x80-\xff\n\015()]*)*\))[^\\\x80-\xff\n\015()]*)*\)[\040
\t]*)*)*@[\040\t]*(?:\([^\\\x80-\xff\n\015()]*(?:(?:\\[^\x80-\xff]|\([
^\\\x80-\xff\n\015()]*(?:\\[^\x80-\xff][^\\\x80-\xff\n\015()]*)*\))[^\
\\x80-\xff\n\015()]*)*\)[\040\t]*)*(?:[^(\040)<>@,;:".\\\[\]\000-\037\
x80-\xff]+(?![^(\040)<>@,;:".\\\[\]\000-\037\x80-\xff])|\[(?:[^\\\x80-
\xff\n\015\[\]]|\\[^\x80-\xff])*\])[\040\t]*(?:\([^\\\x80-\xff\n\015()
]*(?:(?:\\[^\x80-\xff]|\([^\\\x80-\xff\n\015()]*(?:\\[^\x80-\xff][^\\\
x80-\xff\n\015()]*)*\))[^\\\x80-\xff\n\015()]*)*\)[\040\t]*)*(?:\.[\04
0\t]*(?:\([^\\\x80-\xff\n\015()]*(?:(?:\\[^\x80-\xff]|\([^\\\x80-\xff\
n\015()]*(?:\\[^\x80-\xff][^\\\x80-\xff\n\015()]*)*\))[^\\\x80-\xff\n\
015()]*)*\)[\040\t]*)*(?:[^(\040)<>@,;:".\\\[\]\000-\037\x80-\xff]+(?!
[^(\040)<>@,;:".\\\[\]\000-\037\x80-\xff])|\[(?:[^\\\x80-\xff\n\015\[\
]]|\\[^\x80-\xff])*\])[\040\t]*(?:\([^\\\x80-\xff\n\015()]*(?:(?:\\[^\
x80-\xff]|\([^\\\x80-\xff\n\015()]*(?:\\[^\x80-\xff][^\\\x80-\xff\n\01
5()]*)*\))[^\\\x80-\xff\n\015()]*)*\)[\040\t]*)*)*|(?:[^(\040)<>@,;:".
\\\[\]\000-\037\x80-\xff]+(?![^(\040)<>@,;:".\\\[\]\000-\037\x80-\xff]
)|"[^\\\x80-\xff\n\015"]*(?:\\[^\x80-\xff][^\\\x80-\xff\n\015"]*)*")[^
()<>@,;:".\\\[\]\x80-\xff\000-\010\012-\037]*(?:(?:\([^\\\x80-\xff\n\0
15()]*(?:(?:\\[^\x80-\xff]|\([^\\\x80-\xff\n\015()]*(?:\\[^\x80-\xff][
^\\\x80-\xff\n\015()]*)*\))[^\\\x80-\xff\n\015()]*)*\)|"[^\\\x80-\xff\
n\015"]*(?:\\[^\x80-\xff][^\\\x80-\xff\n\015"]*)*")[^()<>@,;:".\\\[\]\
x80-\xff\000-\010\012-\037]*)*<[\040\t]*(?:\([^\\\x80-\xff\n\015()]*(?
:(?:\\[^\x80-\xff]|\([^\\\x80-\xff\n\015()]*(?:\\[^\x80-\xff][^\\\x80-
\xff\n\015()]*)*\))[^\\\x80-\xff\n\015()]*)*\)[\040\t]*)*(?:@[\040\t]*
(?:\([^\\\x80-\xff\n\015()]*(?:(?:\\[^\x80-\xff]|\([^\\\x80-\xff\n\015
()]*(?:\\[^\x80-\xff][^\\\x80-\xff\n\015()]*)*\))[^\\\x80-\xff\n\015()
]*)*\)[\040\t]*)*(?:[^(\040)<>@,;:".\\\[\]\000-\037\x80-\xff]+(?![^(\0
40)<>@,;:".\\\[\]\000-\037\x80-\xff])|\[(?:[^\\\x80-\xff\n\015\[\]]|\\
[^\x80-\xff])*\])[\040\t]*(?:\([^\\\x80-\xff\n\015()]*(?:(?:\\[^\x80-\
xff]|\([^\\\x80-\xff\n\015()]*(?:\\[^\x80-\xff][^\\\x80-\xff\n\015()]*
)*\))[^\\\x80-\xff\n\015()]*)*\)[\040\t]*)*(?:\.[\040\t]*(?:\([^\\\x80
-\xff\n\015()]*(?:(?:\\[^\x80-\xff]|\([^\\\x80-\xff\n\015()]*(?:\\[^\x
80-\xff][^\\\x80-\xff\n\015()]*)*\))[^\\\x80-\xff\n\015()]*)*\)[\040\t
]*)*(?:[^(\040)<>@,;:".\\\[\]\000-\037\x80-\xff]+(?![^(\040)<>@,;:".\\
\[\]\000-\037\x80-\xff])|\[(?:[^\\\x80-\xff\n\015\[\]]|\\[^\x80-\xff])
*\])[\040\t]*(?:\([^\\\x80-\xff\n\015()]*(?:(?:\\[^\x80-\xff]|\([^\\\x
80-\xff\n\015()]*(?:\\[^\x80-\xff][^\\\x80-\xff\n\015()]*)*\))[^\\\x80
-\xff\n\015()]*)*\)[\040\t]*)*)*(?:,[\040\t]*(?:\([^\\\x80-\xff\n\015(
)]*(?:(?:\\[^\x80-\xff]|\([^\\\x80-\xff\n\015()]*(?:\\[^\x80-\xff][^\\
\x80-\xff\n\015()]*)*\))[^\\\x80-\xff\n\015()]*)*\)[\040\t]*)*@[\040\t
]*(?:\([^\\\x80-\xff\n\015()]*(?:(?:\\[^\x80-\xff]|\([^\\\x80-\xff\n\0
15()]*(?:\\[^\x80-\xff][^\\\x80-\xff\n\015()]*)*\))[^\\\x80-\xff\n\015
()]*)*\)[\040\t]*)*(?:[^(\040)<>@,;:".\\\[\]\000-\037\x80-\xff]+(?![^(
\040)<>@,;:".\\\[\]\000-\037\x80-\xff])|\[(?:[^\\\x80-\xff\n\015\[\]]|
\\[^\x80-\xff])*\])[\040\t]*(?:\([^\\\x80-\xff\n\015()]*(?:(?:\\[^\x80
-\xff]|\([^\\\x80-\xff\n\015()]*(?:\\[^\x80-\xff][^\\\x80-\xff\n\015()
]*)*\))[^\\\x80-\xff\n\015()]*)*\)[\040\t]*)*(?:\.[\040\t]*(?:\([^\\\x
80-\xff\n\015()]*(?:(?:\\[^\x80-\xff]|\([^\\\x80-\xff\n\015()]*(?:\\[^
\x80-\xff][^\\\x80-\xff\n\015()]*)*\))[^\\\x80-\xff\n\015()]*)*\)[\040
\t]*)*(?:[^(\040)<>@,;:".\\\[\]\000-\037\x80-\xff]+(?![^(\040)<>@,;:".
\\\[\]\000-\037\x80-\xff])|\[(?:[^\\\x80-\xff\n\015\[\]]|\\[^\x80-\xff
])*\])[\040\t]*(?:\([^\\\x80-\xff\n\015()]*(?:(?:\\[^\x80-\xff]|\([^\\
\x80-\xff\n\015()]*(?:\\[^\x80-\xff][^\\\x80-\xff\n\015()]*)*\))[^\\\x
80-\xff\n\015()]*)*\)[\040\t]*)*)*)*:[\040\t]*(?:\([^\\\x80-\xff\n\015
()]*(?:(?:\\[^\x80-\xff]|\([^\\\x80-\xff\n\015()]*(?:\\[^\x80-\xff][^\
\\x80-\xff\n\015()]*)*\))[^\\\x80-\xff\n\015()]*)*\)[\040\t]*)*)?(?:[^
(\040)<>@,;:".\\\[\]\000-\037\x80-\xff]+(?![^(\040)<>@,;:".\\\[\]\000-
\037\x80-\xff])|"[^\\\x80-\xff\n\015"]*(?:\\[^\x80-\xff][^\\\x80-\xff\
n\015"]*)*")[\040\t]*(?:\([^\\\x80-\xff\n\015()]*(?:(?:\\[^\x80-\xff]|
\([^\\\x80-\xff\n\015()]*(?:\\[^\x80-\xff][^\\\x80-\xff\n\015()]*)*\))
[^\\\x80-\xff\n\015()]*)*\)[\040\t]*)*(?:\.[\040\t]*(?:\([^\\\x80-\xff
\n\015()]*(?:(?:\\[^\x80-\xff]|\([^\\\x80-\xff\n\015()]*(?:\\[^\x80-\x
ff][^\\\x80-\xff\n\015()]*)*\))[^\\\x80-\xff\n\015()]*)*\)[\040\t]*)*(
?:[^(\040)<>@,;:".\\\[\]\000-\037\x80-\xff]+(?![^(\040)<>@,;:".\\\[\]\
000-\037\x80-\xff])|"[^\\\x80-\xff\n\015"]*(?:\\[^\x80-\xff][^\\\x80-\
xff\n\015"]*)*")[\040\t]*(?:\([^\\\x80-\xff\n\015()]*(?:(?:\\[^\x80-\x
ff]|\([^\\\x80-\xff\n\015()]*(?:\\[^\x80-\xff][^\\\x80-\xff\n\015()]*)
*\))[^\\\x80-\xff\n\015()]*)*\)[\040\t]*)*)*@[\040\t]*(?:\([^\\\x80-\x
ff\n\015()]*(?:(?:\\[^\x80-\xff]|\([^\\\x80-\xff\n\015()]*(?:\\[^\x80-
\xff][^\\\x80-\xff\n\015()]*)*\))[^\\\x80-\xff\n\015()]*)*\)[\040\t]*)
*(?:[^(\040)<>@,;:".\\\[\]\000-\037\x80-\xff]+(?![^(\040)<>@,;:".\\\[\
]\000-\037\x80-\xff])|\[(?:[^\\\x80-\xff\n\015\[\]]|\\[^\x80-\xff])*\]
)[\040\t]*(?:\([^\\\x80-\xff\n\015()]*(?:(?:\\[^\x80-\xff]|\([^\\\x80-
\xff\n\015()]*(?:\\[^\x80-\xff][^\\\x80-\xff\n\015()]*)*\))[^\\\x80-\x
ff\n\015()]*)*\)[\040\t]*)*(?:\.[\040\t]*(?:\([^\\\x80-\xff\n\015()]*(
?:(?:\\[^\x80-\xff]|\([^\\\x80-\xff\n\015()]*(?:\\[^\x80-\xff][^\\\x80
-\xff\n\015()]*)*\))[^\\\x80-\xff\n\015()]*)*\)[\040\t]*)*(?:[^(\040)<
>@,;:".\\\[\]\000-\037\x80-\xff]+(?![^(\040)<>@,;:".\\\[\]\000-\037\x8
0-\xff])|\[(?:[^\\\x80-\xff\n\015\[\]]|\\[^\x80-\xff])*\])[\040\t]*(?:
\([^\\\x80-\xff\n\015()]*(?:(?:\\[^\x80-\xff]|\([^\\\x80-\xff\n\015()]
*(?:\\[^\x80-\xff][^\\\x80-\xff\n\015()]*)*\))[^\\\x80-\xff\n\015()]*)
*\)[\040\t]*)*)*>)
EOF 
```

* * *

## 回答 #15

> 赞同：46
> 
> 时间：2011-12-21T08:40:17.037

当您使用 PHP 编写代码时，我建议您使用 PHP 内置的电子邮件验证。

```
filter_var($value, FILTER_VALIDATE_EMAIL) 
```

如果您运行的 PHP 版本低于 5.3.6，请注意此问题：*[错误 #53091：当我尝试过滤大于 2264 个字符的文本时崩溃](https://bugs.php.net/bug.php?id=53091)*

如果您想了解更多有关此内置验证如何工作的信息，请参阅此处：*[PHP 的 filter_var FILTER_VALIDATE_EMAIL 是否真的有效？](https://stackoverflow.com/questions/3722831/does-phps-filter-var-filter-validate-email-actually-work)*

* * *

## 回答 #16

> 赞同：43
> 
> 时间：2008-10-14T16:35:44.180

[Cal Henderson](http://www.iamcal.com/) (Flickr) 写了一篇名为*[Parsing Email Addresses in PHP](http://www.iamcal.com/publish/articles/php/parsing_email/)*的文章，并展示了如何正确地进行符合 RFC (2)822 的电子邮件地址解析。

您还可以获得[知识共享许可的](http://creativecommons.org/licenses/by-sa/2.5/)[PHP](http://code.iamcal.com/php/rfc822/)、Python 和 Ruby源代码。

* * *

## 回答 #17

> 赞同：42
> 
> 时间：2008-10-14T14:23:11.577

我从不费心用自己的正则表达式创建，因为很可能其他人已经想出了更好的版本。我总是使用[regexlib](http://regexlib.com/Search.aspx)来找到我喜欢的一个。

* * *

## 回答 #18

> 赞同：40
> 
> 时间：2009-10-22T21:54:40.900

一个至少不会拒绝任何有效电子邮件地址的简单正则表达式是检查某些内容，然后是 @ 符号，然后是某个内容，然后是句点和至少 2 个内容。它不会拒绝任何内容，但在查看规范后，我找不到任何有效且被拒绝的电子邮件。

邮箱=~`/.+@[^@]+\.[^@]{2,}$/`

* * *

## 回答 #19

> 赞同：37
> 
> 时间：2008-10-14T15:38:36.903

没有一个真正有用的。我在[回答*Is there a PHP library for email address validation? 中讨论了一些问题？*](https://stackoverflow.com/questions/161342/is-there-a-php-library-for-email-address-validation#161582 "是否有用于电子邮件地址验证的 PHP 库？"), 也讨论*[了电子邮件地址的正则表达式识别难吗？](https://stackoverflow.com/questions/156430/regexp-recognition-of-email-address-hard "电子邮件地址的正则表达式识别很难吗？")*.

简而言之，不要指望一个单一的、可用的正则表达式来做正确的工作。最好的正则表达式将验证语法，而不是电子邮件的有效性（*jhohn@example.com*是正确的，但它可能会反弹......）。

* * *

## 回答 #20

> 赞同：29
> 
> 时间：2009-05-23T18:22:34.660

您可以使用 jQuery Validation 插件使用的那个：

```
/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i 
```

* * *

## 回答 #21

> 赞同：27
> 
> 时间：2009-12-18T23:40:35.093

[自 2010 年 5 月起](http://en.wikipedia.org/wiki/Internationalized_domain_name)，互联网上出现了非拉丁（中文、阿拉伯文、希腊文、希伯来文、西里尔文等）域名。每个人都必须更改使用的电子邮件正则表达式，因为这些字符肯定不会被`[a-z]/i`nor覆盖`\w`。他们都会失败。

毕竟，验证电子邮件地址的**最佳**方法仍然是实际向相关地址*发送*电子邮件以验证地址。如果电子邮件地址是用户身份验证（注册/登录/等）的一部分，那么您可以将其与用户激活系统完美结合。即向指定的电子邮件地址发送带有唯一激活密钥链接的电子邮件，并且仅当用户使用电子邮件中的链接激活新创建的帐户时才允许登录。

如果正则表达式的目的只是为了在 UI 中快速通知用户指定的电子邮件地址格式不正确，最好还是检查它是否与以下正则表达式基本匹配：

```
^([^.@]+)(\.[^.@]+)*@([^.@]+\.)+([^.@]+)$ 
```

就那么简单。为什么你会关心名称和域中使用的字符？输入有效的电子邮件地址是客户的责任，而不是服务器的责任。即使客户输入了一个*语法上*有效的电子邮件地址，例如`aa@bb.cc`，这也不能保证它是一个合法的电子邮件地址。没有一个正则表达式可以涵盖这一点。

* * *

## 回答 #22

> 赞同：26
> 
> 时间：2010-05-28T22:03:55.283

有关验证电子邮件地址的最佳正则表达式的最全面评估，请参阅此链接；"[比较电子邮件地址验证正则表达式](http://fightingforalostcause.net/misc/2006/compare-email-regex.php)"

这是当前的顶级表达式供参考：

```
/^([\w\!\#$\%\&\'\*\+\-\/\=\?\^\`{\|\}\~]+\.)*[\w\!\#$\%\&\'\*\+\-\/\=\?\^\`{\|\}\~]+@((((([a-z0-9]{1}[a-z0-9\-]{0,62}[a-z0-9]{1})|[a-z])\.)+[a-z]{2,6})|(\d{1,3}\.){3}\d{1,3}(\:\d{1,5})?)$/i 
```

* * *

## 回答 #23

> 赞同：21
> 
> 时间：2015-08-14T12:30:42.953

[HTML5 规范建议](http://www.w3.org/TR/html5/forms.html#valid-e-mail-address)使用简单的正则表达式来验证电子邮件地址：

```
/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/ 
```

这故意不符合[RFC 5322](https://www.rfc-editor.org/rfc/rfc5322)。

> **注意：**此要求是对[RFC 5322的](https://www.rfc-editor.org/rfc/rfc5322)[故意违反](http://www.w3.org/TR/html5/introduction.html#willful-violation)，它为电子邮件地址定义了一种同时过于严格（在字符之前）、过于模糊（在字符之后）和过于宽松（允许注释、空白字符、并以大多数用户不熟悉的方式引用字符串）在这里可以实际使用。`@``@`

[根据RFC 3696 勘误表 1690](https://www.rfc-editor.org/errata_search.php?rfc=3696&eid=1690)，总长度也可以限制为 254 个字符。

* * *

## 回答 #24

> 赞同：16
> 
> 时间：2009-06-25T15:15:07.187

作为一个生动的演示，下面这个怪物相当不错，但它仍然不能正确识别所有语法上有效的电子邮件地址：它可以识别最多四层深度的嵌套评论。

这是解析器的工作，但即使地址在语法上有效，它仍然可能无法交付。有时你不得不诉诸乡下人的方法，“嘿，你们，看我们！”

```
// derivative of work with the following copyright and license:
// Copyright (c) 2004 Casey West.  All rights reserved.
// This module is free software; you can redistribute it and/or
// modify it under the same terms as Perl itself.

// see http://search.cpan.org/~cwest/Email-Address-1.80/

private static string gibberish = @"
(?-xism:(?:(?-xism:(?-xism:(?-xism:(?-xism:(?-xism:(?-xism:\
s*\((?:\s*(?-xism:(?-xism:(?>[^()\\]+))|(?-xism:\\(?-xism:[^
\x0A\x0D]))|(?-xism:\s*\((?:\s*(?-xism:(?-xism:(?>[^()\\]+))
|(?-xism:\\(?-xism:[^\x0A\x0D]))|)+)*\s*\)\s*))+)*\s*\)\s*)+
|\s+)*[^\x00-\x1F\x7F()<>\[\]:;@\,.<DQ>\s]+(?-xism:(?-xism:\
s*\((?:\s*(?-xism:(?-xism:(?>[^()\\]+))|(?-xism:\\(?-xism:[^
\x0A\x0D]))|(?-xism:\s*\((?:\s*(?-xism:(?-xism:(?>[^()\\]+))
|(?-xism:\\(?-xism:[^\x0A\x0D]))|)+)*\s*\)\s*))+)*\s*\)\s*)+
|\s+)*)|(?-xism:(?-xism:(?-xism:\s*\((?:\s*(?-xism:(?-xism:(
?>[^()\\]+))|(?-xism:\\(?-xism:[^\x0A\x0D]))|(?-xism:\s*\((?
:\s*(?-xism:(?-xism:(?>[^()\\]+))|(?-xism:\\(?-xism:[^\x0A\x
0D]))|)+)*\s*\)\s*))+)*\s*\)\s*)+|\s+)*<DQ>(?-xism:(?-xism:[
^\\<DQ>])|(?-xism:\\(?-xism:[^\x0A\x0D])))+<DQ>(?-xism:(?-xi
sm:\s*\((?:\s*(?-xism:(?-xism:(?>[^()\\]+))|(?-xism:\\(?-xis
m:[^\x0A\x0D]))|(?-xism:\s*\((?:\s*(?-xism:(?-xism:(?>[^()\\
]+))|(?-xism:\\(?-xism:[^\x0A\x0D]))|)+)*\s*\)\s*))+)*\s*\)\
s*)+|\s+)*))+)?(?-xism:(?-xism:(?-xism:\s*\((?:\s*(?-xism:(?
-xism:(?>[^()\\]+))|(?-xism:\\(?-xism:[^\x0A\x0D]))|(?-xism:
\s*\((?:\s*(?-xism:(?-xism:(?>[^()\\]+))|(?-xism:\\(?-xism:[
^\x0A\x0D]))|)+)*\s*\)\s*))+)*\s*\)\s*)+|\s+)*<(?-xism:(?-xi
sm:(?-xism:(?-xism:(?-xism:\s*\((?:\s*(?-xism:(?-xism:(?>[^(
)\\]+))|(?-xism:\\(?-xism:[^\x0A\x0D]))|(?-xism:\s*\((?:\s*(
?-xism:(?-xism:(?>[^()\\]+))|(?-xism:\\(?-xism:[^\x0A\x0D]))
|)+)*\s*\)\s*))+)*\s*\)\s*)+|\s+)*(?-xism:[^\x00-\x1F\x7F()<
>\[\]:;@\,.<DQ>\s]+(?:\.[^\x00-\x1F\x7F()<>\[\]:;@\,.<DQ>\s]
+)*)(?-xism:(?-xism:\s*\((?:\s*(?-xism:(?-xism:(?>[^()\\]+))
|(?-xism:\\(?-xism:[^\x0A\x0D]))|(?-xism:\s*\((?:\s*(?-xism:
(?-xism:(?>[^()\\]+))|(?-xism:\\(?-xism:[^\x0A\x0D]))|)+)*\s
*\)\s*))+)*\s*\)\s*)+|\s+)*)|(?-xism:(?-xism:(?-xism:\s*\((?
:\s*(?-xism:(?-xism:(?>[^()\\]+))|(?-xism:\\(?-xism:[^\x0A\x
0D]))|(?-xism:\s*\((?:\s*(?-xism:(?-xism:(?>[^()\\]+))|(?-xi
sm:\\(?-xism:[^\x0A\x0D]))|)+)*\s*\)\s*))+)*\s*\)\s*)+|\s+)*
<DQ>(?-xism:(?-xism:[^\\<DQ>])|(?-xism:\\(?-xism:[^\x0A\x0D]
)))+<DQ>(?-xism:(?-xism:\s*\((?:\s*(?-xism:(?-xism:(?>[^()\\
]+))|(?-xism:\\(?-xism:[^\x0A\x0D]))|(?-xism:\s*\((?:\s*(?-x
ism:(?-xism:(?>[^()\\]+))|(?-xism:\\(?-xism:[^\x0A\x0D]))|)+
)*\s*\)\s*))+)*\s*\)\s*)+|\s+)*))\@(?-xism:(?-xism:(?-xism:(
?-xism:\s*\((?:\s*(?-xism:(?-xism:(?>[^()\\]+))|(?-xism:\\(?
-xism:[^\x0A\x0D]))|(?-xism:\s*\((?:\s*(?-xism:(?-xism:(?>[^
()\\]+))|(?-xism:\\(?-xism:[^\x0A\x0D]))|)+)*\s*\)\s*))+)*\s
*\)\s*)+|\s+)*(?-xism:[^\x00-\x1F\x7F()<>\[\]:;@\,.<DQ>\s]+(
?:\.[^\x00-\x1F\x7F()<>\[\]:;@\,.<DQ>\s]+)*)(?-xism:(?-xism:
\s*\((?:\s*(?-xism:(?-xism:(?>[^()\\]+))|(?-xism:\\(?-xism:[
^\x0A\x0D]))|(?-xism:\s*\((?:\s*(?-xism:(?-xism:(?>[^()\\]+)
)|(?-xism:\\(?-xism:[^\x0A\x0D]))|)+)*\s*\)\s*))+)*\s*\)\s*)
+|\s+)*)|(?-xism:(?-xism:(?-xism:\s*\((?:\s*(?-xism:(?-xism:
(?>[^()\\]+))|(?-xism:\\(?-xism:[^\x0A\x0D]))|(?-xism:\s*\((
?:\s*(?-xism:(?-xism:(?>[^()\\]+))|(?-xism:\\(?-xism:[^\x0A\
x0D]))|)+)*\s*\)\s*))+)*\s*\)\s*)+|\s+)*\[(?:\s*(?-xism:(?-x
ism:[^\[\]\\])|(?-xism:\\(?-xism:[^\x0A\x0D])))+)*\s*\](?-xi
sm:(?-xism:\s*\((?:\s*(?-xism:(?-xism:(?>[^()\\]+))|(?-xism:
\\(?-xism:[^\x0A\x0D]))|(?-xism:\s*\((?:\s*(?-xism:(?-xism:(
?>[^()\\]+))|(?-xism:\\(?-xism:[^\x0A\x0D]))|)+)*\s*\)\s*))+
)*\s*\)\s*)+|\s+)*)))>(?-xism:(?-xism:\s*\((?:\s*(?-xism:(?-
xism:(?>[^()\\]+))|(?-xism:\\(?-xism:[^\x0A\x0D]))|(?-xism:\
s*\((?:\s*(?-xism:(?-xism:(?>[^()\\]+))|(?-xism:\\(?-xism:[^
\x0A\x0D]))|)+)*\s*\)\s*))+)*\s*\)\s*)+|\s+)*))|(?-xism:(?-x
ism:(?-xism:(?-xism:(?-xism:\s*\((?:\s*(?-xism:(?-xism:(?>[^
()\\]+))|(?-xism:\\(?-xism:[^\x0A\x0D]))|(?-xism:\s*\((?:\s*
(?-xism:(?-xism:(?>[^()\\]+))|(?-xism:\\(?-xism:[^\x0A\x0D])
)|)+)*\s*\)\s*))+)*\s*\)\s*)+|\s+)*(?-xism:[^\x00-\x1F\x7F()
<>\[\]:;@\,.<DQ>\s]+(?:\.[^\x00-\x1F\x7F()<>\[\]:;@\,.<DQ>\s
]+)*)(?-xism:(?-xism:\s*\((?:\s*(?-xism:(?-xism:(?>[^()\\]+)
)|(?-xism:\\(?-xism:[^\x0A\x0D]))|(?-xism:\s*\((?:\s*(?-xism
:(?-xism:(?>[^()\\]+))|(?-xism:\\(?-xism:[^\x0A\x0D]))|)+)*\
s*\)\s*))+)*\s*\)\s*)+|\s+)*)|(?-xism:(?-xism:(?-xism:\s*\((
?:\s*(?-xism:(?-xism:(?>[^()\\]+))|(?-xism:\\(?-xism:[^\x0A\
x0D]))|(?-xism:\s*\((?:\s*(?-xism:(?-xism:(?>[^()\\]+))|(?-x
ism:\\(?-xism:[^\x0A\x0D]))|)+)*\s*\)\s*))+)*\s*\)\s*)+|\s+)
*<DQ>(?-xism:(?-xism:[^\\<DQ>])|(?-xism:\\(?-xism:[^\x0A\x0D
])))+<DQ>(?-xism:(?-xism:\s*\((?:\s*(?-xism:(?-xism:(?>[^()\
\]+))|(?-xism:\\(?-xism:[^\x0A\x0D]))|(?-xism:\s*\((?:\s*(?-
xism:(?-xism:(?>[^()\\]+))|(?-xism:\\(?-xism:[^\x0A\x0D]))|)
+)*\s*\)\s*))+)*\s*\)\s*)+|\s+)*))\@(?-xism:(?-xism:(?-xism:
(?-xism:\s*\((?:\s*(?-xism:(?-xism:(?>[^()\\]+))|(?-xism:\\(
?-xism:[^\x0A\x0D]))|(?-xism:\s*\((?:\s*(?-xism:(?-xism:(?>[
^()\\]+))|(?-xism:\\(?-xism:[^\x0A\x0D]))|)+)*\s*\)\s*))+)*\
s*\)\s*)+|\s+)*(?-xism:[^\x00-\x1F\x7F()<>\[\]:;@\,.<DQ>\s]+
(?:\.[^\x00-\x1F\x7F()<>\[\]:;@\,.<DQ>\s]+)*)(?-xism:(?-xism
:\s*\((?:\s*(?-xism:(?-xism:(?>[^()\\]+))|(?-xism:\\(?-xism:
[^\x0A\x0D]))|(?-xism:\s*\((?:\s*(?-xism:(?-xism:(?>[^()\\]+
))|(?-xism:\\(?-xism:[^\x0A\x0D]))|)+)*\s*\)\s*))+)*\s*\)\s*
)+|\s+)*)|(?-xism:(?-xism:(?-xism:\s*\((?:\s*(?-xism:(?-xism
:(?>[^()\\]+))|(?-xism:\\(?-xism:[^\x0A\x0D]))|(?-xism:\s*\(
(?:\s*(?-xism:(?-xism:(?>[^()\\]+))|(?-xism:\\(?-xism:[^\x0A
\x0D]))|)+)*\s*\)\s*))+)*\s*\)\s*)+|\s+)*\[(?:\s*(?-xism:(?-
xism:[^\[\]\\])|(?-xism:\\(?-xism:[^\x0A\x0D])))+)*\s*\](?-x
ism:(?-xism:\s*\((?:\s*(?-xism:(?-xism:(?>[^()\\]+))|(?-xism
:\\(?-xism:[^\x0A\x0D]))|(?-xism:\s*\((?:\s*(?-xism:(?-xism:
(?>[^()\\]+))|(?-xism:\\(?-xism:[^\x0A\x0D]))|)+)*\s*\)\s*))
+)*\s*\)\s*)+|\s+)*))))(?-xism:\s*\((?:\s*(?-xism:(?-xism:(?
>[^()\\]+))|(?-xism:\\(?-xism:[^\x0A\x0D]))|(?-xism:\s*\((?:
\s*(?-xism:(?-xism:(?>[^()\\]+))|(?-xism:\\(?-xism:[^\x0A\x0
D]))|)+)*\s*\)\s*))+)*\s*\)\s*)*)"
  .Replace("<DQ>", "\"")
  .Replace("\t", "")
  .Replace(" ", "")
  .Replace("\r", "")
  .Replace("\n", "");

private static Regex mailbox =
  new Regex(gibberish, RegexOptions.ExplicitCapture); 
```

* * *

## 回答 #25

> 赞同：12
> 
> 时间：2010-12-29T12:58:28.210

根据官方标准[RFC 2822](https://www.rfc-editor.org/rfc/rfc2822#section-3.4.1)，有效的电子邮件正则表达式是：

```
(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\]) 
```

如果你想在 Java 中使用它，那真的非常简单：

```
import java.util.regex.*;

class regexSample 
{
   public static void main(String args[]) 
   {
      //Input the string for validation
      String email = "xyz@hotmail.com";

      //Set the email pattern string
      Pattern p = Pattern.compile(" (?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"
              +"(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\x7f]|\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*\")"
                     + "@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21-\\x5a\\x53-\\x7f]|\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)\\]");

      //Match the given string with the pattern
      Matcher m = p.matcher(email);

      //Check whether match is found 
      boolean matchFound = m.matches();

      if (matchFound)
        System.out.println("Valid Email Id.");
      else
        System.out.println("Invalid Email Id.");
   }
} 
```

* * *

## 回答 #26

> 赞同：11
> 
> 时间：2009-11-20T16:05:42.550

RFC 5322 标准：

允许点原子本地部分、引用字符串本地部分、过时（混合点原子和引用字符串）本地部分、域名域、（IPv4、IPv6 和 IPv4 映射的 IPv6 地址）域文字域，和（嵌套的）CFWS。

```
'/^(?!(?>(?1)"?(?>\\\[ -~]|[^"])"?(?1)){255,})(?!(?>(?1)"?(?>\\\[ -~]|[^"])"?(?1)){65,}@)((?>(?>(?>((?>(?>(?>\x0D\x0A)?[\t ])+|(?>[\t ]*\x0D\x0A)?[\t ]+)?)(\((?>(?2)(?>[\x01-\x08\x0B\x0C\x0E-\'*-\[\]-\x7F]|\\\[\x00-\x7F]|(?3)))*(?2)\)))+(?2))|(?2))?)([!#-\'*+\/-9=?^-~-]+|"(?>(?2)(?>[\x01-\x08\x0B\x0C\x0E-!#-\[\]-\x7F]|\\\[\x00-\x7F]))*(?2)")(?>(?1)\.(?1)(?4))*(?1)@(?!(?1)[a-z0-9-]{64,})(?1)(?>([a-z0-9](?>[a-z0-9-]*[a-z0-9])?)(?>(?1)\.(?!(?1)[a-z0-9-]{64,})(?1)(?5)){0,126}|\[(?:(?>IPv6:(?>([a-f0-9]{1,4})(?>:(?6)){7}|(?!(?:.*[a-f0-9][:\]]){8,})((?6)(?>:(?6)){0,6})?::(?7)?))|(?>(?>IPv6:(?>(?6)(?>:(?6)){5}:|(?!(?:.*[a-f0-9]:){6,})(?8)?::(?>((?6)(?>:(?6)){0,4}):)?))?(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])(?>\.(?9)){3}))\])(?1)$/isD' 
```

RFC 5321 标准：

允许点原子本地部分、引用字符串本地部分、域名域和（IPv4、IPv6 和 IPv4 映射的 IPv6 地址）域文字域。

```
'/^(?!(?>"?(?>\\\[ -~]|[^"])"?){255,})(?!"?(?>\\\[ -~]|[^"]){65,}"?@)(?>([!#-\'*+\/-9=?^-~-]+)(?>\.(?1))*|"(?>[ !#-\[\]-~]|\\\[ -~])*")@(?!.*[^.]{64,})(?>([a-z0-9](?>[a-z0-9-]*[a-z0-9])?)(?>\.(?2)){0,126}|\[(?:(?>IPv6:(?>([a-f0-9]{1,4})(?>:(?3)){7}|(?!(?:.*[a-f0-9][:\]]){8,})((?3)(?>:(?3)){0,6})?::(?4)?))|(?>(?>IPv6:(?>(?3)(?>:(?3)){5}:|(?!(?:.*[a-f0-9]:){6,})(?5)?::(?>((?3)(?>:(?3)){0,4}):)?))?(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])(?>\.(?6)){3}))\])$/iD' 
```

基本的：

允许点原子本地部分和域名域（需要至少两个域名标签，TLD 限制为 2-6 个字母字符）。

```
"/^(?!.{255,})(?!.{65,}@)([!#-'*+\/-9=?^-~-]+)(?>\.(?1))*@(?!.*[^.]{64,})(?>[a-z0-9](?>[a-z0-9-]*[a-z0-9])?\.){1,126}[a-z]{2,6}$/iD" 
```

* * *

## 回答 #27

> 赞同：11
> 
> 时间：2011-07-20T03:37:42.630

这是我使用的 PHP 代码。我选择这个解决方案是本着“误报优于误报”的精神，正如另一位评论者在这里所声明的那样*，*关于保持您的响应时间和服务器负载......真的没有必要浪费服务器资源当这将清除最简单的用户错误时的正则表达式。如果需要，您可以随时通过发送测试电子邮件来跟进。

```
function validateEmail($email) {
  return (bool) stripos($email,'@');
} 
```

* * *

## 回答 #28

> 赞同：9
> 
> 时间：2012-12-02T06:15:39.333

我一直在使用这个 OP 正则表达式的修饰版本，它并没有给我留下太多惊喜。~~我从未在电子邮件中遇到过撇号，因此无法验证~~. 它确实验证了`Jean+François@anydomain.museum`和`试@例子.测试.مثال.آزمایشی`，但不是奇怪滥用那些非字母数字字符`.+@you.com`。

```
(?!^[.+&'_-]*@.*$)(^[_\w\d+&'-]+(\.[_\w\d+&'-]*)*@[\w\d-]+(\.[\w\d-]+)*\.(([\d]{1,3})|([\w]{2,}))$) 
```

它确实支持 IP 地址`you@192.168.1.1`，但我还没有完善它来处理虚假的 IP 地址范围，例如`999.999.999.1`.

~~它还支持超过三个字符的所有 TLD `asdf@asdf.asdf`，我认为原来的字符会停止。~~ [我被打败了，现在超过 3 个字符的 TLD 太多了](http://data.iana.org/TLD/tlds-alpha-by-domain.txt)。

我知道 OP 已经放弃了他的正则表达式，但这种味道仍然存在。

* * *

## 回答 #29

> 赞同：8
> 
> 时间：2008-11-06T04:48:18.237

奇怪的是，您“不能”允许 4 个字符的顶级域名。您正在禁止人们使用*.info*和*.name*，并且长度限制停止*.travel*和*.museum*，但是是的，它们比 2 个字符的 TLD 和 3 个字符的 TLD 少见。

您也应该允许使用大写字母。电子邮件系统将规范本地部分和域部分。

对于您的域部分正则表达式，域名不能以“-”开头，也不能以“-”结尾。Dash 只能停留在两者之间。

如果您使用[PEAR](https://en.wikipedia.org/wiki/PEAR)库，请查看他们的邮件功能（我忘记了确切的名称/库）。您可以通过调用一个函数来验证电子邮件地址，它会根据[RFC 822](https://en.wikipedia.org/wiki/Email)中的定义来验证电子邮件地址。

* * *

## 回答 #30

> 赞同：8
> 
> 时间：2012-04-28T09:45:03.007

如果您可以接受空值（这不是无效的电子邮件）并且正在运行 PHP 5.2+，我建议：

```
static public function checkEmail($email, $ignore_empty = false) {
    if($ignore_empty && (is_null($email) || $email == ''))
        return true;
    return filter_var($email, FILTER_VALIDATE_EMAIL);
} 
```

* * *

## 回答 #31

> 赞同：7
> 
> 时间：2011-08-02T06:50:12.880

```
public bool ValidateEmail(string sEmail)
{
    if (sEmail == null)
    {
        return false;
    }

    int nFirstAT = sEmail.IndexOf('@');
    int nLastAT = sEmail.LastIndexOf('@');

    if ((nFirstAT > 0) && (nLastAT == nFirstAT) && (nFirstAT < (sEmail.Length - 1)))
    {
        return (Regex.IsMatch(sEmail, @"^[a-z|0-9|A-Z]*([_][a-z|0-9|A-Z]+)*([.][a-z|0-9|A-Z]+)*([.][a-z|0-9|A-Z]+)*(([_][a-z|0-9|A-Z]+)*)?@[a-z][a-z|0-9|A-Z]*\.([a-z][a-z|0-9|A-Z]*(\.[a-z][a-z|0-9|A-Z]*)?)$"));
    }
    else
    {
        return false;
    }
} 
```

* * *

## 回答 #32

> 赞同：7
> 
> 时间：2020-09-11T05:53:19.573

电子邮件地址的正则表达式是：

```
/^("(?:[!#-\[\]-\u{10FFFF}]|\\[\t -\u{10FFFF}])*"|[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}](?:\.?[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}])*)@([!#-'*+\-/-9=?A-Z\^-\u{10FFFF}](?:\.?[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}])*|\[[!-Z\^-\u{10FFFF}]*\])$/u 
```

此正则表达式与[RFC 5321](https://www.rfc-editor.org/rfc/rfc5321#section-4.5.3.1)、[RFC 5322](https://www.rfc-editor.org/rfc/rfc5322#section-3.4.1)和[RFC 6532](https://www.rfc-editor.org/rfc/rfc6532#section-3.2)中指定的非过时电子邮件地址的`addr-spec` [ABNF](https://en.wikipedia.org/wiki/Augmented_Backus%E2%80%93Naur_form) 100% 相同。

此外，您必须验证：

*   电子邮件地址是格式正确的 UTF-8（或 ASCII，如果您无法发送到国际化电子邮件地址）
*   地址不超过 320 个 UTF-8 字节
*   用户部分（第一个匹配组）不超过 64 个 UTF-8 字节
*   域部分（第二个匹配组）不超过 255 个 UTF-8 字节

完成所有这些的最简单方法是使用现有函数。在 PHP 中，使用and查看[filter_var](https://www.php.net/manual/en/function.filter-var)函数（如果您可以发送到国际化的电子邮件地址）：`FILTER_VALIDATE_EMAIL``FILTER_FLAG_EMAIL_UNICODE`

```
$email_valid = filter_var($email_input, FILTER_VALIDATE_EMAIL, FILTER_FLAG_EMAIL_UNICODE); 
```

但是，也许您正在构建这样一个函数——实际上，实现它的最简单方法是使用正则表达式。

请记住，这仅验证电子邮件地址不会导致语法错误。验证该地址是否可以接收电子邮件的唯一方法是*实际*发送电子邮件。

接下来，我将介绍如何生成这个正则表达式。

* * *

我写了一个新的答案，因为这里的大多数答案都犯了一个错误，要么指定了一个过于严格的模式（因此没有很好地老化）；或者他们提供一个正则表达式，它实际上匹配[MIME](https://en.wikipedia.org/wiki/MIME)消息的标题，而不是电子邮件地址本身。

只要没有递归部分，完全可以从 ABNF 制作正则表达式。

RFC 5322 规定了在 MIME 消息中发送什么是合法的；认为这是合法电子邮件地址的上限。

*然而，完全遵循这个 ABNF 将是一个错误：这种模式在技术上表示您如何在 MIME 消息中*编码电子邮件地址，并允许字符串不是电子邮件地址的一部分，例如折叠空格和注释；并且它包括对不合法生成的过时表单的支持（但服务器出于历史原因读取）。电子邮件地址不包括这些。

RFC 5322 解释：

> atom 和 dot-atom 都被解释为一个单元，由组成它的字符串组成。从语义上讲，围绕其余字符的可选注释和 FWS 不是原子的一部分；原子只是原子中的 atext 字符的运行，或 atext 和“。” 点原子中的字符。

> 在某些定义中，会有名称以“obs-”开头的非终结符。这些“obs-”元素指的是第 4 节中过时语法中定义的标记。在所有情况下，为了生成合法的 Internet 消息，这些产生式都应被忽略，并且不得用作此类消息的一部分。

如果您从RFC 5322 中删除`CFWS`、`BWS`和`obs-*`规则，并对结果进行一些优化（我使用了["greenery"](https://github.com/qntm/greenery)），您可以生成这个正则表达式，用斜杠引用并锚定（适用于 ECMAScript 和兼容的方言，为了清楚起见，添加了换行符）：`addr-spec`

```
/^("(?:[!#-\[\]-~]|\\[\t -~])*"|[!#-'*+\-/-9=?A-Z\^-~](?:\.?[!#-'*+\-/-9=?A-Z\^-~])*)
@([!#-'*+\-/-9=?A-Z\^-~](?:\.?[!#-'*+\-/-9=?A-Z\^-~])*|\[[!-Z\^-~]*\])$/ 
```

这仅支持 ASCII 电子邮件地址。要支持[RFC 6532 Internationalized Email Addresses](https://www.rfc-editor.org/rfc/rfc6532#section-3.2)，请将`~`字符替换为`\u{10FFFF}`(PHP, ECMAScript with the `u`flag)，或`\uFFFF`(对于 UTF-16 实现，如[.NET](https://en.wikipedia.org/wiki/.NET_Framework)和较旧的 ECMAScript/JavaScript)：

```
/^("(?:[!#-\[\]-\u{10FFFF}]|\\[\t -\u{10FFFF}])*"|[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}](?:\.?[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}])*)@([!#-'*+\-/-9=?A-Z\^-\u{10FFFF}](?:\.?[!#-'*+\-/-9=?A-Z\^-\u{10FFFF}])*|\[[!-Z\^-\u{10FFFF}]*\])$/u 
```

这是可行的，因为我们使用的 ABNF 不是递归的，因此形成了一个可以转换为正则表达式的非递归正则文法。

它像这样分解：

*   用户部分（在 之前`@`）可以是点原子或带引号的字符串
*   `"([!#-\[\]-~]|\\[\t -~])*"`指定用户的引号字符串形式，例如`"root@home"@example.com`. 它允许双引号内的任何非控制字符；除了空格、制表符、双引号和反斜杠必须进行反斜杠转义。
*   `[!#-'*+\-/-9=?A-Z\^-~]`是用户的点原子的第一个字符。
*   `(\.?[!#-'*+\-/-9=?A-Z\^-~])*`匹配点原子的其余部分，允许点（除了在另一个点之后，或者作为最后一个字符）。
*   `@`表示域。
*   域部分可以是点原子或域文字。
*   `[!#-'*+\-/-9=?A-Z\^-~](\.?[!#-'*+\-/-9=?A-Z\^-~])*`与上面的点原子形式相同，但这里它代表域名和 IPv4 地址。
*   `\[[!-Z\^-~]*\]`将匹配 IPv6 地址和主机名的未来定义。

此正则表达式允许所有符合规范的电子邮件地址，并且可以在 MIME 消息中逐字使用（行长度限制除外，在这种情况下必须添加折叠空格）。

这也设置了非捕获组，例如`match[1]`用户，`match[2]`主机。（但是，如果`match[1]`以双引号开头，则过滤掉反斜杠转义，以及开始和结束双引号：`"root"@example.com`并`root@example.com`标识相同的收件箱。）

最后，请注意[RFC 5321](https://www.rfc-editor.org/rfc/rfc5321#section-4.5.3.1)对电子邮件地址的长度设置了限制。用户部分最多可达 64 个字节，域部分最多可达 255 个字节。包括`@`字符在内，整个地址的限制为 320 字节。这是在地址被 UTF-8 编码后以字节为单位测量的；不是字符。

请注意，RFC 5322 ABNF 为域名定义了一种许可语法，允许当前已知的名称无效。这也允许将来可能成为合法的域名。这应该不是问题，因为这应该以与不存在的域名相同的方式处理。

始终考虑用户键入有效的电子邮件地址但他们无权访问的可能性。*验证电子邮件地址的唯一万无一失的方法是发送电子邮件。*

[这改编自我的文章*[E-Mail Addresses & Syntax](https://fullstack.wiki/mail/address)*。]

* * *

## 回答 #33

> 赞同：6
> 
> 时间：2009-08-25T16:19:28.347

我不相信[bortzmeyer](https://stackoverflow.com/questions/201323/how-can-i-validate-an-email-address-using-a-regular-expression/201378#201378)声称“语法（在[RFC 5322](https://en.wikipedia.org/wiki/Email#Message_format)中指定）太复杂了”（由正则表达式处理）。

这是语法（来自*[3.4.1\. Addr-Spec Specification](https://www.rfc-editor.org/rfc/rfc5322#section-3.4.1)*）：

```
addr-spec       =   local-part "@" domain
local-part      =   dot-atom / quoted-string / obs-local-part
domain          =   dot-atom / domain-literal / obs-domain
domain-literal  =   [CFWS] "[" *([FWS] dtext) [FWS] "]" [CFWS]
dtext           =   %d33-90 /          ; Printable US-ASCII
                    %d94-126 /         ;  characters not including
                    obs-dtext          ;  "[", "]", or "\" 
```

假设点原子、引用字符串、obs-local-part、obs-domain 本身就是常规语言，这是一个非常简单的语法。只需将 addr-spec 产生式中的 local-part 和 domain 替换为它们各自的产生式，您就拥有了一种正则语言，可以直接翻译成正则表达式。

* * *

## 回答 #34

> 赞同：6
> 
> 时间：2013-12-06T16:03:29.147

我知道这个问题是关于正则表达式的，但我猜测阅读这些解决方案的所有开发人员中有 90% 正在尝试验证浏览器中显示的 HTML 表单中的电子邮件地址。

如果是这种情况，我建议查看新的 HTML5`<input type="email">`表单元素：

HTML5：

```
 <input type="email" required /> 
```

CSS 3：

```
 input:required {
      background-color: rgba(255, 0, 0, 0.2);
 }

 input:focus:invalid {
     box-shadow: 0 0 1em red;
     border-color: red;
 }

 input:focus:valid {
     box-shadow: 0 0 1em green;
     border-color: green;
 } 
```

它在*[没有 JS-JSFiddle-Code Playground 的 HTML5 表单验证](http://jsfiddle.net/mYRe7/1/)*中。

这有几个优点：

1.  自动验证，无需定制解决方案：简单易实施
2.  没有 JavaScript，如果 JavaScript 被禁用也没有问题
3.  没有服务器必须为此计算任何东西
4.  用户有即时反馈
5.  旧浏览器应自动回退到输入类型“文本”
6.  移动浏览器可以显示专用键盘（@-Keyboard）
7.  使用 CSS 3，表单验证反馈非常容易

明显的缺点可能是缺少对旧浏览器的验证，但这会随着时间的推移而改变。比起这些疯狂的正则表达式杰作，我更喜欢这个。

另见：

*   *[没有 JS 的 HTML5 表单验证 - JSFiddle - 代码游乐场](http://jsfiddle.net/mYRe7/1/)*
*   *[Web 表单 - 深入研究 HTML5。一种疯狂的形式](http://diveintohtml5.info/forms.html)*
*   *[SUMO 上的 HTML5 表单验证](http://blog.mozilla.org/webdev/2011/03/14/html5-form-validation-on-sumo/)*

* * *

## 回答 #35

> 赞同：6
> 
> 时间：2014-02-27T19:13:03.113

我使用多步验证。由于没有任何完美的方法来验证电子邮件地址，因此无法制作出完美的方法，但至少您可以通知用户他/她做错了什么 - 这是我的方法：

1.  我首先使用非常基本的正则表达式进行验证，它只检查电子邮件是否包含一个 @ 符号，并且在该符号之前或之后它不是空白的。例如`/^[^@\s]+@[^@\s]+$/`

2.  如果第一个验证器没有通过（对于大多数地址来说它应该通过，尽管它并不完美），然后警告用户电子邮件无效并且不允许他/她继续输入

3.  如果通过，则针对更严格的正则表达式进行验证——这可能会禁止有效的电子邮件。如果未通过，则警告用户可能出现错误，但允许用户继续。与步骤 (1) 不同，因为这是一个明显的错误，所以不允许用户继续。

所以换句话说，第一个自由验证只是去除明显的错误，它被视为“错误”。人们键入空白地址、不带@ 符号的地址等等。这应该被视为错误。第二个更严格，但它被视为“警告”，允许用户继续输入，但警告至少检查他/她是否输入了有效条目。这里的关键在于错误/警告方法——错误是在 99.99% 的情况下不可能是有效的电子邮件。

当然，您可以调整使第一个正则表达式更自由而第二个更严格的原因。

根据您的需要，上述方法可能适合您。

* * *

## 回答 #36

> 赞同：5
> 
> 时间：2019-11-10T07:10:57.247

尽管已经添加了非常详细的答案，但我认为对于那些只是在寻找一种简单的方法来验证电子邮件地址或从 Java 中的字符串获取所有电子邮件地址的开发人员来说，这些答案已经足够复杂了。

```
public static boolean isEmailValid(@NonNull String email) {
    return android.util.Patterns.EMAIL_ADDRESS.matcher(email).matches();
} 
```

就正则表达式而言，我总是使用这个正则表达式，它适用于我的问题。

```
"[A-Z0-9a-z._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,6}" 
```

如果您希望通过匹配电子邮件正则表达式从字符串中查找所有电子邮件地址。[您可以在此链接](https://handyopinion.com/utility-method-to-get-all-email-addresses-from-a-string-in-java/)中找到一种方法。

* * *

## 回答 #37

> 赞同：4
> 
> 时间：2008-11-06T04:56:39.687

几年来，我们已经使用[http://www.aspnetmx.com/并取得了一定程度的成功。](http://www.aspnetmx.com/)您可以选择要验证的级别（例如语法检查、域检查、[MX 记录](https://en.wikipedia.org/wiki/MX_record)或实际电子邮件）。

对于前端表单，我们通常会验证域存在且语法正确，然后我们会进行更严格的验证以在批量发送邮件之前清理我们的数据库。

* * *

## 回答 #38

> 赞同：4
> 
> 时间：2009-07-06T10:29:14.853

这是电子邮件的正则表达式之一：

```
^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$ 
```

* * *

## 回答 #39

> 赞同：4
> 
> 时间：2013-01-18T14:30:02.737

我还在使用：

```
^[A-Za-z0-9._+\-\']+@[A-Za-z0-9.\-]+\.[A-Za-z]{2,}$ 
```

但随着 IPv6 和 Unicode 的出现，也许：

```
^\w[^@\s]*@[^@\s]{2,}$ 
```

是最好的。Gmail 已经允许连续点，但 Microsoft Exchange Server 2007 拒绝它们。

* * *

## 回答 #40

> 赞同：4
> 
> 时间：2014-02-06T06:38:33.260

我总是使用下面的正则表达式来验证电子邮件地址。它涵盖了基于英语语言字符的所有格式的电子邮件地址。

```
"\A(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?)\Z"; 
```

**下面给出了一个 C# 示例：**

添加程序集引用：

```
using System.Text.RegularExpressions; 
```

并使用以下方法传递电子邮件地址并获得布尔值作为回报

```
private bool IsValidEmail(string email) {
    bool isValid = false;
    const string pattern = @"\A(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?)\Z";

    isValid = email != "" && Regex.IsMatch(email, pattern);

    // Same above approach in multiple lines
    //
    //if (!email) {
    //    isValid = false;
    //} else {
    //    // email param contains a value; Pass it to the isMatch method
    //    isValid = Regex.IsMatch(email, pattern);
    //}
    return isValid;
} 
```

此方法验证参数中传递的电子邮件字符串。对于 param 为 null、空字符串、未定义或 param 值不是有效的电子邮件地址的所有情况，它将返回 false。只有当参数包含有效的电子邮件地址字符串时，它才会返回 true。

* * *

## 回答 #41

> 赞同：4
> 
> 时间：2014-07-19T03:30:06.833

如果您想改进几年来一直运行良好的正则表达式，那么答案取决于您到底想要实现什么 - 哪些类型的电子邮件地址失败了。微调电子邮件正则表达式非常困难，我还没有看到完美的解决方案。

*   如果您的应用程序本质上涉及技术性很强的东西（或组织内部的东西），那么您可能需要支持 IP 地址而不是域名，或者在电子邮件地址的“本地”部分中添加注释。
*   如果您的应用程序是跨国的，我会考虑专注于[Unicode](https://en.wikipedia.org/wiki/Unicode)和[UTF-8](https://en.wikipedia.org/wiki/UTF-8)支持。

您问题的主要答案目前链接到“完全符合 RFC-822 的正则表达式”。然而，尽管该正则表达式很复杂，并且假定它对 RFC 规则中的细节的关注，它在 Unicode 支持方面完全失败了。

我为我的大多数应用程序编写的正则表达式侧重于 Unicode 支持，以及对 RFC 标准的总体*良好*遵守：

```
/^(?!\.)((?!.*\.{2})[a-zA-Z0-9\u0080-\u00FF\u0100-\u017F\u0180-\u024F\u0250-\u02AF\u0300-\u036F\u0370-\u03FF\u0400-\u04FF\u0500-\u052F\u0530-\u058F\u0590-\u05FF\u0600-\u06FF\u0700-\u074F\u0750-\u077F\u0780-\u07BF\u07C0-\u07FF\u0900-\u097F\u0980-\u09FF\u0A00-\u0A7F\u0A80-\u0AFF\u0B00-\u0B7F\u0B80-\u0BFF\u0C00-\u0C7F\u0C80-\u0CFF\u0D00-\u0D7F\u0D80-\u0DFF\u0E00-\u0E7F\u0E80-\u0EFF\u0F00-\u0FFF\u1000-\u109F\u10A0-\u10FF\u1100-\u11FF\u1200-\u137F\u1380-\u139F\u13A0-\u13FF\u1400-\u167F\u1680-\u169F\u16A0-\u16FF\u1700-\u171F\u1720-\u173F\u1740-\u175F\u1760-\u177F\u1780-\u17FF\u1800-\u18AF\u1900-\u194F\u1950-\u197F\u1980-\u19DF\u19E0-\u19FF\u1A00-\u1A1F\u1B00-\u1B7F\u1D00-\u1D7F\u1D80-\u1DBF\u1DC0-\u1DFF\u1E00-\u1EFF\u1F00-\u1FFFu20D0-\u20FF\u2100-\u214F\u2C00-\u2C5F\u2C60-\u2C7F\u2C80-\u2CFF\u2D00-\u2D2F\u2D30-\u2D7F\u2D80-\u2DDF\u2F00-\u2FDF\u2FF0-\u2FFF\u3040-\u309F\u30A0-\u30FF\u3100-\u312F\u3130-\u318F\u3190-\u319F\u31C0-\u31EF\u31F0-\u31FF\u3200-\u32FF\u3300-\u33FF\u3400-\u4DBF\u4DC0-\u4DFF\u4E00-\u9FFF\uA000-\uA48F\uA490-\uA4CF\uA700-\uA71F\uA800-\uA82F\uA840-\uA87F\uAC00-\uD7AF\uF900-\uFAFF\.!#$%&'*+-/=?^_`{|}~\-\d]+)@(?!\.)([a-zA-Z0-9\u0080-\u00FF\u0100-\u017F\u0180-\u024F\u0250-\u02AF\u0300-\u036F\u0370-\u03FF\u0400-\u04FF\u0500-\u052F\u0530-\u058F\u0590-\u05FF\u0600-\u06FF\u0700-\u074F\u0750-\u077F\u0780-\u07BF\u07C0-\u07FF\u0900-\u097F\u0980-\u09FF\u0A00-\u0A7F\u0A80-\u0AFF\u0B00-\u0B7F\u0B80-\u0BFF\u0C00-\u0C7F\u0C80-\u0CFF\u0D00-\u0D7F\u0D80-\u0DFF\u0E00-\u0E7F\u0E80-\u0EFF\u0F00-\u0FFF\u1000-\u109F\u10A0-\u10FF\u1100-\u11FF\u1200-\u137F\u1380-\u139F\u13A0-\u13FF\u1400-\u167F\u1680-\u169F\u16A0-\u16FF\u1700-\u171F\u1720-\u173F\u1740-\u175F\u1760-\u177F\u1780-\u17FF\u1800-\u18AF\u1900-\u194F\u1950-\u197F\u1980-\u19DF\u19E0-\u19FF\u1A00-\u1A1F\u1B00-\u1B7F\u1D00-\u1D7F\u1D80-\u1DBF\u1DC0-\u1DFF\u1E00-\u1EFF\u1F00-\u1FFF\u20D0-\u20FF\u2100-\u214F\u2C00-\u2C5F\u2C60-\u2C7F\u2C80-\u2CFF\u2D00-\u2D2F\u2D30-\u2D7F\u2D80-\u2DDF\u2F00-\u2FDF\u2FF0-\u2FFF\u3040-\u309F\u30A0-\u30FF\u3100-\u312F\u3130-\u318F\u3190-\u319F\u31C0-\u31EF\u31F0-\u31FF\u3200-\u32FF\u3300-\u33FF\u3400-\u4DBF\u4DC0-\u4DFF\u4E00-\u9FFF\uA000-\uA48F\uA490-\uA4CF\uA700-\uA71F\uA800-\uA82F\uA840-\uA87F\uAC00-\uD7AF\uF900-\uFAFF\-\.\d]+)((\.([a-zA-Z\u0080-\u00FF\u0100-\u017F\u0180-\u024F\u0250-\u02AF\u0300-\u036F\u0370-\u03FF\u0400-\u04FF\u0500-\u052F\u0530-\u058F\u0590-\u05FF\u0600-\u06FF\u0700-\u074F\u0750-\u077F\u0780-\u07BF\u07C0-\u07FF\u0900-\u097F\u0980-\u09FF\u0A00-\u0A7F\u0A80-\u0AFF\u0B00-\u0B7F\u0B80-\u0BFF\u0C00-\u0C7F\u0C80-\u0CFF\u0D00-\u0D7F\u0D80-\u0DFF\u0E00-\u0E7F\u0E80-\u0EFF\u0F00-\u0FFF\u1000-\u109F\u10A0-\u10FF\u1100-\u11FF\u1200-\u137F\u1380-\u139F\u13A0-\u13FF\u1400-\u167F\u1680-\u169F\u16A0-\u16FF\u1700-\u171F\u1720-\u173F\u1740-\u175F\u1760-\u177F\u1780-\u17FF\u1800-\u18AF\u1900-\u194F\u1950-\u197F\u1980-\u19DF\u19E0-\u19FF\u1A00-\u1A1F\u1B00-\u1B7F\u1D00-\u1D7F\u1D80-\u1DBF\u1DC0-\u1DFF\u1E00-\u1EFF\u1F00-\u1FFF\u20D0-\u20FF\u2100-\u214F\u2C00-\u2C5F\u2C60-\u2C7F\u2C80-\u2CFF\u2D00-\u2D2F\u2D30-\u2D7F\u2D80-\u2DDF\u2F00-\u2FDF\u2FF0-\u2FFF\u3040-\u309F\u30A0-\u30FF\u3100-\u312F\u3130-\u318F\u3190-\u319F\u31C0-\u31EF\u31F0-\u31FF\u3200-\u32FF\u3300-\u33FF\u3400-\u4DBF\u4DC0-\u4DFF\u4E00-\u9FFF\uA000-\uA48F\uA490-\uA4CF\uA700-\uA71F\uA800-\uA82F\uA840-\uA87F\uAC00-\uD7AF\uF900-\uFAFF]){2,63})+)$/i 
```

我将避免复制粘贴完整的答案，因此我将其链接到我在此处提供的类似答案：*[如何验证 unicode 电子邮件？](https://stackoverflow.com/questions/19461943/how-to-validate-a-unicode-email/24817336#24817336)*

上面的正则表达式还有一个现场演示：http: [//jsfiddle.net/aossikine/qCLVH/3/](http://jsfiddle.net/aossikine/qCLVH/3/)

* * *

## 回答 #42

> 赞同：4
> 
> 时间：2015-07-15T22:25:52.213

对于 PHP，我使用[的是来自 Nette Framework 的电子邮件地址验证器](http://api.nette.org/2.3.3/source-Utils.Validators.php.html#234-247)：

```
/* public static */ function isEmail($value)
{
    $atom = "[-a-z0-9!#$%&'*+/=?^_`{|}~]"; // RFC 5322 unquoted characters in local-part
    $localPart = "(?:\"(?:[ !\\x23-\\x5B\\x5D-\\x7E]*|\\\\[ -~])+\"|$atom+(?:\\.$atom+)*)"; // Quoted or unquoted
    $alpha = "a-z\x80-\xFF"; // Superset of IDN
    $domain = "[0-9$alpha](?:[-0-9$alpha]{0,61}[0-9$alpha])?"; // RFC 1034 one domain component
    $topDomain = "[$alpha](?:[-0-9$alpha]{0,17}[$alpha])?";
    return (bool) preg_match("(^$localPart@(?:$domain\\.)+$topDomain\\z)i", $value);
} 
```

* * *

## 回答 #43

> 赞同：4
> 
> 时间：2015-09-12T17:58:03.017

我没有找到任何涉及[顶级域名的](https://en.wikipedia.org/wiki/Top-level_domain)，但应该考虑。

所以对我来说，以下工作：

```
[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+(?:[A-Z]{2}AAA|AARP|ABB|ABBOTT|ABOGADO|AC|ACADEMY|ACCENTURE|ACCOUNTANT|ACCOUNTANTS|ACO|ACTIVE|ACTOR|AD|ADAC|ADS|ADULT|AE|AEG|AERO|AF|AFL|AG|AGENCY|AI|AIG|AIRFORCE|AIRTEL|AL|ALIBABA|ALIPAY|ALLFINANZ|ALSACE|AM|AMICA|AMSTERDAM|ANALYTICS|ANDROID|AO|APARTMENTS|APP|APPLE|AQ|AQUARELLE|AR|ARAMCO|ARCHI|ARMY|ARPA|ARTE|AS|ASIA|ASSOCIATES|AT|ATTORNEY|AU|AUCTION|AUDI|AUDIO|AUTHOR|AUTO|AUTOS|AW|AX|AXA|AZ|AZURE|BA|BAIDU|BAND|BANK|BAR|BARCELONA|BARCLAYCARD|BARCLAYS|BARGAINS|BAUHAUS|BAYERN|BB|BBC|BBVA|BCN|BD|BE|BEATS|BEER|BENTLEY|BERLIN|BEST|BET|BF|BG|BH|BHARTI|BI|BIBLE|BID|BIKE|BING|BINGO|BIO|BIZ|BJ|BLACK|BLACKFRIDAY|BLOOMBERG|BLUE|BM|BMS|BMW|BN|BNL|BNPPARIBAS|BO|BOATS|BOEHRINGER|BOM|BOND|BOO|BOOK|BOOTS|BOSCH|BOSTIK|BOT|BOUTIQUE|BR|BRADESCO|BRIDGESTONE|BROADWAY|BROKER|BROTHER|BRUSSELS|BS|BT|BUDAPEST|BUGATTI|BUILD|BUILDERS|BUSINESS|BUY|BUZZ|BV|BW|BY|BZ|BZH|CA|CAB|CAFE|CAL|CALL|CAMERA|CAMP|CANCERRESEARCH|CANON|CAPETOWN|CAPITAL|CAR|CARAVAN|CARDS|CARE|CAREER|CAREERS|CARS|CARTIER|CASA|CASH|CASINO|CAT|CATERING|CBA|CBN|CC|CD|CEB|CENTER|CEO|CERN|CF|CFA|CFD|CG|CH|CHANEL|CHANNEL|CHAT|CHEAP|CHLOE|CHRISTMAS|CHROME|CHURCH|CI|CIPRIANI|CIRCLE|CISCO|CITIC|CITY|CITYEATS|CK|CL|CLAIMS|CLEANING|CLICK|CLINIC|CLINIQUE|CLOTHING|CLOUD|CLUB|CLUBMED|CM|CN|CO|COACH|CODES|COFFEE|COLLEGE|COLOGNE|COM|COMMBANK|COMMUNITY|COMPANY|COMPARE|COMPUTER|COMSEC|CONDOS|CONSTRUCTION|CONSULTING|CONTACT|CONTRACTORS|COOKING|COOL|COOP|CORSICA|COUNTRY|COUPONS|COURSES|CR|CREDIT|CREDITCARD|CREDITUNION|CRICKET|CROWN|CRS|CRUISES|CSC|CU|CUISINELLA|CV|CW|CX|CY|CYMRU|CYOU|CZ|DABUR|DAD|DANCE|DATE|DATING|DATSUN|DAY|DCLK|DE|DEALER|DEALS|DEGREE|DELIVERY|DELL|DELTA|DEMOCRAT|DENTAL|DENTIST|DESI|DESIGN|DEV|DIAMONDS|DIET|DIGITAL|DIRECT|DIRECTORY|DISCOUNT|DJ|DK|DM|DNP|DO|DOCS|DOG|DOHA|DOMAINS|DOOSAN|DOWNLOAD|DRIVE|DUBAI|DURBAN|DVAG|DZ|EARTH|EAT|EC|EDEKA|EDU|EDUCATION|EE|EG|EMAIL|EMERCK|ENERGY|ENGINEER|ENGINEERING|ENTERPRISES|EPSON|EQUIPMENT|ER|ERNI|ES|ESQ|ESTATE|ET|EU|EUROVISION|EUS|EVENTS|EVERBANK|EXCHANGE|EXPERT|EXPOSED|EXPRESS|FAGE|FAIL|FAIRWINDS|FAITH|FAMILY|FAN|FANS|FARM|FASHION|FAST|FEEDBACK|FERRERO|FI|FILM|FINAL|FINANCE|FINANCIAL|FIRESTONE|FIRMDALE|FISH|FISHING|FIT|FITNESS|FJ|FK|FLIGHTS|FLORIST|FLOWERS|FLSMIDTH|FLY|FM|FO|FOO|FOOTBALL|FORD|FOREX|FORSALE|FORUM|FOUNDATION|FOX|FR|FRESENIUS|FRL|FROGANS|FUND|FURNITURE|FUTBOL|FYI|GA|GAL|GALLERY|GAME|GARDEN|GB|GBIZ|GD|GDN|GE|GEA|GENT|GENTING|GF|GG|GGEE|GH|GI|GIFT|GIFTS|GIVES|GIVING|GL|GLASS|GLE|GLOBAL|GLOBO|GM|GMAIL|GMO|GMX|GN|GOLD|GOLDPOINT|GOLF|GOO|GOOG|GOOGLE|GOP|GOT|GOV|GP|GQ|GR|GRAINGER|GRAPHICS|GRATIS|GREEN|GRIPE|GROUP|GS|GT|GU|GUCCI|GUGE|GUIDE|GUITARS|GURU|GW|GY|HAMBURG|HANGOUT|HAUS|HEALTH|HEALTHCARE|HELP|HELSINKI|HERE|HERMES|HIPHOP|HITACHI|HIV|HK|HM|HN|HOCKEY|HOLDINGS|HOLIDAY|HOMEDEPOT|HOMES|HONDA|HORSE|HOST|HOSTING|HOTELES|HOTMAIL|HOUSE|HOW|HR|HSBC|HT|HU|HYUNDAI|IBM|ICBC|ICE|ICU|ID|IE|IFM|IINET|IL|IM|IMMO|IMMOBILIEN|IN|INDUSTRIES|INFINITI|INFO|ING|INK|INSTITUTE|INSURANCE|INSURE|INT|INTERNATIONAL|INVESTMENTS|IO|IPIRANGA|IQ|IR|IRISH|IS|ISELECT|IST|ISTANBUL|IT|ITAU|IWC|JAGUAR|JAVA|JCB|JE|JETZT|JEWELRY|JLC|JLL|JM|JMP|JO|JOBS|JOBURG|JOT|JOY|JP|JPRS|JUEGOS|KAUFEN|KDDI|KE|KFH|KG|KH|KI|KIA|KIM|KINDER|KITCHEN|KIWI|KM|KN|KOELN|KOMATSU|KP|KPN|KR|KRD|KRED|KW|KY|KYOTO|KZ|LA|LACAIXA|LAMBORGHINI|LAMER|LANCASTER|LAND|LANDROVER|LANXESS|LASALLE|LAT|LATROBE|LAW|LAWYER|LB|LC|LDS|LEASE|LECLERC|LEGAL|LEXUS|LGBT|LI|LIAISON|LIDL|LIFE|LIFEINSURANCE|LIFESTYLE|LIGHTING|LIKE|LIMITED|LIMO|LINCOLN|LINDE|LINK|LIVE|LIVING|LIXIL|LK|LOAN|LOANS|LOL|LONDON|LOTTE|LOTTO|LOVE|LR|LS|LT|LTD|LTDA|LU|LUPIN|LUXE|LUXURY|LV|LY|MA|MADRID|MAIF|MAISON|MAKEUP|MAN|MANAGEMENT|MANGO|MARKET|MARKETING|MARKETS|MARRIOTT|MBA|MC|MD|ME|MED|MEDIA|MEET|MELBOURNE|MEME|MEMORIAL|MEN|MENU|MEO|MG|MH|MIAMI|MICROSOFT|MIL|MINI|MK|ML|MM|MMA|MN|MO|MOBI|MOBILY|MODA|MOE|MOI|MOM|MONASH|MONEY|MONTBLANC|MORMON|MORTGAGE|MOSCOW|MOTORCYCLES|MOV|MOVIE|MOVISTAR|MP|MQ|MR|MS|MT|MTN|MTPC|MTR|MU|MUSEUM|MUTUELLE|MV|MW|MX|MY|MZ|NA|NADEX|NAGOYA|NAME|NAVY|NC|NE|NEC|NET|NETBANK|NETWORK|NEUSTAR|NEW|NEWS|NEXUS|NF|NG|NGO|NHK|NI|NICO|NINJA|NISSAN|NL|NO|NOKIA|NORTON|NOWRUZ|NP|NR|NRA|NRW|NTT|NU|NYC|NZ|OBI|OFFICE|OKINAWA|OM|OMEGA|ONE|ONG|ONL|ONLINE|OOO|ORACLE|ORANGE|ORG|ORGANIC|ORIGINS|OSAKA|OTSUKA|OVH|PA|PAGE|PAMPEREDCHEF|PANERAI|PARIS|PARS|PARTNERS|PARTS|PARTY|PE|PET|PF|PG|PH|PHARMACY|PHILIPS|PHOTO|PHOTOGRAPHY|PHOTOS|PHYSIO|PIAGET|PICS|PICTET|PICTURES|PID|PIN|PING|PINK|PIZZA|PK|PL|PLACE|PLAY|PLAYSTATION|PLUMBING|PLUS|PM|PN|POHL|POKER|PORN|POST|PR|PRAXI|PRESS|PRO|PROD|PRODUCTIONS|PROF|PROMO|PROPERTIES|PROPERTY|PROTECTION|PS|PT|PUB|PW|PY|QA|QPON|QUEBEC|RACING|RE|READ|REALTOR|REALTY|RECIPES|RED|REDSTONE|REDUMBRELLA|REHAB|REISE|REISEN|REIT|REN|RENT|RENTALS|REPAIR|REPORT|REPUBLICAN|REST|RESTAURANT|REVIEW|REVIEWS|REXROTH|RICH|RICOH|RIO|RIP|RO|ROCHER|ROCKS|RODEO|ROOM|RS|RSVP|RU|RUHR|RUN|RW|RWE|RYUKYU|SA|SAARLAND|SAFE|SAFETY|SAKURA|SALE|SALON|SAMSUNG|SANDVIK|SANDVIKCOROMANT|SANOFI|SAP|SAPO|SARL|SAS|SAXO|SB|SBS|SC|SCA|SCB|SCHAEFFLER|SCHMIDT|SCHOLARSHIPS|SCHOOL|SCHULE|SCHWARZ|SCIENCE|SCOR|SCOT|SD|SE|SEAT|SECURITY|SEEK|SELECT|SENER|SERVICES|SEVEN|SEW|SEX|SEXY|SFR|SG|SH|SHARP|SHELL|SHIA|SHIKSHA|SHOES|SHOW|SHRIRAM|SI|SINGLES|SITE|SJ|SK|SKI|SKIN|SKY|SKYPE|SL|SM|SMILE|SN|SNCF|SO|SOCCER|SOCIAL|SOFTBANK|SOFTWARE|SOHU|SOLAR|SOLUTIONS|SONY|SOY|SPACE|SPIEGEL|SPREADBETTING|SR|SRL|ST|STADA|STAR|STARHUB|STATEFARM|STATOIL|STC|STCGROUP|STOCKHOLM|STORAGE|STUDIO|STUDY|STYLE|SU|SUCKS|SUPPLIES|SUPPLY|SUPPORT|SURF|SURGERY|SUZUKI|SV|SWATCH|SWISS|SX|SY|SYDNEY|SYMANTEC|SYSTEMS|SZ|TAB|TAIPEI|TAOBAO|TATAMOTORS|TATAR|TATTOO|TAX|TAXI|TC|TCI|TD|TEAM|TECH|TECHNOLOGY|TEL|TELEFONICA|TEMASEK|TENNIS|TF|TG|TH|THD|THEATER|THEATRE|TICKETS|TIENDA|TIFFANY|TIPS|TIRES|TIROL|TJ|TK|TL|TM|TMALL|TN|TO|TODAY|TOKYO|TOOLS|TOP|TORAY|TOSHIBA|TOURS|TOWN|TOYOTA|TOYS|TR|TRADE|TRADING|TRAINING|TRAVEL|TRAVELERS|TRAVELERSINSURANCE|TRUST|TRV|TT|TUBE|TUI|TUSHU|TV|TW|TZ|UA|UBS|UG|UK|UNIVERSITY|UNO|UOL|US|UY|UZ|VA|VACATIONS|VANA|VC|VE|VEGAS|VENTURES|VERISIGN|VERSICHERUNG|VET|VG|VI|VIAJES|VIDEO|VILLAS|VIN|VIP|VIRGIN|VISION|VISTA|VISTAPRINT|VIVA|VLAANDEREN|VN|VODKA|VOLKSWAGEN|VOTE|VOTING|VOTO|VOYAGE|VU|WALES|WALTER|WANG|WANGGOU|WATCH|WATCHES|WEATHER|WEBCAM|WEBER|WEBSITE|WED|WEDDING|WEIR|WF|WHOSWHO|WIEN|WIKI|WILLIAMHILL|WIN|WINDOWS|WINE|WME|WORK|WORKS|WORLD|WS|WTC|WTF|XBOX|XEROX|XIN|XN--11B4C3D|XN--1QQW23A|XN--30RR7Y|XN--3BST00M|XN--3DS443G|XN--3E0B707E|XN--3PXU8K|XN--42C2D9A|XN--45BRJ9C|XN--45Q11C|XN--4GBRIM|XN--55QW42G|XN--55QX5D|XN--6FRZ82G|XN--6QQ986B3XL|XN--80ADXHKS|XN--80AO21A|XN--80ASEHDB|XN--80ASWG|XN--90A3AC|XN--90AIS|XN--9DBQ2A|XN--9ET52U|XN--B4W605FERD|XN--C1AVG|XN--C2BR7G|XN--CG4BKI|XN--CLCHC0EA0B2G2A9GCD|XN--CZR694B|XN--CZRS0T|XN--CZRU2D|XN--D1ACJ3B|XN--D1ALF|XN--ECKVDTC9D|XN--EFVY88H|XN--ESTV75G|XN--FHBEI|XN--FIQ228C5HS|XN--FIQ64B|XN--FIQS8S|XN--FIQZ9S|XN--FJQ720A|XN--FLW351E|XN--FPCRJ9C3D|XN--FZC2C9E2C|XN--G2XX48C|XN--GECRJ9C|XN--H2BRJ9C|XN--HXT814E|XN--I1B6B1A6A2E|XN--IMR513N|XN--IO0A7I|XN--J1AEF|XN--J1AMH|XN--J6W193G|XN--JLQ61U9W7B|XN--KCRX77D1X4A|XN--KPRW13D|XN--KPRY57D|XN--KPU716F|XN--KPUT3I|XN--L1ACC|XN--LGBBAT1AD8J|XN--MGB9AWBF|XN--MGBA3A3EJT|XN--MGBA3A4F16A|XN--MGBAAM7A8H|XN--MGBAB2BD|XN--MGBAYH7GPA|XN--MGBB9FBPOB|XN--MGBBH1A71E|XN--MGBC0A9AZCG|XN--MGBERP4A5D4AR|XN--MGBPL2FH|XN--MGBT3DHD|XN--MGBTX2B|XN--MGBX4CD0AB|XN--MK1BU44C|XN--MXTQ1M|XN--NGBC5AZD|XN--NGBE9E0A|XN--NODE|XN--NQV7F|XN--NQV7FS00EMA|XN--NYQY26A|XN--O3CW4H|XN--OGBPF8FL|XN--P1ACF|XN--P1AI|XN--PBT977C|XN--PGBS0DH|XN--PSSY2U|XN--Q9JYB4C|XN--QCKA1PMC|XN--QXAM|XN--RHQV96G|XN--S9BRJ9C|XN--SES554G|XN--T60B56A|XN--TCKWE|XN--UNUP4Y|XN--VERMGENSBERATER-CTB|XN--VERMGENSBERATUNG-PWB|XN--VHQUV|XN--VUQ861B|XN--WGBH1C|XN--WGBL6A|XN--XHQ521B|XN--XKC2AL3HYE2A|XN--XKC2DL3A5EE0H|XN--Y9A3AQ|XN--YFRO4I67O|XN--YGBI2AMMX|XN--ZFR164B|XPERIA|XXX|XYZ|YACHTS|YAMAXUN|YANDEX|YE|YODOBASHI|YOGA|YOKOHAMA|YOUTUBE|YT|ZA|ZARA|ZERO|ZIP|ZM|ZONE|ZUERICH|ZW)\b 
```

这很容易丢弃诸如`3c296rD3HNEE@d139c.a51, Sd@sd.dox`等之类的电子邮件。

如果需要，可以进一步编辑域名，例如特定国家域等。

* * *

## 回答 #44

> 赞同：4
> 
> 时间：2016-12-13T20:12:17.700

对我来说，检查电子邮件地址的正确方法是：

1.  检查符号 @ 是否存在，并且在它之前和之后有一些非 @ 符号： `/^[^@]+@[^@]+$/`
2.  尝试使用一些“激活码”向该地址发送电子邮件。
3.  当用户“激活”他/她的电子邮件地址时，我们会看到一切正常。

当然，当用户输入“奇怪”的电子邮件时，您可以在前端显示一些警告或工具提示，以帮助他/她避免常见错误，例如域部分中没有点或名称中没有引用的空格等。但是如果用户真的想要它，你必须接受地址“hello@world”。

此外，您必须记住，电子邮件地址标准曾经并且可以发展，因此您不能只输入一些“标准有效”的正则表达式，一劳永逸。而且您必须记住，一些具体的互联网服务器可能无法满足通用标准的某些细节，实际上可以使用自己的“修改后的标准”。

因此，只需检查@，在前端提示用户并在给定地址上发送验证电子邮件。

* * *

## 回答 #45

> 赞同：4
> 
> 时间：2017-02-10T00:52:03.317

几乎我见过的每一个正则表达式——包括微软使用的一些正则表达式都不允许以下*有效*电子邮件通过：`simon-@hotmail.com`

我刚刚有一个真正的客户，其电子邮件地址采用这种格式，但无法下订单。

这是我决定的：

*   一个不会有误报的最小正则表达式。或者使用`MailAddress`带有一些额外检查的构造函数（见下文）：
*   检查常见的拼写错误`.cmo`或`.gmial.com`要求确认*“您确定这是您正确的电子邮件地址吗？看起来可能有错误。”* 如果用户确定，允许用户接受他们输入的内容。
*   在实际发送电子邮件时处理退回邮件并手动验证它们以检查明显的错误。

* * *

```
try
{
    var email = new MailAddress(str);

    if (email.Host.EndsWith(".cmo"))
    {
        return EmailValidation.PossibleTypo;
    }

    if (!email.Host.EndsWith(".") && email.Host.Contains("."))
    {
        return EmailValidation.OK;
    }
}
catch
{
    return EmailValidation.Invalid;
} 
```

* * *

## 回答 #46

> 赞同：4
> 
> 时间：2018-07-13T20:27:57.840

根据[RFC 2821](http://tools.ietf.org/html/2821)和[RFC 2822](http://tools.ietf.org/html/2822)，电子邮件地址的本地部分可以使用以下任何 ASCII 字符：

1.  大写和小写字母
2.  数字 0 到 9
3.  字符，!#$%&'*+-/=?^_`{|}~
4.  性格 ”。” 前提是它不是本地部分的第一个或最后一个字符。

火柴：

*   a&d@somedomain.com
*   a*d@somedomain.com
*   a/d@somedomain.com

不匹配：

*   .abc@somedomain.com
*   abc.@somedomain.com
*   a>b@somedomain.com

对于符合 RFC 2821 和 2822 的协议，您可以使用：

```
^((([!#$%&'*+\-/=?^_`{|}~\w])|([!#$%&'*+\-/=?^_`{|}~\w][!#$%&'*+\-/=?^_`{|}~\.\w]{0,}[!#$%&'*+\-/=?^_`{|}~\w]))[@]\w+([-.]\w+)*\.\w+([-.]\w+)*)$ 
```

[电子邮件 - 符合 RFC 2821、2822](http://regexlib.com/REDetails.aspx?regexp_id=2558)

* * *

## 回答 #47

> 赞同：3
> 
> 时间：2009-12-16T00:37:16.437

没有人提到本地化问题（[i18n](https://en.wikipedia.org/wiki/Internationalization_and_localization)）。如果您有来自世界各地的客户怎么办？

然后，您需要对每个国家/地区的正则表达式进行子分类，我已经看到开发人员最终构建了一个大型字典或配置。检测用户的浏览器语言设置可能是一个很好的起点。

* * *

## 回答 #48

> 赞同：3
> 
> 时间：2011-08-05T10:26:31.443

此规则与我们的[Postfix](https://en.wikipedia.org/wiki/Postfix_(software))服务器无法发送的内容相匹配。

允许字母、数字、-、_、+、.、&、/ 和 !

没有 -foo@bar.com

没有 asd@-bar.com

```
/^([a-z0-9\+\._\/&!][-a-z0-9\+\._\/&!]*)@(([a-z0-9][-a-z0-9]*\.)([-a-z0-9]+\.)*[a-z]{2,})$/i 
```

* * *

## 回答 #49

> 赞同：3
> 
> 时间：2011-11-04T18:32:24.530

我根本不建议使用正则表达式 - 电子邮件地址太复杂了。这是一个常见问题，所以我猜想有很多库都包含一个验证器——如果你使用 Java，apache commons 验证器的EmailValidator[是](http://commons.apache.org/validator/)[一个](http://commons.apache.org/validator/apidocs/org/apache/commons/validator/EmailValidator.html)很好的。

* * *

## 回答 #50

> 赞同：3
> 
> 时间：2012-12-31T13:09:03.507

根据我的理解，它很可能会被...

```
/^([a-z0-9_-]+)(@[a-z0-9-]+)(\.[a-z]+|\.[a-z]+\.[a-z]+)?$/is 
```

* * *

## 回答 #51

> 赞同：3
> 
> 时间：2013-01-14T15:09:13.820

这是我建立的。它不是防弹版本，但它“简单”并且几乎​​可以检查所有内容。

```
[\w+-]+(?:\.[\w+-]+)*@[\w+-]+(?:\.[\w+-]+)*(?:\.[a-zA-Z]{2,4}) 
```

我认为已经有了解释，因此您可以根据需要对其进行修改：

( **e** ) `[\w+-]+`匹配 az, AZ, _, +, - 至少一次

( **m** ) `(?:\.[\w+-]+)*`匹配 az、AZ、_、+、- 零次或多次，但需要以 a 开头。（点）

`@`=`@`

( **i** ) `[\w+-]+`匹配 az, AZ, _, +, - 至少一次

( **l** ) `(?:\.[\w+-]+)*`匹配 az、AZ、_、+、- 零次或多次，但需要以 a 开头。（点）

( **com** ) `(?:\.[a-zA-Z]{2,4})`从 a 开始匹配 az, AZ 2 到 4 次。（点）

给出`e(.m)@i(.l).com`where`(.m)`和`(.l)`是可选的，但也可以重复多次。

我认为这可以验证所有有效的电子邮件地址，但在不使用在大多数情况下不需要的过于复杂的正则表达式的情况下阻止潜在的无效。

请注意，这将允许`+@-.com`，但这是保持简单的折衷方案。

* * *

## 回答 #52

> 赞同：3
> 
> 时间：2014-08-06T10:46:53.677

由于新的通用[顶级域](https://en.wikipedia.org/wiki/Top-level_domain)(gTLD) 的出现（例如 .london、.basketball、.通贩），针对此问题发布的正则表达式现已过时。要验证电子邮件地址，有两个答案（与绝大多数人相关）。

1.  正如主要答案所说 - 不要使用正则表达式。只需通过向该地址发送电子邮件来验证它（捕获无效地址的例外情况）
2.  使用非常通用的正则表达式至少确保他们使用的电子邮件结构如`{something}@{something}.{something}`. 去详细的正则表达式是没有意义的，因为你不会全部捕捉到它们，几年后会有一个新的批次，你将不得不再次更新你的正则表达式。

我决定使用正则表达式，因为不幸的是，有些用户不阅读表单并将错误的数据放在错误的字段中。当他们尝试将不是电子邮件的内容放入电子邮件输入字段时，这至少会提醒他们，并且应该为您节省一些时间来支持用户处理电子邮件问题。

```
(.+)@(.+){2,}\.(.+){2,} 
```

* * *

## 回答 #53

> 赞同：3
> 
> 时间：2014-11-07T11:14:58.407

以下是验证电子邮件地址的正则表达式：

```
^.+@\w+(\.\w+)+$ 
```

* * *

## 回答 #54

> 赞同：3
> 
> 时间：2021-02-17T15:21:21.693

如果您需要一个简单的表单来验证，您可以使用[https://regexr.com/3e48o的答案](https://regexr.com/3e48o)

```
^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$ 
```

```
let r = new RegExp(String.raw `^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$`);

//should be true
console.log(r.test('name@domain.tld'));
console.log(r.test('name@domain.co.tld'));
console.log(r.test('name@domain.co'));

//should be false
console.log(r.test('@domain.tld'));
console.log(r.test('name@.tld'));
console.log(r.test('name@domain.'));
console.log(r.test('namedomain.tld'));
console.log(r.test(''));

//now that basic client-side validation is done, send a token from the server side to validate the user actually has access to the email
```

* * *

## 回答 #55

> 赞同：2
> 
> 时间：2013-07-19T09:27:22.000

我找到了一个符合[RFC 2822](https://en.wikipedia.org/wiki/Email#Message_format)[的正则表达式](http://www.regular-expressions.info/email.html)。[RFC 5322](https://en.wikipedia.org/wiki/Email#Message_format)的上述标准。这个正则表达式似乎表现得相当好，并且可以涵盖大多数情况，但是随着 RFC 5322 成为标准，可能存在一些应该被堵住的漏洞。

```
^(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])$ 
```

文档说你不应该使用上面的正则表达式，而是更喜欢这种风格，它更易于管理。

```
[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])? 
```

我注意到这是区分大小写的，所以我实际上对这个着陆做了修改。

```
^[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?$ 
```

* * *

## 回答 #56

> 赞同：2
> 
> 时间：2013-12-05T23:58:38.767

我也有类似的愿望：希望快速检查电子邮件地址中的语法，而不会过度[使用电子邮件发送实用程序](https://www.mirbsd.org/cvs.cgi/contrib/hosted/tg/mailfrom.php?rev=HEAD)`Mail::RFC822::Address`（答案显然是正确的）。我选择了这个（我是一个[POSIX](https://en.wikipedia.org/wiki/POSIX)正则表达式的人，所以我通常不使用[PCRE](https://en.wikipedia.org/wiki/Perl_Compatible_Regular_Expressions)中的等，因为它们让我不太容易理解）：`\d`

```
preg_match("_^[-!#-'*+/-9=?A-Z^-~]+(\.[-!#-'*+/-9=?A-Z^-~]+)*@[0-9A-Za-z]([-0-9A-Za-z]{0,61}[0-9A-Za-z])?(\.[0-9A-Za-z]([-0-9A-Za-z]{0,61}[0-9A-Za-z])?)*\$_", $adr) 
```

这是 RFC 正确的，但它明确排除了过时的形式以及直接 IP 地址（IP 地址和旧 IP 地址），该实用程序的目标组中的某个人（主要是：在[IRC](https://en.wikipedia.org/wiki/Internet_Relay_Chat)上的 #sendmail 中打扰我们的人) 通常不会想要或不需要。

[IDN](https://en.wikipedia.org/wiki/Internationalized_domain_name)（国际化域名）明确*不在*电子邮件范围内：“foo@cäcilienchor-bonn.de”之类的地址*必须*改为“foo@xn--ccilienchor-bonn-vnb.de”（这包括*mailto：* HTML 中的链接和这样的乐趣），只有 GUI 被允许向（和从）用户显示（并接受然后转换）这样的名称。

* * *

## 回答 #57

> 赞同：2
> 
> 时间：2014-06-07T00:25:23.800

根据我对它们的了解，一个完全符合标准所说的正​​则表达式是：

```
/^(?!(^[.-].*|.*[.-]@|.*\.{2,}.*)|^.{254}.+@)([a-z\xC0-\xFF0-9!#$%&'*+\/=?^_`{|}~.-]+@)(?!.{253}.+$)((?!-.*|.*-\.)([a-z0-9-]{1,63}\.)+[a-z]{2,63}|(([01]?[0-9]{2}|2([0-4][0-9]|5[0-5])|[0-9])\.){3}([01]?[0-9]{2}|2([0-4][0-9]|5[0-5])|[0-9]))$/gim 
```

[**Demo**](http://regex101.com/r/nO4jB0) / [**Debuggex 分析**](https://www.debuggex.com/i/JN4oFLSjtB5QMK4j.png)（[交互式](https://www.debuggex.com/r/JN4oFLSjtB5QMK4j)）

分开：

```
^(?!(^[.-].*|.*[.-]@|.*\.{2,}.*)|^.{254}.+@)
([a-z\xC0-\xFF0-9!#$%&'*+\/=?^_`{|}~.-]+@)
(?!.{253}.+$)
(
    (?!-.*|.*-\.)
    ([a-z0-9-]{1,63}\.)+
    [a-z]{2,63}
    |
    (([01]?[0-9]{2}|2([0-4][0-9]|5[0-5])|[0-9])\.){3}
    ([01]?[0-9]{2}|2([0-4][0-9]|5[0-5])|[0-9])
)$ 
```

分析：

```
(?!(^[.-].*|.*[.-]@|.*\.{2,}.*)|^.{254}.+@) 
```

[以 a 开头、以`.`1 结尾、包含`..`在其中](https://stackoverflow.com/a/2049510/1256925)或超过[254 个字符的最大长度](https://stackoverflow.com/a/574698/1256925)的地址的负前瞻

* * *

```
([a-z\xC0-\xFF0-9!#$%&'*+\/=?^_`{|}~.-]+@) 
```

匹配 1 个或多个[允许的字符](https://stackoverflow.com/a/2049510/1256925)，并对其应用负面外观

* * *

```
(?!.{253}.+$) 
```

域名部分的负前瞻，[总共限制为 253 个字符](https://webmasters.stackexchange.com/a/16997)

* * *

```
(?!-.*|.*-\.) 
```

每个域名的负前瞻，不允许[以`.`](https://stackoverflow.com/a/7111947/1256925)

* * *

```
([a-z0-9-]{1,63}\.)+ 
```

域名中允许字符的简单组匹配，[每个字符限制为 63 个字符](https://webmasters.stackexchange.com/a/16997)

* * *

```
[a-zA-Z]{2,63} 
```

允许的顶级域的简单组匹配，目前[仍](https://en.wikipedia.org/wiki/TLD#IDN_test_domains)仅限于字母，但[确实包括 >4 个字母 TLD](https://en.wikipedia.org/wiki/List_of_Internet_top-level_domains#ICANN-era_generic_top-level_domains)。

* * *

```
(([01]?[0-9]{2}|2([0-4][0-9]|5[0-5])|[0-9])\.){3}
([01]?[0-9]{2}|2([0-4][0-9]|5[0-5])|[0-9]) 
```

域名的替代方案：这匹配 IP 地址中的前 3 个数字，后面*有*一个`.`，然后是 IP 地址中的第四个数字，`.`后面没有。

* * *

## 回答 #58

> 赞同：2
> 
> 时间：2014-07-31T09:17:10.350

几乎已经添加了一个新域“yandex”。可能的电子邮件：test@job.yandex。并且还支持大写字母，因此 acrosman 解决方案的修改版本是：

```
^[_a-zA-Z0-9-]+(\.[_a-zA-Z0-9-]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*(\.[a-zA-Z]{2,6})$ 
```

* * *

## 回答 #59

> 赞同：2
> 
> 时间：2014-08-25T11:13:00.107

**Java Mail API 为我们创造了奇迹。**

```
try
{
    InternetAddress internetAddress = new InternetAddress(email);
    internetAddress.validate();
    return true;
}
catch(Exception ex)
{
    return false;
} 
```

我从[这里](http://crunchify.com/how-to-validate-email-address-using-java-mail-api/)得到这个。

* * *

## 回答 #60

> 赞同：2
> 
> 时间：2016-12-28T10:17:43.050

项目清单

我用这个功能

```
function checkmail($value) {
    $value = trim($value);
    if (stristr($value,"@") &&
        stristr($value,".") &&
        (strrpos($value, ".") - stripos($value, "@") > 2) &&
        (stripos($value, "@") > 1) &&
        (strlen($value) - strrpos($value, ".") < 6) &&
        (strlen($value) - strrpos($value, ".") > 2) &&
        ($value == preg_replace('/[ ]/', '', $value)) &&
        ($value == preg_replace('/[^A-Za-z0-9\-_.@!*]/', '', $value))
    )
    {

    }
    else {
        return "Invalid Mail-Id";
    }
} 
```

* * *

## 回答 #61

> 赞同：2
> 
> 时间：2019-06-12T12:49:00.747

为所有的事情写一个正则表达式会花费很多精力。相反，您可以使用[pyIsEmail](https://pypi.org/project/pyIsEmail/)包。

以下文本来自[pyIsEmail](https://pypi.org/project/pyIsEmail/)网站。

pyIsEmail 是一种严肃的方法，用于检查用户提供的电子邮件地址是否真实。

正则表达式编写起来很便宜，但当新的顶级域出现或不符合重新流行的电子邮件寻址功能时，通常需要维护。pyIsEmail 允许您通过一个简单的调用来验证电子邮件地址——甚至可以检查域，如果你愿意的话，使你的代码更具可读性和编写速度。当您想知道为什么电子邮件地址无法验证时，他们甚至会为您提供诊断。

## 用法

对于最简单的用法，导入并使用 is_email 函数：

```
from pyisemail import is_email

address = "test@example.com"
bool_result = is_email(address)
detailed_result = is_email(address, diagnose=True) 
```

您还可以检查电子邮件中使用的域是否为有效域以及它是否具有有效的[MX 记录](https://en.wikipedia.org/wiki/MX_record)：

```
from pyisemail import is_email

address = "test@example.com"
bool_result_with_dns = is_email(address, check_dns=True)
detailed_result_with_dns = is_email(address, check_dns=True, diagnose=True) 
```

这些是电子邮件地址是否可以在该域中发布的主要指标。但是，此处的有效响应并不能保证电子邮件存在，而只是可以存在。

除了基本的*is_email*功能外，您还可以自己使用验证器。检查验证器源文档以了解其工作原理。

* * *

## 回答 #62

> 赞同：1
> 
> 时间：2013-05-11T12:20:38.560

世界上最受欢迎的博客平台[WordPress](https://en.wikipedia.org/wiki/WordPress)使用此功能来验证电子邮件地址...

但他们正在通过多个步骤来做到这一点。

使用此函数中提到的正则表达式时，您不必再担心...

这里是函数...

```
/**
 * Verifies that an email is valid.
 *
 * Does not grok i18n domains. Not RFC compliant.
 *
 * @since 0.71
 *
 * @param string $email Email address to verify.
 * @param boolean $deprecated Deprecated.
 * @return string|bool Either false or the valid email address.
 */
function is_email( $email, $deprecated = false ) {
    if ( ! empty( $deprecated ) )
        _deprecated_argument( __FUNCTION__, '3.0' );

    // Test for the minimum length the email can be
    if ( strlen( $email ) < 3 ) {
        return apply_filters( 'is_email', false, $email, 'email_too_short' );
    }

    // Test for an @ character after the first position
    if ( strpos( $email, '@', 1 ) === false ) {
        return apply_filters( 'is_email', false, $email, 'email_no_at' );
    }

    // Split out the local and domain parts
    list( $local, $domain ) = explode( '@', $email, 2 );

    // LOCAL PART
    // Test for invalid characters
    if ( !preg_match( '/^[a-zA-Z0-9!#$%&\'*+\/=?^_`{|}~\.-]+$/', $local ) ) {
        return apply_filters( 'is_email', false, $email, 'local_invalid_chars' );
    }

    // DOMAIN PART
    // Test for sequences of periods
    if ( preg_match( '/\.{2,}/', $domain ) ) {
        return apply_filters( 'is_email', false, $email, 'domain_period_sequence' );
    }

    // Test for leading and trailing periods and whitespace
    if ( trim( $domain, " \t\n\r\0\x0B." ) !== $domain ) {
        return apply_filters( 'is_email', false, $email, 'domain_period_limits' );
    }

    // Split the domain into subs
    $subs = explode( '.', $domain );

    // Assume the domain will have at least two subs
    if ( 2 > count( $subs ) ) {
        return apply_filters( 'is_email', false, $email, 'domain_no_periods' );
    }

    // Loop through each sub
    foreach ( $subs as $sub ) {
        // Test for leading and trailing hyphens and whitespace
        if ( trim( $sub, " \t\n\r\0\x0B-" ) !== $sub ) {
            return apply_filters( 'is_email', false, $email, 'sub_hyphen_limits' );
        }

        // Test for invalid characters
        if ( !preg_match('/^[a-z0-9-]+$/i', $sub ) ) {
            return apply_filters( 'is_email', false, $email, 'sub_invalid_chars' );
        }
    }

    // Congratulations your email made it!
    return apply_filters( 'is_email', $email, $email, null );
} 
```

* * *

## 回答 #63

> 赞同：1
> 
> 时间：2014-09-11T14:22:51.710

如前所述，您无法使用正则表达式验证电子邮件。但是，这是我们目前用来确保用户输入不是完全虚假的（忘记[TLD](https://en.wikipedia.org/wiki/Top-level_domain)等）的方法。

此正则表达式将允许在 @ 符号前后使用[IDN域和特殊字符（如元音变音符号）。](https://en.wikipedia.org/wiki/Internationalized_domain_name)

```
/^[\w.+-_]+@[^.][\w.-]*\.[\w-]{2,63}$/iu 
```

* * *

## 回答 #64

> 赞同：1
> 
> 时间：2015-09-19T14:13:09.730

我找到了[一篇不错的文章](http://davidcel.is/posts/stop-validating-email-addresses-with-regex/)，它说验证电子邮件地址的最佳方法是正则表达式`/.+@.+\..+/i`。

* * *

## 回答 #65

> 赞同：1
> 
> 时间：2017-09-27T10:41:14.963

我将代码转换为 Java 以匹配编译器：

```
String pattern = "(?:[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*|\"(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*\")@(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?\\.)+[a-zA-Z0-9](?:[a-zA-Z0-9-]*[a-zA-Z0-9])?|\\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-zA-Z0-9-]*[a-zA-Z0-9]:(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21-\\x5a\\x53-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)\\])"; 
```

* * *

## 回答 #66

> 赞同：0
> 
> 时间：2013-10-25T14:19:03.973

```
^[_a-zA-Z0-9-]+(\.[_a-zA-Z0-9-]+)*@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.(([0-9]{1,3})|([a-zA-Z]{2,3})|(aero|coop|info|museum|name))$ 
```

这匹配了 99.99% 的电子邮件地址，包括一些较新的顶级域扩展，例如信息、博物馆、名称等。它还允许电子邮件直接绑定到 IP 地址。

* * *

## 回答 #67

> 赞同：0
> 
> 时间：2014-12-10T06:20:50.483

您可以对任何电子邮件地址使用以下正则表达式：

```
^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$ 
```

### 对于 PHP

```
function checkEmailValidation($email)
{
    $expression = '/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/';
    if(preg_match($expression, $email))
    {
        return true;
    }
    else
    {
        return false;
    }
} 
```

### 对于 JavaScript

```
function checkEmailValidation(email)
{
    var pattern = '/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/';
    if(pattern.test(email))
    {
        return true;
    }
    else
    {
        return false;
    }
} 
```

* * *

## 回答 #68

> 赞同：0
> 
> 时间：2021-05-07T17:34:31.860

我们还有另一个选择是使用`DataAnnotations`which has a `EmailAddressAttribute`. 这不仅可以应用于类的属性，还可以在运行时利用。

`using System.ComponentModel.DataAnnotations;`

**典型用法**

```
public class Person
{
    public int Id { get; set; }

    [EmailAddress]
    public string Email { get; set; }
} 
```

**在运行时**

```
var emailAddressAttribute = new EmailAddressAttribute();

if (emailAddressAttribute.IsValid("name@email.com"))
{
    //email is valid
}
else
{
    //email is invalid
} 
```

* * *

## 回答 #69

> 赞同：0
> 
> 时间：2021-07-09T00:02:45.020

出于我的目的，我需要一种方法来提取显示名称（如果提供）。
感谢[https://emailregex.com/](https://emailregex.com/)上提供的其他答案和正则表达式，我想出了以下解决方案：

```
/^(?:([^<]*?)\s*<)?((?:[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\]))>?$/gi 
```

这匹配**Display name (=group 1)** + **email address (=group 2)**。

匹配示例：

```
john.doe@example.com
john.o'doe@example.com
John <john@doe.com>
<john@doe.com>
This is <john@127.0.0.1> 
```

*使用[https://regex101.com/测试](https://regex101.com/)*

当然，正如其他答案中所提到的，需要对显示名称和电子邮件地址的长度进行额外验证（不应超过 320 个 UTF-8 字节）。

* * *

## 回答 #70

> 赞同：-1
> 
> 时间：2014-11-11T09:17:57.600

根据[W3C](http://www.w3.org/TR/html-markup/datatypes.html#form.data.emailaddress)和[Wikipedia的有效正则表达式](http://fr.wikipedia.org/wiki/Adresse_%C3%A9lectronique)

```
 [A-Z0-9a-z.!#$%&'*+-/=?^_`{|}~]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,4} 
```

例如，!#$%&'*+-/=?^_`.{|}~@example.com

* * *

## 回答 #71

> 赞同：-2
> 
> 时间：2018-11-05T09:11:04.240

我用这个；

```
^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$ 
```

* * *

## 回答 #72

> 赞同：-2
> 
> 时间：2019-04-27T22:27:42.473

电子邮件正则表达式 (RFC 5322)

```
(?im)^(?=.{1,64}@)(?:("[^"\\]*(?:\\.[^"\\]*)*"@)|((?:[0-9a-z](?:\.(?!\.)|[-!#\$%&'\*\+/=\?\^`\{\}\|~\w])*)?[0-9a-z]@))(?=.{1,255}$)(?:(\[(?:\d{1,3}\.){3}\d{1,3}\])|((?:(?=.{1,63}\.)[0-9a-z][-\w]*[0-9a-z]*\.)+[a-z0-9][\-a-z0-9]{0,22}[a-z0-9])|((?=.{1,63}$)[0-9a-z][-\w]*))$ 
```

演示[https://regex101.com/r/ObS3QZ/1](https://regex101.com/r/ObS3QZ/1)

```
# (?im)^(?=.{1,64}@)(?:("[^"\\]*(?:\\.[^"\\]*)*"@)|((?:[0-9a-z](?:\.(?!\.)|[-!#\$%&'\*\+/=\?\^`\{\}\|~\w])*)?[0-9a-z]@))(?=.{1,255}$)(?:(\[(?:\d{1,3}\.){3}\d{1,3}\])|((?:(?=.{1,63}\.)[0-9a-z][-\w]*[0-9a-z]*\.)+[a-z0-9][\-a-z0-9]{0,22}[a-z0-9])|((?=.{1,63}$)[0-9a-z][-\w]*))$

# Note - remove all comments '(comments)' before running this regex
# Find  \([^)]*\)  replace with nothing

(?im)                                     # Case insensitive
^                                         # BOS

                                          # Local part
(?= .{1,64} @ )                           # 64 max chars
(?:
     (                                         # (1 start), Quoted
          " [^"\\]*
          (?: \\ . [^"\\]* )*
          "
          @
     )                                         # (1 end)
  |                                          # or,
     (                                         # (2 start), Non-quoted
          (?:
               [0-9a-z]
               (?:
                    \.
                    (?! \. )
                 |                                          # or,
                    [-!#\$%&'\*\+/=\?\^`\{\}\|~\w]
               )*
          )?
          [0-9a-z]
          @
     )                                         # (2 end)
)
                                          # Domain part
(?= .{1,255} $ )                          # 255 max chars
(?:
     (                                         # (3 start), IP
          \[
          (?: \d{1,3} \. ){3}
          \d{1,3} \]
     )                                         # (3 end)
  |                                          # or,
     (                                         # (4 start), Others
          (?:                                       # Labels (63 max chars each)
               (?= .{1,63} \. )
               [0-9a-z] [-\w]* [0-9a-z]*
               \.
          )+
          [a-z0-9] [\-a-z0-9]{0,22} [a-z0-9]
     )                                         # (4 end)
  |                                          # or,
     (                                         # (5 start), Localdomain
          (?= .{1,63} $ )
          [0-9a-z] [-\w]*
     )                                         # (5 end)
)
$                                         # EOS 
```

* * *

## 回答 #73

> 赞同：-2
> 
> 时间：2020-10-01T20:37:35.043

这个简单的模式对我有用：

```
^(?<name>[^<>#()\.,;\s@\"]{1,})@(?<domain>[^<>#()\.,;\s@\"]{2,}\.(?<top>[^<>#()\.,;:\s@\"]{2,}))$ 
```

* * *

## 回答 #74

> 赞同：-2
> 
> 时间：2021-03-29T12:20:54.323

我使用的正则表达式：

```
[\w-+]+([.][\w]+)?@[\w-+]+([.][a-z]{2,})+ 
```

* * *

## 回答 #75

> 赞同：-3
> 
> 时间：2019-03-11T19:59:13.773

对于 Angular2 / Angular7，我使用这种模式：

```
emailPattern = '^[a-zA-Z0-9_.+-]+@[a-zA-Z0-9-]+[.]+[a-zA-Z0-9-.]+(\\s)*';

private createForm() {
  this.form = this.formBuilder.group({
    email: ['', [Validators.required, Validators.pattern(this.emailPattern)]]
  });
}
```

它还允许在末尾添加额外的空格，您应该在将其发送到后端之前将其截断，但是某些用户，尤其是在移动设备上的用户很容易在末尾错误地添加空格。

* * *

## 回答 #76

> 赞同：-3
> 
> 时间：2020-08-07T05:31:31.020

也许是最好的：

```
/^[a-zA-Z0-9]+([-._][a-zA-Z0-9]+)*@[a-zA-Z0-9]+([-.][a-zA-Z0-9]+)*\.[a-zA-Z]{2,7}$/ 
```

以字母或数字开头。它可能包括“-_ .”，以“.”结尾 并且少于七个字符（例如*.company*）。

* * *

## 回答 #77

> 赞同：-11
> 
> 时间：2013-06-21T20:57:26.713

为了使用 JavaScript 验证电子邮件地址，使用此功能更方便有效（根据[W3Schools](https://en.wikipedia.org/wiki/W3Schools)）：

```
function validateEmail()
{
    var x = document.f.email.value;
    var atpos = x.indexOf("@");
    var dotpos = x.lastIndexOf(".");
    if (atpos < 1 || dotpos < atpos+2 || dotpos+2 >= x.length)
    {
        alert("Not a valid e-mail address");
        return false;
    }
} 
```

我用它，它很完美。

# mstest - MSTest 运行失败，因为源程序集不受信任

> ID：201327
> 
> 赞同：62
> 
> 时间：2008-10-14T14:15:50.407
> 
> 标签：mstest

我刚刚将 xUnit 添加到我们的测试项目中（对于 Asserts，我们仍然使用 MSTest 作为框架）并且测试运行立即拒绝执行任何测试。这是错误消息：

> 无法将测试运行“{ ....}”排队测试运行部署问题：文件或目录“...xUnit.dll”的位置不受信任。

* * *

## 回答 #1

> 赞同：98
> 
> 时间：2008-10-14T14:17:43.943

我花了几次尝试在谷歌中找到答案，所以我把它放在这里以防其他人遇到同样的问题。可以在[此博客文章](http://smartclientfactory.blogspot.com/2008/01/nmock2-was-blocked.html)中找到详细说明。

基本上，修复涉及在 Windows 资源管理器中右键单击 dll 文件（例如 xunit.dll），转到“属性”，然后单击“安全”文本旁边选项卡底部的“取消阻止”。Vista / Windows 2008 似乎会自动将来自其他机器或互联网的程序集标记为不安全。

正如一些评论者所提到的，您可能还需要重新启动 Visual Studio 才能使其生效。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-12-04T12:04:56.953

在我的团队中，我们遇到了同样的问题。

您的解决方案不起作用，但[Charles Sterling 的这篇文章](http://blogs.msdn.com/charles_sterling/archive/2008/06/03/the-test-engine-cannot-run-tests-in-the-assembly-tests-dll-because-the-assembly-is-not-fully-trusted-by-net-framework-security-policy.aspx)确实有帮助。

我们使用了以下行：

```
caspol -machine -addgroup 1 -url file://\\server/share/* FullTrust -name DevShare 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-02-11T20:59:44.903

在遇到此问题并花费数小时试图让“解除阻止”停留超过几分钟和/或弄清楚**caspol**无济于事之后，我终于通过 Google 发现了一个小消息，即下次构建时程序集将再次被阻止或重建项目，因为它们是从原始源位置重新复制的。（我想我从来没有注意到在引用程序集之前发生过这种情况，但无论如何......）

我对此的解决方法如下：

1.  将所有需要的 DLL 复制到另一个位置以进行安全保存

2.  删除 Visual Studio 中的引用

3.  物理删除 bin 文件夹中的 DLL

4.  在它们被复制的地方单独取消阻止 DLL

5.  从保留点将引用添加回 Visual Studio

之后的每个后续构建或重建都运行良好。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-12-17T21:06:38.260

在 XP 机器上运行（即使安装了 .NET 3.5 SP1）我无法让此处列出的任何其他解决方案正常工作。

然而，根据戴维兰德曼引用[的查尔斯斯特林的同一篇文章，我终于成功地完成了这个变体：](http://blogs.msdn.com/charles_sterling/archive/2008/06/03/the-test-engine-cannot-run-tests-in-the-assembly-tests-dll-because-the-assembly-is-not-fully-trusted-by-net-framework-security-policy.aspx)

1.  运行 .NET 2.0 配置工具（设置...控制面板...管理工具....NET Framework 2.0 配置）
2.  单击“我的电脑...运行时安全策略...机器...代码组...All_Code”
3.  创建成员条件为“Zone”="Local Intranet" 的新代码组并分配权限集“FullTrust”
4.  重新启动 Visual Studio

在这些步骤之后，我能够运行测试，包括重新启动和重建之后。

编辑：如[本答案](https://stackoverflow.com/questions/1189326/net-framework-2-0-configuration-tool/1189346#1189346)中所述，您可能需要安装 .NET SDK（不同于 .NET 框架）才能在您的系统上安装 .NET 2.0 配置工具。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-06-29T03:48:58.233

我对起订量有同样的问题。但不会“解除封锁”。每次解封还是被封了！！！？

我必须解锁我下载的原始 zip 文件。然后再次从 zip 文件中复制 DLL。在那之后它工作。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-02-20T11:11:20.810

现在看起来很明显，但是当我单击取消阻止时，文件被设置为只读。

只有在取消选中该属性，应用，然后选择取消阻止之后，我才真正得到这个工作。

试一试。

:)

PS：我还删除了 bin 文件夹中的所有旧 dll，只是为了确保 Visual Studio 没有拾取旧的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-07-30T12:58:58.247

下载的 DLL 被 Vista 阻止时，我遇到了同样的问题。您需要管理员权限才能获得文件属性上的“取消阻止”按钮。我只是用我之前提交**的源代码控制 (TFS) 中的最新版本替换了 DLL 。**

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-09-19T15:39:53.650

*   去`file`
*   右键单击并选择`Properties`
*   在第一个注册点击`Allow`

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-11-12T12:53:44.783

我还尝试在记事本++中打开文件并重命名它。方法略有不同，但对我有用。然后本地文件系统认为它来自同一台机器。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-08-24T10:52:15.500

不只是 moq.dll 需要解锁。最新的 zip 文件包括 moq.xml 和 moq.pdb 文件 - 引用 dll 也会将这两个文件复制到 bin 文件夹中。我发现，如果所有三个都没有被解除阻塞，测试将不会运行。

# performance - log4net 是否比 System.Diagnostics.Trace 慢得多？

> ID：201354
> 
> 赞同：18
> 
> 时间：2008-10-14T14:22:44.137
> 
> 标签：performance, logging, log4net

我正在研究使用 log4net 和`System.Diagnostics.Trace`进行日志记录之间的差异，我很好奇我观察到的性能差异。

我创建了一个测试应用程序来比较两种日志记录方法在几种情况下的性能，我发现 log4net 明显比`Trace`类慢。例如，在我记录 1,000 条没有字符串格式的消息的情况下，log4net 超过 1,000 次试验的平均执行时间为 9.00 毫秒。 `Trace`平均执行时间为 1.13 毫秒。我的很多测试用例在 log4net 执行时间上都有相对较大的差异；异常长时间执行的周期性性质似乎表明 GC 干扰。使用 CLR Profiler 确认`log4net.Core.LoggingEvent`生成了大量对象的大量集合（公平地说，它看起来也`Trace`生成了大量`Char[]`对象，但它并没有显示 log4net 的大差异。 )

我在这里要记住的一件事是，即使 log4net 看起来比 慢大约 9 倍`Trace`，但在 1,000 次迭代中差异是 8 毫秒；这并不是一个显着的性能消耗。尽管如此，我的一些预期用例可能会调用记录数十万次的方法，这些数字来自我的快速机器。在较慢的机器上，我们的用户配置更典型，差异是 170 毫秒到 11 毫秒，这有点令人担忧。

这种性能是 log4net 的典型表现，还是有一些可以显着提高 log4net 性能的陷阱？

（*注意：我知道字符串格式化会改变执行时间；我正在尝试将苹果与苹果进行比较，并且我有没有格式化的测试用例和带格式化的测试用例；无论是否使用字符串格式化，log4net 的速度都会保持成比例。* )

到目前为止的故事：

*   罗伯特·古尔德（Robert Gould）对这个问题有最好的答案；我主要是好奇 log4net 的执行速度是否比`Trace`课堂慢得多。
*   Alex Shnayder 的回答是有趣的信息，但并不真正属于问题的范围。引入此日志记录的一半目的是帮助调试实时系统上的逻辑和性能问题；我们的客户将我们的产品置于许多奇特的场景中，如果没有昂贵的大规模硬件配置，这些场景通常很难重现。我主要担心的是“不记录”和“记录”之间的较大时间差异可能会影响系统，从而不会发生错误。最后，性能下降的规模很大，但幅度很小，所以我希望它不会成为问题。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-14T14:31:26.913

是的 log4xxx 比 trace 慢，因为 trace 通常是一个接近内核的工具，而 log4xxx 是一个更强大的工具。我个人更喜欢 log4xxx 因为它的灵活性，但如果你想要一些影响不大的东西，并且你真的不需要生产日志，那么在调试中说只有跟踪就足够了。

注意：我使用 log4xxx 是因为这同样适用于所有具有 log4 库的语言，而不仅仅是 .Net

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-04T08:57:47.330

您可能对[Common.Logging 库](http://netcommon.sourceforge.net/)感兴趣。它是对现有日志实现的精简抽象包装器，允许您在运行时插入您喜欢的任何日志框架。[它也比我关于性能的博客文章](http://eeichinger.blogspot.com/2009/01/thoughts-on-systemdiagnostics-trace-vs.html)中描述的 System.Diagnostics.Trace 快得多。

hth，埃里希

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-14T21:42:13.347

根据我的经验，log4net 性能在大多数情况下都不是问题。真正的问题是，为什么您甚至需要在生产系统中“记录数十万次”。
正如我所看到的，在生产中您应该只记录最低限度（信息可能是警告级别），并且只有在需要时（在现场调试问题）才应该在调试级别激活调试。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-15T22:31:11.000

如果您想要两全其美，log4net 也将允许您登录到 aspnet 跟踪器。当我想要获取与日志记录中的特定事件相关的性能统计信息时，我会打开此选项。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-05-14T11:53:49.333

刚刚运行了一个测试，将顺序写入一个简单的文件与使用 Log4Net 执行相同的任务进行比较。Log4Net 比 StreamWriter 慢大约 400 倍。所以**我认为如果您正在写入巨大的日志文件，Log4Net 不可用**。但我发现它**对于少量的日志条目**和调试非常有用。

在某些情况下，也许是在单独的线程中隔离日志记录的解决方案。

# excel - 在 IE 中打开电子表格后，如何阻止 Excel 2003 挂起？

> ID：201355
> 
> 赞同：1
> 
> 时间：2008-10-14T14:23:01.937
> 
> 标签：excel, internet-explorer, internet-explorer-7

我有一个通过 IE 7 提供 Excel 文件的 Web 应用程序。它使用 HTTP GET 从 URL 请求文件，该 URL 返回内容类型为“application/vnd.ms-excel”的数据。然后它在 IFrame 中打开电子表格。

除非在下载电子表格时 Excel 已经打开，否则一切正常。在这种情况下，它仍然可以正确显示，但会重复使用打开的 Excel 实例。当 IFrame 关闭时，Excel 挂起。只有当用户退出 Web 应用程序或下载不同类型的文件时，Excel 才会解锁。

我尝试在工具 | 下打开“忽略其他应用程序”设置。选项 | 一般，但它并没有解决问题。

我还尝试按照[此答案](https://stackoverflow.com/questions/213110/make-excel-2003-open-spreadsheets-in-new-instances/213187#213187)中的步骤进行操作（因为[链接的参考资料](http://www.drewery.net/blog/2006/08/29/utilising-dual-monitors-with-microsoft-excel-2003/)显示“此问题已在 Excel 2007 beta 2 中得到解决。”）但没有成功。

是否有某种我目前没有执行的“处理”步骤会阻止 Excel 挂起？

版本：

Excel 2003 (11.8220.8221) SP3

IE 7.0.5730.11（更新版本：0）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-30T12:38:28.040

继[罗伯特的回答](https://stackoverflow.com/questions/201355/how-can-i-stop-excel-2003-from-hanging-after-opening-a-spreadsheet-in-ie/497100#497100)之后，以下 (Java) 代码行解决了这个问题，因为它可以防止 Excel 挂起：

```
response.setHeader("Content-Disposition", 
    "attachment; filename=\"" + filename + "\""); 
```

[NB 'response' 是一个 HttpServletResponse]

但是，它会强制将电子表格加载到 Excel 窗口中，而不是显示在 IFrame 中...

**更新：**将 IFrame 的 URL 重置为空白会强制释放 Excel 实例并修复此问题（无需`Content-Disposition`更改）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-30T20:22:41.363

不确定这是否有帮助，但...

很久以前我遇到了一些类似的问题（动态生成 CSV 内容），我只记得它必须通过调用正确的响应方法来做一些事情。代码是这样的

```
 Response.Clear();
Response.Buffer = true;

Response.AppendHeader("Content-Disposition", "attachment; filename=export.csv");
Response.Cache.SetCacheability(HttpCacheability.Private);
Response.Cache.SetExpires(DateTime.MinValue);
Response.Cache.SetLastModified(DateTime.Now);
Response.Cache.SetMaxAge(new TimeSpan(1));
Response.ContentType = "text/csv";

Response.ContentEncoding = System.Text.Encoding.Unicode;

...
//Some  writing to the Response.OutputStream
...

Response.Flush();

//I am not sure about the following line:
Response.End(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T14:25:25.147

不幸的是，这完全不在你的掌控之中。这实际上取决于他们拥有的 excel 版本以及应用了哪些更新。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-27T17:55:57.657

您是否能够在自己的环境中重现此问题？如果不是，则可能是客户端计算机上的问题。有什么方法可以找出已安装或未安装的选项，或者 Excel 是否已使用它的补丁进行维护？

在我看来，办公室本身需要重新安装，如果不是之后的 IE 7。

我还会调查任何 iFrame 关闭问题。为了测试这个理论，您可以将 iframe 发布到新页面（没有 iframe），然后链接回带有 iframe 和 excel 文件的页面？我意识到这对你来说可能不是一个可行的解决方案，但它应该可以帮助你消除它是否是 excel、IE7 或 iframe 代码有错误。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-30T17:03:32.060

这是您能够复制的东西，还是客户向您报告的东西，而您正试图追捕它？

您提供的链接涉及多台显示器 - 当我对接笔记本电脑时，我也有多台显示器，我发现许多应用程序响应不佳。例如，如果一个应用程序试图在不再存在的桌面空间中打开一个模式对话框（例如，在我的笔记本电脑断开连接后，在我的“第二台显示器”上），它会锁定应用程序，因为我可以不要靠近盒子。这可能是这里发生的事情吗？

如果您在用户获取 Excel 文件时要求他们进行某种身份验证，则会出现另一个潜在问题。在我们的共享点站点上，Excel 希望用户进行身份验证，如果该模式身份验证对话框以某种方式被推到后台，则不可能再次回到前面。唯一的方法是终止进程或关闭共享点浏览器，因为这首先会终止对文件的请求。

希望这会有所帮助，如果其中任何一个为您提供更多线索，请在此处发布，我们将解决此问题。

# c++ - 使用 /Wp64 编译时如何将 strlen 的结果转换为 int 而没有警告

> ID：201359
> 
> 赞同：5
> 
> 时间：2008-10-14T14:23:23.667
> 
> 标签：c++

int l = strlen(s);

警告 C4244：“=”：从“__w64 int”转换为“int”，可能丢失数据

我需要用内联函数替换 strlen int l = new_strlen(s);

但是，如何在不发出警告且不使用编译指示的情况下将 strlen 的结果移植到 int 中？我可以保证我的字符串中不超过 20 亿个字符！

reinterpret_cast、static_cast 等所有显而易见的事情也会产生错误或警告。

编辑：啊。c-style cast: (int) 确实有效。我一直坚信它没有。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-14T14:30:54.323

```
const char * str = "Hello";
int len = static_cast< int >( strlen( str ) );
return len; 
```

即使在警告级别 4 (VS2005) 上，此代码也不会产生任何错误或警告。你用什么编译器？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-14T14:39:35.930

另请注意，/Wp64 在 VS2008 中已弃用；显然它[不可靠](http://blogs.msdn.com/vcblog/archive/2007/08/10/the-future-of-the-c-language.aspx#4421146)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T14:25:38.983

投射它：

```
int i = (int) strlen(s); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-14T14:27:03.223

或者不要使用带符号的 int。strlen() 的返回值是无符号的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-14T15:40:16.727

如果您理解警告，则禁用警告而不是堆叠演员表或任何其他令人困惑的混乱作为解决方法是完全可以接受的。

> 带有 suppress 说明符的 pragma 警告指令仅对紧跟在 #pragma 警告语句之后的代码行禁止警告。
> 
> ```
> #pragma warning( suppress : 6001 ) 
> arr[i+1] = 0; // Warning 6001 is suppressed
> j++; // Warning 6001 is reported 
> ```
> 
> [（特定于 msvc）](http://msdn.microsoft.com/en-us/library/aa468780.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-14T15:06:46.233

如果您确实有充分的理由截断指针，则可以`/Wp64`通过堆叠多个强制转换来接受您的代码。这些情况很少见。一个例子：用于传统 PCI 设备的设备驱动程序，执行 DMA，分配的内存低于 4GB 限制。（注意：还有`PtrToUlong()`宏，会让你的意图更清晰。）

这个单一的演员将产生一个警告：

```
const char* p = "abc";
unsigned int u = reinterpret_cast<unsigned int>(p); 
```

wp64.cpp(10)：警告 C4311：“reinterpret_cast”：从“const char *”到“unsigned int”的指针截断

但是这些堆叠的演员表不会：

```
const char* p = "abc";
unsigned int u = static_cast<unsigned int>(reinterpret_cast<uintptr_t>(p)); 
```

我无法使用已安装的编译器版本重现您的警告，但我怀疑您的问题与您将 64-bit unsigned`size_t`转换为 32-bit signed的事实有关`int`。

如果您堆叠多个强制转换来进行 64 位到 32 位的转换和无符号到有符号的转换，您可能会有更好的运气：

```
const char* s = "abcdef";
int l = static_cast<int>(static_cast<intptr_t>(strlen(s))); 
```

此外，如果您同时构建 x86 和 x64 二进制文件，则可以禁用`/Wp64`32 位构建，这样您就不必使用`__w64`. 用于`/Wp64`您的 64 位版本会捕获很多错误。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-14T14:34:21.867

> 我需要用内联函数替换 strlen int l = new_strlen(s);

请注意，在 VC++ 中，当您构建优化版本时，strlen 会自动替换为内联版本。

# sharepoint - SharePoint，您如何以编程方式确定 SPWeb 的存储大小？

> ID：201368
> 
> 赞同：5
> 
> 时间：2008-10-14T14:24:35.397
> 
> 标签：sharepoint, spweb

不是网站集本身，而是各个 SPWeb 的。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-14T14:30:12.907

您应该看看 Alexander Meijers 的这篇博客文章：[SPWeb 的大小基于其文件夹和文件](http://www.bloggix.com/blogs/microsoft/archive/2008/04/03/size-of-spweb-based-on-its-folders-and-files.aspx)

它提供了一种通过迭代内容来查找 SPWeb 或 SPFolder 大小的巧妙方法。

```
private long GetWebSize(SPWeb web)
{
    long total = 0;

    foreach (SPFolder folder in web.Folders)
    {
        total += GetFolderSize(folder);
    }

    foreach (SPWeb subweb in web.Webs)
    {
        total += GetWebSize(subweb);
        subweb.Dispose();
    }

    return total;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-07-01T18:33:24.110

对于任何回到这个问题的人，这里是缺少的方法：

```
private long GetFolderSize(SPFolder folder)
{
    long folderSize = 0;

    foreach (SPFile file in folder.Files)
    {
        folderSize += file.Length;
    }

    foreach (SPFolder subfolder in folder.SubFolders)
    {
        folderSize += GetFolderSize(subfolder);
    }

    return folderSize;
} 
```

# session - 使用 ASP.NET 2.0 处理过期会话的最有效方法是什么

> ID：201370
> 
> 赞同：3
> 
> 时间：2008-10-14T14:24:53.650
> 
> 标签：session, asp.net-2.0

在我们正在建设的网站上。当他的会话结束时，我们需要能够将用户重定向到默认页面。

乍一看，我们使用 Session_End 和 Response.Redirect 来完成这项工作。

```
Sub Session_End(ByVal sender As Object, ByVal e As EventArgs)
    Response.Redirect("~/global/exit.aspx")
End Sub 
```

但它会生成大量*Response is not available in this context*错误。自然，我们不想向我们的服务器错误日志发送垃圾邮件。

处理以 ASP.NET 2.0 结束的会话的最有效方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-15T07:31:50.473

我们将以下代码添加到 global.asax.cs 文件中：

```
 private void IsAuthenticated()
    {
        string vFileName = Path.GetFileName(HttpContext.Current.Request.Path);
        string vExt = Path.GetExtension(vFileName).ToLower();
        if ((vFileName != "Login.aspx") && (vExt == ".aspx"))
        {
            if (HttpContext.Current.Session["LoggedIn"] == null)
            {
                HttpContext.Current.Response.Redirect("~/Login.aspx");
            }
        }
    }
    void Application_PostAcquireRequestState(object sender, EventArgs e)
    {
        IsAuthenticated();
    } 
```

NS：我们的 Global .asax 文件的第一行是：

```
<%@ Application  Inherits="???.Global" Language="C#" %> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T14:31:49.487

我们通过检查会话数据是否存在于特定于用户的页面的 Application.Begin_Request 中来处理它，如果不存在则将用户重定向到登录或主页。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-14T15:39:16.090

您可以使用 session_end 方法，因为它不是用户可调用的方法，它由 ASP.NET 触发并且响应不可用，因为它不是请求的一部分。

最大的方法是检查并查看会话是否丢失，在页面加载的某个地方并重定向回主页面。

我之前所做的是将此检查逻辑放在用于所有会话特定页面的“RestrictedPage.master”母版页中，如果会话丢失，它会重定向。

# c# - Project Euler 问题 3 帮助

> ID：201374
> 
> 赞同：17
> 
> 时间：2008-10-14T14:26:06.080
> 
> 标签：c#, algorithm, language-agnostic, primes

我正在尝试通过 Project Euler 工作，但在问题 03 上遇到了障碍。我有一个适用于较小数字的算法，但问题 3 使用了一个非常非常大的数字。

**问题03：** 13195的质因数是5、7、13和29。600851475143这个数的最大质因数是多少？

这是我在 C# 中的解决方案，我认为它已经运行了将近一个小时。我不是在寻找答案，因为我确实想自己解决这个问题。主要是寻求帮助。

```
 static void Main(string[] args) {
        const long n = 600851475143;
        //const long n = 13195;
        long count, half, largestPrime = 0;
        bool IsAPrime;

        half = n / 2;

        for (long i = half; i > 1 && largestPrime == 0; i--) {
             if (n % i == 0) { // these are factors of n
                count = 1;
                IsAPrime = true;
                while (++count < i && IsAPrime) {
                    if (i % count == 0) { // does a factor of n have a factor? (not prime)
                        IsAPrime = false;
                    }
                }
                if (IsAPrime) {
                    largestPrime = i;
                }
            }
        }

        Console.WriteLine("The largest prime factor is " + largestPrime.ToString() + ".");
        Console.ReadLine();
    } 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-14T14:28:28.820

对于初学者，不要从 n / 2 开始搜索，而是从 n 的平方根开始搜索。你会得到一半的因素，另一半是他们的补充。

例如：

```
n = 27
start at floor(sqrt(27)) = 5
is 5 a factor? no
is 4 a factor? no
is 3 a factor? yes. 27 / 3 = 9\. 9 is also a factor.
is 2 a factor? no.
factors are 3 and 9. 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-14T14:38:19.427

虽然这个问题要求*最大*的主要因素，但这并不一定意味着你必须首先找到那个......

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-14T14:46:17.443

实际上，对于这种情况，您不需要检查素数，只需删除您找到的因素。从 n == 2 开始向上扫描。当 evil-big-number % n == 0 时，将 evil-big-number 除以 n 并继续使用 small-evil-number。当 n >= sqrt(big-evil-number) 时停止。

在任何现代机器上不应该超过几秒钟。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2010-06-09T09:04:02.600

```
long n = 600851475143L; //not even, so 2 wont be a factor
int factor = 3; 
while( n > 1)
{
    if(n % factor == 0)
    {
        n/=factor;
    }else
        factor += 2; //skip even numbrs
}
        print factor; 
```

这应该足够快...注意，无需检查素数...

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-14T14:28:52.627

你需要减少你正在做的检查量......想想你需要测试什么数字。

为了更好地阅读[埃拉托色尼筛法](http://en.wikipedia.org/wiki/Sieve_of_Eratosthenes)......它应该让你指向正确的方向。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-14T14:51:11.803

至于接受 nicf 回答的原因：

Euler 的问题是可以的，但在一般情况下并不能使其成为有效的解决方案。为什么要尝试偶数的因数？

*   如果 n 是偶数，则左移（除以 2）直到不再是偶数。如果是 1，那么 2 是最大的质因数。
*   如果 n 不是偶数，则不必测试偶数。
*   确实，您可以在 sqrt(n) 处停止。
*   您只需要测试素数的因子。测试 k 是否除 n 然后测试它的素数可能会更快。
*   当您找到一个因素时，您可以即时优化上限。

这将导致一些这样的代码：

```
n = abs(number);
result = 1;
if (n mod 2 = 0) {
  result = 2;
  while (n mod 2 = 0) n /= 2;
}
for(i=3; i<sqrt(n); i+=2) {
  if (n mod i = 0) {
    result = i;
    while (n mod i = 0)  n /= i;
  }
}
return max(n,result) 
```

有一些模数检验是多余的，因为如果所有因素 2 和 3 都被删除，n 永远不能被 6 整除。你只能允许 i 的素数。

举个例子，让我们看看 21 的结果：

21 不是偶数，所以我们进入上限 sqrt(21) (~4.6) 的 for 循环。然后我们可以将 21 除以 3，因此结果 = 3 和 n = 21/3 = 7。我们现在只需要测试 sqrt(7)。它小于 3，所以我们完成了 for 循环。我们返回 n 的最大值和结果，即 n = 7。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-16T20:13:47.127

我这样做的方法是使用 Eratosthenes 筛从 2 开始搜索素数 ( `p`)。该算法可以在速度相当快的机器上在 <2s 内找到所有 1000 万以下的素数。

对于您找到的每个素数，测试将其划分为您正在测试的数字，直到您不能再进行整数除法。（即检查`n % p == 0`，如果为真，则除以。）

一次`n = 1`，你就完成了。成功划分的最后一个值`n`就是你的答案。在旁注中，您还发现`n`了途中的所有主要因素。

PS：如前所述，您只需要搜索`2 <= n <= sqrt(p)`. 这使得 Eratosthenes 筛成为一种非常快速且易于实现的算法，用于我们的目的。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-06-22T18:13:26.293

找到答案后，在浏览器中输入以下内容；）

[http://www.wolframalpha.com/input/?i=FactorInteger(600851475143)](http://www.wolframalpha.com/input/?i=FactorInteger(600851475143))

Wofram Alpha 是你的朋友

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-14T15:44:38.293

在 Java 中使用递归算法运行时间不到一秒……考虑一下您的算法，因为它包含一些可以消除的“蛮力”。还要看看如何通过中间计算来减少您的解决方案空间。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-07-31T00:51:23.000

C ++中的简单操作：

```
#include <iostream>

using namespace std;

int main()
{
    unsigned long long int largefactor = 600851475143;
    for(int i = 2;;)
    {
        if (largefactor <= i)
            break;
        if (largefactor % i == 0)
        {
            largefactor = largefactor / i;
        }
        else
            i++;
    }

    cout << largefactor << endl;

    cin.get();
    return 0;
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-08-10T21:16:26.753

这个 C++ 解决方案在我的 Intel Quad Core i5 iMac (3.1 GHz) 上花费了 3.7 毫秒

```
#include <iostream>
#include <cmath>
#include <ctime>

using std::sqrt; using std::cin;
using std::cout; using std::endl;

long lpf(long n)
{
  long start = (sqrt(n) + 2 % 2);
  if(start % 2 == 0) start++;

  for(long i = start; i != 2; i -= 2)
    {
      if(n % i == 0) //then i is a factor of n                                                
        {
          long j = 2L;
          do {
              ++j;
             }
          while(i % j != 0 && j <= i);

          if(j == i) //then i is a prime number                                           
            return i;
        }
    }
}

int main()
{
  long n, ans;
  cout << "Please enter your number: ";
  cin >> n; //600851475143L                                                               

  time_t start, end;
  time(&start);
  int i;
  for(i = 0; i != 3000; ++i)
      ans = lpf(n);
  time(&end);

  cout << "The largest prime factor of your number is: " << ans << endl;
  cout << "Running time: " << 1000*difftime(end, start)/i << " ms." << endl;

  return 0;
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-17T06:34:40.413

所有 Project Euler 的问题都应该在不到一分钟的时间内完成；即使是 Python 中未优化的递归实现也只需不到一秒 [0.09 秒 (cpu 4.3GHz)]。

```
from math import sqrt

def largest_primefactor(number):
    for divisor in range(2, int(sqrt(number) + 1.5)): # divisor <= sqrt(n)
        q, r = divmod(number, divisor)
        if r == 0:
            #assert(isprime(divisor))
            # recursion depth == number of prime factors,
            # e.g. 4 has two prime factors: {2,2}
            return largest_primefactor(q) 

    return number # number is a prime itself 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-07-26T22:30:05.753

你可能想看看这个： [有没有一种简单的算法可以确定 X 是否为素数，而不会使普通的程序员感到困惑？](https://stackoverflow.com/questions/188425/project-euler-problem)

我喜欢 lill mud 的解决方案：

> 要求“mahn.rb”
> 将 600851475143.prime_division.last.first

我[在这里检查过](http://codepad.org/NgBPxoSK)

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2008-10-14T14:33:01.200

尝试使用[Miller-Rabin Primality Test](http://en.wikipedia.org/wiki/Miller-Rabin_primality_test)来测试一个数是否为素数。这应该会大大加快速度。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2008-10-14T14:52:26.527

另一种方法是先让所有素数达到 n/2，然后检查模数是否为 0。我用来让所有素数达到**n**的算法可以在[这里](http://dev.horemag.net/2007/11/04/prime-numbers-in-php/)找到。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2015-08-25T22:18:39.087

也许它被认为是作弊，但在haskell中的一种可能性是写（为了记录，我自己写了这些行并且没有检查eulerproject线程）；

```
import Data.Numbers.Primes
last (primeFactors 600851475143) 
```

# nhibernate - 从 NHibernate 获得汇总结果的最佳方法是什么？

> ID：201377
> 
> 赞同：2
> 
> 时间：2008-10-14T14:26:17.267
> 
> 标签：nhibernate

例如，我试图在不同情况下获取最小日期、最大日期和总和。我试图避免对 SQL 字符串进行硬编码或通过 IList 循环来获取这些值。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T14:29:48.460

您可以通过 NHibernate 运行直接查询。或者按信息添加其他顺序，以便通过您感兴趣的参数对结果对象进行排序。降序排列，您的第 0 个元素是您想要的最大值和最小值。等等等等。给冬眠的猫剥皮的方法不止一种。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-17T15:53:06.467

如果您需要查询报告，请使用预测。

就像是：

```
Session.CreateCriteria ( typeof ( Order ) )
            .Add ( Restrictions.Between ( "DateReceived" , today.AddMonths ( -1 ) , today ) )
            .CreateAlias ( "Lines" , "lines" )
            .SetProjection (
            Projections.ProjectionList ( )
                .Add ( Projections.Sum ( "lines.TotalCost" ) )
                .Add ( Projections.Avg ( "lines.TotalCost" ) )
                .Add ( Projections.GroupProperty ( "Customer" ) )
            ) ; 
```

[Nhibernate 文档](http://www.hibernate.org/hib_docs/nhibernate/1.2/reference/en/html/querycriteria.html)中有更多内容（下降了 2/3）

# programming-languages - 究竟什么是意向编程

> ID：201386
> 
> 赞同：17
> 
> 时间：2008-10-14T14:28:24.703
> 
> 标签：programming-languages, intentional-programming

在我的阅读狂潮中，我偶然发现了一种叫做[Intentional Programming](http://en.wikipedia.org/wiki/Intentional_programming)的东西。我有点理解它，但我并不完全理解。如果有人可以更详细地解释它，请做。它是否在任何实际应用中使用？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-15T03:58:21.277

你让我开始了这个......
看起来 C. Simonyi 想从高级语言进入下一个抽象级别。减少客户对开发人员的依赖，以便在代码中进行每一次更改（对于非开发人员来说是神秘的）。所以他发明了这个名为 IP 的新产品，它有**一个 WYSIWYG 类型的 GUI 编辑器**来创建一个特定领域的模型。（即，IP 有一个 GUI 来为您的应用程序创建构建块。LISP 允许您创建元/构建块，但不是以领域专家可以轻松做到的方式。）
就像 UML 中的模型一样，承诺是您可以**自动生成相应的源代码**在“按下按钮”。因此，领域专家可以在未来调整模型并按下“烘焙”按钮以交付应用程序的下一个版本。它似乎利用了 DSL，但还有一个额外的好处，即**多个用户创建的 DSL 可以**通过内置的 IP 机制相互通信……这意味着财务模型和销售模型可以根据需要交互和重用块。与 DSL 一样，您可以从传达开发人员意图而不是安抚实现语言限制的代码中受益。

这个想法是为真正知道需要什么的 BA 和领域专家提供更大的控制权......

**更新**：现实世界的使用看起来“还没有”..尽管西蒙尼相信“[绝对是长期](http://d5.allthingsd.com/20070531/d5-charles-simonyi/)的”。
*短篇小说*：MS 压扁 IP 转而支持 .Net 框架，Simonyi 离开 MS 并成立了自己的公司“ [Intentional Software](http://www.intentsoft.com/) ”。合同规定他可以使用 IP 创意，但他必须从头开始重写他的工作原型..（这应该会让他慢下来）。我认为它仍在进行中..并用 C# 编写（启动）

资料来源：

*   [*你能做的任何事，我都可以做元数据*](https://www.technologyreview.com/s/407091/anything-you-can-do-i-can-do-meta/) 作者 Scott Rosenberg，麻省理工科技评论 (2007)

直到昨天才想到..我对此一无所知。调查记者签字。回到日常工作:)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-15T04:34:35.523

*这与我在酒吧爬行后凌晨 2 点回家并打开笔记本电脑“只是为了快速查看我的电子邮件，亲爱*的” 时发生的情况相反。

然后，第二天，当我睁开一只眼睛，***在中午时分找到去洗手间的***路时，我开始刷牙并意识到，牙膏从我嘴里滴出来，昨晚我做了 4 次 SVN 提交，关闭3 个错误，并弄清楚了如何解决我们的分布式锁定协议上的饥饿问题。而且我***不知道***它到底是如何工作的。

或者也许这就是workmad3所说的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-14T14:37:15.340

它似乎是一种编程方法，允许程序员扩展语言中的实际内容以更接近他们的原始意图，而不是强迫程序员意图进入语言的受限语法。

它明确提到 LISP 作为一种支持这一点的语言，所以我建议你阅读这个伟大的语言 :) LISP 宏正是文章中描述的内容，允许你无限扩展语言以涵盖几乎任何你会关心的东西表达。（大型 LISP 系统的一个相当常见的结果是，您最终会得到一种非常适合编写特定应用程序的领域特定语言，即编写文字处理器最终会得到一种文字处理器特定语言）。

对于您的最后一部分，是的，某些项目中使用了 LISP（以及因此的意向编程）。Paul Graham 是 LISP 的大力支持者，其他例子包括原始的 Crash Bandicoot（为此在 LISP 中创建了一个游戏对象创建系统，包括一个 LISP PlayStation 编译器）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-11-17T22:29:09.347

我对有意编程的理解略有不同（作为一个更笼统的术语，不仅仅是查尔斯西蒙尼正在做的事情）。它与流畅的接口密切相关，并且可以在现代面向对象语言中以不同程度的难度实现。

其中一些概念来自领域驱动设计（事实上，“流畅界面”一词已经被“蓝皮书”的作者埃里克·埃文斯（Eric Evans）推广——*领域驱动设计：解决软件核心的复杂性*）。

目的是使非程序员（即业务人员）可以阅读业务层代码。这可以通过明确说明操作*意图*的类和方法名称来实现。在我看来，明确和有意会产生高度可读和可维护的代码。

考虑下面两个实现相同目的的示例 - 为客户创建 10% 折扣的订单并向其中添加几个产品。

```
//C#, Normal version
Customer customer = CustomerService.Get(23);

Order order = new Order();
//What is 0.1? Need to look at Discount property to understand
order.Discount = 0.1; 
order.Customer = customer;

//What's 34?
Product product = ProductService.Get(34); 
//Do we really care about Order stores OrderLines?
order.OrderLines.Add(new OrderLine(product, 1)); 

Product product2 = ProductService.Get(54);
order.OrderLines.Add(new OrderLine(product2, 2)); //What's 2?

Order.Submit();

//C#, Fluent version
//byId is named parameter, states that this method looks up customer by Id
ICustomerForOrderCreation customer = 
  CustomerService.GetCustomerForOrderCreation(byId: 23); 
//Explicit method to create a discount order and explicit percentage
Order order = customer.CreateDiscountOrder(10.Percent()) 
  .WithProduct(ProductService.Get(byId: 34))
  .WithProduct(ProductService.Get(byId: 54))
  .WithQuantity(2); //Explicit quantity

Order.Submit(); 
```

通过稍微改变您的编程风格，您可以更清楚地传达您的意图，并减少必须查看其他地方的代码以了解正在发生的事情的数量。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-15T09:48:49.573

在我看来，这似乎是软件工程的又一时尚。我们已经看到了成千上万个：元编程、生成式编程、可视化编程等等。在很短的时间内，它们变得非常流行，人们到处使用它，然后他们总是回到旧的软件创建方式。

为什么？Frederick Brooks 早在 20 多年前就已经回答了这个问题：[没有银弹](https://web.archive.org/web/20090306034615/http://www.lips.utexas.edu/ee382c-15005/Readings/Readings1/05-Broo87.pdf)可以杀死狼人……

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-11-29T05:34:18.640

意图编程正在编码您的意图或*目标*。因此，它是面向目标的编程或规划。加强管理。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-10-14T15:06:38.043

这是您打算编程的地方，您不会只是偶然地这样做。;)

# asp.net-mvc - 为什么被删除：ASP.NET MVC CheckBoxList（没有 MVCContrib）

> ID：201391
> 
> 赞同：19
> 
> 时间：2008-10-14T14:29:56.043
> 
> 标签：asp.net-mvc, checkboxlist

为什么从 ASP.NET MVC 预览版 5 中删除*CheckBoxList ？*

目前，我看不到任何方式可以创建复选框列表（名称相似但 ID 不同），因此人们可以从列表中选择 0-1 多个选项。

MVCContrib 库中有一个`CheckBoxList`列表，但已弃用。对于其他 HtmlHelpers，我可以理解这一点，但似乎没有替代`CheckBoxList`预览版 5。

我想创建一个非常简单的列表，如下所示，但是使用 ASP.NET MVC 预览版 5 执行此操作的最佳方法是什么？

```
<INPUT TYPE="checkbox" NAME="Inhoud" VALUE="goed"> goed
<INPUT TYPE="checkbox" NAME="Inhoud" VALUE="redelijk"> redelijk
<INPUT TYPE="checkbox" NAME="Inhoud" VALUE="matig"> matig
<INPUT TYPE="checkbox" NAME="Inhoud" VALUE="slecht"> slecht 
```

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-14T14:35:37.763

视图中用于生成复选框的 for 循环

```
<% foreach(Inhoud i in ViewData["InhoudList"] as List<Inhoud>) { %>
  <input type="checkbox" name="Inhoud" value="<%= i.name %>" checked="checked" /> <%= i.name %>
<% } %> 
```

不要使用`Html.Checkbox`，因为这将为列表中的每个项目生成两个值（因为它使用隐藏输入来表示错误值）

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-11T02:37:59.217

我最近写了一篇关于在 MVC Beta 中实现 CheckBoxList 助手的博客。[链接在这里。](http://blogs.msdn.com/miah/archive/2008/11/10/checkboxlist-helper-for-mvc.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-05T04:27:18.200

我有自己的 CheckListBox 实现，它支持 ModelState。如果您有兴趣，请查看*[Un CheckBoxList que funciona en ASP.NET MVC](http://gerardocontijoch.wordpress.com/2009/07/04/un-checkboxlist-que-funciona-en-asp-net-mvc/)*。这篇文章是西班牙语的，但你在阅读代码时应该没有任何问题。

Jeremiah 解决方案的有趣之处在于，您可以设置复选框的初始状态，而我的 CheckListBox 无法做到这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-01T15:58:27.470

I recommend using **JeremiahClark** extension posted above. ([CheckBoxList](http://blogs.msdn.com/miah/archive/2008/11/10/checkboxlist-helper-for-mvc.aspx))

My controller resulted into very simple instructions. For clarify I add a fragment of my code that's absent in the sample.

```
 var rolesList = new List<CheckBoxListInfo>();
        foreach (var role in Roles.GetAllRoles())
        {
            rolesList.Add(new CheckBoxListInfo(role, role, Roles.IsUserInRole(user.UserName, role)));
        }
        ViewData["roles"] = listaRoles; 
```

And in the view:

```
<div><%= Html.CheckBoxList("roles", ViewData["roles"]) %></div> 
```

That's all.

# gzip - 如何从损坏的 .tar.gz 存档中恢复文件？

> ID：201392
> 
> 赞同：28
> 
> 时间：2008-10-14T14:30:03.560
> 
> 标签：gzip, archive, corrupt, recover

我在 .tar.gz 存档中有大量文件。使用命令检查文件类型

```
file SMS.tar.gz 
```

给出回应

```
gzip compressed data - deflate method , max compression 
```

当我尝试使用 gunzip 提取存档时，延迟后我收到了消息

```
gunzip: SMS.tar.gz: unexpected end of file 
```

有什么方法可以恢复部分存档吗？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-10-21T18:29:48.737

恢复是可能的，但这取决于导致损坏的原因。

如果文件只是被截断，得到一些部分结果并不难；赶紧跑

```
gunzip < SMS.tar.gz > SMS.tar.partial 
```

尽管最后出现错误，这将给出一些输出。

如果压缩后的文件有较大的缺失块，那么在坏块之后基本上是没救了。

如果压缩文件被系统性地损坏（例如以 ASCII 模式传输二进制文件，这会破坏整个文件的回车符和换行符），则可以恢复，但需要相当多的自定义编程，这真的很值得如果您绝对没有其他资源（没有备份）并且数据值得付出很多努力。（我已经成功完成了。）我在[上一个问题](https://stackoverflow.com/questions/59735/recover-corrupt-zip-or-gzip-files)中提到了这种情况。

.zip 文件的答案有些不同，因为 zip 档案有多个单独压缩的成员，所以希望更大（尽管大多数商业工具相当虚假，它们通过修补 CRC 来消除警告，而不是通过恢复良好数据）。但是您的问题是关于 .tar.gz 文件，这是一个包含一个大成员的档案。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-10-14T14:32:54.490

你确定它是一个gzip文件吗？我将首先运行“文件 SMS.tar.gz”来验证这一点。

然后我会阅读[The gzip Recovery Toolkit](http://www.urbanophile.com/arenn/coding/gzrt/gzrt.html)页面。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2013-09-20T11:07:51.463

这是我们遇到的一种可能的情况。我们有一个无法解压缩的 tar.gz 文件，尝试解压缩时出现错误：

```
gzip -d A.tar.gz
gzip: A.tar.gz: invalid compressed data--format violated 
```

我发现该文件最初*可能*是通过非二进制 ftp 连接上传的（我们不确定）。

使用 unix`dos2unix`实用程序的解决方案相对简单

```
dos2unix A.tar.gz
dos2unix: converting file A.tar.gz to UNIX format ...
tar -xvf A.tar
file1.txt
file2.txt 
....etc. 
```

有效！这是一种渺茫的可能性，也许值得一试——它可能会帮助那里的人。

# asp.net - ASP.NET 母版页和视图状态

> ID：201401
> 
> 赞同：3
> 
> 时间：2008-10-14T14:31:31.123
> 
> 标签：asp.net, master-pages, viewstate

我希望提高我的网站的性能，不是因为它表现不佳，而是作为一般练习。对于 asp.net 站点的通常建议是尽可能删除视图状态。我相信这可以通过页面上的每个控件单独或整个页面来完成。

我的问题是，如果我禁用页面视图状态，这将停止母版页上控件的视图状态（据我所知，母版页实际上是页面上的控件）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-15T09:09:08.280

有一种简单的方法可以缩小所有视图状态。

步骤 1\. 创建一个如下所示的新类：

```
Imports System  
Imports System.Web.UI

Public Class SessionPageStateAdapter
    Inherits System.Web.UI.Adapters.PageAdapter

    Public Overrides Function GetStatePersister() As System.Web.UI.PageStatePersister

        Return New SessionPageStatePersister(Page)

    End Function
End Class 
```

步骤 2\. 将`App_Browsers`文件夹添加到您的项目。

第 3 步。 在您的新`App_Browsers`文件夹中，添加一个`default.browser`如下所示的新文件。
`<browsers>
<browser refID="Default">
<controlAdapters>
<adapter controlType="System.Web.UI.Page" adapterType="[YourNamespaceGoesHere].SessionPageStateAdapter" />
</controlAdapters>
</browser>
</browsers>`

当你现在运行你的页面时，你应该会发现你的视图状态大小已经下降到几个字节。SessionPageStateAdapter 类在将视图状态提供给浏览器之前拦截它，并将其以会话状态保存在服务器上。仍然发送到客户端的视图状态位只是一个标识符，用于在页面回发到服务器时重构原始视图状态。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T15:06:17.730

是的，页面是页面流的发起者。因此，禁用页面的视图状态会将视图状态呈现出 OnInit 进程。一个更好的问题是为什么禁用母版页的视图状态会做同样的事情？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T17:16:31.010

只是在优化站点之前的一个快速说明，您是否通过确保所有文件在发送之前都经过 gzip 压缩来优化服务器。

如果不是这样，这将在您开始修改页面之前给您带来很好的提升。

[http://www.codinghorror.com/blog/archives/000059.html](http://www.codinghorror.com/blog/archives/000059.html)

# .net - 在具有多个监视器的系统上，如何列出监视器并将表单最大化到其中一个？

> ID：201403
> 
> 赞同：1
> 
> 时间：2008-10-14T14:32:07.207
> 
> 标签：.net, multiple-monitors

我正在开发一个显示多个图表的 .NET 应用程序。我的用户想要一种简单的方式来表达“获取图表 #3 并在我的第四台显示器上将其最大化”。

如何确定监视器的数量，以便我可以选择“监视器 #1、监视器 #2 等”？（并非每个用户都有相同数量的监视器。）

一旦用户选择了特定的监视器，我如何使用该信息来定位他们试图最大化的图表？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-14T14:34:53.223

[Screen类通过查找](http://msdn.microsoft.com/en-us/library/system.windows.forms.screen.aspx)[可用](http://msdn.microsoft.com/en-us/library/system.windows.forms.screen.allscreens.aspx)的屏幕对您有很大帮助。

当您“最大化”表单时，表单将自动最大化到表单所在的屏幕大小。

您可以自己定位它，或者让 Windows 来处理它，只需将表单放在右侧的“屏幕”上，然后最大化它。或者使用屏幕的[WorkingArea](http://msdn.microsoft.com/en-us/library/system.windows.forms.screen.workingarea.aspx)，然后自己填写。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T14:35:20.273

试试 System.Windows.Forms 中的[Screen](http://msdn.microsoft.com/en-us/library/system.windows.forms.screen.aspx)类。AllScreens静态成员包含连接到系统的所有屏幕的列表[。](http://msdn.microsoft.com/en-us/library/system.windows.forms.screen.allscreens.aspx)选择屏幕后，您可以使用[Bounds](http://msdn.microsoft.com/en-us/library/system.windows.forms.screen.bounds.aspx)成员来决定如何将窗口最大化到该屏幕。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T14:37:44.497

使用[SystemInformation.MonitorCount](http://msdn.microsoft.com/en-us/library/system.windows.forms.systeminformation.monitorcount.aspx)和此类中的其他方法。

# cocoa - Cocoa 分布式对象、GC 客户端、非 GC 服务器

> ID：201404
> 
> 赞同：2
> 
> 时间：2008-10-14T14:32:22.307
> 
> 标签：cocoa, macos, garbage-collection, distributed-objects

我有一个设置，其中有两个 Cocoa 进程，与分布式对象 (DO) 通信。客户端正在使用垃圾收集，服务器没有。

似乎客户在我对它们的直接引用之外挂在遥远的对象上。这意味着即使在我没有对这些对象的引用之后，它们也会在 NSDistantObjectTableEntry 拥有的周围徘徊。显然，它们不会在服务器上被释放。

只有当客户端退出时，它才会放开所有远处的对象。手动断开连接可能也可以，但我不想在客户端运行时这样做。

有没有办法告诉 GC'd DO 客户端放弃不再在本地引用的远程对象？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-07-11T15:54:08.903

可能存在跨越客户端和服务器的保留周期——即客户端对象保留服务器对象的代理，而服务器对象又保留客户端对象的代理。

这是保留循环的一个非常简单的示例，当涉及两个以上的对象时，诊断变得更加复杂。

有关其他 DO 相关问题的示例，请参阅[分布式对象的微妙危险。](http://jens.mooseyard.com/2009/07/the-subtle-dangers-of-distributed-objects/ "呜呜")

# c - C 模拟转 STL

> ID：201413
> 
> 赞同：31
> 
> 时间：2008-10-14T14:33:55.457
> 
> 标签：c, stl

只是因为我很好奇——是否有任何 C 类比 C++ 中 STL 的功能？我已经看到有人提到了一个名为 glib的[GTK+库，一些人认为它可以满足要求，但是还有其他库可以在 C 中提供 STL 功能吗？](http://www.gtk.org)

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-10-14T14:52:19.787

是的，`glib`这是一个不错的选择：它包含许多用于操作容器的实用程序，如链表、数组、哈希表等。还有一个面向对象的框架`GObject`，您可以使用它来制作带有信号和插槽的对象C（尽管函数调用名称相当冗长，例如`gobject_set_property`，因为 C 没有任何对象语法）。并且还有主循环的代码，因此您可以编写事件驱动的程序。

更多信息参见维基百科：[https ://en.wikipedia.org/wiki/GLib](https://en.wikipedia.org/wiki/GLib)

Glib 最初是 GTK 的一部分，但非 GUI 代码已被完全排除，以便您可以在命令行程序中使用它：http: [//library.gnome.org/devel/glib/stable/](http://library.gnome.org/devel/glib/stable/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-04-14T13:57:59.520

[CLIB](http://clibutils.sourceforge.net/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2020-07-24T09:45:44.413

添加另一个选项（完全公开，我是作者）；如果您可以编译和链接 C++，您可以查看`libcdada`，它具有纯 C API，但`libstdc++`用作大多数容器的后端：

[https://github.com/msune/libcdada](https://github.com/msune/libcdada)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-14T14:51:49.057

好吧，由于 STL 的本质是基于 C 没有的模板，因此甚至很难接近 C 中的 STL。您可能希望的最好的结果是一些集合类，它们操纵指向未知对象的 void* 指针。

# c# - VS2005 + 项目类型不能选择windows服务

> ID：201426
> 
> 赞同：1
> 
> 时间：2008-10-14T14:36:11.350
> 
> 标签：c#, .net, visual-studio

我正要完成我的项目并将其安装为 Windows 服务。我有安装程序等 - 我需要的一切。当我选择应用程序类型时，Windows 服务没有作为选项出现。

这是踢球者。当我在 VB.NET 中开发时，我有这个选项。上面提到的项目是c#。

另外，如果我尝试添加一个新项目，我无法选择 Windows 服务作为项目类型。在项目中，我可以添加一个 Windows 服务和一个安装程序类。

有什么想法还是我只是忘记了一些愚蠢的事情？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T14:57:47.233

您的项目中需要一个安装程序类，然后您需要一个安装项目，它将包含项目构建的输出。

请参阅此处： http: [//msdn.microsoft.com/en-us/library/aa984464](http://msdn.microsoft.com/en-us/library/aa984464(VS.71).aspx) (VS.71).aspx以获得出色的演练。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T14:45:32.720

在我的 Visual Studio 2005 副本中，当我创建一个新项目时，它没有直接列在 C# 项目类型下，而是在 C#->Windows 下

这里应该有一个名为“Windows 服务”的项目类型，听起来就像您正在寻找的那样。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T21:39:00.840

我在这里发布：

我最终做的是创建一个 sep 类文件，该文件创建了一个 winservice 的实例 - 将其编译为 Windows 服务，然后使用 installutil 安装该服务 - 像冠军一样工作，我不必创建安装程序项目:-)

# iis - 如何将自签名 SSL 证书部署到多个服务器

> ID：201433
> 
> 赞同：3
> 
> 时间：2008-10-14T14:37:53.890
> 
> 标签：iis, ssl, openssl

我需要创建一个自签名 SSL 证书并在两个不同的 Web 服务器上安装相同的证书。对于这个特定场景，我在网络负载平衡配置中有两个 Web 服务器（Win2K3 w/II6）。

我已经安装了IIS资源工具包，可以使用SelfSSL工具制作证书。但是我的困惑来自该工具仅在当前机器上注册证书。如何以我可以在其他 Web 服务器上注册的形式提取证书？

我根本不偏爱 SelfSSL 工具，所以如果我完全错误地处理这个问题，我愿意接受替代说明。我已经看到了有关如何使用 OpenSSL 生成 .cer 文件的说明，但我真的试图推迟安装 OpenSSL，除非我真的必须这样做。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2020-12-13T21:21:24.830

## 前言

这些说明可能对任何人都没有太大帮助，因为[不再支持](https://support.microsoft.com/en-us/windows/windows-7-support-ended-on-january-14-2020-b75d4580-2cc7-895a-2c9c-1466d9a53962)Windows 7 和 IIS 7 。但是，我觉得有必要回答这个问题，因为它是目前 Stackoverflow 上最古老的未回答问题，我觉得我可以根据多个来源提供准确的答案。

这样一来，您应该能够通过*Microsoft 管理控制台*提取 SelfSSL 生成的证书，然后使用*IIS Manager*将其安装在其他 Web 服务器上。由于您在 2008 年提出了这个问题，因此以下说明应该适合您的时间范围。

## 第 1 步：提取证书

这些是[这篇](https://www.howtogeek.com/107415/it-how-to-create-a-self-signed-security-ssl-certificate-and-deploy-it-to-client-machines/)关于 HowToGeek 的文章的相关步骤。

首先，运行命令`mmc`打开管理控制台：

[![Windows 运行对话框](https://i.stack.imgur.com/vp4b1.png)](https://i.stack.imgur.com/vp4b1.png)

在控制台中，转到文件 > 添加/删除管理单元。

[![文件 > 添加/删除管理单元](https://i.stack.imgur.com/omSyg.png)](https://i.stack.imgur.com/omSyg.png)

从左侧添加证书。

[![添加或删除管理单元](https://i.stack.imgur.com/7sQti.png)](https://i.stack.imgur.com/7sQti.png)

选择计算机帐户。

[![证书管理单元](https://i.stack.imgur.com/6LLUa.png)](https://i.stack.imgur.com/6LLUa.png)

选择本地计算机。

[![选择计算机](https://i.stack.imgur.com/hV9bq.png)](https://i.stack.imgur.com/hV9bq.png)

单击确定以查看本地证书存储。

[![添加或删除管理单元](https://i.stack.imgur.com/Il80J.png)](https://i.stack.imgur.com/Il80J.png)

导航到个人 > 证书并找到您使用 SelfSSL 实用程序设置的证书。

[![导航到证书](https://i.stack.imgur.com/jzQOo.png)](https://i.stack.imgur.com/jzQOo.png)

## 第二步：安装证书。

现在您已成功提取证书，下一步是将其安装到 IIS Web 服务器中。同样，[来自 SSL Store](https://www.thesslstore.com/knowledgebase/ssl-install/microsoft-iis-7-ssl-installation/) for IIS 7 的这些说明应该适合您的时间范围。

### 1\. 启动 IIS 管理器

单击开始、控制面板、管理工具，然后选择 Internet 信息服务 (IIS) 管理器。

### 2.选择您的服务器名称

在左侧连接菜单中，选择要安装证书的服务器名称（主机）。

### 3\. 导航到安全部分

在中心菜单中，单击底部附近“安全”部分下的“服务器证书”图标。Microsoft IIS 7 Step4

[![安全部分](https://i.stack.imgur.com/HTkjs.png)](https://i.stack.imgur.com/HTkjs.png)

### 4\. 单击完成证书请求

在右侧的操作菜单中，单击完成证书请求。Microsoft IIS 7 Step5

[![完成证书申请](https://i.stack.imgur.com/zwP5M.png)](https://i.stack.imgur.com/zwP5M.png)

### 5\. 浏览到您的服务器证书

在完成证书请求向导中，单击“...”浏览并选择之前保存在服务器桌面上的您的服务器证书文件。

### 6\. 命名您的证书

输入一个友好名称，这是一个内部参考名称，以便以后区分文件。我们建议包括 CA 名称和到期日期。Microsoft IIS 7 Step7

[![完成证书申请](https://i.stack.imgur.com/1o2Hc.png)](https://i.stack.imgur.com/1o2Hc.png)

### 7.点击确定

单击确定，新安装的证书应出现在刷新的服务器证书列表中。

# c# - 禁用 CD 的 C# FTP

> ID：201436
> 
> 赞同：6
> 
> 时间：2008-10-14T14:38:21.797
> 
> 标签：c#, ftp

我正在尝试使以下代码正常工作：

```
 string url = String.Format(@"SOMEURL");
  string user = "SOMEUSER";
  string password = "SOMEPASSWORD";

  FtpWebRequest ftpclientRequest = (FtpWebRequest)WebRequest.Create(new Uri(url));
  ftpclientRequest.Method = WebRequestMethods.Ftp.ListDirectory;
  ftpclientRequest.UsePassive = true; 
  ftpclientRequest.Proxy = null;
  ftpclientRequest.Credentials = new NetworkCredential(user, password);
  FtpWebResponse response = ftpclientRequest.GetResponse() as FtpWebResponse; 
```

这通常有效，但对于 1 个特定服务器，这会给出错误 500：无法识别语法。更改目录命令在问题服务器上被禁用，站点管理员告诉我，.NET 默认情况下对所有 FTP 连接发出更改目录命令。真的吗？有没有办法禁用它？
编辑：当我从命令行登录时，我在正确的目录中：
ftp> pwd
257 "/" is current directory

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-14T16:17:25.810

我刚刚在我们的一个开发服务器上对此进行了测试，确实有一个由 .NET FtpWebRequest 发出的 CWD：

```
从 172.16.3.210 到 172.16.3.210:21 的新连接（显式 SSL）
主机名解析：devpc
发送欢迎信息。
220 Gene6 FTP Server v3.10.0 (Build 2) 就绪...
用户测试用户
testuser, 331 testuser 需要密码。
测试用户，通过 ****
testuser，以“testuser”身份登录。
testuser, 230 用户 testuser 已登录。
testuser, OPTS utf8 on
testuser, 501 请先CLNT。
测试用户，残疾人
testuser, 257 "/" 是当前目录。
测试用户，CWD /
testuser，更改目录 '/' -> 'D:\testfolder' -> 允许访问。
testuser, 250 CWD 命令成功。“/”是当前目录。
测试用户，类型 I
testuser, 200 类型设置为 I。
测试用户，端口 172,16,3,210,4,127
testuser, 200 端口命令成功。
测试用户，NLST
testuser, 150 打开目录列表的数据连接。
testuser, 226 传输正常。
testuser, 421 连接关闭，超时。
测试用户，断开连接。(00d00:05:01)

```

在创建 FtpWebRequest 对象时，甚至没有在 uri 中指定“/”。

如果您调试或浏览源代码，一个名为“FtpControlStream”的类就会发挥作用。查看调用堆栈：

```
System.dll!System.Net.FtpControlStream.BuildCommandsList(System.Net.WebRequest req) 第 555 行 C#
System.dll!System.Net.CommandStream.SubmitRequest（System.Net.WebRequest 请求 =
    {System.Net.FtpWebRequest}, bool async = false, bool readInitalResponseOnConnect = true) 第 143 行 C#
System.dll!System.Net.FtpWebRequest.TimedSubmitRequestHelper(bool async) 第 1122 行 + 0x13 字节 C#
System.dll!System.Net.FtpWebRequest.SubmitRequest(bool async = false) 第 1042 行 + 0xc 字节 C#
System.dll!System.Net.FtpWebRequest.GetResponse() 第 649 行 C#

```

有一个名为 BuildCommandsList() 的方法被调用。BuildCommandsList() 构建要发送到 FTP 服务器的命令列表。此方法具有以下代码片段：

```
if (m_PreviousServerPath != newServerPath) { 
    if (!m_IsRootPath
        && m_LoginState == FtpLoginState.LoggedIn
        && m_LoginDirectory != null)
    { 
        newServerPath = m_LoginDirectory+newServerPath;
    } 
    m_NewServerPath = newServerPath; 

    commandList.Add(new PipelineEntry(FormatFtpCommand("CWD", newServerPath), PipelineEntryFlags.UserCommand)); 
} 
```

在第一次连接到服务器时，m_PreviousServerPath 始终为 null，newServerPath 的值为“/”，并由名为 GetPathAndFileName() 的函数计算（在此代码块之前的几行调用）。GetPathAndFileName() 如果没有提供路径或者如果在 'ftp://....' uri 的末尾明确添加了“/”，则将 newServerPath 计算为“/”。

所以这当然最终会导致 CWD 命令被添加到命令管道中，因为 null != "/"。

简而言之，不幸的是，您无法覆盖此行为，因为它已在源代码中被烧毁。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-11-17T10:23:18.250

虽然这个帖子是很久以前的......没关系，我会在这里提供答案。

不要`ftp://server/path`用作 uri，而是尝试`ftp://server/%2fpath/`.

添加的`%2f`" 只是一个转义的`/`，添加这将使 C# 将整个路径视为绝对路径。否则 C# 将`ftp://server/`使用用户名登录，转到用户的主文件夹，然后 cd 到您指定的路径，因此您的路径变为`user_home_path/path`，可能不可取。

更多信息可以在 msdn [http://msdn.microsoft.com/en-us/library/system.net.ftpwebrequest.aspx找到](http://msdn.microsoft.com/en-us/library/system.net.ftpwebrequest.aspx)

希望这可以帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T14:53:28.757

我想我们不久前也遇到过类似的问题，但我不记得确切的细节了。

要防止 .net 发出 cd 命令，请查看是否将您登录的用户的默认目录设置为您要工作的目录。您可以使用命令行 ftp 客户端来检查这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-15T17:19:15.560

这是一个解决方案：使用这个由 Dan 在 C-SharpCorner.com 制作的免费、开源、C# FTP 客户端库： [http ://www.c-sharpcorner.com/uploadfile/danglass/ftpclient12062005053849am/ftpclient.aspx](http://www.c-sharpcorner.com/uploadfile/danglass/ftpclient12062005053849am/ftpclient.aspx)

以下是上传文件的一些示例代码：

```
FtpClient ftp = new FtpClient(FtpServer,FtpUserName,FtpPassword);
ftp.Login();
ftp.Upload(@"C:\image.jpg");
ftp.Close(); 
```

该库开箱即用，但也可以轻松扩展和修改。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-10-04T21:11:05.357

使用上面的信息，这对我有用。

发送 CWD - ftpState.ftpRequest = GetRequest(" [ftp://192.168.0.2/tmp/file2download](ftp://192.168.0.2/tmp/file2download) ")

不发送 CWD - ftpState.ftpRequest = GetRequest(" [ftp://192.168.0.2//tmp/file2download](ftp://192.168.0.2//tmp/file2download) ") 注意服务器 IP（或名称）后面的 //

点网 2.0 版

```
Private Function GetRequest(ByVal URI As String) As FtpWebRequest
    'create request
    Dim result As FtpWebRequest = CType(FtpWebRequest.Create(URI), FtpWebRequest)
    Return result
End Function 
```

# visual-studio-2008 - 在 Designer 中刷新 LinQ2SQL 模型而不丢失所有属性

> ID：201443
> 
> 赞同：1
> 
> 时间：2008-10-14T14:40:28.923
> 
> 标签：visual-studio-2008, linq-to-sql, dbml

所以我在当前的应用程序中大量使用 LinQ2SQL，虽然我在部分类中有大部分内容，但必须在 VS 设计器中调整一些东西（比如我包装的字段的访问器）。然后，有时我喜欢在模型中命名字段，而不是在数据库中命名字段。

所以，我现在的问题是。回到更改已知表时，我只有两个选择：

*   通过设计器手动引入新字段
*   从模型中删除表并从服务器资源管理器中重新导入（丢失属性）

两种方式都不尽如人意。是否有一些我错过了“仅刷新更改”的秘密按钮？我的意思是，模型知道所有映射，从数据库中获取新事物并不是那么困难。

有什么办法解决这个问题吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T14:48:49.780

看到[这个](https://stackoverflow.com/questions/40022/best-way-to-update-linq-to-sql-classes-after-database-schema-change)问题。

基本上这在 VS2008 中没有实现。不要问我为什么，也许 MS 的人太忙了以至于他们完全忘记了这个重要的功能。

# sharepoint - 如何获取在 Sharepoint Designer 中创建的工作流的 ID？

> ID：201446
> 
> 赞同：1
> 
> 时间：2008-10-14T14:41:15.037
> 
> 标签：sharepoint, moss, workflow

我编写了一个以编程方式启动工作流的事件接收器，但它需要工作流的 id (guid) 才能启动。如何获取我刚刚在 Sharepoint Designer 中创建的工作流的 ID？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T17:37:39.750

由于您在 SPD 中创建了工作流，因此您应该知道与工作流关联的列表以及工作流的名称。有了这些信息，这应该可以工作：

```
Guid workflowGuid = list.WorkflowAssociations.GetAssociationByName(WORKFLOW_NAME, CULTURE_INFO).Id; 
```

如果您不知道或不想处理 CultureInfo 部分，我想您也可以遍历 SPWorkflowAssociationCollection 并找到正确的工作流程，但这段代码对我来说似乎更干净。

# .net - .NET 的 Visual Studio 调试器提示和技巧

> ID：201450
> 
> 赞同：70
> 
> 时间：2008-10-14T14:43:12.973
> 
> 标签：.net, visual-studio, debugging, hidden-features

多年来我一直在使用 VS 的调试器，但时不时会遇到一个我以前从未注意到的功能，并想“该死！我怎么会错过它？它**太**有用了！”

[免责声明：这些技巧适用于 VS 2005 的 C# 项目，不保证 VS 或其他语言的旧版本]

### 跟踪对象实例

使用给定类的多个实例？你怎么能把它们区分开来？在垃圾收集编程之前的日子里，跟踪引用很容易——只需查看内存地址。使用 .NET，您无法做到这一点 - 对象可以四处移动。幸运的是，手表视图允许您右键单击手表并选择“制作对象 ID”。

> > [手表查看 http://img403.imageshack.us/img403/461/52518188cq3.jpg](http://img403.imageshack.us/img403/461/52518188cq3.jpg)

这会在实例的值之后附加 {1#}、{2#} 等，从而有效地为实例提供唯一标签。它看起来像这样：

> > [编号实例 http://img383.imageshack.us/img383/7351/11732685bl8.jpg](http://img383.imageshack.us/img383/7351/11732685bl8.jpg)

标签在该对象的生命周期内保持不变。

### 监视变量的有意义的值

默认情况下，监视变量的值是它的类型。如果你想查看它的字段，你必须扩展它，如果有很多字段或者他们做一些复杂的事情，这可能需要很长时间（甚至超时！）。

但是，一些预定义的类型会显示更有意义的信息：

*   字符串显示它们的实际内容
*   列表和字典显示它们的元素计数等。

[有意义的信息 http://img205.imageshack.us/img205/4808/37220487md1.jpg](http://img205.imageshack.us/img205/4808/37220487md1.jpg)

为我自己的类型拥有它不是很好吗？

唔...

`DebuggerDisplay`... .NET Reflector 的一些质量时间显示了使用我的自定义类型上的属性可以轻松实现这一点：

```
[System.Diagnostics.DebuggerDisplay("Employee: '{Name}'")]
public class Employee {
    public string Name { get { ... } }
    ...
} 
```

...重新运行，然后...

[达达！http://img60.imageshack.us/img60/926/79816018ha1.jpg](http://img60.imageshack.us/img60/926/79816018ha1.jpg)

这里有更多关于这个主题的信息：[MSDN](http://msdn.microsoft.com/en-us/magazine/cc163974.aspx)

### 打破所有例外

...即使是那些在代码中处理的！我知道，自从我出生以来，我就不知道这件事，但无论如何，这件事发生了——也许有一天这会对某人有所帮助：

每次抛出异常时，您都可以强制调试进程进入调试模式。是否曾经进行了数小时的 bug 搜寻，却发现了这样的一段代码？

```
try {
    runStrangeContraption();
} catch(Exception ex) {
    /* TODO: Will handle this error later */
} 
```

在这些情况下，捕获所有异常非常方便。这可以从*Debug > Exceptions... (Ctrl-Alt-E)*启用。勾选您需要的每种异常类型的“抛出”列中的框。

* * *

对我来说，那是一些拍打额头的时刻。你愿意分享你的吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-15T13:00:21.587

```
try {
    // do something big
}
catch {
    // breakpoint set here:
    throw CantHappenException("something horrible happened that should never happen.");
} 
```

您如何看待最初抛出的异常？在监视窗口中，输入 $exception

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-15T12:03:56.587

这是我学到的另一个巧妙的技巧：

```
System.Diagnostics.Debugger.Break() 
```

以编程方式导致调试器在下一条指令上中断。*真正*好的部分是，这也适用于在**发布**模式下编译的程序，没有调试信息。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-14T15:17:35.260

我总是确保在我创建的新线程上设置“名称”属性。这样，当我调试时，我可以更轻松地识别不同的线程。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-10-14T15:07:58.307

当然，请查看当天的 VS 提示：

[http://blogs.msdn.com/SaraFord/](http://blogs.msdn.com/SaraFord/)

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-10-15T12:18:07.413

我的几个

*   在工具->选项->调试中取消选中“仅启用我的代码”选项。
*   条件断点——它们几乎每天都在挽救我的生命
*   如果事情变得丑陋[，请使用 .NET 框架源代码](http://blogs.msdn.com/sburke/archive/2008/01/16/configuring-visual-studio-to-debug-net-framework-source-code.aspx)

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-09-02T13:41:55.603

两个代码技巧：

我真的很喜欢[System.Diagnostics.DebuggerStepThrough](http://msdn.microsoft.com/en-us/library/system.diagnostics.debuggerstepthroughattribute.aspx)属性；您可以将其附加到类、方法或属性上，使 VS 在调试时默认不输入代码。我更喜欢它而不是[DebuggerHidden](http://msdn.microsoft.com/en-us/library/system.diagnostics.debuggerhiddenattribute.aspx)属性，因为如果你真的需要调试它，它仍然允许你在被忽略的代码中放置断点。

另一个（有时）有用的调用是[System.Diagnostics.Debugger.Launch()](http://msdn.microsoft.com/en-us/library/system.diagnostics.debugger.launch.aspx)；当执行成功时，您将看到“选择调试器”对话框，并且调试器将启动。有点粗鲁，但在附加到进程时特别有用，例如一个由另一个进程生成并立即执行您的代码的进程。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-10-15T12:55:26.513

`.load sos`在即时窗口中:)

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-10-15T12:18:45.213

工具 -> 附加到进程 - 很容易忘记，但使用它我可以调试网页中的脚本、在另一个进程中加载​​的托管代码（想想插件模型），甚至是非托管代码。小心让它自动选择您感兴趣的调试类型。

跟踪点（和其他断点功能......右键单击断点并玩得开心）！- [http://blogs.msdn.com/saraford/archive/2008/06/13/did-you-know-you-can-use-tracepoints-to-log-printf-or-console-writeline-info-without -editing-your-code-237.aspx](http://blogs.msdn.com/saraford/archive/2008/06/13/did-you-know-you-can-use-tracepoints-to-log-printf-or-console-writeline-info-without-editing-your-code-237.aspx)

即时窗口很棒。

如果您部署应用程序（并且可以到达可以重现问题的机器），[远程调试非常有用。](http://msdn.microsoft.com/en-us/library/bt727f1t.aspx)

还有很多。尝试进入 WinDbg 和 SoS！

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-12-30T19:13:21.343

我发现“模块”窗口很多时候都很有用。它告诉调试器是否加载了所需的 dll 以及加载了哪个版本的 dll。它还允许您手动加载或卸载 dll。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-10-15T12:17:42.283

如果您的代码重复很多但仅在一组特定条件下失败（例如循环中的代码、从循环调用的方法或从多个线程调用的方法），条件中断非常有用。将 break 语句放在感兴趣的行并设置其条件以匹配错误情况。[（这里](http://www.odetocode.com/Articles/425.aspx)有一个简单的例子。）

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-12-30T17:12:03.897

来自我的两个：我希望每个人都使用的一个：

```
Debug.Assert(<condition>, <message>) 
```

第二个DebuggerHidden：

```
<DebuggerHidden()> _
Public Sub ReadDocumentProperty(ByVal propertyName As String, ByRef PropVal As Integer, ByVal DefaultVal As Integer)
    Try
        Dim prop As Office.DocumentProperty
        prop = CustomProps.Item(propertyName)
        PropVal = CType(prop.Value, Integer)
    Catch
        PropVal = DefaultVal
    End Try
End Sub 
```

即使你设置了Debug、Exceptions、Break on throwed exceptions，这里的异常也不会被捕获。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-12-04T01:02:45.133

创建一个宏以附加到进程并分配给未使用的键盘快捷键。比去快得多：调试->附加到进程->在进程列表中搜索进程->...

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-03-16T16:45:59.197

即使我们没有设置任何调试点，如何将 IDE 设置为在发生异常时中断异常。

调试--> 异常--> 公共语言运行时异常--> 抛出

这使得查找隐藏的异常处理问题变得轻而易举。实际上，这是每个开发人员在整个开发过程中都应该设置的一种设置，以避免出现任何未经处理甚至处理的异常。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-08-24T16:39:02.287

在非托管代码中，您可以设置“数据断点”。他们使用 CPU 的调试寄存器发出一个 INT3，并且调试器在该指令上停止，在运行时没有开销（在旧版本中，调试器逐步检查内存......慢！）

如果您在已知地址有一些损坏（堆栈/堆变量被破坏），这很有用。

此外，可以自定义 ide\packages\debugger 中的 AutoExp.dat 以显示您的数据结构。

指针，mb 在监视窗口中显示十六进制转储 [http://msdn.microsoft.com/en-us/magazine/dd252945.aspx](http://msdn.microsoft.com/en-us/magazine/dd252945.aspx)

嗯！

# java - 我可以让我的小程序更优雅地结束吗？

> ID：201453
> 
> 赞同：1
> 
> 时间：2008-10-14T14:43:31.287
> 
> 标签：java, applet

我有一个 JApplet，其中包含各种 Swing 组件。它还在 init() 中启动了几个额外的线程，并且通常会执行其他非常标准的 applet-y 事情。

如果我关闭包含 Applet 的浏览器窗口，则 JRE 不会消失（图标保留在系统托盘中），直到所有浏览器的窗口都已关闭（即浏览器已完全结束并从任务管理器中消失）

这是预期的行为还是 JRE 应该在包含 Applet 的浏览器窗口关闭时结束？

我有一个 destroy() 方法，但（目前）它只停止我在 init() 方法中启动的额外线程。我应该在这里做更多的事情吗？还有其他我应该遵循的最佳实践吗？

如果您想了解更多信息，请在评论中告诉我。

:-)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-14T14:46:29.707

我相信 JRE 作为插件加载到浏览器中，并且该图标应该保留在系统托盘中，直到浏览器结束。

这背后的原因是，如果您加载一个小程序，让 JRE 继续运行将加快未来小程序的加载时间。

# php - 如何在 PHP 中实现 Django 和 RoR 使用的 URL 模式解释器

> ID：201457
> 
> 赞同：3
> 
> 时间：2008-10-14T14:45:28.523
> 
> 标签：php, url, interpreter, front-controller

在 PHP中实现 URL 解释器/调度程序（例如在[Django](http://docs.djangoproject.com/en/dev/topics/http/urls/?from=olddocs)和 RoR 中找到）的最佳方法是什么？

它应该能够按如下方式解释查询字符串：

*   `/users/show/4`映射到
    *   *面积*=**用户**
    *   *行动*=**展示**
    *   *编号*= **4**
*   `/contents/list/20/10`映射到
    *   *面积*=**内容**
    *   *行动*=**清单**
    *   *开始*= **20**
    *   *计数*= **10**
*   `/toggle/projects/10/active`映射到
    *   *动作*=**切换**
    *   面积 =**项目**
    *   *编号*= **10**
    *   *字段*=**活跃**

其中查询字符串可以是指定的 GET / POST 变量，也可以是传递给解释器的字符串。

编辑：我更喜欢不使用 mod_rewrite 的实现。

编辑：这个问题不是关于干净的 url，而是关于解释一个 URL。Drupal 使用 mod_rewrite 将诸如[http://host/node/5](http://host/node/5)之类的请求重定向到[http://host/?q=node/5](http://host/?q=node/5)。然后它解释 $_REQUEST['q'] 的值。我对口译部分很感兴趣。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T16:59:22.090

为什么您不希望使用 mod_rewrite？[RoR 使用 mod_rewrite](http://wiki.rubyonrails.org/rails/pages/mod_rewrite)。我不确定 Django 是如何做到这一点的，但是 mod_php 默认将 URL 映射到文件，因此除非您创建一个系统，为每个可能的 URL 编写单独的 PHPfile（维护噩梦），否则您需要使用 mod_rewrite 来处理干净的 URL .

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T15:30:15.890

以 cakephp 实现为例：

[https://trac.cakephp.org/browser/trunk/cake/1.2.xx/cake/dispatcher.php](https://trac.cakephp.org/browser/trunk/cake/1.2.x.x/cake/dispatcher.php)

[https://trac.cakephp.org/browser/trunk/cake/1.2.xx/cake/libs/router.php](https://trac.cakephp.org/browser/trunk/cake/1.2.x.x/cake/libs/router.php)

你也可以用 mod_rewrite 做一些事情：

```
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{REQUEST_FILENAME} -f
    RewriteRule ^(.*)$ $1 [L]
    RewriteRule ^([a-z]{2})/(.*)$ $2?lang=$1 [QSA,L]
    RewriteRule ^(.*)$ index.php?url=$1 [QSA,L]
</IfModule> 
```

这将捕获 url `/en/foo` `/de/foo`，并将它们传递给 index.php，`GET`参数为“lang”和“url”。可以为“项目”、“行动”等做类似的事情

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-29T22:29:06.710

您在问题中描述的实际上应该是 URL 映射器部分。为此，您可以使用名为[Net_URL_Mapper](http://pear.php.net/package/Net_URL_Mapper "PEAR :: 包 :: Net_URL_Mapper")的 PEAR 包。有关如何使用该类的一些信息，请查看此[单元测试](http://cvs.php.net/viewvc.cgi/pear/Net_URL_Mapper/tests/RecognitionTest.php?view=markup "RecognitionTest.php 源代码")。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-14T15:00:32.003

如果合适，您可以使用已经存在于 MVC 框架中的一个。

查看诸如 Zend Framework、CakePHP、Symfony、Code Ignitor、Kohana、Solar 和 Akelos 之类的项目（排名不分先后）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-15T02:54:18.317

我这样做的方法非常简单。
我使用 wordpress 的 .htaccess 文件：

```
<IfModule mod_rewrite.c>
RewriteEngine On
RewriteBase /
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule . /index.php [L] 
```

这个 .htaccess 所做的是，当某些东西返回 404 时，它会将用户发送到 index.php。

在上面，/index.php 是 URL 的“解释器”。
在 index.php 中，我有以下内容：

```
$req = $_SERVER['REQUEST_URI'];
$req = explode("/",$req); 
```

第二行根据“/”将 URL 分成几个部分。你可以有

```
$area = $req['0'];
$action= $req['1'];
$id = $req['2']; 
```

我最终要做的是：

```
function get_page($offset) {//offset is the chunk of URL we want to look at
    $req = $_SERVER['REQUEST_URI'];
    $req = explode("/",$req);
    $page = $req[$offset];
    return $page;
}
$area   = get_page(0);
$action = get_page(1);
$id     = get_page(2); 
```

希望这可以帮助！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-14T15:04:20.403

为了第二个@ [Cheekysoft](https://stackoverflow.com/questions/201457/how-to-implement-url-pattern-interpreter-as-used-by-django-and-ror-in-php#201523)的建议，请查看 Zend 框架的[Zend_Controller](http://zendframework.com/manual/en/zend.controller.html)组件。它是[前端控制器模式](http://www.martinfowler.com/eaaCatalog/frontController.html)的实现，可以独立于框架的其余部分使用（假设您不想使用完整的 MVC 框架）。

显然，[CakePHP](http://cakephp.org/)与 RoR 风格最为相似。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-11-29T22:39:51.197

我正在做一个 PHP 框架，它的功能正是您所描述的 - 将 Django 正在做的事情带到 PHP 中，这就是我目前解决这个问题的方法：

要获得 Django 拥有的漂亮而干净的 RESTful URL（[http://example.com/do/this/and/that/](http://example.com/do/this/and/that/)），不幸的是，您需要`_`重写 mod。但一切都不像看起来那么闷闷不乐，因为您可以使用包含脚本文件名的 URI（[http://example.com/index.php/do/this/and/that/](http://example.com/index.php/do/this/and/that/)）实现几乎相同的事情. 我的 mod rewrite 只是将所有调用转发到该格式，所以它几乎和没有 mod rewrite 技巧`_`一样可用。`_`

老实说，我目前正在通过 GET ( [http://example.com/index.php?do/this/and/that/](http://example.com/index.php?do/this/and/that/) ) 执行后一种方法，并修复一些东西以防传递一些真正的 GET 变量. 但我最初的研究表明，在文件名后使用正斜杠应该更容易。您可以使用某个`$_SERVER`超全局索引来挖掘它，并且不需要任何 Apache 配置。无法立即记住确切的索引，但是您可以轻松地做一个`phpinfo()`测试页来查看引擎盖下的东西。

希望这可以帮助。

# python - Python 中最短的数独求解器 - 它是如何工作的？

> ID：201461
> 
> 赞同：82
> 
> 时间：2008-10-14T14:46:15.603
> 
> 标签：python, algorithm

当我遇到这个问题时，我正在使用自己的数独求解器并正在寻找一些指向良好和快速设计的指针：

```
def r(a):i=a.find('0');~i or exit(a);[m
in[(i-j)%9*(i/9^j/9)*(i/27^j/27|i%9/3^j%9/3)or a[j]for
j in range(81)]or r(a[:i]+m+a[i+1:])for m in'%d'%5**18]
from sys import*;r(argv[1]) 
```

我自己的实现解决了数独问题，就像我在脑海中解决它们一样，但是这个神秘的算法是如何工作的？

[http://scottkirkwood.blogspot.com/2006/07/shortest-sudoku-solver-in-python.html](http://scottkirkwood.blogspot.com/2006/07/shortest-sudoku-solver-in-python.html)

* * *

## 回答 #1

> 赞同：223
> 
> 时间：2008-10-14T16:00:21.413

好吧，您可以通过修复语法使事情变得更容易：

```
def r(a):
  i = a.find('0')
  ~i or exit(a)
  [m in[(i-j)%9*(i/9^j/9)*(i/27^j/27|i%9/3^j%9/3)or a[j]for j in range(81)] or r(a[:i]+m+a[i+1:])for m in'%d'%5**18]
from sys import *
r(argv[1]) 
```

稍微清理一下：

```
from sys import exit, argv
def r(a):
  i = a.find('0')
  if i == -1:
    exit(a)
  for m in '%d' % 5**18:
    m in[(i-j)%9*(i/9^j/9)*(i/27^j/27|i%9/3^j%9/3) or a[j] for j in range(81)] or r(a[:i]+m+a[i+1:])

r(argv[1]) 
```

好的，所以这个脚本需要一个命令行参数，并在其上调用函数 r。如果该字符串中没有零，则 r 退出并打印出它的参数。

> （如果传递了另一种类型的对象，则 None 相当于传递零，并且任何其他对象都打印到 sys.stderr 并导致退出代码为 1。特别是 sys.exit("some error message") 是发生错误时退出程序的快捷方式。见 [http://www.python.org/doc/2.5.2/lib/module-sys.html](http://www.python.org/doc/2.5.2/lib/module-sys.html) )

我猜这意味着零对应于开放空间，并且解决了没有零的难题。然后是那个讨厌的递归表达式。

循环很有趣：`for m in'%d'%5**18`

为什么是 5**18？事实证明，`'%d'%5**18`评估为`'3814697265625'`。这是一个每个数字至少有一次 1-9 的字符串，所以它可能正在尝试放置每个数字。事实上，它看起来`r(a[:i]+m+a[i+1:])`是这样的：递归调用 r，第一个空白由该字符串中的一个数字填充。但这只发生在前面的表达式为假的情况下。让我们看一下：

`m in [(i-j)%9*(i/9^j/9)*(i/27^j/27|i%9/3^j%9/3) or a[j] for j in range(81)]`

因此，仅当 m 不在该怪物列表中时才完成放置。每个元素要么是一个数字（如果第一个表达式为非零）或一个字符（如果第一个表达式为零）。如果 m 作为字符出现，则排除它作为可能的替换，这仅在第一个表达式为零时才会发生。表达式何时为零？

它包含三个相乘的部分：

*   `(i-j)%9`如果 i 和 j 是 9 的倍数，即同一列，则该值为零。
*   `(i/9^j/9)`如果 i/9 == j/9，即同一行，则为零。
*   `(i/27^j/27|i%9/3^j%9/3)`如果这两个都为零，则为零：
*   *   `i/27^j^27`如果 i/27 == j/27 则为零，即相同的三行块
*   *   `i%9/3^j%9/3`如果 i%9/3 == j%9/3 则为零，即相同的三列块

如果这三个部分中的任何一个为零，则整个表达式为零。换句话说，如果 i 和 j 共享一个行、列或 3x3 块，则 j 的值不能用作 i 处空白的候选。啊哈！

```
from sys import exit, argv
def r(a):
  i = a.find('0')
  if i == -1:
    exit(a)
  for m in '3814697265625':
    okay = True
    for j in range(81):
      if (i-j)%9 == 0 or (i/9 == j/9) or (i/27 == j/27 and i%9/3 == j%9/3):
        if a[j] == m:
          okay = False
          break
    if okay:
      # At this point, m is not excluded by any row, column, or block, so let's place it and recurse
      r(a[:i]+m+a[i+1:])

r(argv[1]) 
```

请注意，如果没有一个放置成功，r 将返回并返回到可以选择其他内容的点，因此它是一种基本的深度优先算法。

不使用任何启发式方法，它不是特别有效。我从 Wikipedia ( [http://en.wikipedia.org/wiki/Sudoku](http://en.wikipedia.org/wiki/Sudoku) ) 中获取了这个谜题：

```
$ time python sudoku.py 530070000600195000098000060800060003400803001700020006060000280000419005000080079
534678912672195348198342567859761423426853791713924856961537284287419635345286179

real    0m47.881s
user    0m47.223s
sys 0m0.137s 
```

附录：作为维护程序员我将如何重写它（这个版本有大约 93 倍的加速 :)

```
import sys

def same_row(i,j): return (i/9 == j/9)
def same_col(i,j): return (i-j) % 9 == 0
def same_block(i,j): return (i/27 == j/27 and i%9/3 == j%9/3)

def r(a):
  i = a.find('0')
  if i == -1:
    sys.exit(a)

  excluded_numbers = set()
  for j in range(81):
    if same_row(i,j) or same_col(i,j) or same_block(i,j):
      excluded_numbers.add(a[j])

  for m in '123456789':
    if m not in excluded_numbers:
      # At this point, m is not excluded by any row, column, or block, so let's place it and recurse
      r(a[:i]+m+a[i+1:])

if __name__ == '__main__':
  if len(sys.argv) == 2 and len(sys.argv[1]) == 81:
    r(sys.argv[1])
  else:
    print 'Usage: python sudoku.py puzzle'
    print '  where puzzle is an 81 character string representing the puzzle read left-to-right, top-to-bottom, and 0 is a blank' 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-14T15:05:37.997

不混淆它：

```
def r(a):
    i = a.find('0') # returns -1 on fail, index otherwise
    ~i or exit(a) # ~(-1) == 0, anthing else is not 0
                  # thus: if i == -1: exit(a)
    inner_lexp = [ (i-j)%9*(i/9 ^ j/9)*(i/27 ^ j/27 | i%9/3 ^ j%9/3) or a[j] 
                   for j in range(81)]  # r appears to be a string of 81 
                                        # characters with 0 for empty and 1-9 
                                        # otherwise
    [m in inner_lexp or r(a[:i]+m+a[i+1:]) for m in'%d'%5**18] # recurse
                            # trying all possible digits for that empty field
                            # if m is not in the inner lexp

from sys import *
r(argv[1]) # thus, a is some string 
```

所以，我们只需要计算出内部列表表达式。我知道它收集了行中设置的数字——否则，它周围的代码毫无意义。但是，我不知道它是如何做到的（我现在太累了，无法解决这种二元幻想，抱歉）

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-14T15:07:20.723

`r(a)`是一个递归函数，它试图`0`在每一步中填写一个。

`i=a.find('0');~i or exit(a)`是成功终止。如果板上没有更多`0`的值，我们就完成了。

`m`是我们将尝试填充的当前值`0`。

`m in[(i-j)%9*(i/9^j/9)*(i/27^j/27|i%9/3^j%9/3)or a[j]for j in range(81)]`如果放入 current 明显不正确，则评估为`m`真`0`。让我们给它起个绰号“is_bad”。这是最棘手的一点。:)

`is_bad or r(a[:i]+m+a[i+1:]`是条件递归步骤。`0` 如果当前候选解决方案看起来很理智，它将递归地尝试评估董事会中的下一个。

`for m in '%d'%5**18`枚举从 1 到 9 的所有数字（效率低下）。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-14T14:54:14.620

许多短数独求解器只是递归地尝试所有可能的合法数字，直到他们成功填充单元格。我没有把它拆开，但只是略读它，它看起来就是这样。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-02-24T17:46:49.357

该代码实际上不起作用。你可以自己测试一下。这是一个未解决的数独难题示例：

807000003602080000000200900040005001000798000200100070004003000000040108300000506

您可以使用这个网站（[http://www.sudokuwiki.org/sudoku.htm](http://www.sudokuwiki.org/sudoku.htm)），点击导入拼图并简单地复制上面的字符串。python程序的输出为：817311213622482322131224934443535441555798655266156777774663869988847188399979596

这与解决方案不对应。事实上，你已经可以看到一个矛盾，第一行有两个 1。

# php - 动态准备语句不好吗？（用 php + mysqli）

> ID：201468
> 
> 赞同：7
> 
> 时间：2008-10-14T14:48:13.900
> 
> 标签：php, sql, dynamic, eval, prepared-statement

我喜欢 Dynamic SQL 的灵活性，我喜欢 Prepared Statements 的安全性 + 改进的性能。所以我真正想要的是动态准备语句，这很麻烦，因为 bind_param 和 bind_result 接受“固定”数量的参数。所以我使用 eval() 语句来解决这个问题。但我觉得这是个坏主意。这是我的意思的示例代码

```
// array of WHERE conditions
$param = array('customer_id'=>1, 'qty'=>'2');
$stmt = $mysqli->stmt_init();

$types = ''; $bindParam = array(); $where = ''; $count = 0;

// build the dynamic sql and param bind conditions
foreach($param as $key=>$val)
{
    $types .= 'i';
    $bindParam[] = '$p'.$count.'=$param["'.$key.'"]'; 
    $where .= "$key = ? AND ";
    $count++;
}

// prepare the query -- SELECT * FROM t1 WHERE customer_id = ? AND qty = ?
$sql = "SELECT * FROM t1 WHERE ".substr($where, 0, strlen($where)-4);
$stmt->prepare($sql);

// assemble the bind_param command
$command = '$stmt->bind_param($types, '.implode(', ', $bindParam).');';

// evaluate the command -- $stmt->bind_param($types,$p0=$param["customer_id"],$p1=$param["qty"]);
eval($command); 
```

最后一个 eval() 语句是个坏主意吗？我试图通过在变量名 $param 后面封装值来避免代码注入。

有没有人有意见或其他建议？有我需要注意的问题吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-14T15:23:22.830

我认为`eval()`在这里使用是危险的。

试试这个：

*   迭代 params 数组以构建带有问号的 SQL 字符串`"SELECT * FROM t1 WHERE p1 = ? AND p2 = ?"`
*   呼吁`prepare()`_
*   用于`call_user_func_array()`调用`bind_param()`，传入动态参数数组。

编码：

```
call_user_func_array(array($stmt, 'bind_param'), array($types)+$param); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2019-01-05T02:17:14.587

我做了一个过滤函数，它接收一个数组，一个关联数组，如 $_GET：

在模型类中，我定义了几个属性，包括模式：

```
private $table_name = "products";

protected $schema = [
    'id' => 'INT',
    'name' => 'STR',
    'description' => 'STR',
    'size' => 'STR',
    'cost' => 'INT',
    'active' => 'BOOL'
]; 
```

然后是一个过滤器方法，它接收一个关联的条件数组：

```
function filter($conditions)
{
    $vars   = array_keys($conditions);
    $values = array_values($conditions);

    $where = '';
    foreach($vars as $ix => $var){
        $where .= "$var = :$var AND ";
    }
    $where =trim(substr($where, 0, strrpos( $where, 'AND ')));

    $q  = "SELECT * FROM {$this->table_name} WHERE $where";
    $st = $this->conn->prepare($q);

    foreach($values as $ix => $val){
        $st->bindValue(":{$vars[$ix]}", $val, constant("PDO::PARAM_{$this->schema[$vars[$ix]]}"));
    }

    $st->execute();
    return $st->fetchAll(PDO::FETCH_ASSOC);
} 
```

并且非常适合过滤结果

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-15T15:22:45.093

你真的不需要准备好的语句和绑定的参数，因为你总是可以使用 mysql_real_escape_string()。你是对的；动态生成的 SQL 更加灵活和有价值。

这是一个使用常规 mysql_* 接口的简单示例：

```
// Array of WHERE conditions
$conds = array("customer_id" => 1, "qty" => 2);

$wherec = array("1");
foreach ($conds as $col=>$val) $wherec[] = sprintf("`%s` = '%s'", $col, mysql_real_escape_string($val));

$result_set = mysql_query("SELECT * FROM t1 WHERE " . implode(" AND ", $wherec); 
```

当然，这是一个简单的示例，要使其有用，您必须对其进行大量构建和改进，但它显示了想法并且它确实非常非常有用。例如，这是一个完全通用的函数，用于向任意表中插入新行，列中填充了关联数组中的值，并且完全安全 SQL 注入：

```
function insert($table, $record) {
    $cols = array();
    $vals = array();
    foreach (array_keys($record) as $col) $cols[] = sprintf("`%s`", $col);
    foreach (array_values($record) as $val) $vals[] = sprintf("'%s'", mysql_real_escape_string($val));

    mysql_query(sprintf("INSERT INTO `%s`(%s) VALUES(%s)", $table, implode(", ", $cols), implode(", ", $vals)));
}

// Use as follows:
insert("customer", array("customer_id" => 15, "qty" => 86)); 
```

# sql-server - SQL Reporting Services 数据连接更新

> ID：201473
> 
> 赞同：2
> 
> 时间：2008-10-14T14:48:59.247
> 
> 标签：sql-server, reporting-services, connection-string, datasource, publish

是否可以更改已发布的 sql 报告服务报告的连接字符串？我可以在 ReportServer 数据库中看到名为 DataSource 的二进制字段，但由于它是以二进制形式存储的，因此我认为它不容易更新。

我是否需要使用正确的数据源重新发布报告？我希望不是，因为我不想安装 VS2003。

编辑：客户端正在运行安装了所有服务包的 SQL Server 2000 Reporting Services。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-17T15:42:44.007

SQL Reporting Services 2000 具有可用于更改数据源的 [Web 服务]( [http://msdn.microsoft.com/en-us/library/aa274396(SQL.80).aspx) 。](http://msdn.microsoft.com/en-us/library/aa274396(SQL.80).aspx))鉴于此，以下允许将数据源更改为共享数据源。这是[改编自 MSDN]( [http://msdn.microsoft.com/en-us/library/aa225896(SQL.80).aspx)](http://msdn.microsoft.com/en-us/library/aa225896(SQL.80).aspx))。

```
// Create our reporting services class
ReportingService theRS = new ReportingService();
theRS.Credentials = System.Net.CredentialCache.DefaultCredentials;

// We need to setup a data source reference to an existing shared data source
DataSourceReference theDSRef = new DataSourceReference();
theDSRef.Reference = "/Path/To/ExistingSharedDataSource";
DataSource[] theDSArray = new DataSource[1];
DataSource theDS = new DataSource();
theDS.Item = (DataSourceReference)theDSRef;
theDS.Name = "NameOfSharedDataSource";
theDSArray[0] = theDS;

try
{
    // Attempt to change the data source of the report
    theRS.SetReportDataSources("/Path/To/ReportName", theDSArray);
    Console.Out.WriteLine("We have changed the data source");
}
catch (System.Web.Services.Protocols.SoapException e)
{
    Console.Out.WriteLine(e.Message);
    Console.Out.WriteLine(e.Detail.InnerXml.ToString());
} 
```

在此示例中，**ReportingService**类取自我为与 Web 服务通信而生成的 Proxy 类，[此处]( [http://msdn.microsoft.com/en-us/library/aa256607(SQL. 80).aspx)](http://msdn.microsoft.com/en-us/library/aa256607(SQL.80).aspx))。

我希望这会有所帮助。如果您正在寻找不同的东西，请告诉我。

# java - Simple java client code for Web Service - something to do with QName?

> ID：201476
> 
> 赞同：2
> 
> 时间：2008-10-14T14:50:10.103
> 
> 标签：java, web-services, client, rpc

I am getting the following error when I get to the line that invokes a REALLY BASIC web service I have running on Tomcat/Axis.

```
Element or attribute do not match QName production: QName::=(NCName':')?NCName 
```

Have I got something wrong with QName?- I can't even find any useful information about it.

My client code is below:

```
import javax.xml.namespace.QName;
import org.apache.axis.client.Call;
import org.apache.axis.client.Service;

    public class TestClient {

    public static void main(String [] args)
    {
        try{
            String endpoint = "http://localhost:8080/TestWebService/services/DoesMagic";  

            Service service = new Service();
            Call call = (Call) service.createCall();

            call.setTargetEndpointAddress( new java.net.URL(endpoint) );
            call.setOperationName( new QName("http://testPackage.fc.com/, doBasicStuff") );

            String ret = (String) call.invoke( new Object[] {"some kind of message"} );

            System.out.println(ret);

        }catch(Exception e){
            System.err.println(e.toString());
        }
    }
} 
```

My web serivce code is really basic - just a simple class that returns your input string with a bit of concat text:

```
public String doBasicStuff(String message)
    {
        return "This is your message: " + message;

    } 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-14T14:56:02.993

As the exception says, you call the QName constructor incorrectly:

```
new QName("http://testPackage.fc.com/, doBasicStuff") 
```

is incorrect. I think you have to pass two strings, one containing the namespace, one the localname. The documentation will typically contain a description on how to use that class.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-14T14:54:36.320

Could it be a typo in your QName?:

```
new QName("http://testPackage.fc.com/", "doBasicStuff") 
```

instead of:

```
new QName("http://testPackage.fc.com/, doBasicStuff") 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-04-13T18:26:25.660

You should use one of these:

```
public QName(String localPart)     or
public QName(final String namespaceURI, final String localPart) 
```

but new QName("[http://testPackage.fc.com/](http://testPackage.fc.com/), doBasicStuff") is wrong, since both values are in the same string ".., .."

Regards

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-12-03T15:11:35.910

new QName("soapenc:string", "doBasicStuff")

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-12-15T00:07:13.200

Just type the name of metod that have to on your case it would be `call.setOperationName("doBasicStuff");`

# encoding - What is base 64 encoding used for?

> ID：201479
> 
> 赞同：914
> 
> 时间：2008-10-14T14:50:52.350
> 
> 标签：encoding, base64, encode

I've heard people talking about "base 64 encoding" here and there. What is it used for?

* * *

## 回答 #1

> 赞同：1103
> 
> 时间：2008-10-14T14:56:19.063

When you have some binary data that you want to ship across a network, you generally don't do it by just streaming the bits and bytes over the wire in a raw format. Why? because some media are made for streaming text. You never know -- some protocols may interpret your binary data as control characters (like a modem), or your binary data could be screwed up because the underlying protocol might think that you've entered a special character combination (like how FTP translates line endings).

So to get around this, people encode the binary data into characters. Base64 is one of these types of encodings.

**Why 64?**
Because you can generally rely on the same 64 characters being present in many character sets, and you can be reasonably confident that your data's going to end up on the other side of the wire uncorrupted.

* * *

## 回答 #2

> 赞同：238
> 
> 时间：2008-10-14T14:53:16.040

It's basically a way of encoding arbitrary binary data in ASCII text. It takes 4 characters per 3 bytes of data, plus potentially a bit of padding at the end.

Essentially each 6 bits of the input is encoded in a 64-character alphabet. The "standard" alphabet uses A-Z, a-z, 0-9 and + and /, with = as a padding character. There are URL-safe variants.

[Wikipedia](http://en.wikipedia.org/wiki/Base64) is a reasonably good source of more information.

* * *

## 回答 #3

> 赞同：144
> 
> 时间：2008-10-14T14:52:20.927

Base-64 encoding is a way of taking binary data and turning it into text so that it's more easily transmitted in things like e-mail and HTML form data.

[http://en.wikipedia.org/wiki/Base64](http://en.wikipedia.org/wiki/Base64)

* * *

## 回答 #4

> 赞同：139
> 
> 时间：2019-05-10T19:53:51.603

Years ago, when mailing functionality was introduced, so that was utterly text based, as the time passed, need for attachments like image and media (audio,video etc) came into existence. When these attachments are sent over internet (which is basically in the form of binary data), the probability of binary data getting corrupt is high in its raw form. So, to tackle this problem BASE64 came along.

The problem with binary data is that it contains null characters which in some languages like C,C++ represent end of character string so sending binary data in raw form containing NULL bytes will stop a file from being fully read and lead in a corrupt data.

For Example :

In C and C++, this "null" character shows the end of a string. So "HELLO" is stored like this:

H E L L O

72 69 76 76 79 00

The 00 says "stop here".

Now let’s dive into how BASE64 encoding works.

Point to be noted : Length of the string should be in multiple of 3.

**Example 1 :**

String to be encoded : “ace”, Length=3

1.  Convert each character to decimal.

a= 97, c= 99, e= 101

[![enter image description here](https://i.stack.imgur.com/6wfbb.png)](https://i.stack.imgur.com/6wfbb.png)

2.  Change each decimal to 8-bit binary representation.

97= 01100001, 99= 01100011, 101= 01100101

Combined : 01100001 01100011 01100101

3.  Separate in a group of 6-bit.

011000 010110 001101 100101

4.  Calculate binary to decimal

011000= 24, 010110= 22, 001101= 13, 100101= 37

5.  Covert decimal characters to base64 using base64 chart.

24= Y, 22= W, 13= N, 37= l

“ace” => “YWNl”</p>

[![enter image description here](https://i.stack.imgur.com/tucMa.png)](https://i.stack.imgur.com/tucMa.png)

**Example 2 :**

String to be encoded : “abcd” Length=4, it's not multiple of 3\. So to make string length multiple of 3 , we must add 2 bit padding to make length= 6\. Padding bit is represented by “=” sign.

Point to be noted : One padding bit equals two zeroes 00 so two padding bit equals four zeroes 0000.

So lets start the process :–</p>

1.  Convert each character to decimal.

a= 97, b= 98, c= 99, d= 100

2.  Change each decimal to 8-bit binary representation.

97= 01100001, 98= 01100010, 99= 01100011, 100= 01100100

3.  Separate in a group of 6-bit.

011000, 010110, 001001, 100011, 011001, 00

so the last 6-bit is not complete so we insert two padding bit which equals four zeroes “0000”.

011000, 010110, 001001, 100011, 011001, 000000 ==

Now, it is equal. Two equals sign at the end show that 4 zeroes were added (helps in decoding).

4.  Calculate binary to decimal.

011000= 24, 010110= 22, 001001= 9, 100011= 35, 011001= 25, 000000=0 ==

5.  Covert decimal characters to base64 using base64 chart.

24= Y, 22= W, 9= j, 35= j, 25= Z, 0= A ==

“abcd” => “YWJjZA==”</p>

* * *

## 回答 #5

> 赞同：131
> 
> 时间：2008-10-14T15:02:57.643

It's a textual encoding of binary data where the resultant text has nothing but letters, numbers and the symbols "+", "/" and "=". It's a convenient way to store/transmit binary data over media that is specifically used for textual data.

But why Base-64? The two alternatives for converting binary data into text that immediately spring to mind are:

1.  Decimal: store the decimal value of each byte as three numbers: 045 112 101 037 etc. where each byte is represented by 3 bytes. The data bloats three-fold.
2.  Hexadecimal: store the bytes as hex pairs: AC 47 0D 1A etc. where each byte is represented by 2 bytes. The data bloats two-fold.

Base-64 maps 3 bytes (8 x 3 = 24 bits) in 4 characters that span 6-bits (6 x 4 = 24 bits). The result looks something like "TWFuIGlzIGRpc3Rpb...". Therefore the bloating is only a mere 4/3 = 1.3333333 times the original.

* * *

## 回答 #6

> 赞同：95
> 
> 时间：2012-08-25T03:53:23.403

Aside from what's already been said, two very common uses that have not been listed are

**Hashes:**

Hashes are one-way functions that transform a block of bytes into another block of bytes of a fixed size such as 128bit or 256bit (SHA/MD5). Converting the resulting bytes into Base64 makes it much easier to display the hash especially when you are comparing a checksum for integrity. Hashes are so often seen in Base64 that many people mistake Base64 itself as a hash.

**Cryptography:**

Since an encryption key does not have to be text but raw bytes it is sometimes necessary to store it in a file or database, which Base64 comes in handy for. Same with the resulting encrypted bytes.

Note that although Base64 is often used in cryptography is not a security mechanism. Anyone can convert the Base64 string back to its original bytes, so it should not be used as a means for protecting data, only as a format to display or store raw bytes more easily.

**Certificates**

x509 certificates in PEM format are base 64 encoded. [http://how2ssl.com/articles/working_with_pem_files/](http://how2ssl.com/articles/working_with_pem_files/)

* * *

## 回答 #7

> 赞同：35
> 
> 时间：2008-10-14T15:09:11.593

In the early days of computers, when telephone line inter-system communication was not particularly reliable, a quick & dirty method of verifying data integrity was used: "bit parity". In this method, every byte transmitted would have 7-bits of data, and the 8th would be 1 or 0, to force the total number of 1 bits in the byte to be even.

Hence 0x01 would be transmited as 0x81; 0x02 would be 0x82; 0x03 would remain 0x03 etc.

To further this system, when the ASCII character set was defined, only 00-7F were assigned characters. (Still today, all characters set in the range 80-FF are non-standard)

Many routers of the day put the parity check and byte translation into hardware, forcing the computers attached to them to deal strictly with 7-bit data. This force email attachments (and all other data, which is why HTTP & SMTP protocols are text-based), to be convert into a text-only format.

Few of the routers survived into the 90s. I severely doubt any of them are in use today.

* * *

## 回答 #8

> 赞同：29
> 
> 时间：2008-10-14T14:54:58.627

From [http://en.wikipedia.org/wiki/Base64](http://en.wikipedia.org/wiki/Base64)

> The term Base64 refers to a specific MIME content transfer encoding. It is also used as a generic term for any similar encoding scheme that encodes binary data by treating it numerically and translating it into a base 64 representation. The particular choice of base is due to the history of character set encoding: one can choose a set of 64 characters that is both part of the subset common to most encodings, and also printable. This combination leaves the data unlikely to be modified in transit through systems, such as email, which were traditionally not 8-bit clean.
> 
> Base64 can be used in a variety of contexts:
> 
> *   Evolution and Thunderbird use Base64 to obfuscate e-mail passwords[1]
> *   Base64 can be used to transmit and store text that might otherwise cause delimiter collision
> *   Base64 is often used as a quick but insecure shortcut to obscure secrets without incurring the overhead of cryptographic key management
>     
>     
> *   Spammers use Base64 to evade basic anti-spamming tools, which often do not decode Base64 and therefore cannot detect keywords in encoded messages.
>     
>     
> *   Base64 is used to encode character strings in LDIF files
> *   Base64 is sometimes used to embed binary data in an XML file, using a syntax similar to ...... e.g. Firefox's bookmarks.html.
> *   Base64 is also used when communicating with government Fiscal Signature printing devices (usually, over serial or parallel ports) to minimize the delay when transferring receipt characters for signing.
> *   Base64 is used to encode binary files such as images within scripts, to avoid depending on external files.
> *   Can be used to embed raw image data into a CSS property such as background-image.

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2008-10-14T14:53:32.517

Some transportation protocols only allow alphanumerical characters to be transmitted. Just imagine a situation where control characters are used to trigger special actions and/or that only supports a limited bit width per character. [Base64](http://en.wikipedia.org/wiki/Base64) transforms any input into an encoding that only uses alphanumeric characters, `+`, `/` and the `=` as a padding character.

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2017-09-21T10:55:02.937

“Base64 encoding schemes are commonly used when there is a need to encode binary data that needs be stored and transferred over media that are designed to deal with textual data. This is to ensure that the data remains intact without modification during transport”(Wiki, 2017)

Example could be the following: you have a web service that accept only ASCII chars. You want to save and then transfer user’s data to some other location (API) but recipient want receive untouched data. Base64 is for that. . . The only downside is that base64 encoding will require around 33% more space than regular strings.

Another Example:: uenc = url encoded = aHR0cDovL2xvYy5tYWdlbnRvLmNvbS9hc2ljcy1tZW4tcy1nZWwta2F5YW5vLXhpaS5odG1s = [http://loc.querytip.com/asics-men-s-gel-kayano-xii.html](http://loc.querytip.com/asics-men-s-gel-kayano-xii.html).

As you can see we can’t put char “/” in URL if we want to send last visited URL as parameter because we would break attribute/value rule for “MOD rewrite” – GET parameter.

A full example would be: “<a href="http://loc.querytip.com/checkout/cart/add/uenc/http://loc.magento.com/asics-men-s-gel-kayano-xii.html/product/93/" rel="noreferrer">http://loc.querytip.com/checkout/cart/add/uenc/http://loc.magento.com/asics-men-s-gel-kayano-xii.html/product/93/”</p>

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2021-07-29T05:06:07.580

**Base64** is a ***binary to a text encoding scheme*** that represents binary data in an ASCII string format. It is designed to carry data stored in binary format across the network channels.

Base64 mechanism uses 64 characters to encode. These characters consist of:

1.  10 numeric value: i.e., 0,1,2,3,...,9
2.  26 Uppercase alphabets: i.e., A,B,C,D,...,Z
3.  26 Lowercase alphabets: i.e., a,b,c,d,...,z
4.  2 special characters (these characters depends on operating system): i.e. +,/

**How base64 works**

The steps to encode a string with base64 algorithm are as follow:

1.  Count the number of characters in a String. If it is not multiple of 3, then pad it with special characters (i.e. =) to make it multiple of 3.
2.  Convert string to ASCII binary format 8-bit [using the ASCII table](https://www.ascii-code.com/).
3.  After converting to binary format, divide binary data into chunks of 6-bits.
4.  Convert chunks of 6-bit binary data to decimal numbers.
5.  Convert decimals to string according to the base64 Index Table. [This table can be an example](https://base64.guru/learn/base64-characters), but as I said, 2 special characters may vary.

Now, we got the encoded version of the input string.

Let's make an example: convert string ***THS*** to base64 encoding string.

1.  Count the number of characters: it is already a multiple of 3.

2.  Convert to ASCII binary format 8-bit. We got (T)**01010100** (H)**01001000** (S)**01010011**

3.  Divide binary data into chunks of 6-bits. We got ***010101 000100 100001 010011***

4.  Convert chunks of 6-bit binary data to decimal numbers.We got ***21 4 33 19***

5.  Convert decimals to string according to the base64 Index Table. We got ***VEhT***

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2008-10-14T14:53:12.033

It's used for converting arbitrary binary data to ASCII text.

For example, e-mail attachments are sent this way.

* * *

## 回答 #13

> 赞同：9
> 
> 时间：2015-06-06T22:45:14.373

The usage of Base64 I'm going to describe here is somewhat a hack. So if you don't like hacks, please do not go on.

I went into trouble when I discovered that MySQL's utf8 does not support 4-byte unicode characters since it uses a 3-byte version of utf8\. So what I did to support full 4-byte unicode over MySQL's utf8? Well, base64 encode strings when storing into the database and base64 decode when retrieving.

Since base64 encoding and decoding is very fast, the above worked perfectly.

You have the following points to take note of:

*   Base64 encoding uses 33% more storage

*   Strings stored in the database wont be human readable (You could sell that as a feature that database strings use a basic form of encryption).

You could use the above method for any storage engine that does not support unicode.

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2008-10-14T16:10:37.540

I use it in a practical sense when we transfer large binary objects (images) via web services. So when I am testing a C# web service using a python script, the binary object can be recreated with a little magic.

[In python]

```
import base64
imageAsBytes = base64.b64decode( dataFromWS ) 
```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2008-10-14T14:52:44.607

Mostly, I've seen it used to encode binary data in contexts that can only handle ascii - or a simple - character sets.

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2008-10-14T14:54:40.657

To expand a bit on what Brad is saying: many transport mechanisms for email and Usenet and other ways of moving data are not "8 bit clean", which means that characters outside the standard ascii character set might be mangled in transit - for instance, 0x0D might be seen as a carriage return, and turned into a carriage return and line feed. Base 64 maps all the binary characters into several standard ascii letters and numbers and punctuation so they won't be mangled this way.

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2013-10-10T06:58:34.253

Base64

Base64 is a generic term for a number of similar encoding schemes that encode binary data by treating it numerically and translating it into a base 64 representation. The Base64 term originates from a specific MIME content transfer encoding.

Base64 encoding schemes are commonly used when there is a need to encode binary data that needs be stored and transferred over media that are designed to deal with textual data. This is to ensure that the data remains intact without modification during transport. Base64 is used commonly in a number of applications including email via MIME, and storing complex data in XML.

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2020-01-10T05:46:48.093

One hexadecimal digit is of one nibble (4 bits). Two nibbles make 8 bits which are also called 1 byte.

MD5 generates a 128-bit output which is represented using a sequence of 32 hexadecimal digits, which in turn are 32*4=128 bits. 128 bits make 16 bytes (since 1 byte is 8 bits).

Each Base64 character encodes 6 bits (except the last non-pad character which can encode 2, 4 or 6 bits; and final pad characters, if any). Therefore, per Base64 encoding, a 128-bit hash requires at least ⌈128/6⌉ = 22 characters, plus pad if any.

Using base64, we can produce the encoded output of our desired length (6, 8, or 10). If we choose to decide 8 char long output, it occupies only 8 bytes whereas it was occupying 16 bytes for 128-bit hash output.

So, in addition to security, base64 encoding is also used to reduce the space consumed.

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2021-12-08T06:06:17.027

The **base64** is a binary to a text encoding scheme that represents binary data in an ASCII string format. base64 is designed to carry data stored in binary format across the channels. It takes any form of data and transforms it into a long string of plain text. Earlier we can not transfer a large amount of data like files because it is made up of 2⁸ bit bytes but our actual network uses **2⁷ bit** bytes. This is where base64 encoding came into the picture. But, what actually does base64 mean?

let’s understand the meaning of base64.

base64 = base+64

we can call base64 as a radix-64 representation.base64 uses only 6-bits(2⁶ = 64 characters) to ensure the printable data is human readable. but, how? we can also write base65 or base78, but why only 64? let’s prove it. base64 encoding contains 64 characters to encode any string. base64 contains:

10 numeric value i.e., 0,1,2,3,…..9.

26 Uppercase alphabets i.e., A,B,C,D,…….Z.

26 Lowercase alphabets i.e., a,b,c,d,……..z.

two special characters i.e., +,/. Depends upon your OS.

The steps followed by the **base64 algorithm** are as follow:

1.  count the number of characters in a String.
2.  If it is not multiple of 3 pad with special character i.e., = to make it multiple of 3.
3.  Encode the string in ASCII format.
4.  Now, it will convert the ASCII to binary format 8-bit each.
5.  After converting to binary format, it will divide binary data into chunks of 6-bits each.
6.  The chunks of 6-bit binary data will now be converted to decimal number format.
7.  Using the base64 Index Table, the decimals will be again converted to a string according to the table format.
8.  Finally, we will get the encoded version of our input string.

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2014-02-23T15:46:00.703

Base64 can be used for many purposes.

The primary reason is to convert binary data to something passable.

I sometimes use it to pass JSON data around from one site to another, store information in cookies about a user.

Note: You "can" use it for encryption - I don't see why people say you can't, and that it's not encryption, although it would be easily breakable and is frowned upon. Encryption means nothing more than converting one string of data to another string of data that can be either later decrypted or not, and that's what base64 does.

# sql-server - SQL过程运行时间大相径庭

> ID：201494
> 
> 赞同：2
> 
> 时间：2008-10-14T14:53:30.847
> 
> 标签：sql-server, sql-server-2000, locking

我有一个应用程序在 SQL Server 2000 上运行一个巨大的存储过程。通常需要大约 1 分钟才能完成，但有时会需要更长的时间。刚才我在我的测试系统中连续运行了 3 次。花了 1:12、1:23 和 55:25。什么会导致这种行为？数据库中还有其他事情发生，所以我想知道它是否与锁有关。我怎样才能在行动中抓住这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T14:55:55.147

创建一个跟踪并在 Profiler 中检查它。这至少应该指出问题所在 - 在您的程序或其他地方。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T15:14:18.900

可能是参数嗅探：根据输入，Sql Server 选择了不同的查询计划。

另一种可能性是一个单独的查询同时运行并锁定了所有内容。

# c# - 我的对象在哪里被处理？

> ID：201501
> 
> 赞同：3
> 
> 时间：2008-10-14T14:54:48.643
> 
> 标签：c#, .net, sharepoint

我有一个奇怪的问题：我在 .aspx 页面中使用 SPContext.Current.Web，但最后，我得到“尝试使用已关闭或处置且不再有效的 SPWeb 对象”。错误信息。

据我所知， SPContext.Current.Web 是由某人处理的，**但我不知道在哪里**。我只是想知道：使用 Visual Studio 2005 的调试器，我能否以某种方式查看对象的位置/谁？由于我既没有创建也没有源代码，因此设置断点是一个问题。

找出谁将给定对象放置在哪里而不只是随机注释行的好方法是什么？

（注意：问题已解决，但问题本身也适用于 Sharepoint 之外）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-14T15:24:36.010

检查这是否有帮助：

1.  使用**Debug > New Breakpoint > Break at Function... (Ctrl+B)**添加新断点。
2.  在函数编辑框中输入**Microsoft.SharePoint.SPWeb.Dispose 。**
3.  关闭提示 Intellisense 找不到指定位置的对话框。
4.  在调试器下运行。
5.  当断点被命中时，您可以在调用堆栈上看到谁调用了 Dispose 方法。希望在某些情况下，断点被击中，一个堆栈帧在您的源代码中。

如果出现一个对话框，说当断点被击中时*，当前位置没有可用的源代码，则将*其关闭。

* * *

**注意：**因为我没有安装 SharePoint，所以我已经对此进行了测试，`System.IO.StreamReader.Dispose`但我猜这也应该适用于 SPContext.Current.Web。记下这点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T14:54:36.947

在您的自定义代码中，请确保您没有获得对 Context 对象的实际 SPWeb 对象的引用并将其处理掉。例如，以下是非常糟糕的。

```
using (SPWeb myWeb = SPContext.Current.Web)
{
   // do something
} 
```

这将导致 SPContext 的对象被释放，并且可能不会在您的代码中导致问题，但可能会在以后导致问题。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-14T17:47:03.710

您应该阅读以下内容：http: [//msdn.microsoft.com/en-us/library/aa973248.aspx](http://msdn.microsoft.com/en-us/library/aa973248.aspx)

快点：您应该使用以下任一方式处理所有 SPWeb 和 SPSite

```
using(SPWeb web = ...)
{
    ....
} 
```

或者

```
SPWeb web = ...
...
web.Dispose() 
```

# visual-studio - 是否可以在调试时以编程方式与 Visual Studio 调试器通信？

> ID：201504
> 
> 赞同：4
> 
> 时间：2008-10-14T14:55:20.327
> 
> 标签：visual-studio, debugging

我想在不使用调试 GUI 的情况下控制调试器上的选项，最好是从被调试的代码内部。我认为这将非常困难，但也许我的调试代码可以从独立代码请求服务，该服务将与调试器通信。

这与[我的另一个](https://stackoverflow.com/questions/201182/debugging-with-exceptions-how-to-work-around-break-when-thrown#201197)关于控制何时中断异常的问题有关。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T15:05:40.697

您可以编写 Visual Studio 宏来执行 GUI 可以执行的任何操作，但它们可能会相当复杂。[请参阅有关Visual Studio](http://msdn.microsoft.com/en-us/library/xc52cke4(VS.80).aspx)的自动化和可扩展性的 MSDN 文档

从正在调试的代码中执行此操作会很棘手，您肯定需要与 VS 进行某种新形式的通信，也许是自定义加载项。我认为独立服务不会从根本上帮助这里。最大的问题是当调试器中断时您的代码将停止运行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T15:02:58.423

我知道你可以使用 WinDBG 和 OutputDebugString 来做到这一点，但对于 Visual Studio，我认为你必须脱机处理另一个进程，将命令传递给该进程，并让它操纵 Debugger API。

# passwords - 开发组最佳密码管理软件 - 寻求建议

> ID：201505
> 
> 赞同：6
> 
> 时间：2008-10-14T14:55:24.243
> 
> 标签：passwords

我们的开发和咨询团队（约 25 人）正在寻找软件来管理我们为我们的组织和客户所拥有的所有密码。我们查看了 Keepass，但它并不是真正的数据库系统，也不支持多个并发更新。

需求： -
使用数据库（相对于共享文本/XML 文件）
- 能够按项目/角色/个人分割密码

需要（但不是必需的）：
- 基于网络
- 移动支持

有人有好的推荐吗？

提前致谢！

-西格

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-28T19:12:49.547

如果您不介意托管解决方案，我发现在线密码管理器[PassPack](https://www.passpack.com/)非常有前途。缺少的一件事是角色或帐户，因此不同的项目需要使用不同的 PassPack 帐户。如果您为客户设置项目，然后将 PassPack 帐户传递给客户，以便一次性将所有与项目相关的密码传递给客户，这将非常有效。

如果您担心安全性：一切都在浏览器端加密，只有加密数据在服务器端传输和存储。最薄弱的环节显然是浏览器端的加密，你可以查看它，因为它都在 JavaScript 中。您还依赖可用的 PassPack 服务，但您也可以导出数据进行备份。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T15:49:53.667

我相信 LDAP & Co. 会让你做这一切。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T14:57:52.710

Joel 的[密码管理条目终于成为可能](http://www.joelonsoftware.com/items/2008/09/11b.html)，这可能是一个不错的起点。

不确定它是否涵盖所有基础。

# python - urllib.urlopen 有效，但 urllib2.urlopen 无效

> ID：201515
> 
> 赞同：11
> 
> 时间：2008-10-14T14:57:41.213
> 
> 标签：python, urllib2, urllib

我有一个正在测试的简单网站。它在本地主机上运行，​​我可以在我的网络浏览器中访问它。索引页就是“运行”这个词。 `urllib.urlopen`将成功读取页面但`urllib2.urlopen`不会。这是一个演示问题的脚本（这是实际脚本，而不是不同测试脚本的简化）：

```
import urllib, urllib2
print urllib.urlopen("http://127.0.0.1").read()  # prints "running"
print urllib2.urlopen("http://127.0.0.1").read() # throws an exception 
```

这是堆栈跟踪：

```
Traceback (most recent call last):
  File "urltest.py", line 5, in <module>
    print urllib2.urlopen("http://127.0.0.1").read()
  File "C:\Python25\lib\urllib2.py", line 121, in urlopen
    return _opener.open(url, data)
  File "C:\Python25\lib\urllib2.py", line 380, in open
    response = meth(req, response)
  File "C:\Python25\lib\urllib2.py", line 491, in http_response
    'http', request, response, code, msg, hdrs)
  File "C:\Python25\lib\urllib2.py", line 412, in error
    result = self._call_chain(*args)
  File "C:\Python25\lib\urllib2.py", line 353, in _call_chain
    result = func(*args)
  File "C:\Python25\lib\urllib2.py", line 575, in http_error_302
    return self.parent.open(new)
  File "C:\Python25\lib\urllib2.py", line 380, in open
    response = meth(req, response)
  File "C:\Python25\lib\urllib2.py", line 491, in http_response
    'http', request, response, code, msg, hdrs)
  File "C:\Python25\lib\urllib2.py", line 418, in error
    return self._call_chain(*args)
  File "C:\Python25\lib\urllib2.py", line 353, in _call_chain
    result = func(*args)
  File "C:\Python25\lib\urllib2.py", line 499, in http_error_default
    raise HTTPError(req.get_full_url(), code, msg, hdrs, fp)
urllib2.HTTPError: HTTP Error 504: Gateway Timeout 
```

有任何想法吗？我可能最终需要一些更高级的功能`urllib2`，所以我不想仅仅求助于 using `urllib`，而且我想了解这个问题。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-14T15:49:47.223

听起来您已经定义了 urllib2 正在使用的代理设置。当它尝试代理“127.0.0.01/”时，代理放弃并返回 504 错误。

从[Obscure python urllib2 代理陷阱](http://kember.net/articles/obscure-python-urllib2-proxy-gotcha)：

```
proxy_support = urllib2.ProxyHandler({})
opener = urllib2.build_opener(proxy_support)
print opener.open("http://127.0.0.1").read()

# Optional - makes this opener default for urlopen etc.
urllib2.install_opener(opener)
print urllib2.urlopen("http://127.0.0.1").read() 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T15:06:05.237

先调用 urllib2.open 然后调用 urllib.open 是否有相同的结果？只是想知道第一次调用 open 是否会导致 http 服务器忙于超时？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T15:53:19.510

我不知道发生了什么，但您可能会发现这有助于弄清楚：

```
>>> import urllib2
>>> urllib2.urlopen('http://mit.edu').read()[:10]
'<!DOCTYPE '
>>> urllib2._opener.handlers[1].set_http_debuglevel(100)
>>> urllib2.urlopen('http://mit.edu').read()[:10]
connect: (mit.edu, 80)
send: 'GET / HTTP/1.1\r\nAccept-Encoding: identity\r\nHost: mit.edu\r\nConnection: close\r\nUser-Agent: Python-urllib/2.5\r\n\r\n'
reply: 'HTTP/1.1 200 OK\r\n'
header: Date: Tue, 14 Oct 2008 15:52:03 GMT
header: Server: MIT Web Server Apache/1.3.26 Mark/1.5 (Unix) mod_ssl/2.8.9 OpenSSL/0.9.7c
header: Last-Modified: Tue, 14 Oct 2008 04:02:15 GMT
header: ETag: "71d3f96-2895-48f419c7"
header: Accept-Ranges: bytes
header: Content-Length: 10389
header: Connection: close
header: Content-Type: text/html
'<!DOCTYPE ' 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-14T15:54:10.460

urllib.urlopen() 向服务器抛出以下请求：

```
GET / HTTP/1.0
Host: 127.0.0.1
User-Agent: Python-urllib/1.17 
```

而 urllib2.urlopen() 抛出这个：

```
GET / HTTP/1.1
Accept-Encoding: identity
Host: 127.0.0.1
Connection: close
User-Agent: Python-urllib/2.5 
```

因此，您的服务器要么不理解 HTTP/1.1，要么不理解额外的标头字段。

# c# - 从自定义服务器控件中的标记中删除 CSS 类属性

> ID：201518
> 
> 赞同：0
> 
> 时间：2008-10-14T14:58:03.067
> 
> 标签：c#, asp.net, custom-server-controls

问候！

我创建了一个自定义按钮类来呈现以下内容：

```
<span class="btnOrange">
    <input type="submit" id="ctl00_MainContent_m_GoBack" value="Back" name="ctl00$MainContent$m_GoBack"/>
</span> 
```

但是，它呈现为这样（注意 INPUT 标记中无关的“类”属性）：

```
<span class="btnOrange">
    <input type="submit" class="btnOrange" id="ctl00_MainContent_m_GoBack" value="Back" name="ctl00$MainContent$m_GoBack"/>
</span> 
```

我的自定义按钮类如下所示：

```
[ToolboxData(@"<{0}:MyButton runat=server></{0}:MyButton>")]
public class MyButton : Button
{
    public override void RenderBeginTag(HtmlTextWriter writer)
    {
       writer.AddAttribute(HtmlTextWriterAttribute.Class, this.CssClass);   
       writer.RenderBeginTag("span");
       base.RenderBeginTag(writer);
    }

    public override void RenderEndTag(HtmlTextWriter writer)
    {
       writer.RenderEndTag();
       base.RenderEndTag(writer);
    }
} 
```

由于我只需要为 SPAN 标签设置类属性，是否可以不包含或“删除” INPUT 标签的类属性？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-15T03:22:28.883

你可以这样做：

```
private string _heldCssClass = null;
public override void RenderBeginTag(HtmlTextWriter writer)
{
   writer.AddAttribute(HtmlTextWriterAttribute.Class, this.CssClass);   
   writer.RenderBeginTag("span");
   _heldCssClass = this.CssClass;
   this.CssClass = String.Empty;
   base.RenderBeginTag(writer);
}

public override void RenderEndTag(HtmlTextWriter writer)
{
   writer.RenderEndTag();
   base.RenderEndTag(writer);
   this.CssClass = _heldCssClass;
} 
```

我在方法调用之间将 CssClass 属性保留在私有变量中的原因是为了防止在渲染过程中出现副作用。这在您的特定代码中可能并不重要（“CssClass 属性在渲染后真的那么重要吗？”）但是通过空白来防止或减少副作用的影响总是一个好主意，例如上面的代码所展示的内容财产。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T15:00:51.020

渲染开始标签后如何`class`从对象中删除属性？虽然我不知道 ASP 所以我可能是错的。`writer``span`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-15T22:53:28.613

而不是调用基本的 RenderBegin/RenderEnd 方法，它们本身将调用 AddAttributesToRender （从而添加类属性），只需像处理 span 一样自己渲染输入标签......

# c# - 如何编写桌面监控软件？

> ID：201520
> 
> 赞同：2
> 
> 时间：2008-10-14T14:59:11.660
> 
> 标签：c#, monitoring, desktop, spying

我必须开发一个工具来监控帮助台代理。我可以弄清楚如何捕获键盘事件和鼠标事件；但是我也需要捕获发出/使用事件的控件。有可能找出来吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-01T11:28:17.127

您需要 windows 挂钩来获取事件。这些确实是本机代码的领域。尝试用 Win32 标记替换 C# 标记再次询问。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-23T08:50:47.047

我使用[Stephen Toub 博客](http://blogs.msdn.com/toub/archive/2006/05/03/589423.aspx)中的代码在系统托盘中添加了我的应用程序的快捷方式。评论也很有用。

# sql-server-2005 - 如何撤消 SQL Server 2005 中的删除操作？

> ID：201524
> 
> 赞同：2
> 
> 时间：2008-10-14T15:00:32.393
> 
> 标签：sql-server-2005, transaction-log

我们的测试数据库突然丢失了行。我们希望他们回来。

有没有办法筛选今天发生在数据库上的所有事情？每个 SQL 语句？我认为这种东西在事务日志中，但不知道如何查看它。

有没有办法撤消删除操作？

顺便说一句：是的，我们确实有备份，但也希望找到删除的原因......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-02-23T18:12:13.230

*[迟到的答案，但希望有用]*

有一种方法可以使用事务日志恢复已删除的行，但前提是您使用 3rd 方工具并且只有您的数据库处于完全恢复模式。

戴尔（前身为 Quest）拥有[Toad for SQL Server](http://www.quest.com/toad-for-sql-server/)，ApexSQL 拥有[ApexSQL Log](http://www.apexsql.com/sql_tools_log.aspx)和[ApexSQL Recover](http://www.apexsql.com/sql_tools_recover.aspx)，它们还可以读取 t-log 并恢复数据。不幸的是，Red Gate 的 Log Rescue 只能读取 SQL Server 2000 上的日志。

还有一种方法可以使用未记录的 dbcc log 命令读取 t-log。[在此处](https://stackoverflow.com/questions/4507509/how-to-view-transaction-logs-in-sql-server-2008)查看更多详细信息。

考虑到您已经有数据库备份，您可以在单独的数据库中恢复这些备份，然后使用市场上存在的许多数据比较工具之一将丢失的数据插入生产数据库。当然这只能在创建备份之前恢复数据删除。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T15:05:54.080

您可以使用[Red Gate](http://www.red-gate.com)的一些工具来做到这一点，但需要花费一些。看看[SQL Log Rescue](http://www.red-gate.com/products/SQL_Log_Rescue/index.htm)。

否则，我会很想进行还原。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T15:06:50.397

您需要第三方工具来执行此操作。该工具必须能够进入事务日志并查看日志条目，以便您了解发生了什么。我没有使用任何这些工具，但我会尝试 Red Gate 的 SQL Log Rescue 作为初学者。试试看：

[http://www.red-gate.com/products/SQL_Log_Rescue/index.htm](http://www.red-gate.com/products/SQL_Log_Rescue/index.htm)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-10-22T00:39:22.723

我会给 ChronicDB 一个免费版本的尝试，而不是为 Red Gate 付费

[http://chronicdb.com/blogs/undelete_from_whoops](http://chronicdb.com/blogs/undelete_from_whoops)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2016-02-20T06:14:40.570

`Rollback`您可以使用SQL Server 中的命令撤消事务。但是，如果事务在事务中执行，您需要知道事务可以回滚`Begin`。

# installation - 在开发人员工作站上安装 Microsoft 软件的正确顺序是什么？

> ID：201525
> 
> 赞同：28
> 
> 时间：2008-10-14T15:00:49.037
> 
> 标签：installation

我已经这样做了一**百万**次了……建立一个开发人员工作站。

是否有在工作站上安装 Microsoft 开发软件的最佳做法或安装清单？应用更新和/或服务包怎么样？是否有执行此操作的特定顺序，希望最大限度地减少任何安装问题。

我们当前的软件库包括：

*   视觉工作室 2003
*   视觉工作室 2008
*   SQL 服务器 2005
*   微软办公软件 2007

我们确实使用了一些其他工具，但是一旦我从 Microsoft获得了一个**好的**构建，我通常会推迟安装它们......一个**好的**构建是否可能是另一个话题！=)

另外，你有没有用[Ghost](http://www.symantec.com/norton/ghost)之类的软件来创建工作站的图像？一些简单的方法来恢复您的工作站。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-10-14T15:14:03.300

如果您想毫无问题地进行 ASP.NET 开发，我将使用以下命令，并且此命令是关键。

*   操作系统
*   用于操作系统的 IIS <- 如果在 VS 之前没有完成，可能会出现问题
*   操作系统更新
*   办公室
*   办公室更新
*   SQL Server 和工具
*   SQL Server 更新
*   对比 2003
*   VS 2003 更新
*   VS 2005（不要安装 SQL Express）
*   VS 2005 更新
*   对比 2008
*   VS 2008 更新
*   对比 2010
*   VS 2010 更新
*   对比 2012
*   VS 2012 更新
*   用于开发环境的任何第三方工具（Telerik、DevExpress 等）

我发现使用这种格式，你不会有任何问题，但如果你改变顺序，我以前也发生过不好的事情。尤其重要的是 IIS 设置部分！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-14T15:08:21.317

我会做：

*   操作系统
*   办公室
*   .Net 框架运行时
*   安全更新
*   SQL 服务器
*   视觉工作室
*   源代码控制客户端
*   防病毒/安全软件（如适用）
*   任何其他工具（Notepad++、ftp 客户端等）
*   安全更新

SQL Server 出现在 Visual Studio 之前，因为我使用的是开发人员版或 MSDN 的完整版。如果您先安装 Visual Studio，它会希望将 Sql Server Express Edition 放在我的系统上，这是我不想要的。

这只是留下了视觉工作室安装的顺序。通常，您要先安装较旧的产品。但是，可能存在并非如此的情况。如果您有 VS2008 Standard 和 VS2003 Professional，您可能需要稍后安装专业版。但我无法玩那个特定的场景。

最后，我通常更喜欢一次应用所有补丁。它可以节省时间。但是，我想在安装开发工具之前确保我的 .Net 运行时是最新的，并且对于 Visual Studio 的多个版本（或任何其他复杂的包），我更愿意确保软件的每个实例都是完整的在安装下一个之前更新。这有助于解决兼容性问题。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-14T15:51:30.277

我绝对是个鬼瘾君子。在以前的工作中，我会花费大约 2-3 小时正确配置用户所需的一切：Windows+补丁、Office+补丁、Acrobat Reader 等。一旦一切准备就绪，我将使用 Ghost 创建整个硬盘驱动器的映像，然后将其存储在某处（如果可能，将其压缩并刻录到 DVD）。

然后，当一位新同事到来时，我让 Ghost 将映像恢复到一个新的硬盘上——这在 20 分钟或更短的时间内就完成了！之后，手工工作减少到：

*   更改电脑名称
*   更改 Windows 和 Office 许可证号（我记得 TechRepublic 有一个工具可以做到这一点，从技术上讲这并不违法）
*   更改 PC 的 IP 地址（如果您不使用 DHCP）
*   准备好！

如果您愿意，所有这些步骤都可以轻松编写脚本。无论如何，这只是10分钟或更短的时间。

在我目前的工作中，我只是一名开发人员，所以我不再负责为新同事准备机器。但是，根据过去的经验，我认为使用 Ghost 是设置新计算机的最快且最具成本效益的方法！

尤其是 Windows 安装和 Windows 更新 - 啊！！我真的很讨厌在这些步骤上浪费这么多时间，如果你只做**一次**是可以容忍的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-14T15:05:59.807

我倾向于按时间顺序。最旧的软件到最新的。

在你的情况下，我会做类似的事情

1.  Office 2007（我一般先安装office）
2.  VS2003
3.  通过微软更新安装VS2003更新
4.  SQL 服务器 2005
5.  通过 Microsoft 更新安装 SQL Server 2005

等等...

设置完成并配置机器后，我会使用[Acronis True Image 制作](http://www.acronis.com/homecomputing/products/trueimage/)完整的基础映像。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-14T15:07:25.450

我不使用 Ghost，因为我设置的工作站都不相同。

至于安装顺序，我会这样做：

*   办公室 2007
*   SQL 服务器 2005
*   对比 2003
*   对比 2008

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-23T14:34:12.287

我的建议是从操作系统及其更新开始，然后根据需要添加 Office，然后安装 Virtual PC 或 VMWare。通过这种方式，您可以将所有开发内容的不同版本（和测试版）分离到不同的 VPC 中。您的真实硬件将保持清洁，并且您能够非常顺利地在环境之间切换。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-07T22:00:17.133

对于 Web 平台，Microsoft 在这里有一个不错的软件包安装程序：http: [//www.microsoft.com/web/channel/products/WebPlatformInstaller.aspx](http://www.microsoft.com/web/channel/products/WebPlatformInstaller.aspx)

我喜欢在对机器进行映像之前使用[sysprep](http://technet.microsoft.com/en-us/library/bb457073.aspx)，这样我就可以使用相同的配置创建多个工作站

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-14T15:07:20.303

无论安装顺序如何，您都应该能够安装每个软件。话虽如此，如果您想“安全”，请从每个软件的最低版本开始，然后逐步安装更新/SP随着你的前进。

# database - 变更日志/审计数据库表的最佳设计？

> ID：201527
> 
> 赞同：125
> 
> 时间：2008-10-14T15:00:56.137
> 
> 标签：database, database-design, audit

我需要创建一个数据库表来存储不同的变更日志/审计（添加、删除、修改等内容时）。我不需要存储特别详细的信息，所以我在想一些事情：

*   id（用于事件）
*   触发它的用户
*   事件名称
*   事件描述
*   事件的时间戳

我在这里错过了什么吗？显然，我可以继续改进设计，尽管我不打算让它变得复杂（为事件类型或类似的东西创建其他表是不可能的，因为这对我的需要来说很复杂）。

* * *

## 回答 #1

> 赞同：85
> 
> 时间：2008-11-19T15:41:02.870

在我正在做的项目中，审计日志也是从非常简约的设计开始的，就像你描述的那样：

```
event ID
event date/time
event type
user ID
description 
```

这个想法是一样的：让事情变得简单。

然而，很快就发现这种简约的设计是不够的。典型的审计归结为这样的问题：

```
Who the heck created/updated/deleted a record 
with ID=X in the table Foo and when? 
```

因此，为了能够快速回答此类问题（使用 SQL），我们最终在审计表中增加了两列

```
object type (or table name)
object ID 
```

那是我们审计日志的设计真正稳定的时候（现在已经有几年了）。

当然，最后的“改进”仅适用于具有代理键的表。但猜猜怎么了？我们所有值得审计的表都有这样的密钥！

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-10-14T20:20:15.320

我们还记录旧值和新值以及它们来自的列以及在审计详细信息表中被审计的表的主键。想想你需要审计表做什么？您不仅想知道谁进行了更改以及何时进行了更改，而且当发生错误更改时，您还需要一种快速恢复数据的方法。

在设计时，您应该编写代码来恢复数据。当您需要恢复时，通常会很匆忙，最好已经做好准备。

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2013-04-11T09:15:20.897

您可能还需要审核其他几项内容，例如表/列名称、从中进行更新的计算机/应用程序等等。

现在，这取决于您真正需要的审计详细程度以及级别。

我们开始构建自己的基于触发器的审计解决方案，我们希望审计所有内容，并且手头还有一个恢复选项。事实证明这太复杂了，因此我们最终对基于触发器的第三方工具[ApexSQL Audit](http://www.apexsql.com/sql_tools_audit.aspx)进行了逆向工程，以创建我们自己的自定义解决方案。

尖端：

*   包括之前/之后的值

*   包括 3-4 列用于存储主键（如果它是复合键）

*   按照 Robert 的建议，将数据存储在主数据库之外

*   花大量时间准备报告——尤其是那些你可能需要恢复的报告

*   计划存储主机/应用程序名称——这对于跟踪可疑活动可能非常有用

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2013-01-12T00:43:46.610

这里和类似的问题中有很多有趣的答案。我可以从个人经验中添加的唯一内容是：

1.  将您的审计表放在另一个数据库中。理想情况下，您希望与原始数据分离。如果您需要恢复您的数据库，您并不想恢复审计跟踪。

2.  尽可能合理地去规范化。您希望表对原始数据具有尽可能少的依赖关系。审计表应该简单且快速地从中检索数据。无需跨其他表进行花哨的连接或查找来获取数据。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2017-02-19T20:25:45.113

一般来说，自定义审计（创建各种表）是一个不好的选择。可以禁用数据库/表触发器以跳过一些日志活动。自定义审计表可以被篡改。可能会发生导致应用程序中断的异常情况。更不用说设计一个健壮的解决方案的困难了。到目前为止，我在这个讨论中看到了一个非常简单的案例。您需要与当前数据库和任何特权用户（DBA、开发人员）完全分离。每个主流的 RDBMS 都提供审计设施，即使是 DBA 也无法禁用、秘密篡改。因此，RDBMS 供应商提供的审计能力必须是第一选择。其他选项是 3rd 方事务日志阅读器或自定义日志阅读器，它们将分解的信息推送到消息系统中，最终以某种形式的审计数据仓库或实时事件处理程序结束。总之：解决方案架构师/“Hands on Data Architect”需要参与根据需求确定这样的系统。通常只是交给开发人员解决问题太严重了。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-14T15:06:48.073

有很多方法可以做到这一点。我最喜欢的方式是：

1.  将一个`mod_user`字段添加到您的源表（您要记录的那个）。

2.  创建一个日志表，其中包含要记录的字段以及一个`log_datetime`和`seq_num`字段。 `seq_num`是主键。

3.  在源表上构建一个触发器，只要任何受监控的字段发生更改，就将当前记录插入到日志表中。

现在，您已经记录了每一次更改以及是谁做出的。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-17T09:25:45.017

我们的桌子上有什么：-

```
Primary Key
Event type (e.g. "UPDATED", "APPROVED")
Description ("Frisbar was added to blong")
User Id
User Id of second authoriser
Amount
Date/time
Generic Id
Table Name 
```

通用 id 指向表中已更新的一行，表名是该表的字符串名称。不是一个好的数据库设计，但非常有用。我们所有的表都有一个代理键列，所以这很好用。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2016-06-16T09:47:12.720

根据分离原理：

1.  审计数据表需要与主数据库分开。因为审计数据库可能有大量历史数据，所以从内存利用率的角度来看，将它们分开是有意义的。

2.  不要使用触发器来审计整个数据库，因为你最终会得到一堆不同的数据库来支持。您必须为 DB2、SQLServer、Mysql 等编写一个。

# c# - 有什么方法可以让“查找参考”适用于网络方法？

> ID：201529
> 
> 赞同：1
> 
> 时间：2008-10-14T15:01:52.467
> 
> 标签：c#, web-services, asmx

我正在寻找一种方法来在可能使用它的其他代码中查找对 Web 方法的引用。右键单击并选择查找引用不会通过 wsdl 接口到达我的解决方案中引用这些 Web 方法的其他类。这是清理工作的一部分 - 我正在尝试删除过时/旧/未使用的方法。

我可以按名称搜索，但它与按签名搜索不同。

我意识到通常情况下，其他应用程序可以远程调用 webmethods/webservices，但这个 webservice/这些 webmethods 并非如此。我的应用程序是唯一调用它们的应用程序。我不是要查找存在于我的解决方案之外的参考资料。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T15:14:48.167

不，没有办法从 Web 服务实现中执行此操作，但您可以转到生成的代理（您可能必须从解决方案资源管理器中“显示所有文件”才能查看 .cs 文件）并查找引用从那里。

# javascript - 我应该如何使用 jQuery 将多个相同的元素添加到 div

> ID：201530
> 
> 赞同：12
> 
> 时间：2008-10-14T15:02:10.250
> 
> 标签：javascript, jquery, dom

我需要使用 jQuery 将多个空 div 添加到容器元素。

目前我正在使用循环生成一个包含空 html 的字符串

```
divstr = '<div></div><div></div>...<div></div>'; 
```

然后将其注入我的容器中：

```
$('#container').html(divstr); 
```

有没有更优雅的方式来插入多个相同的元素？

我希望找到一些不会破坏链接但不会让浏览器崩溃的东西。一个可链接的`.repeat()`插件？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-14T15:30:54.267

如果您希望 IE 更快 - 或者通常考虑速度，那么您需要先构建一个 DOM 片段，然后再插入它。

John Resig 解释了这项技术并包括了一个性能基准：

[http://ejohn.org/blog/dom-documentfragments/](http://ejohn.org/blog/dom-documentfragments/)

```
var i = 10, 
    fragment = document.createDocumentFragment(), 
    div = document.createElement('div');

while (i--) {
    fragment.appendChild(div.cloneNode(true));
}

$('#container').append(fragment); 
```

我意识到在构建片段时并没有大量使用 jQuery，但我已经运行了一些测试，但我似乎无法执行 $(fragment).append() - 但我已经阅读了 John 的 jQuery 1.3发布应该包括基于上面链接的研究的更改。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-14T17:00:11.900

最快的方法是先用字符串构建内容。在使用 DOM 或 jquery 之前使用字符串来构建文档片段要快得多。不幸的是，IE 在连接字符串方面做得很差，所以最好的方法是使用数组。

```
var cont = []; //Initialize an array to build the content
for (var i = 0;i<10;i++) cont.push('<div>bunch of text</div>');
$('#container').html(cont.join('')); 
```

我在我的代码中大量使用了这种技术。您可以使用此方法构建非常大的 html 片段，并且在所有浏览器中都非常有效。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-12T00:39:20.030

您可以将原生 JavaScript 数组包装在 jQuery 中，并使用 map() 将其转换为 jQuery（DOM 节点列表）。这是官方支持的。

```
$(['plop', 'onk', 'gloubi'])
.map(function(i, text)
{
    return $('<div/>').text(text).get(0);
})
.appendTo('#container'); 
```

这将创建

```
<div id="container">
<div>plop</div>
<div>onk</div>
<div>gloubi</div>
</div> 
```

我经常使用这种技术以避免重复自己（DRY）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-14T15:07:03.893

您可以使用带有 Jquery[附加](http://docs.jquery.com/Manipulation/append#content)功能的常规循环。

```
for(i=0;i<10; i++){
    $('#container').append("<div></div>");
} 
```

# asp.net - 如何将 ASP.NET 开发 Web 服务器设置为不缓存任何内容？

> ID：201532
> 
> 赞同：1
> 
> 时间：2008-10-14T15:02:36.210
> 
> 标签：asp.net, visual-studio, caching

我使用 ASP.NET 开发 Web 服务器（也称为 Visual Studio 开发 Web 服务器）来做本地网站的调试和测试。

我几乎找到了带有开发 Web 服务器的 IIS 的确切功能。但是 - 你可以在哪里管理开发 Web 服务器的设置 - 特别是关于从不缓存任何内容 - 曾经？

这当然在我不想清除缓存的开发场景中很有用......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T15:15:28.290

您不必担心进行缓存的服务器。这是你的浏览器。考虑到这一点，shift键是你的朋友。只需按住 shift 键同时单击页面刷新，您的浏览器就会清除该页面的所有缓存内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T15:17:27.617

将您的浏览器设置设置为每次都下载内容。这取决于您使用的浏览器的不同位置。即使使用此设置，Ctrl-F5 也会强制刷新。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-11-25T03:17:48.480

将 Webservice 方法的缓存时长设置为 0。

```
[WebMethod(CacheDuration=0)]
public string mymethod(string s)
{

} 
```

注意：如果只更改方法的内容并使用 Ajax 调用它，则需要**“重建”**而不是“运行”项目。

# .net - 单击 ImageButton 时动态表数据消失

> ID：201534
> 
> 赞同：1
> 
> 时间：2008-10-14T15:02:41.887
> 
> 标签：.net, dynamic-tables

我有一个表单，它搜索在日期范围之间发生的单个表（TServices）中的所有行，然后在表单下方填充一个动态表。

现在我在表中的每个列表旁边添加一个删除 ImageButton。这是我的 C# 代码隐藏，用于将 ImageButtons 添加到表格单元格：

```
 ImageButton btnRemoveService = new ImageButton();
        btnRemoveService.EnableViewState = true;
        btnRemoveService.ImageUrl = "/images/icons/trash.gif";
        btnRemoveService.Click += new ImageClickEventHandler(btnRemoveService_Click);
        btnRemoveService.ID = "btnRemoveService-" + row["BillingID"].ToString();
        btnRemoveService.CommandArgument = row["BillingID"].ToString();
        tblCell.Controls.Add(btnRemoveService); 
```

即使我没有在 btnRemoveService_Click() 中添加任何内容，动态表中的所有数据也会消失。当我输入代码以实际删除存储过程时，数据从动态表中消失，数据库中没有任何变化。

**编辑：** 我将填充代码移动到它自己的函数中，并在 btnRemoveService_Click() 的末尾调用它。这不应该重新加载数据吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T15:08:41.207

您的错误是由于您必须在每次加载时向页面添加动态创建的控件。如果您在 page_init 方法中重新添加它们，它们将存在以便加载视图状态和成功触发点击事件。这都与 ASP.NET 页面加载过程有关

# ado.net - 您可以将 ADO.NET SQLCommandBuilder 与复合键一起使用吗？

> ID：201546
> 
> 赞同：6
> 
> 时间：2008-10-14T15:04:49.187
> 
> 标签：ado.net, sqlclient, sqlcommandbuilder

我有一个包含 6 列的数据库表。主键是由 6 列中的 5 列组成的复合键

我正在尝试使用`SqlClient.SqlCommandBuilder.GetDeleteCommand`删除该行。

但是我收到以下错误：

> “System.InvalidOperationException：对于不返回任何键列信息的 SelectCommand，不支持为 DeleteCommand 生成动态 SQL。”

包含表中的`SelectCommmand`所有列：

```
SELECT  TABLENAME.COL1, TABLENAME.COL2, TABLENAME.COL3, 
        TABLENAME.COL4, TABLENAME.COL5, TABLENAME.COL6
FROM TABLENAME 
```

问题可能出在复合键上吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T15:15:24.670

我不认为你的问题是复合键。根据文档，主键不必是单列。但是，自动生成语句还需要其他限制。尝试通读[此文档](http://msdn.microsoft.com/en-us/library/tf579hcz(VS.80).aspx)以确认您没有遗漏任何内容。

# .net - .NET 继承与通用接口

> ID：201553
> 
> 赞同：2
> 
> 时间：2008-10-14T15:05:45.987
> 
> 标签：.net, vb.net, generics, inheritance, interface

你好，我目前正在玩城堡项目 ActiveRecord 和远程处理设施。

我目前的问题是我需要找到一种方法来在我的地址类中从 IBaseRepository 实现保存子，但我不知道如何。

这是我当前的代码，VS 在“实现 IAddress”行告诉我我必须为 [Shared].IBaseRepository(Of [Shared].IAddress) 实现 Sub Save(obj As IAddress)

并在线 Public Overrides Sub Save(ByVal obj As Address) Implements IBaseRepository(Of IAddress).Save

我无法实现保存，因为 [Shared].IBaseRepository(Of [Shared].IAddress) 中没有 Sub Save

我只是不明白:(请赐教。

蒂亚

```
Public Interface IBaseRepository(Of T As Class)  
     Sub Save(ByVal obj As T)  
End Interface

Public Interface IAddress  
    Inherits IBaseRepository(Of IAddress)  
    Property Guid() As Guid  
    Property CompanyName() As String  
    Property Surename() As String  
    Property Christianname() As String  
End Interface`

Public Class BaseRepository(Of T As Class)  
Inherits MarshalByRefObject   
Implements IBaseRepository(Of T)

    Protected mediator As ActiveRecordMediator(Of T)  

    Public Overridable Sub Save(ByVal obj As T) Implements IBaseRepository(Of T).Save  
        ActiveRecordMediator(Of T).Save(obj)  
    End Sub  
End Class

<ActiveRecord("Address")> _    
Public Class Address  
    Inherits BaseRepository(Of Address)  
    Implements IAddress

    Public Overrides Sub Save(ByVal obj As Address) Implements IBaseRepository(Of IAddress).Save
        MyBase.Save(obj)
    End Sub
End Class 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T15:23:52.033

```
 Public Class Address
    Inherits BaseRepository(Of Address)
    Implements IAddress

    Public Overrides Sub Save(ByVal obj As Address)
        MyBase.Save(obj)
    End Sub

    Public Overloads Sub Save(ByVal obj As IAddress) _
         Implements IBaseRepository(Of IAddress).Save
    End Sub
 '
 ' Some other stuff...
 '
 End Class 
```

# arrays - 找到数组的最大递增子集（非连续）

> ID：201563
> 
> 赞同：2
> 
> 时间：2008-10-14T15:07:01.223
> 
> 标签：arrays, algorithm

如何找到数组的最大增加（非连续）子集？例如，如果 A= array(50,1,4,9,2,18,6,3,7,10) 最大递增非连续子集是 (1,4,6,7,10) 或 ( 1,2,6,7,10)。我可以直观地看到如何找到子集，但我不知道如何设计算法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T15:09:27.943

维基百科有一个高效算法的伪代码：

[http://en.wikipedia.org/wiki/Longest_increasing_subsequence_problem](http://en.wikipedia.org/wiki/Longest_increasing_subsequence_problem)

# sql - 我什么时候会使用 XML 而不是 SQL？

> ID：201568
> 
> 赞同：106
> 
> 时间：2008-10-14T15:07:28.820
> 
> 标签：sql, xml

几年来，我一直在研究数据库驱动的 Web 应用程序，最近接手了一个涉及支持 XML 的 CMS 的项目。这让我开始思考 XML/XSLT 的一般用法，以及在什么情况下它比我一直使用的方法更有用，将我的所有数据存储在（My）SQL 数据库中，然后使用PHP/Python/等。根据需要在网络上使用它。

很明显，我在这里没有“得到”一些东西......谁能给我一些应用程序的例子，在这些应用程序中，将数据存储在 XML 文件而不是数据库中会更好吗？

* * *

## 回答 #1

> 赞同：104
> 
> 时间：2008-10-14T15:14:07.327

引用[本书](http://www.amazon.com/exec/obidos/tg/detail/-/0321150406/102-0503816-7711357)（有效的 XML：改进 XML 的 50 种特定方法）：

> “XML 不是数据库。它从来都不是数据库。它永远不会成为数据库。关系数据库是经过验证的技术，具有 20 多年的实施经验。它们是坚固、稳定、有用的产品。他们不会消失。XML 是一种非常有用的技术，用于在不同数据库之间或数据库与其他程序之间移动数据。但是，它本身并不是数据库。不要像一个人一样使用它。“</p>

我认为这总结了它，如果有点直截了当的话。XML 是一种数据交换格式。可以拥有可以使用 XPath 表达式查询 DOM 的 XML 解析库，但这与 DBMS 不同。您可以使用 DOM/XPath 接口构建 DBMS，但要获得 ACID 属性或扩展到大型数据集，您需要实现 DBMS 引擎和具有索引、日志记录和其他 DBMS 工件的数据格式 - 这（根据定义）使得它不是 XML 的东西。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-10-14T15:10:33.947

使用 XML 创建需要发送到其他应用程序的文件。XML 更适合作为数据交换格式而不是数据存储格式。

使用 XML 时，下面的链接描述也不错：[为什么要使用 XML？](http://xml.silmaril.ie/whyxml.html)

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-10-14T15:14:36.810

SQL 是很好的表格数据——很容易放入行和列的数据。XML 适用于分层数据——具有多个不同大小级别的数据。

SQL 适合存储和搜索。XML 有利于传输和格式化。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-10-14T15:13:51.320

1) 当您必须与他人交换您的数据时。XML 是 Web 的“[通用语言](http://en.wikipedia.org/wiki/Lingua_franca)”——几乎每个人都可以阅读和解释它，这与数据库文件不同。

2）当您的数据量很小并且您不必对其进行复杂查询时。XML 文件适用于存储配置或文档模板等内容。

3）当你没有很多作家试图访问相同的数据时。SQL 数据库涉及在幕后为您工作的并发机制。SQL 数据库可以支持索引，用于快速检索大型数据集上的信息...

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-14T20:48:38.197

我使用 XML 做的事情：

*   保持对象层次结构。
*   将数据从一个进程或机器移动到另一个。
*   很少更改（如果有的话）的数据；配置设置等。
*   作为 XSLT 转换的输入：一般来说，如果我的一个程序发出 HTML，它会使用 XSLT 来完成它，因此源数据将在某些时候表示为 XML
*   文本标记。（我们不要忘记这一点！）

这些用例和数据库用例之间没有太多重叠。一些，但不多。

具有讽刺意味的是，目前我最常使用 XML 的地方是一个桌面应用程序，它构建了一个内存中的 ADO DataSet 并使用 DataSet 的 WriteXml 和 ReadXml 方法来持久化和检索它。我使用 ADO 是因为使用 ADO 动态构建由元信息定义的数据模型比为任务实现我自己的对象模型要容易得多。

所以这里有一个*看起来*像我使用 XML 作为数据库的案例。但我真的不是。我使用的对象模型恰好实现了许多类似数据库的功能，并且我使用 XML 作为其持久性格式。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-12-30T11:40:47.050

不。

尝试[从书中选择作者](http://www.joelonsoftware.com/articles/fog0000000319.html "乔尔谈软件：回归基础")

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2012-04-04T03:15:18.713

我相信有相当多的商业应用程序大量使用 XML 作为存储介质。我已经为项目规划应用程序完成了它，用户将每个项目存储在它自己的文件中。该应用程序存在于 USB 记忆棒上，并且需要零安装。所有数据都从 XML 中提取并在内存中处理，因此 getRecord(id) 非常快。

所以我的答案是..当数据小到可以保存在内存中时，数据库就会被杀死。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-14T15:12:52.350

每当您没有奢侈的数据库（想想单用户应用程序）或需要非常轻量级的存储格式时。

也正如之前的海报所提到的，一种交换格式。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-14T15:15:14.420

XML 和 RDMS 都可以用作数据存储，但每种实现都有自己的优点和缺点。

使用 XML 存储 Web 应用程序的数据通常不是什么大问题，除非您开始处理大量数据，或者您决定要从数据中发现其他信息（例如：数据挖掘）。换句话说，为数据源存储大量 XML 文件的可扩展性不是很高，但它可以更轻松地移动数据。XML 也可用于以非关系格式序列化复杂对象，如果您可以直接从 XML 序列化/反序列化对象，则可以消除对 ORM 的需要

RDMS（数据库）通常更具可扩展性，提供更大的并发支持，并且在处理大量数据时速度更快。关系模型使以后的数据挖掘更容易。数据库确实受到对象关系阻抗不匹配（[http://en.wikipedia.org/wiki/Object-Relational_impedance_mismatch](http://en.wikipedia.org/wiki/Object-Relational_impedance_mismatch)）的影响，这可能需要您编写丑陋的代码或使用复杂的 ORM。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-14T15:22:44.110

如果我的主机上的 mysql 数据库有限，我会去，然后我会看到使用 XML 作为数据存储的机会。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-14T16:44:12.760

下面是一个将 XML 与 SQL 结合使用的示例：经过身份验证的用户在不同的数据库中读取和写入数据，但并非所有数据库都是同一个 DBMS。公司 A 的用户使用本地 SQL Server 数据库中的数据。公司 B 的用户使用来自远程 Oracle 数据库的数据。等等。十几个不同的数据库，每个数据库对于相同的基本数据都有略微不同的架构。

网站开发人员无法在远程数据库上创建存储过程。SQL 必须直接从 Web 应用程序发送到数据库。由于每个数据库的 SQL 语法和架构略有不同，因此需要对 12 个数据库中的每一个使用不同的 SQL 来执行相同的操作（SELECT、INSERT 等）。

在 Web 应用程序中嵌入 SQL 语句的选择之一是将它们放在 XML 文件中。每个 XML 文件都包含一组用于十几个数据库之一的 SQL 语句。该代码确定登录用户访问哪个数据库，并从指定的 XML 文件中检索适当的 SQL。

与存储过程一样，无需停止或重新编译应用程序即可更新 XML 文件中的 SQL。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-14T15:15:20.710

一些应用程序使用 XML 文件来存储配置，我更喜欢使用[SQLite](http://www.sqlite.org/)来这样做。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-10-14T15:22:59.150

我*永远不会*使用任何类型的 XML 来存储我的数据。

我们在 SOA 应用程序中使用 XSLT 转换作为数据抽象层。所有对象都在 XSLT 中相互发送数据，因此它们只需要理解一种语言。除了数据库连接器，它需要能够将数据转换为 SQL 以将其发送到数据库。

这样，您的应用程序中的无数对象就不会分布 SQL 字符串生成。使维护变得更加容易。

# jboss - JBoss 应用服务器管理控制台？

> ID：201589
> 
> 赞同：2
> 
> 时间：2008-10-14T15:13:01.167
> 
> 标签：jboss, jboss-tools

我知道 JBoss 应用服务器有 JMX-Console 作为管理的 GUI。我的问题是，是否有使用命令行的类似管理工具？这个工具是不是应用服务器自带的，能上报服务器控制下的各种服务的状态吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-17T08:37:42.147

您可能想看看 twiddle.sh 'A JMX client to 'twiddle' with a remote JBoss server.'

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-17T08:46:37.573

Jboss 刚刚开了一个新项目：[http](http://www.jboss.org/jopr/) ://www.jboss.org/jopr/ 。这不是命令行，而是带有仪表板的 Web 应用程序。

我想这就是你要找的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-09-26T15:31:13.333

在 JBoss Application Server 7 中有[命令行界面](http://community.jboss.org/wiki/CommandLineInterface)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-04T07:04:36.277

您可能需要考虑使用 Groovy 之类的脚本来代替命令行工具。例如，这个快速教程将帮助您开始在 JBoss 服务器中测试 JMX MBean 属性，它的性能与（或优于）单独的 twiddle 调用一样好（或更好）并且非常灵活。

```
import javax.management.*;
import javax.naming.*;
Properties p = new Properties();
p.put(Context.PROVIDER_URL, url);
p.put(Context.INITIAL_CONTEXT_FACTORY, "org.jnp.interfaces.NamingContextFactory");
p.put("jnp.disableDiscovery", "true");
ctx = new InitialContext(p);
contexts.put(url, ctx);
mbeanServer = ctx.lookup("/jmx/rmi/RMIAdaptor");
// Lookups here 
```

在我看来，更突出的问题是驱动你最终使用什么工具的是你将如何处理你收集的数据。

//尼古拉斯

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-06-29T21:37:46.200

如果您使用的是 JBoss Application Server 6，您可以在安装的*bin*文件夹中找到一个名为 Twiddle 的命令行工具。您可以在 JBoss wiki 中找到更多信息：http: [//community.jboss.org/wiki/Twiddle](http://community.jboss.org/wiki/Twiddle)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-05-13T17:01:43.940

Jboss 7 有一个名为[CLI（命令行界面）的新命令行实用程序](http://togotutor.com/blog/jboss/jboss-application-server-command-line-utility/)

# .net - 识别 .NET 应用程序中的 COM 组件

> ID：201590
> 
> 赞同：1
> 
> 时间：2008-10-14T15:13:12.303
> 
> 标签：.net, windows

我继承了一个 .NET 应用程序，该应用程序汇集了大约 100 个由两个团队构建或从供应商处购买的 dll。我想快速确定给定的 dll 是 .NET 程序集还是 COM 组件。我意识到我可以单独在每个 dll 上调用 ildasm 并在 dll 没有有效的 CLR 标头时做一个记录，但是这种方法看起来很笨拙且难以自动化。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-14T15:15:24.030

您始终可以尝试将“程序集版本”列添加到资源管理器窗口，并注意哪些是空白的以查找非 .NET 程序集。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-14T20:18:48.413

如果您想从 COM 端接近，在 DLL 中测试 COM 对象归结为寻找名为“DllGetClassObject”的导出。这是因为 COM 运行时通过在该 DLL 上调用[DllGetClassObject()来访问进程内 COM 对象。](http://msdn.microsoft.com/en-us/library/ms680760(VS.85).aspx)

您可以使用Visual Studio 附带的[DUMPBIN.EXE](http://msdn.microsoft.com/en-us/library/c1h23y6c(VS.71).aspx)从批处理文件中执行此操作，如下所示：

```
dumpbin unknown.dll /exports | find "DllGetClassObject" 
```

如果上面的命令行是包含 COM 对象的非托管 DLL，则将生成一行文本，否则将生成零字节的输出。

您可以通过加载每个 DLL 并尝试在该入口点上执行 GetProcAddress() 以编程方式执行此操作。这是一个使用此技术的经过测试且可运行的 C# 命令行程序：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Runtime.InteropServices;

static class NativeStuff
{
    [DllImport("kernel32.dll")]
    public static extern IntPtr LoadLibrary(string dllToLoad);

    [DllImport("kernel32.dll")]
    public static extern IntPtr GetProcAddress(IntPtr hModule, string procedureName);

    [DllImport("kernel32.dll")]
    public static extern bool FreeLibrary(IntPtr hModule);
}

namespace IsComDLL
{
    class Program
    {
        static void Main(string[] args)
        {
            if ( (args.Length == 0 ) || String.IsNullOrEmpty( args[0] ) )
            {
                Console.WriteLine( "Give DLL name on command line" );
                Environment.Exit(255);
            }

            IntPtr pDll = NativeStuff.LoadLibrary(args[0]);
            if ( pDll == IntPtr.Zero )
            {
                Console.WriteLine( "DLL file {0} not found", args[0] );
                Environment.Exit(256);
            }

            IntPtr pFunction = NativeStuff.GetProcAddress(pDll, "DllGetClassObject");
            int exitValue = 0;
            if (pFunction == IntPtr.Zero)
            {
                Console.WriteLine("DLL file {0} does NOT contain COM objects", args[0]);
            }
            else
            {
                Console.WriteLine("DLL file {0} does contain COM objects", args[0]);
                exitValue = 1;
            }

            NativeStuff.FreeLibrary(pDll);

            Environment.Exit(exitValue);
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T16:02:05.170

```
System.Reflection.Assembly.ReflectionOnlyLoadFrom("mydll.dll") 
```

将返回对 .NET dll 的有效程序集引用，但会为 COM dll 引发错误。

# c++ - 有没有一种简单的方法可以将 C++ 枚举转换为字符串？

> ID：201593
> 
> 赞同：130
> 
> 时间：2008-10-14T15:14:04.813
> 
> 标签：c++, string, enums, scripting

假设我们有一些命名的枚举：

```
enum MyEnum {
      FOO,
      BAR = 0x50
}; 
```

我搜索的是一个脚本（任何语言），它扫描我项目中的所有标题并生成一个标题，每个枚举都有一个函数。

```
char* enum_to_string(MyEnum t); 
```

和这样的实现：

```
char* enum_to_string(MyEnum t){
      switch(t){
         case FOO:
            return "FOO";
         case BAR:
            return "BAR";
         default:
            return "INVALID ENUM";
      }
 } 
```

问题在于类型定义的枚举和未命名的 C 风格枚举。有人知道吗？

编辑：解决方案不应该修改我的源代码，除了生成的函数。枚举在 API 中，因此使用迄今为止提出的解决方案不是一种选择。

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2008-10-14T16:00:21.290

X-宏是最好的解决方案。例子：

```
#include <iostream>

enum Colours {
#   define X(a) a,
#   include "colours.def"
#   undef X
    ColoursCount
};

char const* const colours_str[] = {
#   define X(a) #a,
#   include "colours.def"
#   undef X
    0
};

std::ostream& operator<<(std::ostream& os, enum Colours c)
{
    if (c >= ColoursCount || c < 0) return os << "???";
    return os << colours_str[c];
}

int main()
{
    std::cout << Red << Blue << Green << Cyan << Yellow << Magenta << std::endl;
} 
```

颜色.def：

```
X(Red)
X(Green)
X(Blue)
X(Cyan)
X(Yellow)
X(Magenta) 
```

但是，我通常更喜欢以下方法，以便可以稍微调整字符串。

```
#define X(a, b) a,
#define X(a, b) b,

X(Red, "red")
X(Green, "green")
// etc. 
```

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2008-10-14T16:03:32.313

您可能想查看[GCCXML](http://www.gccxml.org/HTML/Index.html)。

在您的示例代码上运行 GCCXML 会产生：

```
<GCC_XML>
  <Namespace id="_1" name="::" members="_3 " mangled="_Z2::"/>
  <Namespace id="_2" name="std" context="_1" members="" mangled="_Z3std"/>
  <Enumeration id="_3" name="MyEnum" context="_1" location="f0:1" file="f0" line="1">
    <EnumValue name="FOO" init="0"/>
    <EnumValue name="BAR" init="80"/>
  </Enumeration>
  <File id="f0" name="my_enum.h"/>
</GCC_XML> 
```

您可以使用任何您喜欢的语言来提取 Enumeration 和 EnumValue 标签并生成您想要的代码。

* * *

## 回答 #3

> 赞同：46
> 
> 时间：2008-10-26T15:47:02.753

@hydroo：没有额外的文件：

```
#define SOME_ENUM(DO) \
    DO(Foo) \
    DO(Bar) \
    DO(Baz)

#define MAKE_ENUM(VAR) VAR,
enum MetaSyntacticVariable{
    SOME_ENUM(MAKE_ENUM)
};

#define MAKE_STRINGS(VAR) #VAR,
const char* const MetaSyntacticVariableNames[] = {
    SOME_ENUM(MAKE_STRINGS)
}; 
```

* * *

## 回答 #4

> 赞同：36
> 
> 时间：2008-10-14T15:32:39.130

我倾向于创建一个 C 数组，其名称的顺序和位置与枚举值相同。

例如。

```
enum colours { red, green, blue };
const char *colour_names[] = { "red", "green", "blue" }; 
```

然后您可以在需要人类可读值的地方使用数组，例如

```
colours mycolour = red;
cout << "the colour is" << colour_names[mycolour]; 
```

在某些情况下，您可以使用字符串化运算符（请参阅预处理器参考中的 # ）进行一些试验，它会执行您想要的操作 - 例如：

```
#define printword(XX) cout << #XX;
printword(red); 
```

将“红色”打印到标准输出。不幸的是，它不适用于变量（因为您将打印出变量名称）

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2014-05-01T06:04:36.020

我有一个非常简单易用的宏，它以完全干燥的方式执行此操作。它涉及可变参数宏和一些简单的解析魔法。开始：

```
#define AWESOME_MAKE_ENUM(name, ...) enum class name { __VA_ARGS__, __COUNT}; \
inline std::ostream& operator<<(std::ostream& os, name value) { \
std::string enumName = #name; \
std::string str = #__VA_ARGS__; \
int len = str.length(); \
std::vector<std::string> strings; \
std::ostringstream temp; \
for(int i = 0; i < len; i ++) { \
if(isspace(str[i])) continue; \
        else if(str[i] == ',') { \
        strings.push_back(temp.str()); \
        temp.str(std::string());\
        } \
        else temp<< str[i]; \
} \
strings.push_back(temp.str()); \
os << enumName << "::" << strings[static_cast<int>(value)]; \
return os;} 
```

要在您的代码中使用它，只需执行以下操作：

```
AWESOME_MAKE_ENUM(Animal,
    DOG,
    CAT,
    HORSE
); 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-10-14T18:01:08.190

QT 能够提取（感谢元对象编译器）：

```
QNetworkReply::NetworkError error;

error = fetchStuff();

if (error != QNetworkReply::NoError) {

    QString errorValue;

    QMetaObject meta = QNetworkReply::staticMetaObject;

    for (int i=0; i < meta.enumeratorCount(); ++i) {

        QMetaEnum m = meta.enumerator(i);

        if (m.name() == QLatin1String("NetworkError")) {

            errorValue = QLatin1String(m.valueToKey(error));

            break;

        }

    }

    QMessageBox box(QMessageBox::Information, "Failed to fetch",

                "Fetching stuff failed with error '%1`").arg(errorValue),

                QMessageBox::Ok);

    box.exec();

    return 1;

} 
```

> 在 Qt 中，每个具有 Q_OBJECT 宏的类都会自动拥有 QMetaObject 类型的静态成员“staticMetaObject”。然后你可以找到各种很酷的东西，比如属性、信号、插槽和枚举。

[来源](https://www.qt.io/blog/2008/10/09/coding-tip-pretty-printing-enum-values)

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2012-07-20T19:50:25.193

我今天刚刚重新发明了这个轮子，并认为我会分享它。

此实现不需要*对*定义常量的代码进行任何更改，这些常量可以是枚举或`#define`s 或任何其他转化为整数的东西——在我的例子中，我有根据其他符号定义的符号。它也适用于稀疏值。它甚至允许同一个值有多个名称，总是返回第一个。唯一的缺点是它需要您制作一个常量表，例如，当添加新的常量时，它可能会过时。

```
struct IdAndName
{
   int          id;
   const char * name;
   bool operator<(const IdAndName &rhs) const { return id < rhs.id; }
};
#define ID_AND_NAME(x) { x, #x }

const char * IdToName(int id, IdAndName *table_begin, IdAndName *table_end)
{
   if ((table_end - table_begin) > 1 && table_begin[0].id > table_begin[1].id)
      std::stable_sort(table_begin, table_end);

   IdAndName searchee = { id, NULL };
   IdAndName *p = std::lower_bound(table_begin, table_end, searchee);
   return (p == table_end || p->id != id) ? NULL : p->name;
}

template<int N>
const char * IdToName(int id, IdAndName (&table)[N])
{
   return IdToName(id, &table[0], &table[N]);
} 
```

您将如何使用它的示例：

```
static IdAndName WindowsErrorTable[] =
{
   ID_AND_NAME(INT_MAX),               // flag value to indicate unsorted table
   ID_AND_NAME(NO_ERROR),
   ID_AND_NAME(ERROR_INVALID_FUNCTION),
   ID_AND_NAME(ERROR_FILE_NOT_FOUND),
   ID_AND_NAME(ERROR_PATH_NOT_FOUND),
   ID_AND_NAME(ERROR_TOO_MANY_OPEN_FILES),
   ID_AND_NAME(ERROR_ACCESS_DENIED),
   ID_AND_NAME(ERROR_INVALID_HANDLE),
   ID_AND_NAME(ERROR_ARENA_TRASHED),
   ID_AND_NAME(ERROR_NOT_ENOUGH_MEMORY),
   ID_AND_NAME(ERROR_INVALID_BLOCK),
   ID_AND_NAME(ERROR_BAD_ENVIRONMENT),
   ID_AND_NAME(ERROR_BAD_FORMAT),
   ID_AND_NAME(ERROR_INVALID_ACCESS),
   ID_AND_NAME(ERROR_INVALID_DATA),
   ID_AND_NAME(ERROR_INVALID_DRIVE),
   ID_AND_NAME(ERROR_CURRENT_DIRECTORY),
   ID_AND_NAME(ERROR_NOT_SAME_DEVICE),
   ID_AND_NAME(ERROR_NO_MORE_FILES)
};

const char * error_name = IdToName(GetLastError(), WindowsErrorTable); 
```

该`IdToName`函数依赖于`std::lower_bound`进行快速查找，这需要对表进行排序。如果表中的前两个条目无序，该函数将自动对其进行排序。

编辑：评论让我想到了使用相同原理的另一种方式。宏简化了大`switch`语句的生成。

```
#define ID_AND_NAME(x) case x: return #x

const char * WindowsErrorToName(int id)
{
    switch(id)
    {
        ID_AND_NAME(ERROR_INVALID_FUNCTION);
        ID_AND_NAME(ERROR_FILE_NOT_FOUND);
        ID_AND_NAME(ERROR_PATH_NOT_FOUND);
        ID_AND_NAME(ERROR_TOO_MANY_OPEN_FILES);
        ID_AND_NAME(ERROR_ACCESS_DENIED);
        ID_AND_NAME(ERROR_INVALID_HANDLE);
        ID_AND_NAME(ERROR_ARENA_TRASHED);
        ID_AND_NAME(ERROR_NOT_ENOUGH_MEMORY);
        ID_AND_NAME(ERROR_INVALID_BLOCK);
        ID_AND_NAME(ERROR_BAD_ENVIRONMENT);
        ID_AND_NAME(ERROR_BAD_FORMAT);
        ID_AND_NAME(ERROR_INVALID_ACCESS);
        ID_AND_NAME(ERROR_INVALID_DATA);
        ID_AND_NAME(ERROR_INVALID_DRIVE);
        ID_AND_NAME(ERROR_CURRENT_DIRECTORY);
        ID_AND_NAME(ERROR_NOT_SAME_DEVICE);
        ID_AND_NAME(ERROR_NO_MORE_FILES);
        default: return NULL;
    }
} 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2014-06-18T22:57:23.910

这可以在 C++11 中完成

```
#include <map>
enum MyEnum { AA, BB, CC, DD };

static std::map< MyEnum, const char * > info = {
   {AA, "This is an apple"},
   {BB, "This is a book"},
   {CC, "This is a coffee"},
   {DD, "This is a door"}
};

void main()
{
    std::cout << info[AA] << endl
              << info[BB] << endl
              << info[CC] << endl
              << info[DD] << endl;
} 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2012-11-02T02:44:46.760

```
#define stringify( name ) # name

enum MyEnum {
    ENUMVAL1
};
...stuff...

stringify(EnumName::ENUMVAL1);  // Returns MyEnum::ENUMVAL1 
```

[对该方法的进一步讨论](http://www.cplusplus.com/forum/general/2949/)

[新手的预处理指令技巧](http://www.cprogramming.com/tutorial/cpreprocessor.html)

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-06-23T01:45:40.893

有趣的是看到方法的数量。这是我很久以前使用的一个：

在文件 myenummap.h 中：

```
#include <map>
#include <string>
enum test{ one, two, three, five=5, six, seven };
struct mymap : std::map<unsigned int, std::string>
{
  mymap()
  {
    this->operator[]( one ) = "ONE";
    this->operator[]( two ) = "TWO";
    this->operator[]( three ) = "THREE";
    this->operator[]( five ) = "FIVE";
    this->operator[]( six ) = "SIX";
    this->operator[]( seven ) = "SEVEN";
  };
  ~mymap(){};
}; 
```

在 main.cpp

```
#include "myenummap.h"

...
mymap nummap;
std::cout<< nummap[ one ] << std::endl; 
```

它不是 const，但它很方便。

这是使用 C++11 特性的另一种方式。这是 const，不继承 STL 容器并且更整洁：

```
#include <vector>
#include <string>
#include <algorithm>
#include <iostream>

//These stay together and must be modified together
enum test{ one, two, three, five=5, six, seven };
std::string enum_to_str(test const& e)
{
    typedef std::pair<int,std::string> mapping;
    auto m = [](test const& e,std::string const& s){return mapping(static_cast<int>(e),s);}; 
    std::vector<mapping> const nummap = 
    { 
        m(one,"one"), 
        m(two,"two"), 
        m(three,"three"),
        m(five,"five"),
        m(six,"six"),
        m(seven,"seven"),
    };
    for(auto i  : nummap)
    {
        if(i.first==static_cast<int>(e))
        {
            return i.second;
        }
    }
    return "";
}

int main()
{
//  std::cout<< enum_to_str( 46 ) << std::endl; //compilation will fail
    std::cout<< "Invalid enum to string : [" << enum_to_str( test(46) ) << "]"<<std::endl; //returns an empty string
    std::cout<< "Enumval five to string : ["<< enum_to_str( five ) << "] "<< std::endl; //works
    return 0;
} 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-10-14T16:03:03.873

[Suma 的宏解决方案](https://stackoverflow.com/questions/147267/easy-way-to-use-variables-of-enum-types-as-string-in-c#202511)很好。不过，您不需要有两个不同的宏。C++ 很乐意包含一个标题两次。只需省略包含守卫。

所以你会有一个 foobar.h 定义

```
ENUM(Foo, 1)
ENUM(Bar, 2) 
```

你会像这样包括它：

```
#define ENUMFACTORY_ARGUMENT "foobar.h"
#include "enumfactory.h" 
```

enumfactory.h 将执行 2`#include ENUMFACTORY_ARGUMENT`秒。在第一轮中，它像 Suma 一样扩展了 ENUM `DECLARE_ENUM`；在第二轮 ENUM 的工作方式类似于`DEFINE_ENUM`.

您也可以多次包含 enumfactory.h，只要您为 ENUMFACTORY_ARGUMENT 传入不同的#define

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2014-02-27T11:34:59.310

```
#include <stdarg.h>
#include <algorithm>
#include <string> 
#include <vector>
#include <sstream>
#include <map>

#define SMART_ENUM(EnumName, ...)                                   \
class EnumName                                                      \
{                                                                   \
private:                                                            \
    static std::map<int, std::string> nameMap;                      \
public:                                                             \
    enum {__VA_ARGS__};                                             \
private:                                                            \
    static std::map<int, std::string> initMap()                     \
    {                                                               \
        using namespace std;                                        \
                                                                    \
        int val = 0;                                                \
        string buf_1, buf_2, str = #__VA_ARGS__;                    \
        replace(str.begin(), str.end(), '=', ' ');                  \
        stringstream stream(str);                                   \
        vector<string> strings;                                     \
        while (getline(stream, buf_1, ','))                         \
            strings.push_back(buf_1);                               \
        map<int, string> tmp;                                       \
        for(vector<string>::iterator it = strings.begin();          \
                                               it != strings.end(); \
                                               ++it)                \
        {                                                           \
            buf_1.clear(); buf_2.clear();                           \
            stringstream localStream(*it);                          \
            localStream>> buf_1 >> buf_2;                           \
            if(buf_2.size() > 0)                                    \
                val = atoi(buf_2.c_str());                          \
            tmp[val++] = buf_1;                                     \
        }                                                           \
        return tmp;                                                 \
    }                                                               \
public:                                                             \
    static std::string toString(int aInt)                           \
    {                                                               \
        return nameMap[aInt];                                       \
    }                                                               \
};                                                                  \
std::map<int, std::string>                                          \
EnumName::nameMap = EnumName::initMap(); 
```

用法：

```
SMART_ENUM(MyEnum, ONE=1, TWO, THREE, TEN=10, ELEVEN)
cout<<MyEnum::toString(MyEnum::TWO);
cout<<MyEnum::toString(10); 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2008-10-14T16:05:31.170

请注意，理想情况下，您的转换函数应该返回一个**const** char *。

如果你有能力将你的枚举放在它们单独的头文件中，你也许可以用宏做这样的事情（哦，这会很难看）：

```
#include "enum_def.h"
#include "colour.h"
#include "enum_conv.h"
#include "colour.h" 
```

其中 enum_def.h 有：

```
#undef ENUM_START
#undef ENUM_ADD
#undef ENUM_END
#define ENUM_START(NAME) enum NAME {
#define ENUM_ADD(NAME, VALUE) NAME = VALUE,
#define ENUM_END }; 
```

enum_conv.h 有：

```
#undef ENUM_START
#undef ENUM_ADD
#undef ENUM_END
#define ENUM_START(NAME) const char *##NAME##_to_string(NAME val) { switch (val) {
#define ENUM_ADD(NAME, VALUE) case NAME: return #NAME;
#define ENUM_END default: return "Invalid value"; } } 
```

最后， colour.h 有：

```
ENUM_START(colour)
ENUM_ADD(red,   0xff0000)
ENUM_ADD(green, 0x00ff00)
ENUM_ADD(blue,  0x0000ff)
ENUM_END 
```

您可以将转换功能用作：

```
printf("%s", colour_to_string(colour::red)); 
```

这很难看，但它是（在预处理器级别）让您在代码中的一个位置定义枚举的唯一方法。因此，由于对枚举的修改，您的代码不容易出错。您的枚举定义和转换函数将始终保持同步。但是，我再说一遍，这很丑:)

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-10-14T17:45:10.173

另一个答案：在某些情况下，以非代码格式定义枚举是有意义的，例如 CSV、YAML 或 XML 文件，然后从定义中生成 C++ 枚举代码和目标字符串代码。这种方法在您的应用程序中可能实用，也可能不实用，但请记住这一点。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2014-05-01T20:17:52.427

这是对@user3360260 答案的修改。它具有以下新功能

*   `MyEnum fromString(const string&)`支持
*   使用 VisualStudio 2012 编译
*   枚举是一个实际的 POD 类型（不仅仅是 const 声明），因此您可以将它分配给一个变量。
*   添加了 C++“范围”功能（以向量的形式）以允许对枚举进行“foreach”迭代

用法：

```
SMART_ENUM(MyEnum, ONE=1, TWO, THREE, TEN=10, ELEVEN)
MyEnum foo = MyEnum::TWO;
cout << MyEnum::toString(foo);  // static method
cout << foo.toString();         // member method
cout << MyEnum::toString(MyEnum::TWO);
cout << MyEnum::toString(10);
MyEnum foo = myEnum::fromString("TWO");

// C++11 iteration over all values
for( auto x : MyEnum::allValues() )
{
  cout << x.toString() << endl;
} 
```

这是代码

```
#define SMART_ENUM(EnumName, ...)                                   \
class EnumName                                                      \
{                                                                   \
public:                                                             \
    EnumName() : value(0) {}                                        \
    EnumName(int x) : value(x) {}                                   \
public:                                                             \
    enum {__VA_ARGS__};                                             \
private:                                                            \
    static void initMap(std::map<int, std::string>& tmp)                     \
    {                                                               \
        using namespace std;                                        \
                                                                    \
        int val = 0;                                                \
        string buf_1, buf_2, str = #__VA_ARGS__;                    \
        replace(str.begin(), str.end(), '=', ' ');                  \
        stringstream stream(str);                                   \
        vector<string> strings;                                     \
        while (getline(stream, buf_1, ','))                         \
            strings.push_back(buf_1);                               \
        for(vector<string>::iterator it = strings.begin();          \
                                                it != strings.end(); \
                                                ++it)                \
        {                                                           \
            buf_1.clear(); buf_2.clear();                           \
            stringstream localStream(*it);                          \
            localStream>> buf_1 >> buf_2;                           \
            if(buf_2.size() > 0)                                    \
                val = atoi(buf_2.c_str());                          \
            tmp[val++] = buf_1;                                     \
        }                                                           \
    }                                                               \
    int value;                                                      \
public:                                                             \
    operator int () const { return value; }                         \
    std::string toString(void) const {                              \
            return toString(value);                                 \
    }                                                               \
    static std::string toString(int aInt)                           \
    {                                                               \
        return nameMap()[aInt];                                     \
    }                                                               \
    static EnumName fromString(const std::string& s)                \
    {                                                               \
        auto it = find_if(nameMap().begin(), nameMap().end(), [s](const std::pair<int,std::string>& p) { \
            return p.second == s;                                   \
        });                                                         \
        if (it == nameMap().end()) {                                \
        /*value not found*/                                         \
            throw EnumName::Exception();                            \
        } else {                                                    \
            return EnumName(it->first);                             \
        }                                                           \
    }                                                               \
    class Exception : public std::exception {};                     \
    static std::map<int,std::string>& nameMap() {                   \
      static std::map<int,std::string> nameMap0;                    \
      if (nameMap0.size() ==0) initMap(nameMap0);                   \
      return nameMap0;                                              \
    }                                                               \
    static std::vector<EnumName> allValues() {                      \
      std::vector<EnumName> x{ __VA_ARGS__ };                       \
      return x;                                                     \
    }                                                               \
    bool operator<(const EnumName a) const { return (int)*this < (int)a; } \
}; 
```

请注意，转换 toString 是一种快速的查找，而转换 fromString 是一种缓慢的线性搜索。但是无论如何字符串都非常昂贵（以及相关的文件 IO），我觉得不需要优化或使用 bimap。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2014-08-20T21:51:29.003

这是一个单一文件的解决方案（基于@Marcin 的优雅回答：

```
#include <iostream>

#define ENUM_TXT \
X(Red) \
X(Green) \
X(Blue) \
X(Cyan) \
X(Yellow) \
X(Magenta) \

enum Colours {
#   define X(a) a,
ENUM_TXT
#   undef X
    ColoursCount
};

char const* const colours_str[] = {
#   define X(a) #a,
ENUM_TXT
#   undef X
    0
};

std::ostream& operator<<(std::ostream& os, enum Colours c)
{
    if (c >= ColoursCount || c < 0) return os << "???";
    return os << colours_str[c] << std::endl;
}

int main()
{
    std::cout << Red << Blue << Green << Cyan << Yellow << Magenta << std::endl;
} 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-10-14T19:40:13.717

我使用宏生成的单独的并排枚举包装类来做到这一点。有几个优点：

*   可以为我未定义的枚举生成它们（例如：OS 平台标头枚举）
*   可以将范围检查合并到包装类中
*   可以使用位域枚举进行“更智能”的格式化

当然，缺点是我需要在格式化程序类中复制枚举值，而且我没有任何脚本来生成它们。不过，除此之外，它似乎工作得很好。

这是我的代码库中的枚举示例，没有实现宏和模板的所有框架代码，但您可以理解：

```
enum EHelpLocation
{
    HELP_LOCATION_UNKNOWN   = 0, 
    HELP_LOCAL_FILE         = 1, 
    HELP_HTML_ONLINE        = 2, 
};
class CEnumFormatter_EHelpLocation : public CEnumDefaultFormatter< EHelpLocation >
{
public:
    static inline CString FormatEnum( EHelpLocation eValue )
    {
        switch ( eValue )
        {
            ON_CASE_VALUE_RETURN_STRING_OF_VALUE( HELP_LOCATION_UNKNOWN );
            ON_CASE_VALUE_RETURN_STRING_OF_VALUE( HELP_LOCAL_FILE );
            ON_CASE_VALUE_RETURN_STRING_OF_VALUE( HELP_HTML_ONLINE );
        default:
            return FormatAsNumber( eValue );
        }
    }
};
DECLARE_RANGE_CHECK_CLASS( EHelpLocation, CRangeInfoSequential< HELP_HTML_ONLINE > );
typedef ESmartEnum< EHelpLocation, HELP_LOCATION_UNKNOWN, CEnumFormatter_EHelpLocation, CRangeInfo_EHelpLocation > SEHelpLocation; 
```

然后的想法是不使用 EHelpLocation，而是使用 SEHelpLocation；一切都一样，但是您可以在枚举变量本身上进行范围检查和“Format()”方法。如果需要格式化独立值，可以使用 CEnumFormatter_EHelpLocation::FormatEnum(...)。

希望这会有所帮助。我意识到这也没有解决关于实际生成另一个类的脚本的原始问题，但我希望该结构可以帮助尝试解决相同问题或编写这样一个脚本的人。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2009-11-04T16:22:03.577

这是未发布的软件，但 Frank Laub 的 BOOST_ENUM 似乎符合要求。我喜欢它的部分是你可以在一个类的范围内定义一个枚举，大多数基于宏的枚举通常不允许你这样做。它位于 Boost Vault 中：[http](http://www.boostpro.com/vault/index.php?action=downloadfile&filename=enum_rev4.6.zip&directory=&) ://www.boostpro.com/vault/index.php?action=downloadfile&filename=enum_rev4.6.zip&directory=& 自 2006 年以来没有看到任何发展，所以我没有知道它与新的 Boost 版本的编译效果如何。在 libs/test 下查看使用示例。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2014-08-28T17:40:23.543

这是我使用 BOOST 的解决方案：

```
#include <boost/preprocessor.hpp>

#define X_STR_ENUM_TOSTRING_CASE(r, data, elem)                                 \
    case elem : return BOOST_PP_STRINGIZE(elem);

#define X_ENUM_STR_TOENUM_IF(r, data, elem)                                     \
    else if(data == BOOST_PP_STRINGIZE(elem)) return elem;

#define STR_ENUM(name, enumerators)                                             \
    enum name {                                                                 \
        BOOST_PP_SEQ_ENUM(enumerators)                                          \
    };                                                                          \
                                                                                \
    inline const QString enumToStr(name v)                                      \
    {                                                                           \
        switch (v)                                                              \
        {                                                                       \
            BOOST_PP_SEQ_FOR_EACH(                                              \
                X_STR_ENUM_TOSTRING_CASE,                                       \
                name,                                                           \
                enumerators                                                     \
            )                                                                   \
                                                                                \
            default:                                                            \
                return "[Unknown " BOOST_PP_STRINGIZE(name) "]";                \
        }                                                                       \
    }                                                                           \
                                                                                \
    template <typename T>                                                       \
    inline const T strToEnum(QString v);                                        \
                                                                                \
    template <>                                                                 \
    inline const name strToEnum(QString v)                                      \
    {                                                                           \
        if(v=="")                                                               \
            throw std::runtime_error("Empty enum value");                       \
                                                                                \
        BOOST_PP_SEQ_FOR_EACH(                                                  \
            X_ENUM_STR_TOENUM_IF,                                               \
            v,                                                                  \
            enumerators                                                         \
        )                                                                       \
                                                                                \
        else                                                                    \
            throw std::runtime_error(                                           \
                        QString("[Unknown value %1 for enum %2]")               \
                            .arg(v)                                             \
                            .arg(BOOST_PP_STRINGIZE(name))                      \
                                .toStdString().c_str());                        \
    } 
```

要创建枚举，请声明：

```
STR_ENUM
(
    SERVICE_RELOAD,
        (reload_log)
        (reload_settings)
        (reload_qxml_server)
) 
```

对于转换：

```
SERVICE_RELOAD serviceReloadEnum = strToEnum<SERVICE_RELOAD>("reload_log");
QString serviceReloadStr = enumToStr(reload_log); 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2016-11-01T23:40:37.407

我想发布这个以防有人发现它有用。

在我的例子中，我只需要从一个文件中为一个 C++11 枚举生成`ToString()`和函数。`FromString()``.hpp`

我编写了一个 python 脚本来解析包含枚举项的头文件并在一个新`.cpp`文件中生成函数。

[您可以使用execute_process](https://cmake.org/cmake/help/v3.0/command/execute_process.html)在 CMakeLists.txt 中添加此脚本，或作为 Visual Studio 中的预构建事件。该`.cpp`文件将自动生成，无需在每次添加新枚举项时手动更新。

**generate_enum_strings.py**

```
# This script is used to generate strings from C++ enums

import re
import sys
import os

fileName = sys.argv[1]
enumName = os.path.basename(os.path.splitext(fileName)[0])

with open(fileName, 'r') as f:
    content = f.read().replace('\n', '')

searchResult = re.search('enum(.*)\{(.*?)\};', content)
tokens = searchResult.group(2)
tokens = tokens.split(',')
tokens = map(str.strip, tokens)
tokens = map(lambda token: re.search('([a-zA-Z0-9_]*)', token).group(1), tokens)

textOut = ''
textOut += '\n#include "' + enumName + '.hpp"\n\n'
textOut += 'namespace myns\n'
textOut += '{\n'
textOut += '    std::string ToString(ErrorCode errorCode)\n'
textOut += '    {\n'
textOut += '        switch (errorCode)\n'
textOut += '        {\n'

for token in tokens:
    textOut += '        case ' + enumName + '::' + token + ':\n'
    textOut += '            return "' + token + '";\n'

textOut += '        default:\n'
textOut += '            return "Last";\n'
textOut += '        }\n'
textOut += '    }\n'
textOut += '\n'
textOut += '    ' + enumName + ' FromString(const std::string &errorCode)\n'
textOut += '    {\n'
textOut += '        if ("' + tokens[0] + '" == errorCode)\n'
textOut += '        {\n'
textOut += '            return ' + enumName + '::' + tokens[0] + ';\n'
textOut += '        }\n'

for token in tokens[1:]:
    textOut += '        else if("' + token + '" == errorCode)\n'
    textOut += '        {\n'
    textOut += '            return ' + enumName + '::' + token + ';\n'
    textOut += '        }\n'

textOut += '\n'
textOut += '        return ' + enumName + '::Last;\n'
textOut += '    }\n'
textOut += '}\n'

fileOut = open(enumName + '.cpp', 'w')
fileOut.write(textOut) 
```

例子：

**错误代码.hpp**

```
#pragma once

#include <string>
#include <cstdint>

namespace myns
{
    enum class ErrorCode : uint32_t
    {
        OK = 0,
        OutOfSpace,
        ConnectionFailure,
        InvalidJson,
        DatabaseFailure,
        HttpError,
        FileSystemError,
        FailedToEncrypt,
        FailedToDecrypt,
        EndOfFile,
        FailedToOpenFileForRead,
        FailedToOpenFileForWrite,
        FailedToLaunchProcess,

        Last
    };

    std::string ToString(ErrorCode errorCode);
    ErrorCode FromString(const std::string &errorCode);
} 
```

跑`python generate_enum_strings.py ErrorCode.hpp`

结果：

**错误码.cpp**

```
#include "ErrorCode.hpp"

namespace myns
{
    std::string ToString(ErrorCode errorCode)
    {
        switch (errorCode)
        {
        case ErrorCode::OK:
            return "OK";
        case ErrorCode::OutOfSpace:
            return "OutOfSpace";
        case ErrorCode::ConnectionFailure:
            return "ConnectionFailure";
        case ErrorCode::InvalidJson:
            return "InvalidJson";
        case ErrorCode::DatabaseFailure:
            return "DatabaseFailure";
        case ErrorCode::HttpError:
            return "HttpError";
        case ErrorCode::FileSystemError:
            return "FileSystemError";
        case ErrorCode::FailedToEncrypt:
            return "FailedToEncrypt";
        case ErrorCode::FailedToDecrypt:
            return "FailedToDecrypt";
        case ErrorCode::EndOfFile:
            return "EndOfFile";
        case ErrorCode::FailedToOpenFileForRead:
            return "FailedToOpenFileForRead";
        case ErrorCode::FailedToOpenFileForWrite:
            return "FailedToOpenFileForWrite";
        case ErrorCode::FailedToLaunchProcess:
            return "FailedToLaunchProcess";
        case ErrorCode::Last:
            return "Last";
        default:
            return "Last";
        }
    }

    ErrorCode FromString(const std::string &errorCode)
    {
        if ("OK" == errorCode)
        {
            return ErrorCode::OK;
        }
        else if("OutOfSpace" == errorCode)
        {
            return ErrorCode::OutOfSpace;
        }
        else if("ConnectionFailure" == errorCode)
        {
            return ErrorCode::ConnectionFailure;
        }
        else if("InvalidJson" == errorCode)
        {
            return ErrorCode::InvalidJson;
        }
        else if("DatabaseFailure" == errorCode)
        {
            return ErrorCode::DatabaseFailure;
        }
        else if("HttpError" == errorCode)
        {
            return ErrorCode::HttpError;
        }
        else if("FileSystemError" == errorCode)
        {
            return ErrorCode::FileSystemError;
        }
        else if("FailedToEncrypt" == errorCode)
        {
            return ErrorCode::FailedToEncrypt;
        }
        else if("FailedToDecrypt" == errorCode)
        {
            return ErrorCode::FailedToDecrypt;
        }
        else if("EndOfFile" == errorCode)
        {
            return ErrorCode::EndOfFile;
        }
        else if("FailedToOpenFileForRead" == errorCode)
        {
            return ErrorCode::FailedToOpenFileForRead;
        }
        else if("FailedToOpenFileForWrite" == errorCode)
        {
            return ErrorCode::FailedToOpenFileForWrite;
        }
        else if("FailedToLaunchProcess" == errorCode)
        {
            return ErrorCode::FailedToLaunchProcess;
        }
        else if("Last" == errorCode)
        {
            return ErrorCode::Last;
        }

        return ErrorCode::Last;
    }
} 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2018-09-10T20:23:46.150

[为Jasper Bekkers 的精彩回答](https://stackoverflow.com/a/238157/2124447)添加了更多的简单易用性：

设置一次：

```
#define MAKE_ENUM(VAR) VAR,
#define MAKE_STRINGS(VAR) #VAR,
#define MAKE_ENUM_AND_STRINGS(source, enumName, enumStringName) \
    enum enumName { \
    source(MAKE_ENUM) \
    };\
const char* const enumStringName[] = { \
    source(MAKE_STRINGS) \
    }; 
```

然后，为了使用：

```
#define SOME_ENUM(DO) \
    DO(Foo) \
    DO(Bar) \
    DO(Baz)
...
MAKE_ENUM_AND_STRINGS(SOME_ENUM, someEnum, someEnumNames) 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2018-10-05T16:01:26.773

您可以使用反射库，例如[Ponder](https://billyquith.github.io/ponder/)。您注册枚举，然后您可以使用 API 来回转换它们。

```
enum class MyEnum
{
    Zero = 0,
    One  = 1,
    Two  = 2
};

ponder::Enum::declare<MyEnum>()
    .value("Zero", MyEnum::Zero)
    .value("One",  MyEnum::One)
    .value("Two",  MyEnum::Two);

ponder::EnumObject zero(MyEnum::Zero);

zero.name(); // -> "Zero" 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2008-10-14T15:50:22.057

答案 0 的一个问题是枚举二进制值不一定从 0 开始，也不一定是连续的。

当我需要这个时，我通常：

*   将枚举定义拉入我的源代码
*   编辑它以获取名称
*   做一个宏将名称更改为问题中的 case 子句，但通常在一行中： case foo: return "foo";
*   添加开关，默认和其他语法以使其合法

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2008-10-14T17:10:31.817

以下 ruby​​ 脚本尝试解析标头并在原始标头旁边构建所需的源。

```
#! /usr/bin/env ruby

# Let's "parse" the headers
# Note that using a regular expression is rather fragile
# and may break on some inputs

GLOBS = [
  "toto/*.h",
  "tutu/*.h",
  "tutu/*.hxx"
]

enums = {}
GLOBS.each { |glob|
  Dir[glob].each { |header|
    enums[header] = File.open(header, 'rb') { |f|
      f.read
    }.scan(/enum\s+(\w+)\s+\{\s*([^}]+?)\s*\}/m).collect { |enum_name, enum_key_and_values|
      [
        enum_name, enum_key_and_values.split(/\s*,\s*/).collect { |enum_key_and_value|
          enum_key_and_value.split(/\s*=\s*/).first
        }
      ]
    }
  }
}

# Now we build a .h and .cpp alongside the parsed headers
# using the template engine provided with ruby
require 'erb'

template_h = ERB.new <<-EOS
#ifndef <%= enum_name %>_to_string_h_
#define <%= enum_name %>_to_string_h_ 1

#include "<%= header %>"
char* enum_to_string(<%= enum_name %> e);

#endif
EOS

template_cpp = ERB.new <<-EOS
#include "<%= enum_name %>_to_string.h"

char* enum_to_string(<%= enum_name %> e)
{
  switch (e)
  {<% enum_keys.each do |enum_key| %>
    case <%= enum_key %>: return "<%= enum_key %>";<% end %>
    default: return "INVALID <%= enum_name %> VALUE";
  }
}
EOS

enums.each { |header, enum_name_and_keys|
  enum_name_and_keys.each { |enum_name, enum_keys|
    File.open("#{File.dirname(header)}/#{enum_name}_to_string.h", 'wb') { |built_h|
      built_h.write(template_h.result(binding))
    }

    File.open("#{File.dirname(header)}/#{enum_name}_to_string.cpp", 'wb') { |built_cpp|
      built_cpp.write(template_cpp.result(binding))
    }
  }
} 
```

使用正则表达式会使这个“解析器”变得非常脆弱，它可能无法优雅地处理您的特定标头。

假设您有一个标题 toto/ah，其中包含枚举 MyEnum 和 MyEnum2 的定义。该脚本将构建：

```
toto/MyEnum_to_string.h
toto/MyEnum_to_string.cpp
toto/MyEnum2_to_string.h
toto/MyEnum2_to_string.cpp 
```

更强大的解决方案是：

*   从另一个源构建定义枚举及其操作的所有源。这意味着您将在比 C/C++ 更容易解析的 XML/YML/任何文件中定义枚举。
*   使用真正的编译器，例如 Avdi 建议的。
*   使用带有或不带有模板的预处理器宏。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2008-10-14T15:17:27.117

这几乎是唯一可以完成的方法（字符串数组也可以工作）。

问题是，一旦编译了 C 程序，枚举的二进制值就全部用完了，名字就消失了。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2010-06-07T22:40:49.423

这是我编写的一个 CLI 程序，可以轻松地将枚举转换为字符串。它易于使用，大约需要 5 秒才能完成（包括 cd 到包含程序的目录，然后运行它，将包含枚举的文件传递给它的时间）。

在此处下载： [http ://www.mediafire.com/?nttignoozzz](http://www.mediafire.com/?nttignoozzz)

讨论主题在这里： [http ://cboard.cprogramming.com/projects-job-recruitment/127488-free-program-im-sharing-convertenumtostrings.html](http://cboard.cprogramming.com/projects-job-recruitment/127488-free-program-im-sharing-convertenumtostrings.html)

使用“--help”参数运行程序以获取如何使用它的描述。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2013-03-07T11:47:49.453

不久前，我做了一些技巧，让枚举在 QComboBox 中正确显示，并将枚举和字符串表示形式定义为一个语句

```
#pragma once
#include <boost/unordered_map.hpp>

namespace enumeration
{

   struct enumerator_base : boost::noncopyable
   {
      typedef
         boost::unordered_map<int, std::wstring>
         kv_storage_t;
      typedef
         kv_storage_t::value_type
         kv_type;
      kv_storage_t const & kv() const
      {
         return storage_;
      }

      LPCWSTR name(int i) const
      {
         kv_storage_t::const_iterator it = storage_.find(i);
         if(it != storage_.end())
            return it->second.c_str();
         return L"empty";
      }

   protected:
      kv_storage_t storage_;
   };

   template<class T>
   struct enumerator;

   template<class D>
   struct enum_singleton : enumerator_base
   {
      static enumerator_base const & instance()
      {
         static D inst;
         return inst;
      }
   };
}

#define QENUM_ENTRY(K, V, N)  K, N storage_.insert(std::make_pair((int)K, V));

#define QBEGIN_ENUM(NAME, C)   \
enum NAME                     \
{                             \
   C                          \
}                             \
};                            \
}                             \

#define QEND_ENUM(NAME) \
};                     \
namespace enumeration  \
{                      \
template<>             \
struct enumerator<NAME>\
   : enum_singleton< enumerator<NAME> >\
{                      \
   enumerator()        \
   {

//usage
/*
QBEGIN_ENUM(test_t,
   QENUM_ENTRY(test_entry_1, L"number uno",
   QENUM_ENTRY(test_entry_2, L"number dos",
   QENUM_ENTRY(test_entry_3, L"number tres",
QEND_ENUM(test_t)))))
*/ 
```

现在您已经`enumeration::enum_singleton<your_enum>::instance()`能够将枚举转换为字符串。如果您替换`kv_storage_t`为`boost::bimap`，您还可以进行反向转换。引入了converter的通用基类将其存储在Qt对象中，因为Qt对象不能是模板

[以前的样子](https://stackoverflow.com/a/15266261/1904007)

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2013-04-15T10:33:13.543

作为变体，使用简单的 lib > [http://codeproject.com/Articles/42035/Enum-to-String-and-Vice-Versa-in-C](http://codeproject.com/Articles/42035/Enum-to-String-and-Vice-Versa-in-C)

在代码中

```
#include <EnumString.h>

enum FORM {
    F_NONE = 0,
    F_BOX,
    F_CUBE,
    F_SPHERE,
}; 
```

添加行

```
Begin_Enum_String( FORM )
{
    Enum_String( F_NONE );
    Enum_String( F_BOX );
    Enum_String( F_CUBE );
    Enum_String( F_SPHERE );
}
End_Enum_String; 
```

工作正常，**如果 enum 中的值不重复**。

示例用法

```
enum FORM f = ...
const std::string& str = EnumString< FORM >::From( f ); 
```

反之亦然

```
assert( EnumString< FORM >::To( f, str ) ); 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2014-03-07T16:17:21.140

这是仅使用一行宏命令自动获取枚举上的 << 和 >> 流运算符的尝试...

定义：

```
#include <string>
#include <iostream>
#include <stdexcept>
#include <algorithm>
#include <iterator>
#include <sstream>
#include <vector>

#define MAKE_STRING(str, ...) #str, MAKE_STRING1_(__VA_ARGS__)
#define MAKE_STRING1_(str, ...) #str, MAKE_STRING2_(__VA_ARGS__)
#define MAKE_STRING2_(str, ...) #str, MAKE_STRING3_(__VA_ARGS__)
#define MAKE_STRING3_(str, ...) #str, MAKE_STRING4_(__VA_ARGS__)
#define MAKE_STRING4_(str, ...) #str, MAKE_STRING5_(__VA_ARGS__)
#define MAKE_STRING5_(str, ...) #str, MAKE_STRING6_(__VA_ARGS__)
#define MAKE_STRING6_(str, ...) #str, MAKE_STRING7_(__VA_ARGS__)
#define MAKE_STRING7_(str, ...) #str, MAKE_STRING8_(__VA_ARGS__)
#define MAKE_STRING8_(str, ...) #str, MAKE_STRING9_(__VA_ARGS__)
#define MAKE_STRING9_(str, ...) #str, MAKE_STRING10_(__VA_ARGS__)
#define MAKE_STRING10_(str) #str

#define MAKE_ENUM(name, ...) MAKE_ENUM_(, name, __VA_ARGS__)
#define MAKE_CLASS_ENUM(name, ...) MAKE_ENUM_(friend, name, __VA_ARGS__)

#define MAKE_ENUM_(attribute, name, ...) name { __VA_ARGS__ }; \
    attribute std::istream& operator>>(std::istream& is, name& e) { \
        const char* name##Str[] = { MAKE_STRING(__VA_ARGS__) }; \
        std::string str; \
        std::istream& r = is >> str; \
        const size_t len = sizeof(name##Str)/sizeof(name##Str[0]); \
        const std::vector<std::string> enumStr(name##Str, name##Str + len); \
        const std::vector<std::string>::const_iterator it = std::find(enumStr.begin(), enumStr.end(), str); \
        if (it != enumStr.end())\
            e = name(it - enumStr.begin()); \
        else \
            throw std::runtime_error("Value \"" + str + "\" is not part of enum "#name); \
        return r; \
    }; \
    attribute std::ostream& operator<<(std::ostream& os, const name& e) { \
        const char* name##Str[] = { MAKE_STRING(__VA_ARGS__) }; \
        return (os << name##Str[e]); \
    } 
```

用法：

```
// Declare global enum
enum MAKE_ENUM(Test3, Item13, Item23, Item33, Itdsdgem43);

class Essai {
public:
    // Declare enum inside class
    enum MAKE_CLASS_ENUM(Test, Item1, Item2, Item3, Itdsdgem4);

};

int main() {
    std::cout << Essai::Item1 << std::endl;

    Essai::Test ddd = Essai::Item1;
    std::cout << ddd << std::endl;

    std::istringstream strm("Item2");
    strm >> ddd;

    std::cout << (int) ddd << std::endl;
    std::cout << ddd << std::endl;
} 
```

虽然不确定这个方案的局限性......欢迎评论！

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2014-04-25T10:31:23.883

```
#include <iostream>
#include <map>
#define IDMAP(x) (x,#x)

std::map<int , std::string> enToStr;
class mapEnumtoString
{
public:
    mapEnumtoString(){  }
    mapEnumtoString& operator()(int i,std::string str)
    {
        enToStr[i] = str;
        return *this;
    }
public:
   std::string operator [] (int i)
    {
        return enToStr[i];
    }

};
mapEnumtoString k;
mapEnumtoString& init()
{
    return k;
}

int main()
{

init()
    IDMAP(1)
    IDMAP(2)
    IDMAP(3)
    IDMAP(4)
    IDMAP(5);
std::cout<<enToStr[1];
std::cout<<enToStr[2];
std::cout<<enToStr[3];
std::cout<<enToStr[4];
std::cout<<enToStr[5];
} 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2017-04-14T16:02:48.410

好吧，还有另一种选择。一个典型的用例是您需要 HTTP 动词的常量以及使用字符串版本值。

这个例子：

```
int main () {

  VERB a = VERB::GET;
  VERB b = VERB::GET;
  VERB c = VERB::POST;
  VERB d = VERB::PUT;
  VERB e = VERB::DELETE;

  std::cout << a.toString() << std::endl;

  std::cout << a << std::endl;

  if ( a == VERB::GET ) {
    std::cout << "yes" << std::endl;
  }

  if ( a == b ) {
    std::cout << "yes" << std::endl;
  }

  if ( a != c ) {
    std::cout << "no" << std::endl;
  }

} 
```

动词类：

```
// -----------------------------------------------------------
// -----------------------------------------------------------
class VERB {

private:

  // private constants
  enum Verb {GET_=0, POST_, PUT_, DELETE_};

  // private string values
  static const std::string theStrings[];

  // private value
  const Verb value;
  const std::string text;

  // private constructor
  VERB (Verb v) :
  value(v), text (theStrings[v])
  {
    // std::cout << " constructor \n";
  }

public:

  operator const char * ()  const { return text.c_str(); }

  operator const std::string ()  const { return text; }

  const std::string toString () const { return text; }

  bool operator == (const VERB & other) const { return (*this).value == other.value; }

  bool operator != (const VERB & other) const { return ! ( (*this) == other); }

  // ---

  static const VERB GET;
  static const VERB POST;
  static const VERB PUT;
  static const VERB DELETE;

};

const std::string VERB::theStrings[] = {"GET", "POST", "PUT", "DELETE"};

const VERB VERB::GET = VERB ( VERB::Verb::GET_ );
const VERB VERB::POST = VERB ( VERB::Verb::POST_ );
const VERB VERB::PUT = VERB ( VERB::Verb::PUT_ );
const VERB VERB::DELETE = VERB ( VERB::Verb::DELETE_ );
// end of file 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2017-07-18T19:47:23.570

对于元素很少的枚举（单行），使用复合三元语句可能有点优雅。该表达式的长度也仅随元素数量近似线性增长。

这是一个很好的用例：

```
enum log_level {INFO, WARNING, ERROR};
...
void logger::write(const std::string log, const log_level l) {
    ...
    std::string s = (l == INFO) ? "INFO" : 
                    (l == WARNING) ? "WARNING" : 
                    (l == ERROR) ? "ERROR" : "UNKNOWN";
    ...
}
... 
```

当然，这只是另一个 switch/if 语句块，但它是单行语句。作为简洁与简单的问题，它在中间的某个地方相遇。作为一个常量表达式，它也可以很容易地做成一个内联函数。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2018-07-09T23:00:54.013

当我在寻找自己的问题的解决方案以打印 C++ 中枚举的“单词”时，我遇到了这个问题。我回来提供了一个简单的解决方案，可以按措辞回答提出的问题。所需要做的就是用向量“镜像”枚举列表。

```
enum class genre { Fiction, NonFiction, Periodical, Biography, Children };

vector<string>genre_tbl { "Fiction", "NonFiction", "Periodical", "Biography", "Children" }; 
```

因为上面键入的枚举默认会执行以下操作；

```
Fiction = 0
NonFiction = 1
Periodical = 2
Biography = 3
Children = 4 
```

这匹配向量位置，这使得枚举到字符串的转换非常简单。

```
string s1 = genre_tbl[int(genre::fiction)]; 
```

对于我的问题，我创建了一个名为 Book 的用户定义类，其中包含一个名为 Gen 类型的成员。该程序需要能够将流派打印为单词。

```
class book {...};
ostream& operator<<(ostream& os, genre g) { return os << genre_tbl[int(g)]; }

book b1;
b1.Gen = genre(0)
cout << b1.Gen; 
```

在这种情况下，“小说”将打印到屏幕上。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2019-02-03T20:50:09.937

这个问题是重复的，

*   [如何轻松地将 C++ 枚举映射到字符串](https://stackoverflow.com/questions/207976/how-to-easily-map-c-enums-to-strings/54504663#54504663)

但是，在任何问题中，我都找不到好的答案。

在深入研究该主题后，我发现了两个很棒的开源解决方案：

[**wise_enum**](https://github.com/quicknir/wise_enum)

*   **用于 C++11/14/17 的独立智能枚举库**。它支持您期望从 C++ 中的智能枚举类中获得的所有标准功能。
*   限制：至少需要 C++11。

[**更好的枚举**](https://github.com/aantron/better-enums)

*   **具有简洁语法的反射式编译时枚举库**，在单个头文件中，并且没有依赖项。
*   限制：基于宏，不能在类中使用。

注意：我在这里重复建议。这个问题有很多流量/视图，确实需要列出上面的解决方案。

# wordpress - 如何修复我的 .htaccess 以解析不以斜杠结尾的 URL

> ID：201602
> 
> 赞同：2
> 
> 时间：2008-10-14T15:15:22.410
> 
> 标签：wordpress, .htaccess, http-status-code-404

我正在使用 wordpress 并使用自定义永久链接结构：/%category%/%postname%/

我的问题是，相当数量的人链接到该站点时没有在 URL 中包含尾部斜杠，因此用户会得到一个 404 页面。

我正在使用 wordpress 附带的默认 .htaccess 文件，因为我尝试过的任何解决方案都没有奏效。我试过使用重定向插件，但没有成功。

我很乐意链接到该网站，但我不希望它被解释为自我推销。如果你问，我会提供一个链接。

谁能帮我找到一个插件或提供一些 .htaccess 条目来帮助解决这个问题？

非常感谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-14T15:40:20.097

PerishablePress.com 是所有 .htaccess 的一个很好的参考

[http://perishablepress.com/press/2006/01/10/stupid-htaccess-tricks/](http://perishablepress.com/press/2006/01/10/stupid-htaccess-tricks/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T15:18:26.350

采用：

```
/%category%/%postname%(/?) 
```

在您的 .htaccess 文件中。

问号表示可选的字符序列。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-18T04:20:03.417

```
RewriteRule ^(([^\/]+\/)*[^\/\.]+)$ $1/ 
```

# java - 是否有任何类似于 Maven2 约定的 Ant 约定？

> ID：201606
> 
> 赞同：3
> 
> 时间：2008-10-14T15:15:49.380
> 
> 标签：java, ant, automated-tests, conventions

在过去的 2 年里——（ish）我一直在使用[Maven2](http://maven.apache.org)作为我的构建/持续集成解决方案。在那之前我用过[Ant](http://ant.apache.org)，但真的没有太多经验。现在我换了一份新工作，我所在的团队现在使用 Ant。

我想知道的是：

在 Maven 中，我们有用于分隔 java 源和文件以及 java 测试文件（[JUnit](http://junit.org)测试）的目录约定。它看起来像这样：

```
Project-
  -src/main/java
  -src/test/java 
```

这样，您的测试就与您的源代码/生产代码分开，并且不会像这样构建/部署。

浏览 Ant 文档，我真的没有看到任何约定。我错过了什么吗？Ant中是否有类似的约定？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-14T15:19:37.393

我对 ant 的经验——它是我们用于 Java 源代码的主要构建工具，所以你可以随意使用它——没有这样的*正式*约定。我见过的许多源项目都以类似的方式组织事物。JBoss 将 <module>/src/main 用于源代码等... Ant 只使用您想要的任何约定，这使其成为集成到更大的项目构建框架中的理想工具。

无论如何，Maven 约定对 Ant 来说工作得很好，所以如果您已经使用它们，只需重新使用相同的结构。当您使用熟悉的结构时，不仅可以更轻松地跟踪事物的位置，而且如果您决定对项目进行 mavenize，那么您已经做好了准备。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-15T01:39:42.337

[ANT in Anger](http://ant.apache.org/ant_in_anger.html)中解释了很多 ANT 约定/最佳实践

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-29T18:58:58.607

一个较旧但在我看来很好的资源是[ant-best-practices](http://www.onjava.com/pub/a/onjava/2003/12/17/ant_bestpractices.html)。

# vb.net - 是否有等效于 String.Split 的返回通用列表？

> ID：201607
> 
> 赞同：14
> 
> 时间：2008-10-14T15:16:40.800
> 
> 标签：vb.net, generics

我想做这样的事情：

```
Dim Foo as String = "a,b,c,d,e"
Dim Boo as List(of String) = Foo.Split(","c) 
```

当然`Foo.Split`返回 的一维数组`String`，而不是泛型的`List`。有没有办法在不遍历数组将其变成泛型的情况下做到这一点`List`？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-10-14T15:21:50.243

如果你不想使用 LINQ，你可以这样做：

```
Dim foo As String = "a,b,c,d,e"
Dim boo As New List(Of String)(foo.Split(","c)) 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-14T15:19:54.803

您可以使用 List 的构造函数。

```
String foo = "a,b,c,d,e";
List<String> boo = new List<String>(foo.Split(",")); 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-14T15:22:34.780

您真的需要 List<T> 还是 IList<T> 需要？因为 string[] 已经实现了后者……这是值得对接口进行编程的另一个原因。（可能是在这种情况下你真的不能，诚然。）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-14T15:23:55.013

最简单的方法可能是 AddRange 方法。

```
Dim Foo as String = "a,b,c,d,e"
Dim Boo as List(of String)

Boo.AddRange(Foo.Split(","c)) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-14T15:18:55.023

如果使用 Linq，可以使用 ToList() 扩展方法

```
Dim strings As List<string> = string_variable.Split().ToList<string>(); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-26T13:32:17.853

这就是我的做法……因为拆分正在寻找一个字符数组，所以我剪掉了字符串中的第一个值。

```
var values = labels.Split(" "[0]).ToList<string>(); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-10-28T17:22:11.577

为了建立答案，我发现以下内容非常有帮助：

```
Return New List(Of String)(IO.File.ReadAllLines(sFileName)) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-10-01T11:54:51.233

```
Dim Foo as String = "a,b,c,d,e"
Dim Boo as List(of String)
Boo = Split(Foo, ",").ToList 
```

这样做的好处是拆分字符串将接受多个字符：

```
Dim Foo as String = "a<blah>b<blah>c<blah>d<blah>e"
Dim Boo as List(of String)
Boo = Split(Foo, "<blah>").ToList 
```

# .net - 什么可能导致 .NET WinForms 应用程序在没有对话框的情况下突然关闭？

> ID：201614
> 
> 赞同：3
> 
> 时间：2008-10-14T15:17:43.527
> 
> 标签：.net, crash

据报道，我们的 WinForms 应用程序偶尔会自行关闭。它既不显示我们自己的崩溃错误提交对话框，也没有显示 Windows 的错误提交对话框，它只是关闭并消失了，通常是在该人处于 afk 并且没有对应用程序执行任何操作时。这似乎是一种半罕见的情况，可能每月 2-3 次，而且发生在不止一个人身上。我不知道从哪里开始获取复制案例或从哪里开始追踪。

C# .NET 2.0 报告的案例在 Win XP 上

有人有想法么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-14T15:43:20.560

由于无限递归导致的堆栈溢出是应用程序在没有警告的情况下退出的一个重要原因。除非你故意造成无声退出，否则未处理的异常（堆栈溢出除外）通常会在应用退出之前显示某种 UI。堆栈溢出是此规则最常见的例外（哎呀，抱歉）。

当然，对于非托管或不安全的代码，几乎可以肯定以正确的方式扰乱运行时以导致静默退出。

关于检测和查看 Windows 事件日志的建议也很好。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-14T15:26:18.563

异常会导致应用程序“消失”。检查事件日志以查看是否有任何内容。

检查任务管理器以查看窗口消失时进程是否仍然存在。我有资源管理器崩溃并且无法重绘窗口，直到它是 Alt-Tabbed 或 Switched-To（来自任务管理器）。

不要让用户忘记他们正在关闭应用程序。您可能希望在应用程序中放置一些日志记录逻辑来记录用户发起的关闭。下次它“消失”时，您可以检查任何日志条目。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T15:32:54.947

您可以在 FormClosing 事件中添加一些逻辑来询问用户他们是否真的想要这样做，然后您可以取消关闭事件，如果一切正常，您的应用程序将继续运行。如果您一直注意到这个问题并且它从不执行您的逻辑，那么您将不得不在调试器中弄脏您的手。

# ruby - log4r 示例的 syslog 输出

> ID：201615
> 
> 赞同：3
> 
> 时间：2008-10-14T15:17:49.470
> 
> 标签：ruby, log4r

有人可以发布一个为 log4r 使用 syslog 输出器的示例吗，我目前正在使用 stdout 但想登录到 syslog。

```
mylog = Logger.new 'mylog'
mylog.outputters = Outputter.stdout
mylog.info "Starting up." 
```

拉吉

* * *

还要感谢以下博客文章。

[Angrez 的博客：Log4r - 用法和示例](http://angrez.blogspot.com/2006/12/log4r-usage-and-examples.html)

[编程材料：Log4r](http://programmingstuff.wikidot.com/log4r)

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-15T06:16:26.927

回答我自己的问题有点蹩脚，但我找到了答案并将其添加以供以后搜索。

出于某种原因，我需要明确要求 log4r/outputter/syslogoutputter，否则 SyslogOutputter 会导致“未初始化的常量 SyslogOutputter (NameError)”错误。其他输出器似乎没有这个问题。

```
require 'rubygems'
require 'log4r'
require 'log4r/outputter/syslogoutputter'
mylog = Logger.new 'mylog'
mylog.outputters = SyslogOutputter.new("f1", :ident => "myscript")
mylog.info "Starting up." 
```

拉吉

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-20T09:37:03.600

我发现这很有帮助，但我不得不进行进一步的编辑。有东西试图重新打开系统日志，导致未处理的 RuntimeError。我在environments/production.rb中用这个疯狂的覆盖修复了它：

```
require 'rubygems'
require 'log4r'
require 'log4r/outputter/syslogoutputter'

# The outputter needs some love to avoid attempts to reopen syslog. Most of this is cargo-culted from source.
class Log4r::SyslogOutputter
  def initialize(_name, hash={})
    super(_name, hash)
    ident = (hash[:ident] or hash['ident'] or _name)
    logopt = (hash[:logopt] or hash['logopt'] or LOG_PID | LOG_CONS).to_i
    facility = (hash[:facility] or hash['facility'] or LOG_USER).to_i
    if Syslog.opened? then
      @syslog = Syslog
    else
      @syslog = Syslog.open(ident, logopt, facility)
    end
  end
end

RAILS_DEFAULT_LOGGER = Log4r::Logger.new 'mylog'
config.logger = RAILS_DEFAULT_LOGGER
config.logger.outputters = Log4r::SyslogOutputter.new("f1", :ident=>"RoR")
config.logger.info "Starting up." 
```

可能有一种更漂亮的方法，但这似乎对我有用。

# c# - 如何从服务 C# 捕获控制台输出？

> ID：201616
> 
> 赞同：18
> 
> 时间：2008-10-14T15:18:03.760
> 
> 标签：c#, service, console

我们有一个部署到远程客户系统的 C# 服务。应用程序将大量“诊断”信息写入控制台（即 Console.WriteLine()）。该服务没有“做它应该做的”。我们如何在另一个应用程序中捕获服务的控制台输出？

可以在客户位置加载应用程序的 WinForm 版本。不幸的是，它运行正常。

更新：

我们能够更改更改服务，但此时不希望进行重大更改。

我们还记录到 MSMQ，但仅用于“重要”事件。此服务确实与 MSMQ 交互以实现其正常操作。或者，至少应该如此。当 WinForm 版本这样做时，该服务似乎没有从 MSMQ 中提取项目。因此，编写发送到控制台的消息可能会有问题。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-10-14T15:21:10.027

您是否可以更改服务*代码*？如果是这样，使用 Console.SetOut 写入文件将是最明显的第一个调用端口。然后更改为在下一个版本中使用适当的日志库:)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-14T16:52:13.227

通常，您应该避免将诊断信息直接从应用程序代码写入控制台、事件日志、MSMQ 或其他位置。而是调用日志记录 API，并使用配置将输出重定向到您想要的任何位置。

例如，您可以将所有 Console.WriteLine 替换为 Trace.WriteLine (*)。然后，您可以通过修改应用程序配置文件将输出重定向到控制台、文件或其他地方：例如，要输出到控制台，请使用 ConsoleTraceListener，例如：

```
<configuration>
  <system.diagnostics>
    <trace autoflush="false" indentsize="4">
      <listeners>
        <add name="configConsoleListener"
             type="System.Diagnostics.ConsoleTraceListener" />
      </listeners>
    </trace>
  </system.diagnostics>
 </configuration> 
```

调试时，您将在控制台上获得输出 - 在客户站点上，您将其配置为将跟踪输出重定向到文件、事件日志或类似文件。

更好的是，使用 3rd 方日志框架（我推荐 Log4Net），它会为您提供比 System.Diagnostics.Trace 更多的选项。

(*) Trace.Write/Trace.WriteLine 与 Debug.Write/Debug.WriteLine 相同，只是后者仅在定义了 DEBUG 符号时才编译。因此，如果您希望输出在 Release 版本中可用，请首选 Trace 而不是 Debug。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-14T16:07:22.833

你有很多选择；如前所述，将控制台输出重定向到文件并使用适当的日志库是两个很好的方法。这是一个中间选项：写入事件日志。

```
EventLog log;
string logsource = "MyService";

// execute once per invocation
if (!System.Diagnostics.EventLog.SourceExists(logsource))
{
    System.Diagnostics.EventLog.CreateEventSource(
        logsource, "Application");
}
log = new EventLog();
log.Source = logsource;
log.Log = "Application";

// replace console logging with this
log.WriteEntry(message, EventLogEntryType.Information); 
```

然后在 Source = "MyService" 的应用程序事件日志（管理工具 -> 事件查看器）中查找条目。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-14T15:26:19.970

我根本不会从窗口服务中使用 Console.WriteLine。您可能应该将这些错误记录到日志文件中。

执行此操作以便多个应用程序可以使用日志的另一种方法是将日志消息发布到 MSMQ 队列。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-14T15:28:59.590

使用 debug.writeline 并使用 sysinternals debugview？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-07-08T09:44:13.577

我在 MSDN 上发现[了这篇文章](http://social.msdn.microsoft.com/Forums/en-US/winformsdatacontrols/thread/2e827551-6cbc-4b3d-a04f-e4dc6c262ae1)，它将控制台输出绑定到富文本框，对我来说非常快速和轻松。

它覆盖了 WriteLine，并且可以扩展以覆盖其他方法。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-11-19T16:45:48.453

以下是我查看在 Windows 7 下运行的服务的控制台输出的方式。如果您绝对无法修改服务的源代码以登录到文件，这可能会有所帮助。

1.  运行 services.msc 并编辑服务的属性。在“登录”选项卡上，选中“允许服务与桌面交互”

2.  使用注册表编辑器修改服务的 ImagePath：转到 HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\services\ [您的服务名称] 并编辑 ImagePath。附加`cmd.exe /c`到 ImagePath 字符串的开头。所以如果你原来的 ImagePath 是`c:\myService\myservice.exe`你的新 ImagePath 应该是`cmd.exe /c c:\myService\myservice.exe`.

3.  开始您的服务。您应该会看到一个名为“交互式服务检测”的弹出窗口。选择“查看消息”。您的屏幕应该切换上下文并显示控制台窗口。完成后，单击“立即返回”按钮。

4.  完成调试后，将 ImagePath 修改回其原始值。然后取消选中服务属性中的“允许服务与桌面交互”复选框并重新启动服务。

警告：我只使用一项服务完成了此操作，它对我有用。我不知道它是否适用于任何服务或是否会导致任何意外结果，因此我强烈建议您仅在非生产环境中执行此操作。

# mysql - 如何查看表或列的所有外键？

> ID：201621
> 
> 赞同：678
> 
> 时间：2008-10-14T15:18:49.127
> 
> 标签：mysql, foreign-keys, innodb

在 MySQL 中，如何获取指向特定表的所有外键约束的列表？特定的列？这与[这个 Oracle question](https://stackoverflow.com/questions/85978/query-a-tables-foreign-key-relationships)相同，但适用于 MySQL。

* * *

## 回答 #1

> 赞同：939
> 
> 时间：2008-10-14T15:35:13.617

**对于表：**

```
SELECT 
  TABLE_NAME,COLUMN_NAME,CONSTRAINT_NAME, REFERENCED_TABLE_NAME,REFERENCED_COLUMN_NAME
FROM
  INFORMATION_SCHEMA.KEY_COLUMN_USAGE
WHERE
  REFERENCED_TABLE_SCHEMA = '<database>' AND
  REFERENCED_TABLE_NAME = '<table>'; 
```

**对于列：**

```
SELECT 
  TABLE_NAME,COLUMN_NAME,CONSTRAINT_NAME, REFERENCED_TABLE_NAME,REFERENCED_COLUMN_NAME
FROM
  INFORMATION_SCHEMA.KEY_COLUMN_USAGE
WHERE
  REFERENCED_TABLE_SCHEMA = '<database>' AND
  REFERENCED_TABLE_NAME = '<table>' AND
  REFERENCED_COLUMN_NAME = '<column>'; 
```

基本上，我们在 where 子句中将 REFERENCED_TABLE_NAME 更改为 REFERENCED_COLUMN_NAME。

* * *

## 回答 #2

> 赞同：335
> 
> 时间：2013-06-11T16:27:32.990

编辑：正如评论中所指出的，这不是 OPs 问题的正确答案，但了解这个命令很有用。这个问题在谷歌中出现了我正在寻找的东西，并认为我会把这个答案留给其他人去寻找。

```
SHOW CREATE TABLE `<yourtable>`; 
```

我在这里找到了这个答案： [MySQL : show constraints on tables command](https://stackoverflow.com/questions/4004205/mysql-show-constraints-on-tables-command)

我需要这种方式是因为我想看看 FK 是如何运作的，而不仅仅是看看它是否存在。

* * *

## 回答 #3

> 赞同：88
> 
> 时间：2008-10-14T15:26:08.580

如果您使用 InnoDB 并定义了 FK，您可以查询 information_schema 数据库，例如：

```
SELECT * FROM information_schema.TABLE_CONSTRAINTS 
WHERE information_schema.TABLE_CONSTRAINTS.CONSTRAINT_TYPE = 'FOREIGN KEY' 
AND information_schema.TABLE_CONSTRAINTS.TABLE_SCHEMA = 'myschema'
AND information_schema.TABLE_CONSTRAINTS.TABLE_NAME = 'mytable'; 
```

* * *

## 回答 #4

> 赞同：51
> 
> 时间：2012-07-02T23:59:41.713

发布旧答案以添加一些有用的信息。

我遇到了类似的问题，但我也想查看 CONSTRAINT_TYPE 以及 REFERENCED 表和列名。所以，

1.  要查看表中的所有 FK：

    ```
    USE '<yourschema>';

    SELECT i.TABLE_NAME, i.CONSTRAINT_TYPE, i.CONSTRAINT_NAME, k.REFERENCED_TABLE_NAME, k.REFERENCED_COLUMN_NAME 
    FROM information_schema.TABLE_CONSTRAINTS i 
    LEFT JOIN information_schema.KEY_COLUMN_USAGE k ON i.CONSTRAINT_NAME = k.CONSTRAINT_NAME 
    WHERE i.CONSTRAINT_TYPE = 'FOREIGN KEY' 
    AND i.TABLE_SCHEMA = DATABASE()
    AND i.TABLE_NAME = '<yourtable>'; 
    ```

2.  要查看架构中的所有表和 FK：

    ```
    USE '<yourschema>';

    SELECT i.TABLE_NAME, i.CONSTRAINT_TYPE, i.CONSTRAINT_NAME, k.REFERENCED_TABLE_NAME, k.REFERENCED_COLUMN_NAME 
    FROM information_schema.TABLE_CONSTRAINTS i 
    LEFT JOIN information_schema.KEY_COLUMN_USAGE k ON i.CONSTRAINT_NAME = k.CONSTRAINT_NAME 
    WHERE i.CONSTRAINT_TYPE = 'FOREIGN KEY' 
    AND i.TABLE_SCHEMA = DATABASE(); 
    ```

3.  要查看数据库中的所有 FK：

    ```
    SELECT i.TABLE_SCHEMA, i.TABLE_NAME, i.CONSTRAINT_TYPE, i.CONSTRAINT_NAME, k.REFERENCED_TABLE_NAME, k.REFERENCED_COLUMN_NAME 
    FROM information_schema.TABLE_CONSTRAINTS i 
    LEFT JOIN information_schema.KEY_COLUMN_USAGE k ON i.CONSTRAINT_NAME = k.CONSTRAINT_NAME 
    WHERE i.CONSTRAINT_TYPE = 'FOREIGN KEY'; 
    ```

**记住！**

这是使用 InnoDB 存储引擎。如果您在添加后似乎无法显示任何外键，可能是因为您的表使用的是 MyISAM。

去检查：

```
SELECT * TABLE_NAME, ENGINE FROM information_schema.TABLES WHERE TABLE_SCHEMA = '<yourschema>'; 
```

要修复，请使用以下命令：

```
ALTER TABLE `<yourtable>` ENGINE=InnoDB; 
```

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2013-12-12T12:02:24.180

作为 Node 答案的替代方案，如果您使用 InnoDB 并定义了 FK，您可以查询 information_schema 数据库，例如：

```
SELECT CONSTRAINT_NAME, TABLE_NAME, REFERENCED_TABLE_NAME
FROM information_schema.REFERENTIAL_CONSTRAINTS
WHERE CONSTRAINT_SCHEMA = '<schema>'
AND TABLE_NAME = '<table>' 
```

对于来自 <table> 的外键，或

```
SELECT CONSTRAINT_NAME, TABLE_NAME, REFERENCED_TABLE_NAME
FROM information_schema.REFERENTIAL_CONSTRAINTS
WHERE CONSTRAINT_SCHEMA = '<schema>'
AND REFERENCED_TABLE_NAME = '<table>' 
```

<table> 的外键

如果需要，您还可以获取 UPDATE_RULE 和 DELETE_RULE。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2020-08-12T12:51:23.543

SQL 中的约束是为表中的数据定义的规则。约束还限制了进入表的数据类型。如果新数据不遵守这些规则，则中止操作。

```
select * from INFORMATION_SCHEMA.TABLE_CONSTRAINTS where CONSTRAINT_TYPE = 'FOREIGN KEY'; 
```

您可以使用查看所有约束`select * from information_schema.table_constraints;`

（这会产生很多表数据）。

您也可以将其用于 MySQL：

```
show create table tableName; 
```

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2013-09-16T10:36:41.797

此解决方案不仅会显示所有关系，还会显示约束名称，这在某些情况下是必需的（例如 drop constraint）：

```
select
    concat(table_name, '.', column_name) as 'foreign key',
    concat(referenced_table_name, '.', referenced_column_name) as 'references',
    constraint_name as 'constraint name'
from
    information_schema.key_column_usage
where
    referenced_table_name is not null; 
```

如果要检查特定数据库中的表，请在查询末尾添加架构名称：

```
select
    concat(table_name, '.', column_name) as 'foreign key',
    concat(referenced_table_name, '.', referenced_column_name) as 'references',
    constraint_name as 'constraint name'
from
    information_schema.key_column_usage
where
    referenced_table_name is not null
    and table_schema = 'database_name'; 
```

同样，对于特定的列名，添加

> 和 table_name = 'table_name

在查询结束时。

受这篇文章的启发[在这里](http://www.binarytides.com/list-foreign-keys-in-mysql/)

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2015-02-05T23:51:26.757

使用 REFERENCED_TABLE_NAME 并不总是有效，并且可以是 NULL 值。以下查询可以代替：

```
select * from INFORMATION_SCHEMA.KEY_COLUMN_USAGE where TABLE_NAME = '<table>'; 
```

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2013-06-13T02:37:19.157

使用

```
KEY_COLUMN_USAGE view:

SELECT CONCAT( table_name, '.',
column_name, ' -> ',
referenced_table_name, '.',
referenced_column_name ) AS list_of_fks
FROM information_schema.KEY_COLUMN_USAGE
WHERE REFERENCED_TABLE_SCHEMA = (your schema name here)
AND REFERENCED_TABLE_NAME is not null
ORDER BY TABLE_NAME, COLUMN_NAME; 
```

此查询确实假定约束以及所有引用和引用的表都在同一个模式中。

添加您自己的评论。

来源：mysql官方手册。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2020-07-23T08:30:28.467

我不愿再添加另一个答案，但我不得不乞求、借用和窃取他人以获得我想要的东西，这是给定模式中表上所有 FK 关系的完整列表，包括 FK 到其他模式中的表。两个关键记录集是 information_schema.KEY_COLUMN_USAGE 和 information_schema.referential_constraints。如果缺少所需的属性，只需取消注释 KCU。*, 钢筋混凝土。*看看有什么可用的

```
SELECT DISTINCT KCU.TABLE_NAME, KCU.COLUMN_NAME, REFERENCED_TABLE_SCHEMA, KCU.REFERENCED_TABLE_NAME, KCU.REFERENCED_COLUMN_NAME, UPDATE_RULE, DELETE_RULE #, KCU.*, RC.*
FROM information_schema.KEY_COLUMN_USAGE KCU
INNER JOIN information_schema.referential_constraints RC ON KCU.CONSTRAINT_NAME = RC.CONSTRAINT_NAME
WHERE TABLE_SCHEMA = (your schema name)
AND KCU.REFERENCED_TABLE_NAME IS NOT NULL
ORDER BY KCU.TABLE_NAME, KCU.COLUMN_NAME; 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-10-14T15:35:08.530

我想出的解决方案很脆弱；它依赖于 django 的外键命名约定。

```
USE information_schema;
tee mysql_output
SELECT * FROM TABLE_CONSTRAINTS WHERE CONSTRAINT_TYPE = 'FOREIGN KEY' AND TABLE_SCHEMA = 'database_name';
notee 
```

然后，在外壳中，

```
grep 'refs_tablename_id' mysql_output 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2014-12-15T03:38:17.980

查找**包含特定外键的**所有表，例如`employee_id`

```
SELECT DISTINCT TABLE_NAME 
FROM INFORMATION_SCHEMA.COLUMNS
WHERE COLUMN_NAME IN ('employee_id')
AND TABLE_SCHEMA='table_name'; 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2017-08-09T18:40:02.290

如果您还想获取外键列的名称：

```
SELECT i.TABLE_SCHEMA, i.TABLE_NAME, 
       i.CONSTRAINT_TYPE, i.CONSTRAINT_NAME, 
       k.COLUMN_NAME, k.REFERENCED_TABLE_NAME, k.REFERENCED_COLUMN_NAME 
  FROM information_schema.TABLE_CONSTRAINTS i 
  LEFT JOIN information_schema.KEY_COLUMN_USAGE k 
       ON i.CONSTRAINT_NAME = k.CONSTRAINT_NAME 
 WHERE i.TABLE_SCHEMA = '<TABLE_NAME>' AND i.CONSTRAINT_TYPE = 'FOREIGN KEY' 
 ORDER BY i.TABLE_NAME; 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2021-05-31T20:26:52.130

我需要对表之间的关系有一个鸟瞰图（在 ORM 中使用）。使用此页面的建议，经过试验，我整理了以下查询：

```
SELECT
    KCU.CONSTRAINT_NAME,
    KCU.TABLE_NAME,
    KCU.COLUMN_NAME,
    KCU.REFERENCED_TABLE_NAME,
    KCU.REFERENCED_COLUMN_NAME
FROM
    INFORMATION_SCHEMA.KEY_COLUMN_USAGE AS KCU
    JOIN INFORMATION_SCHEMA.COLUMNS AS COLS
        ON
                COLS.TABLE_SCHEMA = KCU.TABLE_SCHEMA
            AND COLS.TABLE_NAME   = KCU.TABLE_NAME
            AND COLS.COLUMN_NAME  = KCU.COLUMN_NAME
WHERE
        KCU.CONSTRAINT_SCHEMA = {YOUR_SCHEMA_NAME}
    AND KCU.REFERENCED_TABLE_NAME IS NOT NULL
ORDER BY
    KCU.TABLE_NAME,
    COLS.ORDINAL_POSITION 
```

它只返回我需要的东西，并按照我想要的顺序。

我还对结果进行了少量处理（将其转换为某种字典），以便可以将其用于创建聚合。

# linq-to-sql - Linq To SQL - 如何拥有不是来自表而是来自数据库的属性

> ID：201636
> 
> 赞同：1
> 
> 时间：2008-10-14T15:22:39.383
> 
> 标签：linq-to-sql

我们将 Linq To SQL 与我们自己的数据上下文逻辑一起使用，该逻辑在多个数据库中执行一个 linq 查询。当我们得到结果时，我们需要每一行的数据库。所以...

我想在我的类上有一个属性，它将返回数据库名称（SQL Server，所以 DB_NAME()）。如何在 Linq To Sql 中执行此操作？

**注意：我们有数百个数据库，不想在每个数据库中放置视图。返回应该作为返回结果集每一行的另一个属性返回。**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-23T22:32:05.360

在 DBML XML 文件中，您可以将 Column 元素的 Expression 属性设置为：

```
 <Column Name="Table1.DBName" 
         DbType="nvarahcar(128)" 
         Type="System.String" 
         Expression="DB_NAME()" /> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-23T20:52:32.770

您如何遍历不同的数据库？您能否仅在查询中包含来自上下文的信息？例如：

```
Dim results = _
    From x In myContext.MyTables _
    Select x, info = myContext.Connection.ConnectionString 
```

# winapi - WIN32 API WM_REFLECT 消息的用途是什么？

> ID：201654
> 
> 赞同：6
> 
> 时间：2008-10-14T15:28:26.547
> 
> 标签：winapi

即使在 MSDN 上，我也找不到它的文档...

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-14T11:59:16.280

不是Win32；这是MFC。通常，Win32 控件通过向其父窗口发送消息来引发事件。但是，如果您从 MFC 的包装器之一派生了自己的类（例如，您已经用 CMyFunkyTreeCtrl 包装了 CTreeCtrl），您可能希望在派生类中处理这些事件。

MFC 使用这些反射消息将事件反弹回类本身，您的派生类可以在其中看到它们。

查看[TN062：Windows 控件 (MFC) 的消息反射以](http://msdn.microsoft.com/en-us/library/eeah46xd.aspx)获取更多信息。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-14T15:33:04.963

这里有一些推理：
[http ://www.tech-archive.net/Archive/VC/microsoft.public.vc.language/2005-08/msg00589.html](http://www.tech-archive.net/Archive/VC/microsoft.public.vc.language/2005-08/msg00589.html)

# c# - 是否有可用的 .NET 工具/插件可以让您轻松地重新排列类中区域、子类、函数和成员变量的顺序？

> ID：201656
> 
> 赞同：0
> 
> 时间：2008-10-14T15:29:01.103
> 
> 标签：c#, asp.net, vb.net, visual-studio, add-in

我正在寻找一个 .NET 加载项，它读取当前文档窗口的内容，列出所有区域、子项、函数和模块级变量的标题声明，并提供一个简单的上移/下移按钮重新排列他们的顺序。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-14T17:51:27.710

我发现[Resharper](http://www.jetbrains.com/resharper/)插件提供的“文件结构窗口”提供了您正在寻找的大部分功能。但是，它是综合重构插件的一部分，这可能不适合您。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T15:35:12.650

我还没有使用它（因为我通常只是自己在区域中编写代码，或者等到我对继承的项目进行其他重构），但[Regionerate](http://www.rauchy.net/regionerate/)看起来不错。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T18:53:37.477

这是一个可与[DXCore](http://www.devexpress.com/Downloads/Visual_Studio_Add-in/DXCore/)一起使用的自动成员组织插件。您还可以看到 Mark Miller 在 dnrTV 中开发此插件。

[http://dnrtv.com/default.aspx?showID=5](http://dnrtv.com/default.aspx?showID=5)

# .net - 如何在 .NET 中轻松取消转义 XML 实体

> ID：201660
> 
> 赞同：2
> 
> 时间：2008-10-14T15:30:26.280
> 
> 标签：.net, asp.net, xml

我有一些返回 XMLNode 的 InnerXML 的代码。

该节点可以只包含一些文本（带有 HTML）或 XML。

例如：

```
<XMLNode>
    Here is some &lt;strong&gt;HTML&lt;/strong&gt;
<XMLNode> 
```

或者

```
<XMLNode>
    <XMLContent>Here is some content</XMLContnet>
</XMLNode> 
```

如果我得到`<XmlNode>`HTML 标记的 InnerXML，则作为 XML 实体返回。

我不能使用 InnerText，因为我需要能够获取 XML 内容。所以我真正需要的是一种取消转义 HTML 标签的方法，因为我可以检测它是否是 XML 并采取相应的行动。

我想我可以使用 HTMLDecode，但这会解码所有 XML 编码的实体吗？

**更新：**我想我在上面有点漫无边际，所以这里有一个澄清的场景：

我有一个如下所示的 XML 文档：

```
<content id="1">
    <data>&lt;p&gt;A Test&lt;/p&gt;</data>
</content id="2">
<content>
    <data>
        <dataitem>A test</dataitem>
    </data>
</content> 
```

如果我做：

```
XmlNode xn1 = document.SelectSingleNode("/content[@id=1]/data");
XmlNode xn2 = document.SelectSingleNode("/content[@id=2]/data");

Console.WriteLine(xn1.InnerXml);
Console.WriteLine(xn2.InnerXml); 
```

xn1 将返回

```
 &lt;p&gt;A Test&lt;/p&gt; 
```

xn2 将返回`<dataitem>A test</dataitem>`

我已经在检查返回的内容是否是 XML（在 xn2 的情况下），所以我需要做的就是取消转义`&lt;`xn1 中的 etc。

HTMLDecode 这样做，但我不确定它是否适用于所有事情。所以问题仍然存在，HTMLDecode 是否会处理所有可能的实体，或者是否有某个类可以为我做这件事。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T15:33:30.453

为什么不将它们插入为 < 和> ? 您避免将 xml 和自定义标记内容与此混合...

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T16:02:57.837

你的问题有点难以理解。以下是我不完全理解的事情：

1.  如果您使用的是 XmlNode/XmlElement 对象，那么您使用的是 XML，而不是 HTML。因此，您只能拥有 XML 元素。这些可能有 HTML 元素名称，但它们*是*XML。
2.  InnerXml 返回一个字符串，至少对于 XmlElement 对象是这样。你在做什么？
3.  您希望从操作中获得哪些数据？你能举例说明你需要什么吗？
4.  当您拥有数据时，您究竟打算如何处理这些数据？也许有比您的想法更好的方法来实现您的目标？

* * *

**编辑**

我想我明白了，但如果我仍然错了，请纠正我。你想拔出`"<p>A Test</p>"`来`xn1`，却`"A test"`拔出来`xn2`。

所以`InnerXml`是要走的路`xn1`，而且`InnerText`是正确的`xn2`。

那就那样做吧——测试它的存在`dataitem`并在你知道的时候决定做什么。

```
XmlNode xn = document.SelectSingleNode("/content[@id=1]/data");

if (xn.SelectSingleNode("dataitem") == null)
  Console.WriteLine(xn.InnerXml);
else
  Console.WriteLine(xn.InnerText); 
```

`HttpUtility.HtmlDecode`为了回答您关于`InnerXml`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-15T18:56:14.740

我认为 Tomalak 是在正确的轨道上，但我会编写代码有点不同：

```
 XmlNode xn = document.SelectSingleNode("/content[@id=1]/data");
        if (xn.ChildNodes.Count != 1)
        {
            throw new InvalidOperationException("I don't know what to do if there's not exactly one child node.");
        }
        XmlNode child = xn.ChildNodes[0];
        switch (child.NodeType)
        {
            case XmlNodeType.Element:
                Console.WriteLine(xn.InnerXml);
                break;
            case XmlNodeType.Text:
                Console.WriteLine(xn.Value);
                break;
            default:
                throw new InvalidOperationException("I can only handle elements and text nodes.");
        } 
```

这段代码使您的许多隐含假设变得明确，当您遇到不符合您期望形式的数据时，它会告诉您失败的原因。

# .net - 是否可以在同一进程中加载 两个版本的 .NET 运行时？

> ID：201663
> 
> 赞同：5
> 
> 时间：2008-10-14T15:32:01.877
> 
> 标签：.net, runtime, versioning, clr-hosting

我需要澄清两种情况：

1.  使用 .NET 3.5 编译的可执行文件需要使用使用 .NET 1.1 编译的库，并且该库必须在 1.1 运行时上运行。

2.  使用 .NET 1.1 编译的可执行文件需要使用使用 .NET 3.5 编译的库。

我找不到可靠的消息来源说明无法加载两个版本的 .NET 运行时，并且 Microsoft 的文档在此问题上非常含糊。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-14T15:36:32.227

不——您不能将 CLR 加载到同一个进程中两次。请参阅[CLR 托管的文档](http://msdn.microsoft.com/en-us/library/zaf1h1h5.aspx)

> 与运行时的早期版本一样，CorBindToRuntimeEx 函数初始化运行时。您可以选择要加载哪个版本的运行时，但**一个进程只能** **承载一个版本**。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-01-14T11:07:07.733

.NET 4 承诺通过[In-Process Side by Side](http://blogs.msdn.com/clrteam/archive/2009/06/03/in-process-side-by-side-part1.aspx)的方式在同一进程中托管不同的 CLR 版本。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-14T15:52:47.637

对于案例 #1，是否有任何特殊原因（例如，重大更改）需要将库托管在 1.1 运行时中？是否可以通过 1.1 编译的 Web 服务公开库，并让可执行文件指向 Web 服务？（或者其他一些远程技术，让图书馆在自己的进程中？）

对于案例 #2，是否可以在 2.0/3.5 下重新编译 1.1 应用程序，使其可以驻留在同一进程中？

无论如何，Rob Walker 是对的（我赞成）——您根本不能在同一个进程中托管 2 个版本的运行时。所以你需要以某种方式解决它。我想在这两种情况下，源代码都必须可用，因此应该重新编译和重新测试。

# database - 如何对使用嵌套集模型存储的树进行排序？

> ID：201671
> 
> 赞同：18
> 
> 时间：2008-10-14T15:33:29.190
> 
> 标签：database, tree, hierarchy, nested-sets

当我提到嵌套集模型时，我指的是[这里描述的内容。](http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/)

我需要构建一个新系统，用于在用户定义的层次结构中存储“类别”（我想不出更好的词来形容它）。由于嵌套集模型针对读取而不是写入进行了优化，因此我决定使用它。不幸的是，在我对嵌套集的研究和测试过程中，我遇到了如何显示带有排序节点的层次树的问题。例如，如果我有层次结构：

```
root
    finances
        budgeting
            fy08
    projects
        research
        fabrication
        release
    trash 
```

我希望对其进行排序，使其显示为：

```
root
    finances
        budgeting
            fy08
    projects
        fabrication
        release
        research
    trash 
```

请注意，制造出现在研究之前。

无论如何，经过长时间的搜索，我看到了诸如“将树存储在多维数组中并对其进行排序”和“将树重新排序并序列化回您的嵌套集合模型”之类的答案（我在解释......）。无论哪种方式，第一个解决方案都是对 RAM 和 CPU 的可怕浪费，它们都是非常有限的资源……第二个解决方案看起来像是很多痛苦的代码。

无论如何，我能够弄清楚如何（使用嵌套集模型）：

1.  在 SQL 中启动新树
2.  插入一个节点作为树中另一个节点的子节点
3.  在树中的兄弟节点之后插入一个节点
4.  从 SQL 中拉出具有层次结构的整个树
5.  从层次结构中的特定节点（包括根节点）拉取子树，有或没有深度限制
6.  查找树中任何节点的父节点

所以我想#5 和#6 可以用来做我想要的排序，它也可以用来按排序顺序重建树。

然而，现在我已经查看了所有这些我学会做的事情，我发现#3、#5 和#6 可以一起使用来执行排序插入。如果我做了排序插入，它总是被排序。但是，如果我改变了排序标准或者我想要一个不同的排序顺序，我就会回到原点。

这可能只是嵌套集模型的限制吗？它的使用是否会抑制输出的查询排序？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-14T20:47:23.737

我认为这确实是嵌套集模型的一个限制。您不能轻易地在它们各自的父节点中对子节点进行排序，因为结果集的排序对于重构树结构至关重要。

我认为这可能是在插入、更新或删除节点时保持树排序的最佳方法。这甚至使查询变得非常快，这是这种数据结构的主要目标之一。如果你对所有操作都实现了存储过程，那么它非常容易使用。

您还可以反转预排序树的排序顺序。你只需要使用`ORDER BY node.rgt DESC`而不是`ORDER BY node.lft ASC`.

如果您确实需要支持另一个排序标准，您可以通过向每个节点添加第二个`lft`和`rgt`索引来实现它，并在每次插入/更新/删除时保持按其他标准排序。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-20T16:22:39.213

我经常使用嵌套集，并且经常遇到同样的问题。我所做的以及我会推荐的只是不对数据库中的项目进行排序。而是在用户界面中对它们进行排序。从数据库中提取所有节点后，无论如何，您可能必须将它们转换为某种分层数据结构。在该结构中，对包含该节点子节点的所有数组进行排序。

例如，如果您的前端是 Flex 应用程序，并且节点的子节点存储在 ICollectionView 中，您可以使用 sort 属性让它们以您想要的方式显示。

另一个例子，如果您的前端是 PHP 脚本的一些输出，您可以将每个节点的子节点放在一个数组中，并使用 PHP 的数组排序函数来执行排序。

当然，这仅在您不需要对实际的数据库条目进行排序时才有效，但是您呢？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-19T12:21:33.287

我刚刚写完以下内容，这对我来说可以对整个嵌套集合树进行排序。

排序（理想情况下）需要一个列出树中每个节点的当前级别的视图和交换两个节点的过程 - 两者都包含在下面，兄弟交换代码来自我强烈推荐的 Joe Celkos 的 Tree & Hierarchies 书任何使用嵌套集的人。

可以在“INSERT INTO @t”语句中更改排序，这里是对“名称”的简单字母数字排序

这可能是一种糟糕的方法，尤其是使用基于集合的代码的光标，但正如我所说，它对我有用，希望它有所帮助。

**更新：**

下面的代码现在显示不使用游标的版本。我看到大约 10 倍的速度提升

```
CREATE VIEW dbo.tree_view

AS

SELECT t2.NodeID,t2.lft,t2.rgt ,t2.Name, COUNT(t1.NodeID) AS level  
FROM dbo.tree t1,dbo.tree t2
WHERE t2.lft BETWEEN t1.lft AND t1.rgt
GROUP BY t2.NodeID,t2.lft,t2.rgt,t2.Name

GO

----------------------------------------------

  DECLARE @CurrentNodeID int
DECLARE @CurrentActualOrder int
DECLARE @CurrentRequiredOrder int
DECLARE @DestinationNodeID int
DECLARE @i0 int
DECLARE @i1 int
DECLARE @i2 int
DECLARE @i3 int

DECLARE @t TABLE (TopLft int,NodeID int NOT NULL,lft int NOT NULL,rgt int NOT NULL,Name varchar(50),RequiredOrder int NOT NULL,ActualOrder int NOT NULL)

INSERT INTO @t (toplft,NodeID,lft,rgt,Name,RequiredOrder,ActualOrder)
    SELECT tv2.lft,tv1.NodeID,tv1.lft,tv1.rgt,tv1.Name,ROW_NUMBER() OVER(PARTITION BY tv2.lft ORDER BY tv1.ColumnToSort),ROW_NUMBER() OVER(PARTITION BY tv2.lft ORDER BY tv1.lft ASC)
    FROM dbo.tree_view tv1 
    LEFT OUTER JOIN dbo.tree_view tv2 ON tv1.lft > tv2.lft and tv1.lft < tv2.rgt and tv1.level = tv2.level+1
    WHERE tv2.rgt > tv2.lft+1

    DELETE FROM @t where ActualOrder = RequiredOrder

WHILE EXISTS(SELECT * FROM @t WHERE ActualOrder <> RequiredOrder)
BEGIN

    SELECT Top 1 @CurrentNodeID = NodeID,@CurrentActualOrder = ActualOrder,@CurrentRequiredOrder = RequiredOrder
    FROM @t 
    WHERE ActualOrder <> RequiredOrder
    ORDER BY toplft,requiredorder

    SELECT @DestinationNodeID = NodeID
    FROM @t WHERE ActualOrder = @CurrentRequiredOrder AND TopLft = (SELECT TopLft FROM @t WHERE NodeID = @CurrentNodeID) 

    SELECT @i0 = CASE WHEN c.lft < d.lft THEN c.lft ELSE d.lft END,
            @i1 =  CASE WHEN c.lft < d.lft THEN c.rgt ELSE d.rgt END,
            @i2 =  CASE WHEN c.lft < d.lft THEN d.lft ELSE c.lft END,
            @i3 =  CASE WHEN c.lft < d.lft THEN d.rgt ELSE c.rgt END
    FROM dbo.tree c
    CROSS JOIN dbo.tree d
    WHERE c.NodeID = @CurrentNodeID AND d.NodeID = @DestinationNodeID

    UPDATE dbo.tree
    SET lft = CASE  WHEN lft BETWEEN @i0 AND @i1 THEN @i3 + lft - @i1
                    WHEN lft BETWEEN @i2 AND @i3 THEN @i0 + lft - @i2
            ELSE @i0 + @i3 + lft - @i1 - @i2
            END,
        rgt = CASE  WHEN rgt BETWEEN @i0 AND @i1 THEN @i3 + rgt - @i1
                    WHEN rgt BETWEEN @i2 AND @i3 THEN @i0 + rgt - @i2
            ELSE @i0 + @i3 + rgt - @i1 - @i2
            END
    WHERE lft BETWEEN @i0 AND @i3 
    AND @i0 < @i1
    AND @i1 < @i2
    AND @i2 < @i3

    UPDATE @t SET actualorder = @CurrentRequiredOrder where NodeID = @CurrentNodeID
    UPDATE @t SET actualorder = @CurrentActualOrder where NodeID = @DestinationNodeID

    DELETE FROM @t where ActualOrder = RequiredOrder

END 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-15T11:55:45.353

是的，这是嵌套集模型的限制，因为嵌套集是层次结构的预排序表示。这种预购是阅读速度如此之快的原因。邻接模型（也在您链接到的页面上进行了描述）提供了最灵活的排序和过滤，但对性能有显着影响。

我在嵌套集中插入和移动的首选方法是像在邻接模型中一样处理受影响的分支：获取新兄弟的列表；在列表中找到新节点的正确位置；并构造所需的更新语句（这是您真正需要小心的地方）。至于改变你的订购标准：这是一个一次性的工作，所以你可以负担得起一些 RAM 和 CPU，最灵活的答案是将嵌套集表示分解为邻接表示并重建嵌套集基于新标准的邻接。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-02-04T11:28:18.590

I believe that, in your case, where the nodes you want to swap don't have any descendants, you can simply swap the lft and rgt values around. Consider this tree:

```
 A
 /   \
B     C
     / \
    D   E 
```

This could turn into this group of nested sets:

```
1 A 10 
2 B 3  
4 C 9
5 D 6
7 E 8 
```

Now consider you want to swap D and E. The following nested sets are valid and D and E are swapped:

```
1 A 10
2 B 3 
4 C 9 
7 D 8
5 E 6 
```

Swapping nodes that have subtrees cannot be done this way, of course, because you would need to update the childrens' lft and rgt values as well.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-12-08T00:27:11.667

从我的课堂方法中查看我的简单解决方案。$this->table->order 是从 DB 获取数据的 Nette 框架代码。

```
$tree = Array();
$parents = Array();
$nodes = $this->table->order('depth ASC, parent_id ASC, name ASC');
$i = 0;
$depth = 0;
$parent_id = 0;

foreach($nodes as $node) {
    if($depth < $node->depth || $parent_id < $node->parent_id) {
        $i = $parents["{$node->parent_id}"] + 1;
    }
    $tree[$i] = $node;
    $parents["{$node->id}"] = $i;
    $depth = $node->depth;
    $parent_id = $node->parent_id;
    $i += (($node->rgt - $node->lft - 1) / 2) + 1;
}
ksort($tree); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-11-10T10:18:29.223

您可以在渲染时对其进行排序。我在这里解释了渲染[如何将嵌套集中的所有记录渲染到真正的 html 树中](https://stackoverflow.com/questions/1372366/how-to-render-all-records-from-a-nested-set-into-a-real-html-tree/3052506#3052506)

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2011-01-20T19:42:59.603

对嵌套集进行排序没有限制，也不难。只需按左边的凉亭（锚，随便）排序，就完成了。如果每个节点都有一个级别，您还可以根据级别拉出正确的缩进。

# c# - 使用 C# 和 WinForms 在自己的进程中创建选项卡

> ID：201674
> 
> 赞同：7
> 
> 时间：2008-10-14T15:33:39.547
> 
> 标签：c#, winforms, process

> **可能重复**
> [的 Windows 窗体应用程序，例如具有多个进程的 Google Chrome](https://stackoverflow.com/questions/197182/windows-forms-application-like-google-chrome-with-multiple-processes)
> [Chrome / IE8 多进程设计，在 .NET 中是否可能？](https://stackoverflow.com/questions/628744/chrome-ie8-multi-process-design-is-it-possible-in-net)
> [Google Chrome 等多进程 C# 应用程序示例](https://stackoverflow.com/questions/5664071/sample-for-multi-process-c-sharp-app-like-google-chrome)

IE8 和 Google Chrome 浏览器[对于打开的每个选项卡都有单独的进程](http://www.hanselman.com/blog/MicrosoftIE8AndGoogleChromeProcessesAreTheNewThreads.aspx)。

例如，您启动 IE8 并在各自的选项卡中打开 Yahoo 和 Google，您最终会在系统上运行 3 个进程：

*   IE8自身进程【主进程】
    *   谷歌标签过程
    *   雅虎标签流程

我在玩 C#/WinForms 中类似的东西的想法。

举个简单的例子：我有一个显示表单的主进程，我在子进程中有一个按钮。我们如何将其他进程中的 Button 渲染到我的表单上？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T15:37:45.810

这听起来不像是个好主意。winforms 通用控件大部分不是线程安全的，并且给每个控件自己的进程似乎很讨厌。

如果你想试试这个，也许给每个*表单*它自己的进程，甚至只是它自己的线程。或者，如果您有一个选项卡控件，那么只需为每个选项卡提供自己的线程。

**Update**
.Net 提供了可以使用的称为 AppDomain 的东西。它不仅仅是一个线程，而是一个进程。如果您有一个带有多个标签页的 from，您可以创建一个自定义控件来保存每个标签页的内容，并将每个自定义控件放在它自己的程序集中。然后可以将这些程序集动态加载到它们自己的 AppDomain 中。从那里您应该能够创建所需控件的实例。但是，关于跨 appdomains 的交谈有一些规则，所以我不知道您是否能够将该控件添加到表单上的选项卡页。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T15:41:44.820

chrome 为每个选项卡提供自己的进程的原因是沙盒。如果一个选项卡的行为异常，则不太可能关闭整个浏览器。您的应用程序中是否有类似的需求？

另外，请注意浏览器选项卡不需要共享信息。选项卡上的内容就在选项卡上，没有其他选项卡需要关心它。您的 winforms 应用程序是否也有类似的划分？

# tomcat - 如何在Tomcat中集成Geronimo的事务管理器？

> ID：201680
> 
> 赞同：1
> 
> 时间：2008-10-14T15:36:00.073
> 
> 标签：tomcat, jta, geronimo, transactionmanager

Geronimo 是否提供独立的事务管理器？如果可以，是否可以在 Tomcat 中使用它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-07T07:19:07.630

[Apache OpenEJB](http://openejb.apache.org/)是 Geronimo EJB 容器的嵌入式实现，其中包括事务管理器。OpenEJB 可以嵌入到 Tomcat 中，这是其预期用途之一。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-01-02T12:10:34.283

如果您特别想要 Geronimo TX 管理器，请参阅 @topchef 的回答。

但是，如果您只是在寻找一个免费的开源 TX 管理器，那么[JOTM](http://jotm.ow2.org/)是一个很好地嵌入到 Tomcat 中的 TX 管理器。

不过，我应该问你为什么需要这个。如果您需要做的只是针对单个 JDBC 事务`DataSource`，那么您不需要 TX 管理器。如果您想进行完整的 JTA 事务，您只需要一个。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-07-26T05:19:54.090

AFAIK，Geronimo 使用可以独立使用的[Jencks 。](http://jencks.codehaus.org/Transaction+Manager)但我不能说它有大量的记录。我宁愿考虑使用[Atomikos](http://www.atomikos.com/)或[JBossTM](http://www.jboss.org/jbosstm/)。

### 相关答案

*   [Atomikos vs JOTM vs Bitronix vs ????](https://stackoverflow.com/questions/2978207/atomikos-vs-jotm-vs-bitronix-vs/2978402#2978402)

# javascript - 最好的 jQuery 状态消息插件？

> ID：201684
> 
> 赞同：42
> 
> 时间：2008-10-14T15:37:00.993
> 
> 标签：javascript, jquery, plugins, jquery-plugins, user-interface

什么是最好的 jQuery 状态消息插件？

我喜欢[jGrowl](http://plugins.jquery.com/project/jgrowl)和[Purr](http://plugins.jquery.com/project/purr)，但是 jGrowl 没有保持粘性的功能（不会自动关闭），而且 Purr 在 IE 6 中似乎不能正常工作。

我想显示这样的消息...网站即将停机进行维护，您的某某工作已经完成，诸如此类。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2010-12-02T23:45:31.967

几个选项...

*   [Humanized Messages](http://code.google.com/p/humanmsg/) ( ~~[demo](http://binarybonsai.com/misc/humanmsg/)~~ , 3 KB) 看起来很酷，并且有很好的历史展示
*   [Pines Notify](http://sciactive.github.io/pnotify/) (13 KB) 可高度自定义并支持 jQuery UI 主题
*   [jGrowl](https://github.com/stanlemon/jGrowl) (6 KB) 实际上有一个粘性选项 - 使用 {sticky: true }

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-10-14T15:42:51.027

jGrowl 看起来确实很粘 - 请参阅演示页面中的示例 2：

[https://github.com/stanlemon/jGrowl](https://github.com/stanlemon/jGrowl)

...啊 - 或者你的意思是在页面重新加载之后？

然后，我将在服务器端处理这个问题——即包含一个 sitedown.js，每次访问任何页面时都会触发咆哮通知。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-10-15T22:05:04.123

我真的很喜欢这个humanmessage 插件。您可以对其进行自定义以使其停留更长时间并更改外观等-

[http://code.google.com/p/humanmsg/](http://code.google.com/p/humanmsg/)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-02-13T10:55:11.607

按照我喜欢的顺序

*   [注意http://needim.github.com/noty/](http://needim.github.com/noty/) 6kb | 需要 jQuery | Github

*   人道-JS [https://github.com/wavded/humane-js](https://github.com/wavded/humane-js) | [演示](http://wavded.github.com/humane-js/)| GitHub

*   JQuery UI Growl 通知 [http://www.erichynds.com/jquery/a-jquery-ui-growl-ubuntu-notification-widget/](http://www.erichynds.com/jquery/a-jquery-ui-growl-ubuntu-notification-widget/)

*   松树通知[http://pinesframework.org/pnotify/](http://pinesframework.org/pnotify/) 15KB | SourceForge-Mercurial

*   SmokeJS [https://github.com/jyoungblood/smoke.js](https://github.com/jyoungblood/smoke.js) | Github

*   js 消息[http://dhtmlx.github.com/message/](http://dhtmlx.github.com/message/) 4KB | 麻省理工学院 | GitHub

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-01-19T14:34:25.593

我们已经开始使用[http://boedesign.com/demos/gritter/](http://boedesign.com/demos/gritter/)并且不得不说它比其他开箱即用的产品更好地实现了 osx 咆哮的感觉。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-10-23T05:24:43.610

我们发现以下来自 west-wind 的简单代码对我们的项目非常有帮助。

[http://www.beyondweblogs.com/post/Display-Fancy-Status-Message-using-JQuery.aspx](http://www.beyondweblogs.com/post/Display-Fancy-Status-Message-using-JQuery.aspx)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-05-03T05:24:33.777

*   我之前使用过 jQuery *Noty*插件，但在 v2 之后它不使用 css 文件。如果你使用不同的选项，你应该包含太多的 js 文件。
*   Toastr 是一个不错的选择。用法简单，是积极开发的项目。
    它具有 top-full-width 和 bottom-full-width 选项，无需使用任何其他 js 文件。

    回购：[https](https://github.com/CodeSeven/toastr)
    ://github.com/CodeSeven/toastr 演示：[http ://codeseven.github.io/toastr/](http://codeseven.github.io/toastr/)

*   Pnotify 是一个非常详细且易于使用的插件。它有太多看起来很有趣的选项，并且有一个非常有用的演示页面。

    回购：[https](https://github.com/sciactive/pnotify)
    ://github.com/sciactive/pnotify 演示： http: [//pinesframework.org/pnotify/#demos-simple](http://pinesframework.org/pnotify/#demos-simple)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-14T15:50:03.603

这是一个 Outlook 弹出式通知 jQuery 小部件：

> *   [jQuery.UI Messenger\Outlook 之类的消息通知小部件](http://mosesofegypt.net/post/2008/07/16/jQueryui-Messenger-Outlook-like-message-notification-Widget.aspx)
> 
> > *   [演示](http://mosesofegypt.net/samples00/jQueryNotificationMessage/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-04-07T21:51:16.697

这里有一个非常好的人性化消息：[http ://www.websanova.com/plugins/humanmsg/jquery#websanova](http://www.websanova.com/plugins/humanmsg/jquery#websanova)

# sql - Linq to SQL：选择优化

> ID：201686
> 
> 赞同：6
> 
> 时间：2008-10-14T15:38:18.883
> 
> 标签：sql, performance, linq-to-sql

在 MSSQL 中的大表上；选择特定列会提高查询速度。这同样适用于 Linq to SQL 吗？

这会：

```
var person = from p in [DataContextObject].Persons
             where p.PersonsID == 1
             select new { p.PersonsID, p.PersonsAdress, p.PersonsZipcode }; 
```

比这更快：

```
var person = from p in [DataContextObject].Persons
             where p.PersonsID == 1
             select p; 
```

... ?

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-14T15:43:00.917

我强烈推荐[LinqPad](http://linqpad.net/)。它是免费的，可让您动态运行 LINQ 查询。当您还可以查看生成的 SQL 时。

您将看到 LINQ 查询将第一个查询转换为仅选择那些列。所以它更快。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-14T15:40:03.437

如果您通过仅选择几个特定列来限制结果集的大小，那么 YES 会产生影响。

**编辑**评论中的广告澄清

这如何更好，它将减少从 SQL 返回的结果数据的大小，并将减少用于将结果存储在内存中的对象的大小。

这是因为最终 LINQ to SQL 生成 SQL，因此存在相同的性能优势。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-14T16:03:45.087

这里有“更快”的三个方面。

1.  更少的数据传输意味着更快。另一方面，它不会变得那么快，除非您选择多行或者如果您的 Person 包含其他一些“重”列 - 长 varchars、图像等*。*
2.  正如 J. Curran 指出的那样，分配的内存越少意味着速度越快。与 1\. 相同的注释适用于此。

3.  如果您有一个包含所有选定列的索引（或从 SQL Server 2005 开始附加到它），您的查询执行速度会更快。在这种情况下，SQL Server 引擎不需要在内存中加载包含行的页面——如果它还没有的话。

就个人而言，我不会费心尝试以这种方式优化我的查询（除非，正如我所说，您的行包含您不需要的二进制数据或非常长的字符串），部分原因是如果您稍后决定您想要更多有关此选定人员的信息，您将需要更改您的数据库访问代码，而不是仅访问您的 POCO/匿名类中的属性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-14T15:41:33.370

我认为这同样适用，因为 LINQ to SQL 将 Linq 查询操作转换为 SQL 命令。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-14T15:44:45.813

除了其他人所说的之外，新的未命名结构将是一个比 Person 对象轻得多的对象——即使您选择了所有列，它也会快得多。（人有方法/字段等来支持将对象写回数据库。未命名的类型没有。）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-15T20:42:04.543

如果您有非常大的列（例如二进制文件和图像），那么它可能会产生显着差异，这就是为什么 LINQ to SQL 允许您为某些列指定延迟加载，以便您仍然可以选择整个对象而无需执行“选择新”投影.

# asp.net - 如何在用户离开 ASP.NET 应用程序时进行审核

> ID：201696
> 
> 赞同：2
> 
> 时间：2008-10-14T15:41:35.507
> 
> 标签：asp.net, events, audit

在 ASP.NET 中，我正在寻找一种方法来审核离开我的应用程序的用户。具体来说，当用户的会话因任何原因被放弃/破坏时（不一定是因为对 session.abandon 的调用），我想在 SQL Server 的审计表中插入一条“注销”记录

我有一个管理会话设置器/获取器的“SessionHelper”类。

我已经尝试在 Global.asax 的 Session_End 中发回消息，但即使在超时过期后它也从未触发过此事件。

我尝试在 SessionHelper 类中覆盖“finalize”，并在该类被销毁时在那里执行它，但它也没有触发该事件。

我会尝试在 SessionHelper 中实现 IDisposable，但我不知道在哪里调用它，以便它总是被调用。

审核离开 ASP.NET 应用程序的用户的正确方法是什么？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T15:48:30.627

请注意“正确的方式”，但这是我过去的做法。

具有与数据库中的用户记录关联的“活动”日期时间戳。每次用户访问页面时，该页面都会更新为当前时间。如果有人在 15 分钟内没有访问该页面，则该用户被记录为“注销”事件，并且时间戳设置为 NULL。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T15:59:26.517

仅当您有 InProc 会话时才会触发 Session_End 事件。SQL 或状态服务器会话管理不会触发此事件。如果可以，请返回 InProc 会话并使用此事件。

除此之外，您不会得到很好的解决方案。ASP.NET 不提供查看服务器上当前会话列表的方法（至少，StackOverflow 的用户不知道，因为我已经问过这个问题），所以你不能使用工作来检查它们何时被销毁。

下一个最好的事情是为您的用户在某处存储“最后访问时间”，并使用它来检测会话超时。但是，这样的作业的实现很复杂（例如，如果用户快速登录/注销，您可能会错过注销事件）......

所以这里没有完美的解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T15:53:41.660

即使您确实让会话事件正常工作，您的注销记录充其量也将是用户离开您的站点/应用程序的智能猜测。您可能会使用的一种技术是在用户登录时将注销时间放入数据库中，并在他们使用系统时继续使用未来时间更新记录。这是我最近使用的会话表的一般模式：

```
[Id]  [Uid]    [LoginInOn]        [ExpiresOn]  
 1    johndoe  10/14/2008 10:47   10/14/2008 11:07 
```

在此表中，我只是在用户与应用程序交互时不断更新 ExpiresOn 列（当前时间 + 20 分钟）。如果他们尝试在 ExpiresOn 之后进行交互，那么我知道他们空闲了 20 分钟并强制重新登录。出于报告目的，如果当前时间大于 ExpiresOn，我知道用户已注销。你可以得到比这更复杂的。例如，我将我的数据从上面列出的会话表中移到具有常规流程的报告表中。这只是为了保持会话表很小，因为有很多东西与之交互。

# .net - 与 Java 小程序共享 ASP.NET 会话 cookie

> ID：201699
> 
> 赞同：3
> 
> 时间：2008-10-14T15:42:21.917
> 
> 标签：.net, session, applet, cookies, httponly

我有一个在经过表单验证的 aspx 页面内运行的 Java 小程序。在我的站点的 .NET 1.1 版本中，小程序可以访问会话 cookie 并能够从服务器检索文件，但在 .NET 2.0 版本中，它无法进行身份验证。

我在其他地方看到过一些论坛帖子，其中指出 2.0 默认情况下将 cookie 设置为 HttpOnly，但到目前为止，给出的解决方案对我没有用。我还在某处读到 2.0 可能基于用户代理进行区分。

有没有人对此有任何经验或见解？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-09-06T03:25:04.807

这个问题很老，但我认为在这里得到正确答案很有价值。

Filip 混淆了服务器端 Java 和客户端 Java。他是正确的，如果不使用自定义方法，您将无法在两个服务器端平台（例如 Java (J2EE) 和 ASP.Net）之间共享会话。

然而，小程序是客户端的，因此应该能够访问主机页面的会话信息。问题是 ASP.Net 2.0 在会话 cookie 上添加了 HttpOnly 标志。此标志阻止 JavaScript 和 Java 小程序访问这些 cookie。

解决方法是关闭会话 cookie 上的 HttpOnly 标志。虽然您可以在较新版本的 ASP.Net 的配置中执行此操作，但在以前的版本中，解决方案是将以下代码添加到您的 Global.asax 文件中：

```
protected void Application_EndRequest(object sender, EventArgs e)
{
    /**
    * @note Remove the HttpOnly attribute from session cookies, otherwise the 
    *      Java applet won't have access to the session. This solution taken
    *      from
    *      http://blogs.msdn.com/jorman/archive/2006/03/05/session-loss-after-migrating-to-asp-net-2-0.aspx
    *
    *      For more information on the HttpOnly attribute see:
    *
    *      http://msdn.microsoft.com/netframework/programming/breakingchanges/runtime/aspnet.aspx
    *      http://msdn2.microsoft.com/en-us/library/system.web.httpcookie.httponly.aspx
    */
    if (Response.Cookies.Count > 0)
    {
        foreach (string lName in Response.Cookies.AllKeys)
        {
            if (lName == FormsAuthentication.FormsCookieName || 
                lName.ToLower() == "asp.net_sessionid")
            {
                Response.Cookies[lName].HttpOnly = false;
            }
        }
    }
} 
```

请注意，即使使用此修复程序，并非所有浏览器/操作系统/Java 组合都可以访问 cookie。我目前正在研究在 Windows XP 上使用 Java 1.6.0_13 的 Firefox 4.0.1 无法访问会话 cookie 的问题。

解决方法是使用 Dr. Dad 建议的方法，其中会话 ID 作为参数传递给小程序，然后嵌入到请求 URL 中（需要在服务器端配置中打开 URL 会话）或作为手动设置的 cookie 发送。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-11-30T20:15:55.867

Filip 既正确又不正确，至少对 Java 和 ASP.NET 来说是这样。小程序可以通过欺骗来访问 ASP.NET 会话。在我的例子中，我们将会话 ID 作为参数添加到小程序中，然后小程序将其作为 cookie 添加到它的请求中。似乎工作正常。（我们加密了会话 ID 以阻止那些讨厌的黑客！）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T23:52:36.043

菲利普的回答并不完全正确。我运行了一个程序来嗅探我工作站上的 HTTP 标头，而 Java 小程序实际上在某些情况下确实提供了 ASP.NET 身份验证票证——只是不够可靠，无法满足我的需要。

最终我确实找到了解决方案，但它并没有完全解决我的问题。您可以在 .NET 2.0 中向 web.config 添加一个条目`<httpCookies httpOnlyCookies="false" />`：但这不适用于我的所有用户。

长期的解决方案是修改 Java 小程序，使其不需要从 Web 服务器检索任何内容。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-04-10T13:16:23.053

我知道这可能是一个很晚的答案，但我可以给你一个更简单的解决方案： - 通常，并非总是如此，小程序大量使用 html 和 javascript 来进行界面和交互。- Javascript 在浏览器中运行。- Ajax 调用由浏览器进行。- Ajax 调用是异步的，可以很容易地集成到小程序逻辑中。

One can find an elegant solution integrating Ajax calls to an applet's logic, delegating to the browser the security.

# java - 如何在 $TOMCAT_HOME/logs 中为我的 servlet 创建命名日志？

> ID：201700
> 
> 赞同：1
> 
> 时间：2008-10-14T15:42:50.170
> 
> 标签：java, tomcat, logging, servlets

我目前正在使用 Tomcat 通过我的 servlet 中最简单的方法进行日志记录。我使用 ServletConfig.getServletContext().log 来记录活动。这将写入 $TOMCAT_HOME/logs 中的 localhost.YYYY-MM-DD.log。

除非绝对必要，否则我不想摆脱这种日志记录机制的简单性。但我想命名我的日志文件。而不是“localhost”.YYYY-MM-DD.log，有没有办法让它写入“myAppName”.YYYY-MM-DD.log。我知道我可以创建自己的机制，但我再次在这里寻找简单性。

我希望远离像 Log4j 这样的完整框架。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-14T16:10:42.780

对于 Tomcat 6.x，您可以在 conf/logging.properties 中更改日志记录配置。

但我更喜欢使用 Log4j 进行单独配置...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T17:08:21.090

所以有一种方法可以通过 $TOMCAT_HOME/conf/logging.properties 而不用接触我的 servlet 代码......

前...

```
handlers = 1catalina.org.apache.juli.FileHandler, 2localhost.org.apache.juli.FileHandler, 3manager.org.apache.juli.FileHandler, 4admin.org.apache.juli.FileHandler, 5host-manager.org.apache.juli.FileHandler, java.util.logging.ConsoleHandler 
```

后...

```
handlers = 1catalina.org.apache.juli.FileHandler, 2localhost.org.apache.juli.FileHandler, 3manager.org.apache.juli.FileHandler, 4admin.org.apache.juli.FileHandler, 5host-manager.org.apache.juli.FileHandler, java.util.logging.ConsoleHandler, 6localhost.org.apache.juli.FileHandler 
```

然后加...

```
6localhost.org.apache.juli.FileHandler.level = FINE
6localhost.org.apache.juli.FileHandler.directory = ${catalina.base}/logs
6localhost.org.apache.juli.FileHandler.prefix = myAppName. 
```

并添加...

```
org.apache.catalina.core.ContainerBase.[Catalina].[localhost].[/myAppName].level = INFO
org.apache.catalina.core.ContainerBase.[Catalina].[localhost].[/myAppName].handlers = 6localhost.org.apache.juli.FileHandler 
```

和反弹tomcat。这仅使用我简单的 ServletConfig.getServletContext().log() 消息创建了 $TOMCAT_HOME/logs/myAppName.2008-10-14.log。

# random - 在 MD5 产生碰撞之前有多少随机元素？

> ID：201705
> 
> 赞同：168
> 
> 时间：2008-10-14T15:43:27.827
> 
> 标签：random, md5, hash

我在 Amazon S3 上有一个图像库。对于每张图片，我会 md5 我服务器上的源 URL 加上时间戳以获得唯一的文件名。由于 S3 不能有子目录，我需要将所有这些图像存储在一个平面文件夹中。

我需要担心产生的 MD5 哈希值的冲突吗？

奖励：在我开始看到 MD5 产生的哈希值冲突之前，我可以拥有多少个文件？

* * *

## 回答 #1

> 赞同：317
> 
> 时间：2008-11-13T22:06:41.253

仅两个哈希意外碰撞的概率为**1/2 ^(128)** [，即](http://www.wolframalpha.com/input/?i=2%5E128)340 十亿分之一 282 十亿分之 366 十亿分之 920 十亿分之一 938 十亿分之一 463 六分之一 463 十亿分之一 374 万亿分之一 607 万亿 4310 亿 7.68 亿 21.1 万 456。

[但是，如果您保留所有哈希值，那么由于生日悖论](http://en.wikipedia.org/wiki/Birthday_paradox)，概率会更高一些。要使任何散列与任何其他散列冲突的概率为 50%，您需要**2 ^(64 个)**散列。这意味着要发生冲突，平均而言，您需要在[100 年内](http://www.google.com/search?q=2%5E64%2F100%2F%28seconds+per+year%29)[*每秒*](http://www.google.com/search?q=2%5E64%2F100%2F%28seconds+per+year%29)[散列60*亿*个文件](http://www.google.com/search?q=2%5E64%2F100%2F%28seconds+per+year%29)*。*

 ** * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-10-14T15:46:53.233

S3 可以有子目录。只需在键名中添加一个“/”，您就可以访问这些文件，就好像它们位于不同的目录中一样。我使用它根据 S3 中的用户 ID 将用户文件存储在单独的文件夹中。

例如：“mybucket/users/1234/somefile.jpg”。它与文件系统中的目录并不完全相同，但 S3 API 具有一些使其工作方式几乎相同的特性。我可以要求它列出所有以“users/1234/”开头的文件，它会显示该“目录”中的所有文件。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-10-14T15:47:34.467

等等，是不是：

```
md5(filename) + timestamp 
```

或者：

```
md5(filename + timestamp) 
```

如果是前者，那么您最容易获得 GUID，我不会担心。如果是后者，请参阅 Karg 的帖子，了解您最终将如何遇到碰撞。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-10-14T15:45:59.383

碰撞的粗略经验法则是值范围的平方根。您的 MD5 信号大概是 128 位长，因此您可能会看到超过 2^64 图像的冲突。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-05-05T00:45:12.670

尽管随机 MD5 冲突极为罕见，但如果您的用户可以提供文件（将逐字存储），那么他们可以设计发生冲突。也就是说，他们可以故意创建两个 MD5sum 相同但数据不同的文件。确保您的应用程序能够以合理的方式处理这种情况，或者可能使用更强的哈希值，如 SHA-256。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-14T15:48:28.270

尽管 MD5 因碰撞而引起的问题已广为人知，但随机数据之间的意外碰撞[极为罕见](http://www.miketaylor.org.uk/tech/law.html)。另一方面，如果您对文件名进行哈希处理，那不是随机数据，我希望很快就会发生冲突。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-14T15:45:00.117

可能性有多大并不重要；有可能的。它可能发生在您散列的前两件事上（非常不可能，但可能），因此您需要从一开始就支持冲突。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2016-07-12T00:12:44.953

MD5 碰撞是极不可能的。如果你有**9 万亿**个MD5，那么**9 万亿**中只有一次发生碰撞的机会。

# c# - 如何确保 Linq to Sql 不会覆盖或违反不可为空的数据库默认值？

> ID：201706
> 
> 赞同：14
> 
> 时间：2008-10-14T15:44:37.187
> 
> 标签：c#, sql, linq, sql-server-2005, linq-to-sql

我有一个带有这些字段的表的 SQL Server 数据库：

1.  A `bit`，默​​认值为 1 `NOT NULL`，。
2.  A`smalldatetime`具有默认值`gettime()`, `NOT NULL`。
3.  `int`没有默认值的, `IDENTITY`, `NOT NULL`.

当我为此表生成 Linq to SQL 时，会发生以下情况：

1.  `bit`没有给予特殊待遇。
2.  `smalldatetime`没有给予特殊待遇。
3.  被`int`标记为`IsDbGenerated`。

这意味着当我使用 Linq to SQL 进行插入时，会发生以下情况：

1.  将`bit`作为 0 发送，覆盖默认值。**对？**
2.  将`smalldatetime`作为 uninitialized 发送`System.DateTime`，在 SQL Server 中产生错误，因为它不属于 SQL Server smalldatetime 范围。**对？**
3.  `IsDbGenerated` `int`遗嘱不寄出；DB 将生成一个值，然后 Linq to SQL 将读回该值。

**我必须进行哪些更改才能使此方案生效？**

总结一下：我想要具有 DB 分配的默认值的不可空字段，但`IsDbGenerated`如果这意味着在使用 Linq to SQL 进行更新或插入时我无法为它们提供值，我不想要它们。`IsDbGenerated`如果这意味着我必须将 Linq 生成的代码手动修改为 SQL，我也不想要它们。

*编辑：答案似乎是当前 Linq to SQL 的一个限制。*

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-15T22:07:31.577

Linq-To-Sql 生成的类不选择默认值约束。

也许在未来，但问题是约束并不总是简单的值，它们也可以是标量函数`GetDate()`，所以 linq 必须以某种方式知道如何翻译这些值。简而言之，它甚至没有尝试。它也是一种非常特定于数据库的类型。

*   您可以编写代码生成器来创建实体部分类，您可以在其中提取默认值常量。
*   或者，您的业务层代码可以在 xml 文件的构造函数中设置默认值，您需要做的就是使 xml 文件保持最新。
*   您可以模拟 sql 并通过在将更改提交到数据库之前检查 ChangeSet 来添加默认值，而不是在构造函数中进行工作。

[CodeProject - Setting Default Values for LINQ Bound Data](http://www.codeproject.com/KB/linq/SettingDefaultValues.aspx)中详细描述了您遇到的问题

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-17T20:00:54.000

我遇到了同样的问题，bzlm，并得出了同样的结论。使用 Linq To Sql 获得具有 DB 分配的默认值的不可空字段根本没有好方法。

我所采用的解决方法是添加一个 SetDefaults() 方法，该方法与 CodeProject 上的 Robert Paulson 链接的方法非常相似，并在我的表实体基类的默认构造函数中调用它。它对我很有效，因为 95% 的时间，我都在设置 0、空字符串或 getdate()。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-14T16:35:23.777

> > 这意味着当我使用 Linq to SQL 进行插入时，会发生以下情况：
> 
> 1.  该位将作为 0 发送，覆盖默认值。对？ **- 正确的**
> 2.  smalldatetime 将作为未初始化的 System.DateTime 发送，从而在 SQL Server 中产生错误，因为它不属于 SQL Server smalldatetime 范围。对？ **- 发送的是 DateTime.MinValue**
> 3.  IsDbGenerated int 将不会被发送；DB 将生成一个值，然后 Linq to SQL 将读回该值。-**如果设置了 DB generated，则该值由数据库创建，如果没有，则 Linq 期望用户设置该值。**

如果您不使用自动属性，最好的办法是在对象的构造函数或私有字段中设置它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-15T19:40:04.277

您可以为您的数据上下文（部分类）创建另一个文件，然后使用 InsertYOURENTITY 和 UpdateYOURENTITY 部分方法来检查您的属性并分配正确的值。在您的代码之后调用 ExecuteDynamicInsert 或 ExecuteDynamicUpdate 并设置好。

# c++ - 连接两个 std::vectors

> ID：201718
> 
> 赞同：846
> 
> 时间：2008-10-14T15:46:01.893
> 
> 标签：c++, vector, stl, concatenation, stdvector

如何连接两个`std::vector`s？

* * *

## 回答 #1

> 赞同：910
> 
> 时间：2008-10-14T15:48:28.397

```
vector1.insert( vector1.end(), vector2.begin(), vector2.end() ); 
```

* * *

## 回答 #2

> 赞同：263
> 
> 时间：2014-02-23T18:11:47.363

如果您使用的是 C++11，并且希望移动元素而不仅仅是复制它们，您可以[`std::move_iterator`](http://en.cppreference.com/w/cpp/iterator/move_iterator)与插入（或复制）一起使用：

```
#include <vector>
#include <iostream>
#include <iterator>

int main(int argc, char** argv) {
  std::vector<int> dest{1,2,3,4,5};
  std::vector<int> src{6,7,8,9,10};

  // Move elements from src to dest.
  // src is left in undefined but safe-to-destruct state.
  dest.insert(
      dest.end(),
      std::make_move_iterator(src.begin()),
      std::make_move_iterator(src.end())
    );

  // Print out concatenated vector.
  std::copy(
      dest.begin(),
      dest.end(),
      std::ostream_iterator<int>(std::cout, "\n")
    );

  return 0;
} 
```

对于带有整数的示例，这不会更有效，因为移动它们并不比复制它们更有效，但是对于具有优化移动的数据结构，它可以避免复制不必要的状态：

```
#include <vector>
#include <iostream>
#include <iterator>

int main(int argc, char** argv) {
  std::vector<std::vector<int>> dest{{1,2,3,4,5}, {3,4}};
  std::vector<std::vector<int>> src{{6,7,8,9,10}};

  // Move elements from src to dest.
  // src is left in undefined but safe-to-destruct state.
  dest.insert(
      dest.end(),
      std::make_move_iterator(src.begin()),
      std::make_move_iterator(src.end())
    );

  return 0;
} 
```

移动后，src 的元素处于未定义但可以安全销毁的状态，并且其之前的元素在最后直接转移到 dest 的新元素。

* * *

## 回答 #3

> 赞同：176
> 
> 时间：2008-10-14T15:48:15.510

我会使用[插入函数](http://cppreference.com/wiki/stl/vector/insert)，例如：

```
vector<int> a, b;
//fill with data
b.insert(b.end(), a.begin(), a.end()); 
```

* * *

## 回答 #4

> 赞同：84
> 
> 时间：2008-10-14T16:20:34.977

或者你可以使用：

```
std::copy(source.begin(), source.end(), std::back_inserter(destination)); 
```

如果两个向量不包含完全相同类型的事物，则此模式很有用，因为您可以使用某些东西而不是`std::back_inserter`从一种类型转换为另一种类型。

* * *

## 回答 #5

> 赞同：75
> 
> 时间：2015-06-12T07:53:19.197

使用 C++11，我更喜欢将向量 b 附加到 a：

```
std::move(b.begin(), b.end(), std::back_inserter(a)); 
```

when`a`和`b`不重叠，并且`b`不会再使用。

* * *

这是[`std::move`](https://en.cppreference.com/w/cpp/algorithm/move)来自`<algorithm>`，而不是*通常* [`std::move`](https://en.cppreference.com/w/cpp/utility/move)的来自`<utility>`。

* * *

## 回答 #6

> 赞同：42
> 
> 时间：2008-10-14T15:48:37.897

```
std::vector<int> first;
std::vector<int> second;

first.insert(first.end(), second.begin(), second.end()); 
```

* * *

## 回答 #7

> 赞同：33
> 
> 时间：2016-06-10T09:27:16.817

我更喜欢已经提到的一个：

```
a.insert(a.end(), b.begin(), b.end()); 
```

但是如果你使用 C++11，还有一种更通用的方法：

```
a.insert(std::end(a), std::begin(b), std::end(b)); 
```

* * *

此外，这不是问题的一部分，但建议[`reserve`](http://www.cplusplus.com/reference/vector/vector/reserve/)在附加之前使用以获得更好的性能。而且，如果您将 vector 与其自身连接，而不保留它会失败，那么您总是应该`reserve`.

* * *

所以基本上你需要什么：

```
template <typename T>
void Append(std::vector<T>& a, const std::vector<T>& b)
{
    a.reserve(a.size() + b.size());
    a.insert(a.end(), b.begin(), b.end());
} 
```

* * *

## 回答 #8

> 赞同：25
> 
> 时间：2017-08-08T08:49:18.923

使用[range v3](https://ericniebler.github.io/range-v3/)，您可能会有一个**惰性**连接：

```
ranges::view::concat(v1, v2) 
```

[演示](http://coliru.stacked-crooked.com/a/a323e3792a869244)。

* * *

## 回答 #9

> 赞同：21
> 
> 时间：2018-05-08T10:11:39.140

连接的**一般性能提升**是检查向量的大小。并将较小的与较大的合并/插入。

```
//vector<int> v1,v2;
if(v1.size()>v2.size()) {
    v1.insert(v1.end(),v2.begin(),v2.end());
} else {
    v2.insert(v2.end(),v1.begin(),v1.end());
} 
```

* * *

## 回答 #10

> 赞同：15
> 
> 时间：2019-06-26T22:15:35.693

如果您希望能够简洁地连接向量，则可以重载`+=`运算符。

```
template <typename T>
std::vector<T>& operator +=(std::vector<T>& vector1, const std::vector<T>& vector2) {
    vector1.insert(vector1.end(), vector2.begin(), vector2.end());
    return vector1;
} 
```

然后你可以这样称呼它：

```
vector1 += vector2; 
```

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2014-05-06T08:21:33.070

如果您对强异常保证感兴趣（当复制构造函数可以抛出异常时）：

```
template<typename T>
inline void append_copy(std::vector<T>& v1, const std::vector<T>& v2)
{
    const auto orig_v1_size = v1.size();
    v1.reserve(orig_v1_size + v2.size());
    try
    {
        v1.insert(v1.end(), v2.begin(), v2.end());
    }
    catch(...)
    {
        v1.erase(v1.begin() + orig_v1_size, v1.end());
        throw;
    }
} 
```

`append_move`如果向量元素的移动构造函数可以抛出（这不太可能但仍然），则通常无法实现与强保证类似。

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2019-08-17T05:53:25.457

有一个[`std::merge`](https://en.cppreference.com/w/cpp/algorithm/merge)来自**C++17**的算法，在对输入向量进行排序时非常容易使用，

下面是示例：

```
#include <iostream>
#include <vector>
#include <algorithm>

int main()
{
    //DATA
    std::vector<int> v1{2,4,6,8};
    std::vector<int> v2{12,14,16,18};

    //MERGE
    std::vector<int> dst;
    std::merge(v1.begin(), v1.end(), v2.begin(), v2.end(), std::back_inserter(dst));

    //PRINT
    for(auto item:dst)
        std::cout<<item<<" ";

    return 0;
} 
```

* * *

## 回答 #13

> 赞同：9
> 
> 时间：2017-08-08T09:38:02.603

你应该使用[vector::insert](http://www.cplusplus.com/reference/vector/vector/insert/)

```
v1.insert(v1.end(), v2.begin(), v2.end()); 
```

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2019-10-21T19:21:30.530

如果您的目标只是为了只读目的而迭代值的范围，另一种方法是将两个向量包装在代理周围（O（1））而不是复制它们（O（n）），以便立即看到它们作为一个单一的，连续的。

```
std::vector<int> A{ 1, 2, 3, 4, 5};
std::vector<int> B{ 10, 20, 30 };

VecProxy<int> AB(A, B);  // ----> O(1)!

for (size_t i = 0; i < AB.size(); i++)
    std::cout << AB[i] << " ";  // ----> 1 2 3 4 5 10 20 30 
```

有关更多详细信息，包括“VecProxy”实现以及优缺点，请参阅[https://stackoverflow.com/a/55838758/2379625 。](https://stackoverflow.com/a/55838758/2379625)

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2015-11-11T11:32:45.380

将此添加到您的头文件中：

```
template <typename T> vector<T> concat(vector<T> &a, vector<T> &b) {
    vector<T> ret = vector<T>();
    copy(a.begin(), a.end(), back_inserter(ret));
    copy(b.begin(), b.end(), back_inserter(ret));
    return ret;
} 
```

并以这种方式使用它：

```
vector<int> a = vector<int>();
vector<int> b = vector<int>();

a.push_back(1);
a.push_back(2);
b.push_back(62);

vector<int> r = concat(a, b); 
```

r 将包含 [1,2,62]

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2018-03-08T13:48:05.280

这是使用 C++11 移动语义的通用解决方案：

```
template <typename T>
std::vector<T> concat(const std::vector<T>& lhs, const std::vector<T>& rhs)
{
    if (lhs.empty()) return rhs;
    if (rhs.empty()) return lhs;
    std::vector<T> result {};
    result.reserve(lhs.size() + rhs.size());
    result.insert(result.cend(), lhs.cbegin(), lhs.cend());
    result.insert(result.cend(), rhs.cbegin(), rhs.cend());
    return result;
}

template <typename T>
std::vector<T> concat(std::vector<T>&& lhs, const std::vector<T>& rhs)
{
    lhs.insert(lhs.cend(), rhs.cbegin(), rhs.cend());
    return std::move(lhs);
}

template <typename T>
std::vector<T> concat(const std::vector<T>& lhs, std::vector<T>&& rhs)
{
    rhs.insert(rhs.cbegin(), lhs.cbegin(), lhs.cend());
    return std::move(rhs);
}

template <typename T>
std::vector<T> concat(std::vector<T>&& lhs, std::vector<T>&& rhs)
{
    if (lhs.empty()) return std::move(rhs);
    lhs.insert(lhs.cend(), std::make_move_iterator(rhs.begin()), std::make_move_iterator(rhs.end()));
    return std::move(lhs);
} 
```

请注意这与[`append`](https://stackoverflow.com/a/37210097/2970186)ing 和 a有何不同`vector`。

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2018-07-31T12:43:53.720

您可以为 + 运算符准备自己的模板：

```
template <typename T> 
inline T operator+(const T & a, const T & b)
{
    T res = a;
    res.insert(res.end(), b.begin(), b.end());
    return res;
} 
```

接下来 - 只需使用 +：

```
vector<int> a{1, 2, 3, 4};
vector<int> b{5, 6, 7, 8};
for (auto x: a + b)
    cout << x << " ";
cout << endl; 
```

这个例子给出了输出：

```
1 2 3 4 5 6 7 8
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2016-12-16T11:57:35.440

```
vector<int> v1 = {1, 2, 3, 4, 5};
vector<int> v2 = {11, 12, 13, 14, 15};
copy(v2.begin(), v2.end(), back_inserter(v1)); 
```

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2019-07-11T21:10:12.363

我已经实现了这个函数，它连接任意数量的容器，从右值引用移动并以其他方式复制

```
namespace internal {

// Implementation detail of Concatenate, appends to a pre-reserved vector, copying or moving if
// appropriate
template<typename Target, typename Head, typename... Tail>
void AppendNoReserve(Target* target, Head&& head, Tail&&... tail) {
    // Currently, require each homogenous inputs. If there is demand, we could probably implement a
    // version that outputs a vector whose value_type is the common_type of all the containers
    // passed to it, and call it ConvertingConcatenate.
    static_assert(
            std::is_same_v<
                    typename std::decay_t<Target>::value_type,
                    typename std::decay_t<Head>::value_type>,
            "Concatenate requires each container passed to it to have the same value_type");
    if constexpr (std::is_lvalue_reference_v<Head>) {
        std::copy(head.begin(), head.end(), std::back_inserter(*target));
    } else {
        std::move(head.begin(), head.end(), std::back_inserter(*target));
    }
    if constexpr (sizeof...(Tail) > 0) {
        AppendNoReserve(target, std::forward<Tail>(tail)...);
    }
}

template<typename Head, typename... Tail>
size_t TotalSize(const Head& head, const Tail&... tail) {
    if constexpr (sizeof...(Tail) > 0) {
        return head.size() + TotalSize(tail...);
    } else {
        return head.size();
    }
}

}  // namespace internal

/// Concatenate the provided containers into a single vector. Moves from rvalue references, copies
/// otherwise.
template<typename Head, typename... Tail>
auto Concatenate(Head&& head, Tail&&... tail) {
    size_t totalSize = internal::TotalSize(head, tail...);
    std::vector<typename std::decay_t<Head>::value_type> result;
    result.reserve(totalSize);
    internal::AppendNoReserve(&result, std::forward<Head>(head), std::forward<Tail>(tail)...);
    return result;
} 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2021-06-24T05:00:04.503

对于提供`push_back`（字符串，向量，双端队列，...）的容器：

`std::copy(std::begin(input), std::end(input), std::back_inserter(output))`

和

对于提供`insert`（地图、集）的容器：

`std::copy(std::begin(input), std::end(input), std::inserter(output, output.end()))`

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2018-12-06T13:44:46.390

这个解决方案可能有点复杂，但`boost-range`也提供了一些其他的好东西。

```
#include <iostream>
#include <vector>
#include <boost/range/algorithm/copy.hpp>

int main(int, char**) {
    std::vector<int> a = { 1,2,3 };
    std::vector<int> b = { 4,5,6 };
    boost::copy(b, std::back_inserter(a));
    for (auto& iter : a) {
        std::cout << iter << " ";
    }
    return EXIT_SUCCESS;
} 
```

通常，一个意图是组合向量`a`并`b`对其进行迭代以进行一些操作。在这种情况下，有可笑的简单`join`功能。

```
#include <iostream>
#include <vector>
#include <boost/range/join.hpp>
#include <boost/range/algorithm/copy.hpp>

int main(int, char**) {
    std::vector<int> a = { 1,2,3 };
    std::vector<int> b = { 4,5,6 };
    std::vector<int> c = { 7,8,9 };
    // Just creates an iterator
    for (auto& iter : boost::join(a, boost::join(b, c))) {
        std::cout << iter << " ";
    }
    std::cout << "\n";
    // Can also be used to create a copy
    std::vector<int> d;
    boost::copy(boost::join(a, boost::join(b, c)), std::back_inserter(d));
    for (auto& iter : d) {
        std::cout << iter << " ";
    }
    return EXIT_SUCCESS;
} 
```

对于大型向量，这可能是一个优势，因为没有复制。它还可以用于轻松地将泛化复制到多个容器。

出于某种原因，没有什么像`boost::join(a,b,c)`，这可能是合理的。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2020-05-24T15:30:58.483

您可以使用模板使用多态类型使用预先实现的 STL 算法来完成此操作。

```
#include <iostream>
#include <vector>
#include <algorithm>

template<typename T>

void concat(std::vector<T>& valuesa, std::vector<T>& valuesb){

     for_each(valuesb.begin(), valuesb.end(), [&](int value){ valuesa.push_back(value);});
}

int main()
{
    std::vector<int> values_p={1,2,3,4,5};
    std::vector<int> values_s={6,7};

   concat(values_p, values_s);

    for(auto& it : values_p){

        std::cout<<it<<std::endl;
    }

    return 0;
} 
```

如果您不想进一步使用它，可以清除第二个向量（`clear()`方法）。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2016-02-22T18:53:45.860

如果您正在寻找一种在创建后将向量附加到另一个向量的方法，那么[`vector::insert`](http://en.cppreference.com/w/cpp/container/vector/insert)您最好的选择是，正如已多次回答的那样，例如：

```
vector<int> first = {13};
const vector<int> second = {42};

first.insert(first.end(), second.cbegin(), second.cend()); 
```

遗憾的是，没有办法构造 a `const vector<int>`，如上所述，您必须构造 then `insert`。

* * *

如果您实际上正在寻找的是一个容器来保存这两个`vector<int>`s 的连接，那么您可能会得到更好的东西，如果：

1.  你的`vector`包含原语
2.  您包含的原语大小为 32 位或更小
3.  你想要一个`const`容器

如果以上都属实，我建议使用[`basic_string`](http://en.cppreference.com/w/cpp/string/basic_string)who's`char_type`匹配您的`vector`. 您应该[`static_assert`](http://en.cppreference.com/w/cpp/language/static_assert)在代码中包含 a 以验证这些大小是否保持一致：

```
static_assert(sizeof(char32_t) == sizeof(int)); 
```

有了这一点，你可以这样做：

```
const u32string concatenation = u32string(first.cbegin(), first.cend()) + u32string(second.cbegin(), second.cend()); 
```

有关两者之间差异的更多信息`string`，`vector`您可以在这里查看：[https ://stackoverflow.com/a/35558008/2642059](https://stackoverflow.com/a/35558008/2642059)

有关此代码的实时示例，您可以在此处查看：http: [//ideone.com/7Iww3I](http://ideone.com/7Iww3I)

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2020-06-08T04:53:28.093

将两个`std::vector-s`与`for`循环连接在一起`std::vector`。

```
 std::vector <int> v1 {1, 2, 3}; //declare vector1
    std::vector <int> v2 {4, 5}; //declare vector2
    std::vector <int> suma; //declare vector suma

    for(int i = 0; i < v1.size(); i++) //for loop 1
    {
         suma.push_back(v1[i]);
    }

    for(int i = 0; i< v2.size(); i++) //for loop 2
    {
         suma.push_back(v2[i]);
    }

    for(int i = 0; i < suma.size(); i++) //for loop 3-output
    {
         std::cout << suma[i];
    } 
```

* * *

## 回答 #25

> 赞同：-3
> 
> 时间：2020-06-25T18:43:26.070

尝试，创建两个向量并将第二个向量添加到第一个向量，代码：

```
std::vector<int> v1{1,2,3};
std::vector<int> v2{4,5};

for(int i = 0; i<v2.size();i++)
{
     v1.push_back(v2[i]);
} 
```

v1:1,2,3。

描述：

当 i int 不是 v2 大小时，推回元素，索引 i 在 v1 向量中。

* * *

## 回答 #26

> 赞同：-5
> 
> 时间：2016-12-27T06:39:21.147

老实说，您可以通过将两个向量中的元素复制到另一个向量中来快速连接两个向量，或者只附加两个向量中的一个！这取决于你的目标。

**方法1：**分配新向量，其大小是两个原始向量的大小之和。

```
vector<int> concat_vector = vector<int>();
concat_vector.setcapacity(vector_A.size() + vector_B.size());
// Loop for copy elements in two vectors into concat_vector 
```

**方法2：**通过添加/插入向量B的元素来附加向量A。

```
// Loop for insert elements of vector_B into vector_A with insert() 
function: vector_A.insert(vector_A .end(), vector_B.cbegin(), vector_B.cend()); 
```

# javascript - 将 JavaScript 数组转换为逗号分隔列表的简单方法？

> ID：201724
> 
> 赞同：481
> 
> 时间：2008-10-14T15:47:17.337
> 
> 标签：javascript

我在 JavaScript 中有一个一维字符串数组，我想将其转换为逗号分隔的列表。在各种 JavaScript（或 jQuery）中是否有一种简单的方法可以将其转换为逗号分隔的列表？（如果这是唯一的方法，我知道如何遍历数组并自己通过连接构建字符串。）

* * *

## 回答 #1

> 赞同：908
> 
> 时间：2008-10-14T15:48:48.317

[Array.prototype.join()](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/join)方法：

```
var arr = ["Zero", "One", "Two"];

document.write(arr.join(", "));
```

* * *

## 回答 #2

> 赞同：107
> 
> 时间：2008-10-14T18:21:34.233

实际上，该`toString()`实现默认使用逗号连接：

```
var arr = [ 42, 55 ];
var str1 = arr.toString(); // Gives you "42,55"
var str2 = String(arr); // Ditto 
```

我不知道这是否是 JS 规范规定的，但这就是~~最多~~几乎所有的浏览器似乎都在做。

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2008-10-14T17:45:52.213

或者（更有效地）：

```
var arr = 新数组（3）；
arr[0] = "零";
arr[1] = "一个";
arr[2] = "两个";

document.write(arr); // 与此上下文中的 document.write(arr.toString()) 相同

```

数组的 toString 方法在调用时会返回您需要的内容 - 逗号分隔的列表。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2017-03-25T10:19:18.637

如果您需要在最后两项之间使用“和”而不是“,”，您可以这样做：

```
function arrayToList(array){
  return array
    .join(", ")
    .replace(/, ((?:.(?!, ))+)$/, ' and $1');
} 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2020-12-26T21:22:38.950

简单数组

```
let simpleArray = [1,2,3,4]
let commaSeperated = simpleArray.join(",");
console.log(commaSeperated);
```

具有以逗号分隔的特定属性的对象数组。

```
let arrayOfObjects = [
{
id : 1,
name : "Name 1",
address : "Address 1"
},
{
id : 2,
name : "Name 2",
address : "Address 2"
},
{
id : 3,
name : "Name 3",
address : "Address 3"
}]
let names = arrayOfObjects.map(x => x.name).join(", ");
console.log(names);
```

结果

```
Name 1, Name 2, Name 3 
```

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2014-03-04T22:41:04.543

这是一个将二维数组或列数组转换为正确转义的 CSV 字符串的实现。这些函数不检查有效的字符串/数字输入或列计数（确保您的数组一开始就有效）。单元格可以包含逗号和引号！

这是一个[用于解码 CSV 字符串的脚本](https://github.com/thetalecrafter/excel.js/blob/master/src/csv.js)。

这是我[用于编码 CSV 字符串的脚本](http://jsfiddle.net/skibulk/F5hGx/19/)：

```
// Example
var csv = new csvWriter();
csv.del = '\t';
csv.enc = "'";

var nullVar;
var testStr = "The comma (,) pipe (|) single quote (') double quote (\") and tab (\t) are commonly used to tabulate data in plain-text formats.";
var testArr = [
    false,
    0,
    nullVar,
    // undefinedVar,
    '',
    {key:'value'},
];

console.log(csv.escapeCol(testStr));
console.log(csv.arrayToRow(testArr));
console.log(csv.arrayToCSV([testArr, testArr, testArr]));

/**
 * Class for creating csv strings
 * Handles multiple data types
 * Objects are cast to Strings
 **/

function csvWriter(del, enc) {
    this.del = del || ','; // CSV Delimiter
    this.enc = enc || '"'; // CSV Enclosure

    // Convert Object to CSV column
    this.escapeCol = function (col) {
        if(isNaN(col)) {
            // is not boolean or numeric
            if (!col) {
                // is null or undefined
                col = '';
            } else {
                // is string or object
                col = String(col);
                if (col.length > 0) {
                    // use regex to test for del, enc, \r or \n
                    // if(new RegExp( '[' + this.del + this.enc + '\r\n]' ).test(col)) {

                    // escape inline enclosure
                    col = col.split( this.enc ).join( this.enc + this.enc );

                    // wrap with enclosure
                    col = this.enc + col + this.enc;
                }
            }
        }
        return col;
    };

    // Convert an Array of columns into an escaped CSV row
    this.arrayToRow = function (arr) {
        var arr2 = arr.slice(0);

        var i, ii = arr2.length;
        for(i = 0; i < ii; i++) {
            arr2[i] = this.escapeCol(arr2[i]);
        }
        return arr2.join(this.del);
    };

    // Convert a two-dimensional Array into an escaped multi-row CSV 
    this.arrayToCSV = function (arr) {
        var arr2 = arr.slice(0);

        var i, ii = arr2.length;
        for(i = 0; i < ii; i++) {
            arr2[i] = this.arrayToRow(arr2[i]);
        }
        return arr2.join("\r\n");
    };
} 
```

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2014-03-10T23:44:31.300

我认为应该这样做：

```
var arr = ['contains,comma', 3.14, 'contains"quote', "more'quotes"]
var item, i;
var line = [];

for (i = 0; i < arr.length; ++i) {
    item = arr[i];
    if (item.indexOf && (item.indexOf(',') !== -1 || item.indexOf('"') !== -1)) {
        item = '"' + item.replace(/"/g, '""') + '"';
    }
    line.push(item);
}

document.getElementById('out').innerHTML = line.join(','); 
```

[小提琴](http://jsfiddle.net/mnbayazit/G9mYj/4/)

基本上它所做的只是检查字符串是否包含逗号或引号。如果是这样，那么它将所有引号加倍，并将引号放在末尾。然后它用逗号连接每个部分。

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2017-07-18T08:18:19.673

有很多方法可以将数组转换为逗号分隔的列表

# 1.使用数组#join

来自[MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/join)

> join() 方法将数组（或类似数组的对象）的所有元素连接成一个字符串。

编码

```
var arr = ["this","is","a","comma","separated","list"];
arr = arr.join(","); 
```

### 片段

```
var arr = ["this", "is", "a", "comma", "separated", "list"];
arr = arr.join(",");
console.log(arr);
```

# 2\. 使用数组#toString

来自[MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/toString)

> toString() 方法返回一个表示指定数组及其元素的字符串。

编码

```
var arr = ["this","is","a","comma","separated","list"];
arr = arr.toString(); 
```

### 片段

```
var arr = ["this", "is", "a", "comma", "separated", "list"];
arr = arr.toString();
console.log(arr);
```

# 3\. 数组前加[]+或数组后加+[]

[ *]+*或*+[]*会将其转换为字符串

## 证明

```
([]+[] === [].toString()) 
```

将输出*真*

```
console.log([]+[] === [].toString());
```

```
var arr = ["this","is","a","comma","separated","list"];
arr = []+arr; 
```

### 片段

```
var arr = ["this", "is", "a", "comma", "separated", "list"];
arr = []+arr;
console.log(arr);
```

### 还

```
var arr = ["this","is","a","comma","separated","list"];
arr = arr+[]; 
```

```
var arr = ["this", "is", "a", "comma", "separated", "list"];
arr = arr + [];
console.log(arr);
```

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2015-12-13T10:19:55.130

使用内置`Array.toString`方法

```
var arr = ['one', 'two', 'three'];
arr.toString();  // 'one,two,three' 
```

[Array.toString() 上的 MDN](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Array/toString)

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2017-06-30T10:16:34.820

我通常发现自己需要一些也跳过该值的东西，如果该值是`null`or`undefined`等​​。

所以这是适合我的解决方案：

```
// Example 1
const arr1 = ['apple', null, 'banana', '', undefined, 'pear'];
const commaSeparated1 = arr1.filter(item => item).join(', ');
console.log(commaSeparated1); // 'apple, banana, pear'

// Example 2
const arr2 = [null, 'apple'];
const commaSeparated2 = arr2.filter(item => item).join(', ');
console.log(commaSeparated2); // 'apple' 
```

`', apple'`如果我的数组看起来像我的第二个示例中的那样，这里的大多数解决方案都会返回。这就是为什么我更喜欢这个解决方案。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2017-07-08T16:32:29.793

[Papa Parse](http://papaparse.com/) 处理值和其他极端情况中的逗号。

（ Node 的[Baby Parse](https://www.npmjs.com/package/babyparse)已被弃用 - 您现在可以在浏览器和 Node 中使用 Papa Parse。）

例如。（节点）

```
const csvParser = require('papaparse'); // previously you might have used babyparse
var arr = [1,null,"a,b"] ;
var csv = csvParser.unparse([arr]) ;
console.log(csv) ; 
```

1,,"a,b"

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2018-08-29T15:50:29.980

我喜欢[https://jsfiddle.net/rwone/qJUh2/](https://jsfiddle.net/rwone/qJUh2/)上的解决方案，因为它在逗号后添加了空格：

```
array = ["test","test2","test3"]
array = array.toString();
array = array.replace(/,/g, ", ");
alert(array); 
```

或者，正如@StackOverflaw 在评论中所建议的那样：

```
array.join(', '); 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2020-09-30T00:20:25.093

```
const arr = [1, 2, 3];
console.log(`${arr}`) 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2021-10-21T07:12:31.817

> 在这里，您可以使用任何字符分隔，并且可以仅使用 foreach 获取任何属性列表

```
let taskIds: string = '';    
this.checkedTaskList.forEach(res => {
  taskIds = taskIds + res.taskId.toString() + ','
});
if (taskIds) {
    taskIds.substring(0, taskIds.length - 1),**
} 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-06-23T20:50:48.873

获取初始代码：

```
var arr = new Array(3);
arr[0] = "Zero";
arr[1] = "One";
arr[2] = "Two"; 
```

使用 join 函数的初始答案是理想的。要考虑的一件事是字符串的最终用途。

对于在某些最终文本显示中使用：

```
arr.join(",")
=> "Zero,One,Two" 
```

用于在 URL 中以（有点）RESTful 方式传递多个值：

```
arr.join("|")
=> "Zero|One|Two"

var url = 'http://www.yoursitehere.com/do/something/to/' + arr.join("|");
=> "http://www.yoursitehere.com/do/something/to/Zero|One|Two" 
```

当然，这一切都取决于最终用途。只要牢记数据源和使用，一切都会好起来的。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2016-02-24T08:40:18.387

你想用“和”结束它吗？

针对这种情况，我创建了一个 npm 模块。

尝试[arrford](https://github.com/dawsonbotsford/arrford)：

## 用法

```
const arrford = require('arrford');

arrford(['run', 'climb', 'jump!']);
//=> 'run, climb, and jump!'

arrford(['run', 'climb', 'jump!'], false);
//=> 'run, climb and jump!'

arrford(['run', 'climb!']);
//=> 'run and climb!'

arrford(['run!']);
//=> 'run!' 
```

## 安装

```
npm install --save arrford 
```

## 阅读更多

[https://github.com/dawsonbotsford/arrford](https://github.com/dawsonbotsford/arrford)

## 自己试试

[补品链接](https://tonicdev.com/dawsonbotsford/56f46dd154d4e814002e34b9)

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2019-01-30T14:27:48.723

从[Chrome 72](https://developers.google.com/web/updates/2019/01/nic72#intl-format)开始，可以使用[Intl.ListFormat](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ListFormat)：

```
const vehicles = ['Motorcycle', 'Bus', 'Car'];

const formatter = new Intl.ListFormat('en', { style: 'long', type: 'conjunction' });
console.log(formatter.format(vehicles));
// expected output: "Motorcycle, Bus, and Car"

const formatter2 = new Intl.ListFormat('de', { style: 'short', type: 'disjunction' });
console.log(formatter2.format(vehicles));
// expected output: "Motorcycle, Bus oder Car"

const formatter3 = new Intl.ListFormat('en', { style: 'narrow', type: 'unit' });
console.log(formatter3.format(vehicles));
// expected output: "Motorcycle Bus Car"
```

请注意，这种方式还处于早期阶段，因此截至发布此答案之日，预计与旧版本的 Chrome 和其他浏览器不兼容。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-11-07T08:05:07.290

```
var arr = ["Pro1", "Pro2", "Pro3"];
console.log(arr.join());// Pro1,Pro2,Pro3
console.log(arr.join(', '));// Pro1, Pro2, Pro3 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2017-06-01T05:54:53.703

```
var array = ["Zero", "One", "Two"];
var s = array + [];
console.log(s); // => Zero,One,Two 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2019-08-07T14:50:15.603

此解决方案还删除了以下值`" "`：

```
const result = ['', null, 'foo', '  ', undefined, 'bar'].filter(el => {
  return Boolean(el) && el.trim() !== '';
}).join(', ');

console.log(result); // => foo, bar 
```

# .net - 在 .NET 中调用 HttpHandler 文件的最简单方法是什么？

> ID：201734
> 
> 赞同：2
> 
> 时间：2008-10-14T15:49:01.373
> 
> 标签：.net, asp.net, http

我的网络服务器上有一个 HttpHandler，它采用“ [https://servername/myhandler?op=get&k=Internal&m=jdahug1](https://servername/myhandler?op=get&k=Internal&m=jdahug1) ”形式的 URL。我需要从我的 .NET 应用程序中调用此 URL 并捕获任何输出。有谁知道我该怎么做？我希望它很简单，这样我就可以返回一个带有输出的字符串，并且我可以指定我自己的超时时间。

*   谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-14T15:50:01.713

试试 System.Net.WebClient 类。

您可以使用 .DownloadStringAsync() 方法强制超时。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-14T16:00:26.123

Shawn Wildermuth 很好地概述了您拥有的两个选项：WebClient 和 WebRequest ( [http://wildermuth.com/2008/09/27/WebClient_vs_WebRequest_in_Silverlight_2](http://wildermuth.com/2008/09/27/WebClient_vs_WebRequest_in_Silverlight_2) )。WebClient 只是一个更高级别的抽象，可以为您处理更多细节。由于您只是想取回一个字符串，我希望使用 WebClient，正如 Shawn 所描述的，它有一个 DownloadString 方法等待您使用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-14T16:00:07.747

正如乔尔所说，WebClient 会做到这一点..

```
string handlerResponse = new System.Net.WebClient().DownloadString("https://servername/myhandler?op=get&k=Internal&m=jdahug1"); 
```

当然，鉴于您自己的超时和良好做法，您可能不想内联调用，但您明白了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-14T15:56:00.720

我们在产品的后端使用了以下代码（这只是核心代码，没有超时错误处理等）

```
using System.Net;

using System.IO;

HttpWebRequest req = (HttpWebRequest) WebRequest.Create(WebPageUrl);

WebResponse resp = req.GetResponse();

Stream stream = resp.GetResponseStream();

StreamReader reader = new StreamReader(stream);

output.Write(reader.ReadToEnd()); 
```

# sql-server - 质量指标 TFS 2008 报告和多种构建类型

> ID：201735
> 
> 赞同：1
> 
> 时间：2008-10-14T15:49:01.983
> 
> 标签：sql-server, visual-studio-2008, version-control, tfs, reporting-services

在一个项目中，我们有两种构建类型，一种用于持续集成，一种用于运行我们的测试套件。运行质量指标报告时，它会显示来自所有构建的数据，无论构建类型如何。

该报告建议只能在特定构建类型上运行它，但填充构建字段的查询似乎仅在“全部（无过滤器）”作为构建类型参数传入时才有效。

是否可以按构建类型进行过滤，以便只运行带有测试的构建？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-10T23:04:25.657

是的，这是可以做到的。作为概述：

1.  一、创建报表服务器项目
2.  其次，在项目中，为 TfsWarehouse OLAP 数据库创建一个数据源（同样，所有团队系统活动最终都发布到数据仓库，因此您将始终需要使用 TfsWarehouse），并检索您想要的任何报告改变
3.  第三，进行必要的报告更改。您的更改可能是数据更改、报表输入参数更改或报表布局更改。
4.  最后，将报表发布到用户运行报表时 Team Foundation Server 使用的报表服务器

... 这是相当高级的 - 请参阅[PDF：使用 Team System 2008 做出实时决策](http://download.microsoft.com/download/A/B/5/AB5B5163-4A69-49D9-BCF4-D514CE12BF36/Making_Real-Time_Decisions.pdf)以获取详细信息。PDF 直接讨论您所询问的报告。

希望这可以帮助。

# css - 我在哪里可以找到重元素 Web 表单的示例？

> ID：201760
> 
> 赞同：8
> 
> 时间：2008-10-14T15:58:04.693
> 
> 标签：css, layout, webforms

我想看一些具有大量输入字段的良好表单布局（基于 Web）的示例。我做了很多 Web 应用程序开发，而且我的很多表单都输入元素很重，所以我一直在寻找关于如何显示我的表单的好主意。例如，我在页面上有一些列表框和很多文本框和一些下拉菜单，同时显示表单更改的历史记录。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-14T16:01:10.320

每当我需要一些形式灵感时，我总是喜欢访问[Wufoo 。](http://wufoo.com/gallery/)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-14T16:03:24.887

这完全取决于您的重点是数据输入还是用户体验。对于作为主要目标的**数据输入**，我会保持输入框靠得很近，并确保它们与 tab 键配合得很好，这样用户就不必把手从键盘上移开。也可能应该将空间保持在最低限度，并尝试在页面上包含尽可能多的框。

对于**用户体验，**情况正好相反，您需要确保有足够的空间来识别 JavaScript 验证的问题，并确保表单对新用户和高级用户一样好用。高级用户 == 大量数据输入用户。

[Wufoo](http://wufoo.com)在用户体验方面非常好，但对于我上面提到的数据输入用户来说效果不佳。因为用户必须停下来点击一个按钮。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-14T21:14:33.230

Smashing Magazine 很好地汇总了基于 CSS 的表单灵感/技术/教程。

[在这里](http://www.smashingmagazine.com/2006/11/11/css-based-forms-modern-solutions/)查看。

# jquery - 在一个应用程序中将 jQuery 和 YUI 混合在一起，这很容易吗？

> ID：201768
> 
> 赞同：18
> 
> 时间：2008-10-14T16:00:00.930
> 
> 标签：jquery, asp.net-mvc, yui

我必须以我喜欢 jQuery 作为 JavaScript 语言扩展和 YUI 作为一组丰富的免费控件的事实作为开头。所以这是我的问题，如果我在我正在开发的 MVC 应用程序中将 jQuery 和 YUI 混合在一起，是否会有任何问题。

我想使用 jQuery 来处理 DOM 的繁重工作，并且我想使用 YUI 来处理丰富的用户控件集。这是一个内部应用程序，在我工作的组织之外永远不会出现。

如果有人有混合这两个框架的经验，我很想听听你的经验。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-14T16:07:46.717

从我自己开发一个小工具的一些经验来看，我过去曾使用 YUI 丰富的控件集和 Prototype 进行 DOM 操作，并且没有遇到任何问题。诚然，这是一个没有使用大量控件的小工具。

即便如此，我总是对在我的 Web 项目中使用多个框架犹豫不决；但是，如果您只使用 jQuery 的 DOM 功能和 YUI 的控制功能，那么我认为您很好 - 那里并没有真正的利益冲突。另外，由于 jQuery 的 noConflict() 模式和 YUI 的命名空间，这两个框架真的不应该互相胜过对方。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-01-07T12:24:06.270

这是一个老问题，但想在这个主题上添加一个指向 jQuery 文档的链接......

[http://docs.jquery.com/Using_jQuery_with_Other_Libraries](http://docs.jquery.com/Using_jQuery_with_Other_Libraries)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-14T19:33:48.363

我经常使用带有 YUI 的 jQuery（jQuery 用于大多数事情，YUI 用于 UI 元素），没有任何问题。

请注意，YUI 3 将引入 jQuery 样式选择器和链接：

[http://developer.yahoo.com/yui/3/](http://developer.yahoo.com/yui/3/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-14T16:12:46.850

我认为这应该不是问题，因为 YUI 都包含在“命名空间”中，所以它不应该破坏任何东西（我不知道 jquery 是否破坏了 YUI 周围的东西，但只要它不扩展基本对象应该没有问题）。我记得 Dustin Diaz 推出了一个类似于 jquery 并围绕 YUI 构建的库： [http](http://www.dustindiaz.com/introducing-ded-chain/) ://www.dustindiaz.com/introducing-ded-chain/ 我现在尝试下载它，但该站点现在离线。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-05-15T10:46:07.973

是的，在 YUI 旁边使用 jquery 绝对是可能的，特别是因为 jquery 和 YUI 都采取了强有力的措施来防止全局命名空间污染。然而，实现这样的组合不必要地提供了许多冗余功能。我会敦促你使用 YUI3，它提供了 Jquery 的大部分功能等等。YUI3 的语法更加简洁明了，并且有很好的文档记录。但是，您可能正在使用一些 jquery 插件，其 YUI 替代方案不可用。在这种情况下，我建议您查看 Jquery UI 或 wijmo 以满足您的 UI 需求，或者使用像 UKI 这样的轻量级 UI 工具包。或者，您还可以查看具有可用 Jquery 适配器的 ExtJS，通过它您可以利用您对 jquery 的熟悉以及 extjs 的丰富小部件。

# c# - 当我按 Enter 时提交登录控制按钮

> ID：201776
> 
> 赞同：23
> 
> 时间：2008-10-14T16:00:41.817
> 
> 标签：c#, asp.net, .net, login-control, defaultbutton

我有一个带有登录控件的 ASP.NET 网页。当我按 Enter 时，登录按钮不会触发；相反，页面提交，什么都不做。

我在网上找到的标准解决方案是将登录控件包含在面板中，然后设置面板默认按钮。但显然，如果页面有母版页，那效果就不太好了。我尝试在代码中使用*控件*.ID、*控件*.ClientID 和*控件*.UniqueID 设置默认按钮，并且在每种情况下我都得到：

> panelName 的 DefaultButton 必须是 IButtonControl 类型的控件的 ID。

我确信有一种方法可以使用 JavaScript 来做到这一点，但如果可能的话，我真的很想用普通的旧 C# 代码来做到这一点。是否可以？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-10-14T16:30:01.120

这应该会有所帮助：[http ://weblogs.asp.net/jgalloway/archive/2007/10/03/asp-net-setting-the-defaultbutton-for-a-login-control.aspx](http://weblogs.asp.net/jgalloway/archive/2007/10/03/asp-net-setting-the-defaultbutton-for-a-login-control.aspx)

您可以使用以下内容来引用登录控件模板中的按钮：

```
DefaultButton="Login$LoginButton" 
```

基本上，您不仅可以在表单级别定义 DefaultButton，还可以在单​​个面板级别定义 DefaultButton，只要焦点在面板内，如果您按“Enter”，将使用面板的默认按钮

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-12T01:54:05.613

**混合大师**的好答案！本质上只是使用 Panel.DefaultButton，但我想澄清一下您需要将其设置为什么的困惑。它不仅仅是“.ID”或“.UniqueID”——文档在这方面有点缺乏。

您必须将其设置为按钮的 UniqueID，*相对于*面板的命名容器 UniqueID。例如，如果您的面板 UniqueID 是“Body$Content$pnlLogin”并且您的登录按钮的 UniqueID 是“Body$Content$ucLogin$btnLogin”（因为它位于名为“ucLogin”的控件内），那么您需要将 Panel.DefaultButton 设置为“ucLogin$btnLogin”。

您可以在代码中解决此问题，如下所示。（我找不到任何类库方法，但如果你找到了，请告诉我。）

```
void SetDefaultButton(Panel panel, IButtonControl button)
{
    string uniqueId = ((Control)button).UniqueID;
    string panelIdPrefix = panel.NamingContainer.UniqueID + Page.IdSeparator;

    if (uniqueId.StartsWith(panelIdPrefix))
    {
        uniqueId = uniqueId.Substring(panelIdPrefix.Length);
    }

    panel.DefaultButton = uniqueId;
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-14T16:10:27.273

你必须在页面加载中添加这样的东西......

```
txtPassword.Attributes.Add("onKeyPress", "javascript:if (event.keyCode == 13) __doPostBack('" + lnkSubmit.UniqueID + "','')") 
```

密码文本框添加了一个 onKeyPress 属性，如果按下“Enter”键，它将在提交按钮上强制执行 doPostBack。这模拟了单击提交按钮。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-14T16:26:51.000

听起来登录按钮被吐出`<input type="button">`而不是`<input type="submit">`. 您始终可以对 LoginControl 进行模板化并添加提交按钮，同时摆脱可怕的默认标记！

如果你必须使用 Javascript 来解决这个问题，那就大错特错了！（但听起来你知道这一点）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-06-10T13:32:33.333

哟，我在网上找到了这个解决方案，它对我有用。

```
 <asp:Panel ID="panelLogin" runat="server" DefaultButton="Login1$LoginButton">
 <asp:Login ID="Login1" runat="server" >
 <LayoutTemplate>
 ...
 <asp:Button  ID="LoginButton" .../>
 </LayoutTemplate>
 </asp:Login>
 </asp:Panel> 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-08-05T21:28:16.337

假设 Login1 是您的登录控件的 ID。

要在页面上的任何位置“输入”以提交，请在您的代码隐藏中添加到 init：

```
protected void Page_Init(object sender, EventArgs e)
{
    this.Form.DefaultButton = Login1.FindControl("LoginButton").UniqueID;
} 
```

对于“输入”仅在登录控件内提交，将登录控件包装在 asp:Panel 中并 `DefaultButton="Login1$LoginButton"`在面板上设置

这两种方法都适用于母版页。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-21T15:14:02.463

根据您的好答案，制作了一个自定义控件，
使页面能够根据焦点所在的面板具有多个默认按钮。
它覆盖 Panel 的 OnLoad 方法和 DefaultButton 属性。

```
public class DefaultButtonPanel:Panel
{
    protected override void OnLoad(EventArgs e)
    {
        if(!string.IsNullOrEmpty(DefaultButton))
        {
            LinkButton btn = FindControl(DefaultButton) as LinkButton;
            if(btn != null)
            {
                Button defaultButton = new Button {ID = DefaultButton.Replace(Page.IdSeparator.ToString(), "_") + "_Default", Text = " "};
                defaultButton.Style.Add("display", "none");
                PostBackOptions p = new PostBackOptions(btn, "", null, false, true, true, true, true, btn.ValidationGroup);
                defaultButton.OnClientClick = Page.ClientScript.GetPostBackEventReference(p) + "; return false;";
                Controls.Add(defaultButton);
                DefaultButton = defaultButton.ID;
            }
        }
        base.OnLoad(e);
    }

    /// <summary>
    /// Set the default button in a Panel.
    /// The UniqueID of the button, must be relative to the Panel's naming container UniqueID. 
    /// 
    /// For example:
    /// Panel UniqueID is "Body$Content$pnlLogin" 
    /// Button's UniqueID is "Body$Content$ucLogin$btnLogin" 
    /// (because it's inside a control called "ucLogin") 
    /// Set Panel.DefaultButton to "ucLogin$btnLogin".
    /// </summary>
    /// <param name="panel"></param>
    /// <param name="button"></param>
    public override string DefaultButton
    {
        get
        {
            return base.DefaultButton;
        }

        set
        {
            string uniqueId = value;
            string panelIdPrefix = this.NamingContainer.UniqueID + Page.IdSeparator;
            if (uniqueId.StartsWith(panelIdPrefix))
            {
                uniqueId = uniqueId.Substring(panelIdPrefix.Length);
            }
            base.DefaultButton = uniqueId;
        }
    }      
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-12-24T04:36:05.937

通过将登录控件嵌入到面板控件中并将`defaultbutton`面板的设置为登录控件内`Parent$ID`的按钮的 ，提供了一种解决方案。有代码：

```
<asp:Panel id="panel1" runat="server" DefaultButton="Login1$LoginButton">
<asp:Login ID="Login1" runat="server" BackColor="#F7F6F3">
<LayoutTemplate>
<table>
...
<tr>
<td><asp:Button ID="LoginButton" runat="server" /></td>
</tr>
</table>
</LayoutTemplate>
</asp:Login>
</asp:Panel> 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-07-26T17:12:27.807

**要在上面的帖子中添加更多细节和说明，这里有一个演练：**

在加载登录控件的任何页面的标记中，您需要在两个地方更新 html。

首先，在页面的表单标签中，需要设置默认按钮。请参阅下文，了解我是如何想出这个名字的。

```
<form id="form1" runat="server" defaultbutton="ucLogin$btnSubmit"> 
```

（命名：美元符号之前的 ucLogin 部分需要是您的登录控件的 ID，正如在您的页面中进一步声明的那样。btnSubmit 部分需要是按钮的 ID，因为它在登录控件的 html 中命名）

接下来，您需要将登录控件的声明包装在一个面板中，并设置它的 DefaultButton 属性：

```
<!-- Login Control - use a panel so we can set the default button -->
<asp:Panel runat="server" ID="loginControlPanel" DefaultButton="ucLogin$btnSubmit">                         
     <uc:Login runat="server" ID="ucLogin"/>                                                    
</asp:Panel> 
```

那应该为你做。

# sql-server - SQL Server 2005 按大小自动增长

> ID：201777
> 
> 赞同：3
> 
> 时间：2008-10-14T16:01:00.540
> 
> 标签：sql-server, sql-server-2005

我一直在查看我们为客户端设置的新数据库服务器，并注意到每次文件已满且初始大小为 100 MB 时，数据库文件设置为增长 1 兆。

我一直在考虑这个，听起来不太对。我检查了一些关于数据库注意事项的网站，但他们没有正确解释这些值。

我可能只希望数据库文件每月扩展一次，我们可以说吗？

因此，如果我要计算我希望每天插入的数据量（以兆字节为单位），然后乘以 30，我应该找到一个合适的数字吗？

即我确实知道大约 1 行的大小以及每个表平均每周将插入多少行。我知道这些是从头开始的估计，所以您认为每月一次是文件扩展的合适近似值，还是最好每小时扩展一次>？还是从不？

我们正在使用完全备份，因此我们可以恢复到某个时间点，并且正在进行事务日志备份，并且恢复过程似乎是 100% 有效的。这些类型的更改是否会以任何方式影响备份和恢复？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-14T16:04:50.360

你所建议的几乎是正确的。您希望自动增长基于您期望看到的内容。

每次满时自动增长 1Mb 的数据库会遇到巨大的性能问题，因为每次数据库满时，正在进行的任何事务都必须暂停，直到它增长为止。

我正在尝试找到我之前阅读过的关于该主题的文章，所以当我找到它时，我会添加一个链接......

编辑：[http](http://searchsqlserver.techtarget.com/tip/0,289483,sid87_gci1330922,00.html "你能把你的数据库缩小到死吗？") ://searchsqlserver.techtarget.com/tip/0,289483,sid87_gci1330922,00.html 这篇文章是关于缩小数据库的，但它详细说明了数据库自动增长时会发生什么，并显示了它可以对性能产生的影响有。

您绝对不希望您的数据库像 1Mb 一样频繁地增长！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-07-12T14:03:27.063

在我看来，我不会将数据库设置为按百分比增长，而是让数据库以 100 MB 增长一周，然后将增长设置更改为一周的增长，比如 5 GB。我们有为此做过的系统。

否则，您可以获得真正的技术知识，查看每周有多少记录添加到系统中，考虑存档或删除的记录，然后计算每条记录所需的空间量，并根据该时间设置自动增长记录数。

我会引导一个人远离百分比增长的原因是，当系统为 1000 MB 时，它将增长 100 MB。然后，下一次，系统是 1100 MB，并将增加我的 110 MB。然后大小将是 1210，数据库将增长到 121 MB。然后大小为 1331，增长为 133 MB。由于这种不均衡的增长，计算剩余的磁盘空间以及何时需要重新调整最大设置将变得非常困难。

只有我的 2 美分。

此外，上面提到的默认增长是在 MODEL 数据库中设置的。当您创建新数据库时，您的 MODEL 数据库所具有的任何设置都是新数据库中的默认设置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T16:05:44.897

尽量减少数据库必须增长的次数通常是正确的。

我不能给你任何确切的值，但最好让数据库文件大小这么大，你只需要偶尔增加它，然后它必须大幅增加，这样你就不会经常更改文件大小。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-14T16:08:46.437

每次数据文件必须增长时，它都会占用一些资源，因为它会占用额外的磁盘空间并扩展数据文件。因此，理想情况下，您希望限制增长的数量。

就个人而言，我尽量确保我的数据库根本不需要自动增长。我尝试在下班时间主动种植它们。这也让我可以更好地监控磁盘空间，因为它不容易“自动增长”；）

如果他们每月自动增长一次，那应该没问题。每分钟，您都可能会看到性能影响。

除了备份可能会占用更多空间并填满您的备份位置之外，我想不出任何原因会导致备份过程出现问题。我更像是一个 SQL 开发人员而不是 DBA，所以我不能发誓。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-14T16:12:13.917

除了一些多余的分配空间外，大尺寸增量几乎没有或没有缺点。将增量设置为使其每月或几个月增长的大小是正确的。

在任何情况下，您都应该有一个定期的工作来监控磁盘卷和文件中的可用空间并生成报告，以便您可以看到即将发生的磁盘短缺。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-14T16:23:14.533

我刚刚检查了 SQL Server Management Studio 2008，创建新数据库时的默认增长是 1MB ......这可能就是你的 1MB 设置的来源（我敢打赌，在 2005 年也是如此）。

我记得很久以前读过一篇文章，有人可以考虑将他们的数据库文件设置为每次需要增长时加倍。现在，如果你有一个 5TB 的数据库，你可能不希望它一天翻一番，但是对于一个 1GB 大小的数据库，如果它在需要时翻倍可能会很酷（如果你有一个衰减率的增长事件具有恒定的数据输入速率）。

只是想提出我认为可行的策略，当然，这取决于你的情况。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-06T09:02:52.887

当我们不确定一天或一周内可能添加的数据的实际大小时，建议以百分比设置文件增长（最佳为 5% 到 10%）。在这种情况下，文件的增长将与数据库的大小成正比。

# visual-studio - 我可以使用 C# 在 Visual Studio 2005 中创建透明按钮吗

> ID：201778
> 
> 赞同：6
> 
> 时间：2008-10-14T16:01:00.773
> 
> 标签：visual-studio, visual-studio-2005, user-interface, button, transparent

我有一个用户界面，需要在 C# 项目中放置一些圆形按钮，并在它们后面放置一些数据。这些按钮是 System.Windows.Forms.buttons，我使用了具有透明度的 GIF 图像来创建它们。但是，透明区域不透明。我在网上查找了参考资料，但没有找到有关如何正确执行此操作的任何建议。有人提到在 Visual Studio 2008 中这样做，但我需要在 2005 年保留这个项目。感谢任何帮助或建议。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-06-13T13:46:21.560

只需将 Button 的[FlatStyle 属性](http://msdn.microsoft.com/en-us/library/system.windows.forms.buttonbase.flatstyle.aspx)设置为“Flat”……瞧！我知道这适用于 PNG，但我还没有用 GIF 测试过。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T16:08:59.180

我很确定您需要使用带有 WinForms 的 PNG 来获得图像透明度。我知道我已经成功地使用了它们。

编辑：当我使用 PNG 时，我将它们与 Image 控件叠加到 Form1.BackgroundImage 上；我没有在按钮中使用它们。

我认为你最好的选择是从使用按钮控件切换到使用图像控件。您也可以尝试将按钮样式更改为扁平（我认为它是扁平的，也许是其他样式之一），看看您是否可以通过这种方式获得您想要的效果。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-17T03:31:39.263

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Windows.Forms;
using System.Drawing;

public class TransparentControl : Control
{
    public TransparentControl()
    {
        SetStyle(ControlStyles.SupportsTransparentBackColor, true);
        SetStyle(ControlStyles.Opaque, true);
        SetStyle(ControlStyles.ResizeRedraw, true);
        this.BackColor = Color.Transparent;
    }

    protected override void OnPaint(PaintEventArgs pevent)
    {
        Graphics g = pevent.Graphics;
        g.DrawRectangle(Pens.Black, this.ClientRectangle);
    }

    protected override void OnPaintBackground(PaintEventArgs pevent)
    {
        // don't call the base class
        //base.OnPaintBackground(pevent);
    }

    protected override CreateParams CreateParams
    {
        get
        {
            const int WS_EX_TRANSPARENT = 0x20;
            CreateParams cp = base.CreateParams;
            cp.ExStyle |= WS_EX_TRANSPARENT;
            return cp;
        }
    }

    // rest of class here...
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-11-15T09:13:29.590

尝试这个：

```
 Bitmap temp = new Bitmap(button1.Image);

        temp.MakeTransparent(Color.Black); //your transparent color, in this case black

        button1.Image = (Image) Logo;

        temp.Dispose();

        temp = null; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-05-24T12:52:27.437

以下答案在 Visual Studio 2012 中得到验证，适用于 backgroundImage 格式 BMP、GIF、PNG 以及 JPG；由 MS Paint 创建。

通过按钮使背景可见：

转到按钮的属性窗口。然后更改 FlatStyle 和 BackColor，如下图所示：

![FlatStyle 将被选为 Flat](https://i.stack.imgur.com/3H3Pr.jpg)

![颜色是从 Web Tab 中选择的](https://i.stack.imgur.com/lteCo.jpg)

注意：颜色要从 Web 选项卡中选择，而平面样式要选择为平面。

但在此之后，按钮将是透明的，直到鼠标不悬停或被选中或按下。在这种情况下，它将是一些不透明的颜色。如果你想让它总是透明的，按照下面的图片，像以前一样把对应的颜色改成透明的。要更改的颜色是：“MouseOverBackColor”和“MouseDownBackColor”。

![在此处输入图像描述](https://i.stack.imgur.com/7Cu16.jpg)

![在此处输入图像描述](https://i.stack.imgur.com/jjKKD.jpg)

注意：如果您选择始终透明，如图所示，按钮的外观将不会发生变化，同时它会起作用！

希望它会帮助你。

祝你好运！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-22T22:18:07.590

您需要将按钮的 BackColor 属性设置为“透明”。

Button1.BackColor = System.Drawing.Color.Transparent;

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-05T16:45:45.933

创建一个从按钮派生的类并放置此代码。

```
 protected override CreateParams CreateParams
    {
        get
        {
            const int WS_EX_TRANSPARENT = 0x20;
            CreateParams cp = base.CreateParams;
            cp.ExStyle |= WS_EX_TRANSPARENT;
            return cp;
        }
    } 
```

并在创建方法中

```
 SetStyle(ControlStyles.SupportsTransparentBackColor, true);
        SetStyle(ControlStyles.Opaque, true);
        this.BackColor = Color.Transparent; 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-07-24T02:24:10.317

我正在使用 Visual Studio 2005 并尝试按照上面的示例进行操作，但它不起作用（创建方法中的片段）。我的表单有背景，并且正在尝试创建斜面透明按钮。

当前插入上面的代码使我的背景透明，我的按钮全是白色的。

这是我的代码片段

```
 Bitmap mainFormBackground = (Bitmap)Image.FromFile("background.jpg");
        this.BackgroundImage = mainFormBackground;
        this.BackColor = Color.Black;
        this.ForeColor = Color.White; 
```

添加一些按钮

```
 SetStyle(ControlStyles.SupportsTransparentBackColor, true);
        SetStyle(ControlStyles.Opaque, true);
        this.BackColor = Color.Transparent; 
```

我什至试过

```
 btnName.BackColor = Color.Transpare; 
```

这也行不通

# localization - 您知道任何本地化为西班牙语的 IDE 吗？

> ID：201780
> 
> 赞同：1
> 
> 时间：2008-10-14T16:01:54.343
> 
> 标签：localization, ide

我有一个朋友在语言障碍方面遇到了困难。我试图想出任何也有西班牙语版本的 IDE，但什么也想不出来。有任何想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-14T16:05:02.403

Microsoft Visual Studio 提供西班牙语版本
[http://en.wikipedia.org/wiki/Microsoft_Visual_Studio](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio)
[http://msdn.microsoft.com/en-gb/vstudio/default.aspx](http://msdn.microsoft.com/en-gb/vstudio/default.aspx)

msdn 页面的西班牙语版本：http:
[//msdn.microsoft.com/es-es/vstudio/default.aspx](http://msdn.microsoft.com/es-es/vstudio/default.aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-14T16:06:19.687

[Eclipse](http://www.eclipse.org/downloads/)有一个西班牙语语言包[西班牙语语言包](http://archive.eclipse.org/eclipse/downloads/drops/L-3.2_Language_Packs-200607121700/index.php)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-14T16:11:05.463

[Netbeans 也提供西班牙语版本](http://www.netbeans.org/index_es.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-14T16:04:51.903

Visual Studio 可用于大多数“第一层”语言，包括西班牙语和日语。但是，并非所有文档都被翻译。

# json - 您可以在 JSON 对象中使用尾随逗号吗？

> ID：201782
> 
> 赞同：436
> 
> 时间：2008-10-14T16:02:15.823
> 
> 标签：json, syntax, delimiter

手动生成 JSON 对象或数组时，通常更容易在对象或数组的最后一项上留下逗号。例如，从字符串数组输出的代码可能如下所示（在类似 C++ 的伪代码中）：

```
s.append("[");
for (i = 0; i < 5; ++i) {
    s.appendF("\"%d\",", i);
}
s.append("]"); 
```

给你一个字符串

```
[0,1,2,3,4,5,] 
```

这是允许的吗？

* * *

## 回答 #1

> 赞同：285
> 
> 时间：2008-10-14T16:19:55.650

不幸[的是，JSON 规范](http://www.json.org/)不允许尾随逗号。有一些浏览器允许它，但通常您需要担心所有浏览器。

一般来说，我会尝试解决问题，并在实际值之前添加逗号，因此您最终会得到如下所示的代码：

```
s.append("[");
for (i = 0; i < 5; ++i) {
  if (i) s.append(","); // add the comma only if this isn't the first entry
  s.appendF("\"%d\"", i);
}
s.append("]"); 
```

你的 for 循环中额外的一行代码并不昂贵......

从某种形式的字典向 JSON 输出结构时，我使用的另一种替代方法是始终在每个条目后附加一个逗号（如您在上面所做的那样），然后在末尾添加一个没有尾随逗号的虚拟条目（但是那只是懒惰；->）。

不幸的是，它不适用于数组。

* * *

## 回答 #2

> 赞同：139
> 
> 时间：2008-10-14T16:02:34.530

[不可以。在http://json.org](http://json.org)维护的 JSON 规范不允许尾随逗号。据我所见，一些解析器在读取 JSON 字符串时可能会默默地允许它们，而其他解析器会抛出错误。为了互操作性，您不应包含它。

上面的代码可以重新构造，或者在添加数组终止符时删除尾随逗号，或者在项目之前添加逗号，跳过第一个。

* * *

## 回答 #3

> 赞同：114
> 
> 时间：2011-12-16T07:38:36.850

简单，便宜，易于阅读，并且无论规格如何都始终有效。

```
$delimiter = '';
for ....  {
    print $delimiter.$whatever
    $delimiter = ',';
} 
```

对 $delim 的冗余分配是一个非常小的代价。如果没有显式循环但单独的代码片段也同样有效。

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2012-07-15T20:18:18.400

JavaScript 中允许使用尾随逗号，但在 IE 中不可用。Douglas Crockford 的无版本 JSON 规范不允许它们，因为它是无版本的，所以不应该改变。ES5 JSON 规范允许它们作为扩展，但 Crockford 的[RFC 4627](https://www.rfc-editor.org/rfc/rfc4627)没有，并且 ES5 恢复为不允许它们。[Firefox](http://whereswalden.com/2010/09/08/spidermonkey-json-change-trailing-commas-no-longer-accepted/)紧随其后。Internet Explorer 是我们无法拥有美好事物的原因。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2014-04-12T17:06:51.343

正如已经说过的，JSON 规范（基于 ECMAScript 3）不允许尾随逗号。ES >= 5 允许它，因此您实际上可以在纯 JS 中使用该符号。有人争论过，一些解析器[确实](http://whereswalden.com/2010/09/08/spidermonkey-json-change-trailing-commas-no-longer-accepted/)*支持*它（[http://bolinfest.com/essays/json.html，http://whereswalden.com/2010/09/08/spidermonkey-json-change-trailing-commas-](http://bolinfest.com/essays/json.html) [no-longer-accepted/](http://whereswalden.com/2010/09/08/spidermonkey-json-change-trailing-commas-no-longer-accepted/)），但规范事实（如[http://json.org/](http://json.org/)所示）它*不应该*在 JSON 中工作。那句话说...

...我想知道为什么没有人指出您实际上可以在第 0 次迭代时拆分循环并使用*前导*逗号而不是尾随逗号来消除比较代码气味和循环中的任何实际性能开销，从而导致与提出的其他解决方案相比，代码实际上更短、更简单和更快（由于循环中没有分支/条件）。

例如（在类似于 OP 提议的代码的 C 风格的伪代码中）：

```
s.append("[");
// MAX == 5 here. if it's constant, you can inline it below and get rid of the comparison
if ( MAX > 0 ) {
    s.appendF("\"%d\"", 0); // 0-th iteration
    for( int i = 1; i < MAX; ++i ) {
        s.appendF(",\"%d\"", i); // i-th iteration
    }
}
s.append("]"); 
```

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2008-10-16T07:26:38.813

PHP 编码人员可能想查看**implode()**。这需要一个数组使用字符串将其连接起来。

从[文档](http://www.php.net/implode)...

```
$array = array('lastname', 'email', 'phone');
echo implode(",", $array); // lastname,email,phone 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2008-10-14T17:29:36.193

有趣的是，C 和 C++（我认为是 C#，但我不确定）都特别允许尾随逗号 - 正是因为给出的原因：它使以编程方式生成列表变得更加容易。不知道为什么 JavaScript 没有跟随他们的领导。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2014-08-24T07:35:55.217

使用 JSON5。不要使用 JSON。

*   对象和数组可以有尾随逗号
*   如果对象键是有效标识符，则可以不加引号
*   字符串可以单引号
*   字符串可以分成多行
*   数字可以是十六进制（以 16 为基数）
*   数字可以以（前导或尾随）小数点开始或结束。
*   数字可以包括 Infinity 和 -Infinity。
*   数字可以以明确的加号 (+) 开头。
*   内联（单行）和块（多行）注释都是允许的。

[http://json5.org/](http://json5.org/)

[https://github.com/aseemk/json5](https://github.com/aseemk/json5)

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2020-09-25T14:13:03.573

我不会参加辩论俱乐部，而是申请`Defensive Programming`并利用这两种技术：

*   作为**接收**json 数据的应用程序的开发人员，我会**放松**并**允许**尾随逗号。

*   **在开发编写**json的应用程序时，我会很**严格**，并使用其他答案中的一种巧妙技术，仅在项目之间添加逗号并**避免**尾随逗号。

还有更大的问题需要解决……

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2018-11-18T15:00:52.390

有一种可能的方法可以避免循环中的 if 分支。

```
s.append("[ "); // there is a space after the left bracket
for (i = 0; i < 5; ++i) {
  s.appendF("\"%d\",", i); // always add comma
}
s.back() = ']'; // modify last comma (or the space) to right bracket 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2020-07-15T07:35:54.273

[不。https://json.org](https://json.org)中的“铁路图”是规范的精确翻译，并明确表示 a`,`总是出现在 a 之前`value`，而不是直接在之前`]`：

[![阵列的铁路图](https://i.stack.imgur.com/1CcmB.png)](https://i.stack.imgur.com/1CcmB.png)

或`}`：

[![对象的铁路图](https://i.stack.imgur.com/DQhz5.png)](https://i.stack.imgur.com/DQhz5.png)

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2015-04-22T09:14:09.063

根据[Class JSONArray 规范](http://www.json.org/javadoc/org/json/JSONArray.html)：

*   额外的 ,（逗号）可能出现在右括号之前。
*   当存在 ,（逗号）省略时，将插入空值。

所以，据我了解，它应该被允许写成：

```
[0,1,2,3,4,5,] 
```

但可能会发生某些解析器将 7 作为项目计数返回（如 Daniel Earwicker 指出的 IE8）而不是预期的 6。

* * *

编辑：

我发现这个[JSON Validator根据](http://www.freeformatter.com/json-validator.html)[RFC 4627](https://www.rfc-editor.org/rfc/rfc4627)（JavaScript Object Notation 的应用程序/json 媒体类型）和 JavaScript 语言规范验证 JSON 字符串。实际上，此处带有尾随逗号的数组被认为仅对 JavaScript 有效，而对 RFC 4627 规范无效。

但是，在 RFC 4627 规范中声明：

> 2.3\. 数组
> 
> 数组结构表示为围绕零个或多个值（或元素）的方括号。元素用逗号分隔。
> 
> ```
> array = begin-array [ value *( value-separator value ) ] end-array 
> ```

对我来说，这又是一个解释问题。如果你写*元素是用逗号分隔的*（没有说明一些特殊情况，比如最后一个元素），它可以用两种方式来理解。

PS RFC 4627 不是标准（如明确说明的那样），并且已被 RFC 7159（这是一个提议的标准）[RFC 7159 废弃](https://www.rfc-editor.org/rfc/rfc7159)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2017-11-01T21:35:40.897

不推荐，但你仍然可以做这样的事情来解析它。

```
jsonStr = '[0,1,2,3,4,5,]';
let data;
eval('data = ' + jsonStr);
console.log(data)
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2018-02-08T02:05:49.810

使用轻松 JSON，您可以使用尾随逗号，**或者将逗号省略**。它们是可选的。

完全没有理由需要使用逗号来解析类似 JSON 的文档。

看看Relaxed JSON 规范，你会看到原始的JSON 规范是多么的“嘈杂”。太多的逗号和引号...

[http://www.relaxedjson.org](http://www.relaxedjson.org)

您还可以使用此在线 RJSON 解析器尝试您的示例，并查看它是否被正确解析。

[http://www.relaxedjson.org/docs/converter.html?source=%5B0%2C1%2C2%2C3%2C4%2C5%2C%5D](http://www.relaxedjson.org/docs/converter.html?source=%5B0%2C1%2C2%2C3%2C4%2C5%2C%5D)

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2019-11-15T13:47:54.597

如前所述，这是不允许的。但在 JavaScript 中是：

```
var a = Array()
for(let i=1; i<=5; i++) {
    a.push(i)
}
var s = "[" + a.join(",") + "]" 
```

（在 Firefox、Chrome、Edge、IE11 中运行良好，并且在 IE9、8、7、5 中没有 let）

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-11-11T21:26:29.527

我保留当前计数并将其与总计数进行比较。如果当前计数小于总计数，则显示逗号。

如果您在执行 JSON 生成之前没有总计数，则可能无法工作。

再说一次，如果您使用 PHP 5.2.0 或更高版本，您可以使用内置的 JSON API 格式化您的响应。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2011-10-14T15:59:24.593

根据我过去的经验，我发现不同的浏览器以不同的方式处理 JSON 中的尾随逗号。

Firefox 和 Chrome 都处理得很好。但 IE（所有版本）似乎坏了。我的意思是真的打破并停止阅读脚本的其余部分。

牢记这一点，以及编写兼容代码总是很好的事实，我建议花额外的精力确保没有尾随逗号。

:)

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2019-03-01T03:34:54.607

由于 for 循环用于迭代数组或类似的可迭代数据结构，我们可以使用数组的长度，如图所示，

```
awk -v header="FirstName,LastName,DOB" '
  BEGIN {
    FS = ",";
    print("[");
    columns = split(header, column_names, ",");
  }
  { print("  {");
    for (i = 1; i < columns; i++) {
      printf("    \"%s\":\"%s\",\n", column_names[i], $(i));
    }
    printf("    \"%s\":\"%s\"\n", column_names[i], $(i));
    print("  }");
  }
  END { print("]"); } ' datafile.txt 
```

使用 datafile.txt 包含，

```
 Angela,Baker,2010-05-23
 Betty,Crockett,1990-12-07
 David,Done,2003-10-31 
```

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2008-12-11T10:06:49.620

我通常遍历数组并在字符串中的每个条目后附加一个逗号。在循环之后，我再次删除最后一个逗号。

也许不是最好的方法，但比每次检查它是否是我猜的循环中的最后一个对象要便宜。

# architecture - 数据访问层：公开列表<>：坏主意？

> ID：201791
> 
> 赞同：3
> 
> 时间：2008-10-14T16:03:01.050
> 
> 标签：architecture, list, ienumerable, data-access-layer, ilist

我目前正在编写一个简单的数据访问层，我想知道应该向其他层公开哪种类型。

我将在内部将数据实现为 List<>，但我记得读过一些关于在不需要时不将 List 类型公开给消费者的内容。

```
public List<User> GetAllUsers() // non C# users: that means List of User :) 
```

你知道为什么（谷歌没有帮助）？你通常会为那种东西暴露什么？列表？可数？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-14T16:05:08.050

通常最好公开用户仍然可以有意义地使用的最不强大的界面。如果用户只需要一些可枚举的数据，返回`IEnumerable<User>`. 如果这还不够，因为用户需要能够修改列表（注意！不应该经常这样），返回一个`IList<User>`.

## /编辑：

Joel 在他的评论中提出了一个有效的问题：为什么确实公开最不强大的界面而不是授予用户最大的权力？（转述）

这背后的想法是返回数据的方法可能不希望用户修改其内容：该类的另一个方法可能仍然希望列表在返回对它的引用后不为空。想象一下，用户从列表中删除了所有数据。另一种方法现在必须额外检查 ele 可能是不必要的。

更重要的是，这通过返回类型公开了部分内部实现。如果将来我需要更改实现以使其不再使用`IList`容器，我有一个问题：我要么需要更改方法契约，要么引入构建中断的更改。或者我需要将数据复制到列表容器中。

例如，假设一个有效的实现使用 Dictionary 并且只返回`Values`没有实现的集合`IList`。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-14T16:04:57.270

绝对是 ISomething。使用接口将减少耦合，并使更改数据层实现的细节变得更容易。哪个接口视情况而定。IList 很好，但有时您可能需要 ICollection 功能或想要指定只读值。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-14T16:13:52.323

在返回 IEnumerable 之前，您应该仔细考虑。如果底层代码使用“yield”来生成 IEnumerable，或者使用 LINQ，那么您最终将保持打开所有使用的资源。

您应该在返回之前将 IEnumerable 复制到另一个 IEnumerable 中。通过使用 IList，您可以将此作为一项要求，这样任何人都不会无意中返回一个 IEnumerable。

另一方面，返回 IList 意味着调用者可以更改返回的列表。

# asp.net - 从安全页面上的 asp.net 控件返回的不安全回发，同时避免身份验证

> ID：201796
> 
> 赞同：3
> 
> 时间：2008-10-14T16:03:44.697
> 
> 标签：asp.net, security, asp.net-2.0

我们正在使用标准的 asp.net 表单身份验证。某些页面需要用户登录；并且这些页面中至少有一些是通过 https 传递的。每个页面的顶部都有一个搜索控件。使用这个时，我们不关心用户的会话是否过期，即使当前页面需要登录。

但是，目前，在执行搜索时，内置表单身份验证会看到被发布到的页面需要身份验证，并将用户重定向到登录页面，并以前一页*而不是搜索结果页*作为引荐来源。

绕过这里的安全性的最佳方法是什么？我考虑过使用 PostBackUrl 属性发布到不同的页面，但如果这不是 https，您会收到“您正在将数据发布到不安全的连接”消息，这是用户不喜欢的。

谢谢你的帮助。

编辑：感谢尼克关于在搜索页面上使用 GET 的建议。我们已经这样做了，但是查询字符串是由搜索输入控件构造然后重定向的。我们如何在不使用回发的情况下构建查询字符串？（显然 javascript 是一种选择，但我希望找到一种替代机制。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T16:10:07.790

对于搜索页面，您要确保搜索是通过 GET 请求进行的。（例如，查询字符串中带有“q”的 google）您可能正在执行 POST。

所以改变你的

```
<form method="post" ...> 
```

到

```
<form method="get" ...> 
```

大多数开发人员在搜索页面上犯的最大错误是回帖。HTTP 旨在通过查询字符串（因此名称）进行查询或搜索，并获得一个表单以发布到查询字符串而不是您需要使用“GET”方法的正文。这样任何搜索设备都可以使用您的搜索页面，甚至是浏览器的搜索框。

其次，您想为您的搜索页面创建一个特殊的[位置配置。](http://msdn.microsoft.com/en-us/library/b6x6shw7.aspx)你把它添加到你的 web.config 中。

```
<location path="my-search-page.aspx">
    <system.web>
        <authorization>
            <allow users="*" />
        </authorization>
    </system.web>
</location> 
```

这会为该页面创建一个特殊的覆盖，并且位置标记内的所有内容都使用完全相同的 web.config 结构来覆盖 web.config。

您将希望对要允许所有用户访问的每个页面重复此操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T16:52:54.880

如果搜索结果页面正在执行回发，则会在单击搜索按钮之前触发 pageload 事件。

因此，如果他们所在的页面需要登录，则该登录命令将在搜索按钮单击事件将它们发送回登录屏幕之前运行。

有几种方法可以使搜索成为普通的 html 表单并使其执行 GET 而不是 POST 并由“Nick”提到

或者，如果整个页面都在 .net 回发表单中，您将需要将搜索按钮事件添加到页面加载的重载中，以便它首先触发。

该站点在页面上有一篇很好的文章，例如循环及其覆盖。 [http://www.15seconds.com/issue/020102.htm](http://www.15seconds.com/issue/020102.htm)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-17T14:05:29.223

正如其他答案中所建议的那样，最正确的方法是将搜索输入控件置于单独的表单中，该表单具有 get 方法和 searchresults.aspx 操作。但是，这对于 aspx 来说很困难，因为您只能在页面上拥有一个服务器端表单。

最后，我找到的解决方案效果很好，它是有一个 HttpModule 来检测“搜索”按钮是否已被单击（通过查看是否存在带有其 id 的参数）然后建立一个查询字符串寻找条件参数并重定向到搜索结果页面。这意味着所有的身份验证/授权模块都被绕过了，因为我们已经在它们被触发之前调用了重定向到（不安全的）搜索结果页面。

它有点脆，但对我们来说效果很好。

# java - 如何在 Windows 中设置较长的 Java 类路径？

> ID：201816
> 
> 赞同：49
> 
> 时间：2008-10-14T16:08:53.627
> 
> 标签：java, junit, classpath

我正在尝试在 Windows XP 命令行上手动运行特定的 JUnit 测试，该命令行在类路径中具有异常多的元素。我尝试了几种变体，例如：

```
set CLASS_PATH=C:\path\a\b\c;C:\path\e\f\g;....
set CLASS_PATH=%CLASS_PATH%;C:\path2\a\b\c;C:\path2\e\f\g;....
...
C:\apps\jdk1.6.0_07\bin\java.exe -client oracle.jdevimpl.junit.runner.TestRunner com.myco.myClass.MyTest testMethod 
```

（其他变体是将类路径全部设置在一行上，通过 -classpath 将类路径设置为 java 的参数）。它总是归结为控制台抛出此错误：

```
The input line is too long.
The syntax of the command is incorrect. 
```

这是一个 JUnit 测试，测试一个相当大的现有遗留项目，所以没有关于将我的目录结构重新排列为更合理的建议，这些类型的解决方案现在已经出来了。我只是想对这个项目进行快速测试并在命令行上运行它，而控制台让我望而却步。帮助！

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-10-14T16:52:51.930

Windows 命令行在这方面非常有限。一种解决方法是创建一个“路径 jar”。这是一个仅包含一个`Manifest.mf`文件的 jar，该文件`Class-Path`指定了长长的 jar 列表的磁盘路径等。现在只需将此*路径 jar*添加到命令行类路径。这通常比将实际资源打包在一起更方便。

我记得，磁盘路径可以相对于*路径 jar*本身。所以`Manifest.mf`可能看起来像这样：

```
Class-Path: this.jar that.jar ../lib/other.jar 
```

如果您的*路径 jar*主要包含基础资源，那么它不会更改太频繁，但您可能仍希望在构建的某个位置生成它。例如：

```
<jar destfile="pathing.jar">
  <manifest>
    <attribute name="Class-Path" value="this.jar that.jar ../lib/other.jar"/>
  </manifest>
</jar> 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-10-14T17:14:25.680

从 Java 6 开始，您可以使用[类路径通配符](https://docs.oracle.com/javase/6/docs/technotes/tools/windows/classpath.html#Understanding)。

示例：`foo/*`, 指目录下的所有 .jar 文件`foo`

*   这将不匹配类文件（仅 jar 文件）。要匹配两者，请使用：`foo;foo/*`或`foo/*;foo`。顺序决定了首先加载什么。
*   搜索不是递归的

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2019-01-19T19:52:12.013

# 在 Java 9+ 上使用“参数文件”

在 Java 9+ 中，java 可执行文件支持通过文件提供参数。请参阅 [https://docs.oracle.com/javase/9​​/tools/java.htm#JSWOR-GUID-4856361B-8BFD-4964-AE84-121F5F6CF111](https://docs.oracle.com/javase/9/tools/java.htm#JSWOR-GUID-4856361B-8BFD-4964-AE84-121F5F6CF111)。

该机制明确旨在解决操作系统对命令长度的限制问题：

> 您可以通过使用 @argument 文件来指定包含传递给 java 命令的参数（例如选项和类名）的文本文件来缩短或简化 java 命令。**这让您可以在任何操作系统上创建任意长度的 java 命令。**
> 
> 在命令行中，使用 at 符号 (@) 前缀来标识包含 java 选项和类名的参数文件。当 java 命令遇到以 at 符号 (@) 开头的文件时，它会将该文件的内容扩展为参数列表，就像在命令行中指定它们一样。

如果您运行的是版本 9 或更高版本，这是“正确”的解决方案。这种机制只是修改了参数提供给 JVM 的*方式，因此与任何框架或应用程序 100% 兼容*，无论它们如何进行类加载，即它完全等同于像往常一样在命令行上提供参数。这不适用于针对此操作系统限制的基于清单的解决方法。

这方面的一个例子是：

原始命令：

`java -cp c:\foo\bar.jar;c:\foo\baz.jar`

可以改写为：

`java @c:\path\to\cparg`

一个文件在哪里`c:\path\to\cparg`，其中包含：

```
-cp c:\foo\bar.jar;c:\foo\baz.jar 
```

此“参数文件”还支持行继续字符和引用以正确处理路径中的空格，例如

```
-cp "\
c:\foo\bar.jar;\
c:\foo\baz.jar" 
```

## 摇篮

如果您在 Gradle 中遇到此问题，请参阅此插件，它会自动将您的类路径转换为“参数文件”，并在 Windows 上执行 exec 或测试任务时将其提供给 JVM。在 Linux 或其他操作系统上，默认情况下它什么都不做，尽管可以使用可选的配置值来应用转换，而不管操作系统如何。

[https://github.com/redocksoft/classpath-to-file-gradle-plugin](https://github.com/redocksoft/classpath-to-file-gradle-plugin)

（免责声明：我是作者）

另请参阅这个相关的 Gradle 问题——希望这个功能最终会集成到 Gradle 核心中：[https](https://github.com/gradle/gradle/issues/1989) ://github.com/gradle/gradle/issues/1989 。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-14T16:25:10.990

*（我想你不是真的指 DOS，而是指 cmd.exe。）*

我认为它不是 CLASSPATH 限制，而是环境大小/环境变量大小限制。在 XP 上，单个环境变量的大小可以是 8k，整个环境限制为 64k。我看不出你会达到那个极限。

Windows 有限制命令行长度的限制，在 WindowsNT+ 上，cmd.exe 为 8k。设置命令受此限制。你的 set 命令中有超过 8k 的目录吗？那么，您可能不走运——即使您像尼克·贝拉迪（ [Nick Berardi](https://stackoverflow.com/questions/201816/how-to-set-a-long-java-classpath-in-msdoswindows#201857)）建议的那样将它们分开。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-03-22T13:03:16.480

感谢**Raman**为 Java 9+ 的路径问题引入了新的解决方案。我对任务进行了破解`bootRun`，允许使用 gradle 已经评估的所有内容来运行带有参数文件的 java。不是很优雅但工作。

```
// Fix long path problem on Windows by utilizing java Command-Line Argument Files 
// https://docs.oracle.com/javase/9/tools/java.htm#JSWOR-GUID-4856361B-8BFD-4964-AE84-121F5F6CF111 
// The task creates the command-line argument file with classpath
// Then we specify the args parameter with path to command-line argument file and main class
// Then we clear classpath and main parameters
// As arguments are applied after applying classpath and main class last step 
// is done to cheat gradle plugin: we will skip classpath and main and manually
// apply them through args
// Hopefully at some point gradle will do this automatically 
// https://github.com/gradle/gradle/issues/1989 

if (Os.isFamily(Os.FAMILY_WINDOWS)) {
    bootRun {
        doFirst {
            def argumentFilePath = "build/javaArguments.txt"
            def argumentFile = project.file(argumentFilePath)
            def writer = argumentFile.newPrintWriter()
            writer.print('-cp ')
            writer.println(classpath.join(';'))
            writer.close()

            args = ["@${argumentFile.absolutePath}", main]
            classpath = project.files()
            main = ''
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-14T18:08:48.800

如果我站在你的立场上，我会从 MS 下载 junction 实用程序：[http](http://technet.microsoft.com/en-us/sysinternals/bb896768.aspx) ://technet.microsoft.com/en-us/sysinternals/bb896768.aspx ，然后将你的“C:\path”映射为“z :\" 和 "c:\path2" 表示 "y:\"。这样，您将在`classpath`.

```
set CLASS_PATH=C:\path\a\b\c;C:\path\e\f\g;
set CLASS_PATH=%CLASS_PATH%;C:\path2\a\b\c;C:\path2\e\f\g; 
```

现在，您的类路径将是：

```
set CLASS_PATH=z\a\b\c;z\e\f\g;
set CLASS_PATH=%CLASS_PATH%;y:\a\b\c;y:\e\f\g; 
```

根据您的实际情况，它可能会做得更多`classpath`。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-14T16:20:33.650

我想你在这里没有桨就在小溪上。命令行对调用程序的参数有限制。

我有 2 个你可以尝试的建议。首先，在运行 junit 测试之前，您可以让 script/ant_task 在类路径上创建各种类的 JAR。然后您可以将 JAR 放在应该更短的类路径上。

您可以尝试的另一种方法是创建一个 antscript 来运行 JUNIT，在 ANT 中，类路径条目不应该有这样的限制。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-14T17:21:10.407

正如 HuibertGill 所提到的，我会将其包装在 Ant 构建脚本中，这样您就不必自己管理所有这些。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-07-10T15:04:08.210

你可以试试这个

* * *

```
@echo off
set A=D:\jdk1.6.0_23\bin
set B=C:\Documents and Settings\674205\Desktop\JavaProj
set PATH="%PATH%;%A%;"
set CLASSPATH="%CLASSPATH%;%B%;" 
```

转到命令提示符并运行两次（不知道为什么....我必须在 Windows XP 机器上这样做）还有路径 r 仅为当前命令提示符会话设置

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-10-19T10:15:35.513

除了通过将 jar 文件移动到“C:\jars”之类的文件夹中以某种方式缩短类路径之外，没有解决该问题的方法。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-12-17T09:06:46.603

修复了 windows gradle 长类路径问题。修复 JavaExec 任务出错并显示消息“CreateProcess error=206, The filename or extension is too long”

使用插件 DSL：

```
plugins {
  id "com.github.ManifestClasspath" version "0.1.0-RELEASE"
} 
```

使用旧版插件应用程序：

```
buildscript {
  repositories {
    maven {
      url "https://plugins.gradle.org/m2/"
    }
  }
  dependencies {
    classpath "gradle.plugin.com.github.viswaramamoorthy:gradle-util-plugins:0.1.0-RELEASE"
  }
}

apply plugin: "com.github.ManifestClasspath" 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-06-02T13:12:37.610

我在这里遇到了类似的问题，在 .bat 文件中定义了一个巨大的类路径。问题是这个类路径也包括执行路径到巨大的路径中，它的好，它是有意义的。在这种情况下，软件无法运行，并且每次都出现“输入行太长”的消息。

解决方案：我只是将所有文件移到较短的位置。例如，我试图在目录树中执行软件，例如：c:\softwares\testing\testing_solution\one

我将整个结构移到了这样的位置

c:\测试

该软件运行良好。我知道，这不是最好的选择，但可能会对寻求快速解决方案的人有所帮助。

Tks

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2008-10-14T16:20:21.873

你试过堆叠它们吗？

```
set CLASS_PATH = c:\path
set ALT_A = %CLASS_PATH%\a\b\c;
set ALT_B = %CLASS_PATH%\e\f\g;
...

set ALL_PATHS = %CLASS_PATH%;%ALT_A%;%ALT_B% 
```

# c# - C# (ASP.Net) 将选择值链接到 Codebehind 中的常量

> ID：201826
> 
> 赞同：4
> 
> 时间：2008-10-14T16:11:40.673
> 
> 标签：c#, asp.net

**ASPX 代码**

```
<asp:RadioButtonList ID="rbServer" runat="server" >
   <asp:ListItem Value=<%=ServerDeveloper%>> 开发人员 </asp:ListItemv
   <asp:ListItem Value="dev.ahsvendor.com">dev.test.com</asp:ListItem>
   <asp:ListItem Value="staging.ahsvendor.com"> staging.test.com</asp:ListItem>
</asp:RadioButtonList>

```

**ASPX.CS - 代码隐藏**

```
常量字符串 ServerDeveloper = "开发者";

```

**ASPX 错误**：此上下文不支持代码块。

**问题：**那么，将下拉菜单/单选按钮/... ASPX 值绑定到与 CodeBehind 代码共享的常量的正确方法是什么？

我知道我可以做 rbServer.Add.Item("developer") [来自 CodeBehind]，但是有没有办法从 Presentation 方面实现它？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-14T16:16:36.920

可不可能是：

```
rbServer.Items.Add（服务器开发者）
```

好的，既然你想从演示文稿中做到这一点......这是可能的，但非常丑陋：

```
<div>
<% rbServer.Items.Add(new ListItem("Dev", ServerDeveloper)); %>
<asp:RadioButtonList ID="rbServer" runat="server">
    <asp:ListItem Value="Blah">Blah</asp:ListItem>
</asp:RadioButtonList>
</div>

```

请注意，代码块必须在标记*之上*——如果你把它放在下面，它似乎不起作用。另请注意，必须保护 const 才能使页面访问它。对我来说，这感觉非常像黑客攻击，但它确实存在。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T16:17:08.993

回想起来，更好的解决方案是使用 rbServer.Items.Add() 从代码隐藏中添加它

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T16:18:21.033

在大多数情况下，我将 ListItems 添加到代码隐藏中的列表中，而不是在标记中。我猜这会解决你的问题（尽管我认为我们在这里遗漏了一些信息）。创建新的 ListItems 并将它们添加到 rbServer 的 Items 集合中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-09T22:35:41.697

出于您发布的原因，我通常会尽量避免使用 RadioButtonList 控件。虽然我还没有想出一个易于使用的替代方案:(

# web-services - 根据请求定位 IIS 工作进程

> ID：201827
> 
> 赞同：3
> 
> 时间：2008-10-14T16:12:05.023
> 
> 标签：web-services, caching, iis-6, asp.net-2.0, worker-process

好的，奇怪的设置，奇怪的问题。我们的 SaaS 应用程序有一个客户端和一个管理员 Web 应用程序，在 asp.net-2.0/iis-6 上运行。管理员应用程序可以更改客户端应用程序上显示的选项。当这些选项保存在 Admin 中时，我们从 Admin 调用客户端上的 Web 服务，以刷新该特定帐户的选项缓存。

最近，我们开始为我们的客户端应用程序提供 >1 个工作进程，从而导致仅在当前运行的工作进程中的 1 个上清除选项缓存。

所以，我显然有其他解决这个问题的途径（但是很感激输入），但**我的问题是：**有没有办法通过网络请求来定位/迭代每个工作进程？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-14T16:57:31.610

我在这里为这个答案做一些假设......

1.  我假设客户端应用程序正在使用 .NET 缓存类之一来存储应用程序的选项？

2.  当您说“刷新”时，您是指将它们刷新回配置文件或数据库表吗？

因为缓存对象和数据不会在进程之间共享，所以您需要一种机制来向在另一个工作进程上运行的代码发出信号，它需要将其选项重新读取到其缓存中或强制进程重新启动（这不是非常方便，很可能是不受欢迎的）。

如果您无权访问客户端源来修改以查看选项配置文件或数据库表（例如使用 SqlCacheDependency），我认为您有点坚持这种行为。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T18:13:37.370

我拥有对管理员和客户端的完全访问权限，通过缓存，我的意思是 .net 的 Cache 对象。通过刷新我的意思是从缓存对象中删除项目。

我知道两个工作进程不共享缓存数据。这就是我的难题）

该系统是消除每个进入的新会话都需要点击 sql 的方式。所以我试图找到一个解决方案，可以告诉每个工作进程需要清除缓存而无需获取 sql涉及。

# sql-server - BCP 8.0 版格式文件的列名可以是 SQL 关键字吗？

> ID：201829
> 
> 赞同：1
> 
> 时间：2008-10-14T16:12:40.250
> 
> 标签：sql-server, sql-server-2005, bcp

我有一个格式文件，我希望其中一列是“组”。我正在自动生成格式文件，并且客户想要上传一个以“组”作为列之一的文件。我可以限制它，这样他们就不能使用 SQL 关键字，但是我需要一个函数来确定列名是否是 SQL 关键字，所以我想支持用户能够随意命名他们的客户。我想知道这是否可能。我尝试使用括号，但这似乎不起作用。我的文件看起来像：

```
8.0
1
1 SQLCHAR 0 0 "\r\n" 1 [组] SQL_Latin1_General_CP1_CI_AS

```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-15T07:15:48.493

我在 SQL 2005 SP2（兼容模式 80 和 90 的目标数据库）上测试了几种不同的方法，使用 SQL 2005 版本的 bcp 对我来说工作正常。

但是，我还使用 SQL 2000 版本的 bcp 对其进行了测试，但失败了

```
Error = [Microsoft][ODBC SQL Server Driver][SQL Server]Incorrect syntax near the keyword 'group'. 
```

我想这就是你得到的。

您能否升级运行 bcp 的系统以使用 SQL 2005 客户端工具？

如果您认为您已经升级，请检查您的 PATH 环境变量以确认

```
C:\Program Files\Microsoft SQL Server\90\Tools\binn\ 
```

（针对您的安装进行了调整）出现在之前

```
C:\Program Files\Microsoft SQL Server\80\Tools\BINN 
```

否则 SQL 2000 命令行工具将优先于 SQL 2005 使用

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-17T00:12:40.297

在 MS SQL 上，如果将 SQL Keywork 放在引号中，则可以将其用作列名。

例子：`SELECT id, "group" FROM myTable`

# linq - Linq to SQL：.FirstOrDefault() 不适用于 select new { ... }

> ID：201830
> 
> 赞同：5
> 
> 时间：2008-10-14T16:12:46.257
> 
> 标签：linq, linq-to-sql

我刚问[了这个问题](https://stackoverflow.com/questions/201686/linq-to-sql-select-optimization)。这让我想到了一个新问题:)

到目前为止，我已经使用了以下通过 Linq to SQL 选择内容的模式，目的是能够处理查询返回的 0“行”：

```
var person = (from p in [DataContextObject].Persons
              where p.PersonsID == 1
              select new p).FirstOrDefault();

if (person == null)
{
    // handle 0 "rows" returned.
} 
```

但是当我这样做时我不能使用`FirstOrDefault()`：

```
var person = from p in [DataContextObject].Persons
             where p.PersonsID == 1
             select new { p.PersonsID, p.PersonsAdress, p.PersonsZipcode };

// Under the hood, this pattern generates a query which selects specific
// columns which will be faster than selecting all columns as the above
// snippet of code does. This results in a performance-boost on large tables. 
```

如何使用第二种模式检查查询返回的 0“行”？

**更新：**

我认为我的构建失败了，因为我试图将查询结果分配给一个`this._user`声明为`[DataContext].User`.

```
this._user = (from u in [DataContextObject].Users
              where u.UsersID == [Int32]
              select new { u.UsersID }).FirstOrDefault(); 
```

*编译错误：无法将类型“AnonymousType#1”隐式转换为“[DataContext].User”。*

关于如何解决这个问题的任何想法？我必须制作自己的对象吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-14T16:24:34.767

为什么你可以一直做同样的事情？它会给你一个错误吗？

```
var person = (from p in [DataContextObject].Persons
              where p.PersonsID == 1
              select new { p.PersonsID, p.PersonsAdress, p.PersonsZipcode }).FirstOrDefault();

if (person == null) {    
    // handle 0 "rows" returned.
} 
```

它仍然是一个引用对象，就像你的实际对象一样，它只是匿名的，所以在编译代码之前你不知道实际的类型。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-16T00:34:39.623

**更新：**

> 我现在明白你*实际上*在问什么！对不起，我的回答不再适用。我以为当它为空时你没有得到一个空值。接受的响应是正确的，如果您想使用超出范围的对象，您需要创建一个新类型并使用 New MyType(...)。我知道 DevEx 的 RefactorPro 对此进行了重构，我认为 resharper 也可以。

像这样调用 .FirstOrDefault(null) ：

```
string[] names = { "jim", "jane", "joe", "john", "jeremy", "jebus" };
var person = (
    from p in names where p.StartsWith("notpresent") select 
        new { Name=p, FirstLetter=p.Substring(0,1) } 
    )
    .DefaultIfEmpty(null)
    .FirstOrDefault();

MessageBox.Show(person==null?"person was null":person.Name + "/" + person.FirstLetter); 
```

这对我有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T16:18:35.993

```
if (person.Any()) /* ... */; 
```

或者

```
if (person.Count() == 0) /* ... */; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-14T17:11:06.810

关于您的更新：您必须创建自己的类型，将 this._user 更改为*int*，或者选择整个对象，而不仅仅是特定的列。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-14T16:23:06.280

您仍然可以使用`FirstOrDefault`. 只要有

```
var PersonFields = (...).FirstOrDefault() 
```

PersonFields 将为 null 或具有您创建的那些属性的对象。

# javascript - 在 JavaScript 中为全局变量列表赋值

> ID：201832
> 
> 赞同：1
> 
> 时间：2008-10-14T16:13:11.327
> 
> 标签：javascript, jquery, dry

嘿，现在我正在使用 jQuery，并且我有一些全局变量来保存一些预加载的 ajax 内容（预加载以使页面变得又好又快）：

```
 $.get("content.py?pageName=viewer", function(data)
    {viewer = data;});
$.get("content.py?pageName=artists", function(data)
    {artists = data;});
$.get("content.py?pageName=instores", function(data)
    {instores = data;});
$.get("content.py?pageName=specs", function(data)
    {specs = data;});
$.get("content.py?pageName=about", function(data)
    {about = data;}); 
```

如您所见，我们严重违反了 DRY 原则，但是……我真的没有办法解决它……有什么想法吗？

也许是一个数组？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-14T16:46:11.010

使用 jQuery each 方法遍历页面名称数组，然后设置全局（在窗口范围内）变量：

```
jQuery.each(
    ["viewer", "artists", "instores", "specs", "about"],
    function (page) {
        $.get("content.py?pageName=" + page,
            new Function("window[" + page + "] = arguments[0]"));
    }
); 
```

**更新：**实际上，您甚至不需要“新功能”：

```
jQuery.each(
    ["viewer", "artists", "instores", "specs", "about"],
    function (page) {
        $.get("content.py?pageName=" + page, function () { window[page] = arguments[0]; });
    }
); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-14T17:06:02.077

你不需要`eval()`或`Function()`为此。正如您所怀疑的，一个数组会很好地完成这项工作：

```
(function() // keep outer scope clean
{
   // pages to load. Each name is used both for the request and the name
   // of the property to store the result in (so keep them valid identifiers
   // unless you want to use window['my funky page'] to retrieve them)
   var pages = ['viewer', 'artists', 'instores', 'specs', 'about'];

   for (var i=0; i<pages.length; ++i)
   {
      // "this" refers to the outer scope; likely the window object. 
      // And will result in page contents being stored in global variables 
      // with the same names as the pages being loaded. We use the with({})
      // construct to create a local scope for each callback with the
      // appropriate context and page name.
      with ({context: this, pageName: pages[i]})
         $.get("content.py?pageName=" + pageName, function(data)
            {context[pageName] = data;});
   }

})(); // close scope, execute anonymous function

// at this point, viewer, artists, etc. are populated with page contents 
// (assuming all requests completed successfully) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-14T16:19:26.943

您可以避免使用新功能进行评估：

```
var names = ['viewer', 'artists', 'instores', 'specs', 'about'];
for (var i = 0; i < names.length; i++)
   $.get("content.py?pageName=" + names[i], new Function('data', names[i] + ' = data;')); 
```

虽然tbh并没有好很多

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-14T16:35:22.200

您只能在该页面调用一次，并返回一个 json 对象而不是文本

```
{
viewer:'me',
artists:'you',
instores:'instores',
specs:'specs',
about:'about'
} 
```

并评估，因为现在你调用了 N 次你的服务器，这会减慢所有速度，你应该重新考虑你的逻辑！

PS。在我写的时候，我看到了 RoBorg 的答案，你看，当你使用新函数时，你在后台使用 eval，所以如果你想使用它，就去吧（在某些浏览器中也更快）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-14T17:17:35.737

这不使用 eval，虽然它有点罗嗦。

```
function get_content(name){
   $.get("content.py?pageName=" + name, function(data){ window[name] = data;});
}

var names = ['viewer', 'artists', 'instores', 'specs', 'about'];
for (var i = 0; i < names.length; i++)
    get_content(names[i]); 
```

但是其中一位回答者提出了一个很好的观点，您可能应该尝试将所有这些请求合并为一个，否则您的服务器将针对页面的每个请求的动态内容被命中 6 次。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-17T13:41:02.393

这些建议的解决方案中的大多数都避免使用**eval**。Doduglas Crockford 的“ [JavaScript 编程语言的代码约定](http://javascript.crockford.com/code.html)”进一步强化了这种做法，其中部分内容是

> “评估是邪恶的
> 
> eval 函数是 JavaScript 中被滥用最多的特性。躲开它。
> 
> eval 有别名。不要使用 Function 构造函数。”

# .net-2.0 - MSMQ 通用消息传递

> ID：201834
> 
> 赞同：1
> 
> 时间：2008-10-14T16:13:49.903
> 
> 标签：.net-2.0, msmq

我正在考虑创建一个通用消息队列来处理各种进程间消息。（此时，WCF 不是一个选项。）因此，与其为特定消息设置 10-15 个不同的队列，不如使用 1 个“包罗万象”的队列。

显然，向这个队列发送消息不是问题。每个收件人都会收听队列中的新消息，然后“偷看”它们，但我正在寻找一种干净/有效的方法来做到这一点。干净我的意思是一种不需要每个收件人阅读每条消息的正文的方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T16:14:25.550

使用 System.Messaging.Message.AppSpecific (Integer) 指定收件人。

# wcf - 在 REST WCF URL 中使用反斜杠 (%5c)

> ID：201838
> 
> 赞同：2
> 
> 时间：2008-10-14T16:15:06.533
> 
> 标签：wcf, url, rest

我正在 WCF 上构建一个 REST 服务，我正在编写的方法之一是 GetProfile，它将返回给定用户名的配置文件。用户名将包括用户的域，因此将具有以下格式：“域\用户名”。

因此，我有一个名为 Profiles.svc 的服务，它设置了以下端点：

```
[OperationContract]
[WebGet(UriTemplate = "/{username}", ResponseFormat = WebMessageFormat.Xml)]
IRestResponse GetProfile(String username); 
```

但是，当我尝试访问[http://server/profiles.svc/DOMAIN%5cusername](http://server/profiles.svc/DOMAIN%5cusername)上的服务时（%5c 是反斜杠的 urlencoded 形式），我收到以下错误：

```
“/”应用程序中的服务器错误
HTTP 错误 400 - 错误请求
```

即使在我的 GetProfile 实现中没有实际定义代码时也会发生这种情况，因此我相信在 WCF 尝试将 URI 绑定到方法时会引发错误。

为了允许将反斜杠添加到 REST WCF 服务中的 URL，是否需要将一些设置添加到我的 Web 服务配置中？还是根本不允许使用反斜杠？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-14T16:31:00.337

我怀疑它们根本不允许出现在 url 的那部分。只要对它们进行编码，它们就可以在查询字符串中使用。作为一般规则，我不会在文件名中无效的 url 的路径部分中放置任何内容（即？）。

也许您可以使用不同的字符将域与用户名区分开来。

您还可以将用户名分成域名和用户名，并使用正常的路径分隔符“/”。我对此并不熟悉，无法确定您是否这样做，但这将是我最好的猜测。

```
[OperationContract]
[WebGet(UriTemplate = "/{domainName}/{username}", ResponseFormat = WebMessageFormat.Xml)]
IRestResponse GetProfile(String domainName, String username); 
```

# ruby-on-rails - 如何解决 Rails 中的“索引 unique_schema_migrations 已存在”？

> ID：201840
> 
> 赞同：4
> 
> 时间：2008-10-14T16:15:29.853
> 
> 标签：ruby-on-rails, ruby, migration

运行`rake db:migrate`后跟`rake test:units`产生以下结果：

```
rake test:functionals
(in /projects/my_project)
rake aborted!
SQLite3::SQLException: index unique_schema_migrations already exists: CREATE UNIQUE INDEX "unique_schema_migrations" ON "ts_schema_migrations" ("version") 
```

相关部分`db/schema.rb`如下：

```
create_table "ts_schema_migrations", :id => false, :force => true do |t|
  t.string "version", :null => false
end

add_index "ts_schema_migrations", ["version"], :name => "unique_schema_migrations", :unique => true 
```

我不会在任何地方手动更改此索引，而是使用 Rails 的默认 SQLite3 适配器和全新的数据库。（也就是说，`rm db/*sqlite3`之前运行`rake db:migrate`没有帮助。）

该`test:units`任务是否可能试图重新加载架构？如果是这样，为什么？它不应该识别架构已经是最新的吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-12-30T22:30:29.720

在 SQLite 中，索引名称的唯一性是在数据库级别强制执行的。在 MySQL 中，唯一性仅在表级别强制执行。这就是为什么您的迁移在后者而不是前者中起作用的原因：您在不同的表上有两个同名的索引。

重命名索引，或者找到并重命名另一个`unique_schema_migrations`索引，您的迁移应该可以工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-15T22:59:04.813

在您的 database.yml 文件中，您的环境是否设置为连接到不同的数据库以进行开发和测试？

IE：

```
development:
  adapter: sqlite3
  database: db/dev.sqlite3
  timeout: 5000

test:
  adapter: sqlite3
  database: db/test.sqlite3
  timeout: 5000 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T16:34:01.720

尝试搜索您的 schema.rb 文件是否不包含创建同名索引的其他声明：`unique_schema_migrations`

# email - 如何在 salesforce.com 中配置有关新案例评论的电子邮件通知？

> ID：201841
> 
> 赞同：2
> 
> 时间：2008-10-14T16:15:45.750
> 
> 标签：email, templates, salesforce

在 salesforce.com 中，我有一个在通过自助服务门户添加新案例评论时触发的工作流。工作流规则更新 Case.Status 字段，该字段在 Case 对象本身上触发另一个工作流规则。最终结果是发送给案例所有者的电子邮件，通知已添加新案例评论。

但是，我找不到将案例评论本身包含在电子邮件中的方法，因此几乎没有用。如何在电子邮件模板中包含最新的案例评论？我认为它类似于 {!Case.CaseComment}，但我在任何地方都找不到它......

帮助！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-18T23:34:36.483

我知道我在事后偶然发现了这种方式，但答案是......

{!Case.Last_Case_Comment}

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T22:44:51.920

哇，你太努力了。转到设置 -> 应用程序设置 -> 案例 -> 支持设置并启用“通知案例所有者新案例评论”选项。

# python - python命名一个与lib相同的文件

> ID：201846
> 
> 赞同：2
> 
> 时间：2008-10-14T16:17:23.017
> 
> 标签：python

我有以下脚本

```
import getopt, sys
opts, args = getopt.getopt(sys.argv[1:], "h:s")
for key,value in opts:
    print key, "=>", value 
```

如果我将此 getopt.py 命名并运行它不起作用，因为它试图导入自身

有没有办法解决这个问题，所以我可以保留这个文件名，但在导入时指定我想要标准的python lib而不是这个文件？

基于 Vinko 回答的解决方案：

```
import sys
sys.path.reverse()
from getopt import getopt

opts, args = getopt(sys.argv[1:], "h:s")

for key,value in opts:
    print key, "=>", value 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-14T16:30:44.800

您不应将脚本命名为现有模块。特别是如果标准。

也就是说，您可以触摸 sys.path 来修改库加载顺序

```
~# cat getopt.py
print "HI"
~# python
Python 2.5.2 (r252:60911, Jul 31 2008, 17:28:52)
[GCC 4.2.3 (Ubuntu 4.2.3-2ubuntu7)] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import sys
>>> import getopt
HI

~# python
Python 2.5.2 (r252:60911, Jul 31 2008, 17:28:52)
[GCC 4.2.3 (Ubuntu 4.2.3-2ubuntu7)] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import sys
>>> sys.path.remove('')
>>> import getopt
>>> dir(getopt)
['GetoptError', '__all__', '__builtins__', '__doc__', '__file__', '__name__', 'do_longs', 'do_shorts', 'error', 'getopt', 'gnu_getopt', 'long_has_args', 'os', 'short_has_arg'] 
```

此外，您可能希望避免完全导入并以不同的方式进行，如下所示：

```
import sys
sys.path.remove('')
from getopt import getopt
sys.path.insert(0,'')
opts, args = getopt(sys.argv[1:], "h:s")
for key,value in opts:
    print key, "=>", value 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-14T16:27:16.477

您应该避免使用标准库模块名称来命名您的 python 文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T16:36:34.570

Python 没有给你一种方法来限定模块。您可以通过从 sys.path 中删除 '' 条目或将其移至末尾来完成此操作。我不会推荐它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-14T16:39:36.577

好吧，如果您真的需要，您可以（重新）从 sys.path 中移动当前目录，其中包含库的可修改搜索路径以使其工作。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-14T16:20:56.147

```
import getopt as bettername 
```

这应该允许您将 getopt 称为 bettername。

# outlook - Outlook 自动化 - 更改发件人帐户

> ID：201848
> 
> 赞同：3
> 
> 时间：2008-10-14T16:17:33.703
> 
> 标签：outlook, automation

我正在自动化 Outlook，我需要控制电子邮件的发件人。用户将在 Outlook 中设置两个或多个帐户，我需要能够选择从哪个帐户发送电子邮件。有任何想法吗？

需要 Outlook 2003 及更高版本支持。我正在使用 Delphi 2006 对此进行编码，但这并不重要。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T16:46:03.163

一个名叫 Sue Mosher 的人在[microsoft.public.office.developer.outlook.vba](http://groups.google.com/group/microsoft.public.office.developer.outlook.vba/browse_thread/thread/f56c553d9884bfd2?pli=1)上写了一篇关于这个问题的漂亮总结。

简而言之，它归结为以下任何一个：

*   use `MailItem.SentOnBehalfOfName`，仅适用于 Exchange 环境（我想您就是这种情况）-当用户对另一个 Exchange 邮箱具有“发送为”权限时，这与切换帐户几乎相同。
*   使用一个涉及摆弄`CommandBars`
*   使用 Outlook 兑换
*   *（在 OL2007 中，您将拥有`MailItem.SendUsingAccount`）*

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-09-10T14:04:48.670

扩展一点已接受的答案，我需要 Sue 的 set_account 函数的 Delphi 实现。在互联网上的任何地方都找不到任何东西，所以这里是对 Sue 代码的 Delphi 解释。

```
Function SetAccount(TargetAccount:string; var MailItem:OLEVariant):boolean;
var OLI,CBs,CBP,MC:olevariant;
    strAccountBtnName:String;
    i,t:Integer;
    FoundAccount:Boolean;
Const ID_ACCOUNTS = 31224;
begin
    FoundAccount:=false;
    OLI:=MailItem.GetInspector;
    CBs:=OLI.CommandBars;
    CBP:=CBs.FindControl(, ID_ACCOUNTS);
    t:=1;
    while (not FoundAccount) and (t<=CBP.Controls.Count) do begin
       MC:=CBP.Controls[t];
       i:=Pos(' ',MC.Caption);
       if i > 0 Then strAccountBtnName:=Copy(MC.Caption,i+1,Length(MC.Caption)-i)
       else strAccountBtnName:=MC.Caption;
       if strAccountBtnName = TargetAccount then begin
           MC.Execute;
           FoundAccount:=true;
       end;
       inc(t);
    end;
    Result:=FoundAccount;
end; 
```

感谢 Sue Mosher，谢谢，没有你我做不到 :)

# asp.net - 在具有用户存储的网络场环境中使用 DPAPI / ProtectedData

> ID：201863
> 
> 赞同：5
> 
> 时间：2008-10-14T16:21:00.170
> 
> 标签：asp.net, encryption, web-farm, dpapi

我想知道是否有人在网络农场环境中成功地将 DPAPI 与用户存储一起使用？

因为我们的应用程序是最近从 1.1 转换为 2.0 的 ASP.NET 应用程序，所以我们使用了一个直接调用`CryptUnprotect`方法的自定义包装器。但这应该与`ProtectedData`2.0框架中可用的方法相同。

因为我们在网络农场环境中运行，我们不能保证进行加密的机器将是解密它的机器。（也因为机器故障不应该破坏我们的加密数据）。

因此，我们拥有的是一个服务组件，它在我们每个 web 盒子上的特定用户帐户下的服务中运行。根据建议，此用户设置为具有漫游配置文件。

我们遇到的问题是，在一台机器上加密的信息无法在另一台机器上解密，这会因 win32 错误而失败：

> '密钥在指定状态下无效'。

我怀疑这是因为我犯了一个错误，让加密服务以用户身份在多台机器上运行，因此让用户同时在多台机器上登录。

如果这是问题所在，那么如何在网络场环境中将 DPAPI 与用户存储一起使用？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-12-27T02:10:12.130

在 Web 场环境中，您不会使用 DPAPI 直接加密/解密您的数据，而是使用它来加密稍后用于解密受保护数据的**密钥。**

作为部署过程的一部分，您可以将密钥“安装”到每台服务器上。安装脚本需要以 AppPool 的身份运行，并且可以将加密密钥存储在 app.config 文件或注册表中。

加密数据本身可以存储在中央存储库/数据库中，以便场中的所有服务器都可以访问它。要解密数据，Web 应用程序将从安装位置检索加密密钥，使用 DPAPI 对其进行解密，然后使用结果解密来自中央存储库的数据。

缺点是在初始安装过程中，明文密钥可能会在本地磁盘上存在很短的时间，在那里它可能会暴露给操作人员。如果担心的话，您可以添加额外的加密层，例如使用 web.config machineKey。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-03-25T23:22:22.873

我刚看到这个。有一种方法可以完成这项工作，那就是确保农场中的机器在域中，并使用域帐户来加密和解密数据（即；在域帐户下运行应用程序）

您不能以您希望的方式对本地帐户使用 DPAPI，因为密钥材料不会在服务器之间交换。

希望有帮助！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-11-23T15:55:53.447

微软的海报是错误的。 [http://support.microsoft.com/default.aspx?scid=kb;en-us;309408#6](http://support.microsoft.com/default.aspx?scid=kb;en-us;309408#6)

“为使 DPAPI 在使用漫游配置文件时正常工作，域用户只能登录到域中的一台计算机。如果用户想要登录到域中的另一台计算机，则用户必须注销用户登录到第二台计算机之前的第一台计算机。如果用户同时登录到多台计算机，DPAPI 很可能无法正确解密现有的加密数据。

DPAPI 似乎无法在农场环境中工作。我认为这是微软的一个相当大的疏忽，使得 DPAPI 对于大多数企业应用程序几乎毫无用处。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-07-30T23:54:28.830

十二年后。. . 您可以尝试使用[CNG DPAPI](https://docs.microsoft.com/en-us/windows/win32/seccng/cng-dpapi)，它适用于可能会或可能不会负载平衡的云环境。从该链接（以防它被删除）：

> Microsoft 在 Windows 2000 中引入了数据保护应用程序编程接口 (DPAPI)。该 API 由两个函数组成，CryptProtectData 和 CryptUnprotectData。DPAPI 是 CryptoAPI 的一部分，适用于对使用密码学知之甚少的开发人员。这两个函数可用于加密和解密单台计算机上的静态数据。
> 
> 然而，云计算通常要求在一台计算机上加密的内容在另一台计算机上解密。因此，从 Windows 8 开始，Microsoft 将使用相对简单的 API 的想法扩展到涵盖云场景。这个名为 DPAPI-NG 的新 API 使您能够安全地共享机密（密钥、密码、密钥材料）和消息，方法是将它们保护到一组主体中，这些主体可用于在适当的身份验证和授权后在不同的计算机上取消保护它们。

在 .NET Core 中，这看起来像

```
public void ConfigureServices(IServiceCollection services)
{
    services.AddDataProtection()
        .ProtectKeysWithDpapiNG();
} 
```

# agile - 课堂项目的最佳敏捷方法是什么？

> ID：201865
> 
> 赞同：2
> 
> 时间：2008-10-14T16:22:01.900
> 
> 标签：agile, methodology

该项目定义不明确：我们将为 CS 111 计算机编程 I 学生编写专注于功能的教育软件。我们有 6 名具有不同背景的学生开发人员在 Flex 工作。该项目的持续时间约为 7 周。我们的面谈时间非常有限（每周 30 分钟）和工作时间非常有限（每位开发人员每周少于 8 小时）。我们对客户（我们课程的教授、CS 111 教授、CS 111 学生）的访问权限有限。

我们的工具集包括 Flex Builder、Subversion 和 TRAC。

什么方法最适合这个项目，为什么？或者，应该从各种方法中收集哪些特征来更好地适应这种情况？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-14T16:28:49.703

是什么让您认为在这种情况下任何方法都会成功——沟通少、要求多于时间以及无法接触客户？

话虽如此，我将专注于增量交付（每个迭代应该有一些工作功能）、单元测试（所有测试在签入之前通过）、增量发布的标记（返回工作版本的能力）和配对强大的团队成员与较弱的团队成员，以提高团队的整体生产力。考虑将团队中的一名强大成员投入到集成测试中。

增量交付是最重要的。展示一个低于要求的工作演示总是比展示一个不工作的原型更好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T16:51:31.717

您可以在这里使用敏捷方法，但显然您必须采用它来满足您的需求。

例如，如果您没有足够的机会接触到真正的客户，那么最了解您的目标的人将不得不充当客户代理。我还建议尝试更多地接触客户——几乎每个人都试图表现得比实际更忙，而且通常有办法解决这个障碍。

确保您的团队同时拥有有限的工作时间。当你不能一起工作时，就没有敏捷方法。

您绝对可以使用基于故事的估计、迭代开发过程等。

真正重要的是让每个团队成员清楚而明确地了解敏捷过程是如何工作的，以及每个人在项目中的角色。说你会使用 SCRUM 很容易，但不幸的是没有真正的理解和经验，这并没有多大意义。

一些忠告：

1.  教育你的团队成员
2.  如果您不受时间/资源的限制，请列出您想要交付的内容。
3.  找出在您的限制条件下可以实现的交付。那可能不会太多。不要试图过于乐观。专注于你真正可以实现的目标。
4.  确保您的真正客户同意这一点。
5.  使用短迭代（1 周或更短）。确保您可以在每次迭代结束时交付经过全面测试的产品。
6.  尽早展示你的作品。

# .net - DocumentViewer 工具栏和上下文菜单

> ID：201875
> 
> 赞同：8
> 
> 时间：2008-10-14T16:24:36.060
> 
> 标签：.net, wpf, controls, customization

如何隐藏默认工具栏并禁止`DocumentViewer`控件的默认上下文菜单？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-15T09:34:23.050

您可以通过为 DocumentViewer 创建不带工具栏的控件模板来隐藏（或更改）工具栏。

从[https://msdn.microsoft.com/en-us/library/aa970452(v=vs.100)](https://msdn.microsoft.com/en-us/library/aa970452(v=vs.100))中的示例模板开始，然后添加和删除内容，直到您对结果满意为止。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-05-23T14:20:52.160

您可以像这样将 ContextMenu 属性设置为 null：

```
<DocumentViewer ContextMenu="{x:Null}"/> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T16:38:04.100

`ContextMenuOpening`您可以通过处理事件并设置`ContextMenuEventArgs.Handled`为 true来阻止默认上下文菜单出现。

至于工具栏，我不确定-也许您可以以某种方式更改 DocumentView 的默认样式以不包含工具栏？我从来没有做过太多的风格，但这可能是我开始寻找的地方。

# c# - 如何让 DataGridView 的 ComboBox 子项来处理所有键，包括“.”？

> ID：201883
> 
> 赞同：1
> 
> 时间：2008-10-14T16:28:14.837
> 
> 标签：c#, .net, winforms, datagridview

我遇到了与下面列出的帖子中描述的相同的问题。也就是说，当我在组合框中键入某些键时，它们根本不起作用，直到我第一次按下空格键。其中一个键是“.”，另一个是字母“Q”，还有其他的：“$”、“%”。

[http://forums.microsoft.com/msdn/ShowPost.aspx?PostID=659716&SiteID=1](http://forums.microsoft.com/msdn/ShowPost.aspx?PostID=659716&SiteID=1)
[http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=2909173&SiteID=1&pageid=0](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=2909173&SiteID=1&pageid=0)
[http://bytes。 com/forum/thread548399.html](http://bytes.com/forum/thread548399.html)

到目前为止，我已经尝试了很多东西。我最近的失败是基于 DataGridView 可能使用 WIN32 API wndproc 子类化来拦截消息的理论，所以我编写了逻辑来保存旧的 wndproc 并在将其添加到 DataGridView 的控件集合后恢复它。那没有用。

墨西拿 - 感谢您提醒我有关 Spy++ 的信息。对于字母“A”，编辑窗口向其父组合框发送一个 EN_UPDATE。但是，不适用于“Q”。这太奇怪了。

我已经说服自己 DataGridView 不是组合和编辑的子类，因为我在创建之后和将它们添加到网格集合之前检查了 wndprocs 的地址，然后在我绘制时检查。除非网格安装某种全局钩子..

我在想，也许我可以子类化编辑控件，然后按照我在这里看到编辑控件的方式将通知发送到组合框？

编辑：更多信息在这里。来自 Spy++ 的网格、组合框和编辑控件的 Windows 消息：

HWNDs: 122064e < 网格 010d0674 < 组合框 01360696 < 组合框的编辑控件

```
<01402> 01360696 P WM_KEYDOWN nVirtKey:'A' cRepeat:1 ScanCode:1E fExtended:0 fAltDown:0 fRepeat:0 fUp:0
<01403> 010D0674 S WM_GETDLGCODE
<01404> 010D0674 R WM_GETDLGCODE fuDlgCode:DLGC_WANTARROWS | DLGC_WANTCHARS
<01405> 010D0674 S WM_GETDLGCODE
<01406> 010D0674 R WM_GETDLGCODE fuDlgCode:DLGC_WANTARROWS | DLGC_WANTCHARS
<01407> 010D0674 S WM_GETDLGCODE
<01408> 010D0674 R WM_GETDLGCODE fuDlgCode:DLGC_WANTARROWS | DLGC_WANTCHARS
<01409> 010D0674 S WM_GETDLGCODE
<01410> 010D0674 R WM_GETDLGCODE fuDlgCode:DLGC_WANTARROWS | DLGC_WANTCHARS
<01411> 01360696 P WM_CHAR chCharCode:'0061' (97) cRepeat:1 ScanCode:1E fExtended:0 fAltDown:0 fRepeat:0 fUp:0
<01412> 010D0674 S WM_GETDLGCODE
<01413> 010D0674 R WM_GETDLGCODE fuDlgCode:DLGC_WANTARROWS | DLGC_WANTCHARS
<01414> 010D0674 S WM_GETDLGCODE
<01415> 010D0674 R WM_GETDLGCODE fuDlgCode:DLGC_WANTARROWS | DLGC_WANTCHARS

<01416> 010D0674 S WM_COMMAND wNotifyCode:EN_UPDATE wID:1001 hwndCtl:01360696  <<< edit control sends to combobox

<01417> 010D0674 S message:0x2111 [User-defined:WM_USER+7441] wParam:00060674 lParam:010D0674    What do these do?
<01418> 010D0674 R message:0x2111 [User-defined:WM_USER+7441] lResult:00000000

<01419> 010D0674 R WM_COMMAND
<01420> 010D0674 S WM_CTLCOLOREDIT hdcEdit:C7011AA6 hwndEdit:01360696
<01421> 010D0674 R WM_CTLCOLOREDIT hBrush:F0103EB0

<01422> 010D0674 S WM_COMMAND wNotifyCode:EN_CHANGE wID:1001 hwndCtl:01360696  << edit control sends to combobox

<01423> 010D0674 S message:0x2111 [User-defined:WM_USER+7441] wParam:00050674 lParam:010D0674

<01424> 0122064E S WM_PAINT hdc:00000000   <<< grid is told to paint
<01425> 0122064E S WM_ERASEBKGND hdc:94011D4E
<01426> 0122064E R WM_ERASEBKGND fErased:True
<01427> 0122064E S WM_GETTEXTLENGTH
<01428> 0122064E R WM_GETTEXTLENGTH cch:0
<01429> 0122064E S WM_GETTEXT cchTextMax:2 lpszText:0012D0C0
<01430> 0122064E R WM_GETTEXT cchCopied:0 lpszText:0012D0C0 ("")
<01431> 0122064E S WM_GETTEXTLENGTH
<01432> 0122064E R WM_GETTEXTLENGTH cch:0
<01433> 0122064E S WM_GETTEXT cchTextMax:2 lpszText:0012D0C0
<01434> 0122064E R WM_GETTEXT cchCopied:0 lpszText:0012D0C0 ("")
<01435> 010D0674 S WM_WINDOWPOSCHANGING lpwp:0012D4B0
<01436> 010D0674 R WM_WINDOWPOSCHANGING
<01437> 010D0674 S CB_GETCURSEL
<01438> 010D0674 R CB_GETCURSEL index:CB_ERR
<01439> 010D0674 S WM_GETTEXTLENGTH
<01440> 01360696 S WM_GETTEXTLENGTH
<01441> 01360696 R WM_GETTEXTLENGTH cch:2
<01442> 010D0674 R WM_GETTEXTLENGTH cch:2
<01443> 010D0674 S WM_GETTEXT cchTextMax:6 lpszText:0012CC44
<01444> 01360696 S WM_GETTEXT cchTextMax:6 lpszText:0012BE64
<01445> 01360696 R WM_GETTEXT cchCopied:2 lpszText:0012BE64 ("a")
<01446> 010D0674 R WM_GETTEXT cchCopied:2 lpszText:0012CC44 ("a")
<01447> 010D0674 S CB_GETCURSEL
<01448> 010D0674 R CB_GETCURSEL index:CB_ERR
<01449> 010D0674 S WM_GETTEXTLENGTH
<01450> 01360696 S WM_GETTEXTLENGTH
<01451> 01360696 R WM_GETTEXTLENGTH cch:2
<01452> 010D0674 R WM_GETTEXTLENGTH cch:2
<01453> 010D0674 S WM_GETTEXT cchTextMax:6 lpszText:0012CC44
<01454> 01360696 S WM_GETTEXT cchTextMax:6 lpszText:0012BE64
<01455> 01360696 R WM_GETTEXT cchCopied:2 lpszText:0012BE64 ("a")
<01456> 010D0674 R WM_GETTEXT cchCopied:2 lpszText:0012CC44 ("a")
<01457> 010D0674 S CB_GETCURSEL
<01458> 010D0674 R CB_GETCURSEL index:CB_ERR
<01531> 0122064E R WM_PAINT
<01532> 010D0674 S WM_PAINT hdc:00000000
<01533> 010D0674 S WM_NCPAINT hrgn:00000001
<01534> 010D0674 R WM_NCPAINT
<01535> 010D0674 S WM_ERASEBKGND hdc:0F0141ED
<01536> 010D0674 R WM_ERASEBKGND fErased:True
<01537> 0122064E S WM_CTLCOLOREDIT hdcEdit:840137F1 hwndEdit:010D0674
<01538> 0122064E R WM_CTLCOLOREDIT hBrush:F0103EB0
<01539> 010D0674 R WM_PAINT
<01540> 01360696 S WM_PAINT hdc:00000000
<01541> 01360696 S WM_NCPAINT hrgn:00000001
<01542> 01360696 R WM_NCPAINT
<01543> 01360696 S WM_ERASEBKGND hdc:C7011AA6
<01544> 01360696 R WM_ERASEBKGND fErased:True
<01545> 010D0674 S WM_CTLCOLOREDIT hdcEdit:870137F1 hwndEdit:01360696
<01546> 010D0674 R WM_CTLCOLOREDIT hBrush:F0103EB0
<01547> 010D0674 S WM_CTLCOLOREDIT hdcEdit:870137F1 hwndEdit:01360696
<01548> 010D0674 R WM_CTLCOLOREDIT hBrush:F0103EB0
<01549> 01360696 R WM_PAINT
<01555> 0122064E S WM_CTLCOLOREDIT hdcEdit:8A0137F1 hwndEdit:010306AC
<01556> 0122064E R WM_CTLCOLOREDIT hBrush:78103C5B
<01568> 010D0674 S CB_GETCURSEL
<01569> 010D0674 R CB_GETCURSEL index:CB_ERR
<01570> 010D0674 S WM_GETTEXTLENGTH
<01571> 01360696 S WM_GETTEXTLENGTH
<01572> 01360696 R WM_GETTEXTLENGTH cch:2
<01573> 010D0674 R WM_GETTEXTLENGTH cch:2
<01574> 010D0674 S WM_GETTEXT cchTextMax:6 lpszText:0012D7A4
<01575> 01360696 S WM_GETTEXT cchTextMax:6 lpszText:0012C9C4
<01576> 01360696 R WM_GETTEXT cchCopied:2 lpszText:0012C9C4 ("a")
<01577> 010D0674 R WM_GETTEXT cchCopied:2 lpszText:0012D7A4 ("a")
<01578> 010D0674 S CB_GETCURSEL
<01579> 010D0674 R CB_GETCURSEL index:CB_ERR
<01580> 010D0674 S WM_GETTEXTLENGTH
<01581> 01360696 S WM_GETTEXTLENGTH
<01582> 01360696 R WM_GETTEXTLENGTH cch:2
<01583> 010D0674 R WM_GETTEXTLENGTH cch:2
<01584> 010D0674 S WM_GETTEXT cchTextMax:6 lpszText:0012D6E0
<01585> 01360696 S WM_GETTEXT cchTextMax:6 lpszText:0012C900
<01586> 01360696 R WM_GETTEXT cchCopied:2 lpszText:0012C900 ("a")
<01587> 010D0674 R WM_GETTEXT cchCopied:2 lpszText:0012D6E0 ("a")
<01588> 010D0674 S CB_GETCURSEL
<01589> 010D0674 R CB_GETCURSEL index:CB_ERR
<01590> 010D0674 S WM_GETTEXTLENGTH
<01591> 01360696 S WM_GETTEXTLENGTH
<01592> 01360696 R WM_GETTEXTLENGTH cch:2
<01593> 010D0674 R WM_GETTEXTLENGTH cch:2
<01594> 010D0674 S WM_GETTEXT cchTextMax:6 lpszText:0012D6E0
<01595> 01360696 S WM_GETTEXT cchTextMax:6 lpszText:0012C900
<01596> 01360696 R WM_GETTEXT cchCopied:2 lpszText:0012C900 ("a")
<01597> 010D0674 R WM_GETTEXT cchCopied:2 lpszText:0012D6E0 ("a")
<01598> 010D0674 R message:0x2111 [User-defined:WM_USER+7441] lResult:00000000
<01599> 01360696 S WM_GETTEXTLENGTH
<01600> 01360696 R WM_GETTEXTLENGTH cch:2
<01601> 01360696 S WM_GETTEXT cchTextMax:6 lpszText:0012DF8C
<01602> 01360696 R WM_GETTEXT cchCopied:2 lpszText:0012DF8C ("a")
<01603> 010D0674 R WM_COMMAND
<01604> 01360696 P WM_KEYUP nVirtKey:'A' cRepeat:1 ScanCode:1E fExtended:0 fAltDown:0 fRepeat:1 fUp:1 
```

字母 q

```
<01625> 01360696 P WM_KEYDOWN nVirtKey:'Q' cRepeat:1 ScanCode:10 fExtended:0 fAltDown:0 fRepeat:0 fUp:0
<01626> 010D0674 S WM_GETDLGCODE
<01627> 010D0674 R WM_GETDLGCODE fuDlgCode:DLGC_WANTARROWS | DLGC_WANTCHARS
<01628> 010D0674 S WM_GETDLGCODE
<01629> 010D0674 R WM_GETDLGCODE fuDlgCode:DLGC_WANTARROWS | DLGC_WANTCHARS
<01630> 010D0674 S WM_GETDLGCODE
<01631> 010D0674 R WM_GETDLGCODE fuDlgCode:DLGC_WANTARROWS | DLGC_WANTCHARS
<01632> 010D0674 S WM_GETDLGCODE
<01633> 010D0674 R WM_GETDLGCODE fuDlgCode:DLGC_WANTARROWS | DLGC_WANTCHARS
<01634> 01360696 P WM_CHAR chCharCode:'0071' (113) cRepeat:1 ScanCode:10 fExtended:0 fAltDown:0 fRepeat:0 fUp:0
<01635> 010D0674 S WM_GETDLGCODE
<01636> 010D0674 R WM_GETDLGCODE fuDlgCode:DLGC_WANTARROWS | DLGC_WANTCHARS
<01637> 010D0674 S WM_GETDLGCODE
<01638> 010D0674 R WM_GETDLGCODE fuDlgCode:DLGC_WANTARROWS | DLGC_WANTCHARS
<01640> 01360696 P WM_KEYUP nVirtKey:'Q' cRepeat:1 ScanCode:10 fExtended:0 fAltDown:0 fRepeat:1 fUp:1 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-18T07:25:08.243

无论如何，你已经解决了你的问题吗？

我和你有同样的问题，我的 DataGridView 自定义控件无法接收字母 Q、句点、美元、单引号、百分比等。

我能够通过将“switch .. default: return false”更改为“switch .. default: return !dataGridViewWantsInputKey”来解决问题

我猜微软用于为 datagridview 制作自己的用户控件的模式代码不是最佳的。这是来自 Microsoft 的模式代码：

[http://msdn.microsoft.com/en-au/library/7tas5c80(vs.80).aspx](http://msdn.microsoft.com/en-au/library/7tas5c80(vs.80).aspx)

```
public bool EditingControlWantsInputKey(
    Keys key, bool dataGridViewWantsInputKey)
{
    // Let the DateTimePicker handle the keys listed.
    switch (key & Keys.KeyCode)
    {
        case Keys.Left:
        case Keys.Up:
        case Keys.Down:
        case Keys.Right:
        case Keys.Home:
        case Keys.End:
        case Keys.PageDown:
        case Keys.PageUp:
            return true;
        default:
            return false; // I changed this to: return !dataGridViewWantsInputKey.  My usercontrol can now receive Q, period, dollar, etc.
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T22:05:19.010

部分回答我的问题。在 Combobox 中，我处理 KeyDown、TextChanged 和 KeyUp 事件，它们按该顺序触发。如果我在跳过 TextChanged 的​​情况下从 KeyDown 转到 KeyUp，我会检查该字符是 Keys.Q 还是 Keys.OemPeriod。（我不确定它对其他人是否安全，例如 shift/D1、shift/D2 等......）。如果它是其中一个键，我会自己更改组合框文本。

但这还不够，因为仅更改文本会将编辑控件（属于组合框）中的光标设置为文本的开头。所以，为了解决这个问题，我使用 FindWindowEx 来获取编辑控件的句柄，然后向它发送一个 EM_SETSEL 以将光标重置到单词的末尾。

# java - 插入行jdbc的主键？

> ID：201887
> 
> 赞同：44
> 
> 时间：2008-10-14T16:29:27.157
> 
> 标签：java, jdbc, identity

是否有跨数据库平台的方式来获取您刚刚插入的记录的主键？

我注意到[这个答案](https://stackoverflow.com/questions/165156/easy-mysql-question-regarding-primary-keys-and-an-insert)说你可以通过调用来获取它`SELECT LAST_INSERT_ID()`，我认为你可以调用`SELECT @@IDENTITY AS 'Identity';`是否有一种通用的方法可以在 jdbc 中跨数据库执行此操作？

如果不是，你会如何建议我为一段可以访问 SQL Server、MySQL 和 Oracle 的代码实现这个？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-10-14T19:40:32.297

从我的代码复制：

```
pInsertOid = connection.prepareStatement(INSERT_OID_SQL, Statement.RETURN_GENERATED_KEYS); 
```

其中 pInsertOid 是一个准备好的语句。

然后您可以获得密钥：

```
// fill in the prepared statement and
pInsertOid.executeUpdate();
ResultSet rs = pInsertOid.getGeneratedKeys();
if (rs.next()) {
  int newId = rs.getInt(1);
  oid.setId(newId);
} 
```

希望这能给你一个好的起点。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2012-12-14T06:19:58.497

extraneon 的答案虽然正确，**但不适用于 Oracle**。

您为 Oracle 执行此操作的方式是：

```
String key[] = {"ID"}; //put the name of the primary key column

ps = con.prepareStatement(insertQuery, key);
ps.executeUpdate();

rs = ps.getGeneratedKeys();
if (rs.next()) {
    generatedKey = rs.getLong(1);
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-14T21:26:02.567

您是否尝试过[Statement.executeUpdate()](http://java.sun.com/j2se/1.4.2/docs/api/java/sql/Statement.html)和[Statement.getGeneratedKeys()](http://java.sun.com/j2se/1.4.2/docs/api/java/sql/Statement.html#getGeneratedKeys())方法？有一篇[developerWorks 文章](http://www.ibm.com/developerworks/java/library/j-jdbcnew/)提到了这种方法。

此外，在 JDBC 4.0 中，Sun 添加了[row_id 功能](http://www.onjava.com/pub/a/onjava/2006/08/02/jjdbc-4-enhancements-in-java-se-6.html)，允许您获取行的唯一句柄。Oracle 和 DB2 支持该特性。对于 sql server，您可能需要第三方驱动程序，例如[这个](http://www.inetsoftware.de/products/jdbc/mssql/merlia/)。

祝你好运！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-14T21:01:47.780

对于 oracle，如果您已映射序列以生成 PKEY 值，Hibernate 将使用序列中的 NEXT_VALUE。

不确定它对 MySQL 或 MS SQL 服务器有什么作用

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-17T16:16:59.880

[Spring为此操作](http://static.springframework.org/spring/docs/2.5.x/reference/jdbc.html#jdbc-auto-genereted-keys)提供了一些有用的支持，参考指南似乎回答了您的问题：

> 没有一种标准的单一方法可以创建适当的 PreparedStatement（这解释了为什么方法签名是这样的）。一个适用于 Oracle 而可能不适用于其他平台的示例是......

我已经在 MySQL 上测试了这个例子，它也可以在那里工作，但我不能代表其他平台。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-09-27T13:54:33.020

对于符合 SQL-99 的数据库，您可以使用标识列：CREATE TABLE sometable (id INTEGER GENERATED ALWAYS AS IDENTITY(START WITH 101) PRIMARY KEY, ...

使用[getGeneratedKeys()检索刚刚使用](http://download.oracle.com/javase/6/docs/api/java/sql/Statement.html#getGeneratedKeys%28%29)[executeUpdate(String sql, int autoGeneratedKeys)](http://download.oracle.com/javase/6/docs/api/java/sql/Statement.html#executeUpdate%28java.lang.String,%20int%29)插入的密钥。使用 Statement.RETURN_GENERATED_KEYS 作为第二个参数来执行更新（）

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2015-07-31T07:45:32.647

只需将 id 列声明为 id 整数而不是 NULL 主键`auto_increment`

在此之后执行此代码

```
ResultSet ds=st.executeQuery("select * from user");
                while(ds.next())
                {

                 ds.last();
                System.out.println("please note down your registration id  which is "+ds.getInt("id"));
                }
                ds.close(); 
```

上面的代码将显示当前行的 id

如果您删除`ds.last()`，它将显示 id 列的所有值

# java - Spring初始化顺序

> ID：201888
> 
> 赞同：2
> 
> 时间：2008-10-14T16:29:50.323
> 
> 标签：java, spring

假设我有几个春豆：

```
<beans>
   <bean name="A" ... />
   <bean name="B" ... />
</beans> 
```

“B”公开了一个不需要“A”的远程服务。假设“A”的加载时间不可忽略。这意味着在重新启动周期期间，应用程序挂起远程客户端，远程客户端实际上可以连接到服务器但等待响应，直到 spring 容器完全初始化。

我想做的是让“B”远程服务立即响应，即使（基于应用程序状态）它只能返回 NOT_READY 或类似的东西。然而，容器会强制等待，直到它的所有 bean 都被初始化，即使您将 bean 指定为惰性初始化并且与加载顺序无关。

我怀疑让“B”立即可用意味着 spring 必须提供一个部分初始化的容器，这听起来很糟糕。但是，我很感激任何人在初始化顺序上获得的任何信息，以及您是否找到了任何合理的解决方法。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-16T20:24:23.110

不要直接引用bean“A”。相反，引用一个 bean，它是 bean "A" 的 FACTORY；通过这种方式，可以创建工厂 bean，而无需为实例化“A”而进行初始化命中。当然，您需要重构引用“A”的类以首先检索“A”。

或者，你可以创建一个bean“AA”，它是bean“A”的容器，它有一个初始化状态，并且暴露了bean“A”的接口；调用时，它将其初始化状态设置为未初始化，并在某个线程中开始初始化 bean“A”；对“AA”上的“A”的任何接口方法的调用可以阻塞或返回未就绪响应，直到“AA”中的“A”初始化完成。

这一切都取决于您对“加载时间不可忽略”的定义是什么。为什么加载需要不可忽略的时间？A 中是否有一些特别棘手的初始化？还是 A 太大了以至于阻塞了 JVM？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T19:56:40.610

我不明白，为什么“加载 A 需要不可忽略的时间”，但也许你可以通过重构 A 来懒惰地初始化自己。不要使用 InitializingBean 或处理 ApplicationEvent。只需初始化要处理的第一个请求。这将减慢第一个请求！

另一种可能性是将初始化移动到由处理 ApplicationEvent 的 bean 创建的单独线程。线程以异步方式调用 bean 的初始化方法。小心处理对未初始化 bean 的请求！

# ssh - 警告：未受保护的私钥文件！尝试通过 SSH 连接到 Amazon EC2 实例时

> ID：201893
> 
> 赞同：222
> 
> 时间：2008-10-14T16:31:01.350
> 
> 标签：ssh, amazon-web-services, amazon-ec2, chmod

我正在努力在 Amazon EC2 实例上设置 Panda。我昨晚设置了我的帐户和工具，使用 SSH 与我自己的个人实例交互没有问题，但现在我没有被允许进入 Panda 的 EC2 实例的权限。 [熊猫入门](http://pandastream.com/docs/getting_started)

我收到以下错误：

```
@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @

Permissions 0644 for '~/.ec2/id_rsa-gsg-keypair' are too open.
It is recommended that your private key files are NOT accessible by others.
This private key will be ignored. 
```

为了进入我的个人实例，我昨晚将密钥对更改为 600，并尝试将权限设置为 0，甚至生成新的密钥字符串，但似乎没有任何效果。

任何帮助都将是一个很大的帮助！

* * *

嗯，似乎除非目录上的权限设置为 777，否则 ec2-run-instances 脚本无法找到我的密钥文件。我是 SSH 新手，所以我可能会忽略一些东西。

* * *

## 回答 #1

> 赞同：234
> 
> 时间：2008-10-20T07:41:32.883

> 为了进入我的个人实例，我昨晚已将密钥对更改为 600，

这就是它应该的方式。

从[EC2 文档](http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AccessingInstancesLinux.html)中，我们有*“如果您使用的是 OpenSSH（或任何合理偏执的 SSH 客户端），那么您可能需要设置此文件的权限，以便它只能由您读取。”* 您链接到亚马逊文档链接的 Panda 文档，但实际上并没有传达这一切的重要性。

这个想法是密钥对文件就像密码一样，需要受到保护。因此，您使用的 ssh 客户端要求这些文件是安全的，并且只有您的帐户才能读取它们。

将目录设置为 700 确实应该足够了，但只要文件为 600，777 就不会受到伤害。

您遇到的任何问题都是客户端问题，因此请务必在任何后续问题中包含本地操作系统信息！

* * *

## 回答 #2

> 赞同：71
> 
> 时间：2008-10-14T16:33:01.643

确保包含私钥文件的目录设置为**700**

```
chmod 700 ~/.ec2 
```

* * *

## 回答 #3

> 赞同：49
> 
> 时间：2014-09-05T08:16:07.000

为了解决这个问题，

1.  您需要将权限重置为默认值：

    ```
    sudo chmod 600 ~/.ssh/id_rsa
    sudo chmod 600 ~/.ssh/id_rsa.pub 
    ```

    如果您收到另一个错误：

    *   您确定要继续连接（是/否）？是的
    *   未能将主机添加到已知主机列表 (/home/geek/.ssh/known_hosts)。
2.  这意味着该文件的权限也设置不正确，可以通过以下方式进行调整：

    ```
    sudo chmod 644 ~/.ssh/known_hosts 
    ```

3.  最后，您可能还需要调整目录权限：

    ```
    sudo chmod 755 ~/.ssh 
    ```

这应该可以让您重新启动并运行。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2015-04-17T07:18:37.693

私钥文件应该受到保护。在我的情况下，我已经使用 public_key 身份验证很长时间了，我曾经将私钥设置为 600 (rw- --- ---) 和 644 (rw- r-- r--) 和主文件夹中的 .ssh 文件夹，您将拥有 700 权限（rwx --- ---）。要进行设置，请转到用户的主文件夹并运行以下命令

为 .ssh 文件夹设置**700权限**

```
chmod 700 .ssh 
```

设置私钥文件**600权限**

```
chmod 600 .ssh/id_rsa 
```

为公钥文件设置**644权限**

```
chmod 644 .ssh/id_rsa.pub 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2018-07-12T07:18:33.747

我也遇到了同样的问题，但我通过将密钥文件权限更改为 600 来解决它。

`sudo chmod 600 /path/to/my/key.pem`

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2019-07-31T10:32:47.767

使用 chmod 命令更改文件权限

```
sudo chmod 700 keyfile.pem 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2018-12-16T03:20:42.483

在 Windows 上，尝试使用 git bash 并在那里使用你的 Linux 命令。简单的方法

```
chmod 400 *****.pem

ssh -i "******.pem" ubuntu@ec2-11-111-111-111.us-east-2.compute.amazonaws.com 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2017-06-07T10:35:29.867

将您的私钥、公钥、known_hosts 保存在同一目录中，然后尝试如下登录：

```
ssh -I(small i) "hi.pem" ec2-user@ec2-**-***-**-***.us-west-2.compute.amazonaws.com 
```

*   从某种意义上说，相同的目录， `cd /Users/prince/Desktop`. 现在输入`ls`命令，你应该看到 `**.pem **.ppk known_hosts`

**注意：**您必须尝试从同一目录登录，否则您将收到权限被拒绝错误，因为它无法从您当前的目录中找到 .pem 文件。

* * *

如果您希望能够从任何目录进行 SSH，您可以将以下内容添加到您的`~/.ssh/config`文件中...

```
Host your.server
HostName ec2-user@ec2-**-***-**-***.us-west-2.compute.amazonaws.com
User ec2-user
IdentityFile ~/.ec2/id_rsa-gsg-keypair
IdentitiesOnly yes 
```

现在，无论目录在哪里，您都可以通过 SSH 连接到您的服务器，只需键入`ssh your.server`（或您在“主机”之后放置的任何名称）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2021-11-28T18:30:11.663

简而言之，pem 文件权限对机器上的每个用户都是开放的，即任何人都可以读取和写入该文件在 Windows 上，我发现使用 git bash 的方式很难执行 chmod。我已按照以下步骤操作

1.  删除用户权限

    chmod ugo-rwx abc.pem

2.  仅为该用户添加权限

    chmod u+rw

3.  运行 chmod 400

    chmod 400 abc.pem

4.现在为您的实例尝试 ssh -i

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-06-14T00:16:26.033

我正在考虑其他事情，如果您尝试使用不存在的其他用户名登录，这就是您将收到的消息。

所以我假设您可能正在尝试使用 ec2-user 进行 ssh，但我记得最近大多数 centos AMI 例如使用 centos 用户而不是 ec2-user

因此，如果您是， `ssh -i file.pem centos@public_IP`请告诉我您正在尝试使用正确的用户名进行 ssh，否则这可能是您看到此类错误消息的一个重要原因，即使您的 ~/.ssh/id_rsa 或 file.pem 具有正确的权限

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-10-18T13:45:51.040

解决方案是使其只能由文件所有者读取，即八进制模式表示的最后两位应为零（例如 mode `0400`）。

OpenSSH`authfile.c`在一个名为的函数中检查它`sshkey_perm_ok`：

```
/*
 * if a key owned by the user is accessed, then we check the
 * permissions of the file. if the key owned by a different user,
 * then we don't care.
 */
if ((st.st_uid == getuid()) && (st.st_mode & 077) != 0) {
    error("@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@");
    error("@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @");
    error("@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@");
    error("Permissions 0%3.3o for '%s' are too open.",
        (u_int)st.st_mode & 0777, filename);
    error("It is required that your private key files are NOT accessible by others.");
    error("This private key will be ignored.");
    return SSH_ERR_KEY_BAD_PERMISSIONS;
} 
```

请参阅注释后的第一行：它针对文件的模式执行“按位与”，选择最后两个八进制数字中的所有位（因为`07`是八进制`0b111`，其中每个位分别代表 r/w/x） .

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2019-07-02T21:22:36.800

对于偶然发现此问题的任何人，请注意：

如果您尝试使用与您共享的密钥进行 SSH，例如：

`ssh -i /path/to/keyfile.pem user@some-host`

`keyfile.pem`与您共享的私钥/公钥在哪里，并且您正在使用它进行连接，**请确保将其保存到`~/.ssh/`和`chmod 777`.**

当文件保存在我机器上的其他位置时尝试使用该文件会导致 OP 出现错误。不确定是否直接相关。

# java - Is there a class or method in Java that will check if a string is a SQL Server keyword?

> ID：201896
> 
> 赞同：2
> 
> 时间：2008-10-14T16:32:03.907
> 
> 标签：java, sql-server

I want something that can check if a string is `"SELECT"`, `"INSERT"`, etc. I'm just curious if this exists.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-14T16:34:46.727

Easy enough to add :

```
 HashSet<String>  sqlKeywords    =
     new HashSet<String>(Arrays.asList(
       new String[] { ... cut and paste a list of sql keywords here ..  })); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-14T20:06:56.347

If you're trying to prevent SQL injection, it would be better to leverage the built in features of JDBC, such as prepared statements. In general, using string concatenation to form the SQL statement is dangerous. From [Preventing SQL Injection in Java](http://www.owasp.org/index.php/Preventing_SQL_Injection_in_Java):

**Prepared Statements**:

```
String selectStatement = "SELECT * FROM User WHERE userId = ? ";
PreparedStatement prepStmt = con.prepareStatement(selectStatement);
prepStmt.setString(1, userId);
ResultSet rs = prepStmt.executeQuery(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T16:34:21.500

why not start with [this stored procedure](http://www.novicksoftware.com/UDFofWeek/Vol2/T-SQL-UDF-Vol-2-Num-29-udf_SQL2K_IsKeywordBIT.htm) and modify it to suit your needs, possibly even convert it to Java using the hashmap as Steve suggested.

Personally I like the idea of a stored procedure because different databases may have different keywords so it seems elegant to have the database pass judgement

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-14T20:14:46.173

DatabaseMetaData.getSQLKeywords will return the databases keywords that are not in SQL-2003 (SQL-2003 keyword can be found in the standard). There are other methods within that interface for getting various types of function names and similar.

As Chase Seibert mentions, don't think this is an effective way to block SQL injection attacks.

# memory - Windows 进程何时耗尽内存？

> ID：201906
> 
> 赞同：2
> 
> 时间：2008-10-14T16:36:24.273
> 
> 标签：memory, windows-server-2003

在 Windows Server 2003, Enterprise Edition, SP2 下（/3GB 开关未启用）

据我了解，我可能错了，一个进程的最大可寻址内存是 4GB。

那是 2GB 的私有字节和 2GB 的虚拟字节吗？

当达到私有字节限制或虚拟字节限制时，您是否会收到“内存不足”错误？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-14T18:36:31.503

从某种意义上说，一个进程的最大地址空间是4GB是正确的。对于每个进程，操作系统占用了一半的地址空间。这可以通过 3GB 开关进行更改，但可能会导致系统不稳定。因此，我们剩下 2GB 的可寻址内存供进程自己使用。好吧，不完全是。事实证明，这个空间的一部分被其他东西占用了，例如 DLL 和其他公共代码。作为程序员，您可用的实际内存约为 1.5GB - 1.7GB。

我不确定您如何处理意外超出此限制的情况，但我知道由于这个原因在大型多人地图中崩溃的游戏。另一件需要注意的是，除非启用 /LARGEADDRESSAWARE:YES 链接器标志，否则 32 位程序在 64 位系统上不能使用超过 2GB 的地址空间。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T16:45:37.140

Mark Russinovich 就此发表了一系列文章。 [突破 Windows 的极限：物理内存](http://blogs.technet.com/markrussinovich/archive/2008/07/21/3092070.aspx)

虽然 4GB 是 32 位客户端 SKU 的许可限制，但有效限制实际上更低，并且取决于系统的芯片组和连接的设备。原因是物理地址映射不仅包括 RAM，还包括设备内存，x86 和 x64 系统将所有设备内存映射到 4GB 地址边界以下，以保持与不知道如何处理的 32 位操作系统兼容地址大于 4GB。如果一个系统有 4GB RAM 和设备，如视频、音频和网络适配器，在其设备内存中实现窗口的总和为 500MB，则 4GB RAM 中的 500MB 将位于 4GB 地址边界之上。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T16:46:54.610

在 32 位 Windows 平台上，您总共只能访问 2Gb 的内存（没有 3Gb 开关）。

您可以在 64 位操作系统上运行多个 32 位虚拟机，这样如果您的机器超过 4Gb，每个应用程序都可以访问尽可能多的内存。

很多人刚开始遇到这些障碍，我想如果你的应用程序是在 .net 或 Java 中会更容易，因为 VM 很高兴在 64 位操作系统上达到 32Gb 的内存。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-14T16:48:39.320

在 32 位上，如果有足够的物理内存和磁盘空间用于虚拟内存，内存会用完大约 3GB，因为内核为自己保留了 0xC0000000 以上的地址空间。在运行 64 位应用程序的 64 位内核上，限制为 8TB。

有关更多详细信息，请查看[MSDN - Windows 版本的内存限制](http://msdn.microsoft.com/en-us/library/aa366778.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-14T16:49:13.297

32 位机器的最大可寻址内存为 4GB，对于 64 位机器，您可以处理更多负载。（虽然有些32bit的机器有扩展系统可以访问更多，但我觉得这不值得打扰或考虑使用）。

当达到虚拟限制时，您会出现内存不足错误。在 Windows Server 2003 上，任务管理器会在标有“提交费用限制”的性能选项卡上告诉您限制。

# asp.net - 如何防止 Visual Studio 2008 检查 .aspx 文件中的引用？

> ID：201909
> 
> 赞同：0
> 
> 时间：2008-10-14T16:37:38.467
> 
> 标签：asp.net, visual-studio-2008

有一个针对 Visual Studio 2005 的注册表修复程序，以防止它检查 .aspx 文件中的引用，但它似乎不适用于 2008 年。使用变量重命名，在 ASP.NET 项目中查找所有引用非常慢。有没有办法在VS2008中防止这种情况？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-14T18:43:06.950

这是我已经放弃希望在 Visual Studio 中正常工作的一件事。这也是我首先开始使用 ReSharper 的主要原因之一。

除了一些 3rd 方插件，我没有其他建议给你。

# .net - 使用 HttpWebRequest.GetResponse() 时可能导致 ThreadAbortException 的原因

> ID：201919
> 
> 赞同：13
> 
> 时间：2008-10-14T16:41:44.670
> 
> 标签：.net

由于这种情况，我生活在噩梦中，我有一个 HttpWebRequest.GetResponse，它不断给我一个 ThreadAbortException，导致整个应用程序崩溃。

我怎样才能避免这种情况，或者至少处理它，在这种情况下使用 Thread.ResetAbort() 会有用吗？

为了解释更多这里是一个粗略的代码示例：

```
HttpWebRequest req = (HttpWebRequest)WebRequest.Create("http://someurl.com/");
HttpWebResponse resp = req.GetResponse(); 
```

现在上面的最后一行抛出了 ThreadAbortException，这可能是因为请求超时，这很好，但我不想在我的 ASP.NET 2.0 应用程序中获得 ThreadAbortException，因为它会杀死它。ThreadAborException 不能用 try/catch 捕获，处理它的唯一方法是使用 Thread.ResetAbort()，它也有其自身的不良影响，它会使线程保持活动状态，上帝只知道多久。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-14T20:27:02.607

从您所说的看来，您似乎是在处理对 ASP.NET 应用程序的传入请求的过程中向外部资源发出传出 WebRequest。这里有（至少）两个相关的超时：

*   WebRequest.Timeout（默认 100000ms = 100s）指定执行传出 WebRequest 的超时时间。如果此超时到期，您应该得到一个 WebException - 所以这不是您的问题。

*   处理传入请求的 HttpRuntime 有一个执行超时：根据[MSDN](http://msdn.microsoft.com/en-us/library/e1f13641.aspx)，.NET 2.0 或更高版本的默认值为 110 秒，.NET 1.x 为 90 秒。当此超时到期时，您将收到 ThreadAbortException。看起来这就是正在发生的事情。

在 .NET 1.x 中，您会期望这一点，因为默认的 HttpRuntime executionTimeout 小于 WebRequest.Timeout。在 .NET 2.0 中，如果您在发出传出 WebRequest 之前已经花费了 >10 秒（例如，如果您在同一个传入请求中有多个传出 WebRequest），那么您会期望使用默认超时。

我建议你：

*   减少传出请求的 WebRequest.Timeout，并处理 WebException，或

*   如果传出请求确实需要那么长时间，则增加 httpRuntime 执行超时，如[MSDN](http://msdn.microsoft.com/en-us/library/e1f13641.aspx)中所述。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T16:48:07.510

我在使用 Response 时遇到了这个问题。查看这篇文章了解一些解决方法。[http://support.microsoft.com/kb/312629](http://support.microsoft.com/kb/312629)

另请查看 WebException 和 Remarks 部分中的此 MSDN 文档。[http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.getresponse.aspx](http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.getresponse.aspx)

可以捕获此异常...如果您无法检测到正确的异常，则应尝试捕获一般异常（system.Exception），然后堆栈跟踪应从那里告诉您要执行的特定类型（HttpException、WebException 等）实际上抓住了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-14T17:11:04.593

我们的应用程序在 Response.Redirect("url") 调用的所有时间 b/c 中都抛出了 ThreadAbortException。该应用程序从未关闭，很可能 b/c 异常在某个时候被捕获并保持活动状态。

顺便说一句， Response.Redirect("url",false) 将防止 Response 因异常而终止。Andrew 的帖子链接到 Response 类的不同用途的类似解决方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-14T18:14:56.027

我已经看到了 Andrew 和“ForCripesSake”列出的两个问题。

ThreadAbortException 的另一种可能性是在服务器端的页面请求生命周期之外运行的任何代码，例如 HttpModules 和 HttpHandlers。模块或处理程序中抛出的任何异常都不会进入 ASP.Net 中默认的未处理异常机制，并且可能导致线程终止。

根据这篇文章，在 ASP.net 或 CLR 中通常无法轻松处理一些异常：

[可靠性最佳实践](http://msdn.microsoft.com/en-us/library/ms228970(VS.80).aspx)

不确定它是否适用于您在问题中列出的客户端代码，但它可能是相关的。

希望有帮助！

# html - 使用服务器端 XML Parser 生成 HTML 内容

> ID：201930
> 
> 赞同：2
> 
> 时间：2008-10-14T16:44:12.010
> 
> 标签：html, xml, xpath, xslt

是否可以使用服务器端 XML 解析器来创建一个 HTML blob，然后将其包含在现有的 HTML 页面中？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T16:50:50.967

现有的 HTML 页面是否已由同一台服务器提供服务？如果是这样，那么是的 - 可以说这是对几乎所有 Web 框架所做的或多或少的粗略描述：在静态模板中插入一些动态内容。

你担心哪一点？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T16:52:10.577

大多数语言应该有可用的 XML 库或解析器来促进这一点。

例如，PHP 有[一个 XML 解析器](http://ca3.php.net/xml)。

使用它编写一个函数来获取给定的 XML 提要，对其进行美化，然后将其吐出。然后在您的 HTML 页面中调用此函数。

# asp.net - 为什么从网页调用 Web 服务会变慢？

> ID：201933
> 
> 赞同：1
> 
> 时间：2008-10-14T16:44:29.250
> 
> 标签：asp.net, web-services

我们有一个 DLL 用作网站前端和后端票务系统之间的中间层。插入票务系统的方法解释起来有点复杂，但简短的版本是它很慢。我得到的最好的情况是提交时间为 9 秒。

但真正的问题是，我只能通过 Windows 应用程序而不是通过 ASP.NET 网站来获得那个时间。我已经设置了一个 Windows 测试应用程序和一个用于测试的网页，即使在它们之间复制了代码，网页也始终在 17-20 秒内提交，而 Windows 应用程序则需要 8-11 秒。

可能是什么原因造成的？

编辑：回应几个答案......

对 Web 服务的调用占用了大部分时间，但我无法控制此 Web 服务，因为它是由票务系统供应商提供的。我需要找出为什么在从不同类型的应用程序中调用 Web 服务时会花费不同的时间。两种情况下的代码完全相同，它运行一个循环然后报告记录的时间。

代码是：

```
for (int i = 0; i < numIterations; i++)
        {
            startTimes[i] = DateTime.Now;

            try
            {
                cvNum = Clearview.Submit(req, DateTime.Now, DateTime.Now, false);
            }
            catch (Exception ex)
            {
                exceptionCount++;
                lblResult.Text += @"<br />Exception Caught: " + ex.Message + @"<br />";                    
            }

            endTimes[i] = DateTime.Now;
    } 
```

在这两种情况下都是相同的循环，我在调用库之前和之后标记时间，它会进行进一步处理，然后调用 Web 服务。但是那个处理应该是一致的，不是吗？我在调试期间进行了跟踪，没有看到任何延迟到实际的 Web 服务调用......

再次编辑：与 Ants 一起工作，在这两种情况下，99.4% 的时间都是在 Web 服务调用上发送的。那里似乎没有区别......除了超时时网页比Windows应用程序花费的时间更长。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T17:30:17.160

Web 服务相对于 Web 服务器的位置可能存在问题。此外，Web UI 中的页面结构和其他处理可能会影响应用程序的处理时间。

如前所述，在两侧记录项目是一个好主意，如果这不能满足您的需求，您可以尝试使用性能分析器，例如 Red Gate 的 Ants Profiler，它可以帮助识别正在使用的行、方法或类大部分时间。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T16:59:03.977

用日志在你的应用程序的两边加上胡椒粉——这将告诉你时间在哪里。如果这没有帮助，请使用[Wireshark](http://www.wireshark.org/)跟踪网络活动。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T17:52:22.687

你是在同一台机器上运行吗？您调用的中间层是否位于远程机器上？您提到的持续时间模糊地感觉像是 DNS 超时问题，当打开连接时，第一个（关闭/错误寻址）DNS 响应超时会受到惩罚。您确定将 DLL 指向中间层的任何配置文件/var 在两个调用中都是相同的吗？

我支持使用 Wireshark 来查看发生了什么的建议。您至少可以让自己满意，后端处理时间（应该，无论如何）是相同的......

# file-io - 如何知道应用程序试图访问哪些文件？

> ID：201936
> 
> 赞同：1
> 
> 时间：2008-10-14T16:45:33.647
> 
> 标签：file-io

我如何知道应用程序试图访问哪些文件和注册表项？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-14T16:48:32.797

[进程监视器](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)是您的主和救星。或者 FileMon 和 RegMon，如果您运行的是较旧的 Windows 操作系统。

# c++ - 可以realloc Array，那为什么要用指针呢？

> ID：201940
> 
> 赞同：2
> 
> 时间：2008-10-14T16:46:09.603
> 
> 标签：c++, c, pointers, data-structures

这是我面临的一次求职面试。他们问我们是否可以重新分配数组，我说可以。然后他们问 - 为什么我们需要指针，因为大多数人给出了它浪费内存空间的理由。我无法给出满意的答复。如果任何机构能给出满意的答复，我将不胜感激。请提及与上述陈述可能相矛盾的任何情况。

谢谢你。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-14T17:02:21.973

您只能重新分配动态分配的数组。如果它是静态分配的，则无法[安全地]重新分配。*

指针在内存中保存数据的地址。它们可以使用 C++ 中的 new/delete 运算符和 C 中的 malloc/free 动态分配、解除分配和重新分配。

我强烈建议您阅读Kernighan 和 Ritchie 的[*The C Programming Language*](https://rads.stackoverflow.com/amzn/click/com/0131103628)以及Herbert Schildt[*的 C++ From the Ground Up等可靠的 C++ 文本。*](https://rads.stackoverflow.com/amzn/click/com/0072228970)

使用动态内存、指针、偏移量等都是使用这两种语言的基础。不知道它们是如何工作的，以及它们存在的原因可能是潜在雇主拒绝你的一个原因。

*编译器**不应**让您重新分配静态分配的任何内容，但如果这样做，则行为未定义

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-14T17:10:19.620

措辞有点奇怪，但对我来说，面试问题似乎是一个开放式问题，旨在让你解释你对数组、指针、动态内存分配等的了解。如果我是面试官，我想要候选人阐明`int *a = malloc(10 * sizeof(int));`和之间的区别`int a[10];`。后续问题的措辞不是很好，但它可能是试图在指针和数组之间的差异方向上推动候选人并引发思路。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-14T16:53:40.340

好的。您不能重新分配已静态声明的数组。使用指针（而不是静态声明的数组）的目的是让您可以重新分配空间。我想，从技术上讲是正确的，您可以通过将指针传递给静态定义的数组来重新分配它，但我不想这样做。如果指针指向不是由 malloc 分配的内存，则行为未定义。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-14T17:09:24.207

我真的不明白使用指针如何“浪费内存”。realloc 函数： -

```
void *realloc(void *ptr, size_t size); 
```

将指向内存的指针作为参数调整大小。此外，指针的用途比动态内存多得多，例如通过引用传递。

# silverlight-2.0 - 如何在 Silverlight 2.0 组合框中用鼠标悬停替换单击事件？

> ID：201947
> 
> 赞同：2
> 
> 时间：2008-10-14T16:48:35.280
> 
> 标签：silverlight-2.0

我在 Silverlight 2.0 中有一个组合框，我希望它在用户将鼠标悬停在切换按钮上时打开，然后在鼠标移开时关闭。默认行为是单击。

这是我的样式代码（对不起，它太长了）：

```
<Style x:Key="HelpComboBoxStyle" TargetType="ComboBox">
<Setter Property="Padding" Value="0,0,0,0"/>
<Setter Property="Background" Value="#FF1F3B53"/>
<Setter Property="HorizontalContentAlignment" Value="Left"/>
<Setter Property="BorderThickness" Value="1"/>
<Setter Property="TabNavigation" Value="Once"/>
<Setter Property="BorderBrush" Value="#104F9B"/>

<Setter Property="Template">
    <Setter.Value>
        <ControlTemplate TargetType="ComboBox">
            <Grid>
                <Grid.Resources>
                    <Style TargetType="ToggleButton" x:Name="comboToggleStyle">
                        <Setter Property="BorderBrush" Value="#104F9B"/>
                        <Setter Property="BorderThickness" Value="1"/>
                        <Setter Property="Padding" Value="3"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ToggleButton">
                                    <Grid>
                                        <vsm:VisualStateManager.VisualStateGroups>
                                            <vsm:VisualStateGroup x:Name="CommonStates">
                                                <vsm:VisualStateGroup.Transitions>
                                                    <vsm:VisualTransition GeneratedDuration="00:00:00.1" To="MouseOver"/>
                                                    <vsm:VisualTransition GeneratedDuration="00:00:00.1" To="Pressed"/>
                                                </vsm:VisualStateGroup.Transitions>
                                                <vsm:VisualState x:Name="Normal"/>
                                                <vsm:VisualState x:Name="MouseOver">
                                                    <Storyboard>
                                                        <ObjectAnimationUsingKeyFrames Duration="00:00:00" Storyboard.TargetName="PopupBorder" Storyboard.TargetProperty="(UIElement.Visibility)">
                                                            <DiscreteObjectKeyFrame KeyTime="00:00:00">
                                                                <DiscreteObjectKeyFrame.Value>
                                                                    <Visibility>Visible</Visibility>
                                                                </DiscreteObjectKeyFrame.Value>
                                                            </DiscreteObjectKeyFrame>
                                                        </ObjectAnimationUsingKeyFrames>
                                                    </Storyboard>
                                                </vsm:VisualState>
                                                <vsm:VisualState x:Name="Pressed">
                                                    <Storyboard>
                                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="BackgroundOverlay2" Storyboard.TargetProperty="Opacity">
                                                            <SplineDoubleKeyFrame KeyTime="0" Value="1"/>
                                                        </DoubleAnimationUsingKeyFrames>
                                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="Highlight" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                            <SplineDoubleKeyFrame KeyTime="0" Value="1"/>
                                                        </DoubleAnimationUsingKeyFrames>
                                                        <ColorAnimationUsingKeyFrames Storyboard.TargetName="BackgroundGradient" Storyboard.TargetProperty="(Shape.Fill).(GradientBrush.GradientStops)[1].(GradientStop.Color)">
                                                            <SplineColorKeyFrame KeyTime="0" Value="#E5FFFFFF"/>
                                                        </ColorAnimationUsingKeyFrames>
                                                        <ColorAnimationUsingKeyFrames Storyboard.TargetName="BackgroundGradient" Storyboard.TargetProperty="(Shape.Fill).(GradientBrush.GradientStops)[2].(GradientStop.Color)">
                                                            <SplineColorKeyFrame KeyTime="0" Value="#BCFFFFFF"/>
                                                        </ColorAnimationUsingKeyFrames>
                                                        <ColorAnimationUsingKeyFrames Storyboard.TargetName="BackgroundGradient" Storyboard.TargetProperty="(Shape.Fill).(GradientBrush.GradientStops)[3].(GradientStop.Color)">
                                                            <SplineColorKeyFrame KeyTime="0" Value="#6BFFFFFF"/>
                                                        </ColorAnimationUsingKeyFrames>
                                                        <ColorAnimationUsingKeyFrames Storyboard.TargetName="BackgroundGradient" Storyboard.TargetProperty="(Shape.Fill).(GradientBrush.GradientStops)[0].(GradientStop.Color)">
                                                            <SplineColorKeyFrame KeyTime="0" Value="#F2FFFFFF"/>
                                                        </ColorAnimationUsingKeyFrames>
                                                    </Storyboard>
                                                </vsm:VisualState>
                                                <vsm:VisualState x:Name="Disabled">
                                                    <Storyboard>
                                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetName="DisabledVisualElement" Storyboard.TargetProperty="(UIElement.Opacity)">
                                                            <SplineDoubleKeyFrame KeyTime="0" Value="1"/>
                                                        </DoubleAnimationUsingKeyFrames>
                                                    </Storyboard>
                                                </vsm:VisualState>
                                            </vsm:VisualStateGroup>
                                            <vsm:VisualStateGroup x:Name="CheckStates"/>

                                            <vsm:VisualStateGroup x:Name="FocusStates"/>

                                        </vsm:VisualStateManager.VisualStateGroups>
                                        <Rectangle x:Name="Background" Fill="{TemplateBinding Background}" Stroke="{TemplateBinding BorderBrush}" StrokeThickness="{TemplateBinding BorderThickness}" />
                                        <Rectangle x:Name="BackgroundOverlay" Opacity="0" Fill="#FF448DCA" Stroke="#00000000" StrokeThickness="{TemplateBinding BorderThickness}" />
                                        <Rectangle x:Name="BackgroundOverlay2" Opacity="0" Fill="#FF448DCA" Stroke="#00000000" StrokeThickness="{TemplateBinding BorderThickness}" />
                                        <Rectangle Margin="{TemplateBinding BorderThickness}" x:Name="BackgroundGradient" Stroke="#FFFFFFFF" StrokeThickness="2" >
                                            <Rectangle.Fill>
                                                <LinearGradientBrush EndPoint=".7,1" StartPoint=".7,0">
                                                    <GradientStop Color="#FFFFFFFF" Offset="0"/>
                                                    <GradientStop Color="#F9FFFFFF" Offset="0.375"/>
                                                    <GradientStop Color="#E5FFFFFF" Offset="0.625"/>
                                                    <GradientStop Color="#C6FFFFFF" Offset="1"/>
                                                </LinearGradientBrush>
                                            </Rectangle.Fill>
                                        </Rectangle>
                                        <Rectangle x:Name="BackgroundOverlay3" Opacity="0" Fill="#FF448DCA" Stroke="#00000000" StrokeThickness="{TemplateBinding BorderThickness}"/>
                                        <Rectangle Margin="{TemplateBinding BorderThickness}" x:Name="BackgroundGradient2" Opacity="0" Stroke="#FFFFFFFF" StrokeThickness="2" >
                                            <Rectangle.Fill>
                                                <LinearGradientBrush EndPoint=".7,1" StartPoint=".7,0">
                                                    <GradientStop Color="#FFFFFFFF" Offset="0"/>
                                                    <GradientStop Color="#F9FFFFFF" Offset="0.375"/>
                                                    <GradientStop Color="#E5FFFFFF" Offset="0.625"/>
                                                    <GradientStop Color="#C6FFFFFF" Offset="1"/>
                                                </LinearGradientBrush>
                                            </Rectangle.Fill>
                                        </Rectangle>
                                        <Rectangle Margin="{TemplateBinding BorderThickness}" x:Name="Highlight" IsHitTestVisible="false" Opacity="0" Stroke="#FF45D6FA" StrokeThickness="2" />
                                        <ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" Margin="{TemplateBinding Padding}" x:Name="contentPresenter" VerticalAlignment="{TemplateBinding VerticalContentAlignment}" Content="{TemplateBinding Content}" ContentTemplate="{TemplateBinding ContentTemplate}"/>
                                        <Rectangle x:Name="DisabledVisualElement" IsHitTestVisible="false" Opacity="0" Fill="#A5FFFFFF" />
                                        <Rectangle x:Name="FocusVisualElement" IsHitTestVisible="false" Visibility="Collapsed" Stroke="#FF45D6FA" StrokeThickness="2" />
                                    </Grid>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </Grid.Resources>
                <vsm:VisualStateManager.VisualStateGroups>
                    <vsm:VisualStateGroup x:Name="CommonStates">
                        <vsm:VisualStateGroup.Transitions>
                            <vsm:VisualTransition GeneratedDuration="00:00:00.1"/>
                            <vsm:VisualTransition From="MouseOver" GeneratedDuration="00:00:00.1000000" To="Normal"/>
                        </vsm:VisualStateGroup.Transitions>
                        <vsm:VisualState x:Name="Normal"/>
                        <vsm:VisualState x:Name="MouseOver"/>
                        <vsm:VisualState x:Name="Disabled">
                            <Storyboard>
                                <DoubleAnimationUsingKeyFrames Storyboard.TargetName="DisabledVisualElement" Storyboard.TargetProperty="(UIElement.Opacity)">
                                    <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                </DoubleAnimationUsingKeyFrames>
                            </Storyboard>
                        </vsm:VisualState>
                    </vsm:VisualStateGroup>
                    <vsm:VisualStateGroup x:Name="FocusStates">
                        <vsm:VisualState x:Name="Focused">
                            <Storyboard>
                                <DoubleAnimationUsingKeyFrames Storyboard.TargetName="FocusVisualElement" Storyboard.TargetProperty="(UIElement.Opacity)">
                                    <SplineDoubleKeyFrame KeyTime="00:00:00" Value="1"/>
                                </DoubleAnimationUsingKeyFrames>
                            </Storyboard>
                        </vsm:VisualState>
                        <vsm:VisualState x:Name="Unfocused"/>
                        <vsm:VisualState x:Name="FocusedDropDown">
                            <Storyboard>
                                <ObjectAnimationUsingKeyFrames Duration="00:00:00" Storyboard.TargetName="PopupBorder" Storyboard.TargetProperty="(UIElement.Visibility)">
                                    <DiscreteObjectKeyFrame KeyTime="00:00:00">
                                        <DiscreteObjectKeyFrame.Value>
                                            <Visibility>Visible</Visibility>
                                        </DiscreteObjectKeyFrame.Value>
                                    </DiscreteObjectKeyFrame>
                                </ObjectAnimationUsingKeyFrames>
                            </Storyboard>
                        </vsm:VisualState>
                    </vsm:VisualStateGroup>
                </vsm:VisualStateManager.VisualStateGroups>
                <Border x:Name="ContentPresenterBorder">
                    <Grid>                              
                        <ToggleButton HorizontalAlignment="Stretch" Margin="0" x:Name="DropDownToggle"   Background="white" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" HorizontalContentAlignment="Right">
                            <Path Height="8" HorizontalAlignment="Center" Margin="0,0,0,0" x:Name="BtnArrow" Width="10" Stretch="Uniform" Data="F1 M 301.14,-189.041L 311.57,-189.041L 306.355,-182.942L 301.14,-189.041 Z ">
                                <Path.Fill>
                                    <SolidColorBrush Color="#104F9B" x:Name="BtnArrowColor"/>
                                </Path.Fill>
                            </Path>
                        </ToggleButton>
                        <ContentPresenter Visibility="Collapsed" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" Margin="{TemplateBinding Padding}" x:Name="ContentPresenter" VerticalAlignment="{TemplateBinding VerticalContentAlignment}">

                        </ContentPresenter>
                    </Grid>
                </Border>
                <Rectangle x:Name="DisabledVisualElement" IsHitTestVisible="false" Opacity="0" Fill="#A5FFFFFF" RadiusX="3" RadiusY="3"/>
                <Rectangle x:Name="FocusVisualElement" IsHitTestVisible="false" Opacity="0" Stroke="#FF45D6FA" StrokeThickness="1" RadiusX="3" RadiusY="3"/>
                <Popup x:Name="Popup">
                    <Popup.RenderTransform>
                        <TranslateTransform X="-125" />
                    </Popup.RenderTransform>
                    <Border Height="Auto" HorizontalAlignment="Stretch" x:Name="PopupBorder" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="3">
                        <Border.Background>
                            <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                                <GradientStop Color="#FFFFFFFF" Offset="0"/>
                                <GradientStop Color="#FFFEFEFE" Offset="1"/>
                            </LinearGradientBrush>
                        </Border.Background>
                        <ScrollViewer x:Name="ScrollViewer" BorderThickness="0" Padding="1">
                            <ItemsPresenter/>
                        </ScrollViewer>
                    </Border>
                </Popup>
            </Grid>
        </ControlTemplate>
    </Setter.Value>
</Setter> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T18:42:36.703

我将不得不在这里回答我自己的问题。我专注于 xaml，我不认为只是`MouseEnter`在组合框控件上添加事件处理程序。

# c# - 可以在 KeyedCollection 中使用 int 作为键吗

> ID：201956
> 
> 赞同：11
> 
> 时间：2008-10-14T16:49:38.163
> 
> 标签：c#, .net, generics, collections

很多时候，我需要一组带有数字标识符的非顺序对象。我喜欢为此使用 KeyedCollection，但我认为有一个严重的缺点。如果使用 int 作为键，则不能再通过索引访问集合成员（collection[index] 现在实际上是 collection[key]）。这是一个足够严重的问题来避免使用 int 作为键吗？更可取的选择是什么？（也许是 int.ToString()？）

我以前这样做过，没有任何重大问题，但最近我遇到了一个令人讨厌的问题，如果密钥是 int，则针对 KeyedCollection 的 XML 序列化*不起作用，这是由于*[.NET 中的一个错误](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=120461)。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-14T17:18:21.630

基本上，您需要确定该类的用户是否可能会因为他们不能这样做而感到困惑，例如：

```
for(int i=0; i=< myCollection.Count; i++)
{
    ... myCollection[i] ...
} 
```

尽管他们当然可以使用 foreach 或使用演员表：

```
for(int i=0; i=< myCollection.Count; i++)
{
    ... ((Collection<MyType>)myCollection)[i] ...
} 
```

这不是一个容易的决定，因为它很容易导致 heisenbugs。我决定在我的一个应用程序中允许它，该类用户几乎完全通过密钥访问。

我不确定我是否会为共享类库这样做：一般来说，我会避免在公共 API 中公开 KeyedCollection：相反，我会在公共 API 中公开 IList<T>，并且 API 的使用者需要键控访问可以使用构造函数定义自己的内部 KeyedCollection，该构造函数采用 IEnumerable<TItem> 并用它填充集合。这意味着您可以轻松地从从 API 检索的列表中构建新的 KeyedCollection。

[关于序列化，我向 Microsoft Connect 报告了](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=302290)一个性能问题：KeyedCollection 维护一个内部字典和一个列表，并序列化两者 - 序列化列表就足够了，因为可以轻松地在反序列化时重新创建字典。

由于这个原因以及 XmlSerialization 错误，我建议您避免序列化 KeyedCollection - 而只序列化 KeyedCollection.Items 列表。

我不喜欢[将您的 int 键包装在另一种类型中的建议](https://stackoverflow.com/questions/201956/is-it-ok-to-use-an-int-for-the-key-in-a-keyedcollection#201983)。在我看来，简单地添加复杂性以便可以将类型用作 KeyedCollection 中的项目是错误的。我会使用字符串键 (ToString) 而不是这样做 - 这很像 VB6 Collection 类。

FWIW，我前段时间在 MSDN 论坛上问[过同样的问题。](http://social.msdn.microsoft.com/Forums/en-US/vstscode/thread/d2163d71-636e-4521-926a-a7cce260143c/)FxCop 团队的一名成员做出了回应，但没有决定性的指导方针。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-14T16:58:01.377

一个简单的解决方案可能是将 包装`int`到另一种类型中，以创建一个不同的类型来解决重载问题。如果您使用 a `struct`，则此包装器没有任何额外开销：

```
struct Id {
    public int Value;

    public Id(int value) { Value = value; }

    override int GetHashCode() { return Value.GetHashCode(); }

    // … Equals method.
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-14T16:52:40.980

最好将**`GetById(int)`**方法添加到集合类型。`Collection<T>`如果您不需要任何其他密钥来访问包含的对象，则可以使用：

```
public class FooCollection : Collection<Foo>
 { Dictionary<int,Foo> dict = new Dictionary<int,Foo>();

   public Foo GetById(int id) { return dict[id]; }

   public bool Contains(int id) { return  dict.Containskey(id);}

   protected override void InsertItem(Foo f)
    { dict[f.Id] = f;
      base.InsertItem(f);
    }

   protected override void ClearItems()
    { dict.Clear();
      base.ClearItems();
    }

   protected override void RemoveItem(int index)
    { dict.Remove(base.Items[index].Id);
      base.RemoveItem(index);
    }

   protected override void SetItem(int index, Foo item)
    { dict.Remove(base.Items[index].Id);
      dict[item.Id] = item;
      base.SetItem(index, item);
    }
 }

 } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-14T16:54:38.747

KeyedCollection 中的键应该是唯一的，并且可以从正在收集的对象中快速导出。例如，给定一个人员类，它可能是 SSN 属性，甚至可能是连接 FirstName 和 LastName 属性（如果已知结果是唯一的）。如果 ID 合法地是正在收集的对象的字段，则它是键的有效候选者。但也许尝试将其转换为字符串以避免碰撞。

# c# - 如何执行未标记为可序列化的对象的深层副本（在 C# 中）？

> ID：201957
> 
> 赞同：4
> 
> 时间：2008-10-14T16:50:32.403
> 
> 标签：c#, clipboard, deep-copy, idataobject

我正在尝试在 C# 中创建剪贴板堆栈。剪贴板数据存储在`System.Windows.Forms.DataObject`对象中。我想将每个剪贴板条目 ( `IDataObject`) 直接存储在通用列表中。由于位图（似乎）的存储方式，我认为我需要先执行深层复制，然后再将其添加到列表中。

我尝试使用二进制序列化（见下文）来创建深层副本，但由于`System.Windows.Forms.DataObject`未标记为可序列化，因此序列化步骤失败。有任何想法吗？

```
public IDataObject GetClipboardData()
{
    MemoryStream memoryStream = new MemoryStream();
    BinaryFormatter binaryFormatter = new BinaryFormatter();
    binaryFormatter.Serialize(memoryStream, Clipboard.GetDataObject());
    memoryStream.Position = 0;
    return (IDataObject) binaryFormatter.Deserialize(memoryStream);
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-14T17:09:38.450

我为另一个问题编写了下面的代码，也许在这种情况下它可能对您有用：

```
 public static class GhettoSerializer
    {
            // you could make this a factory method if your type
            // has a constructor that appeals to you (i.e. default 
            // parameterless constructor)
            public static void Initialize<T>(T instance, IDictionary<string, object> values)
            {
                    var props = typeof(T).GetProperties();

                    // my approach does nothing to handle rare properties with array indexers
                    var matches = props.Join(
                            values,
                            pi => pi.Name,
                            kvp => kvp.Key,
                            (property, kvp) =>
                                    new {
                                            Set = new Action<object,object,object[]>(property.SetValue), 
                                            kvp.Value
                                    }
                    );

                    foreach (var match in matches)
                            match.Set(instance, match.Value, null);
            }
            public static IDictionary<string, object> Serialize<T>(T instance)
            {
                    var props = typeof(T).GetProperties();

                    var ret = new Dictionary<string, object>();

                    foreach (var property in props)
                    {
                            if (!property.CanWrite || !property.CanRead)
                                    continue;
                            ret.Add(property.Name, property.GetValue(instance, null));
                    }

                    return ret;
            }
    } 
```

但是，我认为这不会是您问题的最终解决方案，尽管它可能会给您一个起点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-05T04:56:01.467

查找 Serializable 的扩展坞并找到有关序列化助手的内容。您可以将位图包装在您自己的与 .net 框架集成的序列化代码中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-11-07T13:18:15.303

我的答案副本：[.net 中 DataContract 属性和 Serializable 属性之间的区别](https://stackoverflow.com/questions/4545439/difference-between-datacontract-attribute-and-serializable-attribute-in-net/19836842#19836842)

我的回答在这里比那里好得多，尽管上面的问题以：

> “......或者也许是创建深度克隆的不同方式？”

我曾经通过反射对对象结构进行了一些检查，以找到反序列化所需的所有程序集，并将它们与引导程序一起序列化。

通过一些工作，您可以构建一种类似的深度复制方法。基本上，您需要一个带有 Dictionary 的递归方法来检测循环引用。在方法中，您检查所有字段，如下所示：

```
private void InspectRecursively(object input,
    Dictionary<object, bool> processedObjects)
{
  if ((input != null) && !processedObjects.ContainsKey(input))
  {
    processedObjects.Add(input, true);

    List<FieldInfo> fields = type.GetFields(BindingFlags.Instance |
        BindingFlags.Public | BindingFlags.NonPublic );
    foreach (FieldInfo field in fields)
    {
      object nextInput = field.GetValue(input);

      if (nextInput is System.Collections.IEnumerable)
      {
        System.Collections.IEnumerator enumerator = (nextInput as
            System.Collections.IEnumerable).GetEnumerator();

        while (enumerator.MoveNext())
        {
          InspectRecursively(enumerator.Current, processedObjects);
        }
      }
      else
      {
        InspectRecursively(nextInput, processedObjects);
      }
    }
  }
} 
```

为了让它工作，你需要添加一个输出对象和类似的东西`System.Runtime.Serialization.FormatterServices.GetUninitializedObject(Type type)`来创建每个字段值的最浅的副本（即使没有复制引用）。最后，您可以使用类似的内容设置每个字段`field.SetValue(input, output)`

但是，此实现不支持已注册的事件处理程序，反序列化也**_un_**支持。此外，层次结构中的每个对象都将被破坏，如果其类的构造函数需要初始化任何内容而不是设置所有字段。最后一点仅适用于序列化，如果该类具有相应的实现，例如方法标记`[OnDeserialized]`，实现`ISerializable`，...。

# sql-server - SQL Server 表中的行数限制

> ID：201959
> 
> 赞同：4
> 
> 时间：2008-10-14T16:50:39.003
> 
> 标签：sql-server

sql server 表中的表行数是否有硬性限制？我的印象是唯一的限制是基于物理存储。

在有和没有索引的表上，性能在什么时候显着下降（如果有的话）。非常大的桌子有什么常见的做法吗？

为了提供一点领域知识，我们正在考虑使用 Audit 表，该表将记录数据库中所有表的字段更改，并且想知道我们可能会遇到哪些类型的墙。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T16:58:33.167

您是正确的，行数受可用存储空间的限制。

很难给出任何数字，因为它在很大程度上取决于您的服务器硬件、配置以及查询的效率。

例如，随着行数的增加，一个简单的 select 语句将比全文或邻近搜索运行得更快并且显示更少的降级。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T17:06:58.003

BrianV 是正确的。很难给出一个规则，因为它会根据您使用表的方式、索引的方式、表中的实际列等而发生巨大变化。

至于常见做法......对于非常大的表，您可能会考虑分区。如果您发现您的日志通常只关心过去 1 个月（或 1 天、1 周、1 年等）的变化，这可能特别有用。然后，您可以归档数据的旧部分，以便在绝对需要时可用，但不会妨碍您，因为您几乎永远不需要它。

要考虑的另一件事是，如果您还没有计划这样做，则为每个实际表创建一个单独的更改日志表。使用单个日志表使其非常难以使用。您通常必须将信息记录在难以查询和处理的自由格式文本字段中。此外，如果每列都有已更改的行，则很难查看数据，因为您必须执行大量连接才能查看同时发生的更改。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-14T17:24:58.577

除了上述所有内容之外，这些都是很棒的建议，我想我会在索引/性能点上提供更多背景信息。

如上所述，不可能给出性能数字，因为根据索引的质量和数量，性能会有所不同。它还取决于您要优化的操作。您需要优化刀片吗？还是您更关心查询响应？

如果您真的关心插入速度、分区以及非常仔细的索引考虑将是关键。

Tom H 的单独表格推荐也是一个好主意。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-14T17:15:26.677

使用审计表的另一种方法是每月（或每周，取决于您放入多少数据）左右归档一次数据。这样，如果您需要使用新数据重新创建一些最近的更改，可以针对较小的表完成，从而更快（从审计表中恢复几乎总是我发现的一项紧迫任务！）。但是你仍然有可用的数据，以防你需要回到更远的时间。

# cocoa - 设置 QTMovie 属性

> ID：201966
> 
> 赞同：5
> 
> 时间：2008-10-14T16:52:27.597
> 
> 标签：cocoa, macos, quicktime, qtkit

我正在尝试通过 QTKit 创建 QTVR 电影，并且我已经获得了电影中的所有帧。但是，设置必要的属性似乎没有任何效果。例如：

```
NSNumber *val = [NSNumber numberWithBool:YES];
[fMovie setAttribute:val forKey:QTMovieIsInteractiveAttribute];

val = [NSNumber numberWithBool:NO];
[fMovie setAttribute:val forKey:QTMovieIsLinearAttribute]; 
```

如果然后我得到这些属性的值，它们会分别显示为 NO 和 YES。这部电影是可编辑的，所以我不明白我在这里做错了什么。我怎样才能确保属性会真正改变？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-04T22:05:38.173

当我想导出 Quicktime 电影时，我会执行以下操作：

```
NSMutableDictionary *dictionary = [NSMutableDictionary dictionaryWithObjectsAndKeys:
    [NSNumber numberWithBool:YES], QTMovieExport,
    [exportSettings objectForKey: @"subtype"], QTMovieExportType,
    [exportSettings objectForKey: @"manufacturer"], QTMovieExportManufacturer,
    [exportSettings objectForKey: @"settings"], QTMovieExportSettings,                                      
  nil];

BOOL didSucceed = [movie writeToFile: tmpFileName withAttributes:dictionary error: &error]; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-06-05T22:50:38.497

这些属性被记录为您可以读取但不能写入的内容。但是，您可以在创建电影时使用 initWithAttributes:error: 设置它们。

# windows - 探索包含文件夹而不是打开包含文件夹

> ID：201978
> 
> 赞同：1
> 
> 时间：2008-10-14T16:56:23.967
> 
> 标签：windows, visual-studio-2005, windows-explorer

我使用 Visual Studio 进行大量编码。我发现打开包含文件夹功能非常有用。但我不希望文件夹被 Windows 资源管理器“打开”，而是我想“探索”文件夹——你知道，得到一个漂亮的小框架，向我展示左侧的所有其他文件夹。有谁知道如何做到这一点？

谢谢你，罗希特

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T16:57:50.627

调用 ShellExecute() 时，使用 explore 动词而不是 open 动词：http: [//msdn.microsoft.com/en-us/library/bb762153%28VS.85%29.aspx](http://msdn.microsoft.com/en-us/library/bb762153%28VS.85%29.aspx)。

编辑：如果您不是以编程方式，打开 Windows 资源管理器，转到工具 -> 文件夹选项，选择文件类型选项卡，在列表中找到文件夹条目（不是文件夹！），单击高级，然后设置“探索”默认情况下，而不是“打开”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T17:09:04.427

如果您谈论的是文件夹，则“探索”和“打开”之间确实没有太大区别。它们都打开同一个窗口，只是激活了不同的选项。当您“打开”文件夹时，您只需单击一下（至少在我的系统上）就可以看到文件夹树 - 只需单击工具栏中的“文件夹”按钮。

# asp.net - “与底层事务管理器的通信失败”错误消息

> ID：201988
> 
> 赞同：8
> 
> 时间：2008-10-14T16:59:11.483
> 
> 标签：asp.net, transactions

我们的一个客户最近将一个 ASP.NET 1.1 Web 应用程序升级到使用 COM+ 事务处理的 ASP.NET，并在尝试处理事务时收到以下异常：

> 异常类型：System.Transactions.TransactionManagerCommunicationException
> 消息：与底层事务管理器的通信失败。
> 
> 内部异常类型：System.Runtime.InteropServices.COMException 错误代码：-2147467259
> 消息：对 COM 组件的调用已返回错误 HRESULT E_FAIL。

以下是 MSDTC 安全设置上的以下设置：

> -- 网络 DTC 访问
> -- 允许入站
> -- 允许出站
> -- 需要来电验证

Windows XP SP3 工作站正在尝试建立与 Windows Server 2003 计算机的连接。

有没有其他人遇到过这个错误并且知道如何解决它。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-22T00:59:37.077

您需要在 XP 工作站和 Windows 2003 机器上启用网络 DTC 访问。此外，如果您的应用程序仅在内部发布，您可以关闭来电者身份验证并将其设置为“无身份验证”。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-05-06T09:29:03.277

将 C:\Windows\msdtc.exe 添加到防火墙和服务器上的防火墙例外中。在我这样做之前，我花了很长时间在打开特定的端口号和范围内胡闹，但无济于事。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-10-20T12:11:21.080

1)除了启用对“分布式事务协调”服务的网络访问外，禁用身份验证（在xp sp3机器中，相互身份验证不起作用）

2) 为“分布式事务协调”服务启用客户端（web 应用程序）和服务器（sql server）机器的网络访问。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T15:17:26.933

您还需要确保您的防火墙对端口 135 和 5000-5020 开放。

请参阅这些： [http ://social.msdn.microsoft.com/forums/en-US/windowstransactionsprogramming/thread/71f7a219-c85d-4a04-973b-c73464f59606/](http://social.msdn.microsoft.com/forums/en-US/windowstransactionsprogramming/thread/71f7a219-c85d-4a04-973b-c73464f59606/) [http://blogs.msdn.com/florinlazar/archive/2005 /09/16/469064.aspx](http://blogs.msdn.com/florinlazar/archive/2005/09/16/469064.aspx) [http://social.msdn.microsoft.com/forums/en-US/architecturegeneral/thread/7731d7a7-a9ad-42e7-b0bb-f3656b870304/](http://social.msdn.microsoft.com/forums/en-US/architecturegeneral/thread/7731d7a7-a9ad-42e7-b0bb-f3656b870304/) [http://support.microsoft.com/ KB/154596/](http://support.microsoft.com/kb/154596/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-02-06T16:01:16.927

如果您需要帮助查找其他答案中提到的 MSDTC 设置（就像我所做的那样），以下链接说明了如何在服务器 2003 上配置 MSDTC。

[http://itknowledgeexchange.techtarget.com/sql-server/how-to-configure-dtc-on-windows-2003/](http://itknowledgeexchange.techtarget.com/sql-server/how-to-configure-dtc-on-windows-2003/)

# sql - 如何确定上次在特定 Sql Server 2000 数据库中更改任何记录的时间？

> ID：201990
> 
> 赞同：0
> 
> 时间：2008-10-14T16:59:42.200
> 
> 标签：sql, sql-server-2000

我有一个很少更新的 SQL Server 2000 数据库实例。我还有一个数据库表，其中没有包含每行创建日期或修改日期的列。

有什么方法可以确定上次对整个数据库执行更新或插入的时间，以便我至少可以确定表中的特定记录何时发生更改？

注意：我正在寻找有关已经发生的交易的信息。如果将来我再次需要它，触发器可能会对我们有所帮助，但不能解决我试图描述的问题。

如果可以做到，我该怎么做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-14T17:22:27.770

数据库的日志文件可能包含一些对您的任务有用的信息。AFAIK，数据库本身不存储“最后更新”日期。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-14T17:21:31.437

根据数据库的大小和表的数量，您可以放置​​一个触发器来处理更新/或插入并将其记录到另一个表，可能记录表名和时间戳，它并不优雅但可以工作. 并且不需要对数据库的其余部分进行任何修改。

# c++ - 如何在 C++ 中从 cin 读取直到 EOF

> ID：201992
> 
> 赞同：94
> 
> 时间：2008-10-14T17:01:00.620
> 
> 标签：c++, input, iostream

我正在编写一个直接从用户输入读取数据的程序，并且想知道如何（没有循环）从标准输入读取所有数据，直到 EOF。我正在考虑使用`cin.get( input, '\0' )`但`'\0'`不是真正的 EOF 字符，它只会读取到 EOF 或`'\0'`，以先到者为准。

还是使用循环是唯一的方法？如果是这样，最好的方法是什么？

* * *

## 回答 #1

> 赞同：90
> 
> 时间：2008-10-14T17:16:38.327

您可以从中读取可变数量数据的唯一方法`stdin`是使用循环。我一直发现这个[`std::getline()`](http://en.cppreference.com/w/cpp/string/basic_string/getline)功能很好用：

```
std::string line;
while (std::getline(std::cin, line))
{
    std::cout << line << std::endl;
} 
```

默认情况下`getline()`读取直到换行。您可以指定替代终止字符，但 EOF 本身不是字符，因此您不能简单地调用`getline()`.

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2008-10-14T17:43:34.543

Using loops:

```
#include <iostream>
using namespace std;
...
// numbers
int n;
while (cin >> n)
{
   ...
}
// lines
string line;
while (getline(cin, line))
{
   ...
}
// characters
char c;
while (cin.get(c))
{
   ...
} 
```

[resource](http://acm.timus.ru/help.aspx?topic=cpp)

* * *

## 回答 #3

> 赞同：53
> 
> 时间：2008-10-14T17:35:00.130

You can do it without explicit loops by using stream iterators. I'm sure that it uses some kind of loop internally.

```
#include <string>
#include <iostream>
#include <istream>
#include <ostream>
#include <iterator>

int main()
{
// don't skip the whitespace while reading
  std::cin >> std::noskipws;

// use stream iterators to copy the stream to a string
  std::istream_iterator<char> it(std::cin);
  std::istream_iterator<char> end;
  std::string results(it, end);

  std::cout << results;
} 
```

* * *

## 回答 #4

> 赞同：36
> 
> 时间：2016-05-02T09:10:20.150

在使用 研究 KeithB 的解决方案后`std::istream_iterator`，我发现了[`std:istreambuf_iterator`](http://en.cppreference.com/w/cpp/iterator/istreambuf_iterator).

测试程序将所有管道输入读入字符串，然后再次写出：

```
#include <iostream>
#include <iterator>
#include <string>

int main()
{
  std::istreambuf_iterator<char> begin(std::cin), end;
  std::string s(begin, end);
  std::cout << s;
} 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2015-05-18T15:04:07.333

可能最简单且通常有效的：

```
#include <iostream>
int main()
{
    std::cout << std::cin.rdbuf();
} 
```

如果需要，在此处使用其他类型的流（`std::ostringstream`如缓冲区）而不是标准输出流。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-08-03T10:10:23.833

悲伤的旁注：我决定使用 C++ IO 来与基于 boost 的代码保持一致。从这个问题的答案我选择了`while (std::getline(std::cin, line))`。在 cygwin (mintty) 中使用 g++ 版本 4.5.3 (-O3) 我得到了 2 MB/s 的吞吐量。Microsoft Visual C++ 2010 (/O2) 使相同代码的速度达到 40 MB/s。

在将 IO 重写为纯 C 后`while (fgets(buf, 100, stdin))`，两个测试编译器的吞吐量都跃升至 90 MB/s。这对于任何大于 10 MB 的输入都会有所不同......

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-14T17:14:14.183

您可以使用[std::istream::getline()](http://www.cplusplus.com/reference/iostream/istream/getline.html)（或者最好[是适用于 std::string 的版本](http://www.cppreference.com/wiki/string/getline)）函数来获取整行。两者都有允许您指定分隔符（行尾字符）的版本。字符串版本的默认值为 '\n'。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-05-25T23:38:17.063

```
while(std::cin) {
 // do something
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-12-18T23:13:53.357

一种选择是使用容器，例如

```
std::vector<char> data; 
```

并将所有输入*重定向*到此集合中，直到`EOF`收到，即

```
std::copy(std::istream_iterator<char>(std::cin),
    std::istream_iterator<char>(),
    std::back_inserter(data)); 
```

但是，使用过的容器可能需要过于频繁地重新分配内存，或者当系统内存不足时，您将以`std::bad_alloc`异常结束。为了解决这些问题，您可以*保留*固定数量`N`的元素并单独处理这些数量的元素，即

```
data.reserve(N);    
while (/*some condition is met*/)
{
    std::copy_n(std::istream_iterator<char>(std::cin),
        N,
        std::back_inserter(data));

    /* process data */

    data.clear();
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-08-10T17:00:59.430

等等，我理解正确吗？您正在使用 cin 进行键盘输入，并且希望在用户输入 EOF 字符时停止读取输入？为什么用户会输入 EOF 字符？还是您的意思是您想停止在 EOF 处读取文件？

如果您实际上是在尝试使用 cin 来读取 EOF 字符，那么为什么不将 EOF 指定为分隔符呢？

```
// Needed headers: iostream

char buffer[256];
cin.get( buffer, '\x1A' ); 
```

如果您打算在 EOF 处停止读取文件，则只需使用 getline 并再次将 EOF 指定为分隔符。

```
// Needed headers: iostream, string, and fstream

string buffer;

    ifstream fin;
    fin.open("test.txt");
    if(fin.is_open()) {
        getline(fin,buffer,'\x1A');

        fin.close();
    } 
```

# caching - 您如何使 RSS 提要条目的可用时间长于从源可访问的时间？

> ID：201993
> 
> 赞同：1
> 
> 时间：2008-10-14T17:01:08.077
> 
> 标签：caching, rss, offline, podcast

我家的电脑设置为自动从 RSS 源（主要是种子和播客）下载一些东西。但是，我并不总是打开这台电脑。我订阅的站点具有相对较大的吞吐量，因此当我重新打开计算机时，它不知道从关闭到最新更新之间错过了什么。

**您将如何将提要条目存储比实际站点上可用的时间更长的时间？**

我检查了雅虎的管道并发现没有这样的功能，谷歌阅读器可以做到这一点，但它需要手动标记每个项目。Magpie RSS for php 可以进行缓存，但这只是为了避免过多地检索提要，而不是真正存储更多条目。

我可以访问 24/7 的网络服务器 (LAMP)，因此使用 php/mysql 的解决方案会非常好，任何现有的网络服务也会很棒。

我可以编写自己的代码来执行此操作，但我确定这一定是某人以前遇到的问题？

**我所做的：** 我不知道您可以使用 Google 阅读器共享整个标签，感谢 Mike Wills 指出这一点。一旦我知道我可以做到这一点，只需将提要添加到单独的 Google 帐户（不要堵塞我的个人阅读列表），我还使用 Yahoo 管道进行了一些选择性匹配，以获得我感兴趣的特定条目在，这也是为了尽量减少错过任何事情的风险。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T17:10:11.210

听起来[Google 阅读](http://reader.google.com)器可以满足您的所有需求。不确定标记单个项目是什么意思 - 您必须使用任何 RSS 聚合器来执行此操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T17:07:13.697

听起来您需要某种服务，每 X 分钟检查一次 RSS 提要，因此您可以在“观看”时下载发布到提要的*每篇*文章/项目，而不是仅在您看到提要上显示的项目时去查看它。我说的对吗？

与其想出一个成熟的软件解决方案，您是否可以在网络服务器上使用 cron 或其他类型的作业调度，以及您已经使用的任何解决方案来阅读提要并下载其内容？

否则，听起来您最终将接近重写像 Google Reader 这样的成熟服务。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T18:34:43.973

我使用 Google Reader 订阅我的 podiobooks.com。我将所有提要添加到我共享的标签（在本例中为 podiobooks.com）（但不共享 URL）。然后我将 RSS 提要添加到 iTunes。[这里的例子](http://www.google.com/reader/shared/user/12209278408903133361/label/podiobooks.com)。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-14T17:16:23.477

使用一个好的 RSS 库编写一个聚合器来保存更长的历史应该不会太难。

# google-gears - 启用 Google Gears 的网站的完整列表

> ID：201994
> 
> 赞同：7
> 
> 时间：2008-10-14T17:01:23.770
> 
> 标签：google-gears

是否有支持 Google Gears 的网站的完整列表？我知道 rememberthemilk.com、谷歌文档和谷歌日历

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-14T17:13:06.320

MySpace 的消息系统是Google 之外*最大的消息系统之一。*至少我根据[这篇文章](http://www.techcrunch.com/2008/05/28/myspace-shows-facebook-how-its-done-google-gears-to-power-messaging/)是这么认为的。

其他网站有：

*   [WordPress](http://wordpress.com)
*   [头脑大师](http://www.mindmeister.com/services/tools/offline)
*   [密码包](http://www.passpack.com/)
*   [ZohoWriter](http://writer.zoho.com/)
*   [BuxFer](http://buxfer.com/)
*   [一些事情](http://thn.gs/)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-14T17:13:43.310

到目前为止，似乎：

*   wordpress.com
*   佐霍作家
*   缓冲区
*   密码包
*   谷歌读者
*   心灵导师
*   Google Picasa 网络相册
*   MySpace（邮件搜索）
*   YouTube

以某种方式支持 Google Gears。（列表编译自：[wikipedia](http://en.wikipedia.org/wiki/Google_Gears)和[此站点此处](http://www.labnol.org/internet/tools/web-applications-compatible-with-google-gears/1889/)）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-15T16:26:35.340

按照感知到的离线实现复杂性递减的顺序列出：

*   Autodesk Labs 项目图
*   缓冲区
*   邮箱
*   谷歌日历
*   谷歌文档
*   谷歌读者
*   心灵导师
*   我的空间
*   支付宝
*   密码包
*   Picasa 网络相册
*   记住牛奶
*   一些事情
*   WordPress
*   Zoho Mail
*   Zoho作家

取自： [http ://tarunupadhyay.com/2009/06/15/full-list-of-websites-that-you-can-take-offline-with-google-gears/](http://tarunupadhyay.com/2009/06/15/full-list-of-websites-that-you-can-take-offline-with-google-gears/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-03T14:51:35.053

Gmail[现在也使用 Gears](http://googlesystem.blogspot.com/2008/07/gmail-and-google-calendar-to-add.html)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-14T17:03:08.947

[记住牛奶](http://rememberthemilk.com)*************