# StackOverflow 问答 000415000-000415999

# eclipse - 如何在 OS X 上设置 Subclipse/Eclipse 日期格式？

> ID：415004
> 
> 赞同：1
> 
> 时间：2009-01-06T00:10:09.000
> 
> 标签：eclipse, macos, subclipse

使用 Eclipse（3.4.1，OS X）的 Subclipse 插件（1.4.5）将一些颠覆元数据添加到文件导航器窗格，包括修改日期。不幸的是，这个日期是 m/d/y 格式，而我更喜欢它是 d/m/y。

Subclipse 可能正在使用 Eclipse 进行日期格式设置，但我不记得见过任何其他 m/d/y 实例（Eclipse 中的其他日期位置似乎都包含完整的月份名称）。在任何情况下，我都无法找到在 Eclipse 或 Subclipse 设置中设置格式的方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-06T00:14:21.330

试试这个：

1.  系统偏好设置 > 国际 > 语言。
2.  点击“编辑列表”
3.  检查“澳大利亚英语”
4.  点击确定
5.  重启 Eclipse

# php - PHP会话变量没有传递到我的登录页面，但会话ID是

> ID：415005
> 
> 赞同：5
> 
> 时间：2009-01-06T00:10:54.817
> 
> 标签：php, session, redirect, variables

我正在使用**PHP 4.3.9、Apache/2.0.52**

我正在尝试使登录系统正常工作，该系统在会话中注册数据库值，一旦登录就可以使用它们。**一旦我被重定向，我就会丢失会话变量**。

我正在使用以下代码在我的登录表单页面和重定向页面上打印会话 ID/值：

```
echo '<font color="red">session id:</font> ' . session_id() . '<br>';
echo '<font color="red">session first name:</font> ' . $_SESSION['first_name'] . '<br>';
echo '<font color="red">session user id:</font> ' . $_SESSION['user_id'] . '<br>';
echo '<font color="red">session user level:</font> ' . $_SESSION['user_level'] . '<br><br>'; 
```

这是从我的登录页面在我的浏览器中打印的内容（我只是将标题重定向到登录页面注释掉）。**这也是来自我的数据库的正确信息，所以此时一切都很好**。

```
session id: 1ce7ca8e7102b6fa4cf5b61722aecfbc
session first name: elvis
session user id: 2
session user level: 1 
```

这是打印在我的重定向/登录页面上的内容（当我取消注释标题/重定向时）。**会话 ID 相同**，但我没有得到各个会话变量的值。

```
session id: 1ce7ca8e7102b6fa4cf5b61722aecfbc
session first name:
session user id:
session user level: 
```

我收到以下错误：

**未定义索引：first_name
未定义索引：user_id
未定义索引：user_level**

我有一个全局**header.php**文件，我的 loggedIN.php 不会调用它，但loggedOUT.php 会调用该文件 - 为会话敬酒）：

**头文件.php**

```
<?php
ob_start();
session_start();

//if NOT on loggedout.php, check for cookie. if exists, they haven't explicity logged out so take user to loggedin.php
if (!strpos($_SERVER['PHP_SELF'], 'loggedout.php')) {
    /*if (isset($_COOKIE['access'])) {
        header('Location: www.mydomain.com/loggedin.php');
    }*/
} else {
    //if on loggedout.php delete cookie
    //setcookie('access', '', time()-3600);

    //destroy session
    $_SESSION = array();
    session_destroy();
    setcookie(session_name(), '', time()-3600);
}

//defines constants and sets up custom error handler
require_once('config.php');

?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

some page layout stuff

Login portion is eventually called via include

footer stuff 
```

我的**loggedIN.php**除了启动会话之外什么都不做

```
<?php
session_start();
?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> 
```

我的登录脚本的**逻辑**，关键部分是我将数据库结果直接提取到 $_SESSION 中（大约一半）：

```
if (isset($_POST['login'])) {
        //access db
        require_once(MYSQL);

        //initialize an errors array for non-filled out form fields
        $errors = array();

        //setup $_POST aliases, clean for db and trim any whitespace
        $email  = mysql_real_escape_string(trim($_POST['email']), $dbc);
        $pass   = mysql_real_escape_string(trim($_POST['pass']), $dbc);

        if (empty($email)) {
            $errors[] = 'Please enter your e-mail address.';
        }

        if (empty($pass)) {
            $errors[] = 'Please enter your password.';
        }

        //if all fields filled out and everything is OK
        if (empty($errors)) {
            //check db for a match
            $query = "SELECT user_id, first_name, user_level 
                    FROM the rest of my sql here, blah blah blah";

            $result = @mysql_query($query, $dbc) 
                OR trigger_error("Query: $query\n<br />MySQL Error: " . mysql_error($dbc));

            if (@mysql_num_rows($result) == 1) { //a match was made, OK to login

                //register the retrieved values into $_SESSION
                $_SESSION = mysql_fetch_array($result);
                mysql_free_result($result);
                mysql_close($dbc);
                /*              
                setcookie('access'); //if "remember me" not checked, session cookie, expires when browser closes
                                     //in FF you must close the tab before quitting/relaunching, otherwise cookie persists

                //"remember me" checked?
                if(isset($_POST['remember'])){ //expire in 1 hour (3600 = 60 seconds * 60 minutes)
                    setcookie('access', md5(uniqid(rand())), time()+60); //EXPIRES IN ONE MINUTE FOR TESTING
                }
                */

echo '<font color="red">cookie:</font> ' . print_r($_COOKIE) . '<br><br>';
echo '<font color="red">session id:</font> ' . session_id() . '<br>';
echo '<font color="red">session first name:</font> ' . $_SESSION['first_name'] . '<br>';
echo '<font color="red">session user id:</font> ' . $_SESSION['user_id'] . '<br>';
echo '<font color="red">session user level:</font> ' . $_SESSION['user_level'] . '<br><br>';

                ob_end_clean();
                session_write_close();

                $url = BASE_URL . 'loggedin_test2.php';
                header("Location: $url");
                exit();
            } else {
            //wrong username/password combo
            echo '<div id="errors"><span>Either the e-mail address or password entered is incorrect or you have not activated your account. Please try again.</span></div>';
            }

            //clear $_POST so the form isn't sticky
            $_POST = array();
        } else { 
        //report the errors
        echo '<div id="errors"><span>The following error(s) occurred:</span>';

            echo '<ul>';
            foreach($errors as $error) {
                echo "<li>$error</li>";
            }
            echo '</ul></div>';
        }

    } // end isset($_POST['login']) 
```

**如果我在登录页面上注释掉标头重定向，我可以使用数据库中的正确信息回显 $_SESSION 变量。但是，一旦重定向到登录页面，它们就会消失/取消设置。**

有人有想法么？我几乎一整天都在这上面，不能说我更接近于弄清楚它。

顺便说一句，我最近制作了 2 个简单的测试页面，一个启动了一个会话，在其上设置了一些变量，提交了一个表单，该表单重定向到了第二个页面，该页面除了读取/输出会话变量之外什么也没做。一切似乎都很好，我只是在我的主应用程序中遇到了一些问题。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-06T00:26:00.667

我`session_start()`在您的登录脚本中看不到 a 。如果您没有开始会话，我认为 php 不会保存您放置在`$_SESSION`数组中的任何数据。同样为了安全起见，我会明确地将变量放入`$_SESSION`数组中，而不是仅仅用`$_SESSION = mysql_fetch_array($result);`.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-06T00:16:12.933

尝试做一个

```
session_regenerate_id(true); 
```

之前

```
session_write_close(); 
```

还。IMO 执行登录脚本的最佳方法是：

让登录逻辑在用户尝试访问的主页中处理。

1.  如果用户未通过身份验证，他将被扔回登录页面
2.  如果用户通过身份验证，他会得到一个 $_SESSION["auth"] 或其他东西
3.  然后当用户浏览主页或其他需要认证的页面时，他们只需检查 $_SESSION["auth"] 是否设置。

那么你就不会在重定向之前遇到会话不保存的麻烦

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-07-03T19:17:19.847

...我可以添加其他答案吗，如果没有将 session_start() 放在脚本的最开始，它有时会失败或发生奇怪的事情。在您的标头脚本中，尝试：

代替

```
<?php
ob_start();
session_start(); 
```

放

```
<?php
session_start();
ob_start(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-11-05T19:00:52.997

当我发现这一点时，我遇到了类似的问题：

[http://www.w3schools.com/php/php_sessions.asp](http://www.w3schools.com/php/php_sessions.asp)

你必须把 session_start(); 在任何 html 标签之前

# log4net - 从 IronPython 调用 .NET 代码，加载 log4net 程序集时出错

> ID：415015
> 
> 赞同：0
> 
> 时间：2009-01-06T00:15:28.380
> 
> 标签：log4net, ironpython, dynamic-language-runtime

我有一个配置 log4net 的 IronPython 脚本，然后调用使用 log4net 的 .NET 代码。log4net 已正确配置，因为我记录了一条消息以指示它已初始化。但是当我尝试使用我的 .NET 类时，它会报告“无法加载文件或程序集 'log4net, ...'。

一些有用的事实：

*   log4net 未安装到 GAC
*   .NET 类是正确的，我从其他 .NET 代码中调用了它
*   在 IPY 中加载的 log4net 程序集与我的 .NET 程序集位于同一文件夹中。
*   filemon 显示所有 log4net.dll 访问都已从预期位置成功解析
*   fuslogvw 不报告任何绑定错误
*   我正在使用 AddReferenceToFileAndPath( ) 添加 log4net 引用和 .NET 程序集引用

奇怪的是 log4net 程序集已经被加载了。它必须在另一个 AppDomain 中加载 .NET 程序集。如果这就是它的工作原理，那么了解它会很有帮助。

有什么想法吗？谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-06T16:02:40.870

我能够通过使用绝对引用路径而不是相对路径来解决问题。

# javascript - 在 JavaScript 中双向浮动列

> ID：415018
> 
> 赞同：3
> 
> 时间：2009-01-06T00:16:14.587
> 
> 标签：javascript, css

我正在尝试使用 CSS 浮动列，以便它们像在此博客上一样均匀堆叠：http: [//typeneu.com](http://typeneu.com)

使用 CSS 似乎是不可能的，所以我正在研究 JavaScript。

上面列出的网站使用这个 JavaScript 文件：[http ://typeneu.com/wp-content/themes/grid-a-licious/scripts/grid-a-licious.js](http://typeneu.com/wp-content/themes/grid-a-licious/scripts/grid-a-licious.js)

我试图实现它来进行实验，但它似乎不起作用。

关于这个主题的教程的链接或让它与 JavaScript 或 CSS 一起工作的建议？

编辑：我希望列数与屏幕分辨率灵活。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-06T02:21:04.587

把事情简单化。这应该是一个不错的页面...... css 应该包括以下内容：

```
.header,.bod,.footer { width: 700px; margin: 0 auto; }
.header { border-bottom: 3px solid #CCC; margin-bottom: 1.0em; }
.footer { border-top: 3px solid #CCC; padding-top: 1.0em; }
.first, .second, .third, .fourth { position: absolute; top: 0; left: 0;}

.first    { width: 100px; left:10px;}
.second   { width: 100px; left:110px;}
.third    { width: 100px; left:220px;}
.fourth   { width: 100px; left:330px;}

.clear,.tall { position: relative; } /*\*/* html .clear{ display: inline;}
.tall:after { content: ''; } /*fix of safari bug?*/ 
```

和一些 html（在你调用 css 之后，在正文中）：

```
<body>
    <div class="header">TITLE</div>
    <div class="bod clear">
        <div class="first tall"> Lorem ipsum </div> 
        <div class="second"> Lorem ipsum </div> 
        <div class="third"> Lorem ipsum </div> 
        <div class="fourth"> Lorem ipsum </div>
    </div>
    <div class="footer" >FOOTER</div>
</body>
</html> 
```

简单，有效，对吧？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-06T00:21:57.260

该 JavaScript 文件实际上是该插件的一部分：

[http://suprb.com/apps/gridalicious/](http://suprb.com/apps/gridalicious/)

然而，在 CSS 中做到这一点并不难。你只需要使用花车。

例如：

```
<div style="float:left">Hello</div>
<div style="float:left">I'm also saying hello</div>
<div style="clear:both;"></div>
<div style="float:left">Hi again</div>
<div style="float:left">From the second line, that too!</div>
<div style="clear:both;"></div> 
```

够清楚吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-06T00:39:34.090

我有一个网站，它基本上有一个设置像素宽度的 DIV 浮动。根据分辨率和窗口大小，我可能有 1-n 列，您应该能够基本上：

```
<style>
.myClass
{
float:left;
width:350px;
}
</style>

<div class="myClass>my content</div>
<div class="myClass>more  content</div>
<div class="myClass>even more content</div> 
```

要获得固定数量的列，我假设您可以使用 javascript 计算宽度，或者可能还有其他技巧。

# 编辑

好的，看看他们的 JS 文件，你需要确保你匹配你的类和 id 以匹配他们所期望的看起来你所有的帖子都需要在一个 div 中，id 为 allposts。

查看您键入的站点的 HTML 您引用的站点并让您的 html 与他们的匹配。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-10-19T10:22:11.373

在页面上放置第一个组件后，获取该组件的尺寸，然后使用绝对放置将下一个组件一个接一个地放置在 UI 上。

# python - cherrypy 可以开箱即用地接收多部分/混合 POST 吗？

> ID：415019
> 
> 赞同：6
> 
> 时间：2009-01-06T00:16:30.127
> 
> 标签：python, cherrypy

我们从只为我们提供多部分/混合编码的设备接收一些 xml + 任意二进制文件（如图像和音频）的 POST 数据。

我已经为我们的接收端设置了一个cherrypy 上传/POST 处理程序。我已经设法允许它使用 multipart/form-data 执行任意数量的参数。但是，当我们尝试发送多部分混合数据时，我们没有得到任何处理。

```
@cherrypy.expose
def upload(self, *args,**kwargs):
    """upload adapted from cherrypy tutorials

    We use our variation of cgi.FieldStorage to parse the MIME
    encoded HTML form data containing the file."""

    print args   
    print kwargs

    cherrypy.response.timeout = 1300

    lcHDRS = {}
    for key, val in cherrypy.request.headers.iteritems():
        lcHDRS[key.lower()] = val
    incomingBytes = int(lcHDRS['content-length'])

    print cherrypy.request.rfile 

    #etc..etc... 
```

因此，在提交 multipart/form-data 时，args 和 kwargs 定义明确。
args 是表单字段，kwargs=vars 和值的散列。当我提交 multipart/mixed 时，args 和 kwargs 是空的，我只有 cherrypy.request.rfile 作为原始 POST 信息。

我的问题是，cherrypy 是否有内置处理程序来处理 POST 的多部分/混合和分块编码？还是我需要覆盖cherrypy.tools.process_request_body 并推出我自己的解码器？

似乎带有cherrypy的内置wsgi服务器将其作为HTTP / 1.1规范的一部分处理，但我似乎无法在cherrypy中找到访问此功能的文档。

* * *

...澄清

我正在使用 Cherrypy 的最新版本 3.1.1 左右。

制作默认表单只涉及在上传函数中制作参数。

对于多部分/表单数据，我一直在调用 curl -F param1=@file1.jpg -F param2=sometext -F param3=@file3.wav [http://destination:port/upload](http://destination:port/upload)

在那个例子中，我得到：

```
args = ['param1','param2','param3] 
kwargs = {'param1':CString<>, 'param2': 'sometext', 'param3':CString<>} 
```

在尝试提交多部分/混合时，我尝试查看 request.body，但无论设置正文处理如何，都继续获得 None 。

我们得到的输入是这样的：

```
user-agent:UNTRUSTED/1.0 Profile/MIDP-2.0 Configuration/CLDC-1.1
content-language:en-US
content-length:565719
mime-version:1.0
content-type:multipart/mixed; boundary='newdivider'
host:192.168.1.1:8180
transfer-encoding:chunked

--newdivider
Content-type: text/xml

<?xml version='1.0' ?><data><Stuff>....
etc...etc...

--newdivider
Content-type: image/jpeg
Content-ID: file://localhost/root1/photos/Garden.jpg
Content-transfer-encoding: binary

<binary data> 
```

我偷偷怀疑多部分/混合是cherrypy只给我rfile的问题。我们的目标是让cherrypy 将主体处理成各个部分，而在接收端进行最少的处理（即，让cherrypy 发挥它的魔力）。如果这要求我们在发送格式上更加严格，以成为cherrypy 喜欢的内容类型，那就这样吧。可接受的格式是什么？它只是多部分/表单数据吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-08T01:55:49.673

我的错。每当 Content-Type 的类型是“multipart/*”时，CP 就会尝试将内容粘贴到 request.params（如果有任何其他 Content-Type，它会进入 request.body）。

不幸的是，CP 假定任何多部分消息都是表单数据，并且没有为其他子类型做准备。我刚刚在主干中修复了这个问题，它应该在 3.1.2 中发布。带来不便敬请谅解。短期内，您可以尝试在本地应用变更集；见[http://www.cherrypy.org/ticket/890](http://www.cherrypy.org/ticket/890)。

# c# - 变更跟踪结构

> ID：415020
> 
> 赞同：0
> 
> 时间：2009-01-06T00:16:48.207
> 
> 标签：c#, .net, wpf, wcf, concurrency

我们希望在 WCF/WPF 应用程序中实现乐观锁定。到目前为止，我想出的最好的方法是实现一个通用的 Optimistic，它将存储原始副本和任何更改的副本（因此它将存储两个副本：原始副本和修改后的任何值对象）修改的。这是最好的方法吗？

例如：一个 UserVO 将被泛型包装为一个 Optimistic。当对 Optimistic 进行更改时，将对存储在 Optimistic 中的修改后的副本进行更改，而同时存储在 Optimistic 中的原始副本将保持不变。主要问题似乎是它会占用两倍的空间和带宽。

谢谢

**编辑**该解决方案需要独立于数据库，并且能够为每个值对象指定冲突解决策略会很有用。（例如，如果更新的行没有更改，用户对象可能会尝试合并，但事务对象总是需要用户干预）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-06T00:29:03.953

如果您使用的是 SQL 服务器，则可以使用时间戳列。任何时候修改行都会更改时间戳列。本质上，当您更新数据库时，您可以检查时间戳列是否与客户端首次获取数据时相同，如果是，则没有人修改数据。

# 编辑

如果您想最小化带宽，您可以通过在每个对象上添加版本号来模拟时间戳概念。例如：

1.  客户端 1 请求对象，服务器返回对象 V1
2.  客户端 2 请求对象，服务器返回 Object v2
3.  客户端 1 修改对象将其作为 V1 发送回服务器
4.  服务器比较版本并查看 v1=v1 所以它提交更改
5.  服务器增加对象的版本，所以现在它的 v2
6.  客户端 2 修改对象将其作为 v1 发送回服务器
7.  服务器比较版本并查看 v1!=v2 因此它执行您的任何策略

为了配置您的策略，您可以在配置中定义一个特定对象，该对象将根据根对象的类型处理策略故障。您可以启动一个 IOptomisticCheckFailurePolicy 接口，并且您可以在需要时使用结构映射等 DI 库之一来创建对象（尽管您可以使用反射轻松加载它）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-06T00:40:43.867

实现乐观锁定逻辑的一种方法是基于行的最后修改时间戳。因此更新将如下所示：

更新 .... id = x AND last_updated = t

x：记录ID。t：从数据库加载行时（即修改前）的最后更新时间戳。

请注意，必须直接或间接更新的字段之一是将时间戳设置为 now（或 UtcNow）。

这样，如果记录在后台被修改，更新将失败。一旦更新失败，您可以发出进一步的查询来检测失败的原因。例如，

1.  记录已被删除。
2.  记录已被修改。

这种简单的方法提供了行级乐观锁定，它不是基于列的，也没有冲突解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-06T06:04:07.413

你看过[微软同步框架](http://msdn.microsoft.com/en-us/sync/default.aspx "微软同步框架")吗？

# driver - 重新启动视频驱动程序（以编程方式）

> ID：415022
> 
> 赞同：3
> 
> 时间：2009-01-06T00:16:56.413
> 
> 标签：driver, windows-vista

我的系统某处有一个奇怪的错误，导致屏幕在发生时移动得非常快（我无法真正描述它），我学会了通过让笔记本电脑进入睡眠状态然后将其唤醒来处理它..

我怀疑它与显示驱动程序有关，如果重新启动驱动程序，它就会得到修复。

有没有办法以编程方式重新启动显示驱动程序？

我注意到有时在 vista 中屏幕空白 2 秒钟，并且托盘中出现一个气球提示，说显示驱动程序由于某些事情而不得不重新启动。
所以我认为必须有一种方法可以在代码中重新启动它。

我想做的是编写一个命令行工具来重新启动显示驱动程序，以便我可以在需要时使用键盘组合启动它。

[**更新**（30/1/2009）我尝试按照建议重新启动航空服务，但它没有解决问题。]

似乎显示驱动程序“服务”的名称是`igfx`，但是，我无法从命令行停止它

```
C:\>net stop igfx
The requested pause, continue, or stop is not valid for this service.

More help is available by typing NET HELPMSG 2191.

C:\>NET HELPMSG 2191

The requested pause, continue, or stop is not valid for this service. 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-06T01:26:42.683

您可以尝试两件事，这将重新启动视频堆栈的各个部分。

使用以下命令重新启动 DWM（航空/玻璃）：

```
net stop uxsms
net start uxsms 
```

[使用setres.exe](http://www.softpedia.com/get/Multimedia/Video/Other-VIDEO-Tools/SetRes.shtml)等实用程序更改分辨率

# emacs - 必须有 Emacs 扩展？

> ID：415035
> 
> 赞同：5
> 
> 时间：2009-01-06T00:26:06.423
> 
> 标签：emacs, emacspeak

我正在尝试[http://emacspeak.sourceforge.net](http://emacspeak.sourceforge.net)，因为我已经在 Windows 上运行了它。我想使用 emacs 而不是纯文本编辑器，并且想知道每个人都离不开哪些扩展/包？我使用最多的语言是 Perl、Java 和一些 C/C++。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-06T00:37:27.620

[EMACS Starter Kit](http://technomancy.us/119)中有一个非常棒的初始设置。如果您喜欢使用纯文本，请查看[Org-Mode](http://orgmode.org/)。无论如何，探索[EMACS Wiki](http://emacswiki.org/)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-06T00:47:43.463

我喜欢[颜色主题](http://www.emacswiki.org/emacs/ColorTheme)，当然还有我使用的语言的模式。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-06T04:15:27.833

我喜欢能够让我的编辑器完全按照我的意愿行事。因此，我编写了一堆软件包来将事情调整到离他们生命不远的地方。我将在帖子底部列出一些。没有我将无法生活的标准套餐包括：

*   牛羚
*   tnt - AOL IM 客户端（我帮助维护）
*   胡言乱语
*   git-emacs
*   骆驼香烟盒
*   swbuff（和我的 swbuff-advice 扩展）
*   指示

以下是我写的一些我永远无法没有的东西（这就是我写它们的原因）：

*   whole-line-or-region - 未定义区域时剪切并粘贴整行
*   cua-lite - 轻量级 CUA 包
*   dired-single - 将 dired 限制为一个可重用的缓冲区
*   流浪汉 - 流浪汉替代品，还没有准备好迎接黄金时段

此外，正如查理提到的，只要你感到无聊，就仔细阅读 EmacsWiki。你总能找到新的尝试。我阅读了 gnu.emacs.sources 以了解人们必须提供的最新和最棒的内容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-06T14:41:43.560

我过大的 .emacs 文件中的一些位：

```
(setq inhibit-startup-message t)

;; window maximized
(when (fboundp 'w32-send-sys-command)
 (w32-send-sys-command #xf030))

;; http://www.emacswiki.org/cgi-bin/wiki/DiredPlus
(load "dired+")
(load "w32-browser") ;; open file on current line (etc.)

;; dired stuff to open files a la Windows from Howard Melman
(defun dired-execute-file (&optional arg)
  (interactive "P")
  (mapcar #'(lambda (file)
      (w32-shell-execute "open" (convert-standard-filename file)))
          (dired-get-marked-files nil arg)))

(defun dired-mouse-execute-file (event)
  "In dired, execute the file or goto directory name you click on."
  (interactive "e")
  (set-buffer (window-buffer (posn-window (event-end event))))
  (goto-char (posn-point (event-end event)))
  (if (file-directory-p (dired-get-filename))
      (dired-find-file)
    (dired-execute-file)))
(global-set-key [?\C-x mouse-2] 'dired-mouse-execute-file)

;; push current-line onto kill-ring
;; http://www.dotemacs.de/dotfiles/SteveMolitor.emacs.html
(defun push-line ()
  "Select current line, push onto kill ring."
  (interactive)
  (save-excursion
    (copy-region-as-kill (re-search-backward "^") (re-search-forward "$"))))
(global-set-key "\C-cp" 'push-line)

;; default groups for ibuffer
;; http://www.shellarchive.co.uk/content/emacs_tips.html#sec17
(setq ibuffer-saved-filter-groups
      (quote (("default"
               ("dired" (mode . dired-mode))
               ("perl" (mode . cperl-mode))
               ("java" (mode . java-mode))
               ("planner" (or
                           (name . "^\\*Calendar\\*$")
                           (name . "diary")))
               ("emacs" (or
             (mode . help-mode)
             (mode . occur-mode)
             (mode . Info-mode)
             (mode . bookmark-bmenu-mode)
             (name . "^\\*Apropos\\*$")
             (name . "^.emacs$")
             (name . "el$")
                         (name . "^\\*scratch\\*$")
                         (name . "^\\*Messages\\*$")
             (name . "^\\*Completions\\*$")))
           ("vb" (or
              (mode . visual-basic-mode)
              (mode . vb-project)))
           ("BugTracker" (name . ".*btnet.*"))
               ("gnus" (or
                        (mode . message-mode)
                        (mode . bbdb-mode)
                        (mode . mail-mode)
                        (mode . gnus-group-mode)
                        (mode . gnus-summary-mode)
                        (mode . gnus-article-mode)
                        (name . "^\\.bbdb$")
                        (name . "^\\.newsrc-dribble")))))))

;; ibuffer, I like my buffers to be grouped
(add-hook 'ibuffer-mode-hook
          (lambda ()
            (ibuffer-switch-to-saved-filter-groups
             "default")))

;; http://www.emacswiki.org/cgi-bin/wiki/CPerlMode
;; http://www.khngai.com/emacs/perl.php
;; Use cperl-mode instead of the default perl-mode
(add-to-list 'auto-mode-alist '("\\.\\([pP][Llm]\\|al\\)\\'" . cperl-mode))
(add-to-list 'interpreter-mode-alist '("perl" . cperl-mode))
(add-to-list 'interpreter-mode-alist '("perl5" . cperl-mode))
(add-to-list 'interpreter-mode-alist '("miniperl" . cperl-mode))

;; daily-tip (or whenever Emacs is launched)
;; http://emacs.wordpress.com/2007/06/21/tip-of-the-day/
(defun totd ()
  (interactive)
  (random t) ;; seed with time-of-day
  (with-output-to-temp-buffer "*Tip of the day*"
    (let* ((commands (loop for s being the symbols
                           when (commandp s) collect s))
           (command (nth (random (length commands)) commands)))
      (princ
       (concat "Your tip for the day is:\n"
               "========================\n\n"
               (describe-function command)
               "\n\nInvoke with:\n\n"
               (with-temp-buffer
                 (where-is command t)
                 (buffer-string)))))))

;; swap slashes and backslashes in current line -- useful for converting paths to be Windows-readable
;;http://www.xsteve.at/prg/emacs/.emacs.txt
(defun xsteve-exchange-slash-and-backslash ()
  "Exchanges / with \ and in the current line or in the region when a region-mark is active."
  (interactive)
  (save-match-data
    (save-excursion
      (let ((replace-count 0)
            (eol-pos (if mark-active (region-end) (progn (end-of-line) (point))))
            (bol-pos (if mark-active (region-beginning) (progn (beginning-of-line) (point)))))
        (goto-char bol-pos)
        (while (re-search-forward "/\\|\\\\" eol-pos t)
          (setq replace-count (+ replace-count 1))
          (cond ((string-equal (match-string 0) "/") (replace-match "\\\\" nil nil))
                ((string-equal (match-string 0) "\\") (replace-match "/" nil nil)))
          (message (format "%d changes made." replace-count)))))))

(global-set-key (kbd "M-\\") 'xsteve-exchange-slash-and-backslash) 
```

查看：[dotfiles.org/.emacs](http://dotfiles.org/.emacs)

[EmacsWiki：类别 DotEmacs](http://www.emacswiki.org/cgi-bin/wiki?CategoryDotEmacs)

[SO：你的 .emacs 中有什么？](https://stackoverflow.com/questions/154097/whats-in-your-emacs)

上面没有提到的其他一些包： [Elscreen](http://www.morishima.net/~naoto/software/elscreen/) - [W3m](http://www.emacswiki.org/cgi-bin/wiki/emacs-w3m)（emacs-friendly text-based browser）

# c# - 如何将元数据与 DeepZoom 子图像相关联？

> ID：415036
> 
> 赞同：0
> 
> 时间：2009-01-06T00:26:28.640
> 
> 标签：c#, silverlight, deepzoom

我正在尝试根据与每个图像关联的任意数据对一组 DeepZoom 子图像进行排序。子图像通过 DeepZoom Composer 生成的 XML 文件自动加载。我没有看到将任意数据与 DeepZoom 子图像相关联的明确方法。

对我来说似乎最明显的解决方案很脆弱，而且不能很好地扩展。理想情况下，我想将相关数据放在生成的 XML 文件中，但在下一组生成的图像中我会丢失该信息。

是否有完善的方法来实现这一目标？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-20T07:29:01.630

正如您所注意到的，DeepZoomComposer 支持`<Tag></Tag>`您可以在 Silverlight MultiScaleImage 控件中使用的元素（[按标签过滤示例](http://blog.kirupa.com/?p=212)）。

当您在 DeepZoomComposer 中编辑并重新生成时，您将“丢失”添加到 XML 文件中的任何信息也是正确的（但是，如果您在 DeepZoomComposer 中键入，您不会丢失它）。

为了解决这个问题，我编写了一个名为[TagUpdater](http://deepzoompublisher.com/TagUpdater/)的小控制台应用程序——它基本上是这样[工作的](http://deepzoompublisher.com/TagUpdater/howto.aspx)：

1.  您将元数据放入图像中：JPG 文件格式支持许多不同的字段，但现在让我们使用标题、关键字（标签）、描述和评级

2.  您将图像添加到 Microsoft 的 DeepZoomComposer（不必费心布置它们，因为您可能想要动态地对它们进行排序；并且不必费心输入任何元数据）并正常**导出**

3.  通过控制台调用`TagUpdater.exe Metadata.xml`（DeepZoomComposer 将生成 Metadata.xml 文件）。

TagUpdater*直接从您的图像*和更新中提取元数据`Metadata.xml`（见下文）。它对现有`<Tag>`数据具有破坏性，但除此之外，该文件可以像以前一样用于为 MultiScaleImage 控件中的 DeepZoom 集合提供元数据信息。

```
<Image>
<FileName>C:\Documents and Settings\xxxxxx\My Documents\Expression\Deep Zoom Composer Projects\Bhutan\source images\page01.jpg</FileName> 
<x>0</x> 
<y>0</y> 
<Width>0.241254523522316</Width> 
<Height>0.27256162721473</Height> 
<ZOrder>1</ZOrder> 
<Tag>Bhutan,Mask</Tag> 
<Description>Land of the Thunder Dragon</Description> 
<Title>Bhutan 2008</Title> 
<Rating>3</Rating> 
</Image> 
```

您可以继续添加图像/重新生成，因为元数据*来自*图像（不是 DeepZoomComposer 标签框）。

这是[一个示例](http://deepzoompublisher.com/ClientBin/DeepZoomMetadataTestPageRC0.html)- 请注意，当您将鼠标悬停在每个图像上时，右侧的标签和描述如何更新，以及基于单击标签过滤的可见图像。

可以修改 [Kirupa 的源代码以使用这些额外的数据...](http://blog.kirupa.com/?p=212)

```
string tagString = g.Element("Tag").Value;
// get new elements as well
string descriptionString = g.Element("Description").Value;
string titleString = g.Element("Title").Value; 
string ratingString = g.Element("Rating").Value; 
```

希望这会引起一些兴趣 - TagUpdater 本身并不是完成此任务的唯一方法。这非常简单：它只是打开 Metadata.XML 文件，循环遍历`<Image>`元素以打开`<FileName>`，提取元数据，添加额外的 XML 元素并保存 XML。使用文件名作为“键”，您可以从数据库中获取附加信息（例如价格或更多描述数据），并根据需要扩展 XML 文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-24T21:56:19.693

Metadata.xml 有一个可以与每个图像关联的 Tag 属性。欢呼！

# gcc - 什么是 gcc 序列号？

> ID：415063
> 
> 赞同：1
> 
> 时间：2009-01-06T00:46:11.593
> 
> 标签：gcc

我正在编译一些基准，它说我可以尝试选项 gcc-serial 而不仅仅是 gcc，谁能解释一下 gcc 和 gcc serial 之间的区别？

出现的地方在[这里](http://parsec.cs.princeton.edu/download/tutorial/parsec-tutorial.pdf)，例如在幻灯片 71 中提到。在更多地方提到它，但没有一个说什么是 gcc-serial。

谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-06T23:04:26.900

这些幻灯片引用了斯坦福大学 (PARSEC) 的一个工具，该工具旨在对多线程共享内存程序（也称为并行程序）进行基准测试。在许多情况下，“串行”与“并行”相反：

```
$ cat config/gcc-serial.bldconf
#!/bin/bash
#
# gcc-serial.bldconf - file containing global information necessary to build
#                      the serial versions of the PARSEC programs with gcc
#
# Copyright (C) 2006, 2007 Christian Bienia

# Global configuration is identical to multi-threaded version
source ${PARSECDIR}/config/gcc.bldconf 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T01:05:25.987

没听说过`gcc-serial`，用`gcc`了好久。您能否更准确地说明您的基准测试告诉您什么？也许您的意思是“ ”（前后`gcc -serial`有一个空格）？即使在那种情况下，我仍然不知道，因为我在我的手册中找不到任何选项。`gcc``-serial``-serial``gcc`

`gcc`我正在使用的一个版本具有`-mserialize-volatile`and`-mno-serialize-volatile`选项，它们分别启用和禁用代码生成，以确保[易失性内存访问](http://en.wikipedia.org/wiki/Volatile_variable)的顺序一致性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-06T01:43:04.477

从幻灯片上看，它似乎是基准测试工具的配置名称，而不是您应该使用的命令。这可能意味着在使用该工具时使用 gcc 的一些特殊方式。

# html - CSS 溢出 Firefox 问题

> ID：415065
> 
> 赞同：1
> 
> 时间：2009-01-06T00:47:08.003
> 
> 标签：html, css, firefox, overflow

我正在尝试编写一个 CSS，当用户在其中编写文本并且它溢出而不是滚动条或隐藏时，它就像在普通的 Word 文档中一样下降。我有这个代码：

```
#content-text {
    width: 960px;
    padding-left: 10px;
    padding-right:10px;
    text-align: left;
    color:#000;
    height:100%;
    margin-left: 25px;
    margin-right:25px;
} 
```

奇怪的是，虽然这段代码实际上在 Firefox 的 IE 中执行了我想要的操作，但它会溢出并变成滚动条。我试过溢出：自动；溢出：隐藏；和溢出：继承；只是想看看是否有任何帮助，但到目前为止没有运气，老实说，我不知道为什么在 Firefox 中会发生这种情况，=/你们中的任何人都知道吗？

* * *

更新：我试过溢出：可见；但我只是得到了溢出......很明显，但它仍然没有包装。到目前为止，仅在 Firefox 中。=/

* * *

更新：可能影响的唯一另一件事是我有另一个 CSS 代码，第一个包含：

```
#content-title{
    background-color: transparent;
    background-image: url(../img/content-title-body.png);
    background-repeat: repeat-y;
    background-attachment: scroll;
    background-x-position: 0%;
    background-y-position: 0%;
    height:auto;
    position:absolute;
    z-index :100; /* ensure the content-title is on top of navigation area */
    width:1026px;/*1050px*/
    margin: 160px 100px 5px 100px;
    overflow: visible;
    top: 55px;
} 
```

使用它的 HTML 是：

```
<div id="content-title">
                <div id="content-text">             Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!Hola!<p>Hola!Hola!Hola!Hola!Hola!Hola!<p>Hola!Hola!Hola!Hola!<p>Hola!Hola!Hola!Hola!<p>Hola!Hola!Hola!<p>Hola!Hola!Hola!Hola!<p>Hola!Hola! 
        </div>
</div> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-06T00:51:38.200

试试：[`overflow: visible`](http://www.w3.org/TR/CSS2/visufx.html#propdef-overflow)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-06T01:18:43.667

所以你的css可能没问题。例如在我的页面上，我的 css 是这样的：

```
 textarea.input_field2 {
    margin: 10px 10px 10px 0px;
    width: 440px;
    height: 150px;
    background:#696969; 
    color: white;
    border: none;
    font-size: 14px;
    text-align: left;
    vertical-align: middle;
    } 
```

然后在体内我这样称呼它：

```
 <textarea rows="9" cols="9" class="input_field2" name="user_comments"></textarea> 
```

它工作正常。但是请确保在测试时使用 Lorem Ipsum 之类的东西来测试它，使用带空格的单词而不是像 'aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa' 这样的长字符串，因为这可能会强制滚动条。还要检查您的 html 和 css 以进行[验证](http://validator.w3.org/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-06T01:15:10.053

这个故事一定比你在这里展示的要多。我使用了提供的 CSS，并且在 Internet Explorer 和 Firefox 中都看到了相同的行为。页面呈现 960 像素宽，当浏览器宽度小于此宽度时，将呈现水平滚动条。

如果您在元素上指定宽度，浏览器不会将其呈现小于此值。如果您从示例中删除宽度声明，则元素将仅呈现所需的宽度。

如果这不是您正在寻找的答案，请提供更多代码以向我们提供全貌。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-11-24T11:54:06.867

添加`word-wrap: break-word;`到您的`#content-text`

# php - 管理 PHP 和 MySQL 之间的日期格式差异

> ID：415092
> 
> 赞同：6
> 
> 时间：2009-01-06T01:04:18.097
> 
> 标签：php, sql, mysql, datetime

我正在编写我的第一个 PHP 应用程序，它必须直接处理日期，从而直接处理 PHP 和 MySQL 具有不同日期格式的事实。

我的问题是：管理这种差异的最优雅的方法是什么？

我有以下两个函数来管理使用 php 的差异：

```
function mysql_date($php_date)  {
    return date( 'Y-m-d H:i:s', $php_date );
}

function php_date($mysql_date) {
    $val = explode(" ",$mysql_date);
    $date = explode("-",$val[0]);
    $time = explode(":",$val[1]);
    return mktime($time[0],$time[1],$time[2],$date[1],$date[2],$date[0]);
} 
```

有没有更简单的方法可以直接在我的 SQL 查询中进行管理？

或者你能建议任何其他更优雅的方式来管理这个吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-06T02:38:44.940

自（大约）PHP 5.2 以来，PHP 有一个用于处理日期和时间的内置类/对象，称为[DateTime](http://us2.php.net/date_create)。在空虚的情况下，使用内置总是比自己处理杂乱的细节要好。

DateTime 构造函数（或 date_create 函数）接受 strToTime 可以理解的任何格式的日期。关于 strToTime，您只需要知道它是一种神奇的巫术，可以正确识别几乎任何字符串格式的日期。当我第一次遇到 strToTime 时，我的内部反应与现在相同（“那是胡说八道/似乎不可靠”）。它不是。它只是以一种你自己对日期脆弱的理解永远不会的方式起作用（如果你认为你理解日期，你就不会。相信我。）

因此，从 MySQL 中提取信息作为日期/时间字符串，并立即创建一个 PHP 日期对象。当/如果您再次需要日期作为字符串时，请使用 date_format 方法（带有一些[方便的常量）。](http://us2.php.net/manual/en/datetime.constants.php)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-06T01:25:20.720

您可以替换`php_date`为`strtotime`.

```
$php = strtotime($mysql); 
```

MySQL 的等价物是[`UNIX_TIMESTAMP`](http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html#function_unix-timestamp).

不过，如果您想在 SQL 中处理格式化，请尝试 MySQL 的[`DATE_FORMAT`](http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html#function_date-format).

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-06T01:13:13.397

将数据库中的所有内容存储在 UTC 的日期时间字段中。对于 PHP 操作，请使用[PEAR Date](http://pear.php.net/package/Date)库。我不是 PEAR 的大用户，但这个库非常棒，可以处理所有烦人的日期转换问题，您不应该花时间担心这些问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-06T01:24:03.220

我建议您将所有内容保留为 mysql 格式，直到您需要将其显示给用户，然后使用[strtotime()](http://www.php.net/strtotime)获取 unix 时间戳和[date()](http://www.php.net/date)对其进行格式化。

如果你加入一些匈牙利符号，那就更难出错了：

```
$ymdDateAdded = date('Y-m-d');
$timeDateAdded = strtotime($ymdDateAdded);
$userDateadded = date('j F Y', $timeDateAdded); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-06T12:37:28.523

我认为将 unix 时间戳存储在 DB 字段中会是一个更好的主意。当您需要将日期显示为人类语言时，您可以随时使用 php 的 date() 函数。对于其他所有内容，只需使用数字时间戳。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-06T02:14:41.480

您可以制作一个小的日期对象，它可以根据需要简单地转换日期

```
$Date_p = new MagicDate($php_date);
$Date_m = new MagicDate($mysql_date); 
```

`$Date_p`和只是表明您可以根据`$Date_m`需要为对象播种。当你想要一个 mysql 日期时，你会有类似的代码。实际上，这将是非常通用的东西，例如`$Date`.

```
$query = "UPDATE SET Date='".$Date_p->toMysql()."' "... 
```

当您需要相反时，反之亦然。您可以使用已经创建的功能。只需在构造方法中添加一个“嗅探器”，例如：

```
public function __construct($date)
{
    $phpdate = strtotime($date);
    if($phpdate) 
    {
        $this->phpdate = $phpdate;
        $this->mysqldate = $this->mysql_date($phpdate);
    }
    else
    {
        $this->phpdate = $this->php_date($phpdate);
        $this->mysqldate = $phpdate;
    }
} 
```

抛出一些错误处理来捕捉变坏的东西。添加两个日期的吸气剂。这是一个设置它并忘记它的情况。只需在需要时取出正确的日期即可。

可能会有一些优化，但这只是向您展示它是如何工作的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-06-26T11:58:31.023

将时间和日期保存为 unix 时间戳而不是其他格式的最佳方法。

我创建了一个类来处理 php 中的日期和时间。它易于使用且非常有用

```
<?php
define("NEW_LINE", "</BR>");
class scTimestamp
{
    private $timestamp;
    private $year;
    private $month;
    private $day;
    private $hour;
    private $minute;
    private $second;

    public function __construct() 
    {
        register_shutdown_function(array($this,'__destruct'));
        $this->setTimestamp($_SERVER['REQUEST_TIME']);
    }
    public function __destruct()
    {
        unset($this->timestamp);
        unset($this->year);
        unset($this->month);
        unset($this->day);
        unset($this->hour);
        unset($this->minute);
        unset($this->second);
    }
    private function rebuildTimestampFromDate()
    {
        $this->timestamp=mktime($this->hour,$this->minute,$this->second,$this->month,$this->day,$this->year);
    }
    private function rebuildDateFromTimestamp()
    {
        $this->day=date('j',$this->timestamp);
        $this->month=date('n',$this->timestamp);
        $this->year=date('Y',$this->timestamp);
        $this->hour=date('g',$this->timestamp);
        $this->minute=date('G',$this->timestamp);
        $this->second=date('s',$this->timestamp);       
    }
    public function setTimestamp($tempTimestamp)
    {
        $this->timestamp=$tempTimestamp;     
        $this->rebuildDateFromTimestamp();
    }
    public function getTimestamp()
    {
        return $this->timestamp;    
    }
    public function setYear($tempYear)
    {
        $this->year = $tempYear;
        $this->rebuildTimestampFromDate();
    }
    public function getYear()
    {
        return $this->year;
    }
    public function setMonth($tempMonth)
    {
        $this->month = $tempMonth;
        $this->rebuildTimestampFromDate();
    }
    public function getMonth()
    {
        return $this->month;
    }
    public function setDay($tempDay)
    {
        $this->day=$tempDay;
        $this->rebuildTimestampFromDate();
    }
    public function getDay()
    {
        return $this->day;
    }
    public function setHour($tempHour)
    {
        $this->hour = $tempHour;
        $this->rebuildTimestampFromDate();
    }
    public function getHour()
    {
        return $this->hour;
    }
    public function setMinute($tempMinute)
    {
        $this->minute = $tempMinute;
        $this->rebuildTimestampFromDate();
    }
    public function getMinute()
    {
        return $this->minute;
    }
    public function setSecond($tempSecond)
    {
        $this->second = $tempSecond;
        $this->rebuildTimestampFromDate();
    }
    public function getSecond()
    {
        return $this->second;
    }

    public function getDateDifferenceFromNow()
    {
        return $this->getDateDifferenceFrom($_SERVER['REQUEST_TIME']);
    }
    public function getDateDifferenceFrom($fromDate)
    {
        $return="";
        $sec=" Second";
        $min=" Minute";
        $hrs=" Hour";
        $before=" Before";
        $difference=$fromDate-$this->getTimestamp();
        if($difference<0)
            $return.="In the Future";
        else if($difference<60)
        {
            if($difference>1)
                $sec.="s";
            $return.= $difference.$sec.$before;
        }
        else if($difference<3600)
        {
            $difference=intval($difference/60);
            if($difference>1)
                $min.="s";
            $return.=$difference.$min.$before;
        }
        else if($difference<86400)
        {
            $difference=intval($difference/3600);
            if($difference>1)
                $hrs.="s";
            $return= $difference.$hrs.$before;
        }
        else if($difference<604800)
        {
            $return.= date("l g:i a",$this->getTimestamp());
        }
        else if($difference<28512000)
        {
            $return.= date("F j",$this->getTimestamp());
        }
        else
        {
            $return.= date("F j, Y, g:i a",$this->getTimestamp());
        }
        return $return;
    }
    public function getDateAsString()
    {
        return date("F j, Y",$this->getTimestamp());
    }
    public function getDateTimeAsString()
    {
        return date("F j, Y, g:i a",$this->getTimestamp());
    }

    public function __toString()
    {
        $return = NEW_LINE."^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^";
        $return.= NEW_LINE." ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^".NEW_LINE;
        $return.= NEW_LINE."@@ Timestamp: ".$this->getTimestamp()." @@".NEW_LINE;
        $return.= NEW_LINE."@@ Date: ".$this->getDateTimeAsString()." @@".NEW_LINE;
        $return.= NEW_LINE." ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^".NEW_LINE;
        return $return;
    }

}
?> 
```

一旦包含它，它就可以按如下方式使用

```
include_once("scTimestamp.php");
$test=new scTimestamp();

echo $test->getDateAsString();

$test->setTimestamp(1210203200);

echo $test->getDateDifferenceFromNow();

echo $test;

$test->setTimestamp(121020320022);
echo $test->getYear();

echo $test; 
```

结果会是这样。

**2015 年 6 月 26 日 2008 年 5 月 7 日晚上 11:33 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ ^^^^ @@ 时间戳：1210203200 @@ @@ 日期：2008 年 5 月 7 日晚上 11:33 @@ ^^^^^^^^^^^^^^^^^^^^^^^ ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ 5804 ^^ ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^@@时间戳：121020320022@@@@日期: 5804 年 12 月 25 日凌晨 3:33 @@ ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^**

这个类可以根据需要使用

# linux - 如何获得适用于 Linux 的远程桌面（XDMCP、VNC）

> ID：415094
> 
> 赞同：2
> 
> 时间：2009-01-06T01:04:41.353
> 
> 标签：linux, unix, desktop, x11

我一直使用 VNC 来做这件事，这很容易，但我对 XDMCP 之类的一些东西很好奇。据我了解，这是一种在远程 X-Server 上创建整个桌面的方法，看起来相当优雅。

几年前，我在 Solaris 服务器上工作，多个开发人员在 Windows 中运行 X-Server，我们能够访问完整的远程 X-desktop。到目前为止，我在基于 X 的系统中所做的所有努力似乎都表明只能加载桌面的一个远程或本地实例，所以我猜这个 Solaris 的东西是一个“模拟”桌面的实际应用程序，但谁知道.. ..

任何输入？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-06T01:37:39.883

在 Windows 中，我发现最好的方法是在 cygwin 中使用 Xwin 命令。

脚步：

安装[Cygwin](http://www.cygwin.com/)，确保安装 X11。（通过滚动到“选择包”屏幕上的列表底部并单击“X11”右侧的“默认”一词来执行此操作。给它一两秒钟，它将变为“安装”。）

然后，只需像这样运行 Xwin 命令：

Xwin -查询 your.unix.system.name

您将从您的 unix 框中获得一个全屏登录窗口。就是这样！

顺便说一句，有时防火墙会妨碍 XDMCP 的 UDP 协议。如果发生这种情况，请查找端口号（一个 UDP 传出，一个 TCP 传入）并取消阻止它们。其他 xdmcp 故障排除技巧[在这里](http://x.cygwin.com/docs/faq/cygwin-x-faq.html#xdmcp)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-06T03:48:01.197

[NX](http://www.nomachine.com/products.php)将允许您在本地使用完整的远程桌面环境，并且大多数 Linux 发行版已经提供了可用的服务器。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-07T05:38:15.407

作为完整 cygwin 安装的替代方案，您可能需要查看[Xming](http://sourceforge.net/projects/xming)。它更轻一些，应该提供相同的功能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2019-08-18T20:57:04.043

在 Xorg/GDM/LightDM 选项中：“ `listen`”应该被激活（默认禁用）

在 Windows 中，尝试[Xwin32](https://www.starnet.com/xwin32/)。

在 Linux 中，尝试**使用 Xnest**（窗口化）或带有“ ”命令的**X。**`-query`

请注意：速度很慢，并且所有内容（包括密码）都以明文形式传输。因此，将其保存在本地网络上，在 SSH 中进行隧道传输，或者最好不要使用它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-05-31T18:08:53.817

我发现了一个额外的远程桌面实现，它可以很好地与 LXDE 配合使用：

[x2go](http://www.x2go.org/)

拥有适用于 Windows、Linux 和 MacOS X 的客户端。

# php - 将表单数据从asp文件传递到php

> ID：415095
> 
> 赞同：0
> 
> 时间：2009-01-06T01:04:45.147
> 
> 标签：php, forms, asp-classic

我在 ASP 文件中有一个表单，我想将它传递给 php 脚本进行处理。这可能吗？我不明白为什么它不会，但我在一个 asp 文件上尝试了一个虚拟表单，带有 action="phptest.php" 并且在提交时只是重新加载表单页面。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-06T11:39:09.030

传递给 PHP 脚本的数据将来自 HTML 表单。*只要您的 ASP 脚本的输出是常规的 HTML 表单*，表单是用 ASP 脚本创建的就没有任何意义。

提交表单会重新加载页面，这表明表单的 HTML 不适合您的需求。

您正在处理一个中等复杂的场景，为了确定问题的原因，您需要将事情分解成更简单的组件并单独测试/检查这些组件。

让：

*   [A] = ASP 脚本
*   [B] = HTML 表单
*   [C] = PHP 脚本

据我了解的情况：

*   [A] 生成 [B]
*   [B] 向 [C] 发送数据

这表明了以下一般问题：

*   [A] 错误地生成 [B]（您的 ASP 输出错误的 HTML）
*   [C] 错误处理传入的表单数据（您的 PHP 脚本中的逻辑错误）

从您的最终目标（即通过 PHP 脚本正确处理数据）向后工作。检查沿途的每一步，并确保它确实符合您的需要。

1.  查看您的 PHP 代码。确保它现在看起来是正确的。记下 PHP 脚本的 URL。
2.  手动创建您的 HTML 表单。将表单的`action`属性设置为 PHP 脚本的 URL。该表单现在将向您的 PHP 脚本提交数据。测试 PHP 脚本是否在做它应该做的事情。在你得到这个工作之前，你不能继续。
3.  使您的 ASP 脚本输出与您手动创建的*完全相同的HTML。*

只要你能得到一个 HTML 表单提交数据到你的 PHP 脚本，只要你的 PHP 脚本正确处理传入的数据，你就可以继续，然后让 ASP 生成表单。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-06T01:32:17.400

您是否将*操作*放在*提交*标签或*表单*标签中？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-06T01:35:39.343

你可以在这里发布代码吗？

我想推荐 JSON 作为“标准”传递（[http://ar.php.net/json_decode](http://ar.php.net/json_decode)）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-06T02:01:21.273

首先，这是 ASP.Net 还是 Classic ASP？如果是 ASP.Net，则需要从表单标记中删除 runat=server。此外，您将需要使用 HTML 标签，而不是 ASP.Net 表单标签...例如：INPUT 而不是 ASP:TEXTBOX 等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-06T01:14:20.993

那肯定行得通。您确定表单按钮是 <input type="submit"> 吗？

您确定 phptest.php 在正确的目录中吗？

如果直接访问 phptest.php 的 URL 会发生什么？

你能至少用 <form> 标签和 <input> 标签的 HTML 来更新你的问题吗？

# visual-studio - 需要 Visual Studio 宏才能将横幅添加到所有 C# 文件

> ID：415101
> 
> 赞同：10
> 
> 时间：2009-01-06T01:08:17.433
> 
> 标签：visual-studio

有人可以发布一个遍历项目中所有 C# 源文件并添加文件横幅的 Visual Studio 宏吗？如果它适用于任何类型的源文件（.cs、.xaml 等），则额外加分。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-06T02:11:15.557

在这里，我为 .cs 和 .vb 提供了一个示例，但您应该不难将其调整为您的其他文件类型需求： ***编辑以递归地将标题添加到子文件夹***

```
Sub IterateFiles()
    Dim solution As Solution = DTE.Solution
    For Each prj As Project In solution.Projects
        IterateProjectFiles(prj.ProjectItems)
    Next
End Sub

Private Sub IterateProjectFiles(ByVal prjItms As ProjectItems)
    For Each file As ProjectItem In prjItms
        If file.SubProject IsNot Nothing Then
            AddHeaderToItem(file)
            IterateProjectFiles(file.ProjectItems)
        ElseIf file.ProjectItems IsNot Nothing AndAlso file.ProjectItems.Count > 0 Then
            AddHeaderToItem(file)
            IterateProjectFiles(file.ProjectItems)
        Else
            AddHeaderToItem(file)
        End If
    Next
End Sub

Private Sub AddHeaderToItem(ByVal file As ProjectItem)
    DTE.ExecuteCommand("View.SolutionExplorer")
    If file.Name.EndsWith(".cs") OrElse file.Name.EndsWith(".vb") Then
        file.Open()
        file.Document.Activate()

        AddHeader()

        file.Document.Save()
        file.Document.Close()
    End If
End Sub

Private Sub AddHeader()
    Dim cmtHeader As String = "{0} First Line"
    Dim cmtCopyright As String = "{0} Copyright 2008"
    Dim cmtFooter As String = "{0} Footer Line"

    Dim cmt As String

    Select Case DTE.ActiveDocument.Language
        Case "CSharp"
            cmt = "//"
        Case "Basic"
            cmt = "'"
    End Select
    DTE.UndoContext.Open("Header Comment")
    Dim ts As TextSelection = CType(DTE.ActiveDocument.Selection, TextSelection)
    ts.StartOfDocument()
    ts.Text = String.Format(cmtHeader, cmt)
    ts.NewLine()
    ts.Text = String.Format(cmtCopyright, cmt)
    ts.NewLine()
    ts.Text = String.Format(cmtFooter, cmt)
    ts.NewLine()
    DTE.UndoContext.Close()
End Sub 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-06T01:57:05.010

[用于添加文件头的 Visual Studio 宏](http://jamesewelch.com/2008/09/09/visual-studio-macro-to-add-file-headers/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-06T02:02:36.387

这是它的要点。不，我没有调试过这个，这是给读者的练习。而且，这是在我的脑海中完成的。（文件评论者除外……那是我使用的真正宏）。

```
function CommentAllFiles
    option explicit

    Dim ActiveProjectFullName
    Dim dte80 As EnvDTE80.Solution2

    ActiveProjectFullName = dte80.Projects.Item(0).FullName
    If ActiveProjectFullName = "" Then
        MsgBox("No project loaded!")
        Exit Sub
    End If

    Err.Number = 0
    doc.Open(ActiveProjectFullName, "Text", True)
    If Err.Number <> 0 Then
        MsgBox("Open " + ActiveProjectFullName + " failed: " & Hex(Err.Number))
        Exit Sub
    End If

    ActiveDocument.Goto(1, 1, vsMovementOptions.vsMovementOptionsMove)

    ' Build search string
    Dim SearchString
    Dim vsFindOptionsValue As Integer
    SearchString = "^SOURCE=.*" + dn + "$"

    while ActiveDocument.Selection.FindText(SearchString, vsFindOptions.vsFindOptionsFromStart + vsFindOptions.vsFindOptionsRegularExpression)
        Dim TheFile
        TheFile = ActiveDocument.Selection.Text
        TheFile = Mid(TheFile, 8)
        doc.Open(TheFile)
    wend
    ActiveDocument.Close()
end function 
```

久经考验的“花盒”加法器：

```
 Function IsClassDef()
    Dim ColNum
    Dim LineNum
    Dim sText

    sText = ActiveDocument.Selection.ToString()
    If sText = "" Then
        'ActiveDocument.Selection.WordRight(dsExtend)
        'sText = ActiveDocument.Selection
        'sText = ucase(trim(sText))
    End If

    If (sText = "CLASS") Then
        IsClassDef = True
    Else
        IsClassDef = False
    End If
End Function

Sub AddCommentBlock()
    'DESCRIPTION: Add Commecnt block to header, CPP files and Class Defs
    AddCPPFileDesc()
End Sub

Sub AddCPPFileDesc()
    'DESCRIPTION: Add File desc block to the top of a CPP file
    Dim selection As EnvDTE.TextSelection
    ActiveDocument.Selection.StartOfLine()

    Dim editPoint As EnvDTE.EditPoint
    selection = DTE.ActiveDocument.Selection()
    editPoint = selection.TopPoint.CreateEditPoint()

    Dim bOk, sExt, IsCpp, IsHdr, sHeader, IsCSharp
    bOk = True
    IsCpp = False
    IsCSharp = False

    If ActiveDocument.Selection.CurrentLine > 10 Then
        If MsgBox("You are not at the top of the file. Are you sure you want to continue?", vbYesNo + vbDefaultButton2) = vbNo Then
            bOk = False
        End If
    End If

    If (bOk) Then
        sExt = ucase(right(ActiveDocument.Name, 4))
        IsCpp = sExt = ".CPP"
        IsHdr = Right(sExt, 2) = ".H"
        IsCSharp = sExt = ".CS"

        If (IsCpp) Then
            sHeader = left(ActiveDocument.Name, len(ActiveDocument.Name) - 3) + "h"
            FileDescTopBlock(1)
            editPoint.Insert("#include " + Chr(34) + "StdAfx.h" + Chr(34) + vbLf)
            editPoint.Insert("#include " + Chr(34) + sHeader + Chr(34) + vbLf)
        ElseIf (IsCSharp) Then
            FileDescTopBlock(1)
        Else
            If IsHdr Then
                'If IsCLassDef() Then
                'AddClassDef()
                'Else
                AddHeaderFileDesc()
                'End If
            Else
                FileDescTopBlock(1)
            End If
        End If
    End If
End Sub

Sub AddHeaderFileDesc()
    FileDescTopBlock(0)
    Dim selection As EnvDTE.TextSelection
    ActiveDocument.Selection.StartOfLine()

    Dim editPoint As EnvDTE.EditPoint
    selection = DTE.ActiveDocument.Selection()
    editPoint = selection.TopPoint.CreateEditPoint()
    editPoint.Insert("#pragma once" + vbLf)
End Sub

Sub FileDescTopBlock(ByVal HasRevHistory)
    'DESCRIPTION: Add File desc block to the top of a CPP file
    Dim selection As EnvDTE.TextSelection

    ActiveDocument.Selection.StartOfLine()
    ActiveDocument.Selection.EndOfLine()
    Dim sComment
    sComment = ActiveDocument.Selection.ToString()
    If Left(sComment, 2) = "//" Then
        ActiveDocument.Selection.Delete()
        sComment = LTrim(Mid(sComment, 3))
    Else
        sComment = ""
    End If

    Dim sLineBreak
    Dim sFileName
    Dim sBlock
    sLineBreak = "////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////"
    sFileName = ActiveDocument.Name

    ActiveDocument.Selection.StartOfDocument()
    sBlock = sLineBreak & vbLf & _
            "//  File   : " & sFileName & vbLf & _
           "//  Author : Larry Frieson" & vbLf & _
          "//  Desc   : " & sComment & vbLf & _
         "//  Date   : " & CStr(Now.Date()) & vbLf & _
        "//" & vbLf & _
       "//  Copyright © 20" + Right(CStr(Now.Year.ToString()), 2) + " MLinks Technologies. All rights reserved" + vbLf
    If (HasRevHistory > 0) Then
        sBlock = sBlock & _
                "//" & vbLf & _
               "//  Revision History: " & vbLf & _
              "//    " & CStr(Now) & " created." & vbLf & _
             "// " & vbLf
    End If
    sBlock = sBlock + sLineBreak + vbLf

    Dim editPoint As EnvDTE.EditPoint
    selection = DTE.ActiveDocument.Selection()
    editPoint = selection.TopPoint.CreateEditPoint()
    editPoint.Insert(sBlock)

End Sub 
```

希望这会有所帮助，或者至少给你一些想法。同样，我没有测试/调试“源文件循环器”，我认为你可以处理。

拉里

# java - Java 的 TreeMap put() 方法的奇怪行为

> ID：415158
> 
> 赞同：2
> 
> 时间：2009-01-06T01:57:32.340
> 
> 标签：java, collections, vector, treemap

我有以下代码，它将向量拆分为字符串向量（用作键）和最后的整数（用作值）。

```
payoffs.put(new Vector<String>(keyAndOutput.subList(0, keyAndOutput.size() - 1)), Integer.parseInt(keyAndOutput.lastElement())); 
```

有问题的 TreeMap 是使用具有以下方法的 Comparator 构造的，该方法强制执行字典、大小写无关的排序，该排序也考虑了长度（较长的向量总是比较短的向量“更大”）。

```
public int compare(Vector<String> arg0, Vector<String> arg1) {
        int sgn = 0;
        if (arg0.size() > arg1.size()) {
            return 1;
        } else if (arg0.size() < arg1.size()) {
            return -1;
        }
        for (int i = 0; i < arg0.size(); i++) {
            if (arg0.elementAt(i).compareToIgnoreCase(arg1.elementAt(i)) == 1) {
                sgn = 1;
                break;
            } else if (arg0.elementAt(i).compareToIgnoreCase(arg1.elementAt(i)) == -1) {
                sgn = -1;
                break;
            } else {
                continue;
            }
        }
        return sgn;
    } 
```

现在，对于这个问题......尽管正在读取的文本文件中有 8 个条目，但地图最多只能获得 2 个条目。一旦输入了一个条目（键），它就会保留，但值会随着扫描过程的每次迭代而改变（每次它从文件中的一行读取一个新向量）。它会抛出除两个之外的所有其他键。

这是我的比较器的问题吗？或者 TreeMap 是否在用 put() 做一些我不理解的事情？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-06T02:06:02.073

回答~~不回答~~问题，除了关于您的代码之外，还有一些小问题~~：~~

1.  你不应该做 compareTo 两次；比较一次并将结果分配给sgn；如果 !=0 则中断
2.  你的 else continue 是多余的。
3.  您不应该比较 -1 或 1，而是 <0 或 >0；许多 compareTo 方法基于 (x1-x2) 返回，它可以给出任何负数或正数。

编辑：哇！而且，当然， String.compareToIgnoreCase() 的返回是那些 (3) 比较器之一。正如我在同一时间发布的另一个答案指出的那样，这可能是您错误的原因。

EDIT2：更正了开场白以反映问题实际上得到了回答。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-06T02:03:13.047

我不知道这是否是您的问题的原因，但 Java 中的比较函数通常返回负数或正数或 0，不一定是 1 或 -1。

我敢打赌，您会以某种方式从 compareToIgnoreCase 获得一个非零值，但是因为它不是 1 或 -1，所以即使数组长度相同且内容不同，最终也会返回 0。尝试检查 >0 和 <0

此外，您可以更好地组织此代码。例如，进行一次比较，保存结果，然后打开结果。这样一来，您可能会无所事事地进行两次昂贵的比较。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-06T02:12:53.743

实际上，诀窍可能确实是我误读了 compareTo() 实际所说的文档......一旦测试就会报告。

Aaand，就是这样。谢谢人们。

# javascript - 实例化 XMLHttpRequest 对象的最佳方法

> ID：415160
> 
> 赞同：7
> 
> 时间：2009-01-06T02:00:17.747
> 
> 标签：javascript, ajax, cross-browser, xmlhttprequest

创建[XMLHttpRequest](http://en.wikipedia.org/wiki/XMLHttpRequest)对象的最佳方法是什么？

它应该适用于所有有能力的浏览器。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-06T02:10:18.803

对于无库的解决方案，您可以`Try.these`很容易地模拟 Prototype 的使用：

```
function newAjax() {
    try { return new XMLHttpRequest();                    } catch(){}
    try { return new ActiveXObject('Msxml2.XMLHTTP.6.0'); } catch(){}
    try { return new ActiveXObject('Msxml2.XMLHTTP.3.0'); } catch(){}
    try { return new ActiveXObject('Msxml2.XMLHTTP');     } catch(){}
    try { return new ActiveXObject('Microsoft.XMLHTTP');  } catch(){}
    return false;
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-06T02:03:42.000

这是一个有用的链接和一些代码（应该涵盖所有基础）

[http://blogs.msdn.com/xmlteam/archive/2006/10/23/using-the-right-version-of-msxml-in-internet-explorer.aspx](http://blogs.msdn.com/xmlteam/archive/2006/10/23/using-the-right-version-of-msxml-in-internet-explorer.aspx)

```
 var request = null;

        function InitAJAX()
        {
            var objxml = null;
            var ProgID = ["Msxml2.XMLHTTP.6.0", "Msxml2.XMLHTTP.3.0", "Microsoft.XMLHTTP"];            

            try
            {
                objxml = new XMLHttpRequest();
            }
            catch(e)
            {                
                for (var i = 0; i < ProgID.length; i++)
                {
                    try
                    {
                        objxml = new ActiveXObject(ProgID[i]);
                    }
                    catch(e)
                    {                        
                        continue;
                    }
                }
            }

            return objxml;            
        }

        request = InitAJAX(); 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-06T02:03:09.897

使用[jQuery](http://jquery.com/)（或类似的 JavaScript 库）。它负责处理诸如进行 Ajax 调用之类的跨浏览器兼容性问题。

[例如](http://www.ibm.com/developerworks/library/x-ajaxjquery.html)，使用[jQuery Ajax 调用](http://docs.jquery.com/Ajax)：

```
$.ajax({
    url: 'document.xml',
    type: 'GET',
    dataType: 'xml',
    timeout: 1000,
    error: function(){
        alert('Error loading XML document');
    },
    success: function(xml){
        // do something with xml
    }
}); 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-01-06T11:33:59.557

我建议您遵循[Sergey 的建议](https://web.archive.org/web/20170503184005/http://code.google.com/p/xmlhttprequest/)，或者自己为 IE 编写一个不那么复杂的小补丁：

```
if(typeof window.XMLHttpRequest === 'undefined' &&
    typeof window.ActiveXObject === 'function') {
    window.XMLHttpRequest = function() {
        try { return new ActiveXObject('Msxml2.XMLHTTP.6.0'); } catch(e) {}
        try { return new ActiveXObject('Msxml2.XMLHTTP.3.0'); } catch(e) {}
        return new ActiveXObject('Microsoft.XMLHTTP');
    };
} 
```

然后你可以做

```
var req = new XMLHttpRequest; 
```

即使在 IE 中。

**编辑 2011-02-18：**查看[这篇博](http://blogs.msdn.com/b/xmlteam/archive/2006/10/23/using-the-right-version-of-msxml-in-internet-explorer.aspx)文，了解新选择 MSXML 版本背后的基本原理......

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-06T02:04:54.010

使用几乎任何 JavaScript [Ajax](http://en.wikipedia.org/wiki/Ajax_%28programming%29)库都比编写自己的 Ajax 框架更可取——除非这是重点。如果您坚持自己编写，您可能想查看 jQuery 或[Prototype](http://en.wikipedia.org/wiki/Prototype_JavaScript_Framework)或[MooTools](http://en.wikipedia.org/wiki/MooTools)或[Dojo或 [在此处插入名称] 框架，看看他们是如何做到的。](http://en.wikipedia.org/wiki/Dojo_Toolkit)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-06T02:17:38.680

这是我使用的，对我来说很好用：

```
 function request()
    {
        try
        {
            try
            {
                return new ActiveXObject("Microsoft.XMLHTTP")
            }
            catch( e )
            {
                return new ActiveXObject("Msxml2.XMLHTTP")
            }
        }
        catch(e) 
        {
            return new XMLHttpRequest()
        }
    } 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-06T10:25:05.250

使用[XMLHttpRequest.js - 符合标准的跨浏览器 XMLHttpRequest 对象实现](http://code.google.com/p/xmlhttprequest/)并以[标准 (W3C)](http://www.w3.org/TR/XMLHttpRequest/)方式使用对象

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-06T02:17:43.877

我同意 Cletus 对 jQuery 的建议，还查看了[jQuery Form](http://malsup.com/jquery/form/)插件，它非常强大且易于使用，可以快速将您的表单转换为通过 Ajax 工作。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-12-08T06:27:22.257

函数 CreateXmlHttpObj() {

```
try {
    XmlHttpObj = new ActiveXObject("Msxml2.XMLHTTP");
}
catch (e) {
    try {
        XmlHttpObj = new ActiveXObject("Microsoft.XMLHTTP");
    }
    catch (oc) {
        XmlHttpObj = null;
    }
}
// if unable to create using IE specific code then try creating for Mozilla (FireFox) 
if (!XmlHttpObj && typeof XMLHttpRequest != "undefined") {
    XmlHttpObj = new XMLHttpRequest();
} 
```

}

# javascript - ExtJS：窗口中选项卡中网格中的 AJAX 链接

> ID：415170
> 
> 赞同：0
> 
> 时间：2009-01-06T02:05:29.813
> 
> 标签：javascript, extjs

我正在使用 ExtJS 进行我的第一个项目。

我有一个位于窗口内的选项卡内的数据网格。

我想为网格的每个元素添加一个链接或按钮（我目前通过 RowExpander 使用带有 HTML 内容的扩展元素），这将进行 AJAX 调用并打开另一个选项卡。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-06T19:21:59.653

如果您希望将链接添加到网格本身，您可以在 ColumnModel 中指定另一列并将渲染器应用于该列。渲染器的作用是返回格式化的内容以应用于该单元格，可以根据列的dataIndex的值进行裁剪（你应该有一个dataIndex，即使它是另一个列的副本），以及该行的记录。

```
function myRenderer(value,meta,record,rowIndex,colIndex,store){
    // Do something here
} 
```

您的链接可能有一个点击事件来调用一个方法，打开另一个选项卡

```
function myClickEvent(value1, value2){
     var myTabs = Ext.getCmp('myTabPanel');
     myTabs.add(// code for new tab);
} 
```

如果您要在 RowExpander 中将链接添加到您的扩展区域，那么您必须将渲染写入您用于扩展内容区域的模板中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-21T04:16:51.430

我实际上最终解决了这个问题。相当令人费解，如果我能提供帮助的话，我就不会再让自己参与 ExtJS 了。

我正在使用 Grid.RowExpander 使用 XTemplate 将 HTML 放置在 Grid 中。因此，我的链接相当简单：

```
<a href="#" class="add_cart_btn" id="{product_id}" onclick="return false;">Add to Cart</a> 
```

其中 {product_id} 来自从 Ajax 查询加载的 JSON 数据。这很重要，如下所示。

找到这些事件要困难得多......网格可以告诉你行，但我实际上需要从网格行内的表格中抓取元素。长话短说，但我继承了其中的一些代码。

然后在我的父组件中，我将一个事件附加到 Grid 本身。

```
this.on({       
  click :{scope: this, fn:this.actionGridClick} 
}); 
```

为了找到实际的链接，我在目标中搜索具有正确类的链接。在这种情况下“add_cart_btn”

```
actionGridClick:function(e) {
  // Looking for a click on a cart button
  var addCartEl = Ext.get(e.getTarget('.add_cart_btn'));   
  if(addCartEl) {
    productID = addCartEl.id;
    // Once we have the ID, we can grab data from the data store
    // We then call to the server to complete the "add to cart" functionality
  }
} 
```

除了在我的情况下，这不是很有帮助，但是如果将来有人需要类似的东西，它就在这里供后代使用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-09-15T14:00:17.060

试试这个 ：

```
// create grid
var grid = new Ext.grid.GridPanel({
    store: store,
    columns: [
        {header: 'NAME', width: 170, sortable: true, dataIndex: 'name'},
        {header: 'PHONE #', width: 150, sortable: true, dataIndex: 'phone'},
        {header: 'BIRTHDAY', width: 100, sortable: true, dataIndex: 'birthday',
            renderer: Ext.util.Format.dateRenderer('d/m/Y')},
        {header: 'EMAIL', width: 160, sortable: true, dataIndex: 'email',
            renderer: renderIcon }
    ],
    title: 'My Contacts',
    autoHeight:true,
    width:600,
    renderTo: document.body,
    frame:true
}); 
```

看到这个：

```
{header: 'EMAIL', width: 160, sortable: true, dataIndex: 'email', renderer: renderIcon } 
```

渲染器将​​被定义为：

```
//image path
var IMG_EMAIL = '/gridcell-with-image/img/email_link.png';

//renderer function
function renderIcon(val) {
    return '<a href="mailto:' + val + '">'+ '<img src="' + IMG_EMAIL + '"> ' + val  +'</a>';
} 
```

你在这里:)

# java - 快速的小 Java 问题：SQLException 周围的括号

> ID：415179
> 
> 赞同：1
> 
> 时间：2009-01-06T02:11:25.353
> 
> 标签：java, parentheses

```
 try {
      ...
  }  catch (SQLException sqle) {
      String theError = (sqle).getSQLState();
      ...
  } 
```

用括号括起来有什么作用`sqle`？任何事物？

只是好奇。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-06T02:12:58.470

快速回复 - 没有。

更长的回复 - 它可能是内联演员的残留物：

```
((SomeMoreSpecificException)sqle).get... 
```

# web - 公司在非在家工作期间寻求我的个人项目？

> ID：415188
> 
> 赞同：6
> 
> 时间：2009-01-06T02:16:03.317
> 
> 标签：web, projects

好的，所以我正在构建“Web 2.0/3.0”网站来赚取额外的收入。我目前使用我多年来开发的一些先进技术（人工智能、推荐系统）运行我自己的个人项目网站。这是一个订阅网站，我可以一边赚钱。

现在，我的公司（他们从事网络应用程序/软件技术、广告网络）不知何故发现我经营着几个网站。他们就像，“嘿，乔，你经营某某网站！为什么不把它们放在我们的广告网络上？？你所做的事情对我们的技术构成威胁——我们不希望你在边。让我们拥有您的网站并将其放在我们的投资组合/广告网络上。”

好吧，基本上他们似乎想要我的技术和个人项目的权利。不知何故，他们一定是用谷歌搜索了我的名字，并将其与我正在从事的一些项目联系起来。这对公司来说是否合乎道德？试图拥有我的个人项目，因为它有一些很酷的技术并试图拥有它的权利？仅仅因为我为公司工作并不意味着我会向他们提出要约，对吧？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-06T02:18:53.047

您可能需要咨询律师。当你被录用时，你同意的雇佣条款是什么？是否有竞业禁止条款？是否有必要的披露条款？

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-06T02:19:12.857

取决于你的雇佣合同。您的合同可能会说“您在 XYZ 公司工作期间所做的任何事情，无论是在工作时间还是非工作时间都属于我们”。是时候与律师交谈了，而不是问 StackOverflow，这不是技术/编程问题。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-06T02:21:57.393

道德的？是的，为什么不。如果您将内容发布到网络上并且他们可以通过 Google 找到它，那么他们为什么不应该呢？如果您不希望人们在网络上找到您所做的事情，请不要将其放在网络上或使用 robots.txt 对 Google 隐藏它。他们至少想知道您是否可能正在使用您在为他们工作时开发的技术，这并不是完全不合理的。

合法——也许是这样，也许不是。取决于您加入公司时签署的雇佣协议。我会咨询就业律师以获得真正的建议，而不是在这里询问。

他们可能有网络日志，表明您在工作时间在您的私人网站上工作——如果您这样做了。如果我是你，我会非常小心如何进行。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-06T02:22:06.863

检查您的合同和/或您所在州的法律和判例。与律师交谈。

恕我直言，他们试图无偿获取您的知识产权是不道德的，即使您拥有“您所有的代码都属于我们”的雇佣协议。但请与律师交谈，并*准备好走路、被起诉和反诉（如有必要*）。试图偷你午餐钱的人是恶霸和小偷，但他们可能只是有法律要求。

不幸的是，这不是玩笑。立即与律师交谈。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-06T02:20:20.000

如果您所做的以任何方式与您的公司所做或使用的技术、知识产权、信息或因您在公司工作而获得的联系方式存在竞争，那么您可能会遇到问题，应该检查您的合同并咨询律师。

另一方面是：您是否曾经在您的网站上工作过（这可能包括发送电子邮件等）您的个人项目？如果是这样，你也可能在那里遇到麻烦。

IANAL 所以这就是我要说的关于合法性的全部内容。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-06T02:21:53.757

您需要咨询律师以获得这个问题的明确答案。答案可能取决于您的雇佣合同以及您所在地区的法律。不要依赖人们在互联网上所说的有关法律事务的任何内容。

不管他们是否有权这样做，我认为他们这样向你施压是不道德和愚蠢的。我想他们刚刚失去了你可能拥有的任何员工忠诚度。

我认为适当的回应可能是，“如果您认为我的网站有广告收入潜力，请向我提供反映其价值的报价，我会考虑的。” 毕竟，你创办这些网站是为了赚钱，对吧？

但首先要与律师交谈，以确保您能够进行谈判。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-06T02:38:28.607

一个友好的解决方法是购买/租赁您的技术，如果他们是合理的，他们可能应该愿意接受。这样你就可以为你的工作获得一笔可观的钱（**因为你提到这个网站的目的是在你的问题中赚到额外的钱**）。

否则（如果它首先是一个宠物项目）你不妨以友好的方式告诉他们你把那个网站作为一种爱好，如果没关系你宁愿不分享它，除非他们让你全职工作你的收入和收入的削减等等......（大多数人都喜欢做的事情，从事他们的宠物项目并为此获得稳定的薪水）。

像往常一样，先在文明友好的事情上和对方讲道理，这样可能会让双方更开心，而且大部分时间都比走法律路线要好。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-06T02:21:39.687

我不是律师，几乎可以肯定，法律因国家/州/省而异。但是如果你在自己的时间，在自己的设备上，只使用自己的网络资源等做一个业余项目，那么在我看来，他们没有权利对你的工作。

如果您签署了某种模糊的竞业禁止合同，或者说您在自己的时间做的所有事情都是他们的，那么您就没有立足之地了。

您最好的选择是询问律师，您的订阅基础是否有足够的收入来证明它是合理的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-12T12:28:22.727

咨询律师！无论您的合同义务如何，任何公司都有权担心他们的一名员工是否在经营直接竞争对手，特别是如果他们可以证明您可以访问您用来竞争的特权信息（他们的知识技术、营销策略、客户等）。

# python - 创建简单 python web 服务的最佳方法

> ID：415192
> 
> 赞同：141
> 
> 时间：2009-01-06T02:17:54.343
> 
> 标签：python, web-services

我已经使用 python 多年了，但我对 python web 编程的经验很少。我想创建一个非常简单的 Web 服务，它从现有的 python 脚本中公开一些功能，以便在我的公司内使用。它可能会以 csv 格式返回结果。最快的方法是什么？如果它影响您的建议，我可能会在此基础上添加更多功能。

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-01-06T03:18:24.283

看看[werkzeug](http://werkzeug.pocoo.org/)。Werkzeug 最初是 WSGI 应用程序的各种实用程序的简单集合，现已成为最先进的 WSGI 实用程序模块之一。它包括一个强大的调试器、功能齐全的请求和响应对象、处理实体标签的 HTTP 实用程序、缓存控制标头、HTTP 日期、cookie 处理、文件上传、强大的 URL 路由系统和一堆社区贡献的插件模块。

它包含许多很酷的工具来处理 http 并且具有可以在不同环境（cgi、fcgi、apache/mod_wsgi 或用于调试的简单 python 服务器）中与 wsgi 一起使用的优点。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-01-06T02:59:18.113

[web.py](http://webpy.org/)可能是目前最简单的 Web 框架。“裸” CGI 更简单，但在制作实际执行某些操作的服务时，您完全靠自己。

“你好世界！” 根据 web.py 并没有比纯 CGI 版本长多少，但它*免费*添加了 URL 映射、HTTP 命令区分和查询参数解析：

```
import web

urls = (
    '/(.*)', 'hello'
)
app = web.application(urls, globals())

class hello:        
    def GET(self, name):
        if not name: 
            name = 'world'
        return 'Hello, ' + name + '!'

if __name__ == "__main__":
    app.run() 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-01-06T02:36:24.883

在线获取 Python 脚本的最简单方法是使用 CGI：

```
#!/usr/bin/python

print "Content-type: text/html"
print

print "<p>Hello world.</p>" 
```

将该代码放入 Web 服务器 CGI 目录中的脚本中，使其可执行，然后运行它。`cgi`当您需要接受用户的参数时，该模块有许多有用的实用程序。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-01-06T03:01:26.563

原始 CGI 有点痛苦，Django 有点重量级。有许多更简单、更轻量级的框架，例如[CherryPy](http://www.cherrypy.org/)。值得四处看看。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-01-06T11:19:54.233

查看[WSGI 参考实现](http://docs.python.org/library/wsgiref.html)。你的 Python 库中已经有了它。这很简单。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-06T20:50:50.727

如果您的意思是“Web 服务”，其他 Programms [SimpleXMLRPCServer](http://docs.python.org/library/simplexmlrpcserver.html)访问的东西可能适合您。自 2.2 版以来，每个 Python 安装都包含它。

对于简单的人类可访问的东西，我通常使用 Python的[SimpleHTTPServer](http://docs.python.org/library/simplehttpserver.html)，它也随每次安装一起提供。显然，您也可以通过客户端程序访问 SimpleHTTPServer。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-06T02:32:50.210

如果你有一个好的 web 框架，生活很简单。[Django](http://www.djangoproject.com)中的Web 服务很简单。定义您的模型，编写返回 CSV 文档的视图函数。跳过模板。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-06T03:21:51.187

如果您指的是 SOAP/WSDL 意义上的“Web 服务”，您可能需要查看[使用 Python 和 SOAPpy 生成 WSDL](https://stackoverflow.com/questions/273002/generating-a-wsdl-using-python-and-soappy)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-06T03:46:26.303

也许 Twisted [http://twistedmatrix.com/trac/](http://twistedmatrix.com/trac/)

# php - 在 PHP 中自动生成 META 标签

> ID：415198
> 
> 赞同：2
> 
> 时间：2009-01-06T02:19:29.333
> 
> 标签：php, database, automation, metadata

我正在考虑编写一个 PHP 脚本来分析 CMS 页面的内容（即数据库字段），然后自动生成 (X)HTML META 描述和关键字标签，但与往常一样，重新发明轮子没有意义，所以我想知道有没有人知道这样的野兽？

前者我想像一个相对简单的正则表达式来抓取第一句话或两句话，而后者可能涉及根据常用词词典消除单词，然后对频率或类似内容进行加权。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-06T03:33:42.270

您正在考虑的问题有两个：一个是关键字提取，另一个是文档摘要。第一个，我显然会用于关键字，它有一个非常简单的天真的方法：选择内容中最常见的词，减去所有停用词（如果你不知道这些是什么，请在 Wikipedia 中查找）。还有许多更高级的方法，包括为包含同义词、文本或标记中的位置等加权。有几个 PHP 中简单的关键字提取脚本示例，您可以轻松实现。只需谷歌搜索“PHP 关键字提取”之类的内容，您就会找到一些。

另一方面，第二个问题有点困难，仍然是很多学术工作的来源。您需要对非常全面的元描述标签进行总结。如果你不是在寻找一个可能仍然僵硬或不连贯的长期人工智能项目，那么实际上可能不值得你花时间。另一种方法是简单的使用关键字提取的启发式方法：“这篇文章是关于（第一个最常见的关键字）、（第二个最常见的关键字）和（第三个最常见的关键字）”。您至少可以从关键字和描述中的某些内容中受益。如果您想改变它，请改用一些同义词。WordNet有一个半功能的[PHP 实现](http://www.foxsurfer.com/wordnet/)，但我对于那里的繁重工作，因为大部分工作已经为您完成。

我想花一点时间来鼓励您在这方面的研究，并忽略 Warnica 先生的反对意见。元信息对于搜索领域的文档分类和信息提取*都很重要。*没有数据是愚蠢的，事实上，为大型内容管理系统自动化它是值得的。祝你的努力好运。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-06T02:58:11.920

Yahoo Pipes [Term Extractor](http://pipes.yahoo.com/pipes/docs?doc=string#TermExtractor)模块的功能与您想要的类似。不幸的是，我不知道管道模块打开的来源。

# c++ - 带有对象的向量的 const_cast

> ID：415199
> 
> 赞同：1
> 
> 时间：2009-01-06T02:19:39.067
> 
> 标签：c++

我知道 const_cast 删除对象的常量是不好的，

我有以下用例，

```
//note I cannot remove constness in the foo function
foo(const std::vector<Object> & objectVec) {

   ...
   int size = (int) objectVec.size();
   std::vector<Object> tempObjectVec;
   //Indexing here is to just show a part of the vector being
   //modified
   for (int i=0; i < (int) size-5; ++i) {
       Object &a = const_cast<Object&> objectVec[i];
       tempObjectVec.push_back(a);
   } 
   foo1(tempObjectVec);
} 
```

如果我更改 foo1 中的 tempObjectVec 对象，ObjectVec 中的原始对象是否会更改，我说是的，因为我正在传递引用，这进一步提高了效率。你能提出替代方案吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-06T02:28:44.947

嗯，这取决于对象。但是当您将对象传递给 push_back 时，它们正在被复制*。*您可以通过向复制构造函数添加一些调试代码来检查这一点。因此，如果 Object 表现良好并且将不同的副本分开，那么 foo1 可以更改它得到的所有它喜欢的向量。

一种更有效的方法是让 foo1 接受开始和结束迭代器：

```
void foo1(std::vector<Object>::const_iterator start,
          std::vector<Object>::const_iterator end);

...
foo1(objectVec.begin(), objectVec.end() - 5); 
```

如果您不使用 const_cast，那么类型系统将确保 foo1 不会更改任何元素，因为这些是 const_iterator。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T02:29:21.293

你`tempObjectVec`不能是引用向量，所以我认为它应该被声明为：

```
std::vector<Object> tempObjectVec; 
```

当您执行 时`tempObjectVec.push_back(a)`，将制作对象的副本以将其推入`tempObjectVec`向量中。由于这是在制作副本，因此您甚至不需要使用`const_cast`来删除 constness，我不清楚您为什么需要这样做。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-06T02:38:46.767

我相信这是您正在寻找的声明：

`const_cast<std::vector<Object>&> (objectVec)`这将返回一个对`std::vector`foo1 应该是可口的非常量的引用（我假设）。

修改您的原始示例：

```
foo(const std::vector<Object> & objectVec) {

    ...
    foo1(const_cast<std::vector<Object> &>(objectVec));
} 
```

但是，我确实建议您查看`foo1`要求它使用非常量向量的实际要求，因为您似乎表明所有您感兴趣的都是修改`Object`实例本身。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-06T16:34:42.617

正如其他人已经说过的那样，您的向量的 push_back 接受引用，但随后它复制了它引用的对象。所以，最后你会`objectVec[i]`在你的`tempObjectVec`.

A vector can't store references, because they can't be assigned (assignments to it affect not the reference itself, but the object referenced instead), which is a requirement for objects to be held in a vector. References are also no objects. They don't have an own size. They therefor can't be pushed into an array or any vector. Usually you want to store pointers or smart pointers in such a container to reference some other object. Look into the [`boost pointer container`](http://www.boost.org/doc/libs/1_35_0/libs/ptr_container/doc/ptr_container.html) library which looks like exactly what you want.

# php - 如何使 $_POST 持久化？

> ID：415204
> 
> 赞同：1
> 
> 时间：2009-01-06T02:21:28.050
> 
> 标签：php, webforms

如果我的网站有搜索功能，并且我希望用户以前的搜索首选项可以在我网站上搜索模块可用的任何页面上可用，那么我能想到的就是将`$_POST`变量转换为 cookie……但我我只是在修改我替换的另一个人已经构建的内容，我不知道如果我开始依赖 cookie，他依赖于该搜索模块的其他页面是否会受到影响......所以我试图创建一个持久`$_POST`数组我可以从中工作..有可能吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-06T02:33:26.403

我会考虑使用 $_SESSION。将所有搜索项放入 $_SESSION 中的数组中。

举个例子：

假设用户搜索“苹果”，

将其添加到 $_SESSION['search_items'][] = "apples";

假设用户然后搜索“橙子”，

将其添加到 $_SESSION['search_items'][] = "oranges";

确保你有 session_start(); 在您计划使用搜索功能的每个页面的顶部。然后您可以在 $_SESSION 中添加和访问搜索项

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-06T02:29:14.507

正如您所提到的，您可以将搜索查询保留到[会话或 cookie。](http://us2.php.net/session)如果您确保对搜索模块进行编码以处理有 cookie 和没有 cookie 的两种情况，我认为应该没有问题。

# wcf - 如何使用 WCF REST 读取自定义 HTTP 状态代码？

> ID：415206
> 
> 赞同：2
> 
> 时间：2009-01-06T02:21:44.023
> 
> 标签：wcf, http, rest, channelfactory

我正在使用 WCF 中的 ChannelFactory 来调用 REST 服务，并且我想确定服务器是返回 HTTP 200 还是 201 以响应 PUT 调用。目前，调用成功，但我无法确定我的对象是创建还是更新。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-18T04:25:12.173

WCF 是为各种渠道设计的，所以这不是一个高级对象

你可以用这样的东西访问它

```
factory.Endpoint.Behaviors.Add(new WebHttpBehavior());
IMyContract proxy = factory.CreateChannel();
using (OperationContextScope scope = new OperationContextScope((IContextChannel)proxy)) {
    proxy.MyMethod("Some data"));
    var responseCode = WebOperationContext.Current.IncomingResponse.StatusCode;
}
((IClientChannel)proxy).Close();
factory.Close(); 
```

# php - PHP IRC 机器人，发送命令，但现在我需要机器人来读取命令

> ID：415213
> 
> 赞同：3
> 
> 时间：2009-01-06T02:22:42.273
> 
> 标签：php, command, irc, prompt, robot

我有一个 PHP IRC 机器人，我在我的频道中使用它，我需要它来对脚本中的特定用户进行 OP。无论如何，我希望机器人检查用户是否登录到 NickServ 以防止任何形式的欺诈或任何事情。

无论如何，这是我的连接和做事代码，下面是我真正需要帮助的内容。感谢所有帮助。:) 在 Freenode 上，输入 /NS ACC [user] 将返回 [user] 是否使用数值登录，他们决定 3 将登录。而 0-2 表示某种未登录。

所以这就是机器人如何登录到我的 IRC 频道...（随时在 freenode 上加入#tyreus，询问 BwaddArr（或他的电子邮件））

```
<?php
set_time_limit(0);  //Stop the script timing out

$server = "irc.freenode.net";        //server to connect to
$channel = "#tyreus";               //channel to connect to initialy
$password = "sumpass";             //password for bot to login to irc
$pass2 = "anotherpass";               //password to make the bot do stuff
$users[0] = "0";                  //array of logged in users
$nickname = "Samcal";            //Set the bot's nick here
$logger = FALSE;                //for the channel logger
$takeover = FALSE;             //for the auto banner

$socket=fsockopen($server,'6667') ; //Connect and join the channel

stream_set_timeout($socket, 300);  //Set a timeout value (so the bot quits if it's disconnected)
fwrite($socket, "NICK ".$nickname."\r\n");
fwrite($socket, "USER ".$nickname." 8 * ::\x01VERSON 1.0 Brad's bot\x01\n");  //read rfc 1459 to understand this line

  while ($line=fgets($socket)) {
     echo htmlentities($line)."<br>"; 
       if (strpos($line, "433")>0) die("error nick in use");  //Quit if bot's nick is already taken (irc code 433 is received)

       if (strpos($line, "004")>0) {
          fwrite($socket, "JOIN ".$channel."\r\n"); //Join the channel if everything is ok (irc code 004 is received)
          fwrite($socket, "NickServ IDENTIFY ".$nickname." ".$password."\r\n");
          fwrite($socket, "ChanServ OP ".$channel." Samcal\r\n");
          fwrite($socket, "MODE ".$channel." +v Samcal \r\n");
          break;
       }
  } 
```

这就是我真正需要所有帮助的地方！:)

```
 if(strpos($line, "PRIVMSG ".$channel." :+oB\r\n")>0) { //Command to make the bot run the command
    $name = "BwaddArr"; // my username, this can be easily changed to the other users who will need opping
    $command = "NickServ ACC $name"; // the NickServ command I was talking about
    $result = fwrite($socket, "$command \r\n"); // my attempt at retrieving the result
    $accr = readline(strpos($line, "$result \r\n")); //part 2 of my failure to retrieve a result
    $loggd = str_replace("3","three","$accr"); // replace '3' with 'three'
 if($loggd != "three") { // if result is not three do below
    fwrite($socket, "PRIVMSG ".$channel." :$name is not logged in. \r\n"); // write into the chat that the user is not logged in
}
 if($loggd == "three") { // OP the user if they are logged in
    fwrite($socket, "MODE ".$channel." +ov $name\r\n"); // sends the OPping command
}
}
?> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-06T08:22:33.950

我假设第二个片段位于您的 while(fgets()) 循环内。

然后，您不会在使用 fwrite() 的循环中获得结果。在之后添加另一个 fgets()

```
$result = fwrite($socket, "$command \r\n"); 
```

或者因此使用您的循环并可能添加一个状态标志以了解如何处理其主体的下一次执行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-06T14:55:53.160

我做过一个，年轻的时候。

我使用了那种循环：

```
$irc = fsockopen($server, $port);
// ...
while(!feof($irc))
{
     $line = fgets($irc, 2048);

     // ...
     // Parsing $line here
     // ...
} 
```

希望这可以帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-06T02:44:47.363

首先，删除您的机器人的密码。（固定）

在您的 IRC 上提供了一些提示，祝您好运，您现在走在正确的轨道上。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-12T11:01:52.403

在上一个代码片段中，您打开名为的套接字`$irc`并写入名为`$socket`. 要么解决这个问题，要么向我们展示更多你使用/introduce 的代码`$socket`。

# c# - C# 中的固定长度字符串或结构

> ID：415214
> 
> 赞同：2
> 
> 时间：2009-01-06T02:23:09.403
> 
> 标签：c#, .net, vb.net

我需要为我正在处理的项目创建一个固定长度的结构或一系列字符串。目前它是用 COBOL 编写的，是一个通信应用程序。它通过网络发送一个固定长度的记录并接收一个固定长度的记录。为了简单起见，我想把它写成一个结构，但到目前为止，我发现的最好的东西是一种使用 string.padright 将字符串终止符放在正确位置的方法。

我可以编写一个封装它并返回固定长度字符串的类，但我希望找到一种简单的方法来填充结构并将其用作固定长度的记录。

编辑 -

固定长度记录用作 URL 中的参数，因此它的 http:\somewebsite.com\parseme?record="firstname lastname address city state zip"。我很确定我不必担心 ascii 到 unicode 的转换，因为它在 url 中。它比那个大一点，传递的信息比地址多，大约 30 或 35 个字段。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-06T02:29:58.530

将 MarshalAs 标签添加到您的结构中。这是一个例子：

```
<StructLayout (LayoutKind.Sequential, CharSet:=CharSet.Auto)> _
Public Structure OSVERSIONINFO
    Public dwOSVersionInfoSize As Integer
    Public dwMajorVersion As Integer
    Public dwMinorVersion As Integer
    Public dwBuildNumber As Integer
    Public dwPlatformId As Integer

    <MarshalAs (UnmanagedType.ByValTStr, SizeConst:=128)> _
    Public szCSDVersion As String
End Structure 
```

[http://bytes.com/groups/net-vb/369711-defined-fixed-length-string-structure](http://bytes.com/groups/net-vb/369711-defined-fixed-length-string-structure)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T03:08:21.137

您可以使用 VB6 compat [FixedLengthString](http://msdn.microsoft.com/en-us/library/microsoft.visualbasic.compatibility.vb6.fixedlengthstring.value.aspx)类，但编写自己的类非常简单。

如果您需要解析和验证以及所有有趣的东西，您可能想看看[FileHelpers](http://filehelpers.sourceforge.net/)，它使用属性来[注释和解析固定长度的记录](http://filehelpers.sourceforge.net/quick_start_fixed.html)。

FWIW，在任何相对琐碎的事情（例如数据处理）上，我可能只使用 ToFixedLength() 扩展方法，在写出记录时根据需要处理填充或截断。对于更复杂的事情（如验证或解析），我会求助于 FileHelpers。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-08-19T22:22:32.383

```
byte[] arrayByte = new byte[35];

// Fill arrayByte with the other function

//Convert array of byte to string chain
string arrayStringConverr = Encoding.ASCII.GetString(arrayByte, 0, arrayByte.Length); 
```

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-01-06T03:20:16.870

作为答案，您应该能够使用正确大小的 char 数组，而无需编组。

此外，.net 中的类和结构之间的差异很小。结构不能为空，而类可以。否则，它们的用途和功能几乎相同。

最后，听起来您应该注意正在发送的字符的大小。我假设（我知道，我知道）COBOL 使用 8 位 ASCII 字符，而 .net 字符串将使用 UTF-16 编码字符集。这意味着 COBOL 中 10 个字符的字符串是 10 个字节，但在 .net 中，相同的字符串是 20 个字节。

# c# - lambda/匿名函数简介

> ID：415218
> 
> 赞同：1
> 
> 时间：2009-01-06T02:24:25.390
> 
> 标签：c#

我有一个插件的这个功能（来自上一篇文章）

```
// This method implements the test condition for 
// finding the ResolutionInfo.
private static bool IsResolutionInfo(ImageResource res)
{
  return res.ID == (int)ResourceIDs.ResolutionInfo;
} 
```

以及调用此函数的行：

```
 get
  {
    return (ResolutionInfo)m_imageResources.Find(IsResolutionInfo);
  } 
```

所以基本上我想摆脱调用函数。它只被调用了两次（一次在 get 中，另一个在 set 中）。它可以帮助我理解 c# 中的内联函数。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-06T02:28:46.177

```
get
  {
    return (ResolutionInfo)m_imageResources.Find(res => res.ID == (int)ResourceIDs.ResolutionInfo);
  } 
```

这完全清楚了吗？

只是为了进一步弄清楚，看看反射器，Find 方法是这样的：

```
public T Find(Predicate<T> match)
{
    if (match == null)
    {
        ThrowHelper.ThrowArgumentNullException(ExceptionArgument.match);
    }
    for (int i = 0; i < this._size; i++)
    {
        if (match(this._items[i]))
        {
            return this._items[i];
        }
    }
    return default(T);
} 
```

如您所见，它遍历集合，并且对于集合中的每个项目，它将该索引处的项目传递给您传入的谓词（通过您的 lambda）。因此，由于我们正在处理泛型，它会自动知道您正在处理的类型。它将是 Type T，它是您收藏中的任何类型。说得通？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-06T02:29:34.273

只是要添加，列表上的“查找”函数（m_imageresources 是什么）会自动将参数传递给 IsResoulutionInfo 函数吗？

另外，演员阵容或函数调用首先会发生什么？

# c# - 为私有成员生成 XML 文档

> ID：415220
> 
> 赞同：0
> 
> 时间：2009-01-06T02:25:45.997
> 
> 标签：c#, .net, vb.net, visual-studio-2008

有没有办法为私有成员生成 XML 文档？默认情况下，它只为公共成员生成它，这对于已发布的代码是正确的，但对于仅在公司内部使用的代码是正确的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-06T17:52:47.887

尝试使用[GhostDoc](http://www.roland-weigelt.de/ghostdoc/)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-06T07:50:19.273

我的建议是将 xml 文档与代码一起编写。不需要太多时间，而且我发现这种方法可以帮助我更好地组织我的代码结构。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-01-08T09:01:04.533

对于 Sandcastle，这里给出了答案：[Sandcastle not generate private methods docs (C#)](https://stackoverflow.com/questions/20104078/sandcastle-not-generating-private-methods-docs-c)

（在 Sandcastle 中打开 DocumentPrivates。）

# html - 带有 action="" 的表单

> ID：415234
> 
> 赞同：27
> 
> 时间：2009-01-06T02:30:43.957
> 
> 标签：html, forms

我刚刚发现（很难），当你有一个带有 的 HTML 表单时`action=""`，Webkit 浏览器对它的处理方式与 Firefox 和 Internet Explorer 不同。

在 FF 和 IE 中，这两个表单标签是等价的：

```
<form method="post" action="">

<form method="post"> 
```

他们都会将表单提交回同一页面。然而，Safari 和 Chrome 会将第一个表单发送到默认页面（index.php 或其他）——第二个表单的工作方式与 FF/IE 相同。

我很快就破解了我的代码，以便在通常打印空操作的任何地方，它根本不会添加操作属性。

这似乎很混乱，不是最好的做事方式。任何人都可以提出更好的方法吗？另外，谁能告诉我为什么 Webkit 会做这样的事情？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-01-06T03:17:45.923

我通常使用

```
<form method='POST' action='?'> 
```

这表示当前 URL，但没有参数。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-03-05T23:44:50.320

该[`action`属性是必需](http://www.w3.org/TR/html401/interact/forms.html#adef-action)的，但您可以指定引用当前 URI 的空 URI 引用：

```
<form method="POST" action=""> 
```

* * *

**编辑**    好的，这实际上是 WebKit 528+ 的一个已提交错误（请参阅[错误 19884](https://bugs.webkit.org/show_bug.cgi?id=19884)），当空 URI 与使用该`BASE`元素的指定基本 URI 一起使用时。在这种情况下，WebKit 采用基本 URI，而不是从基本 URI 解析空 URI。

但[根据 RFC 3986，这是正确的行为](https://www.rfc-editor.org/rfc/rfc3986#section-5.1)：

> **5.1。建立基础 URI**
> 
> 术语“相对”意味着存在应用相对引用的“基本 URI”。[…]
> 
> 引用的基本 URI 可以通过以下四种方式之一建立，下面按优先顺序进行讨论。可以根据层来考虑优先顺序，其中最内层定义的基本 URI 具有最高优先级。这可以用图形表示如下：
> 
> ```
>  .----------------------------------------------------------.
>   |  .----------------------------------------------------.  |
>   |  |  .----------------------------------------------.  |  |
>   |  |  |  .----------------------------------------.  |  |  |
>   |  |  |  |  .----------------------------------.  |  |  |  |
>   |  |  |  |  |       <relative-reference>       |  |  |  |  |
>   |  |  |  |  `----------------------------------'  |  |  |  |
>   |  |  |  | (5.1.1) Base URI embedded in content   |  |  |  |
>   |  |  |  `----------------------------------------'  |  |  |
>   |  |  | (5.1.2) Base URI of the encapsulating entity |  |  |
>   |  |  |         (message, representation, or none)   |  |  |
>   |  |  `----------------------------------------------'  |  |
>   |  | (5.1.3) URI used to retrieve the entity            |  |
>   |  `----------------------------------------------------'  |
>   | (5.1.4) Default Base URI (application-dependent)         |
>   `----------------------------------------------------------' 
> ```

在这种情况下，具有属性的`BASE`元素是*嵌入在 content 中的基本 URI*。并且*嵌入在内容中的基本 URI比**用于检索实体的 URI*具有更高的优先级。所以 WebKit 的行为实际上是根据 RFC 3986 的预期行为。`href`

 ***但在 HTML 5 中， ['s](http://www.w3.org/TR/html5/association-of-controls-and-forms.html#form-submission-algorithm)[中的空 URI 的这种行为`form``action`](http://www.w3.org/TR/html5/association-of-controls-and-forms.html#form-submission-algorithm)（仍然是草案）与 RFC 3986 不同：

> 如果*action*是空字符串，让*action*是[文档的地址](http://www.w3.org/TR/html5/dom.html#the-document-s-address)。

> > 注意：此步骤是[故意违反](http://www.w3.org/TR/html5/introduction.html#willful-violation)RFC 3986，需要在此处处理基本 URL。这种违规的动机是希望与遗留内容兼容。[[RFC3986]](http://www.w3.org/TR/html5/references.html#refsRFC3986)

坦率地说，源代码中此注释之后的 HTML 注释如下：

> ```
> <!-- Don't ask me why. But that's what IE does. It even treats
> action="" differently from action=" " or action="#" (the latter
> two resolve to the base URL, the first one resolves to the doc
> URL). And other browsers concur. It is even required, see e.g.
>   http://bugs.webkit.org/show_bug.cgi?id=7763
>   https://bugzilla.mozilla.org/show_bug.cgi?id=297761
> --> 
> ```

因此，这是一个源自 Internet Explorer 的错误，后来成为事实上的标准。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-06T02:35:34.057

我认为最好的方法是不要省略 action 属性（不会验证），而是指定表单的实际操作。您没有指定操作是否有原因？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-05T02:31:26.480

我一直使用（在 PHP 中）

```
<form method="post" action="<?php echo htmlspecialchars($_SERVER['REQUEST_URI']); ?>"> 
```

让我的表格提交给自己。

# c# - XML序列化空集合不自动关闭

> ID：415239
> 
> 赞同：1
> 
> 时间：2009-01-06T02:31:25.877
> 
> 标签：c#, xml-serialization

想知道是否有人可以帮助我解决这个烦人但微不足道的（就需要而言）问题。我有一个对象，里面有一个对象集合

```
 public class OuterClass
  {
    InnerClasses innerClasses= new InnerClasses();
     public InnerClasses InnerClasses
    {
      get {return innerClasses; }
    }
    public string Name
   {
     get;set;
   }
  }

  public class InnerClasses:List<InnerClass>
  {

  }
  public class <InnerClass>
  {

  } 
```

基本上我遇到的问题是，如果我通过 xml 序列化程序传递它

```
 var outer = new OuterClass(){Name="Name"}
    var xmlSerializer = new XmlSerializer(GetType());
    var stringBuilder = new StringBuilder();
    var stringWriter = new StringWriter(stringBuilder);    
    xmlSerializer.Serialize(stringWriter, this);
    return stringBuilder.ToString(); 
```

我想知道为什么当我没有内部类时它会输出

```
<OuterClass>
 <Name>Name</Name>
 <InnerClasses ></InnerClasses>
</OuterClass> 
```

为什么它不把 InnerClasses 作为一个自闭标签？

我意识到上面的代码会放，但我不能放完整的实际代码清单。（我知道没多大用处）我只是在寻找可能导致它的指针。

我一生都无法弄清楚为什么默认情况下它不这样做。

非常感谢您提供有关查看位置的任何意见。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-06T02:56:36.183

我一直注意到同样的事情，但据我所知，这只是实现序列化类的方式。他们只是选择不使用自闭标签。希望这将在未来的实施中得到改变。

# c# - .NET 类重构困境

> ID：415240
> 
> 赞同：3
> 
> 时间：2009-01-06T02:32:00.523
> 
> 标签：c#, .net, oop, refactoring

所以我正在重构我继承的遗留代码库，在这个过程中我发现了一个静态类，它封装了启动 3rd 方应用程序的逻辑。它基本上看起来像这样（为简洁起见，仅显示一个应用程序）：

```
using System.IO;
using System.Configuration;
public static class ExternalApplications
{

   public string App1Path
   {
      get
      {
         if(null == thisApp1Path)
            thisApp1Path = Configuration.AppSettings.Get("App1Path");
         return thisApp1Path;
      }
   }
   private string thisApp1Path = null;

   public bool App1Exists() 
   {
      if(string.IsNullOrEmpty(App1Path))
         throw new ConfigurationException("App1Path not specified.");
      return File.Exists(App1Path);
   }

   public void ExecuteApp1(string args) 
   {
       // Code to launch the application.
   }

} 
```

将外部应用程序与其余代码分开是一个很好的尝试，但我突然想到这可以进一步重构。我的想法是这样的：

```
using System.IO;
public abstract class ExternalApplicationBase
{

   protected ExternalApplicationBase()
   {
      InitializeFromConfiguration();
   }

   public string Path { get; protected set; }

   public bool Exists() 
   {
      if(string.IsNullOrEmpty(this.Path))
         throw new ConfigurationException("Path not specified.");
      return File.Exists(this.Path);
   }

   public virtual void Execute(string args)
   {
      // Implementation to launch the application
   } 

   protected abstract InitializeFromConfiguration();

}

public class App1 : ExternalApplicationBase
{

   protected virtual void InitializeFromConfiguration()
   {
      // Implementation to initialize this application from
      // the application's configuration file.
   }

 }

 public class App2 : ExternalApplicationBase
 {

   protected virtual void InitializeFromConfiguration()
   {
      // Implementation to initialize this application from
      // the application's configuration file.
   }

 } 
```

我的担忧如下：

1.  可能已经存在执行此操作的类、接口或其他构造，而我只是没有偶然发现它。

2.  对于我想做的事情来说，这可能是矫枉过正。但是请注意，该应用程序至少使用了我迄今为止确定的三个独立的第 3 方应用程序（并且几乎肯定会弹出更多应用程序）。

3.  我对基类的名称并不完全满意。它看起来很模糊，而且信息量不大（但我想不出更好的方法，因为 Application 已经被很好地定义，由框架保留，如果我使用它会造成严重的混乱）。

4.  这个想法是我希望能够将应用程序配置数据（它的路径和可执行文件名称）保留在 App.Config 文件中，并在我的应用程序启动时检查它是否存在；当我的软件需要启动软件时，我想通过一个方法调用来完成它，而不是使用代码构建命令行并尝试手动启动软件（就像它目前所做的那样）。

因此，我发出请求帮助、指导和建议。非常感谢您能提供的任何东西。

PS 我在这里问这个问题是因为我像我经常做的那样，作为我公司的唯一开发人员工作；我没有其他人可以反对这些想法。你们在这方面有很多经验，我不征求你们的意见是愚蠢的，所以我希望你们能多多包涵。提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-06T07:07:17.877

这是另一种重构方式：

```
using System.IO;
public class ExternalApplication
{
   public ExternalApplication(string path)
   {
      this.Path = path;
   }

   public string Path { get; protected set; }

   public bool Exists() 
   {
      if(string.IsNullOrEmpty(this.Path))
         throw new ConfigurationException("Path not specified.");
      return File.Exists(this.Path);
   }

   public void Execute(string args)
   {
      // Implementation to launch the application
   } 
}

public class AppFactory
{
   public ExternalApplication App1()
   {
      // Implementation to initialize this application from
      // the application's configuration file.
   }

   public ExternalApplication App2()
   {
      // Implementation to initialize this application from
      // the application's configuration file.
   }

   public ExternalApplication AppFromKey(string key)
   {
      // get from somewhere
   } 
 } 
```

在这种情况下，您有一个类型`ExternalApplication`和一个工厂，其中包含为您返回正确配置的应用程序的方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-06T02:43:08.113

对我来说似乎很合理。

我过去做过类似的事情，但我没有抽象基类。相反，我在构造函数中传入了应用程序路径。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-06T03:06:26.413

我必须同意@Grauenwolf 的观点，这似乎是合理的。

根据通用性，您可能希望提供一种机制来封装配置检索（一种提取/设置命令行参数的方法）或如何执行应用程序（同步或异步）。

1.  如果您发现一个已经存在，请尝试在其周围放置一个包装器并继续。
2.  添加这个额外的层并没有太多的努力，有助于更好地分离应用程序关注点。我觉得还可以，可以通过mocking帮助增强可测试性。
3.  AppLauncherBase 还是 AppExecutorBase？应用程序没有理由必须是外部的。不是有史以来最好的名字，但我会尝试封装类的目的，启动/执行应用程序。
4.  您可能需要考虑在 App.Config 中定义用于定义配置数据/应用程序路径信息的约定，然后实现在基类中检索它的逻辑作为默认值。

祝你好运，我希望这会有所帮助。

# java - 当结果不同时，如何进行单元测试？

> ID：415244
> 
> 赞同：10
> 
> 时间：2009-01-06T02:34:37.243
> 
> 标签：java, unit-testing, integration-testing

我正在构建一个查询 Web 服务的应用程序。数据库中的数据随时间变化和变化。如何为这种类型的应用程序构建单元测试？

Web 服务发回 xml 或没有搜索结果的 html 页面。我不能真正改变网络服务。我的应用程序基本上使用 HTTPURLConnection 查询 Web 服务并将响应作为字符串获取。

希望对更多细节有所帮助。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-06T02:39:57.060

使用可以模拟的代理抽象出 Web 服务。让您的模拟 Web 服务返回代表正常数据和极端情况的各种值​​。还模拟从 Web 服务获取异常。确保您的代码在这些条件下工作，并且您可以合理地确定它适用于 Web 服务提供的任何值。

查看[jMock](http://www.jmock.org/)以进行 Java 模拟。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-06T07:04:01.690

严格来说单元测试，你只能测试具有**确定性行为**的单元。

连接到外部 Web 服务器的测试是**集成测试**。

解决方案是模拟 HTTPURLConnection - 也就是说，在您的单元测试中创建一个派生自 HTTPURLConnection 类并返回硬编码或可参数化值的类。**编辑**：请注意，这可以手动完成，无需任何模拟框架。

查询 Web 服务器的类不应实例化 HTTPURLConnection，而是通过参数接收它。在单元测试中，您创建 HTTPURLConnectionMock，并将其传递给询问 Web 服务器的类，该类将使用它，因为它正在使用真正的 HTTPURLConnection。在生产代码中，您创建一个真正的 HTTPURLConnection 并将其传递给类。

您还可以使您的 HTTPURLConnectionMock 能够抛出 IOException，以**测试错误条件**。只是有一个方法告诉它不要返回结果，而是在下一次请求时返回异常。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-06T02:40:25.967

听起来你的测试水平太高了。考虑模拟 Web 服务接口并在访问数据库的数据层上编写其他单元测试。这里的更多细节可能会使这个问题更容易回答，例如您尝试测试的情况。

我通常希望单元测试的结果不会改变，或者至少在你期望的范围内

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-06T02:43:50.250

您的问题有点开放式，但仅使用上述信息肯定有一些可测试的选项：

1.  您可以测试查询是否有效。断言您应该返回一个非空/非空结果集。
2.  您可以测试查询结果是否是*有效*的结果集。断言结果应该通过您的验证代码（所以此时，您知道数据是非空的，不是无意义的并且可能有用）。
3.  如果您对数据模式/数据描述有所了解，则可以断言这些字段相互关联是合理的。例如，如果您使用直升机获得结果，则不应将其与负 100 米的高度相关联......
4.  如果您对数据的概率分布有所了解，您应该能够收集一组数据并断言您得到的分布在您期望看到的标准偏差范围内。

我相信，有了更多信息，您会得到一堆有用的建议。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-06T17:25:16.010

我遇到的一个问题是复杂的（意思是“蹩脚的”）数据模型，你永远无法确定问题是由于代码错误还是数据错误造成的。

这种情况的一个症状是当您的应用程序运行良好，通过所有测试等时，使用模拟数据或新数据集，但是当您在真实数据上运行应用程序时会严重中断。

# user-experience - 你如何找出用户真正想要什么？

> ID：415260
> 
> 赞同：20
> 
> 时间：2009-01-06T02:40:03.893
> 
> 标签：user-experience

我在某处读过（我忘记了来源，抱歉 - 我认为是 MS Office 开发人员的博客？），当您对用户进行调查时，询问他们希望在您的软件/网站中看到哪些功能，他们会更多通常说他们想要每一件小事，而收集的指标表明，最终，大多数人并没有使用 99% 的这些功能。博客文章的一般信息是，您不应该问人们他们使用什么，您应该自己跟踪它。

当试图弄清楚接下来要添加什么新功能时，这会导致不幸的先有鸡还是先有蛋的情况。如果没有该功能，我无法衡量它实际使用了多少。由于资源有限（且资源严重紧张），我也无法添加所有功能，然后删除未使用的功能。

**你如何找出对你的用户有用的东西？**如果调查是唯一的选择，您是否必须以某种方式组织您的问题（例如：不要显示可能的功能列表，因为这会引导他们）？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-01-06T03:00:44.227

与普遍的看法相反，你*不*问他们。*好吧，当他们告诉*你他们想要什么时，你不听他们的。当他们使用他们现在拥有的东西时，你会看着他们。如果他们没有任何东西，你听他们足够多的东西给他们一个原型，然后你看着他们使用它。一个人实际*使用*软件的方式告诉你的比他们实际说的要多得多。观察他们的所作所为，找出他们真正需要的东西。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-06T02:47:08.043

给他们选项，让他们按重要性排列它们。正如您所说，用户将想要一切，但这将使您能够说出他们最想要的东西。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-06T02:42:33.093

你告诉他们。那你们俩就知道了。

（不，您的用户不会告诉您他们想要什么。那是工作。如果用户想要做更多的工作，他们就不会寻找软件来为他们完成工作。）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-06T02:51:11.313

前世的一则轶事：

我们正计划发布一个新版本，并希望为应用程序添加一些新功能。我们将用户召集在一起，集思广益，讨论他们希望在系统中看到的内容，将每个“功能”放在白板上的黄色便签上。然后，我们将类似的请求组合在一起，并消除了重复或接近重复的请求。

然后，我们将每个粘性物放在一张桌子上，前面有一个杯子。每个用户有 10 美分来“投票”他们想要的功能。他们可以在每个杯子里放任意多的便士，如果他们愿意的话，最多可以把他们所有的便士放在一个杯子里。然后，我们计算了每个杯子中​​的便士数量，并按得票顺序选择实施前 5 名得票者。

令人惊讶的是，人们在集思广益和分类时对某项功能充满热情，却不为该功能投票（或轻轻投票）。

当然，这样的技术只有在您可以随时访问您的用户群时才有效（这是针对我们内部开发的企业系统）。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-06T02:40:47.870

你问他们。

（不，你不知道你的用户比他们更想要什么。是的，你会得到很多愚蠢的答案。避免多项选择调查，而是选择查看自由形式的答案。你收集的信息将是无价的。 )

当然——你总是可以让你的用户*投票选出*他们最喜欢的功能......

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-06T05:05:23.850

**用户知道他们不想要什么比他们知道他们想要什么更好。**

我们引入了一个团队来执行 Oracle eBusiness Suite 实施。他们采取了一种有趣的方法，过去对他们非常有效。但这在我们的环境中是惊人的。

我们有文化问题，这意味着没有一个用户会伸出脖子说出他们想要的东西。我与过去的用户有过历史。试图从他们那里得到要求就像试图从石头上取血一样。但是一旦你上线，就会开始讨厌。

无论如何，实施团队开箱即用地安装了 Oracle eBusiness Suite。对用户进行基本培训。然后在接下来的 6 个月中，他们大约每 4 周定制一次基础安装以适应投诉。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-06T02:42:35.323

我建议不要向他们展示选项；正如您所指出的，如果它可用，那么人们会为了拥有它而想要它。用户通常不知道开发特定功能的额外成本，只是想要它，因为您提到了拥有它的可能性。

另一种选择是列出您可能添加的所有功能的列表，然后为每个功能附加价格，然后询问用户，拥有功能 Y 是否值得 X 美元，或者您会多花多少钱愿意为功能 Y 付费吗？

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-06T10:28:11.983

[吃自己的狗粮](http://en.wikipedia.org/wiki/Eat_one's_own_dog_food)

尽量使用自己编写的应用程序。然后，您将知道如何改进您的应用程序。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-05-17T09:20:42.367

根据[37 Signals - Getting Real](http://gettingreal.37signals.com/)的书，你什么都不做，你甚至不记录他们想要的东西，你只是在阅读后删除邮件，没有任何动作。

在实施/修复内容时​​，您会记住用户最想知道的最重要的事情。显然，这需要一点用户基础。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-06T02:46:27.967

您需要将功能与成本联系起来。每个人都想要功能，但并非每个功能都值得付费。询问哪些功能最重要，您的用户愿意为哪些功能付费？根据用户提供的优先级开发功能，并在他们不愿意支付更多费用时停止。尽快将产品交到他们手中，这样您就可以获得关于哪些不起作用以及需要添加哪些内容的真实反馈。当用户可以访问真正的软件时，您可以获得更好的信息。当您专门为特定客户进行开发时，这最有效。如果您无法接触到真正的客户，请考虑免费为您的产品播种（您可以说是公开测试版吗？）以获得更好的反馈。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-06T03:06:57.647

了解用户“真正”需要什么的唯一方法是“成为”用户。其编程功夫黑带级别。

“就像水从裂缝中流过。不要固执己见，但要适应对象，你就会找到绕过它或穿过它的方法。如果你内在没有什么是僵硬的，外在的东西就会暴露出来。清空你的思想，成为无形无形如水会崩溃。做水我的朋友。

当您成为水/客户时，您现在就可以了。

我认为李小龙会是一个很好的程序员。

我很认真。这就是我的工作方式。我不能做我不明白的事情，所以在我做事之前我必须了解。当我明白了，我的顾客也知道我明白了，我就能做好。没有理解就会产生误解。您是唯一知道您何时拥有正确理解水平的人，您也是负责获取该知识的人。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-01-06T03:07:25.053

用户不知道他们想要什么功能。您不知道它们可能提供哪些功能。“特征”除了帮助他们完成任务和实现目标之外没有任何意义。这就是你应该开始的地方，因为他们对它们之间的关系有非常不完美的理解。

他们知道一件事，也许，比你好得多。这就是如何完成他们的工作。

一旦计算机/软件概念和术语开始渗入用户和设计师之间的讨论中，你就偏离了轨道。

很多时候，用户会将他们的需求集中在他们当前使用的软件有什么问题或可以改进的地方。随着时间的推移，即使他们也失去了他们的工作和他们用来完成工作的软件之间的区别。

解决这个问题对你来说是一个非常困难、至关重要的问题。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-01-06T14:07:07.827

1.  德尔福的甲骨文

    优点：准确性非常好 缺点：如果你能解释信息，很多人都做不到（经常看到他们想看到的）。还需要恳求，这可能会变得一团糟（与流行的观点相反，你的坟墓不必是 100 只相同类型的牲畜）。

2.  通灵者

    优点：精确到一点。

    缺点：很少见。容易精神不稳定，极易受到可怕生物的攻击，并可能引起他们不必要的注意。此外，需要经验来梳理人类思维的奥秘，以获得所需的信息。有时你仍然需要在他们实际做他们需要帮助的事情时探查他们，因为用户撒谎。

3.  种下鼹鼠

    优点：新的小工具。新毒药！计划中的计划中的计划。宝贝是个怪胎秀。除了帮助用户所需的信息之外，您还可能学到各种有趣的东西。

    缺点：昂贵。代理仍有可能会攻击你，或者无法学习任何你无法更简单地学习的东西。如果被发现，组织可能会转手或清算资产，这代表着巨大的资源投资。组织可能会有所回报。

4.  猜测

    优点：带一群想象力和解决问题能力一般到极强的人，给他们喝点酒，并用《捉鬼敢死队》、《小中国的大麻烦》或《大卢博夫斯基》中的一些名言来激励他们。谁知道它会去哪里，但它会很有趣，他们可能会产生一些有趣/有用的东西。

    缺点：满足用户需求的机会比你想象的要高，但不是那么好。

5.  询问用户

    优点：作为流程的一部分，用户感到被赋予了权力。

    缺点：直到他们必须决定任何事情，此时您只能靠自己了。除非用户是一个非常有经验的用户，在这种情况下，他们可能很清楚自己想要什么。不过，这个星球上只有大约 4 个经验丰富的用户，而且没有人知道有谁可以为他们工作。他们可能是神兽。

6.  假装你关心并询问用户（即使你并不真正关心），然后观察他们做任何涉及的关键工作流程/流程/等，并注意他们在做什么。

    优点：你欺骗用户认为他们的意见很重要，这赋予了他们权力，但不会带来任何其他包袱。由于[用户撒谎](http://www.codinghorror.com/blog/archives/001048.html)- 没有故意或恶意的想法 - 您实际上可以看到他们的行动并更好地掌握问题所在，从而为构建解决方案提供更好的基础。此外，你避开了通灵路线，从而避免了一条漫长而曲折的道路，这条路以承诺开始，但以你和通灵者被不属于这个世界的某种可怕的、无法形容的东西吃掉而告终。观察这个过程就像完全是禅宗，这对你的开发者神秘感有好处。

    缺点：没有到 Oracle 的公路旅行（这将是 EPIC）。间谍更性感。小鸡挖间谍。捉鬼敢死队|小中国的大麻烦|大Lewboski可能没有参与。感觉比其他选项更像工作。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-05-17T09:17:31.750

向用户询问功能将促使他们与您讨论功能。

如果您想了解用户*真正*想要什么，那么您就是在谈论了解他们的目标和动机。我发现开始这样做的最简单方法是用户访谈，而不是关于功能，而是关于用户如何使用您的产品和类似产品，他们为什么使用它以及它如何适应他们的生活。

一旦您了解了用户尝试使用您的产品做什么以及他们为什么要这样做，您就可以对人们要求的功能是否是他们真正需要的功能做出明智的判断。

理想情况下，我认为您的问题在于了解用户，而不仅仅是倾听他们的请求。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-05-28T05:46:46.980

这是一个老问题，已经有很多很好的答案，但我想我只是为了将来像我一样通过搜索最终来到这里的人们添加一点个人经验。

如果您的项目不需要尽快获得受众以取得成功（如 web 应用程序），如果它更多是为固定客户或客户类型出售的内部项目或产品，那么我相信您最好赌注是采用 37signals 的方式：首先为您的用户提供他们需要的*绝对最低限度*，以完成最基本的工作周期中最基本的任务，然后倾听他们所说的客观**缺失**的内容，以便他们完成他们的工作好好工作。不是他们*想要*或*希望*它拥有的东西，而是他们真正**需要**的东西。你确定你真正需要的唯一方法就是当你没有它的时候。

我在一个基于 Intranet 的“公司核心”应用程序的开发团队中担任设计师，该应用程序遵循该策略，结果非常好。第一周：每个人都很生气。当它结束时，90%+ 的批准，应用程序仍然简单漂亮。大多数不完全满意的人似乎都明白为什么它不能像他们想要的那样，几乎每个人的主要要求是，无论我们做什么，保持应用程序简单。

同样，如果您正在开发需要首先*吸引*人们的产品或网站，那可能不可行或延迟很多事情。但是，如果您对用户群有一定的控制权或回旋余地，我肯定会推荐这种方法。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2012-11-19T15:57:57.783

你不要求功能。你问问题。痛点。找出他们对当前解决方案的厌恶之处。找出他们的时间吃什么。

当您知道他们不喜欢什么时，您就可以为这些问题构建解决方案。

当你解决真正的问题时，你就是在创造人们会乐意为你花钱的真正产品。

但同样重要的是在你的研究阶段尊重他们。调查仍然很适合做研究，但如果你问他们十几个问题，他们会讨厌你。您需要尊重他们的时间并使用能够吸引他们并留下深刻印象[的调查工具。](http://www.popsurvey.com)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-01-06T02:47:23.037

事实证明，用户不知道他们想要什么。你需要问他们现在的问题是什么——他们对你的软件有什么问题？他们为什么不使用 x 功能和 y 控件？为什么交互 x 对他们有用，而交互 y 让他们试图判断自己的眼睛？

当然，为了能够提出这些问题，您需要进行一些实地研究，看看使用了哪些功能，您的用户展示了哪些模式并分析了这些数据。该分析将为您提供更具体的问题的基础，用户能够果断而准确地回答这些问题。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-01-06T02:47:35.017

用例。

他们将**如何**使用该功能？

它是这样工作的。

*   人们采取行动。我们构建软件来帮助他们采取行动

*   为了采取行动，一个人必须做出决定。我们构建软件来帮助他们做出决定。

*   为了做出决定采取行动，一个人需要信息。我们构建软件来收集和呈现信息。

每个特征都必须是一个动作、一个决定或信息。连接最好是直接的。不会导致决定或行动的信息甚​​至不是“很高兴拥有”——它是垃圾。

用户说了很多。他们**做**什么？他们做出什么**决定**？他们需要什么**信息**？

* * *

*编辑*

请注意，并非每个人都擅长描述用例。有些人没有远见，只会告诉你他们今天做了什么，而不了解他们如何创造商业（或个人）价值。他们可能并不真正知道他们应该做出什么样的决定，并且对他们需要的信息含糊其辞。

其他用户知道他们创造了什么价值，以及为什么，并且可以很好地讨论用例。他们可以设想创造价值的替代方式；他们可以为他们的行动阐明选项。决策没有很多替代实现（人们做出决策，而不是软件），所需的信息也没有太大变化。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-01-06T03:03:12.800

如果你是认真的，你可以在他们的工作中录下他们的视频，然后你分解他们想要完成的事情以及你的产品如何帮助他们。这是称为可用性工程的整个学科的一部分。[Jakob Nielsen 的书可用性工程](http://www.useit.com/jakob/useengbook.html)是对技术的一个很好的介绍。在他成为一个无耻的小贩之前，Jakob 是一位非常优秀的科学家，他学到了很多关于找出用户需求的廉价方法。如果你有预算的话特别好。最让我印象深刻的是使用**纸质原型**；这是模拟您尚未构建的软件的好方法，并有助于回答您关于下一步构建什么的问题。直到我看到这种技术的实际应用，我才相信它会有多么有效。

*PS 如果您只是询问*人们会发生什么情况的一个示例：对于 Microsoft Office 2007 的功能请求中有 90% 是针对 Microsoft Office 2003 中已经存在的功能。在这种情况下，用户需要的是更好的方法来查找已经存在的功能。我希望我能找到我在哪里读到这个......很抱歉没有参考。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-01-06T03:09:26.330

根据您的措辞，我假设您正在构建要销售的产品，而不是为特定客户构建要订购的东西。

在这种情况下，我会说您应该首先自己成为用户并以您想要的方式构建您需要的功能。随着产品的发展，您将需要其他用户的反馈，但这至少可以让您开始并打破鸡蛋-鸡蛋循环。

至于衡量功能的实际使用情况，您可以建立一个讨论论坛来获得有关您添加的功能的反馈……如果您时间紧迫，您不需要太复杂的东西。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-01-06T03:19:38.867

我个人喜欢客户的不干涉方法。他们给你高水平的要求，你提供实施。您的软件团队/公司/部门应该是专家。当然你会犯一些错误，如果它很糟糕，客户会提出来并且你会修复它，但通常让你和你的开发人员来解决它是一个有趣的困境。

研究，研究，研究。向其他设计学习，然后制作自己的超棒设计。不容易，但话说回来，他们不会无缘无故地向开发人员支付大笔费用。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-01-06T03:34:10.257

这是个好问题。

如果你正在构建一个 FPS 游戏，你真的需要自己知道应该包含哪些内容，因为 99% 的用户永远不会联系你说“我希望你的游戏只有 X”。经验丰富的 beta 测试团队可以在这里提供帮助。

如果您正在编写一个会计应用程序，您需要了解行业以及用户在使用您的产品时试图完成什么，并尝试将您的功能集集中在这些目标上。

如果您正在为一个企业中的 100 个用户编写自定义应用程序，您可以与该软件的十几个最狂热的用户聊天。他们从头到尾了解所有表单，发现了所有未记录的快捷键，并且还弄清楚了如何规避您的许多数据验证规则。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2009-01-06T05:06:39.493

想象你是他们

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2009-01-06T13:18:40.703

1.  看他们。
2.  找出他们工作中的瓶颈
3.  创建以优雅的方式解决瓶颈的东西
4.  让他们使用它
5.  重复直到每个人都开心

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2009-01-06T13:30:58.227

基于以下原则：

1.  用户知道他们想要什么，但他们不知道他们真正**需要**什么。
2.  你永远不会第一次就做好。

这似乎是一个先有鸡还是先有蛋的问题。很像计算 PageRank。页面的页面排名取决于链接到该页面的其他页面的 PageRank。计算 PageRank 的一种方法是迭代。

迭代是关键！

**A. 投票**

1.  收集所有用户想要的功能的大列表（让他们列举他们想要的每个功能）。

2.  然后让他们查看列表并允许他们对功能进行投票。比如说，给他们 100 分来分配特征。他们可以给一个功能超过 1 分。

**B. 分析**

分析商业模式，列出你认为需要的功能。这是必需的，因为：

*   用户有时无法了解全局
*   你有这个非常棒的想法，用户在亿万年之后都不会想到。

**C. 实施**

从 A 和 B 分析列表，合并，删除一些，*改进*一些。实施。

**D. 测试**

对用户进行测试。听听他们的抱怨。看看 - 他们经常使用的功能 - 他们卡住的东西 - 等等等等

**E. 迭代**

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2009-05-17T09:29:27.090

通常，用户并不总是知道他们想要什么以及他们是否想要任何东西。在我们公司，销售人员会去找现有的和潜在的客户，向他们展示我们的产品，并解释他们为什么迫切需要这样的产品。

在我上大学的时候，我们被教导了一种叫做“userp-driven development”的东西。在这里，你真的必须去拜访客户，观察那里的人们是如何工作的，他们使用什么工具，并试图找出什么可以促进他们的生活。然后您创建一个模型，再次访问客户，将其展示给用户，获得他们的反馈，然后继续改进您的模型。当每个人或多或少都同意行动方案时，你就会执行，定期向客户展示你试图尽早获得更正反馈的内容。

重要的是不要与想要该产品的经理交谈，而是与将使用该产品的用户交谈。否则整部戏什么都不会带给你。

PS直接问他们“你想要什么？” 可能是一个危险的问题... [巴比伦 5 - 你想要什么？](http://www.youtube.com/watch?v=MUYpUMaEI88)

* * *

## 回答 #27

> 赞同：-2
> 
> 时间：2009-01-06T03:41:49.773

它被称为市场研究。

不，这不是在挖那个家伙，这就是它的真正意义所在。当然，UCD 人员在该领域使用大量技术来获取用户需求，但它们与市场研究人员使用的工具完全相同。卡片分类、优先级列表等都是市场研究术语。

# silverlight - silverlight：从 RowDetailsVisibilityChanged 设置 RowDetailsTemplate 控件

> ID：415268
> 
> 赞同：2
> 
> 时间：2009-01-06T02:43:37.130
> 
> 标签：silverlight

给定一个带有 RowDetailsVisibilityMode="VisibleWhenSelected" 的 silverlight 数据网格，在单击数据网格中的一行时，如何设置或绑定 RowDetailsVisibilityChanged() 事件中的控件？

```
 <data:DataGrid.RowDetailsTemplate>
            <DataTemplate>
                <StackPanel>
                    <TextBlock Text="a" x:Name="_txt" />
                    <ListBox x:Name="_lst"></ListBox>
                </StackPanel>
            </DataTemplate>
        </data:DataGrid.RowDetailsTemplate> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-12-18T22:20:21.683

您无需编写 rowsvisibilitychanged 事件，如果您在数据模板中设置绑定，Silverlight 会自动为您执行绑定。只需使用 {Binding col_name}。

一个简化的示例，绑定会在用户单击一行时自动发生。

```
<sdk:DataGrid RowDetailsVisibilityMode='VisibleWhenSelected'
              ItemsSource='{Binding ElementName=ld_linkDomainDataSource, Path=Data}'>

<data:DataGrid.RowDetailsTemplate>
        <DataTemplate>
            <StackPanel>
                <TextBlock Text='Link Name: '/>
                <TextBox Text='{Binding link_name}'/>   <-- column from ItemsSource
            </StackPanel>
        </DataTemplate>
    </data:DataGrid.RowDetailsTemplate> 
```

# linux - 在 Debian Linux 中安装和链接 PhysX 库

> ID：415279
> 
> 赞同：2
> 
> 时间：2009-01-06T02:47:37.340
> 
> 标签：linux, ubuntu, linker, debian

我正在尝试让 PhysX 使用 Ubuntu 工作。

首先，我在这里下载了 SDK：

*   [http://developer.download.nvidia.com/PhysX/2.8.1/PhysX_2.8.1_SDK_CoreLinux_deb.tar.gz](http://developer.download.nvidia.com/PhysX/2.8.1/PhysX_2.8.1_SDK_CoreLinux_deb.tar.gz)

* * *

接下来，我提取了文件并安装了每个包：

```
dpkg -i filename.deb 
```

这给了我位于 /usr/lib/PhysX/v2.8.1 中的以下文件：

*   libNxCharacter.so
*   libNxCooking.so
*   libPhysXCore.so
*   libNxCharacter.so.1
*   libNxCooking.so.1
*   libPhysXCore.so.1

* * *

接下来，我创建了指向 /usr/lib 的符号链接：

```
sudo ln -s /usr/lib/PhysX/v2.8.1/libNxCharacter.so.1 /usr/lib/libNxCharacter.so.1
sudo ln -s /usr/lib/PhysX/v2.8.1/libNxCooking.so.1 /usr/lib/libNxCooking.so.1
sudo ln -s /usr/lib/PhysX/v2.8.1/libPhysXCore.so.1 /usr/lib/libPhysXCore.so.1 
```

* * *

现在，使用 Eclipse，我指定了以下库 (-l)：

*   libNxCharacter.so.1
*   libNxCooking.so.1
*   libPhysXCore.so.1

以下搜索路径以防万一（-L）：

*   /usr/lib/PhysX/v2.8.1
*   /usr/lib

此外，正如 Gerald Kaszuba 所建议的，我添加了以下包含路径 (-I)：

*   /usr/lib/PhysX/v2.8.1
*   /usr/lib

* * *

然后，我尝试编译以下代码：

```
#include "NxPhysics.h"

NxPhysicsSDK* gPhysicsSDK = NULL;
NxScene* gScene = NULL;
NxVec3 gDefaultGravity(0,-9.8,0);

void InitNx()
{
    gPhysicsSDK = NxCreatePhysicsSDK(NX_PHYSICS_SDK_VERSION);

    if (!gPhysicsSDK)
    {
        std::cout<<"Error"<<std::endl;
        return;
    }

    NxSceneDesc sceneDesc;
    sceneDesc.gravity = gDefaultGravity;
    gScene = gPhysicsSDK->createScene(sceneDesc);
}

int main(int arc, char** argv)
{
    InitNx();

    return 0;
} 
```

我得到的第一个错误是：

> NxPhysics.h：没有这样的文件或目录

这告诉我该项目显然没有正确链接。谁能告诉我我做错了什么，或者我还需要做什么才能让我的项目编译？我正在使用 GCC C++ 编译器。提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-06T04:38:18.600

看起来您将头文件与库文件混淆了。NxPhysics.h 是一个源代码头文件。编译源代码时需要头文件（链接时不需要）。它可能位于 /usr/include 或 /usr/include/PhysX/v2.8.1 或类似位置。正如 Gerald Kaszuba 建议的那样，找到这个文件的真实位置并确保使用 -I 选项告诉编译器它在哪里。

链接编译的目标文件时（而不是编译时）需要这些库。稍后您需要使用 -L 和 -l 选项来处理这个问题。

注意：根据您调用 gcc 的方式，您可以让它编译然后通过单个调用链接，但在幕后它仍然执行编译步骤然后是链接步骤。

* * *

**编辑：**添加了额外的解释......

使用 C/C++ 编译器构建二进制文件时，编译器会读取源代码（.c 或 .cpp 文件）。在阅读它时，经常会出现用于读取 .h 文件的 #include 语句。#include 语句给出了必须加载的文件的名称。这些确切的文件必须存在于包含路径中。在您的情况下，必须在包含路径中的某处找到具有确切名称“NxPhysics.h”的文件。通常，/usr/include 默认位于路径中，当前目录也是如此。如果头文件位于其他位置，例如 /usr/include 的子目录，那么您始终需要使用 -I 命令行开关（或有时使用环境变量或其他系统配置方法）明确告诉编译器在哪里查找。

.h 头文件通常包括数据结构声明、内联函数定义、函数和类声明以及#define 宏。编译完成后，会创建一个 .o 目标文件。编译器不知道 .so 或 .a 库并且不能以任何方式使用它们，除了为链接器嵌入一点帮助信息。请注意，编译器还在目标文件中嵌入了一些“头”信息。我将“标题”放在引号中，因为该信息仅大致对应于 .h 文件中可能存在或不存在的内容。它包括所有导出声明的二进制表示。那里没有找到宏。我相信内联函数也被省略了（尽管我可能错了）。

一旦所有 .o 文件都存在，就该由另一个程序接管了：链接器。链接器对源代码文件或 .h 头文件一无所知。它只关心二进制库和目标文件。你给它一个库和目标文件的集合。在他们的“标题”中，他们列出了他们定义的内容（数据类型、函数等）以及他们需要其他人定义的内容。然后，链接器将来自一个模块的定义请求与其他模块的实际定义进行匹配。它会检查以确保没有多个冲突的定义，并且如果构建可执行文件，它会确保满足所有对定义的请求。

上述描述有一些值得注意的警告。首先，可以调用一次 gcc 并让它同时进行编译和链接，例如

```
gcc hello.c -o hello 
```

将首先将 hello.c 编译到内存或临时文件，然后将链接到标准库并写出 hello 可执行文件。尽管它只是对 gcc 的一次调用，但为了方便您，这两个步骤仍然按顺序执行。我现在将跳过描述动态库的一些细节。

如果您是 Java 程序员，那么上面的一些内容可能会有点令人困惑。我相信 .net 像 Java 一样工作，所以下面的讨论应该适用于 C# 和其他 .net 语言。Java 在语法上是一种比 C 和 C++ 简单得多的语言。它缺少宏，也缺少真正的模板（泛型是模板的一种非常弱的形式）。因此，Java 不需要单独的声明 (.h) 和定义 (.c) 文件。它还能够将所有相关信息嵌入到目标文件（Java 的.class）中。这使得编译器和链接器都可以直接使用 .class 文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-06T08:17:26.380

问题确实出在我的包含路径上。以下是相关命令：

```
g++ -I/usr/include/PhysX/v2.8.1/SDKs/PhysXLoader/include -I/usr/include -I/usr/include/PhysX/v2.8.1/LowLevel/API/include -I/usr/include/PhysX/v2.8.1/LowLevel/hlcommon/include -I/usr/include/PhysX/v2.8.1/SDKs/Foundation/include -I/usr/include/PhysX/v2.8.1/SDKs/Cooking/include -I/usr/include/PhysX/v2.8.1/SDKs/NxCharacter/include -I/usr/include/PhysX/v2.8.1/SDKs/Physics/include -O0 -g3 -DNX_DISABLE_FLUIDS -DLINUX -Wall -c -fmessage-length=0 -MMD -MP -MF"main.d" -MT"main.d" -o"main.o" "../main.cpp" 
```

此外，对于链接器，只需要“PhysXLoader”（与 Windows 相同）。因此，我有：

```
g++  -o"PhysXSetupTest"  ./main.o   -lglut -lPhysXLoader 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-02-22T18:35:21.477

安装时出现以下错误 *

```
dpkg: dependency problems prevent configuration of libphysx-dev-2.8.1:
 libphysx-dev-2.8.1 depends on libphysx-2.8.1 (= 2.8.1-4); however:
  Package libphysx-2.8.1 is not configured yet.
dpkg: error processing libphysx-dev-2.8.1 (--install):
 dependency problems - leaving unconfigured
Errors were encountered while processing: 
```

* 所以我重新安装了 *libphysx-2.8.1_4_i386.deb*

```
sudo dpkg -i libphysx-2.8.1_4_i386.deb 
```

# ruby-on-rails - 在迁移中添加行

> ID：415287
> 
> 赞同：22
> 
> 时间：2009-01-06T02:51:21.920
> 
> 标签：ruby-on-rails, database, migration

我想知道在 Rails 迁移中向数据库表添加记录的首选方法是哪种。我读过 Ola Bini 的书（Jruby on Rails），他做了这样的事情：

```
class CreateProductCategories < ActiveRecord::Migration

  #defines the AR class
  class ProductType < ActiveRecord::Base; end

  def self.up

    #CREATE THE TABLES...

    load_data
  end
  def self.load_data
    #Use AR object to create default data
    ProductType.create(:name => "type")
  end
end 
```

这很好而且很干净，但由于某种原因，它不适用于最新版本的导轨......

问题是，如何使用默认数据（如用户或其他内容）填充数据库？

谢谢！

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-03-07T11:36:25.140

用于迁移的 Rails API 文档显示了实现此目的的更简单方法。

[http://api.rubyonrails.org/classes/ActiveRecord/Migration.html](http://api.rubyonrails.org/classes/ActiveRecord/Migration.html)

```
class CreateProductCategories < ActiveRecord::Migration
  def self.up
    create_table "product_categories" do |t|
      t.string name
      # etc.
    end

    # Now populate the category list with default data

    ProductCategory.create :name => 'Books', ...
    ProductCategory.create :name => 'Games', ... # Etc.

    # The "down" method takes care of the data because it
    # drops the whole table.

  end

  def self.down
    drop_table "product_categories"
  end
end 
```

在 Rails 2.3.0 上测试，但这也适用于许多早期版本。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-07T00:05:06.903

您可以为此使用固定装置。这意味着在某处有一个 yaml 文件，其中包含您要插入的数据。

这是我在我的一个应用程序中为此提交的变更集：

`db/migrate/004_load_profiles.rb`

```
require 'active_record/fixtures'

class LoadProfiles < ActiveRecord::Migration
  def self.up
    down()

    directory = File.join(File.dirname(__FILE__), "init_data")
    Fixtures.create_fixtures(directory, "profiles")
  end

  def self.down
    Profile.delete_all
  end
end 
```

`db/migrate/init_data/profiles.yaml`

```
admin:
 name: Admin
  value: 1
normal:
 name: Normal user
  value: 2 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-03-19T15:22:30.087

你也可以在你的 seed.rb 文件中定义，例如：

```
Grid.create :ref_code => 'one' , :name => 'Grade Única' 
```

运行后：

```
rake db:seed 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-06T23:49:06.000

您的迁移可以访问您的所有模型，因此您不应该在迁移中创建类。

我正在使用最新的 rails，我可以确认您发布的示例肯定可以工作。

然而，迁移是一种特殊的野兽。只要你清楚，我看不出有什么问题`ActiveRecord::Base.connection.execute("INSERT INTO product_types (name) VALUES ('type1'), ('type2')")`。

这样做的好处是，您可以通过使用某种 GUI 或 Web 前端来填充您的起始数据，然后执行`mysqldump -uroot database_name.product_types`.

对于那些将要执行迁移和维护产品的人来说，无论什么使事情变得最容易。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-10-11T22:15:52.970

你真的不应该使用

```
ProductType.create 
```

在您的迁移中。

我做过类似的事情，但从长远来看，它们不能保证有效。

当您运行迁移时，您正在使用的模型类是您运行迁移时的模型类，而不是您创建迁移时的模型类。您必须确保永远不会以阻止迁移运行的方式更改模型。

你最好运行 SQL，例如：

```
[{name: 'Type', ..}, .. ].each do |type|
  execute("INSERT INTO product_types (name) VALUES ('#{type[:name]} .. )
end 
```

# c# - 在 C# 中组合两个或多个字节数组的最佳方法

> ID：415291
> 
> 赞同：266
> 
> 时间：2009-01-06T02:54:33.817
> 
> 标签：c#, arrays

我在 C# 中有 3 个字节数组，我需要将它们合并为一个。完成这项任务的最有效方法是什么？

* * *

## 回答 #1

> 赞同：351
> 
> 时间：2009-01-06T03:53:10.500

对于原始类型（包括字节），使用[`System.Buffer.BlockCopy`](https://docs.microsoft.com/en-us/dotnet/api/system.buffer.blockcopy)代替[`System.Array.Copy`](https://docs.microsoft.com/en-us/dotnet/api/system.array.copy). 它更快。

我使用 3 个每个 10 字节的数组在一个循环中对每个建议的方法进行了 100 万次的计时。结果如下：

1.  新字节数组使用`System.Array.Copy` - 0.2187556 秒
2.  新字节数组使用`System.Buffer.BlockCopy` - 0.1406286 秒
3.  IEnumerable<byte> 使用 C# yield 运算符 - 0.0781270 秒
4.  IEnumerable<byte> 使用 LINQ 的 Concat<> - 0.0781270 秒

我将每个数组的大小增加到 100 个元素并重新运行测试：

1.  新字节数组使用`System.Array.Copy` - 0.2812554 秒
2.  新字节数组使用`System.Buffer.BlockCopy` - 0.2500048 秒
3.  IEnumerable<byte> 使用 C# yield 运算符 - 0.0625012 秒
4.  IEnumerable<byte> 使用 LINQ 的 Concat<> - 0.0781265 秒

我将每个数组的大小增加到 1000 个元素并重新运行测试：

1.  新字节数组使用`System.Array.Copy` - 1.0781457 秒
2.  新字节数组使用`System.Buffer.BlockCopy` - 1.0156445 秒
3.  IEnumerable<byte> 使用 C# yield 运算符 - 0.0625012 秒
4.  IEnumerable<byte> 使用 LINQ 的 Concat<> - 0.0781265 秒

最后，我将每个数组的大小增加到 100 万个元素并重新运行测试，每个循环**仅**执行4000 次：

1.  新字节数组使用`System.Array.Copy` - 13.4533833 秒
2.  新字节数组使用`System.Buffer.BlockCopy` - 13.1096267 秒
3.  IEnumerable<byte> 使用 C# yield 运算符 - 0 秒
4.  IEnumerable<byte> 使用 LINQ 的 Concat<> - 0 秒

因此，如果您需要一个新的字节数组，请使用

```
byte[] rv = new byte[a1.Length + a2.Length + a3.Length];
System.Buffer.BlockCopy(a1, 0, rv, 0, a1.Length);
System.Buffer.BlockCopy(a2, 0, rv, a1.Length, a2.Length);
System.Buffer.BlockCopy(a3, 0, rv, a1.Length + a2.Length, a3.Length); 
```

但是，如果您可以使用`IEnumerable<byte>`，***肯定***更喜欢 LINQ 的 Concat<> 方法。它仅比 C# yield 运算符稍慢，但更简洁、更优雅。

```
IEnumerable<byte> rv = a1.Concat(a2).Concat(a3); 
```

如果您有任意数量的数组并使用 .NET 3.5，则可以使`System.Buffer.BlockCopy`解决方案更通用，如下所示：

```
private byte[] Combine(params byte[][] arrays)
{
    byte[] rv = new byte[arrays.Sum(a => a.Length)];
    int offset = 0;
    foreach (byte[] array in arrays) {
        System.Buffer.BlockCopy(array, 0, rv, offset, array.Length);
        offset += array.Length;
    }
    return rv;
} 
```

*注意：上面的块需要您在顶部添加以下命名空间才能工作。

```
using System.Linq; 
```

对于 Jon Skeet 关于后续数据结构（字节数组与 IEnumerable<byte>）的迭代的观点，我重新运行了最后一次时序测试（100 万个元素，4000 次迭代），添加了一个循环遍历整个数组，每个经过：

1.  新字节数组使用`System.Array.Copy` - 78.20550510 秒
2.  新字节数组使用`System.Buffer.BlockCopy` - 77.89261900 秒
3.  IEnumerable<byte> 使用 C# yield 运算符 - 551.7150161 秒
4.  IEnumerable<byte> 使用 LINQ 的 Concat<> - 448.1804799 秒

关键是，了解结果数据结构的创建*和使用的效率****非常重要。***仅仅关注创造的效率可能会忽略与使用相关的低效率。荣誉，乔恩。

 ** * *

## 回答 #2

> 赞同：169
> 
> 时间：2009-01-06T08:39:46.117

在我看来，许多答案都忽略了规定的要求：

*   结果应该是一个字节数组
*   它应该尽可能高效

这两个一起排除了一个 LINQ 字节序列 - 任何东西`yield`都将使在不遍历整个序列的情况下无法获得最终大小。

如果这些当然不是*真正的*要求，那么 LINQ 可能是一个非常好的解决方案（或`IList<T>`实现）。但是，我假设 Superdumbell 知道他想要什么。

（编辑：我刚刚有了另一个想法。制作数组的副本和懒惰地读取它们之间存在很大的语义差异。考虑一下如果在调用`Combine`（或其他）之后更改其中一个“源”数组中的数据会发生什么) 方法，但在使用结果之前 - 使用惰性评估，该更改将是可见的。使用立即复制，它不会。不同的情况将需要不同的行为 - 只是需要注意的事情。）

这是我提出的方法-当然与其他一些答案中包含的方法非常相似：)

```
public static byte[] Combine(byte[] first, byte[] second)
{
    byte[] ret = new byte[first.Length + second.Length];
    Buffer.BlockCopy(first, 0, ret, 0, first.Length);
    Buffer.BlockCopy(second, 0, ret, first.Length, second.Length);
    return ret;
}

public static byte[] Combine(byte[] first, byte[] second, byte[] third)
{
    byte[] ret = new byte[first.Length + second.Length + third.Length];
    Buffer.BlockCopy(first, 0, ret, 0, first.Length);
    Buffer.BlockCopy(second, 0, ret, first.Length, second.Length);
    Buffer.BlockCopy(third, 0, ret, first.Length + second.Length,
                     third.Length);
    return ret;
}

public static byte[] Combine(params byte[][] arrays)
{
    byte[] ret = new byte[arrays.Sum(x => x.Length)];
    int offset = 0;
    foreach (byte[] data in arrays)
    {
        Buffer.BlockCopy(data, 0, ret, offset, data.Length);
        offset += data.Length;
    }
    return ret;
} 
```

当然，“params”版本需要首先创建一个字节数组的数组，这会带来额外的低效率。

* * *

## 回答 #3

> 赞同：52
> 
> 时间：2014-10-16T19:25:19.703

我将 Matt 的 LINQ 示例进一步提高了代码的简洁性：

```
byte[] rv = a1.Concat(a2).Concat(a3).ToArray(); 
```

就我而言，阵列很小，所以我不关心性能。

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2009-01-06T03:03:12.300

如果您只需要一个新的字节数组，请使用以下内容：

```
byte[] Combine(byte[] a1, byte[] a2, byte[] a3)
{
    byte[] ret = new byte[a1.Length + a2.Length + a3.Length];
    Array.Copy(a1, 0, ret, 0, a1.Length);
    Array.Copy(a2, 0, ret, a1.Length, a2.Length);
    Array.Copy(a3, 0, ret, a1.Length + a2.Length, a3.Length);
    return ret;
} 
```

或者，如果您只需要一个 IEnumerable，请考虑使用 C# 2.0 yield 运算符：

```
IEnumerable<byte> Combine(byte[] a1, byte[] a2, byte[] a3)
{
    foreach (byte b in a1)
        yield return b;
    foreach (byte b in a2)
        yield return b;
    foreach (byte b in a3)
        yield return b;
} 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2015-08-13T15:30:13.870

实际上，我在使用 Concat 时遇到了一些问题......（有 1000 万个数组，它实际上崩溃了）。

我发现以下内容很简单，容易并且运行良好而不会让我崩溃，它适用于任意数量的数组（不仅仅是三个）（它使用 LINQ）：

```
public static byte[] ConcatByteArrays(params byte[][]  arrays)
{
    return arrays.SelectMany(x => x).ToArray();
} 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2010-05-14T12:49:24.800

memorystream 类对我来说很好地完成了这项工作。我无法让缓冲区类像内存流一样快地运行。

```
using (MemoryStream ms = new MemoryStream())
{
  ms.Write(BitConverter.GetBytes(22),0,4);
  ms.Write(BitConverter.GetBytes(44),0,4);
  ms.ToArray();
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-12-10T17:20:42.180

```
 public static byte[] Concat(params byte[][] arrays) {
        using (var mem = new MemoryStream(arrays.Sum(a => a.Length))) {
            foreach (var array in arrays) {
                mem.Write(array, 0, array.Length);
            }
            return mem.ToArray();
        }
    } 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-04-13T06:11:56.963

```
 public static bool MyConcat<T>(ref T[] base_arr, ref T[] add_arr)
    {
        try
        {
            int base_size = base_arr.Length;
            int size_T = System.Runtime.InteropServices.Marshal.SizeOf(base_arr[0]);
            Array.Resize(ref base_arr, base_size + add_arr.Length);
            Buffer.BlockCopy(add_arr, 0, base_arr, base_size * size_T, add_arr.Length * size_T);
        }
        catch (IndexOutOfRangeException ioor)
        {
            MessageBox.Show(ioor.Message);
            return false;
        }
        return true;
    } 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2018-06-20T20:12:24.700

可以使用泛型来组合数组。以下代码可以轻松扩展为三个数组。这样，您永远不需要为不同类型的数组复制代码。上面的一些答案对我来说似乎过于复杂。

```
private static T[] CombineTwoArrays<T>(T[] a1, T[] a2)
    {
        T[] arrayCombined = new T[a1.Length + a2.Length];
        Array.Copy(a1, 0, arrayCombined, 0, a1.Length);
        Array.Copy(a2, 0, arrayCombined, a1.Length, a2.Length);
        return arrayCombined;
    } 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2020-05-10T03:59:00.677

```
 /// <summary>
    /// Combine two Arrays with offset and count
    /// </summary>
    /// <param name="src1"></param>
    /// <param name="offset1"></param>
    /// <param name="count1"></param>
    /// <param name="src2"></param>
    /// <param name="offset2"></param>
    /// <param name="count2"></param>
    /// <returns></returns>
    public static T[] Combine<T>(this T[] src1, int offset1, int count1, T[] src2, int offset2, int count2) 
        => Enumerable.Range(0, count1 + count2).Select(a => (a < count1) ? src1[offset1 + a] : src2[offset2 + a - count1]).ToArray(); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-01-29T09:25:58.380

这是@Jon Skeet 提供的答案的概括。基本相同，只是它可用于任何类型的数组，而不仅仅是字节：

```
public static T[] Combine<T>(T[] first, T[] second)
{
    T[] ret = new T[first.Length + second.Length];
    Buffer.BlockCopy(first, 0, ret, 0, first.Length);
    Buffer.BlockCopy(second, 0, ret, first.Length, second.Length);
    return ret;
}

public static T[] Combine<T>(T[] first, T[] second, T[] third)
{
    T[] ret = new T[first.Length + second.Length + third.Length];
    Buffer.BlockCopy(first, 0, ret, 0, first.Length);
    Buffer.BlockCopy(second, 0, ret, first.Length, second.Length);
    Buffer.BlockCopy(third, 0, ret, first.Length + second.Length,
                     third.Length);
    return ret;
}

public static T[] Combine<T>(params T[][] arrays)
{
    T[] ret = new T[arrays.Sum(x => x.Length)];
    int offset = 0;
    foreach (T[] data in arrays)
    {
        Buffer.BlockCopy(data, 0, ret, offset, data.Length);
        offset += data.Length;
    }
    return ret;
} 
```

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2017-07-27T13:03:25.930

您只需要传递字节数组列表，此函数将返回字节数组（合并）。这是我认为最好的解决方案:)。

```
public static byte[] CombineMultipleByteArrays(List<byte[]> lstByteArray)
        {
            using (var ms = new MemoryStream())
            {
                using (var doc = new iTextSharp.text.Document())
                {
                    using (var copy = new PdfSmartCopy(doc, ms))
                    {
                        doc.Open();
                        foreach (var p in lstByteArray)
                        {
                            using (var reader = new PdfReader(p))
                            {
                                copy.AddDocument(reader);
                            }
                        }

                        doc.Close();
                    }
                }
                return ms.ToArray();
            }
        } 
```

* * *

## 回答 #13

> 赞同：-5
> 
> 时间：2009-01-06T05:33:11.937

Concat 是正确的答案，但出于某种原因，手动操作获得了最多的选票。如果您喜欢这个答案，也许您会更喜欢这个更通用的解决方案：

```
 IEnumerable<byte> Combine(params byte[][] arrays)
    {
        foreach (byte[] a in arrays)
            foreach (byte b in a)
                yield return b;
    } 
```

这会让你做这样的事情：

```
 byte[] c = Combine(new byte[] { 0, 1, 2 }, new byte[] { 3, 4, 5 }).ToArray(); 
```

# perl - Perl 的 shift 与 @_ 子程序参数的赋值之间有区别吗？

> ID：415297
> 
> 赞同：15
> 
> 时间：2009-01-06T02:58:38.940
> 
> 标签：perl, parameters, subroutine

让我们暂时忽略 Damian Conway 对于任何给定子程序不超过三个位置参数的最佳实践。

下面的两个示例在性能或功能方面有什么区别吗？

使用`shift`：

```
sub do_something_fantastical {
    my $foo   = shift;
    my $bar   = shift;
    my $baz   = shift;
    my $qux   = shift;
    my $quux  = shift;
    my $corge = shift;
} 
```

使用`@_`：

```
sub do_something_fantastical {
    my ($foo, $bar, $baz, $qux, $quux, $corge) = @_;
} 
```

假设这两个示例在性能和功能方面是相同的，那么人们如何看待一种格式而不是另一种格式？显然，使用的示例代码行数更少，但是像另一个示例中所示的那样`@_`使用不是更易读吗？`shift`欢迎有充分理由的意见。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-01-06T06:54:26.063

有功能上的区别。[shift](http://perldoc.perl.org/functions/shift.html)会修改，而 from的`@_`赋值`@_`不会。如果您以后不需要使用`@_`，那么这种差异对您来说可能并不重要。我尝试始终使用列表分配，但有时我使用`shift`.

但是，如果我从 开始`shift`，像这样：

```
 my( $param ) = shift; 
```

我经常创建这个错误：

```
 my( $param, $other_param ) = shift; 
```

那是因为我不`shift`经常使用它，所以我忘记到作业的右侧将其更改为`@_`. 这就是不使用`shift`. `shift`我可以像您在示例中所做的那样为每个行单独制作，但这很乏味。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-01-06T05:50:39.093

至少在我的系统上，它似乎取决于 Perl 的版本和架构：

```
#!/usr/bin/perl -w
use strict;
use warnings;
use autodie;

use Benchmark qw( cmpthese );

print "Using Perl $] under $^O\n\n";

cmpthese(
    -1,
    {
        shifted   => 'call( \&shifted )',
        list_copy => 'call( \&list_copy )',
    }
);

sub call {
    $_[0]->(1..6);  # Call our sub with six dummy args.
}

sub shifted {
    my $foo   = shift;
    my $bar   = shift;
    my $baz   = shift;
    my $qux   = shift;
    my $quux  = shift;
    my $corge = shift;

    return;
}

sub list_copy {
    my ($foo, $bar, $baz, $qux, $quux, $corge) = @_;
    return;
} 
```

结果：

```
Using Perl 5.008008 under cygwin

              Rate   shifted list_copy
shifted   492062/s        --      -10%
list_copy 547589/s       11%        --

Using Perl 5.010000 under MSWin32

              Rate list_copy   shifted
list_copy 416767/s        --       -5%
shifted   436906/s        5%        --

Using Perl 5.008008 under MSWin32

              Rate   shifted list_copy
shifted   456435/s        --      -19%
list_copy 563106/s       23%        --

Using Perl 5.008008 under linux

              Rate   shifted list_copy
shifted   330830/s        --      -17%
list_copy 398222/s       20%        -- 
```

所以看起来 list_copy 通常比移位快 20%，除了在 Perl 5.10 下，移位实际上稍微快一点！

请注意，这些是快速得出的结果。实际速度差异将比此处列出的*更大*，因为 Benchmark 还会计算调用和返回子程序所花费的时间，这将对结果产生调节作用。我没有进行任何调查来查看 Perl 是否进行了任何特殊类型的优化。你的旅费可能会改变。

*保罗*

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-06T03:50:30.163

我会想象 shift 示例比使用 @_ 慢，因为它是 6 个函数调用而不是 1 个。它是否明显甚至可测量是另一个问题。将每个循环放入 10k 次迭代并计时。

至于美学，我更喜欢@_ 方法。使用 shift 方法意外剪切和粘贴似乎太容易弄乱变量的顺序。另外，我见过很多人这样做：

```
sub do_something {
   my $foo = shift;
   $foo .= ".1";

   my $baz = shift;
   $baz .= ".bak";

   my $bar = shift;
   $bar .= ".a";
} 
```

恕我直言，这非常讨厌并且很容易导致错误，例如，如果您剪切 baz 块并将其粘贴在 bar 块下。我完全赞成在使用它们的位置附近定义变量，但我认为在函数顶部定义传入的变量优先。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-06T03:57:00.603

通常我使用第一个版本。这是因为我通常需要与班次一起进行错误检查，这样更容易编写。说，

```
sub do_something_fantastical {
    my $foo   = shift || die("must have foo");
    my $bar   = shift || 0;  # $bar is optional
    # ...
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-06T04:23:59.300

我更喜欢将 @_ 解压缩为列表（您的第二个示例）。不过，就像 Perl 中的所有内容一样，在某些情况下使用 shift 可能很有用。例如，旨在在基类中被覆盖的 passthru 方法，但您想确保如果它们没有被覆盖，它们仍然可以工作。

```
 package My::Base;
use Moose;
sub override_me { shift; return @_; } 

```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-06T09:54:10.833

我更喜欢使用

```
sub do_something_fantastical {
    my ( $foo, $bar, $baz, $qux, $quux, $corge ) = @_;
} 
```

因为它更具可读性。当这段代码不经常被调用时，它是值得的。在极少数情况下，您希望经常调用 make 函数而不是直接使用 @_ 。它仅对非常短的函数有效，并且您必须确保该函数将来不会发展（一次编写函数）。在这种情况下，我在 5.8.8 中进行了基准测试，单个参数的 shift 比 $_[0] 快，但对于两个参数，使用 $_[0] 和 $_[1] 比 shift、shift 快。

```
sub fast1 { shift->call(@_) }

sub fast2 { $_[0]->call("a", $_[1]) } 
```

但回到你的问题。我也更喜欢以这种方式在一行中对许多参数进行@_赋值

```
sub do_something_fantastical2 {
    my ( $foo, $bar, $baz, @rest ) = @_;
    ...
} 
```

当 Suspect @rest 不会太大时。在其他情况下

```
sub raise {
    my $inc = shift;
    map {$_ + $inc} @_;
}

sub moreSpecial {
    my ($inc, $power) = (shift(), shift());
    map {($_ + $inc) ** $power} @_;
}

sub quadratic {
    my ($a, $b, $c) = splice @_, 0, 3;
    map {$a*$_*$_ + $b*$_ + $c} @_;
} 
```

在极少数情况下，我需要尾调用优化（当然是手动），然后我必须直接使用 @_，而不是短函数值得。

```
sub _switch    #(type, treeNode, transform[, params, ...])
{
    my $type = shift;
    my ( $treeNode, $transform ) = @_;
    unless ( defined $type ) {
        require Data::Dumper;
        die "Broken node: " . Data::Dumper->Dump( $treeNode, ['treeNode'] );
    }
    goto &{ $transform->{$type} }   if exists $transform->{$type};
    goto &{ $transform->{unknown} } if exists $transform->{unknown};
    die "Unknown type $type";
}

sub switchExTree    #(treeNode, transform[, params, ...])
{
    my $treeNode = $_[0];
    unshift @_, $treeNode->{type};    # set type
    goto &_switch;                    # tail call
}

sub switchCompact                     #(treeNode, transform[, params, ...])
{
    my $treeNode = $_[0];
    unshift @_, (%$treeNode)[0];      # set type given as first key
    goto &_switch;                    # tail call
}

sub ExTreeToCompact {
    my $tree = shift;
    return switchExTree( $tree, \%transformExTree2Compact );
}

sub CompactToExTree {
    my $tree = shift;
    return switchCompact( $tree, \%transformCompact2ExTree );
} 
```

其中 %transformExTree2Compact 和 %transformCompact2ExTree 是具有 key 类型和 value 中的 code ref 的哈希值，可以尾调用 switchExTree 或 switchCompact 它自己。但是**这种方法很少真正需要，并且必须让不太值得的大学动用手指**。

总之，可读性和可维护性是必须的，尤其是在 perl 中，@_ 在一行中的分配更好。如果你想设置默认值，你可以在它之后进行。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-07-21T03:42:05.387

恕我直言，最好的方法是两者的轻微混合，如模块中的新功能：

```
our $Class;    
sub new {
    my $Class = shift;
    my %opts = @_;
    my $self = \%opts;
    # validate %opts for correctness
    ...
    bless $self, $Class;
} 
```

然后，构造函数的所有调用参数都作为散列传递，这使得代码比参数列表更具可读性。

另外，就像[brian 说](https://stackoverflow.com/questions/415297/is-there-a-difference-between-perls-shift-versus-assignment-from-for-subrouti/415666#415666)的那样，`@_`变量是未修改的，这在不寻常的情况下很有用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-18T10:53:17.613

我怀疑你是否正在做（粗略的）相当于：

`push @bar, shift @_ for (1 :: $big_number);`

那么你做错了什么。我几乎总是使用这种`my ($foo, $bar) = @_;`形式，因为我用后者多次射击自己的脚......

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-07-21T03:07:12.240

我更喜欢

```
sub factorial{
  my($n) = @_;

  ...

} 
```

原因很简单，当我去使用 Komodo 时，它将能够告诉我参数是什么。

# javascript - 为什么这是错误的？（在 jQuery 中使用“this”）

> ID：415302
> 
> 赞同：2
> 
> 时间：2009-01-06T03:00:45.147
> 
> 标签：javascript, jquery

```
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.js"></script>
<script type="text/javascript">

        function bigtosmalltriangle() {
            $(this).siblings("div.break").removeClass('triangle3').addClass('triangle1');
            setTimeout ( "smalltomediumtriangle()", 400 );
        }
        function smalltomediumtriangle() {
            $(this).siblings("div.break").removeClass('triangle1').addClass('triangle2');
            setTimeout ( "mediumtobigtriangle()", 400 );
        }
        function mediumtobigtriangle() {
            $(this).siblings("div.break").removeClass('triangle2').addClass('triangle3');
            setTimeout ( "bigtosmalltriangle()", 400 );
        }

    $(function() {
        $("span#clickhere").click(
            function() {
                /* do a lot stuff here */ bigtosmalltriangle();
                $(this).hide();
            }
        );
    });
</script>

<style type="text/css">
    .triangle1 {background:#000;}
    .triangle2 {background:red;}
    .triangle3 {background:white;}
</style> 
```

```
<div><div class="break">Hello World</div><span id="clickhere">asdf</span></div> 
```

我试图让 div.break 滚动 3 个 bgcolors，但是当我点击跨度时它没有任何效果。有谁知道我应该怎么做？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-06T04:00:49.610

你想用一个特定的“this”来调用你的函数。我问了一个类似的问题：[Call function with "this"](https://stackoverflow.com/questions/325004/call-function-with-this)。

```
$(function() {
        $("span#clickhere").click(
                function() {
                        /* do a lot stuff here */
                        bigtosmalltriangle.call(this);
                        $(this).hide();
                }
        );
}); 
```

我认为由于闭包（参见 Matthew Crumley 的回答），回调函数本身不需要修改，因为 setTimeout 保持“范围”。不过，我对 Javascript 的了解不足以远程保证这一点。如果我错了，也只需执行`.call(this)`回调函数的技巧。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-06T03:14:11.203

问题是“this”没有绑定到您在 bigtosmalltriangle、smalltomediumtriangle 和 mediumtobigtriangle 函数中单击的跨度。您需要将元素作为参数传递，或者通过闭包设置所有函数范围内的变量。

## 参数传递：

```
function bigtosmalltriangle(elements) {
    elements.removeClass('triangle3').addClass('triangle1');
    setTimeout(function() { smalltomediumtriangle(elements); }, 400);
}
function smalltomediumtriangle(elements) {
    elements.removeClass('triangle1').addClass('triangle2');
    setTimeout(function() { mediumtobigtriangle(elements); }, 400);
}
function mediumtobigtriangle(elements) {
    elements.removeClass('triangle2').addClass('triangle3');
    setTimeout(function() { bigtosmalltriangle(elements); }, 400);
}

$(function() {
    $("span#clickhere").click(
        function() {
            /* do a lot stuff here */
            bigtosmalltriangle($(this).siblings("div.break"));
            $(this).hide();
        }
    );
}); 
```

## 闭包：

```
$(function() {
    $("span#clickhere").click(
        function() {
            var elements = $(this).siblings("div.break");

            function bigtosmalltriangle() {
                elements.removeClass('triangle3').addClass('triangle1');
                setTimeout(smalltomediumtriangle, 400);
            }
            function smalltomediumtriangle() {
                elements.removeClass('triangle1').addClass('triangle2');
                setTimeout(mediumtobigtriangle, 400);
            }
            function mediumtobigtriangle() {
                elements.removeClass('triangle2').addClass('triangle3');
                setTimeout(bigtosmalltriangle, 400);
            }

            /* do a lot stuff here */
            bigtosmalltriangle();
            $(this).hide();
        }
    );
}); 
```

# html - 元素在 IE6 中获得 100% 宽度和高度

> ID：415305
> 
> 赞同：0
> 
> 时间：2009-01-06T03:02:31.803
> 
> 标签：html, css, internet-explorer, internet-explorer-6

我正在尝试使用 <ul> 制作链接的水平列表，其中所有 <a> 都是 display:block 并且具有高度。在 IE6 中，在我为 <a> 设置高度后，它会保持 100% 的宽度，使其成为垂直列表。

HTML：

```
<ul id="header">
    <li><a href="#"><span>ST.KILDA ROAD MEDICAL CENTRE</span></a></li>
    <li><a href="#"><span>Public Health Management</span></a></li>
    <li><a href="#"><span>ST.KILDA ROAD PSYCHOLOGY SERVICES</span></a></li>
    <li><a href="#"><span>OCCUPATIONAL ASSISTANCE SERVICE</span></a></li>
    <li><a href="#"><span>ST.KILDA ROAD Sports &amp; Physio</span></a></li>
</ul> 
```

CSS：

```
#header {
    height:1%;
    overflow:hidden;
}
#header li {
    float:left;
}
#header li a, #header li a span {
    display:block;
    height:28px;
} 
```

跨度是一些悬停效果背景图像，我试图删除它和它的样式，问题仍然存在。

Doctype 是 XHTML 1.0 Strict。好吧，我可以让它在 IE6 中工作，只需要填充，但众所周知，垂直填充在 Safari 中的实现方式与其他浏览器不同。

我的问题是我是否有办法为 <a> 保留高度和显示：块（因为背景图像）但没有宽度（我希望项目长度灵活）并在 IE6 中制作水平列表。谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-06T03:35:43.517

浮动子元素可能是您需要的修复：

```
#header li a, #header li a span {
  display:block;
  height:28px;
  float:left;
} 
```

# c# - 大型 asp.net 缓存存储的持久性方法的效率

> ID：415309
> 
> 赞同：6
> 
> 时间：2009-01-06T03:03:15.360
> 
> 标签：c#, asp.net, caching

好奇是否有人对哪种方法更适合 asp.net 缓存有意见。选项一，在缓存中包含较少的更复杂的项目，或许多不太复杂的项目。

为了便于讨论，假设我的网站有 SalesPerson 和 Customer 对象。这些是非常简单的类，但我不想与数据库闲聊，所以我想将它们延迟加载到缓存中，并在我进行更改时使它们从缓存中失效——足够简单。

选项 1 创建字典并缓存整个字典。当我需要从缓存中加载 SalesPerson 的实例时，我会从 Dictionary 中取出并针对 Dictionary 执行正常的键查找。

选项2 为每一项的key加上前缀，直接存储在asp.net缓存中。例如，缓存中的每个 SalesPerson 实例都将使用前缀加上该对象的键的组合，因此它可能看起来像 sp_[guid] 并存储在 asp.net 缓存中，缓存中还有带有像 cust_[guid] 这样的键。

我对选项二的担心之一是条目的数量会变得非常大，在销售人员、客户和十几个其他类别之间，我可能在缓存中有 25K 项，并且对我正在使用的字符串资源之类的东西进行高度重复的查找在代码查看缓存的密钥集合以在其他 25K 中找到它时，在几个地方可能会付出代价。

我确信在某些时候，在缓存中存储太多项目会导致收益递减，但我很好奇对这些问题的看法。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-28T04:48:23.750

您最好在缓存中创建许多更小的项目，而不是创建更少、更大的项目。这是推理：

1）如果您的数据很小，那么缓存中的项目数会比较少，不会有任何区别。从缓存中获取单个实体比获取字典然后从该字典中获取项目更容易。

2）一旦你的数据变大，缓存可以用来以智能的方式管理数据。HttpRuntime.Cache 对象使用最近最少使用 (LRU) 算法来确定缓存中的哪些项目过期。如果缓存中只有少量高使用项，则此算法将毫无用处。但是，如果缓存中有许多较小的项目，但其中 90% 在任何给定时刻都没有使用（非常常见的使用启发式），那么 LRU 算法可以确保那些看到活跃使用的项目保留在缓存中同时驱逐不常用的物品，以确保为使用过的物品留出足够的空间。

As your application grows, the importance of being able to manage what is in the cache will be most important. Also, I've yet to see any performance degradation from having millions of keys in the cache -- hashtables are extremely fast and if you find issues there it's likely easily solved by altering your naming conventions for your cache keys to optimize them for use as hashtable keys.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T06:09:21.490

ASP.NET 缓存使用它自己的字典，因此使用它的字典来定位您的字典以进行查找以检索您的对象似乎不是最佳的。字典使用哈希表，这是您可以进行的最有效的查找。我认为使用自己的字典只会增加更多开销。我不知道关于哈希表的收益递减，但我认为这将是存储大小，而不是查找时间。

我会关心任何能让你的工作更轻松的事情。如果让缓存更有条理将使您的应用程序更易于理解、调试、扩展和维护，那么我会这样做。如果它使这些事情变得更复杂，那么我不会这样做。

正如 nullvoid 所提到的，这一切都假设您已经探索了缓存的更大影响，其中涉及衡量性能增益与性能损失。您正在谈论存储大量对象，这意味着大量缓存流量。我只会在缓存中存储一​​些你可以*衡量*这样做的性能增益的东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-06T11:34:02.333

我们已经构建了一个使用缓存来存储所有资源的应用程序。该应用程序是多语言的，因此对于应用程序中的每个标签，我们至少有三个翻译。我们在第一次需要时加载（标签，文化）组合，然后仅当它由数据库中的管理员更改时才从缓存中过期。即使缓存中包含 100000 个项目，这种情况也能很好地工作。我们只注意配置缓存和过期策略，以便我们真正受益于缓存。我们使用 no-expiration，因此项目会被缓存，直到工作进程被重置或项目故意过期。我们还小心地为键的值定义了一个域，以便用最少的字符唯一地标识特定文化中的标签。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-06T05:46:52.393

我将假设您已经考虑了从多个用户更改数据的所有影响，以及在处理冲突数据方面这将如何影响缓存数据。缓存实际上只适用于相对静态的数据。

从效率的角度来看，我假设如果您正确使用 .net 序列化，您将受益于以更大的类型化序列化集合而不是单个基本类型的形式将数据存储在缓存中。

从维护的角度来看，这也是一种更好的方法，因为您可以创建一个强类型对象来表示数据并使用序列化在缓存和您的销售人员/客户对象之间进行转换。

# flash - Flash 安全性：将 Flash 8 AS2 模块加载到 Flash 6 AS1 模块中时出现问题

> ID：415310
> 
> 赞同：2
> 
> 时间：2009-01-06T03:05:35.433
> 
> 标签：flash, security, loading

我有一个用 Actionscript 1 编写的旧程序，用 Flash 6 编译。它加载了 10 个其他模块，其中 3 个用 Actionscript 2 编写，用 Flash 8 编译。原始程序嵌入到 html 中，当 html 文件时完美运行在网络服务器上运行。但是如果我只是将 html 文件拖到我的浏览器中，3 个 AS2 模块将不会加载。或者，更准确地说，它们确实加载了，但我无法访问它们的功能。所有模块都使用“本地播放安全=仅访问本地文件”编译。我正在使用 Flash CS3 编译所有模块。在不将主加载模块重写为 AS2 的情况下，我能做些什么来解决这个问题？谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-06T03:50:24.687

Flash 安全模型的规则有点神秘，但您似乎遇到了跨脚本限制。一种选择可能是解决它，例如通过安装 Apache（或其他）并通过`http://localhost...`而不是`file://...`. 但是，安全问题也可能得到解决。

首先，您可能想查看[这篇文章](http://www.adobe.com/devnet/flash/articles/fplayer8_security_05.html)，尤其是该页面中间的图表，其中列出了何时允许一个 SWF 访问另一个 SWF 的功能的基本规则。如图所示，使所有访问正常工作的最简单方法是让所有内容在“本地受信任”沙箱中正常运行。如何做到这一点在同一篇文章的[第 4 页的下一部分进行了介绍。](http://www.adobe.com/devnet/flash/articles/fplayer8_security_04.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T10:14:22.493

我不确定这是否与您的问题有关，但混合 AVM1 SWF 文件可能会出现问题。

如果为版本 6 编译闪存 SWF 时未在输出设置中选择“针对版本 6r65 优化”选项，则生成的字节码很大程度上与为 v6r65 或更高版本编译的 AVM1 swf 文件不兼容（尤其是在使用 AS2 语言时，而不是AS1)。

这是因为在为这些早期版本编译时，对 _global 属性的任何引用都指向不同的位置，因此在 _global 命名空间中定义的属性对于针对更高版本的电影是不可见的，反之亦然。

鉴于类定义作为变量驻留在 _global 命名空间中，当混合针对位于 6r65 两侧的版本的 swf 文件时，这可能会产生很大的问题。

我记得通过将其中一个 SWF 文件中的 _global 引用复制到另一个 SWF 文件可见的位置来解决这个问题。

（在 6r65 之前）

```
class SomeClass
{
    //
}
...
_global.someProp=123;

_level0.globalCopy=_global 
```

（在 6r65 后）

```
trace(SomeClass) //undefined
trace(_global.someProp) //undefined
trace(_level0.globalCopy.SomeClass) //[object object] i.e. defined
trace(_level0.globalCopy.someProp) //123 
```

# c# - 在我无法明确调用 Dispose() 的语句中间创建的 IDisposable 对象会发生什么？

> ID：415313
> 
> 赞同：3
> 
> 时间：2009-01-06T03:07:13.947
> 
> 标签：c#, sharepoint, garbage-collection, dispose

假设我正在使用 Sharepoint（这也适用于其他对象模型），并且在我的陈述中间，我调用了一个方法，在本例中为“OpenWeb()”，它创建了一个 IDisposable SPWeb 对象。现在，我无法在 SPWeb 对象上调用 Dispose()，因为我没有对它的引用。 **那么我需要担心这种泄漏的内存吗？**

```
SPUser spUser = SPControl.GetContextSite(HttpContext.Current).OpenWeb().SiteUsers[@"foo\bar"]; 
```

我知道我可以将语句分成多行并获取 SPWeb 引用来调用 Dispose：

```
SPWeb spWeb = SPControl.GetContextSite(HttpContext.Current).OpenWeb();
SPUser spUser = spWeb.SiteUsers[@"foo\bar"];
spWeb.Dispose(); 
```

请记住，我的问题不是关于美学，而是关于 IDisposable 对象发生了什么，我无法明确调用 Dispose()，因为我没有参考。

很抱歉我第一次问这个问题时不够清楚。从那以后我改写了它。感谢您迄今为止的所有回复。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-06T04:03:44.393

“我无法显式调用 Dispose() 的 IDisposable 对象会发生什么？”

通常，您可以在所有一次性对象上调用 Dispose（使用 using 语句隐式或显式），但是在您**不能**的假设场景中，这**取决于**对象的实现方式。

通常，.Net 对象将遵循[这些线](http://www.koders.com/csharp/fid88562D7F1F6AB4C639B301D7C90A8B1E2924C1A4.aspx)的模式。该模式是定义一个终结器，以在未调用 dispose 的情况下清理内容，然后让 dispose 抑制终结器。这减少了内存负载并减少了 GC 的工作量。

在从终结器调用 Dispose 的许多问题中，您正在将单线程问题转变为多线程问题，终结器将在**不同**的线程上运行，这可能会暴露一些非常微妙且难以捕获的错误。此外，这意味着您将持有非托管资源的时间比预期的要长（例如，您打开一个文件，忘记调用 close 或 dispose 并且下次您打开它时它被锁定）

底线是，**最好的做法**是处置所有一次性物品，否则您可能会引入奇怪而复杂的错误。需要注意的是，某些框架（如 sharepoint）返回不应根据文档处理的对象的共享实例。

当我使用“使用”模式处理我的对象时，我通常会发现代码更具可读性。显式调用 Dispose (object.Dispose()) 的问题在于，很难追踪对象的分配位置，而且很容易忘记。你不能忘记关闭 using 语句的大括号，编译器会抱怨:)

**编辑/哥查**

根据[MS 文档](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.spsite.aspx)，您不应在对 GetContextSite 返回的共享点共享对象的引用上调用 dispose。所以，你应该在这里格外小心。

请参阅[此答案](https://stackoverflow.com/questions/415313/what-happens-to-an-idisposable-object-created-in-the-middle-of-a-statement-that-i#456313)以了解您应该使用的安全共享点模式。

> 但是，如果您有对共享资源的引用，例如当对象由 Web 部件中的 GetContextSite 方法提供时，请不要使用任何一种方法来关闭该对象。在共享资源上使用任一方法都会导致发生访问冲突错误。在您引用共享资源的情况下，请改为让 Windows SharePoint Services 或您的门户应用程序管理该对象。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-06T03:13:17.383

以下更惯用，读起来也更好：

```
using (SPWeb spWeb = SPControl.GetContextSite(HttpContext.Current).OpenWeb())
{
    SPUser spUser = spWeb.SiteUsers[@"foo\bar"];
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-06T03:10:30.227

*您应该显式（或通过using*语句隐式）调用 Dispose 方法。将代码拆分为多行的另一个原因是：

*   可读性
*   更容易调试

Dispose 方法可以在 finalizer 中执行，但自己调用会更安全。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-06T03:27:09.010

我建议拆分线路并使用 Dispose。如果一个对象实现了 IDisposable，你必须假设它需要处理，因此在 using 块中使用它。

```
using (SPWeb spWeb = SPControl.GetContextSite(HttpContext.Current).OpenWeb())
{
    SpUser spUser = null;
    if (spWeb != null)
    {
        spUser = spWeb.SiteUsers[@"foo\bar"];
    }
} 
```

通过这样做，您可以处理对象并处理打开外部资源的 OpenWeb() 调用中的错误。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-06T03:18:13.067

泄露内存？不，你不应该担心它，假设 IDisposable 的实现遵循类库指南，因为下一次垃圾收集应该清理它。

但是，它确实揭示了您的代码中的错误，因为您没有正确管理您使用的 IDisposable 实现的生命周期（我在[http://www.caspershouse.com/post/A-详细说明了这个问题更好的实现模式为 IDisposable.aspx](http://www.caspershouse.com/post/A-Better-Implementation-Pattern-for-IDisposable.aspx)）。您的第二个代码块是很好的第一步，但如果对 SiteUsers 的调用失败，您不能保证调用 Dispose。

您修改后的代码如下所示：

```
// Get the site.
var contextSite = SPControl.GetContextSite(HttpContext.Current);

// Work with the web.
using (SPWeb web = contextSite.OpenWeb())
{
  // Get the user and work with it.
  SPUser spUser = web.SiteUsers[@"foo\bar"];
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-18T20:57:17.087

到目前为止，正如一些人所说：您绝不能处置您未创建的对象。因此，在您的示例中，您不应*释放*SPWeb 或 SPSite 对象！

这将破坏当前的 SPRequest 对象。它可能看起来仍在工作，但如果您稍后添加新的 Web 部件，或者尝试打开 Web 部件的工具窗格，您将收到各种奇怪的错误。

正如已经说过的，必须处理*您自己创建*的 SPWeb 和 SPSite 实例（新）。

这可以使用 using() 或 try/finally 来完成（这是 using() 语句无论如何都会出现在您的 MSIL 代码中的方式）。如果您使用 try/finally，最好在您的 SPWeb/SPSite 实例上检查 null，并首先检查 SPWeb，因为 SPSite 会自动处理您的 SPWeb。

要记住的另一件重要的事情是，在循环 SPWebCollections（如 AllWebs 或 Webs）时，是在循环遍历它们时处理您的子网站。如果有很多子网站，并且您在内存潜力有限的 32 位硬件上运行，您确实可以非常快地用 SPRequest 对象填满您的内存。这将导致性能下降，因为它会导致您的应用程序池定期回收。

话虽如此，最好不要像在代码示例中那样组合调用。它很难阅读，*如果*您使用的是应该处理的 SPWeb，那么您不能！这种内存泄漏是最难发现的，所以不要这样做;-)

我可以推荐 Roger Lamb 的博客了解详细信息：http: [//blogs.msdn.com/rogerla](http://blogs.msdn.com/rogerla) 还有一些关于 Stefan Goßner 博客的技术细节：http: [//blogs.technet.com/stefan_gossner/archive/2008/12/05/disposing -spweb-和-spsite-objects.aspx](http://blogs.technet.com/stefan_gossner/archive/2008/12/05/disposing-spweb-and-spsite-objects.aspx)

安德斯

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-19T01:45:10.373

这里的许多答案都假设只有 Dispose 最终被调用很重要。但是，在使用 SPSite 和 SPWeb 时，您肯定希望尽快调用 Dispose()。确定*什么时候*应该做通常很棘手，但是有很多[很好的参考资料](http://sharepointdevwiki.com/display/public/When+to+Dispose+SharePoint+objects)可以帮助回答这个问题。

至于为什么会这样，Stefan Goßner[在这里](http://blogs.technet.com/stefan_gossner/archive/2008/12/05/disposing-spweb-and-spsite-objects.aspx)提供了一个很好的总结：

> 每个 SPWeb 和 SPSite 对象都包含对 SPRequest 对象的引用，该对象包含对负责与后端 SQL 服务器通信的 SharePoint COM 对象的引用。
> 
> 处理 SPWeb 对象实际上不会从内存中删除 SPWeb 对象（实际上 .NET 框架不允许以确定性方式从内存中删除任何对象），但它会调用 SPWeb 对象的方法，从而导致 COM 对象关闭连接到 SQL 服务器并释放其分配的内存。
> 
> 这意味着从创建 SPRequest 对象到释放 SPWeb 对象，到后端 SQL 服务器的连接将保持打开状态。

您的代码示例的最佳实践如下所示：

```
SPSite contextSite = SPControl.GetContextSite(HttpContext.Current);
using (SPWeb spWeb = contextSite.OpenWeb())
{
  SPUser spUser = spWeb.SiteUsers[@"foo\bar"];
  // Process spUser
}
// DO NOT use spUser
// DO NOT dispose site from HttpContext 
```

请注意，在处置其父 SPWeb 之后，使用 SP 对象（如 SPUser、SPList 等）是不安全的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-18T13:06:07.603

来自[http://msdn.microsoft.com/en-us/library/aa973248.aspx](http://msdn.microsoft.com/en-us/library/aa973248.aspx) *最佳实践：使用一次性 Windows SharePoint Services 对象*：

如果从 SPControl.GetContextSite 获得 SPSite 对象，则调用应用程序不应释放该对象。由于 SPWeb 和 SPSite 对象保留以这种方式派生的内部列表，因此处理对象可能会导致 SharePoint 对象模型的行为不可预测。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-01-22T05:20:06.163

似乎还没有人把它扔进去：

如果您的对象需要一个处置器（即持有必须释放的资源），那么您应该实现一个调用处置器方法的终结器。

在处置器中，您可以添加以下行：

```
System.GC.SuppressFinalize(this) 
```

如果您调用处理程序，这将阻止最终确定。这样，您可以在必要时很好地使用您的对象，但要保证它通过终结器自行清理（这就是 C# 确实有终结器的全部原因）。

# ruby-on-rails - Rails：Fields_for 没有范围？

> ID：415315
> 
> 赞同：0
> 
> 时间：2009-01-06T03:07:47.520
> 
> 标签：ruby-on-rails, ruby

有没有办法在没有范围的情况下在表单中使用 fields_for？

例如：

```
<% fields_for "user[]" do |x|
  <%= x.text_field :name %>
<% end %> 
```

没有将用户模型加载到内存中？

我使用区域 [用户] [] [名称] 让它工作，但我想将它保留在 ERB 中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-06T13:55:10.003

我认为答案将是“不”，因为它们`form_for`会`fields_for`尝试从给定的实例变量中确定默认值。

但是，我认为如果您想通过加载该模型来降低内存使用量，您可以尝试创建一个模型模型以返回 nil 值，并从该模型创建一个实例对象。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-06T03:14:36.117

有什么具体原因需要专门使用 form_for 吗？它真正设计用于与实例化模型对象一起使用。

或者，您为什么不直接使用常规表单助手标签。您可以按如下方式定义它：

```
<%form_tag :my_form do %>
 <%= text_field_tag :foo, :bar %>
<%end%> 
```

您可能需要查看操作视图的文档以了解它是如何工作的。

# debugging - 您更喜欢哪种日志记录实现？

> ID：415344
> 
> 赞同：2
> 
> 时间：2009-01-06T03:20:58.320
> 
> 标签：debugging, language-agnostic, logging

我即将在 C++ 中实现一个日志记录类，并试图决定如何去做。我很想知道那里有哪些不同的日志记录实现。

例如，我在 Python 中使用了带有“级别”的日志记录。过滤掉低于某个阈值的日志事件。它还包括记录“名称”，您可以在其中通过层次结构过滤掉事件，例如“app.apples.*”不会显示，但“app.bananas.*”会显示。

我曾想过使用“标签”，但不确定实施。我见过游戏使用“位”来实现紧凑性。

所以我的问题：

*   您之前创建或使用过哪些实现？
*   你认为它们的优点和缺点是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-06T03:41:20.960

我读过Jeff Atwood 的[这篇文章](https://blog.codinghorror.com/the-problem-with-logging/)

这是关于 Logging 的溢出以及如何避免它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T03:43:26.603

[Log4J](http://en.wikipedia.org/wiki/Log4J)维基百科页面上有很多链接。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-06T03:47:44.130

Jeff Atwood 有一篇关于日志记录的[非常有趣的博客文章](https://blog.codinghorror.com/the-problem-with-logging/)。它的最终信息是日志记录通常是不必要的（在某种程度上）。

日志记录通常不能很好地扩展（高流量系统上的数据过多）。

我认为最好的一点是您通常不需要它。手动跟踪代码以了解分配给事物的值比筛选大量日志文件更容易。

这只是信息过载。

现在，对于单用户应用程序来说，情况并非如此。对于媒体编码或一般操作系统使用等问题，最好为小型应用程序提供日志，因为调试信息在这种情况下（对我来说）很有用**。**如果您在刻录 DVD 时出现问题，如果您了解日志输出，那么查看日志信息对排除故障很有帮助。

我认为有几个级别会对用户有所帮助，例如：

*   没有日志
*   用于一般用户反馈的基本日志记录
*   供开发人员或技术支持人员解释的高技术数据

根据情况，存储所有日志数据并仅向用户显示基本信息可能很有用，或者可能提供查看所有详细数据的选项。

这完全取决于域。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-06T04:19:13.083

我们的一个应用程序使用注册表条目在生产执行期间动态控制日志记录/跟踪。

例如： if (Logger.TraceOptionIsEnabled(TraceOption.PLCF_ShowConfig)) {...whatever

在运行时执行时，如果注册表值 PLCF_ShowConfig 为 true，则调用返回 true，然后执行任何操作。

很方便。

# wcf - 诱导 WCF openTimeout closeTimeout

> ID：415356
> 
> 赞同：1
> 
> 时间：2009-01-06T03:31:07.177
> 
> 标签：wcf, timeout

我希望测试和观察 WCF 客户端和服务主机之间的超时行为。对于receiveTimeout 和sendTimeout，可能很容易传输需要几秒钟以上的大字节流并将这些超时属性设置为低得离谱的值。

但是，由于除了调用 serviceProxy.Open() 或 .Close() 方法之外没有什么可以做的，我在想什么是延迟打开和关闭 WCF 连接、跨越阈值的好方法openTimeout 和 closeTimeout？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-06T03:46:33.667

好吧，如果您正确地公开了您的合约（作为接口），您可以模拟一个抛出 TimeoutException 的代理实例并将其传递给您的代码以供使用。

# lcd - LCD 显示屏和数据线

> ID：415368
> 
> 赞同：2
> 
> 时间：2009-01-06T03:39:37.690
> 
> 标签：lcd

LCD 有 4 条数据线。但是要在 LCD 中显示的数据是以 7 位的 ASCII 格式给出的。这怎么可能？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-06T03:45:36.867

不久前，我回答了另一个用户的问题（[此处](https://stackoverflow.com/questions/248949/lcd-8-bit-mode-to-4-bit-mode)），该问题引用了以下文档：[www.cloverlcd.com/pdf/S6A0069.pdf](http://www.cloverlcd.com/pdf/S6A0069.pdf)。您可以从该链接了解它如何工作（至少对于该示例）。

许多这些嵌入式设备通常采用两周期方法将数据传送到芯片。我见过一个例子，你连续输出两个 f-nybbles 进行同步（因为 ff 是无效的 7 位），然后你开始输出 nybbles 的过程。只要除了同步没有办法生成两个连续的f-nybbles，就很容易实现。

通常还有其他线路从总线连接到设备，允许设备检测新的数据写入。这意味着它将检测两个相同的写入作为不同的值。换句话说，它使用其他信号来控制数据的接收。大多数较简单的设备也有严格的时序要求（例如，每次写入后必须延迟至少 N 微秒）。

此外，您倾向于发送的是命令，而不仅仅是 ASCII 代码。在 LCD 上偏移 3 处显示 Hello 的 nybble 输出可能是：

```
f f           ; sync
0             ; clear display (cmd = 0).
1 0 3         ; set cursor (cmd = 1) to offset 3.
2 H e l l o 0 ; output text (cmd = 2) teminated by NULL. 
```

由于只有数据线 d3 到 d0 连接到设备，因此上半字节无关紧要。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T03:48:48.217

通常器件以 8 位模式启动，但将其置于 4 位模式所需的命令会忽略 4 个 LSB。

在 4 位模式下，每个字符需要两个 xfer。

看到[这个描述](http://esd.cs.ucr.edu/labs/interface/interface.html)

# sql-server - 如何在 Microsoft Reporting Services 中的 Firefox 中显示加载图形

> ID：415374
> 
> 赞同：1
> 
> 时间：2009-01-06T03:43:53.437
> 
> 标签：sql-server, reporting-services, reporting

我正在使用 MS 报告服务，并且某些报告花费的时间超过了应有的时间。默认情况下，报表查看器在 IE 中显示加载图形。但是，此图形在 Firefox 中不可见。它在 IE 中运行良好。如何在 Firefox 中显示加载图形？

任何帮助，将不胜感激。

提前致谢。

问候尼拉吉

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-06T07:48:01.900

我的 SSRS 2005 服务器在 Firefox、IE 和 Chrome 中显示加载图标很好。

# c# - 可以在 c# 中使用 SSE 吗？

> ID：415375
> 
> 赞同：15
> 
> 时间：2009-01-06T03:44:17.227
> 
> 标签：c#, sse

我正在阅读一个关于 c# 代码优化的问题，一个解决方案是将 c++ 与 SSE 结合使用。是否可以直接从 ac# 程序进行 SSE？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-06T05:20:27.547

即将发布的[Mono](http://www.mono-project.com/Main_Page) 2.2 版本将支持 SIMD。[Miguel de Icaza 在这里](http://tirania.org/blog/archive/2008/Nov-03.html)写了关于即将推出的功能的博客，API 在[这里](http://go-mono.com/docs/index.aspx?tlink=0@N%3aMono.Simd)。

尽管将有一个库支持在 Microsoft 的 .NET Windows 运行时下进行开发，但除非您在 Mono 运行时下运行代码，否则它不会具有您正在寻找的性能优势。根据您的情况，这可能是可行的。

更新：Mono 2.2[发布](http://www.mono-project.com/Release_Notes_Mono_2.2#SIMD_support_in_Mono)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-06T04:39:32.387

**C# 可以显式进行 SSE 调用吗？**

不，C# 不能生成内联 IL，更不用说内联 x86/amd64 程序集了。

如果 SSE 可用，CLR，更具体地说是 JIT，将使用 SSE，而无需在大多数情况下强制使用它。我说得最多是因为我不是 SSE 专家，而且我确信在某些情况下它可能是有益的，而 JIT 不会进行优化。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2014-04-04T10:50:45.273

[SIMD for .NET 将](http://blogs.msdn.com/b/clrcodegeneration/archive/2014/04/03/ryujit-ctp3-how-to-use-simd.aspx)在不久的将来推出。[此功能 ATM 需要RyuJIT](http://blogs.msdn.com/b/clrcodegeneration/archive/2014/05/12/ryujit-ctp4-now-with-more-simd-types-and-better-os-support.aspx)（.NET 的下一代 JIT 编译器）。

您应该使用[Microsoft.Bcl.Simd 包](http://www.nuget.org/packages/Microsoft.Bcl.Simd)`Microsoft.Numerics.Vectors.Vector<T>`中的类来利用此功能。示例代码[在这里](http://code.msdn.microsoft.com/SIMD-Sample-f2c8c35a)。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-06T03:51:05.543

根据[这个](http://social.msdn.microsoft.com/forums/en-US/clr/thread/7c3db914-152a-4c3c-a9b1-00e94e2a4ac6/ "MSDN 论坛")论坛发帖，如果 SSE 在目标机器上可用，MS JIT 编译器会自动使用 SSE。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-22T00:26:44.167

如果你有一个“大块”工作要做，最好的办法是使用 MMX/SSE 内在函数用 C++ 编写它，然后制作一个非常简单的 /clr 托管 C++ 类来包装你的功能并将其公开为.net 类。然后您的代码可以像使用普通类一样使用该程序集。

有关 VC 内在函数的更多信息，您可以查看我多年前写的这个小曲子。

[http://msdn.microsoft.com/en-us/library/0aws1s9k.aspx](http://msdn.microsoft.com/en-us/library/0aws1s9k.aspx)

哦-我假设您实际上是想使用并行函数来加快速度。正如其他人指出的那样 - 如果您只想以更大的块等移动数据，JIT 已经知道如何将 SSE 用于这些基础知识。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-06-14T20:27:47.893

菲利普是正确的。我有另一个较旧的帖子显示了类似但更详细的示例。我实际上已经运行了这段代码，并自己修改了它以向自己证明它有效。我正在考虑在我正在工作的项目中使用这种技术，这就是为什么我要出去看看可能有什么新东西，因为这有点旧了。正如作者暗示的那样，您可以在 C++ 中编写任何您想要的函数，编译它，然后将字节复制到您的 C# 中。

[http://blogs.msdn.com/b/devinj/archive/2005/07/12/438323.aspx](http://blogs.msdn.com/b/devinj/archive/2005/07/12/438323.aspx)

我要补充一点，Joe 的 CLI C++ 类也是一个好主意，但是，我认为 sse 编译器标志和 /clr 标志在同一个项目上不兼容。我刚刚验证过：必须在单独的项目中编写高性能代码才能使用 SSE（/arch:sse 或 /arch:sse2）编译器标志，因为 /clr 是不兼容的。做任何比在几个输入上做简单算术更复杂的事情，我认为这是最好的方法。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-04-19T12:41:57.970

最近微软发布了一个用于 C# 的测试版 SIMD 矢量库 ( [Microsoft.Bcl.Simd](http://www.nuget.org/packages/Microsoft.Bcl.Simd) )，它需要安装 RyuJIT CTP，并且仅适用于 Windows 8。

您也可以只使用本机 SSE 库并从 C# 调用它。例如 Yeppp 库，请参阅[此 StackOverflow 答案](https://stackoverflow.com/a/16848993/184528)。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-09-18T23:25:04.790

终于有可能了。这里的帖子[http://blogs.msdn.com/b/dotnet/archive/2014/04/07/the-jit-finally-proposed-jit-and-simd-are-getting-married.aspx](http://blogs.msdn.com/b/dotnet/archive/2014/04/07/the-jit-finally-proposed-jit-and-simd-are-getting-married.aspx)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-10-11T01:28:06.560

现代 C# 很好地支持 SIMD/SSE 指令并使它们使用起来相当简单。并非所有指令都受支持。

以下是 uint[] 数组的 SSE .Sum() 示例：

```
 using System.Numerics;

    private static ulong SumSseInner(this uint[] arrayToSum, int l, int r)
    {
        var sumVectorLower = new Vector<ulong>();
        var sumVectorUpper = new Vector<ulong>();
        var longLower      = new Vector<ulong>();
        var longUpper      = new Vector<ulong>();
        int sseIndexEnd = l + ((r - l + 1) / Vector<uint>.Count) * Vector<uint>.Count;
        int i;
        for (i = l; i < sseIndexEnd; i += Vector<int>.Count)
        {
            var inVector = new Vector<uint>(arrayToSum, i);
            Vector.Widen(inVector, out longLower, out longUpper);
            sumVectorLower += longLower;
            sumVectorUpper += longUpper;
        }
        ulong overallSum = 0;
        for (; i <= r; i++)
            overallSum += arrayToSum[i];
        sumVectorLower += sumVectorUpper;
        for (i = 0; i < Vector<long>.Count; i++)
            overallSum += sumVectorLower[i];
        return overallSum;
    } 
```

这个特定的功能是开源和免费的 nuget 包 HPCsharp 的一部分，可以在 nuget.org 上获得，我维护它。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-06T04:59:48.633

当然可以（更重要的问题是 - 你为什么要这样做？把它留给运行时；这就是它的工作）。

C# 允许您将委托映射到内存地址。该内存地址可以包含原始汇编代码。您可以在[Michael Giagnocavo 的博客](http://www.atrevido.net/blog/PermaLink.aspx?guid=ac03f447-d487-45a6-8119-dc4fa1e932e1)上阅读更多内容。

虽然我自己没有尝试过，但也可以使用[Marshal.GetDelegateForFunctionPointer](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.marshal.getdelegateforfunctionpointer.aspx)。

# shell - .bashrc、.bash_profile 和 .environment 有什么区别？

> ID：415403
> 
> 赞同：130
> 
> 时间：2009-01-06T03:58:34.827
> 
> 标签：shell, environment, bash

这些年来，我使用了许多不同的基于 *nix 的系统，似乎我使用的每一种 Bash 都有不同的算法来决定运行哪些启动脚本。对于设置环境变量和别名以及打印启动消息（例如 MOTD）等任务，哪个启动脚本适合执行这些任务？

`.bashrc`把东西放进去,`.bash_profile`和有什么区别`.environment`？我还看到了其他文件，例如`.login`,`.bash_login`和`.profile`; 这些有关系吗？物理登录、通过 ssh 远程登录和打开新的终端窗口时运行的有什么区别？跨平台（包括 Mac OS X（及其 Terminal.app）和 Cygwin Bash）是否存在显着差异？

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2009-01-06T04:18:33.397

与 shell 配置文件的主要区别在于，有些文件只能由“登录”shell 读取（例如，当您从另一台主机登录时，或在本地 unix 机器的文本控制台登录时）。这些是所谓的，说，`.login`或`.profile`（`.zlogin`取决于您使用的外壳）。

然后你有由“交互式”shell读取的配置文件（例如，连接到终端的那些（或伪终端，例如，在窗口系统下运行的终端模拟器）。这些是有名字的比如`.bashrc`, `.tcshrc`,`.zshrc`等

`bash`使这一点复杂化，因为`.bashrc`它只能由***交互式*****和*****非登录*****的 shell 读取****，所以你会发现大多数人最终告诉他们`.bash_profile`也要阅读`.bashrc`类似的东西**

 **`[[ -r ~/.bashrc ]] && . ~/.bashrc`

其他 shell 的行为不同 - 例如，对于交互式 shell，无论是否登录，总是读取`zsh`with 。`.zshrc`

bash 的手册页解释了读取每个文件的情况。是的，机器之间的行为通常是一致的。

`.profile`只是最初使用的登录脚本文件名`/bin/sh`。`bash`，通常与 向后兼容，如果存在`/bin/sh`，将读取。`.profile`

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2009-01-06T15:21:30.877

这很简单。解释`man bash`如下：

```
/bin/bash
       The bash executable
/etc/profile
       The systemwide initialization file, executed for login shells
~/.bash_profile
       The personal initialization file, executed for login shells
~/.bashrc
       The individual per-interactive-shell startup file
~/.bash_logout
       The individual login shell cleanup file, executed when a login shell exits
~/.inputrc
       Individual readline initialization file 
```

登录 shell 是在您登录时读取的那些（例如，仅在启动 xterm 时不会执行它们）。还有其他登录方式。例如使用 X 显示管理器。那些有其他方法可以在登录时读取和导出环境变量。

另请阅读`INVOCATION`手册中的章节。它说*“以下段落描述了 bash 如何执行其启动文件。”* ，我认为这是一个点:) 它也解释了“交互式”外壳是什么。

Bash 不知道`.environment`。我怀疑这是您的发行版文件，用于设置独立于您驱动的外壳的环境变量。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-06T04:13:18.823

经典地，`~/.profile`被 Bourne Shell 使用，并且可能被 Bash 支持作为遗留措施。再次，`~/.login`并被`~/.cshrc`C Shell 使用——我不确定 Bash 是否使用它们。

将`~/.bash_profile`在登录时使用一次。`~/.bashrc`每次启动 shell 时都会读取该脚本。这类似于`/.cshrc`C Shell。

一个后果是，在启动非登录 shell 时，里面的东西`~/.bashrc`应该尽可能轻量（最小）以减少开销。

我相信该`~/.environment`文件是 Korn Shell 的兼容性文件。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-01-06T04:03:39.043

[我在这里](http://lists.debian.org/debian-user/1999/06/msg00062.html)找到了关于 .bashrc 和 .bash_profile的信息来总结一下：

> .bash_profile 在您登录时执行。你放在那里的东西可能是你的 PATH 和其他重要的环境变量。
> 
> .bashrc 用于非登录 shell。我不确定那是什么意思。我知道 RedHat 每次你启动另一个 shell 时都会执行它（su 给这个用户或者只是再次调用 bash）你可能想把别名放在那里，但我再次不确定这意味着什么。我只是自己忽略它。
> 
> .profile 相当于根的 .bash_profile。我认为更改名称是为了让其他 shell（csh、sh、tcsh）也可以使用它。（您不需要一个作为用户）
> 
> 还有 .bash_logout 执行，是的，很好的猜测......注销。你可能想停止恶魔，甚至做一些家务。如果您想在注销时清除屏幕，也可以在此处添加“清除”。

还有一个完整的跟进每个配置文件[here](http://www.thegeekstuff.com/2008/10/execution-sequence-for-bash_profile-bashrc-bash_login-profile-and-bash_logout/)

这些甚至可能是依赖于发行版的，并非所有发行版都选择使用它们的每个配置，有些甚至更多。但是当它们具有相同的名称时，它们通常包含相同的内容。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-02-27T00:22:05.517

根据[Josh Staiger](http://www.joshstaiger.org/archives/2005/07/bash_profile_vs.html)的说法，Mac OS X 的 Terminal.app 实际上默认为每个新终端窗口运行登录 shell 而不是非登录 shell，调用 .bash_profile 而不是 .bashrc。

他建议：

> 大多数情况下，您不想为登录和非登录 shell 维护两个单独的配置文件——当您设置 PATH 时，您希望它适用于两者。您可以通过从 .bash_profile 文件中获取 .bashrc 来解决此问题，然后将 PATH 和常用设置放入 .bashrc。
> 
> 为此，将以下行添加到 .bash_profile：
> 
> ```
> if [ -f ~/.bashrc ]; then 
>     source ~/.bashrc 
> fi 
> ```
> 
> 现在，当您从控制台登录到您的机器时，将调用 .bashrc。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-06T04:06:21.893

一个不错的地方是 bash 的手册页。[这](http://linux.die.net/man/1/bash)是一个在线版本。寻找“INVOCATION”部分。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-05-21T10:42:00.943

我使用了 Debian 系列发行版，它们似乎可以执行`.profile`，但不是`.bash_profile`，而 RHEL 衍生产品`.bash_profile`在`.profile`.

当您必须设置环境变量才能在任何 Linux 操作系统中工作时，这似乎是一团糟。

# python - 为什么 gethostbyaddr(gethostname()) 返回我的 IPv6 IP？

> ID：415407
> 
> 赞同：3
> 
> 时间：2009-01-06T04:01:41.403
> 
> 标签：python, sockets, ip-address, ipv6, ipv4

我正在使用 python 制作一个简单的服务器应用程序，并且我正在尝试获取 IP 以将侦听套接字绑定到。我看过的一个例子使用了这个：

```
HOST = gethostbyaddr(gethostname()) 
```

在此之后进行更多处理，它应该只给我主机 IP 作为字符串。这应该返回 IPv4 地址。但是当我运行这段代码时，它会返回我的 IPv6 地址。为什么会这样？我怎样才能获得我的 IPv4 地址？

如果相关，我使用的是 windows vista 和 python 2.5

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-06T04:07:16.900

获取您的 IP 地址比您想象的要难。

检查我给出的[这个答案](https://stackoverflow.com/questions/270745/how-do-i-determine-all-of-my-ip-addresses-when-i-have-multiple-nics#274644)，以了解我找到的一种可靠方法。

如果您不喜欢点击某些东西，以下是答案的内容：

使用[`netifaces`](http://alastairs-place.net/netifaces/)模块。因为网络很复杂，使用 netifaces 可能有点棘手，但这里是如何做你想做的事：

```
>>> import netifaces
>>> netifaces.interfaces()
['lo', 'eth0']
>>> netifaces.ifaddresses('eth0')
{17: [{'broadcast': 'ff:ff:ff:ff:ff:ff', 'addr': '00:11:2f:32:63:45'}], 2: [{'broadcast': '10.0.0.255', 'netmask': '255.255.255.0', 'addr': '10.0.0.2'}], 10: [{'netmask': 'ffff:ffff:ffff:ffff::', 'addr': 'fe80::211:2fff:fe32:6345%eth0'}]}
>>> for interface in netifaces.interfaces():
...   print netifaces.ifaddresses(interface)[netifaces.AF_INET]
...
[{'peer': '127.0.0.1', 'netmask': '255.0.0.0', 'addr': '127.0.0.1'}]
[{'broadcast': '10.0.0.255', 'netmask': '255.255.255.0', 'addr': '10.0.0.2'}]
>>> for interface in netifaces.interfaces():
...   for link in netifaces.ifaddresses(interface)[netifaces.AF_INET]:
...     print link['addr']
...
127.0.0.1
10.0.0.2 
```

这可以像这样变得更具可读性：

```
from netifaces import interfaces, ifaddresses, AF_INET

def ip4_addresses():
    ip_list = []
    for interface in interfaces():
        for link in ifaddresses(interface)[AF_INET]:
            ip_list.append(link['addr'])
    return ip_list 
```

如果您想要 IPv6 地址，请使用`AF_INET6`而不是`AF_INET`. 如果你想知道为什么`netifaces`到处都使用列表和字典，那是因为一台计算机可以有多个 NIC，每个 NIC 可以有多个地址，每个地址都有自己的一组选项。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-02-06T04:02:29.337

IPv6 优先于 IPv4，因为它是较新的系列，如果您的主机名与多个系列相关联，这通常是您想要的。您应该使用[getaddrinfo](http://docs.python.org/library/socket.html#socket.getaddrinfo)进行家庭独立解析，这是一个示例，

```
import sys, socket;
host = socket.gethostname();
result = socket.getaddrinfo(host, None);
print "family:%i socktype:%i proto:%i canonname:%s sockaddr:%s"%result[0];
result = socket.getaddrinfo(host, None, socket.AF_INET);
print "family:%i socktype:%i proto:%i canonname:%s sockaddr:%s"%result[0];
result = socket.getaddrinfo(host, None, socket.AF_INET6);
print "family:%i socktype:%i proto:%i canonname:%s sockaddr:%s"%result[0]; 
```

在双栈配置的主机上，它给了我以下信息，

```
family:10 socktype:1 proto:6 canonname: sockaddr:('2002:dce8:d28e::31', 0, 0, 0)
family:2 socktype:1 proto:6 canonname: sockaddr:('10.6.28.31', 0)
family:10 socktype:1 proto:6 canonname: sockaddr:('2002:dce8:d28e::31', 0, 0, 0) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-06T04:10:55.783

[`gethostbyaddr()`](http://docs.python.org/library/socket.html#socket.gethostbyaddr)将 IP 地址作为参数，而不是主机名，所以我很惊讶它完全可以正常工作而不会引发异常。相反，如果您的意思是[`gethostbyname()`](http://docs.python.org/library/socket.html#socket.gethostbyname)，那么您的结果会更令人惊讶，因为该函数声称不支持 IPv6。 [Harley 的回答](https://stackoverflow.com/questions/415407/why-does-gethostbyaddrgethostname-return-my-ipv6-ip#415417)解释了如何正确获取您的 IP 地址。

# windows - 将批处理文件作为 Windows 服务运行

> ID：415409
> 
> 赞同：187
> 
> 时间：2009-01-06T04:02:27.627
> 
> 标签：windows, windows-services, batch-file

为了运行一个应用程序，必须启动一个批处理文件（执行启动 Jetty、显示实时日志等操作）。仅当此批处理文件正在运行时，该应用程序才能工作。因此，我被迫运行此批处理文件，而不是从 Windows 服务器注销。

这个批处理文件可以作为服务运行吗？我正在尝试来自[类似问题](https://stackoverflow.com/questions/298562/windows-xp-or-vista-how-can-i-run-a-batch-file-in-the-background-no-windows-dis#298564)的建议之一。

* * *

## 回答 #1

> 赞同：175
> 
> 时间：2012-11-08T17:21:46.670

[NSSM](http://nssm.cc/usage)是完全免费且超级简单的，以管理员身份运行命令提示符/终端：

```
nssm install "YourCoolServiceNameLabel" 
```

然后会出现一个对话框，您可以选择要运行的文件在哪里。

卸载

```
nssm remove "YourCoolServiceNameLabel" 
```

* * *

## 回答 #2

> 赞同：70
> 
> 时间：2009-01-07T17:30:58.523

为什么不简单地将其设置为计划在启动时运行的计划任务？

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2018-07-25T18:51:18.167

有一个内置的 windows cmd 可以做到这一点：[sc create](https://docs.microsoft.com/en-us/windows-server/administration/windows-commands/sc-create)。不像nssm那么花哨，但您不必下载额外的软件。

```
sc create "ServiceName" start= demand displayname= "DisplayName" binpath= [path to .bat file] 
```

笔记

*   start=demand 表示必须自己启动服务
*   之后需要空格`=`
*   我确实在服务启动时遇到了服务没有及时响应的错误，但很明显服务已经成功运行了.bat。还没有深入研究这个，但是这个[线程](https://stackoverflow.com/a/40130630/885535)遇到了同样的事情并使用 nssm 安装服务解决了它。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2018-11-18T17:34:06.547

无需额外的软件。使用任务调度器 -> 创建任务 -> 隐藏。隐藏的复选框位于左下角。将任务设置为在登录时触发（或您喜欢的任何条件），然后在操作选项卡中选择任务。隐藏运行可确保任务像服务一样在后台静默运行。

请注意，您还必须将程序设置为“无论用户是否登录”都运行，否则程序仍将在前台运行。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2019-12-31T18:20:29.307

在 Windows 2019 Server 上，您可以使用以下命令运行 Minecraft java 服务器：

sc create minecraft-server DisplayName= "minecraft-server" binpath= "cmd.exe /CC:\Users\Administrator\Desktop\rungui1151.lnk" type= own start= auto

.lnk 文件是批处理文件的标准 Windows 快捷方式。

--- .bat 文件开始 ---

java -Xmx40960M -Xms40960M -d64 -jar minecraft_server.1.15.1.jar

--- .bat 文件结束 ---

这一切都是因为：

服务不知道如何在文件夹中启动，

cmd.exe 不知道如何在文件夹中启动

启动服务会产生“及时”错误，但日志文件显示服务器正在运行。

如果你需要关闭服务器，进入任务管理器，在后台进程中找到服务器java并结束它，或者在游戏中使用/stop命令终止服务器，或者对于其他程序/服务器，使用方法与服务器相关。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-06T04:36:24.080

正如 Doug Currie 所说，使用 RunAsService。

根据我过去的经验，您必须记住，您生成的服务将

*   有一组完全不同的环境变量
*   必须仔细检查权限/权限问题
*   如果它打开询问任何类型输入的对话框，可能会造成严重破坏

不确定最后一个是否仍然适用……这是我前段时间从事的一个项目中的一个大噩梦。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-06T11:06:11.047

虽然它不是免费的（但 39 美元），但[FireDaemon](http://firedaemon.com/)对我来说效果很好，我不得不推荐它。它将运行您的批处理文件，但具有许多额外且非常有用的功能，例如调度、服务监控、基于 GUI 或 XML 的服务安装、依赖项、环境变量和日志管理。

我开始使用 FireDaemon 来启动 JBoss 应用程序服务器 ( **run.bat** )，但不久之后我意识到 FireDaemon 配置能力的丰富性使我能够放弃批处理文件并在 FireDaemon 服务定义中重新创建其命令的意图。

还有一个名为 Trinity 的 SUPER FireDaemon，如果您有大量 Windows 服务器来管理此服务（或从技术上讲，任何服务），您可能想要查看它。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2021-05-01T01:33:57.477

由于 NSSM 不再维护，您可以考虑使用[WinSW](https://github.com/winsw/winsw)。它有可以使用或不使用 .Net 的二进制文件。

基本上，您创建一个 XML 文件，然后安装它。这是一个最小 XML 的示例：

```
<service>

  <!-- ID of the service. It should be unique across the Windows system-->
  <id>myapp</id>

  <!-- Path to the executable, which should be started -->
  <!-- CAUTION: Don't put arguments here. Use <arguments> instead. -->
  <executable>%BASE%\myExecutable.exe</executable>

</service> 
```

然后你可以安装并启动它：

```
winsw install myapp.xml
winsw start myapp.xml 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2021-02-20T14:51:01.680

安装 NSSM 并将 .bat 文件作为 Windows 服务运行。按预期工作

# unit-testing - 使用很少公共方法的大型应用程序的测试策略？

> ID：415413
> 
> 赞同：2
> 
> 时间：2009-01-06T04:05:35.017
> 
> 标签：unit-testing, testing

我正在做一个我真的不确定如何进行单元测试的项目。它是一个不显眼的基于标签的框架，用于在 GUI 系统中的模型、视图和委托之间连接事件。

基本上你有一个大的 json 文件，用于描述所有的事件、事件处理程序和绑定。用户创建他们的模型、视图和委托，所有这些都不了解框架。JSON 文件被传递给 init() 方法，然后框架创建所需的所有实例并处理所有绑定、侦听器等。

我遇到的问题有两个：

1) 框架中基本上只有一个公共方法，其他一切都通过 JSON 文件中的标记进行通信。因此，对于大型而复杂的应用程序，我的测试面非常小。

2）应用程序的一个重要角色是实例化类的，如果它们之前没有被实例化和缓存。这意味着我的测试代码中需要真正的类，简单的模拟不会削减它。

目前我正在考虑几个如果解决方案。首先是开始测试私有方法。第二个是只存根构造函数。

还有人有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-06T04:15:20.223

> 1) 框架中基本上只有一个公共方法，其他一切都通过 JSON 文件中的标记进行通信。因此，对于大型而复杂的应用程序，我的测试面非常小。

这怎么可能？这整个复杂的框架是否存储在一个类中？如果涉及多个类，它们如何在没有公共方法的情况下共享信息？

顺便说一句，构造函数也是一个公共方法。

你只是在传递 JSON 对象吗？这会使您的框架与信息源的耦合过于紧密。您应该有一个类解析 JSON，其余的类在不了解数据源的情况下进行通信（通过可测试的公共方法）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T04:08:27.943

列出系统的特性（场景、用例，无论你想怎么称呼它们），并为每个特性建立 JSON 数据/框架。这些是您的单元测试。

# sql-server - 调试 CLR 存储过程的最佳方法是什么

> ID：415418
> 
> 赞同：1
> 
> 时间：2009-01-06T04:07:33.123
> 
> 标签：sql-server, stored-procedures

我有一个相当复杂的 CLR 存储过程。调试程序的最佳方法是什么？如果可能的话，我想逐步完成它。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-06T05:24:06.137

谷歌是你的朋友。或您的帖子中的更多信息。

[如何：调试 SQL CLR 存储过程](http://msdn.microsoft.com/en-us/library/ms165051.aspx)

# sql-server - 聘请 SqlServer OLTP 专家，我应该寻找什么经验或要求？

> ID：415419
> 
> 赞同：0
> 
> 时间：2009-01-06T04:07:50.300
> 
> 标签：sql-server, sql-server-2005, oltp

我正在处理的 OTLP 项目遇到 Db 性能问题。我和另一位开发人员已经达到了我们积累的性能知识的终点，并寻找个人加入团队以帮助我们加快应用程序的速度。

对于某些背景，我们已经完成了架构更改以对数据片段进行非规范化，优化每个查询，运行多个数据库调整顾问以使我们的索引正确，调整 MSSql 的服务器选项。

我们不需要有人进来告诉我们加入可能很慢以及什么是死锁，我们需要在用尽上面列出的所有步骤后知道该做什么的人。

任何人有任何雇佣 OLTP DBA 的技巧或经验可以分享吗？在面试过程中我们可以问 DBA 什么样的问题？

这是一个奇怪的情况，我们知道我们需要比当前团队了解更多的人，但我们不知道要问什么问题，因为我们不知道下一步是什么。那有意义吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-06T13:13:38.153

好的，这告诉我一些事情：

> 对于某些背景，我们已经完成了架构更改以对数据片段进行非规范化，优化每个查询，运行多个数据库调整顾问以使我们的索引正确，调整 MSSql 的服务器选项。

您已经达到或超过了 90% 自称为 DBA 的人的能力。

问题是很多 DBA 并不是真正的程序员，他们更多的是在系统管理方面。您需要一位不仅非常擅长 TSQL，而且还了解您的其他编程语言的 DBA 程序员。

我将大部分时间花在这样的数据库调优问题上，解决方案通常涉及从前端到数据库模式的整个过程中的重大重新设计。您无法孤立地解决这些问题，如果没有对整个架构的完全控制（和完全理解），您将永远无法获得所需的性能。

*您*可能是这项工作的最佳人选，而且您可能更明智地聘请某人来让您摆脱繁忙的工作，这样您就可以专注于 OLTP 性能问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-06T04:31:34.930

您必须在这里小心谨慎，您最终可能会聘请 Guru DBA，让他显着提高数据库性能，但您的应用程序仍然存在根植于其架构的问题。

一些想法：

1.  将您优化的最复杂的查询交给具有 QA 的候选人 DBA，并让他/她再次对其进行优化。让他们描述他们做了什么以及他们是如何做到的。

2.  确保此人了解硬件，当您使用多个文件组、RAID 阵列、数据分区、64 位与 32 位性能等时...

3.  寻找也有一些软件架构背景的人。

4.  问他们一些更难的 SQL 服务器问题，例如。什么是 OVER 语句？GUID 是好的主键吗？为什么，int 身份更可取？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-06T04:42:33.240

将您的数据库调回到您自己的优化之前，然后将其提供给他们。看看他们是否可以将其调整为与您所做的更改相比表现得一样好或更好。

问他们为什么选择这种技术。

查阅参考资料并找出他们所来自的环境最有可能与您的环境相匹配。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-06T12:54:12.313

一个好的 DBA 将能够在面试中从高层次上告诉你他们下一步将采取什么步骤。你应该更多地关注这里的思维过程，而不是问题的解决方案。当 DBA 给出了一些解决方案时，回去对他们进行测验，并询问他们为什么应该以这些方式解决问题。

这种方法可以很快将男人和男孩区分开来。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-06T13:42:02.590

你离数据库的最大性能有多近？使用该技术很容易产生无法解决的 OLTP 问题。正如 Eric 所说，总体架构重新设计可能是有序的。更多内存，只需添加更多内存 :)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-06T23:06:03.637

当然，如果没有看到数据库，很难说什么是最好的优化方法。鉴于您所做的工作，您可能需要聘请一名数据库设计师 - 一位具有设计和调整您拥有的大小范围内的数据库经验的人。在询问他们将如何解决问题时，看看面试官是否会首先查看性能不佳的查询并运行分析器以查看正在发生的事情并识别它们。该人应该能够回答有关参数嗅探以及如何避免它的具体问题，可以使用哪些方法来避免游标，为什么需要更新统计信息，是什么使查询变得可靠。在性能调优中我会考虑一些常见的事情。网络是否已用尽（有时不是数据库），整体设计是否经过深思熟虑，您是否在使用通常表现不佳的 SQl 代码？例如，如果您的所有搜索都允许通配符作为第一个字符，那么甚至不可能让它们变得快速。如果您的联接是在多列自然键上，它们会比应有的速度慢。您是否在一个字段中存储了多个信息，从而导致大量操作以获取数据？你在使用游标吗？你在使用函数吗？你是否在不应该重用代码的时候？不是吗？您是否总是返回所需的最少信息？你要关闭连接吗？你遇到死锁了吗？您的表格行是否太宽？您是否在特定表中有太多记录（清除旧记录或将它们放入存档数据库会产生巨大差异）？您的代码中有多少是面向行而不是面向集合的？这些是经验丰富的数据库人员会看的事情的例子，因此他们应该在面试中谈论的事情。

一些糟糕的代码示例（你知道你已经优化了什么）可以让你很好地了解他们如何调整它们的方法。您需要有条不紊且具有 SQL 知识深度的人。

有一些关于性能调优的好书——我建议在面试之前获取它们并熟悉它们。

# sql-server-2008 - 如何使这个 SSIS 场景更加并行

> ID：415427
> 
> 赞同：1
> 
> 时间：2009-01-06T04:09:47.970
> 
> 标签：sql-server-2008, ssis

我在数据库表中有一百万行。对于每一行，我必须运行一个自定义 exe，解析输出并更新另一个数据库表

如何并行运行多行进程？

我现在有一个简单的数据流任务->GetData->Run Script (Run Process, Parse Output)->Store Data For 6000 rows 它花了 3 个小时。太多了。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-06T08:37:30.160

这里有一个瓶颈，每行运行进程。增加“EngineThreads”根本没有帮助，因为无论如何只有一个线程运行这个特定的脚本转换。花在其他转换上的时间可能根本不重要。进程是重量级的对象，运行数千个进程永远不会便宜。

我可以想到以下想法以使其变得更好：

1）修复它的最佳方法是将您的自定义 EXE 转换为程序集并从脚本转换中调用它 - 以避免创建进程、解析输出等的开销。

2）如果必须使用单独的进程，可以尝试并行运行这些进程。如果进程主要等待一些输入/输出（即它是 I/O 绑定的），这将有所帮助。如果进程受内存限制或 CPU 限制，则并行运行它们不会带来太多好处。

2A) 复杂的脚本，简单的封装。

要并行运行它们，请修改脚本中的 ProcessInput 方法以异步启动流程，并且不要等待流程完成 - 移动到下一行并创建下一个流程。订阅流程输出和流程退出事件，以便您知道它何时完成。限制并行运行的进程数量 - 否则您将耗尽内存。等到所有进程完成后再从 ProcessInput 调用返回。

2B) 简单的脚本，复杂的包。

保留当前的顺序脚本，但使用 SSIS 对数据进行分区。添加条件拆分转换，并根据一些哈希表达式将输入流拆分为多个流 - 这将使每个输出接收大约相同数量的数据。流的数量等于您要并行运行的流程实例的数量。将您的脚本转换添加到条件拆分的每个输出中。现在您还应该增加“引擎线程”属性:) 并且这些转换将并行运行。（注意：根据标签，我假设您使用 SSIS 2008。您需要插入额外的 Union All 转换以使其在 SSIS 2005 中工作）。

这应该可以使其性能更好，但是数百万个进程很多。你在这里很难得到很好的表现。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T04:35:49.230

如果您使用“数据流”容器执行此过程，则其上有一个名为“EngineThreads”的属性，默认值为 5。您可以将其设置为更高的数字，例如 20，这将投入更多线程处理这些行。

这只是一个性能调整或优化，如果您的 ssis 包仍然运行缓慢，那么我可能会解决您的包的体系结构和设计。

# unit-testing - 如何模拟 ObjectContext 或 ObjectQuery 在实体框架中？

> ID：415432
> 
> 赞同：22
> 
> 时间：2009-01-06T04:11:59.807
> 
> 标签：unit-testing, entity-framework, .net-3.5, mocking

如何在实体框架中模拟 ObjectContext 或 ObjectQuery？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-01-06T09:35:20.530

基本的模拟框架只能为接口和抽象类创建模拟（但仅限于抽象/虚拟方法）。

由于 ObjectContext 既不是抽象的也不是接口，因此模拟它并不容易。但是，由于具体模型容器是作为部分类生成的（如果您使用设计器），您可以从中提取所需的方法/属性到接口。在您的代码中，您只能使用接口，然后可以模拟。

使用 ObjectQuery 会稍微简单一些，因为它有一个基本接口（例如 IQueryable），它基本上包含您通常需要的所有必要操作（以及 LINQ 所需的）。因此，您应该在业务逻辑中公开 IQueryable 而不是 ObjectQuery，并且可以为该接口创建模拟。

另一种选择是将所有与数据访问相关的逻辑隐藏到一个单独的层（使用最少的逻辑），用集成测试测试这个层，并模拟它以便能够对其他层进行单元测试。

有一些工具（我只知道[TypeMock](http://www.typemock.com/Buy.php)）使用 .NET 的分析挂钩来生成模拟。这些工具不仅限于模拟接口或抽象类，还可以使用它们模拟任何东西，包括非虚拟和静态方法。使用这样的工具，您无需更改业务逻辑即可进行模拟。

尽管这种方法有时很有用，但您必须意识到，将依赖关系提取到接口 (IoC) 不仅有助于模拟，而且还可以减少组件之间的依赖关系，这还有其他好处。

我个人最喜欢免费软件工具中的[Rhino.Mocks](http://ayende.com/projects/rhino-mocks.aspx)，但我们也使用[TypeMock](http://www.typemock.com/Buy.php)，这也是一个很棒的产品（但你必须为此付费）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2013-09-05T20:44:06.080

为什么我们不能只创建要在测试中使用的实际上下文对象？由于我们不希望我们的测试影响生产数据库，我们总是可以指定一个指向测试数据库的连接字符串。在运行每个测试之前，构建一个新的上下文，添加测试中需要的数据，继续进行单元测试，然后在测试清理部分，删除测试期间创建的所有记录。这里唯一的副作用是自动增量 ID 将在测试数据库中用完，但既然它是一个测试数据库 - 谁在乎呢？

我知道关于这个问题的大多数答案都建议使用 DI/IoC 设计来为数据上下文等创建接口，但我使用实体框架的原因正是不为我的数据库连接、对象模型和简单的 CRUD 事务编写任何接口。为我的数据对象编写模拟接口并编写复杂的可查询对象来支持 LINQ，违背了依赖经过高度测试和可靠的[实体框架](http://msdn.microsoft.com/en-us/data/ef.aspx)的目的。

这种单元测试模式并不新鲜[——Ruby on Rails](http://rubyonrails.org/)已经使用了很长时间，而且效果很好。正如 .NET 提供 EF 一样，RoR 提供[ActiveRecord](http://api.rubyonrails.org/classes/ActiveRecord/Base.html)对象，每个单元测试创​​建它需要的对象，继续测试，然后删除所有构造的记录。

如何为测试环境指定连接字符串？由于所有测试都在它们自己的专用测试项目中，`App.Config`因此为测试数据库添加一个带有连接字符串的新文件就足够了。

想想这会为您节省多少头痛和痛苦。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-11-17T10:59:55.297

我同意其他人的观点，你不能真正模拟 ObjectContext。您应该使用 EF DbContext 因为您可以模拟底层 DbSet 有很多帖子如何做到这一点。所以我不会写怎么做。但是，如果您**绝对必须**使用 ObjectContext（出于某种原因）并且想要对其进行单元测试，您可以使用 InMemory 数据库。

首先安装这个Nuget包：Effort（Entity Framework Fake ObjectContext Realization Tool），它使用NMemory作为数据库。安装 Effort.EF6 包：

> PM> Install-Package Effort.EF6

```
using System;
using System.Data.Common;
using System.Data.Entity;
using System.Data.Entity.Core.Objects;
using System.Data.Entity.Infrastructure;
using Effort;

public class DbContextHelper
{
    //Fake object you can drop this if you are using your own EF context
    private class DbObject
    {
        public Guid Id { get; set; }
        public string Name { get; set; }
    }

    //Fake EF context you can switch with you own EF context
    private class FakeDbContext : DbContext
    {
        public FakeDbContext(DbConnection connection)
            : base(connection, true) { }

        public virtual DbSet<DbObject> DbObjects { get; set; }
    }

    private FakeDbContext _dbContext;

    public DbContextHelper()
    {
        //In memory DB connection
        DbConnection effortConnection = DbConnectionFactory.CreatePersistent("TestInstanceName");
        _dbContext = new FakeDbContext(effortConnection);
    }

    //You can expose your context instead of the DbContext base type
    public DbContext DbContext => _dbContext;

    public ObjectContext ObjectContext => ((IObjectContextAdapter)_dbContext).ObjectContext;

    //Method to add Fake object to the fake EF context
    public void AddEntityWithState(string value, EntityState entityState)
    {
        DbContext.Entry(new DbObject() { Id = Guid.NewGuid(), Name = value }).State = entityState;
    }
} 
```

用法：

```
DbContextHelper _dbContextHelper = new DbContextHelper();
_dbContextHelper.AddEntityWithState("added", System.Data.Entity.EntityState.Added);
_dbContextHelper.AddEntityWithState("added", System.Data.Entity.EntityState.Modified);

var objs = _dbContextHelper.ObjectContext.GetObjectStateEntries(EntityState.Modified | EntityState.Added); 
```

你在内存数据库中有你的对象。

# git - 有时 git 会在没有我要求的情况下将所有远程 git 分支跟踪为本地分支。发生了什么？

> ID：415433
> 
> 赞同：4
> 
> 时间：2009-01-06T04:12:20.587
> 
> 标签：git, branch, behavior

有时，git会自发地（在某些但不是全部“拉”或“克隆”操作期间）将存储库的所有远程分支复制到我的本地存储库中（甚至将它们全部设置为正确跟踪相应的远程分支） . 这是什么原因造成的？有没有办法我可以故意这样做？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-06T05:14:07.437

如果你只是从远程分支做一个普通的分支，它会默认跟踪：

```
git checkout -b somebranch origin/somebranch 
```

意思大致相同

```
git checkout -t origin/somebranch 
```

如果您不想要这样的跟踪，您几乎必须明确告诉它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-03-09T21:33:43.643

如果您知道要跟踪的远程分支的名称，您可以这样做：

```
git checkout somebranch 
```

它会说：

```
Branch somebranch set up to track remote branch badges from origin. 
```

# unit-testing - 自动化单元测试可以代替静态类型检查吗？

> ID：415434
> 
> 赞同：4
> 
> 时间：2009-01-06T04:12:30.180
> 
> 标签：unit-testing, tdd, static-typing

我已经开始研究整个单元测试/测试驱动的开发理念，我越想它似乎就越能扮演与静态类型检查类似的角色。这两种技术都为程序中的某些类型的错误提供了编译时、快速响应的检查。但是，如果我错了，请纠正我，但似乎具有完全覆盖的单元测试套件将测试静态类型检查将测试的所有内容，然后是一些。或者换一种说法，静态类型检查只是“证明”您的程序正确的部分方式，而单元测试将让您尽可能多地“证明”（在一定程度上）。

那么，如果您也使用单元测试，是否有任何理由使用具有静态类型检查的语言？[此处](https://stackoverflow.com/questions/236407/python-for-large-scale-development)提出了一个类似的问题，但我想更详细地介绍。静态类型检查相对于单元测试有哪些具体优势（如果有的话）？我想到了编译器优化和智能感知等一些问题，但是对于这些问题还有其他解决方案吗？还有其他我没有想到的优点/缺点吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-06T04:30:50.207

关于软件质量，有一个不变的事实。

> 如果无法编译，则无法发布

在这条规则中，静态类型语言将胜过动态类型语言。

好的，是的，这条规则不是一成不变的。Web 应用程序可以在不编译的情况下发布（我已经部署了许多未编译的测试 Web 应用程序）。但基本正确的是

> 越早发现错误，修复成本就越低

静态类型语言将防止在软件开发周期的最早可能时刻发生真正的错误。动态语言不会。单元测试，如果你彻底达到超人的水平，可以代替静态类型语言。

然而何必呢？有很多非常聪明的人以编译器的形式为您编写一个完整的错误检查系统。如果您担心尽快出错，请使用静态类型语言。

请不要将这篇文章视为对动态语言的抨击。我每天都使用动态语言并喜欢它们。它们具有令人难以置信的表现力和灵活性，并允许令人难以置信的程序。然而，在早期错误报告的情况下，它们确实输给了静态类型的语言。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-06T04:27:48.560

对于任何规模合理的项目，您不能仅通过单元测试来考虑所有情况。

所以我的回答是“不”，即使你设法解释了所有情况，你也因此首先破坏了使用动态语言的全部目的。

如果你想编写类型安全的程序，最好使用类型安全的语言。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-06T04:29:34.063

我认为自动化单元测试对动态类型语言很*重要*，但这并不意味着它将在您应用的上下文中取代静态类型检查。事实上，一些使用动态类型的人可能实际上正在使用它，因为他们*不*想要常量类型安全检查的麻烦。

动态类型语言相对于静态类型语言的优势远不止于测试，类型安全只是一方面。动态和静态类型语言的编程风格和设计差异也有很大差异。

此外，单元测试写得太用力强制类型安全意味着软件根本不应该是动态类型的，或者应用的设计应该用静态类型语言编写，而不是动态语言。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-06T04:42:59.590

拥有 100% 的代码覆盖率并不意味着您已经完全测试了您的应用程序。考虑以下代码：

```
if (qty > 3)
{
    applyShippingDiscount();
}
else
{
    chargeFullAmountForShipping();
} 
```

如果我输入 qty = 1 和 qty = 4 的值，我可以获得 100% 的代码覆盖率。

现在想象一下我的业务条件是“......对于 3 件或更多物品的订单，我要对运费应用折扣......”。然后我需要编写在边界上工作的测试。所以我会设计数量为 2,3 和 4 的测试。我仍然有 100% 的覆盖率，但更重要的是我在我的逻辑中发现了一个错误。

这就是我只关注代码覆盖率的问题。我认为充其量最终会导致开发人员根据业务规则创建一些初始测试。然后为了提​​高覆盖率，他们在设计新的测试用例时会参考他们的代码。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-06T06:08:51.117

清单类型（我想你的意思是）是规范的一种形式，单元测试要弱得多，因为它只提供示例。重要的区别在于规范声明了在任何情况下都必须保留的内容，而测试仅涵盖示例。你永远不能确定你的测试涵盖了所有的边界条件。

人们也倾向于忘记声明类型作为文档的价值。例如，如果 Java 方法返回 a `List<String>`，那么我立即知道我得到了什么，无需阅读文档、测试用例甚至方法代码本身。对于参数也是如此：如果声明了类型，那么我知道该方法期望什么。

声明局部变量类型的价值要低得多，因为在编写良好的代码中，变量存在的范围应该很小。但是，您仍然可以使用静态类型：而不是声明类型，而是让编译器推断它。[Scala](http://www.scala-lang.org/node/127)甚至[C#](http://www.danielmoth.com/Blog/2007/02/local-variable-type-inference-in-c-30.html)等语言都允许您这样做。

一些测试风格更接近规范，例如[QuickCheck](http://www.cs.chalmers.se/~rjmh/QuickCheck/)或它的 Scala 变体[ScalaCheck](http://code.google.com/p/scalacheck/)根据规范生成测试，试图猜测重要的边界。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-06T04:47:55.290

我会换一种说法——如果你没有静态类型的语言，如果你打算用那个代码做任何“真正的”事情，你*最好有非常彻底的单元测试。*

也就是说，静态类型（或者更确切地说，显式类型）比单元测试有一些显着的好处，这让我通常更喜欢它。它创建了更易于理解的 API，并允许以动态类型语言更困难的方式快速查看应用程序的“骨架”（即每个模块或代码部分的入口点）。

总结一下：在我看来，考虑到可靠、彻底的单元测试，动态类型语言和静态类型语言之间的选择主要是一种品味。有些人更喜欢一个；其他人更喜欢对方。为工作使用正确的工具。但这并不意味着它们是相同的——静态类型的语言总是在某些方面具有优势，而动态类型的语言总是在某些不同的方面具有优势。单元测试在最大限度地减少动态类型语言的缺点方面大有帮助，但它们并没有完全消除它们。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-06T05:30:41.507

不。

但这不是最重要的问题，最重要的问题是：做不到有关系吗？

考虑静态类型检查的目的：避免一类代码缺陷（bug）。然而，这必须在所有代码缺陷的更大领域的背景下进行权衡。最重要的不是狭隘的比较，而是对代码质量的深度和广度、编写正确代码的难易程度等进行比较。如果你能想出一种开发风格/流程，使你的团队能够产生更高的质量如果没有静态类型检查，代码效率更高，那么它是值得的。即使在测试中存在静态类型检查会发现的漏洞的情况下也是如此。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-06T04:23:00.330

如果你非常彻底，我想它可以。但是为什么要打扰呢？如果语言已经在检查以确保静态类型是正确的，那么测试它们就没有意义（因为您免费获得它）。

此外，如果您在 IDE 中使用静态类型语言，IDE 甚至可以在编译测试之前为您提供错误和警告。我不确定是否有任何自动化单元测试应用程序可以做到这一点。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-06T04:28:37.170

鉴于动态、后期绑定语言的所有好处，我想这是单元测试提供的价值之一。您仍然需要仔细和有意地编码，但这是任何类型的编码恕我直言的第一要求。能够编写清晰简单的测试有助于证明您的设计和实现的清晰性和简单性。它还为以后看到您的代码的人提供了有用的线索。但我不认为我会指望它来检测不匹配的类型。但在实践中，我并没有发现类型检查真的能捕捉到很多真正的错误。如果您首先拥有清晰简单的编码风格，那么我发现这不是在实际代码中发生的一种错误。

对于 javascript，我希望 jsLint 会发现几乎所有类型检查问题。主要是通过建议替代编码样式来减少您的曝光率。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-11-13T06:46:16.287

类型检查有助于在系统中的组件*之间强制执行合同。*单元测试（顾名思义）验证组件的*内部*逻辑。

对于单个代码单元，我认为单元测试确实可以使静态类型检查变得不必要。但是在一个复杂的系统中，自动化测试无法验证系统不同组件可能交互的所有多种方式。为此，使用*接口*（从某种意义上说，是组件之间的一种“契约”）成为减少潜在错误的有用工具。并且接口需要编译时类型检查。

我真的很喜欢用动态语言编程，所以我当然不会抨击动态类型。这只是我最近遇到的一个问题。不幸的是，我在将动态语言用于大型复杂系统方面并没有任何经验，所以我很想听听其他人的意见，这个问题是真实的，还是仅仅是理论上的。

# iphone - iPhone（SDK 2.2）：在不主动播放带有 AVFoundation 的音乐时调整播放音量？

> ID：415442
> 
> 赞同：4
> 
> 时间：2009-01-06T04:16:34.400
> 
> 标签：iphone, cocoa-touch, audio, volume, avfoundation

所以我有一个可以播放许多短声音片段的应用程序。我需要知道声音何时播放完毕，并且我需要使用 mp3，所以我使用 AVFoundation 进行声音播放。

当声音正在播放时，并且用户使用硬件音量按钮，播放音量会发生变化。问题是，该应用程序不会一直播放声音，如果不是，并且使用了硬件按钮，则会调整 RINGER 音量。

我该如何设置，只要应用程序在运行，用户就可以调节播放音量？

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T03:06:01.453

事实证明，这可以通过`AVAudioPlayer`使用任何有效的声音文件分配一个并调用该`prepareToPlay`方法来完成，而无需调用该`play`方法。

完美运行。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-12-08T12:35:35.333

[启动 AudioSession](http://developer.apple.com/IPhone/library/documentation/AVFoundation/Reference/AVAudioSession_ClassReference/Reference/Reference.html#//apple_ref/occ/instm/AVAudioSession/setActive:error:)并且在不播放声音时不要停止它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-06T21:46:03.253

所以你想在应用程序运行时禁用铃声播放音量？因此硬件控件只会调整应用程序的播放声音？

我认为这是不可能的，除非你“总是在播放声音”，例如，许多游戏总是在播放背景音乐或你有什么。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-07T00:37:18.040

只要您的应用程序正在运行，您就可以通过不断播放 0 音量的声音来完成此操作。然后你可以在它上面播放你的声音片段。

*   [如何同时播放多个声音？](http://developer.apple.com/iphone/library/codinghowtos/AudioAndVideo/index.html#PLAYBACK-PLAY_MULTIPLE_SOUNDS_SIMULTANEOUSLY)

# c - C中的面向对象

> ID：415452
> 
> 赞同：171
> 
> 时间：2009-01-06T04:26:16.003
> 
> 标签：c, oop, object

什么是一组漂亮的预处理器黑客（ANSI C89/ISO C90 兼容）在 C 中启用某种丑陋（但可用）的面向对象？

我熟悉几种不同的面向对象语言，所以请不要回答“学习 C++！”之类的答案。我已经阅读了“[使用 ANSI C 进行面向对象编程](http://www.planetpdf.com/codecuts/pdfs/ooc.pdf "使用 ANSI C 的面向对象编程")”（注意：**PDF 格式**）和其他一些有趣的解决方案，但我最感兴趣的是你的 :-)！

* * *

另请参阅*[您可以用 C 编写面向对象的代码吗？](https://stackoverflow.com/questions/351733 "你能用C写面向对象的代码吗？")*

* * *

## 回答 #1

> 赞同：199
> 
> 时间：2009-01-06T05:09:55.010

我建议不要使用预处理器 (ab) 来尝试使 C 语法更像另一种更面向对象的语言。在最基本的层面上，您只需使用普通结构作为对象并通过指针传递它们：

```
struct monkey
{
    float age;
    bool is_male;
    int happiness;
};

void monkey_dance(struct monkey *monkey)
{
    /* do a little dance */
} 
```

要获得诸如继承和多态之类的东西，您必须更加努力。您可以通过使结构的第一个成员成为超类的实例来进行手动继承，然后您可以自由地转换指向基类和派生类的指针：

```
struct base
{
    /* base class members */
};

struct derived
{
    struct base super;
    /* derived class members */
};

struct derived d;
struct base *base_ptr = (struct base *)&d;  // upcast
struct derived *derived_ptr = (struct derived *)base_ptr;  // downcast 
```

要获得多态性（即虚函数），您可以使用函数指针，以及可选的函数指针表，也称为虚表或 vtables：

```
struct base;
struct base_vtable
{
    void (*dance)(struct base *);
    void (*jump)(struct base *, int how_high);
};

struct base
{
    struct base_vtable *vtable;
    /* base members */
};

void base_dance(struct base *b)
{
    b->vtable->dance(b);
}

void base_jump(struct base *b, int how_high)
{
    b->vtable->jump(b, how_high);
}

struct derived1
{
    struct base super;
    /* derived1 members */
};

void derived1_dance(struct derived1 *d)
{
    /* implementation of derived1's dance function */
}

void derived1_jump(struct derived1 *d, int how_high)
{
    /* implementation of derived 1's jump function */
}

/* global vtable for derived1 */
struct base_vtable derived1_vtable =
{
    &derived1_dance, /* you might get a warning here about incompatible pointer types */
    &derived1_jump   /* you can ignore it, or perform a cast to get rid of it */
};

void derived1_init(struct derived1 *d)
{
    d->super.vtable = &derived1_vtable;
    /* init base members d->super.foo */
    /* init derived1 members d->foo */
}

struct derived2
{
    struct base super;
    /* derived2 members */
};

void derived2_dance(struct derived2 *d)
{
    /* implementation of derived2's dance function */
}

void derived2_jump(struct derived2 *d, int how_high)
{
    /* implementation of derived2's jump function */
}

struct base_vtable derived2_vtable =
{
   &derived2_dance,
   &derived2_jump
};

void derived2_init(struct derived2 *d)
{
    d->super.vtable = &derived2_vtable;
    /* init base members d->super.foo */
    /* init derived1 members d->foo */
}

int main(void)
{
    /* OK!  We're done with our declarations, now we can finally do some
       polymorphism in C */
    struct derived1 d1;
    derived1_init(&d1);

    struct derived2 d2;
    derived2_init(&d2);

    struct base *b1_ptr = (struct base *)&d1;
    struct base *b2_ptr = (struct base *)&d2;

    base_dance(b1_ptr);  /* calls derived1_dance */
    base_dance(b2_ptr);  /* calls derived2_dance */

    base_jump(b1_ptr, 42);  /* calls derived1_jump */
    base_jump(b2_ptr, 42);  /* calls derived2_jump */

    return 0;
} 
```

这就是你在 C 中做多态性的方式。它不是很漂亮，但它可以完成工作。有一些棘手的问题涉及基类和派生类之间的指针转换，只要基类是派生类的第一个成员，这些都是安全的。多重继承要困难得多——在这种情况下，为了在除第一个以外的基类之间区分大小写，您需要根据适当的偏移量手动调整指针，这确实很棘手且容易出错。

您可以做的另一件（棘手的）事情是在运行时更改对象的动态类型！您只需为它重新分配一个新的 vtable 指针。您甚至可以有选择地更改一些虚函数，同时保留其他虚函数，从而创建新的混合类型。只是要小心创建一个新的 vtable 而不是修改全局 vtable，否则你会意外地影响给定类型的所有对象。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-01-06T04:28:55.403

我曾经使用过一个 C 库，该库的实现方式让我觉得非常优雅。他们用 C 语言编写了一种定义对象的方法，然后从它们继承，以便它们像 C++ 对象一样可扩展。基本思想是这样的：

*   每个对象都有自己的文件
*   公共函数和变量在对象的 .h 文件中定义
*   私有变量和函数仅位于 .c 文件中
*   为了“继承”一个新结构，结构的第一个成员是要继承的对象

继承很难描述，但基本上是这样的：

```
struct vehicle {
   int power;
   int weight;
} 
```

然后在另一个文件中：

```
struct van {
   struct vehicle base;
   int cubic_size;
} 
```

然后你可以在内存中创建一辆面包车，并被只知道车辆的代码使用：

```
struct van my_van;
struct vehicle *something = &my_van;
vehicle_function( something ); 
```

它工作得很好，.h 文件准确地定义了您应该能够对每个对象执行的操作。

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2009-01-06T07:51:10.443

[C 对象系统 (COS)](https://github.com/CObjectSystem/COS)听起来很有希望（它仍处于 alpha 版本）。为了简单和灵活，它尽量减少可用的概念：统一的面向对象编程，包括开放类、元类、属性元类、泛型、多方法、委托、所有权、异常、合同和闭包。有一份[草稿文件](http://cern.ch/laurent.deniau/html/cos-oopsla07-draft.pdf)(PDF) 对其进行了描述。

[C 中的异常](http://cern.ch/laurent.deniau/html/exception.tgz)是在其他 OO 语言中发现的 TRY-CATCH-FINALLY 的 C89 实现。它带有一个测试套件和一些示例。

两者都由 Laurent Deniau 撰写，他[在 C 语言的 OOP 方面](http://ldeniau.web.cern.ch/ldeniau/html/oopc.html)做了很多工作。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2009-01-06T05:06:40.650

用于 Linux 的 GNOME 桌面是用面向对象的 C 语言编写的，它有一个名为“ [GObject](http://library.gnome.org/devel/gobject/unstable/) ”的对象模型，它支持属性、继承、多态以及其他一些好东西，如引用、事件处理（称为“信号”）、运行时打字，私人数据等。

它包括预处理器黑客来做一些事情，比如在类层次结构中进行类型转换等。这是我为 GNOME 编写的一个示例类（gchar 之类的东西是 typedefs）：

[类源](http://gnome-screensaver.sourcearchive.com/documentation/2.14.3/fusa-user_8c-source.html)

[类头](http://gnome-screensaver.sourcearchive.com/documentation/2.14.3/fusa-user_8h-source.html)

在 GObject 结构内部有一个 GType 整数，它用作 GLib 的动态类型系统的幻数（您可以将整个结构转换为“GType”以找到它的类型）。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-08-05T09:55:58.153

有点题外话，但最初的 C++ 编译器[Cfront](https://en.wikipedia.org/wiki/Cfront)将 C++ 编译为 C，然后编译为汇编程序。

保存[在这里](http://www.softwarepreservation.org/projects/c_plus_plus/cfront)。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-01-06T05:04:55.380

如果您将在对象上调用的方法视为将隐式 ' ' 传递`this`给函数的静态方法，则可以使 C 中的 OO 思维变得更容易。

例如：

```
String s = "hi";
System.out.println(s.length()); 
```

变成：

```
string s = "hi";
printf(length(s)); // pass in s, as an implicit this 
```

或类似的东西。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-01-06T05:14:39.540

在我知道 OOP 是什么之前，我曾经在 C 中做这种事情。

以下是一个示例，它实现了一个按需增长的数据缓冲区，给定了最小大小、增量和最大大小。这个特定的实现是基于“元素”的，也就是说，它被设计为允许任何 C 类型的类似列表的集合，而不仅仅是可变长度的字节缓冲区。

这个想法是使用 xxx_crt() 实例化对象并使用 xxx_dlt() 删除该对象。每个“成员”方法都需要一个特定类型的指针来操作。

我以这种方式实现了一个链表、循环缓冲区和许多其他的东西。

我必须承认，我从来没有考虑过如何用这种方法实现继承。我想 Kieveli 提供的一些混合可能是一条好路。

dtb.c：

```
#include <limits.h>
#include <string.h>
#include <stdlib.h>

static void dtb_xlt(void *dst, const void *src, vint len, const byte *tbl);

DTABUF *dtb_crt(vint minsiz,vint incsiz,vint maxsiz) {
    DTABUF          *dbp;

    if(!minsiz) { return NULL; }
    if(!incsiz)                  { incsiz=minsiz;        }
    if(!maxsiz || maxsiz<minsiz) { maxsiz=minsiz;        }
    if(minsiz+incsiz>maxsiz)     { incsiz=maxsiz-minsiz; }
    if((dbp=(DTABUF*)malloc(sizeof(*dbp))) == NULL) { return NULL; }
    memset(dbp,0,sizeof(*dbp));
    dbp->min=minsiz;
    dbp->inc=incsiz;
    dbp->max=maxsiz;
    dbp->siz=minsiz;
    dbp->cur=0;
    if((dbp->dta=(byte*)malloc((vuns)minsiz)) == NULL) { free(dbp); return NULL; }
    return dbp;
    }

DTABUF *dtb_dlt(DTABUF *dbp) {
    if(dbp) {
        free(dbp->dta);
        free(dbp);
        }
    return NULL;
    }

vint dtb_adddta(DTABUF *dbp,const byte *xlt256,const void *dtaptr,vint dtalen) {
    if(!dbp) { errno=EINVAL; return -1; }
    if(dtalen==-1) { dtalen=(vint)strlen((byte*)dtaptr); }
    if((dbp->cur + dtalen) > dbp->siz) {
        void        *newdta;
        vint        newsiz;

        if((dbp->siz+dbp->inc)>=(dbp->cur+dtalen)) { newsiz=dbp->siz+dbp->inc; }
        else                                       { newsiz=dbp->cur+dtalen;   }
        if(newsiz>dbp->max) { errno=ETRUNC; return -1; }
        if((newdta=realloc(dbp->dta,(vuns)newsiz))==NULL) { return -1; }
        dbp->dta=newdta; dbp->siz=newsiz;
        }
    if(dtalen) {
        if(xlt256) { dtb_xlt(((byte*)dbp->dta+dbp->cur),dtaptr,dtalen,xlt256); }
        else       { memcpy(((byte*)dbp->dta+dbp->cur),dtaptr,(vuns)dtalen);   }
        dbp->cur+=dtalen;
        }
    return 0;
    }

static void dtb_xlt(void *dst,const void *src,vint len,const byte *tbl) {
    byte            *sp,*dp;

    for(sp=(byte*)src,dp=(byte*)dst; len; len--,sp++,dp++) { *dp=tbl[*sp]; }
    }

vint dtb_addtxt(DTABUF *dbp,const byte *xlt256,const byte *format,...) {
    byte            textÝ501¨;
    va_list         ap;
    vint            len;

    va_start(ap,format); len=sprintf_len(format,ap)-1; va_end(ap);
    if(len<0 || len>=sizeof(text)) { sprintf_safe(text,sizeof(text),"STRTOOLNG: %s",format); len=(int)strlen(text); }
    else                           { va_start(ap,format); vsprintf(text,format,ap); va_end(ap);                     }
    return dtb_adddta(dbp,xlt256,text,len);
    }

vint dtb_rmvdta(DTABUF *dbp,vint len) {
    if(!dbp) { errno=EINVAL; return -1; }
    if(len > dbp->cur) { len=dbp->cur; }
    dbp->cur-=len;
    return 0;
    }

vint dtb_reset(DTABUF *dbp) {
    if(!dbp) { errno=EINVAL; return -1; }
    dbp->cur=0;
    if(dbp->siz > dbp->min) {
        byte *newdta;
        if((newdta=(byte*)realloc(dbp->dta,(vuns)dbp->min))==NULL) {
            free(dbp->dta); dbp->dta=null; dbp->siz=0;
            return -1;
            }
        dbp->dta=newdta; dbp->siz=dbp->min;
        }
    return 0;
    }

void *dtb_elmptr(DTABUF *dbp,vint elmidx,vint elmlen) {
    if(!elmlen || (elmidx*elmlen)>=dbp->cur) { return NULL; }
    return ((byte*)dbp->dta+(elmidx*elmlen));
    } 
```

dtb.h

```
typedef _Packed struct {
    vint            min;                /* initial size                       */
    vint            inc;                /* increment size                     */
    vint            max;                /* maximum size                       */
    vint            siz;                /* current size                       */
    vint            cur;                /* current data length                */
    void            *dta;               /* data pointer                       */
    } DTABUF;

#define dtb_dtaptr(mDBP)                (mDBP->dta)
#define dtb_dtalen(mDBP)                (mDBP->cur)

DTABUF              *dtb_crt(vint minsiz,vint incsiz,vint maxsiz);
DTABUF              *dtb_dlt(DTABUF *dbp);
vint                dtb_adddta(DTABUF *dbp,const byte *xlt256,const void *dtaptr,vint dtalen);
vint                dtb_addtxt(DTABUF *dbp,const byte *xlt256,const byte *format,...);
vint                dtb_rmvdta(DTABUF *dbp,vint len);
vint                dtb_reset(DTABUF *dbp);
void                *dtb_elmptr(DTABUF *dbp,vint elmidx,vint elmlen); 
```

PS：vint 只是 int 的 typedef - 我用它来提醒我它的长度因平台而异（用于移植）。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2015-01-08T16:04:38.777

我认为 Adam Rosenfield 发布的是在 C 中执行 OOP 的正确方法。我想补充一点，他展示的是对象的实现。换句话说，实际的实现将放在`.c`文件中，而接口将放在头`.h`文件中。例如，使用上面的猴子示例：

界面如下所示：

```
//monkey.h

    struct _monkey;

    typedef struct _monkey monkey;

    //memory management
    monkey * monkey_new();
    int monkey_delete(monkey *thisobj);
    //methods
    void monkey_dance(monkey *thisobj); 
```

您可以在界面`.h`文件中看到您只定义原型。然后您可以将实现部分“`.c`文件”编译成静态或动态库。这会创建封装，您也可以随意更改实现。对象的用户几乎不需要知道它的实现。这也将重点放在对象的整体设计上。

我个人认为 oop 是一种概念化代码结构和可重用性的方式，与添加到 c++ 中的其他内容（如重载或模板）实际上无关。是的，这些都是非常有用的特性，但它们并不代表真正的面向对象编程。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-01-06T04:31:34.980

[ffmpeg](http://www.ffmpeg.org/)（视频处理工具包）是用纯 C（和汇编语言）编写的，但使用面向对象的风格。它充满了带有函数指针的结构。有一组工厂函数使用适当的“方法”指针初始化结构。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2013-06-02T15:56:54.883

如果您真的仔细考虑，即使是标准 C 库也使用 OOP -`FILE *`以示例为例：`fopen()`初始化一个`FILE *`对象，然后您使用它使用成员方法`fscanf()`、`fprintf()`、和其他方法`fread()`，`fwrite()`并最终使用`fclose()`.

您也可以使用伪 Objective-C 方式，这也不难：

```
typedef void *Class;

typedef struct __class_Foo
{
    Class isa;
    int ivar;
} Foo;

typedef struct __meta_Foo
{
    Foo *(*alloc)(void);
    Foo *(*init)(Foo *self);
    int (*ivar)(Foo *self);
    void (*setIvar)(Foo *self);
} meta_Foo;

meta_Foo *class_Foo;

void __meta_Foo_init(void) __attribute__((constructor));
void __meta_Foo_init(void)
{
    class_Foo = malloc(sizeof(meta_Foo));
    if (class_Foo)
    {
        class_Foo = {__imp_Foo_alloc, __imp_Foo_init, __imp_Foo_ivar, __imp_Foo_setIvar};
    }
}

Foo *__imp_Foo_alloc(void)
{
    Foo *foo = malloc(sizeof(Foo));
    if (foo)
    {
        memset(foo, 0, sizeof(Foo));
        foo->isa = class_Foo;
    }
    return foo;
}

Foo *__imp_Foo_init(Foo *self)
{
    if (self)
    {
        self->ivar = 42;
    }
    return self;
}
// ... 
```

要使用：

```
int main(void)
{
    Foo *foo = (class_Foo->init)((class_Foo->alloc)());
    printf("%d\n", (foo->isa->ivar)(foo)); // 42
    foo->isa->setIvar(foo, 60);
    printf("%d\n", (foo->isa->ivar)(foo)); // 60
    free(foo);
} 
```

如果使用相当老的 Objective-C-to-C 翻译器，这可能是由像这样的一些 Objective-C 代码导致的：

```
@interface Foo : NSObject
{
    int ivar;
}
- (int)ivar;
- (void)setIvar:(int)ivar;
@end

@implementation Foo
- (id)init
{
    if (self = [super init])
    {
        ivar = 42;
    }
    return self;
}
@end

int main(void)
{
    Foo *foo = [[Foo alloc] init];
    printf("%d\n", [foo ivar]);
    [foo setIvar:60];
    printf("%d\n", [foo ivar]);
    [foo release];
} 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2013-10-10T19:59:19.917

我的建议：保持简单。我遇到的最大问题之一是维护旧软件（有时超过 10 年）。如果代码不简单，可能会很困难。是的，可以用 C 语言编写具有多态性的非常有用的 OOP，但它可能难以阅读。

我更喜欢封装一些定义明确的功能的简单对象。一个很好的例子是[GLIB2](https://developer.gnome.org/glib/)，例如一个哈希表：

```
GHastTable* my_hash = g_hash_table_new(g_str_hash, g_str_equal);
int size = g_hash_table_size(my_hash);
...

g_hash_table_remove(my_hash, some_key); 
```

关键是：

1.  简单的架构和设计模式
2.  实现基本的OOP封装。
3.  易于实施、阅读、理解和维护

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2017-05-30T01:21:29.030

我在这里聚会有点晚了，但我喜欢避免*两个*宏极端 - 太多或太多混淆代码，但是几个明显的宏可以使 OOP 代码更容易开发和阅读：

```
/*
 * OOP in C
 *
 * gcc -o oop oop.c
 */

#include <stdio.h>
#include <stdlib.h>
#include <math.h>

struct obj2d {
    float x;                            // object center x
    float y;                            // object center y
    float (* area)(void *);
};

#define X(obj)          (obj)->b1.x
#define Y(obj)          (obj)->b1.y
#define AREA(obj)       (obj)->b1.area(obj)

void *
_new_obj2d(int size, void * areafn)
{
    struct obj2d * x = calloc(1, size);
    x->area = areafn;
    // obj2d constructor code ...
    return x;
}

// --------------------------------------------------------

struct rectangle {
    struct obj2d b1;        // base class
    float width;
    float height;
    float rotation;
};

#define WIDTH(obj)      (obj)->width
#define HEIGHT(obj)     (obj)->height

float rectangle_area(struct rectangle * self)
{
    return self->width * self->height;
}

#define NEW_rectangle()  _new_obj2d(sizeof(struct rectangle), rectangle_area)

// --------------------------------------------------------

struct triangle {
    struct obj2d b1;
    // deliberately unfinished to test error messages
};

#define NEW_triangle()  _new_obj2d(sizeof(struct triangle), triangle_area)

// --------------------------------------------------------

struct circle {
    struct obj2d b1;
    float radius;
};

#define RADIUS(obj)     (obj)->radius

float circle_area(struct circle * self)
{
    return M_PI * self->radius * self->radius;
}

#define NEW_circle()     _new_obj2d(sizeof(struct circle), circle_area)

// --------------------------------------------------------

#define NEW(objname)            (struct objname *) NEW_##objname()

int
main(int ac, char * av[])
{
    struct rectangle * obj1 = NEW(rectangle);
    struct circle    * obj2 = NEW(circle);

    X(obj1) = 1;
    Y(obj1) = 1;

    // your decision as to which of these is clearer, but note above that
    // macros also hide the fact that a member is in the base class

    WIDTH(obj1)  = 2;
    obj1->height = 3;

    printf("obj1 position (%f,%f) area %f\n", X(obj1), Y(obj1), AREA(obj1));

    X(obj2) = 10;
    Y(obj2) = 10;
    RADIUS(obj2) = 1.5;
    printf("obj2 position (%f,%f) area %f\n", X(obj2), Y(obj2), AREA(obj2));

    // WIDTH(obj2)  = 2;                                // error: struct circle has no member named width
    // struct triangle  * obj3 = NEW(triangle);         // error: triangle_area undefined
} 
```

我认为这有一个很好的平衡，它产生的错误（至少使用默认的 gcc 6.3 选项）对于一些更可能的错误是有帮助的，而不是令人困惑。重点是提高程序员的生产力，不是吗？

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-01-06T08:15:14.230

如果我要在 CI 中编写 OOP，可能会采用伪[Pimpl](https://en.wikipedia.org/wiki/Opaque_pointer)设计。您最终将指针传递给指向结构的指针，而不是传递指向结构的指针。这使得内容不透明并促进多态性和继承。

C 中 OOP 的真正问题是当变量退出作用域时会发生什么。没有编译器生成的析构函数，这可能会导致问题。[宏](https://en.wikipedia.org/wiki/C_preprocessor)可能会有所帮助，但看起来总是很难看。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-07-24T10:10:34.873

```
#include "triangle.h"
#include "rectangle.h"
#include "polygon.h"

#include <stdio.h>

int main()
{
    Triangle tr1= CTriangle->new();
    Rectangle rc1= CRectangle->new();

    tr1->width= rc1->width= 3.2;
    tr1->height= rc1->height= 4.1;

    CPolygon->printArea((Polygon)tr1);

    printf("\n");

    CPolygon->printArea((Polygon)rc1);
} 
```

输出：

```
6.56
13.12 
```

这里展示了什么是用 C 进行的 OO 编程。

这是真正的纯 C，没有预处理器宏。我们有继承、多态和数据封装（包括类或对象私有的数据）。受保护的限定符等价物没有机会，也就是说，私有数据在继承链中也是私有的。但这不是不便，因为我认为没有必要。

`CPolygon`没有被实例化，因为我们只使用它来操作继承链下游的对象，这些对象具有共同的方面但它们的不同实现（多态性）。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2019-03-07T17:19:09.287

我也在基于一个宏观解决方案来解决这个问题。所以它只适用于最勇敢的人，我猜 ;-) 但它已经很不错了，而且我已经在它之上进行了一些项目。它的工作原理是，您首先为每个类定义一个单独的头文件。像这样：

```
#define CLASS Point
#define BUILD_JSON

#define Point__define                            \
    METHOD(Point,public,int,move_up,(int steps)) \
    METHOD(Point,public,void,draw)               \
                                                 \
    VAR(read,int,x,JSON(json_int))               \
    VAR(read,int,y,JSON(json_int))               \ 
```

要实现这个类，你需要为它创建一个头文件和一个你实现方法的 C 文件：

```
METHOD(Point,public,void,draw)
{
    printf("point at %d,%d\n", self->x, self->y);
} 
```

在您为该类创建的标题中，您包含您需要的其他标题并定义与该类相关的类型等。在类头文件和 C 文件中都包含类规范文件（参见第一个代码示例）和一个 X 宏。这些 X 宏（[1](https://github.com/plainC/wondermacros/blob/master/wondermacros/objects/x/class.h)、[2](https://github.com/plainC/wondermacros/blob/master/wondermacros/objects/x/object_instance.h)、[3](https://github.com/plainC/wondermacros/blob/master/wondermacros/objects/x/new.h)等）会将代码扩展为实际的类结构和其他声明。

继承一个类，`#define SUPER supername`并`supername__define \`作为类定义的第一行添加。两者都必须在那里。还有 JSON 支持、信号、抽象类等。

要创建一个对象，只需使用`W_NEW(classname, .x=1, .y=2,...)`. 初始化基于 C11 中引入的结构初始化。它运行良好，未列出的所有内容都设置为零。

要调用方法，请使用`W_CALL(o,method)(1,2,3)`. 它看起来像一个高阶函数调用，但它只是一个宏。它扩展到`((o)->klass->method(o,1,2,3))`这是一个非常好的黑客。

请参阅[文档](https://github.com/plainC/wondermacros/blob/master/docs/objects.md)和[代码本身](https://github.com/plainC/wondermacros)。

由于该框架需要一些样板代码，因此我编写了一个 Perl 脚本 (wobject) 来完成这项工作。如果你使用它，你可以写

```
class Point
    public int move_up(int steps)
    public void draw()
    read int x
    read int y 
```

它将创建类规范文件、类头和一个 C 文件，其中包括`Point_impl.c`您实现类的位置。如果你有很多简单的类，但一切都在 C 中，它可以节省很多工作。[wobject](https://github.com/plainC/wondermacros/blob/master/tools/wobject)是一个非常简单的基于正则表达式的扫描器，它很容易适应特定需求，或者从头开始重写。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2019-04-17T09:42:00.930

使用 C 以面向对象的风格进行编程的另一种方法是使用代码生成器，它将特定领域的语言转换为 C。就像使用 TypeScript 和 JavaScript 将 OOP 引入 js 一样。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2020-02-02T12:36:53.060

您可以尝试[COOP](https://github.com/ShmuelFine/COOP)，这是一个程序员友好的 C 语言 OOP 框架，具有类、异常、多态性和内存管理（对于嵌入式代码很重要）。这是一种相对轻量级的语法，请参阅那里[的 Wiki 中的教程](https://github.com/ShmuelFine/COOP/wiki)。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-01-06T05:47:58.880

对我来说，C 中的面向对象应该具有以下特性：

1.  封装和数据隐藏（可以使用结构/不透明指针来实现）

2.  多态性的继承和支持（可以使用结构来实现单一继承——确保抽象基类不可实例化）

3.  构造函数和析构函数（不容易实现）

4.  类型检查（至少对于用户定义的类型，因为 C 不强制）

5.  引用计数（或实现[RAII](https://en.wikipedia.org/wiki/Resource_Acquisition_Is_Initialization)的东西）

6.  对异常处理的有限支持（setjmp 和 longjmp）

除此之外，它应该依赖于 ANSI/ISO 规范，而不应该依赖于编译器特定的功能。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2014-03-31T07:38:54.773

@Adam Rosenfield 很好地解释了如何使用 C 实现 OOP

此外，我建议您阅读

1）[pjsip](http://www.pjsip.org/)

一个非常好的用于 VoIP 的 C 库。您可以通过结构和函数指针表了解它如何实现 OOP

2) [iOS 运行时](http://www.slideshare.net/mudphone/what-makes-objective-c-dynamic)

了解 iOS Runtime 如何为 Objective C 提供支持。它通过 isa 指针、元类实现 OOP

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2016-08-08T12:39:35.183

查看[http://ldeniau.web.cern.ch/ldeniau/html/oopc/oopc.html](http://ldeniau.web.cern.ch/ldeniau/html/oopc/oopc.html)。如果没有别的，通读文档是一种启发性的体验。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2017-08-25T23:58:40.057

如果你需要写一点代码试试这个：[https ://github.com/fulminati/class-framework](https://github.com/fulminati/class-framework)

```
#include "class-framework.h"

CLASS (People) {
    int age;
};

int main()
{
    People *p = NEW (People);

    p->age = 10;

    printf("%d\n", p->age);
} 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2019-03-27T21:25:03.930

开源 Dynace 项目正是这样做的。它位于[https://github.com/blakemcbride/Dynace](https://github.com/blakemcbride/Dynace)

# project-management - 一个团队可以在没有项目经理的情况下以可预测的方式运作并（按时）交付吗？

> ID：415454
> 
> 赞同：2
> 
> 时间：2009-01-06T04:27:04.130
> 
> 标签：project-management, target

或者他们（团队成员）需要有人继续推动？

编辑：

1.  上面这句话应该是讽刺的好笑。很抱歉把你们赶走。
2.  我更多地谈论的是在团队内分配工作，而不是让一个人承担和/或执行项目管理活动。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-06T04:31:02.420

您可能不需要项目经理作为专属角色（取决于相关项目的规模），但您确实需要有人来跟踪活动并确保每个人都达到他们的目标，并为瓶颈分配额外的资源。在一个大型项目中，这是一份全职工作，你需要有人来做这件事。在较小的项目中，除了其他贡献之外，其中一名团队成员可以执行此操作。当然，项目经理实际上是团队的成员，但我假设团队成员指的是计算组。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-06T04:32:38.457

如果你有一个自我监管的团队，它绝对是可行的。我曾参与过团队似乎比经理更符合时间线的项目......

此外，我确信有很多中小型开源项目的示例在没有官方项目经理的情况下发布。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-06T04:35:10.727

取决于团队，以及他们如何一起工作

我曾与自组织、相互激励并迅速交付的敏捷团队合作，所有这些都没有项目经理

我还与拥有项目经理、业务分析师、质量保证团队、网络管理团队、数据库管理员等的团队合作，这些团队交付延迟且质量不佳——主要是因为“不能拒绝客户是你的老板”因素

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-06T04:33:21.667

他们可以：当然可以。有一些特殊的人格类型可以在很少或没有监督的情况下按时工作。

这是个好主意吗：可能不是。将在这种环境中发挥高水平作用的人很少，而且相差甚远。一旦你有超过 2-3 个人在一个项目上工作，你就会开始引入需要监督的人。那时a）其中一名程序员将成为事实上的项目经理，b）这个人不会为他们的全部潜力做出贡献，或者c）你不会发货:)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-06T16:07:39.923

是的，至少在某种程度上，正如我在最近[的会议避免自我管理开发者](http://www.lunatech-research.com/archives/2008/12/05/lunatech-at-devoxx-2008)大会演示文稿中所解释的那样。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-06T04:30:03.640

与其说是推动，不如说是计划前进的道路。*必须有人*弄清楚将要构建的东西的顺序，依赖关系是什么，需要什么资源等。如果不是由专门的项目经理完成，那么团队将不得不自己做。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-06T04:30:26.353

这是可能的。

只是不太可能。

然而，一个糟糕的 PM 肯定会阻止团队按预期运作并按时交付。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-06T04:32:35.630

我认为团队很可能会到达一个目的地，但没有代理 PM 或 PM，谁知道那个目的地会是什么。

PM 让人们按时完成目标，然后在目标移动而错过计划时进行调整。在更多情况下，依靠团队进行分组交流可能注定会遇到麻烦。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-06T04:41:53.820

这取决于谁是团队的成员。如果团队中充满了新手或流浪者，那么项目就没有未来，但如果有积极的程序员专注并尊重他们的目标，他们可以提供超出预期的东西。

以乔皮博迪为例，他雇佣了一个程序员团队，让他们发疯，赚了几百万美元（至少这是他在从 Tripod 成为百万富翁后写的书中所说的）。这本书是“幸运或聪明”

所以就像我说的，这取决于团队。

# language-agnostic - 任何用于模式匹配和重写源代码的软件？

> ID：415455
> 
> 赞同：7
> 
> 时间：2009-01-06T04:27:24.487
> 
> 标签：language-agnostic, templates, pattern-matching

我有一些旧软件（使用的语言还没有死，但对我来说已经死了;-)）为源代码实现了基本的模式匹配和重写系统。我正在考虑恢复这段代码，将其翻译成现代语言，并将项目作为重构动力工具开源。在我走得更远之前，我想知道这样的事情是否已经存在（我的 google-fu 今晚正在宣传这件事）。

以下是它的工作原理：

*   模式匹配部分使用具有绑定变量的模板匹配跨越多行代码的源代码模式，
*   模式重写部分使用模板重写匹配的代码，从匹配的模板插入绑定变量的内容
*   匹配和重写模板通过一个简单的（无条件的）重写规则关联（1:1）

该软件对输入应用程序的抽象语法树 (AST) 进行操作，并输出修改后的 AST，然后可以将其重新生成为新的源代码

例如，假设我们发现一堆真正应该是 for 循环的 while 循环。以下模板将匹配 while-loop 模式：

```
Template oldLoopPtrn
    int @cnt@ = 0;
    while (@cnt@ < @max@)
    {
        … @body@
        ++@cnt@;
    }
End_Template 
```

而以下模板将指定输出重写模式：

```
Template newLoopPtrn
    for(int @cnt@ = 0; @cnt@ < @max@; @cnt@++)
    {
        @body@
    }
End_Template 
```

和一个简单的规则来关联它们

```
Rule oldLoopPtrn --> newLoopPtrn 
```

所以看起来像这样的代码

```
int i=0;
while(i<arrlen)
{
    printf("element %d: %f\n",i,arr[i]);
    ++i;
} 
```

自动改写成这样

```
for(int i = 0; i < arrlen; i++)
{
    printf("element %d: %f\n",i,arr[i]);
} 
```

我见过的最接近这样的东西是一些代码重构工具，但它们似乎是针对选定片段的交互式重写，而不是大规模的自动更改。

我相信这种工具可以增强重构，并且可以在多种语言（甚至 HTML/CSS）上工作。我也相信转换和完善代码库将是一个巨大的项目，我根本无法在任何合理的时间内单独完成。

那么，已经有类似的东西了吗？如果没有，是否需要考虑任何明显的特征（除了重写规则条件）？

编辑：我非常喜欢这个系统的一个特点是模板模式相当明显且易于阅读，因为*它们是用与目标源代码相同的语言编写的*，而不是一些深奥的变异正则表达式/BNF 格式。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-03-21T21:00:19.100

> 我正在考虑恢复这段代码，将其翻译成现代语言，并将项目作为重构动力工具开源。

我认为免费提供这样一个工具真是太好了。

但是有一个商业产品可用：[DMS Software Reengineering Toolkit](http://www.semdesigns.com/Products/DMS/DMSToolkit.html)。

> DMS Software Reengineering Toolkit 是一套工具，用于自动化定制的源程序分析、修改或翻译或软件系统的生成，包含任意混合语言（“域”）。DMS 的“软件”一词​​非常广泛，涵盖任何形式符号，包括编程语言、标记语言、硬件描述语言、设计符号、数据描述等。该工具包是实现 The Design Maintenance System™ 的第一步，一个雄心勃勃的 21 世纪软件工程环境愿景，支持由语义和捕获的设计驱动的大型应用程序系统的增量构建和维护。

此外，对于 C 源代码，还有[coccinelle](http://coccinelle.lip6.fr/)工具：

> Coccinelle 是一个程序匹配和转换引擎，它提供语言 SmPL（语义补丁语言）用于在 C 代码中指定所需的匹配和转换。Coccinelle 最初的目标是在 Linux 中执行附带演变。这种演变包括客户端代码中响应库 API 演变所需的更改，并且可能包括修改，例如重命名函数、添加其值在某种程度上依赖于上下文的函数参数以及重新组织数据结构。除了附带演变之外，Coccinelle 还成功地用于（我们和其他人）查找和修复系统代码中的错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-06-03T08:12:33.120

在 TXL 中，它看起来像这样：

```
include "c.grm"

rule main
    replace [declaration_or_statement*]
        int cnt [id] = 0;
        while (cnt < max [shift_expression] )
        {
                body [declaration_or_statement*]
        }
    deconstruct * body
        ++cnt;
    by
        for (int cnt = 0; cnt < max; cnt++)
        {
                body
        }
end rule 
```

对于此输入：

```
int main () {
  int i=0;
  while(i < arrlen) {
    printf("element %d: %f\n",i,arr[i]);
    ++i;
  }
} 
```

它产生了这个：

```
int main () {
    for (int i = 0; i < arrlen; i++) {
        printf ("element %d: %f\n", i, arr [i]);
        ++i;
    }
} 
```

对于上面 Coccinelle 示例中显示的拆分案例，您可以在规则中添加类似的保护。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-06T04:38:14.373

[TXL](http://www.txl.ca/)是基于规则而不是基于模式的，因此它具有更多功能，但学习曲线可能更陡峭。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-15T17:03:15.760

上述规则的 Coccinelle 实现将是：

```
@@
标识符cnt；
表达式最大值，E；
@@

cnt = 0
... 当 != cnt=E
-while (cnt < 最大值)
+for (cnt=0;cnt < 最大值;cnt++)
{
  ...
-cnt++；
}

```

对于 C 代码：

```
诠释主要（）{
  诠释我=0；
  printf ("你好\n");
  而（我<阿伦）{
    printf("元素 %d: %f\n",i,arr[i]);
    ++i;
  }
}

```

它给

int main () { int i=0; printf ("你好\n"); for (i = 0; i < arrlen; i++) { printf("元素 %d: %f\n",i,arr[i]); } }

... when != cnt=E 允许在 cnt 的初始化和 while 循环之间执行任意代码，但会检查 cnt 是否未重新定义。如果在初始化和 while 循环之间不使用 cnt 的初始化，则更详细的规则也可以消除它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-05-18T18:19:15.070

我们的 DMS 已经被提及。正如 OP 所说，它具有转换规则，“易于阅读，因为*它们是用与目标源代码相同的语言编写的*”。

这是一个[链接，显示了](http://www.semanticdesigns.com/Products/DMS/SimpleDMSDomainExample.html)使用 DMS 进行模式匹配/转换的完整详细示例。

# regex - 如何分析 Perl 正则表达式？

> ID：415476
> 
> 赞同：8
> 
> 时间：2009-01-06T04:33:14.040
> 
> 标签：regex, perl, profiling

分析 Perl 正则表达式以确定它们有多昂贵的最佳方法是什么？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-06T05:37:38.107

Perl 自带了[Benchmark](http://search.cpan.org/perldoc?Benchmark)模块，它可以获取大量的代码样本，并回答“哪个更快？”的问题。我有一个[Perl Tip](http://perltraining.com.au/tips/) on [Benchmarking Basics](http://perltraining.com.au/tips/2007-07-04.html)，虽然它本身不使用正则表达式，但它确实提供了对该主题的快速而有用的介绍，以及进一步的参考资料。

[brian d foy 在他的Mastering Perl](http://www252.pair.com/comdog/mastering_perl/)书中也有关于基准测试的*精彩*章节。他很友善地将这一[章作为草稿放到网上](http://www.pair.com/~comdog/mastering_perl/Chapters/06.benchmarking.html)，非常值得一读。我真的不能推荐它。

*保罗*

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-06T17:21:02.680

不过，仅仅说“使用基准测试”模块并不能真正回答问题。对正则表达式进行基准测试不同于对计算进行基准测试；你需要大量的真实数据，这样你就可以像真实数据一样强调正则表达式。如果您的大部分数据都匹配，您需要一个快速匹配的正则表达式；如果大多数都会失败，那么您需要一个快速失败的正则表达式。他们可能最终成为相同的正则表达式，但也许不是。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-06T04:52:52.720

我的首选方法是向 RE 提供大量输入数据，然后处理该数据 N 次（例如，100,000）以查看需要多长时间。

然后调整 RE 并重试（将所有旧的 RE 保留为注释，以防您将来需要再次对它们进行基准测试，谁知道 Perl 7 中可能会出现哪些奇妙的优化？）。

可能有一些工具可以分析 RE 为您提供特定输入的执行路径（例如 DBMS 中的分析工具），但是，由于 Perl 是懒惰的语言（Larry 自己传下来的诫命），我不能麻烦去找它:-)。

# javascript - 在 Javascript 中克隆文件输入元素

> ID：415483
> 
> 赞同：20
> 
> 时间：2009-01-06T04:36:15.017
> 
> 标签：javascript, jquery, internet-explorer, clone

我有一个文件输入元素，在用户浏览并选择要上传的文件后需要克隆它。我从使用 obj.cloneNode() 开始，一切正常，直到我尝试在 IE 中使用它。

我已经尝试使用 jQuery 的克隆方法如下：

```
var tmp = jQuery('#categoryImageFileInput_'+id).clone();
var clone = tmp[0]; 
```

在 FireFox 中按预期工作，但在 IE 中又不行。

我被困住了。有人有什么建议吗？

* * *

## 回答 #1

> 赞同：67
> 
> 时间：2009-02-09T17:03:32.390

猜测您需要此功能，以便您可以克隆输入元素并将其放入隐藏表单中，然后将其发布到隐藏的 iframe...

IE 的 element.clone() 实现不会继承 input type="file" 的值，所以你必须反过来：

```
// Clone the "real" input element
var real = $("#categoryImageFileInput_" + id);
var cloned = real.clone(true);

// Put the cloned element directly after the real element
// (the cloned element will take the real input element's place in your UI
// after you move the real element in the next step)
real.hide();
cloned.insertAfter(real);   

// Move the real element to the hidden form - you can then submit it
real.appendTo("#some-hidden-form"); 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-06T04:44:14.360

编辑文件表单字段存在安全风险，因此在大多数浏览器上被禁用，并且*应该*在 firefox 上被禁用。依赖此功能不是一个好主意。想象一下，如果有人能够使用 javascript 将隐藏的文件上传字段更改为，可以说，

c:\Users\Person\Documents\Finances

或者

C:\Users\Person\AppData\Microsoft\Outlook.pst

:)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-12-24T00:50:32.230

在 jQuery fileupload 小部件中，有一个文件输入替换方法可以绕过仅触发一次的更改事件侦听器。

[https://github.com/blueimp/jQuery-File-Upload/blob/master/js/jquery.fileupload.js#L769](https://github.com/blueimp/jQuery-File-Upload/blob/master/js/jquery.fileupload.js#L769)

（jquery.fileupload.js 中的_replaceFileInput 方法）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-06-23T10:56:11.220

您可以应用其他方法。您必须将真实元素发送到 iframe 并将克隆的元素插入到表单中。例如：

```
$("INPUT[type='file']").each
(
    function(index, element)
    {
    $(this).wrap("<div></div>");
    var Div = $(this).parent();
    $(this).appendTo("FORM[name='forIframe']"); // This form for iframe
    Div.append($(this).clone());
    }
); 
```

如果您使用此方法，您的表单会将文件发送到服务器，但只有一个注释，在 Chrome 中，带有文件的 IE 输入被重置。

# .net - 如何使用 Lucene.Net 索引和搜索业务实体？

> ID：415485
> 
> 赞同：0
> 
> 时间：2009-01-06T04:37:42.580
> 
> 标签：.net, nhibernate, frameworks, lucene.net, compass-lucene

我想知道如何使用 Lucene.NET 来索引和搜索我的业务实体。我看到 NHibernate.Search 有很好的功能来解决这个问题，但它仍然需要数据库。我不需要数据库，我只想将所有数据存储在我的 Lucene.NET 的索引中。我还看到像 Compass 这样的 java 框架可以轻松完成这些工作，但它不是 .NET 库。

对象设计或框架有没有办法解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-06T11:21:54.573

尝试使用此代码使用 Lucene.NET 来索引业务实体的***快照***..，这对属性类型有明显限制并且需要错误检查，但可以让您大致了解如何实现这一点..

```
public class IndexHelper
{
    static Analyzer analyzer = new StandardAnalyzer();
    // Store the index in memory:
    static Directory directory = new RAMDirectory();
    static IndexWriter iwriter;

    static Dictionary<string, List<WeakReference>> indexedObjects = new Dictionary<string, List<WeakReference>>();

    static IndexHelper()
    {
        iwriter = new IndexWriter(directory, analyzer, true);
        iwriter.SetMaxFieldLength(25000);
    }

    public static void IndexObject(object entity)
    {
        Document doc = new Document();
        PropertyInfo[] entityProperties = entity.GetType().GetProperties();
        string entityKey = entity.GetHashCode().ToString();

        List<WeakReference> entityList;

        if (indexedObjects.TryGetValue(entityKey, out entityList) == false)
        {
            entityList = new List<WeakReference>();
            indexedObjects.Add(entityKey, entityList);
        }

        entityList.Add(new WeakReference(entity));

        doc.Add(new Field("@HASH", entityKey, Field.Store.YES, Field.Index.UN_TOKENIZED));

        foreach (PropertyInfo pInfo in entityProperties)
        {
            String propertyName = pInfo.Name;
            object propertyValue = pInfo.GetValue(entity, null); //Assuming all properties are of non index type
            String text = "null";
            if (propertyValue != null) text = propertyValue.ToString();

            doc.Add(new Field(propertyName, text, Field.Store.YES,
                Field.Index.TOKENIZED));
        }

        iwriter.AddDocument(doc);
        iwriter.Close();

    }

    public static List<WeakReference> Search(string queryString, string fieldName)
    {
        // Now search the index:
        IndexSearcher isearcher = new IndexSearcher(directory);

        Lucene.Net.QueryParsers.QueryParser qp = new Lucene.Net.QueryParsers.QueryParser(fieldName, analyzer);
        qp.SetDefaultOperator(Lucene.Net.QueryParsers.QueryParser.OR_OPERATOR);
        qp.SetLowercaseExpandedTerms(true);

        Query query = qp.Parse(queryString);

        List<WeakReference> results = new List<WeakReference>();
        Hits hits = isearcher.Search(query);
        // Iterate through the results:
        for (int i = 0; i < hits.Length(); i++)
        {
            Document hitDoc = hits.Doc(i);

            List<WeakReference> matchedObjects;

            if (indexedObjects.TryGetValue(hitDoc.GetField("@HASH").StringValue(), out matchedObjects))
            {
                results.AddRange(matchedObjects);
            }

        }

        isearcher.Close();

        return results;
    }
} 
```

更新：也看看这个项目[http://www.codeplex.com/linqtolucene](http://www.codeplex.com/linqtolucene)

# .net - 我什么时候应该使用已编译的正则表达式与解释？

> ID：415488
> 
> 赞同：8
> 
> 时间：2009-01-06T04:38:27.773
> 
> 标签：.net, regex

阅读这篇文章[http://www.codinghorror.com/blog/archives/000228.html](http://www.codinghorror.com/blog/archives/000228.html)后，我对编译正则表达式的好处有所了解，但是在哪些个人情况下您会考虑强制使用编译的 Reg Ex？

例如，我在循环中使用正则表达式，并且正则表达式字符串每次迭代都使用不同的变量，所以我不会通过将此正则表达式标记为已编译来寻求改进，对吗？

* * *

嗨，感谢您的回答，我的实际代码并不简单，并且受到动态构建的 RE 的影响，因此我无法包含它，因此出于所有密集目的，这里有一个示例来演示我的方法：

```
foreach (field field in fields.Where(x => x.condition))
    MatchResults = Regex.Match(request.Message, field.RegularExpression);
... 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-06T13:51:47.890

在 .NET 中，有两种方法可以“编译”正则表达式。正则表达式在用于查找匹配项之前总是被“编译”。当您在没有 RegexOptions.Compiled 标志的情况下实例化 Regex 类时，您的正则表达式仍会转换为 Regex 类使用的内部数据结构。实际的匹配过程在该数据结构上运行，而不是代表您的正则表达式的字符串。只要您的 Regex 实例存在，它就会一直存在。

如果您多次使用相同的正则表达式，则显式实例化 Regex 类比调用静态 Regex 方法更可取。原因是静态方法无论如何都会创建一个 Regex 实例，然后将其丢弃。他们确实保留了最近编译的正则表达式的缓存，但缓存相当小，而且缓存查找比简单地引用指向现有正则表达式实例的指针要昂贵得多。

上述编译形式存在于每一种使用正则表达式的编程语言或库中，但并非所有都提供对它的控制。

.NET 框架通过构造 Regex 对象并指定 RegexOptions.Compiled 标志来提供编译正则表达式的第二种方法。此标志的缺失或存在并不表示正则表达式是否已编译。它指示正则表达式是如上所述快速编译还是如下所述彻底编译。

RegexOptions.Compiled 真正做的是创建一个新程序集，将您的正则表达式编译为 MSIL。然后这个程序集被加载，编译成机器代码，并成为你的应用程序的一个永久部分（当它运行时）。这个过程需要大量的 CPU 滴答，并且内存使用是永久性的。

You should use RegexOptions.Compiled only if you're processing so much data with it that the user actually has to wait on your regex. If you can't measure the speed difference with a stopwatch, don't bother with RegexOptions.Compiled.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-06T04:44:26.327

当 RE 必须使用超过两到三倍时，我会编译它，并且编译成本被结果执行时间的改进所抵消。

我从不编译一次性的 RE，我总是编译那些执行超过五次（给予或接受几次）但我从未发现需要参数化的 RE（可能存在这种需要，只是我从来没有发现它）所以它不会进入它。

编辑：您所指的那篇文章指出，预先编译比解释（十倍）慢一个数量级，但只能节省 30%。而且，此外，解释的 RE 无论如何都会被缓存。所以我会说它绝对反对随意使用编译。

节省 30% 意味着需要 100/3（约 33）次编译的 RE 执行才能恢复编译的初始成本。这是根据 .NET 上的 MSDN 文档 - 我一直认为在我的 RE（Python/Perl/Java）中它不会那么糟糕，但我想我应该检查一下。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-06T04:56:30.700

在我看来，你的表达方式太具体了。我有兴趣查看您实际尝试解析的代码示例，因为我的直觉告诉我您的方法可能不够通用。如果不是这种情况，例如，也可以在循环期间预编译一组表达式，并进行比较。

请编辑您的问题并添加一些代码，以便我们进一步帮助您。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-06T04:57:49.310

只有当正则表达式足够复杂时，才应该编译正则表达式。简单的正则表达式将在未编译的情况下更有效地执行，因为编译时间会不必要地增加开销。如果您的正则表达式非常复杂但只使用一次，那么您应该评估它是否会从编译中受益。您可以通过设置对两种选择进行计时的例程来衡量这一点。

在几乎所有多次使用正则表达式语句的情况下，都值得在循环外编译正则表达式。

# python - 如何在 Python 中获取当前时间

> ID：415511
> 
> 赞同：3488
> 
> 时间：2009-01-06T04:54:23.530
> 
> 标签：python, datetime, time

用于获取当前时间的模块/方法是什么？

* * *

## 回答 #1

> 赞同：3582
> 
> 时间：2009-01-06T04:57:05.317

采用：

```
>>> import datetime
>>> datetime.datetime.now()
datetime.datetime(2009, 1, 6, 15, 8, 24, 78915)

>>> print(datetime.datetime.now())
2009-01-06 15:08:24.789150 
```

只是时间：

```
>>> datetime.datetime.now().time()
datetime.time(15, 8, 24, 78915)

>>> print(datetime.datetime.now().time())
15:08:24.789150 
```

有关更多信息，请参阅[**文档**](https://docs.python.org/3/library/datetime.html)。

为了节省输入，您可以从模块中导入`datetime`对象：`datetime`

```
>>> from datetime import datetime 
```

然后从上述所有内容中删除前导`datetime.`。

* * *

## 回答 #2

> 赞同：1105
> 
> 时间：2009-01-06T04:59:52.503

您可以使用[`time.strftime()`](http://docs.python.org/3.3/library/time.html?highlight=time.strftime#time.strftime)：

```
>>> from time import gmtime, strftime
>>> strftime("%Y-%m-%d %H:%M:%S", gmtime())
'2009-01-05 22:14:39' 
```

* * *

## 回答 #3

> 赞同：770
> 
> 时间：2013-01-09T05:50:34.103

```
from datetime import datetime
datetime.now().strftime('%Y-%m-%d %H:%M:%S') 
```

对于此示例，输出将如下所示：`'2013-09-18 11:16:32'`

这是[`strftime`指令](https://docs.python.org/library/datetime.html#strftime-and-strptime-format-codes)列表。

* * *

## 回答 #4

> 赞同：506
> 
> 时间：2011-05-04T00:56:29.527

类似于[Harley 的 answer](https://stackoverflow.com/questions/415511/how-to-get-current-time-in-python/415519#415519)，但使用该`str()`函数来获得一种快速且易于阅读的、更易于阅读的格式：

```
>>> from datetime import datetime
>>> str(datetime.now())
'2011-05-03 17:45:35.177000' 
```

* * *

## 回答 #5

> 赞同：477
> 
> 时间：2015-02-18T05:08:34.953

> # 如何在 Python 中获取当前时间？

## `time`模块_

该`time`模块提供了以“自纪元以来的秒数”为单位告诉我们时间的功能以及其他实用程序。

```
import time 
```

### Unix 纪元时间

这是您应该获取时间戳以保存在数据库中的格式。它是一个简单的浮点数，可以转换为整数。它也适用于以秒为单位的算术运算，因为它表示自 1970 年 1 月 1 日 00:00:00 以来的秒数，并且相对于我们接下来要研究的其他时间表示而言，它是记忆轻量级：

```
>>> time.time()
1424233311.771502 
```

此时间戳不考虑闰秒，因此它不是线性的 - 闰秒被忽略。因此，虽然它不等同于国际 UTC 标准，但它很接近，因此对于大多数记录保存情况来说非常好。

然而，这对于人工调度来说并不理想。如果您有一个希望在某个时间点发生的未来事件，您将希望将该时间与一个可以解析为`datetime`对象或序列化`datetime`对象的字符串一起存储（这些将在稍后描述）。

### `time.ctime`

您还可以以操作系统首选的方式表示当前时间（这意味着当您更改系统首选项时它可能会改变，所以不要依赖它作为所有系统的标准，正如我所看到的其他人所期望的那样） . 这通常是用户友好的，但通常不会导致可以按时间顺序排序的字符串：

```
>>> time.ctime()
'Tue Feb 17 23:21:56 2015' 
```

您还可以使用以下方法将时间戳水合为人类可读的形式`ctime`：

```
>>> time.ctime(1424233311.771502)
'Tue Feb 17 23:21:51 2015' 
```

这种转换也不利于记录保存（除了只能由人类解析的文本 - 并且随着光学字符识别和人工智能的改进，我认为这些案例的数量将会减少）。

## `datetime`模块

该`datetime`模块在这里也非常有用：

```
>>> import datetime 
```

### `datetime.datetime.now`

这`datetime.now`是一个返回当前时间的类方法。它使用`time.localtime`没有时区信息的 （如果没有给出，否则请参阅下面的时区感知）。它有一个在 shell 上回显的表示（允许您重新创建一个等效对象），但是当打印（或强制为 a `str`）时，它是人类可读的（并且几乎是 ISO）格式，并且字典排序相当于按时间排序：

```
>>> datetime.datetime.now()
datetime.datetime(2015, 2, 17, 23, 43, 49, 94252)
>>> print(datetime.datetime.now())
2015-02-17 23:43:51.782461 
```

### 日期时间的`utcnow`

您可以通过执行以下操作以 UTC 时间（全球标准）获取 datetime 对象：

```
>>> datetime.datetime.utcnow()
datetime.datetime(2015, 2, 18, 4, 53, 28, 394163)
>>> print(datetime.datetime.utcnow())
2015-02-18 04:53:31.783988 
```

UTC 是几乎等同于 GMT 时区的时间标准。（虽然 GMT 和 UTC 不会因夏令时而改变，但他们的用户可能会在夏季切换到其他时区，例如英国夏令时。）

### 日期时间时区感知

但是，到目前为止，我们创建的日期时间对象都不能轻松转换为各种时区。我们可以用模块解决这个问题`pytz`：

```
>>> import pytz
>>> then = datetime.datetime.now(pytz.utc)
>>> then
datetime.datetime(2015, 2, 18, 4, 55, 58, 753949, tzinfo=<UTC>) 
```

等效地，在 Python 3 中，我们有一个附加`timezone`了 utc`timezone`实例的类，这也使对象时区感知（但在没有方便`pytz`模块的情况下转换为另一个时区作为练习留给读者）：

```
>>> datetime.datetime.now(datetime.timezone.utc)
datetime.datetime(2015, 2, 18, 22, 31, 56, 564191, tzinfo=datetime.timezone.utc) 
```

我们看到我们可以轻松地从原始 UTC 对象转换为时区。

```
>>> print(then)
2015-02-18 04:55:58.753949+00:00
>>> print(then.astimezone(pytz.timezone('US/Eastern')))
2015-02-17 23:55:58.753949-05:00 
```

您还可以使用`pytz`timezone`localize`方法或通过替换 tzinfo 属性（使用`replace`，这是盲目地完成）使天真的 datetime 对象知道，但这些是最后的手段而不是最佳实践：

```
>>> pytz.utc.localize(datetime.datetime.utcnow())
datetime.datetime(2015, 2, 18, 6, 6, 29, 32285, tzinfo=<UTC>)
>>> datetime.datetime.utcnow().replace(tzinfo=pytz.utc)
datetime.datetime(2015, 2, 18, 6, 9, 30, 728550, tzinfo=<UTC>) 
```

该`pytz`模块允许我们让我们的`datetime`对象知道时区并将时间转换为`pytz`模块中可用的数百个时区。

表面上可以将此对象序列化为 UTC 时间并将其存储*在*数据库中，但与我首先演示的简单存储 Unix 纪元时间相比，它需要更多的内存并且更容易出错。

查看时间的其他方式更容易出错，尤其是在处理可能来自不同时区的数据时。您不希望对字符串或序列化的日期时间对象用于哪个时区产生混淆。

如果您使用 Python 为用户显示时间，则`ctime`可以很好地工作，而不是在表格中（通常不能很好地排序），但可能在时钟中。但是，我个人建议，在 Python 中处理时间时，使用 Unix 时间或时区感知 UTC`datetime`对象。

* * *

## 回答 #6

> 赞同：151
> 
> 时间：2009-01-06T13:55:23.017

做

```
from time import time

t = time() 
```

*   `t`- 浮点数，适合时间间隔测量。

Unix 和 Windows 平台存在一些差异。

* * *

## 回答 #7

> 赞同：117
> 
> 时间：2009-01-06T05:02:43.417

```
>>> from time import gmtime, strftime
>>> strftime("%a, %d %b %Y %X +0000", gmtime())
'Tue, 06 Jan 2009 04:54:56 +0000' 
```

以指定格式输出当前 GMT。还有一种[`localtime()`](https://docs.python.org/3/library/time.html#time.localtime)方法。

此[页面](http://docs.python.org/library/time.html#module-time)有更多详细信息。

* * *

## 回答 #8

> 赞同：84
> 
> 时间：2013-10-31T15:39:39.587

以前的答案都是很好的建议，但我发现它最容易使用`ctime()`：

```
In [2]: from time import ctime
In [3]: ctime()
Out[3]: 'Thu Oct 31 11:40:53 2013' 
```

这给出了当前本地时间的格式良好的字符串表示。

* * *

## 回答 #9

> 赞同：78
> 
> 时间：2013-09-24T11:21:10.047

最快的方法是：

```
>>> import time
>>> time.strftime("%Y%m%d")
'20130924' 
```

* * *

## 回答 #10

> 赞同：65
> 
> 时间：2010-12-27T10:24:12.343

如果您需要当前时间作为`time`对象：

```
>>> import datetime
>>> now = datetime.datetime.now()
>>> datetime.time(now.hour, now.minute, now.second)
datetime.time(11, 23, 44) 
```

* * *

## 回答 #11

> 赞同：49
> 
> 时间：2015-02-06T17:46:46.223

您可以使用该`time`模块：

```
>>> import time
>>> print(time.strftime("%d/%m/%Y"))
06/02/2015 
```

资本的使用`Y`给出了全年，使用`y`将给出`06/02/15`。

您还可以使用以下代码来延长时间：

```
>>> time.strftime("%a, %d %b %Y %H:%M:%S")
'Fri, 06 Feb 2015 17:45:09' 
```

* * *

## 回答 #12

> 赞同：48
> 
> 时间：2013-06-25T00:38:25.233

`.isoformat()`在文档中，但还没有（这与@Ray Vega 的答案非常相似）：

```
>>> import datetime
>>> datetime.datetime.now().isoformat()
'2013-06-24T20:35:55.982000' 
```

* * *

## 回答 #13

> 赞同：46
> 
> 时间：2016-08-19T19:45:08.020

为什么不问问美国海军的官方计时[美国海军天文台？](http://tycho.usno.navy.mil/cgi-bin/timer.pl)

```
import requests
from lxml import html

page = requests.get('http://tycho.usno.navy.mil/cgi-bin/timer.pl')
tree = html.fromstring(page.content)
print(tree.xpath('//html//body//h3//pre/text()')[1]) 
```

如果你住在华盛顿地区（像我一样），延迟可能不会太糟糕......

* * *

## 回答 #14

> 赞同：42
> 
> 时间：2017-09-22T12:45:57.697

使用[pandas](https://en.wikipedia.org/wiki/Pandas_%28software%29)来获取当前时间，有点过分解决手头的问题：

```
import pandas as pd
print(pd.datetime.now())
print(pd.datetime.now().date())
print(pd.datetime.now().year)
print(pd.datetime.now().month)
print(pd.datetime.now().day)
print(pd.datetime.now().hour)
print(pd.datetime.now().minute)
print(pd.datetime.now().second)
print(pd.datetime.now().microsecond) 
```

输出：

```
2017-09-22 12:44:56.092642
2017-09-22
2017
9
22
12
44
56
92693 
```

* * *

## 回答 #15

> 赞同：35
> 
> 时间：2017-11-07T06:17:52.507

如果您已经在使用 numpy，那么您可以直接使用 numpy.datetime64() 函数。

```
import numpy as np
str(np.datetime64('now')) 
```

仅限日期：

```
str(np.datetime64('today')) 
```

或者，如果您已经在使用 pandas，那么您可以使用 pandas.to_datetime() 函数

```
import pandas as pd
str(pd.to_datetime('now')) 
```

或者，

```
str(pd.to_datetime('today')) 
```

* * *

## 回答 #16

> 赞同：34
> 
> 时间：2015-01-09T18:24:49.280

这就是我最终的结果：

```
>>>from time import strftime
>>>strftime("%m/%d/%Y %H:%M")
01/09/2015 13:11 
```

此外，此表是选择适当格式代码以按照您想要的方式格式化日期的必要参考（来自 Python “datetime” 文档[here](https://docs.python.org/2/library/datetime.html#strftime-strptime-behavior)）。

![strftime 格式码表](https://i.stack.imgur.com/i6Hg7.jpg)

* * *

## 回答 #17

> 赞同：32
> 
> 时间：2014-12-22T22:52:47.630

`datetime.now()`返回当前时间作为表示本地时区时间的简单日期时间对象。该值可能是不明确的，例如，在 DST 转换期间（“回退”）。为避免歧义，应使用 UTC 时区：

```
from datetime import datetime

utc_time = datetime.utcnow()
print(utc_time) # -> 2014-12-22 22:48:59.916417 
```

或附加了相应时区信息的时区感知对象（Python 3.2+）：

```
from datetime import datetime, timezone

now = datetime.now(timezone.utc).astimezone()
print(now) # -> 2014-12-23 01:49:25.837541+03:00 
```

* * *

## 回答 #18

> 赞同：27
> 
> 时间：2017-04-09T04:17:34.113

```
import datetime
date_time = datetime.datetime.now()

date = date_time.date()  # Gives the date
time = date_time.time()  # Gives the time

print date.year, date.month, date.day
print time.hour, time.minute, time.second, time.microsecond 
```

做`dir(date)`或任何变量，包括包。您可以获得与变量关联的所有属性和方法。

* * *

## 回答 #19

> 赞同：25
> 
> 时间：2018-08-13T20:08:17.713

这个问题不需要一个新的答案只是为了它......一个闪亮的新玩具/模块，然而，足够的理由。那就是[Pendulum 库](https://pendulum.eustace.io/docs/)，它似乎做了arrow 尝试过的那种事情，除了没有困扰arrow 的固有缺陷和错误。

例如，原始问题的答案：

```
>>> import pendulum
>>> print(pendulum.now())
2018-08-14T05:29:28.315802+10:00
>>> print(pendulum.now('utc'))
2018-08-13T19:29:35.051023+00:00 
```

有很多标准需要解决，包括多个 RFC 和 ISO，需要担心。永远把它们弄混；不用担心，看看`dir(pendulum.constants)`这里有比 RFC 和 ISO 格式更多的东西。

当我们说本地时，虽然我们是什么意思？好吧，我的意思是：

```
>>> print(pendulum.now().timezone_name)
Australia/Melbourne
>>> 
```

大概你们中的大多数人是指其他地方。

然后继续。长话短说：Pendulum 尝试对日期和时间做请求对 HTTP 所做的事情。值得考虑，尤其是它的易用性和广泛的文档。

* * *

## 回答 #20

> 赞同：24
> 
> 时间：2014-05-20T07:13:36.830

```
>>> import datetime, time
>>> time = time.strftime("%H:%M:%S:%MS", time.localtime())
>>> print time
'00:21:38:20S' 
```

* * *

## 回答 #21

> 赞同：23
> 
> 时间：2018-03-01T11:34:55.600

默认情况下，`now()`函数以`YYYY-MM-DD HH:MM:SS:MS`格式返回输出。使用以下示例脚本在 Python 脚本中获取当前日期和时间并在屏幕上打印结果。`getDateTime1.py`使用以下内容创建文件。

```
import datetime

currentDT = datetime.datetime.now()
print (str(currentDT)) 
```

输出如下所示：

```
2018-03-01 17:03:46.759624 
```

* * *

## 回答 #22

> 赞同：21
> 
> 时间：2015-11-14T02:02:45.137

尝试来自[http://crsmithdev.com/arrow/](http://crsmithdev.com/arrow/)的箭头模块：

```
import arrow
arrow.now() 
```

或 UTC 版本：

```
arrow.utcnow() 
```

要更改其输出，请添加 .format()：

```
arrow.utcnow().format('YYYY-MM-DD HH:mm:ss ZZ') 
```

对于特定时区：

```
arrow.now('US/Pacific') 
```

一小时前：

```
arrow.utcnow().replace(hours=-1) 
```

或者，如果您想要要点。

```
arrow.get('2013-05-11T21:23:58.970460+00:00').humanize()
>>> '2 years ago' 
```

* * *

## 回答 #23

> 赞同：20
> 
> 时间：2016-07-18T09:45:50.113

要获得精确的**3** 毫秒**小数点**`11:34:23.751`，请运行以下命令：

```
def get_time_str(decimal_points=3):
        return time.strftime("%H:%M:%S", time.localtime()) + '.%d' % (time.time() % 1 * 10**decimal_points) 
```

**更多背景：**

我想得到毫秒的时间。获取它们的简单方法：

```
import time, datetime

print(datetime.datetime.now().time())                         # 11:20:08.272239

# Or in a more complicated way
print(datetime.datetime.now().time().isoformat())             # 11:20:08.272239
print(datetime.datetime.now().time().strftime('%H:%M:%S.%f')) # 11:20:08.272239

# But do not use this:
print(time.strftime("%H:%M:%S.%f", time.localtime()), str)    # 11:20:08.%f 
```

但我**只想要毫秒**，对吧？获得它们的最短方法：

```
import time

time.strftime("%H:%M:%S", time.localtime()) + '.%d' % (time.time() % 1 * 1000)
# 11:34:23.751 
```

从最后一个乘法中添加或删除零以调整小数点数，或者只是：

```
def get_time_str(decimal_points=3):
    return time.strftime("%H:%M:%S", time.localtime()) + '.%d' % (time.time() % 1 * 10**decimal_points) 
```

* * *

## 回答 #24

> 赞同：18
> 
> 时间：2017-11-29T08:22:57.570

你可以使用这个函数来获取时间（不幸的是它没有说上午或下午）：

```
def gettime():
    from datetime import datetime
    return ((str(datetime.now())).split(' ')[1]).split('.')[0] 
```

要获取稍后合并的小时、分钟、秒和毫秒，可以使用以下函数：

*小时：*

```
def gethour():
    from datetime import datetime
    return (((str(datetime.now())).split(' ')[1]).split('.')[0]).split(':')[0] 
```

*分钟：*

```
def getminute():
    from datetime import datetime
    return (((str(datetime.now())).split(' ')[1]).split('.')[0]).split(':')[1] 
```

*第二：*

```
def getsecond():
    from datetime import datetime
    return (((str(datetime.now())).split(' ')[1]).split('.')[0]).split(':')[2] 
```

*毫秒：*

```
def getmillisecond():
    from datetime import datetime
    return (str(datetime.now())).split('.')[1] 
```

* * *

## 回答 #25

> 赞同：18
> 
> 时间：2018-07-18T07:11:56.947

如果您只想要以 ms 为单位的当前时间戳（例如，测量执行时间），您还可以使用“timeit”模块：

```
import timeit
start_time = timeit.default_timer()
do_stuff_you_want_to_measure()
end_time = timeit.default_timer()
print("Elapsed time: {}".format(end_time - start_time)) 
```

* * *

## 回答 #26

> 赞同：18
> 
> 时间：2019-10-18T13:09:33.563

**时区的当前时间**

```
from datetime import datetime
import pytz

tz_NY = pytz.timezone('America/New_York') 
datetime_NY = datetime.now(tz_NY)
print("NY time:", datetime_NY.strftime("%H:%M:%S"))

tz_London = pytz.timezone('Europe/London')
datetime_London = datetime.now(tz_London)
print("London time:", datetime_London.strftime("%H:%M:%S"))

tz_India = pytz.timezone('Asia/India')
datetime_India = datetime.now(tz_India)
print("India time:", datetime_India.strftime("%H:%M:%S"))

#list timezones
pytz.all_timezones 
```

* * *

## 回答 #27

> 赞同：17
> 
> 时间：2020-06-04T22:29:18.353

您可以尝试以下方法

```
import datetime

now = datetime.datetime.now()
print(now) 
```

或者

```
import datetime

now = datetime.datetime.now()
print(now.strftime("%Y-%b-%d, %A %I:%M:%S")) 
```

* * *

## 回答 #28

> 赞同：16
> 
> 时间：2018-07-06T08:24:22.773

因为还没有人提到它，这是我最近遇到的事情...... pytz 时区的 fromutc() 方法结合 datetime 的 utcnow() 是我发现获得有用的当前时间（和日期）的最佳方法在任何时区。

```
from datetime import datetime

import pytz

JST = pytz.timezone("Asia/Tokyo")

local_time = JST.fromutc(datetime.utcnow()) 
```

如果您想要的只是时间，那么您可以使用`local_time.time()`.

* * *

## 回答 #29

> 赞同：15
> 
> 时间：2019-10-12T18:09:19.023

```
import datetime

todays_date = datetime.date.today()
print(todays_date)
>>> 2019-10-12

# adding strftime will remove the seconds
current_time = datetime.datetime.now().strftime('%H:%M')
print(current_time)
>>> 23:38 
```

* * *

## 回答 #30

> 赞同：12
> 
> 时间：2019-09-14T16:00:15.797

您可以使用 ctime() 执行此操作：

```
from time import time, ctime
t = time()
ctime(t) 
```

输出：

`Sat Sep 14 21:27:08 2019`

这些输出是不同的，因为返回的时间戳`ctime()`取决于您的地理位置。

* * *

## 回答 #31

> 赞同：11
> 
> 时间：2020-04-18T14:32:25.640

**方法1：从系统日期时间获取当前日期和时间**

**datetime**模块提供用于处理日期和时间的类。

> 代码

```
from datetime import datetime,date

print("Date: "+str(date.today().year)+"-"+str(date.today().month)+"-"+str(date.today().day))
print("Year: "+str(date.today().year))
print("Month: "+str(date.today().month))
print("Day: "+str(date.today().day)+"\n")

print("Time: "+str(datetime.today().hour)+":"+str(datetime.today().minute)+":"+str(datetime.today().second))
print("Hour: "+str(datetime.today().hour))
print("Minute: "+str(datetime.today().minute))
print("Second: "+str(datetime.today().second))
print("MilliSecond: "+str(datetime.today().microsecond)) 
```

> 输出会像

```
Date: 2020-4-18
Year: 2020
Month: 4
Day: 18

Time: 19:30:5
Hour: 19
Minute: 30
Second: 5
MilliSecond: 836071 
```

**方法 2：如果网络可用，则获取当前日期和时间**

**urllib**包帮助我们处理表示网页的 url。[在这里，我们从网页http://just-the-time.appspot.com/](http://just-the-time.appspot.com/)收集数据，并使用包 dateparser 从网页中**解析**日期**时间**。

> 代码

```
from urllib.request import urlopen
import dateparser

time_url = urlopen(u'http://just-the-time.appspot.com/')
datetime = time_url.read().decode("utf-8", errors="ignore").split(' ')[:-1]
date = datetime[0]
time = datetime[1]

print("Date: "+str(date))
print("Year: "+str(date.split('-')[0]))
print("Month: "+str(date.split('-')[1]))
print("Day: "+str(date.split('-')[2])+'\n')

print("Time: "+str(time))
print("Hour: "+str(time.split(':')[0]))
print("Minute: "+str(time.split(':')[1]))
print("Second: "+str(time.split(':')[2])) 
```

> 输出会像

```
Date: 2020-04-18
Year: 2020
Month: 04
Day: 18

Time: 14:17:10
Hour: 14
Minute: 17
Second: 10 
```

**方法3：从机器的本地时间获取当前日期和时间**

Python 的**时间**模块提供了一个函数，用于从称为 localtime() 的纪元以来经过的秒数中获取本地时间。**ctime()**函数将自纪元以来经过的秒数作为参数，并返回一个表示本地时间的字符串。

> 代码

```
from time import time, ctime
datetime = ctime(time()).split(' ')

print("Date: "+str(datetime[4])+"-"+str(datetime[1])+"-"+str(datetime[2]))
print("Year: "+str(datetime[4]))
print("Month: "+str(datetime[1]))
print("Day: "+str(datetime[2]))
print("Week Day: "+str(datetime[0])+'\n')

print("Time: "+str(datetime[3]))
print("Hour: "+str(datetime[3]).split(':')[0])
print("Minute: "+str(datetime[3]).split(':')[1])
print("Second: "+str(datetime[3]).split(':')[2]) 
```

> 输出会像

```
Date: 2020-Apr-18
Year: 2020
Month: Apr
Day: 18
Week Day: Sat

Time: 19:30:20
Hour: 19
Minute: 30
Second: 20 
```

* * *

## 回答 #32

> 赞同：9
> 
> 时间：2015-05-01T01:39:08.203

以下是我用来获取时间而无需格式化的内容。有些人不喜欢 split 方法，但它在这里很有用：

```
from time import ctime
print ctime().split()[3] 
```

它将以 HH:MM:SS 格式打印。

* * *

## 回答 #33

> 赞同：9
> 
> 时间：2016-07-14T05:50:20.183

```
import datetime
date_time = str(datetime.datetime.now()).split()
date,time = date_time 
```

**date**将打印日期，**time**将打印时间。

* * *

## 回答 #34

> 赞同：9
> 
> 时间：2019-06-05T10:19:27.303

这个问题是针对 Python 的，但由于 Django 是 Python 中使用最广泛的框架之一，重要的是要注意，如果您使用的是 Django，您始终可以`timezone.now()`使用`datetime.datetime.now()`. 前者是“感知”时区，而后者不是。

有关详细信息和背后的理由，请参阅[此 SO 答案](https://stackoverflow.com/a/26950056/1526703)和[Django 文档](https://docs.djangoproject.com/en/dev/topics/i18n/timezones/#naive-and-aware-datetime-objects)`timezone.now()`。

```
from django.utils import timezone

now = timezone.now() 
```

* * *

## 回答 #35

> 赞同：9
> 
> 时间：2021-09-08T10:57:50.803

试试这个：-

```
from datetime import datetime

now = datetime.now()

current_time = now.strftime("%H:%M:%S")
print("Current Time =", current_time) 
```

* * *

## 回答 #36

> 赞同：8
> 
> 时间：2019-01-21T09:42:59.307

这很简单。尝试：

```
import datetime
date_time = str(datetime.datetime.now())
date = date_time.split()[0]
time = date_time.split()[1] 
```

* * *

## 回答 #37

> 赞同：7
> 
> 时间：2018-01-16T14:45:15.823

```
from time import ctime

// Day {Mon,Tue,..}
print ctime().split()[0]
// Month {Jan, Feb,..}
print ctime().split()[1]
// Date {1,2,..}
print ctime().split()[2]
// HH:MM:SS
print ctime().split()[3]
// Year {2018,..}
print ctime().split()[4] 
```

当您调用`ctime()`它时，它将秒转换为格式的字符串`'Day Month Date HH:MM:SS Year'`（例如：） `'Wed January 17 16:53:22 2018'`，然后您调用`split()`将从您的字符串创建列表的方法`['Wed','Jan','17','16:56:45','2018']`（默认分隔符是空格）。

括号用于在列表中“选择”想要的参数。

应该只调用一个代码行。不应该像我那样称呼它们，这只是一个例子，因为在某些情况下你会得到不同的值，罕见但并非不可能的情况。

* * *

## 回答 #38

> 赞同：7
> 
> 时间：2019-03-04T08:40:39.680

获取当前日期时间属性：

```
import datetime

currentDT = datetime.datetime.now()

print ("Current Year is: %d" % currentDT.year)
print ("Current Month is: %d" % currentDT.month)
print ("Current Day is: %d" % currentDT.day)
print ("Current Hour is: %d" % currentDT.hour)
print ("Current Minute is: %d" % currentDT.minute)
print ("Current Second is: %d" % currentDT.second)
print ("Current Microsecond is: %d" % currentDT.microsecond)

#!/usr/bin/python
import time;

ticks = time.time()
print "Number of ticks since "12:00am, Jan 1, 1970":", ticks 
```

* * *

## 回答 #39

> 赞同：5
> 
> 时间：2018-05-24T20:27:29.367

首先从 datetime 导入 datetime 模块

```
from datetime import datetime 
```

然后将当前时间打印为 'yyyy-mm-dd hh:mm:ss'

```
print(str(datetime.now()) 
```

要仅获取 'hh:mm:ss' 形式的时间，其中 ss 代表完整的秒数加上经过的秒数，只需执行；

```
print(str(datetime.now()[11:]) 
```

将 datetime.now() 转换为字符串会产生一个答案，其格式与我们习惯的常规日期和时间类似。

* * *

## 回答 #40

> 赞同：5
> 
> 时间：2022-01-20T08:17:20.527

如果您将它用于 django datetime 有时无法在服务器上运行，因此我建议使用时区

但是要使用 django 时区，您应该在 settings.py 中设置您的国家时区代码

```
TIME_ZONE = 'Asia/Tashkent' 
```

然后你就可以使用它了

```
from django.utils import timezone

timezone.now() // for date time

timezone.now().year // for yaer

timezone.now().month // for month

timezone.now().day // for day 

timezone.now().date // for date

timezone.now().hour // for hour

timezone.now().weekday // for minute 
```

或者如果你想在 python 上使用

```
import time

time.strftime('%X') // '13:12:47'

time.strftime('%x') // '01/20/22'

time.strftime('%d') // '20' day

time.strftime('%m') // '01' month

time.strftime('%y') // '20' year

time.strftime('%H') // '01' hour

time.strftime('%M') // '01' minute

time.strftime('%m') // '01' second 
```

* * *

## 回答 #41

> 赞同：4
> 
> 时间：2020-04-20T12:53:43.503

该`time`模块可以导入各种时间的东西，包括睡眠和其他类型的东西，包括 - 当前时间类型

```
import time
time.strftime("%T", time.localtime()) 
```

输出应如下所示

```
05:46:33
11:22:56
13:44:55
22:33:44
00:00:00 
```

* * *

## 回答 #42

> 赞同：4
> 
> 时间：2020-06-13T12:49:31.683

我们可以使用 datetime 模块来完成

```
>>> from datetime import datetime
>>> now = datetime.now() #get a datetime object containing current date and time
>>> current_time = now.strftime("%H:%M:%S") #created a string representing current time
>>> print("Current Time =", current_time)
Current Time = 17:56:54 
```

此外，我们可以使用[pytZ 模块](http://pytz.sourceforge.net/)获取时区的当前时间。

```
>>> from pytz import timezone
>>> import pytz
>>> eastern = timezone('US/Eastern')
>>> eastern.zone
'US/Eastern'
>>> amsterdam = timezone('Europe/Amsterdam')
>>> datetime_eu = datetime.now(amsterdam)
>>> print("Europe time::", datetime_eu.strftime("%H:%M:%S"))
Europe time:: 14:45:31 
```

* * *

## 回答 #43

> 赞同：4
> 
> 时间：2021-03-29T06:09:33.360

```
import datetime

print('date='+datetime.datetime.now().__str__().split(' ')[0]+' '+'time='+datetime.datetime.now().__str__().split(' ')[1] 
```

由于 Qt 被广泛使用，

```
from PyQt5 import QDateTime
print(QDateTime.currentDateTime().__str__().split('(')[1].rstrip(')')) 
```

* * *

## 回答 #44

> 赞同：2
> 
> 时间：2020-06-17T09:15:56.250

如果您想要时间用于计时函数调用，那么您需要 time.perf_counter()。

```
start_time = time.perf_counter()
expensive_function()
time_taken = time.perf_counter() - start_time
print(f'expensive_function() took {round(time_taken,2)}s') 
```

> time.perf_counter() → 浮动
> 
> 返回性能计数器的值（以秒为单位），即具有最高可用分辨率的时钟以测量短持续时间。它确实包括睡眠期间经过的时间，并且是系统范围的。返回值的参考点是未定义的，因此只有连续调用的结果之间的差异才有效。
> 
> 3.3 版中的新功能。
> 
> * * *
> 
> time.perf_counter_ns() → int
> 
> 类似于 perf_counter()，但返回时间为纳秒。
> 
> 3.7 版中的新功能。

*   [https://docs.python.org/3/library/time.html#time.perf_counter](https://docs.python.org/3/library/time.html#time.perf_counter)

* * *

## 回答 #45

> 赞同：2
> 
> 时间：2020-06-27T10:10:32.040

从 Python 3.9 开始，该[`zoneinfo`](https://docs.python.org/3.9/library/zoneinfo.html)模块可用于获取时区，而不是使用第三方库。

要获取特定时区的当前时间：

```
from datetime import datetime
from zoneinfo import ZoneInfo

datetime.now(tz=ZoneInfo("Europe/Amsterdam")) 
```

* * *

## 回答 #46

> 赞同：1
> 
> 时间：2021-06-21T10:05:32.167

这是仅根据您的问题显示时间的代码：

```
 from datetime import datetime

 while True:
          time= datetime.now()
          b = time.strftime("%H:%M:%S")
          print(b, end='\r') 
```

此代码将显示您系统的当前时间，而不会停止。

* * *

## 回答 #47

> 赞同：1
> 
> 时间：2022-02-20T05:55:18.940

now() 的属性可用于在 python 中获取当前时间：

```
# importing datetime module for now()
import datetime

# using now() to get current time
current_time = datetime.datetime.now()

# Printing attributes of now().
print ("The attributes of now() are : ")

print ("Year : ", end = "")
print (current_time.year)

print ("Month : ", end = "")
print (current_time.month)

print ("Day : ", end = "")
print (current_time.day)

print ("Hour : ", end = "")
print (current_time.hour)

print ("Minute : ", end = "")
print (current_time.minute)

print ("Second : ", end = "")
print (current_time.second)

print ("Microsecond : ", end = "")
print (current_time.microsecond) 
```

* * *

## 回答 #48

> 赞同：0
> 
> 时间：2022-01-17T13:53:44.350

**将此方法用于 UTC 日期时间、本地日期时间，并转换上午和下午**

```
import pytz
from datetime import datetime

#UTC Time
print("UTC Date and time")
epoch: datetime =datetime.now().replace(tzinfo=pytz.utc)
print(epoch)

#local date and time
print("Local Date and time")
today = datetime.now()
local_time = today.strftime("%Y-%M-%d:%H:%M:%S")
print(local_time)

#convert time to AM PM format
print("Date and time AM and PM")
now = today.strftime("%Y-%M-%d:%I:%M %p")
print(now) 
```

* * *

## 回答 #49

> 赞同：0
> 
> 时间：2022-02-13T18:53:30.773

获取当前时间并将其转换为字符串：

```
from datetime import datetime
datetime.now().strftime('%Y-%m-%d %H:%M:%S') 
```

# c++ - 如何在 C++ 中读取和操作 CSV 文件数据？

> ID：415515
> 
> 赞同：51
> 
> 时间：2009-01-06T04:55:55.320
> 
> 标签：c++, csv

非常不言自明，我尝试了谷歌并得到了很多可怕的专家交流，我在这里也搜索了无济于事。最好是在线教程或示例。多谢你们。

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2009-01-06T05:18:28.893

更多信息会很有用。

但最简单的形式：

```
#include <iostream>
#include <sstream>
#include <fstream>
#include <string>

int main()
{
    std::ifstream  data("plop.csv");

    std::string line;
    while(std::getline(data,line))
    {
        std::stringstream  lineStream(line);
        std::string        cell;
        while(std::getline(lineStream,cell,','))
        {
            // You have a cell!!!!
        }
    }
 } 
```

另请参阅此问题：[C++ 中的 CSV 解析器](https://stackoverflow.com/a/1120224/14065)

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-01-06T10:49:23.233

您可以尝试 Boost Tokenizer 库，特别是[Escaped List Separator](http://www.boost.org/doc/libs/1_37_0/libs/tokenizer/escaped_list_separator.htm)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-06T05:41:55.540

如果您真正要做的是操作 CSV 文件本身，那么 Nelson 的回答是有道理的。但是，我怀疑 CSV 只是您正在解决的问题的产物。在 C++ 中，这可能意味着您有这样的数据模型：

```
struct Customer {
    int id;
    std::string first_name;
    std::string last_name;
    struct {
        std::string street;
        std::string unit;
    } address;
    char state[2];
    int zip;
}; 
```

`std::vector<Customer>`因此，当您处理数据集合时，使用或是有意义的`std::set<Customer>`。

考虑到这一点，将您的 CSV 处理视为两个操作：

```
// if you wanted to go nuts, you could use a forward iterator concept for both of these
class CSVReader {
public:
    CSVReader(const std::string &inputFile);
    bool hasNextLine();
    void readNextLine(std::vector<std::string> &fields);
private:
    /* secrets */
};
class CSVWriter {
public:
    CSVWriter(const std::string &outputFile);
    void writeNextLine(const std::vector<std::string> &fields);
private:
    /* more secrets */
};
void readCustomers(CSVReader &reader, std::vector<Customer> &customers);
void writeCustomers(CSVWriter &writer, const std::vector<Customer> &customers); 
```

一次读取和写入一行，而不是保留文件本身的完整内存表示。有几个明显的好处：

1.  您的数据以对您的问题（客户）有意义的形式表示，而不是当前解决方案（CSV 文件）。
2.  您可以轻松地为其他数据格式添加适配器，例如批量 SQL 导入/导出、Excel/OO 电子表格文件，甚至是 HTML`<table>`呈现。
3.  您的内存占用可能会更小（取决于相对`sizeof(Customer)`与单行中的字节数）。
4.  `CSVReader`并且`CSVWriter`可以重用作为内存模型（例如 Nelson 模型）的基础，而不会损失性能或功能。反之则不成立。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-01-06T14:43:19.643

在我的时间里，我处理过很多 CSV 文件。我想补充一点建议：

1 - 根据来源（Excel 等），逗号或制表符可能嵌入在字段中。通常，规则是它们将受到“保护”，因为该字段将用双引号分隔，如“波士顿，MA 02346”。

2 - 某些来源不会用双引号分隔所有文本字段。其他来源会。其他人将分隔所有字段，甚至是数字。

3 - 包含双引号的字段通常会使嵌入的双引号加倍（并且字段本身用双引号分隔，如“George”“Babe”“Ruth”。

4 - 一些来源将嵌入 CR/LF（Excel 就是其中之一！）。有时它只是一个 CR。该字段通常会用双引号分隔，但这种情况很难处理。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-01-06T05:16:46.527

这对你自己来说是一个很好的练习:)

你应该把你的图书馆分成三个部分

*   加载 CSV 文件
*   在内存中表示文件，以便您可以修改和读取它
*   将 CSV 文件保存回磁盘

因此，您正在考虑编写一个包含以下内容的 CSVDocument 类：

*   加载（常量字符*文件）；
*   保存（常量字符*文件）；
*   获取身体

这样您就可以像这样使用您的库：

```
CSVDocument doc;
doc.Load("file.csv");
CSVDocumentBody* body = doc.GetBody();

CSVDocumentRow* header = body->GetRow(0);
for (int i = 0; i < header->GetFieldCount(); i++)
{
    CSVDocumentField* col = header->GetField(i);
    cout << col->GetText() << "\t";
}

for (int i = 1; i < body->GetRowCount(); i++) // i = 1 so we skip the header
{
    CSVDocumentRow* row = body->GetRow(i);
    for (int p = 0; p < row->GetFieldCount(); p++)
    {
        cout << row->GetField(p)->GetText() << "\t";
    }
    cout << "\n";
}

body->GetRecord(10)->SetText("hello world");

CSVDocumentRow* lastRow = body->AddRow();
lastRow->AddField()->SetText("Hey there");
lastRow->AddField()->SetText("Hey there column 2");

doc->Save("file.csv"); 
```

这为我们提供了以下接口：

```
class CSVDocument
{
public:
    void Load(const char* file);
    void Save(const char* file);

    CSVDocumentBody* GetBody();
};

class CSVDocumentBody
{
public:
    int GetRowCount();
    CSVDocumentRow* GetRow(int index);
    CSVDocumentRow* AddRow();
};

class CSVDocumentRow
{
public:
    int GetFieldCount();
    CSVDocumentField* GetField(int index);
    CSVDocumentField* AddField(int index);
};

class CSVDocumentField
{
public:
    const char* GetText();
    void GetText(const char* text);
}; 
```

现在你只需要从这里填写空白:)

当我这么说的时候相信我——花时间学习如何制作图书馆，尤其是那些处理数据加载、操作和保存的图书馆，不仅会消除你对此类图书馆存在的依赖，还会让你成为一个全能的——围绕更好的程序员。

:)

**编辑**

我不知道您对字符串操作和解析了解多少；因此，如果您遇到困难，我很乐意提供帮助。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-02-17T13:21:19.310

这是您可以使用的一些代码。来自 csv 的数据存储在行数组中。每行都是一个字符串数组。希望这可以帮助。

```
#include <iostream>
#include <string>
#include <fstream>
#include <sstream>
#include <vector>
typedef std::string String;
typedef std::vector<String> CSVRow;
typedef CSVRow::const_iterator CSVRowCI;
typedef std::vector<CSVRow> CSVDatabase;
typedef CSVDatabase::const_iterator CSVDatabaseCI;
void readCSV(std::istream &input, CSVDatabase &db);
void display(const CSVRow&);
void display(const CSVDatabase&);
int main(){
  std::fstream file("file.csv", std::ios::in);
  if(!file.is_open()){
    std::cout << "File not found!\n";
    return 1;
  }
  CSVDatabase db;
  readCSV(file, db);
  display(db);
}
void readCSV(std::istream &input, CSVDatabase &db){
  String csvLine;
  // read every line from the stream
  while( std::getline(input, csvLine) ){
    std::istringstream csvStream(csvLine);
    CSVRow csvRow;
    String csvCol;
    // read every element from the line that is seperated by commas
    // and put it into the vector or strings
    while( std::getline(csvStream, csvCol, ',') )
      csvRow.push_back(csvCol);
    db.push_back(csvRow);
  }
}
void display(const CSVRow& row){
  if(!row.size())
    return;
  CSVRowCI i=row.begin();
  std::cout<<*(i++);
  for(;i != row.end();++i)
    std::cout<<','<<*i;
}
void display(const CSVDatabase& db){
  if(!db.size())
    return;
  CSVDatabaseCI i=db.begin();
  for(; i != db.end(); ++i){
    display(*i);
    std::cout<<std::endl;
  }
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-06T05:49:19.830

查看Kernighan & Pike[的“编程实践](http://www.cs.princeton.edu/~bwk/tpop.webpage/)”（TPOP）。它包括一个在 C 和 C++ 中解析 CSV 文件的示例。但即使你不使用代码，这本书也值得一读。

（上一个网址：[http](http://cm.bell-labs.com/cm/cs/tpop/) ://cm.bell-labs.com/cm/cs/tpop/ ）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-02-25T20:52:45.180

**使用 boost tokenizer 来解析记录**，[请参阅此处了解更多详细信息](http://mybyteofcode.blogspot.com/2010/02/parse-csv-file-with-boost-tokenizer-in.html)。

```
ifstream in(data.c_str());
if (!in.is_open()) return 1;

typedef tokenizer< escaped_list_separator<char> > Tokenizer;

vector< string > vec;
string line;

while (getline(in,line))
{
    Tokenizer tok(line);
    vec.assign(tok.begin(),tok.end());

    /// do something with the record
    if (vec.size() < 3) continue;

    copy(vec.begin(), vec.end(),
         ostream_iterator<string>(cout, "|"));

    cout << "\n----------------------" << endl;
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-06T04:28:05.367

我发现了这个有趣的方法：

[CSV 到 C 结构实用程序](http://www.personal.leeds.ac.uk/~bgy1mm/CSVtoC/csvtoc.html)

Quote: CSVtoC 是一个将 CSV 或逗号分隔值文件作为输入并将其转储为 C 结构的程序。

当然，您不能对 CSV 文件进行更改，但如果您只需要对数据进行内存只读访问，它就可以工作。

# java - 如何让 Tomcat 停止缓存我的 servlet 响应？

> ID：415520
> 
> 赞同：7
> 
> 时间：2009-01-06T04:57:14.507
> 
> 标签：java, tomcat, servlets, caching

我正在学习 Servlets 编程，在 Ubuntu 8.10 机器上使用 Apache Tomcat 6，我遇到了一个非常烦人的问题——显然，与缓存有关。

这就是我正在做的事情：我编写了一个 servlet，将它放在一个很好的目录结构中，然后使用 Tomcat Web 应用程序管理器进行部署。它按预期工作。然后我编辑 servlet，重新编译并尝试再次访问它，但 Tomcat 一直返回相同的旧版本。重新加载应用程序甚至重新启动服务器都不起作用。唯一有效的是“取消部署”应用程序，然后重新部署它。

每次对代码进行任何小的更改时，我都必须这样做。糟透了。

我确信有办法解决这个问题，但我在网络上的任何地方都找不到答案（我确实搜索了很多）。我真的很感激任何帮助。谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-03-29T20:35:35.743

Adeel Ansari 的建议是有缺陷的：您永远不应该使用特定于 webapp 的配置来修改 CATALINA_HOME/conf/context.xml。这就是 your-webapp/META-INF/context.xml 的用途。

您也不应该指定 <Context> 的“docBase”属性。您也不应该指定 <Context> 的“路径”属性。

OP 有几个选项：

1.  使用管理器重新加载 Web 应用程序（不需要取消部署/重新部署：简单的重新加载应该可以工作）（[http://tomcat.apache.org/tomcat-6.0-doc/manager-howto.html#Reload_An_Existing_Application](http://tomcat.apache.org/tomcat-6.0-doc/manager-howto.html#Reload_An_Existing_Application)）

2.  将 META-INF/context.xml 中的元素设置为 reloadable="true" ( [http://tomcat.apache.org/tomcat-6.0-doc/config/context.html](http://tomcat.apache.org/tomcat-6.0-doc/config/context.html) )

恕我直言，如果您需要有关 Tomcat 的帮助，请加入用户的邮件列表并获得一些真正的答案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-06T05:13:57.887

在您的 TOMCAT_HOME/conf/ 下，您将找到一个名为 Context.xml 的文件。内容如下所示，

```
<Context>
    <!-- Default set of monitored resources -->
    <WatchedResource>WEB-INF/web.xml</WatchedResource>
    <WatchedResource>WEB-INF/classes</WatchedResource>
</Context> 
```

这两行在这里都没有注释，你也应该取消注释。您可能会评论第二个，或者根本没有评论。尝试取消注释它，或者在后一种情况下添加它。我假设您在 TOMCAT_HOME/webapps 下部署您的应用程序。

**[已编辑]**

尝试在*Context*元素下使用*docBase*和*路径属性。*下面是示例

 *```
<Context docBase="path-to-WEB-INF" path="/your-app"> 
```

**注意：不要包含 WEB_INF**

**[已编辑]**

可能是我错过了一些东西。看看[这个](http://tomcat.apache.org/tomcat-6.0-doc/deployer-howto.html#Deploying%20on%20a%20running%20Tomcat%20server)。它是相同的，但更清晰和更具描述性，包括很少的其他选项。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-06T05:16:19.990

我在 Tomcat 5.5 中遇到过类似的问题。我从来没有弄清楚根本原因，但我通过从 %CATALINA_HOME%/work/Catalina/localhost 中删除与 webapp 对应的文件夹来解决它。它不是一个很好的解决方案，但它避免了您不得不取消部署/重新部署整个应用程序。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-13T10:50:07.340

您没有说您使用的是 ubuntu tomcat 还是从[tomcat.apache.org](http://tomcat.apache.org)单独下载。如果您使用的是 ubuntu，请尝试使用单独的下载使其更简单。标准下载非常易于管理，而且适合开箱即用。可能（我不知道）ubuntu 的配置可能更多地用于生产用途，例如它可能会有些硬化。

推荐的 tomcat 生产设置正是您所描述的（例如，没有自动部署等）。开发设置更易于使用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-06T06:38:51.993

如果您使用 Netbeans，那么它会在您保存文件时自动重新编译该类并将其注入到正在运行的 webapp 中。没有涉及其他步骤，只需点击保存。

# unit-testing - 测试数据的相似文本块

> ID：415522
> 
> 赞同：0
> 
> 时间：2009-01-06T04:57:59.217
> 
> 标签：unit-testing

出于测试目的，我需要创建具有相似但不相同文本的文本文件集。每一套都需要与另一套不同，但也需要有一些共同点。

例如，我可能需要创建 10 组，每组 20 个文档，总共 200 个文档。每个文档大约需要 250 个单词。

如果其中一组文档是关于狗的，那么其他集合的文档应该是关于动物的，例如，这样每个集合（在本例中为动物）之间存在弱链接，而一组中的文档（例如一组中的狗和另一组中的猫）。

文档中的单词不需要按任何特定顺序排列，也不需要在句子中或有意义。

有人知道我如何为我的单元测试生成或获取此类数据吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-06T05:03:55.303

[从古腾堡计划](http://www.gutenberg.org/wiki/Main_Page)中获取一些文本怎么样？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-11-05T19:48:37.290

我需要用于文本索引的测试数据集来基准 solr 索引速度。我从 github 下载了源代码作为 zip 文件。例如这个是巨大的- [https://github.com/spring-projects/spring-framework](https://github.com/spring-projects/spring-framework)

“下载为 zip”按钮。

# compiler-construction - 实现类型推断

> ID：415532
> 
> 赞同：99
> 
> 时间：2009-01-06T05:06:19.433
> 
> 标签：compiler-construction, functional-programming, language-design, type-inference

我在这里看到一些关于静态与动态类型的有趣讨论。由于编译类型检查、更好的文档化代码等原因，我通常更喜欢静态类型。但是，我确实同意，如果按照 Java 的方式完成，它们确实会使代码变得混乱，例如。

所以我即将开始构建我自己的函数式风格语言，类型推断是我想要实现的事情之一。我确实明白这是一个很大的主题，我并不是想创造一些以前没有做过的东西，只是基本的推理......

关于阅读内容的任何指示将帮助我解决这个问题？最好是更实用/实用的东西，而不是更理论的范畴论/类型论文本。如果那里有实现讨论文本，带有数据结构/算法，那就太好了。

* * *

## 回答 #1

> 赞同：94
> 
> 时间：2009-01-06T05:39:48.537

我发现以下资源有助于理解类型推断，按照难度递增的顺序排列：

1.  [免费获得的书 PLAI 的](http://www.plai.org)第 30 章（类型推断），*编程语言：应用程序和解释*，概述了基于统一的类型推断。
2.  暑期课程将[*类型解释为抽象值*](http://okmij.org/ftp/Computation/Computation.html#teval)介绍了使用 Haskell 作为元语言的优雅的评估器、类型检查器、类型重构器和推理器。
3.  [EOPL](http://www.eopl3.com/) , *Essentials of Programming Languages*一书的第 7 章（类型）。
4.  [TAPL](http://www.cis.upenn.edu/~bcpierce/tapl/) , *Types and Programming Languages*一书的第 22 章（类型重构），以及相应的 OCaml 实现[recon](http://www.cis.upenn.edu/~bcpierce/tapl/checkers/recon/core.ml)和[fullrecon](http://www.cis.upenn.edu/~bcpierce/tapl/checkers/fullrecon/core.ml)。
5.  [新书 DCPL](http://dcpl.mit.edu/)的第 13 章（类型重构），编程*语言中的设计概念*。
6.  [学术论文的选择](https://pinboard.in/u:namin/t:type-inference+paper)。
7.  Closure 编译器的[TypeInference](http://www.google.com/codesearch/p?hl=en#l5BkQmivP-Y/trunk/src/com/google/javascript/jscomp/TypeInference.java&q=TypeInference%20package:http://closure-compiler%5C.googlecode%5C.com&sa=N&cd=1&ct=rc)是类型推断的数据流分析方法的一个示例，它更适合 Hindler Milner 方法的动态语言。

然而，由于最好的学习方法是做，我强烈建议通过编程语言课程的家庭作业来实现玩具函数语言的类型推断。

我推荐这两个可访问的 ML 作业，您都可以在不到一天的时间内完成：

1.  [PCF 解释器](http://users.cs.fiu.edu/~smithg/cop4555/hw5.html)（[一种解决方案](http://github.com/namin/spots/tree/master/pcf/interp1.sml)）进行热身。
2.  [PCF 类型推断](http://users.cs.fiu.edu/~smithg/cop4555/hw6.html)（[一种解决方案](http://github.com/namin/spots/tree/master/pcf/type.sml)）实现用于 Hindley-Milner 类型推断的算法 W。

[这些作业](http://www.cs.cmu.edu/~fp/courses/15312-f04/assignments.html)来自更高级的课程：

1.  [实现 MiniML](http://www.cs.cmu.edu/~fp/courses/15312-f04/assignments/asst2/index.html)

2.  [多态、存在、递归类型 (PDF)](http://www.cs.cmu.edu/~fp/courses/15312-f04/assignments/asst5.pdf)

3.  [双向类型检查 (PDF)](http://www.cs.cmu.edu/~fp/courses/15312-f04/assignments/asst6/index.html)

4.  [子类型和对象 (PDF)](http://www.cs.cmu.edu/~fp/courses/15312-f04/assignments/asst7.pdf)

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2009-01-06T06:18:01.473

不幸的是，关于这个主题的许多文献都非常密集。我也站在你的立场上。我从编程语言：应用程序和解释中获得了对该主题的第一次介绍

[http://www.plai.org/](http://www.plai.org/)

我将尝试总结抽象的想法，然后是我没有立即发现的细节。首先，类型推断可以被认为是生成然后解决约束。要生成约束，您需要遍历语法树并在每个节点上生成一个或多个约束。例如，如果节点是`+`运算符，则操作数和结果都必须是数字。应用函数的节点具有与函数结果相同的类型，依此类推。

对于没有 的语言`let`，你可以盲目地通过替换来解决上述约束。例如：

```
(if (= 1 2) 
    1 
    2) 
```

在这里，我们可以说 if 语句的条件必须是布尔值，并且 if 语句的类型与其`then`and`else`子句的类型相同。由于我们知道`1`并且`2`是数字，通过替换，我们知道该`if`语句是一个数字。

事情变得令人讨厌的地方，我有一段时间无法理解的是处理 let：

```
(let ((id (lambda (x) x)))
    (id id)) 
```

在这里，我们绑定`id`了一个函数，该函数返回您传入的任何内容，也称为身份函数。问题是函数参数的类型`x`在每次使用时都不同`id`。第二个`id`是 type 的函数`a -> a`，`a`可以是任何东西。第一个是类型`(a -> a) -> (a -> a)`。这称为 let 多态性。关键是以特定顺序求解约束：首先求解 的定义的约束`id`。这将是`a -> a`。然后，可以将类型的新的、单独的副本`id`替换到每个`id`使用位置的约束中，例如`a2 -> a2`and `a3 -> a3`。

在线资源中不容易解释这一点。他们会提到算法 W 或 M，但不会提到它们在解决约束方面的工作方式，或者为什么它不会对 let 多态性产生误解：这些算法中的每一个都在解决约束时强制执行排序。

我发现这个资源非常有助于将算法 W、M 以及约束生成和求解的一般概念结合在一起。它有点密集，但比许多好：

[http://www.cs.uu.nl/research/techreps/repo/CS-2002/2002-031.pdf](http://www.cs.uu.nl/research/techreps/repo/CS-2002/2002-031.pdf)

那里的许多其他论文也很好：

[http://people.cs.uu.nl/bastiaan/papers.html](http://people.cs.uu.nl/bastiaan/papers.html)

我希望这有助于澄清一个有点模糊的世界。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2015-01-16T05:50:49.463

除了函数式语言的 Hindley Milner 之外，另一种流行的动态语言类型推断方法是 `abstract interpretation`.

抽象解释的想法是为该语言编写一个特殊的解释器，而不是保持一个具体值（1、false、闭包）的环境，它适用于抽象值，也就是类型（int、bool 等）。由于它是在抽象值上解释程序，这就是为什么它被称为抽象解释。

Pysonar2 是 Python 抽象解释的优雅实现。Google 使用它来分析 Python 项目。基本上它用于`visitor pattern`将评估调用发送到相关的 AST 节点。访问者函数[`transform`](http://www.codatlas.com/project/_I_Xhzhsm_vE9TA1gGu-zQ__/HEAD/src/main/java/org/yinwang/pysonar/ast/Node.java?line=123) 接受将[`context`](http://www.codatlas.com/project/_I_Xhzhsm_vE9TA1gGu-zQ__/HEAD/src/main/java/org/yinwang/pysonar/State.java?line=14)在哪个当前节点进行评估，并返回当前节点的类型。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-06T05:13:07.127

Benjamin C. Pierce 的类型和编程语言

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-01-06T05:11:10.810

终极版 Lambda，从[这里](http://lambda-the-ultimate.org/node/492)开始。

# css - 在 ASP.NET 中将 HTML 转换为 PDF 时保持 CSS 样式

> ID：415535
> 
> 赞同：7
> 
> 时间：2009-01-06T05:07:52.317
> 
> 标签：css, asp.net, itext, pdf-generation

我正在使用 ITextSharp 将 HTML 页面转换为 PDF。

但是，ITextSharp 会直接打印 STYLE 声明中的 CSS，即使以编程方式添加也会忽略样式表，并且仅侦听某些内联样式（例如`font-size`and `color`but not `background-color`）。

ITextSharp 是否缺少某些东西，或者是否有更好（且免费）的方式来进行此转换？

提前致谢，

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-01T15:53:02.387

iText/iTextSharp 中的 HTML/CSS 支持[非常基础](http://itext-general.2136553.n4.nabble.com/Re-iTextsharp-HTML-to-PDF-problem-with-Croatian-characters-tp2171990p2171995.html)。这不是将 html 转换为 pdf 的正确工具。请查看以下解决方案：

*   [使用类似 Watin 的工具创建页面截图](https://stackoverflow.com/questions/340501/create-screenshot-of-the-page-with-watin-like-tool)
*   [http://blog.taiki.be/index.php/2008/07/generating-screenshots-of-webpages-using-net/](http://blog.taiki.be/index.php/2008/07/generating-screenshots-of-webpages-using-net/)
*   [http://www.codegod.de/WebAppCodeGod/Screenshot-of-Webpage-with-ASP-NET-AID398.aspx](http://www.codegod.de/WebAppCodeGod/Screenshot-of-Webpage-with-ASP-NET-AID398.aspx)

这些将 html 呈现为图像。然后您可以使用 iTextSharp 将它们插入您的 PDF 中。

否则，您可以尝试转换 HTML -> XSL-FO -> PDF，但包括 CSS 则完全是另一回事。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-08-31T13:39:38.870

看看 WKHTMLTOPDF。它是开源的，基于 webkit 并且是免费的。

[我们在这里](http://beebole.com/en/blog/general/convert-html-to-pdf-with-full-css-support-an-opensource-alternative-based-on-webkit/)写了一个小教程。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-01T04:58:44.497

试试 PDF Duo .NET 转换器。如果您需要特殊功能，您可以申请支持。

[http://www.duodimension.com/html_pdf_asp.net/downloads/html_pdf_net.zip](http://www.duodimension.com/html_pdf_asp.net/downloads/html_pdf_net.zip)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-05-21T12:32:59.917

ABCpdf 提供了两个 HTML 渲染引擎。一种是基于系统上安装的 MSHTML 版本。另一个基于 FireFox Gecko 渲染引擎。

因此，如果您想要一组特定的功能，则有足够的操作空间。这是非常真实的世界。

就质量而言，我只想说，在尝试了很多不同的替代方案后，我们确实让很多人选择了 ABCpdf。

我在 ABCpdf .NET 软件组件上工作，因此我的回复可能包含基于 ABCpdf 的概念。这只是我所知道的。:-)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-06-05T13:29:54.840

为什么不使用在线 API？有很多可用的并且它们工作得很好，这让您担心您的核心工作，而不是如何正确呈现 PDF :)

你提到了一些“免费”的东西。这取决于您的使用情况，但大多数服务一开始都提供免费转换，范围从 50 到 250（甚至更多）。也许这对你来说就足够了吗？

然后，您所要做的就是使用您的 HTML 数据（或链接）向服务发出基本的 POST 请求，然后您将获得一个 PDF 作为响应。

以下是用于将 HTML 转换为 PDF 的 API 列表（并非详尽无遗）：

*   [PDFShift](https://pdfshift.io)
*   [HTML2Pdf火箭](https://www.html2pdfrocket.com/)
*   [Web2PDF转换](https://www.web2pdfconvert.com/)
*   [PDF在线](http://www.pdfonline.com/convert-pdf/)
*   ... （还有很多 ：） ）

# math - 数学、编程和学习

> ID：415537
> 
> 赞同：28
> 
> 时间：2009-01-06T05:10:30.860
> 
> 标签：math

之前在这个网站上已经讨论过数学和编程之间的关系，以及一个是否是另一个的子集等。

在我最近对编程的研究中，我发现自己越来越希望自己在数学方面做得更好。当编程书籍开始以数学方式概括某些东西时，你们都知道这种情况（“因此，我们可以说`<some single letter>`，`<lots of letters>`”）。在这种情况下，我的眼睛呆滞了。我知道这**主要是**因为我很愚蠢，但似乎如果我能提高我的高等数学技能，也许我可以从这些事情中得到更多。

**主要问题：**数学确实是一个可以“变得更好”的东西，还是你的大脑有点为它而设计？

重要的后续问题：如果上述答案是肯定的，那么有哪些方法可以解决？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-01-06T05:56:38.910

我认为任何人都可以在数学上变得更好。你只需要下定决心并练习。

部分问题在于数学书籍往往是由几十年前不再是数学新手的数学家写的。你想要的是适合你水平并且包含你可以使用的材料的书籍。

一些建议：

*   如果你能找到一份副本，获得 Mathematica 和一本关于它的好书（Schaum 的大纲实际上非常好而且便宜）。我一直用它来形象化事物。

*   作为一名程序员，您可能希望更多地关注离散数学而不是微积分。

*   其他地方提到的具体数学书非常好。

*   大多数介绍性离散数学课本都很好地涵盖了逻辑、集合、组合、概率、图论等内容。我的学校使用了我喜欢的 Rosen 的课本。

*   如果您要进行 3D 图形编程，线性代数很有用。大多数针对工程师的介绍性文本都会教您需要了解的内容。如果您想要更理论的东西，那么正确完成的线性代数可能是“真正的”线性代数中最好的。

*   寻找马丁·加德纳 (Martin Gardner) 的书籍并玩他的谜题。他是一位出色的作家和老师。

请记住，数学并没有太大变化。您可以在亚马逊和二手书店以便宜的价格买到二手书。我买教科书时总是寻找n-1版本。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-01-06T06:37:02.603

当您第一次开始学习英语时，所有这些“符号”（字母）对您来说都像是胡言乱语。我敢肯定，在某些时候，您因缺乏理解而感到沮丧。但慢慢地，渐渐地，你开始了解它们。

最终，您能够使用这些符号构建自己的单词和句子。经过多年对其结构和语法的纠正，您现在已经掌握了该语言。

数学就是这样。你的眼睛呆滞，因为你还没有学过语言。也许在学校里你并不特别喜欢数学，因为你没有看到它的任何实际应用。当然，我们向学生教授数学的方式很糟糕，所以难怪许多人在没有精通数学的情况下通过学校（为了进一步阅读，请查看[数学家的哀叹](http://www.maa.org/devlin/LockhartsLament.pdf)，其中讨论了我们目前的数学教学方法是多么可怕） .

但是，达到一定程度的熟练程度永远不会太晚，这将使您能够阅读许多学术计算机科学著作。晚上从当地社区大学的微积分开始（复习你忘记的一切）。然后继续学习微积分，然后学习离散数学。老实说，这就是你在 99.99% 的时间里需要的所有数学。在不到 2 到 3 个学期的时间内，您就可以完全跟上进度，并且在阅读具有一定数学基础的东西时，您将不再目瞪口呆。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-06T06:25:33.237

我可以分享我的经验...

从小学开始，我就对数学感到恐惧。讨厌它，没有抓住重点，没有追求它。

相比之下，我一直对计算机着迷。我从“需要知道”的角度学习编程——我不能忍受不理解计算机和从最低到最高级别的编程。我几乎完全是自学成才，并且从事程序员/建筑师的职业。

去年，在妻子的催促下，我开始重新上大学。我报名参加了代数补习班，我知道这会很痛苦。不是。

不知何故，通过多年来学习开发 OO 软件，我似乎欺骗了自己学习如何进行数学思考。这些概念不再那么困难了。可能是因为我学会了用由更小、更简单的想法组成的复杂系统来思考。

我现在正在研究游戏开发，*那*是一些严肃的面向数学的编程。比我迄今为止所做的业务发展要多得多。但是，我并不觉得它如此令人生畏，因为它是*应用*数学。努力解决实际问题似乎使研究变得不那么乏味而有趣。我发现 Wikipedia 和 Wolfram 的 Mathworld 很有帮助。如果您已经知道如何编程，那么您就领先于学习数学的游戏了。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-06T05:17:26.680

我会说这当然是任何人都可以做得更好的事情。这需要时间和耐心，有些文本就所涉及的符号而言过于密集，但如果你愿意花时间，我认为它不应该太可怕。

我会查看维基百科的[数学符号列表](http://en.wikipedia.org/wiki/Table_of_mathematical_symbols)，并在您看到大量符号弹出时保持在附近。一次翻译一个，并以对您最有意义的方式将它们放在一起（或者问我们几次，直到您掌握它的窍门）。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-01-06T05:22:04.720

两者都是。你*可以*在数学上变得更好。但你也确实受到大脑中特定线路的限制/赋予。这意味着您很可能可以提高您当前的数学技能。但是，由于您的脑力有限，您可能永远不会发现新的定理。

当谈到改进时，我认为一如既往的方法是练习。阅读数学文献，尝试解决数学问题，并最终形成一种观点，使你能够习惯性地打破你在数学术语中看到的现实世界难题。

至于编程与数学的关系，我认为有很强的关系。事实上，有人可能会争辩说，程序只不过是定理的证明，需求文档是证明的所有输入。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-06T06:43:50.017

如果不使用，您的技能会生锈，如果不使用，知识会随着时间的推移而消失。如果你不使用你的数学技能，你很快就会没有数学技能。不断学习和练习你已经拥有的技能，有一天你会成为一名数学/编程大师。

[欧拉计划](http://projecteuler.net/)有很多数学问题，只能通过编程来解决。问题变得更加困难，但建立在您以前的解决方案中获得的技能和知识之上。

我还在二手书店买了一些有趣的教科书。他们的便宜，慢慢地你的技能提高。我将它们与[MIT Open Course ware](http://ocw.mit.edu/OcwWeb/web/home/home/index.htm)结合使用。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-01-06T07:23:57.050

一个有趣的数学练习方法是[http://projecteuler.net/](http://projecteuler.net/)。尽管它不如学习课程或阅读教科书那么系统/有效。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-01-06T09:14:11.990

我十分明白你的感受。我一直想学更多的数学，但由于我在放学后无法在大学学习（没有足够的空间）并且无法在大学学习（无法获得 CS 学位）我还没有从 16 岁开始正式学习数学。

数学是任何人都可以学习的东西。有些人会争辩说，随着年龄的增长，它会变得越来越难，但我遇到过 60 岁以上的人正在轻松上数学课。我的大学里有一位女性已经 70 岁了，她还有几个月就要毕业并获得数学相关领域的学位。如果你想学数学，那么现在正是时候，虽然我会是第一个说这不容易的人。虽然您会发现许多问题通过编程经验非常容易解决，但您仍然会发现解决一系列问题需要花费大量时间。我几乎完成了关于线性代数的 MIT OpenCourseWare 课程，然后最终得到了一份新的兼职工作，每周工作 7 天，每天工作 10 小时，并且忘记了我所学的大部分内容。

话虽如此，如果您有时间和真正的奉献精神，我可以推荐一些视频讲座的链接，这些链接可能会帮助您继续前进。

*   [预微积分代数](http://www.tkc.iblog.co.za/2008/07/05/video-lectures-in-algebra-ii-and-pre-calculus/)
*   [预微积分](http://courses.ncsu.edu/ma107/common/media/MA107Lectures.html)
*   [结石](http://www.math.armstrong.edu/faculty/hollis/calcvideos/)
*   [应用概率](http://www.aduni.org/courses/probability/index.php?view=cw)
*   [统计学概论](http://webcast.berkeley.edu/course_details.php?seriesid=1906978493#21073)
*   [微分方程](http://ocw.mit.edu/OcwWeb/Mathematics/18-03Spring-2006/CourseHome/)
*   [线性代数](http://ocw.mit.edu/OcwWeb/Mathematics/18-06Spring-2005/CourseHome/index.htm)

我并不是说这是你需要知道的。这是我在 CS 学位毕业之前开始自己学习的内容，所以请随意挑选任何你认为最适合自己的东西。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-01-06T06:40:53.673

学习数学就像接受经典教育，特别适合程序员和其他计算机专业人士。随着年龄的增长，您会更加欣赏数学。你会意识到，这与其说是想出答案，不如说是深入和概念性地思考。这样一来，您可能会得出的“答案”更有意义。

有一次，我会建议参加几何课程，并花一些时间学习如何证明定理，看看这些概念是如何结合在一起的。不过，这些天来，我会说学习离散数学课程可能会更好。它更实用，种类也更多，但如果你愿意的话，仍然有足够的理论让它具有挑战性。

离散数学还为您提供了以前可能没有想到的编程挑战。也许你可以破解一个很好的启发式来解决一个 NP 完全问题，比如一个 N 城市旅行商问题。甚至可能想出几个解决方案，并测试哪些解决方案在哪种情况下效果最好。

（我在大学里从来没有上过 CompSci 课程。你大概能看出来。）

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-01-07T05:33:01.423

我认为学习数学有两件事：1.学习一般技术。即如何添加两个分数，如何区分，整合。2\. 学习解决问题并将数学应用于现实世界。

我认为通过拿起数学教科书你会学到 1\. 许多数学教科书是按部分组织的，其中会有几页向您展示一种技术，然后是一堆问题。这些问题往往与您刚刚学习的技术有关并且非常相似。即关于对数的部分将有对数的所有问题，并且可能不包括任何多项式。通过完成本节中的问题，您将学习技术。你做的问题越多，你得到的速度就越快，你对概念的理解就越多。很多时候你会发现，如果你在没有明确记住公式的情况下解决问题，你会发现在你做得足够多之后，所需的公式就会被隐式记住。最终，如果您在查看概率公式时遇到困难，您将需要阅读一本概率书。

学习 2 我认为数学教科书并没有太大帮助，因为每个部分往往都有与该部分相关的问题。偶尔会有一些“混合审查”问题或混合问题的“章节审查”，但它们通常介于两者之间。物理、生物、化学等科学教科书往往更适合这一点。在那里，您经常阅读问题，将其布置，并最终使用各种数学工具来解决它。有时微积分、线性代数和几何都在同一个问题中。这里的价值在于它教会你解决问题。一般来说，SAT/GRE 不测试你是否知道如何做代数，他们测试你是否知道如何将它应用到现实世界中，科学问题在这里真的对你有帮助。一般来说，编程也是关于解决问题的，你越擅长解决问题，你就越擅长编程。基本上，在编程中，您需要解决问题、创建心智模型、设计解决方案，然后用您选择的编程语言对其进行建模。这类似于说物理。您查看问题，提取数学模型，设计解决方案，然后使用解决方案模型编写一些方程式，然后插入数字。我强烈推荐物理，因为在我的大学物理课之后，单词问题对我来说变得简单并且他们使用了非常困难（尽管并非不可能）。这类似于说物理。您查看问题，提取数学模型，设计解决方案，然后使用解决方案模型编写一些方程式，然后插入数字。我强烈推荐物理，因为在我的大学物理课之后，单词问题对我来说变得简单并且他们使用了非常困难（尽管并非不可能）。这类似于说物理。您查看问题，提取数学模型，设计解决方案，然后使用解决方案模型编写一些方程式，然后插入数字。我强烈推荐物理，因为在我的大学物理课之后，单词问题对我来说变得简单并且他们使用了非常困难（尽管并非不可能）。

在日常编程中，您可能只会使用代数和逻辑（用于 if 语句和循环条件）。有些地方使用高数学，例如计算机游戏、密码学、数据挖掘等，但对于典型的业务应用程序，您可能不会使用比代数和逻辑更多的东西，也许还有一些集合论（这些东西你已经很基础了）内化它）。即使在使用高级数学的地方（如金融公司），业务用户（或某些行业文献）通常也会完成高级数学，您只需要实现方程式（使用一些代数）。我之所以提到这一点，是因为大多数编程书籍也没有比代数和逻辑更多的内容，除非您正在阅读有关算法分析（算法简介）、人工智能或其他一些研究领域的教科书。

但取决于你在读什么数学可以提供帮助。对于大多数计算机科学代数 + 离散数学应该足够了。再加上一些物理练习，你应该很高兴。这可能仍然是一个缓慢的过程，但你应该有适当的背景。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-01-06T09:03:52.790

首先，我会推荐 Steve Yegge 的[程序员数学](http://steve-yegge.blogspot.com/2006/03/math-for-programmers.html)。它几乎总结了你的斗争。

现在我想讲一个个人故事。我是数学和CS的双学位。我在数学课上学到了很多，但老实说，我并没有像我应该的那样感激它。我会告诉你，我所做的很多事情都对我的编程生涯有所帮助。这不是关于一些公式或知道微积分，或任何这些东西。这是一个坚实的数学背景教你如何思考以解决问题。对我来说，这就是你需要的数学。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-01-06T14:52:05.163

绝对可以学的。我个人从我在大学学习的数学（尤其是证明）课程中受益最大。

推荐课程：

*   离散数学
*   数学思想
*   抽象代数
*   任何其他证明课程

推荐书籍：

*   证明的基本要素，作者：Antonella Cupillari

我强烈建议尝试在某所学校学习其中一门或多门课程。找一所当地的大学并审核一门课程。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-01-07T02:43:07.473

第二次投票给洛克哈特的“数学家的哀叹”，它建议像绘画、诗歌或音乐一样教授数学——不是因为它的实用性，而是为了简单的乐趣：

> 这里没有不可告人的实际目的。我只是在玩。这就是数学——想知道，玩，用你的想象力自娱自乐。

看看最近 Knuth 论文[Dancing Links](http://www-cs-faculty.stanford.edu/~knuth/preprints.html)中的图表，告诉我他制作这些图表并不开心。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-01-07T04:06:09.663

Part of the problem is that a few mathematical symbols convey a heck of a lot of information. If you are reading a normal programming book, it is full of words and code. Neither of these is super verbose (although I often have to slow down much more on code than normal words). However one complicated mathematical equation can easily be a screen full of programming code or words. We have all sorts of simple notations that convey complex processes.

Another issue is that notation is standardized but not exactly. Different books use slightly different notation so it takes a while to get used to it. Also many textbooks leave out key steps in mathematical proofs or even examples. Sometimes even college professors puzzle themselves with the missing steps in a given proof in a textbook and then give their own proof, or give a slightly modified one over the one in the book because they learned it differently or can't recreate the missing step exactly which takes the proof in a different direction.

So anyway just because your eyes glaze over doesn't mean you have to give up. The first time you see the equations you will probably be in read the english text mode and have to pause to consider them. Going over them slowly and paying attention to what all the symbols mean one step at a time may yield the answer for you. If there is some notation you haven't seen before, there is probably an intro chapter or appendix explaining the notation, so check there. Finally, look for other sources. Use google/wikipedia to look up equations for the concept and you may find a derivation and/or proof that you can follow. Additionally the other one may help you to understand the current proofs/derivations better. Even if your understanding of the proof/derivation does not improve, your additional research will probably aid in your understanding of the equation.

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-01-06T05:19:21.823

去当地的社区学院注册微积分 1。这涵盖了数学意义上的函数，并且有严格的代数进修课程，并且会使用足够多的符号来帮助你取得成功。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2010-07-29T22:56:03.443

我喜欢组合学和算法——玩得开心，学得更快。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2009-01-06T09:53:27.293

1) 是的。

2) 探索听起来很有趣的数学问题。购买/阅读能够为您提供所需信息的书籍。重复。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-01-06T15:16:57.967

我还推荐[项目 euler](http://projecteuler.net/)虽然它并不完全教授数学，但它给你提供了问题，然后你可以查找如何解决。我一直更喜欢解决实际问题，而不仅仅是学习理论。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-01-06T05:18:03.043

学习学习学习！

维基百科实际上是一个相当不错的数学参考。从您有兴趣学习的内容开始，然后点击链接，直到您了解该初始内容的所有构建块。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2009-01-06T06:21:55.770

练习练习练习！

Schaum 的轮廓很适合这一点。如果您对概率（涉及组合学）感兴趣，请参阅概率中的 50 个具有挑战性的问题。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2009-01-06T11:53:28.207

简短的回答：
可能有些人为了获得好的数学*而愚蠢。*但是那些人通常也很*愚蠢*地编程。

所以如果你有一些编程技能，你可能会认为自己足够聪明，可以学习数学。

*注意：我知道有些聪明人有严重的数学学习障碍，但我认为那更像是一个例外。*

# javascript - 原型和jQuery和平共处？

> ID：415550
> 
> 赞同：11
> 
> 时间：2009-01-06T05:17:54.137
> 
> 标签：javascript, jquery, wordpress, prototypejs

我对 JavaScript 知之甚少，但尽管如此，我还是试图在我的 wordpress 博客上拼凑一些东西。它不起作用，我不知道如何解决它，嘿，这就是 StackOverflow 的用途，对吧？

首先，错误信息是：

```
Error: element.dispatchEvent is not a function
Source File: http://.../wp-includes/js/prototype.js?ver=1.6
Line: 3936 
```

它发生在页面加载时。我的页面加载处理程序是这样注册的：

```
Event.observe(window, 'load', show_dates_as_local_time); 
```

如果我禁用其他一些插件，错误就会消失，这（加上谷歌搜索）让我得出结论，这是原型和 jQuery （被其他一些插件使用）之间的冲突。

其次，我遵循 wordpress 推荐的做法，[`wp_enqeue_script`](http://codex.wordpress.org/Function_Reference/wp_enqueue_script)将我的 JavaScript 的依赖项添加到 Prototype 库，如下所示：

```
add_action( 'wp_print_scripts', 'depo_theme_add_javascript' );

function depo_theme_add_javascript() {
    wp_enqueue_script('friendly_dates', 'javascript/friendly_dates.js', array('prototype'));
} 
```

现在我也知道 jQuery 和 Prototype 之间存在一些潜在的冲突，这些冲突是使用 jQuery`noConflicts`方法解决的。我试过从不同的地方打电话，但没有用。我*认为*这不是问题，因为a）`noConflict`函数仅与`$`变量相关，这似乎不是问题，并且b）我*希望*wordpress为我解决它，因为它可以......

最后，使用 Venkman 调试器，我确定`element`错误消息中引用的确实是 an`HTMLDocument`但也确实缺少`dispatchEvent`. 不确定这是怎么发生的，因为它是标准的 DOM 方法？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-06T06:27:05.697

许多库都有一个我非常喜欢的讨厌的技巧，看起来原型就是其中之一。

如果我是对的，Mootools 就是这样做的，它涉及在基本类上重载许多原型，并对其进行修补。

同样，当 mootools 和 jQuery 存在时，我同样遇到了奇怪的行为，通常 jQuery 死了，因为它正在调用一些对象方法，该方法已被 Mootools 以某种方式重载/猴子修补。

此外，不可思议的是，将 mootools 从脚本使用列表中删除后，*一切都*运行得更快了，我的结论是对象污染更少。

现在我可能是错的，但我根据我的经验得出结论，这些库根本不喜欢彼此共存，并且看到我觉得 mootools 代码似乎降低了完成正常事情的速度，我吸了起来，将所有基于 mootools 的代码移植到 jQuery（我向你保证这是一项耗时的交易），结果是代码*速度很快* *，并且*没有无法解释的奇怪错误。

我建议您至少将迁移视为您的选择**之一**。

**还有一件事，写作时：**

我倾向于在我所有的 jQuery 驱动代码中使用这种语法，以便在有人以某种方式破坏 '$' 的情况下进行一些安全封装。

**运行时代码** 这在执行之前等待 document.ready：

```
 jQuery(function($){ 
      code_with_$_here; 
 }); 
```

**jQuery 插件**

```
(function($){ 
    code_with_$_here; 
})(jQuery); 
```

使用这些将使使用您编写的任何 jQuery 的人更容易*使用*它而不会出现太多冲突问题。

这基本上会让他们确保他们的代码没有做任何真正神奇的事情。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-06T06:48:55.373

值得在 JQuery 网站上阅读这篇关于[将 JQuery 与其他库一起使用](http://docs.jquery.com/Using_jQuery_with_Other_Libraries)的文章。它处理的不仅仅是 noConflict 选项。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-06T12:42:09.917

我认为你应该好好搜索一下，因为所有的 jQuery 插件都有一个原型版本，所有的原型插件都有一个 jQuery 版本。如果你真的没有找到你想要的并且你不能只使用一个库，看看[这里](http://docs.jquery.com/Core/jQuery.noConflict)

```
jQuery.noConflict(); 
```

但同样，我认为为每个库加载超过 15-20kb 是没有意义的 :)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-11T22:23:21.653

谢谢大家的建议。最后我认为肯特的解释是最接近的，基本上相当于“原型坏了”。（对不起，如果我对你的总结不正确：）

至于`jQuery.noConflict`选项-我已经在问题中提到了这一点。*当*您运行此方法时，它会有所不同，而我对此几乎没有控制权。正如我所说，我尝试在几个不同的地方（特别是页眉和我的脚本文件）运行它，但没有效果。因此，正如我们所希望的那样，“仅使用`noConflict`”*并不是*这个问题的答案，至少在没有额外信息的情况下不是这样。

此外，`jQuery.noConflict` *似乎*与`$`变量有关，错误点周围的代码根本不处理该变量。当然它们可能是间接相关的，我还没有找到它。

所以基本上我最终使用 jQuery 而不是 Prototype 重写了脚本，这实际上有自己的问题。无论如何，我已经[在我的博客上发表了整个战争故事](http://girtby.net/archives/2009/01/07/monkeying-with-javascript/)，如果你感兴趣的话。

# c# - MSTest 代码覆盖率

> ID：415562
> 
> 赞同：22
> 
> 时间：2009-01-06T05:29:18.747
> 
> 标签：c#, .net, testing, tdd, code-coverage

如果我使用 MSTest，有没有办法在 Visual Studio 中测试代码覆盖率？还是我必须购买 NCover？

如果 Microsoft 不提供内置工具来进行代码覆盖，那么 NCover Enterprise 是否物有所值，或者旧的测试版是否足够好？

编辑：VS 产品的描述以及哪些包括代码覆盖率 [https://www.visualstudio.com/vs/compare/](https://www.visualstudio.com/vs/compare/)

如果您的 VS 版本不支持，可以使用TestDriven.NET ( [http://testdriven.net/ )。](http://testdriven.net/)

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-06T08:15:32.547

MSTest 包括代码覆盖率，至少在我拥有的 VS 版本中是这样。但是，您需要在 testrunco​​nfig 中启用检测，这很丑陋，而且是一个主要的 PITA。

一个更简单的选择是使用[TestDriven.NET](http://testdriven.net/)，它可以自动覆盖，即使对于 MSTest 也是如此。而且由于它使用 MSTest 核心，您仍然可以获得 VS 的所有优点，例如着色（覆盖代码的红/蓝线）。请参见[此处](http://weblogs.asp.net/nunitaddin/archive/2006/11/08/Driving-MSTest-and-Team-Coverage-using-TestDriven.NET.aspx)（包括截屏视频），或者由于图像说了一千个字：

[![替代文字](https://i.stack.imgur.com/i5kXe.gif "团队覆盖")](https://i.stack.imgur.com/i5kXe.gif "团队覆盖")
[（来源：[mutantdesign.co.uk](http://www.mutantdesign.co.uk/weblog/images/DrivingMSTestandTeamCoverageusingTes.NET_F424/MSTestAndTeamCoverage_thumb1.gif)）]

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-01-06T06:02:32.797

是的，您可以从 Visual Studio 中找到代码覆盖率信息，前提是您拥有提供该功能的 Visual Studio 版本，例如团队系统。在 VS.NET 中设置单元测试时，将创建一个 localtestrun.testrunco​​nfig 文件并将其添加为解决方案的一部分。双击此文件并在对话框左侧找到选项代码覆盖率选项。选择要为其收集代码覆盖率信息的程序集，然后重新运行单元测试。代码覆盖率信息将被收集并可用。要获取代码覆盖率信息，请打开测试结果窗口并单击代码覆盖率结果按钮，这将打开一个显示结果的替代窗口。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2016-05-03T13:25:52.877

（请注意，此答案（此处/下方）适用于 DotNet FRAMEWORK。我在这里创建了一个 dotnet-core 答案：[如何在 donetcore 2 应用程序中获取代码覆盖率报告](https://stackoverflow.com/questions/49049029/how-to-get-code-coverage-report-in-donetcore-2-application/59951055#59951055)）

...................................

对于未来的读者：

哇，这不好玩。我希望这对互联网领域的人有所帮助。

请注意，“CodeCoverage.exe”的存在可能取决于您拥有的 Visual Studio 版本。而且您可能必须在构建服务器中安装 VS（一些增强版本）。

```
set __msTestExe=C:\Program Files (x86)\Microsoft Visual Studio 14.0\Common7\IDE\MSTest.exe
set __codeCoverageExe=C:\Program Files (x86)\Microsoft Visual Studio 14.0\Team Tools\Dynamic Code Coverage Tools\CodeCoverage.exe

rem (the below is a custom C# console application, code seen below)
set __customCodeCoverageMergerExe=CoverageCoverterConsoleApp.exe

rem below exe is from https://www.microsoft.com/en-us/download/details.aspx?id=21714 
set __msXslExe=C:\MyProgFiles\MsXslCommandLine\msxsl.exe

REM the below calls will create the binary *.coverage files
"%__codeCoverageExe%" collect /output:"D:\BuildStuff\TestResults\AAA_DynamicCodeCoverage.coverage" "%__msTestExe%" /testcontainer:"D:\BuildStuff\BuildResults\My.UnitTests.One.dll" /resultsfile:"D:\BuildStuff\TestResults\My.UnitTests.One.trx"
"%__codeCoverageExe%" collect /output:"D:\BuildStuff\TestResults\BBB_DynamicCodeCoverage.coverage" "%__msTestExe%" /testcontainer:"D:\BuildStuff\BuildResults\My.UnitTests.Two.dll" /resultsfile:"D:\BuildStuff\TestResults\My.UnitTests.Two.trx"
"%__codeCoverageExe%" collect /output:"D:\BuildStuff\TestResults\CCC_DynamicCodeCoverage.coverage" "%__msTestExe%" /testcontainer:"D:\BuildStuff\BuildResults\My.UnitTests.Three.dll" /resultsfile:"D:\BuildStuff\TestResults\My.UnitTests.Three.trx"

rem below, the first argument is the new file, the 2nd through "N" args are the result-files from the three "%__codeCoverageExe%" collect above
rem this will take the three binary *.coverage files and turn them into one .xml file
"%__customCodeCoverageMergerExe%" "D:\BuildStuff\TestResults\DynamicCodeCoverage.merged.coverage.converted.xml" "D:\BuildStuff\TestResults\AAA_DynamicCodeCoverage.coverage" "D:\BuildStuff\TestResults\BBB_DynamicCodeCoverage.coverage" "D:\BuildStuff\TestResults\CCC_DynamicCodeCoverage.coverage"

"%__msXslExe%" "D:\BuildStuff\TestResults\DynamicCodeCoverage.merged.coverage.converted.xml" "D:\BuildStuff\Xsl\VSCoverageToHtml.xsl" -o "D:\BuildStuff\TestResults\CodeCoverageReport.html" 
```

您还可以将 3 个 UnitTests.dll 合并为一个调用

```
REM the below calls will create the binary *.coverage files
"%__codeCoverageExe%" collect /output:"D:\BuildStuff\TestResults\ZZZ_DynamicCodeCoverage.coverage" "%__msTestExe%" /testcontainer:"D:\BuildStuff\BuildResults\My.UnitTests.One.dll" /testcontainer:"D:\BuildStuff\BuildResults\My.UnitTests.Two.dll" /testcontainer:"D:\BuildStuff\BuildResults\My.UnitTests.Three.dll" /resultsfile:"D:\BuildStuff\TestResults\My.UnitTests.AllOfThem.trx"

rem below, the first argument is the new file, the 2nd through "N" args are the result-files from the three "%__codeCoverageExe%" collect above
rem this will take the one binary *.coverage files and turn them into one .xml file
"%__customCodeCoverageMergerExe%" "D:\BuildStuff\TestResults\DynamicCodeCoverage.merged.coverage.converted.xml" "D:\BuildStuff\TestResults\ZZZ_DynamicCodeCoverage.coverage" 

"%__msXslExe%" "D:\BuildStuff\TestResults\DynamicCodeCoverage.merged.coverage.converted.xml" "D:\BuildStuff\Xsl\VSCoverageToHtml.xsl" -o "D:\BuildStuff\TestResults\CodeCoverageReport.html" 
```

VSOverageToHtml.xsl

我还在互联网上找到了一些 xsl。（下面的3个链接几乎是相同的xsl）

[http://codetuner.blogspot.com/2011_09_01_archive.html](http://codetuner.blogspot.com/2011_09_01_archive.html)

[http://jp.axtstar.com/?page_id=258](http://jp.axtstar.com/?page_id=258)

[http://codetuner.blogspot.com/2011/09/convert-mstest-code-covarage-results-in.html](http://codetuner.blogspot.com/2011/09/convert-mstest-code-covarage-results-in.html)

我在这里发布 xsl 以“以防万一”这些 URL 将来会死掉。将下面的 xsl 放入一个名为“VSCoverageToHtml.xsl”的文件中（如上所述）。

```
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    <xsl:output method="html" indent="yes"/> 
    <xsl:template match="/" >
        <html>
            <head>

                <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"/>          

                <style type="text/css">
                    th {
                    background-color:#dcdcdc;
                    border:solid 1px #a9a9a9;
                    text-indent:2pt;
                    font-weight:bolder;
                    }
                    #data {
                    text-align: center;
                    }
                </style>

                <script language="JavaScript" type="text/javascript"  >

                    function CreateJavescript(){
                    var fileref=document.createElement('script');
                    fileref.setAttribute("type","text/javascript");
                    fileref.setAttribute("src", "script1.js");
                    document.getElementsByTagName("head")[0].appendChild(fileref);
                    }

                    function toggleDetail(control) {
                    var ctrlId = $(control).attr('Id');
                    $("tr[id='"+ctrlId +"']").toggle();
                    }                 

                </script>

                <title>Code Coverage Report</title>
            </head>
            <body onload='CreateJavescript()' >
                <h1>Code Coverage Report</h1>
                <table border="1">
                    <tr>
                        <th colspan="3"/>
                        <th>Name</th>
                        <th>Blocks Covered</th>
                        <th>Blocks Not Covered</th>
                        <th>Coverage</th>
                    </tr>
                    <xsl:apply-templates select="//CoverageDSPriv/Module" />
                </table>
            </body>
        </html>
    </xsl:template>

    <xsl:template match="Module">
        <xsl:variable name="parentId" select="generate-id(./..)" />
        <xsl:variable name="currentId" select="generate-id(.)" />
        <tr id="{$parentId}">
            <td id="{$currentId}"      colspan="3"               onClick="toggleDetail(this)"        onMouseOver="this.style.cursor= 'pointer' ">[+]</td>
            <td>
                <xsl:value-of select="ModuleName" />
            </td>
            <td id="data">
                <xsl:value-of select="BlocksCovered" />
            </td>
            <td id="data">
                <xsl:value-of select="BlocksNotCovered" />
            </td>
            <xsl:call-template name="CoverageColumn">
                <xsl:with-param name="covered" select="BlocksCovered" />
                <xsl:with-param name="uncovered" select="BlocksNotCovered" />
            </xsl:call-template>
        </tr>
        <xsl:apply-templates select="NamespaceTable" />
        <tr id="{$currentId}-end" style="display: none;">
            <td colspan="5"/>
        </tr>
    </xsl:template>

    <xsl:template match="NamespaceTable">
        <xsl:variable name="parentId" select="generate-id(./..)" />
        <xsl:variable name="currentId" select="generate-id(.)" />
        <tr id="{$parentId}" style="display: none;">
            <td> - </td>
            <td id="{$currentId}"
                colspan="2"
                onClick="toggleDetail(this)"
                onMouseOver="this.style.cursor= 'pointer' ">[+]</td>
            <td>
                <xsl:value-of select="NamespaceName" />
            </td>
            <td id="data">
                <xsl:value-of select="BlocksCovered" />
            </td>
            <td id="data">
                <xsl:value-of select="BlocksNotCovered" />
            </td>
            <xsl:call-template name="CoverageColumn">
                <xsl:with-param name="covered" select="BlocksCovered" />
                <xsl:with-param name="uncovered" select="BlocksNotCovered" />
            </xsl:call-template>
        </tr>
        <xsl:apply-templates select="Class" />
        <tr id="{$currentId}-end" style="display: none;">
            <td colspan="5"/>
        </tr>
    </xsl:template>

    <xsl:template match="Class">
        <xsl:variable name="parentId" select="generate-id(./..)" />
        <xsl:variable name="currentId" select="generate-id(.)" />
        <tr id="{$parentId}" style="display: none;">
            <td> - </td>
            <td> - </td>
            <td id="{$currentId}"
                onClick="toggleDetail(this)"
                onMouseOver="this.style.cursor='pointer' ">[+]</td>
            <td>
                <xsl:value-of select="ClassName" />
            </td>
            <td id="data">
                <xsl:value-of select="BlocksCovered" />
            </td>
            <td id="data">
                <xsl:value-of select="BlocksNotCovered" />
            </td>
            <xsl:call-template name="CoverageColumn">
                <xsl:with-param name="covered" select="BlocksCovered" />
                <xsl:with-param name="uncovered" select="BlocksNotCovered" />
            </xsl:call-template>
        </tr>
        <xsl:apply-templates select="Method" />
        <tr id="{$currentId}-end" style="display: none;">
            <td colspan="5"/>
        </tr>
    </xsl:template>

    <xsl:template match="Method">
        <xsl:variable name="parentId" select="generate-id(./..)" />
        <tr id="{$parentId}" style="display: none;">
            <td> -</td>
            <td> - </td>
            <td> - </td>
            <td>
                <xsl:value-of select="MethodName" />
            </td>
            <td id="data">
                <xsl:value-of select="BlocksCovered" />
            </td>
            <td id="data">
                <xsl:value-of select="BlocksNotCovered" />
            </td>
            <xsl:call-template name="CoverageColumn">
                <xsl:with-param name="covered" select="BlocksCovered" />
                <xsl:with-param name="uncovered" select="BlocksNotCovered" />
            </xsl:call-template>
        </tr>
    </xsl:template>

    <xsl:template name="CoverageColumn">
        <xsl:param name="covered" select="0" />
        <xsl:param name="uncovered" select="0" />
        <td id="data">
            <xsl:variable name="percent"
                select="($covered div ($covered + $uncovered)) * 100" />
                            <xsl:attribute name="style">
                background-color:
                <xsl:choose>
                    <xsl:when test="number($percent >= 90)">#86ed60;</xsl:when>
                    <xsl:when test="number($percent >= 70)">#ffff99;</xsl:when>
                    <xsl:otherwise>#FF7979;</xsl:otherwise>
                </xsl:choose>
            </xsl:attribute>
            <xsl:if test="$percent > 0">
                <xsl:value-of select="format-number($percent, '###.##' )" />%
            </xsl:if>
            <xsl:if test="$percent = 0">
                <xsl:text>0.00%</xsl:text>
            </xsl:if>
        </td>
    </xsl:template>
</xsl:stylesheet> 
```

这是一个可以提供帮助的小型命令行工具。

[https://www.microsoft.com/en-us/download/details.aspx?id=21714](https://www.microsoft.com/en-us/download/details.aspx?id=21714)

```
using System;

using Microsoft.VisualStudio.Coverage.Analysis;
using System.Collections.Generic;

/* References
\ThirdPartyReferences\Microsoft Visual Studio 11.0\Microsoft.VisualStudio.Coverage.Analysis.dll
\ThirdPartyReferences\Microsoft Visual Studio 11.0\Microsoft.VisualStudio.Coverage.Interop.dll
*/

namespace MyCompany.VisualStudioExtensions.CodeCoverage.CoverageCoverterConsoleApp
{
    class Program
    {
        static int Main(string[] args)
        {
            if (args.Length < 2)
            {
                Console.WriteLine("Coverage Convert - reads VStest binary code coverage data, and outputs it in XML format.");
                Console.WriteLine("Usage:  ConverageConvert <destinationfile> <sourcefile1> <sourcefile2> ... <sourcefileN>");
                return 1;
            }

            string destinationFile = args[0];
            //destinationFile = @"C:\TestResults\MySuperMergedCoverage.coverage.converted.to.xml";

            List<string> sourceFiles = new List<string>();

            //files.Add(@"C:\MyCoverage1.coverage");
            //files.Add(@"C:\MyCoverage2.coverage");
            //files.Add(@"C:\MyCoverage3.coverage");

            /* get all the file names EXCEPT the first one */
            for (int i = 1; i < args.Length; i++)
            {
                sourceFiles.Add(args[i]);
            }

            CoverageInfo mergedCoverage;
            try
            {
                mergedCoverage = JoinCoverageFiles(sourceFiles);
            }
            catch (Exception e)
            {
                Console.WriteLine("Error opening coverage data: {0}", e.Message);
                return 1;
            }

            CoverageDS data = mergedCoverage.BuildDataSet();

            try
            {
                data.WriteXml(destinationFile);
            }
            catch (Exception e)
            {

                Console.WriteLine("Error writing to output file: {0}", e.Message);
                return 1;
            }

            return 0;
        }

        private static CoverageInfo JoinCoverageFiles(IEnumerable<string> files)
        {
            if (files == null)
                throw new ArgumentNullException("files");

            // This will represent the joined coverage files
            CoverageInfo returnItem = null;
            string path;

            try
            {
                foreach (string sourceFile in files)
                {
                    // Create from the current file

                    path = System.IO.Path.GetDirectoryName(sourceFile);
                    CoverageInfo current = CoverageInfo.CreateFromFile(sourceFile, new string[] { path }, new string[] { path });

                    if (returnItem == null)
                    {
                        // First time through, assign to result
                        returnItem = current;
                        continue;
                    }

                    // Not the first time through, join the result with the current
                    CoverageInfo joined = null;
                    try
                    {
                        joined = CoverageInfo.Join(returnItem, current);
                    }
                    finally
                    {
                        // Dispose current and result
                        current.Dispose();
                        current = null;
                        returnItem.Dispose();
                        returnItem = null;
                    }

                    returnItem = joined;
                }
            }
            catch (Exception)
            {
                if (returnItem != null)
                {
                    returnItem.Dispose();
                }
                throw;
            }

            return returnItem;
        }
    }
} 
```

另见：

[使用 VS 2012 动态代码覆盖中的代码合并代码覆盖文件](https://stackoverflow.com/questions/22138857/code-coverage-files-merging-using-code-in-vs-2012-dynamic-code-coverage/36990203#36990203)

# mysql - 如何将这两个查询合二为一？（针对同一个表的多个连接）

> ID：415571
> 
> 赞同：2
> 
> 时间：2009-01-06T05:37:31.960
> 
> 标签：mysql

给定两张表，一张用于工人，一张用于工人完成的任务，

```
CREATE TABLE IF NOT EXISTS `workers` (
  `id` int(11) NOT NULL,
  PRIMARY KEY  (`id`)
);

INSERT INTO `workers` (`id`) VALUES
(1);

CREATE TABLE IF NOT EXISTS `tasks` (
  `id` int(11) NOT NULL,
  `worker_id` int(11) NOT NULL,
  `status` int(11) NOT NULL,
  PRIMARY KEY  (`id`)
);

INSERT INTO `tasks` (`id`, `worker_id`, `status`) VALUES
(1, 1, 1),
(2, 1, 1),
(3, 1, 2),
(4, 1, 2),
(5, 1, 2); 
```

我正在尝试获取每个工作人员对每个状态代码的任务数。

我可以说

```
SELECT w.*
,COUNT(t1.worker_id) as status_1_count
FROM workers w
LEFT JOIN tasks t1 ON w.id = t1.worker_id AND t1.status = 1 
WHERE 1 
GROUP BY 
t1.worker_id
ORDER BY w.id 
```

或者

```
SELECT w.*
,COUNT(t2.worker_id) as status_2_count
FROM workers w
LEFT JOIN tasks t2 ON w.id = t2.worker_id AND t2.status = 2
WHERE 1 
GROUP BY 
t2.worker_id
ORDER BY w.id 
```

并获取具有单个给定状态代码的任务数，但是当我尝试在单个查询中获取多个任务状态的计数时，它不起作用！

```
SELECT w.*
,COUNT(t1.worker_id) as status_1_count
,COUNT(t2.worker_id) as status_2_count
FROM workers w
LEFT JOIN tasks t1 ON w.id = t1.worker_id AND t1.status = 1 
LEFT JOIN tasks t2 ON w.id = t2.worker_id AND t2.status = 2
WHERE 1 
GROUP BY t1.worker_id
,t2.worker_id
ORDER BY w.id 
```

当我宁愿它不会时，任务表正在交叉连接！

有没有办法将这两个查询组合成一个查询，以便我们可以在单个查询中检索多个任务状态的计数？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-06T05:45:49.557

```
SELECT w.*,
  SUM(t1.status = 1) AS status_1_count,
  SUM(t1.status = 2) AS status_2_count
FROM workers w
  LEFT JOIN tasks t1 ON w.id = t1.worker_id AND t1.status IN (1, 2) 
GROUP BY w.id
ORDER BY w.id; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-06T05:42:16.753

> 我正在尝试获取每个工作人员对每个状态代码的任务数。

```
SELECT worker_id, status, COUNT(*)
    FROM tasks
    GROUP BY worker_id, status; 
```

就这样。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-06T06:34:54.200

我这里没有 MySQL 的实例，但我在 t-sql 盒子上测试了它并且它有效。

```
select distinct(worker_id), 
       (select count(*) from tasks where status = 1) as Status1, 
       (select count(*) from tasks where status = 2) as Status2 
   from tasks; 
```

# java - Java中的正则表达式命名组

> ID：415580
> 
> 赞同：200
> 
> 时间：2009-01-06T05:45:36.373
> 
> 标签：java, regex

据我了解，该`java.regex`软件包不支持命名组（[http://www.regular-expressions.info/named.html](http://www.regular-expressions.info/named.html)），所以任何人都可以将我指向一个第三方库吗？

我看过[jregex](http://jregex.sourceforge.net/)但它的最后一个版本是在 2002 年，它在 java5 下对我不起作用（诚然我只是简单地尝试过）。

* * *

## 回答 #1

> 赞同：321
> 
> 时间：2009-01-06T06:36:42.027

（**更新**：**2011 年 8 月**）

正如[geofflane](https://stackoverflow.com/users/50260/geofflane)在[他的回答](https://stackoverflow.com/questions/415580/regex-named-groups-in-java/7033467#7033467)中提到的那样，[Java 7 现在支持命名组](http://download.oracle.com/javase/7/docs/api/java/util/regex/Matcher.html#group%28java.lang.String%29)。
[tchrist](https://stackoverflow.com/users/471272/tchrist)在评论中指出支持是有限的。
他**在他的精彩回答“ [Java Regex Helper](https://stackoverflow.com/questions/5767627/java-regex-helper/5771326#5771326) ”中详细说明了局限性**

Java 7 正则表达式命名组支持早在2010 年[**9 月**就出现在 Oracle 的博客](http://blogs.oracle.com/xuemingshen/entry/named_capturing_group_in_jdk7)中。

在 Java 7 的正式版本中，支持命名捕获组的结构是：

> *   `(?<name>capturing text)`定义一个命名组“名称”
> *   `\k<name>`反向引用命名组“名称”
> *   `${name}`在 Matcher 的替换字符串中引用捕获的组
> *   [`Matcher.group(String name)`](http://docs.oracle.com/javase/7/docs/api/java/util/regex/Matcher.html#group%28java.lang.String%29)通过给定的“命名组”返回捕获的输入子序列。

* * *

**Java 7 之前的其他替代方案**是：

*   [Google 命名正则表达式](http://code.google.com/p/named-regexp/)（参见[John Hardy](https://stackoverflow.com/users/134642/john-hardy)的[回答](https://stackoverflow.com/questions/415580/regex-named-groups-in-java/1095737#1095737)）
    [Gábor Lipták](https://stackoverflow.com/users/337621/gabor-liptak)提到（2012 年 11 月）该项目可能不活跃（有[几个突出的错误](http://code.google.com/p/named-regexp/issues/list)），可以考虑使用其[GitHub 分支。](https://github.com/tony19/named-regexp)
*   [jregex](http://jregex.sourceforge.net/)（见[Brian Clozel](https://stackoverflow.com/users/22982/brian-clozel)的[回答](https://stackoverflow.com/questions/415580/regex-named-groups-in-java/3782345#3782345)）

* * *

（**原始答案**：**2009 年 1 月**，接下来的两个链接现已断开）

您不能引用命名组，除非您编写自己的正则表达式版本...

这正是[Gorbush2 在这个线程中所做的](http://x86.sun.com/thread.jspa?threadID=785370&messageID=4463652)。

[**正则表达式2**](http://gorbush.narod.ru/files/regex2.zip)

[（有限的实现，正如tchrist](https://stackoverflow.com/users/471272/tchrist)再次指出的那样，因为它只查找 ASCII 标识符。tchrist 将限制详细说明为：

> 只能有一个同名的命名组（您并不总是可以控制它！）并且不能将它们用于正则表达式内递归。

注意：您可以在 Perl 和 PCRE 正则表达式中找到真正的正则表达式递归示例，如[Regexp Power](http://www.perl.com/pub/2003/06/06/regexps.html)、[PCRE 规范](http://www.pcre.org/pcre.txt)和[匹配带平衡括号的字符串](http://perl.plover.com/yak/regex/samples/slide083.html)幻灯片中所述）

例子：

细绳：

```
"TEST 123" 
```

正则表达式：

```
"(?<login>\\w+) (?<id>\\d+)" 
```

使用权

```
matcher.group(1) ==> TEST
matcher.group("login") ==> TEST
matcher.name(1) ==> login 
```

代替

```
matcher.replaceAll("aaaaa_$1_sssss_$2____") ==> aaaaa_TEST_sssss_123____
matcher.replaceAll("aaaaa_${login}_sssss_${id}____") ==> aaaaa_TEST_sssss_123____ 
```

* * *

（从实现中提取）

```
public final class Pattern
    implements java.io.Serializable
{
[...]
    /**
     * Parses a group and returns the head node of a set of nodes that process
     * the group. Sometimes a double return system is used where the tail is
     * returned in root.
     */
    private Node group0() {
        boolean capturingGroup = false;
        Node head = null;
        Node tail = null;
        int save = flags;
        root = null;
        int ch = next();
        if (ch == '?') {
            ch = skip();
            switch (ch) {

            case '<':   // (?<xxx)  look behind or group name
                ch = read();
                int start = cursor;
[...]
                // test forGroupName
                int startChar = ch;
                while(ASCII.isWord(ch) && ch != '>') ch=read();
                if(ch == '>'){
                    // valid group name
                    int len = cursor-start;
                    int[] newtemp = new int[2*(len) + 2];
                    //System.arraycopy(temp, start, newtemp, 0, len);
                    StringBuilder name = new StringBuilder();
                    for(int i = start; i< cursor; i++){
                        name.append((char)temp[i-1]);
                    }
                    // create Named group
                    head = createGroup(false);
                    ((GroupTail)root).name = name.toString();

                    capturingGroup = true;
                    tail = root;
                    head.next = expr(tail);
                    break;
                } 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2011-08-11T22:03:39.490

对于迟到的人：Java 7 添加了命名组。[Matcher.group(String groupName) 文档。](http://download.oracle.com/javase/7/docs/api/java/util/regex/Matcher.html#group%28java.lang.String%29)

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2009-07-08T01:41:19.307

是的，但它乱砍太阳类。有一个更简单的方法：

[http://code.google.com/p/named-regexp/](http://code.google.com/p/named-regexp/)

> named-regexp 是标准 JDK 正则表达式实现的瘦包装器，其唯一目的是处理 .net 样式中的命名捕获组：(?...)。
> 
> 它可以与 Java 5 和 6 一起使用（使用泛型）。
> 
> Java 7 将处理命名的捕获组，所以这个项目不会持续下去。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-09-23T20:33:49.987

[jregex](http://jregex.sourceforge.net/)遇到了什么样的问题？它在 java5 和 java6 下对我来说效果很好。

Jregex 做得很好（即使最后一个版本是 2002 年的），除非[您想等待 javaSE 7](http://download.oracle.com/javase/7/docs/api/java/util/regex/Pattern.html#groupname)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-05-27T10:42:04.040

[对于那些运行 pre-java7 的用户， joni](https://github.com/jruby/joni)（[Oniguruma](http://www.geocities.jp/kosako3/oniguruma/) regexp 库的 Java 端口）支持命名组。文档很少，但对我们来说效果很好。
二进制文件可通过 Maven ( [http://repository.codehaus.org/org/jruby/joni/joni/](http://repository.codehaus.org/org/jruby/joni/joni/) ) 获得。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-06-09T11:25:36.560

一个有点老的问题，但我发现自己也需要这个，并且上面的建议是不合适的 - 因此 - 我自己开发了一个薄包装：[https ://github.com/hofmeister/MatchIt](https://github.com/hofmeister/MatchIt)

# asp.net - 如何使用 WatiN 单击 Ajax 工具包 TabContainer 标头？

> ID：415583
> 
> 赞同：1
> 
> 时间：2009-01-06T05:45:54.593
> 
> 标签：asp.net, testing, watin, tabcontainer

我的页面上有一个带有几个选项卡的 ajax 工具包 TabContainer 控件。在我的测试中，我想在选项卡之间切换。

我试过了`_ie.Span("tabHeaderID").Click()`，，，`.MouseDown()`。`.FireEvent("onclick")`我也在父 span 元素上尝试过这些相同的方法。

我还尝试过评估一些 javascript 来设置活动索引，如下所示：

```
_ie.Eval("$get(\"ctl00_AdminContentPlaceHolder_TabContainer1\").set_activeTabIndex(1);"); 
```

有没有人成功使用WatiN切换标签？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-06T17:13:00.697

我还没有想出如何模拟对选项卡标题的点击。但是，我确实有办法进入第二个选项卡 - 只是我原始帖子中 eval 语句的一个小变化：

_ie.Eval("$find(\"ctl00_AdminContentPlaceHolder_TabContainer1\").set_activeTabIndex(1);");

它使用 $find 而不是 $get 来获取选项卡容器对象。

# jquery - 在 jQuery 中设置 textarea 的值

> ID：415602
> 
> 赞同：573
> 
> 时间：2009-01-06T06:03:59.597
> 
> 标签：jquery, textarea

我正在尝试使用带有以下代码的 jquery 在 textarea 字段中设置一个值：

```
$("textarea#ExampleMessage").attr("value", result.exampleMessage); 
```

问题是，一旦这段代码执行，它不会改变 textarea 中的文本吗？

但是，当执行一个`alert($("textarea#ExampleMessage").attr("value"))`新设置的值时返回？

* * *

## 回答 #1

> 赞同：941
> 
> 时间：2009-01-06T06:10:17.243

你试过val吗？

```
$("textarea#ExampleMessage").val(result.exampleMessage); 
```

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2009-01-06T12:13:01.210

Textarea 没有 value 属性，它的值在标签之间，即: `<textarea>my text</textarea>`，它不像输入字段 ( `<input value="my text" />`)。这就是为什么 attr 不起作用:)

* * *

## 回答 #3

> 赞同：57
> 
> 时间：2010-05-07T11:52:33.910

`$("textarea#ExampleMessage").val()`在 jquery 中只是一个魔术。

您应该注意到**textarea**标记使用**内部 html**来显示，而不是像输入标记一样**在 value 属性中显示。**

```
<textarea>blah blah</textarea>
<input type="text" value="blah blah"/> 
```

你应该使用

```
$("textarea#ExampleMessage").html(result.exampleMessage) 
```

或者

```
$("textarea#ExampleMessage").text(result.exampleMessage) 
```

取决于您是否要将其显示为 html 标签或纯文本。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2009-11-17T13:24:20.490

哦，男孩们来吧！它只适用于

```
$('#your_textarea_id').val('some_value'); 
```

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2009-01-06T06:19:29.723

我认为这应该有效：

```
$("textarea#ExampleMessage").val(result.exampleMessage); 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2015-06-20T18:15:48.283

在android上`.val`并`.html`没有工作。

```
$('#id').text("some value") 
```

做了这项工作。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2011-04-06T07:53:19.063

我有同样的问题，所以我决定在当前的浏览器中尝试它（我们在这个问题之后的一年半之后），并且这个（`.val`）有效

```
$("textarea#ExampleMessage").val(result.exampleMessage); 
```

为了

*   IE8
*   法郎 3.6
*   FF4
*   歌剧 11
*   铬 10

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2010-01-12T17:54:11.520

我有同样的问题，这个解决方案没有用，但有效的是使用 html

```
$('#your_textarea_id').html('some_value'); 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2010-11-21T23:38:31.973

问题是：我需要从给定 div 的包含中生成 html 代码。然后，我必须把这个原始的 html 代码放在一个 textarea 中。当我使用这样的功能时`$(textarea).val()`：

```
$(textarea).val("some html like < input type='text' value='' style="background: url('http://www.w.com/bg.gif') repeat-x center;" /> bla bla"); 
```

或者

```
$('#idTxtArGenHtml').val( $('idDivMain').html() ); 
```

`( & ' " )`当它们在引号之间时，我遇到了一些特殊字符的问题。但是当我使用该功能时： `$(textarea).html()`文本没问题。

有一个示例表格：

```
<FORM id="idFormContact" name="nFormContact" action="send.php" method="post"  >
    <FIELDSET id="idFieldContact" class="CMainFieldset">
        <LEGEND>Test your newsletter&raquo; </LEGEND> 
        <p>Send to &agrave; : <input id='idInpMailList' type='text' value='youremail@gmail.com' /></p>
        <FIELDSET  class="CChildFieldset">
            <LEGEND>Subject</LEGEND>
            <LABEL for="idNomClient" class="CInfoLabel">Enter the subject: *&nbsp</LABEL><BR/>
          <INPUT value="" name="nSubject" type="text" id="idSubject" class="CFormInput" alt="Enter the Subject" ><BR/>
    </FIELDSET>
    <FIELDSET  class="CChildFieldset">
        <INPUT id="idBtnGen" type="button" value="Generate" onclick="onGenHtml();"/>&nbsp;&nbsp;
          <INPUT id="idBtnSend" type="button" value="Send" onclick="onSend();"/><BR/><BR/>
            <LEGEND>Message</LEGEND>
                <LABEL for="idTxtArGenHtml" class="CInfoLabel">Html code : *&nbsp</LABEL><BR/>
                <span><TEXTAREA  name="nTxtArGenHtml" id="idTxtArGenHtml" width='100%' cols="69" rows="300" alt="enter your message" ></TEXTAREA></span>
        </FIELDSET>
    </FIELDSET>
</FORM> 
```

无法填充文本区域的 javascript/jquery 代码是：

```
function onGenHtml(){
  $('#idTxtArGenHtml').html( $("#idDivMain").html()  );
} 
```

最终解决方案：

```
function onGenHtml(){
  $('#idTxtArGenHtml').html( $("#idDivMain").html() );
  $('#idTxtArGenHtml').parent().replaceWith( '<span>'+$('#idTxtArGenHtml').parent().html()+'</span>');
} 
```

诀窍是用 span 标签包装你的 textarea 以帮助使用 replaceWith 函数。我不确定它是否很干净，但是在文本区域中添加原始 html 代码也很完美。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2011-05-19T05:29:52.673

textarea 不将值存储为

```
<textarea value="someString"> 
```

相反，它以这种格式存储值：

```
<textarea>someString</textarea> 
```

所以`attr("value","someString")`给你这个结果：

```
<textarea value="someString">someOLDString</textarea>. 
```

尝试`$("#textareaid").val()`或`$("#textareaid").innerHTML`代替。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2013-12-04T07:59:25.073

文本区域没有价值。jQuery .html() 在这种情况下有效

```
$("textarea#ExampleMessage").html(result.exampleMessage); 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2017-07-14T11:57:31.920

我认为缺少一个重要方面：

```
$('#some-text-area').val('test'); 
```

仅在有 ID 选择器 (#) 时有效

对于类选择器，可以选择使用本机值，例如：

```
$('.some-text-area')[0].value = 'test'; 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-05-26T04:41:33.920

它对我有用....我已经建立了一个脸书墙...

这是我的代码的基础：

```
// SETS MY TEXT AREA TO EMPTY (NO VALUE)
$('textarea#message_wall').val(''); 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2015-06-02T20:19:54.493

要设置编码 HTML 的 textarea 值（显示为 HTML），您应该使用`.html( the_var )`但如前所述，如果您尝试再次设置它，它可能（并且可能）不起作用。

您可以通过清空 textarea`.empty()`然后再次设置它来解决此问题`.html( the_var )`

这是一个有效的 JSFiddle： [https ://jsfiddle.net/w7b1thgw/2/](https://jsfiddle.net/w7b1thgw/2/)

```
jQuery(function($){

    $('.load_html').click(function(){
        var my_var = $(this).data('my_html');
        $('#dynamic_html').html( my_var ); 
    });

    $('#clear_html').click(function(){
        $('#dynamic_html').empty(); 
    });

});
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<textarea id="dynamic_html"></textarea>
<a id="google_html" class="load_html" href="#" data-my_html="&lt;a href=&quot;google.com&quot;&gt;google.com&lt;/a&gt;">Google HTML</a>
<a id="yahoo_html" class="load_html" href="#" data-my_html="&lt;a href=&quot;yahoo.com&quot;&gt;yahoo.com&lt;/a&gt;">Yahoo HTML</a>
<a id="clear_html" href="#">Clear HTML</a>
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2010-04-08T13:41:20.277

我尝试`.val()` `.text()` `.html()`使用 jQuery 读取或设置文本区域的值并遇到了一些错误...我最终使用本机 js

```
$('#message').blur(function() {    
    if (this.value == '') { this.value = msg_greeting; }
}); 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2012-01-04T07:14:04.627

您甚至可以使用以下代码段。

```
$("textarea#ExampleMessage").append(result.exampleMessage); 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2012-03-28T15:29:34.873

我们可以使用 .val() 或 .text() 方法来设置值。我们需要像 val("hello") 一样将值放入 val() 中。

```
 $(document).ready(function () {
    $("#submitbtn").click(function () {
      var inputVal = $("#inputText").val();
      $("#txtMessage").val(inputVal);
    });
  }); 
```

在此处查看示例：http: [//www.codegateway.com/2012/03/set-value-to-textarea-jquery.html](http://www.codegateway.com/2012/03/set-value-to-textarea-jquery.html)

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2016-10-09T08:47:55.617

只需按其类型使用 textarea Id，如下所示：

```
$("textarea#samplID").val() 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2019-11-28T05:15:35.587

我已经使用`$(textarea).val/html/text(any_str_var)`了所有为我工作的东西。如果您想确保将您的变量作为字符串添加到 textarea，您始终可以像这样连接：

```
$(textarea).val(unknown_var + '') 
```

.val() 方法肯定用于 textarea - 请参阅：[https ://api.jquery.com/val/](https://api.jquery.com/val/)

.html() 可用于获取或设置任何元素的内容 - 请参阅：[https ://api.jquery.com/html/#html2](https://api.jquery.com/html/#html2)

.text() 与 .html 相同，但可用于设置 XML 内容：请参阅 - [https://api.jquery.com/text/#text-text](https://api.jquery.com/text/#text-text)

您还可以阅读有关每个链接如何处理特殊字符的更多信息。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2020-12-04T11:32:23.153

在我的情况下，我在 iframe 中有这个输入，以上任何一个都解决了我的问题，但是这个：

我只是这样解决它：

```
$('#myId')[0].value="MY VALUE"; 
```

我的输入字段：

```
<textarea name="cmyInput" rows="2" cols="20" id="myId" class="nd" ignoreautotab="1"></textarea> 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2012-03-19T04:54:06.257

接受的答案对我有用，但只有在我意识到我必须在页面加载完成后执行我的代码之后。在这种情况下，内联脚本不起作用，我猜是因为 #my_form 尚未完成加载。

```
$(document).ready(function() {
  $("#my_form textarea").val('');
}); 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2012-04-12T21:09:50.847

当我在页面中有 JQuery v1.4.4 时，这些都不起作用。将 JQuery v1.7.1 注入我的页面时，它终于起作用了。所以就我而言，是我的 JQuery 版本导致了这个问题。

id ==> textareaid

=======================

```
var script1 = document.createElement("script");
script1.src = "http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js";
document.body.appendChild(script1);

var script2 = document.createElement("script"); 
script2.type = "text/javascript"; 
script2.innerHTML = "var $jq171 = $.noConflict();"; 
document.body.appendChild(script2);

$jq171('#textareaid').val('xxx'); 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2010-04-27T16:42:53.303

使用`$("textarea#ExampleMessage").html('whatever you want to put here');`可能是一个好方法，因为`.val()`当您使用数据库中的数据时可能会出现问题。

例如：

名为 as 的数据库字段`description`具有以下值`asjkdfklasdjf sjklñadf`。在这种情况下，使用 .val() 为 textarea 赋值可能是一项乏味的工作。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2011-02-15T11:57:04.400

只需使用此代码，您将始终拥有价值：

`var t = $(this); var v = t.val() || t.html() || t.text();`

所以它会检查 val() 并设置它的值。如果 val() 得到一个空字符串，NULL，NaN os，它将检查 html()，然后检查 text()...

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2011-11-22T18:08:36.360

这有效：

```
var t = $('#taCommentSalesAdministration');
t.val('Hi'); 
```

请记住，这里的棘手部分是确保您使用正确的 ID。在使用 ID 之前，请确保将`#`其放在前面。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2020-05-07T12:21:57.550

我尝试使用 JQuery 设置值/文本/html，但没有成功。所以我尝试了以下方法。

在这种情况下，我将新的 textarea 元素注入到创建后的 DOM 中。

```
 var valueToDisplay= 'Your text here even with line breaks';
 var textBox = '<textarea class="form-control" >'+ valueToDisplay +'</textarea>';
 $(td).html(textBox); 
```

[![在此处输入图像描述](https://i.stack.imgur.com/Dg8UH.png)](https://i.stack.imgur.com/Dg8UH.png)

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2020-10-13T08:45:05.927

添加到上面的一些很好的答案中，在您使用多表单并且元素 NAME 是您想要定位的情况下。

```
$('textarea[name=ExampleMessageElName]').val('Some Message here'); 
```

# javascript - Javascript: var map = {}; 变量列表 = [];

> ID：415605
> 
> 赞同：4
> 
> 时间：2009-01-06T06:08:48.840
> 
> 标签：javascript, arrays, object

有人能告诉我上面两行 javascript 到底是做什么的吗？更重要的是，它叫什么，所以我可以搜索一些 javascript 参考来了解它？我假设他们都在创建某种形式的数组，可以将对象添加到......？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-06T06:16:18.840

花括号是用于创建 Javascript 对象的语法（实际上是键/值对的美化集合）；括号构成一个可调整大小的数组。

这些被称为字面量，它们是一种方便的快捷方式，可帮助您无需大量输入即可创建对象和数组（很好，因为您一直都在使用它们）。许多其他编程语言对映射和数组有类似的文字语法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-06T06:11:08.240

它在 中创建一个空字典`map`和一个空数组`list`。

[在http://www.geocities.com/schools_ring/ArrayAndHash.html](http://www.geocities.com/schools_ring/ArrayAndHash.html)阅读这些结构。

# c# - 将控制台输出重定向到单独程序中的文本框

> ID：415620
> 
> 赞同：49
> 
> 时间：2009-01-06T06:20:23.340
> 
> 标签：c#, .net, winforms, textbox, console

我正在开发一个 Windows 窗体应用程序，它需要我调用一个单独的程序来执行任务。该程序是一个控制台应用程序，我需要将标准输出从控制台重定向到我程序中的 TextBox。

我从我的应用程序执行程序没有问题，但我不知道如何将输出重定向到我的应用程序。我需要在程序使用事件运行时捕获输出。

控制台程序不会停止运行，直到我的应用程序停止并且文本以随机间隔不断变化。我正在尝试做的只是挂钩来自控制台的输出以触发事件处理程序，然后该处理程序可用于更新 TextBox。

我正在使用 C# 编写程序并使用 .NET 框架进行开发。原始应用程序不是 .NET 程序。

编辑：这是我正在尝试做的示例代码。在我的最终应用程序中，我将使用更新 TextBox 的代码替换 Console.WriteLine。我试图在我的事件处理程序中设置一个断点，但它甚至没有到达。

```
 void Method()
    {
        var p = new Process();
        var path = @"C:\ConsoleApp.exe";

        p.StartInfo.FileName = path;
        p.StartInfo.UseShellExecute = false;
        p.OutputDataReceived += p_OutputDataReceived;

        p.Start();
    }

    static void p_OutputDataReceived(object sender, DataReceivedEventArgs e)
    {
        Console.WriteLine(">>> {0}", e.Data);
    } 
```

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2009-01-06T06:46:59.870

这对我有用：

```
void RunWithRedirect(string cmdPath)
{
    var proc = new Process();
    proc.StartInfo.FileName = cmdPath;

    // set up output redirection
    proc.StartInfo.RedirectStandardOutput = true;
    proc.StartInfo.RedirectStandardError = true;    
    proc.EnableRaisingEvents = true;
    proc.StartInfo.CreateNoWindow = true;
    // see below for output handler
    proc.ErrorDataReceived += proc_DataReceived;
    proc.OutputDataReceived += proc_DataReceived;

    proc.Start();

    proc.BeginErrorReadLine();
    proc.BeginOutputReadLine();

    proc.WaitForExit();
}

void proc_DataReceived(object sender, DataReceivedEventArgs e)
{
    // output will be in string e.Data
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-06T12:11:19.683

您可以使用以下代码

```
 MemoryStream mem = new MemoryStream(1000);
        StreamWriter writer = new StreamWriter(mem);
        Console.SetOut(writer);

        Assembly assembly = Assembly.LoadFrom(@"C:\ConsoleApp.exe");
        assembly.EntryPoint.Invoke(null, null);
        writer.Close();

        string s = Encoding.Default.GetString(mem.ToArray());
        mem.Close(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-11-26T18:01:48.810

我在[O2 平台](http://o2platform.com)（开源项目）中添加了许多辅助方法，允许您通过控制台输出和输入轻松编写与另一个进程的交互脚本（请参阅[http://code.google.com/p/o2platform/源/浏览/主干/O2_Scripts/APIs/Windows/CmdExe/CmdExeAPI.cs](http://code.google.com/p/o2platform/source/browse/trunk/O2_Scripts/APIs/Windows/CmdExe/CmdExeAPI.cs)）

对您也有用的 API 可能允许查看当前进程的控制台输出（在现有控件或弹出窗口中）。有关更多详细信息，请参阅此博客文章：http: [//o2platform.wordpress.com/2011/11/26/api_consoleout-cs-inprocess-capture-of-the-console-output/](http://o2platform.wordpress.com/2011/11/26/api_consoleout-cs-inprocess-capture-of-the-console-output/)（此博客还包含有关如何使用的详细信息新进程的控制台输出）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-02-17T14:41:06.380

感谢 Marc Maxham 的回答，为我节省了时间！

正如 Jon of All Trades 所注意到的，`UseShellExecute`必须设置为 false 才能重定向 IO 流，否则`Start()`调用会抛出`InvalidOperationException`.

这是我对`txtOut`WPF 只读文本框的代码的修改

```
void RunWithRedirect(string cmdargs)
{
    var proc = new Process()
    {
        StartInfo = new ProcessStartInfo("cmd.exe", "/k " + cmdargs)
        {
            RedirectStandardOutput = true,
            RedirectStandardError = true,
            CreateNoWindow = true
        },
        EnableRaisingEvents = true
    };

    // see below for output handler
    proc.ErrorDataReceived += proc_DataReceived;
    proc.OutputDataReceived += proc_DataReceived;
    proc.Start();

    proc.BeginErrorReadLine();
    proc.BeginOutputReadLine();

    proc.WaitForExit();
}

void proc_DataReceived(object sender, DataReceivedEventArgs e)
{
    if (e.Data != null)
        Dispatcher.BeginInvoke(new Action( () => txtOut.Text += (Environment.NewLine + e.Data) ));
} 
```

# jquery - 在 jQuery 中查找元素的最有效方法

> ID：415629
> 
> 赞同：11
> 
> 时间：2009-01-06T06:33:04.233
> 
> 标签：jquery, optimization

如果我有一个*仅*适用于表单元素的 CSS 类，例如：

```
<form class="myForm"> 
```

这两个 jQuery 选择器中哪一个最有效，为什么？

```
a) $('form.myForm')

b) $('.myForm') 
```

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-01-06T06:43:02.810

> **编辑**：下面的结果是 jQuery 1.2.6，可能在 Firefox 3.5 中。浏览器和 jQuery 本身的速度改进几乎使这些信息过时了。

* * *

我刚刚写了一个快速的基准测试：

*   在包含 4 个表单和大约 100 个其他元素的页面上：
    *   使用`$('form.myForm')`10000 次耗时 1.367s
    *   使用`$('.myForm')`10000 次耗时 4.202s ( **307%** )
*   在只有 4 个表单且没有其他元素的页面上：
    *   使用`$('form.myForm')`10000 次耗时 1.352s
    *   使用`$('.myForm')`10000 次耗时 1.443s ( **106%** )

似乎搜索特定名称的元素比搜索特定类的所有元素要快得多。

**编辑：**这是我的测试程序：http: [//jsbin.com/ogece](http://jsbin.com/ogece)

程序以 100 个`<p>`标签和 4`<form>`秒开始，运行两个不同的测试，删除`<p>`标签并再次运行测试。奇怪的是，当使用这种技术时，**form.myForm 更慢**。看看你自己的代码，并按照你的意愿去做。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2011-05-06T11:13:30.540

正如 redsquare 已经提到的，选择算法在以后的 jQuery 版本中发生了变化（部分原因是对 getElementsByClassName 的支持）。此外，我使用迄今为止最新的 jQuery 版本（v1.6）对此进行了测试，还添加了一个用于比较的 document.getElementsByClassName 测试（至少在 Firefox 4 和 Chrome 中有效）。

Firefox 4 中的结果是：

```
// With 100 non-form elements:
$('.myForm') : 366ms
$('form.myForm') : 766ms
document.getElementsByClassName('myForm') : 11ms

// Without any other elements:
$('.myForm') : 365ms
$('form.myForm') : 583ms
document.getElementsByClassName('myForm') : 11ms 
```

接受的答案已经过时（并且仍然可以通过搜索“在 jquery 中查找元素的有效方法”之类的东西找到）并且可能会误导人们，所以我觉得我必须写这个。

另外，看看 jQuery 和原生浏览器选择器函数之间的时间差异。在 jQuery 1.2.6`$('.myForm')`中，比jQuery 慢**300**多倍`getElementsByClassName`，而在 jQuery 1.6 中，*它只*慢了大约**20**倍，但仍然比`$('form.myForm')`（与过时的答案相反）快。

**注意：**结果是使用 Firefox 4 获得的（与 Chrome 的结果相似）。在 Opera 10 中，使用标签名称查询仅稍微快一点，但 Opera 还支持更快的原生`getElementsByClassName`.

**测试代码：http:** [//jsbin.com/ijeku5](http://jsbin.com/ijeku5)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-06T06:44:26.893

第一个选择器应该更快，因为 jQuery 可以使用内置函数“getElementsByTagName”来减少需要过滤的元素数量。第二个必须获取 DOM 中的所有元素并检查它们的类。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-06T07:00:42.867

尝试[使用 slickspeed](http://mootools.net/slickspeed/)，您可以在包括 jquery 在内的多个 js 库中查看选择器的粗略速度。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-06T06:45:01.760

form.myForm IMO 要快得多，因为它只需要查看一个子集/过滤的元素集，并且不需要迭代整个文档。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-06T07:47:22.103

当与上下文一起使用时，第一个示例运行得更快。第二个例子也跑得更快，但不是很多。我扩展了您的示例以与上下文进行比较：

[http://jsbin.com/uluwe](http://jsbin.com/uluwe)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-06T08:15:25.277

enobrev, 有趣。[我刚刚运行了您的示例，但在这里](http://jsbin.com/eruwa)使用了 jquery 1.3 beta 2

结果......（括号内为1.2.6速度）

```
// With 100 non-form elements and Context:
$('.myForm', '#someContainer') : 4063ms (3707ms)
$('form.myForm', '#someContainer') : 6045ms (4644ms)

// With 100 non-form elements: 
$('.myForm') : 3954ms (25086ms)
$('form.myForm') : 8802ms (4057ms)

// Without any other elements with Context: 
$('.myForm', '#someContainer') : 4137ms (3594ms)
$('form.myForm', '#someContainer') : 6627ms (4341ms)

// Without any other elements: 
$('.myForm') : 4278ms (7303ms) 
$('form.myForm') : 8353ms (4033ms) 
```

* * *

## 回答 #8

> 赞同：-6
> 
> 时间：2009-01-06T12:37:04.560

来吧伙计们？你疯了吗？选择元素最快的方法是*最短*的方法：

$('.myForm') 比 $('form.myform') 快得多，因为第二个变体必须进行额外检查以确保元素具有指定的 tagName。可能新的 jquery 1.3 会改变这个东西，但是在最新的稳定版本上，指定 tagName 也是错误的。你应该[在这里阅读](http://dev.iamntz.com/78/which-selector-is-faster)。

我想我在某处读到 MooTools 以这种方式更快。嗯.. 也许在 Moo 中，不知道，但在 jQuery 中这是最快的方式。

看看这个分析器： ![替代文字](https://farm2.static.flickr.com/1112/3173092303_98d90615f2.jpg)

（[大图](http://farm2.static.flickr.com/1112/3173092303_319d20dcb8_o.png)）

第一个仅使用 ID，第二个使用 form#ID（在我的博客页面上测试）并且对于类选择器的工作方式完全相同。

# asp.net - 单元测试来测试使用 NUnit 执行一些数据库事务的 Web 服务的 Web 方法

> ID：415631
> 
> 赞同：0
> 
> 时间：2009-01-06T06:34:05.043
> 
> 标签：asp.net, unit-testing, nunit

如何编写单元测试来测试使用 NUnit 的 Web 服务的 Web 方法？

此应用程序中的 Web 方法将添加、更新和删除数据库中的记录。单元测试会测试一个web方法是否有一条记录插入到数据库中，webmethod调用数据访问层的一个方法来执行这个动作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-06T06:38:22.943

我认为用单元测试来测试 Web 服务的最终结果是不合适的。此外，您正在尝试做的事情称为“集成测试”，而不是单元测试。

但是，您可以做的是：

*   编写单元测试以检查您的数据访问层 (DAL) 是否正常工作
*   编写单元测试以查看您的 Web 方法是否正确访问您的 DAL

您可能还想看看我之前提出的一个问题：[如何对持久性进行单元测试？](https://stackoverflow.com/questions/2046/how-do-i-unit-test-persistence)为您提供更多见解。

但是，如果您确实坚持能够做到这一点，则可以使用具有该属性的[MbUnit创建此类单元测试。](http://mbunit.com)`Rollback`

```
[Rollback]
public void Test_database_persistence()
{
    //any database access you perform here will be put inside a transaction 
    //and rolled back afterwards
} 
```

MbUnit 与 NUnit 完全兼容，因此您仍然可以使用您已经用 NUnit 编写的测试。

# wcf - WCF Web 服务膨胀

> ID：415633
> 
> 赞同：3
> 
> 时间：2009-01-06T06:35:58.363
> 
> 标签：wcf

我正在开发一个已经变得相当臃肿的 WCF Web 服务。您使用什么技术来拆分合同的实施？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-06T07:01:28.903

那么你有几个选择：

首先，您可以将所有内容放在一个类中，但使用 C# 的部分类功能将其拆分为不同的文件。

其次，您可以让主服务类将请求传递给逻辑组织的许多其他实际类之一。

第三种选择是考虑重构以减少您拥有的操作数量。您公开的所有方法实际上都有用吗？

最后，您始终可以将服务拆分为多个 WCF 服务。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-07T18:49:20.113

如果您不提供更多信息，很难回答您的问题。你的意思是你的服务接口臃肿，还是类实现？很难回答好，如果我没有看到代码，或者没有其他信息，无论如何，我会尝试：

请注意，WCF 服务基本上只是一个实现接口并在其方法上具有一些属性的常规类。所以所有其他好的 OO 设计规则都适用于它。想想它做了什么，它是否真的有单一的责任，如果没有尝试将一些责任外包给您的服务所依赖的其他类。如果您需要非默认构造函数，请使用 IInstanceProvider 创建服务类，并为其提供依赖项（或者如果您使用 Windsor Container，请使用 WCF Facility）。

如果你真的想要，你可以伸展你的继承链，并将一些代码移动到一个基类中。但是，我不这样做，并且总是更喜欢使用组合而不是继承。

检查您的服务合同，并考虑它的真正凝聚力。也许你应该做的是将它拆分成几个更小、更有凝聚力的服务。

# java - 只读微调器

> ID：415649
> 
> 赞同：3
> 
> 时间：2009-01-06T06:43:12.217
> 
> 标签：java, jsp, jsf, spinner, tld

我正在学习 Jsf。有什么方法可以让微调器只读吗？我应该只使用微调器而不是直接输入数字来更改值。我可以通过在 spinners.tld 文件中设置属性来实现吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-06T06:59:52.213

禁用微调器控件的文本字段部分是一种可用性灾难。请不要这样做。我们中的一些人真的*很想*输入数字。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T11:36:18.723

使用 JSF2.0，您可以编写[自己的微调器 JSF 组件](http://weblogs.java.net/blog/driscoll/archive/2008/11/jsf_20_writing_1.html)，但无需使用：

```
 <h:inputText id="number" value="#{compositeComponent.attrs.value}"/> 
```

（这是一个[读写输入框](http://www.roseindia.net/jsf/inputText.shtml)），您可以**使用[`outputLabel`](http://www.roseindia.net/jsf/outputLabel.shtml)**：

```
<h:outputLabel for="number" value="#{compositeComponent.attrs.value}"/> 
```

，从而实现*你*所追求的。

请注意，**an[`outputText`](http://www.horstmann.com/corejsf/jsf-tags.html#Table4_13)可能同样有效**。

[JSF2.0](http://weblogs.java.net/blog/driscoll/archive/2009/01/jsf_20_pr_relea.html)以 PR（Public Review）模式发布。
这是值得研究的，因为 JSF 的“痛点”之一一直是您在创建组件时面临的复杂性。在 JSF 2.0 中，创建一个由现有组件组成的新组件是轻而易举的事。

# .net - Expression.Dynamic 和 Operators.Assign？

> ID：415654
> 
> 赞同：0
> 
> 时间：2009-01-06T06:46:39.307
> 
> 标签：.net, dynamic-language-runtime

我正在尝试使用 Expression.Dynamic() 来构建赋值操作...我想使用它来选择性地为我的语言中的某些自定义类型实例提供值类型语义。我不能用“静态”（？）表达式来做到这一点，因为我不知道实际类型是什么（我需要 MetaObject 实例及其 LimitType ...因此是 Expression.Dynamic() ）。

这对我不起作用...如果用于从我的 OperationBinder 子类构建 MetaObject，Expression.Assign() 什么也不做。

头。怦怦直跳。上。桌子。为了。小时。

只是想知道这是否是受支持的行为，或者我是否在吠叫错误的树？

谢谢...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-07T03:53:38.657

I think you basically have 2 options. In either one though you should be using a custom binder instead of a subclass of OperationBinder. This is because you're not performing a cross-language operation. Instead you're implementing a part of your language semantics but just want the good DLR stuff. You should sub class MetaObjectBinder to make this happen (MetaAction in older builds).

So your two choices then are to either have an Ast.Dynamic that returns the new value that you assign into a local or you pass the value as a ref argument. These should look like:

```
Ast.Assign(localVal, Ast.Dynamic(new AssignBinder(...), localVal, newVal);

or

delegate void AssignDelegate<TLocal, TValue>(CallSite site, TLocal loc, TValue val);
Type dlgType = typeof(AssignDelegate).MakeGenericType(new Type[] { localVal.Type, newVal.Type });
Ast.Dynamic(dlgType, new AssignBinder(...), localVal, newVal); 
```

In your binder you'll override the Bind method which will give you the incoming MetaObject's. For the 1st one you'll just return the new value and the second one you'll just assign to the 1st MetaObject.

I haven't tried this but that's basically how it should work.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-07T12:04:24.053

如果要创建赋值表达式，只需创建一个调用通用赋值例程的表达式。下面的类提供了一个很好的扩展方法，它将任何字段访问表达式转换为字段赋值表达式：

```
using System;
using System.Linq.Expressions;
using System.Reflection;

namespace Ethica.Expressions
{
    public static class ExpressionExtenstions
    {
        private class AssignmentHelper<T>
        {
            private static void SetValue(ref T target, T value)
            {
                target = value;
            }

            internal static MethodInfo MethodInfoSetValue =
                typeof(AssignmentHelper<T>).GetMethod("SetValue", BindingFlags.NonPublic | BindingFlags.Static);
        }

        public static Expression<Action<TInstance, TProp>> ToFieldAssignExpression<TInstance, TProp>
            (
                this Expression<Func<TInstance, TProp>> fieldGetter
            )
        {
            if (fieldGetter == null)
                throw new ArgumentNullException("fieldGetter");

            if(fieldGetter.Parameters.Count != 1 || !(fieldGetter.Body is MemberExpression))
                throw new ArgumentException ("Input expression must be a single parameter field getter, e.g. g => g._fieldToSet  or function(g) g._fieldToSet");

            ParameterExpression[] parms = new ParameterExpression[] {
                                        fieldGetter.Parameters[0], 
                                        Expression.Parameter(typeof(TProp), "value")};

            Expression body = Expression.Call(AssignmentHelper<TProp>.MethodInfoSetValue,
                                              new Expression[] { fieldGetter.Body, parms[1] });

            return Expression.Lambda<Action<TInstance, TProp>>(body, parms);
        }

        public static Action<TInstance, TProp> ToFieldAssignment<TInstance, TProp>
            (
                this Expression<Func<TInstance, TProp>> fieldGetter
            )
        {
            return fieldGetter.ToFieldAssignExpression().Compile();
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-06T07:54:55.160

你能澄清一下确切的情况吗？我非常熟悉`Expression`，并且非常熟悉将它与 DLR 树 / 4.0 一起使用，但我不能 100% 确定您要做什么。另请注意，这种类型的使用无论如何都有一些[限制](http://blogs.msdn.com/samng/archive/2008/12/15/dynamic-in-c-vi-what-dynamic-does-not-do.aspx)（无论是 C# 还是原始树）。

# file - 使用 Visual Studio 2005 读取和写入 Word 文件

> ID：415659
> 
> 赞同：0
> 
> 时间：2009-01-06T06:49:29.520
> 
> 标签：file, ms-word, doc

如何在 VB.net 或 C# .net 中读写 MS word 文件

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-06T07:20:48.570

为此，您必须使用 Office 自动化。

阅读[本文](http://msdn.microsoft.com/en-us/library/76d2d007(VS.80).aspx)作为起点。按照该页面上的链接了解更多信息。

您可能还想购买（任何）这些书籍：

[http://www.amazon.com/Microsoft-NET-Development-Office-Progmng/dp/0735621322/ref=sr_1_1?ie=UTF8&s=books&qid=1231226233&sr=8-1](https://rads.stackoverflow.com/amzn/click/com/0735621322)

[http://www.amazon.com/Visual-Studio-Tools-Office-Development/dp/0321334884/ref=pd_sim_b_1](https://rads.stackoverflow.com/amzn/click/com/0321334884)

[http://www.amazon.com/Programming-Applications-Microsoft-Office-Outlook/dp/0735622493/ref=pd_sim_b_5](https://rads.stackoverflow.com/amzn/click/com/0735622493)

# lisp - 我可以在没有 Emacs 的情况下轻松使用 Lisp 吗？

> ID：415671
> 
> 赞同：13
> 
> 时间：2009-01-06T06:57:08.600
> 
> 标签：lisp, common-lisp

我目前正在阅读 Practical Common Lisp。这本书很棒，语言也很有趣，但我不喜欢学习 Emacs。我已经学习了 Vim，这对于一个大脑来说已经足够了。我不想学别的。双重控制命令让我头疼。在 Windows 上编程 Lisp 的最佳非 Emacs 解决方案是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-06T18:39:26.360

最好的免费和非 emacs Common Lisp IDE 是[CUSP](http://www.bitfauna.com/projects/cusp/)（基于 Eclipse 平台的 Lisp IDE）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-06T07:17:33.350

试试[LispWorks](http://www.lispworks.com/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-06T13:19:00.047

也许试试[viper-mode](http://www.emacswiki.org/emacs/ViperMode)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-06T20:07:43.077

为 Vim 跛行。

[http://www.vim.org/scripts/script.php?script_id=2219](http://www.vim.org/scripts/script.php?script_id=2219)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-04T13:17:59.720

试试 Vim 的 Slime：http: [//technotales.wordpress.com/2007/10/03/like-slime-for-vim/](http://technotales.wordpress.com/2007/10/03/like-slime-for-vim/)。效果很好！

您也可以使用 Allegro CL 环境。

# bash - 如何替换文本文件中的 ${} 占位符？

> ID：415677
> 
> 赞同：200
> 
> 时间：2009-01-06T07:00:16.113
> 
> 标签：bash, command-line, text-processing, templating

我想将“模板”文件的输出通过管道传输到 MySQL，该文件具有`${dbName}`散布的变量。替换这些实例并将输出转储到标准输出的命令行实用程序是什么？

* * *

## 回答 #1

> 赞同：232
> 
> 时间：2009-01-06T08:01:21.887

[赛德](https://en.wikipedia.org/wiki/Sed)！

给定模板.txt：

```
数字是 ${i}
这个词是 ${word}

```

我们只需要说：

```
sed -e "s/\${i}/1/" -e "s/\${word}/dog/" template.txt 
```

感谢 Jonathan Leffler 提供的将多个`-e`参数传递给同一个`sed`调用的技巧。

* * *

## 回答 #2

> 赞同：231
> 
> 时间：2013-06-10T19:03:05.807

## 更新

这是来自[yottatsa](https://stackoverflow.com/a/11050943/1322463)的一个类似问题的解决方案，它只替换 $VAR 或 ${VAR} 等变量，并且是一个简短的单行

```
i=32 word=foo envsubst < template.txt 
```

当然如果*i*和*word*在你的环境中，那么它只是

```
envsubst < template.txt 
```

在我的 Mac 上，它看起来像是作为*gettext*的一部分从*MacGPG2安装的*

## 旧答案

这是[mogsie](https://stackoverflow.com/a/12422379/1322463)在类似问题上对解决方案的改进，我的解决方案不需要您升级双引号，mogsie 的，但他是单引号！

```
eval "cat <<EOF
$(<template.txt)
EOF
" 2> /dev/null 
```

这两种解决方案的强大之处在于，您只会得到几种通常不会发生的 shell 扩展 $((...))、`...` 和 $(...)，尽管反斜杠*是*此处转义字符，但您不必担心解析有错误，并且它可以很好地执行多行。

* * *

## 回答 #3

> 赞同：49
> 
> 时间：2009-01-06T07:10:06.593

使用`/bin/sh`. 创建一个设置变量的小型 shell 脚本，然后使用 shell 本身解析模板。像这样（编辑以正确处理换行符）：

### 文件模板.txt：

```
the number is ${i}
the word is ${word} 
```

### 文件脚本.sh：

```
#!/bin/sh

#Set variables
i=1
word="dog"

#Read in template one line at the time, and replace variables (more
#natural (and efficient) way, thanks to Jonathan Leffler).
while read line
do
    eval echo "$line"
done < "./template.txt" 
```

### 输出：

```
#sh script.sh
the number is 1
the word is dog 
```

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2011-05-19T15:19:00.497

考虑到最近的兴趣，我再次考虑这个问题，我认为我最初想到的工具是[`m4`](http://www.gnu.org/software/m4/manual/index.html)autotools 的宏处理器。因此，您可以使用以下变量，而不是我最初指定的变量：

```
$echo 'I am a DBNAME' | m4 -DDBNAME="database name" 
```

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2017-02-22T09:01:44.700

创建`rendertemplate.sh`：

```
#!/usr/bin/env bash

eval "echo \"$(cat $1)\"" 
```

并且`template.tmpl`：

```
Hello, ${WORLD}
Goodbye, ${CHEESE} 
```

渲染模板：

```
$ export WORLD=Foo
$ CHEESE=Bar ./rendertemplate.sh template.tmpl 
Hello, Foo
Goodbye, Bar 
```

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2009-08-20T21:31:19.467

模板.txt

```
Variable 1 value: ${var1}
Variable 2 value: ${var2} 
```

数据.sh

```
#!/usr/bin/env bash
declare var1="value 1"
declare var2="value 2" 
```

解析器.sh

```
#!/usr/bin/env bash

# args
declare file_data=$1
declare file_input=$2
declare file_output=$3

source $file_data
eval "echo \"$(< $file_input)\"" > $file_output 
```

> ./parser.sh data.sh template.txt parsed_file.txt

parsed_file.txt

```
Variable 1 value: value 1
Variable 2 value: value 2 
```

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2016-10-21T03:31:10.960

这是一个**强大的 Bash 函数**——尽管使用了`eval`——应该可以安全使用。

输入文本中的所有`${varName}`变量引用都基于调用 shell 的变量进行扩展。

*没有其他内容*被扩展：名称*未*包含在`{...}`（例如`$varName`）中的变量引用，命令替换（`$(...)`和遗留语法``...``），算术替换（`$((...))`和遗留语法`$[...]`）都没有。

要将 a`$`视为文字，`\`请 - 转义它；例如：`\${HOME}`

请注意，仅通过*stdin*接受输入。

**例子：**

```
$ expandVarsStrict <<<'$HOME is "${HOME}"; `date` and \$(ls)' # only ${HOME} is expanded
$HOME is "/Users/jdoe"; `date` and $(ls) 
```

**函数源代码：**

```
expandVarsStrict(){
  local line lineEscaped
  while IFS= read -r line || [[ -n $line ]]; do  # the `||` clause ensures that the last line is read even if it doesn't end with \n
    # Escape ALL chars. that could trigger an expansion..
    IFS= read -r -d '' lineEscaped < <(printf %s "$line" | tr '`([$' '\1\2\3\4')
    # ... then selectively reenable ${ references
    lineEscaped=${lineEscaped//$'\4'{/\${}
    # Finally, escape embedded double quotes to preserve them.
    lineEscaped=${lineEscaped//\"/\\\"}
    eval "printf '%s\n' \"$lineEscaped\"" | tr '\1\2\3\4' '`([$'
  done
} 
```

^(该函数假定输入中不存在`0x1`、`0x2`、`0x3`和`0x4`控制字符，因为这些字符。在内部使用 - 因为函数处理*text*，这应该是一个安全的假设。)

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2013-06-06T15:32:34.190

这是我基于以前答案的 perl 解决方案，替换了环境变量：

```
perl -p -e 's/\$\{(\w+)\}/(exists $ENV{$1}?$ENV{$1}:"missing variable $1")/eg' < infile > outfile 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2016-02-23T20:44:52.233

我建议使用类似**Sigil**的东西： [https ://github.com/gliderlabs/sigil](https://github.com/gliderlabs/sigil)

它被编译为单个二进制文件，因此在系统上安装非常容易。

然后你可以做一个简单的单行，如下所示：

```
cat my-file.conf.template | sigil -p $(env) > my-file.conf 
```

这比`eval`使用正则表达式或`sed`

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2019-03-30T03:03:41.163

这是一种让 shell 为您进行替换的方法，就好像文件的内容是在双引号之间键入的一样。

使用带有内容的 template.txt 示例：

```
The number is ${i}
The word is ${word} 
```

以下行将导致 shell 插入 template.txt 的内容并将结果写入标准输出。

```
i='1' word='dog' sh -c 'echo "'"$(cat template.txt)"'"' 
```

解释：

*   `i`并`word`作为环境变量传递给`sh`.
*   `sh`执行它传递的字符串的内容。
*   彼此相邻写入的字符串变成一个字符串，该字符串是：
    *   ' `echo "`' + " `$(cat template.txt)`" + ' `"`'
*   由于替换是在 之间`"`，“ `$(cat template.txt)`”成为 的输出`cat template.txt`。
*   所以执行的命令`sh -c`就变成了：
    *   `echo "The number is ${i}\nThe word is ${word}"`,
    *   其中`i`和`word`是指定的环境变量。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2009-01-06T07:08:45.003

如果您愿意使用[Perl](http://en.wikipedia.org/wiki/Perl)，那将是我的建议。尽管可能有一些[sed](http://en.wikipedia.org/wiki/Sed)和/或[AWK](http://en.wikipedia.org/wiki/AWK)专家可能知道如何更容易地做到这一点。如果您有一个更复杂的映射，而不仅仅是 dbName 用于替换，您可以很容易地扩展它，但此时您最好将它放入标准 Perl 脚本中。

```
perl -p -e 's/\$\{dbName\}/testdb/s' yourfile | mysql 
```

一个简短的 Perl 脚本来做一些稍微复杂的事情（处理多个键）：

```
#!/usr/bin/env perl
my %replace = ( 'dbName' => 'testdb', 'somethingElse' => 'fooBar' );
undef $/;
my $buf = <STDIN>;
$buf =~ s/\$\{$_\}/$replace{$_}/g for keys %replace;
print $buf; 
```

如果您将上述脚本命名为 replace-script，则可以按如下方式使用它：

```
replace-script < yourfile | mysql 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2011-10-03T10:08:31.220

文件.tpl：

```
The following bash function should only replace ${var1} syntax and ignore 
other shell special chars such as `backticks` or $var2 or "double quotes". 
If I have missed anything - let me know. 
```

脚本.sh：

```
template(){
    # usage: template file.tpl
    while read -r line ; do
            line=${line//\"/\\\"}
            line=${line//\`/\\\`}
            line=${line//\$/\\\$}
            line=${line//\\\${/\${}
            eval "echo \"$line\""; 
    done < ${1}
}

var1="*replaced*"
var2="*not replaced*"

template file.tpl > result.txt 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2011-05-16T04:09:11.057

我在想同样的事情时发现了这个线程。它启发了我（小心反引号）

```
$ echo $MYTEST
pass!
$ cat FILE
hello $MYTEST world
$ eval echo `cat FILE`
hello pass! world 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2014-07-12T01:55:27.380

这里有很多选择，但我想我会把我的扔在堆上。它基于 perl，仅针对 ${...} 形式的变量，将要处理的文件作为参数并将转换后的文件输出到 stdout：

```
use Env;
Env::import();

while(<>) { $_ =~ s/(\${\w+})/$1/eeg; $text .= $_; }

print "$text"; 
```

当然我不是一个真正的 perl 人，所以很容易出现致命的缺陷（虽然对我有用）。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-01-06T07:49:59.117

如果您可以控制配置文件格式，则可以在 bash 本身中完成。您只需要 source (".") 配置文件而不是 subshel​​l。这确保了在当前 shell 的上下文中创建变量（并继续存在）而不是子 shell（当子 shell 退出时变量消失）。

```
$ cat config.data
    export parm_jdbc=jdbc:db2://box7.co.uk:5000/INSTA
    export parm_user=pax
    export parm_pwd=never_you_mind

$ cat go.bash
    . config.data
    echo "JDBC string is " $parm_jdbc
    echo "Username is    " $parm_user
    echo "Password is    " $parm_pwd

$ bash go.bash
    JDBC string is  jdbc:db2://box7.co.uk:5000/INSTA
    Username is     pax
    Password is     never_you_mind 
```

如果您的配置文件不能是 shell 脚本，您可以在执行之前“编译”它（编译取决于您的输入格式）。

```
$ cat config.data
    parm_jdbc=jdbc:db2://box7.co.uk:5000/INSTA # JDBC URL
    parm_user=pax                              # user name
    parm_pwd=never_you_mind                    # password

$ cat go.bash
    cat config.data
        | sed 's/#.*$//'
        | sed 's/[ \t]*$//'
        | sed 's/^[ \t]*//'
        | grep -v '^$'
        | sed 's/^/export '
        >config.data-compiled
    . config.data-compiled
    echo "JDBC string is " $parm_jdbc
    echo "Username is    " $parm_user
    echo "Password is    " $parm_pwd

$ bash go.bash
    JDBC string is  jdbc:db2://box7.co.uk:5000/INSTA
    Username is     pax
    Password is     never_you_mind 
```

在您的特定情况下，您可以使用以下内容：

```
$ cat config.data
    export p_p1=val1
    export p_p2=val2
$ cat go.bash
    . ./config.data
    echo "select * from dbtable where p1 = '$p_p1' and p2 like '$p_p2%' order by p1"
$ bash go.bash
    select * from dbtable where p1 = 'val1' and p2 like 'val2%' order by p1 
```

然后将 go.bash 的输出通过管道传输到 MySQL 和瞧，希望你不会破坏你的数据库:-)。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2020-02-03T21:12:34.107

使用备份对可能的多个文件进行 perl 编辑。

```
 perl -e 's/\$\{([^}]+)\}/defined $ENV{$1} ? $ENV{$1} : ""/eg' \
    -i.orig \
    -p config/test/* 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2021-01-14T08:25:57.087

我创建了一个名为[`shtpl`](https://github.com/mlorenzo-stratio/shtpl). 我`shtpl`使用类似 jinja 的语法，现在我经常使用 ansible，我非常熟悉：

```
$ cat /tmp/test
{{ aux=4 }}
{{ myarray=( a b c d ) }}
{{ A_RANDOM=$RANDOM }}
$A_RANDOM
{% if $(( $A_RANDOM%2 )) == 0 %}
$A_RANDOM is even
{% else %}
$A_RANDOM is odd
{% endif %}
{% if $(( $A_RANDOM%2 )) == 0 %}
{% for n in 1 2 3 $aux %}
\$myarray[$((n-1))]: ${myarray[$((n-1))]}
/etc/passwd field #$n: $(grep $USER /etc/passwd | cut -d: -f$n)
{% endfor %}
{% else %}
{% for n in {1..4} %}
\$myarray[$((n-1))]: ${myarray[$((n-1))]}
/etc/group field #$n: $(grep ^$USER /etc/group | cut -d: -f$n)
{% endfor %}
{% endif %}

$ ./shtpl < /tmp/test
6535
6535 is odd
$myarray[0]: a
/etc/group field #1: myusername
$myarray[1]: b
/etc/group field #2: x
$myarray[2]: c
/etc/group field #3: 1001
$myarray[3]: d
/etc/group field #4: 
```

更多信息在我的[github](https://github.com/mlorenzo-stratio/shtpl)

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2022-02-19T18:18:04.687

对我来说，这是最简单和最强大的解决方案，您甚至可以使用相同的命令包含其他模板`eval echo "$(<template.txt)`：

**嵌套模板示例**

1.  创建模板文件，变量采用常规 bash 语法`${VARIABLE_NAME}`或`$VARIABLE_NAME`

> 您必须在模板中转义特殊字符，`\`否则它们将被`eval`.

`template.txt`

```
Hello ${name}!
eval echo $(<nested-template.txt) 
```

`nested-template.txt`

```
Nice to have you here ${name} :\) 
```

2.  创建源文件

`template.source`

```
declare name=royman 
```

3.  解析模板

```
source template.source && eval echo "$(<template.txt)" 
```

4.  输出

```
Hello royman!
Nice to have you here royman :) 
```

* * *

# windows-vista - 在 Vista 上并排运行 IE6 和 IE7

> ID：415685
> 
> 赞同：2
> 
> 时间：2009-01-06T07:02:40.290
> 
> 标签：windows-vista, internet-explorer-6, internet-explorer-7

我需要在本机运行 IE7 的 Vista 机器上运行 IE6。有人可以帮我设置/配置步骤吗？

谢谢，

担

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-06T07:09:55.190

看看[IETester——](http://www.my-debugbar.com/wiki/IETester/HomePage)它允许您在 IE 5.5 - 8b2 中测试页面。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-28T05:56:26.967

只需使用[http://www.xenocode.com/browsers/](http://www.xenocode.com/browsers/)

您可以在 Vista 和 Windows 7 中运行旧版本的 IE :)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-06T07:21:45.430

[尝试来自http://browsers.evolt.org/?ie/32bit/standalone](http://browsers.evolt.org/?ie/32bit/standalone)的ie6eolas_nt.zip 。我在 XP 上使用它；没试过Vista。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-06T07:05:01.580

如果您安装了 IE7，使用[多个 IE](http://tredosoft.com/Multiple_IE)将让您安装过去的版本而不会发生任何冲突。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-06T07:46:34.757

多个 IE在 Vista 上[不起作用](http://tredosoft.com/IE6_For_Vista_Part_1)，您只能使用各种虚拟机来获得完整的 IE 支持。如果您需要测试 javascript 或通过 CSS 进行调试，这一点至关重要。

我设法使用[AndLinux + Wine](http://www.samsaffron.com/archive/2008/04/27/Running+IE6+on+Windows+Vista)来完成这项工作，但老实说，我认为 VMWare/Virtual PC/Virtual Box 路线更简单。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-06T10:26:11.363

我使用了多个 IE，但它有 javascript 问题，这不是它们在正常版本中的问题。

[IE 团队建议](http://blogs.msdn.com/ie/archive/2006/11/30/ie6-and-ie7-running-on-a-single-machine.aspx)使用Internet [Explorer Application Compatibility VPC Images](http://www.microsoft.com/DOWNLOADS/details.aspx?FamilyID=21eabb90-958f-4b64-b5f1-73d0a413c8ef&displaylang=en)。这些是具有不同 IE 版本的虚拟 PC 映像。

支持的版本：

*   XP SP3 上的 IE6
*   VISTA 上的 IE7
*   XP SP3 上的 IE7
*   XP SP3 上的 IE8B2

对于其他 IE 版本，您可以制作自己的虚拟映像。

# java - 为什么Java中没有初始化局部变量？

> ID：415687
> 
> 赞同：110
> 
> 时间：2009-01-06T07:03:47.323
> 
> 标签：java, variables, initialization

Java 的设计者有什么理由认为不应该为局部变量赋予默认值？说真的，如果实例变量可以被赋予一个默认值，那么为什么我们不能对局部变量做同样的事情呢？

它还会导致问题，正如[这篇对博客文章的评论中](http://javahowto.blogspot.com/2007/01/variable-might-not-have-been.html?showComment=1206851400000#c1463508649088298714)所解释的那样：

> 好吧，当试图在 finally 块中关闭资源时，这条规则最令人沮丧。如果我在 try 中实例化资源，但尝试在 finally 中关闭它，我会收到此错误。如果我将实例化移到 try 之外，我会收到另一个错误，指出它必须在 try 内。
> 
> 非常令人沮丧。

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-01-06T07:18:08.323

声明局部变量主要是为了进行一些计算。所以设置变量的值是程序员的决定，它不应该采用默认值。

如果程序员错误地没有初始化局部变量并且它采用了默认值，那么输出可能是一些意想不到的值。因此，对于局部变量，编译器会要求程序员在访问变量之前用一些值对其进行初始化，以避免使用未定义的值。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-01-06T08:00:25.430

[您链接到的“问题”](http://javahowto.blogspot.com/2007/01/variable-might-not-have-been.html?showComment=1206851400000#c1463508649088298714)似乎正在描述这种情况：

```
SomeObject so;
try {
  // Do some work here ...
  so = new SomeObject();
  so.DoUsefulThings();
} finally {
  so.CleanUp(); // Compiler error here
} 
```

评论者的抱怨是编译器在该`finally`部分的行中犹豫不决，声称`so`可能未初始化。然后评论提到了另一种编写代码的方式，可能是这样的：

```
// Do some work here ...
SomeObject so = new SomeObject();
try {
  so.DoUsefulThings();
} finally {
  so.CleanUp();
} 
```

评论者对该解决方案不满意，因为编译器然后说代码“必须在尝试范围内”。我想这意味着某些代码可能会引发不再处理的异常。我不确定。我的代码的两个版本都没有处理任何异常，因此第一个版本中与异常相关的任何内容在第二个版本中都应该相同。

无论如何，这第二个版本的代码是*正确*的编写方式。在第一个版本中，编译器的错误信息是正确的。`so`变量可能未初始化。特别是，如果`SomeObject`构造函数失败，`so`将不会被初始化，因此尝试调用`so.CleanUp`. 始终在获得该部分完成的资源*后*`try`进入该部分。*`finally`*

 *初始化后的`try`-`finally`块*仅*用于保护实例，以确保无论发生什么其他情况都将其清理干净。如果还有*其他*需要运行的东西，但它们与实例是否已分配属性无关，那么它们应该进入*另一个*-块，可能是包装了我展示的那个块。`so`*`SomeObject`*`SomeObject` *`try``finally`***

 ***要求在使用前手动分配变量不会导致真正的问题。它只会带来一些小麻烦，但你的代码会更好。您将拥有范围更有限的变量，并且`try`-`finally`不会试图保护太多的块。

如果局部变量具有默认值，那么`so`在第一个示例中将是`null`. 那真的解决不了任何问题。`finally`您不会在块中获得编译时错误，而是`NullPointerException`潜伏在那里，它可能会*隐藏*代码的“在这里做一些工作”部分中可能发生的任何其他异常。（或者`finally`节中的异常会自动链接到前一个异常吗？我不记得了。即便如此，你还是会有一个额外的异常，就像真正的异常一样。）

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-01-06T07:31:26.037

请注意，最终实例/成员变量默认情况下不会被初始化。因为这些是最终的，以后不能在程序中更改。这就是Java没有为它们提供任何默认值并强制程序员对其进行初始化的原因。

另一方面，非最终成员变量可以稍后更改。因此，编译器不会让它们保持未初始化状态；确切地说，因为这些可以在以后更改。关于局部变量，局部变量的范围要窄得多；并且编译器知道它何时被使用。因此，强制程序员初始化变量是有道理的。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-01-06T09:58:43.257

此外，在下面的示例中，可能在 SomeObject 构造中引发了异常，在这种情况下，“so”变量将为 null，并且对 CleanUp 的调用将引发 NullPointerException

```
SomeObject so;
try {
  // Do some work here ...
  so = new SomeObject();
  so.DoUsefulThings();
} finally {
  so.CleanUp(); // Compiler error here
} 
```

我倾向于这样做：

```
SomeObject so = null;
try {
  // Do some work here ...
  so = new SomeObject();
  so.DoUsefulThings();
} finally {
  if (so != null) {
     so.CleanUp(); // safe
  }
} 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2011-05-20T23:11:24.883

您问题的实际答案是因为方法变量是通过简单地向堆栈指针添加一个数字来实例化的。将它们归零将是一个额外的步骤。对于类变量，它们被放入堆上的初始化内存中。

为什么不采取额外的步骤？退后一步——没有人提到这种情况下的“警告”是一件非常好的事情。

您永远不应该在第一次传递时将变量初始化为零或 null（当您第一次编码时）。要么将它分配给实际值，要么根本不分配它，因为如果你不这样做，那么 Java 可以告诉你什么时候你真的搞砸了。以[电僧的回答](https://stackoverflow.com/questions/415687/why-are-local-variables-not-initialized-in-java/415978#415978)为例。在第一种情况下，它实际上非常有用，它告诉您如果 try() 由于 SomeObject 的构造函数抛出异常而失败，那么您最终会在 finally 中得到[NPE 。](https://en.wikipedia.org/wiki/Null_pointer#Dereferencing)如果构造函数不能抛出异常，就不应该在 try 中。

这个警告是一个很棒的多路径错误程序员检查器，它使我免于做愚蠢的事情，因为它检查每条路径并确保如果您在某个路径中使用该变量，那么您必须在通向它的每个路径中初始化它. 我现在从不显式初始化变量，直到我确定这是正确的做法。

最重要的是，明确地说“int size=0”而不是“int size”并让下一个程序员弄清楚你打算将它设为零不是更好吗？

另一方面，我想不出一个正当的理由让编译器将所有未初始化的变量初始化为 0。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-06T07:12:15.653

我认为主要目的是保持与 C/C++ 的相似性。但是，编译器会检测并警告您使用未初始化的变量，这会将问题减少到最小程度。从性能的角度来看，让您声明未初始化的变量要快一些，因为编译器不必编写赋值语句，即使您在下一条语句中覆盖了变量的值。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-01-06T09:48:10.440

不初始化变量更有效，并且在局部变量的情况下这样做是安全的，因为编译器可以跟踪初始化。

在需要初始化变量的情况下，您总是可以自己做，所以这不是问题。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2010-03-25T08:24:13.447

对我来说，*原因*归结为：局部变量的用途与实例变量的用途不同。局部变量将用作计算的一部分；实例变量用于包含状态。如果你使用一个局部变量而不给它赋值，那几乎肯定是一个逻辑错误。

也就是说，我完全可以落后于要求始终显式初始化实例变量；该错误将发生在结果允许未初始化的实例变量的任何构造函数上（例如，未在声明时初始化且未在构造函数中初始化）。但这不是 Gosling 等人的决定。al.，拍摄于 90 年代初，所以我们来了。（我并不是说他们打错了电话。）

不过，我*无法*落后于默认的局部变量。是的，我们不应该依赖编译器来仔细检查我们的逻辑，而且不需要，但是当编译器发现一个时它仍然很方便。:-)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2018-09-12T02:49:20.270

局部变量背后的想法是它们只存在于需要它们的有限范围内。因此，对于该值，或者至少该值的来源，应该没有什么不确定性的理由。我可以想象由于局部变量具有默认值而引起的许多错误。

例如，考虑以下简单代码...（**注意，出于演示目的，我们假设为局部变量分配了默认值，如指定的那样，如果未显式初始化**）

```
System.out.println("Enter grade");
int grade = new Scanner(System.in).nextInt(); // I won't bother with exception handling here, to cut down on lines.
char letterGrade; // Let us assume the default value for a char is '\0'
if (grade >= 90)
    letterGrade = 'A';
else if (grade >= 80)
    letterGrade = 'B';
else if (grade >= 70)
    letterGrade = 'C';
else if (grade >= 60)
    letterGrade = 'D';
else
    letterGrade = 'F';
System.out.println("Your grade is " + letterGrade); 
```

一切都说完了，***假设编译器将默认值 '\0' 分配给 letterGrade***，那么编写的这段代码将正常工作。但是，如果我们忘记了 else 语句怎么办？

我们的代码的测试运行可能会导致以下结果

```
Enter grade
43
Your grade is 
```

这个结果虽然在意料之中，但肯定不是编码者的意图。实际上，可能在绝大多数情况下（或至少在相当多的情况下），默认值不会是*所需*值，因此在绝大多数情况下，默认值会导致错误。强制编码人员在使用局部变量之前为其分配初始值更有意义，因为忘记`= 1`in导致的调试痛苦`for(int i = 1; i < 10; i++)`远远超过了不必包含`= 0`in的便利`for(int i; i < 10; i++)`。

确实，try-catch-finally 块可能会有点混乱（但它实际上并不是引用似乎暗示的 catch-22），例如，当一个对象在其构造函数中抛出一个检查异常时，但对于一个出于或其他原因，*必须*在 finally 块的末尾对此对象执行某些操作。一个完美的例子是在处理资源时，它必须被关闭。

过去处理这个问题的一种方法可能是这样......

```
Scanner s = null; // Declared and initialized to null outside the block. This gives us the needed scope, and an initial value.
try {
    s = new Scanner(new FileInputStream(new File("filename.txt")));
    int someInt = s.nextInt();
} catch (InputMismatchException e) {
    System.out.println("Some error message");
} catch (IOException e) {
    System.out.println("different error message");
} finally {
    if (s != null) // In case exception during initialization prevents assignment of new non-null value to s.
        s.close();
} 
```

但是，从 Java 7 开始，使用 try-with-resources 不再需要这个 finally 块，就像这样。

```
try (Scanner s = new Scanner(new FileInputStream(new File("filename.txt")))) {
    ...
    ...
} catch(IOException e) {
    System.out.println("different error message");
} 
```

也就是说，（顾名思义）这只适用于资源。

虽然前一个例子有点恶心，但这可能更多地说明了 try-catch-finally 或这些类的实现方式，而不是局部变量及其实现方式。

确实将字段初始化为默认值，但这有点不同。例如，当您说 时，`int[] arr = new int[10];`一旦您初始化了这个数组，该对象就存在于内存中的给定位置。让我们暂时假设没有默认值，而是初始值是此时恰好在该内存位置中的任何 1 和 0 序列。在许多情况下，这可能会导致不确定的行为。

假设我们有...

```
int[] arr = new int[10];
if(arr[0] == 0)
    System.out.println("Same.");
else
    System.out.println("Not same."); 
```

完全有`Same.`可能在一次运行`Not same.`中显示并在另一次运行中显示。一旦你开始谈论引用变量，这个问题可能会变得更加严重。

```
String[] s = new String[5]; 
```

根据定义，s的每个元素都应该指向一个String（或者为null）。但是，如果初始值是在这个内存位置发生的任何一系列 0 和 1，不仅不能保证每次都会得到相同的结果，而且也不能保证对象 s[0] 指向to （假设它指向任何有意义的东西）甚至**是**一个字符串（也许它是一只兔子，**:p**）！面对几乎所有使 Java 成为 Java 的东西，这种对类型的缺乏关注会飞起来。因此，虽然局部变量的默认值充其量只能被视为可选，但实例变量的默认值更接近于**必要性**。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-04-13T11:52:03.370

**如果我没记错的话，另一个原因可能是**：

为成员变量提供默认值是类加载的一部分

类加载在 Java 中是运行时的事情，这意味着当您创建一个对象时，该类将通过类加载进行加载。只有成员变量被初始化为默认值。

JVM不会花时间给你的局部变量一个默认值，因为有些方法永远不会被调用，因为一个方法调用可以是有条件的，那么为什么要花时间给它们一个默认值，如果这些默认值永远不会降低性能会被使用吗？此外，给它们一个默认值意味着我们需要首先创建它们，这也意味着在类加载时，如果不使用它们，为什么要浪费内存来创建它们。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-28T16:50:53.543

局部变量存储在堆栈中，但实例变量存储在堆中，因此有可能会读取堆栈上的先前值而不是堆中的默认值。

出于这个原因，JVM 不允许在未初始化的情况下使用局部变量。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-06T08:10:27.983

Eclipse 甚至会为您提供未初始化变量的警告，因此无论如何它变得非常明显。我个人认为这是默认行为是一件好事，否则您的应用程序可能会使用意外的值，而不是编译器抛出错误，它不会做任何事情（但可能会发出警告）然后你会抓挠你的头脑为什么某些事情不完全按照他们应该的方式行事。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-05-13T17:07:53.037

方法的内存堆栈是在执行时创建的。方法堆栈顺序在执行时决定。

可能有一个根本不会被调用的函数。所以在对象实例化的时候实例化局部变量会完全浪费内存。此外，对象变量在类的完整对象生命周期中保留在内存中，而局部变量及其值在它们从内存堆栈中弹出的那一刻就可以进行垃圾收集。

因此，将内存分配给甚至可能不会被调用或即使被调用的方法的变量，在对象的生命周期内不会保留在内存中，这将是完全不合逻辑且浪费内存的

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-08-30T05:45:58.570

实例变量将具有默认值，但局部变量不能具有默认值。由于局部变量基本上都在方法/行为中，它的主要目的是做一些操作或计算。因此，为局部变量设置默认值并不是一个好主意。否则，检查意外答案的原因是非常困难和耗时的。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2022-01-08T13:02:08.283

反过来问：为什么将字段初始化为默认值？如果 Java 编译器要求您自己初始化字段而不是使用它们的默认值，那将更有效，因为在使用之前无需将内存清零。因此，如果在这方面将*所有*变量都视为局部变量，那将是一种明智的语言设计。

原因不是因为检查字段比检查局部变量更难。Java 编译器已经知道如何检查一个字段是否确实由构造函数初始化，因为它必须检查这个`final`字段。因此，编译器将相同的逻辑应用于其他字段以确保它们在构造函数中被明确分配，这将是一点额外的工作。

原因是，即使对于`final`编译器证明该字段在构造函数中明确赋值的字段，其赋值前的值仍然可以从其他代码中看到：

```
class A {
    final int x;
    A() {
        this.x = calculate();
    }
    int calculate() {
        System.out.println(this.x);
        return 1;
    }
} 
```

在这段代码中，构造函数肯定会赋值给`this.x`，但即便如此，该字段的默认初始值在打印点`0`的方法中也是可见的。如果在调用构造函数之前该字段未清零，则该方法将能够观察未初始化内存的内容，这将是非确定性行为并存在潜在的安全问题。`calculate``this.x``calculate`

`calculate()`另一种方法是在尚未明确分配字段的代码中此时禁止方法调用。但这很不方便；能够像这样从构造函数调用方法很有用。能够做到这一点的便利性比在调用构造函数之前将字段的内存清零的微小性能成本更有价值。

请注意，这种推理不适用于局部变量，因为方法的未初始化局部变量在其他方法中是不可见的；因为他们是本地人。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2013-03-04T10:53:53.903

答案是实例变量可以在类构造函数或任何类方法中初始化。但是对于局部变量，一旦您在方法中定义了任何内容，它就会永远保留在类中。

* * *

## 回答 #17

> 赞同：-2
> 
> 时间：2014-12-30T21:20:30.310

我可以想到以下两个原因

1.  正如大多数答案所说，通过设置初始化局部变量的约束，可以确保为局部变量分配一个程序员想要的值，并确保计算出预期的结果。
2.  实例变量可以通过声明局部变量（同名）来隐藏——为了确保预期的行为，局部变量被强制初始化为一个值（不过我会完全避免这种情况）。

# html - 具有相同作用的两种形式

> ID：415692
> 
> 赞同：2
> 
> 时间：2009-01-06T07:07:59.703
> 
> 标签：html, ruby-on-rails, forms

我的 Rails 应用程序中有两个表单。它们都存在于单独的选项卡中，当我提交一个表单时，我希望也保存另一个表单中的数据。我该怎么做？或者有没有更好的方法来代替使用两个单独的表格？有没有更好的方法将长表单分散到多个选项卡中，当我按下提交时，所有选项卡中的所有数据都应该达到我的操作。谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-06T07:35:36.993

您可以扩展单个表单以涵盖两个表单的所有元素。

这完全没问题，只要表单标签有效地适合 X/HTML。

```
<form action='action1'>
    <!-- All elements from both forms, plus tabs, etc. -->
</form> 
```

唯一需要考虑的是，该区域内是否会有另一种形式需要进行另一项操作。例如，如果您在其他两个选项卡之间添加第三个选项卡，它将具有不同的操作。

你不想像这样结束：

```
<form action='action1'>

    <!-- elements from the combined forms -->

    <form action='action2'>
        <!-- elements for a totally different form, not valid inside another form -->    
    </form>

    <!-- more elements from the combined forms -->

</form> 
```

在这种情况下，最好在提交时使用 JavaScript 合并两个表单。

jQuery (jquery.com) 会让这很容易。例如，您可以序列化这两种形式，然后将它们连接起来并通过 post 或 get 将结果发送到服务器。

请参阅[http://docs.jquery.com/Ajax/serialize](http://docs.jquery.com/Ajax/serialize)。

可能有更好的方法可以做到这一点，但我想不出任何办法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T07:39:33.883

我现在无法测试这个概念是否有效，但我相信你可以使用 jQuery 来实现这一点，它的提交功能将拦截任何选项卡上的所有表单提交，类似于这些行

```
$("form").submit(function(event){  
    event.preventDefault();  
    //serialize forms here and submit using jquery post  
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-15T22:03:58.790

您应该查看 fields_for 方法。你可以这样做：

```
<% form_for @house do |f| %>
  <%= f.text_field :square_feet %>

  <% fields_for @listing do |s| %>
    <%= s.hidden_field :id %>
    <%= s.text_field :asking_price %>
  <% end %>

  <%= f.submit %>
<% end %> 
```

然后在你的控制器中你会做这样的事情：

```
house = House.find(params[:id])
house.update_attributes(params[:house])
listing = Listing.find(params[:listing][:id])
listing.update_attributes(params[:listing]) 
```

那是为了更新，但你可以在那里做任何你想做的事情。

# php - 聪明的VS。Javascript/AJAX

> ID：415699
> 
> 赞同：6
> 
> 时间：2009-01-06T07:10:07.780
> 
> 标签：php, javascript, ajax, smarty

我有一个疑问： - 是否有任何标准/约定我应该何时使用“Smarty 模板”以及何时应该使用 Javascript Ajax 调用来生成内容？我可以使用 Ajax/Javascript 调用来动态生成内容。

我的应用程序同时使用 Ajax 和[Smarty](http://www.smarty.net/)，但我想为开发人员设置规则

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-01-06T08:24:48.377

您应该**只使用 AJAX 调用来加载页面加载时未知的动态数据**。例如，当您单击 Stack Overflow 上给定问题/答案的“评论”链接时，会进行 AJAX 调用以动态加载数据。这是用户点击评论链接的结果，而不是页面加载的结果。您不知道应该在页面加载时显示这些评论，因此在这种情况下进行 AJAX 调用是合适的。

您应该**使用模板来显示页面加载时已知的任何数据**。它使处理禁用 Javascript 的人变得更容易（我知道，不是很多），并且它提供了逻辑与表示的清晰分离。使用模板的另一个重要好处是可以显着减少从客户端浏览器发出的 HTTP 请求的数量。

这在延迟而非带宽是您最大障碍的移动浏览世界中尤为重要。例如，在移动 Safari 中，对**Smarty 模板页面的单个 HTTP 请求的加载速度明显快于加载 Javascript 模板页面的请求，**后者发出五到六个额外的 HTTP 请求。在使用 EDGE、3G 和其他非 wifi 移动数据服务时尤其如此。事实上，这非常重要，以至于它是雅虎**[网站加速最佳实践中](http://developer.yahoo.com/performance/rules.html "加快网站速度的最佳实践")**的第一条指南。

理想情况下，您还应该**在禁用 Javascript 时优雅地降级功能**。一个很好的例子是自动完成的搜索框。建议的搜索词在您键入时神奇地出现真的很酷，但是如果您关闭 Javascript，您仍然有一个功能搜索框。这是服务质量下降的典型例子。Stack Overflow 通常在提供可靠的非 JavaScript 体验方面做得很好。一个不足之处是在评论中。禁用 Javascript 时，仅显示最受欢迎的评论，并且禁止发布新评论。

除非绝对必要，否则**您应该将 Javascript 视为可能无法启用的附加功能，而不是应该用于构建网站关键部分的东西**。显然有例外（有些事情没有 Javascript 就无法完成）。例如，您会注意到 Stack Overflow 在关闭 Javascript 时非常有用。当发布新答案或花哨的实时 Markdown 预览时，您不会获得实时更新，但核心功能仍然存在。所有“繁重的工作”都是通过 HTML 和 CSS 完成的。Javascript 只是锦上添花（诚然是非常好的锦上添花）。这是一种旁注，但它很重要，值得一提。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-06T07:14:22.670

这可能取决于您在模板中所做的工作。就个人而言，我讨厌严格使用 Javascript 做很多繁重的样式/布局。如果您可以通过加载大部分布局。Smarty 并仅更改特定的数据位（仅更改**数据**，而不是标记/样式，如果可能的话），这可能是在您自己的开发人员团队中进行标准化的好起点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-06T07:21:37.770

在原始页面加载后（不使用刷新），对服务器端生成和 DHTML/AJAX 使用模板。即使这样，AJAX 调用本身的服务器响应也可以使用模板进行组装，该模板可能最适合任何重要的内容。

# jquery - 用 JQuery 替换 UpdatePanel

> ID：415711
> 
> 赞同：11
> 
> 时间：2009-01-06T07:16:33.397
> 
> 标签：jquery, ajax, asp.net-ajax, .net-2.0, updatepanel

我正在使用 UpdatePanel 异步调用页面中的按钮单击事件，该事件调用另一个类中的方法，该方法在输出上写出 XML 文件。有没有办法用 JQuery 而不是 UpdatePanel 来做到这一点？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-06T09:43:37.860

使用 jQuery 处理点击事件。[然后使用此技术](http://encosia.com/2008/05/29/using-jquery-to-directly-call-aspnet-ajax-page-methods/)在代码隐藏中调用页面方法。从那里您可以编写 XML 文件或做任何您想做的事情。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-06T10:04:09.970

在没有更新面板的情况下使用 jQuery 执行 ajax 的一种简单替代方法是使用称为“页面方法”的 ASP.NET 内置机制。通过在网站后面的页面中装饰一个静态方法，`[WebMethod]`将有一个生成的 javascript 函数，您可以使用`PageMethods.MethodName(param1, param2)`. 您仍然需要包含一个 ScriptManager 控件并启用如下页面方法：

```
<asp:ScriptManager ID="theScriptManager" runat="server"
    EnablePageMethods="true" /> 
```

有关更多信息，您可以搜索“页面方法 ASP.NET AJAX”。

希望这可以帮助

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-01-06T08:35:42.363

要在 jquery 中调用按钮单击事件，您可以这样做...

```
$("#MyButtonID").click(); 
```

按钮html看起来像这样......

```
<input type="button" id="MyButtonID" value="Press Me" /> 
```

# c# - 检查 NotImplementedExceptions 的 FxCop 规则

> ID：415730
> 
> 赞同：2
> 
> 时间：2009-01-06T07:34:00.430
> 
> 标签：c#, .net, fxcop, ndepend, notimplementedexception

我希望每晚构建检查我的 .NET 代码中有多少 NotImplementedExeptions，所以希望我们可以在发布之前将它们全部删除。我的第一个想法是 FxCop 可能是一个很好的工具来做到这一点。有没有人对此有自定义的 FxCop 规则？我将如何自己创建一个？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-06T15:51:39.957

如果超过 10 个方法创建 NotImplementedException，这样的单元测试将失败。如果失败，它将报告创建此异常的所有方法。

```
var throwingMethods = codebase.Methods
  .Where(m => m
         .GetInstructions()
         .Exists(i => i.Creates<NotImplementedException>()))
  .ToArray();

if (throwingMethods.Length > 10)
  CollectionAssert.IsEmpty(throwingMethods); 
```

代码库是这样创建的：

```
var codebase = new Codebase("Assembly1.dll","Assembly2.dll"); 
```

片段使用[Lokad 共享库](https://github.com/Lokad/lokad-shared-libraries)中的 Lokad.Quality.dll 。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-11-06T22:26:21.867

我实际上已经实现了一个并在[这个答案](https://stackoverflow.com/questions/410719/notimplementedexception-are-they-kidding-me/410800#410800)中显示了代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-06T07:54:31.510

网上有大量关于如何制定自己的 FxCop 规则的资源，但由于“NotImplementedException”是一个如此独特的名称，您可能只需计算其在文件文本中的出现次数。为所有 .cs 文件创建一个 ItemGroup，然后使用适当的 DOS 命令（例如“find /c”）并通过 EXEC 任务获取计数作为输出。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-06T09:04:57.877

有时`NotImplementedExeption` *应该*抛出 a —— 一个例子是，如果你有`IBindingList`.

有[大量](http://www.thescarms.com/dotnet/fxcop1.aspx)[资源](http://weblogs.asp.net/pglavich/archive/2005/07/19/419869.aspx) 可用于[创建](http://blogs.msdn.com/kcwalina/archive/2007/10/02/Multi_2D00_TargetingAndFxCop.aspx)[自定义](http://www.daniweb.com/forums/thread164939.html)[fxCop](http://www.binarycoder.net/fxcop/html/index.html)[规则](http://bordecal.mvps.org/Nicole/FxCop/CustomRuleDetails.htm)。但是，“找到解决方案”可能是一种合适的方法（假设您在自动构建中不需要它）

# java - Java中模块的动态加载

> ID：415733
> 
> 赞同：5
> 
> 时间：2009-01-06T07:37:13.217
> 
> 标签：java, deployment, plugins

在 Java 中，我可以动态地将内容添加到类路径并加载类（“动态”意味着无需重新启动我的应用程序）。是否有一个已知的框架/库可以在不重新启动的情况下处理模块的动态加载/卸载？

通常的设置，尤其是对于 Web 应用程序，是负载均衡器、多个应用程序实例以及逐步部署和重新启动新版本。我正在寻找其他东西 - 具有多个服务/插件的应用程序，可能是单实例桌面应用程序，其中禁用单个服务很便宜，但关闭或重新启动完整的应用程序是不可行的。

我正在考虑典型的插件基础设施，其中插件可以在不重新启动应用程序的情况下升级或安装。我必须从头开始编程，还是已经有东西可用？Spring 兼容和开源是一个优点，但不是必需的。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-06T07:49:56.763

**[您可以考虑在OSGI 框架](http://www.springsource.org/osgi)**中运行您的 spring 应用程序。

我相信[DMServer](http://www.springsource.org/dmserver)是一个基于模块的 Java 应用程序服务器，旨在运行基于[OSGI的企业 Java 应用程序和 Spring 驱动的应用程序](http://www.osgi.org/Main/HomePage)

您可以在这篇[Hello，OSGi，第 2 部分：Spring 动态模块简介](http://www.javaworld.com/javaworld/jw-04-2008/jw-04-osgi2.html)文章中找到更多详细信息，特别是如何使用 Spring DM 在正在运行的系统中动态安装、更新和卸载模块。

* * *

注意：当您谈到“无需重新启动应用程序即可升级或安装插件”时，首先想到的候选框架是[**OSGI 。**](http://en.wikipedia.org/wiki/OSGi)

这完全是关于将应用程序模块化为更小的捆绑包。
**每个包都是一个紧密耦合的、可动态加载的类、jar 和配置文件的集合，这些文件显式地声明了它们的外部依赖项**（如果有的话）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-06T08:00:45.570

也许最简单的方法是使用它自己的类加载器加载每个插件。然后丢弃类加载器并创建一个新的以重新加载插件。您将需要插件 API 中的 init() 和 destroy() 方法来允许启动/关闭类型的功能。

这还具有将插件彼此隔离的优点。

URLClassLoader 是您的起点。一般的想法是您提供一个 XxxPlugin 超类，任何插件子类。考虑 Applet 的示例，它本质上是一个 GUI 插件（或 Midlet 等）。

# c# - 我需要哪种亚马逊服务来简单查询书名、ISBN 和出版商？

> ID：415738
> 
> 赞同：6
> 
> 时间：2009-01-06T07:42:34.250
> 
> 标签：c#, web-services, amazon

现在有这么多的服务，很多关于该主题的搜索结果都在谈论已弃用的服务。我现在只是第一次这样做。我有一个 C# 中的小图书馆应用程序，我想用它来查询亚马逊服务以更新书籍封面图片、ISBN、作者等。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-06T08:07:26.837

您可能需要 Amazon Associates Web Service（以前称为 Amazon E-Commerce Service）的 ItemLookup 操作。更多信息[在这里](http://aws.amazon.com/associates/)和[这里](http://developer.amazonwebservices.com/connect/entry.jspa?externalID=1661&categoryID=19)。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-01-06T07:55:53.910

[LINQ to Amazon](http://weblogs.asp.net/fmarguerie/archive/2006/06/26/introducing-linq-to-amazon.aspx)怎么样；-p

（另请参阅[它](http://linqinaction.net/blogs/main/archive/2006/06/28/Linq_to_Amazon_implementation_fore_steps.aspx)的工作原理和[来源](http://linqinaction.net/files/folders/linqinaction/entry1952.aspx)）

# c# - IE 7 中的图像问题

> ID：415739
> 
> 赞同：0
> 
> 时间：2009-01-06T07:43:03.110
> 
> 标签：c#, asp.net, internet-explorer-7

我正在使用 asp.net 和 C# ( framework 1.1 ) 开发一个站点。规定用户上传他的照片，上传分两步进行 1\. 用户选择一张照片并显示照片以供查看 2\. 进行数据库调用并将其上传到服务器

在 IE6 中，照片以审阅模式显示（来自用户系统），但在 IE7 中，除非将其上传到服务器，否则不会显示。

有什么解决方法吗？？？？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-06T08:19:48.403

这可能是与安全相关的问题。IE6 可能接受显示带有本地磁盘路径的图像，这可能是一个安全漏洞。也可以在 Firefox 中尝试，我猜这也行不通。因此，您只需要在第 1 步中上传照片，然后在第 2 步中进行数据库操作即可；或者不显示照片以供审核...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-06T07:51:02.750

这实际上取决于您在将照片显示给用户以供查看之前如何临时存储照片。您是否将其存储在临时文件中？它是记忆中的一团吗？它应该显示出来，所以我会检查它是否真的在加载，而不仅仅是被一些愚蠢的 CSS 差异所隐藏。使用 IEDevToolbar 查看那里是否真的有图像。如果是，请使用 Fiddler 查看文件是否真的在浏览器中关闭。

不幸的是，有太多变数让我无法尝试这个，抱歉。

# objective-c - Objective C 中的实例缓存

> ID：415753
> 
> 赞同：3
> 
> 时间：2009-01-06T07:52:01.190
> 
> 标签：objective-c, weak-references

我想缓存某个类的实例。该类保留其所有实例的字典，当有人请求新实例时，该类首先尝试满足来自缓存的请求。但是内存管理有一个小问题：字典缓存保留了插入的对象，因此它们永远不会被释放。我确实希望它们被解除分配，因此我不得不重载该`release`方法，并且当保留计数降至 1 时，我可以从缓存中删除实例并让它被解除分配。

这行得通，但我不喜欢乱搞该`release`方法并发现解决方案过于复杂。我想我可以使用一些不保留它存储的对象的散列类。有这样的吗？这个想法是，当某个实例的最后一个用户释放它时，该实例将自动从缓存中消失。

[NSHashTable](http://developer.apple.com/documentation/Cocoa/Reference/NSHashTable_class/Introduction/Introduction.html)似乎是我正在寻找的东西，但文档谈到“在垃圾收集环境中支持弱关系”。没有垃圾收集它也能工作吗？

* * *

*澄清：*除非有人真的需要它们，否则我无法将实例保存在内存中，这就是为什么我想在最后一个“真实”用户释放实例时从缓存中清除实例。

* * *

*更好的解决方案：*这是在 iPhone 上，我想缓存一些纹理，另一方面，我想在最后一个真正的持有者释放它们时立即从内存中释放它们。更简单的编码方法是通过另一个类（我们称之为`TextureManager`）。此类管理纹理实例并缓存它们，以便从缓存中提供对具有相同名称的纹理的后续调用。当最后一个用户释放纹理时，无需立即清除缓存。我们可以简单地将纹理缓存在内存中，当设备内存不足时，我们会收到内存不足警告并可以清除缓存。这是一个更好的解决方案，因为缓存的东西不会污染`Texture`类，我们不必搞砸，`release`缓存命中的机会甚至更高。这`TextureManager`可以抽象成一个`ResourceManager`，这样它就可以缓存其他数据，而不仅仅是纹理。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-06T09:36:27.640

是的，您可以使用 NSHashTable 来构建本质上是非保留字典的内容。或者，您可以使用 NULL 调用 CFDictionaryCreate 来释放和保留回调。然后，由于免费桥接，您可以简单地将结果类型转换为 NSDictionary，并像使用普通 NSDictionary 一样使用它，除了不摆弄保留计数。

如果您这样做，字典不会自动将引用归零，您需要确保在解除分配实例时将其删除。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-01-13T16:49:24.180

你想要的是一个归零弱引用（它不是“缓存管理算法的Graal”，它是一个众所周知的模式）。问题在于，Objective C 仅在垃圾收集运行时为您提供零弱引用，而不是在手动内存管理程序中。并且 iPhone 不提供垃圾收集（还）。

到目前为止，所有答案似乎都指向了半解决方案。

使用非保留引用是不够的，因为当引用的对象被释放时，您需要将其归零（或从字典中删除条目）。但是，这必须在调用该对象的 -dealloc 方法之前完成，否则缓存的存在会使您面临对象复活的风险。这样做的方法是在创建弱引用时动态地对对象进行子类化，并在动态创建的子类中覆盖 -release 以使用锁定和 -dealloc 将弱引用清零。

这通常有效，但对于免费桥接的 Core Foundation 对象来说，它会失败。不幸的是，唯一的解决方案是，如果您需要将该技术扩展到免费桥接对象，则需要一些黑客攻击和未记录的内容（请参阅[此处](http://www.mikeash.com/pyblog/friday-qa-2010-07-30-zeroing-weak-references-to-corefoundation-objects.html)获取代码和解释），因此不适用于 iOS 或您想在Mac 应用商店。

如果您需要在 Apple 商店销售，因此必须避免未记录的东西，您最好的选择是实现对保留缓存的锁定访问，然后在您想要释放内存时清除它以获取当前 -retainCount 值为 1 的引用。只要对缓存的所有访问都是在持有锁的情况下完成的，如果您在持有锁的同时观察到计数为 1，您就知道如果您从缓存中删除对象（并因此释放它），没有人可以复活该对象) 在放弃锁定之前。

对于 iOS，您可以使用 UIApplicationDidReceiveMemoryWarningNotification 来触发清理。在 Mac 上，您需要实现自己的逻辑：可能只是定期检查，甚至只是定期清理（两种解决方案也适用于 iOS）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-05-11T19:00:02.720

我刚刚通过使用 NSMutableDictionary 并注册 UIApplicationDidReceiveMemoryWarningNotification 来实现这种事情。在内存警告中，我从字典中删除了 retainCount 为 1 的任何内容...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-11T20:05:38.737

使用 [NSValue valueWithNonretainedObject:] 将实例包装在 NSValue 中并将其放入字典中。在实例 dealloc 方法中，从字典中删除相应的条目。没有搞乱保留。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-06T09:57:37.643

我的理解是你想实现缓存管理算法的Graal：丢弃不再使用的项目。

您可能需要考虑其他标准，例如删除最近最少请求的项目。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-06T14:36:57.707

我认为我解决这个问题的方法是在某处维护一个单独的计数或标志，以指示缓存中的对象是否正在使用。然后，您可以在完成一个对象后检查它，或者每隔 n 秒运行一次检查以查看它是否需要释放。

我会避免任何涉及在从字典中删除对象之前释放对象的解决方案（使用 NSValue`valueWithNonretainedObject:`将是实现此目的的另一种方法）。从长远来看，它只会给你带来问题。

# wcf - 修复 WCF 中有问题的服务器响应

> ID：415757
> 
> 赞同：0
> 
> 时间：2009-01-06T07:54:06.443
> 
> 标签：wcf, web-services

我使用 WCF 作为 Java Web 服务的客户端。我无法控制服务器端。

在我从 Web 服务获得的响应中，soap 标头内的第一个元素上没有 xmlns 属性。由于这个 WCF 作为 Web 服务调用的结果返回 null。

除了缺少的 xmlns 之外，响应是完美的，如果我使用 fiddler 添加 xmlns，那么一切都按预期工作。我对 SOAP 了解得不够多，无法知道是否真的需要 xmlns 属性。

有没有办法避免这个问题，或者让 WCF 忽略缺少的 xmlns 属性，或者甚至是一个允许我在响应到达 WCF 之前手动调整响应的钩子？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-10-05T06:30:04.967

这似乎是一个很老的问题，所以我不确定你是否曾经解决过这个问题。如果您正在为 Java Axis 服务使用 WCF 客户端，您会发现您需要习惯使用[MessageInspectors](http://koolkode.net/Tutorials/MIT/MessageInspection.htm)来覆盖请求和响应的行为。

使用 AfterReceiveReply 方法，您应该能够[复制原始消息](http://blogs.msdn.com/b/vipulmodi/archive/2005/05/20/420475.aspx)并更改标题。另请查看[此 MSDN 文章中的第 5 步](http://msdn.microsoft.com/en-us/library/ff647820.aspx)。

据我所知，您不能直接在此方法中更改响应标头，因为它们是只读的，因此复制然后用篡改版本替换回复是我能想到的纠正丢失命名空间的唯一方法.

# regex - Perl YAML 转储中是否允许显式键入的正则表达式作为键？

> ID：415762
> 
> 赞同：1
> 
> 时间：2009-01-06T07:55:29.153
> 
> 标签：regex, perl, yaml, dump

这与之前的问题有关：[如何从 Python 中读取 Perl 数据结构？](https://stackoverflow.com/questions/389945/how-can-i-read-perl-data-structures-from-python). 这可能是我正在使用的 YAML 解析器版本（0.66）中的一个错误，但是当我运行时：

```
perl -MYAML -le 'do shift; print YAML::Dump( $CPAN::Config )' simple.pl 
```

关于以下内容`simple.pl`：

```
%config = (
    'color' => 'red',
    'numbers' => [5, 8],
    qr/^spam/ => qr/eggs$/,
); 
```

我得到：

```
---
(?-xism:^spam): !!perl/regexp (?-xism:eggs$)
color: red
numbers:
  - 5
  - 8 
```

请注意，键正则表达式没有显式类型。是什么赋予了？（谢谢！）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-06T12:48:45.240

来自`man perldata`：

> *散列是标量值的无序集合，由其关联的**字符串键**索引。*

密钥在 YAML 转储中没有类型，因为它们在 Perl 中没有类型。它们只是字符串。在你的情况下，字符串`(?-xism:^spam)`

试试这个： `perl -l -e'%config = ( qr/^spam/ => qr/eggs$/); print $config{"(?-xism:^spam)"}'`

# maven-2 - 不分散版本号的maven项目层次结构

> ID：415764
> 
> 赞同：36
> 
> 时间：2009-01-06T07:56:09.417
> 
> 标签：maven-2

如果您使用[Maven2](http://maven.apache.org/)作为包含许多具有相同版本号的工件的项目的构建系统，则生成的构建的版本分散在所有 pom.xml 中。其中许多甚至两次 - 在人工制品本身的版本标签和父版本标签中。因此，您必须在每次版本切换时更改并签入所有 pom.xml 的新版本。这有点烦人，特别是如果您必须同时编写多个错误修复和开发版本的代码。有办法解决吗？

澄清：我的问题是关于你在源代码控制系统中随着时间的推移获得的每个 pom.xml 的许多版本，它们的区别仅在于 pom 的版本号和/或父 pom 的版本号。理想情况下，您只需要在添加依赖项或其他内容时更改 pom。

例如，您有一个项目，其中包含工件 foo-pom（所有的父 pom）、foobar-jar、foobaz-jar 和 foo-war。在第一个版本中，版本是 1.0 - 它出现在每个 pom.xml 中。在第二个版本中，版本是 1.1 - 它再次出现在每个 pom.xml 中。因此，您必须更改每个 pom.xml - 如果您尽可能频繁地发布，这很烦人。

更新：如果您认为这很重要：已经在考虑不必指定父版本。请转到[maven JIRA 问题](http://jira.codehaus.org/browse/MNG-624)并投票支持它，以使其受到更多关注，并更有可能在即将发布的版本中作为增强功能添加。您需要为此创建/拥有一个 JIRA 登录名。

还有[另一个 Stackoverflow Question](https://stackoverflow.com/questions/545131/maven2-inheritence/549853#549853)基本上是关于同样的问题。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-26T04:41:20.457

还有[另一个 StackOverflow 线程也涵盖了您可能想要查看的主题](https://stackoverflow.com/questions/545131/maven2-inheritence/549853#549853)。

[简而言之，已经在考虑](https://issues.apache.org/jira/browse/MNG-624)在使用继承时不必指定父版本。[请转到 JIRA 并给它投票](https://issues.apache.org/jira/browse/MNG-624)，以使其更受关注，并更有可能在即将发布的版本中作为增强功能添加。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-12T09:18:31.830

在使用 Maven 2 构建的大型系统上工作时，我遇到了类似的问题。

在我看来，典型的多模块结构的缺点是所有模块必须共享相同的版本。这确实很烦人：即使您的下一个版本仅包含 中的错误修复`foobar-jar`，您也需要在任何地方更改全局版本（手动或使用 `maven-release-plugin`）并推出每个组件的新版本。在我的例子中，我构建了各种 WAR/EAR 应用程序，所以我的客户会问我为什么要同时交付一个新版本的`app1`和`app2`，而只有`app1`在应该受到影响的时候。

相反的方法是将每个组件作为一个独立的项目来管理，有自己的独立版本。这更灵活，因为它允许部分发布，但您现在需要手动跟踪所有这些版本（知道您的下一次交付将包含哪些版本，确保内部依赖关系一致等）。这很快就会成为大型应用程序中的噩梦。

长期以来，我一直在思考将这两种方法结合起来的一种方法：独立版本的灵活性，同时又不放弃系统的全局一致性。我尝试了与 romaintaz 相同的方法，但遇到了同样的问题。最后，我想出了这个主意： http: [//out-println.blogspot.com/2008/10/maven-modules-with-independent-versions.html](http://out-println.blogspot.com/2008/10/maven-modules-with-independent-versions.html)。

将其视为“实验性”，因为我最终没有尝试过它（出于非技术原因）。但我认为它会奏效。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-06T08:05:52.910

在我的项目中，我遇到了这样的问题。为了减少我在父 pom.xml 中定义的一些属性，这些属性对应于每个模块的版本：

```
<properties>
    <project-version>1.0.0</project-version>
    <!-- Same version than the parent for the module 'commons' -->
    <project-commons-version>${project-version}</project-commons-version>
    <!-- A specific version for the 'business' module -->
    <project-business-version>1.0.1</project-business-version>
    ... 
```

然后，在每个模块的 pom.xml 中，我使用这些属性。问题是我必须在这个 pom.xml 中明确输入父版本的版本。例如，在我的业务 pom.xml 中，我有：

```
<project>
  <modelVersion>4.0.0</modelVersion>
  <!-- I must indicate the version of the parent -->
  <parent>
    <groupId>my.project</groupId>
    <artifactId>parent</artifactId>
    <version>1.0.0</version>
  </parent>
  ...
  <dependencies>
    <!-- However, in my dependencies, I use directly the properties defined in the parent's pom.xml -->
    <dependency>
      <groupId>my.project</groupId>
      <artifactId>project-persistence</artifactId>
      <version>${project-persistence-version}</version>
    </dependency> 
```

但是，我真的建议您查看可以为您修改所有版本号的[发布插件。](http://maven.apache.org/plugins/maven-release-plugin/)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-01-06T08:12:07.577

[本文](http://ceki.blogspot.com/2006/11/solution-to-maven2-version-number.html)是否为您的问题提供了解决方案？

> 这个想法是在父 pom.xml 中将整个项目的版本号声明为一个属性，即“厌恶”（双关语）。父 pom 自己的版本号可以是任何东西，只要它以“SNAPSHOT”结尾。
> 
> 子模块的版本通过 ${aversion} 属性指定。孩子对其父母版本的引用是硬编码的。但是，由于父 pom 的版本是 SNAPSHOT，因此子模块将看到父 pom 中的更改。特别是，如果父 pom 更改了 ${aversion} 的值，子级将看到更改。

根据评论，这不是一个完美的解决方案。

而且发布插件并没有解决真正的问题：**合并**.
到处都有版本号的无穷无尽的副本意味着在将分支重新组合在一起时会产生很多冲突。

笔记：

> 对于 Maven 2.0.9（最新版本 - 2008 年 4 月），我只是从各个模块中省略了版本元素，因为它们将从其父模块继承版本。如果您的模块与其父模块共享相同的 groupId，这也适用于 groupId。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-06T15:35:09.383

这是一个可以解决问题的可能扩展 maven 的想法。目前，您必须在 pom.xml 中编写工件和父 pom 的版本。已经有一种方法可以为父 pom 提供绝对位置：

```
<parent>
    <groupId>org.codehaus.mojo</groupId>
    <artifactId>my-parent</artifactId>
    <version>2.0</version>
    <relativePath>../my-parent</relativePath>
</parent> 
```

如果你允许省略父版本和这个 pom 的版本，只要 maven 能够通过相对路径访问父 pom，你就完成了。该版本仅在父 pom 中提及，其他任何地方都没有提及。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-10-26T20:44:26.283

我们正好有这个问题。我们有大量（大约 10 个）不同的项目，其中一些相互依赖。包含项目的文件夹有一个用于整个项目集的父 pom。每次我们创建一个新分支时，我们都必须进入每个 pom 文件来更改 <version> 元素以及父级的 <version> 元素，所有这些编辑都很烦人。

在阅读了这个问题和这里的答案后，我意识到情况是没有希望的。每个项目都可以从父 pom 继承 <version> 元素，这样很容易消除，但我们显然不能为 <parent> 继承 <version>。

不幸的是，我忘了告诉我的同事这是不可能的，所以他修好了。他的解决方案是在父 pom 文件中添加一个属性：

```
<properties><currentVersion>2.6.1-SNAPSHOT</currentVersion></properties> 
```

然后在子 pom 文件中，我们声明了父版本标签，如下所示：

```
<version>${currentVersion}</version> 
```

我不知道为什么会这样。我看不出它如何在不指定版本号的情况下找到正确的父 pom。但对我来说（maven 版本 1.5.0_22）它**正在**工作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-12-22T07:19:16.123

[在解决maven 问题](http://jira.codehaus.org/browse/MNG-624)之前，这是另一个轻量级的解决方法。在一个大型项目中，我们不再将 pom.xml 本身放在版本控制中，而是将 pom-template.xml 仅包含版本号的占位符。从版本控制更新项目树后，您需要运行一个小 ant 脚本，在每个目录中生成实际的 pom.xml。这很烦人，但比忍受所有那些烦人的 pom 版本更烦人。

# opengl - opengl 在纹理 blit 上慢

> ID：415766
> 
> 赞同：0
> 
> 时间：2009-01-06T07:56:36.937
> 
> 标签：opengl, drawing, performance, textures, blit

我每帧调用一次这个函数，它使我的 FPS 从 >400 到 33。为什么？

```
sw blt(const PtRect *dstRect, Texture *src, const PtRect *srcRect, RenderDevice::bltFlags flags=RenderDevice::bltDefault)
{
    assert(src);
    GL_Texture *glsrc = dynamic_cast<GL_Texture*>(src);
    if (glsrc == 0)
        return -1;

    PtRect srcRect2(0, 0, src->width, src->height);
    if (srcRect == 0)
        srcRect = &srcRect2;

    PtRect dstRect2(0, 0, srcRect->makeWidth(), srcRect->makeHeight());
    if (dstRect == 0)
        dstRect = &dstRect2;

    glColor4f(1.0f, 1.0f, 1.0f, 1.0f);

    glEnable(GL_TEXTURE_2D);
    glBindTexture(GL_TEXTURE_2D, *glsrc->getTex());

    glBegin( GL_QUADS );
    glNormal3f( 0.0f, 0.0f, 1.0f );
    for (size_t i=0; i<350; i++)
    {
        glTexCoord2f( srcRect->left /src->width, srcRect->top/src->height);    glVertex2f(dstRect->left,  dstRect->top);
        glTexCoord2f( srcRect->right/src->width, srcRect->top/src->height);    glVertex2f(dstRect->right, dstRect->top);
        glTexCoord2f( srcRect->right/src->width, srcRect->bottom/src->height); glVertex2f(dstRect->right, dstRect->bottom);
        glTexCoord2f( srcRect->left /src->width, srcRect->bottom/src->height); glVertex2f(dstRect->left,  dstRect->bottom);
    }
    glEnd();
    return 0;
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-06T08:12:17.047

很难说没有更多细节，潜在的问题可能是使用了太大的纹理，导致驱动程序中的软件回退。此外，您似乎无缘无故地循环了 350 次。

您可以通过构建数据数组然后调用 glDrawArrays 而不是单独发出每个 glTexCoord/glVertex 对来提高性能

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T08:28:15.343

为了提高性能，您应该在 init 函数中加载纹理并使用列表显示，然后在主渲染函数中显示，例如：

```
// Generate texture object ID
glGenTextures(1, img);
glBindTexture(GL_TEXTURE_2D, img);

// Set Texture mapping parameters
glTexParameterf(GL_TEXTURE_2D,GL_TEXTURE_WRAP_S, GL_REPEAT);
glTexParameterf(GL_TEXTURE_2D,GL_TEXTURE_WRAP_T, GL_REPEAT);
glTexParameterf(GL_TEXTURE_2D,GL_TEXTURE_MAG_FILTER, GL_LINEAR);
glTexParameterf(GL_TEXTURE_2D,GL_TEXTURE_MIN_FILTER, GL_LINEAR);

LoadBMP("texture.bmp"); 
```

然后在主渲染功能上你有类似的东西：

```
// Front face of Cube
glBindTexture(GL_TEXTURE_2D, img);
glBegin(GL_QUADS);
glTexCoord2f(0.0f, 0.0f);
glVertex3f(-fSize, fSize, fSize);
glTexCoord2f(0.0f, 1.0f);
glVertex3f(-fSize, -fSize, fSize);
glTexCoord2f(1.0f, 1.0f);
glVertex3f(fSize,-fSize, fSize);
glTexCoord2f(1.0f, 0.0f);
glVertex3f(fSize,fSize, fSize);
glEnd(); 
```

如您所见，您可以将纹理包装在参数上，而不是在循环中一遍又一遍地重复它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-10-21T18:32:57.203

也许您没有使用 2 次方的纹理（例如 1024x768 而不是 1024x512）？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-06T08:22:39.753

看起来您出于某种原因将四边形绘制到屏幕上 350 次。如果这是全屏，那么将屏幕上的每个像素纹理化 350 次一帧势必会损害您的性能。

# oop - 猴子补丁还是不猴子？

> ID：415768
> 
> 赞同：12
> 
> 时间：2009-01-06T07:58:20.787
> 
> 标签：oop, language-agnostic, monkeypatching

这是一个更普遍的问题，然后是特定于语言的问题，尽管我在玩 python ncurses 模块时遇到了这个问题。我需要显示语言环境字符并将它们识别为字符，所以我只是快速地从 curses 模块中修补了一些函数/方法。

这就是我所说的快速而丑陋的解决方案，即使它有效。而且变化相对较小，所以我希望我没有搞砸任何事情。我的计划是找到另一个解决方案，但是看到它运行良好并且运行良好，你知道它是怎么回事，我继续处理我必须处理的其他问题，我确定如果没有错误，我永远不会让它变得更好。

不过，在我看来，更普遍的问题是——显然有些语言允许我们在类中对大块代码进行猴子补丁。如果这是我自己用的代码，或者改动很小，没关系。如果其他开发人员使用我的代码怎么办，他看到我使用了一些众所周知的模块，所以他可以假设它像以前一样工作。然后，这种方法突然表现得与它应该的不同。

所以，非常主观，我们应该使用猴子补丁，如果是，何时以及如何？我们应该如何记录它？

* * *

编辑：对于@guerda：

Monkey-patching 是在执行时动态改变某些代码的行为，而不改变代码本身的能力。

Python中的一个小例子：

```
import os
def ld(name):
    print("The directory won't be listed here, it's a feature!")

os.listdir = ld

# now what happens if we call os.listdir("/home/")?
os.listdir("/home/") 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-06T09:05:02.930

# 不！

尤其是对于免费软件，您有所有可能将您的更改纳入主发行版。但是，如果您在本地副本中存在薄弱的黑客攻击，您将永远无法发布该产品，并且升级到下一个版本的 curses（任何人都可以进行安全更新）的成本将非常高。

请参阅[此答案](https://stackoverflow.com/questions/146936/what-can-you-do-to-a-legacy-codebase-that-will-have-the-greatest-impact-on-improv#146951)以了解外国代码库的可能性。链接的[截屏视频](http://www.lostechies.com/blogs/jimmy_bogard/archive/2008/05/06/pablotv-eliminating-static-dependencies-screencast.aspx)真的值得一看。突然间，一个肮脏的黑客变成了有价值的贡献。

如果您出于某种原因确实无法将补丁安装到上游，至少创建一个本地 (git) 存储库来跟踪上游并将您的更改放在单独的分支中。

最近我遇到了一个问题，我不得不接受猴子修补作为最后的手段：[Puppet](http://en.wikipedia.org/wiki/Puppet_%28software%29)是一段“到处运行”的 ruby​​ 代码。由于代理必须在 - 可能经过认证的 - 系统上运行，它不需要特定的 ruby​​ 版本。其中一些具有可以通过在运行时中修补选择方法来解决的错误。这些补丁是特定于版本的，包含的，并且目标被冻结。我在那里看不到其他选择。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-06T08:21:38.913

我会说不要。

每个猴子补丁都应该是一个例外并被标记（例如带有 //HACK 注释），以便它们易于追溯。

众所周知，将丑陋的代码留在原处很容易，因为它可以工作，所以为什么要花更多时间在它上面。所以丑陋的代码会存在很长时间。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-02-07T13:43:28.447

我同意[David](https://stackoverflow.com/questions/415768/to-monkey-patch-or-not-to/415876#415876)的观点，即猴子修补生产代码通常不是一个好主意。

但是，我相信对于支持它的语言，猴子补丁是一个非常有价值的单元测试工具。它允许您隔离需要测试的代码片段，即使它具有复杂的依赖关系——例如无法注入依赖关系的系统调用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-06T09:04:32.040

我认为这个问题不能用一个明确的是-否/好-坏答案来解决——必须考虑语言及其实现之间的差异。

在 Python 中，需要考虑一个类是否可以进行猴子补丁（请参阅这个[SO question](https://stackoverflow.com/questions/192649/can-you-monkey-patch-methods-on-core-types-in-python)进行讨论），这与 Python 的稍微少一点的 OO 实现有关。所以我会很谨慎，并倾向于在猴子修补之前花一些精力寻找替代品。

在 Ruby 中，OTOH 被构建为 OO 到解释器中，可以修改类，而不管它们是用 C 还是 Ruby 实现的。甚至 Object（几乎是所有东西的基类）也可以修改。因此，猴子修补在该社区中被更热情地采用为一种技术。

# ruby-on-rails - 如何在 mod_perl 虚拟主机中混合 Phusion Passenger？

> ID：415778
> 
> 赞同：1
> 
> 时间：2009-01-06T08:03:36.173
> 
> 标签：ruby-on-rails, apache2, catalyst

我有一个 VirtualHost，它将 Location / 的处理程序设置为 PerlModule 以部署催化剂应用程序。

我想将催化剂应用程序转换为轨道，但逐渐。前端都是使用 ExtJS 框架的 javascript，后端只提供 JSON。只要 JSON 与 Catalyst 和 Rails 的格式相同，这将允许逐步过渡。

理想情况下，我可以通过在同一个域上同时托管 rails 和催化剂，然后更新我的 AJAX 应用程序的各个部分以一次使用 rails 而不是催化剂。

我需要将它们放在同一个域中，这样我就不必重新编码所有 AJAX 组件来使用脚本标记代理和 JSON 回调。

关于如何配置 phusion 乘客以使用 mod_perl 的任何想法，它拥有位置 / 以及它包含的所有内容，除非我指定另一个处理程序？

我尝试将 /rails 的默认处理程序设置为 default-handler 以绕过 mod_perl，然后使用 Passenger 的 RailsBaseURI /rails ... 但这显然不起作用。您不能在 Location 标签中使用 RailsBaseURI。我无法从乘客那里找到任何可以使用的处理程序。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T05:39:53.000

听起来您只需要一些简单的“别名”指令。

```
Alias /still/catalyst /path/to/the/catalyst_fastcgi.pl/ 
```

# java - 用于从 oracle 数据库中检索具有 CLOB 数据的记录的 SQL 查询语句

> ID：415779
> 
> 赞同：0
> 
> 时间：2009-01-06T08:03:41.650
> 
> 标签：java, database, oracle, jdbc

我尝试了这段代码，*最终表*中具有***clob*****数据类型的注释**值为null 或有时显示几个单词。我应该添加什么以便从**评论**中检索整个数据并显示到文本区域？谢谢：-）

 ****```
<%@ page import="java.sql.*" %>

<%  Class.forName("oracle.jdbc.driver.OracleDriver"); %>

<HTML>
 <TITLE>SHIFT REPORT </TITLE>
 <BODY BGCOLOR="white">

    <% 
   Connection connection=DriverManager.getConnection ("jdbc:oracle:thin:@oradev2.j.com:1521:RPDB","shiftrpt",  //
         "shiftrpt"
            );

        Statement statement = connection.createStatement() ;
        ResultSet resultset = 
        statement.executeQuery("select * from final") ; 
    %>

    <TABLE BORDER="5" BGCOLOR="PINK" width='270%' cellspacing='1' cellpadding='0' >
        <TR>
            <TH bgcolor='#DAA520'> <font size='2'>RECORD NUMBER</TH>
            <TH bgcolor='#DAA520'><font size='2'>TESTER NUMBER</TH>
            <TH bgcolor='#DAA520'><font size='2'>DATE</TH>
            <TH bgcolor='#DAA520'><font size='2'>TIME</TH>
            <TH bgcolor='#DAA520'><font size='2'>SYSTEM TYPE</TH>
            <TH bgcolor='#DAA520'><font size='2'>PACKAGE</TH>
            <TH bgcolor='#DAA520'><font size='2'>CATEGORY</TH>
       <TH bgcolor='#DAA520'><font size='2'>COMMENTS</TH>
            <TH bgcolor='#DAA520'><font size='2'>VALIDATED BY</TH>
        </TR>

        <% while(resultset.next()){ %>

        <TR bgcolor="#ADDFFF" onMouseOver=this.bgColor="#8AFB17" onMouseOut=this.bgColor="#ADDFFF">
            <TD height="5"> <font size='2'><center><%= resultset.getLong(1) %></center></TD>
            <TD> <font size='2'><center><%= resultset.getString(2) %></center></TD>
            <TD> <font size='2'><center><%= resultset.getDate(3) %></center></TD>
            <TD> <font size='2'><center><%= resultset.getString(4) %></center></TD>
            <TD> <font size='2'><center><%= resultset.getString(5) %></center></TD>
            <TD> <font size='2'><center><%= resultset.getString(6) %></center></TD>
            <TD> <font size='2'><center><%= resultset.getString(7) %></center></TD>
            <TD><font size='2'><center><textarea cols=50 rows=3><%=  resultset.getString(8) %>
            <TD> <font size='2'><center><%= resultset.getString(9) %></center></TD>
        </TR>

        <% } %>

    </TABLE>

  </BODY>
  </HTML> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-06T08:18:28.640

请改用**(java.sql.Clob)resultSet.getObject(8)**或**resultSet.getClob(8)**。

此外，看看[这里的例子](http://www.herongyang.com/jdbc/Oracle-CLOB-getClob.html)很好。这是来自 Oracle的链接，[Working with LOBs and BFILEs 。](http://download.oracle.com/docs/cd/B28359_01/java.111/b31224/oralob.htm)

**建议。**

*   使用脚本不是一个好习惯。改用 JSP EL/JSTL
*   非常不鼓励在 JSP 中操作结果集，除非使用 JSTL SQL 标记进行原型设计，可以说

# linq-to-sql - DataContext 命名最佳实践

> ID：415780
> 
> 赞同：0
> 
> 时间：2009-01-06T08:04:24.907
> 
> 标签：linq-to-sql

有吗？您是否为 DataContext 提供了您从中获取数据的数据库的名称，或者..

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-06T08:06:31.487

不知道是否有任何既定的“最佳实践”。我只是用对我有意义的东西来命名它，并让我立即知道它是什么。对我来说，就是在数据库之后命名它。

所以对于 Northwind 数据库，我有 NorthwindDataContext。

# .net - Visual Studio + Crystal Reports + SourceSafe = 自动结帐

> ID：415797
> 
> 赞同：0
> 
> 时间：2009-01-06T08:16:50.360
> 
> 标签：.net, visual-studio, crystal-reports, visual-sourcesafe

我有一个简单的 VS2008 项目，其中包含几个 Crystal Reports，使用 Crystal Reports 2008（在 Visual Studio 之外）创建。该解决方案被添加到源代码管理 (Visual SourceSafe 6.0)。现在，每次我打开解决方案时，所有报告都会连同相应的 cs 文件一起被检出。没有对文件进行任何更改，所以我可以撤消结帐，但这很烦人。有人遇到过这个问题吗？有解决办法吗？
编辑：这是完整的描述会发生什么：

*   使用 Crystal Reports 2008 创建了多个报表
*   仅使用一个项目创建 Visual Studio 2008 解决方案并添加现有报告
*   将解决方案添加到 SourceSafe 并检查所有内容
*   关闭解决方案
*   打开解决方案（只是它，而不是报告）并且报告被签出，没有任何变化
    这种行为不仅适用于我，从事该项目的每个人都有这个问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-06T10:29:31.713

经过一番谷歌搜索后，我在 MSDN 论坛中找到[了该主题。](http://social.msdn.microsoft.com/Forums/en-US/tfsversioncontrol/thread/ebeefa1a-1b30-4075-9c18-6017940a3aa1/)我的问题与那里讨论的问题相同。指出的解决方案是更新 Crystal Reports。有时间我会试试的。
编辑：是的，它已修复！:) 对于遇到相同问题的任何人 - 只需从 Business Objects 下载页面下载并安装最新的服务包。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T15:07:12.073

我知道这不是您问题的解决方案...（我看到您找到了一个）但使用另一个源代码控制系统...它解决了我们遇到的很多问题（我们甚至使用 vss 文件损坏） . MS 也一直停留在 6.0 上（不要认为会发布任何改进）。

我们在一年前进行了更改，在另一个 VSS 损坏问题之后，我唯一的遗憾是我们没有更快地更改，多么节省时间！

我个人使用：

*   [颠覆](http://subversion.tigris.org/)
*   [Visual SVN](http://www.visualsvn.com/visualsvn/)（VS 插件）或使用免费的[Ankh](http://ankhsvn.open.collab.net/)
*   [TortoiseSVN](http://tortoisesvn.tigris.org/)

问问周围的人都会告诉你，留在vss是一个糟糕的选择……

只是我想给你的 2 美分。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-06T09:08:31.440

你有没有在设计器中打开报表？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-06T10:02:30.537

您可能需要进一步缩小问题范围以查看问题可能是什么

1.  其他项目会发生这种情况吗？也许它是一个 VSS 问题。
2.  您是否尝试在签出的 cs 文件上运行 diff 以查看可能发生的变化？Perhpas VS 在报告文件上运行自定义工具以重新生成 cs 文件

# cocoa - 如何在可可应用程序中调用 c 静态库？

> ID：415799
> 
> 赞同：2
> 
> 时间：2009-01-06T08:17:51.620
> 
> 标签：cocoa

我有两个项目，一个 Cocoa 应用程序和一个它使用的静态 c 库。

然后不在同一个文件夹中。例如：c静态库的名称是libXXX.a，它在XXXcore文件夹中。cocoa应用程序在另一个与XXXcore文件夹同级的文件夹中。当我尝试编译可可应用程序时，我有链接错误结果。似乎在可可应用程序信息（常规面板）中更改了搜索路径。但它不起作用，为什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-06T08:22:30.160

如果您使用的是 Xcode，则可以通过将库添加到项目中的 Frameworks 文件夹来添加指向静态库的链接。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-07T03:16:46.767

ok. I have the answer:

1.  add the .a library to your cocoa project
2.  edit the path of Header Search paths and Library Search paths in the project info panel(build panel)
3.  don't forget the copy option while adding the library to your project.

Thanks Mehrdad Afshari for your help!

# php - php中允许的内存大小为33554432字节耗尽（尝试分配43148176字节）

> ID：415801
> 
> 赞同：330
> 
> 时间：2009-01-06T08:18:28.810
> 
> 标签：php, memory-management, memory-limit

正在显示此错误消息，有什么建议吗？

> php中允许的内存大小为33554432字节耗尽（尝试分配43148176字节）

* * *

## 回答 #1

> 赞同：375
> 
> 时间：2009-01-10T03:38:18.773

最后我找到了答案：

只需在 php 文件中出现错误的行之前添加此行

`ini_set('memory_limit', '-1');`

它需要无限的服务器内存使用，它工作正常。

考虑`'44M'`而不是`'-1'`安全的内存使用。

* * *

## 回答 #2

> 赞同：69
> 
> 时间：2011-03-10T01:52:12.460

以下是增加共享主机限制的两种简单方法：

1.  如果您有权访问您的 PHP.ini 文件，请更改 PHP.ini 中的行 如果您的行显示 32M，请尝试 64M： `memory_limit = 64M ; Maximum amount of memory a script may consume (64MB)`

2.  如果您无权访问 PHP.ini，请尝试将其添加到 .htaccess 文件中： `php_value memory_limit 64M`

* * *

## 回答 #3

> 赞同：52
> 
> 时间：2009-01-06T08:27:52.100

您的脚本使用了太多内存。如果您有一个失控的循环并且您在循环的每次通过时创建对象或添加到数组中，这通常会在 PHP 中发生。

检查无限循环。

如果这不是问题，请尝试通过将已完成的对象设置为 null 来销毁对象来帮助 PHP。例如。`$OldVar = null;`

检查错误实际发生的代码。您是否希望该行分配大量内存？如果没有，请尝试找出问题所在...

* * *

## 回答 #4

> 赞同：45
> 
> 时间：2015-03-07T12:55:53.290

正在做 ：

```
ini_set('memory_limit', '-1'); 
```

从来都不是好事。如果你想读取一个非常大的文件，最好一点一点地复制它。尝试以下代码以获得最佳实践。

```
$path = 'path_to_file_.txt';

$file = fopen($path, 'r');
$len = 1024; // 1MB is reasonable for me. You can choose anything though, but do not make it too big
$output = fread( $file, $len );

while (!feof($file)) {
    $output .= fread( $file, $len );
}

fclose($file);

echo 'Output is: ' . $output; 
```

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2009-01-06T22:22:24.787

不幸的是，在 PHP 中以一种比你想象的更快消耗内存的方式编程是很容易的。复制字符串、数组和对象而不是使用引用就可以了，尽管 PHP 5 应该比 PHP 4 更自动地做到这一点。但是与处理最小的逻辑单元相比，通过几个步骤处理完整的数据集也很浪费一次。典型的例子是使用数据库中的大型结果集：大多数程序员将整个结果集提取到一个数组中，然后使用`foreach()`. `while()`使用循环一次获取和处理一行的内存效率要高得多。同样的事情也适用于处理文件。

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2018-07-08T09:56:26.767

我在使用 laravel 5.6 的 php7.2 中遇到了同样的问题。我只是`memory_limit = 128M`根据应用程序的需要增加 php.ini 中的变量数量。它可能是 256M/512M/1048M .....现在它工作正常。

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2009-01-22T10:00:01.683

如果你想读取大文件，你应该一点一点地读取它们，而不是一次读取它们。
这很简单：如果您一次读取一个 1 MB 的大文件，那么同时至少需要 1 MB 的内存来保存数据。

`fopen`因此，您应该使用&一点一点地阅读它们`fread`。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2017-01-04T21:17:58.543

我也遇到了同样的问题，查找 phpinfo.ini、php.ini 或 .htaccess 文件无济于事。最后，我查看了一些 php 文件，打开它们并检查了里面的代码以获取内存。最后，这个解决方案是我提出的，它对我有用。我使用的是 wordpress，所以这个解决方案可能只适用于 wordpress 内存大小限制问题。我的解决方案是在**/public_html/wp-includes文件夹中打开****default-constants.php**文件。使用代码编辑器打开该文件，并在作用域下找到内存设置，或者只需 Ctrl+F 即可找到“内存”一词。在那里你会过来。只是增加它，在我的情况下它是 64 MB，我将它增加到 128 MB，然后增加到 200 MB。**`wp_initial_constants``WP_MEMORY_LIMIT``WP_MAX_MEMORY_LIMIT`**

 **```
// Define memory limits.
if ( ! defined( 'WP_MEMORY_LIMIT' ) ) {
    if ( false === wp_is_ini_value_changeable( 'memory_limit' ) ) {
        define( 'WP_MEMORY_LIMIT', $current_limit );
    } elseif ( is_multisite() ) {
        define( 'WP_MEMORY_LIMIT', '200M' );
    } else {
        define( 'WP_MEMORY_LIMIT', '128M' );
    }
}

if ( ! defined( 'WP_MAX_MEMORY_LIMIT' ) ) {
    if ( false === wp_is_ini_value_changeable( 'memory_limit' ) ) {
        define( 'WP_MAX_MEMORY_LIMIT', $current_limit );
    } elseif ( -1 === $current_limit_int || $current_limit_int > 268435456 /* = 256M */ ) {
        define( 'WP_MAX_MEMORY_LIMIT', $current_limit );
    } else {
        define( 'WP_MAX_MEMORY_LIMIT', '256M' );
    }
} 
```

顺便说一句，请不要执行以下代码，因为这是不好的做法：

```
ini_set('memory_limit', '-1'); 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2015-11-19T07:26:32.877

您可以通过在脚本中的所有代码上方执行以下行来增加允许 php 脚本的内存：

```
ini_set('memory_limit','-1'); // enabled the full memory available. 
```

并且还取消分配脚本中不需要的变量。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2018-02-22T23:34:58.387

我注意到许多答案只是试图增加分配给有其位置的脚本的内存量，但通常这意味着由于不可预见的体积或大小，某些东西在内存方面过于宽松。显然，如果您不是脚本的作者，除非您雄心勃勃，否则您将受到作者的摆布：) PHP 文档甚至说内存问题是由于“[脚本编写不当](http://php.net/manual/en/ini.core.php#ini.memory-limit)”造成的

需要说明的是`ini_set('memory_limit', '-1');`（无限制）可能会导致服务器不稳定，因为`0 bytes free = bad things`. 相反，请通过脚本尝试执行的操作和机器上的可用内存量找到合理的平衡点。

**更好的方法：**如果您是脚本的作者（或雄心勃勃），您可以使用[xdebug](https://xdebug.org/index.php)调试此类内存问题。最新版本（2.6.0 - 2018-01-29 发布）带回了内存分析，显示哪些函数调用正在消耗大量内存。它暴露了脚本中很难找到的问题。通常，效率低下是在一个不期望接收量的循环中，但每个案例都将作为练习留给读者:)

[xdebug 文档](https://xdebug.org/docs/profiler)很有帮助，但它归结为 3 个步骤：

1.  [安装它](https://xdebug.org/download.php)-可通过`apt-get`等`yum`
2.  [配置它](https://xdebug.org/docs/profiler)- xdebug.ini: `xdebug.profiler_enable = 1`,`xdebug.profiler_output_dir = /where/ever/`
3.  [在QCacheGrind](http://sourceforge.net/projects/qcachegrindwin/)、[KCacheGrind](https://kcachegrind.github.io/)等工具中查看配置文件

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2018-01-12T03:08:12.303

```
ini_set('memory_limit', '-1'); 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-01-06T08:32:11.107

如果你试图读取一个文件，那将占用 PHP 的内存。例如，如果您尝试打开并读取 MP3 文件（例如 $data = file(" [http://mydomain.com/path/sample.mp3](http://mydomain.com/path/sample.mp3) " ），它将把它全部拉入内存.

正如 Nelson 建议的那样，如果您确实需要使用这么多内存，则可以努力增加最大内存限制。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-12-23T06:43:06.493

我们有类似的情况，我们尝试在答案的顶部给出 ini_set('memory_limit', '-1'); 一切正常，压缩图像文件大于 1MB 到 KB。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-10-14T13:23:10.000

写

`ini_set('memory_limit', '-1');`

打开 php 标签后，在顶部的 index.php 中

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-02-13T18:03:23.433

在 Wordpress 中切换到新主题后，我收到了相同的错误消息。PHP 运行的是 5.3 版，所以我切换到 7.2。这解决了这个问题。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2019-08-05T14:30:48.960

如果您使用的是共享主机，您将无法强制增加 php 大小限制。

只需转到您的 cpanel 并将您的 php 版本升级到 7.1 及更高版本即可。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2021-01-18T09:10:07.863

我想分享我在这个问题上的经验！

假设你有 A 类和 B 类。

```
class A {
    protected $userB;

    public function __construct() {
        $this->userB = new B();
    }
}

class B {
    protected $userA;

    public function __construct() {
        $this->userA = new A();
    }
} 
```

这将启动可能会产生此类问题的对象链形成！

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2022-01-20T20:29:50.973

我运行了以下命令`composer update`，现在正在工作。如果它不能解决您的问题，请增加文件`memory_limit`中的内存限制`php.ini`。

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2015-01-21T19:05:19.740

wordpress 用户添加行：

`@ini_set('memory_limit', '-1');`

在 wp-settings.php 中，您可以在 wordpress 安装的根文件夹中找到

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2017-06-06T08:51:29.057

我没有更新我的主机并且数据库是只读的。Joomla 需要编写会话并且无法做到。

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2018-02-07T05:56:48.530

我遇到了在命令行中运行 php 的相同问题。最近，我更改了php.ini文件并在更改php.ini时出错了

这是针对 php7.0

> 我犯错的 php.ini 的路径：`/etc/php/7.0/cli/php.ini`

我已经设置`memory_limit = 256`（这意味着`256 bytes`）
而不是`memory_limit = 256M`（这意味着`256 Mega bytes`）。

> ; 脚本可能消耗的最大内存量（128MB）
> ；[http://php.net/memory-limit](http://php.net/memory-limit)
> `memory_limit = 128M`

一旦我纠正了它，我的过程就开始运行良好。

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2019-04-20T13:12:04.553

如果您使用的是 laravel，请使用这种方式

`public function getClientsListApi(Request $request){ print_r($request->all()); //for all request print_r($request->name); //for all name }`

代替

`public function getClientsListApi(Request $request){ print_r($request); // it show error as above mention }`

* * *

## 回答 #23

> 赞同：-1
> 
> 时间：2019-07-23T10:30:32.067

在您的 Magento 根目录中运行此命令`php -d memory_limit=4G bin/magento`

* * *

## 回答 #24

> 赞同：-1
> 
> 时间：2021-06-04T06:34:36.267

```
COMPOSER_MEMORY_LIMIT=-1 composer require mageplaza/module-core 
```

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2021-08-22T07:02:15.923

wordpress 用户添加行：

```
@ini_set('memory_limit', '-1'); 
```

或者

在 cpanel 中将 memory_limit 设置为 -1

[![在此处输入图像描述](https://i.stack.imgur.com/ZmTTR.png)](https://i.stack.imgur.com/ZmTTR.png)

# ruby - 与 merb 一起使用的 Ruby Atom 生成器

> ID：415804
> 
> 赞同：2
> 
> 时间：2009-01-06T08:20:12.833
> 
> 标签：ruby, merb, atom-feed

我想在我的 Merb 应用程序中提供提要。在阅读了 wikipedia、[RSSvsAtom](https://stackoverflow.com/questions/347504/providing-rss-and-atom-feeds-do-we-need-both-or-has-rss-won)并看到 StackOverflow 使用它之后，我想我会使用 Atom。我应该使用什么库？我发现[rAtom](http://ratom.rubyforge.org/)看起来相当不错。有更好的选择吗？或者merb有什么内置的东西可以帮助我吗？

**更新：**也许我应该只用纯 html 做新闻并使用 FeedBurner？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-06T08:27:06.673

虽然不是特定于 Merb，但您可以考虑使用 FeedTools - 它是一个 Ruby Gem。

你会做这样的事情：

```
require 'feed_tools'
feed = FeedTools::Feed.open('http://url/feed')

feed.items.each do |item|
  puts item.title + "\n---\n" + item.description + "\n\n"
end 
```

[无论如何 - 在http://sporkmonger.com/projects/feedtools](http://sporkmonger.com/projects/feedtools)上查看

**注意：**这是用于解析 ATOM 提要，因为我不清楚您是要提供 ATOM 提要还是解析其他提要。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-09T09:06:23.363

我现在选择了 rAtom，它工作得非常好——代码很少而且很好。

# javascript - 如何在没有字幕的情况下创建无尽的图片展示？

> ID：415821
> 
> 赞同：1
> 
> 时间：2009-01-06T08:29:18.883
> 
> 标签：javascript, marquee

我为 Joomla 写了一个模块！1.5 显示点击次数最多的图片（横幅）。现在我想在主页上显示这个列表滚动。使用“选框”，在最后一张图片之后有一个休息时间。我找到了一个建议，说我必须创建一个带有溢出的 div 容器：隐藏和第二个带有 javascripte 的 div，它改变了图片的位置。谁能帮我写这段代码，因为我没有javascripte？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-06T08:38:01.720

您可以获得很多已经为您编写的免费内容。

尝试这些 jquery 脚本之一来做你正在寻找的...

[http://plugins.jquery.com/project/Plugins/category/48](http://plugins.jquery.com/project/Plugins/category/48)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T08:38:22.110

实现此类功能的最佳方法是查看这个很棒的 JQuery 视频教程，您将拥有一个很棒的产品 :)

网址：[JQuery Spy 效果](http://jqueryfordesigners.com/simple-jquery-spy-effect/)

MOV：[Jquery 间谍效果](http://jqueryfordesigners.com/media/simple-spy.mov)

希望这正是您正在寻找的。

# manifest - 关于清单文件

> ID：415831
> 
> 赞同：13
> 
> 时间：2009-01-06T08:37:05.263
> 
> 标签：manifest

最近，我遇到了一个很奇怪的问题，这个问题只发生在 Windows XP SP3 和 Vista 中。这是我的步骤：

1.  在桌面新建两个文件夹（假设文件夹名称为A和B）
2.  将 Microsoft GraphEdit ( `graphedt.exe`) 应用程序复制到 A 文件夹，然后也创建一个空`graphedt.exe.manifest`文件。运行`graphedt.exe`，你会看到一条错误信息，`graphedt.exe`由于清单错误而无法运行。
3.  将 Microsoft GraphEdit( `graphedt.exe`) 应用程序复制到 B 文件夹，运行`graphedt.exe`并关闭它，然后创建一个空`graphedt.exe.manifest`文件，`graphedt.exe`再次运行，您将看到清单文件无法应用于`graphedt.exe`. 但是，如果您更改 的最后修改时间`graphed.exe`，清单将再次起作用。

似乎 Windows 会在 EXE 第一次使用清单文件时记住该状态，但如果您更改 EXE 大小或上次修改日期，Windows 也会重置旧记住的状态。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-01-16T01:09:09.023

[我是微软目前的 SxS 维护者]

好查宜岗。您描述的是 Vista 上的行为，而不是 XP SP3 上的行为。

每次运行应用程序时检测清单是否存在将是一个性能问题，因为通常应用程序要么有清单，要么没有清单，并且该状态不会发生太大变化。出于这个原因，在 Vista 上，第一次运行应用程序时，我们会缓存一些描述“此应用程序有关联的清单”或“此应用程序没有清单”的信息。当您第一次运行 graphedt.exe 时，Windows 缓存了清单的缺失，随后将不再寻找。要重置缓存，请更新可执行文件的最后修改时间。

# network-programming - 在通过 localhost 传输期间，OSI 模型中使用了哪些层？

> ID：415832
> 
> 赞同：3
> 
> 时间：2009-01-06T08:37:09.290
> 
> 标签：network-programming, tcp, network-protocols

通过 localhost 地址或 127.0.0.1 传输数据时，OSI 模型中使用了哪些层？

我相信通信从应用层开始，一直到某个层，但没有数据通过物理层，还是有？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-06T09:11:04.603

到 127.0.0.1 的流量将由 TCP/IP 模型的 Internet 层环回，在 OSI 模型中由网络层匹配。这是发生路由和地址解析的层。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-06T14:44:46.363

我相信（尽管我很乐意得到纠正）数据实际上可能会下降到第 2 层（“数据链路层”）。

无需添加任何协议头或编码来处理环回接口，但操作系统通常会将环回接口视为真实接口，每个接口都有自己的数据包计数器等。

没有理由不能将环回接口用于非 IPv4 协议——事实上，许多当前系统会自动在环回接口上放置 IPv6 地址。

从这个意义上说，环回接口只是一个“空”的第 2 层设备。

# java - 应用程序服务器（带有 EJB）是 Java EE 客户端/服务器通信的唯一方式吗？

> ID：415841
> 
> 赞同：1
> 
> 时间：2009-01-06T08:41:15.957
> 
> 标签：java, remoting, client-server, enterprise

想象一个 Java 客户端/服务器 ERP 应用程序服务多达 100 个并发用户，包括 Web 和 Swing 客户端。对于持久性，我们可以使用 Persistence API 和 Hibernate。但是当涉及到客户端/服务器通信时，我们真的有替代使用带有 EJB 的 AS 来降低远程通信的编程成本吗？

加入 EJB 和应用程序服务器似乎是一个非常重量级的解决方案，仅用于远程处理。也有使用 RMI 的标准方式，但现在谁想自己编写所有代码......

我知道除了远程处理部分之外，您还可以通过 AS 免费获得许多功能。而且，也许这是要走的路。但是，对于企业应用程序进行客户端/服务器通信，真的有任何其他（低编程成本）替代 AS 吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-06T09:05:11.103

就我个人而言，我认为 Seam 是解决我没有的问题的最终解决方案，但除此之外，还有很多选择，其中大多数都使用 Spring：

*   [RMI](http://static.springframework.org/spring/docs/2.5.x/reference/remoting.html#remoting-rmi) ;
*   [Hessian](http://static.springframework.org/spring/docs/2.5.x/reference/remoting.html#remoting-caucho-protocols)（基于 HTTP 的二进制协议）；
*   [HTTP Invokers](http://static.springframework.org/spring/docs/2.5.x/reference/remoting.html#remoting-caucho-protocols)（基于 HTTP 的 Java 序列化）；
*   [网络服务](http://static.springframework.org/spring/docs/2.5.x/reference/remoting.html#remoting-web-services)；或者
*   甚至[JMS](http://static.springframework.org/spring/docs/2.5.x/reference/remoting.html#remoting-jms)。

基于 HTTP 的远程处理方法的优点是它们很容易插入 Spring 的安全模型。另外，您还可以访问拦截器之类的东西。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-06T08:45:11.330

您可以使用轻量级远程框架。Spring 在本节中有许多选项。

如果你问我一个词，我会建议两个。接缝或弹簧。我自己喜欢 Seam，但对于轻量级远程处理，[Spring](http://static.springframework.org/spring/docs/2.0.x/reference/remoting.html)有更多可行的解决方案和支持。同样，如果您的 AS 是 JBoss，请考虑[Seam](http://docs.jboss.com/seam/2.0.1.GA/reference/en/html/remoting.html)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-06T08:54:18.333

应用服务器是一个相当重量级的解决方案。根据您的要求，我会尝试确保您可以在简单的 servlet 容器（如 Tomcat）上运行。我发现使用[Spring-remoting](http://static.springframework.org/spring/docs/2.5.x/reference/remoting.html)而不是完整的 EJB 更容易进行远程处理。Spring-remoting 提供了对实际使用的远程处理技术的抽象。Hessian 作为轻量级协议享有盛誉。

拥有某种服务器框架（AS 或 servlet 容器）是一件好事，因为您不需要考虑所有低级问题（连接建立、线程等）。

# pki - 最佳（免费）证书管理工具

> ID：415852
> 
> 赞同：5
> 
> 时间：2009-01-06T08:49:40.840
> 
> 标签：pki

我最近下载了一个用于管理证书文件的简洁 Java 工具——比如 PEM、PFX 等。从内存中它是用 Java 编写的，但是，对于我的生活，我找不到它（清除下载列表和不明显的文件名！）。

这让我提出了一个问题——管理证书有哪些免费工具？上述工具可以生成证书并通过其 UI 显示它们。

我只是想要一些东西来跟踪我的证书，并且通常可以更轻松地查看它们的详细信息，而无需使用正式的 CA 工具或 keytool/其他命令行工具来查看我正在处理的证书。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-12T22:53:59.610

我的一位同事找到了一大堆——包括我以前用过的那个（Portecle）。谢谢谢恩！

[http://yellowcat1.free.fr/keytool_iui.html](http://yellowcat1.free.fr/keytool_iui.html)

或者这个： [http](http://www.gria.org/downloads/tpc/keytool-gui-zip/griafile_view) ://www.gria.org/downloads/tpc/keytool-gui-zip/griafile_view （显然被这个商业产品取代： [http](http://www.lazgosoftware.com/kse/) ://www.lazgosoftware.com/kse/ ）

或[http://portecle.sf.net](http://portecle.sf.net)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-06T09:14:00.180

第一个是 OpenCA。[http://www.openca.org/](http://www.openca.org/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-02-28T20:42:18.657

我已经成功尝试了这个解决方案：

[http://gnomint.sourceforge.net/](http://gnomint.sourceforge.net/)

gnoMint 是一个 X.509 证书颁发机构管理工具。

目前，它有两种不同的界面：一种用于 GTK/Gnome 环境，另一种用于命令行。

它是自由软件，在 GNU/GPL 许可下。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-06T10:23:28.467

如果您可以忍受不使用 GUI，那么[OpenSSL](http://www.openssl.org)就已经足够了。[Windows 平台](http://www.openssl.org/related/binaries.html)有二进制包。

# c++ - CFileImageLoader(LPCTSTR lpszFileName);

> ID：415854
> 
> 赞同：0
> 
> 时间：2009-01-06T08:50:44.113
> 
> 标签：c++, windows, mfc

我有一个需要 LPCTSTR 的课程。

当我打电话时： new CFileImageLoader(_T("Splash02.png")) 或 new CFileImageLoader("Splash02.png")

两者都不起作用。为什么 ？我是 cpp 的新手...谢谢乔纳森 d。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-01-12T05:06:18.173

此问题是 C++ 问题和 Windows 特定问题的组合。

C++ 定义了两种类型的字符串，常规的和宽的。常规字符串如下所示：

```
const char *str = "regular string"; 
```

而宽字符串看起来像：

```
const wchar_t *wstr = L"wide string"; 
```

仅使用标准 C++，您必须在编写库时决定是使用常规字符串还是宽字符串。

Windows 定义了一种称为 tchar 的伪类型。使用 tchar 您可以编写如下内容：

```
LPCTSTR tstr = _T("regular or wide string"); 
```

这实际上是常规 (char *) 还是宽 (wchar_t *) 字符串取决于您是否为 Unicode 编译代码。

由于该函数被指定为采用 LPCTSTR，因此需要使用适合您编译方式的类型调用它。

如果你知道你只会在有或没有 Unicode 支持的情况下进行构建，你可以跳过所有的 TCHAR 内容并分别直接使用 wchar_t 或 char。

由于`CFileImageLoader("Splash02.png")`不起作用，您必须在启用 Unicode 支持的情况下进行编译。您可以将其更改为`CFileImageLoader(L"Splash02.png")`并承诺始终使用 Unicode，或者您可以将其更改为`CFileImageLoader(_T("Splash02.png"))`并让宏魔法来完成工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-06T09:01:22.233

“两者都不起作用” - 你能不能更具体一点？

如果您使用定义的 _UNICODE 进行编译，那么第二个甚至不应该编译。

您也只是传递一个文件名，而不是完整路径。也许您的图像加载器类找不到该文件，因为它使用与您期望的不同的 CWD 路径。尝试传递完整路径。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-06T09:22:43.300

1.  可能你的图片库不支持打开 PNG 格式的文件。
2.  尝试传递完整路径。
3.  也许您需要调用图像库提供的一些初始化函数

# objective-c - 如何使用 Cocos2d 通过警报视图获取文本字段的值？

> ID：415855
> 
> 赞同：0
> 
> 时间：2009-01-06T08:53:19.770
> 
> 标签：objective-c, cocos2d-iphone

我正在尝试使用 Cocos2d 开发应用程序。我无法从 textfield 获得价值。如何使用 Cocos2d 获取文本字段的值（在警报视图中）？

```
-(void)timed1: (id)sender 
{
    UIAlertView* dialog = [[[UIAlertView alloc] init] retain];
    [dialog setDelegate:self];

    [dialog setTitle:@"Enter Time:"];
    [dialog setMessage:@" "];
    UITextField * nameField = [[UITextField alloc] initWithFrame:CGRectMake(20.0, 45.0, 245.0, 25.0)];
    [dialog addSubview:nameField];
    [nameField setBackgroundColor:[UIColor whiteColor]];
    CGAffineTransform moveUp = CGAffineTransformMakeTranslation(0.0, 70.0);
    [dialog setTransform: moveUp];
    [dialog setBackgroundColor:[UIColor clearColor]];
    [dialog addButtonWithTitle:@"Done"];
    [dialog show];

    nameField.clearButtonMode = UITextFieldViewModeWhileEditing;
    nameField.keyboardType = UIKeyboardTypeNumbersAndPunctuation;
    nameField.keyboardAppearance = UIKeyboardAppearanceAlert;
    nameField.autocapitalizationType = UITextAutocapitalizationTypeWords;

        //  timeStatus is a int type global variable
    timeStatus =[nameField.text intValue]; // this line not working i can't getting value namefield

    [dialog release];
    [nameField release];

} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-31T15:18:55.933

操作表和警报是异步处理的。在您的情况下，消息 [dialog show] 仅安排 show 事件以供稍后执行（由主运行循环处理）。如果你输入几个 NSLog()，你会看到 [show] 消息几乎立即返回，此时你的用户还没有输入任何数据，nameField 的文本是空白的，这将转换为 0 的 int .

您需要一个带有输入的阻塞模式对话框——操作表和警报不是为除了是/否/取消按钮按下之外的用户输入而设计的。您必须自己制作一个视图：不是太难，但它需要比使用操作表/警报更多的工作。

# winapi - 如何检测新的或修改的文件

> ID：415856
> 
> 赞同：1
> 
> 时间：2009-01-06T08:54:15.243
> 
> 标签：winapi, file

我发现有两种方法可以解决它，[`ReadDirectoryChangesW`](http://msdn.microsoft.com/en-us/library/windows/desktop/aa365465%28v=vs.85%29.aspx)以及[FindFirstChangeNotification](http://msdn.microsoft.com/en-us/library/windows/desktop/aa364417%28v=vs.85%29.aspx)。

我想知道它们之间有什么区别，性能还是其他？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-06T09:03:49.813

这是为 Winapi 标记的，但无论如何我还是用 .net 来试一试。

为此，您可以使用 System.IO 中的 FileSystemWatcher 类。

```
static void Main(string[] args)
{
    FileSystemWatcher fsw = new FileSystemWatcher("C:\\");
    fsw.Changed += new FileSystemEventHandler(fsw_Changed);
    fsw.Created += new FileSystemEventHandler(fsw_Created);
    fsw.Deleted += new FileSystemEventHandler(fsw_Deleted);
    fsw.EnableRaisingEvents = true;
    fsw.IncludeSubdirectories = true;
    fsw.Renamed += new RenamedEventHandler(fsw_Renamed);

    Console.Read();
}

static void fsw_Renamed(object sender, RenamedEventArgs e)
{
    Console.WriteLine("{0} was changed to {1}", e.OldName, e.Name);
}

static void fsw_Deleted(object sender, FileSystemEventArgs e)
{
    Console.WriteLine("{0} was deleted", e.Name);
}

static void fsw_Created(object sender, FileSystemEventArgs e)
{
    Console.WriteLine("{0} was created", e.Name);
}

static void fsw_Changed(object sender, FileSystemEventArgs e)
{
    Console.WriteLine("{0} was changed", e.Name);
} 
```

# c - 模拟中的存根函数

> ID：415860
> 
> 赞同：6
> 
> 时间：2009-01-06T08:56:54.880
> 
> 标签：c, embedded, simulation, mocking

我正在开发一个依赖于一些外部硬件的嵌入式 C 项目。我希望删除访问这些部分的代码，这样我就可以在不使用任何硬件的情况下模拟系统。到目前为止，我已经使用了一些宏，但这迫使我对我的生产代码进行一些更改，我想避免这种情况。

## 例子：

```
stub.h
#ifdef _STUB_HW
#define STUB_HW(name) Stub_##name
#else /*_STUB_HW*/
#define STUB_HW(name) name
#endif /*_STUB_HW*/

my_hw.c
WORD STUB_HW(clear_RX_TX)()
{ /* clear my rx/tx buffer on target HW */ }

test_my_hw.c
#ifdef _STUB_HW
WORD clear_RX_TX()
{ /* simulate clear rx/tx buffer on target HW */ } 
```

使用此代码，我可以使用预处理器标签打开/关闭存根有`_STUB_HW`

没有一种方法可以完成此操作而无需更改我的产品代码，并避免大量 ifdefs。如果可以避免的话，我不会在同一个文件中混合 prod 和 test 代码。我不在乎测试代码看起来如何，只要我可以尽可能多地避开生产代码。

## 编辑：

如果可以在不替换整个文件的情况下选择/重命名函数，那就太好了。就像把所有函数都从开始`nRF_##`并给出一个新名称然后插入`test_nRF_##`到`nRF_##`它是可能的

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-06T09:13:57.967

我只是制作了两个文件 ActualDriver.c 和 StubDriver.c 包含完全相同的函数名。通过将生产代码与不同对象链接起来的两个构建，没有命名冲突。这样，生产代码不包含测试或条件代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T12:40:58.203

正如 Gerhard 所说，使用一个通用的头文件“driver.h”和包含实际函数和存根函数的单独硬件层实现文件。

在 Eclipse 中，我有两个目标，我“从构建中排除”不使用的 driver.c 文件，并确保构建中包含正确的目标。然后 Eclipse 在构建时生成 makefile。

要指出的另一个问题是确保您定义了固定大小的整数，以便您的代码从溢出的角度来看是相同的。（尽管从您的代码示例中我可以看到您正在这样做。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-09T08:12:31.067

我同意以上所述。对此的标准解决方案是定义一组不透明的抽象函数调用，它们是硬件的“驱动程序”，然后在主程序中调用它。然后提供两种不同的驱动实现，一种用于hw，一种用于sw。sw 变体将以某种适当的方式模拟硬件的 IO 效果。

请注意，如果目标是在较低级别，即编写要模拟每个硬件访问而不是整个函数的代码，则可能会有点棘手。但是在这里，可以定义不同的“write_to_memory”和“read_from_memory”函数（或宏，如果目标速度很重要）。

在这两种情况下都不需要更改函数的名称，只需有两个不同的批处理文件、make 文件或 IDE 构建目标（取决于您使用的工具）。

最后，在许多情况下，更好的技术解决方案是使用成熟的目标系统模拟器，例如[Qemu](http://bellard.org/qemu/)、[Simics](http://www.virtutech.com)、[SystemC](http://www.systemc.org)、[CoWare](http://www.coware.com)、[VaST](http://www.vastsystems.com)或类似的。这使您可以始终运行相同的代码，而是构建一个从软件的角度来看与实际硬件一样工作的硬件模型。它确实需要更大的前期投资，但对于许多项目来说，这是非常值得的。它基本上摆脱了为目标和主机构建不同版本的讨厌问题，并确保您始终使用带有部署构建选项的交叉编译器。请注意，许多嵌入式编译器套件都内置了一些基本的此类模拟能力。

# sql - 关于sql group by的一个问题

> ID：415862
> 
> 赞同：2
> 
> 时间：2009-01-06T08:57:32.367
> 
> 标签：sql, database, postgresql

我有一个名为*正在访问*的表，如下所示：

```
id | visitor_id | visit_time 
-------------------------------------
 1 |          1 | 2009-01-06 08:45:02 
 2 |          1 | 2009-01-06 08:58:11
 3 |          1 | 2009-01-06 09:08:23 
 4 |          1 | 2009-01-06 21:55:23
 5 |          1 | 2009-01-06 22:03:35 
```

*我想制定一个可以获取用户在一个会话*内访问多少次的 sql （连续访问的间隔小于 1 小时）。

因此，对于示例数据，我想得到以下结果：

```
visitor_id | count
-------------------
         1 |     3
         1 |     2 
```

顺便说一句，我使用 postgresql 8.3。谢谢！

**UPDATE**：更新了示例数据表中的时间戳。对困惑感到抱歉。
**更新**：如果解决方案是单个 sql 查询、使用存储过程、子查询等，我并不在意。我只关心如何完成它:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-06T09:07:12.690

这个问题有点模棱两可，因为您是在假设或要求小时数将从一个设定点开始，即自然查询也表明对于所有访问之间的结果记录为 (1,2) 08:58 和 09:58 的时间。您必须“告诉”您的查询开始时间是出于某些可确定的原因访问 1 和 4，否则您将获得自然结果集：

```
visitor_id | count 
--------------------
         1 | 3
         1 | 2 <- extra result starting at visit 2
         1 | 1 <- extra result starting at visit 3
         1 | 2
         1 | 1 <- extra result starting at visit 5 
```

对于今天早上我脆弱的头脑来说，额外的逻辑将变得昂贵且过于复杂，postgres 中比我更好的人可能可以解决这个问题。

我通常想通过在表中有一个 sessionkey 列来解决这个问题，我可以出于性能原因廉价地分组，但我认为还有一个逻辑问题。从时间获取会话信息对我来说似乎很危险，因为我不相信用户在一个小时的*活动*后肯定会被注销。大多数会话系统通过在一段时间*不活动*后使会话到期来工作，即很有可能 9:45 之后的访问将在同一会话中，因为您的每小时时间段将在 9:08 重置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T10:07:29.370

这个问题似乎有点模糊。

它变得更加复杂，因为 id 3 在 id 1 和 2 的一个小时内，但如果用户在 9:50 访问过，那么这将是在 2 的一个小时内，而不是 1 的一个小时内。

您似乎在平滑总数之后 - 对于给定的访问，接下来的一小时内有多少次访问？

也许您应该询问有多少次访问距离不到一小时的后续访问？如果一次访问距离前一次访问不到一小时，那么它应该“计数”吗？

因此，您可能想要的是您有多少链，其中链接少于任意数量（因此假设的 9:50 访问将包含在以 id 1 开头的链中）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-06T12:05:43.657

### 没有简单的解决方案

没有办法在单个 SQL 语句中执行此操作。
以下是 2 个想法：一个使用循环来计算访问次数，另一个更改`visiting`表格的填充方式。

### 循环解决方案

但是，使用循环可以轻松完成。
（我试图让 postgresql 语法正确，但我不是专家）

```
/* find entries where there is no previous entry for */ 
/* the same visitor within the previous hour:        */ 

select v1.* , 0 visits 
into temp_table
from visiting v1
where not exists ( select 1 
                   from   visiting v2
                   where  v2.visitor_id = v1.visitor_id 
                   and    v2.visit_time < v1.visit_time 
                   and    v1.visit_time - interval '1 hour' <     v2.visit_time 
                 )  
select @rows = @@rowcount 

while @rows > 0 
begin
    update temp_table
    set    visits = visits + 1 , 
           last_time = v.visit_time 
    from   temp_table t , 
           visiting   v 
    where  t.visitor_id = v.visitor_id 
    and    v.visit_time - interval '1 hour' < t.last_time
    and    not exists ( select 1 
                        from   visiting v2 
                        where  v2.visitor_id = t.visitor_id 
                        and    v2.visit_time between t.last_time and v.visit_time 
                      ) 

    select @rows = @@rowcount 
end

/* get the result: */ 

select visitor_id, 
       visits 
from temp_table 
```

这里的想法是这样做：

*   在一小时内获得所有没有事先访问的访问。
    *   这标识了会话
*   循环，为这些“首次访问”中的每一个获取下一次访问
    *   直到不再有“下一次访问”
*   现在您可以读取每个会话中的访问次数。

### 最好的解决方案？

我建议：

*   在表中添加一列`visiting`：`session_id int not null`
*   更改制作条目的过程，以便检查当前访问者的上一次访问是否不到一小时前。如果是这样，它设置为与之前访问 `session_id` 的相同。 `session id` 如果没有，它会生成一个新的 `session_id` .
*   您可以将此逻辑放入触发器中。

然后您的原始查询可以通过以下方式解决：

```
SELECT session_id, visitor_id, count(*)
FROM   visiting 
GROUP BY session_id, visitor_id 
```

希望这可以帮助。如果我犯了错误（我确定我有），请发表评论，我会纠正它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-06T13:27:16.287

PostgreSQL 8.4 将有一个窗口功能，到那时我们可以消除创建临时表只是为了模拟行号（序列目的）

```
create table visit
(
visitor_id int not null,
visit_time timestamp not null
);

insert into visit(visitor_id, visit_time) 
values
(1, '2009-01-06 08:45:02'),
(2, '2009-02-06 08:58:11'),
(1, '2009-01-06 08:58:11'),
(1, '2009-01-06 09:08:23'),
(1, '2009-01-06 21:55:23'),
(2, '2009-02-06 08:59:11'),
(2, '2009-02-07 00:01:00'),
(1, '2009-01-06 22:03:35');

create temp table temp_visit(visitor_id int not null, sequence serial not null, visit_time timestamp not null);
insert into temp_visit(visitor_id, visit_time) select visitor_id, visit_time from visit order by visitor_id, visit_time;

select 
    reference.visitor_id, count(nullif(reference.visit_time - prev.visit_time < interval '1 hour',false))
from temp_visit reference
left join temp_visit prev 
on prev.visitor_id = reference.visitor_id and prev.sequence = reference.sequence - 1
group by reference.visitor_id; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-06T09:06:37.730

这些中的一种或两种可能有效？但是，两者最终都会在结果中为您提供比您要求的更多的列。

```
SELECT visitor_id,
       date_part('year', visit_time),
       date_part('month', visit_time),
       date_part('day', visit_time),
       date_part('hour', visit_time),
       COUNT(*)
  FROM visiting
 GROUP BY 1, 2, 3, 4, 5;

SELECT visitor_id,
       EXTRACT(EPOCH FROM visit_time)-(EXTRACT(EPOCH FROM visit_time) % 3600),
       COUNT(*)
  FROM visiting
 GROUP BY 1, 2; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-06T09:08:59.473

这不能在单个 SQL 中完成。更好的选择是在存储过程中处理它

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-06T09:24:31.860

如果是 T-SQL，我会这样写：

```
SELECT  visitor_id, COUNT(id), 
        DATEPART(yy, visit_time), DATEPART(m, visit_time), 
        DATEPART(d, visit_time), DATEPART(hh, visit_time)
FROM visiting
GROUP BY
    visitor_id, 
    DATEPART(yy, visit_time), DATEPART(m, visit_time), 
    DATEPART(d, visit_time), DATEPART(hh, visit_time) 
```

这给了我：

```
1   3   2009    1   6   8
1   2   2009    1   6   21 
```

不过，我不知道如何或是否可以在 postgre 中编写此内容。

# java - 如何在 JBoss 中预览服务器上的文件

> ID：415863
> 
> 赞同：0
> 
> 时间：2009-01-06T08:57:44.630
> 
> 标签：java, javascript, jboss, seam, preview

我需要一些关于如何最好地解决这个问题的想法。

我有一个在 JBoss 4.3.3 上运行的 JBoss Seam 应用程序 这个应用程序的一小部分是基于 Open Office 模板生成一个 html 和一个 pdf 文档。

我将生成的文件放在文件系统的 /tmp/ 中。我尝试过使用 System.getProperties("tmp.dir") 和其他一些选项，它们总是返回 $JBOSS_HOME/bin 我想选择路径 $JBOSS_HOME/$DEPLOY/myEAR.ear/myWAR.war/WhateverLocationHere/

但是，我不知道如何在不提供绝对路径或设置 $JBOSS_HOME 和 $DEPLOY 的情况下以编程方式选择路径。

```
有人知道我该怎么做吗？
```

第二个问题；我想轻松预览这些生成的文件。通过 JavaScript，或者任何最简单的方法。但是，JavaScript 无法访问服务器上的文件系统，因此我无法通过 JavaScript 打开文件。

```
有什么简单的解决方案吗？
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-06T10:10:29.070

不确定我是否完全了解您要达到的目标，但无论如何我都会尝试一下：

我的假设是您的最终目标是通过 Web 应用程序向最终用户提供一些文件（PDF、HTML）。

在这种情况下，为什么不让 Apache 将这些文件提供给最终用户，所以您只需要 JBOSS 应用程序知道映射到 Apache 虚拟主机的目录的路径。

所以基本上，创建一个文件并将其保存为 /var/www/html/myappfiles/tempfile.pdf （您的应用程序知道的文件夹），然后将[http://mydomain.com/myappfiles](http://mydomain.com/myappfiles)（一个 Apache 虚拟主机）提供给您的用户。其余的将由 Web 服务器完成。

您必须设置环境变量或系统属性，以让您的应用程序知道您的文件夹所在的位置（本例中为 /var/www/html/myappfiles/）。

希望我没有离开:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-07T19:04:46.307

1.  我同意彼得（哟彼得！）。将目录放在您的 WAR 之外并设置一个指向它的环境变量。阅读 Jacob Orshalick 的[这篇文章](http://solutionsfit.com/blog/2008/06/17/managing-environment-specific-configuration-with-seam/)，了解如何在 Seam 中配置环境变量：

2.  至于预览 PDF，请查看 Google Docs 如何处理预览 PDF - 它将它们显示为图像。要使用 Java 执行此操作，请查看[Sun PDF Renderer](https://pdf-renderer.dev.java.net/ "Sun PDF 渲染器")。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-08T22:19:09.207

不确定如何生成 PDF，但如果可能，请一起跳过磁盘 IO，将 PDF 内容存储在 a 中`byte[]`，然后在 servlet 中将其刷新给用户，将 mime 类型设置为`application/pdf`* 以响应指定的 URL通过客户端中的链接或`<div>`通过javascript动态设置。无论如何，您可能会受到内存冲击，除了跳过 IO 之外，您不必担心在完成预览后删除 tmp 文件。

*****我认为这是正确的。需要查一下。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-06T15:58:02.910

我不确定这是否适用于 JBoss，因为您想要 WAR 存档中的路径，但您可以尝试使用[ServletContext.getRealPath(String)](http://java.sun.com/javaee/5/docs/api/javax/servlet/ServletContext.html#getRealPath(java.lang.String))。

但是，我个人不希望生成的文件位于我部署的应用程序中；相反，我会在某个地方配置一个外部数据目录`$JBOSS_HOME/server/default/data/myapp`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-10T18:00:35.383

*   首先，大多数平台用于`java.io.tmpdir`设置临时目录。一些 servlet 容器将这个属性重新定义为它们的树下的东西。为什么你关心文件的写入位置？
*   其次，我同意 Nicholas 的观点：在服务器端生成 PDF 后，您可以生成一个 URL，单击该 URL 时，将文件发送到浏览器。如果你使用 MIME type `application/pdf`，浏览器应该用它做正确的事情。

# c# - Lambda表达式，如何在对象内部搜索？

> ID：415866
> 
> 赞同：7
> 
> 时间：2009-01-06T08:59:04.173
> 
> 标签：c#, lambda

我开始喜欢 Lambda 表达式，但我很难通过这堵墙：

```
public class CompanyWithEmployees {
    public CompanyWithEmployees() { }
    public Company CompanyInfo { get; set; }
    public List<Person> Employees { get; set; }
} 
```

我的搜索：

```
List<CompanyWithEmployees> companiesWithEmployees = ws.GetCompaniesWithEmployees();
CompanyWithEmployees ces = companiesWithEmployees
        .Find(x => x.Employees
        .Find(y => y.PersonID == person.PersonID)); 
```

所以，我想得到对象“CompanyWithEmployees”，它有我正在寻找的那个人（员工），但我得到“*不能隐式转换'人'到'布尔'）* ”这是正确的，但如果我'没有传递 Person 对象，第一个 Find 怎么执行？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-06T09:06:28.980

因为你想检查存在，也许尝试：

```
ces = companiesWithEmployees
        .Find(x => x.Employees
        .Find(y => y.ParID == person.ParID) != null); 
```

这将检查任何`Person`具有相同的`ParID`; 如果您的意思是相同的`Person`实例（参考），那么`Contains`就足够了：

```
ces = companiesWithEmployees
        .Find(x => x.Employees.Contains(person)); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-06T09:08:00.583

`Find()`返回找到的对象。用于`Any()`仅检查表达式对于任何元素是否为真。

```
var ces = companiesWithEmployees
    .Find(x => x.Employees
    .Any(y => y.PersonID == person.PersonID)); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-06T09:06:35.437

```
ces = companiesWithEmployees
    .First(x => x.Employees.Any(p=>p.PersonID == person.PersonID)); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-06T11:35:49.083

```
ces = companiesWithEmployees.Find( x => x.Employees.Find(...) ); 
```

`.Find`只返回***一个***对象，`x.Employees.Find(..)`返回`Person`.

`.Find`需要布尔参数（即条件的结果），这就是为什么有一个编译器错误说`Cannot implicit convert 'Person' To 'bool'`

`.Where`可以返回多个对象，因此**可以遍历所有**列表。

在您的情况下使用`.Where`和的组合。`.Any`

`.Where`以下代码将说明、`.Find`和之间的区别`.Any`：

```
public partial class Form2 : Form {
    public Form2() {
        InitializeComponent();
        var companiesWithEmployees = new List<CompanyWithEmployees>() {                
            new CompanyWithEmployees {                 
                CompanyInfo = new Company { CompanyName = "Buen" },
                Employees = new List<Person>()  { 
                    new Person { PersonID = 1976, PersonName = "Michael" },
                    new Person { PersonID = 1982, PersonName = "Mark" },
                    new Person { PersonID = 1985, PersonName = "Matthew" },                            
                    new Person { PersonID = 1988, PersonName = "Morris" }
                }
            },
            new CompanyWithEmployees {
                CompanyInfo = new Company { CompanyName = "Muhlach" },
                Employees = new List<Person>() {
                    new Person { PersonID = 1969, PersonName = "Aga" },
                    new Person { PersonID = 1971, PersonName = "Nino" },
                    new Person { PersonID = 1996, PersonName = "Mark" }
                }
            },
            new CompanyWithEmployees {
                CompanyInfo = new Company { CompanyName = "Eigenmann" },
                Employees = new List<Person>() {
                    new Person { PersonID = 1956, PersonName = "Michael" },                        
                    new Person { PersonID = 1999, PersonName = "Gabby" }
                }
            }
        };

        // just explicitly declared the types (instead of var) so the intent is more obvious

        IEnumerable<CompanyWithEmployees> whereAreMichaels = companiesWithEmployees
            .Where(cx => cx.Employees.Any(px => px.PersonName == "Michael"));

        string michaelsCompanies = string.Join(", ", whereAreMichaels
            .Select(cx => cx.CompanyInfo.CompanyName).ToArray());

        MessageBox.Show("Company(s) with employee Michael : " + michaelsCompanies);

        Person findAga = companiesWithEmployees
            .Find(company => company.CompanyInfo.CompanyName == "Muhlach")
            .Employees.Find(person => person.PersonName == "Aga");

        if (findAga != null)
            MessageBox.Show("Aga's ID : " + findAga.PersonID.ToString());
    }
}

class CompanyWithEmployees { 
    public Company CompanyInfo { get; set; }
    public List<Person> Employees { get; set; }
}
class Company {
    public string CompanyName { get; set; }
}
class Person {
    public int PersonID { get; set; }
    public string PersonName { get; set; }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-06T09:06:48.697

那是因为您没有为顶级 Find 指定合法的 Find 表达式。

我会在这里展示它：

```
ces = companiesWithEmployees
    .Find (x => x.Employees.Find(y => y.ParID == Person.ParID) /*condition is missing here*/); 
```

那么你最初发现的条件是什么？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-06T12:25:47.830

最简单的是

```
ces = companiesWithEmployees.FirstOrDefault(x => 
          x.Employees.Any(y => y.PersonID == person.ParID)); 
```

没有任何空检查

# php - 从 PHP 获取变量到 JavaScript

> ID：415868
> 
> 赞同：56
> 
> 时间：2009-01-06T09:02:11.983
> 
> 标签：php, javascript

我想在 JavaScript 中使用 PHP 变量。这怎么可能？

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2009-01-06T09:07:27.557

您可以在创建页面时将 PHP 变量打印到 javascript 中。

```
<script type="text/javascript">
    var MyJSStringVar = "<?php Print($MyPHPStringVar); ?>";
    var MyJSNumVar = <?php Print($MyPHPNumVar); ?>;
</script> 
```

当然，这是针对*简单*变量而不是对象。

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2009-01-06T09:08:10.257

您可以通过使用 PHP 生成它来将 PHP 变量传递给您的 JavaScript：

```
<?php
$someVar = 1;
?>

<script type="text/javascript">
    var javaScriptVar = "<?php echo $someVar; ?>";
</script> 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-01-06T09:08:28.633

这取决于您想在 Javascript 中使用哪种类型的 PHP 变量。例如，具有类方法的整个 PHP 对象不能在 Javascript 中使用。但是，您可以使用内置的 PHP [JSON](http://en.wikipedia.org/wiki/JSON)（JavaScript 对象表示法）函数将简单的 PHP 变量转换为 JSON 表示。欲了解更多信息，请阅读以下链接：

*   [PHP JSON 手册](http://www.php.net/json)
*   [PHP`json_encode`函数](http://www.php.net/manual/en/function.json-encode.php)
*   [PHP`json_decode`函数](http://www.php.net/manual/en/function.json-decode.php)

您可以生成 PHP 变量的 JSON 表示，然后在页面加载时将其打印到 Javascript 代码中。例如：

```
<script type="text/javascript">
  var foo = <?php echo json_encode($bar); ?>;
</script> 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-01-06T09:09:34.963

我认为最简单的方法是在您的网页中包含[jQuery](http://jquery.com/) javascript 库，然后使用[JSON](http://json.org/)作为格式在两者之间传递数据。

在您的 HTML 页面中，您可以像这样从 PHP 脚本请求数据：

```
$.getJSON('http://foo/bar.php', {'num1': 12, 'num2': 27}, function(e) {
    alert('Result from PHP: ' + e.result);
}); 
```

在 bar.php 中，您可以这样做：

```
$num1 = $_GET['num1'];
$num2 = $_GET['num2'];
echo json_encode(array("result" => $num1 * $num2)); 
```

这就是通常所说的 AJAX，它有助于为网页提供更加动态和类似桌面的感觉（您不必刷新整个页面即可与 PHP 通信）。

其他技术更简单。正如其他人所建议的那样，您可以简单地从您的 PHP 脚本生成变量数据：

```
$foo = 123;
echo "<script type=\"text/javascript\">\n";
echo "var foo = ${foo};\n";
echo "alert('value is:' + foo);\n";
echo "</script>\n"; 
```

现在大多数网页都使用这两者的组合。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2013-11-19T01:46:08.377

```
<?php 
$j=1;
?>
<script>
var i = "<?php echo $j; ?>";
//Do something
</script>
<?php
echo $j;
?> 
```

这是在没有 Ajax 的情况下将 php 变量传递给 javascript 的最简单方法。

你也可以使用这样的东西：

```
var i = "<?php echo json_encode($j); ?>"; 
```

据说这更安全或更安全。我认为

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2012-09-18T01:22:05.727

更新：我完全重写了这个答案。旧代码仍然存在，在底部，但我不推荐它。

* * *

您可以通过两种主要方式获取访问`GET`变量：

1.  通过 PHP 的`$_GET`数组（关联数组）。
2.  通过 JavaScript 的`location`对象。

使用 PHP，您可以创建一个“模板”，如下所示：

```
<script type="text/javascript">
var $_GET = JSON.parse("<?php echo json_encode($_GET); ?>");
</script> 
```

但是，我认为这里的语言混合是草率的，应该尽可能避免。无论如何，我真的想不出在 PHP 和 JavaScript 之间混合数据的任何充分理由。

这真的归结为：

*   如果可以通过 JavaScript 获取数据，请使用 JavaScript。
*   如果无法通过 JavaScript 获取数据，请使用 AJAX。
*   如果您需要与服务器通信，请使用 AJAX。

由于我们在这里谈论`$_GET`（或者至少我*假设*我们在写原始答案时是这样），所以您应该通过 JavaScript 获取它。

在原始答案中，我有两种获取查询字符串的方法，但它太混乱且容易出错。这些现在在这个答案的底部。

无论如何，我设计了一个不错的小“类”来获取查询字符串（实际上是一个对象构造函数，请参阅MDN 的 OOP 文章[中的相关部分](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Introduction_to_Object-Oriented_JavaScript#The_constructor)）：

```
function QuerystringTable(_url){
    // private
    var url   = _url,
        table = {};

    function buildTable(){
        getQuerystring().split('&').filter(validatePair).map(parsePair);
    }

    function parsePair(pair){
        var splitPair = pair.split('='),
            key       = decodeURIComponent(splitPair[0]),
            value     = decodeURIComponent(splitPair[1]);

        table[key] = value;
    }

    function validatePair(pair){
        var splitPair = pair.split('=');

        return !!splitPair[0] && !!splitPair[1];
    }

    function validateUrl(){
        if(typeof url !== "string"){
            throw "QuerystringTable() :: <string url>: expected string, got " + typeof url;
        }

        if(url == ""){
            throw "QuerystringTable() :: Empty string given for argument <string url>";
        }
    }

    // public
    function getKeys(){
        return Object.keys(table);
    }

    function getQuerystring(){
        var string;

        validateUrl();
        string = url.split('?')[1];

        if(!string){
            string = url;
        }

        return string;
    }

    function getValue(key){
        var match = table[key] || null;

        if(!match){
            return "undefined";
        }

        return match;
    }

    buildTable();
    this.getKeys        = getKeys;
    this.getQuerystring = getQuerystring;
    this.getValue       = getValue;
} 
```

[JSFiddle 演示](https://jsfiddle.net/B1KMusic/nq47nxg9/)

```
function main(){
    var imaginaryUrl = "http://example.com/webapp/?search=how%20to%20use%20Google&the_answer=42",
        qs = new QuerystringTable(imaginaryUrl);

    urlbox.innerHTML = "url: " + imaginaryUrl;

    logButton(
        "qs.getKeys()",
        qs.getKeys()
        .map(arrowify)
        .join("\n")
    );

    logButton(
        'qs.getValue("search")',
        qs.getValue("search")
        .arrowify()
    );

    logButton(
        'qs.getValue("the_answer")',
        qs.getValue("the_answer")
        .arrowify()
    );

    logButton(
        "qs.getQuerystring()",
        qs.getQuerystring()
        .arrowify()
    );
}

function arrowify(str){
    return "  -> " + str;
}

String.prototype.arrowify = function(){
    return arrowify(this);
}

function log(msg){
    txt.value += msg + '\n';
    txt.scrollTop = txt.scrollHeight;
}

function logButton(name, output){
    var el = document.createElement("button");

    el.innerHTML = name;

    el.onclick = function(){
        log(name);
        log(output);
        log("- - - -");
    }

    buttonContainer.appendChild(el);
}

function QuerystringTable(_url){
    // private
    var url = _url,
        table = {};

    function buildTable(){
        getQuerystring().split('&').filter(validatePair).map(parsePair);
    }

    function parsePair(pair){
        var splitPair = pair.split('='),
            key       = decodeURIComponent(splitPair[0]),
            value     = decodeURIComponent(splitPair[1]);

        table[key] = value;
    }

    function validatePair(pair){
        var splitPair = pair.split('=');

        return !!splitPair[0] && !!splitPair[1];
    }

    function validateUrl(){
        if(typeof url !== "string"){
            throw "QuerystringTable() :: <string url>: expected string, got " + typeof url;
        }

        if(url == ""){
            throw "QuerystringTable() :: Empty string given for argument <string url>";
        }
    }

    // public
    function getKeys(){
        return Object.keys(table);
    }

    function getQuerystring(){
        var string;

        validateUrl();
        string = url.split('?')[1];

        if(!string){
            string = url;
        }

        return string;
    }

    function getValue(key){
        var match = table[key] || null;

        if(!match){
            return "undefined";
        }

        return match;
    }

    buildTable();
    this.getKeys        = getKeys;
    this.getQuerystring = getQuerystring;
    this.getValue       = getValue;
}

main();
```

```
#urlbox{
    width: 100%;
    padding: 5px;
    margin: 10px auto;
    font: 12px monospace;
    background: #fff;
    color: #000;
}

#txt{
    width: 100%;
    height: 200px;
    padding: 5px;
    margin: 10px auto;
    resize: none;
    border: none;
    background: #fff;
    color: #000;
    displaY:block;
}

button{
    padding: 5px;
    margin: 10px;
    width: 200px;
    background: #eee;
    color: #000;
    border:1px solid #ccc;
    display: block;
}

button:hover{
    background: #fff;
    cursor: pointer;
}
```

```
<p id="urlbox"></p>
<textarea id="txt" disabled="true"></textarea>
<div id="buttonContainer"></div>
```

它更加健壮，不依赖正则表达式，结合了前两种方法的最佳部分，并且将验证您的输入。您可以为它提供查询字符串而不是来自 url 的查询字符串，如果您输入错误，它将大声失败。此外，就像一个好的对象/模块一样，它不知道也不关心类定义之外的任何东西，因此它可以与任何东西一起使用。

构造函数自动填充其内部表并解码每个字符串`...?foo%3F=bar%20baz&ampersand=this%20thing%3A%20%26`，例如，将在内部变为：

```
{
    "foo?"      : "bar baz",
    "ampersand" : "this thing: &"
} 
```

所有工作都在实例化时为您完成。

以下是如何使用它：

```
var qst = new QuerystringTable(location.href);
qst.getKeys()        // returns an array of keys
qst.getValue("foo")  // returns the value of foo, or "undefined" if none.
qst.getQuerystring() // returns the querystring 
```

那好多了。将 url 部分留给程序员既允许在非浏览器环境中使用它（在`node.js`和中测试`a browser`），也允许您可能想要比较两个不同的查询字符串的场景。

```
var qs1 = new QuerystringTable(/* url #1 */),
    qs2 = new QuerystringTable(/* url #2 */);

if (qs1.getValue("vid") !== qs2.getValue("vid")){
    // Do something
} 
```

* * *

正如我上面所说，这个答案引用了两种混乱的方法。我把它们放在这里，这样读者就不必翻阅修订历史来找到它们。他们来了：

> 1) `Direct parse by function`。这只是抓取 url 并直接用 RegEx 解析它
> 
> ```
> $_GET=function(key,def){
>     try{
>         return RegExp('[?&;]'+key+'=([^?&#;]*)').exec(location.href)[1]
>     }catch(e){
>         return def||''
>     }
> } 
> ```
> 
> Easy peasy，如果查询字符串是`?ducksays=quack&bearsays=growl`，那么`$_GET('ducksays')`应该返回`quack`并且`$_GET('bearsays')`应该返回`growl`
> 
> 现在您可能会立即注意到，由于是函数，语法有所不同。不是`$_GET[key]`，而是`$_GET(key)`。嗯，我想到了：）
> 
> 第二种方法来了：
> 
> * * *
> 
> 2)`Object Build by Loop`
> 
> ```
> onload=function(){
>     $_GET={}//the lack of 'var' makes this global
>     str=location.search.split('&')//not '?', this will be dealt with later
>     for(i in str){
>         REG=RegExp('([^?&#;]*)=([^?&#;]*)').exec(str[i])
>         $_GET[REG[1]]=REG[2]
>     }
> } 
> ```
> 
> 看哪！$_GET 现在是一个包含 url 中每个对象的索引的对象，所以现在这是可能的：
> 
> ```
> $_GET['ducksays']//returns 'quack' 
> ```
> 
> 这是可能的
> 
> ```
> for(i in $_GET){
>     document.write(i+': '+$_GET[i]+'<hr>')
> } 
> ```
> 
> 这绝对是*不可能*的功能。

* * *

同样，我不推荐这个旧代码。写的很糟糕。

# c++ - Windows Mobile WAP 唤醒

> ID：415879
> 
> 赞同：1
> 
> 时间：2009-01-06T09:06:17.107
> 
> 标签：c++, windows-mobile, compact-framework, sms, sendmessage

谁能给我指示，或者更好的工作示例，在 Windows Mobile 中使用“WAP 唤醒”功能？

我正在尝试遵循[http://msdn.microsoft.com/en-us/library/aa919167.aspx](http://msdn.microsoft.com/en-us/library/aa919167.aspx)的指示。不幸的是，他们只是给出了解决方案的开始。

第 1 步：注册您的应用程序以收听来自特定端口的 SMS 消息。

第 2 步：向该端口发送 SMS 消息

第三步：应用打开并向应用监听类窗口发送消息

第 4 步：接收该消息并冒泡一个事件

我对第2-4步一无所知..这些甚至是正确的步骤吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-07T00:19:01.150

我自己没有这样做，但我在一个类似的领域工作过。

有两种发送 WAP SMS 消息的方法（基本上是二进制[无线数据报协议 (WDP)](http://www.openmobilealliance.org/tech/affiliates/wap/wap-259-wdp-20010614-a.pdf)格式的二进制 SMS 消息）

1.  通过电话使用[WAP api](http://msdn.microsoft.com/en-us/library/aa920063.aspx)。
2.  使用 SMS 网关。

短信网关允许您从互联网发送短信。如果您在网上搜索 SMS 网关，您应该会得到很多。选择一个支持发送二进制 SMS 消息的。

作为 WDP 标头的一部分，您必须指定一个端口号，这是他们继续使用的端口号。

在发送短信之前，您需要与您的蜂窝提供商确认他们支持二进制短信，但并非所有蜂窝网络都支持。

其余部分几乎遵循[Microsoft 示例](http://msdn.microsoft.com/en-us/library/aa919421.aspx)：

> 1.  创建注册表设置。
> 2.  WDP SMS 消息通过端口 WDPport1 到达 WDP 层。
> 3.  WDP 层检查应用程序是否在端口号 WDPport1 上向 WDP 层注册。在这种情况下，没有应用程序被注册。
> 4.  应用程序检查注册表以确定是否有任何应用程序注册了端口 WDPport1 上的 WDP 消息。应用程序发现 Chess.exe 应用程序已注册。
> 5.  如果 Chess.exe 已加载，应用程序将启动 Chess.exe。
> 6.  国际象棋应用程序打开“ListenerWnd”侦听器窗口类。
> 7.  "ListenerWnd" 接收到带有 DWORD 值的消息
> 8.  Chess.exe 将此消息识别为表示 WDP 消息正在端口 WDPport1 上等待的指示，并将 WDPport1 注册为它在 WDP 层中自己的。
> 9.  Chess.exe 接收并处理等待的 WDP 消息。
> 10.  Chess.exe 关闭。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-11T16:48:20.680

我按照所有规则发送了一个二进制短信，创建了一个注册表设置，应用程序......所有这些都是在微软论坛上写的关于 WAP 唤醒的......但是当手机收到短信时，它直接进入收件箱......可能任何人都可以告诉哪些方面需要指出..因为..这个问题需要3天..这不好:-(

# unicode - 如何确定我正在查看的代码页？

> ID：415887
> 
> 赞同：0
> 
> 时间：2009-01-06T09:08:00.600
> 
> 标签：unicode, codepages

我有一个设备，里面有一些关于如何发送文本的文档。它使用 0x00-0x7F 发送“特殊”字符，如重音字符、欧元符号……

我猜他们复制了现有的代码页并进行了一些更改，但我不知道如何找出最接近我文档中的代码页的代码页。

理论上，这应该很容易做到。例如，他们将 Á 映射到 0x41，所以如果我能找到某种方法来遍历所有代码页并找到在那个位置有这个字符的那些，那将是小菜一碟。

但是，我在互联网上只能找到指向代码页转储的链接，就像我正在查看的那样，或者使用启发式方法读取文本并猜测最可能的代码页的软件。肯定有人可以查看一个正在查看的代码页吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-06T14:14:21.730

If it uses `0x00` to `0x7F` for the "special" characters, how does it encode the regular ASCII characters?

In most of the charsets that support the character `Á`, its codepoint is 193 (`0xC1`). If you subtract 128 from that, you get 65 (`0x41`). Maybe your "codepage" is just the upper half of one of the standard charsets like ISO-8859-1 or windows-1252, with the high-order bit set to zero instead of one (that is, subtracting 128 from each one).

If that's the case, I would expect to find a flag you can set to tell it whether the next bunch of codepoints should be converted using the "upper" or "lower" encoding. I don't know of any system that uses that scheme, but it's the most sensible explanation I can come with for the situation you describe.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T14:19:14.217

What endian is the system? Perhaps you're flipping bit orders?

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-06T09:14:40.647

如果没有其他信息，就无法自动检测代码页。在显示层下面，它只是字节，所有字节都是平等的。没有办法说“我是这个和那个代码页的 0x41”，只有“我是 0x41。给我看看！”</p>

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-14T15:35:39.587

有点随机的想法，但是如果您可以从设备上复制大量文本，您可以尝试通过类似[http://chardet.feedparser.org/](http://chardet.feedparser.org/)`detect`中的函数来运行它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-06T10:03:09.507

在大多数代码页中，0x41 只是普通的“A”，我不认为任何[标准代码页](http://www.i18nguy.com/unicode/codepages.html)在那个位置都有“Á”。它可能在添加重音的 A 之前的某处有一个控制字符，或者使用非标准代码页。

我认为知道“最近的代码页”没有任何用处，您只需要使用设备随附的文档即可。

您的最后一句话令人费解，您所说的“可能查看一个正在查看的代码页”是什么意思？

如果您包含整个代码页，那么这里的人可能会更有帮助，并让您更深入地了解这个问题，拥有一个数据点 0x41=Á 并没有多大帮助。

# flash - 基于 Flash 的嵌入式 mp3 播放器

> ID：415889
> 
> 赞同：7
> 
> 时间：2009-01-06T09:08:27.883
> 
> 标签：flash, streaming, mp3

我需要提供音频内容（虽然不是音乐，更像是播客；人类语音），我正在考虑使用基于 Flash 的播放器让用户无需下载即可听到内容。

我需要一个基于 Flash 的免费 mp3 播放器。有什么建议么？

因为它不是音乐，所以我不在乎播放列表（我不想要它们，它们会妨碍我），而且我需要一个搜索栏（如果你这么称呼它的话），我也不想要它显示文件名或标题任何类似的疯狂的东西，只是一个播放/暂停按钮和一个搜索栏。

或者，或者，如果它不是很复杂，我可能会尝试自己制作一个。有没有人有建造这样一个东西的经验让我了解它会有多难？

**更新** 我正在看这个[http://www.macloo.com/examples/audio_player/](http://www.macloo.com/examples/audio_player/)

不过，我不知道是谁制作的，也不知道它是否免费？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-06T11:55:30.603

您找到的播放器也可以从这个页面获得：[http](http://wpaudioplayer.com/standalone) ://wpaudioplayer.com/standalone （这可能是更新的版本），它是在 MIT 许可下发布的（例如它是免费的）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-21T11:54:13.917

您可以使用[Dewplayer](http://www.alsacreations.fr/dewplayer-en)或[Flash Mp3 播放器](http://flash-mp3-player.net/)

两者都是免费的和好的

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-07T05:53:19.463

[我喜欢1pixelout](http://www.1pixelout.net/code/audio-player-wordpress-plugin/)的 flash mp3 播放器，这里有[教程](http://www.macloo.com/examples/audio_player/)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-04T08:39:34.630

我会推荐 A2 mp3 播放器 - [http://flashstall.com/7](http://flashstall.com/7)。它是在几天前发布的。

# java - 如何从 XFire AbstractHandler 的 invoke() 方法中获取 ServletRequest 对象？

> ID：415896
> 
> 赞同：2
> 
> 时间：2009-01-06T09:11:10.017
> 
> 标签：java, web-services, spring, remoting, xfire

我使用 XFire 作为 Spring Remoting 的 Web 服务提供者。我正在使用 AbstractHandler 来验证 SOAP 请求。这个想法是通过原始服务器的域和 API 密钥（a-la Google Maps）来识别请求。唯一的问题是，我似乎无法找到从仅接受 MessageContext 对象的 invoke() 方法中获取 ServletRequest 对象的方法。

我能想到的唯一想法是使用过滤器并将请求对象存储在 ThreadLocal 变量中，但我真的更愿意避免这种解决方案。

有任何想法吗？

干杯

晒

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-06T19:12:33.513

我还没有对此进行测试，但我手边有 XFire 的源代码，所以我深入研究了这些课程，看看这是否容易。从对您的调用中，`invoke`您应该能够`ServletRequest`使用以下代码获得：

```
ServletRequest request = (ServletRequest) context.getProperty(org.codehaus.xfire.transport.http.XFireServletController.HTTP_SERVLET_REQUEST); 
```

# mysql - 如何设置mysql查询的最大执行时间？

> ID：415905
> 
> 赞同：37
> 
> 时间：2009-01-06T09:15:24.640
> 
> 标签：mysql, sql, time, limit

我想为 php 中的 set_time_limit() 等 sql 查询设置最大执行时间。我能怎么做 ？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2014-04-27T03:51:52.713

我以为它已经存在了一段时间，但[据此](http://mysqlserverteam.com/server-side-select-statement-timeouts/)，

> MySQL 5.7.4 引入了为顶级只读 SELECT 语句设置服务器端执行时间限制的能力，以毫秒为单位。

```
SELECT 
/*+ MAX_EXECUTION_TIME(1000) */ --in milliseconds
* 
FROM table; 
```

请注意，这只适用于只读 SELECT 语句。

**更新：**此变量在 MySQL 5.7.4 中添加并`max_execution_time`在 MySQL 5.7.8 中重命名为。（[来源](https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_max_execution_time)）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2014-04-27T05:38:31.640

如果您使用的是[mysql 本机驱动程序](http://www.php.net/manual/en/book.mysqlnd.php)（自 php 5.3 起常见）和[mysqli](http://www.php.net/manual/en/class.mysqli.php)扩展，您可以使用异步查询来完成此操作：

```
<?php

// Heres an example query that will take a long time to execute.
$sql = "
    select *
    from information_schema.tables t1
    join information_schema.tables t2
    join information_schema.tables t3
    join information_schema.tables t4
    join information_schema.tables t5
    join information_schema.tables t6
    join information_schema.tables t7
    join information_schema.tables t8
";

$mysqli = mysqli_connect('localhost', 'root', '');
$mysqli->query($sql, MYSQLI_ASYNC | MYSQLI_USE_RESULT);
$links = $errors = $reject = [];
$links[] = $mysqli;

// wait up to 1.5 seconds
$seconds = 1;
$microseconds = 500000;

$timeStart = microtime(true);

if (mysqli_poll($links, $errors, $reject, $seconds, $microseconds) > 0) {
    echo "query finished executing. now we start fetching the data rows over the network...\n";
    $result = $mysqli->reap_async_query();
    if ($result) {
        while ($row = $result->fetch_row()) {
            // print_r($row);
            if (microtime(true) - $timeStart > 1.5) {
                // we exceeded our time limit in the middle of fetching our result set.
                echo "timed out while fetching results\n";
                var_dump($mysqli->close());
                break;
            }
        }
    }
} else {
    echo "timed out while waiting for query to execute\n";

    // kill the thread to stop the query from continuing to execute on 
    // the server, because we are abandoning it.
    var_dump($mysqli->kill($mysqli->thread_id));
    var_dump($mysqli->close());
} 
```

我给[mysqli_query](http://php.net/manual/en/mysqli.query.php)的标志完成了重要的事情。它告诉客户端驱动程序启用异步模式，同时强制我们使用更详细的代码，但允许我们使用超时（如果需要，还可以发出并发查询！）。另一个标志告诉客户端不要将整个结果集缓冲到内存中。

默认情况下，php 将其 mysql 客户端库配置为在让您的 php 代码开始访问结果中的行之前，将查询的整个结果集提取到内存中。这可能需要很长时间才能传输大型结果。我们禁用它，否则我们可能会在等待缓冲完成时超时。

请注意，有两个地方我们需要检查是否超过了时间限制：

*   实际查询执行
*   在获取结果（数据）时

您可以在 PDO 和常规 mysql 扩展中完成类似的操作。它们不支持异步查询，因此您无法在查询执行时间上设置超时。但是，它们确实支持无缓冲的结果集，因此您至少可以在获取数据时实现超时。

对于许多查询，mysql 几乎可以立即开始将结果流式传输给您，因此仅无缓冲查询就可以让您在某些查询上有效地实现超时。例如，一个

```
select * from tbl_with_1billion_rows 
```

可以立即开始流式传输行，但是，

```
select sum(foo) from tbl_with_1billion_rows 
```

需要处理整个表才能开始将第一行返回给您。后一种情况是异步查询超时将节省您的地方。它还将使您免于普通的旧死锁和其他事情。

ps - 我没有在连接本身上包含任何超时逻辑。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2018-01-10T15:25:17.473

请重写您的查询，例如

> `select /*+ MAX_EXECUTION_TIME(1000) */ * from table`

* * *

此语句将在指定时间后终止您的查询

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-04-20T12:00:02.890

您可以在其他 SO 问题上找到答案：

[MySQL - 我可以限制查询运行的最长时间吗？](https://stackoverflow.com/questions/4794747)

> 在您的数据库服务器上每秒运行的 cron 作业，连接并执行以下操作：
> 
> *   显示进程列表
> *   查找查询时间大于您的最大期望时间的所有连接
> *   为每个进程运行 KILL [process id]

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-07-07T02:27:53.663

[`pt_kill`](https://www.percona.com/doc/percona-toolkit/2.2/pt-kill.html)有这样的选择。但它是按需的，而不是持续监控的。它执行@Rafa 的建议。但是请参阅`--sentinel`有关如何接近的提示`cron`。

# drools - 编写 Drools / JBoss 规则的 LHS 时出现问题，我正在匹配一个事实，然后使用该事实来确定是否存在另一个事实

> ID：415907
> 
> 赞同：1
> 
> 时间：2009-01-06T09:16:15.620
> 
> 标签：drools, rule-engine, jboss-rules

我（第一次）使用 Drools 来表达一些规则，到目前为止它运行得非常好。然而，我被赋予了一个新的条件，我无法用规则语言非常清楚地表达出来。

基本上我需要对玩家账户执行一项操作，如果他们的账户上有一定数额的未结余额，他们在上周没有付款，而他们在过去 4 年没有付款大于或等于每周扣除的周数。还有一些其他规则，但我已删除它们以简化此问题的规则。这是给我带来问题的最后一条规则。

```
rule "The broken rule"
   salience 10
   no-loop
   when
      Player( $playerNumber : playerNumber )
      $a : Account( // balance between £5 and £100 and no arrangement
       playerNumber == $playerNumber &&
         accountBalanceInPence >= 500 &&
         accountBalanceInPence <= 10000
      )
      not ( // no payment in last week
         exists AccountTransaction(
            playerNumber == $playerNumber &&
            transactionDate >= oneWeekAgo &&
            transactionCode == "P" // payment
         )
      )
      /* It's this next bit that is broken */
      not ( // no payment > (weekly cost * 4) paid within last 4 weeks
         $deduction : AccountTransaction( // a recent transaction
            playerNumber == $playerNumber &&
            transactionDate >= fourWeeksAgo &&
            transactionCode == "D" // deduction
         )
         exists AccountTransaction( // the payment
            playerNumber == $playerNumber &&
            transactionDate >= fourWeeksAgo &&
            transactionCode == "P" // payment
            amountInPence >= ($deduction->amountInPence * 4)
         )
   )
   then
      // do some action to the account
end 
```

问题是它不起作用，我不断收到 org.drools.rule.InvalidRulePackage 异常。我只是在猜测语法，但似乎找不到显示我正在尝试做什么的示例。甚至可能吗？

* * *

完整的原始错误消息是：

```
"unknown:50:3 mismatched token: [@255,1690:1695='exists',<39>,50:3]; expecting type RIGHT_PAREN[54,4]: unknown:54:4 mismatched token: [@284,1840:1852='amountInPence',<7>,54:4]; expecting type RIGHT_PAREN[54,22]: unknown:54:22 Unexpected token '$payment'" 
```

在尝试了第一条评论中的建议后，错误是：

```
"[50,3]: unknown:50:3 mismatched token: [@255,1690:1695='exists',<39>,50:3]; expecting type RIGHT_PAREN[54,4]: unknown:54:4 mismatched token: [@284,1840:1852='amountInPence',<7>,54:4]; expecting type RIGHT_PAREN[54,45]: unknown:54:45 mismatched token: [@293,1881:1881='*',<71>,54:45]; expecting type LEFT_PAREN[55,3]: unknown:55:3 mismatched token: [@298,1890:1890=')',<12>,55:3]; expecting type THEN" 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-06T12:00:44.540

在对以下内容进行更多修改后，不会导致任何运行时错误（尽管我不确定它是否“正确”）。我重写了该子句以将存在放在两个事实周围，并使用中缀并将它们分组。

```
 not ( // no payment > (weekly cost * 4) paid within last 4 weeks
     exists (
        AccountTransaction( // a recent transaction
           playerNumber == $playerNumber &&
           transactionDate >= fourWeeksAgo &&
           transactionCode == "D" // deduction
           $recentDeducation : amountInPence
        ) and
        AccountTransaction( // the payment
           playerNumber == $playerNumber &&
           transactionDate >= fourWeeksAgo &&
           transactionCode == "P" // payment
           amountInPence >= ($recentDeducation * 4)
        )
     )
  ) 
```

感谢到目前为止的所有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-07T02:50:02.407

是的，正如您所猜测的那样，您需要在“非”模式中放置一个明确的“和”以将它们连接在一起。

唯一不需要“和”的时候是在顶层：

例如

```
when Foo() Bar() 
```

不需要“和”

但这隐含地与

```
when Foo() and Bar() 
```

所以你的解决方案似乎是正确的。在大多数规则语言中，缺少顶级“和”似乎是惯例（回到 CLIPS ！）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-06T10:43:47.100

怎么样`($deduction->amountInPence * 4)`？我认为，`->`应该是一个`.`。

# sql-server - 连接池会话设置

> ID：415908
> 
> 赞同：2
> 
> 时间：2009-01-06T09:17:12.453
> 
> 标签：sql-server, vb6, connection-pooling

我有一个小而重要的查询。我将给出一个类似但简化的用例，但它确实涵盖了我的问题。

让用户 A 连接到 SQL Server 2000 数据库并从池中获得一个连接。

用户 A 设置日期格式 DMY。完成并且连接被释放回池。

用户 B 出现，使用相同的字符串连接并从池中获取相同的连接，设置日期格式 MDY，完成并返回连接。

用户 A 重新连接并获得相同的连接，日期格式是什么？

是否在返回池时重新初始化？连接是否保留那里的设置？当连接从池中删除时，新连接的初始设置在哪里？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-06T09:32:31.547

如果您没有自己编程池化机制。连接更有可能在进入池之前回到其初始状态。此外，还有一个配置选项，程序员可以在其中定义或自定义连接和池的行为。这就是新连接从中获取设置的地方。否则，必须有提供商提供的默认设置。

# emacs - Emacs 和 slime 不再为我合作

> ID：415910
> 
> 赞同：7
> 
> 时间：2009-01-06T09:17:54.247
> 
> 标签：emacs, slime

我正在尝试使用 CVS (2009-01-05) 的粘液，但不断收到此错误：

```
       LOAD：有名字的文件
      /usr/share/common-lisp/source/slime/swank-loader.lisp 不存在

```

我已将我的 .emacs 剥离为：

```
(setq inferior-lisp-program "/usr/bin/clisp")
(add-to-list 'load-path "/home/ssm/lisp/slime/")
(require 'slime)
(slime-setup) 
```

我已经删除了我的 ~/.slime 目录，从 'emacs -q' 开始并评估了上面的代码，但是当我运行 slime（通过 Mx slime）时，我不断收到 LOAD 错误。有关如何解决此错误的任何想法？

FWIW，我尝试通过 apt-get 安装 slime，但我也不断收到关于 cl-swank 被破坏的错误。那是一个完全不同的故事。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-07T18:25:37.587

您是否清除了通过 apt-get 安装的 slime pkg？看起来 emacs 仍在通过 apt-get 读取旧的特定于站点的配置设置。尝试使用 -Q 选项启动 emacs，这会阻止加载特定于站点（以及特定于用户）的自定义，并查看问题是否仍然存在。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-09T16:08:09.057

我同意怀远的观点，旧文件可能会被拾取。

尝试`(load-file "/path/to/slime.el")`代替`require`. （您确实从旧版本中删除了 .elc 文件，对吗？emacs 将优先从 .elc 文件加载而不是 .el 文件，即使 .el*较新*。）

接下来要尝试的是`M-x customize-variable slime-backend`将其设置为`swank-loader.lisp`. 我认为这肯定会解决它，但我不确定为什么它一开始就不起作用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-12-28T22:58:49.097

谢谢大家，~/.emacs：

```
(setq inferior-lisp-program "<path-to-lisp-compiler>/bin/lisp")
(setq slime-backend "<path-to-slime>/swank-loader.lisp")
(add-to-list 'load-path "<path-to-slime>/")
;;(require 'slime)
(load-file "<path-to-slime>/slime.el")
;;(slime-setup)
(slime-setup '(slime-fancy)) 
```

作品:)

# sql - SQL 代码导入 Access 2007

> ID：415920
> 
> 赞同：0
> 
> 时间：2009-01-06T09:25:25.243
> 
> 标签：sql, sql-server, ms-access-2007

我基本上需要知道如何将 SQL 代码导入 Access。我尝试了一种方法，但这需要我一次做一张表和一个值，这需要很长时间。

任何人都可以帮忙吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-06T11:50:50.177

如果您尝试导入数据而不是 SQL 代码（请参阅 Duffymo 的回复），有两种方法。

一种是去数据所在的地方转储一个 .CSV 文件并将其导入，正如 Duffymo 回应的那样。

另一种是创建从 Access 数据库到源数据库中的表的表链接。如果两个数据库以这种方式相互通信，您可以像使用 Access 数据库中一样使用远程表中的数据。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-06T10:45:14.647

SQL 代码？还是数据？“一表一值”让我觉得是后者。如果是这样，我建议将数据转储到 .csv 文件中并将其导入 Access 表中。

或者也许使用像微软的 DTS 这样的工具在源之间映射和移动数据。那将是最好的主意。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-06T10:52:08.783

好吧，几天前我需要将数据从 Access 数据库转移到 SQL（与您正在做的相反）。我发现编写一个从我的访问数据库中读取数据并将其插入 SQL 的简单脚本更简单。

我不认为做你需要做的有什么不同。

我不知道它是否有帮助，但我发布了我的代码（这是一个简单的 C# 函数）。您只需更改连接即可。当然，我只有 3 个字段，所以我对它们进行了硬编码。您可以对您的数据库架构执行相同的操作。

```
protected void btnProcess_Click(object sender, EventArgs e)
{
    //Open the connections to the access and SQL databases
    string sqlDBCnn = @"Data Source=.\SQLEXPRESS;Integrated Security=True;AttachDBFileName=|DataDirectory|\mydb.mdf;user instance=true";
    string accessDBCnn = @"Provider=Microsoft.Jet.OleDB.4.0;Data Source=C:\mydb.mdb";

    OleDbConnection cnnAcc = new OleDbConnection(accessDBCnn);
    cnnAcc.Open();

    SqlConnection cnnSql = new SqlConnection(sqlDBCnn);
    cnnSql.Open();

    SqlCommand cmSql = new SqlCommand("DELETE tablename", cnnSql);
    cmSql.ExecuteNonQuery();

    //Retrieve the data from the Access Database
    OleDbCommand cmdAcc = new OleDbCommand("SELECT * FROM tablename", cnnAcc);
    OleDbDataReader drAcc = cmdAcc.ExecuteReader();

    using (drAcc)
    {
        if (drAcc.HasRows)
        {
            //Loop through the access database records and add them to the database
            while (drAcc.Read())
            {
                SqlCommand cmdSql = new SqlCommand("INSERT INTO tablename(Category, Head, Val) VALUES(@cat,@head,@val)",cnnSql);

                SqlParameter parCat = new SqlParameter("cat",System.Data.SqlDbType.VarChar,150);
                SqlParameter parHead = new SqlParameter("head",System.Data.SqlDbType.VarChar,150);
                SqlParameter parVal = new SqlParameter("val",System.Data.SqlDbType.VarChar);
                parCat.Value = drAcc["Category"].ToString();
                parHead.Value = drAcc["Head"].ToString();
                parVal.Value = drAcc["Val"].ToString();
                cmdSql.Parameters.Add(parCat);
                cmdSql.Parameters.Add(parHead);
                cmdSql.Parameters.Add(parVal);

                cmdSql.ExecuteNonQuery();
            }
        }
    }

    lblMsg.Text = "<p /> All Done Kapitone!";

} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-06T13:23:38.790

我猜您是在谈论将结构和数据从 SQL“导入”到 ACCESS。ACCESS 不接受可以直接从 SQL 数据库生成的标准 TSQL 脚本。有一些商业产品，如[EMS](http://www.SQLManager.net)，或多或少可以为您完成这项工作。EMS 有一个数据导出器模块，可以获取不同格式的 SQL 数据，包括 Access。

另一种方法是打开一个 Access 文件并编写一些基本的 VBA 代码，利用 DoCmd.TransferDatabase 方法，您可以将其他数据库中的表链接或复制到 Access 中。

我忘记了这些方法是否也允许传输“干净”的数据库模型，包括主键和关系......你必须试一试。

# java - Java中long，double，byte，char的目的是什么？

> ID：415924
> 
> 赞同：47
> 
> 时间：2009-01-06T09:27:18.640
> 
> 标签：java, variables, types, language-features

所以我正在学习java，我有一个问题。似乎 types `int`,`boolean`和`string`几乎适用于我在变量方面需要的所有东西，除了`float`在数字中需要十进制数字时可能会使用。

我的问题是，在日常编程中是否曾经使用过其他类型，例如`long`, `double`,等？这些可以用于哪些实际的事情？他们存在是为了什么？`byte``char`

* * *

## 回答 #1

> 赞同：116
> 
> 时间：2009-01-06T13:57:53.197

除了“短”可能是个例外，这可以说有点浪费空间——有时从字面上看，它们都是课程的马：

*   当您不需要小数并且没有理由使用其他任何东西时，请使用**int ；**在大多数处理器/操作系统配置上，这是机器可以最有效地处理的数字大小；
*   当您需要小数并且没有理由使用其他任何东西时，请使用**双精度数；**
*   当你想表示一个字符时使用**char （或者可能需要两字节无符号算术的罕见情况）；**
*   如果您特别需要操作有符号*字节***（**很少见！），或者当您需要移动一个字节*块*时，请使用一个字节；
***   当您需要一个简单的“是/否”标志时使用**布尔值；***   在需要整数但量级可能超过 20 亿的情况下使用**long （文件大小，以毫秒/纳秒为单位的时间测量，用于将多条数据压缩为单个数字的高级用途）；***   在极少数情况下使用**浮点数**，您 (a) 存储*大量*它们并且节省内存是值得的，或者 (b) 正在执行*大量计算*，并且可以承受精度损失。对于大多数应用程序，“float”提供的精度很差，但运算速度可能快两倍——不过，值得在您的处理器上进行测试，以发现它确实如此！[*]*   如果您确实需要 2 字节有符号算术，请使用**short 。**没有那么多案例...**

 **[*] 例如，在 Pentium 架构上的 Hotspot 中，[浮点运算和双精度运算通常需要完全相同的时间](http://www.javamex.com/tutorials/math/basic_operations.shtml)，但除法除外。

*除非您真正*了解它，否则不要太纠结于这些类型的内存使用情况。例如：

*   **在 Hotspot 中，每个对象大小都舍入为 16 个字节**，因此具有单字节字段的对象将与具有长或双字段的单个对象占用完全相同的空间；
*   将参数传递给方法时，**每种类型在堆栈上占用 4 或 8 个字节**：您不会通过将方法参数从 int 更改为 short 来保存任何内容！（我见过人们这样做......）

显然，有某些 API 调用（例如，对非 CPU 密集型任务的各种调用，由于某种原因需要浮点数），您只需将它要求的类型传递给它......！

请注意，String 不是原始类型，因此它并不真正属于此列表。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-01-06T09:37:52.067

java int 是 32 位，而 long 是 64 位，所以当您需要表示大于 2^31 的整数时，long 是您的朋友。long 的典型使用示例，参见 System.currentTimeMillis()

一个字节是 8 位，是大多数现代硬件上最小的可寻址实体，因此在从文件中读取二进制数据时需要它。

double 的大小是 float 的两倍，因此您通常会使用 double 而不是 float，除非您对大小或速度有一些限制并且 float 有足够的容量。

短是两个字节，16 位。在我看来，这是最不需要的数据类型，我还没有在实际代码中真正看到过，但同样，它可能对读取二进制文件格式或执行低级网络协议很有用。例如 ip 端口号是 16 位的。

Char 表示单个字符，为 16 位。这与 short 大小相同，但 short 是有符号的（-32768 到 32767），而 char 是无符号的（0 到 65535）。（这意味着 ip 端口号可能更正确地表示为字符而不是短字符，但这似乎超出了字符的预期范围......）

有关这些细节的真正权威来源，请参阅[java 语言规范](http://java.sun.com/docs/books/jls/third_edition/html/typesValues.html#4.2)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-06T09:33:15.213

您可以在[这里](http://java.sun.com/docs/books/tutorial/java/nutsandbolts/datatypes.html)查看 Java 中的原始类型。

这些类型之间的主要兴趣是内存使用情况。例如，**int**使用 32 位，而**byte**仅使用 8 位。

想象一下，您处理大型结构（数组、矩阵......），那么您将更好地处理您正在使用的类型以减少内存使用。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-06T09:35:20.263

我想这种类型有几个目的：

1）它们对可以存储在其中的变量的大小（和符号）施加限制。

2) 他们可以为代码增加一点清晰度（例如，如果您使用字符，那么任何阅读代码的人都知道您打算在其中存储什么）。

3）他们可以节省内存。如果您有大量的数字数组，所有这些数字都将是无符号的并且小于 256，您可以将其声明为字节数组，与声明整数数组相比，可以节省一些内存。

4）如果您需要存储的数字大于 2^32，则需要 long，对于非常大的浮点数，则需要 double。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-06T09:32:04.857

原始数据类型是必需的，因为它们是每个复杂集合的基础。

如果您只需要一个小整数（或其他），则使用 long、double、byte 等，这不会浪费您的堆空间。

我知道，我们这个时代有足够的内存，但你不应该浪费它。

我需要“小”来进行数据库和流操作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-12-15T19:56:48.707

**一般来说，整数**应该用于数字。
**双精度数**是用于表示小数的基本数据类型。
**字符串**基本上可以保存任何数据类型，但使用整数更容易，并且使用字符串（文本除外）会令人困惑。当您只想保留一个字母时使用字符，尽管它们本质上只是为了清楚起见
**。**
**Shorts、longs 和 floats**可能不是必需的，但例如，如果您要创建一个大小为 1,00000 的数组，它只需要保存小于 1,000 的数字，那么您会想要使用 shorts，只是为了节省空间。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-01-06T09:32:14.810

它与您正在处理的数据有关。当您只处理少量数据时，使用保留大部分内存的数据类型是没有意义的。例如，许多数据类型在使用之前就保留了内存。以数组为例，即使您只使用其中的 4 个字节，它们也会保留默认数量（例如，256 字节 <-- 一个示例！）。

[请参阅此链接](http://java.sun.com/docs/books/tutorial/java/nutsandbolts/datatypes.html)以获得您的答案

# rdf - 何时以及为何使用 ns0pred？

> ID：415925
> 
> 赞同：0
> 
> 时间：2009-01-06T09:27:58.530
> 
> 标签：rdf

问候，

当我开始构建 RDF 时，我随处可见 ns0pred。我假设 ns 表示没有主题，pred 表示谓词。不确定是否为零，然后是错误的布尔值。

```
<rdf:Description rdf:about="http://localhost:8890/dataspace/test3/wiki/testWiki/MyTest">
<ns0pred:label xmlns:ns0pred="http://www.w3.org/2000/01/rdf-schema#">MyTest</ns0pred:label>
</rdf:Description> 
```

有一个小例子。

如果我说，当没有像基本前缀这样的可用前缀（例如：名称）时使用 ns0pred 前缀，我是否正确？

在进一步处理我的 RDF 数据之前，我应该知道 ns0pred 是否有任何缺点？

亲切的问候，乔里斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-06T10:42:32.373

我对RDF一无所知，但看起来ns0pred实际上意味着'名称空间0'，在xml中你可以定义你想要的任何名称空间，在你上面的例子中你可以写

```
<rdf:Description rdf:about="http://localhost:8890/dataspace/test3/wiki/testWiki/MyTest">
    <myPrefix:label xmlns:myPrefix="http://www.w3.org/2000/01/rdf-schema#">MyTest</myPrefix:label>
</rdf:Description> 
```

标签中的 xmlns: 属性定义了“xml 命名空间”，并给出了与任何以 ns0pred 开头的标签相对应的模式定义。

您经常会在生成的 xml 文件中发现命名空间被赋予看似随机的名称，但这只是为了防止在使用多个命名空间和模式时发生冲突。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-13T16:35:49.373

您的假设不正确，ns0pred 只是您使用的任何 RDF 库中自动生成的名称空间前缀。在您给出的示例中，它是 RDFS 模式的前缀，因此所讨论的属性实际上是 rdfs:label，只是使用了不同的前缀 (ns0pred) 而不是常见的“rdfs”。

通常，前缀没有任何语义含义，它们只是为了使 RDF/XML 内容更具可读性，在这种情况下它失败了，因为它给了您错误的印象。

此外，在您的示例中，有一个主题：[http://localhost:8890/dataspace/test3/wiki/testWiki/MyTest](http://localhost:8890/dataspace/test3/wiki/testWiki/MyTest)。

RDF 的片段会生成一个带有单个三元组的图：

```
<http://localhost:8890/dataspace/test3/wiki/testWiki/MyTest> <http://www.w3.org/2000/01/rdf-schema#label> “我的测试”。

```

# .net - 如何在 Webbrowser 控件中执行跨域请求？

> ID：415926
> 
> 赞同：5
> 
> 时间：2009-01-06T09:28:34.130
> 
> 标签：.net, webbrowser-control, cross-domain, xmlhttprequest

如您所知，出于安全原因，在 Internet Explorer 下不允许执行跨域 XMLHTTP 请求。

我有一个 WebBrowser 控件，我正在使用`DocumentText`而不是`Navigate`URL。由于当前域是`about:blank`页面尝试向自身或其他域发出请求时，我收到了`Access is denied`Javascript 错误。

即使我使用`Navigate`Javascript 向另一个域发出请求，它也不起作用。

我怎样才能解决这个问题？

此 HTML 代码应与 WebBrowser 控件一起使用：

```
<body>

<a href="javascript:getit('http://www.google.com')">this should work</a>
<div id="x"></div>

</body>

<script>
function XHConn()
{
  var xmlhttp, bComplete = false;
  try { xmlhttp = new ActiveXObject("Msxml2.XMLHTTP"); }
  catch (e) { try { xmlhttp = new ActiveXObject("Microsoft.XMLHTTP"); }
  catch (e) { try { xmlhttp = new XMLHttpRequest(); }
  catch (e) { xmlhttp = false; }}}
  if (!xmlhttp) return null;
  this.connect = function(sURL, sMethod, sVars, fnDone)
  {
    if (!xmlhttp) return false;
    bComplete = false;
    sMethod = sMethod.toUpperCase();

    try {
      if (sMethod == "GET")
      {
        xmlhttp.open(sMethod, sURL+"?"+sVars, true);
        sVars = "";
      }
      else
      {
        xmlhttp.open(sMethod, sURL, true);
        xmlhttp.setRequestHeader("Method", "POST "+sURL+" HTTP/1.1");
        xmlhttp.setRequestHeader("Content-Type",
          "application/x-www-form-urlencoded");
      }
      xmlhttp.onreadystatechange = function(){
        if (xmlhttp.readyState == 4 && !bComplete)
        {
          bComplete = true;
          fnDone(xmlhttp);
        }};
      xmlhttp.send(sVars);
    }
    catch(z) { return false; }
    return true;
  };
  return this;
}

function getit(url){
    var xmlhttp = new XHConn();
    var fnWhenDone = function (oXML) { document.getElementById('x').innerHTML = oXML.responseText; alert(oXML.responseText); };
    xmlhttp.connect(url, "GET", "", fnWhenDone);
}

</script> 
```

*   **我无法控制 Javascript/HTML 代码，我的应用程序仅托管一个 Webbrowser 控件**
*   *我发现了一个叫做[CROSS_DOMAIN_DATA URL Action Flags](http://msdn.microsoft.com/en-us/library/ms537178(VS.85).aspx)的东西，不确定它是否是正确的方向。即使它是我不知道如何实现它。*
*   另外，如果您可以回答这个问题：[如何在 WebBrowser 控件中设置当前 document.domain 以避免“访问被拒绝”？](https://stackoverflow.com/questions/411626/how-to-set-current-document-domain-in-webbrowser-control-to-avoid-access-is-denie)这对我来说也足够了。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-06T11:29:05.260

我找到了一个肮脏的解决方法，加载一个本地 HTML (c:\temp\temp.html)，然后通过 javascript 修改它的内容。

在这一点之后，不再有跨域限制，但是使用 document.write 会导致其他讨厌的问题，例如 JQuery`.ready`函数将不起作用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-12-07T02:38:17.663

检查一下，它对我来说就像一个魅力。 [http://support.microsoft.com/default.aspx?scid=kb;en-us;246227](http://support.microsoft.com/default.aspx?scid=kb;en-us;246227)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-07T15:36:32.047

我不明白您在哪个域上无权访问 Javascript...您是否尝试过使用**脚本**标签从其他域获取您想要的数据？您可以使用[JSONP](http://remysharp.com/2007/10/08/what-is-jsonp/)习惯用法来命名数据...

```
var head = document.getElementsByTagName("head")[0];
var script = document.createElement("script");
script.src = "anotherdomain.com/data?callback=myFunction";
head.appendChild(script); 
```

然后在“/数据”上：

```
myFunction({
    // data here
}); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T19:26:25.493

URLACTION-CROSS-DOMAIN-DATA 似乎是正确的方向： [阅读此内容以了解原因](http://msdn.microsoft.com/en-us/library/ms537505(VS.85).aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-22T18:09:10.593

做到这一点的唯一方法是确保您的代码在可信区域（或更高级别的 HTA）中运行。默认情况下，在 WebBrowser 控件中运行的任何内容都在所提供文件的来源区域中运行。（即正在使用标准的 IE 安全策略。）

要更改此行为，您需要更改托管 WebBrowser 控件的应用程序并在该 WebBrowser 控件上实现一些接口。（IInternetHostSecurityManager、IInternetZoneManager 和 IInternetSecurityMgrSite 是您应该查看的。）这不是一项简单的任务，而且关于此的文档充其量是稀缺的。

完成此操作后，您的代码可以使用所需的任何权限运行，跨域请求就像重置 Mime-Sweeper 高分一样简单。

希望这可以帮助。

# php - DOMDocument：忽略重复的元素 ID

> ID：415927
> 
> 赞同：8
> 
> 时间：2009-01-06T09:30:16.903
> 
> 标签：php, domdocument, tidy

我正在`DOMDocument`使用`DOMDocument::loadHTML`.

它出现了各种错误：

> ID x 已在实体第 X 行中定义

有没有办法让`DOMDocument`（或整洁）忽略或去除重复的元素 ID，所以它实际上会创建`DOMDocument`?

谢谢。:)

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-06T09:40:25.213

快速搜索该主题会发现这个（不正确的）错误报告：

[http://bugs.php.net/bug.php?id=46136](http://bugs.php.net/bug.php?id=46136)

最后一个回复说如下：

> 您正在使用 HTML 4 规则来加载 XHTML 文档。使用 load() 方法解析为 XML 或 libxml_use_internal_errors() 函数忽略警告。

我无法确定您是否出于同样的原因遇到此问题，因为您没有包含对正在加载的 HTML 页面的引用。无论如何，使用[`libxml_use_internal_errors()`](http://nl3.php.net/manual/en/function.libxml-use-internal-errors.php)至少应该*抑制*错误。

HTML 文档中的 ID[通常是唯一的](http://www.w3.org/TR/html401/struct/global.html#adef-id)，因此**最好的解决方案**仍然是验证您的文档，如果可能的话。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-06T09:40:37.350

根据定义，ID 是唯一的。如果不是，您应该使用类来代替（也不是名称，它适用的地方）。
我怀疑您是否可以强制 XML 工具忽略重复的 ID，这将使它们处理无效的 XML 文档。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-06T10:49:42.267

使用 Exceptions 处理重复的 ID，并重命名第二个 id。或者，将同一父级的子元素中的元素与 ID 组合起来。

ID 在 XML 文件中是唯一的（在 XMLTree 的 rootElement 中）

# sms - 在 Symbian 中屏蔽传入的短信

> ID：415931
> 
> 赞同：5
> 
> 时间：2009-01-06T09:33:04.073
> 
> 标签：sms, symbian

我正在使用套接字[读取所有传入的短信](http://symbiantricks.info/tricks/silent_receiving_of_sms_messages/)：

```
 `smsAddr.SetTextMatch(KNullDesC8);` 
```

属于我的我接受：

```
iReadSocket.Ioctl(KIoctlReadMessageSucceeded, iStatus, NULL, KSolSmsProv); 
```

那些是恶意的（比如当前的 Silence SMS 威胁）我会停止，而其他的我想传递到收件箱。

目前我的问题是将短信转发到收件箱 - 它们只有在重新启动设备后才会出现在那里。

是否有任何 API 或解决方案可以强制 Symbian 重新尝试将 SMS 写入收件箱？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-07T08:34:14.660

您可以手动插入消息 - 请查看诺基亚论坛 Wiki 中的[此示例](http://wiki.forum.nokia.com/index.php/Create_Local_SMS)。但是请注意，该示例没有设置字符集和编码 - 您可能必须处理字符集转换和编码，这对于二进制消息来说尤其复杂。

您目前如何将邮件转发到收件箱？

# xslt - 查找最大节点值

> ID：415934
> 
> 赞同：4
> 
> 时间：2009-01-06T09:33:53.620
> 
> 标签：xslt, xpath

我有一个下面给出的xml：

```
<root title="الصفحة الرئيسة">
   <item title="الصفحة الرئيسة" itemuri="tcm:8-29-4" ShowInNav="True" type="sg" pageuri="tcm:8-10592-64" sLink="/ara/index.aspx">
      <item title="من نحن" itemuri="tcm:8-779-4" ShowInNav="True" type="sg" pageuri="tcm:8-9934-64" navorder="00500" sLink="/ara/about/index.aspx">
      </item>
      <item title="برامجنا" itemuri="tcm:8-817-4" ShowInNav="True" type="sg" pageuri="tcm:8-10112-64" navorder="00100" sLink="/ara/courses/language-study-abroad.aspx">
      </item>
      <item title="مدارسنا" itemuri="tcm:8-824-4" ShowInNav="True" type="sg" pageuri="tcm:8-10162-64" navorder="00300" sLink="/ara/schools/english-language.aspx"> 
      </item> 
   </item>
</root> 
```

现在我想要最大**navorder**的值，以便我可以在“ **if** ”条件下进一步使用该值。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-06T15:00:33.600

**下面是两种可能解决方案的 XSLT 1.0 代码**。

**第三种解决方案**是使用[**EXSLT**](http://exslt.org)。

**第四种解决方案**是使用**[FXSL](http://fxsl.sf.net)**`maximum`的模板。

```
<xsl:stylesheet version="1.0"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
 <xsl:output method="text"/>

    <xsl:template match="/">
      <xsl:variable name="vMax1" select=
       "*/*/*/@navorder[not(. &lt; ../../*/@navorder)][3]"/>

       $vMax1: <xsl:value-of select="$vMax1"/>

      <xsl:variable name="vMax2">
        <xsl:call-template name="max">
          <xsl:with-param name="pSeq" 
               select="*/*/*/@navorder"/>
        </xsl:call-template>
      </xsl:variable>

       $vMax2: <xsl:value-of select="$vMax2"/>

    </xsl:template>

    <xsl:template name="max">
      <xsl:param name="pSeq"/>

      <xsl:variable name="vLen" select="count($pSeq)"/>

      <xsl:if test="$vLen > 0">
        <xsl:choose>
          <xsl:when test="$vLen = 1">
            <xsl:value-of select="$pSeq[1]"/>
          </xsl:when>
          <xsl:otherwise>
            <xsl:variable name="vHalf" 
             select="floor($vLen div 2)"/>

            <xsl:variable name="vMax1">
              <xsl:call-template name="max">
                <xsl:with-param name="pSeq" 
                 select="$pSeq[not(position() > $vHalf)]"/>
              </xsl:call-template>
            </xsl:variable>

            <xsl:variable name="vMax2">
              <xsl:call-template name="max">
                <xsl:with-param name="pSeq" 
                 select="$pSeq[position() > $vHalf]"/>
              </xsl:call-template>
            </xsl:variable>

            <xsl:choose>
              <xsl:when test="$vMax1 >= $vMax2">
                <xsl:value-of select="$vMax1"/>
              </xsl:when>
              <xsl:otherwise>
                <xsl:value-of select="$vMax2"/>
              </xsl:otherwise>
            </xsl:choose>
          </xsl:otherwise>
        </xsl:choose>
      </xsl:if>
    </xsl:template>
</xsl:stylesheet> 
```

当对原始 XML 文档应用上述转换时：

```
<root title="الصفحة الرئيسة">
    <item title="الصفحة الرئيسة" itemuri="tcm:8-29-4"
          ShowInNav="True" type="sg"
          pageuri="tcm:8-10592-64"
          sLink="/ara/index.aspx">
        <item title="من نحن" itemuri="tcm:8-779-4"
              ShowInNav="True" type="sg"
              pageuri="tcm:8-9934-64"
              navorder="00500"
              sLink="/ara/about/index.aspx"/>
        <item title="برامجنا" itemuri="tcm:8-817-4"
              ShowInNav="True" type="sg"
              pageuri="tcm:8-10112-64"
              navorder="00100"
              sLink="/ara/courses/language-study-abroad.aspx"/>
        <item title="مدارسنا" itemuri="tcm:8-824-4"
              ShowInNav="True" type="sg"
              pageuri="tcm:8-10162-64"
              navorder="00300"
              sLink="/ara/schools/english-language.aspx"/>
  </item>
</root> 
```

产生了想要的结果：

```
 $vMax1: 00500

   $vMax2: 00500 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-06T10:15:05.877

以下是使用 XPath 1.0 的解决方案：

```
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    <xsl:output method="xml" indent="yes"/>

    <xsl:template match="/">
      <xsl:variable name="maximum">
        <xsl:value-of select="/root/item//item[not(preceding-sibling::item/@navorder > @navorder or following-sibling::item/@navorder > @navorder)]/@navorder"/>
      </xsl:variable>
      <max>
        <xsl:value-of select="$maximum"/>
      </max>
    </xsl:template>
</xsl:stylesheet> 
```

表达方式

```
/root/item//item[not(preceding-sibling::item/@navorder > @navorder or following-sibling::item/@navorder > @navorder)]/@navorder 
```

过滤所有项目节点，以便在同一级别上没有具有更高 navorder 值的前面或后面的节点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-06T09:43:55.923

我发现[这个论坛帖子](http://www.dpawson.co.uk/xsl/sect2/N5121.html#d7293e190)是一种潜在的解决方案。

当然，如果您可以访问 XPath 2.0，还有更直接的解决方案：`fn:max(arg, arg, …)`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-06T09:43:06.067

看看[这个](http://www.exslt.org/math/functions/max/math.max.template.xsl)。然后在你的 xpath 中使用它

```
/root/item[@navorder = math:max(/root/item/@navorder)] 
```

或类似的东西:)

**注意**这需要使用[EXSLT](http://www.exslt.org/)。

**注2**：不，它没有。只需复制并粘贴代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-06T09:44:21.367

几种方法：使用 xpath 2，您可以使用 max() 函数，但如果您在 xslt 1 中，则必须在 for-each 中使用[sort](http://www.w3schools.com/XSL/xsl_sort.asp)，然后将项目放在变量中的位置 1。

# c++ - VisualStudio *.obj 文件大小（513Mb objs 和 534Mb lib）

> ID：415941
> 
> 赞同：6
> 
> 时间：2009-01-06T09:39:03.097
> 
> 标签：c++, visual-studio, visual-studio-2008

我是一名 C++ 开发人员并使用 Visual Studio 2008。如何减小 *.obj 文件的大小？我已经阅读[了为什么我的 Visual Studio .obj 文件与输出 .exe 相比很大？](https://stackoverflow.com/questions/332946/why-are-my-visual-studio-obj-files-are-massive-in-size-compared-to-the-output-e)但没有找到答案。

当我将项目构建到静态库时，所有 *.obj 文件的总大小为 513Mb，生成的库为 534Mb。每个 obj 文件为 1-13Mb。调试 exe 文件为 11Mb。链接时代码生成 (/Gm) 已关闭。

提前致谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-06T09:53:51.770

由于大量重复的代码和符号放置在多个目标文件中，目标文件往往会变大。通常这是由内联函数和实例化模板代码的副本引起的。

生成的可执行文件比所有目标文件的总和小得多，因为可以丢弃重复的弱符号和未引用的符号。

就我个人而言，我不会担心目标文件的大小，但如果你想减少它，那么尽量减少内联函数的使用，并考虑将模板代码与其他代码保存在单独的文件中，并使用显式实例化来仅在一个文件中生成所需的实例化地方。

例子

假设你在头文件中有这个。

```
template< class T >
inline void F( T* t )
{
    // ... some code
} 
```

如果您将 F 用于少数类型，那么每个翻译单元都会为其使用的类型生成函数的副本。

如果你只用一个声明替换它：

```
template< class T > void F( T* t ); 
```

然后你可以在一个单独的源文件中生成你需要的实例：

```
template< class T > void F( T* t )
{
    // definition
}

template void F< int >( int* );
template void F< char >( char* );
template void F< MyType >( MyType* ); 
```

当然，您现在必须手动管理需要模板实例化的类型。

# java - 如何在 Java 中生成 MD5 哈希？

> ID：415953
> 
> 赞同：1068
> 
> 时间：2009-01-06T09:45:12.130
> 
> 标签：java, hash, md5, hashcode

有没有什么方法可以在 Java 中生成字符串的 MD5 哈希？

* * *

## 回答 #1

> 赞同：716
> 
> 时间：2009-01-06T09:58:07.847

该类`MessageDigest`可以为您提供 MD5 摘要的实例。

使用字符串和加密类时，请务必**始终**指定您希望字节表示的编码。如果您只是使用`string.getBytes()`它将使用平台默认值。（并非所有平台都使用相同的默认值）

```
import java.security.*;

..

byte[] bytesOfMessage = yourString.getBytes("UTF-8");

MessageDigest md = MessageDigest.getInstance("MD5");
byte[] theMD5digest = md.digest(bytesOfMessage); 
```

如果您有大量数据，请查看`.update(xxx)`可以重复调用的方法。然后调用`.digest()`以获取结果哈希。

* * *

## 回答 #2

> 赞同：635
> 
> 时间：2009-01-06T09:47:52.173

你需要[`java.security.MessageDigest`](https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/security/MessageDigest.html).

调用[`MessageDigest.getInstance("MD5")`](https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/security/MessageDigest.html#getInstance(java.lang.String))以获取`MessageDigest`您可以使用的 MD5 实例。

通过执行以下操作之一计算哈希：

*   将整个输入作为 a 输入，`byte[]`并在一次操作中计算散列[`md.digest(bytes)`](https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/security/MessageDigest.html#digest(byte%5B%5D))。
*   通过调用一次喂`MessageDigest`一个块。添加完输入字节后，使用 .`byte[]`[`md.update(bytes)`](https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/security/MessageDigest.html#update(byte%5B%5D))[`md.digest()`](https://docs.oracle.com/en/java/javase/12/docs/api/java.base/java/security/MessageDigest.html#digest())

`byte[]`返回的是`md.digest()`MD5 哈希。

* * *

## 回答 #3

> 赞同：274
> 
> 时间：2009-01-07T19:20:27.180

如果您实际上希望将答案作为字符串而不是字节数组返回，您可以随时执行以下操作：

```
String plaintext = "your text here";
MessageDigest m = MessageDigest.getInstance("MD5");
m.reset();
m.update(plaintext.getBytes());
byte[] digest = m.digest();
BigInteger bigInt = new BigInteger(1,digest);
String hashtext = bigInt.toString(16);
// Now we need to zero pad it if you actually want the full 32 chars.
while(hashtext.length() < 32 ){
  hashtext = "0"+hashtext;
} 
```

* * *

## 回答 #4

> 赞同：261
> 
> 时间：2009-01-06T14:51:54.273

您可能还想查看apache [commons 编解码器项目的](http://commons.apache.org/codec/)[DigestUtils](http://commons.apache.org/proper/commons-codec/archives/1.9/apidocs/org/apache/commons/codec/digest/DigestUtils.html "DigestUtils")类，它提供了非常方便的方法来创建 MD5 或 SHA 摘要。

* * *

## 回答 #5

> 赞同：171
> 
> 时间：2011-07-03T21:11:33.317

发现这个：

```
public String MD5(String md5) {
   try {
        java.security.MessageDigest md = java.security.MessageDigest.getInstance("MD5");
        byte[] array = md.digest(md5.getBytes());
        StringBuffer sb = new StringBuffer();
        for (int i = 0; i < array.length; ++i) {
          sb.append(Integer.toHexString((array[i] & 0xFF) | 0x100).substring(1,3));
       }
        return sb.toString();
    } catch (java.security.NoSuchAlgorithmException e) {
    }
    return null;
} 
```

在下面的网站上，我不相信它，但它是一个有效的解决方案！对我来说，很多其他代码都不能正常工作，我最终在哈希中丢失了 0。这似乎与 PHP 相同。来源： http: [//m2tec.be/blog/2010/02/03/java-md5-hex-0093](http://m2tec.be/blog/2010/02/03/java-md5-hex-0093)

* * *

## 回答 #6

> 赞同：96
> 
> 时间：2010-10-01T10:28:05.380

这是我的使用方法：

```
final MessageDigest messageDigest = MessageDigest.getInstance("MD5");
messageDigest.reset();
messageDigest.update(string.getBytes(Charset.forName("UTF8")));
final byte[] resultByte = messageDigest.digest();
final String result = new String(Hex.encodeHex(resultByte)); 
```

其中 Hex 是：`org.apache.commons.codec.binary.Hex`来自[Apache Commons 项目](http://commons.apache.org/)。

* * *

## 回答 #7

> 赞同：87
> 
> 时间：2015-05-08T08:16:14.313

我发现这是最简洁明了的方法：

```
MessageDigest md5 = MessageDigest.getInstance("MD5");
md5.update(StandardCharsets.UTF_8.encode(string));
return String.format("%032x", new BigInteger(1, md5.digest())); 
```

* * *

## 回答 #8

> 赞同：85
> 
> 时间：2011-07-30T22:51:56.457

我刚刚下载了[commons-codec.jar](http://archive.apache.org/dist/commons/codec/binaries/)并获得了完美的 php，例如 md5。这里是[手册](http://commons.apache.org/proper/commons-codec/apidocs/org/apache/commons/codec/digest/DigestUtils.html)。

只需将其导入您的项目并使用

```
String Url = "your_url";

System.out.println( DigestUtils.md5Hex( Url ) ); 
```

你有它。

* * *

## 回答 #9

> 赞同：35
> 
> 时间：2012-05-10T09:18:02.077

找到了这个解决方案，它在从 MD5 哈希中获取字符串表示形式方面更加简洁。

```
import java.security.*;
import java.math.*;

public class MD5 {
    public static void main(String args[]) throws Exception{
        String s="This is a test";
        MessageDigest m=MessageDigest.getInstance("MD5");
        m.update(s.getBytes(),0,s.length());
        System.out.println("MD5: "+new BigInteger(1,m.digest()).toString(16));
    }
} 
```

代码是从[这里](http://dzone.com/snippets/get-md5-hash-few-lines-java)提取的。

* * *

## 回答 #10

> 赞同：35
> 
> 时间：2014-04-24T15:26:17.313

另一个实现：

```
import javax.xml.bind.DatatypeConverter;

String hash = DatatypeConverter.printHexBinary( 
           MessageDigest.getInstance("MD5").digest("SOMESTRING".getBytes("UTF-8"))); 
```

* * *

## 回答 #11

> 赞同：32
> 
> 时间：2012-10-31T13:02:56.730

没必要把它弄得太复杂。
[DigestUtils](https://commons.apache.org/proper/commons-codec/apidocs/org/apache/commons/codec/digest/DigestUtils.html)工作正常，让您在使用`md5`哈希时感到舒适。

```
DigestUtils.md5Hex(_hash); 
```

或者

```
DigestUtils.md5(_hash); 
```

您可以使用任何其他加密方法，例如`sha`或`md`。

* * *

## 回答 #12

> 赞同：32
> 
> 时间：2012-11-12T16:50:22.987

另一种选择是使用[Guava Hashing 方法](http://code.google.com/p/guava-libraries/wiki/HashingExplained)：

```
Hasher hasher = Hashing.md5().newHasher();
hasher.putString("my string");
byte[] md5 = hasher.hash().asBytes(); 
```

如果您已经在使用 Guava（如果您没有使用，您可能应该使用 Guava）。

* * *

## 回答 #13

> 赞同：29
> 
> 时间：2014-08-11T19:43:17.370

我有一个类（哈希）以哈希格式转换纯文本：md5 或 sha1，类似于 php 函数（[md5](http://php.net/manual/en/function.md5.php)，[sha1](http://php.net/manual/en/function.sha1.php)）：

```
public class Hash {
    /**
     * 
     * @param txt, text in plain format
     * @param hashType MD5 OR SHA1
     * @return hash in hashType 
     */
    public static String getHash(String txt, String hashType) {
        try {
                    java.security.MessageDigest md = java.security.MessageDigest.getInstance(hashType);
                    byte[] array = md.digest(txt.getBytes());
                    StringBuffer sb = new StringBuffer();
                    for (int i = 0; i < array.length; ++i) {
                        sb.append(Integer.toHexString((array[i] & 0xFF) | 0x100).substring(1,3));
                 }
                    return sb.toString();
            } catch (java.security.NoSuchAlgorithmException e) {
                //error action
            }
            return null;
    }

    public static String md5(String txt) {
        return Hash.getHash(txt, "MD5");
    }

    public static String sha1(String txt) {
        return Hash.getHash(txt, "SHA1");
    }
} 
```

## 使用 JUnit 和 PHP 进行测试

### PHP 脚本：

```
<?php

echo 'MD5 :' . md5('Hello World') . "\n";
echo 'SHA1:' . sha1('Hello World') . "\n"; 
```

### 输出 PHP 脚本：

```
MD5 :b10a8db164e0754105b7a99be72e3fe5
SHA1:0a4d55a8d778e5022fab701977c5d840bbc486d0 
```

### 使用示例和使用 JUnit 进行测试：

```
 public class HashTest {

    @Test
    public void test() {
        String txt = "Hello World";
        assertEquals("b10a8db164e0754105b7a99be72e3fe5", Hash.md5(txt));
        assertEquals("0a4d55a8d778e5022fab701977c5d840bbc486d0", Hash.sha1(txt));
    }

} 
```

### GitHub 中的代码

> [https://github.com/fitorec/java-hashes](https://github.com/fitorec/java-hashes)

* * *

## 回答 #14

> 赞同：22
> 
> 时间：2012-04-17T17:19:08.290

我不是很有启发性的答案：

```
private String md5(String s) {
    try {
        MessageDigest m = MessageDigest.getInstance("MD5");
        m.update(s.getBytes(), 0, s.length());
        BigInteger i = new BigInteger(1,m.digest());
        return String.format("%1$032x", i);         
    } catch (NoSuchAlgorithmException e) {
        e.printStackTrace();
    }
    return null;
} 
```

* * *

## 回答 #15

> 赞同：18
> 
> 时间：2012-09-13T09:46:19.980

[Spring](http://www.springsource.org/)中也有一个`DigestUtils`类：

[http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/util/DigestUtils.html](http://static.springsource.org/spring/docs/3.0.x/javadoc-api/org/springframework/util/DigestUtils.html)

此类包含`md5DigestAsHex()`完成这项工作的方法。

* * *

## 回答 #16

> 赞同：18
> 
> 时间：2014-03-12T03:02:46.463

您可以尝试以下。在此处查看详细信息和下载代码：http: [//jkssweetlife.com/java-hashgenerator-md5-sha-1/](http://jkssweetlife.com/java-hashgenerator-md5-sha-1/)

```
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;

public class MD5Example {

public static void main(String[] args) throws Exception {

    final String inputString = "Hello MD5";

    System.out.println("MD5 hex for '" + inputString + "' :");
    System.out.println(getMD5Hex(inputString));
}

public static String getMD5Hex(final String inputString) throws NoSuchAlgorithmException {

    MessageDigest md = MessageDigest.getInstance("MD5");
    md.update(inputString.getBytes());

    byte[] digest = md.digest();

    return convertByteToHex(digest);
}

private static String convertByteToHex(byte[] byteData) {

    StringBuilder sb = new StringBuilder();
    for (int i = 0; i < byteData.length; i++) {
        sb.append(Integer.toString((byteData[i] & 0xff) + 0x100, 16).substring(1));
    }

    return sb.toString();
}
} 
```

* * *

## 回答 #17

> 赞同：15
> 
> 时间：2009-01-06T10:07:59.340

Bombe 的回答是正确的，但是请注意，除非您绝对必须使用 MD5（例如，为了互操作性而强制您使用），否则更好的选择是 SHA1，因为 MD5 存在长期使用的弱点。

我应该补充一点，SHA1 也有理论上的漏洞，但没有那么严重。散列技术的当前状态是有许多候选替换散列函数，但还没有出现作为替换 SHA1 的标准最佳实践。因此，根据您的需要，建议您将哈希算法配置为可配置的，以便将来可以替换它。

* * *

## 回答 #18

> 赞同：13
> 
> 时间：2011-03-16T13:16:30.507

另一个实现：[Java 中的快速 MD5 实现](http://www.twmacinta.com/myjava/fast_md5.php)

```
String hash = MD5.asHex(MD5.getHash(new File(filename))); 
```

* * *

## 回答 #19

> 赞同：11
> 
> 时间：2012-06-25T12:44:36.207

我不知道这是否与阅读本文的任何人有关，但我只是遇到了我想要的问题

*   从给定的 URL 下载文件**并**
*   将其 MD5 与已知值进行比较。

我只想用 JRE 类来做（没有 Apache Commons 或类似的）。快速的网络搜索并没有向我显示同时执行**这两个**任务的示例代码片段，而只是分别执行了每个任务。因为这需要读取同一个文件两次，所以我认为编写一些统一这两个任务的代码可能是值得的，在下载文件时即时计算校验和。这是我的结果（对不起，如果它不是完美的 Java，但我想你还是明白了）：

```
import java.io.FileOutputStream;
import java.io.IOException;
import java.math.BigInteger;
import java.net.URL;
import java.nio.ByteBuffer;
import java.nio.channels.Channels;
import java.nio.channels.ReadableByteChannel;
import java.nio.channels.WritableByteChannel;
import java.security.DigestOutputStream;        // new
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;

void downloadFile(String fromURL, String toFile, BigInteger md5)
    throws IOException, NoSuchAlgorithmException
{
    ReadableByteChannel in = Channels.newChannel(new URL(fromURL).openStream());
    MessageDigest md5Digest = MessageDigest.getInstance("MD5");
    WritableByteChannel out = Channels.newChannel(
        //new FileOutputStream(toFile));  // old
        new DigestOutputStream(new FileOutputStream(toFile), md5Digest));  // new
    ByteBuffer buffer = ByteBuffer.allocate(1024 * 1024);  // 1 MB

    while (in.read(buffer) != -1) {
        buffer.flip();
        //md5Digest.update(buffer.asReadOnlyBuffer());  // old
        out.write(buffer);
        buffer.clear();
    }

    BigInteger md5Actual = new BigInteger(1, md5Digest.digest()); 
    if (! md5Actual.equals(md5))
        throw new RuntimeException(
            "MD5 mismatch for file " + toFile +
            ": expected " + md5.toString(16) +
            ", got " + md5Actual.toString(16)
        );
} 
```

* * *

## 回答 #20

> 赞同：8
> 
> 时间：2016-03-26T15:23:48.777

与 PHP 不同，您只需调用 md5 函数即可对文本进行 MD5 散列，即`md5($text)`在 Java 中，它变得有点复杂。我通常通过调用一个返回 md5 哈希文本的函数来实现它。这是我实现它的方式，首先`md5hashing`在你的主类中创建一个名为的函数，如下所示。

```
public static String md5hashing(String text)
    {   String hashtext = null;
        try 
        {
            String plaintext = text;
            MessageDigest m = MessageDigest.getInstance("MD5");
            m.reset();
            m.update(plaintext.getBytes());
            byte[] digest = m.digest();
            BigInteger bigInt = new BigInteger(1,digest);
            hashtext = bigInt.toString(16);
            // Now we need to zero pad it if you actually want the full 32 chars.
            while(hashtext.length() < 32 ){
              hashtext = "0"+hashtext;   
            }
        } catch (Exception e1) 
        {
            // TODO: handle exception
            JOptionPane.showMessageDialog(null,e1.getClass().getName() + ": " + e1.getMessage());   
        }
        return hashtext;     
    } 
```

现在在需要时调用该函数，如下所示。

```
String text = textFieldName.getText();
String pass = md5hashing(text); 
```

在这里，您可以看到 hashtext 附加了一个零，以使其与 PHP 中的 md5 散列匹配。

* * *

## 回答 #21

> 赞同：8
> 
> 时间：2018-01-29T18:12:17.697

```
import java.security.*;
import javax.xml.bind.*;

byte[] bytesOfMessage = yourString.getBytes("UTF-8");
MessageDigest md = MessageDigest.getInstance("MD5");
byte[] bytesOfDigest = md.digest(bytesOfMessage);
String digest = DatatypeConverter.printHexBinary(bytesOfDigest).toLowerCase(); 
```

* * *

## 回答 #22

> 赞同：6
> 
> 时间：2012-10-26T17:01:41.943

对于它的价值，我偶然发现了这个，因为我想从一个将安装 COM 组件的程序的自然键合成 GUID；我想合成，以免管理 GUID 生命周期。我将使用 MD5，然后使用 UUID 类从中获取字符串。（http://stackoverflow.com/questions/2190890/how-can-i-generate-guid-for-a-string-values/12867439 提出了这个问题）。

在任何情况下，java.util.UUID 都可以从 MD5 字节中获得一个不错的字符串。

```
return UUID.nameUUIDFromBytes(md5Bytes).toString(); 
```

* * *

## 回答 #23

> 赞同：5
> 
> 时间：2009-01-08T08:42:23.253

如果您不需要最好的安全性，MD5 非常好，如果您正在做检查文件完整性之类的事情，那么安全性就不是考虑因素。在这种情况下，您可能需要考虑更简单、更快的东西，例如 Adler32，它也受 Java 库支持。

* * *

## 回答 #24

> 赞同：5
> 
> 时间：2016-04-18T15:00:38.893

这个给出了从 mysql 的 md5 函数或 php 的 md5 函数等获得的确切 md5。这是我使用的（你可以根据需要更改）

```
public static String md5( String input ) {
    try {
        java.security.MessageDigest md = java.security.MessageDigest.getInstance("MD5");
        byte[] array = md.digest(input.getBytes( "UTF-8" ));
        StringBuffer sb = new StringBuffer();
        for (int i = 0; i < array.length; i++) {
            sb.append( String.format( "%02x", array[i]));
        }
        return sb.toString();
    } catch ( NoSuchAlgorithmException | UnsupportedEncodingException e) {
        return null;            
    }

} 
```

* * *

## 回答 #25

> 赞同：5
> 
> 时间：2017-01-04T10:26:57.310

```
import java.security.MessageDigest

val digest = MessageDigest.getInstance("MD5")

//Quick MD5 of text
val text = "MD5 this text!"
val md5hash1 = digest.digest(text.getBytes).map("%02x".format(_)).mkString

//MD5 of text with updates
digest.update("MD5 ".getBytes())
digest.update("this ".getBytes())
digest.update("text!".getBytes())
val md5hash2 = digest.digest().map(0xFF & _).map("%02x".format(_)).mkString

//Output
println(md5hash1 + " should be the same as " + md5hash2) 
```

* * *

## 回答 #26

> 赞同：5
> 
> 时间：2019-01-03T11:30:35.117

您可以通过使用包中类中的方法为给定文本[生成 MD5 哈希](https://www.myjavacode.com/how-to-generate-md5-hash-in-java/)。下面是完整的代码片段，`MessageDigest``java.security`

```
import java.security.MessageDigest;
import java.security.NoSuchAlgorithmException;
import javax.xml.bind.DatatypeConverter;

public class MD5HashGenerator 
{

   public static void main(String args[]) throws NoSuchAlgorithmException
   {
       String stringToHash = "MyJavaCode"; 
       MessageDigest messageDigest = MessageDigest.getInstance("MD5");
       messageDigest.update(stringToHash.getBytes());
       byte[] digiest = messageDigest.digest();
       String hashedOutput = DatatypeConverter.printHexBinary(digiest);
       System.out.println(hashedOutput);
   }
} 
```

MD5 函数的输出是由 32 个十六进制数字表示的 128 位哈希。

如果您使用的是 MySQL 之类的数据库，您也可以以更简单的方式执行此操作。该查询`Select MD5(“text here”)`将返回括号中文本的 MD5 哈希值。

* * *

## 回答 #27

> 赞同：4
> 
> 时间：2015-01-13T00:06:43.660

试试这个：

```
public static String getHashMD5(String string) {
    try {
        MessageDigest md = MessageDigest.getInstance("MD5");
        BigInteger bi = new BigInteger(1, md.digest(string.getBytes()));
        return bi.toString(16);
    } catch (NoSuchAlgorithmException ex) {
        Logger.getLogger(MD5Utils.class
                .getName()).log(Level.SEVERE, null, ex);

        return "";
    }
} 
```

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2015-10-20T18:27:54.637

这就是我来这里的目的——一个方便的 scala 函数，它返回 MD5 哈希字符串：

```
def md5(text: String) : String = java.security.MessageDigest.getInstance("MD5").digest(text.getBytes()).map(0xFF & _).map { "%02x".format(_) }.foldLeft(""){_ + _} 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2013-10-20T13:33:59.200

```
 import java.math.BigInteger;
 import java.security.MessageDigest;
 import java.security.NoSuchAlgorithmException;

/**
* MD5 encryption
*
* @author Hongten
*
*/
public class MD5 {

 public static void main(String[] args) {
     System.out.println(MD5.getMD5("123456"));
 }

 /**
  * Use md5 encoded code value
  *
  * @param sInput
  * clearly
  * @ return md5 encrypted password
  */
 public static String getMD5(String sInput) {

     String algorithm = "";
     if (sInput == null) {
         return "null";
     }
     try {
         algorithm = System.getProperty("MD5.algorithm", "MD5");
     } catch (SecurityException se) {
     }
     MessageDigest md = null;
     try {
         md = MessageDigest.getInstance(algorithm);
     } catch (NoSuchAlgorithmException e) {
         e.printStackTrace();
     }
     byte buffer[] = sInput.getBytes();

     for (int count = 0; count < sInput.length(); count++) {
         md.update(buffer, 0, count);
     }
     byte bDigest[] = md.digest();
     BigInteger bi = new BigInteger(bDigest);
     return (bi.toString(16));
 }
} 
```

Codingkit 上有一篇关于此的文章。查看：[http ://codingkit.com/a/JAVA/2013/1020/2216.html](http://codingkit.com/a/JAVA/2013/1020/2216.html)

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2021-01-17T14:04:54.207

您可以尝试使用[Caesar](https://github.com/Glusk/caesar)。

第一个选项：

```
byte[] hash =
    new Hash(
        new ImmutableMessageDigest(
            MessageDigest.getInstance("MD5")
        ),
        new PlainText("String to hash...")
    ).asArray(); 
```

第二种选择：

```
byte[] hash =
    new ImmutableMessageDigest(
        MessageDigest.getInstance("MD5")
    ).update(
        new PlainText("String to hash...")
    ).digest(); 
```

* * *

## 回答 #31

> 赞同：-1
> 
> 时间：2016-04-11T17:29:55.347

```
private String hashuj(String dane) throws ServletException{
    try {
        MessageDigest m = MessageDigest.getInstance("MD5");
        byte[] bufor = dane.getBytes();
        m.update(bufor,0,bufor.length);
        BigInteger hash = new BigInteger(1,m.dige`enter code here`st());
        return String.format("%1$032X", hash);

    } catch (NoSuchAlgorithmException nsae) {
        throw new ServletException("Algorytm szyfrowania nie jest obsługiwany!");
    }
} 
```

* * *

## 回答 #32

> 赞同：-3
> 
> 时间：2012-06-25T09:24:43.587

我这样做了......似乎工作正常 - 我相信有人会指出错误......

```
public final class MD5 {
public enum SaltOption {
    BEFORE, AFTER, BOTH, NONE;
}
private static final String ALG = "MD5";
//For conversion to 2-char hex
private static final char[] digits = {
    '0' , '1' , '2' , '3' , '4' , '5' ,
    '6' , '7' , '8' , '9' , 'a' , 'b' ,
    'c' , 'd' , 'e' , 'f' , 'g' , 'h' ,
    'i' , 'j' , 'k' , 'l' , 'm' , 'n' ,
    'o' , 'p' , 'q' , 'r' , 's' , 't' ,
    'u' , 'v' , 'w' , 'x' , 'y' , 'z'
};

private SaltOption opt;

/**
 * Added the SaltOption constructor since everybody
 * has their own standards when it comes to salting
 * hashes.
 * 
 * This gives the developer the option...
 * 
 * @param option The salt option to use, BEFORE, AFTER, BOTH or NONE.
 */
public MD5(final SaltOption option) {
    //TODO: Add Char Encoding options too... I was too lazy!
    this.opt = option;
}

/**
 * 
 * Returns the salted MD5 checksum of the text passed in as an argument.
 * 
 * If the salt is an empty byte array - no salt is applied.
 * 
 * @param txt The text to run through the MD5 algorithm.
 * @param salt The salt value in bytes.
 * @return The salted MD5 checksum as a <code>byte[]</code>
 * @throws NoSuchAlgorithmException
 */
private byte[] createChecksum(final String txt, final byte[] salt) throws NoSuchAlgorithmException {
    final MessageDigest complete = MessageDigest.getInstance(ALG);
    if(opt.equals(SaltOption.BEFORE) || opt.equals(SaltOption.BOTH)) {
        complete.update(salt);
    }
    complete.update(txt.getBytes());
    if(opt.equals(SaltOption.AFTER) || opt.equals(SaltOption.BOTH)) {
        complete.update(salt);
    }
    return complete.digest();
}

/**
 * 
 * Returns the salted MD5 checksum of the file passed in as an argument.
 * 
 * If the salt is an empty byte array - no salt is applied.
 * 
 * @param fle The file to run through the MD5 algorithm.
 * @param salt The salt value in bytes.
 * @return The salted MD5 checksum as a <code>byte[]</code>
 * @throws IOException
 * @throws NoSuchAlgorithmException
 */
private byte[] createChecksum(final File fle, final byte[] salt)
        throws IOException, NoSuchAlgorithmException {
    final byte[] buffer = new byte[1024];
    final MessageDigest complete = MessageDigest.getInstance(ALG);
            if(opt.equals(SaltOption.BEFORE) || opt.equals(SaltOption.BOTH)) {
            complete.update(salt);
        }
    int numRead;
    InputStream fis = null;
    try {
        fis = new FileInputStream(fle);
        do {
            numRead = fis.read(buffer);
            if (numRead > 0) {
                complete.update(buffer, 0, numRead);
            }
        } while (numRead != -1);
    } finally {
    if (fis != null) {
            fis.close();
        }
    }
            if(opt.equals(SaltOption.AFTER) || opt.equals(SaltOption.BOTH)) {
            complete.update(salt);
        }
    return complete.digest();
}

/**
 * 
 * Efficiently converts a byte array to its 2 char per byte hex equivalent.
 * 
 * This was adapted from JDK code in the Integer class, I just didn't like
 * having to use substrings once I got the result...
 *
 * @param b The byte array to convert
 * @return The converted String, 2 chars per byte...
 */
private String convertToHex(final byte[] b) {
    int x;
    int charPos;
    int radix;
    int mask;
    final char[] buf = new char[32];
    final char[] tmp = new char[3];
    final StringBuilder md5 = new StringBuilder();
    for (int i = 0; i < b.length; i++) {
        x = (b[i] & 0xFF) | 0x100;
        charPos = 32;
        radix = 1 << 4;
        mask = radix - 1;
        do {
            buf[--charPos] = digits[x & mask];
            x >>>= 4;
        } while (x != 0);
        System.arraycopy(buf, charPos, tmp, 0, (32 - charPos));
        md5.append(Arrays.copyOfRange(tmp, 1, 3));
    }
    return md5.toString();
}

/**
 * 
 * Returns the salted MD5 checksum of the file passed in as an argument.
 * 
 * @param fle The file you want want to run through the MD5 algorithm.
 * @param salt The salt value in bytes
 * @return The salted MD5 checksum as a 2 char per byte HEX <code>String</code>
 * @throws NoSuchAlgorithmException
 * @throws IOException
 */
public String getMD5Checksum(final File fle, final byte[] salt)
        throws NoSuchAlgorithmException, IOException {
    return convertToHex(createChecksum(fle, salt));
}

/**
 * 
 * Returns the MD5 checksum of the file passed in as an argument.
 * 
 * @param fle The file you want want to run through the MD5 algorithm.
 * @return The MD5 checksum as a 2 char per byte HEX <code>String</code>
 * @throws NoSuchAlgorithmException
 * @throws IOException
 */
public String getMD5Checksum(final File fle)
        throws NoSuchAlgorithmException, IOException {
    return convertToHex(createChecksum(fle, new byte[0]));
}

/**
 * 
 * Returns the salted MD5 checksum of the text passed in as an argument.
 * 
 * @param txt The text you want want to run through the MD5 algorithm.
 * @param salt The salt value in bytes.
 * @return The salted MD5 checksum as a 2 char per byte HEX <code>String</code>
 * @throws NoSuchAlgorithmException
 * @throws IOException
 */
public String getMD5Checksum(final String txt, final byte[] salt)
        throws NoSuchAlgorithmException {
    return convertToHex(createChecksum(txt, salt));
}

/**
 * 
 * Returns the MD5 checksum of the text passed in as an argument.
 * 
 * @param txt The text you want want to run through the MD5 algorithm.
 * @return The MD5 checksum as a 2 char per byte HEX <code>String</code>
 * @throws NoSuchAlgorithmException
 * @throws IOException
 */
public String getMD5Checksum(final String txt)
        throws NoSuchAlgorithmException {

    return convertToHex(createChecksum(txt, new byte[0]));
}
} 
```

* * *

## 回答 #33

> 赞同：-6
> 
> 时间：2020-05-10T20:02:42.330

我使用 php 制作了这个，如下所示

```
<?php
$goodtext = "Not found";
// If there is no parameter, this code is all skipped
if ( isset($_GET['md5']) ) {
    $time_pre = microtime(true);
    $md5 = $_GET['md5'];
    // This is our alphabet
    $txt = "0123456789";
    $show = 15;
    // Outer loop go go through the alphabet for the
    // first position in our "possible" pre-hash
    // text
    for($i=0; $i<strlen($txt); $i++ ) {
        $ch1 = $txt[$i];   // The first of two characters
        // Our inner loop Note the use of new variables
        // $j and $ch2 
        for($j=0; $j<strlen($txt); $j++ ) {
            $ch2 = $txt[$j];  // Our second character
            for($k=0; $k<strlen($txt); $k++ ) {
                $ch3 = $txt[$k];
                for($l=0; $l<strlen($txt); $l++){
                    $ch4 = $txt[$l];
                    // Concatenate the two characters together to 
                    // form the "possible" pre-hash text
                    $try = $ch1.$ch2.$ch3.$ch4;
                    // Run the hash and then check to see if we match
                    $check = hash('md5', $try);
                    if ( $check == $md5 ) {
                        $goodtext = $try;
                        break;   // Exit the inner loop
                    }
                    // Debug output until $show hits 0
                    if ( $show > 0 ) {
                        print "$check $try\n";
                        $show = $show - 1;
                    }
                    if($goodtext == $try){
                        break;
                    }
                }
                if($goodtext == $try){
                    break;
                }
            }
            if($goodtext == $try) {
                break;  
            }
        }
        if($goodtext == $try){
            break;
        }
    }
    // Compute ellapsed time
    $time_post = microtime(true);
    print "Ellapsed time: ";
    print $time_post-$time_pre;
    print "\n";
}
?> 
```

你可以参考这个 -[来源](https://github.com/csev/wa4e/tree/master/code/crack)

# xml - XSD - 如何描述一组无序的元素类型，其中第一个元素必须首先出现在序列中？

> ID：415955
> 
> 赞同：22
> 
> 时间：2009-01-06T09:47:33.313
> 
> 标签：xml, schema, xsd

这是一个 XML 模式问题。

我知道该`xsd:all`元素不能出现在序列中（必须是其类型的顶级元素）。

也就是说，我不能使用以下内容：

```
<xsd:complexType name="Application">
  <xsd:sequence>
    <xsd:element ref="Name"></xsd:element>
    <xsd:all>
      <xsd:element ref="ADD"></xsd:element>
      <xsd:element ref="DELETE"></xsd:element>
    </xsd:all>
  </xsd:sequence>
</xsd:complexType> 
```

我的问题是如何以任何顺序（无序集）声明上面的“ADD”和“DELETE”元素，但仍然确保元素“Name”是第一个并且总是出现。（想想我不仅有“ADD”和“DELETE”，还有大约 10 个或更多无序元素集的情况：ADD、DELETE、EDIT 等......）

重要提示：添加和删除可能只出现一次，但它们的顺序无关紧要：

```
<Application>
  <NAME>
  <DELETE>
  <ADD>
</Application> 
```

但不是：

```
<Application>
  <NAME>
  <DELETE>
  <ADD>
  <DELETE> <!--cannot appear twice-->
</Application> 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-06T10:15:05.190

如果我理解您的要求，您的要求是正确的，那么您唯一缺少的就是您选择的 maxOccurs="unbounded" 。

我创建了以下架构：

```
<?xml version="1.0"?>
<xs:schema targetNamespace="http://someNamespace" xmlns="http://someNamespace" xmlns:xs="http://www.w3.org/2001/XMLSchema">
  <xs:element name="Root" type="Application">
  </xs:element>

  <xs:complexType name="Application">
    <xs:sequence>
      <xs:element ref="Name"></xs:element>
      <xs:choice maxOccurs="unbounded">
        <xs:element ref="ADD"></xs:element>
        <xs:element ref="DELETE"></xs:element>
      </xs:choice>
    </xs:sequence>
  </xs:complexType>

  <xs:element name="Name"/>
  <xs:element name="ADD"/>
  <xs:element name="DELETE"/>
</xs:schema> 
```

它适用于

```
<ns0:Root xmlns:ns0="http://someNamespace">
  <ns0:Name />
  <ns0:ADD />
  <ns0:ADD />
  <ns0:DELETE />
  <ns0:ADD />
  <ns0:DELETE />
  <ns0:DELETE />
</ns0:Root> 
```

但不是为了

```
<ns0:Root xmlns:ns0="http://someNamespace">
  <ns0:ADD />
  <ns0:ADD />
  <ns0:DELETE />
  <ns0:ADD />
  <ns0:DELETE />
  <ns0:DELETE />
</ns0:Root> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-02-05T13:00:36.157

我认为您正在寻找“全部”元素，它允许无序列表。但是，您可以在其中放置的元素受到限制。请参阅[http://www.w3.org/2005/07/xml-schema-patterns.html#Collection](http://www.w3.org/2005/07/xml-schema-patterns.html#Collection)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2016-06-06T16:29:30.677

很抱歉，您已经为这个问题苦苦挣扎了 7 年，却没有任何答案。

我将通过重新审视您的假设来提供帮助。

通过将“名称”视为必须首先出现的一条数据，并要求它必须是 Application 的子项，然后一般说您不关心其兄弟姐妹的顺序，您正在制造一个令人困惑的情况为自己。如果 Name 遵循不同的规则并服务于不同的目的，为什么它是 ADD 和 DELETE 的兄弟？如果您必须在任何其他数据结构中对此进行建模，则不会在“添加”和“删除”旁边的事物列表中包含“名称”。你会说两件事：一个应用程序有一个名称，它还有一个命令列表，例如 ADD 和 DELETE。

由于与 ADD 和 DELETE 相比，Name 是一个特殊的东西，所以它应该与其他标签分开建模。

因此，您可以将 Name 设为 Application 的属性，并将 Add 和 Delete 保留为子元素，或者您可以将 Name 保留为子元素，然后用占位符/分组标记（例如 Commands）围绕 ADD 和 DELETE。Commands 标签将是 Name 的唯一兄弟。

这是一个支持 Name 作为属性的模式，具有任意数量的任意顺序的命令。“名称为 Attribute.xsd”：

```
<?xml version="1.0"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema">
    <xs:element name="Application" type="Application_Type" />
    <xs:complexType name="Application_Type">
            <xs:all>
                <xs:element minOccurs="0" ref="ADD"/>
                <xs:element minOccurs="0" ref="DELETE"/>
                <xs:element minOccurs="0" ref="THIRD"/>
                <xs:element minOccurs="0" ref="FOURTH"/>
            </xs:all>
            <xs:attribute name="Name"/>
    </xs:complexType>
    <xs:element name="ADD"/>
    <xs:element name="DELETE"/>
    <xs:element name="THIRD"/>  
    <xs:element name="FOURTH"/> 
</xs:schema> 
```

示例 XML：

```
<?xml version="1.0" encoding="UTF-8"?>
<Application xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" Name="text" xsi:noNamespaceSchemaLocation="Name as Attribute.xsd">
    <THIRD>text</THIRD>
    <ADD>text</ADD>
    <FOURTH>text</FOURTH>
    <DELETE>text</DELETE>
</Application> 
```

这是一个嵌套在占位符标记中的命令。“命令分组.xsd”：

```
<?xml version="1.0"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema">
    <xs:element name="Application" type="Application_Type"/>
    <xs:complexType name="Application_Type">
        <xs:sequence>
            <xs:element ref="Name"/>
            <xs:element name="Commands" type="Commands_Type"/>
        </xs:sequence>
    </xs:complexType>
    <xs:complexType name="Commands_Type">
        <xs:all>
            <xs:element minOccurs="0" ref="ADD"/>
            <xs:element minOccurs="0" ref="DELETE"/>
            <xs:element minOccurs="0" ref="THIRD"/>
            <xs:element minOccurs="0" ref="FOURTH"/>
        </xs:all>
    </xs:complexType>
    <xs:element name="Name"/>
    <xs:element name="ADD"/>
    <xs:element name="DELETE"/>
    <xs:element name="THIRD"/>
    <xs:element name="FOURTH"/>
</xs:schema> 
```

示例 XML：

```
<?xml version="1.0" encoding="UTF-8"?>
<Application xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="Commands Grouping.xsd">
    <Name>text</Name>
    <Commands>
        <THIRD>text</THIRD>
        <ADD>text</ADD>
        <FOURTH>text</FOURTH>
        <DELETE>text</DELETE>
    </Commands>
</Application> 
```

关于其中任何一个的一个注意事项是，带有零命令的消息仍然是有效消息。也许这没关系，但如果这是一个问题，那么验证可能属于应用程序层而不是 XSD。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-08T00:32:30.920

我不相信如果不枚举 ADD、DELETE 等的每个组合就可以做到这一点。一般来说，无论是使用 DTD 还是模式，无序列表都不能很好地发挥作用。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-11-26T10:53:05.857

您可以使用序列类型实现无序列表`xs:choice`。

```
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema">
 <xs:element name="Application"/>
  <xs:complexType>
   <xs:element name="NAME">
    <xs:sequence>
     <xs:choice minOccurs="0" maxOccurs="unbounded">
      <xs:element name="ADD" type="xs:string"/>
      <xs:element name="DELETE" type="xs:string"/>
     </xs:choice>
    </xs:element>
   </xs:sequence>
  </xs:complexType>
 </xs:element>
</xs:schema> 
```

通过这种方式，您可以限制用户在元素内使用他们想要的任何标签，`<NAME/>`但允许他们尽可能频繁`<ADD/>`地使用。`<DELETE/>`

# delphi - 如何自动释放类/对象？

> ID：415958
> 
> 赞同：12
> 
> 时间：2009-01-06T09:52:34.050
> 
> 标签：delphi

有哪些技术可以在 delphi 应用程序中自动释放对象？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-01-06T09:55:03.873

使用接口而不是对象。它们被引用计数并在引用计数达到 0 时自动释放。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-01-06T21:17:44.153

我编写了一个函数 GC(obj: TObject) （用于垃圾收集），它接受一个对象并在执行离开当前方法时释放它。它有点像 Try finally Free 块的单行速记函数。

代替：

```
procedure Test;
var AQuery: TQuery;
begin
  AQuery := TQuery.Create(nil);
  try
    ...
  finally
    FreeAndNil(AQuery);
  end;
end; 
```

我只有：

```
procedure Test;
var AQuery: TQuery;
begin
  AQuery := TQuery.Create(nil);
  GC(AQuery);
  ...
end; 
```

GC 函数只是以接口的形式返回一个对象。

```
function GC(obj: TObject): IGarbo;
begin
  Result := TGarbo.Create(obj);
end; 
```

因为 TGarbo 类继承自 TInterfacedObject，所以当 TGarbo 对象超出范围时，它会自动被释放。在 TGarbo 对象的析构函数中，它还释放了你在它的构造函数中传递给它的对象（你在 GC 函数中传递的对象）。

```
type
  IGarbo = interface
    ['{A6E17957-C233-4433-BCBD-3B53C0C2C596}']
    function Obj: TObject;
  end;

  TGarbo = class(TInterfacedObject, IGarbo)
  private
    FObj: TObject;
  public
    constructor Create(AObjectToGC: TObject);
    destructor Destroy; override;
    function Obj: TObject;
  end;

{ TGarbo }

constructor TGarbo.Create(AObjectToGC: TObject);
begin
  inherited Create;
  FObj := AObjectToGC;
end;

destructor TGarbo.Destroy;
begin
  if Assigned(FObj) then
    FreeAndNil(FObj);
  inherited;
end;

function TGarbo.Obj: TObject;
begin
  Result := FObj;
end; 
```

被困在 Delphi 7 的世界里，看不到在不久的将来升级到带有内置垃圾收集的 Delphi 版本，我沉迷于使用这种轻松释放本地临时对象的速记方法！:)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-06T18:19:43.997

沿着接口线，你可以尝试单元`Guard`中的功能`JclSysUtils`，它是免费的[绝地代码库](http://jcl.sf.net/)的一部分。它允许您将对象与*单独*的接口引用相关联，因此当该接口引用被销毁时，该对象将与它一起被销毁。当您没有选择修改您正在使用的类以使它们支持自己的接口时，这可能很有用。

```
var
  G: ISafeGuard;
  foo: TStrings;
begin
  // Guard returns TObject, so a type-cast is necessary
  foo := Guard(TStringList.Create, G) as TStrings;
  // Use the object as normal
  foo.Add('bar');
end; // foo gets freed automatically as G goes out of scope 
```

`GetMem`对象和分配的指针有重载。还有`IMultiSafeGuard`, 可以保证多个对象被释放。

如果你有一个工厂函数，你可能会创建一个对象，设置它的一些属性，然后返回它。如果在设置属性时发生异常，您需要确保释放该对象，因为您无法返回它。一种方法是这样的：

```
function Slurp(const source: TFileName): TStrings;
begin
  Result := TStringList.Create;
  try
    Result.LoadFromFile(source);
  except
    Result.Free;
    raise;
  end;
end; 
```

，`Guard`它会变成这样：

```
function Slurp(const source: TFileName): TStrings;
var
  G: ISafeGuard;
begin
  Result := Guard(TStringList.Create, G) as TStrings;
  Result.LoadFromFile(source);
  G.ReleaseItem;
end; 
```

该`ReleaseItem`方法撤销`ISafeGuard`对象的所有权。如果在此之前发生异常，则随着堆栈展开并释放接口，守卫将释放对象。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-06T12:59:08.450

我不得不说，我不喜欢“隐藏”一个对象的自由。拥有传统代码要好得多：

```
MyObject := TObject.Create;
try
  // do stuff
finally
  FreeAndNil(MyObject);
end; 
```

它不可能出错，按预期工作，并且人们识别出这种模式。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-01-06T10:04:37.210

使用 VCL 提供的组件的对象所有权。只要您创建具有非零所有者的对象，您就不需要显式地释放它们。另请参阅我对[这个](https://stackoverflow.com/questions/398137/what-is-the-best-way-to-do-nested-try-and-finally-statement-in-delphi)问题的回答。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-09T02:23:51.210

这是用于 Delphi[的 Boehm 垃圾收集器 DLL 的 API 。](http://cc.codegear.com/Item/21646)Delphi API 由[Barry Kelly](http://barrkel.blogspot.com/)编写，他现在为 CodeGear 编写编译器。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-06T11:56:08.420

[如果你有 Delphi 2009，智能指针](http://barrkel.blogspot.com/2008/11/somewhat-more-efficient-smart-pointers.html)工作得很好。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-01-06T10:33:18.603

如果您将 Delphi 用于 .Net / Delphi Prism，您将获得负责所有释放的垃圾收集。

# c# - 在 C# 中验证文件是否存在

> ID：415962
> 
> 赞同：26
> 
> 时间：2009-01-06T09:54:23.750
> 
> 标签：c#, asp.net, file-exists

我正在开发一个应用程序。该应用程序应该从用户那里获得简历，因此我需要一个代码来验证文件是否存在。

我正在使用 ASP.NET / C#。

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2009-01-06T10:01:16.467

可以使用命名空间中类的`Exists`方法判断指定文件是否存在：`File``System.IO`

```
bool System.IO.File.Exists(string path) 
```

您可以[在 MSDN 上找到文档](http://msdn.microsoft.com/en-us/library/system.io.file.exists.aspx)。

**例子：**

```
using System;
using System.IO;

class Test
{
    public static void Main()
    {
        string resumeFile = @"c:\ResumesArchive\923823.txt";
        string newFile = @"c:\ResumesImport\newResume.txt";
        if (File.Exists(resumeFile))
        {
            File.Copy(resumeFile, newFile);
        }
        else
        {
            Console.WriteLine("Resume file does not exist.");
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-01-06T09:58:17.673

要测试文件是否存在于 .NET 中，您可以使用

```
System.IO.File.Exists (String) 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2013-11-27T22:30:14.027

```
 if (File.Exists(Server.MapPath("~/Images/associates/" + Html.DisplayFor(modelItem => item.AssociateImage)))) 
      { 
        <img src="~/Images/associates/@Html.DisplayFor(modelItem => item.AssociateImage)"> 
      }
        else 
      { 
        <h5>No image available</h5> 
      } 
```

我做了这样的事情来检查图像在显示之前是否存在。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2016-03-04T16:44:15.323

尝试这个：

```
 string fileName = "6d294041-34d1-4c66-a04c-261a6d9aee17.jpeg";

     string deletePath= "/images/uploads/";

     if (!string.IsNullOrEmpty(fileName ))
        {
            // Append the name of the file to previous image.
            deletePath += fileName ;

            if (File.Exists(HttpContext.Current.Server.MapPath(deletePath)))
            {
                // deletevprevious image
                File.Delete(HttpContext.Current.Server.MapPath(deletePath));
            }
        } 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-06T12:59:36.450

简单的回答是你不能——你不能从 ASP 网站检查他们机器上的文件，因为这样做对他们来说是危险的风险。

你必须给他们一个文件上传控制——你可以用这个控制做的不多。出于安全原因，javascript 无法真正触及它。

```
<asp:FileUpload ID="FileUpload1" runat="server" /> 
```

然后他们选择要上传的文件，您必须处理他们可能发送到服务器端的任何空文件。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-06T09:58:59.373

你可以使用：

```
System.IO.File.Exists(@"c:\temp\test.txt"); 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-06T12:20:26.513

还不能发表评论，但我只是想不同意/澄清[erikkallen](https://stackoverflow.com/questions/415962/verify-file-exist-or-not/416029#416029)。

您不应该只在您描述的情况下捕获异常。如果您知道该文件应该在那里并且由于某些*特殊*情况，它不是，那么尝试访问该文件并捕获发生的任何异常是可以接受的。

但是，在这种情况下，您正在接收来自用户的输入，并且没有理由相信该文件存在。在这里，您应该始终使用 File.Exists()。

我知道这是陈词滥调，但您应该只将异常用于异常事件，而不是作为应用程序正常流程的一部分。它很昂贵，并且使代码更难以阅读/遵循。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-06T12:43:50.443

这些答案都假设您正在检查的文件位于服务器端。不幸的是，没有铸铁方法可以确保文件存在于客户端（例如，如果您正在上传简历）。当然，你可以在 Javascript 中做到这一点，但你仍然不能 100% 确定在服务器端。

在我看来，处理这个问题的最好方法是假设用户实际上会选择一个合适的文件进行上传，然后做任何你需要做的工作来确保上传的文件是你期望的（提示 - 假设用户正试图用他/她的输入以各种可能的方式毒化你的系统）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-06T12:45:16.730

你写了 asp.net - 你想上传文件吗？
如果是这样，您可以使用 html

> <输入类型="文件" ...

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-06T10:23:55.110

除了 using 之外`File.Exists()`，您最好尝试使用该文件并捕获引发的任何异常。该文件可能由于其他原因而无法打开，而不是不存在。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-01-30T05:20:41.863

这可能会对您有所帮助。

```
try
   {
       con.Open();
       if ((fileUpload1.PostedFile != null) && (fileUpload1.PostedFile.ContentLength > 0))
       {
           filename = System.IO.Path.GetFileName(fileUpload1.PostedFile.FileName);
           ext = System.IO.Path.GetExtension(filename).ToLower();
           string str=@"/Resumes/" + filename;
           saveloc = (Server.MapPath(".") + str);
           string[] exts = { ".doc", ".docx", ".pdf", ".rtf" };
           for (int i = 0; i < exts.Length; i++)
           {
               if (ext == exts[i])
                   fileok = true;
           }
           if (fileok)
           {
               if (File.Exists(saveloc))
                   throw new Exception(Label1.Text="File exists!!!");
               fileUpload1.PostedFile.SaveAs(saveloc);
               cmd = new SqlCommand("insert into candidate values('" + candidatename + "','" + candidatemail + "','" + candidatemobile + "','" + filename + "','" + str + "')", con);
               cmd.ExecuteNonQuery();
               Label1.Text = "Upload Successful!!!";
               Label1.ForeColor = System.Drawing.Color.Blue;
               con.Close();
           }
           else
           {
               Label1.Text = "Upload not successful!!!";
               Label1.ForeColor = System.Drawing.Color.Red;
           }
       }

    }
   catch (Exception ee) { Label1.Text = ee.Message; } 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-01-08T10:03:10.767

我已经在 vb 中编写了这段代码，它可以很好地检查文件是否存在以进行文件上传控制。试试看

对于 VB 代码 ============

```
 If FileUpload1.HasFile = True Then
        Dim FileExtension As String = System.IO.Path.GetExtension(FileUpload1.FileName)

        If FileExtension.ToLower <> ".jpg" Then
            lblMessage.ForeColor = System.Drawing.Color.Red
            lblMessage.Text = "Please select .jpg image file to upload"
        Else
            Dim FileSize As Integer = FileUpload1.PostedFile.ContentLength

            If FileSize > 1048576 Then
                lblMessage.ForeColor = System.Drawing.Color.Red
                lblMessage.Text = "File size (1MB) exceeded"
            Else
                Dim FileName As String = System.IO.Path.GetFileName(FileUpload1.FileName)

                Dim ServerFileName As String = Server.MapPath("~/Images/Folder1/" + FileName)

                If System.IO.File.Exists(ServerFileName) = False Then
                    FileUpload1.SaveAs(Server.MapPath("~/Images/Folder1/") + FileUpload1.FileName)
                    lblMessage.ForeColor = System.Drawing.Color.Green
                    lblMessage.Text = "File : " + FileUpload1.FileName + " uploaded successfully"
                Else
                    lblMessage.ForeColor = System.Drawing.Color.Red
                    lblMessage.Text = "File : " + FileName.ToString() + " already exsist"
                End If
            End If
        End If
    Else
        lblMessage.ForeColor = System.Drawing.Color.Red
        lblMessage.Text = "Please select a file to upload"
    End If 
```

对于 C# 代码 =======================

```
if (FileUpload1.HasFile == true) {
    string FileExtension = System.IO.Path.GetExtension(FileUpload1.FileName);

    if (FileExtension.ToLower != ".jpg") {
        lblMessage.ForeColor = System.Drawing.Color.Red;
        lblMessage.Text = "Please select .jpg image file to upload";
    } else {
        int FileSize = FileUpload1.PostedFile.ContentLength;

        if (FileSize > 1048576) {
            lblMessage.ForeColor = System.Drawing.Color.Red;
            lblMessage.Text = "File size (1MB) exceeded";
        } else {
            string FileName = System.IO.Path.GetFileName(FileUpload1.FileName);

            string ServerFileName = Server.MapPath("~/Images/Folder1/" + FileName);

            if (System.IO.File.Exists(ServerFileName) == false) {
                FileUpload1.SaveAs(Server.MapPath("~/Images/Folder1/") + FileUpload1.FileName);
                lblMessage.ForeColor = System.Drawing.Color.Green;
                lblMessage.Text = "File : " + FileUpload1.FileName + " uploaded successfully";
            } else {
                lblMessage.ForeColor = System.Drawing.Color.Red;
                lblMessage.Text = "File : " + FileName.ToString() + " already exsist";
            }
        }
    }
} else {
    lblMessage.ForeColor = System.Drawing.Color.Red;
    lblMessage.Text = "Please select a file to upload";
} 
```

# c++ - MFC 和 STL

> ID：415963
> 
> 赞同：10
> 
> 时间：2009-01-06T09:54:48.103
> 
> 标签：c++, mfc, stl

您会将 MFC 与 STL 混合使用吗？为什么？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-06T09:58:42.807

当然。为什么不？

我使用 MFC 作为表示层，即使后端中的结构和类使用 STL。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-03T16:38:17.647

尽可能使用 STL，在别无选择时使用 MFC

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-06T10:50:40.283

我一直在混合它们。唯一次要的 PITA 是序列化 - MFC 容器（`CArray`、`CList`、`CStringArray`等）支持`CArchive`序列化，但是当使用 STL 容器时，您必须滚动自己的代码。最后我转而使用`boost::serialization`并转储了 MFC 的`CArchive`东西。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-06T12:38:11.703

是的，我以前混合过它们没有问题。然而，在使用 MFC 十多年后，我永远不会考虑将它用于新项目。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-02-16T11:48:36.030

我的所有 C++ 项目都使用 MFC，因为我的项目都不是控制台。MFC 是适用于 Windows C++ 开发人员的优雅解决方案。我讨厌 QT，我不会在 Windows 上使用 WX。我不关心可移植性，因为我的应用程序仅适用于 Windows。我喜欢 MFC/ATL 的`CString`类，std::string 非常原始，没有任何“字符串”特性。`std::string`无非就是`vector<char>`。

对于所有数据存储和算法，我使用 STL。我也使用 ConcRT PPL 模板类，它们与 STL 非常相似。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-06T12:49:29.293

对于数据层中的集合。我没有数据支持这一点，但我怀疑模板化的 STL 集合比 MFC 对应的集合性能更高。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-06T10:03:02.580

是的，我确实混合了它们，因为我发现 MFC 对于正常的自然外观 c++ 来说太笨拙了。尽管您可能必须编写一些代码来进行 STL 代码与 MFC 代码对话的转换。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-09T10:49:37.523

是的，如果以下两个条件都成立：

1) 为项目选择的语言是 C++（当然，它包括 STL - STL 中的 S 代表“标准”）。

2) 经过仔细分析，没有找到或认为比 MFC 更适合 GUI 支持的替代方案，我的开发团队就这样做了。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-03T15:05:07.303

在 Visual Studio 2003（几乎）完全支持 C++ 标准之前，这是一个非常糟糕的主意。现在这根本不是一个坏主意。这是否是一个好主意取决于环境和团队的技能。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-06-15T09:43:52.200

这取决于您对“混合”的定义是什么。如果您只是想创建一个同时使用 STL 和 MFC 的项目，我认为这没有任何危害。它们用于不同的目的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-12-14T17:36:17.607

在将 STL 与其他 microsoft 标头混合时，请务必定义 NOMINMAX，否则您的 std::min 函数将因为 min(a,b) 宏而被乱码为语法错误。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-12-14T17:43:31.943

您不应该在 MFC 应用程序中使用标准异常 - 如果您将其扔到对话框中，您的应用程序可能会挂起。看到这个问题的原因：[为什么我的 MFC 应用程序在我抛出异常时会挂起？](https://stackoverflow.com/questions/143006/why-does-my-mfc-app-hang-when-i-throw-an-exception)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-07-31T21:50:09.460

我有一个包含许多简单类型字段（UINT、CString、COLORREF 等）的结构。项目编译良好。

然后我添加了一个，我在结构中添加了一个 CArray。它没有编译。

然后我为该结构实现了 operator= 和复制构造函数（一个使用另一个）。然后编译。

一段时间后，对结构进行维护，我做了一个实验：将 CArray 更改为 std::vector 并删除 operator= 和复制构造函数。它编译得很好，并且在调用 operator= 或复制构造函数的地方很好地复制了结构。

优点是我可以转储代码的无用部分——容易出错，并且当有人维护向结构添加字段时可能不会更新！——我认为这是一个很大的优势。

**原因：**

为什么我现在不需要复制构造函数和 = 赋值运算符？

以前，结构只有简单的类型字段。所以它们是可以复制的。由于它们都是可复制的，因此结构可复制。当我添加 CArray 字段时，这个字段是不可复制的，因为 CArray 派生自 CObject，一个明确地将这两个函数设为私有的类：

```
class AFX_NOVTABLE CObject
{
    //...

    private:
        CObject(const CObject& objectSrc);              // no implementation
        void operator=(const CObject& objectSrc);       // no implementation

    //...
} 
```

CArray 是从 CObject 派生的一个类，不会做任何事情来覆盖此行为，因此 CArray 将继承它并使其自身不可复制。在使我的结构可复制之前添加了一个 CArray，我收到了错误：

```
c:\program files\microsoft visual studio 8\vc\atlmfc\include\afxtempl.h(272) : error C2248: 'CObject::operator =' : cannot access private member declared in class 'CObject'
    c:\program files\microsoft visual studio 8\vc\atlmfc\include\afx.h(554) : see declaration of 'CObject::operator ='
    c:\program files\microsoft visual studio 8\vc\atlmfc\include\afx.h(524) : see declaration of 'CObject'
    This diagnostic occurred in the compiler generated function 'CArray<TYPE,ARG_TYPE> &CArray<TYPE,ARG_TYPE>::operator =(const CArray<TYPE,ARG_TYPE> &)'
    with
    [
        TYPE=unsigned int,
        ARG_TYPE=unsigned int &
    ] 
```

std::vector 可以根据自己的定义进行复制：

```
 // TEMPLATE CLASS vector
template<class _Ty,
    class _Ax = allocator<_Ty> >
    class vector
        : public _Vector_val<_Ty, _Ax>
    {   // varying size array of values
public:
    typedef vector<_Ty, _Ax> _Myt; 
```

注意 _Myt 是向量类本身的 typedef。

```
 //...

    vector(const _Myt& _Right)
        : _Mybase(_Right._Alval)
        {   // construct by copying _Right
        if (_Buy(_Right.size()))
            _TRY_BEGIN
            this->_Mylast = _Ucopy(_Right.begin(), _Right.end(),
                this->_Myfirst);
            _CATCH_ALL
            _Tidy();
            _RERAISE;
            _CATCH_END
        }

    //...

    vector(_Myt&& _Right)
        : _Mybase(_Right._Alval)
        {   // construct by moving _Right
        _Assign_rv(_STD forward<_Myt>(_Right));
        }

    _Myt& operator=(_Myt&& _Right)
        {   // assign by moving _Right
        _Assign_rv(_STD forward<_Myt>(_Right));
        return (*this);
        }

    //...
 } 
```

因此，将 std::vector 成员字段添加到结构/类将不需要您在其中实现复制功能，只是因为该新字段。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2012-01-27T21:08:05.067

我更喜欢避免使用 STL 并且不使用它，因为当 MFC 成为事实上的标准大约十年时，它曾经不是那么标准。此外，直到最新版本的 Visual C++（和“标准”STL），MFC 才具有更好的性能。

# xml - 无法将 xml 转换为 SOAP

> ID：415966
> 
> 赞同：2
> 
> 时间：2009-01-06T09:55:10.193
> 
> 标签：xml, soap, messaging, mule

我在使用 Axis 从 Mule 调用 Web 服务时遇到问题。我创建了一个相当简单的示例，其中我在 Mule 读取的文件中有 xml，然后将其转换为 Document 并发送到 Web 服务。mule 配置中的相关代码如下所示：

```
<inbound>
 <file:inbound-endpoint path="./files/initial" transformer-refs="FileToString xmlToDom" connector-ref="fileConnector" /> 
</inbound>
<outbound>
 <pass-through-router>
  <axis:outbound-endpoint address="http://localhost:8081/holidayService?method=echoXXXX" synchronous="true" style="DOCUMENT" use="LITERAL" /> 
 </pass-through-router>
</outbound> 
```

但是，对 web 服务的调用失败，因为上面的配置正在生成一个 SOAP 消息，该消息在`<value0>`标签之后带有一个标签，并在该标签之前关闭它。生成的 SOAP 消息如下所示：

```
POST /holidayService?method=echoXXXX HTTP/1.1
Content-Type: text/xml
X-MULE_ENDPOINT: http://localhost:8081/holidayService?method=echoXXXX
SOAPAction: http://localhost:8081/holidayService?method=echoXXXX
directory: D:\bea\weblogic92\samples\domains\wl_server\files\processed
filename: HolidayRequest.xml
method: echoXXXX
originalFilename: HolidayRequest.xml
style: document
use: literal
User-Agent: Jakarta Commons-HttpClient/3.1
Host: 127.0.0.1:8081
Content-Length: 1183

<?xml version="1.0" encoding="UTF-8"?>
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/"    xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
<soapenv:Header>
<mule:header soapenv:actor="http://www.muleumo.org/providers/soap/1.0" soapenv:mustUnderstand="0" xmlns:mule="http://www.muleumo.org/providers/soap/1.0">
<mule:MULE_CORRELATION_ID>D:\bea\weblogic92\samples\domains\wl_server\files\processed\HolidayRequest.xml</mule:MULE_CORRELATION_ID>
<mule:MULE_CORRELATION_GROUP_SIZE>-1</mule:MULE_CORRELATION_GROUP_SIZE>
<mule:MULE_CORRELATION_SEQUENCE>-1</mule:MULE_CORRELATION_SEQUENCE>
</mule:header>

</soapenv:Header>
<soapenv:Body>
<value0 xsi:type="ns1:DocumentImpl" xmlns="" xmlns:ns1="http://dom.internal.xerces.apache.org.sun.com">
<sch:HolidayRequest xmlns:sch="http://mycompany.com/hr/schemas">
<sch:Holiday>
    <sch:StartDate>2009-08-13</sch:StartDate>
    <sch:EndDate>1988-12-12</sch:EndDate>
</sch:Holiday>
<sch:Employee>
    <sch:Number>3434</sch:Number>
    <sch:FirstName>John</sch:FirstName>
    <sch:LastName>Smith</sch:LastName>
</sch:Employee>
</sch:HolidayRequest>
</value0>
</soapenv:Body>
</soapenv:Envelope> 
```

该网络服务在没有标签的 SOAPUI 中运行良好，`<value0>`从我在 Mule 网站上阅读的内容来看，我不知道为什么要插入它。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-12-31T15:31:03.337

这条肥皂信息有什么问题，在我看来没问题。另外，如果您正在尝试使用 web 服务的 mule，我建议您使用 cxf。他们一起玩得非常好，我认为 cxf 设计得很好，考虑到了可扩展性，尤其是在 spring 环境中。mule 和 cxf 的核心都内置了弹簧。

# java - 如何创建一个深度不可修改的集合？

> ID：415967
> 
> 赞同：15
> 
> 时间：2009-01-06T09:55:37.087
> 
> 标签：java, unmodifiable

在从 getter 方法返回之前，我经常使集合字段不可修改：

```
private List<X> _xs;
....
List<X> getXs(){
  return Collections.unmodifiableList(_xs);
} 
```

但是如果上面的 X 本身就是一个列表，我想不出一种方便的方法：

```
private List<List<Y>> _yLists;
.....
List<List<Y>> getYLists() {
  return Collections.unmodifiableList(_yLists);
} 
```

上面的问题当然是，虽然客户端不能修改列表列表，但它可以从嵌入列表中添加/删除 Y 对象。

有什么想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-06T10:31:06.017

我能想到的最好的方法是使用[来自 Google Collections 的 ForwardingList](http://google-collections.googlecode.com/svn/trunk/javadoc/index.html?http://google-collections.googlecode.com/svn/trunk/javadoc/com/google/common/collect/package-summary.html)。欢迎评论。

```
private static <T> List<List<T>> unmodifiableList2(final List<List<T>> input) {
    return Collections.unmodifiableList(new ForwardingList<List<T>>() {
        @Override protected List<List<T>> delegate() {
            return Collections.unmodifiableList(input);
        }
        @Override public List<T> get(int index) {
            return Collections.unmodifiableList(delegate().get(index));
        }
    });
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-06T09:58:26.440

不幸的是，没有简单的方法可以在 java 中获得深度 const-ness。您必须始终确保列表中的列表也是不可修改的，从而绕过它。

我也有兴趣知道任何优雅的解决方案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-03-20T19:34:18.550

clojure 集合（map、set、list、vector）都可以嵌套，默认情况下是不可变的。对于纯java，有这个库：

[http://code.google.com/p/pcollections/](http://code.google.com/p/pcollections/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-06T10:16:32.490

如果您查看 Collections.unmodifiable*(...) 方法的实现，您会发现它们只是包装了集合。以同样的方式做一个深层的实用程序应该是可行的。

这样做的缺点是它向集合访问添加了额外的方法调用，因此会影响性能。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-06T14:07:37.297

如果您在这里的唯一目标是强制封装，经典的解决方案是使用 clone() 或类似方法返回不是对象内部状态的结构。这显然只有在所有对象都可以克隆并且复制的结构足够小的情况下才有效。

如果这是一个相当常用的数据结构，另一种选择是使访问它的 API 更具体，以便您对特定调用有更详细的控制。如上所述，编写自己的 List 实现是*一种*方法，但如果您可以将调用范围缩小到特定用例，则可以公开特定的访问 API，而不是 List 接口。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-07-12T13:34:39.600

万一有人对此感兴趣，这是一个简单的解决方案：

```
 public List<List<Double>> toUnmodifiable(List<List<Double>> nestedList) {
        List<List<Double>> listWithUnmodifiableLists = new ArrayList<>();
            for (List<Double> list : nestedList) {              
                listWithUnmodifiableLists
                    .add(Collections.unmodifiableList(list));
            }
        return Collections.unmodifiableList(listWithUnmodifiableLists);
    } 
```

例如，如果您想使用 getList() 方法公开列表，这可以用作解决方案，您可以返回：toUnmodifiable(mNestedList)，其中 mNestedList 是类中的私有列表。

我个人发现在 Android 中实现用于解析 GSON 的类时这很有用，因为能够修改响应没有意义，在这种情况下是反序列化的 json，我使用此方法作为公开的一种方式带有吸气剂的列表，并确保列表不会被修改。

# php - PHP 嵌套函数有什么用？

> ID：415969
> 
> 赞同：86
> 
> 时间：2009-01-06T09:56:50.970
> 
> 标签：php, nested-function

在 JavaScript 中，嵌套函数非常有用：闭包、私有方法以及你有什么......

嵌套的 PHP 函数有什么用？有人用它们吗？有什么用？

这是我做的一个小调查

```
<?php
function outer( $msg ) {
    function inner( $msg ) {
        echo 'inner: '.$msg.' ';
    }
    echo 'outer: '.$msg.' ';
    inner( $msg );
}

inner( 'test1' );  // Fatal error:  Call to undefined function inner()
outer( 'test2' );  // outer: test2 inner: test2
inner( 'test3' );  // inner: test3
outer( 'test4' );  // Fatal error:  Cannot redeclare inner() 
```

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2011-05-20T10:12:32.110

如果您使用的是 PHP 5.3，您可以使用匿名函数获得更多类似 JavaScript 的行为：

```
<?php
function outer() {
    $inner=function() {
        echo "test\n";
    };

    $inner();
}

outer();
outer();

inner(); //PHP Fatal error:  Call to undefined function inner()
$inner(); //PHP Fatal error:  Function name must be a string
?> 
```

输出：

```
test
test 
```

* * *

## 回答 #2

> 赞同：90
> 
> 时间：2009-01-06T10:19:22.110

基本没有。我一直将其视为解析器的副作用。

Eran Galperin 错误地认为这些函数在某种程度上是私有的。它们只是`outer()`在运行之前未声明。它们也不是私有范围的；它们确实污染了全球范围，尽管延迟了。而作为回调，外部回调仍然只能被调用一次。我仍然看不出将它应用于数组有什么帮助，这很可能不止一次调用别名。

我可以挖掘的唯一“现实世界”示例是[这个](http://www.java2s.com/Code/Php/Functions/Nestedfunction.htm)，它只能运行一次，并且可以被重写得更干净，IMO。

我能想到的唯一用途，就是模块调用一个`[name]_include`方法，在全局空间中设置几个嵌套的方法，结合

```
if (!function_exists ('somefunc')) {
  function somefunc() { }
} 
```

检查。

PHP 的 OOP 显然是一个更好的选择 :)

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2013-12-15T12:57:48.780

*[根据@PierredeLESPINAY 的评论重写。]*

这根本不只是一个副作用，而且实际上是一个非常有用的功能，*可以动态修改*程序的逻辑。它来自过程 PHP 时代，但如果您想以最直接的方式为某些独立功能提供替代实现，它也可以在 OO 架构中派上用场。（虽然 OO 在大多数情况下是更好的选择，但它是一种选择，而不是强制要求，一些简单的任务不需要额外的繁琐。）

例如，如果您从框架中动态/有条件地加载插件，并且想让插件作者的生活变得超级轻松，您可以为插件没有覆盖的一些关键功能提供默认实现：

```
<?php // Some framework module

function provide_defaults()
{
    // Make sure a critical function exists:
    if (!function_exists("tedious_plugin_callback"))
    {
        function tedious_plugin_callback()
        {
        // Complex code no plugin author ever bothers to customize... ;)
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-01-06T12:11:45.237

在函数中定义的函数我看不到太多用处，但我可以看到有条件定义的函数。例如：

```
if ($language == 'en') {
  function cmp($a, $b) { /* sort by English word order */ }
} else if ($language == 'de') {
  function cmp($a, $b) { /* sort by German word order; yes it's different */ }
} // etc 
```

然后您的代码需要做的就是在诸如 usort() 调用之类的事情中使用“cmp”函数，这样您就不会在代码中到处乱扔语言检查。现在我还没有这样做，但我可以看到这样做的论据。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2015-09-27T01:39:12.980

综上所述，人们可能会简单地创建一个嵌套函数来替换函数中的一些本地化、重复的代码（这些代码只会在父函数内部使用）。匿名函数就是一个很好的例子。

有人可能会说只是在一个类中创建私有方法（或更小的代码块），但是当一个超特定的任务（它是父级独有的）需要模块化时，这会使水变得混乱，但不一定对其他人可用一类。好消息是，如果事实证明您在其他地方确实需要该功能，则修复相当简单（将定义移动到更中心的位置）。

一般来说，使用 JavaScript 作为评估其他基于 C 的编程语言的标准是一个坏主意。与 PHP、Python、Perl、C、C++ 和 Java 相比，JavaScript 绝对是它自己的动物。当然，有很多普遍的相似之处，但是细节（参考*JavaScript：权威指南，第 6 版，第 1-12 章*），当注意时，会使核心 JavaScript 独特、美观、不同、简单和同时复杂。那是我的两分钱。

为了清楚起见，我并不是说嵌套函数是私有的。当一些琐碎的事情需要模块化（并且只有父函数需要）时，嵌套可以帮助避免混乱。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-04-30T20:41:51.163

我所有的 php 都是面向对象的，但我确实看到了嵌套函数的用途，特别是当你的函数是递归的并且不一定是对象时。也就是说，它不会在它嵌套的函数之外被调用，而是递归的，随后需要成为一个函数。

为明确使用一种其他方法而制定一种新方法没有什么意义。对我来说，这是笨拙的代码，有点不是面向对象的重点。如果您永远不会在其他任何地方调用该函数，请嵌套它。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-01-09T06:27:28.113

在 web 服务调用中，我们发现它的开销（内存和速度）要低得多，包括以嵌套方式动态地包括在包含 1000 多个函数的库上的单个函数。典型的调用堆栈可能在 5-10 个调用深度之间，只需要动态链接十几个 1-2kb 文件就比包含兆字节要好。这只是通过创建一个小的 util 函数包装要求来完成的。包含的函数嵌套在调用堆栈上方的函数中。将其与包含 100 多个函数的类进行对比，这些函数在每次 Web 服务调用时都不需要，但也可以使用 php 的内置延迟加载功能。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-08-27T07:36:56.477

**如果您在 php 7 中，请查看：** 此实现将使您对嵌套函数有一个清晰的认识。假设我们在函数 foo() 中嵌套了三个函数（too()、boo() 和 zoo()）。boo() 和 zoo() 具有相同命名的嵌套函数 xoo()。现在在这段代码中，我已经清楚地注释掉了嵌套函数的规则。

```
 function foo(){
        echo 'foo() is called'.'<br>';
        function too(){
            echo 'foo()->too() is called'.'<br>';
        }
        function boo(){
            echo 'foo()->boo() is called'.'<br>';
            function xoo(){
                echo 'foo()->boo()->xoo() is called'.'<br>';
            }
            function moo(){
                echo 'foo()->boo()->moo() is called'.'<br>';
            }
        }
        function zoo(){
            echo 'foo()->zoo() is called'.'<br>';
            function xoo(){     //same name as used in boo()->xoo();
                echo 'zoo()->xoo() is called'.'<br>';
            }
        #we can use same name for nested function more than once 
        #but we can not call more than one of the parent function
        }
    }

/****************************************************************
 * TO CALL A INNER FUNCTION YOU MUST CALL OUTER FUNCTIONS FIRST *
 ****************************************************************/
    #xoo();//error: as we have to declare foo() first as xoo() is nested in foo()

    function test1(){
        echo '<b>test1:</b><br>';
        foo(); //call foo()
        too();
        boo();
        too(); // we can can a function twice
        moo(); // moo() can be called as we have already called boo() and foo()
        xoo(); // xoo() can be called as we have already called boo() and foo()
        #zoo(); re-declaration error
        //we cannont call zoo() because we have already called boo() and both of them have same named nested function xoo()
    }

    function test2(){
        echo '<b>test2:</b><br>';
        foo(); //call foo()
        too();
        #moo(); 
        //we can not call moo() as the parent function boo() is not yet called
        zoo(); 
        xoo();
        #boo(); re-declaration error
        //we cannont call boo() because we have already called zoo() and both of them have same named nested function xoo()

    } 
```

现在，如果我们调用 test1()，输出将是这样的：

```
test1:
foo() is called
foo()->too() is called
foo()->boo() is called
foo()->too() is called
foo()->boo()->moo() is called
foo()->boo()->xoo() is called 
```

如果我们调用 test2() 输出将是这样的：

```
test2:
foo() is called
foo()->too() is called
foo()->zoo() is called
zoo()->xoo() is called 
```

但是我们不能同时调用 text1() 和 test2() 以避免重新声明错误

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-04-27T18:38:24.457

我知道这是一篇旧文章，但是当我只需要本地功能时，我使用嵌套函数为递归调用提供一种简洁的方法 - 例如用于构建分层对象等（显然你需要小心父函数只是调用一次）：

```
function main() {
    // Some code

    function addChildren ($parentVar) {
        // Do something
        if ($needsGrandChildren) addChildren ($childVar);
    }
    addChildren ($mainVar); // This call must be below nested func

    // Some more code
} 
```

例如，与 JS 相比，php 中需要注意的一点是，对嵌套函数的调用需要在函数声明之后进行，即在函数声明下方（与 JS 相比，函数调用可以在父函数中的任何位置进行）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-02-07T18:10:34.370

我只是在一个主要的、更分类的函数中执行一个小的递归函数很有用时才真正使用过这个特性，但不想将它移动到不同的文件，因为它是主要进程行为的基础。我意识到还有其他“最佳实践”方法可以做到这一点，但我想确保我的开发人员每次查看我的解析器时都能看到该功能，无论如何他们可能应该修改它......

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-06-27T07:35:34.773

对于那些暗示嵌套函数没有实际用途的人。是的，它们有用，这是一个例子。

想象一下，我有一个名为 my_file.php 的文件，用于获取 ajax 结果。但是，如果有时您不想通过 ajax 获得结果但又想在同一页面中包含两次而不发生冲突怎么办？

让我们说 ajax 文件 my_file.php ：

```
<?php
// my_file.php used for ajax

$ajax_json_in = 10; 

function calculations($a, $b)
{   $result = $a + $b;
    return $result;
}

$new_result = $ajax_json_in * calculations(1, 2);

$ajax_json_out =  $new_result; 

?> 
```

下面的示例包含上述文件两次而没有冲突。您可能不想通过 ajax 调用它，因为在某些情况下您需要将它直接包含在 HTML 中。

```
<?php
// include the above file my_file.php instead of ajaxing it

function result1 
{
    $ajax_json_in = 20; 
    include("my_file.php");
    return $ajax_json_out; 
}

function result2 
{
    $ajax_json_in = 20; 
    include("my_file.php");
    return $ajax_json_out;
}

?> 
```

包含文件会使文件的函数嵌套。该文件用于 ajax 调用和内联包含！

所以嵌套函数在现实生活中很有用。

祝你今天过得愉快。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2011-05-24T16:56:27.297

嵌套函数在记忆中很有用（缓存函数结果以提高性能）。

```
<?php
function foo($arg1, $arg2) {
    $cacheKey = "foo($arg1, $arg2)";
    if (! getCachedValue($cacheKey)) {
        function _foo($arg1, $arg2) {
            // whatever
            return $result;
        }
        $result = _foo($arg1, $arg2);
        setCachedValue($cacheKey, $result);
    }
    return getCachedValue($cacheKey);
}
?> 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2015-11-14T00:39:58.143

如果您希望嵌套函数利用在父函数中声明的变量，则嵌套函数很有用。

```
<?php
ParentFunc();
function ParentFunc()
{
  $var = 5;
  function NestedFunc()
  {
    global $var;
    $var = $var + 5;
    return $var;
  };
  echo NestedFunc()."<br>";
  echo NestedFunc()."<br>";
  echo NestedFunc()."<br>";
}
?> 
```

# asynchronous - 如何在 UML 活动图上显示异步操作

> ID：415974
> 
> 赞同：19
> 
> 时间：2009-01-06T09:58:20.060
> 
> 标签：asynchronous, uml, diagram

我即将为一些客户端-服务器连接建立代码绘制/记录以更好地理解它。有几个操作在不同的线程中异步完成（连接线程、数据接收线程等）。

我应该在单独的图表上显示它们吗？我宁愿将它放在单个图表上以掌握整体视图，但不知道如何在活动图上表示它。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-25T12:14:19.960

我不确定是否有正确的方法来做到这一点，我通过测试不同的策略来开发自己的方法，直到我想出适合我自己心态的东西。

我就是这样做的：

*   线程 == 泳道
*   线程操作 == 动作/活动节点
*   关键部分 == 对象节点
*   线程创建 == 分叉节点

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-06T10:17:36.607

您可以使用半箭头来显示异步消息调用，而不是使用全箭头。如图所示

![替代文字](https://i.stack.imgur.com/u2foC.png)

# c# - 在 GridView 中使用 JQuery 自动完成

> ID：415975
> 
> 赞同：1
> 
> 时间：2009-01-06T09:58:22.090
> 
> 标签：c#, jquery, autocomplete

在 GridView 中使用 JQuery 自动完成。我想在 gridview 中自动完成批量更新所需的功能

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-06T10:39:29.743

你可以使用类似的东西：

```
jQuery("*[@id$=theGridId] input[@id$=textBoxId]").autocomplete(list) 
```

将 jquery 自动完成附加到网格内 ID 为 textBoxId 的所有文本框（输入 html 控件）。

elem[@id$=someID] 表示所有名为 'elem' 且 id 属性以 'someID' 结尾的标签。

这是必需的，因为 asp.net 将更改标签的客户端 ID，因此如果您使用以下内容：

```
<asp:TextBox id="myTextBox" /> 
```

该页面将包含以下内容：

```
<input type="textbox" id="ctl00_otherName_myTextBox" /> 
```

您需要注意，使用网格视图进行批量更新有一些严重的限制；如果您向网格输入添加几个验证，页面大小很可能会太大...

# c# - 模块化 C# Compact Framework 2.0 应用程序

> ID：415980
> 
> 赞同：2
> 
> 时间：2009-01-06T09:59:59.323
> 
> 标签：c#, .net, module, compact-framework, modularization

我们目前正在开发一种新的手持软件。我无法讨论应用程序的性质，所以我将使用一个示例。

我们正在设计用于管理学校的手持软件。我们希望将系统的各个方面模块化，以便不同的学校可以使用不同的功能。

我们的系统将从主菜单和登录屏幕开始。我希望这是系统的基础，并且是添加模块的地方。即，我将有一个名为 SchoolPda 的项目。

然后我想要不同的模块。即，我想要一个可以处理学生注册的注册模块。我想要一个用于管理教室清洁等的教室模块。

我可能看到这种工作的方式是包括/不包括不同的 dll，并且如果存在 dll，则让基本系统的主菜单公开按钮以访问这些模块。这正是我们所追求的。

有没有人有做这样的事情的经验？最好的方法是什么？我们不需要担心数据库，因为数据库将始终是完整的数据库，但如果相关模块不存在，则不会填充方面。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-06T10:09:09.930

我参与的项目有两种方式：

*   在一个项目中，如果客户没有获得许可，我们不会部署某些 DLL。这就是你的建议。它工作得很好。当然，如果不进行额外安装，就无法启用这些模块，但它对那个应用程序来说非常有意义。

*   在另一个项目中，我们部署了所有内容，只向最终用户公开了客户获得许可的菜单、按钮等。我们这样做是因为用户可以通过为其添加许可证来轻松添加额外的模块。添加许可证后，这些东西神奇地出现在下次登录时。

因此，根据我的经验，我会说将您的许可模式视为您决策的一个重要部分。考虑一下您是否想要即时添加这些额外的模块。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-06T10:16:14.423

我目前还在开发一个在 Compact 和 Full 框架上运行并且是模块化构建的应用程序。

我实现它的方式是它扫描 dll 的位置并枚举每种类型，并查看它们是否定义了“ScreenInfoAttribute”或“WidgetInfoAttribute”，其中包含有关该类的有用信息。

这是一个片段，它包含 3.5 的代码，但那是因为我们最近从 2.0 进行了切换，但原理在 2.0 中有效

```
public void Analyze(FileInfo file) {
        Assembly asm = Assembly.LoadFrom(file.FullName);
        List<Data.AnyPlugin> types = GetPluginTypes(asm.GetTypes());

        if (types.Count > 0) {
            types.ForEach(x => x.AssemblyPath = file.FullName);
            if (_plugins.ContainsKey(file.FullName)) {
                _plugins[file.FullName].Plugins.AddRange(types);
            } else {
                AssemblyPlugin asp = new AssemblyPlugin();
                asp.Ass = asm;
                asp.Plugins = types;
                _plugins.Add(file.FullName, asp);
            }
        }
    }

    private List<Data.AnyPlugin> GetPluginTypes(Type[] types) {
        List<Data.AnyPlugin> returnTypes = new List<AnyPlugin>();
        foreach (Type t in types) {
            Data.AnyPlugin st = GetPluginType(t);
            if (st != null) returnTypes.Add(st);
        }
        return returnTypes;
    }

    private Data.AnyPlugin GetPluginType(Type type) {
        if (type.IsSubclassOf(typeof(Screens.bScreen<T>))) {
            Screens.ScreenInfoAttribute s = GetScreenAttrib(type);
            if (s != null) {
                return new Data.ScreenPlugin("", type, s);
            }
        } else if (type.IsSubclassOf(typeof(Widgets.bWidget<T>))) {
            Widgets.WidgetInfoAttribute w = GetWidgetAttrib(type);
            if (w != null) return new Data.WidgetPlugin("", type, w);
        }
        return null;
    }

    private Screens.ScreenInfoAttribute GetScreenAttrib(Type t) {
        Attribute a = Attribute.GetCustomAttribute(t, typeof(Screens.ScreenInfoAttribute));
        return (Screens.ScreenInfoAttribute)a;
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-06T10:10:08.617

我不知道它是否适用于 CLR，但请查看[MEF](http://www.codeplex.com/MEF)，以创建一种发现和加载 dll / 模块的方法。你也可以让你的模块有一个 GetMenuItem 方法（或类似的东西）来获取所需的信息，这样你的主菜单就可以添加一个按钮。

显然，如果有意义的话，为你的主菜单使用不同的设计，但你会希望它真正模块化和可扩展，这样你就可以编写你的核心，并且在未来继续编写新的组件，而不必改变你的核心。

如果这没有最大的意义，我很抱歉。只是希望给你一个方向的想法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-06T12:22:10.443

只需让每个 Module 实现一个通用接口即可。添加 GetButtons() 或 GetActions() 等方法。

然后，您可以将有关 AssemblyName 和 ClassName 的信息放在配置文件中。现在很容易加载指定的程序集并使用 Activator.CreateInstance 创建类的实例，将其转换为您的接口并调用 GetButtons() 等方法。

# asp.net - aspx 文件中的服务器端代码

> ID：415989
> 
> 赞同：3
> 
> 时间：2009-01-06T10:04:36.337
> 
> 标签：asp.net, page-lifecycle

我想问一下“ **Server-Side-Codewritten in aspx file”**是在Control Execution Lifecycle的哪个阶段执行的？

是在 SaveState 之前还是之后，我声称它处于渲染阶段，是真的吗？

在 aspx 文件中，如果我的代码写为

“<%”

```
if(true)
{
rdlistAnswers.Items.Clear();
foreach (string item in myCollection)
{
    i.Value = item;
    i.Text = item;
    rdlistAnswers.Items.Add(i);
}
"%>"
<asp:RadioButtonList ID="rdlistAnswers" runat="server"</asp:RadioButtonList> 
```

对 所做的更改被渲染但不保存。但是当将标签写为

```
<asp:RadioButtonList ID="rdlistAnswers" runat="server" OnPreRender="loadMe"</asp:RadioButtonList> 
```

- 因为 loadMe 是 aspx.cs 文件中的一个事件处理程序方法，其作用与上面的代码相同 - 呈现并保存更改，因此当我在 PreRender 阶段进行更改时，状态会被保存，但是当我通过放置逻辑来进行时在 aspx 文件中它没有保存，这意味着 - 至少正如我所声称的 - 放置在 aspx 文件中的服务器端代码在渲染阶段执行，你同意我吗？？？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-06T11:20:14.670

**直接在 aspx 文件中编写的代码将在 ASP.NET 页面生命周期中的****[渲染控制](http://msdn.microsoft.com/en-us/library/system.web.ui.control.render.aspx)**结束时执行。

我测试了它[预编译一个 aspx 文件](https://stackoverflow.com/questions/413246/protect-asp-net-source-code#413272)并[使用 Reflector 查看反编译的代码](https://stackoverflow.com/questions/265295/-net-decompilation-how-easy-is-it#265315)。

# asp.net-mvc - 动态站点主菜单

> ID：415991
> 
> 赞同：0
> 
> 时间：2009-01-06T10:04:38.160
> 
> 标签：asp.net-mvc

我需要以下帮助：

我刚刚阅读了本教程： [http ://www.asp.net/LEARN/mvc/tutorial-13-cs.aspx](http://www.asp.net/LEARN/mvc/tutorial-13-cs.aspx)

并遵循为“好解决方案”给出的示例。但是，在对抽象类 ApplicationController 进行了一些修改后，我遇到了一个问题。

原来的构造函数是：

```
public ApplicationController()
{                
    ViewData["categories"] = from c in DataContext.MovieCategories
                             select c;           
} 
```

我已将其修改为使用存储过程：

```
public ApplicationController()
{                
    ViewData["categories"] =  DataContext.spMovieCategories("some movie category");
} 
```

无论如何我可以将“某些电影类别”作为参数传递吗？我尝试过使用 TempData 和 Session 变量，但它一直在抛出错误。

多谢你们！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-12-15T05:34:31.893

如果您需要在 asp.net 中使用以下内容的动态菜单。

*   从数据库中获取。
*   管理员可以通过简单地更新数据库表来更改菜单的名称。例如 Office org 到 My Org。等等
*   您不想为任何菜单点击硬编码重定向 url。（即 url 也在数据库中输入）。
*   只是不想为上述内容创建一个 xml 文件。（即时 xml 变量构造和破坏，避免在服务器中创建 xml 文件）。

*   根本不想做jquery

然后点击这里[动态菜单](http://thingsaroundnepal.blogspot.com/2011/12/dynamic-menu-in-aspnet-using-mssql-and.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-06T10:45:28.810

您可以在构造函数中使用参数将其传入：

```
public ApplicationController(string movieCategory)
{
    ViewData["categories"] = DataContext.spMovieCategories(movieCategory);
} 
```

显然，您需要能够从派生控制器中提供它，这可能是一个问题，除非该类别特定于每个派生控制器，这似乎不太可能：

```
public DerivedController() : base("Derived Movie Category")
{
    // ...
} 
```

最好的办法可能是将类别检索移出构造函数，并将其移至 ApplicationController 中的单独方法中。调用它的*最简单*方法是在拥有类别参数后在每个 Action 中插入对它的调用（我假设它是 Action 调用的参数之一？）。不过，这有点痛苦。

解决此问题的预期方法是 ActionFilters，如果您像这样创建一个新的 ActionFilter：

```
public class CategoryAttribute : ActionFilterAttribute, IActionFilter
{
    #region IActionFilter Members

    void IActionFilter.OnActionExecuted(ActionExecutedContext filterContext)
    {
        string category = (string)filterContext.RouteData.Values["category"];
        ((ApplicationController)filterContext.Controller).PopulateCategory(category);
    }

    void IActionFilter.OnActionExecuting(ActionExecutingContext filterContext)
    {
    }

    #endregion
} 
```

应用了该属性的任何操作`Category`都将执行此代码。（我假设您已将代码`ApplicationController`移入名为 的方法中`PopulateCategory`。您也可以在控制器级别应用它，然后将导致此 ActionFilter 为控制器中的每个操作调用。

由于您希望*每个控制器上的**每个*操作都调用它，因此您可以将其应用于 ApplicationController 以便每个派生控制器都将继承它：

 *```
[Category]
public class ApplicationController : Controller
{
    // ...
} 
```

[编辑 - 稍微更好的解决方案]

但是，更进一步的简化步骤是不使用属性，而是覆盖 Controller 的 OnActionExecuted 方法（我在写完这个答案后才注意到）。

这意味着您可以摆脱`CategoryAttribute`类和类`Category`上的属性`ApplicationController`，只需将其添加到`ApplicationController`类中：

```
protected override void OnActionExecuted(ActionExecutedContext filterContext)
{
    string category = (string)filterContext.RouteData.Values["category"];
    this.PopulateCategory(category);
    base.OnActionExecuted(filterContext);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-10-28T15:34:51.393

我通过创建自己的继承 System.Web.Mvc.ViewDataPage 的 ViewDataPage 类来做到这一点。

```
namespace myWebsite.Helpers
{
public class ViewMasterPage : System.Web.Mvc.ViewMasterPage
{
    public bcData Data = new bcData();

}
} 
```

更改 web.config 以包含您的命名空间：

```
 <namespaces>
    <add namespace="betClubUk.Helpers" />
  </namespaces> 
```

然后实现视图中的数据。

```
<%@ Master Language="C#" Inherits="betClubUk.Helpers.ViewMasterPage" %>

<%=Data.getVariableContent().statOfDay.text %> 
```

# .net - ValueType 包装器的垃圾收集

> ID：415995
> 
> 赞同：3
> 
> 时间：2009-01-06T10:06:31.887
> 
> 标签：.net, garbage-collection, value-type

从[MSDN 链接中引用 ValueType 类](http://msdn.microsoft.com/en-us/library/system.valuetype.aspx)

> 如果值类型必须表现得像对象，则在堆上分配一个使值类型看起来像引用对象的包装器，并将值类型的值复制到其中。包装器被标记以便系统知道它包含一个值类型。

这意味着当我编写像“integerVariable.ToString();”这样的代码时 创建的包装对象允许使用此方法以及 System.Object 的所有其他方法。

> 这种理解正确吗？
> 
> 这些对象与“常规”对象有何不同？
> 
> 此类对象的垃圾收集是否不同？如果是，如何？

提前致谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-06T10:25:02.940

包装器是一个“盒子”；重新收集盒子的垃圾 - 就抓取收集器而言，**没有区别。**一个盒子的收集规则和处理与任何其他对象完全相同。

但是，如果值类型覆盖了方法（例如`ToString()`），则无需将其装箱即可调用该方法。因此，值类型应该（作为例行程序）覆盖尽可能多的`object`方法；-p

您可以看到 IL 中的差异（通过反射器） - 因此对于 C#：

```
static int GetInteger() {return 123;}
static string TestToString() {
    int i = GetInteger(); // to prove no cheating
    return i.ToString();
}
static Type TestGetType() {
    int i = GetInteger(); // to prove no cheating
    return i.GetType();
} 
```

我们有 IL：

```
.method private hidebysig static string TestToString() cil managed
{
    .maxstack 1
    .locals init (
        [0] int32 i)
    L_0000: call int32 Program::GetInteger()
    L_0005: stloc.0 
    L_0006: ldloca.s i
    L_0008: call instance string [mscorlib]System.Int32::ToString()
    L_000d: ret 
}

.method private hidebysig static class [mscorlib]System.Type TestGetType() cil managed
{
    .maxstack 1
    .locals init (
        [0] int32 i)
    L_0000: call int32 Program::GetInteger()
    L_0005: stloc.0 
    L_0006: ldloc.0 
    L_0007: box int32
    L_000c: call instance class [mscorlib]System.Type [mscorlib]System.Object::GetType()
    L_0011: ret 
} 
```

Note that `ToString()` doesn't involve a box, but `GetType()` does at `L_0007` (since it isn't (can't be) overridden)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-06T10:17:25.967

是的，这个理解是正确的。

这些对象与 CLR 中的“常规”对象没有什么不同。

由于这些对象（也称为“盒子”，因为它们包装了值类型）就像任何其他对象一样，垃圾收集器也是一样的。

# java - 在字符串中（在 Java 中）查找特定标记的最佳方法是什么？

> ID：415996
> 
> 赞同：1
> 
> 时间：2009-01-06T10:06:35.083
> 
> 标签：java, string

我有一个带有标记的字符串，我需要使用 Java 找到它。

例如。

```
string = abc<B>def</B>ghi<B>j</B>kl

desired output..

segment [n] = start, end

segment [1] = 4, 6
segment [2] = 10, 10 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-06T10:11:54.323

正则表达式应该可以很好地解决这个问题。

请参阅您的 JavaDoc

*   java.langString.split()
*   java.util.regex 包
*   java.util.Scanner

注意： StringTokenizer 不是您想要的，因为它围绕*字符*而不是字符串进行拆分 - 字符串 delim 是一个字符列表，其中任何一个都会拆分。它适用于非常简单的情况，例如明确的逗号分隔列表。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-06T11:07:56.973

鉴于您的示例，我想我会使用正则表达式，特别是我会看看 Matcher 提供的分组功能。

汤姆

```
String inputString = "abc<B>def</B>ghi<B>j</B>kl";

String stringPattern = "(<B>)([a-zA-Z]+)(<\\/B>)";

Pattern pattern = Pattern.compile(stringPattern);
Matcher matcher = pattern.matcher(inputString);

if (matcher.matches()) {

    String firstGroup  = matcher.group(1);
    String secondGroup = matcher.group(2); 
    String thirdGroup  = matcher.group(3);
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-06T10:16:33.520

当您想用特定字符串分隔字符串时，StringTokenizer 将为您提供单独的标记。或者您可以使用 String 中的 split() 方法来获取单独的字符串。要获得不同的数组，您必须将正则表达式放入其中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-06T10:35:38.520

StringTokenizer 将整个 String 作为参数，对于大字符串来说并不是一个好主意。您还可以使用[StreamTokenizer](http://java.sun.com/j2se/1.4.2/docs/api/java/io/StreamTokenizer.html)

您还需要查看[Scanner](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Scanner.html)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-06T11:16:23.740

这有点“蛮力”，并做了一些假设，但这是可行的。

```
public class SegmentFinder
{

    public static void main(String[] args)
    {
        String string = "abc<B>def</B>ghi<B>j</B>kl";
        String startRegExp = "<B>";
        String endRegExp = "</B>";
        int segmentCounter = 0;
        int currentPos = 0;
        String[] array = string.split(startRegExp);
        for (int i = 0; i < array.length; i++)
        {           
            if (i > 0) // Ignore the first one
            {
                segmentCounter++;
                //this assumes that every start will have exactly one end
                String[] array2 = array[i].split(endRegExp);
                int elementLenght = array2[0].length();
                System.out.println("segment["+segmentCounter +"] = "+ (currentPos+1) +","+ (currentPos+elementLenght) );
                for(String s : array2)
                {
                    currentPos += s.length();  
                }
            }
            else
            {
                currentPos += array[i].length();                
            }
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-06T14:47:52.317

您的输入是否看起来像您的示例，并且您需要获取特定标签之间的文本？然后使用 apache commons lang 包 ( [http://commons.apache.org/lang/](http://commons.apache.org/lang/) ) 的简单 StringUtils.substringsBetween(yourString, "<B>", "</B>" ) 应该可以完成这项工作。

If you're up for a more general solution, for different and possibly nested tags, you might want to look at a parser that takes html input and creates an xml document out of it, such as NekoHTML, TagSoup, jTidy. You can then use XPath on the xml document to access the contents.********************