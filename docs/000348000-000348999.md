# StackOverflow 问答 000348000-000348999

# algorithm - 包络算法优化——放置圆圈的最佳位置

> ID：348005
> 
> 赞同：4
> 
> 时间：2008-12-07T20:10:16.690
> 
> 标签：algorithm, optimization, computer-science, topology

我必须以最佳方式解决以下问题。

输入数据为：

*   平面中的 N 个点，以 (x, y) 对整数坐标的形式给出
*   M 点在同一平面上，以 (x, y) 对表示圆心的整数坐标给出。所有这些圆圈的边缘都有 (0, 0)。

我需要找到一种方法来隔离具有属性的多个圆，而不是对于任何“好”圆，前 N 个点中的任何点都不位于所选圆或所选圆的边缘。

点和圆的数量在 100,000 左右。用每个点检查每个圆的明显解决方案具有 O(N * M) 的复杂度，对于 100,000 个圆和 100,000 个点，在具有 64 位 SSE3 单精度代码的 Core 2 Duo 上大约需要 15 秒。我竞争的参考实现在相同的数据下只需要大约 0.1 秒。我知道参考实现是 O(Nlog N + Mlog M)。

我曾想过以下列方式优化我的算法。制作点数据的 2 个副本，并分别根据 x 坐标和 y 坐标对副本进行排序。然后仅使用位于由 [(xc - r, yc - r); 定义的正方形中的点。(xc + r, yc + r)]，其中 (xc, yc) 是“当前”圆的中心，半径为 r。我可以使用二分搜索找到该区间中的点，因为现在我使用已排序的数据。这种方法的复杂度应该是 O(Nlog N + Mlog^2 N)，确实比参考更快，但仍然明显慢。

我或多或少知道参考实现是如何工作的，但是有些步骤我不明白。我将尝试解释到目前为止我所知道的：

坐标为 (Xc, Yc) 的圆的半径为：

*   Rc = sqrt(Xc * Xc + Yc * Yc) (1)

那是因为 (0, 0) 在圆的边缘。

对于点 P(x, y) 在圆外，以下不等式必须为真：

*   sqrt((Xc - x)^2 + (Yc - y)^2) > Rc (2)

现在，如果我们将 (1) 中的 Rc 代入 (2)，然后在我们进行一些简单计算后将不等式平方，我们得到：

*   Yc < 1/2y * (x^2 + y^2) - Xc * x/y (3.1) 对于 y > 0
*   Yc > 1/2y * (x^2 + y^2) - Xc * x/y (3.2) 对于 y < 0

对于从输入数据中选择的任何 (x, y)，对于给定的圆 C(Xc, Yc)，(3.1) 和 (3.2) 必须为真。

为简单起见，让我们做一些符号：

*   A(x, y) = 1/2y * (x^2 + y^2) (4.1)
*   B(x, y) = -x/y (4.2)
*   E(Xc) = 1/2y * (x^2 + y^2) - Xc * x/y = A(x, y) + Xc * B(x, y) (4.3)

我们可以看到，对于给定的圆 C(Xc, Yc)，我们可以将 (3) 写为：

*   对于 y > 0 的所有点，Yc < MIN(E(Xc)) (5.1)
*   对于 y < 0 的所有点，Yc > MAX(E(Xc)) (5.2)

我们可以看到 E(Xc) 是关于 Xc 的线性函数，具有 2 个参数 - A(x, y) 和 B(x, y)。这意味着基本上 E(Xc) 在欧几里得空间中表示具有 2 个参数的线族。

现在来了我不明白的部分。他们说，由于上一段中所述的属性，我们可以使用包络算法在 O(1) 分摊时间而不是 O(N) 时间内计算 MIN() 和 MAX()。我不知道信封算法如何工作。

关于如何实现信封算法的任何提示？

提前致谢！

* * *

**编辑：**

问题不在于数学意义上的信封是什么——我已经知道了。问题是如何在比 O(n) 更好的时间内确定包络，显然它可以在摊销 O(1) 中完成。

我有计算包络所需的一系列函数，并且我有一个包含所有可能参数的数组。如何以最佳方式解决最大化问题？

再次感谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-07T20:45:36.073

这是[关于信封的维基百科条目](http://en.wikipedia.org/wiki/Envelope_(mathematics))。[这是关于优化中的包络定理](http://www.economics.utoronto.ca/osborne/MathTutorial/MEEF.HTM)的教程。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T15:12:15.137

我没有数学背景，但我会分三步解决这个问题：

*   丢弃 N 中的大多数点。这是棘手的部分。从原点看，每一对点都“遮蔽”了它“后面”的一个区域。该区域由从点向外开始、指向原点的两束光束以及两点之间的圆形交点界定。这在极坐标中的计算可能要简单得多。从随机一对开始，然后一次看一个新点：如果它被遮住了，就把它扔掉；如果没有，找出它是否遮住了集合中已经存在的任何点，然后重建包络曲线集。重建包络曲线部分的测试应该花费几乎恒定的时间，因为阴影集不太可能增长到超过某个小数字。最坏的情况似乎是 O(NlogN)。

*   扔掉 M 中的大多数点。这很容易：如果 M 中的点距原点的距离比距包络集最远点的距离的一半远，那么它可以被扔掉。这需要 O(M)

*   通过实际检查过滤M中剩余的点。这取决于 N 和 M 的分布需要多长时间，但我认为如果两个数字都很大并且分布相似，则*几乎是 O(1)。*

总的来说，在 O(N log(N) + M) 中似乎是可能的。但不能保证；）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-17T11:03:14.217

*   构造第一组中所有点的[R-Tree](http://en.wikipedia.org/wiki/R-Tree)。
*   对于第二组中的每个点，计算其圆的边界框并查找 R-Tree 中落在该边界框内的所有点（O(n log n) 相对于返回的点数）。
*   检查每个返回点与当前考虑的点之间的距离；丢弃任何位于边界框内但在圆圈外的东西。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-14T11:16:42.340

我认为您可以使用 Voronoi 图来做到这一点：

*   制作 {N 个点} 并集 {[0,0]} 的 Voronoi 图
*   不接触 N 个点的圆心正是这些位于点 [0,0] 的 Voronoi 单元内的圆心，这是一个凸多边形
*   过滤 M 个点，一个测试应该取 O(log C)=O(log N) [其中 C 是单元格 [0,0] 中的顶点数

总体复杂度应为 O(N log N+M log N)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-08T15:33:18.713

考虑计算的其他一些方面。

例如，您显然比较了很多距离。每个人都会打电话给 SQRT。为什么不比较“距离的平方”呢？SQRT 是一种昂贵的计算。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-01-05T14:29:06.823

永远不要使用 sqrt。将所有距离作为它们的平方。这样做，您也可以比较它们，但时间减少了 2-3 倍。

# java-me - 如何在 Java ME 中增加堆大小？

> ID：348018
> 
> 赞同：3
> 
> 时间：2008-12-07T20:17:20.887
> 
> 标签：java-me, heap-memory, nokia, n95

有没有办法增加设备上 Java ME 的堆大小？我正在为诺基亚 N95 开发应用程序，但在尝试对较大图像进行图像处理时遇到了内存问题。手机有大量可用的堆空间，但似乎将 Java ME 允许使用的数量限制为 1MB。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-07T21:23:42.767

简短的回答：没有。

更长的答案：堆大小在设备 VM 中是硬编码的。如果内存不足，则需要将任务拆分为更小的子任务以允许 GC 启动。在内存有限的情况下，只能进行有限的操作。你想...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-12T07:59:39.517

在一些设置 Midlet-Heap-Size jad 属性的 J2ME 手机上有效。假设手机只有 2MB 堆，将此 jad 属性设置为 3MB 会将堆增加到 3MB。你可以试试这个，不过对我来说它在很少的手机上工作。

# javascript - 计算数组中的结果

> ID：348021
> 
> 赞同：2
> 
> 时间：2008-12-07T20:19:35.577
> 
> 标签：javascript, arrays, greasemonkey

通过正则表达式和 Greasemonkey，我得到了一系列结果，如下所示：
`choice1, choice2, choice3, choice3, choice1, etc..`

我的问题是我如何计算选择，以便我知道选择 1 在数组中的次数，选择 2 在数组中的次数，等等。如果我不确切知道有多少选择或它们是什么。

最终目标是创建一个 Greasemonkey 脚本，该脚本存储每个选择在多个页面上获得的票数（可能使用 gm_setvalue，尽管我对其他想法持开放态度。）

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-07T20:38:37.303

一种技术是迭代选择并增加与对象属性中每个唯一选择相关联的计数器。

例子：

```
var choiceCounts = {};
for (var iLoop=0; iLoop < aChoices.length; iLoop++) {
  var keyChoice = aChoices[iLoop];
  if (!choiceCounts[keyChoice]) {
    choiceCounts[keyChoice] = 1;
  } else {
    choiceCounts[keyChoice]++;
  } //if
} //for 
```

然后，您有一个对象，其属性等于该属性在数组中存在的次数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-07T20:33:50.463

不是 100% 确定您在寻找什么，但我认为就是这样。

```
 // Original data
    var choices = [
        "choice 1",
        "choice 1",
        "choice 2",
        "choice 3",
        "choice 3",
        "choice 3",
        "choice 3",
        "choice 3",
        "choice 3",
        "choice 4",
        "choice 4",
        "choice 4"];

    //Create the results array
    var result = new Object();

    for (var choice in choices) {
        if (result[choices[choice]] === undefined)
            result[choices[choice]] = 1;
        else
            result[choices[choice]]++;
    }

    //Print result
    var str = "";

    for (var item in result)
        str += item + ": " + result[item] + "<br />";

    document.getElementById("resultDiv").innerHTML = str; 
```

**输出：**

```
choice 1: 2
choice 2: 1
choice 3: 6
choice 4: 3 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-07T21:21:37.683

***首先对数组进行排序***，然后您可以进行一次扫描以计算出现次数（类似于上面 Ryan 的建议）。

# .net - 实现保存/加载功能的方法是什么？

> ID：348022
> 
> 赞同：5
> 
> 时间：2008-12-07T20:20:41.053
> 
> 标签：.net, winforms, load, save

我正在尝试为 Windows 窗体应用程序实现加载/保存功能。

我有以下组件：

*   树视图
*   几个列表视图
*   几个文本框
*   几个对象（其中包含一个大字典列表）

我想实现一种将所有这些保存到文件中的方法，并在以后恢复/加载它。

最好的方法是什么？

我认为 XML 序列化是要走的路，但我不太确定如何或从哪里开始。还是需要一个非常复杂的解决方案才能做到这一点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-07T20:24:24.227

理想情况下，您不应该保留 UI 状态；你应该坚持代表你的数据的一些对象模型的状态。除了 之外`TreeView`，使用数据绑定将对象模型绑定到 UI 是相当简单的。这可以是`DataTable`基于 - 的方法，也可以是自定义类层次结构（我的偏好）。

将数据与 UI 分离后，保存数据就很简单了。诸如此类的例子很多`XmlSerializer`。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-08T08:23:02.607

这是一个将对象和一些祖先绑定到 UI 的示例；在这里使用 C# 3.0 纯粹是为了简洁 - 一切都适用于 C# 2.0。

这里的大部分代码是设置表单和/或处理属性更改通知 - 重要的是，没有任何代码专门用于从对象模型更新 UI，或从 UI 更新对象模型。

另请注意，IDE 可以为您执行大量数据绑定代码，只需将 BindingSource 拖放到表单上并通过属性网格中的对话框将 DataSource 设置为类型。

请注意，提供属性更改通知（PropertyChanged 的​​东西）不是必需的 - 但是，如果您确实实现了这一点，大多数 2-way UI 绑定将工作得更好。并不是说 PostSharp 有一些有趣的方法可以用最少的代码做到这一点。

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.IO;
using System.Windows.Forms;
using System.Xml.Serialization;
static class Program { // formatted for vertical space
    [STAThread]
    static void Main() {
        Application.EnableVisualStyles();

        Button load, save, newCust;
        BindingSource source = new BindingSource { DataSource = typeof(Customer) };
        XmlSerializer serializer = new XmlSerializer(typeof(Customer));
        using (Form form = new Form {
            DataBindings = {{"Text", source, "Name"}}, // show customer name as form title
            Controls = {
                new DataGridView { Dock = DockStyle.Fill, // grid of orders
                    DataSource = source, DataMember = "Orders"},
                new TextBox { Dock = DockStyle.Top, ReadOnly = true, // readonly order ref
                    DataBindings = {{"Text", source, "Orders.OrderRef"}}},
                new TextBox { Dock = DockStyle.Top, // editable customer name
                    DataBindings = {{"Text", source, "Name"}}},
                (save = new Button { Dock = DockStyle.Bottom, Text = "save" }),
                (load = new Button{ Dock = DockStyle.Bottom, Text = "load"}),
                (newCust = new Button{ Dock = DockStyle.Bottom, Text = "new"}),   
            }
        })
        {
            const string PATH = "customer.xml";
            form.Load += delegate {
                newCust.PerformClick(); // create new cust when loading form
                load.Enabled = File.Exists(PATH);
            };
            save.Click += delegate {
                using (var stream = File.Create(PATH)) {
                    serializer.Serialize(stream, source.DataSource);
                }
                load.Enabled = true;
            };
            load.Click += delegate {
                using (var stream = File.OpenRead(PATH)) {
                    source.DataSource = serializer.Deserialize(stream);
                }
            };
            newCust.Click += delegate {
                source.DataSource = new Customer();
            };
            Application.Run(form);
        } 
    }
}

[Serializable]
public sealed class Customer : NotifyBase {
    private int customerId;
    [DisplayName("Customer Number")]
    public int CustomerId {
        get { return customerId; }
        set { SetField(ref customerId, value, "CustomerId"); }
    }

    private string name;
    public string Name {
        get { return name; }
        set { SetField(ref name, value, "Name"); }
    }

    public List<Order> Orders { get; set; } // XmlSerializer demands setter

    public Customer() {
        Orders = new List<Order>();
    }
}

[Serializable]
public sealed class Order : NotifyBase {
    private int orderId;
    [DisplayName("Order Number")]
    public int OrderId  {
        get { return orderId; }
        set { SetField(ref orderId, value, "OrderId"); }
    }

    private string orderRef;
    [DisplayName("Reference")]
    public string OrderRef {
        get { return orderRef; }
        set { SetField(ref orderRef, value, "OrderRef"); }
    }

    private decimal orderValue, carriageValue;

    [DisplayName("Order Value")]
    public decimal OrderValue {
        get { return orderValue; }
        set {
            if (SetField(ref orderValue, value, "OrderValue")) {
                OnPropertyChanged("TotalValue");
            }
        }
    }

    [DisplayName("Carriage Value")]
    public decimal CarriageValue {
        get { return carriageValue; }
        set {
            if (SetField(ref carriageValue, value, "CarriageValue")) {
                OnPropertyChanged("TotalValue");
            }
        }
    }

    [DisplayName("Total Value")]
    public decimal TotalValue { get { return OrderValue + CarriageValue; } }
}

[Serializable]
public class NotifyBase { // purely for convenience
    [field: NonSerialized]
    public event PropertyChangedEventHandler PropertyChanged;

    protected bool SetField<T>(ref T field, T value, string propertyName) {
        if (!EqualityComparer<T>.Default.Equals(field, value)) {
            field = value;
            OnPropertyChanged(propertyName);
            return true;
        }
        return false;
    }
    protected virtual void OnPropertyChanged(string propertyName) {
        PropertyChangedEventHandler handler = PropertyChanged;
        if (handler != null) handler(this, new PropertyChangedEventArgs(propertyName));
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-07T20:34:43.503

是的，您绝对应该为此使用 XML 序列化。但正如 Marc Gravell 所指出的，您必须首先拥有保存 GUI 组件显示的数据的对象。然后，您实际上可以用最少的代码行自动（反）序列化。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-12-25T10:10:58.807

上面的示例存在问题。考虑到最终您的应用程序已更新。您的对象模型可能会发生巨大变化，因此无法反序列化。您可以做一些事情来确保从 xml 版本 1 的反序列化可以反序列化为版本 2 中的对象模型，但是如果您有可能进行重大的结构更改，则 xml 反序列化*不是*要走的路。

如果是这种情况并且您的应用程序已部署给客户，我强烈建议您进一步查看您的保存/加载逻辑。

**版本化序列化/反**
序列化以下列形式序列化您的对象状态：

```
<ObjectState version="1">
    <Field1>value</Field1>
    ... etc ...
</ObjectState> 
```

所以现在你有了生成保存状态的对象模型的版本。在您的反序列化中，您可以采取特殊的措施来适应这一事实。例如，将 Field1-Value 写入其他对象的列表中。

另一种方法是：

**反序列化之前的版本化序列化和转换序列**
化您的对象状态，如上所述（带有版本属性）。
反序列化时查看版本属性，如果这不是您期望的版本，则使用 xsl 脚本或 c# 代码将序列化对象状态转换为当前版本。您可以在当前项目中保存 xsl 转换列表

```
- conversions
    - v1-v2
    - v2-v3 
```

如果您当前处于版本 3 并且想要加载您的 xml 文件，请查看版本属性并运行所有 xsl 脚本以获取您当前的版本（版本 3）。所以你会运行 xsl-script v1-v2，然后运行 ​​v2-v3。

在这种情况下，您可以拥有不必关心向后功能的正常序列化和反序列化类。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-07T21:20:43.380

> 使用数据绑定将对象模型绑定到 UI 是相当简单的。

如何在没有持久存储的情况下将对象与 GUI 控件联系起来？如果我手动执行，这意味着我必须为内存中的每个对象编写大量的代码。我已经为这些数据提供了某种类存储，但它不是绑定排序场景，就像在这里读这个写一样。

我是否应该编写一个加载器来加载序列化的 XML 并获取对象，然后读取对象并填充整个 GUI？显然这更像是手动加载而不是绑定。我错过了什么吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-07T21:27:39.967

这是一篇关于如何使您的类或结构可序列化的精彩文章。我将创建一个类，允许您存储所需的所有数据。使类可序列化。这样，只需几行代码，您就可以将所有数据保存到文件中。然后只需多几行代码，您就可以从文件中检索数据。

[http://www.codeproject.com/KB/cs/objserial.aspx](http://www.codeproject.com/KB/cs/objserial.aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-07T23:59:51.857

序列化类的另一种方法是使用 ADO.NET 数据集进行数据存储，该数据集具有用于持久保存到 XML 文件的内置设施。代码将是最少的，您可以通过设计适合您正在执行的操作模型的表来仅存储您需要的相关数据。此外，如果您决定稍后将 UI 状态保存到数据库而不是本地文件，您将能够使用相同的代码。您只需要一个备用函数来保存数据集。

# null - sprintf 访问冲突

> ID：348037
> 
> 赞同：1
> 
> 时间：2008-12-07T20:37:12.873
> 
> 标签：null, char, segmentation-fault, printf

我对以下代码有疑问：

```
for(i = 0;(i - 1)< n;i++)
{
char* b;
sprintf(b, "%d", i);
} 
```

它编译得很好，但是当我运行它时，它给了我臭名昭著的“0XC0000005 Access Violation”错误。我尝试将 b 设置为 NULL、“”、“0”、0 和一堆其他东西，但随后我得到“0XC0000005 访问冲突”错误或“表达式：字符串！= NULL。任何帮助将不胜感激！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-07T20:41:47.577

`sprintf`将数据写入现有缓冲区，您将其作为第一个参数传递给它。目前，您根本没有为 b 指定值，这意味着（C 中的 IIRC）该值可以是任何值。如果将其设置为 NULL 或 0，`sprintf`将尝试从地址 0 开始写入内存。

您需要创建一个适当大小的缓冲区，以便 sprintf 可以写入其中。例如：

```
for(i = 0;(i - 1)< n;i++)
{
    char b[10];
    sprintf(b, "%d", i);
} 
```

当然，这是否*实际上*是您想要分配缓冲区的方式取决于您的真实代码想要对结果做什么。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-07T20:39:37.270

嗯...您指向 b 的指针包含垃圾，因为您尚未对其进行初始化或分配空间。Springtf 要求您分配一个目标缓冲区空间...

至少，您需要类似 char b[50] 或您期望的任何最大大小，而不仅仅是 char*。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-07T20:43:22.067

char* 是指向 char 或 char 数组的未初始化指针。需要定义一个缓冲区char[10]，否则sprintf的目标地址是未定义的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-07T20:48:28.233

sprintf 需要将一个已经分配的字符缓冲区传递给它，该缓冲区足够大以存储任何可能的结果。这很容易受到缓冲区溢出的影响——您可能想改用更安全的 snprintf。一种低效但安全的方法：

```
int bufsize = snprintf(NULL, 0, formatstring, ...);
char *buffer = malloc(bufsize+1); # count doesn't include trailing nul
if (buffer == NULL) out_of_memory_error();
snprintf(buffer, bufsize+1, formatstring, ...); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-07T20:48:25.660

非常感谢你！因为我需要一个 char*，所以我将代码重写为：

```
for(i = 0;(i - 1)< n;i++)
{
char* b;
char a[100];
b = a;
sprintf(b, "%d", i);
} 
```

它就像一个魅力。我终于可以继续我的生活了！再次非常感谢您！

# ios - iPhone 和 OpenCV

> ID：348040
> 
> 赞同：97
> 
> 时间：2008-12-07T20:38:55.400
> 
> 标签：ios, iphone, opencv

我知道[OpenCV 被移植到 Mac OS X](http://opencv.willowgarage.com/wiki/Mac_OS_X_OpenCV_Port)，但是我没有找到任何关于移植到 iPhone 的信息。

我不是 Mac 开发人员，所以我不知道 Mac OS X 端口是否足以用于 iPhone。

有谁比我更了解？

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2008-12-21T02:03:52.847

OpenCV 确实可以在 iphone 上运行。使用这里的configure脚本编译库：[cross compile for iphone](http://lambdajive.wordpress.com/2008/12/20/cross-compiling-for-iphone/)

你只需要像你做你的应用程序一样交叉编译。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2012-09-30T15:21:00.790

OpenCV 现在（自**2012 年**以来）有一个用于 iPhone (iOS)的**官方端口。**

你可以[在这里找到所有 OpenCV 的版本。](http://opencv.org)

并在此处找到安装说明：

[新版本 3.x 的教程和介绍](https://docs.opencv.org/3.4.3/d5/da3/tutorial_ios_install.html)

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2011-04-15T14:39:39.050

[Computer Vision Talks](http://computer-vision-talks.com)[的最新构建脚本](http://computer-vision-talks.com/2011/02/building-opencv-for-iphone-in-one-click/)适用于 Xcode 4 和 iOS 4.3。我自己试过这个脚本，真是太棒了！

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2010-01-20T09:16:58.260

这是 iPhone 上的 opencv2.0 [iphone opencv 测试](http://github.com/niw/iphone_opencv_test)

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2011-11-11T13:59:29.123

OpenCV 现在可作为 iOS 框架使用。只需拖放到您的项目中。它也支持视频捕获。查看文章并在此处获取示例项目：[opencv framework for ios](http://aptogo.co.uk/2011/09/opencv-framework-for-ios/)

为了透明起见，我写了这篇文章，它托管在我公司的网站上。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-12-07T20:48:42.947

我没有尝试过专门使用 OpenCV，但我为 iPhone 开发过，可以说我在 OS X 上尝试过的大多数库都不能在 iPhone 上开箱即用。其中一些只需要进行一些调整/配置，然后在 iPhone 上就可以了，但现实情况是手机缺少很多 OS X 支持的后端组件。大多数复杂的库（OpenCV 听起来像是其中之一）如果不付出很大的努力就无法工作 - 特别是因为 OpenCV 听起来它也依赖于其他几个外部库......所以这些也必须被移植。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2010-10-07T11:35:38.180

您只需要使用 cmake 或 cmake gui 工具为 OpenCV 项目生成 XCode 项目。请记住设置生成 XCode 项目的选项，而不是使用 CMakeFiles 的默认选项。打开生成的项目，将基础 SDK 更改为 iPhone SDK，然后点击构建！

由于 OpenCV 目前不支持 iOS（但他们已经宣布 2.2 版支持 iPhone），highgui 库将无法编译。因此，如果您需要相机访问权限，则必须自己编写。

无论如何，其他库应该在设备上编译和工作。（为我工作）。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-06-04T14:14:00.260

iPhone 确实支持 OpenCV，如果您想先使用它，请访问 iPhone 上最好的 OpenCV 网络文档： [Yoshimasa Niwa's](http://niw.at/articles/2009/03/14/using-opencv-on-iphone/en)

我使用了它，并且我在 AppStore 上已经有一个使用人脸检测和图像处理的应用程序：[Flags&Faces](http://itunes.apple.com/app/flags-faces/id371891114?mt=8)如果您有任何疑问，请与我联系。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-07T21:13:40.710

请注意，OpenCV 在 Intel 芯片上运行得非常快，但 iPhone 是 arm。当然，OpenCV 非常有用，但不会那么快。此外，没有办法在 iPhone 上获得实时视频流，所以所有正常的潜在 CV 应用程序都失去了吸引力，不是吗？

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-01-24T21:52:53.127

你也可以[使用像 Cocoapods 这样的包管理器来](https://cocoapods.org/?q=on%3Aios%20opencv)安装 OpenCV 。

引用安装指南：

> 您想将类似于以下内容的 pod 'OpenCV', '~> 3.0' 添加到您的 Podfile 中：
> 
> ```
> target 'MyApp' do
>     pod 'OpenCV', '~> 3.0' 
> end 
> ```
> 
> 然后`pod install` 在你的终端内运行，或者从 CocoaPods.app 运行。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-20T07:10:26.650

这是为 iPhone/iPhone 模拟器构建通用 OpenCV 框架的修改脚本（基于 LambdaJive 的脚本）-universal [-i386arm opencv 框架](http://zaaghad.blogspot.com/2009/02/universal-i386arm-opencv-framework-for.html)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-06-29T20:40:33.027

Yoshimasa 的以下帖子确实适用于 I OS 和 iPhone 4，并且能够访问前后摄像头。

该项目的链接是[在 iphone en 上使用 opencv，](http://niw.at/articles/2009/03/14/using-opencv-on-iphone/) 示例代码位于 webgit，链接自本文。我真的鼓励在获取源代码之前阅读这篇文章。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-04-09T20:48:16.750

在 iPhone 上使用 opencv 的项目（准确地说是 Lucas-Kanade 光流）。源代码可用，应用程序也在 AppStore 上 -

# python - 什么可以证明 Plone 的复杂性？

> ID：348044
> 
> 赞同：13
> 
> 时间：2008-12-07T20:41:40.900
> 
> 标签：python, content-management-system, plone, zope

克隆非常复杂。[Zope](http://en.wikipedia.org/wiki/Zope) 2、[Zope3](http://en.wikipedia.org/wiki/Zope_3)、[Five](http://codespeak.net/z3/five/)、[ZCML](http://wiki.zope.org/zope3/ZCML)、[ZODB](http://en.wikipedia.org/wiki/Zope_Object_Database)、[ZEO](http://en.wikipedia.org/wiki/Zope_Object_Database#ZEO)，一大堆首字母缩写词和缩写词。

这很难开始，目前的状态似乎还没有定论。它主要基于 Zope2，但通过 Five 合并了 Zope3。并且到处都有 XML 配置文件。

陡峭的学习曲线是否值得？这种复杂性今天仍然合理吗？

背景：我需要一个平台。客户通常需要 CMS。我目前正在阅读“ [Professional Plone Development](http://plone.org/news/book-professional-plone-development-now-shipping) ”，没有 Plone 的先验知识。

问题：客户并不总是想要相同的东西，而且您无法事先知道。有一件事是肯定的：他们不想要 Plone 的默认主题。但是任何附加功能都是有风险的。当您对系统不够了解以进行规划时，您不能只是开始说“[如果您想了解 Plone 的复杂性，就必须提出要求。 ”](https://stackoverflow.com/questions/348044/what-could-justify-the-complexity-of-plone/351692#351692)

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-12-08T01:59:39.073

没有任何背景信息很难回答你的问题。如果您只想要一个博客，那么复杂性是否合理？不。如果您要为 400 多人构建公司内部网，那么复杂性是否合理？是的。如果你想成为一名顾问，这是一项很好的投资吗？绝对地！那里有很多 Plone 工作，而且它的报酬比一般的 PHP 工作要好得多。

我鼓励您澄清您要构建的内容，并向 Plone 论坛寻求建议。Plone 有一个非常成熟和友好的社区——如果你尝试做的事情不适合 Plone，绝对会让你知道。你当然可以用 Plone 做任何你想做的事情，但是在某些领域它是可用的最佳解决方案，而在其他领域则需要大量工作才能将其更改为做其他事情。

一些背景：

Plone 在这个时间点变得复杂的原因是它正在转向更现代的架构。它现在正在桥接旧方法和新方法，这增加了一些复杂性，直到过渡基本完成。

Plone 这样做是为了通过破坏向后兼容性来避免让他们的客户落后，他们非常重视这一点——不像我可以提到的其他系统（但不会；）。

你关心你的数据，Plone 社区关心他们的数据——我们希望你能够升级到新的更好的版本，即使我们正在过渡到一个新的架构。这是 Plone 社区的优势之一，但在飞机飞行时修改飞机当然要付出代价，这有点临时的、额外的复杂性。

此外，Plone 作为一个社区非常关注安全性（将其与任何其他系统报告的漏洞进行比较），以及重视良好架构、测试和可重用性的非常专业的文化。

例如，考虑当前正在开发的 Plone 版本（将成为 4.0）：

*   它的启动速度比当前版本快 3-4 倍。
*   它使用的内存比当前版本少约 20%。
*   有一个非常简单的类型系统正在开发中（Dexterity），它将降低复杂性并大大加快系统速度，同时保持相同级别的功能
*   代码库已经比当前的发布版本小 20%，并且变得更小。
*   新类型系统的早期基准显示内容编辑速度提高了 5 倍，我们还没有真正开始优化这部分。

— Alexander Limi，Plone 联合创始人（略带偏见；）

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-12-09T03:29:19.563

如果您想了解 Plone 的复杂性，您必须提出要求。对于大多数人来说，它只是不存在。它通过一键式安装程序在几分钟内安装。然后就是一键登录，一键创建页面，使用WYSYWIG编辑器，一键保存。一切都通过一个直观的 Web GUI。克隆是一种产品。

如果您想将其用作“平台”，那么该平台是一个包含超过一百万行代码的堆栈，它实现了一个完整的内容管理套件。没有人知道这一切。但是，所有这些“首字​​母缩略词”和“文件”都是一种软件的证据，该软件已包含在组件中，因此没有人需要全部了解。您可以根据需要深入或浅入其中。如果您在内容管理的某些方面需要某些东西，它已经存在，您不必从头开始创建它，您可以按照与广泛实践和审查一致的方式来完成它。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-01-15T13:08:53.300

[我在这里](http://bitubique.com/content/im-done-plone#comment-10)发现了一个匿名评论，它比那篇帖子本身要好得多，所以我在这里完整地转发它，并纠正了几个错别字。

* * *

今年夏天，我的国际象棋俱乐部要求我建立一个新网站，董事会成员应该能够在其中添加新闻快讯、文章……听起来像一个 CMS。作为一名 Python 开发人员，我查看了 Plone 并购买了 Aspeli 的书 Professional Plone development（顺便说一句写得很好）。

我花了 3 周的假期研究这本书，并建立了网站的第一个模型。

3 周后，我意识到 Plone 有一些非常好的东西，但也有一些非常令人沮丧的东西。

*   如果您不需要自定义 Plone，Plone 的功能和布局都很棒
*   Plone 具有良好的安全模型
*   Plone 具有良好的现成工作流程
*   Plone 是多语言（我需要的）

不利的一面

1.  Plone 太慢了。在我的开发平台上（一台 3 岁的电脑，512 MB RAM）启动 Plone 需要 30 秒，重新加载页面需要 10 到 15 秒
2.  你需要很多不同的技术来定制或开发即使是最简单的东西
3.  TAL 和 Metal 不是最先进的，也不适应 Plone 的 OO 设计。
4.  默认获取是错误的。获取可能非常有用（例如安全性），但应在需要时明确定义。这是一个设计缺陷
5.  Plone 不区分内容和布局。这是一个严重的设计缺陷。没有理由在例如级联样式表或创建 3 列布局的 html 上应用安全设置和角色，并且没有理由为什么这些元素应该在 ZODB 中而不是在文件系统中
6.  Plone 不区分网页设计师和内容编辑/发布者，这又是一个严重的缺陷。内容编辑器/发布者添加/审查在实时站点上运行的内容。网页设计师在测试服务器上添加/修改内容类型、表单和布局，并在准备好后将其移植到实时服务器。Plone 为内容编辑器设置的安全限制不应用于可以访问服务器上文件系统的网页设计师。
7.  Plone 不区分网页设计师的图形方面和编程方面。图形艺术家使用的工具只会说 html、css 和一点点 javascript，但没有 Python、适配器和其他高级编程概念。因此，Plone 中的完整蒙皮系统是一场噩梦

由于第 4、5、6 和 7 点，我认为 Plone 如此缓慢。

第 6 点和第 7 点让我放弃了 Plone。我四处寻找其他选择，最终决定在 Pylons 上开发自己的 CMS，与 Plone 相比，它的速度快得惊人。在同一台开发服务器上，我的启动时间为 1 秒，并且无法测量重新加载页面的时间。

网站 www.kosk.be 正在运行（它是荷兰语）。其背后的 CMS，名为 Red Devil，将于明年开始作为独立的开源项目推出

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-12-07T23:30:53.850

我看到有四件事可以证明在使用 Plone 上投入时间是合理的：

*   Plone 有一个庞大而乐于助人的社区。大多数你需要的东西，其他人
    在过去的某个时间已经做过了。他可能问了一些问题并得到了有用的答案，或者他写了一个教程。通常这会留下很容易找到的痕迹。关于他是如何做到的。
*   您无需了解许多定制需求的整个复杂性。
*   Plone 开发人员意识到他们的复杂堆栈，并且正在讨论如何减少这种情况。Plone 过去已经证明，它能够通过定义的弃用阶段以干净的方式更新自身并放弃旧的基础设施。
*   有许多本地用户组和乐于助人的人。

哦等等，有人告诉我 plone 开发人员会议是最好的会议之一！ [像那个](http://plone.org/events/conferences/vienna-2004)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-01-24T17:04:56.613

从系统管理员的角度来看，Plone 简直不敢成为绝对的恶魔。在 Linux 平台上，升级、维护和安装你想要安装的东西比必要的还要痛苦。不过，这只是我的两分钱，也是我通常更喜欢避免使用 Zope/Plone 堆栈的原因。

注意：新版本更好，但旧版本....呃

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-05-12T21:40:37.083

增生。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-03-16T22:08:16.213

关于[这里](https://stackoverflow.com/questions/348044/what-could-justify-the-complexity-of-plone/446659#446659)的评论，我认为 Plone 不会那样工作（至少现在不会了）。

1 - Plone 确实比其他 CMS 解决方案慢，但从开箱即用的设置到 Apache-Varnish-Zope-Relstorage 解决方案，有很多优化空间。

2 - 这是真的。[这里](https://stackoverflow.com/questions/348044/what-could-justify-the-complexity-of-plone/348508#348508)的答案有点解释它，但确实 Plone 是一种复杂的动物。

3 - 不确定你的意思。TAL Path 表达式基于对象属性遍历的概念。对我来说似乎是OO。

4 - 对。尽管在您了解了 Acquisition 的工作原理之后，它不会妨碍您。我猜，在 Plone 中没有多少东西依赖于 Acquisition。

5 - 不正确。Zope 页面模板都是关于将内容与演示分开的。可以从 ZODB 查看内容和演示文稿（实际上大多数模板都保留在文件系统中，您只是在 ZODB 中看到它们的“视图”）这一事实与 ZODB 是一个大对象这一事实更相关数据库 - 这反过来并不意味着它们都是内容。“纯” OO 系统中的一切都是一个对象，重要的是对象的种类（表示对象、内容对象等）。

6 - Plone 确实区分了网页设计师和内容创建者。设计师进行所有自定义（模板、CSS、JS 等），然后内容创建者使用 Plone UI 创建内容。这里的重点是 Plone 主要是一个 CMS，这意味着内容创建者在设计方面应该是外行。

7 - 部分正确。考虑到 UI 结构不会改变，所有的表现规范都包含在 CSS 文件中。如果 UI 结构需要更改，设计师可能会与程序员合作 :-) 以充分利用模板。

我猜在没有输出动态页面的系统中，设计师可以完全自由地只说 HTML、CSS 和 JS，而忽略一些其他技术，无论是 PHP、Python、ASP 还是 Java。如果他这样做了，那么肯定会有一个程序员从设计师那里得到 HTML、CSS 和 JS 并“动态化”。这个模型肯定存在于 Plone 中。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-01-12T12:05:10.577

如果不需要，请不要使用它。整个 ZOPE 宇宙就是一只恐龙。生长多年，收集了大量的碎屑和铁锈。现在很多事情都会完全不同。对于大多数东西来说过于复杂，对于复杂的东西来说很难处理。它与纤薄和可扩展的设计相反。为了认真解决这个问题，我没有看到该项目涉及必要的人力。

抱歉措辞严厉，我也希望它会更好。

# c# - Unity Application Block，继承注入

> ID：348046
> 
> 赞同：0
> 
> 时间：2008-12-07T20:41:48.887
> 
> 标签：c#, unity-container

我在使用 Unity 应用程序块时遇到问题，我创建了一个名为 Composition 的基类。

每个组合都包含一个 IUnityContainer，当我创建顶级对象 UniversalComposition 时，我想用一个 UnityContainer 对其进行初始化。

从 UniversalComposition 创建的任何对象我想使用 IUnityContainer.CreateChildContainer 方法将子 IUnityContainer 注入其中。

```
class Program
{
    static void Main(string[] args)
    {
        UniversalComposition universe = new UniversalComposition();

    }
}

public class UniversalComposition : Composition
{
    // Everything that gets resolved in this container should contain a child container created by the this container

    public UniversalComposition()
    {
        this.Container.RegisterType<IService, Service>();
    }

    protected override IUnityContainer CreateContainer()
    {
        return new UnityContainer();
    }

}

public abstract class Composition
{
    protected IUnityContainer Container {get; private set;}

    public Composition()
    {
        this.Container = this.CreateContainer();
    }

    public TInstance Resolve<TInstance>()
    {
        return this.Container.Resolve<TInstance>();
    }

    protected abstract IUnityContainer CreateContainer();
}

public class Service : Composition, IService
{
    public Service(/* I want to inject a child Unity Container in here container.CreateChildContainer() */)
    {
    }
}

public interface IService { } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-07T21:45:05.017

我认为这不会通过注入起作用，因为您已经在父级中实现了它，因为父级容器在子对象被实例化之前不存在。因此，您无法生成要注入的子容器。更好的方法是通过基类上的参数化构造函数注入父容器，然后在子类中注入两者。默认构造函数可以使用 null 调用参数化构造函数，并且参数化构造函数可以检测到这一点并在未指定容器的情况下创建一个容器。为了清楚起见，下面的示例进行了简化。

```
public abstract class BaseClass
{
    public IUnityContainer Container { get; protected set; }

    public BaseClass() : BaseClass(null) {}

    public BaseClass( IUnityContainer container )
    {
        this.container = container ?? this.CreateContainer();
    }

    public abstract IUnityContainer CreateContainer();
}

public class DerivedClass : BaseClass
{
    public IUnityContainer ChildContainer { get; private set; }

    public DerivedClass() : DerivedClass(null,null) {}

    public DerivedClass( IUnityContainer parent, IUnityContainer child )
        : BaseClass( parent )
    {
        this.ChildContainer = child ?? this.CreateChildContainer();
    }

    public IUnityContainer CreateContainer()
    {
         return new UnityContainer();
    }

    public IUnityContainer CreateChildContainer()
    {
         return this.Container.CreateChildContainer();
    }

} 
```

# iphone - 为 iPhone 创建静态库

> ID：348051
> 
> 赞同：16
> 
> 时间：2008-12-07T20:43:24.750
> 
> 标签：iphone, xcode, static-libraries

我想将一个开源库用于我的 iPhone 应用程序。该库是用 C 语言编写的，并使用 Makefile 进行编译。我想使用静态库。

如果我将 .a 文件添加到我的项目依赖项中，它可以很好地与模拟器配合使用，但在针对 iPhone SDK 时它不会链接（当然因为 .a 文件是为英特尔平台编译的）。

我应该使用哪些 GCC 编译器标志来编译 iPhone SDK 的静态库？我认为“-arch”选项将为我提供 iPhone 架构，但没有运气。

任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-05T18:18:39.683

对于基于 autoconf 的库，我会投票给 Christopher Stawarz 的构建脚本：

[http://pseudogreen.org/blog/build_autoconfed_libs_for_iphone.html](http://pseudogreen.org/blog/build_autoconfed_libs_for_iphone.html)

使用此脚本，您可以使用单个命令自动化整个过程，并轻松为不同平台提供库二进制文件，例如 iPhoneOS 2.0/2.1/2.2/2.2.1 和 iPhoneSimulator 2.0/2.1/2.2/2.2.1。

但是，由于[Xcode 3.1 的更改](http://hollowout.blogspot.com/2009/02/i-want-platformsdkdir.html)，$(SDKROOT) 构建设置变成了一些简称，如“macosx10.5”、“iphoneos2.2.1”或“iphonesimulator2.2.1”。因此，他在文章中提到的关于在 Xcode 中为库和标头设置搜索路径的方式将不起作用（在 Xcode 3.1 中）。您需要自己对路径进行硬编码。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-08T00:08:58.143

尝试使用 arm-apple-darwin-gcc 作为 GCC 应用程序进行编译。然后，您可以使用 lipo 将 2 个静态库（arm 和 386）合并在一起，以便在 sim 与设备上的开发是无缝的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-05-16T17:35:26.320

只需使用 x86 sdk（iphone 模拟器）正常编译它，然后再次使用 arm/ios 平台（arm-xxx-xxx），然后使用“LIPO”（命令行工具）将两个静态库组合在 .a 中。工作一种享受，它比重新发明轮子更简单（至少对于那些小的库）......我用 liblo 和 libdmtx 做到了，我没有任何问题，我花了大约 10 分钟来做这两个...... :-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T04:14:48.863

After several attempts to use the arm GCC compiler with the tips provided [here](http://www.simplifymedia.com/blog/?p=16), I gave up. In my case, it is much simpler to simply port the library to XCode than trying to compile a static library for the iPhone.

# java - 在 Java 中使用 XStream 序列化为 YAML

> ID：348052
> 
> 赞同：5
> 
> 时间：2008-12-07T20:44:12.847
> 
> 标签：java, yaml, xstream

**[Java XStream](http://x-stream.github.io/)包是否有 YAML 驱动程序？**

我已经在使用 XStream 来序列化/反序列化 XML 和 JSON。我希望能够对 YAML 做同样的事情。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T21:18:58.923

要解析 YAML 文档，您可以使用以下链： YAML -> SnakeYAML -> Java -> Your Application (-> XStream -> XML)

发出 YAML 更简单，有几个选项：1) 你的应用程序 -> 带有自定义编写器的 XStream -> YAML 2) 你的应用程序 -> SnakeYAML -> YAML

第二种选择不需要任何额外的开发。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T15:05:40.797

您可能会发现这有助于获得指导：[XStream - 如何将对象序列化为非 XML 格式](http://joe.truemesh.com/blog//000479.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T15:03:29.897

我使用了 JYAML，效果很好。我知道它不能直接回答您的问题，但效果很好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-05-04T05:45:09.163

虽然 XStream 对于 XML 来说非常好，但它生成的 JSON 相当丑陋，因为使用 Badgerfish 表示法进行转换。

但是您可以考虑将[杰克逊](https://github.com/FasterXML/jackson-databind)用于所有 3 个；[因为虽然默认包只处理 JSON，但XML](https://github.com/FasterXML/jackson-dataformat-xml)和[YAML](https://github.com/FasterXML/jackson-dataformat-yaml)都有扩展，并且都使用相同的强大数据绑定功能，只是在低级解析器和生成器上有所不同（对于 XML，使用 Stax API）

# java - 确保用户在 Java Web App 中经过身份验证

> ID：348090
> 
> 赞同：1
> 
> 时间：2008-12-07T21:20:33.020
> 
> 标签：java, security, jsp, servlets, web-applications

我的 Web 应用程序有一个安全区域，用户可以通过 JSP 登录该区域。JSP 将用户名和密码发送到一个 servlet，然后由该 servlet 检查用户凭证是否有效。如果它们有效，则将用户定向到安全资源。如何确保用户不能在不先验证的情况下导航到安全资源？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-07T21:42:52.710

一种常见的方法是在用户的会话中设置一个令牌，即

`session.setAttribute("loggedIn", "true");`

甚至

`session.setAttribute("loggedInUser", "someUserName");`

并在任何应保护的页面上进行检查。一个好的策略是使用附加到任何要保护的页面的 servlet 过滤器来执行检查。如果他们没有通过检查，过滤器可以重定向到登录页面。另见此处：http: [//java.sun.com/products/servlet/Filters.html](http://java.sun.com/products/servlet/Filters.html)

这是一篇关于使用过滤器进行身份验证的好文章：http: [//www.developer.com/java/ent/article.php/3467801](http://www.developer.com/java/ent/article.php/3467801)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-08T11:53:04.977

在 web.xml 中使用安全约束怎么样：

```
<security-constraint>
      <web-resource-collection>
         <web-resource-name>Secure</web-resource-name>
         <url-pattern>/secure/*</url-pattern>
      </web-resource-collection> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-07T21:43:53.210

确保人们始终通过单个 servlet 访问您的应用程序，其中 servlet 将请求发送到 JSP，并将结果响应返回给浏览器。这样，您将始终控制发生的事情，因为只有一个入口点。

另一种方法是使用会话变量（服务器端，甚至在 cookie 中），每个需要身份验证的 JSP 都会对其进行检查。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T12:18:15.550

安全性真的很难做到。比你通常想象的要多得多。必须使用框架（想到[Acegi ），或者](http://www.acegisecurity.org/)[LenW 指出](https://stackoverflow.com/questions/348090/ensuring-users-are-authenticated-in-java-web-app#349287)的 web.xml 的标准“”部分是必须的！至少使用过滤器来处理安全的授权部分。

我不太喜欢使用单点入口的解决方案（如[Rolf 所建议的](https://stackoverflow.com/questions/348090/ensuring-users-are-authenticated-in-java-web-app#348137)）。在我看来，这似乎是对您的架构施加的人为约束。在一个 webapp 中有多个 servlet 有很多很好的理由。

无论您做什么，都不要使用在每个页面上都依赖手动代码的技术（例如：每个 JSP 都以“if user_authentified ...”开头）。你会忘记把它放在某个地方......

# search - “你的意思是？” Lucene.net 中的功能

> ID：348093
> 
> 赞同：28
> 
> 时间：2008-12-07T21:22:01.303
> 
> 标签：search, lucene

有人可以告诉我如何在 Lucene.net 中实现“您的意思是”功能吗？

谢谢！

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-01-29T08:25:43.827

您应该查看 contrib 目录中的[SpellChecker](https://svn.apache.org/repos/asf/lucene/lucene.net/trunk/C%23/contrib/SpellChecker.Net/)模块。它是 Java lucene 的[SpellChecker](https://lucene.apache.org/core/6_3_0/suggest/index.html?org/apache/lucene/search/spell/SpellChecker.html)模块的一个端口，因此它的[文档](http://wiki.apache.org/jakarta-lucene/SpellChecker)应该会有所帮助。

（来自javadocs：）

示例用法：

```
 import org.apache.lucene.search.spell.SpellChecker;

  SpellChecker spellchecker = new SpellChecker(spellIndexDirectory);
  // To index a field of a user index:
  spellchecker.indexDictionary(new LuceneDictionary(my_lucene_reader, a_field));
  // To index a file containing words:
  spellchecker.indexDictionary(new PlainTextDictionary(new File("myfile.txt")));
  String[] suggestions = spellchecker.suggestSimilar("misspelt", 5); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-07T21:34:48.017

AFAIK Lucene 支持邻近搜索，这意味着如果您使用以下内容：

场：搅拌~0.5

（它是波浪号）

将匹配“字符串”。浮点数是搜索的“容忍度”，其中 1.0 是完全匹配，0.0 是匹配所有内容（有点）。

然而，不同的解析器会以不同的方式实现这一点。

邻近搜索比模糊搜索 (stri*) 慢得多，因此请谨慎使用。在您的情况下，人们会假设如果您在常规搜索中找不到匹配项，您会尝试进行邻近搜索以查看您找到的内容，并以某种方式根据结果呈现“您的意思是”。

出于性能原因，缓存此类查找以查找非常常见的拼写错误可能很有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-29T00:06:38.327

谷歌的“你的意思是？” 是（可能；他们当然是秘密的）通过查询他们的查询日志来实现。查看搜索您正在处理的查询的人是否很快搜索了非常相似的内容；如果是这样，则表明他们犯了一个错误，并意识到他们应该寻找什么。

由于您可能没有庞大的查询日志，因此您可以对其进行近似。取查询，拆分词条，查看数据库中是否有相似词条（通过编辑距离等）；用附近的术语替换您的术语，然后重新运行查询。如果您获得更多点击，那可能是一个更好的查询。推荐给用户。（而且由于您已经获得了热门歌曲，并且大多数人只查看前 2 个结果，因此向他们展示这些结果。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-01T22:08:42.120

看一下名为语义向量的谷歌代码项目。在 Lucene 邮件列表上进行了大量讨论，以执行您使用后的功能 - 但是它是用 java 编写的。

您可能必须在搜索日志中解析和使用一些机器学习算法来构建这样的功能！

# security - “双重哈希”密码是否比仅哈希一次更安全？

> ID：348109
> 
> 赞同：314
> 
> 时间：2008-12-07T21:31:20.940
> 
> 标签：security, hash, passwords, cryptography, password-hash

在存储之前对密码进行两次哈希处理是否比仅对密码进行一次哈希处理更安全或更安全？

我正在谈论的是这样做：

```
$hashed_password = hash(hash($plaintext_password)); 
```

而不仅仅是这个：

```
$hashed_password = hash($plaintext_password); 
```

如果它不太安全，你能提供一个很好的解释（或一个链接）吗？

另外，使用的散列函数有什么不同吗？如果您混合 md5 和 sha1（例如）而不是重复相同的哈希函数，会有什么不同吗？

注意 1：当我说“双重哈希”时，我指的是对密码进行两次哈希处理，以使其更加模糊。我不是在谈论[解决冲突的技术](http://en.wikipedia.org/wiki/Double_hashing)。

**注意 2：我知道我需要添加随机盐才能真正确保安全。问题是使用相同的算法进行两次散列是否有助于或损害散列。**

* * *

## 回答 #1

> 赞同：283
> 
> 时间：2008-12-07T21:44:54.033

## 散列密码一次是不安全的

不，多个散列并不安全；它们是安全密码使用的重要组成部分。

迭代哈希会增加攻击者尝试其候选列表中每个密码的时间。您可以轻松地将攻击密码的时间从数小时增加到数年。

## 简单的迭代是不够的

仅仅将哈希输出链接到输入并不足以保证安全。迭代应该在保留密码熵的算法的上下文中进行。幸运的是，有几种已发布的算法已经过足够的审查，从而对其设计充满信心。

像 PBKDF2 这样的良好密钥派生算法将密码注入每一轮散列，从而减轻对散列输出冲突的担忧。PBKDF2 可按原样用于密码验证。Bcrypt 遵循加密步骤的密钥推导；这样，如果发现了一种快速逆转密钥派生的方法，攻击者仍然必须完成已知明文攻击。

## 如何破解密码

存储的密码需要保护免受离线攻击。如果密码没有加盐，它们可以通过预先计算的字典攻击（例如，使用彩虹表）来破解。否则，攻击者必须花时间计算每个密码的哈希值并查看它是否与存储的哈希值匹配。

并非所有密码的可能性都相同。攻击者可能会彻底搜索所有短密码，但他们知道，暴力破解成功的机会会随着每增加一个字符而急剧下降。相反，他们使用最可能密码的有序列表。它们以“password123”开头，然后逐渐变为不常用的密码。

假设一个攻击者列表很长，有 100 亿个候选者；还假设桌面系统每秒可以计算 100 万个哈希值。如果只使用一次迭代，攻击者可以测试她的整个列表不到三个小时。但如果只使用 2000 次迭代，那么这个时间会延长到将近 8 个月。要击败更复杂的攻击者（例如，能够下载可以利用其 GPU 功能的程序的攻击者），您需要更多的迭代。

## 多少才够？

要使用的迭代次数是安全性和用户体验之间的权衡。攻击者可以使用的专用硬件很便宜，但[它仍然可以每秒执行数亿次迭代。](https://en.bitcoin.it/wiki/Mining_hardware_comparison)*攻击者*系统的性能决定了在给定多次迭代的情况下破解密码需要多长时间。但是您的应用程序不太可能使用这种专用硬件。在不激怒用户的情况下，您可以执行多少次迭代取决于*您的*系统。

您可能可以让用户在身份验证期间额外等待 ¾ 秒左右。分析您的目标平台，并尽可能多地使用迭代。我测试过的平台（移动设备上的一个用户，或服务器平台上的多个用户）可以轻松地支持60,000 到 120,000 次迭代的[PBKDF2](ftp://ftp.rsasecurity.com/pub/pkcs/pkcs-5v2/pkcs5v2_1.pdf)，或者成本因子为 12 或 13 的[bcrypt](http://www.usenix.org/events/usenix99/provos.html)。

## 更多背景

阅读 PKCS #5 以获取有关盐和迭代在散列中的作用的权威信息。尽管 PBKDF2 旨在从密码生成加密密钥，但它可以很好地作为密码验证的单向哈希。bcrypt 的每次迭代都比 SHA-2 哈希更昂贵，因此您可以使用更少的迭代，但想法是一样的。Bcrypt 还超越了大多数基于 PBKDF2 的解决方案，它使用派生密钥来加密众所周知的纯文本。生成的密文与一些元数据一起存储为“散列”。然而，没有什么能阻止你对 PBKDF2 做同样的事情。

以下是我在这个主题上写的其他答案：

*   [散列密码](https://stackoverflow.com/questions/312088/what-is-the-easiest-way-to-create-and-compare-a-salted-password-in-net#312159)
*   [散列密码](https://stackoverflow.com/questions/287517/encryptinghashing-plain-text-passwords-in-database#287738)
*   [盐](https://stackoverflow.com/questions/55862/how-to-implement-password-protection-for-individual-files#55904)
*   [隐藏盐](https://stackoverflow.com/questions/213380/the-necessity-of-hiding-the-salt-for-a-hash#215165)
*   [PBKDF2 与 bcrypt](https://stackoverflow.com/a/1561245/3474)
*   [加密货币](https://stackoverflow.com/a/6833165/3474)

* * *

## 回答 #2

> 赞同：238
> 
> 时间：2013-07-01T01:26:37.237

对于那些说它是安全的人来说，他们通常是正确**的**。对于特定问题，“双重”散列（或逻辑扩展，迭代散列函数）**如果做得对，是绝对安全的。**

对于那些说它不安全的人，他们**在这种情况下**是正确的。**问题中**发布的代码不安全。让我们谈谈为什么：

```
$hashed_password1 = md5( md5( plaintext_password ) );
$hashed_password2 = md5( plaintext_password ); 
```

我们关注哈希函数的两个基本属性：

1.  *Pre-Image Resistance* - 给定一个散列`$h`，应该很难找到`$m`这样的消息`$h === hash($m)`

2.  *Second-Pre-Image Resistance* - 给定一条消息`$m1`，应该很难找到不同的消息`$m2`，这样`hash($m1) === hash($m2)`

3.  *碰撞阻力*- 应该很难找到一对`($m1, $m2)`这样的消息`hash($m1) === hash($m2)`（请注意，这类似于 Second-Pre-Image 阻力，但不同之处在于攻击者可以控制这两个消息）......

**对于密码的存储**，我们真正关心的是*Pre-Image Resistance*。另外两个将没有实际意义，因为`$m1`我们试图保护用户的密码。因此，如果攻击者已经拥有它，那么哈希就没有什么可以保护的了……

# 免责声明

接下来的一切都是基于我们所关心的前提是*Pre-Image Resistance*。散列函数的其他两个基本属性可能不会（并且通常不会）以相同的方式成立。所以这篇文章中的结论**只适用于使用哈希函数存储密码的情况。它们一般不适用...**

# 让我们开始吧

为了便于讨论，让我们发明自己的哈希函数：

```
function ourHash($input) {
    $result = 0;
    for ($i = 0; $i < strlen($input); $i++) {
        $result += ord($input[$i]);
    }
    return (string) ($result % 256);
} 
```

现在应该很明显这个哈希函数做了什么。它将输入的每个字符的 ASCII 值相加，然后将该结果与 256 取模。

所以让我们测试一下：

```
var_dump(
    ourHash('abc'), // string(2) "38"
    ourHash('def'), // string(2) "47"
    ourHash('hij'), // string(2) "59"
    ourHash('klm')  // string(2) "68"
); 
```

现在，让我们看看如果我们围绕一个函数运行几次会发生什么：

```
$tests = array(
    "abc",
    "def",
    "hij",
    "klm",
);

foreach ($tests as $test) {
    $hash = $test;
    for ($i = 0; $i < 100; $i++) {
        $hash = ourHash($hash);
    }
    echo "Hashing $test => $hash\n";
} 
```

输出：

```
Hashing abc => 152
Hashing def => 152
Hashing hij => 155
Hashing klm => 155 
```

嗯，哇。我们已经产生了碰撞！！！让我们试着看看为什么：

这是对每个可能的哈希输出的字符串进行哈希处理的输出：

```
Hashing 0 => 48
Hashing 1 => 49
Hashing 2 => 50
Hashing 3 => 51
Hashing 4 => 52
Hashing 5 => 53
Hashing 6 => 54
Hashing 7 => 55
Hashing 8 => 56
Hashing 9 => 57
Hashing 10 => 97
Hashing 11 => 98
Hashing 12 => 99
Hashing 13 => 100
Hashing 14 => 101
Hashing 15 => 102
Hashing 16 => 103
Hashing 17 => 104
Hashing 18 => 105
Hashing 19 => 106
Hashing 20 => 98
Hashing 21 => 99
Hashing 22 => 100
Hashing 23 => 101
Hashing 24 => 102
Hashing 25 => 103
Hashing 26 => 104
Hashing 27 => 105
Hashing 28 => 106
Hashing 29 => 107
Hashing 30 => 99
Hashing 31 => 100
Hashing 32 => 101
Hashing 33 => 102
Hashing 34 => 103
Hashing 35 => 104
Hashing 36 => 105
Hashing 37 => 106
Hashing 38 => 107
Hashing 39 => 108
Hashing 40 => 100
Hashing 41 => 101
Hashing 42 => 102
Hashing 43 => 103
Hashing 44 => 104
Hashing 45 => 105
Hashing 46 => 106
Hashing 47 => 107
Hashing 48 => 108
Hashing 49 => 109
Hashing 50 => 101
Hashing 51 => 102
Hashing 52 => 103
Hashing 53 => 104
Hashing 54 => 105
Hashing 55 => 106
Hashing 56 => 107
Hashing 57 => 108
Hashing 58 => 109
Hashing 59 => 110
Hashing 60 => 102
Hashing 61 => 103
Hashing 62 => 104
Hashing 63 => 105
Hashing 64 => 106
Hashing 65 => 107
Hashing 66 => 108
Hashing 67 => 109
Hashing 68 => 110
Hashing 69 => 111
Hashing 70 => 103
Hashing 71 => 104
Hashing 72 => 105
Hashing 73 => 106
Hashing 74 => 107
Hashing 75 => 108
Hashing 76 => 109
Hashing 77 => 110
Hashing 78 => 111
Hashing 79 => 112
Hashing 80 => 104
Hashing 81 => 105
Hashing 82 => 106
Hashing 83 => 107
Hashing 84 => 108
Hashing 85 => 109
Hashing 86 => 110
Hashing 87 => 111
Hashing 88 => 112
Hashing 89 => 113
Hashing 90 => 105
Hashing 91 => 106
Hashing 92 => 107
Hashing 93 => 108
Hashing 94 => 109
Hashing 95 => 110
Hashing 96 => 111
Hashing 97 => 112
Hashing 98 => 113
Hashing 99 => 114
Hashing 100 => 145
Hashing 101 => 146
Hashing 102 => 147
Hashing 103 => 148
Hashing 104 => 149
Hashing 105 => 150
Hashing 106 => 151
Hashing 107 => 152
Hashing 108 => 153
Hashing 109 => 154
Hashing 110 => 146
Hashing 111 => 147
Hashing 112 => 148
Hashing 113 => 149
Hashing 114 => 150
Hashing 115 => 151
Hashing 116 => 152
Hashing 117 => 153
Hashing 118 => 154
Hashing 119 => 155
Hashing 120 => 147
Hashing 121 => 148
Hashing 122 => 149
Hashing 123 => 150
Hashing 124 => 151
Hashing 125 => 152
Hashing 126 => 153
Hashing 127 => 154
Hashing 128 => 155
Hashing 129 => 156
Hashing 130 => 148
Hashing 131 => 149
Hashing 132 => 150
Hashing 133 => 151
Hashing 134 => 152
Hashing 135 => 153
Hashing 136 => 154
Hashing 137 => 155
Hashing 138 => 156
Hashing 139 => 157
Hashing 140 => 149
Hashing 141 => 150
Hashing 142 => 151
Hashing 143 => 152
Hashing 144 => 153
Hashing 145 => 154
Hashing 146 => 155
Hashing 147 => 156
Hashing 148 => 157
Hashing 149 => 158
Hashing 150 => 150
Hashing 151 => 151
Hashing 152 => 152
Hashing 153 => 153
Hashing 154 => 154
Hashing 155 => 155
Hashing 156 => 156
Hashing 157 => 157
Hashing 158 => 158
Hashing 159 => 159
Hashing 160 => 151
Hashing 161 => 152
Hashing 162 => 153
Hashing 163 => 154
Hashing 164 => 155
Hashing 165 => 156
Hashing 166 => 157
Hashing 167 => 158
Hashing 168 => 159
Hashing 169 => 160
Hashing 170 => 152
Hashing 171 => 153
Hashing 172 => 154
Hashing 173 => 155
Hashing 174 => 156
Hashing 175 => 157
Hashing 176 => 158
Hashing 177 => 159
Hashing 178 => 160
Hashing 179 => 161
Hashing 180 => 153
Hashing 181 => 154
Hashing 182 => 155
Hashing 183 => 156
Hashing 184 => 157
Hashing 185 => 158
Hashing 186 => 159
Hashing 187 => 160
Hashing 188 => 161
Hashing 189 => 162
Hashing 190 => 154
Hashing 191 => 155
Hashing 192 => 156
Hashing 193 => 157
Hashing 194 => 158
Hashing 195 => 159
Hashing 196 => 160
Hashing 197 => 161
Hashing 198 => 162
Hashing 199 => 163
Hashing 200 => 146
Hashing 201 => 147
Hashing 202 => 148
Hashing 203 => 149
Hashing 204 => 150
Hashing 205 => 151
Hashing 206 => 152
Hashing 207 => 153
Hashing 208 => 154
Hashing 209 => 155
Hashing 210 => 147
Hashing 211 => 148
Hashing 212 => 149
Hashing 213 => 150
Hashing 214 => 151
Hashing 215 => 152
Hashing 216 => 153
Hashing 217 => 154
Hashing 218 => 155
Hashing 219 => 156
Hashing 220 => 148
Hashing 221 => 149
Hashing 222 => 150
Hashing 223 => 151
Hashing 224 => 152
Hashing 225 => 153
Hashing 226 => 154
Hashing 227 => 155
Hashing 228 => 156
Hashing 229 => 157
Hashing 230 => 149
Hashing 231 => 150
Hashing 232 => 151
Hashing 233 => 152
Hashing 234 => 153
Hashing 235 => 154
Hashing 236 => 155
Hashing 237 => 156
Hashing 238 => 157
Hashing 239 => 158
Hashing 240 => 150
Hashing 241 => 151
Hashing 242 => 152
Hashing 243 => 153
Hashing 244 => 154
Hashing 245 => 155
Hashing 246 => 156
Hashing 247 => 157
Hashing 248 => 158
Hashing 249 => 159
Hashing 250 => 151
Hashing 251 => 152
Hashing 252 => 153
Hashing 253 => 154
Hashing 254 => 155
Hashing 255 => 156 
```

注意数字更高的趋势。事实证明这是我们的死路一条。运行哈希 4 次（$hash = ourHash($hash)`，对于每个元素）最终给我们：

```
Hashing 0 => 153
Hashing 1 => 154
Hashing 2 => 155
Hashing 3 => 156
Hashing 4 => 157
Hashing 5 => 158
Hashing 6 => 150
Hashing 7 => 151
Hashing 8 => 152
Hashing 9 => 153
Hashing 10 => 157
Hashing 11 => 158
Hashing 12 => 150
Hashing 13 => 154
Hashing 14 => 155
Hashing 15 => 156
Hashing 16 => 157
Hashing 17 => 158
Hashing 18 => 150
Hashing 19 => 151
Hashing 20 => 158
Hashing 21 => 150
Hashing 22 => 154
Hashing 23 => 155
Hashing 24 => 156
Hashing 25 => 157
Hashing 26 => 158
Hashing 27 => 150
Hashing 28 => 151
Hashing 29 => 152
Hashing 30 => 150
Hashing 31 => 154
Hashing 32 => 155
Hashing 33 => 156
Hashing 34 => 157
Hashing 35 => 158
Hashing 36 => 150
Hashing 37 => 151
Hashing 38 => 152
Hashing 39 => 153
Hashing 40 => 154
Hashing 41 => 155
Hashing 42 => 156
Hashing 43 => 157
Hashing 44 => 158
Hashing 45 => 150
Hashing 46 => 151
Hashing 47 => 152
Hashing 48 => 153
Hashing 49 => 154
Hashing 50 => 155
Hashing 51 => 156
Hashing 52 => 157
Hashing 53 => 158
Hashing 54 => 150
Hashing 55 => 151
Hashing 56 => 152
Hashing 57 => 153
Hashing 58 => 154
Hashing 59 => 155
Hashing 60 => 156
Hashing 61 => 157
Hashing 62 => 158
Hashing 63 => 150
Hashing 64 => 151
Hashing 65 => 152
Hashing 66 => 153
Hashing 67 => 154
Hashing 68 => 155
Hashing 69 => 156
Hashing 70 => 157
Hashing 71 => 158
Hashing 72 => 150
Hashing 73 => 151
Hashing 74 => 152
Hashing 75 => 153
Hashing 76 => 154
Hashing 77 => 155
Hashing 78 => 156
Hashing 79 => 157
Hashing 80 => 158
Hashing 81 => 150
Hashing 82 => 151
Hashing 83 => 152
Hashing 84 => 153
Hashing 85 => 154
Hashing 86 => 155
Hashing 87 => 156
Hashing 88 => 157
Hashing 89 => 158
Hashing 90 => 150
Hashing 91 => 151
Hashing 92 => 152
Hashing 93 => 153
Hashing 94 => 154
Hashing 95 => 155
Hashing 96 => 156
Hashing 97 => 157
Hashing 98 => 158
Hashing 99 => 150
Hashing 100 => 154
Hashing 101 => 155
Hashing 102 => 156
Hashing 103 => 157
Hashing 104 => 158
Hashing 105 => 150
Hashing 106 => 151
Hashing 107 => 152
Hashing 108 => 153
Hashing 109 => 154
Hashing 110 => 155
Hashing 111 => 156
Hashing 112 => 157
Hashing 113 => 158
Hashing 114 => 150
Hashing 115 => 151
Hashing 116 => 152
Hashing 117 => 153
Hashing 118 => 154
Hashing 119 => 155
Hashing 120 => 156
Hashing 121 => 157
Hashing 122 => 158
Hashing 123 => 150
Hashing 124 => 151
Hashing 125 => 152
Hashing 126 => 153
Hashing 127 => 154
Hashing 128 => 155
Hashing 129 => 156
Hashing 130 => 157
Hashing 131 => 158
Hashing 132 => 150
Hashing 133 => 151
Hashing 134 => 152
Hashing 135 => 153
Hashing 136 => 154
Hashing 137 => 155
Hashing 138 => 156
Hashing 139 => 157
Hashing 140 => 158
Hashing 141 => 150
Hashing 142 => 151
Hashing 143 => 152
Hashing 144 => 153
Hashing 145 => 154
Hashing 146 => 155
Hashing 147 => 156
Hashing 148 => 157
Hashing 149 => 158
Hashing 150 => 150
Hashing 151 => 151
Hashing 152 => 152
Hashing 153 => 153
Hashing 154 => 154
Hashing 155 => 155
Hashing 156 => 156
Hashing 157 => 157
Hashing 158 => 158
Hashing 159 => 159
Hashing 160 => 151
Hashing 161 => 152
Hashing 162 => 153
Hashing 163 => 154
Hashing 164 => 155
Hashing 165 => 156
Hashing 166 => 157
Hashing 167 => 158
Hashing 168 => 159
Hashing 169 => 151
Hashing 170 => 152
Hashing 171 => 153
Hashing 172 => 154
Hashing 173 => 155
Hashing 174 => 156
Hashing 175 => 157
Hashing 176 => 158
Hashing 177 => 159
Hashing 178 => 151
Hashing 179 => 152
Hashing 180 => 153
Hashing 181 => 154
Hashing 182 => 155
Hashing 183 => 156
Hashing 184 => 157
Hashing 185 => 158
Hashing 186 => 159
Hashing 187 => 151
Hashing 188 => 152
Hashing 189 => 153
Hashing 190 => 154
Hashing 191 => 155
Hashing 192 => 156
Hashing 193 => 157
Hashing 194 => 158
Hashing 195 => 159
Hashing 196 => 151
Hashing 197 => 152
Hashing 198 => 153
Hashing 199 => 154
Hashing 200 => 155
Hashing 201 => 156
Hashing 202 => 157
Hashing 203 => 158
Hashing 204 => 150
Hashing 205 => 151
Hashing 206 => 152
Hashing 207 => 153
Hashing 208 => 154
Hashing 209 => 155
Hashing 210 => 156
Hashing 211 => 157
Hashing 212 => 158
Hashing 213 => 150
Hashing 214 => 151
Hashing 215 => 152
Hashing 216 => 153
Hashing 217 => 154
Hashing 218 => 155
Hashing 219 => 156
Hashing 220 => 157
Hashing 221 => 158
Hashing 222 => 150
Hashing 223 => 151
Hashing 224 => 152
Hashing 225 => 153
Hashing 226 => 154
Hashing 227 => 155
Hashing 228 => 156
Hashing 229 => 157
Hashing 230 => 158
Hashing 231 => 150
Hashing 232 => 151
Hashing 233 => 152
Hashing 234 => 153
Hashing 235 => 154
Hashing 236 => 155
Hashing 237 => 156
Hashing 238 => 157
Hashing 239 => 158
Hashing 240 => 150
Hashing 241 => 151
Hashing 242 => 152
Hashing 243 => 153
Hashing 244 => 154
Hashing 245 => 155
Hashing 246 => 156
Hashing 247 => 157
Hashing 248 => 158
Hashing 249 => 159
Hashing 250 => 151
Hashing 251 => 152
Hashing 252 => 153
Hashing 253 => 154
Hashing 254 => 155
Hashing 255 => 156 
```

我们已经将自己缩小到 8 个值......这很**糟糕**......我们的原始函数映射`S(∞)`到`S(256)`. 也就是说，我们创建了一个[映射](http://en.wikipedia.org/wiki/Surjection)`$input`到`$output`.

由于我们有一个满射函数，我们不能保证任何输入子集的映射都不会发生冲突（实际上，实际上它们会发生冲突）。

这就是这里发生的事情！我们的功能很糟糕，但这不是它起作用的原因（这就是它工作得如此迅速和如此完整的原因）。

同样的事情发生在`MD5`. 它映射`S(∞)`到`S(2^128)`. 由于无法保证 running`MD5(S(output))`将是[Injective](http://en.wikipedia.org/wiki/Injective_function)，这意味着它不会发生冲突。

## TL/DR 部分

因此，由于`md5`直接将输出反馈回会产生碰撞，因此每次迭代都会增加碰撞的机会。然而，这是一个线性增加，这意味着虽然结果集`2^128`减少了，但它并没有显着减少到足以成为关键缺陷的速度。

所以，

```
$output = md5($input); // 2^128 possibilities
$output = md5($output); // < 2^128 possibilities
$output = md5($output); // < 2^128 possibilities
$output = md5($output); // < 2^128 possibilities
$output = md5($output); // < 2^128 possibilities 
```

你迭代的次数越多，减少的越多。

# 修复

对我们来说幸运的是，有一个*简单的方法可以解决这个问题：将**一些东西*反馈到进一步的迭代中：

```
$output = md5($input); // 2^128 possibilities
$output = md5($input . $output); // 2^128 possibilities
$output = md5($input . $output); // 2^128 possibilities
$output = md5($input . $output); // 2^128 possibilities
$output = md5($input . $output); // 2^128 possibilities 
```

请注意，对于每个单独的值，进一步的迭代不是 2^128 `$input`。这意味着我们可能能够生成`$input`仍然沿线碰撞的值（因此将在远低于`2^128`可能输出的情况下稳定或产生共鸣）。但是一般情况下`$input`仍然与单轮一样强大。

等等，是吗？`ourHash()`让我们用我们的函数来测试一下。切换到`$hash = ourHash($input . $hash);`, 进行 100 次迭代：

```
Hashing 0 => 201
Hashing 1 => 212
Hashing 2 => 199
Hashing 3 => 201
Hashing 4 => 203
Hashing 5 => 205
Hashing 6 => 207
Hashing 7 => 209
Hashing 8 => 211
Hashing 9 => 204
Hashing 10 => 251
Hashing 11 => 147
Hashing 12 => 251
Hashing 13 => 148
Hashing 14 => 253
Hashing 15 => 0
Hashing 16 => 1
Hashing 17 => 2
Hashing 18 => 161
Hashing 19 => 163
Hashing 20 => 147
Hashing 21 => 251
Hashing 22 => 148
Hashing 23 => 253
Hashing 24 => 0
Hashing 25 => 1
Hashing 26 => 2
Hashing 27 => 161
Hashing 28 => 163
Hashing 29 => 8
Hashing 30 => 251
Hashing 31 => 148
Hashing 32 => 253
Hashing 33 => 0
Hashing 34 => 1
Hashing 35 => 2
Hashing 36 => 161
Hashing 37 => 163
Hashing 38 => 8
Hashing 39 => 4
Hashing 40 => 148
Hashing 41 => 253
Hashing 42 => 0
Hashing 43 => 1
Hashing 44 => 2
Hashing 45 => 161
Hashing 46 => 163
Hashing 47 => 8
Hashing 48 => 4
Hashing 49 => 9
Hashing 50 => 253
Hashing 51 => 0
Hashing 52 => 1
Hashing 53 => 2
Hashing 54 => 161
Hashing 55 => 163
Hashing 56 => 8
Hashing 57 => 4
Hashing 58 => 9
Hashing 59 => 11
Hashing 60 => 0
Hashing 61 => 1
Hashing 62 => 2
Hashing 63 => 161
Hashing 64 => 163
Hashing 65 => 8
Hashing 66 => 4
Hashing 67 => 9
Hashing 68 => 11
Hashing 69 => 4
Hashing 70 => 1
Hashing 71 => 2
Hashing 72 => 161
Hashing 73 => 163
Hashing 74 => 8
Hashing 75 => 4
Hashing 76 => 9
Hashing 77 => 11
Hashing 78 => 4
Hashing 79 => 3
Hashing 80 => 2
Hashing 81 => 161
Hashing 82 => 163
Hashing 83 => 8
Hashing 84 => 4
Hashing 85 => 9
Hashing 86 => 11
Hashing 87 => 4
Hashing 88 => 3
Hashing 89 => 17
Hashing 90 => 161
Hashing 91 => 163
Hashing 92 => 8
Hashing 93 => 4
Hashing 94 => 9
Hashing 95 => 11
Hashing 96 => 4
Hashing 97 => 3
Hashing 98 => 17
Hashing 99 => 13
Hashing 100 => 246
Hashing 101 => 248
Hashing 102 => 49
Hashing 103 => 44
Hashing 104 => 255
Hashing 105 => 198
Hashing 106 => 43
Hashing 107 => 51
Hashing 108 => 202
Hashing 109 => 2
Hashing 110 => 248
Hashing 111 => 49
Hashing 112 => 44
Hashing 113 => 255
Hashing 114 => 198
Hashing 115 => 43
Hashing 116 => 51
Hashing 117 => 202
Hashing 118 => 2
Hashing 119 => 51
Hashing 120 => 49
Hashing 121 => 44
Hashing 122 => 255
Hashing 123 => 198
Hashing 124 => 43
Hashing 125 => 51
Hashing 126 => 202
Hashing 127 => 2
Hashing 128 => 51
Hashing 129 => 53
Hashing 130 => 44
Hashing 131 => 255
Hashing 132 => 198
Hashing 133 => 43
Hashing 134 => 51
Hashing 135 => 202
Hashing 136 => 2
Hashing 137 => 51
Hashing 138 => 53
Hashing 139 => 55
Hashing 140 => 255
Hashing 141 => 198
Hashing 142 => 43
Hashing 143 => 51
Hashing 144 => 202
Hashing 145 => 2
Hashing 146 => 51
Hashing 147 => 53
Hashing 148 => 55
Hashing 149 => 58
Hashing 150 => 198
Hashing 151 => 43
Hashing 152 => 51
Hashing 153 => 202
Hashing 154 => 2
Hashing 155 => 51
Hashing 156 => 53
Hashing 157 => 55
Hashing 158 => 58
Hashing 159 => 0
Hashing 160 => 43
Hashing 161 => 51
Hashing 162 => 202
Hashing 163 => 2
Hashing 164 => 51
Hashing 165 => 53
Hashing 166 => 55
Hashing 167 => 58
Hashing 168 => 0
Hashing 169 => 209
Hashing 170 => 51
Hashing 171 => 202
Hashing 172 => 2
Hashing 173 => 51
Hashing 174 => 53
Hashing 175 => 55
Hashing 176 => 58
Hashing 177 => 0
Hashing 178 => 209
Hashing 179 => 216
Hashing 180 => 202
Hashing 181 => 2
Hashing 182 => 51
Hashing 183 => 53
Hashing 184 => 55
Hashing 185 => 58
Hashing 186 => 0
Hashing 187 => 209
Hashing 188 => 216
Hashing 189 => 219
Hashing 190 => 2
Hashing 191 => 51
Hashing 192 => 53
Hashing 193 => 55
Hashing 194 => 58
Hashing 195 => 0
Hashing 196 => 209
Hashing 197 => 216
Hashing 198 => 219
Hashing 199 => 220
Hashing 200 => 248
Hashing 201 => 49
Hashing 202 => 44
Hashing 203 => 255
Hashing 204 => 198
Hashing 205 => 43
Hashing 206 => 51
Hashing 207 => 202
Hashing 208 => 2
Hashing 209 => 51
Hashing 210 => 49
Hashing 211 => 44
Hashing 212 => 255
Hashing 213 => 198
Hashing 214 => 43
Hashing 215 => 51
Hashing 216 => 202
Hashing 217 => 2
Hashing 218 => 51
Hashing 219 => 53
Hashing 220 => 44
Hashing 221 => 255
Hashing 222 => 198
Hashing 223 => 43
Hashing 224 => 51
Hashing 225 => 202
Hashing 226 => 2
Hashing 227 => 51
Hashing 228 => 53
Hashing 229 => 55
Hashing 230 => 255
Hashing 231 => 198
Hashing 232 => 43
Hashing 233 => 51
Hashing 234 => 202
Hashing 235 => 2
Hashing 236 => 51
Hashing 237 => 53
Hashing 238 => 55
Hashing 239 => 58
Hashing 240 => 198
Hashing 241 => 43
Hashing 242 => 51
Hashing 243 => 202
Hashing 244 => 2
Hashing 245 => 51
Hashing 246 => 53
Hashing 247 => 55
Hashing 248 => 58
Hashing 249 => 0
Hashing 250 => 43
Hashing 251 => 51
Hashing 252 => 202
Hashing 253 => 2
Hashing 254 => 51
Hashing 255 => 53 
```

那里仍然有一个粗略的模式，但请注意，它*只不过*是我们的底层函数（已经很弱）的模式。

但是请注意`0`，`3`即使它们不在单次运行中，也会发生碰撞。这是我之前所说的应用（碰撞阻力对于所有输入的集合保持相同，但由于基础算法中的缺陷可能会打开特定的碰撞路线）。

## TL/DR 部分

通过将输入反馈到每次迭代中，我们有效地打破了之前迭代中可能发生的任何冲突。

因此，`md5($input . md5($input));`应该（至少在*理论上*`md5($input)`）与.

# 这重要吗？

是的。这是 PBKDF2 在[RFC 2898](https://www.rfc-editor.org/rfc/rfc2898#section-5.1)中替换 PBKDF1 的原因之一。考虑两者的内部循环::

PBKDF1：

```
T_1 = Hash (P || S) ,
T_2 = Hash (T_1) ,
...
T_c = Hash (T_{c-1}) 
```

`c`迭代计数在哪里，`P`密码在哪里，`S`盐在哪里

PBKDF2：

```
U_1 = PRF (P, S || INT (i)) ,
U_2 = PRF (P, U_1) ,
...
U_c = PRF (P, U_{c-1}) 
```

PRF 实际上只是一个 HMAC。但是为了我们的目的，我们只是说`PRF(P, S) = Hash(P || S)`（也就是说，2 个输入的 PRF 大致相同，就像两个连接在一起的哈希一样）。它**不是**，但就我们的目的而言，它是。

所以 PBKDF2 保持了底层`Hash`函数的抗碰撞性，而 PBKDF1 没有。

# 将所有这些捆绑在一起：

我们知道迭代哈希的安全方法。实际上：

```
$hash = $input;
$i = 10000;
do {
   $hash = hash($input . $hash);
} while ($i-- > 0); 
```

通常是安全的。

现在，要了解我们**为什么**要散列它，让我们分析熵运动。

哈希接受无限集合：`S(∞)`并产生一个更小、大小一致的集合`S(n)`。下一次迭代（假设输入被传回）再次映射`S(∞)`到`S(n)`：

```
S(∞) -> S(n)
S(∞) -> S(n)
S(∞) -> S(n)
S(∞) -> S(n)
S(∞) -> S(n)
S(∞) -> S(n) 
```

请注意，最终输出**的熵与第一个输出完全相同**。迭代**不会**“使它更加模糊”。熵是相同的。没有不可预测性的神奇来源（它是伪随机函数，而不是随机函数）。

然而，迭代是有好处的。它人为地使散列过程变慢。这就是为什么迭代可能是一个好主意。事实上，这是大多数现代密码散列算法的基本原理（反复做某事会使其变慢的事实）。

慢是好的，因为它正在对抗主要的安全威胁：暴力破解。我们的哈希算法越慢，攻击者就越难攻击从我们那里窃取的密码哈希。这是一件好事！

* * *

## 回答 #3

> 赞同：53
> 
> 时间：2008-12-07T23:49:15.017

是的，重新散列减少了搜索空间，但不，没关系 - 有效的减少是微不足道的。

重新散列增加了蛮力所需的时间，但只这样做两次也是次优的。

您真正想要的是使用[PBKDF2](https://www.rfc-editor.org/rfc/rfc2898#section-5.2)对密码进行哈希处理——这是一种使用带有盐和迭代的安全哈希的经过验证的方法。看看[这个 SO 响应](https://stackoverflow.com/questions/287517/encryptinghashing-plain-text-passwords-in-database#287883)。

**编辑**：我差点忘了——**不要使用 MD5 ！！！**使用现代加密哈希，例如 SHA-2 系列（SHA-256、SHA-384 和 SHA-512）。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-12-07T21:33:12.917

是的 - 它减少了与字符串匹配的可能字符串的数量。

正如您已经提到的，加盐哈希要好得多。

这里有一篇文章：[http](http://websecurity.ro/blog/2007/11/02/md5md5-vs-md5/) ://websecurity.ro/blog/2007/11/02/md5md5-vs-md5/ ，试图证明它为什么是等价的，但我不确定逻辑。他们部分假设没有可用于分析 md5(md5(text)) 的软件，但显然生成彩虹表相当简单。

我仍然坚持我的答案，即 md5(md5(text)) 类型的散列比 md5(text) 散列的数量少，从而增加了冲突的机会（即使仍然不太可能发生）并减少了搜索空间。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-08-31T13:38:44.237

大多数答案是由没有密码学或安全背景的人提供的。他们错了。使用盐，如果可能的话，每条记录都是唯一的。MD5/SHA/etc 太快了，与你想要的相反。PBKDF2 和 bcrypt 速度较慢（这很好），但可以用 ASIC/FPGA/GPU 击败（现在非常实惠）。所以需要一个内存硬算法：[输入 scrypt](http://www.tarsnap.com/scrypt/scrypt.pdf)。

这是关于盐和速度的[外行解释](http://chargen.matasano.com/chargen/2007/9/7/enough-with-the-rainbow-tables-what-you-need-to-know-about-s.html)（但不是关于内存硬算法）。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-09-05T07:31:30.647

我只是从实际的角度来看这个。黑客的目的是什么？为什么，通过散列函数生成所需散列的字符组合。

您只保存最后一个哈希，因此，黑客只需暴力破解一个哈希。假设您在每个蛮力步骤中遇到所需散列的几率大致相同，则散列的数量无关紧要。您可以进行一百万次哈希迭代，它不会增加或降低安全性，因为在行尾仍然只有一个哈希要破坏，并且破坏它的几率与任何哈希相同。

也许之前的发帖人认为输入是相关的；它不是。只要您放入散列函数中的任何内容都会生成所需的散列，它就会让您通过，正确的输入或不正确的输入。

现在，彩虹桌是另一回事。由于彩虹表只携带原始密码，因此两次散列可能是一种很好的安全措施，因为包含每个散列的每个散列的彩虹表会太大。

当然，我只考虑 OP 给出的例子，它只是一个被散列的纯文本密码。如果您在哈希中包含用户名或盐，那就是另一回事了；两次散列是完全没有必要的，因为彩虹表已经太大而不能实用并且包含正确的散列。

无论如何，这里不是安全专家，但这正是我从我的经验中得出的结论。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-07T21:41:42.590

通常，它不会为双重哈希或双重加密提供额外的安全性。如果您可以破坏一次哈希，则可以再次破坏它。不过，这样做通常不会损害安全性。

在您使用 MD5 的示例中，您可能知道存在一些冲突问题。“双重哈希”并不能真正帮助防止这种情况，因为相同的冲突仍然会导致相同的第一个哈希，然后您可以再次 MD5 以获得第二个哈希。

这确实可以防止字典攻击，例如那些“反向 MD5 数据库”，但盐渍也是如此。

切线，双重加密不会提供任何额外的安全性，因为它所做的只是产生一个不同的密钥，它是实际使用的两个密钥的组合。所以寻找“钥匙”的努力并没有加倍，因为实际上不需要找到两个钥匙。这不适用于散列，因为散列的结果通常与原始输入的长度不同。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-12-07T21:46:19.553

根据我的阅读，实际上可能建议重新散列密码数百或数千次。

这个想法是，如果您可以花费更多时间来对密码进行编码，那么对于攻击者来说，通过多次猜测来破解密码的工作量会更大。这似乎是重新散列的优势——并不是说它在密码学上更安全，而是生成字典攻击只需要更长的时间。

当然，计算机一直在变得更快，因此这种优势会随着时间的推移而减弱（或需要您增加迭代次数）。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-07T21:54:01.877

就我个人而言，我不会为多个散列而烦恼，但我会确保**同时散列用户名（或另一个用户 ID 字段）以及密码**，这样两个具有相同密码的用户就不会以相同的散列结束。此外，我可能还会将一些其他常量字符串也放入输入字符串中以进行良好的测量。

```
$hashed_password = md5( "xxx" + "|" + user_name + "|" + plaintext_password); 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-06-04T13:41:16.313

让我们假设您使用散列算法：计算 rot13，取前 10 个字符。如果您这样做两次（甚至 2000 次），则可以创建一个更快的函数，但给出相同的结果（即只取前 10 个字符）。

同样，可以制作一个更快的函数，它提供与重复散列函数相同的输出。因此，您选择的散列函数非常重要：与 rot13 示例一样，重复散列不会提高安全性。如果没有研究表明该算法是为递归使用而设计的，那么假设它不会为您提供额外的保护会更安全。

也就是说：对于除了最简单的散列函数之外的所有散列函数，它很可能需要密码学专家来计算更快的函数，因此，如果您要防范无法访问密码学专家的攻击者，那么在实践中使用重复散列函数可能更安全.

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2012-09-04T11:50:01.290

仅当我在客户端对密码进行哈希处理，然后将该哈希的哈希值（使用不同的盐）保存在服务器上时，双重哈希对我才有意义。

这样，即使有人侵入了服务器（从而忽略了 SSL 提供的安全性），他仍然无法获得清晰的密码。

是的，他将拥有入侵系统所需的数据，但他无法使用这些数据来破坏用户拥有的外部帐户。众所周知，人们几乎对任何事情都使用相同的密码。

他可以得到清晰密码的唯一方法是在客户端上安装一个注册机——这不再是你的问题了。

简而言之：

1.  客户端上的第一个散列可以在“服务器违规”情况下保护您的用户。
2.  如果有人持有您的数据库备份，则服务器上的第二个哈希用于保护您的系统，因此他无法使用这些密码连接到您的服务。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-07T21:56:21.903

减少搜索空间的担忧在数学上是正确的，尽管搜索空间仍然足够大，对于所有实际目的（假设您使用盐），为 2^128。然而，由于我们谈论的是密码，根据我粗略的计算，可能的 16 个字符的字符串（字母数字、大写字母、一些符号）的数量大约是 2^98。因此，搜索空间的感知减少并不真正相关。

除此之外，从密码学上讲，确实没有区别。

尽管有一种称为“哈希链”的加密原语——一种允许你做一些很酷的技巧的技术，比如在使用后公开签名密钥，而不牺牲系统的完整性——给定最小的时间同步，这允许您干净地回避初始密钥分配的问题。基本上，您预先计算大量哈希值 - h(h(h(h....(h(k))...))) ，使用第 n 个值进行签名，在设定的时间间隔后，您发送取出密钥，并使用密钥 (n-1) 对其进行签名。收件人现在可以验证您是否发送了所有以前的消息，并且没有人可以伪造您的签名，因为它的有效时间已经过去。

像比尔建议的那样重新散列数十万次只是浪费你的 CPU。如果你担心人们会破坏 128 位，请使用更长的密钥。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-08T01:06:09.697

正如本文中的一些回复所暗示的那样，在某些情况下它可能会提高安全性，而在其他情况下它肯定会伤害它。有一个更好的解决方案肯定会提高安全性。不是将计算哈希的次数加倍，而是将盐的大小加倍，或者将哈希中使用的位数加倍，或者两者都做！代替 SHA-245，跳到 SHA-512。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2008-12-07T21:38:49.910

我要冒昧地说在某些情况下它更安全……不过，请不要对我投反对票！

从数学/密码学的角度来看，它不太安全，因为我相信其他人会给你比我更清楚的解释。

**但是**，存在 MD5 哈希的大型数据库，这些数据库比它的 MD5 更有可能包含“密码”文本。因此，通过双重哈希，您正在降低这些数据库的有效性。

当然，如果你使用盐，那么这个优势（劣势？）就会消失。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2008-12-08T00:54:39.767

双散列很丑陋，因为攻击者很可能已经建立了一个表来提供大多数散列。更好的办法是给你的哈希加盐，然后把哈希混合在一起。还有新的模式来“签名”哈希（基本上是盐渍），但以更安全的方式。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2012-08-31T18:23:53.577

## 是的。

绝对**不要**使用传统哈希函数的多次迭代，例如`md5(md5(md5(password)))`. *最好*的情况是安全性略有提高（这样的方案几乎不能提供任何针对 GPU 攻击的保护；只需将其流水线化即可。）在最坏的情况下，每次添加的迭代都会减少哈希空间（从而减少安全性）. 在安全方面，明智的做法是假设最坏的情况。

**请务必**使用由称职的密码学家*设计*的密码，该密码是有效的密码哈希，并且可以抵抗蛮力和时空攻击。这些包括 bcrypt、scrypt，在某些情况下还包括 PBKDF2。glibc 基于 SHA-256 的散列也是可以接受的。

# c# - 在 C# 中杀死远程机器上的进程

> ID：348112
> 
> 赞同：2
> 
> 时间：2008-12-07T21:31:35.823
> 
> 标签：c#, .net, process, kill

[这只](https://stackoverflow.com/questions/116090/how-do-i-kill-a-process-using-vbnet-or-c)有助于杀死本地机器上的进程。如何杀死远程机器上的进程？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-07T21:37:39.930

您可以使用[wmi](http://www.microsoft.com/technet/scriptcenter/resources/qanda/sept04/hey0927.mspx)。或者，如果您不介意使用外部可执行文件，请使用[pskill](http://technet.microsoft.com/en-us/sysinternals/bb896683.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2014-08-19T18:41:29.477

我喜欢这个（类似于 Mubashar 的回答）：

```
ManagementScope managementScope = new ManagementScope("\\\\servername\\root\\cimv2");
managementScope.Connect();
ObjectQuery objectQuery = new ObjectQuery("SELECT * FROM Win32_Process Where Name = 'processname'");
ManagementObjectSearcher managementObjectSearcher = new ManagementObjectSearcher(managementScope, objectQuery);
ManagementObjectCollection managementObjectCollection = managementObjectSearcher.Get();
foreach (ManagementObject managementObject in managementObjectCollection)
{
    managementObject.InvokeMethod("Terminate", null);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-11-26T04:58:39.300

我使用以下代码。psKill 也是一个不错的方法，但有时您需要检查其他一些东西，例如在我的情况下，远程计算机正在运行同一进程的多个实例但具有不同的命令行参数，因此以下代码对我有用。

```
ConnectionOptions connectoptions = new ConnectionOptions();
connectoptions.Username = string.Format(@"carpark\{0}", "domainOrWorkspace\RemoteUsername");
connectoptions.Password = "remoteComputersPasssword";

ManagementScope scope = new ManagementScope(@"\\" + ipAddress + @"\root\cimv2");
scope.Options = connectoptions;

SelectQuery query = new SelectQuery("select * from Win32_Process where name = 'MYPROCESS.EXE'");

using (ManagementObjectSearcher searcher = new ManagementObjectSearcher(scope, query))
{
       ManagementObjectCollection collection = searcher.Get();

       if (collection.Count > 0)
       {
           foreach (ManagementObject mo in collection)
           {
                uint processId = (uint)mo["ProcessId"];
                string commandLine = (string) mo["CommandLine"];

                string expectedCommandLine = string.Format("MYPROCESS.EXE {0} {1}", deviceId, deviceType);

                if (commandLine != null && commandLine.ToUpper() == expectedCommandLine.ToUpper())
                {
                     mo.InvokeMethod("Terminate", null);
                     break;
                }
            }
       }
} 
```

# eclipse - 如何检测 Eclipse 构建是否失败？

> ID：348118
> 
> 赞同：2
> 
> 时间：2008-12-07T21:35:07.610
> 
> 标签：eclipse, ant, build-automation

继[这个问题](https://stackoverflow.com/questions/347698/how-do-i-automatically-export-a-war-after-java-build-in-eclipse)之后，我现在想知道如果前面的构建失败，如何停止执行 ANT 脚本。在 Eclipse 的构建设置中，我看不到根据它们的成功将构建链接在一起的方法。

我想我正在寻找一种将以前的构建状态传递到我的 ANT 脚本中的方法，这样我就可以终止或在第一次构建失败时根本不调用 ANT 脚本。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T22:40:14.233

没有本地方式，AFAIK。您可以做的是修改您的 ant 脚本以检查 Eclipse 生成的 .class 文件是否比 WAR 更新。如果没有，请停止。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T22:18:34.230

您应该能够将成功存储到文件中。如果您确定文件的内容是属性文件内容，则下一个 ant 任务可以使用该文件来填充属性（如 build.success）并对其进行操作。

# java - 在 JDBC 中轮询数据库时重用连接？

> ID：348120
> 
> 赞同：1
> 
> 时间：2008-12-07T21:37:04.423
> 
> 标签：java

有一个用例，其中需要维护打开数据库的连接以定期执行查询。

是否建议在执行查询后关闭连接，然后在一段时间间隔（10 分钟）后重新打开它。我猜不会，因为打开与数据库的连接很昂贵。

连接池是替代方案并继续使用连接吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-07T21:46:30.690

您应该使用连接池。编写您的应用程序代码以从池中请求连接，使用该连接，然后将该连接返回到池中。这使您的代码保持干净。然后，您依靠池实现来确定管理连接的最有效方式（例如，保持它们打开还是关闭它们）。

通常打开连接是“昂贵的”，通常是由于建立 TCP/IP 连接、身份验证等的开销。但是，保持连接打开“太久”也可能很昂贵，因为数据库 (可能）已保留资源（如内存）供连接使用。因此，保持连接打开可以占用这些资源。

您不想污染管理这些类型的效率权衡的应用程序代码，因此请使用连接池。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-07T21:43:07.873

是的，连接池是另一种选择。每次都打开连接（就您的代码而言）并尽快关闭它。连接池将以适当有效的方式处理物理连接（包括所需的任何保活、偶尔的“活跃度”测试等）。

我不知道当前最先进的技术是什么，但我在最后一个涉及 JDBC 的 Java 项目中非常成功地使用了[c3p0](http://sourceforge.net/projects/c3p0)（很久以前）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-08T15:17:29.760

这里的答案实际上取决于应用程序。如果同一应用程序中的同一数据库同时使用其他连接，那么池绝对是您的答案。

如果您的应用程序所做的只是查询数据库，请等待 10 分钟，然后再次查询，然后只需连接并重新连接。连接被认为是一项昂贵的操作，但所有事情都是相对的。如果你每 10 分钟只做一次，它并不昂贵。如果应用程序如此简单，请不要引入不必要的复杂性。

注意：好的，复杂性也是相对的，所以如果已经在使用像 Spring 这样的东西并且已经知道如何使用它的池机制，那么将它应用于这种情况。如果这不是真的，请保持简单。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-07T21:47:06.667

连接池将是您的一个选择。然后，您可以保留您的代码，包括打开和关闭连接。连接池将关心连接。如果您关闭池的连接，它将不会被关闭，而只是再次在池中可用。如果您在关闭一个连接后打开一个连接，如果池中有一个打开的连接，则池将返回此连接。因此，在应用程序服务器中，您可以使用内置连接池。对于简单的 java 应用程序，大多数 JDBC 驱动程序还包括一个池驱动程序。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T22:46:43.767

在打开和关闭连接、保持它们打开、确保已经“保持活动”的连接在您再次开始使用它们时仍然“有效”、使损坏的连接失效等方面有很多权衡。这些类型复杂的权衡使得为您的特定情况实施“最佳”连接管理策略变得困难（但肯定不是不可能）。“最安全”的方法是打开一个连接，使用它，然后关闭它。但是，正如您已经意识到的那样，这根本不是最有效的方法。如果您管理自己的连接，那么当您做一些事情以使您的策略更有效时，复杂性将迅速增加（特别是在存在任何不完美的 JDBC 驱动程序的情况下，其中有很多。）

有许多可用的连接池库可以以极其可配置的方式为您处理所有这些问题（对于最典型的情况，它们几乎总是预先配置好，直到您开始使用如果您正在执行高负载活动，您可能不必担心所有可配置性 - 但如果您扩大规模，您会很高兴拥有它！）与往常一样，库本身可能是质量参差不齐。

我已经成功地使用了[C3P0](http://sourceforge.net/projects/c3p0)和[Apache DBCP](http://commons.apache.org/dbcp/)。如果我今天再次选择，我可能会选择 DBCP。

# visual-studio - 如何暂时停用所有 try / catch 块？

> ID：348122
> 
> 赞同：27
> 
> 时间：2008-12-07T21:37:50.257
> 
> 标签：visual-studio

是否有可能像单击按钮一样简单地停用/激活整个项目中的所有 try catch 块？

当我不希望 catch 块处理异常时，我需要它来进行调试，而是更喜欢 VS 像 try catch 块不存在一样中断代码。

目前我正在注释掉 try/catch 块，但这是低效的。

环境：VS 2008，以 C# 为语言。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-12-07T21:45:39.633

要在抛出异常的那一刻捕获异常（Win32 用语中的“第一次机会异常”）：

*   在 VS2008 中：转到**Debug**，**Exceptions ...**

*   VS2015：这已移至**Debug > Windows > Exception Settings**

然后选中**Thrown** for **Common Language Runtime Exceptions**框。

[![在此处输入图像描述](https://i.stack.imgur.com/dj5kV.png)](https://i.stack.imgur.com/dj5kV.png)

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-12-07T21:42:03.040

无法停用 try/catch 块。

但是，出于调试目的，如果您想在抛出特定类型的异常后立即中断，您可以让 Visual Studio 执行此操作（调试 -> 异常；选择您感兴趣的异常类型并检查“抛出“ 盒子）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2018-01-03T21:42:52.490

今天想了想，找到了另一个解决方案。这样做的好处是 IDE 将在发生异常的确切点停止。

全球定义的某个地方：

```
Namespace Global.System
  Public Class NeverOccurException
    Inherits Exception
  End Class
End Namespace 
```

在每个源代码文件的开头：

```
#If DEBUG
  Imports CatchAtReleaseException = System.NeverOccurException
#Else
  Imports CatchAtReleaseException = System.Exception
#End If 
```

用法：

```
 'Compiled in DEBUG-Mode the TryCatch is "disabled", because the
  'the ALIAS CatchAtReleaseException is set to "NeverOccurException"

  'Compiled as RELEASE the TryCatch is "enabled", because the ALIAS
  'is set to the regular "System.Exception"

  Public Sub SampleSub()
    Try
      '...
    Catch ex As CatchAtReleaseException
    End Try
  End Sub 
```

玩得开心，问候，特德

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-07T21:44:26.373

如果您想在 IDE 中执行，Debug -> Exceptions 是一个对话框，您可以在其中要求 IDE 在引发特定/类别/所有异常时中断。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-07T21:45:56.777

您可以更改发生异常时 Visual Studio 中断的方式。默认情况下，它会在未处理的异常上中断。如果您转到菜单 Debug > Exceptions，您可以取消选中 Common Language Runtime Exceptions 并在发生异常时对 IDE 的行为进行其他更改。例如，你可以让它只在一种异常上中断；那里有一个很长的清单。

我在尝试调试时很少这样做。

# javascript - 如何比较 Javascript 中的日期？

> ID：348127
> 
> 赞同：3
> 
> 时间：2008-12-07T21:40:29.610
> 
> 标签：javascript, date

我有以下情况：

我有一个运行循环并执行某些操作的函数，错误条件可能会使其退出该循环。我希望能够检查循环是否仍在运行。

为此，我正在为每个循环运行：

```
LastTimeIDidTheLoop = new Date(); 
```

在另一个每隔 30 秒运行一次 SetInterval 的函数中，我基本上想这样做：

```
if (LastTimeIDidTheLoop is more than 30 seconds ago) {
  alert("oops");
} 
```

我该怎么做呢？

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-07T21:57:59.903

JS 日期对象在内部存储毫秒，彼此相减按预期工作：

```
var diffSeconds = (new Date() - LastTimeIDidTheLoop) / 1000; 
if (diffSeconds > 30)
{
  // ...
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-07T21:42:43.197

关于什么：

```
newDate = new Date()
newDate.setSeconds(newDate.getSeconds()-30);
if (newDate > LastTimeIDidTheLoop) {
  alert("oops");
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-06-22T16:52:41.883

你可以这样做：

```
var dateDiff = function(fromdate, todate) {
    var diff = todate - fromdate;
    return Math.floor(diff/1000);
} 
```

然后：

```
if (dateDiff(fromdate, todate) > 30){
    alert("oops");
} 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-12-07T21:56:49.640

创建一个日期对象并使用 setSeconds()。

```
controlDate = new Date();
controlDate.setSeconds(controlDate.getSeconds() + 30);

if (LastTimeIDidTheLoop > controlDate) {
... 
```

# validation - 我应该如何验证和管理登录命名空间？

> ID：348128
> 
> 赞同：2
> 
> 时间：2008-12-07T21:41:19.533
> 
> 标签：validation, security, namespaces

这很愚蠢，但我还没有找到这个信息。如果您有概念名称和合适的参考资料，请告诉我。

我想了解我应该如何验证通用实体的给定命名 ID，例如电子邮件登录，就像雅虎、谷歌和微软一样。

我的意思是...如果您确实有一个名为 foo 的用户，那么尝试创建 foo2 将被拒绝，因为这很可能是有人试图通过使用虚假 id 来误导用户。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T16:31:21.450

你将不得不采取两次通过的方法。

第一个是潜在的 RegEx 表达式，用于验证实体名称是否尽可能符合您的规范。例如，不允许某些字符。

第二个是在名称创建期间执行某种类型的模糊搜索。这可以像 LIKE '%value%' where 子句一样简单，也可以像使用某种类型的全文搜索并将命中限制在某个相关性等级一样复杂。

也就是说，我猜失败率（误报和误报）匹配将足够高以证明不这样做是合理的。

祝你好运。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T17:52:45.017

想到：

*   莱文斯坦距离
*   汉明距离

# java - 在（Java Developer）面试之前你应该学习哪些常识？

> ID：348143
> 
> 赞同：2
> 
> 时间：2008-12-07T21:45:23.050
> 
> 标签：java

您正在申请“Java 开发人员”的职位，并被要求参加面试。在您坐在面板前之前，您应该/必须学习哪些一般知识？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-07T22:13:09.827

我会阅读[Sun Certified Java Programmer](https://rads.stackoverflow.com/amzn/click/com/0072253606)学习指南。许多雇主不希望您获得实际认证，但他们确实希望您了解材料（​​无论他们是否明确表示）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-07T22:41:56.727

在我参加过的很多 Java 职位的采访中，设计模式一直是一个很大的话题。特别是工厂/抽象工厂/单例/立面。重温这些并没有什么坏处。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-08T00:04:37.417

我过去曾采访过几位开发人员，也参加过几次采访。到目前为止我所看到的：

*   设计模式——你使用了哪些，为什么。
*   集合类
*   穿线
*   内存使用情况

对于一些想进一步挖掘的地方：

*   软指针和弱指针
*   Java I/O 类
*   剖析
*   调试

根据职位的不同，还有一些细节，比如在 Web 开发人员的情况下使用框架、Eclipse RCP 或 Swing，无论工作所需的技术是什么。在这种情况下，它相对难以概括。我敢打赌，一点 Swing 永远不会受伤。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-07-04T16:04:38.270

取决于你申请的职位。在java中最常见的问题是关于

1.  线程
2.  序列化：特别是serialversionUUID，有一次面试官还问我有关计算serialversionUUID的默认算法。
3.  集合：集合 Hashset、LinkedList、DeQueue、Iterator 等的进出
4.  基本的糟糕概念。抽象和多态之间的差异等问题
5.  标记接口、不可变类、反射（很少）

面试的第二部分将是关于设计模式 常见的设计模式是

1.  单例的优点
2.  工厂与依赖注入
3.  建造者
4.  装饰器与依赖注入
5.  命令
6.  战略
7.  游客

逻辑问题始终基于算法，​​我建议您了解大多数搜索排序算法，因为这是软件 engg 的基础。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-07T21:49:40.950

首先，你需要精通 Java，并且能够自如地谈论面试期间可能会出现的编码问题。了解一些框架（当前状态）也是一个不错的加分项。通常 java 用于服务器端的东西，所以试着研究一些 Spring、Wicket、Tapestry、Struts、JSP、JSF、Ibatis、Hibernate 或其他有趣的东西。

此外，如果面试官似乎没有对你感兴趣的问题，制定一个进入“演示模式”的后备计划是一个好计划。你想展示你的东西。哇他们，没有撒谎。

小心你说的，有些面试官实际上可能比你有更多的经验，但不要表现出来，直到判决时间。

祝你面试顺利。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-12-07T23:55:07.437

这里有一些很好的提示。至少你告诉别人从哪里开始。

# git - 如何在提交之前撤消“git add”？

> ID：348170
> 
> 赞同：10374
> 
> 时间：2008-12-07T21:57:46.503
> 
> 标签：git, undo, git-revert, git-add

我错误地使用以下命令将文件添加到 Git：

```
git add myfile.txt 
```

我还没跑`git commit`。有没有办法撤消这个，所以这些文件不会包含在提交中？

* * *

## 回答 #1

> 赞同：12286
> 
> 时间：2008-12-07T22:30:48.340

`git add`您可以在提交之前撤消

```
git reset <file> 
```

这将从当前索引（“即将提交”列表）中删除它而不更改任何其他内容。

您可以使用

```
git reset 
```

没有任何文件名来取消所有应有的更改。当有太多文件需要在合理的时间内一一列出时，这会派上用场。

在旧版本的 Git 中，上述命令分别相当于`git reset HEAD <file>`和，如果未定义（因为您尚未在存储库中进行任何提交）或模棱两可（因为您创建了一个名为 的分支，这是一件愚蠢的事情`git reset HEAD`，则将失败你不应该这样做）。不过，这[在 Git 1.8.2 中有所更改](https://git.kernel.org/cgit/git/git.git/tree/Documentation/RelNotes/1.8.2.txt#n179)，因此在现代版本的 Git 中，您甚至可以在首次提交之前使用上述命令：`HEAD``HEAD`

> “git reset”（不带选项或参数）用于在您的历史记录中没有任何提交时出错，但现在它为您提供一个空索引（以匹配您甚至不存在的不存在的提交）。

文档：[**git reset**](https://git-scm.com/docs/git-reset)

* * *

## 回答 #2

> 赞同：2336
> 
> 时间：2009-03-25T16:20:04.247

你要：

```
git rm --cached <added_file_to_undo> 
```

推理：

当我是新手时，我第一次尝试

```
git reset . 
```

（撤消我的整个初始添加），只是为了得到这个（不是那么）有用的信息：

```
fatal: Failed to resolve 'HEAD' as a valid ref. 
```

事实证明，这是因为 HEAD ref（分支？）直到第一次提交之后才存在。也就是说，如果你的工作流程和我一样，你会遇到和我一样的初学者问题：

1.  cd 到我伟大的新项目目录来试用 Git，新的热点
2.  `git init`
3.  `git add .`
4.  `git status`

    ...很多废话卷轴...

    =>该死的，我不想添加所有这些。

5.  谷歌“撤消 git 添加”

    => 找到堆栈溢出 - 耶

6.  `git reset .`

    => 致命：无法将“HEAD”解析为有效参考。

进一步证明，在邮件列表中记录了一个针对此无用的[错误。](http://kerneltrap.org/mailarchive/git/2008/2/13/846664/thread)

并且正确的解决方案就在 Git 状态输出中（是的，我掩饰为“废话”）

> ```
> ...
> # Changes to be committed:
> #   (use "git rm --cached <file>..." to unstage)
> ... 
> ```

解决方案确实是使用`git rm --cached FILE`.

请注意此处其他地方的警告 -`git rm`删除文件的本地工作副本，但如果您使用**--cached则***不会*。这是结果：**`git help rm`**

 **> --cached 使用此选项仅从索引中取消暂存和删除路径。工作树文件，无论是否修改，都将被保留。

我继续使用

```
git rm --cached . 
```

删除所有内容并重新开始。但是没有用，因为 while`add .`是递归的，结果`rm`需要`-r`递归。叹。

```
git rm -r --cached . 
```

好的，现在我回到我开始的地方。下次我打算用`-n`做一个dry run，看看会添加什么：

```
git add -n . 
```

`git help rm`在相信不会破坏任何东西之前，我把所有东西都拉到了安全的地方`--cached`（如果我拼错了怎么办）。

* * *

## 回答 #3

> 赞同：595
> 
> 时间：2008-12-07T23:22:56.287

如果您键入：

```
git status 
```

Git 会告诉你暂存的内容等，包括如何取消暂存的说明：

```
use "git reset HEAD <file>..." to unstage 
```

我发现 Git 在推动我在这种情况下做正确的事情方面做得很好。

**注意：最近的 Git 版本 (1.8.4.x) 已更改此消息：**

```
(use "git rm --cached <file>..." to unstage) 
```

* * *

## 回答 #4

> 赞同：284
> 
> 时间：2010-09-10T20:28:15.510

澄清：`git add`将更改从当前工作目录移动到*暂存区*（索引）。

这个过程称为*staging*。*因此，用于暂存*更改（更改的文件）的最自然命令是显而易见的命令：

```
git stage 
```

`git add`只是一个更易于键入的别名`git stage`

可惜没有`git unstage`也没有`git unadd`命令。相关的更难猜测或记住，但很明显：

```
git reset HEAD -- 
```

我们可以很容易地为此创建一个别名：

```
git config --global alias.unadd 'reset HEAD --'
git config --global alias.unstage 'reset HEAD --' 
```

最后，我们有了新命令：

```
git add file1
git stage file2
git unadd file2
git unstage file1 
```

我个人使用更短的别名：

```
git a # For staging
git u # For unstaging 
```

* * *

## 回答 #5

> 赞同：198
> 
> 时间：2011-05-18T18:05:27.090

除了接受的答案之外，如果您错误添加的文件很大，您可能会注意到，即使在使用 ' `git reset`' 从索引中删除它之后，它似乎仍然占用`.git`目录中的空间。

这没什么好担心的；该文件确实仍在存储库中，但仅作为“松散对象”。它不会被复制到其他存储库（通过克隆、推送），并且空间最终会被回收——尽管可能不会很快。如果你着急，你可以运行：

```
git gc --prune=now 
```

* * *

*更新*（以下是我试图消除最受好评的答案可能引起的一些混淆）：

那么，真正的**撤销**是`git add`什么？

`git reset HEAD <file>`?

或者

`git rm --cached <file>`?

严格来说，如果我没记错的话：**none**。

`git add` **无法撤消**- 通常是安全的。

让我们首先回顾一下`git add <file>`实际做了什么：

1.  如果`<file>`之前**没有跟踪**，`git add` **则将其添加到缓存**中，并带有其当前内容。

2.  如果已经`<file>`被**跟踪**，`git add` **则将当前内容**（快照、版本）保存到缓存中。在 Git 中，这个动作仍然被称为**add**，（不仅仅是*更新*它），因为一个文件的两个不同版本（快照）被认为是两个不同的项目：因此，我们确实是在缓存中添加一个新项目，最终后来承诺。

鉴于此，这个问题有点模棱两可：

> 我错误地使用命令添加了文件...

OP 的场景似乎是第一个（未跟踪的文件），我们希望“撤消”从跟踪的项目中删除文件（不仅仅是当前内容）。**如果**是这种情况，则可以运行 `git rm --cached <file>`.

我们也可以运行`git reset HEAD <file>`。这通常更可取，因为它适用于两种情况：当我们错误地添加了已跟踪项目的版本时，它也会撤消。

但是有两个警告。

首先：（如答案中所指出的）只有一种情况`git reset HEAD`不起作用，但`git rm --cached`确实起作用：一个新的存储库（无提交）。但是，实际上，这实际上是一个无关紧要的案例。

第二：请注意，`git reset HEAD` 不能神奇地恢复以前缓存的文件内容，它只是从 HEAD 重新同步它。如果我们的误导`git add`覆盖了之前分阶段的未提交版本，我们将无法恢复它。这就是为什么严格来说，我们无法撤消 [*]。

例子：

```
$ git init
$ echo "version 1" > file.txt
$ git add file.txt   # First add of file.txt
$ git commit -m 'first commit'
$ echo "version 2" > file.txt
$ git add  file.txt   # Stage (don't commit) "version 2" of file.txt
$ git diff --cached file.txt
-version 1
+version 2
$ echo "version 3" > file.txt
$ git diff  file.txt
-version 2
+version 3
$ git add  file.txt    # Oops we didn't mean this
$ git reset HEAD file.txt  # Undo?
$ git diff --cached file.txt  # No dif, of course. stage == HEAD
$ git diff file.txt   # We have irrevocably lost "version 2"
-version 1
+version 3 
```

当然，如果我们只是遵循通常的惰性工作流程，只为添加新文件（案例 1）执行“git add”，并且我们通过 commit`git commit -a`命令更新新内容，这并不是很关键。

* * *

^(*（编辑：以上内容实际上是正确的，但仍然有一些稍微有点骇人听闻/令人费解的方法来恢复已暂存但未提交然后被覆盖的更改 - 请参阅 Johannes Matokic 和 iolsmit 的评论）)

* * *

## 回答 #6

> 赞同：161
> 
> 时间：2017-06-28T10:43:07.987

**使用 Git撤消**已添加的文件非常容易。`myfile.txt`对于已添加的重置，请使用：

```
git reset HEAD myfile.txt 
```

**解释：**

暂存不需要的文件后，要撤消，您可以执行`git reset`. `Head`是本地文件的头，最后一个参数是文件的名称。

我在下图中为您创建了更详细的步骤，包括在这些情况下可能发生的所有步骤：

[![git重置头文件](https://i.stack.imgur.com/9JgGD.jpg)](https://i.stack.imgur.com/9JgGD.jpg)

* * *

## 回答 #7

> 赞同：112
> 
> 时间：2009-12-09T21:19:09.213

```
git rm --cached . -r 
```

将以递归方式“取消添加”您从当前目录中添加的所有内容

* * *

## 回答 #8

> 赞同：107
> 
> 时间：2013-03-29T11:14:28.343

Git 对每一个可以想象的动作都有命令，但它需要广泛的知识才能把事情做好，因此它充其量是违反直觉的......

**你之前做了什么：**

*   更改了文件并使用了`git add .`, 或`git add <file>`.

**你想要什么：**

*   从索引中删除文件，但保留它的版本并在工作副本中保留未提交的更改：

    ```
     git reset HEAD <file> 
    ```

*   将文件从 HEAD 重置为最后一个状态，撤消更改并将它们从索引中删除：

    ```
     # Think `svn revert <file>` IIRC.
     git reset HEAD <file>
     git checkout <file>

     # If you have a `<branch>` named like `<file>`, use:
     git checkout -- <file> 
    ```

    这是必需的，因为它`git reset --hard HEAD`不适用于单个文件。

*   从索引和版本控制中删除`<file>`，在工作副本中保留未版本控制的文件：

    ```
     git rm --cached <file> 
    ```

*   `<file>`完全从工作副本和版本控制中删除：

    ```
     git rm <file> 
    ```

* * *

## 回答 #9

> 赞同：101
> 
> 时间：2011-10-12T01:12:51.567

跑

```
git gui 
```

并手动删除所有文件，或者选择所有文件并单击*unstage from commit*按钮。

* * *

## 回答 #10

> 赞同：100
> 
> 时间：2014-01-16T19:54:07.207

问题没有明确提出。原因在于它`git add`有两层含义：

1.  将**新文件**添加到暂存区，然后使用`git rm --cached file`.
2.  将**修改后**的文件添加到暂存区域，然后使用`git reset HEAD file`.

**如有疑问，请使用**

```
git reset HEAD file 
```

因为它在这两种情况下都做了预期的事情。

**警告：**如果您`git rm --cached file`对已**修改**的文件（存储库中以前存在的文件）执行此操作，则该文件将在`git commit`! 它仍然存在于您的文件系统中，但如果其他人拉动您的提交，该文件将从他们的工作树中删除。

`git status`将告诉您该文件是**新文件**还是**已修改**：

```
On branch master
Changes to be committed:
  (use "git reset HEAD <file>..." to unstage)

    new file:   my_new_file.txt
    modified:   my_modified_file.txt 
```

* * *

## 回答 #11

> 赞同：81
> 
> 时间：2010-10-01T14:54:06.217

根据许多其他答案，您可以使用`git reset`

**但：**

我发现这篇很棒的小帖子实际上为以下内容添加了 Git 命令（嗯，一个别名）`git unadd`：有关详细信息，请参阅*[git unadd](https://blog.pivotal.io/labs/labs/git-unadd)*或..

简单地，

```
git config --global alias.unadd "reset HEAD" 
```

现在你可以

```
git unadd foo.txt bar.txt 
```

或者/直接：

```
git reset HEAD foo.txt bar.txt 
```

* * *

## 回答 #12

> 赞同：73
> 
> 时间：2009-11-19T16:39:50.597

如果您处于初始提交并且无法使用`git reset`，只需声明“Git 破产”并删除`.git`文件夹并重新开始

* * *

## 回答 #13

> 赞同：58
> 
> 时间：2016-07-11T18:40:52.230

```
git reset filename.txt 
```

将从当前索引中删除一个命名的文件`filename.txt`（也称为“暂存区”，这是保存“即将提交”的更改的地方），而不更改任何其他内容（工作目录不会被覆盖）。

* * *

## 回答 #14

> 赞同：54
> 
> 时间：2012-04-18T12:53:38.330

用于`git add -i`从即将提交的提交中删除刚刚添加的文件。例子：

添加您不想要的文件：

```
$ git add foo
$ git status
# On branch master
# Changes to be committed:
#   (use "git reset HEAD <file>..." to unstage)
#
#       new file:   foo
#
# Untracked files:
#   (use "git add <file>..." to include in what will be committed)
# [...]# 
```

进入交互式添加以撤消您的添加（在 git 中键入的命令是“r”（还原）、“1”（列表中的第一个条目还原显示）、“返回”以退出还原模式和“q” （辞职）：

```
$ git add -i
           staged     unstaged path
  1:        +1/-0      nothing foo

*** Commands ***
  1: [s]tatus     2: [u]pdate     3: [r]evert     4: [a]dd untracked
  5: [p]atch      6: [d]iff       7: [q]uit       8: [h]elp
What now> r
           staged     unstaged path
  1:        +1/-0      nothing [f]oo
Revert>> 1
           staged     unstaged path
* 1:        +1/-0      nothing [f]oo
Revert>> 
note: foo is untracked now.
reverted one path

*** Commands ***
  1: [s]tatus     2: [u]pdate     3: [r]evert     4: [a]dd untracked
  5: [p]atch      6: [d]iff       7: [q]uit       8: [h]elp
What now> q
Bye.
$ 
```

就是这样！这是您的证明，表明“foo”重新出现在未跟踪列表中：

```
$ git status
# On branch master
# Untracked files:
#   (use "git add <file>..." to include in what will be committed)
# [...]
#       foo
nothing added to commit but untracked files present (use "git add" to track)
$ 
```

* * *

## 回答 #15

> 赞同：46
> 
> 时间：2011-09-24T23:34:39.967

当你开始一个新项目时，这里有一种方法可以避免这个令人烦恼的问题：

*   为您的新项目创建主目录。
*   运行`git init`。
*   现在创建一个 .gitignore 文件（即使它是空的）。
*   提交您的 .gitignore 文件。

`git reset`如果你没有任何提交，Git 会让你很难做到。如果您创建一个很小的初始提交只是为了拥有一个，那么您可以在此之后`git add -A`尽可能`git reset`多地进行操作，以使所有事情都正确。

这种方法的另一个优点是，如果您以后遇到行尾问题并需要刷新所有文件，这很容易：

*   检查初始提交。这将删除您的所有文件。
*   然后再次检查您最近的提交。这将使用您当前的行尾设置检索文件的新副本。

* * *

## 回答 #16

> 赞同：43
> 
> 时间：2012-01-23T16:57:24.810

请注意，如果您未能指定修订，则必须包含分隔符。我的控制台中的示例：

```
git reset <path_to_file>
fatal: ambiguous argument '<path_to_file>': unknown revision or path not in the working tree.
Use '--' to separate paths from revisions

git reset -- <path_to_file>
Unstaged changes after reset:
M    <path_to_file> 
```

（Git 版本 1.7.5.4）

* * *

## 回答 #17

> 赞同：42
> 
> 时间：2009-11-19T16:38:03.453

自从您发布问题以来，也许 Git 已经进化了。

```
$> git --version
git version 1.6.2.1 
```

现在，您可以尝试：

```
git reset HEAD . 
```

这应该是您正在寻找的。

* * *

## 回答 #18

> 赞同：41
> 
> 时间：2020-06-25T06:23:30.637

### 2019 年更新

正如其他人在相关问题中指出的那样（请参阅[此处](https://stackoverflow.com/a/58003889/9210961)、[此处](https://stackoverflow.com/a/60928923/9210961)、[此处](https://stackoverflow.com/a/61725470/9210961)、[此处](https://stackoverflow.com/a/16044987/9210961)、[此处](https://stackoverflow.com/a/6919257/9210961)、[此处](https://stackoverflow.com/a/58610415/9210961)和[此处](https://stackoverflow.com/a/58830990/9210961)），您现在可以使用以下**命令取消暂存单个文件**：

```
git restore --staged <file> 
```

并**取消暂存所有文件**（从 repo 的根目录）：

```
git restore --staged . 
```

### 笔记

`git restore`[于2019 年 7 月](https://github.com/git/git/commit/f496b064fc1135e0dded7f93d85d72eb0b302c22)推出，并在 2.23 版本中发布。
使用`--staged`标志，它恢复索引的内容（这里问的是什么）。

当`git status`使用暂存的未提交文件运行时，这是 Git 建议用来取消暂存文件的方法（而不是`git reset HEAD <file>`以前 v2.23 之前的做法）。

* * *

## 回答 #19

> 赞同：37
> 
> 时间：2009-06-22T11:58:33.203

要从暂存区域中删除新文件（并且仅在新文件的情况下），如上所述：

```
git rm --cached FILE 
```

仅对意外添加的新文件使用 rm --cached。

* * *

## 回答 #20

> 赞同：31
> 
> 时间：2012-07-26T07:50:36.173

要重置特定文件夹（及其子文件夹）中的每个文件，可以使用以下命令：

```
git reset * 
```

* * *

## 回答 #21

> 赞同：30
> 
> 时间：2013-08-27T21:15:05.513

使用`*`命令一次处理多个文件：

```
git reset HEAD *.prj
git reset HEAD *.bmp
git reset HEAD *gdb* 
```

等等

* * *

## 回答 #22

> 赞同：28
> 
> 时间：2010-05-19T03:49:06.597

只需键入`git reset`它就会恢复，就像您`git add .`自上次提交以来从未键入过一样。确保你之前已经承诺过。

* * *

## 回答 #23

> 赞同：28
> 
> 时间：2016-10-04T11:02:48.643

假设我创建一个新文件`newFile.txt`：

[![在此处输入图像描述](https://i.stack.imgur.com/nxRgO.png)](https://i.stack.imgur.com/nxRgO.png)

假设我不小心添加了文件，`git add newFile.txt`：

[![在此处输入图像描述](https://i.stack.imgur.com/P6fpa.png)](https://i.stack.imgur.com/P6fpa.png)

现在我想在提交之前撤消这个添加`git reset newFile.txt`：

[![在此处输入图像描述](https://i.stack.imgur.com/pbbZ8.png)](https://i.stack.imgur.com/pbbZ8.png)

* * *

## 回答 #24

> 赞同：23
> 
> 时间：2017-10-28T06:03:31.243

**对于特定文件：**

> *   git 重置 my_file.txt
> *   git checkout my_file.txt

**对于所有添加的文件：**

> *   混帐重置。
> *   混帐结帐。

注意：**checkout**更改文件中的代码并移动到最后更新（提交）状态。**重置**不会更改代码；它只是重置标题。

* * *

## 回答 #25

> 赞同：19
> 
> 时间：2016-10-02T15:54:48.710

要撤消`git add`，请使用：

```
git reset filename 
```

* * *

## 回答 #26

> 赞同：18
> 
> 时间：2015-10-22T13:03:38.953

还有交互模式：

```
git add -i 
```

选择选项 3 取消添加文件。在我的情况下，我经常想要添加多个文件，并且在交互模式下，您可以使用这样的数字来添加文件。这将占用除 4 之外的所有内容：1、2、3 和 5

要选择一个序列，只需键入 1-5 即可从 1 到 5 全部取值。

[Git 暂存文件](https://git-scm.com/book/en/v2/Git-Tools-Interactive-Staging)

* * *

## 回答 #27

> 赞同：17
> 
> 时间：2013-01-31T15:43:53.650

此命令将取消隐藏您的更改：

```
git reset HEAD filename.txt 
```

你也可以使用

```
git add -p 
```

添加部分文件。

* * *

## 回答 #28

> 赞同：16
> 
> 时间：2017-06-27T13:58:34.253

`git add myfile.txt`# 这会将您的文件添加到待提交列表中

与此命令完全相反的是，

```
git reset HEAD myfile.txt  # This will undo it. 
```

因此，您将处于以前的状态。指定将再次处于未跟踪列表中（以前的状态）。

它将使用该指定文件重置您的头部。所以，如果你的脑袋没有它的意思，它会简单地重置它。

* * *

## 回答 #29

> 赞同：16
> 
> 时间：2017-10-26T18:15:23.510

```
git reset filename.txt 
```

> 将从当前索引中删除名为 filename.txt 的文件，即“即将提交”区域，而不更改任何其他内容。

* * *

## 回答 #30

> 赞同：12
> 
> 时间：2015-12-08T09:58:33.770

在 Sourcetree 中，您可以通过 GUI 轻松完成此操作。您可以检查 Sourcetree 使用哪个命令来取消暂存文件。

我创建了一个新文件并将其添加到 Git。然后我使用 Sourcetree GUI 取消了它。这是结果：

> 取消暂存文件 [08/12/15 10:43] git -c diff.mnemonicprefix=false -c core.quotepath=false -c credential.helper=sourcetree reset -q -- path/to/file/filename.java

Sourcetree 用于取消暂存`reset`新文件。

* * *

## 回答 #31

> 赞同：11
> 
> 时间：2020-09-11T17:46:06.520

您可以使用 git 命令或 GUI git 取消暂存/撤消。

单个文件

```
git reset File.txt 
```

多个文件

```
git reset File1.txt File2.txt File3.txt 
```

**示例**- 假设您错误地添加了Home.js **、** ListItem.js **、** Update.js**并且**[![在此处输入图像描述](https://i.stack.imgur.com/jIpsc.png)](https://i.stack.imgur.com/jIpsc.png) 想要撤消/重置 =>

```
git reset src/components/home/Home.js src/components/listItem/ListItem.js src/components/update/Update.js 
```

[![在此处输入图像描述](https://i.stack.imgur.com/8PQ8Y.png)](https://i.stack.imgur.com/8PQ8Y.png)

**使用git GUI**的相同示例

 **```
git gui 
```

打开一个窗口 => 从**分阶段更改中取消选中您的文件（将提交）** [![在此处输入图像描述](https://i.stack.imgur.com/cE4gI.png)](https://i.stack.imgur.com/cE4gI.png)

* * *

## 回答 #32

> 赞同：10
> 
> 时间：2017-05-26T08:32:16.490

最直观的解决方案之一是使用[Sourcetree](https://www.sourcetreeapp.com/)。

您可以从暂存和未暂存中拖放文件

[![在此处输入图像描述](https://i.stack.imgur.com/yaw4O.png)](https://i.stack.imgur.com/yaw4O.png)

* * *

## 回答 #33

> 赞同：7
> 
> 时间：2019-01-29T10:10:04.980

该`git reset`命令可帮助您修改暂存区或暂存区和工作树。Git 能够完全按照您的意愿制作提交，这意味着您有时需要撤消对您使用`git add`.

你可以通过调用来做到这一点`git reset HEAD <file to change>`。您有两种选择可以完全摆脱更改。`git checkout HEAD <file(s) or path(s)>`是一种快速撤消对暂存区和工作树所做更改的方法。

但是，请小心使用此命令，因为它会删除对工作树的所有更改。Git 不知道这些更改，因为它们从未被提交。运行此命令后，无法恢复这些更改。

您可以使用的另一个命令是`git reset --hard`. 它对您的工作树同样具有破坏性 - 任何未提交的更改或分阶段的更改在运行后都会丢失。运行`git reset -hard HEAD`与`git checkout HEAD`. 它只是不需要文件或路径即可工作。

您可以`--soft`使用`git reset`. 它将存储库重置为您指定的提交并暂存所有这些更改。您已经暂存的任何更改都不会受到影响，工作树中的更改也不会受到影响。

最后，您可以使用它`--mixed`来重置工作树，而无需暂存任何更改。这也会取消暂存的任何更改。

* * *

## 回答 #34

> 赞同：5
> 
> 时间：2020-10-19T02:15:59.453

您可以在 git 版本 2.23 之后使用此命令：

```
git restore --staged <filename> 
```

或者，您可以使用以下命令：

```
git reset HEAD <filename> 
```

* * *

## 回答 #35

> 赞同：3
> 
> 时间：2021-09-18T20:54:22.157

我会使用`git restore --staged .`或`git restore --staged <filename>`

您也可以使用`git rm --cached`，但是，该`git rm`命令应该理想地用于已跟踪的文件。

* * *

## 回答 #36

> 赞同：3
> 
> 时间：2021-09-20T09:10:31.950

如果您想恢复最后一次提交，但仍想将提交中所做的更改保留在本地，请使用以下命令：

```
git reset HEAD~1 --mixed 
```

* * *

## 回答 #37

> 赞同：2
> 
> 时间：2020-08-25T13:35:13.770

我第一次遇到这个问题时，我在这里找到[了这篇文章](https://stackoverflow.com/questions/348170/how-do-i-undo-git-add-before-commit?page=1&tab=votes#tab-top)，从第一个答案中我了解到我应该这样做`git reset <filename>`。它工作得很好。

最后，我碰巧在我的主 git 文件夹中有几个子文件夹。`git add .`我发现将所有文件添加到子文件夹中很容易，然后`git reset`添加我不想添加的几个文件。

现在我有很多文件和子文件夹。一个接一个很乏味，`git reset`但首先还是更容易`git add .`，然后重置几个重/不需要但有用的文件和文件夹。

我发现下面的方法（[这里](https://stackoverflow.com/questions/348170/how-do-i-undo-git-add-before-commit?page=1&tab=votes#tab-top)或[这里](https://stackoverflow.com/questions/18424943/undo-multiple-file-and-folder-git-add)没有记录）相对容易。我希望它会有所帮助：

假设您有以下情况：

```
Folder/SubFolder1/file1.txt
Folder/SubFolder2/fig1.png
Folder/SubFolderX/fig.svg
Folder/SubFolder3/<manyfiles>
Folder/SubFolder4/<file1.py, file2.py, ..., file60.py, ...> 
```

您想添加所有文件夹和文件，但不是`fig1.png`，不是，不是`SubFolderX`，并且`file60.py`列表不断增长......

首先，制作/创建 a`bash shell script`并为其命名。说，`git_add.sh`：

然后将所有路径添加到您想要在`git reset`前面添加的所有文件夹和文件`git reset --` 。`git_add.sh`随着文件列表的增加，您可以轻松地将路径复制粘贴到脚本中。`git_add.sh`脚本应如下所示：

```
#!/bin/bash

git add .
git reset -- Folder/SubFolder2/fig1.png
git reset -- Folder/SubFolderX
git reset -- Folder/SubFolder4/file60.py 
```

`#!/bin/bash`很重要。然后`source git_add.sh`运行它。之后，你可以做`git commit -m "some comment"`，然后`git push -u origin master`如果你已经设置了 Bitbucket/Github。

免责声明：我只在 Linux 中测试过这个。

* * *

如果你有很多文件和文件夹总是保留在本地 git 存储库中，但你不希望 git 在你这样做时跟踪更改`git add .`，比如视频和数据文件，**你必须学习如何使用`.gitignore`**. 也许从[这里](https://www.atlassian.com/git/tutorials/saving-changes/gitignore)。

# java - java有界泛型类型定义

> ID：348175
> 
> 赞同：22
> 
> 时间：2008-12-07T21:58:48.887
> 
> 标签：java, generics

以下类型定义有什么区别

```
<E extends Number> 
```

和

```
<? extends Number> 
```

干杯，唐

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-12-07T22:05:12.790

这个版本：

```
<? extends Number> 
```

可以出现在非泛型方法/类型中，它基本上意味着“我不在乎类型是什么，只要它派生自`Number`. 我不会真正使用该类型，我只需要它是合适的。”

这个版本：

```
<E extends Number> 
```

要求 E 是类型参数。它允许您做更多事情（例如，`ArrayList<E>`稍后创建），但是当您并不真正需要它们时，额外的类型参数会使事情变得更加复杂。

# c++ - 开源声音引擎

> ID：348178
> 
> 赞同：9
> 
> 时间：2008-12-07T22:00:45.327
> 
> 标签：c++, iphone, core-audio, openal

当我开始使用 SoundEngine（来自 CrashLanding 和 TouchFighter）时，我读过一些人建议不要使用它，因为根据他们的说法，它不够稳定。它仍然是我所知道的在不学习 C++ 和 OpenAL 的情况下通过音高和位置控制播放声音的唯一解决方案，所以我忽略了警告并继续使用它。

但现在我开始担心了。2.2 SDK 引入了 AVFoundation。使用 CrashLanding 中的 SoundEngine（用于声音）和 AVAudioPlayer（用于音乐），我发现 SoundEngine 在释放唯一现有的 AVAudioPlayer 时表现得很奇怪（所有声音都会停止，直到启动新的 AVAudioPlayer）。大约在 2.2 SDK 发布的同时，CrashLanding 示例代码被神秘地从 ADC 站点中删除。我担心会有更多不好的惊喜出现。

我的问题是，有人知道 SoundEngine 的开源替代品吗？甚至可能是使用 OpenAL 的 C++ 库？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T06:03:29.517

看看[这个](https://sourceforge.net/projects/clunk)图书馆，但我不知道这是你需要的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-01-27T11:42:14.470

[Kowalski 项目](http://kowalski.sourceforge.net)提供了一种数据驱动的便携式声音引擎，目前可以在 iOS、OS X 和 Windows 上运行。该引擎是在 zlib 许可下发布的，并提供位置音频、音高控制等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-08-18T18:51:59.403

[iPhone 的 ObjectAL](http://github.com/kstenerud/ObjectAL-for-iPhone)

克隆它。用它。爱它。享受自由。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-02T06:21:14.270

I’ve written a [simple sound engine](http://github.com/zoul/Finch/) around OpenAL. There are no position controls (I didn’t need them), but they would be trivial to add if you find the rest to your liking. And there is also some [experimental sound code](http://code.google.com/p/cocos2d-iphone/source/browse/trunk/experimental/sound-engine/) in the Cocos2D engine. It has both pitch and position controls and looks quite usable.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-30T18:31:32.850

为什么不直接使用 AVFoundation？它处理起来非常简单，而且非常灵活——除了你是否需要精确的时间（Apple 文档说——但我已经对其进行了相当广泛的测试，但还没有发现任何重大的实际问题）我看不出有任何理由不利用它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T20:52:34.093

AVFoundation 缺少声音位置。这让我很难过。

# opengl - 有没有像样的 OpenGL SceneGraph API/框架？

> ID：348183
> 
> 赞同：4
> 
> 时间：2008-12-07T22:01:23.330
> 
> 标签：opengl, scenegraph

我是 OpenGL 的新手。

想知道是否有任何好的场景图形 API/OpenGL 框架。

目前，我正在将 glut 与基于自定义节点的解决方案一起使用：我正在为每个节点设置子节点和兄弟节点，以调用遍历函数。

在管理场景中的动态元素时，我想要一个更灵活的解决方案。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-09T04:56:30.557

[SDL](http://www.libsdl.org/)比 glut 更新一点，但您在滚动自己的图形结构来管理风景方面走在了正确的轨道上。有很多可用的框架。[例如， OpenSceneGraph](http://www.opengl.org/sdk/libs/OpenSceneGraph/)已经存在了很长时间。[OGRE](http://www.ogre3d.org/)也有大量的追随者。但是，它不是一个严格的 OpenGL 库，因为 DirectX 和软件渲染器也可用。

您可能想查看相关主题，例如[二进制空间分区](http://en.wikipedia.org/wiki/Binary_space_partitioning)、[四叉树](http://en.wikipedia.org/wiki/Quadtree)/[八](http://en.wikipedia.org/wiki/Octree)叉树和[kd-trees](http://en.wikipedia.org/wiki/Kd-tree)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-09T18:02:52.623

我同意openscenegraph 是一个很棒的场景图。它是用 C++ 编写的，并且绑定到其他一些语言，但据我所知，它不适用于 .NET。我们的情况是使用比普通的旧 opengl 更多的东西，并且正在研究托管的 directx、xna、wpf 和 opengl。我们选择基于 Tao.OpenGL 作为 opengl 编写自己的场景图。

您可以通过在剔除和渲染阶段之前进行更新阶段来完成动态对象。如果您使用多线程，则需要小心更新阶段。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-18T16:45:31.810

有很多图书馆处理这个主题。这里有一些我的最爱：

*   [VTK](http://www.vtk.org) - 非常适合和开源
*   [Coin3D](http://www.coin3d.org) - 非常好的商业场景图
*   [OpenSG](http://opensg.vrsource.org/trac) - 只是为了完整性:-)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-03-31T19:29:45.497

我第二次（第三次？）使用OpenSceneGraph。它健壮且跨平台，并且与 Qt 很好地集成（我们的应用程序在 MacOS、Windows 和 Linux 上运行，同时使用 OpenSceneGraph 和 Qt）。该文档可能不像商业选项那样完善，但是您可以购买一本书（以及免费的快速入门指南），这确实很有帮助。

# javascript - jQuery 滑块范围

> ID：348187
> 
> 赞同：5
> 
> 时间：2008-12-07T22:04:42.247
> 
> 标签：javascript, jquery, slider

我正在尝试使用 jQuery 滑块的范围属性，以便滑块控件显示两个句柄，用户可以从中选择房地产的价格范围。我的代码是：

```
$("#price").slider({ range: true, minValue: 0, maxValue: 2000000,
  change:
  function(e, ui) {
    var range = (Math.round(ui.range) * 10) + " to " + ui.value;
    $("#pricedesc").text(range);
  } 
}); 
```

价格范围应为 0 至 2,000,000 美元。当我在滑块上滑动手柄时，虽然我得到了不寻常的值，例如“690 到 13”。双手柄滑块的工作原理是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-07T23:03:15.530

要访问双柄滑块中的滑块句柄值，您需要从[滑块（“值”，索引）](http://docs.jquery.com/UI/Slider/slider#slider.28.C2.A0.22value.22.2C.C2.A0index_.29)函数访问它们。试试下面的代码：

```
$(document).ready(function(){
    $("#price").slider(
      { range: true, 
        min: 0, 
        max: 2000000, 
        change: function(e,ui) { 
          alert($("#price").slider("value", 0) + ' - ' + $("#price").slider("value", 1) );
    }});
    $("#price").slider("moveTo", 500000, 1);
  }); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-11-26T07:32:18.187

```
<script type="text/javascript">
var str;
$(function() {

    $("#slider-range").slider({
        range: true,
        min: 250,
        max: 2500,
        values: [500, 1000],
        slide: function(event, ui) {
            $("#amount").val('Rs' + ui.values[0] + ' - Rs' + ui.values[1]);                     
        }
    });
    $("#amount").val('Rs' + $("#slider-range").slider("values", 0) + ' - Rs' + $("#slider-range").slider("values", 1));
      //document.getElementById('valueofslide').value = arrIntervals[ui.values[1]];
});

</script>

in  html
<div id="Priceslider" class="demo" style="margin-top:5px; " >
                        <%--<Triggers>
                                <asp:AsyncPostBackTrigger ControlID="Chk1"  />

                                </Triggers>--%>
                        <asp:UpdatePanel ID="UpdatePanel2" runat="server">
                        <ContentTemplate>
                        <asp:TextBox ID="amount" runat="server" 
                            style="border:0; color:#f6931f; font-weight:bold;margin-bottom:7px;" OnTextChanged="amount_TextChanged" AutoPostBack="True"></asp:TextBox>
                            </ContentTemplate> 
                        </asp:UpdatePanel>                                                        
                            <div id="slider-range"></div>  
                        <asp:TextBox ID="valueofslide" runat="server" AutoPostBack="True"></asp:TextBox>              
                    </div>

 <asp:GridView ID="GridView1" runat="server" AutoGenerateColumns="False" 
            AllowPaging="True" PageSize="5" Width="555px" 
            onpageindexchanging="GridView1_PageIndexChanging">
    <Columns>
    <asp:TemplateField>
    <ItemTemplate>
    <div  class="propertyName">
           <asp:CheckBox ID="chkProperty" runat="server" Text='<%# Eval("PropertyName") %>' />,
        <asp:Label ID="lblLocation" runat="server" Text='<%# Eval("PropertyLocality") %>'></asp:Label>,
        <asp:Label ID="lblCity" runat="server" Text='<%# Eval("CityName") %>'></asp:Label>
        </div>

    <div class="property-image">
        <asp:Image ID="Image1" runat="server" ImageUrl='<%# Eval("PhotoPath") %>' Height="100" Width="100" />
               &nbsp;
        </div>

    <div>
    <div style="float: left; width: 380px; margin: 10px; border: thin solid black;">
            <div style="height: 80px; width: 80px; border: 1px solid; float: right; margin-top: 10px; margin-right: 10px;">
                <font size="2">Weekdays Price:<span id="weekdayPrice6"><%# Eval("WeekdayPrice")%></span></font><br>
                <font size="2">Weekend Price: <span id="weekendPrice6"><%# Eval("WeekendPrice")%></span></font><br>
                <input name="getamt" value="Get your amount" style="font-size: 8px;" type="button">
            </div>

            <div style="float: right; width: 280px;">
                <input name="Map" value="Map" onclick="showPropertyMap(6)" type="button">
                <input name="availability" value="Check Availability" onclick="showPropertyAvailabilityCalender(6)" type="button"><br>

                Ratings : <img src="images/star<%# Eval("PropertyRating") %>.PNG" alt="'<%# Eval("PropertyRating") %>'"/> (Votes : <span></span>)

                    <br>

                View <span></span> times, <span>
                    <asp:Label ID="Label1" runat="server" Text='<%# Eval("NumberOfReviews") %>'></asp:Label></span> Reviews<br>

                <span></span><%# Eval("PropertyRecommended")%> % Recommend<br>
                Check in <%# Eval("CheckinTime") %> Check out <%# Eval("CheckoutTime")%><br>
                <div id='<%# Eval("PropertyId") %>' class="property">
               <%-- <input name="Book" value="Book" type="button">--%>
               <asp:Button ID="Book" runat="server" Text="Book" 
                        OnClientClick="return retrivPropertyId(this);" onclick="Book_Click"/>
                <input name="Save" value="Save" type="button">
                 <input name="Details" value="Details" type="button" onclick="return retreivePId(this);">

                <asp:Button ID="Contact" runat="server" Text="Contact" 
                        OnClientClick="return retreivePropId(this);" onclick="Contact_Click" />
                <br>
                </div> 
            </div>
        </div>

    </div>
    </ItemTemplate>
    </asp:TemplateField>
    </Columns>
    </asp:GridView> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-05T20:31:57.490

轻微修正。您需要为双滑块调用 slider('values', n) 而不是 slide('value', n) 。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-08-06T10:17:35.140

另一个轻微的修正，而不是：

```
$("#price").slider("moveTo", 500000, 1); 
```

尝试以下代码，以便能够将第二个滑块处理程序设置为最大值；

```
var max = $('#price').slider('option', 'max');
$("#price").slider( 'values' , 1 , max ); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-04-03T11:32:13.953

```
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.min.js"></script>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" />
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>
<link rel="stylesheet" href="/resources/demos/style.css" />
<script type="text/javascript">
    var str;
    $(function () {

        $("#slider-range").slider({
            range: true,
            min: 250,
            max: 2500,
            values: [500, 1000],
            slide: function (event, ui) {
                $("#amount").val('Rs' + ui.values[0] + ' - Rs' + ui.values[1]);
            }
        });
        $("#amount").val('Rs' + $("#slider-range").slider("values", 0) + ' - Rs' + $("#slider-range").slider("values", 1));
        //document.getElementById('valueofslide').value = arrIntervals[ui.values[1]];
    }); 
```

```
<div id="Priceslider" class="demo" style="margin-top:5px; " >

                    <asp:UpdatePanel ID="UpdatePanel2" runat="server">
                    <ContentTemplate>
                    <asp:TextBox ID="amount" runat="server" 
                        style="border:0; color:#f6931f; font-weight:bold;margin-bottom:7px;" OnTextChanged="amount_TextChanged" AutoPostBack="True"></asp:TextBox>
                        </ContentTemplate> 
                    </asp:UpdatePanel>                                                        
                        <div id="slider-range"></div>  
                    <asp:TextBox ID="valueofslide" runat="server" AutoPostBack="True"></asp:TextBox>              
                </div>
</form> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-07-03T11:40:41.467

单滑块 -[演示](https://codepen.io/ssuryar/pen/PoZEBgm)

[https://codepen.io/ssuryar/pen/PoZEBgm](https://codepen.io/ssuryar/pen/PoZEBgm)

HTML

```
<div id="slider-range"></div> 
```

CSS

```
.ui-draggable, .ui-droppable {
    background-position: top;
}
.ui-widget-header {background: #006fba;}
.value {    position: absolute;    top: 30px;    left: 50%;    margin: 0 0 0 -20px;    width: 40px;    text-align: center;    display: block;    font-weight: normal;} 
```

jQuery

```
$( function() {
    $( "#slider-range" ).slider({
      range: true,
      min: 0,
      max: 500,
      values: [ 75, 300 ],
      slide: function( event, ui ) {
       $('.ui-slider-handle:eq(0) .price-range-min').html('$' + ui.values[ 0 ]);
       $('.ui-slider-handle:eq(1) .price-range-max').html('$' + ui.values[ 1 ]);
      }
    });
    $('.ui-slider-handle:eq(0)').append('<span class="price-range-min value">$' + $('#slider-range').slider('values', 0) + '</span>');
    $('.ui-slider-handle:eq(1)').append('<span class="price-range-max value">$' + $('#slider-range').slider('values', 1) + '</span>');
  } ); 
```

# javascript - 如何使用 Javascript 实现客户端替换？

> ID：348193
> 
> 赞同：0
> 
> 时间：2008-12-07T22:12:41.077
> 
> 标签：javascript, html, search, replace

我有一个 HTML 页面，我想使用 Javascript 进行一些客户端替换。我想替换的值在一个数组中，如下所示：

```
var searchFor = new Object();
var replaceWith = new Object();
searchFor =
[
    "quick",
    "brown",
    "fox",
];

replaceWith =
[
    "nimble",
    "black",
    "cat",
]; 
```

因此，“棕色”的每个实例都应替换为“黑色”。跨浏览器最简单的方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-07T23:06:41.043

我将使用默认的 W3C DOM 遍历递归到 DOM 的所有节点，只选择文本节点进行处理：

```
// replacer object, containing strings and their replacements
var replacer = {
  "quick": "nimble",
  "brown": "black",
  "fox": "cat"
};

// prepare regex cache
var replacer_re = (function ()
  {
    var replacer_re = {};
    // certain characters are special to regex, they must be escaped
    var re_specials = /[][/.*+?|(){}\\\\]/g; 
    var word;
    for (word in replacer)
    {
      var escaped_word = word.replace(re_specials, "\\\1");
      // add \b word boundary anchors to do whole-word replacing only
      replacer_re[word] = new RegExp("\\b" + escaped_word + "\\b", "g");
    }
    return replacer_re;
  }
)();

// replace function
function ReplaceText(text)
{
  var word;
  for (word in replacer)
    text = text.replace(replacer_re[word], replacer[word]);
  return text;
}

// DOM recursing function
function ReplaceTextRecursive(element)
{
  if (element.childNodes)
  {
    var children = element.childNodes;
    for (var i = children.length - 1; i >= 0; i--)
      ReplaceTextRecursive(children[i]);
  }    

  if (element.nodeType == 3) // 3 == TEXT_NODE
    element.nodeValue = ReplaceText(element.nodeValue);
}

// test it
function test()
{
  ReplaceTextRecursive(document)
} 
```

# python - 在 Python 中创建对象列表

> ID：348196
> 
> 赞同：84
> 
> 时间：2008-12-07T22:15:46.437
> 
> 标签：python, list, object, loops

我正在尝试创建一个 Python 脚本来打开多个数据库并比较它们的内容。在创建该脚本的过程中，我在创建其内容是我创建的对象的列表时遇到了问题。

为了这篇文章，我已经将程序简化为最基本的内容。首先，我创建一个新类，创建它的一个新实例，为其分配一个属性，然后将其写入一个列表。然后我为实例分配一个新值并再次将其写入列表......一次又一次......

问题是，它总是同一个对象，所以我实际上只是在更改基础对象。当我阅读列表时，我一遍又一遍地重复相同的对象。

那么如何在循环中将对象写入列表？

这是我的简化代码

```
class SimpleClass(object):
    pass

x = SimpleClass
# Then create an empty list
simpleList = []
#Then loop through from 0 to 3 adding an attribute to the instance 'x' of SimpleClass
for count in range(0,4):       
    # each iteration creates a slightly different attribute value, and then prints it to
# prove that step is working
# but the problem is, I'm always updating a reference to 'x' and what I want to add to
# simplelist is a new instance of x that contains the updated attribute

x.attr1= '*Bob* '* count
print "Loop Count: %s Attribute Value %s" % (count, x.attr1)
simpleList.append(x)

print '-'*20
# And here I print out each instance of the object stored in the list 'simpleList'
# and the problem surfaces.  Every element of 'simpleList' contains the same      attribute value

y = SimpleClass
print "Reading the attributes from the objects in the list"
for count in range(0,4):
    y = simpleList[count]
    print y.attr1 
```

那么我如何（追加、扩展、复制或其他）simpleList 的元素，以便每个条目包含对象的不同实例，而不是全部指向同一个？

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2008-12-07T22:22:39.777

你表现出一个根本性的误解。

您根本没有创建过 SimpleClass 的实例，因为您没有调用它。

```
for count in xrange(4):
    x = SimpleClass()
    x.attr = count
    simplelist.append(x) 
```

或者，如果您让类接受参数，则可以使用列表推导。

```
simplelist = [SimpleClass(count) for count in xrange(4)] 
```

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2008-12-09T11:50:39.380

要使用类的单独实例填充列表，可以在列表的声明中使用 for 循环。* multiply 会将每个副本链接到同一个实例。

```
instancelist = [ MyClass() for i in range(29)] 
```

然后通过列表的索引访问实例。

```
instancelist[5].attr1 = 'whamma' 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-12-07T23:06:58.737

正如有些人建议的那样，如果您只是使用它来根据其属性输出数据，则不必每次都重新创建 SimpleClass 对象。但是，您实际上并没有创建该类的实例。您只是在创建对类对象本身的引用。因此，您一遍又一遍地向列表中添加对相同类属性的引用（而不是实例属性）。

代替：

```
x = SimpleClass 
```

你需要：

```
x = SimpleClass() 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-07T22:22:32.600

每次创建一个新实例，每个新实例都有正确的状态，而不是不断修改同一个实例的状态。

或者，在每一步存储对象的显式副本（使用[此页面上](http://docs.python.org/library/copy.html)的提示），而不是原始副本。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-07T22:25:21.067

如果我正确理解您的问题，您会问一种方法来执行对象的深层副本。使用 copy.deepcopy 怎么样？

```
import copy

x = SimpleClass()

for count in range(0,4):
  y = copy.deepcopy(x)
  (...)
  y.attr1= '*Bob* '* count 
```

深拷贝是整个对象的递归拷贝。如需更多参考，您可以查看 python 文档：[https ://docs.python.org/2/library/copy.html](https://docs.python.org/2/library/copy.html)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2018-03-07T08:08:56.373

我认为这只是说明了您要实现的目标：

```
# coding: utf-8

class Class():
    count = 0
    names = []

    def __init__(self,name):
        self.number = Class.count
        self.name = name
        Class.count += 1
        Class.names.append(name)

l=[]
l.append(Class("uno"))
l.append(Class("duo"))
print l
print l[0].number, l[0].name
print l[1].number, l[1].name
print Class.count, Class.names 
```

运行上面的代码，你会得到：-

```
[<__main__.Class instance at 0x6311b2c>, 
<__main__.Class instance at 0x63117ec>]
0 uno
1 duo
2 ['uno', 'duo'] 
```

# c# - 自定义数字格式字符串以始终显示符号

> ID：348201
> 
> 赞同：210
> 
> 时间：2008-12-07T22:17:56.917
> 
> 标签：c#, .net, formatting, string-formatting

有什么方法可以指定标准或自定义数字格式字符串来始终输出符号，无论是 +ve 还是 -ve （虽然它应该为零，但我不确定！）

* * *

## 回答 #1

> 赞同：327
> 
> 时间：2008-12-07T22:40:09.210

是的你可以。有条件格式。请参阅[MSDN 中的条件格式](http://msdn.microsoft.com/en-us/library/0c899ak8.aspx)

例如：

```
string MyString = number.ToString("+0;-#"); 
```

其中以分号分隔的每个部分代表正数和负数

或者：

```
string MyString = number.ToString("+#;-#;0"); 
```

如果您不希望零带有加号。

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2009-02-17T13:46:03.667

请注意，当使用条件格式时，负值不会自动获得符号。你需要做

```
string MyString = number.ToString("+#;-#;0"); 
```

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2013-06-24T11:56:17.393

您还可以在 string.Format(); 中使用格式字符串；格式字符串用冒号 (':') 与索引分隔

```
var f = string.Format("{0}, Force sign {0:+#;-#;+0}, No sign for zero {0:+#;-#;0}", number); 
```

对于数字 { +1, -1, 0 }，这给出：

> 1, 强制符号 +1, 零无符号 +1
> -1, 强制符号 -1, 零无符号 -1
> 0, 强制符号 +0, 零无符号 0

您还可以使用插值字符串代替`string.Format`获得相同的结果：

```
var f = $"{number}, Force sign {number:+#;-#;+0}, No sign for zero {number:+#;-#;0}"; 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2015-08-13T12:42:12.800

与其他答案相反，如果您想获得 +1、-1、+0（对于参数 1、-1、0），您需要使用以下格式：

```
String.Format("{0:+#;-#;+0}", 0));  // output: +0 
```

或者

```
String.Format("{0:+0;-#}", 0));  // output: +0 
```

如果您只使用`+#;-#`它，它将仅显示`+`（不是`+0`）为 0。

**“#”自定义说明符**（位于[https://msdn.microsoft.com/en-us/library/0c899ak8.aspx](https://msdn.microsoft.com/en-us/library/0c899ak8.aspx)）

> 请注意，此说明符从不显示不是有效数字的零，即使零是字符串中的唯一数字。只有当它是正在显示的数字中的有效数字时，它才会显示零。

另外请记住，如果您需要任何小数精度，则需要像这样指定它：

```
String.Format("{0:+0.##;-#.##}", 0));  // output: +0 
```

或者，如果你不想总是出现零，就像这样：

```
String.Format("{0:+0.00;-#.00}", 0));  // output: +0.00 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-05-25T08:08:51.083

对于任何类型的数值表达式：

```
+###,###,###,###,###,###,###,###,###,##0.###,###,###,###,###,###,###,###,###,###;-###,###,###,###,###,###,###,###,###,##0.###,###,###,###,###,###,###,###,###,###;0 
```

三种情况使用三个部分：正；负；零

示例的其他方面：

*   零没有签名。您可以将其显示为任何内容，例如“零”。

*   小于 1 的绝对值在小数点前以 0 开头。调整口味。

*   位数是最大和最小的绝对十进制值。调整口味。

*   小数点字符是特定于文化的。.NET 替代品。

*   分组分隔符是可选的。这个角色是特定于文化的。.NET 替代品。（位置也是特定于文化的，但这仅由您的格式字符串控制。）您还可以使用除 Format 的特殊字符（包括 , . # 0）之外的任何其他字符。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-09-26T07:20:28.387

我无法发表评论，所以我在这里做一个答案（坚果声誉系统....）

您可以很好地使用 number.ToString("+0;-#") 来生成 UTC String TimeFormat

这里显示在 PowerShell 代码中

```
"$([System.DateTime]::Now.ToString('HH:mm:ss.fff'))$($([System.TimeZoneInfo]::Local.GetUtcOffset([System.DateTime]::Now).TotalMinutes.ToString('+0;-#')))" 
```

谢谢@gcores [https://stackoverflow.com/users/40256/gcores](https://stackoverflow.com/users/40256/gcores)

# internet-explorer - 不支持浏览器时显示消息

> ID：348202
> 
> 赞同：18
> 
> 时间：2008-12-07T22:17:58.490
> 
> 标签：internet-explorer, popup, cross-browser

我想警告使用我的站点的 Internet Explorer 6 用户，IE6 过去与我的站点存在严重的兼容性问题。做这个的最好方式是什么？

理想情况下，我希望出现一条消息（不是新窗口，而是一个消息框，如果可能的话），警告 IE6 用户这些问题并建议他们更新到 IE7、Firefox 3 或 Opera 9.5。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-12-07T22:23:12.130

定位 IE 的最佳方式是使用条件注释。然后，您可以添加一些仅在 Internet Explorer 中显示的特定 HTML。

```
<!--[if IE 6]>
<h1>Please upgrade your browser!</h1>
<![endif]--> 
```

更多关于这个主题：

[http://www.quirksmode.org/css/condcom.html](http://www.quirksmode.org/css/condcom.html)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-06T19:52:36.113

好的，我会让这件事变得简单。没有弹窗！一场统计灾难。这是一个很好的小东西，它位于 . 我真的只担心 IE 6 或更早版本，因为它是弄乱我的设计的最大罪魁祸首。下面是一个条件语句（我认为最好的方法）。

**把它放在头上（输入你想要的任何内容）：**

```
<!--[if lte IE 6]>
<div id="warning">
<h4 class="red">Your Browser Is Not Supported!</h4><br />
<p>Please upgrade to <a href='http://getfirefox.com'>FireFox</a>, <a href='http://www.opera.com/download/'>Opera</a>, <a href='http://www.apple.com/safari/'>Safari</a> or <a href='http://www.microsoft.com/windows/downloads/ie/getitnow.mspx'>Internet Explorer 7 or 8</a>. Thank You!&nbsp;&nbsp;&nbsp;<a href="#" onClick="document.getElementById('warning').style.display = 'none';"><b>Close Window</b></a></p>
</div>
<![endif]--> 
```

**将其粘贴在您的外部样式表中。*我不会使用内联样式*。**

```
#warning        {position:relative; top:0px; width:100%; height:40px; background-color:#fff; margin-top:0px; padding:4px; border-bottom:solid 4px #000066} 
```

随心所欲地设计它 - 发疯！您可以使用 javascript 非常具体地检测任何浏览器，因此如果您知道如何，它可以增加更大的特异性。

这将是一个非常小的盒子，位于您的内容之上，让您的用户看到他们的浏览器很糟糕。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-07T23:37:51.730

如果您想确定它是否支持浏览器以外的任何其他内容，您可能需要使用 jQuery 的浏览器检测，例如：

```
<script type="text/javascript">
// check if browser is IE6 (when IE) or not FF6 (when FF)
if (($.browser.msie && $.browser.version.substr(0,1) == '6')
    || ($.browser.mozilla && $.browser.version.substr(0,1) != '3')) {
        $('#browserWarning').show();
}
</script> 
```

**更新：**正如[不同](https://stackoverflow.com/questions/348202/display-a-message-when-a-browser-is-unsupported/348219#348219)所说，更好的选择是使用 IE if 语句，例如：

```
<style type="text/css">
/* this would probably be in a CSS file */
#browserWarning { display:none; }
</style>
<!--[if IE 6]>
<style type="text/css">
#browserWarning { display:; }
</style>
<![endif]--> 
```

此选项要好得多，因为它不需要浏览器版本“完美”。但是，如果您想检测其他浏览器，因为它们不支持 if 语句，这将不起作用。然后你可能想使用 jQuery 来检测浏览器，尽管我建议尽量避免使用它。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-07T22:23:43.893

[条件注释](http://www.quirksmode.org/css/condcom.html)提供了一种仅显示特定 Internet Explorer 版本的内容的方法。

```
<!--[if IE 6]>
Special instructions for IE 6 here
<![endif]--> 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-05-09T12:36:28.303

有一个名为*Push Up the Web*的项目建议所有用户升级到更新版本的浏览器。它不显眼且易于添加。

正如一些人建议的那样，最好的办法是使用条件注释来有效地定位 Internet Explorer。

对于其他评论者来说，随着 Internet Explorer 8 的发布（它有效地添加了两个额外的浏览器进行测试：标准 + 兼容模式），Internet Explorer 6 已经完成了它的进程。是时候让这些人升级浏览器了，在某些情况下升级操作系统/计算机。Internet Explorer 6[阻碍](http://a.deveria.com/caniuse/#agents=All&eras=All&cats=All&statuses=All "我什么时候可以使用___？")了网络的发展。这是支持资源的消耗。它已达到 Netscape 4 的状态。主要网站和公司也加入了这场战斗。

*   Gmail 要求 Internet Explorer 6 用户[升级以提高性能](http://www.bloginfor.com/2009/01/google-tells-gmail-ie6-users-to-switch-to-chrome-or-firefox/)
*   [37signals](http://37signals.blogs.com/products/2008/07/basecamp-phasin.html)放弃了对 Internet Explorer 6 的支持
*   Apple 的[MobileMe](http://www.me.com/unsupported_browser/en/)不支持 Internet Explorer 6
*   [挪威放弃支持](http://www.wired.com/epicenter/2009/02/norwegian-websi/)
*   [Facebook 聊天](http://theangryhedgehog.com/2008/04/25/facebook-chat-and-ie-6/)不支持 Internet Explorer 6
*   [Microsoft 将于2010 年 6 月](http://support.microsoft.com/gp/lifesupsps/#Internet_Explorer "curtain call")停止支持 Internet Explorer 6

更多阅读：

*   [http://www.bringdownie6.com/bring-down-ie-6.html](http://www.bringdownie6.com/bring-down-ie-6.html)
*   [http://ripie6.com/](http://ripie6.com/)
*   [http://ie6.forteller.net/](http://ie6.forteller.net/)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2015-10-26T23:00:01.303

[https://browser-update.org](https://browser-update.org)

> 网页设计师的一项倡议，旨在通知用户有关浏览器更新的信息

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-07T22:41:17.227

我的建议是不要使用弹出窗口或消息框。它们非常烦人，并导致糟糕的用户体验。最好在通知中插入一些`<div>`内容，使其从页面的其余部分中脱颖而出。不要过度使用它，只需为其分配一些颜色以确保它不会被忽视（并且请：不要使用`<blink>`;-)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-07T23:28:44.527

虽然告诉用户更新他们的浏览器并且他们实际上这样做会很棒，但它真的不会发生。如果用户现在还没有升级他们的浏览器，通常是有原因的，缺乏计算机知识或无法控制计算机本身。例如，员工在工作机器上浏览您的网站。

我真的认为您应该重新考虑解决用户将遇到的问题或考虑进行渐进式增强。这个想法是您网站的基本功能适用于每个浏览器，然后开发任何额外的功能，以便它仅在可以支持它的浏览器上可见/可用。

* * *

## 回答 #9

> 赞同：-6
> 
> 时间：2008-12-07T22:22:14.503

我的建议是修复您的网站 ;) 不认真，我会在页面顶部使用一个小横幅，就像 Firefox 和 IE 中不显眼的小对话框一样。不是消息框或实际上会干扰很多的东西。

# firefox - 基本的 Firefox 插件/扩展？

> ID：348210
> 
> 赞同：14
> 
> 时间：2008-12-07T22:21:45.923
> 
> 标签：firefox

与 webdev 相关的哪些 firefox 插件是你不能没有的？

我的清单是：

*   [数据库酒吧](https://addons.mozilla.org/en-US/firefox/addon/3227)
*   [DOM检查员](https://addons.mozilla.org/nl/firefox/addon/6622)
*   萤火虫
*   [火饼干](https://addons.mozilla.org/en-US/firefox/addon/6683)
*   谷歌工具栏（对 seo 有用）
*   实时 HTTP
*   [重新加载每个](https://addons.mozilla.org/nl/firefox/addon/115)
*   篡改数据
*   Web开发人员

不过，我一直在寻找新的，所以我想知道是否有人知道我可能错过的任何伟大的？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-07T22:22:28.717

[Firebug](http://getfirebug.com/)是我使用的主要工具。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-12-07T22:26:19.160

[Web Developer](https://addons.mozilla.org/sv-SE/firefox/addon/60)非常有用（[萤火虫](https://addons.mozilla.org/sv-SE/firefox/addon/1843)Andrew 提到无疑是 #1）

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-07T22:30:48.107

IETab 很不错（Firefox 标签中的 IE）

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-02-10T13:44:36.883

没有提到[Greasemonkey](https://addons.mozilla.org/en-US/firefox/addon/748)或 Mason？

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-07T22:29:52.070

[Live HTTP headers](https://addons.mozilla.org/en-US/firefox/addon/3829)，除了一些已经提到的。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-12-07T22:39:52.253

无脚本。不仅仅是为了阻止垃圾邮件 - 它比手动打开和关闭脚本设置要快得多，并且可以让您模拟第三方服务器的故障。

您还可以从 Firefox 的内置错误控制台（在“工具”菜单中）获得很多有用的信息——除此之外，它会指出损坏的 CSS 代码。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-12-07T23:25:20.803

[YSlow](https://addons.mozilla.org/en-US/firefox/addon/5369 "慢") - 分析网页并告诉你为什么它们很慢。

[MeasureIt](https://addons.mozilla.org/en-US/firefox/addon/539 "测量它") - 绘制标尺以获取网页上任何元素的像素宽度和高度。更好的是[Xray 小书签](http://www.westciv.com/xray/ "X射线")。

[Hackbar](https://addons.mozilla.org/en-US/firefox/addon/3899 "黑客栏")简单的安全审计/渗透测试工具。

[FirePHP](https://addons.mozilla.org/en-US/firefox/addon/6149 "FirePHP")是用于 AJAX 开发的 Firebug 扩展

[ColorZilla 2.0](https://addons.mozilla.org/en-US/firefox/addon/271 "ColorZilla")是一个先进的吸管、颜色选择器、页面缩放器和其他一些东西。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-12-07T22:26:45.587

[TestGen4Web](https://addons.mozilla.org/en-US/firefox/addon/1385) - 就像您的 VCR - 用于 Firefox。它会记录您所做的事情、存储并按需播放。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-12-07T22:38:12.850

[HTML Validator](https://addons.mozilla.org/en-US/firefox/addon/249)插件是无价的，尤其是当您正在处理由其他人编写的东西时，这些人可能对标准合规性不太小心......

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-12-07T22:27:03.060

Firebug、Web Developer 工具栏和 Firebug 的 YSlow 是我的一些选择。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-01-25T15:16:39.903

我（ab）使用[Stylish](https://addons.mozilla.org/en-US/firefox/addon/2108)来试验/原型 css 更改。是的，您可以在 Firebug 中执行此操作，但要跟踪您所做的所有编辑并不容易，而且将这些编辑复制并粘贴回您的 css 文件并不容易。此外，如果您按 F5，您将丢失在 Firebug 中所做的所有更改。

[时尚](https://addons.mozilla.org/en-US/firefox/addon/2108)在页面刷新后仍然存在，因为它只是文本，您可以简单地选择所有内容来复制和粘贴您的更改。当然，它不提供 css 检查器或 DOM 树视图，但这就是 Firebug 的用途。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-07T22:40:07.977

[ff-activex](http://code.google.com/p/ff-activex-host/) - 允许在 Firefox 中使用 active-x 插件

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-01-25T14:25:47.890

Besides the ones already mentioned (especially the marvellous [Firebug](http://www.getfirebug.com/)), these are the *development related* ones I've found very useful:

*   [JSONovich](https://addons.mozilla.org/en-US/firefox/addon/10122) does a good job at pretty-printing and colorizing JSON.
*   [User Agent Switcher](https://addons.mozilla.org/en-US/firefox/addon/59) is very handy for developing mobile web sites (or just for the sake of curiosity) -- "I'm an iPhone, reveal me your contents!"
*   Sometimes Firefox leaves stuff in the browser cache even on reloads. The [Clear Cache Button](https://addons.mozilla.org/en-US/firefox/addon/1801) helps with this.
*   [Header Spy](https://addons.mozilla.org/en-US/firefox/addon/4276) is similar to Live HTTP headers, but displays header information (and access to lots of more options) in the statusbar.

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-06-08T07:51:58.190

我用于开发的插件列表是：

*   [萤火虫](http://getfirebug.com/)
*   [海报](https://addons.mozilla.org/en-US/firefox/addon/2691/)
*   [HTML 验证器](https://addons.mozilla.org/en-US/firefox/addon/249/)
*   [Web开发人员](https://addons.mozilla.org/en-US/firefox/addon/60/)
*   [平格尔](https://addons.mozilla.org/en-US/firefox/addon/10201/)

我认为这些对于正确的 Web 开发至关重要。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-06-08T07:45:41.960

我觉得有趣的是，有这么多人命名了 Web Developer 工具栏为您提供的大量插件。虽然它们都是很棒的插件并且可能有几个额外的选项，但不确定拥有这些插件是否值得（例如，MeasureIt）

这是我的清单：
- **Web 开发人员工具栏**（如果您是 Web 开发人员 [期间]）
- **FireBug**（javascript/AJAX 调试必不可少）
- **Google Page Speed**（类似于 YSLOW 但它来自 Google，非常有用）
- **ColorZilla**（很棒的颜色选择器）
- **HTML Validator**（节省了加载 w3.org 页面的大量时间）
- **Tab Mix Plus**（与选项卡式浏览有关的任何事情）
- **Screengrab**（如果您使用屏幕截图，请使用它）- **Google 工具栏**（搜索引擎优化）

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-01-25T15:27:48.160

我经常使用的另一个是[Amazon S3 Firefox Organizer (S3Fox)](https://addons.mozilla.org/en-US/firefox/addon/3247)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2010-01-25T15:31:55.397

除了已经提到的那些之外，[Selenium IDE](http://seleniumhq.org/projects/ide/) .

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2010-01-25T14:20:12.997

除了已经提到的插件：

*   [ViewState](https://addons.mozilla.org/cs/firefox/addon/5956) - 在状态栏中显示当前 ASP.NET 页面视图状态大小。
*   [ColorZilla](http://www.colorzilla.com/firefox/) - 用于 Firefox 的高级吸管、颜色选择器、调色板查看器和其他丰富多彩的好东西

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-02-13T00:24:29.893

萤火虫是最伟大的。

此外，它不是开发工具，但我发现它非常有用且易于使用，[Foxmarks](http://foxmarks.com)书签管理器。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2010-03-08T14:31:42.957

除了 firebug 和其他已经提到的之外，我最近发现[Venkman](http://www.mozilla.org/projects/venkman/)很有用。

> Venkman 旨在为基于 Gecko 的浏览器提供强大的 JavaScript 调试环境...

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-10-19T21:09:29.043

我使用的另外两个是...

1.  搜索状态（SEO 相关）[http://www.quirk.biz/searchstatus/](http://www.quirk.biz/searchstatus/)
2.  Ad Block Plus（阻止广告）[http://adblockplus.org/en/](http://adblockplus.org/en/)

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2008-12-07T22:26:55.603

*   Web开发人员
*   萤火虫
*   可口的

可能还会添加页面验证器

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2009-10-19T21:22:24.883

很多我最喜欢的都被提到了。对于这些，我要补充：

*   Adblock Plus：删除广告
*   添加艺术：用艺术代替广告
*   自动复制：选择时复制到剪贴板
*   树型选项卡：像树一样显示选项卡

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2009-12-31T09:40:23.030

我最喜欢的一些已经提到过，

*   TabKit - 在单独的面板中显示选项卡，按组关闭选项卡，对选项卡进行分组。

*   早间咖啡 - 恢复已保存的选项卡以供以后查看。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2009-12-31T10:18:22.297

1.  [撤消关闭的标签](https://addons.mozilla.org/en-US/firefox/addon/3082)。这是我从 IE8 中错过的。
2.  [FEBE](https://addons.mozilla.org/en-US/firefox/addon/2109)，用于备份 Mozilla 的设置。

# java - 使用 JNI 检索 Outlook 联系人

> ID：348216
> 
> 赞同：2
> 
> 时间：2008-12-07T22:22:53.863
> 
> 标签：java, outlook, java-native-interface

我需要从除 Outlook Express 之外的任何 Outlook 应用程序中检索联系人列表（并且只有他们）。我见过许多不同的库可以解决我的问题，但其中任何一个都是开源的。我想知道是否值得使用 JNI 从头开始​​解决这个问题。我从未使用过这个框架进行开发；你有这方面的经验吗？或者你知道更好的方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-07T22:48:48.477

如果可以，请避免使用 JNI。它增加了复杂性，内存损坏的可能性（如果你做错了）并使调试更加复杂。

此外，除此之外还有很多选择。

首先，如果您正在与 Exchange 2007 服务器通信，您可以通过[Web 服务](http://msdn.microsoft.com/en-us/library/bb204119.aspx)获取此信息。

如果您特别想访问它的 Outlook，请查看[Sun Java System Connector for Microsoft Outlook](http://www.sun.com/software/products/calendar_srvr/connector/index.xml)，[在此处](http://www.sun.com/download/products.xml?id=4019aa76)下载。

# javascript - Javascript鼠标位置

> ID：348223
> 
> 赞同：2
> 
> 时间：2008-12-07T22:25:54.793
> 
> 标签：javascript, menu, drop-down-menu

如何检查鼠标指针是否在另一个 div/id/a 中/上？

```
^a href="#" onmouseover="showmenu('top_3_menu_1_1')">Option One</a> 

function showmenu(elmnt)
{
document.getElementById(elmnt).style.visibility="visible";
}

function hidemenu(elmnt)
{
if  mouse pointer is not in location A or B do something
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-07T22:44:39.560

[在这个博客](http://ra-ajax.org/ra-ajax-0-8-5-released-rock-steady.blog)上稍微向下（向下滚动）有一个如何实现 MouseEnter/MouseLeave 跨浏览器的实现。如果没有这个，那么由于“事件冒泡”，您将在 MouseOver/Out 上得到误报，这意味着您对 mouseover/out 的捕获将*失败*......！

但是，如果您在 MouseOver/Out 中实现上述检查，您将有一个完美的有效起点，可以在事件处理程序中设置某种标志，这使您可以在套利时检查这些标志以查看鼠标是否“结束或出”特定的 DOM 元素...

此外，您的“菜单隐藏/显示”主要适用于上述检查，但是如果您只想显示和隐藏，则存在完全有效的纯 CSS 解决方案；）

（谷歌为他们）

# javascript - 如何减少客户端和服务器之间的视图重复？

> ID：348236
> 
> 赞同：3
> 
> 时间：2008-12-07T22:32:25.670
> 
> 标签：javascript, ruby-on-rails, ajax, model-view-controller

我正在做一个 AJAXy 项目（Dojo 和 Rails，如果细节很重要的话）。有几个地方用户应该能够对结果进行排序、分组和过滤。还有一些地方，用户填写简短表格，然后将生成的项目添加到同一页面上的列表中。

非 AJAXy 实现工作得很好——视图层服务器端已经知道如何渲染这些东西，所以它可以以不同的顺序或使用额外的元素再次渲染。然而，这给服务器增加了很多负担。

所以我们切换到从服务器发送 JSON 并在客户端进行大量（重新）渲染。缺点是现在我们有重复的代码来渲染每个页面：一次在 Rails 中，这是为此而构建的，一次在 Dojo 中，但不是。后者基本上只是字符串连接。

所以问题第一部分：有没有一个好的 Javascript MVC 框架我们可以用来使客户端的渲染更易于维护？

问题第二部分：有没有办法从同一个模板生成 Javascript 中的客户端视图和 ERB 中的服务器端视图？我认为这就是实用程序员会做的事情。

或者，问题第三部分：我是否完全错过了另一个角度？也许从服务器发送 JSON，但也包括 HTML 片段作为属性，以便 Javascript 可以进行过滤、排序等，然后插入给定的片段？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T02:48:04.453

好吧，每次您在客户端和服务器上生成 HTML 片段时，您最终都可能会得到重复的代码。一般没有什么好的办法。但是你可以做两件事：

1.  在服务器上生成所有内容。当您需要动态生成 HTML 片段时，请使用[AHAH 。](http://en.wikipedia.org/wiki/Ahah)`innerHTML`基本上，您要求服务器生成一个 HTML 片段，异步接收它，然后使用或任何其他类似机制将其插入到位。
2.  在客户端上生成所有内容（AKA 胖客户端范例）。在这种情况下，即使对于初始渲染，您也传递数据而不是预渲染 HTML，并使用 JavaScript 在客户端处理数据以生成 HTML。根据情况，您可以使用数据岛技术，或异步请求数据。变体：使用[JSONP](http://en.wikipedia.org/wiki/JSONP#JSONP)将其包含为 <script>以便浏览器在加载页面时向您发出请求。

这两种方法都非常简单，并且具有不同的优缺点。有时可以将这两种技术结合在一个 Web 应用程序中以处理不同部分的数据。

当然，您可以寻求奇特的解决方案，例如使用一些基于 JavaScript 的服务器端框架。在这种情况下，您可以在服务器和客户端之间共享代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T02:51:18.470

我没有完整的答案给你；在最近的一个项目中，我也为此苦苦挣扎。但是，这里有一个想法：

*   对 Rails 的 Ajax 调用
*   Rails 用新行再次组成了整个网格。
*   Rails 将 HTML 序列化，然后返回给浏览器。
*   Javascript 用新的 HTML 替换了整个网格元素。

*注意：我不是 Rails 人，所以我不确定这些位是否合适。*

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T03:38:30.107

有没有人尝试过类似以下的事情？现在有冗余数据，但是所有的渲染都是在服务器端完成的，所有的交互都是在客户端完成的。

服务器端：

```
render_table_initially:
  if nojs:
    render big_html_table
  else:
    render empty_table_with_callback_to_load_table

load_table:
  render '{ rows: [
    { foo: "a", bar: "b", renderedHTML: "<tr><td>...</td></tr>" },
    { foo: "c", bar: "d", renderedHTML: "<tr><td>...</td></tr>" },
    ...
  ]}' 
```

客户端：

```
dojo.xhrGet({
  url: '/load_table',
  handleAs: 'json',
  load: function(response) {
    dojo.global.all_available_data = response;
    dojo.each(response.rows, function(row) {
      insert_row(row.renderedHTML);
    }
  }
}); 
```

存储`all_available_data`允许您在不访问服务器的情况下进行排序、过滤、分组等。

我只是谨慎，因为我从未听说过这样做。似乎有一个反模式潜伏在那里......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T17:35:40.463

*“也许从服务器发送 JSON，但也包括 HTML 片段作为属性，以便 Javascript 可以进行过滤、排序等，然后插入给定的片段？”*

我建议将表示层保留在客户端上，并根据需要简单地下载数据。

对于基本的模板引擎，您可以扩展 Prototype 的 Template 构造： http: [//www.prototypejs.org/api/template](http://www.prototypejs.org/api/template)

随着您的客户端扩展并且您需要一个丰富而灵活的 MVC，请尝试使用 PureMVC。 [http://puremvc.org/content/view/102/181/](http://puremvc.org/content/view/102/181/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T06:35:44.350

与常规服务器端编程一样，您应该努力用控件封装您的实体，在您的情况下，客户端控件具有数据属性并且还呈现方法+事件。

例如，假设您在页面上有一个显示员工树的区域，实际上您应该将其行为封装在客户端类中，该类可以获取员工列表的 JSON 对象/默认情况下连接到服务和渲染方法渲染输出、事件等。

在[ExtJS](http://extjs.com)中创建这类控件相对容易——请看[这篇文章](http://extjs.com/learn/Manual:Component:Extending_Ext_Components)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-11T10:36:38.140

也许我没有完全理解您的问题，但这就是我将如何解决您的要求：

# 排序、过滤

它可以在 JavaScript 中完成，无需访问服务器。这是一个操作表格行，移动行排序，隐藏行过滤的问题，不需要重新渲染。您需要使用自定义属性或额外的类名来标记具有数据类型的列，以便能够解析数字或日期。

如果您的报告是分页的，我认为刷新整个表格或页面会更容易和更好。

# 团体

我在这里帮不上忙，因为我不明白您将如何启用分组。您是否正在切换列以显示累积？你如何显示不支持累积的数据，如文本或日期？

# 新物品

这次我将使用带有 JSON 响应的 AJAX 来确认新项目已正确保存并且可能带有计算数据。

为了将新项目添加到结果表中，我将克隆一行并更改值。同样，我们不需要在客户端渲染任何东西。上次我需要这样的东西时，我在结果的末尾添加了一个空的隐藏行，这样无论结果是否为空，您都将始终有一行要克隆。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-23T19:07:01.580

在我[列出的五种 AJAX 样式列表中，](https://stackoverflow.com/questions/429005/how-dangerous-is-it-send-html-in-ajax-as-opposed-to-sending-json-and-building-the#429072)排名第 5 的效果往往很好。

# function - 给定底坐标和高坐标，求等腰三角形的最后一个坐标

> ID：348249
> 
> 赞同：2
> 
> 时间：2008-12-07T22:43:22.060
> 
> 标签：function, geometry

我对三角学一无所知，尽管早在学校就学过三角学，而且我认为这应该很简单，但是在网上浏览大量三角学东西会让我头疼:)所以也许有人可以帮助我...

标题准确地解释了我想要做什么，我有一条线：x1,y1 和 x2,y2 并且想要一个函数来找到 x3,y3 以在给定高度的情况下完成一个等腰三角形。

为了清楚起见，线 x1,y2 -> x2,y2 将是基础，它不会与任何轴对齐（它将以随机角度..）

有没有人有一个简单的功能？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-07T22:55:18.430

构造向量 (x1,y1)->(x2,y2) 的法线。将它放在中点 ((x1+x2)/2,(y1+y2)/2) 并走出一段距离 h。

法线看起来像（-（y2-y1），x2-x1）。将其设为单位向量（[http://en.wikipedia.org/wiki/Unit_vector](http://en.wikipedia.org/wiki/Unit_vector)）。

将 h 乘以这个单位向量到中点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-07T22:51:14.820

第三个点在你的底边的垂直平分线上，与`altitude`这条线相距单位。

1.  通过平均 x 和 y 坐标来计算底的中点。
2.  计算海拔的斜率：-dx/dy（垂直于 dy/dx）。你现在有了你的线（点和斜率）。
    *   y - 我的 = -dx/dy * (x - mx)
3.  在距离公式中替换您的变量：d = sqrt(dx^2 + dy^2)
    1.  d = sqrt((x - mx)^2 + (y - my)^2)
    2.  d = sqrt((x - mx)^2 + (-dx/dy * (x - mx))^2)
    3.  d^2 = (x - mx)^2 + (-dx/dy * (x - mx))^2
    4.  d^2 - (x - mx)^2 = (-dx/dy * (x - mx))^2
    5.  ±sqrt(d^2 - (x - mx)^2) = -dx/dy * (x - mx)
    6.  ±sqrt(d^2 - (x - mx)^2) * dy/dx = x - mx
    7.  ±sqrt(d^2 - (x - mx)^2) * dy/dx + mx = x
    8.  x = ±sqrt(d^2 - (x - mx)^2) * dy/dx + mx
4.  使用您的线方程（来自＃2）计算另一个变量（此处为 y）。
5.  你现在有两点；选择你想要的...

在伪代码中：

```
dx = x1 - x2
midpoint = ((x1 + x2) / 2, (y1 + y2) / 2)
slope = -dx / (y1 - y2)
x = sqrt(altitude*altitude - dx*dx) / slope + midpoint.x
y = slope * (x - midpoint.x) + midpoint.y 
```

这可能不是最理想的方法。不确定它是否有效。xD

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-07T22:53:08.980

我记得的是，等腰三角形的边长相等，底角相等。如果你有高度，那么你就有最终坐标，因为这将是交点，对吧？

# model-view-controller - 你有用于 MVC 的建模符号吗？

> ID：348251
> 
> 赞同：0
> 
> 时间：2008-12-07T22:48:32.843
> 
> 标签：model-view-controller, modeling, notation

希望（但不一定）一个独立于语言或框架的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-07T22:57:43.763

我使用我自己设计的一个简单的：

*   模型的正方形（M 是方形字母） - 正方形也看起来像桌子
*   控制器的圆圈（C 是一个圆形字母） - 圆圈表示控制器用于“流”，它们将模型和视图粘合在一起
*   视图的三角形，点在底部（V 是三角形字母）

这是在我做 Visio 类型图表时使用的。这个简单的助记符让它很容易记住。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-07T23:04:48.710

有一个简单的模型：[http ://en.wikipedia.org/wiki/Model-view-controller](http://en.wikipedia.org/wiki/Model-view-controller)

您可以在此处找到模型的 uml 图并查看：http: [//www.dofactory.com/Patterns/PatternObserver.aspx](http://www.dofactory.com/Patterns/PatternObserver.aspx)。控制器有时在 gui 中。

mvc 有一些风格：[http](http://en.wikipedia.org/wiki/Presentation-abstraction-control) ://en.wikipedia.org/wiki/Presentation-abstraction-control，http : [//en.wikipedia.org/wiki/Model_View_Presenter](http://en.wikipedia.org/wiki/Model_View_Presenter)

# web-applications - 缺乏创意：新的网络应用建议

> ID：348252
> 
> 赞同：3
> 
> 时间：2008-12-07T22:48:38.383
> 
> 标签：web-applications

你知道，有时你会遇到下一个爱好编程项目的想法，然后......你在 StackOverflow 上寻求帮助 :)

那么：对于在 20 或 30 天的空闲时间开发一个摇摆不定的 Web 应用程序（它可以使用[Google App Engine](http://code.google.com/appengine/)实现，并且可以使用新的[Google 朋友群API），您有什么建议？](http://www.google.com/friendconnect/)

任何建设性和创造性的建议都受到热烈赞赏。
谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-07T23:01:07.577

为什么不使用这些技术加入现有的开源项目呢？在我看来，这是学习新东西和养成好习惯的好方法:-)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T18:40:23.047

我目前的开源之痒是：

*   iwantsandy 替代方案 - 通过 Twitter、SMS 和电子邮件的个人助理机器人。
*   通过 https 提供我的音乐收藏。必须包括播放列表。必须与 iTunes 或我选择的任何其他东西同步。

它必须是一个网络项目吗？

学习更多新语言：

*   Scala——名列前茅
*   Python

了解更多理论：

*   计算机程序视频的结构和解释。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-08T12:16:37.783

跟踪过敏的应用程序（症状、计数器指标、食物清单和您可以实际购买此类食物的地方）。

棘手的部分是允许用户在不将自己的健康暴露给世界的情况下过滤数据。我在考虑一个客户端 CSS 文件，它隐藏了不相关的网站部分，以及不跟踪页面访问和/或 IP 地址的严格政策。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-08T12:19:07.403

StackOverflow的**自动页面刷新器**:)

..在观看新条目等时会非常有用

# regex - 正则表达式多次匹配代码块

> ID：348256
> 
> 赞同：4
> 
> 时间：2008-12-07T22:50:50.360
> 
> 标签：regex

*我想在一个文件中多次*匹配一段代码，但无法计算出正则表达式来执行此操作。代码块的一个例子是：

```
//@debug
...
// code in here
...
//@end-debug (possibly more comments here on same line) 
```

我尝试匹配的每个代码块都将从`//@debug`包含的行的末尾开始并停止`//@end-debug`

我现在有这个：

```
/(\/{2}\@debug)(.|\s)*(\/{2}\@end-debug).*/ 
```

`//@debug`但这与文件中从第一个一直到最后一行的末尾的一个大块匹配`//@end-debug`。

有任何想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-07T22:57:07.053

基本上你的正则表达式是贪婪的。这意味着通配符运算符尽可能多地获取您所看到的结果。只需在适当的地方将其更改为非贪婪即可。在你的情况下使用：

/(/{2}\@debug)(.|\s)*?(/{2}\@end-debug).*/

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-07T23:24:37.093

您也不必使用该`(.|\s)`hack，但正确执行此操作的语法取决于您使用的语言或工具。在 Perl 或 Javascript 中，您可以这样做：

```
/\/\/@debug.*?^\/\/@end-debug[^\r\n]*/sg 
```

`/s`修饰符让点匹配回车符和换行符，从而生成更易于阅读和更高效的正则表达式。这也意味着我必须将第二个更改`.*`为`[^\r\n]*`，但这是值得的。修饰符是让正`/g`则表达式匹配多次（即“全局”）的原因。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-07T22:53:28.670

什么语言？python 正则表达式（我猜它们是 == 到 perl5 正则表达式）具有“贪婪”与“非贪婪”正则表达式的概念，您可以通过某处的标志来控制它。

[在这个页面](http://docs.python.org/dev/howto/regex.html)上搜索“greedy vs non-greedy” ，[这个页面](http://gnosis.cx/publish/programming/regular_expressions.html)可能会更好

> 非贪心量词与常规贪心量词具有相同的语法，除了量词后跟问号。例如，非贪婪模式可能如下所示：“/A[AZ]*?B/”。在英语中，这意味着“匹配一个 A，后跟找到 B 所需数量的大写字母”。

# javascript - 最快的 javascript 页面搜索

> ID：348260
> 
> 赞同：0
> 
> 时间：2008-12-07T22:53:16.580
> 
> 标签：javascript, firefox, search, performance

我正在写一个 Firefox 扩展。我想在当前网页中搜索一组单词，并计算每个单词出现的次数。此活动仅在用户要求时执行，但仍必须合理快速地发生。

我目前在 BODY 标记的 innerHTML 元素上使用 indexOf，但发现它太慢而无法以下列方式重复运行：

```
function wordcount(doc, match)
{
  var count = 0;
  var pos = 0;
  for(;;)
  {
    len=doc.indexOf(match, pos);
    if(len == -1)
    {
      break;
    }
    pos = len + match.length;
    count++;
  }
  return count;
}

var html = content.document.body.innerHTML.toLowerCase()

for(var i=0; i<keywords.length; i++)
{
  var kw = keywords[i];
  myDump(kw + ": " + wordcount(html, kw));
} 
```

使用 100 个关键字，这大约需要 10 到 20 秒才能运行。有一些减少关键字数量的空间，但它仍然需要运行得更快。

有没有更明显的方法来做到这一点？最有效的方法是什么？我有一些想法，但我不愿意在不了解我可以预期的性能的情况下编写每个代码：

*   导航 DOM 而不是使用 innerHTML。这可能会更快还是更慢？它的好处是只搜索文本内容。
*   逐个单词循环遍历文档，同时累积每个单词出现的计数。使用这种方法，我将不得不做更多的工作来解析 HTML。

*编辑：原来最慢的部分是 myDump 函数写入错误控制台。呸！尽管如此，已经提出了一些有趣的更有效的替代方案，我打算使用它们。*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-08T07:18:51.457

我在 tvanfosson 建议的原型哈希中找不到 hasItem、setItem 或 getItem，但使用 set 和 get 并基于 get 编写了一个 hasItem。但是分析表明，与 javascript 的原生对象相比，使用原型 Hash 更慢。

如果你有一个带关键字的数组，将其转换为以关键字为键、值为 0 的散列对象：

```
function prepareCount(words) {
    var result = {};
    for (var i=0,len=words.length; i < len; i++) {
        result[words[i]] = 0;
    }
    return result;
} 
```

您可以使用函数作为参数来替换，而不是拆分字符串并使用 for 语句遍历它。在我做的测试中，这要快得多。在正则表达式中，我选择匹配除空白以外的所有内容。您可能想要添加其他分隔符，如括号、逗号、点和破折号等，或者如果您知道文本仅为 ASCII，则可以使用 az 代替。

```
function countKeywords(text,wordcount) {
    text.replace(/[^\s]+/g,function(s) {
    if (wordcount[s]!==undefined) { ++wordcount[s];}
        return "";
    });
    return wordcount;
} 
```

要使用它：

```
var wordcount = countKeywords(document.documentElement.textContent.toLowerCase(),prepareCount(["my","key","words"])); 
```

**更新：**

使用此正则表达式排除 ASCII 中的所有分隔符，但下划线（允许非 ASCII 字符）：

```
/[^\s\x00-\x2F\x3A-\x40\x5B-\x5E\x60\x7B-\x7F]+/g 
```

如果您知道带有关键字的文本仅为 ASCII，则可以改用：/[az]+

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-07T23:22:38.003

我会选择文档中的所有文本节点，遍历它们（在空格上拆分内容），并为遇到的每个单词增加一个计数器。使用关键字/计数的散列来加速关键字查找以增加增量。

```
var keywords = new Hash();  // from prototype or use your own

function traverseNode( node ) {
    if (node.nodeName == '#text') {
       indexNode( node );
    }
    else {
       for (var i = 0, len node.ChildNodes.length; i < len; ++i) {
           traverse( node.childNodes[i] );
       }
    }
}

function indexNode( node ) {
    var words = node.NodeValue.split( /\s/ );
    for (var i = 0, len = words.length; i < len; ++i) {
        if (keywords.hasItem( words[i]) ) {
           keywords.setItem( words[i], keywords.getItem(words[i]) + 1 );
        }
        else {
           keywords.setItem( words[i], 1 );
        }
    }
}

traverseNode( document.body ); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-08T00:55:33.307

我不确定它是否是最快的，但以下对我来说工作得很快。

```
var words = document.body.innerHTML.replace(/<.*?>/g,'').split(/\s+/);
var i = words.length;
var keywordCounts = {'keyword': 0, 'javascript': 0, 'today': 0};
var keywords = [];
var keywordMatcher = '';
var word;
for (word in keywordCounts) {
    keywords[keywords.length] = word ;
    keywordMatcher = keywordMatcher + '(' + word + ')?';
}
var regex = new RegExp(keywordMatcher);
var j = keywords.length;
var matched, keyword;
if (i && j) {
    do {
        i = i - 1;
        matched = words[i].match(regex);
        if (!matched) continue;
        j = keywords.length;
        do {
            j = j - 1;
            if (matched[j + 1]) {
                keyword = keywords[j];
                keywordCounts[keyword] = keywordCounts[keyword] + 1;
            }
        } while (j);
    } while (i);
} 
```

我肯定会承认，从 Big(O) 的角度来看，它不是最好的，因为随着 i 和 j 变大，它仍然需要 n 平方时间，但我发现正则表达式处理通常非常快。

基本上，我采用 tvanfosson 的想法并对其进行扩展，但不是遍历 DOM，而是使用正则表达式（第一行）删除标签，然后将页面拆分为单个单词。关键字“hash”在第三行定义了初始计数（显然它们都应该从零开始）。从那里我使用每个关键字作为一个组构造了一个新的正则表达式，因此当匹配时它返回一个结果数组，该数组具有（在我的示例中）[fullMatch，keywordMatch，javascriptMatch，todayMatch]。我正在使用递减 do while 循环，因为它们在很多地方都被证明是 JavaScript 中最快的循环结构，并且因为单词被处理的顺序并不重要，循环速度确实是唯一的考虑因素。

我希望这是有帮助的，如果不是，这至少是一个有趣的练习。:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-07T23:48:15.830

手动遍历 DOM 的替代方法是`textContent`使用`innerHTML`. 缺点是您无法过滤掉您可能不想搜索的脚本或其他元素。

无论哪种方式，我都会将文本拆分为@tvanfosson 的答案之类的单词，尽管根据您定义单词的方式，您可能需要拆分除空格之外的其他内容。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-10-01T13:15:14.200

node.nodeType 应该也可以工作，并且可能会更快一些，因为它是整数。值 3 用于文本节点。

# perl - 如何将 2 个或更多纹理贴图应用于 gluSphere OpenGL 对象？

> ID：348266
> 
> 赞同：4
> 
> 时间：2008-12-07T22:57:20.360
> 
> 标签：perl, opengl, textures

我正在编写一个基本的行星查看器 OpenGL Perl 应用程序，只是为了好玩。我有基本的工作，与光荣的星球，通过`gluSphere()`应用经典地球纹理贴图的旋转实现。

现在，如果我想通过 OpenGL 应用第二个纹理贴图（比如“地球云”）怎么办？

当然，我可以自己在 PhotoShop 或其他图形应用程序中混合这两个纹理贴图，但是有没有通过 OpenGL API 的方法？

我尝试加载两个纹理并生成 mipmap，但显示的星球只应用了第一个纹理，而不是第二个。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-08T02:50:42.373

您希望如何组合纹理？如果你简单地使用多重纹理，你应该能够得到你想要的效果：

```
glEnable(GL_TEXTURE_2D);

glActiveTexture(GL_TEXTURE0);
glBindTexture(GL_TEXTURE_2D, texture0ID);
glTexEnvf(GL_TEXTURE_ENV, ..., ...);

glActiveTexture(GL_TEXTURE1);
glBindTexture(GL_TEXTURE_2D, texture1ID);
glTexEnvf(GL_TEXTURE_ENV, ..., ...); 
```

请务必根据您希望如何组合纹理来设置 glTexEnvf 调用。然后调用 gluSphere()。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-08T04:06:32.517

正如 Jim Buck 所说，您可以通过多重纹理获得所需的效果。

但是，我认为 GLU 二次曲线不支持多纹理坐标生成（即使用 glMultiTexCoord*() 与 glTexCoord*()。所以，我认为您需要自己的球体代码来执行多纹理路线。

或者，您可能能够在当前具有第二个纹理贴图的当前球体周围绘制一个稍大的球体（适当使用 Alpha 通道和混合）。不过，这可能会导致 z-fighting，因此它可能比它的价值更麻烦。

编写自己的球体代码并不难——这可能是获得满意结果的最简单途径。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-11T12:25:35.033

我同意德鲁霍尔的观点。制作第二个球体可能更简单。并不是所有的 opengl 卡都支持多纹理。

您可以使用 glPolygonOffset 对抗 z-fighting。

# vba - 创建一个可变大小的组以在 Excel 2003 中循环的好方法是什么？

> ID：348268
> 
> 赞同：0
> 
> 时间：2008-12-07T22:58:31.607
> 
> 标签：vba, loops, excel, excel-2003

我有一个针对很多项目运行的程序，跳过某些不符合标准的项目。但是，然后我回去为一些在第一遍中错过的人运行它。我目前通过手动为每个人重新运行该过程来做到这一点，但理想情况下，我希望有一个更轻松的解决方案。

我的老板建议可能有效的方法是创建一个包含相关项目名称的列表（如在数据 -> 列表中），然后遍历该列表。可悲的是，我的帮助文件 fu 似乎让我失望了——我不知道我是否只是不知道要寻找什么，或者是什么。

运行“生成宏”命令显示首先创建列表的 VBA 是沿着 ActiveSheet.ListObjects.Add(xlSrcRange, Range("$A$1"), , xlYes).Name = "List1"

不幸的是，我似乎无法弄清楚如何处理结果列表。我正在寻找沿线的循环

```
For Each ListItem in List 
    Run the procedure on the text in ListItem.Value
Next ListItem 
```

有什么建议么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-07T23:55:34.910

也许在这些方面有一些东西：

```
Dim Counter 'module level '

Sub RunSomeProc()
    Counter = 0
    '1st test '
    SomeProc

    '2nd Test skipped items'
    For Each c In Range("c1:c" & Counter)
        SomeProc
    Next

End Sub

Sub SomeProc()
For Each c In Range("NamedRange1")
    If SomeTest=SomeVal Then
        'Write to 2nd test range '
        Range("C1").Offset(Counter, 0) = c 'Value of cell'
        Counter = Counter + 1
    End If
Next
End Sub 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-07T23:35:27.837

您可以通过以下方式对其进行迭代：

```
设置 rgList = Range("name_of_range")    
对于 i = 1 到 rgList.Rows.Count
  ' 使用 rgList.Cells(i, 1) 做一些事情
  RunProcedure(rgList.Cells(i, 1))
接下来我

```

我在这里假设范围在列上；如果它是连续的，你应该在第二个索引上完成迭代。
当然，可能有更好的方法来迭代一个范围；我在一个小脚本上使用这个，并且工作得很好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-03T00:08:12.917

我最终的解决方案是将列表作为外部数据查询导入，然后我很好地命名并作为范围引用。所以：

```
For each item in Sheets("Sheet1").Range("Range1")
    Do stuff
Next item 
```

# version-control - 有史以来最简单的源代码控制 - 你用什么？

> ID：348272
> 
> 赞同：6
> 
> 时间：2008-12-07T23:02:20.930
> 
> 标签：version-control

我正在做一个单独的项目，自己编写所有代码，因此不需要协作，

但是，我确实需要以下功能：

1.  签入带有评论的当前版本
2.  为版本分配标签
3.  使用标签/标签检索版本
4.  未托管（意味着我将存储库保存在本地计算机上）
5.  免费/开源
6.  有一个漂亮的 GUI，而不是命令行？

我认为 SVN 是一个不错的选择，但对我来说似乎有点矫枉过正。有人遇到过这样的事情吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-07T23:06:01.280

我不认为 svn 对你正在做的事情来说太过分了。设置本地存储库非常简单。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-12-07T23:08:26.283

[Git](http://git.or.cz/)满足您列出的所有要求。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-07T23:12:02.173

为什么颠覆是一种矫枉过正？一分钟安装服务器和TortoiseSVN，零配置。

如果你想控制你的源代码，从一开始就做对，不要重新发明轮子。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-07T23:19:24.997

看看[集市](http://bazaar-vcs.org)。这是一个版本控制系统，适用于人类！它得到了为人类开发 Linux 的 Ubuntu 人员的支持。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-07T23:19:28.257

我经常使用 Subversion，设置个人使用并不难 - 但其他选项要简单得多！

例如，尝试[Bazaar](http://bazaar-vcs.org/)、[Mercurial](http://www.selenic.com/mercurial/wiki/)或[Git](http://git.or.cz/)。使用其中任何一个，设置本地存储库都是*微不足道的。*

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-07T23:22:02.980

git、mercurial、bzr、svn ......这个[名单](http://en.wikipedia.org/wiki/Comparison_of_revision_control_software)还在继续。

真的，只要选择一个，你就可以开始了。我从命令行进行所有源代码控制，但其中许多/大多数都有不错的 gui。祝你好运。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-07T23:04:45.900

Perforce 最多可供 2 位用户免费使用。在那之后，你付钱——但如果你知道你永远不需要更多，它是一个非常强大的产品，具有出色的 GUI 和 IDE 集成。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-07T23:19:45.417

[[USB] 记忆棒上的 Subversion](http://dotnet.org.za/trumpi/archive/2006/12/13/Subversion-on-a-stick.aspx)怎么样？当我需要进行源代码控制但又不想担心多用户时，我会使用它。您还可以使用[TortoiseSVN](http://tortoisesvn.tigris.org/)访问存储库。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-08T11:32:32.740

您可以使用 Subversion，而无需安装服务器。

只需下载 TortoiseSVN 并在您喜欢的文件夹中创建一个本地存储库。使用同一个客户端进行更新、提交...

有关链接和相关答案，请参阅我以前[的帖子](https://stackoverflow.com/questions/218507/suggestions-please-for-a-home-version-control-system#218665)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-07T23:05:38.363

如果您的本地机器上有 sql server（以任何方式、形状或形式），那么我可以推荐 sourcevault ......它对单用户免费，并且很好地模拟了 sourcesafe 界面（很多人都熟悉） ...

还附带了一个不错的工具集。

[http://sourcegear.com/](http://sourcegear.com/)

编辑：完全不相关，但仍然很有趣......我非常讨厌 SourceGear 的虫子！;) 在 SourceVault 出现之前，我正在研究 SourceSafe 的替代品......就像他们的产品......（这就是我的网站/公司的“蜂巢”名称的来源......但虫子打败了我对它... C'est la vie！

无论如何，尽管他们打败了我，但 SourceGear Vault 实际上是一款很棒的软件，而且他们的新 Fortress（也集成了错误跟踪和测试）看起来也不错。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-08T00:29:49.643

正如其他人所提到的，使用分布式 VCS（例如[mercurial](http://www.selenic.com/mercurial/wiki/)、[git](http://git.or.cz)或[bazaar](http://bazaar-vcs.org/)）是进行简单设置的方法。无论设置服务器多么容易，您都无法*完全不必*设置服务器。

我通常使用 mercurial，这就是我要描述的内容，但各种 DVCS 都很容易上手。从命令行使用它相当简单，但是由于您正在寻找一个 gui 界面，因此显而易见的候选者是[TortoiseHg](http://tortoisehg.wiki.sourceforge.net/)。这与 TortoiseSVN 的操作非常相似——它与资源管理器集成并为您提供各种菜单条目。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-12-12T09:35:31.257

设置存储库是项目开始时的一次性操作。这需要 5 分钟还是 20 分钟并不重要。这段时间将被您使用 GUI 客户端进行签入、签出和添加标签所花费的时间所淹没。

用 TortoiseSVN 客户端试试 SVN。

* * *

## 回答 #13

> 赞同：-3
> 
> 时间：2008-12-08T00:08:19.203

这是一个无耻的插件，但我无法抗拒。

我正在开发一种可能对您有用的工具。

我还没想好名字，所以我使用了“代码代理”的代号。

它的设计主要是对源代码控制设置的补充，但如果您只是一台机器上的单个开发人员，它可能对您来说是一个有用的替代品。

它是在您的开发机器上运行的服务。您将其指向包含源代码的文件夹，然后每次更改文件时它都会自动创建备份。

它旨在填补源代码控制系统留下的巨大空白：

它们仅在您明确签入时保护您的文件。

源代码控制主要是关于管理一个团队（几个开发人员）在项目的多个版本中的输出。因此，将损坏的代码签入源代码管理通常不是一个好主意。大多数时候，开发人员只在“大部分工作”时才签入代码。

在最好的环境中，拥有最好的开发人员团队，这通常意味着您可能平均（在整个项目中）每天只有一次签入。

在最坏的情况下，它可能会低至每几天或几周一次。

但是，即使在最好的情况下，一天也可能发生很多事情。我知道，例如，如果我很顺利，我可以在一天中引入相当多的错误。超过一两个星期，我真的可以把事情搞砸了。

因此，将代码更改历史记录在更细粒度的级别上，而不是每天一次或每周一次，这真的很有帮助。

可以使用“私有”源代码控制分支来做到这一点，但这需要您：

1.  设置私有分支
2.  通过定期与主分支进行集成，花时间管理分支
3.  请记住定期将您的更改签入私有分支。

最后一个可能是凶手。这是一件容易忘记的事情。

当然，一旦你设置了一个私有分支，其他人就会出于某种原因想要访问其中的代码，这最终会阻止你按照你想要的方式定期签入，这就结束了首先破坏了私人分支机构的全部目的。

“代码代理”解决了所有这些问题。

您可以设置一次，然后忘记它。

然后，您可以随时随地获取本地源代码历史记录，无论您需要什么粒度。所有这些都是自动进行的，无需将“错误代码”签入您团队的源代码控制存储库。

对于团队中的开发人员，我的工具不是源代码控制的替代品，而是作为它的补充而设计的。在团队中，您仍然需要显式管理对共享源代码树的签入。

但是，在您的情况下，由于您不在团队中，因此将它用作源代码控制的替代品可能是完美的选择。您可以添加与特定时间点相对应的标签或“快照”（例如“已修复的错误 1234”、“已完成的功能 x”等）。

然而，它不是免费或开源的。它是我要为它收费的工具。

但是，对于个人开发者来说，绝对可以买得起（我还没有最终确定价格）。

我将在 1 月初到中旬的某个时间寻找 Beta 测试人员。如果您有兴趣，请告诉我，我很乐意为您设置私人测试版。

# asp.net - ASP.NET MVC 项目建议

> ID：348278
> 
> 赞同：3
> 
> 时间：2008-12-07T23:05:01.627
> 
> 标签：asp.net, jquery, asp.net-mvc, asp.net-ajax, projects

我在想我想在新的 asp.net mvc 和一些 asp.net ajax 方面获得一些经验。所以我想得到一些适合这个的项目建议！

在 codeplex 上创建一个更大的项目可能会很有趣，比如店面项目。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-08T03:33:21.943

由于您使用的是 asp.net mvc，因此您采取的任何项目都应充分利用 asp.net mvc 的优点/功能，例如

*   TDD
*   SEO友好的URL
*   模型/视图的适当分离并赋予控制器正确的责任。
*   与 ORM 无关的数据层
*   利用会员提供程序（asp.net mvc 有一个等效的可用）
*   等等...

鉴于此，我建议你使用一个支持 jquery 的迷你 CMS。

虽然你也可以参加任何其他项目，但如果你能利用上述特性，那将是一个很好的学习体验（尽管有些特性并不是专门针对 asp.net mvc 处理的）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-07T23:16:39.603

随着假期的临近，为什么不创建自己的“愿望清单”网站呢？添加优先级、多个用户帐户等功能。当然，网络上已经有很多这样的功能，但你确实说这是一个学习项目。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-17T12:38:51.620

无论您做什么，都不要创建 URL 缩短服务，因为那[已经是我的想法了](http://codeplex.com/rick):-P

无论如何，[Twitter](http://www.twitter.com)克隆怎么样？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-17T16:49:48.197

创建一个项目，帮助您做或学习除 MVC/AJAX 之外的一些东西。例如，如果您有兴趣了解需求管理，请创建一个允许您输入、管理和跟踪项目需求的应用程序。同样，如果您想提高项目管理技能，请创建一个项目管理应用程序。同样的道理，如果你和我一样是个数独狂，那就做个数独游戏吧。名单是无穷无尽的。诀窍是做一些你感兴趣的事情。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-07T23:22:30.543

不管有什么建议，我想那里已经有很多了，但一些初步的想法是：

*   博客引擎
*   待办事项清单
*   愿望清单

不管你决定什么，看看那里的一些更好的选择，并尝试指出是什么让它们变得更好，并在此基础上添加额外的功能。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-07T23:44:52.777

照片库（虽然我认为大多数人已经放弃了这个并且正在使用 flickr）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-17T12:04:30.177

我认为您应该为将来要构建的所有其他站点创建一个核心站点。进行登录、新闻、博客……和数据库设计。为他们制作模型和控制器。并保持您的数据库简单，以便您以后可以使用新功能对其进行扩展。这样您就不必每次都这样做并且感到无聊。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-17T12:35:09.600

*   旅游预订网站。
*   Myspace/Facebook 盗版。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-01-15T17:10:00.293

我正在 Asp.Net MVC 中开始[一个开源 StackOverflow 克隆](http://github.com/ripper234/Stack-Underflow)- 主要是为了学习如何构建网站 :)

# php - PHP：Cookie 域/子域控制

> ID：348282
> 
> 赞同：33
> 
> 时间：2008-12-07T23:06:13.247
> 
> 标签：php, cookies

我正在一个具有多个子域的站点上工作，其中一些应该有自己的会话。

我想我已经解决了，但是注意到一些我不理解的关于 cookie 处理的事情。我在文档中没有看到任何解释它的内容，所以我想我会看看这里是否有人对这个问题有所了解。

如果我这样做：

```
session_start(); 
```

我最终得到一个像这样的会话cookie：

子域.example.net

但是，如果我尝试自己设置 cookie 域，或者像

```
ini_set('session.cookie_domain', 'subdomain.example.net'); 
```

或喜欢

```
session_set_cookie_params( 0, "/", "subdomain.example.net", false, false); 
```

我最终得到了一个 .subdomain.example.net 的 cookie（注意开头的点），我相信这意味着“匹配所有子域（或者在这种情况下是子子域）。

实际上，这似乎发生在我所有的 cookie 中，而不仅仅是会话。如果我自己设置 cookie 域，它会自动在前面加上点，这意味着该域及其所有子域。如果我不设置域，那么它只使用当前域就可以了。

知道是什么原因造成的，我能做些什么来控制那个前置点吗？

谢谢！

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-12-07T23:42:01.707

PHP 的 cookie 函数会自动在 $domain 前面加上一个点。如果你不想要这种行为，你可以使用[header](http://us2.php.net/header)函数。例如：

```
header("Set-Cookie: cookiename=cookievalue; expires=Tue, 06-Jan-2009 23:39:49 GMT; path=/; domain=subdomain.example.net"); 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-04-13T23:14:05.077

如果您在“ [http://subdomain.example.net](http://subdomain.example.net) ”下运行 PHP 脚本，**请不要使用 domain 参数**：

```
setcookie('cookiename','cookievalue',time()+(3600*24),'/'); 
```

你会得到一个带有“subdomain.example.net”（而不是“.subdomain.example.net”）的cookie

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2011-11-14T13:14:46.453

如果您阅读了所有 RFC 6265，您会意识到拥有“仅主机”cookie 的唯一正确方法是不设置域属性。

[https://www.rfc-editor.org/rfc/rfc6265#section-5.4](https://www.rfc-editor.org/rfc/rfc6265#section-5.4)

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2012-02-25T12:14:10.350

我意识到这是一个老问题，但我遇到了这个问题，上面的答案都没有做到。

我想为子域设置会话 cookie，但也启用 httponly 和安全。

避免领先。在子域前面，Kevin 和 stolsvik 是正确的，不要设置域属性。

因此，要做到这一点并且仍然能够设置 httponly 和安全模式，请将域设置为 NULL，如下所示：

```
session_set_cookie_params(0, '/', NULL, TRUE, TRUE); 
```

您现在将拥有一个会话 cookie，用于特定子域（没有前导 .），其中 httponly 和 secure 设置为 true。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-01-23T13:43:01.660

这可能对某人有所帮助（我花了几个小时来解决这个问题）。在源文件中进行更改后并在测试之前，关闭浏览器以正确销毁所有域和子域中的 PHPSESSIONID。

希望这可以节省一些时间！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-03-03T23:12:35.467

我在 wordpress 上设置 cookie 时遇到问题，这对我有帮助，域值是让它在所有页面中工作的关键

```
$domain = ($_SERVER['HTTP_HOST'] != 'localhost') ? $_SERVER['HTTP_HOST'] : false;

setcookie("cookie_name", 'cookie_value', 0, '/', $domain); 
```

# c# - 可选择列表中的用户控件 - 最好的方法是什么？

> ID：348291
> 
> 赞同：3
> 
> 时间：2008-12-07T23:18:05.467
> 
> 标签：c#, winforms, listview, user-controls

在 C# win 表单中工作时，我正在尝试创建一个项目列表，其中每个项目都包含特定布局中的一个图标和 3 个标签。

这是它的插图

![http://hosting04.imagecross.com/image-hosting-13/3535help.jpg](https://i.stack.imgur.com/Z1Kj4.jpg)

用户应该能够选择一行，就像在普通的 Listview 中一样。

我的第一次尝试是在用户控件中创建图标和标签，然后将用户控件放在垂直布局的 FlowLayoutPanel 中（这将创建一个列表）。问题是选择。由于单击事件是由用户控件捕获的，因此没有简单的方法让列表中的其他用户控件知道该控件已被选中，并且如果它们当前被选中，那么它们现在应该被取消选中。（我希望这是有道理的...）

我还尝试使用我在这里找到的一些开源自定义 Listview：http: [//www.codeproject.com/KB/list/aa_listview.aspx](http://www.codeproject.com/KB/list/aa_listview.aspx) 但它太有问题了。

我还考虑过创建一个自定义控件，该控件将从 Listview 继承并在列表中呈现我的用户控件，但我也读到有人试图这样做并遇到了很多困难。

我很高兴听到您的任何建议。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T01:26:22.307

您可能想要尝试的是有两个用户控件。您似乎已经拥有一个控件，即图标和标签。这将是一个内部控件，您无法在程序集之外实例化。第二个用户控件将只是一个容器（您可以通过实际使用用户控件或从面板继承或其他方式来做到这一点，没关系）。这将只是作为单个项目的集合，它将管理项目的选择和取消选择。

基本上，每个用户控件都会引发单击事件，您的容器用户控件将连接到该事件。然后它将知道选择哪个，取消选择哪个。

希望这是有道理的！

# c# - 是否可以在状态之间转换，直到 wf 中发生多个事件？

> ID：348304
> 
> 赞同：1
> 
> 时间：2008-12-07T23:23:05.007
> 
> 标签：c#, visual-studio-2008, workflow-foundation, state-machine

我正在 Visual Studio 2008 中使用 C# 和 WF 开发状态机工作流。在我的一个状态中，我需要等待多个事件发生，直到工作流可以转换到下一个状态。举个例子，考虑一个一致投票的场景。我找不到办法做到这一点。有没有人有这个问题的解决方案或解决方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T13:32:27.927

您可以在一个状态中拥有多个事件驱动的活动，因此您可以为您拥有的每个事件设置处理程序，然后设置本地布尔值来跟踪哪些已成功执行。每次之后，您都可以检查这些值并确定是否需要更改状态。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-30T05:16:27.107

一个更优雅的解决方案是使用 ParallelActivity： [http ://spellcoder.com/blogs/bashmohandes/archive/2006/10/02/690.aspx](http://spellcoder.com/blogs/bashmohandes/archive/2006/10/02/690.aspx)

# c - 你如何处理离散的非整数集？

> ID：348305
> 
> 赞同：1
> 
> 时间：2008-12-07T23:23:30.217
> 
> 标签：c, floating-point, d, lookup

我有一个程序需要执行从一组已知值到另一组已知值的**编译时可检查映射：**

```
进出
------------
8 37
10 61
12 92
13 1/4 109
15 1/4 151
ETC

```

如果输入是整数或均匀间隔，这将很容易。我将遍历行，但也希望能够在可读的庄园中进行查找。

我目前的想法（我不喜欢）是定义一个像

```
enum Size
{
   _8,
   _10,
   _12,
   _13_25,
   _15_25,
   // etc
} 
```

然后将其设置为 2 次查找。

有更好的想法吗？

**编辑：**我主要关心的是限制我可以*尝试*查找的内容。如果代码可能会尝试查找无效的内容，我希望*甚至无法编译的东西。*

集合很小，迭代时间几乎完全不相关。

我还没有看到任何让我在枚举中获得任何东西的东西，所以现在我要这么做了。OTOH我会继续关注这个问题。

`*`注意：我不担心会发现指针问题等等，只是像 for 循环和变量赋值这样的直接代码。

* * *

**本质**：为了清晰和通用性，我过度简化了上述内容。我实际上有一个表，它有 3 个非整数、非均匀轴和一个非数字轴。在这一点上，我不确定我需要在哪些方向上列举它。

一些链接可以让我了解我正在寻找的内容：

[Boost::SI](http://www.boost.org/doc/libs/1_37_0/boost/units/systems/si.hpp)和我的D[版](http://www.dsource.org/projects/scrapple/browser/trunk/units)[想法](http://www.dsource.org/projects/scrapple/browser/trunk/units/types.d)[一样](http://www.dsource.org/projects/scrapple/browser/trunk/units/constants.d)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-09T20:25:23.147

除非您对变量名进行丑陋的解析，否则使用枚举会丢失数值。我会这样做：

```
class Size
{
    public decimal Val{get;set;}
    private Size(decimal val){this.val = val;}
    public static Size _8 = new Size(8.0);   
    //...
    public Dictionary<Size, Size> sizeMap = new Dictionary<Size, Size>
    {
        {_8, _37}, 
        //...
    };
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-07T23:54:25.457

你不能使用哈希映射吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-08T23:32:51.380

如果您的输入分数限制为某个 2 的幂分母，您可以使用定点数作为键。对于您的示例情况，使用 1 位 = 0.25，（将每个输入乘以 4），如下所示：

```
IN maps to Key
--         ---   
8          32   
10         40
12         48 
13 1/4     53
15 1/4     61 

KeyMin= 32 
```

然后，您可以使用 Key-KeyMin 作为稀疏数组的索引，该数组包含一个标志值，例如 -1 用于无效条目。优点是，如果您的密钥发生变化，它可以让您不必重新编码。缺点是浪费内存。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-09T07:25:40.943

Here is a suggestion to how you could solve it. Using structs and arrays.

```
typedef struct{
    float input;
    int   output;
}m_lookup;
m_lookup in_out[] = 
{   
    (float) 8   , 37,
    (float)10   , 61,
    (float)12   , 92,
    (float)13.25,109,
    (float)15.25,151,
};

int get_Var(float input)
{
    int i=0;
    for(i=0;i<sizeof(in_out);i++)
        if(in_out[i].input == input)
            return in_out[i].output;
    // Here you could make some special code for your compiler
    return 0;
}
int main(void)
{
    printf("Input 15.25 : Output %d\n",get_Var(15.25));
    printf("Input 13,25 : Output %d\n",get_Var(13.25));
    printf("Illegal input:\n");
    printf("Input 5 : Output %d\n",get_Var(5));
    system( "pause" );
    return 0;
} 
```

I could probably make some sdjustments if you explain a little more about the The nitty grity.

If you are determend to get it checked at compile time then you can use the enum like this:

```
enum Size
{
   i_8=37,
   i_10=61,
   i_12=92,
   i_13_25=109,
   i_15_25=151,
   // etc
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-07T23:47:57.793

听起来您想使用排序二叉树之类的东西。查找和迭代都很快，树不会关心条目的间距。

如果您的多个轴是独立的，您可以为每个轴创建一个。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-08T01:09:57.537

枚举的想法并不太糟糕，但我会动态地去做。您有一个有效字符串的数组/列表。字符串列表的索引是您的地图的关键。

```
// this could be loaded from a file potentially
// notice that the keys have been sorted.
const char* keys[] = { "10", "12", "13 1/4", "15 1/4", "8", 0 };
float values[] = { 61, 92, 109, 151, 37, 0 };
int key_count = 0;
while (keys[key_count]) ++key_count;

bool find(const char* key, float* val) {
   int idx = bsearch(key, keys, sizeof(const char*), key_count, strcmp);
   if (idx < 0) return false;
   *val = values[idx];
   return true;
} 
```

现在，你说过这里不止一个维度。这只是意味着您需要多个键数组。

# ntvdm.exe - NTVDM CPU 遇到非法指令

> ID：348315
> 
> 赞同：0
> 
> 时间：2008-12-07T23:30:07.660
> 
> 标签：ntvdm.exe

我遇到了一个我不明白的相当奇怪的错误。我创建了一个 C# 控制台应用程序，旨在测试我的 Web 服务是否在我的网络外部工作。它所做的只是尝试连接到 Web 服务，将每个阶段输出到控制台并将其写入文本文件，以便他们可以将日志发送给我。

它在 3 台 XP 机器上运行良好（一台在我的网络内，两台在我的网络外）。一台 Vista 机器（有一个清单文件）但在我老板的 XP 机器上（他是一名 IT 人员，所以知道他在做什么），它抛出了一个非常奇怪的错误。

C:\temp\testwe~1.exe NTVDM CPU遇到非法指令

http://www.houseofhawkins.com/roger.jpg">

我做了一些谷歌搜索，看起来他的 NTVDM 可能被窃听了，或者有病毒什么的。这些似乎都不是。我看不出会发生什么导致它以这种方式失败。

使用系统；使用 System.Collections.Generic；使用 System.Text；使用 System.IO；

命名空间 testwebservice { 类程序 { FileStream theFile = null; StreamWriter 作家 = null;

```
 static void Main(string[] args)
    {
        Program p = new Program();
        p.testMe();
    }

    private void testMe()
    {
        Console.WriteLine("Entered main method about to create stream");            
        try
        {
            theFile = File.Create(@"jonTestWebService.log");
            writer = new StreamWriter(theFile);
            writer.AutoFlush = true;

            try
            {
                message("Starting test at: " + DateTime.Now.ToLongTimeString());

                Random rand = new Random();

                message("creating new instance of webservice");
                houseofhawkins.testweb webServ = new testwebservice.houseofhawkins.testweb();

                message("calling hello world");
                String helloResult = webServ.HelloWorld();
                message("hello world result = " + helloResult);

                int one = rand.Next(999);
                int two = rand.Next(999);
                message("calling maths method with " + one + " + " + two);
                String mathResult = webServ.mytestMethod(one, two);
                message("Math result is: " + mathResult);

                message("Creating instance of CSJawbreaker");
                CSJawbreaker.InformationService csj = new testwebservice.CSJawbreaker.InformationService();

                message("trying to get the latest version number");
                float version = csj.latestVersionNumber();
                message("Version number: " + version.ToString());

                message("");
                message("Finished all processing at: " + DateTime.Now.ToLongTimeString());
            }
            catch (Exception ex)
            {
                writer.WriteLine("");
                writer.WriteLine(ex.Message);
                writer.WriteLine("");
            }
        }
        catch (Exception ex)
        {
            Console.WriteLine("could not create stream Writer, " + ex.Message);
        }

        message("");
        message("Press return to exit");
        Console.ReadLine();

        writer.Close();
        theFile.Close();
    }

    private void message(String message)
    {
        if (theFile != null && writer != null)
        {
            Console.WriteLine(message);
            writer.WriteLine(message);
        }
    }
} 
```

}

我很困惑为什么上面的代码可以/会这样做。这只是我想知道的部分，这可能会发生在真正的客户机器上，还是只是我老板的机器被感染了或其他什么。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T05:57:37.050

如果您最终使用 NTVDM，那就大错特错了，因为这是 XP 的 16 位 DOS 仿真层。如果在您重新复制 EXE 后再次发生这种情况，我会调查安装在您老板 PC 上的软件（.NET 框架版本等）。

我还会尝试在 WinDbg 中运行它以查看最终结果，一旦出现故障等获取调用堆栈，我敢打赌你会在堆栈上找到一个奇怪的模块（间谍软件等）。

# c++ - 在 C++ 中是否可以定义纯虚函数？

> ID：348320
> 
> 赞同：6
> 
> 时间：2008-12-07T23:32:50.260
> 
> 标签：c++, function, inheritance, pure-virtual

这是交易。我有一个很大的类层次结构，我有一个一直扩展的方法。该方法总是必须在每个新级别查看一个或两个以上变量，这些变量取决于层次结构中的实际类。我想要做的是检查这两个额外的变量，然后调用同一个函数的超类版本。我希望能够定义此函数，因为它的所有直接子级都将使用它，但我想强制该类的任何子级必须重新定义该方法（因为他们将不得不查看他们的新数据成员）

那我该怎么写呢？我通常使用 =0; 在 .h 文件中，但我认为我不能使用它并定义它......

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-07T23:52:11.110

实际上，您可以将函数声明为纯虚拟函数，并且仍然在基类中为其定义实现。

```
class Abstract {
public:
   virtual void pure_virtual(int x) = 0;
};

void Abstract::pure_virtual(int x) {
   // do something
}

class Child : public Abstract {
    virtual void pure_virtual(int x);
};

void Child::pure_virtual(int x) {
    // do something with x
    Abstract::pure_virtual();
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-07T23:52:19.783

您可以为纯虚函数提供定义。查看[GotW #31](http://www.gotw.ca/gotw/031.htm)了解更多信息。

# procedural-generation - 数学问题：星系的程序生成

> ID：348321
> 
> 赞同：43
> 
> 时间：2008-12-07T23:32:51.787
> 
> 标签：procedural-generation

我将制作一个完全由程序生成的太空/交易/战斗游戏。但是，我知道将整个银河系的所有细节都存储在内存中是不可行的。结果，我一直认为我可以用一颗种子来生成一个太阳系，从那个太阳系，你可以使用跳跃门前往其他太阳系。问题是，如果我从起始太阳系跳到另一个太阳系，我需要能够回到具有完全相同特征（行星、小行星等）的完全相同的起始太阳系。

本质上，我需要能够从一个数字生成整个星系。从那个生成一个太阳系的数字中，我需要能够生成与第一个太阳系相连的所有其他太阳系，以及与这些太阳系相连的所有太阳系，依此类推。如果我回到它们，每个太阳系都必须保持完全相同的功能。此外，每个太阳系的链接数量可以是随机的，也可以是固定的，由您选择。不过随机会更好。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-12-07T23:39:30.183

如果你觉得勇敢，你可以做的比看看[Ian Bell](http://www.iancgbell.clara.net/elite/text/index.htm)如何为最初版本的 Elite做的更糟糕

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-08T00:56:34.630

在 Gamasutra 上查看这个系列：

[实时程序宇宙，前四个链接](http://www.gamasutra.com/view/feature/130921/a_realtime_procedural_universe_.php)

另外，这个：[无限宇宙的算法](http://www.gamasutra.com/view/feature/3377/algorithms_for_an_infinite_universe.php)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-08T01:46:21.487

这是我理解的基本思想。假设你已经到达星系#42，你需要找出里面有什么。它有`nplanets`行星——一个介于 0 和 10 之间的数字，比如：

```
>>> star_system = 42
>>> nplanets = hash('nplanets%d' % star_system) % (10 + 1)
>>> nplanets
4 
```

好的，那么到 2 号行星，游戏开始时有多少空间站在轨道上？找出 0 到 3 之间的一个数：

```
>>> planet = 2
>>> nstations = hash('nstations%d/%d' % (star_system, planet)) % (3 + 1)
>>> nstations
1 
```

等等。这些数字都是索引的散列函数（在这种情况下，星系统#42，行星#2），减少到适当的范围。由于散列函数是确定性但“随机”的，因此每次都是相同的，但对玩家来说是随机的。

当然，散列带有长序列的字符串（如“nstations”）并不是最快的方法，但它显示了这个想法。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-08T12:24:50.077

看看原来的[蠕虫](http://en.wikipedia.org/wiki/Worms_(computer_game))游戏。我认为它声称有大约 40 亿个可能的级别。每个级别都是基于大约 20 个字符的短种子字符串生成的。这决定了

*   关卡的主题（北极、森林等）
*   景观的形状
*   地面的滑溜
*   预建关卡细节的放置（雪人、岩石……）
*   你的蠕虫队、地雷和武器箱的位置。

如果您喜欢某个关卡，您可以记下种子字符串，并在以后使用它来重新生成相同的关卡。

这是一个非常复杂但具有确定性的函数的示例，只有一个输入参数。我认为这是您需要的基本概念。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-10-03T17:09:16.517

我认为值得注意的是，

1.  为相同的输入产生相同的随机输出的生成器称为伪随机数生成器“PRNG”。通常，您在一开始就给它一个“种子”输入数字，然后从中提取随机数字，无需进一步输入即可调用它。注意：你不能“回到”更早的号码，至少不能不从头开始。

2.  使用坐标作为每次调用的输入调用的类似 PRNG 的函数通常是“噪声”函数。在这里，您没有“无法返回”的问题 - 只需再次使用“早期”输入进行调用。噪声函数使用 PRNG（作为后端；或者至少可以），它仍然可以在一开始就播种，因此您不会失去“一个数字中的宇宙”功能。

3.  虽然您每次都可以只使用 PRNG 并将星系坐标组合为“种子”，但充其量只会得到“白噪声”，没有其他属性。噪声功能更适合这项工作，因为可以选择甚至调整它以使您具有平铺/平滑/螺旋状的外观/等。结果。例如，搜索使用 perlin 噪声制作的纹理图像。我希望您看到使用相同的噪声函数您可能会创建例如数千个随机云，但是通过根据您的需要调整噪声函数（不仅仅是种子或坐标），您可能会得到熔岩或星系。调整它可能不是微不足道的。

4.  每次调用的输入坐标数决定了噪声函数的维数，因此对于二维地图（或纹理等），您可以使用二维噪声函数。然后你每次都称它为noise2d(x,y)。

在您的情况下，我会尝试使用 3 维单纯形噪声函数（单纯形来自 perlin noise 的作者，建议更好）。

然后，每个星系坐标三元组都会为您提供一个结果编号。下一个决定是：这个数字代表什么？为了充分利用单纯形噪声的平滑特性，我会将较低的数字映射到更空的太阳系，将较高的数字映射到质量更大的系统。或者，也许更好，对于每个系统调用单工噪声多次带有子坐标。中等大小的结果数字是行星，小数字是真空或小行星。大数字明星等。

该主题不活跃，而且很旧，但搜索可能会像我的一样在这里结束。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2011-03-30T15:28:10.843

你不能只对星系 ID 进行 SHA1，例如：

## 银河一号

```
Sha1(1) = 356a192b7913b04c54574d18c28d46e6395428ab 
```

## 银河 2

```
Sha1(2) = da4b9237bacccdf19c0760cab7aec4a8359010b0 
```

## 银河 3

```
Sha1(3) = 77de68daecd823babbb58edb1c8e14d7106e83bb 
```

然后你可以分段代码，IE：

## 前 4 个字符 = 行星数量

```
356a
da4b
77de 
```

您将需要某种字符串到数字的算法，一个简单的算法是获取每个非数字字符的 ASCII 码，然后将它们全部相乘或其他东西。

那么现在我们知道我们的银河系中有多少行星，那么银河系的 x,y,z 维度呢？

## 接下来 9 个字符 = Galaxy 尺寸 (x,y,z)

原理同上，把代码变成大数。还要进行一些敏感性检查，您不想要一个 10milesx10milesx10miles 的星系，其中有 2000 万颗行星。有某种加权算法，例如最小大小是行星数 * 10000。您需要使用数字来确保范围都是兼容的，并且从哈希中选择的字符实际上会给您一个合理的范围。

或者，您可以用一个随机数代替这个，在星系的最小和最大大小之间选择一个数字，但使用一个恒定的 RNG 种子，例如星系 ID！这样，对于观察者来说，星系的大小基本上是“随机的”，但它们每次都是一样的。

## 等等等等！

这是获取宇宙属性的一种方式，但是行星属性呢？像人口和其他东西？

如果您拥有拥有 20,000 个行星的 Galaxy 1，您可以：

```
Sha1('1:340') = bc02ab36f163baee2a04cebaed8b141505cc26b5 
```

也就是说，银河一号，行星 340。然后，您可以随意拼接该代码。使用哈希的好处是每个星球都应该有一个完全唯一的代码。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-08T02:43:52.400

每个太阳系的随机种子是一个可行的解决方案，但我觉得你在这里找错了树。

玩家可以做些什么来改变那里的东西吗？（比如说，建造一些东西，开采一个可耗尽的资源等？）如果是这样，你无论如何都必须保存状态。

玩家是否可以在无需实际返回的情况下查看该地方的情况？（如果他不能，为什么不呢？！）你是要查找它还是要再生整个太阳系只是为了找出一条关于它的信息？（PRNG 解决方案不允许您只获得太阳系的一部分，您必须制作整个东西。）

到底有多少细节需要保存？

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-12-03T09:00:58.577

我用梅森捻线机。PRNG 接受任何长度的种子数组。
例如，我想在坐标 x=25,y=72 上生成星系。我用种子 [25,72] 重新启动捻线机。
如果我想在这个星系中生成第 1138 颗行星，我使用 [25,72,1138]。
国家？[25,72,1138,10]
城市？[25,72,1138,10,32]
等等。
使用这种方法，您只需使用一个数字（x 坐标之前的那个，在我们的例子中是 25 之前）就可以生成数十亿个对象。
现在有一些项目使用它。
Noctis：anynowhere.com/
Infiniverse： http: [//www.infiniverse-game.com/](http://www.infiniverse-game.com/)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-08T01:05:09.713

我不认为“星系”中真的有那么多信息是你无法将它存储在今天的计算机上的。假设一个星系有 100 颗恒星，每颗恒星有 10 颗行星，每颗行星有 3 颗卫星。那是 100 颗恒星 + 1,000 颗行星 + 3,000 颗卫星，您必须跟踪，即 4,100 颗天体。

这是我们可能想要跟踪的行星的事情。

质量 X,Y,Z 位置 一天的长度（在它自己的轴上旋转的时间） 年的长度 人口 50 种不同资源的资源量

假设每个值需要一个 double 来存储它，并且我们有 57 个值要存储（让我们四舍五入说 100），那么我们有 100 个值 * 8 个字节 * 4100 个主体 = 3,280,000 个字节。现在，这是 3 兆的数据。这可能看起来很多，但实际上并没有那么多。另外，我不认为你真的想在一个星系中有这么多恒星。游戏确实太大而无法探索，并且可能会变得难以控制，无法尝试实际模拟给定星系中正在发生的所有事情。

这样看。如果你拿 SimCity 这样的游戏，将城市网格上的每个方格视为潜在的星球，然后你就会意识到在一个小文件中可以存储多少信息，这样你就不必随机生成任何东西。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-03-30T15:18:22.940

假设你从一个星系的种子开始，即1234，取这个种子，生成10000个随机数，每个随机数代表一个星系。当您接近恒星时，您获取恒星的随机数，并将其作为新随机函数的种子。为围绕恒星运行的天体数量生成一个随机数，并为每个天体生成一个数（始终使用第二个随机函数），依此类推。我不知道这是否对您有帮助，但您需要记住，随机函数内部是混乱的，对于初始条件，整个函数会发生变化。

银河系中恒星的种子必须始终产生相同的恒星，恒星的种子必须产生相同的物体，等等。

您总是可以使用统计数据、密度计算、改进结果来让事情变得更有趣。始终检查函数是否会为相同的输入产生相同的结果。

抱歉，如果我的英语很烂，我来自阿根廷，而且英语不是我受过训练的素质之一：p

PD：我在做同样类型的游戏；）

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-21T02:47:35.410

只要你用相同的种子调用 srandom()，你就会从 random() 中得到相同的值。因此，只需对 srandom() 的一次调用将星系统中的所有内容都建立在基础上……然后，您只需要为整个星系统存储 1 个整数（种子）。现在就是压缩！

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-21T02:48:57.233

这是我的第二个改进的解决方案。玩家将从一个随机生成的太阳系开始。每个系统都连接到 1 到 4 个其他系统。将它们视为北、南、东和西系统。如果玩家要通过北跳门，他将被带到一个种子比之前的系统多一个的系统。如果他往南走，那个系统的种子就会少一粒。2+ 和 2- 分别代表东和西。与这些系统的距离（以秒差距或光年为单位）是根据系统的种子和您到达的方向计算的。这样，星系的大小仅受用于容纳种子的数量的最大值和最小值的限制。

通往其他星系的曲速孔将放置在距起始系统一定距离的位置。下一个星系就像这个星系的延续，种子数量将以同样的方式增加，而位于星系曲速洞另一端的系统将只是“东”或“北” " 从启动系统连接。

顺便说一句，与上述解决方案不同，这种递增种子的使用会导致网络。此外，您可以看到此方法使用四边形，而上述解决方案使用六边形，这使得无法创建网络。

当然，所有这些都是基于这样的假设，即所有种子都会生成一个随机的数字序列，该序列不同于任何其他序列。这使得每个系统都是独一无二的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-12-08T01:57:19.250

如果您使用伪随机数生成器，则可以保证您生成的每个随机数都以相同的顺序出现在给定的种子中。生成由给定数字作为种子的系统的代码在您每次生成时都会显示相同。

使用伪随机数流中的第一个数字来生成“门”的数量。通过每个门并从数字流中获取一个值以分配给每个目标系统并为其播种。

根据该种子生成每个系统的特征。

有几种已知的算法用于生成随机种子。

给[梅森捻线机](http://en.wikipedia.org/wiki/Mersenne_twister)一个裂缝

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-12-08T00:01:51.400

我隐约记得以前做过这件事。在 90 年代初期，分形风靡一时，我记得有一家公司为游戏程序员提供世界。他们创造了一个完整的无限宇宙，充满了太阳和行星的星系，事件一直延伸到山谷和行星上地方的纹理。他们提议为游戏开发商寻找合适的虚拟房地产。游戏开发者将获得软件来渲染和使用它，以及在这个分形宇宙中他们的财产的确切坐标。

我已经用谷歌搜索了几分钟“分形游戏世界星球宇宙”等，但没有找到它们。可能是[Pandromeda](http://www.pandromeda.com)，但我不太记得了。

你应该为这个想法研究分形。您所需要的只是一个连续的数字字段，您可以从种子中重新创建这些数字，然后将这些数字呈现为具有不同属性的恒星、行星和卫星。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-12-08T00:04:56.543

您可以从某个种子（“母数”）构建一个*N位数的伪随机数。*然后，您将数字分组并使用它们来回答您的问题。

示例：*N* =20

-> 一位数：有多少额外的跳跃门？
-> 三位数：生成每个可用跳跃的相应长度的
种子 -> 六位数：生成此太阳系的种子
-> 十位数：为每个链接的太阳系生成新的 20 位数种子的种子

然后递归。每个系统（具有稳定的轨道等）都是在时间 0 生成的，您必须计算它*现在*的样子。

当然，这种从母系统开始的方法意味着当前系统离母系统越远，生成数据所需的时间就越长。此外，这种方式可以制作一棵树，而不是一张网（这是我所期望的）。

我认为生成坐标会更好 - 使用平面中的极坐标，也许是三维的椭球。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-12-08T00:22:49.707

如果您真的想返回到固定状态，我认为从单个值生成程序不是正确的方法。

假设，您在每个平面中有一个 256x256 系统的固定网格，在宇宙中有 16 个平面。每架飞机有多达 512 个交易站和多达 8 个与其他飞机的链接。所有的交易站和链接都在一个固定的位置。您的初始种子值必须至少为 2^76 才能对所有可能的宇宙进行编码。添加更多对象（行星、船舶……），数量呈指数增长。

编辑：如果您在每个系统中不允许多个交易站或链接，它会少一些。我会使用一些永久存储，可能是像 Firebird 或 sqlite 这样的嵌入式数据库。顺便说一句，我目前正在开发这样的游戏。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-12-08T01:04:24.490

这就是我想出的。不知道它是否会是最终版本。

想象一个六边形网格，每个顶点都有一个太阳系。因为，我们在一个六边形网格上，所以从任何顶点只有三条线。一个总是水平的，另外两个是对角线的。如果我们给起始种子一个值n，我们可以给水平连接到起始点的太阳系一个值n+1，其他的得到n+2和n-2的值。

哦，废话。我们不一定会得到一个网格。该死的。让我们再试一次。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2010-12-03T09:28:43.440

我怀疑你将面临的最大问题是拥有一个命名系统，以一种对玩家来说一致且有意义的方式命名所有这些对象——尽管我们确实有[系统地命名真实对象的方案。](http://en.wikipedia.org/wiki/Astronomical_naming_conventions)我忘记了 Elite 的命名约定是否在某个时间点后失效了......

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2016-05-31T15:06:15.750

从数学上讲，您想随机/伪随机生成一个无向的连通图。在这个图中，每个节点都是一个太阳系，每条边都是一个跳门。

1）创建N个节点并随机分配一个空间坐标。这些节点最终将成为你的太阳系。

2）使用Deluanay三角剖分算法生成边缘。我建议使用 Deluanay 三角剖分，因为它会创建一个外观相当漂亮的地图，并且没有任何门相互交叉，但您实际上可以使用任何您想要的算法。我真的不知道你在找什么。

3）如果您使用了Deluanay三角剖分，我建议您消除一定数量的边以创建“稀疏性”。这将使地图更有趣，因为某些地点将成为交通枢纽，而其他地点则只是进站。

4) 保存此图。这是你的宇宙。不要放错地方或扔掉你的宇宙。尽可能高效地存储它，但不要删除任何信息。

5) 为每个节点分配一个种子，并使用这个种子生成每个太阳系。

6) 恭喜，您现在拥有一个包含任意数量的太阳系和跳跃门的宇宙。

# eclipse - Eclipse Ganymede HTML 编辑器在编辑属性时速度非常慢

> ID：348328
> 
> 赞同：6
> 
> 时间：2008-12-07T23:35:14.340
> 
> 标签：eclipse, ide, eclipse-3.4

我最近从 Europa 升级到 Eclipse Ganymede，现在我发现当我编辑 JSP 文件时，IDE 在编辑 HTML 属性（但不是 JSP 属性）时会爬行。

有没有人遇到过这种情况，或者有什么建议？

另外，如果您能指出我更好的地方来询问 Eclipse 相关问题，请告诉我。

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-08T12:13:14.687

Eclipse 中的可视化编辑器很慢。我不知道为什么会这样；其他图形框架在 Java 中实时实现了令人难以置信的效果，所以它们不应该那么慢。

我建议你打开一个针对 Eclipse 的错误报告。这样，您可以向他们提供反馈并了解他们的想法，如果他们接受，您可以跟踪任何进展。

至于问 Eclipse 问题，[请转到新闻组](http://www.eclipse.org/newsgroups/)。还有邮件列表，但这些邮件列表仅适用*于使用*Eclipse 的开发人员（而不是*使用*它的人）。因此，如果您选择解决此错误，它们只是一个选项:)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-08T21:59:26.993

对于 Eclipse Ganymede：您可以使用以下菜单按项目禁用全部或部分 HTML 验证。

右键单击项目 | 项目属性 | 验证 | 启用项目特定设置。

然后您可以禁用 HTML 验证。

或者，从项目属性中，单击打开验证并选择 HTML 验证。选择启用项目特定设置并将十个元素检查中的任何一个设置为“忽略”。

您还可以使用 Windows (Eclipse) Preferences | 关闭整个工作区的这些设置。验证设置。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-08-09T09:51:16.340

这个问题今天仍然存在，看起来。我知道这个问题，但我还不知道如何解决它......

您可以看到，如果您尝试在*文档末尾*编辑一个属性，它并不像*在文档开头*编辑一个属性那么慢。

或者您可能会看到，如果您尝试编辑已经有结束引号的属性（例如，首先输入：`attribute_name=""`，然后才输入属性值，它也不会很慢。

出现问题是因为当您键入一个没有值结尾引号 (") 的属性时，如下所示：`attribute_name="...`，文档的其余部分将成为该属性的值，并且由 eclipse 为您进行的每次击键进行处理。

我花了大约半个小时研究如何禁用属性值处理，但失败了（可能我找的时间不够长）。

本

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-12-14T15:25:13.193

尝试关闭概览选项卡

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-10-05T20:00:23.697

在 Preferences > General > Editors > Structured Text Editors 中取消勾选 Enable fold

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-02-22T00:38:34.740

使用 Eclipse 更新站点，我之前安装了 Eclipse Web Developer Tools。似乎其中包含的某些内容使 JSP 编辑器非常慢。

我卸载了这个并安装了网页编辑器，它还包括 JSP 编辑器并且没有同样的慢问题

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-06-26T12:07:06.270

在这里他们说**Eclipse Kepler**将克服这个问题：[是 Eclipse 切换选项卡太慢了吗？](http://softwareprole.wordpress.com/2013/01/02/is-eclipse-too-slow-switching-tabs/). 不幸的是，Eclipse Juno 的补丁链接现在被破坏了......所以我会等待开普勒。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2016-08-09T04:31:08.030

```
Project > Properties > JavaScript > Include Path > Source 
```

删除包含大量**js**文件（例如 JQuery 等）的目录... Eclipse 因太多无法**编译的****源代码**而迷失了方向。

 **# javascript - 使用Javascript将文件插入html页面？

> ID：348342
> 
> 赞同：1
> 
> 时间：2008-12-07T23:45:38.453
> 
> 标签：javascript, file

我目前正在尝试使用 DOM 和 Javascript 从文件中读取文本并将其附加到我的 html 页面中的元素。我无法让文本格式化。我试过使用 innerHtml 但根本没有格式化（没有换行符）。

这是javascript：

```
http = new XMLHttpRequest();
http.open("GET",FILE,false);
http.send();       
document.getElementById("tbody").innerHTML = http.responseText 
```

就像我说的那样，文本被添加到 tbody 元素中，但从未如此格式化。

* * *

我让它使用这个代码（带有 pre 标签），但就像我说它在我的电脑上工作但在服务器上没有帮助。

```
 http.open("GET",FILE ,false);
           http.send();
           var newtext = document.createTextNode(http.responseText);
           var para = document.getElementById("tbody");
           para.appendChild(newtext); 
```

* * *

这是我所有的javascript代码：

函数 getHTTPObject() { var http = false;

```
/*@cc_on
    @if (@_jscript_version >= 5)
    try
    {
        http = new ActiveXObject("Msxml2.XMLHTTP");
    }
    catch (e)
    {
        try
        {
            http = new ActiveXObject("Microsoft.XMLHTTP");
        }
        catch (E)
        {
            http = false;
        }
    }
    @else
    {
        http = false;
    }
@end @*/

if (!http && typeof XMLHttpRequest != 'undefined')
{
    try
    {
        http = new XMLHttpRequest();
    }
    catch (e)
    {
        http = false;
    }
}
return http 
```

}

```
 function loadData()
    {

     http = getHTTPObject();

        if (http)
        {
           http.open("GET","my file name",false);
           http.send();
           var newtext = document.createTextNode(http.responseText);
           var para = document.getElementById("tbody");
           para.appendChild(newtext);   
        }
    } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T02:27:17.397

我敢打赌，答案与您的陈述有关：“它适用于我的 PC，但不适用于服务器”。我猜您遇到问题是因为服务器上不存在该文件，或者该文件的路径不同。您是否通过直接在浏览器中尝试文件的 URL 来检查文件是否已发送到您的客户端？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-07T23:47:37.703

您可能会幸运地将文本包装在`<pre>`标签中。回应中的内容是什么？如果是 XML，您可能需要使用`responseXML`.

```
http = new XMLHttpRequest();
http.open("GET",FILE,false);
http.send();       
document.getElementById("tbody").appendChild(http.responseXML); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-07T23:54:52.897

这完全取决于响应中的数据类型。如果它是纯文本，则没有理由对其进行格式化。如果您希望 html 像上面建议的那样“尊重”空格，请将文本放在 pre 标记内。

如果响应是 html，请确保 #tbody 是 div 或类似的东西。

您还应该考虑使用[jquery 之](http://www.jquery.com)类的东西来进行 DOM 操作和 ajax。它会通过跨浏览器兼容性为您省去头疼的问题，并且编写起来更好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-07T23:51:24.340

innerHTML 接受（并解析）和 html 字符串，所以应该得到一个类似于

（假设 ）

```
<tbody>{responseText}</tbody> 
```

但是，如果不知道响应文本中的内容类型，就很难知道问题的确切原因。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-08T00:11:34.860

它可以在您的 PC 上运行但不能在服务器上运行的原因可能是时间问题。AJAX 是异步的，但您将其视为同步的。

# web-services - 远程 API/Web 服务层 MVC 的域逻辑和数据访问

> ID：348360
> 
> 赞同：3
> 
> 时间：2008-12-07T23:54:58.793
> 
> 标签：web-services, model-view-controller, architecture, rpc

在我们的系统中，我们有一个远程 API 层（例如 SOAP、XML-RPC、REST 等）来处理 Web 应用程序和在其之上开发的任何客户端应用程序的域逻辑和数据访问。与过去不同，我在 Web 应用程序中没有业务逻辑代码和数据库连接，所有用户操作都被转换为调用该层的方法。

我担心的是，例如对于页面的呈现，它需要进行大量调用来获取数据，例如带有报告、最近历史记录、一些 portlet 等的用户仪表板。根据我当前的设计（委托逻辑和 DA到远程层），您看到的缺点是什么？我发现通过 HTTP 建立和传输基于文本的数据比 DB 访问更重且更昂贵。此外，必须在远程层进行优化（给定 Web 应用程序的业务逻辑和 DA 代码，您在优化方面具有更大的灵活性）。

我现在正在考虑是否应该创建一个远程“Helper”服务，它允许我将所有调用压缩为一个，也就是说，我不是进行多次调用，而是发送一个带有一组方法名称和参数的调用。它看起来有点难看，这就是为什么我现在仍然对这样做持怀疑态度。

我想知道您对这种架构的看法，如果您使用类似的方式开发了一个 Web 应用程序，那么您过去采取了哪些方法来保证良好的性能？如果还有其他我真正应该担心的问题，也请与我分享。

谢谢！

yc

* * *

## 回答 #1

> 赞同：-1
> 
> 时间：2011-07-07T13:34:03.557

如果您在 asp.net mvc 中正确使用输出缓存，那么性能将会提高很多。

# database - 存储上传的图像、SQL 数据库或磁盘文件系统的最佳位置是什么？

> ID：348363
> 
> 赞同：161
> 
> 时间：2008-12-07T23:55:39.947
> 
> 标签：database, filesystems, image-uploading, binaryfiles

我正在编写一个允许用户将图像上传到服务器的应用程序。我预计每天大约 20 张图片都是 jpeg 并且可能没有编辑/调整大小。（这是另一个问题，如何在存储之前调整服务器端的图像大小。也许有人可以在评论中删除一个 .NET 资源）。我现在想知道存储上传图像的最佳位置是什么。

*   将图像作为文件存储在文件系统中，并在具有该图像的确切路径的表中创建记录。

*   或者，使用数据库服务器的“图像”或“二进制数据”数据类型将图像本身存储在表中。

我看到两者的优点和缺点。我喜欢 a) 因为我可以轻松地重新定位文件并且只需要更改表条目。另一方面，我不喜欢将业务数据存储在 Web 服务器上，并且我真的不想将 Web 服务器连接到任何其他保存业务数据的数据源（出于安全原因）我喜欢 b）因为所有信息都是在一个地方，并通过查询轻松访问。另一方面，数据库很快就会变得非常大。外包这些数据可能会更加困难。

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2008-12-08T00:03:20.603

我通常将文件存储在文件系统上，因为这就是它的用途，尽管也有例外。对于文件，文件系统（通常）是最灵活和最高效的解决方案。

在数据库中存储文件存在一些问题 - 文件通常比您的平均行大得多 - 包含许多大文件的结果集将消耗大量内存。此外，如果您使用使用表锁进行写入的存储引擎（例如 ISAM），您的文件表可能经常被锁定，具体取决于您存储在那里的文件的大小/速率。

关于安全性 - 我通常将文件存储在文档根目录之外的目录中（无法通过 http 请求访问），并通过首先检查正确授权的脚本来提供它们。

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2014-11-26T13:53:40.363

选项 B 的唯一好处是在一个系统中拥有所有数据，但这是一个错误的好处！你可能会争辩说你的代码也是一种数据形式，因此也可以存储在数据库中——你喜欢它吗？

除非你有一些独特的情况：

*   业务逻辑属于代码。
*   结构化数据属于数据库（关系或非关系）。
*   批量数据属于存储（文件系统或其他）。

![文件、代码、数据](https://i.stack.imgur.com/3fAPe.png)

不必使用文件系统来保存文件。相反，您可以使用云存储（例如[Amazon S3](http://aws.amazon.com/s3/)）或在其之上的基础设施即服务（例如[Uploadcare](https://uploadcare.com/)）：

[https://uploadcare.com/upload-api-cloud-storage-and-cdn/](https://uploadcare.com/upload-api-cloud-storage-and-cdn/)

但是将文件存储在数据库中是一个坏主意。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2016-12-01T11:40:29.107

我知道这是一个旧帖子。但是该页面的许多访问者都没有得到与该问题相关的任何信息。特别是对于一个新手。

如何在我们的网站上传和存储图像或文件：

对于静态网站可能没有问题，因为某些共享托管的文件存储仍然足够。问题来自一个动态的网站，当它变大时。可以处理更大的数据库，但更大的文件（例如图像）成为问题。网站中有两种类型的图像：

1.  图片来自动态博客管理员。通常，这些图像在上传之前已经过优化。

2.  来自用户的图片，如果用户允许上传头像等图片。或者用户可以创建博客内容并从文本编辑器中放置一些图像。这种图像很难预测大小。用户可以通过调整视图大小而不是调整图像大小来为小内容上传大图像。

通过忽略项目编号。1 以上，项目编号的快速解决方案。2 如果我们的网站没有图像优化器功能，可以通过以下提示临时解决：

1.  不允许用户通过将用户重定向到图片库来直接从文本编辑器上传。在此页面上，用户必须提前上传文件才能嵌入内容。此方法称为文件管理器。

2.  使用裁剪图像功能供用户上传图像。即使用户上传非常大的文件，这也会限制图像大小。最终图像是裁剪图像的结果。我们可以在服务器端定义大小并仅接受例如 500Kb 或更低。

现在，这只是暂时的。对于最终解决方案，重复该问题：

*   如何处理大图像存储？
*   调整大小或更改扩展名。
*   大型或中型网站或电子商务如何处理其图像的文件存储？

那么我们可以做什么：

1.  从共享托管 VPS 迁移。不够？然后通过升级到专用更高。

2.  创建您自己的文件存储服务器。谷歌搜索做到这一点。这并不像你想象的那么难。有些人这样做是为了他们的网站。

3.  最简单的方法是使用 CDN 文件存储服务。

好吧，1和2有点贵。但是我认为没有 3 是最好的解决方案。

某些 CDN 服务允许您存储任意数量的 Web 文件。

问题，“如何从我们的网站上传文件到 CDN？”

不用担心，一旦您注册，通常是免费的，您将获得如何上传文件以及从/到您的网站获取链接的指导。您将获得一个 API 等等。这简单。

一些提供商为我们提供 14 天的免费服务，但存储和带宽有限。但这作为起点是可以的。唯一的问题是因为“人们从不尝试”。

希望对新手有所帮助。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-12-08T02:06:50.573

我们已经让客户在几个不同的后端多次坚持使用选项 B（数据库存储），最终我们*总是*最终回到选项 A（文件系统存储）。

即使是 SQL Server 2005（我们试用的最新版本）也无法很好地处理像这样的大型 BLOB。

具体来说，我们看到了严重的膨胀，我认为可能是锁定问题。

另一个注意事项：如果您使用的是基于 NTFS 的存储（Windows 服务器等），您可能会考虑找到一种将成千上万个文件放在一个目录中的方法。我不知道为什么，但有时文件系统不能很好地应对这种情况。如果有人对此有更多了解，我很想听听。

但我总是尝试使用子目录来分解一些东西。创建日期通常适用于此：

图片/2008/12/17/.jpg

...这提供了不错的分离水平，并且在调试过程中也有所帮助。当存在真正巨大的目录时，Explorer 和 FTP 客户端可能会有点窒息。

**编辑：**对于 2017 年的快速说明，在 SQL Server 的更新版本中，有处理大量 BLOB 的新选项，这些选项应该避免我讨论的缺点。

**编辑：** 2020 年的快速说明，AWS/Azure/etc 中的 Blob 存储多年来也一直是一种选择。这非常适合许多基于 Web 的项目，因为它价格便宜，并且通常可以简化有关部署、扩展到多台服务器、在必要时调试其他环境等方面的某些问题。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-12-08T04:29:55.683

我最近创建了一个 PHP/MySQL 应用程序，它将 PDF/Word 文件存储在 MySQL 表中（目前每个文件最大 40MB）。

**优点：**

*   上传的文件与其他所有文件一起复制到备份服务器，不需要单独的备份策略（高枕无忧）。
*   设置网络服务器稍微简单一些，因为我不需要上传/文件夹并告诉我所有的应用程序它在哪里。
*   我可以使用事务进行编辑以提高数据完整性 - 我不必担心孤立和丢失的文件

**缺点：**

*   mysqldump 现在需要很长时间，因为其中一个表中有 500MB 的文件数据。
*   与文件系统相比，总体而言内存/cpu 效率不是很高

我认为我的实现是成功的，它处理了备份需求并简化了项目的布局。对于使用该应用程序的 20-30 人来说，性能很好。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2008-12-08T02:19:53.493

一定要调整图像的大小，如果可以的话，检查它的格式。有一些恶意文件被不知情的主机上传和提供服务的案例——例如，[GIFAR](http://hackaday.com/2008/08/04/the-gifar-image-vulnerability/)漏洞允许您在 GIF 文件中隐藏恶意 Java 小程序，然后能够读取当前上下文中的 cookie 并将它们发送到另一个用于跨站点脚本攻击的站点。调整图像大小通常可以防止这种情况发生，因为它会破坏嵌入的代码。虽然这种攻击已被 JVM 补丁修复，但天真地提供二进制文件而不清理它们会使您面临一系列漏洞。

请记住，大多数病毒扫描程序只能针对文件系统运行——如果您将二进制文件存储在数据库中，您将无法非常轻松地针对它们运行扫描程序。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2016-06-29T16:17:13.763

***这基本上是我做的。***

1.  将上传的图像存储在临时目录或内存中。
2.  在永久存储之前处理该图像。2.1。色彩校正 2.2。压缩 2.3。根据图像尺寸创建多个副本 2.4。使用 .xl、.lg、.md、.sm 等后缀重命名
3.  将所有已处理的图像文件（来自单个文件）打包到一个文件夹中，文件夹名称将与（或可能是随机名称作为图像名称）`id`一起存储在任何行/文档的数据库中。`image file name`
4.  如果不存在，则创建**yyyy/mm/d文件夹。** `path`例如 2016 年 8 月 21 日。记住该路径并存储在数据库中以获取相同的文档和行。
5.  将图像文件夹移动`id`到`path`文件夹。（路径文件夹可能位于 /var/web-content 文件夹中。）
6.  刷新内存缓冲区或删除临时文件。

* * *

当您需要访问文档中提到的任何图像时，您拥有文件夹的路径和 ID，而不是包含图像。例如`/var/web-content/{{path}}/{{id}}/image-file-name.sm.jpg`

这样，如果您必须删除所有已处理的图像文件，只需递归删除文件夹及其内容即可。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-12-08T02:12:25.287

我在我的网站上使用上传的图片，我肯定会说选项 a)。

我强烈推荐的另一件事是立即将文件名从用户命名的照片更改为更易于管理的名称。例如带有日期和时间的东西来唯一标识每张图片。

它还有助于去除用户文件名中的任何奇怪字符，以避免将来出现并发症。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-12-09T05:15:10.270

在 SQL Server 2008 中有一种混合方法，称为[文件流数据类型，在](http://blogs.msdn.com/rdoherty/archive/2007/10/12/getting-traction-with-sql-server-2008-filestream.aspx)[RunAs Radio #74](http://www.runasradio.com/default.aspx?showNum=74)上讨论过，这有点像两全其美。大多数人没有 2008 年的选项，但如果你有，这个选项看起来很酷

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-12-08T00:40:29.263

大多数实现是选项 A。

使用选项 B，当您将数据库中的这些位编组为可以在浏览器上显示的内容时，您会打开一大罐 whoop4ss……此外，如果数据库已关闭，则图像不可用。

我不认为空间是一个太大的问题......太字节驱动器现在是几百美元。

我们正在使用选项 A 实施，因为我们没有时间或资源来执行选项 B。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-12-08T01:58:15.223

对于自动调整大小，请尝试 imagemagick ......它被用于许多主要的开源内容/照片管理系统......而且我相信它有一些 .net 扩展。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-12-08T00:03:56.513

我们使用 A。我会将它放在共享驱动器上（除非您不打算运行多个服务器）。

如果到时候这对您来说无法扩展，那么您可以研究缓存机制。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-12-08T01:46:47.900

绝对，肯定选项 A。其他人提到数据库通常不能很好地处理 BLOB，无论它们是否被设计为这样做。另一方面，文件系统就是为这些东西而存在的。您可以选择使用 RAID 条带化，将映像分布在多个驱动器上，甚至将它们分布在地理位置不同的服务器上。

另一个优点是您的数据库备份/复制将是巨大的。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-12-09T04:40:26.720

选项 A。

加载图像后，您可以在保存之前验证格式并调整其大小。[http://www.codeproject.com](http://www.codeproject.com)上有许多 .Net 代码示例可以调整图像大小。例如： http: [//www.codeproject.com/KB/cs/Photo_Resize.aspx](http://www.codeproject.com/KB/cs/Photo_Resize.aspx)

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2011-01-13T03:38:51.220

出于安全原因，最好的做法也是避免[IE 的内容嗅探](http://code.google.com/p/doctype/wiki/ArticleContentSniffing)引起的问题，这可能允许攻击者在图像文件中上传 JavaScript，这些文件可能会在您的站点上下文中执行。因此，您可能希望在存储图像之前以某种方式转换图像（裁剪/调整大小）以防止这种攻击。[这个答案](https://stackoverflow.com/questions/2595992/image-uploading-security-issues/2596311#2596311)有一些其他的想法。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2012-04-06T14:52:17.250

好吧，我有一个类似的项目，用户将文件上传到服务器上。在我看来，选项 a) 是最好的解决方案，因为它更灵活。您必须做的是将图像存储在按子目录分类的受保护文件夹中。主目录必须由管理员设置，因为内容必须没有运行脚本（非常重要）和（读、写）保护，以免在 http 请求中访问。

我希望这可以帮助你。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-12-09T05:11:25.847

如果它们是不需要编辑的小文件，那么选项 B 是不错的选择。我更喜欢编写逻辑来存储文件和处理疯狂的目录结构问题。在一个目录中*有很多*文件是不好的。恩凯？

如果文件很大或需要不断编辑，尤其是来自 office 等程序，那么选项 A 是您的最佳选择。

在大多数情况下，这是一个偏好问题，但如果您选择选项 A，只需使目录中没有太多文件即可。如果您选择选项 B，则将带有 BLOBed 数据的表放在它自己的数据库和/或文件组中。这将有助于维护，尤其是备份/恢复。您的常规数据可能相当小，而您的图像数据会随着时间的推移而变得*庞大。*

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2016-11-18T15:43:33.560

这取决于您的要求，特别是数量、用户和搜索频率。但是，对于中小型办公室，最好的选择是使用 Apple Photos 或 Adob​​e Lightroom 之类的应用程序。它们专门用于存储、编目、索引和组织此类资源。但是，对于存储要求高、用户数量多的大型组织，建议使用数字资产管理实例化一个内容管理平台，如 Nuxeo 或 Alfresco；两者都提供了非常好的资源，确实使用简化的方法来管理大量数据来检索它们。而且，非常重要：两个平台都有一个免费（开源）选项。

# ms-access - MS Access 如何连接链接表（链接到同一个 SQL Server 数据库）？

> ID：348371
> 
> 赞同：2
> 
> 时间：2008-12-08T00:03:13.567
> 
> 标签：ms-access, join

只要每个表都链接到同一个 SQL Server 数据库中的表，我就有带有链接表的 MS Access 数据库。我在 Access 中有一个查询，它连接两个表（特别是我正在使用连接更新基于另一个表的表）。

问题是 Access 在进行联接之前是否“下载”了所有表数据？还是很聪明并在 SQL Server 上加入它？

查询是：

```
UPDATE TBL_INVOICE_CHARGES INNER JOIN TBL_ANI 
ON  (TBL_INVOICE_CHARGES.CH_CUST_ID = TBL_ANI.ANI_CUST_ID) 
AND (TBL_INVOICE_CHARGES.CH_ANI = TBL_ANI.ANI_NZ_ANI) 
SET TBL_INVOICE_CHARGES.ANI_NOTES = TBL_ANI.ANI_NOTES; 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T00:23:34.400

根据 Albert D. Kallal（Access MVP）的说法，Access 不会拉取整个表，除了复杂的视图，因为这些视图可能会搞砸。但是，最好使用服务器上的视图并链接到视图，或者使用传递查询。

更多信息：[如何在 Access 中创建 SQL 传递查询](http://support.microsoft.com/kb/303968)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T00:56:38.857

Jet 很可能会将整个事情交给 SQL Server，后者将执行索引连接，然后执行更新。换句话说，对于像您的示例这样的简单查询，这*一切*都在服务器上完成，没有一个字节被拉过网络进行本地处理。

让 Jet 拉整张桌子很容易。最简单的方法是将 Access 表达式放在 WHERE 子句中。这是一个会导致它发生的示例：

```
 WHERE Format(MyDate,"YYYY") = 2008 
```

必须拉出整个表，以便 Access 可以对表中的所有日期运行 Format() 函数。此外，它不能使用任何索引，因此会非常慢。使用 Jet 后端也会很慢，仅仅是因为它的效率太低了。编写此 WHERE 子句的正确方法是：

```
 WHERE MyDate Between #1/1/2008# And #12/31/2008# 
```

如果您在已保存的 Access 查询中编写它，它将被移交给 SQL Server 进行处理（如果您的后端数据库引擎使用的分隔符与 Jet SQL 使用的分隔符不同，则 ODBC 将发送适当的分隔符）。

但是，如果您不做那种事情，您就不太可能遇到通过网络传输过多数据的问题。事实上，Jet 非常聪明，并且在通过网络发送尽可能多的查询以进行处理方面做得非常好。例如，如果您在 SELECT 语句中调用 Access 函数，则不带 Access 函数的底层选择将被发送到服务器，然后这些函数将在 Access 中对结果集执行。对于此访问查询：

```
 SELECT Format(MyDate,"MM-DD")
   FROM MyTable
   WHERE MyDate Between #1/1/2008# And #12/31/2008# 
```

Jet 会将其发送到服务器：

```
 SELECT MyDate
   FROM MyTable
   WHERE MyDate Between #1/1/2008# And #12/31/2008# 
```

Once Jet has received from the server only the rows that match the criteria, it will only then format the date field using the Access Format() function. This also works with JOINs, especially joins on indexed fields (though non-indexed field joins will probably also be handed off to the server).

Now, sometimes Jet does guess wrong and ends up being incredibly inefficient. In those cases, you can set up views and stored procedures on the server and use passthrough queries to make sure that Jet's wrong guesses will be avoided.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-11T20:49:33.177

I've looked at SQL Profiler (unfortunately i don't have the actual log handy) and here's what i found:

*   it selects all records from both tables
*   for each record in one table calls an UPDATE So this will be slow.

# python - 在 python 中接收和发送电子邮件

> ID：348392
> 
> 赞同：42
> 
> 时间：2008-12-08T00:12:25.017
> 
> 标签：python, email

如何在 python 中接收和发送电子邮件？某种“邮件服务器”。

我正在研究制作一个应用程序来监听它是否收到一封发给 foo@bar.domain.com 的电子邮件，并向发件人发送一封电子邮件。

现在，我可以在 python 中完成这一切吗，最好使用 3rd 方库吗？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-08T02:36:49.640

这是一个非常简单的例子：

```
import smtplib

server = 'mail.server.com'
user = ''
password = ''

recipients = ['user@mail.com', 'other@mail.com']
sender = 'you@mail.com'
message = 'Hello World'

session = smtplib.SMTP(server)
# if your SMTP server doesn't need authentications,
# you don't need the following line:
session.login(user, password)
session.sendmail(sender, recipients, message) 
```

有关更多选项、错误处理等，请查看[smtplib 模块文档](http://www.python.org/doc/2.5.2/lib/module-smtplib.html)。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2014-11-06T15:28:55.267

找到了一个通过使用 IMAP 连接来阅读电子邮件的有用示例：

[Python — 带有 Gmail 的 imaplib IMAP 示例](http://yuji.wordpress.com/2011/06/22/python-imaplib-imap-example-with-gmail/)

```
import imaplib
mail = imaplib.IMAP4_SSL('imap.gmail.com')
mail.login('myusername@gmail.com', 'mypassword')
mail.list()
# Out: list of "folders" aka labels in gmail.
mail.select("inbox") # connect to inbox.
result, data = mail.search(None, "ALL")

ids = data[0] # data is a list.
id_list = ids.split() # ids is a space separated string
latest_email_id = id_list[-1] # get the latest

# fetch the email body (RFC822) for the given ID
result, data = mail.fetch(latest_email_id, "(RFC822)") 

raw_email = data[0][1] # here's the body, which is raw text of the whole email
# including headers and alternate payloads 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-12-08T12:23:21.047

我认为用 Python 编写一个真正的邮件服务器不是一个好主意。这当然是可能的（有关详细信息，请参阅 mcrute 和 Manuel Ceron 的帖子），但是当您想到真正的邮件服务器必须处理的所有事情（排队、重新传输、处理垃圾邮件等）时，工作量很大。

你应该更详细地解释你需要什么。如果您只想对收到的电子邮件做出反应，我建议将邮件服务器配置为在收到电子邮件时调用程序。这个程序可以做它想做的事（更新数据库、创建文件、与另一个 Python 程序对话）。

要从邮件服务器调用任意程序，您有多种选择：

1.  对于 sendmail 和 Postfix，`~/.forward`包含`"|/path/to/program"`
2.  如果你使用 procmail，一个配方操作`|path/to/program`
3.  当然还有很多其他人

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-12-08T00:39:49.127

Python 有一个 SMTPD 模块，可以帮助您编写服务器。您可能还希望 SMTP 模块进行重新发送。至少从 2.3 版开始，这两个模块都在标准库中。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-08T00:21:53.733

在开发您的应用程序时，poplib 和 smtplib 将成为您的朋友。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-08T09:37:39.743

发送部分已经介绍过了，接收可以使用[pop](http://docs.python.org/library/poplib.html)或者[imap](http://docs.python.org/library/imaplib.html)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-08T03:06:33.167

根据您发送的邮件数量，您可能需要考虑使用真正的邮件服务器，如 postifx 或 sendmail（*nix 系统）这两个程序都能够根据电子邮件地址将收到的邮件发送到程序。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2015-06-04T16:35:48.867

最好的方法是在 python 中创建一个使用 imaplib2 接收电子邮件的 Windows 服务

下面是一个执行相同操作的示例 python 脚本。您可以通过在命令行“python THENAMEOFYOURSCRIPTFILE.py install”上运行以下命令来安装此脚本以作为 Windows 服务运行。

```
import win32service
import win32event
import servicemanager
import socket
import imaplib2, time
from threading import *
import smtplib
from email.MIMEMultipart import MIMEMultipart
from email.MIMEText import MIMEText
import datetime
import email

class Idler(object):
    def __init__(self, conn):
        self.thread = Thread(target=self.idle)
        self.M = conn
        self.event = Event()

    def start(self):
        self.thread.start()

    def stop(self):
        self.event.set()

    def join(self):
        self.thread.join()

    def idle(self):
        while True:
            if self.event.isSet():
                return
            self.needsync = False
            def callback(args):
                if not self.event.isSet():
                    self.needsync = True
                    self.event.set()
            self.M.idle(callback=callback)
            self.event.wait()
            if self.needsync:
                self.event.clear()
                self.dosync()

    def dosync(self):
        #DO SOMETHING HERE WHEN YOU RECEIVE YOUR EMAIL

class AppServerSvc (win32serviceutil.ServiceFramework):
    _svc_name_ = "receiveemail"
    _svc_display_name_ = "receiveemail"

    def __init__(self,args):
        win32serviceutil.ServiceFramework.__init__(self,args)
        self.hWaitStop = win32event.CreateEvent(None,0,0,None)
        socket.setdefaulttimeout(60)

    def SvcStop(self):
        self.ReportServiceStatus(win32service.SERVICE_STOP_PENDING)
        win32event.SetEvent(self.hWaitStop)

    def SvcDoRun(self):
        servicemanager.LogMsg(servicemanager.EVENTLOG_INFORMATION_TYPE,
                              servicemanager.PYS_SERVICE_STARTED,
                              (self._svc_name_,''))
        self.main()

    def main(self):
        M = imaplib2.IMAP4_SSL("imap.gmail.com", 993)
        M.login("YourID", "password")
        M.select("INBOX")
        idler = Idler(M)
        idler.start()
        while True:
            time.sleep(1*60)
        idler.stop()
        idler.join()
        M.close()
        M.logout()

if __name__ == '__main__':
    win32serviceutil.HandleCommandLine(AppServerSvc) 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-01-25T21:43:43.433

您可以使用[电子邮件](https://pypi.org/project/emailpy)

通过安装`pip3 install emailpy`

```
import emailpy
manager = emailpy.EmailManager('your email', 'your password')
msg = manager.send(['who you are sending to', 'the other email you are sending to', subject='hello', body='this email is sent from Python', html='<h1>Hello World!</h1>', attachments=['yourfile.txt', 'yourotherfile.py'])
while not msg.sent:
    pass
print('sent')
messages = manager.read()
for message in messages:
    print(message.sender, message.date, message.subject, message.body, message.html, message.attachments)
    for attachment in message.attachments:
        print(attachment.name)
        attachment.download() 
```

# java - 有没有办法在 Java 中使用注释来替换访问器？

> ID：348408
> 
> 赞同：11
> 
> 时间：2008-12-08T00:23:22.077
> 
> 标签：java, annotations, metaprogramming

我对 Java 5 注释有点陌生，我很好奇是否有可能：

此注释将为您生成一个简单的 getter 和 setter。

```
@attribute
private String var = ""; 
```

注释表明变量不能为空，`@NotNull`因此您不必每次都编写该样板代码。

```
/*
 * @param s @NotNull
 */
public void setString(String s){
    ...
} 
```

这些中的任何一个都可以吗？如果可以的话，它们似乎是我写注释的第一件事。因为当我阅读文档时我看不到太多关于这些的内容，所以我假设这并不是注释的真正含义。这里的任何方向将不胜感激。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-08T10:31:38.727

注释处理发生在抽象语法树上。这是解析器创建和编译器操作的结构。

当前的规范（链接来）说注释处理器不能改变抽象语法树。这样做的后果之一是不适合进行代码生成。

如果您喜欢这种功能，请查看[XDoclet](http://xdoclet.sourceforge.net/xdoclet/index.html)。这应该为您提供我认为您正在寻找的代码生成预处理。

对于您的`@NonNull`示例，[JSR-305](http://jcp.org/en/jsr/detail?id=305)是一[组](http://today.java.net/cs/user/print/a/549)用于增强软件缺陷检测的注释，包括`@NonNull`和`@CheckForNull`以及许多其他注释。

*编辑*：[Project Lombok](http://projectlombok.org/features/index.html)正好解决了 getter 和 setter 生成的问题。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2010-02-02T18:06:01.947

Getters/Setters：是的，这是可能的。[Lombok 项目](http://projectlombok.org/features/index.html)( [http://projectlombok.org/index.html](http://projectlombok.org/index.html) ) 定义了用于生成 getter/setter 等的 注释。

所以例如

```
@lombok.Data;
public class Person {
   private final String name;
   private int age;
} 
```

将生成`getName`（没有设置器，因为变量是最终的）和`getAge`/ `setAge`。它还将生成`equals`、`hashCode`和`toString`初始化所需字段的构造函数（`name`在本例中）。添加`@AllArgsConstructor`将生成一个初始化两个字段的构造函数。使用[`@Value`](https://projectlombok.org/features/Value)而不是`@Data`将使对象不可变。

还有其他注释和参数可以让您控制访问权限（您的 getter 是否应该受到保护或公开）、名称（`getName()`或`name()`？）等。还有更多。例如，我非常喜欢[构建器](https://projectlombok.org/features/Builder)和[扩展方法](https://projectlombok.org/features/experimental/ExtensionMethod)的注释。

Lombok 非常易于使用：

*   只需下载 jar 并使用注释，自动生成的 getter/setter 可以在您的代码中使用，而无需实际拼写出来。
*   注释仅在编译期间而不是在运行时使用，因此您不要将 lombok 与您的 jar 一起分发。
*   大多数 IDE 都支持这一点，因此您可以在代码完成、导航等中看到 getter/setter。在 Netbeans 中，这是[开箱即用的](https://projectlombok.org/setup/netbeans)。在 IntelliJ IDEA 中使用[Lombok 插件](https://plugins.jetbrains.com/plugin/6317-lombok)。

NotNull：findbugs 和 IDEA IDE 支持，也许还有其他支持

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-08T01:21:03.457

> 有没有办法在 Java 中使用注释来替换访问器？

简而言之，不，Java 5/6 编译器不支持此功能，第三方很难以与编译器无关的方式添加此类支持。

为了更好地处理注释，我将从[JUnit](http://www.junit.org/)开始。如果您为版本 3（预注释）和 4（基于注释）编写代码，您很快就会了解框架如何将基于命名模式的合同替换为基于注释的合同。

举一个更生动的例子，比较 EJB 2 和 EJB 3。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-08T10:48:13.890

您所指的@attribute 也不能与注释一起使用，因为它们现在在Java 中（正如jamesh 指出的那样）。

您可能正在寻找的是Java 中尚不存在的“[属性”。](http://blogs.oracle.com/joe/entry/java_properties_and_events)但它现在是一个非常热门的话题，我们可能会在 Java 7 或 Java 8 中得到它们（因为我仍然停留在 1.4.2 上，它对我没有帮助，但它可能会帮助你）。

[在Java Posse 第 219 集中](http://www.javaposse.com/index.php?post_id=409091)，有一个有趣的讨论暗示使用注释实现属性。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-08T12:42:49.713

有一个名为 OVal 的项目，我认为它可以满足您的需求。 [http://oval.sourceforge.net/](http://oval.sourceforge.net/)

如果我记得之前需要 AspectJ 的话，但是没有 AspectJ 的简单检查工作。看看这个。

还有 Hibernate Validator，也检查一下：P

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-25T14:29:16.117

这是可能的，只是不是在你声明它们的地方。

查看[http://code.google.com/p/javadude/wiki/Annotations](http://code.google.com/p/javadude/wiki/Annotations)。

我有一个类注释为

```
package sample;
import com.javadude.annotation.Bean;
import com.javadude.annotation.Property;
import com.javadude.annotation.PropertyKind; 

@Bean(properties={
    @Property(name="name"),
    @Property(name="phone", bound=true),
    @Property(name="friend", type=Person.class, kind=PropertyKind.LIST)
})
public class Person extends PersonGen {} 
```

它会为你生成 PersonGen 类，包含 getter/setter 等

处理器也做得更多。请注意，我正在开发一个新版本，它与当前版本相比有一点 API 损坏

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-02-02T18:29:54.553

尽管它们有时很有用，但如果您严重缺少属性，那么您可能在整个 OO 设计方面有点不稳定。

OO 设计的理念是，方法是“动作”，您要求对象为您做某事——不仅仅是设置或获取值——这不是一个对象，而是一个结构。

如果您认为缺少属性是一个严重的问题，我强烈建议您尝试编码一段时间，而不要使用 setter 和抵制 getter。

一开始可能很难，但我敢打赌，到最后你会更牢固地掌握 OO 设计原则。

（注意：在极少数情况下，您必须在构建对象后执行“setter”类型操作——最常见的情况是您必须创建两个相互引用的对象。在这种情况下，我建议您使用类似构建器模式的东西setter 必须被调用一次并且被保护不被调用两次）

# php - 基于另一个数组的键对数组进行排序？

> ID：348410
> 
> 赞同：175
> 
> 时间：2008-12-08T00:24:15.740
> 
> 标签：php, arrays, sorting

在 PHP 中可以做这样的事情吗？您将如何编写函数？这是一个例子。顺序是最重要的。

```
$customer['address'] = '123 fake st';
$customer['name'] = 'Tim';
$customer['dob'] = '12/08/1986';
$customer['dontSortMe'] = 'this value doesnt need to be sorted'; 
```

我想做一些类似的事情

```
$properOrderedArray = sortArrayByArray($customer, array('name', 'dob', 'address')); 
```

因为最后我使用了一个 foreach() 并且它们的顺序不正确（因为我将值附加到一个需要以正确顺序排列的字符串并且我事先不知道所有数组键/值）。

我查看了 PHP 的内部数组函数，但似乎只能按字母或数字排序。

* * *

## 回答 #1

> 赞同：394
> 
> 时间：2012-02-01T15:41:13.017

只需使用[`array_merge`](https://www.php.net/manual/en/function.array-merge.php)or [`array_replace`](https://www.php.net/manual/en/function.array-replace.php)。`array_merge`通过从您提供的数组开始（以正确的顺序）并使用实际数组中的数据覆盖/添加键来工作：

```
$customer['address']    = '123 fake st';
$customer['name']       = 'Tim';
$customer['dob']        = '12/08/1986';
$customer['dontSortMe'] = 'this value doesnt need to be sorted';

$properOrderedArray = array_merge(array_flip(array('name', 'dob', 'address')), $customer);
// or
$properOrderedArray = array_replace(array_flip(array('name', 'dob', 'address')), $customer);

// $properOrderedArray: array(
//   'name'       => 'Tim',
//   'dob'        => '12/08/1986',
//   'address'    => '123 fake st',
//   'dontSortMe' => 'this value doesnt need to be sorted') 
```

PS：我正在回答这个“陈旧”的问题，因为我认为作为先前答案给出的所有循环都过大了。

* * *

## 回答 #2

> 赞同：114
> 
> 时间：2008-12-08T00:32:45.067

你去：

```
function sortArrayByArray(array $array, array $orderArray) {
    $ordered = array();
    foreach ($orderArray as $key) {
        if (array_key_exists($key, $array)) {
            $ordered[$key] = $array[$key];
            unset($array[$key]);
        }
    }
    return $ordered + $array;
} 
```

* * *

## 回答 #3

> 赞同：54
> 
> 时间：2014-11-25T13:59:12.293

这个解决方案怎么样

```
$order = array(1,5,2,4,3,6);

$array = array(
    1 => 'one',
    2 => 'two',
    3 => 'three',
    4 => 'four',
    5 => 'five',
    6 => 'six'
);

uksort($array, function($key1, $key2) use ($order) {
    return (array_search($key1, $order) > array_search($key2, $order));
}); 
```

* * *

## 回答 #4

> 赞同：41
> 
> 时间：2013-03-31T13:48:24.223

PHP >= 5.3.0 的另一种方式：

```
$customer['address'] = '123 fake st';
$customer['name'] = 'Tim';
$customer['dob'] = '12/08/1986';
$customer['dontSortMe'] = 'this value doesnt need to be sorted';

$customerSorted = array_replace(array_flip(array('name', 'dob', 'address')), $customer); 
```

结果：

```
Array (
  [name] => Tim
  [dob] => 12/08/1986
  [address] => 123 fake st
  [dontSortMe] => this value doesnt need to be sorted
) 
```

适用于字符串和数字键。

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2008-12-08T05:27:22.523

```
function sortArrayByArray(array $toSort, array $sortByValuesAsKeys)
{
    $commonKeysInOrder = array_intersect_key(array_flip($sortByValuesAsKeys), $toSort);
    $commonKeysWithValue = array_intersect_key($toSort, $commonKeysInOrder);
    $sorted = array_merge($commonKeysInOrder, $commonKeysWithValue);
    return $sorted;
} 
```

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2011-12-28T18:20:52.670

取一个数组作为您的订单：

```
$order = array('north', 'east', 'south', 'west'); 
```

[`array_intersect`^(*您可以使用Docs*)](http://php.net/array_intersect)根据值对另一个数组进行排序：

```
/* sort by value: */
$array = array('south', 'west', 'north');
$sorted = array_intersect($order, $array);
print_r($sorted); 
```

或者在您的情况下，要按键排序，请使用[`array_intersect_key`^(*Docs*)](http://php.net/array_intersect_key)：

```
/* sort by key: */
$array = array_flip($array);
$sorted = array_intersect_key(array_flip($order), $array);
print_r($sorted); 
```

这两个函数都将保持第一个参数的顺序，并且只返回第二个数组中的值（或键）。

因此，对于这两种标准情况，您不需要自己编写函数来执行排序/重新排列。

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2017-06-27T07:45:19.593

我使用了 Darkwaltz4 的解决方案，但`array_fill_keys`如果`array_flip`没有`NULL`在`$array`.

```
$properOrderedArray = array_replace(array_fill_keys($keys, null), $array); 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2018-04-06T09:48:37.313

没有魔法...

```
$array=array(28=>c,4=>b,5=>a);
$seq=array(5,4,28);    
SortByKeyList($array,$seq) result: array(5=>a,4=>b,28=>c);

function sortByKeyList($array,$seq){
    $ret=array();
    if(empty($array) || empty($seq)) return false;
    foreach($seq as $key){$ret[$key]=$dataset[$key];}
    return $ret;
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-10-29T21:22:48.340

如果您的数组中有数组，则必须稍微调整 Eran 的函数...

```
function sortArrayByArray($array,$orderArray) {
    $ordered = array();
    foreach($orderArray as $key => $value) {
        if(array_key_exists($key,$array)) {
                $ordered[$key] = $array[$key];
                unset($array[$key]);
        }
    }
    return $ordered + $array;
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2014-10-25T15:12:21.103

PHP 具有帮助您解决此问题的函数：

```
$arrayToBeSorted = array('west', 'east', 'south', 'north');
$order = array('north', 'south', 'east', 'west');

// sort array
usort($arrayToBeSorted, function($a, $b) use ($order){
    // sort using the numeric index of the second array
    $valA = array_search($a, $order);
    $valB = array_search($b, $order);

    // move items that don't match to end
    if ($valA === false)
        return -1;
    if ($valB === false)
        return 0;

    if ($valA > $valB)
        return 1;
    if ($valA < $valB)
        return -1;
    return 0;
}); 
```

Usort 为您完成所有工作，而 array_search 提供密钥。array_search() 在找不到匹配项时返回 false，因此不在排序数组中的项目自然会移动到数组的底部。

注意：uasort() 将对数组进行排序而不影响键 => 值关系。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2017-01-20T20:25:32.080

此函数根据第二个参数 $keys 返回一个子数组和排序数组

```
function array_sub_sort(array $values, array $keys){
    $keys = array_flip($keys);
    return array_merge(array_intersect_key($keys, $values), array_intersect_key($values, $keys));
} 
```

例子：

```
$array_complete = [
    'a' => 1,
    'c' => 3,
    'd' => 4,
    'e' => 5,
    'b' => 2
];

$array_sub_sorted = array_sub_sort($array_complete, ['a', 'b', 'c']);//return ['a' => 1, 'b' => 2, 'c' => 3]; 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-09-18T05:33:25.940

第一个建议

```
function sortArrayByArray($array,$orderArray) {
    $ordered = array();
    foreach($orderArray as $key) {
        if(array_key_exists($key,$array)) {
            $ordered[$key] = $array[$key];
            unset($array[$key]);
        }
    }
    return $ordered + $array;
} 
```

第二个建议

```
$properOrderedArray = array_merge(array_flip(array('name', 'dob', 'address')), $customer); 
```

我想指出，这两个建议都很棒。然而，它们是苹果和橙子。区别？一种是非关联友好的，另一种是关联友好的。如果您使用 2 个完全关联数组，则数组合并/翻转实际上将合并并覆盖另一个关联数组。就我而言，这不是我想要的结果。我使用了一个 settings.ini 文件来创建我的排序顺序数组。我正在排序的数据数组不需要由我的关联排序对应对象覆盖。因此数组合并会破坏我的数据数组。两者都是很好的方法，都需要存档在任何开发人员工具箱中。根据您的需要，您可能会发现您的档案中实际上需要这两个概念。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-02-25T13:43:11.730

为了简洁起见，我采用了@Darkwaltz4 的答案，并想分享我如何将解决方案调整到数组可能包含每次迭代的不同键的情况，如下所示：

```
Array[0] ...
['dob'] = '12/08/1986';
['some_key'] = 'some value';

Array[1] ...
['dob'] = '12/08/1986';

Array[2] ...
['dob'] = '12/08/1986';
['some_key'] = 'some other value'; 
```

并保持这样的“万能钥匙”：

```
$master_key = array( 'dob' => ' ' ,  'some_key' => ' ' ); 
```

array_merge 将在基于 $master_key 的 Array[1] 迭代中执行合并，并为该迭代生成 ['some_key'] = ''，一个空值。因此，array_intersect_key 用于在每次迭代中修改 $master_key，如下所示：

```
foreach ($customer as $customer) {
  $modified_key = array_intersect_key($master_key, $unordered_array);
  $properOrderedArray = array_merge($modified_key, $customer);
} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2015-10-29T13:13:06.457

有点晚了，但我找不到实现它的方式，这个版本需要关闭，php>=5.3，但可以更改为：

```
$customer['address'] = '123 fake st';
$customer['name'] = 'Tim';
$customer['dob'] = '12/08/1986';
$customer['dontSortMe'] = 'this value doesnt need to be sorted';

$order = array('name', 'dob', 'address');

$keys= array_flip($order);
uksort($customer, function($a, $b)use($keys){
    return $keys[$a] - $keys[$b];
});
print_r($customer); 
```

当然 'dontSortMe' 是需要整理出来的，可能会出现在例子的最前面

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2016-12-29T10:21:57.490

*   按要求排序
*   保存 int-keys (因为 array_replace)
*   不返回键在 inputArray 中不存在
*   （可选）过滤给定 keyList 中不存在的键

代码：

```
 /**
 * sort keys like in key list
 * filter: remove keys are not listed in keyList
 * ['c'=>'red', 'd'=>'2016-12-29'] = sortAndFilterKeys(['d'=>'2016-12-29', 'c'=>'red', 'a'=>3 ]], ['c', 'd', 'z']){
 *
 * @param array $inputArray
 * @param string[]|int[] $keyList
 * @param bool $removeUnknownKeys
 * @return array
 */
static public function sortAndFilterKeys($inputArray, $keyList, $removeUnknownKeys=true){
    $keysAsKeys = array_flip($keyList);
    $result = array_replace($keysAsKeys, $inputArray); // result = sorted keys + values from input + 
    $result = array_intersect_key($result, $inputArray); // remove keys are not existing in inputArray 
    if( $removeUnknownKeys ){
        $result = array_intersect_key($result, $keysAsKeys); // remove keys are not existing in keyList 
    }
    return $result;
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-07-29T14:35:16.330

如果您有这样的数组，并且需要根据顺序对数组进行排序，则可以轻松使用以下代码：

```
$order = ['a', 'b', 'c', 'd', 'e'];
$needToSortArray = ['d', 'c', 'e'];

uksort($needToSortArray, function($key1, $key2) use ($order, $needToSortArray) {
    return (array_search($needToSortArray[$key1], $order) > array_search($needToSortArray[$key2], $order));
}); 
```

# c# - (N)Hibernate 在查询中选择常量

> ID：348412
> 
> 赞同：2
> 
> 时间：2008-12-08T00:25:38.733
> 
> 标签：c#, nhibernate, hibernate

**有谁知道你是否可以使用 (N)Hibernate标准**api做这样的事情：

```
Select 1 AS obj.Property0, obj.Property1, obj.Property2 from Class 
```

Baiscally 我想为查询中的一个属性选择一个常量值。我可以使用 HQL 轻松做到这一点，但我想知道是否有人知道使用标准 api 的方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T01:47:56.243

您可以通过使用 SQLProjection 来做到这一点：

```
projections.Add(Projections.SqlProjection("1 as PropertyName", new[] {"PropertyName"},
                                                          new IType[] {NHibernateUtil.Int32})); 
```

# performance - 在 PostgreSQL 中，在同一个表中包含 TEXT 列是否比单独的表中更快？

> ID：348416
> 
> 赞同：10
> 
> 时间：2008-12-08T00:30:58.660
> 
> 标签：performance, postgresql, join

您认为哪种设计在 PostgreSQL 上运行得更快？

1.  制作一个 15 列的 varchars 等表，但将所有 TEXT 列放在一个单独的表中，并通过 fkey 链接返回到该表。假设您要搜索 ID 为“4”的记录，然后将所有行拉回，包括连接表中 TEXT 列中的内容。让我们假设这些表有 500,000 行。

2.  制作一个 15 列的 varchars 等表，并将您的 TEXT 列包含在同一个表中。再次想象与上面相同的情况——获取记录 ID 4 并提取完整记录，表中有 500,000 行。

我的意思是，在大多数数据库中，按照我的理解，当您深入了解这些 TEXT 列如何工作的物理层时，它们实际上在每一行的表列中保留了一个小 ID，并且该 ID 单独存在，数据库中的独占页块（或其他命名法）。所以，对我来说，似乎选项 B 会运行得更快，因为不需要 fkey 连接的开销，并且因为 TEXT 列实际上并没有占用该给定表中该列中的整数空间——并且该整数是数据库中其他地方页面块的键。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-09T23:27:51.203

PostgreSQL 处理 TEXT 列的方式与其他 DBMS 不同。

从他们的文档中：

> 提示：这三种类型之间没有性能差异，除了在使用空白填充类型时增加了存储大小，以及在存储到长度受限的列时需要几个额外的周期来检查长度。虽然 character(n) 在其他一些数据库系统中具有性能优势，但在 PostgreSQL 中没有这样的优势。在大多数情况下，应改为使用文本或字符变化。

[查看手册](http://www.postgresql.org/docs/8.3/static/datatype-character.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-08T09:07:54.013

(B) 是正确的，原因在问题本身中给出。

# .net - 更新多行 Linq vs SQL

> ID：348417
> 
> 赞同：17
> 
> 时间：2008-12-08T00:32:32.090
> 
> 标签：.net, sql, linq

前段时间我写了一段代码来更新数据库表中的多行。代码是这样的

```
var db = new MyDataContext();
db.Execute("UPDATE Details SET IsActive = 0 WHERE MasterId = 1"); 
```

然后有一天当我得到最新版本的文件时，我看到有人将代码更改为这样的

```
var details = from d in db.details where d.MasterId == 1 select d;
foreach (var detail in details)
  detail.IsActive = false;
db.SubmitChanges(); 
```

所以我的问题是：更新多行的更好方法是什么？使用 Linq 还是 SQL？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-08T00:50:36.763

检查本文中使用的方法：

*   [使用 LINQ to SQL 批量更新和删除](https://terryaney.wordpress.com/2008/04/14/batch-updates-and-deletes-with-linq-to-sql/)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-08T00:42:12.367

我想说这取决于数据库的效率还是抽象对您来说更重要。SQL 方式将在您的代码中创建一个更难跟踪但更有效的依赖项。引用的 LINQ 示例消除了对手动编码 SQL 的依赖，但涉及至少 2 个查询和一些服务器端处理。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-11-11T21:49:51.900

PLINQO 实现了批量更新和删除，plinqo 生成的每个实体都可以使用批量更新和删除操作。

```
context.Task.Update(t => t.Id == 1, t2 => new Task {StatusId = 2}); 
```

这将执行一个`Update Task Set StatusId = 2 Where Id = 1`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-28T17:48:35.347

```
for (int i = 0; i < pListOrderDetail.Count; i++)
{
    for (int j = 0; j < stempdata.Count; j++)
    {
        pListOrderDetail[i].OrderID = pOrderID;
        pListOrderDetail[i].ProductID = stempdata[j].pProductID;
        pListOrderDetail[i].Quantity = stempdata[j].pQuantity;
        pListOrderDetail[i].UnitPrice = stempdata[j].pUnitPrice;
        pListOrderDetail[i].Discount = stempdata[j].pDiscount;
        db.SubmitChanges();
        break;
    }
    continue;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-01-11T11:21:35.033

Linq-to-SQL 版本将查找与查询匹配的表中的`SELECT`每一行`details`，将它们拉入内存，并为它们创建对象。然后，当它应用更新时，它将`UPDATE`为每个对象使用单独的语句，并且（默认情况下）将包含一个`WHERE`检查每一列的值的子句，以确保它在您执行`SELECT`. 如果行已更改，Linq 将抛出异常。

**代码的Linq**版本会慢得多（想想慢 100 倍或 1000 倍），并让您面临额外的异常。

当您将来重构代码时，SQL 版本可能会更难维护，但它将为您的数据库带来天壤之别。

我通常认为 Linq-to-SQL 非常适合选择和单独更新，也许对于小批量数据库会足够快，以至于额外的查询不会成为问题，但在使用 Linq 之前我必须仔细考虑大批量，或在 Web 服务器上。

# c# - 如何按字母顺序对数据网格中的列标题进行排序？C＃

> ID：348419
> 
> 赞同：5
> 
> 时间：2008-12-08T00:34:44.610
> 
> 标签：c#, winforms, datagridview

我有一个包含列标题的排序列表，如何重新排列我的 datagridview 使其与排序列表的顺序相同？

我已经尝试了下面的代码，但这并不总是有效，有些列没有正确排序。感谢您对此的任何帮助。

```
sortedColumnNames.Sort();

    foreach (DataGridViewColumn col in dataGridView1.Columns)
                    {
                        col.DisplayIndex = sortedColumnNames.IndexOf(col.HeaderText);
                    } 
```

sortedColumnNames: athens crete corfu kefalonia mykonos rhodes santorini skiathos zante

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-08T01:27:25.253

我无法判断您的问题是否`SortedColumnNames`是未正确排序（不是），或者是否为列分配了与列表中显示的顺序不同的顺序。

如果是后者，可能*是*因为您在迭代集合时修改了集合中项目的顺序。虽然我没有在我正在运行的任何测试中看到这种情况。

作为一般规则，我不会弄乱我正在迭代的集合的成员资格*或顺序。*我以这种方式实现列排序：

```
void SortDataGridViewColumns(DataGridView dgv)
{
    var list = from DataGridViewColumn c in dgv.Columns
               orderby c.HeaderText
               select c;

    int i = 0;
    foreach (DataGridViewColumn c in list)
    {
        c.DisplayIndex = i++;
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-09T11:38:03.273

你可以这样做：

1.  将所有列添加到 List tmpColumns
2.  从 dgv.Columns 中删除所有列
3.  按名称对 tmpColumns 进行排序
4.  将列从 tmpColumns 添加回 dgv.Columns 并将其 DisplayIndex 设置为下一个值 0、1、2 等等。

这并不理想，但它有效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T01:21:33.753

看起来应该可以。我刚刚编写了一个快速应用程序进行测试，它运行良好。你能确定它什么时候工作，什么时候不工作吗？当您说它们不起作用时，是否总是相同的列出现故障？

# java - 在通过 Ant 进行 Junit 测试期间无法在 Jar 中找到属性文件

> ID：348421
> 
> 赞同：3
> 
> 时间：2008-12-08T00:37:31.627
> 
> 标签：java, eclipse, ant

我在通过 Ant 运行 Junit 测试时遇到问题。我似乎无法让 Ant 看到它需要加载我的项目需要的 dll 的属性文件。我所有的测试都使用 Elcipse 中的 Junit GUI，所以我很确定测试本身没有问题。我认为我的问题与类路径有关，但我似乎找不到问题。

jar 结构：/root/folder/../Foo.properties

## 这是在库中加载属性文件的方式：

```
// load class properties
props = PropertyLoader.loadProperties(Foo.class);

public static Properties loadProperties(Class className) {
    return loadProperties(className.getName());
}

public static Properties loadProperties(final String propsName) {
    Properties props = null;
    InputStream in = null;
    try {
      ClassLoader cl = ClassLoader.getSystemClassLoader();
      String name = propsName.replace('.', '/').concat(".properties");

      in = cl.getResourceAsStream(name);
      if (in != null) {
        props = new Properties();
        props.load(in);
      }
    }
    catch (Exception e) {
      props = null;
    }
    finally {
      if (props == null) {
        System.err.print("Property file " + propsName + " doesn't exist. System terminated.");
        System.exit(0);
      }
    }

    return props;
  } 
```

## 除了有问题的构建文件：

```
<!-- Pattern of source files to copy into classpath-->
    <property name="source.files.tocopy"
        value="**/*.properties,**/*.dtd,**/*.xml,**/*.jpg" />

    <path id="compile.classpath">
        <fileset dir="lib">
            <include name="*.jar" />
        </fileset>
    </path>

    <!-- Generate Class-Path entry for the JAR's Manifest -->
    <pathconvert property="manifest.classpath" 
        pathsep=" " dirsep="\">
        <map from="${basedir}/" to="" />
        <fileset dir="lib">
            <include name="*.jar" />
        </fileset>
    </pathconvert>

    <!-- Run tests against the JAR -->
    <path id="test.compile.classpath">
        <path refid="compile.classpath" />
        <pathelement location="${target.jar}" />
    </path>

    <path id="test.classpath">
        <path refid="test.compile.classpath" />
        <pathelement location="${test.classes.dir}" />
    </path>

    <!-- - - - - - - - - - - - - - - - - - 
          target: test-compile                      
         - - - - - - - - - - - - - - - - - -->
    <target name="test-compile" depends="compile, test-init"
        description="Compiles our testing code">

        <javac destdir="${test.classes.dir}"
                debug="true"
                includeAntRuntime="true"
                srcdir="test">
            <classpath refid="test.compile.classpath" />
        </javac>

        <copy todir="${test.classes.dir}">
            <fileset dir="test" includes="${source.files.tocopy}"/>
            <fileset dir="resources" includes="${source.files.tocopy}"/>
        </copy>

    </target>

    <!-- ================================= 
          target: test              
         ================================= -->
    <target name="test" depends="test-compile, optional-tests">

        <description>
            Runs our tests, generates reports, and stops 
            the build on failure.  Optionally runs one test.
        </description>

        <junit printsummary="false" 
            errorProperty="test.failed" 
            failureProperty="test.failed">
            <classpath>
                <path refid="test.classpath" />
            </classpath>            
            <sysproperty key="test.properties" value="${test.properties.file}"/>
            <formatter type="brief" usefile="false" />
            <formatter type="xml" />
            <test name="${testcase}" todir="${test.data.dir}" if="testcase" />
            <batchtest todir="${test.data.dir}" unless="testcase">
                <fileset dir="${test.classes.dir}">
                    <patternset>
                        <include name="**/test/*Test.class" />
                        <exclude name="**/test/*Printer*.class" unless="test.properties.file" />
                    </patternset>
                </fileset>
            </batchtest>
        </junit> 
```

我真的可以使用第二双眼睛，因此感谢您的帮助。提前致谢！

——查理

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T21:39:02.063

我发现在某些情况下，jar 中的属性文件不能位于根文件夹中。将其移动到 jar 内的目录中，然后使用 getResourceAsStream。

卡尔

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T09:49:50.077

尝试使用 getResource 来查看 eclipse 中返回的 URL，并查看是否可以获得要在单元测试中显示的 url。也许您需要传递实际类文件的名称来获取它

```
clazz.getResource(clazz.getName()+".class") 
```

在运行单元测试之前检查文件是否已复制，以便文件实际放置在运行单元测试时在类路径上使用的输出文件夹中。

eclipse在编译java文件的时候，也会自动把所有非java文件复制到输出目录下。这就是为什么在 Eclipse 的类路径中可以访问该文件的原因。如果在编译期间不将非 java 文件复制到构建目标文件夹，则不会复制属性文件。尽管您已经准备好复制文件，但它确实从您的构建文件中查看。您可以在浏览文件夹时进行相同的验证吗？

此外，您不应该在代码中使用 System.exit(0)，除了小程序。最好让异常传播到主函数并终止程序。原因是您最终得到了一个库，该库将在 Java 进程使用和失败时终止。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T15:14:38.627

调试的第一步`ant`总是：

1.  `ant -verbose`
2.  `ant -debug`

`junit`查看与测试相关的那些目标的输出。

如果您在那里找到解决问题的其他信息，那太好了！如果没有，请使用输出中的相关信息编辑问题。

# excel - 从 MS Access 中将交叉表查询结果导出到 Excel

> ID：348428
> 
> 赞同：3
> 
> 时间：2008-12-08T00:43:16.107
> 
> 标签：excel, ms-access, export

我一直在尝试使用 Access 2003 将交叉表查询结果集导出到 Excel，但成功有限。有时，导出工作正常，并且 Excel 显示没有错误。其他时候，使用完全相同的查询参数，我得到一个 3190 错误 - 字段太多。我在从 VB 代码调用的宏中使用 TransferSpreadsheet 选项。

该宏具有以下参数： 传输类型：导出电子表格类型：Microsoft Excel 8-10 表名：（这是我的查询名称） 文件名：（Excel 输出文件，存在于目录中） 具有字段名称：是

查询不应产生超过 14 列的信息，因此 Excel 255 列限制应该不是问题。此外，在我查询期间数据库中的数据没有变化，因此相同的查询将产生相同的结果集。

到目前为止，我在网上阅读的唯一解决方案之一是在运行宏之前关闭记录集，但这是命中或未命中。

非常感谢您的想法/帮助！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T15:25:48.807

我有一个作为 MS Access 宏工作。它使用 OutputTo Action 与：

*   对象类型=查询
*   对象名称=[WhateverQueryName]
*   输出格式=MicrosoftExcel(*.xls)
*   自动启动=否
*   （其余全部空白）

我讨厌在 MS Access 中使用宏（感觉不干净），但不妨试一试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-06T13:32:03.390

如果您愿意使用一点 vba 而不是只使用宏，那么以下内容可能会对您有所帮助。这个模块接受你扔给它的任何 sql 并将其导出到 Excel 工作表中的定义位置。在模块之后是它的两个使用示例，一个用于创建一个全新的工作簿，一个用于打开现有的工作簿。如果您对使用 SQL 没有信心，只需创建所需的查询，保存它，然后将“SELECT * FROM [YourQueryName]”作为 QueryString 参数提供给 Sub。

```
Sub OutputQuery(ws As excel.Worksheet, CellRef As String, QueryString As String, Optional Transpose As Boolean = False)

    Dim q As New ADODB.Recordset
    Dim i, j As Integer

    i = 1

    q.Open QueryString, CurrentProject.Connection, adOpenForwardOnly, adLockReadOnly

    If Transpose Then
        For j = 0 To q.Fields.Count - 1
            ws.Range(CellRef).Offset(j, 0).Value = q(j).Name
            If InStr(1, q(j).Name, "Date") > 0 Or InStr(1, q(j).Name, "DOB") > 0 Then
                ws.Range(CellRef).Offset(j, 0).EntireRow.NumberFormat = "dd/mm/yyyy"
            End If
        Next

        Do Until q.EOF
            For j = 0 To q.Fields.Count - 1
                ws.Range(CellRef).Offset(j, i).Value = q(j)
            Next
            i = i + 1
            q.MoveNext
        Loop
    Else
        For j = 0 To q.Fields.Count - 1
            ws.Range(CellRef).Offset(0, j).Value = q(j).Name
            If InStr(1, q(j).Name, "Date") > 0 Or InStr(1, q(j).Name, "DOB") > 0 Then
                ws.Range(CellRef).Offset(0, j).EntireColumn.NumberFormat = "dd/mm/yyyy"
            End If
        Next

        Do Until q.EOF
            For j = 0 To q.Fields.Count - 1
                ws.Range(CellRef).Offset(i, j).Value = q(j)
            Next
            i = i + 1
            q.MoveNext
        Loop
    End If

    q.Close

End Sub 
```

示例 1：

```
Sub Example1()
    Dim ex As excel.Application
    Dim wb As excel.Workbook
    Dim ws As excel.Worksheet

    'Create workbook
    Set ex = CreateObject("Excel.Application")
    ex.Visible = True
    Set wb = ex.Workbooks.Add
    Set ws = wb.Sheets(1)

    OutputQuery ws, "A1", "Select * From [TestQuery]"
End Sub 
```

示例 2：

```
Sub Example2()
    Dim ex As excel.Application
    Dim wb As excel.Workbook
    Dim ws As excel.Worksheet

    'Create workbook
    Set ex = CreateObject("Excel.Application")
    ex.Visible = True
    Set wb = ex.Workbooks.Open("H:\Book1.xls")
    Set ws = wb.Sheets("DataSheet")

    OutputQuery ws, "E11", "Select * From [TestQuery]"
End Sub 
```

希望这对你有一些用处。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-10T15:35:50.797

一种解决方法是先将查询附加到表中，然后将其导出。

```
DoCmd.SetWarnings False
 DoCmd.OpenQuery "TempTable-Make" 
 DoCmd.RunSQL "DROP TABLE TempTable" 
 ExportToExcel()
DoCmd.SetWarnings True 
```

TempTable-Make 是基于交叉表的生成表查询。

[这](http://www.excelguru.ca/node/23)是您可以使用的适当的 ExportToExcel 函数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-07-18T08:50:23.333

以下代码使用专门设计用于导入记录集的 excel 函数导出查询`CopyFromRecordset`。请注意，需要添加字段名称，因为此函数仅获取实际数据。此代码甚至适用于交叉表查询。

```
'---------------------------------------------------------------------------------------
' Method : MoveQueryToWorksheet
' Author : ROLU
' Date   : 09.05.2018
' Purpose: Moves queries to specific worksheet in an Excel Workbook
'---------------------------------------------------------------------------------------
Function MoveQueryToWorksheet(wkb As Excel.Workbook, wks As Variant, strSQL As Variant) As Boolean
On Error GoTo MoveQueryToWorksheet_Error

'Dim rs As New ADODB.Recordset
'rs.Open strSQL, CurrentProject.Connection, adOpenForwardOnly, adLockReadOnly

Dim dbs As DAO.Database
Set dbs = CurrentDb
Dim rs
Set rs = dbs.OpenRecordset(strSQL)

Dim lCol As Long
For lCol = 0 To rs.Fields.Count - 1
    wkb.Worksheets(wks).Cells(1, lCol + 1).Value = rs.Fields(lCol).Name
Next lCol
wkb.Worksheets(wks).Range("A2").CopyFromRecordset rs

'Close out and clean
Set rs = Nothing
MoveQueryToWorksheet = True

    Exit Function

MoveQueryToWorksheet_Error:
On Error GoTo 0
Set rs = Nothing
MoveQueryToWorksheet = False

End Function 
```

# .net - 使输入键的行为类似于表单上的制表键

> ID：348440
> 
> 赞同：2
> 
> 时间：2008-12-08T00:58:54.767
> 
> 标签：.net, winforms, datagridview

有没有一种简单的方法可以像 Tab 键一样在表单上移动控件？这包括在 datagridview 等上移动单元格。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T01:52:32.100

使用 winforms 您应该将 Form KeyPreview 属性设置为 true

并在您应该拥有的表单的按键事件中

```
private void Form1_KeyPress(object sender, KeyPressEventArgs e)
{
    if (e.KeyChar == 13)
       GetNextControl(ActiveControl, true).Focus();
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T02:11:08.787

因为 datagridview 句柄是用于在单元格之间移动的自己的选项卡事件，所以您必须创建一个自定义 datagrid 控件并覆盖 onKeyUp 事件，如下所示：

```
Public Class MyCustomDataGrid
    Inherits DataGridView

    Protected Overrides Sub OnKeyUp(ByVal e As System.Windows.Forms.KeyEventArgs)
        If e.KeyCode = Keys.Enter Then
            e.Handled = True
            Me.ProcessTabKey(Keys.Tab)
        Else
            MyBase.OnKeyUp(e)
        End If
    End Sub
End Class 
```

这将在尝试通过数据网格单元格制表时将输入键作为制表键处理，如果您还需要在表单上处理制表符，则必须按照马里奥所说的做，但稍作改动。

```
Protected Overrides Sub OnKeyUp(ByVal e As System.Windows.Forms.KeyEventArgs)
        If e.KeyCode = Keys.Enter AndAlso Not ActiveControl.GetType() Is GetType(Class1) Then
            e.Handled = True
            Me.ProcessTabKey(Not e.Shift)
        Else
            MyBase.OnKeyUp(e)
        End If
    End Sub 
```

您只需添加对活动控件类型的检查，否则表单将阻止您的自定义数据网格选项卡代码工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-08-16T02:33:31.960

```
protected override bool ProcessCmdKey(ref Message msg, Keys keyData)
{
Keys keyPressed = (Keys)msg.WParam.ToInt32();
switch (keyPressed)
{
    case Keys.Enter:
    case Keys.Tab:
        Control ctrl = this.GetNextControl(this.ActiveControl, true);
        while (ctrl is TextBox == false) 
        {
            ctrl = this.GetNextControl(ctrl, true);
        }
        ctrl.Focus();
        return true;
    default:
        return base.ProcessCmdKey(ref msg, keyData);
}
} 
```

# multithreading - 与 Octave 并行运行循环的一部分？

> ID：348465
> 
> 赞同：1
> 
> 时间：2008-12-08T01:19:03.023
> 
> 标签：multithreading, parallel-processing, octave

我有以下代码需要在超过 20000 行的矩阵上运行。运行需要几分钟，而 datenum 和 str2double 函数似乎是瓶颈。由于没有计算依赖于以前的计算，有没有办法将循环分成多个部分并让它们并行执行？任何有关优化此代码的建议将不胜感激。

```
对于 i=1：长度（DJI）
DJI2(i,1)=datenum(char(DJI(i,2)),'yyyy-mm-dd');
对于 j=3:7
DJI2(i,j-1)=str2double(char(DJI(i,j)));
结尾
结尾

```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-23T00:28:02.960

唔。我比 Octave 更喜欢 MATLAB，但也许我可以提供帮助（如果您仍在寻找解决方案）

这看起来像我正在阅读文件但我需要做一些与工具不同的事情提供问题（否则你可以逃脱应该很漂亮的 dlmread快速地）。

如果在 Octave 中没有更快的替代方案，我会尝试使用 Java（为了速度而不是线程）；您可以[从 Octave 调用 Java](http://octave.sourceforge.net/doc/f/java_invoke.html)。（虽然我没有在 Octave 中尝试过这个，只是 MATLAB 等价的）

对 str2double 的调用看起来非常可疑。您也许可以将其矢量化，尽管我的快速速度测试似乎证实这是一项缓慢的任务，至少在 Octave 中是这样：

```
octave-3.0.3.exe:15> s=sprintf('1 2\n3 4');
octave-3.0.3.exe:16> m=str2double(s)
m =

   1   2
   3   4

octave-3.0.3.exe:35> s=randn(5000,5);
octave-3.0.3.exe:36> z=num2str(s);
octave-3.0.3.exe:37> tic; s2=str2double(z); toc
Elapsed time is 18.9837 seconds. 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-03-11T07:54:58.230

如果您的数据在文本文件中，最快的方法是使用`textread`.

```
function [DJI2] = InterpretFile(datafile)
    [txtdates, c2, c3, c4, c5, c6] = textread(datafile, '%* %s %f %f %f %f %f');
    dates = datenum(strvcat(txtdates),'yyyy-mm-dd');
    DJI2 = [dates c2 c3 c4 c5 c6]; 
```

中的格式行`textread`告诉它跳过第一列，将第二列复制为字符串，并将第 3 到第 7 列解释为浮点数。这假设您的数据文件看起来像

```
skip 1990-01-01 1.234 2.345 3.456 4.012 5.345
skipme2 1990-01-02 1 2 3 4 5
junk 1990-01-03 1.9 2.1 3.2 4.3 5.4 
```

Also, `str2num` is about 3x faster than `str2double` (I guess because it doesn't do as much error checking), in case you need to use something more like your original technique.

# eclipse - 如何在 Eclipse 项目之间共享 Web 内容

> ID：348469
> 
> 赞同：19
> 
> 时间：2008-12-08T01:21:24.470
> 
> 标签：eclipse, dynamic, project

虽然 J2EE 模块参考功能允许您创建通用 Java 库项目，但我找不到为 Web 内容执行此操作的简洁方法。

我有通用的 JSP、CSS 文件、JavaScript 库甚至是描述符片段，我想在多个动态 Web 项目中使用它们，因此这些人工制品只在一个地方编辑，但将被导出到每个动态 WebProject WAR文件。

令我惊讶的是，如果不编写自己的脚本并挂钩到导出过程中，我就无法找到一种方法来提高网络空间的可重用性。

有没有办法做到这一点？谢谢。马特。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2010-10-27T22:53:47.860

I've been wrestling with the same problem for a long time, and finally stumbled onto a good solution: "Linked Folders". This is an Eclipse feature that works similarly to symlinks -- it allows you to map a single physical folder into multiple projects. The nice thing about this solution is that it doesn't require any special build steps, so Eclipse can automatically deploy changes to your local Tomcat server for testing.

My configuration is as follows: I have an Eclipse project named "SharedContent". Inside the WebContent directory, is a subdirectory "shareRoot". All reusable files -- .jsp, .css, etc. -- are located somewhere under SharedContent/WebContent/shareRoot. This is a Dynamic Web Project so that all of the appropriate editors are enabled, but I never actually build or deploy it.

In my other projects, I add a Linked Folder pointing to shareRoot. In Eclipse 3.6, the steps are:

1.  In the Package Explorer, right-click on the WebContent directory of the project that needs to include the reusable files.

2.  Select New -> Folder.

3.  Click the "Advanced>>>" button.

4.  Select the "Link to alternate location (Linked Folder)" radio button.

5.  In the textbox just under this, click Browse.

6.  In your source tree, navigate to SharedContent/WebContent/shareRoot. Then click OK/Open/Finish buttons until all the dialogs go away.

The shared content is now mapped into your project. Annoyingly, you have to include "shareRoot/" in the URL when referencing these files, but you can work around this using your favorite URL rewriting filter.

You can use a similar trick in the Java source tree to map Java files into multiple projects. I've started doing that, instead of building the shared code into a .jar file, because it avoids the need to rebuild the .jar every time you want to test a change in your local Tomcat server.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-14T18:02:12.593

我相信编写自己的脚本（例如，使用 ant 的自定义构建步骤，在 eclipse 中易于配置）是更实用的解决方案之一。

您还可以创建多个 webapps 并引用它们各自的资源——这对于 css、图像等来说很容易，而不是 jsp 需要访问您的可用代码。

我可以想象一些使用tomcats crossContext="true" 选项作为上下文（例如webapplication）的技巧，使一个应用程序能够访问另一个应用程序中的类，但还没有尝试过。

对不起 - 我相信这不是你想听到的答案......

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-14T18:13:06.813

如果您使用的是 Subversion，您可以使用[svn:externals](http://svnbook.red-bean.com/en/1.5/svn.advanced.externals.html)来引用两个项目中的公共文件。然后您可以在一个地方编辑公共文件，如果您这样做，`svn up`所有文件都会被同步。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2013-03-14T08:49:38.333

哈哈，我给你迟到的惊喜

我是中国人，我的英语很差，但我可以帮助你。

Olaf Kock 是对的，但他的回答并不完美。

这是完美的答案。你必须参考以下网址，它可以帮助你。

[点击这里](http://www.chapter31.com/2008/05/22/setting-up-svnexternals-with-subclipse/)

在 url 页面中，属性内容框的示例不准确，请关注我：

如果需要共享文件：

```
a.jsp  svn://myhome.com/svn/myproject/trunk/a.jsp 
```

如果需要共享文件夹：

```
xml  svn://myhome.com/svn/myproject/trunk/xml 
```

# flash - 快闪活动阶段？

> ID：348476
> 
> 赞同：6
> 
> 时间：2008-12-08T01:28:51.303
> 
> 标签：flash, actionscript-3, events

有人可以简单地解释一下 Flash Event 框架中的 3 个阶段吗？

通过事件阶段，我的意思是：

*   `CAPTURING_PHASE`
*   `AT_TARGET`
*   `BUBBLING_PHASE`

为了清楚起见，我说的是`flash.events.Event`子类。

一个深入的例子会*很棒*。当您单击嵌套时会发生什么`MovieClip`？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-08T08:02:09.950

> 通过事件传播，您可以处理事件的三个​​“阶段”（参见图 2）。每个阶段都代表一个事件的路径或位置，因为它通过与该事件相关的 Flash 中的显示对象自行工作。事件的三个​​阶段是捕获、到达目标和冒泡：

*   **捕获阶段**：这表示事件源自的目标对象的父对象。任何传播的事件都从最顶层的父级（阶段）开始，并沿显示对象层次结构向下工作，直到到达原始目标。

*   **在目标阶段**：目标阶段是事件在目标对象或事件起源的对象的阶段。与捕获和冒泡阶段不同，此阶段始终只涉及一个对象，即目标对象。

*   **冒泡阶段**：当一个事件“冒泡”时，它遵循捕获阶段的反向路径，并沿着目标对象的父层次结构向上工作，直到到达最顶层的父对象或阶段。

公然窃取自：[ActionScript 3.0 中的事件处理简介](http://www.adobe.com/devnet/actionscript/articles/event_handling_as3.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-11-01T14:34:30.857

不久前，我写了几篇关于事件传播、Flash 中的自定义事件等的文章。

您可以在此处找到该文章以及源代码和工作示例：

[http://www.popamihai.com/2010/10/flex/event-propagation-capturing-phase-targeting-phase-and-bubbling-phase/](http://www.popamihai.com/2010/10/flex/event-propagation-capturing-phase-targeting-phase-and-bubbling-phase/)

> **捕获阶段**是从**外部到内部**，从最外层的父容器（在本例中为 Application 标签）到目标对象的直接父容器（VGroup 标签）。
> 
> 在为侦听器检查所有祖先之后，Flex 开始 **定位阶段。**
> 
> **目标阶段**是事件传播机制的第二个阶段，在此阶段 Flex 检查目标对象本身的事件侦听器。
> 
> 事件传播机制的第三个也是最后一个阶段是 **冒泡阶段。**改变目标阶段，Flex 现在检查目标对象的所有父容器中的事件侦听器。此检查从内部到外部进行，从目标对象的直接父级到最外层的父级容器——在本例中为应用程序标记。

# debugging - 所提交的网址带有不被接受的字符

> ID：348491
> 
> 赞同：11
> 
> 时间：2008-12-08T01:52:12.943
> 
> 标签：debugging, zend-studio

我有一个代码点火器项目，我想尝试使用 Zend Studio 对其进行调试。当我开始调试时，我立即运行 ino

“所提交的网址带有不被接受的字符。”

有人有什么主意吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-12-08T02:34:06.197

（假设您使用的是最新版本的 CodeIgniter (CI)，即 1.7.0）

CI 对它允许在 URL 中使用的字符非常严格。您可以修改用于过滤 URL 的正则表达式。

在第 126 行的 system/config/config.php 中是

```
$config['permitted_uri_chars'] = 'a-z 0-9~%.:_\-'; 
```

此行上方的注释几乎解释了这一切，以及使用什么标记值来覆盖此过滤器并允许所有字符（即完全关闭过滤）。

在旁注中，我发现 CI 限制太多（因为它不允许 GET 请求并希望所有交互都通过 POST 发生。我觉得这绝对是疯狂的，类似于把婴儿和洗澡水一起扔出去。显然, 我不是唯一一个认为 CI 限制太多的人，Kohana 项目是 CI + 优化的一个分支，即纯 php5 支持（所有 OO），（CI 仍然是 PHP4 兼容，但代价是不能接受PHP5 OO 功能的优势）。

我更喜欢 Kohana 而不是 CI、YMMV

[http://kohanaphp.com/home](http://kohanaphp.com/home)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2013-07-10T09:24:33.207

如果使用旧版本的 CodeIgniter 和 PHP 5.4 你必须修改

```
if ( ! preg_match("|^[" . preg_quote($this->config->item('permitted_uri_chars')) . "]+$|i", $str)) { 
```

进入

```
if (FALSE === preg_match("|^[" . preg_quote($this->config->item('permitted_uri_chars')) . "]+$|i", $str)) { 
```

在`/system/libraries/URI.php`

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-08-05T19:40:38.800

在表达式引擎中，您将在 /admin/expressionengine/config/config.php 中找到它

```
$config['permitted_uri_chars'] = 'a-z 0-9~%.:_\\-'; 
```

改成

```
$config['permitted_uri_chars'] = ''; 
```

但在执行此操作之前请阅读行注释。

或者不要使用任何基于 CI 的东西。

# .net - 如何进行设置以使我的软件在安装时需要管理权限？

> ID：348502
> 
> 赞同：2
> 
> 时间：2008-12-08T01:56:25.507
> 
> 标签：.net, visual-studio, deployment, installation

我创建了一个应用程序，它将一些数据写入安装它的目录的根文件夹（在 Program Files 中）。但在 Windows Vista 下，程序无法写入目录，因为 UAC 限制了管理权限。

我需要能够执行以下操作

1.  在程序文件中安装程序的文件夹中写入文件。

如果软件以管理权限运行，这是可能的。但我不知道如何修改我的设置以始终以管理权限运行它。

有什么方法或建议我可以做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T02:04:58.500

我认为 Vista 为“看起来像安装程序”的程序处理了这个问题。您使用的是 NSIS 或 Inno 之类的安装程序吗？我认为 Inno 有办法要求这个。不过不确定。

:EDIT: 从管理员/ [Setup] 权限要求部分的inno帮助中：

有效值：none、poweruser 或 admin
默认值：admin

说明：此指令的效果取决于用户运行的 Windows 版本：

在 Windows Vista 及更高版本上：

该指令影响安装开始时是否请求提升权限（通过用户帐户控制对话框）。

当设置为 admin（默认）或 poweruser 时，安装程​​序将始终以管理权限运行。如果安装程序是由非特权用户启动的，Windows 将要求输入具有管理权限的帐户的密码，然后安装程序将在该帐户下运行。

当设置为 none 时，如果安装程序由 Administrators 组的成员启动，安装程序将仅以管理权限运行。除非您确定安装将在非特权帐户上成功运行，否则请勿使用此设置。

在 Windows NT/2000/XP/2003 上：

该指令指定运行安装所需的最低用户权限。

当设置为 admin（默认值）时，只有当用户是 Administrators 组的成员时，安装程​​序才会运行。否则，它将显示以下消息并退出：“安装此程序时，您必须以管理员身份登录。”

当设置为 poweruser 时，只有当用户是管理员或 Power Users 组的成员时，安装程​​序才会运行。否则，它将显示以下消息并退出：“安装此程序时，您必须以管理员身份或 Power Users 组的成员身份登录。”

当设置为 none 时，安装程​​序将不检查用户的组成员身份。除非您确定安装将在非特权帐户上成功运行，否则请勿使用此设置。

在 Windows 95/98/Me 上：

该指令对这些版本的 Windows 没有影响。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T02:34:16.507

听起来您的问题的标题询问如何使安装程序以管理权限运行，但您的解释询问如何使程序以管理权限运行，以便它可以在运行时写入程序文件。哪一个？

如果您真的只是希望安装程序以管理权限运行，那么社区 wiki 的答案非常准确。确保您的安装程序有一个明显的名称，例如“Setup.exe”，并且 Vista 使用“启发式”来决定您的安装程序必须以管理员身份运行。

如果您真的想在运行时写入 Program Files，请不要。这是 Vista 的官方建议：改为写入用户的 AppData 目录。如果你有太多代码要重写，你可以包含一个清单文件，强制 Vista 在运行你的应用程序时提示管理权限。如果您的应用名为“app.exe”，请包含一个“app.exe.manifest”文件，其中包含以下内容：

```
<assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestversion="1.0">
<assemblyidentity version="1.0.0.0" processorarchitecture="X86" name="app.exe" type="win32">
<description>My Application</description>
<trustinfo xmlns="urn:schemas-microsoft-com:asm.v3">
<security>
<requestedprivileges>
<requestedexecutionlevel level="requireAdministrator">
</requestedexecutionlevel>
</requestedprivileges>
</security>
</trustinfo> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T02:01:19.413

您最好的选择是不要在“程序文件”下写入任何文件。无论您要写什么，都最好将其写入 Windows 注册表。然后，您当然必须修改您的程序以从注册表而不是该文件中读取信息。但实际上，这就是注册表的用途。

# java - 如何使 Eclipse org.eclipse.swt.widgets.Text 组件更宽？

> ID：348513
> 
> 赞同：3
> 
> 时间：2008-12-08T02:03:11.330
> 
> 标签：java, eclipse-plugin

我认为这个问题说明了一切。我是 Eclipse 插件开发的新手，所以我确信有一个简单的答案。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-08T07:19:14.310

```
final Composite area = new Composite(parent, SWT.NULL);
final GridLayout gridLayout = new GridLayout();

mTextWidget = new Text(area, SWT.MULTI | SWT.BORDER | SWT.V_SCROLL | SWT.H_SCROLL);

// Define a minimum width
final GridData gridData = new GridData();
gridData.widthHint = DEFAULT_WIDTH;
gridData.heightHint = DEFAULT_HEIGHT;
mTextWidget.setLayoutData(gridData); 
```

您可以使用它来创建文本小部件并将其放入区域（复合）

# asp.net - 在 asp:DropDownList 上选择项目时显示工具提示

> ID：348530
> 
> 赞同：1
> 
> 时间：2008-12-08T02:17:04.967
> 
> 标签：asp.net

我在一个页面上有一个 asp:DropDownList，由于 1024x768 开发标准可以截断下拉列表中的一些文本值（显然，这些值不足以重新设计布局），所以我需要显示一个工具提示选择下拉项目*时*的选定值（即，当显示下拉菜单并且将项目悬停在上方时），最好仅在该项目的文本被截断时。

这可能是默认情况下，javascript hacking 还是我的想象？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-07-30T15:02:58.727

```
foreach (ListItem _listItem in this.DropDownList1.Items)    
{     
  _listItem.Attributes.Add("title", _listItem.Text); 

} 
```

// 也为选中的项目添加一个工具提示

```
DropDownList1.Attributes.Add("onmouseover", this.title=this.options[this.selectedIndex].title"); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T04:37:27.367

将“标题”属性添加到您的列表项中，其中包含您的工具提示信息。它不是智能感知中的现有项目，但它应该可以工作。它在我的系统上。现在，如果您要将下拉列表数据绑定到数据源，我不确定如何执行此操作。但是，如果您在 ASPX 或代码隐藏中进行硬编码，那么您可以这样做。

```
<asp:DropDownList id="ddl1" runat="server">
  <asp:ListItem Text="Display text" Value="1" Title="This is my tooltip"></asp:ListItem>
</asp:DropDownList> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-09T22:46:46.560

您还可以进行回发并将数据加载到帮助图标中。boxover 效果很好。

# java - 编码图中的连接节点

> ID：348533
> 
> 赞同：1
> 
> 时间：2008-12-08T02:19:54.710
> 
> 标签：java, graph-theory

我正在尝试在 java 中制作一个具有不同节点的图形。有些节点会连接到其他节点，有些则不会。如果它们已连接，则该节点的某个布尔值将为真，另一个变量将保存它所连接的节点的值。

...关于你们认为最好的解决方法有什么建议吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-08T02:39:35.170

表示图的两种最常见的方法是邻接矩阵和邻接表。设 n 为节点数。

邻接矩阵 A 是一个 nxn 布尔值矩阵，如果节点 i 和 j 连接，则 A(i, j) = 1，如果不连接，则为 0。

在每个节点的邻接列表表示中，您维护一个它连接到（相邻）的节点列表。

现在的问题是您想对图表做什么。如果它很简单，那么自己动手可能是有意义的。如果没有，您可能想在网上寻找一个 java 库来处理图形。 [JGraphT](http://jgrapht.sourceforge.net/)已被提及。

如果您想使用邻接矩阵，那么您可以在 Java 中轻松地将其表示为 bool 或 int 的二维数组。您需要给每个节点一个索引。最简单的方法是将您的 Node 对象保存在一个数组中，并且始终保持相同的顺序。所以你真的会有两个数据结构：一个节点数组，它是代表你的节点实际是什么的对象，以及邻接矩阵，它通过它们的索引来引用节点。

填充矩阵后，您是否可以通过将所有列（或行）中的值（0 和 1）相加并找到最大值来轻松找到连接到大多数其他节点的节点。希望这可以帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T02:39:59.257

存储图形有两种标准模型。Tom 描述的是[Adjacency List](http://en.wikipedia.org/wiki/Adjacency_list)。另一个是独立的[邻接矩阵](http://en.wikipedia.org/wiki/Adjacency_matrix)。

如果您关心效率，请研究您的情况的稀疏性（边越多，矩阵版本对性能越友好）。如果性能不是问题，请使用您更愿意使用的程序...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-08T02:28:21.467

创建一个`Node`类并给它一个类型的实例变量`Node`。将其初始化为 null - 如果所述节点连接到另一个节点，则此实例变量将引用它；否则，它将保持为空。

如果节点可能连接到许多节点（这对于图来说很常见），则使用 an`ArrayList`来存储该节点连接到的所有节点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T02:28:20.950

[可能是“好的 Java 图形算法库](https://stackoverflow.com/questions/51574/good-java-graph-algorithm-library#52062)”的副本？'。简短的回答是看[JGraphT](http://jgrapht.sourceforge.net/)。

# asp.net - 我可以/应该将 VS2008“网站”转换为“项目”吗？

> ID：348559
> 
> 赞同：3
> 
> 时间：2008-12-08T02:45:46.640
> 
> 标签：asp.net, vb.net, visual-studio-2008

我在 VS2008 中创建了一个网站。我想知道我是否应该将它创建为一个项目，如果是这样，它可以转换吗？这两种方法有什么优点/缺点？

TIA

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T03:31:45.580

这可能听起来有点明显，但我认为这是被误解的东西，因为 VS2005 最初只随网站一起提供。如果您的项目处理的网站相当有限并且没有太多的逻辑或物理分离，那么该网站就可以了。但是，如果它确实是一个具有不同模块的 Web 应用程序，许多用户在其中添加和更新数据，那么您最好使用 Web 应用程序。

网站模型的最大优点是 app_code 部分中的任何内容都是动态编译的。您可以在不完全重新部署的情况下进行 cs 文件更新。然而，这是一个巨大的牺牲。很多事情都发生在难以控制的幕后。命名空间很难控制，并且 app_code 下的任何内容默认情况下特定的 dll 使用都会出现在窗口之外，因为所有内容都是动态编译的。

Web 应用程序模型没有动态编译，但您可以控制我提到的内容。

如果您正在做 nTier 开发，我强烈推荐 Web 应用程序模型。如果您正在做一个有限的网站或快速而肮脏的实施，那么网站模型制作具有优势。

更详细的分析可以看这里：
[http :](http://west-wind.com/weblog/posts/5601.aspx)
[//west-wind.com/weblog/posts/5601.aspx http://blogs.vertigo.com/personal/swarren/Blog/Lists/Posts/Post.aspx?ID =10](http://blogs.vertigo.com/personal/swarren/Blog/Lists/Posts/Post.aspx?ID=10)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T04:15:42.527

在我的一篇旧博客文章中有一些关于网站和 Web 应用程序项目之间差异的信息 - [http://www.aaron-powell.com/blog.aspx?id=1126](http://www.aaron-powell.com/blog.aspx?id=1126)

就我个人而言，我总是使用/将现有项目转换为 Web 应用程序，因为我发现它们更强大且可配置。

# refactoring - 重构这个嵌套在 try/catch 中的 IF 函数

> ID：348562
> 
> 赞同：3
> 
> 时间：2008-12-08T02:47:15.577
> 
> 标签：refactoring

我有一个需要重构的杂乱函数，它有太多嵌套的 IF，只是看着它就让我紧张！

**请忽略函数在做什么，我更关心结构/流程以及如何重构它以减少嵌套的 IF 语句**

基本流程如下：

```
public static void HandleUploadedFile(string filename)
{

      try
      {
        if(IsValidFileFormat(filename)
        {

            int folderID = GetFolderIDFromFilename(filename);

            if(folderID > 0)
            {

                if(HasNoViruses(filename)
                {

                    if(VerifyFileSize(filename)
                    {

                        // file is OK
                        MoveToSafeFolder(filename);

                    }
                    else
                    {
                        DeleteFile(filename);
                    }

                }
                else
                {
                    DeleteFile(filename);
                }

            }
            else
            {
                DeleteFile(filename);
            }

        }
        else
        {
            DeleteFile(filename);
        }
      }
      catch (Exception ex)
      {

      }
      finally
      {
        // do some things
      }

} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-08T02:57:55.947

我很想去：

```
 private static bool CanMoveToSafeFolder(string filename)
    {
        return IsValidFileFormat(filename)
            && GetFolderIDFromFilename(filename) > 0
            && HasNoViruses(filename)
            && VerifyFileSize(filename);
    }

    public static void HandleUploadedFile(string filename)
    {

        try
        {

            if (CanMoveToSafeFolder(filename))
            {
                // file is OK
                MoveToSafeFolder(filename);
            }
            else
            {
                DeleteFile(filename);
            }
        }
        catch (Exception ex)
        {

        }
        finally
        {
            // do some things
        }

    } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-08T03:09:36.360

以下等效于您的原始代码。

```
public static void HandleUploadedFile(string filename)
{
    try
    {
        if( IsValidFileFormat(filename) && 
            (GetFolderIDFromFilename(filename) > 0) && 
            HasNoViruses(filename) &&
            VerifyFileSize(filename) )
        {
              MoveToSafeFolder(filename);
        }
        else
        {
              DeleteFile(filename);
        }
    }
    catch (Exception ex)
    {
        // do some things
    }
    finally
    {
        // do some cleanup
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-05-26T20:09:55.570

这是我重构您的案例的解决方案（对不起 java 风格）：

我将创建一个`UploadedFileChecker`实现如下的类：

```
private class UploadedFileChecker {
    String fileName;

    UploadedFileChecker(String fileName) {
        this.fileName = fileName;
    }

    public void check() throws BadUploadedFileException {
        checkNameFormat();
        checkFolderId();
        scanVirus();
        checkFileSize();
    }

    private void checkFolderId() {
        // throw BadUploadedFileException if not passed.
    }

    private void checkNameFormat() {
        // throw BadUploadedFileException if not passed.
    }

    private void scanVirus() {
        // throw BadUploadedFileException if not passed.
    }

    private void checkFileSize() {
        // throw BadUploadedFileException if not passed.
    }
} 
```

有这个特例

```
public class BadUploadedFileException extends RuntimeException {

} 
```

重构后的 handleUploadedFile 将变为：

```
public static void handleUploadedFile(string filename) {

   try {
        checkFile(fileName);
    } catch (BadUploadedFileException ex) {
        deleteFile(fileName);
    } catch (Exception ex) {

   } finally {

   }
}

private static void checkFile(String fileName) {
    new UploadedFileChecker(fileName).check();
}

private static void deleteFile(String fileName) {

} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T03:20:04.123

这尊重了文件被删除的原始条件，并且更干净、更紧凑。我的第一个答案设置了 folderId，但后来我意识到它没有被使用。

```
public static void HandleUploadedFile(string filename) {
    try {
        if(IsValidFileFormat(filename) 
        && GetFolderIDFromFilename(filename)>0 
        && HasNoViruses(filename) 
        && VerifyFileSize(filename)) {
            MoveToSafeFolder(filename);                                 // file is OK
            }
        else {
            DeleteFile(filename);
            }
        }
    catch (Exception ex) {
        // HANDLE THE EXCEPTION; AT LEAST LOG IT!
        }
    finally {
        // do some things
        }
    } 
```

# sql - 关于实体框架的思考

> ID：348573
> 
> 赞同：7
> 
> 时间：2008-12-08T02:54:06.077
> 
> 标签：sql, .net, entity-framework, linq-to-sql

我想知道人们对通过 LINQ-to-SQL 支持实体框架的决定有何看法？我有一个最初在 LINQ-to-SQL 中开发的应用程序。我发现它是我们应用的完美解决方案。

在尝试移植到实体框架时，我很惊讶它的粗糙程度。恕我直言，甚至还没有准备好迎接黄金时段。没有延迟加载，没有 POCO，对继承的可怕依赖。我发现它在我的情况下基本上无法使用，而是决定坚持使用 LINQ-to-SQL，直到不知何故这个实体框架可以变得更加完善。

其他人有类似的经验吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-08T05:07:58.053

这几乎是我的看法。[在这里](https://stackoverflow.com/questions/276433/do-you-think-its-advantageous-to-switch-to-entity-framework#276439)查看我之前的回复。另一个问题并不是专门针对 EF 中的问题，但是是的：它有一些小故障。例如（除了您现有的选项）：

*   不支持`Expression.Invoke`（重用表达式树来形成更复杂的表达式）
*   不支持 table-UDF，可用于在数据库中创建定义良好的可调用方法，这些方法仍可与 sort/skip/take 等组合

LINQ-to-SQL 处理都很好......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T04:58:10.990

我认为这取决于应用程序平台。当我的团队着手创建一个新的 ASP.net 应用程序时，我们想使用 EF……但在玩了一会儿之后，我们使用了 Linq-To-SQL。在 Web 环境中，管理 L2S 数据上下文要容易得多。此外，我们喜欢 L2S 实体公开原始 Id 字段（例如 EmployeeTypeId），这与 EF 不同，后者只会公开子实体。在 web 环境中，很多时候你真的不需要额外的信息，Id 就足够了，因为它是对已经加载（并且可能缓存）的下拉列表的引用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-08T09:03:33.570

L2S 的用途更加成熟。

我仍然会将 EF 视为 BETA 版本。

有很多关于 EF 的讨论，你可以在相关问题中找到更多。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-09T06:06:19.857

我同意。Entity Framework v1（.net 3.5 SP1 版本）中存在太多错误和设计缺陷，无法在实际开发中使用。不过，EFv4 看起来更有希望……

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-09T06:13:09.763

我听说 L2S 正在迅速走上渡渡鸟的道路。有一些关于转向开源的传言——但微软的 ADO.NET 小组正计划将他们所有的努力都推向 EF……

也很伤心，因为我发现 Linq2SQL 非常容易使用，而且移植我所有代码的想法让我有点恶心。

[更新 LINQ to SQL 和 LINQ to Entities 路线图](http://blogs.msdn.com/adonet/archive/2008/10/29/update-on-linq-to-sql-and-linq-to-entities-roadmap.aspx)

# jquery - 您可以使用 MS 测试套件创建“动态”测试吗？

> ID：348576
> 
> 赞同：4
> 
> 时间：2008-12-08T03:00:51.853
> 
> 标签：jquery, unit-testing, mstest, qunit

我正在使用 QUnit 测试一些 JQuery，我让 Watin 加载测试页面并解析出测试结果，但我想知道是否有一种方法可以使用 MS Test 从页面动态生成测试套件而不是必须为每个测试编写一个测试函数？

我只是想减少必须编写的代码量

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-14T06:52:45.617

You could do this by using a custom test type that would know how to enumerate the tests dynamically somehow. You could associate a file extension with a TiP (test information provider), what when it loaded that file would use data in there to return the set of tests.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-19T19:10:12.170

我不确定你如何使用/运行你的测试，但我很确定你可以使用一些代码生成器，比如 Visual Studio 中的 t4 来为你编写这些测试。

# exception - 如何配置 log4j 不打印异常堆栈跟踪？

> ID：348582
> 
> 赞同：21
> 
> 时间：2008-12-08T03:11:15.810
> 
> 标签：exception, logging, log4j

我们使用 Log4j（和 Commons Logging）来记录我们的错误消息。现在我们要设置一个额外的日志附加器，它将致命错误输出到 syslog，但没有异常长的 Java 堆栈跟踪（这些堆栈跟踪仍将在完整的日志文件中可用）。

如何配置它（使用 log4j.xml）？是否有可用于忽略堆栈跟踪的过滤器？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-08T03:32:25.157

阅读更多源代码后进行编辑：

您仍然需要继承 PatternLayout，但您要覆盖的方法是 ignoresThrowable()：它应该返回 false，这将阻止 appender 编写 Throwable（它假定布局已经这样做了）。

无法在配置中指定这一点：PatternLayout 有一个硬编码的“return true”。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-11-24T08:58:33.613

这是我使用的实际代码：

```
import org.apache.log4j.PatternLayout;

public class NoStackTracePatterLayout extends PatternLayout {

 @Override
 public boolean ignoresThrowable(){
  return false;
 }
} 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2015-03-25T17:02:38.953

如果您使用 log4j > 1.2.16，则可以使用[EnhancedPatternLayout](http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/EnhancedPatternLayout.html "增强型图案布局")布局。

示例（使用 log4j.properties 文件），将其定义为 appender 的布局，然后添加`%throwable{0}`转换模式：

```
log4j.appender.XXX.layout=org.apache.log4j.EnhancedPatternLayout
log4j.appender.XXX.layout.ConversionPattern=%d{yyyy-MM-dd HH:mm:ss} %-5p %c:%L - %m%n%throwable{0} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-06-15T20:13:49.380

在 1.2.16 中，您可以使用 EnhancedPatternLayout

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2018-04-24T19:59:20.203

从 Log4j2 开始，您只需添加`"%ex{0}"`到您的日志模式（假设您使用的是 PatternLayout）

[https://logging.apache.org/log4j/log4j-2.1/manual/layouts.html](https://logging.apache.org/log4j/log4j-2.1/manual/layouts.html)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-29T14:47:15.833

logback-classic（log4j 的继任者）中的“nopex”或“nopexception”转换词禁用打印堆栈跟踪。“nopex”转换词与[其他转换词](http://logback.qos.ch/manual/layouts.html#conversionWord)一起记录在案。您需要向下滚动一点。

如果您需要有关此主题的更多信息，请联系 logback-user 邮件列表。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-08T03:20:59.160

您可能需要编写自定义布局来执行此操作（这还不错；您可以继承 PatternLayout）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-08T05:55:43.763

如果您可以更改源代码，则可以考虑另一种选择。

在我的应用程序中，我总是并且只记录来自我的应用程序入口点的 FATAL 消息（例如，“main()”），因为我只知道如果我因为它们而即将退出应用程序，它们是致命的。

因此，在这个地方（或者如果您有多个应用程序入口点，则为少数），使用“syslog”或类似的特殊类或 MDC 实例化 Log4j Logger。在捕获一个即将成为致命错误时，以通常的方式记录它（对于您的其他日志文件等），但也要在这个新的“syslog”记录器上调用 fatal() 方法，只使用您的精确消息想要（例如只有异常类和消息但没有堆栈跟踪）。然后将 Log4j 配置为仅将这个“syslog”类或 MDC 定向到新配置的以 SysLog 为目标的 Appender。

达顿！

# visual-studio - 引用 F# 的项目中的“Microsoft Visual C# IntelliSense 已停止工作”

> ID：348586
> 
> 赞同：2
> 
> 时间：2008-12-08T03:16:11.867
> 
> 标签：visual-studio, f#

安装 F# September CTP (1.9.6.2) 后，Visual Studio 2008 经常给出错误“Microsoft Visual C# IntelliSense 已停止工作”，这会立即使所有 Visual Studio 崩溃。我尝试了[类似 SO 文章中提到的技巧](https://stackoverflow.com/questions/178846/visual-studio-intellisense-stopped-working)例如“devenv.exe /ResetSettings”，删除 ncb 文件（实际上不存在），并安装最新的服务包（SP1）但没有运气。还尝试重新安装F#，没有。这特别发生在引用我的 F# 项目的 C# 单元测试项目中，并且当我开始键入诸如 [TestMethod] 或“= new Tuple<List<int>,int,int> { Item1 = ”之类的内容时。这就是为什么我猜测它与 F# 有关。顺便说一句，我安装了 ReSharper 但已禁用。无论如何，想知道是否有其他人遇到过这个问题和/或解决了这个问题。否则，任何想法/想法将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-10T20:24:08.250

现在这是一个已确认的错误。以下是 12/9/08 来自 F# 团队的 Brian McNamara 的信息：

> 这是我们收到的第一份报告，但我能够在我的机器上重现这个问题，所以我们会看看调试的结果，如果我找到解决方法，我会告诉你的。（感谢您提供详细信息。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-11T00:46:41.060

根据 Brian McNamera 9/10/08，Vista 上没有解决方法:(

> 与 C# 团队交谈。在 Vista/Server2008 上没有解决方法。这应该是一个“非致命”的 Watson，但非致命性在 Vista 上被打破了，令人沮丧，已知问题。在Vista之前，这显然会在VS中第一次发生这种情况时弹出Watson，但不会崩溃，然后让你继续有增无减。

# cocoa - 加密的 Web 服务连接和 pk12 证书

> ID：348589
> 
> 赞同：0
> 
> 时间：2008-12-08T03:20:20.673
> 
> 标签：cocoa, soap, encryption

我需要编写一些代码来与 SOAP Web 服务通信。不幸的是，我无法连接到该服务，因为它需要使用特殊证书加密的 SSL 连接。我已经获得了一个 pk12 证书，当它安装到我的钥匙串中时，我可以通过 Safari 手动访问 SOAP 服务，但是我无法从 Cocoa Web 服务的东西中获得连接:( 有人对我有什么想法吗？可能需要做才能让它工作？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-08T03:48:41.053

我遇到过类似的问题。这是自签名证书吗？如果是这样，您可能会发现您需要做的就是更改此证书上的信任设置。

还有另一种解决方法，您说该站点应忽略信任设置，但这会使您容易受到中间人攻击。关于这个主题还有另一个线程：

[Objective-C/Cocoa 如何接受错误的服务器证书？](https://stackoverflow.com/questions/15266/objective-ccocoa-how-do-i-accept-a-bad-server-certificate)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-15T01:19:12.820

通常，您必须将证书作为代码的一部分提供。例如，在 C# 中，您需要像这样指定证书：

```
using System.Security.Cryptography.X509Certificates;

public partial class _Default : System.Web.UI.Page 
{
    protected void Page_Load(object sender, EventArgs e)
    {
        //some code creating your soap client

        string cert_file = "C:\\prf_res.pem"; //You'll probably use the PEM format here, not the .p12 format
        X509Certificate cert = new X509Certificate(cert_file);
        soap_client.ClientCertificates.Add(cert);

        //now you're set! 
```

在 PHP 中，它将是：

```
 $cert = "myCert.pem"; //notice it's in PEM format. 

   $client = new SoapClient($wsdl, array('local_cert' => $cert)); 
```

要使用 .p12 制作 PEM 文件，您可以使用：

OpenSSL> pkcs12 -in myCert.p12 -out myCert.pem -nodes -clcerts

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2010-10-22T15:28:32.363

[http://roman.tao.at/dev/php/php-soapclient-over-https-with-pkcs12-p12-certificates/](http://roman.tao.at/dev/php/php-soapclient-over-https-with-pkcs12-p12-certificates/)

# ms-access - 将自动编号字段更改为数字数据类型

> ID：348591
> 
> 赞同：1
> 
> 时间：2008-12-08T03:21:02.793
> 
> 标签：ms-access, autonumber

当该字段用作主键并链接到其他表时，有什么方法可以将自动编号字段更改为数字数据类型？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T13:29:23.953

您必须首先删除表与其他表上的任何外键列之间的关系。更改数据类型，然后重新创建关系。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T04:23:31.030

据我所知，没有办法改变这一点。在 Access 2007 中，它可以从 Long Integer 更改为 Replication ID。在以前的版本中，我不记得有任何这样做的方式——如果我没记错的话，它会自动设置为 Long Integer，但无法控制 Access 对自动编号的作用。

编辑（问题已修改）：您必须删除与其他表的关系才能对其进行修改，一旦删除了关系，您就可以更改类型然后重新创建关系。

# database - 在 LINQ dbml 文件中进行多个表关联的最佳方法？

> ID：348602
> 
> 赞同：1
> 
> 时间：2008-12-08T03:35:18.477
> 
> 标签：database, linq-to-sql

我的数据库中有几个表，一个称为**Task**，另一个称为**User**。Task 表有两列**CreatedBy**和**ModifiedBy**映射到 User 表中的**UserId**列。

我想将 User 表添加到 dbml 文件并添加关联。我现在注意到，当我查看类时，我有两个属性，一个称为**User**，另一个称为**User1**。我宁愿说**CreatedByUser**和**ModifiedByUser**。

我应该只是修改属性还是将表两次带入 dbml 文件并将其重命名为我想要的名称更好。

只是想知道最好的方法是什么。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T03:38:10.123

重命名属性。这些实际上只是属性，可以将它们链接回同一个表。

# c# - 如何根据 displayindex 获取列表视图的列标题列表？

> ID：348604
> 
> 赞同：5
> 
> 时间：2008-12-08T03:37:50.263
> 
> 标签：c#, listview

如果列表视图的 AllowReorder 列设置为 true，如何在运行时根据其 displayindex 获取列标题文本的字符串列表？listview.Columns 仅按原始顺序返回列。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-08T04:58:08.183

C# 2.0？还是 C# 3.0？LINQ 答案（C# 3.0，带有 .NET 3.5 或 .NET 2.0/3.0 和[LINQBridge](http://www.albahari.com/nutshell/linqbridge.aspx)）要容易得多；-p

IE

```
 var names = (from col in listView.Columns.Cast<ColumnHeader>()
                 orderby col.DisplayIndex
                 select col.Text).ToList(); 
```

与：

```
 List<ColumnHeader> cols = new List<ColumnHeader>();
        // populate
        foreach (ColumnHeader column in listView.Columns) {
            cols.Add(column);
        }
        // sort
        cols.Sort(delegate(ColumnHeader x, ColumnHeader y) {
            return x.DisplayIndex.CompareTo(y.DisplayIndex);
        });
        // project
        List<string> names = cols.ConvertAll<string>(delegate(ColumnHeader x) {
            return x.Text;
        }); 
```

无论哪种方式，这都会为您提供`List<string>`列标题文本值。

# oop - 您将如何改进这个简单的类以使其更松散耦合？

> ID：348606
> 
> 赞同：6
> 
> 时间：2008-12-08T03:38:02.883
> 
> 标签：oop, coupling

正如您在下面看到的，在构造函数中，我正在实例化一个验证对象，因此我可以在 set 方法中验证用户的电子邮件。这种架构是最佳实践还是有缺陷？我可以避免让我的 User 类直接依赖于我的 Validation 类吗？

```
Class User {
  Private Email

//constructor
User() {
  Validation = new Validation
}

SetEmail(NewValue) {
  if (Validation.isEmail(NewValue)) {
    Email = NewValue
  }
} 
```

还有一个相关的问题：当 set 方法收到无效值时，正确的响应是什么？我看到 2 个选项

1.  不要设置值并返回 false
2.  无论如何设置该值，但为该对象设置一个错误属性。（所以如果设置了 User.Error 我知道出了点问题）

我怀疑#1 是最佳实践，因为您可以确保任何对象属性的值始终有效。正确的？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-08T05:46:26.837

到目前为止，这些提议似乎都太过分了，尤其是对于所有 IOC 和 AOP 的东西。

1.  该类`User`需要一个电子邮件地址，因此创建一个`EmailAddress`类并让`User`该类通过属性和/或其构造函数接受一个。该验证可以像输入`EmailAddress`引用是否为空一样简单。

2.  该类`EmailAddress`可以是一个简单但通常可重用的实现（考虑基于 RFC 文档）。它应该是不可变的，并且应该在输入无效时从其构造函数中抛出异常。

3.  理想情况下，`EmailAddress`类应该由一个`EmailUserId`类（基于 RFC？）和一个`InternetDomain`类（基于 RFC？）组成，因为电子邮件地址是一个复合数据结构。同样，这些类中的每一个都应该管理不可变的实例，并且应该在输入无效的构造时抛出异常。

“验证”给我的印象不是“事物”，而是通用的“动作”。因此，它适合作为一个方法而不是一个类。在这种情况下，我倾向于将每个类中的验证实现为`valid(input)`从构造函数调用的私有静态方法 ()，使用 Java 或 C# 等语言。`isValid(input)`通常，以问题 ( )的形式公开该功能会变得很有用。

编辑：

> 您是否建议我需要验证的每种不同的数据类型都应该有自己的类？

这是解决问题的一种可靠方法，通常称为值类型（感谢弗兰克的提醒）。结果将是几个（十几个或两个）定义明确、可重用的类，比如可能、、、等`EmailAddress`。所提出的替代方案可能会产生一个“神级”，其中混合了不可重用、不易实现的功能测试，维护困难。`PhoneNumber``PersonName`

还有其他方法来划分解决方案，但我的建议确实具有成熟、易于理解并符合大量可靠设计原则的优势。我当然会建议在尝试发明自己的之前先尝试一下。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T03:42:44.327

我会：

1.  通过依赖注入打破与具体验证对象的耦合：定义一个抽象（纯虚拟）验证类，从它派生一个具体验证类，并传入（“注入”）对用户类的抽象验证类的引用构造函数。

    有关如何以及为什么在 C++ 中执行此操作的精彩讨论，请参阅 Robert Martin [1996 年关于](http://www.objectmentor.com/resources/articles/dip.pdf)*C++ 报告*中该主题的文章。

2.  与其返回 false 或静默设置某些属性，不如引发异常。这就是他们的目的。

# version-control - 如何跟踪对外部维护的大型代码库的微小更改

> ID：348609
> 
> 赞同：1
> 
> 时间：2008-12-08T03:41:26.077
> 
> 标签：version-control, open-source

在处理一些开源项目（在我的例子中是 Joomla 和 Moodle）时，我经常不得不深入研究核心代码以进行一些更改，但问题是跟踪这些更改，以便我知道要更新哪些文件生产服务器，以及升级到新版本时要特别注意的文件，以免覆盖我的更改。

显而易见的答案是将整个代码库加载到版本控制中，然后您可以轻松地将修订版 0（未触及的发布代码）与当前版本或工作副本进行比较以找到更改的文件，但是当您使用时，这似乎有点矫枉过正'只更改一两个文件，并且该项目有超过 5000 个文件（就像 Moodle 一样）。

一方面是版本控制存储库，另一方面是使用记事本手动跟踪更改......两者之间有什么吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-08T03:48:19.930

我不确定你为什么抵制版本控制；您的情况正是版本控制旨在处理的情况！

事实上，对大型外部驱动的代码库进行几次小的本地更改的情况使得使用适当的源代码控制变得更加重要。使用具有智能差异和合并引擎的源代码控制系统可确保从上游更新时简单的更改易于合并，而复杂的更改有机会被跟踪。

鉴于高质量、零成本的源代码控制系统的广泛可用性，确实没有理由不使用它们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T04:02:44.630

最终，听起来你所做的是你已经分叉了代码。这真的是你的意图吗？将您的更改合并到原始源中，然后您不必为将来的更新继续进行这些更改。

如果您的更改不适合项目的任何其他使用者，那么也许您可以改为引入允许稍后加载您的自定义的更改。也就是说，即使您的特定更改并不适合所有人，但您更改的代码部分也可能是其他人希望为其安装定制的部分。向程序添加一项功能，该功能将从单独的文件加载自定义项。然后代码不再需要更改，您可以更新配置文件，而无需跟踪与外部代码相关的更改。

# agile - 哪些情况下不适合敏捷？

> ID：348611
> 
> 赞同：12
> 
> 时间：2008-12-08T03:41:32.487
> 
> 标签：agile, methodology, software-design

多年来，我一直在听到和阅读有关敏捷的信息。我拥有一两本书，我喜欢这个主意。

我终于可以在我工作的地方推出这样的东西了，但我非常担心这是否适合我们：

*   这没有最小尺寸吗？对于三到四个星期的项目来说，前期的大型设计*必须更有效率......对吗？*
*   我们的客户通常要求固定价格。他们需要知道他们在处理什么，除非在特殊情况下，我们遇到了一个明显的黑洞，即使这样，人们也更愿意戴上帽子。那么，如果您要采用能够容忍持续需求变化的流程，您如何提供报价呢？
*   我知道敏捷可以在更复杂的项目中提供更好的成功几率，但它不会增加客户的成本吗？当然，还有不考虑的代价——也许我们又回到了最小尺寸问题。
*   您将如何向客户解释这种违反直觉的方法？非技术利益相关者可能没有经验来围绕瀑布之外的任何事情。
*   即使是内部项目，也有预算。我错过了什么？
*   最近似乎有人反对敏捷。其他东西会很快开始受到关注吗？

注意：我们是一个 5 开发商店，项目从一两天到几个月不等。我不相信有一种方法可以统治所有这些，但是找到足够灵活的方法来适应我们所有的项目会很棒。

非常感谢！

布赖恩·麦凯

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-08T04:02:39.043

我不认为一种方法可以统治所有这些。对不起。我坚信为正确的项目找到正确的模型。例如，如果您正在接受手术并且您知道让您保持生命的机器是在快速迭代周期中开发的，并且前期设计很少，您会有什么感觉。

但无论如何，关于你的问题。我非常相信敏捷方法，保持迭代简短，专注于用户想要的东西，而不是建造战舰，而只建造你需要的东西。我想说 95% 的项目可以使用敏捷方法，如果不能，这通常是文化问题，而不是项目问题。

现在就 BDUF（前期大设计）而言，我们与一个 20 人的团队在一个为期 4 个月的项目中取得了巨大的成功，我们将项目分解为 3 个 4 周的周期，在每个周期开始时，我们都会在一个房间，然后说好的，这就是我们需要建造的东西，这就是我们将如何建造它，我们试了一下我们的界面会是什么样子，我们需要什么数据等等......但这只是一个试探，我们然后回到我们的办公桌前，拥有各种作品的人把细节都刷了出来。

本质上，我们预先做了足够多的 BDUF 来启动团队（并确保我们涵盖了所有业务需求）。我们过去将这些会议称为“开发者日”，这是启动团队的好方法。如果您有现金，可以将团队带离现场，您可以将他们塞进酒店的会议室，喂他们很多垃圾，然后看着果汁流淌。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-08T04:23:33.650

简单的解决方案有两个步骤：

1.  不要估计项目的成本和进度，估计**功能的成本和进度**
2.  测量并记录足够的信息来计算您的速度和估计误差

如果可能的话，从小处和内部开始，以获得一些基数。如果您仍想进行“大型前期设计”，请针对个别功能进行。这将有助于您的初始估计更准确，以及您对“功能”的粒度感到满意。

注意：*这只有在客户承诺尽其本分时才有效*，即对开发人员高度可用（回答问题、编写故事和测试描述等），并且*在迭代期间不改变主意*

祝您过渡顺利，让我们知道进展如何！

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-08T18:14:22.617

到目前为止，我见过的最大禁忌是价值观不匹配。极限编程依赖于尊重、沟通、反馈、勇气和简单。在一个基于不相容价值观行事的组织中，应用 XP 将导致摩擦，不会导致任何持久变化 (IME)。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-08T03:55:01.883

这取决于你问谁以及他们是否相信敏捷......

至于这个：

> 我想找到一种方法来统治它们。

[http://www.opaquelucidity.com/facepalm.jpg](http://www.opaquelucidity.com/facepalm.jpg)

你所有的客户都一样吗？您已经说过持续时间差异很大……您为什么认为各种不同的项目都适合一种单一的方法？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-08T03:57:40.630

寻找让敏捷实践失败的原因……如果你得到 1-2 个未成年人积分，你会找到克服它们的方法。否则，您正在寻找失败。而一旦你失败了，你就再也没有机会尝试了。即使失败的不是敏捷实践……

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-08T04:08:36.817

从内部项目开始，了解您的敏捷流程是如何工作的，以及如何最好地估计事情需要多长时间。当你觉得你已经准备好接受真正的客户时，选择一个你非常信任的客户，然后选择一个相当小的项目开始。这里的关键是你想建立信心。解释你在做什么以及为什么——你想为他们提供更好的软件，更快地反映他们的优先事项——并向他们展示你是如何在内部项目中取得成功的。兑现你的承诺——因为我相信敏捷方法，我认为这不会太难做到。

一旦你成功了（并且让客户赞叹不已），他们会要求你在他们的其他项目中使用这种方法。一旦您有了一个满意的客户，您就可以开始向其他客户扩展，并使用您的第一个客户作为参考。很快你就会发现你正在使用的做法非常有效，以至于它们也潜入了你的“瀑布”过程。最终，你会像我们其他敏捷者一样喝足够多的kool-aid。:-)

哦。是的，有些项目并不特别适合敏捷方法。诸如生命关键系统、核电站控制、高度监管的行业之类的东西都可能需要比敏捷所允许的更多的前期设计和流程。我们大多数人从不从事这些项目。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-08T19:43:17.477

Scott Ambler 是对此[做出回答](http://www.ddj.com/architect/201202925?cid=Ambysoft)的权威人士之一。他的文章很好地突出了固定价格的一些陷阱，但这绝对是可能的。Alistair Cockburn也[同意](http://www.agilekiwi.com/fixed_price_contracts.htm)这也是可能的，但指出您从敏捷中获得的一些好处在固定价格合同中丢失了。

“前期大设计”（BDUF）的一个基本问题是花费时间设计很少使用的功能，如果有的话。如果您需要在一个月或更短的时间内完成产品，则必须事先明确定义问题。

至于失败的成本，这是一个非常合理的担忧。敏捷的一个好处是，与遵循瀑布方法的项目相比，任何失败都发生得更早，成本也更低。能够从这些失败中吸取教训并最终获得好的产品并不是瀑布方法可以提供的结果。联邦政府在遵循瀑布方法和 BDUF 的软件项目中有相当多的引人注目的失败。我在[博客](http://scottlaw.knot.org/blog/?s=virtual+case+file&x=0&y=0)上写过FBI 的 Virtual Case File 项目失败。

您使用的方法将取决于您与团队的匹配程度，以及您正在构建的软件类型和您的客户。对于不适合敏捷方法的项目，tvanfosson 是完全正确的。我同意肯特贝克关于价值观不匹配的观点。从文化的角度来看，一些组织还没有为敏捷做好准备，不管它在其他地方的优点和成功。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-09T18:19:57.300

让我逐点回答您的担忧：

> 这没有最小尺寸吗？对于三到四个星期的项目来说，前期的大型设计必须更有效率......对吗？

我不确定是什么让您认为在纸上绘制矩形一定比重构代码更快。

无论如何，即使是这样，BDUF 是否回报的问题更多地取决于您在项目期间期望的学习量，而不是项目规模。在实施系统时，您期望了解的有关设计、要求等的越多，您的前期设计就越浪费。

我还没有遇到过在实施系统时没有学到重要知识的项目。

> 我们的客户通常要求固定价格。他们需要知道他们在处理什么，除非在特殊情况下，我们遇到了一个明显的黑洞，即使这样，人们也更愿意戴上帽子。那么，如果您要采用能够容忍持续需求变化的流程，您如何提供报价呢？

只接受不会改变总工作量的需求变更。也就是说，当新的需求出现时，放弃不太重要的需求。让客户做出决定，这样他就可以获得最大的收益。

您不会以这种方式获得敏捷的所有好处，但据我所知，它与固定价格所能获得的一样好。

> 我知道敏捷可以在更复杂的项目中提供更好的成功几率，但它不会增加客户的成本吗？

您是否建议以敏捷方式运行的项目比传统项目成本更高？实际上，有些公司的情况正好相反，最多可以降低 50% 的成本。

> 当然，还有不考虑的代价——也许我们又回到了最小尺寸问题。

由于早期的反馈，敏捷项目的失败成本会降低。您可以更早地注意到失败 - 因此决定取消项目。

> 您将如何向客户解释这种违反直觉的方法？非技术利益相关者可能没有经验来围绕瀑布之外的任何事情。

[为什么敏捷软件开发要付费？](http://de.youtube.com/watch?v=OWvSnYjqOTQ)

> 即使是内部项目，也有预算。我错过了什么？

我不知道。敏捷适用于预算 - 实施最高优先级的功能，直到预算用完。您拥有可以用这笔钱实施的最有价值的系统。

> 最近似乎有人反对敏捷。其他东西会很快开始受到关注吗？

从一开始就遭到强烈反对。随着它变得越来越流行（而且确实如此！），您也很自然地会看到更多的反弹。

精益软件开发正在获得很大的吸引力。不过，它不是与敏捷开发的竞争，而是互补的。社区实际上是相当重叠的。

关于“一种方法来统治它们”——看看 Alistair Cockburn 的“Crystal”敏捷过程系列。他（相当有能力地）争辩说，每个项目都需要它自己的过程，而且即使是一个项目的过程也需要随着项目的进行而改变。他提供了一个轻量级的框架来开发你的流程。

正如我所想的那样，Scrum 也是如此。Scrum 实际上并没有告诉你太多关于如何运行你的项目，而是更多地告诉你如何找出什么在起作用，以及如何让团队适应这些发现。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-12T20:05:15.553

我不一定会将敏捷用于预先知道所有内容的项目。当变化极有可能发生时，敏捷工作得很好。万一变化不大可能，人们可以使用预测或瀑布过程来管理这样一个项目。

对您的特定问题的回答如下： **这没有最小尺寸吗？** 从实践的角度来看，敏捷与规模无关。话虽如此，项目越大，发生变化的可能性就越大。如果一个项目足够小，那么一切都是可知的，改变是不可能的。

**对于三到四个星期的项目来说，前期的大型设计必须更有效率......对吗？** 由 TDD 驱动的简单和渐进式设计总是更有效。您应该预先完成足够的架构，以了解主要部分的位置。不要用架构来猜测你要做什么，只捕捉已知的东西。让简单而渐进的设计使您能够在构建应用程序时改进您的详细设计。

**我们的客户通常要求固定价格。他们需要知道他们在处理什么，除非在特殊情况下，我们遇到了一个明显的黑洞，即使这样，人们也更愿意戴上帽子。那么，如果您要采用能够容忍持续需求变化的流程，您如何提供报价呢？** 最初需要一些教育。您将建立一个产品积压工作，要求产品负责人对其进行优先排序，然后对工作进行初步评估。这确实要求产品负责人在积压订单上为固定投标建立一条切割线。然后你调整团队和持续时间以满足估计。然后合同规定您将在确定的时间范围内使用团队的固定容量。这将使产品负责人在对积压工作进行优先调用时专注于时间框和预算。

**我知道敏捷可以在更复杂的项目中提供更好的成功几率，但它不会增加客户的成本吗？** 一个成功的项目总是比一个失败的项目便宜。

**您将如何向客户解释这种违反直觉的方法？非技术利益相关者可能没有经验来围绕瀑布之外的任何事情。** 教育（即敏捷训练营）和访问成功的敏捷团队将大有帮助。然后让团队继续前进。工作会让他们忙碌，结果会卖给他们。

**即使是内部项目，也有预算。我错过了什么？最近似乎有人反对敏捷。其他东西会很快开始受到关注吗？** 我知道的唯一反对意见是敏捷项目没有有效地使用工程实践（即，仅 SCRUM）。使用 SCRUM 和 XP 有效的团队将在交付和可持续速度方面做得很好。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-01-23T19:02:49.310

在开发新的空中交通管制系统时，我建议反对敏捷。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2009-05-12T20:36:10.323

恕我直言：

敏捷与否，您应该在实施之前设计已知的东西——在“只是尝试一些东西”之前。递归地将事物分解为可管理的任务，然后设计已知的东西，无论是细节还是宽泛的概念。诸如 UI 和日常业务需求之类的东西在开发之前几乎从来都不是一成不变的，而飞机模拟功能可能是。

One way to try to "sell" agile to customers is grant them two options: 1\. Waterfall, where there is no cancelling as long as we (the devs) meet our end of the agreement. 2\. Agile, where you get weekly updates on status, hands-on demos as they become available, and the right to discontinue service every 2 weeks (in case you don't like our work).

# c++ - C/C++ 中的领域特定语言，这是 Kosher 吗？

> ID：348616
> 
> 赞同：4
> 
> 时间：2008-12-08T03:45:04.493
> 
> 标签：c++, c, dsl

当我想出这个“奇怪”的解决方案时，我只是在为 C/C++ 中的一个新项目设计一些特定领域的语言设计：

```
 define DSL(...) MakeCommand(#__VA_ARGS__\
                              )->Exec()->GetResults()

 MyResults results = DSL( for p in people do something ); 
```

好的部分是这在标准上是正确的（但 Duff Switch 也是如此），并且是跨平台的，可移植的等......但是这种方法实际上并不比将字符串写入代码更好，但是由于 DSL 引擎解析无论如何，字符串，这样看起来更漂亮，并减少了混乱。但想知道其他人对此有何看法。

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-08T03:52:46.740

嗯，虽然可变参数宏是 C99，但它们在 C++ 中是不可能的。我不会那样做 :) 一个简单的 dsl 函数采用`std::string`框架使用的或任何字符串类，并返回`MakeCommand(str)->Exec()->GetResults()`将是我的首选，因为它对调试更友好，并且您可以将其放入命名空间。

您还可以动态构建命令字符串并将其传递给函数。使用您的宏方法，传递一个`str`变量实际上会传递`"str"`给 MakeCommand 函数。您将需要另一个用于动态命令的宏才能使其工作，我对此感到不舒服。

# xml - 在 Adob e Flex 中解析大型 XML 文件

> ID：348627
> 
> 赞同：4
> 
> 时间：2008-12-08T03:54:20.870
> 
> 标签：xml, apache-flex, performance, actionscript

我正在开发一个 Adob​​e Flex 应用程序，它需要解析一个相对较大的 XML 文件。ATM 它只有 35MB，但在理想的世界中，未来会变得更大。**编辑：我无法控制 XML 文件

我本质上是将其内容直接放入 SQLITE 数据库中，因此我可以使用 SimpleXML 类将其转换为对象，然后对其进行迭代，但我担心随着文件变大，这将是一种不好的方法。我是偏执狂，还是有更好的方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-08T05:12:47.623

在解析这么大的 XML 文件时，您肯定会遇到一些性能问题。回到 Flex 2 天，我们将 SOAP 用于服务，并且有一个数据调用拉回了大约 5K 记录，并且 Flash Player 将挂起/浏览器在相当快的机器上无响应大约 10 秒。我不记得那个 SOAP 消息的大小，但它不能超过 1-2 MB。

如果您的后端可以将 XML 转换为对象图并通过 AMF 将其发送回，您将看到更好的性能。Flash Player 非常适合处理大型数据集，前提是它们以 AMF（压缩二进制格式）编码。

即便如此，我真的会考虑是否要发送一个大的结果，将其分解为多个部分。至少这样你就有了更好的缩放路径，并且可以给用户一些更好的反馈，即显示一条消息，例如“正在处理 35 中的第 6 项......”

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-08T05:01:07.693

你想要的是一个 SAX XML 解析器——它可以解析一个流而无需读取整个内容。不过，我找不到 AS3 的（尽管还有其他人在寻找相同的东西。）

SAX 通过在元素遍历输入流时引发事件来进行操作。非常方便 - 我过去经常使用它，一旦你熟悉它，它对很多情况都很有用。它甚至适用于流永远不会关闭的打开套接字。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-08T04:47:32.387

我个人会尽量避免这种大小的 XML 文件。这是 XML 的缺点之一，您需要阅读整个文件才能开始使用它。

您不能让您的数据库返回较小的 XML 部分，包含您需要的内容，而不是一次返回所有内容吗？设置起来可能有点困难，但最终可能证明更具可扩展性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-19T02:14:35.000

正如其他人所说，不建议解析大量 XML，并且会变得非常缓慢。据说，在闪存客户端和服务器端脚本之间发送数据的最快方式是使用二进制的 AMF（动作消息格式）。如果您曾经对 SharedObject 类做过任何事情，那么您已经对 AMF 进行了一些处理，因为这是将 LSO 写入硬盘驱动器的格式。直到最近，AMFPHP 还是最好的解决方案，因为它现在适用于 Zend 框架，更具体地说，现在它是 ZendAMF。

[这里](http://www.gotoandlearn.com/play?id=90)有一个很棒的教程，作者 Lee Brimelow，我寻求灵感和清晰的 Flash 开发人员之一，它展示了如何使用 ZendAMF。

与普通的旧 XML 相比，ZendAMF 提供数据的速度是惊人的，要解析的数据越大，越明显。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-05T21:51:38.140

如前所述，最好使用 SAX 解析器，这样您就可以在读取每个“事件”（节点）时对其进行处理，而不是使用 DOM 解析器来读取整个 XML 文件并将其存储在内存中。

但是，如果您要使用如此大的数据集，那么也许您可以考虑以 JSON 格式而不是 XML 格式导出 SQLite 数据？

我不确定如何将 SQLite 直接导出到 JSON（无需编写自己的脚本来执行此操作），但是 sqlite-users 邮件列表上的一条消息建议尝试以下不受支持/未记录的源代码：[http://www. ch-werner.de/sqliteodbc/sqlite3json.tgz](http://www.ch-werner.de/sqliteodbc/sqlite3json.tgz)

有关在 Flex 中使用 JSON 的教程，[请访问 http://www.mikechambers.com/blog/2006/03/28/tutorial-using-json-with-flex-2-and-actionscript-3/](http://www.mikechambers.com/blog/2006/03/28/tutorial-using-json-with-flex-2-and-actionscript-3/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-06T23:54:22.837

在 SQL 中，总是有一个 WHERE 子句，因为没有人希望看到超过 100 个结果。

您可能无法控制原始 XML 文件，但也许您可以在服务器端插入一些东西来解析和提取您真正想要的数据。

干杯

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-12-14T11:55:27.020

在比较 XML 和 JSON 的 Speed 时，其实我对大数据的 Speed 进行了 3 种比较——XML、JSON 和 BlazeDS。相信我，BlazeDS 会比任何东西都快。它真的更快。

# gmail - 如何从 Gmail 下载所有带有附件的电子邮件？

> ID：348630
> 
> 赞同：83
> 
> 时间：2008-12-08T03:57:49.460
> 
> 标签：gmail

如何连接到 Gmail 并确定哪些邮件有附件？然后我想下载每个附件，在处理每条消息时打印出主题：和发件人：。

* * *

## 回答 #1

> 赞同：154
> 
> 时间：2009-03-13T14:34:44.667

硬一个:-)

```
import email, getpass, imaplib, os

detach_dir = '.' # directory where to save attachments (default: current)
user = raw_input("Enter your GMail username:")
pwd = getpass.getpass("Enter your password: ")

# connecting to the gmail imap server
m = imaplib.IMAP4_SSL("imap.gmail.com")
m.login(user,pwd)
m.select("[Gmail]/All Mail") # here you a can choose a mail box like INBOX instead
# use m.list() to get all the mailboxes

resp, items = m.search(None, "ALL") # you could filter using the IMAP rules here (check http://www.example-code.com/csharp/imap-search-critera.asp)
items = items[0].split() # getting the mails id

for emailid in items:
    resp, data = m.fetch(emailid, "(RFC822)") # fetching the mail, "`(RFC822)`" means "get the whole stuff", but you can ask for headers only, etc
    email_body = data[0][1] # getting the mail content
    mail = email.message_from_string(email_body) # parsing the mail content to get a mail object

    #Check if any attachments at all
    if mail.get_content_maintype() != 'multipart':
        continue

    print "["+mail["From"]+"] :" + mail["Subject"]

    # we use walk to create a generator so we can iterate on the parts and forget about the recursive headach
    for part in mail.walk():
        # multipart are just containers, so we skip them
        if part.get_content_maintype() == 'multipart':
            continue

        # is this part an attachment ?
        if part.get('Content-Disposition') is None:
            continue

        filename = part.get_filename()
        counter = 1

        # if there is no filename, we create one with a counter to avoid duplicates
        if not filename:
            filename = 'part-%03d%s' % (counter, 'bin')
            counter += 1

        att_path = os.path.join(detach_dir, filename)

        #Check if its already there
        if not os.path.isfile(att_path) :
            # finally write the stuff
            fp = open(att_path, 'wb')
            fp.write(part.get_payload(decode=True))
            fp.close() 
```

哇！那是东西。;-) 但是在 Java 中尝试同样的方法，只是为了好玩！

顺便说一句，我在 shell 中对其进行了测试，因此可能仍然存在一些错误。

享受

**编辑：**

因为邮箱名称可以从一个国家更改为另一个国家，我建议您`m.list()`先在其中选择一个项目`m.select("the mailbox name")`以避免此错误：

> imaplib.error：命令 SEARCH 在状态 AUTH 中非法，仅在状态 SELECTED 中允许

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-08T04:17:37.907

我不是 Perl 方面的专家，但我所知道的是 GMail 支持 IMAP 和 POP3，这两种协议是完全标准的并且允许您这样做。

也许这可以帮助您入门。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-13T08:40:25.173

```
#!/usr/bin/env python
"""Save all attachments for given gmail account."""
import os, sys
from libgmail import GmailAccount

ga = GmailAccount("your.account@gmail.com", "pA$$w0Rd_")
ga.login()

# folders: inbox, starred, all, drafts, sent, spam
for thread in ga.getMessagesByFolder('all', allPages=True):
    for msg in thread:
        sys.stdout.write('.')
        if msg.attachments:
           print "\n", msg.id, msg.number, msg.subject, msg.sender
           for att in msg.attachments:
               if att.filename and att.content:
                  attdir = os.path.join(thread.id, msg.id)
                  if not os.path.isdir(attdir):
                     os.makedirs(attdir)                
                  with open(os.path.join(attdir, att.filename), 'wb') as f:
                       f.write(att.content) 
```

未经测试

1.  确保 TOS 允许此类脚本，否则您的帐户将被暂停
2.  可能有更好的选择：GMail 离线模式、Thunderbird + ExtractExtensions、GmailFS、Gmail Drive 等。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-13T15:52:00.127

看看[Mail::Webmail::Gmail](http://search.cpan.org/~mincus/Mail-Webmail-Gmail-1.09/lib/Mail/Webmail/Gmail.pm#GETTING_ATTACHMENTS)：

**获取附件**

获取附件有两种方式：

1 -> 通过发送对返回的特定附件的引用`get_indv_email`

```
# Creates an array of references to every attachment in your account
my $messages = $gmail->get_messages();
my @attachments;

foreach ( @{ $messages } ) {
    my $email = $gmail->get_indv_email( msg => $_ );
    if ( defined( $email->{ $_->{ 'id' } }->{ 'attachments' } ) ) {
        foreach ( @{ $email->{ $_->{ 'id' } }->{ 'attachments' } } ) {
            push( @attachments, $gmail->get_attachment( attachment => $_ ) );
            if ( $gmail->error() ) {
                print $gmail->error_msg();
            }
        }
    }
} 
```

2 -> 或者通过发送附件 ID 和消息 ID

```
#retrieve specific attachment
my $msgid = 'F000000000';
my $attachid = '0.1';
my $attach_ref = $gmail->get_attachment( attid => $attachid, msgid => $msgid ); 
```

（返回对保存附件数据的标量的引用。）

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-12-08T05:10:38.360

在 gmail 中，您可以过滤“has:attachment”，使用它来识别您在测试时应该收到的消息。请注意，这似乎会提供带有附件的消息（显示回形针图标）以及内联附加图像（未显示回形针）。

没有 Gmail API，因此 IMAP 或 POP 是您唯一真正的选择。[JavaMail API](http://www.nakov.com/inetjava/lectures/part-1-sockets/InetJava-1.9-JavaMail-API.html)以及这篇关于使用 Perl 从 IMAP 下载附件的简洁文章可能会提供一些[帮助](http://www.perlmonks.org/?node_id=697321)。[之前](https://stackoverflow.com/questions/61176/getting-mail-from-gmail-into-java-application-using-imap)关于 SO 的一些问题也可能有所帮助。

这个[PHP 示例](http://petewarden.typepad.com/searchbrowser/2008/03/how-to-use-imap.html)也可能有所帮助。不幸的是，据我所知，imap_header 中没有包含附件信息，因此需要下载正文才能看到 X-Attachment-Id 字段。（有人请证明我错了）。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2016-05-07T12:35:30.593

这个问题已经很老了，当时 Gmail API 不可用。但是现在 Google 提供了 Gmail API 来访问 IMAP。[在此处](https://developers.google.com/gmail/api/quickstart/python)查看 Google 的 Gmail API 。另请参阅pypi 上[的 google-api-python-client](https://pypi.python.org/pypi/google-api-python-client)。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2013-08-15T19:02:05.670

如果你们中的任何人已经更新到 python 3.3，我从[HERE](https://gist.github.com/baali/2633554)获取 2.7 脚本并将其更新到 3.3。还修复了 gmail 返回信息的方式的一些问题。

```
# Something in lines of http://stackoverflow.com/questions/348630/how-can-i-download-all-emails-with-attachments-from-gmail
# Make sure you have IMAP enabled in your gmail settings.
# Right now it won't download same file name twice even if their contents are different.
# Gmail as of now returns in bytes but just in case they go back to string this line is left here.

import email
import getpass, imaplib
import os
import sys
import time

detach_dir = '.'
if 'attachments' not in os.listdir(detach_dir):
    os.mkdir('attachments')

userName = input('Enter your GMail username:\n')
passwd = getpass.getpass('Enter your password:\n')

try:
    imapSession = imaplib.IMAP4_SSL('imap.gmail.com',993)
    typ, accountDetails = imapSession.login(userName, passwd)
    if typ != 'OK':
        print ('Not able to sign in!')
        raise

    imapSession.select('Inbox')
    typ, data = imapSession.search(None, 'ALL')
    if typ != 'OK':
        print ('Error searching Inbox.')
        raise

    # Iterating over all emails
    for msgId in data[0].split():
        typ, messageParts = imapSession.fetch(msgId, '(RFC822)')

        if typ != 'OK':
            print ('Error fetching mail.')
            raise 

        #print(type(emailBody))
        emailBody = messageParts[0][1]
        #mail = email.message_from_string(emailBody)
        mail = email.message_from_bytes(emailBody)

        for part in mail.walk():
            #print (part)
            if part.get_content_maintype() == 'multipart':
                # print part.as_string()
                continue
            if part.get('Content-Disposition') is None:
                # print part.as_string()
                continue

            fileName = part.get_filename()

            if bool(fileName):
                filePath = os.path.join(detach_dir, 'attachments', fileName)
                if not os.path.isfile(filePath) :
                    print (fileName)
                    fp = open(filePath, 'wb')
                    fp.write(part.get_payload(decode=True))
                    fp.close()

    imapSession.close()
    imapSession.logout()

except :
    print ('Not able to download all attachments.')
    time.sleep(3) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-08T05:23:54.700

由于 Gmail 支持标准协议 POP 和 IMAP，任何提供任一协议客户端的平台、工具、应用程序、组件或 API 都应该可以工作。

我建议在 Google 上搜索你最喜欢的语言/平台（例如，“python”），加上“pop”，加上“imap”，也许再加上“开源”，也许再加上“下载”或“评论”，然后看看你得到选择。

有许多免费的应用程序和组件，选择一些看起来值得的，查看评论，然后下载并享受。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-05T13:07:02.363

您应该知道您需要 SSL 才能连接到 GMail（对于 POP3 和 IMAP - 这当然也适用于他们的 SMTP 服务器，除了端口 25，但这是另一回事）。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-11-13T10:32:33.377

这是我用[Groovy](http://groovy.codehaus.org/)（Java 平台的动态语言）下载银行对账单时写的。

```
import javax.mail.*
import java.util.Properties

String  gmailServer
int gmailPort
def user, password, LIMIT
def inboxFolder, root, StartDate, EndDate

//    Downloads all attachments from a gmail mail box as per some criteria
//    to a specific folder
//    Based on code from
//    http://agileice.blogspot.com/2008/10/using-groovy-to-connect-to-gmail.html
//    http://stackoverflow.com/questions/155504/download-mail-attachment-with-java
//
//    Requires: 
//        java mail jars in the class path (mail.jar and activation.jar)
//        openssl, with gmail certificate added to java keystore (see agileice blog)
//        
//    further improvement: maybe findAll could be used to filter messages
//    subject could be added as another criteria
////////////////////// <CONFIGURATION> //////////////////////
// Maximm number of emails to access in case parameter range is too high
LIMIT = 10000

// gmail credentials
gmailServer = "imap.gmail.com"
gmailPort = 993

user = "gmailuser@gmail.com"
password = "gmailpassword"

// gmail label, or "INBOX" for inbox
inboxFolder = "finance"

// local file system where the attachment files need to be stored
root = "D:\\AttachmentStore" 

// date range dd-mm-yyyy
StartDate= "31-12-2009"
EndDate = "1-6-2010" 
////////////////////// </CONFIGURATION> //////////////////////

StartDate = Date.parse("dd-MM-yyyy", StartDate)
EndDate = Date.parse("dd-MM-yyyy", EndDate)

Properties props = new Properties();
props.setProperty("mail.store.protocol", "imaps");
props.setProperty("mail.imaps.host", gmailServer);
props.setProperty("mail.imaps.port", gmailPort.toString());
props.setProperty("mail.imaps.partialfetch", "false");

def session = javax.mail.Session.getDefaultInstance(props,null)
def store = session.getStore("imaps")

store.connect(gmailServer, user, password)

int i = 0;
def folder = store.getFolder(inboxFolder)

folder.open(Folder.READ_ONLY)

for(def msg : folder.messages) {

     //if (msg.subject?.contains("bank Statement"))
     println "[$i] From: ${msg.from} Subject: ${msg.subject} -- Received: ${msg.receivedDate}"

     if (msg.receivedDate <  StartDate || msg.receivedDate > EndDate) {
         println "Ignoring due to date range"
         continue
     }

     if (msg.content instanceof Multipart) {
         Multipart mp = (Multipart)msg.content;

         for (int j=0; j < mp.count; j++) {

             Part part = mp.getBodyPart(j);

             println " ---- ${part.fileName} ---- ${part.disposition}"

             if (part.disposition?.equalsIgnoreCase(Part.ATTACHMENT)) {

                 if (part.content) {

                     def name = msg.receivedDate.format("yyyy_MM_dd") + " " + part.fileName
                     println "Saving file to $name"

                     def f = new File(root, name)

                     //f << part.content
                     try {
                         if (!f.exists())
                             f << part.content
                     }
                     catch (Exception e) {
                         println "*** Error *** $e" 
                     }
                 }
                 else {
                    println "NO Content Found!!"
                 }
             }
         }
     }

     if (i++ > LIMIT)
         break;

} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2014-09-24T05:48:52.963

```
/*based on http://www.codejava.net/java-ee/javamail/using-javamail-for-searching-e-mail-messages*/
package getMailsWithAtt;

import java.io.File;
import java.io.IOException;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.Properties;

import javax.mail.Address;
import javax.mail.Folder;
import javax.mail.Message;
import javax.mail.MessagingException;
import javax.mail.Multipart;
import javax.mail.NoSuchProviderException;
import javax.mail.Part;
import javax.mail.Session;
import javax.mail.Store;
import javax.mail.internet.MimeBodyPart;
import javax.mail.search.AndTerm;
import javax.mail.search.SearchTerm;
import javax.mail.search.ReceivedDateTerm;
import javax.mail.search.ComparisonTerm;

public class EmailReader {
    private String saveDirectory;

    /**
     * Sets the directory where attached files will be stored.
     * 
     * @param dir
     *            absolute path of the directory
     */
    public void setSaveDirectory(String dir) {
        this.saveDirectory = dir;
    }

    /**
     * Downloads new messages and saves attachments to disk if any.
     * 
     * @param host
     * @param port
     * @param userName
     * @param password
     * @throws IOException
     */
    public void downloadEmailAttachments(String host, String port,
            String userName, String password, Date startDate, Date endDate) {
        Properties props = System.getProperties();
        props.setProperty("mail.store.protocol", "imaps");
        try {
            Session session = Session.getDefaultInstance(props, null);
            Store store = session.getStore("imaps");
            store.connect("imap.gmail.com", userName, password);
            // ...
            Folder inbox = store.getFolder("INBOX");
            inbox.open(Folder.READ_ONLY);
            SearchTerm olderThan = new ReceivedDateTerm (ComparisonTerm.LT, startDate);
            SearchTerm newerThan = new ReceivedDateTerm (ComparisonTerm.GT, endDate);
            SearchTerm andTerm = new AndTerm(olderThan, newerThan);
            //Message[] arrayMessages = inbox.getMessages(); <--get all messages
            Message[] arrayMessages = inbox.search(andTerm);
            for (int i = arrayMessages.length; i > 0; i--) { //from newer to older
                Message msg = arrayMessages[i-1];
                Address[] fromAddress = msg.getFrom();
                String from = fromAddress[0].toString();
                String subject = msg.getSubject();
                String sentDate = msg.getSentDate().toString();
                String receivedDate = msg.getReceivedDate().toString();

                String contentType = msg.getContentType();
                String messageContent = "";

                // store attachment file name, separated by comma
                String attachFiles = "";

                if (contentType.contains("multipart")) {
                    // content may contain attachments
                    Multipart multiPart = (Multipart) msg.getContent();
                    int numberOfParts = multiPart.getCount();
                    for (int partCount = 0; partCount < numberOfParts; partCount++) {
                        MimeBodyPart part = (MimeBodyPart) multiPart
                                .getBodyPart(partCount);
                        if (Part.ATTACHMENT.equalsIgnoreCase(part
                                .getDisposition())) {
                            // this part is attachment
                            String fileName = part.getFileName();
                            attachFiles += fileName + ", ";
                            part.saveFile(saveDirectory + File.separator + fileName);
                        } else {
                            // this part may be the message content
                            messageContent = part.getContent().toString();
                        }
                    }
                    if (attachFiles.length() > 1) {
                        attachFiles = attachFiles.substring(0,
                                attachFiles.length() - 2);
                    }
                } else if (contentType.contains("text/plain")
                        || contentType.contains("text/html")) {
                    Object content = msg.getContent();
                    if (content != null) {
                        messageContent = content.toString();
                    }
                }

                // print out details of each message
                System.out.println("Message #" + (i + 1) + ":");
                System.out.println("\t From: " + from);
                System.out.println("\t Subject: " + subject);
                System.out.println("\t Received: " + sentDate);
                System.out.println("\t Message: " + messageContent);
                System.out.println("\t Attachments: " + attachFiles);
            }

            // disconnect
            inbox.close(false);
            store.close();

        } catch (NoSuchProviderException e) {
            e.printStackTrace();
            System.exit(1);
        } catch (MessagingException e) {
            e.printStackTrace();
            System.exit(2);
        } catch (IOException ex) {
            ex.printStackTrace();
        }
    }

    /**
     * Runs this program with Gmail POP3 server
     * @throws ParseException 
     */
    public static void main(String[] args) throws ParseException {
        String host = "pop.gmail.com";
        String port = "995";
        String userName = "user@gmail.com";
        String password = "pass";
        Date startDate = new SimpleDateFormat("yyyy-MM-dd").parse("2014-06-30");
        Date endDate = new SimpleDateFormat("yyyy-MM-dd").parse("2014-06-01");
        String saveDirectory = "C:\\Temp";

        EmailReader receiver = new EmailReader();
        receiver.setSaveDirectory(saveDirectory);
        receiver.downloadEmailAttachments(host, port, userName, password,startDate,endDate);

    }
} 
```

Maven依赖：

```
<dependency>
    <groupId>com.sun.mail</groupId>
    <artifactId>javax.mail</artifactId>
    <version>1.5.1</version>
</dependency> 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-13T03:52:27.720

您是否查看过维基百科上的[GMail 3rd 方插件？](http://en.wikipedia.org/wiki/Gmail#Gmail_3rd_party_Add-Ins)

特别是，[PhpGmailDrive](http://en.wikipedia.org/wiki/PhpGmailDrive)是一个开源插件，您可以按原样使用它，或者学习灵感？

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-13T11:56:17.370

对于 Java，您会发现[G4J 很有](http://g4j.sourceforge.net/)用。它是一组通过 Java 与 Google Mail 通信的 API（主页上的截图是一个围绕此构建的演示电子邮件客户端）

# java - JMF 编码

> ID：348643
> 
> 赞同：0
> 
> 时间：2008-12-08T04:15:04.167
> 
> 标签：java, ffmpeg, jmf

我正在从一组图像中创建一些视频，随后我希望用 java 播放这个视频。我找到了 JMF，但我还没有找到它实际上可以播放的编码。有没有人有产生 JMF 可播放输出的 ffmpeg 或 mencoder 公式？如果有更好的东西，我也会选择 JMF 的替代品。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-03-08T10:50:22.997

有两件事，您需要使用此处列出的格式：http: [//java.sun.com/javase/technologies/desktop/media/jmf/2.1.1/formats.html](http://java.sun.com/javase/technologies/desktop/media/jmf/2.1.1/formats.html) 其次，JMF 在某些情况下似乎仍然存在问题分辨率、帧率和比特率。我发现当要读取的视频不仅是可接受的格式，而且长度超过 2 分钟时，它可以成功解码。我不知道为什么；这恰好是我的经验。希望能帮助到你。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T12:06:30.410

根据[JMF 2.1.1 - Supported Formats](http://java.sun.com/javase/technologies/desktop/media/jmf/2.1.1/formats.html)页面，Quicktime 和各种编解码器都支持直接解码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-18T14:46:42.577

如果你没有被 JMF 卡住，你可以试试[Xuggler](http://www.xuggle.com/xuggler)。它将为您编码几乎所有格式（JMF 刚刚落入的领域之一）。

这是 Xuggler 的[教程](http://wiki.xuggle.com/MediaTool_Introduction#How_To_Take_Snapshots_Of_Your_Desktop)，展示了如何从预先存在的视频图像创建视频文件。

# jquery - 防止表单中的值传递

> ID：348646
> 
> 赞同：1
> 
> 时间：2008-12-08T04:16:13.870
> 
> 标签：jquery, forms, webforms

我的表单中有 4 个`<select></select>`元素。通常在提交表单时，您会在 url 中得到这个，例如

```
index.html?day=01&month=01&year=1999&reporter=Joe+Blogs 
```

然而，在我的界面中，用户正在日​​期选择器和人员选择器之间切换。是否可以只发送处于活动状态的选择上的值？

[我开始写这篇文章是为了发给你们，但后来我想到并检查了表单元素的禁用属性——所以本着堆栈溢出的精神，我也输入了自己的答案]

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T04:16:44.367

在 jQuery 中使用 .attr("disabled","disabled") 。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T07:57:28.180

您可以将日期选择器和名称选择放在单独的表单中（可能使用单独的“Action=...”）。

简单，适用于任何浏览器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-11T03:20:32.513

是的 - 在我这样做之后，我意识到我为非 js 用户创建的问题。我做了一个“待办事项”，把它分成两种形式。我认为通过打开和关闭不同的字段集（尝试使用正确的标记）我很聪明，但后来，是的，把它塞进去了。哦，好吧，至少我了解了 disabled 以及如何在 jQuery 中操作它......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T07:46:41.870

为什么你在javascript中禁用它呢？

无论如何，您应该做出服务器端决定，如果服务器同时获取人员和日期参数怎么办（例如，禁用 javascript 或仅阻止 jquery 的人......）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-08T13:04:15.877

我宁愿将控件传递给服务器端以进行任何类型的验证。

# regex - 如何使用 Perl 在字符串中查找子字符串？

> ID：348657
> 
> 赞同：9
> 
> 时间：2008-12-08T04:31:18.300
> 
> 标签：regex, perl, substring

我有一个字符串，我希望从中提取一个单词，但附加了一个数字，每行可能不同：

```
This is string1 this is string
This is string11 
This is string6 and it is in this line 
```

我想解析这个文件并获取“stringXXX”的值，从 0 到 100

```
# suppose ABC.txt contains the above lines
FH1 = open "Abc.txt"; 
@abcFile = <FH1>;

foreach $line(@abcFile) {
    if ($pattern =~ s/string.(d{0}d{100});
        print $pattern; 
```

上面打印了整行，我希望只得到 stringXXX

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-08T04:39:10.220

你需要捕捉它：

```
while ($pattern =~/(string(100|\d{1,2}))/g) {
    print $1;
} 
```

解释：

*   括号将其中的内容捕获到 $1 中。如果您有多个括号，第一个捕获到 $1，第二个捕获到 $2 等。在这种情况下，$2 将具有实际数字。
*   \d{1,2} 捕获 1 到 3 位数字，允许您捕获 0 到 99 之间的数字。额外的 100 允许您明确捕获 100，因为它是您要匹配的唯一 3 位数字。

编辑：修复了捕获的数字的顺序。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-08T05:33:05.040

Abc.pl：

```
#!/usr/bin/perl -w    
while(<>) {
    while (/(string(\d{1,3}))/g) {      
    print "$1\n" if $2 <= 100;
    } 
} 
```

例子：

```
$ cat Abc.txt 
This is string1 this is string
This is string11 
This is string6 and it is in this line
string1 asdfa string2
string101 string3 string100 string1000
string9999 string001 string0001

$ perl Abc.pl Abc.txt
string1
string11
string6
string1
string2
string3
string100
string100
string001
string000

$ perl -nE"say $1 while /(string(?:100|\d{1,2}(?!\d)))/g" Abc.txt
string1
string11
string6
string1
string2
string3
string100
string100 
```

注意输出之间的差异。什么更可取取决于您的需求。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-12-09T17:51:18.090

不要过度指定。要捕获数字部分，只需使用 (\d+) 。这将捕获任意长度的数字，以便有一天当为您提供此文件的猴子决定将其范围扩大到 999 时，您将被覆盖。现在写的时候和以后维护的时候也很少考虑。

对你发出的东西要严格，但对你接受的东西要自由。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-12-08T05:21:20.180

只需将 print $pattern 更改为 print $&，它已经被捕获。

# c - TCP Keepalive 是唯一确定链接断开的机制吗？

> ID：348658
> 
> 赞同：4
> 
> 时间：2008-12-08T04:31:34.337
> 
> 标签：c, linux, tcp

我最近遇到了一个问题，即 TCP 服务器和客户端之间的中间链接已关闭。如果主服务器关闭，客户端需要连接到辅助服务器。当主服务器被买断时（例如 ..通过在终端上执行 ^C），TCP 关闭序列通过，客户端成功检测到断开的链接并尝试辅助服务器。但是，如果中间链接发生故障，客户端和服务器将不会意识到这一点。客户端可以检测到的唯一方法是它的 TCP 缓冲区何时被失败的“发送”操作填满。

作为对此的解决方案，使用了“TCP Keepalive”机制。这令人满意。

我的问题是“TCP Keepalive”是唯一的解决方案吗？

-帕布

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-08T06:29:27.470

Keepalive 旨在处理所谓的半打开连接，当其中一方（通常是接收请求的服务器）不知道连接已断开时。客户端通常知道这一点，因为尝试向服务器发送请求会返回错误。

另一种选择是让监听器保持运行——当客户端检测到通信问题时，它只是尝试再次连接到服务器。服务器获取传入连接，检查是否来自相同的IP地址，如果是，则关闭打开的连接并建立新的连接。

但是如果客户端不知道连接断开并且服务器需要发送一些东西，那么服务器就没有办法重新建立连接，只能使用 TCP keepalive。

如果您不想使用keepalive，您可以使用应用程序级别的keepalive，例如发送应用程序特定的回显消息之类的东西。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-08T06:38:19.777

我总是在应用程序级别处理这个问题，方法是扩展客户端和服务器之间通过 TCP 交谈的协议，使用“保持活动”-消息服务器和客户端每秒发送此消息，如果他们在 2 秒内没有得到“保持活动”-消息，连接可能已关闭。

TCP 的 Keep-Alive 机制很好，但很难使用，尤其是在不同平台上工作时。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-03T22:55:23.467

Another solution is to use a heartbeat on a separate socket. That way you know almost immediately if the connection is down. This is useful when your primary connection is sending streaming data with no message boundaries.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-08T04:36:51.223

您可以使用 TCP 的 Out-Of-Band 功能发明并实现您自己的 keep-alive，但我什至不会考虑这一点，除非您对已经为您构建的功能有一些重大问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-08T09:43:23.007

Even without SO_KEEPALIVE set, if you try to send data along a dead tcp connection, it typically gets reset, or will eventually time out - either of these sends an error to the application eventually.

SO_KEEPALIVE means that this may be detected sooner on an otherwise idle connection. That's all.

# cocoa-touch - 如何接收触摸事件？

> ID：348667
> 
> 赞同：0
> 
> 时间：2008-12-08T04:36:54.747
> 
> 标签：cocoa-touch

我想收到一个触摸事件。另外我想要某种坐标来指示用户触摸屏幕的位置。

如何在 iPhone 应用程序中接收触摸事件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T04:50:17.030

查找 UIView 类的 -touchesBegan、-touchesMoved 和 -touchesEnded 方法 - 您需要继承这些方法并覆盖这些方法。每一个都给你一个 UITouch 对象的 NSSet；除非您正在处理多点触控，否则您可以通过在集合上调用 -anyObject 来获取触控对象。然后，使用视图本身（或您想要相对坐标的另一个视图）调用 -locationInView:。

# tfs - TFS 08 - 找不到 AgentService.asmx

> ID：348669
> 
> 赞同：1
> 
> 时间：2008-12-08T04:38:00.907
> 
> 标签：tfs

我们在 TFS 服务器上运行了一个通知服务，它会在创建某些工作项时自动修改它们，以便将它们分配给正确的人等等。

上周末，我们的 TFS 服务器应用了一个补丁，从那以后通知服务似乎被破坏了。

当它运行时，我们会在事件查看器中收到一个错误，表明访问`http://<our-tfs>:8080/Build/v2.0/AgentService.asmx`.

我查看了 IIS 映射`Build`到的文件夹，确实，AgentService.asmx 不存在。

有谁知道该文件可能会移动到哪里？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T10:32:55.090

AgentService.asmx 是由团队基础构建代理上的 Visual Studio Team Foundation Build 服务托管的 Web 服务。Build Agent 服务实际上通过 WCF 使该 URL 可用，因此不会显示在 IIS 下。默认情况下，生成代理配置为在端口 9191 上运行，这样如果生成代理也安装在托管 Team Foundation Server 的同一台计算机上，它就不会与 Team Foundation Server 应用程序层 (8080) 的默认端口冲突。

是否要检查“Visual Studio Team Foundation Build”服务是否正在运行？如果与构建代理通信时出现错误，那么您可能已重新设置代理的状态以使 TFS 再次与其通信（通过右键单击团队资源管理器中的构建节点并选择构建代理... )

但是，我不确定此事件是否是您的问题。您是否碰巧知道最近将哪个补丁应用到您的 TFS 或您让 TFS 向其发送事件的 Web 服务在哪里？

祝你好运，

马丁。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-11T02:58:33.453

原来问题是错误配置的构建代理（指向错误的服务器）。完整的详细信息可以在此处的博客文章中找到：[http ://feedproxy.google.com/~r/KarlKopp/~3/VFmWhwwGyUk/tfs-the-case-of-the-phantom-build-agent](http://feedproxy.google.com/~r/KarlKopp/~3/VFmWhwwGyUk/tfs-the-case-of-the-phantom-build-agent)

# iphone - 从 CFHTTPMessageRef 获取原始 HTTP 请求

> ID：348680
> 
> 赞同：4
> 
> 时间：2008-12-08T04:55:05.147
> 
> 标签：iphone, networking, core-foundation

我正在使用 的包装类`CFHTTPMessage`，它包含一个`CFHTTPMessageRef`添加了方法 (GET) 的对象、Web 应用程序服务器的 URL，以及一些包含日期和身份验证随机数的自定义标头。

我在获取返回某些数据的方法和 URL 时遇到了一些问题。我想我已经计算出了身份验证随机数。

我想通过查看发送到 Web 应用程序的原始请求来解决此问题，并确保所有内容的格式都正确。

我的问题是：如果我有一个`CFHTTPMessageRef`对象（例如`messageRef`），有没有办法记录来自该消息的原始 HTTP 请求？

我尝试了以下方法，但是`EXC_BAD_ACCESS`当我尝试访问它的字节时收到一个信号：

```
CFDataRef messageData = CFHTTPMessageCopyBody(messageRef); 
```

感谢您的任何建议。

作为替代方案，是否可以在交换网络上使用数据包嗅探器？我可以`ettercap`在笔记本电脑设备上运行，但不知道如何嗅探我的 iPhone 在本地无线网络上所做的事情。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-08T23:35:44.993

以下效果很好：

```
NSData *d = (NSData *)CFHTTPMessageCopySerializedMessage(messageRef);
NSLog(@"%@",[[[NSString alloc] initWithBytes:[d bytes] length:[d length] encoding:NSUTF8StringEncoding] autorelease]); 
```

希望这对其他人有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T22:25:57.087

访问字节时应该获得 EXC_BAD_ACCESS 的唯一原因是如果 messageData 为 NULL（无 HTTP 正文）并且您正在取消引用它。

要记住的一点：HTTP 正文不是“原始请求”。它不包括标头或实际的 HTTP 指令 (GET/POST/ETC)。如果您没有实际设置正文内容，它将为零。

您的 CFHTTPMessageRef 值可能（但不太可能）未正确初始化。通过在 CFHTTPMessageCopyBody 行上设置断点，进入调试器控制台窗口，将文本输入光标设置到此窗口的最后一行并键入“po messageRef”，在调试器中检查这一点。如果有效初始化，它应该给你一个 CFTypeID 消息。

# cocoa - 使用绑定设置 NSBrowserCell 图像？

> ID：348684
> 
> 赞同：2
> 
> 时间：2008-12-08T04:57:48.887
> 
> 标签：cocoa, cocoa-bindings, nstreecontroller

我有一个 NSBrowser 连接到一个 NSTreeController 绑定到一个 NSTreeNode 对象数组。通过设置 Content 和 Content Value 绑定以正确引用树控制器，很容易使文本部分正常工作，但是如何使用绑定为每个单元格设置图像？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T14:38:17.590

不幸的是，你不能用 NSBrowserCell 轻松做到这一点。为您的浏览器列使用另一个单元格，该单元格采用 -setObjectValue: 中传递给它的对象值：并适当地填充其自己的文本和图像。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T15:18:28.900

没有内置机制可以仅使用绑定在浏览器单元格中显示图像。如果你真的想要，你可以安装这样的系统，但根据我的经验，有时它比跳过箍更麻烦，因为你可以说你所有的东西都使用绑定，而且用老式的方式做事更容易。

将图像放入浏览器单元格的“传统”方法是实现浏览器委托方法：

`- (void)browser:(NSBrowser *)sender willDisplayCell:(id)cell atRow:(NSInteger)row column:(NSInteger)column`

这使您可以在浏览器绘制单元格之前根据需要自定义单元格。查看 /Developer/Examples/AppKit 中的 SimpleBrowser 示例，您会在其中找到如何使用此委托方法的示例。不过，您不应该需要他们在该项目中使用的自定义单元格 - 该项目从 10.2 天之前开始，在 NSBrowserCell 提供自己的图像绘制机制之前。

# sql - 如何在共享托管服务器上自动执行 SQL 备份？

> ID：348688
> 
> 赞同：1
> 
> 时间：2008-12-08T05:02:18.033
> 
> 标签：sql, sql-server, backup

我正在使用托管服务，它允许我备份我的 SQL 2008 数据库并仅通过 Web 界面下载 BAK 文件——并且我可以通过 Management Studio 访问数据库。我可以从 Management Studio 执行备份命令，但我没有备份所在路径的权限。有什么方法可以通过 SQL 或脚本来下载数据库的完整副本——我可以生成使用代码重新创建数据库所需的脚本吗？它只有几千条记录。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T05:20:44.660

如果您可以通过 Management Studio 访问，为什么不将托管数据库复制到本地计算机（任务 > 复制数据库）？

一旦它被恢复到本地系统，你可以做任何你想做的事情。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-09T05:12:32.330

免费的[SqlBackupAndFTP](http://SqlBackupAndFTP.com)允许使用脚本进行远程备份

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-03-24T00:13:43.747

只是将其留在这里作为答案（将整个数据库编写为 .sql 文件（包括数据），然后用 winrar 压缩它。）

我创建了这个解决方案，每天从任务调度程序运行一次，这就是为什么它只下降到每天的水平。如果您想多运行一次（例如，每半小时一次），您需要编辑“%date:~-4,4%%date:~-7,2%%date:~-10,2 %”字段下降到小时/分钟/秒级别，具体取决于您的需要。

**注意：需要安装 SQL 发布向导和 Winrar**

**begin.bat** - 保存日志文件记录的包装器。这是任务计划程序要调用的批处理文件

```
::Run dbbackup.bat and append all output to log.txt

md C:\[directory]\%date:~-4,4%%date:~-7,2%%date:~-10,2%

"dbbackup.bat" >> "C:\[Directory]\%date:~-4,4%%date:~-7,2%%date:~-10,2%\log.txt" 
```

**dbbackup.bat** - 备份数据库

```
echo off
cls
echo %date% %time%
echo ***************************************************************************
echo ** Script all objects in databases and save them in 'yyyymmdd' folder  **
echo ***************************************************************************
cd C:\[directory]\%date:~-4,4%%date:~-7,2%%date:~-10,2%
"C:\Program Files\Microsoft SQL Server\90\Tools\Publishing\sqlpubwiz.exe" script -C "[ConnectionString]" [dbname]_%date:~-4,4%%date:~-7,2%%date:~-10,2%.sql
echo ***************************************************************************
echo ** RAR compress all .sql script files                                    **
echo ***************************************************************************
"C:\Program Files\WinRAR\WinRAR.exe" -ibck a [dbname]_%date:~-4,4%%date:~-7,2%%date:~-10,2%.rar [dbname]_%date:~-4,4%%date:~-7,2%%date:~-10,2%.sql
echo WinRAR has completed execution
echo ***************************************************************************
echo ** Delete all .sql script files                                          **
echo ***************************************************************************
del *.sql
echo .SQL files deleted 
```

只需创建一个计划任务来运行 begin.bat 以在您需要的任何时间间隔运行，数据库备份将与日志文件一起编写脚本。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-08T05:32:49.893

如果主机没有提供一种简单的方法来获取数据库的异地备份（自动 - 并告诉你如何做），你应该找到另一个。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-08T10:36:15.443

[一种方法是编写数据库结构脚本并使用此 SSMS 插件http://www.ssmstoolspack.com/](http://www.ssmstoolspack.com/)为整个数据库生成插入语句

# asp.net - 带有 ASP.NET WebMethod 的 Jquery AJAX 返回整个页面

> ID：348689
> 
> 赞同：38
> 
> 时间：2008-12-08T05:02:29.500
> 
> 标签：asp.net, jquery, ajax

我正在做一些简单的测试（为更大的项目做准备）以使用 JQuery AJAX 调用 ASP.NET WebMethod。在我的示例中，我的 WebMethod 返回一个简单的字符串。但是，当我尝试使用 JQuery 调用它时，我会返回整个 HTML 页面内容，而不仅仅是我的字符串。我错过了什么？

客户端 ：

```
$(document).ready(function ready() {
        $("#MyButton").click(function clicked(e) {
            $.post("Default.aspx/TestMethod",
                {name:"Bob"},
                function(msg) {
                    alert("Data Recieved: " + msg);
                },
                "html"
            );
        });
    }); 
```

服务器端：

```
using System;
using System.Web.Services;

namespace JqueryAjaxText
{
    public partial class _Default : System.Web.UI.Page
    {
        protected void Page_Load(object sender, EventArgs e)
        {

        }

        [WebMethod]
        public static string TestMethod(string name)
        {
            return "The value submitted was " + name;
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-08T06:03:29.223

看看这个链接。我使用他的其他一些帖子成功地调用了 WCF 服务。请务必查看相关文章：

[http://encosia.com/2008/05/29/using-jquery-to-directly-call-aspnet-ajax-page-methods/](http://encosia.com/2008/05/29/using-jquery-to-directly-call-aspnet-ajax-page-methods/)

通读这篇文章，但本质上是：

```
 $("#Result").click(function() {
    $.ajax({
      type: "POST",
      url: "Default.aspx/GetDate",
      data: "{}",
      contentType: "application/json; charset=utf-8",
      dataType: "json",
      success: function(msg) {
        $("#Result").text(msg.d);
      }
    });
}); 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-08T14:17:14.543

我想我对 JQuery 的 $.post 命令中的“类型”参数感到困惑。在与一些人交谈之后，调用 WebMethod 的返回类型似乎必须是“json”。我试图使用“html”。一旦我将其更改为“json”，然后一切正常。显然，用 [WebMethod] 装饰的方法只返回 JSON，这就是我挂断的地方。

谢谢你们的回复。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-08T05:28:07.577

尝试将最后一个参数“html”更改为“text”。此参数指定要返回的数据类型。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-02-03T17:28:13.223

我遇到了完全相同的问题：WebMethod 返回了整个 HTML 页面，而不是预期的数据。对我来说，解决方案来自**~/App_Start/RouteConfig.cs**内部更改 以下行：

```
settings.AutoRedirectMode = RedirectMode.Permanent; 
```

到

```
settings.AutoRedirectMode = RedirectMode.Off; 
```

# datetime - 在 Lingo 中比较日期

> ID：348690
> 
> 赞同：0
> 
> 时间：2008-12-08T05:03:00.107
> 
> 标签：datetime, lingo

如何在 Lingo 中比较两个日期？具体来说，我想知道今天的日期是否在某个固定日期之后。我知道我可以使用以下方法创建固定日期：

```
date("20090101") 
```

我可以使用以下方法获取当前日期：

```
_system.date() 
```

但我似乎无法直接比较两者。我是否必须解析 _system.date() 以确定它是否在我的固定日期之后？我试过：

```
if(_system.date() > date("20090101") then
    --do something
end if 
```

但这似乎不起作用。有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-12-03T10:26:55.103

而不是 _system.date()，尝试 _movie.systemDate()，它将返回一个日期对象，您可以安全地与另一个对象进行比较。

如果 _movie.systemDate() > date("20090101") 那么

```
--do something 
```

万一

问候

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T05:21:57.760

我最终做了以下事情。不优雅，但它有效：

```
 if (_system.date().char[1..2] >= 01 and _system.date().char[4..5] >= 01 and _system.date().char[7..10] >= 2010) then
    alert("Your license has expired. Please contact the Company to renew your license.")
    _player.quit()
  end if 
```

它可以解决问题，但我仍然会对这样做的替代方法感兴趣。

# time - 带有时间盐的客户端 MD5 哈希

> ID：348704
> 
> 赞同：4
> 
> 时间：2008-12-08T05:19:56.610
> 
> 标签：time, hash, md5, salt

我想在客户端的 JS 中使用更高阶的时间值（< 1 分钟分辨率）对散列的用户名和密码（通过 http POST 提交）加盐，以避免将用户名和密码散列作为常量值发送，这可能是用于未经授权的用户（即嗅探器）通过 POST 制造的登录尝试。

这将对传递的哈希的有用性施加短暂的到期。

如果他们检查 JS 并看到它使用了这次的盐，如果他们知道盐是什么，那么破解 MD5 的工作会容易多少？

斯蒂芬

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-08T06:29:41.743

盐[不需要保密](https://stackoverflow.com/questions/213380/the-necessity-of-hiding-the-salt-for-a-hash#215165)。从这个意义上说，您的解决方案是可以的。

MD5 在某些应用程序中被破坏；这个可能没问题，但为什么不使用[SHA-2 系列](http://en.wikipedia.org/wiki/SHA-2#SHA-2_family)的哈希？就此而言，为什么不使用 SSL 来提供机密通道和更好的安全性呢？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T15:03:51.003

基于时间的盐不会使 MD5 更容易破解。您仍然依赖 1) 具有良好密码的用户来击败暴力计算，以及 2) MD5 是一个不错的哈希值。这是您问题的基本答案。但是，无论如何，这可能不是一个好主意。一些评论——

除非您可以确保客户端或服务器的时间是同步的（或者您使用 Javascript 来伪造同步），否则客户端将不得不发送它用作盐的时间。服务器必须决定使用的时间是否足够接近服务器的时间。

即使同步，由于 Internet 上的延迟，您也可能不得不接受正负一分钟左右的哈希值。另一个问题是，如果我在嗅探，只要我还在这个时间窗口内，我就可以立即重用这个哈希。

由于上述问题，一个更好的想法是使用带有哈希的一次性服务器分配的盐，因为听起来您不想使用 SSL。换句话说，每次向客户端发送登录表单时，服务器都会生成一个随机的唯一盐字符串，将其发送给客户端并跟踪这是一个可接受的盐。然后客户端将其用作带有密码的盐。提交一次后，服务器将其丢弃为可接受的盐字符串。没有两个哈希值应该是相同的。这样做的缺点是您必须跟踪这些可接受的盐字符串。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-08T05:27:26.267

他们的工作将变得不可行，因为如果哈希正确加盐，您根本无法使用彩虹表，而且您不能在不到一分钟的时间内破坏 MD5，届时哈希无论如何都会失效。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2012-03-03T02:19:35.757

您可以使用代码混淆使盐更难找到

# charts - 如何在 asp.net 中使用 Google Chart API 创建图表？

> ID：348706
> 
> 赞同：4
> 
> 时间：2008-12-08T05:20:06.033
> 
> 标签：charts

如何在 asp.net 中使用 Google Chart API 创建图表？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-08T06:15:00.570

谷歌是一个很好的起点……

[Google Charts API 作为 ASP.NET 2.0 服务器控件](http://pietschsoft.com/post/2007/12/Google-Charts-API-an-ASPNET-20-Server-Control.aspx)

[谷歌图表网](http://www.codeplex.com/GoogleChartNet)

或者更好的是使用新的 ASP.NET 图表控件

[ASP.NET 图表控件](http://weblogs.asp.net/scottgu/archive/2008/11/24/new-asp-net-charting-control-lt-asp-chart-runat-quot-server-quot-gt.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T16:57:18.327

仅供参考，有很多 Google Chart API[包装器 API](http://groups.google.com/group/google-chart-api/web/useful-links-to-api-libraries)可以让您在处理低级 Google Chart API 细节方面更轻松。我写了一个 Java 端（称为[charts4j](http://charts4j.googlecode.com)）。但在 .NET 领域中也至少有一个包装 API。

我对 ASP .Net 堆栈并不完全熟悉，但您可能希望生成 Google Chart URL 服务器端，并使用您的 HTML 视图技术在图像标记中显示该 URL。另一种方法是将数据传递给浏览器并使用 javascript 构建图表 URL，但这可能更繁琐且容易出错。希望有帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-08T06:24:13.673

请参考 4guysfromrolla 上的文章

[使用 ASP.NET 使用 Google 图表 API 创建图表](http://aspnet.4guysfromrolla.com/articles/111908-1.aspx)

[用于 Google 图表的 ASP.NET 自定义服务器控件](http://aspnet.4guysfromrolla.com/articles/112608-1.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-05-09T02:00:47.790

这并不难，要考虑的事情是 1\. 为图表建立数据表并将其保存为 Json 格式 2\. 使用 jquery 函数 getJson 检索它，然后按照 google API on how to Parse Json file，然后有我使用 C# 使用这种方法构建了很多图表

# javascript - 使用约束来安排应用程序何时可以发生事件

> ID：348708
> 
> 赞同：1
> 
> 时间：2008-12-08T05:20:59.027
> 
> 标签：javascript, drag-and-drop, calendar, scheduling

好的，我想做的是构建一个网络应用程序，允许学生使用拖放直观地组织他们的班级日历。但他们必须能够拖放到特定位置（当这些类可用时），而不仅仅是任何地方。

这将是一个“固定周”日历。我正在考虑使用表格，但想知道是否有人认为这可能是拖放的问题，以及您是否有更好的实施建议。很想听听你的想法。我是一个非常直观的思考者，并且知道这种应用程序会对我有所帮助。

或者，如果您知道我可以使用已经实现的类似功能，请告诉我！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T07:52:09.563

使用[Dojo 工具包](http://dojotoolkit.org/)来实现繁重的工作怎么样？他们有一[堂课](http://dojotoolkit.org/book/dojo-book-0-9/part-3-programmatic-dijit-and-dojo/drag-and-drop)。

从这个[示例文档](http://dojotoolkit.org/book/dojo-book-0-9/part-3-programmatic-dijit-and-dojo/drag-and-drop/simple-example)：

```
<body style="font-size: 12px;">
<h1>A Simple Example</h1>
<table><tbody><tr>
<td>
<!-- Create a source with two nodes -->
<div dojoType="dojo.dnd.Source" jsId="c1" class="source">
        SOURCE
        <div class="dojoDndItem" dndType="blue">
                <div class="bluesquare">BLUE</div>
        </div>
        <div class="dojoDndItem" dndType="red,darkred">
                <div class="redsquare">RED</div>
        </div>
</div>
</td>
<td>
<!-- Create a target that accepts nodes of type red and blue. -->
<div dojoType="dojo.dnd.Target" jsId="c2" class="target" accept="blue,darkred">
        TARGET
</div>
</td>
</tr><tbody/></table> 
```

你可以看看它是否适合你的问题。它非常漂亮和干净。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T11:53:49.217

jQuery 有可拖拽的[可放置](http://docs.jquery.com/UI/Droppable/droppable#options)类来做你需要的，虽然没有使用过。

[然而，我已经建立了一个 JavaScript 系统，使用openrico](http://openrico.org/)非常成功地使用拖放对手机内容进行分类，那是几年前的事了，现在我肯定会尝试一下 jQuery..

# asp.net - 如何手动将其他行添加到 ASP.NET 网格视图的底部？

> ID：348724
> 
> 赞同：2
> 
> 时间：2008-12-08T05:27:37.530
> 
> 标签：asp.net, gridview

我有一种情况，我正在使用绑定的数据源填充网格视图，并希望在最底部添加两行；一个显示列中值的总和，一个显示列中值的平均值。我可以很容易地通过聚合从 rowDataBound 事件中获取的信息来计算这些值，但不知道如何手动将额外的两行添加到 gridview。非常感谢任何帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T05:59:45.923

您可以像在 gridview 中使用页眉一样使用页脚。另一种解决方案是以这种方式使用查询：

查询 1：您的原始查询

```
UNION 
```

查询 2：您的查询包含总和

（这仅适用于您不对网格应用分页的情况）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T06:08:04.890

如果是单行信息，您可以使用摘要页脚。请参阅[在 GridView 的页脚中显示摘要信息](http://www.asp.net/Learn/data-access/tutorial-15-cs.aspx)。

[![替代文字](https://i.stack.imgur.com/1Ig6v.png)](https://i.stack.imgur.com/1Ig6v.png)
[（来源：[asp.net](http://static.asp.net/asp.net/images/dataaccess/15fig01css.png)）]

如果您想要另外两行，您可以将行填充到[`IList`](http://msdn.microsoft.com/en-us/library/system.collections.ilist.aspx). 在业务逻辑层，您可以向 DAL 返回的列表添加更多行。

# c++ - 为什么“模板”中有“类” “？

> ID：348730
> 
> 赞同：4
> 
> 时间：2008-12-08T05:31:08.587
> 
> 标签：c++, templates, syntax

模板语句的“类”部分有什么作用？

例子：

```
template <class T>
class Something
{
    public:
        Something(const T &something);
} 
```

还有什么可以去那里？我通常只看到“类”。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-08T05:40:22.107

关键字在很大程度上与关键字的含义`class`相同。`typename`它们都表明 T 是一种类型。

`class`关键字和之间的唯一区别`typename`是`class`可用于向模板提供类模板模板参数，而`typename`不能。考虑：

```
template<template <class T> class U> // must be "class"
std::string to_string(const U<char>& u)
{
  return std::string(u.begin(),u.end());
} 
```

唯一可以代替`class`or`typename`关键字的是整数类型。例如：

```
template<std::size_t max>
class Foo{...};
...
Foo<10> f; 
```

有关这方面的具体示例，请查看`std::bitset<N>`标准库。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-09T22:26:40.360

要定义模板参数，您需要告诉编译器参数是类型还是值。

## 一开始...

如果我没记错的话，C++ 委员会不愿意在 C++ 语言中添加新关键字，因此他们决定授权以下符号：

```
template<int I>
int getTwice()
{
   return I * 2 ;
}

template<class T>
std::string getType(const T & t)
{
   return typeid(t).name() ;
}

void doSomething()
{
   std::cout << "25 : " << getTwice<25>() << std::endl ;
   std::cout << "5  : " << getTwice<5>() << std::endl ;

   std::cout << "type(25)   : " << getType(25) << std::endl ;
   std::cout << "type(25.5) : " << getType(25.5) << std::endl ;
   std::cout << "type(abc)  : " << getType("abc") << std::endl ;
} 
```

哪个输出，在 g++ 中：

```
25 : 50
5  : 10
type(25)   : i
type(25.5) : d
type(abc)  : A4_c 
```

第一个符号是一个值的模板。所以，我们在模板声明中有值的类型：

```
// "I" is the value, and "int" is the type of the value
template <int I> 
```

第二种表示法是未知类型的模板，类型不是“已知”的事实由“类”关键字标记。因此，在这种情况下，“类”意味着“类型”。

```
// "T" is a type... And "class" is the "this-is-a-type" keyword
template <class T> 
```

您会注意到，使用第二种表示法，尽管有 class 关键字，但 T 可能是……一个 int 或另一个内置类型。但是，最好有这种好奇心而不是添加一个新的关键字，你不同意吗？...

## 哎呀...

一切都很好，直到有人编写了以下代码：

```
template<class T> // T could be any STL container, for example a vector<char>
void printContainerData(const T & t)
{
   std::cout << "aVector:" ;

   for(T::const_iterator it = t.begin(), itEnd = t.end(); it != itEnd; ++it)
   {
      std::cout << " " << (*it) ;
   }

   std::cout << std::endl ;
} 
```

其中 T::const_iterator 是一个类型，当然......但是，它可能是 T 类型的类的静态成员，因此是一个值。编译器可能会很困惑。

## 到底...

解决方案是告诉编译器 T::const_iterator**确实**是一种类型......这将导致这种符号：

```
for(class T::const_iterator it = t.begin(), // etc. 
```

但这被认为是不可能的/不正确的（类是关于类声明的，不是吗？）。所以，他们拖着脚，决定确实需要一个关键字**来**告诉编译器符号是一个类型，而不是一个值。

我猜没有考虑“类型”，因为将其设为关键字会破坏很多代码。所以使用 typename 代替。使用 typename，我们可以这样写：

```
for(typename T::const_iterator it = t.begin(), // etc. 
```

为了一致性起见，我们应该使用：

```
template <typename T> 
```

当 T 应该是一个类型，而不是一个值。但出于兼容性原因，旧的表示法：

```
template <class T> 
```

仍然被授权。

## 至于呢？？

[eben](https://stackoverflow.com/questions/348730/why-is-there-class-in-template-class-x#348740)在上面提出了一个答案，一个我想评论的答案，因为它很有趣：

```
template<template <class T> class U> // must be "class"
std::string to_string(const U<char>& u)
{
  return std::string(u.begin(),u.end());
} 
```

我将只评论它的“含义”（这段代码不能在我的 g++ 编译器上与 STL 容器一起使用，但这不是重点，我猜）：有一刻，它对 U 施加了一个约束，说：“U 是一个在类型 T 上模板化的类。这是部分：

```
template <class T> class U 
```

也可以写成：

```
template <typename T> class U 
```

因为 U 实际上只是一个类（而不是内置类型），而 T 是一个类型，任何类型。

下一行，它说 U 专门用于 char：

```
std::string to_string(const U<char>& u) 
```

因此，如果 U 被声明为，则此“通用代码”仅适用于 U：

```
template<typename T>
class U
{
   // Etc.
} ; 
```

并且 U 在一个字符上被实例化：

```
U<char> u ;
// etc.
to_string(u) 
```

但有一件事被遗忘了：Eben 提出的符号可以写成两种方式：

```
template<template <class T> class U>
std::string to_string(const U<char>& u)

template<template <typename T> class U>
std::string to_string(const U<char>& u) 
```

第二个“类”关键字本身不是“类型”关键字。它是一种类型，是 T 上的模板类。因此，符号混乱。

编写 Eben 的代码的另一种方法是消除上述约束，类似于：

```
template<typename U>
std::string to_string(const U & u)
{
   return std::string(u.begin(),u.end());
} 
```

让编译器发挥它的魔力：

```
std::list<char> myList ;
// etc.
std::cout << to_string(myList) << std:endl ; 
```

（例如，Eben 的代码不适用于在我的 g++ 编译器上以“char”为模板的 STL 容器......）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-08T06:05:03.570

您还可以将以下内容用作模板参数：

*   任何整数类型`short, int, long, bool`等
*   指向对象或函数的指针
*   对对象或函数的引用
*   指向成员对象或成员函数的指针

几个例子：

```
template<typename T, int N=4, bool Flag>
class myClass { /*...*/ };

template<typename T, const int& Reference, myClass * Pointer>
class someClass { /*...*/ };

template<typename T, int (T::*MemberFunctionPtr)(int, int)>
class anotherClass { /*...*/ };
```

# xml - 为传统上不是空的元素编写自闭标签是不好的做法吗？

> ID：348736
> 
> 赞同：49
> 
> 时间：2008-12-08T05:33:34.010
> 
> 标签：xml, html, xhtml

我注意到 jQuery（或者是 Firefox）将我的一些`<span class="presentational"></span> into <span class="presentational" />`

现在我的问题是，这样写我的标记可以吗？任何浏览器都会窒息它吗？

就个人而言，我认为`<span class="presentational" />`如果它是空的，它看起来更干净。

* * *

## 回答 #1

> 赞同：112
> 
> 时间：2008-12-08T06:50:41.513

当您在 Firefox 中查看源代码时，我假设您的问题与自动关闭元素上的红色斜杠有关。如果是这样，那么您已经陷入了浏览器制造商与 Web 开发人员之战中最激烈但同时也是最被动、激进的辩论之一。XHTML 不仅仅是文档的标记。它还涉及如何通过网络提供文档。

在我开始之前；我正在努力不在这里偏袒任何一方。

XHTML 1.1 规范说，Web 服务器应该使用 Content-Type 为 application/xhtml+xml 的 XHTML 服务。Firefox 将那些尾随斜杠列为无效，因为您的文档是作为 text/html 而不是 application/xhtml+xml 提供的。举这两个例子；相同的标记，一个用作 application/xhtml+xml，另一个用作 text/html。

[http://alanstorm.com/testbed/xhtml-as-html.php](http://alanstorm.com/testbed/xhtml-as-html.php)

[http://alanstorm.com/testbed/xhtml-as-xhtml.php](http://alanstorm.com/testbed/xhtml-as-xhtml.php)

Firefox 将元标记中的尾部斜杠标记为对使用 text/html 提供的文档无效，并且对使用 application/xhtml+xml 提供的文档有效。

## 为什么这是有争议的

对于浏览器开发人员，XHTML 的意义在于您可以将您的文档视为 XML，这意味着如果有人向您发送无效的内容，规范说您不必解析它。因此，如果一个文档作为 application/xhtml+xml 并且具有格式不正确的内容，则允许开发人员说“不是我的问题”。你可以在这里看到它的作用

[http://alanstorm.com/testbed/xhtml-not-valid.php](http://alanstorm.com/testbed/xhtml-not-valid.php)

当文档以 text/html 形式提供时，Firefox 将其视为普通的旧 HTML 文档并使用原谅、修复它、解析例程

[http://alanstorm.com/testbed/xhtml-not-valid-as-html.php](http://alanstorm.com/testbed/xhtml-not-valid-as-html.php)

因此，对于浏览器制造商来说，将 XHTML 用作 text/html 是可笑的，因为浏览器的渲染引擎从未将其视为 XML。

很多年前，希望不仅仅是标记猴子的 Web 开发人员（免责声明：我包括我自己也是其中之一）开始寻找方法来开发不涉及三次嵌套表的最佳实践，但仍然可以提供引人入胜的设计体验. 他们/我们锁定了 XHTML/CSS，因为 W3C 说这是未来，唯一的选择是一个单一供应商（微软）控制事实上的标记规范的世界。真正的邪恶是*单一供应商*，而不是微软。我发誓。

那么争议在哪里呢？application/xhtml+xml有两个问题。第一个是 Internet Explorer。IE 中有一个遗留错误/功能，其中作为 application/xhtml+xml 的内容将提示用户下载文档。如果您尝试使用 IE 访问上面列出的 xhtml-as-xhtml.php，则很可能发生了什么。这意味着如果你想使用 application/xhtml+xml，你必须在~~浏览器中嗅探 IE~~，检查 Accepts 标头，并且只为那些接受它的浏览器提供 application/xhtml+xml。这[并不像听起来那么简单](https://stackoverflow.com/questions/351380/xhtml-what-are-the-problems-associated-with-serving-pages-with-content-applicat#351908)，而且也违背了 Web 开发人员所追求的“一次编写”原则。

第二个问题是 XML 的严苛性。这又是那些容易引起火灾的问题之一，但有些人认为单个错误标签或单个字符编码不正确不应导致用户看不到他们想要的文档。换句话说，是的，规范说如果 XML 格式不正确，您应该停止处理 XML，但用户并不关心规范，他们关心他们的猫的网站是否损坏。

XHTML 1.0（不是 1.1）规范更让这个问题更加突出，假设 XHTML 文档*可以*作为 text/html 提供，前提是遵循了某些[兼容性准则。](http://www.w3.org/TR/xhtml1/#guidelines)诸如img标签之类的东西会自动关闭等等。这里的关键词是*may*。在[RFC](http://www.rfc-editor.org/rfc/rfc2119.txt)中，可能意味着可选。Firefox 选择不将使用 XHTML doctype 而是将 text/html 内容类型提供的文档视为 XHTML。但是，W3C 验证器会很乐意将这些文档报告为有效。

我会让读者去思考一种文化的同时发生的奇迹/恐怖，这种文化写了一份文件来定义他们所说的*may*这个词的含义。

## 向前进

最后，这就是整个[HTML 5](http://blog.whatwg.org/category/weekly-review)的内容。XHTML 变成了一个政治烫手山芋，以至于一群想要推动语言向前发展的人决定转向另一个方向。他们制定了 HTML 5 规范。目前正在 W3C 中讨论，预计将在未来十年的某个时间完成。与此同时，浏览器供应商正在从正在进行的规范中挑选功能并实施它们。

## 来自评论的更新

在评论中，[Alex](https://stackoverflow.com/users/31671/alex)指出，如果您要嗅探某些东西，您应该检查 Accept 标头以查看 application/xhtml+xml 是否被用户代理接受。

这是绝对正确的。一般来说，如果你要嗅探，嗅探功能，而不是浏览器。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-10-15T16:02:40.687

其他答案的补充：在 IE 中，`<span />`在标记中包含元素**会导致 JavaScript 中的 DOM 遍历方法出现各种问题**。查看以下 XHTML 文档：

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>Test</title>
    <script type="text/javascript">
        function show() {
            var span = document.getElementById("span");
            alert(span.innerHTML);
        }
    </script>
</head>
<body onload="show();">
<p id="p1">Paragraph containing some text followed by
           an empty span<span id="span"/></p>
<p id="p2">Second paragraph just containing text</p>
</body>
</html> 
```

这个想法是，当页面加载时，JavaScript 将获得对空范围的引用并显示其 HTML 内容。那将是一个空字符串，对吧？不在IE中它不会。在 IE 中，您将获得整个文档中 span 之后的所有内容：

```
</P>
<P id=p2>Second paragraph just containing text</P> 
```

此外，第二个`<p>`出现在跨度的`childNodes`集合中。`<p>`在 body 的`childNodes`集合中也是如此，这意味着一个**节点可以有效地拥有多个 parent**。对于依赖遍历 DOM 的脚本来说，这可不是什么好消息。

我也[写过关于这个的博客](http://tmik.co.uk/?p=184)。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-12-08T06:03:05.043

是的。这是。在某些情况下，旧浏览器会出现问题。

```
<script type='text/javascript' src='script.js' /> 
```

在这种情况下，旧浏览器可能无法理解该`<script>`标签已结束。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-09T09:44:49.960

作为application/xhtml+xml，<span />表示创建一个没有内容的span元素。

用作 text/html，<span /> 表示创建一个 span 元素，其中元素的内容跟随此标记，直到遇到 </span> 标记，或者遇到隐式关闭该元素的另一个标记（或 EOF）。即在这种情况下，<span /> 的含义与<span> 相同。

另外：HTML 5 定义了 HTML 和 XHTML 序列化，因此它不会以某种方式影响这个问题。与 XHTML 1.0 不同，它确实需要像 XHTML 1.1 一样将 XHTML 作为 application/xhtml+xml 提供服务。但实际上，这并没有改变，因为所有浏览器都将任何版本的 XHTML 视为 text/html 作为标签汤。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-10-15T16:13:42.027

请参阅 XHMTL 工作组关于该主题的说明：http: [//www.w3.org/TR/xhtml-media-types/](http://www.w3.org/TR/xhtml-media-types/)

简而言之——如果您的 XHTML 将被视为 XHTML，那很好。如果您要假装它是 HTML（如果您希望它由 Internet Explorer 加载（包括版本 8，在撰写本文时最新），那么您必须跳过箍）。

箍很烦人，我建议大多数人坚持使用 HTML 4.01。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-02-03T16:47:59.663

另外值得注意的是，`<?xml ...?>`在 doctype 之前的声明会将 IE 置于 quirks 模式。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-08-03T12:48:35.027

应该明确指出，HTML 中没有自闭合标签，因此每当浏览器决定将您的 XHTML 视为 HTML 时，它都不会识别出该标签是闭合的。对于不必在 HTML 中关闭的`<img>`标签（如`<span>`.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-08T06:08:42.800

一般来说，对空元素使用简写是没有问题的，但也有一些例外情况会导致问题。

`<script>`是一个重要的，需要关闭`</script>`以避免问题。

另一个是用蜘蛛写成而不是`<meta>`更好地工作`<meta></meta>``<meta />`

不完全是问题，而是相关的，就格式而言，IE 版本仅存在空元素的问题，例如`<div></div>`or `<div />`。在这种情况下，`<div>&nbsp;</div>`需要保持格式。

# asp.net - 如何在 asp.net 中使用虚拟化改进 Web 开发？

> ID：348742
> 
> 赞同：1
> 
> 时间：2008-12-08T05:41:44.040
> 
> 标签：asp.net, virtualization

使用虚拟化改进 Web 开发

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-08T05:51:59.637

[http://aspnet.4guysfromrolla.com/articles/102908-1.aspx](http://aspnet.4guysfromrolla.com/articles/102908-1.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T05:56:35.337

本质上，虚拟化是在您的主 PC 中创建多个微型（虚拟）PC。这样做的一大好处是，它允许您在没有其他事物干扰的环境中隔离和测试一个应用程序或一组应用程序。过去，为了获得一台带有新开发环境的新机器，您必须拥有另一块硬件，或者您必须将系统重建到新环境。使用虚拟化，您只需将所需的新环境安装到其中一台虚拟机中，然后根据需要运行它。完成后，您可以将其关闭。

虚拟化是隔离的终极——它可以让你在一个硬件上做一些没有它根本不可能的事情。例如，您可以在成员服务器上的测试环境中安装软件，因为它不会在域控制器上运行。您只需同时启动两台虚拟机——一台是域控制器，另一台是成员服务器。两个虚拟机可以同时在相同的物理硬件上运行，而不会意识到它们正在共享一台机器。结果是实现测试环境的快速方法。

虚拟化技术允许将虚拟系统冻结在适当的位置。换句话说，您所在的机器中的确切位置可以无限期地冻结。如果你在一个项目上工作直到它发布并稳定，并且需要在一年后回来重新开始工作，你可以在停止项目工作时冻结系统，然后在一年或更长时间后重新启动它. 当系统重新启动时，就像时间没有过去一样。系统将完全恢复原样。

这一特殊功能非常适合支持多个系统的开发人员，包括顾问，他们拥有不同客户的不同项目，随着时间的推移他们将不得不支持这些项目。您不必担心重新创建环境来测试错误修复；您只需解冻虚拟机即可。

虚拟化程序具有一种称为撤消磁盘的功能。撤消磁盘允许您在系统上进行操作，如果您决定不想保存您的工作，您根本不接受撤消磁盘中的更改。噗。就像魔法一样，你所做的一切都被撤销了，就像它从未发生过一样。

# c# - 如何向 Active Directory 用户发送 SMS

> ID：348743
> 
> 赞同：1
> 
> 时间：2008-12-08T05:42:37.720
> 
> 标签：c#, active-directory, sms

如何向 Active Directory 用户发送 SMS。我想为我的电信运营商客户端设计一个小型应用程序（C# 中），该应用程序将使用他们的 SMS 网关向他们的（AD）用户发送各种基于 SMS 的通知。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-08T06:29:39.387

我假设您的意思是手机号码存储在 AD 中，您希望通过查询提取此号码并使用 SMS 网关提供的 API 发送消息？
您可能想查看[此代码示例](http://www.codeproject.com/KB/system/QueryADwithDotNet.aspx)。您可以通过`System.DirectoryServices.`在 AD 架构中查找手机号码属性来查询 AD，使用[AD Explorer](http://technet.microsoft.com/en-us/sysinternals/bb963907.aspx)可能会更容易一些 希望这会有所帮助。

# asp.net - 如何在 asp.net 中使用过滤器修改 HTTP 响应？

> ID：348756
> 
> 赞同：1
> 
> 时间：2008-12-08T05:57:03.370
> 
> 标签：asp.net, http, filter

使用过滤器修改 HTTP 响应

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T07:03:02.940

我认为这个问题与 ASP.NET 有关，而不是 Java。这可能会有所帮助：

[http://professionalaspnet.com/archive/2008/04/13/What-is-the-Difference-between-an-httpModule-and-an-httpHandler_3F00_.aspx](http://professionalaspnet.com/archive/2008/04/13/What-is-the-Difference-between-an-httpModule-and-an-httpHandler_3F00_.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T13:24:21.907

这类组件在 Java 世界中称为过滤器。它们能够在将请求/响应分派到处理程序组件之前修改请求/响应。在将响应传递给客户端之前。

在 ASP.NET 中，这类组件称为[HTTP 模块](http://www.15seconds.com/Issue/020417.htm)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T06:02:30.503

采用：

> ## 回复
> 
> **目的**
> 
> 响应对象是 Servlet API `HttpServletResponse`类的实例
> 
> **例子**
> 
> ```
> class BookController {
>   def downloadFile = {
>       byte[] bytes = // read bytes
>       response.outputStream << bytes
>   }
> } 
> ```
> 
> **描述**
> 
> Servlet API 的`HttpServletResponse`类可以在 Grails 中用于执行所有典型的活动，例如写出二进制数据、直接写入响应和发送错误响应代码等等。

[从这里](http://www.grails.org/doc/1.3.x/ref/Servlet%20API/response.html)引用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-03T17:49:27.097

从历史上看，响应过滤器一直是在 ASP.NET 中执行此操作的方法。但是，它们在 IIS6（更难以注意到）和 IIS7 中都存在一些严重的缓存相关问题。 [此问题](https://stackoverflow.com/questions/348756/)包括更详细的知识库文章。

# gcc - Windows中嵌入式平台的交叉编译器

> ID：348757
> 
> 赞同：3
> 
> 时间：2008-12-08T05:57:15.973
> 
> 标签：gcc, compiler-construction, embedded

我希望为 Linux 构建一个编译器（GCC 端口），以便构建的 GCC 在 Windows 上运行并为嵌入式平台创建可执行文件。

以上可能吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-08T07:17:10.710

是的，有可能。

自己尝试这样做也非常痛苦——在 Linux 上大部分情况下都可以，但在 Windows 上非常棘手。我的建议是看看是否有来自 DENX.de、CodeSourcery 或嵌入式平台制造商等地方的现成编译器可用。

[我已经成为 MIPS 和 Power Architecture 等平台的CodeSourcery](http://www.codesourcery.com)编译器的忠实粉丝。它们往往带有 big-endian 和 little-endian 的变体，各种 Libc 风格，并提供裸机和 linux-target 版本。查看[他们关于精简版的页面](http://www.codesourcery.com/gnu_toolchains/sgpp/editions.html#lite)

构建自己的交叉编译器和工具集是一种痛苦。

如果您的目标是运行 Linux，我建议您也可以在 Linux 机器上进行交叉工作，从而为您省去很多痛苦。我将 VmWare 用于该明确目的。例如，您不能期望为 Windows 上的目标构建 Linux。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T07:05:38.473

在嵌入式系统中，编译器是基于处理器架构而不是操作系统来引用的。您可能想要的是为 Windows 机器上运行的处理器以外的处理器构建“交叉编译器”。这当然是可能的。参见例如[WinAVR](http://winavr.sourceforge.net/)和 WinARM 项目。这些是基于 GCC 并在 Windows 机器上运行的 AVR 和 ARM 处理器架构的编译器。另一个例子是[yagarto](http://www.yagarto.de/)。这些不仅仅是一个编译器，而是一个完整的工具链，允许您构建 Linux 可执行文件（用于 ARM 处理器），如果需要的库可用的话。

因为 GCC 依赖于 Windows 本身不可用的 POSIX 功能，所以您需要一个类似 Linux 的 Windows 环境（例如 Cygwin 或 MinGW）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-06T18:41:06.033

[http://cegcc.sourceforge.net](http://cegcc.sourceforge.net)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-04-26T06:28:06.360

如果您对在 Windows 上运行它感到满意，那么您可以在[www.gnupit.org](http://www.gnupit.org/gnu-binaries/gcc-binaries.html)免费下载现成的 GCC 交叉工具链。有很多目标平台。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-08T06:43:56.550

您必须在 Windows 上使用 MinGW 或 Cygwin 为您的目标平台（例如 ARM little endian）构建 GCC。

# datetime - 在 windows 和 linux 上获取时区作为 UTC 偏移量

> ID：348760
> 
> 赞同：2
> 
> 时间：2008-12-08T05:59:00.353
> 
> 标签：datetime

将机器的时区作为正或负 UTC 偏移量的最简单方法是什么，最好使用 shell 命令的某个时间？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-08T07:00:52.710

对于所有 Unix-ish 操作系统，当使用 GNU date 命令时：

`date +%z`

例如，对于东欧时间（我的时区）：

```
[moocha@helium ~]$ 日期 +%z
+0200

```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T07:26:03.393

如果您想要的是非夏季/夏令时偏移，您必须执行以下操作：

```
date -d 'Jan 1' +%z 
```

（或南半球的 7 月）。无论如何，这适用于来自 GNU coreutils 的日期。

令人震惊的是，我看不到任何从日期获取 tm_isdst 标志的方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T06:17:30.973

我认为如果情况变得更糟，我可以向 NTP 服务器发送一个请求并获取它和当前本地时间的差异，但如果系统知道它的偏移量，这似乎有点浪费。

# c++ - c++模板实例化

> ID：348763
> 
> 赞同：0
> 
> 时间：2008-12-08T06:00:06.560
> 
> 标签：c++, templates

我有一个像下面这样的模板类。

```
template<int S> class A
{
private:
  char string[S];

public:
  A()
  {
    for(int i =0; i<S; i++)
    {
      .
      .
    }
  }

  int MaxLength()
  {
    return S;
  }
}; 
```

如果我用不同的 S 值实例化上述类，编译器会创建不同的 A() 和 MaxLenth() 函数实例吗？还是会创建一个实例并将 S 作为某种参数传递？

如果我将 A 和 Maxlength 的定义移动到不同的 cpp 文件，它将如何表现。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-08T06:08:32.097

将为每个不同的 S 值实例化模板。

如果将方法实现移动到不同的文件，则需要#include 该文件。（例如，Boost 使用`.ipp`这种需要#included 的源文件的约定）。

如果您想最小化模板实例化生成的代码量（因此需要在`.ipp`文件中提供），您应该尝试通过删除对 S 的依赖来将其分解出来。例如，您可以从（私有）基类，它提供以 S 作为参数的成员函数。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-08T08:42:26.547

实际上这完全取决于编译器。只需要为其输入生成*正确的代码。*为了做到这一点，它必须遵循 C++ 标准，因为它解释了什么*是*正确的。在这种情况下，它表示编译器必须在该过程的一个步骤中将具有不同参数的模板实例化为不同的类型，这些类型稍后可能由相同的代码表示，或者不是，这完全取决于编译器。

编译器最有可能至少内联 MaxLength() 但也可能内联您的 ctor。否则，它很可能会生成您的 ctor 的单个实例并传递/让它从其他地方检索 S 。唯一确定的方法是检查编译器的输出。

因此，为了确定我决定列出 VS2005 在发布版本中的作用。我编译的文件如下所示：

```
template <int S>
class A
{
  char s_[S];
public:
  A()
  {
    for(int i = 0; i < S; ++i)
    {
      s_[i] = 'A';
    }
  }
  int MaxLength() const
  {
    return S;
  }
};

extern void useA(A<5> &a, int n); // to fool the optimizer
extern void useA(A<25> &a, int n);

void test()
{
  A<5> a5;
  useA(a5, a5.MaxLength());
  A<25> a25;
  useA(a25, a25.MaxLength());
} 
```

汇编器输出如下：

```
?test@@YAXXZ PROC                   ; test, COMDAT

[snip]

; 25   :    A<5> a5;

mov eax, 1094795585             ; 41414141H
mov DWORD PTR _a5$[esp+40], eax
mov BYTE PTR _a5$[esp+44], al

; 26   :    useA(a5, a5.MaxLength());

lea eax, DWORD PTR _a5$[esp+40]
push    5
push    eax
call    ?useA@@YAXAAV?$A@$04@@H@Z       ; useA 
```

如您所见，ctor 和对 MaxLength() 的调用都是内联的。正如您现在可能猜到的那样，它对 A<25> 类型也是如此：

```
; 28   :    A<25> a25;

mov eax, 1094795585             ; 41414141H

; 29   :    useA(a25, a25.MaxLength());

lea ecx, DWORD PTR _a25$[esp+48]
push    25                  ; 00000019H
push    ecx
mov DWORD PTR _a25$[esp+56], eax
mov DWORD PTR _a25$[esp+60], eax
mov DWORD PTR _a25$[esp+64], eax
mov DWORD PTR _a25$[esp+68], eax
mov DWORD PTR _a25$[esp+72], eax
mov DWORD PTR _a25$[esp+76], eax
mov BYTE PTR _a25$[esp+80], al
call    ?useA@@YAXAAV?$A@$0BJ@@@H@Z     ; useA 
```

看到编译器优化 for 循环的巧妙方法非常有趣。对于所有那些使用 memset() 的过早优化器，我会说你傻。

> 如果我将 A 和 Maxlength 的定义移动到不同的 cpp 文件，它将如何表现。

它可能无法编译（除非您只在该 cpp 文件中使用 A）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-08T14:36:40.917

> 如果我用不同的 S 值实例化上述类，编译器会创建不同的 A() 和 MaxLenth() 函数实例吗？还是会创建一个实例并将 S 作为某种参数传递？

编译器将为参数的每个不同值实例化类模板的不同副本。关于成员函数，它将为每个不同的值实例化每个的不同副本`S`。但与非模板类的成员函数不同，它们只有在实际使用时才会生成。

> 如果我将 A 和 Maxlength 的定义移动到不同的 cpp 文件，它将如何表现。

你的意思是如果你把定义`A`放在头文件中，但`MaxLength`在cpp文件中定义成员函数？好吧，如果你的类模板的用户想要调用`MaxLength`，编译器想要查看它的代码，因为它想要用 的实际值实例化它的副本`S`。如果它没有可用的代码，则假定以其他方式提供了代码，并且不生成任何代码：

*A.hpp*

```
template<int S> class A {
public:
    A() { /* .... */ }
    int MaxLength(); /* not defined here in the header file */
}; 
```

*A.cpp*

```
template<int S> int
A<S>::MaxLength() { /* ... */ } 
```

如果您现在只为使用类模板 A 的代码包含 include *A.hpp*，那么编译器将看不到代码，`MaxLength`也不会生成任何实例化。你有两个选择：

*   也包括文件*A.cpp*，以便编译器看到它的代码，或者
*   `S`为您知道您将使用的值提供显式实例化。对于这些值，您无需提供代码`MaxLength`

对于第二个选项，这是通过在*A.cpp*中放置如下行来完成的：

```
template class A<25>; 
```

编译器将能够在不查看`A<25>`现在成员函数的代码的情况下继续存在，因为您显式地实例化了`S=25`. 如果您不执行上述两个选项中的任何一个，链接器将拒绝创建最终的可执行文件，因为仍然缺少所需的代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-08T06:03:26.523

无论在何处使用 S，该函数的一个单独版本都会针对您实例化的每个不同 S 编译到您的代码中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-08T09:23:35.340

`A<S>::MaxLength()`是如此微不足道，它将被完全内联。因此，将有 0 个副本。`A<S>::A()`看起来更复杂，因此可能会导致生成多个副本。只要代码按预期工作，编译器当然可以决定不这样做。

您可能想看看是否可以将循环移动到 A_base::A_base(int S)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-08T06:04:16.553

它将创建两个不同的版本，`A()`并将`MaxLength()`返回编译时常量。简单的`return S;`将被有效地编译，甚至在可能的情况下内联。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-08T06:04:44.087

如果您为不同的类型或参数实例化它，编译器将创建该类的不同实例。

# asp.net - Asp.net - 什么是最好的最新工具/框架等。.

> ID：348764
> 
> 赞同：0
> 
> 时间：2008-12-08T06:00:36.717
> 
> 标签：asp.net

好的，当它出现时，我已经做了一堆 asp 和 asp.net。一个朋友正在创办一个非营利组织，他希望我为他建立一个网站。我想我会用一块石头杀死 2 只鸟，并希望通过网络在 asp.net、web 2.0 等中提供的最新技术来更新我的技能。

网站要求非常简单：

1.  组织使命宣言
2.  用户注册能力
3.  照片、内容
4.  博客文章
5.  能够直接在网站上捐赠（可能通过贝宝）

所以我的问题是什么是从这里开始的最佳工具，因为它将托管在 Windows ASP.net 平台 3.5 上。我应该关注的任何其他框架。

最好的起点在哪里？

我可以轻松地构建网站，只需将一张表格和一堆静态页面放在一起，但我认为如果利用和帮助更新我的技能是有意义的，那么学习曲线的努力是值得的。

随意建议我没有列出的任何其他项目。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T06:08:11.397

看看 ASP.Net MVC 和 JQUERY 也看看 S#Arp 作为构建站点的好平台。它使用 nHibernate 设置 ASP.Net MVC，并且对良好的 DDD 结构有很好的指导。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T06:18:30.173

如果您忽略了它，[AJAX 控制工具包](http://www.codeplex.com/AjaxControlToolkit)-

> 解决三个需求。首先，它为网站开发人员提供了一个获取组件以使他们的 Web 应用程序栩栩如生的地方，其次，它为那些希望编写客户端代码的人提供了一组很好的示例，第三，它是最好的脚本开发人员获得的地方他们的工作突出。

对于开源功能的 CMS 系统，请查看 N2。[N2](http://n2cms.com/)是一个轻量级的 CMS 框架，可帮助您构建任何人都可以更新的出色网站。用户界面直观且功能强大。开发者的故事非常精彩。

# java - 读取COM端口值并在位于java面板内的textArea中打印

> ID：348777
> 
> 赞同：1
> 
> 时间：2008-12-08T06:07:29.760
> 
> 标签：java, core

我必须读取一个 COM 端口，并且数据应该动态显示在 TextArea 内（数据每分钟都会出现），这是我在 JPanel 中创建的。

提前感谢您的回复。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T06:58:36.270

一些线索：

*   [java2s 有一些例子](http://www.java2s.com/Code/Java/Development-Class/COM-Port.htm)。
*   这个[**CommPortOpen 类**](http://www.java2s.com/Code/Java/Development-Class/OpenaserialportusingJavaCommunications.htm)可以给你一个好的开始。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T08:44:19.523

要从串口读取，请查看这里的 javacomm API：http: [//java.sun.com/products/javacomm/](http://java.sun.com/products/javacomm/)

用户指南有更多信息和一些示例代码：http: [//java.sun.com/products/javacomm/reference/docs/API_users_guide_3.html](http://java.sun.com/products/javacomm/reference/docs/API_users_guide_3.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T15:02:29.820

对于多平台应用程序，请查看[rxtx](http://www.rxtx.org/)。

`javax.comm`多年来一直没有积极的发展。rxtx项目具有兼容的 api 以及功能更丰富的[包](http://www.rxtx.org/)`gnu`API。

源代码和 Wiki 中有示例。

# winforms - 在 Winforms for Vista 中为 MessageBox.Show(...) 格式化消息的最佳实践

> ID：348784
> 
> 赞同：3
> 
> 时间：2008-12-08T06:12:19.033
> 
> 标签：winforms, windows-vista, messagebox

在 XP/2003 中，我已经习惯于这样编写`MessageBox.Show(..)`代码：

```
MessageBox.Show("Title", "Sorry an error has occured!\n" +
                         "You may want to try one of the following:\n\n" +
                         "1\. Reboot your machine\n" +  
                         "2\. Buy a new machine\n" +  
                         "3\. Report your error on StackOverflow.com.\n"); 
```

即我很好地格式化了消息并且可读。如果我不这样做，它会填满屏幕的整个宽度并且不是很友好。

现在，当在 Vista 中出现相同的消息框时，它的格式完全不同，并且引入了自己的换行符，并且通常看起来更糟。

对于 Vista 和 XP 的应用程序来说，最好的做法是什么 - 没有编写我自己的消息框类。

其他人正在做什么来克服这个问题

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-08T07:10:20.897

[只是一个评论，但在Vista中， TaskDialog](http://shellrevealed.com/blogs/shellblog/archive/2006/09/19/So-long-MessageBox-and-thanks-for-all-the-memories.aspx)不是更适合这种对话框吗？

[替代文字 http://shellrevealed.com/photos/blog_images/images/659/411x278.aspx](http://shellrevealed.com/photos/blog_images/images/659/411x278.aspx)

否则，该[线程](http://www.vbforums.com/showthread.php?referrerid=61394&t=541505)确实提到了一种在消息框中插入换行符的方法。

```
MessageBox.Show( "This" & Environment.NewLine & "is" & Environment.NewLine & "a test",
                 "Lines", MessageBoxButtons.YesNoCancel) 
```

请参阅[Environment.Newline 属性](http://msdn.microsoft.com/en-us/library/system.environment.newline.aspx)

# asp.net-mvc - ASP.NET MVC 中的水晶报表

> ID：348785
> 
> 赞同：35
> 
> 时间：2008-12-08T06:14:16.203
> 
> 标签：asp.net-mvc, crystal-reports

我知道在 ASP.NET MVC 中不允许使用服务器端控件，但是我们有一长串水晶报告，该公司已经为以前的应用程序制作了这些报告，我想将这些报告用于我们的新 ASP。 NET MVC 应用程序。

有没有合适的方法在 ASP.NET MVC 中使用水晶报表？如果是这样，怎么做？

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2010-04-30T20:45:42.777

其实很简单。只需将以下引用添加到您的 MVC 项目：

*   CrystalDecisions.CrystalReports.Engine
*   CrystalDecisions.ReportSource
*   CrystalDecisions.Shared

使用如下的 Action 方法：

*   C＃ ：

    ```
    using CrystalDecisions.CrystalReports.Engine;

    public ActionResult Report()
        {
            ReportClass rptH = new ReportClass();
            rptH.FileName = Server.MapPath("[reportName].rpt");
            rptH.Load();
            rptH.SetDataSource([datatable]);
            Stream stream = rptH.ExportToStream(CrystalDecisions.Shared.ExportFormatType.PortableDocFormat);
            return File(stream, "application/pdf");   
        } 
    ```

*   VB.NET：

    ```
     Imports CrystalDecisions.CrystalReports.Engine

     Public Function Report() As ActionResult
        Dim rptH As New ReportClass()
        rptH.FileName = Server.MapPath("[reportName].rpt")
        rptH.Load()
        rptH.SetDataSource([datatable])
        Dim stream As IO.Stream = rptH.ExportToStream(CrystalDecisions.Shared.ExportFormatType.PortableDocFormat)
        Return File(stream, "application/pdf")
     End Function 
    ```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-08T06:28:05.413

我们在工作中有/有过类似的情况。

我们使用的解决方案：

*   为报告创建一个单独的目录
*   为报告创建普通的 ASPX 页面

我们没有看到这个设置有任何问题（除了普通的水晶问题）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2017-05-23T21:05:35.530

**只需添加此参考：使用 CrystalDecisions.CrystalReports.Engine；
比做这个动作：**

```
using CrystalDecisions.CrystalReports.Engine;  
    public ActionResult Report()
            {
                List<Table> table = new List<Table>();
                ReportDocument rd = new ReportDocument();
                rd.Load(Path.Combine(Server.MapPath("~/Repport/CrystalReport1.rpt")));

                Response.Buffer = false;
                Response.ClearContent();
                Response.ClearHeaders();
                Stream stream = rd.ExportToStream(CrystalDecisions.Shared.ExportFormatType.PortableDocFormat);
                stream.Seek(0, SeekOrigin.Begin);

                return File(stream, "application/pdf", "Suivie Historique.pdf");

            } 
```

# compiler-construction - 语法实现中文件描述符的结尾

> ID：348788
> 
> 赞同：0
> 
> 时间：2008-12-08T06:17:28.150
> 
> 标签：compiler-construction, grammar, parsing

我正在研究编译器实现并希望检查是否已到达文件末尾？

我知道这可以使用 lex 文件中的 yywrap() 函数来完成，但要求是如果 EOF 被显式定义为十六进制值 0x1a，那么我们如何引用它。

例子：

main() { printf("检查 EOF 标记\n"); '0x1a' <-- 实际的 EOF 标记。

我希望上面不是语法错误，而是报错括号不平衡，或者定义错误。

以上可以吗？我的要求只是在解析器中包含 EOF 令牌，不幸的是，到目前为止我还不能这样做:-((，其余的工作将很容易完成，我只需要给出一个规则如：

```
print    :    print_stmt '(' stmt_valid ')' colon '\n' 
{
    OK do the rest
}
         |    print_stmt '(' stmt_valid ')' colon end_indicator
{
    print error message and close application.
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-08T11:01:52.177

让您的词法分析器返回 EOF 的标记。

我建议您在两种情况下退回令牌：

1.  `getc()`返回`-1`（通常的 EOF 符号）。在这种情况下，将标记文本设为空

2.  `getc()`返回`'\x1a'`。在这种情况下，将此字符放入标记文本中。

这使您的语法可以区分这两种情况。

# javascript - 你如何判断大写锁定是否在使用 JavaScript？

> ID：348792
> 
> 赞同：257
> 
> 时间：2008-12-08T06:22:31.070
> 
> 标签：javascript, keyboard, capslock

你如何判断大写锁定是否在使用 JavaScript？

不过有一个警告：我用谷歌搜索了它，我能找到的最好的解决方案是`onkeypress`在每个输入上附加一个事件，然后每次检查按下的字母是否为大写，如果是，则检查是否也按下了 shift。如果不是，则必须打开大写锁定。这感觉真的很脏而且只是......*浪费*- 肯定有比这更好的方法吗？

* * *

## 回答 #1

> 赞同：128
> 
> 时间：2009-05-22T05:48:46.470

在 jQuery 中，

```
$('#example').keypress(function(e) { 
    var s = String.fromCharCode( e.which );
    if ( s.toUpperCase() === s && s.toLowerCase() !== s && !e.shiftKey ) {
        alert('caps is on');
    }
}); 
```

避免错误，如退格键， `s.toLowerCase() !== s`是必需的。

* * *

## 回答 #2

> 赞同：124
> 
> 时间：2015-12-14T21:59:47.467

您可以使用 a`KeyboardEvent`来检测许多键，包括最新浏览器上的大写锁定。

该[`getModifierState`函数](https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/getModifierState)将提供以下状态：

*   Alt
*   替代图
*   大写锁定
*   控制
*   Fn (安卓)
*   元
*   数字键盘（的第一个键
*   操作系统（Windows 和 Linux）
*   滚动锁定
*   转移

[此演示](http://jsfiddle.net/Mottie/a6nhqvv0/)适用于所有主要浏览器，包括移动设备 ( [caniuse](http://caniuse.com/#search=getModifierState) )。

```
passwordField.addEventListener( 'keydown', function( event ) {
  var caps = event.getModifierState && event.getModifierState( 'CapsLock' );
  console.log( caps ); // true when you press the keyboard CapsLock key
}); 
```

* * *

## 回答 #3

> 赞同：96
> 
> 时间：2008-12-08T06:30:25.347

你可以试一试。添加了一个工作示例。当焦点放在输入上时，打开大写锁定会使 LED 变为红色，否则变为绿色。（尚未在 mac/linux 上测试过）

注意：两个版本都适用于我。感谢评论中的建设性意见。

旧版本：[https ://jsbin.com/mahenes/edit?js,output](https://jsbin.com/mahenes/edit?js,output)

另外，这是一个修改版本（有人可以在mac上测试并确认）

新版本： [https ://jsbin.com/xiconuv/edit?js，输出](https://jsbin.com/xiconuv/edit?js,output)

**新版本：**

```
function isCapslock(e) {
  const IS_MAC = /Mac/.test(navigator.platform);

  const charCode = e.charCode;
  const shiftKey = e.shiftKey;

  if (charCode >= 97 && charCode <= 122) {
    capsLock = shiftKey;
  } else if (charCode >= 65 && charCode <= 90
    && !(shiftKey && IS_MAC)) {
    capsLock = !shiftKey;
  }

  return capsLock;
} 
```

**旧版：**

```
function isCapslock(e) {
  e = (e) ? e : window.event;

  var charCode = false;
  if (e.which) {
    charCode = e.which;
  } else if (e.keyCode) {
    charCode = e.keyCode;
  }

  var shifton = false;
  if (e.shiftKey) {
    shifton = e.shiftKey;
  } else if (e.modifiers) {
    shifton = !!(e.modifiers & 4);
  }

  if (charCode >= 97 && charCode <= 122 && shifton) {
    return true;
  }

  if (charCode >= 65 && charCode <= 90 && !shifton) {
    return true;
  }

  return false;
} 
```

对于国际字符，可以根据需要对以下键添加额外的检查。您必须获取您感兴趣的字符的键码范围，可能是通过使用一个键映射数组来保存您正在处理的所有有效用例键...

大写 AZ 或 'Ä'、'Ö'、'Ü'、小写 aZ 或 0-9 或 'ä'、'ö'、'ü'

上面的键只是示例表示。

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2008-12-08T23:29:36.240

您可以使用文档上的按键捕获使用“是字母大写且未按下移位”来检测大写锁定。但是你最好确保没有其他按键处理程序在事件气泡到达文档上的处理程序之前弹出事件气泡。

```
document.onkeypress = function ( e ) {
  e = e || window.event;
  var s = String.fromCharCode( e.keyCode || e.which );
  if ( (s.toUpperCase() === s) !== e.shiftKey ) {
    // alert('caps is on')
  }
} 
```

您可以在支持该事件的浏览器的捕获阶段捕获该事件，但这似乎毫无意义，因为它不适用于所有浏览器。

我想不出任何其他实际检测大写锁定状态的方法。无论如何，检查很简单，如果输入了不可检测的字符，那么......那么检测就没有必要了。

去年有[一篇关于 24 种方式的文章。](http://24ways.org/2007/capturing-caps-lock)相当不错，但缺乏国际角色支持（`toUpperCase()`用来解决这个问题）。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2013-09-19T21:16:39.833

许多现有答案将在未按下 shift 时检查大写锁定，但如果您按下 shift 并变为小写，则不会检查它，或者会检查但不会检查大写锁定是否关闭，或者会检查但会将非字母键视为“关闭”。这是一个经过调整的 jQuery 解决方案，如果按下大写字母键（移位或不移位）将显示警告，如果按下大写字母键时将关闭警告，但不会关闭或打开警告数字或其他键被按下。

```
$("#password").keypress(function(e) { 
    var s = String.fromCharCode( e.which );
    if ((s.toUpperCase() === s && s.toLowerCase() !== s && !e.shiftKey)|| //caps is on
      (s.toUpperCase() !== s && s.toLowerCase() === s && e.shiftKey)) {
        $("#CapsWarn").show();
    } else if ((s.toLowerCase() === s && s.toUpperCase() !== s && !e.shiftKey)||
      (s.toLowerCase() !== s && s.toUpperCase() === s && e.shiftKey)) { //caps is off
        $("#CapsWarn").hide();
    } //else upper and lower are both same (i.e. not alpha key - so do not hide message if already on but do not turn on if alpha keys not hit yet)
  }); 
```

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2010-09-28T18:33:59.140

在 jQuery 中。这涵盖了 Firefox 中的事件处理，并将检查意外的大写和小写字符。这预设了一个`<input id="password" type="password" name="whatever"/>`元素和一个 id 为 ' `capsLockWarning`' 的单独元素，该元素具有我们想要显示的警告（但在其他情况下被隐藏）。

```
$('#password').keypress(function(e) {
    e = e || window.event;

    // An empty field resets the visibility.
    if (this.value === '') {
        $('#capsLockWarning').hide();
        return;
    }

    // We need alphabetic characters to make a match.
    var character = String.fromCharCode(e.keyCode || e.which);
    if (character.toUpperCase() === character.toLowerCase()) {
        return;
    }

    // SHIFT doesn't usually give us a lowercase character. Check for this
    // and for when we get a lowercase character when SHIFT is enabled. 
    if ((e.shiftKey && character.toLowerCase() === character) ||
        (!e.shiftKey && character.toUpperCase() === character)) {
        $('#capsLockWarning').show();
    } else {
        $('#capsLockWarning').hide();
    }
}); 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2014-01-15T23:08:12.973

出于几个原因，这里的最佳答案对我不起作用（带有死链接和不完整解决方案的未注释代码）。所以我花了几个小时尝试每个人，并尽我所能：这是我的，包括 jQuery 和非 jQuery。

## jQuery

请注意，jQuery 对事件对象进行了规范化，因此缺少一些检查。我还将它缩小到所有密码字段（因为这是需要它的最大原因）并添加了一条警告消息。这已经在 Chrome、Mozilla、Opera 和 IE6-8 中进行了测试。稳定并捕获所有大写锁定状态，除非按下数字或空格。

```
/* check for CAPS LOCK on all password fields */
$("input[type='password']").keypress(function(e) {

    var $warn = $(this).next(".capsWarn"); // handle the warning mssg
    var kc = e.which; //get keycode
    var isUp = (kc >= 65 && kc <= 90) ? true : false; // uppercase
    var isLow = (kc >= 97 && kc <= 122) ? true : false; // lowercase
    // event.shiftKey does not seem to be normalized by jQuery(?) for IE8-
    var isShift = ( e.shiftKey ) ? e.shiftKey : ( (kc == 16) ? true : false ); // shift is pressed

    // uppercase w/out shift or lowercase with shift == caps lock
    if ( (isUp && !isShift) || (isLow && isShift) ) {
        $warn.show();
    } else {
        $warn.hide();
    }

}).after("<span class='capsWarn error' style='display:none;'>Is your CAPSLOCK on?</span>"); 
```

## 没有 jQuery

其他一些没有 jQuery 的解决方案缺少 IE 回退。@Zappa 修补了它。

```
document.onkeypress = function ( e ) {
    e = (e) ? e : window.event;

    var kc = ( e.keyCode ) ? e.keyCode : e.which; // get keycode
    var isUp = (kc >= 65 && kc <= 90) ? true : false; // uppercase
    var isLow = (kc >= 97 && kc <= 122) ? true : false; // lowercase
    var isShift = ( e.shiftKey ) ? e.shiftKey : ( (kc == 16) ? true : false ); // shift is pressed -- works for IE8-

    // uppercase w/out shift or lowercase with shift == caps lock
    if ( (isUp && !isShift) || (isLow && isShift) ) {
        alert("CAPSLOCK is on."); // do your thing here
    } else {
        // no CAPSLOCK to speak of
    }

} 
```

* * *

注意：查看@Borgar、@Joe Liversedge 和@Zappa 的解决方案，以及@Pavel Azanov 开发的插件，我没有尝试过，但这是一个好主意。如果有人知道将范围扩展到 A-Za-z 之外的方法，请编辑。此外，这个问题的 jQuery 版本被关闭为重复，所以这就是我在这里发布的原因。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2018-09-20T05:52:09.167

我们`getModifierState`用来检查大写锁定，它只是鼠标或键盘事件的成员，所以我们不能使用`onfocus`. 密码字段获得焦点的最常见两种方式是单击或选项卡。我们用于`onclick`检查输入中的鼠标单击，并`onkeyup`用于检测前一个输入字段中的选项卡。如果密码字段是页面上的唯一字段并且是自动聚焦的，那么在释放第一个键之前事件不会发生，这可以但并不理想，您真的希望在密码字段获得后显示大写锁定工具提示重点，但在大多数情况下，这个解决方案就像一个魅力。

HTML

```
<input type="password" id="password" onclick="checkCapsLock(event)" onkeyup="checkCapsLock(event)" /> 
```

JS

```
function checkCapsLock(e) {
  if (e.getModifierState("CapsLock")) {
    console.log("Caps");
  }
} 
```

[https://codepen.io/anon/pen/KxJwjq](https://codepen.io/anon/pen/KxJwjq)

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2011-11-22T06:02:37.000

我知道这是一个老话题，但我想我会反馈以防它帮助其他人。这个问题的答案似乎都不适用于 IE8。然而，我确实找到了在 IE8 中工作的代码。（还没有测试过任何低于 IE8 的东西）。如果需要，这可以很容易地为 jQuery 修改。

```
function capsCheck(e,obj){ 
    kc = e.keyCode?e.keyCode:e.which;  
    sk = e.shiftKey?e.shiftKey:((kc == 16)?true:false);  
    if(((kc >= 65 && kc <= 90) && !sk)||((kc >= 97 && kc <= 122) && sk)){
        document.getElementById('#'+obj.id).style.visibility = 'visible';
    } 
    else document.getElementById('#'+obj.id).style.visibility = 'hidden';
} 
```

该函数通过 onkeypress 事件调用，如下所示：

```
<input type="password" name="txtPassword" onkeypress="capsCheck(event,this);" />
<div id="capsWarningDiv" style="visibility:hidden">Caps Lock is on.</div> 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2014-02-10T13:52:35.973

这是一种解决方案，除了在写入时检查状态外，每次`Caps Lock`按下键时也会切换警告消息（有一些限制）。

它还支持 AZ 范围之外的非英文字母，因为它检查字符串字符`toUpperCase()`而`toLowerCase()`不是检查字符范围。

```
$(function(){
  //Initialize to hide caps-lock-warning
  $('.caps-lock-warning').hide();

  //Sniff for Caps-Lock state
  $("#password").keypress(function(e) {
    var s = String.fromCharCode( e.which );
    if((s.toUpperCase() === s && s.toLowerCase() !== s && !e.shiftKey)||
       (s.toUpperCase() !== s && s.toLowerCase() === s && e.shiftKey)) {
      this.caps = true; // Enables to do something on Caps-Lock keypress
      $(this).next('.caps-lock-warning').show();
    } else if((s.toLowerCase() === s && s.toUpperCase() !== s && !e.shiftKey)||
              (s.toLowerCase() !== s && s.toUpperCase() === s && e.shiftKey)) {
      this.caps = false; // Enables to do something on Caps-Lock keypress
      $(this).next('.caps-lock-warning').hide();
    }//else else do nothing if not a letter we can use to differentiate
  });

  //Toggle warning message on Caps-Lock toggle (with some limitation)
  $(document).keydown(function(e){
    if(e.which==20){ // Caps-Lock keypress
      var pass = document.getElementById("password");
      if(typeof(pass.caps) === 'boolean'){
        //State has been set to a known value by keypress
        pass.caps = !pass.caps;
        $(pass).next('.caps-lock-warning').toggle(pass.caps);
      }
    }
  });

  //Disable on window lost focus (because we loose track of state)
  $(window).blur(function(e){
    // If window is inactive, we have no control on the caps lock toggling
    // so better to re-set state
    var pass = document.getElementById("password");
    if(typeof(pass.caps) === 'boolean'){
      pass.caps = null;
      $(pass).next('.caps-lock-warning').hide();
    }
  });
});
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<input type="password" id="password" />
<span class="caps-lock-warning" title="Caps lock is on!">CAPS</span>
```

`Caps Lock`请注意，只有在我们知道按键之前大写锁定的状态时，观察大写锁定切换才有用。当前的大写锁定状态`caps`由密码元素上的 JavaScript 属性保存。当用户按下可以是大写或小写的字母时，这是我们第一次验证大写锁定状态时设置的。如果窗口失去焦点，我们将无法再观察到大写锁定切换，因此我们需要重置为未知状态。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2013-01-01T20:00:30.220

最近hashcode.com上有一个[类似的问题](https://ru.stackoverflow.com/questions/179050/javascript-%D0%B2%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD-%D0%BB%D0%B8-caps-lock-%D0%B8%D0%BB%D0%B8-%D0%BD%D0%B5%D1%82-%D0%BD%D0%B0-%D1%81%D0%B0%D0%B9%D1%82%D0%B5)，我创建了一个jQuery插件来处理它。它还支持对数字大写锁定的识别。（在标准的德语键盘布局上，大写锁定对数字有影响）。

你可以在这里查看最新版本：[jquery.capsChecker](https://github.com/azanov/jquery.capsChecker)

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2014-09-08T08:12:23.093

**对于带有 twitter 引导程序的 jQuery**

检查以下字符的大写锁定：

大写AZ或'Ä'、'Ö'、'Ü'、'!'、'"'、'§'、'$'、'%'、'&'、'/'、'('、')' , '=', ':', ';', '*', '''

小写 aZ 或 0-9 或 'ä'、'ö'、'ü'、'.'、','、'+'、'#'

```
/* check for CAPS LOCK on all password fields */
$("input[type='password']").keypress(function(e) {
    var kc = e.which; // get keycode

    var isUpperCase = ((kc >= 65 && kc <= 90) || (kc >= 33 && kc <= 34) || (kc >= 36 && kc <= 39) || (kc >= 40 && kc <= 42) || kc == 47 || (kc >= 58 && kc <= 59) || kc == 61 || kc == 63 || kc == 167 || kc == 196 || kc == 214 || kc == 220) ? true : false; // uppercase A-Z or 'Ä', 'Ö', 'Ü', '!', '"', '§', '$', '%', '&', '/', '(', ')', '=', ':', ';'
    var isLowerCase = ((kc >= 97 && kc <= 122) || (kc >= 48 && kc <= 57) || kc == 35 || (kc >= 43 && kc <= 44) || kc == 46 || kc == 228 || kc == 223 || kc == 246 || kc == 252) ? true : false; // lowercase a-Z or 0-9 or 'ä', 'ö', 'ü', '.', ','

    // event.shiftKey does not seem to be normalized by jQuery(?) for IE8-
    var isShift = (e.shiftKey) ? e.shiftKey : ((kc == 16) ? true : false); // shift is pressed

    // uppercase w/out shift or lowercase with shift == caps lock
    if ((isUpperCase && !isShift) || (isLowerCase && isShift)) {
        $(this).next('.form-control-feedback').show().parent().addClass('has-warning has-feedback').next(".capsWarn").show();
    } else {
        $(this).next('.form-control-feedback').hide().parent().removeClass('has-warning has-feedback').next(".capsWarn").hide();
    }
}).after('<span class="glyphicon glyphicon-warning-sign form-control-feedback" style="display:none;"></span>').parent().after("<span class='capsWarn text-danger' style='display:none;'>Is your CAPSLOCK on?</span>"); 
```

[**jsfiddle 上的现场演示**](http://jsfiddle.net/05kofe9q/)

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2017-07-19T11:47:37.037

显示大写锁定状态的变量：

```
let isCapsLockOn = false;

document.addEventListener( 'keydown', function( event ) {
  var caps = event.getModifierState && event.getModifierState( 'CapsLock' );
  if(isCapsLockOn !== caps) isCapsLockOn = caps;
});

document.addEventListener( 'keyup', function( event ) {
  var caps = event.getModifierState && event.getModifierState( 'CapsLock' );
  if(isCapsLockOn !== caps) isCapsLockOn = caps;
}); 
```

适用于所有浏览器 => [canIUse](http://caniuse.com/#search=getModifierState)

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2018-07-17T15:08:20.350

[@user110902 发布的这个基于 jQuery 的答案](https://stackoverflow.com/a/896515/3692177)对我很有用。但是，我对其进行了一些改进，以防止@B_N 的评论中提到的缺陷：当您按下 Shift 时，它未能检测到 CapsLock：

```
$('#example').keypress(function(e) { 
    var s = String.fromCharCode( e.which );
    if (( s.toUpperCase() === s && s.toLowerCase() !== s && !e.shiftKey )
    ||  ( s.toLowerCase() === s && s.toUpperCase() !== s && e.shiftKey )) {
        alert('caps is on');
    }
}); 
```

像这样，即使在按下 Shift 时它也会起作用。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2014-01-22T17:01:10.500

无论大小写或按下 shift 键，此代码都会检测到大写锁定：

```
$('#password').keypress(function(e) { 
    var s = String.fromCharCode( e.which );
    if ( (s.toUpperCase() === s && !e.shiftKey) || 
             (s.toLowerCase() === s && e.shiftKey) ) {
        alert('caps is on');
    }
}); 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2014-06-04T13:29:44.210

我编写了一个名为[capsLock](https://github.com/aaditmshah/capsLock)的库，它完全按照您的要求执行。

只需将其包含在您的网页中：

```
<script src="https://rawgit.com/aaditmshah/capsLock/master/capsLock.js"></script> 
```

然后按如下方式使用它：

```
alert(capsLock.status);

capsLock.observe(function (status) {
    alert(status);
}); 
```

查看演示：http: [//jsfiddle.net/3EXMd/](http://jsfiddle.net/3EXMd/)

当您按下 Caps Lock 键时，状态会更新。它仅使用 Shift 键破解来确定 Caps Lock 键的正确状态。最初的状态是`false`。所以要小心。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2014-07-16T14:05:19.557

还有另一个版本，清晰而简单，处理转换的 capsLock，并且不限于 ascii 我认为：

```
document.onkeypress = function (e)
{
    e = e || window.event;
    if (e.charCode === 0 || e.ctrlKey || document.onkeypress.punctuation.indexOf(e.charCode) >= 0)
        return;
    var s = String.fromCharCode(e.charCode); // or e.keyCode for compatibility, but then have to handle MORE non-character keys
    var s2 = e.shiftKey ? s.toUpperCase() : s.toLowerCase();
    var capsLockOn = (s2 !== s);
    document.getElementById('capslockWarning').style.display = capsLockOn ? '' : 'none';
}
document.onkeypress.punctuation = [33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,91,92,93,94,95,96,123,124,125,126]; 
```

**编辑：**大写锁定的感觉被颠倒了，doh，修复了。

**编辑＃2：**在检查了更多之后，我做了一些更改，不幸的是更详细的代码，但它可以适当地处理更多操作。

*   使用 e.charCode 而不是 e.keyCode 并检查 0 值会跳过许多非字符按键，而无需编码特定于给定语言或字符集的任何内容。据我了解，它的兼容性稍差，因此较旧的、非主流或移动浏览器的行为可能与此代码预期的不同，但无论如何，对于我的情况来说，这是值得的。

*   检查已知标点代码列表可防止它们被视为漏报，因为它们不受大写锁定的影响。没有这个，当您键入任何这些标点字符时，大写锁定指示器会被隐藏。通过指定排除集而不是包含集，它应该与扩展字符更兼容。这是最丑陋，最特别的一点，并且有可能非西方语言有足够不同的标点符号和/或标点符号代码是一个问题，但再次值得 IMO，至少对我来说是这样。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2017-09-01T21:21:23.620

**反应**

```
onKeyPress(event) { 
        let self = this;
        self.setState({
            capsLock: isCapsLockOn(self, event)
        });
    }

    onKeyUp(event) { 
        let self = this;
        let key = event.key;
        if( key === 'Shift') {
            self.shift = false;
        }
    } 
```

* * *

```
 <div>
     <input name={this.props.name} onKeyDown={(e)=>this.onKeyPress(e)} onKeyUp={(e)=>this.onKeyUp(e)} onChange={this.props.onChange}/>
                {this.capsLockAlert()}
</div> 
```

* * *

```
function isCapsLockOn(component, event) {
        let key = event.key;
        let keyCode = event.keyCode;

        component.lastKeyPressed = key;

        if( key === 'Shift') {
            component.shift = true;
        } 

        if (key === 'CapsLock') {
            let newCapsLockState = !component.state.capsLock;
            component.caps = newCapsLockState;
            return newCapsLockState;
        } else {
            if ((component.lastKeyPressed !== 'Shift' && (key === key.toUpperCase() && (keyCode >= 65 && keyCode <= 90)) && !component.shift) || component.caps ) {
                component.caps = true;
                return true;
            } else {
                component.caps = false;
                return false;
            }
        }
    } 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2015-02-16T14:02:07.320

基于@joshuahedlund 的回答，因为它对我来说效果很好。

我将代码变成了一个函数，以便可以重复使用，并在我的例子中将它链接到正文。仅当您愿意时，它才能链接到密码字段。

```
<html>
<head>
<script language="javascript" type="text/javascript" >
function checkCapsLock(e, divId) { 
    if(e){
        e = e;
    } else {
        e = window.event;
    }
    var s = String.fromCharCode( e.which );
    if ((s.toUpperCase() === s && s.toLowerCase() !== s && !e.shiftKey)|| //caps is on
      (s.toUpperCase() !== s && s.toLowerCase() === s && e.shiftKey)) {
        $(divId).style.display='block';
    } else if ((s.toLowerCase() === s && s.toUpperCase() !== s && !e.shiftKey)||
      (s.toLowerCase() !== s && s.toUpperCase() === s && e.shiftKey)) { //caps is off
        $(divId).style.display='none';
   } //else upper and lower are both same (i.e. not alpha key - so do not hide message if already on but do not turn on if alpha keys not hit yet)
 }
</script>
<style>    
.errorDiv {
    display: none;
    font-size: 12px;
    color: red;
    word-wrap: break-word;
    text-overflow: clip;
    max-width: 200px;
    font-weight: normal;
}
</style>
</head>
<body  onkeypress="checkCapsLock(event, 'CapsWarn');" >
...
<input name="password" id="password" type="password" autocomplete="off">
<div id="CapsWarn" class="errorDiv">Capslock is ON !</div>
...
</body>
</html> 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2018-03-21T16:37:29.063

[上面 Mottie](https://stackoverflow.com/users/145346/mottie)和[Diego Vieira 的](https://stackoverflow.com/users/1086469/diego-vieira) [回答](https://stackoverflow.com/questions/348792/how-do-you-tell-if-caps-lock-is-on-using-javascript/34277417#34277417)是我们最终使用的，现在应该是公认的答案。然而，在我注意到它之前，我写了这个不依赖字符代码的小 javascript 函数......

```
var capsLockIsOnKeyDown = {shiftWasDownDuringLastChar: false,
  capsLockIsOnKeyDown: function(event) {
    var eventWasShiftKeyDown = event.which === 16;
    var capsLockIsOn = false;
    var shifton = false;
    if (event.shiftKey) {
        shifton = event.shiftKey;
    } else if (event.modifiers) {
        shifton = !!(event.modifiers & 4);
    }

    if (event.target.value.length > 0 && !eventWasShiftKeyDown) {
      var lastChar = event.target.value[event.target.value.length-1];
      var isAlpha = /^[a-zA-Z]/.test(lastChar);

      if (isAlpha) {
        if (lastChar.toUpperCase() === lastChar && lastChar.toLowerCase() !== lastChar
          && !event.shiftKey && !capsLockIsOnKeyDown.shiftWasDownDuringLastChar) {
          capsLockIsOn =  true;
        }
      }
    }
    capsLockIsOnKeyDown.shiftWasDownDuringLastChar = shifton;
    return capsLockIsOn;
  }
} 
```

然后像这样在事件处理程序中调用它`capsLockIsOnKeyDown.capsLockIsOnKeyDown(event)`

但同样，我们最终只使用了@Mottie 和@Diego Vieira 的回复

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2021-11-18T01:21:09.360

如何使用**getModifierState()**

> 如果指定的修饰键被按下或激活，getModifierState() 方法返回 true。

你可以像这样使用它：

```
function checkIfCapsLockIsOn(event) {
  var capsLockIsOn = event.getModifierState("CapsLock");
  console.log("Caps Lock activated: " + capsLockIsOn);
} 
```

这将简单地检查 CapsLock 是**打开**还是**关闭**并将其显示在控制台中。您可以更改您想要的功能的工作方式。

**然后例如在keydown**或**keyup**上使用此功能。

```
<input type="text" onkeydown="checkIfCapsLockIsOn(event)"> 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2010-12-02T09:14:52.847

在下面的代码中，当 Caps 锁定并且他们使用 shift 按键时，它将显示警报。

如果我们返回 false；那么当前字符将不会附加到文本页面。

```
$('#password').keypress(function(e) { 
    // e.keyCode is not work in FF, SO, it will
    // automatically get the value of e.which.  
    var s = String.fromCharCode( e.keyCode || e.which );
    if ( s.toUpperCase() === s && s.toLowerCase() !== s && !e.shiftKey ) {
            alert('caps is on');
            return false;
    }
else  if ( s.toUpperCase() !== s) {
            alert('caps is on and Shiftkey pressed');
            return false;
    }
}); 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2012-11-05T13:54:26.623

试试这个简单易懂的代码

这是脚本

```
 <script language="Javascript">
function capLock(e){
 kc = e.keyCode?e.keyCode:e.which;
 sk = e.shiftKey?e.shiftKey:((kc == 16)?true:false);
 if(((kc >= 65 && kc <= 90) && !sk)||((kc >= 97 && kc <= 122) && sk))
  document.getElementById('divMayus').style.visibility = 'visible';
 else
   document.getElementById('divMayus').style.visibility = 'hidden';
}
</script> 
```

和 HTML

```
<input type="password" name="txtPassword" onkeypress="capLock(event)" />
 <div id="divMayus" style="visibility:hidden">Caps Lock is on.</div> 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2014-06-01T16:05:21.390

尝试使用此代码。

```
$('selectorOnTheInputTextBox').keypress(function (e) {
        var charCode = e.target.value.charCodeAt(e.target.value.length - 1)
        var capsOn = 
            e.keyCode && 
            !e.shiftKey &&
            !e.ctrlKey &&
            charCode >= 65 && 
            charCode <= 90;

            if (capsOn) 
               //action if true
            else
               //action if false
}); 
```

祝你好运 ：）

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2016-01-08T22:50:28.153

这是一个使用 jquery ui 的自定义 jquery 插件，由该页面上的所有好想法组成，并利用了工具提示小部件。大写锁定消息会自动应用所有密码框，并且不需要更改您当前的 html。

自定义插件代码...

```
(function ($) {
    $.fn.capsLockAlert = function () {
        return this.each(function () {
            var capsLockOn = false;
            var t = $(this);
            var updateStatus = function () {
                if (capsLockOn) {
                    t.tooltip('open');
                } else {
                    t.tooltip('close');
                }
            }
            t.tooltip({
                items: "input",
                position: { my: "left top", at: "left bottom+10" },
                open: function (event, ui) {
                    ui.tooltip.css({ "min-width": "100px", "white-space": "nowrap" }).addClass('ui-state-error');
                    if (!capsLockOn) t.tooltip('close');
                },
                content: function () {
                    return $('<p style="white-space: nowrap;"/>')
                        .append($('<span class="ui-icon ui-icon-alert" style="display: inline-block; margin-right: 5px; vertical-align: text-top;" />'))
                        .append('Caps Lock On');
                }
            })
            .off("mouseover mouseout")
            .keydown(function (e) {
                if (e.keyCode !== 20) return;
                capsLockOn = !capsLockOn;
                updateStatus();
            })
            .keypress(function (e) {
                var kc = e.which; //get keycode

                var isUp = (kc >= 65 && kc <= 90) ? true : false; // uppercase
                var isLow = (kc >= 97 && kc <= 122) ? true : false; // lowercase
                if (!isUp && !isLow) return; //This isn't a character effected by caps lock

                // event.shiftKey does not seem to be normalized by jQuery(?) for IE8-
                var isShift = (e.shiftKey) ? e.shiftKey : ((kc === 16) ? true : false); // shift is pressed

                // uppercase w/out shift or lowercase with shift == caps lock
                if ((isUp && !isShift) || (isLow && isShift)) {
                    capsLockOn = true;
                } else {
                    capsLockOn = false;
                }
                updateStatus();
            });
        });
    };
})(jQuery); 
```

适用于所有密码元素...

```
$(function () {
    $(":password").capsLockAlert();
}); 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2016-07-27T11:23:38.437

**Javascript代码**

```
<script type="text/javascript">
   function isCapLockOn(e){
   kc = e.keyCode?e.keyCode:e.which;
   sk = e.shiftKey?e.shiftKey:((kc == 16)?true:false);
   if(((kc >= 65 && kc <= 90) && !sk)||((kc >= 97 && kc <= 122) && sk))
       document.getElementById('alert').style.visibility = 'visible';
   else
       document.getElementById('alert').style.visibility = 'hidden';
   }
</script> 
```

**我们现在需要使用 Html 关联这个脚本**

```
<input type="password" name="txtPassword" onkeypress="isCapLockOn(event)" />
<div id="alert" style="visibility:hidden">Caps Lock is on.</div> 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2018-07-27T08:36:59.067

我知道已经晚了，但这可能对其他人有帮助。

所以这是我最简单的解决方案（使用土耳其字符）；

```
function (s,e)
{
    var key = e.htmlEvent.key;

    var upperCases = 'ABCÇDEFGĞHIİJKLMNOÖPRSŞTUÜVYZXWQ';
    var lowerCases = 'abcçdefgğhıijklmnoöprsştuüvyzxwq';
    var digits = '0123456789';

    if (upperCases.includes(key))
    {
        document.getElementById('spanLetterCase').innerText = '[A]';
    }

    else if (lowerCases.includes(key))
    {
        document.getElementById('spanLetterCase').innerText = '[a]';
    }

    else if (digits.includes(key))
    {
        document.getElementById('spanLetterCase').innerText = '[1]';
    }

    else
    {
        document.getElementById('spanLetterCase').innerText = '';
    }
} 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2018-10-11T16:44:08.217

所以我找到了这个页面，并不喜欢我找到的解决方案，所以我想出了一个，并提供给大家。对我来说，只有在我输入字母时大写锁定是否打开才重要。这段代码为我解决了这个问题。它快速简便，并为您提供了一个 capsIsOn 变量，以便在您需要时参考。

```
let capsIsOn=false;
let capsChecked=false;

let capsCheck=(e)=>{
    let letter=e.key;
    if(letter.length===1 && letter.match(/[A-Za-z]/)){
        if(letter!==letter.toLowerCase()){
          capsIsOn=true;
          console.log('caps is on');
        }else{
          console.log('caps is off');
        }
        capsChecked=true;
        window.removeEventListener("keyup",capsCheck);
    }else{
      console.log("not a letter, not capsCheck was performed");
    }

}

window.addEventListener("keyup",capsCheck);

window.addEventListener("keyup",(e)=>{
  if(capsChecked && e.keyCode===20){
    capsIsOn=!capsIsOn;
  }
});
```

* * *

## 回答 #29

> 赞同：-1
> 
> 时间：2011-12-18T22:33:03.197

当您键入时，如果 caplock 打开，它会自动将当前字符转换为小写。这样即使 caplocks 打开，它也不会像在当前页面上那样表现。为了通知您的用户，您可以显示一个文本，说明 caplocks 已打开，但表单条目已转换。

* * *

## 回答 #30

> 赞同：-1
> 
> 时间：2016-06-23T02:02:47.453

检测大写锁定有一个更简单的解决方案：

```
function isCapsLockOn(event) {
    var s = String.fromCharCode(event.which);
    if (s.toUpperCase() === s && s.toLowerCase() !== s && !event.shiftKey) {
        return true;
    }
} 
```

* * *

## 回答 #31

> 赞同：-8
> 
> 时间：2008-12-08T06:35:00.093

在[jQuery](http://jquery.com)中：

```
$('some_element').keypress(function(e){
       if(e.keyCode == 20){
             //caps lock was pressed
       }
}); 
```

[这个 jQuery 插件](https://stackoverflow.com/questions/348792/how-do-you-tell-if-caps-lock-is-on-using-javascript#348802)（[代码](http://plugins.jquery.com/files/jquery.caps.js.txt)）更简洁地实现了与[Rajesh 的答案](https://stackoverflow.com/questions/348792/how-do-you-tell-if-caps-lock-is-on-using-javascript#348802)相同的想法。

# javascript - 如何创建多选自动完成组合框？

> ID：348794
> 
> 赞同：5
> 
> 时间：2008-12-08T06:26:08.973
> 
> 标签：javascript, html

就我而言，我想使用 HTML、JavaScript 和 JSP 实现一个多选自动完成组合框。

有没有人知道如何实现这个？

这将类似于 StackOverflow 中显示的文本字段，同时向任何问题添加多个标签。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-08T06:47:16.090

我会推荐一个[Ajax 驱动的自动完成 JavaScript 组合框](http://www.dhtmlx.com/docs/products/dhtmlxCombo/index.shtml)，尤其是当您有大量数据要查询时。

否则，各种 javascript 库（如[Yahoo UI](http://developer.yahoo.com/yui/examples/autocomplete/ac_combobox.html)）确实提供了这种组合框。

例如，这个基于[ExtJS 复选框的](http://lovcombo.extjs.eu/)[组合框](http://lovcombo.extjs.eu/)确实提供了多选功能。

# mfc - MFC> 将对话框连接到对话框类

> ID：348807
> 
> 赞同：8
> 
> 时间：2008-12-08T06:39:16.047
> 
> 标签：mfc, dialog

我在现有资源文件中定义了一个新对话框及其控件。我还创建了一个新文件，它将处理从此对话框生成的事件。但我不确定如何将这两者联系起来。

声明是否`enum { IDD=IDD_NEW_DIALOG };`是连接两者所需的全部内容？还是我们应该添加一些其他声明？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-08T10:29:17.687

这通常在 MFC 中完成的方式是在资源编辑器中定义一个对话框模板（就像您所做的那样），然后在 C++ 中从 CDialog 派生一个类并将其与对话框模板相关联（听起来您已经完成了） - 这并不完全清楚）。

实际上将两者联系起来的是 CDialog 代码的构造函数。如果您查看 MFC 类向导自动生成的对话框相关代码，您将在构造函数实现中看到如下内容：

```
CMyDlg::CMyDlg(CWnd* pParent /*=NULL*/) : CDialog(CMyDlg::IDD, pParent) 
```

其中 CMyDlg::IDD 定义为具有新对话框模板标识符值的枚举。正是这一点使这一切发生，而不是枚举的声明。您可以将其修改为

```
CMyDlg::CMyDlg(CWnd* pParent /*=NULL*/) : CDialog(IDD_NEW_DIALOG, pParent) 
```

并且它仍然可以工作（假设 IDD_NEW_DIALOG 是资源中对话框的模板 ID），因为正在发生的只是对话框 ID 被传递到构造函数中。

总的来说，始终值得记住的是，尽管最初出现，MFC 并没有通过编译器魔术来绑定到 Windows - 这一切都是用 C++ 和一些宏完成的。

编辑：DIALOGEX 和 DIALOG 声明 Windows 理解的略有不同的对话框资源格式：前者比后者更新。然而，至少从 Windows 95 开始，两者就已经存在，所以这并不是一个非常重要的区别。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T06:43:15.663

这就是您通过对话框类（或非模态对话框）创建对话框时所需的全部内容`DoModal()`，`Create`这是正常的方法。

您当然需要从 CDialog 继承，并添加一个消息映射来将消息路由到您的 ewvent 处理函数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T06:43:12.653

使用类向导为新创建的对话框创建一个类。ctrl+w 是 UI 资源视图的快捷键。

# oop - 处理多个对象实例

> ID：348821
> 
> 赞同：0
> 
> 时间：2008-12-08T06:56:31.643
> 
> 标签：oop, abstract

这个问题是用伪 PHP 编写的，但我真的不介意我用什么语言得到答案（Ruby :-P 除外），因为这纯粹是假设性的。事实上，PHP 很可能是执行此类逻辑的最糟糕的语言。不幸的是，我以前从未这样做过，所以我无法提供真实世界的示例。因此，假设的答案是完全可以接受的。

基本上，我有很多执行任务的对象。对于此示例，假设每个对象都是一个从 Internet 下载文件的类。每个对象将下载不同的文件，并且下载是并行运行的。显然，某些对象可能会先于其他对象完成下载。数据的实际抓取可能在线程中运行，但这与这个问题无关。

所以我们可以这样定义对象：

```
class DownloaderObject() {
    var $url = '';
    var $downloading = false;

    function DownloaderObject($v){ // constructor
        $this->url = $v;
        start_downloading_in_the_background(url=$this->$url, callback=$this->finished);
        $this->downloading = true;
    }

    function finished() {
        save_the_data_somewhere();
        $this->downloading = false;
        $this->destroy(); // actually destroys the object
    }
} 
```

好的，所以我们有很多这样的对象在运行：

```
$download1 = new DownloaderObject('http://somesite.com/latest_windows.iso');
$download2 = new DownloaderObject('http://somesite.com/kitchen_sink.iso');
$download3 = new DownloaderObject('http://somesite.com/heroes_part_1.rar'); 
```

我们可以将它们存储在一个数组中：

```
$downloads = array($download1, $download2, $download3); 
```

所以我们有一个充满下载的数组：

```
array(
  1 => $download1,
  2 => $download2,
  3 => $download3
) 
```

我们可以像这样遍历它们：

```
print('Here are the downloads that are running:');
foreach ($downloads as $d) {
    print($d->url . "\n");
} 
```

好的，现在假设下载 2 完成，并且对象被销毁。现在我们应该在数组中有两个对象：

```
array(
  1 => $download1,
  3 => $download3
) 
```

但是阵中有一个洞！密钥 #2 未被使用。此外，如果我想开始新的下载，不清楚将下载插入到数组的哪个位置。以下可以工作：

```
$i = 0;
while ($i < count($downloads) - 1) {
    if (!is_object($downloads[$i])) {
        $downloads[$i] = new DownloaderObject('http://somesite.com/doctorwho.iso');
        break;
    }
    $i++;
} 
```

然而，这是非常低效的（并且`while $i++`循环是nooby）。所以，另一种方法是保留一个计数器。

```
function add_download($url) {
    global $downloads;
    static $download_counter;

    $download_counter++;
    $downloads[$download_counter] = new DownloaderObject($url);
} 
```

这会起作用，但我们仍然会在数组中找到漏洞：

```
array(
  1  => DownloaderObject,
  3  => DownloaderObject,
  7  => DownloaderObject,
  13 => DownloaderObject
) 
```

太丑了 然而，这样可以接受吗？是否应该对数组进行“碎片整理”，即重新排列键以消除空格？

还是我应该注意另一种程序结构？我想要一个结构，我可以添加东西，从中删除东西，引用变量中的键，迭代等等，这不是一个数组。这样的事情存在吗？

我已经编码多年了，但是这个问题多年来一直困扰着我，我仍然不知道答案。这对一些程序员来说可能很明显，但对我来说却非常重要。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-08T07:07:00.653

PHP 的“关联数组”的问题在于它们根本不是数组，它们是[Hashmaps](http://en.wikipedia.org/wiki/Hash_table)。那里有洞是完全没问题的。您也可以查看[链接列表](http://en.wikipedia.org/wiki/Linked_List)，但 Hashmap 似乎非常适合您正在做的事情。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T08:00:18.660

什么是维护您的下载器阵列？

如果将数组封装在下载器完成时通知的类中，则不必担心对已破坏对象的过时引用。

此类可以在内部管理数组的组织，并向其用户提供一个看起来更像迭代器而不是数组的接口。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-08T07:07:30.327

"$i++ 循环" 是小菜一碟，但这只是因为如果你使用 for 循环，代码会变得更清晰：

```
$i = 0;
while ($i < count($downloads) - 1) {
    if (!is_object($downloads[$i])) {
       $downloads[$i] = new DownloaderObject('http://somesite.com/doctorwho.iso');
        break;
    }
    $i++;
} 
```

变成

```
for($i=0;$i<count($downloads)-1;++$i){
    if (!is_object($downloads[$i])) {
        $downloads[$i] = new DownloaderObject('http://somesite.com/doctorwho.iso');
        break;
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-08T07:10:58.837

从 C# 的角度来看，我的第一个想法是您需要与数组不同的数据结构 - 您需要使用*更高级别的*数据结构来考虑问题。也许队列、列表或堆栈更适合您的目的？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-08T07:45:51.590

对您的问题的简短回答是，在 PHP 中，数组几乎用于所有事物，并且您很少最终使用其他数据结构。数组索引中存在漏洞无需担心。在 Java 等其他编程语言中，您可以选择更多样化的数据结构集：集合、哈希、列表、向量等。看来您还需要在 Array 和 DownloaderObject 类之间进行更密切的交互。仅仅因为对象 $download2 本身具有“destroyed()”，数组将维护对该对象的引用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-09T13:03:46.330

这个问题的一些很好的答案，反映了回答者的相对经验。非常感谢——事实证明他们很有教育意义。

大约三年前，我发布了这个问题。事后看来，我可以看到我在这方面的知识*严重*缺乏。我遇到的最大问题是我是从 PHP 角度来看的，它没有能力任意弹出元素。这个问题的其他答案帮助我发现了一个**根本上优越的模型是“链表”**。

对于 C，我写了[一篇关于链表的博客文章，](https://jeremy.visser.name/2009/09/linked-lists/)其中包含代码示例（太多无法在此处发布），但可以巧妙地填充原始问题的用例。

[对于 PHP，这里](http://www.codediesel.com/php/linked-list-in-php/)出现了一个链表实现，我从未尝试过，但想象它也是处理上述问题的正确方法。

有趣的是，[Python 列表](http://docs.python.org/tutorial/datastructures.html)包含的`pop()`方法与 PHP 不同[`array_pop()`](http://php.net/manual/en/function.array-pop.php)，它可以弹出任意元素并保持一切井井有条。例如：

```
>>> x = ['baa', 'ram', 'ewe'] # our starting point
>>> x[1]                      # making sure element 1 is 'ram'
'ram'
>>> x.pop(1)                  # let's arbitrarily pop an element in the middle
'ram'
>>> x                         # the one we popped ('ram') is now gone
['baa', 'ewe']
>>> x[1]                      # and there are no holes: item 2 has become item 1
'ewe' 
```

# c++ - 如何知道导致异常的确切代码行？

> ID：348833
> 
> 赞同：47
> 
> 时间：2008-12-08T07:09:26.513
> 
> 标签：c++, exception

如果我自己生成异常，我可以在异常中包含任何信息：代码行数和源文件名称。像这样的东西：

```
throw std::exception("myFile.cpp:255"); 
```

但是，未处理的异常或不是我生成的异常是怎么回事？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-12-08T07:38:46.127

更好的解决方案是使用自定义类和宏。:-)

```
#include <iostream>
#include <sstream>
#include <stdexcept>
#include <string>

class my_exception : public std::runtime_error {
    std::string msg;
public:
    my_exception(const std::string &arg, const char *file, int line) :
    std::runtime_error(arg) {
        std::ostringstream o;
        o << file << ":" << line << ": " << arg;
        msg = o.str();
    }
    ~my_exception() throw() {}
    const char *what() const throw() {
        return msg.c_str();
    }
};
#define throw_line(arg) throw my_exception(arg, __FILE__, __LINE__);

void f() {
    throw_line("Oh no!");
}

int main() {
    try {
        f();
    }
    catch (const std::runtime_error &ex) {
        std::cout << ex.what() << std::endl;
    }
} 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2008-12-08T18:23:05.780

似乎每个人都在尝试改进您的代码以在您的代码中引发异常，而没有人尝试您提出的实际问题。

那是因为做不到。如果引发异常的代码仅以二进制形式呈现（例如，在 LIB 或 DLL 文件中），那么行号就消失了，并且无法将对象连接到源代码中的行。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2008-12-08T08:40:04.193

有几种方法可以找出异常发生的位置：

**使用编译器宏**

在抛出位置使用`__FILE__`和`__LINE__`宏（如其他评论者所示），可以在 std 异常中将它们用作文本，也可以作为自定义异常的单独参数：

要么使用

```
throw std::runtime_error(msg " at " `__FILE__` ":" `__LINE__`); 
```

或扔

```
class my_custom_exception {
  my_custom_exception(const char* msg, const char* file, unsigned int line)
... 
```

请注意，即使在为 Unicode 编译（在 Visual Studio 中）时，**FILE**也会扩展为单字节字符串。这适用于调试和发布。不幸的是，带有代码抛出异常的源文件名被放置在输出可执行文件中。

**堆栈步行**

通过遍历调用堆栈找出异常位置。

*   在带有 gcc 的 Linux 上，函数 backtrace() 和 backtrace_symbols() 可以获取有关当前调用堆栈的信息。请参阅[gcc 文档](http://www.gnu.org/software/libc/manual/html_node/Backtraces.html)如何使用它们。代码必须使用 -g 编译，以便将调试符号放在可执行文件中。

*   在 Windows 上，您可以使用 dbghelp 库及其函数 StackWalk64 遍历堆栈。有关详细信息，请参阅 Jochen Kalmbach关于 CodeProject的[文章。](http://www.codeproject.com/KB/threads/StackWalker.aspx)这适用于调试和发布，您需要为所有想要了解信息的模块提供 .pdb 文件。

您甚至可以通过在引发自定义异常时收集调用堆栈信息来组合这两种解决方案。调用堆栈可以存储在异常中，就像在 .NET 或 Java 中一样。请注意，在 Win32 上收集调用堆栈非常慢（我最近的测试显示每秒大约收集 6 个调用堆栈）。如果您的代码抛出许多异常，这种方法会大大减慢您的程序。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-08T07:18:27.307

最简单的解决方案是使用宏：

```
#define throw_line(msg) \
    throw std::exception(msg " " __FILE__ ":" __LINE__)

void f() {
    throw_line("Oh no!");
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-08T07:16:16.563

如果你有一个调试版本并在 Visual Studio 调试器中运行它，那么当任何类型的异常被抛出时，你可以在它传播到世界之前中断调试器。

**使用Debug > Exceptions**菜单选项启用此功能，然后选中您感兴趣的异常类型。

如果应用程序源代码是您自己的，您还可以添加创建转储文件的功能。例如，使用特定构建的转储文件和 PDB 文件（符号），您将使用 WinDbg 获得堆栈跟踪。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2019-11-18T11:27:07.187

到目前为止，没有人提到提升。如果您使用的是 boost c++ 库，它们确实带有一些不错的异常默认值：

```
#include <boost/exception/diagnostic_information.hpp>
#include <exception>
#include <iostream>

struct MyException : std::exception {};

int main()
{
  try
  {
    BOOST_THROW_EXCEPTION(MyException());
  }
  catch (MyException &ex)
  {
    std::cerr << "Unexpected exception, diagnostic information follows:\n"
              << boost::current_exception_diagnostic_information();
  }
  return 0;
} 
```

然后你可能会得到类似的东西：

```
Unexpected exception, diagnostic information follows:
main.cpp(10): Throw in function int main()
Dynamic exception type: boost::exception_detail::clone_impl<boost::exception_detail::error_info_injector<MyException> >
std::exception::what: std::exception 
```

文档：[https ://www.boost.org/doc/libs/1_63_0/libs/exception/doc/diagnostic_information.html](https://www.boost.org/doc/libs/1_63_0/libs/exception/doc/diagnostic_information.html)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2018-09-12T00:30:59.077

受 Frank Krueger 的回答和[std::nested_exception](https://en.cppreference.com/w/cpp/error/nested_exception/ "std::nested_exception")文档的启发，我意识到您可以将我使用了一段时间的 Frank 的回答与 std::nested_exception 结合起来，以创建带有文件和行信息的完整错误堆栈跟踪. 例如，在我的实现中，运行

```
#include "Thrower.h"
#include <iostream>
// runs the sample function above and prints the caught exception
int main ( )
{
    try {
        // [Doing important stuff...]
        try {
            std::string s = "Hello, world!";
            try {
                int i = std::stoi ( s );
            }
            catch ( ... ) {
                thrower ( "Failed to convert string \"" + s + "\" to an integer!" );
            }
        }
        catch ( Error& e ) {
            thrower ( "Failed to [Do important stuff]!" );
        }
    }
    catch ( Error& e ) {
        std::cout << Error::getErrorStack ( e );
    }
    std::cin.get ( );
} 
```

输出

```
ERROR: Failed to [Do important stuff]!
@ Location:c:\path\main.cpp; line 33
 ERROR: Failed to convert string "Hello, world!" to an integer!
 @ Location:c:\path\main.cpp; line 28
  ERROR: invalid stoi argument 
```

这是我的实现：

```
#include <sstream>
#include <stdexcept>
#include <regex>

class Error : public std::runtime_error
{
    public:
    Error ( const std::string &arg, const char *file, int line ) : std::runtime_error( arg )
    {
        loc = std::string ( file ) + "; line " + std::to_string ( line );
        std::ostringstream out;
        out << arg << "\n@ Location:" << loc;
        msg = out.str( );
        bareMsg = arg;      
    }
    ~Error( ) throw() {}

    const char * what( ) const throw()
    {
        return msg.c_str( );
    }
    std::string whatBare( ) const throw()
    {
        return bareMsg;
    }
    std::string whatLoc ( ) const throw( )
    {
        return loc;
    }
    static std::string getErrorStack ( const std::exception& e, unsigned int level = 0)
    {
        std::string msg = "ERROR: " + std::string(e.what ( ));
        std::regex r ( "\n" );
        msg = std::regex_replace ( msg, r, "\n"+std::string ( level, ' ' ) );
        std::string stackMsg = std::string ( level, ' ' ) + msg + "\n";
        try
        {
            std::rethrow_if_nested ( e );
        }
        catch ( const std::exception& e )
        {
            stackMsg += getErrorStack ( e, level + 1 );
        }
        return stackMsg;
    }
    private:
        std::string msg;
        std::string bareMsg;
        std::string loc;
};

// (Important modification here)
// the following gives any throw call file and line information.
// throw_with_nested makes it possible to chain thrower calls and get a full error stack traceback
#define thrower(arg) std::throw_with_nested( Error(arg, __FILE__, __LINE__) ) 
```

```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-08T07:15:37.487

我认为堆栈跟踪应该让你明白这一点。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-07-26T14:22:04.393

我找到了 2 个解决方案，但都不是完全令人满意的：

1.  如果您调用`std::set_terminate`，您可以从那里直接从第三方异常抛出打印调用堆栈。不幸的是，没有办法从终止处理程序中恢复，因此您的应用程序将死亡。

2.  如果您调用`std::set_unexpected`，那么您需要从您的函数中声明尽可能多的`throw(MyControlledException)`，以便当它们由于第三方调用的函数而抛出时，您`unexpected_handler`将能够让您对应用程序抛出的位置有一个细粒度的想法。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2020-05-24T21:09:57.210

在调试模式下编译您的软件并使用 valgrind 运行它。它主要用于查找内存泄漏，但它也可以向您显示异常发生的确切位置`valgrind --leak-check=full /path/to/your/software`。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2020-11-27T20:30:45.500

其他人已经提议使用宏和可能的自定义类。但是如果你有一个异常层次结构，你还需要在抛出时指定异常类型：

```
#define THROW(ExceptionType, message)                                    \
    throw ExceptionType(std::string(message) + " in " + __FILE__ + ':'   \
                        + std::to_string(__LINE__) + ':' + __func__)

THROW(Error, "An error occurred"); 
```

这里的假设是所有异常都接受单个字符串参数，这不是限制性的，因为可以将其他参数转换为字符串（例如 with `std::to_string()`）并将它们连接到单个字符串。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-08T08:24:16.300

除了按照 Frank Krueger 的建议使用带有宏的自定义类之外，对于您自己的异常，您可能有兴趣查看结构化异常处理机制（您是在 windows 下编程，对吗？）
检查[结构化异常处理在 MSDN 上](http://msdn.microsoft.com/en-us/library/ms680657%28VS.85%29.aspx)

# asp.net-mvc - 在 asp.net mvc 中有图像链接的正确方法？

> ID：348837
> 
> 赞同：2
> 
> 时间：2008-12-08T07:13:08.177
> 
> 标签：asp.net-mvc

这样的事情可能会奏效

```
<%= Html.RouteLink("", new { controller = "Article", action = "Details", id = A.ArticleID}, new { @class = "image-link" })%> 
```

除了它不喜欢空标题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-08T10:52:29.217

这可以工作。

```
<a href="<%= Url.Action("Article", "Details", new {id = A.ArticleID}) %>">
  <img src="<% //Your image src here %>" />
</a> 
```

有几个人（包括我的公司）已经尝试过在 HtmlHelper 中创建一些可以做到这一点的东西，但最终，最好是这样做。

# math - 计算机代数系统简介？

> ID：348847
> 
> 赞同：39
> 
> 时间：2008-12-08T07:25:16.140
> 
> 标签：math, symbolic-math, computer-algebra-systems, symbolic-computation

有人知道有关计算机代数系统的一般理论（例如[mathematica](http://wolfram.com)、[sympy](http://code.google.com/p/sympy/)）的任何资源（书籍、课程、讲义或任何东西）吗？

“介绍性”材料是首选，但我意识到，对于这样一个专业的主题，任何事情都必然是相当先进的。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-12-08T08:57:32.210

CAS的“通论”是一个相当大的问题范围。话虽如此，我会尽我所能，希望能帮助你找到你想要的东西:)

ISSAC 和 SIGSAM 小组的会议记录无疑会包含一些关于构建 CAS 系统的技术的好东西。CAS 建设一般领域的各种主题列表可在此处获得：[http ://www.cs.berkeley.edu/~fateman/algebra.html](http://www.cs.berkeley.edu/~fateman/algebra.html)

如果您更多地寻找有关如何编码所涉及的一些数学的信息，我是“数字食谱”系列的粉丝；它在广泛的主题中提供了示例代码和相当不错的数学解释。最后我查了一下，这里有本书旧版本的在线版本：[http](http://www.nrbook.com/a/bookcpdf.php) ://www.nrbook.com/a/bookcpdf.php （请注意，这是本书的“C 中的数字食谱”形式；还有其他语言的版本）。

一般来说，要构建 CAS，可以从这里开始：Kajler 和 Safir 的“通过组合协作工具构建计算机代数环境”；您可能会检查的另一个地方是：http: [//www.math.wpi.edu/IQP/BVCalcHist/calc5.html](http://www.math.wpi.edu/IQP/BVCalcHist/calc5.html)，其中列出了一些人如何实现 CAS 的高级描述。

您可能会尝试的另一件事是深入研究一些现有的开源 CAS 项目的代码：YACAS（另一种计算机代数系统：Java）、Axiom 等。我喜欢这里的列表：[http://en。 wikipedia.org/wiki/List_of_computer_algebra_systems](http://en.wikipedia.org/wiki/List_of_computer_algebra_systems)

希望里面的东西有用！

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-08T09:12:46.530

[PAIP](http://norvig.com/paip.html)很好地涵盖了基础知识；源代码是[免费的在线](http://norvig.com/paip/)- 请特别参阅名称中带有“macsyma”的源文件。主题包括重写规则系统、使用规范形式进行简化、集成和区分，以及编译和记忆重写规则以提高速度。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-08T07:55:14.770

我发现 KO Geddes 的计算机代数算法非常有用。我是一名初中本科生，具有轻度数学背景，在 OpenAxiom（CAS）上工作。不过，为一些沉重的数学做好准备，我最好的建议是买几本书，如果你“卡住”了，可以有不同的看法。

如果您建议您正在研究什么，您感兴趣的领域等，这可能会有所帮助。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-08T07:32:20.040

这是维基百科的一个链接：[计算机代数系统](http://en.wikipedia.org/wiki/Computer_algebra_system)
和另一个在这里： http: [//www.math.wpi.edu/IQP/BVCalcHist/calc5.html](http://www.math.wpi.edu/IQP/BVCalcHist/calc5.html)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-04-01T02:07:27.600

这里有两本书描述了用于实现计算机代数系统的算法：

[计算机代数和符号计算：基本算法](http://web.cs.du.edu/~jscohen/ElementaryAlgorithms/index.htm)

[计算机代数和符号计算：数学方法](http://web.cs.du.edu/~jscohen/MathematicalMethods/index.htm)

[我使用这些书在 Scheme ( MPL](https://github.com/dharmatech/mpl) ) 和 C# ( [Symbolism](https://github.com/dharmatech/Symbolism) )中实现计算机代数库。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-10-06T15:17:33.277

您在问题中提到了[SymPy](http://sympy.org/en/index.html)，所以我将简要介绍一下。

SymPy 的项目和社区其实本身就是非常好的资源。

1.  有各种各样的专家定期检查并回复[邮件列表](http://groups.google.com/group/sympy)。
2.  代码[在 github 上](http://github.com/sympy/sympy)公开可用。
3.  [文档](http://docs.sympy.org)相当完整，通常包括学术引用。

如果你对 CAS 感兴趣，就来吧。贡献者喜欢谈论他们的工作。如果您有兴趣，很[容易开始](https://github.com/sympy/sympy/wiki/Development-workflow)并添加您自己的贡献。

# windows - 如何在可执行文件运行时让 Windows 批处理文件暂停？

> ID：348849
> 
> 赞同：7
> 
> 时间：2008-12-08T07:27:12.970
> 
> 标签：windows, batch-file

我正在编写一个批处理文件，我在其中调用一个 EXE 来执行。现在，调用 EXE 之后的语句在 EXE 完成执行之前不应执行。如何在批处理文件中执行此操作（在 Windows 上）？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-08T13:53:18.790

```
START /WAIT First.exe
START /WAIT Second.exe 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-08T07:38:43.977

这取决于 .exe 的工作方式。恐怕我没有所有的技术细节或术语，但一些 .exe 文件会在它们启动后立即返回对会话的控制，而其他文件在程序终止后才会返回控制权。

第二种情况很简单，因为文件中后面的命令在前一种完成之前不会执行，所以我假设你面对的是第 1 种情况。

如果每次运行时执行（大约）相同的时间量，一个简单的解决方法/hack 是使用延迟的 ping 命令。

```
PING 127.0.0.1 -n 1 -w 120000 >NUL 
```

这将强制 ping 命令以 120000 毫秒（2 分钟）的延迟运行一次。

[在fpschultze.de](http://www.fpschultze.de/news+article.storyid+97.htm)上还有一篇关于更复杂（但更可靠的方法）的好文章，其中有更详细的解释。简而言之，您查询任务列表以搜索您正在等待的可执行文件。一旦它不存在，您就继续处理批处理文件。它也使用 ping 方法，但方式不同。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-08T07:35:07.227

批处理文件中的语句按顺序执行。因此，如果您的批处理文件如下所示：

```
first.exe
next.exe 
```

如果 first 完成，则执行 Next。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-08T07:54:00.933

您可以使用带有参数的“start”命令 /wait 使用 start /? 在命令行上了解详细信息。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-12-01T16:04:06.613

这是一个非常简单的过程。只需保留以下行等待 10 秒，然后继续执行其他命令...

`TIMEOUT /T 10`

这就是你所要做的。我希望你喜欢我的技术。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-08T07:31:10.823

您可以使用

```
PAUSE 
```

在批处理脚本中，但我不明白你的问题。

# php - PHP 的代码覆盖率工具

> ID：348850
> 
> 赞同：42
> 
> 时间：2008-12-08T07:30:23.383
> 
> 标签：php, code-coverage

是否有任何可用于 PHP 的代码覆盖率工具？我希望检查我的代码和用 PHP 编写的 API 的代码覆盖率，但我无法使用任何 PHP 代码覆盖率工具，因为它更像是一种服务器端语言并且本质上是动态的。

有谁知道可以执行 PHP 代码覆盖的方法？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-12-08T07:34:29.880

[xdebug](http://www.xdebug.org/)有[代码覆盖率分析](http://www.xdebug.org/docs/code_coverage)。

检查PHPUnit手册的[这一章](https://phpunit.de/manual/current/en/code-coverage-analysis.html)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-06-14T03:57:54.123

请参阅 Semantic Designs 的 PHP 测试覆盖率工具：

[http://www.semanticdesigns.com/Products/TestCoverage/PHPTestCoverage.html](http://www.semanticdesigns.com/Products/TestCoverage/PHPTestCoverage.html)

非常低的开销，处理庞大的文件系统，直观的 GUI 显示特定文件的覆盖率，并生成包含方法、类和包级别的覆盖率细分的报告。

最重要的是，不需要在被测系统中安装*任何东西。*不需要 xdebug 等，这意味着您不必与系统管理员争论来进行测试。

您可以将它与 PHPUnit 一起使用来获得单元测试驱动的覆盖率。或者您可以在您的网站上使用它来收集您可能拥有的任何功能测试方法/工具的覆盖率。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-08T07:34:05.483

将 Xdebug 与[PHPUnit](http://www.phpunit.de/manual/3.0/en/code-coverage-analysis.html)结合使用可以为您提供代码覆盖率分析。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-08T20:42:20.150

[尖峰 PHPCoverage](http://developer.spikesource.com/wiki/index.php/Projects:phpcoverage)。[SimpleTest](http://www.simpletest.org)和[PHPUnit](http://www.phpunit.de)都可以很容易地与之集成，尽管 PHPUnits 支持是开箱即用的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-03-31T21:34:33.987

Xdebug 可以进行代码覆盖率报告，而构建实用程序 Phing 可以自动运行覆盖率报告 ( [http://devzone.zend.com/article/2955](http://devzone.zend.com/article/2955) )。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-05-21T10:49:43.263

Zend Studio 附带了开箱即用的代码覆盖工具。

# c# - C# 中的度量单位 - 几乎

> ID：348853
> 
> 赞同：63
> 
> 时间：2008-12-08T07:32:54.487
> 
> 标签：c#, f#, units-of-measurement

受到[F# 中的度量单位的](https://stackoverflow.com/questions/40845/how-do-f-units-of-measurement-work)启发，尽管断言（[在这里](https://stackoverflow.com/questions/39492/where-can-f-actually-save-time-and-money#71112)）你不能在 C# 中做到这一点，但前几天我有一个想法，我一直在玩。

```
namespace UnitsOfMeasure
{
    public interface IUnit { }
    public static class Length
    {
        public interface ILength : IUnit { }
        public class m : ILength { }
        public class mm : ILength { }
        public class ft : ILength { }
    }
    public class Mass
    {
        public interface IMass : IUnit { }
        public class kg : IMass { }
        public class g : IMass { }
        public class lb : IMass { }
    }

    public class UnitDouble<T> where T : IUnit
    {
        public readonly double Value;
        public UnitDouble(double value)
        {
            Value = value;
        }
        public static UnitDouble<T> operator +(UnitDouble<T> first, UnitDouble<T> second)
        {
            return new UnitDouble<T>(first.Value + second.Value);
        }
        //TODO: minus operator/equality
    }
} 
```

示例用法：

```
var a = new UnitDouble<Length.m>(3.1);
var b = new UnitDouble<Length.m>(4.9);
var d = new UnitDouble<Mass.kg>(3.4);
Console.WriteLine((a + b).Value);
//Console.WriteLine((a + c).Value); <-- Compiler says no 
```

下一步是尝试实现转换（片段）：

```
public interface IUnit { double toBase { get; } }
public static class Length
{
    public interface ILength : IUnit { }
    public class m : ILength { public double toBase { get { return 1.0;} } }
    public class mm : ILength { public double toBase { get { return 1000.0; } } }
    public class ft : ILength { public double toBase { get { return 0.3048; } } }
    public static UnitDouble<R> Convert<T, R>(UnitDouble<T> input) where T : ILength, new() where R : ILength, new()
    {
        double mult = (new T() as IUnit).toBase;
        double div = (new R() as IUnit).toBase;
        return new UnitDouble<R>(input.Value * mult / div);
    }
} 
```

（我本来希望避免使用静态实例化对象，但众所周知，您[不能在接口中声明静态方法](https://stackoverflow.com/questions/259026/why-doesnt-c-allow-static-methods-to-implement-an-interface)）然后您可以这样做：

```
var e = Length.Convert<Length.mm, Length.m>(c);
var f = Length.Convert<Length.mm, Mass.kg>(d); <-- but not this 
```

显然，与 F# 度量单位相比，这有一个巨大的漏洞（我会让你算出来）。

哦，问题是：你怎么看这个？值得使用吗？其他人已经做得更好了吗？

**对这个主题领域感兴趣的人的**更新，**[这里](http://www.cs.utexas.edu/users/novak/units95.pdf)是 1997 年的一篇论文的链接，讨论了一种不同的解决方案（不是专门针对 C#）**

 *** * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-12-08T08:03:59.930

您缺少维度分析。例如（从您链接到的答案），在 F# 中，您可以这样做：

```
let g = 9.8<m/s^2> 
```

它会生成一个新的加速度单位，从米和秒派生（实际上你可以在 C++ 中使用模板做同样的事情）。

在 C# 中，可以在运行时进行维度分析，但它会增加开销并且不会为您提供编译时检查的好处。据我所知，没有办法在 C# 中执行完整的编译时单元。

是否值得做当然取决于应用，但对于许多科学应用来说，这绝对是一个好主意。我不知道任何现有的 .NET 库，但它们可能存在。

如果您对如何在运行时执行此操作感兴趣，那么这个想法是每个值都有一个标量值和表示每个基本单元的幂的整数。

```
class Unit
{
    double scalar;
    int kg;
    int m;
    int s;
    // ... for each basic unit

    public Unit(double scalar, int kg, int m, int s)
    {
       this.scalar = scalar;
       this.kg = kg;
       this.m = m;
       this.s = s;
       ...
    }

    // For addition/subtraction, exponents must match
    public static Unit operator +(Unit first, Unit second)
    {
        if (UnitsAreCompatible(first, second))
        {
            return new Unit(
                first.scalar + second.scalar,
                first.kg,
                first.m,
                first.s,
                ...
            );
        }
        else
        {
            throw new Exception("Units must match for addition");
        }
    }

    // For multiplication/division, add/subtract the exponents
    public static Unit operator *(Unit first, Unit second)
    {
        return new Unit(
            first.scalar * second.scalar,
            first.kg + second.kg,
            first.m + second.m,
            first.s + second.s,
            ...
        );
    }

    public static bool UnitsAreCompatible(Unit first, Unit second)
    {
        return
            first.kg == second.kg &&
            first.m == second.m &&
            first.s == second.s
            ...;
    }
} 
```

如果您不允许用户更改单位的值（无论如何都是个好主意），您可以为常用单位添加子类：

```
class Speed : Unit
{
    public Speed(double x) : base(x, 0, 1, -1, ...); // m/s => m^1 * s^-1
    {
    }
}

class Acceleration : Unit
{
    public Acceleration(double x) : base(x, 0, 1, -2, ...); // m/s^2 => m^1 * s^-2
    {
    }
} 
```

您还可以在派生类型上定义更具体的运算符，以避免检查常见类型上的兼容单元。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2010-06-01T12:43:19.390

您可以在数字类型上添加扩展方法以生成度量。感觉有点像 DSL：

```
var mass = 1.Kilogram();
var length = (1.2).Kilometres(); 
```

这不是真正的 .NET 约定，也可能不是最容易发现的特性，因此您可能会将它们添加到喜欢它们的人的专用命名空间中，并提供更常规的构造方法。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-12-08T07:46:23.243

为相同度量的不同单位使用不同的类（例如，长度为厘米、毫米和英尺）似乎有点奇怪。基于 .NET Framework 的 DateTime 和 TimeSpan 类，我希望是这样的：

```
Length  length       = Length.FromMillimeters(n1);
decimal lengthInFeet = length.Feet;
Length  length2      = length.AddFeet(n2);
Length  length3      = length + Length.FromMeters(n3); 
```

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2013-07-21T22:55:06.920

我最近在[GitHub](https://github.com/angularsen/UnitsNet)和[NuGet](https://www.nuget.org/packages/UnitsNet/)上发布了 Units.NET 。

它为您提供所有常用单位和转换。它是轻量级的，经过单元测试并支持 PCL。

示例转换：

```
Length meter = Length.FromMeters(1);
double cm = meter.Centimeters; // 100
double yards = meter.Yards; // 1.09361
double feet = meter.Feet; // 3.28084
double inches = meter.Inches; // 39.3701 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2012-07-03T15:05:53.573

现在存在这样的 C# 库：http: [//www.codeproject.com/Articles/413750/Units-of-Measure-Validator-for-Csharp](http://www.codeproject.com/Articles/413750/Units-of-Measure-Validator-for-Csharp)

它具有与 F# 的单元编译时验证几乎相同的功能，但针对 C#。核心是一个 MSBuild 任务，它解析代码并寻找验证。

单元信息存储在注释和属性中。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-02-09T21:54:20.620

这是我对在 C#/VB 中创建单元的担忧。如果您认为我错了，请纠正我。我读过的大多数实现似乎都涉及创建一个结构，该结构将一个值（int 或 double）与一个单元组合在一起。然后，您尝试为这些结构定义基本函数（+-*/ 等），并考虑单位转换和一致性。

我觉得这个想法很有吸引力，但每次我都犹豫这对于一个项目来说是多么巨大的一步。这看起来像是一个全有或全无的交易。您可能不会只是将几个数字更改为单位；关键是项目内的所有数据都用一个单位适当地标记以避免任何歧义。这意味着告别使用普通的双精度和整数，每个变量现在都定义为“单位”或“长度”或“米”等。人们真的大规模这样做吗？所以即使你有一个大数组，每个元素都应该用一个单位标记。这显然会对尺寸和性能产生影响。

尽管尝试将单元逻辑推到后台有很多聪明之处，但 C# 似乎不可避免地会出现一些繁琐的符号。F# 做了一些幕后魔术，更好地减少了单元逻辑的烦恼因素。

此外，当我们需要时，如果不使用 CType 或“.Value”或任何其他符号，我们如何使编译器像普通双精度一样处理一个单元？比如使用 nullables，代码知道处理 double 吗？就像一个双倍（当然，如果你的双倍？为空，那么你会得到一个错误）。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-11-16T20:13:29.177

谢谢你的主意。我用 C# 实现了许多不同的单元，似乎总是有问题。现在我可以使用上面讨论的想法再试一次。我的目标是能够根据现有单位定义新单位，例如

```
Unit lbf = 4.44822162*N;
Unit fps = feet/sec;
Unit hp = 550*lbf*fps 
```

并让程序找出要使用的正确尺寸、比例和符号。最后，我需要构建一个基本的代数系统，可以转换类似的东西，`(m/s)*(m*s)=m^2`并尝试根据定义的现有单位来表达结果。

还必须能够以不需要编码新单元的方式序列化单元，而只需在 XML 文件中声明，如下所示：

```
<DefinedUnits>
  <DirectUnits>
<!-- Base Units -->
<DirectUnit Symbol="kg"  Scale="1" Dims="(1,0,0,0,0)" />
<DirectUnit Symbol="m"   Scale="1" Dims="(0,1,0,0,0)" />
<DirectUnit Symbol="s"   Scale="1" Dims="(0,0,1,0,0)" />
...
<!-- Derived Units -->
<DirectUnit Symbol="N"   Scale="1" Dims="(1,1,-2,0,0)" />
<DirectUnit Symbol="R"   Scale="1.8" Dims="(0,0,0,0,1)" />
...
  </DirectUnits>
  <IndirectUnits>
<!-- Composite Units -->
<IndirectUnit Symbol="m/s"  Scale="1"     Lhs="m" Op="Divide" Rhs="s"/>
<IndirectUnit Symbol="km/h" Scale="1"     Lhs="km" Op="Divide" Rhs="hr"/>
...
<IndirectUnit Symbol="hp"   Scale="550.0" Lhs="lbf" Op="Multiply" Rhs="fps"/>
  </IndirectUnits>
</DefinedUnits> 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-03-30T20:21:21.303

you could use QuantitySystem instead of implementing it by your own. It builds on F# and drastically improves unit handling in F#. It's the best implementation I found so far and can be used in C# projects.

[http://quantitysystem.codeplex.com](http://quantitysystem.codeplex.com)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-08T07:55:29.637

有 jscience： http: [//jscience.org/](http://jscience.org/)，这里有一个用于单位的 groovy dsl： http: [//groovy.dzone.com/news/domain-specific-language-unit-](http://groovy.dzone.com/news/domain-specific-language-unit-)。iirc，c# 有闭包，所以你应该能够拼凑一些东西。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-08T08:31:54.087

为什么不使用 CodeDom 自动生成所有可能的单位排列？我知道这不是最好的——但我一定会努力的！

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2021-05-18T13:42:03.547

我希望编译器尽可能地帮助我。所以也许你可以有一个 TypedInt ，其中 T 包含实际单位。

```
 public struct TypedInt<T>
    {
        public int Value { get; }

        public TypedInt(int value) => Value = value;

        public static TypedInt<T> operator -(TypedInt<T> a, TypedInt<T> b) => new TypedInt<T>(a.Value - b.Value);
        public static TypedInt<T> operator +(TypedInt<T> a, TypedInt<T> b) => new TypedInt<T>(a.Value + b.Value);
        public static TypedInt<T> operator *(int a, TypedInt<T> b) => new TypedInt<T>(a * b.Value);
        public static TypedInt<T> operator *(TypedInt<T> a, int b) => new TypedInt<T>(a.Value * b);
        public static TypedInt<T> operator /(TypedInt<T> a, int b) => new TypedInt<T>(a.Value / b);

        // todo: m² or m/s
        // todo: more than just ints
        // todo: other operations
        public override string ToString() => $"{Value} {typeof(T).Name}";
    } 
```

您可以有一个扩展方法来设置类型（或只是新的）：

```
 public static class TypedInt
    {
        public static TypedInt<T> Of<T>(this int value) => new TypedInt<T>(value);
    } 
```

实际单位可以是任何东西。这样，系统是可扩展的。（有多种处理转换的方法。您认为哪种方法最好？）

```
 public class Mile
    {
        // todo: conversion from mile to/from meter
        // maybe define an interface like ITypedConvertible<Meter>
        // conversion probably needs reflection, but there may be
        // a faster way
    };

    public class Second
    {
    } 
```

这样，您可以使用：

```
 var distance1 = 10.Of<Mile>();
            var distance2 = 15.Of<Mile>();
            var timespan1 = 4.Of<Second>();

            Console.WriteLine(distance1 + distance2);
            //Console.WriteLine(distance1 + 5); // this will be blocked by the compiler
            //Console.WriteLine(distance1 + timespan1); // this will be blocked by the compiler
            Console.WriteLine(3 * distance1);
            Console.WriteLine(distance1 / 3);
            //Console.WriteLine(distance1 / timespan1); // todo! 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2021-05-12T21:11:51.160

> 值得使用吗？

**是**的。如果我面前有一个“数字”，我想知道那是什么。一天中的任何时间。此外，这是我们*通常*做的。我们将数据组织成一个有意义的实体类，结构，你可以命名它。双倍成坐标，字符串成名称和地址等。为什么单位应该有所不同？

> 其他人已经做得更好了吗？

取决于如何定义“更好”。那里有一些图书馆，但我没有尝试过，所以我没有意见。此外它破坏了自己尝试的乐趣:)

现在关于实施。我想从显而易见的开始：尝试`[<Measure>]`在 C# 中复制 F# 的系统是徒劳的。为什么？因为一旦 F# 允许您`/` `^`直接在另一种类型上使用（或其他任何东西），游戏就输了。祝你好运在 C# 上的 a`struct`或`class`. 此类任务所需的元编程级别不存在，我担心它不会很快被添加 - 在我看来。这就是为什么您缺乏 Matthew Crumley 在他的回答中提到的维度分析。

让我们以[fsharpforfunandprofit.com](https://fsharpforfunandprofit.com/posts/units-of-measure/)中的示例为例：您将`Newton`s 定义为`[<Measure>] type N = kg m/sec^2`。现在你有了`square`作者创建的函数，它会返回一个`N^2`听起来“错误”、荒谬和无用的函数。**除非**您想在评估过程中的某个时刻执行算术运算，否则您可能会得到一些“毫无意义”的东西，直到将它与其他单位相乘并得到有意义的结果。或者更糟糕的是，您可能想要使用常量。例如气体常数`R`是`8.31446261815324` `J /(K mol)`。如果您定义了适当的单位，那么 F# 就可以使用 R 常数了。C# 不是。您需要为此指定另一种类型，但您仍然无法对该常量执行任何您想要的操作。

这并不意味着你不应该尝试。我做到了，我对结果非常满意。大约 3 年前，在我受到这个问题的启发之后，我开始了[SharpConvert 。](https://github.com/adamstyl/sharp-convert)[触发是这个故事：有一次我必须为我开发的RADAR 模拟器](http://darssy.com)修复一个讨厌的错误：一架飞机坠入地球，而不是遵循预定义的下滑路径。正如你所猜想的那样，这并没有让我感到高兴，经过 2 小时的调试，我意识到在我的计算中的某个地方，我将公里视为海里。在那之前，我就像“哦，好吧，我会'小心'”，这对于任何非平凡的任务来说至少是天真的。

在您的代码中，我会做一些不同的事情。

`UnitDouble<T>`首先，我会将`IUnit`实现转换为结构。一个单元就是一个数字，如果您希望它们被视为数字，那么结构是一种更合适的方法。

然后我会避免`new T()`方法中的。它不调用构造函数，它使用`Activator.CreateInstance<T>()`并用于数字运算，因为它会增加开销。尽管这取决于实现，但对于简单的单位转换器应用程序来说，它不会造成伤害。对于时间紧迫的上下文，避免像瘟疫一样。不要误会我的意思，我自己使用它，因为我不知道更好，前几天我运行了一些简单的基准测试，这样的调用可能会使执行时间加倍 - 至少在我的情况下。剖析 C#中的 new() 约束中的更多详细信息[：泄漏抽象的完美示例](https://devblogs.microsoft.com/premier-developer/dissecting-the-new-constraint-in-c-a-perfect-example-of-a-leaky-abstraction/)

我也会更改`Convert<T, R>()`并使其成为成员函数。我更喜欢写作

```
var c = new Unit<Length.mm>(123);
var e = c.Convert<Length.m>(); 
```

而不是

```
var e = Length.Convert<Length.mm, Length.m>(c); 
```

最后但并非最不重要的一点是，我将为每个物理量（长度时间等）使用特定的单位“外壳”而不是 UnitDouble，因为添加物理量特定功能和运算符重载会更容易。它还允许您创建一个`Speed<TLength, TTime>`shell 而不是另一个`Unit<T1, T2>`甚至是`Unit<T1, T2, T3>`类。所以它看起来像这样：

```
public readonly struct Length<T> where T : struct, ILength
{
    private static readonly double SiFactor = new T().ToSiFactor;
    public Length(double value)
    {
        if (value < 0) throw new ArgumentException(nameof(value));
        Value = value;
    }

    public double Value { get; }

    public static Length<T> operator +(Length<T> first, Length<T> second)
    {
        return new Length<T>(first.Value + second.Value);
    }

    public static Length<T> operator -(Length<T> first, Length<T> second)
    {
        // I don't know any application where negative length makes sense,
        // if it does feel free to remove Abs() and the exception in the constructor
        return new Length<T>(System.Math.Abs(first.Value - second.Value));
    }

    // You can add more like
    // public static Area<T> operator *(Length<T> x, Length<T> y)
    // or
    //public static Volume<T> operator *(Length<T> x, Length<T> y, Length<T> z)
    // etc

    public Length<R> To<R>() where R : struct, ILength
    {
        //notice how I got rid of the Activator invocations by moving them in a static field;
        //double mult = new T().ToSiFactor;
        //double div = new R().ToSiFactor;
        return new Length<R>(Value * SiFactor / Length<R>.SiFactor);
    }
} 
```

还要注意，为了让我们免于可怕的 Activator 调用，我将结果存储`new T().ToSiFactor`在 SiFactor 中。起初它可能看起来很尴尬，但由于 Length 是通用的，`Length<mm>`它将有自己的副本，`Length<Km>`它自己的，等等等等。请注意，这`ToSiFactor`是`toBase`您的方法。

我看到的问题是，只要您处于简单单位的领域并达到时间的一阶导数，事情就很简单。如果您尝试做一些更复杂的事情，那么您可以看到这种方法的缺点。打字

```
var accel = new Acceleration<m, s, s>(1.2); 
```

不会像

```
let accel = 1.2<m/sec^2> 
```

无论采用哪种方法，您都必须通过大量的运算符重载来指定您需要的每个数学运算，而在 F# 中，您可以免费使用它，即使结果没有我在开头所写的意义。

这种设计的最后一个缺点（或优点取决于你如何看待它）是它不能与单元无关。如果有些情况你需要“只是一个长度”，你就不能拥有它。您每次都需要知道您的长度是毫米、法定英里还是英尺。我在 SharpConvert 中采用了相反的方法，并`LengthUnit`衍生自`UnitBase`Meters Kilometers 等。这就是为什么我不能`struct`顺道走下去的原因。这样你就可以拥有：

```
LengthUnit l1 = new Meters(12);
LengthUnit l2 = new Feet(15.4);
LengthUnit sum = l1 + l2; 
```

`sum`将是米，但只要他们想在下一次操作中使用它就不必关心。如果他们想显示它，那么他们可以调用`sum.To<Kilometers>()`或任何单位。老实说，我不知道不将变量“锁定”到特定单位是否有任何优势。在某些时候可能值得对其进行调查。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2011-09-27T04:05:27.397

我真的很喜欢阅读这个堆栈溢出问题及其答案。

我有一个多年来一直在修补的宠物项目，最近开始重新编写它并将其发布到[https://github.com/MafuJosh/NGenericDimensions的开源项目](https://github.com/MafuJosh/NGenericDimensions)

它恰好与本页问答中表达的许多想法有些相似。

它基本上是关于创建通用维度，使用度量单位和本机数据类型作为通用类型占位符。

例如：

```
Dim myLength1 as New Length(of Miles, Int16)(123) 
```

还可以选择使用扩展方法，例如：

```
Dim myLength2 = 123.miles 
```

和

```
Dim myLength3 = myLength1 + myLength2
Dim myArea1 = myLength1 * myLength2 
```

这不会编译：

```
Dim myValue = 123.miles + 234.kilograms 
```

可以在您自己的库中扩展新单元。

这些数据类型是仅包含 1 个内部成员变量的结构，因此它们是轻量级的。

基本上，运算符重载仅限于“维度”结构，因此每个度量单位都不需要运算符重载。

当然，一个很大的缺点是需要 3 种数据类型的泛型语法声明较长。因此，如果这对您来说是个问题，那么这不是您的图书馆。

主要目的是能够以编译时检查的方式装饰带有单元的接口。

图书馆有很多事情需要做，但我想把它贴出来，以防有人正在寻找这种东西。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-28T22:07:18.317

请参阅 Boo Ometa（可用于 Boo 1.0）： [Boo Ometa 和可扩展解析](http://bamboo.github.com/2008/08/05/boo-ometa-and-extensible-parsing-I.html)

# ftp - 如何监控我的 ftp 应用程序发送到 ftp 服务器的命令

> ID：348864
> 
> 赞同：0
> 
> 时间：2008-12-08T07:42:53.670
> 
> 标签：ftp, monitoring

F 有没有办法监控 FTP 端口，以便我知道我的 FTP 应用程序正在向 FTP 服务器发送什么命令？

我正在使用闭源 FTP 客户端应用程序，它不能与闭源 FTP 应用程序服务器一起使用。客户端和服务器之间的通信不好，我想找出原因。我希望对客户端进行逆向工程，以查看客户端向服务器发送的推荐内容。之前我使用了一个网络测试工具，可以让我监控通过 HTTP 传输的内容，但我似乎找不到这样的 FTP 工具。如果您能帮助我，我将不胜感激，谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-08T07:49:25.280

听起来你需要一个[数据包嗅探器](http://sectools.org/sniffers.html)——假设你的网络管理员/公司政策允许它......我以前相当成功地使用过wireshark。

核心 FTP 命令应该在数据包中可见。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-08T07:49:48.070

您可以使用 Wireshark 应用程序：http: [//www.wireshark.org/](http://www.wireshark.org/)

它应该对 FTP 以及其他协议具有良好的解析能力。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-08T07:53:30.560

您可以使用客户端配置代理吗？然后你可以安装一个 ftp 代理服务器，使用登录来查看发生了什么？

这里有一个 Linux 代理服务器：http: [//frox.sourceforge.net/doc/FAQ.html](http://frox.sourceforge.net/doc/FAQ.html)

保罗。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-08T07:57:08.057

您可以访问 ftp 服务器日志吗？这些命令很可能会记录在那里。

如果不是，您的下一个选择是配置服务器以记录它们（如果您有权访问）。

如果那不是一个选项或服务器没有记录这些事情，那么您必须按照以前的海报所建议的那样去数据包嗅探器或代理。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-08T10:34:33.997

在 Unix 上，tcpdump 可能是你的朋友。不过，也许您应该首先说明您的目标是哪个操作系统。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-18T10:55:46.257

如果您有能力（通常需要 root 访问权限）使用数据包嗅探器，[则 tcpflow](http://www.circlemud.org/~jelson/software/tcpflow/)嗅探 TCP 控制通道将以易于阅读的格式向您显示来回的命令和响应。

如果您没有这样的访问权限，诸如`ktrace`and之类的工具`strace`将允许您查看在此连接的套接字上读取和写入的所有数据，尽管提取它需要做一些工作。

如果您能告诉我们您使用什么工具处理 HTTP 流量，那我们就可以为 FTP 流量寻找类似的工具。

# asp.net-mvc - asp.net mvc相关，主要是重构问题

> ID：348867
> 
> 赞同：0
> 
> 时间：2008-12-08T07:46:19.497
> 
> 标签：asp.net-mvc, refactoring

谁能想到更好的方法来做到这一点？

```
 [AcceptVerbs(HttpVerbs.Post)]
    public ActionResult SaveAction()
    {
        NameValueDeserializer value = new NameValueDeserializer();

        // selected messages
        MemberMessageSaveAction[] messages = (MemberMessageSaveAction[])value.Deserialize(Request.Form, "value", typeof(MemberMessageSaveAction[]));

        // selected action
        MemberMessageAction action = (MemberMessageAction)Enum.Parse(typeof(MemberMessageAction), Request.Form["action"]);

        // determine action
        if (action != MemberMessageAction.MarkRead &&
            action != MemberMessageAction.MarkUnRead &&
            action != MemberMessageAction.Delete)
        {
            // selected action requires special processing
            IList<MemberMessage> items = new List<MemberMessage>();

            // add selected messages to list
            for (int i = 0; i < messages.Length; i++)
            {
                foreach (int id in messages[i].Selected)
                {
                    items.Add(MessageRepository.FetchByID(id));
                }
            }

            // determine action further
            if (action == MemberMessageAction.MoveToFolder)
            {
                // folders
                IList<MemberMessageFolder> folders = FolderRepository.FetchAll(new MemberMessageFolderCriteria
                {
                    MemberID = Identity.ID,
                    ExcludedFolder = Request.Form["folder"]
                });

                if (folders.Total > 0)
                {
                    ViewData["messages"] = items;
                    ViewData["folders"] = folders;

                    return View("move");
                }

                return Url<MessageController>(c => c.Index("inbox", 1)).Redirect();
            }
            else if (action == MemberMessageAction.ExportXml)
            {
                return new MemberMessageDownload(Identity.ID, items, MemberMessageDownloadType.Xml);
            }
            else if (action == MemberMessageAction.ExportCsv)
            {
                return new MemberMessageDownload(Identity.ID, items, MemberMessageDownloadType.Csv);
            }
            else
            {
                return new MemberMessageDownload(Identity.ID, items, MemberMessageDownloadType.Text);
            }
        }
        else if (action == MemberMessageAction.Delete)
        {
            for (int i = 0; i < messages.Length; i++)
            {
                foreach (int id in messages[i].Selected)
                {
                    MemberMessage message = MessageRepository.FetchByID(id);

                    if (message.Sender.ID == Identity.ID || message.Receiver.ID == Identity.ID)
                    {
                        if (message.Sender.ID == Identity.ID)
                        {
                            message.SenderActive = false;
                        }
                        else
                        {
                            message.ReceiverActive = false;
                        }

                        message.Updated = DateTime.Now;

                        MessageRepository.Update(message);

                        if (message.SenderActive == false && message.ReceiverActive == false)
                        {
                            MessageRepository.Delete(message);
                        }
                    }
                }
            }
        }
        else
        {
            for (int i = 0; i < messages.Length; i++)
            {
                foreach (int id in messages[i].Selected)
                {
                    MemberMessage message = MessageRepository.FetchByID(id);

                    if (message.Receiver.ID == Identity.ID)
                    {
                        if (action == MemberMessageAction.MarkRead)
                        {
                            message.ReceiverRead = true;
                        }
                        else
                        {
                            message.ReceiverRead = false;
                        }

                        message.Updated = DateTime.Now;

                        MessageRepository.Update(message);
                    }
                }
            }
        }

        return Url<MessageController>(c => c.Index("inbox", 1)).Redirect();
    } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-08T08:42:50.943

我认为您也可以将 mvc 框架用于您的大部分代码。如果我错了，请纠正我，因为我将对您的课程做出一些假设，因为我无法从您的帖子中扣除它。
我的假设：

*   Request.Form["action"] 是一个单值选择框
*   Request.Form["value"] 是一个多值选择框
*   action 是您希望对所有消息采取的行动
*   message 是应该与操作一起使用的值列表

我会尽量利用框架的功能

```
[AcceptVerbs(HttpVerbs.Post)]
public ActionResult SaveMemberAction(SelectList selectedMessages, MemberMessageAction actionType){
     //Refactors mentioned by others        
} 
```

如果您随后在您的 Html 中输入正确的名称（在我的示例中为 selectedMessages 和 actionType），那么前几条规则就变得不重要了。

如果默认 modelBinder 无法帮助您，您可能需要考虑将解析逻辑放在自定义 modelbinder 中。你可以搜索关于它的帖子。

附带说明：您可能需要重新考虑变量命名。“action”可能会与 MVC 的操作（如 ActionResult 中的操作）混淆，并且 MemberMessageSaveAction 可能看起来像是 MemberMessageAction 枚举的值。只是一个想法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T07:49:06.543

第一步将为每个动作制定不同的方法。

接下来是去除负面逻辑。

这会导致这样的结果：

```
[AcceptVerbs(HttpVerbs.Post)]
public ActionResult SaveAction() {
  // SNIP   
  if (action == MemberMessageAction.Delete) {
    return DoDeleteAction(...);
  }
  else if (action == MemberMessageAction.MoveToFolder) {
    return DoMoveToFolderAction(...);
  }
  else if (action == MemberMessageAction.ExportXml) {
    return DoExportXmlAction(...);
  }
  else if (action == MemberMessageAction.ExportCsv) {
    return DoExportCsvAction(...);
  }
  else {
    return HandleUnknownAction(...);
  }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-08T07:58:27.663

将 MemberMessageAction 转换为具有 Perform 虚函数的类。

对于您的特殊操作，将通用执行代码分组：

```
[AcceptVerbs(HttpVerbs.Post)]
public ActionResult SaveAction()
{
    NameValueDeserializer value = new NameValueDeserializer();
    MemberMessageSaveAction[] messages = (MemberMessageSaveAction[])value.Deserialize(Request.Form, "value", typeof(MemberMessageSaveAction[]));
    MemberMessageAction action = MemberMessageAction.FromName(
        messages,
        Request.Form["action"]));
    return action.Perform();
}

class MoveToFolder : SpecialAction { /*...*/ }
class ExportXml : SpecialAction { /*...*/ }
class ExportCsv : SpecialAction { /*...*/ }

class Delete : MemberMessageAction { /*...*/ }
class MarkRead : MemberMessageAction { /*...*/ }
class MarkUnRead : MemberMessageAction { /*...*/ }

abstract class MemberMessageAction {
    protected MemberMessageSaveAction[] messages;
    public MemberMessageAction(MemberMessageSaveAction[] ms) { messages = ms; }
    public abstract ActionResult Perform();
    public static MemberMessageAction FromName(MemberMessageSaveAction[] ms, string action) {
        // stupid code
        // return new Delete(ms);
    }
}

abstract class SpecialAction : MemberMessageAction {
    protected IList<MemberMessage> items;
    public SpecialAction(MemberMessageSaveAction[] ms) : base(ms) {
        // Build items
    }
} 
```

现在您可以轻松地分解代码。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-08T10:52:27.267

我不喜欢

```
MessageRepository.FetchByID(messages[i].ID) 
```

这将对数据库进行 messages.Length （选定）查询。我认为您需要将消息存储在 ViewData 中，执行过滤并将它们传递给 Update() 而无需重新查询数据库。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-08T10:28:46.597

我想出了这个。

```
 [AcceptVerbs(HttpVerbs.Post)]
    public ActionResult Update(MemberMessageUpdate[] messages, MemberMessage.Action action)
    {
        var actions = new List<MemberMessage.Action>
        {
            MemberMessage.Action.MoveToFolder,
            MemberMessage.Action.ExportCsv,
            MemberMessage.Action.ExportText,
            MemberMessage.Action.ExportText
        };

        if (actions.Contains(action))
        {
            IList<MemberMessage> items = new List<MemberMessage>();

            for (var i = 0; i < messages.Length; i++)
            {
                if (messages[i].Selected == false)
                {
                    continue;
                }

                items.Add(MessageRepository.FetchByID(messages[i].ID));
            }

            if (action == MemberMessage.Action.MoveToFolder)
            {
                var data = new MessageMoveViewData
                {
                    Messages = items
                };

                return View("move", data);
            }

            return new MessageDownloadResult(Identity.ID, items, action);
        }

        MessageRepository.Update(messages, action);

        return Url<MessageController>(c => c.Index(null, null, null, null)).Redirect();
    } 
```

# c# - unmanaged.dll.manifest 文件有什么用途？

> ID：348877
> 
> 赞同：2
> 
> 时间：2008-12-08T07:54:38.763
> 
> 标签：c#, assemblies, unmanaged

我观察到带有 unmanaged.dll.manifest 文件标记的 unmanaged.dll 文件。在编辑器中打开这些文件时，它似乎是正常的 XML，带有指向某些其他依赖管理的链接？组件。这似乎是最近的变化.. 不记得之前见过他们。

*   为什么需要这些文件？（如果我不得不猜测，那就是加载依赖的托管程序集和/或 CLR）
*   这些文件还包含哪些其他有用的信息？它们是否也包含任何指向相关非托管 dll 的链接（这会很好）

.

```
<assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">
  <trustInfo xmlns="urn:schemas-microsoft-com:asm.v3">
    <security>
      <requestedPrivileges>
        <requestedExecutionLevel level="asInvoker" uiAccess="false"></requestedExecutionLevel>
      </requestedPrivileges>
    </security>
  </trustInfo>
  <dependency>
    <dependentAssembly>
      <assemblyIdentity type="win32" name="Microsoft.VC90.DebugCRT" version="9.0.21022.8" processorArchitecture="x86" publicKeyToken="1fc8b3b9a1e18e3b"></assemblyIdentity>
    </dependentAssembly>
  </dependency>
  <dependency>
    <dependentAssembly>
      <assemblyIdentity type="win32" name="Microsoft.VC90.DebugMFC" version="9.0.21022.8" processorArchitecture="x86" publicKeyToken="1fc8b3b9a1e18e3b"></assemblyIdentity>
    </dependentAssembly>
  </dependency>
</assembly> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-08T09:57:19.297

您所看到的称为“[并行程序集](http://msdn.microsoft.com/en-us/library/aa376307.aspx)”（SxS）。Microsoft 已将 .NET 并行机制扩展到非托管 DLL，现在称它们为“平台程序集”。现在通过清单加载 DLL，而不是通过 DLL 名称执行链接。.NET GAC 的等价物是文件夹 \windows\WinSxS；这允许在一个系统上同时安装多个版本的 DLL，并且不同的应用程序可以绑定同一个 DLL 的不同版本。它还包括 .NET 提供的重定向功能；这主要是清单所做的（允许重定向）。

清单中引用的 DLL（例如 Microsoft.VC90.DebugCRT）也是非托管的（即本机代码）

应用程序清单也有其他用途。我不知道细节，但记得 XP 中的主题选择也显示在清单中。

# sql-server - 在 MS SQL Server 2005 中获取日期的周数？

> ID：348880
> 
> 赞同：13
> 
> 时间：2008-12-08T07:55:34.783
> 
> 标签：sql-server, tsql

是否可以创建一个选择周数（不是星期几 - 或一周中的天数）的 sql 语句。我正在创建一个视图来选择这个额外的信息以及其他几个字段，因此不能使用存储过程。我知道可以创建一个 UDF 来解决这个问题，但如果可能的话，我宁愿只向这个数据库添加一个视图，而不是视图和函数。

有任何想法吗？我也是从哪里来的，一周从星期一开始，第一周是一年中的第一周，至少有 4 天。

### 有关的：

> [如何计算给定日期的周数？](https://stackoverflow.com/questions/274861/how-do-i-calculate-the-week-number-given-a-date)

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-12-08T08:44:34.543

请注意，正确的周数会有所不同，具体取决于文化。周数取决于几个不同国家/地区的假设，请参阅[有关此事的 Wikipedia 文章](http://en.wikipedia.org/wiki/Week#Week_number)。有适用于周数的[ISO 标准(ISO 8601)。](http://en.wikipedia.org/wiki/ISO_week_date)

SQL server 集成`DATEPART()`功能不一定做正确的事。SQL Server 假定第 1 周的第 1 天是 1 月 1 日，对于许多应用程序来说这是错误的。

正确计算周数并非易事，可以在网上找到不同的实现。例如，有一个 UDF 可以计算[1930-2030 的 ISO 周数](http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=60510)，这是其中之一。你必须检查什么对你有用。

这个来自[在线图书](https://msdn.microsoft.com/library/ms186755.aspx#sectionToggle8)（尽管您可能想使用[Jonas Lincoln 的答案](https://stackoverflow.com/a/348945/18771)中的那个，但 BOL 版本似乎不正确）：

```
CREATE FUNCTION ISOweek  (@DATE DATETIME)
RETURNS INT
AS
BEGIN
   DECLARE @ISOweek INT
   SET @ISOweek = DATEPART(wk,@DATE) 
                  +1 
                  -DATEPART(wk,CAST(DATEPART(yy,@DATE) AS CHAR(4))+'0104')
   -- Special cases: Jan 1-3 may belong to the previous year
   IF (@ISOweek=0)
      SET @ISOweek = dbo.ISOweek(CAST(DATEPART(yy,@DATE) - 1
                     AS CHAR(4))+'12'+ CAST(24+DATEPART(DAY,@DATE) AS CHAR(2)))+1
   -- Special case: Dec 29-31 may belong to the next year
   IF ((DATEPART(mm,@DATE)=12) AND
      ((DATEPART(dd,@DATE)-DATEPART(dw,@DATE))>= 28))
      SET @ISOweek=1
   RETURN(@ISOweek)
END
GO 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-12-08T08:52:31.610

你需要 ISO 周。从[http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=60510](http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=60510)，这是一个实现：

```
drop function dbo.F_ISO_WEEK_OF_YEAR
go
create function dbo.F_ISO_WEEK_OF_YEAR
    (
    @Date   datetime
    )
returns     int
as
/*
Function F_ISO_WEEK_OF_YEAR returns the
ISO 8601 week of the year for the date passed.
*/
begin

declare @WeekOfYear     int

select
    -- Compute week of year as (days since start of year/7)+1
    -- Division by 7 gives whole weeks since start of year.
    -- Adding 1 starts week number at 1, instead of zero.
    @WeekOfYear =
    (datediff(dd,
    -- Case finds start of year
    case
    when    NextYrStart <= @date
    then    NextYrStart
    when    CurrYrStart <= @date
    then    CurrYrStart
    else    PriorYrStart
    end,@date)/7)+1
from
    (
    select
        -- First day of first week of prior year
        PriorYrStart =
        dateadd(dd,(datediff(dd,-53690,dateadd(yy,-1,aa.Jan4))/7)*7,-53690),
        -- First day of first week of current year
        CurrYrStart =
        dateadd(dd,(datediff(dd,-53690,aa.Jan4)/7)*7,-53690),
        -- First day of first week of next year
        NextYrStart =
        dateadd(dd,(datediff(dd,-53690,dateadd(yy,1,aa.Jan4))/7)*7,-53690)
    from
        (
        select
            --Find Jan 4 for the year of the input date
            Jan4    = 
            dateadd(dd,3,dateadd(yy,datediff(yy,0,@date),0))
        ) aa
    ) a

return @WeekOfYear

end
go 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-08T08:06:20.690

看起来[DATEPART mssql 函数](http://doc.ddart.net/mssql/sql70/da-db_8.htm)应该可以帮助您...

```
DATEPART(wk, ‘Jan 1, xxxx’) = 1 
```

好吧，我会......原来有一种方法可以设置一周的第一天，[DATEFIRST](http://msdn.microsoft.com/en-us/library/ms181598.aspx)

```
SET DATEFIRST 1 -- for monday 
```

**更新**：现在我更好地理解了 OP 想要什么......这是自定义逻辑。我不认为 MSSQL 会有如此丰富的自定义功能。但我可能是错的......我认为你必须在这里推出你自己的UDF......对不起

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-12-09T12:58:36.447

忘记其他答案

问题指定“**一周从星期一开始，第 1 周是一年中的第一周，至少有 4 天。** ”这是**ISO 8601 标准**以及此答案提供的内容。此功能用于我们网站的生产。

这就是你所需要的：

```
CREATE FUNCTION ISOweek  (@DATE DATETIME)
RETURNS INT
AS
BEGIN
    RETURN (datepart(DY, datediff(d, 0, @DATE) / 7 * 7 + 3)+6) / 7
END
GO 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-08T08:07:08.443

这将返回您在引号中输入的日期的周数

```
SELECT DATEPART( wk, 'enter the date over here' ) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-08T08:37:08.787

看起来 datepart 会让你在其中的一部分，但你必须根据给定年份的 1 月 1 日的星期几进行调整以获得正确的周数。我对 T-SQL 不够熟悉，无法做到这一点，但应该可以。可惜没有[MySQL中的模式参数](http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html#function_week)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-08T10:04:43.727

您是否考虑过使用 WEEK 功能？

这将为您提供指定日期的一年中的一周。

```
SELECT { fn WEEK(GETDATE()) } AS WeekNumber, { fn WEEK(CONVERT(DATETIME, '2008-01-01 00:00:00', 102)) } AS FirstWeekOfYear, { fn WEEK(CONVERT(DATETIME, '2008-12-31 00:00:00', 102)) } AS LastWeekOfYear 
```

这将输出以下 SQL2000 和 SQL2005：

*   周数：50
*   第一周：1
*   去年最后一周：53

我希望这有帮助 ：）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-08-10T23:53:55.707

为什么再一次，人们用鼹鼠山造山，这让我感到震惊？

很简单...

```
select DATEPART(wk, GETDATE()) 
```

# .net - 如何查看 .NET 程序的动态调用图的可视化？

> ID：348881
> 
> 赞同：5
> 
> 时间：2008-12-08T07:56:32.223
> 
> 标签：.net, visualization, profiling, call-graph

**是否有用于可视化动态调用图的工具？**我看到了对 Visual Basic 6 的一个参考，但我想要一个用于 .NET 的参考。

**如果我必须自己构建一个可视化器，我应该使用*.NET 分析 API还是应该使用**Mono.Cecil*做一些事情？**我开始使用 Cecil 编写 CLI 运行时，但我想如果我只是在程序集中注入调用图记录调用会更容易，尽管因为我不提前知道执行路线并且必须检测所有内容。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-08T08:26:04.583

也许 CodePlex 上的这个开源项目可以作为起点：

**序列可视化**

[http://www.codeplex.com/sequenceviz](http://www.codeplex.com/sequenceviz)

*“SequenceViz 是一种通过对 .NET 程序集进行逆向工程来生成序列图的工具。虽然它在以后的版本中做得更多。”*

有一个独立版本和一个作为反射器插件的实现。

[替代文本 http://i3.codeplex.com/Project/Download/FileDownload.aspx?ProjectName=sequenceviz&DownloadId=44432](http://i3.codeplex.com/Project/Download/FileDownload.aspx?ProjectName=sequenceviz&DownloadId=44432)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T08:35:09.913

分析 CLR 是 .NET Profiling API 的用途，因此它似乎非常适合您的需要。大多数分析器产品都基于它。但是你必须编写非托管代码，urk。

如果您只想记录方法的进入/退出，也可以使用 Cecil，而且非常简单。

编辑：

好吧，[PostSharp](https://www.postsharp.net/)可能是最好的解决方案，因为它允许您通过依赖静态编织来处理这样的需求。与使用 Cecil 直接重写 IL 相比，AOP 提供了更好的抽象级别。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-08T09:01:05.963

您可以使用[**NProf**](http://nprof.sourceforge.net/Site/Description.html)，这是 Sourceforge 上的一个开源项目。它允许您**使用新的可视化工具扩展默认 GUI**。

*“nprof 不仅被设计为一个成熟的 .NET 应用程序探查器，而且还是一个完整的 API，可用于构建其他探查器前端，以及使用新的可视化工具扩展默认 GUI。”*

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-07T22:52:00.530

我喜欢[CLR Profiler。](http://msdn.microsoft.com/en-us/library/ms979205.aspx)我不会通过在此处复制文档来浪费空间，但听起来这正是您正在寻找的。

# asp.net - 如何设计用于授权和认证的数据库

> ID：348892
> 
> 赞同：3
> 
> 时间：2008-12-08T08:04:41.943
> 
> 标签：asp.net, database-design, authentication, authorization

我通常在我的项目中使用这些代码：

```
If user.IsInRole("Admin") Then 
  deleteButton.Visible = True 
else 
  deleteButton.Visible = False 
```

但我想控制角色，可以在数据库中看到这个按钮。

为此，数据库设计应该如何？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T08:11:20.430

使设计随心所欲，但在 ASP.NET 端实现您自己的 MembershipProvider。这会将您的数据库设计转换为 .NET 可以使用的用户/角色。之后，您可以像往常一样使用它 - 使用`user.isInRole("Admin")`:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-10-25T10:23:56.740

LDAP 是授权和身份验证的最佳选择。您可以将 openLDAP API 用于相同目的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T08:38:25.463

好吧，一种设计是有如下表格：

```
User(UserID, ...) PK = UserID

Role(RoleID, RoleName, ...) PK = RoleID

UserHasRole(UserHasRoleID, UserID, RoleID) PK=UserHasRoleID ; Unique= (UserID, RoleID) 
```

这是一种方法。这是一个基于角色的系统，而不是一个基于对象的自主授权系统（在自主系统中，您可以为每个对象设置权限，例如此用户 x 具有客户的 DELETE 权限，或类似的东西）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T08:46:48.877

也许我应该更清楚，但我不知道如何:)。我会再试一次。

例如，我将以下代码用于删除按钮：

```
if user.isInRole("Admin") then 
  deleteButton.visible = true 
else 
  deleteButton.visible = false 
```

总的来说，决定用户具有“版主”角色的也应该看到删除按钮。所以我应该像这样更改我的代码：

```
if user.isInRole("Admin","Moderator") then 
  deleteButton.visible = true 
else 
  deleteButton.visible = false 
```

如果我有一个数据库设计来控制它，我不需要更改我的代码。

嗯，应该怎么样？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-10-25T10:40:36.213

代码：

```
public class YourSqlRoleProvider : System.Web.Security.RoleProvider
{
    private string ConnectionString { get; set; }

    public override void AddUsersToRoles(string[] userNames, string[] roleNames)
    {
        // logic here
    }

    public override string ApplicationName
    {
        get
        {
            throw new NotSupportedException();
        }
        set
        {
            throw new NotSupportedException();
        }
    }

    public override void CreateRole(string roleName)
    {
        throw new NotSupportedException();
    }

    public override bool DeleteRole(string roleName, bool throwOnPopulatedRole)
    {
        throw new NotSupportedException();
    }

    public override string[] FindUsersInRole(string roleName, string userNameToMatch)
    {
        throw new NotSupportedException();
    }

    public override string[] GetAllRoles()
    {
        // logic here
    }

    public override string[] GetRolesForUser(string userName)
    {
        // logic here
    }

    public override string[] GetUsersInRole(string roleName)
    {
        throw new NotSupportedException();
    }

    public override bool IsUserInRole(string userName, string roleName)
    {
        return GetRolesForUser(userName).Contains(roleName);
    }

    public override void Initialize(string name, System.Collections.Specialized.NameValueCollection config)
    {
        this.ConnectionString = ConfigurationManager.ConnectionStrings[config["connectionStringName"]].ConnectionString;

        base.Initialize(name, config);
    }

    public override void RemoveUsersFromRoles(string[] userNames, string[] roleNames)
    {
        throw new NotSupportedException();
    }

    public override bool RoleExists(string roleName)
    {
        throw new NotSupportedException();
    }
} 
```

网络配置：

```
<?xml version="1.0" encoding="utf-8"?>
<configuration>
    <connectionStrings>
        <clear />
        <add name="YourConnectionString" providerName="System.Data.SqlClient" connectionString="connection string here" />
    </connectionStrings>
    <system.web>
        <roleManager defaultProvider="YourSqlRoleProvider" enabled="true">
            <providers>
                <clear />
                <add name="YourSqlRoleProvider" type="YourSqlRoleProvider" connectionStringName="YourConnectionString" />
            </providers>
        </roleManager>
    </system.web>
</configuration> 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-12-08T10:17:49.833

假设您使用.NET，一种方法是实现您自己的角色和成员资格提供程序。然后，您可以通过实现一个包含您想要的项目的接口来添加功能（我刚刚把这个示例从我的头顶上敲下来，所以如果它看起来有点粗糙，我深表歉意）：

```
public interface ICustomRole
{
  bool IsInRole(string userName, object[] params roles);
}

public class MyCustomRole : RoleProvider, ICustomRole
{
  public IsInRole(MembershipUser user, object[] params roles)
  {
    if (roles == null || roles.Length == 0)
      throw new ArgumentException("roles");
    // Put your logic here for accessing the roles
  }
} 
```

然后，在您的代码中，您将执行以下操作：

```
bool isValid = ((ICustomRole)Roles.Provider).IsInRole(
  User, new[] { "Admin", "Moderator", "Validator" }); 
```

# c# - 另一个 LINQ Pivot 问题 - 将 SQL 脚本转换为 LINQ

> ID：348900
> 
> 赞同：3
> 
> 时间：2008-12-08T08:09:49.700
> 
> 标签：c#, asp.net, sql, linq, pivot

已经有一些关于 LINQ 枢轴的问题，虽然其中一些概述了我的确切问题，但我无法成功地将它们转化为有效的解决方案。我觉得这主要是由于我的表中的加入。

因此，为了所有热爱问题的 LINQ 爱好者的利益，这里有另一个难题供您解决。请通过将以下 SQL 存储的 proc 脚本转换为 LINQ 来帮助我（并赢得一些声誉积分和我的尊重）：

```
ALTER PROCEDURE [dbo].[GetTimesheetForWeekById]
    @timesheetid int,
    @begindate VarChar(20),
    @enddate VarChar(20)
AS
BEGIN

    SELECT T.TaskName,
        SUM(
            case DATEPART(weekday, TE.StartTime)
                WHEN 1 THEN DATEDIFF(minute, TE.StartTime, TE.EndTime) ELSE 0 END
            ) AS Sunday,
        SUM(
            case DATEPART(weekday, TE.StartTime)
                when 2 THEN DATEDIFF(minute, TE.StartTime, TE.EndTime) ELSE 0 END
            ) AS Monday,
        SUM(
            case DATEPART(weekday, TE.StartTime)
                when 3 THEN DATEDIFF(minute, TE.StartTime, TE.EndTime) ELSE 0 END
            ) AS Tuesday,
        SUM(
            case DATEPART(weekday, TE.StartTime)
                when 4 THEN DATEDIFF(minute, TE.StartTime, TE.EndTime) ELSE 0 END
            ) AS Wednesday,
        SUM(
            case DATEPART(weekday, TE.StartTime)
                when 5 THEN DATEDIFF(minute, TE.StartTime, TE.EndTime) ELSE 0 END
            ) AS Thursday,
        SUM(
            case DATEPART(weekday, TE.StartTime)
                when 6 THEN DATEDIFF(minute, TE.StartTime, TE.EndTime) ELSE 0 END
            ) AS Friday,
        SUM(
            case DATEPART(weekday, TE.StartTime)
                when 6 THEN DATEDIFF(minute, TE.StartTime, TE.EndTime) ELSE 0 END
            ) AS Saturday

    FROM Tasks T
    INNER JOIN TimeEntries TE on T.TaskID = TE.TaskID
    WHERE TE.StartTime BETWEEN 
        (CONVERT(datetime, @begindate, 103)) AND (CONVERT(datetime, @enddate, 103))
    AND TE.TimesheetID = @timesheetid
    GROUP BY T.TaskName
END 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T08:32:30.683

好吧，假设外键具有对象表示形式，例如：

```
 int timesheetId = ...
        DateTime start = ..., end = ...
        var qry = from timeEntry in ctx.TimeEntries
              let date = timeEntry.StartTime.Date
              where timeEntry.TimesheetId == timesheetId
                && date >= start
                && date <= end
              group timeEntry by timeEntry.Task.TaskName into grp
              select new {
                  TaskName = grp.Key,
                  Monday = grp.Where(x => x.StartTime.DayOfWeek == DayOfWeek.Monday).Count(),
                  Tuesday = grp.Where(x => x.StartTime.DayOfWeek == DayOfWeek.Tuesday).Count(),
                  Wednesday = grp.Where(x => x.StartTime.DayOfWeek == DayOfWeek.Wednesday).Count(),
                  Thursday = grp.Where(x => x.StartTime.DayOfWeek == DayOfWeek.Thursday).Count(),
                  Friday = grp.Where(x => x.StartTime.DayOfWeek == DayOfWeek.Friday).Count()
              }; 
```

不幸的是，一些细节取决于 SQL 提供者——即它可以成功映射为 TSQL 的哪些函数（如 DayOfWeek 等）。如果您遇到问题，请告诉我...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-03T03:33:59.077

这是怎么回事（修改马克的）：

```
var qry = from timeEntry in timeEntries
      let date = timeEntry.StartTime.Date
      where timeEntry.TimesheetId == timesheetId
      && date >= start
      && date <= end
      group timeEntry by timeEntry.Task.TaskName into grp
      select new
      {
          TaskName = grp.Key,
          Monday = grp.Where(x => x.StartTime.DayOfWeek == DayOfWeek.Monday)
                   .Sum(x=>x.EndTime.Subtract(x.StartTime).TotalMinutes),
          Tuesday = grp.Where(x => x.StartTime.DayOfWeek == DayOfWeek.Tuesday)
                    .Sum(x => x.EndTime.Subtract(x.StartTime).TotalMinutes),
          Wednesday = grp.Where(x => x.StartTime.DayOfWeek == DayOfWeek.Wednesday)
                      .Sum(x => x.EndTime.Subtract(x.StartTime).TotalMinutes),
          Thursday = grp.Where(x => x.StartTime.DayOfWeek == DayOfWeek.Thursday)
                     .Sum(x => x.EndTime.Subtract(x.StartTime).TotalMinutes),
          Friday = grp.Where(x => x.StartTime.DayOfWeek == DayOfWeek.Friday)
                   .Sum(x => x.EndTime.Subtract(x.StartTime).TotalMinutes),
      }; 
```

# ruby - 从我的 Ruby 应用程序构建 Windows 可执行文件？

> ID：348919
> 
> 赞同：21
> 
> 时间：2008-12-08T08:34:54.453
> 
> 标签：ruby

我希望能够将 Ruby 应用程序发送给一些同事，而无需他们安装 Ruby 解释器。最好使用单个 exe。

我用谷歌搜索并找到了“RubyScript2Exe”。

你对此有什么经验？是否有其他此类工具，或者是否有比构建 exe 更好的方法？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-08T08:40:29.547

我已经使用了大约 3 次，没有遇到任何问题，我在 10 台服务器上运行了其中一个应用程序，从未遇到任何问题。所以，我认为 RubyScript2Exe 和 ruby​​ 一样好。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-08T13:14:06.683

_why 的[Shoes](http://shoooes.net)框架让您可以将程序打包为 Mac 或 Windows 的可执行文件，用于安装 Shoes（包含 Ruby 解释器）。有关使用打包程序的信息[在这里](http://shoooes.net/about/raisins/)。_why 还提供了有关他如何使 Windows 可执行的[提示](http://hackety.org/2008/06/19/stampingExesAndDmgs.html)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-06-06T11:34:29.893

不要忘记 OCRA [1]，我使用了几次并且刚刚工作。如上所述，我曾经使用 RubyScript2Exe 创建我的 exe，但在使用 Ruby 1.9 [2] 时遇到了问题。

[1] [http://ocra.rubyforge.org/](http://ocra.rubyforge.org/)
[2] [http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/343891](http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/343891)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-08T08:50:56.637

还有一个叫做[Crate](http://github.com/copiousfreetime/crate/tree/master)。您可以在[此处](http://rubyconf2008.confreaks.com/crate-packaging-your-ruby-application.html)找到有关它的一些信息。但是我还没有在 Windows 上测试过它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-25T18:05:29.063

很抱歉迟到了，但我在寻找自己尝试做这件事时发现了这个问题（开始越来越多地使用 SO 作为主要资源）。

无论如何，我刚刚在[exerb](http://exerb.sourceforge.jp/index.en.html)上取得了成功，尽管我要补充几点：

*   网页上说 exerb 可以在任何平台上运行。那是真实的; 但是，如果您“编译”程序调用本机代码，那么`exerb`会将您系统的本机代码（例如 Linux`.so`文件）嵌入到 .exe 中。实际上，这意味着您必须在 Windows 上构建任何重要的应用程序。
*   网页也说`ruby -r exerb/mkrbc`，但实际的命令是`ruby -r exerb/mkexy`.

# php - 使用php通过管理员帐户进行成员控制

> ID：348920
> 
> 赞同：1
> 
> 时间：2008-12-08T08:35:00.040
> 
> 标签：php

我是 php 新手。我也在登录页面和adm上进行了会员注册。所以在管理员内部我想获取成员列表并删除我不想要的成员。[因此，我从http://localhost/xamp](http://localhost/xamp)的电话簿示例代码中获取了代码， 并将其编辑为我的要求，我能够检索成员但无法删除成员。请看下面的代码：

```
<?php
    require_once('auth.php');

    require_once('../config.php');

    //Array to store validation errors
    $errmsg_arr = array();

    //Validation error flag
    $errflag = false;

    //Connect to mysql server
    $link = mysql_connect(DB_HOST, DB_USER, DB_PASSWORD);
    if(!$link) {
        die('Failed to connect to server: ' . mysql_error());
    }

    //Select database
    $db = mysql_select_db(DB_DATABASE);
    if(!$db) {
        die("Unable to select database");
    }

?>
<html>
    <head>
        <meta name="author" content="Kai Oswald Seidler">
        <link href="../loginmodule.css" rel="stylesheet" type="text/css">
        <title></title>
    </head>

    <body>
        &nbsp;<p>

        <h2><?php echo "User list"; ?></h2>

        <table border="0" cellpadding="0" cellspacing="0">
            <tr bgcolor="#f87820">
                <td><img src="img/blank.gif" alt="" width="10" height="25"></td>
                <td class="tabhead"><img src="img/blank.gif" alt="" width="150" height="6"><br><b><?php echo $TEXT['phonebook-attrib1']; ?></b></td>
                <td class="tabhead"><img src="img/blank.gif" alt="" width="150" height="6"><br><b><?php echo $TEXT['phonebook-attrib2']; ?></b></td>
                <td class="tabhead"><img src="img/blank.gif" alt="" width="150" height="6"><br><b><?php echo $TEXT['phonebook-attrib3']; ?></b></td>
                <td class="tabhead"><img src="img/blank.gif" alt="" width="50" height="6"><br><b><?php echo $TEXT['phonebook-attrib4']; ?></b></td>
                <td><img src="img/blank.gif" alt="" width="10" height="25"></td>
            </tr>

            <?php
                $firstname=$_REQUEST['firstname'];
                $lastname=$_REQUEST['lastname'];
                $phone=$_REQUEST['phone'];

                if($_REQUEST['action']=="del")
                {
                        $result=mysql_query("DELETE FROM members WHERE member_id={$_REQUEST['member_id']}");
                }

                $result=mysql_query("SELECT member_id,firstname,lastname,login FROM members ORDER BY lastname");
                $i = 0;
                while($row = mysql_fetch_array($result)) {
                    if ($i > 0) {
                        echo "<tr valign='bottom'>";
                        echo "<td bgcolor='#ffffff' height='1' style='background-image:url(img/strichel.gif)' colspan='6'></td>";
                        echo "</tr>";
                    }
                    echo "<tr valign='middle'>";
                    echo "<td class='tabval'><img src='img/blank.gif' alt='' width='10' height='20'></td>";
                    echo "<td class='tabval'><b>".$row['lastname']."</b></td>";
                    echo "<td class='tabval'>".$row['firstname']."&nbsp;</td>";
                    echo "<td class='tabval'>".$row['member_id']."&nbsp;</td>";

                    echo "<td class='tabval'><a onclick=\"return confirm('".$TEXT['userlist-sure']."');\" href='userlist.php?action=del&amp;member_1d=".$row['member_id']."'><span class='red'>[".$TEXT['userlist-button1']."]</span></a></td>";
                    echo "<td class='tabval'></td>";
                    echo "</tr>";
                    $i++;
                }

                echo "<tr valign='bottom'>";
                echo "<td bgcolor='#fb7922' colspan='6'><img src='img/blank.gif' alt='' width='1' height='8'></td>";
                echo "</tr>";

            ?>

        </table>

    </body>
</html> 
```

我没有正确地编辑它和外观。

请帮助我使其也能够删除成员。

我不明白 .$TEXT['userlist-button1'].,'".$TEXT['userlist-sure']. 变量是什么？我还想在表格中为每个成员包含一个已批准和未批准的单选按钮.

我怎样才能做到这一点？

请如果你能帮助我。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T08:46:50.890

1.  这应该是通过 FORM 而不是 href 链接 (GET) 的 POST。
2.  $TEXT 显然是一个包含您要打印的文本的数组。
3.  您需要`&amp;member_1d`用真正的 & 和真正的 i as 替换 href `&member_id`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T08:49:55.267

$TEXT 是一个包含所选语言的所有语言字符串的数组。您会发现 /lang/yourlanguage.php 下定义的字符串

一般来说，这不是开始使用 IMO 编码的一个很好的例子。

但是我认为您的应用程序可能会开始工作，如果您确保语言文件和其他包含文件可用并且您`&amp;`使用 &member_id 更改此 member_1d

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-01-27T22:42:59.223

具有删除链接的成员列表示例：

```
$query = mysql_query("SELECT member_id,firstname,lastname,login FROM members ORDER BY lastname");
if(mysql_num_row($query)!= 0){ //only continue if there are members in the database
while($row = mysql_fetch_assoc($query)){ //loop through each row in the database
$member_id = $row['member_id'];
$firstname = $row['firstname'];
$lastname = $row['lastname'];

echo '<p>' . $firstname . ' -  <a href="delete_member.php?id='$member_id'">' delete '</a></p>';

}
} 
```

delete_member.php 上的一个简单脚本，用于从数据库中删除成员。

```
if(isset($_GET['id'])){
$member_id = $_GET['id'];
$query = mysql_query("DELETE FROM members WHERE member_id='$member_id'");
echo '<p>This user was deleted from database</p>';
} 
```

这段代码只是举个例子的基本代码。

但是，我更喜欢使用简单的表单和 $_POST 来完成类似的事情，而不是使用在这种情况下非常容易受到攻击的 $_GET。

获取成员列表后，使用带有输入字段的表单键入要删除的 id。

# .net - “/DNNTest”应用程序中的服务器错误

> ID：348928
> 
> 赞同：1
> 
> 时间：2008-12-08T08:38:54.570
> 
> 标签：.net, asp.net, .net-2.0, web-config, dotnetnuke

解析器错误消息：已添加条目“SiteSqlServer”。

源错误：

> ```
> Line 23: providerName="System.Data.SqlClient"/> -->
> 
> Line 24: < ! -- Connection String for SQL Server 2000/2005 -->
> 
> Line 25: <add name="SiteSqlServer" connectionString="Server=(local); 
> ```
> 
> abase=DotNetNuke2；uid=nukeuser;pwd=dotnetnuke;" providerName="System.Data.SqlClient" //
> 
> ```
> Line 26: </connectionStrings>
> 
> Line 27: <appSettings> 
> ```

有谁知道周围的工作？？？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T08:50:52.863

您的 web.config 文件中似乎有两个名为“SiteSqlServer”的连接字符串。您可以发布配置文件的完整部分吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-09T06:34:35.227

这是我昨天为解决我的问题而遵循的工作：

如果站点根目录中有一个应用程序已经定义了“SiteSqlServer”键，那么这就是您收到错误的原因。

您可以尝试将 connectionString 部分更改为如下所示：

```
<connectionStrings>

<remove name="SiteSqlServer" />

<add name="SiteSqlServer" connectionString="server=(local);uid=;pwd=;Trusted_Connection=yes;database=communityserver" />

</connectionStrings> 
```

删除旧密钥，然后添加新密钥。

您可以尝试清除 web.config 中同一部分中第一行的连接字符串。

```
<connectionStrings>
<clear /> 
```

...

这有效地防止了继承的连接。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T12:46:30.093

也许 dotnetnuke 论坛中的这篇文章有帮助：

[已添加条目“SiteSqlServer”](http://www.dotnetnuke.com/Community/Forums/tabid/795/forumid/107/threadid/12256/scope/posts/threadpage/2/Default.aspx)

# .net - 多个调度程序问题

> ID：348934
> 
> 赞同：1
> 
> 时间：2008-12-08T08:41:59.870
> 
> 标签：.net, wpf, vb.net, multithreading

我有以下问题：多线程 WPF 应用程序，模型视图演示器实现。属于一起的 Presenters 和 Views 是由工厂在单独的线程上创建的，并且应该获得单独的 Dispatcher。

```
Public Function CreatePresenter(Of T As {New, Class})(ByVal p_eCreationOptions As eViewCreationOptions) As T Implements IPresenterFactory.CreatePresenter

    Select Case p_eCreationOptions
        Case eViewCreationOptions.CreateInCallingThread
            CreatePresenter(Of T)()
        Case eViewCreationOptions.CreateInNewThread
            Dim oThread As New Thread(New ThreadStart(AddressOf CreatePresenter(Of T)))
            oThread.SetApartmentState(System.Threading.ApartmentState.STA)
            oThread.Start()
            oThread.Join()
        Case Else
            Throw New InvalidOperationException("Need to specify creation options.")
    End Select

    Return CType(m_oCreatedPresenter, T)

End Function

Private Sub CreatePresenter(Of T As {New, Class})()
    m_oCreatedPresenter = Activator.CreateInstance(Of T)()
End Sub 
```

问题是，现在演示者是在另一个线程上创建的，并且线程在创建后进入休眠状态，但那里的调度程序尚未运行。现在，如果我来自应用程序所在的主 UI 线程并调用我的演示者，我将创建视图并显示它，现在只有我可以调用 Dispatcher.Run()。

```
Public Overloads Sub Show()
    Console.WriteLine ("Show Caller ThreadID = " & Thread.CurrentThread.ManagedThreadId)
    MyBase.Show()
    System.Windows.Threading.Dispatcher.Run()
End Sub 
```

但是我想要做的是，当演示者上的方法从演示者所在的另一个线程调用时，在演示者拥有自己的调度程序的线程上再次调用该方法，这样我就不需要在我的 Presenter 和视图之间的调用中处理 Dispatcher。这有可能吗，我的设计有缺陷还是有更好的方法来实现我想要的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-13T22:36:20.363

问题是当新线程上没有实例化 DispatcherObject 时，Dispatcher 不会启动，但是如果您实例化一个虚拟对象然后调用您的演示者的方法，则调度程序将正常运行。例如

```
 private void ThreadStartingPoint()  
 {  
     var dummyDispatcherObject = new Style();  
     Dispatcher.CurrentDispatcher.BeginInvoke(DispatcherPriority.Normal, new Action(CreatePresenterInternal));  
     Dispatcher.Run();  
} 
```

可以在我的[博客](http://www.philippbraun.net/2008/12/handling-multiple-dispatchers-in-wpf.html)上找到对此的完整解决方案。

# couchdb - 最终一致性

> ID：348939
> 
> 赞同：20
> 
> 时间：2008-12-08T08:45:36.383
> 
> 标签：couchdb, amazon-simpledb, eventual-consistency

我正处于设计必须具有高可用性和可扩展性的应用程序的早期阶段。出于多种原因，我想为此使用最终一致性数据模型。我知道并理解为什么对于许多解决方案来说这是一个不受欢迎的架构选择，但在我的情况下它很重要。

我正在寻找现实世界的建议、最佳实践和在处理分布式/文档式数据库时要注意的问题。尤其是围绕电子商务（购物车风格）应用程序的领域，这些应用程序传统上更容易与关系数据库组合在一起。

我知道使用这些类型的数据库具有挑战性，但是，嘿，谷歌和 E-bay 使用它们，所以它们不会那么难；-) 任何建议都将不胜感激。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-04T15:55:18.343

如果你想拥有一个分布式系统（即“最终一致性”的东西），你需要人来构建、维护和操作它。

我发现有三类人对“最终一致性”的问题很少：

*   在分布式系统方面有扎实背景的人。他们已经了解了最终一致性[拜占庭失败之](http://en.wikipedia.org/wiki/Byzantine_Fault_Tolerance)类的东西。如果您了解[Paxos](http://en.wikipedia.org/wiki/Paxos_algorithm)与假期无关，那么您可能就是其中之一。
*   有网络编程经验的人。他们可能会错过理论背景，但对异步和“无全局时钟和计数器”范式有直观的理解。如果你拥有至少 8 本书[理查德史蒂文斯](http://www.kohala.com/start/)你可能是其中之一。
*   非常有经验的编码人员，几乎没有接触过 RDBMS。内核人员，来自科学计算和游戏行业的人浮现在脑海中。

总而言之，这些人在就业市场上很受追捧。例如，75% 左右的分布式系统学者离开了运行大型、自行设计的分布式系统的机构，例如证券交易所。

借助 Hardoop、SimpleDB 和 CouchDB 等产品，整个事情变得更加简单，但在分布式系统技术上构建一些东西仍然是一个巨大的挑战。

另一方面，RDBMS 是一个非常好的工程。他们广为人知，他们的专业知识可在就业市场上获得。有很多不错的工具、教育机会和许多高技能的专家可以按小时租用。因此，请三思而后行，您无法继续使用 RDBMS 方法——也许再加上一些巧妙的作弊。我通常会向学生[介绍 Lifejournal 架构](http://highscalability.com/livejournal-architecture)。

对于分布式数据库，经验要少得多。这正是您迄今为止发现的建议如此之少的原因。

如果您决心使用“最终一致性”，我认为除了不成熟的工具之外，主要挑战是每个相关人员的心态。您的 API 用户（编码人员）和应用程序用户（您的员工和客户）是否愿意并且能够接受这种不一致？您可以对某些类别的用户隐藏它吗？我们不习惯计算机不一致的心态。有货或没有货。“也许”不是用户期望的答案。

还要记住，“最终”对算法设计者来说可能意味着很长一段时间。你能接受多长时间的不一致？

对于购物车应用程序，您可能希望真正实现分布式：使用客户端浏览器作为数据存储。在结帐时，您可以将购物车提交到服务器端批处理系统。这意味着对于目录，您需要只读高可用性（更容易），并且购物车提交是一个非常狭窄的界面，不需要交易。稍后处理订单没有（软）实时要求，因此更容易。

顺便说一句：上次我检查 E-Bay 架构时，它们在 RDBMS 中的位置很大，但从那时起它可能已经发生了变化。（**编辑：**它确实改变了 - 见评论）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2014-05-22T20:32:29.303

解决您的问题的唯一方法是确定[CAP 定理](http://en.wikipedia.org/wiki/CAP_theorem)中的哪些权衡适合您，然后开始实施它。

mdorseif 有一个很好的观点。有许多配置可以在多大程度上权衡一致性、可用性和分区。您有两个主要选择。

1.  走内部分布式系统的路线（需要大量专业知识和研究）
2.  审查和试验许多分布式数据库，以确定什么可以满足您的规模要求。

这可能过于简单化了。真正的生产就绪管道是一个生态系统。它至少会让你走上正轨。

[Appnexus](http://appnexus.com/)是一个使用[hbase](https://hbase.apache.org/)实现非常高可用性和最终一致性的广告平台。[他们在这里](https://www.youtube.com/watch?v=N5JY2E52fg4&noredirect=1)谈了很多。

[http://highscaleability.com](http://highscaleability.com)上的一篇[文章](http://highscalability.com/blog/2014/1/13/nytimes-architecture-no-head-no-master-no-single-point-of-fa.html)概述了《纽约时报》如何在 WAN 上实现[RabbitMQ](http://www.rabbitmq.com/)和[Cassandra](http://cassandra.apache.org/)以实现容错和高可用性。

[MongoDB](http://www.mongodb.org/)在平衡一致性和可用性以及写入问题的实现方面提供了很大的灵活性。他们有优秀的[文档](http://docs.mongodb.org/master/MongoDB-sharding-guide.pdf)，准确地强调了如何使用所有的陷阱（包括分区）来实现它。他们实现了[两阶段提交](http://en.wikipedia.org/wiki/Two-phase_commit_protocol)来维护整个网络的状态（在他们的配置服务器上）。

谷歌在这个主题上有一篇很棒的论文，他们的[光子](http://static.googleusercontent.com/media/research.google.com/en/us/pubs/archive/41318.pdf)项目实现了一个高度可扩展、高度可靠的系统，其[核心是 paxos 算法](http://en.wikipedia.org/wiki/Paxos_algorithm)以及其他一些技术。它也恰好是非常一致的（端到端延迟约为 10 秒）和容错性，能够承受区域故障。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-05-17T12:34:19.687

所有建立在分布式计算模型上的系统都建立在 CAP 和 BASE 之上。这里主要关注的是，如果我们的系统提供可用性和分区容错性，我们就不能拥有真正的一致性，但我们可以拥有最终的一致性。

最终一致性背后的想法是每个节点始终可用于服务请求。作为权衡，数据修改在后台传播到其他节点。这意味着系统在任何时候都可能不一致，但数据在很大程度上仍然是准确的。

资料来源：[http ://www.techspritz.com/eventual-consistency-and-base-model/](http://www.techspritz.com/eventual-consistency-and-base-model/)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-12-08T09:08:03.187

如何使用关系数据库实现高可用性和可扩展性是众所周知的，并且有大量关于如何做到这一点的知识！

谷歌是一个特例，它不适用于大多数网站，查询量非常大，数据量非常大，最重要的是，它的大多数用户都没有服务水平协议。网络搜索没有正确的答案，只有更好的答案，对于普通用户来说，谷歌已经足够好了，如果谷歌错过了搜索列表中的重要页面，你作为用户就不能抱怨。

E-Bay 是一个相当不同的例子，他们以某种方式说服用户和客户接受低劣的服务以换取理论上更低的价格——这对他们来说很好，但这并不是每个企业都可以选择的。

# c++ - 如何解决：“错误 C2039：'{ctor}'：不是 Visual Studio 2005 中的成员”？

> ID：348953
> 
> 赞同：3
> 
> 时间：2008-12-08T08:59:29.740
> 
> 标签：c++, visual-studio-2005, templates, class-design, visual-c++-2005

我在 Visual Studio 2005 中使用 C++ 扩展模板类。当我尝试使用以下方法扩展模板基类时，它给了我一个错误：

```
template <class K, class D>
class RedBlackTreeOGL : public RedBlackTree<K, D>::RedBlackTree  // Error 1
{
 public:
  RedBlackTreeOGL();
  ~RedBlackTreeOGL(); 
```

当我尝试实例化对象时出现第二个错误：

```
RedBlackTreeOGL<double, std::string> *tree = new RedBlackTreeOGL<double, std::string>; // error 2 
```

**错误一：**

**redblacktreeopengl.hpp(27) : error C2039: '{ctor}' : is not a member of 'RedBlackTree' with [ K=double, D=std::string ] **

**错误2：**

main.cpp(50) : 请参阅正在编译的类模板实例化“RedBlackTreeOGL”的参考

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-08T09:14:04.017

该代码试图继承一个构造函数，而不是一个类:-)

类声明的开始应该是

```
template <class K, class D>
class RedBlackTreeOGL : public RedBlackTree<K, D> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T09:23:33.717

我的天啊，我觉得好傻.....看我自己的代码太久了！

那是一件非常基本的事情，我不知道我是怎么错过的！

谢谢詹姆斯（和 SDX2000），这是通过将声明末尾的“构造函数”从詹姆斯所说的内容中取出来实现的。

谢谢 ：）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-08T09:02:16.100

`RedBlackTree<K, D>::RedBlackTree`有默认构造函数吗？如果您有其他参数化构造函数（ctors），C++ 本身不会定义默认构造函数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T09:10:07.317

**@SDX2000：**

是的，我在 RedBlackTree::RedBlackTree 中定义了一个构造函数：

```
template <class K, class D>
class RedBlackTree
    {
    public:
        RedBlackTree();
        // Deleting a storage object clears all remaining nodes
        ~RedBlackTree(); 
```

我还为 RedBlackTree 类的构造函数和析构函数实现了一个主体

# algorithm - 识别网页物理地址的算法

> ID：348958
> 
> 赞同：6
> 
> 时间：2008-12-08T09:06:36.887
> 
> 标签：algorithm, screen-scraping, nlp, pattern-matching, named-entity-recognition

识别 HTML 页面上的结构化数据的最佳算法是什么？

例如，Google 会识别电子邮件中的家庭/公司地址，并提供该地址的地图。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-08T11:59:09.940

诸如[GATE](http://gate.ac.uk/)之类的命名实体提取框架至少解决了位置的[信息提取问题](http://gate.ac.uk/ie/index.html)，并辅以已知地点的地名录来帮助解决常见问题。除非页面是从公共来源机器生成的，否则您会发现正则表达式对于这项工作来说有点弱。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-08T12:07:39.080

如果你有正确的标记——而不仅仅是页面上的文本——我支持上面的 Beautiful Soup 建议。特别是，[地址标签](http://www.w3schools.com/TAGS/tag_address.asp)应提供最低的低垂果实。还要查看[adr 微格式](http://microformats.org/wiki/adr)。如果前两个没有提取足够的信息或者我没有必要的数据来查找前两个，我只会退回到正则表达式。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-08T09:23:38.397

如果您还必须处理国际地址，那么您将进入一个令人头疼的世界；[国际地址格式](http://www.bitboost.com/ref/international-address-formats.html)千差万别。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-08T11:34:10.787

我猜谷歌对这个问题采取了两步走的方法（至少我会这样做）。首先，他们使用一些相当通用的搜索模式来挑选可能是地址的所有内容，然后他们使用他们的地图数据库查找该字符串并查看是否有任何匹配项。如果他们这样做，它可能是一个地址，如果他们不这样做，它可能不是。如果您可以在代码中使用地图数据库，那可能会让您的生活更轻松。

除非您可以限制地址的地理位置，否则我猜想仅通过解析将字符串识别为地址几乎是不可能的，这仅仅是因为世界各地使用的地址格式存在巨大差异。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-08T10:16:13.360

不要使用正则表达式。使用现有的 HTML 解析器，例如在 Python 中我强烈推荐[BeautifulSoup](http://www.crummy.com/software/BeautifulSoup/)。即使您使用正则表达式来解析 BeautifulSoup 抓取的 HTML 元素。

如果你用自己的正则表达式来做，你不仅要担心找到你需要的数据，你还要担心无效的 HTML 之类的事情，以及许多其他你会偶然发现的非常不明显的问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-08T10:06:34.707

如果你想让它变得完美，你所问的确实是一个相当困难的问题。虽然一个简单的正则表达式在大多数情况下大部分时间都是正确的，但编写一个每次都能完全正确的正则表达式非常困难。有很多奇怪的极端案例，在某些情况下，没有一个明确的答案。我见过的大多数网站在处理除了最简单的 URL 之外的所有内容都做得很糟糕。

如果你想走正则表达式路线，最好的办法可能是查看 [http://metacpan.org/pod/Regexp::Common::URI::http的源代码](http://metacpan.org/pod/Regexp::Common::URI::http)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-08T09:56:26.443

同样，正则表达式应该可以解决问题。

由于地址种类繁多，您只能通过“（数字），（名称）街道|大道|主”等表达式来猜测字符串是否为地址

您可以考虑查看一些 Firefox 扩展，这些扩展旨在映射在文本中找到的地址，以了解它们是如何工作的

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-05-20T05:23:27.260

您可以查看这个美国提取示例[http://code.google.com/p/graph-expression/wiki/USAAddressExtraction](http://code.google.com/p/graph-expression/wiki/USAAddressExtraction)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-07-27T14:14:09.873

1.  这取决于您的要求。

对于电子邮件和联系方式，正则表达式绰绰有余。对于地址，单独的正则表达式将无济于事。想想 NLP(NER) 和 POS 标记。要查找与人相关的信息，如果没有 NER，您将无法做任何事情。

*   If you need information like paragraphs get the contents by using tags.

# c# - 如何在 C# 中的自定义对象上使用 foreach 关键字

> ID：348964
> 
> 赞同：25
> 
> 时间：2008-12-08T09:09:03.230
> 
> 标签：c#, foreach

有人可以分享一个将`foreach`关键字与自定义对象一起使用的简单示例吗？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-12-08T09:17:23.747

鉴于标签，我假设您的意思是 .NET - 我将选择谈论 C#，因为这就是我所知道的。

该`foreach`语句（通常）使用`IEnumerable`and`IEnumerator`或它们的通用表亲。表格声明：

```
foreach (Foo element in source)
{
    // Body
} 
```

其中`source`implements`IEnumerable<Foo>`大致*相当于*：

```
using (IEnumerator<Foo> iterator = source.GetEnumerator())
{
    Foo element;
    while (iterator.MoveNext())
    {
        element = iterator.Current;
        // Body
    }
} 
```

请注意，`IEnumerator<Foo>`在末尾设置了，但是该语句退出了。这对于迭代器块很重要。

要自己实现`IEnumerable<T>`，`IEnumerator<T>`最简单的方法是使用迭代器块。与其在这里写下所有的细节，不如直接参考[C# in Depth 的第 6 章](http://www.manning.com/skeet)，这是免费下载的。第 6 章的全部内容都是关于迭代器的。我的 C# in Depth 站点上还有几篇文章：

*   [迭代器、迭代器块和数据管道](http://csharpindepth.com/Articles/Chapter11/StreamingAndIterators.aspx)
*   [迭代器块实现细节](http://csharpindepth.com/Articles/Chapter6/IteratorBlockImplementation.aspx)

作为一个简单的例子：

```
public IEnumerable<int> EvenNumbers0To10()
{
    for (int i=0; i <= 10; i += 2)
    {
        yield return i;
    }
}

// Later
foreach (int x in EvenNumbers0To10())
{
    Console.WriteLine(x); // 0, 2, 4, 6, 8, 10
} 
```

要实现`IEnumerable<T>`一种类型，您可以执行以下操作：

```
public class Foo : IEnumerable<string>
{
    public IEnumerator<string> GetEnumerator()
    {
        yield return "x";
        yield return "y";
    }

    // Explicit interface implementation for nongeneric interface
    IEnumerator IEnumerable.GetEnumerator()
    {
        return GetEnumerator(); // Just return the generic version
    }
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-08T09:20:18.887

（我在这里假设 C#）

如果您有一个自定义对象列表，您可以像使用任何其他对象一样使用 foreach：

```
List<MyObject> myObjects = // something
foreach(MyObject myObject in myObjects)
{
     // Do something nifty here
} 
```

如果您想创建自己的容器，您可以使用 yield 关键字（我相信来自 .Net 2.0 及更高版本）和 IEnumerable 接口。

```
class MyContainer : IEnumerable<int>
{
    private int max = 0;
    public MyContainer(int max)
    {
        this.max = max;
    }

    public IEnumerator<int> GetEnumerator()
    {
        for(int i = 0; i < max; ++i)
            yield return i;
    }

    IEnumerator IEnumerable.GetEnumerator()
    {
        return GetEnumerator();
    }
} 
```

然后将它与 foreach 一起使用：

```
MyContainer myContainer = new MyContainer(10);
foreach(int i in myContainer)
    Console.WriteLine(i); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2020-04-11T11:55:25.897

来自[MSDN 参考](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/foreach-in)：

foreach 语句不限于`IEnumerable`类型，可以应用于满足以下条件的任何类型的实例：

具有`GetEnumerator`返回类型为类、结构或接口类型的公共无参数方法，该方法的返回类型`GetEnumerator`具有公共 Current 属性和`MoveNext`返回类型为布尔值的公共无参数方法。

如果您声明这些方法，则可以使用`foreach`关键字而无需`IEnumerable`开销。为了验证这一点，截取这段代码，看看它不会产生编译时错误：

```
class Item
{
    public Item Current { get; set; }
    public bool MoveNext()
    {
        return false;
    }
}

class Foreachable
{
    Item[] items;
    int index;
    public Item GetEnumerator()
    {
        return items[index];
    }
}

Foreachable foreachable = new Foreachable();
foreach (Item item in foreachable)
{

} 
```

# asp.net - asp.net “找不到文件” - 没有文件参考！

> ID：348966
> 
> 赞同：1
> 
> 时间：2008-12-08T09:09:47.503
> 
> 标签：asp.net, exception

我正在使用 asp.net（我是一名设计师），在调试过程中的某个时候它会抛出我，我会在代码中找到一个异常 objErr - 当我悬停时它说“找不到文件” . 我认为这是一张图片，但我一直在搜索，但无论如何都找不到确定哪个文件丢失了。我希望这是足够的信息 - 如果有人能给我一个方向，我将非常感激！

AB

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-08T10:42:06.553

找到 Microsoft 的 SysInternals 包中的 FileMon 并在您接近文件问题时运行它，也许添加一个过滤器以过滤掉所有操作系统文件操作。

如果您设置正确，您将能够看到文件未找到或访问被拒绝的文件条目。

我一直在使用 FileMon，它是免费的，并且在解决权限和文件 IO 问题时非常有用。

瑞安

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-08T09:15:04.937

我认为您没有为您正在搜索的图像提供完整路径。

另一个可能出现的问题是当它抛出错误时，检查您的 url 中的页面并检查该页面是否存在于您的项目中。我希望我可以为您提供更多帮助，但我需要更多信息，

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-08T09:19:21.090

您真的没有关于找不到哪个文件的信息吗？

它可能是一个拼写错误的文件名（很难找到 1 个字符的拼写错误）。因此，如果您没有丢失的文件名，调试可能会非常可怕。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-08T09:56:41.060

查看生成的 IIS 日志，位于：C:\WINDOWS\system32\LogFiles\W3SVC1\ 并搜索 403 或类似内容。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-08T10:05:07.673

在项目中引用文件时，请始终在前面添加“ **~ ”。**这意味着“~”符号后面的路径是相对于项目根文件夹的。

示例：
如果名为“Example.asp”的 .Aspx 文件位于项目内的*Pages*文件夹中，您希望将其引用为

```
<asp:HyperLink ID="lnkExample" runat="server" NavigateUrl="~/Pages/Example.aspx"> Example</asp:HyperLink> 
```

我希望这能有所帮助。

# ruby-on-rails - 在 Rails 2 中关闭 Web 服务的真实性令牌？

> ID：348976
> 
> 赞同：8
> 
> 时间：2008-12-08T09:15:38.757
> 
> 标签：ruby-on-rails

除了用 HTML 填写表单之外，还应该可以发送一个包含参数的发布请求。例如，如果 Accept 标志设置为“application/JSON”，是否可以关闭真实性令牌在 HTTP 标头中？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-08T16:02:59.027

请求伪造保护是在检查请求的内容类型的基础上工作的，它只检查可以由浏览器发出的请求。例如，没有浏览器能够生成内容类型设置为“application/json”的请求。这就是为什么 Rails 伪造保护例程不会检查它的原因。因此，如果您想向您的应用程序发出 json 请求，请将 content-type 标头设置为“application/json”，它应该可以工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-08T11:24:30.680

我知道有一种方法可以为控制器或动作关闭它。不确定内容类型。将真实性令牌添加到每个 json 请求中不是更容易吗？网上关于如何做到这一点的文章很少（例如[这里](http://alwaysmovefast.com/2008/01/30/ajax-in-rails-with-authenticity-token/)和[这里](http://polyrails.com/2008/11/11/steps-to-unobtrusive-rails-with-jquery/)）。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-12-08T14:17:13.873

> 将真实性令牌添加到每个 json 请求中不是更容易吗？

是的，但是客户端必须先发送一个请求才能获取令牌，然后再发送一个带有实际 POST 请求的请求，恕我直言，这没有意义。

# css - 是否有任何实际理由使用“em”而不是“pt”字体大小单位？

> ID：348978
> 
> 赞同：16
> 
> 时间：2008-12-08T09:17:47.130
> 
> 标签：css

我学到的一条 CSS 规则是你应该使用相对的“em”字体大小单位而不是绝对的“pt”。一般的想法是将你的body标签中的字体大小设置为例如“94％”，然后将所有其他元素设置为“em”大小，就像这样。理由是：

*   然后，您可以通过在某一点修改正文的字体大小来更改站点上所有字体大小的相对大小
*   用户自己可以修改字体的大小，因为它们是在“em”中定义的

但是，当使用“em”而不是“pt”时，我经常遇到以下问题，其中具有 font-size 的元素嵌入到具有 font-size 的另一个元素中，因此变得很小（在下面的一个词汇单词的情况下.8 of .8 和另一个是 0.8 of 1.2)。

```
<html>
<head>
    <style type="text/css">
        body {
            font-size: 94%;
        }
        p {
            font-size: .8em;
        }
        li {
            font-size: 1.2em;
        }
        .vocabulary {
            font-size: .8em;
        }
    </style>
</head>
<body>
    <p>This is an <span class="vocabulary">egregious</span> test.</p>
    <ul>
        <li>This is in a <span class="vocabulary">superb</span> list.</li>
    </ul>
</body>
</html> 
```

当然，在非常简单、直接的 HTML 站点中，这没有问题，但在现实世界中，导入的样式表可能您甚至没有制作，以及控件嵌入在其他控件中的动态站点，所有这些站点都可能输出 HTML内联样式，我发现具有“em”单位字体大小的网站有时无法维护，控制字体大小的方法是将所有内容转换为硬“px”大小。

此外，我刚刚检查了四个主要浏览器，每个浏览器都有增加和减少“pt”样式字体大小的热键。

所以这是我的问题：

*   为什么我应该使用“em”而不是“pt”，有什么现实原因吗？
*   使用“em”大小是否有技巧，这样我就不会遇到上面嵌入的字体大小问题？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-08T10:29:59.480

根据您居住的国家/地区，您实际上可能最终会使用 pt 而不是 em 违法，具体取决于您的立法机构执行规则的难度。在英国，有一项残疾歧视法，该法已用于针对其网站以固定字体呈现的公司。这被视为歧视，因为它不利于部分站点，他们可能增加了浏览器字体大小以进行补偿 - 但您的站点仍然以您设置的大小呈现字体，而不是他们期望的大小。

是的，掌握相对的字体大小和流畅的布局更难，但如果你想遵守法规，你必须花时间来掌握这一点。

对于英国的地方政府工作，已设定目标以确保网站遵循 Double A 准则，其中之一规定“在标记语言属性值和样式表属性值中使用相对单位而不是绝对单位”。见[这里](http://www.w3.org/TR/WCAG10-TECHS/#tech-relative-units)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T09:30:24.453

即使您以像素为单位硬编码字体大小，您仍然可以使用 em 作为单位来指定边距、长度等，类似于使用[em quad](http://en.wikipedia.org/wiki/Em_%28typography%29)缩进印刷机中的段落。

**编辑**（海报从 px 更改为 pt 后）：如果你想“像素完美”，使用 px 比使用 pt 更安全，因为不同的操作系统具有不同的 dpi 设置，并且用户更改会极大地改变 dpi，尤其是在 Linux 上. PostScript 点定义为 1/72 英寸。屏幕上的“英寸”可以是 72 像素到漂浮在您船上的任何东西。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-08T09:39:12.063

根据我作为喜欢大文本的网络用户的经验：

为字体大小指定“pt”很好，只要您不在 px/pt 中指定元素大小。因为当你这样做时，我增加了文本大小，一半的文本在元素之外溢出，并且经常溢出被设置为隐藏。

这不需要扭曲您的布局 - 只需为所有内容向下增长留出空间。我可以更好地处理滚动页面而不是看不到文本。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-08T12:02:16.907

1) IE6 仍然被广泛使用，无法调整 px 中定义的字体大小。=> 可用性问题。仅此一项就不行了。

2) 例如，参见[CSS 单元](http://webkit.org/blog/57/css-units/ "CSS 单位")。

3）大多数作者同意说 pt 主要是一个打印单元：最坏的情况是，在打印样式表中使用它们，调整大小问题消失了......

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-08T09:19:38.313

另见[http://www.killersites.com/mvnforum/mvnforum/viewthread?thread=4084](http://www.killersites.com/mvnforum/mvnforum/viewthread?thread=4084)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-08T09:22:18.307

px ：随着您的屏幕分辨率和其他相关问题而变化

em : 不管你的屏幕分辨率如何，它对所有人都是一样的

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-03-03T13:21:19.800

我认识的一些专业 CSS 开发人员使用“px”在现代浏览器的主样式表中定义字体大小，然后为 IE6 提供一个单独的样式表，使用相对单位指定它们。通过这种方式，它们实现了可用性并允许在所有浏览器上放大字体，而不必在现代浏览器上妥协他们的设计。

（他们实际上走得更远：他们的 IE6 样式表关闭了大多数块格式，只是使用通用的、移动式的外观来布置所有内容。这样 IE6 用户可以看到一个简单的布局，而其他所有人都可以在实际的块中获得专业的外观正确浮动。）

# c - Linux设备驱动程序中的静态函数？

> ID：348984
> 
> 赞同：10
> 
> 时间：2008-12-08T09:21:06.000
> 
> 标签：c, linux, linux-device-driver, static-functions

linux代码中设备驱动程序中的大多数函数定义被定义为静态是否有原因？是否有一个原因？

有人告诉我这是为了范围界定和防止命名空间污染，谁能详细解释一下为什么在这种情况下使用静态定义？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-12-08T09:30:33.703

声明为静态的函数在定义它们的翻译单元之外不可见（翻译单元基本上是一个 .c 文件）。如果不需要从文件外部调用函数，则应将其设为静态，以免污染全局命名空间。这使得相同名称之间的冲突不太可能发生。导出的符号通常用某种子系统标签来标识，这进一步减少了冲突的范围。

通常，指向这些函数的指针以结构形式结束，因此它们实际上是从定义它们的文件外部调用的，而不是通过它们的函数名调用的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T09:30:56.447

出于同样的原因，您在任何代码中都使用静态。您应该只“发布”您的 API 调用，其他任何事情都会让您受到滥用，例如能够从驱动程序外部调用内部函数，这几乎肯定会是灾难性的。

只让外部世界看到必要的东西是一种很好的编程习惯。这就是封装的全部意义所在。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-01-23T16:27:59.183

我同意。这在任何 C 代码中都是常见且明智的做法——不仅仅是内核代码！不要以为这仅适用于低级别的东西，任何超过一个 .c 文件的 C 代码都应该考虑到这一点。

# java - 同步死锁（字符串实习生（））

> ID：348985
> 
> 赞同：7
> 
> 时间：2008-12-08T09:21:57.620
> 
> 标签：java, string, deadlock, synchronized, string-interning

我用户 sun jdk 1.5 ThreadPoolExecutor(24, 24,60,TimeUnit.SECONDS, new LinkedBlockingQueue())。soemtime 我使用 jdb 工具查找线程池中所有线程的状态是“在监视器中等待”，代码是：

```
 String key = getKey(dt.getPrefix(), id);
    synchronized (key.intern()) {      -----> 
```

“同步（key.intern（））”有问题吗？

* * *

我使用 jdb 工具得到以下信息，24 个线程的状态是“在监视器中等待”，这意味着 24 个线程在“key.intern()”处死锁。

(java.lang.Thread)0x28 pool-3-thread-2 在监视器中等待

(java.lang.Thread)0x27 pool-3-thread-3 在监视器中等待

(java.lang.Thread)0x1b pool-3-thread-4 在监视器中等待

(java.lang.Thread)0x1a pool-3-thread-5 在监视器中等待

(java.lang.Thread)0x19 pool-3-thread-6 在监视器中等待

(java.lang.Thread)0x18 pool-3-thread-7 在监视器中等待

(java.lang.Thread)0x17 pool-3-thread-8 在监视器中等待...

所以结果是：在多线程环境下，Sting intern() 方法可能会死锁，好吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-08T14:54:59.710

我曾经发布过一个相关的问题，您可能想看看：[String objects 的同步问题？](https://stackoverflow.com/questions/133988/problem-with-synchronizing-on-string-objects)

我学到的是：使用实习字符串进行同步是一种**不好**的做法。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-08T09:28:49.977

相当。问题是 key.intern() 并不是真的那么独特，因为它从池中返回一个字符串。即使在不同的对象上使用 String.intern() 也可能返回相同的对象。尝试使用`key`它自己或完全不同的对象。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-08T12:52:37.070

该代码几乎肯定会尝试同步影响相同键的操作。所以它调用 intern() 以确保相同的键被映射到相同的对象，因此作为同步对象是有效的。

问题是，如果您在那里遇到瓶颈（这不是死锁），那么您有太多操作同时使用相同的密钥进入。

重新考虑需要同步的内容。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-08T13:07:31.923

如果您需要在 String 上同步，请不要使用 String 实例作为互斥锁（无论是否为 interned）。但是，字符串可用于创建良好的互斥对象：[在 ID 上同步](http://illegalargumentexception.blogspot.com/2008/04/java-synchronizing-on-transient-id.html)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-08T13:18:58.343

你有两个问题。一个是使用字符串作为锁。第二个是死锁。

如果您使用字符串作为锁，您将失去对“谁”的控制，“哪里”将获得该对象锁。

您的死锁问题，可能是由 String 上的锁定引起的，也可能不是。然而，死锁的真正原因是：“你的代码会导致死锁。”。如果它可以发生，它就会发生。

您必须跟踪线程的堆栈以解决死锁。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-08T15:03:35.763

这里没有足够的代码来说明出了什么问题。如前所述，这可能是一个瓶颈，但至少应该运行一个线程（CPU 使用率相当高）才能发生这种情况，或者一个拥有锁的线程在不释放锁的情况下进入睡眠状态。

死锁是另一种可能性，但这需要在多个线程上的两个单独锁上进行同步，并且您在此处仅显示了一个锁对象。

如果没有更多信息，真的无法确定。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-08T11:26:00.583

正如 Bombe 所说， key.intern() 不一定会给你一个非常独特的同步键。

但是，您应该谨慎更改代码。在更改代码之前，您需要了解代码中的锁定策略。删除 intern() 调用可能会为您提供看似正常工作但包含稍后会咬您的数据竞争的代码。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-11T05:34:27.500

你很可能陷入僵局。

如果要避免死锁，每个线程必须始终以相同的顺序获取锁。当您使用 String.intern() 获取锁时，您锁定的是整个 JVM 中的任何代码都可以访问并锁定的实例。很可能，您自己代码中的其他线程处于死锁状态，但并非必须如此。

我不确定您在“key.intern() 保证唯一性”的回答中是什么意思。该`intern()`方法通过为每个等效的字符串返回*相同的对象来**降低唯一性。*

 *```
 String s1 = new String(new char[] { 'c', 'o', 'm', 'm', 'o', 'n' }).intern();
  String s2 = new String("commo" + (s1.charAt(s1.length() - 1)).intern();
  String s3 = "common";
  if ((s1 == s2) && (s1 == s3))
    System.out.println("There's only one object here."); 
```

上面的代码将证明，即使您创建了两个唯一的实例，通过实习它们，您也可以将它们替换为单个规范实例。

任何时候你使用在你自己的代码之外可见的对象作为锁都有危险。尝试坚持私有成员，不允许从自己的堆栈中逃脱的对象等。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-08-23T04:09:03.787

如何使用具有锁定值的唯一字符串前缀并在同步块中使用 String.intern()。例如，如果您想锁定字符串“lock1”，请使用这样的 UUID 前缀：“85e565b3-d440-46e7-93b6-69ee7e9a63ee-lock1”。这种类型的字符串不应该已经在实习生池中。即其他代码死锁的机会非常低。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-12-08T11:09:47.653

String.intern() 是本机方法 - 这可能是问题的原因。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2008-12-08T09:43:48.263

key.intern() 保证唯一性，因为 key.intern() 从字符串常量池返回一个字符串。

[http://java.sun.com/j2se/1.4.2/docs/api/java/lang/String.html#intern()](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/String.html#intern()) 实习生

public String intern() 返回字符串对象的规范表示。一个字符串池，最初是空的，由 String 类私下维护。

# ruby - 红宝石中字符串的异或

> ID：348991
> 
> 赞同：2
> 
> 时间：2008-12-08T09:24:47.287
> 
> 标签：ruby, xor

我有一个字符串，可以说“123|ABC|test|12345|FF”，我想对每个字符的 ascii 值进行异或运算并以十六进制打印结果。

最简单的方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-08T12:03:12.163

找到了...

```
lrc = 0
input.each_byte do | c |
    lrc ^= c
end
hexVal = lrc.to_s(16) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-09T02:06:45.783

在 Ruby 1.8.7 或 1.9.1 中：

```
input.bytes.inject { |a,b| a ^ b }.to_s(16) 
```

# python - 在 python 中添加一个 mimetype

> ID：348999
> 
> 赞同：7
> 
> 时间：2008-12-08T09:33:04.183
> 
> 标签：python, mime-types

在我的 Centos 服务器上，Python 的 mimetypes.guess_type("mobile.3gp") 返回 (None, None)，而不是 ('video/3gpp', None)。

Python 从哪里获取 mimetypes 列表，是否可以将缺少的类型添加到列表中？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-08T09:45:31.007

在我的系统（Debian lenny）上，它位于列表中的 /usr/lib/python2.5/mimetypes.py 中，`knownfiles`您可以为该`init()`函数提供您自己的文件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T09:46:40.660

mimetypes 模块使用 mime.types 文件，因为它们在 Linux/Unix 系统上很常见。如果您查看 mimetypes.knownfiles，您会发现 Python 尝试访问以加载数据的文件列表。您还可以通过将其添加到该列表来指定您自己的文件以添加新类型。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-04-09T20:57:13.130

在 python 3.6 中找到该文件：`C:\Users\Me\AppData\Local\Programs\Python\Python36\Lib\mimetypes.py`

搜索`mp3`（以获取扩展名列表）。添加你的文件（很直观）*********