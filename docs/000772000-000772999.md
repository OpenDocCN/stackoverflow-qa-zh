# StackOverflow 问答 000772000-000772999

# apache2 - OpenSUSE 11.1 上的 Apache2 libapreq2

> ID：772003
> 
> 赞同：0
> 
> 时间：2009-04-21T10:42:27.683
> 
> 标签：apache2, opensuse

我正在尝试将基于 Apache2/mod_perl2/Perl 的软件安装到 OpenSUSE 11.1 机器上。

libapreq2 似乎不在 OpenSUSE 存储库中的任何位置，并且 CPAN 不会安装它，因为我的 mod_perl 来自包管理器，而不是来自源代码。

我真的宁愿坚持使用此安装的软件包，而不是从源代码 tarball 构建，因为我希望软件包升级和安全补丁能够正常工作。

有人知道我错过了什么吗？

*PS：是的，我知道它在 Debian/Ubuntu 发行版中“正常工作”:-)。*

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T11:00:36.487

以后使用软件搜索： http: [//software.opensuse.org/search](http://software.opensuse.org/search)

例如：[http ://software.opensuse.org/search?baseproject=openSUSE%3A11.1&p=1&q=libapreq2](http://software.opensuse.org/search?baseproject=openSUSE%3A11.1&p=1&q=libapreq2)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T11:01:00.540

*叹息*......我问完几秒钟后，我偶然发现

```
http://download.opensuse.org/repositories/Apache:/Modules/Apache_openSUSE_11.1/repodata/ 
```

我终于想到

```
zypper ar http://download.opensuse.org/repositories/Apache:/Modules/Apache_openSUSE_11.1
zypper in zypper in libapreq2 libapreq2-devel perl-Apache2-Request apache2-mod_apreq2 apache2-mod_apreq2-devel 
```

这至少让我得到了一些帮助……剩下的问题在[WebGUI、SuSE、Apache 上都有描述——哦，我的。](http://computergod.typepad.com/home/2007/06/webgui_and_suse.html)& 我已经使用 /etc/apache2/http.conf.local 文件解决了这个问题。

# php - 如何在 HTTP 服务中进行身份验证？

> ID：772011
> 
> 赞同：1
> 
> 时间：2009-04-21T10:44:32.017
> 
> 标签：php, http, api, https

我们目前有一个具有用户帐户功能的网站，但我们希望提供一个 API，以允许用户通过其他设备/网站管理他们的帐户/执行操作，方法是为常见任务提供 API。

目前，网站登录是通过 HTTPS 进行的，以确保安全，然后使用 PHP 会话进行管理，并采取适当的安全措施来防止会话劫持等。

我们将如何在 API 中提供此功能？

如何在不进行 POST 的情况下提交登录信息？（推测 GET 是通过 API 调用执行此操作的唯一方法）。是否发出如下 URL：[https](https://www.example.com/login/user-foo@password=bar) ://www.example.com/login/user-foo@password=bar安全？https 设置是否发生在通过网络发送 URL 之前？

如果我可以解决这个问题，那么我会让登录返回一个访问令牌。第一个请求应包含此令牌，响应应返回一个*新*令牌，以用于第二个请求，依此类推......

这行得通吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-21T12:36:34.400

使用标准，例如[OAuth](http://oauth.net/)？如果您允许这样做，那么您的用户可以根据需要保留经过身份验证的令牌。

或者，您可能根本不需要任何身份验证，如果您可以在某些 GET 请求进入时重定向到登录。例如：任何站点都可以链接到 URL 以向 Twitter[添加推文](http://twitter.com/home?status=Browsing%20Stack%20Overflow)。未登录时，Twitter 将首先重定向到登录页面。推荐网站甚至不需要知道 Twitter 用户名。

（是的：在发送 URL 之前，基于服务器的 IP 地址建立了 HTTPS。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-21T16:15:55.713

您可以使用[基本的 www-authentication](http://www.php.net/features.http-auth)。它基本上是一个标题，其中包含用户名+密码。这样做的好处是它是无状态的（您不需要单独的登录过程），并且得到很好的支持。实现起来也很简单。只要您通过 https 提供服务，安全性就很好。

> 是否发出如下 URL：[https](https://www.example.com/login/user-foo@password=bar) ://www.example.com/login/user-foo@password=bar安全？

将凭据放在 URL 中并不好，因为它可能最终会出现在日志中。

> https 设置是否发生在通过网络发送 URL 之前？

是的，https是在http协议之前建立的。恶意人员唯一能看到的是端点的 IP 地址。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T12:33:46.840

您是否考虑过在 SSL 上使用[SOAP ？](http://php.net/soap)理论上，您应该能够通过 SOAP 对用户进行身份验证。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T21:27:59.177

您可以通过要求调用者设置标头来在 REST API 中执行身份验证。即他们设置了一个“X-YourApp-API-Key”标头，然后您可以阅读并使用该标头进行身份验证。这使您不仅可以验证 POST 和 GET 方法，还可以验证 PUT、HEAD 和 DELETE，因此您拥有完整的 REST 方法。

如果您的所有呼叫都通过 HTTPS，这本身就很好。如果您想通过 HTTPS 进行身份验证，然后通过常规 HTTP 进行后续调用，您需要实现类似于[OAuth](http://oauth.net)的功能，并为明确请求发出令牌。

# c# - 如何将英镑符号从 C# Web App 正确导出到 Excel？（产生的是£而不是£）

> ID：772016
> 
> 赞同：2
> 
> 时间：2009-04-21T10:47:20.777
> 
> 标签：c#, .net, excel, character

我们正在将网站应用程序中的一些数据导出到 Excel 电子表格中，但是，当使用 GBP 符号时，它不会输出“£9.99”，而是输出“£9.99”。

这是一位同事编写的用于生成电子表格的代码 [tableOut 是一个包含 HTML 表格的 StringBuilder]：

```
string filename = "EngageReplies.xls";
Response.Clear();
Response.Buffer = true;
Response.ContentType = "application/vnd.ms-excel";
Response.AddHeader( "content-disposition", "attachment;filename=" + filename );
Response.Charset = "UTF-8";
Response.ContentEncoding = System.Text.Encoding.UTF8;
this.EnableViewState = false;

Response.Write( tableOut );
Response.End(); 
```

任何想法我们如何获得所需的输出？

ps 不知道我是否应该把它分成一个单独的问题，但是当生成电子表格时，会触发一条警告消息：

> 您尝试打开的文件“EngageReplies.xls”的格式与文件扩展名指定的格式不同。在打开文件之前，请确认文件没有损坏并且来自受信任的来源。您现在要打开文件吗？

我已经使用 Firefox 和 IE 使用 Office 2007 打开文件。单击“是”可以打开文件，但如果我的用户没有受到它的影响，我会更喜欢它。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-21T10:58:37.100

啊哈！

首先我尝试删除 Charset 和 CharacterEncoding，但仍然得到错误的输出，所以我将它们设置为以下并且它工作正常：

```
Response.Charset = "";
Response.ContentEncoding = System.Text.Encoding.Default; 
```

感谢罗兰的灵感！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-21T10:51:36.303

我不希望在传输二进制文件（例如 XLS 文件）时看到 Charset/ContentEncoding 标头。我还将测试输出是否将其保存到某个地方的 lcoal 磁盘并验证文件创建是否在做“正确的事情”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T10:53:25.503

该警告是因为您将 HTML 数据而不是 Excel 电子表格数据保存在具有 XLS 扩展名的文件中。您可以尝试将文件扩展名更改为“.htm”，但我不确定如何在 Excel 而不是 Web 浏览器中打开它。

您可能希望查看此问题以了解更多[在 ASP.NET 中生成 Excel 文件](https://stackoverflow.com/questions/150339/generating-an-excel-file-in-asp-net)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T11:31:03.697

我同意 Martin Brown 的观点，这是一个 HTML 表格，而不是一个 Excel 电子表格，这就是您收到该消息的原因。但是，我可以看到为什么开发人员将其保存为 .xls，这意味着最终用户获取由 Excel 打开的表（它处理带有警告的 html 转换）而不是在他们的 Web 浏览器中打开 html。我想让用户体验更好一点。

另一种方法是使用 office interop 正确创建表（需要在服务器上安装并进行大量配置）或找到可以正确创建 excel 文件的库。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-07-13T13:56:52.387

```
Response.ContentEncoding = System.Text.Encoding.Unicode; /*c# uses UTF-16 internally*/  
Response.BinaryWrite(System.Text.Encoding.Unicode.GetPreamble()); /*Include the UTF-16 header so excel will treat this as UTF-16*/ 
```

试试这个代码它完美地解决了这个问题。

# shell - 在 Shell 脚本中使用带有 sed 的变量

> ID：772017
> 
> 赞同：3
> 
> 时间：2009-04-21T10:47:49.950
> 
> 标签：shell, sed

我正在编写一个 shell 脚本来编辑 aegis 的 Change-Set 属性。我正在使用的命令是：

> ```
> aegis -Change_Attributes -Edit 
> ```

这将打开一个 vi 编辑器来执行更改。我想做一个搜索和替换：

> ```
> s/brief_description \= \"none\"\;/brief_description \= 
> ```
> 
> \"测试\"/g

我可以通过脚本将这些直接传递给打开的 vi 实例而不输入任何内容吗？我想在编辑后保存文档（：wq）。

PS该文件是执行命令时创建的临时文件所以我不知道原始路径

**编辑：**我可以在这种情况下使用 sed：

> ```
> sed -e 's/brief_description\ \=\ \"none\"\;/brief_description\ \=\ 
> ```
> 
> \"测试\"\;/g'

解决方案（不雅黑客？？）将是“cat”来自aegis（setenv VISUAL cat）的输出，使用上述命令修改输出流并将其保存到临时文件，然后使用：

> ```
> aegis -change_attributes -file <temp file> 
> ```

**EDIT2：**我几乎让它工作了。但是我的使用方式有问题`sed`

我的脚本中有以下行：

```
sed -i 's/brief_description\ \=\ \"none\"\;/brief_description\ \=\ \"${DESC}\"\;/g' temp_next.txt 
```

但是 $DESC 变量不会计算出它的值，并且输出如下：

> Brief_description = "${DESC}";

如何将 DESC 传递给 sed 以评估其实际值？

**编辑3：**

使用

```
sed -i 's%brief_description\ \=\ \"none\"\;%brief_description\ \=\ \"'"$DESC"'\"\;%g' temp_next.txt 
```

工作。我将普通分隔符 (/) 替换为 % 并将环境变量放在双引号中。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-21T10:51:25.137

您不需要知道路径 - 宙斯盾应用程序会提供。您需要更改环境变量，该变量指定 aegis 用于指向脚本的编辑器，并在该脚本中使用[sed](http://www.gnu.org/software/sed/manual/html_node/index.html)流编辑器执行您的编辑。

**编辑：**关于您的变量名扩展问题，将包含整个 sed 替换表达式的单引号集更改为双引号。变量替换由单引号关闭。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-21T11:12:51.260

如果您通过 -c 选项传入所需的命令，则 vi 将在启动编辑会话后立即执行该命令，例如

```
vi -c 's/brief_description \= \"none\"\;/brief_description \= \"test\"/g' my_file 
```

哎呀。我忘了说该命令被解释为“ex”命令，即在冒号处，因此您提供的命令应该可以工作。

高温高压

干杯，

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T10:51:26.600

我不认为 vanilla vi 会这样做，尽管 vim 可能能够在自定义 .vimrc 的控制下做到这一点。更好的方法是使用 sed 进行更改，然后在结果上打开 vi。

# asp.net - 如何在 ASP.NET 中禁用 IIS 凭据

> ID：772018
> 
> 赞同：0
> 
> 时间：2009-04-21T10:48:20.913
> 
> 标签：asp.net, iis, authentication

有没有办法根据传递的参数在 global.asax 或其他地方禁用 IIS 默认身份验证。

客户端请求相同的表单将使用 IIS 身份验证并通过在 POST 变量中提供身份验证信息来保护

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-21T10:54:50.727

IIS 身份验证发生在请求被传递到 ASP.NET 引擎之前。因此，您的问题的答案是“否”。

但是，通过仅在 IIS 上启用匿名访问，您可以在应用程序中处理任何身份验证（包括 Basic 等），而不会被 IIS“拦截”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T11:02:26.077

This is not a complete answer, but may give you direction. If you are using IIS 7, then HttpModules are now native to IIS. That is, you can get an implementation of the IHttpModule interface to be used by IIS, regardless of what type of content is being served.

I suspect that you can wire such an HttpModule so that it will notice when IIS is failing a request due to a failure of Windows Authentication. If that is possible, then you might still be able to examine the POST variables and give the request a "second chance".

I also wonder if it might be possible with IIS 7 to turn this around - have the main site use anonymous authentication so that your code can check the form POST parameters. If that authentication fails, then redirect to the Windows Authentication site.

# project-management - 如何确保团队中的所有开发人员都创建统一的用户体验？

> ID：772022
> 
> 赞同：7
> 
> 时间：2009-04-21T10:49:29.133
> 
> 标签：project-management

在我们的开发团队中，我们创建了许多小型应用程序，所有这些都针对我们客户的特定需求。

因此，我们在创建统一的用户体验方面经常遇到问题：

*   图标选择 (GUI)
*   配置文件的命名
*   配置选项的命名
*   GUI 语言（如“正式或不太正式”或“针对新手/高级用户”）
*   名称/头衔的选择
*   通用 GUI 布局
*   ...

我可以想到几种解决这些问题的方法......

*   创建非常详细的书面指南
*   讨论一切
*   让一位开发人员决定一切
*   ...

一般来说，获得一致的用户体验或统一结果的最佳方式是什么？就个人而言，我不喜欢我的任何方法，但也许这是一个误解，所以请随时支持他们:)

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-21T10:58:46.210

我曾担任过几个职位，我完全拥有 GUI。这涉及到我做所有的设计/模型，并监督用例的编写以确保它是一致的。这是迄今为止确保一致性的最佳方法，但它可能并不总是最实用的方法。

替代方案是编写指南，但这与拥有良好的 GUI 设计知识/HCI 技能并不是一回事。至少它可以教开发人员使用贵公司可能拥有的自定义库/组件。

必须是一个字典，其中包含您的 ase 使用的领域语言以及它应该如何在 GUI 中使用。这是主要 gui 开发人员需要做的最重要的事情之一。

至少你应该确保审查其他开发人员所做的任何事情，除非你知道并相信他们会做正确的事情。GUI 设计通常是一项被大大低估的技能，重要的是要记住，不是每个人都可以在没有适当培训的情况下做到这一点。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-21T10:52:22.467

由“技术主管”、“设计主管”和/或 QA 提供广泛的指导和审查。

使指南“动态”并保持准确和最新，在我们公司，我们使用 Wiki 来完成此类协作任务。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-21T10:55:23.987

您可能想要创建一组标准模板。例如，如果您使用预定义的 css 规则、html 布局等创建网站模板，那么就外观和感觉而言，您可以让开发人员“轻松”生成统一的输出。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-21T11:00:11.837

I believe that the biggest problem is often that developers are not aware that there is a guideline for a particular design consideration, rather than the unwillingness to implement those guidelines. It is the management's job to make sure that they have that knowledge.

You will always require verbose written guidelines if you are to standardize any type of team effort and weed out the "individuality" that is going to inherent to system design.

However, you should keep in mind that no matter how detailed your documents are, there is probably going to be some unforeseen condition that will be missing. To counter this probability, you should have an open-door policy whereby team members can always come up to the team leader and discuss such scenarios. These new items should then be updated into the guideline repository.

Your guideline documents should be easily accessible to all stakeholders in the project. Creating a "cheat-sheet" ready reference is often a good idea.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-17T06:04:40.607

我有一个职位，我是 ui 设计师，结果很好。创建模型并将它们作为母版页带入视觉工作室是我的责任。

然后程序员会进来并添加逻辑。

这是一种很好的方法，因为它不需要样式指南或大量文档，因为它需要一个人负责。

现实情况是，大多数公司并没有专门聘请某人担任 UI 角色（不过，现在有更多公司开始这样做，然后几年前）。

在 4 家不同的公司担任了 5 年的项目经理后，还有另一种方法。

我不太相信编写 UI 指南并期望程序员遵循它。这有几个原因：1）程序员通常不擅长 UI 设计，2）要记住很多，3）适得其反。

UI 风格指南会减慢程序员的速度，因为您期望他们擅长一些他们不擅长的事情。他们擅长编码——所以让他们编码吧。

你得到了什么？界面不一致。当你为程序员提供模型来工作时，甚至会发生这种情况（例如，你的模型可能不包含程序员可能必须显示的错误消息）。

那么解决方案是什么？容易 - 您有一个人在里程碑点审查整个界面并在您的问题跟踪器中记录错误。这些错误将被标记为 UI 或低。如果存在脚本错误，那么首先修复它显然比 UI 故障更重要。

下一个问题是，谁应该进行审查？再一次，简单——只有一个人（为了保持一致性），那个人应该是最有 HCI/UI 设计天赋的人。

我的观点是；不要让程序员尝试成为 UI 设计师。当您记录一个 UI 错误时，它在问题跟踪器中，程序员会在他们准备好并准备好时来修复它们。而且它们通常很容易修复，因此对于可能会花费 2-3 小时调试严重数据损坏问题的程序员来说，它们可以作为一个很好的休息时间（是的，修复 UI 错误实际上可以缓解压力！）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-22T05:39:09.730

以前对我有用的一种方法是为基类提供一个共享库，以强制或应用主题和布局。

我们是一个由 7 名开发人员组成的团队，几乎我们在做桌面应用程序，所以我们为 Forms 创建了基类，主要使用了常用控件，并将所有图标和图像放在源代码存储库中，部分测试我们确保所有图标和 UI 语言（标签、消息和工具提示）是一致的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-22T16:37:58.927

任何书面和分发/通过电子邮件发送的内容都将被遗忘。我建议创建一个内部 wiki 来存放标准、图标链接、创建/保存工作的步骤、命名约定、工作示例等。每个人都可以访问和更新

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-21T10:57:29.020

Fred Brooks 在我强烈推荐阅读的神话人物月中经常谈到这一点。

卡尔

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-21T11:16:29.553

You should use some sort of [Dependency injection](http://en.wikipedia.org/wiki/Dependency_injection) with XML files much like what [Spring](http://en.wikipedia.org/wiki/Spring_Framework) can provide.

All the developers shouldn't integrate their choice of GUI parts hard-coded into the program, but rather leave this choice to the XML file.

Then a single QA person will have to check the applications, and should it not be standardized, change only the XML file, rather than recompile, etc'... This will be much faster and simpler as there's no need to look at the application's code.

If [Spring](http://en.wikipedia.org/wiki/Spring_Framework) doesn't work with your environment, I'm sure other Framework will, or at worst, you can build a small one yourself, but that will take much more time.

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-04-21T11:29:28.553

创建一个描述布局的所有一般 prooerties 的文档。

该文件应包括：

背景颜色 文本颜色 活动文本颜色 非活动文本颜色 注释文本颜色 字体类型 字体大小等

确保（通过测试）开发人员遵循指南。

如果开发商不这样做，你可以实施惩罚（解雇、减少销售、不促销）。

# winapi - 在 Win32 中侦听通信端口和标准输入

> ID：772023
> 
> 赞同：2
> 
> 时间：2009-04-21T10:50:12.033
> 
> 标签：winapi, serial-port, polling, waitformultipleobjects

我正在尝试编写一个使用 Win32 API 将 stdin/stdout 映射到串行端口（各种命令行终端仿真器）的小实用程序。我有以下代码，我认为它应该可以工作，但它似乎没有从串口正确接收通知：

```
HANDLE hStdin = GetStdHandle(STD_INPUT_HANDLE);
HANDLE hCom = CreateFile(com_name, GENERIC_READ | GENERIC_WRITE, NULL, NULL, OPEN_EXISTING, 0, NULL);

/* check for errors opening the serial port, configure, set timeouts, etc */

HANDLE hWaitHandles[2];
hWaitHandles[0] = hStdin;
hWaitHandles[1] = hCom;
DWORD dwWaitResult = 0;
for (;;) {
    dwWaitResult = WaitForMultipleObjects(2, hWaitHandles, FALSE, INFINITE);
    if(dwWaitResult == WAIT_OBJECT_0)
    {
        DWORD bytesWritten;
        int c = _getch();
        WriteFile(hCom, &c, 1, &bytesWritten, NULL);
        FlushConsoleInputBuffer( hStdin);
    } else if (dwWaitResult == WAIT_OBJECT_0+1) {
        char byte;
        ReadFile(hCom, &byte, 1, &bytesRead, NULL);
        if (bytesRead)
            printf("%c",byte);
    }
} 
```

有什么想法我在这里做错了吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T10:57:52.203

如果我没记错的话，您需要使用重叠 I/O 进行串行端口访问，以使一切正常工作。这通常意味着您需要创建一个单独的线程来处理串口输入。我不记得确切原因，但是使用`WaitForMultipleObjects`串行端口有问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-26T17:59:50.310

WaitForMultiplObjects 的文档说以下是可等待的：

```
* Change notification
* Console input
* Event
* Memory resource notification
* Mutex
* Process
* Semaphore
* Thread
* Waitable timer 
```

请注意，未提及文件和通信端口。

# perl - 如何使用 gettext 在 HTML::Template[::Compiled] 中执行 I18N？

> ID：772029
> 
> 赞同：2
> 
> 时间：2009-04-21T10:52:36.753
> 
> 标签：perl, web-applications, templates, internationalization, gettext

我目前正在尝试将 Web 项目从自定义 i18n 系统移动到`gettext`，但是我还需要为 i18n 准备[HTML::Template::Compiled](http://search.cpan.org/dist/HTML-Template-Compiled)模板，但还不知道该怎么做。我的模板存储在单独的文件中，因此我不能使用 Perl 的字符串插值，我也想`_()`在模板中使用 gettext-typical 语法。

知道如何正确实施吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T12:29:43.637

你可以试试这个： [http ://perlboard.svn.sourceforge.net/viewvc/perlboard/battie/lib/HTML/Template/Compiled/Plugin/Translate.pm?view=markup](http://perlboard.svn.sourceforge.net/viewvc/perlboard/battie/lib/HTML/Template/Compiled/Plugin/Translate.pm?view=markup)

我想用它制作一个 CPAN 模块。希望很快 =) 这是一个示例，模块中的注释已过时：

```
use HTML::Template::Compiled;
use HTML::Template::Compiled::Plugin::Translate;
my $t = <<"EOM";
<%translate id="search %1:s found %2:d videos" count=".items#" args=".search,.items#" %>
EOM

my $map = {
    "search %1:s found %2:d videos" => [
        q/Suche nach "%1:s" hat %2:020d Video gefunden/,
        q/Suche nach "%1:s" hat %2:d Videos gefunden/,
    ],
};
my $plug = HTML::Template::Compiled::Plugin::Translate->new({
    lang => "de",
    map => $map,
});

my $htc = HTML::Template::Compiled->new(
    scalarref => \$t,
    plugin => [$plug],
);
$htc->param(
    search => "search term",
    items => [qw/ result1 result2 /],
);
print $htc->output; 
```

模板语法没有你想要的那么短，而且我没有使用 gettext，但也许你喜欢它或者可以从这个例子中构建你自己的插件。

问候，蒂娜

# git - 用于备份的私有 mercurial/git 分支？

> ID：772030
> 
> 赞同：5
> 
> 时间：2009-04-21T10:52:50.357
> 
> 标签：git, version-control, mercurial

是否可以在 git 或 mercurial 中创建一个不可见的分支，我可以用作备份？例如，在一天结束时，我有未完成的工作（甚至可能留下语法错误），但我希望将其在线备份到存储库中，而不会因留下的混乱而烦恼其他人。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-21T16:10:03.747

默认情况下`git clone`，`git fetch/merge`仅下载 refs/heads/* 中的 refs。所以你推送到其他地方的任何东西都不会被其他人下载（除非他们明确要求他们或做类似的事情`git clone --mirror`）。因此，例如，您可以执行以下操作：

```
git push origin HEAD:refs/koen/my_work 
```

推送您当前的提交。使用完整的 refspec，您还可以从另一个结帐中提取它：

```
git pull origin refs/koen/my_work 
```

要自动推动你的 HEAD，你可以做类似的事情

```
[remote "origin"]
    url = git@github.com:pieter/gitx.git
    push = :
        push = refs/heads/*:refs/koen/* 
```

这会将您的所有分支推送到远程，而不会打扰其他任何人。它还将保留您习惯的默认推送行为。如果您不希望这样，请删除该`push = :`行。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-21T13:15:41.577

Git allows you to mirror your repository very easily;

Let's say you have a remote repo called 'backup', e.g.,

```
git remote add --mirror backup server.com:/home/koen/backup_repo.git 
```

Then backing up is as easy as

```
git push backup 
```

A few notes:

*   if you didn't use `--mirror` when adding the remote repo, then use `--mirror` in your push command
*   the remote repo should be a "bare" repository (since you're pushing into it)
*   checkout the [`git push`](http://www.kernel.org/pub/software/scm/git/docs/git-push.html) and [`git remote`](http://www.kernel.org/pub/software/scm/git/docs/git-remote.html) help regarding `--mirror`

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-19T16:54:03.963

您推送到共享存储库的任何内容都将普遍可见/可用。您的两个简单选项是：

*   在单独的位置创建您自己的第二个存储库，并在每天结束时将您的开发分支推送到那里。您不会将您的开发分支推送到其他人使用的稳定分支。

*   第二个选项不涉及拥有完整的第二个存储库，但最终需要您完成更多工作，即为您的工作导出补丁。标准的 git email patch 方法将导致您的所有提交得到维护，以防您也想备份该模式。压缩补丁并将其上传到某处。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-21T11:40:49.307

如果您有存储库的两个远程克隆，则可以完成此操作：

```
stable
unstable 
```

推送到不稳定的（你的备份），直到你完成一个功能。功能完成后，将分支推送到稳定状态。起泡，冲洗，重复。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-19T16:37:57.073

虽然这不是私人的（您公司中的任何人都可以找到他们，只是默认情况下不是，所以这并不烦人），这就是我所做的：

在 ~/.gitconfig

```
[别名]
  备份 = !git push -v origin +refs/heads/*:refs/wip/`git config --get user.email`/*

```

因此，这样，您可以随时在本地 repo 上运行：

```
git backup 
```

您的所有本地分支（无论如何都在 refs/heads 下）将无条件地推送到 refs/wip/your_email/ 命名空间下的“原始”存储库（与 push -f 相同）。

一旦你准备好推送到 origin/master，如果你一直在使用它来备份你正在进行的工作，推送将会非常快，因为大多数（所有）SHA1 对象都已经在源服务器上.

请注意，有时您会想要清除备份，以便原始存储库可以垃圾收集东西。看：

```
git ls-remote origin refs/wip/`git config --get user.email`/*

```

这将为您提供已推送到备份的分支列表，因此您可以知道/自动化要清理的内容。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-21T23:02:38.560

我认为这更多地取决于您的存储库如何可见以及您拥有哪些权限。原则上，您只需要一个临时分支用作推送到集线器存储库的“保存区域”——我想您已经知道了。有没有一种通用的方法将分支标记为“不可见”？我不这么认为，虽然你可以尝试将你的本地头裁判推到另一端奇怪的裁判，例如：

```
git push central refs/heads/master:refs/remotes/tmp/master 
```

这将尝试创建“refs/remotes/tmp/master”，这是一个有效的 refname，但不是通常被视为分支的名称。例如，如果它出现在 refs/heads/ 下的一个分支的历史记录中，gitweb 将显示这样的 ref，但不会显示所有远程 ref 的列表。

或者，只是咬紧牙关，推到一个名为“probably-broken-use-at-your-peril”的可见分支；）

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-21T12:18:23.273

最新版本的 TortoiseHg 允许您**[搁置您的更改](https://bitbucket.org/tortoisehg/stable/wiki/manuals/shelve.wiki)**。

简而言之：

> 搁置的更改会从工作目录中物理删除，直到您取消搁置它们。这意味着您可以在搁置的更改消失时构建您的项目并在其上运行测试。这比在构建时选择更改更安全，因为您可以测试提交的更改是否有效。
> 
> 搁置更改对于删除部分完成的工作也很有用，以确保它不会干扰您正在进行的其他更改的调试。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-21T11:16:41.160

使用 mercurial，当您合并时，您合并*所有变更集*，包括那些“仅用于保存未完成工作”的提交。如果您不希望它们在树中结束，请不要提交它们。

对于 git，据我所知，默认行为是相同的，编辑提交历史以删除它们也很烦人。

因此，正如建议的那样， rsync 看起来是一个更好的选择。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-25T20:51:57.597

使用 Git，您通常拥有***私有*存储库**，非裸露的，这意味着它确实有工作目录。你在那里创建新的提交，应用补丁，从其他存储库中提取/获取。此存储库托管在您的私人机器上。

然后你有***public* repository**，bare，这意味着它没有工作存储库。当您的工作稳定时，您从您的私有存储库推送到这个公共存储库（例如，它可以托管在诸如[repo.or.cz](http://repo.or.cz)、[GitHub](http://github.com)或[Gitorious之类的 git 托管站点之一上）。](http://gitorious.org)您只能将私有开发存储库中的部分分支推送到此*公共***发布**存储*库*（例如 Git 维护者 Junio C Hamano，不会将功能分支推送到公共存储库）。这个公共存储库是其他人从中获取的地方。**`git.git`**

 **这种分离的好处是您可以修复未推送到公共存储库中的提交（例如使用“git commit --amend”），否则会重写仅存在于私有开发存储库中的部分历史记录。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-21T10:56:49.927

这不是 SCM 的真正目的。也许像[rsync](http://en.wikipedia.org/wiki/Rsync)这样的东西将它上传到服务器会是一个更好的主意？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-23T16:11:43.887

在我们的 mercurial 项目中，我们使用多个分支。默认分支就像一个“主干”。每次我启动一个功能时，我都会在那里进行分支和开发。我承诺，推动，去另一个地方，拉，承诺，推动。默认分支保持不变，其他人都不会关注我的分支。完成后，我将分支合并为默认值。

# email - 在 ASP 中发送邮件代码

> ID：772033
> 
> 赞同：0
> 
> 时间：2009-04-21T10:53:24.583
> 
> 标签：email, asp-classic

我已经给出了一个 HTML 文件。当有人填写表格并发送时，它应该向他们的邮件 ID 发送电子邮件。如何在 ASP 中为此编写代码？

**您的姓名：*** **电子邮件：*** **电话号码：** **您的留言：***

*   格纳尼亚尔祖拜尔

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-21T13:42:44.303

像这样使用 CDOSYS：-

```
Dim oMsg : Set oMsg = CreateObject("CDO.Message")

oMsg.From = "Me <me@mymail.myserver.com>"
oMsg.To = "Bloke <bloke@somewere.com>"
oMsg.Subject = "Test"
oMsg.HTMLBody = "<html><body>Hello World</body></html>"

oMsg.Send 
```

当然，您需要从存储用户配置文件的某个持久存储中获取 To 字段，并从发布的字段中提供主体的主题和部分。

您还需要在 IIS 应用程序上配置邮件设置，以便为 CDO.Message 对象提供默认配置。如果您需要使用以下功能自己配置邮件设置，则失败：-

```
Function GetConfiguration()
    Const cdoSendUsingMethod = "http://schemas.microsoft.com/cdo/configuration/sendusing"
    Const cdoSMTPServer = "http://schemas.microsoft.com/cdo/configuration/smtpserver"
    Const cdoSMTPServerPickupDirectory = "http://schemas.microsoft.com/cdo/configuration/smtpserverpickupdirectory"
    Const cdoSMTPServerPort = "http://schemas.microsoft.com/cdo/configuration/smtpserverport"

    Const cdoSendUsingPickup = 1
    Const cdoSendUsingPort = 2

    Dim GetConfiguration : SetGetConfiguration = CreateObject("CDO.Configuration")

    With GetConfiguration.Fields
        .Item(cdoSendUsingMethod) = cdoSendUsingPort
        .Item(cdoSMTPServer) = "mysmtp.myserver.com"
        .Item(cdoSMTPServerPort) = 25
        .Update
    End With

End Function 
```

然后在调用 send 之前将此行添加到代码主体中：-

```
Set oMsg.Configuration = GetConfiguration() 
```

只需调整 GetConfiguration 内容以使用您的 SMTP 服务器主机名。

注意不要使用已弃用的 CDONTS。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T11:00:41.760

我假设你使用的是 ASP 3.0，你可以使用 Cdonts.dll

编码：

```
cBody = Request.Form("Body") 
cPara = = Request.Form("to") 

<%@ Language=VBScript%> 
<html> 

<head> 
   <title>Email Sending</title> 

</head> 
<body>
<% 
Dim cBody, n 

For Each n In Request.Form 
    cBody = cBody & n & ": " & Request.Form(n) & chr(13) 
Next 

Set oCDO = Server.CreateObject("CDONTS.NewMail") 

oCDO.From = "fernan@tudominio.com" 
oCDO.To = "foc@tudominio.com" 
oCDO.Subject = "Subject" 
oCDO.Body = cBody 
'oCDO.Cc = "resal@tudominio.com;webmaster@tudominio.com" 
oCDO.Bcc = "quinqui@tudominio.com" 
'oCDO.MailFormat = 0 

oCDO.Send 

Set oCDO = Nothing 
Response.Write "¡Email Sent!!" 

%> 
</body> 
</html> 
```

# version-control - 在 ClearCase 中搜索带有特定注释的签入

> ID：772035
> 
> 赞同：8
> 
> 时间：2009-04-21T10:54:46.577
> 
> 标签：version-control, clearcase

我被要求提供大约 3 个月前我在 ClearCase 中进行的签入的详细信息。我知道评论中包含的 QC 编号，但到目前为止完全没有找到一种方法来搜索 ClearCase 以通过评论签入。

有任何想法吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-21T11:58:28.827

[Brian Agnew](https://stackoverflow.com/questions/772035/searching-clearcase-for-a-checkin-with-a-specific-comment/772096#772096)走在正确的轨道上，但请注意：

*   我确定不需要第二个命令行（`cleartool find . -version !"lbtype(LABEL_NAME)"...`）
*   如果您认为您的文件可能已被移动， ' `cleartool find -all`' 很有用，但在大 VOB 上，该过程可能会超长
*   没有“ `-nvis`”选项，如果文件已被“rmnamed”（已删除），它将找不到文件
*   使用 ' `lshistory -minor`'**纯粹是疯狂**：在具有几个月或几年历史的vob上，它只会花费太多时间。对于找到的每个元素，它将显示该元素*所有*版本的所有历史记录，而没有任何可能细化显示的版本集。该解决方案根本无法扩展。
    那个，`-minor`' ' 命令的选项`lshistory`并没有为手头的问题带来任何价值：它只会显示*相同*的版本*几次*，只是因为内部注释，如 ' `Attached hyperlink "Change@13707xx@\my_pvob`"' 或 ' `Attached hyperlink "Merge@xxxx@\my_vob"`'

您需要使用以下方法细化您的查询：

*   想要的元素类型（如果是文件`-type f`：）
*   例如，日期“ `created_since(30-Jan)&&!created_since(28-Feb))`”会限制要考虑的日期范围
*   用户

我会使用：

```
M:\my_base_view\my_base_vob>
  cleartool find -all -type f -user myLogin -version "{created_since(30-Jan)&&!created_since(28-Feb)}" -exec "cleartool descr -fmt \"%n\t%c\n\" \"%CLEARCASE_XPN%\"" >c:\output.txt 
```

这只会查找我在某个日期期间签入的文件，这是一种检查较小版本集的方法。

请注意，我使用 ' `descr`' （`describe`命令），它仅适用于*当前*版本（而不是用于显示像 ' ' 这样的元素的所有历史记录`lshistory`）。

如果您的文件已被 rmnamed，请使用“-nvis”选项再次运行相同的命令（它只会找到视图中不可见（没有标准路径名）的元素及其分支和版本。

警告：如果您指定“之前”日期和“未来”日期（例如：' `&&!created_since(28-Apr)}`' 而我们还不是 4 月 28 日），它将始终选择 0 个版本（！？）。
这与您的问题无关，但是如果您错误地输入了“日期错误”，则可能会导致错误的印象，即没有版本可以找到，而实际上有版本可以找到。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-21T11:15:13.113

你看过[这个](http://www-01.ibm.com/support/docview.wss?uid=swg21124425)吗？具体如下部分。

> 如何查找带有特定注释的元素和版本
> 
> 我想找到所有带有特定评论的元素/版本，例如“Jane 在 11-26 改变了这个”</p>
> 
> M:\my_base_view\my_base_vob>cleartool find -all -exec "cleartool lshistory -minor -fmt \"%n\t%c\n\" \"%CLEARCASE_XPN%\"" >c:\output.txt
> 
> **这会将输出通过管道传输到文件中，您必须对文件进行 grep 查找以获取您要查找的特定注释。
> 
> M:\my_base_view\my_base_vob>cleartool 查找 . -version !"lbtype(LABEL_NAME)" -exec "cleartool describe -long %CLEARCASE_PN%" >c:\output2.txt

令人遗憾的是，看起来有点繁琐的过程。

# c# - 事件未显示在属性网格中

> ID：772036
> 
> 赞同：3
> 
> 时间：2009-04-21T10:54:49.200
> 
> 标签：c#, events, propertygrid, windows-forms-designer

我正在创建一个特殊的搜索文本框。除其他外，它有以下两个事件：

```
 [Category("Behavior")]
    public event EventHandler<GenericEventArgs<string>> Search;

    [Category("Property Changed")]
    public event EventHandler<EventArgs> ActiveColorChanged;

    [Category("Property Changed")]
    public event EventHandler<EventArgs> InactiveColorChanged; 
```

事情是只有底部的两个显示在设计视图属性事件浏览器中（不管它的名字是什么......）。我想知道为什么。是因为我没有使用标准`EventArgs`吗？但这不应该是这种情况，因为我的意思是，还有其他事件没有使用它......比如按键相关事件等......

该类`GenericEventArgs<T>`如下所示：

```
public class GenericEventArgs<T> : EventArgs
{
    public T Value { get; private set; }
    public GenericEventArgs() : this(default(T)) { }
    public GenericEventArgs(T value) { Value = value; }
} 
```

我在这里做错了什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-21T11:08:20.493

我怀疑***Property Grid***不支持您的双通用 EventHandler 类。试试这个：

```
public delegate void GenericHandler<T>(object sender, GenericEventArgs<T> e); 
```

如果这不起作用，请尝试一个完全非通用的处理程序，如果只是为了看看这是否是问题所在。

如果这*是问题所在，那么我建议您在*[Connect](http://connect.microsoft.com/visualstudio/)上创建一个关于它的错误报告，然后在此处发布错误的 URL，以便我们对其进行投票。

# c# - 在 c# 中使用 c++ 库

> ID：772041
> 
> 赞同：19
> 
> 时间：2009-04-21T10:56:09.257
> 
> 标签：c#, visual-studio, visual-c++

我正在尝试在我的 c# 项目中包含 c++ 库（DLL），但每次我这样做时，我都会在 VS2008 中收到以下错误消息，有什么建议吗？

**编辑：**这是一个 C++ MFC DLL

> ```
> ---------------------------
> Microsoft Visual Studio
> ---------------------------
> A reference to 'C:\Users\cholachaguddapv\Desktop\imaging.dll' could not be added. Please make sure that the file is accessible, and
> that it is a valid assembly or COM component. 
> ```

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-21T11:01:32.117

If it is a "normal" DLL (not COM, not managed C++), you cannot add a reference like this. You have to add p/invoke signatures (external static method definitions) for the exports you want to call in your DLL.

```
[DllImport("yourdll.dll")]
public static extern int ExportToCall(int argument); 
```

Have a look at the [DllImport](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.dllimportattribute.aspx) attribute in the online help.

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-21T11:00:40.480

If it's a straight C++ library then it's not possible to reference it in this way.

You have two options, you can compile the C++ library as an assembly an expose the unmanaged code with a C++/CLI wrapper.

-or-

You can use some p/invoke calls if the library exposes it's functionality via a C API.

Could you expand the question a bit to include some details about how you normally call imaging.dll from c++?

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-21T11:04:42.840

if it is a unmanaged dll you cannot add a reference to it. You have to invoke it using pinvoke or the likes of it:

```
public classFoo

{

[DllImport("myunmanaged.dll", CharSet = CharSet.Ansi)]

private extern static int UnmanagedFunction(int type, int dest);

} 
```

If you wanna convert it to a managed dll take a look here: [http://msdn.microsoft.com/en-us/library/aa446538.aspx](http://msdn.microsoft.com/en-us/library/aa446538.aspx)

If you wanna know some more about pinvoke and dllimport take a look here: [http://msdn.microsoft.com/en-us/library/aa288468.aspx](http://msdn.microsoft.com/en-us/library/aa288468.aspx)

Cheers

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-21T11:02:09.290

Calling convention and memory model difference between managed code (C#) and non-Managed code (WIn32 C++) make them incompatible.

However, .NET include a bridge technology for COM objects, so if you imaging DLL were a COM object, it could be made to work. It is, however, apparently not a COM object.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-21T11:02:59.617

If it's a clean C++ DLL where you only export C compatible functions, then you can use P/Invoke to use those functions. If you turn that C++ DLL into a COM DLL with a Type Library, using it is even easier: you can import the type library into .NET and .NET wrappers (called Runtime Callable Wrappers) are created for you.

# networking - 关于 Ping 的延迟

> ID：772042
> 
> 赞同：2
> 
> 时间：2009-04-21T10:56:19.100
> 
> 标签：networking, ping, latency

ping 返回的延迟是什么意思？

即下面的“时间”

```
C:\Users\guest>ping -n 2 www.google.com

Pinging www.google.com [62.252.60.89] with 32 bytes of data: 
Reply from 62.252.60.89: bytes=32 time=11ms TTL=58 
Reply from 62.252.60.89: bytes=32 time=15ms TTL=58

Ping statistics for 62.252.60.89:
    Packets: Sent = 2, Received = 2, Lost = 0 (0% loss), 
Approximate round trip times in milli-seconds:
    Minimum = 11ms, Maximum = 15ms, Average = 13ms 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-21T10:59:58.500

这是发送请求和接收响应之间的时间（也称为“往返时间”）。通常这对于 localhost 或本地网络只有几毫秒，但对于卫星传输来说可能非常大（相对）。

如果它可能超过一秒，您可能必须增加超时，以免将其检测为丢失的数据包。

下图向您展示了这个想法。

```
 `SENDER               RECEIVER
                  |    |
    ping request  |\   |
             ^    | \  |
             |    |  \ |
    latency -+    |   \| ping received
             |    |   /| ping response
             |    |  / |
             v    | /  |
    ping response |/   |
    received      |    |` 
```

* * *

 `## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T10:57:34.387

[Ping](http://en.wikipedia.org/wiki/Ping)测量往返延迟，即网络数据包从发送主机 A 到目标主机 B 并再次返回所需的时间。

# django - 子域的 Django 缓存

> ID：772050
> 
> 赞同：2
> 
> 时间：2009-04-21T10:58:23.167
> 
> 标签：django, caching, subdomain

我通过**中间件黑客**在 django 中为用户页面使用**子域，其方式与**[此处](https://stackoverflow.com/questions/624827/in-a-django-web-application-how-do-you-give-users-their-own-subdomain)描述的类似：

 **现在，我为未登录用户的所有页面打开了默认的 django 缓存。我不得不**为用户页面隐式禁用缓存，**因为它将这些页面视为 / 页面，例如 filmaster.com 和 michuk.filmmaster.com 与 django 相同。

您是否知道强制 django 理解子域以进行缓存的任何好方法和简单的方法？或者你是否建议我明确地缓存每个子域视图？

**更新**：实际上研究了该[解决方案](https://stackoverflow.com/questions/624827/in-a-django-web-application-how-do-you-give-users-their-own-subdomain)，但这并不是我们的做法。我们不重定向。我们希望 url 保留在子域中，所以我们所做的只是直接从中间件调用视图。

您可以在此处查看 hacky 实现的详细信息：musielak.eu/public/film20/film20/core/middleware.py [**未找到更新：404 页面**]（用户：justlookingaround，pass:film@ster -- 是的，我们'重新开源）。这是一个修复黑客的jira：jira.filmmaster.org/browse/FLM-54（但这与问题并不完全相关 - 只是为了确保您不认为我们支持蹩脚的编码：P）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-01T15:35:05.597

不幸的是，我无法解决您的主要问题（缓存子域），只是说我读过的所有内容都暗示 Django 无法以任何优雅的方式处理这个问题。这可能在 1.1 版中有所改变，但如果是这样的话，我还没有遇到任何关于它的信息。在我的特定应用程序中，无论如何我都无法缓存子域，因此我没有研究可能需要进行哪些内部修改才能使这项工作更好。

但是，关于访问子域视图的方式，您可能会考虑的另一个选项是这样的：

```
class SubdomainMiddleware:
    """
    Make the company specified by the subdomain available to views for
    appropriate processing.
    """
    def process_request(self, request):
        """
        Populate a company attribute on the request object with the company
        indicated by the requested subdomain.
        """
        domain_parts = request.get_host().split('.')

        if (len(domain_parts) > 2):
            subdomain = domain_parts[0]

            if (subdomain.lower() == 'www'):
                subdomain = ''
        else:
            subdomain = ''

        if subdomain != '':
            try:
                request.company = Company.objects.get(subdomain=subdomain)
            except Company.DoesNotExist:
                return HttpResponseRedirect(''.join(['http://test.com', reverse('findcompany')]))                
        else:
            request.company = None 
```

我认为这是不言自明的——它是我在[djangosnippets](http://www.djangosnippets.org/)上找到的东西的一个经过大量修改的版本。它只是解析子域，在公司表中查找它，如果这是一个有效的公司，它将被附加到请求对象以供视图处理。这样，如果 test.com/test 和 sub.test.com/test 都有效，那么视图可以包含该逻辑，而不是将其推入中间件。此外，垃圾子域很容易传递给搜索 url。

我本来打算将此与您的中间件进行比较（更多的是为了我自己的教育而不是其他任何东西），但是您为代码提供的 URL 返回 404。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-01T22:22:14.637

好的，这是我们实际使用的修复程序。不幸的是，它确实涉及破解 Django 代码，特别是 django/trunk/django/utils/cache.py 中的 _generate_cache_header_key 方法我们所做的只是检查 HTTP 主机中是否有任何子域，如果有，从中提取子域并将其附加到缓存键。我们也可以简单地附加主机，它的工作方式非常相似，但会在 RAM 中占用一些更宝贵的位。

这是 jira： http: [//jira.filmmaster.org/browse/FLM-84](http://jira.filmaster.org/browse/FLM-84) 这是使用的代码。使用风险自负！

```
def _generate_cache_header_key(key_prefix, request):
    """
       Returns a cache key for the header cache.
       With Filmaster hack for handling subdomain caching: http://jira.filmaster.org/browse/FLM-84
    """
    subdomain = None
    path = request.path

    # TODO: this is not a decent implementation, it will work only on domains with one dot it them
    # To fix it, we'd need to pass a param to the request object before CacheMiddleware
    # this current domain name in it, and use that domain name in the regexp below
    m = re.match(r"([^\.]+)\.[^\.]+\.[^\.]+", request.META['HTTP_HOST'])
    if m!=None:
        subdomain = m.group(1)

    if subdomain != None:
        path = subdomain + "___" + path
    path = md5_constructor(iri_to_uri(path))
    return 'views.decorators.cache.cache_header.%s.%s' % (key_prefix, path.hexdigest()) 
```

# c# - 是否可以让一个参数实现两个接口？

> ID：772053
> 
> 赞同：25
> 
> 时间：2009-04-21T10:59:49.187
> 
> 标签：c#, .net, interface, parameters

是否可以定义一个接受必须实现两个接口的参数的函数？

（这两个界面是我刚想起来的，不是我想用的）

```
private void DoSomthing(IComparable, ICollection input)
{

} 
```

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-04-21T11:02:21.847

你可以：

1）定义一个接口，继承两个必需的接口：

```
public interface ICombinedInterface : IComparable, ICollection {... }

private void DoSomething(ICombinedInterface input) {... } 
```

2）使用泛型：

```
private void DoSomething<T>(T input)
    where T : IComparable, ICollection
{...} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-21T11:01:24.270

您可以从这两个接口继承另一个接口，并使您的参数实现该接口。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-21T11:05:53.713

嗯，是的，也不是。

正如史蒂夫建议的那样，您可以创建另一个第三个接口，该接口源自您想要的两个接口，并将其用于参数类型。

但是，这也将要求所使用的类也实现第三个接口。

换句话说，这是行不通的：

```
public interface I1 { }
public interface I2 { }
public class C : I1, I2 { }

public interface I3 : I1, I2 { }
public class YourClass
{
    public void Test(I3 i) { }
}

...
YourClass yc = new YourClass();
C c = new C();
yc.Test(c); // won't work, C does not implement I3 
```

但是，您可以通过泛型将编译器欺骗成您想要的。

```
public class YourClass
{
    public void Test<T>(T i) where T: I1, I2 { }
} 
```

现在它将起作用。我仍然不能 100% 确定这不会给您带来其他问题，但我必须考虑一下。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-08-04T18:08:01.243

上面提到的泛型函数方法是一种很好的方法，但有一个很大的警告：为了对对象进行类型转换，以便可以将其传递给具有多个泛型约束的例程，必须知道满足这些约束并且是父类型的类型被投射的对象。接受此类对象的例程将知道此类类型（它作为泛型类型参数传入），但类没有很好的方法来保存此类信息并在以后使用它。如果各种不相关的类型都实现了 IFoo 和 IBar，那么很难设计一个可以接受多个不相关对象实例的例程，将它们存储在列表或其他东西中，然后将列表中的所有项目传递给例程使用通用 IFoo+IBar 参数。

如果这种情况可能是必要的，最好的方法是为每个通用例程设置一个非通用对应项，该例程将接受例如 IFoo 类型的参数并根据需要将其转换为 IBar。然后可以将所有项目存储在 List<IFoo> 中并将它们传递给例程。人们会失去泛型方法的类型安全性，但有时无法实现完美的类型安全性。

# c# - C#：如何在 xml 注释中引用 default(T) 和构造函数

> ID：772069
> 
> 赞同：3
> 
> 时间：2009-04-21T11:03:55.387
> 
> 标签：c#, generics, xml-documentation

我有这门课，你在下面的答案中看到。在那里我可以参考例如`Value`with`<see cref="Value"/>`和类本身 with `<see cref="GenericEventArgs{T}"/>`。

1.  我如何引用默认值（T）？甚至可能吗？
2.  如何引用构造函数？

* * *

```
/// <summary>
/// A simple <see cref="EventArgs"/> class that can contain a value.
/// </summary>
/// <typeparam name="T">Type of <see cref="Value"/>.</typeparam>
public class GenericEventArgs<T> : EventArgs
{
    /// <summary>
    /// Instantiates a <see cref="GenericEventArgs{T}"/> with 
    /// <see cref="default"/> default as Value.
    /// </summary>
    public GenericEventArgs()
        : this(default(T)) {}

    /// <summary>
    /// Instantiates a <see cref="GenericEventArgs{T}"/>
    /// </summary>
    /// <param name="value"></param>
    public GenericEventArgs(T value)
    {
        Value = value;
    }

    /// <summary>
    /// The value.
    /// </summary>
    public T Value { get; private set; }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T11:11:10.360

.net 文档本身将其称为：“值参数类型的默认值”。

[请参阅Dictionary.TryGetValue](http://msdn.microsoft.com/en-us/library/bb347013.aspx)的文档

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T11:06:53.710

不，我认为这是不可能的。由于该类在运行时使用正确的类型进行了 JIT，因此文档与使用的实际类型无关。如果您使用类约束，您可以用“null”替换默认值。

# asp.net - Using FindControl on Dynamically Generated Controls

> ID：772074
> 
> 赞同：1
> 
> 时间：2009-04-21T11:06:04.257
> 
> 标签：asp.net, dynamic-controls

I have some ASP.NET code that dynamically generates rows and cells for a Table control on the page.

I have specifically set the ID of each cell, but I am having trouble getting FindControl to actually find them.

Here's the code that I use to create the cells:

```
tbc = New TableCell
tbr.Cells.Add(tbc)
tbc.ID = String.Format("tc_{0}-{1}-{2}", curStartDate.Day, curStartDate.Month, curStartDate.Year) 
```

Just below that, I try to find the control with the following:

```
Dim ctlName As String = String.Format("tc_{0}-{1}-{2}", curStartDate.Day, curStartDate.Month, curStartDate.Year)
Dim ctl As Control = tblAllocations.FindControl(ctlName) 
```

I have tried swapping the line that declares the ID, with the line that adds the cell to the Cells collection of the TableRow, and that makes it work. But throughout my application, I have the statements in the order as above, and they works fine (FindControl can find the control with the correct ID).

Is there something obvious I am missing?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T11:37:59.000

当您说“略低于此”时，您是否已将 tbr 添加到 tblAllocations.Rows 中？如果不是那将是找不到它的原因。

# c# - Global event handler for all controls for User Help

> ID：772079
> 
> 赞同：2
> 
> 时间：2009-04-21T11:07:23.677
> 
> 标签：c#, winforms, events, context-sensitive-help

HI, I'm extending a windows application written in C# to provide help to the user (in the context of the focused control) when they hit the F1 key.

What I’d like to do is make use of the Control.HelpRequested event but I’m not sure how to extend all the controls to handle this event. [http://msdn.microsoft.com/en-us/library/system.windows.forms.control.helprequested.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.helprequested.aspx)

It’s not really feasible to update each control “by hand” to handle this event and I really don’t like the idea of looping through all the controls in a form (as the form opens) to associate the event handler.

Is there a neat way to extend all controls of a form to handle a specific event?

This is just made up but i almost feel like i should be able to write something like this

```
[HandleEvent Control.HelpRequested, ApplyTo Typeof(Control)]
void MyEventHandler(object sender, EventArgs e)
{
// code to handle event...
}
```

Any suggestions or perhaps ideas on a different approach are much appreciated - Thanks

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-21T11:19:43.943

此示例 ( [http://www.codeproject.com/KB/cs/ContextHelpMadeEasy.aspx](http://www.codeproject.com/KB/cs/ContextHelpMadeEasy.aspx) ) 显示了如何在 WndProc 中捕获 F1 键，然后仅显示一种方法的帮助。

那篇文章中的想法是实现一个公开控件 ID 的接口，然后根据该 ID 显示上下文帮助。F1 处理程序然后检查您的控件是否实现了该接口，如果没有，则它检查控件的父级，直到找到该接口的实现。

但更简单的方法（如果您不想为每个控件添加 ID）是修改 F1 处理程序以显示基于静态类型字典（例如 Dictionary）的上下文帮助，该字典将包含每个受支持控件的主题 ID . 因此，每当您需要将主题与指定控件相关联时，您都会更新字典。

同样，通过向该字典添加某种提供者（委托或接口）来为这种方法添加更多抽象会更明智。例如，您可能需要额外的逻辑来根据控件的类型、名称或其他一些属性来显示主题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T11:17:56.727

> 我真的不喜欢循环遍历表单中的所有控件（当表单打开时）以关联事件处理程序的想法。

我能问为什么不吗？

您可以编写一个将委托和类型列表作为参数的函数，这将与您的“希望”HandleEvent 属性具有完全相同的效果。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-07-24T17:26:16.880

[`HelpRequested`](https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.control.helprequested?WT.mc_id=DT-MVP-5003235&view=netframework-4.8)支持冒泡机制。它为您的活动控件触发，如果您不处理该事件并且未将`Handled`其事件 arg 的属性设置为`true`，那么它会冒泡到父控件层次结构以形成。

因此，处理您`HelpRequested`的表单就足够了，然后，您可以根据对表单或其父层次结构的主动控制来决定要显示的帮助。

**例子**

如果你处理`HelpRequested`如下形式的事件，那么当你按下`F1`一个消息框时会弹出并显示活动控件的名称：

```
private void Form1_HelpRequested(object sender, HelpEventArgs hlpevent)
{
    var c = this.ActiveControl;
    if(c!=null)
        MessageBox.Show(c.Name);
} 
```

# asp.net - Show Download option in C#

> ID：772082
> 
> 赞同：1
> 
> 时间：2009-04-21T11:08:20.930
> 
> 标签：asp.net, c#-2.0

I need to download an Access file(Inbox.mdb) file when clicked on asp.net button...?
How do i do this is C# / ASP.NET .
Any help would be appreciated.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T11:18:57.970

```
<!-- in your aspx file -->
<asp:button id="btnDownload" runat="server" onclick="btnDownload_Click" text="Download Your MDB" />

// and then in your codebehind file
protected void btnDownload_Click(object sender, EventArgs e)
{
    string pathToYourMDB = @"c:\stuff\test.mdb";
    string downloadName = "YourData.mdb";

    Response.Clear();
    Response.ContentType = "application/octet-stream";
    Response.AddHeader("Content-Disposition", "attachment; filename=\"" + downloadName+ "\"");
    Response.TransmitFile(pathToYourMDB);
    Response.End();
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T11:16:52.093

如果文件只是在您的服务器上公开托管，则您不需要使用任何 C#/ASP.NET 功能。

只需添加一个普通的

```
<a href="~/Path/To/Inbox.mdb">Link</a> 
```

如果您必须使用服务器端按钮，那么

```
Response.Redirect("~/Path/To/Inbox.mdb"); 
```

将重定向到该文件并导致浏览器下载它。

如果它存储在其他地方（即不可公开访问），那么您需要从它在服务器上的位置流式传输它。通过 Response 对象在 google 上查看流文件的示例。

# c# - Setting Default URL in Web.Config for website

> ID：772084
> 
> 赞同：3
> 
> 时间：2009-04-21T11:08:30.383
> 
> 标签：c#, asp.net

When users navigate to my site, I want it to display :

```
http://example.com 
```

and not:

```
http://example.com/default.aspx 
```

How can I do that?

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-21T11:15:00.197

This is done from within IIS:

*   [From IIS 6](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/dc6eb1b4-9028-4308-9935-52b64edfad36.mspx?mfr=true)
*   [From IIS7](http://www.netomatix.com/development/IIS7Configuration3.aspx)
*   [IIS 7 from web.config file](http://blogs.iis.net/bills/archive/2008/03/22/how-to-add-a-default-document-with-iis7-web-config.aspx)

You might also be able to do it by setting up some url mappings. Check [here](http://bytes.com/groups/net-asp/638842-possible-config-default-page-web-config) for more details.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T11:15:47.807

It's [possible](http://blogs.iis.net/bills/archive/2008/03/22/how-to-add-a-default-document-with-iis7-web-config.aspx) (indeed encouraged) with IIS7, but the only way I'm aware of to do this in IIS6 is ugly urlmapping tricks:

```
<system.web>
  <urlMappings>
    <add url="~/Default.aspx" mappedUrl="~/YourPage.aspx"/>
  </urlMappings>
</system.web> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T11:11:30.423

Either you set the default page in your IIS or inside your solution explorer by right-clicking and selecting "Set as start page".

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-02-21T12:20:48.933

在`IIS->your site->right click->property->Default Document`

设置要在加载时打开的默认页面

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-21T11:27:07.437

如果您在 IIS 下运行您的网站，只需在 Windows 中启动 IIS 管理器，然后在树中打开您的网站并双击默认文档图标。在打开的窗口中确保 index.aspx 设置存在，如果没有放入并将其移动到列表中的第一个。

还有一种方法可以通过管理脚本 (vbscript) 设置默认文档，如下所示：

```
set node=getObject("IIS://LocalHost/W3SVC/1/Root")
node.defaultdoc = "index.aspx" & "," & node.defaultdoc
node.setinfo 
```

# c++ - 在 Visual Studio 2005 中基于命令行作为 GUI 应用程序或控制台应用程序启动的一个可执行文件

> ID：772089
> 
> 赞同：4
> 
> 时间：2009-04-21T11:11:49.347
> 
> 标签：c++, visual-studio, qt, visual-studio-2005

我在[Visual Studio 2005中有一个](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio#Visual_Studio_2005)[Qt](https://en.wikipedia.org/wiki/Qt_%28software%29)应用程序，它使用这样的方式链接，当我运行编译后的可执行文件时，它也不会创建命令行终端。`\subsystem:windows`

我想创建一个命令行模式：当我使用`--nogui`命令行参数启动它时，不会显示 GUI，而是运行一个简单的命令行程序。由于链接使用`/subsystem:windows`，因此命令行模式不会显示任何`std::cout`输出，除非我将可执行文件与`\subsystem:console`.

有没有办法设置编译/链接，以便相同的可执行文件可以呈现 GUI 窗口或基于命令行参数充当控制台应用程序？

PS。我使用 Qt 4.2.0 和 Visual Studio 2005，该项目使用 C++。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-07-05T04:42:36.923

我认为这里情况的首选技术是“.com”和“.exe”方法。在 Windows 的命令行中，如果您运行程序但未指定扩展名，则查找可执行文件的优先顺序将[.com 优先于 .exe 文件](https://stackoverflow.com/questions/605101/order-in-which-command-prompt-executes-files-with-the-same-name-a-bat-vs-a-cmd/605139#605139)。

然后，您可以使用技巧让“.com”成为 stdin/stdout/stderr 的代理并启动同名的 .exe 文件。这给出了允许程序在从控制台调用时以命令行模式执行的行为（可能仅在检测到某些命令行参数时），同时仍然能够作为没有控制台的 GUI 应用程序启动。

有各种文章对此进行了描述，例如“如何将应用程序同时作为 GUI 和控制台应用程序？” （请参阅下面链接中的参考资料）。

我在 google 代码上托管了一个名为[dualsubsystem](http://code.google.com/p/dualsubsystem/ "双子系统")的项目，该项目更新了该技术的旧 codeguru 解决方案，并提供了源代码和工作示例二进制文件。

我希望这会有所帮助！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-21T12:01:08.617

你不能。请参阅 Raymond Chen 的这篇文章：

> [**如何编写可以作为控制台或 GUI 应用程序运行的程序？**](https://web.archive.org/web/20100506201350/http://blogs.msdn.com:80/oldnewthing/archive/2009/01/01/9259142.aspx)

由于本文中给出的原因，您有时会看到提供的同一工具的两个版本，一个以“w”为后缀，例如 Windows 上的 java.exe 和 javaw.exe。

但是，您可以实现这个巧妙的解决方法：[如何将应用程序同时作为 GUI 和控制台应用程序](https://docs.microsoft.com/en-us/archive/blogs/junfeng/how-to-make-an-application-as-both-gui-and-console-application)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-21T11:16:51.610

您是否尝试过[`AttachConsole`](http://msdn.microsoft.com/en-us/library/ms681952.aspx)在程序中调用以将输出重定向到调用终端？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-09T23:21:18.817

要使用 AttachConsole，您需要在包含 <windows.h> 之前包含以下行：

```
//Require at least Windows XP
#define _WIN32_WINNT 0x0501 
```

# sql-server - 删除然后在数据库中创建约束是否安全

> ID：772090
> 
> 赞同：2
> 
> 时间：2009-04-21T11:12:14.383
> 
> 标签：sql-server, forum

我有点困惑，需要你的帮助。我有一个包含 150 多个表的数据库。我有几个应该支持 Unicode 的字段，但现在它们不支持，因此我想在此过程中将列数据类型更改为 ntext 和 nvarchar，我必须删除约束然后再次创建它们。删除约束并再次创建它们是否安全。

*我有 286 列要更改，只是不知道在此过程中必须删除和创建许多约束。

*我想知道的是，改变一个成熟项目的列数据类型是否安全。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T11:15:31.130

如果您可以在数据库不活动的情况下执行此操作，那么它应该是安全的。要记住的重要事项是确保您记录了所有约束，它们都不会受到列类型更改的影响（或者如果它们是您已经减轻的）并且您清楚依赖关系在这些约束之间。

我想我只是说，确保你有一个清晰的流程并且你遵循它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T11:39:07.470

但是有一个更好的方法：**你可以禁用索引。** [请参阅 msdn](http://msdn.microsoft.com/en-us/library/ms177406.aspx)。这保留了索引定义。

如果您在客户机器上运行此程序（例如使用安装程序），您应该将数据库置于单用户模式，以确保同时没有应用程序插入数据。这将允许不一致的数据，您将无法创建/启用索引。

**编辑：**（gbn评论后）

禁用很可能不适用于您的情况。

我们在升级数据库的时候也去掉了约束，一般都是save。其他方面已经被其他人提到过：您需要全部了解它们才能创建它们。有一些工具可以从现有数据库创建脚本，或者您可以自己编写。所有信息实际上都应该在数据库中。例如，您从管理工作室获得脚本，但只能一个接一个（据我所知）。

如果您在生产环境中执行此操作，则可以将数据库置于单用户模式以确保没有应用程序尝试使用它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-21T11:39:29.090

所有这些都可以使用 3rd 方比较工具以事务方式完成（全部完成或全部回滚）。

也就是说，您可以在开发中单独进行更改（使用 SSMS 进行更改）但生成“安全”更改和回滚脚本（但始终有备份）。

否则，这样做是安全的：如果有人当时正在使用数据库并且输入错误的数据或尝试没有索引的查询，则可能会出现问题。

3rd-party-tool-uses-transaction 方法在整个更改期间锁定对象。

当然，您可以一次做一个，而不是大爆炸，但这些工具仍然有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T13:34:25.743

我们一直在进行模式更改，这是我们的一般程序：

对于每个表：

*   在 SQL Server Management Studio 中进行更改，您会注意到这些脚本会一直删除和重新创建约束，没有任何问题

*   生成脚本，将它们复制到文件中

*   取消更改（不要将它们应用于数据库）

转到与生产模式完全相同的测试/开发数据库并运行您的脚本

如果您有任何错误，请解决它们，恢复测试/开发并重新测试

如果你没有错误

*   根据需要进行备份

*   如有必要，安排与用户一起关闭应用程序

*   将数据库置于单用户模式，这将防止在缺少约束时更改任何数据

*   运行脚本文件

*   使数据库脱离单用户模式

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-21T14:18:10.833

[您可以尝试禁用和启用它们](https://stackoverflow.com/questions/159038/can-foreign-key-constraints-be-temporarily-disabled-using-tsql/161410#161410)的方法，而不是删除和重新创建约束。我不确定如果同时更改列类型这是否可行，但只要保持列名不变，就值得测试

# wxwidgets - How can I auto-scroll a wxTreeControl widget while dragging with the mouse?

> ID：772094
> 
> 赞同：0
> 
> 时间：2009-04-21T11:14:53.237
> 
> 标签：wxwidgets, scrollbar, treecontrol

I have a wxTreeCtrl widget with scroll bars, where I want to drag and drop items on other items. But when I drag an item, how can I make the control automatically scroll invisible items into view?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T19:08:16.500

据我所知，你应该手动完成。从 wxTreeCtrl 派生一个类，重写相关方法来捕获鼠标拖动事件。然后在拖动到顶部/底部时手动调用合理量的滚动功能。

# mysql - 替换两条记录中的外键值（唯一）

> ID：772102
> 
> 赞同：1
> 
> 时间：2009-04-21T11:16:49.723
> 
> 标签：mysql

MySQL 似乎没有延迟约束，直到实现的事务结束。如果是这样，在两个孩子记录中切换父母的最佳方法是什么？

例如，如果我们有一些 UI 插槽，每个用户都可以在其中放置物品。如果在 item 表中 slotid 是 FK 并且在 Items 表中的 itemId 和 slotId 列上有唯一索引，应该如何在用户的插槽中切换项目？

有没有比在事务中使用 SET FOREIGN_KEY_CHECKS=0 和三个更新更好的方法呢？

[编辑] SlotId 不可为空，不应该给定项目总是必须在某个插槽中 - 因此将其设置为可为空意味着放弃语义正确性和重要的安全检查，只是为了使一些实现细节更容易。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T12:20:41.880

将它们清空，如果要更新的列可以为空，然后更新，或者删除并插入。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-23T11:22:30.567

[**我在这篇文章中**](http://explainextended.com/2009/03/26/sorting-lists-moving-items/)描述了类似的问题。

似乎使列`NULL`'able 是较小的邪恶，因为在这种情况下您不必禁用外键约束。

# c# - TypeDescriptor.GetProperties(thisType) 返回属性，这是只写的

> ID：772107
> 
> 赞同：1
> 
> 时间：2009-04-21T11:17:36.383
> 
> 标签：c#, propertydescriptor, typedescriptor

我试图从一个类型中获取所有属性，但是使用 TypeDescriptor.GetProperties(thisType) 只会为我提供属性，它同时具有 setter 和 getter。我有只写属性。有没有办法检索包括这些在内的 PropertyDescriptorCollection？

/阿斯格

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-21T12:28:25.057

只写属性是一种罕见的野兽，在 System.ComponentModel / PropertyDescriptor 空间中不存在。`PropertyDescriptor`s 被设计成可读的。我可能会破解`HyperDescriptor`shim 只写属性，但这将是一个破解 - 并且它可能必须为 抛出异常`get`，这可能会影响调用代码。

作为旁白; 我通常建议*不要*使用只写属性；人们小跑的教科书示例是密码（`public string Password {private get;set;}`）-我宁愿有一种`void SetPassword(string newPassword)`方法...

你真正想做的是什么？这里有很多选择，都是可以实现的：

*   单独使用反射（慢；也许不是一个选项）
*   使用`Delegate.CreateDelegate`（非常简单）
*   使用`Expression.Compile`（*有点难*，但不多）
*   使用`Reflection.Emit`（相当困难）
*   将只写属性填充到`PropertyDescriptor`（非常困难）

如果你让我知道你真正想做什么（而不是你目前尝试做的方式），我可能会提供更多帮助。

作为一个使用示例`Delegate.CreateDelegate`（请注意，您可能希望将委托存放在某处并多次重复使用它）：

**如果您在运行时不知道特定类型，则编辑以显示如何执行此操作**

```
using System;
using System.Reflection;

class Foo
{
    public string Bar { private get; set; }
    public override string ToString()
    {
        return Bar; // to prove working
    }
}
static class Program
{
    static void Main()
    {
        ISetter setter = Setter.Create(typeof(Foo), "Bar");
        Foo foo = new Foo();
        setter.SetValue(foo, "abc");
        string s = foo.ToString(); // prove working
    }
}
public interface ISetter {
    void SetValue(object target, object value);
}
public static class Setter
{
    public static ISetter Create(Type type, string propertyName)
    {
        if (type == null) throw new ArgumentNullException("type");
        if (propertyName == null) throw new ArgumentNullException("propertyName");
        return Create(type.GetProperty(propertyName));
    }
    public static ISetter Create(PropertyInfo property)
    {
        if(property == null) throw new ArgumentNullException("property");
        if (!property.CanWrite) throw new InvalidOperationException("Property cannot be written");
        Type type = typeof(TypedSetter<,>).MakeGenericType(
                property.ReflectedType, property.PropertyType);
        return (ISetter) Activator.CreateInstance(
            type, property.GetSetMethod());
    }
}

public class TypedSetter<TTarget, TValue> : ISetter {
    private readonly Action<TTarget, TValue> setter;
    public TypedSetter(MethodInfo method) {
        setter = (Action<TTarget, TValue>)Delegate.CreateDelegate(
            typeof(Action<TTarget, TValue>), method);
    }
    void ISetter.SetValue(object target, object value) {
        setter((TTarget)target, (TValue)value);
    }
    public void SetValue(TTarget target, TValue value) {
        setter(target, value);
    }
} 
```

* * *

或者使用`Expression`API (.NET 3.5)：

```
using System;
using System.Linq.Expressions;
using System.Reflection;

class Foo
{
    public string Bar { private get; set; }
    public override string ToString()
    {
        return Bar; // to prove working
    }
}
static class Program
{
    static void Main()
    {
        Action<object,object> setter = Setter.Create(typeof(Foo), "Bar");
        Foo foo = new Foo();
        setter(foo, "abc");
        string s = foo.ToString();
    }
}

public static class Setter
{
    public static Action<object,object> Create(Type type, string propertyName)
    {
        if (type == null) throw new ArgumentNullException("type");
        if (propertyName == null) throw new ArgumentNullException("propertyName");
        return Create(type.GetProperty(propertyName));
    }
    public static Action<object,object> Create(PropertyInfo property)
    {
        if(property == null) throw new ArgumentNullException("property");
        if (!property.CanWrite) throw new InvalidOperationException("Property cannot be written");

        var objParam = Expression.Parameter(typeof(object), "obj");
        var valueParam = Expression.Parameter(typeof(object), "value");
        var body = Expression.Call(
            Expression.Convert(objParam, property.ReflectedType),
            property.GetSetMethod(),
            Expression.Convert(valueParam, property.PropertyType));
        return Expression.Lambda<Action<object, object>>(
            body, objParam, valueParam).Compile();
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-21T11:23:06.480

改为使用[`System.Type.GetProperties()`](http://msdn.microsoft.com/en-us/library/aky14axb.aspx)它返回所有属性。请注意，这将返回 a`PropertyInfo[]`而不是 a `PropertyDescriptorCollection`。

# php - sql 加入或调用另一个模型？

> ID：772108
> 
> 赞同：0
> 
> 时间：2009-04-21T11:17:37.740
> 
> 标签：php, oop, model

我有两个表（项目和类别，我认为它们不言自明）和两个关联的模型对象。我在从数据库中获取 1 项的函数中面临设计决策。我还需要这个方法来返回项目的类别（名称，而不仅仅是 id）。

我有两个选择：

*   在项目模型中，使用 SQL 连接可以更快地获取数据。
*   在item模型中，调用category模型获取数据，以获得更好的代码。

我应该做什么？无论如何，我都需要一个类别模型，因为我还将显示类别列表等。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T12:41:40.080

如果需要，您可以随时进行优化。在许多情况下，第二次选择的开销可以忽略不计。

你的时间不是那么微不足道。维护代码的人（你？其他人？）也不是时间。

干净地编码，调用类别，如果结果“太慢”，则更改它。

过早的优化是万恶之源。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T11:32:41.433

在不了解更多细节的情况下，如果这是应用程序的速度关键部分，我倾向于倾向于第一个选项。只要确保代码有很好的注释。如果你有速度玩并且两次执行之间的时间没有太大差异，我会做第二次。因为当你在两年后回到它时，它会变得不那么有意义，为什么项目模型会提取类别信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T11:33:24.207

我也遇到过问题......总的来说，我发现如果您正在寻找性能，您应该加入。如果速度不是问题，请选择第二个。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T11:34:28.760

如果您仍然要获取类别，那么为什么不保存/缓存它并使用相同的对象来查找类别名称而不是 sql 连接。在那种情况下，关于 sql 连接会更快的论点现在在某种程度上可以忽略不计

除非它是对速度至关重要的大量数据，否则我可能会采用您最喜欢维护的任何方法。

# jsp - JSP1.2和JSP2.0的区别

> ID：772110
> 
> 赞同：2
> 
> 时间：2009-04-21T11:18:06.117
> 
> 标签：jsp, jsp-tags

JSP1.2和JSP2.0的区别

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-21T11:20:21.650

请参阅[JSP 2.0 - 新政](http://www.onjava.com/pub/a/onjava/2003/11/05/jsp.html)

为澄清起见，本文在第一节中逐项列出了添加到 JSP 2.0 的增强功能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-21T13:36:41.697

除了[JSP 2.0 - The New Deal](http://www.onjava.com/pub/a/onjava/2003/11/05/jsp.html)中提到的内容之外，一个经常被忽视的 JSP 2.0 新特性是 JSP 标记文件，它是使用 JSP 创建可重用组件的一种非常酷的方式。这可以是只做许多不同 JSP 页面中使用的一件事的小标签（例如，以特殊方式格式化货币样式），或者它可以用于一般[模板组合](http://fforw.de/post/Creating_JSP_Layouts_with_Page_Tags/)。

# mysql - 从 MySQL 切换到 PostgreSQL - 提示、技巧和陷阱？

> ID：772111
> 
> 赞同：35
> 
> 时间：2009-04-21T11:18:24.993
> 
> 标签：mysql, postgresql, migration, load-data-infile

我正在考虑从 MySQL 切换到 PostgreSQL。

您在使用 PostgreSQL 时有哪些提示、技巧和陷阱？

MySQLer 应该注意什么？

> 另请参阅：[PostgreSQL 与 MySQL 有何不同？](https://stackoverflow.com/questions/724867/how-different-is-postgresql-to-mysql)
> 另请参阅：[从 MySQL 迁移到 PostgreSQL](https://stackoverflow.com/questions/2831009/migrate-from-mysql-to-postgresql-on-linux-kubuntu/2831517)

**注意 - 我不认为这是重复的。特别是答案的类型非常不同，这里的响应有更多的实现细节，这就是我正在寻找的**

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-04-21T11:51:37.893

我自己刚刚经历过，好吧，我仍然......

*   区分大小写的文本
*   缺乏`INSERT IGNORE`和`REPLACE`
*   几乎所有地方都需要显式转换
*   没有反引号
*   `LOAD DATA INFILE`（`COPY`很接近，但不够接近）
*   更改`autoincrement`为`SERIAL`
*   虽然 MySQL 中的格式不好，但在 Postgres 中，`INNER JOIN`没有`ON`子句的情况不会发生，使用`CROSS JOIN`等
*   `COUNT(*)`可能会很慢
*   数据库是用字符集编码的，而不是表
*   您可以拥有多个数据库，具有多个架构（MySQL 确实只有一个数据库和多个架构）
*   分区不一样
*   MySQL `interval`vs. Postgres `interval`（时间间隔）
*   隐式列重命名，Postgres 需要`AS`
*   无法在 Postgres 中同时更新多个表
*   Postgres 功能强大。所以没有`CALL proc();`；重写`proc()`为函数和`SELECT proc();`.

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-21T15:56:25.760

这将是一项艰巨的任务，因为您必须测试整个代码库——每一个查询，任何地方，

*   句法
*   正确的行为（即返回相同的结果）
*   性能 - 例如，是否有任何性能回归/改进，你能处理它们吗？
*   错误处理 - 它们在错误条件下的行为不同，可能您的代码依赖于特定的错误代码

在操作上，您需要查看：

*   备份/恢复
*   磁盘空间利用率
*   内存利用率
*   一次性数据迁移 - 可能是一项大/耗时的任务
*   失败时的回滚计划
*   监控 - 你如何监控你的 MySQL，这些方法可以调整吗
*   （如果相关） - 复制

在考虑采取这样的举措之前，您肯定必须进行大量的性能测试。

对于大多数重要的应用程序来说，这些成本使得迁移到不同的数据库过于昂贵。***非常***仔细地考虑与执行上述所有操作的巨大成本相比的好处。

如果您在一个非平凡的应用程序中花费不到三个月的时间，我会感到惊讶，在此期间您将无法继续进行常规开发。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-21T11:34:09.807

您可以尝试包含最常见问题的[PostgreSQL 陷阱。](http://sql-info.de/postgresql/postgres-gotchas.html "PostgreSQL 陷阱")一般来说，PostgreSQL 文档也很不错，所以也请把它放在枕头底下。

此外，在 pgsql wiki 上[从 MySQL 转换为 PostgreSQL 。](http://wiki.postgresql.org/wiki/Converting_from_other_Databases_to_PostgreSQL#MySQL)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-04-05T07:58:39.517

我发现这个脚本将连接到你的 MySQL 数据库和你的 PostgreSQL 数据库，并且只是传输内容。它对我来说就像一个魅力。

[https://github.com/philipsoutham/py-mysql2pgsql](https://github.com/philipsoutham/py-mysql2pgsql)

安装者

```
$ pip install py-mysql2pgsql 
```

跑

```
$ py-mysql2pgsql 
```

在任何文件夹中，它将为您创建一个模板设置文件（mysql2pgsql.yml），您可以在其中编辑和输入数据库的详细信息。

我必须安装 argparse 才能工作。

```
$ pip install argparse 
```

填写完数据库详细信息后，再次运行即可

```
$ py-mysql2pgsql 
```

在与设置文件相同的文件夹中，然后，您就完成了。它没有在屏幕上打印任何内容，但是之后我的数据库被完全复制了。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-21T11:36:38.693

在转换之前，通过使用以下命令启动服务器，将 MySQL 设置为 ANSI-strictness：--transaction-isolation=SERIALIZABLE --sql-mode=ANSI

确保您没有使用 MyIsam 表。

MySQL 允许大量不应该的转换；pg 将需要演员表。

您存储的过程、函数和触发器必须重新编写。pg 为您提供了这些语言的选择，但您必须安装这些语言；它不像 MySQL 那样用户友好。

pg 将只允许在一个选择列表中的列在 group by 或聚合；如果这样做，MySQL 将通过选择组中的第一个值来作弊。

MySQL 增加了一堆扩展：不等于运算符可以`!=`像 C 中一样，它允许 '&&' 作为 'and'、'||' 的同义词 对于“或”等。特别是，pg 使用“||” 表示字符串连接。

基本上，pg 是非常严格的 ANSI，MySQL 不是。我强烈建议在转换为 pg 之前让您的 MySQL 尽可能严格地遵守 ANSI，然后在运行应用程序时检查是否有任何警告。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-03-04T20:25:43.430

除了移动数据库结构，您无法避免手动调整......

最可靠的**数据传输**方法（逐表，前提是结构相同）：

```
mysql --default-character-set=utf8 -e "SELECT * FROM mytable" > mytable.txt

psql
\copy mytable from '/path/to/mytable.txt' WITH NULL AS 'NULL'; 
```

最近一直在尝试其他所有方法（例如带有大量选项的 mysqldump + sed 等），但没有什么比这更好用了。

当结构发生变化时，这种方法还具有一定的灵活性——只需编写适当的 SELECT。

# python - 从标准 Cocoa 应用程序运行 python 代码

> ID：772112
> 
> 赞同：8
> 
> 时间：2009-04-21T11:18:44.790
> 
> 标签：python, cocoa, macos, pyobjc

我有一个构建为 Cocoa 单文档应用程序的 XCode 项目（它不是 Python-Cocoa 应用程序，这不是我想要的）。

我找到的所有文档都假设我想用 Python 编写的代码创建一个 Cocoa 应用程序，但事实并非如此——我想要一个标准的 Cocoa 应用程序，它从 Python 类中调用一个方法。

我可以使用 PyObjC 从文件运行 python 代码而不用 main.py 文件替换 Cocoa 标准 main.c 吗？

稍后编辑：我知道 Python.framework 但据我所知，我只能通过环境将参数发送到 PyRun_SimpleFile - 我想直接使用桥与 python 代码交换数据。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-21T11:57:55.723

谷歌搜索[embed python objective C](http://www.google.com/search?q=embed+python+objective+C)，返回一些可能感兴趣的链接，特别是：

*   [http://blog.alienoverlord.com/?p=14](http://blog.alienoverlord.com/?p=14)
*   [http://blog.tlensing.org/2008/11/04/embedding-python-in-a-cocoa-application/](http://blog.tlensing.org/2008/11/04/embedding-python-in-a-cocoa-application/)

# visual-c++ - 来自延迟的带宽

> ID：772113
> 
> 赞同：0
> 
> 时间：2009-04-21T11:18:47.970
> 
> 标签：visual-c++, networking, wininet, ping

DUPE：[如何在 VC++ 中以编程方式检查 Internet 带宽？](https://stackoverflow.com/questions/729146/how-to-programmatically-check-internet-bandwidth-in-vc)

我们能从 ping 的延迟中找到带宽吗？如果是，它是如何完成的

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-21T11:22:22.253

不，一般来说没有太大的关系。请参阅 Wiki：[延迟和吞吐量的比较](http://en.wikipedia.org/wiki/Comparison_of_latency_and_throughput)。

> 永远不要低估一辆满载磁带的旅行车在高速公路上疾驰而过的带宽。
> ——安德鲁·S·塔南鲍姆。

现代[运动鞋网](http://en.wikipedia.org/wiki/Sneakernet)可以拥有令人难以置信的带宽（想象一下，例如通过快递发送 2 x 2TB 磁盘），而它们的延迟是数小时甚至数天。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-21T11:28:30.037

两者不相关：

*   **延迟**是您发送内容与接收者收到内容之间的时间差。所有传输的绝对最小延迟取决于距离和光速。

*   **以您描述的方式使用的带宽**是在特定时间内可以发送的信息量。每个体积所占用的带宽量存在物理限制（如果我们的计算机由尽可能密集的纯能量制成），但我们不太可能很快达到这一目标。

一些例子：

*   低延迟、低带宽：连接到 LAN 上拥塞的终端。
*   低延迟、高带宽：通过 Internet 主干传输。
*   高延迟、低带宽：拥挤网络上的拨号调制解调器。
*   高延迟、高带宽：用硬盘装满汽车，然后开到旧金山。（这是[**运动鞋网**](http://www.google.com/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fen.wikipedia.org%2Fwiki%2FSneakernet&ei=f63tSfeYJ97HtgevqvHQDw&usg=AFQjCNFRlokrce6AmWmSU8GKi7uSrlP9JA)。）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-21T12:17:26.443

然而，有一种称为[数据包对探测](http://www.cs.cmu.edu/~hnn/papers/igi-tr.pdf "包对探测")的技术。

您一个接一个地发送到数据包。从理论上讲，可用的带宽越少，它们在到达时间就越分散。

# c - 在 C 中将 int 写入二进制文件的问题

> ID：772118
> 
> 赞同：3
> 
> 时间：2009-04-21T11:19:27.737
> 
> 标签：c, file, binary, int

我需要使用 C 的 I/O 函数将数据写入二进制文件。以下代码导致运行时异常：

```
 #include "stdio.h"

int main(int argc,char* argv[]) {
    FILE *fp = fopen("path_to_file.bin","wb");
    if(fp == NULL) {
        printf("error creating file");
        return -1;
    }
    int val = 4;
    fwrite((const void*)val,sizeof(int),1,fp);
    fclose(fp);
    return 0;
} 
```

代码在 fwrite 处死掉。你能看出我做错了什么吗？显然，我正在尝试访问 0x0000004 或类似的数据。

谢谢 ！

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-21T11:29:04.063

我认为尼尔的答案可以改进。我意识到它已经被接受了，所以这只是为了展示一些对比（这就是为什么我不只是编辑他的）。

```
fwrite(&val, sizeof val, 1, fp); 
```

两个改进：

*   没有指针转换，因为它在 C 中不是必需的并且可以隐藏错误。
*   直接在对象上使用`sizeof`，因为这是您传递指针的对象。对我来说很有意义，并且比重复自己和使用类型名称更安全。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-04-21T11:22:12.330

```
 fwrite((const void*)val,sizeof(int),1,fp); 
```

应该：

```
 fwrite((const void*) & val,sizeof(int),1,fp); 
```

顺便说一句，如果您不使用演员表，您将收到一条合理的错误消息。C（和 C++）程序员往往比他们应该使用的更频繁地使用强制转换 - 一个好的经验法则是“如果它需要强制转换，它可能是错误的”。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-21T11:26:18.327

添加到尼尔的答案：当您在同一平台上读取和写入文件时，这有效。如果你在不同字节序的平台上读/写，事情会变得很奇怪。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T18:14:37.707

```
#include "stdio.h"

int main(int argc,char* argv[]) {
    FILE *fp = fopen("path_to_file.bin","wb");
    if(fp == NULL) {
        printf("error creating file");
        return -1;
    }
    int val = 4;
    fwrite((const void*)val,sizeof(int),1,fp); 
```

您应该提供一个地址而不是整数本身。

另外，您不应该以这种方式使用整数：

1.  不同计算机上的字节序可能不同（如前所述）
2.  它的大小可能不同。在非常旧的计算机上，它可能是 1 或 2 个字节。在大多数现代设备上，它将是 4，但也*可能*是 8（一些 64 位计算机）。在一些奇怪的架构上，它甚至可能是 36 位。`int32_t val = 4; fwrite((const void *)val, 4, 1, fp)`应该解决问题。

您可能认为您的软件永远不需要移植。好吧 - 许多设计师（软件和硬件）做出了类似的假设。有时不制作它们的成本太高 - 但在这种情况下，只需进行一些额外的检查。

```
 fclose(fp);
    return 0;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-11-09T04:02:38.440

我也遇到过这种问题。所以这是我的解决方案。

`fwrite(val, sizeof(val[0], sizeof(val)/sizeof(val[0]), fp);`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-02-24T01:46:11.323

> 显然，我正在尝试访问 0x0000004 或类似的数据。

```
int val = 4 
```

这就是问题所在。`fwrite`被设计用于处理字符串，因此它的第一个输入是一个指针，一个字符串在内存中的位置。您`val`直接传递 (4) 的值而不是`val`to的地址`fwrite`；但是，0x00000004 处的内存不是有效的程序内存，因此会出现错误。

要解决此问题，请更改此：

```
fwrite((const void*)val,sizeof(int),1,fp); 
```

进入这个：

```
fwrite((const void*)&val, sizeof(int), 1, fp); 
```

“&”运算符表示 的位置`val`。这将是内存中的有效地址。

# python - Ellipsis 对象有什么作用？

> ID：772124
> 
> 赞同：739
> 
> 时间：2009-04-21T11:21:12.787
> 
> 标签：python, ellipsis

在闲逛命名空间时，我注意到一个看起来很奇怪的对象，称为`Ellipsis`，它似乎并没有什么特别之处，也没有做任何特别的事情，但它是一个全局可用的内置函数。

经过搜索，我发现它被 Numpy 和 Scipy 用于切片语法的一些晦涩变体中......但几乎没有别的。

是否将此对象添加到语言中专门用于支持 Numpy + Scipy？省略号有任何通用含义或用途吗？

```
D:\workspace\numpy>python
Python 2.4.4 (#71, Oct 18 2006, 08:34:43) [MSC v.1310 32 bit (Intel)] on win32
Type "help", "copyright", "credits" or "license" for more information.
>>> Ellipsis
Ellipsis 
```

* * *

## 回答 #1

> 赞同：744
> 
> 时间：2009-04-21T16:26:07.937

这在最近的另一个[问题中出现。](https://stackoverflow.com/questions/752602/slicing-in-python-expressions-documentation)我将从那里详细说明我的[答案](https://stackoverflow.com/questions/752602/slicing-in-python-expressions-documentation/753260#753260)：

[省略号](http://docs.python.org/dev/library/constants.html#Ellipsis)是可以以切片表示法出现的对象。例如：

```
myList[1:2, ..., 0] 
```

它的解释完全取决于实现`__getitem__`函数并`Ellipsis`在那里看到对象的任何东西，但它的主要（和预期）用途是在[numpy](http://www.numpy.org/)第三方库中，它添加了多维数组类型。由于有多个维度，切片变得比仅仅一个开始和停止索引更复杂；能够在多个维度上切片也很有用。例如，给定一个 4x4 数组，左上角区域将由 slice 定义`[:2,:2]`：

```
>>> a
array([[ 1,  2,  3,  4],
       [ 5,  6,  7,  8],
       [ 9, 10, 11, 12],
       [13, 14, 15, 16]])

>>> a[:2,:2]  # top left
array([[1, 2],
       [5, 6]]) 
```

进一步扩展这一点，省略号在这里用于指示未指定的其余数组维度的占位符。可以将其视为指示`[:]`其放置的间隙中所有维度的完整切片，因此对于 3d 数组，与 4d`a[...,0]`相同`a[:,:,0]`，对于 4d，`a[:,:,:,0]`同样，`a[0,...,0]`是`a[0,:,:,0]`（但中间有许多冒号构成完整数字数组中的维数）。

有趣的是，在 python3 中，省略号文字 ( `...`) 可以在切片语法之外使用，因此您实际上可以编写：

```
>>> ...
Ellipsis 
```

除了各种数字类型，不，我不认为它被使用。据我所知，它纯粹是为了 numpy 使用而添加的，除了提供对象和相应的语法之外没有任何核心支持。那里的对象不需要这个，但是对切片的文字“...”支持确实如此。

* * *

## 回答 #2

> 赞同：333
> 
> 时间：2011-05-31T14:39:41.713

在 Python 3 中，您*可以*¹ 使用省略号文字`...`作为尚未编写的代码的“nop”占位符：

```
def will_do_something():
    ... 
```

这**不是**魔术。可以使用任何表达式代替`...`，例如：

```
def will_do_something():
    1 
```

（不能使用“sanctioned”这个词，但我可以说这种用法并没有被 Guido[*完全拒绝。）*](http://mail.python.org/pipermail/python-3000/2008-January/011793.html)

¹`'can' not in {'must', 'should'}`

* * *

## 回答 #3

> 赞同：109
> 
> 时间：2016-05-28T13:08:47.027

从 Python 3.5 和[PEP484 开始](https://www.python.org/dev/peps/pep-0484/#callable)，文字省略号用于在使用[类型](https://docs.python.org/3/library/typing.html)模块时将某些类型表示为静态类型检查器。

示例 1：

> 例如，可以使用一种类型和省略号来表示任意长度的同质元组`Tuple[int, ...]`

示例 2：

> 通过用文字省略号（三个点）代替参数列表，可以在不指定调用签名的情况下声明可调用的返回类型：

```
def partial(func: Callable[..., str], *args) -> Callable[..., str]:
    # Body 
```

* * *

## 回答 #4

> 赞同：60
> 
> 时间：2018-06-02T21:08:15.787

总结其他人所说的，从 Python 3 开始，Ellipsis 本质上是另一个类似于 的单例常量`None`，但没有特定的用途。现有用途包括：

*   在切片语法中表示剩余维度中的完整切片
*   在类型提示中仅指示类型的一部分（`Callable[..., int]`或`Tuple[str, ...]`）
*   在类型存根文件中表示有一个默认值而不指定它

可能的用途可能包括：

*   `None`作为有效选项的地方的默认值
*   作为您尚未实现的功能的内容

* * *

## 回答 #5

> 赞同：48
> 
> 时间：2011-05-31T14:47:58.483

您还可以在指定预期的[doctest](http://docs.python.org/library/doctest.html#doctest.ELLIPSIS)输出时使用省略号：

```
class MyClass(object):
    """Example of a doctest Ellipsis

    >>> thing = MyClass()
    >>> # Match <class '__main__.MyClass'> and <class '%(module).MyClass'>
    >>> type(thing)           # doctest:+ELLIPSIS
    <class '....MyClass'>
    """
    pass 
```

* * *

## 回答 #6

> 赞同：38
> 
> 时间：2009-04-21T11:30:30.173

从[Python 文档](https://docs.python.org/3/library/stdtypes.html?highlight=ellipsis#the-ellipsis-object)：

> 此对象通常由切片使用（请参阅*[切片](https://docs.python.org/3/c-api/slice.html?highlight=ellipsis#ellipsis-object)*）。它不支持特殊操作。只有一个省略号对象，名为 Ellipsis（内置名称）。`type(Ellipsis)()`产生省略号单例。
> 
> 它写成`Ellipsis`or `...`。

* * *

## 回答 #7

> 赞同：24
> 
> 时间：2015-10-12T18:03:20.377

**`__getitem__``...`自定义类中的最小示例**

当魔术语法`...`被传递给`[]`自定义类时，`__getitem__()`接收一个`Ellipsis`类对象。

然后该类可以对这个 Singleton 对象做任何它想做的事情。

例子：

```
class C(object):
    def __getitem__(self, k):
        return k

# Single argument is passed directly.
assert C()[0] == 0

# Multiple indices generate a tuple.
assert C()[0, 1] == (0, 1)

# Slice notation generates a slice object.
assert C()[1:2:3] == slice(1, 2, 3)

# Ellipsis notation generates the Ellipsis class object.
# Ellipsis is a singleton, so we can compare with `is`.
assert C()[...] is Ellipsis

# Everything mixed up.
assert C()[1, 2:3:4, ..., 6] == (1, slice(2,3,4), Ellipsis, 6) 
```

Python 内置`list`类选择给它一个范围的语义，当然，它的任何合理使用也应该如此。

就个人而言，我只是在我的 API 中远离它，而是创建一个单独的、更明确的方法。

在 Python 3.5.2 和 2.7.12 中测试。

* * *

## 回答 #8

> 赞同：16
> 
> 时间：2021-03-17T02:37:01.753

对于在大量使用 Pydantic 的代码库中工作而获得此答案的任何人：这也是 Pydantic 指示一个必需但可以设置为的字段的方式`None`，他们将其称为“[必需的可选字段](https://pydantic-docs.helpmanual.io/usage/models/#required-optional-fields)”。这也是为什么它们最终也被用于 FastAPI 的原因。

* * *

## 回答 #9

> 赞同：14
> 
> 时间：2009-04-21T11:24:33.900

您可以自己使用 Ellipsis，在像 numpy 这样的自定义切片情况下，但它在任何内置类中都没有使用。

我不知道它是否是专门为在 numpy 中使用而添加的，但我当然没有看到它在其他地方使用过。

另请参阅：[如何在 Python 中使用省略号切片语法？](https://stackoverflow.com/questions/118370/how-do-you-use-the-ellipsis-slicing-syntax-in-python)

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2018-01-23T11:11:19.090

正如@noɥʇʎԀʎzɐɹƆ 和 @phoenix 所提到的 - 您确实可以在存根文件中使用它。例如

```
class Foo:
    bar: Any = ...
    def __init__(self, name: str=...) -> None: ... 
```

可以在此处找到有关如何使用此省略号的更多信息和示例[https://www.python.org/dev/peps/pep-0484/#stub-files](https://www.python.org/dev/peps/pep-0484/#stub-files)

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2013-07-20T15:42:41.807

它的预期用途不应仅用于这些第 3 方模块。Python 文档中没有正确提及它（或者我可能只是找不到），但**省略号`...`实际上在 CPython**中至少在一个地方使用。

它用于表示 Python 中的无限数据结构。我在玩列表时遇到了这个符号。

有关更多信息，请参阅[此问题](https://stackoverflow.com/questions/17160162/what-is-in-python-2-7)。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2019-05-27T14:17:43.577

这是等价的。

```
l=[..., 1,2,3]
l=[Ellipsis, 1,2,3] 
```

`...`是内部定义的常数[`built-in constants`](https://docs.python.org/3/library/constants.html)。

> 省略
> 
> 与省略号文字“...”相同。特殊值主要与用户定义的容器数据类型的扩展切片语法结合使用。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2020-10-03T06:29:54.643

在[typer](https://typer.tiangolo.com/tutorial/arguments/optional/) `...`中用于创建必需的参数：`Argument`该类需要一个默认值，如果您传递了`...`它，如果用户没有传递特定的参数，它会报错。

如果不存在，您可以使用`None`相同的值`Ellipsis`，但这将消除表达默认值的机会`None` *，*以防在您的程序中有任何意义。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-01-29T22:58:30.980

FastAPI 使用省略号来创建所需的参数。 [https://fastapi.tiangolo.com/tutorial/query-params-str-validations/](https://fastapi.tiangolo.com/tutorial/query-params-str-validations/)

# php - utf8 重音显示不一致

> ID：772125
> 
> 赞同：0
> 
> 时间：2009-04-21T11:21:26.560
> 
> 标签：php, sql, mysql, ajax, utf-8

我有一个数据库，一个表，一个特定的字段，其中包含各种服装的描述。这些描述通常包含变音符号或类似字符。

我正在从两个不同的 php 字段中检索这些字段，并且我没有对数据做任何事情，但它显示不一致。

在file1中，它将正确显示如下，或者添加

```
$con->query("SET NAMES 'utf8'"); 
```

和

```
header("Content-Type: text/html; charset=utf-8"); 
```

如果我只将上述其中一项添加到file1，则数据将无法正确显示。

在 file2 中，它只会正确显示，如果

```
$con->query("SET NAMES 'utf8'"); 
```

已设置。

添加任一

```
header("Content-Type: text/html; charset=utf-8"); 
```

与集合名称查询结合使用，或将集合名称查询排除在外将导致其显示不正确。

```
$con->set_charset("utf8"); 
```

似乎在任何时候都没有区别。

此问题存在于 windows 和 linux 上的 internet explorer 和 firefox。

显示不一致的数据示例：

```
ED HARDY SCHUHE IM JAPAN-STYLE, GRÖßE 36 
```

文件1：

```
<?php
header("Content-Type: text/html; charset=utf-8");
if (isset($_GET["pk"])) {
    $pk = $_GET["pk"];
}
$con = mysqli_connect("localhost","user","password", "database");
if (!$con) {
    echo "Can't connect to MySQL Server. Errorcode: %s\n". mysqli_connect_error();
    exit;
}
$con->query("SET NAMES 'utf8'");
$retreiveQuery = 'SELECT ARTICLE_NAME FROM AUCTIONS WHERE ARTICLE_NO = ?';
if ($getRecords = $con->prepare($retreiveQuery)) {
    $getRecords->bind_param("s", $pk);
    $getRecords->execute();
    $getRecords->bind_result($ARTICLE_NAME);
    while ($getRecords->fetch()) {
        echo "<h1>".$ARTICLE_NAME."</h1>";
    }
} else {
    print_r($con->error);
} 
```

文件2：

```
<?php
header("Content-Type: text/html; charset=utf-8");
if (isset($_GET["brand"])) {
    $brand = $_GET["brand"];
}
$con = mysqli_connect("localhost","user","pass", "database");
if (!$con) {
    echo "Can't connect to MySQL Server. Errorcode: %s\n". mysqli_connect_error();
    exit;
}
$con->query("SET NAMES 'utf8'");
$brand = '%' . $brand . '%';
$rows = getRowsByArticleSearch($brand);
echo "<table border='0' width='100%'><tr>" . "\n";
foreach ($rows as $row) {
    $pk = $row['ARTICLE_NO'];
    echo '<tr id="article_' . $pk . '">' . "\n";
    echo '<td><a href="#" onclick="updateByPk(\'Layer2\', \'' . $pk . '\', \'' . $title . '\', \'' . $pg . '\')">'.$row['ARTICLE_NAME'].'</a></td>' . "\n";
    echo '</tr>' . "\n";
}
echo "</table>\n";
function getRowsByArticleSearch($searchString) {
    $con = mysqli_connect("localhost","user","pass", "db");
    $recordsQuery = "SELECT ARTICLE_NAME FROM AUCTIONS WHERE lower(ARTICLE_NAME) LIKE ? and SUBCAT='' LIMIT 0,20";
    if ($getRecords = $con->prepare($recordsQuery)) {
        $getRecords->bind_param("s", $searchString);
        $getRecords->execute();
        $getRecords->bind_result($ARTICLE_NAME);
        $rows = array();
        while ($getRecords->fetch()) {
            $row = array(
                            'ARTICLE_NAME' => $ARTICLE_NAME, 
                        );
            $rows[] = $row;
        }
        return $rows;
    } else {
        print_r($con->error);
    }
} 
```

我有一个带有 index.php 的 ajax 应用程序，我为此设置了

```
header("Content-Type: text/html; charset=utf-8"); 
```

然后，我使用 file2 通过 ajax 加载一个包含内容的图层，这会错误地显示数据。数据变成了一个链接，它使用 file1 将数据加载到不同的层，该层确实正确显示了数据。

我真的不明白不一致来自哪里。

编辑：

数据在 file1 中正确显示，设置名称和标题，页面显示为 utf-8。

只有当网页信息显示字符集为 ISO-8859-1 时，文件 2 才会正确显示数据，这意味着省略集名称并设置标题。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-21T17:24:00.760

确保文件以 utf8 编码保存，而不是其他编码。这可以通过您的 IDE 或文本编辑器来完成。即在eclipse中你可以选择Edit->Set Encoding

（我的猜测是 file2.php 或 index.php 是用其他编码保存的）

# c++ - c ++删除两个指针引用的对象

> ID：772146
> 
> 赞同：4
> 
> 时间：2009-04-21T11:29:46.883
> 
> 标签：c++

我只是好奇是否有一种优雅的方法可以在 C++ 中解决以下问题：

我有一个模拟器应用程序，其中包含通过通道连接的几个组件。这些通道可能是网络通道（需要两个应用程序实例）或虚拟本地通道。有两个接口：`IChannelIn`和`IChannelOut`两个对应的变量：

```
IChannelIn* in;
IChannelOut* out; 
```

`DummyChannel`是`IChannelIn`和`IChannelOut`。_ 它只是将输入复制到输出。还有`TCPChannelIn: public IChannelIn`和分开`TCPChannelOut: public IChannelOut`的。

现在，根据用户的选择，我要么创建一个`DummyChannel`

```
DummyChannel* d = new DummyChannel;
in = d;
out = d; 
```

或两个单独的对象：`in = new TCPChannelIn; out = new TcpChannelOut`

问题是：析构函数应该做什么？

```
~App::App()
{
    delete in;
    delete out;
} 
```

以错误结尾，因为`delete in;`还删除了虚拟通道`d`，因此`delete out`删除了已删除的内容。

有没有优雅的方法来解决这个问题？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-21T11:34:10.773

您将需要以下内容：

```
~App::App()
{
    if (in != out)
    {
        delete out;
    }
    delete in;
} 
```

当频道不同时，指针也会不同。

但是，正如 danatel 在评论中指出的那样，`in`没有`out`可比性。一个安全（但不优雅）的解决方案是使用`dummy`标志。设置 if`in`和`out`设置为虚拟通道，析构函数将变为：

```
~App::App()
{
    if (!dummy)
    {
        delete out;
    }
    delete in;
} 
```

虽然我不会对此感到高兴。

目前我能看到的唯一其他解决方案是更改 和 的定义，`IChannelIn`以便`IChannelOut`可以安全地比较它们。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-21T11:34:43.860

如果您正在使用 boost，您可以考虑使用[boost::shared_ptr](http://www.boost.org/doc/libs/1_38_0/libs/smart_ptr/shared_ptr.htm) 这将在最后一个实例被释放时自动删除该对象。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-21T11:33:09.620

```
if (in == out) {
    delete in;
}
else {
    delete in;
    delete out;
} 
```

?

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-21T11:33:46.500

经验法则：将您`new`的 s 与您`delete`的 s 匹配。

```
~App::App()
{
    delete out;
    // the next line tries to free
    // memory no longer in the app's
    // control invoking UB
    delete in;
} 
```

在这里，您遇到了经典的*双自由*问题。

```
~App::App()
{
    if (in != out)
    {
        delete out;
    }
    // if in == out the out object is not deleted
    // for a non trivial object this tantamounts to
    // leaking resources held by TCPChannelOut other
    // than d
    delete in;
} 
```

唯一的解决方案似乎是使用智能引用计数指针。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-21T12:00:49.150

你的班级*怎么知道*这是一个freestore指针？例如，什么反对以下代码？

```
DummyChannel d;
in = &d;
out = &d; 
```

这是一段完全合理的代码，但是当你试图删除任何一个指针时，你的析构函数**会崩溃。**

长话短说：回收资源是首先分配资源的人的工作。如果您的类传递了一个指针，则该类无法知道并且不关心释放。这完全是调用者的责任。

如前所述，在不让客户端大量工作的情况下解决这个困境的优雅方法是智能指针。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-21T11:49:12.453

我总是在设计时想到对象所有权：

*   谁创建了对象？
*   谁拥有（因此删除对象）？
*   如何避免使用对已销毁对象的引用（或者如何确定引用的对象是否仍然有效）？

在尝试回答这些问题时，我也确定了实现它的方式（析构函数、智能指针等）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-21T18:57:10.567

不要忘记将 IChannelIn 和 IChannelOut 析构函数设为虚拟。如果析构函数不是虚拟的，则在调用 IChannel 析构函数时（即删除 IChannel ptr 内容时）将不会调用 TCPChannel 或 DummyChannel 析构函数。

# c++ - 指令在“ “引用的内存在” ”。无法“读取”内存。

> ID：772151
> 
> 赞同：2
> 
> 时间：2009-04-21T11:32:11.853
> 
> 标签：c++, c, winapi

c/c++ 应用程序抛出该错误，如何开始调试（比添加打印语句更好的主意）？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-21T11:35:58.773

第二个地址是一个非常小的数字，例如 0x00000001 或 0x00000000？如果是这样，您可能只是忘记了初始化指针。

在任何情况下，标准调试技巧都适用：通过注意问题何时发生并从那里缩小范围来开始隔离问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T11:07:01.143

就像其他人所说的那样，如果这可以在您的开发机器上重现，请启动调试器并设置断点/单步执行代码。

[但是，如果这发生在客户的机器上并且调试器不可用，您可以通过使用SetUnhandledExceptionFilter](http://msdn.microsoft.com/en-us/library/ms680634.aspx)并将信息写入日志文件或进行小型转储来获取一些相同的信息（调用堆栈、寄存器等） 。我怀疑调用堆栈将是最有用的起点，因此您可以在处理程序中使用 StackWalk 函数之一并写入日志文件。对于该应用程序的构建，这至少需要一个映射文件或一组符号 (PDB)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-21T12:57:05.537

错误消息表明您正在使用 Visual Studio 进行开发。好吧，至少这是我在该措辞中看到此错误消息的唯一开发环境。

如果是这种情况，您可以使用内置的异常调试来捕获访问冲突并以这种方式获取调用堆栈。

要在我目前打开的 VC++ 2003 中执行此操作，请转到 Debug->Exceptions，打开“Win32 Exceptions”，单击“c0000005 Access Violation”并将“抛出异常时”设置为“Break into debugger”。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-21T11:35:50.067

没有代码，很难提出任何建议。在遇到问题之前尝试使用调试器并在代码中设置断点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-21T12:31:07.953

根据您的开发环境，您的程序的映射文件可能会有所帮助

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-22T06:56:53.757

您可以使用 GDB 调试您的应用程序：[http ://www.gnu.org/software/gdb/](http://www.gnu.org/software/gdb/)

# c# - how to write if null surround-with code snippet

> ID：772154
> 
> 赞同：2
> 
> 时间：2009-04-21T11:32:52.087
> 
> 标签：c#, visual-studio, code-snippets

I'm trying to write a vs code snippet that will take the selected and surround it with an if null check, i.e.

```
accgrp.CREATEDATE = DateTime.Now; 
```

will become:

```
if (accgrp.CREATEDATE == null)
        {
            accgrp.CREATEDATE = DateTime.Now;
        } 
```

I've got as far as the below. $selected$ only seems to work the last time it is used, if used more than once, the other instances where you would expected to see the selected code are blank. I understand the code below wouldn't do exactly what I want, as I wont get the right hand side of the assignment, btu it would be good enough.

```
 <Declarations>
            <Literal>
                <ID>expression</ID>
                <ToolTip>Expression to evaluate</ToolTip>
                <Default>o</Default>
            </Literal>
        </Declarations>
        <Code Language="csharp"><![CDATA[if ($selected$ == null)
{
    $selected$ = $expression$$end$   
}]]>
        </Code> 
```

Can anyone help?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T11:54:09.010

Assuming `CREATEDATE` is a property, why don't you move this logic over there?

```
DateTime? CREATEDATE
{
    set { _createdate = value ?? DateTime.Now; }
} 
```

or use the same `??` operator outside setter:

```
accgrp.CREATEDATE = accgrp.CREATEDATE ?? DateTime.Now; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T12:07:34.797

Here is macro for you, that will provide you identical functionality.

```
Sub NullCheck()
    Dim selected As String
    Dim var As String
    Dim res As String
    Dim sel As TextSelection

    sel = DTE.ActiveDocument.Selection
    selected = sel.Text        
    var = selected.Substring(0, selected.IndexOf("=") - 1).Trim()
    res = String.Format("if ({0} == null) {1} ", var, selected)

    sel.Delete()
    sel.Insert(res, vsInsertFlags.vsInsertFlagsContainNewText)
    sel.SmartFormat()

End Sub 
```

The alternative (after reading your comment) may be to use [PostSharp](http://www.postsharp.org/) in order to intercept field/property setter.

# visual-studio - 水晶报表的 HTML 文本渲染问题

> ID：772167
> 
> 赞同：4
> 
> 时间：2009-04-21T11:35:07.777
> 
> 标签：visual-studio, crystal-reports

嗨，我在 Visual Studio 2003 的水晶报表中呈现 html 格式的文本时遇到问题。

当 textformat 属性设置为 crHTMLText 时，值不会显示在报告中。

当它设置为 crRTFText 时，不应用格式。

我应该做些什么来实现这一目标？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2013-09-11T17:57:14.673

抱歉，这是文本解释下 Crystal Reports 帮助文件 11.5 版的直接复制和粘贴。选项为无、RTF 或 HTML。HTML 在某种程度上有效，但并非所有标签都受支持。我还发现 BR 标签`<br>`有效，但`<br />`解释不正确。

所以，要`<br />`变成`<br>`，我必须使用以下公式： `Replace ({LONGDESCRIPTION.LDTEXT}, "<br />", "<br>")`

```
The supported HTML tags are:

html 
body 
div (causes a paragraph break) 
tr (causes only a paragraph break; does not preserve column structure of a table) 
span 
font 
p (causes a paragraph break) 
br (causes a paragraph break) 
h1 (causes a paragraph break, makes the font bold & twice default size) 
h2 (causes a paragraph break, makes the font bold & 1.5 times default size) 
h3 (causes a paragraph break, makes the font bold & 9/8 default size) 
h4 (causes a paragraph break, makes the font bold) 
h5 (causes a paragraph break, makes the font bold & 5/6 default size) 
h6 (causes a paragraph break, makes the font bold & 5/8 default size) 
center 
big (increases font size by 2 points) 
small (decreases font size by 2 points if it's 8 points or larger) 
b 
i 
s 
strike 
u 

The supported attributes are:

align 
face 
size 
color 
style 
font-family 
font-size 
font-style 
font-weight 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-23T00:21:17.457

您是通过代码设置此属性吗？对于设计师，我相信它是段落选项卡中的“文本解释”属性。我知道只支持一小部分 html 标签。

# sql - WHERE 子句中的“条件条件”（应用哪个条件取决于“模式”标志）

> ID：772179
> 
> 赞同：5
> 
> 时间：2009-04-21T11:41:17.510
> 
> 标签：sql, optimization, conditional

我有一种情况，我已经用两种不同的方式解决了，但想知道人们对这些选项的看法，以及他们是否有其他选择......

系统正在处理数据的“间隔”。

*   所有数据都分配给一个“区间”
*   间隔由 Fact 表中的“interval_start”DATETIME 表示
*   维度表保存“间隔”的持续时间（不同实体可能不同）
*   维度表中还有一个“模式”标志

SQL 查询中需要以下规则...

**模式0**
如果记录条目在事实表中，则可以对其进行处理。
（无限制。）

**模式 1**
只有在“interval_start”是过去的情况下，记录才对处理有效。（已经开始但不一定结束的时间间隔。）

**模式2**
只有整个“间隔”都在过去时，记录才对处理有效。（已完成的时间间隔。）

为此创建的第一个 WHERE 子句如下...

```
WHERE
    getDate() >=
        CASE [table].mode
            WHEN 0 THEN 0
            WHEN 1 THEN [log].interval_start
            WHEN 2 THEN [log].interval_start + [table].interval_period
            ELSE        NULL
        END 
```

有人担心这会使索引无法优化子句。另一种方法是使用多个 AND/OR 条件。

```
WHERE
   ([table].mode = 0 AND getDate() >= 0)
OR ([table].mode = 1 AND getDate() >= [log].interval_start)
OR ([table].mode = 2 AND getDate() >= [log].interval_start + [table].interval_period) 
```

显然，哪个表现最好将取决于数据和索引等。但是对于我目前描述为“条件条件”的内容，是否有人有任何选择或替代方案？:)

干杯，马特。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-21T11:46:14.520

怎么样：

```
WHERE
     interval_start <= CASE mode
                         WHEN 0 THEN '9999-12-31'
                         WHEN 1 THEN GETDATE()
                         WHEN 2 THEN GETDATE() - interval_period
                       END 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-21T11:47:19.010

另一种选择是运行三个单独的查询并将它们联合起来。根据您的索引和表结构，这可能会导致比将 WHERE 子句中的子句或使用 CASE 语句的子句 OR-ing 更有效的 SQL，尽管它纯粹是在玩优化器。

我会测试所有三种方法并选择最适合您的一种。

# iphone - iPhone UIViewController 初始化方法没有被调用

> ID：772182
> 
> 赞同：10
> 
> 时间：2009-04-21T11:44:56.490
> 
> 标签：iphone

我对 iPhone 编程非常陌生，并且遇到了一些奇怪的事情。对于下面的类，init 方法永远不会被调用——我有一个 NSLog 函数，它应该告诉我什么时候执行 init。以下是相关代码：

```
@interface MyViewController : UIViewController {
}
@end

@implementation MyViewController
- (id) init
{
    NSLog(@"init invoked");
    return self;
}
@end 
```

关于我做错了什么的任何想法——如果有的话？希望我提供了足够的信息。

谢谢。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2014-02-20T18:20:33.690

如果您使用的是 Storyboard，`initWithCoder:`将被调用。参考文件说：

> 如果您的应用程序使用情节提要来定义视图控制器及其关联视图，则您的应用程序永远不会直接初始化该类的对象。相反，视图控制器要么由故事板实例化——要么在触发 segue 时由 iOS 自动实例化，要么在您的应用程序调用故事板对象的 instantiateViewControllerWithIdentifier: 方法时以编程方式实例化。当从故事板实例化视图控制器时，iOS 通过调用它的 initWithCoder: 方法来初始化新的视图控制器。iOS 自动将 nibName 属性设置为存储在故事板中的 nib 文件。

该`initWithCoder:`方法不是 .m 文件的默认模板的一部分，因此您必须将自己添加到 UIViewController 子类中：

```
- (id)initWithCoder:(NSCoder *)aDecoder {

    self = [super initWithCoder:aDecoder];

    if (self) {
        // Custom initialization
        NSLog(@"Was called...");
    }

    return self;
} 
```

无需`initWithNibName:bundle:`从您的代码中删除，但无论如何都不会调用它。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-04-21T11:51:52.867

您可能正在从 NIB 文件创建视图控制器。因此，不是调用“init”消息，而是调用一个创建者消息：

```
- (id)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil {
    if (self = [super initWithNibName:nibNameOrNil bundle:nibBundleOrNil]) {
        // Custom initialization
    }
    return self;
} 
```

试试这是否是被调用的那个。肖恩说的是真的。您可以使用这些消息来完成类似的事情。

祝你好运。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-21T11:48:18.167

景色要上来了吗？使用这些方法进行额外的初始化：

```
- (void)viewWillAppear:(BOOL)animated {
    [super viewWillAppear:animated];
    //...
}

// Implement viewDidLoad to do additional setup after loading the view.
- (void)viewDidLoad {   
    [super viewDidLoad];
    //..
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-01-24T08:23:41.487

请参阅参考文档中的“指定初始化程序”。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-09-08T22:14:48.013

但是，一个 UI 组件有时有几个 init* 方法，我们是否需要重写所有这些方法才能执行一些 init。东西？

# php - 如何同时进行两个查询？

> ID：772184
> 
> 赞同：1
> 
> 时间：2009-04-21T11:46:54.597
> 
> 标签：php, mysql

如何将这两个查询合二为一？

```
$query = "SELECT * FROM `amb_prod` WHERE idAmbiente='".$ambId."';";
$result_set = mysql_query($query);

while($member = mysql_fetch_array($result_set)){
        $query2 = "SELECT * FROM `produto`, `pt` WHERE
        produto.refPT = pt.ref AND
        produto.refPT = $member['idProduto'] ;";
    $result_set2 = mysql_query($query2);
} 
```

**我已经尝试过这个，但它没有工作..**

```
$query = "SELECT * FROM `produto`, `pt` WHERE
        produto.refPT = pt.ref AND
        produto.refPT = (SELECT `idProduto` FROM `amb_prod` WHERE idAmbiente='".$ambId.");"; 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-21T11:50:00.237

这应该有效：

```
$query = "SELECT * FROM `produto`, `pt` WHERE
        produto.refPT = pt.ref AND
        produto.refPT IN (SELECT `idProduto` FROM `amb_prod` WHERE idAmbiente='".$ambId.");"; 
```

我不确定表结构，但连接也可以。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-21T12:01:00.880

使用连接而不是子查询：

```
$query = "SELECT pr.*, pt.* 
FROM amb_prod ap 
JOIN producto pr ON (ap.idProduto = pr.refPT) 
JOIN pt ON (pr.refPT = pt.ref) 
WHERE idAmbiente='${ambId}'"; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T11:59:29.433

您不能在同一连接中同时打开两个游标。您需要打开第二个连接。不过，我强烈建议不要这样做；为读取的每一行发出查询会有点慢。如果我是你，我会这样做：

```
SELECT pr.*, pt.*
FROM "produto" pr, "pt" pt, amb_prod ap
WHERE produto.refPT = pt.ref
AND ap.idAmbiente = $ambId
AND produto.refPT = ap.idProduto 
```

[理想情况下，出于安全性](https://stackoverflow.com/questions/446551/from-what-do-sql-parameters-protect-you)、可维护性和性能考虑，您会将其转换为参数化查询。我不确定它是如何在 PHP 中完成的，但[MySQLi_STMT](http://uk.php.net/manual/en/class.mysqli-stmt.php)类看起来是一个很好的起点：

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T12:01:05.030

SELECT * FROM `produto`, `pt`, `amb_prod`WHERE produto.refPT = pt.ref AND produto.refPT = amb_prod.idProduto AND amb_prod.idAmbiente='".$ambId."' ;

根据数据，您可能必须在 select 子句中使用 distinct

# java - PHP 开发人员的最佳 Java Web 应用程序框架？

> ID：772188
> 
> 赞同：1
> 
> 时间：2009-04-21T11:47:47.450
> 
> 标签：java, frameworks

我一直是终生的 PHP 开发人员。但我现在被迫用 Java（或至少在 JVM 上）编写原型 PHP Web 应用程序的最终版本。

想补充一点，我对Java并不是很陌生。以前写小程序。此外，我熟悉大多数其他脚本语言，以及 RoR。

但是 Java 中的 Web 应用程序让我对这么多选项感到困惑。因此我的问题是：您会为 PHP 开发人员推荐哪个框架？宁愿少打字，少用 XML。Java 或任何 JVM 语言中是否有类似 RoR 的框架？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-21T11:56:30.953

Java 虚拟机（实际上是 RoR 的一个端口）有一个类似 RoR 的框架，称为[Grails](http://www.grails.org/)。它不使用 Java，而是使用一种类似于 Ruby 的语言，称为 Groovy。但是，您可以在 Grails 项目中自由混合 Groovy 和 Java 类。

还有一个名为 JRuby 的 Ruby 端口，它在 Java 虚拟机上的 Java 之上运行——是的，您可以使用它运行 RoR（请参见[此处](http://wiki.jruby.org/wiki/Main_Page)）。

除了类似 RoR 的环境之外，与较少 XML 一起使用的最简单的框架是更简单的 Servlet 框架。你只需要设置一个web.xml，剩下的就是纯Java和JSP（一种类似PHP的基于Java的模板/逻辑方言）。

在Java 之上还有[Quercus一个 PHP 实现。](http://www.caucho.com/resin-3.0/quercus/)这将允许您移植 PHP 代码，甚至将其与 Java 类混合。

按照流行度和支持的顺序，具有最多商业支持、可用文档、书籍和工作的选项是纯 Servlet 框架之一——然后是 Grails，它由 Java 框架的主要参与者 SpringSource 拥有和支持。

在您熟悉 Java 语言和概念之后，您可以迁移到更高级别的 Web 框架，例如 Spring MVC 或 Struts 2，在这些框架中，使用 Annotations（一种添加到代码上的元数据）您可以使用非常少的 XML 甚至根本没有 XML。请参阅[此](http://blog.springsource.com/2007/11/14/annotated-web-mvc-controllers-in-spring-25/)示例。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-21T11:52:00.730

如果您不限于 Java，而是任何 JVM：

*   [使用JRuby](http://en.wikipedia.org/wiki/JRuby#Rails)的 RoR ；
*   [Grails](http://en.wikipedia.org/wiki/Grails_(framework))（以前的[Groovy](http://en.wikipedia.org/wiki/Groovy_(programming_language)) on Rails）；
*   [Django](http://docs.djangoproject.com/en/dev/howto/jython/)使用[Jython](http://www.jython.org/Project/)；

JVM中也有PHP的实验性实现：

*   [栎属](http://www.caucho.com/resin-3.0/quercus/)
*   [零项目](http://www.projectzero.org/)的 P8 。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-21T12:10:04.307

我刚从 PHP 切换到 Tapestry5 - [http://tapestry.apache.org/tapestry5/](http://tapestry.apache.org/tapestry5/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-21T11:52:36.643

你注意到[栎树](http://www.caucho.com/resin-3.0/quercus/)了吗？它是 Java 中的 PHP 实现：您使用 PHP 编写应用程序并在 JVM 中执行它

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-21T11:53:17.640

也许你应该考虑看看 Grails。它在 JVM 上运行，使用 Groovy 语言，在许多方面，它更接近于脚本语言（虽然不是），而且 Grails 架构会提醒您使用 RoR。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-21T11:54:26.107

您是需要专门使用 Java 还是只需要部署在 JVM 上？JRuby 可能是一个很好的选择，这样您就可以在 Rails 上编写 Ruby 并在 JVM 上部署。您还可以查看 Groovy/Grails，它是专为 JVM 构建的 Ruby/RoR 类型的解决方案。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-21T12:39:19.667

[Stripes 框架](http://www.stripesframework.org/display/stripes/Home)是一个非常易于使用的 Java Web 框架。约定优于配置，因此没有 XML 文件。大量使用注释。您可以立即启动并运行它。

# c++ - tr1::hash for boost::thread::id?

> ID：772192
> 
> 赞同：9
> 
> 时间：2009-04-21T11:49:46.447
> 
> 标签：c++, boost, hash, boost-thread, unordered-set

我开始使用命名空间中的`unordered_set`类`tr1`来加速对普通（基于树的） STL 的访问`map`。但是，我想在 boost( `boost::thread::id`) 中存储对线程 ID 的引用，并意识到这些标识符的 API 是如此不透明，以至于您无法清楚地获得它的哈希值。

令人惊讶的是，boost 实现了部分`tr1`（包括`hash`和`unordered_set`），但它没有定义能够散列线程 ID 的散列类。

查看文档，`boost::thread::id`我发现线程 ID 可以输出到流中，所以我的哈希解决方案是这样的：

```
struct boost_thread_id_hash
{
    size_t operator()(boost::thread::id const& id) const
    {
        std::stringstream ostr;
        ostr << id;
        std::tr1::hash<std::string> h;
        return h(ostr.str());
    }
}; 
```

也就是说，对其进行序列化，将哈希应用于结果字符串。但是，这似乎比实际使用 STL 效率低`map<boost::thread::id>`。

所以，我的问题是：你找到更好的方法了吗？不强制一个`hash<boost::thread::id>`类的存在是否在 boost 和 tr1 中都存在明显的不一致？

谢谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-09-08T17:13:47.293

`thread::id`正如您自己所说的那样，字符串化（仅用于随后计算字符串哈希）的开销与 a`tr1::unordered_map`可能赋予的任何性能优势相比是天文数字 vis-a-vis `std::map`。所以简短的回答是：**坚持使用 std::map< thread::id, ... >**

如果您*绝对*必须使用无序容器，请**尽可能尝试使用`native_handle_type`**而不是`thread::id`，即更喜欢`tr1::unordered_map< thread::native_handle_type, ... >`，调用`thread::native_handle()`而不是`thread::get_id()`when `insert`ing 和`find`ing。

**不要尝试以下任何事情**：

```
struct boost_thread_id_hash {
   // one and only member of boost::thread::id is boost::thread::id::thread_data
   //   of type boost::detail::thread_data_ptr;
   // boost::thread::id::operator==(const id&) compares boost::thread::id::thread_data's
   size_t operator()(boost::thread::id const& id) const {
      const boost::detail::thread_data_ptr* pptdp = \
        reinterpret_cast< boost::detail::thread_data_ptr* >(&id);
      return h(pptdp->get());
   }
}; 
```

它可以工作，但非常脆弱，几乎可以保证是定时炸弹。它假定对实现的内部工作有深入的了解`thread::id`。它会让你被其他开发者诅咒。如果可维护性有任何问题，请不要这样做！即使修补`boost/thread/detail/thread.hpp`以添加`size_t hash_value(const id& tid)`为朋友`thread::id`也“更好”。:)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-05-17T18:05:27.297

显而易见的问题是，您为什么要实际使用哈希？

我理解`map`/`set`对于性能关键代码的问题，实际上这些容器对缓存不是很友好，因为这些项目可能分配在非常不同的内存位置。

正如 KeithB 所建议的（我不会评论使用二进制表示，因为没有什么能保证 2 个 id 具有相同的二进制表示毕竟......），`vector`如果项目很少，使用排序可以加快代码速度。

排序的向量/双端队列对缓存更加友好，但是由于涉及复制，它们在插入/擦除时会遇到*O(N)复杂性。*一旦你达到几百个线程（顺便说一句，从未见过这么多线程），它可能会受到伤害。

然而，有一种数据结构试图将映射和排序向量的好处联系起来：[B+Tree](http://en.wikipedia.org/wiki/B%2B_tree)。

您可以将其视为一个地图，其中每个节点将包含多个元素（按排序顺序）。仅使用叶节点。

要获得更多性能，您可以：

*   线性链接叶子：即根缓存指向第一个和最后一个叶子的指针，并且叶子本身相互连接，因此线性行进完全绕过内部节点。
*   将最后访问的叶子缓存在根目录中，毕竟它很可能也是下一个访问的叶子。

渐近性能与映射相同，因为它是作为平衡二叉树实现的，但是由于值是分组打包的，因此您的代码可以通过常数变得更快。

真正的困难是定制每个“桶”的大小，您需要为此进行一些分析，因此如果您的实现允许在那里进行一些定制会更好（因为它将取决于执行代码的架构）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-21T15:31:28.190

为什么要将这些存储在一个集合中。除非你做一些不寻常的事情，否则会有少量线程。维护一个集合的开销可能比仅仅将它们放在一个向量中并进行线性搜索要高。

如果搜索比添加和删除更频繁，您可以使用排序向量。为 boost::thread::id 定义了一个 < 运算符，因此您可以在每次添加或删除后对向量进行排序（或插入到正确的位置），并用于`lower_bound()`进行二分查找。这与搜索集合的复杂性相同，并且对于少量数据应该具有较低的开销。

如果您仍然需要这样做，那么将其视为 sizeof(boost::thread:id) 字节并对其进行操作如何。

这个例子假设 boost::thread::id 的大小是 int 大小的倍数，并且没有打包，也没有虚函数。如果不是这样，则必须对其进行修改，或者根本不起作用。

编辑：我看了一下这个`boost::thread::id`类，它有`boost::shared_pointer<>`一个成员，所以下面的代码被严重破坏了。我认为唯一的解决方案是让作者`boost::thread`添加一个哈希函数。我将留下这个例子，以防它在其他情况下有用。

```
boost::thread::id id;
unsigned* data;
// The next line doesn't do anything useful in this case.
data = reinterpret_cast<unsigned *>(&id);
unsigned hash = 0;

for (unsigned int i = 0; i < sizeof(boost::thread::id)/4; i++)
  hash ^= data[i]; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-06-01T19:03:29.440

回答这个问题晚了几年，但是当试图将 boost::thread::id 作为键放入 std::unordered_map 时，这显示为最相关的问题。在接受的回复中，获取本机句柄是一个很好的建议，但它不适用于 this_thread。

相反，boost for sometime 有一个 thread::id 的 hash_value，所以这对我来说很好：

```
namespace boost {
  extern std::size_t hash_value(const thread::id &v);
}

namespace std {
  template<>
  struct hash<boost::thread::id> {
    std::size_t operator()(const boost::thread::id& v) const {
      return boost::hash_value(v);
    }
  };
} 
```

当然，需要针对 libboost_thread 库进行链接。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-06-01T06:13:31.407

您可以创建在 thread::id 和某些东西（例如：整数）之间进行映射的类，您可以将其用作哈希。唯一的缺点是您必须确保系统中只有一个映射对象实例。

# development-environment - 哪个 VMware 版本用于开发？

> ID：772205
> 
> 赞同：8
> 
> 时间：2009-04-21T11:54:02.333
> 
> 标签：development-environment, vmware, virtualization

我迷失在无数版本的 VMware 中。我应该选择哪一个？

我只想：

*   创建虚拟机
*   拍摄快照
*   在第三方主机操作系统（无 ESX）上运行它
*   为主机操作系统获得最少的资源密集型
*   **更新：**尽可能免费获得（“就像免费啤酒一样”）

我首先选择了 VMware 服务器，但我使用它是不是有点矫枉过正？我只会运行 1 个虚拟机。

谢谢你的建议，

发球台

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-21T12:06:48.807

**VMWare Workstation**将完成以上所有工作，甚至更多：

*   创建机器的完整（直接文件副本）或仅增量（使用“父”图像并且仅记录更改）克隆机器
*   模拟具有多台机器的环境（对客户端-服务器有用）
*   与 Visual Studio 调试器集成
*   屏幕截图/录音
*   将物理机导入为映像、设备、OVA（开放式虚拟机），还可以导出其他一些格式。

**VMWare Player**允许您免费将一台机器部署给其他人。它不会创建或更改图像。PDF 之于 Acrobat Reader，VM 图像之于 VMWare Player。

**VMWare Server**是他们较旧的服务器产品，现在免费。一些产品仍然与此集成。

**VMWare ESXi**是他们的轻量级企业解决方案，从去年开始免费。它允许使用多个图像，但缺乏高端工具，例如实时迁移。这主要用于SMB市场，因为它只能处理单机并且缺乏其“大哥”的集成功能。

**VMWare ESX**是“重度”付费解决方案（ESXi 的老大哥），拥有虚拟化服务器环境所需的所有高端产品，包括正在运行的机器从服务器到服务器的实时迁移（是的，您可以移动跨硬件）、共享图像、共享文件系统等。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-21T11:56:37.507

您需要 VMWare 工作站。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-12-10T12:32:37.613

您可以使用 VMWARE 工作站来执行上述任务。您还可以使用免费的 ESXi 主机通过我们的功能管理虚拟机。[请在此处](http://area51.stackexchange.com/proposals/47807/vmware-virtualization)发布所有与 VMWARE 相关的查询。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-23T00:15:38.907

我一直在内部开发虚拟机，我发现让它们在所有三个平台上经济且可用的最佳方法就是这样

首先在 mac 上使用 fusion 或在 linux 和/或 windows 上使用 vmplayer

访问 www.easyvmx.com 并为您的来宾操作系统创建一个起始布局

添加您想要的任何虚拟硬件，实际上我建议添加所有内容

下载 zip 文件，你就有了一个可以工作的空白虚拟机

只需将其中一个 vmware cdrom 指向 iso 或使用实际安装磁盘来安装选择的操作系统

差不多就是这样

vmx 只是一个文本文件，只需打开它，您就可以看到如何评论或禁用某些硬件

mac 上的一个注意事项是添加到 vmx 文件，如果您不希望硬盘驱动器填满 w 个快照文件，则 snapshot.disabled = "TRUE"

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-24T11:52:56.760

使用 Vmware 工作站版本 2，但如果您在 vmware hcl 上的硬件上运行 vmware，我发现使用 ESXi 性能更好。ESXi 的资源密集度最低，并且可以更好地控制 CPU、内存和网络资源。

# c++ - Linux下C/C++的最佳音频播放api？

> ID：772208
> 
> 赞同：3
> 
> 时间：2009-04-21T11:55:00.943
> 
> 标签：c++, linux, audio

什么是适用于 Linux 的 C/C++ 的最佳音频播放 api，最好是免费/开源？我需要它用于嵌入式 Linux，所以我正在寻找尽可能轻量级且依赖项不多的东西？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-21T12:08:24.077

这取决于您所说的“音频”是什么意思。如果您只想播放原始 PCM 样本数据，请直接使用[ALSA](http://alsa-project.org/main/index.php/Main_Page) API。如果您想解码和播放编码的声音，您当然需要查看支持所需格式的库。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-21T15:45:17.440

[PulseAudio](http://en.wikipedia.org/wiki/PulseAudio)已被主要发行版采用，看起来它是即将推出的 Linux 音频标准，因为它比[ALSA](http://www.alsa-project.org/)更灵活。这是一篇关于[为什么您应该关心 PulseAudio](http://www.linux.com/feature/119926)（以及如何开始这样做）的文章。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-21T12:06:14.737

SDL真的很不错

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-21T15:53:28.187

如果你在做嵌入的东西，我会直接使用 ALSA（虽然它很复杂）。我绝对不会使用 PulseAudio 之类的东西，因为它很重，而且只添加了另一层（整个单独的服务器）。SDL 可能没问题，但它主要用于游戏。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-21T18:43:03.193

根据您的用例，我会查看[gstreamer](http://www.gstreamer.net/)或[STK](http://ccrma.stanford.edu/software/stk/)。

# asp.net-mvc - 当 ASP.Net MVC 中的 ControllerContext 为空时，如何从模型中加载 xml 文件

> ID：772210
> 
> 赞同：1
> 
> 时间：2009-04-21T11:56:07.633
> 
> 标签：asp.net-mvc, file-io, controller

我有一个基本控制器抽象类，我的其他控制器继承了它。此类需要加载本地 xml 文件以便为母版页创建一些按钮。鉴于此阶段 ControllerContext 为空，加载文件的最佳做法是什么？（在网络服务器上运行时，我收到以下错误：*找不到路径的一部分 'c:\windows\system32\inetsrv\Content\Xml\Buttons.xml'*。）

当前代码是

```
using System.Web.Mvc;
using Site1.Models;

namespace Site1.Controllers
{

    [SkyArts.Models.Master]
    public abstract class BaseController : Controller
    {
        public BaseController()
        {
            XDocument buttonsXmlDoc = XDocument.Load("Content/Xml/Buttons.xml");
        }
    }
} 
```

该文档实际上是从 Model 类加载的，但为简洁起见，我忽略了这一点。

作为一个附带问题，您会将 xml 文件放在 Content 中还是 App_Data 中？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-21T12:57:42.990

我认为解决您的问题的方法是结合人们在这里提到的内容。覆盖 Initialize 并在那里加载您的 XML 文档。Server 属性此时应该是有效的。此外，使用*Server.MapPath*从您的网站目录层次结构中检索资源。

```
using System.Web.Mvc;
using Site1.Models;

namespace Site1.Controllers
{

    [SkyArts.Models.Master]
    public abstract class BaseController : Controller
    {
        protected override void Initialize(RequestContext rc)
        {
            base.Initialize(rc);

            XDocument buttonsXmlDoc = XDocument.Load(
                Server.MapPath("~/Content/Xml/Buttons.xml"));
        }
    }
} 
```

此外，请注意，在调用 Server.MapPath 时，请使用应用程序根路径到资源（即以波浪字符“~”开头的路径）——这就是您看到错误的*原因路径“c:\windows\system32\inetsrv\Content\Xml\Buttons.xml”。*

当您不使用 Server.MapPath 时，任何相对文件系统路径都相对于正在执行的进程，在这种情况下是 IIS。调用 Server.MapPath 会将您指定为相对于您网站的虚拟目录层次结构的资源转换为物理文件系统路径。

至于您关于 XML 文件位置的附带问题，我建议使用 App_Data ，因为存储在该文件夹中的文件在请求时不提供。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-21T12:38:57.280

不要在构造函数中调用它。重写 Initialize 方法。ControllerContext 在那里将是非空的。或者使用惰性实例化。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-21T12:12:28.840

**替代覆盖初始化，但我认为这是最好的方法。**

我使用 Server.MapPath 来解析文档根目录的路径。我还会使用 App_Data 以便无法下载原始文件。

```
var buttonsXmlDoc = XDocument.Load( HttpContext
                                      .Current
                                      .Server
                                      .MapPath( "~/App_Data/Buttons.xml" ) ); 
```

**编辑：**根据您的评论，您可以从 HttpContext.Current 引用 Server 对象，或者将 XML 的加载移动到 Initialize 方法，正如其他人所指出的那样。我推荐后者，但我会用前者更新我的答案作为替代方案。

# c# - 在 MVVM 中，ViewModel 或 Model 是否应该实现 INotifyPropertyChanged？

> ID：772214
> 
> 赞同：170
> 
> 时间：2009-04-21T11:57:00.530
> 
> 标签：c#, mvvm, inotifypropertychanged

我处理过的大多数 MVVM 示例都有*Model*实现 `INotifyPropertyChanged`，但在[Josh Smith 的 CommandSink 示例](http://www.codeproject.com/KB/WPF/VMCommanding.aspx) **中 ViewModel 实现了`INotifyPropertyChanged`**。

我仍在认知上将 MVVM 概念放在一起，所以我不知道是否：

*   您必须将其放入`INotifyPropertyChanged`ViewModel 才能开始`CommandSink`工作
*   这只是规范的偏差，并不重要
*   您应该始终实现模型`INotifyPropertyChanged`，这只是一个错误，如果将其从代码示例开发为应用程序，则可以更正

其他人在您从事的 MVVM 项目上有何经验？

* * *

## 回答 #1

> 赞同：154
> 
> 时间：2010-05-10T16:49:13.593

我强烈不同意模型不应该实现`INotifyPropertyChanged`. 此界面不是特定于 UI 的！它只是通知更改。实际上，WPF 大量使用它来识别更改，但这并不意味着它是一个 UI 界面。我会将其与以下评论进行比较：“*轮胎是汽车配件*”。当然可以，但自行车、公共汽车等也使用它。**总之，不要把那个界面当作 UI 的东西。**

话虽如此，但这并不一定意味着我相信模型应该提供通知。**事实上，根据经验，模型不应该实现这个接口，除非有必要。**在大多数情况下，没有将服务器数据推送到客户端应用程序，模型可能是陈旧的。但是如果听金融市场数据，那我不明白为什么模型不能实现接口。例如，如果我有非 UI 逻辑，例如当它收到给定值的买价或卖价时它会发出警报（例如通过电子邮件）或下订单的服务怎么办？这可能是一个可能的清洁解决方案。

然而，有不同的实现方式，但我总是主张简单并避免冗余。

什么是更好的？在视图模型上定义集合或属性更改的事件并将其传播到模型或让视图本质上更新模型（通过视图模型）？

最重要的是，每当你看到有人声称“*你不能这样做或那样做*”时，这表明他们不知道他们在说什么。

**这真的取决于你的情况，事实上 MVVM 是一个有很多问题的框架，我还没有看到一个通用的 MVVM 实现。**

我希望我有更多的时间来解释 MVVM 的多种风格和一些常见问题的解决方案——主要由其他开发人员提供，但我想我将不得不再做一次。

* * *

## 回答 #2

> 赞同：112
> 
> 时间：2009-04-21T12:09:11.657

我想说的恰恰相反，我总是把我的 ViewModel 放在`INotifyPropertyChanged`我的 ViewModel 上——你真的不想用相当 WPF 特定的功能来污染你的模型，比如`INotifyPropertyChanged`那些东西应该放在 ViewModel 中。

我相信其他人会不同意，但这就是我的工作方式。

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2009-05-04T12:35:05.513

在 MV-VM 中，ViewModel 总是（Model not always）实现`INotifyPropertyChanged`

[从http://blogs.msdn.com/llobo/archive/2009/05/01/download-mv-vm-project-template-toolkit.aspx](http://blogs.msdn.com/llobo/archive/2009/05/01/download-m-v-vm-project-template-toolkit.aspx)查看 MV-VM 项目模板/工具包。它使用`DelegateCommand`for 命令，它应该是您 MV-VM 项目的一个很好的起始模板。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2011-01-01T16:46:24.810

我认为 MVVM 的命名非常糟糕，并且将 ViewModel 称为 ViewModel 会导致许多人错过精心设计的架构的一个重要特性，即无论谁试图触摸它都可以控制数据的 DataController。

如果您将 View-Model 更多地视为 DataController 并实现一个架构，其中您的 DataController 是唯一接触数据的项目，那么您永远不会直接接触数据，而是始终使用 DataController。DataController 对 UI 很有用，但不一定只对 UI 有用。它用于业务层，UI层等......

```
DataModel -------- DataController ------ View
                  /
Business --------/ 
```

你最终得到了这样的模型。即使是业务也应该只使用 ViewModel 来接触数据。然后你的难题就消失了。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-04-21T12:55:52.077

这取决于您如何实现模型。我的公司使用类似于 Lhotka 的 CSLA 对象的业务对象，并在`INotifyPropertyChanged`整个业务模型中广泛使用。

我们的验证引擎很大程度上依赖于通过这种机制获得属性更改的通知，并且它运行良好。显然，如果您使用的是业务对象以外的其他实现，其中更改通知对操作来说不是那么重要，您可能有其他方法来检测业务模型中的更改。

我们也有视图模型在需要的地方传播模型的变化，但视图模型本身正在监听底层模型的变化。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2015-12-15T09:06:50.947

我同意 Paulo 的回答，`INotifyPropertyChanged`在模型中实施是完全可以接受的，甚至微软也建议 -

> 通常，模型实现了可以轻松绑定到视图的工具。这通常意味着它通过`INotifyPropertyChanged`和 `INotifyCollectionChanged`接口支持属性和集合更改通知。表示对象集合的模型类通常派生自 `ObservableCollection<T>`提供 `INotifyCollectionChanged`接口实现的类。

虽然由您决定是否需要这种类型的实现，但请记住 -

> **如果您的模型类没有实现所需的接口怎么办？**
> 
> 有时您需要使用不实现`INotifyPropertyChanged`、`INotifyCollectionChanged`、 `IDataErrorInfo`或`INotifyDataErrorInfo`接口的模型对象。在这些情况下，视图模型可能需要包装模型对象并将所需的属性公开给视图。这些属性的值将由模型对象直接提供。视图模型将为它公开的属性实现所需的接口，以便视图可以轻松地将数据绑定到它们。

取自 - [http://msdn.microsoft.com/en-us/library/gg405484(PandP.40).aspx](http://msdn.microsoft.com/en-us/library/gg405484(PandP.40).aspx)

我曾在一些尚未`INotifyPropertyChanged`在模型中实施的项目中工作过，因此我们面临很多问题；VM 中需要不必要的属性重复，同时我们必须在将底层对象（使用更新的值）传递给 BL/DL 之前更新它们。

如果您需要处理模型对象的集合（例如在可编辑的网格或列表中）或复杂模型，您将面临特别的问题；模型对象不会自动更新，您必须管理 VM 中的所有内容。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-02-19T08:09:03.157

我认为这完全取决于用例。

当你有一个带有大量属性的简单模型时，你可以让它实现 INPC。简单来说，我的意思是这个模型看起来很像[POCO](http://en.wikipedia.org/wiki/Plain_Old_CLR_Object)。

如果您的模型更复杂并且存在于交互式模型域中 - 模型引用模型，订阅其他模型的事件 - 将模型事件实现为 INPC 是一场噩梦。

将自己置于某个必须与其他模型合作的模型实体的位置。您有各种要订阅的事件。它们都作为 INPC 实施。想象一下您拥有的那些事件处理程序。大量的 if 子句和/或 switch 子句。

INPC的另一个问题。您应该将您的应用程序设计为依赖于抽象，而不是实现。这通常使用接口来完成。

让我们看一下同一抽象的两种不同实现：

```
public class ConnectionStateChangedEventArgs : EventArgs
{
    public bool IsConnected {get;set;}
}

interface IConnectionManagerINPC : INotifyPropertyChanged
{
    string Name {get;}
    int ConnectionsLimit {get;}
    /*

    A few more properties

    */
    bool IsConnected {get;}
}

interface IConnectionManager
{
    string Name {get;}
    int ConnectionsLimit {get;}
    /*

    A few more properties

    */
    event EventHandler<ConnectionStateChangedEventArgs> ConnectionStateChanged;
    bool IsConnected {get;}
} 
```

现在看看他们两个。IConnectionManagerINPC 告诉你什么？它的某些属性可能会改变。你不知道他们中的哪一个。事实上，设计是只有 IsConnected 发生变化，因为其余的都是只读的。

相反，IConnectionManager 的意图很明确：“我可以告诉你，我的 IsConnected 属性的值可能会改变”。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-04-21T12:48:55.680

我会在你的 ViewModel 中说。它不是模型的一部分，因为模型与 UI 无关。该模型应该是“除了业务不可知论之外的一切”

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-11-10T14:07:02.633

但有时（如在此演示[链接文本](http://blog.lab49.com/archives/2650)中）模型是服务，它为应用程序在线提供一些数据，然后您需要使用事件实现新数据到达或数据已更改的通知......

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2013-08-24T06:46:42.893

如果你想坚持 MV-VM，我认为答案很清楚。

见： http: [//msdn.microsoft.com/en-us/library/gg405484 (v=PandP.40).aspx](http://msdn.microsoft.com/en-us/library/gg405484(v=PandP.40).aspx)

在 MVVM 模式中，视图封装了 UI 和任何 UI 逻辑，视图模型封装了表示逻辑和状态，模型封装了业务逻辑和数据。

> “视图通过数据绑定、命令和更改通知事件与视图模型交互。视图模型查询、观察和协调对模型的更新，根据需要转换、验证和聚合数据以在视图中显示。”

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2019-04-05T16:40:46.930

如果模型在 ViewModel 中明确公开，则可以在模型中实现 INPC。但一般来说，封装模型的 ViewModel 是他自己的类，以降低模型复杂度（这对绑定应该没有用处）。在这种情况下，INPC 应该在 ViewModel 中实现。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-09-20T17:49:51.263

我`INotifyPropertyChange`在模型中使用接口。实际上，模型属性更改应该只由 UI 或外部客户端触发。

我注意到几个优点和缺点：

**优点**

通知者在商业模式中

1.  根据域驱动，它是正确的。它应该决定何时加注，何时不加注。

**缺点**

该模型具有属性（数量、费率、佣金、总运费）。Totalfrieght 是使用数量、费率、佣金变化来计算的。

1.  从 db 加载值时，总运费计算称为 3 次（数量、费率、佣金）。应该是一次。

2.  如果在业务层分配了rate，qty，则再次调用notifier。

3.  应该有一个选项来禁用它，可能在基类中。但是，开发人员可能会忘记这样做。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2011-11-30T11:48:27.990

只需`INotifyPropertyChange`在您的视图模型中使用，而不是在模型中使用，

该模型通常使用`IDataErrorInfo`来处理验证错误，因此只需保留在您的 ViewModel 中，您就可以在您的 MVVM 道路上。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-08-23T07:15:45.797

假设您的视图中对象的引用发生了变化。您将如何通知所有要更新的属性以显示正确的值？`OnPropertyChanged`在我看来，在您的视图中调用所有对象的属性是垃圾。

所以我要做的是让对象本身在属性中的值发生变化时通知任何人，并且在我看来，我使用诸如`Object.Property1`,之类`Object.Property2`的绑定。这样，如果我只想更改当前在我的视图中维护的对象，我就这样做`OnPropertyChanged("Object")`。

为了避免在加载对象期间收到数百个通知，我有一个私有布尔指示器，我在加载期间将其设置为 true，它从对象的检查中检查`OnPropertyChanged`并且什么都不做。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-10-14T05:01:11.593

恕我直言，我认为视图模型实现`INotifyPropertyChange`并且模型可以在不同的“级别”上使用通知。

例如，对于某些文档服务和文档对象，您有一个 documentChanged 事件，视图模型会监听该事件以清除和重建视图。在编辑视图模型中，您对文档的属性进行了属性更改以支持视图。如果该服务在保存时对文档做了很多工作（更新更改日期、最后一个用户等），您很容易得到 Ipropertychanged 事件的过载，并且只需一个 documentchanged 就足够了。

但是如果你`INotifyPropertyChange`在你的模型中使用我认为在你的视图模型中传递它而不是直接在你的视图中订阅它是一个好习惯。在这种情况下，当模型中的事件发生变化时，您只需更改视图模型并且视图保持不变。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2011-07-16T02:33:48.313

通常 ViewModel 将实现`INotifyPropertyChanged`. 模型可以是任何东西（xml 文件、数据库甚至对象）。模型用于将数据提供给视图模型，该视图模型会传播到视图。

[看这里](http://msdn.microsoft.com/en-us/magazine/dd419663.aspx)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2019-02-28T13:27:32.997

所有绑定到我的视图的属性都在我的 ViewModel(s) 中。因此他们应该实现 INotifyPropertyChanged 接口。因此视图获得所有更改。

[使用 MVVM Light 工具包，我让它们继承自 ViewModelBase。]

Model 持有业务逻辑，但与视图无关。因此不需要 INotifyPropertyChanged 接口。

# pagination - 扭曲的分页

> ID：772215
> 
> 赞同：-1
> 
> 时间：2009-04-21T11:57:05.057
> 
> 标签：pagination

我正在使用 Struts 2 框架，但这个问题不仅仅是 Struts 2 相关的。

我试图在我的网站上进行某种分页。假设我有一个要在页面上显示的记录列表。该列表有 150 条记录，但我想在每页上显示 50 条，所以在这种情况下将有 3 页。当然，列表将从数据库中获取。

扭曲是我们有一个限制，如果查询花费超过 7 秒，它就会被*杀死*（不要问）。因此，如果我们同时获得 150 条记录，我们的查询将花费超过 7 秒。所以我们决定每次获取 50 条记录。因此，在这种情况下，我们将访问数据库 3 次（50 50 50）。第一次我们将获取总数（150），所以我们知道我们应该返回数据库多少次。

你们中的一些人可以分享您对如何处理此类事情的想法吗？我知道你们中的一些人可能会说调整存储过程或查询是最好的选择，但这将是一条痛苦的道路，因为我们有大量的 SP 和查询。

我会很感激任何例子。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T12:15:23.060

您不需要第一次进行实际获取，您可以仅获取计数（聚合函数查询）。实时分页列表在非常大的数据集中特别常见，唯一的问题是无法保证页面状态。也就是说，记录可能会按顺序插入前一页中，从而将旧记录推送到新页面中，反之亦然。不过，它通常可以接受。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T12:47:22.627

一个分页查询示例，这样您只能获得有限数量的记录：-

```
select * from records limit $start,50 
```

在这里，我假设您的原始查询是从记录中选择 *。只需在原始查询中附加“limit $start,50”即可。在这里，当您希望前 50 条记录 start 应该等于 0 时，要获取 50-100 条记录 start 应该等于 50 并且 100-150 条记录 start 应该等于 100。通过将“limit $start,50”附加到任何查询，查询从记录号 $start 开始获取 50 条记录。我希望这能解决您的分页问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T12:13:23.923

您是否只是在寻找有关如何处理分页的一般提示？您认为您应该只从数据库中获取您需要的记录以保持较小的查询，您的想法是正确的。

不同的 RDBMS 有不同的方法来枚举和分页记录。MySQL 有这个`LIMIT`关键字，MS SQL Server 2005 及以上有这个`ROW_NUMBER()`功能，Oracle 有一个`ROWNUM`专门的专栏。根据您的 RDBMS，应该很容易找到使用这些功能的示例。

# c# - 新手 C# 和 web 服务问题

> ID：772216
> 
> 赞同：0
> 
> 时间：2009-04-21T11:57:44.727
> 
> 标签：c#, web-services, wsdl.exe

我是 C# 新手（2 天），正在尝试使用 web 服务。我已经成功编译了一个示例脚本来访问和使用 web 服务。通过控制台应用程序对其进行了测试，并且运行良好。我用wsdl.exe编译生成proxy.cs文件，然后用csc.exe生成exe。

现在我希望能够使用 Web 表单中的参数调用脚本，但我有点迷失了。我创建了一个基于 C# 的表单，其中输入了参数（用户、密码）。按下提交按钮时，我想调用 web 服务。

我是否需要将 .cs 编译成 DLL 并直接在我的代码中使用它？我该怎么做？

感谢你给与我的帮助。记住我来自 PHP，所以这一切对我来说都很新鲜！！！

顺便说一句，wsdl.exe 和 svcutil.exe 有什么区别？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T12:02:23.793

您甚至不需要使用 WSDL.exe，只需从您正在使用 Web 服务的项目中创建一个 Web 引用，您就可以开始使用了！之后，您基本上可以像使用任何本地库类一样使用 Web 服务。网络参考负责所有细节。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T12:09:35.743

wsdl.exe为您的 Web 服务类写入[WSDL](http://en.wikipedia.org/wiki/Web_Services_Description_Language)，并为您的 WSDL 代理类 [svcutil.exe](http://msdn.microsoft.com/en-us/library/aa347733.aspx)可以做更广泛的事情，但可以为 WCF（[Windows Communication Foundation](http://en.wikipedia.org/wiki/Windows_Communication_Foundation)）服务生成代理。也许 svcutil 可以被认为是 wsdl 的 WCF 版本。

# excel - 如何让 countifs 选择 Excel 中的所有非空白单元格？

> ID：772225
> 
> 赞同：77
> 
> 时间：2009-04-21T12:00:57.603
> 
> 标签：excel

如何`countifs`选择所有非空白单元格？我还有另外两个标准，因此`counta`不能单独使用。

使用`istext`使结果始终为 0。`<>""` 用作标准时，Excel 会出错 。

* * *

## 回答 #1

> 赞同：112
> 
> 时间：2009-04-21T12:13:30.897

使用标准`"<>"`。它将计算任何不是空单元格的内容，包括`#NAME?`or `#DIV/0!`。至于它为什么起作用，如果我知道的话，该死的，但 Excel 似乎理解它。

> **注意：**也可以很好地`Google Spreadsheet`工作

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2012-11-26T20:41:01.170

如果多个条件使用 countifs

```
=countifs(A1:A10,">""",B1:B10,">""") 
```

`" >"" "` 看着大于空。此公式查找两个条件，并且同一行上的任何一列都不能为空，以便计算。如果只计算一列，则使用一个标准执行此操作（即在`B1:B10`不包括逗号之前使用所有内容）

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2012-01-20T05:15:46.927

在 Excel 2010 中，您有 countifS 函数。

如果我试图计算一个范围内具有非 0 值的单元格的数量，我会遇到问题。

例如，如果您的工作表在 A1:A10 范围内的值为 1、0、2、3、0，并且您想要答案 3。

正常功能 =COUNTIF(A1:A10,"<>0") 会给你 8 因为它将空白单元格计数为 0。

我对此的解决方案是使用具有相同范围但多个条件的 COUNTIFS 函数，例如

**=COUNTIFS(A1:A10,"<>0",A1:A10,"<>")**

这有效地检查范围是否为非 0 且非空白。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-21T12:20:45.577

如果您使用多个条件，并且想要计算特定列中非空白单元格的数量，您可能需要查看 DCOUNTA。

例如

```
 A   B   C   D  E   F   G
1 Dog Cat Cow    Dog Cat
2 x   1          x   1
3 x   2 
4 x   1   nb     Result:
5 x   2   nb     1 
```

E5 中的公式：=DCOUNTA(A1:C5,"Cow",E1:F2)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-07-27T01:30:18.633

你可以试试这个：

```
=COUNTIF(Data!A2:A300,"<>"&"") 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-07-27T03:16:33.253

我发现最好的方法是`SUMPRODUCT`改用：

```
=SUMPRODUCT((A1:A10<>"")*1) 
```

如果您想加入更多标准，那也很棒：

```
=SUMPRODUCT((A1:A10<>"")*(A1:A10>$B$1)*(A1:A10<=$B$2)) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-03-04T21:04:59.060

我发现最好的方法是使用组合“IF”和“ISERROR”语句：

```
=IF(ISERROR(COUNTIF(E5:E356,1)),"---",COUNTIF(E5:E356,1) 
```

如果出现错误（如果单元格中没有要计数/平均/等的数据），此公式将用三个破折号 (---) 填充单元格，或者使用计数（如果单元格中有数据)

这个逻辑查询的好处在于，它将通过使它们成为“---”的文本值来排除完全空白的行/列，所以如果你有一个行计数（或平均），然后计算（或平均）在公式中的另一个位置，第二个公式不会响应错误，因为它会忽略“---”单元格。

# php - 使用 Dreamweaver 设计 WordPress 主题

> ID：772234
> 
> 赞同：0
> 
> 时间：2009-04-21T12:02:08.693
> 
> 标签：php, mysql, wordpress, dreamweaver

我一直试图弄清楚如何正确设置 DreamWeaver，以便我可以创建 WordPress 主题。现在我在 localhost 上运行 WordPress，通过 DreamWeaver 访问它。然后我在实际的 WordPress 代码上使用 LiveView 并修改主题文件夹中的文件。

我真正想做的，我不确定这是否可能，是直观地查看主题并修改它，而不必在 wordpress 主题和其余代码之间来回切换。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T12:27:03.393

我找到了这个资源：[Wp Themer](http://wpthemerkit.com/)。它甚至不需要 WordPress 启动和运行，并且您可以利用您的 Dreamweaver 技能来不来回走动。该工具包包括您需要的所有样式和一个包含 WordPress 网站所有部分的示例页面。

# python - Django 支付处理

> ID：772240
> 
> 赞同：24
> 
> 时间：2009-04-21T12:05:31.727
> 
> 标签：python, django

任何人都可以为 python/django 推荐任何好的支付处理库吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-21T12:28:12.000

最发达的 Django 解决方案是[Satchmo](http://www.satchmoproject.com/docs/svn/)，它支持 Authorize.Net、TrustCommerce、Cyber​​Source、PayPal、Google Checkout 和 Protx。

Django 块上的新孩子是[django-lfs](http://code.google.com/p/django-lfs/)，它目前看起来只支持 PayPal，甚至可能还不完整。

对于一般 Python，主要参与者是[getpaid](http://code.google.com/p/getpaid/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-10-03T20:27:59.570

有一个[名为 Mamona 的 Django 支付应用程序](http://github.com/emesik/mamona)，目前仅支持 PayPal。它可以与任何现有应用程序一起使用，而无需更改其代码。基本上，它可以使用**任何现有模型**作为订单。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-21T12:26:33.347

也许您可以在 Satchmo 中找到一些有用的代码提示/模块： [Satchmo 主页](http://www.satchmoproject.com/)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-11T23:22:33.650

Django paypal 非常酷。我已经在我的几个项目中使用过。与现有网站集成相对容易。Satchmo 很好，如果你想要一个完整的互联网商店，但如果你只想从你的网站上出售几件专门用于其他东西的商品，你会发现 Satchmo 非常重（安装很多依赖项，真的很复杂您的管理员）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-03-15T20:58:39.437

您可能想看看[https://github.com/bkeating/python-payflowpro/](https://github.com/bkeating/python-payflowpro/)它不是 django 特定的，但可以很好地使用它或在普通的 ole python 中工作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-12-03T04:10:03.487

我创建了 Paython：[https ://github.com/abunsen/Paython](https://github.com/abunsen/Paython)

支持几种不同的处理器：

1.  条纹
2.  授权网
3.  第一个数据/链接点
4.  创新网关（来自直觉）
5.  插件支付
6.  武士

# sql - 在创建/插入时添加序列号 - Teradata

> ID：772246
> 
> 赞同：3
> 
> 时间：2009-04-21T12:07:07.200
> 
> 标签：sql, teradata, row-number

在 oracle 中，我们将在创建此表时在 select 上使用 rownum。现在在 teradata 中，我似乎无法让它工作。除非我一起使用 3 列，否则没有可以排序的列并具有唯一值（大量重复）。

旧的方式是这样的，

```
create table temp1 as 
  select
    rownum as insert_num,
    col1,
    col2,
    col3
  from tables a join b on a.id=b.id
; 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-25T00:17:05.053

您可以这样做：

```
create table temp1 as 
( 
   select
      sum(1) over( rows unbounded preceding ) insert_num
     ,col1
     ,col2
     ,col3
   from a join b on a.id=b.id
) with data ; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-10T12:55:31.863

Teradata 从 V2R6.x 开始在其表上具有标识列的概念。这些列与 Oracle 的序列概念的不同之处在于分配的数字不保证是连续的。Teradata 中的标识列仅用于保证行唯一性。

例子：

```
CREATE MULTISET TABLE MyTable
  (
   ColA INTEGER GENERATED BY DEFAULT AS IDENTITY
       (START WITH 1
        INCREMENT BY 20)
   ColB VARCHAR(20) NOT NULL
  )
UNIQUE PRIMARY INDEX pidx (ColA); 
```

当然，ColA 可能不是用于数据访问或与数据模型中的其他表连接的最佳主索引。它只是表明您*可以*将其用作桌面上的 PI。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-15T22:56:43.020

这也有效：

```
create table temp1 as 
( 
   select
   ROW_NUMBER() over( ORDER BY col1 ) insert_num
   ,col1
   ,col2
   ,col3
   from a join b on a.id=b.id
) with data ; 
```

# c# - 替换查询字符串中的项目

> ID：772253
> 
> 赞同：19
> 
> 时间：2009-04-21T12:08:58.460
> 
> 标签：c#, asp.net, query-string

我有一个也可能有查询字符串部分的 URL，查询字符串可能为空或有多个项目。

我想替换查询字符串中的一项，或者如果该项不存在则添加它。

我有一个带有完整 URL 的 URI 对象。

我的第一个想法是使用正则表达式和一些字符串魔法，应该可以。

但这似乎有点不稳定，也许框架有一些查询字符串构建器类？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2012-05-02T10:44:12.403

我发现这是一个更优雅的解决方案

```
var qs = HttpUtility.ParseQueryString(Request.QueryString.ToString());
qs.Set("item", newItemValue);
Console.WriteLine(qs.ToString()); 
```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2014-10-15T11:23:17.633

让我们有这个网址： `https://localhost/video?param1=value1`

首先将特定查询字符串参数更新为新值：

```
var uri = new Uri("https://localhost/video?param1=value1");
var qs = HttpUtility.ParseQueryString(uri.Query);
qs.Set("param1", "newValue2"); 
```

接下来创建`UriBuilder`并更新`Query`属性以生成具有更改参数值的新 uri。

```
var uriBuilder = new UriBuilder(uri);
uriBuilder.Query = qs.ToString();
var newUri = uriBuilder.Uri; 
```

现在你有`newUri`这个值： `https://localhost/video?param1=newValue2`

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-02-08T15:03:10.710

我使用以下方法：

```
 public static string replaceQueryString(System.Web.HttpRequest request, string key, string value)
    {
        System.Collections.Specialized.NameValueCollection t = HttpUtility.ParseQueryString(request.Url.Query);
        t.Set(key, value);
        return t.ToString();
    } 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-21T12:33:07.013

也许你可以使用这个`[System.UriBuilder](http://msdn.microsoft.com/en-us/library/system.uribuilder.aspx)`类。它有一个`[Query](http://msdn.microsoft.com/en-us/library/system.uribuilder.query.aspx)`属性。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-10-05T10:45:29.987

```
string link = page.Request.Url.ToString();

if(page.Request.Url.Query == "")
    link  += "?pageIndex=" + pageIndex;
else if (page.Request.QueryString["pageIndex"] != "")
{
    var idx = page.Request.QueryString["pageIndex"];
    link = link.Replace("pageIndex=" + idx, "pageIndex=" + pageIndex);
}
else 
    link += "&pageIndex=" + pageIndex; 
```

这似乎工作得很好。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-21T12:21:55.870

不，框架没有任何现有的 QueryStringBuilder 类，但通常 HTTP 请求中的查询字符串信息可`NameValueCollection`通过`Request.Querystring`属性作为可迭代和可搜索的。

但是，由于您是从一个`Uri`对象开始的，因此您需要使用`Query`该对象的属性来获取查询字符串部分`Uri`。这将产生一个形式的字符串：

```
Uri myURI = new Uri("http://www.mywebsite.com/page.aspx?Val1=A&Val2=B&Val3=C");
string querystring = myURI.Query;

// Outputs: "?Val1=A&Val2=B&Val3=C". Note the ? prefix!
Console.WriteLine(querystring); 
```

然后，您可以在 & 字符上拆分此字符串，以将其区分为不同的查询字符串参数-值对。然后再次拆分“=”字符上的每个参数，以将其区分为键和值。

由于您的最终目标是搜索特定的查询字符串键并在必要时创建它，因此您应该尝试（重新）创建一个集合（最好是通用的），以便您轻松地在集合中搜索，类似于提供的工具`NameValueCollection`班级。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-10-14T08:34:14.930

我使用以下代码附加/替换当前请求 URL 中的参数值：

```
 public static string CurrentUrlWithParam(this UrlHelper helper, string paramName, string paramValue)
    {
        var url = helper.RequestContext.HttpContext.Request.Url;
        var sb = new StringBuilder();

        sb.AppendFormat("{0}://{1}{2}{3}",
                        url.Scheme,
                        url.Host,
                        url.IsDefaultPort ? "" : ":" + url.Port,
                        url.LocalPath);

        var isFirst = true;

        if (!String.IsNullOrWhiteSpace(url.Query))
        {
            var queryStrings = url.Query.Split(new[] { '?', ';' });
            foreach (var queryString in queryStrings)
            {
                if (!String.IsNullOrWhiteSpace(queryString) && !queryString.StartsWith(paramName + "="))
                {
                    sb.AppendFormat("{0}{1}", isFirst ? "?" : ";", queryString);
                    isFirst = false;
                }
            }
        }

        sb.AppendFormat("{0}{1}={2}", isFirst ? "?" : ";", paramName, paramValue);

        return sb.ToString();
    } 
```

也许这有助于其他人在找到这个主题时。

**更新：**

刚刚看到有关 UriBuilder 的提示，并使用 UriBuilder、StringBuilder 和 Linq 做了第二个版本：

```
 public static string CurrentUrlWithParam(this UrlHelper helper, string paramName, string paramValue)
    {
        var url = helper.RequestContext.HttpContext.Request.Url;
        var ub = new UriBuilder(url.Scheme, url.Host, url.Port, url.LocalPath);

        // Query string
        var sb = new StringBuilder();
        var isFirst = true;
        if (!String.IsNullOrWhiteSpace(url.Query))
        {
            var queryStrings = url.Query.Split(new[] { '?', ';' });
            foreach (var queryString in queryStrings.Where(queryString => !String.IsNullOrWhiteSpace(queryString) && !queryString.StartsWith(paramName + "=")))
            {
                sb.AppendFormat("{0}{1}", isFirst ? "" : ";", queryString);
                isFirst = false;
            }
        }
        sb.AppendFormat("{0}{1}={2}", isFirst ? "" : ";", paramName, paramValue);
        ub.Query = sb.ToString();

        return ub.ToString();
    } 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-21T13:46:40.330

我同意 Cerebrus 的观点。坚持 KISS 原则，你有查询字符串，

```
string querystring = myURI.Query; 
```

你知道你在寻找什么以及你想用什么来替换它。

所以使用这样的东西： -

```
if (querystring == "") 
  myURI.Query += "?" + replacestring; 
else 
  querystring.replace (searchstring, replacestring); // not too sure of syntax !! 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-21T12:26:50.943

不久前我回答了一个[类似的问题。](https://stackoverflow.com/questions/229925/outputing-a-manipulated-querystring-in-c/)基本上，最好的方法是使用`HttpValueCollection`该`QueryString`属性实际上是的 class ，不幸的是它在 .NET 框架中是内部的。您可以使用 Reflector 来抓取它（并将其放入您的 Utils 类中）。通过这种方式，您可以像 NameValueCollection 一样操作查询字符串，但所有 url 编码/解码问题都会为您处理好。

`HttpValueCollection`extends `NameValueCollection`，并具有一个构造函数，该构造函数采用编码的查询字符串（包括与号和问号），并且它覆盖了一个`ToString()`稍后从基础集合重建查询字符串的方法。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-11-17T11:53:41.760

```
 public class QueryParams : Dictionary<string,string>
   {
       private Uri originolUrl;
       private Uri ammendedUrl;
       private string schemeName;
       private string hostname;
       private string path;

       public QueryParams(Uri url)
       {
           this.originolUrl = url;
           schemeName = url.Scheme;
           hostname = url.Host;
           path = url.AbsolutePath;
           //check uri to see if it has a query
           if (url.Query.Count() > 1)
           {
               //we grab the query and strip of the question mark as we do not want it attached
               string query = url.Query.TrimStart("?".ToArray());
               //we grab each query and place them into an array
               string[] parms = query.Split("&".ToArray());
               foreach (string str in parms)
               {
                   // we split each query into two strings(key) and (value) and place into array
                   string[] param = str.Split("=".ToArray());
                   //we add the strings to this dictionary
                   this.Add(param[0], param[1]);
               }
           }
       }

       public QueryParams Set(string paramName, string value)
       {

           if(this.ContainsKey(paramName))
           {
               //if key exists change value
               this[paramName] = value;
               return (this);
           }
           else
           {
               this.Add(paramName, value);
               return this;
           }
       }
       public QueryParams Set(string paramName, int value)
       {
           if (this.ContainsKey(paramName))
           {
               //if key exists change value
               this[paramName] = value.ToString();
               return (this);
           }
           else 
           {
               this.Add(paramName, value);
               return this;
           }
       }

       public void Add(string key, int value)
       {
           //overload, adds a new keypair
           string strValue = value.ToString();
           this.Add(key, strValue);
       }

       public override string ToString()
       {
           StringBuilder queryString = new StringBuilder();

           foreach (KeyValuePair<string, string> pair in this)
           {
               //we recreate the query from each keypair 
               queryString.Append(pair.Key + "=" + pair.Value + "&");
           }
           //trim the end of the query
           string modifiedQuery = queryString.ToString().TrimEnd("&".ToArray());

           if (this.Count() > 0)
           {
               UriBuilder uriBuild = new UriBuilder(schemeName, hostname);
               uriBuild.Path = path;
               uriBuild.Query = modifiedQuery;
               ammendedUrl = uriBuild.Uri;
               return ammendedUrl.AbsoluteUri;
           }
           else
           {
               return originolUrl.ToString();
           }
       }

       public Uri ToUri()
       {
          this.ToString();
          return ammendedUrl;
       }
   }
} 
```

# svn - 无法在 Mac 中使用 git-svn

> ID：772255
> 
> 赞同：8
> 
> 时间：2009-04-21T12:09:19.333
> 
> 标签：svn, git, macos, macports

我在 MacPorts 中安装了带有 svn 的 Git

```
sudo port install git-core +svn 
```

我尝试使用 git-svn 失败

```
git svn egUrl 
```

和

```
git-svn egUrl 
```

**MacPorts 安装后**如何在 Mac 中使用 Git-svn ？****

 *** * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-21T12:39:28.887

您必须首先将 Svn 存储库克隆到 git 中。就我而言，我使用以下内容（我的 git-core 是 v1.6.x）：

`git svn clone https://myrepos.com/project -T trunk -b branches/*/* --prefix=svn/`

克隆可能需要一段时间，但一旦完成，您将能够使用 git 命令与新的 git 存储库交互，然后分别使用`git svn rebase`和拉/提交到 svn `git svn dcommit`。

这有点高级，没有提供太多细节，但希望它至少能让你入门。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-21T14:31:22.127

`git init`在调用之前不要忘记到您的目录`git svn init`。

# c# - || （或）使用 C# 的 Linq 中的运算符

> ID：772261
> 
> 赞同：12
> 
> 时间：2009-04-21T12:10:36.163
> 
> 标签：c#, .net, linq, linq-to-sql, null

我正在使用 linq 过滤选择的 MessageItems。我编写的方法接受一堆可能为空的参数。如果它们为空，则应忽略文件的标准。如果不为空，则使用它来过滤结果。

据我了解，当做 || 操作是 C#，如果第一个表达式为真，则不应计算第二个表达式。

例如

```
if(ExpressionOne() || ExpressionTwo())
{
     // only ExpressionOne was evaluated because it was true
} 
```

现在，在 linq 中，我正在尝试这个：

```
var messages = (from msg in dc.MessageItems
where  String.IsNullOrEmpty(fromname) || (!String.IsNullOrEmpty(fromname) && msg.FromName.ToLower().Contains(fromname.ToLower()))
select msg); 
```

我原以为这会是合理的，因为`String.IsNullOrEmpty(fromname)`等于 true 和 || 的第二部分 不会跑。

但是它确实运行了，第二部分

```
msg.FromName.ToLower().Contains(fromname.ToLower())) 
```

抛出空引用异常（因为`fromname`为空）！！- 我得到一个经典的“对象引用未设置为对象的实例”异常。

有什么帮助吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-21T12:18:59.153

阅读[本文档](http://msdn.microsoft.com/en-us/library/bb386909.aspx)，该文档解释了 linq 和 c# 是如何断开连接的。

由于 Linq 表达式预计会简化为普通方法之外的其他内容，因此如果稍后在某些非 Linq to Objects 上下文中使用此代码，您可能会发现此代码会中断。

那说

```
String.IsNullOrEmpty(fromname) || 
(   !String.IsNullOrEmpty(fromname) && 
    msg.FromName.ToLower().Contains(fromname.ToLower())
) 
```

形成不良，因为它真的应该是

```
String.IsNullOrEmpty(fromname) || 
msg.FromName.ToLower().Contains(fromname.ToLower()) 
```

这很清楚你依赖 msg 和 msg.FromName 两者都是非空的。

为了让您在 c# 中的生活更轻松，您可以添加以下字符串扩展方法

```
public static class ExtensionMethods
{
    public static bool Contains(
        this string self, string value, StringComparison comparison)
    {
        return self.IndexOf(value, comparison) >= 0;
    }

    public static bool ContainsOrNull(
        this string self, string value, StringComparison comparison)
    {
        if (value == null)
            return false;
        return self.IndexOf(value, comparison) >= 0;
    }
} 
```

然后使用：

```
var messages = (from msg in dc.MessageItems
where  msg.FromName.ContainsOrNull(
    fromname, StringComparison.InvariantCultureIgnoreCase)
select msg); 
```

然而，这不是问题。问题是系统的 Linq to SQL 方面正在尝试使用该`fromname`值来构造发送到服务器的*查询。*

由于是一个变量，因此翻译机制会关闭并执行所要求的操作（即使它为 null，也会`fromname`生成小写表示，这会触发异常）。`fromname`

在这种情况下，您可以执行您已经发现的操作：保持查询不变，但确保始终可以创建具有所需行为的非 null fromname 值，即使它为 null。

也许更好的是：

```
IEnumerable<MessageItem> results;
if (string.IsNullOrEmpty(fromname))
{ 
    results = from msg in dc.MessageItems 
    select msg;    
}
else
{
    results = from msg in dc.MessageItems 
    where msg.FromName.ToLower().Contains(fromname) 
    select msg;    
} 
```

这不是很好，因为查询包含其他约束，因此涉及更多重复，但对于简单查询实际上应该导致更多可读/可维护的代码。如果您依赖匿名类型，这会很痛苦，但希望这对您来说不是问题。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-21T12:42:32.497

好的。我找到***了一个***解决方案。

我将违规行更改为：

```
where (String.IsNullOrEmpty(fromemail)  || (msg.FromEmail.ToLower().Contains((fromemail ?? String.Empty).ToLower()))) 
```

它有效，但感觉就像一个黑客。我确定如果第一个表达式为真，则不应评估第二个表达式。

如果有人可以为我确认或否认这一点，那就太好了...

或者如果有人有更好的解决方案，请告诉我！！！

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-25T18:56:08.590

如果您使用的是 LINQ to SQL，*则不能*期望 SQL Server 中出现相同的 C# 短路行为。请参阅[有关](https://stackoverflow.com/questions/789231/is-the-sql-where-clause-partially-evaluated)SQL Server 中的短路`WHERE`子句（或缺少）的问题。

另外，正如我在评论中提到的，我不相信您在 LINQ to SQL 中遇到此异常，因为：

1.  方法`String.IsNullOrEmpty(String)`不支持对 SQL 的转换，因此您不能在 LINQ to SQL 中使用它。
2.  你不会得到 NullReferenceException。这是一个托管异常，它只会发生在客户端，不会发生在 SQL Server 中。

你确定这不是在某个地方通过 LINQ to Objects 吗？在运行此查询之前，您是在源上调用 ToList() 或 ToArray() 还是将其作为 IEnumerable<T> 引用？

* * *

**更新：**阅读您的评论后，我再次对此进行了测试并意识到了一些事情。我错了你不使用 LINQ to SQL。您没有收到`"String.IsNullOrEmpty(String) has no supported translation to SQL"`异常，因为`IsNullOrEmpty()`正在对局部变量而不是 SQL 列调用，因此它在客户*端*运行，即使您使用的是 LINQ to SQL（而不是 LINQ to Objects）。由于它在客户端运行，因此您*可以*在该方法调用上获得 a `NullReferenceException`，因为它没有被转换为 SQL，您无法在其中获得`NullReferenceException`.

使您的解决方案看起来不那么老套的一种方法是`fromname`在查询之外解决“空值”：

```
string lowerfromname = String.IsNullOrEmpty(fromname) ? fromname : fromname.ToLower();

var messages = from msg in dc.MessageItems
               where String.IsNullOrEmpty(lowerfromname) || msg.Name.ToLower().Contains(lowerfromname)
               select msg.Name; 
```

请注意，这并不总是被翻译成类似的东西（以您的评论为例）：

```
SELECT ... FROM ... WHERE @theValue IS NULL OR @theValue = theValue 
```

它的翻译将在运行时根据是否`fromname`为空来决定。如果它为空，它将在没有`WHERE`子句的情况下进行翻译。如果它不为空，它将用一个简单的“ `WHERE @theValue = theValue`”进行翻译，在 T-SQL 中不进行空检查。

所以最后，它是否会在 SQL 中短路的问题在这种情况下是无关紧要的，因为 LINQ to SQL 运行时会发出不同的 T-SQL 查询，如果`fromname`为 null 与否。从某种意义上说，它是在查询数据库之前将客户端短路。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-21T12:14:15.013

你确定是'fromname'是空的，而不是'msg.FromName'是空的吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-21T12:16:46.520

就像布赖恩说的那样，我会在执行 ToLower().Contains(fromname.ToLower())) 之前查看 msg.FromName 是否为空

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-21T13:32:40.147

您是正确的，在使用短路比较器时不应评估第二个条件（请参阅[关于 C# 短路评估的最佳做法是什么？](https://stackoverflow.com/questions/361069/what-is-the-best-practice-concerning-c-short-circuit-evaluation)），但是我怀疑 Linq 可能会尝试优化您的在执行之前查询，这样做可能会改变执行顺序。

对我来说，将整个内容括在括号中也可以更清楚地说明，因为整个“where”条件都包含在括号中。

# c# - 这怎么可能不是一个常数值？

> ID：772263
> 
> 赞同：2
> 
> 时间：2009-04-21T12:12:12.273
> 
> 标签：c#, constants

我知道这可能只是术语不匹配，但如果我没记错的话，我相信 c# 是？除非我遗漏了一些明显的东西？？

```
...
    private const uint URL_COUNT = 18;
    private string[] _urls;

    public Redirector()
    {
        this._urls = new string[URL_COUNT];
        ...
    }
... 
```

导致“A constant value is expected”并在数组定义中加下划线 URL_COUNT??

如果它不是**const** -ant 值，那么 URL_COUNT 是什么？！？！

**编辑** 呸，我想了一秒钟然后我要疯了。我很高兴没有人能复制这个，因为这意味着它只是本地的事情。谢谢你们的帮助。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-21T12:29:09.127

当您同时提供维度长度和数组初始值设定项时，这只会编译失败。例如：

```
this._urls = new string[URL_COUNT]; 
```

会好的，但是：

```
this._urls = new string[URL_COUNT] { "One", "Two" }; 
```

将不会。后者需要一个常量*表达式*。请注意，const 变量不是常量表达式，只是一个常量值。从 C# 规范（3.0）第 12.6 节：

> 当数组创建表达式同时包含显式维度长度和数组初始值设定项时，长度必须是常量表达式，并且每个嵌套级别的元素数必须与相应的维度长度匹配。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-21T12:15:02.423

这是一个常数，应该可以正常工作。以下代码使用 C# 3 编译器为我编译得很好：

```
using System;

class Foo
{
    private const uint URL_COUNT = 18;
    private string[] _urls;

    public Foo()
    {
        this._urls = new string[URL_COUNT];
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-21T12:16:51.107

这也有效，编译器没有任何抱怨。

```
class Foo {
    private const uint URL_COUNT = 18;
    private readonly string[] _urls = new string[URL_COUNT];
} 
```

# atl - ＃包括 错误

> ID：772273
> 
> 赞同：0
> 
> 时间：2009-04-21T12:16:25.023
> 
> 标签：atl

我有一个 Visual Studio 项目编译失败并出现以下错误：“无法打开包含文件'atlrx.h'：没有这样的文件”。

有人告诉我应该从 Codeplex 下载 ATL 服务器并安装文件。我已经下载了 ATL Server，但我不知道如何继续。

谢谢您的帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-21T13:22:01.310

哎呀，

我只需要将包含文件复制到硬盘上的一个文件夹中，然后将 Visual Studio（工具|选项|VC++ 目录）设置为指向复制的文件夹。

# linq - LINQ 比调用存储过程慢吗？

> ID：772278
> 
> 赞同：1
> 
> 时间：2009-04-21T12:17:45.223
> 
> 标签：linq, stored-procedures

我希望我们将彻底检查我们的系统以使用 ASP.NET MVC，但是提供的所有示例都倾向于使用 LINQ to SQL。LINQ 开发人员告诉我们，它实际上比调用存储过程要慢。

此外，如何使用 MVC 调用存储过程进行输出？我不完全确定 LINQ 是否能满足我们的需求，因为我们的存储过程非常庞大且复杂。有什么想法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-21T12:25:34.783

实际上，您可以从 Linq 调用存储过程到 SQL。看看这个：[http](http://weblogs.asp.net/scottgu/archive/2007/08/16/linq-to-sql-part-6-retrieving-data-using-stored-procedures.aspx) ://weblogs.asp.net/scottgu/archive/2007/08/16/linq-to-sql-part-6-retrieving-data-using-stored-procedures.aspx 我会认为使用 Linq 并没有性能下降，因为它只是一种在 C#/VB.NET 中表达 sql 代码的方法。它将被翻译成普通的 sql。这是存储过程与普通查询的老斗争，Linq 并不是问题的一部分。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-21T12:26:29.883

是的，在某些边缘情况下它会更慢，在这些情况下，您可以从 L2S 调用存储过程。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T12:21:10.503

我相信 LINQ to SQL 已被弃用，而 LINQ to Entities 是可以使用的技术。

# c++ - 使用 Windows CreateFilemapping 时出错

> ID：772281
> 
> 赞同：-1
> 
> 时间：2009-04-21T12:18:45.987
> 
> 标签：c++, winapi, memory-mapped-files

在我的项目中，我实现了`CreateFileMapping`在两个进程之间共享内存的概念。我有一个服务器进程，我在其中存储会话数据的内存地址，其中包含有关特定图像的详细信息。我有一个客户端进程，我从缓冲区中读取该地址。现在的问题是地址显示在客户端进程中，但缺少一些细节。

这是我的服务器进程代码：

```
HANDLE hMem;
LPCSTR  pBuf;
#define BUF_SIZE 1024
static const char MemoryName[]="Share Memory Name";

hMem=CreateFileMapping(INVALID_HANDLE_VALUE,NULL, PAGE_READWRITE,0, BUF_SIZE, MemoryName);
pBuf = (LPCSTR) MapViewOfFile(hMem, FILE_MAP_ALL_ACCESS, 0, 0, BUF_SIZE);
CopyMemory((PVOID)pBuf, session, BUF_SIZE); 
LtEntity test = LtEntity(pBuf); 
```

这是我的客户端进程代码：

```
HANDLE hMem;
LPCSTR  pBuf;
#define BUF_SIZE 1024
static const char MemoryName[]="Share Memory Name";

hMem = OpenFileMapping(FILE_MAP_ALL_ACCESS, FALSE, MemoryName);  
pBuf = (LPCSTR) MapViewOfFile(hMem, FILE_MAP_ALL_ACCESS, 0, 0, BUF_SIZE);                   
LtEntity test = LtEntity(pBuf); 
```

在服务器进程中，变量“test”包含所有详细信息，但在客户端“test”中缺少一些数据。

下面的服务器测试变量显示了显示变量内容的附加图像。

下面的客户端测试变量显示了显示变量内容的附加图像。

请检查差异我需要在我的客户端进程中也可见的项目数据..

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T12:48:58.863

> 缺少一些细节

你可以再说一遍。的定义是`LtEntity`什么？

文件映射是否包含任何嵌入式指针？这些都行不通，因为共享内存在每个进程中不一定具有相同的虚拟地址。如果它们指向文件映射之外，它们将无法工作，即使共享内存恰好在每个进程中具有相同的虚拟地址。您应该存储文件映射开头的偏移量，而不是指针。

两个进程是否在同一个登录会话中运行？如果不是，则需要在文件映射的名称中添加[`Global\`前缀。](http://msdn.microsoft.com/en-us/library/aa366537(VS.85).aspx)

此外，您应该使用`INVALID_HANDLE_VALUE`，而不是`(HANDLE)0xFFFFFFFFF`。`INVALID_HANDLE_VALUE`添加 64 位 Windows 时更改的定义。

您可以使用`LtEntity test(pBuf);`而不是`LtEntity test = LtEntity(pBuf);`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T13:35:47.847

如果您在 LtEntity 中有指针，它将不起作用，因为每个进程中的映射内存块通常会从不同的地址开始。尝试使用 Boost::interprocess [offset pointers](http://www.boost.org/doc/libs/1_38_0/doc/html/interprocess/quick_guide.html#interprocess.quick_guide.qg_offset_ptr)，它存储相对地址。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T12:48:05.790

您可能也`LtEntity`有未序列化的指针/引用。

也许您可以提供更多关于`LtEntity`哪些数据丢失的信息。

# flash - 更改 MovieClip 宽度以及其中的动态文本字段大小

> ID：772282
> 
> 赞同：1
> 
> 时间：2009-04-21T12:18:54.253
> 
> 标签：flash, actionscript-3, actionscript, cs3

我是 Flash CS3 的新手。我想知道是否有人可以告诉我如何根据其中动态文本的大小调整影片剪辑的宽度。我通过创建文本字段“myText”然后将其转换为 MovieClip 符号并将 MovieClip 命名为 myClip 来做到这一点。myText 中的文本是在运行时分配的，其宽度会根据文本而变化。

我这样做如下： -

```
myClip.myText.selectable = false;
myClip.mouseChildren = false;
myClip.useHandCursor = true;
myClip.buttonMode  = true;
myClip.myText.width = myClip.myText.textWidth + 5; 
```

这样做时，我发现可点击区域会根据文本字段的大小而变化，但文本字段根本不会出现。任何帮助是极大的赞赏。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-21T19:51:50.640

您需要设置 myClip.myText.autoSize = TextFieldAutoSize.LEFT，否则文本字段不会随文本扩展。你不需要设置动画剪辑的宽度，它的大小取决于它的内容。设置大小只会拉伸内容（但对于文本字段，这仅在嵌入文本时有效）。

# vb.net - 从头开始创建企业 .Net 命名空间框架的最佳方法是什么？

> ID：772284
> 
> 赞同：0
> 
> 时间：2009-04-21T12:19:11.103
> 
> 标签：vb.net, generics, vb6, namespaces, vb6-migration

我们正在将我们的应用程序从 Classic VB 迁移到 VB.Net 2008，我需要创建一个基本命名空间和业务层。我的方法是访问我们的顶级 BA 并确定我们（固定收入）公司的共同领域，并尝试用尽可能多的泛型代码形成一个体面的继承模型。

每个人的经验是什么？作为问题的第二部分，我们正在考虑将 Web Focus 合并到 OLAP 端，这将如何影响公司名称空间及其衍生产品的设计？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-21T12:38:01.977

我认为开始创建企业 .NET 框架的最佳方式是从当前企业项目中获取现有代码开始。通过与 BA 交谈而不为特定的具体项目编写代码从头开始构建框架可能会导致您在某些领域过度设计框架，而在其他领域完全错过一些必要的功能（同样，它可能会对您的框架施加人为限制客户无缘无故）。

有关更完整的解释，请参阅 Fowler 在[Harvested Framework](http://martinfowler.com/bliki/HarvestedFramework.html)上的条目和此[博客文章。](http://www.peterprovost.org/blog/post/Harvesting-Frameworks-Instead-of-Building-Them.aspx)

我不熟悉 Web Focus，但我猜它会以某种方式影响它，但是，如果您使用 Harvested Framework，那么您在构建的前几个应用程序中对它的使用将影响您在其中使用 Web Focus 的方式框架。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T12:45:06.890

Jereme 在框架上是正确的。我将简要提到一些关于名称空间的明显内容。

永远记住命名空间的用途——它提供了一个名称将存在的“空间”。特别是，它旨在提供一个足够小的空间，以使在该空间内创建名称的人不太可能产生重复或混淆的名称。

这只有在命名空间按照组织模式或领域知识组织时才有效。一个经常使用的简单示例是*Company*的模式。*业务单元*。*申请*。该理论认为，在开发给定应用程序的一组开发人员中，名称重复的可能性较小。这不适用于大型应用程序，您可能希望根据层或区域进一步分解它。同样，业务单位太大，你会想把它分解。

但在所有情况下，您实际上是在尝试对大脑集进行分区，因为创建名称的是大脑。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T15:47:21.977

如果您的应用程序在 VB6（不是 VB3）下，那么我强烈建议您首先在 VB6 中重新设计类层次结构。这样做的原因是，在任何转换中，您都试图保留旧应用程序的行为。是延长项目时间来做这件事并同时进行重新设计。

通过首先在应用程序原始语言中进行设计更改，您可以确保任何导致的错误都是由于设计而不是转换造成的。

在过去的 20 年里，我对我们的软件进行了 3 次重大转换；（DOS 到 VB3）（VB3 到 VB6 中的面向对象设计）和（VB6 到 VB.NET）。

最后，直接在 VB6 中进行设计，即可轻松移植到 VB.NET。诀窍是将特定的 VB6 API 和结构隐藏在接口后面（图形、打印等）>

When do the conversion I recommend working from the top down. Change over your forms first to .NET which calls the VB6 COM DLLs. Then convert each layer over until you reach the bottom DLLs.

Again, if you try to change the design AND convert to another language for any complex application you will double the conversion time.

# c# - 从 AxHost 获取更多调试信息？

> ID：772293
> 
> 赞同：0
> 
> 时间：2009-04-21T12:21:46.540
> 
> 标签：c#, exception, activex, hresult, axhost

我正在尝试部署一个应用程序，该应用程序使用在 C# 中嵌入带有 AxHost 的 ActiveX 控件的库。

当我在我们的测试平台上运行已安装的应用程序时，我发现并显示以下异常：

```
Unexpected exception.

This application has failed to start because the application configuration is incorrect. Reinstalling the application may fix this problem. (Exception from HRESULT: 0x800736B1)
   at System.Windows.Forms.UnsafeNativeMethods.CoCreateInstance(Guid& clsid, Object punkOuter, Int32 context, Guid& iid)
   at System.Windows.Forms.AxHost.CreateWithoutLicense(Guid clsid)
   at System.Windows.Forms.AxHost.CreateWithLicense(String license, Guid clsid)
   at System.Windows.Forms.AxHost.CreateInstanceCore(Guid clsid)
   at System.Windows.Forms.AxHost.CreateInstance()
   at System.Windows.Forms.AxHost.GetOcxCreate()
   at System.Windows.Forms.AxHost.TransitionUpTo(Int32 state)
   at System.Windows.Forms.AxHost.CreateHandle()
   at System.Windows.Forms.Control.CreateControl(Boolean fIgnoreVisible)
   at System.Windows.Forms.Control.CreateControl(Boolean fIgnoreVisible)
   at System.Windows.Forms.AxHost.EndInit()
   at ....InitializeComponent()
   at ... 
```

我用谷歌搜索了 0x800736B1，所以我知道这意味着无法加载文件。

现在的大问题是如何找出无法加载的文件*。*

是否可以打开某种日志记录功能，或者是否有某种方法可以从异常中获取更多信息？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-21T12:27:13.907

除非它是您的 ActiveX 代码，否则这将很难或不可能。我建议使用像[ProcessMonitor](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)这样的工具来查找哪个文件句柄失败。如果你有代码，你可以在调试模式下运行它，或者改进它的日志记录。

当然你可以随时尝试

> 重新安装应用程序可能会解决此问题

# c# - 如何用新目录替换同名目录？

> ID：772296
> 
> 赞同：1
> 
> 时间：2009-04-21T12:22:25.103
> 
> 标签：c#, directory

我正在检查是否存在名称目录，那么它应该删除该目录并将其替换为新目录。为此我有这个代码：

```
if (Directory.Exists(b))
{
    Directory.Delete(b);
    Directory.CreateDirectory(b);
} 
```

其中 b 是我要检查的目录的名称。我收到目录不是空的运行时错误，我该怎么办？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-21T12:24:21.463

试试 Directory.Delete(b, true)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-21T12:24:22.743

如果目录不为空，则需要枚举所有文件并首先删除它们。

您还必须递归任何子文件夹。

或者只是打电话`Directory.Delete(folder, true)`当然！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-21T12:26:58.197

您必须调用`Directory.Delete(path, true)`以强制删除子目录和文件。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-21T12:27:46.417

通过将第二个布尔参数设置为 true 来删除子目录和文件：

```
 if (Directory.Exists(b))
{
    Directory.Delete(b, true);
    Directory.CreateDirectory(b);
} 
```

# iphone - 如何在 iPhone 上保存对特定照片的引用以便在没有选择器的情况下加载？

> ID：772300
> 
> 赞同：1
> 
> 时间：2009-04-21T12:23:06.600
> 
> 标签：iphone, save, photo

用户可以使用图像选择器从他们的库中选择一张照片 - 我想记住这个选择并在将来显示这张照片，而无需用户选择它。如何参考特定照片，或者有没有办法可以将照片复制到应用程序的存储中？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-21T13:41:54.663

您可以通过将所选图像转换为 NSData 对象来保存所选图像，然后将其写入应用程序文档目录下的 iphone 文件系统中，如下所示：

```
- (void)imagePickerController:(UIImagePickerController *)picker didFinishPickingImage:(UIImage *)image editingInfo:(NSDictionary *)editingInfo
{
NSData *imageData = UIImagePNGRepresentation(image);

NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);
NSString *documentsDirectory = [paths objectAtIndex:0];

NSString *filename = [documentsDirectory stringByAppendingPathComponent:@"SavedImage"];

[imageData writeToFile:filename atomically:NO];
} 
```

# user-interface - 区分设计器和运行时代码

> ID：772302
> 
> 赞同：0
> 
> 时间：2009-04-21T12:23:59.203
> 
> 标签：user-interface, qt4, pyqt4, gui-designer

我有两个相互交换消息的进程。进程 A 是一个普通（即非 qt）程序，它向进程 B 发送消息。进程 B 是一个 QT GUI 应用程序，将接收到的消息显示到一个文本框中。

我创建了一个自定义小部件（称为 ShowMessages），它继承自 QPlainTextEdit，并在计时器到期时从管道读取消息，并将它们附加到文本框中。代码并不是这样设计的（我认为这将是非常糟糕的设计），但这只是为了让事情变得简单。由于我不知道的原因，当我使用 qt-designer 创建表单时，进程 A 无法关闭。

问题是当我使用 qt 设计器时（因此选择 ShowMessages 小部件并将其放在窗口中），即使我在设计器中，小部件也开始显示消息。这个功能很酷，但问题是当我保存表单时，已经存在的消息保存在 .ui 文件中，这导致当我启动进程 B 时出现不良行为（因为进程开始显示我在创建阶段收到的消息） .

我可以在进程 B 启动后清理文本框，但我认为避免消息出现在 .ui 文件中要好得多。我想要的是能够为小部件编写这样的代码：

```
if <I'm not in the designer>
    timer = QtCore.QTimer(self)
    QtCore.QObject.connect(timer, QtCore.SIGNAL("timeout()"), self, QtCore.SLOT("on_timer()"));
    timer.start(2000) 
```

是否有 qt 函数可以知道我是否在设计器中？你认为区分设计器和运行时代码是“坏的”吗？

（抱歉有错误，但英语不是我的主要语言）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T17:52:53.390

也许您的小部件应该有一个标志，表明它是否“活动”并将其默认为 False，因此当您在设计器中时，它根本不会做任何事情。在代码中，当您想查看消息时，您可以将其设置为活动状态。然后，您还可以在其他情况下将其关闭。

但我不得不说，听起来您将“控制器”代码放入“视图”小部件中，这可能并且可能会给您带来麻烦（包括您现在遇到的当前 Qt 设计器问题）。

如果您还没有阅读过 MVC（模型-视图-控制器）设计模式，请考虑阅读。

**更新：**

公平地说，您的问题确实询问了如何检测您是否是设计师 :)

[http://doc.trolltech.com/4.3/designer-creating-custom-widgets.html#creating-well-behaved-widgets](http://doc.trolltech.com/4.3/designer-creating-custom-widgets.html#creating-well-behaved-widgets)

> 要在 Qt Designer 中为自定义小部件提供特殊行为，请提供 initialize() 函数的实现，以针对 Qt Designer 特定行为配置小部件构造过程。此函数将在任何调用 createWidget() 之前第一次调用，并且可能会设置一个内部标志，稍后当 Qt Designer 调用插件的 createWidget() 函数时可以对其进行测试。

根据文档，您基本上可以在小部件的 initialize() 函数中将“inDesignerFlag”设置为 true。然后在小部件代码中需要检测该标志。

# c# - Winforms 应用程序中使用的类库中的动态 Web 服务引用 (c#)

> ID：772305
> 
> 赞同：2
> 
> 时间：2009-04-21T12:24:43.990
> 
> 标签：c#, web-services

好的 - 非常基本的场景，以前有过，看起来很简单 - 但无法回忆起在这个特定的现有代码库中设置的不同之处。

Winforms App 调用 Dll，后者调用 Web Service。Dll 中对 Web 服务的引用是动态的。如何将 Web 服务的 URI 放入 Winforms app.config，以便我可以轻松更改它以进行测试、开发、实时等。

[哦，只是为了让它变得有趣，虽然我看不出这很重要，但我们已经自定义了 Web 服务的代理，因此不需要重新生成它......]

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T12:45:32.647

直接在代码中设置 URL。

```
YourServiceProxy service = new YourServiceProxy();
service.Url = ConfigurationManager.AppSettings["YourURLKey"]; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T12:41:37.350

您可以在代码中动态配置 Web 服务 URI 吗？这样，您可以轻松地修改服务以指向所需的位置。

您可以在代码中将 Web 服务的 Url 属性设置为指向 URI，并使用 Proxy 将代理设置为您的自定义代理。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T12:49:02.653

将 URL 从库的 app.config 复制到 Windows 窗体应用程序的 app.config 有什么问题？

另外，我强烈建议您永远不要修改生成的代码。您可以使用部分类对代理进行许多自定义。请参阅[自定义 ASMX 客户端代理的方法](http://johnwsaundersiii.spaces.live.com/blog/cns!600A2BE4A82EA0A6!435.entry)。

# regex - QTP/VBScript：如何从字符串中删除所有 URL？

> ID：772306
> 
> 赞同：1
> 
> 时间：2009-04-21T12:25:08.640
> 
> 标签：regex, vbscript, replace, qtp

我的 QTP 测试项目中有一个字符串。在某些情况下，该字符串是明文电子邮件的内容；在其他情况下，它是 HTML。在这两种情况下，我都需要从字符串中删除所有 URL 以将其与预期的情况相匹配。

这如何在 QTP/VBScript 中完成？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-28T10:00:09.437

这应该可以解决问题，尽管您的 URL 需要以 http:// 或 https:// 开头才能被拾取：

```
Dim text
text = "<your text with URLs here>"

Dim rgx
Set rgx = New RegExp
rgx.IgnoreCase = True
rgx.Global = True
rgx.Pattern = "([A-Za-z]{3,9})://([-;:&=\+\$,\w]+@{1})?([-A-Za-z0-9\.]+)+:?(\d+)?((/[-\+~%/\.\w]+)?\??([-\+=&;%@\.\w]+)?#?([\w]+)?)?"

Dim match, matches
Set matches = rgx.Execute(text)
For Each match in matches
  MsgBox match.Value, 0, "Found Match"
Next 
```

匹配 URL 的正则表达式模式来自[Chris Freyer 的博客](http://elearning.lse.ac.uk/blogs/clt/?p=285)，似乎可以处理您可能遇到的大多数类型的 URL。它在我用它进行的测试中运行良好。

# sql - 存储人类可读的 UUID 的最小方法是什么？

> ID：772325
> 
> 赞同：3
> 
> 时间：2009-04-21T12:28:36.930
> 
> 标签：sql, database, language-agnostic, guid, uuid

存储人类可读且广泛数据库兼容的 UUID 的最小方法是什么？

我正在考虑使用十六进制值的某种字符数组？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-21T12:33:38.807

作为常用方法，我认为将二进制数据（16 字节）编码为 Base64 可能是您想要的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-21T14:55:50.383

使用[Base-85](http://en.wikipedia.org/wiki/Base-85)编码将 UUID 存储为 20 个 US-ASCII 字符。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-21T12:31:11.790

您可能会发现最新的播客相关：

[http://itc.conversationsnetwork.org/shows/detail4087.html](http://itc.conversationsnetwork.org/shows/detail4087.html)

[SQL Server 中数据库范围内唯一但简单的标识符](https://stackoverflow.com/questions/721497/database-wide-unique-yet-simple-identifiers-in-sql-server)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-09-25T18:05:46.923

如果要使用任何类型的计算机表示，您需要 Base64。Base85，如果你能想办法把它放在 URL 中。请参阅：[http](http://en.wikipedia.org/wiki/Base64) ://en.wikipedia.org/wiki/Base64和[http://en.wikipedia.org/wiki/Ascii85](http://en.wikipedia.org/wiki/Ascii85)

# google-app-engine - AppEngine 中的用户创建列

> ID：772328
> 
> 赞同：1
> 
> 时间：2009-04-21T12:29:35.507
> 
> 标签：google-app-engine, google-cloud-datastore

假设您有一个名为

```
usercreated = db.ReferenceProperty(User) 
```

并且您希望此字段在首次放入存储时自动填充。就像 auto_date 一样。这可能吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-24T05:36:13.640

User 属性类型有一个`auto_current_user`标志，如果您使用 google 帐户进行身份验证，这是一个简单的解决方案。

[http://code.google.com/appengine/docs/python/datastore/typesandpropertyclasses.html#UserProperty](http://code.google.com/appengine/docs/python/datastore/typesandpropertyclasses.html#UserProperty)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T12:35:28.957

根据[文档](http://code.google.com/appengine/docs/python/datastore/propertyclass.html#Property_default_value)，您最好的选择是重新定义您正在使用的属性类，以覆盖 default_value() 方法。您也可以尝试打鸭，尽管这可能不是一个可行的选择。

# delphi - 在 TObject 的“创建”构造函数中使用继承

> ID：772336
> 
> 赞同：23
> 
> 时间：2009-04-21T12:31:43.740
> 
> 标签：delphi

我应该在从 TObject 或 TPersistent 派生的类的构造函数中调用“继承”吗？

```
constructor TMyObject.Create;
begin
 inherited Create;   // Delphi doc: Do not create instances of TPersistent. Use TPersistent as a base class when declaring objects that are not components, but that need to be saved to a stream or have their properties assigned to other objects.    
 VectorNames := TStringList.Create;
 Clear;
end; 
```

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-04-21T12:37:31.153

是的。它什么也没做，真的，但它是无害的。我认为在始终调用继承的构造函数时保持一致是有价值的，而无需检查实际上是否存在实现。有人会说调用继承的 Create 是值得的，因为 Embarcadero 将来可能会为 TObject.Create 添加一个实现，但我怀疑这是真的；它会破坏不调用继承创建的现有代码。不过，我认为仅出于一致性的原因调用它是一个好主意。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-21T12:46:00.553

我总是这样做。

如果您正在重构并将代码移动到一个共同的祖先，那么调用继承的 Create 具有以下优点：

1.  如果共同祖先有一个构造函数，你不能忘记调用它。
2.  如果共同祖先有一个带有不同参数的构造函数，编译器会为此发出警告。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-21T13:34:22.280

您还可以覆盖“procedure AfterConstruction”。这个过程总是被调用，不管什么样的构造函数。

```
public
  procedure AfterConstruction; override;
end;

procedure TfrmListBase.AfterConstruction;
begin
  inherited;
  //your stuff, always initialized, no matter what kind of constructor!
end; 
```

例如：如果您想使用不同于普通 TObject.Create 的构造函数创建对象，例如 TComponent.Create(AOwner) 或自定义（重载）构造函数，您可能会遇到问题，因为未调用您的覆盖并且（在在这种情况下）您的“VectorNames”变量将为零。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-21T20:48:46.930

我称之为它，除非我需要一个非常优化的构造函数。

# iphone - UISegmentedControl 中的徽章值

> ID：772339
> 
> 赞同：1
> 
> 时间：2009-04-21T12:31:53.630
> 
> 标签：iphone

在 UITabBar 类中，有一个名为 setBadgeValue 的属性，用于在项目的右上角显示一个带有红色椭圆环绕的文本。我需要在 UISegmentedControl 中显示一个像 badgeValue 这样的控件。UISegmentedControl 中没有类似 badgValue 的功能。请给我一些想法来做到这一点

提前致谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T12:42:16.553

您可以做的是创建一个 UIImageView 叠加层，其背景类似于badgeValue-look，并在其上添加一个标签以显示实际值。

您还可以尝试将 UITabBar 子类化，并使其看起来像某种 UISegmentedControl。[如果您想知道如何继承 UITabBar 并使其看起来不同，您可以查看一个名为Three20](http://github.com/joehewitt/three20/tree/master)的出色（开源）项目。

# asp.net - ASP.NET FileUpload 控件在向导控件中不起作用

> ID：772341
> 
> 赞同：1
> 
> 时间：2009-04-21T12:32:57.170
> 
> 标签：asp.net, .net-2.0

我有一个向导控件，其中一个页面包含 FileUpload 控件。我想在向导的最后一页访问文件流，但这似乎不起作用。

据我所知，您只能在使用控件后立即在回发中访问已发布文件的文件流。由于该文件最终将被放入数据库记录中，因此我可以在此时保存它，但如果可能的话，我宁愿避免这种情况。

有谁知道这个问题的解决方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-21T12:40:21.690

我自己没有使用过此控件，但由于它基于 HTML 标准 INPUT 控件，我认为您必须在处理该控件的回发时接收文件。

规避这一点的困难在于，当您从本地文件系统被有效地沙箱化时，如何从客户端系统中提取文件，因此需要上传控制。

我建议您将文件存储到您的 DB blob 中（或作为文件系统上的临时文件，可能需要一个唯一的文件名；我发现 GUID 工作得很好），然后使用 Session 对象将该引用保留到过程。我能想到的唯一其他不涉及主要工作的替代方法是将文件上传移动到向导的最后一页。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-21T12:46:25.967

您可以使用 CSS/jQuery 在客户端管理您的各个向导阶段的显示，而不是继续 POST 回服务器？这样，您唯一的 POST（导致上传）将在向导结束时。

# visual-studio - 如何在 Windows 中使用计时器

> ID：772343
> 
> 赞同：2
> 
> 时间：2009-04-21T12:33:20.677
> 
> 标签：visual-studio, visual-c++

可以使用 Windows API 设置计时器的各种方法是什么。每种方法的优缺点是什么？

我正在使用 MS DevStudio 的 C++。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-21T13:20:46.413

Windows 系统上有两个与定时器相关的函数：SetTimer 和 KillTimer（我知道，名字很奇怪 - CreateTimer 和 DestroyTimer 会更合理，就像在 CreateWindow 和 DestroyWindow 中一样，但这是可用的）。

SetTimer 可以在以下两种模式之一中运行：计时器事件可以触发用户定义的回调，或者可以将消息发布到窗口。这个函数的格式是：

```
timer_id = SetTimer (window, event_id, interval, callback); 
```

要使用回调：

```
timer_id = SetTimer (NULL, NULL, interval_in_milliseconds, callback); 
```

将 WM_TIMER 消息发送到窗口：

```
timer_id = SetTimer (window, event_id, interval_in_milliseconds, NULL); 
```

在这两种情况下，调用线程都需要有一个消息队列，因为两种变体都会发出 WM_TIMER 消息，默认处理程序调用回调函数。

根据您使用的操作系统，interval 的值具有上限和下限。有关详细信息，[请参阅 API 文档。](http://msdn.microsoft.com/en-us/library/ms644906.aspx)

如果您提供了窗口句柄，则要在完成后释放计时器，请执行以下操作：

```
KillTimer (window, event_id); // event_id is important! 
```

如果您使用了回调：

```
KillTimer (NULL, timer_id); 
```

单个窗口可以有许多与之关联的计时器，每个计时器使用不同的 event_id。重用 event_id 会停止计时器的第一个实例，而不发布 WM_TIMER 消息。

优点：相当容易使用。缺点：间隔结束和处理 WM_TIMER 消息之间的延迟，分辨率大，需要消息处理循环。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T13:40:56.320

处理计时器的另一种方法是使用可等待计时器对象。这些不需要任何消息处理，不使用 WM_TIMER 或回调。因此，它们有点复杂。了解 Windows 事件系统将很有帮助。

定时器对象分为三种类型：手动复位、同步和周期性；并且有四个函数用于处理计时器对象：CreateWaitableTimer、SetWaitableTimer、CancelWaitableTimer 和 CloseHandle（还有第五个函数，OpenWaitableTimer，但它对很多人不太有用）。还有一组函数需要通知计时器何时到期：WaitForSingleObject、MsgWaitForSingleObject、WaitForMultipleObjects 和 MsgWaitForMultipleObjects 是最有用的。

使用这些计时器的常用方法是：

```
CreateWaitableTimer (...)
SetWaitableTimer (...)
WaitForSingleObject (...)
CloseHandle (...) 
```

将此与 SetTimer 进行比较 - 了解计时器是否已过期的唯一方法是轮询它，无论是在循环中还是在无限超时的情况下（即暂停线程直到计时器结束）。

优点：非常灵活，不需要消息队列。缺点：难用

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T05:50:09.483

对于高分辨率计时器，请使用[queryperformancecounter](http://msdn.microsoft.com/en-us/library/ms644904(VS.85).aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T12:50:10.403

通常，查看您将要使用的 API，例如 MFC、Qt 或 GTK；他们都有计时器课程。

如果您不打算使用 GUI API，我个人喜欢 boost::timer (www.boost.org)

# c# - 嵌套静态类中不允许扩展方法？

> ID：772351
> 
> 赞同：9
> 
> 时间：2009-04-21T12:36:12.823
> 
> 标签：c#, extension-methods, nested-class

为什么是这样？我会发现能够将一些扩展方法锁定为仅在我的一个类中使用*真的很好。*真的不想让某些扩展方法随处可用......而且它们看起来比常规静态方法好得多：P

* * *

为了澄清：

我想要这些扩展方法的原因是因为我正在扩展一个表单，它上面有一个 DataGridView。我已经厌倦了这样的行：

```
foreach(var row in grid.Rows.OfType<DataGridViewRow>().Where(r => (bool) r.Cells[checkBoxColumn.Index].Value))

foreach(var row in grid.SelectedRows.OfType<DataGridViewRow>().Where(r => (bool) r.Cells[checkBoxColumn.Index].Value)) 
```

想要一个扩展方法，这样我就可以做到

```
foreach(var row in grid.Rows.CheckedRows())

foreach(var row in grid.SelectedRows.CheckedRows()) 
```

所以换句话说，这个扩展方法在这个类之外根本没有用。但它会使代码更干净。当然也可以制作常规方法，这就是我最终要做的，因为这是不可能的。

Aaanyways，我只是想知道是否有人有一些很好的论据来解释为什么他们选择对可以创建使用扩展方法的地方施加这样的限制。*必须在静态类*中是完全有意义的。*不能在嵌套的静态类*中不会......至少对我来说......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-21T12:51:04.083

如果您拥有该类型的源代码，为什么要使用扩展方法？为什么不让这些扩展方法成为类型本身的成员呢？

扩展方法最好用于扩展您未创建的类型。虽然它们是有用的工具，但它们是间接层，应该是最后的手段，而不是第一个手段。虽然您可以使用它们来扩展您自己的类型，但将它们用于您未创建的类型更有意义。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-21T12:43:07.037

如果您要扩展类型，那么扩展方法应该与类型本身一样可访问。

最佳实践还建议将所有扩展方法放在一个地方，最好放在一个静态类中或包含在单个命名空间中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-21T14:03:22.070

使用扩展方法真的会让你的代码比在你的类上使用标准的帮助方法*更干净吗？*

```
// extension method
foreach (var row in grid.Rows.CheckedRows())
foreach (var row in grid.SelectedRows.CheckedRows())

// standard helper method
foreach (var row in CheckedRows(grid.Rows))
foreach (var row in CheckedRows(grid.SelectedRows)) 
```

# .net - AppDomain.GetCurrentThreadID vs Thread.ManagedThreadID 用于 Windows API 调用？

> ID：772354
> 
> 赞同：15
> 
> 时间：2009-04-21T12:37:03.057
> 
> 标签：.net, vb.net, winapi

我正在尝试创建一个挂钩来监视鼠标光标的当前位置。没什么重要的，我只需要在界面设计期间计算一些像素，并想学习如何创建一个钩子，所以我决定走一条艰难的路，而不是理智的路。

我找到了声明以下函数的示例代码：

```
 <DllImport("User32.dll", CharSet:=CharSet.Auto, _
 CallingConvention:=CallingConvention.StdCall)> _
 Public Overloads Shared Function SetWindowsHookEx _
      (ByVal idHook As Integer, ByVal HookProc As CallBack, _
       ByVal hInstance As IntPtr, ByVal wParam As Integer) As Integer
End Function 
```

调用该函数时，使用以下代码：

```
 hHook = SetWindowsHookEx(WH_MOUSE, _
                                 hookproc, _
                                 IntPtr.Zero, _
                                 AppDomain.GetCurrentThreadId()) 
```

但是 Appdomain.GetCurrentThreadID 会生成警告：“'Public Shared Function GetCurrentThreadId() As Integer' 已过时：'AppDomain.GetCurrentThreadId 已被弃用，因为当托管线程在纤程（又名轻量级线程）上运行时，它不提供稳定的 Id。要获得托管线程的稳定标识符，请使用 Thread 上的 ManagedThreadId 属性。”

我尝试过使用 ManagedThreadID，但这不起作用。返回的线程 ID 似乎是线程的逻辑线程 ID，因为它在 .net 运行时中运行，而不是 Win32 线程标识符。

使用 AppDomain.GetCurrentThreadID 调用该函数是可行的，但我真的很想为我的线程提供一个“稳定标识符”。

有人可以向我解释是否可以在这种情况下使用 ManagedThreadID（我假设不是），如果没有，我需要避免的事情是为了阻止 AppDomain.CurrentThreadID 变得“不稳定”？

干杯

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-21T13:49:16.067

在此上下文中无法使用 ManagedThreadId。这是一个完全托管的概念，在原生世界中没有真正的代表。因此，它对您传递给它的 API 没有任何意义。

ManagedThreadId 存在的原因是本机线程和托管线程之间不一定存在 1-1 映射。只要本机线程与其要替换的线程兼容，CLR 就可以自由地使用多个本机线程来运行单个托管线程。例如，它不能在不同的 COM 公寓中。

在某些方面，你有点卡在这里。AFAIK，没有办法 100% 保证对于给定的托管线程，您将拥有相同的本机线程。例如，如果您正在运行 WinForms 或 WPF 应用程序并且对本机代码的调用发生在 UI 线程上，则您可以获得非常高水平的保证。原因是这两个 UI 框架都存在于 STA 公寓中，这使得 CLR 很难（如果可能的话）从您的下方切换出来。

简短版本：如果您在 WinForms 或 WPF 应用程序中并在 UI 线程上运行它，您可以假设此标识符具有合理的稳定性水平。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-05-20T12:58:49.990

你可以使用：

```
using System.Diagnostics;
Process.GetCurrentProcess().Threads[0].Id 
```

代替

`AppDomain.GetCurrentThreadId()`

如果您的线程数多于正在运行的主线程 0，那么问题只是要找到正确的线程数。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-02-15T16:48:49.940

```
var thread = Process.GetCurrentProcess().Threads.OfType<ProcessThread>().
    SingleOrDefault(x => x.ThreadState == ThreadState.Running);

if (thread != null)
{
    // do stuff here
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-02-13T13:10:22.953

对于未来的读者：还有 System.Threading.Thread.BeginThreadAffinity() / EndThreadAffinity() 据称可以阻止 VM 在不同物理线程之间切换的函数。我不相信这些保证稳定性，但我认为它们更有可能是稳定的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-11-06T17:47:54.483

利用：

[DllImport("kernel32.dll")] static extern uint GetCurrentThreadId();

# inheritance - 如何从 std::ostream 继承？

> ID：772355
> 
> 赞同：42
> 
> 时间：2009-04-21T12:37:10.887
> 
> 标签：inheritance, stl, ostream

我一直在谷歌搜索，但我找不到一个简单的答案。它应该很简单，就像 STL 通常一样。

我想定义从 std::ostream 公开继承的 MyOStream。假设每次将某些内容写入我的流时，我都想调用 foo() 。

```
class MyOStream : public ostream {
public:
  ...
private:
   void foo() { ... }
} 
```

我知道ostream的公共接口是非虚拟的，那怎么办呢？我希望客户能够在 MyOStream 上同时使用 operator<< 和 write() 和 put() 并使用我的课程的扩展能力。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2013-11-12T15:21:04.120

我一直在思考如何做同样的事情，我发现这实际上并不难。基本上只是子类化 ostream 和 streambuf 对象，并以自身作为缓冲区构造 ostream。对于发送到流的每个字符，都会调用 std::streambuf 的虚拟溢出（）。为了适合你的例子，我只是做了一个 foo() 函数并调用它。

```
#include <iostream>

struct Bar :  private std::streambuf , public std::ostream
{
    Bar() : std::ostream(this) {}

private:
    int overflow(int c) override
    {
        foo(c);
        return 0;
    }

    void foo(char c)
    {
        std::cout.put(c);

    }
};

int main()
{
    Bar b;
    b<<"Look a number: "<<std::hex<<29<<std::endl;

    return 0;
} 
```

**编辑：**旧代码使用了错误的初始化顺序。尽管它没有可见的副作用，但应该在将 streambuf 对象传递给 ostream 对象之前对其进行初始化。由于 C++ 从左到右初始化父母，我将 std::streambuf 移到左侧以使代码正确。

**编辑：**我将代码更改为私下继承 std::streambuf 以保持接口清洁并保持类封装。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-04-21T12:49:04.573

不幸的是，这不是一个简单的问题。您应该派生的类是`basic_`类，例如`basic_ostream`. 但是，从流派生可能不是您想要的，您可能希望从流缓冲区派生，然后使用此类实例化现有的流类。

整个领域都很复杂，但是有一本关于它的优秀书籍[Standard C++ IOStreams and Locales](http://www.angelikalanger.com/iostreams.html)，我建议你在继续阅读之前先看看。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2011-05-11T15:20:18.187

实现类似效果的另一个工作技巧是使用模板和合成

```
class LoggedStream {
public:
  LoggedStream(ostream& _out):out(_out){}
  template<typename T>
  const LoggedStream& operator<<(const T& v) const {log();out << v;return *this;}
protected:
  virtual void log() = 0;
  ostream& out;
};

class Logger : LoggedStream {
  void log() { std::cerr << "Printing" << std::endl;}
};

int main(int,char**) {LoggedStream(std::cout) << "log" << "Three" << "times";} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2010-04-26T10:27:40.667

我不知道这是否是正确的解决方案，但我以这种方式从 std::ostream 继承。它使用从 std::basic_streambuf 继承的缓冲区，一次获取 64 个字符（如果刷新则更少），并将它们发送到一个通用的 putChars() 方法，在该方法中完成数据的实际处理。它还演示了如何提供用户数据。

[现场示例](http://ideone.com/AFzNdO)

```
#include <streambuf>
#include <ostream>
#include <iostream>

//#define DEBUG

class MyData
{
    //example data class, not used
};

class MyBuffer : public std::basic_streambuf<char, std::char_traits<char> >
{

public:

    inline MyBuffer(MyData data) :
    data(data)
    {
        setp(buf, buf + BUF_SIZE);
    }

protected:

    // This is called when buffer becomes full. If
    // buffer is not used, then this is called every
    // time when characters are put to stream.
    inline virtual int overflow(int c = Traits::eof())
    {
#ifdef DEBUG
        std::cout << "(over)";
#endif
        // Handle output
        putChars(pbase(), pptr());
        if (c != Traits::eof()) {
            char c2 = c;
            // Handle the one character that didn't fit to buffer
            putChars(&c2, &c2 + 1);
        }
        // This tells that buffer is empty again
        setp(buf, buf + BUF_SIZE);

        return c;
    }

    // This function is called when stream is flushed,
    // for example when std::endl is put to stream.
    inline virtual int sync(void)
    {
        // Handle output
        putChars(pbase(), pptr());
        // This tells that buffer is empty again
        setp(buf, buf + BUF_SIZE);
        return 0;
    }

private:

    // For EOF detection
    typedef std::char_traits<char> Traits;

    // Work in buffer mode. It is also possible to work without buffer.
    static const size_t BUF_SIZE = 64;
    char buf[BUF_SIZE];

    // This is the example userdata
    MyData data;

    // In this function, the characters are parsed.
    inline void putChars(const char* begin, const char* end){
#ifdef DEBUG
        std::cout << "(putChars(" << static_cast<const void*>(begin) <<
            "," << static_cast<const void*>(end) << "))";
#endif
        //just print to stdout for now
        for (const char* c = begin; c < end; c++){
            std::cout << *c;
        }
    }

};

class MyOStream : public std::basic_ostream< char, std::char_traits< char > >
{

public:

    inline MyOStream(MyData data) :
    std::basic_ostream< char, std::char_traits< char > >(&buf),
    buf(data)
    {
    }

private:

    MyBuffer buf;

};

int main(void)
{
    MyData data;
    MyOStream o(data);

    for (int i = 0; i < 8; i++)
        o << "hello world! ";

    o << std::endl;

    return 0;
} 
```

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-04-21T12:44:47.000

组合，而不是继承。您的类包含“包装”一个 ostream&，并转发给它（在调用 foo() 之后）。

# networking - 客户端-服务器通信

> ID：772362
> 
> 赞同：0
> 
> 时间：2009-04-21T12:38:35.347
> 
> 标签：networking

我们编写了一个客户端-服务器程序。当我们通过调用在不同终端上的同一台机器上运行客户端和服务器时，程序运行良好`gethostbyname(127.0.0.1)`。我们必须在不同的机器之间进行通信。所以我的问题是，如何确定另一台机器（服务器）的IP，以及如何找出自己机器的IP。它只是被选择为我们想要的东西吗？如何获取服务器的主机名和自己的机器？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-21T12:45:35.547

目前尚不清楚您在哪个平台上运行，但对于 Unix/Linux，您可以使用 ifconfig 命令发现分配给系统接口的 IP 地址（您可能需要是 root 才能访问它，它通常在 sbin 文件夹中找到)，在 Windows 上 ipconfig 将为您提供相同的信息。

理想情况下，您应该在网络上设置域名解析，并为服务器设置一个“名称”，即 server.mydomain.com，然后您可以使用 gethostbyname("server.mydomain.com")。有关域名服务 (dns) 的更多信息，您可能会比从这里开始做得更糟：[http ://en.wikipedia.org/wiki/Domain_name_system](http://en.wikipedia.org/wiki/Domain_name_system)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T12:46:35.887

您无法以某种神奇的方式获取另一台机器的 IP；你要么必须知道它，要么在你的网络应用程序中开发某种广播协议，服务器或客户端在其中广播他们的 IP。

获得自己的 IP 取决于您的平台和使用的语言。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-23T06:50:40.690

如果这是一个客户端/服务器环境，那么客户端将需要知道服务器地址。

如果您使用 gethostbyname，那么实际支持的名称解析系统（DNS、NIS 等）将因操作系统和系统配置而异。

最常见的配置是使用 DNS。在这种情况下，值得注意的是，服务器不能轻易地在网络上发现自己的名称（或名称本身）。这是因为客户端将使用的命名服务在服务器之外。服务器对其主机名和解析器的默认域有一个本地概念，但它们不一定是 DNS 从外部映射到服务器 IP 地址的 FQDN。

# apache-flex - 将 flex 模块与 ant 中的其他 mxml 文件一起编译成 swf

> ID：772368
> 
> 赞同：0
> 
> 时间：2009-04-21T12:39:38.823
> 
> 标签：apache-flex, ant, module, mxml

我有一个包含许多 mxml 和文件的大型项目，并且正在尝试使用 ant 将它们全部编译成一个工作 swf 文件。但是，我无法在 ant 中正确编译 main.swf。

它似乎没有引入必要的模块，所有这些模块都位于主 src 文件夹中的单独文件夹中。

它将编译没有错误，但是当我打开 swf 文件时，没有内容——只是一个外壳。但是，如果我使用 flex builder 3 的编译按钮进行编译，它将正确地创建 swf——内容和所有内容。

即使使用简单的 mxmlc 命令，它也会为与模块关联的任何文件引发错误，说明存在未知类型（意味着它没有拉入模块）。

尝试使用 ant 将模块编译成 main.swf 文件时，是否有一种特殊的处理方式？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T12:46:31.177

您是否在 Ant 构建文件中包含了一个`library-path`元素？

例如

```
<target ...>
    <mxmlc output="...../file.swf"
        ....
        file=".../main.mxml">

        <library-path dir="..../" append="true">
            <include name="...../someModule.swc"/> 
```

# php - 哪个是正确的形式？

> ID：772369
> 
> 赞同：0
> 
> 时间：2009-04-21T12:39:47.777
> 
> 标签：php

php。

```
$a['0']=1;
$a[0]=2; 
```

哪个是正确的形式？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-21T12:42:51.217

在第一个示例中，您使用一个字符串来索引数组，该数组将是一个“幕后”的哈希表，速度较慢。要访问该值，从字符串中计算“数字”以定位您存储的值。这个计算需要时间。

第二个示例是基于数字的数组，速度更快。使用数字的数组将根据该数字索引数组。0 是索引 0；1 是索引 1。这是访问数组的一种非常有效的方式。不需要复杂的计算。索引只是从数组开头的偏移量以访问该值。

如果你只使用数字，那么你应该使用数字，而不是字符串。这不是形式的问题，而是 PHP 将如何优化您的代码的问题。数字更快。

然而，在处理小尺寸时速度差异可以忽略不计（存储少于 <10,000 个元素的数组；感谢 Paolo；）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-21T13:13:27.993

The "funny" thing is, you will get exactly the same result. PHP (for whatever reason) tests whether a string used as array index contains only digits. If it does the string is converted to int or double.

```
<?php
$x=array(); $x['0'] = 'foo';
var_dump($x);

$x=array(); $x[0] = 'foo';
var_dump($x);
```

For both arrays you get [0] => foo, not ["0"] => foo.

Or another test:

```
<?php
$x = array();
$x[0] = 'a';
$x['1'] = 'b';
$x['01'] = 'c';
$x['foo'] = 'd';foreach( $x as $k=>$v ) {
  echo $k, ' ', gettype($k), "\n";
}
```

```
0 integer
1 integer
01 string
foo string
```

If you still don't believe it take a look at #define HANDLE_NUMERIC(key, length, func) in zend_hash.h and when and where it is used.

You think that's weird? Pick a number and get in line...

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-21T12:41:35.947

首先你会有一个数组项： Key: 0 Index: 0

在第二个示例中，您只有一个索引集。索引：0

```
$arr = array();
$arr['Hello'] = 'World';   
$arr['YoYo']  = 'Whazzap'; 
$arr[2]       = 'No key';  // Index 2 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-21T12:51:40.773

如果您打算增加密钥，请使用第二个选项。第一个是一个关联数组，其中包含字符串“0”作为键。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-21T23:52:30.077

正如其他人所指出的，它们都是“正确的”，但具有不同的副作用。

我要指出的另一件事是，如果您只是将项目推送到数组中，您可能更喜欢这种语法：

$a = 数组（）；$a[] = 1; $a[] = 2; // 现在 $a[0] 是 1 而 $a[1] 是 2。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-21T12:45:08.543

他们都很好，他们都会工作。

不同之处在于，在第一个示例中，您将值 1 设置为名为“0”的键，在第二个示例中，您将值 2 设置为数组中的第一个元素。

不要不小心把它们弄混了；）

# ruby-on-rails - 在 Rails 中访问子表的子表

> ID：772376
> 
> 赞同：0
> 
> 时间：2009-04-21T12:41:40.893
> 
> 标签：ruby-on-rails, ruby, activerecord

在我正在编写的应用程序中，我的数据库有一个“树状”结构，以便：

```
training has_many class_times 
```

和

```
class_time has_many reservations 
```

有没有办法在给定的培训下查找所有预订？当然，我可以遍历所有上课时间/添加外键，但由于某种原因，我脑后有个小声音说我可能不需要外键。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-21T13:01:45.807

```
class Training < ActiveRecord::Base
  has_many :class_times
  has_many :reservations, :through => :class_times
end

class ClassTime < ActiveRecord::Base
  has_many :reservations
end 
```

那么你可以这样做：

```
training = Training.find(:first)
training.reservations 
```

# nhibernate - nhibernate 和 DDD 建议

> ID：772377
> 
> 赞同：0
> 
> 时间：2009-04-21T12:41:47.443
> 
> 标签：nhibernate, domain-driven-design

我对 nHibernate 和 DDD 还很陌生，所以请多多包涵。

我需要从我的 SQL 表中创建一个新报告。该报表是只读的，将绑定到 ASP.NET 应用程序中的 GridView 控件。

该报告包含以下字段样式、颜色、尺寸、LAQty、MTLQty、状态。

我有样式、颜色和大小的实体，我在其他 asp.net 页面中使用它们。我通过存储库使用它们。我不确定是否应该在我的报告中使用相同的实体。如果我使用它们，我应该在哪里映射 Qty 和 Status 字段？

如果我不应该使用相同的实体，我应该为报告创建一个新类吗？

如前所述，我对此并不陌生，只是尝试正确学习和编码。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-21T13:05:49.243

对于报告，通常更容易使用纯值或特殊 DTO。当然，您可以查询引用所有信息的实体，但要将其放入列表中（例如，使用数据绑定），拥有一个包含所有纯值值的单个类会更方便。

要获得以下几个更具体的解决方案，您需要告诉我们一些有关您的域模型的信息。类模型是什么样的？

通常，您至少有三个选项可以使用 NHibernate 从数据库中获取“普通”值。

**编写返回值数组的 HQL**

例如：

```
select e1.Style, e1.Color, e1.Size, e2.LAQty, e2.MTLQty 
from entity1 inner join entity2
where (some condition) 
```

结果将是对象 [] 的列表。列表中的每一项都是一行，object[] 中的每一项都是一列。这很像 sql，但在更高级别（您在实体级别描述查询）并且独立于数据库。

**或者您创建一个 DTO（数据传输对象）仅用于保存一行结果：**

```
select new ReportDto(e1.Style, e1.Color, e1.Size, e2.LAQty, e2.MTLQty)
from entity1 inner join entity2
where (some condition) 
```

ReportD 需要实现一个具有所有这些参数的构造函数。结果是 ReportDto 的列表。

**或者你使用 CriteriaAPI（推荐）**

```
session.CreateCriteria(typeof(Entity1), "e1")
  .CreateCriteria(typeof(Entity2), "e2")
  .Add( /* some condition */ )
  .Add(Projections.Property("e1.Style", "Style"))
  .Add(Projections.Property("e1.Color", "Color"))
  .Add(Projections.Property("e1.Size", "Size"))
  .Add(Projections.Property("e2.LAQty", "LAQty"))
  .Add(Projections.Property("e2.MTLQty", "MTLQty"))
  .SetResultTransformer(AliasToBean(typeof(ReportDto)))
  .List<ReportDto>(); 
```

ReportDto 需要具有每个别名“Style”、“Color”等名称的属性。输出是 ReportDto 的列表。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T13:08:12.327

我没有完全接受 DDD 的教育，但我总是将我的名词建模为类型，我很惊讶报告本身就是一个实体。不管是否是 DDD，我都不会这样做，而是让我的报告反映查询的结果，其中数量大概是 count(*) 或 sum(lineItem.quantity) 并且还计算了状态（也许，在这页纸）。

您还没有描述您的域，但是在这些列标题上有一个线索，您可能正在对数据进行透视以创建 LAQty、MTLQty，您会发现在 nHibernate 中很难做到这一点，因为它是为 OLTP 设计的，并且没有甚至我上次检查过 UNION。也就是说，滥用 HQL（Hibernate 查询语言）来进行轻量级报告并没有错，只要您知道自己在滥用它。

我看到 Stefan 在描述语法方面做得很出色，所以我会停在那里 :-)

# .net - 如何设计独立于提供者的 DAL

> ID：772381
> 
> 赞同：1
> 
> 时间：2009-04-21T12:42:46.663
> 
> 标签：.net, data-access-layer, query-builder, provider-independent

我目前正在开发一个查询构建器应用程序，基本上是一个简单的图形界面，它应该允许不了解 SQL 的用户在数据库上定义各种查询（连接、SELECT、INSERT、UPDATE、DELETE）。我将使用 .NET 3.5。我的应用程序应该支持多个数据库，它应该与 MS-SQL Server、MySQL 和 Oracle 一起使用，所以我希望能提供任何提示或链接到有关**如何设计独立于提供程序的 DAL 的**相关讲座。

用户将选择一个数据库服务器，当前服务器上的一个数据库，提供连接凭据，选择各种表，定义查询（使用一系列组合框），如果查询有效，则最终执行查询。当然，在 DAL 中，我确实希望为每个数据库提供程序提供方法。我正在考虑工厂模式的一些内容。

注意：这是一个简单的学校项目，所以我对结果查询的安全性或性能不感兴趣。

**更新：**经过更多研究和您提供的非常有价值的输入，我决定使用`DbProviderFactory`. ORM 会很有趣，但是因为我只想要一个查询分析器/构建器，所以我看不出使用它的意义。因此，如果您能向我指出有关如何使用`DbProviderFactory`和相关类的详细教程，我将不胜感激。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-21T13:00:30.003

我建议使用`System.Data.Common.DbProviderFactories`该类来生成通用 ADO.NET 类。

当您找到更多要支持的数据库的 .NET 提供程序时，只需将提供程序 DLL 拖放到应用程序的路径中，然后`DbProviderFactory`在`app.config`文件中添加对提供程序的引用即可。您可以让用户选择要使用的提供程序。

这是一篇关于[获取一个`DbProviderFactory`(ADO.NET)主题的 MSDN 文章](http://msdn.microsoft.com/en-us/library/dd0w4a2z.aspx)

我以前使用过这种方法，并且能够在同一个项目中支持 MSSQL 和 SQLite，只需进行较小的配置更改。

不确定，但它是否适用于查询构建器应用程序......</p>

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T12:47:25.293

您可能会感到惊讶，但可以使用普通的旧版本**`DataSet`**和**`DataTable`**.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-21T12:50:48.157

我必须说，在视觉上编辑一个相当复杂的查询*非常*麻烦。并且允许用户使用可视化设计器插入/删除数据是一种自取其辱的方式。精简版的 Management Studio、基本 SQL 知识加上受限服务器用户会做得更好。

如果您仍然倾向于设计这个应用程序，那么您将需要 NHibernate。更准确地说，[条件查询](http://www.hibernate.org/hib_docs/nhibernate/html/querycriteria.html)将完成这项工作，因为它们映射的非常接近您的需要。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T12:46:48.103

我认为 ADO.NET Entity Framework（从 .NET 3.5 SP1 开始可用）是一个很好的选择，因为它几乎用它的实体 SQL 语言抽象了依赖于数据库的 SQL。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-21T12:51:21.900

大多数 ORM（对象关系映射器）都知道如何与各种数据库类型通信。

至于允许用户构建自己的查询：您需要非常小心。用户可能会创建恶意查询（尽管这可能是一个问题）并不是因为它是偶然的。编写一个使用所有可用服务器资源并为您的数据库创建有效拒绝服务的查询非常容易。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-21T15:26:55.893

我不确定这是否有助于您的任务，但我最近学到并牢记的一件事是让您的数据模型的唯一标识符实现不直接传播到数据层之外，而是包装在抽象中。例如，这是一个包装模型标识符的接口：

```
public interface IModelIdentifier<T> where T : class 
{
    /// <summary>
    /// A string representation of the domain the model originated from.
    /// </summary>
    string Origin { get; }

    /// <summary>
    /// The model instance identifier for the model object that this 
    /// <see cref="IModelIdentifier{T}"/> refers to.  Typically, this 
    /// is a database key, file name, or some other unique identifier.
    /// <typeparam name="KeyDataType">The expected data type of the 
    /// identifier.</typeparam>
    /// </summary>
    KeyDataType GetKey<KeyDataType>();

    /// <summary>
    /// Performs an equality check on the two model identifiers and 
    /// returns <c>true</c> if they are equal; otherwise <c>false</c> 
    /// is returned.  All implementations must also override the equal operator.
    /// </summary>
    /// <param name="obj">The identifier to compare against.</param>
    /// <returns><c>true</c> if the identifiers are equal; otherwise 
    /// <c>false</c> is returned.</returns>
    bool Equals(IModelIdentifier<T> obj);
} 
```

您的业​​务逻辑层过去可能将`int`s 作为唯一标识符传递（例如，来自数据库表中的标识列），现在这样传递：

```
 public IPerson RetrievePerson(IModelIdentifier<IPerson> personId)
    {
        /// Retrieval logic here...
    } 
```

然后，您的数据层将有一个类，`IModelIdentifier<Person>`该类使用物理模型的唯一标识符实现并填充其内部数据类型。这将您的业务层与您在数据层可能进行的任何更改隔离开来，例如`int`用 s 替换您的密钥标识符`Guid`。

# java - 将关系数据库表关联到 Java 类的最佳方法是什么？

> ID：772382
> 
> 赞同：2
> 
> 时间：2009-04-21T12:42:48.283
> 
> 标签：java, database, class, relational

我想知道是否有人可以在这里给我建议；我有一个应用程序，它有这样的类：

代码：

```
public class Order implements Serializable { 
    private int orderNo; 
    private int customerNo;    
    private date orderDate; 

    public int getOrderNo () { 
        return orderNo; 
    } 

    public int getCustomerNo () { 
        return customerNo; 
    } 

    public date getOrderDate () { 
        return orderDate; 
    } 

    // And so on with set methods. 

} 

public class OrderLine implements Serializable { 
    private int orderNo; 
    private int lineNo;    
    private int qty; 
    private int prodID; 

    // Get and set methods for each of the above. 
    public int getOrderNo () { 
        return orderNo; 
    } 

    public int getLineNo () { 
        return lineNo; 
    } 

    public int getQty () { 
        return qty; 
    } 

    public int prodID () { 
        return prodID; 
    } 
    // And so on with set methods. 
} 
```

这直接转化为关系表：

Order: orderno, customerNo, orderDate OrderLine: orderno, lineNo, qty, prodID

因此，每个类都直接转换为一个数据库表，其中每个属性都有 get 和 set 对。

现在我想知道的是，如果在 Java Web 应用程序中，这些类应该像上面那样还是更像这样，其中获取返回对象：

代码：

```
public class Order implements Serializable { 
    private int orderNo; 
    private Customer;    
    private date orderDate; 
    private ArrayList<OrderLine>lineItems; 

    public int getOrderNo () { 
        return orderNo; 
    } 

    public Customer getCustomer () { 
        return Customer; 
    } 

    public date getOrderDate () { 
        return orderDate; 
    } 

    public ArrayList<OrderLine> getOrderLines () { 
        return lineItems; 
    } 

    public OrderLine[] getOrderLines () { 
        return lineItems; 
    } 
    // And so on with set methods.     
} 

public class OrderLine implements Serializable { 
    private int orderNo; 
    private int lineNo;    
    private int qty; 
    private Product; 

    // Get and set methods for each of the above. 

    public int getOrderNo () { 
        return orderNo; 
    } 

    public int getLineNo () { 
        return lineNo; 
    } 

    public int getQty () { 
        return qty; 
    } 

    public int getProduct () { 
        return Product; 
    } 
} 
```

哪种方法更好？或者，只要处理数据的类正确执行并且系统高效运行，采用哪种方法真的很重要吗？

谢谢

摩根先生

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-21T12:52:48.290

绝对没有理由使用第一种形式 - 在 Java 代码中使用它会更加困难，并且会因此产生很多错误。

所有体面的 O/R 映射器（Hibernate 是最流行的映射器）都可以毫无问题地从 DB 模式转换为适当的 OO 对象图。

然而，不利的一面是，为您完成所有这些操作可能会导致[非常糟糕的性能](http://www.pbell.com/index.cfm/2006/9/17/Understanding-the-n1-query-problem)，当您将所有内容留给 OR 映射器并且它从数据库中获取太多或太少的数据时，您必须注意缓存以及是否您的收藏是[惰性或急切的加载](http://powerdream5.wordpress.com/2007/11/09/eager-loading-in-hibernate/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-26T14:59:42.177

我还鼓励您查看像 Hibernate 这样的对象关系映射工具，或者像 iBatis 这样的更简单的 SQL 映射工具。（我对 iBatis 有过很好的体验。）

关于对 Order 及其 OrderLine 之间的主从关系建模的问题，在 Java 对象级别，它们当然是相同概念层次结构的一部分，因此我会选择将它们建模为包含 List 的 Order 对象。这样我就可以在我的代码周围传递完整的订单，而不必担心丢失部分订单。

如果你使用像 iBatis 这样的 SQL 映射器，你需要在数据库中设置一个 Order 表和一个 OrderLine 表，然后给 iBatis 一个 XML 映射，告诉它如何通过加入两个 SQL 表放在一起。ORM 反向操作，根据您的 Java 数据模型生成 SQL 表。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-21T12:53:20.413

如果您的业务对象像这样干净，我建议您查看 ORM 映射器，例如 Hibernate 或 ActiveObjects。

如果您更愿意构建自己的数据访问层，我建议使这些类尽可能轻量级。例如在 中`Order`，我将有一个`CustomerID`表示外键的整数字段，而不是在业务类中`getCustomer()`返回一个`Customer`对象。`Order`

诸如此类的获取方法可能会更好地放置在包含您的数据访问功能`getCustomer()`的不同类中，例如etc。`CustomerDAO`

从效率的角度来看，您使用哪种方法并不重要，但是拥有松散耦合的对象始终是一种好习惯。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-21T12:54:11.580

您应该查看一些对象关系映射 (ORM) 映射工具，例如[Hibernate](http://www.hibernate.org/)或[TopLink](http://www.oracle.com/technology/products/ias/toplink/index.html)，或者可能是更简单的查询映射工具，例如[iBatis](http://ibatis.apache.org/)。

如果你沿着 ORM 路线走，我认为你最终会得到更像你的第二个建议的东西。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-21T12:54:30.050

常见的方法是使用对象关系映射库 (ORM)。常见的有：

*   [休眠](http://www.hibernate.org/)
*   [EclipseLink （基于](http://www.eclipse.org/eclipselink/)[TopLink](http://www.oracle.com/technology/products/ias/toplink/index.html)的开源部分）
*   [OpenJPA](http://openjpa.apache.org/)

所有这些都是开源库并实现了 JPA（Java Persistence Architecture）标准。

# java - 如何查看 eclipse 使用的 Ant 脚本？

> ID：772386
> 
> 赞同：1
> 
> 时间：2009-04-21T12:43:26.270
> 
> 标签：java, eclipse, ant

我在使用 Ant 构建我的项目时遇到了一些麻烦。我想看看 Eclipse 用来构建我的项目的 Ant 脚本。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-21T12:59:56.247

我不认为eclipse默认使用ant脚本来构建你的项目。但是，eclipse 可以为您生成 ant 脚本。这可以通过右键单击项目 > 导出 > 常规 > Ant 构建文件来完成。如果您希望构建文件在 Eclipse 之外可用，请确保取消选中“使用 Eclipse 编译器”。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-21T21:50:54.177

工作区中没有使用 ant 脚本构建，但是，导出项目确实使用了 ant 脚本。您可以通过右键单击 MANIFEST.MF 或 feature.xml 和 PDE Tools -> Create Ant Build File 来生成此类脚本。

生成的 ant 脚本的确切内容将取决于为导出选择的选项，因此可能存在一些差异。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-21T12:46:30.117

选择*Project » Properties » Builders*以查看 Eclipse 构建项目时运行的内容。

# c# - C#如何测试文件是jpeg？

> ID：772388
> 
> 赞同：36
> 
> 时间：2009-04-21T12:45:03.507
> 
> 标签：c#, jpeg

使用 C# 如何测试文件是否为 jpeg？我应该检查 .jpg 扩展名吗？

谢谢

* * *

## 回答 #1

> 赞同：108
> 
> 时间：2009-04-21T13:06:25.060

几个选项：

您可以检查文件扩展名：

```
static bool HasJpegExtension(string filename)
{
    // add other possible extensions here
    return Path.GetExtension(filename).Equals(".jpg", StringComparison.InvariantCultureIgnoreCase)
        || Path.GetExtension(filename).Equals(".jpeg", StringComparison.InvariantCultureIgnoreCase);
} 
```

或检查文件头中的正确[幻数：](https://web.archive.org/web/20100212180433/http://www.obrador.com/essentialjpeg/headerinfo.htm)

```
static bool HasJpegHeader(string filename)
{
    using (BinaryReader br = new BinaryReader(File.Open(filename, FileMode.Open, FileAccess.Read)))
    {
        UInt16 soi = br.ReadUInt16();  // Start of Image (SOI) marker (FFD8)
        UInt16 marker = br.ReadUInt16(); // JFIF marker (FFE0) or EXIF marker(FFE1)

        return soi == 0xd8ff && (marker & 0xe0ff) == 0xe0ff;
    }
} 
```

另一种选择是加载图像并检查正确的类型。但是，这效率较低（除非您仍然要加载图像），但可能会给您最可靠的结果（请注意加载和解压缩的额外成本以及可能的异常处理）：

```
static bool IsJpegImage(string filename)
{
    try
    {
        using (System.Drawing.Image img = System.Drawing.Image.FromFile(filename)) 
        {           
            // Two image formats can be compared using the Equals method
            // See http://msdn.microsoft.com/en-us/library/system.drawing.imaging.imageformat.aspx
            //
            return img.RawFormat.Equals(System.Drawing.Imaging.ImageFormat.Jpeg);
        }
    }
    catch (OutOfMemoryException)
    {
        // Image.FromFile throws an OutOfMemoryException 
        // if the file does not have a valid image format or
        // GDI+ does not support the pixel format of the file.
        //
        return false;
    }
} 
```

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-04-21T12:51:35.783

将文件作为流打开并查找 JPEG 的[幻数](http://en.wikipedia.org/wiki/Magic_number_(programming)#Magic_numbers_in_files)。

> JPEG 图像文件以 FF D8 开头，以 FF D9 结尾。JPEG/JFIF 文件包含 'JFIF' (4A 46 49 46) 的 ASCII 代码作为空终止字符串。JPEG/Exif 文件包含 'Exif' (45 78 69 66) 的 ASCII 码，也作为空字符终止的字符串

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2012-01-06T08:08:17.980

OMG，这么多代码示例是错误的，错误的错误。

EXIF 文件的标记为 0xff* *e1* *，JFIF 文件的标记为 0xff* *e0* *。因此，所有依赖 0xffe0 来检测 JPEG 文件的代码都会丢失所有 EXIF 文件。

这是一个可以检测两者的版本，并且可以轻松更改为仅返回 JFIF 或仅返回 EXIF。（例如，在尝试恢复 iPhone 图片时很有用）。

```
 public static bool HasJpegHeader(string filename)
    {
        try
        {
            // 0000000: ffd8 ffe0 0010 4a46 4946 0001 0101 0048  ......JFIF.....H
            // 0000000: ffd8 ffe1 14f8 4578 6966 0000 4d4d 002a  ......Exif..MM.*    
            using (BinaryReader br = new BinaryReader(File.Open(filename, FileMode.Open, FileAccess.ReadWrite)))
            {
                UInt16 soi = br.ReadUInt16();  // Start of Image (SOI) marker (FFD8)
                UInt16 marker = br.ReadUInt16(); // JFIF marker (FFE0) EXIF marker (FFE1)
                UInt16 markerSize = br.ReadUInt16(); // size of marker data (incl. marker)
                UInt32 four = br.ReadUInt32(); // JFIF 0x4649464a or Exif  0x66697845

                Boolean isJpeg = soi == 0xd8ff && (marker & 0xe0ff) == 0xe0ff;
                Boolean isExif = isJpeg && four == 0x66697845;
                Boolean isJfif = isJpeg && four == 0x4649464a;

                if (isJpeg) 
                {
                    if (isExif)
                        Console.WriteLine("EXIF: {0}", filename);
                    else if (isJfif)
                        Console.WriteLine("JFIF: {0}", filename);
                    else
                        Console.WriteLine("JPEG: {0}", filename);
                }

                return isJpeg;
                return isJfif;
                return isExif;
            }
        }
        catch
        {
            return false;
        }
    } 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-04-21T12:51:50.277

您可以尝试将文件加载到图像中，然后检查格式

```
Image img = Image.FromFile(filePath);
bool isBitmap = img.RawFormat.Equals(ImageFormat.Jpeg); 
```

或者，您可以打开文件并检查标题以获取类型

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-21T12:49:00.000

您可以找到有关 jpeg 文件格式的文档，特别是标题信息。然后尝试从文件中读取此信息并将其与预期的 jpeg 标头字节进行比较。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-21T12:53:12.627

读取头字节。本文包含有关几种常见图像格式的信息，包括 JPEG：

[使用图像文件头验证图像格式](http://www.mikekunz.com/image_file_header.html)

[JPEG 标头信息](http://www.obrador.com/essentialjpeg/headerinfo.htm)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-21T12:50:35.787

一旦你有了扩展，你就可以使用正则表达式来验证它。

```
^.*\.(jpg|JPG)$ 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-21T12:58:26.907

这将遍历当前目录中的每个文件，如果找到的任何带有 JPG 或 JPEG 扩展名的文件是 Jpeg 图像，则会输出。

```
 foreach (FileInfo f in new DirectoryInfo(".").GetFiles())
        {
            if (f.Extension.ToUpperInvariant() == ".JPG"
                || f.Extension.ToUpperInvariant() == ".JPEG")
            {
                Image image = Image.FromFile(f.FullName);

                if (image.RawFormat == ImageFormat.Jpeg)
                {
                    Console.WriteLine(f.FullName + " is a Jpeg image");
                }
            }
        } 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-21T13:03:36.673

根据您查看此文件的上下文，您需要记住，[在用户告诉您打开文件之前，您无法打开该文件。](http://blogs.msdn.com/oldnewthing/archive/2009/04/15/9549682.aspx)

（链接是 Raymond Chen 的博客条目。）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-21T12:50:17.720

这里的代码：

[http://mark.michaelis.net/Blog/RetrievingMetaDataFromJPEGFilesUsingC.aspx](http://mark.michaelis.net/Blog/RetrievingMetaDataFromJPEGFilesUsingC.aspx)

向您展示如何获取元数据。我想如果您的图像不是有效的 JPEG，那会引发异常。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-21T12:54:55.947

检查文件扩展名是不够的，因为文件名可能是谎言。

一种快速而肮脏的方法是尝试使用 Image 类加载图像并捕获任何异常：

```
Image image = Image.FromFile(@"c:\temp\test.jpg"); 
```

这并不理想，因为您可能会遇到任何类型的异常，例如 OutOfMemoryException、FileNotFoundException 等。

最彻底的方法是将文件视为二进制文件并确保标头与 JPG 格式匹配。我敢肯定它在某处被描述过。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-21T12:55:10.237

最好的方法是尝试使用 Drawing.Bitmap (string) 构造函数从中创建图像，看看它是否失败或抛出异常。一些答案的问题是这样的：首先，扩展名纯粹是任意的，它可能是 jpg、jpeg、jpe、bob、tim 等等。其次，仅使用标题不足以 100% 确定。它肯定可以确定文件不是 jpeg 但不能保证文件是 jpeg，任意二进制文件在开始时可能具有相同的字节序列。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-08-19T15:09:40.400

只需获取文件的媒体类型并验证：

```
private bool isJpeg()
        {
string p = currFile.Headers.ContentType.MediaType;
            return p.ToLower().Equals("image/jpeg") || p.ToLower().Equals("image/pjpeg") || p.ToLower().Equals("image/png");
        } 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-02-23T12:38:55.490

在检查文件扩展后，像这样读取图像的前四个字节和图像的最后两个字节，为值 255 的最后两个字节执行此操作，其他文件为 217 可以执行此 [操作在 C#](https://stackoverflow.com/questions/210650/validate-image-from-file-in-c-sharp) [http://www.garykessler中验证文件中的图像.net/library/file_sigs.html](http://www.garykessler.net/library/file_sigs.html)

```
// after check extention of file
byte[] ValidFileSignture = new byte[] { 255, 216, 255, 224 };
byte[] bufferforCheck = new byte[ValidFileSignture.Length];
Stream _inputStream = file.InputStream;
byte[] bufferforCheck1 = new byte[] { 255, 216, 255, 224 };
_inputStream.Read(bufferforCheck, 0, ValidFileSignture.Length);
if (!Enumerable.SequenceEqual(bufferforCheck, ValidFileSignture))
{
    //file OK
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2016-11-09T13:25:37.003

```
System.Web.MimeMapping.GetMimeMapping(filename).StartsWith("image/");
MimeMapping.GetMimeMapping produces these results:

file.jpg: image/jpeg
file.gif: image/gif
file.jpeg: image/jpeg
file.png: image/png
file.bmp: image/bmp
file.tiff: image/tiff
file.svg: application/octet-stream 
```

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2009-04-21T12:48:20.423

您可以使用[Path.GetExtension 方法](http://msdn.microsoft.com/en-us/library/system.io.path.getextension.aspx)。

# c# - Reapplying template for ListBox item programatically

> ID：772419
> 
> 赞同：0
> 
> 时间：2009-04-21T12:50:39.497
> 
> 标签：c#, wpf, listbox, templates

Basically, I have a list of colors and a defined datatemplate for listbox item:

```
<DataTemplate x:Key="colorItemDataTemplate">
    <Border x:Name="borderInner" BorderBrush="Black" BorderThickness="1" Background="{Binding Brush}" Width="11" Height="11" />
</DataTemplate> 
```

Now, when I add a bunch of items into the listbox and then set the ListBox.ItemsSource property to my List, the listbox is filled correctly.

There is also a slider with its appropriate event handler. Within the event handler, Brush property of one of the items from the listbox is changed. Since the appearance of the item depends on the Brush Property, listbox should reflect the change.

I could reset the ItemsSource property, but then all items have their templates applied and with more than 200 items in the listbox, this is pretty slow.

So, is there any way to refresh the template for only one item from the listbox?

Thanx

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T12:57:53.257

I'm not sure I follow. If you've bound the `Background` to the property, changing the property should automatically udpate the background of the `ListBoxItem`. If you're not seeing that, make sure you are either using a `DependencyProperty` or implementing `INotifyPropertyChanged`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T13:23:52.943

You could use a binding converter. In the converter class you could have some logic like

```
(pseudo-code)
if (ListBoxItem.IsSelected)
   return SpecialColorFromSlider
else
   return NormalListBoxColor 
```

# asp.net - Can't see next page in gridview

> ID：772428
> 
> 赞同：1
> 
> 时间：2009-04-21T12:53:01.597
> 
> 标签：asp.net, gridview

when I use " AllowPaging="True" " property in gridview and upload my webSite ,when I click next page , I can't see that and I see same record that I see already . point : I bind a dataBase on gridview,and I see that in gridview.above problem when I uplaod my website,happen . what is problem that I can't see next page of gridview ?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T13:07:32.233

I am having a bit of trouble completing understanding your question. I think your are basically trying to get paging to work on a gridview.

In addition to setting "AllowPaging=True", you will need to hook into your paging event like so:

```
 void GridView_PageIndexChanging(Object sender, GridViewPageEventArgs e)
  {
       e.NewPageIndex = e.NewPageIndex + 1;
       DataBind();
  } 
```

Check it out on [MSDN](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.pageindexchanging.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T13:00:19.740

you need to set the current page index property in Page index chaged event. then call the bind method in next line. then only you able to see the next page and it will work.

example protected void SearchGrid_PageIndexChanging(object sender, GridViewPageEventArgs e) { //set the current page index for grid searchResultsGrid.PageIndex = e.NewPageIndex;

```
 //Bind the result sets
        BindSearchResults(); 
```

}

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-22T02:38:15.813

Custom [control](http://www.codeproject.com/KB/grid/GenericGridViewWithPaging.aspx) would help to avoid writing on page level event handlers

# sql-server - 将 BLOB 字段添加到表的性能开销

> ID：772434
> 
> 赞同：7
> 
> 时间：2009-04-21T12:53:58.443
> 
> 标签：sql-server, performance, oracle, blob

我正在尝试在两种可能的实现之间做出决定，并渴望选择最好的一种:)

我需要将一个可选的 BLOB 字段添加到当前只有 3 个简单字段的表中。据预测，新字段将在不到 10%，甚至不到 5% 的情况下使用，因此对于大多数行来说它将为空 - 事实上，我们的大多数客户可能永远不会有任何 BLOB 数据。

一位同事的第一个想法是添加一个新表来仅保存 BLOB，并在第一个表中使用（可为空的）外键。他预测这将在查询第一个表时带来性能优势。

我的想法是，将 BLOB 直接存储在原始表中更合乎逻辑且更容易。我们的查询都不是`SELECT *`从该表执行的，所以我的直觉是直接存储它不会有显着的性能开销。

我将对这两种选择进行基准测试，但我希望一些 SQL 专家能从经验中得到任何建议。

使用 MSSQL 和 Oracle。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-21T13:17:47.030

对于 MSSQL，blob 将存储在数据库中的单独页面上，因此如果列为空，它们不应影响性能。

如果您使用 IMAGE 数据类型，则数据始终存储在行外。如果您使用 varbinary(max) 数据类型，那么如果数据 > 8kb 则存储在行外，否则可能会根据表选项存储在行中。

如果您只有几行带有 blob，则性能不会受到影响。

# google-maps - 根据城镇名称聚焦谷歌地图

> ID：772435
> 
> 赞同：2
> 
> 时间：2009-04-21T12:54:08.490
> 
> 标签：google-maps, joomla

我有一个城镇名称、gmap 模块和 plg。我想通过输入城镇名称而不是经度和纬度来在 gmap 中聚焦所需位置。在 Joomla 1.5.x 中有什么方法可以做到这一点。

在此先感谢
纳文

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-27T21:08:48.100

您将需要一个地理编码器来根据城市名称获取位置。对 Joomla 一无所知，但这里是使用 JavaScript 的示例。

## 的HTML

```
<div id='myMap' style="position:relative; width:740px; height:400px;"></div> 
```

## 剧本

您必须填写 Google API Key 和您想要的城市

```
<script src="http://maps.google.com/maps?file=api&amp;v=2.x&amp;key=XXXXX">
</script>

<script type="text/javascript">
    function addLoadEvent(func) {
        var oldonload = window.onload;
        if (typeof window.onload != 'function')
        { window.onload = func; }
        else {
            window.onload = function()
            { oldonload(); func(); }
        }
    }

    var map = null;
    var geocoder = null;

    addLoadEvent(initialize);

    function initialize() {
        if (GBrowserIsCompatible()) {
            map = new GMap2(document.getElementById("myMap"));
            map.setCenter(new GLatLng(-12.08, -53.08), 4);
            map.addControl(new GSmallMapControl());
            map.addControl(new GOverviewMapControl());
            geocoder = new GClientGeocoder();
            showAddress('YourCity, YourCountry');
        }
    }

    function showAddress(address) {
        if (geocoder) {
            geocoder.getLatLng(
          address,
          function(point) {
              if (!point) {
                  $("#myMap").hide();
              } else {
                  map.setCenter(point, 8);
                  var marker = new GMarker(point);
                  map.addOverlay(marker);
                  marker.openInfoWindowHtml(address);
              }
          }
        );
        }
    }
</script> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-05T12:09:55.370

您可以从 Javascript 向 Google 的地理编码服务发起 HTTP 调用，将地名/邮政编码传递给它，然后返回 lat/long。

我使用 CSV 选项执行此操作，因为我从 ASP 调用它，但我认为您也可以取回 XML 或 JSON。

如果您有 Google 地图 API 密钥，请关闭此 URL： [http ://maps.google.com/maps/geo?gl=uk&q=guildford,+uk&output=csv&key=XXXXXXXXXXXX](http://maps.google.com/maps/geo?gl=uk&q=guildford,+uk&output=csv&key=XXXXXXXXXXX)

返回的第一个参数是响应代码。200代表成功。然后你得到纬度和经度，逗号分隔。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-27T21:10:58.670

我正在寻找一种自己做类似事情的方法。我尝试使用 Google Maps API 搜索位置，但有时会出错。最终我查询了与城镇相关的维基百科页面并解析了坐标，然后使用了这些。可能不是您正在寻找的解决方案，但它对我有用。我建议先尝试搜索 Maps API 作为 Eduardo 的详细信息，但如果这不起作用，则可能会这样做。

# sql - 使用正则表达式的 T-SQL 搜索 html？

> ID：772441
> 
> 赞同：1
> 
> 时间：2009-04-21T12:55:05.400
> 
> 标签：sql, html, regex

在我的数据库中，我有一个包含 html 文档的字段。现在必须有可能在此文档中进行搜索。但是，可能找不到 html 标签。所以当我有这样的事情时：

```
<html>
  <head>
    <title>Bar</title>
  </head>
  <body>
   <p>
     this content my be found
   </p>
  </body>
</html> 
```

存储在数据库中的文档可能不是 xhtml。您能告诉我在内容中搜索的最佳方式是什么吗？我应该使用正则表达式吗？因此，它会是什么样子？如果没有，我还应该使用什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-21T13:00:23.797

您可以尝试打开[全文搜索](http://msdn.microsoft.com/en-us/library/ms142571.aspx)或使用诸如[Lucene.Net](http://incubator.apache.org/lucene.net/)之类的东西为您索引内容。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-21T13:01:27.647

有多少记录？我希望您可能必须使用全文搜索和 IFilter 才能有效地执行此操作。Html 不适合正则表达式 - 很快就很难做一些非常简单的事情。

如果量不是很大，您是否可以使用外部解析应用程序迭代记录，使用诸如 HTML Agility Pack（用于 .NET）之类的东西 - 或您选择的任何其他 DOM。

但 FTS/IFilter 将是我的首选。

# jquery - 动态创建选项卡时如何禁用重新加载？

> ID：772447
> 
> 赞同：1
> 
> 时间：2009-04-21T12:56:45.177
> 
> 标签：jquery, tabs

我使用 jQuery 动态创建选项卡，但是每次单击一个选项卡时，它都会重新加载目标 URL。除非我想再次重新加载，否则我应该如何禁用重新加载行为？多谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-21T12:59:21.210

使用`event.preventDefault()`：

```
$('a.tab').click(function(event) {
    event.preventDefault(); // this is the key
    // your code here
}); 
```

**编辑**：关于您的评论 - 只需[设置`cache`为 true](http://jqueryui.com/demos/tabs/#options)：

```
$(document).ready(function() {
    $apTabs = $("#apTabs").tabs({
        // ...
        cache: true, // this does the magic
        // ...
    });
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T13:05:56.763

```
$('#tabs').click(function(){
  // code
  return false;
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T13:25:44.890

发布我的代码供您参考：

```
<script>
    $(document).ready(function () {
        $apTabs = $("#apTabs").tabs({
            ajaxOptions: { async: true },
            cache: false,
            add: function (event, ui) {
                //immdeiately select the new created one
                $apTabs.tabs('select', '#' + ui.panel.id);
            }
        });
    });
</script>

<div id="apTabs">
    <ul>
        <li></li>
    </ul>
    <div></div>
</div> 
```

# sql-server - 需要有关 Sql Server 全文搜索问题的帮助

> ID：772450
> 
> 赞同：0
> 
> 时间：2009-04-21T12:57:34.083
> 
> 标签：sql-server, linq-to-sql, full-text-search, user-defined-functions

我有一个`Full Text Catalog`单表，定义了三个字段：-

```
TABLE: Animals
Fields: Name, Breed, LatinName. 
```

现在，目录*似乎*运行良好。

例如。

```
CREATE FUNCTION AnimalSearch
(
    @Name NVARCHAR(200)
) RETURNS TABLE AS
RETURN 
(
    SELECT KEY_TBL.[Key] as Name,
        KEY_TBL.RANK as Relevance
    FROM CONTAINSTABLE(Animals, Name, @Name) AS KEY_TBL
) 
```

现在，当我运行它时，我得到以下结果：- Name = ma（无结果） Name = mat（无结果） Name = matt（1 个结果 - 正确）。

```
SELECT * FROM [dbo].[AnimalSearch]('ma') 
```

这是使用它的正确方法吗？我也试过用`CONTAINSTABLE`..`FREETEXTTABLE`同样的东西代替..没有结果。

任何想法，任何人？

### 编辑

我知道这可以在存储过程中实现。我希望将其作为表值函数来执行，因此我可以在某些 Linq2Sql 中使用它。如果它真的表现不佳，那么请说出来。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T13:01:51.267

不确定这是个好主意。表值函数不存储统计信息，因此性能可能会受到影响。

# javascript - 在输入类型 =“图像”的 onclick 期间停止表单提交

> ID：772458
> 
> 赞同：1
> 
> 时间：2009-04-21T12:59:27.013
> 
> 标签：javascript, jquery, html

重置操作由调用一个名为 的函数执行`input type="image"`并`onclick`调用`resetForm()`。

单击重置时，不应发生表单提交。我尝试从 resetForm() 函数返回 false ，但它仍然不起作用。请帮帮我。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-21T13:10:59.933

Instead of returning false in `resetForm`, use `preventDefault` in the click function:

```
$('#myButton').click(function(event) {
    event.preventDefault(); // yaa!
    resetForm();
}); 
```

`return false` does also work, but when jQuery got a function for something, I usually stick with that.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-21T13:25:08.027

我将确保您的函数正确返回 false，确保您的 JavaScript 中没有语法错误。

测试这个的好方法，试试 alert("Testing Return!"); 就在返回假之前。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-21T13:34:46.833

如果您想使用`return False;`而不是`event.preventDefault();`，则**必须**将 return false*放在*事件回调中。因此，如果您返回 false in ，则需要是这样的`resetForm()`：

```
$('#myButton').click(function() {
    return resetForm();
}); 
```

更简单的是，如果您所做的只是在点击时运行一个函数（感谢 JimmyP 的提醒）：

```
 $('#myButton').click(resetForm); 
```

在我看来，它更干净、更简单，并且涉及的打字更少。一切都为我赢。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-21T13:36:42.600

我认为其他人都在描述一种不同的方式来做我建议的事情，那就是：

```
onClick="return resetForm();" 
```

否则 onClick 正在调用而不关心返回。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-05-29T15:37:51.540

有一种实际的方法。但这需要几个步骤。

1.  定义你的..
2.  您甚至需要绑定输入项的单击。使用 jquery 来做到这一点。
3.  写你的功能

捆绑：

```
 $(document).ready(function () {
   $("#yourinputtypeid").on("click", {Parameter1 : "your parameter value"},    
   FunctionNameToRun);
 } 
```

功能。

```
function FunctionNameToRun(event)
{
event.preventDefault();
// the rest of your code
} 
```

而已。这应该可以防止页面的提交/重新加载。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-21T13:36:25.300

我可能会更好地使用`<input type="reset" />`而不是`type="image"`，因为后者具有语义，`type="submit"`而前者似乎具有您想要的语义。您也可以轻松地将图像放在这样的按钮上，这可能会省去您编写 JavaScript 函数的麻烦。

如果您想继续使用`<input type="image" />`，我认为`false`从`onclick`活动中返回不会有任何作用。由于它具有提交表单的语义，因此表单将被提交。为了解决这个问题，您可以`onsubmit`在表单标签中放置一个属性：`<form onsubmit="return submitFunction();" />`。然后，`submitFunction`您可以检查按下了哪个提交/图像按钮，并取决于该返回`true`或`false`. 返回`false`此处**将**阻止表单提交。

# wpf - WPF 在容器之间拖放

> ID：772459
> 
> 赞同：6
> 
> 时间：2009-04-21T12:59:52.300
> 
> 标签：wpf, controls, user-interface, drag-and-drop

我有一个容器，比如说一个网格。它有两个容器，比如 StackPanels。

StackPanel #1 有一些矩形。使用户能够拖动矩形并将其放入 StackPanel #2 的最佳方法是什么（并使该矩形成为 StackPanel #2 的子级）。

我有点怀疑 - 唯一不清楚的是是实际使用容器还是只是在直画布中手动处理所有矩形。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-21T13:18:25.377

就实际移动项目背后的逻辑而言，`StackPanel`作为容器的 a 就可以了。如果您想在拖动项目时预览项目，您可以实现一个在拖动项目时`Adorner`显示的`Visual`。

# sql - Access 中的案例表达式

> ID：772461
> 
> 赞同：36
> 
> 时间：2009-04-21T13:00:04.577
> 
> 标签：sql, ms-access

可以`case`在 Access 中使用表达式吗？我正在尝试确定 2 列的最大日期，但在以下代码中不断出现语法错误：

```
CASE 
  WHEN dbo_tbl_property.LASTSERVICEDATE > Contour_dates.[Last CP12 Date]
    THEN dbo_tbl_property.LASTSERVICEDATE 
  ELSE Contour_dates.[Last CP12 Date] 
END AS MaxDate 
```

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-04-21T13:03:03.883

您可以改用该`IIF()`功能。

```
IIF(condition, valueiftrue, valueiffalse) 
```

*   `condition`是您要测试的值。

*   `valueiftrue`是条件计算结果为 TRUE 时返回的值。

*   `valueiffalse`是条件计算结果为 FALSE 时返回的值。

[`Switch`](https://support.office.com/en-us/article/switch-function-d750c10d-0c8e-444c-9e63-f47504f9e379)当您有多个条件要测试时，还有一个更易于使用和理解的功能：

```
Switch( expr-1, value-1 [, expr-2, value-2 ] … [, expr-n, value-n ] ) 
```

> Switch 函数参数列表由成对的表达式和值组成。表达式从左到右求值，并返回与第一个求值为 True 的表达式关联的值。如果部件未正确配对，则会发生运行时错误。例如，如果 expr-1 为 True，则 Switch 返回 value-1。如果 expr-1 为 False，但 expr-2 为 True，则 Switch 返回 value-2，依此类推。
> 
> Switch 在以下情况下返回 Null 值：
> 
> *   没有一个表达式为真。
>     
>     
> *   第一个 True 表达式具有对应的值为 Null。
>     
>     
> 
> **注意： Switch 计算所有表达式**，即使它只返回其中一个。因此，您应该注意不良副作用。例如，如果任何表达式的计算导致除以零错误，则会发生错误。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-21T13:36:05.160

Access 中没有 case 语句。相反，您可以使用 switch 语句。它看起来像下面这样：

`switch(dbo_tbl_property.LASTSERVICEDATE > Contour_dates.[Last CP12 Date],dbo_tbl_property.LASTSERVICEDATE,dbo_tbl_property.LASTSERVICEDATE <= Contour_dates.[Last CP12 Date],Contour_dates.[Last CP12 Date])`

如需进一步阅读，请查看： [http ://www.techonthenet.com/access/functions/advanced/switch.php](http://www.techonthenet.com/access/functions/advanced/switch.php)

或者对于 VBA 中的 case 函数实现示例：

[http://ewbi.blogs.com/develops/2006/02/adding_case_to_.html](http://ewbi.blogs.com/develops/2006/02/adding_case_to_.html)

问候，J。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-09-08T19:15:23.047

只要你在处理数字，`CASE`就是[语法糖](https://www.quora.com/What-is-syntactic-sugar-in-programming-languages)。您可以用一些布尔乘法替换它。

例如，`CASE WHEN A = 1 THEN 2 ELSE 3 END`只是一种更好的写作方式

```
(-1) * ((A = 1) * 2 + (A <> 1) * 3) 
```

（这`-1`是必需的，因为 Microsoft Jet[将真正的布尔语句评估为 -1](https://superuser.com/questions/694919/why-do-yes-no-values-in-microsoft-access-map-to-1-and-0/710356)。）

所以而不是：

```
CASE 
  WHEN dbo_tbl_property.LASTSERVICEDATE > Contour_dates.[Last CP12 Date]
    THEN dbo_tbl_property.LASTSERVICEDATE 
  ELSE Contour_dates.[Last CP12 Date] 
END AS MaxDate 
```

采用：

```
-1 * (
(dbo_tbl_property.LASTSERVICEDATE > Contour_dates.[Last CP12 Date]) * dbo_tbl_property.LASTSERVICEDATE +
(dbo_tbl_property.LASTSERVICEDATE <= Contour_dates.[Last CP12 Date]) * Contour_dates.[Last CP12 Date]
) AS MaxDate 
```

顺便说一句，可悲的是，如果您的 CASE 语句涉及字符串，则此方法不起作用。

# php - 如何用 PHP 制作聊天室脚本？

> ID：772471
> 
> 赞同：4
> 
> 时间：2009-04-21T13:01:47.223
> 
> 标签：php, chatroom

几个访问者连接到[http://site.com/chat.php](http://site.com/chat.php)

他们每个人都可以编写文本消息并将其发送到 chat.php，它会立即显示在每个人的浏览器上（[http://site.com/chat.php](http://site.com/chat.php)）

我必须使用数据库吗？我的意思是，AJAX 或 PHP 缓冲区功能是否足以满足此类会话聊天室的需求？

不同用户的会话如何相互共享数据？

任何想法或见解将不胜感激，谢谢！

编辑：感谢您的链接。但我想要的是将数据推送到客户端浏览器的方式。不断刷新客户端浏览器（AJAX 与否）是唯一的方法吗？此外，这里的挑战是不同的用户（例如 2、1 对 1）如何共享聊天文本？你如何储存它们？以及如何在 2 个客户端之间同步文本？最好不要使用数据库。

编辑 2：实际上Peter D 提到的[YShout](http://lumichat.com/yshout5/example/)做得很好。它似乎并没有不断刷新浏览器。但我不明白它如何将新消息推送到现有用户的窗口。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-21T13:47:15.290

（大约）有 3 个用于创建聊天应用程序的选项：

## 插座

> 前端使用 flash/java 和套接字，后端使用支持套接字的编程语言。对于后端，我建议使用 java 或 python，因为它们具有多线程和 NIO 功能。使用 PHP 可以做到这一点（但 php 不能真正做到高效的多线程，而且通常不适合这个）。如果您需要高性能，这是一个选项，可能不是您想要的。

## 使用 ajax 并拉取

> 在这种情况下，所有客户端都会不断（例如每 2 秒）轮询是否发生了新情况。感觉很奇怪，因为您只会在这些时间间隔收到回复。此外，它会给您的服务器和带宽带来相当大的压力。您知道应用程序使用这种技术是因为浏览器会不断刷新。这是一个次优的解决方案。

## 使用 ajax 并推送

> 这适用于多部分响应，并且在后端有长时间运行的（php-）脚本。不是最好的解决方案，但在大多数情况下，它比拉动要好，而且它可以工作并用于几个知名的聊天应用程序。这种技术有时被称为[COMET](http://en.wikipedia.org/wiki/Comet_(programming))。

我的建议：如果您需要用于生产用途的聊天应用程序，请安装现有的。*编程聊天应用程序*并不容易。

如果您只是想学习它，请从一个简单的 ajax/pull 应用程序开始，然后尝试使用 ajax 和 push 编写一个程序。

是的，很可能你需要一个数据库，我成功地实现了一个非常简单的 ajax/pull 解决方案，它可以与文本文件一起工作（但我肯定不会在生产中使用它！）。

（据我所知，但我很确定）没有服务器端后端（仅使用前端 javascript）就不可能创建聊天应用程序！

## 更新

如果您想知道数据推送是如何完成的，请查看此处的来源：[http](http://wehrlos.strain.at/httpreq/client.html) ://wehrlos.strain.at/httpreq/client.html 。异步多部分是你想要的:)

```
function asSendSyncMulti() {
    var httpReq = new XMLHttpRequest();

    showMessage( 'Sending Sync Multipart ' + (++this.reqCount)  );

    // Sync - wait until data arrives
    httpReq.multipart   = true;     
    httpReq.open( 'GET', 'server.php?multipart=true&c=' + (this.reqCount), false );
    httpReq.onload = showReq;
    httpReq.send( null );
}

function showReq( event ) {
    if ( event.target.readyState == 4 ) {
        showMessage( 'Data arrives: ' + event.target.responseText );
    }
    else {
        alert( 'an error occured: ' + event.target.readyState );
    }

} 
```

*每次*数据到达时都会调用 showReq ，而不仅仅是像在常规 ajax 请求中那样调用一次（我在这里没有使用 jquery 或原型，所以代码有点肥胖 - 这真的很旧:)）。

这是服务器端部分：

```
<?php

    $c = $_GET[ 'c' ];

    header('Content-type: multipart/x-mixed-replace;boundary="rn9012"');

    sleep( 1 );

    print "--rn9012\n";
    print "Content-type: application/xml\n\n";
    print "\n";
    print "Multipart: First Part of Request " . $c . "\n";
    print "--rn9012\n";
    flush();

    sleep( 3 );

    print "Content-type: application/xml\n\n";
    print "\n";
    print "Multipart: Second Part of Request " . $c . "\n";
    print "--rn9012--\n";

?> 
```

## 更新2

关于数据库：如果你在后端有一个没有共享的架构，比如 mod_php/cgi，你*肯定*需要*某种*外部存储，比如数据库或文本文件。但是：您可以通过编写自己的 http 服务器来依赖内存（可以使用 php，但我不建议将其用于认真的工作）。这并不是很复杂，但可能有点超出你的问题的范围^^

## 更新3

我犯了一个错误！把一切都搞混了，因为我真的做了很长时间了。以下是更正：

1.  多部分响应仅适用于 Mozilla 浏览器，因此用途有限。COMET 并不意味着多部分响应。

2.  COMET 意味着：传统的单部分响应，但在有可用数据之前保持（无限循环和睡眠）。因此浏览器对每个操作都有 1 个请求/响应（在最坏的情况下），而不是每 x 秒一个请求，即使没有任何值得响应的事情发生。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-21T13:32:07.370

您提到希望它在没有数据库的情况下工作，并且没有客户端轮询服务器以获取更新。

理论上，您可以通过将聊天的“日志”存储在服务器上的文本文件中并更改您的页面以便用户在 chat.php 页面上执行 GET 请求来做到这一点，但 PHP 页面实际上从未完成发回给用户。（例如响应永远不会完成）

当没有消息时，您需要发回一些“*无操作”数据以保持连接正常，但理论上这会起作用。*

问题是，要完成上述工作还有很多工作要做。您需要将 AJAX 帖子发回服务器以提交新评论...用户的浏览器将一直在旋转（除非您将聊天日志嵌套在 iframe 中 - 例如更多工作）... 这种设置将很难管理。

我建议从其他地方获取一个免费的聊天脚本（例如[http://tinychat.com/](http://tinychat.com/)），或者如果你想自己动手（为了好玩/体验）然后继续，但从数据库开始并建立一个页面将从服务器推送和拉取消息。

最后，如果您担心用 AJAX 请求“锤击”服务器......不要。只需建立聊天，然后如果您发现存在性能问题，请返回 StackOverflow 并询问如何优化它，以便在没有活动时数百个请求不会淹没聊天。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-21T13:49:19.467

虽然 HTTP 不是为轻松推送而设计的，但您可以通过让 PHP 脚本永不终止并仔细观察 JavaScript 结果来模拟推送连接。

本质上，您正在模拟流阅读器。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-21T13:10:59.637

如果您希望新用户加载他们进入房间之前发生的聊天历史记录，则需要数据库或其他存储。除非你想创建一个学习聊天，否则有太多的免费使用来打扰。

[http://tinychat.com](http://tinychat.com)是另一个简单的聊天网站。

AJAX 工作正常。我为我的一个网站创建了一个简单的页面。但我发现聊天并没有你想象的那么频繁。

通过托管 IRC 服务器并允许用户使用具有数据交换功能的 IRC 客户端，共享数据变得更加复杂并且更容易完成。尽管没有什么能阻止您让一个用户上传到网站，然后其他人下载。人与人之间使用网络界面会很困难，因为用户之间没有任何联系。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-02-15T00:01:00.033

[您可以使用PubNub 之](http://pubnub.com)类的服务完全使用 HTML 和 Javascript 来完成此操作。您不需要数据库，因为您可以使用[历史 API](http://www.pubnub.com/docs/javascript/tutorial/storage-playback.html)之类的东西来填充最后 x 条聊天消息。

这是使用 PubNub 构建聊天应用程序的快速教程。

# 10 行代码中的实时聊天应用程序

![在此处输入图像描述](https://i.stack.imgur.com/1dLUZ.png)

```
Enter Chat and press enter
<div><input id=input placeholder=you-chat-here /></div>

Chat Output
<div id=box></div> 
```

* * *

```
<script src=http://cdn.pubnub.com/pubnub.min.js></script>
<script>(function(){
var box = PUBNUB.$('box'), input = PUBNUB.$('input'), channel = 'chat';
PUBNUB.subscribe({
    channel  : channel,
    callback : function(text) { box.innerHTML = (''+text).replace( /[<>]/g, '' ) + '<br>' + box.innerHTML }
});
PUBNUB.bind( 'keyup', input, function(e) {
    (e.keyCode || e.charCode) === 13 && PUBNUB.publish({
        channel : channel, message : input.value, x : (input.value='')
    })
} )
})()</script> 
```

# c# - 在 web.config 中为带有随机数量元素的 web.config 创建一个自定义块

> ID：772474
> 
> 赞同：1
> 
> 时间：2009-04-21T13:02:06.943
> 
> 标签：c#, asp.net, web-config

我需要在 web config 中创建一个自定义块，如下所示：

```
<MySettings>
    <add name="name1" value="value1" />
    <add name="name2" value="value2" />
    <add name="name3" value="value3" />
    ...
</MySettings> 
```

我明白，我应该从 ConfigurationSection 派生我的自定义设置类，但我不知道如何使其可扩展。我需要向该块添加很多项目，并将其用作键值对。

我也知道可以通过部分完成所有操作，但我需要创建一个自定义的，因为键和值字段对我来说可能不够，我需要扩展它们。

非常感谢您的帮助！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-21T13:15:39.250

要创建添加/清除/删除子元素的结构，匹配元素的类型`MySettings`需要从[ConfigurationElementCollection](http://msdn.microsoft.com/en-us/library/system.configuration.configurationelementcollection.aspx)派生。

# php - php exec 并返回二进制文件

> ID：772479
> 
> 赞同：1
> 
> 时间：2009-04-21T13:03:31.620
> 
> 标签：php, binary

我正在尝试在 php 中运行以下内容

$测试 =`svn cat ....`

现在 $test 的输出基本上是一个 svn 返回的二进制文件。如何使这个二进制文件可供下载。我试图提出以下内容：

```
$test = `svn cat ....`
header("Content-Disposition: attachment; filename=" . urlencode($filename));
header("Content-Type: application/force-download");
header("Content-Type: application/octet-stream");
header("Content-Type: application/download");
header("Content-Description: File Transfer");            
echo $test; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T13:10:33.193

您是否考虑过将此文件保存到硬盘上的临时位置并从那里提供服务？真的有必要从内存中提供文件吗？如果您有 500 人下载此文件怎么办。当用户下载它们时，服务器会将所有 500 个文件保存在内存中吗？

我的建议是，将文件保存到您的 Web 服务器可以访问的临时位置并给他们一个链接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T13:15:41.653

除了彼得 D 的回答；您可以将二进制文件写入文件系统，然后将其作为下载提供。而不是给用户一个链接。

如果可行，请先尝试使用简单的文本文件；用你的二进制文件试试。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-21T13:36:47.017

您可能想在 PHP中使用[passthru()函数。](http://php.net/passthru)

调用可能需要在标题之后进行，但请先尝试两种方式。

编辑：我认为这不会导致内存问题。我认为 PHP 不会将输出保存在内存中，因为它直接发送到标准输出。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-21T14:30:55.030

来自PHP.net 文档[的评论](http://us3.php.net/passthru)`passthru()`：

```
header("Content-Type: application/octet-stream");
header("Content-Disposition: attachment; filename=\"myfile.zip\"");
header("Content-Length: 11111");
passthru("cat myfile.zip",$err);
exit(); 
```

*以上代码由 igor 在 bboy dot ru 提供。*

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-21T13:10:06.970

问题可能是你有三个内容类型的标题 - 据我所知，浏览器只接受一个，所以我会选择八位字节流。

# sql - SQL：在不丢失 ID 的情况下查找重复条目

> ID：772483
> 
> 赞同：1
> 
> 时间：2009-04-21T13:04:25.393
> 
> 标签：sql, join, distinct, max

我有 1 个表格“产品”，如下所示：

```
ID 产品店铺颜色
01车A黑色
02车B黑色
03自行车C红色
04 A面银
05车C黑
06 自行车 A 红色

```

在此示例中，产品始终具有相同的颜色，独立于销售它的商店。我想使用 Color 属性进行查询，返回一组不同的产品。我还需要一个 ID，可以是任何 ID，以便我进行后续查询。

查询的结果应该是：

```
ID 产品颜色
01车黑
03 自行车红
04平面银

```

我试过：

```
SELECT DISTINCT 
  Product, Color 
FROM 
  Products 
```

但这显然也不会返回 ID

我想我需要加入一些东西，但是我的 SQL 知识太差了。我希望这很简单。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-21T13:07:37.100

这将是获得所需结果的一种方法：

```
SELECT min(ID), Product, Color FROM table GROUP BY Product, Color; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-21T13:07:46.010

怎么样

```
SELECT 
   Product, Color, Min(ID)
FROM 
   TABLE
GROUP BY
   Product, Colour 
```

这将返回唯一的产品/颜色组合和找到的第一个（最低）ID。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T13:18:20.133

您需要使用[GROUP BY](http://www.w3schools.com/sql/sql_groupby.asp)子句。

相同但获得最大 ID：

```
SELECT MAX(ID) AS ID, Product, Color
FROM Products
GROUP BY Product, Color
ORDER BY ID 
```

# asp-classic - 使用 .NET Web 服务的 VB-ASP 应用程序有哪些选择？

> ID：772493
> 
> 赞同：0
> 
> 时间：2009-04-21T13:06:28.727
> 
> 标签：asp-classic, distributed-transactions

我有一个传统的 ASP 应用程序，它预计会使用一个 .net Web 服务。ASP 为这种情况提供了哪些支持？

我记得在页面开头支持事务属性的 VB 脚本。我可以使用事务来包含 Web 服务调用吗？

任何指针将不胜感激。谢谢

帕里托什

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T13:21:23.370

我建议用 C# 编写一个 COM 或 COM+ 组件，并让它完成所有的 Web 服务工作。这样，您就可以从现代程序可用的所有工具中受益，同时仍然能够从古代程序中使用它。您甚至可以通过这种方式获得事务支持，我认为您不会从 SOAP Toolkit 中获得这种支持，因为早在 2002/2003 年 SOAP 中根本没有分布式事务支持。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T13:16:39.653

在经典的 asp [http://www.dotnetjunkies.ddj.com/Tutorial/99CA4563-FBD4-411F-A9C6-FF9E8A0E664F.dcik中获得了关于使用 Web 服务的良好指示](http://www.dotnetjunkies.ddj.com/Tutorial/99CA4563-FBD4-411F-A9C6-FF9E8A0E664F.dcik)

现在需要尝试事务支持......

# asp.net-mvc - Stored Procedure Multiple-Table Output With LINQ and ASP.NET MVC

> ID：772494
> 
> 赞同：2
> 
> 时间：2009-04-21T13:06:45.933
> 
> 标签：asp.net-mvc, linq, stored-procedures

Quite often our systems call stored procedures which output multiple tables worth of results. Previously we used XML outputs to get each table and relate them correctly using XSLT. If I were using ASP.NET MVC with LINQ calling a stored procedure, how do I get each of the tables and then output the data as necessary?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-23T04:35:18.860

> [这篇文章在这里](http://blogs.msdn.com/swiss%5Fdpe%5Fteam/archive/2008/02/04/linq-to-sql-returning-multiple-result-sets.aspx)解释了一切。这是我在您[之前的 SO 问题](https://stackoverflow.com/questions/776426/asp-net-mvc-and-linq-general-questions)中链接的同一篇文章。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-21T14:21:17.457

这里有一篇关于 LINQ to SQL 和存储过程的文章，尤其是“处理 SPROC 中的多个结果形状”部分： [LINQ to SQL - Retrieving Data Using Stored Procedures](http://weblogs.asp.net/scottgu/archive/2007/08/16/linq-to-sql-part-6-retrieving-data-using-stored-procedures.aspx)。

这对你的情况有用吗？

否则，不使用 LINQ to SQL，可能使用`SqlDataReader`'s`NextResult`来查看结果，例如：

```
IList<Employee> employees = new List<Employee>();
IList<Customer> customers = new List<Customer>();
using (SqlConnection connection = new SqlConnection
    (Properties.Settings.Default.NorthwindConnectionString))
using (SqlCommand command = new SqlCommand
    ("GetEmployeesAndCustomers", connection))
{
    command.CommandType = CommandType.StoredProcedure;
    connection.Open();
    using (SqlDataReader reader = command.ExecuteReader())
    {
        while (reader.Read())
        {
            Employee e = new Employee{EmployeeID = (int)reader["EmployeeID"]};
            employees.Add(e);
        }
        reader.NextResult();
        while (reader.Read())
        {
            Customer c = new Customer{CustomerID = (string)reader["CustomerID"]};
            customers.Add(c);
        }
    }
} 
```

* * *

编辑：如何处理不容易融入域模型对象的自定义数据组合的示例；在这种情况下，与客户一起检索订单：

```
namespace Company.Application.ViewModel
{
    public class CustomerOrder
    {
        public string CustomerID { get; set; }
        public string CustomerName { get; set; }
        public int OrderID { get; set; }
        public DateTime? OrderDate { get; set; }
    }
}
namespace Company.Application.Repository
{
    public class CustomerOrderRepository
    {
        public IList<CustomerOrder> GetCustomerOrders()
        {
            NorthwindDataContext db = new NorthwindDataContext();
            var custorders = from customer in db.Customers
                             join order in db.Orders
                             on customer.CustomerID equals order.CustomerID
                             select new CustomerOrder
                             {
                                 CustomerID = customer.CustomerID,
                                 CustomerName = customer.CompanyName,
                                 OrderID = order.OrderID,
                                 OrderDate = order.OrderDate
                             };
            return custorders.ToList();
        }
    }
} 
```

对此的启示：在关于[NerdDinner的](http://weblogs.asp.net/scottgu/archive/2009/03/10/free-asp-net-mvc-ebook-tutorial.aspx)[章节](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)中，Scott Guthrie 谈到了创建自定义的“ViewModel”对象来保存来自例如连接的数据，这些数据不容易适合域模型对象。

# wpf - WPF - 从数据中获取超链接命令？

> ID：772497
> 
> 赞同：2
> 
> 时间：2009-04-21T13:07:27.023
> 
> 标签：wpf, mvvm, hyperlink

在 WPF 中，如何获取对超链接应从对象属性调用的命令的引用？

我正在使用 MVVM 模式创建一个 WPF 应用程序。主窗口中的列表框显示超链接。单击时，每个超链接都会调用视图模型的 ICommand 属性之一。如何指定应该调用哪个 ICommand？

这是我到目前为止所尝试的：超链接包含在 ViewModel.Hyperlinks 属性中，该属性绑定为列表框的 ItemsSource。Hyperlinks 属性包含 MyHyperlink 类型的对象：

```
public class MyHyperlink
{
    public string Text { get; set; }
    public string ViewModelCommand { get; set; }
    public int RecordID { get; set; }
} 
```

MyHyperlink.ViewModelCommand 属性包含单击超链接时应调用的视图模型 ICommand 的名称。我想使用该值为 WPF 超链接控件的 Command 属性指定 PropertyPath。我尝试使用命令名称为列表框创建一个 PropertyPath 资源，但 WPF 不会接受。这是我的 XAML：

```
<ListBox ItemsSource="{Binding Hyperlinks}">
    <ListBox.Resources>
        <PropertyPath x:Key="CommandPath" Path="{Binding ViewModelCommand}" />
    </ListBox.Resources>
    <ListBox.ItemTemplate>
        <DataTemplate>
            <TextBlock>
                <Hyperlink Command="{StaticResource CommandPath}"
                        CommandParameter="{Binding Path=RecordID}">
                    <TextBlock Text="{Binding Text}" />
                </Hyperlink>
            </TextBlock>
        </DataTemplate>
    </ListBox.ItemTemplate>
</ListBox> 
```

如何指定单击超链接时应调用哪个 ICommand？我是创建一个资源（如上所示），还是它以其他方式完成？我需要在 XAML 中执行此操作——我不想诉诸代码隐藏。谢谢你的帮助！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-21T13:28:19.767

我认为您上面的代码不起作用，因为`Hyperlink.Command`它是 type `ICommand`，而不是`string`。您要么需要修改您的`MyHyperlink`类，使其`ViewModelCommand`也是一个`ICommand`，要么编写一个`IValueConverter`将`ICommand`在视图模型中给定命令名称的情况下找到正确实现的类。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-24T17:31:09.850

我已经实现了一个使用 IValueConverter 的解决方案。它被写成[一篇关于 The Code Project 的文章](http://www.codeproject.com/KB/WPF/MvvmDynamicCommands.aspx)。希望它会帮助其他人。

# php - PHP 安全远程代理服务器运行状况

> ID：772502
> 
> 赞同：2
> 
> 时间：2009-04-21T13:07:57.990
> 
> 标签：php, proxy, security

希望在安全的远程代理服务器停止工作时收到警报；例如，如果 Apache 因某种原因挂起。

由于远程机器仍会启动，因此仍然可以`ping`，尽管这证明很少。

需要能够编写通过代理请求路径然后返回结果的脚本。

调查了 PHP/PEAR Net [library](http://pear.php.net/packages.php?catpid=16&catname=Networking)，认为类似的东西`Net_traceroute()`可能是一个起点，但无法弄清楚如何强制路由通过服务器。

有任何想法吗？我什至应该使用 PHP 还是另一种语言会使这更容易？

干杯，

阿杰

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T14:03:37.730

如果您想通过代理发出 HTTP 请求，我猜是这种情况，因为您提到 Apache 作为代理？那么您可以使用[cURL](http://uk.php.net/manual/en/ref.curl.php)。大概是这样的：

```
<?php
$curl = curl_init('http://www.example.com');

//don't fetch the actual page, you only want to check the connection is ok
curl_setopt($curl, CURLOPT_NOBODY, true);

//stop it from outputting stuff to stdout
curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);

//proxy settings
curl_setopt($curl, CURLOPT_PROXYPORT, 8080);
curl_setopt($curl, CURLOPT_PROXY, 'proxyhost');
curl_setopt($curl, CURLOPT_PROXYUSERPWD, 'user:password');

$result = curl_exec($curl);

if ($result === false) {
    die (curl_error($curl)); 
} 
```

[此处](http://uk.php.net/manual/en/function.curl-setopt.php)记录了 cURL 的更多选项。

# php - In php, I want to download an s3 file to the browser without storing it on my server

> ID：772505
> 
> 赞同：5
> 
> 时间：2009-04-21T13:08:20.360
> 
> 标签：php, download, amazon-s3, fopen, buffering

I've got files on Amazon's S3\. They are named with a unique ID so there are no duplicates. I am accessing them using an authorized URL. I need to be able to pass them through to the browser, but I need to rename them. Right now I'm using fopen, but it is downloading the file to my server before serving the file to the browser. How can I have the files 'pass through' my server to the browser? Or how do I buffer the download - downloading a small chunk to my server and pass that to the browser while downloading the next chunk?

Also - I would really like to use CloudFront but they don't offer authenticated URLs. I believe I can use CURL to send credentials for the request - can I do this sort of 'pass through' file serving with CURL?

Thanks!

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-21T14:07:58.627

我不熟悉 S3 的工作原理，所以我不知道这个解决方案是否可行。但是您不能简单地将用户的浏览器重定向到该文件吗？如果我理解正确，S3 允许您为存储桶中的任何文件创建 Web URL。因此，如果这些是付费下载，那么您可以[让 S3 为该下载生成一个临时 URL，](http://bart.motd.be/using-amazon-s3-serve-static-files)然后在用户下载后将其删除。

如果这不是一个选项，您可以尝试这些 PHP 类：

*   [HTTP 协议客户端](http://www.phpclasses.org/browse/package/3.html)- 实现对 HTTP 资源的请求的类（由以下流包装器使用）。允许流式传输请求。
*   [gHttp](http://www.phpclasses.org/browse/package/4040.html) - 一个 HTTP 流包装器，可让您使用 、 等函数将远程 HTTP 资源视为`fopen()`文件`fread()`。
*   [Amazon S3 Stream Wrapper](http://www.phpclasses.org/browse/package/4144.html) - 由与 gHttp 相同的开发人员开发的 Amazon S3 流包装器。还允许像普通文件一样通过`fopen('s3://...')`.

* * *

编辑：

[此页面](http://docs.amazonwebservices.com/AmazonS3/latest/index.html?RESTAuthentication.html)包含有关如何通过在 URL 中编码身份验证密钥来“预身份验证”请求的信息。它位于标题为：**Query String Request Authentication Alternative**的部分下。

```
// I'm only implementing the parts required for GET requests.
// POST uploads will require additional components.
function getStringToSign($req, $expires, $uri) {
   return "$req\n\n\n$expires\n$uri";
}

function encodeSignature($sig, $key) {
    $sig = utf8_encode($sig);
    $sig = hash_hmac('sha1', $sig, $key);
    $sig = base64_encode($sig);
    return urlencode($sig);
}

$expires = strtotime('+1 hour');
$stringToSign = getStringToSign('GET', $expires, $uri);
$signature = encodeSignature($stringToSign, $awsKey);

$url .= '?AWSAccessKeyId='.$awsKeyId
       .'&Expires='.$expires
       .'&Signature='.$signature; 
```

然后只需将用户重定向到`$url`，他们应该能够下载文件。签名由单向加密方案 (sha1) 编码，因此您的 AWS 秘密访问密钥不存在被泄露的风险。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T13:24:27.793

您是否尝试过使用 http_get 和 request_options 来指定 httpauth 和 httpauthtype？尽管我不记得此方法是否假定字符串有效类型，但这可能不适用于二进制文件。

如果成功，那么您应该能够提供正确的 MIME 类型并写入浏览器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T16:28:58.730

您是否尝试过仅使用 readfile(" [http://username:password@host/filename.ext](http://username:password@host/filename.ext) ") ？

这只会绕过并直接写入输出缓冲区，但是如果您需要关注内容类型，则需要先验证这一点。

使用 en URL 作为 readfile 的参数还需要使用 urlwrapper-support 编译 PHP。

# nhibernate - Fluent Nhibernate mapping a property from another table

> ID：772507
> 
> 赞同：2
> 
> 时间：2009-04-21T13:08:56.770
> 
> 标签：nhibernate, fluent-nhibernate

I'm having a problem mapping a column in table A to a property of a class, which is primarily mapped to table B. The following explains this better:

There's a class CustomerRisk, which has properties Risk and CustomerNumber.

In the database, this consists of two tables: Customer, which has a column CustomerNumber, and CustomerRisk, which has a Foreign Key to Customer, and one to Risk.

Mapping the Risk isn't hard, but mapping the CustomerNumber is the problem. Is it possible to do this without creating a Customer class*? So that NHibernate joins to the Customer class to select the CustomerNumber:

```
select cn.CustomerNumber, r.Description
from CustomerRisk cr
    inner join Customer c on c.CustomerID = cr.CustomerID
    inner join Risk r on r.RiskID = cr.RiskID 
```

Multiple CustomerRisk records can have the same CustomerID of course.

Hoping this is a little clear, thank a lot.

*   I know you'd normally need a customer class, but I've 'anonymized' the classes.

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-21T15:10:12.033

使用 NHibernate 时要记住的一件事是它处理实体并且只知道您告诉它的内容（通过映射文件）。HQL 是 SQL 的面向对象版本，因此您不能使用它来访问不属于映射域模型的字段。

不过，您仍然可以通过 NHibernate 会话执行普通的旧 SQL，这实际上是访问您尚未映射到 ORM 中的数据的唯一方法。可能有一个轻量级的映射解决方案（虽然我不能说没有看到你的数据模型），但如果你反对完全映射“客户”，我认为 SQL 是你最好的选择。

# c# - Finding how a foreach collection gets modified

> ID：772509
> 
> 赞同：2
> 
> 时间：2009-04-21T13:10:18.140
> 
> 标签：c#, function, loops, for-loop

How do I find out which function or target is modifying the items in a foreach loop in a multithreaded application?

I continously keep getting the error "Collection was modified; enumeration operation may not execute". I'm not removing or adding any items to the generic list within the for loop. I want to find out how it is getting modified. What is the best way to do this?

Thanks

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-21T13:34:46.130

**等一下**——我想我们都错过了重点。

集合类不是线程安全的。如果集合被多个线程访问而没有线程锁定，那么您需要修复它。这是一个特别隐蔽的问题，因为它会在 99.999% 的情况下正常工作*[编辑 - 或抛出可预测的异常]*，而在 0.001% 的情况下，它会做一些完全不可预测且几乎不可能重现的事情。

一种简单的方法是在任何代码访问集合的每个地方都使用 lock{} 语句。这可能有点矫枉过正，但这是最安全的计划。对于迭代，您可以锁定整个循环，或者如果您不想长时间阻塞其他线程，只需将其锁定足够长的时间以制作快照：

```
object[] snap;
lock (list)
{
   snap = list.ToArray();
}
foreach (object x in snap) ... 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-21T13:15:48.440

This is not a direct answer, just a suggestion that might help - in a multithreaded situation where a collection might get modified during iteration, I usually use the ToArray method to create a snapshot of the list for iteration:

```
foreach (object x in list.ToArray()) ... 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-21T13:18:42.270

Replace the collection with an [ObservableCollection](http://msdn.microsoft.com/en-us/library/ms668604.aspx), attach events to modifications and break on them in the debugger (or capture stack trace etc.).

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T13:13:42.780

The best way to do this is to not expose the collection to many classes which could possibly change it. Make it private to one particular class, then only the methods of that class could possibly change it.

Otherwise, you would need to create a derived class from the collection class, and override all the methods that could update the collection. Set breakpoints at all the overrides.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-21T13:14:12.920

Would it be feasible to copy the contents of the global collection to a more tightly scoped variable to protect outside meddling with the data?

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-21T13:22:47.097

您应该能够设置异常断点，然后只需遍历每个线程即可查看哪个线程修改了集合。在任何情况下，如果集合在多个线程之间共享，则需要正确同步。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-21T13:24:08.857

您可能想为此尝试[ObservableCollection](http://msdn.microsoft.com/en-us/library/ms668604.aspx)类。也有一些使该线程安全的示例。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-21T13:25:44.077

您也可以尝试更改您的集合的类名，以查看所有引用的位置。

# wordpress - WordPress filter to modify final html output

> ID：772510
> 
> 赞同：73
> 
> 时间：2009-04-21T13:10:22.603
> 
> 标签：wordpress

WordPress has great filter support for getting at all sorts of specific bits of content and modifying it before output. Like `the_content` filter, which lets you access the markup for a post before it's output to the screen.

I'm trying to find a catch-all filter that gives me one last crack at modifying the final markup in its entirety before output.

I've browsed the list of filters a number of times, but nothing jumps out at me: [https://codex.wordpress.org/Plugin_API/Filter_Reference](https://codex.wordpress.org/Plugin_API/Filter_Reference)

Anyone know of one?

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2014-04-02T16:54:55.053

WordPress 没有“最终输出”过滤器，但您可以组合一个。下面的示例位于我为项目创建的[“必须使用”插件中。](https://codex.wordpress.org/Must_Use_Plugins)

注意：我没有测试过任何可能使用“关机”动作的插件。

该插件通过遍历所有打开的缓冲区级别、关闭它们并捕获它们的输出来工作。然后它触发“final_output”过滤器，回显过滤后的内容。

遗憾的是，WordPress 执行几乎完全相同的过程（关闭打开的缓冲区），但实际上并没有捕获缓冲区进行过滤（只是刷新它），因此其他“关闭”操作将无法访问它。因此，以下操作的优先级高于 WordPress。

wp-content/mu-plugins/buffer.php

```
<?php

/**
 * Output Buffering
 *
 * Buffers the entire WP process, capturing the final output for manipulation.
 */

ob_start();

add_action('shutdown', function() {
    $final = '';

    // We'll need to get the number of ob levels we're in, so that we can iterate over each, collecting
    // that buffer's output into the final output.
    $levels = ob_get_level();

    for ($i = 0; $i < $levels; $i++) {
        $final .= ob_get_clean();
    }

    // Apply any filters to the final output
    echo apply_filters('final_output', $final);
}, 0); 
```

挂钩到 final_output 过滤器的示例：

```
<?php

add_filter('final_output', function($output) {
    return str_replace('foo', 'bar', $output);
}); 
```

**编辑：**

此代码使用匿名函数，仅在 PHP 5.3 或更高版本中受支持。如果您正在使用 PHP 5.2 或更早版本运行网站，那么您就是在伤害自己。PHP 5.2 于 2006 年发布，尽管 Wordpress（*编辑：在 WP 版本 < 5.2 中*）仍然支持它，但您不应该使用它。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2013-07-04T14:25:19.170

问题可能很老，但我找到了更好的方法：

```
function callback($buffer) {
  // modify buffer here, and then return the updated code
  return $buffer;
}

function buffer_start() { ob_start("callback"); }

function buffer_end() { ob_end_flush(); }

add_action('wp_head', 'buffer_start');
add_action('wp_footer', 'buffer_end'); 
```

**说明** 这个插件代码注册了两个动作 -`buffer_start`和`buffer_end`.

`buffer_start`在 html 的 header 部分的末尾执行。参数，`callback`函数，在输出缓冲结束时被调用。这发生在页面的页脚处，此时第二个注册的操作`buffer_end`, 执行。

该`callback`函数是您添加代码以更改输出值（`$buffer`变量）的位置。然后你只需返回修改后的代码，页面就会显示出来。

**注意** 确保为 、 和 使用唯一的函数名称`buffer_start`，`buffer_end`这样`callback`它们就不会与您在插件中可能拥有的其他函数冲突。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-04-21T13:20:34.620

AFAIK，没有钩子，因为主题使用不会被 WordPress 处理的 HTML。

但是，您可以[使用输出缓冲](http://php.net/ob_start)来捕获最终的 HTML：

```
<?php
// example from php.net
function callback($buffer) {
  // replace all the apples with oranges
  return (str_replace("apples", "oranges", $buffer));
}
ob_start("callback");
?>
<html><body>
<p>It's like comparing apples to oranges.</p>
</body></html>
<?php ob_end_flush(); ?>
/* output:
   <html><body>
   <p>It's like comparing oranges to oranges.</p>
   </body></html>
*/ 
```

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2014-10-25T23:10:01.747

@jacer，如果您使用以下钩子，header.php 也会被包含在内。

```
function callback($buffer) {      
    $buffer = str_replace('replacing','width',$buffer);
    return $buffer; 
}

function buffer_start() { ob_start("callback"); } 
function buffer_end() { ob_end_flush(); }

add_action('after_setup_theme', 'buffer_start');
add_action('shutdown', 'buffer_end'); 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2018-07-04T10:51:28.243

我使用这篇文章的最佳解决方案（通过 kfriend）有一段时间了。它使用一个`mu-plugin`来缓冲整个输出。

但是这个解决方案打破了缓存，`wp-super-cache`当我上传`mu-plugin`.

所以：如果你正在使用`wp-super-cache`，你可以像这样使用这个插件的过滤器：

```
add_filter('wp_cache_ob_callback_filter', function($buffer) {
    $buffer = str_replace('foo', 'bar', $buffer);
    return $buffer;
}); 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2018-09-18T14:20:21.897

修改[https://stackoverflow.com/users/419673/kfriend](https://stackoverflow.com/users/419673/kfriend)答案。

所有代码都在functions.php上。您可以使用“final_output”过滤器上的 html 做任何您想做的事情。

在您主题的“functions.php”上

```
//we use 'init' action to use ob_start()
add_action( 'init', 'process_post' );

function process_post() {
     ob_start();
}

add_action('shutdown', function() {
    $final = '';

    // We'll need to get the number of ob levels we're in, so that we can iterate over each, collecting
    // that buffer's output into the final output.
    $levels = ob_get_level();

    for ($i = 0; $i < $levels; $i++) {
        $final .= ob_get_clean();
    }

    // Apply any filters to the final output
    echo apply_filters('final_output', $final);
}, 0);

add_filter('final_output', function($output) {
    //this is where changes should be made
    return str_replace('foo', 'bar', $output); 
}); 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-04-29T21:31:53.067

事实上，最近在 WP-Hackers 邮件列表上讨论了整页修改的主题，似乎一致认为使用 ob_start() 等进行输出缓冲是唯一真正的解决方案。还有一些关于它的优点和缺点的讨论：[http ://groups.google.com/group/wp-hackers/browse_thread/thread/e1a6f4b29169209a#](http://groups.google.com/group/wp-hackers/browse_thread/thread/e1a6f4b29169209a#)

总结：它可以工作并且是必要时的最佳解决方案（例如在 WP-Supercache 插件中），但会降低整体速度，因为您的内容不允许在准备好时发送到浏览器，而是必须等待在您处理并发送到浏览器之前要呈现的完整文档（对于 ob_end() ）。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-04-21T13:23:25.690

您可以尝试查看 wp-includes/formatting.php 文件。例如，wpautop 函数。如果您正在寻找对整个页面进行操作，请查看 Super Cache 插件。这会将最终网页写入文件以进行缓存。看看这个插件是如何工作的可能会给你一些想法。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2021-02-28T19:57:02.753

为了简化以前的答案，只需在`functions.php`：

```
ob_start();
add_action('shutdown', function () {
    $html = ob_get_clean();
    // ... modify $html here
    echo $html;
}, 0); 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2016-10-12T08:24:59.250

我遇到了这段代码的问题，因为我最终得到了页面的原始来源，因此某些插件对页面没有影响。我现在正在尝试解决这个问题 - 我没有找到太多关于从 WordPress 收集输出的最佳实践的信息。

更新和解决方案：

KFRIEND 的代码对我不起作用，因为它捕获了来自 WordPress 的未处理源，实际上与最终在浏览器中的输出不同。我的解决方案使用全局变量来缓冲内容可能并不优雅——但至少我知道收集到的 HTML 与传递给浏览器的 HTML 相同。可能是插件的不同设置会产生问题，但由于上面 Jacer Omri 的代码示例，我最终得到了这个。

在我的情况下，此代码通常位于主题文件夹中的 functions.php 中。

```
$GLOBALS['oldschool_buffer_variable'] = '';
function sc_callback($data){
    $GLOBALS['final_html'] .= $data;
    return $data;
}
function sc_buffer_start(){
    ob_start('sc_callback');
}
function sc_buffer_end(){
    // Nothing makes a difference in my setup here, ob_get_flush() ob_end_clean() or whatever
    // function I try - nothing happens they all result in empty string. Strange since the
    // different functions supposedly have very different behaviours. Im guessing there are 
    // buffering all over the place from different plugins and such - which makes it so 
    // unpredictable. But that's why we can do it old school :D
    ob_end_flush();

    // Your final HTML is here, Yeeha!
    $output = $GLOBALS['oldschool_buffer_variable'];
}
add_action('wp_loaded', 'sc_buffer_start');
add_action('shutdown', 'sc_buffer_end'); 
```

# sql-server - sql server 函数中的 newid()

> ID：772517
> 
> 赞同：58
> 
> 时间：2009-04-21T13:11:16.780
> 
> 标签：sql-server, function, newid

我必须在查询结果中插入一个假列，这是一个表值函数的返回值。此列数据类型必须是唯一标识符。最好的方法（我认为......）是使用`newid()`函数。问题是，我不能`newid()`在这种类型的函数中使用：

```
Invalid use of side-effecting or time-dependent operator in 'newid()' within a function. 
```

* * *

## 回答 #1

> 赞同：111
> 
> 时间：2009-04-22T03:15:04.910

这是一个聪明的解决方案：

```
create view getNewID as select newid() as new_id

create function myfunction ()
returns uniqueidentifier
as begin
   return (select new_id from getNewID)
end 
```

我不能把功劳。我在这里找到它：http: [//omnibuzz-sql.blogspot.com/2006/07/accessing-non-deterministic-functions.html](http://omnibuzz-sql.blogspot.com/2006/07/accessing-non-deterministic-functions.html)

-大学教师

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2012-09-12T23:57:53.540

您可以将 NEWID() 作为参数传递给您的函数。

```
CREATE FUNCTION SOMEIDFUNCTION
(
    @NEWID1 as varchar(36), @NEWID2 as varchar(36)
)
RETURNS varchar(18)
AS
BEGIN
    -- Do something --
    DECLARE @SFID varchar(18)
    SELECT @SFID = 'DYN0000000' + LOWER(LEFT(@NEWID1,4)) + LEFT(@NEWID2,4) 
    RETURN @SFID
END
GO 
```

像这样调用函数；

```
SELECT dbo.SOMEIDFUNCTION(NewID(),NewID()) 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-21T13:16:50.263

将其用作默认值

```
create table test(id uniqueidentifier default newsequentialid(),id2 int)

insert test(id2) values(1)

select * from test 
```

注意我使用 newsequentialid() 而不是 newid() 因为 newid() 会导致分页，因为它不是顺序的，请参见此处：[一些简单的代码来显示 Newid 和 Newsequentialid 之间的区别](http://sqlblog.com/blogs/denis_gobo/archive/2009/02/05/11743.aspx)

* * *

## 回答 #4

> 赞同：-6
> 
> 时间：2009-04-21T13:19:28.010

您可以使用 ROW_NUMBER 函数：

SELECT
(ROW_NUMBER() OVER (ORDER BY recordID) ) as RowNumber ,
recordID,
fieldBla1
FROM tableName

[在http://msdn.microsoft.com/pt-br/library/ms186734.aspx](http://msdn.microsoft.com/pt-br/library/ms186734.aspx)找到更多信息

# python - Oracle / Python Converting to string -> HEX (for RAW column) -> varchar2

> ID：772518
> 
> 赞同：1
> 
> 时间：2009-04-21T13:12:06.590
> 
> 标签：python, oracle

I have a table with a RAW column for holding an encrypted string.

I have the PL/SQL code for encrypting from plain text into this field.

I wish to create a trigger containg the encryption code.

I wish to 'misuse' the RAW field to pass the plain text into the trigger. (I can't modify the schema, for example to add another column for the plain text field)

The client inserting the data is Python (cx_Oracle).

My question is how to best convert from a python string into HEX, then back to VARCHAR2 in the trigger so that the encryption code can be used without modification (encryption code expects VARCHAR2).

Here's an example:

```
create table BOB (name_enc raw(16)); 
```

In python. This is my initial attempt at encoding, I suspect I'll need something more portable for international character sets.

```
name_enc = 'some text'.encode('hex') 
```

The trigger

```
create or replace trigger enc_bob before insert on BOB
for each row
DECLARE
    v_name varchar2(50);

BEGIN

    v_name := :new.name_enc;   <----  WHAT DO I NEED HERE TO CONVERT FROM HEX to VARCHAR?

    --
    -- encryption code that expects v_name to contain string 

END; 
```

**UPDATE**

The suggestion for using Base64 worked for me

Python:

```
name_enc = base64.b64encode('some text') 
```

PL/SQL:

```
v_name := utl_raw.cast_to_varchar2(UTL_ENCODE.BASE64_DECODE(:new.name_enc)); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-21T13:34:03.107

你必须编码为十六进制吗？

我认为有一个包（[utl_encode](http://download.oracle.com/docs/cd/B19306_01/appdev.102/b14258/u_encode.htm)）可用于 PL/SQL 来解码 Base64 例如，你可以使用它吗？

# .net - .NET 相当于 size_t

> ID：772531
> 
> 赞同：14
> 
> 时间：2009-04-21T13:15:54.040
> 
> 标签：.net, 64-bit, pinvoke

我有一段要移植到 64 位的 .NET 代码。这些代码基本上是一组对其他 C dll 的 P/Invoke 调用。C dll 中的函数之一有一个参数“size_t”。我应该在我的 P/Invoke 签名中使用什么数据类型，以便编组工作正常。我正在考虑使用 IntPtr 或 UIntPtr 但有人说它们是 .NET 中的指针等价物，不应该使用它。有谁知道这个的正确类型是什么？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-21T13:21:34.697

UIntPtr 会起作用（IntPtr 也可能会起作用，但 size_t 是无符号的，所以 UIntPtr 更合适）

JaredPar 在他的[博客](https://docs.microsoft.com/en-us/archive/blogs/jaredpar/pinvoke-with-32-and-64-bit-machines)（以及[后续](https://docs.microsoft.com/en-us/archive/blogs/jaredpar/follow-up-pinvoke-with-32-and-64-bit)文章）上写了一些关于此的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T13:21:40.390

如果 size_t 因平台而异，则必须使用 IntPtr。如果是固定大小的整数，请使用 int、uint 或 long（取决于原始声明）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-02-09T00:29:34.120

我发现了一个肮脏的技巧，可以帮助您实现类似的行为。它要求您`_WIN64`为 64 位构建定义编译符号，然后您可以执行以下操作：

```
#if _WIN64
    using size_t = UInt64;
#else
    using size_t = UInt32;
#endif 
```

注意：您必须在每个想要使用该`size_t`类型的文件中使用上述代码。

您还可以定义自己的整数类型（很像定义 UInt64）并重用它，而不必将上述代码放在需要访问的每个文件中`size_t`，但这非常复杂（恕我直言）。

```
#if _WIN64
    using _size_t = UInt64;
#else
    using _size_t = UInt32;
#endif

[Serializable]
[CLSCompliant(false)]
[ComVisible(true)]
public struct size_t : IComparable, IFormattable, IConvertible, IComparable<_size_t>, IEquatable<_size_t>
{
    private _size_t _value;

    public size_t(_size_t val)
    {
        _value = val;
    }

    // You have to add all of your overloads below
} 
```

这将允许`size_t`根据平台更改其类型，但正确重载必要的运算符非常棘手！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2021-12-12T21:45:31.417

从 C# v9（需要 dotnet 5 或更高版本）开始，我们现在拥有和形式的[“原生大小”整数类型](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/builtin-types/nint-nuint)，它们分别具有与和相同的基本行为。这使得当 ap/invoke 目标需要 a 时使用的理想类型，而不需要与[Patrick McDonald 的答案](https://stackoverflow.com/a/772555/1450890)相关的额外编组魔法。`nint``nuint``IntPtr``UIntPtr``nuint``size_t`

# wpf - How do I bind to the SelectedItem property in a ControlTemplate?

> ID：772534
> 
> 赞同：4
> 
> 时间：2009-04-21T13:16:36.643
> 
> 标签：wpf, data-binding, xaml, controltemplates

Consider the following Control/Template

```
<my:ExpandingListBox Margin="0,2,0,0" x:Name="TagSearchListBox">
    <my:ExpandingListBox.Template>
        <ControlTemplate TargetType="{x:Type my:ExpandingListBox}">
            <Border Name="MyBorder" BorderThickness="2" BorderBrush="Black">
                <Grid>
                    <TextBlock Name="MySelectionInfo" Background="White" Text="{TemplateBinding SelectedItem}"/>
                    <ScrollViewer Name="MyScrollViewer" HorizontalScrollBarVisibility="Hidden" Opacity="0" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" VerticalScrollBarVisibility="Hidden">
                        <ItemsPresenter Name="MyItemsPresenter"/>
                    </ScrollViewer>
                </Grid>
            </Border>
        </ControlTemplate>
    </my:ExpandingListBox.Template>
</my:ExpandingListBox> 
```

Basically, there are additional triggers/resources that cause the control to expand/collapse when IsMouseOver is true. When the control is collapsed, I'd like the TextBlock "MySelectionInfo" to display the selected item's text; when it's expanded, I'd like the list of items to be displayed like normal. Is there a way to grab the selected item's text and display it in the TextBlock in pure XAML?

Setting Text="{TemplateBinding SelectedItem}" runs, but doesn't display anything.

**EDIT (Solution):**

```
<TextBlock Name="MySelectionInfo" Background="White">
    <TextBlock.Text>
        <Binding Path="SelectedItem.Name">
            <Binding.RelativeSource>
                <RelativeSource Mode="FindAncestor" AncestorType="{x:Type my:ExpandingListBox}"/>
            </Binding.RelativeSource>
        </Binding>
    </TextBlock.Text>
</TextBlock> 
```

".Name" is a known property of the type of item I'm displaying.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-21T13:23:46.767

使用 a 来绑定会起作用`RelativeSource`吗？也许是这样的：

```
<TextBlock Name="MySelectionInfo" Background="White"
    Text="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type my:ExpandingListBox}}}" /> 
```

# objective-c - 使用我自己的（不是共享的）NSUserDefaults 对象的 KVO 和绑定问题

> ID：772538
> 
> 赞同：3
> 
> 时间：2009-04-21T13:17:03.287
> 
> 标签：objective-c, cocoa, cocoa-bindings, nsuserdefaults, key-value-observing

我在我的应用程序中继承 NSUserDefaults。这样做的副作用是我不能使用`[NSUserDefaults sharedUserDefaults]`，我必须有一个类方法来提供我自己的静态默认对象。这在代码中不是问题，但现在证明我正在将首选项 UI 与绑定连接起来很棘手。

共享的 NSUserDefaultsController 使用共享的默认值，所以就不行了。相反，我可以在我的窗口控制器中创建我自己的默认控制器，为它提供我的静态默认对象，并将我的绑定连接到它。但是，这并不完全有效。当我尝试在我的默认对象上使用 KVO 时，我没有收到任何更改通知。我使用常规的 NSUserDefaults 对象（不是子类）再次尝试了此操作，并且再次没有 KVO 通知。替换为共享默认对象，KVO 完全按照我的预期工作。

当我不使用共享默认值时，是否有人对我如何让绑定和 KVO 工作有任何想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T20:32:49.613

我总是用我自己的自定义类来包装 NSUserDefaults 的东西，以确保一切都按预期工作。

工作流程基本上是这样的：

1.  当应用程序启动时，将所有必需的 NSUserDefaults 条目读入自定义类。这个自定义类的每个设置都有一个属性，并且所有 NSDictionary 和 NSArray 对象都是可变的，因此可以进行更改。
2.  任何对设置进行更改的用户界面元素都绑定到自定义类的属性
3.  对设置的更改会根据需要保存到 NSUserDefaults。

我发现应用程序设置的这种封装有助于消除所有的麻烦。您无需直接处理 Apple 神奇的 NSUserDefaults 系统，而是将时间花在与定义明确且易于测试的自定义类进行交互上。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T16:12:46.657

我认为，文档提供了答案。该`init`方法初始化一个新实例，但不会在搜索路径中放置任何内容。如果您要初始化自己的实例，则需要手动设置您打算使用的域。我的猜测是您的应用程序无法正常工作，因为您尝试获取/设置的值不存在，因为没有域可以保存它们。

特别是，查看`addSuiteNamed:`方法和`NSUserDefaultsDomain`常量。您需要手动设置这些以使您的子类或`NSUserDefaults`除 之外的任何实例`standardUserDefaults`正常工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-21T21:30:35.247

我最近一直在做类似的事情，到目前为止我的运气还不错。我创建了一个标准的 NSObject 子类（参数为 MYUserDefaults）。它具有我想要的东西的属性（主机、用户名等）。有些转到 NSUserDefaults，有些转到钥匙串等。它有一个标准的`+sharedUserDefaults`单例方法。(*)

在窗口所有者（NSWindowController 或 AppDelegate）中，我提供了一个`-sharedUserDefaults`. 然后我通过一个简单的密钥路径（sharedUserDefaults.host）将其绑定到我想要的设置。我通常避免在绑定中使用键路径，因为它们经常混淆事物，但在这里我认为它可以在处理需要防止 NIB 创建额外的非单例版本的特殊情况时保持一切清晰。

(*) 没有花哨的“[强制单身](http://developer.apple.com/iphone/library/documentation/Cocoa/Conceptual/CocoaFundamentals/CocoaObjects/CocoaObjects.html#//apple_ref/doc/uid/TP40002974-CH4-SW32)”的东西（这也可能解决你的问题）。我是唯一一个认为 Apple 应该在这个文档上大闪“除非你知道为什么需要它，否则不要使用它，否则不要使用它”的人？我发现让没有经验的开发人员看到的代码很危险。我上一个项目中的一半对象已经`+allocWithZone:`超载。对我来说，调用`+alloc`并获取指向现有对象的指针只是一种糟糕的形式。除非绝对必要，否则不要对我撒谎。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-08T20:26:28.130

由于我还没有找到解决方案，所以我决定接受在上次 CocoaHeads Syracuse 会议上给我的一些建议，并改用使用类别而不是继承 NSUserDefaults。不是一个完美的解决方案，但它会让我克服这个问题并重新开始工作。

# java - Retrieving session ID value from a JSF request

> ID：772541
> 
> 赞同：21
> 
> 时间：2009-04-21T13:17:48.667
> 
> 标签：java, session, jsf

How do I retrieve the session ID value inside a JSF managed bean?

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-04-21T13:26:39.410

```
FacesContext fCtx = FacesContext.getCurrentInstance();
HttpSession session = (HttpSession) fCtx.getExternalContext().getSession(false);
String sessionId = session.getId(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2019-02-13T15:15:07.863

你试试

```
{
String uuidFc = FacesContext.getCurrentInstance().getExternalContext().getSessionId(true);
} 
```

此行返回 facesContext sessionId 值

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2022-02-16T16:07:14.367

您还可以使用[OmniFaces JSF 实用程序库](https://omnifaces.org/)。

```
String sessionId = Faces.getSessionId(); 
```

添加这个作为答案，因为如果你使用 JSF，你很可能会使用这个库。

# proxy - Adobe AIR 在哪里寻找 Ubuntu Linux 中的代理设置

> ID：772547
> 
> 赞同：1
> 
> 时间：2009-04-21T13:19:20.850
> 
> 标签：proxy, networking, air

我正在构建一个 AIR 应用程序，它可以调用公司网络中的远程服务器

Adobe AIr 运行时似乎正在查看操作系统的代理设置。我已将该位置添加到我的用户 ID 下 bashrc 中的 No_proxy 变量中。

每当我调用`adl`运行代码时，它似乎正在访问代理服务器，导致超时问题和 `Actionscript ioError 2032`

Adobe AIR 运行时似乎正在访问的 Ubuntu Ibex 中的代理设置在哪里，我们可以添加一个`no_proxy`以避免访问代理服务器

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-08-13T10:49:38.653

来自[阿舒托什·夏尔马](http://blogs.adobe.com/ashutosh/2008/07/air_and_proxies_on_linux.html)：

> 我们决定使用当前桌面环境的代理设置，并可以选择使用环境变量覆盖这些设置。
> 
> 在 KDE 上，可以使用 kcontrol（KDE 控制中心）设置代理设置。在 GNOME 上，可以使用 gnome-network-preferences（或直接使用 gconf-editor）设置这些。

我刚刚发现，通常必须手动设置代理，而不是使用 .pac 文件。

# c# - 使用 LINQ to SQL 读取存储过程

> ID：772550
> 
> 赞同：1
> 
> 时间：2009-04-21T13:19:45.857
> 
> 标签：c#, linq-to-sql, stored-procedures

有谁知道使用 LINQ to SQL 访问存储过程文本的方法？我想审核一组存储过程，以检查它们是否都包含一些通用代码。

感觉应该有一种通过 LINQ to SQL 数据上下文打开它们的好方法，但我不知道如何。有什么建议么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-21T13:23:21.323

您可以尝试以下方法：

```
string results = db.ExecuteQuery<string>
(@"EXEC sp_helptext '{0}'", procedure_name); 
```

或在您的 LINQ 中使用此查询：

```
SELECT text
FROM syscomments
WHERE id = (SELECT id FROM sysobjects WHERE name = 'procedure_name')
ORDER BY colid 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-21T13:26:32.657

我猜你正在使用 SQL Server。

要检索存储过程的文本，您需要执行[sp_helptext](http://technet.microsoft.com/en-us/library/ms176112.aspx)系统存储过程。

要了解如何从 Linq 执行存储过程，您可以查看[此](http://weblogs.asp.net/scottgu/archive/2007/08/16/linq-to-sql-part-6-retrieving-data-using-stored-procedures.aspx)内容。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-21T13:24:40.337

我不确定这是一个非常适合 LINQ-to-SQL 的任务——但你大概可以从类似的东西中获取文本[`syscomments`](http://msdn.microsoft.com/en-us/library/aa260393(SQL.80).aspx)——但是，这可能会被混淆。我会亲自再次运行我的代码存储库而不是数据库的测试。

# java - 如何使用持久层建模好友系统？

> ID：772553
> 
> 赞同：2
> 
> 时间：2009-04-21T13:21:08.800
> 
> 标签：java, google-app-engine, jpa, persistence

嗨，我正在尝试对谷歌应用引擎的新 Java 支持，并且我正在尝试为我的所有对象创建一个持久层。我正在尝试建立朋友关系模型，但遇到了问题。我使用 JPA 来持久化对象并使用 JPA 注释定义我的持久性对象。

我的想法是执行以下操作：

用户对象：

```
@Entity
public class User  {

@Column(name="user_id")
@Id
@GeneratedValue(strategy = GenerationType.IDENTITY) 
@Extension(vendorName="datanucleus", key="gae.encoded-pk", value="true") 
private String id;

@OneToMany(cascade={CascadeType.ALL},mappedBy="invitee")
private List<Connection> IncConnections;

@OneToMany(cascade={CascadeType.ALL},mappedBy="initiator")
private List<Connection> OutConnections;
} 
```

.

```
@Entity
public class Connection {

@Column(name="connection_id")
@Id
@GeneratedValue(strategy = GenerationType.IDENTITY) 
@Extension(vendorName="datanucleus", key="gae.encoded-pk", value="true") 
private String id;

@ManyToOne(cascade={CascadeType.ALL})
User initiator;

@ManyToOne(cascade={CascadeType.ALL})
User invitee;
} 
```

但是当我尝试这个时，我得到了错误：App Engine ORM does not support multiple parent key provider fields

那么有没有人有其他想法如何在不使用多个父键的情况下为朋友系统建模？

希望有人能帮忙！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-21T14:00:54.027

一般来说，您必须自己与 GAE 保持任何关系。GAE 为此提供的最佳工具记录在其关于[无主关系](http://code.google.com/appengine/docs/java/datastore/relationships.html#Unowned_Relationships)的部分中。特别是，我相信关于“多对多”关系的部分是相关的。

从这些示例中，您似乎仍然需要自己完成大部分维护参照完整性的工作。因为它们可能位于不同的实体组中，所以您可能还必须拥有大量代码来处理可能破坏的关系。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-01-24T01:16:36.080

```
Using Objectify

class User { 
   @Id Long userId; 
   String email; 
} 

class UserFriendMap { 
   @Id Long id; 
   @Parent OKey<User> parent; 
   Set<OKey<User>> friend; // 5000 max
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-21T13:24:20.837

我从来没有真正将谷歌应用程序引擎用于项目，但你需要了解它的持久性的第一件事是它不是关系数据库。我相信它使用键值存储。

因此，在使用应用程序引擎时，您需要以不同的方式考虑持久性。

从文档中：

App Engine 实现不支持 JPA 接口的以下功能：

*   拥有多对多关系和无拥有关系。您可以使用显式 Key 值实现无主关系，但 API 中不强制执行类型检查。
*   “加入”查询。在对父种类执行查询时，您不能在过滤器中使用子实体的字段。请注意，您可以使用键直接在查询中测试父级的关系字段。
*   聚合查询（group by、having、sum、avg、max、min）
*   多态查询。您不能通过查询类来获取子类的实例。每个类都由数据存储区中的一个单独的实体类型表示。

[http://code.google.com/appengine/docs/java/datastore/usingjpa.html](http://code.google.com/appengine/docs/java/datastore/usingjpa.html)

# asp.net-mvc - 为什么谷歌机器人在抓取我的网站时会收到 NullReferenceException？

> ID：772558
> 
> 赞同：1
> 
> 时间：2009-04-21T13:22:01.263
> 
> 标签：asp.net-mvc

我在我的 ASP.NET MVC 网站上安装了一些错误日志记录，当谷歌抓取我的网站时，我收到了很多 NullReferenceException 错误。

但是当我转到生成错误的 URL 时，有什么问题吗？

为什么会发生这种情况？为什么 google bot 会导致错误？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-21T13:23:59.700

需要 cookie 或会话或其他 Google 不支持的东西？您能否从事件日志中获得有关错误的更多信息？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T13:24:02.273

也许缺少 cookie 或推荐人？检查对可选 HTTP 标头的任何依赖性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T13:24:23.113

机器人不包含浏览器所做的很多事情。例如，您可能正在检查一个不存在的会话变量。

# sql-server - sql profiler 2008 在命令行启动中不接受模板名称

> ID：772560
> 
> 赞同：1
> 
> 时间：2009-04-21T13:22:08.830
> 
> 标签：sql-server, command-line, profiler, launch

我正在尝试从命令行启动启动 sql profiler 2008。我使用的语法：

C:\Program Files\Microsoft SQL Server\100\Tools\Binn>profiler90 /S *server* /D *dbname* /U sa /P *password* /T "C:\Documents and Settings\template.tdf"

实际结果：分析器打开，成功登录，但我仍然被迫选择一个模板。

预期结果：是否需要使用任何其他命令行参数来强制分析器占用指定的模板。

编辑：

GBN：感谢您的建议。

我做了以下更改 profiler90 更改为 profiler 将模板路径修改为： C:\Documents and Settings\myuser\Application Data\Microsoft\SQL Profiler\10.0\Templates\Microsoft SQL Server\100 **templatename**

上面指定的物理文件夹包含模板文件。

问题仍然存在

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T17:08:23.410

是的，正确的是 /t “模板名称”，而不是模板的物理文件名。谢谢！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T13:50:14.050

它是SQL Server 2008 中的“ [profiler](http://msdn.microsoft.com/en-us/library/ms162808.aspx) ”，SQL Server 2005 中的“ [profiler90 ”](http://msdn.microsoft.com/en-us/library/ms162808(SQL.90).aspx)

两者的 /T 开关说

> ...模板名称必须在系统模板目录或用户模板目录中。如果两个目录中存在同名的两个模板，则系统目录中的模板将被加载。如果不存在具有指定名称的模板，则将加载标准模板。请注意，不应将模板的文件扩展名 (.tdf) 指定为 template_name 的一部分。

因此，由于路径和扩展名，您的开关看起来是错误的。

编辑：

您是否只尝试过名称？：`.../T "templatename"...`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T14:30:58.070

GBN：感谢您的建议。

我做了以下更改 profiler90 更改为 profiler 将模板路径修改为： C:\Documents and Settings\myuser\Application Data\Microsoft\SQL Profiler\10.0\Templates\Microsoft SQL Server\100 **templatename**

上面指定的物理文件夹包含模板文件。

问题仍然存在

# apache-flex - SWF 不是可加载模块

> ID：772579
> 
> 赞同：3
> 
> 时间：2009-04-21T13:24:50.930
> 
> 标签：apache-flex, flash, crossdomain.xml

我们正在创建一个使用动态加载到主 swf 中的模块的应用程序。我们遇到的问题是，当我们在本地调试主应用程序时，我们无法加载位于测试服务器上的模块。我们得到的错误是“SWF 不是可加载模块”。

我查了一下，发现我们需要服务器上的一个跨域文件，该文件授予从外部位置加载模块的权限。所以我们创建了一个简单的跨域文件并将其放在服务器上，但这似乎没有帮助。

这是跨域文件：

```
<cross-domain-policy>
  <allow-access-from domain="*"/>
</cross-domain-policy> 
```

我们通过 ModuleLoader 类和所有默认设置加载模块，没有自定义应用程序域等。当我们将主 swf 部署到服务器上时，我们能够毫无问题地加载模块。

有什么线索吗？跨域文件是否可能缺少某些设置？

**更新**：似乎外部模块已成功加载（我可以在我的 HTTP 嗅探器中验证）但在主应用程序中加载时无法初始化。错误仍然是“SWF 不是可加载模块）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-12T15:25:40.893

这是 Adob​​e JIRA 提出的建议：http: [//bugs.adobe.com/jira/browse/SDK-15393](http://bugs.adobe.com/jira/browse/SDK-15393)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T13:48:25.803

我认为 Adob​​e 尝试访问端口 843 上的跨域文件，如果它无法连接/找到该端口上的文件，它会尝试您尝试连接的端口（如果是 http，则可能是 80）。不确定，但您可能需要检查以确保您的服务器允许访问该文件。

另外值得一提的是，您应该允许完全访问本地 swf 应用程序所在的目录。使用 Adob​​e 设置管理器执行此操作：http: [//www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html](http://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html)

*作为旁注，我认为设置管理器是 Flash 生态系统中最糟糕的 UI 暴行之一。只是他们需要在经理下方的文本中澄清这实际上不是屏幕截图的事实真的很重要。*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-21T14:23:46.683

我同意这可能是本地 SWF 和远程 SWF 之间的问题。尝试将本地文件上传到服务器（您有权访问的任何服务器），或者，如果您有本地 Apache 或 IIS 正在运行，请尝试使用[http://localhost/](http://localhost/)访问该 SWF 。如果可行，我们就会知道问题出在本地文件和远程文件之间。如果不是，则问题出在 crossdomain.xml 或您的代码中，这不太可能，但我们现在不应该排除它。如果您确定问题出在使用本地 SWF，请在设置管理器中添加本地文件夹（请参阅 macke 的帖子）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-08-26T01:19:26.057

这是根据 Adob​​e 的建议捆绑在一起的可供使用的解决方案。

[http://aaronhardy.com/flex/loading-a-remote-module-into-a-local-app/](http://aaronhardy.com/flex/loading-a-remote-module-into-a-local-app/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-21T13:42:50.777

看起来类似于我的跨域

```
<?xml version="1.0"?>
<!DOCTYPE cross-domain-policy 
  SYSTEM "http://www.macromedia.com/xml/dtds/cross-domain-policy.dtd">
<cross-domain-policy>
  <allow-access-from domain="*" />
</cross-domain-policy> 
```

那是在您的本地服务器根目录上，对吗？

你检查过你的目录权限吗？

# security - 白帽程序员的黑帽知识

> ID：772596
> 
> 赞同：72
> 
> 时间：2009-04-21T13:29:35.630
> 
> 标签：security

当诚实的开发人员学习黑帽黑客的技术时，非程序员总是持怀疑态度。显然，我们需要学习他们的许多技巧，这样我们才能将自己的安全性保持在标准水平。

你认为一个诚实的程序员需要在多大程度上了解恶意程序员的方法？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-04-21T13:39:01.893

归根结底，“黑帽”所知道的一切都不是犯罪知识，而是知识的应用方式。作为程序员，对任何技术都有深刻的理解是很有价值的，这是我们如何充分利用系统的方式。这些天可能在不了解深度的情况下度过难关，因为我们有越来越多的框架、库和组件是使用这些知识编写的，这样您就不必了解所有内容，但不时挖掘仍然是件好事。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-04-21T14:01:13.277

我会有点异端，并且四肢走出来说：

*   您确实需要与保护他们机器的系统管理员/网络人员交谈。这些人每天都在处理闯入的概念，并且总是在寻找可以用来对付他们的潜在漏洞。在大多数情况下，请忽略攻击者如何思考的“动机”方面，因为“为了恶名而进行黑客攻击”的日子早已一去不复返了。而是专注于*方法论*。一个称职的管理员将能够轻松地证明这一点。

当您编写程序时，您正在向 ${whatever-else-accepts-your-programs-I/O} 呈现（希望）无缝、流畅的界面。在这种情况下，它可能是最终用户，也可能是另一台机器上的另一个进程，但这并不重要。 **始终假设您的应用程序的“客户端”可能是敌对的，无论它是机器还是人。**

不相信我？尝试编写一个从销售人员那里接收销售订单的小型应用程序，然后制定一个需要通过该应用程序执行的公司规则，但销售人员一直在试图绕过，以便他们可以赚更多的钱。仅这个小练习就将展示一个有动机的攻击者——在这种情况下，*是预期的最终用户*——将如何积极寻找利用逻辑缺陷或通过其他方式博弈系统的方法。 *这些都是值得信赖的最终用户！*

多人在线游戏一直在与作弊者作战，因为服​​务器软件通常信任客户端；在所有情况下，客户端都可能*并且将会*被黑客入侵，导致玩家在系统上玩游戏。想一想——我们这里的人只是在享受自己，他们会用极端的手段在不涉及赚钱的活动中占据上风。

试想一下，以这种方式谋生的专业僵尸牧民的动机......编写恶意软件，以便他们可以使用其他人的机器作为收入来源，将他们的僵尸网络出售给出价最高的人以应对大规模垃圾邮件泛滥......是的，[这](http://en.wikipedia.org/wiki/Botnet) [确实会](http://www.cio.com/article/print/117150) [发生](http://news.cnet.com/8301-10789_3-9907939-57.html)。

不管动机如何，重点仍然存在，您的程序可能并且在某些时候会受到攻击。仅仅防止[缓冲区溢出](http://en.wikipedia.org/wiki/Buffer_overflow)，[堆栈粉碎](http://en.wikipedia.org/wiki/Stack-smashing_protection#Attacks_that_cannot_be_protected_against)，堆栈执行（代码作为数据被加载到堆栈中，然后返回以卸载堆栈，导致代码执行），[数据执行](http://en.wikipedia.org/wiki/Data_Execution_Prevention)，[跨站点是不够的脚本](http://en.wikipedia.org/wiki/Cross-site_scripting),[权限 提升](http://en.wikipedia.org/wiki/Privilege_escalation),[竞争 条件](http://en.wikipedia.org/wiki/Race_condition)，或其他“程序化”攻击，尽管它确实有帮助。除了您的“标准”程序防御之外，您还需要考虑信任、验证、身份和凭证——换句话说，处理提供程序输入和消耗程序输出的任何内容。例如，如何从程序化的角度防御[DNS 中毒？](http://en.wikipedia.org/wiki/DNS_cache_poisoning)有时，你无法避免代码中的事情——让你的最终用户不要将他们的密码交给同事就是一个例子。

将这些概念纳入安全*方法*，而不是“技术”。 [安全是一个过程，而不是一个产品](http://www.schneier.com/crypto-gram-0005.html#1)。当你开始思考你的程序的“另一面”是什么，以及你可以用来缓解这些问题的*方法*时，你会更清楚什么是正确的，什么是*可怕*的错误。

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2009-05-04T01:32:21.817

我来晚了，因为我刚刚在播客上听说过。但是，我将作为曾在一家软件公司的安全团队工作过的人发表我的看法。

实际上，我们非常重视开发人员教育，我们会为尽可能多的开发人员团队提供安全开发方面的基础培训。考虑安全性确实需要从正常开发的思维转变，因此我们会尝试让开发人员以“如何破解事物”的思维框架进行思考。我们使用的一种道具是带有数字键盘的家用保险箱之一。我们会让开发人员从里到外检查它，试图想出一种方法来闯入它。（解决方案是在保险柜顶部施加压力的同时给保险柜顶部一个尖锐的撞击，这会导致螺栓在螺线管中的弹簧上弹跳。）虽然我们不会给他们特定的黑帽技术，但我们会谈论导致这些漏洞的实施错误——尤其是他们以前可能没有遇到过的事情，比如整数溢出或编译器优化函数调用（比如 memset 清除密码）。我们在内部发布了每月安全通讯，邀请开发人员在小代码示例中发现与安全相关的错误，这肯定表明他们会错过多少。

我们还尝试遵循 Microsoft 的安全开发生命周期，这将涉及让开发人员谈论他们的产品架构并找出资产以及攻击这些资产的可能方法。

对于主要是前开发人员的安全团队来说，了解黑帽技术对我们来说非常重要。我们负责的一件事是接收来自第三方的安全警报，并且知道黑帽利用某些弱点是多么困难是分类和调查过程的重要组成部分。是的，有时这涉及到我逐步通过调试器来计算易受攻击的例程的内存偏移量并修补二进制可执行文件。

然而，真正的问题是其中很多超出了开发人员的能力。任何规模合理的公司都会有许多擅长编写代码但没有安全意识的开发人员。因此，我对您的问题的回答是：期望所有开发人员都具备黑帽知识将是一个不受欢迎且有害的负担，但是您公司中的*某个人*应该具备这种知识，无论是安全审计和响应团队，还是只是高级开发人员.

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2009-04-21T13:31:51.770

很大程度上来说。你需要像罪犯一样思考，否则你还不够偏执。

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2009-04-21T13:38:52.207

> 你认为一个诚实的程序员需要在多大程度上了解恶意程序员的方法？

你需要比他们了解*更多*。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2009-04-21T13:35:46.770

我确实是一名安全人员而不是开发人员，根据我的经验，我可以简单地说，除非这是你的第二职业，否则你无法像黑帽或专业白帽那样学习东西。实在是太费时间了。

最重要的是看到一些坏人或专业人士采取行动并了解不安全代码的可能性和影响。

因此，通过学习一些技巧，但其中很多技巧可能会让人们产生“虚假的安全感”，因为他或她不会破解。尽管技术更好的攻击者可能会在几分钟内破解相同的东西。

话虽如此，只要你记住这一点，我认为学习一些攻击是很好的，学习如何破解东西很有趣并且很有教育意义。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2009-04-22T13:24:15.477

绝对要学习黑暗的一面。即使你不学习实际的技术，至少也要努力学习什么是可能的。

[![替代文字](https://i.stack.imgur.com/ZN7Rw.jpg)](https://i.stack.imgur.com/ZN7Rw.jpg) [![替代文字](https://i.stack.imgur.com/91ZE5.jpg)](https://i.stack.imgur.com/91ZE5.jpg)

学习交易技巧的好资源是[Reversing: Secrets of Reverse Engineering](https://rads.stackoverflow.com/amzn/click/com/0764574817) and [Hacking: The Art of Exploitation](https://rads.stackoverflow.com/amzn/click/com/1593271441)。它们是为双方编写的——它们可以用来学习如何破解，但它们也提供了防止此类攻击的方法。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2009-04-21T13:37:39.370

像“鸽子一样纯洁，像蛇一样聪明”并学习那些怀有邪恶目的的人会做的技术是值得的。也就是说，应该谨慎使用这些知识。“拥有权利的同时也被赋予了重大的责任”。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2009-04-29T23:37:30.830

提醒一句：[俄勒冈州 vs. Randal Schwartz](http://en.wikipedia.org/wiki/Randal_L._Schwartz)。

作为调查我们网站上两起不同事件的一小部分，我想说在利用漏洞被用于攻击您之前了解它的可能性微乎其微。也许如果您将自己的职业生涯奉献给白帽子，那么您将掌握大多数流行的硬件/软件堆栈中的所有潜在漏洞。但是对于一个普通的程序员来说，你更有可能处于反应模式。

您确实有责任了解您自己的软件如何被黑客入侵，并有责任与第三方软件保持合理的最新状态。制定应对攻击的应急计划会很好，尤其是当您是高知名度或高价值目标时。有些地方会想要立即关闭一个漏洞，但我们的网站倾向于留下某些漏洞以帮助执法部门抓住肇事者。IT 安全团队偶尔会在内部宣布将进行端口扫描，以便 SA 不会对此感到恐慌。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-04-21T13:34:15.213

[为邪恶而设计](http://www.codinghorror.com/blog/archives/001123.html)。“善为哑，恶终必胜。”

简而言之，如果你不像罪犯那样思考，那并不意味着罪犯不会。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2009-04-21T13:34:23.900

我个人看不出技术上的区别。当然动机不同，但技术游戏是相同的。这就像问“好人”需要了解什么样的战争。

答案就是全部，即使他们没有积极练习。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2009-04-21T13:40:36.803

我认为“防御性编码”的一部分包括了解恶意技术，但与此同时，您不一定需要了解所有技术才能有效地防御它们。例如，了解缓冲区溢出攻击并不是尝试保护缓冲区不溢出的原因。您可以保护它们免于溢出，因为如果它们溢出，它可能会对您的程序造成严重破坏，无论它是错误还是攻击。

如果您编写的代码经过彻底检查且架构良好，那么恶意攻击将无法渗透，因为良好的架构应该自动锁定副作用和未经授权的访问。

然而，最后一段假设我们有一个完美的工作，我们有大量的时间来使我们的代码*恰到好处*。既然这样的工作不存在，那么了解恶意技术是一个很好的捷径，因为这意味着尽管您的代码并不完美，但您可以为这些漏洞创建“un-workarounds”以确保它们不会得到通过。但是，这些不会使代码更好，也不会使应用程序更好。

归根结底，了解恶意攻击是一件好事，但只要确保遵守最佳实践，就可以涵盖其中的 95%。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2009-04-23T19:29:01.850

一项经常被忽视的技能是社会工程学。

许多人根本不知道他们什么时候被骗了。在之前的一家公司，一位副总裁进行了一项测试，让三名（女性）临时工在会议室呼叫程序员和系统管理员，并根据脚本工作，试图让某人授予访问权限或泄露密码。每个临时工都可以在通话的第一个小时内获得一些东西。

我敢打赌，如果在任何一家大中型公司进行类似的测试，他们都会得到相同的结果。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2009-04-21T14:44:39.067

白帽需要学习的技术之一是如何在社会工程方面进行测试/缓解/思考，因为最大的安全威胁是人。

白帽擅长操纵比特，但黑帽更经常操纵人。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-04-21T14:14:12.620

我们白帽子和灰帽子需要擅长一百万件事那些黑帽子和小子只需要在一件事上取得成功

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-04-22T22:20:07.700

我将采取有争议的立场，并说有一些黑帽知识，你不需要成为一个好的白帽黑客。医生不需要知道如何对病毒进行基因改造以有效治疗疾病。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-04-29T21:14:13.920

基本上，黑客使用的所有安全漏洞都是由糟糕的编程风格或学科引入的代码中的错误。如果您编写代码来防止不良数据和无效调用操作，您将阻止代码中的大多数安全漏洞。

如果您有兴趣保护您的代码免受黑客攻击/滥用/等。你会花太多时间在上面。只需购买一个包裹以保护基础知识，然后继续前进。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-04-21T13:40:37.693

您必须了解“坏人”使用的方法，因此必须有所了解。

对于普通开发人员来说，我认为了解他们所做工作的基本原理就足够了，以避免在他们的项目中产生漏洞。

对于在安全相关领域工作的人（想到银行，或来自网上商店的信用卡数据），需要更深入的了解。这些开发人员需要深入了解“坏人”的运作方式以及他使用的技术。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-04-21T13:51:24.530

通过学习他们的方式，他开始朝着他们的方向思考。然后他必须选择他想“属于”哪一方。

技术本身并没有恶意……知识是纯粹的……你如何使用它决定了如何看待它。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-04-22T13:07:40.073

同一枚硬币的两面。除了意图——还有什么问题？相同的技能，不同的实施。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-11-23T07:14:33.730

当我听到黑帽这个词时，我会想到一个利用计算机知识闯入银行并做其他恶作剧的人。白帽知道黑帽知道的*一切*，但不会做任何坏事。

因此，您不*关心*或不*知道*什么是“黑帽”是安全的......

当您已经是等效的白帽时，了解黑帽的*想法*对蹲下没有帮助。这就像知道，“约翰想闯入我的房子并偷走我的 iPod 音乐”。如果您真的关心您的 iPod 音乐，那么无论如何您都应该确保它是安全的。

# objective-c - @package 指令在 Objective-C 中的作用是什么？

> ID：772600
> 
> 赞同：65
> 
> 时间：2009-04-21T13:30:34.083
> 
> 标签：objective-c

有谁知道 @package 指令在 Objective-C 中的用途是什么？

在 Stephen Kochan 的 Programming in Objective-C 2.0 中我能找到的唯一提及是：

> @package - 对于 64 位图像，可以在图像中实现类的任何位置访问实例变量

...

什么？这是否仅限于与图像一起使用，如在图片中？或者它是否意味着磁盘映像中的映像？

这是一个令人困惑的描述，并且在本书的其余部分都没有详细说明......

任何帮助都会很棒，谢谢！

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-04-21T13:39:12.797

`@package`类似于`internal`.NET。这意味着该成员只能从定义它的框架中访问。

注意：在 32 位中，它的行为类似于`@public`.

* * *

## 回答 #2

> 赞同：44
> 
> 时间：2011-11-05T21:29:21.453

[Apple 的文档](http://developer.apple.com/library/mac/#releasenotes/Cocoa/RN-ObjectiveC/index.html)对此进行了一些解释，但这里有更多详细信息……</p>

在下面声明的实例变量`@package`只能由来自同一框架、库或可执行文件的代码访问。`internal`这与C# 和VB.NET最相似`Friend`，但其他编程语言也有类似的保护方案（Java 有`package-private`）。

例如，想象一个`RecipeKit.framework`用于管理食谱的框架：

```
@interface Recipe : NSObject {
  @package;
    NSString *name;
  @private;
    NSArray *ingredients;
}
@end

@interface RecipeController : NSObject
@end 
```

配方控制器将能够直接访问配方名称。您可以在中编写类似的内容，`RecipeController`因为它是同一框架的一部分：

```
Recipe *recipe = [[[Recipe alloc] init] autorelease];
[recipe->name autorelease];
recipe->name = [@"The best ever recipe!" retain]; 
```

但是，如果您要在链接到 的应用程序中编写上述代码`RecipeKit`，则会导致编译器错误，因为您无权访问该变量。最后，当编译为 32 位时，声明在 under 下的变量的`@package`行为就好像它们是在 under 下声明的一样`@public`，因此请注意此处的差异。

这个新特性很少受到关注，因为它只是打破类封装的另一种方式。与往常一样，您最好`@private`只使用变量并为它们设置访问器方法。事实上，有一段时间，Apple 试图通过将其包含`@private`在模板中来推动这一点。使用 Objective-C 2.0 中的属性，坚持`@private`很容易，并且根据您的目标平台，您可以[完全省略实例变量](https://stackoverflow.com/questions/4511700/synthesizing-a-property-without-instance-variables)。

* * *

### 图片

之前的一些答案有点不清楚的一件事是解决原始问题中的图像方面。实际上，`@package`变量描述中使用的图像一词与图形图像无关。相反，它指的是动态链接器能够加载的图像。通常可执行文件、框架和动态库都被链接器视为图像（尽管它们的处理方式略有不同）。您会不时看到单词 image 弹出。例如，一个常见的运行时错误是：“找不到 dyld 图像”。您还会发现散布在`dyld`. 阅读手册页`dyld`可以帮助澄清这个词的歧义。`UIImage`可以将变量声明为`@package`，但它与图像无关，因为它与原始问题有关。

# nhibernate - NHibernate：想要更改的插入/更新行为

> ID：772605
> 
> 赞同：0
> 
> 时间：2009-04-21T13:31:57.917
> 
> 标签：nhibernate

我有一个 A 类，其中包含一个像这样映射的 B 列表

```
<class name="A" table="CLASS_A">
    ...
    <idbag name="ListOfB"
           table="CLASS_A_CLASS_B"
           cascade="save-update">
      <collection-id column="ID" type="Guid">   <!-- surrogate key -->
        <generator class="guid.comb"/>
      </collection-id>
      <key column="ID_A"/>
      <many-to-many column="ID_B" class="B"/>
    </idbag>
</class> 
```

在数据库方面，CLASS_A 和 CLASS_B 表之间有一个多对多连接 CLASS_A_CLASS_B 表，并且它有一个 ID 代理键。多对多关系没有映射到 B 类的对象模型中。

最初，假设我在 ListOfB 中有对象 X1 和 X2。如果我删除 X2 并插入 X3，我注意到 NHibernate 将更新指向 X2 的外键以使其指向 X3。

这是一个很好的优化。

然而，出于我的目的，我想欺骗 NHibernate 进行删除，然后在 M2M 连接表中进行新插入（删除 X2 的行，插入 X3 的新行）。我想要这样，因为这些表被复制到我们应用程序的另一个实例中，并且我们向用户显示插入/更新/删除的差异。

在这种特殊情况下，用例实际上是“我删除了 X2 并添加了 X3”，所以我希望 diff 显示这个事实（而不是更新）。我知道这种行为不是最理想的，但在这种情况下并不重要。

有什么方法可以欺骗 NHibernate 这样做吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T13:37:15.157

一种次优方法是删除 X2 刷新会话，然后添加 X3。我相信 nHibernate 会将其视为两个单独的操作，而不是优化它们。

您还可以尝试`<sql-delete></sql-delete>`在映射文件中指定：操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T12:31:10.473

谢谢，我没有考虑冲洗。它绝对应该可以正常工作。

昨天晚些时候，我无法再次触发这种行为......

# jquery - jQuery 循环遍历 data() 对象

> ID：772608
> 
> 赞同：25
> 
> 时间：2009-04-21T13:32:55.153
> 
> 标签：jquery, loops, each

是否可以循环遍历`data()`对象？

假设这是我的代码：

```
$('#mydiv').data('bar','lorem');  
$('#mydiv').data('foo','ipsum');  
$('#mydiv').data('cam','dolores'); 
```

我该如何循环呢？可以`each()`用于这个吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2010-06-01T20:09:20.217

```
$.each($.data(this), function(i, e) {
   alert('name='+ i + ' value=' +e);
}); 
```

这将遍历“this”元素的数据对象中的每个属性。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-04-21T13:49:33.273

jQuery 将所有数据信息存储在 jQuery.cache 内部变量中。使用这个简单但有用的插件可以获取与特定对象关联的所有数据：

```
jQuery.fn.allData = function() {
    var intID = jQuery.data(this.get(0));
    return(jQuery.cache[intID]);
}; 
```

有了这个，你可以这样做：

```
$('#myelement').data('test1','yay1')
               .data('test2','yay2')
               .data('test3','yay3');

$.each($('#myelement').allData(), function(key, value) {
    alert(key + "=" + value);
}); 
```

您可以只使用 matt b 的建议，但这就是您现在所拥有的方法。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2010-06-24T13:07:33.733

使用 jQuery 1.4 和来自@user292614 的提示进行了测试，以下工作：

```
$('#mydiv').data('bar','lorem');  
$('#mydiv').data('foo','ipsum');  
$('#mydiv').data('cam','dolores');

$.each( $('#mydiv').data(),function(i, e) {
   alert('name='+ i + ' value=' +e);
}); 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-04-21T13:42:54.020

我不认为有任何函数可以为您提供已添加该`data()`函数的数据的所有“键”，但是，为什么不将所有数据放入对象/映射下的函数中呢？

像这样的东西：

```
var container = new Object();
container.bar = "lorem";
container.foo = "ipsum";
container.cam = "dolores";
$("mydiv").data("container", container); 
```

然后当你想读取数据/遍历它时：

```
var blah = $("mydiv").data("container");
for(key in blah) {
    var value = blah[key];
    //do whatever you want with the data, such as:
    console.log("The value of ", key, " is ", value);
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-11-16T09:56:34.450

我刚刚尝试过，但需要一些额外的数据值。如果您也遇到了这个“问题”，那么以下应该可以工作。

```
$('#mydiv').data('bar', {name:'lorem', id:'156', price:'199'}); 
```

那么您可以简单地使用值 id 进行扩展

```
$.each( $('#mydiv').data(),function(i, e) {
   alert('name='+ i + ' name=' +e.name + ' id='e.id + ' price=' + e.price );
}); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-04-10T04:33:18.863

如果我们使用 .data() 意味着它存储与匹配元素关联的任意数据，或者在命名数据存储中返回匹配元素集中第一个元素的值。

如果 .data() 在循环中，所以我们必须在循环中以相同的方式访问它，例如（下）

```
<p class="weekday" data-today="monday">Monday</p>
<p class="weekday" data-today="tuesday">Tuesday</p>
<p class="weekday" data-today="wednesday">Wednesday</p>
<p class="weekday" data-today="thursday">Thursday</p> 
```

我循环中的 html 并且`data-today`在所有标签中都是相同的，但它们的值不同，所以基本上它是循环生成的`html`，所以我们必须以相同的方式访问，即循环`js/jQuery`输入例如`(below jQuery code)`

`$('.weekday').each(function(){ $(this).data('today'); });`

`OutPut :`

```
Monday
Tuesday
Wednesday
Thursday 
```

注意：在浏览器控制台中，它返回特定`<DIV>`的 .

# .net - 在当前窗口之外显示工具提示

> ID：772624
> 
> 赞同：1
> 
> 时间：2009-04-21T13:36:22.617
> 
> 标签：.net, wpf, winapi, visual-c++

我有 .NET WPF 应用程序，其中一项要求是用户可以在我的应用程序之外选择和复制文本。我的应用程序必须响应剪贴板事件。从字典中查找单词，然后在所选文本旁边显示带有单词翻译的工具提示。

据我了解，这必须使用对 Windows API 的调用来完成。

我找到了完成此任务的示例代码。

[http://www.codeproject.com/KB/miscctrl/tooltipzen.aspx?fid=4069&df=90&mpp=25&noise=3&sort=Position&view=Quick&fr=26](http://www.codeproject.com/KB/miscctrl/tooltipzen.aspx?fid=4069&df=90&mpp=25&noise=3&sort=Position&view=Quick&fr=26)

我的第一个想法是将这个示例转换为我可以从 .NET 应用程序调用的库（基本上我的库将包含 2 个方法：显示和隐藏工具提示）。不幸的是，我的 VC++ 知识几乎一无所有。

有没有其他方法可以解决这个问题？

非常感谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-21T14:10:26.327

工具提示并没有什么神奇之处——它们只是带有细边框、没有标题、淡黄色背景且始终处于顶部样式的窗口。

您可以轻松地在 WPF 中复制它们：

```
<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        ResizeMode="NoResize" 
        SizeToContent="WidthAndHeight"
        Background="Yellow" 
        WindowStyle="None" 
        Topmost="True">
    <Border BorderBrush="Black" BorderThickness="1">
        <TextBlock Text="Tooltip text"/>
    </Border>
</Window> 
```

现在您可以使用 Window 的所有方法和属性来移动、调整大小、显示和隐藏您的“工具提示”，作为奖励，您还可以在工具提示中插入更高级的上下文（图像、按钮、超链接、您的徽标）或制作它看起来更有趣。

# c# - Gridview 应用程序中的错误

> ID：772633
> 
> 赞同：1
> 
> 时间：2009-04-21T13:37:16.657
> 
> 标签：c#, asp.net, gridview, page-index-changed

在我的应用程序中尝试使用 GridView 的分页部分时，我收到以下错误：

> GridView 'GridView1' 触发了未处理的事件 PageIndexChanging。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-21T13:50:00.993

您需要添加一个事件处理程序来告诉 GridView 它应该查看哪个页面，因为我猜您已经在代码中完成了 .DataBind() 。一个例子是：

标记：

```
<asp:GridView ID="GridView1" runat="server"
    EnablePagingAndSortingCallbacks="true"
    OnPageIndexChanged="GridView1_PageIndexChanged" /> 
```

代码：

```
 protected void GridView1_PageIndexChanged(object sender,
                                              GridViewPageEventArgs e)
    {
        GridView1.PageIndex = e.NewPageIndex;
        GridView1.DataBind();
    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T14:13:54.977

我混合了你的答案，我得到了我的答案。我用这段代码解决了这个问题：

```
protected void GridView1_PageIndexChanging(object sender, GridViewPageEventArgs e)
{
    GridView1.PageIndex = e.NewPageIndex;
    DataBind();
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T13:45:42.110

这意味着与 gridview 关联的数据集不支持分页。

这并不意味着您不能使用它进行分页。为此，您需要在 PageIndexChanging 事件[中编写自己的代码。](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.pageindexchanging.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-22T02:37:09.573

对于这类问题，可以使用[自定义控件](http://www.codeproject.com/KB/grid/GenericGridViewWithPaging.aspx)

# asp.net-mvc - 是否有与 JSTL 标签等效的 ASP MVC？

> ID：772634
> 
> 赞同：5
> 
> 时间：2009-04-21T13:37:25.283
> 
> 标签：asp.net-mvc, jstl

是否有任何库支持 ASP MVC 视图中的 JSTL 样式编码？

我更喜欢

```
<c:forEach var="c" items="${Customers}">
  <c:out value="${c.Name}"/><br/ >
</c:forEach> 
```

到

```
<% foreach(Customer c in customers) { %>
  <%= c.Name %><br/ >
<% } %> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-07-10T05:55:58.787

是的，[Spark](https://github.com/SparkViewEngine/spark)可能是你的朋友。在精神上看起来很相似。

```
<c:forEach var="c" items="${Customers}">
  <c:out value="${c.Name}"/><br/ >
</c:forEach> 
```

变成

```
<for each="var c in Customers">
  ${c.Name}<br/>
</for> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T13:46:04.717

我所知道的最接近的是[Spark 视图引擎](https://github.com/SparkViewEngine/spark)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T15:26:40.097

最接近 JSTL 风格编码的视图引擎是：

*   [火花视图引擎](https://github.com/SparkViewEngine/spark)
*   [锋利的瓷砖](http://www.sharptiles.org/)

从 JSTL 的未来来看，Sharp 瓷砖在设备和学习曲线方面会更好

# nhibernate - 映射 hbm.xml

> ID：772637
> 
> 赞同：1
> 
> 时间：2009-04-21T13:37:57.170
> 
> 标签：nhibernate, nhibernate-mapping

我有一对多的关系，但我只想让一个实例具有一对一的关系。

我有一类车辆，一生中可能有几个车主。我只想映射类以获取资产。有没有办法做到这一点？

问题出在 hbm.xml 文件中。一辆车一生可能有几个车主，但我只想获得最后一个车主。我需要按 vehiculeId、ownerId 和 EndDate 过滤。我想用资产填充 vehicle.cs 中的对象所有者。

当我写：Vehicule v = VehiculeService.SearchVehicule(id);

我想 v.Owner 必须包含最后一辆车的所有者。

我无法将车主的 ID 存储在车辆表上，因为车主取决于日期。例如，我可以有： 车主 StartDate EndDate 1 1 04/04/2009 04/10/2009 1 2 05/10/2009 NULL

出于这个原因，我必须按 EndDate 过滤才能拥有资产

我有三个表：Vehicle、Owner 和 OwnerVehicle。问题是我必须在 vehicle.cs 中引用当前所有者。而且我不知道如何进行映射。

任何帮助，将不胜感激。谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-21T13:48:22.947

一种简单的映射方法是将其转换为多对一关系，并将当前所有者的 ID 存储在车辆表中。我知道这可能是架构更改。

解决这个问题的一种方法是创建一个视图，该视图本质上是车辆表，加上它会拉出当前的 ownerid。这样您就不必更改架构，然后您将映射到视图而不是表。

我不确定在这种情况下定义自己的加载器是否可行，但它是另一种探索的选择。

# 编辑

我理解你的预测。最简单的方法是修改架构和应用程序以添加此附加列，其中一种方法是使用视图来伪造它。所以例如

```
select vehicle.*, owner.ownerid
from vehicle
inner join owner 
  on owner.vehicleid=vehicle.vehicle
and owner.enddate is null 
```

我在这里假设当前所有者的结束日期为空。现在您将映射更改为映射到视图而不是表。是的，这是一个 hack，但它会起作用。

我假设您仍然需要在 nHibernate 中映射所有者？另一种选择是在所有者的类映射上添加 where 过滤器以过滤结束日期为空的位置。

另一个选择是加载所有所有者，并将定义当前所有者的业务规则推送到应用程序层。您的对象可能如下所示：

```
public Owner CurrentOwner
{
    get 
    {
        return _owners.Find(o=>o.EndDate==DateTime.Min); //Or null if your using a nullable datetime
     }
    set 
    {
        CurrentOwner.EndDate=DateTime.Now;
        _owners.Add(value);
    }
} 
```

}

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T13:52:05.700

您可以在执行搜索时使用 Criteria（或 Spring 的 DetachedCriteria）对象来限制附加值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T13:59:41.330

我建议在业务层中维护此引用并将其映射为多对一关系。我的意思是你在你的代码中明确地设置了这个引用。这使您还可以直接找到当前所有者的车辆。

例子：

```
<class name="Vehicle">
  <map name=AllOwners" >
  ...
  </map>

  <many-to-one name="CurrentOwner" ...>
</class>

public class Vehicle
{
  IList<Owner> AllOwners { get; private set; }
  Owner CurrentOwner { get; set; }
}

public void SetNewOwner(Vehicle v, Owner o)
{
  v.AllOwners.Add(o);
  v.CurrentOwner = o;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T14:03:37.483

你的关系实际上是多对多的

一个车主可以拥有多辆车

我会将车辆和所有者分开并在另一个实体中管理他们的关系换句话说 - 你需要三个表

不确定我是否更改了您的问题或提供了答案:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-21T15:41:55.810

我认为 NHibernate 不可能自动加载“所有者”属性。但是，您应该能够编写查询来获取车辆的当前所有者。看起来您已经有了一个带有`VehiculeService`. 我会添加一个类似的方法`GetCurrentOwner()`，它需要一个参数，即车辆的 ID。然后让您的`Vehicle.Owner`属性通过传入自己的 ID 来调用此方法。

基于条件的查询可能如下所示：

```
session.CreateCriteria(typeof(Owner))
    .CreateCriteria("OwnedVehicles") // Property path to the OwnerVehicle join table
        .Add(Expression.IsNull("EndDate"))
        .CreateCriteria("Vehicle")
            .Add(Expression.IdEq(id))
            .UniqueResult<Owner>(); 
```

# wpf - Silverlight/WPF 多对多复选框绑定列表

> ID：772653
> 
> 赞同：1
> 
> 时间：2009-04-21T13:43:00.697
> 
> 标签：wpf, silverlight, entity-framework, data-binding, many-to-many

我有一个具有多对多关系的实体模型。为简单起见，假设它是一个汽车实体和一个功能（CD 播放器、天窗等）实体。

我有一个 Silverlight/WPF 表单，您可以在其中编辑汽车实体。我想让可能的功能列表（功能表中的所有内容）成为复选框列表。那部分很容易。但是，我正在尝试一种优雅的方式来绑定复选框，以便当我选中、取消选中其中一个复选框时，它会添加/删除该功能与汽车之间的关联。

我知道这可以很容易地用老式的 WinForms 风格的事件处理程序来完成，但我想知道是否有人可以使用数据绑定来做到这一点，以便我仍然可以保持我的演示文稿和我的逻辑分开

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T15:04:46.913

你看过[MVVM](http://msdn.microsoft.com/en-us/magazine/dd419663.aspx)演示模式吗？

我建议创建一个要绑定的 ViewModel 类。此类可以包含属性，例如`HasSunroof`要绑定到的复选框。在这些属性的 set 方法中，它们可以更改相关属性（如`Sunroof`属性）。

另一种方法是使用`IValueConverter`. 绑定到实际属性（比如`Sunroof`）。在转换器中，如果 的值`Sunroof`不等于 null，则返回 true（选中），否则返回 false。( `ConvertBack`) 函数可以将 IsChecked 等于 true 的情况转换为属性所需的对象。

# c++ - 计算单个派生类的实例

> ID：772655
> 
> 赞同：4
> 
> 时间：2009-04-21T13:43:27.607
> 
> 标签：c++

我希望能够计算属于同一类层次结构的类的实例。

例如，假设我有这个：

```
class A;
class B: public A;
class C: public B; 
```

然后我有这个代码

```
A* tempA = new A;
B* tempB = new B;
C* tempC = new C;
C* tempC2 = new C;

printf(tempA->GetInstancesCount());
printf(tempB->GetInstancesCount());
printf(tempC->GetInstancesCount()); 
```

结果应该打印
1
1
2

理想情况下，计数应该在内部完成。每个类，而不是某种管理器，应该知道它有多少个实例。

有任何想法吗？

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-21T13:54:20.313

提出的解决方案存在一个问题：当您创建 B 时，您的 A 构造函数将被自动调用，从而增加 A 的计数。

```
class A
{
public:
    A(bool doCount = true)
    {
        if (doCount)
            ++instanceCount_;
    }

    static std::size_t GetInstanceCount()
    {
        return instanceCount_;
    }

    virtual ~A(){}
private:
    static std::size_t instanceCount_;
};

class B: public A
{
public:
    B(bool doCount = true):A(false)
    {
        if (doCount)
            ++instanceCount_;
    }

    static std::size_t GetInstanceCount()
    {
        return instanceCount_;
    }
private:
    static std::size_t instanceCount_;
};

std::size_t A::instanceCount_ = 0;
std::size_t B::instanceCount_ = 0; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-21T13:48:35.443

直接离开我的头：

*   在每个类中创建一个整数静态字段。注意整数溢出。
*   [在模拟的静态构造函数](http://www.cpptalk.net/emulating-a-static-constructor-vt12077.html)中将其初始化为 0 。
*   在每个（非静态）构造函数主体处增加它。在析构函数中减少它。
*   GetInstancesCount() 是一个静态函数，它返回整数静态字段的值。

**注意：**见 Mykola 的评论。这将为 A 打印 4，为 B 打印 3，为 C 打印 2，即它将一个 B 实例计算为“一个 A 和一个 B”，一个 C 计算为“一个 A，一个 B 和一个 C”。这在某种程度上是正确的，但不是问题所要求的。换句话说，我的答案是错误的:)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-21T13:55:04.180

有点“奇怪地重复出现的模板模式”。

```
template<typename P>
class Counter
{
    public: Counter(bool inc)
        :m_wasInc(inc)
    {
        if (m_wasInc)
        {   getCount()++;}
    }
           ~Counter()
    {
        if (m_wasInc)
        {   getCount()--;}
    }
    static std::size_t GetInstancesCount()
    {
         return getCount();
    }
    private:
       bool m_wasInc;
       /*
        * Alternatively this can be a static member variable.
        * I just used a function because this means I do not need to declare
        * the variable for each type class. The down size is that it becomes
        * more complex if used in the presence of a DLL's.
        *
        * But that is way easy to change. See Alternative Version below.
        */
       static std::size_t& getCount()
       {
           static std::size_t count = 0;
           return count;
       }
};

class A: public Counter<A>
{
    public: A(bool count = true): Counter<A>(count){}
};

class B: public A,Counter<B>
{
    public: B(bool count = true): A(false), Counter<B>(count){}
};

class C: public A, Counter<C>
{
    public: C(bool count = true): A(false), Counter<C>(count){}
};

template<typename P>
class CounterAlt
{
    public: CounterAlt()
    {    ++count;
    }
    static std::size_t GetInstancesCount()
    {
         return count;
    }
    private:
       static std::size_t count;
};

class D: public CounterAlt<D>
{
};
std::size_t CounterAlt<D>::count = 0; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-21T13:49:54.317

`static`为每个类使用一个成员变量。

```
struct A {
    A() { mInstances++; }
    ~A() { mInstances--; }
    static size_t mInstances;
    static size_t GetInstancesCount() { return mInstances; }
};

size_t A::mInstances;

int main() {
    A* a = new A;
    A* aa = new A;
    cout << A::GetInstancesCount() << endl;
    delete a;
    delete aa;
    cout << A::GetInstancesCount() << endl;
    return 0;
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-21T13:55:24.397

一个非常粗略的方法是：

```
class A
{
public:
    static int m_instanceCount;
    A(bool derivedInstance = false)
    {
        if(! derivedInstance)
        {
            ++m_instanceCount;
        }
    }
    virtual ~A()
    {
        --m_instanceCount;
    }
    virtual int GetInstanceCount()
    {
        return m_instanceCount;
    }
};

int A::m_instanceCount = 0;

class B : public A
{
public:
    static int m_instanceCount;
    B(bool derivedInstance = false): A(true) 
    {
        if(! derivedInstance)
        {
            ++m_instanceCount;
        }
    }
    virtual ~B()
    {
        --m_instanceCount;
    }
    virtual int GetInstanceCount()
    {
        return m_instanceCount;
    }
};

int B::m_instanceCount = 0;

class C : public B
{
public:
    static int m_instanceCount;
    C(): B(true) {++m_instanceCount;}
    virtual ~C()
    {
        --m_instanceCount;
    }
    virtual int GetInstanceCount()
    {
        return m_instanceCount;
    }
};

int C::m_instanceCount = 0;

void main(int argc,char *argv[])
{   
    A* p1 = new A;
    B* p2 = new B;
    C* p3 = new C;
    C* p4 = new C;
    A* p5 = new A;

    delete p5;

    std::cout<<p1->GetInstanceCount()<<"\n";
    std::cout<<p2->GetInstanceCount()<<"\n";
    std::cout<<p3->GetInstanceCount()<<"\n";
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-21T14:00:12.390

这是一个简单的计数器，我经常使用它们进行调试：

```
// counter.hpp
#ifndef COUNTER_HPP
#define COUNTER_HPP

template <typename T>
class Counter
{
public:
    Counter( bool do_count = true ) : counted(do_count) 
    { if ( counted ) get_count()++; }
    ~Counter() { if (counted) --count_; }

    static unsigned long count() { return count_; }
    static unsigned long& get_count() { 
       static unsigned long count=0;
       return count;
    }
private:
    bool do_count;
};
#endif 
```

用法很简单，直接继承即可：

```
class BaseClass : public Counter<BaseClass>
{
public:
   explicit BaseClass( bool do_count = true ) 
      : Counter<BaseClass>( do_count )
   {}
};
class DerivedClass : public BaseClass, Counter<DerivedClass>
{
public:
   explicit DerivedClass( bool do_count = true )
      : BaseClass(false), Counter<DerivedClass>(do_count)
   {}
}; 
```

用户代码将调用无参数构造函数：

```
int main() {
   BaseClass b; // will call Counter<BaseClass>(true)
   DerivedClass d; // will call Counter<BaseClass>(false), Counter<DerivedClass>(true)
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-21T16:04:06.240

在构造函数中计算对象时避免重复计算的一种方法是使用 RTTI 在需要时而不是在构造函数中计算对象。这是最低限度的侵入：

```
#include <vector>
#include <typeinfo>
#include <iostream>
#include <functional>

class A
{

public:

    A();
    virtual ~A() { }

};

class B: public A
{

public:

    virtual ~B() { }
};

class C: public B
{

public:

    virtual ~C() { }

};

template<class T>
struct TypeIdsEqual: public std::binary_function<T, T, bool>
{
    bool operator() (const T& obj1, const T& obj2) const
    {
        return typeid(*obj1) == typeid(*obj2);
    }
};

struct Counter
{
    static std::vector<A*> objects;

    static void add(A* obj)
    {
        objects.push_back(obj);
    }

    static int count(A* obj)
    {
        return std::count_if(objects.begin(), objects.end(),
                             std::bind1st(TypeIdsEqual<A*>(), obj));
    }

};

std::vector<A*> Counter::objects;

// One intrusive line in the base class constructor.  None in derived classes...
A::A()
{
    Counter::add(this);
}

int main(int *argc, char* argv[])
{
    A* a  = new A;
    B* b  = new B;
    C* c  = new C;
    C* c2 = new C;
    std::cout << Counter::count(*a) << std::endl;  // Output: 1
    std::cout << Counter::count(*b) << std::endl;  // Output: 1
    std::cout << Counter::count(*c) << std::endl;  // Output: 2
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-21T14:08:16.237

通过工厂创建类，以便工厂能够跟踪已创建的类。

不像在课堂上调用 new 那样干净，但它可以满足你的需要。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-21T15:08:30.120

当前的解决方案似乎都计入构造函数，因此也计入基类型的构造函数。（Mykola 除外，但该解决方案具有从 bool 的隐式转换 - 不好）这种重复计算是不希望的。然而，棘手的部分是*在*派生类型的构造过程中，对象临时具有中间基类型。而有了虚拟基类，这种情况就更糟了。在这种情况下，中间类型甚至都没有明确定义。

忽略这种瞬态，重复计算有一些解决方案：

*   使用标志禁用计数
*   使用不计算在内的受保护基类构造函数
*   减少派生构造函数中基类的实例数 '*(this->base::count)--`
*   将计数保存在专用的虚拟基类中。

后一个选项（虚拟基类）可能是最好的；编译器将强制它从最终 ctor 初始化一次且仅一次。

```
class counter {
    template<typename T> struct perTypeCounter { static int count =  0; }
    int* count; // Points to perTypeCounter<MostDerived>::count

    protected:
    template<typename MostDerived> counter(MostDerived*) 
    {
        count = &perTypeCounter<MostDerived>::count;
        ++*count;
    }
    ~counter() { --*count; }
}; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-21T15:43:34.527

您可以使用虚拟继承来强制计数基类构造函数由每个超类构造函数调用，并且仅由该构造函数调用。这解决了重复计算问题。然后使用 RTTI 其余的：

```
#include <map>
#include <typeinfo>
#include <iostream>

struct type_info_less
{
    bool operator() (const std::type_info * t1, const std::type_info * t2) {
        return t1->before(*t2);
    }
};

struct InstCounter
{
    typedef std::map<const std::type_info *, size_t, type_info_less> CountMap;
    static CountMap countMap_;
    const std::type_info * my_type_;

    InstCounter(const std::type_info & type) : my_type_(&type){
        ++countMap_[my_type_];
    }

    ~InstCounter() {
        --countMap_[my_type_];
    }

    static size_t getCount(const std::type_info & type) {
        return countMap_[&type];
    }

    size_t getCount() {
        return countMap_[my_type_];
    }
};

InstCounter::CountMap InstCounter::countMap_;

struct A : public virtual InstCounter
{
    A() : InstCounter(typeid(A)) {}
};

struct B : public A
{
    B() : InstCounter(typeid(B)) {}
};

struct C : public B
{
    C() : InstCounter(typeid(C)) {}
};

int main(int argc, char * argv[])
{
    std::cout << "A: " << InstCounter::getCount(typeid(A)) << std::endl;
    std::cout << "B: " << InstCounter::getCount(typeid(B)) << std::endl;
    std::cout << "C: " << InstCounter::getCount(typeid(B)) << std::endl;

    {
        A a1, a2, a3;
        B b1;
        C c1, c2;

        std::cout << "A: " << InstCounter::getCount(typeid(A)) << std::endl;
        std::cout << "A: " << a1.getCount() << std::endl;
        std::cout << "B: " << InstCounter::getCount(typeid(B)) << std::endl;
        std::cout << "B: " << b1.getCount() << std::endl;
        std::cout << "C: " << InstCounter::getCount(typeid(C)) << std::endl;
        std::cout << "C: " << c1.getCount() << std::endl;
    }

    std::cout << "A: " << InstCounter::getCount(typeid(A)) << std::endl;
    std::cout << "B: " << InstCounter::getCount(typeid(B)) << std::endl;
    std::cout << "C: " << InstCounter::getCount(typeid(C)) << std::endl;

    return 0;
} 
```

这导致

```
A: 0
B: 0
C: 0
A: 3
A: 3
B: 1
B: 1
C: 2
C: 2
A: 0
B: 0
C: 0 
```

不幸的是，您必须存储每个实例的类型，因为在 InstCounter::getCount() 中调用 typeid(*this) 返回 InstCounter 的 type_info 而不是最派生的类型。（至少与VS2005）

注意：A、B 和 C 的每个构造函数都必须显式调用 InstCounter 构造函数，然后传入它们的 typeid。这样​​做有一个缺点，如果您为每个新子类复制并粘贴此代码，您可能会忘记更改参数输入ID。

更新以添加递减析构函数。

# ruby-on-rails - 从 ruby on rails time_select 帮助器输出中删除“：”？

> ID：772659
> 
> 赞同：4
> 
> 时间：2009-04-21T13:45:43.110
> 
> 标签：ruby-on-rails, ruby, helper, time-select

我想从 rails time_select 帮助器的输出中删除“：”。构建分钟选择框时，助手似乎会自动输出此内容。

有任何想法吗？

谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-21T19:16:47.587

这些助手的输出通常只是字符串，所以你应该能够说：

```
<%= time_select("post", "sunrise").gsub(/:/, ' ') %> 
```

[编辑]原来更清洁的解决方案就是说：

```
<%= time_select("post", "sunrise", :time_separator => "" %> 
```

# java - 在 Java 中扩展另一个类的类中有 2 个同名变量

> ID：772663
> 
> 赞同：18
> 
> 时间：2009-04-21T13:46:34.387
> 
> 标签：java, class, variables, scope, extends

以下是我的项目代码的一部分：

```
public class Body extends Point{
    public double x, y, mass;

    public Body() {
        x = y = mass = 0;
    }

    public Body(double x, double y, double mass) {
        this.mass = mass;
        this.x = x;
        this.y = y;
    }
}

public class Point {
    public double x;
    public double y;

    public Point(double x, double y) {
        this.x = x;
        this.y = y;
    }
} 
```

我很快意识到这样做会在 Body 类中创建**两个**名为 x 的变量，并在 Body 中创建另外两个名为 y 的变量。这怎么可能，为什么 Java 甚至允许它？

我认为这是类 Body 的正确代码：

```
public class Body extends Point{
    public double mass;

    public Body() {
        super();
        mass = 0;
    }

    public Body(double x, double y, double mass) {
        super(x,y);
        this.mass = mass;
    }
} 
```

谢谢你的时间

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-21T13:49:16.470

从某种意义上说，您正在覆盖超类的字段。但是由于没有字段重载（您只有一个给定名称的变量，类型无关紧要），因此意外地做起来要容易得多。这被称为变量“隐藏”或“阴影”。所以，你是对的，你最终会得到两个同名的字段。

你的第二个例子是正确的。它们是从超类继承的，并且由于它们没有被声明为私有的，因此它们对子类是可见的。直接引用超类的字段通常是不好的做法，除非有充分的理由，否则它们应该声明为私有的。您调用超级构造函数的示例是最好的方法。

此外，如果您隐藏了另一个同名字段，您仍然可以将它们称为 super.x、super.y、vs.this.x、this.y，您应该尽可能避免这种情况。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-21T13:52:11.393

是的，您将有两个变量，一个隐藏另一个。允许它是有道理的，原因有两个：

1.  假设你有一个作者不知道的基类`Base`和派生类。作者是否应该永远无法添加任何字段，仅仅因为派生类*可能*共享这些字段？还是应该在更改实际上不影响正确性时停止编译？`Derived``Base``Base`*`Derived``Base`*
**   您的字段几乎应该始终是私有的，此时名称是否重复并不重要——“一方”都不会知道另一方的变量。*

 ** * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-21T13:57:59.133

除了其他人所说的：是`Body`吗`Point`？不，`Body`有一个 position 类型的属性`Point`。所以`Body`大概不应该延长`Point`。如果你摆脱了继承（实现），那么你就摆脱了很多问题。那和使用`private`（不是`protected`！）和`final`自由。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-21T13:51:58.540

> 我很快意识到这样做会在 Body 类中创建两个名为 x 的变量，并在 Body 中创建另外两个名为 y 的变量。这怎么可能，为什么 Java 甚至允许它？

实际上不，您没有创建两个具有相同名称的变量，显然编译器不应该也不会允许这样做。

您*所做*的是隐藏定义为`x`和的现有变量`y`，这意味着 Body.x 和 Body.y 本质上与 Point.x 和 Point.y 的名称重叠，使得后两个变量完全无法从 Body 类中访问（[链接到“阴影”的 Java 语言规范定义](https://docs.oracle.com/javase/specs/jls/se8/html/jls-6.html#jls-6.4.1)）。

名称阴影通常被认为是一种不好的做法和错误的原因，如果您打开 javac 编译器警告，编译器将尽职尽责地警告您。

# delphi - 如何将组件帮助文件集成到Delphi系统中？

> ID：772664
> 
> 赞同：5
> 
> 时间：2009-04-21T13:46:39.193
> 
> 标签：delphi, chm, winhelp

如何将组件帮助文件集成到 Delphi 2006 帮助系统中，以便
在按 F1 时可以使用帮助。帮助文件采用 hlp 和 chm 格式。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-21T20:27:39.273

你没有。Delphi 2006 使用 HTML Help 2（与 D2007 和 D2009 一样），因此 IDE 不知道 HTML Help 1 文件。

您可以在 IDE 中创建一个工具菜单项来启动 CHM 帮助文件，然后在其中进行搜索，或者创建一个桌面快捷方式。但是，这些都不会为您提供 F1 上下文相关的帮助。

# vb.net - 动态创建的下拉列表 VB.NET 的更改事件

> ID：772672
> 
> 赞同：0
> 
> 时间：2009-04-21T13:48:55.787
> 
> 标签：vb.net, events, drop-down-menu, handler

我有一个网站，用户需要从主页添加和删除标题。标题存储在具有标题为“显示”（真或假）的列的数据库中，该列决定是否显示标题。我希望用户能够从主页添加或删除标题，因此创建了另一个页面，该页面创建了一个包含所有标题的表格以及一个包含“启用”和“禁用”的下拉列表。我希望这些下拉列表在用户更改下拉列表中的值时工作，数据库将被更新。只有我找不到如何为下拉列表提供更改事件。

有任何想法吗？我是否以正确的方式进行此操作，还是有更好的方法来做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T14:00:50.420

首先，执行您的实际请求您将下拉菜单设置为自动回发，并添加一个处理程序以获取值并更新数据，IE（尽管您的下拉菜单至少在转发器或数据网格中）

```
 Private Sub SetupDropdowns()
        Dim pDropDown As New DropDownList
        pDropDown.Items.Add("Yes")
        pDropDown.Items.Add("No")
        pDropDown.AutoPostBack = True
        AddHandler pDropDown.SelectedIndexChanged, AddressOf pDropDown_SelectedIndexChanged
    End Sub

    Private Sub pDropDown_SelectedIndexChanged(ByVal sender As Object, ByVal e As System.EventArgs)
        Dim value As String = CType(sender, DropDownList).SelectedValue
'Do something with value
    End Sub 
```

如果您直接访问 SQL，一种更简单的方法是使用数据网格并将其数据绑定到您的 SQL 查询。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T13:57:13.723

第一的; 我个人会使用复选框为真/假值提供用户界面。您可以通过两种方式处理此问题：使用 ASP.NET 控件 (<asp:CheckBox ... />) 或纯 HTML 控件 (<input type="checkbox" .../>)。

在使用 ASP.NET 控件的情况下，您可以简单地双击控件（在设计视图中），以便为您创建 CheckedChanged 事件的事件处理程序。在使用 HTML 输入元素的情况下，您需要使用 JavaScript 在客户端处理 onclick 事件，并让 JavaScript 进行 AJAX 调用或类似调用，以便服务器可以更新数据库。我会说 ASP.NET 方法更简单。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T13:58:48.413

很可能您最简单的方法是简单地使用 DataGrid，然后您可以轻松处理该事件。

作为替代方案，由于您只是在执行“显示”或“隐藏”选项，因此您可以只使用按钮，这可能会提供更好的 UI。（我发现这是真的，因为在某些浏览器中使用滚轮鼠标意外滚动了下拉列表项）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T14:19:16.523

在您创建下拉列表的代码中，添加以下内容：

```
''// You already have this code...

Dim oDropDown as New DropDown

''// Whatever other declarations you need...

AddHandler oDropDown.SelectedIndexChanged, _ 
AddressOf oDropDown_SelectedIndexChanged 
```

通常，您从工具箱向您的项目添加一个下拉菜单，您可以使用 codeview 下的下拉菜单选择 SelectedIndexChanged 事件。在这种情况下，我们必须手动执行此操作，因此请创建您的子例程：

```
Public Sub oDropDown_SelectedIndexChanged(ByVal sender As System.Object, ByVal e As System.EventArgs)
    ''// Do whatever you need to do here

    ''// I sometimes do this to make code manipulation easier:
    Dim _sender as DropDown = CType(sender, DropDown)

End Sub 
```

希望有帮助！

# ruby-on-rails - Rails 应用程序中的“Tab 顺序”

> ID：772677
> 
> 赞同：8
> 
> 时间：2009-04-21T13:49:35.550
> 
> 标签：ruby-on-rails

在 Rails 应用程序中，我希望用户无需使用鼠标即可输入数据。

为了帮助做到这一点，我想设置光标移动到文本字段、下拉框和按钮的顺序。

有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-06-08T18:52:03.543

杰夫彼得森几乎是对的。

```
<%= f.text_field :attribute, :tabindex => 1 %> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-05-02T19:34:15.233

```
<%= f.text_field :attribute, :tabindex => 1 %> 
```

然后是 2、3、4 等。

编辑：从“tab_index”中删除下划线。很近。

此外，您可以创建一个辅助方法来自动增加索引：

```
def tabindex
  @tabindex ||= 0
  @tabindex += 1
end 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-07-02T19:23:47.460

如果您使用的是 simple_form，则需要这样做：

```
<%= f.input :name, input_html: {:tabindex => 1} %> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-21T14:03:08.997

我不是 Rails 人，但我使用过其他 Web MVC 框架。只是一个警告:)

当您输出表单元素时，您应该能够为每个元素添加其他属性（例如类、onchange 等）。您可以通过为每个设置 tabindex 值来完成您想要的操作，并在执行过程中将其递增。生成的 html 看起来像这样：

```
<input type="text" id="myInput" tabindex=1 />
<select id="mySelect" tabIndex=2>
    <option id="myOpt1" value="someValue">Foo!</option>
</select> 
```

像这样的东西会做的工作。

另外，看起来[这个问题已经发布了](https://stackoverflow.com/questions/223984/automatic-method-to-set-the-tabindex-using-form-helpers):)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-21T14:02:32.273

我没有尝试过这样做（但也许我应该这样做）。无论如何，w3.org 有这个：[http](http://www.w3.org/TR/WCAG10-HTML-TECHS/#forms-keyboard-access) ://www.w3.org/TR/WCAG10-HTML-TECHS/#forms-keyboard-access简要描述了该`tabindex`属性的使用。我想你必须在你的控件上单独设置它，这会有点累，但并不可怕。

我不知道它是否会起作用，但您可能会考虑使用 100 的增量，这样就可以在现有控件之间进行添加，而无需每次都对整个控件列表重新排序。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-21T17:01:51.780

我不是 100% 确定，但我想您可以控制 Tab 功能来管理自己的订单。

在伪代码中会产生类似的东西

```
all_fields = ["field1","field2"]
current = 0
if catch event("tab pressed"){
 current = (current+1) %all_fields.size
 all_fields[current].focus
} 
```

使用键盘选择元素后，您可以键入任何内容或使用箭头浏览下拉菜单。

您也可以使用 tabindex [http://www.w3.org/TR/html401/interact/forms.html](http://www.w3.org/TR/html401/interact/forms.html)但我从未这样做过，所以我不确定它是否可以正常工作。

最后一个解决方案是将字段按照您希望人们编辑它们的顺序放置。

# javascript - Spring MVC JavaScript

> ID：772683
> 
> 赞同：5
> 
> 时间：2009-04-21T13:50:18.263
> 
> 标签：javascript, spring-mvc, spring

在 Spring MVC 应用程序中，将外部 JavaScript 文件与 jsps 一起放入 WEB-INF/ 的最佳方法是什么？

/WEB-INF/spring/foo.jsp 其中包含

```
 <script src="foo.js"></script>. 
```

我想要拥有 jsp 旁边的 WEB-INF/spring/ 目录中的 foo.js 吗？

我注意到 Spring 有一个 ResourceSerlvet，但我不确定这是否是这样做的方法......

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-21T14:46:28.673

无需将 javascript 文件放在 WEB-INF 下。您可以在 WAR 文件中具有如下结构：

```
.
js/
images/
WEB-INF/
WEB-INF/jsp 
```

WEB-INF\jsp 下的jsp文件通常会出现在应用程序的主上下文中，所以下面会起作用

```
<script type="text/javascript" src="js/foo.js"> 
```

如果您确实想将它们放在 WEB-INF 下，则需要添加另一层来为它们提供服务。可能最简单的方法是使用 JSP 包含标签：

```
<%@include file='js/foo.js'%> 
```

这会将文件的全部内容复制到生成的 html 中。您还可以通过使用适当的映射和设置内容类型直接提供 javascript 文件。

# map - 如何在 OpenLayers 中混合具有不同坐标系的图层？

> ID：772684
> 
> 赞同：3
> 
> 时间：2009-04-21T13:50:50.040
> 
> 标签：map, openlayers, mapserver, proj4js

我正在使用 OpenLayers 地图，我想在其中使用不同的地图服务器，这些地图服务器使用不同的坐标系。OpenLayers 可以将其集成到同一张地图中并自动转换坐标系吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-23T15:00:42.413

根据图层的不同，您将始终拥有某种无法真正转换的基础图层（地图）。如果您想在该地图上添加数据（标记、geo json 内容等），您必须将其转换为 baselayer 正在使用的投影。

对于标记，这可以通过以下方式轻松完成：

```
// defining our coordinate systems
var google = new OpenLayers.Projection("EPSG:900913"),
    latlon = new OpenLayers.Projection("EPSG:4326");

// transforming the location to the right coordinate system
var location = new OpenLayers.LonLat( 10, 10 ).transform( latlon, google );

// assuming you made an icon and marker layer
var marker = new OpenLayers.Marker( location, icon );     

markerLayer.addMarker( marker ); 
```

查看有关将位置从一个系统转换到另一个系统的 Openlayers 文档。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-11-19T13:47:10.543

如果地图服务器提供不同的栅格，那么您可能不走运。

但是，如果他们提供矢量（例如 KML 文件）或 JavaScript 编写的地图对象（例如 Dre 的答案），那么您可以在不同的投影之间进行转换，以便所有数据都出现在与底图相同的投影和坐标系上. OpenLayers 有这个钩子（参见 Dre 的答案），但您可能必须包含提供该功能的 Proj4JS 库。

或者您可以自己使用 Proj4JS 在绘图之前转换坐标。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-05-22T19:00:18.890

这是一个老问题，但我从搜索中发现了这个问题，并认为我可能会插话，以防这对其他人有帮助。

这可能与提出的问题所面临的情况有所不同，但我最近遇到了类似的情况。就我而言，我需要在一张地图上显示来自两个不同 WMS 提供商的输出。一个在 EPSG:900913 中提供服务，另一个在 EPSG:3857 中提供服务。知道这些[在功能上是等效](http://wiki.openstreetmap.org/wiki/EPSG:3857)的，我想如果我可以以使服务正常工作的方式请求它们，那么地图将能够与输出一起工作。我的地图位于 900913 中（因此其他服务默认要求使用此投影）。

我如何能够正确请求其他服务如下（填写您的信息）：

```
var myLayer = new OpenLayers.Layer.WMS(
    "Name",
    "URL", {
        "layer": "layer"
    });

myLayer.projection = "EPSG:3857"; 
```

通常附加`?request=getCapabilities`到服务 URL 后，您可以在所需层的 CRS 标记中查看服务中可用的投影。

# asp.net-mvc - 几个模型中的附件属性

> ID：772689
> 
> 赞同：0
> 
> 时间：2009-04-21T13:51:36.433
> 
> 标签：asp.net-mvc, linq-to-sql

我正在使用 ASP.NET MVC + LinqToSQL。

我的应用程序中有附件模型。我需要`<IEnumerate>Attachment Attachments`几个模型。我不是要为不同的父类创建不同的附件模型。有简单的方法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-21T19:35:41.817

您的意思是要在模型中的更多位置使用附件吗？例如 for`Employee`和 for`Customer`对象？你的意思是这样的：

```
public class Attachment { /* Various properties... */ }
public class Attachments : List<Attachment>
{
    public void DoSomething()
    {
        foreach (Attachment attachment in this)
            DoSomethingToAttachment(attachment);
    }
}
public interface IAttachmentHandler
{
    void HandleAttachments();
}
public class Employee : IAttachmentHandler
{
    private Attachments _attachments;
    public void HandleAttachments()
    {
        _attachments.DoSomething();
    }
}

public class Customer : IAttachmentHandler
{
    private Attachments _attachments;
    public void HandleAttachments()
    {
        _attachments.DoSomething();
    }
}
```

# c++ - 做全局变量的正确“C++方式”是什么？

> ID：772709
> 
> 赞同：14
> 
> 时间：2009-04-21T13:58:20.317
> 
> 标签：c++, design-patterns, oop

我有一个主应用程序类，其中包含一个记录器，以及一些通用应用程序配置等。

现在我将显示很多 GUI 窗口等（将使用记录器和配置），并且我不想将记录器和配置传递给每个构造函数。

我见过一些变体，比如到处声明主类 extern，但感觉不是很面向对象。使所有（或大多数）其他类可以访问主类中的元素的“标准” C++ 方法是什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-21T14:00:23.853

使用[单例设计模式](http://en.wikipedia.org/wiki/Singleton_pattern)。

基本上，您返回一个对象的静态实例并将其用于您的所有工作。

请参阅[有关如何使用单例的](http://www.ibm.com/developerworks/webservices/library/co-single.html)链接以及[有关何时不应该使用它的 stackoverflow 链接](https://stackoverflow.com/questions/137975/what-is-so-bad-about-singletons)

警告：单例模式涉及提升全局状态。全局状态不好有很多原因。
例如：单元测试。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-21T14:03:00.947

如果您的 logger 和 config 足够抽象，那么将 logger 和 config 传递给所有构造函数并不是一个坏主意。

单例在未来可能会成为一个问题。但这似乎是项目开始时的正确选择。你的选择。如果您的项目足够小 - 使用单例。如果不是 - 依赖注入。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-21T15:11:45.040

为什么不使用已经存在的系统？也就是说，重定向 std::clog 以输出到文件并写入 std::clog。

```
std::fstream *f = new std::fstream("./my_logfile.log")

std::clog.rdbuf(f->rdbuf());

std::clog << "Line of log information" << std::endl; 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-21T16:16:27.303

我同意某种单例方法。您绝对不想到处传递记录器对象。这很快就会变得非常无聊，恕我直言，这是一个比仅仅拥有一个普通的全局对象更糟糕的设计。

一个很好的测试你是否有一个好的解决方案是让日志记录在需要它的函数中工作所需的步骤。

如果你要做的远不止这些

```
#include "Logger.h"
...
void SomeFunction()
{
    ...
    LOGERROR << "SomeFunction is broken";   
    ...
}
... 
```

那你就是在浪费精力。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-25T08:36:20.907

[与面向方面的编程](http://en.wikipedia.org/wiki/Aspect-oriented_programming)一样，日志记录属于“关注点分离”的范畴

一般来说，日志不是对象的功能或关注点（例如，它不会改变对象的状态；它只是一种观察/记录状态的机制，并且在大多数情况下输出基本上是一次性的）它是一个短暂且通常是可选的辅助功能，对类的操作没有贡献。一个对象的方法可能会执行日志记录，但可能会在那里进行日志记录，因为它是一个方便的地方，或者代码执行流中的那个点是人们希望记录状态的地方。

因为 C++ 不提供定义方面的工具，所以我倾向于简单地将本质上的外部临时对象（如记录器）保持为全局，并将它们包装在命名空间中以包含它们。命名空间不是为了包含而设计的，所以这有点难看，但由于缺乏其他任何东西，它比在形式参数中传递记录器或在要记录的所有对象中引用它们更方便，而且远不那么难看和不方便。如果在某些时候我决定不再需要记录器（即，如果它仅用于调试），这也可以更容易地删除记录器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-21T14:09:00.090

不知道这对您的情况是否有帮助，但在 MFC 中，有一个应用程序类。

我过去常常把这样的东西扔进那个班级。

我假设您没有使用 MFC，但如果您有应用程序类或类似的东西，这可能会有所帮助。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-21T15:18:56.303

为什么不使用[log4cxx](http://logging.apache.org/log4cxx/index.html)？这些问题很久以前就解决了，并被许多人广泛使用。除非您正在构建自己的一些非常特殊的日志记录系统......在这种情况下，我会使用工厂模式，它会为任何感兴趣的人创建记录器（或者如果它是单例则放弃现有实例）。其他类将使用工厂来获取记录器。在构造函数参数中传递记录器是一个坏主意，因为它会将您的类与记录器结合起来。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-10T23:33:38.720

只需将您的主类传递给您想要访问“一切”的其他类的构造函数

然后，您可以通过成员属性提供对记录器等的访问权限。（原谅我的 C++ 语法，这只是一种虚构的语言，叫做“被 VB 混淆的 C++”）

例如

```
Class App {
     Private  m_logger;
     Private  m_config;

     Public logger() {
        return m_logger;
     }

     Public config() {
        return m_config
     }
}

Class Window1 {
     New( anApp ) {
     }
     ....
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-06-24T19:08:19.077

为什么没有人想到遗产和多态性？您也可以使用带有该单例的抽象工厂；）

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-04-21T14:00:26.273

我想[服务定位器](http://martinfowler.com/articles/injection.html#UsingAServiceLocator)会做。您必须在构造函数中传递，或者在某个众所周知的位置具有全局可访问的静态成员函数。前一种选择更可取。

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2009-04-21T15:03:18.227

我会避免单例模式。
测试方面的问题太多了（请参阅[单例有什么不好？](https://stackoverflow.com/questions/137975/what-is-so-bad-about-singletons)）

我个人会将记录器等传递给构造函数。或者，您可以使用工厂来创建/传递对资源的引用。

# linux - Perl 升级会破坏 Linux 上的旧版本吗？

> ID：772710
> 
> 赞同：1
> 
> 时间：2009-04-21T13:58:41.083
> 
> 标签：linux, perl, unix, upgrade

我在 Suse Linux 上将 perl 从 perl58 升级到 perl588。看起来即使旧版本的 Config.pm 存在，但新版本的安装会破坏旧版本。而在 HP 和 AIX 等其他操作系统上升级 Perl 不会干扰旧版本。例如： perl58 和 perl588 版本存在于文件夹中，例如“/usr/standard_perl”，如下所示：

```
/usr/standard_perl/perl58 (directory)
/usr/standard_perl/perl588 (directory) 
```

并有指向它的符号链接。

升级前后链接如下：

## 前：

```
perl58_link -> /usr/standard_perl/perl58 
```

## 后：

```
perl5_link ->   /usr/standard_perl/perl588 
perl58_link ->  /usr/standard_perl/perl588
perl588_link -> /usr/standard_perl/perl588 
```

现在，当我尝试从 /usr/standard_perl/perl58/bin 运行简单的“./perl -V”命令时，旧版本抱怨找不到 Config.pm，即使它很好地存在于它自己的树结构中。

是不是在 Linux 中，perl 遵循@INC 的硬编码路径。这种行为仅在 Linux 上观察到。

我担心我无法投入生产，因为有些脚本已经为旧版本运行，如果存在这种行为，我需要知道它是否可以修复或者这是 Linux 的已知行为。

我不确定这可能是因为现在升级后的旧链接被指向新版本，而仅仅链接是不够的，需要在 LINUX 上修改更多内容？

注意： 1\. perl 模块为每个版本单独维护 2\. 我没有将任何文件与以前的版本混合。3\. 我们希望所有在生产服务器中运行的旧 perl 脚本都不要破坏，而是使用最新版本来维护 Perl 版本。3a.因此需要调整指向最新版本而不是他们自己版本的链接。

观察：仅在 Linux 上看到此行为。值得注意的一点是，当我将旧版本的链接转换为最新版本时。@INC 会自动更新为最新版本的 INC，而不是在 LINUX 中。

我在这里错过了什么吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-21T21:06:44.953

我从未在 Linux 上看到过这个问题。我将原始 perl 留在其位置（/usr/bin/perl），并简单地编译我自己的 perl 以安装到 /usr/local/bin（或其他），并且从未见过旧版本的任何损坏。

你不说

*   你是如何拥有 /usr/standard_perl/perl588 的（编译的，以 rpm 格式或其他格式给出，预编译的 tarball，...）
*   配置编译时使用了哪些选项

您的详细信息也很模糊 - perl58_link、standard_perl 等 - 这真的在哪里？大多数时候这无关紧要，但有时确实如此。

如果您将链接移回，事情是否开始起作用？如果您将整个 5.8.8 树移到其他地方，事情会开始工作吗？你能从 RPM 或其他任何东西中恢复你的基本 perl 以使其工作吗？IMO，基本的 perl 工作是最重要的，辅助 perl 总是奖金。（我对其他核心 unix 工具持相同的看法，例如 shell、awk、sed 甚至 python 或您的发行版用于包管理的任何工具。对于 Java 等非核心工具而言，情况较少，但如果我正在运行 Java 应用程序在生产中，我也会在这里说同样的话。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T16:57:46.527

# 保留系统`perl`可执行文件，自行编译，并让您的 Perl 程序使用您编译的程序运行

## 用 Perl 编写的所有系统程序都应以：

```
#! /usr/bin/perl 
```

### 所有非系统 Perl 程序，用户编写的程序：

这将使用第一个在`$PATH`. （同' `which perl`'）

```
#! /usr/bin/env perl 
```

另一种选择是准确指定要使用的可执行文件的位置：

```
#! /opt/bin/perl

#! /opt/perl/bin/perl

#! /opt/perl/5.10.0/bin/perl

#! /opt/perl-5.10.0/bin/perl

#! /home/$user/perl/bin/perl

#! ~/bin/perl 
```

或者 perl 可执行文件的路径是什么。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-23T16:49:14.903

# `/usr/bin/perl`永远不要用你自己编译的替换！

我在 Ubuntu 7.10 上做过一次，它破坏了我的系统。例如，我可以登录并做大部分事情，但我无法更改外观。我最终`sudo nano $filename`在我计算机上的每个 Perl 程序上运行 ' '，并更改它们以便它们在 Perl 5.10 下运行，而不是在 Perl 5.8 下运行。

之后我不得不从头开始安装 Ubuntu 8.10，它终于出来了。

如果您使用`cpan`或`cpanp`安装模块，您也可能会遇到不兼容问题，因为它们可能具有不兼容的功能更改。对于非二进制兼容的`perl`可执行文件，您必须重新安装所有需要`XSubs`.

这就是为什么我编写的所有 Perl 程序都添加标题“ `#!/usr/bin/env perl`”，并将 Perl 可执行文件的路径添加到`$PATH`变量的开头。

# c - 什么时候从无序列表切换到有序列表？[优化]

> ID：772712
> 
> 赞同：1
> 
> 时间：2009-04-21T13:59:02.313
> 
> 标签：c, optimization, list, gpu

我必须实现一种算法来分解体素中的 3D 体积。该算法首先确定哪些顶点位于切割计划的每一侧，然后在第二步中哪条边穿过切割计划。

这个过程可以通过使用排序列表的好处来优化。识别分裂点是O log(n)。但是我必须为每个轴维护一个这样的排序列表，这个列表用于顶点和边。由于这是为了供 GPU 使用而实现的，所以我对内存管理（即 CUDA）也有一些限制。强加了侵入性列表 M/树和 C。

通过完整的“体素化”，我希望最终得到约 4000 个点和 12000 个边缘。幸运的是，这可以通过使用更智能的策略来优化，以摆脱处理过的体素并订购剩余体积切割以将其数量保持在最低限度。在这种情况下，我希望有少于 100 个点和 300 个边。这使得流程管理起来更加复杂，但最终可能会变得更加高效。

因此，问题是帮助我确定标准，以确定与简单的侵入式链接列表相比，使用排序数据结构的好处何时值得付出努力和复杂性开销。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-21T14:13:08.347

chmike，这听起来确实像是您想要先以更简单的方式做的事情，然后看看它的行为方式。一旦你至少进入大容量（你似乎没有），任何类型的 GPU 体素化方法都对系统细节非常脆弱。在你的鞋子里，我肯定首先想要简单的实现，如果没有其他原因要检查......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T15:21:08.577

这个问题总是归结为哪个运算符最常见，访问或添加。如果你有一个无序列表，添加它不需要时间，访问特定项目需要额外的时间。如果您有一个排序列表，添加到它需要更多时间，但访问它会更快。

大多数应用程序花费大部分时间访问数据，而不是添加数据，这意味着创建排序列表的（运行）时间开销通常会被访问列表所节省的时间平衡或覆盖。如果您的数据中有大量流失（听起来并不像这样），那么维护排序列表不一定是可取的，因为您将不断地将列表视为可观的 CPU 成本。

数据结构的复杂性只有在它们*不能*以有用的方式排序时才重要。如果它们可以被排序，那么你将不得不通过启发式

访问次数：更改次数

确定排序是否是一个好主意。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T17:52:54.240

在考虑了所有答案后，我发现后一种用于避免重复计算的方法最终效率会降低，因为需要在数据结构中进行维护和导航。此外，初始方法很容易与一些小的内核例程并行化，因此更适合 GPU 实现。

回顾我最初的方法，我还发现了重要的优化机会，这些机会使体积削减方法远远落后。

因为我必须选择一个答案，所以我选择了 devinb，因为他回答了这个问题，但是 Simon 的评论，得到了 Tobias Warre 评论的支持，对我来说同样有价值。

感谢大家帮我解决这个问题。堆栈溢出是一项令人印象深刻的服务。

# java - 从Java中的另一个类调用重绘？

> ID：772713
> 
> 赞同：5
> 
> 时间：2009-04-21T13:59:08.133
> 
> 标签：java, multithreading, swing, animation, timer

我可能做错了，所以请善待。我正在开发一个 Java 游戏，我正处于测试角色移动/动画的阶段。

“人”可以在网格上左右上下移动。绘制网格的类是 gamePanel 类。这些按钮位于 gameControlPanel 类中。

我有一个按钮，可以在网格上生成一个人。然后我有一个按钮可以左右上下移动这个人。

当按下上移按钮时，它会调用 person 类的上移方法。（目前，我一次只测试一个“人”。）在该方法中是以下代码......

```
int move = 10;
while(move!=0)
{
    setTopLeftPoint(new Point((int)getTopLeftPoint().getX(),
                              (int)getTopLeftPoint().getY() - 3));

    try
    {
        Thread.sleep(300);
    } catch (InterruptedException e)
    {
        // TODO Auto-generated catch block
        e.printStackTrace();
    }   
    move-=1;
} 
```

问题是我似乎无法从 Person 类中调用 gamePanel 类的重绘方法。为了解决这个问题，我在 gamePanel 类中创建了一个计时器，它每 20 毫秒重绘一次。

当我在人生成后按下向上按钮时，按钮保持按下状态，直到 while 循环的循环完成，然后人的圆形表示显示在上面的方格中。

我将尝试回答有关此的任何问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-21T14:51:31.313

repaint() 不会立即重新绘制 GUI。相反，它会向 AWT 线程发送一条消息，告诉它在下一个方便的机会进行绘制。当它有机会时，它会重新绘制你的应用程序。但是，如果您在事件处理程序中执行此操作，则 AWT 线程已经很忙，您需要退出处理程序以将控制权交还给 AWT 处理程序。

作为一般经验法则，您*不*希望在 AWT 线程（包括在事件处理程序中）上进行任何长时间运行的计算，因为这些会阻止应用程序响应其他事件，直到您的计算完成。这通常会像您所描述的那样向用户显示为卡住的按钮。要解决此问题，请使用可以在单独线程上进行计算的[SwingWorker 。](http://java.sun.com/javase/6/docs/api/javax/swing/SwingWorker.html)

最后，需要注意的一点（但不一定要改变）是计时器和睡眠不能保证它们何时会醒来。相反，他们保证他们不会在时间过去之前醒来，但理论上可以无限期地睡觉。此外，并非所有机器都有 1 ms 的计时器分辨率。特别是，在许多 Windows 机器上，计时器只有 55 毫秒的分辨率，因此 20 毫秒的计时器可能会产生奇怪的结果。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-23T16:53:20.620

如果你想在某个时间间隔重新绘制，`javax.swing.Timer`可能是适合你的课程。在特定情况下，`repaint`您可以从非 EDT 线程调用它，但您可能会遇到困难，因为您现在正在处理多个线程。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T14:08:12.977

我没有太多制作游戏的经验，但是有一个循环来控制所有动画是游戏编程的一个基本方面。大多数简单的 2d 游戏只有 1 个循环来渲染其大部分动画。

根据我的经验，渲染一大堆东西的好方法是在一个地方收集游戏中所有实体的集合，然后循环遍历这个集合，将 Graphics 对象传递给每个实体。

这将允许每个实体将自己绘制到图形对象上。虽然这只是一种方法。

```
synchronized ( entities ) {
    for ( Entity e : entities ) {
        e.draw( g );
        e.doAction();
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T14:31:53.810

按钮按下是否由 GUI 的事件调度线程处理？

如果是这种情况，那么 GUI 上的 repaint 方法将不会触发，直到事件调度线程结束（即当按钮被释放并且它跳出循环时）。我最近遇到了这个问题，我可以建议的最佳解决方案是使具有运动算法的类可线程化，并在检测到按键时触发线程。这允许事件调度线程完成，因此允许 gui 重新绘制。

有关线程的更多信息，请参阅[启动线程](http://java.sun.com/docs/books/tutorial/essential/concurrency/runthread.html)。

# javascript - 来自较大图像文件的质量更好的缩略图

> ID：772715
> 
> 赞同：2
> 
> 时间：2009-04-21T13:59:57.570
> 
> 标签：javascript, internet-explorer, firefox, image, resize

我将来自其他网站的图像显示为缩略图。为此，我将它们显示在一个较小的 img 标签中，以便浏览器减小尺寸。

问题是这些图像的质量（我无法控制）降低了。它们在 FF 和 Safari 中的外观也比在 IE 中好得多。

有没有办法让这些图像看起来更好，而不会将它们缓存在我的服务器上？（例如，以更好的质量调整大小的 javascript 库）？任何想法都受到高度赞赏。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-21T14:05:22.517

快速谷歌搜索显示，在 IE7 中您可以修复图像质量问题： [http ://devthought.com/tumble/2009/03/tip-high-quality-css-thumbnails-in-ie7/](http://devthought.com/tumble/2009/03/tip-high-quality-css-thumbnails-in-ie7/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-21T14:12:02.673

IE 的默认图像大小调整算法不是那么好 - 它可以通过调整注册表项来更改，但这当然不在您的控制范围内。

但是，显然也可以触发它通过 css 进行更好的图像调整大小

```
img { -ms-interpolation-mode: bicubic; } 
```

来源：[http ://edmondcho.com/blog/2009/03/17/internet-explorer-image-resizing-tip/](http://edmondcho.com/blog/2009/03/17/internet-explorer-image-resizing-tip/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-21T14:06:44.760

控制的唯一方法是自己调整大小。各种浏览器将使用不同的算法，有些使用不清晰的掩蔽，有些没有。调整大小后使用的过滤器控制了大部分。特定的 CSS 标记可以在一定程度上控制这一点。

Javascript 无法真正处理这个问题，但使用 Flash 或类似的东西可以做到这一点。您将更好地控制图像。但是，就 HTML 而言，您将失去“形象性”。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-21T14:18:43.797

我没有看到其他人提到的一件事 - 你并没有真正调整图像的大小，你只是在更小的空间中显示它。假设您正在拉下一个非常大的图像文件 (5MB) 并以 1 x 1 显示它 - 它仍然是 5MB！

为这些图像编写缓存解决方案一点也不难 - 并且会为您节省法律后果和尴尬。如果我在我的日志文件中看到您的网站并意识到您正在拉下我的图片，那么您将是 Goatse'd - 很难。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-21T14:03:00.260

如果您正在使用源图像并且只是在客户端上重新调整大小，则不会有一个好的方法来做到这一点。

现在，除了使用其他站点图像的潜在法律后果之外，您可以查看一个简单的缓存过程，并快速调整图像大小，并保持纵横比，以便显示良好。这也有助于减少您从其他站点使用的带宽。

# multithreading - 任何用于 Delphi 和 FreePascal 的多线程跨平台的库？

> ID：772723
> 
> 赞同：4
> 
> 时间：2009-04-21T14:00:38.300
> 
> 标签：multithreading, delphi, cross-platform, freepascal

我知道一些用于 Delphi 的 Windows 线程库（OmniThread Lib、BMThreads 等）。

但是是否有一个构建为跨平台并且可以在 Delphi 和 FreePascal 下使用的库？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-21T14:10:04.127

虽然这些本身不是线程库的链​​接，但以下页面上的信息可能（或可能不会）在研究 Windows/Linux 和 MACOSX 上的线程时有用

1.  [使用 Lazarus 进行多线程](http://wiki.lazarus.freepascal.org/Multithreaded_Application_Tutorial)。
2.  OSX 多线程论坛...[线程](http://www.pascalgamedevelopment.com/forum/index.php?topic=5310.0)。

抱歉，无法提供更具体的内容。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-02T09:45:08.653

FPC/Lazarus 和 Delphi 都支持 TThread。虽然 FPC 不支持 TMREWS（它确实有标识符，但它是一个简单的锁）。

但我假设你的意思是一些线程池类？你到底需要什么，为什么 Delphi 内置的支持不够？

# c# - C# 中的嵌套数据库事务

> ID：772729
> 
> 赞同：2
> 
> 时间：2009-04-21T14:01:44.663
> 
> 标签：c#, database

`DataBase Handler`我有一个基类，它声明了对实例（DBH）的私有非静态引用。

DBH 是我们用来简化派生类的数据库操作的一个类。它包含常用的方法，例如`ExecuteScalar`，`StartTransaction`等等；它在应用程序上下文中提供了额外的好处，例如缓存和`zero configuration`.

派生类的实例使用 DBH 在数据库中读取/保存其状态，并且由于它们的操作不是原子的，因此所有派生类都使用此事务。一切都在一个地方进行：`InsertUpdate()`在基类中声明的称为虚拟方法。

接下来，我有一个派生类实例的集合（称为 Book）。我想将收藏更新作为交易。

我想实现类似的东西：

```
DatabaseHandler dbh = new DatabaseHandler()

t = dbh.StartTrasaction();
foreach( Type o in Book<Type> ) 
{
    o.prop1 = ..
    o.prop2 = ...
    o.method1() ...

    o.InsertUpdate(t);  // uses its own instance of DatabaseHandler and starts its own transaction
}
dbh.EndTransaction(t); 
```

目前该`InsertUpdate`方法是无参数的。我想我将不得不介绍一个接受事务对象的重载版本。

除了解决我当前的问题，还有什么设计问题我需要知道吗？我怎样才能改进这个设计或制定一个更好的设计？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-21T14:11:33.407

你看过[System.Transactions](http://msdn.microsoft.com/en-us/library/system.transactions.aspx)命名空间吗？除非您出于某种原因已经对其进行了折扣，否则您可以利用那里提供的内置嵌套事务支持 - 例如：

```
 using (var scope = new TransactionScope())
  {
    // call a method here that uses a nested transaction
    someObject.SomeMethodThatAlsoUsesATransactionScope();

    scope.Complete();
  } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-21T22:25:33.530

确保你[阅读了这个问题](https://stackoverflow.com/questions/224689/transactions-in-net#224702)

Personally, I usually go with ["my own"](https://stackoverflow.com/questions/251603/passing-db-connection-object-to-methods/251726#251726) implementation of a TrasactionScope like object that wacks data on to TLS with the added benefit of having a factory that allows for easy profiling and logging.

To me your current design sound fairly complex. By decoupling your raw database access code from your classes it will reduce duplication (and avoid requiring all your data access classes inherit off a base class). Defining an object as opposed to a set of static methods for DB access will ease testing (you can substitute a mock class)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T14:07:22.807

如果更新都发生在同一个数据库连接上，那么嵌套事务将按预期工作。每个 InsertUpdate() 都将运行自己的事务，dbh 上的整体事务能够回滚整个事务。

# c# - 什么是字典压缩支持？

> ID：772730
> 
> 赞同：0
> 
> 时间：2009-04-21T14:01:50.200
> 
> 标签：c#

“这是没有任何压缩支持的字典的实现。”

这句话取自这里：http: [//blogs.msdn.com/jaredpar/archive/2009/03/03/building-a-weakreference-hashtable.aspx](http://blogs.msdn.com/jaredpar/archive/2009/03/03/building-a-weakreference-hashtable.aspx)

我知道 jaredpar 是这里的成员，并在 C# 部分发帖。究竟什么是“字典压缩支持”？我假设它是某种优化或使其更小的方法？但是如何（如果是这样的话）？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-21T14:07:02.090

对于那个特定的帖子，我指的是缩小字典，以便为未收集元素的数量提供更合适的大小。

在引擎盖下，大多数哈希表都由一个大数组支持，该数组通常指向另一个结构，例如链表。数组以初始化大小开始。当添加到哈希表中的元素数量超过某个阈值（比如数组中元素数量的 70%）时，哈希表会扩展。这通常涉及创建一个两倍大小的新数组并将值重新添加到新数组中。

弱引用哈希表的问题/特征之一是随着时间的推移收集元素。随着时间的推移，这可能会导致一些空间浪费。想象一下，您添加了足够的元素来完成这个数组加倍过程。随着时间的推移，其中一些被收集起来，现在剩余的元素可以适应以前的数组大小。

这不一定是一件坏事，但它是浪费空间。压缩是您实质上将哈希表的底层数据结构缩小到更适合数据大小的过程。

# apache-flex - Flex ColdFusion CFC 位置

> ID：772732
> 
> 赞同：3
> 
> 时间：2009-04-21T14:02:18.390
> 
> 标签：apache-flex, coldfusion, cfc

我是一名希望打入 Flex 的 ColdFusion 开发人员。我有几个正在测试的 Flex 应用程序，但在连接到我的 CFC 时遇到问题。我试过了：

*   在 CFAdmin 中创建映射，
*   将 CFC 与 Flex 应用程序放在同一文件夹中，
*   将 CFC 放在 C:\Coldfusion8\Gateway\CFC 文件夹中，

一切都无济于事。

每次，我都会收到“找不到 ColdFusion 组件或接口”错误。我错过了什么？

下面是我如何调用 CFC 以供 Flex 使用。

```
 <mx:RemoteObject id="conn" destination="ColdFusion" source="cfc.bulkmail"
    result="orderGrid.dataProvider = event.result;" showBusyCursor="true"> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-21T17:26:25.997

您还可以进入您的 remoting-config.xml 文件 ([coldfusionRoot]wwwroot\WEB-INF\flex) 并在您的冷融合实例上启用映射。默认情况下，不允许 Flex 使用映射来定位 cfc 实例。

```
<destination id="ColdFusion">
    <channels>
        <channel ref="my-cfamf"/>
    </channels>
    <properties>
        <source>*</source>
        <!-- define the resolution rules and access level of the cfc being invoked -->
        <access>
            <!-- Use the ColdFusion mappings to find CFCs, by default only CFC files under your webroot can be found. -->
            <use-mappings>false</use-mappings>
            <!-- allow "public and remote" or just "remote" methods to be invoked -->
            <method-access-level>remote</method-access-level>
        </access>

        <property-case>
            <!-- cfc property names -->
            <force-cfc-lowercase>false</force-cfc-lowercase>
            <!-- Query column names -->
            <force-query-lowercase>false</force-query-lowercase>
            <!-- struct keys -->
            <force-struct-lowercase>false</force-struct-lowercase>
        </property-case>
    </properties>
</destination> 
```

你看到的是默认的。将 use-mappings 键更改为 true，您的映射现在就可以工作了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T14:25:45.650

我在某些服务器上遇到了类似的问题。我认为这与您网站上的安全设置方式有关。我最终采取了简单的方法，使我的 CFC 方法可以远程访问，并将它们称为 WebServices。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T14:32:23.433

C:\Coldfusion8\wwwroot\Gateway\CFC 是正确的文件夹，而 cfc.bulkmail 是正确的来源。

它有效，我一定是在某个时候没有合适的案例。

但是，对于将来遇到同样问题的任何人来说，这都是答案。

# maven - 在 Maven 中跳过某些模块中的测试

> ID：772735
> 
> 赞同：72
> 
> 时间：2009-04-21T14:02:43.583
> 
> 标签：maven, unit-testing, junit, maven-2, build-process

我希望我的 Maven 构建能够运行大多数单元测试。但是一个项目中的单元测试速度较慢，我一般想将它们排除在外；并偶尔打开它们。

**问题**：我该怎么做？

我知道`-Dmaven.test.skip=true`，但这会关闭所有单元测试。

我也知道跳过集成测试，描述[在这里](http://docs.codehaus.org/display/MAVENUSER/Maven+and+Integration+Testing)。但是我没有集成测试，只有单元测试，而且我没有对 maven-surefire-plugin 的任何显式调用。（我将 Maven 2 与 Eclipse-Maven 插件一起使用）。

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2009-04-21T14:10:49.727

只在这个模块中跳过测试怎么样？

在这个模块的 pom.xml 中：

```
<project>
  [...]
  <build>
    <plugins>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-surefire-plugin</artifactId>
        <version>2.4.2</version>
        <configuration>
          <skipTests>true</skipTests>
        </configuration>
      </plugin>
    </plugins>
  </build>
  [...]
</project> 
```

最终，您可以创建一个禁用测试的配置文件（仍然是模块的 pom.xml）：

```
<project>
  [...]
  <profiles>
    <profile>
      <id>noTest</id>
      <activation>
        <property>
          <name>noTest</name>
          <value>true</value>
        </property>
      </activation>
      <build>
        <plugins>
          <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-surefire-plugin</artifactId>
            <version>2.4.2</version>
            <configuration>
              <skipTests>true</skipTests>
            </configuration>
          </plugin>
        </plugins>
      </build>
    </profile>
  </profiles>
  [...]
</project> 
```

使用后一种解决方案，如果您运行`mvn clean package`，它将运行所有测试。如果你运行`mvn clean package -DnoTest=true`，它不会运行这个模块的测试。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2010-03-11T15:21:48.483

我认为这更容易，并且还具有为不确定测试工作的好处（在我的情况下，FlexUnitTests）

```
<profile>
   <id>noTest</id>
    <properties>
       <maven.test.skip>true</maven.test.skip>
    </properties>
 </profile> 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2016-09-18T20:29:36.063

如果您有一个大型的多模块项目，并且您希望仅在某些模块中跳过测试，而无需`pom.xml`使用自定义配置和分析更改每个模块文件，您可以将以下内容添加到父`pom.xml`文件中：

```
<build>
    <plugins>
        <plugin>
            <groupId>org.codehaus.mojo</groupId>
            <artifactId>build-helper-maven-plugin</artifactId>
            <version>1.12</version>
            <executions>
                <execution>
                    <id>regex-property</id>
                    <goals>
                        <goal>regex-property</goal>
                    </goals>
                    <configuration>
                        <name>maven.test.skip</name>
                        <value>${project.artifactId}</value>
                        <regex>(module1)|(module3)</regex>
                        <replacement>true</replacement>
                        <failIfNoMatch>false</failIfNoMatch>
                    </configuration>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build>
<modules>
    <module>module1</module>
    <module>module2</module>
    <module>module3</module>
</modules> 
```

由于`build-helper-maven-plugin`您实际上会在构建过程中动态检查您是否在某个模块中，通过`project.artifactId`属性（在构建过程中指向每个`artifactId`模块），正则表达式然后会寻找某些值的匹配（您使用的模块名称）想要跳过测试）并`maven.test.skip`相应地填充属性（将其设置为`true`）。

在这种情况下，测试将被跳过`module1`并`module3`在正确运行时为`module2`，即如正则表达式所表示的那样。

这种方法的优点是使其动态和集中（在 parent 中`pom.xml`），因此更便于维护：您可以随时通过更改上面的简单正则表达式来添加或删除模块。

显然，如果这不是构建的默认行为（推荐的情况），您总是可以将上面的代码片段包装在[maven profile](http://maven.apache.org/guides/introduction/introduction-to-profiles.html)中。

* * *

您还可以更进一步，根据您的输入进行动态行为：

```
<properties>
    <test.regex>none</test.regex>
</properties>

<build>
    <plugins>
        <plugin>
            <groupId>org.codehaus.mojo</groupId>
            <artifactId>build-helper-maven-plugin</artifactId>
            <version>1.12</version>
            <executions>
                <execution>
                    <id>regex-property</id>
                    <goals>
                        <goal>regex-property</goal>
                    </goals>
                    <configuration>
                        <name>maven.test.skip</name>
                        <value>${project.artifactId}</value>
                        <regex>${test.regex}</regex>
                        <replacement>true</replacement>
                        <failIfNoMatch>false</failIfNoMatch>
                    </configuration>
                </execution>
            </executions>
        </plugin>
    </plugins>
</build> 
```

在这里，我们实际上是用属性替换正则表达式值，`test.regex`默认值为 to `none`（或任何不匹配任何模块名称的值，或者也需要默认的跳过匹配项）。

然后从命令行我们可以

```
mvn clean test -Dtest.regex="(module1)" > will skip tests only for module1
mvn clean test -Dtest.regex="(module1)|(module2)" > will skip tests on module1 and module2
mvn clean test -Dtest.regex="(module1)|(module2)|(module3)" > will skip the three module tests
mvn clean test -Dtest.regex=".+" > will skip all module tests
mvn clean test > would not skip anything (or fall back on default behavior) 
```

也就是说，然后在运行时您决定，无需更改`pom.xml`文件或激活任何配置文件。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-11-04T19:07:51.120

使用 Surefire 插件 2.19，您可以使用正则表达式简单地排除您不想要的测试：

`mvn '-Dtest=!%regex[.*excludedString.*]' test`

上面的命令将排除所有包含 excludeString 的*测试*。

**NB1**如果使用双引号（“）而不是撇号（'），则该命令将无法正确解释并产生意外结果。（使用 bash 3.2.57 测试）

**NB2**应特别注意使用多个版本的 surefire 插件的项目。早于 2.19 的 surefire 版本将不会执行任何测试，因为它们不支持正则表达式。

版本管理（在父 pom 文件中添加它可能是个好主意）：

```
<build>
  <pluginManagement>
    <plugins>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-surefire-plugin</artifactId>
        <version>2.19.1</version>
      </plugin>
    </plugins>
  </pluginManagement>
</build> 
```

跳过测试的构建命令示例：[https ://artbcode.wordpress.com/2016/11/28/how-to-skip-a-subset-of-the-unit-tests/](https://artbcode.wordpress.com/2016/11/28/how-to-skip-a-subset-of-the-unit-tests/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-12-08T22:48:56.880

我对这个问题的需求略有不同，这可能会有所帮助。我想从命令行中排除来自不同包的一些不同测试，所以单个通配符不会这样做。

我在排除的 Maven Failsafe 文档规则中发现，您可以指定以逗号分隔的正则表达式或通配符排除列表： [https://maven.apache.org/surefire/maven-failsafe-plugin/examples/inclusion-exclusion。 html](https://maven.apache.org/surefire/maven-failsafe-plugin/examples/inclusion-exclusion.html)

所以我的 pomfile 看起来像这样：

```
<excludes>
    <exclude>${exclude.slow.tests}</exclude>
</excludes> 
```

我的命令行包括这个：

```
mvn install "-Dexclude.slow.tests=**/SlowTest1.java, **/package/ofslowtests/*.java, **/OtherSlowTest.java" 
```

对我来说，关键因素是在一个排除语句中对一个 Maven 属性进行一系列测试。

# css - 具有多列的表单，没有表格

> ID：772745
> 
> 赞同：10
> 
> 时间：2009-04-21T14:04:29.337
> 
> 标签：css, html, fieldset

如何在屏幕上定位具有多个字段的复杂表单？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-21T14:14:05.943

为什么人们如此热衷于避开餐桌？

不推荐使用表格，在显示逻辑上属于表格的内容时应使用表格。

如果您的表单按逻辑分组以便表格直观，请使用表格。

总是在想：“实现这个结果的最干净、最简单、最可维护的方法是什么。”

如果您想要具有可变数量列的流体形式，请忽略此。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-11-20T02:54:25.007

我更喜欢稍微语义化的方式，使用[定义列表](https://www.w3.org/MarkUp/html3/deflists.html)：

```
<dl class="form">
    <dt><label for="input1">One:</label></dt>
    <dd><input type="text" name="input1" id="input1"></dd>
    <dt><label for="input2">Two:</label></dt>
    <dd><input type="text" name="input2" id="input2"></dd>
</dl> 
```

然后你的CSS：

```
dl.form {
    width:100%;
    float:left;
    clear:both;
}
dl.form dt {
    width:50%;
    float:left;
    clear:left;
    text-align:right;
}
dl.form dd {
    width:50%;
    float:left;
    clear:right;
    text-align:left;
} 
```

这应该会生成一个位于页面中心的表单，左侧列中的标签和右侧的输入

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-11-20T02:35:12.813

在查看了许多不同的解决方案后，我发现此页面上的示例（尤其是来自“致命”的示例？）其中一些最有帮助。但广泛的

标签确实让我有点困扰。所以这里有一些人可能喜欢的修改。此外，您会发现某种“包装器”或“字段集”样式对于防止浮动影响其他 HTML 非常必要。参考上面的例子。

```
<style>
.formcol{
float: left;
padding: 2px;
} 
.formcol label {
font-weight: bold;
display:block;} 
</style>

<div class="formcol">
    <label for="org">organization</label>
    <input type="text" id="org" size="24" name="org" />
  </div>
 <div class="formcol">
    <label for="fax">fax</label>
    <input type="text" id="fax" name="fax" size="2" />
  </div>
  <div class="formcol">
    <label for="3">three</label>
    <input type="text" id="3" name="3" />
    <label for="4">four</label>
    <input type="text" id="4" name="4" />

    <label for="5">five</label>
    <input type="text" id="5" name="5" />
  </div>
 <div class="formcol">
    <label for="6">six</label>
    <input type="text" id="6" name="6" />
  </div> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-21T14:17:10.663

有许多不同的方法可以做到这一点。这都是偏好问题。我通常做的是有一个包含所有行的包装器 div，然后是每行包含标签、输入和验证器的 div 块。您可以使用 line-height CSS 属性来帮助您进行垂直对齐。例子：

```
<div class="formWrapper">
<form>
   <div class="formItem">
      <label for="firstName">First Name:</label>
      <input name="firstName" id="firstName" class="required" type="text" />
      <span class="validator" style="display: none;">*</>
   </div>
   ... <!-- Rinse repeat -->
</form>
</div>

<style type="text/css">
   .formWrapper { width: 400px }
   .formWrapper .formItem { line-height: 35px; height: 35px; }
   .formWrapper label { width: 50px; }
   .formWrapper input { width: 100px; border: 1px solid #000; }
   .formWrapper .validator { padding-left: 10px; color: #FF0000; }
</style> 
```

希望有帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-21T14:06:39.800

这将使用 CSS 通过将“显示”属性设置为“内联”来完成（因为默认情况下，表单元素是块级元素）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-01-20T13:14:53.347

Pace KyleFarris 但我只需要给 Ben S 投票，因为我有胆量提到桌子。只要看看这个页面上和互联网上的各种 CSS 解决方案，就可以找到一个非常简单的问题。CSS 可能有一天会成为一个很好的解决方案，但目前复制 table 标签提供的简单行和列网格是非常复杂的。对于表格之类的东西，我已经用这种对表格的偏见度过了无数无用的时间。我们为什么要这样对自己？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-21T18:32:32.687

当我需要设计非常复杂的表单时，这是我通常使用的。

**HTML：**

```
<fieldset>
    <legend>Consent group</legend>
    <form>
        <fieldset class="nolegend">
            <p><label><span>Title</span> <input type="text" name="title" size="40" value="" /></label></p>
            <p><label><span>Short name</span> <input type="text" name="sname" size="20" value="" /></label></p>
            <p><label><br /><input type="checkbox" name="approval"> This consent group requires approval</label></p>
     </fieldset>
        <fieldset class="nolegend">
            <p><label><span>Data use limitations</span> <textarea name="dul" cols="64" rows="4"></textarea></label></p>
        </fieldset>
        <input type="submit" value="Submit" />
    </form>
</fieldset>
```

**CSS：**

```
body, input, textarea, select {
    font: 1em Arial, Helvetica, sans-serif;
}
input, textarea, select { font-size: .8em }
fieldset,
fieldset legend {
    background-color: #EEE;
}
fieldset {
    border: none;
    margin: 0;
    padding: 0 0 .5em .01em;
    top: 1.25em;
    position: relative;
    margin-bottom: 2em;
}
fieldset fieldset {
    margin: 0 0 1em 0;
}
fieldset legend {
    padding: .25em .5em 0 .5em;
    border-bottom: none;
    font-weight: bold;
    margin-top: -1.25em;
    position: relative;
    *left: -.5em;
    color: #666;
}fieldset form,
fieldset .fieldset {
    margin: 0;
    padding: 1em .5em 0 .5em;
    overflow: hidden;
}
fieldset.nolegend {
    position: static;
    margin-bottom: 1em;
    background-color: transparent;
    padding: 0;
    overflow: hidden;
}
fieldset.nolegend p,
fieldset.nolegend div {
    float: left;
    margin: 0 1em 0 0;
}
fieldset.nolegend p:last-child,
fieldset.nolegend div:last-child {
    margin-right: 0;
}
fieldset.nolegend label>span {
    display: block;
}
fieldset.nolegend label span {
    _display: block;
}
```

我省略了几行带有 Safari hack 的 CSS。您可以查看此代码的[实时版本](http://rusrestaurant.com/tests/forms/1/)。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-21T14:17:05.390

我建议你[蓝图 CSS 框架](http://www.blueprintcss.org/tests/parts/grid.html)。快速浏览[演示页面](http://blueprintcss.org/tests/)。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-21T14:09:48.637

搜索“没有表格的布局”。许多网站使用 CSS 来描述格式。这是一个简单的介绍：[http ://www.htmlgoodies.com/beyond/css/article.php/3642151](http://www.htmlgoodies.com/beyond/css/article.php/3642151)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-21T14:15:12.947

默认情况下，输入字段是内联的。因此，
如果您希望它们正确排列，您可以简单地使用排列它们而不使用另一个选项，如下所示：

```
<div id="col1" style="float: left;>
    <input type="text" name="field1" />
    <br />
    <input type="text" name="field3" />
</div>

<div id="col2" style="float: left;>
    <input type="text" name="field2" />
    <br />
    <input type="text" name="field4" />
</div> 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-04-15T19:39:06.790

我更喜欢使用 **fieldset**对所有元素和每个表单字段的**p进行分组。**

```
<html>
<head>
<style type="text/css">
    fieldset {
        width: 500px;
        background-color: lightblue;
    }

    fieldset legend {
        font-weight: bold;
    }

    fieldset p {
        clear:both;
        padding: 5px;
    }

    fieldset label {
        text-align: left;
        width: 100px;
        float: left;
        font-weight: bold;
    }

    fieldset .Validator {
        color: red !important;
        font-weight: bold;
    } 

</style>
<head>
<body>
    <form>
        <fieldset>
            <legend>Data</legend>
            <p>
                <label for="firstName">First Name:</label>
                <input name="firstName" id="firstName" class="required" type="text" />
                <span class="Validator" style="display: none;">*</span>
            </p>
            <p>
                <label for="lastName">Last Name:</label>
                <input name="lastName" id="lastName" class="required" type="text" />
                <span class="Validator">*</span>
            </p>
        </fieldset>
    </form>
</body>
</html> 
```

# svn - TortoiseSVN 重新映射源文件夹

> ID：772756
> 
> 赞同：3
> 
> 时间：2009-04-21T14:07:25.880
> 
> 标签：svn, tortoisesvn

我最近不得不将我的开发更改为另一台 PC。我安装了 TortoiseSVN，因为我仍然有源代码需要在 SVN 中检查。但显然，新安装的 Tortoise 无法识别我的源文件夹，尽管“.SVN”文件夹仍然存在，但我看不到文件上出现覆盖图标。

有没有办法将我的本地文件夹重新映射到存储库中的文件夹？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-21T14:14:39.903

TortoiseSVN 有一个使用“_svn”文件夹而不是“.svn”文件夹的设置（由于旧版本的 Visual Studio 存在问题），检查这是否会导致您的麻烦。

由于它是您从旧系统恢复的旧工作文件夹，我会考虑删除所有“.svn”文件夹，再次检查代码（可选地从您记得工作文件夹所在的修订号），然后移动旧文件（没有“.svn”文件夹）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T14:26:54.960

确保新机器上的 TortoiseSVN 安装与前一台机器上安装的相同或更新。新版本的 tsvn 有时会使用旧版本无法理解的更新存储库格式。

新机有64位操作系统吗？如果是这样，请务必安装 64 位版本的 tsvn。32 位版本仍然可以安装在 64 位 Windows 上，但该功能不会显示在默认的 64 位资源管理器中。

即使覆盖不起作用，请确保您右键单击文件夹并查看菜单中是否出现 tsvn 操作。覆盖不工作的原因可能与工作副本无关。

# sql - 区分 ß 和 ss 的 SQL 查询

> ID：772763
> 
> 赞同：6
> 
> 时间：2009-04-21T14:08:08.173
> 
> 标签：sql, sql-server-2008, collation

似乎`ß=ss`在 SQL 中。我需要能够在严格的字符等效基础上进行区分。

IE`SELECT * from table WHERE name LIKE '%ß%'`

产量

`Brian Bruß` `Steven Sossmix`

ETC..

我查看了不同的排序规则，看看是否有一个忽略字符扩展的排序规则，但到目前为止还没有运气。

数据库具有`Latin1_General_CI_AS`默认值 - 我也尝试过`Latin1_General_CS_AS`and `Latin1_General_CS_AS_WS`，但都没有奏效。

任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-21T14:29:50.087

您需要使用二进制排序规则，以便区分大小写、区分重音等。

整理：`SQL_Latin1_General_Cp437_BIN`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T14:21:25.833

找到一个有两个解决方案的[线程。](http://74.125.95.132/search?q=cache:y3MXY4nbuy8J:www.dotnet247.com/247reference/msgs/56/284342.aspx+sql+difference+between+%C3%9F+and+ss+in+sql+server+2008&cd=8&hl=en&ct=clnk&gl=us&client=firefox-a)

# sql-server - 如何从一个存储过程中获取身份并将其传递给另一个存储过程？

> ID：772766
> 
> 赞同：0
> 
> 时间：2009-04-21T14:08:24.943
> 
> 标签：sql-server, stored-procedures

大家好，我正在寻找一种将生成的 id 从 sproc 传递到另一个 sproc 的方法。

IE

```
@name varchar(12),
@descript varchar(55)
@test_date date,
@test_result varchar(1)
BEGIN
   EXEC ts_create_item @name, @descript
END
if (@test_date is not null) or (isnull(@test_result_id,'')!='')
BEGIN
   Exec ts_update_test_results @itemid(generated from the sproc before), @test_date, @test_result
End 
```

有没有办法在 sql server 中做到这一点？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T14:15:23.710

使用输出变量

所以你会声明以前的proc

```
Create proc SomeProc (@parm1 int, @parm2 int, @id int = null OUTPUT)
as
Begin
  ...do some insert
  select @id = scope_identity()
End 
```

请记住，在声明和分配参数时都必须指定 OUTPUT，即。

```
Exec someproc @parm1, @parm2, @id OUTPUT 
```

或者，您可以使用局部变量来保存结果

例如

```
create proc somesample(@in int)
as
Begin
    select @in * 2
End 

declare @var int
exec @var = somesample 1
print @var
2 
```

# c# - 使用HSQL进行.NET开发及流程相关问题

> ID：772767
> 
> 赞同：7
> 
> 时间：2009-04-21T14:08:51.557
> 
> 标签：c#, process, hsqldb, embedded-database, test-data

我的团队使用 Oracle 的共享实例进行开发，使用 C#、NHibernate 和 ASP.NET，并且在进行数据或架构更改时，我们偶尔会互相踩脚，阻碍了所有人。

在另一个项目中，我在 100% 内存模式下使用 Java 和 HSQL，只是让 Hibernate 启动一个脚本来导入足够的数据进行测试。它还创建和删除模式。我考虑在 .NET-land 中使用相同的方法。由于一切都是临时的和独立的，不可能互相踩踏，我们仍然可以将我们的模式和数据集成到共享的 Oracle 机器上。

我在 .NET 上寻找 HSQL，而[SharpHSQL](http://sharphsql.codeplex.com/)似乎是一个死项目（最后一个版本 2005）。

是否有一个与 HSQL for .NET 等效的活动项目，或者任何足够接近以这种方式使用的项目？

你是如何在团队环境中使用这种方法的？有什么问题吗？

您如何管理和版本控制数据以填充数据库？是否有用于导入数据的跨平台解决方案？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-21T14:26:01.610

[使用Sqlite](http://www.sqlite.org/)之类的东西，您可以在 .NET 应用程序中采用与 Java 应用程序相同的方法 - 通过 NHibernate 模式导出/NHibernate 填充代码创建模式和填充测试数据是管理这种情况的好方法（NHibernate 与方镁石）。如果您选择这样做，您也可以在 Java 应用程序中标准化 Sqlite。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-06-18T22:27:20.237

请参阅 HSQLDB.org 网站。现在有一个 .NET 实现。

编辑：该实现适用于 HSQLDB 1.8.0.x，位于 SVN 存储库中。需要编译使用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-01-31T12:46:40.000

看看[努力](http://effort.codeplex.com/)

> 它基本上是一个 ADO.NET 提供程序，它在轻量级进程内主内存数据库而不是传统的外部数据库上执行所有数据操作。

我在我最新的项目中使用了它并且非常喜欢它。易于设置。

# sql-server - 需要良好的方案/工作流程来使用 Subversion 管理数据库对象

> ID：772769
> 
> 赞同：3
> 
> 时间：2009-04-21T14:09:06.080
> 
> 标签：sql-server, database, svn, stored-procedures

您如何在 SQL Server 中跟踪/管理存储过程、视图和函数？

我想使用 Subversion，但看起来我只需要保存并提交 CREATE/ALTER 语句。这对我来说可能没问题，但我怀疑我最终会做很多唠叨。

**有人在他们的数据库中使用版本控制吗？有没有更好的办法？**

过去，人们只是注释掉部分代码并将其留在原处。或者，他们在各处添加了很少的“添加于 2/31/2010”注释。它让我发疯，因为我知道有更好的方法。

我们确实在对象的标头中记录更改，但这非常有限。能够区分版本将使我的生活更轻松。

**附加信息**
我们使用的是 SQL Server 2005。我安装了 Subversion（通过 VisualSVN 服务器）和 TortoiseSVN，但我愿意接受其他建议。

对于数据库对象，我特别指的是存储过程、视图和函数。

我只需要跟踪几张桌子。数据库是商业应用程序的后端，我们主要提取信息进行报告

我发现了一个关于[存储过程版本控制的相关问题](https://stackoverflow.com/questions/183148/stored-procedure-versioning)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-21T15:16:42.737

我们编写所有内容并将其放入 Subversion。没有脚本就无法将任何内容加载到 Prod（开发人员没有 prod 权限），并且拥有 prod 权限的人只接受他们从 Subversion 加载的脚本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T14:20:45.070

我们修改我们的数据库、模式创建、dw、etl、存储过程，就像任何其他代码一样，因为它是代码！

我还看到人们在标题等中键入日期。这通常是由于他们完全忽略了修订控制点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-21T15:19:53.553

看看 liquibase，[在这里](http://liquibase.org)

它为您管理您的 sql 更改/脚本，并且可以通过钩子或脚本将它们与 svn 一起应用。使进行各种设置变得容易，并有助于消除缺少触发器/存储过程/等的情况......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T14:23:53.580

我不确定“数据库对象”是什么意思。这些只是表、视图、过程等还是数据？我的意思是每日创建的数据？

假设您的意思是数据库模式定义。根据我的经验，只有一种方法可以处理数据库模式定义（如果您没有 NHibernate 或其他类似工具）。您编写从头开始创建数据库的 sql 脚本并将它们签入。您使用相同的脚本来安装软件。您只需比较脚本文件即可看到差异。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-21T21:28:02.610

每当我完成这个练习时，都可以归结为需要进行源代码控制的 3 件主要事情：

1.  存储过程/视图/触发器（或多或少可以公平地表示为“代码”的任何内容。这些都相当简单，包括有条件的删除并在文件顶部创建。
2.  表架构 - 如上所述的 DROP / CREATE 语句。您可以尝试使用 ALTER 语句，但它往往会变得非常混乱。

我们面临的最大挑战是这迫使您进入一个系统，您的数据库经常回到初始状态 - 如果将数据库带入可用/可测试的东西需要相当多的工作，那可能会很痛苦。在那种情况下，我们保留了一个脚本库，将数据库带入各种可用状态，并且源代码控制这些状态。

3.  表中的数据。我们在这里研究了几种方法——要么是存储在“TableName_Data.sql”之类的文件中的一系列 INSERT 语句，要么是具有自定义构建工具的 CSV 文件，该工具在重建数据库时解析和插入。

最终，为了简单起见，我们使用了 INSERT 语句。

# sql-server - SqlServer，事务死锁，表何时真正锁定？

> ID：772770
> 
> 赞同：0
> 
> 时间：2009-04-21T14:09:39.277
> 
> 标签：sql-server, transactions

此 SQL（从 c# 调用）偶尔会导致死锁。服务器负载不大，因此使用的方法是尽可能多地锁定。

```
 -- Lock to prevent race-conditions when multiple instances of an application calls this SQL:
        BEGIN TRANSACTION 
-- Check that no one has inserted the rows in T1 before me, and that T2 is in a valid state (Test1 != null)
            IF NOT EXISTS (SELECT TOP 1 1 FROM T1 WITH(HOLDLOCK, TABLOCKX) WHERE FKId IN {0}) AND 
            NOT EXISTS(SELECT TOP 1 1 FROM T2 WITH(HOLDLOCK, TABLOCKX) WHERE DbID IN {0} AND Test1 IS NOT NULL) 
            BEGIN
-- Great! Im the first - go insert the row in T1 and update T2 accordingly. Finally write a log to T3 
               INSERT INTO T1(FKId, Status) 
               SELECT DbId, {1} FROM T2 WHERE DbId IN {0}; 

               UPDATE T2 SET LastChangedBy = {2}, LastChangedAt = GETDATE() WHERE DbId IN {0}; 

               INSERT INTO T3 (F1, FKId, F3) 
               SELECT {2}, DbId, GETDATE() FROM T2 WHERE DbId IN {0} ;
            END; 

            -- Select status on the rows so the program can evaluate what just happened
            SELECT FKId, Status FROM T1 WHERE FkId IN {0}; 

        COMMIT TRANSACTION 
```

我认为问题在于需要锁定多个表。

我有点不确定这些表何时实际上是 xlocked - 第一次使用表时 - 或者所有表在 BEGIN TRANS 时都同时锁定？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-21T14:28:52.413

使用表锁会增加发生死锁的可能性...并非所有死锁都是由乱序操作引起的...有些可能是由其他仅尝试锁定单个记录的活动引起的（如您所见）您正在完全锁定同一张表，因此锁定整个表会增加发生冲突的可能性。当使用可序列化隔离级别时，范围锁被放置在索引行上，这可以防止其他 sql 操作的插入/删除，以一种可能导致来自同一过程的两个并发操作的死锁的方式，即使它们被编码为执行它们的以相同的顺序操作...

无论如何，要找出导致死锁的确切原因，请设置 SQL Server 跟踪标志 1204 和 1222。这将导致将有关每个死锁的详细信息写入 SQL Server 日志，包括涉及的语句。

[这](http://msdn.microsoft.com/en-us/library/ms178104.aspx)是一篇关于如何做到这一点的好文章。

（完成后不要忘记关闭这些标志...）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T14:18:07.463

当您调用 lock 或 select with lock 并在提交或回滚时释放时，锁定完成。

如果另一个过程先在 T3 中锁定，然后在 T1 或 T2 中锁定，您可能会遇到死锁。然后两个事务在等待对方获取资源，同时锁定对方需要的东西。

您还可以避免表锁定并使用可序列化的隔离级别。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T14:12:25.480

锁定的问题在于，您确实需要同时查看所有进行锁定的地方，没有办法将问题隔离并分解为许多较小的问题并单独查看。

例如，如果其他一些代码锁定了相同的表，但不明显，而且顺序错误，该怎么办？那会造成僵局。

您需要在发现死锁的那一刻分析服务器状态，以尝试找出此时正在运行的其他内容。只有这样才能尝试修复它。

# .net - WPFMVVM 集中控制

> ID：772772
> 
> 赞同：1
> 
> 时间：2009-04-21T14:09:55.877
> 
> 标签：.net, wpf, mvvm

如何在 MVVM 中设置用户控制焦点？使用 Focusmanager.FocusElement={Binding ...} 没有影响。

这是我的 XAML：

```
<DataTemplate DataType="{x:Type client:TelephoneNumberViewModel}">
    <Grid FocusManager.FocusedElement="{Binding ElementName=TelephoneNumber}" Width="1024" Height="540">
        <Grid.RowDefinitions>
            <RowDefinition Height="60" />
            <RowDefinition Height="*" />
            <RowDefinition Height="*" />
            <RowDefinition Height="*" />
            <RowDefinition Height="*" />
            <RowDefinition Height="*" />
            <RowDefinition Height="*" />
            <RowDefinition Height="80" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="25" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <TextBlock Margin="0 25 0 0" HorizontalAlignment="Left" Grid.Row="0" Grid.Column="1" 
             Grid.ColumnSpan="7"  Name="textBlockQuestion"
             TextWrapping="Wrap" Style="{DynamicResource TitleTextBlock}">"What is your telephone number?"</TextBlock>

        <Grid Grid.Column="1" Grid.Row="1" Grid.RowSpan="7" 
             Grid.ColumnSpan="7" Height="460">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="170" />
                <ColumnDefinition />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="80" />
                <RowDefinition Height="80" />
                <RowDefinition Height="80" />
                <RowDefinition Height="80" />
                <RowDefinition Height="100" />
            </Grid.RowDefinitions>

            <StackPanel Grid.Row="0" Grid.RowSpan="5" Grid.Column="0" Grid.ColumnSpan="2" VerticalAlignment="Top" HorizontalAlignment="Left">
                <wpfclient:TelephoneBox Name="TelephoneNumber"  TelephoneNumber="{Binding PhoneNumber, Mode=TwoWay}" />
                <!--<TextBox Width="500" VerticalAlignment="Top" HorizontalAlignment="Left" FontSize="40" TextAlignment="Center" Text="{Binding PhoneNumber}"></TextBox>-->

                <StackPanel Orientation="Horizontal" Margin="0 40 0 0">
                    <StackPanel Orientation="Vertical" Margin="0 0 60 0" >
                        <Button Margin="0 0 0 20" Style="{DynamicResource LargeGlossyButtonStyle}" Command="{Binding SurveyMobileCommand}">Mobile</Button>
                        <Button Style="{DynamicResource LargeGlossyButtonStyle}" Command="{Binding SurveyHomeCommand}">Home</Button>

                    </StackPanel>
                    <StackPanel Orientation="Vertical">
                        <Button Margin="0 0 0 20"  Style="{DynamicResource LargeGlossyButtonStyle}" Command="{Binding SurveyWorkCommand}">Work</Button>
                        <Button Style="{DynamicResource LargeGlossyButtonStyle}" Command="{Binding SurveyOtherCommand}">Other</Button>
                    </StackPanel>
                </StackPanel>

            </StackPanel>

        </Grid>

        <Grid Width="1024" Height="80" Grid.Row="7" Grid.Column="0" Grid.ColumnSpan="8" VerticalAlignment="Bottom">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            <Button Margin="60 0 0 20" Grid.Column="0" Grid.Row="0"  Name="buttonContinue" 
                    Command="{Binding SurveySkipCommand}" Style="{DynamicResource LargeGlossyButtonStyle}" 
                    >Skip</Button>
        </Grid>

    </Grid>
</DataTemplate> 
```

直到我仍然单击一次，用户控件才会获得焦点。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T14:17:32.037

使用[`FocusManager.FocusedElement`](http://msdn.microsoft.com/en-us/library/system.windows.input.focusmanager.focusedelement.aspx).

**编辑后编辑**：我认为没有看到你的整个代码就不可能说，但我认为这可能是一个焦点范围问题。您正在将逻辑焦点设置为电话控件，但如果该逻辑范围是活动范围，则只有键盘焦点。我怀疑被模板化的控件之外的东西有自己的焦点范围，直到你点击选项卡，范围才会移动到 UserControl 中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T14:45:55.930

焦点的背景是什么？他们是否对控件进行制表符，控件是否在添加新项目时接收焦点？

如果是后者，请确保 DataTemplate 所针对的 ListBox 具有 IsSynchronizedWithCurrentItem="True"

# sql - 将变量参数列表传递给 SqlServer2008 存储过程的理智/快速方法

> ID：772777
> 
> 赞同：5
> 
> 时间：2009-04-21T14:11:13.860
> 
> 标签：sql, sql-server, sql-server-2008, stored-procedures, parameters

一个相当全面的大脑查询已经找到了一千零一种传递可变长度参数列表的方法，这些方法涉及以下方法：

*   用于将字符串解析为整数列表的基于 CLR 的方法
*   需要[存在“数字”表的](http://www.sommarskog.se/arraylist-2005/fixstring.html#fixstring_single)表值函数（wtf？）
*   [将数据作为 XML 传递](http://support.microsoft.com/kb/555266)

我们的要求是将两个可变长度的整数列表（最多 20 个整数）传递给存储过程。上面列出的所有方法似乎都闻起来很有趣。

这只是必须完成的方式，还是有更好的方式？

*编辑：* 我刚刚发现[了这个](https://stackoverflow.com/questions/608562/passing-a-list-to-a-tsql-2008-stored-procedure)，这可能会将这个问题视为一个骗局

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-21T15:18:50.437

是的，我肯定会为此查看[表值参数](http://msdn.microsoft.com/en-us/library/bb510489.aspx)。作为一个附带的好处，它可以让您直接为您的程序的内部使用一个漂亮、干净的基于集合的实现，而无需任何数据按摩。

这里[还有另一个参考](http://www.sqlteam.com/article/sql-server-2008-table-valued-parameters)...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T18:55:35.143

这是一种仅使用 T-SQL 来拆分字符串的相当快的方法，并且您的输入参数只是一个字符串。您需要已经设置了一个表和一个函数（如下所述）才能使用此方法。

创建此表：

```
CREATE TABLE Numbers (Number  int not null primary key identity(1,1))
DECLARE @n int
SET @n=1
SET IDENTITY_INSERT Numbers ON
WHILE @N<=8000
BEGIN
    INSERT INTO Numbers (Number) values (@n)
    SET @n=@n+1
END
SET IDENTITY_INSERT Numbers OFF 
```

创建此函数以拆分字符串数组（我有其他版本，其中删除了空部分和不返回行号的部分）：

```
CREATE FUNCTION [dbo].[FN_ListAllToNumberTable]
(
     @SplitOn              char(1)              --REQUIRED, the character to split the @List string on
    ,@List                 varchar(8000)        --REQUIRED, the list to split apart
)
RETURNS
@ParsedList table
(
    RowNumber int             --REQUIRED, the list to split apart
   ,ListValue varchar(500)    --OPTIONAL, the character to split the @List string on, defaults to a comma ","

)
AS
BEGIN

--this will return empty rows, and row numbers
INSERT INTO @ParsedList
        (RowNumber,ListValue)
    SELECT
        ROW_NUMBER() OVER(ORDER BY number) AS RowNumber
            ,LTRIM(RTRIM(SUBSTRING(ListValue, number+1, CHARINDEX(@SplitOn, ListValue, number+1)-number - 1))) AS ListValue
        FROM (
                 SELECT @SplitOn + @List + @SplitOn AS ListValue
             ) AS InnerQuery
            INNER JOIN Numbers n ON n.Number < LEN(InnerQuery.ListValue)
        WHERE SUBSTRING(ListValue, number, 1) = @SplitOn

RETURN

END 
go 
```

以下是如何拆分参数的示例：

```
CREATE PROCEDURE TestPass
(
    @ArrayOfInts    varchar(255)  --pipe "|" separated list of IDs
)
AS

SET NOCOUNT ON

DECLARE @TableIDs  TABLE (RowNumber int, IDValue int null)

INSERT INTO @TableIDs (RowNumber, IDValue)  SELECT RowNumber,CASE WHEN LEN(ListValue)<1 then NULL ELSE  ListValue END FROM dbo.FN_ListAllToNumberTable('|',@ArrayOfInts)

SELECT * FROM @TableIDs
go 
```

这是基于： http: [//www.sommarskog.se/arrays-in-sql.html](http://www.sommarskog.se/arrays-in-sql.html)

# asp.net - 查找上一页网址

> ID：772780
> 
> 赞同：5
> 
> 时间：2009-04-21T14:11:55.340
> 
> 标签：asp.net

我正在尝试查找上一页的 url。例如，如果用户使用 导航从页面 A 到页面 B `Server.Redirect("B.aspx")`，页面 B 可以显示引用它的 url。

我试过使用

```
Response.Write(Page.PreviousPage.ToString());

Response.Write(Request.UrlReferrer.ToString());

Response.Write(Context.Request.UrlReferrer.ToString());

Response.Write(Request.ServerVariables["HTTP_REFERER"].ToString); 
```

但一切都是徒劳的，它给了我`null exception`错误

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-21T14:57:28.647

您可以将当前页面保存在 Session 中，然后从那里检索它：

```
string previousPage = Session["PreviousPage"] as string;
Session["PreviousPage"] = System.IO.Path.GetFileName(System.Web.HttpContext.Current.Request.FilePath); 
```

这样，previousPage 字符串将始终包含前一页的文件名，而 Session 变量将包含当前页，准备在下一页使用。

通过这种方式，您还可以检测引荐来源网址是否为外部链接，因为这样 previousPage 字符串将为空。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-21T14:19:39.020

如果仅适用于这种情况（您以编程方式重定向到 B.aspx），那么为什么不在查询字符串上放一些东西来说明重定向的来源。这更有可能适用于多种浏览器类型和设备。

这种方法的一个优点是您将能够区分重定向到 B.aspx 和直接链接（通过您的一个页面上的链接，或通过用户将 URL 输入地址库）到 B.aspx 页。

引荐来源网址是客户端作为 HTTP 请求的一部分提供的内容。因此，您不能依赖它。

顺便说一句，这个问题是相关的： [Request.UrlReferrer null?](https://stackoverflow.com/questions/149130/request-urlreferrer-null)

**更新** 鉴于您的评论，除了“编辑所有文件”之外，尚不清楚这是一个简单的解决方案。我怀疑全局搜索/替换可能是您最好的选择。

更多背景知识：如果您使用 Fiddler（或任何其他 http 调试工具），您应该能够看到在执行重定向时未填充 Referrer 标头。例如，这是重定向的结果（即导致 IE 重定向到另一个页面的 HTTP 302 响应）：

```
GET /webapplication1/WebForm3.aspx HTTP/1.1
Accept: image/gif, image/jpeg, image/pjpeg, application/x-ms-application, application/vnd.ms-xpsdocument, application/xaml+xml, application/x-ms-xbap, application/vnd.ms-excel, application/vnd.ms-powerpoint, application/msword, application/x-shockwave-flash, */*
Accept-Language: en-GB
User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; WOW64; Trident/4.0; SLCC1; .NET CLR 2.0.50727; Media Center PC 5.0; InfoPath.2; .NET CLR 3.5.21022; .NET CLR 3.5.30729; .NET CLR 3.0.30618; MS-RTC LM 8; Zune 3.0)
Accept-Encoding: gzip, deflate
Connection: Keep-Alive
Host: (removed) 
```

这是通过单击 StackOverflow.com 上的“问题”链接生成的 HTTP 请求：

```
GET /questions HTTP/1.1
    Accept: image/gif, image/jpeg, image/pjpeg, application/x-ms-application, application/vnd.ms-xpsdocument, application/xaml+xml, application/x-ms-xbap, application/vnd.ms-excel, application/vnd.ms-powerpoint, application/msword, application/x-shockwave-flash, */*
    Referer: https://stackoverflow.com/questions/772780/finding-previous-page-url
    Accept-Language: en-GB
    User-Agent: Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.0; WOW64; Trident/4.0; SLCC1; .NET CLR 2.0.50727; Media Center PC 5.0; InfoPath.2; .NET CLR 3.5.21022; .NET CLR 3.5.30729; .NET CLR 3.0.30618; MS-RTC LM 8; Zune 3.0)
    Accept-Encoding: gzip, deflate
    Host: stackoverflow.com
    Connection: Keep-Alive 
```

您可以看到，后者由页面上的链接生成，生成了 Referer 标头。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-21T14:36:23.223

您也可以使用`Server.Tansfer("B.aspx")`而不是`Response.Redirect("B.aspx")`

编辑：Searock，如果您不想更改现有代码，`Request.ServerVariables["HTTP_REFERER"].ToString()`在这种情况下应该可以正常工作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-21T14:42:25.703

只是要注意**HTTP_REFERER 是不可靠的**。您不能依赖它，因为有很多客户端由于各种原因（偏执设置、安全软件等）而没有发送。

此外，一些由 JS 打开的新窗口可能没有 REFERER SSL > NONE SSL 页面也没有 REFERER，所以要小心依赖类似的东西。

更好的主意是在 Querystring 中发送上一页。

如果它是 ASPX，您可能会以更聪明的方式来执行此操作，例如在写出缓冲区之前向所有表单或处理链接添加新的隐藏参数。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-22T12:59:34.977

您能否确认您在此处实际使用的方法（最好是通过编辑原始问题）？

[HttpServerUtility](http://msdn.microsoft.com/en-us/library/system.web.httpserverutility_members.aspx)（即*Server.*）没有“重定向”方法，它有传输和执行。

[HttpResponse](http://msdn.microsoft.com/en-us/library/system.web.httpresponse_members.aspx)（即*Response.*）确实如此。

[HttpResponse.Redirect](http://msdn.microsoft.com/en-us/library/system.web.httpresponse.redirect.aspx)将向客户端发送一个 302 响应，告诉它为 Location 字段的值发出一个新请求。然后，我可以查询 Request.UrlReferrer 以查看执行重定向的页面的值。

如果您使用的是[HttpServerUtility.Transfer](http://msdn.microsoft.com/en-us/library/system.web.httpserverutility.transfer.aspx)或[HttpServerUtility.Execute](http://msdn.microsoft.com/en-us/library/system.web.httpserverutility.execute.aspx)，那么这些操作完全发生在 ASP.NET 中的服务器上，因此“引荐来源网址”很可能为空。客户端浏览器也会认为它仍在最初请求的页面上。

另请参阅[如何检测是否从 Server.Execute 调用了 aspx 页面](https://stackoverflow.com/questions/587510/how-to-detect-if-an-aspx-page-was-called-from-server-execute)

# iis - GMAIL rss 看不到标签描述。如何查看我的 iis 5 网站的请求标头

> ID：772785
> 
> 赞同：1
> 
> 时间：2009-04-21T14:12:51.907
> 
> 标签：iis, rss, gmail, iis-logs

217.76.185.140/18.rss asp.net 服务器如果我添加到 webclip (gmail) rss [http://www.brainyquote.com/link/quotebr.rss](http://www.brainyquote.com/link/quotebr.rss)它工作正常（查看收件箱有 rss 提要）但是我自己的 RSS 提要没有看到描述标签。1.我想要复制请求标头（将 gmail 发送到我的 iis 服务器）HTTP 101\. 等内容类型

2.比我想复制它并将这个 httrrequest 和 fiddler 发送到[http://www.brainyquote.com/link/quotebr.rss](http://www.brainyquote.com/link/quotebr.rss) 3.比我看到来自 quotebr.rss 的 http 响应 4.我复制这个响应并替换描述，标题等我自己的

1.我想知道如何确保安全（记录、跟踪对 iis 5 windows xp 的请求）提琴手没有看到它 2.如何查看从 gmail 到我的站点的请求 3.你有 rss 示例，在 gmail 中工作吗?

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-21T08:39:24.913

Fiddler 不会看到 GMail 对提要的请求，因为该请求将直接从 GMail 服务器发送到您的服务器，而无需接触客户端计算机。您必须在服务器上记录请求。

```
[your computer]-------[gmail.com]------[your server w/ RSS feed] 
```

1.  您的计算机从 gmail 请求页面
2.  gmail 从您的服务器请求一个页面（在完全不同的连接上）
3.  您的服务器返回对 gmail 的响应
4.  gmail 将响应组装成自己的响应
5.  gmail 将响应返回到您的计算机

在 Fiddler 中，您只能看到第 1 步和第 5 步，因为它们会在您的计算机和网络上的其他计算机之间产生流量。

# asp.net - 在 XML 文件中用 & 替换 & 的正则表达式

> ID：772788
> 
> 赞同：-1
> 
> 时间：2009-04-21T14:13:15.400
> 
> 标签：asp.net, regex

在 XML 文件中，我使用正则表达式（在 .NET 中）从网页中捕获一长串 URL。在捕获的 URLS 中，我只需要用 '&' 替换 URLS 中的所有 ' `&amp;`'。我该怎么做呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T14:23:42.097

如果您这样做并保存结果，则会留下**无效**的xml。如果您使用的是真正的 xml 解析器，`&amp;`则将`&`在您阅读时正确返回。

如果您坚持继续，`String.Replace("&amp;", "&")`每个 url 上的简单内容就足够了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T14:23:55.670

我建议使用`String.Replace("&","&amp;")`字符串函数而不是正则表达式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T14:23:55.903

你为什么不这样做：

```
string.Join("\n", System.IO.File.ReadAllLines("file.txt")).Replace("&", "&amp;"); 
```

?

# java - 将 UUID 存储为 base64 字符串

> ID：772802
> 
> 赞同：85
> 
> 时间：2009-04-21T14:18:01.877
> 
> 标签：java, sql, bytearray, base64, uuid

我一直在尝试使用 UUID 作为数据库键。我想占用尽可能少的字节，同时仍然保持 UUID 表示人类可读。

我认为我已经使用 base64 将其减少到 22 个字节，并删除了一些似乎不需要存储的尾随“==”。这种方法有什么缺陷吗？

基本上，我的测试代码进行了一系列转换以将 UUID 降低为 22 字节字符串，然后将其转换回 UUID。

```
import java.io.IOException;
import java.util.UUID;

public class UUIDTest {

    public static void main(String[] args){
        UUID uuid = UUID.randomUUID();
        System.out.println("UUID String: " + uuid.toString());
        System.out.println("Number of Bytes: " + uuid.toString().getBytes().length);
        System.out.println();

        byte[] uuidArr = asByteArray(uuid);
        System.out.print("UUID Byte Array: ");
        for(byte b: uuidArr){
            System.out.print(b +" ");
        }
        System.out.println();
        System.out.println("Number of Bytes: " + uuidArr.length);
        System.out.println();

        try {
            // Convert a byte array to base64 string
            String s = new sun.misc.BASE64Encoder().encode(uuidArr);
            System.out.println("UUID Base64 String: " +s);
            System.out.println("Number of Bytes: " + s.getBytes().length);
            System.out.println();

            String trimmed = s.split("=")[0];
            System.out.println("UUID Base64 String Trimmed: " +trimmed);
            System.out.println("Number of Bytes: " + trimmed.getBytes().length);
            System.out.println();

            // Convert base64 string to a byte array
            byte[] backArr = new sun.misc.BASE64Decoder().decodeBuffer(trimmed);
            System.out.print("Back to UUID Byte Array: ");
            for(byte b: backArr){
                System.out.print(b +" ");
            }
            System.out.println();
            System.out.println("Number of Bytes: " + backArr.length);

            byte[] fixedArr = new byte[16];
            for(int i= 0; i<16; i++){
                fixedArr[i] = backArr[i];
            }
            System.out.println();
            System.out.print("Fixed UUID Byte Array: ");
            for(byte b: fixedArr){
                System.out.print(b +" ");
            }
            System.out.println();
            System.out.println("Number of Bytes: " + fixedArr.length);

            System.out.println();
            UUID newUUID = toUUID(fixedArr);
            System.out.println("UUID String: " + newUUID.toString());
            System.out.println("Number of Bytes: " + newUUID.toString().getBytes().length);
            System.out.println();

            System.out.println("Equal to Start UUID? "+newUUID.equals(uuid));
            if(!newUUID.equals(uuid)){
                System.exit(0);
            }

        } catch (IOException e) {
        }

    }

    public static byte[] asByteArray(UUID uuid) {

        long msb = uuid.getMostSignificantBits();
        long lsb = uuid.getLeastSignificantBits();
        byte[] buffer = new byte[16];

        for (int i = 0; i < 8; i++) {
            buffer[i] = (byte) (msb >>> 8 * (7 - i));
        }
        for (int i = 8; i < 16; i++) {
            buffer[i] = (byte) (lsb >>> 8 * (7 - i));
        }

        return buffer;

    }

    public static UUID toUUID(byte[] byteArray) {

        long msb = 0;
        long lsb = 0;
        for (int i = 0; i < 8; i++)
            msb = (msb << 8) | (byteArray[i] & 0xff);
        for (int i = 8; i < 16; i++)
            lsb = (lsb << 8) | (byteArray[i] & 0xff);
        UUID result = new UUID(msb, lsb);

        return result;
    }

} 
```

输出：

```
UUID String: cdaed56d-8712-414d-b346-01905d0026fe
Number of Bytes: 36

UUID Byte Array: -51 -82 -43 109 -121 18 65 77 -77 70 1 -112 93 0 38 -2 
Number of Bytes: 16

UUID Base64 String: za7VbYcSQU2zRgGQXQAm/g==
Number of Bytes: 24

UUID Base64 String Trimmed: za7VbYcSQU2zRgGQXQAm/g
Number of Bytes: 22

Back to UUID Byte Array: -51 -82 -43 109 -121 18 65 77 -77 70 1 -112 93 0 38 -2 0 38 
Number of Bytes: 18

Fixed UUID Byte Array: -51 -82 -43 109 -121 18 65 77 -77 70 1 -112 93 0 38 -2 
Number of Bytes: 16

UUID String: cdaed56d-8712-414d-b346-01905d0026fe
Number of Bytes: 36

Equal to Start UUID? true 
```

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2013-02-21T22:10:53.070

我也试图做类似的事情。我正在使用一个使用 UUID 形式的 Java 应用程序（使用 Java 中`6fcb514b-b878-4c9d-95b7-8dc3a7ce6fd8`的标准 UUID 库生成）。就我而言，我需要能够将此 UUID 减少到 30 个字符或更少。我使用了 Base64，这些是我的便利功能。希望他们会对某人有所帮助，因为解决方案对我来说并不明显。

**用法：**

```
String uuid_str = "6fcb514b-b878-4c9d-95b7-8dc3a7ce6fd8";
String uuid_as_64 = uuidToBase64(uuid_str);
System.out.println("as base64: "+uuid_as_64);
System.out.println("as uuid: "+uuidFromBase64(uuid_as_64)); 
```

**输出：**

```
as base64: b8tRS7h4TJ2Vt43Dp85v2A
as uuid  : 6fcb514b-b878-4c9d-95b7-8dc3a7ce6fd8 
```

**职能：**

```
import org.apache.commons.codec.binary.Base64;

private static String uuidToBase64(String str) {
    Base64 base64 = new Base64();
    UUID uuid = UUID.fromString(str);
    ByteBuffer bb = ByteBuffer.wrap(new byte[16]);
    bb.putLong(uuid.getMostSignificantBits());
    bb.putLong(uuid.getLeastSignificantBits());
    return base64.encodeBase64URLSafeString(bb.array());
}
private static String uuidFromBase64(String str) {
    Base64 base64 = new Base64(); 
    byte[] bytes = base64.decodeBase64(str);
    ByteBuffer bb = ByteBuffer.wrap(bytes);
    UUID uuid = new UUID(bb.getLong(), bb.getLong());
    return uuid.toString();
} 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-04-21T14:46:18.440

您可以在此应用程序中安全地删除填充“==”。如果您要将 base-64 文本解码回字节，一些库会期望它存在，但由于您只是使用生成的字符串作为键，所以这不是问题。

我会使用 Base-64，因为它的编码字符可以是 URL 安全的，而且看起来不像乱码。但也有[Base-85](http://en.wikipedia.org/wiki/Base-85)。它使用更多的符号并将 4 个字节编码为 5 个字符，因此您可以将文本减少到 20 个字符。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2013-08-05T11:33:27.780

这是我的代码，它使用 org.apache.commons.codec.binary.Base64 生成长度为 22 个字符的 url 安全的唯一字符串（并且与 UUID 具有相同的唯一性）。

```
private static Base64 BASE64 = new Base64(true);
public static String generateKey(){
    UUID uuid = UUID.randomUUID();
    byte[] uuidArray = KeyGenerator.toByteArray(uuid);
    byte[] encodedArray = BASE64.encode(uuidArray);
    String returnValue = new String(encodedArray);
    returnValue = StringUtils.removeEnd(returnValue, "\r\n");
    return returnValue;
}
public static UUID convertKey(String key){
    UUID returnValue = null;
    if(StringUtils.isNotBlank(key)){
        // Convert base64 string to a byte array
        byte[] decodedArray = BASE64.decode(key);
        returnValue = KeyGenerator.fromByteArray(decodedArray);
    }
    return returnValue;
}
private static byte[] toByteArray(UUID uuid) {
    byte[] byteArray = new byte[(Long.SIZE / Byte.SIZE) * 2];
    ByteBuffer buffer = ByteBuffer.wrap(byteArray);
    LongBuffer longBuffer = buffer.asLongBuffer();
    longBuffer.put(new long[] { uuid.getMostSignificantBits(), uuid.getLeastSignificantBits() });
    return byteArray;
}
private static UUID fromByteArray(byte[] bytes) {
    ByteBuffer buffer = ByteBuffer.wrap(bytes);
    LongBuffer longBuffer = buffer.asLongBuffer();
    return new UUID(longBuffer.get(0), longBuffer.get(1));
} 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-04-24T15:35:22.107

我有一个应用程序，我几乎就是这样做的。22 个字符编码的 UUID。它工作正常。但是，我这样做的主要原因是 ID 暴露在 Web 应用程序的 URI 中，对于出现在 URI 中的内容来说，36 个字符确实相当大。22 个字符仍然有点长，但我们凑合了。

这是用于此的 Ruby 代码：

```
 # Make an array of 64 URL-safe characters
  CHARS64 = ("a".."z").to_a + ("A".."Z").to_a + ("0".."9").to_a + ["-", "_"]
  # Return a 22 byte URL-safe string, encoded six bits at a time using 64 characters
  def to_s22
    integer = self.to_i # UUID as a raw integer
    rval = ""
    22.times do
      c = (integer & 0x3F)
      rval += CHARS64[c]
      integer = integer >> 6
    end
    return rval.reverse
  end 
```

它与 base64 编码不完全相同，因为 base64 使用的字符如果出现在 URI 路径组件中则必须进行转义。Java 实现可能会完全不同，因为您更有可能拥有一个原始字节数组而不是一个非常大的整数。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2019-04-02T12:16:43.607

这是`java.util.Base64`JDK8中引入的示例：

```
import java.nio.ByteBuffer;
import java.util.Base64;
import java.util.Base64.Encoder;
import java.util.UUID;

public class Uuid64 {

  private static final Encoder BASE64_URL_ENCODER = Base64.getUrlEncoder().withoutPadding();

  public static void main(String[] args) {
    // String uuidStr = UUID.randomUUID().toString();
    String uuidStr = "eb55c9cc-1fc1-43da-9adb-d9c66bb259ad";
    String uuid64 = uuidHexToUuid64(uuidStr);
    System.out.println(uuid64); //=> 61XJzB_BQ9qa29nGa7JZrQ
    System.out.println(uuid64.length()); //=> 22
    String uuidHex = uuid64ToUuidHex(uuid64);
    System.out.println(uuidHex); //=> eb55c9cc-1fc1-43da-9adb-d9c66bb259ad
  }

  public static String uuidHexToUuid64(String uuidStr) {
    UUID uuid = UUID.fromString(uuidStr);
    byte[] bytes = uuidToBytes(uuid);
    return BASE64_URL_ENCODER.encodeToString(bytes);
  }

  public static String uuid64ToUuidHex(String uuid64) {
    byte[] decoded = Base64.getUrlDecoder().decode(uuid64);
    UUID uuid = uuidFromBytes(decoded);
    return uuid.toString();
  }

  public static byte[] uuidToBytes(UUID uuid) {
    ByteBuffer bb = ByteBuffer.wrap(new byte[16]);
    bb.putLong(uuid.getMostSignificantBits());
    bb.putLong(uuid.getLeastSignificantBits());
    return bb.array();
  }

  public static UUID uuidFromBytes(byte[] decoded) {
    ByteBuffer bb = ByteBuffer.wrap(decoded);
    long mostSigBits = bb.getLong();
    long leastSigBits = bb.getLong();
    return new UUID(mostSigBits, leastSigBits);
  }
} 
```

Base64 编码的 UUID 是 URL 安全的，没有填充。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-21T14:30:33.830

您没有说您使用的是什么 DBMS，但如果您担心节省空间，RAW 似乎是最好的方法。您只需要记住为所有查询进行转换，否则您将面临性能大幅下降的风险。

但我不得不问：你住的地方字节真的那么贵吗？

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2020-02-04T11:52:39.850

这不完全是您所要求的（它不是 Base64），但值得一看，因为增加了灵活性：有一个 Clojure 库，它实现了 UUID 的紧凑的 26 字符 URL 安全表示（[https://github .com/tonsky/compact-uuids](https://github.com/tonsky/compact-uuids)）。

一些亮点：

*   生成小 30% 的字符串（26 个字符与传统的 36 个字符）
*   支持完整的 UUID 范围（128 位）
*   编码安全（仅使用 ASCII 中的可读字符）
*   URL/文件名安全
*   小写/大写安全
*   避免模​​棱两可的字符 (i/I/l/L/1/O/o/0)
*   编码的 26 字符字符串上的字母排序与默认 UUID 排序顺序匹配

这些都是相当不错的属性。我一直在我的应用程序中将这种编码用于数据库键和用户可见的标识符，并且效果很好。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-09-11T15:36:29.440

下面是我用于 UUID（梳状样式）的内容。它包括用于将 uuid 字符串或 uuid 类型转换为 base64 的代码。我每 64 位执行一次，所以我不处理任何等号：

## JAVA

```
import java.util.Calendar;
import java.util.UUID;
import org.apache.commons.codec.binary.Base64;

public class UUIDUtil{
    public static UUID combUUID(){
        private UUID srcUUID = UUID.randomUUID();
        private java.sql.Timestamp ts = new java.sql.Timestamp(Calendar.getInstance().getTime().getTime());

        long upper16OfLowerUUID = this.zeroLower48BitsOfLong( srcUUID.getLeastSignificantBits() );
        long lower48Time = UUIDUtil.zeroUpper16BitsOfLong( ts );
        long lowerLongForNewUUID = upper16OfLowerUUID | lower48Time;
        return new UUID( srcUUID.getMostSignificantBits(), lowerLongForNewUUID );
    }   
    public static base64URLSafeOfUUIDObject( UUID uuid ){
        byte[] bytes = ByteBuffer.allocate(16).putLong(0, uuid.getLeastSignificantBits()).putLong(8, uuid.getMostSignificantBits()).array();
        return Base64.encodeBase64URLSafeString( bytes );
    }
    public static base64URLSafeOfUUIDString( String uuidString ){
    UUID uuid = UUID.fromString( uuidString );
        return UUIDUtil.base64URLSafeOfUUIDObject( uuid );
    }
    private static long zeroLower48BitsOfLong( long longVar ){
        long upper16BitMask =  -281474976710656L;
        return longVar & upper16BitMask;
    }
    private static void zeroUpper16BitsOfLong( long longVar ){
        long lower48BitMask =  281474976710656L-1L;
        return longVar & lower48BitMask;
    }
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2021-08-24T15:22:51.050

编解码器[`Base64Codec`](https://github.com/f4b6a3/uuid-creator/blob/master/src/main/java/com/github/f4b6a3/uuid/codec/base/Base64Codec.java)可以[`Base64UrlCodec`](https://github.com/f4b6a3/uuid-creator/blob/master/src/main/java/com/github/f4b6a3/uuid/codec/base/Base64UrlCodec.java)有效地将 UUID 编码为 base-64 和 base-64-url。

```
// Returns a base-64 string
// input:: 01234567-89AB-4DEF-A123-456789ABCDEF
// output: ASNFZ4mrTe+hI0VniavN7w
String string = Base64Codec.INSTANCE.encode(uuid); 
```

```
// Returns a base-64-url string
// input:: 01234567-89AB-4DEF-A123-456789ABCDEF
// output: ASNFZ4mrTe-hI0VniavN7w
String string = Base64UrlCodec.INSTANCE.encode(uuid); 
```

[在uuid-creator的同一个](https://github.com/f4b6a3/uuid-creator)[包](https://github.com/f4b6a3/uuid-creator/tree/master/src/main/java/com/github/f4b6a3/uuid/codec/base)中有其他编码的编解码器。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-04-01T13:42:05.510

`uuidToByteArray(…)`令 commons-lang3中没有人感到惊讶。

```
<dependency>
    <groupId>org.apache.commons</groupId>
    <artifactId>commons-lang3</artifactId>
    <version>3.12.0</version>
</dependency> 
```

然后代码将是

```
import org.apache.commons.lang3.Conversion;
import java.util.*;

public static byte[] asByteArray(UUID uuid) {
    return Conversion.uuidToByteArray(uuid, new byte[16], 0, 16);
} 
```

# sql - 如何将此 Lambda 表达式转换为 SQL 语句？

> ID：772807
> 
> 赞同：0
> 
> 时间：2009-04-21T14:19:15.620
> 
> 标签：sql, sql-server, lambda

我有一个 lambda 表达式，它有：

```
Convert.ToDateTime(a.startTime).TimeOfDay >= Convert.ToDateTime(startTime).TimeOfDay 
```

但是，我必须在 SQL Server 中创建一个程序，上面的语句应该如何转换为 SQL 语句？

我尝试使用某种 'convert(starttime, getdate(),8) 但它没有用。

而且我忘了说'startTime'是一个DateTime字段，我试图只比较时间部分（忘记日期部分）。

谢谢！！！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T14:37:08.040

从[这里](http://weblogs.asp.net/guerchele/archive/2004/05/04/125899.aspx)：

```
CREATE FUNCTION dbo.TIMEVALUE
(
 @Datetime datetime
)
/*******************************************************************************
 * AUTHOR: Luciano Evaristo Guerche                                            *
 *******************************************************************************/
RETURNS datetime
AS
BEGIN
    RETURN (@Datetime - CAST(ROUND(CAST(@Datetime AS float), 0, 1) AS datetime))
END
GO 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T14:29:58.713

你有没有尝试过：

```
CAST(starttime as time) 
```

看看这个更详细的[时间（Transact-SQL）](http://msdn.microsoft.com/en-us/library/bb677243.aspx)

# python - 如何使用 python 创建受密码保护的 zipfile？

> ID：772814
> 
> 赞同：3
> 
> 时间：2009-04-21T14:20:48.440
> 
> 标签：python, zip

从 python2.6 开始，现在更容易从受密码保护的 zip 中提取数据。但是如何在纯 python 中创建受密码保护的 zipfile 呢？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-21T14:26:39.860

我过去一直在寻找这个，但没有成功。（我很乐意看到发布解决方案！）

一种选择是来自 chilkatsoft 的商业软件包，它可以做到这一点，但价格为 150 美元。如果你正在做一个商业应用程序是有道理的，但否则很难接受。

不久前，我最终向系统寻求解决方案。不幸的是，这将其锁定在一个平台上。

# asp.net - Web 上的表单提交 - 包含供用户输入的字符的图像

> ID：772815
> 
> 赞同：1
> 
> 时间：2009-04-21T14:21:04.680
> 
> 标签：asp.net

通常，当您在网络上填写表格时，您会被要求从图像中输入一些字符以验证您不是机器人等。

有谁知道 A) 你实际上把这些东西叫做什么？B) 是否有任何第三方工具可用于生成图像？（.NET 重点在这里）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-21T14:21:58.670

[验证码](http://en.wikipedia.org/wiki/Captcha)

术语“CAPTCHA”（基于单词捕获）代表“完全自动化的公共图灵测试，以区分计算机和人类”。

[重新验证码](http://recaptcha.net/)非常受欢迎

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-21T14:22:35.737

A) 验证码
B)[验证码](http://recaptcha.net/ "验证码")

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-21T14:23:16.157

这称为验证码

[http://en.wikipedia.org/wiki/Captcha](http://en.wikipedia.org/wiki/Captcha)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T14:27:00.733

请注意，Recaptcha 有一个[ASP.NET 实现](http://recaptcha.net/plugins/aspnet/)，您应该会发现它很有用。

# c++ - 更多线程，更好的性能？

> ID：772817
> 
> 赞同：5
> 
> 时间：2009-04-21T14:21:24.023
> 
> 标签：c++, multithreading, winapi, message-queue

当我编写消息驱动的应用程序时。很像标准的 Windows 应用程序，只是它广泛使用消息传递进行内部操作，关于线程的最佳方法是什么？

在我看来，基本上有三种方法（如果您有任何其他设置，请分享）：

1.  让一个线程处理所有消息。
2.  为不同的消息类型（通用、UI、网络等）提供不同的线程
3.  拥有多个共享和处理单个消息队列的线程。

那么，这三者之间会存在显着的性能差异吗？以下是一些一般性想法： 显然，最后两个选项受益于有多个处理器的情况。另外，如果任何线程正在等待外部事件，其他线程仍然可以处理不相关的消息。但是忽略这一点，似乎多个线程只会增加开销（线程切换，更不用说更复杂的同步情况）。

还有一个问题：您会建议在标准的 Windows 消息系统上实现这样的系统，还是实现单独的队列机制，为什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-21T15:04:31.640

线程模型的具体选择应该由您要解决的问题的性质决定。为这样的应用程序设计线程模型不一定有一种“正确”的方法。但是，如果我们采用以下假设：

1.  消息频繁到达
2.  消息是独立的，不会过分依赖共享资源
3.  希望尽快响应到达的消息
4.  您希望应用程序能够跨处理架构（即多代码/多 CPU 系统）很好地扩展
5.  可扩展性是关键的设计要求（例如，更多消息以更快的速度）
6.  对线程故障/长时间操作的弹性是可取的

根据我的经验，最有效的线程架构是使用线程池。所有消息都到达一个队列，多个线程在队列上等待并在消息到达时处理它们。线程池实现可以对您拥有的所有三个线程分布示例进行建模。

#1 单线程处理所有消息 => 只有一个线程的线程池

#2 每 N 个消息类型的线程 => 具有 N 个线程的线程池，每个线程查看队列以找到合适的消息类型

#3 所有消息的多个线程 => 具有多个线程的线程池

这种设计的好处是您可以根据处理环境或消息负载成比例地缩放线程中的线程数。线程的数量甚至可以在运行时扩展，以适应正在经历的实时消息负载。

大多数平台都有很多不错的线程池库可用，包括 .NET、C++/STL、Java 等。

至于你的第二个问题，是否使用标准的windows消息调度机制。这种机制会带来很大的开销，并且实际上仅用于通过 Windows 应用程序的 UI 循环来泵送消息。除非这是您要解决的问题，否则我建议不要将其用作一般的消息发送解决方案。此外，Windows 消息携带的数据非常少——它不是基于对象的模型。每个 Windows 消息都有一个代码和一个 32 位参数。这可能不足以建立一个干净的消息传递模型。最后，windows 消息队列不是为处理队列饱和、线程不足或消息重新排队等情况而设计的；这些是在实施一个体面的消息队列解决方案时经常出现的情况。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-21T14:31:09.710

在不知道工作量（即事件随时间的统计分布）的情况下，我们无法确定地告诉您太多信息，但总的来说

*   具有多个服务器的单个队列至少一样快，而且通常更快，因此 1,3 比 2 更可取。
*   由于需要避免争用和多写者问题，大多数语言中的多线程会增加复杂性
*   长时间的进程可能会阻止其他可以更快完成的事情的处理。

所以马背猜测是，有一个事件队列，有几个服务器线程从队列中取出事件，*可能*会快一点。

确保为队列使用线程安全的数据结构。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-21T14:57:31.707

这一切都取决于。

例如：

*   GUI 队列中的事件最好由单个线程完成，因为事件中有隐含的顺序，因此它们需要串行完成。这就是为什么大多数 GUI 应用程序只有一个线程来处理事件，尽管可能有多个事件来创建它们（并且它不排除事件线程创建作业并将其处理到工作池（见下文））。

*   套接字上的事件可能会并行完成（假设 HTTP），因为每个请求都是无状态的，因此可以独立完成（好吧，我知道这过于简化 HTTP）。

*   工作作业是每个作业都是独立的并放在队列中。这是使用一组工作线程的经典案例。每个线程独立于其他线程执行潜在的长时间操作。完成后返回队列等待另一项工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-21T15:23:11.457

请注意，有两个不同的性能目标，您没有说明您的目标是什么：吞吐量和响应能力。

如果您正在编写 GUI 应用程序，则 UI 需要具有响应性。您并不关心每秒可以处理多少次点击，但您确实关心在 10 秒左右（理想情况下更少）内显示一些响应。这是最好有一个专门用于处理 GUI 的单个线程的原因之一（其他原因已在其他答案中提到）。GUI 线程需要基本上将 Windows 消息转换为工作项，并让您的工作队列处理繁重的工作。一旦工作人员完成，它会通知 GUI 线程，然后更新显示以反映任何更改。它执行诸如绘制窗口之类的操作，但不渲染要显示的数据。这为应用程序提供了一种快速的“敏捷性”，这是大多数用户在谈论性能时想要的。他们不

另一个性能特征是吞吐量。这是您可以在特定时间内处理的作业数量。通常这种类型的性能调整只需要在服务器类型的应用程序或其他重型处理上。这衡量了一个小时内可以提供多少网页，或者渲染一张 DVD 需要多长时间。对于这类作业，您希望每个 CPU 有 1 个活动线程。比这少，你将浪费空闲的时钟周期。不仅如此，线程将争夺 CPU 时间并相互绊倒。查看本文[DDJ 文章](http://www.ddj.com/hpc-high-performance-computing/211800538)中的第二张图表，了解您正在处理的权衡。请注意，由于阻塞和锁定等原因，理想的线程数高于可用 CPU 的数量。关键是数量*活动*线程。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-21T14:34:53.757

一般来说，不用担心线程的开销。如果您仅谈论其中的一小部分，那将不是问题。竞争条件、死锁和争用是一个更大的问题，如果你不知道我在说什么，在你解决这个问题之前你需要做很多阅读。

我会选择选项 3，使用我选择的语言提供的任何抽象。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-21T18:07:49.983

是的，您的选择之间会有性能差异。

(1) 引入了消息处理的瓶颈
(3) 引入了锁定争用，因为您需要同步对共享队列的访问。

(2) 开始朝着正确的方向前进……尽管每种消息类型的队列都有些极端。我可能会建议您从应用程序中的每个模型的队列开始，然后添加队列以提高性能。

如果您喜欢选项 #2，听起来您会对实现[SEDA 架构](http://www.eecs.harvard.edu/~mdw/proj/seda/)感兴趣。需要阅读一些内容才能了解正在发生的事情，但我认为该架构非常适合您的思路。

顺便说一句，[Yield](http://code.google.com/p/yield/)是一个很好的 C++/Python 混合实现。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-21T22:20:29.343

我将有一个线程池为消息队列提供服务，并使池中的线程数易于配置（甚至可能在运行时）。然后用预期的负载对其进行测试。

这样你就可以看到实际的相关性是什么——如果你最初的假设发生了变化，你可以很容易地改变你的方法。

一种更复杂的方法是让系统自省其自身的性能特征并调整其对资源的使用，尤其是线程。对于大多数自定义应用程序代码来说，这可能是矫枉过正，但我​​敢肯定有产品可以做到这一点。

至于 Windows 事件问题 - 我认为这可能是一个特定于应用程序的问题，在一般情况下没有正确或错误的答案。也就是说，我通常实现自己的队列，因为我可以根据手头任务的特定特征对其进行定制。有时这可能涉及通过 Windows 消息队列路由事件。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-21T15:27:52.147

我认为选项2是最好的。让每个线程执行独立的任务会给你最好的结果。如果多个线程正在执行一些 I/O 操作（如磁盘读取、读取公共套接字等），第三种方法可能会导致更多延迟。

是否使用 Windows 消息传递框架来处理请求取决于每个线程的工作负载。我认为windows限制了no。最多可以排队到 10000 条消息。对于大多数情况，这应该不是问题。但是，如果您有很多消息要排队，这可能是需要考虑的事情。

从某种意义上说，单独的队列提供了更好的控制，您可以按照自己想要的方式对其进行重新排序（可能取决于优先级）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-21T14:32:52.810

一个好的开始是问问自己为什么需要多个线程。

对这个问题深思熟虑的答案将引导您对后续问题“我应该如何在我的应用程序中使用多个线程？”的最佳答案。

这一定是一个后续问题；不是主要问题。第一个问题必须是为什么，而不是如何。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-21T14:33:29.860

我认为这取决于每个线程将运行多长时间。每条消息的处理时间是否相同？或者某些消息会花费几秒钟的时间。如果我知道消息 A 需要 10 秒才能完成，我肯定会使用一个新线程，因为我为什么要让队列等待一个长时间运行的线程......

我的 2 美分。

# flash - flash中位图歪斜的解决方案

> ID：772822
> 
> 赞同：4
> 
> 时间：2009-04-21T14:23:03.643
> 
> 标签：flash, actionscript-3

我正在寻找歪斜图像的解决方案。Flash 只允许倾斜基于矢量的对象。我尝试使用矩阵，但找不到合适的解决方案。我们的目标是做一个像三折小册子一样的东西，它分两步折叠起来。

有人对此有提示或示例代码吗？

* * *

更新！

也许我的信息用语言表达有点错误。Flash 允许倾斜，例如，将矩形倾斜为菱形。

```
 -------         -------
|       |        \      \
|       |   =>    \      \
|       |          \      \
 -------            ------- 
```

这不是我的意思的限制。我可以像这样对矢量和位图进行所见即所得的倾斜。我需要做这样的事情：

```
 -------         |`
|       |        |  `|
|       |   =>   |   |
|       |        |  ´
 -------         |´ 
```

根据 Bryan Grezeszak 的回答，我在链接页面上玩了转换影片剪辑。当我说不可能用矩阵做到这一点时，我是对的吗？如果是，是否还有其他可能实现这一目标？

谢谢 =)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-21T17:16:35.163

根据您的更新进行编辑：您指定的转换正是使用 Flash 10 中的 Matrix3D 完成的。他们将其从 3x3 矩阵更改为 4x4 矩阵，以允许您尝试进行倾斜。如果您使用的是 flash 10，那么 Matrix3D 就是您的答案。如果没有，请尝试 AS3 3D 引擎，例如 Papervision 或 Away3D。

如果您使用的是 Flash 10，则查找它的 Matrix3D 对象（仅在 Flash 10 中），因为它允许对象的更多倾斜、实际的 3D 透视等，这正是您要查找的内容：)

除此之外，对象的变换矩阵是做什么的。它是一个 flash.geom.Matrix 对象，可以使用 your_object.transform.matrix 在任何 DisplayObject（包括位图）上访问；

习惯起来可能会很棘手，但这是我所知道的最全面的处理它的来源：[Senocular Matrix Article](http://www.senocular.com/flash/tutorials/transformmatrix/)

那篇文章是针对 Flash 8 的，但功能几乎没有更改为 AS3，因此它仍然是一个有价值的资源。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-05T09:12:38.097

可惜年份没有出现在日期...希望是 2009

答案在这里 [http://evolve.reintroducing.com/2007/11/18/as3/as3-distortiontweener/](http://evolve.reintroducing.com/2007/11/18/as3/as3-distortiontweener/)

;-) 诺布尔

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-19T03:06:03.290

fp9 解决方案：[http ://www.rubenswieringa.com/blog/distortimage](http://www.rubenswieringa.com/blog/distortimage)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-21T15:33:01.590

您可以倾斜 Flash IDE 时间轴上的任何影片剪辑，甚至是包含位图图像的影片剪辑，但没有倾斜属性。对于更动态的东西，您可以创建一个动画剪辑，其中包含 200（例如）帧动画，从一个极端倾斜到另一个极端，然后动态地将内容添加到该动画剪辑。哈克，但它会工作。如果您能掌握数学知识，您可以使用 Flash Player 10 中的矩阵变换来实现效果。

# c# - 什么是 Hashtable 的通用版本？

> ID：772831
> 
> 赞同：77
> 
> 时间：2009-04-21T14:23:56.310
> 
> 标签：c#, .net, generics

我一直在学习 .NET 中的泛型基础知识。但是，我没有看到`Hashtable`. 请分享一些用于创建通用哈希表类的示例 C# 代码。

* * *

## 回答 #1

> 赞同：102
> 
> 时间：2009-04-21T14:25:27.273

[`Dictionary<TKey, TValue>`](http://msdn.microsoft.com/en-us/library/xfhwa508.aspx)

请注意，Dictionary 并不是 HashTable 的 100% 替代品。

它们处理 NULL 的方式略有不同。如果您尝试引用不存在的键，字典将引发异常。HashTable 只会返回 null。原因是该值可能是一个值类型，*不能*为空。在 Hashtable 中，值始终是 Object，因此返回 null 至少是可能的。

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2009-04-21T14:25:37.773

Hashtable 类的通用版本是[System.Collections.Generic.Dictionary](http://msdn.microsoft.com/en-us/library/xfhwa508(loband).aspx)类。

[示例代码](http://en.csharp-online.net/CSharp_Generics_Recipes%E2%80%94Replacing_the_Hashtable_with_Its_Generic_Counterpart)：

```
Dictionary<int, string> numbers = new Dictionary<int, string>( );
   numbers.Add(1, "one");
   numbers.Add(2, "two");
   // Display all key/value pairs in the Dictionary.
   foreach (KeyValuePair<int, string> kvp in numbers)
   {
      Console.WriteLine("Key: " + kvp.Key + "\tValue: " + kvp.Value);
   } 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-04-21T14:31:13.953

Hashtable 的通用版本是`Dictionary<TKey,TValue>`类（[链接](http://msdn.microsoft.com/en-us/library/xfhwa508.aspx)）。这是一些从使用 Hashtable 转换为最直接等效的 Dictionary 的示例代码（为简洁起见，删除了参数检查）

```
public HashTable Create(int[] keys, string[] values) { 
  HashTable table = new HashTable();
  for ( int i = 0; i < keys.Length; i++ ) {
    table[keys[i]] = values[i];
  }
  return table;
}

public Dictionary<object,object> Create(int[] keys, string[] values) {
  Dictionary<object,object> map = Dictionary<object,object>();
  for ( int i = 0; i < keys.Length; i++) {
    map[keys[i]] = values[i];
  }
  return map;
} 
```

这是一个相当直接的翻译。但问题是这实际上并没有利用泛型的类型安全特性。第二个函数可以编写如下，并且类型更安全，并且不会产生装箱开销

```
public Dictionary<int,string> Create(int[] keys, string[] values) {
  Dictionary<int,string> map = Dictionary<int,string>();
  for ( int i = 0; i < keys.Length; i++) {
    map[keys[i]] = values[i];
  }
  return map;
} 
```

甚至更好。这是一个完全通用的版本

```
public Dictionary<TKey,TValue> Create<TKey,TValue>(TKey[] keys, TValue[] values) {
  Dictionary<TKey,TValue> map = Dictionary<TKey,TValue>();
  for ( int i = 0; i < keys.Length; i++) {
    map[keys[i]] = values[i];
  }
  return map;
} 
```

还有一个更加灵活（感谢乔尔指出我错过了这一点）

```
public Dictionary<TKey,TValue> Create<TKey,TValue>(
    IEnumerable<TKey> keys, 
    IEnumerable<TValue> values) {

  Dictionary<TKey,TValue> map = Dictionary<TKey,TValue>();
  using ( IEnumerater<TKey> keyEnum = keys.GetEnumerator() ) 
  using ( IEnumerator<TValue> valueEnum = values.GetEnumerator()) {
    while (keyEnum.MoveNext() && valueEnum.MoveNext() ) { 
      map[keyEnum.Current] = valueEnum.Current;
    }
  }
  return map;
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2015-09-12T00:05:12.510

对于那些感兴趣的人，我创建了一个泛型 Hashtable 包装类，它对于强制类型安全很有用，可以作为泛型 IDictionary、ICollection 和 IEnumerable 类型传递，而非泛型 Hashtable 则不能。下面是实现。

```
using System;
using System.Collections;
using System.Collections.Generic;
using System.Linq;
using System.Text;

namespace Common.Collections.Generic
{
    public class Hashtable<TKey, TValue> : IDictionary<TKey, TValue>
        , ICollection<KeyValuePair<TKey, TValue>>
        , IEnumerable<KeyValuePair<TKey, TValue>>
        , IDictionary
        , ICollection
        , IEnumerable
    {
        protected Hashtable _items;
        /// <summary>
        /// Initializes a new, empty instance of the Hashtable class using the default initial capacity, load factor, hash code provider, and comparer.
        /// </summary>
        public Hashtable()
        {
            _items = new Hashtable();
        }
        /// <summary>
        /// Initializes a new, empty instance of the Hashtable class using the specified initial capacity, and the default load factor, hash code provider, and comparer.
        /// </summary>
        /// <param name="capacity">The approximate number of elements that the Hashtable object can initially contain. </param>
        public Hashtable(int capacity)
        {
            _items = new Hashtable(capacity);
        }
        /// <summary>
        /// Actual underlying hashtable object that contains the elements.
        /// </summary>
        public Hashtable Items { get { return _items; } }

        /// <summary>
        /// Adds an element with the specified key and value into the Hashtable.
        /// </summary>
        /// <param name="key">Key of the new element to add.</param>
        /// <param name="value">Value of the new elment to add.</param>
        public void Add(TKey key, TValue value)
        {
            _items.Add(key, value);
        }
        /// <summary>
        /// Adds an element with the specified key and value into the Hashtable.
        /// </summary>
        /// <param name="item">Item containing the key and value to add.</param>
        public void Add(KeyValuePair<TKey, TValue> item)
        {
            _items.Add(item.Key, item.Value);
        }

        void IDictionary.Add(object key, object value)
        {
            this.Add((TKey)key, (TValue)value);
        }
        /// <summary>
        /// Add a list of key/value pairs to the hashtable.
        /// </summary>
        /// <param name="collection">List of key/value pairs to add to hashtable.</param>
        public void AddRange(IEnumerable<KeyValuePair<TKey, TValue>> collection)
        {
            foreach (var item in collection)
                _items.Add(item.Key, item.Value);
        }
        /// <summary>
        /// Determines whether the Hashtable contains a specific key.
        /// </summary>
        /// <param name="key">Key to locate.</param>
        /// <returns>True if key is found, otherwise false.</returns>
        public bool ContainsKey(TKey key)
        {
            return _items.ContainsKey(key);
        }
        /// <summary>
        /// Determines whether the Hashtable contains a specific key.
        /// </summary>
        /// <param name="item">Item containing the key to locate.</param>
        /// <returns>True if item.Key is found, otherwise false.</returns>
        public bool Contains(KeyValuePair<TKey, TValue> item)
        {
            return _items.ContainsKey(item.Key);
        }

        bool IDictionary.Contains(object key)
        {
            return this.ContainsKey((TKey)key);
        }
        /// <summary>
        /// Gets an ICollection containing the keys in the Hashtable.
        /// </summary>
        public ICollection<TKey> Keys
        {
            get { return _items.ToList<TKey>(); }
        }

        ICollection IDictionary.Keys
        {
            get { return this.Keys.ToList(); }
        }
        /// <summary>
        /// Gets the value associated with the specified key.
        /// </summary>
        /// <param name="key">The key of the value to get.</param>
        /// <param name="value">When this method returns, contains the value associated with the specified key,
        /// if the key is found; otherwise, the default value for the type of the value parameter. This parameter 
        /// is passed uninitialized.</param>
        /// <returns>true if the hashtable contains an element with the specified key, otherwise false.</returns>
        public bool TryGetValue(TKey key, out TValue value)
        {
            value = (TValue)_items[key];
            return (value != null);
        }
        /// <summary>
        /// Gets an ICollection containing the values in the Hashtable.
        /// </summary>
        public ICollection<TValue> Values
        {
            get { return _items.Values.ToList<TValue>(); }
        }

        ICollection IDictionary.Values
        {
            get { return this.Values.ToList(); }
        }
        /// <summary>
        /// Gets or sets the value associated with the specified key.
        /// </summary>
        /// <param name="key">The key whose value to get or set. </param>
        /// <returns>The value associated with the specified key. If the specified key is not found, 
        /// attempting to get it returns null, and attempting to set it creates a new element using the specified key.</returns>
        public TValue this[TKey key]
        {
            get
            {
                return (TValue)_items[key];
            }
            set
            {
                _items[key] = value;
            }
        }
        /// <summary>
        /// Removes all elements from the Hashtable.
        /// </summary>
        public void Clear()
        {
            _items.Clear();
        }
        /// <summary>
        /// Copies all key/value pairs in the hashtable to the specified array.
        /// </summary>
        /// <param name="array">Object array to store objects of type "KeyValuePair&lt;TKey, TValue&gt;"</param>
        /// <param name="arrayIndex">Starting index to store objects into array.</param>
        public void CopyTo(Array array, int arrayIndex)
        {
            _items.CopyTo(array, arrayIndex);
        }
        /// <summary>
        /// Copies all key/value pairs in the hashtable to the specified array.
        /// </summary>
        /// <param name="array">Object array to store objects of type "KeyValuePair&lt;TKey, TValue&gt;"</param>
        /// <param name="arrayIndex">Starting index to store objects into array.</param>
        public void CopyTo(KeyValuePair<TKey, TValue>[] array, int arrayIndex)
        {
            _items.CopyTo(array, arrayIndex);
        }
        /// <summary>
        /// Gets the number of key/value pairs contained in the Hashtable.
        /// </summary>
        public int Count
        {
            get { return _items.Count; }
        }
        /// <summary>
        /// Gets a value indicating whether the Hashtable has a fixed size.
        /// </summary>
        public bool IsFixedSize
        {
            get { return _items.IsFixedSize; }
        }
        /// <summary>
        /// Gets a value indicating whether the Hashtable is read-only.
        /// </summary>
        public bool IsReadOnly
        {
            get { return _items.IsReadOnly; }
        }
        /// <summary>
        /// Gets a value indicating whether access to the Hashtable is synchronized (thread safe).
        /// </summary>
        public bool IsSynchronized
        {
            get { return _items.IsSynchronized; }
        }
        /// <summary>
        /// Gets an object that can be used to synchronize access to the Hashtable.
        /// </summary>
        public object SyncRoot
        {
            get { return _items.SyncRoot; }
        }
        /// <summary>
        /// Removes the element with the specified key from the Hashtable.
        /// </summary>
        /// <param name="key">Key of the element to remove.</param>
        public void Remove(TKey key)
        {
            _items.Remove(key);
        }
        /// <summary>
        /// Removes the element with the specified key from the Hashtable.
        /// </summary>
        /// <param name="item">Item containing the key of the element to remove.</param>
        public void Remove(KeyValuePair<TKey, TValue> item)
        {
            this.Remove(item.Key);
        }

        bool IDictionary<TKey, TValue>.Remove(TKey key)
        {
            var numValues = _items.Count;
            _items.Remove(key);
            return numValues > _items.Count;
        }

        bool ICollection<KeyValuePair<TKey, TValue>>.Remove(KeyValuePair<TKey, TValue> item)
        {
            var numValues = _items.Count;
            _items.Remove(item.Key);
            return numValues > _items.Count;
        }

        void IDictionary.Remove(object key)
        {
            _items.Remove(key);
        }
        /// <summary>
        /// Returns an enumerator that iterates through the hashtable.
        /// </summary>
        /// <returns>An enumerator for a list of key/value pairs.</returns>
        public IEnumerator<KeyValuePair<TKey, TValue>> GetEnumerator()
        {
            foreach (DictionaryEntry? item in _items)
                yield return new KeyValuePair<TKey, TValue>((TKey)item.Value.Key, (TValue)item.Value.Value);
        }
        /// <summary>
        /// Returns an enumerator that iterates through the hashtable.
        /// </summary>
        /// <returns>An enumerator for a list of key/value pairs as generic objects.</returns>
        IEnumerator IEnumerable.GetEnumerator()
        {
            return this.GetEnumerator();
        }

        IDictionaryEnumerator IDictionary.GetEnumerator()
        {
            // Very old enumerator that no one uses anymore, not supported.
            throw new NotImplementedException(); 
        }

        object IDictionary.this[object key]
        {
            get
            {
                return _items[(TKey)key];
            }
            set
            {
                _items[(TKey)key] = value;
            }
        }
    }
} 
```

我已经对此 Hashtable 与 Dictionary 进行了一些测试，发现两者在与字符串键和字符串值对一起使用时表现大致相同，除了 Hashtable 似乎使用更少的内存。我的测试结果如下：

```
TestInitialize Dictionary_50K_Hashtable
Number objects 50000, memory usage 905164
Insert, 22 milliseconds.
A search not found, 0 milliseconds.
Search found, 0 milliseconds.
Remove, 0 milliseconds.
Search found or not found, 0 milliseconds.
TestCleanup Dictionary_50K_Hashtable

TestInitialize Dictionary_50K_Dictionary
Number objects 50000, memory usage 1508316
Insert, 16 milliseconds.
A search not found, 0 milliseconds.
Search found, 0 milliseconds.
Remove, 0 milliseconds.
Search found or not found, 0 milliseconds.
TestCleanup Dictionary_50K_Dictionary 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-21T14:25:29.317

的通用版本[`System.Collection.Hashtable`](http://msdn.microsoft.com/en-us/library/system.collections.hashtable.aspx)是[`System.Collections.Generic.Dictionary<TKey, TValue>`](http://msdn.microsoft.com/en-us/library/xfhwa508.aspx).

# iphone - 程序访问 iPhone 音量按钮

> ID：772832
> 
> 赞同：23
> 
> 时间：2009-04-21T14:24:05.810
> 
> 标签：iphone, objective-c

有没有办法订阅音量按钮按下事件？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-21T14:30:09.027

**在最近被苹果拒绝之后**

不要使用这个。Apple 现在使用一些补丁程序，如果它使用任何私有 API，它会立即拒绝您的应用程序 - 尽管在这里应该注意，App Store 上的相当多的应用程序已经使用并且仍然存在！

现在唯一的方法是让 AVAudioPlayer 准备好播放但不播放（[player prepareToPlay]）。这似乎可以根据摇杆按钮调整应用程序的音量。

目前没有其他已发布的方法来处理这个问题。

**请阅读上述说明**

是的，使用 MPVolumeView

```
MPVolumeView *volume = [[[MPVolumeView alloc] initWithFrame:CGRectMake(18.0, 340.0, 284.0, 23.0)] autorelease];
  [[self view] addSubview:volume];

  [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(volumeChanged:) 
                                        name:@"AVSystemController_SystemVolumeDidChangeNotification" 
                                        object:nil];    
  for (UIView *view in [volume subviews]){
    if ([[[view class] description] isEqualToString:@"MPVolumeSlider"]) {
      volumeViewSlider = view;  //volumeViewSlider is a UIView * object
    }
  }
  [volumeViewSlider _updateVolumeFromAVSystemController];

-(IBAction)volumeChanged:(id)sender{
  [volumeViewSlider _updateVolumeFromAVSystemController];
} 
```

这将为您提供一个滑块（与 ipod 中使用的滑块相同），其值将根据手机的音量而变化

您将收到一个编译时警告，即视图可能不会响应 _updateVolumeFromAVSystemControl，而只是忽略它。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2010-06-26T09:09:15.767

如果您只想获取通知，我认为是这样的：

如果我错了，请纠正我，但我不相信这使用任何内部 API。

```
[[NSNotificationCenter defaultCenter] addObserver:self
        selector:@selector(volumeChanged:) 
        name:@"AVSystemController_SystemVolumeDidChangeNotification" 
        object:nil]; 
```

此事件的详细信息在这里：[http ://www.cocoadev.com/index.pl?AVSystemController](http://www.cocoadev.com/index.pl?AVSystemController)

这里的其他回复似乎是基于这个 hack： http: [//blog.stormyprods.com/2008/09/proper-usage-of-mpvolumeview-class.html](http://blog.stormyprods.com/2008/09/proper-usage-of-mpvolumeview-class.html)这是一个现在修复的错误的解决方法。

但我很确定如果你想做的只是*获取*通知，而不是*设置*系统音量，你可以像处理任何其他事件一样使用通知中心！！

请注意：由于 Apple 在相机中添加了音量增大操作，因此在可见时*不会*发布此通知。`UIImagePickerController`

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-05-21T08:42:35.587

我在研究上面提到的所有资源和其他线程中发现的最简单和功能最完整的方法是：[JPSVolumeButtonHandler](https://github.com/jpsim/JPSVolumeButtonHandler)（除了作为用户之外我没有参与。但非常感谢负责人！）

编辑：版本 1.0.2 带有一些重大更改/增强功能。我将把我之前对 1.0.1 的回答保留在首屏下方。

我放了一个示例包装类，您可以按原样部署，也可以在此处快速学习 JPSVolumeButtonHandler 在[单独的 Github 存储库](https://github.com/jmbremer/PhysicalButton)中的正确使用。

以下是包装器的使用方式（我会尽快将其添加到存储库中）：

1.  单例类有两个标志：`isInUse`和`isOn`. `isInUse`旨在在某种通用应用程序设置中进行设置，并通常打开和关闭按钮支持。因此，无论类中的任何其他值，如果这`false`在用户按下音量按钮时不会发生任何事情，并且实现尽可能确保保持清洁并且不会不必要地影响系统音量级别。（请阅读 README 中提到的问题，了解第一次打开按钮支持时可能发生的情况。） `isOn`是指在`true`需要按钮的持续时间内。您可以打开和关闭它，而无需考虑 的当前值`isInUse`。

2.  无论您在哪个视图中初始化按下音量按钮时应该发生的操作，都可以像这样设置操作：

    PhysicalButton.shared.action = { /* 做某事 */ }

动作有类型`() -> Void`。在您初始化动作之前，什么都不会中断。只是什么都不会发生。这种防御功能对我来说很重要，因为只有在设置按钮支持后才会创建使用音量按钮支持的视图。

要查看实际情况，您可以[免费下载](https://itunes.apple.com/app/herotime-smart-multi-stopwatch/id1072873744?mt=8)我正在使用的应用程序。这些设置通常操纵“物理按钮支持”。主秒表视图是在进入视图时实际打开按钮处理并在离开时关闭的视图。如果您有时间，您还可以在“设置”>“用户指南”>“选项：物理按钮支持”中找到重要说明：

> 在特殊情况下，应用程序可能无法在秒表视图之外正确关闭音量按钮处理...

我会将完整的注释添加到 Github README.md。如果它与您的情况相关，请随意调整和重用它。

情况实际上并没有那么特殊，我还没有完全弄清楚出了什么问题。当用户在音量按钮打开时终止应用程序（或者您只是从 Xcode 中停止应用程序），物理按钮支持可能无法从操作系统中正确删除。因此，您最终会得到两个内部处理程序实例，您只能控制其中一个。因此，每个按钮点击都会导致对操作例程的两次甚至更多调用。我的包装器有一些保护代码来防止按钮调用过快。但这只是部分解决方案。修复需要进入底层处理程序，遗憾的是我对它的了解仍然太少，无法自己尝试修复。

* * *

旧的，对于 1.0.1：

特别是，我的兴趣在于 Swift 解决方案。代码在 Objective-C 中。为了节省一些研究，这就是我使用 Cocoapods 所做的一切（对于像我这样的傻瓜）：

1.  添加`pod 'JPSVolumeButtonHandler'`到 podfile
2.  `pod install`在命令行上运行
3.  添加`#import <JPSVolumeButtonHandler.h>`到桥接头文件中
4.  为音量增大和减小按钮设置回调，如下所示：

    ```
    let volumeButtonHandler = JPSVolumeButtonHandler(
        upBlock: {
            log.debug("Volume up button pressed...")
            // Do something when the volume up button is pressed...
        }, downBlock: {
            log.debug("Volume down button pressed...")
            // Do something else for volume down...
        }) 
    ```

就是这样。其余的都是可选的。

* * *

在我的例子中，我想为选择视图启用与虚拟屏幕按钮重叠的物理按钮推送，同时确保尽可能少地阻止正常按钮功能（以便用户可以在后台运行音乐并调整它在应用程序的其余部分中的音量很好）。我最终得到了一个主要是单例类，如下所示：

```
class OptionalButtonHandler {

  static var sharedInstance: OptionalButtonHandler?

  private var volumeButtonHandler: JPSVolumeButtonHandler? = nil
  private let action: () -> ()

  var enabled: Bool {
    set {
        if !enabled && newValue {
            // Switching from disabled to enabled...
            assert(volumeButtonHandler == nil, "No leftover volume button handlers")
            volumeButtonHandler = JPSVolumeButtonHandler(upBlock: {
                log.debug("Volume up button pressed...")
                self.action()
                }, downBlock: {
                    log.debug("Volume down button pressed...")
                    self.action()
            })
        } else if enabled && !newValue {
            log.debug("Disabling physical button...")
            // The other way around: Switching from enabled to disabled...
            volumeButtonHandler = nil
        }
    }
    get { return (volumeButtonHandler != nil) }
  }

  /// For one-time initialization of this otherwise singleton class.
  static func initSharedInstance(action: () -> ()) {
      sharedInstance = OptionalButtonHandler(action: action)
  }

  private init(action: () -> ()) {
      self.action = action
  }
} 
```

此处的音量增大和减小按钮只有一个常见操作。这`initSharedInstance()`是必要的，因为我的操作包括对 UI 元素（视图）的引用，该 UI 元素（视图）仅在应用启动后的某个用户相关点设置。

一次性设置如下：

```
OptionalButtonHandler.initSharedInstance({
    // ...some UI action
}) 
```

像这样有选择地启用/禁用：

```
OptionalButtonHandler.sharedInstance!.enabled = true  // (false) 
```

（请注意，我的代码逻辑确保`.enabled`之前从未访问过`initSharedInstance()`。）

我在（必需！）测试设备上运行 Xcode 7.3 和 iOS 9.3.2。

*期待了解 Apple 对超载宝贵的音量按钮的感受。至少我的应用程序确保是微创的，并且按钮的使用真的很有意义。它不是相机应用程序，但类似的应用程序以前使用过物理音量按钮（甚至不太好）。*

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-21T22:15:00.920

如果您愿意使用私有 API，我有[一个 Wolf3d 补丁，](http://code.google.com/p/clippy-toolkit/source/browse/trunk#trunk/Wolf3dVolumePatch)它添加了您正在寻找的功能。它使用私有`AVSystemController`类和一些隐藏的方法`UIApplication`

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-07-14T00:11:20.267

好的，

所以我看到了你的解决方案，不知道苹果会拒绝还是接受使用`AVSystemController_SystemVolumeDidChangeNotification`. 但我有一个解决办法。

用于注册 iPhone 硬件的任何音量变化，像`UISlider`这样`MPVolumeView`

```
MPVolumeView *volumeView = [[MPVolumeView alloc] initWithFrame:CGRectZero];

for (UIView *view in [volumeView subviews]) {
    if ([view.class.description isEqualToString:@"MPVolumeSlider"]){
        self.volume_slider = (UISlider*)view;
        break;
    }
}
[volumeView sizeToFit];
#THIS IS THE MAIN LINE. ADD YOUR CALLBACK TARGET HERE
[self.volume_slider addTarget:self action:@selector(volumeListener:) forControlEvents:UIControlEventValueChanged];
[self addSubview:volumeView];
[volumeView setAlpha:0.0f];

-(void)volumeListener:(NSNotification*)notification {
     #UPDATE YOUR UI ACCORDING OR DO WHATEVER YOU WANNA DO.
     #YOU CAN ALSO GET THE SOUND STEP VALUE HERE FROM NOTIFICATION.
} 
```

让我知道这是否对任何人有帮助。

# asp.net-mvc - 依赖注入和 ModelStateWrapper

> ID：772840
> 
> 赞同：4
> 
> 时间：2009-04-21T14:26:11.563
> 
> 标签：asp.net-mvc, dependency-injection, unity-container

在教程中使用产品服务[的服务层](http://www.asp.net/learn/mvc/tutorial-38-cs.aspx)构造函数进行验证如下所示：

```
ProductService(IValidationDictionary validationDictionary, IProductRepository repository) 
```

它在默认控制器构造函数中的实例是这样创建的：

```
public ProductController() 
{   
    _service = new ProductService(new ModelStateWrapper(this.ModelState), new roductRepository());

} 
```

如果我想将 Unity 用于 DI，显然应该使用第二个构造函数。

```
public ProductController(IProductService service)
{
    _service = service;
} 
```

但是后来我不知道配置Unity来注入ProductServise的第一个参数，因为ModelStateWrapper使用来自控制器的ModelState，它是在控制器内部创建的，不能注入。是否可以将这种依赖注入ProductService？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-22T08:52:21.107

思考。

这是您要执行的操作：

*   为了创建产品控制器，您需要产品服务
*   为了创建产品服务，您需要产品控制器

你有一个恶性循环，这就是你做不到的原因。

我不知道 Unity 的实现，但从概念上讲，您需要打破循环，如下所示：

*   创建产品控制器而不将产品服务传递给它
*   创建产品服务并将产品控制器的模型状态传递给它
*   通过属性注入将产品服务注入产品控制器

AFAIK unity 确实支持属性注入，但它需要您将属性放到属性上。如果我是你，我会考虑使用侵入性较小的容器（几乎任何其他容器都更好）。

# wpf - 标准 WPF 选项卡控件中是否存在 Selected Tab Changed 事件

> ID：772841
> 
> 赞同：104
> 
> 时间：2009-04-21T14:26:35.943
> 
> 标签：wpf, events, tabcontrol

在 WPF 中，是否有一个事件可用于确定 a`TabControl`的选定选项卡何时更改？

我尝试过使用`TabControl.SelectionChanged`，但是当孩子在选项卡中的选择发生变化时，它会被触发很多次。

* * *

## 回答 #1

> 赞同：134
> 
> 时间：2009-04-21T14:49:47.620

我将它绑定在处理程序中以使其工作：

```
void TabControl_SelectionChanged(object sender, SelectionChangedEventArgs e)
{
    if (e.Source is TabControl)
    {
      //do work when tab is changed
    }
} 
```

* * *

## 回答 #2

> 赞同：85
> 
> 时间：2010-07-01T16:25:34.017

如果将`x:Name`属性设置为每个`TabItem`：

```
<TabControl x:Name="MyTab" SelectionChanged="TabControl_SelectionChanged">
    <TabItem x:Name="MyTabItem1" Header="One"/>
    <TabItem x:Name="MyTabItem2" Header="2"/>
    <TabItem x:Name="MyTabItem3" Header="Three"/>
</TabControl> 
```

然后您可以在活动中访问每个`TabItem`：

```
private void TabControl_SelectionChanged(object sender, SelectionChangedEventArgs e)
{
    if (MyTabItem1.IsSelected)
    // do your stuff
    if (MyTabItem2.IsSelected)
    // do your stuff
    if (MyTabItem3.IsSelected)
    // do your stuff
} 
```

* * *

## 回答 #3

> 赞同：56
> 
> 时间：2014-02-27T08:02:55.347

如果您只想在选择选项卡时有一个事件，这是正确的方法：

```
<TabControl>
    <TabItem Selector.Selected="OnTabSelected" />
    <TabItem Selector.Selected="OnTabSelected" />
    <TabItem Selector.Selected="OnTabSelected" />
    <!-- You can also catch the unselected event -->
    <TabItem Selector.Unselected="OnTabUnSelected" />
</TabControl> 
```

在你的代码中

```
 private void OnTabSelected(object sender, RoutedEventArgs e)
    {
        var tab = sender as TabItem;
        if (tab != null)
        {
            // this tab is selected!
        }
    } 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-04-21T14:39:40.890

您仍然可以使用该事件。只需检查 sender 参数是否是您真正关心的控件，如果是，则运行事件代码。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2017-09-06T11:36:26.187

如果您使用的是 MVVM 模式，那么使用事件处理程序会很不方便（并且会破坏模式）。相反，您可以将每个单独的 TabItem`Selector.IsSelected`属性绑定到视图模型中的依赖项属性，然后处理`PropertyChanged`事件处理程序。这样，您就可以确切地知道基于 选择/取消选择了哪个选项卡，`PropertyName`并且每个选项卡都有一个特殊的处理程序。

例子：`MainView.xaml`

```
<TabControl>
 <TabItem Header="My tab 1" Selector.IsSelected="{Binding IsMyTab1Selected}"> ... </TabItem>
 <TabItem Header="My tab 2" Selector.IsSelected="{Binding IsMyTab2Selected}"> ... </TabItem>
</TabControl> 
```

例子：`MainViewModel.cs`

```
public bool IsMyTab1Selected {
 get { return (bool)GetValue(IsMyTab1SelectedProperty); }
 set { SetValue(IsMyTab1SelectedProperty, value); }
}
public static readonly DependencyProperty IsMyTab1SelectedProperty =
DependencyProperty.Register("IsMyTab1Selected", typeof(bool), typeof(MainViewModel), new PropertyMetadata(true, new PropertyChangedCallback(MyPropertyChanged)));

public bool IsMyTab2Selected {
 get { return (bool)GetValue(IsMyTab2SelectedProperty); }
 set { SetValue(IsMyTab2SelectedProperty, value); }
}
public static readonly DependencyProperty IsMyTab2SelectedProperty =
DependencyProperty.Register("IsMyTab2Selected", typeof(bool), typeof(MainViewModel), new PropertyMetadata(false, new PropertyChangedCallback(MyPropertyChanged)));

private void MyPropertyChanged(DependencyObject d, DependencyPropertyChangedEventArgs e) {
 if (e.Property.Name == "IsMyTab1Selected") {
  // stuff to do
 } else if (e.Property.Name == "IsMyTab2Selected") {
  // stuff to do
 }
} 
```

如果您的`MainViewModel`is`INotifyPropertyChanged`而不是`DependencyObject`，请改用它：

例子：`MainViewModel.cs`

```
public event PropertyChangedEventHandler PropertyChanged;
protected virtual void OnPropertyChanged(string propertyName) {
 PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
}

public MainViewModel() {
 PropertyChanged += handlePropertyChanged;
}

public bool IsMyTab1Selected {
 get { return _IsMyTab1Selected ; }
 set {
  if (value != _IsMyTab1Selected ) {
   _IsMyTab1Selected = value;
   OnPropertyChanged("IsMyTab1Selected ");
  }
 }
}
private bool _IsMyTab1Selected = false;

public bool IsMyTab2Selected {
 get { return _IsMyTab2Selected ; }
 set {
  if (value != _IsMyTab2Selected ) {
   _IsMyTab2Selected = value;
   OnPropertyChanged("IsMyTab2Selected ");
  }
 }
}
private bool _IsMyTab2Selected = false;

private void handlePropertyChanged(object sender, PropertyChangedEventArgs e) {
 if (e.PropertyName == "IsMyTab1Selected") {
  // stuff to do
 } else if (e.PropertyName == "IsMyTab2Selected") {
  // stuff to do
 }
} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-12-12T14:39:54.800

生成的事件正在冒泡，直到它被处理。

下面的这个 xaml 部分在更改中选择的项目`ui_Tab_Changed`后触发，无论.`ui_A_Changed``ListView``TabItem``TabControl`

```
<TabControl SelectionChanged="ui_Tab_Changed">
  <TabItem>
    <ListView SelectionChanged="ui_A_Changed" />
  </TabItem>
  <TabItem>
    <ListView SelectionChanged="ui_B_Changed" />
  </TabItem>
</TabControl> 
```

我们需要在`ui_A_Changed`（和`ui_B_Changed`，等等）中消费事件：

```
private void ui_A_Changed(object sender, SelectionChangedEventArgs e) {
  // do what you need to do
  ...
  // then consume the event
  e.Handled = true;
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-21T14:45:28.363

那是正确的事件。也许它没有正确接线？

```
<TabControl SelectionChanged="TabControl_SelectionChanged">
    <TabItem Header="One"/>
    <TabItem Header="2"/>
    <TabItem Header="Three"/>
</TabControl> 
```

在代码隐藏中......

```
private void TabControl_SelectionChanged(object sender, SelectionChangedEventArgs e)
{
    int i = 34;
} 
```

如果我在 i = 34 行上设置断点，它只会在我更改选项卡时中断，即使选项卡有子元素并且其中一个被选中。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-12-05T14:15:52.943

这段代码似乎工作：

```
 private void TabControl_SelectionChanged(object sender, SelectionChangedEventArgs e)
    {
        TabItem selectedTab = e.AddedItems[0] as TabItem;  // Gets selected tab

        if (selectedTab.Name == "Tab1")
        {
            // Do work Tab1
        }
        else if (selectedTab.Name == "Tab2")
        {
            // Do work Tab2
        }
    } 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2014-05-09T07:08:29.600

如果有人使用 WPF Modern UI，他们不能使用 OnTabSelected 事件。但他们可以使用 SelectedSourceChanged 事件。

像这样

```
<mui:ModernTab Layout="Tab" SelectedSourceChanged="ModernTab_SelectedSourceChanged" Background="Blue" AllowDrop="True" Name="tabcontroller" > 
```

C#代码是

```
private void ModernTab_SelectedSourceChanged(object sender, SourceEventArgs e)
    {
          var links = ((ModernTab)sender).Links;

          var link = this.tabcontroller.Links.FirstOrDefault(l => l.Source == e.Source);

          if (link != null) {
              var index = this.tabcontroller.Links.IndexOf(link);
              MessageBox.Show(index.ToString());
          }            
    } 
```

# git - 创建 git 分支，并将原始状态恢复为上游状态

> ID：772846
> 
> 赞同：31
> 
> 时间：2009-04-21T14:28:08.420
> 
> 标签：git, version-control, github

我最近搞砸了我的 git repo，想知道是否有任何补救措施。

我的设置是这样的：

```
Central repo on github.
Personal repo on github (which is a fork of Central)
   +Central is setup as remote (upstream/master)
   +Master branch (origin/master)
   +Feature branch (origin/feature) 
```

我的工作流程是这样的：

```
Need to fix something in Central:
   1\. checkout Master
   2\. Make changes
   3\. Pull from upstream/master and merge
   3\. Commit, push to upstream/master

Need to work on a New Feature:
   1\. Checkout/Create Feature branch
   2\. Work work work
   3\. Pull from upstream/master and merge
   4\. Commit, push to upstream/master 
```

通过这种方式，我的 Master 分支中始终拥有原始的 Central 状态。

现在我所做的是开始在 Master 分支上工作。所以我对我的 master 进行了更改，并且不能再从它分支来获取 Central 的副本。每当我需要对 Central 进行一些修复并将其推送时，我必须将 Central 克隆到另一个目录并从那里工作。

我的问题：有没有办法将我的主人“恢复”为中央的相同副本，同时将我对主人所做的所有更改移动到另一个分支（比如功能）？

我知道这很令人困惑，我将不胜感激。如果有任何不清楚的地方，我会澄清。

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-04-21T17:38:23.940

好吧，Pat Notz 和 Bombe 暗示了解决方案非常简单。

```
#Make sure we're on the master branch
$ git checkout master

# Make a new branch to hold the work I've done
$ git branch old_master

# Save this branch on my remote repo (for backup)
$ git checkout old_master
$ git push origin old_master

# Reset my local master back to match the commit just before I started 
# working on my new feature
$ git checkout master
$ git reset --hard 2aa93842342342

# Get it to be the same as my Central
$ git pull upstream master

# Now DELETE my master on my remote repo
$ git push origin :master

# And recreate it
$ git push origin master

# Branch created!
#* [new branch]      master -> master

# 
```

现在我有两个不错的分支：master 和 old_master。master 是我的 Central 的副本，用于修复生产，而 old_master 持有我之前所做的所有工作！

谢谢！

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-04-21T15:20:27.017

```
# Make sure we're on the master branch
$ git checkout master

# Make a new branch to hold the work I've done
$ git branch old_master

# Reset my local master back to match origin/master
$ git reset --hard origin/master 
```

`old_master`现在您可以像使用`feature`分支一样结帐和使用它

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-21T14:59:25.133

你到底是什么意思

> 我搞砸了我的主人，不能再从它分支。

您总是可以从存储库中的任何提交创建一个新分支，无论它可能多么“混乱”——顺便说一句，这是 Git 没有概念的。

基本上，您可以将存储库恢复到以前的任何状态，因为 Git 不会明确删除任何对象，它只会不时地垃圾收集未引用（悬空）的对象。所以你只需要找出你的存储库是什么样子的。`gitk`或者`git log`可以帮助你。

将本地存储库恢复到您喜欢的状态后，您只需将其推送回您的中央公共存储库即可。如果这导致非快进推送，您可能需要`--force`在推送时指定标志。

# c# - 向 WCF 服务合同添加操作是否意味着所有 WCF 客户端都应更新其引用？

> ID：772847
> 
> 赞同：3
> 
> 时间：2009-04-21T14:28:14.630
> 
> 标签：c#, .net, wcf

我会更具体。

假设我为我的 WCF 服务定义了一个合同。我有两个不同的 WCF 客户端，它们引用了这个服务：“ClientA”和“ClientB”。

现在，假设我想向我的服务添加一个只有“ClientB”会使用的操作（方法），假设我将此操作添加到合同中，并且“ClientB”更新了它的引用，我们都很高兴。即使没有使用新操作，clientA 是否也需要更新它的引用？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-21T14:32:28.910

如果要使用新的 Operation 合约，客户只需要更新他的引用。

查看这篇文章：[版本化 WCF 合同](http://www.dasblonde.net/2006/01/05/VersioningWCFServiceContracts.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T14:36:48.633

不，WCF Web 引用是由 IDE 生成的，与对 ASMX 或其他 Web 服务的引用非常相似，这意味着它将事物分解为方法清单，以便客户端调用代码像调用远程 API 一样运行。因此，如果只添加不改变预期现有功能的新内容，那么旧客户端不需要更新。

# .net - 与实体网络中的字段的多对多连接

> ID：772848
> 
> 赞同：0
> 
> 时间：2009-04-21T14:28:33.070
> 
> 标签：.net, entity-framework

我想与其中的一个领域建立多对多的联系。

示例：用户*-----工作（**小时**）-----*公司

小时是多对多表中的一个字段。该字段描述了用户在公司工作的小时数。

这在实体框架中如何最好地建模？

您甚至可以在不从连接表中创建实体的情况下对此进行建模吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T14:36:25.813

我相信这将是一对多的关系，即用户与工作是一对多的，而工作与公司是多对一的。通过将问题分解成更小的逻辑块，您可以看到解决方案经常自行退出。考虑到上面的结构，我认为甚至尝试不对 Work 表建模是不合适的。

虽然这不是与实体框架相关的答案，但我希望它能帮助您更好地在脑海中构建问题，并希望能引导您找到解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T16:51:21.463

Lazarus 的回答对于今天的实体框架的方式基本上是正确的（赞成），但我意识到你要求的是不同的东西。您想要的是多对多关联的属性，而不是模型中的单独实体类型。实体框架目前不提供该功能。它可能在未来的版本中可用。

# nunit - WatiN 的最佳测试自动化方法是什么

> ID：772849
> 
> 赞同：0
> 
> 时间：2009-04-21T14:28:49.980
> 
> 标签：nunit, cruisecontrol.net, watin

我研究了数据驱动和关键字驱动的方法。读后，似乎数据驱动比关键字更好。出于文档目的，关键字听起来很棒。但它有很多层次。我需要实际实施自动化框架的人的指导。就个人而言，我想将所有数据存储在数据库或 Excel 中，并将系统分解为模块化部分（主要公司产品共有的功能）。

目前使用，WatiN，Nunit，CC.net

任何建议请

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-05T23:18:04.553

我强烈建议您查看 Michael Hunter aka 为在 Microsoft 测试表达式而构建的 braidy 测试器的堆栈，他有很多关于它的文章[http://www.thebraidytester.com/stack.html](http://www.thebraidytester.com/stack.html)

从本质上讲，他分成了一个逻辑模型、一个物理模型和一个数据模型，这三个模型都是松散耦合的。我所有的堆栈现在都是这样写的。所以测试用例最终看起来像这样：

逻辑.Google.Search.Websearch("watin");

Verification.VerifySearchResult("watin");

然后，所有测试数据都存储在由文本字符串索引的 sql express 数据库中，在本例中为 watin。

您将需要构建一个完整的域模型和数据访问层，我个人使用 SubSonic 自动生成。

# compiler-construction - 有谁知道如何或在哪里可以获得 VADS（Verdix Ada Development Studio）？

> ID：772852
> 
> 赞同：0
> 
> 时间：2009-04-21T14:29:03.177
> 
> 标签：compiler-construction, ada

是的，我知道已经过时和过时了，你们可能会说的一切......但我只是需要......这件事发生了...... xD有什么线索吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-21T15:26:40.700

Rational 在 94 年收购了 Verdix。IBM 在 03 年收购了 Rational。

所以在这一点上，我的建议是访问 IBM 的[Ada 网页](http://www-01.ibm.com/software/awdtools/developer/ada/)并关注他们的联系信息，看看他们是否可以向您出售旧的 VADS 系统。

如果你完全失败了，我相信[Ada Core](http://www.adacore.com/home/)可以签约将代码移植到他们的现代编译器。一个经过彻底测试的端口可能并不便宜。但话又说回来，我记得那些 VADS 系统的价格超过 10,000 美元……

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T15:36:08.117

几年前，我将一个大型系统从 VADS 移植到 Rational Apex。它进行得相当顺利，尤其是因为 Rational 已经为移植特定于 VADS 的软件包做出了扎实的努力。

# iphone - 验证 iPhone 设备 ID？

> ID：772858
> 
> 赞同：10
> 
> 时间：2009-04-21T14:30:24.780
> 
> 标签：iphone, cocoa-touch, security

有没有办法验证 iPhone 设备 ID？我希望能够接受 iPhone 用户通过 HTTP 请求提交的设备 ID，并验证它们是否绑定到合法设备。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-21T20:35:37.010

如果有一种方法可以验证 ID，那么就有一种方法可以创建一个真正的假 ID。

* * *

我同意 Tyler 的评论，有一种方法可以创建 ID（简单）并验证它们（也很简单），但创建“假”id 需要扫描整个密钥空间（硬）或窃取生成密钥的私钥（这就是 TLS 实际上的工作原理）。我最初的一些评论无效。

无论如何，这不是 Apple 设备 ID 的工作方式，AFAIK 他们从硬件的各种值 id 生成 id（例如 MAC 地址）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-14T15:49:28.010

要验证来自您的应用的请求，您可以发送 UUID 和哈希，其中哈希 = SHA1(UUID + SECRET_KEY_STORED_IN_APP)。然后在服务器端执行相同的哈希函数并验证它们是否匹配。您可以将时间戳添加为随机数，您可以在其中发送 UUID、时间戳、散列，其中 hash = SHA1(UUID + SECRET_KEY_STORED_IN_APP + TIMESTAMP)。

这当然不是失败证明并且有很多限制，但它是否使欺骗 UUID 变得更加困难。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-08-12T08:51:39.783

作为对 Martin Gorton 的回应，第 3 方库不能信任 UIDevice 唯一标识符——使用 Objective C 方法调配来欺骗它是微不足道的。

Method swizzling 将两个选择器（uniqueIdentifier 和 spoofUniqueIdentifier）交换为一个类（UIDevice）。在 swizzle 之后，对 UIDevice uniqueIdentifier 的后续调用将返回欺骗的 UDID。这有助于测试您没有有效 UDID 的 UDID 键库。

[这是来自http://marccodes.posterous.com/method-swizzling-uidevice-to-spoof-udid](http://marccodes.posterous.com/method-swizzling-uidevice-to-spoof-udid)的一些示例代码：

```
#import <objc/runtime.h>

// swap a class's instance method selectors, we do this to overload existing methods in category declarations
void swizzleMethodsForClass(Class c, SEL origMethodSel, SEL newMethodSel)
    {
    NSLog(@"swizzling %@ instance methods: %@ -> %@", NSStringFromClass(c), 
        NSStringFromSelector(origMethodSel), NSStringFromSelector(newMethodSel));

    Method origMethod = class_getInstanceMethod(c, origMethodSel);
    Method newMethod = class_getInstanceMethod(c, newMethodSel);

    // check if method is inherited from superclass
    if(class_addMethod(c, origMethodSel, method_getImplementation(newMethod), method_getTypeEncoding(newMethod)))
        class_replaceMethod(c, newMethodSel, method_getImplementation(origMethod), method_getTypeEncoding(origMethod));

    // exchange un-subclassed method
    else
        method_exchangeImplementations(origMethod, newMethod);
    }   

@interface UIDevice (SpoofUDID)

@end

#define UDID_TO_SPOOF        @"e0101010d38bde8e6740011211af315301010223"

@implementation UIDevice (SpoofUDID)

// swizzle this instance method for UIDevice class
- (NSString *) spoofUniqueIdentifier
        {
        static NSString *spoofUDID = UDID_TO_SPOOF;
        NSLog(@"spoofing %@ instead of %@", spoofUDID, [[UIDevice currentDevice]
spoofUniqueIdentifier]);
        return spoofUDID;
        }

@end

// call this from your app delegate
- (void) initUDID
        {
        NSString *UDID = [[UIDevice currentDevice] uniqueIdentifier];
        NSLog(@"this is my old udid: %@", UDID);

        swizzleMethodsForClass([UIDevice class], @selector(uniqueIdentifier), @selector(spoofUniqueIdentifier));

        NSString *UDID2 = [[UIDevice currentDevice] uniqueIdentifier];
        NSLog(@"this is my new udid: %@", UDID2);
        } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-01-12T14:44:24.040

没有指定此字符串的布局的苹果文档或规范。

AFAIK 只有 Apple 知道哪些 UDID 是真实的，哪些是虚假的。

有根据的猜测是它们的长度为 40 个字符，由字母数字字符组成。(a-f0-9)

**正则表达式模式：**

```
[a-z0-9]{40} 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-21T20:47:49.960

如果您直接使用`[[UIDevice currentDevice] uniqueIdentifier]`而不是提示用户获取它，那么它没有理由不是合法的设备 ID。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2016-02-26T08:48:22.323

要验证 UDID，请尝试遵循正则表达式`^([A-F0-9]{40})$` ，或者您可以到[这里粘贴它](https://regex101.com/r/hD8sJ8/2)。

如果您正在使用`[[UIDevice currentDevice].identifierForVendor UUIDString]`（您应该使用） - 那么它只是一个 guid，[请查看此](https://stackoverflow.com/questions/11040707/c-sharp-regex-for-guid) 正则表达式 is ( `^([0-9A-Fa-f]{8}[-][0-9A-Fa-f]{4}[-][0-9A-Fa-f]{4}[-][0-9A-Fa-f]{4}[-][0-9A-Fa-f]{12})$`)，或者您可以将[其粘贴到此处](https://regex101.com/r/hD8sJ8/3)。

希望这可以节省您一些时间。

# asp.net-mvc - ASP.Net MVC 视图结构

> ID：772871
> 
> 赞同：11
> 
> 时间：2009-04-21T14:32:30.877
> 
> 标签：asp.net-mvc

我刚刚完成了 Scott Gu 的 Nerd Diner 教程。我发现它非常有帮助，因为它不仅教授了 ASP.Net MVC 的基础知识，还教授了如何使用存储库、验证、单元测试、Ajax 等。非常全面，但仍然易于管理。

但是，我对他的网站结构很好奇：

具体来说，他对每个对象都使用了这种视图结构：
/ModelObject/Edit/
/ModelObject/Create/

然后将两个视图之间的共同元素提取出来，放到一个partial中。

我理解其中的逻辑，但如果您的数据库中的表数量适中，它似乎会导致“视图爆炸”。

斯科特真的很好，所以我假设他的结构是正确的。但我想知道为什么。

谢谢！

[编辑澄清]

我意识到很多时候需要有多个动作（和视图）来处理创建和编辑中的差异。这是非常简单的编辑和创建的情况，这两个操作之间的唯一区别是在一种情况下模型有一个 ID 并且需要更新，而在另一种情况下模型没有，所以它需要插入。

在这种情况下，使用同一个视图处理两种情况是否违反“哑视图”规则会导致重大问题？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-21T15:34:43.533

视图结构基于控制器，而不是直接基于模型。在 Mvc 方法中，您应该对控制器中的每个操作（本质上是每个公共方法）都有一个视图。控制器操作不必直接匹配数据库中的每个表，但数据库中表的数量与控制器和视图的数量之间可能存在某种直接关系。控制器级别更高

在控制器上具有 CRUD 类型的操作是标准的，当它们适用时：

*   索引：列出项目
*   详细信息：查看特定项目
*   编辑：编辑一个项目
*   创建：新项目
*   删除：删除一个项目

这些操作中的每一个都需要一个视图（有时不止一个）。

所以，是的，如果它是一个大型应用程序，您可以收集大量视图。最小化代码的方法是：

*   将共享功能提取到部分视图中，以使操作视图尽可能小和简单
*   保持视图和控制器简单，以便易于维护
*   使用 AJAX 在一个视图中实现更多功能

重要的是要指出，任何大型应用程序都会有很多表单。无论是 Mvc 还是 Web Forms，如果需要处理大量数据，就需要大量的表单来完成它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-21T15:28:22.537

确实，这确实可以引起很多观点。但是，我发现在我的实际应用程序中，我将拥有许多与 CRUD 操作没有 1:1 相关性的表。虽然我当然有进入这些表的数据，但我发现大多数时候视图会显示来自至少两个（如果不是三个或更多）表的数据。就像其他所有应用程序一样，您必须知道自己在追求什么，这样您才能计划好事情。任何大型应用程序都需要预先进行大量计划（包括分析 MVC 的视图/控制器的数量）。

根据您的预感和过去的经验，您只能将这些小应用程序放在一起。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-21T15:22:14.097

如果您有 asp.net webforms 开发人员的背景，那么您的答案很自然。有几个问题，这取决于观点。起初，使用 asp.net-mvc，我们没有设备齐全的服务器控件为我们做很多事情，而没有真正意识到它们在做什么。现在你必须输入更多的代码，并且在 html 上拥有像外科医生一样的眼睛。这样我可以为“视图爆炸”找到一个合理的问题 其他项目或多或少遵循这种结构，请参阅 Rob Conery 的项目： [Mvc Storefront](http://www.asp.net/learn/mvc-videos/#MVCStorefrontStarterKit)

PS：“瘦控制器、胖模型和……哑视图”

[更新对澄清的回应]

嗯..我认为没有违反“愚蠢的观点”。重要的是所有视图都与业务逻辑层或模型中的代码无关。你可以有一个按钮“保存”，控制器必须知道必须执行哪个动作，插入或更新。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-23T12:33:27.993

仔细想想，这就是我的想法：
**在简单的模型上组合编辑/创建视图会很容易，因为**

**但这样做会迫使你要么**

当很容易使用单独的操作和单独的视图并将公共代码提取到部分中时，这两个选项看起来都很丑陋和不必要。

# sql - 如何最好地提取事务表中的转换？

> ID：772874
> 
> 赞同：0
> 
> 时间：2009-04-21T14:32:53.403
> 
> 标签：sql, mysql

假设示例：

我有一个包含十亿左右事务的 SQL 表：

```
| 成本 | 日期时间 |
| 1.00 | 2009-01-02 |
| 2.00 | 2009-01-03 |
| 2.00 | 2009-01-04 |
| 3.00 | 2009-01-05 |
| 1.00 | 2009-01-06 |
...

```

我想要的是配对数据，以便我只看到成本*转换*：

```
| 成本 | 日期时间 |
| 1.00 | 2009-01-02 |
| 2.00 | 2009-01-03 |
| 3.00 | 2009-01-05 |
| 1.00 | 2009-01-06 |
...

```

最简单（也是最慢）的方法是遍历整个表，跟踪更改。在 SQL 中是否有更快/更好的方法来执行此操作？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-21T14:57:57.303

不，没有更快的方法。您可以编写一个执行相同工作的查询，但速度会慢得多。您（作为开发人员）知道您只需要将一个值与其直接先前的值进行比较，并且没有办法用 SQL 来指定它。所以你可以做 SQL 做不到的优化。所以我想最快的方法是编写一个程序，从磁盘流式传输结果，在 RAM 中只保存最后一个有效值和当前值（过滤掉每个等于最后一个有效值的值）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T15:04:59.533

这是在需要锤子时尝试使用大锤的经典示例。您想从表中提取一些疯狂的报告数据，但这样做会杀死您的 SQL Server。跟踪更改需要做的是专门为此目的创建一个跟踪表。然后使用触发器将产品中的值更改记录到此表中。所以在我的产品表上，当我更改价格时，它会进入价格跟踪表。

如果您使用它来跟踪股票价格或类似的东西，那么您再次使用相同的方法，除了您对价格表进行比较，如果发生变化，您保存它。所以比较只发生在新数据上，所有旧的比较仍然存放在一个位置，所以你不需要重新运行会破坏 SQL Server 性能的查询。

# java - 丑陋的java数据结构

> ID：772876
> 
> 赞同：3
> 
> 时间：2009-04-21T14:34:37.813
> 
> 标签：java, data-structures

我创建了以下结构，它将唯一的双精度值映射到一对或多对整数：

```
 @SuppressWarnings("boxing")
   private static final HashMap<Double, Integer[][]> rules =
      new HashMap<Double, Integer[][]>() {
         private static final long serialVersionUID = 1L;
         {
            put(-0.6, new Integer[][] { { 1, 3 } });
            put(-0.3, new Integer[][] { { 2, 2 } });
            put(0.0, new Integer[][] { { 2, 4 }, { 3, 3 }, { 4, 2 } });
            put(0.3, new Integer[][] { { 4, 4 } });
            put(0.6, new Integer[][] { { 5, 3 } });
         }
   }; 
```

我可以重写它，使它更简单 - 即不必处理警告（serialVersionUID，装箱），它是如此冗长？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-21T14:41:52.477

对整数对使用一个类应该是第一个。或者这是一个巧合，所有数组都包含一堆对？

第二件事是，这些初始化数据可以从配置文件中读取。

**编辑：**当我再次查看这段代码时，我意识到将 Doubles 作为 Map 中的键有点冒险。如果您通过数学运算产生双精度数，则不清楚它们对于计算机是否相等（即使它们在数学意义上相等）。浮点数在计算机中表示为近似值。您很可能希望将值与区间（例如 0.0-0.3）相关联，而不是值本身。如果您始终使用与数组中的键相同的常量，则可以避免麻烦。但是在这种情况下，您也可以使用枚举，并且没有新程序员遇到麻烦，如果他使用他计算的双精度作为映射中的键。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-21T14:38:34.933

创建另一个类来保存您的整数对，并使用列表存储它们：

```
Map<Double,List<MyPair>> 
```

这些是任意的整数对，还是代表什么？如果是后者，请适当命名。Java 中的新类很便宜，良好的命名会降低维护成本。

编辑：为什么要创建 HashMap 的匿名子类？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T14:39:05.727

在我看来，使用静态初始化器会稍微好一些，尽管它对冗长没有任何作用：

```
private static final Map<Double, int[][]> rules;

static {
    rules = new HashMap<Double, int[][]>();

    rules.put(-0.6, new int[][] { { 1, 3 } });
    rules.put(-0.3, new int[][] { { 2, 2 } });
    rules.put(0.0, new int[][] { { 2, 4 }, { 3, 3 }, { 4, 2 } });
    rules.put(0.3, new int[][] { { 4, 4 } });
    rules.put(0.6, new int[][] { { 5, 3 } });

} 
```

使用特殊`Pair`类的另一个选项和`Arrays.asList`：

```
class Pair<A, B> {
  A a;
  B b;

  public Pair(A fst, B snd) {
  }

  // getters and setters here
}

private static final Map<Double, List<Pair<Integer, Integer>>> rules;

static {
    rules = new HashMap<Double, List<Pair<Integer, Integer>>>();

    rules.put(-0.6, Arrays.asList(new Pair(1, 3)));
    rules.put(-0.3, Arrays.asList(new Pair(2, 2)));
    rules.put(0.0, Arrays.asList(new Pair(2, 4), new Pair(3, 3), new Pair(4, 2));
    // etc
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T14:40:34.977

你可以在 Integer[][] 周围包装一个类，比如 Point 吗？

那会让你有一个

```
HashMap<Double, List<Point>> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-21T14:41:01.057

我将从 MultiValueMap 开始。 [http://larvalabs.com/collections/](http://larvalabs.com/collections/)。

这样你就可以做到：

```
private static final MultiValueMap<Double, Integer[]> rules;
   static {
      MultiValueMap<Double, Integer[]> map = new MultiValueMap <Double, Integer[]>();

      map.put(-0.6, new Integer[] { 1, 3 });
      map.put(-0.3, new Integer[] { 2, 2 });
      map.put(0.0, new Integer[]  { 2, 4 }, new Integer[]{ 3, 3 }, new Integer[]{ 4, 2 } );
      map.put(0.3, new Integer[]  { 4, 4 } );
      map.put(0.6, new Integer[]  { 5, 3 } );
      rules = map;
   }; 
```

看起来你也离开了使用整数对作为键列表。如果您将其称为 RulePair 或其他指定对象，它可能会清理您的界面。因此，更具体地“输入”您的 Integer 数组。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-21T14:53:50.357

您也可以尝试使用 Builder；对于这种用途，Java 不如其他语言好.. 但这里仅供参考：

**第一枪**

```
class RuleBuilder  {

    private Map<Double, Integer[][]> rules;

    public RuleBuilder() {
        rules = new HashMap<Double, Integer[][]>();
    }

    public RuleBuilder rule(double key, Integer[]... rows) {
        rules.put(key, rows);
        return this;
    }

    public Integer[] row(Integer... ints) {
        return ints;
    }

    public Map<Double, Integer[][]> build() {
        return rules;
    }
} 
```

示例用法：

```
private static final Map<Double, Integer[][]> rules = 
                new RuleBuilder() {{
                    rule(-0.6, row(1, 3));                        
                    rule(-0.3, row(2, 2));
                    rule(0.0, row(2, 4), row(3,3), row(4, 2));
                    rule(0.3, row(4, 4));
                    rule(0.6, row(5, 3));
                }}.build(); 
```

**第二枪**

为了消除最终的“build()”调用和[双括号初始化](http://c2.com/cgi-bin/wiki.pl?DoubleBraceInitialization)，您可以尝试：

```
class RuleBuilder2 extends HashMap<Double, Integer[][]>  {

    public RuleBuilder2 rule(double key, Integer[]... rows) {
       put(key, rows);
       return this;
    }

    public Integer[] row(Integer... ints) {
        return ints;
    }
} 
```

在这种情况下，代码要好一些：

```
private static final Map<Double, Integer[][]> rules2 =
                new RuleBuilder2().
                    rule(-0.6, row(1, 3)).
                    rule(-0.3, row(2, 2)).
                    rule(0.0, row(2, 4), row(3,3), row(4, 2)).
                    rule(0.3, row(4, 4)).
                    rule(0.6, row(5, 3)); 
```

**编辑**

可能我用过的名字没有那么有意义；装箱/拆箱转换仍然是一个问题，但这是 Java 的问题

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-21T14:59:03.947

你可以在这里做的不多。警告必须被压制；`serialVersionUID`实际上，除非您实际上计划序列化此对象，否则您永远不必担心。

可以（并且可能应该）通过使用此处其他答案中描述的类型化集合来删除装箱。要删除样板，您必须使用一种方法。例如：

```
private static void put (double key, int x, int y) {
  rules.put(key, new Point(x,y));
} 
```

# php - 大圆距离问题

> ID：772878
> 
> 赞同：9
> 
> 时间：2009-04-21T14:34:51.790
> 
> 标签：php, latitude-longitude, great-circle

我熟悉计算两点之间的大圆距离的公式。

IE

```
<?php
$theta = $lon1 - $lon2; 
$dist = sin(deg2rad($lat1)) * sin(deg2rad($lat2)) +  cos(deg2rad($lat1)) * cos(deg2rad($lat2)) * cos(deg2rad($theta)); 
$dist = acos($dist); 
$dist = rad2deg($dist); 
//convert degrees to distance depending on units desired
?> 
```

不过，我需要的是相反的。给定一个起点、一个距离和一个简单的基本 NSEW 方向，来计算目标点的位置。我已经很久没有上数学课了。;)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-21T18:19:07.070

为了回答我自己的问题，任何好奇的人都在这里，从 Chad Birch 提供的 C 函数转换而来的 PHP 类：

```
class GreatCircle 
{

    /*
     * Find a point a certain distance and vector away from an initial point
     * converted from c function found at: http://sam.ucsd.edu/sio210/propseawater/ppsw_c/gcdist.c
     * 
     * @param int distance in meters
     * @param double direction in degrees i.e. 0 = North, 90 = East, etc.
     * @param double lon starting longitude
     * @param double lat starting latitude
     * @return array ('lon' => $lon, 'lat' => $lat)
     */
    public static function getPositionByDistance($distance, $direction, $lon, $lat)
    {
        $metersPerDegree = 111120.00071117;
        $degreesPerMeter = 1.0 / $metersPerDegree;
        $radiansPerDegree = pi() / 180.0;
        $degreesPerRadian = 180.0 / pi();

        if ($distance > $metersPerDegree*180)
        {
            $direction -= 180.0;
            if ($direction < 0.0)
            {
                $direction += 360.0;
            }
            $distance = $metersPerDegree * 360.0 - $distance;
        }

        if ($direction > 180.0)
        {
            $direction -= 360.0;
        }

        $c = $direction * $radiansPerDegree;
        $d = $distance * $degreesPerMeter * $radiansPerDegree;
        $L1 = $lat * $radiansPerDegree;
        $lon *= $radiansPerDegree;
        $coL1 = (90.0 - $lat) * $radiansPerDegree;
        $coL2 = self::ahav(self::hav($c) / (self::sec($L1) * self::csc($d)) + self::hav($d - $coL1));
        $L2   = (pi() / 2) - $coL2;
        $l    = $L2 - $L1;

        $dLo = (cos($L1) * cos($L2));
        if ($dLo != 0.0)
        {
            $dLo  = self::ahav((self::hav($d) - self::hav($l)) / $dLo);
        }

        if ($c < 0.0) 
        {
            $dLo = -$dLo;
        }

        $lon += $dLo;
        if ($lon < -pi())
        {
            $lon += 2 * pi();
        }
        elseif ($lon > pi())
        {
            $lon -= 2 * pi();
        }

        $xlat = $L2 * $degreesPerRadian;
        $xlon = $lon * $degreesPerRadian;

        return array('lon' => $xlon, 'lat' => $xlat);
    }

    /*
     * copy the sign
     */
    private static function copysign($x, $y)
    {
        return ((($y) < 0.0) ? - abs($x) : abs($x));
    }   

    /*
     * not greater than 1
     */
    private static function ngt1($x)
    {
        return (abs($x) > 1.0 ? self::copysign(1.0 , $x) : ($x));
    }   

    /*
     * haversine
     */
    private static function hav($x)
    {
        return ((1.0 - cos($x)) * 0.5);
    }

    /*
     * arc haversine
     */
    private static function ahav($x)
    {
        return acos(self::ngt1(1.0 - ($x * 2.0)));
    }

    /*
     * secant
     */
    private static function sec($x)
    {
        return (1.0 / cos($x));
    }

    /*
     * cosecant
     */
    private static function csc($x)
    {
        return (1.0 / sin($x));
    }

} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-21T14:45:09.147

这是我发现的一个 C 实现，应该相当简单地转换为 PHP：

```
#define KmPerDegree         111.12000071117
#define DegreesPerKm        (1.0/KmPerDegree)
#define PI                  M_PI
#define TwoPI               (M_PI+M_PI)
#define HalfPI              M_PI_2
#define RadiansPerDegree    (PI/180.0)
#define DegreesPerRadian    (180.0/PI)
#define copysign(x,y)       (((y)<0.0)?-fabs(x):fabs(x))
#define NGT1(x)             (fabs(x)>1.0?copysign(1.0,x):(x))
#define ArcCos(x)           (fabs(x)>1?quiet_nan():acos(x))
#define hav(x)              ((1.0-cos(x))*0.5)              /* haversine */
#define ahav(x)             (ArcCos(NGT1(1.0-((x)*2.0))))   /* arc haversine */
#define sec(x)              (1.0/cos(x))                    /* secant */
#define csc(x)              (1.0/sin(x))                    /* cosecant */

/*
**  GreatCirclePos() --
**
**  Compute ending position from course and great-circle distance.
**
**  Given a starting latitude (decimal), the initial great-circle
**  course and a distance along the course track, compute the ending
**  position (decimal latitude and longitude).
**  This is the inverse function to GreatCircleDist).
*/
void
GreatCirclePos(dist, course, slt, slg, xlt, xlg)
    double  dist;   /* -> great-circle distance (km) */
    double  course; /* -> initial great-circle course (degrees) */
    double  slt;    /* -> starting decimal latitude (-S) */
    double  slg;    /* -> starting decimal longitude(-W) */
    double  *xlt;   /* <- ending decimal latitude (-S) */
    double  *xlg;   /* <- ending decimal longitude(-W) */
{
    double  c, d, dLo, L1, L2, coL1, coL2, l;

    if (dist > KmPerDegree*180.0) {
        course -= 180.0;
        if (course < 0.0) course += 360.0;
        dist    = KmPerDegree*360.0-dist;
    }
    if (course > 180.0) course -= 360.0;
    c    = course*RadiansPerDegree;
    d    = dist*DegreesPerKm*RadiansPerDegree;
    L1   = slt*RadiansPerDegree;
    slg *= RadiansPerDegree;
    coL1 = (90.0-slt)*RadiansPerDegree;
    coL2 = ahav(hav(c)/(sec(L1)*csc(d))+hav(d-coL1));
    L2   = HalfPI-coL2;
    l    = L2-L1;
    if ((dLo=(cos(L1)*cos(L2))) != 0.0)
        dLo  = ahav((hav(d)-hav(l))/dLo);
    if (c < 0.0) dLo = -dLo;
    slg += dLo;
    if (slg < -PI)
        slg += TwoPI;
    else if (slg > PI)
        slg -= TwoPI;

    *xlt = L2*DegreesPerRadian;
    *xlg = slg*DegreesPerRadian;

} /* GreatCirclePos() */ 
```

> ### 资料来源：[http ://sam.ucsd.edu/sio210/propseawater/ppsw_c/gcdist.c](http://sam.ucsd.edu/sio210/propseawater/ppsw_c/gcdist.c)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-21T15:03:10.240

我认为，退出Haversine公式会更难，然后生成自己的公式。

首先是地核通过在地表上移动一条“直线”而产生的角度（你认为它是直的，但它是弯曲的）。

弧度角 = 弧长 / 半径。角度 = ArcLen/6371 公里

纬度应该很容易，只是角度的“垂直”（北/南）分量。

Lat1 + Cos(轴承) * 角度

经度划分因纬度而异。所以这变得更难了。你会使用：

Sin(bearing) * Angle (East 定义为负) 以找到经度方向的角度，但转换回该纬度的实际经度会更困难。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-02-22T16:33:37.243

请参阅本网站上的**目标点给定距离和方位角**部分：[http ://www.movable-type.co.uk/scripts/latlong.html](http://www.movable-type.co.uk/scripts/latlong.html)

# drupal - 以编程方式/通过 API 创建 Drupal CCK 内容

> ID：772880
> 
> 赞同：5
> 
> 时间：2009-04-21T14:35:27.203
> 
> 标签：drupal, cck

我正在使用 Drupal 6.x 系统来创建锻炼/个人培训计划，并且正在使用 CCK 与锻炼和计划的内容类型，其中计划包含一些标题字段和对它所包含的练习的节点引用列表. 这很好用，我可以手动创建运行良好的程序。我现在希望创建一个模块，它可以根据我开发的一些算法自动生成这些程序，过程如下所示：

1.  将所有练习加载到数组中
2.  加载用户个人信息（之前输入）
3.  建立最适合的练习
4.  创建新的节目内容类型
5.  保存程序

一个练习有许多相关的属性，虽然我可以使用 SQL 直接在表中完成上述所有操作，但它会非常复杂并且感觉不对。我想在第 1 步中将练习加载为一组练习对象（node_load？），然后创建一个程序对象并保存。这种 OO 类型的方法是否可行，还是我必须直接使用数据？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-21T14:49:30.303

解决此问题的最佳方法是编写自己的模块来执行此操作。

第 1 步你可以对所有的 excercies 执行 node_load($nid) 第 2 步你可以使用 user_load($uid) 第 3 步你需要遍历用户对象并匹配到适当的 excercies。步骤 4/5 我将创建一个新的 $node = stdClass(); 对象并使用正确的数据填充属性，然后执行 node_save($node); 这将为它分配一个 $node->id 等。

如果您不确定训练程序节点中有哪些属性，请执行 print_r($node); 在您已经创建的一个上。

菲尔

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T15:04:04.047

Drupal 不提供任何“级联”保存机制来一次性保存节点的层次结构。您需要按照 Phil Carter 的描述在代码中构建每个节点并显式调用 node_save() 。

[节点导出](http://drupal.org/project/node_export)模块可以生成用于以编程方式创建节点（包含 CCK 字段）的示例代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-23T06:46:45.253

我认为甚至没有必要“创建”这些程序。

为什么不只显示符合您的要求的练习列表并与用户共享“特征”。

我会通过使“特征”成为分类来实现这一点。然后使用配置文件或分类标志附加到用户。然后显示一个列表（一开始甚至可能是一个视图）和那些在练习中具有相同特征标签的列表。

这将是动态的和用户特定的，注意需要预加载一堆程序。

一个想法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T18:27:23.230

有很多模块试图正确地执行导入操作。看看它们的比较[http://groups.drupal.org/node/21338](http://groups.drupal.org/node/21338)

如果您需要将内容导入节点的策略或示例，那么这些是很好的资源。

# javascript - JS：有没有办法判断什么对象称为函数？

> ID：772882
> 
> 赞同：2
> 
> 时间：2009-04-21T14:36:16.310
> 
> 标签：javascript

在函数中有没有办法获得对调用它的对象的引用？我在页面上有两次相同的 Flash 对象实例，每个都可以通过 ExternalInterface 调用 JS，我无法将 Flash 对象编码为每个传递不同的 ID，因为它是同一个 Flash 对象的 2 个实例，所以它在那里JS 获取对哪个函数的引用的一种方法？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-21T20:11:50.060

实例化时不能将 ID 传递给 Flash 对象吗？（通过查询字符串或参数）。然后，您可以在 JavaScript 函数调用中使用该 ID。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-21T14:40:38.220

我不知道 ExternalInterface 但您是否尝试过`this`在执行函数期间检查对象？

当然，您总是可以使用闭包。最终，您必须为 Flash 对象提供一个要执行的功能。例如，我有`myObj1`一个`myObj2`回调方法，但由于某种原因在对自己执行这个函数时`fnCallback`没有设置上下文。`this`因此我可以这样做： -

```
function setCallback(obj, fn)
{
  obj.callback = function() {fn.apply(obj, arguments);}
}

setCallback(myObj1, fnCallback);
setCallback(myObj2, fnCallback); 
```

现在我可以编写 fnCallback 代码，`this`作为对调用该函数的特定对象的引用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T19:59:03.430

如果您正在寻找一种方法来查找调用函数的非函数元素，则可以考虑使用事件。这是一个非常方便的函数，我在传递事件对象时经常使用。

```
function getTargetElement(evt) {
  evt = (evt) ? evt : ((window.event) ? window.event : "");
  var elem;
  if (evt.target) {
      elem = (evt.target.nodeType == 3) ? evt.target.parentNode : evt.target;
  } else {
      elem = evt.srcElement;
  }
  return elem;
} 
```

因此，例如，如果您调用函数“find(event);” 从一个被点击的元素中，find 可以被编码来使用这个方法来获取事件对象：

```
function find(evt){
  var clickedObj = getTargetElement(evt);
  alert(clickedObj.tagName); //alerts "TD"
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T14:40:29.827

[arguments.caller](https://developer.mozilla.org/En/Core_JavaScript_1.5_Reference/Functions_and_function_scope/arguments/caller)或[Function.caller](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Function/caller)但您可能希望重新组织代码以避免使用它们。确实有另一种方法可以得到你想要的——我保证。

编辑：AnthonyWJones 指出您实际上是在寻找[this](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Operators/Special_Operators/this_Operator)运算符。

> *this*关键字指的是上下文对象（又名当前对象）。通常，在方法中，this 指的是调用对象。

# hibernate - 休眠会话问题新

> ID：772885
> 
> 赞同：0
> 
> 时间：2009-04-21T14:36:42.177
> 
> 标签：hibernate, session

我在 NetBeans 中使用休眠。我正在使用`util`NetBeans 的 Hibernate 插件附带的 hibernate 类来获取当前会话。也就是说，我正在使用以下代码来获取当前会话：

```
this.session = HibernateUtil.getSessionFactory().getCurrentSession(); 
```

但是，当我尝试延迟获取任何内容时，会出现以下错误：

```
org.hibernate.LazyInitializationException：延迟初始化课程失败。
```

我正在使用 2 DAO。一个是 Abstract DAO，第二个是扩展 AbstractDAO 的 CoutseDAO。代码如下

```
public class AbstractDAO<T> {

    Session session = null;

    public AbstractDAO()
    {
      this.session = HibernateUtil.getSessionFactory().getCurrentSession();

   }

    public void createObject(T object)
    {
         Transaction tx = null;
        try
        {

            tx = session.beginTransaction();
            session.save(object);
            tx.commit();

        }
        catch (HibernateException e)
        {
            tx.rollback();
            throw new DataAccessLayerException(e);

        }
        finally
        {

        }
    }
    public  void updateObject(T object )
    {
         Transaction tx = null;
        try
        {

            tx = session.beginTransaction();
            session.update(object);
            tx.commit();

        }
        catch (HibernateException e)
        {
            tx.rollback();
            throw new DataAccessLayerException(e);

        }
        finally
        {

        }
    }

      public  void deleteObject(T object )
    {
         Transaction tx = null;
        try
        {

            tx = session.beginTransaction();
            session.delete(object);
            tx.commit();

        }
        catch (HibernateException e)
        {
            tx.rollback();
            throw new DataAccessLayerException(e);

        }
        finally
        {

        }
    }

} 
```

第二课如下

```
public class CourseDAO extends AbstractDAO<Course>{

    public CourseDAO()
    {
        super();
    }

    public Course findByID(int cid){

        Course crc = null;
        Transaction tx = null;
        try {
            tx = session.beginTransaction();
            Query q = session.createQuery("from Course  as course where course.cid = "+cid+" ");
            crc = (Course) q.uniqueResult();
            tx.commit();
        } 
        catch (HibernateException e)
        {
            e.printStackTrace();
            tx.rollback();
            throw new DataAccessLayerException(e);
        }

        finally
        {

        }
        return crc;
}

    public List<Course> findAll(){

        List lst = null;
        Transaction tx = null;
        try {
            tx = session.beginTransaction();
            Query q = session.createQuery("from Course  ");
            lst =  q.list();
            tx.commit();
        }
        catch (HibernateException e)
        {
            e.printStackTrace();
            tx.rollback();
            throw new DataAccessLayerException(e);
        }

        finally
        {

        }
        return (List<Course>)lst ;
}

} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-21T14:40:46.957

惰性字段只能在获取对象的事务边界内访问。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T14:51:01.080

您需要设置事务管理器，以便 hibernate 可以在同一事务中执行延迟获取的查询。

休眠站点似乎已关闭，但谷歌有[缓存](http://74.125.77.132/search?q=cache:uawv6dDyk8sJ:www.hibernate.org/42.html+hibernate+transaction+managers&cd=1&hl=en&ct=clnk&gl=uk:)

在 Hibernate 配置中启用线程绑定策略：

```
set hibernate.transaction.factory_class to org.hibernate.transaction.JDBCTransactionFactory
set hibernate.current_session_context_class to thread 
```

还有其他选项，例如 JPA、EJB 或滚动您自己的选项。

如果您没有在应用服务器中运行或使用其他东西以其他方式为您处理事务，则您的代码必须“手动”启动事务。

```
try {
  factory.getCurrentSession().beginTransaction();

   // Do some work
  factory.getCurrentSession().load(...);
  factory.getCurrentSession().persist(...);

  factory.getCurrentSession().getTransaction().commit(); 
}
catch (RuntimeException e) {
    factory.getCurrentSession().getTransaction().rollback();
    throw e; 
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-05-06T09:21:13.003

这似乎是对 DAO 的可怕误用，以完成 Hibernate 打算做的工作。

1.  事务边界不应在 DAO 方法边界处终止。
2.  您不应该直接编写查询，Hibernate 可以在其中完成工作，
3.  findById() 应该只是对 Session.load(Course.class, id) 的调用。
4.  `createObject( T object)`名称错误；它应该是“保存”。
5.  异常捕获也被错误地放置；它应该在 Tx 边界上。

整件事完全错了，绝对是垃圾，你写的一切都是错误的和不必要的。看在上帝的份上，您正在尝试编写 JDBC 和事务管理，而这已经为您完成了。

以下是您的代码应该如何运行：

```
Session hb = sf.openSession();  // or wherever you get a Session from

// load by ID
Course course = (Course) hb.load( Course.class, id);

// list all courses
Criteria crit = hb.createCriteria( Course.class);
List<Course> allCourses = crit.list();

// create a new Course
Course newCourse = new Course("Hibernate 101");
hb.save( newCourse);

// delete the old one
hb.delete( course);

// flush & commit all changes, in a transaction.
Transaction tx = hb.beginTransaction();
/* hb.flush() */
tx.commit(); 
```

摆脱*所有*这些 DAO 垃圾并直接使用 Hibernate，直到您知道自己在做什么。DAO/业务方法应该**简单**，不要试图做事务/或异常管理；它们*在*事务中运行。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-21T14:47:58.110

您可能是“陈旧”对象的受害者。使用 Seam 时，我遇到了注入对象的问题。我们的解决方案是在使用之前重新获取主对象，例如调用：

```
getEm().find( MyClass.class, id ); 
```

基本上，每当您在我们的操作类中调用一个方法时，您都需要这样做以确保该对象在您当前的会话/事务中不会过时。

此外，异常（即使被捕获！）可能会关闭当前会话，从而导致 LazyInitialization 错误。

# security - 使用 WinAuth 连接到数据库

> ID：772888
> 
> 赞同：0
> 
> 时间：2009-04-21T14:37:42.597
> 
> 标签：security, sql-server-2008, connection-string, windows-authentication

在回答我一周前提出的一个问题时，我将数据库引擎更改为只接受 Windows 身份验证而不是 SQL 身份验证。因为我们的代码运行在与数据库连接不同的用户上下文中，所以我们需要指定用户名和密码信息才能连接到数据库。我们如何使用 ConnectionString 来做到这一点？请记住，我们不再使用 SQL 身份验证。

谢谢，

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-21T14:59:02.123

在您的 SQL Server 实例上，您需要在安全节点下添加域组（主服务器组中的一个，而不是单个数据库中的那个）。在该节点下，最终结果将是一个类似于

```
<Your Domain>\Domain Users 
```

然后在您的应用程序（Windows 或 Web）连接字符串中，您希望将集成安全设置为 TRUE，而在其他地方，您需要将 Impersonation 也设置为 True。我在这里含糊不清，因为方法因应用程序类型而异。

希望这能让你走上正确的道路。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T14:40:38.580

由于您仅使用 Windows 身份验证，因此您不能在连接字符串中。调用进程将需要模拟具有相关访问权限的 Windows 原则（用户）。

# emacs - Emacs：修复某些窗口的高度

> ID：772891
> 
> 赞同：5
> 
> 时间：2009-04-21T14:38:23.810
> 
> 标签：emacs

有没有办法修复某个窗口的高度，就像使用**compilation**缓冲区一样可以使用 *compilation-window-height*？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-21T15:41:37.230

有[`window-size-fixed`](http://www.delorie.com/gnu/docs/elisp-manual-21/elisp_441.html#IDX1477)缓冲区局部变量。如果将其值设置为`height`or `t`，则该窗口将获得固定高度。

例如

```
M-x set-variable window-size-fixed height 
```

# svn - 从 svn 存储库更新返回“无法读取块大小”错误

> ID：772894
> 
> 赞同：55
> 
> 时间：2009-04-21T14:39:06.447
> 
> 标签：svn, tortoisesvn, connection

使用 tortoise svn 客户端从 subversion 存储库更新时，出现如下错误：

```
Could not read chunk size: An existing connection was forcibly closed by the remote host. 
```

它不会阻止我更新，只是中断更新过程，因此我必须重复更新几次，才能完成。

什么会导致这种行为以及如何解决？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2010-05-07T04:48:31.320

我从几台机器上的客户端收到“无法读取块大小”消息。

弄清楚它的关键是 Apache 错误日志中的这个错误：

```
[Fri May 07 14:26:26 2010] [error] [client 155.35.175.50] Provider encountered an error while streaming a REPORT response.  [500, #0]
[Fri May 07 14:26:26 2010] [error] [client 155.35.175.50] Problem replaying revision  [500, #24]
[Fri May 07 14:26:26 2010] [error] [client 155.35.175.50] Can't open file '/usr/site/svnrep/impc/db/revs/16122': Too many open files  [500, #24] 
```

处理 svn 操作的 Apache 进程用完了文件描述符。在我的 Ubuntu 服务器上，我通过`/etc/security/limits.conf`在底部编辑并添加它来修复它：

```
*               hard    nofile          5000
*               soft    nofile          5000 
```

这将文件描述符限制从 1024 增加到 5000。然后我登录一个新的 shell 并确认限制通过`ulimit -n`. 然后重新启动 Apache。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2011-07-20T20:17:00.067

我刚刚收到“无法读取块大小”错误**并找到了解决方案**——至少在一种情况下。

## 首先，我的配置...

**服务器：** 在 32 位 Windows Server 2003 上运行的 CollabNet Subversion Edge Server 2.0.0-2190.74（Subversion 二进制文件 1.6.17-2190.74）。

**客户端：** TortoiseSVN 1.6.16，内部版本 21511 - 32 位（Subversion 1.6.17），运行在带有 SP3 的 32 位 Windows XP Pro 上。

## 重现步骤...

右键单击将版本控制的子文件夹拖动到本地工作副本文件夹中的另一个版本控制的子文件夹中，然后选择**“此处的 SVN 复制版本控制项目”**后出现此错误（这是 Windows 资源管理器中的 TortoiseSVN 上下文菜单命令，正确时-拖动文件夹）。该子文件夹包含一个 ANSI 编码的文本文件 MANIFEST.MF，我相信我没有修改它（我的 Subversion 配置不包括 .MF 文件的 mime 类型）。 **我随后提交了新复制的子文件夹。** 后来，每当我尝试在这台 PC 上更新我的 Subversion 本地工作副本文件夹时，都会遇到块大小错误。

## 解决方法...

我通过重新启动我的 Subversion/Apache 服务解决了这个问题（它本身并没有帮助，可能没有必要），然后**从我的本地工作副本文件夹中删除新添加的子文件夹**（它已经进入 repo，所以我不会丢失任何东西），**然后执行 Update**，它在没有块大小错误的情况下成功并重新获取了我刚刚删除的子文件夹。

就我而言，我以这种方式复制了两个版本化的子文件夹，直到我删除了这两个新的子文件夹后，我才能成功更新本地工作副本文件夹的根目录。

## 跟进...

我认为这是 Subversion 服务器和/或 TortoiseSVN 客户端中的一个错误，但我没有调试技能来做出这个决定。我将在 TortoiseSVN 问题跟踪器中报告我的发现并查看结果。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2011-03-03T13:58:08.990

我刚遇到这种情况，这*不是*服务器问题；我的工作副本被损坏了（顺便说一句）。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2012-05-15T10:02:09.973

关闭客户端防病毒软件后，问题和（其他）消失了。

我通过 Apache 使用带有 subversion 1.7.4 的 Ubuntu 服务器。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-21T16:34:15.263

检查 apache 错误日志，应该有一个错误记录在那里并带有错误号。该数字将有助于找出连接断开的原因。

如果错误日志中没有任何内容，请检查您的病毒扫描程序/防火墙设置：如果其中一些工具认为传输的数据很危险，它们会断开连接。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-10-14T06:45:12.793

对我们来说，问题是 Apache 超时。更新大约需要 15 分钟，但 Apache 在 10 分钟后超时，导致我们的 SVN 服务器给出您看到的错误。最终的解决方案是增加 Apache 的超时设置。我们使用 VisualSVN 服务器 - 有关如何更改此设置的详细说明，请查看此处： [http ://adventuresindotnet.blogspot.com/2010/09/svn-trouble.html](http://adventuresindotnet.blogspot.com/2010/09/svn-trouble.html)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-01-10T14:37:12.757

我更改为 Ubuntu 服务器，但我们遇到了同样的错误 - 跨多个客户端 PC、操作系统和客户端版本。

在确保文件限制设置和 Apache 超时设置都符合建议之后。

（见[http://posidev.com/blog/2009/06/04/set-ulimit-parameters-on-ubuntu/](http://posidev.com/blog/2009/06/04/set-ulimit-parameters-on-ubuntu/)）

我最终通过使用 apache2-mpm-prefork 包而不是 apache2-mpm-worker 包解决了这个问题。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-12-14T13:47:38.040

在我重命名文件夹并提交后，我在更新时收到了同样的错误消息。我创建了一个新的工作目录，但没有收到错误。所以，我只是将我的更改移动到新的工作目录，提交并删除旧目录。

所以，这个错误似乎是由我的本地目录损坏引起的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-01-20T04:44:43.217

**VisualSVN 2.5.8：**有同样的错误，接下来的步骤帮助我修复了这个错误：

**在服务器上：**

1.  删除服务器上有问题的文件夹；
2.  重启 VisualSVN 服务器。

**在工作站上：**

1.  更新父文件夹；
2.  再次添加文件夹和文件；
3.  添加到 SVN ;
4.  犯罪。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-12T08:36:51.293

我也明白。我们的服务器是在 Windows 上运行的 Apache。我的客户端以高速连接，但延迟有点高（200 毫秒）。难题的另一部分是我正在运行 Windows Vista。开启自动缩放和 rss 似乎可以改善这种情况，但并不能解决问题。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-05-10T05:43:19.900

此错误消息还有另一个烦人的原因。它可能是您的路由器或路由器的固件。

我最近将我的 Linksys WRT110 的固件从版本 1.0.02 升级到了 1.0.07，之后，subversion 无法再向存储库添加新文件。它只能更新现有文件。回滚到 1.0.02 解决了这个问题。

资料来源：

*   [http://blog.wouldbetheologian.com/2008/12/warning-on-linksys-wrt110-firmware.html](http://blog.wouldbetheologian.com/2008/12/warning-on-linksys-wrt110-firmware.html)
*   [http://homecommunity.cisco.com/t5/Wireless-Routers/Upgraded-WRT-110N-to-1-0-07-and-now-Subversion-won-t-work/td-p/321812](http://homecommunity.cisco.com/t5/Wireless-Routers/Upgraded-WRT-110N-to-1-0-07-and-now-Subversion-won-t-work/td-p/321812)

基本上，只要连接突然断开，您就会收到此错误。就像你们中的许多人所说的那样，可能是 Apache 上的配置错误。这也可能是由于服务器速度慢或连接过载，或者可能是由于路由器便宜，就像我的情况一样。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-12-13T03:40:56.323

这显然有很多原因，但对我来说，这是通过重新启动我的 SVN 服务器（VisualSVNServer 2.5.1）来解决的。在对新加载的转储执行完整的 repo 签出时，经常会发生这种情况。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-03-10T13:53:52.080

对我们来说，解决方法是将SVN**客户端从 1.8****降级**到 1.7（与 TortoiseSVN 捆绑在一起的命令行客户端）。

 **# httpwebrequest - 如何在提琴手中查看对我的网站和从我的网站 iis 5 的请求

> ID：772901
> 
> 赞同：5
> 
> 时间：2009-04-21T14:40:24.070
> 
> 标签：httpwebrequest, http-headers, xmlhttprequest, fiddler

嗨，我在 windows xp iis 5 sp3 上有网络服务器。我看到日志，但只有我网站的 url。但我需要查看所有请求信息（标题和正文）例如我去 GMAIL 并单击搜索 rss 提要（我添加我自己的 rss）并且 gmail 需要将请求发送到我自己的网络服务器 13:01:05 74.125.16.68 GET / 9.rss 200（它发送请求，我看到了日志）。我想查看有关请求标头内容类型 rss Keep-ALive 的所有信息

ETC...身体

Fiddler 没有看到这个请求我有 2 种方式（使用 iis 保护它或搜索一个好的 http 调试器

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-21T14:58:13.247

通常 Fiddler 会显示通过 Wininet http 堆栈的所有 HTTP 流量，因为它会在开始捕获时调整 Wininet 的代理设置。

为了通过 Fiddler 路由其他请求，应用程序需要手动定向到 Fiddler。

在 .NET 应用程序中，您将使用 .config 文件。添加以下内容：-

```
<system.net>
    <defaultProxy enabled="true">
        <proxy proxyaddress="http://127.0.0.1:8888" bypassonlocal="False"/>
    </defaultProxy>
</system.net> 
```

只需确保 Fiddler 在启用此功能时正在捕获，并在暂停捕获或关闭 fiddler 之前将 enabled 设置为 false。

对于可能使用 WinHTTP 堆栈的其他应用程序，请使用以下命令：-

```
proxycfg 
```

查看 WinHTTP 的当前代理配置是什么。（这很可能没有）。然后：-

```
proxycfg -u 
```

在捕获开始后将 WinHTTP 指向 WinINET 使用的相同设置。在停止捕获之前使用：-

```
proxycfg -d 
```

恢复直接连接（或使用 proxycfg -h 了解如何恢复原始设置）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T14:57:53.013

转到工具 -> 填充选项 -> 连接选项卡 -> 监控所有连接。祝你好运：D。

# php - 如何在 mysqli 准备好的语句中使用 IN 子句

> ID：772913
> 
> 赞同：13
> 
> 时间：2009-04-21T14:42:23.100
> 
> 标签：php, mysqli, sql-in

我正在使用准备好的语句将一些旧代码移动到新的 msqli 接口，我在处理包含 IN 子句的 SQL 语句时遇到了问题。我通常会这样做：

```
$ids = '123,535,345,567,878'
$sql = "SELECT * FROM table WHERE id IN ($ids)";
$res = mysql_query($sql); 
```

将此转换为 mysqli 和准备好的语句，我尝试了多种解决方案：

```
$ids = '123,535,345,567,878'
$ids = implode($ids,',');
$result = $msqli->prepare("SELECT foo,blar FROM table WHERE id IN (?));
$result->bind_param("i", $ids);
$result->execute(); 
```

以上失败，计算数组中的元素数量和更改 SQL 字符串中的问号数量以及为数组中的每个元素调用 bind_parm 也失败。仅使用逗号分隔的字符串也会失败。

我在谷歌上找不到关于这方面的好文档，那么你是如何解决这个问题的？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-21T14:45:01.953

不可能将可变长度列表绑定到单个绑定变量。

同样，如果您要绑定字符串`$ids`，您实际上会得到：

```
SELECT foo,blar FROM table WHERE id IN ('123,535,345,567,878') 
```

（注意 ID 列表周围的引号）。

使用正确数量的问号和绑定参数创建自己的查询应该确实有效 - 您可能需要再次尝试并报告实际错误。

或者，这可能是不幸需要手工制作自己的 SQL 并且不使用绑定参数的情况之一。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-21T14:51:00.537

查看之前在此处提出的类似问题的答案（第二个代码示例）：

[我有一个整数数组，如何在 mysql 查询（在 php 中）中使用每个整数？](https://stackoverflow.com/questions/330268/i-have-an-array-of-integers-how-do-i-use-each-one-in-a-mysql-query-in-php)

它归结为：

*   创建带有适量问号的 SQL 字符串
*   用于`call_user_func_array()`将数组绑定到查询字符串

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2013-05-14T23:04:07.720

我认为准备好的陈述的意义在于，在这种情况下你可以这样做：

```
$stmt = $this->mysqli->prepare("UPDATE radcheck SET attribute = ?, value = ?  WHERE username = ? AND attribute LIKE 'CS-Total-Octets%'");
foreach ($usernames as $username)
{
    $stmt->bind_param('sss', $bandwidth_types[$bandwidth_type], $bandwidth_bytes, $username);
    $stmt->execute();
}
$stmt->close(); 
```

# java - Java - local class and generics, why compiler warning?

> ID：772914
> 
> 赞同：5
> 
> 时间：2009-04-21T14:42:23.490
> 
> 标签：java, generics, inner-classes

Named [local classes](http://java.sun.com/docs/books/jls/third_edition/html/statements.html#247766) are very rarely used, usually local classes are anonymous. Does anybody know why the code below generates a compiler warning?

```
public class Stuff<E> {
  Iterator<E> foo() {
    class InIterator implements Iterator<E> {
      @Override public boolean hasNext() { return false; }
      @Override public E next() { return null; }
      @Override public void remove() { }
    }
    return new InIterator();
  }
} 
```

The warning is in `new InIterator()` and it says

```
[unchecked] unchecked conversion
found   : InIterator
required: java.util.Iterator<E> 
```

If the class, unchanged, is made anonymous, or if it is made a member, the warning goes away. However, as a named local class, it requires a declaration `class InIterator<E> implements ...` for the warning to go away.

What's going on?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-21T14:54:44.630

I believe what's happening is you are ignoring the generic type argument by naming `InIterator` without a reference to the generic in the signature (even though it is present in the interface).

This falls into the category of silly compiler warnings: you've written the class so that 100% `InIterator` instances will implement `Iterator<E>`, but the compiler doesn't recognize it. (I suppose this depends on the compiler. I don't see the warning in my Eclipse compiler, but I know that the Eclipse compiler handles generics slightly differently than the JDK compiler.)

I argue that this is less clear, and less close to what you mean, but perhaps more compiler friendly, and ultimately equivalent:

```
public class Stuff<E> {
  Iterator<E> foo() {
    class InIterator<F> implements Iterator<F> {
      @Override public boolean hasNext() { return false; }
      @Override public E next() { return null; }
      @Override public void remove() { }
    }
    return new InIterator<E>();
  }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T15:01:06.157

Hmm, no warnings here.

```
import java.util.Iterator;

public class Stuff<E> {
    Iterator<E> foo() {
        class InIterator implements Iterator<E> {
            public boolean hasNext() {
                return false;
            }

            public E next() {
                return null;
            }

            public void remove() {
            }
        }
        return new InIterator();
    }

    public static void main(String[] args) {
        Iterator<String> i = new Stuff<String>().foo();
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-21T15:43:33.310

I am now convinced that it's a javac bug. The solutions above that add a generic parameter to InIterator that either hides or replaces E aren't helpful, because they preclude the iterator from doing something useful, like returning an element of type E - Stuff's E.

However this compiles with no warnings (thanks Jorn for the hint):

```
public class Stuff<E> {
  E bar;
  Iterator<E> foo() {
    class InIterator<Z> implements Iterator<E> {
      @Override public boolean hasNext() { return false; }
      @Override public E next() { return bar;  }
      @Override public void remove() { }
    }
    return new InIterator<Void>();
  }
} 
```

Definitely a bug.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-21T18:40:53.087

Yeah, I also agree that this should be a bug. If you "lift" the local class out of the method into a member class, it works fine too. And there isn't much difference between the two except different scoping and access to local variables.

```
public class Stuff<E> {
  class InIterator implements Iterator<E> {
    @Override public boolean hasNext() { return false; }
    @Override public E next() { return null; }
    @Override public void remove() { }
  }
  Iterator<E> foo() {
    return new InIterator();
  }
} 
```

# php - php微秒

> ID：772917
> 
> 赞同：4
> 
> 时间：2009-04-21T14:42:59.867
> 
> 标签：php, datetime

我使用
`echo date('H:i:s')." this step time\n";`
它是为了知道每个函数需要多少时间才能执行。

我怎么能知道微秒的时间呢？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-21T14:54:10.123

补充一点，PHP 的[microtime()](http://www.php.net/microtime)函数可以这样使用：

```
$time_start = microtime(true);

//do stuff here

$time_end = microtime(true);
$time = $time_end - $time_start;

echo "It took $time seconds\n"; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-21T14:46:06.350

```
u 微秒（在 PHP 5.2.2 中添加）
```

看一眼[http://no.php.net/manual/en/function.date.php](http://no.php.net/manual/en/function.date.php)了解更多信息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-21T14:47:00.980

以毫秒为单位使用格式中的“u”标记。

# c - 用 C 阅读 Pdf

> ID：772919
> 
> 赞同：4
> 
> 时间：2009-04-21T14:43:29.633
> 
> 标签：c, linux, pdf, libharu

我希望能够阅读 pdf 文件的内容。我需要在 Linux 上使用 C 来做到这一点。

我离[这里](https://stackoverflow.com/questions/58730/open-source-pdf-library-for-cc-application)越近，但我认为 Haru 只能创建 pdf 并且无法阅读它们（不是 100% 肯定）。

PS：我只需要pdf中的纯文本

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-21T14:54:01.107

查看[libpoppler](http://poppler.freedesktop.org/)。我从来没有使用它来提取文本，只是查询 PDF 属性。它很容易使用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-21T14:51:10.643

你需要多好地解析它们？仅提取字符串应该相对容易，完全准确的渲染更难。看看 evince 或 ghostscript 的来源？

这适用于 C++，但可能是理解 PDF 结构的一个很好的起点[http://www.codeproject.com/KB/cpp/ExtractPDFText.aspx](http://www.codeproject.com/KB/cpp/ExtractPDFText.aspx)（抱歉之前的链接错误）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T14:59:55.100

虽然我从未使用过它，但另一种可能是 VersyPDF。它声称允许您编辑 PDF ... [http://versypdf.sybrex-systems-ltd.qarchive.org/](http://versypdf.sybrex-systems-ltd.qarchive.org/)

# python - 以编程方式使用的免费单词列表？

> ID：772922
> 
> 赞同：41
> 
> 时间：2009-04-21T14:43:48.383
> 
> 标签：python, dictionary, word-list

我的一个朋友正在谈论她喜欢玩的文字游戏，您可以尝试通过一次切换一个字母来将一个单词转换为另一个单词（它们具有相同数量的字母），每次迭代都会产生一个真实的单词。

例子：

> MOON --> WOLF
> GOON
> GOOF
> GOLF
> WOLF

我认为编写一个程序来生成解决方案会是一个有趣的小项目，然后再进一步，给定 2 个单词，确定解决方案是否存在以及最佳解决方案中的迭代次数。

问题是我无法找到可以以编程方式轻松访问的免费单词列表。我也在考虑以此为借口来学习 Python，所以如果有人知道免费单词列表和如何从 Python 解析和访问它的指针，那就太好了。找出如何找到最佳路径的算法，我将自己研究。

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2009-04-21T14:45:49.800

选项：

1.  在您的常见或花园品种 Unix 安装中查找 /usr/share/dict/words。
2.  [http://www.ibiblio.org/webster/](http://www.ibiblio.org/webster/)
3.  [http://wordlist.sourceforge.net/](http://wordlist.sourceforge.net/)
4.  [http://svnweb.freebsd.org/csrg/share/dict/](http://svnweb.freebsd.org/csrg/share/dict/)（点击文件'words'的'revision'标签）

`#4`是我自己用于文字游戏的[Python 实验](https://stackoverflow.com/questions/746082/how-to-find-list-of-possible-words-from-a-letter-matrix-boggle-solver)，效果很好。

对于奖励积分，这里有一些东西可以让你开始你的文字程序：

```
import re
startwith = "MOON"
endwith = "GOLF"
cklength = re.compile('.{' + str(len(startwith)) + '}(\n)?$', re.I)
filename = "C:/dict.txt"
words = set(x.strip().upper() for x in open(filename) if x.match(cklength)) 
```

单词将是字典中所有 4 个字母单词的集合。你可以从那里做你的逻辑。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-04-21T14:46:57.363

大多数 unix（包括 osx）都有一个文件`/usr/share/dict/words`.

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-21T14:45:45.930

[你可以在这里](http://wordlist.sourceforge.net/)找到一个 2.2mb 的英文单词列表。

您可以使用[文件 i/o 函数](http://www.diveintopython.org/file_handling/index.html)访问它们。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-21T14:47:12.883

如果您可以访问 linux 安装，则应该有一些单词列表

```
/usr/share/dict/ 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-21T14:52:31.593

[查看dict.org](http://www.dict.org/w/databases/dict)中的数据库。这些实际上是字典数据库，因此您需要自己提取单词定义。你可以从[Wordnet](http://wordnet.princeton.edu/obtain)开始。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-08-06T05:33:41.280

我遇到了同样的问题，并且在研究一个基于拼字游戏的网站时，我发现他们的几个单词列表采用了很好的文本格式。[他们在https://www.wordgamedictionary.com/english-word-list/](https://www.wordgamedictionary.com/english-word-list/)有英文版

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-21T14:50:20.647

对于类似的东西，我使用了[Mozilla Firefox](https://addons.mozilla.org/en-US/firefox/language-tools/)英语词典。找到您想要的英语变体，例如[US English](http://www.google.com/search?q=firefox%20dictionaries)，然后右键单击保存到（“添加到 Firefox”按钮）。你得到的文件是 XPI 类型，但它实际上是一个伪装的 ZIP 文件。在里面你会发现`en-GB.dic`哪个是字典内容。

[![在此处输入图像描述](https://i.stack.imgur.com/ESc8A.png)](https://i.stack.imgur.com/ESc8A.png)

里面的字典目录：

[![在此处输入图像描述](https://i.stack.imgur.com/z4oMm.png)](https://i.stack.imgur.com/z4oMm.png)

# .net - 如何从 Windows 执行 Unix shell 脚本

> ID：772935
> 
> 赞同：6
> 
> 时间：2009-04-21T14:46:40.170
> 
> 标签：.net, windows, unix, shell, cross-platform

我有一个想要从 .NET 应用程序运行的 AIX 脚本。如果这给了我更好的选择，我不反对启动 Windows 批处理文件。

我在 Google 上看到的大部分内容都与使用 rsh 或 Plink 等工具或使用 ssh 或 telnet 相关。我无法访问 rsh 或 Plink（尽管我确实有 PuTTY 并且可能会获得 Plink）。我可以通过 ssh 连接到 AIX 机器，但禁用了 telnet。

我需要一种传递用户凭据的方法。

谁能推荐从 Windows 应用程序调用 Unix 脚本的最佳方法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-21T14:57:03.720

安装cygwin。包括 ssh 功能。设置您的 ssh 密钥 - Windows 上的私钥，AIX 机器上的公钥。然后你可以运行“ssh user@aixbox script-on-aix-box.sh”。

最好将脚本放在 AIX 上，尽管您可以先使用 scp 将文件复制到 AIX。通过 ssh 传递长命令行很容易出错 - 不是因为它是 ssh，而是因为正确设置转义以从 .NET 通过 ssh 传递到 ksh 或在 AIX 上运行的任何东西都是痛苦的。最好让事情尽可能简单，最好只有一个命令，然后可以是一个执行多项操作的脚本。

要回答您的评论，另一条评论需要很长时间：

(1) 为什么使用 cygwin 的 ssh 实用程序而不是 Windows 的 ssh 实用程序更好？

a) 我更了解它，所以我不知道建议任何 windows ssh 实用程序（我什至不知道 Windows 附带 ssh 实用程序），并且 b) cygwin 的 ssh 实用程序更有可能成为标准 ssh我们 unix 怪胎喜欢的熟悉感。:-)

(2) 钥匙有什么用？这是否允许跨平台身份验证，或者它只是一种非对称加密密码的方式？

密钥允许无密码访问。如果你将你的私钥设置为无密码（通常不推荐，但如果你能保证你的机器安全，它适用于自动化工具），你的工具将能够在没有密码提示的情况下直接 ssh - 这让事情变得更容易.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-21T14:59:25.977

ssh eximadmin@172.16.12.10 "cat somefile.log"

（其中 cat somefile.log 替换为您要运行的命令）

我认为最简单的方法是从您的 .net 应用程序调用的批处理文件中调用您的 ssh 程序（无论是 ssh、plink 还是其他）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-21T15:00:38.920

我支持 cygwin 的建议，但您拥有的另一个选择是 Microsoft's [Services for UNIX](http://technet.microsoft.com/en-us/interopmigration/bb380242.aspx)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-21T15:03:05.793

我要做的是在 AIX 机器上设置一个服务（https）接口，让 .Net 应用程序可以运行。这实际上是您希望如何在 AIX 机器上公开脚本的问题。恕我直言，Java + Tomcat 很容易在 AIX 机器上进行设置，只需确保限制您的暴露，和/或需要 AIX 服务的身份验证票证。这与其说是一个 .Net 问题，不如说是一个架构决策。

- 编辑 -

正如其他人所建议的那样，您也可以使用 Cygwin。您也可以使用 .Net 的 SSH 组件，这对您来说可能更透明。（[商业](http://www.chilkatsoft.com/ssh-sftp-component.asp)和[FOSS](http://www.routrek.co.jp/en/product/varaterm/granados.html)）

# apache-flex - Flex 3 - TextInput 控件中的等号 (=) 在 Firefox 中显示为加号 (+)

> ID：772940
> 
> 赞同：1
> 
> 时间：2009-04-21T14:47:27.157
> 
> 标签：apache-flex, flex3

当我部署我的 Flex 应用程序并在 Firefox (3.0.8) 中浏览到它时，在 TextInput 控件中键入等号会产生一个加号。

在 Chrome 和 IE 中，等号按预期工作。此外，当我在 Firefox 中本地运行 Flex 项目时，等号可以正常工作。

我尝试在不同的服务器上部署 SWF，但等号仍在 Firefox 中转换为加号。

这是应用于 TextInput 控件的 CSS：

```
TextInput
{
   color: #333333; 
   fontSharpness:"200"; 
   fontAntiAliasType:"advanced"; 
   fontSize: 12; 
   font-family: Arial, "Hiragino Kaku Gothic Pro", "ヒラギノ角ゴ Pro W3", "ＭＳ Ｐゴシック", sans-serif; 
} 
```

除了 CSS 之外，没有对控件进行其他修改。有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-21T18:54:51.480

这是[Firefox](https://bugzilla.mozilla.org/show_bug.cgi?id=347185) /Flash 中的一个已知问题。如果禁用 wmode=transparent，它应该会按预期工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T18:58:57.757

如果您在 Flex/AS3 中使用 wmode 和透明度以及组件，您还可以通过强制渲染舞台来解决此问题。

查看舞台活动：

```
stage.dispatchEvent(new Event(Event.RENDER)) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T15:38:52.400

Firefox 中的语言编码是什么？您是否使用不同的键盘布局？这听起来像是 Firefox 配置的问题。

# sharepoint - 使用变体站点进行共享点搜索

> ID：772941
> 
> 赞同：0
> 
> 时间：2009-04-21T14:47:40.760
> 
> 标签：sharepoint

我有一个带有变体的共享点站点。我如何分离搜索结果，以便它只从它所在的变体站点检索结果。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-21T17:23:59.233

创建一个仅使用您想要的特定内容源的搜索范围。然后将新创建的范围分配给搜索页面上的搜索范围下拉菜单。

我想这就是你要问的。如果没有，我的错。

# c# - 使用 C# 将 XML 导入 SQL

> ID：772946
> 
> 赞同：1
> 
> 时间：2009-04-21T14:48:34.847
> 
> 标签：c#, sql, xml, linq-to-sql, linq-to-xml

我知道寻求这种帮助并不是体育运动，但我真的坚持了一段时间 - 现在我正在阅读两本 C# 书籍并且每天工作超过 9 个小时。

好的，这是我的问题：我有一个几乎完整的 WinForms C# 应用程序。在 SQL 中，我有三个如下所示的表：

```
CREATE TABLE [dbo].[Racuni](
[BROJ] [varchar](12) NULL,
[DATUM] [datetime] NULL,
[TS] [datetime] NULL,
[USER_ID] [int] NULL,
[KASA_ID] [varchar](3) NULL,
[TOTAL] [float] NULL,
[STATUS] [varchar](1) NULL,
[ARH] [varchar](max) NULL
 ) ON [PRIMARY]

Create Table "Rac_Npl" 
( br_rac Char( 12 )
, kasa_id Char( 3 )
, npl_id Integer
, iznos Money);

CREATE TABLE [dbo].[Stavke](
[br_rac] [varchar](12) NULL,
[kasa_id] [char](3) NULL,
[art_id] [int] NULL,
[kol] [float] NULL,
[mpc] [money] NULL,
[ompc] [money] NULL) 
```

我在本地磁盘上有用于导入这三个表的 XML 文件 - XML 如下所示：

```
<?xml version="1.0" encoding="windows-1250"?>
<transaction>
<table name="qryRacuniSmjene">
<fields>
<field name="BROJ" type="1" size="12"/>
<field name="DATUM" type="9" size="0"/>
<field name="TS" type="11" size="0"/>
<field name="USER_ID" type="3" size="0"/>
<field name="KASA_ID" type="1" size="3"/>
<field name="TOTAL" type="8" size="4"/>
<field name="STATUS" type="1" size="1"/>
<field name="ARH" type="16" size="1"/>
</fields>
<data>
<row>
<![CDATA[09-0002-0001]]>
<![CDATA[16.04.2009]]>
<![CDATA[16.04.2009 13:23:27]]>
<![CDATA[1]]>
<![CDATA[001]]>
<![CDATA[2,60]]>
<![CDATA[D]]>
<![CDATA[
   porezni broj: 000000000000
   Zaobilaznica bb
]]>
</row>
<row>
<![CDATA[09-0002-0002]]>
<![CDATA[16.04.2009]]>
<![CDATA[16.04.2009 13:23:27]]>
<![CDATA[1]]>
<![CDATA[001]]>
<![CDATA[2,60]]>
<![CDATA[D]]>
<![CDATA[
   porezni broj: 000000000001
   Zaobilaznica bb
]]>
</row>
</data>
</table>
<table name="qryRac_nplSmjene">
<fields>
<field name="br_rac" type="1" size="12"/>
<field name="kasa_id" type="1" size="3"/>
<field name="npl_id" type="3" size="0"/>
<field name="iznos" type="8" size="4"/>
</fields>
<data>
<row>
<![CDATA[09-0002-0001]]>
<![CDATA[001]]>
<![CDATA[1]]>
<![CDATA[2,60]]>
</row>
<row>
<![CDATA[09-0002-0002]]>
<![CDATA[001]]>
<![CDATA[1]]>
<![CDATA[2,60]]>
</row>
</data>
</table>
<table name="qryStavkeSmjene">
<fields>
<field name="br_rac" type="1" size="12"/>
<field name="kasa_id" type="1" size="3"/>
<field name="art_id" type="3" size="0"/>
<field name="kol" type="6" size="0"/>
<field name="mpc" type="8" size="4"/>
<field name="ompc" type="8" size="4"/>
</fields>
<data>
<row>
<![CDATA[09-0002-0001]]>
<![CDATA[001]]>
<![CDATA[152414]]>
<![CDATA[1,000]]>
<![CDATA[2,60]]>
<![CDATA[2,60]]>
</row>
<row>
<![CDATA[09-0002-0001]]>
<![CDATA[001]]>
<![CDATA[152414]]>
<![CDATA[1,000]]>
<![CDATA[2,60]]>
<![CDATA[2,60]]>
</row>
</data>
</table>
</transaction> 
```

我再次不好意思以这种方式请求帮助，但我会尽我所能支持 StackOverflow。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-21T15:32:05.600

多个 CDATA 元素在不同实现中不受支持。例如，您将无法通过 XDocument 或通过 SelectNodes 访问它们。如果您可以更改输入格式，这将使事情变得更容易。

此代码尚未经过测试，也没有错误处理或错误数据检查，但它应该可以帮助您入门。使用 XPathDocument / XPathNavigator 调查性能并阅读我的内联注释。

```
class XmlCsvImport
{
    public void ImportData(string xmlData, ConnectionStringSettings connectionSettings)
    {
        DbProviderFactory providerFactory = DbProviderFactories.GetFactory(connectionSettings.ProviderName);

        IDbConnection connection = providerFactory.CreateConnection();
        connection.ConnectionString = connectionSettings.ConnectionString;

        // TODO: Begin transaction

        XmlDocument doc = new XmlDocument();
        doc.LoadXml(xmlData);

        foreach (XmlNode tableNode in doc.SelectNodes("/transaction/table"))
        {
            IDbCommand command = CreatCommand(connection, tableNode);

            foreach (XmlNode rowNode in tableNode.SelectNodes("data/row"))
            {
                string[] values = GetRowValues(rowNode);

                if (values.Length != command.Parameters.Count)
                {
                    // TODO: Log bad row
                    continue;
                }

                this.FillCommand(command, values);
                command.ExecuteNonQuery();
            }
        }

        // TODO: Commit transaction
    }

    private IDbCommand CreatCommand(IDbConnection connection, XmlNode tableNode)
    {
        string tableName = tableNode.Attributes["name"].Value;

        IDbCommand command = connection.CreateCommand();
        command.Connection = connection;
        command.CommandType = CommandType.Text;

        XmlNodeList fieldNodes = tableNode.SelectNodes("fields/field");

        List<string> fieldNameList = new List<string>(fieldNodes.Count);

        foreach (XmlNode fieldNode in tableNode.SelectNodes("fields/field"))
        {
            string fieldName = fieldNode.Attributes["name"].Value;
            int fieldType = Int32.Parse(fieldNode.Attributes["type"].Value);
            int fieldSize = Int32.Parse(fieldNode.Attributes["size"].Value);

            IDbDataParameter param = command.CreateParameter();
            param.ParameterName = String.Concat("@", fieldNode.Attributes["name"]);
            param.Size = fieldSize;
            param.DbType = (DbType)fieldType; // NOTE: this may not be so easy
            command.Parameters.Add(param);

            fieldNameList.Add(fieldName);
        }

        string[] fieldNames = fieldNameList.ToArray();

        StringBuilder commandBuilder = new StringBuilder();
        commandBuilder.AppendFormat("INSERT INTO [{0}] (", tableName);

        string columnNames = String.Join("], [", fieldNames);
        string paramNames = String.Join(", @", fieldNames);

        command.CommandText = String.Concat(
            "INSERT INTO [", tableName, "] ([",
            columnNames,
            "]) VALUES (@",
            paramNames,
            ")"
            );

        return command;
    }

    private string[] GetRowValues(XmlNode row)
    {
        List<string> values = new List<string>();

        foreach (XmlNode child in row.ChildNodes)
        {
            if (child.NodeType == XmlNodeType.Text ||
                child.NodeType == XmlNodeType.CDATA)
            {
                values.Add(child.Value);
            }
        }

        return values.ToArray();
    }

    private void FillCommand(IDbCommand command, string[] values)
    {
        for (int i = 0; i < values.Length; i++)
        {
            IDbDataParameter param = (IDbDataParameter)command.Parameters[i];
            param.Value = values[i]; // TODO: Convert to correct data type
        }
    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T14:54:31.807

您可以使用 XPathNavigator 对象来解析 XML，然后使用 SqlCommand 对象将数据插入到表中。Internet 上有很多这两个对象的代码示例。

# c# - C# Accept object with Interface1 and Interface2

> ID：772951
> 
> 赞同：0
> 
> 时间：2009-04-21T14:50:17.493
> 
> 标签：c#, interface

### Duplicate:

> [Is it possible to make a parameter implement two interfaces?](https://stackoverflow.com/questions/772053/is-it-possible-to-make-a-parameter-implement-two-interfaces)

* * *

Looking for a way to do this :

```
public interface INumber1 {}
public interface INumber2 {}
public class TestObject : INumber1, INumber2 {}

public static class TestClass
{
    public static void TestMethod(INumber1&INumber2 testobject)
    {
        ...
    }
} 
```

Calling the TestMethod :

```
TestClass.TestMethod(new TestObject()); 
```

The thing is that I need a parameter to contain methods from both INumber1 and INumber2. Tips?

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-21T14:55:17.030

Try this one:

```
public static void TestMethod<T>(T testObject) Where T:INumber,INumber2
{

} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-21T14:55:13.240

Create a common interface.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T14:55:59.947

You could use a generic method:

```
public static void TestMethod<T>(T testObject)
    where T : INumber1, INumber2
{
} 
```

Alternatively you could create an interface which extends both `INumber1` and `INumber2`:

```
public interface INumber1And2 {}

public class TestObject : INumber1And2 
```

Personally I prefer the generic solution if you can get away with it, but sometimes generics can complicate things significantly. On the other hand, you manage to keep the two interfaces nice and isolated.

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-21T14:55:09.650

Is it possible to have Inumber2 inherit from Inumber1? If not, would making a generic method work?

```
public static void TestMethod<T>(T testObject); 
```

# c# - .Equals 和 == 有什么区别

> ID：772953
> 
> 赞同：40
> 
> 时间：2009-04-21T14:50:49.023
> 
> 标签：c#, .net, string

值类型、引用类型和字符串`a.Equals(b)`之间有什么区别？`a == b`似乎 a == b 对字符串工作得很好，但我试图确保使用良好的编码实践。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-04-21T14:54:58.513

从[**什么时候应该使用 Equals 以及什么时候应该使用 ==**](https://blogs.msdn.microsoft.com/csharpfaq/2004/03/29/when-should-i-use-and-when-should-i-use-equals/)：

> Equals 方法只是在 System.Object 中定义的一个虚拟方法，并且被选择这样做的任何类覆盖。== 运算符是一个可以被类重载的运算符，但通常具有标识行为。
> 
> 对于 == 没有被重载的引用类型，它会比较两个引用是否引用同一个对象——这正是 Equals 在 System.Object 中的实现。
> 
> 默认情况下，值类型不为 == 提供重载。但是，框架提供的大多数值类型都提供了自己的重载。值类型的 Equals 的默认实现由 ValueType 提供，并使用反射进行比较，这使得它比通常的特定于类型的实现慢得多。此实现还对要比较的两个值内的引用对调用 Equals。

```
using System;

public class Test
{
    static void Main()
    {
        // Create two equal but distinct strings
        string a = new string(new char[] {'h', 'e', 'l', 'l', 'o'});
        string b = new string(new char[] {'h', 'e', 'l', 'l', 'o'});

        Console.WriteLine (a==b);
        Console.WriteLine (a.Equals(b));

        // Now let's see what happens with the same tests but
        // with variables of type object
        object c = a;
        object d = b;

        Console.WriteLine (c==d);
        Console.WriteLine (c.Equals(d));
    }
} 
```

这个简短的示例程序的结果是

```
True
True
False
True 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-21T15:00:43.397

[这是一篇很棒的博客文章，介绍了*为什么*实现不同](http://blogs.msdn.com/ericlippert/archive/2009/04/09/double-your-dispatch-double-your-fun.aspx)。

本质上 == 将在编译时使用变量的类型进行绑定，而 .Equals 将在运行时动态绑定。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2012-06-18T13:36:57.713

在最简写的答案中：

**== 操作员是检查身份。**（即：a==b 这两个是同一个对象吗？）

**.Equals() 是检查值。**（即： a.Equals(b) 都持有相同的值？）

**除了一个例外：** 对于**字符串**和**预定义的值类型**（例如**int**、**float**等），
运算符 == 将回答值而不是身份。（与使用 .Equals() 相同）

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-04-21T14:55:20.680

它们之间的一个显着区别`==`是静态二元运算符适用于一个类型的两个实例，而`Equals`它是一个实例方法。这很重要的原因是您可以这样做：

```
Foo foo = new Foo()
Foo foo2 = null;
foo2 == foo; 
```

但是你不能不抛出一个`NullReferenceException`：

```
Foo foo = new Foo()
Foo foo2 = null;
foo2.Equals(foo); 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-04-21T14:54:09.170

简单来说，区别在于调用了哪个方法。== 方法将尝试绑定到 operator== 如果为有问题的类型定义。如果没有找到 == 对于值类型，它将进行值比较，对于引用类型，它将进行引用比较。.Equals 调用将对 .Equals 方法进行虚拟调度。

至于具体的方法是做什么的，一切都在代码中。用户可以定义/覆盖这些方法并做他们想做的任何事情。理想情况下，这种方法应该是等价的（对不起双关语）并且具有相同的输出，但并非总是如此。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-04-21T15:05:54.837

帮助记住差异的一种简单方法`a.Equals(b)`是更类似于
`a == (object)b`.

该`.Equals()`方法不是通用的，并且接受类型为“object”的参数，因此在与 == 运算符进行比较时，您必须将其视为右手操作数首先被强制转换为对象。

一个含义是，无论类型如何，它`a.Equals(b)`几乎总是会为`a`and返回一些值`b`（重载的正常方法是只返回`false`if`b`是未知类型）。 `a == b`如果这些类型没有可用的比较，则只会抛出异常。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-21T14:52:46.740

" `==`" 是一个运算符，可以重载以根据要比较的类型执行不同的操作。

“ ”执行的默认操作`==`是`a.Equals(b);`

以下是如何为字符串类型重载此运算符：

```
public static bool operator == (string str1, string str2) 
{
    return (str1.Length == str2.Length;)
} 
```

请注意，这不同于`str1.Equals(str2);`

派生类也可以覆盖和重新定义`Equals()`.

就“最佳实践”而言，这取决于您的意图。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-21T14:56:11.317

对于字符串，您需要注意特定于文化的比较。经典的例子是德语双 S，看起来有点像 a b。这应该与“ss”匹配，但不是简单的 == 比较。

对于文化敏感的字符串比较，请使用： String.Compare(expected, value, StringComparison....) == 0 ? 使用您需要的 StringComparison 重载。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-21T14:56:11.817

默认情况下，除了调用实例的可能性（这会给你一个）之外，两者`==`和都是等价的。但是，您可以独立地覆盖它们中的任何一个的功能（尽管我不确定这是否是一个好主意，除非您尝试解决另一个系统的缺点），这意味着您可以使它们不同.`.Equals()``.Equals()``null``NullReferenceException`

您会在过道的两侧找到要使用的人。我更喜欢运算符而不是函数。

但是，如果您谈论的是字符串，那么使用`string.Compare()`这些选项中的任何一个都可能是一个更好的主意。

# objective-c - 将 CGPoint 转换为 NSValue

> ID：772958
> 
> 赞同：19
> 
> 时间：2009-04-21T14:52:28.393
> 
> 标签：objective-c, iphone, cgpoint, nsvalue

在`CABasicAnimation.fromValue`我想将 a 转换`CGPoint`为“类”，所以我使用`NSValue` `valueWithPoint`但在设备模式或模拟器中一个不工作......需要使用`NSMakePoint`或者`CGPointMake`如果在设备或模拟器中。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-04-21T15:24:28.207

还有一个定义函数的`UIKit`补充`NSValue`

```
+ (NSValue *)valueWithCGPoint:(CGPoint)point 
```

请参阅[iPhone 文档](https://developer.apple.com/library/prerelease/ios/documentation/Cocoa/Reference/Foundation/Classes/NSValue_Class/#//apple_ref/occ/clm/NSValue/valueWithCGPoint:)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2012-06-19T17:52:29.193

@ashcatch 的回答非常有帮助，但考虑到那些来自添加复制值的方法，当本机`NSValue`方法存储指针时！这是我的代码检查它：

```
CGPoint point = CGPointMake(2, 4);
NSValue *val = [NSValue valueWithCGPoint:point];
point.x = 10;
CGPoint newPoint = [val CGPointValue]; 
```

这里`newPoint.x = 2; point.x = 10`

* * *

```
CGPoint point = CGPointMake(2, 4);
NSValue *val = [NSValue valueWithPointer:&point];
point.x = 10;
CGPoint *newPoint = [val pointerValue]; 
```

这里`newPoint.x = 10; point.x = 10`

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2015-04-25T05:47:33.263

在 Swift 中，你可以像这样改变一个值：

```
 var pointValueare = CGPointMake(30,30)
    NSValue(CGPoint: pointValueare) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-05-04T21:56:59.803

&(cgpoint) -> 获取对 cgpoint (NSPoint *)&(cgpoint) 的引用（地址） -> 将该引用转换为 NSPoint 指针 *(NSPoint *)* (cgpoint) -> 取消引用该 NSPoint 指针以返回一个 NSPoint返回类型快乐

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-04-17T13:26:13.573

在 Swift 中，静态方法更改为初始化方法：

```
var pointValue = CGPointMake(10,10)
NSValue(CGPoint: pointValue) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-02-21T17:08:11.257

如果您使用的是最新版本的 Xcode（2015 年后），您可以为此采用现代的 Objective-C 语法。您只需将 CGPoint 包装在`@()`：

```
CGPoint primitivePoint = CGPointMake(4, 6);
NSValue *wrappedPoint = @(primitivePoint); 
```

在引擎盖下，编译器会`+[NSValue valueWithCGPoint:]`为您调用。

[https://developer.apple.com/library/archive/releasenotes/ObjectiveC/ModernizationObjC/AdoptingModernObjective-C/AdoptingModernObjective-C.html](https://developer.apple.com/library/archive/releasenotes/ObjectiveC/ModernizationObjC/AdoptingModernObjective-C/AdoptingModernObjective-C.html)

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-04-21T15:12:46.037

不要认为它是“转换”你的观点——NSValue 是一个包装类，它包含像 NSPoint 这样的原始结构。无论如何，这是您需要的功能。它是 Cocoa 的一部分，但不是 Cocoa Touch。您可以将整个函数添加到您的项目中，或者在需要的地方进行相同的转换。

```
NSPoint NSPointFromCGPoint(CGPoint cgpoint) {
   return (*(NSPoint *)&(cgpoint));
} 
```

# web-applications - 电子民主：基于网络的投票软件

> ID：772960
> 
> 赞同：0
> 
> 时间：2009-04-21T14:52:38.533
> 
> 标签：web-applications, voting

对于拥有数千名成员的组织，您能推荐基于网络的投票软件吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-21T20:20:24.033

您有[Google 版主](http://moderator.appspot.com/)（这将要求每个人都有一个 Google 帐户）或[UserVoice](http://uservoice.com/)（SO 用来对功能请求进行排名）。

# delphi - 如何针对单个基本文件“区分”多个文件？

> ID：772962
> 
> 赞同：18
> 
> 时间：2009-04-21T14:53:00.967
> 
> 标签：delphi, diff

我有一个配置文件，我认为它是我的“基本”配置。我想将最多 10 个其他配置文件与该单个基本文件进行比较。我正在寻找一份报告，其中将每个文件与基本文件进行比较。

我一直在研究 diff 和 sdiff，但它们并没有完全提供我想要的东西。

我已经考虑过对每个文件单独区分基础，但是我的问题随后变成了将它们合并到报告中。理想情况下，如果所有 10 个配置文件中都缺少同一行（与基本配置相比），我希望以易于可视化的方式报告。

请注意，一些配置文件中缺少一些行（单独与基本文件相比）。我希望能够将它们放在同一行（如上所述）。

请注意，上面的屏幕截图只是一个模型，而不是实际的应用程序。

我已经考虑过为此使用一些 Delphi 控件并编写自己的控件（我有 Delphi 2007），但如果有一个程序已经这样做了，我更喜欢它。

我看过的 Delphi 控件是[TDiff](http://angusj.com/delphi/)和[rmcontrols 中包含的 TrmDiff* 组件](http://www.mills-enterprise.ca/software/rmcontrols.html)。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2010-04-20T14:39:53.663

对于仍然想知道如何做到这一点的人，[diffuse](http://diffuse.sourceforge.net/)是最接近的答案，它通过显示所有文件并在邻居之间进行三路合并来进行 N 路合并。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-23T19:08:50.263

现有的 diff/merge 工具都不能满足您的需求。根据您的示例屏幕截图，您正在寻找一种算法，该算法对多个文件执行对齐并根据行相似性给出适当的权重。

第一个问题是基于线条相似性对对齐进行加权。最流行的对齐算法，包括 GNU diff、TDiff 和 TrmDiff 使用的算法，基于行哈希进行对齐，并检查行是否完全匹配。您可以预处理这些行以删除空格或将所有内容更改为小写，仅此而已。添加、删除或更改一个字母和对齐的东西整行是不同的。不同线在该点的任何对齐纯属偶然。

Beyond Compare 确实考虑了线相似性，但它实际上只适用于 2 路比较。比较一下！也有某种相似性算法，但它也仅限于 2 路比较。它可以显着减慢比较速度，而且我不知道任何其他组件或程序，商业或开源，甚至尝试过。

另一个问题是您还需要多文件比较。这意味着要么多次运行 2-way diff 算法并将结果拼接在一起，要么找到一次执行多个对齐的算法。

拼接会很困难：您的示例显示原始文件可能缺少行，因此您需要将每个文件与每个其他文件进行比较以获得一堆对齐方式，然后您需要找出最佳方法以匹配这些对齐方式。一个简单的拼接算法很容易做到，但它会被琐碎的匹配（例如空白行）搞砸。

有研究论文涵盖了一次比对多个序列，但它们通常专注于 DNA 比较，你肯定必须自己编写代码。维基百科涵盖了很多基础知识，那么您可能需要切换到 Google Scholar。

*   [序列比对](http://en.wikipedia.org/wiki/Sequence_alignment)
*   [多序列比对](http://en.wikipedia.org/wiki/Multiple_sequence_alignment)
*   [空档罚分](http://en.wikipedia.org/wiki/Gap_penalty)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T05:44:05.333

[Diff3](http://en.wikipedia.org/wiki/Diff3)应该有所帮助。如果您使用的是 Windows，则可以从 Cygwin 或[diffutils](http://gnuwin32.sourceforge.net/packages/diffutils.htm)使用它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-23T07:10:22.967

我制作了自己的差异工具[DirDiff](http://yoy.be/dirdiff)，因为我不希望在屏幕上匹配两次的部分，以及彼此上方的不同部分以便于比较。您可以在具有相同数量的基本文件副本的目录上以目录模式使用它。它不会呈现 diff 的导出，但我会将[其列为功能请求](http://yoy.be/item.asp?i1726)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-21T19:25:22.577

试试 Scooter Software 的[Beyond Compare](http://www.scootersoftware.com/)。它支持 3 路合并，并且是用 Delphi / Kylix 编写的，用于多平台支持。我已经非常广泛地使用它（甚至通过 VPN）并且它表现良好。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-21T19:31:15.947

对于 f 在文件 1 文件 2 文件 3 文件 4 文件 5 中；做回声“$f\n\n”>> outF; 差异 $f baseFile >> outF; 回声“\n\n”>> outF; 完毕

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-03-19T15:03:32.837

我知道这是一个旧线程，但 vimdiff 确实（几乎）完全符合您的要求，并且能够直接从差异角度编辑文件的额外优势。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-21T18:51:21.330

您可能想查看一些 Merge 组件，因为您所描述的正是 Merge 工具在公共基础、版本控制文件和本地文件之间所做的事情。除了你想要超过 2 个文件（+ 基数）...
只是我的 0.02 美元

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-22T07:01:52.760

[SourceGear Diffmerge](http://www.sourcegear.com/diffmerge/)对于基于 Windows 的文件比较来说非常好（而且免费）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-01-04T21:06:57.530

But none of the solutions does more than 3 files still. What I did was messier, but for the same purpose (comparing contents of multiple config files, no limit except memory and BASH variables)

While loop to read a file into an array:

```
loadsauce () {
index=0
while read SRCCNT[$index]
 do let index=index+1
 done < $SRC
} 
```

Again for the target file

```
loadtarget () {
index=0
while read TRGCNT[$index]
 do let index=index+1
 done < $TRG
} 
```

string comparison

```
brutediff () {
# Brute force string compare, probably duplicates diff
# This is very ugly but it will compare every line in SRC against every line in TRG
# Grep might to better, version included for completeness
for selement in $(seq 0 $((${#SRCCNT[@]} - 1)))
 do for telement in $(seq 0 $((${#TRGCNT[@]} - 1)))
  do [[ "$selement" == "$telement" ]] && echo "${selement} is in ${SRC} and ${TRG}" >> $OUTMATCH
  done
 done
} 
```

and finally a loop to do it against a list of files

```
for sauces in $(cat $SRCLIST)
 do echo "Checking ${sauces}..."
  loadsauce
  loadtarget
  brutediff
  echo -n "Done, "
 done 
```

It's still untested/buggy and incomplete (like sorting out duplicates or compiling a list for each line with common files,) but it's definitely a move in the direction OP was asking for. I do think Perl would be better for this though.

# linux - 确定进程花费在阻塞/执行上的时间量

> ID：772972
> 
> 赞同：6
> 
> 时间：2009-04-21T14:54:42.803
> 
> 标签：linux, linux-kernel, scheduling, timing

好的，所以对于我的编程任务（是的，我们都可以求助于我们认为合适的任何资源）我必须找出进程花费了多少时间阻塞/睡眠/运行。

我的第一次尝试是创建一个 bash 脚本......看起来像这样：

```
for i in `ls /proc/ | egrep [0-9]+`
do
        cat /proc/$i/status | grep State
done 
```

但随后所有的问题都在报告睡眠状态。再加上这种方法会要求我像疯了一样投票......所以运行测试可能会改变结果......（呃）

现在，使用系统调用或跟踪进程状态的方法来编译新版本的 linux 并非不可能。我唯一担心的是试图找出如何跟踪不断变化的进程状态并确保我不会错过任何东西......

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-02T00:47:43.220

您可以使用“时间”

```
 $ time ls /usr/bin

 real    0m4.756s
 user    0m0.051s
 sys     0m0.078s 
```

real - sys = 等待 I/O 的总时间（休眠/阻塞）

sys - user = 花费在系统调用上的时间

用户=仅在程序中执行指令所花费的时间（可能包括动态链接开销，对此不确定）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2018-11-27T20:15:08.983

如果您想获取当前存在的事物的当前统计信息...

```
ps -Ae pid,comm,state,time,etime 
```

-A 用于所有进程，-e 用于自定义输出（只是 pid、命令、状态、时间（CPU 时间）、经过的时间）

假设问题是处理所有进程（包括已完成的进程），这将需要某种审计守护进程来监视进程并在完成时获取该信息。

# .net - 使用 REGEX 查找 HTML ListItem (.NET) 的内容

> ID：772980
> 
> 赞同：1
> 
> 时间：2009-04-21T14:55:22.397
> 
> 标签：.net, html, regex

使用以下文本作为示例，我需要能够在 LI 标记之间提取文本。请注意，第一个 LI 是故意格式错误的，因为可能是这种情况。换句话说，我想要从 LI 标记到关闭 LI 标记或下一个 LI 开始标记的所有内容。

```
 <UL>
<LI class="test">This is the first ListItem Text. 
<LI>This is the second ListItem Test. </LI></UL> 
```

到目前为止，我想出了：

```
<[Ll][Ii].*>(.*?)((?:<[Ll][Ii]>)|(?:</[Ll][Ii]>)) 
```

但这似乎与第一个 LI 标记匹配，直到结束标记与作为第二个 LI 标记文本的组匹配。我设法让它返回第一组，但从来没有两个。我也在使用“点匹配换行符”选项，这是我需要它工作的 .NET。谢谢！

*更新*

在发布这个问题之前，我做了一些研究，实际上确实看到并理解使用正则表达式来解析 html 是一个坏主意。话虽如此，我只需要能够从这里和那里的几个 LI 标签中获取文本，以确定要在 powerpoint 幻灯片上标出哪些文本。我认为可能有一种更简单的方法来做到这一点，而不是处理一个单独的库，特别是当使用第三方库很难处理我工作的地方时。不幸的是，当在允许您对文本进行项目符号化的页面上使用 html 富文本输入框时，在某些情况下，HTML 似乎最终会出现格式错误。感谢所有反对 REGEX 用于解析 HTML 的建议。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-21T15:00:16.817

如果这是一个反复出现的场景，我宁愿使用 HTML 解析器。使用正则表达式解析 HTML 将花费大量时间，并且由于输入格式错误（您提到的），可能仍然会出现错误。

这是我通过基本的 Google 搜索找到的：http:
[//www.netomatix.com/products/Documentmanagement/HtmlParserNet.aspx](http://www.netomatix.com/products/Documentmanagement/HtmlParserNet.aspx)

**更新：**

以下是 StackOverflow 上的一些相关帖子：
[如何解析格式不佳的 HTML 文件？](https://stackoverflow.com/questions/710677/how-do-you-parse-a-poorly-formatted-html-file)
[在 C# 中解析 html 的最佳方法是什么？](https://stackoverflow.com/questions/56107/what-is-the-best-way-to-parse-html-in-c)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-21T15:01:46.953

正如斯拉沃所说，这很困难。您给出的示例特别棘手，因为第二个“ `<LI>`”需要同时被视为第一个匹配项的结束标记和第二个匹配项的开始标记。这很难。

在一个完全不相关的注释上，您可以将正则表达式标志设置为不区分大小写，这样您就不必这样做`[Ll][Ii]`，等等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-21T15:03:50.240

试试这个。

```
<li.*?>(.*?)(?=</li>|<li.*?>|</ul>|\Z) 
```

请注意，您需要使用 RegexOptions.IgnoreCase 选项才能使其工作，但它会使您的表达式更具可读性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-21T15:04:51.673

我感觉就像一张破黑胶唱片，但是：不要使用正则表达式来解析非常规语言。

有大量可用的 .NET HTML 解析器，其中一些还可以纠正格式错误的 HTML。我用谷歌搜索了“.net html parser malformed”，似乎有一些有希望的结果。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-21T15:05:06.540

正则表达式不擅长解析 HTML（请参阅[Can you provide some examples of why it is hard to parse XML and HTML with a regex?](https://stackoverflow.com/questions/701166) for why）。您需要的是一个 HTML 解析器，例如[Html Agility Pack](http://www.codeplex.com/htmlagilitypack)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-21T15:03:15.513

如果您的输入合理有效（并且列表项仅包含文本），您可能会逃脱：

```
<li[^>]*>([^<]*) 
```

应用为全局/不区分大小写并查找匹配组 1 的内容。

结果将需要一些规范化（修剪，替换换行符）。

# java - 将Java字符串插入另一个字符串而不连接？

> ID：772988
> 
> 赞同：23
> 
> 时间：2009-04-21T14:56:14.110
> 
> 标签：java, string

在 Java 中有没有更优雅的方法来做到这一点？

```
String value1 = "Testing";  
String test = "text goes here " + value1 + " more text"; 
```

是否可以将变量直接放在字符串中并评估其值？

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2009-04-21T14:59:37.800

```
 String test = String.format("test goes here %s more text", "Testing"); 
```

是你可以用 Java 编写的最接近的东西

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-04-21T15:05:06.303

更优雅的方式可能是：

```
 String value = "Testing"; 
 String template = "text goes here %s more text";
 String result = String.format(template, value); 
```

或者使用 MessageFormat：

```
 String template = "text goes here {0} more text";
 String result = MessageFormat.format(template, value); 
```

* * *

请注意，如果您这样做是为了记录，那么当日志行低于阈值时，您可以避免执行此操作的成本。例如[SLFJ](http://www.slf4j.org/faq.html#logging_performance)：

> 以下两行将产生完全相同的输出。但是，在禁用日志记录语句的情况下，第二种形式的性能至少比第一种形式高出 30 倍。

```
logger.debug("The new entry is "+entry+".");
logger.debug("The new entry is {}.", entry); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-07-01T07:44:33.007

Rythm 是一个 java 模板引擎，现在发布了一个名为**[String 插值模式](http://www.playframework.org/modules/rythm-1.0.0-20120630/string_interpolation)**的新功能，它允许您执行以下操作：

```
String result = Rythm.render("Hello @who!", "world"); 
```

上面的案例表明您可以按位置将参数传递给模板。Rythm 还允许您按名称传递参数：

```
Map<String, Object> args = new HashMap<String, Object>();
args.put("title", "Mr.");
args.put("name", "John");
String result = Rythm.render("Hello @title @name", args); 
```

链接：

*   检查[全功能演示](http://play-rythm-demo.appspot.com/)
*   阅读[节奏的简要介绍](http://software-lgl.blogspot.com.au/2012/03/rythm-easy-to-use-high-performance-java.html)
*   下载[最新的包](https://github.com/greenlaw110/rythm/downloads)或
*   [叉它](https://github.com/greenlaw110/rythm)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-21T14:59:00.140

它可以由一些模板库来完成。但请注意，字符串在 Java 中是不可变的。因此，在每种情况下，都会在某个低级别进行连接。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-21T14:59:55.770

为此，您始终必须使用某种形式的连接（假设 value1 不是您在此处显示的常量）。

您编写它的方式将隐式构造 a[`StringBuilder`](http://java.sun.com/javase/6/docs/api/java/lang/StringBuilder.html)并使用它来连接字符串。另一种方法是¹，类似于from C。但即使使用，您也无法避免连接。[`String.format(String, Object...)`](http://java.sun.com/javase/6/docs/api/java/lang/String.html#format)^(`sprintf``format()`)

¹是的，我知道锚链接坏了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-21T14:57:27.133

你想要的是所谓的[字符串插值](http://en.wikipedia.org/wiki/String_literal#Variable_interpolation)。这在 Java 中是不可能的，尽管[JRuby](http://jruby.codehaus.org/)、[Groovy](http://groovy.codehaus.org/)和可能的其他 JVM 语言可以做到这一点。

* * *

编辑：至于优雅，您可以使用 StringBuffer 或检查其他海报的解决方案。但在低级别，这将始终是串联，正如其他发帖人所说。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-21T15:01:47.373

你可以使用[这个](http://developer.java.sun.com/developer/technicalArticles/Programming/sprintf/)免费的图书馆。它为您提供了类似*sprintf*的功能。或者使用[String.format](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/String.html)静态方法，前提是您使用 Java 5 或更新版本。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-21T15:05:30.017

为什么你认为字符串连接不优雅？

如果您所做的只是简单的连接，我认为代码可读性更重要，我会像您拥有它一样保留它。它比使用 StringBuilder 更具可读性。

性能不会是大多数人认为的问题。

[从CodingHorror](http://www.codinghorror.com/blog/archives/001218.html)阅读此内容

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-21T15:41:58.230

我会使用 StringBuffer .. 这是处理字符串时的常见做法。第一次看到可能会觉得有点，但是很快就习惯了。。

```
String test = new StringBuffer("text goes here ").append(value1).append(" more text").toString(); 
```

字符串是不可变的，因此每次连接后都会创建一个新实例。在循环中使用时，这可能会导致性能问题。

**StringBuffer**是**String**的可变版本- 这意味着您可以创建一个，根据需要对其进行修改，并且您仍然只有一个实例。如果需要，您可以通过调用它的**toString()**方法来获得 StringBuffer 的字符串表示形式。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-08-04T12:48:40.230

问题不在于这是否是一种优雅的方式。使用模板系统背后的想法可能是您将模板放在普通文本文件中，如果您更改消息（或考虑 i18ln），则不必更改 java 代码。*******`**