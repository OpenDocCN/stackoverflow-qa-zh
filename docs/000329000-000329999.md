# StackOverflow 问答 000329000-000329999

# c++ - 如何减少用本机 Visual C++ 编写的大型项目的链接时间？

> ID：329007
> 
> 赞同：2
> 
> 时间：2008-11-30T16:12:25.007
> 
> 标签：c++, visual-studio, visual-c++

我正在使用大量用 Visual C++ 编写的源代码。目标是dll库。联动时间消耗几分钟。如何减少这个时间？

库依赖于相同解决方案中的其他 dll 和库。

可以做的第一件事是将源代码拆分为多个项目，但这是一种耗时且非常昂贵的方法。

可能存在一些其他方法可以在我的情况下使用。

编辑：我使用增量链接，虽然这大大减少了时间，但这对我来说还不够。目标文件的大小没有问题，因为最烦人的是开发这样的代码库。每一个小修改都需要等我联动。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-01T06:31:00.543

重构！！！将大 DLL 拆分为较小的模块，使用接口层执行此操作，当您将“巨大”DLL 拆分为较小的模块时创建架构，而不是获取前 5 个文件等。仔细映射 DLL 层次结构 0 级 DLL 是独立的，级别1 个 DLL 可能依赖于 1 个或多个级别 0，等等。

这样做的努力会得到回报，假设只有 10 个开发人员每天只等待 6 分钟链接，10*6 == 1 小时 * 每周 5 天，这意味着您每周损失超过半天的开发时间，这应该足以证明中断功能开发以使您的鸭子井井有条。

您还提到了库，如果您也有制作这些 DLL 的源代码，那么当您启用编辑并继续时，这将很快得到回报。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T16:17:06.663

如果你不使用增量链接，你应该看看这个。它基本上是在最终对象大小与链接性能之间进行交易。

全局优化选项还将编译时间（即代码生成）从编译阶段转移到链接阶段——您可能会发现最好将它们丢失，这样单个文件的编译速度会变慢，但链接会更快。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-01T16:10:44.400

您可以尝试减少包含依赖项。一些标头会触发大量代码添加到 .obj 文件中，即使其中没​​有真正使用。此类标头的一些示例是和

# c++ - 访问我有 xml 描述的存储结构

> ID：329020
> 
> 赞同：1
> 
> 时间：2008-11-30T16:18:21.937
> 
> 标签：c++, xml, serialization, introspection

我已经建立了一种支持自省的 C++ 库，它允许使用最少的宏和相当多的模板技巧来声明结构和类，这些结构和类得到了一些元信息的丰富。

此元信息捕获有关您声明的结构/类的每个字段的所有重要细节，并且在故事的结尾，您可以为每个以这种方式丰富的结构/类生成一个转储的 xml 文件，用于每个字段，其名称、类型、长度、偏移量等等等。

对于我的问题，我不需要支持作为指针的字段，而只需要支持原始类型、数组和 STL 容器（向量、列表等）

填充这些元丰富的结构/类（“生产者”）的代码，在某个点将它们序列化（现在它是所有原始类型和 STL 容器使用的所有“缓冲区”的简单二进制转储，如果任何）。

现在我需要开始开发一个能够**在运行时**从“生产者”构建的 xml 描述开始的“阅读器”对应物，以访问存储数据的各个字段。

我认为这是动态数据字典解释的问题，但我所知道的一切都与回读 xml 数据有关，而我有二进制数据和它的 xml 描述......

最好的方法是什么？那里有什么类似于这个问题并且我可以从中获得灵感的东西吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-02T16:20:37.920

/* smarc 保持简单 */

```
 class xmlstream
  {
  ...
  };

  class ibase
  {
  void read( xmlstream& rStream ) = 0;
  void write( xmlstream& rStream ) = 0;
  };

  class classfactory
  {
  void produce( xmlstream& rStream );
  void consume( xmlstream& rStream );  
  ibase* create( xmlstream& rStream );
  void destroy( ibase* pBase );
  };

  class class1 : public ibase
  {
  static class1* create( );
  static void    destroy( class1* pObject );
  void read( xmlstream& rStream );
  void write( xmlstream& rStream );
  };

  class class2 : public ibase
  {
  static class1* create( );
  static void    destroy( class1* pObject );
  void read( xmlstream& rStream );
  void write( xmlstream& rStream );
  }; 
```

如果不清楚，请告诉我。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T00:46:26.213

你看过[Boost Serialization](http://www.boost.org/doc/libs/1_38_0/libs/serialization/doc/index.html)吗？它几乎可以满足您的要求。

# c# - 你写过的最好的（最有用的）界面是什么？

> ID：329029
> 
> 赞同：4
> 
> 时间：2008-11-30T16:23:17.480
> 
> 标签：c#, interface

标题基本上说明了它。你写了哪些让你自豪并且经常使用的接口。我猜那些写过的人在创作这些作品后感觉`IEnumerable<T>`特别好。`IQueryable<T>`

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-30T20:01:58.567

严格意义上的接口？还是只是一个 API？我对[泛型运算符](http://www.pobox.com/~skeet/csharp/miscutil/usage/genericoperators.html)的工作方式感到有点满意（可[在此处](http://www.yoda.arachsys.com/csharp/miscutil/)获得） - 我*经常*看到人们询问有关使用泛型运算符的问题，所以我很高兴这对很多人来说是一个方便的答案。[在 C# 4.0 中](http://marcgravell.blogspot.com/2008/11/dynamic-operators.html)可能会稍微容易一些，但我非常怀疑它会不会那么快——DLR-tree/dynamic 的东西有开销。

我也很高兴它对 Jon 已经提到的 Push LINQ 有所帮助；-p

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-30T17:44:05.460

我对[Push LINQ](http://msmvps.com/blogs/jon_skeet/archive/2008/01/04/quot-push-quot-linq-revisited-next-attempt-at-an-explanation.aspx)的核心界面设计感到满意。这是一个非常简单的界面，但你可以用它做各种有趣的事情。这是定义（来自记忆，但至少会非常接近）：

```
public interface IDataProducer<T>
{
    event Action<T> DataProduced;
    event Action EndOfData;
} 
```

基本上，它允许观察者“监听”数据流，而不是像 IEnumerable 那样从数据流中“拉取”。

三个兴趣点：

*   名字很烂 我想重命名它，我得到了一些很好的反馈，但*名称*还没有。
*   事件处理程序不遵循具有发送者/事件参数的标准 .NET 约定。在这种情况下，这样做真的没有多大意义。
*   事件的多播性质使其非常适合计算多个聚合等。所有这些都是免费的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T16:39:25.013

> 我猜写 IEnumerable 的人……在创建 [it] 之后感觉很好。

我不确定。`IEnumerable`随着接口的发展，这是一个相当失败的过程。`IEnumerable<T>`从它的通用对应物实际上提供了完全*不同*的接口这一事实可以明显看出这一点。（嗯，“不同”不是一个好词；基本上，它增加了可处置性，并淡化了完全无用的`Reset`方法；但是，这种方法当然仍然存在。）

此外，具有相似结构的相似语言（想到 Java）具有更好、更可扩展的结构来满足相同的需求（甚至更多）。例如，Java 的迭代器可以扩展为双向或允许修改访问（而`IEnumerable`始终是只读的）。

**编辑：**由于评论中有很多争议，让我澄清一下。我并不是说`IEnumerable`（或`IEnumerator`）是*糟糕的*接口。他们足够了。然而，他们本可以做得更好。如果不出意外，那么至少该`Reset`方法看起来很混乱。

Terjet 说他“一直在使用它”——这正是我的观点！`IEnumerable`是整个 .NET 框架的关键接口。它无处不在。没有它就没有.NET。因此要求一个*完美*的界面是不是太过分了？

“足够”只是失败的另一个词。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-30T21:45:01.247

为了做 MVP 模式的工作，我有一些基本的框架接口：

```
public interface IValidatable {
  bool IsValid { get; set; }
  void ShowValidationFailureMessage(string message);
}

public interface ISubmitable {
  event EventHandler Submit;
  void ShowSubmitFailureMessage(string message);
  void ShowSubmitSuccessMessage(string message);
}

public interface ICancelable {
  event EventHandler Cancel;
} 
```

使用这 3 个接口，我可以编写具有这些通用操作（基本上涵盖所有表单操作）的演示者。例如：

```
public interface ILogin : IValidatable, ISubmitable, ICancelable {
  string Username { get; set; }
  string Password { get; set; }
} 
```

然后，您可以创建一个演示者并将其存根。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-30T20:07:38.120

我正在开发一个验证系统，我计划很快向社区发布。它本质上是[规范](http://en.wikipedia.org/wiki/Specification_pattern)模式的实现。

核心接口的设计本质上是功能性的：

```
public interface ICheckable<T>
{
    CheckResult Apply(T target);
} 
```

`CheckResult`是一个`struct`表示三态值：`Passed`、`Failed`和`Ignored`。所有的转换和运算符重载都可以将其视为一个`Boolean`值。

这允许验证器表达“我没有意见”，而不是返回一个误导性的`true`值（认为`RangeValidator`表明空字段是有效的，所以它与 . 配合得很好`RequiredFieldValidator`）。

组合是自然而然的，并且是使用静态类（如 Linq）完成的。检查中的每个点都是`And`下一个操作的隐含：

```
public static ICheckable<T> Add<T>(this ICheckable<T> check, ICheckable<T> otherCheck)
{
    return new Check<T>(t => check.Apply(t) && otherCheck.Apply(t));
}

public static ICheckable<T> Either<T>(this ICheckable<T> check, ICheckable<T> firstCheck, ICheckable<T> secondCheck)
{
    return check.Add(t => firstCheck.Apply(t) || secondCheck.Apply(t));
}

public static ICheckable<T> Not<T>(this ICheckable<T> check, ICheckable<T> negatedCheck)
{
    return check.Add(t => !negatedCheck.Apply(t));
} 
```

扩展方法工作得很好：

```
public static ICheckable<int> Percentage(this ICheckable<int> check)
{
    return check.Add(n => n >= 0 && n <= 100);
}

public static ICheckable<T> GreaterThanOrEqualTo<T>(this ICheckable<T> check, T value) where T : IComparable<T>
{
    return check.Add(t => t.CompareTo(value) >= 0);
}

public static ICheckable<T> LessThanOrEqualTo<T>(this ICheckable<T> check, T value) where T : IComparable<T>
{
    return check.Add(t => t.CompareTo(value) <= 0);
}

public static ICheckable<T> Range<T>(this ICheckable<T> check, T minimum, T maximum) where T : IComparable<T>
{
    return check.GreaterThanOrEqualTo(minimum).LessThanOrEqualTo(maximum);
}

// RangeExcludeMinimum
// RangeExcludeMaximum
// RangeExclusive 
```

每个操作都包含采用检查构建 lambda 的重载：

```
public static ICheckable<T> Add<T>(this ICheckable<T> check, Func<ICheckable<T>, ICheckable<T>> makeCheck)
{
    return check.Add(makeCheck(new IgnoredCheck<T>()));
} 
```

所以你可以做这样的语法：

```
ICheckable<int> check;

check.Add(i => i.Percentage().GreaterThan(50).Even()); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-30T21:38:10.277

这是一个 ActionScript 3 界面，它是我们在 as3 中的 Flash Player 新行为的核心。

```
public interface IDisposable {
  public function dispose():void;
} 
```

正如您所期望的，该`dispose`方法应该关闭所有资源并删除对它可能的任何内容的任何引用。

C++ 程序员可能会对这种“创新”接口嗤之以鼻（这完全是公平的），但 as3 引入了很多围绕 Flash 内存管理的问题。对于许多编译语言来说，这些问题都是“老生常谈”，但 actionscript 程序员现在才第一次遇到这些挑战。

是的，它仍然是一种垃圾收集语言。但无论好坏，与 ActionScript 2 相比，“手握”要少得多，对此界面的需求就证明​​了这一点。

# .net - 使用 XmlSerializer 时出现 FileNotFound 异常

> ID：329030
> 
> 赞同：2
> 
> 时间：2008-11-30T16:24:00.677
> 
> 标签：.net, xml-serialization

当尝试使用 将类型（`List<T>`T 是用 XmlRootAttribute 标记的类的泛型）序列化为 XML`XmlSerializer`时，`FileNotFoundException`会抛出 a（有时）并且序列化失败。

似乎`XmlSerializer`试图在运行应用程序的用户的 Temp 文件夹中创建一个具有随机文件名的临时文件，但该文件以某种方式被删除。

有人见过这个吗？任何解决方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T16:59:23.927

XmlSerializer 通过生成*代码*来执行序列化/反序列化并将其存储在临时程序集中来工作。（这种方法为重复序列化/反序列化提供了良好的性能，但（传统上）第一次运行的性能令人震惊）

为了帮助减轻令人震惊的性能，从 VS2005 开始（以及更早使用鲜为人知的技术），您可以在构建时显式创建序列化程序集并将其与您的主程序集一起发布。

如果您*不*创建/发送序列化程序集，那么框架在寻找它时往往会抛出异常，尽管通常它会捕获异常，动态构建程序集并继续处理。如果您在调试器下运行，但设置了“break-on-throw”，那么在框架内部深处抛出 FileNotFound 异常可能会有点令人担忧。

您*确定*FileNotFound 异常与您看到的序列化失败直接相关吗？您是否尝试过明确包含序列化程序集？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-03T20:19:36.603

如果您使用 Visual Studio 构建，项目属性中有一个有趣的选项。在构建选项卡上，您可以选择生成序列化程序集（是、否、自动）。如果我没记错的话，我没有成功地用“是”生成这个程序集来摆脱那个异常。但是一旦我觉得将选项设置为“否”会导致构建不尝试搜索这样的程序集，因此不再有令人沮丧的 FileNotFound-Exception。无论如何，正如您已经说过的，例外更多的是外观问题。您可以考虑抑制它（在 Visual Studio 中通过 Debug/Exceptions 配置），至少在处理它的情况下。

编辑：[该选项仅在某些情况下进行评估，最终解决方案请参阅此问题（及其答案）](https://stackoverflow.com/questions/134224/generating-an-xml-serialization-assembly-as-part-of-my-build)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-04T23:39:08.660

这里的最后一种可能性是 XML 序列化运行时中存在一个大问题。这些在几年前更常见，但可能还有一些。可能发生的情况是，给定 C# 或 VB（或其他）代码上完全合法的 XML 序列化标记，为该类型创建 XmlSerializer 会导致为 JIT 编译的序列化程序集创建非法代码。编译会窒息而死，然后加载程序集会抛出。通常使用 rfuieuy267.dll 或类似的文件名。

你可以说出一个秘密的咒语来告诉 XmlSerialization 引擎保留它生成的 .cs 代码，但我不记得它现在是什么了。它没有记录在案；我只有在与 MS 工程师一起调试其中一个问题时才知道它。但我敢打赌，你可以在 googlespace 中找到它。

# .net - .NET 中 CultureInfo 的 CurrentCulture 和 CurrentUICulture 属性有什么区别？

> ID：329033
> 
> 赞同：382
> 
> 时间：2008-11-30T16:26:17.707
> 
> 标签：.net, globalization, cultureinfo

在 .NET`CultureInfo`中，命名空间中有类`System.Globalization`。它有两个相似的属性，都返回`CultureInfo`类型的值：`CurrentCulture`和`CurrentUICulture`.

它们之间有什么区别？

我应该在何时以及为什么使用哪一个？

* * *

## 回答 #1

> 赞同：369
> 
> 时间：2008-11-30T16:35:29.653

`CurrentCulture`是系统默认用户区域设置的 .NET 表示形式。这控制默认数字和日期格式等。

`CurrentUICulture`指默认用户界面语言，这是在 Windows 2000 中引入的一种设置。这主要与您的应用程序的 UI 本地化/翻译部分有关。

无论系统配置为具有何种区域选项，都将是 .NET 应用程序中的“当前”值。

很多时候它们都是一样的。但是在我的系统上它们会有所不同：我更喜欢德语格式的数字和日期，所以`CurrentCulture`应该是德语，但我也更喜欢我的所有应用程序都是英文的，所以`CurrentUICulture`应该是英文的。

关于该主题有一篇不错的文章：[全部整理：为什么我们同时拥有 CurrentCulture 和 CurrentUICulture](http://www.siao2.com/2007/01/11/1449754.aspx)

* * *

## 回答 #2

> 赞同：111
> 
> 时间：2010-09-02T12:23:48.953

这是我用来记住要使用哪一个的简单技巧：

```
(date, currency, double).tostring = CurrentCulture

resource.fr-CA.resx file = currentUICulture 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2015-11-26T14:02:33.340

除了其他用户所做的很好的解释之外，还有一个很好的方式来做出改变，以及 Web 应用程序开发的一个重要方面如下：

*   `CurrentCulture`表示 Web 服务器的设置。例如，如果您的 ASP.NET Web 应用程序托管在德国，则 的值`CutlureInfo.CurrentCulture`很可能是`de-DE`. 因此，类型的默认`.ToString()`格式`IFormattable`将使用默认的德语格式，或者已在服务器操作系统上设置为默认格式的格式。

*   `CurrentUICulture`可以从用户代理中捕获，并且可以代表连接到网站的客户端的用户界面文化。例如，如果您从俄罗斯加载该网站，您的本地设置设置为使用俄语，并且您的用户代理将您的区域设置发送到服务器（Opera 和 IE 会自动执行此操作，Chrome 和 FireFox 不确定）`CurrenUICulture`，代表`ru-RU`. 这将导致任何资源（如通过 ResourceManager 检索的本地化字符串或 ASP.NET aspx/ascx 文件中的本地化表达式）为俄语（如果有翻译）。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2015-11-26T13:18:06.780

**差异：**

1.  [`CurrentCulture`](https://msdn.microsoft.com/en-us/library/system.globalization.cultureinfo.currentculture)用于日期和货币的格式，同时 [`CurrentUICulture`](https://msdn.microsoft.com/en-us/library/system.threading.thread.currentuiculture)与语言/翻译一起使用。它将用于[`ResourceManager`](http://msdn2.microsoft.com/en-us/library/system.resources.resourcemanager.aspx)按文化查找资源。
2.  类的命名空间 [`CurrentCulture`](https://msdn.microsoft.com/en-us/library/system.globalization.cultureinfo.currentculture)在`System.Globalization`while [`CurrentUICulture`](https://msdn.microsoft.com/en-us/library/system.threading.thread.currentuiculture)来自`System.Threading`.
3.  [`CurrentCulture`](https://msdn.microsoft.com/en-us/library/system.globalization.cultureinfo.currentculture)在会话中的不同请求中持续存在，同时[`CurrentUICulture`](https://msdn.microsoft.com/en-us/library/system.threading.thread.currentuiculture)需要为每个请求设置。

**喜欢：**

他们都是[`System.Globalization.CultureInfo`](https://msdn.microsoft.com/en-us/library/system.globalization.cultureinfo)实例。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2016-05-12T13:52:19.330

值得注意的是，`CurrentUICulture`支持非国家特定语言环境，例如“en”（中性文化），而`CurrentCulture`仅支持国家特定语言环境，例如“en-GB”。设置`CurrentCulture`为中性文化会抛出`ArgumentException`.

我认为这是因为日期和货币等格式与国家本身的联系更紧密，但显示的语言通常在国家之间可以互换。

# protection - 订阅保护内容？

> ID：329034
> 
> 赞同：0
> 
> 时间：2008-11-30T16:26:38.893
> 
> 标签：protection, subscriptions

开发提供课程内容的订阅类型网站（如 Lynda.com）的最佳方法是什么？

您如何保护内容不被下载（音频和视频）？

处理密码的最佳方法是什么？用户是否可以拥有一个登录名和密码，然后还有一个额外的密码，该密码会定期更改并由网站分发，以减少人们使用其他人的密码？

您如何最大限度地减少人们与其他人共享密码的次数？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T00:27:49.700

1.  保护内容非常简单：只需编写一个可以访问用户会话/安全详细信息的页面，然后检查他们是否有权下载所请求的文件。您可以使用 Java Servlet 或任何其他 Web 平台（如 ASP.NET、PHP 等）轻松完成此操作。

2.  我建议不要使用这种多重密码技术。这会给您的客户带来麻烦。它还会让人产生一种感觉，即您认为您的客户正试图欺骗系统。我会做的是记录所有用户登录以及对特定文件的用户访问，并记录 IP 地址。您可以编写一些代码来分析这些数据并查找来自不同 IP 的并发登录。您还可以编写代码来防止多次登录。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T00:35:53.413

您无法阻止人们复制您的内容。如果您希望他们能够查看它，那么他们将必须能够下载它。如果他们可以下载它，他们可以保存它。

我并不是要让它看起来毫无希望，但我只是想在这里说实话。您可以尝试检测是否有人在他们的帐户上运行爬虫您的网站，尽管这可能有点困难。也许限制他们每 10 或 15 秒下载 1 页。并将每次登录限制为 50 页。这对大多数用户来说不会太明显，但会严重阻止用户尝试进行的任何自动爬取。这些数字可能需要根据您托管的内容类型进行调整。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-01T03:40:57.940

注意：回顾这一点，我看到很多缺失的细节和边缘情况需要识别。我以这种形式保留它是因为我认为提供它的感觉很有用（即使细节还没有完全形成），所以你可以看到你会做什么。您需要通过威胁模型来使案例正确排列。

关于密码，您可以通过使用安全连接（TSL 和 https:）的身份验证过程来防止密码共享，并且在客户端计算用户提供的密码以及机器和用户帐户的哈希值（与您的用户 ID 和客户端计算机上的用户帐户）关联的数据。即使密码已知，散列函数也不会在不同的机器或用户帐户上产生正确的散列。

有一个有趣的问题是如何在第一次建立哈希（这是您接受的 - 您永远不知道用户选择的密码）以与您使用的用户 ID 关联。您需要为订阅提供的唯一密钥，并在注册时通过电子邮件握手提供，并初始选择用户 ID（如果与电子邮件地址不同）和密码。

如果您使用 cookie 来避免人们必须重复登录，您可能希望在 cookie 中包含加密/散列信息，将其与机器以及订阅相关联。

现在，做了这么多之后，您确实遇到了人们希望能够在多台机器上工作并且还需要重置用户密码以便他们可以选择一个新的密码来代替被遗忘/受损的密码的问题。由于这意味着提供电话支持和其他方式来重新验证真实用户，因此您可能需要考虑是否值得您为此付出代价，以及用户是否会认为这对他们来说是值得的。

关于盗用从该站点获得的材料，您遇到的问题要困难得多。加密不会有太大帮助，您通常希望允许用户保留材料以供离线使用、在使用材料时参考等。您可以做的是将材料识别为您的财产，并将材料识别为您的财产和以难以消除所有事件的方式提供给特定订户。这是很多服务器端的工作。结合对订阅者不信任的明显表现，您可能需要重新考虑并努力获得更值得信赖的东西，例如，提供一些不仅仅体现在拥有内容的价值。 ~~你确定要这样做吗？~~

注意 2：如果您正在提供某种进展，例如通过课件和课程工作，那么您可以做一些显而易见的事情，如果不知何故有多个人进来，如果他们取得任何进展，他们就会把事情搞砸为其他任何人。个性化和进步程度越高，将帐户提供给其他人使用的吸引力就越小。这不会阻止材料的保留，但任何广泛重复使用提取的内容都必须通过其他方式处理。

# c++ - 获取机器属性

> ID：329039
> 
> 赞同：2
> 
> 时间：2008-11-30T16:35:07.970
> 
> 标签：c++, winapi

我想编写一个程序来识别机器（出于许可目的），我很想获取以下信息并用这些数据编译一个 xml 文件：

1.  MAC地址。
2.  CPU 数据（串行、制造等）
3.  主板识别。（系列、制造等）

有人可以向我推荐一个提供此类信息的库 - 我用 C++ 编写我的程序并且很难找到这样的库。

我应该在注册表中挖掘这些信息吗？

非常感谢，提供

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-30T16:39:38.693

使用[WMI](http://msdn.microsoft.com/en-us/library/aa394582.aspx)并获取主板的序列号就足够了（其他选项不太安全，因为旧计算机可能没有网络适配器和/或 CPU 比主板更可能更换）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-30T17:32:19.477

GetAdaptersInfo() 将为您提供 MAC 地址。这是一个如何将其用于此目的的示例。

```
/** *************************************

  return string containing first MAC address on computer

  NOTE: requires adding Iphlpapi.lib to project

 */
string GetMac()
{
    char data[4096];
    ZeroMemory( data, 4096 );
     unsigned long  len = 4000;
    PIP_ADAPTER_INFO pinfo = ( PIP_ADAPTER_INFO ) data;
    char sbuf[20];
    string sret;

    DWORD ret = GetAdaptersInfo( pinfo, &len );
    if( ret != ERROR_SUCCESS )
        return string("**ERROR**");

    for(int k = 0; k < 5; k++ ) {
        sprintf(sbuf,"%02X-",pinfo->Address[k]);
        sret += sbuf;
    }
    sprintf(sbuf,"%02X",pinfo->Address[5]);
    sret += sbuf;

    return( sret );
} 
```

有关执行此类操作的完整系统的示例，请查看 Manuele Sicuteri 在 CodeProject 上的[文章](http://www.codeproject.com/KB/cpp/softwarekey.aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T17:50:35.993

不要使用 WMI（慢，NT 上没有安装） 使用标准 Win32 api

请参阅 news://comp.os.ms-windows.programmer.win32 几十年来所有这些问题都已得到解答（C /++ 代码）

# c# - 如何有条件地为 Mono 和 Microsoft .NET 编译我的 C#？

> ID：329043
> 
> 赞同：34
> 
> 时间：2008-11-30T16:37:04.393
> 
> 标签：c#, .net, mono

我需要一个条件编译开关，它知道我是为单声道还是 MS .NET 运行时进行编译。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-11-30T17:04:37.317

Mono 编译器定义`__MonoCS__`

**但是，但是，但是**，Mono 的全部意义在于，您可以使用 VS 构建的程序集并在 Mono 上运行它，反之亦然。

在我看来，如果您需要 Mono 与 MS.NET 的区别，那么您需要在运行时做出这些决定。

在运行时检测 Mono 的标准方法是：

```
bool runningOnMono = Type.GetType ("Mono.Runtime") != null; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-06-01T09:39:20.053

很明显，有时一个平台上的代码与另一个平台上的代码不同，您可能希望在运行时或编译时执行此操作。有时它不能在运行时完成。

例如：

Mono 用作 Xamarin 的 Ios、Android 和 Mac 工具包的基础。虽然它们有很多通用代码，但它们也有只出现在单个平台上的类。使用这些工具包进行开发时，您会开发无法在平台之间交换的原生包。

一个简单的例子是文件名和路径。这些在每个平台上都不同。我可能只是有一点条件可以在每个平台上以不同的方式加载字符串。有些平台有特定于大小写的文件名，有些则没有。

如果有一点代码可以返回当前平台，那就太好了——无论是 UNIX、iOS、Mac、X86、X64、XBox 等......

# php - 返回方法名

> ID：329044
> 
> 赞同：2
> 
> 时间：2008-11-30T16:39:15.340
> 
> 标签：php

我使用以下方法来查看列出我的开发中的各种方法

```
print basename(__FILE__) . "::serve_table()" 
```

是否有任何函数能够返回类方法的名称，所以我不必每次都使用它？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-30T16:39:48.663

使用`__FUNCTION__`and`__LINE__`和`__CLASS__`and`__METHOD__`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T16:42:23.290

您可以使用提供的信息[`debug_backtrace`](http://de.php.net/debug_backtrace)which 在数组中提供堆栈跟踪。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T16:43:10.420

我不明白您是否需要一种列出类的所有方法的方法，或者是否需要检索刚刚调用的方法名称。

如果是前者，使用反射：

```
$class = new ReflectionCLass("classname");
$methods = $class->getMethods();
foreach($methods as $m)
    print $m->getName(); 
```

# sql-server-2005 - 从 SQL 2005 链接服务器执行 DB2 iSeries 存储过程

> ID：329051
> 
> 赞同：2
> 
> 时间：2008-11-30T16:42:29.873
> 
> 标签：sql-server-2005, db2, linked-server, ibm-midrange

我正在尝试从 MS SQL 2005 中的链接数据库执行存储过程。链接数据库是 iseries 服务器上的 db2 数据库。我正在使用 iSeries IBMDASQL 服务提供者。我可以使用简单的 vbscript 和 ado 毫无问题地查询存储过程。当我尝试在 SQL Server 上的查询分析器中执行相同的存储过程时，我从未看到任何结果。查询分析器总是显示“命令已执行”，当我在临时表上执行 select * 时，没有值出现。我究竟做错了什么？？？？？谢谢！

--下面查询分析器的代码--

```
DECLARE @emailToAddress         char(50)
DECLARE @emailFromAddress       char(50)

set @emailToAddress = 'customer.service@company.com'
set @emailFromAddress = 'customer@gmail.com'

If Object_ID('tempdb..#tmpResultTbl') Is Not Null
    Drop Table #tmpResultTbl

Create Table #tmpResultTbl
(
OUTPGMID Char(150))

--SET FMTONLY Off
Set NoCount On
Insert Into #tmpResultTbl 
EXEC ('CALL abicqual.VP_GETCCEPGMID(?, ?) ', @emailToAddress, @emailFromAddress) AT MAM400 

Select * From #tmpResultTbl 
```

更新：这是使用openquery的更新代码......仍然没有运气:(

DECLARE @TSQL varchar(8000) DECLARE @emailToAddress varchar(50) DECLARE @emailFromAddress varchar(50) SET @emailToAddress = 'customer.service@company.com' SET @emailFromAddress = 'customer@gmail.com' SET @TSQL = ' SELECT * FROM OPENQUERY(MAM400,''CALL abicqual.VP_GETCCEPGMID(''''' + @emailToAddress + ''''', ''''' + @emailFromAddress + '''''' + ')''' + ')' 打印@TSQL 执行 (@TSQL)

--下面的输出 -- SELECT * FROM OPENQUERY(MAM400,'CALL abicqual.VP_GETCCEPGMID(''customer.service@company.com'', ''customer@gmail.com'')') Msg 7357, Level 16, State 2、第1行无法处理对象“CALL abicqual.VP_GETCCEPGMID('customer.service@company.com', 'customer@gmail.com')”。链接服务器“MAM400”的 OLE DB 提供程序“IBMDASQL”指示该对象没有列或当前用户对该对象没有权限。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T19:43:28.730

事实证明，我使用的 IBMDASQL 提供程序存在许多问题。信不信由你，使用 Microsoft OLE DB Provider for ODBC Drivers 会更快、更可靠。使用此提供程序创建新的链接服务器后，我之前的所有 sql 尝试都正常工作。干杯!

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-08-18T09:54:06.203

我正在使用 Microsoft DB2OLEDB 提供程序，它作为 SQL 2005 功能包的一部分提供 - 2006 年 4 月。它也是主机集成服务的一部分。它使用 DRDA（Oracle 风格）协议连接到 AS/400。

您可以单独下载它，但它只会安装在 SQL 标准、企业或开发人员（不是 express）上。

我还发现构建我想在 DB2/400 机器上运行的完整查询，然后将其包装在一个 VARCHAR(MAX) 字符串中，该字符串还包括“SELECT * FROM OPENQUERY (--linkedservername--,--DB2/ 400 query with params--)"，然后使用 sp_execute 或 EXEC 命令返回最佳结果。

甚至可以将 RPG 代码封装在 DB2/400 SQL 过程中，然后从 MS SQL Server 调用它们（使用参数），并将任何结果集作为 MS SQL 表返回。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T17:19:22.500

尝试使用[OPENQUERY](http://msdn.microsoft.com/en-us/library/ms188427(SQL.90).aspx)。 [此博客文章](http://blogs.conchango.com/jamespipe/archive/2007/06/28/SQL-Server-2005_3A00_-Passing-variables-into-an-OPENQUERY-argument.aspx)显示了将变量传递到 OPENQUERY 语句的示例。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-23T08:17:31.427

通过链接服务器调用 oracle 过程（函数）并获取其结果（返回值）

```
--输入参数p1,p2,p3
声明@SQL nvarchar(1000)
声明@param nvarchar(100)
声明 @result varchar(20) -- 数字可能导致数据类型错误

-- (...自定义操作，即插入到本地表)

set @SQL = N'set @result = (select * from openquery(myLinkedServer, ''select OwnerName.Function_Insert(' + cast(@p1 as varchar) + ', ' + cast(@p1 as varchar) + ', ' + cast(@p3 as varchar) + ') from dual''))'
设置@param = '@result varchar 输出'
EXEC sp_executesql @SQL、@param、@result 输出

如果@result '0' 转到错误

-- (...自定义操作)

返回 1 -- 好的

错误：
-- (...自定义操作，即使用 (rowlock) 从本地表中删除)
返回 0 -- KO

```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-06-26T12:44:32.330

解决方案是在调用语句周围添加括号。除非您安装了对分布式事务的支持，否则您仍然无法在 SQL Server 端选择表。我不确定它为什么需要交易，但除非你有这个设置，否则它不会工作。

EXEC ('{CALL abicqual.VP_GETCCEPGMID(?, ?)}', @emailToAddress, @emailFromAddress) 在 MAM400

# c# - IEnumerable 背后的基本原理是什么？

> ID：329058
> 
> 赞同：1
> 
> 时间：2008-11-30T16:51:15.677
> 
> 标签：c#, .net

你认为微软为什么要我们通过 IEnumerable 来获得 IEnumerator？对于给定类型，是否存在或不存在对 IEnumerator 的有效强制转换不足以确定该类型是否可枚举？

例如以下有什么问题？

```
class MyClass : IEnumerator
{
    ...
}

MyClass myObj = new MyClass();

if(myObj as IEnumerator != null)
{
    Console.WriteLine("myObj is enumerable");
}
else
{
    Console.WriteLine("myObj doesn't support enumeration");
} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-30T16:57:19.283

您可能有两个线程在枚举 - 每个线程都需要自己的枚举器。

IEnumerable.GetEnumerator 返回一个初始定位在集合的第一个元素之前的枚举器。如果你只有 IEnumerator，你必须记住在使用它之前重置自己，即使在单线程场景中也是如此。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-30T17:03:53.467

IEnumerator 保存执行枚举所需的状态信息，例如数组索引等。

枚举状态信息不是可枚举对象的一部分，因此强制转换功能不够强大。

此外，枚举器/可枚举的分离允许在同一个可枚举集合上同时执行多个枚举。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T17:05:35.833

这是一个职责分离的问题，IEnumerable 是一个可以迭代的类 IEnumerator 是一个执行迭代的类。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-30T22:53:56.130

接受的答案谈到多线程，但单线程算法也会受到严重限制。记住将列表重置为开头不会有 foreach 帮助您的问题，但假设您想将列表中的每个项目与其他每个项目进行比较：

```
int matchCount = 0;

foreach (var x in myList)
{
    foreach (var y in myList)
    {
        if (x == y)
            matchCount++;
    }
}

matchCount /= 2; 
```

如果“当前位置”存储在列表对象中，则内部和外部循环都将争夺同一个位置以存储它们的当前位置。大概内部循环会运行一次，然后外部循环会退出，发现自己已经超出了列表的末尾。

# c++ - __gxx_personality_v0 有什么用？

> ID：329059
> 
> 赞同：110
> 
> 时间：2008-11-30T16:53:21.787
> 
> 标签：c++, gcc, linker, kernel

这是来自操作系统开发站点的二手问题，但它让我感到好奇，因为我在任何地方都找不到合适的解释。

使用 gcc 编译和链接独立 C++ 程序时，有时会出现如下链接器错误：

```
out/kernel.o:(.eh_frame+0x11): undefined reference to `__gxx_personality_v0' 
```

这显然是因为该符号是在 libstdc++ 中定义的，而独立环境中缺少该符号。解决这个问题只需要在某个地方定义这个符号：

```
void *__gxx_personality_v0; 
```

这很好，但我不喜欢神奇地起作用的东西......所以问题是，这个符号的目的是什么？

* * *

## 回答 #1

> 赞同：99
> 
> 时间：2008-11-30T19:00:53.107

它用于堆栈展开表，例如，您可以在[我对另一个问题的回答](https://stackoverflow.com/questions/307610/how-do-exceptions-work-behind-the-scenes-in-c#307716)的汇编输出中看到它。正如那个答案所提到的，它的使用是由[Itanium C++ ABI](https://itanium-cxx-abi.github.io/cxx-abi)定义的，它被称为[Personality Routine](https://itanium-cxx-abi.github.io/cxx-abi/abi-eh.html#base-personality)。

通过将其定义为全局 NULL void 指针来“工作”的原因可能是因为没有抛出异常。当某些东西试图抛出异常时，你会看到它行为不端。

当然，如果没有使用异常，您可以禁用它们`-fno-exceptions`（如果没有使用 RTTI，您也可以添加`-fno-rtti`）。如果您正在使用它们，则必须（正如其他答案已经指出的那样）链接`g++`而不是`gcc`，这将为`-lstdc++`您添加。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-30T17:27:27.427

这是异常处理的一部分。gcc EH 机制允许混合各种 EH 模型，并调用个性例程来确定异常是否匹配、调用什么终结等。这个特定的个性例程用于 C++ 异常处理（与 gcj/Java 相对）异常处理）。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-11-30T18:28:38.380

异常处理包含在独立实现中。

这样做的原因是您可能使用它`gcc`来编译您的代码。如果您使用该选项进行编译，您会注意到它在调用链接器进程时`-###`缺少链接器选项。`-lstdc++`编译`g++`将包含该库，因此包含其中定义的符号。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-11-30T17:35:59.033

对代码库的快速 grep`libstd++`揭示了以下两种用法`__gx_personality_v0`：

在 libsupc++/unwind-cxx.h

```
// GNU C++ personality routine, Version 0\.                                      
extern "C" _Unwind_Reason_Code __gxx_personality_v0
     (int, _Unwind_Action, _Unwind_Exception_Class,
      struct _Unwind_Exception *, struct _Unwind_Context *); 
```

在 libsupc++/eh_personality.cc

```
#define PERSONALITY_FUNCTION    __gxx_personality_v0
extern "C" _Unwind_Reason_Code
PERSONALITY_FUNCTION (int version,
                      _Unwind_Action actions,
                      _Unwind_Exception_Class exception_class,
                      struct _Unwind_Exception *ue_header,
                      struct _Unwind_Context *context)
{
  // ... code to handle exceptions and stuff ...
} 
```

（注意：实际上比这要复杂一些；有一些条件编译可以改变一些细节）。

因此，只要您的代码实际上没有使用异常处理，将符号定义为`void*`不会影响任何东西，但是一旦这样做，您就会崩溃 -`__gxx_personality_v0`是一个函数，而不是某个全局对象，所以尝试调用该函数将跳转到地址 0 并导致段错误。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2014-07-16T07:36:57.003

我有一次这个错误，我发现了起源：

我正在使用 gcc 编译器，`CLIENT.C`尽管我正在执行 C 程序而不是 C++ 程序，但仍调用了我的文件。

gcc 将`.C`扩展识别为 C++ 程序，将扩展识别`.c`为 C 程序（注意小 c 和大 C）。

所以我重命名了我的文件`CLIENT.c`程序并且它起作用了。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2018-03-03T21:42:03.540

上面的答案是正确的：它用于异常处理。GCC 版本 6的[手册](https://gcc.gnu.org/onlinedocs/gcc-6.4.0/gcc/Java-Exceptions.html#Java-Exceptions)有更多信息（版本 7 手册中不再存在）。当链接一个 GCC 未知的外部函数会引发 Java 异常时，可能会出现该错误。

# c++ - 编写多线程异常安全代码

> ID：329061
> 
> 赞同：12
> 
> 时间：2008-11-30T16:55:33.733
> 
> 标签：c++, multithreading, exception, c++11

C++ 中多线程和异常安全之间的矛盾是什么？有没有好的指导方针可以遵循？线程是否因为未捕获的异常而终止？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-29T20:39:57.303

C++0x 将为[在线程之间传输异常提供语言支持，](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2007/n2179.html)以便当工作线程抛出异常时，生成线程可以捕获或重新抛出它。

从提案中：

```
namespace std {

    typedef unspecified exception_ptr;

    exception_ptr current_exception();
    void rethrow_exception( exception_ptr p );

    template< class E > exception_ptr copy_exception( E e );
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-30T17:20:55.583

我相信 C++ 标准没有提到多线程——多线程是特定于平台的特性。

我不完全确定 C++ 标准对一般未捕获异常的规定，但根据[此页面](http://www.devx.com/tips/Tip/14240)，发生的情况是平台定义的，您应该在编译器的文档中找到。

在我对 g++ 4.0.1（具体来说是 i686-apple-darwin8-g++-4.0.1）进行的快速而肮脏的测试中，结果是`terminate()`被调用，这会杀死整个程序。我使用的代码如下：

```
#include <stdio.h>
#include <pthread.h>

void *threadproc(void *x)
{
  throw 0;

  return NULL;
}

int main(int argc, char **argv)
{
  pthread_t t;
  pthread_create(&t, NULL, threadproc, NULL);

  void *ret;
  pthread_join(t, &ret);

  printf("ret = 0x%08x\n", ret);

  return 0;
} 
```

编译`g++ threadtest.cc -lpthread -o threadtest`。输出是：

```
terminate called after throwing an instance of 'int' 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-30T22:06:57.300

未捕获的异常将调用`terminate()`，然后调用`terminate_handler`（可以由程序设置）。默认情况下`terminate_handler`调用`abort()`.

即使您覆盖了 default `terminate_handler`，该标准也表示您提供的例程“应终止程序的执行而不返回调用者”（ISO 14882-2003 18.6.1.3）。

因此，总而言之，未捕获的异常将终止程序而不仅仅是线程。

就线程安全而言，正如[Adam Rosenfield](https://stackoverflow.com/questions/329061/writing-multithread-exception-safe-code#329084)所说，这是标准未解决的平台特定问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-30T22:59:29.973

这是 Erlang 存在的最大原因。

我不知道约定是什么，但恕我直言，尽可能像 Erlang。使堆对象不可变并设置某种消息传递协议以在线程之间进行通信。避免锁。确保消息传递是异常安全的。在堆栈上保留尽可能多的有状态的东西。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-01T13:07:23.350

正如其他人所讨论的，并发（尤其是线程安全）是一个架构问题，它会影响您设计系统和应用程序的方式。

但我想回答你关于异常安全和线程安全之间紧张关系的问题。

在类级别线程安全需要更改接口。就像异常安全一样。例如，类通常会返回对内部变量的引用，例如：

```
class Foo {
public:
  void set_value(std::string const & s);

  std::string const & value() const;
}; 
```

如果 Foo 被多个线程共享，麻烦就在等着你。自然地，您可以放置​​一个互斥锁或其他锁来访问 Foo。但很快，所有 C++ 程序员都希望将 Foo 包装到“ThreadSafeFoo”中。我的论点是 Foo 的接口应该更改为：

```
class Foo {
public:
  void set_value(std::string const & s);

  std::string value() const;
}; 
```

是的，它更昂贵，但它可以通过 Foo 内部的锁使其成为线程安全的。IMnsHO 这在线程安全和异常安全之间产生了一定的张力。或者至少，您需要执行更多分析，因为用作共享资源的每个类都需要在两种情况下进行检查。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-29T21:07:26.217

一个经典的例子（不记得我第一次看到它的地方）是在 std 库中。

以下是从队列中弹出内容的方法：

```
T t;
t = q.front(); // may throw
q.pop(); 
```

与以下相比，此界面有些迟钝：

```
T t = q.pop(); 
```

但是因为 T 拷贝赋值可以抛出。如果在弹出发生后复制抛出，则该元素将从队列中丢失，并且永远无法恢复。但由于复制发生在元素弹出之前，您可以在 try/catch 块中的 front() 中对复制进行任意处理。

缺点是由于涉及两个步骤，您无法使用 std::queue 的接口实现线程安全的队列。有利于异常安全（分离出可能抛出的步骤），现在对多线程不利。

您在异常安全方面的主要救星是指针操作是不抛出的。同样，指针操作可以在大多数平台上进行原子操作，因此它们通常可以成为您在多线程代码中的救星。你可以吃蛋糕也可以吃，但这真的很难。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-01T14:28:39.193

我注意到两个问题：

*   在 Linux 上的 g++ 中，线程 (pthread_cancel) 的终止是通过抛出“未知”异常来完成的。一方面，这可以让你在线程被杀死时很好地清理。另一方面，如果您捕获该异常并且不重新抛出它，您的代码将以 abort() 结束。因此，如果您或您使用的任何库终止线程，则不能

    抓住（...）

没有

```
throw; 
```

在您的线程代码中。[以下](http://gcc.gnu.org/ml/gcc/2005-08/msg00426.html)是网络上此行为的参考：

*   有时您需要在线程之间传输异常。这不是一件容易的事——我们最终做了一些hack，当正确的解决方案是你在进程之间使用的那种编组/解组时。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-30T18:23:59.030

我不建议让任何异常保持未捕获。将您的顶级线程函数包装在可以更优雅（或至少详细地）关闭程序的包罗万象的处理程序中。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-30T18:34:39.210

我认为最重要的是要记住来自其他线程的未捕获异常不会向用户显示或在主线程中抛出。因此，您必须使用 try/catch 块扭曲所有应该在与主线程不同的线程上运行的代码。

# haskell - 如何将变量转换为字符串？

> ID：329063
> 
> 赞同：0
> 
> 时间：2008-11-30T16:56:26.057
> 
> 标签：haskell, functional-programming, lambda-calculus

例如，它像这样工作 toString (Var x)="x"

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-30T17:01:32.347

使用`show`功能：

```
putStrLn (show x) 
```

将打印出“x”变量。（当然，您也不需要将它与`putStrLn`, 一起使用 --`show`返回一个可以像字符串一样在任何地方使用的字符串。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-10T20:47:59.097

如果我理解正确，您是在问如何将编程结构转换为字符串。您并不关心“x”代表什么，因为程序员在源文件中将其称为“x”。

您可以使用 Scrap Your Boilerplate 组件将数据构造函数转换为字符串。这是一个符合您要求的示例。

```
{-# LANGUAGE DeriveDataTypeable #-}

module Main where

import Data.Data

data Var a = Var a
data X = X deriving (Data, Typeable)

toString :: Data a => Var a -> String
toString (Var c) = show (toConstr c)

main :: IO ()
main = putStrLn $ "toString (Var x)= " ++ show (toString (Var X)) 
```

输出：

```
$ ghci Test.hs
GHCi, version 6.10.4: http://www.haskell.org/ghc/  :? for help
Loading package ghc-prim ... linking ... done.
Loading package integer ... linking ... done.
Loading package base ... linking ... done.
[1 of 1] Compiling Main             ( Test.hs, interpreted )
Ok, modules loaded: Main.
*Main> main
toString (Var X)= "X"
*Main> 
```

举一个真实的例子，我建议查看[RJson library](http://hackage.haskell.org/package/RJson)。

# linq-to-sql - 使用 LinqtoSql，如何从 SPROC 中的临时表返回值？

> ID：329065
> 
> 赞同：3
> 
> 时间：2008-11-30T16:57:20.687
> 
> 标签：linq-to-sql, stored-procedures

我有一个从临时表返回值的存储过程。在我的 DBML 中，返回类型显示为 (None)。让它识别我的临时表中的列的技巧是什么？

```
CREATE PROCEDURE [dbo].[GetCategoryPriceRanges] 
@CategoryId int 
AS
BEGIN

DECLARE @MinPrice money, @MaxPrice money    
SELECT  @MinPrice = MIN(ourPrice),@MaxPrice = MAX(ourPrice)

DECLARE @loopCatch int

--catch infinite loops
SELECT @loopCatch = 1
WHILE @thisLow <= @maxPrice AND @loopCatch < 100
    BEGIN
        INSERT INTO #prices(lowRange, hiRange) VALUES (@thisLow, @thisHigh)
        SET @thisLow = @thisHigh + 1
        SET @thisHigh = 2 * @thisLow - 1
        SELECT @loopCatch = @loopCatch + 1
    END
SELECT * FROM #prices
DROP TABLE #prices
END 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T18:58:27.930

如果您有一个返回相同列集的表，您可以分配存储过程以在数据模型图中返回该类型。（或者通过将存储过程拖到它上面，或者通过在存储过程的属性中设置它。）

或者，您可以使用这组列创建一个视图，并分配存储过程以返回它。（关于存储过程的返回类型属性。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-08-31T18:06:30.773

不确定 Visual Studio 的旧版本，但我使用的是 2010，我通过进入 dbml 设计器并添加一个类解决了这个问题。

然后在新类中，添加存储过程将返回的临时表中的字段。即右键单击类并添加-> 属性。

然后将存储过程的返回类型设置为您新创建的类。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-10-09T09:48:00.363

我通过`SET FMTONLY OFF`在包含临时表的存储过程的顶部添加解决了这个问题。Visual Studio 迅速自动生成类型。

# c# - C# 的检查点库

> ID：329067
> 
> 赞同：2
> 
> 时间：2008-11-30T17:00:25.517
> 
> 标签：c#

我正在寻找 C# 的检查点库。有任何想法吗 ？

见 [http://en.wikipedia.org/wiki/Application_checkpointing](http://en.wikipedia.org/wiki/Application_checkpointing)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-01T08:07:05.967

这应该可以使用事务（提交/回滚）或撤消来实现。如果你正确设计你的类和操作，它会起作用，当然，使用这些类需要一些努力和纪律。您还需要注意异常。

[System.Transactions 命名空间](http://msdn.microsoft.com/en-us/library/system.transactions.aspx)（如 Rune所建议的）似乎是一个不错的候选者，或者至少是一个不错的起点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T19:49:43.240

如果我对您的理解正确（而且问题很模糊，所以我完全不确定），那么 Windows Workflow Foundation 肯定具有此功能。但是，对于您的要求，这几乎可以肯定是矫枉过正。

* * *

好的，您添加了一个链接，可以更好地解释检查点的含义。

考虑到这一点，.Net 没有内置任何东西来直接支持这一点。然而，任何使用状态机的东西，状态机可以被持久化，可以被检查/验证，并且是事务性的，这种东西自然是内置的。世界自然基金会就是一个例子。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-01T07:51:15.670

我不认为有内置的支持，但它应该相对容易构建你自己的。假设您有一个中央应用程序类来存储您的应用程序状态，或者至少是检查点中使用的部分。然后，您可以在需要时使用序列化来存储应用程序的状态。此外，如果您以后需要，可以很容易地将快照存储在文件的数据库中。但这需要您编写自己的库来支持它。

当我写这篇文章时，我开始觉得框架中必须对此有一些支持。例如，查看 System.Transactions 命名空间。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-01T05:43:35.210

鉴于维基百科的链接，我可以告诉你 .NET/CLR 不支持这一点。使这成为不可能的原因是 .NET 不允许您检查修改应用程序堆栈，而由于 .NET 中的内置安全性，这又是不可能的。

# .net - ASP.NET 使用 [Authorize] 进行身份验证

> ID：329102
> 
> 赞同：1
> 
> 时间：2008-11-30T17:36:39.797
> 
> 标签：.net, asp.net-mvc

我使用 [Authorize] 属性定义了一个控制器来强制进行身份验证。当会话超时时，请求仍然被传递并执行，而不是强制重定向。

我确实使用 FormsAuthentication 来登录和注销用户。

关于如何控制它的任何想法？

例子：

```
[Authorize]
public class ProjectsController : Controller
{
    public ActionResult Index()
    {
        return View();
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-30T18:08:08.470

跟踪用户会话 ASP.NET 使用*ASP.NET_SessionId* cookie。为了跟踪经过身份验证的用户，ASP.NET 使用*ASPXAUTH* cookie（默认情况下）。

当会话超时时，客户端可能不再发送 ASP.NET_SessionId cookie，但*仍会发送**ASPXAUTH* cookie，这可能解释了呈现您的操作的原因。

要覆盖默认表单身份验证值，您可以查看[此处](http://msdn.microsoft.com/en-us/library/aa480476.aspx)。我还建议您使用[firebug](http://getfirebug.com/)扩展程序来准确查看客户端发送了哪些 cookie。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T20:51:51.307

同样，ASP.NET MVC 建立在传统的 ASP.NET 之上。是的，有一个“内置的身份验证机制”……它与传统 ASP.NET 使用的 Membership API*完全相同。*

意思是……还有别的问题。也许你打开了滑动会话......或者超时时间比你想象的要高，等等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T18:12:12.050

根据您的其他[问题](https://stackoverflow.com/questions/329123/forms-in-masterpage-and-views "问题")，我猜您根本不会使用此控制器。

# c++ - 适用于 C++ (Linux) 的类似 VisualWorks Smalltalk 的 IDE

> ID：329109
> 
> 赞同：3
> 
> 时间：2008-11-30T17:47:49.853
> 
> 标签：c++, linux, ide

兄弟们，

C++ 有什么东西可以在左侧面板上将类层次结构显示为树吗？我使用 VisualWorks Smalltalk 已经有一段时间了，类的显示方式和分解的方法使得构建类的功能非常容易。可悲的是，我找不到与 C++ 类似的东西。Eclipse 可能有这样的模式吗？

谢谢， frapple_hok

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-30T21:27:14.777

不幸的是，C++ 不适合这种类浏览器，原因有两个：

*   没有包含所有活动类的中央存储库或映像。类定义分布在许多文件中。

*   类定义和文件以 M:M 关系存在。并非所有类都必须在单个文件中定义，一个文件可以包含多个类的代码。

在 Linux 上，[KDevelop](http://www.kdevelop.org/)、[Eclipse](http://www.eclipse.org/)和[其他各种](http://www.linuxselfhelp.com/HOWTO/C++Programming-HOWTO-12.html)都具有 C++ 支持，并且或多或少地支持基于任意 C++ 源代码的内省。

您还可以从[ctags](http://ctags.sourceforge.net/)获得一些好处，它分析源代码文件并识别类型、类、成员等的定义。这可以与任何体面的编辑器一起使用，例如[vim](http://www.vim.org/)、[emacs](http://www.gnu.org/software/emacs/)或[许多其他编辑器和 IDE](http://en.wikipedia.org/wiki/Ctags#Editors_that_support_ctags)。在支持标签的源代码编辑器中，您可以将光标放在引用上并跳转到其定义。它不如[Inspect](http://www.faqs.org/faqs/smalltalk-faq/)好，但您实际上并没有运行图像的概念。最接近的就是调试器，例如[DDD。](http://www.gnu.org/software/ddd/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-30T20:47:31.080

**警告购买者：** 我自己从未使用过这个工具。（虽然也许我会开始......）

从长期的经验中，我了解到我可以将*“emacs”* +*任何东西*放入*谷歌*并找到它。（字面上任何东西！有些人手上有太多的空闲时间......）

在这种情况下，*“emacs 类浏览器”*会出现**[EBROWSE，](http://www.gnu.org/software/emacs/manual/html_mono/ebrowse.html)**这可能是您正在寻找的。

就“左面板”而言，emacs 支持垂直（split-window-vertically）或水平（split-window-horizo​​ntally）拆分单个窗口，但你喜欢。或者，如果您愿意，可以使用多个窗口（make-frame-command）。

在比较典型的IDE特性方面，emacs支持font-locking（着色）、make integration（跳转到错误）、gdb integration（调试）、基于语言的自动缩进、TAGS [etags]（跳转到标签定义）、diff 'ing 两个文件（或针对修订的文件），签入/签出源代码修订系统，拼写检查等（我确信其他 stackoverflow 条目已经突出显示了 emacs 的许多功能。或者尝试**[slashdot。](http://news.slashdot.org/article.pl?sid=08/11/07/0533222)** 绝对检查*“完成”*功能！*（需要“完成”）* 也许还有*“对齐正则表达式”*！）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-18T20:48:39.710

我知道至少有两种选择：

1.  [OO Browser](http://sourceforge.net/projects/oo-browser/)，其全部目的是将 Smalltalk 风格的浏览器引入其他语言。我不知道该项目的维护情况如何，但尽管它的外观相当乏味，但我上次尝试使用它时效果非常好（大约三年前）。
2.  [代码浏览器](http://tibleiz.net/code-browser/)，旨在提供通用方法来浏览和管理复杂的代码层次结构。它提供了许多查看代码的方法，但其中之一确实是 Smalltalk 浏览器模型（例如，看一下Code Browser 编辑本身的[屏幕截图）](http://tibleiz.net/code-browser/images/gtk.png)

# java - 如何在代码中激活 JButton ActionListener（单元测试目的）？

> ID：329118
> 
> 赞同：0
> 
> 时间：2008-11-30T17:54:01.353
> 
> 标签：java, unit-testing, swing, junit

我需要在 JDialog 中激活一个 JButton ActionListener，这样我就可以使用 JUnit 进行一些单元测试。

基本上我有这个：

```
 public class MyDialog extends JDialog {
    public static int APPLY_OPTION= 1;
    protected int buttonpressed;
    protected JButton okButton;
    public MyDialog(Frame f) {
        super(f);
        okButton.addActionListener(new ActionListener() {
            public void actionPerformed(ActionEvent e) {
                buttonpressed= APPLY_OPTION;
            }
        } );
    public int getButtonPressed() {
        return buttonpressed;
    }

} 
```

然后我有我的 JUnit 文件：

```
public class testMyDialog {

    @Test
    public void testGetButtonPressed() {
        MyDialog fc= new MyDialog(null);
        fc.okButton.???????? //how do I activate the ActionListener?
        assertEquals(MyDialog.APPLY_OPTION, fc.getButtonPressed());
    }
} 
```

在单元测试中这听起来可能是多余的，但实际的类比这要复杂得多......

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-30T18:23:23.180

`AbstractButton.doClick`

如果您使用带有参数的表单并给它一个更短的延迟，您的测试可能会运行得更快。呼叫阻塞延迟。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T18:27:16.073

如果您的事件处理程序中直接有需要单元测试的重要代码，您可能需要考虑采用[MVC 模式](http://en.wikipedia.org/wiki/Model-view-controller)并将代码移动到控制器。然后，您可以使用模拟视图对代码进行单元测试，并且您根本不需要以编程方式按下按钮。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-01T07:14:40.317

您可以使用反射在运行时获取按钮并触发事件。

```
JButton button = (JButton)PrivateAccessor.get(MyDialog , "okButton");
Thread t = new Thread(new Runnable() {
    public void run() {
        // What ever you want
    };
});

t.start();

button.doClick();

t.join(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-06-29T13:16:11.443

我为 JButton 创建了一个 getter 并使用了 doClick。例子：

```
@Test
@DisplayName("ActionListener test")
void testActionListener(){
    HelpWindow helpWindow = new HelpWindow("menu");

    assertDoesNotThrow(() -> helpWindow.getReturnButton().doClick());
} 
```

# asp.net-mvc - MasterPage 和视图中的表单

> ID：329123
> 
> 赞同：2
> 
> 时间：2008-11-30T17:58:42.293
> 
> 标签：asp.net-mvc

我有一个母版页，我的所有视图都继承自该母版页。我遇到的问题是在母版页中创建的表单标签，然后是在视图中创建的表单标签。

由于表单位于母版页表单中，我所有的回发都发送到控制器的 Index 方法，它迫使我创建一个强制 HttpPost 的新方法 Index。

此外，这会导致路由出现问题，例如： /projects/add/ 和 /projects/delete/1 其中一切都是索引方法的路由器。

怎么回事？我在这里错过了什么吗？

谢谢任何人

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-30T18:57:14.593

从母版页中删除表单。

[在此处](http://www.asp.net/learn/mvc-videos/)查看一些示例视频，以更好地理解 MVC 理念。

顺便说一句：在 ASP.NET MVC 中，没有回发。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T20:23:26.667

在我看来，您真的应该将 MasterPages 视为布局而不是功能页面。事实上，视图根本不“继承”母版页。在传统的 Web 表单中，母版页实际上是用户控件。所以我会尽量不将基类功能放入母版页。所以也许这就是一些混乱的来源。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T20:44:26.750

ASP.NET MVC 不应该执行“PostBacks”......这完全没有抓住重点。删除您在那里拥有的所有“主要包含表单标签”，并且只在输入字段周围放置一个“表单”标签，这些字段意味着（出于特定目的）发布到某种操作。

您拥有一个包罗万象的表单标签（就像传统的 asp.net 一样）这一事实意味着您没有明确的理由来使用该表单，这（再次）错过了 MVC 的要点。

这是一篇较旧的文章，但它可以帮助区分传统和 MVC：[现实世界中的 ASP.NET MVC](http://www.singingeels.com/Articles/ASPNET_MVC_in_the_Real_World.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-30T20:54:53.313

如果您在每个页面上都需要通用表单元素，因此您的母版页上有一个表单，那么将表单元素与您的 site.master 文件一起移动到位于共享文件夹中的用户控件。然后通过 Html.RenderPartial 在每个视图页面中包含用户控件。这将只需要 1 行代码，并且每个视图可能需要一个 div 标签，这还不错。

顺便说一句，位于母版页中的表单是偶然的登录或搜索控件吗？

# c# - 使用 Linq2Sql 的最佳方式？

> ID：329125
> 
> 赞同：4
> 
> 时间：2008-11-30T18:00:15.210
> 
> 标签：c#, linq-to-sql, model

我正在努力想一个使用 linq2sql 的好方法，只是我想使用它，但我不知道是否最好将 linq2sql 生成的类包装在我的模型类中，提供某种形式的通用抽象基类/ 或我的模型类上的常用方法的接口，如添加、更新、删除等，或扩展 linq2sql 生成的部分类。

人们发现什么设计最成功？你能快速介绍一下这些设计吗？

（我知道这有点主观，因为每个人都会有自己的最佳方式，但是，我不确定是否应该这样标记。如果您认为应该这样做，请随意编辑并制作社区 wiki。）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-30T18:05:56.150

就个人而言，我将 Linq2SQL 包装在存储库模式中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-30T18:14:33.230

根据您的应用程序的复杂性，您可能需要也可能不需要为您的 ORM 使用生成的类以外的任何东西。我发现我能够愉快地使用生成的类，通过部分方法扩展并使用包装器包装数据上下文（如果我需要添加通用功能，还可以扩展）以提高可测试性。不过，从数据库的角度来看，我的大多数应用程序都相对简单。

# java - 在Eclipse中设置执行目录？

> ID：329129
> 
> 赞同：20
> 
> 时间：2008-11-30T18:02:48.807
> 
> 标签：java, eclipse

是否可以在指定目录中执行一个类？

我的意思是，a.class 在目录 abc 中，我希望它像在目录 xyz 中一样执行。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-11-30T18:10:00.133

绝对地。

进入 Debug/Run 对话框（bug/“go”按钮旁边的下拉按钮），在 Arguments 选项卡中，通过选择“Other”设置工作目录，然后输入相关的目录名称。请注意，该目录可以使用“变量”，例如`$workspace_loc`. 你甚至可以让它提示用户使用`$folder_prompt`.

# unicode - 处理url中的ąę等国家标志？- 你的选择

> ID：329139
> 
> 赞同：2
> 
> 时间：2008-11-30T18:09:32.850
> 
> 标签：unicode, internationalization, url-encoding

你如何处理它们？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T18:14:24.917

在域名中，您可以使用 IDN 域，前提是您要注册的注册商支持它们。

在 URL 的其他地方，它们通常由浏览器作为 utf8 urlencoded 发送。直到最近我还在看：

[http://en.wikipedia.org/wiki/Pfeffern%C3%BCsse](http://en.wikipedia.org/wiki/Pfeffern%C3%BCsse)

并且好奇地发现 URL 中有一个 ü。Firefox 将其显示为正确的字符。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T18:18:24.643

您需要查看[IDNA](http://en.wikipedia.org/wiki/Internationalized_domain_name)和[Punycode](http://en.wikipedia.org/wiki/Punycode)，它们是在域名中处理此问题的标准。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T18:27:48.320

您可能想看看[RFC 3986](https://www.rfc-editor.org/rfc/rfc3986) Uniform Resource Locator: General Syntax。这指定了如何处理 URL 中的非 ASCII 字符。总体思路是对每个字符进行 UTF-8 编码，将每个生成的字节转换为其两位数的十六进制值并附加一个“%”。

当然，另一种选择是将它们从 URL 中删除或替换为下划线之类的内容，这取决于您的要求。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-30T19:20:25.390

这些名称的问题在于它们很容易与其他字符混淆。所以我需要一个很好的理由来使用它们。例如，如果您的公司名称是“Schröder”，我会同时使用 schröder.com、schroder.com 甚至 schroeder.com，额外的费用是合理的，因为创建恶意名称很容易。

# visual-studio-2008 - 元数据文件...构建项目时找不到错误

> ID：329142
> 
> 赞同：99
> 
> 时间：2008-11-30T18:11:25.450
> 
> 标签：visual-studio-2008

每次我启动 Visual Studio 2008 时，我第一次尝试运行项目时都会收到错误 CS0006 The metadata file ... could not be found。如果我重建完整的解决方案，它就可以工作。

有关解决方案的一些信息：

*   我正在调试模式下构建，Visual Studio 抱怨在发布文件夹中找不到 dll:s。

*   Visual Studio 抱怨的项目被解决方案中的许多其他项目使用。

*   我已将所有项目的默认输出路径分别更改为......\build\debug\ProjectName 和......\build\release\ProjectName。（只是为了将所有构建文件放在一个目录中）

*   我对另一个解决方案有同样的问题。

*   该解决方案是从头开始创建的。

*   解决方案中有 9 个项目。一个 WPF 和 8 个使用 dotnet 3.5 的类库。

关于是什么导致这个问题的任何想法？

* * *

## 回答 #1

> 赞同：133
> 
> 时间：2009-05-04T16:18:43.027

我遇到了“找不到元数据”的类似问题。在解决方案属性上，确保在*构建/配置管理器*中为每个项目标记了“构建”复选框。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-11-19T22:26:56.390

这通常是由在与引发错误的解决方案不同的解决方案中引用的项目引起的。如果您清理其他解决方案或分支代码，您很可能会看到此错误。解决方案是向下滚动“找不到元数据”错误列表，并查看对项目的引用。9/10 次，您将看到对不在此解决方案中的项目的损坏引用。添加项目以修复参考错误并重建。那应该解决它。

（我今天刚遇到这个，过去也遇到过，这一直有效）

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-06T09:44:02.273

我遇到了这个问题，不确定它是否会有所帮助，但我的问题是由于两个不同的解决方案引用了同一个项目的两个不同版本而引起的。当我首先使用对正确项目的引用来构建解决方案时，第二个解决方案会构建得很好，但是，如果我清理了第一个解决方案并尝试构建第二个解决方案，它将失败并显示这些 dll 引用错误消息。

对我来说，解决方案是弄清楚我有两个同名的项目被意外复制，并删除了对旧的不正确项目的引用并添加了对新项目的引用。

无论如何，这些消息似乎有点牵强，我会检查您的构建输出并找到第一个无法构建的项目，并非常仔细地检查该项目的引用。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2011-05-28T04:54:12.853

要验证的另一件事是路径长度......这也会导致找不到元数据文件和编译错误......我只是将我的文件夹重命名为较短的路径和瞧，那些未被识别并保持黑色的类，只是通过重命名变成蓝色文件夹。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-08-16T16:40:17.650

对我来说，我在另一个项目中引用了一个项目。它没有显示它在解决方案资源管理器窗口的引用列表中被破坏，但我还是删除并阅读了它。它现在构建得很好！

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-03-25T03:08:12.730

我在 VS2012 中完成了所有这些步骤，但是在构建整个解决方案时我一直遇到这个问题（单个项目构建得很好，没有错误）。

我发现如果您在解决方案资源管理器中右键单击您的解决方案并选择“构建顺序”，您可以看到 VS 用于重建您的解决方案的顺序。很可能不正常。

您可以通过单击“依赖项”选项卡并选择依赖于解决方案中其他项目的项目并检查它们所依赖的项目来更正构建顺序。一旦你点击确定并重建解决方案，你应该很高兴。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-03-09T16:21:54.990

我过去在 VS2005 和现在在 VS2008 中解决这个问题的方法是确保所有依赖项都是正确的，并且引用指向的是项目而不是 dll。然后按照依赖顺序手动构建每个项目。一旦最后一个构建，您就可以运行完整的解决方案构建并且它很好。

这个答案供其他人将来参考，因为我知道这个问题已经超过 15 个月了。

干杯

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-08-05T00:30:03.333

我有几点想说。

如果您依赖解决方案文件作为 MSBuild 下的构建文件，请确保按照您希望它们构建的顺序将项目添加到解决方案文件，即基于项目的相互依赖顺序。如果您在解决方案中有其他项目所依赖的项目，但引用已添加为“引用”而不是“项目引用”，这将变得非常重要。

您应该像瘟疫一样避免这种情况，但如果您确实需要这样做，那么至少要确保相关项目出现在解决方案文件中的早期。

您应该记住，Visual Studio 生成构建顺序的方式与 MSBuild 生成顺序的方式并不完全相同。这是因为 MSBuild 主要依靠项目文件来告诉它依赖项是什么，而 Visual Studio 也可以将它们保存在 soltuion 文件中。因此，您有时会看到 Visual Studio 完美构建解决方案但 MSBuild 无法做到的情况。

我有几个例子，我不得不手动调整项目出现在解决方案文件中的顺序，以及项目在解决方案文件的网站项目的 ProjectReferences 元素中列出的顺序。

我希望以上信息对您有所帮助。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-03-25T20:44:31.617

例如，如果您使用 LinqtoSQL 数据上下文，并且缺少 .designer.cs 文件，您将收到 Metadata file could not be found 错误。

重新创建 Designer.cs 文件很容易。

使用 xml 视图打开 dbml。添加一个空行，然后将其删除，然后保存。那应该重新生成您的 Designer.cs 文件。

在某些情况下，如果您在数据上下文的代码隐藏中有代码，则此解决方法将不起作用。这种情况下，把代码从后面的代码里拿出来，放到记事本什么的。执行添加然后从 DC 中删除一行并保存的技巧。现在放回代码并保存。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-03-29T08:18:59.567

每次从 SVN 更新项目时，我都会遇到类似的问题。
ASP.NET 的另一种解决方案：

1.  关闭 IDE。
2.  删除`C:\WINDOWS\microsoft.net\framework\v…\Temporary ASP.NET File\`.

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-05-26T02:15:01.647

我也遇到了这个错误，原因是项目引用了自己。我不知道它是怎么发生的，但我只是删除了参考，瞧

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-04-03T23:42:41.893

就我而言，我发现我的解决方案之一是引用计算机上不存在的东西（VBIDE）。一旦我删除了有问题的引用，其余的项目就会正确构建。希望对某人有所帮助。

在另一种情况下，我将一些代码从一个项目移动到另一个项目，而那段代码引用了 Json.net。我手动添加了对 Json.net 的引用，但这使得问题出现了。我通过 NuGet 安装 Json.net 解决了这个问题，这让问题消失了。希望对某人有所帮助。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-11-28T14:04:37.993

首先确保在 Build -> Configuration Manager 中为每个项目标记了“build”复选框。

如果您已经在 Build -> Configuration Manager 菜单下选择了所有项目，并且重新启动 VS 技巧对您也不起作用，那么您必须找到文件的引用（可能是 dll 或 cs）您的项目并手动删除这些引用。这些文件/参考应以黄色图标显示。该错误肯定会指导您应该研究哪个解决方案项目。

此错误的原因是您在 Windows 资源管理器中手动删除了文件，而 VS 没有更新参考并试图找到不再存在的文件！

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-11-10T19:25:48.077

同样的事情发生了。我有几个引用相同库项目（.net 3.5）的解决方案。我注意到当一个是在调试/正常配置中构建的，另一个是使用其他编译器指令（sqlite/local 模式）时，会发生这种情况。只需使用相同的指令构建两个项目，就可以了。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-04-30T00:39:02.010

如果您已将新项目添加到解决方案，请检查它是否在构建列表中（请参阅配置管理器）

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-05-19T05:29:18.310

当我想包含一个由 Matlab 生成的 dll 文件时，我遇到了保存问题。最后我通过复制一个 .ctf 文件（我想这意味着证书）和一个 .netmodule（正确操作 .dll 所需的）以及 .dll 文件来解决它。这确实奏效了！所以，我的建议是检查 .dll 是否需要任何其他文件来处理。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2010-10-12T16:40:03.330

Windows 7 旗舰版 32 Visual Studio 2008 SQL Server v2005

我收到了同样的错误。我决定删除并重新添加项目引用。我无法将它们添加回来，因为每个引用项目中的数据库引用都是空白的。

一旦我将数据库引用重置为正确的设置，我就可以毫无问题地进行构建。此外，这是我在 VSS 中分支源代码后第一次尝试重建这个项目。

祝你好运

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2013-05-01T23:06:13.433

我遇到了这个错误，它是由我的项目依赖项之一引起的，其中项目中的程序集名称已更改，但引用未更新。因此更新引用或重命名程序集将修复它。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2013-05-09T12:04:33.233

EE - 在我的情况下，问题出在具有实体框架的项目中，打开图表将任何表拖动 2 厘米 :) 并保存，VS 将更新他到数据库的所有链接......构建这个项目并构建解决方案, 构建。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2013-11-28T09:49:17.123

唯一解决我问题的事情（因为我没有在管理员帐户上运行 VS2010）是手动将环境变量 VS120COMNTOOLS 从系统变量移动到用户变量。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2014-05-05T14:39:38.810

从您的 .csproj 文件中删除不再存在于源代码控制和文件系统中的所有源文件的条目对我有用。

* * *

**详细做法：**

好吧，我下面的答案不仅仅是对所有解决方案的总结，而且还提供了更多。

**第 (1) 节：**

**一般解决方案：**

我有 4 个此类错误（“找不到元数据文件”）以及 1 个错误说“无法打开源文件（'未指定错误'）”。

我试图摆脱“找不到元数据文件”错误。为此，我阅读了许多帖子、博客等，发现这些解决方案可能是有效的（在这里总结它们）：

1.  重新启动 VS 并再次尝试构建。

2.  转到**“解决方案资源管理器”**。右键单击解决方案。转到**属性**。转到**“配置管理器”**。检查是否选中了**“构建”**下的复选框。如果其中任何一个或全部未选中，则检查它们并再次尝试构建。

3.  如果上述解决方案不起作用，则按照上面步骤 2 中提到的顺序，即使所有复选框都已选中，也不要选中它们，再次选中并尝试再次构建。

4.  **构建顺序和项目依赖关系：**

    转到**“解决方案资源管理器”**。右键单击解决方案。转到**“项目依赖项...”**。您将看到 2 个选项卡：**“依赖项”**和**“构建顺序”**。此构建顺序是构建解决方案的顺序。检查项目依赖项和构建顺序以验证是否某个依赖于其他项目（例如“project2”）的项目（例如“project1”）正在尝试在该项目（project2）之前构建。这可能是错误的原因。

5.  **检查丢失的 .dll 的路径：**

    检查丢失的 .dll 的路径。如果路径包含空格或任何其他无效路径字符，请将其删除并再次尝试构建。

    如果这是原因，则调整构建顺序。

    * * *

**第 (2) 节：**

**我的特殊情况：**

我用各种排列和组合尝试了上述所有步骤，并重新启动了几次 VS。但是，它对我没有帮助。

所以，我决定摆脱我遇到的其他错误（'源文件无法打开（'未指定的错误'）'）。

我遇到了一个博客： [http ://www.anujvarma.com/tfs-errorsource-file-could-not-be-opened-unspecified-error/#comment-1539](http://www.anujvarma.com/tfs-errorsource-file-could-not-be-opened-unspecified-error/#comment-1539)

我尝试了该博客中提到的步骤，我摆脱了错误**“无法打开源文件（'未指定错误'）”**，令人惊讶的是，我也摆脱了其他错误**（“找不到元数据文件”）**。

* * *

**第 (3) 节：**

**故事的道德启示：**

尝试上面第 (1) 节中提到的所有解决方案（以及任何其他解决方案）以消除错误。如果没有任何结果，根据上面第 (2) 节中提到的博客，***从您的 .csproj 文件中删除所有不再存在于源代码控制和文件系统中的源文件的条目***。

* * *

# asp.net - 如何使用 ASP.NET 主题为特定媒体指定样式表？

> ID：329144
> 
> 赞同：2
> 
> 时间：2008-11-30T18:12:39.753
> 
> 标签：asp.net, themes

这是 dot.net.nz 的本地用户组邮件列表中提出的问题...

> 当我以老式方式创建 XHTML 页面时，我曾经对我的 CSS 声明使用以下语法：

```
<link rel=”stylesheet” type=”text/css” media=”screen” href=”css/screen.css” />

<link rel=”stylesheet” type=”text/css” media=”print” href=”css/printer.css” /> 
```

> 现在，因为我使用 ASP.NET 2.0 及更高版本进行编码；我爱上了主题。但是，我不知道如何使用主题来做同样的事情。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-30T18:51:31.550

您应该在 CSS 文件中定义媒体：

```
@media print
{
    p
    {
        ...
    }

    ...put styles here.
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T18:50:13.500

您可以在样式表中声明媒体类型。例如，printer.css：

```
@media print
{
    /* Print CSS rules here */
} 
```

# apache - 重写规则 - 走出 docroot

> ID：329145
> 
> 赞同：1
> 
> 时间：2008-11-30T18:13:18.863
> 
> 标签：apache, .htaccess

假设以下目录结构，

```
htdocs/
  images/
  css/
  .htaccess
system/
  index.php
  ... 
```

我想通过该 php 脚本路由所有传入的请求。我一直在尝试 htaccess 中的一些重写规则，但我似乎无法路由到文档根目录之外的文件。我在 apache 手册中找不到这样做的原因，所以最终求助于“包含”一个规则不同的 apache 配置文件。

有没有办法在 docroot 之外重写？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-30T18:43:00.100

许多框架所做的是使用重写将所有请求路由到一个文件，您可以在其中进行更复杂的路由。一个示例 .htaccess 文件可能是：

```
# ignore anything that's an actual file (eg CSS, js, images) 
RewriteCond %{DOCUMENT_ROOT}%{REQUEST_URI} !-f
# redirect all other traffic to the index page
RewriteRule ^.*$ index.php [L] 
```

index.php 位于您的文档根目录 (htdocs/index.php) 中，您可以从中安全地在适当的位置包含 System/index.php。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-30T18:39:22.337

不，您不能在没有潜在巨大风险的情况下在 docroot 之外进行路由。

您应该将其`index.php`放在`htdocs`文件夹内并在那里重写，而不是在外面。如果您要重写以处理索引，在 docroot 之外访问，并且您犯了一个小错误，那么任何重写请求字符串的黑客都可能利用它。不漂亮！

# javascript - 总是使用 jquery 选择器或将它们缓存在变量中？

> ID：329151
> 
> 赞同：6
> 
> 时间：2008-11-30T18:21:01.360
> 
> 标签：javascript, jquery, performance

jQuery 选择器很棒，但有时我发现自己一遍又一遍地输入它们，这有点烦人。

```
 $('#mybutton').click(function() {
    $('#message-box').doSomething();
    $('#message-box').doSomethingElse();
    $('#message-box').attr('something', 'something');
 }); 
```

所以我经常喜欢将我的对象缓存在变量中：

```
$('#mybutton').click(function() {
    var msg = $('#message-box');
    msg.doSomething();
    msg.doSomethingElse();
    // you get the idea 
}); 
```

这两种模式之间有什么优缺点吗？有时感觉创建变量是额外的工作，但有时它为我的手指节省了很多打字时间。是否有任何内存问题需要注意？选择器在使用后是否可以很好地清理，而我的不良编码习惯往往会使变量在内存中保留更长时间？

这不会让我夜不能寐，但我很好奇。谢谢。

编辑：请看[这个问题](https://stackoverflow.com/questions/291841/does-jquery-do-any-kind-of-caching-of-selectors)。它本质上问的是同样的事情，但我更喜欢这个答案。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-30T18:24:18.453

你应该链接它们：

```
$('#mybutton').click(function() {
  $('#message-box').doSomething().doSomethingElse().attr('something', 'something');
 }); 
```

如果您需要一遍又一遍地做某事并且函数不返回 jQuery 对象，将它们保存在 var 中会更快。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-30T19:52:28.960

我通常按​​照 Pims 的回答链接它们，但是有时当一次要完成很多操作时，链接可能会导致可读性问题。在这些情况下，我将选定的 jQuery 对象缓存在一个变量中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-30T18:24:29.747

我说去吧！

我和你做同样的事情。

它使我的代码更具可读性，这让我很高兴。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-04-24T11:12:03.867

其实这个问题要复杂得多。

1.  链接并不总是可行的，因为选择器字符串或缓存的 jQuery 选择器实例可能存储在新的 function() 属性中，由各种原型函数访问，而不是单个代码。

2.  您可以链接选择器字符串和缓存的 jQuery 选择器。我猜想使用选择器字符串作为“this”属性应该会带来更慢但更少消耗 RAM 的代码，而使用缓存选择器应该带来更快但更消耗 RAM 的代码。我对吗？

我即将将很多新的 function() 属性从选择器字符串更改为缓存的选择器，这就是我问的原因。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-12-27T16:34:05.070

Pim Jager 对于这种特定情况是 100% 正确的，但指出在某些情况下缓存更合适可能会很有用。

首先，每次调用 $('something') 时，您都在重新实例化整个 jQuery 对象，因此每当您要对 jQuery 对象执行多个操作时，都会调用链接或缓存。

如果你在闭包中要做的只是对对象采取行动，那么链接就是你的朋友，而 Pim Jager 的代码就是正确的。但是，如果您要评估该对象的某些部分，您将无法链接这些操作和缓存，正如原始发布者的第二个代码块所示，实际上是要走的路。例如：

```
$('#mybutton').click(function() {
    var msg = $('#message-box');
    msg.doSomething();
    if (msg.hasClass('.something')) {
        msg.dosomethingElse();
    }
}); 
```

有趣的资源：http: [//jsperf.com/jquery-chaining-vs-caching](http://jsperf.com/jquery-chaining-vs-caching)

# web-applications - 我应该先设计应用程序还是模型（数据库）？

> ID：329160
> 
> 赞同：17
> 
> 时间：2008-11-30T18:27:49.130
> 
> 标签：web-applications

我正准备在业余时间开始构建一个新的 Web 项目，以实现一个在我脑海中盘旋了一段时间的想法。

我从来没有想过我是先构建模型然后再构建消费应用程序更好，还是相反。

最佳实践是什么？你会首先构建什么，为什么？

我想一般来说，应用程序通常应该驱动模型，但是像许多网站这样的应用程序在没有模型的情况下真的做不了什么。

出于某种原因，我发现有时从模型的角度思考更容易，因为应用程序实际上只是对模型的操作。这是一种糟糕的思考方式吗？

每个选项有什么优点/缺点？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-30T18:32:18.280

当您自己构建整个应用程序时，我将从用户开始。用户想要什么？他们需要什么信息？这应该推动应用程序和模型的设计，而不是相反。最初设计模型时，有一种将用户直接暴露给它的诱惑，这几乎没有意义。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-11-30T18:42:02.113

就个人而言，在我知道需求（正式与否）之后，我会设计数据模型来处理需求。然后从那里开始构建，包括业务层、持久性、单元测试，最后是 GUI。

如果您的数据库第一次设计正确，那么一切都应该顺利进行。

编辑-请注意，我并不是暗示您的业务层或 GUI 应该直接反映您的数据库模型。有时它会相似，有时则不会。但是您的数据库模型应该能够满足所有要求。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-12-01T01:24:33.267

首先，你的数据库不是你的模型，它只是你用来持久化模型的机制。您的模型是一组业务对象，封装了业务使用的状态和逻辑，并且可能被其他应用程序使用。

我发现大多数客户不了解表格、列，但了解流程和工作流程。因此，我与客户一起为需要在解决方案中解决的任务模拟 UI 和页面流。由此，我创建了业务对象来保存 UI 所需的数据。

控制器处理页面逻辑和页面流。我模拟了一个数据存储库来处理一些示例数据。这允许客户和我迭代 UI 和流程，直到我们满意为止。通常，我们会发现更好的做事方式，而他们认为重要的一些活动并没有增加任何价值。

现在是我处理数据库和数据访问逻辑的时候了。等到这一点可以减少重新设计数据库模式、存储过程和 DAL 代码的需要。

这通常会导致更少的代码、一个健壮的应用程序和一个快乐的客户。三冠王。

此外，对所有内容进行单元测试。您将进行更改，并且良好的单元测试集可确保您在进行更改时不会破坏应用程序的其他部分。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-12-01T16:36:37.593

你知道，我认为我必须不同意那些盲目地将 GUI 的设计置于底层数据模型之前的人。在真实的商业环境中，运营业务不仅仅是工作流——一个围绕数据分析和报告的巨大业务组成部分。毕竟，您如何根据无法获得或无法理解的数据做出决策？最重要的是，当您与客户坐下来时，90% 的时间，他们不了解他们的应用程序需要做什么，需要如何布局，而有一半的时间，他们甚至不了解什么它需要的功能。

如果您的整个数据模型只是屏幕数据的持久性，您将如何分析您的数据？你如何报告？如果您与数据库专家坐下来告诉他们您想要从基本上代表您的 ViewState 的数据模型构建的报告，他们会退出并告诉您自己做 - 至少，如果有人告诉我必须构建报告基于这种类型的模型，我会退出并告诉他们让其他人去做。

位于数据模型之上的 GUI 是附带的，它允许员工以最简单最有效的方式与数据交互。请记住，软件用户不是程序员，他们不会像程序员或数据库架构师那样思考，他们不会按照我们的工作方式工作；他们也不想。他们希望能够根据日常工作流程以最合乎逻辑的方式轻松输入数据。他们希望能够思考，我今天能完成多少工作，这样当我回家时，我就不必和我一起工作了，他们想去度假而不用担心新来的人是否能够留下来跟上流程，或者他们是否能够理解该软件。

企业主希望能够以最简单最有效的方式获取数据，他们希望立即编写报告，并且他们希望这些数据以逻辑、有效和有代表性的方式表示他们为当前报告选择的任何模型。他们不太关心工作流程，他们不需要知道这条数据流经了多少部门，从哪里来，如何到达现在的位置。他们想知道数据是什么，它代表什么以及它对整个企业意味着什么。

对于企业主来说，数据远比软件重要。对于有压力在十倍的时间内做十倍的最终用户，软件需要为他们提供一种在最短的时间内将尽可能多的数据输入数据库的方法。

那么，您如何决定首先设计哪一个，GUI 还是数据模型？从长远来看，将节省多少钱？公司是否有 500 名用户将数据输入到该软件中，他们是否以最有效的方式进行操作？公司是否有 500 名报告编写者，他们能否快速有效地获取数据？一段绳子有多长？

为数据分析师设计您的数据模型——使其尽可能简洁、高效，以全面的格式获取数据。

为最终用户设计您的 GUI，并使其尽可能干净、简单和高效，让这些用户无需成为火箭科学家即可尽可能快速、尽可能简单地将尽可能多的数据输入您的数据库。与编写软件和提取数据的人相比，最终用户通常几乎没有计算机知识。

从一开始，请始终牢记您将如何将两者连接在一起，因为如果您不这样做，您最终会得到两端并且无法提供中间点，您的项目将分崩离析......

将数据放入系统并获取数据比编写在两端之间进行接线的软件浪费更多的钱。一个开发团队的成本几乎不等于用户输入不准确数据和低质量报告的公司所花费的成本，因为数据分析师无法有效地获取这些不准确的数据并花费一周时间编写实际上不应该的报告花费一两个多小时，而且写下来也无济于事。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-30T18:44:16.947

两者怎么样？

另一种方法是“基于功能”的开发——在应用程序中构建一个垂直切片，在模型、持久性和接口级别上足以让功能完全工作。这可能就像登录或编辑单个对象一样简单。

这种方法意味着：

*   您可以预先构建一小部分模型和应用程序；
*   您可以快速发现您选择的技术和设计堆栈中的任何危险区域；
*   你很快就有了可以展示给人们评论的东西；
*   你避免了任何东西第一次设计就正确的谬论......

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-11-30T19:24:55.570

*FWIW，布鲁克斯的神话人物月中*最令人难忘的部分之一是：

> 给我看你的流程图，隐藏你的表格，我会继续迷惑，给我看你的表格，我通常不需要你的流程图；他们会很明显。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-11-30T18:33:12.130

大多数 Web 应用程序不只是处理和呈现不同类型的数据。

我会从这个开始：我要处理什么数据？

之后，您可以开始对这些数据如何最适合数据库进行建模。

然后你还应该考虑如何访问这些数据——它是否给你任何优化存储的提示？

我会在最后设计应用程序本身，甚至与之并行。应用程序设计应该独立于数据库模型。只有代码本身最终会访问数据库。

但是，Web 应用程序也趋于增长。因此，向数据库添加新字段或表并围绕它构建新代码的进化模型非常常见。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-11-30T18:34:20.193

您不希望您的对象模型受到数据库设计的约束。数据库应该是对象模型的持久性实现，它是规则。您可以将应用程序包装在对象模型周围，还可以派生持久性模型。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-11-30T18:36:20.207

您可以从设计应用程序和模型之间的接口开始，并为接口的行为编写单元测试。在我开始编写代码之前，我通常会采用更敏捷的方法并且只做一点前期设计（请参阅：Pragmatic Programmers From Journeyman to Master Tracer Bullets 概念）。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-11-30T18:48:22.880

根据 Martin Fowler 的说法，大多数熟练的开发人员将其视为这些问题中的“权威”之一，您首先设计您的 OO 层次结构，然后使用例如 ActiveRecord 设计模式将对象“映射”到您的数据库中......

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-11-30T18:33:13.333

嗯，在某种程度上，要求*必须*是第一位的。毕竟，数据库是您需求的仆人，而不是相反。

在我看来，您真正要问的是：您是否应该在开始使用数据库之前*完全*设计应用程序（然后再编写代码）？

我的回答是否定的。最好跳进去并迅速行动。

我可能会粗略地设计应用程序，然后使用迭代方法。[这是来自Agile](http://en.wikipedia.org/wiki/Agile_software_development)的一个想法。关于这个主题有很多。

现在，如果这是一个有 20 名开发人员、利益相关者和预算的为期两年的项目，事情会有所不同......但也许并没有你想象的那么不同！您处理的复杂性越多，就越难预先创建一个完美的、单一的计划。

[有人说，在某一点上，它实际上变得不可能。](https://rads.stackoverflow.com/amzn/click/com/0201433230)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-08T03:48:36.840

无论哪种方式都可以，但我个人越来越倾向于从 UI 设计。

主要原因归结为能够创建支持性的自动化测试。

自动化测试的优势之一是可以灵活地随时重构和更改代码。然而，用户界面通常是最难更改的，并且通常需要最多的工作才能正确完成。

因此，出于这个原因，我主张设计 UI，使其尽可能接近最终版本，然后向后移动创建中间和后端以支持在该 GUI 中执行的操作。

有了相对稳定（且难以测试）的 UI，一旦您对它们进行了良好的测试覆盖，您就可以自由地以更大的灵活性来塑造其他层。

如果您从数据库开始进行设计，您最终会得到一个稳定、易于测试的数据库，并且会花很多时间让 GUI 恰到好处地匹配您对 DB 所做的事情——这最终会花费很多时间更长时间，因为您对最难测试且测试覆盖率最低的系统级别进行了最多更改。

再加上数据库驱动设计的应用程序最终没有个性并且难以使用这一事实。它们看起来就像每个屏幕的相同 MS Access 表单，除了不同的字段。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-03-29T18:38:19.683

从经验来看，首先设计数据库（根据需求）可以使事情进展得非常顺利。

如果您的数据不仅与在 UI 中输入的数据相关，而且可能包括与项目相关或为项目导入的预先存在的数据，则尤其如此。

在一个中型项目中，我可能会使用 Erwin 或 Power SQL 等 ERD 图表工具对 DB 进行 100 多次迭代。然后，单击 forward-engineer 按钮以获取 DDL。

域对象通常看起来很像您的主表，但是它们通常具有数据库具有查找表等的集合。此外，出于组织目的等，您的域对象中可能包含其他对象。

然后连接您选择的手卷或 ORM 的 DAL。

问题是，旨在自动化此过程的工具似乎都没有 100% 做到这一点。在代码乌托邦中，我想您可以创建数据库模型并创建完美的域模型，反之亦然，然后单击几下即可获得完美的 ORM。实际上，这比听起来要困难得多，并且可能会出现诸如性能和灵活性之类的微妙问题。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-30T21:11:37.723

我的战术大致是这样的：

阅读要求，并在文档中写下所有名词或“玩家”。这些通常是您需要存储或交互的 80% 的东西。

把这些东西放在一张纸上，再读一遍要求，看看你是否能发现你在纸上的东西实际上可以用来完成这项工作。

，找到它们的属性并制作数据模型。尝试将其放入数据库中。从那里建立起来。

对于 Web 应用程序，这通常对我有用（即使对于相当大的应用程序）。正如您所注意到的，我没有使用UML 或ERD 之类的术语。这些只是用于将您脑海中的模型与他人交流的工具。Powerpoint 也可以做到这一点。重要的是最终产品的质量。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-12-01T02:39:13.210

对我来说，这取决于以前对问题域的经验。

如果我以前做过这种应用程序，我更有可能先花时间澄清数据模型，然后在此基础上开始构建代码。

在第一次项目中，我更有可能只是参与编码，根据需要生成虚拟数据，并在进行过程中了解问题域的隐藏维度。经常会有难以预料的数据类别。当我发现这些时，我会修改数据模型并继续。通常，这种方法首先编写一个脚本来构建数据库并填充它。这样，在随后的迭代中，我只需修改 db-build 脚本并运行它，我就可以重新开始工作了。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-12-01T03:00:01.517

这是一个古老的问题。答案，就像每个 CS 答案一样，视情况而定。您编写的 90% 的应用程序只是基于数据的表单。在其中许多应用程序中，您将拥有带有数据的遗留应用程序，您必须从那里移植过来。因此，无论您喜欢与否，数据/数据库都是一个限制因素，它驱动您所做的任何事情。它*不仅仅是*一个存储域对象的地方，它还是你的域，尽管这不是“正确”的做事方式。

在大多数情况下，我首先设计我的数据模型的方式是获取现有数据并将其组织到关系模型中。然后我做基本的屏幕设计。然后我构建了我贫血的 Active Record 类型的业务对象来连接它们。这绝不是设计软件的最佳方式，但在大多数情况下，它是事情将要完成或已经完成的方式。在这些情况下，您的业务对象实际上只是数据容器，它们周围有业务逻辑，以将它们连接到屏幕并确保数据完整性和屏幕安全性。这很*糟糕*，但它就是这样。

如果屏幕交互是最重要的事情，那么也许先设计屏幕，然后让其他对象依赖于您，这将是您最好的选择。

如果您有幸拥有一个新项目，其中域在应用程序中是不可或缺的，并且数据库只是您的域对象的持久性机制，那么我将首先在 TDD 庄园中使用域驱动设计开发域对象并开发屏幕和域对象周围的数据库。我希望*更*频繁地编写这样的代码，但在大多数地方你并不总是有机会。

注意： Stack Overflow 是在数据库中作为模型方式设计的，所以它不会*那么*邪恶。

# .net - 在 .NET 中检测（未知）硬件

> ID：329164
> 
> 赞同：0
> 
> 时间：2008-11-30T18:32:51.010
> 
> 标签：.net, c++, hardware

我需要一些关于如何使用 .NET 和 C++/C# 检测未知硬件的指示。我正在寻找在 NET 下使用的技术来做到这一点。

我基本上想要的是识别机器中所有硬件的 PCIID/USBID 等等。当然，对于尚未安装驱动程序的硬件，我也需要它。

我相信这将在某个地方的 Windows DDK 中，但是我从哪里开始呢？任何指针将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T19:48:15.333

我认为您会参与很多 P/Invoke-ing，但我确实会从[WDK](http://www.microsoft.com/whdc/devtools/wdk/WDKpkg.mspx)（以前称为 DDK）开始。

我先看看`devcon.exe`。二进制在`tools\devcon`; 来源在`src\setup\devcon`。

# performance - 什么是 FLOP/s，它是衡量性能的好方法吗？

> ID：329174
> 
> 赞同：48
> 
> 时间：2008-11-30T18:41:18.590
> 
> 标签：performance, benchmarking, flops

我被要求测量在多 CPU 系统上求解微分方程的 fortran 程序的性能。我的雇主坚持要我测量 FLOP/s（每秒浮动操作）并将结果与​​基准（[LINPACK](http://www.netlib.org/linpack/)）进行比较，但我不相信这是要走的路，仅仅是因为没有人能向我解释什么是 FLOP。

我对 FLOP 到底是什么做了一些研究，得到了一些非常矛盾的答案。我得到的最受欢迎的答案之一是“1 FLOP = 加法和乘法运算”。真的吗？如果是这样，再一次，在物理上，这到底意味着什么？

无论我最终使用什么方法，它都必须是可扩展的。某些版本的代码解决了具有数百万个未知数的系统，并且需要数天才能执行。

在我的案例中，还有什么其他有效的测量性能的方法（我的案例总结是'fortran代码，它在数百个CPU上一遍又一遍地进行大量算术计算）？

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2008-11-30T18:53:45.227

这是一个相当不错的性能衡量标准，只要您准确了解它衡量的是什么。

顾名思义，FLOPS 是每秒浮点操作数，确切的构成 FLOP 的内容可能因 CPU 而异。（例如，一些 CPU 可以将加法和乘法作为一项操作执行，而其他 CPU 则不能）。这意味着作为性能衡量标准，它非常接近硬件，这意味着 1）您必须了解您的硬件才能在给定架构上计算理想的 FLOPS，并且您必须了解您的算法和实现才能弄清楚如何它实际上包含许多浮点操作。

在任何情况下，它都是检查 CPU 使用情况的有用工具。如果您知道 CPU 在 FLOPS 中的理论峰值性能，您就可以计算出您使用 CPU 的浮点单元的效率，这通常是难以有效利用的单元之一。运行 CPU 能够执行的 30% 的 FLOPS 的程序有优化的空间。除非您更改基本算法，否则以 70% 运行的算法可能不会变得更有效率。对于像您这样的数学密集型算法，这几乎是衡量性能的标准方法。您可以简单地测量程序运行所需的时间，但这会因 CPU 的不同而有很大差异。但是如果你的程序有 50% 的 CPU 使用率（相对于峰值 FLOPS 计数），那是一个更恒定的值（它'

但是知道“我的 CPU 能够达到 X GFLOPS，而我实际上只实现了 20% 的吞吐量”在高性能软件中是*非常有价值的信息。*这意味着除浮点操作之外的*其他东西正在阻碍您，并阻止 FP 单元有效地工作。*而且由于 FP 单元构成了大部分工作，这意味着您的软件有问题。

衡量“我的程序在 X 分钟内运行”很容易，如果你觉得这是不可接受的，那么可以肯定，你可以去“我想知道我是否可以砍掉 30%”，但你不*知道*这是否可能，除非您可以准确计算出正在完成的工作量，以及 CPU 在峰值时的能力。如果您甚至不知道 CPU 从根本上是否能够每秒运行更多指令，您想花多少时间来优化它？

很容易阻止 CPU 的 FP 单元被有效利用，因为 FP 操作之间有太多的依赖关系，或者有太多的分支或类似的东西阻碍了有效的调度。如果这是阻碍您实施的原因，您*需要*知道这一点。您需要知道“我没有获得应有的 FP 吞吐量，因此很明显，我的代码的其他部分正在阻止 FP 指令在 CPU 准备发出一条指令时可用”。

为什么需要其他方法来衡量绩效？按照老板的要求计算 FLOPS 数有什么问题？;)

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-11-30T19:53:48.927

我只想补充几点：

*   **分工**很特殊。由于大多数处理器可以在一个周期内进行加法、比较或乘法运算，因此这些都被计为一个触发器。但是分裂总是需要更长的时间。多长时间取决于处理器，但在 HPC 社区中有一种事实上的标准，将一个部门计算为 4 次失败。

*   如果处理器有一个**融合乘加**指令，它在一条指令中执行乘法和加法 - 通常是 A += B * C - 这算作 2 次操作。

*   始终小心区分**单精度**触发器和**双精度触发器**。能够处理这么多单精度 gigaflops 的处理器可能只能处理那么多双精度 gigaflops 的一小部分。AMD Athlon 和 Phenom 处理器的双精度触发器通常是单精度触发器的一半。ATI Firestream 处理器的双精度触发器通常是单精度触发器的 1/5。如果有人试图向您出售处理器或软件包，而他们只是引用失败而没有说明是哪一个，您应该打电话给他们。

*   术语 megaflop、gigaflop、teraflop 等是常用的。这些是指**1000**的因数，*而不是 1024*的因数。例如，1 megaflop = 1,000,000 flop/sec 而不是 1,048,576。就像磁盘驱动器大小一样，对此也有一些混淆。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2013-09-01T23:33:32.410

旧的问题，如果流行的话，答案不是很好，IMO。

“FLOP”是浮点数学运算。“FLOPS”可能意味着以下两种情况之一：

*   “FLOP”的简单复数形式（即“操作*X*需要 50 FLOPs”）
*   第一种意义上的 FLOPs*速率*（即每秒浮点数学运算）

在从上下文中不清楚的地方，通常通过将前者写为“FLOPs”而将后者写为“FLOP/s”来消除歧义。

**所谓的 FLOP 是为了将它们与其他类型的 CPU 操作区分开来**，例如整数数学运算、逻辑运算、按位运算、内存运算和分支运算，这些运算具有不同的成本（读作“花费不同的时间长度”）与他们。

“FLOP 计数”的实践可以追溯到科学计算的早期阶段，相对而言，FLOP 非常昂贵，每个都要占用许多 CPU 周期。例如，一个 80387 数学协处理器进行一次乘法运算需要大约 300 个周期。这是在流水线之前以及 CPU 时钟速度和内存速度之间的鸿沟真正打开之前的时间：内存操作只需要一两个周期，而分支（“决策制定”）同样便宜。那时，如果您可以消除一个 FLOP 以支持十几个内存访问，那么您就获得了收益。如果您可以消除一个 FLOP 以支持十几个分支，那么您就获得了收益。所以，**过去，计算 FLOP 而不必太担心内存引用和分支是有意义的，因为 FLOP 强烈地支配着执行时间**，因为它们相对于其他类型的操作而言非常昂贵。

最近，情况发生了逆转。FLOP 变得非常便宜——任何现代英特尔*内核*每个周期都可以执行大约两个 FLOP（尽管除法仍然相对昂贵）——并且内存访问和分支相对来说要昂贵得多：L1 缓存命中可能需要 3 或 4 个周期，从主存储器成本 150–200。考虑到这种反转，**消除 FLOP 以支持内存访问将不再会导致收益**。事实上，这不太可能。类似地，即使是多余的，“只做”一次 FLOP 也比决定是否做通常更便宜。这与 25 年前的情况几乎完全相反。

不幸的是，将 FLOP 计数作为算法价值的绝对衡量标准的做法在其销售截止日期之后仍然存在。**现代科学计算更多的是关于内存带宽管理**——试图让执行 FLOP 的执行单元*不断*地得到数据——而不是减少 FLOP 的数量。*对LINPACK*的引用（基本上已被*LAPACK淘汰*20 年前）让我怀疑你的雇主可能是一所非常古老的学校，没有内化这样一个事实，即建立绩效预期不再只是 FLOP 数的问题。如果具有更有利的内存访问模式和数据布局，则执行两倍 FLOP 的求解器仍可能比另一个快 20 倍。

所有这一切的结果是**计算密集型软件的性能评估变得比过去复杂得多**。由于内存操作和分支成本的巨大*变化*，FLOP 变得便宜的事实变得非常复杂。在评估*算法*时，简单的 FLOP 计数根本无法告知整体性能预期。

所谓的[屋顶线模型](http://dl.acm.org/citation.cfm?id=1498785)可能提供了一种更好的考虑性能期望和评估的方法，它远非完美，但具有让您**考虑浮点和内存带宽问题之间权衡的优势。同时**，提供更丰富、更有洞察力的“二维图片”，可以比较性能测量和性能预期。

值得一看。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-30T19:16:55.583

“将结果与基准进行比较”并做什么？

FLOPS 意味着你需要

1) 每个工作单元的 FLOPs。

2) 该工作单元的时间。

假设您有一些输入文件通过某个循环执行 1,000 次迭代。循环是一个方便的工作单元。它被执行了 1000 次。需要一个小时。

循环有一些加法和乘法，还有一些除法和平方根。您可以计算加法、乘法和除法。您可以在源代码中计算它，查找 +、* 和 /。你可以从编译器中找到汇编语言的输出，并在那里计算它们。你可能会得到不同的数字。哪一个是对的？问你的老板。

您可以计算平方根，但您不知道它在乘法和加法方面的真正作用。因此，您必须执行基准乘法与平方根之类的操作，以了解平方根需要多长时间。

现在您知道循环中的 FLOPS。而且您知道运行 1,000 次的时间。你知道每秒 FLOPS。

然后您查看 LINPACK 并发现您的速度较慢。怎么办？你的程序不是 LINPACK，它比 LINPACK 慢。很有可能您的代码会变慢。除非您的代码是在与 LINPACK 相同的年数内编写和优化的，否则您的速度会变慢。

这是另一部分。您的处理器针对各种基准测试有一些定义的 FLOPS 评级。您的算法不是这些基准之一，因此您达不到基准。这很糟糕吗？或者这是不是基准的明显后果？

可行的结果是什么？

针对某些基准代码库的测量只会告诉您您的算法不是基准算法。已成定局，你会有所不同；通常较慢。

显然，针对 LINPACK 进行测量的结果将是 (a) 你与众不同，因此 (b) 你需要优化。

只有当对*自己*进行测量时，测量才真正有价值。不是一些假设的指令组合，而是您自己的指令组合。衡量自己的表现。做出改变。看看你的表现——与你自己相比——是变好还是变坏。

翻牌没关系。重要的是每单位工作的时间。您永远无法匹配硬件的设计参数，因为您没有运行硬件设计人员所期望的基准。

LINPACK 无关紧要。重要的是您的代码库以及您为改变性能所做的更改。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-30T18:51:37.617

正如您所说，FLOPS 是每秒一次的浮点运算。举个例子，如果你只花一秒钟的时间进行一个操作（比如加、减、乘或除两个值并返回结果），你的性能只是 1 FLOPS。最近的 CPU 将轻松实现数 GigaFLOPS，即每秒数十亿次浮点运算。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-12T18:01:05.020

我只想让它尽可能快地运行，这需要找出它在哪里花费时间，特别是如果有可以避免的函数调用。

我通过一种简单的方法来做到这一点，即在它运行时中断它几次，然后看看它在做什么。以下是我发现的类型：

*   大部分时间是在计算导数和/或雅可比行列式的过程中。大部分时间可以用于数学函数调用，例如`exp()`、`log()`和`sqrt()`。通常这些重复使用相同的参数，并且可以被记忆。（大幅加速。）

*   大部分时间都花在计算导数上，因为积分容差比必要的要小。（快点）

*   如果因为方程被认为是僵硬的而使用隐式积分算法（例如 DLSODE Gear），那么它们很可能不是，并且可以使用像 Runge-Kutta 这样的算法。（DVERK）。（还是更快）

*   如果模型是线性的 (DGPADM)，则可能使用矩阵指数算法。这在性能和精度方面都是一个巨大的胜利，并且不受刚度的影响。（快得多）

*   在调用堆栈的上层，可能会使用稍微不同的参数重复执行相同的积分，以确定解决方案相对于这些参数的正向或中心差梯度。如果微分方程本身是可微的，则有可能通过分析或通过使用灵敏度方程增加方程来获得这些梯度。这不仅更快，而且更精确，这可以加快堆栈中更高的速度。

您可以将堆栈的每个级别视为寻找优化事物的机会，并且加速会更加复杂。然后，当您使用多 CPU 时，假设它是可并行化的，那么它应该提供自己的乘法因子。

所以回到翻牌圈。您可以尝试*最大化* ，但通过在堆栈的所有级别进行优化，*最小化*`FLOPs / second`也可能更有用。无论如何，仅仅*测量*它们几乎不会告诉你任何事情。 *`FLOPs / run`*

 *** * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-30T18:52:19.580

你的雇主是对的。
衡量 Fortran 程序（或任何其他程序，顺便说一句）有效性的唯一方法是根据标准基准测试它（如果存在）。

而且，关于 FLOP，它代表“每秒浮点运算”——参见 Wikipedia 上的[定义](http://en.wikipedia.org/wiki/FLOPS)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-30T19:06:07.387

我认为测量 FLOPS 不会很有用。

达到的 FLOPS 数将告诉您算法保持 CPU 的繁忙程度，但不会告诉您算法本身的执行情况。

您可能会发现两种不同的算法会导致处理器执行相同数量的 FLOPS，但其中一种算法可以在一半的时间内为您提供所需的结果。

我认为您最好查看一个“更高级别”的统计数据，例如每单位时间求解的微分方程的数量（毕竟，这是您算法的目的）。

另一方面，测量实现的 FLOPS 数量可能会帮助您改进算法，因为它会告诉您保持 CPU 的繁忙程度。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-10-07T14:59:21.170

**如何测量 T-FLOPS**

```
"(# of parallel GPU processing cores multiplied by peak clock speed in MHz multiplied by two) divided by 1,000,000 
```

公式中的第二个源于这样一个事实，即某些 GPU 指令每个周期可以提供两个操作，并且由于 teraFLOP 是衡量 GPU 最大图形潜力的指标，我们使用该指标。

Let's see how we can use that formula to calculate the teraFLOPS in the Xbox One. The system's integrated graphics has 768 parallel processing cores. The GPU's peak clock speed is 853MHz. When we multiply 768 by 853 and then again by two, and then divide that number by 1,000,000, we get 1.31 teraFLOPS."

[https://www.gamespot.com/gallery/console-gpu-power-compared-ranking-systems-by-flop/2900-1334/](https://www.gamespot.com/gallery/console-gpu-power-compared-ranking-systems-by-flop/2900-1334/)

* * *

**Price comparison of GPUs from 2016:** "These are theoretical performance figures, which we understand to generally be between somewhat optimistic and ten times too high. So this data suggests real prices of around $0.03-$0.3/GFLOPS. We collected both single and double precision figures, but the cheapest were similar."

[https://aiimpacts.org/current-flops-prices/](https://aiimpacts.org/current-flops-prices/)

# php - 在 PHP Web 应用程序中编写报告

> ID：329181
> 
> 赞同：0
> 
> 时间：2008-11-30T18:50:53.907
> 
> 标签：php

多年来，我一直在 ASP.Net 中开发业务应用程序，基本上是 CRUD，并且有兴趣学习另一种语言和平台。

在几次访问 Borders 并在网上浏览了一下之后，我没有发现太多关于用 PHP 生成报告的内容。我至少可以想象如何生成 Excel 电子表格文件，但没有找到任何关于生成可以打印或保存的专业外观报告的参考，最好是 PDF 文件。这些报告将包括商业发票、库存报告等。

报告的质量是我的客户用来判断应用程序质量的主要标准之一。ASP.NET 用自己的报表控件很好地涵盖了这一点，此外还有 Telerik、Crystal Reports 等。

谁能提供一些关于如何在 PHP Web 应用程序中生成报告的信息？第三方控件、具有良好章节的书籍、网络文章等都将受到欢迎。

非常感谢迈克·托马斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T18:54:50.903

听起来 ASP.NET 可能是完成这项工作的最佳工具，尤其是在您已经了解并使用相关工具的情况下。

为什么不找到与新语言相关的新事物呢？这样，您可以做两件事并且您知道（某些）2 种语言，而不是用 2 种语言知道 1 件事。

但是，如果您想使用 PHP 进行报告，fpdf 会让您从 PHP 输出 pdf。

[http://www.fpdf.org/](http://www.fpdf.org/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-30T22:52:41.500

非常感谢本伦利。我会更仔细地检查 fpdf 。在一天结束的时候，如果我不能做出一个像样的报告，我可能会在某个地方遇到一个严重的问题。

迈克·托马斯

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T23:07:54.963

查看[ezpdf](http://www.ros.co.nz/pdf/)。我用它来满足我所有的 PDF 需求，尽管我不会像你的意思那样生成报告。我认为 ezpdf 与 GD 库一起用于生成图表图形应该可以满足您的任何需求。

但是，如果 ASP 工具易于使用，这可能会走很长一段路。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-30T23:11:13.130

您可以使用 ClipPDF 并生成 PDF 和 Excel 报告，请查看 [http://www.theregister.co.uk/2007/12/10/pdf_excel_reports_with_php/](http://www.theregister.co.uk/2007/12/10/pdf_excel_reports_with_php/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-30T23:13:12.177

您还应该查看用于创建图形和图表的 eZ Components 库。

[http://www.ezcomponents.org/](http://www.ezcomponents.org/)

# ruby - Ruby Web 应用程序中的报告生成

> ID：329188
> 
> 赞同：3
> 
> 时间：2008-11-30T18:55:24.113
> 
> 标签：ruby

多年来，我一直在 ASP.Net 中开发业务应用程序，基本上是 CRUD，并且有兴趣学习另一种语言和平台。

在几次访问 Borders 并在网上浏览了一下之后，我发现在 Ruby / Ruby on Rails 应用程序中生成报告的内容不多。这些报告将包括商业发票、库存报告等。

谁能提供一些关于如何在 Ruby / Ruby on Rails Web 应用程序中生成报告的信息？第三方控件、具有良好章节的书籍、网络文章等都将受到欢迎。

非常感谢迈克·托马斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-01T04:11:50.933

也许是[鲁波特](http://rubyreports.org/)？

> 为 Rubyists 构建的简单、可扩展的报告系统

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T21:54:27.560

我一直在处理它的方式，似乎工作正常，是通过模型-视图-控制器处理报告，就像应用程序的任何其他部分一样。因此，例如，发票获得一个 Invoice 模型，可以通过 InvoicesController 访问并通过 invoices/:id 显示。Invoice 模型可能不会从 ActiveRecord::Base 继承，因为它没有（为了示例，我们假设）有一个表：它是 Customer、Order、Product、Price 和 OrderItem 的组合。

Invoice 模型获取所需的所有数据并提供派生值的方法，例如 total_amount。它由控制器创建，并由为您需要的任何格式编写的视图集整齐地呈现。

这有什么意义吗？我发现我的“报告”模型通常都非常整洁。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T04:45:19.120

我认为在 Ruby/Rails 中进行报告的方法是使用 prawn 和 prawnto 库。

这里有一些有趣的链接

[http://advent2008.hackruby.com/past/2008/12/17/awn_and_the_future_of_ruby_pdf_generation/](http://advent2008.hackruby.com/past/2008/12/17/awn_and_the_future_of_ruby_pdf_generation/)

[http://prawn.majesticseaacreature.com/](http://prawn.majesticseacreature.com/)

[http://cracklabs.com/prawnto](http://cracklabs.com/prawnto)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-30T19:45:12.080

看起来有一些选项可以帮助您入门。当然，这些不会与您可能习惯使用的 SQL Server Reporting Services 或 Business Objects 处于同一级别，但这是一个开始：

[http://www.google.com/search?hl=en&q=ruby+reports&btnG=Google+Search&aq=f&oq=](http://www.google.com/search?hl=en&q=ruby+reports&btnG=Google+Search&aq=f&oq=)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-30T22:48:23.317

非常感谢 - 这是一个好的开始。迈克，你的回答有点超出我的想象，因为我还没有真正开始，但它给了我一个开始的地方。

迈克·托马斯

# sql - SQLITE3 中的跨表更新

> ID：329197
> 
> 赞同：10
> 
> 时间：2008-11-30T19:03:32.943
> 
> 标签：sql, sqlite, sql-update

在`SQL Server`，我可以做这样的事情：

```
UPDATE tbl1 
   SET col2 = tbl2.col2 
  FROM table1 tbl1 
 INNER JOIN table2 tbl2 
    ON tbl1.col1 = tbl2.col1 
```

我没有费心去看看这是否是任何 SQL 标准的一部分，我确信还有其他方法可以做到这一点，但它非常*有用*。

这是我的问题。*我需要用 SQLITE3在 SQL*（即，不是宿主语言）中做类似的事情。可以做到吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2010-03-24T17:24:20.407

这适用于 sqlite：

```
UPDATE tbl1 SET col2 = (SELECT col2 FROM tbl2 WHERE tbl2.col1 = tbl1.col1) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-01-01T21:03:00.497

只是为了强调 Geogory Higley 的帖子：

我`UPDATE tbl1 SET col2 = (SELECT col2 FROM tbl2 WHERE tbl2.col1 = tbl1.col1)`在更新 tbl2 中不存在的 tbl1 中的列时遇到了问题。

[请参阅http://sqlite.phxsoftware.com/forums/p/1708/7238.aspx](http://sqlite.phxsoftware.com/forums/p/1708/7238.aspx)上的 cheetah 帖子，该帖子指向：

[http://www.mail-archive.com/sqlite-users@sqlite.org/msg27207.html](http://www.mail-archive.com/sqlite-users@sqlite.org/msg27207.html)

代码是：

```
insert or replace into foo (id, name, extra)
select bar.id, bar.name, foo.extra
  from bar 
  left join foo 
    on bar.id = foo.id; 
```

and this seems to work correctly. There seem to be many posts at different sites that recommend the first approach so it is a bit confusing. I would suggest you test your output very carefully if you use this method which does seem faster and may work with matched tables.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T19:22:16.417

我发现这可以用`INSERT OR REPLACE INTO`. 比 T-SQL 的等价物更冗长，但同样方便。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-30T21:37:51.777

值得一提的是，Microsoft SQL Server 和 MySQL 是唯一支持多表更新的数据库品牌，而且各自使用的语法也不相似。

此功能不是标准 SQL 的一部分。因此，对多表更新（和删除）的支持是非标准的，许多品牌不支持也就不足为奇了。

无论如何，我很高兴您找到了适合您任务的解决方案。

# asp.net - 大型网络农场的事件日志自动化/工具

> ID：329203
> 
> 赞同：1
> 
> 时间：2008-11-30T19:12:00.883
> 
> 标签：asp.net, exception, web-farm, event-log

我的一个好朋友在一家大型 asp.net 商店工作，该商店有一个带有许多网络服务器（数十个）的网络农场。应用程序将异常和消息记录到每个盒子上的事件日志中（而不是集中位置）。

有谁知道在许多不同的盒子上对事件日志执行统一报告的便捷方法？

或者，哪个更好： - 编写连接到每个盒子上的每个事件日志的工具？- 更改架构以将事件记录到数据库？- 其他一些我没有考虑过的机制？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T19:24:04.963

我会使用[Log4Net](http://logging.apache.org/log4net/index.html)（或类似的东西）进行日志记录，将文件保存到磁盘，并定期轮换日志文件。（我个人不是 Windows 事件日志的忠实粉丝。）然后在每个盒子上都有一个后台服务，它将日志文件上传到数据库表中 - 跟踪哪个日志条目来自哪个盒子。

这提供了对整个网络场的简单搜索，同时保留了有关哪些日志条目来自何处的信息。

类似的问题：

*   [“将服务器日志文件写入数据库是个好主意吗？”](https://stackoverflow.com/questions/290304/is-writing-server-log-files-to-a-database-a-good-idea)
*   [“Web 应用程序的日志记录”](https://stackoverflow.com/questions/327460/logging-for-web-application)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T20:11:44.617

我的 ASP.Net 开发团队的成员是 BareMetal 名为[Bare Tail](http://www.baremetalsoft.com/baretail/index.php)的免费软件的热心用户，当他们需要快速确定生产问题的根源时，可以读取纯文本日志文件。我相信您可以同时读取多个文件（在不同的选项卡上）。

如果需要，您仍然可以将日志文件数据上传到数据库。但是，写入和读取本地日志文件比写入数据库更快、更简单。而且，一旦 Web 应用程序在生产中稳定下来，最可能的异常来源很可能是数据库连接丢失。一种解决方法是尝试写入数据库，如果失败，则写入日志文件。然后，您可以使用这样的工具来更轻松地读取日志文件数据。

# iphone - UIView 边界与顶栏

> ID：329210
> 
> 赞同：2
> 
> 时间：2008-11-30T19:24:44.103
> 
> 标签：iphone, cocoa-touch, interface-builder

在界面生成器中创建带有导航栏的 UIView 时，顶部栏会占用一些空间，但视图仍然具有相同的大小。这意味着视图的底部是不可见的。

有没有办法获得 UIView 的“可见大小”？我想在屏幕底部显示一个子视图，但由于父视图位于屏幕“下方”，因此部分子视图被隐藏。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-30T19:38:19.753

您应该使用 IB 中的“struts-and-springs”控件将基本视图设置为完全对齐。然后它会自动调整大小。完成此操作后，您只需使用 view.bounds 属性即可访问其可见区域。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T23:31:08.083

您应该使用 Ben Gottlieb 的解决方案，但就计算名为“ `view`”的视图的可见区域而言，您可能可以使用：

```
CGRect viewBoundsInWindow =
    [[[UIApplication sharedApplication] keyWindow] convertRect:view.layer.visibleRect fromView:view]; 
```

# jquery - jQuery 和 TinyMCE 富文本编辑器的问题？

> ID：329213
> 
> 赞同：2
> 
> 时间：2008-11-30T19:25:52.540
> 
> 标签：jquery, tinymce

我正在尝试使用 Tiny MCE 编辑器。我们也使用 jQuery，我注意到标准的 Tiny MCE 安装包含一个名为`tiny_mce_jquery.js`. 谁能告诉我这是为了什么？奇怪的是，我在网上找不到任何关于它的信息。除了标准的 Tiny MCE 脚本之外，我还应该引用它还是代替它？它是否提供任何额外的东西或只是避免不兼容？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-30T19:39:52.123

如果您已经加载了 jquery 来替换标准 mce 脚本，我相信这是要使用的微型 mce 脚本。你不需要两者。

我在他们的开发者论坛中找到了这条[评论](http://tinymce.moxiecode.com/punbb/viewtopic.php?pid=28712)

> 我们已经向 API 添加了一些适配器，因此 TinyMCE 可以使用 jQuery API 来减小它的大小，但这目前是实验性的，我没有时间玩它，因为我们现在专注于核心 API 的稳定性。TinyMCE 将保持库独立，但这并不意味着我们仍然不能使用其他库作为内核的可选运行时。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T19:40:31.840

查看[更改日志](http://tinymce.moxiecode.com/js/tinymce/changelog.txt)，我看到了这一点：

```
Version 3.0a3 (2007-11-13)
Added new experimental jQuery and Prototype framework adapters to the 
development package. 
```

我猜是这样你就可以在tinymce框架中使用jquery了。一些[谈话](http://ajaxian.com/archives/tinymce-3-first-look)一直在讨论将 TinyMCE 转换为使用 jquery，但我相信在那个领域没有做任何事情。相反，人们专注于创建自己的解决方案，这些[解决方案](http://batiste.dosimple.ch/blog/2007-09-11-1/)肯定与 TinyMCE 的强大功能不匹配

要回答您的问题，您不需要在标准安装中引用它，除非您想使用一些 jquery 函数编写 TinyMCE 插件。

# javascript - 在运行时更改嵌套页面的样式表

> ID：329216
> 
> 赞同：1
> 
> 时间：2008-11-30T19:29:45.480
> 
> 标签：javascript, css, xhtml

首先，如果这没有意义，我深表歉意。我是 XHTML、CSS 和 JavaScript 的新手。

我收集到在 XHTML 中，拥有嵌套页面的正确方法如下（而不是 iframe）：

```
<object name="nestedPage" data="http://abc.com/page.html" type="text/html" 
width="500" height="400" /> 
```

如果我有这样的嵌套页面 - 是否可以使用父页面中的 JavaScript 在运行时更改嵌套页面使用的样式表？理想情况下，这会立即发生，这样嵌套页面将永远不会以其原始样式表可见。

请假设您无法控制嵌套页面的原始源代码，但它**在同一个域中**（不要问）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-30T20:27:34.397

```
d = document.getElementsByTagName('object').namedItem('nestedPage').getContentDocument();
d.styleSheets[d.styleSheets.length].href = 'whereever'; 
```

警告：尚未在所有浏览器中进行测试。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T19:46:09.130

我建议为此使用 iframe，我不知道是否也支持这样做的对象方式。

无论如何，在同一域的页面加载后，您可以通过 javascript 访问其所有属性。例如，在 jQuery 中，您将使用更改 css 文件。

```
$("link [rel=stylesheet]", myFrame).attr('href', <new-url>); 
```

使用 myFrame 引用您的 iframe 对象。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-01T19:02:55.190

几个指针。

不久前我对此进行了一些研究，发现了一些棘手的浏览器问题以及关于 Quirksmode 和 IIRC Dojo 邮件列表的一些好的解决方案和建议。它产生了以下库函数来应用我在主要浏览器中测试过的 CSS：

```
function applyCSS(css) {
  // http://www.quirksmode.org/bugreports/archives/2006/01/IE_wont_allow_documentcreateElementstyle.html
  if (BrowserDetect.browser=="Safari" || BrowserDetect.browser=="Opera") { /* good for FF too */
    var styleNode = document.createElement("style");
    styleNode.setAttribute("type", "text/css");
    styleNode.appendChild(document.createTextNode(css)); 
    head.appendChild(styleNode); 
  } else {
    var div = document.createElement("div");
    div.innerHTML = "<p>x</p><style>"+css+"</style>";
    document.body.appendChild(div.childNodes[1]);
  }
} 
```

如果您最终在 iframe 中执行此操作，[则此技巧](http://softwareas.com/injecting-html-into-an-iframe)可能会有所帮助（来自 TiddlyWiki 代码）：

```
var doc = iframe.document;
    if(iframe.contentDocument)
        doc = iframe.contentDocument; // For NS6
    else if(iframe.contentWindow)
        doc = iframe.contentWindow.document; // For IE5.5 and IE6
    // Put the content in the iframe
    doc.open();
    doc.writeln(content);
    doc.close(); 
```

上面的代码生成了一个包含一些内容的新 iframe。如果您只输出 iframe 一次并且您已经知道 CSS，那么您可以在输出 iframe 时发送一个标签。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-01T19:56:31.837

如果我们在同一个域中，请使用 XMLHTTPRequest 加载它，将响应文本放入带有 innerHTML 的隐藏 DIV 中，将隐藏 div 的 BODY 节点克隆到您想要内容的任何位置，然后删除隐藏 div。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-30T19:33:39.920

如果嵌套页面在您的域之外，恐怕跨域限制会阻止您摆弄它的样式表/html。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-30T19:34:18.467

如果嵌套页面在另一个域上是不可能的，由于 SOP（同源策略），javascript 不允许访问它

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-30T19:35:58.900

好吧，我可能很愚蠢，但你不使用`<iframe>s`类似的东西吗？

# functional-programming - 中型 Clojure 示例应用程序？

> ID：329221
> 
> 赞同：98
> 
> 时间：2008-11-30T19:34:44.753
> 
> 标签：functional-programming, clojure

是否有可以用作“最佳实践”示例的中型 Clojure 示例应用程序，以及查看此类应用程序在代码和代码组织方面的外观的好方法？Web 应用程序对我来说特别有趣，但最重要的是该程序可以做一些通常有用的事情（例如博客、错误跟踪、CMS），而不是我从未在现实中实现过的数学运算世界（解决 N 皇后问题、模拟生活、生成斐波那契数列，以及函数编程语言的常见票价）。

谢谢！

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-12-14T16:48:26.317

I recommend [cow-blog](http://github.com/briancarper/cow-blog) by Brian Carper. According to the author it was written with your purpose in mind.

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-11-30T19:45:29.100

如果您浏览[clojure-contrib](http://github.com/richhickey/clojure-contrib)源代码，您可以看到库是如何在 clojure 中实现的。

您还可以在同一源代码树下签出“ [ClojureScript ”。](http://github.com/richhickey/clojure-contrib/tree/master/clojurescript/)

> **允许用非常小的 Clojure 子集编写的代码自动转换为 JavaScript。**

ClojureScript 翻译器是一个完整的 Clojure 应用程序。

如果您还没有的话，我还建议您查看 Stewart Halloway 的[Port of Practical Common Lisp 示例到 Clojure 。](http://github.com/stuarthalloway/practical-cl-clojure/tree/master)

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-02-11T10:14:36.250

Take a look at [Compojure](http://github.com/weavejester/compojure/tree/master). It's a web framework written in Clojure, so it allows you to write and run (on an embedded Jetty) useful web apps in Clojure, and also serves as a good example of a sizable chunk of real-world Clojure code.

It's under active development and has a helpful [Google Group](http://groups.google.com/group/compojure).

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-11-30T20:34:14.337

查看 Clojure 的作者 Rich Hickey 编写的 ant 演示：

[http://clojure.googlegroups.com/web/ants.clj](http://clojure.googlegroups.com/web/ants.clj)

这里有一些很好的说明，可以将它与 emacs 开发环境一起设置：

[http://riddell.us/clojure](http://clojure.googlegroups.com/web/ants.clj)

另请查看与此代码一起使用的 Rich 的演示文稿：

[http://blip.tv/file/812787](http://clojure.googlegroups.com/web/ants.clj)

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-07-16T16:59:52.677

Clojure itself is a good example of Clojure best practices. Read towards the bottom of Core.clj, good stuff.

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2011-05-06T20:54:58.580

[http://4clojure.com](http://4clojure.com)

4Clojure is an [open source](https://github.com/dbyrne/4clojure) website where you can solve interactive fill-in-the-blank Clojure problems.

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-07-23T16:59:06.277

I think that Compojure is probably the best way to go for an example. I doubt it's a "medium sized" example, but there's probably subsections of it that are small that would work. At least, that's going to be my approach. *smiles*

Also, check out

[http://github.com/technomancy/mire/tree/master](http://github.com/technomancy/mire/tree/master)

which is a small m.u.d. client prototype built in clojure, the advantage being that it's totally self-contained, and probably pretty simple, including the concepts involved. Documentation, eh, it's jus' alright, but the concepts in the code tie very closely to the action elements of the M.U.D. that runs easily.

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2011-11-24T03:15:20.850

We're two years on from this question and, whilst that's still early in the cycle for a language, Clojure is definitely being used for serious production work. At World Singles, we have several thousand lines of Clojure in production that handle all sorts of general purpose tasks in our web platform - I blogged about this in my [Real World Clojure series](http://corfield.org/search/Real+World+Clojure).

For some reasonably large open source projects - not exactly applications, but high-profile infrastructure - you could look at [Storm from Twitter](https://github.com/nathanmarz/storm) and [Cascalog from BackType](https://github.com/nathanmarz/cascalog) (now part of Twitter). 4clojure.com has been mentioned as an open source web application, that's worth a look too, but note the [new github repo for 4clojure](https://github.com/4clojure/4clojure).

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-02-02T20:33:13.790

A positive sign: there is an [article on InfoQ](http://www.infoq.com/news/2009/01/clojure_production) about "one of the first published reports of Clojure being used in a large-scale production deployment." It doesn't appear to be open, but at least it is a sign of Clojure being used in a mission critical application in the real production world. A big step for the Clojure community.

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-07-16T15:33:51.133

[http://code.google.com/p/lighttexteditor/](http://code.google.com/p/lighttexteditor/)

You could try light text editor

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-10-15T12:41:12.657

You can take a look here: [http://bitbucket.org/kumarshantanu/blogjure/overview/](http://bitbucket.org/kumarshantanu/blogjure/overview/)

It is a tiny blog application written using Hibernate, Compojure and StringTemplate that actually works!

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-09-16T07:18:10.243

I can only recommend you to check out [Pedestal](http://pedestal.io), a very promising web framework, both server-side and client-side (where it facilitates ClojureScript). The gui stuff is a bit hard to grasp, but quite much the way it should be done to stay sane in a large app.

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2017-05-01T05:01:21.963

[edge](https://github.com/juxt/edge) is a moderately sized application showcasing structuring an application with Clojure, ClojureScript, Component, Yada, Aero, and Boot.

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-12-05T13:44:30.290

Clojure is still too young and a moving target to have medium sized applications with available source code yet.

# c# - WinForms.FontDialog 中缺少字体

> ID：329225
> 
> 赞同：3
> 
> 时间：2008-11-30T19:37:58.350
> 
> 标签：c#, winforms, fonts

当我显示 WinForms.FontDialog（C#、.NET 2.0）的一个实例时，我缺少一些我希望出现的字体（例如 Courier、Fixedsys、MS Sans Serif）。此外，一位客户抱怨他安装的 Adob​​e 字体也没有出现在列表中。

如何让这些字体显示在此对话框中？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-02T03:05:26.420

FontDialog 旨在仅显示 TrueType 字体以保持与 GDI+ 的兼容性。让它显示设备字体需要一些反射黑客：

```
using System.Reflection; 
```

...

```
FontDialog fontDialog1 = new FontDialog();

MethodInfo mi = typeof(FontDialog).GetMethod("SetOption", 
    BindingFlags.NonPublic | BindingFlags.Instance);
        mi.Invoke(fontDialog1, new object[] { 0x40000, false });
fontDialog1.ShowDialog(); 
```

我不知道这是否也启用了 Adob​​e 的 OpenType 字体，我没有。让我们知道。

# firefox - 您如何打包和自托管您的 Firefox 扩展程序？

> ID：329242
> 
> 赞同：3
> 
> 时间：2008-11-30T19:53:36.587
> 
> 标签：firefox, deployment, firefox-addon, add-on, signing

我正在开发一个特定于站点的 Firefox 扩展。addons.mozilla.org 的官方托管/更新机制强制我的用户登录以下载我的插件（直到它被批准为公共状态），这对我不利，特别是因为我的插件不太可能被认为对整个网络，并将永远卡在沙箱中。

似乎我被迫使用[McCoy](https://developer.mozilla.org/en/McCoy)（一个仅 GUI 的程序）来签署我的一些工件并使用 openssl 创建一个哈希，我在签署之前手动插入到 update.rdf 中。我真的很想拥有一些工具，我可以坚持在我的自动化构建过程中，而不需要我每次手动步骤。是否有一个开源工具可以模仿 addons.mozilla.org 的行为，我可以将其用于自托管？或者我可以在部署之前从我的构建中调用的一组命令行工具（在 OS X 上工作）？

很高兴有你在这个过程中的任何经历......你现在是怎么做的？你试过什么？什么有效，什么无效？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-30T22:36:53.123

您可以按照[此处](https://developer.mozilla.org/en/Signing_a_XPI)有关如何签署 XPI 文件的说明进行操作。您可以轻松地将这些步骤捆绑到一个脚本中，该脚本将作为您构建的一部分运行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T02:04:27.150

咬紧牙关并使用 SSL 证书是我最终要做的事情......如果您的 update.rdf 位于安全服务器上，更新过程和描述符似乎很容易工作......而且我不需要做任何事情超级喜欢我的构建过程。

你仍然需要哈希：

```
openssl sha1 plugin.xpi 
```

生成的哈希需要以 upgrade.rdf 结尾

```
<em:updateHash>sha1:b100d1207b38bbbea1add4eb96947ee4ea4b7a3e</em:updateHash> 
```

但是不再需要处理 mccoy 和所有签约的东西。

# c# - 如何在 C# 中缩小到可打印区域？

> ID：329252
> 
> 赞同：0
> 
> 时间：2008-11-30T19:59:44.283
> 
> 标签：c#, printing

问候，

我有问题（当尝试从 c# 打印到某些没有大打印区域的打印机时。有没有办法缩小到可打印区域（就像 Adob​​e Acrobat 一样）？谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-30T20:08:36.730

您可以确定图像的大小，然后确定打印区域的大小（从打印机设置和边距 - 如另一篇文章中所述），然后计算水平或垂直收缩的比率（以较高者为准，因此图像是未裁剪）。在绘制页面内容之前，在打印机图形上下文的比例变换中使用此比率。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-30T21:10:31.753

在 .Net 中，您应该使用`System.Drawing.Printing`命名空间中的类进行打印。当你这样做时，你从一个对象调用该`Print()`方法。`PrintDocument`这将引发`PrintDocument`'`PrintPage`事件。该`Graphics`事件的`PrintPageEventArg`参数的属性具有`ClipBounds`属性。使用此属性检查可打印区域。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T20:02:15.570

你用什么来打印？您很可能必须查询打印机的边距，然后调整绘图代码以在可打印区域内打印。

换句话说 - 你必须“手工”做。

# .net - 使用 REST Web 服务的最佳方式是什么？

> ID：329256
> 
> 赞同：47
> 
> 时间：2008-11-30T20:02:02.203
> 
> 标签：.net, web-services, rest

从 .NET 使用 REST Web 服务的最佳方式是什么？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-12-01T02:43:34.543

一种简单直接的方法是使用 System.Net 命名空间中的 WebClient。

几乎所有您需要做的就是以查询字符串的形式传递所需的 Uri 以及所需的任何参数，并且您应该以字符串的形式返回响应，无论是 json 还是 xml。例如。

```
using System.Net; 

string param = "hello";

string url = String.Format("http://somedomain.com/samplerequest?greeting={0}",param);

WebClient serviceRequest = new WebClient();
string response = serviceRequest.DownloadString(new Uri(url)); 
```

然后，就像 Nick 提到的那样，您可以根据需要使用 XmlDocument 或 JavaScriptSerializer 来操作结果。无论如何，我建议查看它的文档，看看它是否满足您的需求。[http://msdn.microsoft.com/en-us/library/system.net.webclient.aspx](http://msdn.microsoft.com/en-us/library/system.net.webclient.aspx)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-07-28T20:40:14.823

而不是使用像 Kenney 这样的 WebClient，您可以使用 HttpWebRequest 和 HttpWebResponse 并使用 StreamReader 和 XmlDocument 处理结果。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-08-05T09:57:50.410

还有[RestSharp](http://restsharp.org/ "RestSharp")，一个轻量级的 .NET 组件，可以让您轻松使用 REST Web 服务

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-07-08T14:49:46.840

在我看来，实现 REST API 最简单的方法是使用 Service Stack：

[http://www.servicestack.net/](http://www.servicestack.net/)

在我的最后一个 Windows 项目中，我在 WCF 和 ServiceStack 中进行了概念验证，Service Stack 应用程序更快（您可以在 Service Stack 站点中查找测量值）并且更易于维护（更少的代码，更少的魔法实现）。最重要的一点是，它可以帮助您专注于简单性。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-30T20:06:36.063

可能是 WCF；查看

[http://hyperthink.net/blog/announcing-the-wcf-rest-starter-kit/](http://hyperthink.net/blog/announcing-the-wcf-rest-starter-kit/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-30T20:33:37.223

你想消费还是发布。如果你想消费，比如发出请求，与之交互的最佳方式是弄清楚它将返回的类型，通常是 JSON 或 XML。获得类型后，您可以使用 XmlDocument 或 JavaScriptSerializer 拉回信息并使用它。

如果您想生成一个 REST 接口，那么您可能想要使用 MVC 一个 REST 视图或 WCF，正如@Brian 所说。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-09-23T14:44:54.513

如果 REST 服务是使用 ASP.NET Web API 构建的，那么我将使用 Microsoft Http 客户端库。（可用 nuget 包）。注意 这似乎已经取代了下面链接的 nuget 屏幕截图中列出的 Web api 客户端库。

这适用于 .NET 4、Windows Store Apps、Windows Phone 7.5/8、Silverlight 4 和 5。

理论上，您也可以使用它来调用使用其他框架构建的任何 REST 服务。

这是一个链接，其中包含一些关于使用 HttpClient 类调用 REST 服务的示例： [Calling a web api from a .net client](http://www.asp.net/web-api/overview/web-api-clients/calling-a-web-api-from-a-net-client)

# debugging - 如何调试 MPI 程序？

> ID：329259
> 
> 赞同：143
> 
> 时间：2008-11-30T20:02:21.843
> 
> 标签：debugging, mpi

我有一个编译和运行的 MPI 程序，但我想逐步检查它以确保没有发生任何奇怪的事情。理想情况下，我想要一种将 GDB 附加到任何特定进程的简单方法，但我不确定这是否可能或如何做到。另一种方法是让每个进程将调试输出写入单独的日志文件，但这并不能真正提供与调试器相同的自由度。

有更好的方法吗？您如何调试 MPI 程序？

* * *

## 回答 #1

> 赞同：95
> 
> 时间：2010-03-02T16:35:47.030

我发现 gdb 非常有用。我用它作为

```
mpirun -np <NP> xterm -e gdb ./program 
```

这是我可以在其中启动的 xterm 窗口

```
run <arg1> <arg2> ... <argN> 
```

通常工作正常

您还可以使用以下命令将这些命令打包在一起：

```
mpirun -n <NP> xterm -hold -e gdb -ex run --args ./program [arg1] [arg2] [...] 
```

* * *

## 回答 #2

> 赞同：64
> 
> 时间：2008-12-12T19:12:57.243

正如其他人所说，[TotalView](https://www.roguewave.com/products-services/totalview)是这方面的标准。但这将花费你一条胳膊和一条腿。

OpenMPI 站点有一个[关于 MPI 调试的很好的常见问题解答](http://www.open-mpi.org/faq/?category=debugging)。FAQ 中的第 6 项描述了如何将 GDB 附加到 MPI 进程。阅读全文，有一些很棒的提示。

但是，如果您发现要跟踪的进程太多，请查看[堆栈跟踪分析工具 (STAT)](http://www.paradyn.org/STAT/)。我们在 Livermore 使用它从潜在的数十万个正在运行的进程中收集堆栈跟踪，并将它们智能地呈现给用户。它不是功能齐全的调试器（功能齐全的调试器永远不会扩展到 208k 内核），但它会告诉您哪些进程组正在做同样的事情。然后，您可以在标准调试器中逐步检查每个组的代表。

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2013-07-26T12:51:11.127

这里的许多帖子都是关于 GDB 的，但没有提到如何从启动附加到进程。显然，您可以附加到所有进程：

```
mpiexec -n X gdb ./a.out 
```

但这非常无效，因为您必须四处跳动才能启动所有流程。如果您只想调试一个（或少量）MPI 进程，您可以使用`:`运算符在命令行上将其添加为单独的可执行文件：

```
mpiexec -n 1 gdb ./a.out : -n X-1 ./a.out 
```

现在只有一个进程会获得 GDB。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2012-05-31T11:43:54.533

正如其他人所提到的，如果您只使用*少数*MPI 进程，您可以尝试使用[多个 gdb 会话](https://web.archive.org/web/20130818090310/http://www.ncsa.illinois.edu/UserInfo/Resources/Hardware/CommonDoc/mpich2_gdb.html)、redoubtable [valgrind](http://valgrind.org/docs/manual/mc-manual.html#mc-manual.mpiwrap)或推出您自己的 printf / 日志记录解决方案。

如果您使用的进程比这更多，那么您真的需要一个合适的调试器。OpenMPI [FAQ](https://www.open-mpi.org/faq/?category=debugging)推荐[Allinea DDT](https://www.arm.com/products/development-tools/server-and-hpc/forge)和[TotalView](https://web.archive.org/web/20141019045820/http://www.roguewave.com:80/products/totalview.aspx)。

我在[Allinea DDT](https://www.arm.com/products/development-tools/server-and-hpc/forge)工作。它是一个功能齐全的图形源代码调试器，所以是的，您可以：

*   调试或附加到（超过 200k）MPI 进程
*   成组或单独步进和暂停它们
*   添加断点、监视和跟踪点
*   捕获内存错误和泄漏

...等等。如果您使用过 Eclipse 或 Visual Studio，那么您就对了。

我们添加了一些有趣的特性，专门用于调试*并行*代码（无论是 MPI、多线程还是 CUDA）：

*   标量变量在所有进程中自动进行比较：（ [来源：][[allinea.com](https://www.allinea.com/Portals/90122/images/features/unusual-data-values-original.png)][）][![显示跨流程值的迷你图](https://i.stack.imgur.com/9gFGv.png)](https://i.stack.imgur.com/9gFGv.png)

*   您还可以在过程和时间上跟踪和过滤变量和表达式的值： ![跟踪点随时间记录值](https://i.stack.imgur.com/8UfAj.png)

它被广泛用于[top500](https://www.top500.org/list/2011/11/100/) HPC 站点，例如[ORNL](https://web.archive.org/web/20121102135750/http://www.olcf.ornl.gov:80/2010/07/12/upgrade-adds-muscle-to-debugger/)、[NCSA](https://web.archive.org/web/20120822175534/http://www.hpcwire.com/hpcwire/2012-05-14/blue_waters_supercomputer_debugs_with_allinea_ddt.html)、[LLNL](https://computing.llnl.gov/?set=code&page=index#debugging_tools)、[Jülich](https://www.fz-juelich.de/ias/jsc/EN/Expertise/Supercomputers/JUGENE/UserInfo/ParallelDebugging.html#doc1096938bodyText6)等。人。

界面非常漂亮；作为 Oak Ridge 的 Jaguar 集群验收测试的一部分，我们在 0.1 秒内对 220,000 个进程的堆栈和变量进行了计时和合并。

@tgamblin 提到了与[Allinea DDT](https://www.arm.com/products/development-tools/server-and-hpc/forge)集成的出色[STAT](http://www.paradyn.org/STAT/) ，以及其他几个流行的开源项目。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2017-06-23T08:49:44.073

如果你是用户，你会觉得使用**Benedikt Morbach**`tmux`的脚本很舒服：**`tmpi`**

 **原始来源：~~[https://github.com/moben/scripts/blob/master/tmpi](https://github.com/moben/scripts/blob/master/tmpi)~~

分叉：[https ://github.com/Azrael3000/tmpi](https://github.com/Azrael3000/tmpi)

有了它，您就有了多个同步的面板（进程数）（每个命令同时复制到所有面板或进程上，因此与该`xterm -e`方法相比，您可以节省大量时间）。`print`此外，您可以在不需要移动到另一个面板的情况下知道您想要的过程中的变量值，这将在每个面板上打印每个过程的变量值。

如果您不是`tmux`用户，我强烈建议您尝试一下。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2010-03-09T07:03:03.290

[http://valgrind.org/](http://valgrind.org/) nuf 说

* * *

更具体的链接：[使用 Valgrind 调试 MPI 并行程序](http://valgrind.org/docs/manual/mc-manual.html#mc-manual.mpiwrap)

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-04-08T23:40:41.273

[http://github.com/jimktrains/pgdb/tree/master](http://github.com/jimktrains/pgdb/tree/master)是我写的一个实用程序来做这件事。有一些文档，有问题可以私信我。

您基本上调用了一个包装 GDB 并将其 IO 传输到中央服务器的 perl 程序。这允许 GDB 在每台主机上运行，​​并且您可以在终端的每台主机上访问它。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2014-06-29T22:06:45.737

使用`screen`with`gdb`调试 MPI 应用程序效果很好，尤其`xterm`是在不可用或您正在处理多个处理器的情况下。伴随着 stackoverflow 搜索的过程中有很多陷阱，所以我将完整地重现我的解决方案。

首先，在 MPI_Init 之后添加代码以打印出 PID 并暂停程序等待您附加。标准解决方案似乎是一个无限循环；我最终选择了`raise(SIGSTOP);`，这需要额外调用`continue`才能在 gdb 中转义。

```
}
    int i, id, nid;
    MPI_Comm_rank(MPI_COMM_WORLD,&id);
    MPI_Comm_size(MPI_COMM_WORLD,&nid);
    for (i=0; i<nid; i++) {
        MPI_Barrier(MPI_COMM_WORLD);
        if (i==id) {
            fprintf(stderr,"PID %d rank %d\n",getpid(),id);
        }
        MPI_Barrier(MPI_COMM_WORLD);
    }
    raise(SIGSTOP);
} 
```

编译后，在后台运行可执行文件，并捕获stderr。然后，您可以`grep`在 stderr 文件中查找某个关键字（此处为文字 PID）来获取每个进程的 PID 和排名。

```
MDRUN_EXE=../../Your/Path/To/bin/executable
MDRUN_ARG="-a arg1 -f file1 -e etc"

mpiexec -n 1 $MDRUN_EXE $MDRUN_ARG >> output 2>> error &

sleep 2

PIDFILE=pid.dat
grep PID error > $PIDFILE
PIDs=(`awk '{print $2}' $PIDFILE`)
RANKs=(`awk '{print $4}' $PIDFILE`) 
```

可以将 gdb 会话附加到每个进程，使用`gdb $MDRUN_EXE $PID`. 在屏幕会话中这样做可以轻松访问任何 gdb 会话。`-d -m`以分离模式启动屏幕，`-S "P$RANK"`允许您命名屏幕以便以后轻松访问，并且`-l`bash 选项以交互模式启动它并防止 gdb 立即退出。

```
for i in `awk 'BEGIN {for (i=0;i<'${#PIDs[@]}';i++) {print i}}'`
do
    PID=${PIDs[$i]}
    RANK=${RANKs[$i]}
    screen -d -m -S "P$RANK" bash -l -c "gdb $MDRUN_EXE $PID"
done 
```

`-X stuff`一旦 gdb 在屏幕中启动，您可以使用 screen 的命令将脚本输入到屏幕（这样您就不必输入每个屏幕并键入相同的内容） 。命令末尾需要换行符。这里的屏幕是通过`-S "P$i"`使用前面给出的名称来访问的。该`-p 0`选项很关键，否则命令会间歇性失败（基于您之前是否已附加到屏幕）。

```
for i in `awk 'BEGIN {for (i=0;i<'${#PIDs[@]}';i++) {print i}}'`
do
    screen -S "P$i" -p 0 -X stuff "set logging file debug.$i.log
"
    screen -S "P$i" -p 0 -X stuff "set logging overwrite on
"
    screen -S "P$i" -p 0 -X stuff "set logging on
"
    screen -S "P$i" -p 0 -X stuff "source debug.init
"
done 
```

此时，您可以使用 附加到任何屏幕`screen -rS "P$i"`并使用 分离`Ctrl+A+D`。类似于前面的代码部分，可以将命令发送到所有 gdb 会话。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-12-04T06:43:45.167

调试 MPI 程序的“标准”方法是使用支持该执行模型的调试器。

在 UNIX 上，据说[TotalView](http://www.roguewave.com/products/totalview.aspx)对 MPI 有很好的支持。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-05-09T14:44:39.543

我使用这个自制的小方法将调试器附加到 MPI 进程 - 在代码中的 MPI_Init() 之后调用以下函数 DebugWait()。现在，当进程等待键盘输入时，您可以随时将调试器附加到它们并添加断点。完成后，提供一个字符输入，您就可以开始了。

```
static void DebugWait(int rank) {
    char    a;

    if(rank == 0) {
        scanf("%c", &a);
        printf("%d: Starting now\n", rank);
    } 

    MPI_Bcast(&a, 1, MPI_BYTE, 0, MPI_COMM_WORLD);
    printf("%d: Starting now\n", rank);
} 
```

当然，您可能只想为调试版本编译此函数。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-12-03T20:58:25.437

还有我的开源工具 padb，它旨在帮助进行并行编程。我称它为“作业检查工具”，因为它不仅可以用作调试器，还可以用作例如并行顶部的程序。在“完整报告”模式下运行，它将向您显示应用程序中每个进程的堆栈跟踪以及每个级别的每个函数的局部变量（假设您使用 -g 编译）。它还将向您显示“MPI 消息队列”，即作业中每个等级的未完成发送和接收列表。

除了显示完整报告外，还可以告诉 padb 放大作业中的单个信息位，还有无数的选项和配置项来控制显示的信息，请参阅网页了解更多详细信息。

[数据库](http://padb.pittman.org.uk/full-report.html)

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-02-28T17:14:44.390

将 gdb 附加到 mpi 进程的命令不完整，应该是

```
mpirun -np <NP> xterm -e gdb ./program 
```

可以在[这里找到对 mpi 和 gdb 的简要讨论](http://lists.mcs.anl.gov/pipermail/mpich-discuss/2010-April/006966.html)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2018-09-04T19:57:50.050

调试 MPI 程序的一种非常简单的方法。

在 main() 函数中添加 sleep (some_seconds)

像往常一样运行程序

```
$ mpirun -np <num_of_proc> <prog> <prog_args> 
```

程序将启动并进入睡眠状态。

因此，您将有几秒钟的时间通过 ps 找到您的进程，运行 gdb 并附加到它们。

如果你使用像 QtCreator 这样的编辑器，你可以使用

*调试->开始调试->附加到正在运行的应用程序*

并在那里找到您的流程。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-06-03T23:22:30.480

我使用日志跟踪进行了一些与 MPI 相关的调试，但如果您使用的是 mpich2: [MPICH2 和 gdb ，您也可以运行 gdb](http://heather.cs.ucdavis.edu/~matloff/pardebug.html)。当您处理从调试器启动时很棘手的进程时，这种技术通常是一种很好的做法。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2012-06-01T13:11:05.623

`mpirun -gdb`

感谢[http://www.ncsa.illinois.edu/UserInfo/Resources/Hardware/CommonDoc/mpich2_gdb.html](http://www.ncsa.illinois.edu/UserInfo/Resources/Hardware/CommonDoc/mpich2_gdb.html)（[存档链接](https://web.archive.org/web/20130818090310/http://www.ncsa.illinois.edu/UserInfo/Resources/Hardware/CommonDoc/mpich2_gdb.html)）

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2015-10-31T14:36:34.030

另一种解决方案是在模拟 MPI SMPI 中运行您的代码。这是我参与的一个开源项目。每个 MPI 等级都将转换为同一 UNIX 进程的线程。然后，您可以轻松地使用 gdb 来步进 MPI 等级。

SMPI 为 MPI 应用程序的研究提出了其他优点：千里眼（您可以观察系统的每个部分）、可重复性（除非您指定，否则多次运行会导致完全相同的行为）、没有 heisenbugs（因为模拟平台保持不同）从主机一）等。

有关详细信息，请参阅[此演示文稿](http://simgrid.gforge.inria.fr/tutorials/simgrid-smpi-101.pdf)或[相关答案](https://stackoverflow.com/questions/2299147/running-mpi-code-in-my-laptop)。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-12-02T10:43:29.017

您可以使用免费且比`xterm`. 您复制 VS Code 窗口并将调试器手动附加到每个进程。请参阅以下视频中的说明：

[YouTube](https://www.youtube.com/watch?v=lTt02xuD51w)

# java - 在 JUnit 测试中处理 Swing 事件

> ID：329264
> 
> 赞同：1
> 
> 时间：2008-11-30T20:05:39.153
> 
> 标签：java, unit-testing, swing, events, junit

我有 Swing java 应用程序，它与几个“播放器”进行网络通信，这些播放器对象表示为播放器对象，每个播放器对象都有自己的通信线程。该应用程序有一个管理所有玩家对象的“团队”对象。几个 UI 组件通过 Team 对象监听玩家传递的事件。

在我的设计中，团队对象使用 invokeLater 触发 Swing 线程上的所有事件，这样我的应用程序的其余部分就不必为线程问题而烦恼。但是，我不知道如何在 JUnit 测试中测试 Team 类。

多一点背景。起初，我让 Team 对象在玩家对象线程上触发其事件（根本没有线程切换）。Team 单元测试成功了，但是我在 UI 中使用 invokeLaters 遇到了许多线程问题，并且在所有地方都进行了同步。然后我决定通过让 Team 对象在 Swing 线程上触发事件来简化线程模型，但是现在 Team 单元测试失败了，因为它没有接收到事件。该怎么办？

想到的一个解决方案是在 Team 之上引入一个额外的对象，该对象执行线程切换并保持原始单元测试的完整性，但我不喜欢在生产代码中引入复杂性以使单元测试成功的想法。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-30T21:23:30.603

当我用 完成 JUnit 测试时`EventQueue.invokeLater`，我已经将自己与那个邪恶的静态解耦了。`invokeLater`使用和`isDispatchThread`方法创建接口。对于生产，实施应该只是转发到`EventQueue`. 对于测试，请使用您自己的线程（可以为每个测试设置和拆除）。

其他一些随机建议：

*   保持 GUI 尽可能薄。
*   保持线程出其他一切，其他一切出线程。
*   怀疑任何声称是线程安全的东西。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T20:55:49.783

也许您可以使用 easymock 来隔离您要测试的类，并让模拟对象接收事件并检查它们是否被触发。

我推荐 EasyMock：[http ://www.easymock.org/](http://www.easymock.org/)

从您的故事来看，您的单元测试更像是集成测试，而且非常复杂。如果是这种情况，请尝试简化和隔离。您可能已经阅读过[http://junit.sourceforge.net/doc/testinfected/testing.htm](http://junit.sourceforge.net/doc/testinfected/testing.htm)

我希望这有帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-30T22:05:46.163

> 想到的一个解决方案是在 Team 之上引入一个额外的对象，该对象执行线程切换并保持原始单元测试的完整性，但我不喜欢在生产代码中引入复杂性只是为了使单元测试成功的想法。

我不知道这里是否是这种情况，但我经常发现我添加的“复杂性”实际上是更高级别的抽象，可以改进代码。

模拟对象背后的最初想法不是使单元测试更容易，而是“接口发现”，以创建代表通用语言中的抽象的接口，而不是在 API 级别工作。

# visual-sourcesafe - 如何跳过 Visual Sourcesafe 的登录提示？

> ID：329274
> 
> 赞同：3
> 
> 时间：2008-11-30T20:08:24.747
> 
> 标签：visual-sourcesafe

我想在打开 VSS 时自动登录，并完全跳过登录提示。这可能吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-30T20:10:30.047

回答我自己的问题：

1 - 右键单击​​我的电脑，单击属性

2 - 点击“高级” -> “环境变量”

3 - 在用户变量下，单击“新建”。

4 - 变量名称 = "SSUSER"，变量值 = <您的 VSS 用户名 >

5 - 对“SSPWD”和<您的 VSS 密码>重复步骤 3 和 4

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-30T20:11:19.703

是的，您可以附加 -Y 命令行开关：

[MSDN 文档](http://msdn.microsoft.com/en-us/library/edy95zhk(VS.80).aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-01T01:25:38.930

如果您的用户登录名与您的“网络”名称（在我的情况下是我的 Windows 用户名）相同，我的经验是不必提示我登录。我的 VSS 6.0 服务器机器有一个我的名字的帐户，并且我的 VSS 6.0 客户端计算机具有我进行开发的相同（非管理）帐户。

在 VSS Admin 应用程序中，查看工具 | 选项 | 常规选项卡和“使用网络名称进行自动用户登录”复选框。

当然，这需要您的管理员合作并确定 VSS 用户名和登录安全性的任何策略。就我而言，我同时戴帽子，我们相处得很好。

我记得，即使我没有从管理员帐户访问 VSS，我对管理员用户登录也有相同的安排，而且在使用 VSS Admin 时我似乎也不必经常登录。（我很少这样做，老实说我不记得了，但是我刚才提出它时不必登录。）

# design-patterns - 多个控件的单个事件引发模式

> ID：329279
> 
> 赞同：1
> 
> 时间：2008-11-30T20:10:43.073
> 
> 标签：design-patterns, events, event-handling

我在一个页面上有几个控件。它恰好是一个 Silverlight 页面，但我认为这对这个问题并不重要。

当控件的值更改时，会引发更改事件。在这种情况下，我进行计算并更改其他控件之一的值。这反过来又导致另一个控件引发更改的事件，这反过来又导致计算（冗余）再次完成。

即任何控件的值的改变都会导致计算被执行并且另一个控件的值改变——总是在这个用例中。

我最初尝试解决这个问题涉及使用布尔标志并将其重置为第二个事件中的默认值。然而，这并没有奏效，而且感觉很做作。

您将如何阻止第二次计算完成？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-30T20:15:57.137

布尔标志也是，我想......不知道为什么它不适合你。它会是这样的：

```
private bool InEvent = false;
public void MyEventHandler(object sender, EventArgs e)
{
    if ( InEvent )
        return;
    InEvent = true;
    // Do stuff here
    InEvent = false;
} 
```

如果您害怕多线程，您可能会在某处使用 lock 语句，但我认为情况并非如此。此外，您可能想尝试一下……最后确保 InEvent 始终设置为 false。

# c# - 如何从c#获取网站标题

> ID：329307
> 
> 赞同：16
> 
> 时间：2008-11-30T20:23:30.363
> 
> 标签：c#, webrequest

我正在重新访问我的一些旧代码，并偶然发现了一种根据其 url 获取网站标题的方法。这并不是您所说的稳定方法，因为它通常无法产生结果，有时甚至会产生不正确的结果。此外，有时它无法显示标题中的某些字符，因为它们是另一种编码。

有没有人对这个旧版本有改进的建议？

```
public static string SuggestTitle(string url, int timeout)
{
    WebResponse response = null;
    string line = string.Empty;

    try
    {
        WebRequest request = WebRequest.Create(url);
        request.Timeout = timeout;

        response = request.GetResponse();
        Stream streamReceive = response.GetResponseStream();
        Encoding encoding = System.Text.Encoding.GetEncoding("utf-8");
        StreamReader streamRead = new System.IO.StreamReader(streamReceive, encoding);

        while(streamRead.EndOfStream != true)
        {
            line = streamRead.ReadLine();
            if (line.Contains("<title>"))
            {
                line = line.Split(new char[] { '<', '>' })[2];
                break;
            }
        }
    }
    catch (Exception) { }
    finally
    {
        if (response != null)
        {
            response.Close();
        }
    }

    return line;
} 
```

最后一点 - 我希望代码也能更快地运行，因为它会阻塞直到页面被获取，所以如果我只能获取站点标题而不是整个页面，那就太好了。

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-11-30T20:38:50.507

获取内容的更简单方法：

```
WebClient x = new WebClient();
string source = x.DownloadString("http://www.singingeels.com/"); 
```

更简单、更可靠的获取标题的方法：

```
string title = Regex.Match(source, @"\<title\b[^>]*\>\s*(?<Title>[\s\S]*?)\</title\>",
    RegexOptions.IgnoreCase).Groups["Title"].Value; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2018-03-26T08:37:42.323

也许有了这个建议，一个新世界为你打开了我也有这个问题并来到了这个

[从http://html-agility-pack.net/?z=codeplex](http://html-agility-pack.net/?z=codeplex)下载“Html 敏捷包”

或转到 nuget：[https](https://www.nuget.org/packages/HtmlAgilityPack/) ://www.nuget.org/packages/HtmlAgilityPack/ 并添加此参考。

在代码文件中添加以下使用：

```
using HtmlAgilityPack; 
```

在您的方法中编写以下代码：

```
var webGet = new HtmlWeb();
var document = webGet.Load(url);    
var title = document.DocumentNode.SelectSingleNode("html/head/title").InnerText; 
```

资料来源：

[https://codeshare.co.uk/blog/how-to-scrape-meta-data-from-a-url-using-htmlagilitypack-in-c/](https://codeshare.co.uk/blog/how-to-scrape-meta-data-from-a-url-using-htmlagilitypack-in-c/) [HtmlAgilityPack 获取 Title 和 meta](https://stackoverflow.com/questions/17606247/htmlagilitypack-obtain-title-and-meta)

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-30T20:29:34.020

为了实现这一点，您将需要做几件事。

*   使您的应用程序线程化，以便您可以同时处理多个请求并最大化正在发出的 HTTP 请求的数量。
*   在异步请求期间，仅下载您想要拉回的数据量，您可以在数据返回时对其进行解析
*   大概是想用正则表达式拉出标题名

我以前用 SEO 机器人做过这个，我一次可以处理近 10,000 个请求。您只需要确保每个 Web 请求都可以自包含在一个线程中。

# c - 在 C 中获取控制台缓冲区内容

> ID：329309
> 
> 赞同：3
> 
> 时间：2008-11-30T20:24:46.213
> 
> 标签：c, screen, mingw

只是想知道是否有任何方法（在 C 中）来获取控制台缓冲区的内容，最好是某种 char 数组。它将被写入一个文件，所以如果我错过了一些愚蠢的东西，可以做到这一点，然后指出它。它可以是特定于 Windows 的。我正在使用 MinGW (gcc 3.4.5)。

提前致谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-30T21:02:54.047

我认为您需要查看 Win32 控制台功能，例如[GetStdHandle()](http://msdn.microsoft.com/en-us/library/ms683231(VS.85).aspx)、 [ReadConsoleOutput()](http://msdn.microsoft.com/en-us/library/ms684965(VS.85).aspx)、[WriteConsoleOutput](http://msdn.microsoft.com/en-us/library/ms687404(VS.85).aspx)等。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-30T21:15:22.117

在 Win32 中，[ReadConsoleOutput](http://msdn.microsoft.com/en-us/library/ms684965.aspx)：

> 从控制台屏幕缓冲区中的字符单元的矩形块读取字符和颜色属性数据，该函数将数据写入目标缓冲区中指定位置的矩形块。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-01T13:11:20.610

下载[mingw-readline](http://sourceforge.net/project/showfiles.php?group_id=204414&package_id=265973)

看看[GNU Readline](http://tiswww.case.edu/php/chet/readline/readline.html#SEC23)

```
rl_line_buffer 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-11-05T00:26:28.913

这是一种读取控制台缓冲区的方法。`GetNumCharsInConsoleBuffer`是获取控制台屏幕缓冲区中写入的总字符数，我在里面使用[了GetConsoleScreenBufferInfo](https://msdn.microsoft.com/fr-fr/library/windows/desktop/ms683171(v=vs.85).aspx)。之后，我创建一个动态分配的数组，其大小等于 + 1 返回的先前值`GetNumCharsInConsoleBuffer`（对于零结尾）。最后，`ReadConsoleBuffer`将使用控制台屏幕缓冲区的内容填充刚刚创建的缓冲区。之后，如果要将缓冲区的内容写入文件，则可能需要进行一些格式化。使用[ReadConsoleOutputCharacter](https://msdn.microsoft.com/fr-fr/library/windows/desktop/ms684969(v=vs.85).aspx)，您可以获得控制台屏幕缓冲区的区域（矩形）。您写入控制台屏幕缓冲区的行将用空格填充以适应缓冲区的区域。win32也是一样`ReadConsoleOutput/WriteConsoleOutput`，您将获得屏幕的一个区域（矩形）。

```
#include <stdio.h>
#include <stdlib.h>
#include <Windows.h>

DWORD GetNumCharsInConsoleBuffer()
{
    CONSOLE_SCREEN_BUFFER_INFO buffer_info = {0};
    if( GetConsoleScreenBufferInfo(GetStdHandle(STD_OUTPUT_HANDLE), &buffer_info) != FALSE)
        return (DWORD) ( (buffer_info.dwSize.X * ( buffer_info.dwCursorPosition.Y + 1)) - (buffer_info.dwSize.X - ( buffer_info.dwCursorPosition.X)) );
    else
        return 0;
}

DWORD ReadConsoleBuffer(char* buffer, DWORD bufsize)
{
    DWORD num_character_read = 0;
    COORD first_char_to_read = {0};
    if( ReadConsoleOutputCharacterA(GetStdHandle(STD_OUTPUT_HANDLE), buffer, bufsize, first_char_to_read, &num_character_read) != FALSE)
        buffer[bufsize-1] = '\0';
    else
        buffer[0] = '\0';

    return num_character_read;
}

int main(int argc, char** argv)
{
    fprintf(stdout, "Writting\nin\nthe\nbuffer\n");
    DWORD bufsize = GetNumCharsInConsoleBuffer();

    if(bufsize > 0)
    {
        bufsize++; // Add 1 for zero-ending char

        char* buffer = malloc(bufsize);
        memset(buffer, 0, bufsize);

        ReadConsoleBuffer(buffer, bufsize);  

        puts("\nBuffer contents:");
        puts(buffer);

        free(buffer);
    }

    system("pause"); 
    return 0;
} 
```

输出：

```
Writting
in
the
buffer
Buffer contents:
Writting
in
the
buffer

Appuyez sur une touche pour continuer... 
```

编辑：

我刚刚写了一个函数，可以用来将屏幕缓冲区的内容写入文件。此函数从屏幕控制台缓冲区中删除填充空间。 `ReadConsoleBuffer`将一个空字符指针作为第一个参数 ( `buffer`)，将在其执行期间分配。所以不要忘记自己删除它。将在第二个参数 ( )`ReadConsoleBuffer`中写入缓冲区的大小。`bufsize`

```
#include <stdio.h>
#include <stdlib.h>
#include <crtdbg.h>
#include <Windows.h>

const char* ReadConsoleBuffer(char** buffer, size_t* bufsize)
{
    CONSOLE_SCREEN_BUFFER_INFO buffer_info = {0};
    if( GetConsoleScreenBufferInfo(GetStdHandle(STD_OUTPUT_HANDLE), &buffer_info) != FALSE )
    {
        size_t data_size = (size_t) ( (buffer_info.dwSize.X * ( buffer_info.dwCursorPosition.Y + 1)) - 
                                      (buffer_info.dwSize.X - ( buffer_info.dwCursorPosition.X + 1)) );

        if(data_size > 1)
        {
            char* data = malloc(data_size); //= new char[data_size];
            _ASSERTE(data != 0);

            DWORD num_char_read;
            COORD first_char_read = {0};
            if( ReadConsoleOutputCharacterA(GetStdHandle(STD_OUTPUT_HANDLE), data, data_size, first_char_read, &num_char_read) != FALSE )
            {
                data[data_size-1] = '\0';

                const char* const pbeg = &data[0];
                const char* const pend = &data[data_size-1];
                char* pcur, *pmem;

                const int line_size = buffer_info.dwSize.X;
                int line_count = buffer_info.dwCursorPosition.Y;

                if(buffer_info.dwCursorPosition.X > 0) // No new line char at the end of the last line, so no padded spaces. 
                {                    
                    if((line_count + 1) > 1)
                    {
                        pmem = &data[data_size - buffer_info.dwCursorPosition.X - 1];
                        pcur = (pmem - 1);
                    }
                    else // 1 line and no new line char(no padded spaces). Will no enters the loop.
                        pcur = &data[0];
                }
                else 
                {
                    pcur = &data[data_size-2];
                    pmem = 0;
                }

                if(pcur != pbeg)
                {
                    while(1)
                    {
                        line_count--;

                        while(*pcur == ' ') { pcur--; }
                        *(pcur + 1) = '\n'; // Padded spaces replaced by new line char.

                        if(!pmem) // first round. Add zero-ending char.
                            *(pcur + 2) = '\0'; 
                        else
                            memmove(pcur + 2, pmem, (pend - pmem) + 1);

                        if(line_count == 0)
                            break;

                        pmem = &data[line_count * line_size];
                        pcur = (pmem - 1);
                    }
                }

                *bufsize = strlen(data) + 1;

                *buffer = malloc(*bufsize); //= new char[*bufsize];
                _ASSERTE(*buffer != 0);

                memcpy(*buffer, data, *bufsize);
                free(data); //delete[] data;

                pcur= *buffer;
                return pcur;
            }

            if(data)
                free(data); // delete[] data;
        }
    }

    *buffer = 0;
    return 0;
}

int main(int argc, char** argv)
{
    printf("Writting\nin\nthe\nbuffer");

    char* buffer;
    size_t size;  
    ReadConsoleBuffer(&buffer, &size);

    if(buffer)
    {
        freopen("out.txt", "w", stdout); 
        fprintf(stdout, buffer);
        free(buffer);
        fclose(stdout);
    }  

    return 0;
} 
```

'out.txt' 中的输出：

```
Writting
in
the
buffer 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-30T21:02:17.527

如果它是命令窗口中的屏幕，那么可能没有，或者没有简单的方法。您可以破解 Windows 事件以全选、复制和读取剪贴板。

# python - 用于 2.5 的纯 Python 有理数模块

> ID：329333
> 
> 赞同：6
> 
> 时间：2008-11-30T20:42:50.810
> 
> 标签：python, rational-numbers

有没有人见过这样的事情？小型自给自足模块是首选。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-30T21:57:16.400

如有必要，可以删除 2.6 中的[分数模块。](http://docs.python.org/library/fractions.html)抓取 fractions.py、numbers.py 和 abc.py；所有纯python模块。

您可以从这里获取单个文件（2.6 分支，2.7 不起作用）： [http ://hg.python.org/cpython/branches](http://hg.python.org/cpython/branches)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-30T20:47:25.277

[SymPy](http://code.google.com/p/sympy/)是一个完全用 Python 编写的符号数学库，完全支持有理数。从[教程](http://docs.sympy.org/tutorial.html)：

```
>>> from sympy import *
>>> a = Rational(1,2)

>>> a
1/2

>>> a*2
1

>>> Rational(2)**50/Rational(10)**50
1/88817841970012523233890533447265625 
```

还有 Python 的 GMP ( [GMPY](http://gmpy.sourceforge.net/) )，虽然不是纯 Python，但可能更有效。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-01T12:33:28.083

要尝试的另一件事是Python 2.5 维护分支中演示文件夹中的[Rat.py。](http://svn.python.org/view/python/branches/release25-maint/Demo/classes/Rat.py?rev=51333&view=markup)如果我理解正确，它是 2.6 的爸爸`fractions`。它是一个没有依赖关系的单一模块。

```
>>> from Rat import rat
>>> rat(1) / rat(3)
Rat(1,3)
>>> rat(1, 3) ** 2
Rat(1,9) 
```

**更新**：不，`fractions.py`我的任务快了大约 2.5 倍。

# c# - 无法使用 Directory.Delete(path, true) 删除目录

> ID：329355
> 
> 赞同：404
> 
> 时间：2008-11-30T20:57:03.917
> 
> 标签：c#, .net, exception, io

我正在使用 .NET 3.5，尝试使用以下方法递归删除目录：

```
Directory.Delete(myPath, true); 
```

我的理解是，如果文件正在使用或存在权限问题，这应该抛出，否则它应该删除目录及其所有内容。

但是，我偶尔会得到这个：

```
System.IO.IOException: The directory is not empty.
    at System.IO.__Error.WinIOError(Int32 errorCode, String maybeFullPath)
    at System.IO.Directory.DeleteHelper(String fullPath, String userPath, Boolean recursive)
    at System.IO.Directory.Delete(String fullPath, String userPath, Boolean recursive)
    ... 
```

我对这个方法有时会抛出并不感到惊讶，但是当递归为真时，我很惊讶得到这个特定的消息。（我*知道*目录不是空的。）

有没有理由我会看到这个而不是 AccessViolationException？

* * *

## 回答 #1

> 赞同：241
> 
> 时间：2008-11-30T22:24:23.023

**编者注：**虽然这个答案包含一些有用的信息，但事实上它是关于`Directory.Delete`. 请阅读此答案的评论以及此问题的其他答案。

* * *

我之前遇到过这个问题。

问题的根源在于此函数不会删除目录结构中的文件。所以你需要做的是创建一个函数，删除目录结构中的所有文件，然后删除所有目录，然后再删除目录本身。我知道这违背了第二个参数，但这是一种更安全的方法。此外，您可能希望在删除文件之前从文件中删除只读访问属性。否则会引发异常。

只需将此代码添加到您的项目中即可。

```
public static void DeleteDirectory(string target_dir)
{
    string[] files = Directory.GetFiles(target_dir);
    string[] dirs = Directory.GetDirectories(target_dir);

    foreach (string file in files)
    {
        File.SetAttributes(file, FileAttributes.Normal);
        File.Delete(file);
    }

    foreach (string dir in dirs)
    {
        DeleteDirectory(dir);
    }

    Directory.Delete(target_dir, false);
} 
```

另外，对我来说，我个人对允许删除的机器区域添加了限制，因为您是否希望有人在`C:\WINDOWS (%WinDir%)`或上调用此功能`C:\`。

* * *

## 回答 #2

> 赞同：192
> 
> 时间：2009-11-09T21:01:43.700

如果您尝试递归删除目录`a`并且目录`a\b`在资源管理器中打开，`b`将被删除，但您会收到错误“目录不是空的”，`a`即使您去查看时它是空的。任何应用程序（包括资源管理器）的当前目录都[保留了该目录的句柄](http://blogs.msdn.com/b/oldnewthing/archive/2010/11/09/10087919.aspx)。当您调用 时`Directory.Delete(true)`，它会从下往上删除：`b`，然后`a`。如果`b`在资源管理器中打开，资源管理器将检测删除`b`，向上更改目录`cd ..`并清理打开的句柄。由于文件系统是异步操作的，所以`Directory.Delete`操作会因为与资源管理器的冲突而失败。

## 不完整的解决方案

我最初发布了以下解决方案，其想法是中断当前线程以允许资源管理器有时间释放目录句柄。

```
// incomplete!
try
{
    Directory.Delete(path, true);
}
catch (IOException)
{
    Thread.Sleep(0);
    Directory.Delete(path, true);
} 
```

但这仅在打开目录是您要删除的目录的*直接子目录时才有效。*如果`a\b\c\d`在资源管理器中打开并且您在 上使用它，则此技术在删除和`a`后将失败。`d``c`

## 一个更好的解决方案

即使在资源管理器中打开了较低级别的目录之一，此方法也将处理深层目录结构的删除。

```
/// <summary>
/// Depth-first recursive delete, with handling for descendant 
/// directories open in Windows Explorer.
/// </summary>
public static void DeleteDirectory(string path)
{
    foreach (string directory in Directory.GetDirectories(path))
    {
        DeleteDirectory(directory);
    }

    try
    {
        Directory.Delete(path, true);
    }
    catch (IOException) 
    {
        Directory.Delete(path, true);
    }
    catch (UnauthorizedAccessException)
    {
        Directory.Delete(path, true);
    }
} 
```

尽管我们自己进行了额外的递归工作，但我们*仍然*必须处理在`UnauthorizedAccessException`此过程中可能发生的事情。目前尚不清楚第一次删除尝试是否为第二次成功的删除尝试铺平了道路，或者仅仅是抛出/捕获允许文件系统赶上的异常所引入的时间延迟。

您可以通过`Thread.Sleep(0)`在块的开头添加 a 来减少在典型条件下引发和捕获的异常数量`try`。此外，在繁重的系统负载下，您可能会经历两次`Directory.Delete`尝试并失败。将此解决方案视为更强大的递归删除的起点。

## 一般回答

此解决方案仅解决与 Windows 资源管理器交互的特殊性。如果您想要一个坚如磐石的删除操作，要记住的一件事是，任何东西（病毒扫描程序等）都可以随时对您要删除的内容有一个开放的句柄。所以你必须稍后再试。多久之后，以及尝试多少次，取决于删除对象的重要性。正如[MSDN 指出](http://msdn.microsoft.com/en-us/library/bb513869.aspx)的那样，

> 健壮的文件迭代代码必须考虑文件系统的许多复杂性。

这个无辜的声明，只提供了一个指向 NTFS 参考文档的链接，应该会让你毛骨悚然。

（**编辑**：很多。这个答案最初只有第一个不完整的解决方案。）

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2013-02-18T10:15:32.790

在继续之前，请检查您可以控制的以下原因：

*   文件夹是否设置为进程的当前目录？如果是，请先将其更改为其他内容。
*   您是否从该文件夹中打开了一个文件（或加载了一个 DLL）？（忘记关闭/卸载它）

否则，请检查您无法控制的以下合法原因：

*   该文件夹中有标记为只读的文件。
*   您没有删除其中某些文件的权限。
*   文件或子文件夹在资源管理器或其他应用程序中打开。

如果出现上述任何问题，您应该在尝试改进删除代码之前了解它发生的原因。*您的应用应该*删除只读文件还是不可访问文件？谁以这种方式标记它们，为什么？

一旦排除了上述原因，仍有可能出现虚假故障。如果有人持有任何要删除的文件或文件夹的句柄，则删除将失败，并且有人可能会枚举文件夹或读取其文件的原因有很多：

*   搜索索引器
*   杀毒软件
*   备份软件

处理虚假失败的一般方法是多次尝试，在尝试之间暂停。你显然不想永远尝试，所以你应该在尝试一定次数后放弃，要么抛出异常，要么忽略错误。像这样：

```
private static void DeleteRecursivelyWithMagicDust(string destinationDir) {
    const int magicDust = 10;
    for (var gnomes = 1; gnomes <= magicDust; gnomes++) {
        try {
            Directory.Delete(destinationDir, true);
        } catch (DirectoryNotFoundException) {
            return;  // good!
        } catch (IOException) { // System.IO.IOException: The directory is not empty
            System.Diagnostics.Debug.WriteLine("Gnomes prevent deletion of {0}! Applying magic dust, attempt #{1}.", destinationDir, gnomes);

            // see http://stackoverflow.com/questions/329355/cannot-delete-directory-with-directory-deletepath-true for more magic
            Thread.Sleep(50);
            continue;
        }
        return;
    }
    // depending on your use case, consider throwing an exception here
} 
```

在我看来，所有删除都应该使用这样的助手，因为总是可能出现虚假故障。但是，您应该根据您的用例调整此代码，而不是盲目地复制它。

我的应用程序生成的内部数据文件夹出现虚假故障，位于 %LocalAppData% 下，因此我的分析如下：

1.  该文件夹完全由我的应用程序控制，用户没有正当理由去将该文件夹内的内容标记为只读或不可访问，因此我不会尝试处理这种情况。

2.  那里没有有价值的用户创建的东西，所以不存在错误地强行删除某些东西的风险。

3.  作为一个内部数据文件夹，我不希望它在资源管理器中打开，至少我觉得不需要专门处理这个案例（即我可以通过支持来处理这个案例）。

4.  如果所有尝试都失败，我选择忽略错误。最坏的情况是，该应用程序无法解压一些较新的资源，崩溃并提示用户联系支持人员，这对我来说是可以接受的，只要它不经常发生。或者，如果应用程序没有崩溃，它会留下一些旧数据，这也是我可以接受的。

5.  我选择将重试时间限制为 500 毫秒（50 * 10）。这是一个在实践中有效的任意阈值；我希望阈值足够短，这样用户就不会认为应用程序已停止响应而终止应用程序。另一方面，半秒对于罪犯来说是足够的时间来完成我的文件夹的处理。从有时甚至`Sleep(0)`可以接受的其他 SO 答案来看，很少有用户会经历一次以上的重试。

6.  我每 50 毫秒重试一次，这是另一个任意数字。我觉得如果在我尝试删除文件时正在处理（索引、检查）文件，那么 50ms 大约是预期处理在我的情况下完成的正确时间。此外，50ms 足够小，不会导致明显的减速；再次，`Sleep(0)`在很多情况下似乎已经足够了，所以我们不想耽误太多。

7.  代码重试任何 IO 异常。我通常不会期望任何异常访问 %LocalAppData%，因此我选择了简单并接受了在发生合法异常时延迟 500 毫秒的风险。我也不想找到一种方法来检测我想要重试的确切异常。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2017-06-02T08:33:11.563

# 现代异步答案

接受的答案是完全错误的，它可能对某些人有用，因为从磁盘获取文件所花费的时间释放了锁定文件的任何东西。事实是，发生这种情况是因为文件被其他一些进程/流/动作锁定。其他答案使用`Thread.Sleep`（Yuck）在一段时间后重试删除目录。这个问题需要用更现代的答案重新审视。

```
public static async Task<bool> TryDeleteDirectory(
   string directoryPath,
   int maxRetries = 10,
   int millisecondsDelay = 30)
{
    if (directoryPath == null)
        throw new ArgumentNullException(directoryPath);
    if (maxRetries < 1)
        throw new ArgumentOutOfRangeException(nameof(maxRetries));
    if (millisecondsDelay < 1)
        throw new ArgumentOutOfRangeException(nameof(millisecondsDelay));

    for (int i = 0; i < maxRetries; ++i)
    {
        try
        {
            if (Directory.Exists(directoryPath))
            {
                Directory.Delete(directoryPath, true);
            }

            return true;
        }
        catch (IOException)
        {
            await Task.Delay(millisecondsDelay);
        }
        catch (UnauthorizedAccessException)
        {
            await Task.Delay(millisecondsDelay);
        }
    }

    return false;
} 
```

# 单元测试

这些测试显示了锁定文件如何导致`Directory.Delete`失败以及上述`TryDeleteDirectory`方法如何解决问题的示例。

```
[Fact]
public async Task TryDeleteDirectory_FileLocked_DirectoryNotDeletedReturnsFalse()
{
    var directoryPath = Path.Combine(Path.GetTempPath(), Guid.NewGuid().ToString());
    var subDirectoryPath = Path.Combine(Path.GetTempPath(), "SubDirectory");
    var filePath = Path.Combine(directoryPath, "File.txt");

    try
    {
        Directory.CreateDirectory(directoryPath);
        Directory.CreateDirectory(subDirectoryPath);

        using (var fileStream = new FileStream(filePath, FileMode.Create, FileAccess.Write, FileShare.Write))
        {
            var result = await TryDeleteDirectory(directoryPath, 3, 30);
            Assert.False(result);
            Assert.True(Directory.Exists(directoryPath));
        }
    }
    finally
    {
        if (Directory.Exists(directoryPath))
        {
            Directory.Delete(directoryPath, true);
        }
    }
}

[Fact]
public async Task TryDeleteDirectory_FileLockedThenReleased_DirectoryDeletedReturnsTrue()
{
    var directoryPath = Path.Combine(Path.GetTempPath(), Guid.NewGuid().ToString());
    var subDirectoryPath = Path.Combine(Path.GetTempPath(), "SubDirectory");
    var filePath = Path.Combine(directoryPath, "File.txt");

    try
    {
        Directory.CreateDirectory(directoryPath);
        Directory.CreateDirectory(subDirectoryPath);

        Task<bool> task;
        using (var fileStream = new FileStream(filePath, FileMode.Create, FileAccess.Write, FileShare.Write))
        {
            task = TryDeleteDirectory(directoryPath, 3, 30);
            await Task.Delay(30);
            Assert.True(Directory.Exists(directoryPath));
        }

        var result = await task;
        Assert.True(result);
        Assert.False(Directory.Exists(directoryPath));
    }
    finally
    {
        if (Directory.Exists(directoryPath))
        {
            Directory.Delete(directoryPath, true);
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2016-11-24T14:38:00.323

应该提到的一件重要的事情（我将其作为评论添加，但我不允许这样做）是重载的行为从 .NET 3.5 更改为 .NET 4.0。

```
Directory.Delete(myPath, true); 
```

从 .NET 4.0 开始，它会删除文件夹本身中的文件，但不会删除 3.5 中的文件。这也可以在 MSDN 文档中看到。

**.NET 4.0**

> 删除**指定目录**以及目录中的任何子目录和文件（如果有指示）。

**.NET 3.5**

> 删除**空目录**以及目录中的任何子目录和文件（如果有指示）。

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2008-11-30T21:02:27.260

我在 Delphi 下遇到了同样的问题。最终结果是我自己的应用程序锁定了我要删除的目录。当我写入目录时，不知何故该目录被锁定（一些临时文件）。

第 22 个问题是，我在删除它之前对它的父级做了一个简单的**更改目录。**

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2014-09-05T08:06:12.860

您可以通过运行重现错误：

```
Directory.CreateDirectory(@"C:\Temp\a\b\c\");
Process.Start(@"C:\Temp\a\b\c\");
Thread.Sleep(1000);
Directory.Delete(@"C:\Temp\a\b\c");
Directory.Delete(@"C:\Temp\a\b");
Directory.Delete(@"C:\Temp\a"); 
```

当试图删除目录'b'时，它会抛出 IOException "The directory is not empty"。这很愚蠢，因为我们刚刚删除了目录“c”。

据我了解，解释是目录'c'被标记为已删除。但删除尚未在系统中提交。系统已回复作业已完成，实际上仍在处理中。系统可能会等待文件资源管理器关注父目录来提交删除。

如果您查看 Delete 函数的源代码 ( [http://referencesource.microsoft.com/#mscorlib/system/io/directory.cs](http://referencesource.microsoft.com/#mscorlib/system/io/directory.cs) )，您会看到它使用了本机 Win32Native.RemoveDirectory 函数。这种不要等待的行为在此处注明：

> RemoveDirectory 函数在关闭时标记要删除的目录。因此，在关闭该目录的最后一个句柄之前，不会删除该目录。

（[http://msdn.microsoft.com/en-us/library/windows/desktop/aa365488(v=vs.85).aspx](http://msdn.microsoft.com/en-us/library/windows/desktop/aa365488(v=vs.85).aspx)）

睡眠并重试是解决方案。参考 ryascl 的解决方案。

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2012-06-02T05:54:17.447

我很惊讶没有人想到这种简单的非递归方法，它可以删除包含只读文件的目录，而无需更改每个目录的只读属性。

```
Process.Start("cmd.exe", "/c " + @"rmdir /s/q C:\Test\TestDirectoryContainingReadOnlyFiles"); 
```

（稍微改变一下不要立即触发 cmd 窗口，这在整个互联网上都可用）

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2009-06-11T14:14:33.980

尽管能够在 Explorer shell 中删除用户配置文件目录（在 C:\Documents 和设置中），但我遇到了那些奇怪的权限问题。

```
File.SetAttributes(target_dir, FileAttributes.Normal);
Directory.Delete(target_dir, false); 
```

对我来说，“文件”操作对目录的作用是没有意义的，但我知道它可以工作，这对我来说已经足够了！

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2013-05-01T15:38:31.813

不删除文件的递归目录删除肯定是出乎意料的。我的解决方法：

```
public class IOUtils
{
    public static void DeleteDirectory(string directory)
    {
        Directory.GetFiles(directory, "*", SearchOption.AllDirectories).ForEach(File.Delete);
        Directory.Delete(directory, true);
    }
} 
```

我遇到过这有帮助的案例，但一般来说， Directory.Delete 在递归删除时会删除目录内的文件，如[msdn 中所述](https://msdn.microsoft.com/en-us/library/fxeahc5f(v=vs.110).aspx)。

作为 Windows 资源管理器的用户，我有时也会遇到这种不正常的行为：有时我无法删除文件夹（它认为无意义的消息是“访问被拒绝”）但是当我向下钻取并删除较低的项目时，我可以删除上面的项目项目以及。所以我猜上面的代码处理的是操作系统异常——而不是基类库问题。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2017-12-12T06:03:48.563

以上解决方案都不适合我。我最终使用了@ryascl 解决方案的编辑版本，如下所示：

```
 /// <summary>
    /// Depth-first recursive delete, with handling for descendant 
    /// directories open in Windows Explorer.
    /// </summary>
    public static void DeleteDirectory(string path)
    {
        foreach (string directory in Directory.GetDirectories(path))
        {
            Thread.Sleep(1);
            DeleteDir(directory);
        }
        DeleteDir(path);
    }

    private static void DeleteDir(string dir)
    {
        try
        {
            Thread.Sleep(1);
            Directory.Delete(dir, true);
        }
        catch (IOException)
        {
            DeleteDir(dir);
        }
        catch (UnauthorizedAccessException)
        {
            DeleteDir(dir);
        }
    } 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2016-08-04T21:07:02.127

此答案基于：[https](https://stackoverflow.com/a/1703799/184528) ://stackoverflow.com/a/1703799/184528 。与我的代码不同的是，我们只在必要时递归许多删除子目录和文件，第一次尝试调用 Directory.Delete 失败（这可能是由于 Windows 资源管理器查看目录而发生的）。

```
 public static void DeleteDirectory(string dir, bool secondAttempt = false)
    {
        // If this is a second try, we are going to manually 
        // delete the files and sub-directories. 
        if (secondAttempt)
        {
            // Interrupt the current thread to allow Explorer time to release a directory handle
            Thread.Sleep(0);

            // Delete any files in the directory 
            foreach (var f in Directory.GetFiles(dir, "*.*", SearchOption.TopDirectoryOnly))
                File.Delete(f);

            // Try manually recursing and deleting sub-directories 
            foreach (var d in Directory.GetDirectories(dir))
                DeleteDirectory(d);

            // Now we try to delete the current directory
            Directory.Delete(dir, false);
            return;
        }

        try
        {
            // First attempt: use the standard MSDN approach.
            // This will throw an exception a directory is open in explorer
            Directory.Delete(dir, true);
        }
        catch (IOException)
        {
            // Try again to delete the directory manually recursing. 
            DeleteDirectory(dir, true);
        }
        catch (UnauthorizedAccessException)
        {
            // Try again to delete the directory manually recursing. 
            DeleteDirectory(dir, true);
        } 
    } 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-11-30T21:29:37.953

您是否可能存在竞争条件，其中另一个线程或进程正在将文件添加到目录：

顺序是：

删除进程A：

1.  清空目录
2.  删除（现在为空）目录。

如果其他人在 1 和 2 之间添加了一个文件，那么也许 2 会抛出列出的异常？

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2011-09-22T17:17:57.357

我花了几个小时来解决这个问题和删除目录的其他异常。这是我的解决方案

```
 public static void DeleteDirectory(string target_dir)
    {
        DeleteDirectoryFiles(target_dir);
        while (Directory.Exists(target_dir))
        {
            lock (_lock)
            {
                DeleteDirectoryDirs(target_dir);
            }
        }
    }

    private static void DeleteDirectoryDirs(string target_dir)
    {
        System.Threading.Thread.Sleep(100);

        if (Directory.Exists(target_dir))
        {

            string[] dirs = Directory.GetDirectories(target_dir);

            if (dirs.Length == 0)
                Directory.Delete(target_dir, false);
            else
                foreach (string dir in dirs)
                    DeleteDirectoryDirs(dir);
        }
    }

    private static void DeleteDirectoryFiles(string target_dir)
    {
        string[] files = Directory.GetFiles(target_dir);
        string[] dirs = Directory.GetDirectories(target_dir);

        foreach (string file in files)
        {
            File.SetAttributes(file, FileAttributes.Normal);
            File.Delete(file);
        }

        foreach (string dir in dirs)
        {
            DeleteDirectoryFiles(dir);
        }
    } 
```

这段代码有小的延迟，这对我的应用程序并不重要。但要小心，如果您要删除的目录中有很多子目录，延迟可能会给您带来问题。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2019-11-08T14:43:01.847

您不必为递归创建额外的方法或删除额外文件夹内的文件。这一切都是通过调用自动完成的

> DirectoryInfo.Delete();

详情在[这里](https://docs.microsoft.com/en-us/dotnet/api/system.io.directoryinfo.delete?view=netframework-4.8)。

像这样的东西很好用：

```
 var directoryInfo = new DirectoryInfo("My directory path");
    // Delete all files from app data directory.

    foreach (var subDirectory in directoryInfo.GetDirectories())
    {
          subDirectory.Delete(true);// true set recursive paramter, when it is true delete sub file and sub folder with files too
    } 
```

**将 true 作为变量传递给 delete 方法，**也会删除子文件和带有文件的子文件夹。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-11-30T21:31:21.413

目录或其中的文件被锁定，无法删除。找到锁定它的罪魁祸首，看看你是否可以消除它。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2013-11-26T10:39:33.890

这是因为[**FileChangesNotifications。**](http://blogs.msdn.com/b/toddca/archive/2005/12/01/499144.aspx)[](http://blogs.msdn.com/b/toddca/archive/2005/12/01/499144.aspx)

 **它发生在 ASP.NET 2.0 之后。当您删除应用程序中的某个文件夹时，它**会重新启动**。您可以使用 [**ASP.NET Health Monitoring**](http://www.asp.net/web-forms/tutorials/deployment/deploying-web-site-projects/logging-error-details-with-asp-net-health-monitoring-cs)自己查看。

只需将此代码添加到您的 web.config/configuration/system.web：

```
<healthMonitoring enabled="true">
  <rules>
    <add name="MyAppLogEvents" eventName="Application Lifetime Events" provider="EventLogProvider" profile="Critical"/>
  </rules>
</healthMonitoring> 
```

之后退房`Windows Log -> Application`。到底是怎么回事：

删除文件夹时，如果有子文件夹，`Delete(path, true)`先删除子文件夹。FileChangesMonitor 知道删除和关闭您的应用程序就足够了。同时你的主目录还没有被删除。这是来自日志的事件：

![在此处输入图像描述](https://i.stack.imgur.com/4d3qO.jpg)

`Delete()`没有完成它的工作，因为应用程序正在关闭，它引发了一个异常：

![在此处输入图像描述](https://i.stack.imgur.com/QT6F3.jpg)

当您要删除的文件**夹中没有任何子文件**夹时，Delete() 只会删除所有文件和该文件夹，应用程序也会重新启动，但您**不会遇到任何异常**，因为应用程序重新启动不会中断任何事情。但是，您仍然会丢失所有进程中的会话，应用程序在重新启动时不响应请求等。

***现在怎么办？***

有一些变通方法和调整可以禁用此行为，[Directory Junction](http://blogs.msdn.com/b/toddca/archive/2005/12/01/499144.aspx)，[使用 Registry 关闭 FCN，](http://support.microsoft.com/kb/911272/en-us)使用[Reflection 停止 FileChangesMonitor（因为没有暴露的方法）](https://gist.github.com/bigsan/5203558)，但它们似乎都不正确，因为 FCN 存在原因。它*负责您的应用程序的结构*，而不是*您的数据结构*。简短的回答是：将要删除的文件夹放在应用程序之外。FileChangesMonitor 不会收到任何通知，并且您的应用程序不会每次都重新启动。你不会有任何例外。要让它们从网络上可见，有两种方法：

1.  制作一个控制器来处理来电，然后通过从应用程序外部（wwwroot 外部）的文件夹中读取来返回文件。

2.  如果您的项目很大并且性能最重要，请设置单独的小型快速网络服务器来提供静态内容。因此，您将把他的具体工作留给 IIS。它可以在同一台机器上（Windows 的猫鼬）或另一台机器（Linux 的 nginx）。好消息是您无需支付额外的 microsoft 许可证即可在 linux 上设置静态内容服务器。

希望这可以帮助。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2010-02-24T19:32:40.440

似乎在 Windows 资源管理器中选择路径或子文件夹足以阻止 Directory.Delete(path, true) 的单次执行，如上所述抛出 IOException 并死掉，而不是将 Windows 资源管理器引导到父文件夹并作为预期的。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2013-07-24T15:28:43.557

I've had this same problem with Windows Workflow Foundation on a build server with TFS2012\. Internally, the workflow called Directory.Delete() with the recursive flag set to true. It appears to be network related in our case.

We were deleting a binary drop folder on a network share before re-creating and re-populating it with the latest binaries. Every other build would fail. When opening the drop folder after a failed build, the folder was empty, which indicates that every aspect of the Directory.Delete() call was successful except for deleting the actually directory.

The problem appears to be caused by the asynchronous nature of network file communications. The build server told the file server to delete all of the files and the file server reported that it had, even though it wasn't completely finished. Then the build server requested that the directory be deleted and the file server rejected the request because it hadn't completely finished deleting the files.

Two possible solutions in our case:

*   Build up the recursive deletion in our own code with delays and verifications between each step
*   Retry up to X times after an IOException, giving a delay before trying again

The latter method is quick and dirty but seems to do the trick.

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2011-03-28T22:07:31.180

我今天遇到了这个问题。发生这种情况是因为我将 Windows 资源管理器打开到试图被删除的目录，导致递归调用失败，从而导致 IOException。确保没有打开该目录的句柄。

此外，MSDN 很清楚您不必编写自己的回避：http: [//msdn.microsoft.com/en-us/library/fxeahc5f.aspx](http://msdn.microsoft.com/en-us/library/fxeahc5f.aspx)

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2015-07-21T05:44:34.203

如上所述，“已接受”解决方案在重解析点上失败。有一个更短的解决方案可以正确复制功能：

```
public static void rmdir(string target, bool recursive)
{
    string tfilename = Path.GetDirectoryName(target) +
        (target.Contains(Path.DirectorySeparatorChar.ToString()) ? Path.DirectorySeparatorChar.ToString() : string.Empty) +
        Path.GetRandomFileName();
    Directory.Move(target, tfilename);
    Directory.Delete(tfilename, recursive);
} 
```

我知道，不处理后面提到的权限情况，但出于所有意图和目的，FAR BETTER 提供了原始/库存 Directory.Delete()的**预期功能***- 并且代码也少了很多*。

您可以安全地继续处理，因为旧目录将不受影响 *......即使因为“文件系统仍在追赶”（或 MS 提供的提供损坏功能的任何借口）而没有消失*。

作为一个好处，如果您知道您的目标目录很大/很深并且不想等待（或为异常而烦恼）最后一行可以替换为：

```
 ThreadPool.QueueUserWorkItem((o) => { Directory.Delete(tfilename, recursive); }); 
```

你仍然可以安全地继续工作。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2018-10-29T19:37:21.933

我已经用这种千年技术解决了（你可以把 Thread.Sleep 留在他自己的陷阱中）

```
bool deleted = false;
        do
        {
            try
            {
                Directory.Delete(rutaFinal, true);                    
                deleted = true;
            }
            catch (Exception e)
            {
                string mensaje = e.Message;
                if( mensaje == "The directory is not empty.")
                Thread.Sleep(50);
            }
        } while (deleted == false); 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2016-11-11T14:34:43.347

当目录（或任何子目录）中存在路径长度大于 260 个符号的文件时，此问题可能会出现在 Windows 上。

在这种情况下，您需要删除`\\\\?\C:\mydir`而不是`C:\mydir`. 关于 260 个符号的限制，您可以[在此处](https://msdn.microsoft.com/en-us/library/windows/desktop/aa365247%28v=vs.85%29.aspx)阅读。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-11-30T23:38:10.473

如果您的应用程序（或任何其他应用程序）的当前目录是您要删除的目录，则它不会是访问冲突错误，但目录不为空。通过更改当前目录确保它不是您自己的应用程序；另外，请确保该目录未在其他程序中打开（例如 Word、excel、Total Commander 等）。大多数程序将 cd 到最后打开的文件的目录，这会导致这种情况。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2011-03-03T02:12:05.770

如果是网络文件，Directory.DeleteHelper(recursive:=true) 可能会导致删除文件延迟导致的IOException

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2016-10-28T18:51:15.460

当方法异步并像这样编码时，我解决了上述问题的一个可能实例：

```
// delete any existing update content folder for this update
if (await fileHelper.DirectoryExistsAsync(currentUpdateFolderPath))
       await fileHelper.DeleteDirectoryAsync(currentUpdateFolderPath); 
```

有了这个：

```
bool exists = false;                
if (await fileHelper.DirectoryExistsAsync(currentUpdateFolderPath))
    exists = true;

// delete any existing update content folder for this update
if (exists)
    await fileHelper.DeleteDirectoryAsync(currentUpdateFolderPath); 
```

结论？摆脱用于检查 Microsoft 无法与之交谈的存在的句柄有一些异步方面。就好像 if 语句中的异步方法具有 if 语句的作用类似于 using 语句。

* * *

## 回答 #27

> 赞同：-2
> 
> 时间：2013-12-06T18:07:31.440

以上答案都不适合我。看来我自己的应用程序`DirectoryInfo`在目标目录上的使用导致它保持锁定状态。

强制垃圾收集似乎可以解决问题，但不是马上。在需要的地方进行了几次删除尝试。

请注意，`Directory.Exists`因为它可以在异常后消失。我不知道为什么我的删除被延迟（Windows 7 SP1）

```
 for (int attempts = 0; attempts < 10; attempts++)
        {
            try
            {
                if (Directory.Exists(folder))
                {
                    Directory.Delete(folder, true);
                }
                return;
            }
            catch (IOException e)
            {
                GC.Collect();
                Thread.Sleep(1000);
            }
        }

        throw new Exception("Failed to remove folder."); 
```

# delphi - 我可以在 Delphi 中为我自己的类重载运算符吗？

> ID：329359
> 
> 赞同：1
> 
> 时间：2008-11-30T21:01:25.873
> 
> 标签：delphi, oop, operators

我遇到了一点麻烦——我不知道我是否可以为我的类定义自己的运算符。例如：

```
type
  TMinMatrix = class(TMatrix)
    private
      RowAmount: Byte;
      ColAmount: Byte;
      Data: DataMatrix;
      DemVector, SupVector: SupplyDemand;
    public
      constructor Create(Rows, Cols: Byte);
      function GetRowAmount: Byte; override;
      function GetColAmount: Byte; override;
      destructor Destroy;
  end; 
```

我怎么能 - 或者我不能:) - 做类似的事情：

```
TMinMatrix TMinMatrix::operator=(TMinMatrix* matr)    (c++ code) 
```

而且，顺便说一句，我可以为我的类定义复制构造函数吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-30T21:30:32.617

Delphi Win32 2007 和 2009 仅支持记录的类运算符重载，可以有隐式和显式运算符。Delphi .Net 支持记录和类的类操作符。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-30T21:19:29.317

运算符重载在 Delphi .NET 版本中是可能的，旧版本的 Delphi 不支持它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-01T02:55:48.060

在 Delphi 中复制类的“传统”方法是重写 TPersistant 的“AssignTo”方法。这通常采取以下形式

```
TSubclass(Dest).Field1 := Field1;
TSubclass(Dest).Field2 := Field2; 
```

这有点痛苦。

然后 CreateCopy 构造函数将调用此方法：

```
constructor CreateCopy(ASource : TMyClass);
begin
  Create;
  Assign(ASource); // calls AssignTo
end; 
```

Delphi 后期（2006 年工作）版本中的另一个技巧是使用记录类型来存储字段。

```
class TMyClass = class(TPersistent)
protected
  type  // 2005+ only, otherwise use standalone record
    TMyRecord = record
    Name : string;
    ID : integer;
  end;

  FData : TMyRecord;
  procedure AssignTo(Dest : TPersistent);override;
public
  property Name : string read FData.Name;
  property ID: Integer read FData.ID;
end;

procedure TMyClass.AssignTo(Dest : TPersistent);
begin
  if Dest is TMyClass then
     TMyClass(Dest).FData := FData
  else
    inherited; // raise EConvertError
end; 
```

如果您继续在子类中添加字段，这会变得很混乱 - 需要添加新的记录类型，但它会自动处理添加到 TMyrecord 中的新字段（不必记住更新 AssignTo()）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-09-05T23:10:13.100

```
type
  TMinMatrix = class(TMatrix)
    public
      A : integer;
      class operator Add( ATM, BTM : TMinMatrix ) : TMinMatrix;
          // CTM := ATM + BTM
      class operator Subtract( ATM, BTM : TMinMatrix ) : TMinMatrix;
          // CTM := ATM - BTM;
    end;

class operator TMinMatrix.Add( ATM, BTM : TMinMatrix ) : TMinMatrix;
  begin
    result := ATM.A + BTM.A;
  end;

class operator TMinMatrix.Subtract( ATM, BTM : TMinMatrix ) : TMinMatrix;
  begin
    result := ATM.A - BTM.A;
  end;

var
  A, B, C : TMinMatrix;
begin
  C := A + B;  // calls Add()
  C := B - A;  // calls Subtract()
end. 
```

其他运营商有：

```
添加二进制 Add(a: type; b: type): resultType; +   
减二进制减法（a：类型；b：类型）：resultType；-   
乘二乘（a：type；b：type）：resultType；*   
Divide Binary Divide(a: type; b: type) : resultType; /
IntDivide Binary IntDivide(a: type; b: type): resultType; div   
Modulus Binary Modulus(a: type; b: type): resultType; 模组   
LeftShift Binary LeftShift(a: type; b: type): resultType; shl   
RightShift Binary RightShift(a: type; b: type): resultType; shr   
LogicalAnd Binary LogicalAnd(a: type; b: type): resultType; 和   
LogicalOr 二进制 LogicalOr(a: type; b: type): resultType; 或者   
LogicalXor 二进制 LogicalXor(a: type; b: type): resultType; 异或   
BitwiseAnd 二进制 BitwiseAnd(a: type; b: type): resultType; 和   
BitwiseOr 二进制 BitwiseOr(a: type; b: type): resultType; 或者   
BitwiseXor 二进制 BitwiseXor(a: type; b: type): resultType; 异或   

```

;)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-30T21:51:17.927

无论 Drejc 和 Cesar 说什么 + Delphi Win32 2007 和 2009 据我所知都不支持复制构造函数（我 100% 支持 D2007，不完全确定 D2009）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-09-06T15:33:37.290

Delphi Win32 中的运算符重载仅适用于记录，不适用于类。

它适用于 Delphi 2006 及更高版本，但在 Delphi 2007 中修复了一些错误，使它们更易于使用（与调用运算符结果的函数有关）。

我在 CodeRage 3 上进行了有关记录运算符重载的会议；[您可以在26326 CR3: Nullable Types w/ Records, Methods & Operator Overloading](http://cc.embarcadero.com/Item/26326)获取幻灯片和示例代码，和/或在[DOWNLOAD VIDEO REPLAY](http://cc.codegear.com/Download.aspx?id=26416)观看视频重播。

这是会议摘要：

> 具有记录、方法和运算符重载的可空类型 来自数据库的数据和 Delphi 本机类型的不同之处之一是对 NULL 的支持。当您在 Delphi 中大量使用数据库时，您希望拥有一个支持 NULL 的数据类型。过去您必须使用变体，但现在不再使用了！通过引入运算符重载，您也可以对记录类型执行此操作。本次会议向您展示如何。

运算符重载仅适用于 Delphi Win32（即非 .NET）中的记录的原因是记录是值类型，因此它们的内存管理是非动态的。类是引用类型，因此需要动态内存分配：它们需要垃圾收集器的概念才能让操作员处理它们。

因为在 Delphi Win32 中没有垃圾收集器的概念，所以在 Delphi Win32 中不可能有类的操作符。

请注意，[CodeRage 4 将于](http://conferences.embarcadero.com/coderage)下周开始。它有一个很好的演讲者和会议阵容。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-01T01:21:39.623

我想复制构造函数是一个习惯用法，而不是语言特性。
所以我可以这样做：
构造函数 CreateCopy(var t: MyType);

构造函数 MyType.CreateCopy(var t: MyType);
开始
//...
结束;

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-03-17T13:12:48.407

Delphi 允许在记录声明中重载某些函数或运算符。你可以在这里看到：http: [//edn.embarcadero.com/article/34324](http://edn.embarcadero.com/article/34324)

# wpf - 如何使用 WPF ListView 的 DateTime 格式的 GridViewColumn？

> ID：329373
> 
> 赞同：1
> 
> 时间：2008-11-30T21:11:34.013
> 
> 标签：wpf, listview

我有一个小型 WPF 应用程序；所有列模板都可以，它们是文本框，但我找不到如何将 DateTime 列（即像 DateTimePicker）绑定到 GridViewColumn。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-30T22:19:02.487

我不知道它是否会起作用，但你可以看看[这个](http://marlongrech.wordpress.com/2007/09/11/wpf-datepicker/)。[这里](http://www.codeplex.com/AvalonControlsLib)还存在一些 wpf 控件。

# asp.net-mvc - ASP.NET MVC 会话状态

> ID：329383
> 
> 赞同：8
> 
> 时间：2008-11-30T21:15:46.797
> 
> 标签：asp.net-mvc, session-state

我目前正在尝试使用 jquery 在 MVC 中创建带有进度条的上传控件。我一直遇到一个问题，但是 mvc 不能在并行线程中工作？

当我上传一个文件并显示从 JS 通过几个回调执行到服务器的上传过程中的进度时，我试图获取有关当前上传状态的信息，但只有在文件上传后服务器的回答才会返回。

您是否知道在 MVC 中不断或在执行请求时获取会话状态查询的任何方法？

真的很感激一些帮助，如果有人知道答案，我相信其他人会！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-30T22:36:25.540

如果您调用返回视图的操作，您将丢失视图状态。如果愿意，您可以使用 TempData 在操作之间传递数据，但这可能无法解决您的问题。在我看来，您想要的是一个返回 JSON 元素的操作，您可以使用一些异步 JavaScript 调用该元素。

对于您的行动，您将拥有：

```
public ActionResult GetSuggestions(string searchText)
{
    return Json(new { SearchText = searchText + "completestring"});
} 
```

然后在您的表单上，您有一些使用 jQuery 的异步 javascript：

```
function startAutoComplete() {
    var searchText = $("#inputText").val();
    $.getJSON("/Search/GetSuggestions?searchText=" + searchText, null, autoCompleteResponse);
}

function autoCompleteResponse(data) {
    if (data.SearchText) {
        $("#inputText").val(data.SearchText);
        $("#inputText").select();
    }
} 
```

这将允许您从服务器获取一些信息，而无需发布表单并保持客户端的视图状态完好无损。

[这里有一个完整的例子](http://oddiandeveloper.blogspot.com/2008/11/asynchronous-data-loading-in-aspnet-mvc.html)，可能会有所帮助。

# php - 单身遗产

> ID：329390
> 
> 赞同：3
> 
> 时间：2008-11-30T21:27:58.940
> 
> 标签：php, singleton

这里解释了单例： [http](http://en.wikipedia.org/wiki/Singleton_pattern#PHP_5) ://en.wikipedia.org/wiki/Singleton_pattern#PHP_5 。我想将单例类用作超类，并将其扩展到其他应该是单例的类中。问题是，超类自己创建一个实例，而不是子类。知道如何让超类创建子类的实例吗？

```
 class Singleton {

    // object instance
    private static $instance;

    protected function __construct() { }
    public function __clone() { }
    public function __wakeup() { }

    protected static function getInstance() {
        if (!self::$instance instanceof self) { 
            self::$instance = new self;

            if(self::$instance instanceof Singleton)
                echo "made Singleton object<br />";

            if(self::$instance instanceof Text)
                echo "made Test object<br />";
        }
        return self::$instance;
    }

}

class Test extends Singleton {

    private static $values=array();

    protected function load(){
        $this->values['a-value'] = "test";
    }

    public static function get($arg){
        if(count(self::getInstance()->values)===0)
            self::getInstance()->load();

        if(isset(self::getInstance()->values[$arg]))
            return self::getInstance()->values[$arg];

        return false;
    }
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-30T22:10:48.200

这是 PHP 的一个限制——父类无法确定静态调用其方法的子类的名称。

PHP 5.3 现在支持后期静态绑定，它可以让你做你需要做的事情，但要广泛使用还需要一段时间。[在这里](http://php.net/oop5.late-static-bindings)查看一些信息

这里有几个类似的问题，对于可能的解决方法可能值得一读，例如[这个](https://stackoverflow.com/questions/283004/getting-the-name-of-a-child-class-in-the-parent-class-static-context#283698)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T21:36:25.380

静态方法与其定义类型相关联，而不是实例。子类不继承静态方法（这没有意义）。它们仍然与父类型相关联。因此，与父类型绑定的 GET 方法将无法确定您只想获取哪种子类型。恐怕每个子类只需要实现自己的 GET 方法。

# certificate - 代码签名证书过期时会发生什么？

> ID：329396
> 
> 赞同：57
> 
> 时间：2008-11-30T21:32:36.387
> 
> 标签：certificate, code-signing, xbap

我正在考虑从 VeriSign 或 Thawte 购买代码签名证书来签署 XBAP。我的问题是：该证书到期时会发生什么？299 美元和 599 美元对于 1 年/2 年证书来说是相当高的价格，如果我必须在证书到期时向我的客户交付新签名的版本，那么我只需处理创建自己的证书的麻烦现在。

我不喜欢创建自己的证书的地方在于难以将其分发到将使用我的 XBAP 的所有客户端计算机。我的应用程序只会在 LAN 上使用，所以我想我总是可以使用 Windows Installer 来安装我自制的证书（尽管我不确定如何做到这一点 - 任何人有任何想法吗？）。

如果我交付的是部分信任的应用程序，这真的不是问题 - 但我的应用程序需要 Web 权限，因为它将与 WCF 服务通信，因此它位于部分信任和完全信任之间的灰色区域，并且没有证书，当我尝试加载我的 XBAP 时，我收到了有趣的 ole Trust Not Granted 消息。

有任何想法吗？

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2010-08-06T23:01:51.993

如果您 **在证书有效时为您的代码添加时间戳，则**效果是您的过期证书是好的。

来自[Thawte 代码签名证书常见问题解答](https://search.thawte.com/support/ssl-digital-certificates/index?page=content&id=AR1119)：

我可以使用代码签名证书多长时间？

*   代码签名证书的有效期为 1 年或 2 年，具体取决于您购买证书时选择的生命周期。请注意：对于 Microsoft® Authenticode®（多用途），您还应该为您的签名代码添加时间戳，以避免您的代码在证书过期时过期。

代码签名证书过期后带时间戳的代码是否有效？

*   Microsoft® Authenticode® (Multi-Purpose) 允许您为您的签名代码添加时间戳。时间戳确保在证书过期时代码不会过期，因为浏览器会验证时间戳。时间戳服务由 VeriSign 提供。如果您在签署代码时使用时间戳服务，您的代码的哈希将被发送到 VeriSign 的服务器以记录您的代码的时间戳。用户的软件可以区分使用不应信任的过期证书签名的代码和使用在代码签名时有效但随后已过期的证书签名的代码。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2011-03-16T23:28:51.030

注意设置了 WTD_LIFETIME_SIGNING_FLAG 的证书：这意味着（尽管您介意从名称中假设）使用该证书签名的程序在证书到期后*无效*，即使该程序没有更改，并且证书在它生效时是有效的已签署。

这也会影响更新，因为即使客户选中该框以信任您公司的所有程序，如果您的更新程序没有使用相同的证书（或该证书过期）签名，那么信任也会失败。

来自：http: [//download.microsoft.com/download/9/c/5/9c5b2167-8017-4bae-9fde-d599bac8184a/Authenticode_PE.docx](http://download.microsoft.com/download/9/c/5/9c5b2167-8017-4bae-9fde-d599bac8184a/Authenticode_PE.docx)

* * *

**使用生命周期签名语义的时间戳处理**

不希望时间戳签名无限期成功验证的应用程序或证书颁发机构有两种选择：

• 在发布者的签名证书中设置生命周期签名者OID。

如果发布者的签名证书除了包含 PKIX 代码签名 OID 之外还包含生命周期签名者 OID，则即使签名带有时间戳，当发布者的签名证书过期时，签名也会变得无效。生命周期签名者 OID 定义如下：

szOID_KP_LIFETIME_SIGNING 1.3.6.1.4.1.311.10.3.13

• 调用WinVerifyTrust 时，在WINTRUST_DATA 结构中设置WTD_LIFETIME_SIGNING_FLAG。

如果 WinVerifyTrust 调用方在 WINTRUST_DATA 结构中设置 WTD_LIFETIME_SIGNING_FLAG 并且发布者的签名证书已过期，则 WinVerifyTrust 将签名报告为无效，即使签名带有时间戳也是如此。

如果发布者撤销了包含生命周期签名者 OID 的代码签名证书，或者 WinVerifyTrust 调用者在 WINTRUST_DATA 结构中设置了 WTD_LIFETIME_SIGNING_FLAG，则如果满足以下两个条件，WinVerifyTrust 将报告签名为有效：

• 签名在撤销日期之前加盖时间戳。

• 签名证书仍在有效期内。有效期届满后，签名失效。

* * *

例如： [https ://forum.startcom.org/viewtopic.php?f=15&t=2215&p=6827&hilit=lifetime+signing#p6827](https://forum.startcom.org/viewtopic.php?f=15&t=2215&p=6827&hilit=lifetime+signing#p6827)

这是 StartSSL 证书的一个严重问题。成本如此之低的证书中存在限制并不让我感到惊讶，但是将这种限制隐藏在细则或旧论坛帖子中而不是在产品描述中明确表示是糟糕的业务。他们将来可能会修复它，而其他人可能有也可能没有相同的限制，因此在您花钱之前检查电子邮件可能是明智的。

猜猜谁不知道问？大声笑......哦，好吧，生活和学习。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2010-08-04T22:03:58.190

如果您确保在签署二进制文件时添加时间戳，则无需在证书到期时重新签署它们。只需在 signtool 的命令行中添加“/t [http://timestamp.verisign.com/scripts/timstamp.dll](http://timestamp.verisign.com/scripts/timstamp.dll) ”，数字签名将始终标记为有效，除非证书被吊销并且 CA 是受信任的。

代码签名证书如此昂贵的原因是有人必须验证你是你所说的那个人。就我而言，他们验证了地址和电话号码，并给我打电话。不过，Comodo 的证书似乎要便宜一些。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-30T22:22:36.770

如果您打算在封闭（LAN）环境中使用它，您应该做的是设置您自己的 CA。Windows Server 版本包括易于使用的证书颁发机构，但更简单的是通过[openssl](http://www.openssl.org/)提供的 demoCA 设置最小 CA ，它由几个脚本组成。您可以在 Windows 或[本地的](http://www.slproweb.com/products/Win32OpenSSL.html)[Cygwin](http://www.cygwin.com/)中运行 openssl demoCA 。这个 demoCA 包含几个 perl/bash 脚本，它们调用 openssl 命令来生成请求、签署证书/crls 等。

当您拥有自己的 CA 时，您需要安装的是您的 CA 根证书，因此更新用户证书将不再有麻烦，因为 CA 证书将保持不变。通常，CA 证书应持续 5-10 年，但您可以随意配置（请记住，它是您自己的 CA）。

CA 证书将安装在每台客户端计算机上。如果您的应用程序信任 Windows 系统安全性，则应将其安装在 IExplorer 证书颁发机构密钥库中。如果您使用 Java 应用程序，那么您应该在您使用的 Java 密钥库中分发 CA 证书。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-09-24T17:29:26.353

刚遇到这个问题。我[在这篇文章](https://blogs.oracle.com/java-platform-group/signed-code-needs-to-be-re-signed)中找到了解释，并连同[@BCran 的回答](https://stackoverflow.com/a/3410212/72350)一起解决了它。概括：

*   默认情况下，证书需要在验证期间**有效**（客户端打开程序时，而不是在编译时）
*   **要使证书永久有效，您需要使用 TimeStamping 服务器对程序进行签名。**这证明您没有更改计算机的时间并使用旧证书。如果您使用 TimeStamping 服务器，则无需每次都对代码进行签名。

这就是你在 VS.NET 2017 中的做法，例如：

[![代码签名视觉工作室 2017](https://i.stack.imgur.com/Uz3oG.png)](https://i.stack.imgur.com/Uz3oG.png)

如果 URL 不起作用，您可以使用任何服务，这里有一堆起作用的 URL：[https ://stackoverflow.com/a/9714864/72350](https://stackoverflow.com/a/9714864/72350)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-08-26T02:07:25.767

当心 WINDOWS 防御者。

你永远不希望你的证书过期，或者尽可能长，这似乎是 10 年。

一旦您的证书过期，Windows 将无法识别替换证书。您的应用程序排在队列的末尾，就好像它是由一个完全不同的组织签署的一样。

这意味着用户在下载时会收到讨厌的消息，并且可能根本无法运行您的代码，具体取决于组策略。这将一直持续到大量不同的人忽略了可怕的警告并安装了您的软件。

当然，时间戳服务器将使现有程序在证书到期后运行，但升级将是一个问题。

这对于本地使用的软件来说不是问题，但如果您想广泛分发您的软件，这将是一个大问题。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2020-12-23T12:52:23.557

BCran 写道：“代码签名证书如此昂贵的原因是有人必须验证你是你所说的那个人。”

称我为愚蠢，但有没有人想到开发人员可以在构建时自行计算其可执行应用程序的确切大小，以及是否将开发人员的身份包含在计算出的数字中，将哈希数插入应用程序的加密形式，并决定是否对应用程序进行时间限制或使其永久运行（因为用户机器上已经存在的可执行代码不太可能在 1、3、5、10 之后自行恶化或更改, 100, 100 万年）？

此外，如果有人可以验证您的电话号码和/或地址，也没有任何区别。如果开发人员选择，这些事情可以很容易地改变，而不是应用程序的代码。

优点：开发人员执行此任务不需要任何费用。同时，只要用户希望使用（或开发者允许使用），用户仍然可以放心使用有效且安全的应用程序，并且应用程序不会被篡改。还是苹果和微软等大玩家和证书颁发者必须诱使开发人员接受为这项服务持续付费？

注意：我对代码签名应用程序的天真和原始理解是防止任何人篡改应用程序的代码。但我越是看这个，它看起来更像是第三方个人和组织从开发人员那里赚钱的机会，从富人那里赚钱，而不是从不那么富有的人那里赚钱。好吧，总得有人去做，试图找出你是谁。但是我在互联网上看到的这项服务的价格差异很大，而且如此强调 1 年或 3 年的期限而没有永久签名应用程序的选项，这表明我们有一些人在城市里有非常昂贵的办公室来支付他们的费用租金和他们高昂的薪水。

为什么开发人员不要求 Apple 和 Microsoft 提供对开发人员的口袋更友好、对用户同样安全的安全解决方案？或者在下载时在开发者的网站上给出最终安装程序文件的确切大小（以字节为单位），用户可以检查。所陈述的任何额外或丢失的字节都应该足以告诉用户存在问题。强制开发人员拥有自己的网站，这样每个人都可以看到他们是谁以及从哪里获得合法且未经篡改的软件副本，并杜绝软件下载网站抓取开发人员软件的副本以从他们的网站下载。一切都应该在开发者的网站上完成，不要在其他地方完成。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2013-04-30T16:48:25.907

代码签名证书不是“托管”的，这意味着它们不会自行更新......一旦过期，您可能必须购买新证书。

您可以设置一个证书颁发机构 (CA) - 如果您是一家仅限 Windows 的商店，请坚持使用基于 Windows 的 CA，否则我会推荐 Linux 与[DogTag Certificate System 之](http://pki.fedoraproject.org/wiki/PKI_Main_Page)类的东西。

请注意，如果您创建自己的 CA，则需要导出公共 CA 证书并将其安装（因此它作为根 CA 被信任）将运行由该颁发的代码签名证书签名的代码/脚本的任何服务器加利福尼亚州。与每 X 年支付一次证书相比，这要便宜得多（免费？） - 更不用说您可能因各种原因/用途而颁发的其他证书！

# c++ - 指针变量是否也分配了内存地址？

> ID：329399
> 
> 赞同：3
> 
> 时间：2008-11-30T21:33:44.810
> 
> 标签：c++, pointers, memory-address

在 C++ 中，在堆栈上，一个简单的变量被分配了一个内存地址，这样我们就可以使用一个包含该内存的指针来指向它；那么指针是否也分配了内存地址？

如果是，我们可以有一个指针指针吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-30T21:36:19.190

是的你是对的。我们可以有指向指针的指针：

```
int a;
int b;
int * pa = &a;
int ** ppa = &pa;

// set a to 10
**ppa = 10;

// set pa so it points to b. and then set b to 11.
*ppa = &b;
**ppa = 11; 
```

从右到左阅读：*ppa 是一个指向 int 的指针*。它不限于`**`. 您可以拥有任意多个级别。`int ***`将是*指向指向 int 的指针的指针*。

我在这里回答了一个关于原始变量是否有地址的类似问题：原始变量 [是否分配了内存地址？](https://stackoverflow.com/questions/316194/is-primitive-assigned-a-memory-address#316310)，同样适用于指针。简而言之，如果您从不获取对象的地址，编译器就不必为其分配地址：它可以将其值保存在寄存器中。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-30T21:36:55.880

是的，您可以拥有指向指针的指针（或指向指针的指针），是的，必要时，指针也存储在内存中的某个地址处。

但是，与所有堆栈变量一样，如果编译器可以确定没有必要，则可以避免将数据写入内存。如果您从不获取变量的地址，并且它不必超出当前范围，编译器可能只是将值保存在寄存器中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-01T19:05:38.727

指针只是存储其他变量地址的变量（内存位置）。它自己的地址当然可以存储在其他地方。

# c# - SmtpClient 类未从 Web.Config 文件中获取默认参数

> ID：329411
> 
> 赞同：2
> 
> 时间：2008-11-30T21:37:53.973
> 
> 标签：c#, .net, asp.net-mvc, smtpclient

配置文件：

```
<system.net>
<mailSettings>
<smtp from="YYYYY@xxxxxx.com">
<network
host="mail.xxxxxx.com"
port="25"
password="password"
userName="user@xxxxxx.com"
defaultCredentials="false"
/>
</smtp>
</mailSettings>
</system.net> 
```

我已经尝试过 defaultCredentials="true" 但收到以下消息：

System.FormatException：Smtp 服务器返回无效响应。

如何解决问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-30T21:40:31.350

将 smtp 元素上的 deliveryMethod 属性设置为“network”。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-30T21:52:44.630

抱歉，打开了 ASP.NET MVC 中 Views 文件夹中的 web.config，而不是应用程序根目录中的那个 - DOH ！！！！！！

现在工作正常:))

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-30T21:50:26.133

您将这些元素放在 web.config 中的什么位置？它们应该如下所示：

```
<configuration>
  <system.net>
    <mailSettings>
      <smtp from="YYYYY@xxxxxx.com">
        <network host="mail.xxxxxx.com" port="25" password="password" userName="user@xxxxxx.com" defaultCredentials="false"/>
      </smtp>
    </mailSettings>
  </system.net>
<configuration> 
```

但是根据您得到的异常，听起来配置正在运行，但您的消息格式不正确。您的 MailMessage 是什么样的？您传递的发件人、电子邮件、主题和正文是什么？

# delphi - 我可以在抽象基类中保存任何数据成员吗？

> ID：329414
> 
> 赞同：3
> 
> 时间：2008-11-30T21:38:47.420
> 
> 标签：delphi, oop, inheritance

我有一个抽象类：

```
type
  TInterfaceMethod = class abstract
  public
    destructor Destroy;         virtual; abstract;
    function GetBasePlan: Word; virtual; abstract;
    procedure CountBasePlan;    virtual; abstract;
    procedure Calculate;        virtual; abstract;
    procedure PrepareForWork;   virtual; abstract;
  end; 
```

和派生类：

```
type
  TFogelMethod = class(TInterfaceMethod)
  private
    matrix: TFogelMatrix;
    BasePlan: Word;
  public
    constructor Create(var matr: TFogelMatrix);
    procedure Calculate;
    function GetBasePlan: Word;
    procedure CountBasePlan;
    procedure PrepareForWork;
    destructor Destroy;
  end; 
```

问题是，我可以将 GetBasePlan 和 CountBasePlan 方法的实现放入基类中，使它们只是虚拟的 - 不像现在那样抽象 - 并将成员 BasePlan 放在那里吗？那么，我可以这样做：

```
type
  TInterfaceMethod = class abstract
  private
   BasePlan: Word;
  public
    destructor Destroy;         virtual; abstract;
    function GetBasePlan: Word; virtual; 
    procedure CountBasePlan;    virtual; 
    procedure Calculate;        virtual; abstract;
    procedure PrepareForWork;   virtual; abstract;
  end; 
```

如果我能做到，从面向对象设计的角度来看会不会很好，我怎样才能从派生类中准确地访问这个成员？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-30T21:40:18.917

是的你可以。抽象类是类，它们可以有实现。

通过将 abstract 关键字添加到类，您禁止实例化该类。它不需要任何抽象方法。

可以实例化具有抽象方法的类，但这会导致在编译时出现警告，并且在调用该方法时会出现异常。

接口没有实现，它们必须由类实现（顺便说一下，它可以是抽象的）。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-30T21:45:39.777

只是为了添加到 Gamecat 的答案中，不仅你可以，而且你应该把你的通用代码放在那里。

# .net - 您使用什么 .NET 语言编写单元测试？

> ID：329422
> 
> 赞同：5
> 
> 时间：2008-11-30T21:43:29.050
> 
> 标签：.net, unit-testing

过去，即使实际的软件开发是使用另一种 .NET 语言（VB.NET、C++.NET 等），我也使用 C# 编写了大部分单元测试，但我可以使用 VB 来获得相同的结果。我想我使用 C# 的唯一原因是因为互联网上的大多数示例都是用 C# 编写的。

我将单元测试用作 .NET 软件开发的一部分，您**更喜欢**使用哪种语言，您选择使用它的原因是什么？

我知道这在很大程度上取决于被测项目的语言，但我有兴趣找出在单元测试时是否偏好使用特定语言。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-30T21:52:05.380

您应该使用适合您的开发团队的任何语言。

除了项目其余部分所用的语言之外，我看不出你会用什么语言编写单元测试，因为它可能会引起混淆，或者要求开发人员知道两种不同的语言才能在项目上工作.

测试应遵循 KISS 原则。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T21:53:52.960

C#，因为这是编写所有新代码库的内容。我想说这在很大程度上取决于公司首选的语言是什么。如果可能的话，我认为最好尽可能修复一个，这也是编写测试的内容。如果只有少数人用 C++ 编写，那么将更常用的语言仍然作为测试，以便更多人可以很好地使用它们。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T21:51:19.220

我用 C# 编写所有 .Net 应用程序/业务代码，因此用 C# 编写单元测试也很自然。我认为用另一种语言编写测试代码会在测试代码和应用程​​序代码之间引入不必要的分离。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-30T22:19:46.247

我几乎总是用我正在开发应用程序的相同语言编写我的单元测试。除了这似乎是最合乎逻辑的想法之外，我真的没有理由这样做。我可以用多种语言编程，但这并不意味着在我之后拿起代码的人可以。

我确实有一个例外。当我用 F# 编写代码时，我经常用 C# 编写单元测试。即因为 IDE 不能很好地支持 F# 单元测试。

第二个原因是单元测试通常不是很好的代码。它可能需要不时进行一些 awkard 设置来测试角落场景。在那种情况下，我经常发现 F# 类型的安全性使得测试该场景变得困难。这可能只是我缺乏使用 F# 的经验，但我发现使用 C# 创建这些场景更容易。

# multithreading - 并行化“MapReduce”中的“Reduce”

> ID：329423
> 
> 赞同：10
> 
> 时间：2008-11-30T21:44:10.653
> 
> 标签：multithreading, optimization, map, multicore, reduce

我了解 Map 如何轻松并行化 - 每台计算机/CPU 只能在阵列的一小部分上运行。

减少/折叠是否可并行化？似乎每个计算都取决于前一个。对于某些类型的函数，它只是可并行化的吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-30T22:01:04.647

如果您的归约基础操作是关联的*，您可以使用操作顺序和位置。因此，您通常在“收集”阶段具有树状结构，因此您可以在对数时间内分多次完成：

```
a  +  b  +  c  +  d
 \   /       \   /
 (a+b)       (c+d)
     \       /
   ((a+b)+(c+d)) 
```

而不是 (((a+b)+c)+d)

如果您的操作是可交换的，则可以进一步优化，因为您可以按不同的顺序收集（例如，当这些操作是向量操作时，数据对齐可能很重要）

[*] 你真正想要的数学运算，当然不是像浮点数这样的有效类型。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-30T22:25:24.330

是的，如果运算符是关联的。例如，您可以并行求和一个数字列表：

```
step 1: 1 + 2 + 3 + 4 + 5 + 6 + 7 + 8
step 2:   3   +   7   +   11  +   15
step 3:       10      +       26
step 4:               36 
```

这是因为 (a+b)+c = a+(b+c)，即执行加法的顺序无关紧要。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-30T23:00:52.637

查看 Hadoop 中的合并阶段

[http://wiki.apache.org/hadoop/HadoopMapReduce](http://wiki.apache.org/hadoop/HadoopMapReduce)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-30T22:00:17.190

不确定您在考虑什么平台/语言，但您可以并行化 reduce 运算符，如下所示：

```
// Original
result = null;
foreach(item in map) {
    result += item;
}

// Parallel
resultArray = array();
mapParts = map.split(numThreads);
foreach(thread) {
    result = null;
    foreach(item in mapParts[thread]) {
        result += item;
    }
    resultArray += result;    // Lock this!
}
waitForThreads();
reduce(resultArray); 
```

如您所见，并行实现很容易递归。您将映射拆分，在其自己的线程中对每个部分进行操作，然后在这些线程完成后执行另一个 reduce 以将各个部分组合在一起。

（这是[Piotr Lesnick 的答案](https://stackoverflow.com/questions/329423/parallelizing-the-reduce-in-mapreduce#329465)背后的程序化推理。）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-02-09T02:10:23.303

从技术上讲，reduce 与 foldl（左折叠）不同，后者也可以描述为累积。

Jules 给出的例子很好地说明了 reduce 操作：

```
step 1: 1 + 2 + 3 + 4 
step 2:   3   +   7   
step 3:       10 
```

请注意，在每一步，结果都是一个数组，包括最终结果，它是一个包含一项的数组。

fold-left 如下所示：

```
step 0: a = 0
step 1: a = a + 1 
step 2: a = a + 2 
step 3: a = a + 3
step 4: a = a + 4
step 5: a 
```

现在显然这些都产生相同的结果，但是当给定非关联运算符（如减法）时 foldl 具有明确定义的结果，而 reduce 运算符则没有。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-08T18:43:21.140

这取决于您的减少步骤。*在 MapReduce 的 Hadoop 风格实现中，您的 Reducer每个键*被调用一次，所有行都与该键相关。

因此，例如，您的 Mapper 可能会接收大量无序的 Web 服务器日志，添加一些元数据（例如，地理编码），并发出以 cookie ID 作为键的 [key, record] 对。然后，每个 cookie ID 将调用您的 Reducer 一次，并为该 cookie 提供所有数据，并可以计算聚合信息，例如访问频率或每次访问查看的平均页面。或者您可以键入地理编码数据，并根据地理位置收集汇总统计数据。

即使你没有进行每个键的聚合分析——事实上，即使你在整个集合上计算一些东西——也有可能将你的计算分成块，每个块都可以输入到 Reducer。

# xml - 从 XML 数据源构建报告

> ID：329424
> 
> 赞同：0
> 
> 时间：2008-11-30T21:44:16.817
> 
> 标签：xml, reportbuilder

我正在寻找一种面向图形的 D&D 类型工具/实用程序，可用于从 XML 数据文件中包含的数据构建临时报告。用户是技术人员，但不是开发人员——所以 XSLT 是正确的......

Eclipse 的 BIRT 做这种事情，但更轻量级的东西是首选。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T09:08:45.313

只是一些您可以查看的（商业）工具的基本列表：

*   MS Word 中的附加 XML 架构
*   微软信息路径
*   Windward 报告（也基于 MS Word）
*   Altova Stylevision

# svn - Subversion 的隐藏修订文件

> ID：329429
> 
> 赞同：3
> 
> 时间：2008-11-30T21:46:59.837
> 
> 标签：svn, revision

您知道 Subversion 是如何在隐藏的 .svn 文件夹中存储它检出的每个文件的副本的吗？我正在建立的网站非常大（有超过 1Gig 的 PDF 文件）。这些 PDF 文件在网站存在期间很少会更改。

我想知道是否有办法告诉 Subversion 它不应该存储特定文件集（我的 PDF 文件）的本地修订副本，而只要对这些文件中的任何一个进行更改就与服务器同步？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-30T23:11:17.030

Subversion 使用 .svn 文件夹中的版本来区分新文件和旧文件，并将差异发送到 subversion 服务器。

所以不，没有办法在 .svn 文件夹中没有文件，这仍然允许您提交这些文件

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T22:00:22.557

一个不同的想法：如果您使用 Bazaar+bzr-svn 或 Git+git-svn，它们会保留更节省空间的工作副本，您仍然可以直接从存储库进行更新。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T21:50:48.253

您可能需要考虑使用`svn export`而不是结帐来管理您网站的“实时”副本。这将完全避免 .svn 文件夹中的大文件问题。

您的工作流程可能是这样的：

1.  在本地编辑文件，在测试部署中测试
2.  提交对存储库的更改
3.  从存储库运行`svn export`到实时系统

这样做的缺点是，在此期间可能对实时系统所做的任何更改都将被覆盖。但是您可以安排您的工作流程来避免这种情况。

实际上，我突然想到，我不知道您是在工作结帐中还是在服务器部署中担心这些隐藏的 PDF 文件。如果它在您的工作结帐中，那么我不知道使用 Subversion 避免这些文件的方法。但是，如果您将 Git 与 一起使用`git-svn`，那么 Git 将管理自己的压缩历史记录，而不需要所有文件的完整副本。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-01T00:02:52.620

正如 Greg 所说，使用 SVN 导出 - 但将 SVN 导出到本地目录，然后将该本地目录同步到远程站点。

这为您提供了 (a) 没有 .svn 目录和 (b) 仅将更改从本地系统发送到远程的组合。

如果不这样做，正如 Greg 和 orip 所建议的那样，请使用“git-svn”进行远程结帐。在 svn 导出所消耗的空间上，它仍然有一些开销，但它会小于完整的 svn 工作副本。

# windows-mobile - iPAQ 上的 MySaifu JVM 和 BlueCove API

> ID：329430
> 
> 赞同：2
> 
> 时间：2008-11-30T21:47:52.817
> 
> 标签：windows-mobile, jvm, bluetooth

在我的 iPAQ (h5550) 上运行 BlueCove 有点问题。我安装了 MySaifu JVM 并将 BlueCove jar 库添加到类路径中，但是每当我尝试运行测试器 jar 或任何其他引用 BlueCove API 的文件时，我都会遇到类未找到异常。

有人有同样的问题吗？我从 BlueCove 文档中知道它已经在 Windows CE 上的 MySaifu 上进行了测试，这个名称有时（令人困惑）可与 Windows Mobile 和 Pocket PC 互换使用，所以也许这只是兼容性的一个例子？

任何帮助，将不胜感激。

概括：

*   Bluecove 添加到 MySaifu 类路径后无法正常工作
    *   类未找到异常
*   iPAQ h5550
    *   Windows Mobile 2003（掌上电脑）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-30T22:15:00.233

前段时间我测试了MySaifu JVM，它似乎没有完全实现CDC Personal Profile 1.1（最完整的）。我不知道该程序需要什么 J2ME 配置文件，但问题可能从那时开始。

另一个问题是，并非所有 Windows CD/Mobile 平台都是相同的，因此在 Windows Mobile 2003 PDA 上运行正常的程序可能无法在另一台 Windows Mobile 2003 PDA 上运行。

如果您计划开发企业级 Java 应用程序，那么今天唯一可接受的选择是[IBM Everyplace WebSphere Micro Envinronment](http://www-01.ibm.com/software/wireless/weme/)（以前称为 J9 JVM），虽然许可证非常便宜，但它不是免费的。

无论如何，如果您打算坚持使用 MySaifu，则粘贴异常将有助于澄清错误所在。

# asp.net-mvc - 在 ASP.NET MVC 中，如何在提交表单时获取控件的错位名称？

> ID：329447
> 
> 赞同：2
> 
> 时间：2008-11-30T21:55:34.407
> 
> 标签：asp.net-mvc

我有一个`<asp:Content>`正在提交给控制器的块内的表单。对于其中一个控件，我需要直接从中获取一些信息，这些信息不会通过调用自动发生`UpdateModel()`。

但是，在`Request.Form`字典中，控件的 id 是 mangled form `ctl00$ContentPlaceHolder${name}`。鉴于我在控制器中，此时对视图一无所知，访问控件数据的正确方法是什么？

这是视图 (.aspx) 的样子（删除了无关代码）：

```
<%@ Register Assembly="FredCK.FCKeditorV2" Namespace="FredCK.FCKeditorV2" TagPrefix="FCKeditorV2" %>

<%@ Page Title="" Language="C#" MasterPageFile="~/Views/Shared/Admin.Master" AutoEventWireup="true"
    CodeBehind="...." Inherits="...." %>

<asp:Content ID="Content3" ContentPlaceHolderID="ContentPlaceHolder" runat="server">

    <form id="form1" action="..." method="post">

            <FCKeditorV2:FCKeditor ID="AuthorBio" runat="server" Height="250"/>
            <input type="submit" value="Save" />
    </form>

</asp:Content> 
```

命名的控件在字典`AuthorBio`中的控制器中显示为`Form.Request``ctl00$ContentPlaceHolder$AuthorBio$`

我尝试将第 3 方控件与“runat-server”一起使用的原因是因为我需要将编辑器的值设置如下：

```
AuthorBio.Value = HttpUtility.HtmlDecode(ViewData.Model.Bio); 
```

尝试在 FCKeditorV2 标记中的 .aspx 文件中执行此操作不起作用。（或者也许我也错过了一些东西）

好的，所以关键是使用编辑器的 JavaScript 版本而不是包装的控件。还有一个方便的评论，我将在此处包含已接受的答案：

> 您应该使用 javascript 版本的 FCKEditor 控件而不是 .NET 自定义控件，因为 .NET 自定义控件是基于 WebForms 范例构建的。JS 版本应该有一个 Html 值的隐藏字段，您可以使用 Request["FieldName"] 在控制器中访问它

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-30T22:47:26.113

FCKEditor 是一个标准的 javascript 库，它也包含在 Webforms 的 ASP.NET 控件中。所以在没有 ASP.NET 控件的情况下使用 FCKEditor javascript 会更容易。以这种方式集成到 MVC 中会更容易。

如果您必须使用 ASP.NET 控件版本，那么您将遇到这些问题。但一种解决方案是将 FCKeditor 放置在标准的 Web 表单页面上，然后使用 Greybox 之类的工具在对话框中显示。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-30T22:54:36.910

因为名称修饰取决于控件的使用方式，所以我认为您必须搜索它。确保它具有唯一的名称，然后遍历 Request.Form（或 FormCollection，如果使用它作为参数）并查找以“$ControlName”结尾的键。当您找到该名称时，请使用该键获取该值。

```
string editorKey = null;
foreach (string key in Request.Form.Keys)
{
    if (key.EndsWith( "$AuthorBio" ))
    {
       editorKey = key;
       break;
    }
}

if (!string.IsNullOrEmpty( editorKey ))
{
    ... process
} 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-30T22:05:20.613

您使用的是 WebForm 控件吗？据我所知，默认的 ASP.NET MVC 视图引擎不会破坏控件 ID。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-30T22:37:31.157

传统 ASP.NET：runat="server" ASP.NET MVC = 没有“runat=server”控件。

您没有正确使用 MVC。您想要使用“runat=server”控件这一事实意味着您应该使用传统的 ASP.NET 应用程序。

这是一篇半旧的文章，但您可能想查看它以了解 ASP.NET 和 MVC 之间的区别：[http ://www.singingeels.com/Articles/ASPNET_MVC_in_the_Real_World.aspx](http://www.singingeels.com/Articles/ASPNET_MVC_in_the_Real_World.aspx)

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-11-30T22:30:30.843

一种选择是在提交按钮后面编写一些 javascript，将表单发布变量设置为您想要的。您可以使用一个隐藏字段，在更改您的 AuthorBio 时更新，或者您可以在提交时以编程方式设置它。

# c# - 如何在 .NET 中从矩形源区域复制到非矩形/非平行四边形目标区域？

> ID：329448
> 
> 赞同：0
> 
> 时间：2008-11-30T21:56:17.260
> 
> 标签：c#, .net, graphics

我知道如何使用 Graphics 对象的 DrawImage() 方法从矩形源区域复制到矩形目标区域，以及如何复制到由三元素 Point[] 数组定义的平行四边形区域。

.NET 中有什么方法可以从矩形源区域复制到 4 边非矩形目标区域（由四个任意点定义）？

**更新**。这是一些将图像复制到平行四边形区域的示例代码：

```
using (Graphic g = this.CreateGraphics())
{
    List<Point> pts = new List<Point>();
    pts.Add(new Point(0, 0));
    pts.Add(new Point(100, 0));
    pts.Add(new Point(10, 100));
    g.DrawImage(pbSource.Image, pts.ToArray());
} 
```

如果我添加第四点，我会得到“未实现”异常。

**更新 2**。完全可以在 .NET 中执行此操作*：*

[替代文字 http://www.freeimagehosting.net/uploads/a770d1e97f.jpg](http://www.freeimagehosting.net/uploads/a770d1e97f.jpg)

但你必须自己做，逐个像素。图片由[Jonbert](https://stackoverflow.com/questions/305223/jon-skeet-facts#309319)提供。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T04:13:16.173

据我所知，在 .NET 中没有一种简单的（内置）方法可以进行这种图像转换。

如果您在 codeproject 上查看[Anti Aliased Image Transformation (Aaform)](http://www.codeproject.com/KB/graphics/Aaform.aspx)，您可以下载他的示例，其中包含该概念的纯 vb 实现（以及 vb 和 c++ 示例）。

还有[Anti-Grain Geometry](http://antigrain.com/)，一个免费使用（用于非商业）的 c++ 图形库和[ac# 包装器](http://www.creativedocs.net/devs/agg)。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-02T15:11:08.920

完全可以在 .NET 中执行此操作*：*

[替代文字 http://www.freeimagehosting.net/uploads/a770d1e97f.jpg](http://www.freeimagehosting.net/uploads/a770d1e97f.jpg)

但你必须自己做，逐个像素。图片由[Jonbert](https://stackoverflow.com/questions/305223/jon-skeet-facts#309319)提供。

# testing - 您使用什么方法来测试 debian/ubuntu 软件包？

> ID：329463
> 
> 赞同：1
> 
> 时间：2008-11-30T22:00:28.953
> 
> 标签：testing, ubuntu, debian, packaging, chroot

我说的是测试你正在构建的包，尤其是生成守护进程和/或使用 init.d 的包。

你登录到某种 chroot 吗？您是否创建了一个虚拟化发行版并将其拆除？您如何在下次运行测试时测试您的运行时依赖项和测试套件而不会弄脏您的开发机器？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T22:08:35.473

在测试后重置为“干净”状态的虚拟机将是最简单的。VMWare 和 Parallels 的“快照”功能非常适合这个..

您将安装 Debian 或 Ubuntu，然后拍摄快照（[VMware](http://www.vmware.com/support/ws5/doc/ws_preserve_sshot_taking.html)和[Parallels](http://www.parallels.com/products/desktop/features/snapshots/)的操作指南）。然后你会安装你的包并测试安装、使用和删除它。

完成后，恢复到您拍摄的快照很简单（比完全重新安装要快得多）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-30T22:05:57.880

chroots 通常用于包测试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-03T18:15:26.903

我个人在开发包的过程中使用自己的机器。如果您要为较旧的发行版打包，这是不可能的，但如果您的打包代码有很多流失，它比使用任何其他解决方案要快得多。

要测试包构建，您需要使用基于 chroot 的工具，例如 pbuilder、cowbuilder 或 sbuild。这确保了包将正确依赖于目标分发来构建。

您可以在 chroot 中测试一些软件，但是诸如网络守护程序之类的东西会与主机上运行的其他守护程序发生冲突。

如果您的软件包集很复杂，您可以使用的最佳测试环境是支持快照的 VM 软件。您需要使用您的目标发行版创建一个虚拟化环境并在其上安装软件包。使用快照，您可以将操作环境重置回其安装后的状态。

您只能使用一个快照，但 VirtualBox 支持多个快照，这为复杂测试提供了额外的灵活性。

# sql - SQL按天分组，显示每天的订单

> ID：329477
> 
> 赞同：15
> 
> 时间：2008-11-30T22:06:28.410
> 
> 标签：sql, sql-server-2005, aggregate

我有一个 SQL 2005 表，我们称之为 Orders，格式为：

```
OrderID, OrderDate,  OrderAmount
1,       25/11/2008, 10
2,       25/11/2008, 2
3,       30/1002008, 5 
```

然后我需要生成一个报告表，显示过去 7 天内每天的订购量：

```
Day,        OrderCount, OrderAmount
25/11/2008, 2,          12
26/11/2008, 0,          0 
27/11/2008, 0,          0 
28/11/2008, 0,          0
29/11/2008, 0,          0
30/11/2008, 1,          5 
```

通常会产生这个的 SQL 查询：

```
select count(*), sum(OrderAmount)
    from Orders
    where OrderDate>getdate()-7
    group by datepart(day,OrderDate) 
```

有一个问题是它会跳过没有订单的日子：

```
Day,        OrderCount, OrderAmount
25/11/2008, 2,          12
30/11/2008, 1,          5 
```

通常我会使用一个计数表和外部连接来解决这个问题，但我真的在寻找一个更简单或更有效的解决方案。对于报表查询来说，这似乎是一个常见的要求，应该已经有一些优雅的解决方案可用。

所以： 1\. 这个结果可以通过一个简单的查询而不使用计数表获得吗？

和 2\. 如果不是，我们是否可以动态创建这个计数表（可靠）（我可以使用 CTE 创建一个计数表，但递归堆栈将我限制为 100 行）？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-30T22:31:57.767

SQL 不是“跳过”日期……因为查询是针对实际在表中的*数据运行的。*所以，如果表中没有 1 月 14 日的 DATE，那么 SQL 为什么会显示结果：)

您需要做的是制作一个临时表，然后加入它。

```
CREATE TABLE #MyDates ( TargetDate DATETIME )
INSERT INTO #MyDates VALUES CONVERT(DATETIME, CONVERT(VARCHAR, GETDATE() - 0, 101))
INSERT INTO #MyDates VALUES CONVERT(DATETIME, CONVERT(VARCHAR, GETDATE() - 1, 101))
INSERT INTO #MyDates VALUES CONVERT(DATETIME, CONVERT(VARCHAR, GETDATE() - 2, 101))
INSERT INTO #MyDates VALUES CONVERT(DATETIME, CONVERT(VARCHAR, GETDATE() - 3, 101))
INSERT INTO #MyDates VALUES CONVERT(DATETIME, CONVERT(VARCHAR, GETDATE() - 4, 101))
INSERT INTO #MyDates VALUES CONVERT(DATETIME, CONVERT(VARCHAR, GETDATE() - 5, 101))
INSERT INTO #MyDates VALUES CONVERT(DATETIME, CONVERT(VARCHAR, GETDATE() - 6, 101))
INSERT INTO #MyDates VALUES CONVERT(DATETIME, CONVERT(VARCHAR, GETDATE() - 7, 101))

SELECT CONVERT(VARCHAR, TargetDate, 101) AS Date, COUNT(*) AS OrderCount
FROM dbo.Orders INNER JOIN #MyDates ON Orders.Date = #MyDates.TargetDate
GROUP BY blah blah blah (you know the rest) 
```

给你！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-10-26T05:37:39.277

我有同样的问题，这就是我解决它的方法：

```
SELECT datename(DW,nDays) TimelineDays, 
    Convert(varchar(10), nDays, 101) TimelineDate,
    ISNULL(SUM(Counter),0) Totals 
FROM (Select GETDATE() AS nDays
    union Select GETDATE()-1
    union Select GETDATE()-2
    union Select GETDATE()-3
    union Select GETDATE()-4
    union Select GETDATE()-5
    union Select GETDATE()-6) AS tDays

Left Join (Select * From tHistory Where Account = 1000) AS History
            on (DATEPART(year,nDays) + DATEPART(MONTH,nDays) + DATEPART(day,nDays)) = 
            (DATEPART(year,RecordDate) + DATEPART(MONTH,RecordDate) + DATEPART(day,RecordDate)) 
GROUP BY nDays
ORDER BY nDays DESC 
```

输出是：

```
TimelineDays,   TimelineDate,     Totals

Tuesday         10/26/2010        0
Monday          10/25/2010        6
Sunday          10/24/2010        3
Saturday        10/23/2010        2
Friday          10/22/2010        0
Thursday        10/21/2010        0
Wednesday       10/20/2010        0 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T22:24:19.590

根据 SQL Server 处理临时表的方式，您可以或多或少轻松地安排创建一个临时表并使用您感兴趣的 7 个（或者是 8 个？）日期填充它。然后您可以将其用作您的计数表。据我所知，没有一种更清洁的方法；您只能选择存在于表中的数据，或者可以从存在于一个表或一组表中的数据派生的数据。如果订单表中没有显示日期，则无法从订单表中选择这些日期。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-08-21T20:12:53.323

如果您想查看零值而不是输入以下查询：

```
select count(*), sum(OrderAmount)
from Orders
where OrderDate>getdate()-7
  and sum(OrderAmount) > 0 or sum(OrderAmount) = 0
group by datepart(day,OrderDate) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-12-23T13:37:30.883

```
CREATE PROCEDURE [dbo].[sp_Myforeach_Date]
    -- Add the parameters for the stored procedure here
    @SatrtDate as DateTime,
    @EndDate as dateTime,
    @DatePart as varchar(2),
    @OutPutFormat as int 
AS
BEGIN
    -- SET NOCOUNT ON added to prevent extra result sets from
    -- interfering with SELECT statements.
    Declare @DateList Table
    (Date varchar(50))

    WHILE @SatrtDate<= @EndDate
    BEGIN
    INSERT @DateList (Date) values(Convert(varchar,@SatrtDate,@OutPutFormat))
    IF Upper(@DatePart)='DD'
    SET @SatrtDate= DateAdd(dd,1,@SatrtDate)
    IF Upper(@DatePart)='MM'
    SET @SatrtDate= DateAdd(mm,1,@SatrtDate)
    IF Upper(@DatePart)='YY'
    SET @SatrtDate= DateAdd(yy,1,@SatrtDate)
    END 
    SELECT * FROM @DateList
END 
```

只需输入此代码并以这种方式调用 SP

```
exec sp_Myforeach_Date @SatrtDate='03 Jan 2010',@EndDate='03 Mar 2010',@DatePart='dd',@OutPutFormat=106 
```

**谢谢 * *[Suvabrata Roy](http://mailto%3asuvabrataroy@gmail.com)*** *ICRA Online Ltd. 加尔各答**

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-01T22:07:19.173

由于您也希望在其他查询中经常使用此日期表，因此我建议您将其设为永久表并创建一个作业以每年添加一次新年日期。

# asp.net - Identifying memory problems in an ASP.NET application

> ID：329485
> 
> 赞同：9
> 
> 时间：2008-11-30T22:12:44.637
> 
> 标签：asp.net, iis, memory, profiling

I've got an ASP.NET application running and on the production box it's using about 450MB RAM, however, it shouldn't be using quite so much, and it seems to increase over time, so it seems there might be a leak or atleast something not being released properly.

I took a look with PerfMon and there was 416MB in GC Gen2\.

Anyone have any idea for finding out what it's keeping in memory? Could I just grab dotTrace/ANTS and somehow attach it to my IIS (6 - on windows server 2003) - or is there a better way? :-)

Thanks.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-01T13:03:42.030

The classic problem of newing up a bunch of strings in a loop could cause the issue you're seeing due to large amounts of memory being allocated for new strings without releasing them. Are you using StringBuilder where appropriate?

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-01T01:56:06.683

Watching [this](http://channel9.msdn.com/posts/MSDNSweden/Vanliga-fel-som-grs-med-ASPNET-och-hur-du-hittar-dem-med-WinDbg/) TecheEd presentation by Tess would be a good start.

She demonstrates using adplus to take a dump of an ASP.NET application that is consuming a great deal of RAM, then loading that dump into WinDbg for analysis. Use the !gcroot command in WinDbg to find unexpected roots and go from there. She advises against storing complex types that contain references to other objects in cache or session.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T22:29:15.073

Although this is a specific blog about a technology you're probably not using it does cover how to diagnose memory issues - [http://blogs.msdn.com/tess/archive/2008/09/12/asp-net-memory-issues-high-memory-usage-with-ajaxpro.aspx](http://blogs.msdn.com/tess/archive/2008/09/12/asp-net-memory-issues-high-memory-usage-with-ajaxpro.aspx)

Dig through Tess's work, she's got a lot of debugging/ diagnosis posts and I'm sure you can find more which are of use to you.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-04T13:02:23.437

Are you properly unwiring event handlers everywhere? I'm told that they might be sitting around if you never detach them from the event. They might be keeping references to larger objects longer than necessary.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-01T01:00:50.057

Are you properly disposing of objects of classes that implement IDisposable? This would include SqlConnections, SqlCommand, SqlDataAdapter, DirectoryEntry, etc. Do you have any objects that use unmanaged memory that don't implement IDisposable (and/or aren't getting disposed)?

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-01T07:44:03.533

I am pretty sure that you have been through all the motions already by now, but i had a similar problem on a site i maintain.

The site was using roughly a gig of memory on the server , and much check and cleaning , we had to get rid of a lot of session calls as they were not being disposed of correctly.

Also it turns out that on a site of my site with the amount of concurrent users that i had , the rough estimation of a gig was just what it needed.

It also turns out that loading a lot of user controls on a page puts a bit of strain on server memory , not sure why but it did help us pinpoint some issues by removing the user controls and making them into smaller pages.

Last but not least check what type of session provider you are using , if inproc is putting too much strain on you server maybe its time to change to the the asp.net state session service or using a sql server as your session provider.

Let me know what you think and if you found and specifics.

# ms-access - 如何以编程方式更改 Access 中的选项？

> ID：329490
> 
> 赞同：0
> 
> 时间：2008-11-30T22:17:28.857
> 
> 标签：ms-access, configuration

在 Microsoft Access 中，有没有一种方法可以以编程方式将选项屏幕上的确认操作查询标志设置为 False？理想情况下，当数据库启动时，我想检查它是否为真，如果是，则为当前登录的用户将其标记为假。

应用程序被合理地锁定，因此理想情况下，我们不希望让用户访问操作菜单。

提前致谢。

PG

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-30T22:36:34.340

在数据库启动时将以下内容放入方法中：

```
If Application.GetOption("Confirm Action Queries") Then
    Application.SetOption "Confirm Action Queries", False
End If 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-30T22:49:44.000

通常最好使用执行或设置警告来消除操作查询的警告，因为选项适用于所有数据库。如果您更改代码中的选项，我建议您在退出之前将它们设置回来（并希望退出不是意外），否则当预期的提示未出现在他们的应用程序中时，有人可能会感到不愉快。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T22:50:05.810

我假设您要关闭此选项，因为您正在从代码运行查询。您可以使用宏操作 SetWarnings 关闭所有查询提示。可从 VBA 作为 DoCmd 对象的方法使用。请记住在您的代码完成后再次打开它。您还可以通过在 ADO 或 DAO 中使用 Execute 方法来避免警告。

# html - iframe 在某些浏览器尺寸上向左移动 1 个像素

> ID：329497
> 
> 赞同：0
> 
> 时间：2008-11-30T22:20:43.157
> 
> 标签：html, iframe, resize

我有类似的代码，抱歉，我现在没有确切的代码。但它是有效的。

```
<iframe src="..." borderframe="0" scrolling="no" width=728px" height="90px"></iframe> 
```

目标是一个包含横幅代码的 html 文件。一切都很好。但是当我调整浏览器大小或最大化时。内容向左移动 1 个像素。因此横幅显示缺少第一条垂直 1px 行。并且只有 727px 是可见的。

有人有想法吗？

谢谢你。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-30T22:59:57.583

我有一个想法，但你没有给我们完整的画面，所以我可能会走得很远。

我猜想 iframe 的位置是百分比或某种除法计算，例如父级左侧的 40%。然后在某些浏览器宽度下，这个数字不会平均分配并被截断。假设它在距离左侧 100 像素的位置，然后将父对象缩小 2/3，使其位置变为 66.66 像素，浏览器将其截断为 66，从而产生明显的误差，即还剩 1 个像素。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T10:00:30.060

代码被“简单”地放在一个 div 容器中。

没有百分比或相对宽度。:(

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-23T02:11:56.880

我有同样的问题。看起来像是一种“舍入误差”，即使这些应该从 1.5 开始就在 FF 中得到修复？我认为关键在于 IFRAME 位于以页面为中心的 DIV 中。当窗口大小小于 DIV 时，一切都很好。当窗口大小增加并且大小增加到偶数（或可能奇数）宽度时，边框就会消失。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-23T08:44:01.320

解决方案：你可以添加`0.5px`到`width`

# python - 如何在 Python 中查找所有内置库

> ID：329498
> 
> 赞同：6
> 
> 时间：2008-11-30T22:21:34.963
> 
> 标签：python

我最近开始使用 Python，并且很享受“包含电池”的设计。我已经发现我可以导入时间、数学、re、urllib，但不知道如何知道某些东西是内置的，而不是从头开始编写。

包括什么，我可以从哪里获得其他优质库？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-30T22:26:58.960

首先，[python 库参考](https://docs.python.org/2/library/index.html)给出了实际包含的内容。[全局模块索引](http://docs.python.org/modindex.html)包含这些相同模块的按字母顺序排列的简洁摘要。如果您对库有依赖关系，则可以使用以下构造轻松测试是否存在：

```
try:
    import foobar
except:
    print 'No foobar module' 
```

如果您在启动时对发行版中不一定存在的模块执行此操作，则可以通过合理的诊断来保释。

[Python 包索引](http://pypi.python.org/pypi)在 perl 世界中扮演类似于 CPAN 的角色，并且具有许多第三方模块的列表。浏览和搜索这应该让您了解内容。还有一些实用程序，例如[Yolk](http://pypi.python.org/pypi/yolk)，可让您查询 Python 包索引和 Python 上已安装的包。

其他优秀的在线 Python 资源是：

*   [www.python.org](http://www.python.org)

*   [comp.lang.python](http://groups.google.com/group/comp.lang.python)新闻组 -这仍然非常活跃。

*   Python 主页[链接](http://www.python.org/links/)的各种项目。

*   python 名人的各种主页和博客，例如[The Daily Python URL](http://www.pythonware.com/daily/)、[effbot.org](http://www.effbot.org/)、[The Python Cookbook](http://code.activestate.com/recipes/langs/python/)、[Ian Bicking 的博客](http://blog.ianbicking.org/)（负责 SQLObject 的人）以及[planet.python.org 之外的许多博客和网站。](http://planet.python.org/)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-30T22:34:52.923

跑

```
pydoc -p 8080 
```

并将浏览器指向[http://localhost:8080/](http://localhost:8080/)

您将看到已安装的所有内容，并且可以花费大量时间来发现新事物。:)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-30T22:26:42.253

Python 全局模块索引 ( [http://docs.python.org/modindex.html](http://docs.python.org/modindex.html) ) 列出了 Python 2.6 中包含的每个模块。

Sourceforge 拥有各种优秀的 Python 模块——最近派上用场的一个是 PyExcelerator，一个用于直接写入 MS Excel 工作簿的模块。Python 包索引 ( [http://pypi.python.org/](http://pypi.python.org/) ) 也是 Python 模块的良好来源。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-20T18:42:23.547

[Doug Hellman 的博客](http://blog.doughellmann.com/)深入介绍了许多内置库。如果您想了解有关标准库的更多信息，您绝对应该阅读他的文章。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-30T22:35:11.253

这与您的问题没有直接关系，但是当您在 python 控制台中时，您可以在任何函数上调用 help() ，它将打印其文档。

此外，您可以在任何模块或对象上调用 dir() ，它将列出其所有属性，包括函数。

这对于在导入模块后检查模块的内容很有用。

```
>>> import math
>>> dir(math)
['__doc__', '__name__', 'acos', 'asin', 'atan', 'atan2', 'ceil', 'cos', 'cosh', 'degrees', 'e', 'exp', 'fabs', 'floor', 'fmod', 'frexp', 'hypot', 'ldexp', 'log', 'log10', 'modf', 'pi', 'pow', 'radians', 'sin', 'sinh', 'sqrt', 'tan', 'tanh']
>>> help( math.log )
Help on built-in function log in module math:

log(...)
    log(x[, base]) -> the logarithm of x to the given base.
    If the base not specified, returns the natural logarithm (base e) of x. 
```

# c# - 您可以为控制器启用 [Authorize] 但为单个操作禁用它吗？

> ID：329500
> 
> 赞同：17
> 
> 时间：2008-11-30T22:22:56.583
> 
> 标签：c#, asp.net-mvc, authorization

我想`[Authorize]`在我的管理控制器中使用除操作之外的每个`Login`操作。

```
[Authorize (Roles = "Administrator")]
public class AdminController : Controller
{
    // what can I place here to disable authorize?
    public ActionResult Login()
    {
        return View();
    }
} 
```

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2013-05-09T07:11:02.443

您可以使用 [Authorize] 装饰您的控制器，然后您可以使用 [AllowAnonymous] 装饰您想要豁免的方法

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-30T23:03:00.153

我认为您不能使用标准的 Authorize 属性来执行此操作，但您可以从 AuthorizeAttribute 派生您自己的属性，该属性采用一系列操作以允许并仅允许访问这些操作。您可以在[www.codeplex.com](http://www.codeplex.com/aspnet)上查看 AuthorizeAttribute 的源代码，了解如何执行此操作。如果你这样做了，它可能看起来像：

```
[AdminAuthorize (Roles = "Administrator", Exempt = "Login, Logout") ]
public class AdminController : Controller
{
    public ActionResult Login()
    {
        return View();
    }

    public ActionResult Login()
    {
        return View();
    }

    ... other, restricted actions ...
} 
```

**编辑**：仅供参考，我最终遇到了自己做类似事情的需要，我走了一个不同的方向。我创建了一个默认授权过滤器提供程序并应用了一个全局授权过滤器。授权过滤器提供程序使用反射来检查操作或控制器是否应用了特定的授权属性，如果是，则遵循它。否则，它将应用默认授权过滤器。这与派生自 AuthorizeAttribute 的 PublicAttribute 相结合，允许公共访问。现在，我获得了默认的安全访问权限，但可以通过`[Public]`应用于操作或控制器来授予公共访问权限。也可以根据需要应用更具体的授权。请参阅我的博客[http://farm-fresh-code.blogspot.com/2011/04/default-authorization-filter-provider.html](http://farm-fresh-code.blogspot.com/2011/04/default-authorization-filter-provider.html)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-30T23:14:02.097

您可以覆盖控制器的 OnAuthorization 方法

```
 protected override void OnAuthorization(AuthorizationContext filterContext)
    {
        if ((string)(filterContext.RouteData.Values["action"]) == "Login")
        {
            filterContext.Cancel = true;
            filterContext.Result = Login();
        }
    } 
```

这有效，但它是一个黑客。

用于测试的完整类代码：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.Mvc;
using System.Web.Mvc.Ajax;

namespace MvcApplication2.Controllers
{
[HandleError]
[Authorize]
public class HomeController : Controller
{
    public ActionResult Index()
    {
        ViewData["Title"] = "Home Page";
        ViewData["Message"] = "Welcome to ASP.NET MVC!";

        return View();
    }

    public ActionResult About()
    {
        ViewData["Title"] = "About Page";

        return View();
    }

    protected override void OnAuthorization(AuthorizationContext filterContext)
    {
        if ((string)(filterContext.RouteData.Values["action"]) == "Index")
        {
            filterContext.Cancel = true;
            filterContext.Result = Index();
        }
    }
}
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-07-19T05:30:01.733

可能不是实际的，但我写了我的自定义属性：

```
public class SelectableAuthorizeAttribute : AuthorizeAttribute
{
    public SelectableAuthorizeAttribute(params Type[] typesToExclude)
    {
        _typesToExlude = typesToExclude;
    }

    private readonly Type[] _typesToExlude;

    public override void OnAuthorization(AuthorizationContext filterContext)
    {
        bool skipAuthorization = _typesToExlude.Any(type => filterContext.ActionDescriptor.ControllerDescriptor.ControllerType == type);

        if (!skipAuthorization)
        {
            base.OnAuthorization(filterContext);
        }
    }
} 
```

然后在我的全局文件中注册它：

```
filters.Add(new SelectableAuthorizeAttribute(typeof(MyController))); 
```

希望它对某人有用

# java - Java中是否有多个输入JOptionPane？

> ID：329506
> 
> 赞同：3
> 
> 时间：2008-11-30T22:25:01.087
> 
> 标签：java, swing, input, jdialog, joptionpane

我想知道是否有一个 JOptionPane 可以从用户那里获得多个输入，而不仅仅是一个？如果没有，我如何使用某种提示来完成此操作。我正在创建战舰，并希望提示用户指定放置每艘船的位置。

谢谢，

托梅克

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-30T22:38:44.523

作为消息传递给 JOptionPane 的对象可以是图形组件，因此应该可以使用以下方法：

```
JPanel panel = new JPanel();
// Populate your panel components here.
int ret = JOptionPane.showConfirmDialog(parent, panel, "Title", JOptionPane.YES_NO_OPTION);
if ( ret == JOptionPane.YES_OPTION )
{
  // Read component values.
} 
```

# iphone - 跨重启保留应用程序状态

> ID：329511
> 
> 赞同：5
> 
> 时间：2008-11-30T22:26:59.397
> 
> 标签：iphone, cocoa-touch

我一直在尝试通过序列化我的 main `UITabBarController`using来保留我的 iPhone 应用程序的状态`[NSKeyedArchiver archiveRootObject:toFile:]`，但我遇到了困难。

首先我遇到了一个问题`UIImage`，因为它没有实现`NSCoding`协议，但我通过为`UIImage`存储和检索原始图像数据创建一个扩展类别来解决这个问题。

我现在遇到的问题是，当我从存档中恢复时，我的视图控制器不存在。我`UINavigationControllers`在每个选项卡中都有，当我恢复时，`UINavigationItem`s 仍然存在（我可以使用后退按钮等来更改它们）但视图控制器就消失了。

我看到它`UINavigationController`的`viewControllers`属性被标记了`(nonatomic, copy)`。这是否意味着当您归档 a 时`UINavigationController`，它不包括其视图控制器堆栈？如果是这样，我该如何解决这个问题？我最初以为我会覆盖 的`NSCoding`方法`UINavigationController`，但这会破坏 NIB 文件的初始化。

我有点不安，因为我在保存应用程序状态时遇到了这么多困难。我认为这是一个足够常见的用例，可以直接实施。我在这里错过了什么吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-30T23:23:01.640

@property 上的属性与归档行为几乎没有关系（它们只描述 getter 和 setter 的工作方式）。

此外，仅仅因为 UI 类支持 NSCoding，并不意味着它可以用于重建状态。大多数时候，它们支持 NSCoding，以便可以使用 Interface Builder 从 NIB 文件构建和加载它们。如果您考虑*无法*在 Interface Builder 中设置的所有状态位 - 类的 NSCoding 实现可能不支持任何数量的这些功能。

通常，人们不会使用 NSCoding 来存储应用程序状态，因为构成应用程序状态的确切内容是特定于您的应用程序的。

保存应用程序状态通常涉及自己存储允许您重新创建状态的值。即存储选定选项卡的索引或代表通过导航控制器的路径的一系列选定索引。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-01T01:31:07.903

你为什么要归档整个标签栏控制器？只需使用 NSUserDefaults 并保存选定的选项卡索引。然后，当您加载应用程序时，根据保存的值选择选项卡索引。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-30T22:41:13.503

我也永远无法使这种方法发挥作用。我得到的是拥有自己的协议，并让每个视图控制器保存/恢复该视图所需的元数据（例如，您不需要保存图像数据，只需保存图像的名称）。一旦你有了它，编写一些通用代码来遍历导航控制器（+堆栈）并保存/恢复整个数据集就相当容易了。听起来工作量很大，但实际上很容易。

# css - IE6 导航悬停

> ID：329516
> 
> 赞同：1
> 
> 时间：2008-11-30T22:32:28.887
> 
> 标签：css, internet-explorer-6, navigation, hover

我正在使用以下代码进行非 JS 导航：

```
<ol id="navigation">
    <li id="home"><a href="#"><img src="./images/nav/home-hover.png" alt="Home" /></li>
    ...
</ol> 
```

和CSS：

```
#navigation a {
    display: block;
    height: 25px;
}

#navigation a img {
    display: none;
}

#navigation a:hover img {
    display: block;
}

#home a {
    background: url('./images/nav/home-normal.png') no-repeat;
    width: 100px;
} 
```

我的问题是他们不会在 IE6 中悬停时更改图像。我正在使用`:hover`锚点，所以应该没问题并且正在使用`display`而不是`visibility`在 IE6 中不起作用的另一件事。

我真的不想为图像替换/预加载添加大量 javascript （不能嵌入 jQuery 之类的东西） - 有人可以帮我吗？

谢谢，

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-30T22:52:42.873

IE 不会重新绘制锚点，除非其`<a>`自身的任何规则发生变化。添加任何内容`a:hover`，例如：

```
 #navigation a:hover {border:0} /* no-op */ 
```

顺便说一句：不幸的是，流行的屏幕阅读器不使用 阅读内容`display:none`，因此您的菜单最终无法访问。

我建议`<img>`默认情况下可见，并在悬停时将其隐藏。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-04T16:37:19.587

我同意 jason 在这里所说的话，但是如果您希望在用户将鼠标悬停在链接上之前缓存两个图像，那么为什么要使用两个图像呢？

前段时间我想出了一个我喜欢使用的小想法，它同时具有按钮的正常和悬停状态作为同一图像，顶部按钮的正常状态和下方按钮的悬停状态，这意味着按钮的两种状态都被立即缓存，因为它的图像相同！并且对于填充图像文件夹的按钮的不同状态，您没有加载不同的图像，只有一个图像可以引用该链接的每个状态。

然后你可以摆脱你的 img 标签及其样式（显示：无等）

并有这样的链接样式：

```
#home a {    
    background: url('./images/nav/home-normal.png') no-repeat left top;    
    width: 100px;
}
#home a:hover {    
    background-position:left bottom;
} 
```

您还必须在链接上设置一个高度，因此它不会显示链接其他状态的任何部分，有意义吗？您使用元素尺寸样式有效地将背景图像切成两半。

不需要 javascript 并且状态更改是即时的，因为图像已经加载:)

希望这可以帮助！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-01T03:50:11.103

您还可以使用锚标签上的背景作为您的图像持有者。

HTML：

```
<ol>
 <li><a href="#"></a></li>
</ol> 
```

CSS：

```
li a{
 background:url("link.jpg");
 display:block;
 width:100px;
 height:50px;
} 

li a:hover{
 background:url("link2.jpg");
} 
```

# c++ - 在 C++ 中有一个使用模式匹配（使用正则表达式）的函数吗？

> ID：329517
> 
> 赞同：2
> 
> 时间：2008-11-30T22:34:26.763
> 
> 标签：c++, regex, string

有一种简单的 C++ 方法可以在字符串上使用模式匹配吗？代码听起来应该是这样的：

```
if (regexpcmp("l?nole*[0-9]", "linoleum1")) {
  //we have a match!
} else {
   //no match 
} 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-30T22:36:24.637

你已经看过[Boost.Regex](http://www.boost.org/doc/libs/release/libs/regex/)了吗？

```
const boost::regex e("l?nole*[0-9]");
if (regex_match("linoleum1", e)) {
  //we have a match!
} else {
  //no match 
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-30T22:37:42.717

不在核心语言中。使用 Boost.Regex 或外部库，如`pcre`. 在 unix 环境中，您几乎可以肯定可以访问 BSD 正则表达式工具 ( `regcomp`, `regerror`, `regexec`, `regfree`)，这些工具类似于 c 而不是类似于 c++，但确实可以工作。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-30T22:39:09.983

带上 boost.regex 的朋友。如果您不允许使用 boost（遗憾的是，仍然有公司这样做），您可以查看`pcrecpp`，这是 google 为著名的[PCRE](http://www.pcre.org/)库开发的 C++ 绑定。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-01T18:34:35.810

如果您使用最常用编译器的最新版本：std::tr1::regex，则可以在 TR1 命名空间中使用标准正则表达式库（基于 boost::regex）。

# asp.net - ASP.NET 页面中的 WMV 文件

> ID：329532
> 
> 赞同：2
> 
> 时间：2008-11-30T22:40:35.503
> 
> 标签：asp.net, wmv

如何在 ASP.NET 网页中嵌入 WMV 文件？我希望它作为播放器可见，而不仅仅是链接。是否有为此的 ASP.NET 控件？我在 VS 2008 工具栏上没有看到，在帮助中也找不到。而且我还没有准备好将这个站点迁移到 Silverlight，因为那里的媒体真的很容易。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-01T01:42:56.977

检查您的项目是否针对 3.5。如果是，您应该能够在工具箱中看到媒体播放器控件。

WMV 可以通过这个插件在 Firefox 中显示：http: [//port25.technet.com/pages/windows-media-player-firefox-plugin-download.aspx](http://port25.technet.com/pages/windows-media-player-firefox-plugin-download.aspx)

WMV 可以使用此插件在 QuickTime 中显示：http: [//www.microsoft.com/downloads/details.aspx? FamilyID=915D874D-D747-4180-A400-5F06B1B5E559&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=915D874D-D747-4180-A400-5F06B1B5E559&displaylang=en)

安东尼:-)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-30T22:44:59.800

WMV 主要是一种 Microsoft 文件格式。这种格式没有固有的浏览器支持，所以你需要一个浏览器插件来播放它。

我很确定您可以在页面上嵌入 Windows Media Player 来播放它，但这会将您限制在运行 Windows 并且恰好安装了 Media Player 的客户端。

如果您需要支持广泛的观众，我会认真考虑将您的视频重新编码为 FLV 之类的内容并使用基于 Flash 的视频播放器。我没有统计数据来支持这一点——但 Flash 视频是浏览器中支持最广泛的视频格式。

# sharepoint - SharePoint - 获取当前用户列表

> ID：329535
> 
> 赞同：8
> 
> 时间：2008-11-30T22:43:47.850
> 
> 标签：sharepoint

获取分配给 SharePoint 门户的用户列表的最佳方式是什么？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-12-01T11:10:37.080

这取决于您想要的用户列表。

SharePoint Web 中存在的所有用户（但不一定具有权限）：

[SPWeb.AllUsers](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.spweb.allusers.aspx)

存在于 SharePoint Web 中但已被授予某些权限的用户：

[SPWeb.Users](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.spweb.users.aspx)

SharePoint 网站集中存在的用户（但不一定具有权限）：

[SPWeb.SiteUsers](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.spweb.siteusers.aspx)

注意：我假设您使用的是 WSS 3.0 / MOSS 2007，但这应该适用于 WSS 2.0。

还请看：

[SPWeb.AllUsers 与 SPWeb.Users](http://www.sharepointblogs.com/marwantarek/archive/2008/11/19/spweb-allusers-vs-spweb-users.aspx)

[SPWeb.AllUsers 与 SPWeb.Users 与 SPWeb.Groups](http://www.sharepointblogs.com/tingfong/archive/2007/08/21/sharepoint-spweb-allusers-vs-spweb-users-vs-spweb-groups.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-02T06:04:49.677

仅供参考，这是我想出如何做我正在寻找的事情的方式：

```
Dim Site As New SPSite("SiteURL")
Dim AllUsers As SPUserCollection = Site.RootWeb.AllUsers
Dim u As SPUser
For Each u In AllUsers
    Response.Write(u.LoginName & " " & u.Name & " " & u.Email & "<br />")
Next 
```

# .net - 如何找出当前控制器/动作/视图的名称？

> ID：329547
> 
> 赞同：0
> 
> 时间：2008-11-30T22:50:50.443
> 
> 标签：.net, asp.net-mvc, model-view-controller

我有一些代码放在母版页的代码隐藏中。这个母版页是我的主要布局，代码的目的是检查用户是否登录并根据他们是否登录采取适当的行动。我很想听听关于如何解决这个问题的替代方法，但我现在这样做是因为它是来自另一个 MVC 框架的直接端口，我想在移植期间尽可能少地更改代码或流程。

我真正的问题是，如何确定正在执行的当前控制器、操作和视图的名称？代码隐藏中的一些逻辑取决于知道当前页面名称。具体来说，它说（伪代码）：

```
if (!isLoggedIn && !isLoginPage)
    Redirect(loginPage); 
```

所以，我需要知道我是否已经在登录页面上，以避免无限重定向循环。我目前正在通过检查 Url 以查看它是否包含字符串 /Login/ 来实现这一点，但这很麻烦，我宁愿使用更强大和更智能的方法。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-01T06:42:10.180

对用户是否登录（假设您使用 FormsAuth）的最佳检查是 User.Identity.IsAuthenticated，可从视图或控制器访问。

在我看来，您需要在此处插入 Forms auth - 它会为您处理一切，包括重定向。在您的 web.config 中，确保已添加：

```
<authentication mode="Forms">
    <forms loginUrl="~/Account/Login"/>
</authentication> 
```

这告诉您的应用您正在使用表单身份验证。接下来，在您希望锁定的方法上使用 ActionFilter：

```
/// <summary>
/// Default view
/// </summary>
/// <returns></returns>
[Authorize(Roles="Administrator")]
public ActionResult Index()
{
    return View();
} 
```

这将与表单身份验证一起使用，以确保用户被识别。它还会自动将当前 URL 附加为重定向，并忽略登录视图——所有这些都是自动完成的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T23:36:10.053

查看控制器和控制器操作的授权属性。它应该使您免于在母版页后面的代码中做任何事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-03T02:12:20.660

[请注意，这里](http://weblogs.asp.net/stephenwalther/archive/2008/08/12/asp-net-mvc-tip-31-passing-data-to-master-pages-and-user-controls.aspx)列出了将数据传递到母版页的多种方法。

# iphone - objc 警告：“从指针目标类型中丢弃限定符”

> ID：329555
> 
> 赞同：11
> 
> 时间：2008-11-30T22:58:51.720
> 
> 标签：iphone, objective-c, cocoa

编译时：

```
char *str = [[NSString stringWithFormat:@"%i days and %i hours", days, hours] UTF8String]; 
```

我收到这个警告：

```
initialization discards qualifiers from pointer target type 
```

我该如何摆脱它？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-30T23:08:24.557

您缺少的限定符是`const`. `-UTF8String`返回 a `const char *`，因此`str`也应声明`const char *`。

# wpf - 关注 DataTemplate 中的文本框

> ID：329556
> 
> 赞同：10
> 
> 时间：2008-11-30T22:59:09.410
> 
> 标签：wpf, textbox, focus, datatemplate

我已经`DataTemplate`包含一个`TextBox`. 我将此模板设置为选择中的列表框项目。

我无法将焦点设置到模板中的文本框。我尝试调用 MyTemplate.FindName，但它以无效操作异常结束：此操作仅对应用了此模板的元素有效。

我怎样才能访问它？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2010-06-25T21:43:31.000

我知道这是旧的，但我今天遇到了这个问题，最后想出了这个解决方案：

由于`TextBox`仅在选择项目时才加载，即当您希望设置焦点时，您可以简单地处理`TextBox.Load`事件并调用`Focus()`.

有两种方法可以实现这一点。

**1\. 将`TextBox`中的替换`DataTemplate`为`AutoFocusTextBox`。**

```
public class AutoFocusTextBox : TextBox
{
    public AutoFocusTextBox()
    {
        Loaded += delegate { Focus(); }; 
    }
} 
```

不要忘记，您需要引用在 .xaml 文件中定义 AutoFocusTextBox 的命名空间。

**`DataTemplate`2\. 在定义的文件的代码隐藏中添加一个处理程序。**

*SomeResourceDictionary.xaml*

```
<TextBox Text="{Binding Something, Mode=TwoWay}" Style={StaticResource ...
        Loaded="FocusTextBoxOnLoad" /> 
```

*SomeResourceDictionary.xaml.cs*

```
 private void FocusTextBoxOnLoad(object sender, RoutedEventArgs e)
    {
        var textbox = sender as TextBox;
        if(textbox == null) return;
        textbox.Focus();
    } 
```

使用任一选项，您始终可以在处理程序中添加其他行为，例如选择所有文本。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-30T23:10:04.490

由于您知道`TextBox`要关注的名称，因此这变得相对容易。这个想法是在模板应用于`ListBoxItem`自身时获取模板。

您要做的第一件事是获取所选项目：

```
var item = listBox1.ItemContainerGenerator.ContainerFromItem(listBox1.SelectedItem) as ListBoxItem; 
```

然后你可以将它传递给这个小助手函数，它根据控件的名称来聚焦一个控件：

```
public void FocusItem(ListBoxItem item, string name)
{
    if (!item.IsLoaded)
    {
        // wait for the item to load so we can find the control to focus
        RoutedEventHandler onload = null;
        onload = delegate
        {
            item.Loaded -= onload;
            FocusItem(item, name);
        };
        item.Loaded += onload;
        return;
    }

    try
    {
        var myTemplate = FindResource("MyTemplateKey") as FrameworkTemplate; // or however you get your template right now

        var ctl = myTemplate.FindName(name, item) as FrameworkElement;
        ctl.Focus();
    }
    catch
    {
        // focus something else if the template/item wasn't found?
    }
} 
```

我想棘手的一点是确保您等待项目加载。我必须添加该代码，因为我是从`ItemContainerGenerator.StatusChanged`事件中调用它，有时在`ListBoxItem`我们进入方法时还没有完全初始化。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-08-10T00:33:24.580

行。所以我认为我有最好的解决方案。无论如何，它对我有用。我有一个简单的数据模板，我想将焦点放在文本框上。将`FocusManager`焦点移到文本框。

```
<DataTemplate x:Key="MyDataTemplate" DataType="ListBoxItem">
    <Grid>
        <WrapPanel Orientation="Horizontal" FocusManager.FocusedElement="{Binding ElementName=tbText}">
            <CheckBox IsChecked="{Binding Path=Completed}" Margin="5" />
            <Button Style="{StaticResource ResourceKey=DeleteButtonTemplate}" Margin="5" Click="btnDeleteItem_Click" />
            <TextBox Name="tbText" 
                     Text="{Binding Path=Text}" 
                     Width="200" 
                     TextWrapping="Wrap" 
                     AcceptsReturn="True" 
                     Margin="5" 
                     Focusable="True"/>
            <DatePicker Text="{Binding Path=Date}" Margin="5"/>
        </WrapPanel>
    </Grid>
</DataTemplate> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-09-09T08:21:50.317

Jay 的第二个建议很简洁 - 并且可以通过使用`UIElement`而不是更通用化`TextBox`，因此可以轻松地将任何控件设为默认值：

```
private void FocusControlOnLoad(object sender, RoutedEventArgs e)
{
    var uiElement = sender as UiElement;
    if(uiElement == null) return;
    uiElement.Focus();
} 
```

# flash - 在 Flash cs4 中更改 DataGrid 的颜色

> ID：329566
> 
> 赞同：0
> 
> 时间：2008-11-30T23:07:21.283
> 
> 标签：flash, actionscript-3

我在 Flash 项目中使用 as3 DataGrid 组件，我想将颜色从白底黑字更改为黑底白字，但找不到如何更改 DataGrid 控件的颜色。任何人都可以帮忙吗？

这是 flash 组件，我没有使用 flex。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-01-26T07:15:07.843

[http://www.adobe.com/devnet/flash/quickstart/datagrid_pt3/#section12](http://www.adobe.com/devnet/flash/quickstart/datagrid_pt3/#section12)

耽误了1年抱歉！

# asp.net-mvc - 如何设置 2 个具有相同名称的操作，1 个授权和 1 个未授权？

> ID：329570
> 
> 赞同：3
> 
> 时间：2008-11-30T23:09:58.827
> 
> 标签：asp.net-mvc

在 ASP.NET MVC 中是否可能有这样的东西......

```
[Authorize]
[AcceptVerbs(HttpVerbs.Get)]
public string AddData(string Issues, string LabelGUID)
{
    return "Authorized";
}

[AcceptVerbs(HttpVerbs.Get)]
public string AddData()
{
    return "Not Authorized";
} 
```

因此，如果用户未登录，则默认为未授权操作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-01T20:56:52.590

是的，有可能。您需要创建自己的`ControllerActionInvoker`并覆盖该`FindActionMethod`成员。我会让基类完成它的工作，然后检查它返回的方法是否满足您的条件，如果不满足，则返回更好的匹配。

我正在做这样的事情来让我的控制器有一个“默认操作”并且效果很好。查看 MvcContrib 及其 ActionInvoker 的实现，这是一个非常好的示例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T23:29:36.247

我不相信。将选择具有最佳参数匹配的控制器操作，然后应用属性。

你可以使用

```
if (Request.IsAuthenticated)
{  
    return "Authorized";
}
else
{  
    return "Not Authorized";
} 
```

在引擎盖下 [Authorize] 本质上是在做同样的事情

```
protected virtual bool AuthorizeCore(IPrincipal user)
{
    if (user == null)
    {
        throw new ArgumentNullException("user");
    }

    if (!user.Identity.IsAuthenticated)
    {
        return false;
    }

    ...snip...
} 
```

# asp.net-mvc - 动态 ASP.NET MVC 路由

> ID：329581
> 
> 赞同：2
> 
> 时间：2008-11-30T23:16:09.423
> 
> 标签：asp.net-mvc

我需要根据 URL 的内容动态更改 ASP.NET MVC 路由。

例如：

```
routes.MapRoute(
  "Default",
  "{controller}/{action}/{id}/{value}",
  new { controller = "Home", action = "Index", id = 0, value = "" }
); 
```

我想在大多数情况下使用上述路线，但在某些情况下也允许 {controller}/{value} 。

ASP.NET MVC 如何做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-30T23:41:12.197

在我的脑海中，你可以对你的规则应用[一些限制。](http://msdn.microsoft.com/en-us/library/system.web.routing.route.constraints.aspx)例如，如果 value 总是数字并且 action 总是由字母组成，那么您可以使用约束来选择正确的规则。这真的取决于什么`value`和`action`可能是什么。可能是您需要实现自定义路由规则。

# database - 数据库访问

> ID：329601
> 
> 赞同：0
> 
> 时间：2008-11-30T23:34:58.590
> 
> 标签：database, scripting

我想编写一个将使用 DBMS 的新应用程序。在这个应用程序的设计阶段和权衡选项时，我发现会有很多数据库访问，这意味着很多查询。我对开发这个系统最大的担忧是代码中散布的 SQL 选择、更新和删除语句的笨拙性质。除了 Linq（我不喜欢它，因为语法笨拙）之外，是否有任何可用的语言语法扩展（或脚本语言）？我非常熟悉用于开发的 Progress ABL（不管是他们的 4GL），我喜欢它的语法，但它的部署模型和对我的应用程序类型的依赖项既繁重又昂贵。

我请求的系统必须与 PHP 或 C# 兼容。

我正在考虑使用的数据库管理系统是 SQLite、MySQL 或 MSSQL（Compact 或 Standard）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T23:56:40.373

您可能需要考虑像[nHibernate](http://www.hibernate.org/343.html)这样的 ORM ，它可以在有或没有 LINQ 的情况下工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T03:09:50.403

只是不要在代码中散布 SQL。写一个合适的模型层。

即使您没有使用 MVC 或 ORM 框架，使用经过验证的设计方法也总能获得回报。只需编写存储在数据库中的概念对象的列表，以及要对它们执行的所有操作，然后将所有函数写入单个文件（或每个概念对象的文件）中。程序的其余部分不应该有一个单一的 SQL 命令，一切都应该使用该模型层完成。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-30T23:44:10.007

如果您使用的是 c#，则可以使用[Subsonic 之](http://subsonicproject.com/)类的东西进行数据库访问。它将处理您的数据访问，并且在很多情况下，您将能够避免在整个代码中编写 SQL。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-30T23:56:00.840

任何数据库前端都会阻止您在代码中使用 SQL，但仍然需要以某种方式访问​​数据，并且通常您最终会遇到您对 linq 感到不安的专有垃圾。我以前使用过 Hibernate，它是一个强大的 Java 库，可以为您与您的数据库对话。如果您的任务很小，那么原始访问并不是一个坏主意，如果数据库要更改，那么在您的代码中包含 sql 是不好的，它可能会更改。

# c# - 网络流量的流压缩

> ID：329607
> 
> 赞同：0
> 
> 时间：2008-11-30T23:38:57.617
> 
> 标签：c#, compression, zlib, sharpziplib

我正在编写一个 xmpp 库，并且正在尝试编写一个流来支持 zlib 压缩数据。我有两个不同的版本，一个基于 zlib.net，另一个使用 SharpZipLib。zlib.net 版本无法识别压缩，SharpZipLib 版本进入无限循环。[您可以在http://github.com/coder2000/ubiety/tree/master/](http://github.com/coder2000/ubiety/tree/master/)的 xmpp.compression.zlib 和 xmpp.compression.sharpziplib 中找到相应的代码。任何解决此问题的帮助将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T00:07:13.423

这不是您问题的直接解决方案，但您尝试过 System.IO.Compression.GZipStream 或 DeflateStream 吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T00:19:01.793

不，我正在尝试尽可能跨平台。我不知道 Mono 是否实现了这些类，也不知道微软为 zlib 压缩编写了类。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-01T05:18:53.763

我没有深入研究，但奇怪的是您的 SharpZipLib 包装器忽略`offset`并`count`在 BeginRead 中：

```
public override IAsyncResult BeginRead (byte[] buffer, int offset, int count, AsyncCallback cback, object state)
{
  _outBuff = buffer;
  if ( _in.IsNeedingInput )
    return _innerStream.BeginRead(_inBuff, 0, _inBuff.Length, cback, state);

  ZlibStreamAsyncResult ar = new ZlibStreamAsyncResult(state);
  cback(ar);
  return ar;
} 
```

叫我疯了，但可能`GZipOutputStream`直接使用 etc （或 System.Compression 对应物）......节省了很多实现细节......

# email - 保护网站上的电子邮件免受机器人和爬虫的侵害

> ID：329608
> 
> 赞同：2
> 
> 时间：2008-11-30T23:39:25.307
> 
> 标签：email, web-crawler

**已关闭**作为副本有[哪些方法可以保护网站上的电子邮件免受垃圾邮件机器人的侵害？](https://stackoverflow.com/questions/308772/what-are-some-ways-to-protect-emails-on-websites-from-spambots)

我终于建立了我的个人网站。我想在每个页面上发布网站管理员/反馈电子邮件，但我担心垃圾邮件爬虫会提取电子邮件地址并轰炸我。尤其如此，因为在这种情况下我不能使用我的正常的面向白名单的过滤。是否有有效的方法将电子邮件地址传达给爬虫难以提取的人？

我的长期计划是允许通过张贴的表格进行反馈（然后我会对你们所有人提出关于验证码的问题），但我现在没有时间（这不是当务之急），我不想在没有任何反馈的情况下上线。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-30T23:50:14.753

当您进入表单透视图时，请查看诸如 recaptcha.net 之类的免费内容

就目前而言，简单地以某种形式混淆电子邮件地址应该会有所帮助。我会考虑常见的 [my email (AT) some domain dot com] 类型的写出。您还可以通过在电子邮件中使用各种字体和大小以及其他效果来添加另一层防御，以击败具有 OCR 能力的非常复杂的爬虫

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-30T23:49:20.497

看到[这个 Stackoverflow 线程](https://stackoverflow.com/questions/308772/what-are-some-ways-to-protect-emails-on-websites-from-spambots)

我偏爱使用 javascript 在客户端构建 mailto URL。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T23:51:12.537

JavaScript 方法的一些替代方法。

拼出您的地址并避免将其设为链接。示例：某人（在）某处（点）com。

HTML 在 href 属性和锚标记内对电子邮件地址进行编码。

# double - 十进制与双倍速

> ID：329613
> 
> 赞同：53
> 
> 时间：2008-11-30T23:42:31.757
> 
> 标签：double, decimal, finance

我编写财务应用程序时，我不断地与使用双精度还是使用小数的决定作斗争。

我所有的数学都适用于小数点后不超过 5 位且不大于 ~100,000 的数字。我有一种感觉，无论如何，所有这些都可以表示为双精度数而不会出现舍入误差，但从未确定过。

为了明显的速度优势，我会继续从小数切换到双精度，除了在一天结束时，我仍然使用 ToString 方法将价格传输到交易所，并且需要确保它始终输出数字 I预计。（89.99 而不是 89.99000000001）

问题：

1.  速度优势真的像天真的测试所暗示的那样大吗？（约 100 次）
2.  有没有办法保证 ToString 的输出是我想要的？我的号码总是可表示的这一事实是否可以保证这一点？

更新：在我的应用程序运行之前，我必须处理大约 100 亿次价格更新，出于明显的保护原因，我现在已经使用小数实现了，但是开启需要大约 3 个小时，双打会大大减少我的开启时间. 双打有安全的方法吗？

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2008-11-30T23:46:38.520

1.  浮点运算几乎总是会明显更快，因为它是由硬件直接支持的。到目前为止，几乎没有广泛使用的硬件支持十进制算术（尽管这种情况正在发生变化，请参阅评论）。
2.  金融应用程序应该**始终**使用十进制数，在金融应用程序中使用浮点数产生的恐怖故事数不胜数，您应该能够通过 Google 搜索找到很多这样的例子。
3.  虽然十进制运算可能比浮点运算慢得多，但除非您花费大量时间处理十进制数据，否则对程序的影响可能可以忽略不计。与往常一样，在开始担心差异之前进行适当的分析。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-12-01T01:24:22.677

这里有两个可分离的问题。一个是 double 是否有足够的精度来保存你需要的所有位，另一个是它可以准确地表示你的数字。

至于确切的表示，您应该谨慎，因为像 1/10 这样的精确十进制分数没有精确的二进制对应物。但是，如果您知道您只需要 5 位十进制数字的精度，则可以使用*缩放*算术，在其中对数字乘以 10^5 进行运算。因此，例如，如果您想准确表示 23.7205，您可以将其表示为 2372050。

让我们看看是否有足够的精度：双精度为您​​提供 53 位精度。这相当于 15+ 个十进制数字的精度。因此，这将允许您在小数点后有 5 位数字，在小数点前有 10 位数字，这对于您的应用程序来说似乎足够了。

我会将这个 C 代码放在一个 .h 文件中：

```
typedef double scaled_int;

#define SCALE_FACTOR 1.0e5  /* number of digits needed after decimal point */

static inline scaled_int adds(scaled_int x, scaled_int y) { return x + y; }
static inline scaled_int muls(scaled_int x, scaled_int y) { return x * y / SCALE_FACTOR; }

static inline scaled_int scaled_of_int(int x) { return (scaled_int) x * SCALE_FACTOR; }
static inline int intpart_of_scaled(scaled_int x) { return floor(x / SCALE_FACTOR); }
static inline int fraction_of_scaled(scaled_int x) { return x - SCALE_FACTOR * intpart_of_scaled(x); }

void fprint_scaled(FILE *out, scaled_int x) {
  fprintf(out, "%d.%05d", intpart_of_scaled(x), fraction_of_scaled(x));
} 
```

可能有一些粗糙的地方，但这应该足以让你开始。

没有加法开销，乘法或除法的成本加倍。

如果您可以访问 C99，您还可以尝试使用`int64_t`64 位整数类型的缩放整数算术。哪个更快取决于您的硬件平台。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-11-30T23:59:08.947

始终使用 Decimal 进行任何财务计算，否则您将永远追逐 1cent 的舍入误差。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-12-01T00:59:06.877

1.  是的; 软件算术确实比硬件慢 100 倍。或者，至少，它要慢得多，并且 100 倍，给或取一个数量级，大约是正确的。回到糟糕的过去，当你不能假设每个 80386 都有一个 80387 浮点协处理器时，你也有二进制浮点的软件模拟，这很慢。
2.  不; 如果您认为纯二进制浮点数可以准确地表示所有十进制数，那么您就生活在幻想的世界中。二进制数可以组合一半、四分之一、八分之一等，但由于 0.01 的精确小数需要五分之一的两个因数和四分之一的一个因数 (1/100 = (1/4)*(1/5)*(1 /5)) 并且由于五分之一在二进制中没有精确表示，因此您不能用二进制值精确表示所有十进制值（因为 0.01 是一个无法精确表示的反例，但它代表了一大类十进制数不能准确表示）。

因此，您必须在调用 ToString() 之前决定是否可以处理舍入，或者是否需要找到一些其他机制来处理将结果转换为字符串时的舍入。或者您可以继续使用十进制算法，因为它会保持准确，并且一旦发布支持硬件中新的 IEEE 754 十进制算法的机器，它会变得更快。

强制性交叉引用：[每个计算机科学家都应该知道的关于浮点运算的知识](https://docs.oracle.com/cd/E19957-01/806-3568/ncg_goldberg.html)。这是许多可能的 URL 之一。

[此Speleotrove](http://speleotrove.com/decimal/)站点上有关十进制算术和新 IEEE 754:2008 标准的信息。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-05-03T15:20:04.440

只需使用 long 并乘以 10 的幂。完成后，除以 10 的相同幂。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-12-01T01:13:03.370

财务计算应始终使用小数。数字的大小并不重要。

对我来说，最简单的解释方法是通过一些 C# 代码。

```
double one = 3.05;
double two = 0.05;

System.Console.WriteLine((one + two) == 3.1); 
```

即使 3.1 等于 3.1，那段代码也会打印出**False ......**

同样的事情......但使用十进制：

```
decimal one = 3.05m;
decimal two = 0.05m;

System.Console.WriteLine((one + two) == 3.1m); 
```

现在将打印出**True**！

如果您想避免此类问题，我建议您坚持使用小数。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-17T00:31:58.280

我请你参考我对[这个问题](https://stackoverflow.com/questions/366852#366919)的回答。

使用 long 存储您需要跟踪的最小数量，并相应地显示值。

# php - 如何在 PHP 中实现 MySQL 的提交/回滚？

> ID：329622
> 
> 赞同：7
> 
> 时间：2008-11-30T23:49:42.633
> 
> 标签：php, mysql, pdo, commit, rollback

好吧，基本上我有这个脚本需要很长时间才能执行，并且偶尔会超时并在我的数据库中留下半完整的数据。（是的，我知道在一个完美的世界里我会解决这个问题而不是实现提交和回滚，但我被迫不这样做）

这是我的基本代码（为简单起见而简化）：

```
$database = new PDO("mysql:host=host;dbname=mysql_db","username","password");

while (notDone())
{
    $add_row = $database->prepare("INSERT INTO table (columns) VALUES (?)");
    $add_row->execute(array('values'));

    //PROCESSING STUFF THAT TAKES A LONG TIME GOES HERE
}

$database = null; 
```

所以我的问题是，如果那个while循环中的整个过程没有完成，那么我不希望插入的行保留在那里。我认为以某种方式我可以在 while 循环的开头和结尾使用提交/回滚来执行此操作，但不知道如何操作。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-30T23:52:14.063

看看[这个关于 PDO 事务的教程](http://www.phpro.org/tutorials/Introduction-to-PHP-PDO.html#11)。

基本上将长时间运行的代码包装在：

```
$dbh->beginTransaction();
...
$dbh->commit(); 
```

并[根据此 PDO 文档页面](http://usphp.com/manual/en/ref.pdo.php)：

“当脚本结束或连接即将关闭时，如果有未完成的事务，PDO 会自动回滚。”

因此，当脚本超时时，您将丢失待处理的事务。

但实际上，您应该重新设计它，使其不依赖于脚本的存活。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T23:53:50.067

您需要使用基于 InnoDB 的表进行事务，然后使用任何支持它们的库，如 PDO 或 MySQLi。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-12-10T10:08:52.297

```
try
{
    $mysqli->autocommit(FALSE);
    $mysqli->query("insert into tblbook (id,cid,book) values('','3','book3.1')");
    echo $q_ins=$mysqli->affected_rows."<br>";
    $mysqli->query("update tblbook set book='book3' where cid='3'");
    echo $q_upd=$mysqli->affected_rows."<br>";
    $mysqli->commit();
}
catch(PDOException $e)
{
    $mysqli->rollback();
    echo $sql . '<br />' . $e->getMessage();
} 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-09T08:42:12.547

```
<?php
//This may help someone....This code commit the transactions
//only if both queries insert and update successfully runs

$mysqli=new mysqli("localhost","user_name","password","db_name");

if(mysqli_connect_errno())
{
    echo "Connection failed: ".mysqli_connect_error();
}
else
{
    $mysqli->autocommit(FALSE);
    $mysqli->query("insert into tblbook (id,cid,book) values('','3','book3.1')");
    echo $q_ins=$mysqli->affected_rows."<br>";
    $mysqli->query("update tblbook set book='book3' where cid='3'");
    echo $q_upd=$mysqli->affected_rows."<br>";

    if($q_ins==1 && $q_upd==1)
    {
        $mysqli->commit();
        echo "Commit<br>";
    }
    else
    {
        $mysqli->rollback();
        echo "Rollback<br>";
    }
}
?> 
```

# asp.net - 在家中运行 ASP.Net 应用程序的简单方法？

> ID：329626
> 
> 赞同：1
> 
> 时间：2008-11-30T23:50:59.697
> 
> 标签：asp.net

我想在本地机器上运行一些小型私人/家庭应用程序，但我不喜欢为此设置一个带有 IIS 的完整 Win2003 服务器的想法。

是否有一种简单且廉价的方法可以让 ASP.Net 应用程序在家中运行？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-30T23:53:50.907

Windows 2000 有 ASP，Windows XP Professional 也可以运行它。查找如何打开内置网络服务器 IIS。当然 Win2k3 Server 会是一个更好的实现，但是对于个人的东西，它们中的任何一个都可以工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T23:58:36.577

假设您的桌面具有支持它的操作系统，最简单的方法是[Microsoft Web Platform Installer](http://www.microsoft.com/web/channel/products/WebPlatformInstaller.aspx)。需要 XP 或更高版本，但不适用于 XP 或 Vista 的家庭版。它将安装 IIS（哪个版本取决于您的操作系统）、SQL Server 2008 Express、.Net Framework、Visual Web Developer 2008 Express、ASP.NET MVC、Silverlight 等。链接页面上甚至还有一段视频，可以向您展示如何进行全部设置。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T23:59:12.707

试试 VIsual Studio 2008 Express Web Developer。它是免费的，而且比许多不免费的要好。它带有一个内置的 Web 服务器，因此您可以立即编译、部署和测试。不需要 IIS。

[http://www.microsoft.com/express/vwd/](http://www.microsoft.com/express/vwd/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-01T00:11:17.037

根据您可以运行 Cassini 的应用程序类型和 .Net 版本。它是支持 .Net 的免费开源 Web 服务器。我不确定它是否已更新为可以处理 3.5，但我曾经在家里使用它来运行我编写的一些非常严肃的 2.0 应用程序。

这是已更新的 Ultidev 版本：[http](http://www.ultidev.com/products/Cassini/) ://www.ultidev.com/products/Cassini/看起来它可以处理 3.5，所以几乎你有任何东西。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-01T01:20:03.730

多年来，我一直在我的家用计算机 (XP) 上运行 .NET 应用程序，而在此之前的几年里，我一直在运行 ASP 应用程序。只需安装 IIS，然后安装 .NET 框架（以及您需要的任何其他框架，例如 MVC），您就可以开始了。如果您的机器位于路由器后面，您需要将端口 80 转发到您的桌面。如果您没有静态 IP，您可以使用[DynDNS.org](http://DynDNS.org)之类的免费服务为您提供主机名，然后运行一个小型客户端来保持该主机名的 DNS 指向您的路由器 IP。如果您想使用自己的主机名，请向[GoDaddy.com](http://GoDaddy.com)之类的人注册一个，然后使用[ZoneEdit.com](http://ZoneEdit.com)之类的免费服务来使用正确的 IP 更新 DNS。

# algorithm - “查找最近的位置”如何工作？

> ID：329628
> 
> 赞同：9
> 
> 时间：2008-11-30T23:51:37.853
> 
> 标签：algorithm, mapping

如今，大多数餐馆和其他企业在其网站上都有“[查找位置](http://www.fedex.com//Dropoff/start)”功能，其中列出了给定地址/邮编的最近位置。这是如何实施的？将邮政编码与 DB 匹配是一种简单易行的方法，但可能并不总是有效，例如，可能有一个靠近给定位置的分支，但可能位于不同的邮政编码中。我想到的一种方法是将给定的邮政编码/地址转换为地图坐标并列出落入预定义半径的任何分支。我欢迎您对如何实现这一点的想法。如果可能，请提供更详细的实现细节，例如使用的任何 Web 服务等，

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-01T00:14:27.183

许多地理空间框架将帮助您解决这个问题。在地理空间世界中，邮政编码只是一个“多边形”，它只是地图上定义清晰边界的区域（不是数学意义上的多边形）。例如，在 SQL 2008 空间中，您可以基于原始多边形创建一个新多边形。因此，您可以动态创建一个多边形，该多边形是您的邮政编码在每个点上扩展一定距离。它考虑了邮政编码的时髦形状。有了地址，这很容易，因为您只需创建一个多边形，它是一个围绕一个点的圆。然后，您可以查询以任一方法创建的新多边形内的所有点。

很多这些网站基本上就是这样做的。它们为您提供 5 英里扩展多边形内的所有点，然后可能是 10 英里扩展多边形，依此类推。他们实际上并没有计算距离。网络上的大多数 ma 东西一点也不复杂。

[您可以在此处](http://johanneskebeck.spaces.live.com/blog/cns!42E1F70205EC8A96!3541.entry)查看一些基本示例，以大致了解我在说什么。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-01T00:02:24.713

有一个标准的邮政编码/位置数据库可用。[这是 Access 格式的一个版本，](http://databases.about.com/od/access/a/zipcodedatabase.htm)其中包括邮政编码的纬度/经度以及其他信息。然后，您可以使用 PostgreSQL GIS 扩展来搜索位置。

（当然假设您提取访问数据库并插入更友好的数据库，如 PostgreSQL）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-01T10:17:44.363

首先，您对地址进行地理编码，将其转换为（通常）纬度和经度。然后，您对数据库执行最近邻查询以查找兴趣点。

大多数空间索引不直接支持最近邻查询，所以这里常用的方法是在一个合理大小的边界框上进行查询，地理编码点位于中心，然后在内存中对结果进行排序以选择最接近的结果。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-30T23:54:49.877

就像你说的那样。将地址/ZIP 转换为 2D 世界坐标，并将其与其他已知位置进行比较。选择最近的。:) 我认为一些数据库（Oracle，MSSQL 2008）甚至提供了一些可以提供帮助的功能，但我从未使用过它们。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-30T23:56:51.963

我认为这是相当普遍的。他们获取地址或邮政编码并将其转换为“地图坐标”（取决于实施方式，可能是纬度/经度），然后使用数据库中事物的“地图坐标”很容易计算距离。

请注意，一些糟糕的实现会将邮政编码转换为代表邮政编码区域中心的坐标，这有时会产生不好的结果。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-30T23:57:44.660

你对如何做的想法就是我可能会如何做。您可以对 zip 的坐标进行地理编码，然后在此基础上进行计算。我知道 SQL Server 2008 有一些特殊的新功能可以帮助基于这些地理编码的 lon/lat 坐标进行查询。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-12T08:56:12.983

有实际的几何算法和/或数据结构支持对点、线和/或区域数据的较低 O(...) 最近位置查询。

请参阅[本书](http://books.google.com/books?id=tkyG8W2163YC)作为其中一些信息的示例，例如：Voronoi 图、四叉树等。

但是，我认为这里的其他答案在您今天在软件中找到的大多数情况下都是正确的：

1.  地理编码（单个点）搜索区域
2.  边界框查询以获得初始球场
3.  在内存排序/选择中

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-02T01:42:41.480

我有一个表，我每 6 个月编译一次数据库表，它包含 3 列，我将它用于澳大利亚的一些客户，它包含大约 40k 行，运行查询非常轻量级。**如果只是想为客户准备一些东西，这很快**

1.  邮政编码来自
2.  邮政编码
3.  距离

    SELECT Store_ID, Store_AccountName, Store_PostalCode, Store_Address, Store_Suburb, Store_Phone, Store_State, Code_Distance FROM Store, (SELECT Code_To As Code_To, Code_Distance FROM Code WHERE Code_From = @PostalCode UNION ALL SELECT Code_From As Code_To, Code_Distance FROM Code WHERE Code_To = @PostalCode UNION ALL SELECT @PostalCode As Code_To, 0 As Code_Distance) As Code WHERE Store_PostalCode = Code_To AND Code_Distance <= @Distance ORDER BY Code_Distance

你可以做很多优化来加速这个查询！

# actionscript-3 - AS3/Flash/Flex 中的枚举？

> ID：329652
> 
> 赞同：21
> 
> 时间：2008-12-01T00:06:30.790
> 
> 标签：actionscript-3, enums

我真正喜欢 AS3 而不是 AS2 的一件事是它增加了多少编译时类型检查。然而，它似乎有点缺乏可用的类型检查枚举结构。在 AS3 中执行自定义枚举类型的好（最佳/公认）方法是什么？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-01T00:16:43.280

跳跃后你的回答:-)

[带类的枚举](http://help.adobe.com/en_US/ActionScript/3.0_ProgrammingAS3/WS5b3ccc516d4fbf351e63e3d118a9b90204-7f2f.html)

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-02T22:29:35.227

只是想分享[我的方式](http://www.liranuna.com/typesafe-assignable-enumerations-in-as3/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-29T11:23:09.613

我知道，这有点过时了，并不能完全回答你的问题，但你可能想看看[Haxe](https://haxe.org)。您还可以使用它为您生成 AS3，此外还有许多其他使用它的原因。但这真的会跑题...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-11-10T05:04:17.873

我最近发现[as3commons 库](http://www.as3commons.org)有一个很好的基础帮助类[Enum](http://www.as3commons.org/as3-commons-lang/asdoc/org/as3commons/lang/Enum.html)用于枚举实现。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-01-04T10:40:32.577

为了成为**真正**的枚举，它需要两者：

*   强制类型安全
*   防止恶意实例

很少有简单的解决方案可以两者兼得，而且 IMO 的基类过于复杂。

我目前最喜欢的是以下风格 - 安全简单，不应该混淆任何人：

```
public final class FruitEnum {
    private static const CREATE:Object = {};

    public static const APPLE:FruitEnum = new FruitEnum(CREATE);
    public static const ORANGE:FruitEnum = new FruitEnum(CREATE);
    public static const BANANA:FruitEnum = new FruitEnum(CREATE);

    public function FruitEnum(permission:Object) {
        if (permission !== CREATE){
            throw new Error("Enum cannot be instantiated from outside");
        }
    }
} 
```

警告：我见过很少的情况，变量初始化在设置*之前*读取枚举 const ，但在这些情况下，问题同样适用于其他基于 const 的枚举仿真。

# c# - ASP.NET MVC 授权

> ID：329658
> 
> 赞同：32
> 
> 时间：2008-12-01T00:10:47.643
> 
> 标签：c#, asp.net-mvc, authorization

如何使用 MVC asp.net 获得授权？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-04-04T16:03:23.263

使用授权属性

```
[Authorize]
public ActionResult MyAction()
{
   //stuff
} 
```

您也可以在控制器上使用它。也可以传入用户或角色。

如果你想要更多控制的东西，你可以试试这样的[东西](http://schotime.net/blog/index.php/2009/02/17/custom-authorization-with-aspnet-mvc/)。

```
 public class CustomAuthorizeAttribute : AuthorizeAttribute
    {
        protected override bool AuthorizeCore(HttpContextBase httpContext)
        {
            string[] users = Users.Split(',');

            if (!httpContext.User.Identity.IsAuthenticated)
                return false;

            if (users.Length > 0 &&
                !users.Contains(httpContext.User.Identity.Name,
                    StringComparer.OrdinalIgnoreCase))
                return false;

            return true;
        }
    } 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-01T00:20:06.847

MVC 有一个授权功能，使用 ASP.NET MVC beta 并从 Visual Studio 创建 MVC 项目，自动添加一个使用授权的控制器。有助于您的谷歌搜索的一件事是它是一个“过滤器”。所以尝试搜索“授权过滤器 MVC”，任何预览 4 或更高版本都会有所帮助。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-11-18T20:05:37.073

我建议看看这篇文章： http: [//kbochevski.blogspot.com/2009/11/mvc-forms-authentication-and.html](http://kbochevski.blogspot.com/2009/11/mvc-forms-authentication-and.html)

今天对我有帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-05-18T22:07:46.043

这是默认情况下进行身份验证的方式：http: [//mycodepad.wordpress.com/2014/03/17/mvc-secure-your-web-app/](http://mycodepad.wordpress.com/2014/03/17/mvc-secure-your-web-app/)

# java - 如何在 java、MySQL 和 Tomcat 6 中使用连接池

> ID：329666
> 
> 赞同：8
> 
> 时间：2008-12-01T00:16:00.847
> 
> 标签：java, mysql, tomcat, connection-pooling

如何在 Java+MySQL+Tomcat 6 中使用连接池？

我已经阅读了这篇文章[http://dev.mysql.com/tech-resources/articles/connection_pooling_with_connectorj.html](http://dev.mysql.com/tech-resources/articles/connection_pooling_with_connectorj.html)但对我来说仍然不太清楚。

我在哪里使用连接器/J？我把它放在一个静态变量中吗？我使用 SessionListener 吗？它需要任何配置吗？

先感谢您！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-01T00:36:03.240

您应该阅读[Tomcat 6 JNDI 文档](http://tomcat.apache.org/tomcat-6.0-doc/jndi-resources-howto.html)。查找“JDBC 数据源”部分，它将告诉您有关使用 Tomcat 连接池的所有信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-04-14T14:31:45.177

您可以使用 Java 的 GenericObjectPool 轻松地在 Java 中实现 MySQL 连接池，该 GenericObjectPool 为任意对象提供强大的池功能。

请参阅这篇文章中的详细示例：[如何在 Java 中设置 MySQL 连接池](http://www.rndblog.com/how-to-set-up-a-mysql-connection-pool-in-java/)

# .net - 如何在 WPF 中的控件顶部显示进度条

> ID：329676
> 
> 赞同：10
> 
> 时间：2008-12-01T00:26:19.220
> 
> 标签：.net, wpf, .net-3.5, progress-bar, adorner

在 WPF UserControl 中，我必须调用 WebService。我在一个单独的线程上进行此调用，但我想通知用户该调用可能需要一些时间。

WebMethod 向我返回一个对象集合，我将它绑定到我的 UC 中的 ListBox。到目前为止，一切都很好……这部分工作得很好。但是，**我想在通话期间显示进度条（或任何类型的动画......）。此动画将位于 ListBox 控件的顶部并居中。**

我尝试了 Adorner，它部分有效。但是，我必须在受保护的覆盖 void OnRender(DrawingContext drawingContext) 中绘制所有控件...我只想添加一个控件几秒钟...

有人知道我如何实现这一目标吗？

谢谢！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-01T00:59:17.343

不要使用装饰器——我所做的是有两个独立的容器控件（通常是网格），它们占据屏幕的同一区域。一个是我的“进度”控件，另一个是我的“内容”控件。我将进度控件的可见性设置为 Collapsed，并将内容控件的可见性默认设置为 Visible。

如果您以这种方式进行设置，当您启动对 web 服务的异步调用时，您可以使进度控件可见并且内容控件折叠。当 web 服务完成时，让它使用 Dispatcher.BeginInvoke 更新 UI，然后将进度控件切换回折叠状态，并将内容控件切换回可见状态。

我通常使进度控制不确定。这是一个例子；在此，我有一个名为 ProgressGrid 的单独的用户控件，它有我的进度条。

```
 <Grid x:Name="layoutRoot">
        <Grid x:Name="contentGrid" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="Visible">
             <!-- snip -->
        </Grid>

        <controls:ProgressGrid x:Name="progressGrid" Text="Signing in, please wait..." Visibility="Collapsed"/>
    </Grid> 
```

在后面的代码中，就像这样简单：

```
 private void SignInCommand_Executed(object sender, ExecutedRoutedEventArgs e)
    {
        contentGrid.Visibility = Visibility.Collapsed;
        progressGrid.Visibility = Visibility.Visible;
    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T00:59:38.933

有一个技巧可以用于零高度的 Canvas，它可能会奏效。Chris Anderson 的 WPF 书详细介绍了这一点以及它为什么起作用，但它是这样的。

*   创建一个堆栈面板
*   向堆栈面板添加一个 Height="0" 和高 z-index 的 Canvas
*   将您的用户控件添加到堆栈面板。

当您想显示进度条时，请将其添加到零高度画布中。它将允许您将其放置在用户控件上。画布允许您超越它的边界。居中进度条应该只需要查看用户控件的尺寸并相应地设置进度条在 Canvas 上的位置。完成后从画布上移除进度条。

这是一个使用 TextBox 的简单示例。它并不完美，但它显示了这个想法。单击该按钮会在 InkCanvas 顶部显示 TextBox

```
<DockPanel LastChildFill="True">
    <Button DockPanel.Dock="Top" Name="showButton" Click="showProgress">show</Button>
    <StackPanel DockPanel.Dock="Bottom">
        <Canvas Name="zeroHeight" Height="0"/>
        <InkCanvas Name="inky">
        </InkCanvas>
    </StackPanel>
</DockPanel>

private void showProgress(object sender, RoutedEventArgs e)
{
    TextBox box = new TextBox();
    box.Text = "on top";
    StackPanel.SetZIndex(zeroHeight, 8);
    zeroHeight.Children.Add(box);
    box.Width = 30;
    box.Height = 30;
    Canvas.SetLeft(box, 10);
    Canvas.SetTop(box, 10);
    Canvas.SetZIndex(box, 10);
} 
```

# .net - 在哪里可以找到 WPF 图像控件的状态？

> ID：329682
> 
> 赞同：2
> 
> 时间：2008-12-01T00:31:57.227
> 
> 标签：.net, wpf, image, .net-3.5

Image 控件的一个很好的特性是我们可以指定一个 Uri 作为 ImageSource 并且图像会自动为我们下载。这很棒！**但是，该控件似乎没有指示图像加载是否正在进行的属性。**

是否有属性告诉我们 Image 控件的状态（正在下载、已下载等）？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-01T09:07:46.423

只要您的 ImageSource 是 BitmapImage，您就可以使用 BitmapImage.DownloadCompleted 事件。到目前为止我发现的唯一问题是它只能在 C# 中工作，所以你会失去一些灵活性。我猜您可以从 XAML 访问该事件，但我不确定如何。以下示例通过单击按钮开始加载图像，并在图像加载完成后更新标签。

XAML：

```
<Grid>
    <Grid.RowDefinitions>
        <RowDefinition Height="50" />
        <RowDefinition Height="50" />
        <RowDefinition Height="*" />
    </Grid.RowDefinitions>
    <Image x:Name="image" Grid.Row="2"/>
    <Label x:Name="label" Content="aaa" Grid.Row="1"  />
    <Button Click="Button_Click" Content="Click to load image" Grid.Row="0" />
</Grid> 
```

代码：

```
private void Button_Click(object sender, RoutedEventArgs e)
{
    BitmapImage bi = new BitmapImage();
    bi.BeginInit();
    bi.DecodePixelHeight = 100;
    bi.CacheOption = BitmapCacheOption.OnLoad;
    bi.UriSource = new Uri("bigImageUri");
    bi.EndInit();

    bi.DownloadCompleted += new EventHandler(bi_DownloadCompleted);
    image.Source = bi; 

}

void bi_DownloadCompleted(object sender, EventArgs e)
{
    label.Content = "dl completed";
} 
```

希望能帮助到你！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T01:26:12.907

嗯 - 这是一个很好的问题。我在 MSDN 上查看了 ImageSource 类的文档，看起来那里没有任何东西可以获取该信息。

话虽如此，您能否手动开始下载并在下载完成后设置 Image 控件的 Source 属性？你肯定知道下载是否完成......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-01T03:31:05.807

在图像 DP 上设置 OnPropertyChanged？

# java - 在 UML 中表示重载方法

> ID：329686
> 
> 赞同：8
> 
> 时间：2008-12-01T00:35:12.290
> 
> 标签：java, uml, overloading

我正在尝试创建一个代表一些 Java 代码的 UML 图。

在一个类中，我有一个重载的方法。

据我所知，UML 图中没有显示方法的参数。

如何在 UML 中表示方法重载？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-01-14T12:23:27.237

在谈论重载时-例如，在您的类中，您有更多具有相同名称但签名不同的方法（参数，可能返回值取决于目标语言...），您应该提供签名。UML 没有指定你不能有方法参数。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-01T01:36:24.663

在子类中，您指定与您希望覆盖的方法具有相同签名的方法，并向该方法添加注释 {redefines}。例如：

```
+doSomething(p:AThing):int{redefines} 
```

这意味着 doSomething() 方法会覆盖超类中的方法。是的，方法的参数显示在图表上。如示例 p 是 AThing 类型的参数。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-07T15:37:40.453

您没有说您的工具和 UML 图（我认为是类图），但您有两种方法：

1.  你可以写一个关于这个方法的注释；
2.  您可以在此方法中使用关键字构造型编写<<*重载*>>；

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-01T00:45:54.080

检查整个图表或单个类/接口的显示选项。大多数 UML 工具都有显示方法参数列表的选项。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-21T18:51:25.473

考虑到某个问题，上面的大多数答案都是正确的。Alepuzio、Vincent 和 bmatthews68 都有在上下文中有意义的答案。

** 如果问题是关于重写具有相同签名的超类方法而不是重新定义是正确的定义。如果它重载是因为您创建了采用不同参数的相同方法，那么我认为这不可能在结构上建模，您可以使用序列图来展示这一点，例如行为图，但仍然不是真的。

所以 +doSomething(p:AThing):int{redefines} 是正确的，这就是文森特所说的。

** 如果您的问题/问题只是在图表中没有直观显示的参数，这通常是大多数 UML 工具中的设置。

** 如果您想更清楚自己在做什么，请使用关键字<>，还要注意关键字不是刻板印象，因为它不是元模型的一部分。

# model-view-controller - 可以对模型进行任何处理吗？[MVC]

> ID：329720
> 
> 赞同：1
> 
> 时间：2008-12-01T01:02:23.890
> 
> 标签：model-view-controller

我决定为我制作的所有新网站大力推动 MVC。我有一个关于您是否可以在模型级别进行任何处理的问题。

提出这个问题的案例是一个视频网站。我有一个视频类（模型），当用户查看视频时我需要做的一件事是我需要将视图登录到数据库中。我不确定是否需要在控制器中添加查询，或者是否可以在 Video 类中添加 addView 方法。

对我来说，基本的潜在问题是我在模型中限制了什么样的方法？它可以是任何东西还是只能是访问器（又名 getValue/setValue）方法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-01T01:12:46.803

Ruby on Rails 的座右铭是[瘦控制器，胖模型](http://weblog.jamisbuck.org/2006/10/18/skinny-controller-fat-model)。这不仅仅适用于 Rails，应该使用任何 mvc 框架来实践。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-01T01:08:24.703

我认为你的模型正是处理这个问题的地方。现在，您的模型必然只由您的实体类组成。在我看来，您的模型将包括您的实体以及您需要实现的任何业务逻辑。您的控制器应该只处理视图的 I/O，调用模型方法来完成用户通过用户界面（视图）调用的操作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-01T03:14:17.930

我将如何做到这一点。它应该在几乎任何语言中都有效。

视图将启动对控制器的 OnView() 方法的方法调用，然后显示控制器向其吐回的任何内容（当然，以一种受控的方式......我认为您的视图将包含一个视频播放器组件，所以你会从控制器那里得到一段视频）

在您的控制器中，有一个 OnView() 方法可以做 3 件事：实例化 Video 对象（即使用您的数据层获取模型对象），在 Video 对象上调用 updateViewCount() 方法，并显示视频（通过返回视频对象到视图，大概）。

Video 模型对象包含表示您的视频的数据和您需要的任何日常用品，其中包括 updateViewCount()。这样做的理由是视频*具有*观看次数（聚合）。如果“视图计数”需要是一个复杂的对象而不仅仅是一个整数，那就这样吧。从磁盘（数据库？）上的原始表示创建视频对象的数据层也将负责加载和创建相应的视图计数对象，作为视频创建的一部分。

所以，这是我的 0.02 美元。您可以看到我创建了第四个东西（前三个是模型、视图和控制器），即数据层。我不喜欢 Model 对象加载和保存自己，因为那样他们必须了解您的数据库。我不喜欢控制器直接进行加载和保存，因为它会导致跨控制器重复代码。因此，一个单独的数据层只能由控制器直接访问。

最后一点，我是这样看待视图的：用户所做的一切，以及用户看到的一切，都应该通过视图。如果屏幕上有一个显示“播放”的按钮，它不应该直接调用控制器方法（在许多语言中，这样做没有危险，但有些语言，例如 PHP，可能允许这样做）。现在，视图的“播放”方法只是转身并调用控制器上的适当方法（在示例中是 OnView），并且什么都不做，但该层在概念上很重要，即使它在功能上无关紧要。同样，在大多数情况下，我希望您的视图播放视频流，因此控制器返回给视图的数据将是视图所需格式的流，这可能不一定是您的确切模型对象（即使您可以直接使用 Video 对象，也可能建议添加额外的解耦层）。这意味着我实际上可以让我的 OnView 方法接受一个参数来指示我想要返回的视频格式，或者可能在控制器上为每种格式创建单独的视图方法等。

对你来说够啰嗦了吗？:DI 预计 Ruby 开发人员会激怒他们，他们似乎对 MVC 的想法略有不同（尽管并非不兼容）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-01T01:11:31.330

由于您可以在 MVC 中使用您想要的任何模型代码（不仅限于 LINQ），因此简短的回答是肯定的。在模型中*应*该做什么也许是一个更好的问题。根据我的喜好，我会添加一个 ViewCount 属性（它可能映射到 Video 表中的一列，除非您正在跟踪每个用户，在这种情况下它将位于 UserVideo 表中）。然后从控制器你可以增加这个属性的值。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T01:35:59.573

使用 MVC，人们似乎很难将四层合并为三层。

MVC 范式*没有*正确解决数据存储问题。这就是“第四层”。模型有加工；但由于它也处理数据，因此程序员也将 SQL 放在那里。错误的。创建一个数据抽象层，这是唯一应该与后端存储对话的地方。MVC 应该是 DMVC。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-12-01T02:03:04.767

请记住，MVC 有很多变体，并且没有真正的“正确方法”来做事。最终，您如何设计课程取决于个人喜好。但是，由于您要求提供设计建议，因此这是我的两分钱：

**业务逻辑属于控制器。让它远离模型和视图。**

在 MVC 模式的众多变体中，[被动视图](http://martinfowler.com/eaaDev/PassiveScreen.html)样式似乎是最容易测试的。在被动视图中，您的类设计如下：

*   您的控制器是“智能的：它对数据库进行更改，更新模型，并使视图与模型同步。除了对模型和视图的引用之外，控制器应尽可能少地保存状态信息。

*   该模型是“愚蠢的”，这意味着它只保存视图的状态，没有额外的业务逻辑。模型不应包含对视图或控制器的引用。

*   视图是“愚蠢的”，这意味着它只将信息从模型复制到 UI，并调用由控制器处理的事件处理程序。视图不应包含额外的业务逻辑。视图不应包含对控制器或模型的引用。

如果您是 MVC 纯粹主义者，那么模型更新自身或数据库是没有意义的，因为这些职责属于控制器，因此**不**适合为您的 Video 类创建 addView 方法。

# php - 如何处理 MVC 网站的模板？

> ID：329724
> 
> 赞同：6
> 
> 时间：2008-12-01T01:06:45.207
> 
> 标签：php, model-view-controller, view

我将其标记为 PHP，但这只是因为我将使用 PHP 代码来显示我的问题。

所以我有一些这样的代码用于控制器：

```
switch ($page)
{
    case "home":
        require "views/home.php";
        break;
    case "search":
        require "views/search.php";
        break;
} 
```

显然还有更多页面，但这应该说明我的问题。这两个页面（以及网站上的所有页面）都有一个共同的页眉、导航和页脚。我应该使用多个 require 语句吗？我的第一个猜测是：

```
switch ($page)
{
    case "home":
        require "templates/header.php";
        require "templates/navigation.php";
        require "views/home.php";
        require "templates/footer.php";
        break;
    case "search":
        require "templates/header.php";
        require "templates/navigation.php";
        require "views/search.php";
        require "templates/footer.php";
        break;
} 
```

不知何故，我的直觉告诉我这是不正确的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-01T01:13:25.757

控制器应该只为视图设置数据并选择要显示的视图。视图应该负责页面的布局，包括共享页面。我喜欢你的第一个样本而不是第二个样本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T02:14:56.647

是的，您应该将页眉、页脚等分开。

对于您展示的特定示例，这不是更好吗？

```
 require "templates/header.php";
    require "templates/navigation.php";
    require "views/$page.php";
    require "templates/footer.php"; 
```

（其中 $page 是 'home'、'search' 等）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-03T15:24:39.170

你在重复代码。这几乎不是一个好主意。为了接近你最初的例子，这样的事情肯定会更可取：

```
require "templates/header.php";
require "templates/navigation.php";

switch ($page) {
    case "home":
        require "views/home.php";
        break;
    case "search":
        require "views/search.php";
        break;
}

require "templates/footer.php"; 
```

在不了解您的架构方法的情况下很难提供更多建议。例如，最好将控制器的这一部分（它只是准备输出）放在一个非常中心的位置，并在包含视图模板之前开始输出缓冲。这样，您可以将输出存储在一个变量中，您可能希望在将其内容返回到 HTTP 响应中之前进一步处理该变量。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-01T20:49:18.673

这是我如何使用当前项目制作模板的简化版本，如果有任何用处：

```
class Template {
    var $pagename = 'index';

    function __construct() {
        $this->pagename = basename($_SERVER['SCRIPT_NAME'], '.php');
        register_shutdown_function(array($this, 'do_output'));
    }

    function do_output() {
        $this->header();
        $this->display($this->pagename);
        $this->footer();
    }

    function __call($template, array $params) {
        call_user_func(array($this, 'display'), $template, params);
    }

    function display($template, array $params = null) {
        include "templates/$template.php";
    }
} 
```

它背后的想法是你可以写“include 'Template.inc'; new Template;” 它安排 do_output() 在脚本末尾自动运行。它遗漏了一些东西，例如用于将变量传递给模板的方法。

您已经提到您没有使用 PHP，并且其中有一些 PHP 主义： register_shutdown_function() 确保在对象析构函数之前但在主脚本之后调用模板，以及对 $this->header() 的调用/footer() 是只执行 display('header') 和 display('footer') 的魔术函数调用，它们旨在被覆盖。

当然，使用像您发布的示例这样的开关没有任何问题，但您不需要每个 case 语句中的页眉/页脚。这样的事情会做同样的事情：

```
require "templates/header.php";
require "templates/navigation.php";
switch ($page)
{
    case "home":
        require "views/home.php";
        break;
    case "search":
        require "views/search.php";
        break;
}
require "templates/footer.php"; 
```

...或者你可以用我上面使用的基于文件名的东西替换 switch()，如果它适用于你的页面设置方式。如果您打算通过 URL 参数进行切换，那么切换是最安全的方式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-09T02:18:04.997

我同意 tvanfosson 的观点，并想解释它为什么以及它与 MVC 的关系。

您的第二个示例的问题是控制器暴露于视图的构造方式。严格来说，控制器将视图的输入编组并传递给它，仅此而已。

一种实际的思考方式是，如果视图根据应用程序要求或输入本身发生变化。例如，如果生成的视图用于 JavaScript 弹出窗口，它可能（并且可能会）使用一组不同的页眉、页脚、CSS、元等。在第二个示例中，所有这些都暴露给控制器. 在您的第一个中，知道如何生成视图的是视图——这正是重点。

进一步举我的例子，假设 JavaScript 弹出窗口被重新设计为一个完整的页面视图，或者为 AJAX 重构（或者弹出窗口/页面/AJAX 问题由输入确定，例如隐藏元素场地）。现在您正在拆开控制器，因为视图已更改。与其说您违反了 MVC，不如说您一开始就不应该为它烦恼。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-06-06T02:36:12.823

如果您的所有文件名都与您的视图/页面请求相匹配，如示例中所示，那么您只需要一行而不需要`switch`声明：

```
require "templates/header.php";
require "templates/navigation.php";
require 'views/' . $page . '.php'; // <-- one-liner
require "templates/footer.php"; 
```

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-12-01T16:39:31.020

如果您使用直接的 PHP 页面作为模板，您基本上可以设置一个全局/会话变量来保存您想要的页面。您将拥有一个包含页眉和页脚元素的“主模板”php 页面，然后调用 $page 的包含。在控制器中是这样的：

```
$_SESSION['page'] = sanitize_input($_GET['page']);
require "templates/main.php"; 
```

然后在 main.php 模板文件中：

```
require "templates/header.php";
require "templates/navigation.php";
require "views/{$_SESSION['page']}.php";
require "templates/footer.php"; 
```

# confluence - 最喜欢的颜色：桃金娘

> ID：329726
> 
> 赞同：12
> 
> 时间：2008-12-01T01:08:01.337
> 
> 标签：confluence

在工作中我们使用[confluence](http://www.atlassian.com/software/confluence/)。

有时它会崩溃，导致生成错误 500 页面。

此页面包含一些有趣的参考信息，包括：

> **系统信息:**
> favouriteColour: Myrtle
> javaRuntime: Java(TM) SE Runtime Environment
> jvmVersion: 1.0
> operatingSystem: Linux 2.6.18-92.1.13.el5
> ...

*桃金娘？*

许多想法在我的脑海中肆虐。什么是桃金娘？为什么它是我最喜欢的颜色？*是*我最喜欢的颜色吗？为什么那个特定的信息需要它自己的系统属性？

起初我以为这只是工作中某人所做的事情。一个早已被遗忘的项目的残余，也许是一个古老的愚人节玩笑？

看来[我弄错了](http://www.google.co.nz/search?hl=en&client=firefox-a&rls=org.mozilla:en-US:official&hs=ENc&sa=X&oi=spell&resnum=0&ct=result&cd=1&q=%22favourite+Colour%3A+myrtle%22&spell=1)。事实上，即使是 Atlassian 也[承认这种颜色](http://confluence.atlassian.com/display/DEVNET/Confluence+Build+Information)，尽管他们没有给出它存在的理由。

现在，我知道你在想什么了吗？*谁在乎？*

我愿意，温柔的读者，我愿意。你也应该这样做。正是这样的小谜团让生活变得有价值。

那么，你们当中有没有人知道神秘桃金娘的秘密呃..神秘？至少有一个好奇的心想知道..

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-01-20T09:26:21.020

您的 Confluence 系统最喜欢的颜色（澳大利亚拼写 FTW）也可以从 Admin -> System Info 获得。

如果我再告诉你，我就不得不杀了你。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-20T09:32:31.897

这看起来像是对其版本或错误号的混淆。

在销售企业系统时，您不应该泄露您的确切版本——据说它可以让黑客更容易知道要攻击哪些漏洞。

但是，他们仍然希望能够在您寻求技术帮助时知道您使用的版本或遇到的错误 ID，因此他们对每个版本都有一个代码字。

我想颜色很快就用完了。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-01T01:12:12.560

也许它对编程来说是非常基础的东西——比如数学的 pi，宇宙的 42，或者太空旅行的 L-unit（众所周知，没有它，太空旅行只是疯子的狂热梦想）。

我们只能猜测。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-01T02:11:31.690

FWIW，我经常将“有趣”的信息放在错误转储中——我发现让人们在错误报告中报告它更容易，而且他们更有可能准确地报告像“桃金娘”这样的东西，而不是“错误 #47" 或其他...

# php - PHP 与应用程序之间的通信

> ID：329728
> 
> 赞同：1
> 
> 时间：2008-12-01T01:08:32.537
> 
> 标签：php, linux, embedded

我正在使用嵌入式 Linux 设备并寻找一种方法来让我的应用程序代码与 Web 界面进行通信。我需要在设备 Web 界面上显示来自应用程序的一些状态信息，并且还希望有一种方法可以通知应用程序任何用户操作，例如上传的文件等。PHP 似乎是制作界面的好方法，但是沟通部分更难。我找到了以下选项，但不确定哪个最容易使用。

**插座。**必须首先为 PHP 启用套接字才能尝试此操作。不知道启用是否会占用更多空间。

**数据库。**似乎是一个矫枉过正的解决方案。

**共享文件。**似乎工作量很大。

**命名管道。**尝试了一些成功，但不确定是否会出现问题，例如同时加载页面。也许套接字更容易？

最好的方法是什么？有什么我完全想念的吗？这在众多基于 Linux 的商业网络交换机中是如何完成的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T01:25:45.403

它是什么类型的设备？

如果您使用共享文件之类的东西，设备将如何更新？

命名管道将如何遇到套接字将避免的并发问题？

在从设备到 PHP 的通信方面，文件似乎很完美。PHP 可以使用一些基本的东西，比如 file_get_contents()，设备可以直接写入文件。如果您担心文件更新为快速长度检查的时间。

在 PHP 通知设备做什么方面，我也倾向于文件。让设备监视一个目录，并让脚本在那里创建一个文件，其中包含类似 file_put_contents($path . uniqid(), $command); 这样，如果两个脚本同时运行，您只需有两个文件供设备使用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T02:29:22.560

我最近使用套接字做了一些非常相似的事情，而且效果非常好。我有一个与设备通信的 Java 应用程序，它在服务器套接字上侦听，而 PHP 应用程序是客户端。

因此，在您的情况下，PHP 客户端将初始化连接，然后服务器可以回复设备的状态。

有很多关于如何使用大多数语言进行客户端/服务器套接字通信的教程，所以不应该花太长时间来弄清楚。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-01T01:37:44.443

用于通过 Web 界面进行路由的嵌入式 linux 框不使用 PHP。他们使用 CGI 并使用 shell 脚本来提供网页。

对于从应用程序获取信息到 Web 界面，共享文件选项对我来说似乎是最合理的。应用程序可以只将信息写入 PHP 读取的文件中。

反之，一开始看起来不太好。PHP 支持锁定文件，但它很可能在系统级别上不起作用。也许一种解决方案是，实际上每个包含应用程序信息的 PHP 脚本都会创建自己的文件（具有唯一的 id 文件名，例如基于时间戳 + 随机值）。应用程序可以监视这些文件弹出的指定目录。处理它们后，它可以删除它们。为此，应用程序只需要目录的写权限（因此文件所有权不是问题）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-07T01:16:30.910

如果可能，请使用 shell 脚本。

我做了类似的事情，我写了一个视频监控应用程序。视频部分由运动处理（一个很棒的 FOSS 包）。该应用程序是标准化硬件的交钥匙解决方案，用于监控老虎机赌场。它在本地用作信息亭系统，可通过互联网访问。我用 PHP 编写了所有 UI 代码，本地显示是一个紧密锁定的 KDE 桌面，带有默认为 localhost 的全屏浏览器。我使用 shell 脚本与运动和操作系统进行交互。

再想一想：如果您可以在设备上使用自编译应用程序：编写一个返回所需值的简单程序，并使用 PHP 的 exec() 或 passthru() 或 system()。

# javascript - 编程基于坐标的游戏，例如点或棋盘格

> ID：329745
> 
> 赞同：17
> 
> 时间：2008-12-01T01:19:23.340
> 
> 标签：javascript, c, geometry, gridworld

我希望学习一些关于笛卡尔几何或基于坐标的游戏编程的基础知识。平台无关紧要，尽管我最精通 JavaScript、C、Objective-C。最终能够创建诸如点或棋盘格之类的东西将是理想的。这个想法是让我了解精灵如何工作以及路径如何以编程方式工作。我对你们的问题是，学习基础知识的最佳地点在哪里？数学不是很重的东西，因为坦率地说，在这一点上，任何比微积分更高级的东西对我来说都是一条灰线，需要刷新我的记忆。

如果有特定的书籍、站点或开源项目——那可能对我帮助最大。

感谢您的任何想法。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-30T09:02:58.140

我认为还有几个步骤可以实现您的目标，即了解游戏编程的基础知识。您提到了理解精灵和路径，这对于游戏编程来说是必不可少的，但我认为最初您应该花一点时间来理解一般图形用户交互背后的编程和方法。

无论您最终将使用哪种语言编写游戏，我认为学习 Java 或 C# 等现代语言将为您提供大量库，并使您能够更简单地完成动画和事件侦听器等任务。

以下是我认为对您非常有帮助的指南和教程列表，就像它们对我和其他人一样：

1.  [这是一个非常详细的 Java 游戏框架教程](http://www3.ntu.edu.sg/home/ehchua/programming/java/J8d_Game_Framework.html)，包括完整的源代码和用 Java 编写臭名昭著的“蛇”游戏的完整演练（带有源代码），包括控制面板、记分板和音效！
2.  [Jonathan S. Harbor 的《Beginning Java 5 Game Programming》](https://rads.stackoverflow.com/amzn/click/com/1598631500)一书将向您介绍诸如 2D 矢量图形和包括精灵动画的位图等概念。另外，您可以花 12 美元在 Amazon Marketplace 上使用它！
3.  [这](http://www.developer.com/java/article.php/893471)是一个关于 Sprite Animation 的令人难以置信的教程，其中包含超过 5 个部分！此外，它是由 CompSci 教授 Richard Baldwin 和一个非常可靠和知识渊博的来源撰写的。有关他的更多教程，[这是他的网站。](http://www.geocities.com/Athens/7077/scoop/onjava.html)

在这些资源之间，您将拥有适用于任何语言的游戏部分的方法论，以及如何实际实现这些部分的知识。

祝你好运！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-01T01:26:39.677

O'Reilly 有一个关于在 Mac 上使用 Objective-C 和 Cocoa 进行简单游戏开发的精彩教程。[行动路线。](http://www.oreillynet.com/pub/a/mac/2006/12/19/building-a-game-engine-with-cocoa.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-27T21:27:14.523

[奥赛罗](http://en.wikipedia.org/wiki/Reversi)，这本书当然是彼得[·诺维格著名的](http://en.wikipedia.org/wiki/Peter_Norvig)[PAIP](https://rads.stackoverflow.com/amzn/click/com/1558601910)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-01T15:28:37.560

我经常访问的网站是[GameDev.net](http://www.gamedev.net)。一般来说，他们有很多用于游戏编程的资源。论坛是获得有关游戏开发的更具体答案的好地方。

在网站上，访问“[文章和参考](http://www.gamedev.net/reference/)”页面，其中包含开发人员撰写的关于各种游戏主题的文章。

您不会通过阅读 Chilton 的手册来了解汽车发动机；你必须打开引擎盖，弄脏你的手！

希望这可以帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-09-25T13:56:29.280

我目前正在使用 pygame 开发一个跳棋程序。让图形工作起来非常简单，实现流畅运动所需的数学只是简单的矢量和矢量动画。

棋盘上的每个矩形或正方形都有一个 centerx 和 centery 坐标。左边的下一个正方形对角线是 centerx - 82 和 centery + 82 或右边的下一个对角线是 centerx + 82 和 centery + 82。跳跃只是 2 个对角线。将函数分开以模块化您的代码，并且无需太多数学运算，您就有了一个简单的检查程序。简单的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-31T23:37:06.017

好吧，对于 Java，有一个名为[GridWorld](http://www.horstmann.com/gridworld/)的 API ，（它用作 AP 计算机科学考试的案例研究，这就是我熟悉它的原因）它使用坐标系，所以你可能会从中学到一些东西.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-01T20:23:06.167

您可能想了解[minimax](http://en.wikipedia.org/wiki/Minimax)和[Alpha Beta pruning](http://en.wikipedia.org/wiki/Alpha-beta_pruning)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-03T18:11:34.307

Sprite 动画会根据您选择在哪个平台上执行程序而显着不同，在该平台上进行动画制作的任何通用参考都可以帮助您完成。如果你想为 Java 拍摄，Yoely 的参考资料看起来很不错。

不过，对于游戏 AI，我建议您查看Russell 和 Norvig[的《人工智能：现代方法》 。](https://rads.stackoverflow.com/amzn/click/com/0137903952)它看起来很吓人，要理解这本书的大部分内容，需要掌握高级数学概念的工作知识。但是，它引人入胜且写得很好，您可能可以通过前十几章左右而不会碰到任何数学地雷。那本书中的算法和概念足以帮助你为一个简单的游戏编写人工智能，甚至可以帮助你决定一个游戏。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-03T18:21:14.220

我的建议是使用一种语言/开发环境，使使用精灵变得容易。

看看[从头](http://scratch.mit.edu)开始。

Scratch 网站包含数千个项目，您可以直接在开发环境中下载和编辑这些项目。

这里有一些项目可以帮助您入门：[http ://scratch.mit.edu/tags/view/checkers](http://scratch.mit.edu/tags/view/checkers)

另外，如果您遇到困难，还有一个很好的在线论坛，里面有很多乐于助人的人！

使用 Scratch 制作游戏后，您可以直接从开发环境上传/共享它，也可以将其发布到您自己的网站上（尽管这需要一些操作）。

希望这可以帮助。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-03T19:24:55.767

[http://www.gamedev.net/](http://www.gamedev.net/)

这可能是网络上最著名的游戏/图形编程站点之一。它的论坛涉及计算几何、算法和各级 GPU 编程概念。

你可以在这里得到很多帮助。该站点上已有许多关于游戏编程主题的文章，您可以从中查看示例并了解将这些类型的系统组合在一起背后的思维过程。

:]

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-03T21:12:15.510

[http://www.pygame.org/](http://www.pygame.org/)

Python 非常适合入门，并且有很好的示例和教程可供使用。

# php - 你的意思...？如何猜测用户想要输入的内容（在 404 页面上）

> ID：329769
> 
> 赞同：1
> 
> 时间：2008-12-01T01:29:26.363
> 
> 标签：php, levenshtein-distance

我正在为我的网站自定义 404 页面。我希望它包括一个“你的意思是......？” 我需要弄清楚如何做到这一点。

到目前为止，我正在做的事情是：我列出了用户可能正在寻找的文件的广泛列表，然后使用 levenshtein() 将每个可能的文件名与输入错误的文件名进行比较。“您的意思是”选择了差异最小的那些。

我也考虑过使用 metaphone()，但我认为这可能是过度的。

**对于“您的意思是……？”，您有*什么*建议？脚本？**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-01T01:33:00.850

您可能要考虑的一件事是 Google 的 404 脚本，用于执行您提到的操作。它可能不如自定义解决方案好，但值得尝试确定。

[http://googlewebmastercentral.blogspot.com/2008/08/make-your-404-pages-more-useful.html](http://googlewebmastercentral.blogspot.com/2008/08/make-your-404-pages-more-useful.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-01T01:36:57.127

听起来你想要更多，但你看过[Apache 的 mod_speling](http://httpd.apache.org/docs/2.2/mod/mod_speling.html)

# asp.net-mvc - 与 ASP.NET 3.5 Extensions Preview 2 有什么关系？

> ID：329772
> 
> 赞同：0
> 
> 时间：2008-12-01T01:30:50.807
> 
> 标签：asp.net-mvc

我试图让[MVCToolkit](http://go.microsoft.com/fwlink/?LinkID=106001&clcid=0x409)与 ASP.NET MVC Beta 应用程序一起使用，但遇到了对 System.Web.Extensions 3.6 版的未解决引用（ASP.NET MVC Beta 附带 System.Web.Extensions 3.5 版）。我所有的谷歌搜索似乎都指向微软网站上的一个损坏的下载链接：[ASP.NET 3.5 Extensions Preview 2](http://www.microsoft.com/downloads/details.aspx?FamilyID=a9c6bc06-b894-4b11-8300-35bd2f8fc908&DisplayLang=en)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-01T01:38:04.910

我相信 System.Web.Extensions v3.6 是 .Net 3.5 Service Pack 1 的一部分？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T06:33:35.437

该工具包现在位于 Microsoft.Web.Mvc 中，也称为“Futures”。如果这还不够令人困惑:) 它并没有随着平台的发展而加速。

无论如何 - 工具包不再是“工具包” - 它是平台的一部分（大部分），如果你有测试版，你已经拥有它。只需确保 Micrsoft.Web.Mvc dll 在您的 bin 中即可。

# sql-server - 偶尔的死锁

> ID：329775
> 
> 赞同：2
> 
> 时间：2008-12-01T01:31:34.517
> 
> 标签：sql-server, sql-server-2005, deadlock

我遇到了一个偶尔会死锁的 Web 应用程序的问题

涉及3个查询。2 正在尝试更新表

```
UPDATE AttendanceRoll
SET ErrorFlag = 0
WHERE ContractID = @ContractID
AND DATEPART(month,AttendanceDate) = DATEPART(month,@Month_Beginning)
AND DATEPART(year,AttendanceDate) = DATEPART(year,@Month_Beginning) 
```

一个正试图插入到表中

```
INSERT INTO AttendanceRoll 
    (AttendanceDate, ContractID, PersonID, 
    StartTime, 
    EndTime, 
    Hours, AbsenceReason,
    UpdateCount, SplitShiftID, ModifiedBy, ModifiedDate)
SELECT   
    @P33,  @P34,  @P35,
    CONVERT(datetime,REPLACE( @P36, '.', ':')),
    CONVERT(datetime,REPLACE( @P37, '.', ':')),
    @P38,  @P39,  
    @P40, 1,  @P41, GETDATE() 
```

死锁图显示了页面锁和交换事件的一种循环排列，并且 2 个更新查询具有相同的服务器进程 ID。

如果有人对我应该如何解决这个问题有任何想法，将不胜感激。

如果有人需要，我可以发布死锁图。

谢谢卡尔 R

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T01:38:56.110

更新查询是否需要很长时间才能执行（例如，超过一秒）？如果是这样，请尝试优化查询（即通过在 contractid 列上放置索引等）

在修复死锁时，我总是喜欢做的第一件事就是调整所涉及的查询。如果您可以获得良好的性能改进，那么您将受益于更快的查询，以及大大减少发生死锁的机会。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T01:42:18.350

——根据 jorgeburgos 的建议，然后……

如果这是一个僵局，那么，假设只有 2 名参赛者，一名应该是受害者，一名将完成。

您可以在数据层中构建死锁检测，并让它重试因死锁而失败的操作。

使用不同的表提示锁定机制来最小化争用资源的范围。我不知道哪个适用于您使用的 sql 版本，但这里来自 MSDN。[http://msdn.microsoft.com/en-us/library/ms187373.aspx](http://msdn.microsoft.com/en-us/library/ms187373.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-01T01:48:45.340

在不查看死锁图和所涉及的工作负载的情况下，根据您所说的存在交换，您可能会遇到涉及并行的死锁。[http://msdn.microsoft.com/en-us/library/aa937571(SQL.80).aspx](http://msdn.microsoft.com/en-us/library/aa937571(SQL.80).aspx)。你的死锁图看起来像上一篇文章中的那个吗？

您可以为查询禁用 parralesim 吗？有一个提示 OPTION (MAXDOP 1) 将在特定查询中禁用它。打开它，看看它是否有帮助。[http://msdn.microsoft.com/en-us/library/ms181714.aspx](http://msdn.microsoft.com/en-us/library/ms181714.aspx)

优化索引还可以通过首先消除对并行的需求来缓解僵局。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-01T01:51:36.537

我猜您的更新正在执行表扫描，并最终将行锁升级为页锁到表锁，这会阻止插入完成

我认为有一个设置可以告诉它不要升级到行锁定之外，你可以先试试

否则，您可能必须分离并索引月份数据以提高更新效率

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-04-16T18:28:01.857

我通常将我对 SQL 服务器的所有调用都包含在类似的东西中（确切地说，这不会编译，但你会明白的）：

```
for (;;) {
    try {
        using (var t = BeginTransaction()) {
            DoTheCall();
            t.Commit();
            return;
        }
    }
    catch (SqlException ex) {
        if (ex.Number != 1205 && ex.Number != 601 && ex.Number != 605)
            throw;
    }
} 
```

# .net - ASP.NET - 新应用程序的最佳队列系统

> ID：329779
> 
> 赞同：9
> 
> 时间：2008-12-01T01:35:04.573
> 
> 标签：.net, workflow-foundation, queue, msmq, message-queue

我的组织正准备实施一个新系统，这是一个 asp.net 应用程序。该应用程序将有大量由网站启动的离线工作队列。该队列将保存不同类型的活动，最好是在 XML 消息中。想想电子邮件通知、计划任务等。

过去，该组织可能会使用 MSMQ 来完成此任务。然而，他们认为 MSMQ 是老派（我部分同意他们的观点），因此我们将进行架构审查以确定“最佳”解决方案。

在我看来，有几个潜在的选择：

1\. 坚持在最新版本的 MSMQ 上使用新的实现 - 不理想，但已成为已知产品。
2\. 使用 Windows Workflow Foundation，我从其他一些开发人员那里听说过使用它来做这类事情。
3\. 开发自定义数据库解决方案。

我是否缺少任何明显的解决方案？理想情况下，这将是 Microsoft 产品，但实际上只需要在以 Microsoft 为中心的商店中工作。

我关心以下几点：
1\. 易于实施和维护
2\. 将存在一段时间的解决方案
3\. 能够处理大量行，其中包含中等大小的 XML 数据
4\. 绝对可靠的队列系统，快速更新（多个实用程序进程可能会从队列中抓取记录来处理它们）。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-01T01:48:51.863

阅读这篇文章似乎您认为 MSMQ 不适合的唯一原因是因为有人认为它是“老派”。我不认为这是不使用它的充分理由，因为看起来贵公司有使用它的经验，所以没有学习曲线，这意味着易于实施和维护。

另外，MSMQ 将完美地解决您提到的所有问题。因此，除非有另一个“真正”的理由不使用它，否则我会认为坚持使用 MSMQ。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-01T01:40:36.137

我建议研究 WCF，您可以将其配置为指定持久的、排队的消息传递，并且它在幕后使用 MSMQ 技术。WCF 抽象/接口和技术应该存在很长时间。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-01T14:29:59.737

我同意 Moose-in-the-jungle 的观点，MSMQ 可能是你应该坚持的。

我可能会研究一些使用 MSMQ 的替代 API，比如Udi Dahan 的[nServiceBus](http://www.nservicebus.com/)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-06-08T22:35:13.207

作为 ActiveMQ（上面提到的）的替代品，有开源的 RabbitMQ。据他们所说，它与 ASP.NET 和 WCF 很好地集成在一起。

[http://www.rabbitmq.com/](http://www.rabbitmq.com/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-01T01:38:19.620

您是否查看过 SQL Server 中的 Service Broker？它是一个使用数据库作为后备存储的排队系统。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-01T04:12:01.403

你有几个选择：

1.  Biztalk：它是为保证公司级别的消息传递和路由而构建的。它很难设置，价格昂贵，并且学习曲线陡峭，但是一旦打开它，它就很稳固了。

2.  MSMQ：快速、便宜，就像免费的一样，易于使用，而且工作简单。

3.  SQL 服务代理。它比 MSMQ 更上一层楼，但比 Biztalk 低了一大步。

主要问题归结为您需要的功能集。Biztalk 几乎是它自己的开发环境。而 MSMQ 要求您围绕它构建一切。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-01T10:39:28.920

您可以考虑使用开源消息代理，例如[Apache ActiveMQ](http://activemq.apache.org/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-16T09:24:12.353

不过，对于您的整个系统来说，您可以使用 Windows Workflow 来管理您的业务逻辑，并且只使用 MSMQ 作为您的任务列表的存储。您的工作流程将从队列中拉出下一条消息开始，然后确定如何处理它。

排队是您不想惹恼自己的事情，请将您的信任放在现成的有效并且已经被很多人测试过的东西上。

# javascript - 元素更改时提交表单

> ID：329805
> 
> 赞同：10
> 
> 时间：2008-12-01T01:48:24.500
> 
> 标签：javascript, jquery

在 jQuery 中，如果我分配`class=auto_submit_form`给一个表单，它会在任何元素发生更改时提交，代码如下：

```
/* automatically submit if any element in the form changes */
$(function() {
  $(".auto_submit_form").change(function() {
    this.submit();
  });
}); 
```

但是，如果我只想在指定元素更改时提交表单：

```
/* submit if elements of class=auto_submit_item in the form changes */
$(function() {
  $(".auto_submit_item").change(function() {
    $(this).parents().filter("form").submit();
  });
}); 
```

我只是在学习 jQuery。有一个更好的方法吗？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-12-01T01:50:51.997

```
 /* submit if elements of class=auto_submit_item in the form changes */
$(function() {
   $(".auto_submit_item").change(function() {
     $("form").submit();
   });
 }); 
```

假设您在页面上只有一个表单。如果没有，您需要选择作为当前元素祖先的表单，使用`$(this).parents("form").submit()`

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-12-01T02:23:24.913

您可以在方法中使用表达式`parents()`来过滤父级。因此，这可能会更有效一些：

```
/* submit if elements of class=auto_submit_item in the form changes */
$(".auto_submit_item").change(function() {
    $(this).parents("form").submit();
}); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-01T02:35:45.713

我会给表格一个id：

```
$(".auto-submit-item").change(function() {
    $("form#auto-submit").submit();
}); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-07-06T09:16:36.913

我想出了一个通用的方法来解决这个问题：

```
$('.autoSubmit, .autoSubmit select, .autoSubmit input, .autoSubmit textarea').change(function () {
    const el = $(this);
    let form;

    if (el.is('form')) { form = el; }
    else { form = el.closest('form'); }

    form.submit();
}); 
```

表单的所有元素：

```
<form class="autoSubmit">
    <select><option>1</option><option>2</option></select>
</form> 
```

只有个别元素

```
<form>
    <select class="autoSubmit"><option>1</option><option>2</option></select>
</form> 
```

# wpf - 应用程序在更改包含带有 ItemTemplates 的 ListBoxes 的选项卡时崩溃

> ID：329816
> 
> 赞同：0
> 
> 时间：2008-12-01T01:53:56.407
> 
> 标签：wpf, datatemplate

我有一个带有两个 TabItems 的 WPF TabControl。每个 TabItem 都包含一个 ListBox，其中一个单独的 ObservableCollection 作为其 ItemsSource。每个 ListBox 都有不同的 ItemTemplate。

无论我设置在启动时选择哪个 TabItem，该选项卡都会正常显示，但是当我单击另一个选项卡时，应用程序崩溃，并出现“调用目标引发异常”错误，指向 DataTemplate我要切换到的选项卡。

如果我从选项卡上的 ListBox 中删除 ItemTemplate，我试图切换到（并使用 DisplayMemberPath）一切正常。

但是，如果我使用 DataTemplate，无论是内联还是作为静态资源或动态资源，都会导致选项卡切换时崩溃。

有任何想法吗？伪代码如下：

* * *

```
<Window x:Class="Example.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:objects="clr-namespace:Example.CoreObjects"
    xmlns:controls="clr-namespace:Example.Controls"
    >
<Window.Resources>
    <DataTemplate x:Key="ItemTemplateOne">
        <controls:CustomControlOne />
    </DataTemplate>
    <DataTemplate x:Key="ItemTemplateTwo">
        <controls:CustomControlTwo />
    </DataTemplate>
</Window.Resources>
<Grid>
    <TabControl Name="tabControl1">
        <TabItem Header="TabOne">
            <Grid>
                <ScrollViewer>
                    <ListBox Name="ListBoxOne" 
                             ItemsSource="{Binding}"
                             ItemTemplate="{StaticResource ItemTemplateOne}"
                             >
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel /> 
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>
                    </ListBox>
                </ScrollViewer>
            </Grid>
        </TabItem>
        <TabItem Header="TabTwo">
            <Grid>
                <ScrollViewer>
                    <ListBox Name="ListBoxTwo" 
                             ItemsSource="{Binding}"
                             ItemTemplate="{StaticResource ItemTemplateTwo}"
                             >
                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel />
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>
                    </ListBox>
                </ScrollViewer>
            </Grid>
        </TabItem>
    </TabControl>
</Grid> 
```

公共 Window1() { InitializeComponent();

```
ListBoxOne.DataContext = ObservableCollectionOne;
CollectionViewOne = CollectionViewSource.GetDefaultView(ObservableCollectionOne);
CollectionViewOne.SortDescriptions.Add(new SortDescription("SortProperty", ListSortDirection.Descending));

ListBoxTwo.DataContext = ObservableCollectionTwo;
CollectionViewTwo = CollectionViewSource.GetDefaultView(ObservableCollectionTwo);
CollectionViewTwo.SortDescriptions.Add(new SortDescription("SortProperty", ListSortDirection.Descending)); 
```

}

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T03:29:49.427

> 无论我设置在启动时选择哪个 TabItem，该选项卡都会正常显示，但是当我单击另一个选项卡时，应用程序崩溃，并出现“调用目标引发异常”错误，指向 DataTemplate我要切换到的选项卡。

启用第一次机会异常，这样您就可以找出实际的异常而不是包装的外部异常 - 出了什么问题会更清楚。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T02:13:05.073

我认为问题在于 ListBox 的 ItemSource="{Binding}"。我认为这表示要绑定到 Window 的 DataContext，但在代码中您单独设置。

尝试在 Window.Resources 中声明一个 CollectionViewSource（或两个，如果您希望 ListBoxes 之间有不同的排序）。将 Observablecollection 设置为 CollectionViewSource 的来源。

然后在您的 ListBoxes 中，绑定到 CollectionView 源。

如果这不起作用，您可以尝试将每个 ListBox 及其关联的数据资源放入单独的 UserControl 中。

# sql - MySQL严格选择涉及多对多表的行

> ID：329822
> 
> 赞同：0
> 
> 时间：2008-12-01T01:56:26.167
> 
> 标签：sql, mysql, many-to-many

我有三个多对多格式的表。即，表 A、B 和 AB 已按您的预期设置。

给定一组 A id，我只需要选择 AB 中与所有 id 匹配的行。

像下面这样的东西是行不通的：

"SELECT * FROM AB WHERE A_id = 1 AND A_id = 2 AND A_id = 3 AND ..." 因为单行不会有多个 A_id

使用 sql 语句中的 OR 并没有更好，因为它产生的结果是所有具有至少一个 A id 的结果（而我只想要那些具有所有 id 的行）。

**编辑：**

对不起，我应该解释一下。我不知道实际的多对多关系是否与实际问题相关。这些表格概述如下：

```
Table People
int id
char name

Table Options
int id
char option

Table peoples_options
int id
int people_id
int option_id 
```

所以我有一个人员列表，一个选项列表，以及一个选项和人员表。

因此，给定一个选项 ID 列表，例如 (1, 34, 44, ...)，我只需要选择那些拥有所有选项的人。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T02:06:59.063

您的数据库似乎没有正确规范化。您的表的每一行都`AB`应该有一个`A_id`和一个。`B_id`如果是这种情况，您的`OR`-version 应该可以工作（尽管我会使用`IN`自己）。

忽略前一段。从您的编辑中，您真的想知道在多对多表中`B`具有 ' 的所有子集的所有' - 请参阅下面的查询。`A`

请告诉我们实际的架构细节，如果没有它，很难弄清楚你想要什么。

我希望看到类似的东西：

```
table a:
    a_id integer
    a_payload varchar(20)
table b:
    b_id integer
    b_payload varchar(20)
table ab:
    a_id integer
    b_id integer 
```

根据您的描述，我唯一能想到的是您想要一个列表中包含所有`B`' 的所有`A`' 的`AB`列表。在这种情况下，您正在查看类似（获取`B`具有`A`1、3 和 4 的 ' 的列表）：

```
select distinct b_id from ab n1             
    where exists (select b_id from ab where a_id = 1 and b_id = n1.b_id)     
    and   exists (select b_id from ab where a_id = 3 and b_id = n1.b_id)     
    and   exists (select b_id from ab where a_id = 4 and b_id = n1.b_id); 
```

这在 DB2 中有效，但我不确定您选择的服务器实现了多少 SQL。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T02:24:10.310

一个 hacky 解决方案是将 IN 与 group by 一起使用并具有过滤器。像这样：

```
SELECT B_id FROM AB
WHERE A_id IN (1,2,3)
GROUP BY B_id
HAVING COUNT(DISTINCT A_id) = 3; 
```

这样，您只能获得恰好具有 3 个 A_id 值的 B_id 值，并且它们必须来自您的列表。我在 COUNT 中使用了 DISTINCT，以防 (A_id, B_id) 不是唯一的。如果您需要其他列，则可以作为另一个 select 语句的 FROM 子句中的子选择加入此查询。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-11-03T22:49:47.247

试试这个......它带来了与所有选项相关的所有人。

换句话说，该查询使所有人认为它不存在与它无关的选项。

* * *

```
select
    p.*
from
    people p
where
    not exists (
              select 
                      1 
              from 
                      options o
              where
                      not exists 
                      (
                          select 1
                          from   peoples_options po 
                          where  po.people_id     = p.people_id
                                 AND po.option_id = o.option_id
                      )
           ) 
```

# .net - 源代码控制布局

> ID：329831
> 
> 赞同：2
> 
> 时间：2008-12-01T02:00:59.170
> 
> 标签：.net, version-control, file

我开发了各种应用程序，并拥有 3-4 个杂项库，我在这些应用程序中重复使用它们（一个用于数学，一个用于数据库函数等）。

目前我有一个主源目录，每个项目都作为顶级目录（包括我的帮助项目）。并且每个需要帮助器的项目都将整个项目添加为解决方案中的参考（而不是针对库）。这允许对帮助程序库进行快速调试/更新，但很快就会变得很麻烦，因为我总是必须重新构建帮助程序，并且可以对许多旧程序使用的接口进行重大更改。

所有这些都存储在 subversion 存储库的主干目录中，当我分支特定目录时，我会创建一个巨大的分支等。这很难保持向后兼容性以及存储库的剪切代码大小和本地大小。

处理这些情况的最佳方法是什么？你如何布局你的各种项目。

您是否将每个项目都放在自己的 subversion 存储库中？或者您是否使用具有多个顶级项目和主干/分支/标签的存储库？

您如何参考替代项目？你只是编译这些并参考数据吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-01T03:14:47.883

请参阅我在[项目文件夹结构推荐](https://stackoverflow.com/questions/296643/projects-folder-structure-recommendation#296793)和[如何组织版本控制存储库中的答案？](https://stackoverflow.com/questions/222827/how-do-you-organize-your-version-control-repository#304036).

对于您的具体问题，问题是管理项目间的依赖关系。答案是对它们进行版本控制——每个依赖于另一个项目的项目应该只依赖于该项目的二进制可交付成果（或最接近的等价物，如果不是已编译的程序/库），并且该可交付成果应该在每个此类引用中进行版本控制。当然，您首先需要确保每个项目都生成一个且仅一个二进制可交付成果（或等效项）。

通过仅依赖来自另一个项目的二进制可交付成果，您可以使每个项目独立并大大简化其维护，因为它的“构建接口”是单个文件。进入另一个项目的源代码/构建就像进入一个库的实现中间=很多问题。

By versioning each project, you can modify a particular project's source on behalf of another (new) project, but not affect any of the other old projects that used it. In effect, each project becomes a PRODUCT. Like any product, you should manage its releases and its compatibility with other products.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T02:42:41.050

我的可重用库是在存储库中具有单独源代码目录的单独项目中开发的（我使用 TFS，但它应该适用于 SVN）。我在一个公共位置发布这些库的版本——在我的例子中是通过 DFS 引用的网络共享。我根据需要将对已发布库的引用添加到我的其他项目中。如果我发现出于某种原因需要维护一个库的多个版本，有时我会使用版本控制（命名版本）。从某种意义上说，我将它们都视为 3rd-party 组件，并且不直接引用他们的项目。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-01T02:43:04.077

我认为您需要针对常见项目的单独解决方案，并为它们提供自己的构建过程。我会将它们链接为您的主要项目中的二进制引用。如果您有 pdb 文件，您仍然可以使用 Visual Studio 调试此代码。我认为这是扩展的唯一方法，否则您会一直遇到这些问题

一种想法是将所有共享库放在一个位置，并让本地项目创建一个 ext 目录来放置所有共享链接二进制文件。然后，您可以编写脚本来检查更新版本等，以避免不得不手动升级

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-12-01T02:08:15.957

我从未使用过颠覆，但我可以在存储库问题之外提供一些信息。我的回答是这真的取决于场景和公司。对于我参与的最大项目之一，我们使用了以下结构。该项目由大约 20 个核心组件组成，这些组件将在各种应用程序之间共享。我们也在使用 TFS。

我们定义了一个 Common TFS 项目，它包含一个单一的主构建解决方案来构建公共项目中的所有项目。当我们构建时，我们会发布二进制文件。

然后，我们为每个业务部门及其各种应用程序创建了一个 TFS 项目（每个 BU 可以有 1 到 n 个项目/应用程序）。然后，我们设置应用程序以使用文件引用将二进制文件拉入他们自己的项目中。在这种情况下，业务部门将公共库视为第三方产品。

在不太正式的情况下，我们会让业务部门直接引用构建输出（它们会被检查回源代码控制系统）。这允许业务部门在编译后获得新版本，但正如您所指出的那样引入了兼容性问题。这就是让他们完全隔离的地方。

# javascript - 封装在javascript中

> ID：329837
> 
> 赞同：1
> 
> 时间：2008-12-01T02:04:41.487
> 
> 标签：javascript

我需要创建简单的可重用 javascript 对象，发布几个方法和参数化构造函数。在阅读了几本“JavaScript 中的 OOP”指南后，我坐在这里一头雾水。我到底怎么能做到这一点？

这是我最后一个非工作代码：

```
SomeClass = function(id) {
    this._id = id;
}
(function() {
    function intFun() {
        return this._id;
    }
    SomeClass.prototype.extFun = function() {
        return incFun();
    }
})(); 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-01T02:08:23.210

这是我通常的做法：

```
MyClass = function(x, y, z) {
   // This is the constructor. When you use it with "new MyClass(),"
   // then "this" refers to the new object being constructed. So you can
   // assign member variables to it.
   this.x = x;
   ...
};
MyClass.prototype = {
    doSomething: function() {
        // Here we can use the member variable that
        // we created in the constructor.
        return this.x;
    },
    somethingElse: function(a) {
    }
};

var myObj = new MyClass(1,2,3);
alert(myObj.doSomething()); // this will return the object's "x" member
alert(myObj.x); // this will do the same, by accessing the member directly 
```

通常，“this”关键字在对象的方法之一中使用时，将引用对象本身。当您在构造函数中使用它时，它将引用正在创建的新对象。所以在上面的例子中，两个警报语句都将显示“1”。

* * *

此规则的一个例外是当您将其中一个成员函数传递到其他地方，然后调用它。例如，

```
myDiv.onclick = myObj.doSomething; 
```

在这种情况下，JavaScript 忽略了“doSomething”属于“myObj”这一事实。结果，doSomething 中的“this”将指向另一个对象，因此该方法不会按预期工作。为了解决这个问题，您需要指定“this”应该引用的对象。您可以使用 JavaScript 的“调用”函数来做到这一点：

```
myDiv.onclick = function() {
    myObj.doSomething.call(myObj);
} 
```

这很奇怪，但你最终会习惯的。底线是，在传递方法时，您还需要传递应该调用它们的对象。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-01T02:25:30.633

我通常不会太担心隐藏内部结构，尽管我会在它们前面加上下划线以将它们标记为不打算在“类”之外使用。通常我会做的是：

```
var MyClass = function() {};

MyClass.prototype = {
   _someVar : null,
   _otherVar : null,

   initialize: function( optionHash ) {
                _someVar = optionsHash["varValue"];
                _otherVar = optionsHash["otherValue"];
           },

   method: function( arg ) {
               return _someVar  + arg;  
           },
}; 
```

并像这样使用它...

```
var myClass = new MyClass( { varValue: -1, otherValue: 10 } );
var foo = myClass.method(6); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-01T02:31:51.277

所有**变量**都是私有的：

```
SomeClass = function (id) {
    var THIS = this; // unambiguous reference
    THIS._id = id;

    var intFun = function () { // private
        return THIS._id;
    }

    this.extFun = function () { // public
        return intFun();
    }
} 
```

**`THIS`**在私有方法中使用，因为**`this`**不会等于您所期望的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-05-23T23:07:03.143

来自[http://learn.jquery.com/code-organization/concepts/#the-module-pattern](http://learn.jquery.com/code-organization/concepts/#the-module-pattern)：

```
// The module pattern
var feature = (function() {

    // private variables and functions
    var privateThing = "secret";
    var publicThing = "not secret";

    var changePrivateThing = function() {
        privateThing = "super secret";
    };

    var sayPrivateThing = function() {
        console.log( privateThing );
        changePrivateThing();
    };

    // public API
    return {
        publicThing: publicThing,
        sayPrivateThing: sayPrivateThing
    };

})();

feature.publicThing; // "not secret"

// logs "secret" and changes the value of privateThing
feature.sayPrivateThing(); 
```

因此，使用返回一个为其“方法”起别名的对象可能是另一种方法。

我从[http://www.amazon.com/Programming-Oracle-Press-Poornachandra-Sarang-ebook/dp/B0079GI6CW](https://rads.stackoverflow.com/amzn/click/com/B0079GI6CW)读到，使用 getter 和 setter 总是一种好习惯，而不是直接从外部访问变量对象，这样就不需要通过引用返回变量。

* * *

**顺便说一句，您可以只使用`this.variable`引用/声明公共变量并`var variable`声明私有变量。**

* * *

我知道这是一个迟到的答案，但我希望它对将来阅读它的人有所帮助。

# c++ - C++ 设计 - 网络数据包和序列化

> ID：329838
> 
> 赞同：4
> 
> 时间：2008-12-01T02:06:13.857
> 
> 标签：c++, inheritance, serialization

对于我的游戏，我有一个 Packet 类，它代表网络数据包，基本上由一组数据和一些纯虚函数组成

然后我想要从 Packet 派生的类，例如：StatePacket、PauseRequestPacket 等。这些子类中的每一个都将实现虚函数 Handle()，当这些数据包之一时，网络引擎将调用它接收它以便它可以完成它的工作，几个 get/set 函数将读取和设置数据数组中的字段。

所以我有两个问题：

1.  （抽象）数据包类需要可复制和可分配，但无需切片，保留派生类的所有字段。派生类甚至可能没有额外的字段，只有函数，这将与基类上的数组一起使用。我怎样才能做到这一点？
2.  序列化时，我会给每个子类一个唯一的数字 ID，然后在子类自己的序列化之前将其写入流中。但是对于反序列化，我如何将读取的 ID 映射到适当的子类以实例化它？

如果有人想要任何澄清，请问。

- 谢谢

* * *

**编辑：**我对此不太满意，但这就是我所管理的：

Packet.h：[http](http://pastebin.com/f512e52f1)
://pastebin.com/f512e52f1 Packet.cpp：[http ://pastebin.com/f5d535d19 PacketFactory.h：](http://pastebin.com/f5d535d19) [http ://pastebin.com/f29b7d637 PacketFactory.cpp：](http://pastebin.com/f29b7d637) [http](http://pastebin.com/f689edd9b)
: //pastebin.com [/f689edd9b](http://pastebin.com/f689edd9b) PacketAcknowledge.h：[http ://pastebin.com/f50f13d6f PacketAcknowledge.cpp：](http://pastebin.com/f50f13d6f) [http](http://pastebin.com/f62d34eef) ://pastebin.com/f62d34eef

如果有人有时间查看它并提出任何改进建议，我将不胜感激。

* * *

是的，我知道工厂模式，但我将如何编写代码来构造每个类？一个巨大的开关声明？这也会复制每个类的 ID（一次在工厂中，一个在序列化器中），我想避免这种情况。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-01T02:12:39.660

对于复制，您需要编写一个克隆函数，因为构造函数不能是虚拟的：

```
virtual Packet * clone() const = 0; 
```

每个 Packet 实现都是这样实现的：

```
virtual Packet * clone() const {
    return new StatePacket(*this);
} 
```

例如状态包。数据包类应该是不可变的。一旦收到一个数据包，它的数据可以被复制出来，也可以被丢弃。所以不需要赋值运算符。将赋值运算符设为私有而不定义它，这将有效地禁止分配包。

对于反序列化，您使用工厂模式：创建一个类，该类在给定消息 id 的情况下创建正确的消息类型。为此，您可以在已知消息 ID 上使用 switch 语句，也可以使用如下映射：

```
struct MessageFactory {
    std::map<Packet::IdType, Packet (*)()> map;

    MessageFactory() {
        map[StatePacket::Id] = &StatePacket::createInstance;
        // ... all other
    }

    Packet * createInstance(Packet::IdType id) {
        return map[id](); 
    }
} globalMessageFactory; 
```

实际上，您应该添加检查，例如 id 是否真的已知等等。这只是粗略的想法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T02:08:03.617

您需要查找工厂模式。

工厂查看传入的数据并为您创建正确类的对象。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-01T13:17:11.130

要拥有一个事先不知道所有类型的工厂类，您需要提供一个单例，每个类都在其中注册自己。我总是弄错定义模板类的静态成员的语法，所以不要只是剪切和粘贴：

```
class Packet { ... };

typedef Packet* (*packet_creator)();

class Factory {
public:
  bool add_type(int id, packet_creator) {
    map_[id] = packet_creator; return true;
  }
};

template<typename T>
class register_with_factory {
public:
  static Packet * create() { return new T; }
  static bool registered;
};

template<typename T>
bool register_with_factory<T>::registered = Factory::add_type(T::id(), create);

class MyPacket : private register_with_factory<MyPacket>, public Packet {
//... your stuff here...

  static int id() { return /* some number that you decide */; }
}; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-01T20:20:48.060

为什么我们，包括我自己，总是把这么简单的问题搞得这么复杂？

* * *

也许我不在这儿了。但我不得不怀疑：这真的是满足您需求的最佳设计吗？

总的来说，仅函数继承可以通过函数/方法指针、聚合/委托和数据对象的传递来更好地实现，而不是通过多态性。

多态是一个非常强大和有用的工具。但这只是我们可用的众多工具之一。

* * *

看起来 Packet 的每个子类都需要自己的编组和解组代码。也许继承了 Packet 的 Marshalling/Unmarshalling 代码？也许延长它？一切都在 handle() 和其他任何需要的之上。

这是很多代码。

虽然更加笨拙，但将 Packet 的数据实现为 Packet 类的结构/联合属性可能会更短、更快。

编组和解组随后将集中化。

根据您的架构，它可能像 write(&data) 一样简单。假设您的客户端/服务器系统之间没有大/小端问题，也没有填充问题。（例如 sizeof(data) 在两个系统上都是相同的。）

Write(&data)/read(&data)**是一种容易出错的技术**。但这通常是编写初稿的一种非常快速的方法。稍后，如果时间允许，您可以将其替换为基于每个属性类型的编组/解组代码。

*另外：*我已经开始存储作为结构发送/接收的数据。您可以使用 operator=() 按位复制结构，这有时非常有用！虽然在这种情况下可能不是那么多。

* * *

最终，您将在该 subclass-id 类型的某处有一个*switch语句。*工厂技术（它本身就非常强大和有用）为您执行此切换，查找必要的 clone() 或 copy() 方法/对象。

**或者**你可以在 Packet 中自己做。你可以使用简单的东西：

(getHandlerPointer(id))(这个)

* * *

除了快速的开发时间之外，这种 kludgey（函数指针）方法的另一个优点是您不需要为每个数据包不断地分配和删除一个新对象。您可以一遍又一遍地重复使用单个数据包对象。或者，如果您想将它们排队，则为数据包向量。（请注意，我会在再次调用 read() 之前清除 Packet 对象！为了安全起见......）

根据您游戏的网络流量密度，分配/解除分配可能会变得昂贵。再说一遍，**过早的优化是万恶之源。** 而且您总是可以滚动自己的新/删除运算符。（还有更多的编码开销......）

* * *

您失去的（使用函数指针）是每种数据包类型的干净隔离。特别是能够在不更改预先存在的代码/文件的情况下添加新的数据包类型。

* * *

示例代码：

```
class Packet
{
public:
  enum PACKET_TYPES
  {
    STATE_PACKET = 0,
    PAUSE_REQUEST_PACKET,

    MAXIMUM_PACKET_TYPES,
    FIRST_PACKET_TYPE = STATE_PACKET
  };

  typedef  bool ( * HandlerType ) ( const Packet & );

protected:
        /* Note: Initialize handlers to NULL when declared! */
  static HandlerType  handlers [ MAXIMUM_PACKET_TYPES ];

  static HandlerType  getHandler( int thePacketType )
    {   // My own assert macro...
      UASSERT( thePacketType, >=, FIRST_PACKET_TYPE    );
      UASSERT( thePacketType, <,  MAXIMUM_PACKET_TYPES );
      UASSERT( handlers [ thePacketType ], !=, HandlerType(NULL) );
      return handlers [ thePacketType ];
    }

protected:
   struct Data
   {
            // Common data to all packets.
     int  number;
     int  type;

     union
     {
       struct
       {
         int foo;
       } statePacket;

       struct
       {
         int bar;
       } pauseRequestPacket;

     } u;

   } data;

public:

  //...
  bool readFromSocket() { /*read(&data); */ }  // Unmarshal
  bool writeToSocket()  { /*write(&data);*/ }  // Marshal

  bool handle() { return ( getHandler( data.type ) ) ( * this ); }

}; /* class Packet */ 
```

* * *

PS：你可能会用谷歌搜索并下载 cdecl/c++decl。它们是非常有用的程序。尤其是在使用函数指针时。

例如：

```
c++decl> declare foo as function(int) returning pointer to function returning void
void (*foo(int ))()
c++decl> explain void (* getHandler( int  ))( const int & );
declare getHandler as function (int) returning pointer to function (reference to const int) returning void 
```

# svn - 外部存储库更改

> ID：329843
> 
> 赞同：2
> 
> 时间：2008-12-01T02:07:34.587
> 
> 标签：svn, version-control

我使用 svn:externals 来引用几个开源项目。然后，我对这些外部项目之一进行了一些本地更改。显然，我无法将这些更改检查回外部存储库。如何在我的存储库中保留这些更改，同时仍保持轻松合并外部更改的能力？

Git 让这很容易，但我使用 Subversion，所以我正在寻找一种 SVN 友好的方式来做到这一点。（我对 1.5+ SVN 服务器使用 Tortoise SVN 客户端）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-20T21:24:49.823

以防万一它仍然相关，并且对于未来的用户：我认为您希望在['vendor branch'](http://svnbook.red-bean.com/en/1.5/svn.advanced.vendorbr.html)中维护对外部项目的更改。

*   将外部代码的副本导入存储库中的单独项目
*   在您自己的项目中创建它的一个分支，您可以在其中添加您自己的修改
*   您会定期更新原始分支中的项目代码，以便将这些更改合并到您自己的分支中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T04:09:35.137

考虑在本地使用 svk。我相信您可以继续将远程更改拉入本地存储库，但您永远不会推回更改。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-01-28T00:14:41.607

我支持[jeroenh](https://stackoverflow.com/questions/329843/external-repository-changes/1156028#1156028)上面的回答，因为您使用“SVN 友好”方式来维护外部代码。

svk 不是解决方案，因为您无法将更改的内容提交到外部存储库。如果您使用svk，您还不如在svn中编辑外部代码......只是不要提交它们。

# vb.net - 在 VB.net 中的代码中创建串行端口

> ID：329865
> 
> 赞同：6
> 
> 时间：2008-12-01T02:25:48.293
> 
> 标签：vb.net, visual-studio, serial-port

我正在尝试仅使用代码在 VB.net 中创建一个串行端口。因为我正在创建一个类库，所以我不能使用内置组件。我已经尝试实例化一个新的 SeialPort() 对象，但这似乎还不够。我确信我缺少一些简单的东西，任何帮助将不胜感激！谢谢！

PS 我应该补充一点，我此时遇到的问题是获取代码来处理 datareceived 事件。除此之外，它可能正在工作，但由于这个问题我无法判断。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-01T19:15:34.340

如果您想使用事件，请确保使用“withevents”声明您的 serialPort 对象。下面的示例将允许您连接到串行端口，并将使用接收到的字符串引发事件。

```
Imports System.Threading

Imports System.IO

Imports System.Text

Imports System.IO.Ports

Public Class clsBarcodeScanner

Public Event ScanDataRecieved(ByVal data As String)
WithEvents comPort As SerialPort

Public Sub Connect()
    Try
        comPort = My.Computer.Ports.OpenSerialPort("COM5", 9600)
    Catch
    End Try
End Sub

Public Sub Disconnect()

    If comPort IsNot Nothing AndAlso comPort.IsOpen Then
        comPort.Close()
    End If

End Sub

Private Sub comPort_DataReceived(ByVal sender As Object, ByVal e As System.IO.Ports.SerialDataReceivedEventArgs) Handles comPort.DataReceived
    Dim str As String = ""
    If e.EventType = SerialData.Chars Then
        Do
            Dim bytecount As Integer = comPort.BytesToRead

            If bytecount = 0 Then
                Exit Do
            End If
            Dim byteBuffer(bytecount) As Byte

            comPort.Read(byteBuffer, 0, bytecount)
            str = str & System.Text.Encoding.ASCII.GetString(byteBuffer, 0, 1)

        Loop
    End If

    RaiseEvent ScanDataRecieved(str)

End Sub
End Class 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-01T02:50:19.930

我发现[这篇文章](https://web.archive.org/web/20130709121945/http://msmvps.com/blogs/coad/archive/2005/03/23/SerialPort-_2800_RS_2D00_232-Serial-COM-Port_2900_-in-C_2300_-.NET.aspx)非常好。

我写的代码是：

```
port = new System.IO.Ports.SerialPort(name, 4800, System.IO.Ports.Parity.None, 8, System.IO.Ports.StopBits.One);
port.DataReceived += new System.IO.Ports.SerialDataReceivedEventHandler(port_DataReceived);
port.Open();

void port_DataReceived(object sender, System.IO.Ports.SerialDataReceivedEventArgs e)
{
    buffer = port.ReadLine();
    // process line
} 
```

抱歉，它是 C#，但是...

我遇到的唯一问题是如果端口在打开时被丢弃，应用程序似乎在退出时失败。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-02T21:42:57.443

谢谢大家的帮助，特别是关于使用 WithEvents 关键字实例化类的答案。

我发现了一篇非常棒的文章，它解释了如何为串行端口创建一个管理器类。它还讨论了将二进制和十六进制数据发送到串行端口。这很有帮助。

[http://www.dreamincode.net/forums/showtopic37361.htm](http://www.dreamincode.net/forums/showtopic37361.htm)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-01T02:37:32.730

我在过去的项目中使用了 SerialPort .Net 类，并且工作正常。你真的不需要其他任何东西。检查控制面板中的硬件设置，并确保使用相同的参数实例化类。

# mysql - 从 cygwin 连接到 mysql

> ID：329866
> 
> 赞同：58
> 
> 时间：2008-12-01T02:26:53.843
> 
> 标签：mysql, cygwin

我可以从 DOS 提示符成功连接到 MySQL，但是当我尝试从 cygwin 连接时，它只是挂起。

```
$/cygdrive/c/Program\ Files/MySQL/MySQL\ Server\ 5.1/bin/mysql -u root -p 
```

怎么了？

* * *

## 回答 #1

> 赞同：75
> 
> 时间：2012-04-03T15:43:50.303

我刚遇到这个，当我读到有人提到它是你在 cygwin 中运行的 windows/DOS 命令时，我做了一个`which mysql`，这给了我：

```
$ which mysql
/cygdrive/c/Program Files/MySQL/MySQL Server 5.5/bin/mysql 
```

所以我运行 cygwin`Setup.exe`搜索“mysql”并安装了最新的“mysql 客户端”。现在`which mysql`看起来像：

```
$ which mysql
/usr/bin/mysql 
```

MySQL 命令在 cygwin 中工作 :)

虽然这是一个老问题，但如果能在这里得到实际答案会很好，因为人们（比如我自己）可能仍然会偶然发现它。

如果您尝试从 Cygwin 运行 MySQL 客户端返回以下错误：

```
$ mysql -u root -p
Enter password:
ERROR 2002 (HY000): Can't connect to local MySQL server through socket '/var/run/mysql.sock' (2) 
```

`-h 127.0.0.1`然后，您可以通过在命令行中添加显式选项来修复它，如下所示：

```
$ mysql -u root -p -h 127.0.0.1 
```

**基于评论的更新：**

为避免`-h 127.0.0.1`每次连接时都在命令行上指定，您可以添加：

```
[client]
host=127.0.0.1 
```

到文件`/etc/my.cnf`

在 Cygwin 的某些安装中，指定主机`-h`可能还不够。如果是这样，请尝试同时指定：

```
--protocol=tcp 
```

或添加

```
protocol=tcp 
```

到配置文件。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-12-01T03:19:48.683

假设您有 MySQL 的本机 Windows 版本，`DOS`（命令提示符）窗口和`bash`. 提示`mysql`没有出现。

要确认这一点，请键入命令并返回 - 它可能会起作用，但命令的提示符和回显（您正在输入的内容）会丢失。

`CYGWIN`在sytem properties 或 in中可能有一种解决方法`bash`，但我从来没有花时间解决这个问题。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2013-07-15T12:59:02.650

其他答案缺少以下*关键*细节：

Cygwin 有两个 shell：

1.  默认：`c:\cygwin\bin\mintty.exe`
2.  基本：（`c:\cygwin\Cygwin.bat`启动`c:\cygwin\bin\bash.exe`）

Win32 MySQL 可以正确写入 #2，但*不能*正确写入#1，因为[Win32 MySQL 无法正确探测标准输入](http://lists.mysql.com/win32/6625)（感谢@PeterNore）

想知道您是否在使用 Win32 MySQL？使用`which`，例如

```
$ which mysql
/cygdrive/c/Program Files/MySQL/MySQL Server 5.1/bin/mysql 
```

*奖励*： [克服路径问题的 Cygwin 指南](http://www.cygwin.com/cygwin-ug-net/using-effectively.html) （[感谢@Dustin](https://stackoverflow.com/a/334802/939250)）

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-02T17:54:08.887

我在这里发布了一个解决方案/解决方法：

[在 cygwin 下的 Windows 应用程序中有时无法识别输入键](https://stackoverflow.com/questions/202405/enter-key-sometimes-not-recognized-in-windows-apps-under-cygwin#334802)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-01-05T13:52:13.187

从 cmd.exe 可执行文件运行 bash，然后 mysql 将在 bash 中运行。

1.  在桌面上为 cmd.exe 创建一个快捷方式。
2.  打开快捷方式的属性并将启动目录更改为 cygwin bin 目录（通常为 C:\cygwin\bin）。
3.  在目标参数中的命令末尾添加“/c bash.exe”。

这将在 windows cmd.exe 环境下运行 bash，当您尝试运行 mysql 时，它将按预期执行。这在 Windows 7 下工作，但尚未在任何其他版本中进行测试。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-04-09T18:03:07.797

1.  将 cygwin bin 目录放在路径环境变量中。
2.  通过运行 cmd 使用命令窗口
3.  在 cmd 窗口中运行 bash -l

然后MySQL可以毫无问题地运行。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-06-06T12:18:52.590

斯文德汉森的答案是正确的：

*   安装 windows mysql 服务器文件（例如从 mysql-5.5.25-win32.msi ）

*   使用 cygwin 安装程序 (setup.exe) 安装 Cygwin mysql 客户端

*   使用 cygwin 客户端“mysql -u[user] -p[Password] -h[host]”在 cygwin 窗口中连接到您的服务器，在我的情况下为“mysql -uroot -pXXXX -h127.0.0.1”

我认为当问题发布时，cygwin设置没有提供mysql组件，现在已经解决了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-01-28T22:52:15.180

我为此创建了一个让我满意的半修复程序。我在 cmd.exe 中运行 cygwin.bat，然后输入 mysql - 一切正常。

我意识到问题很严重。

简单的解决方案？下载[Console2](http://sourceforge.net/projects/console/)，在设置下你可以将它指向 cygwin shell。重启Console2，运行mysql，出现输出。

无论如何，这是有利的，因为 Console2 具有比 Mintty 更强大的界面/定制。我真的很喜欢透明度和颜色映射选项。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-09-25T10:11:21.653

做这个：

1.  只需从 C:\Program Files\MySQL\MySQL Server 5.5\bin 复制你的 mysql.exe
2.  将此 mysql.exe 粘贴到 C:\cygwin\usr\local\bin
3.  现在运行哪个mysql，它会

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-02-02T10:24:35.040

Althoug [Svend Hansen 的回答](https://stackoverflow.com/a/9996769/179669)有一些要点，另一件事是环境变量中的 PATH - 如果**mysql 的路径在****cygwin**之前

 **```
which mysql 
```

将会呈现

```
/cygdrive/c/Program Files/MySQL/MySQL Server 5.5/bin/mysql 
```

否则它将显示 cygwin 客户端。

正如参考维基百科所说：

> 某些程序可能会在安装过程中将其目录添加到 PATH 变量内容的**前面**，以加快搜索过程和/或覆盖操作系统命令。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-04-19T01:07:56.633

免责声明：以下在 MinGW/MSYS 上的 MinTTY 下为我解决了这个问题。根据研究，我相信同样的根本原因也会影响 Cygwin。

答案发布在这里：[https ://stackoverflow.com/a/23164362/1034436](https://stackoverflow.com/a/23164362/1034436)

简而言之，您需要在`mysql`命令前加上 winpty `console.exe`（或使用别名）。该解决方案适用于**本机**Windows MySQL 可执行文件，而不是特殊的 cygwin/mingw 构建。但是，您必须编译 winpty，但这既简单又轻松，并且按照他们为我提供的文档工作。

注意：这也解决了我使用其他几个本机 Windows 控制台应用程序的问题，即 Python 和 Mercurial with OpenSSH。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-10-25T05:56:42.350

1.  下载 Cygwin
2.  安装 mysql 客户端应用程序

3.  在 .bashrc 文件中创建别名

    别名 mysql='mysql -h 127.0.0.1'

4.  执行源 .bashrc

现在你可以连接到mysql了

mysql -u 用户 -p

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-04-20T18:53:42.043

重新安装cygwin并在重新安装期间在包中搜索mysql，安装mysql客户端，然后它就可以正常工作了。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-03-18T22:30:00.667

今天发现这个问题 2018-03-18 寻找一些答案

```
ERROR 2002 (HY000): Can't connect to local MySQL server through socket '/var/run/mysql.sock' (2 "No such file or directory") 
```

该文件`/etc/my.conf`引用了`/etc/my.cnf.d` 我将其添加到的配置文件`/etc/my.cnf.d/client.cnf`：

```
[client]
host=127.0.0.1
protocol=tcp 
```

之后，我可以使用 cygwin 终端访问本地 Windows MySQL 实例`mysql -u root -p`

# c# - 是否可以手动从集合中删除 Silverlight 2.0 页面（垃圾收集）？

> ID：329870
> 
> 赞同：2
> 
> 时间：2008-12-01T02:30:37.567
> 
> 标签：c#, silverlight, memory, garbage-collection

我有多个基于 xaml 的页面存储为另一个页面上画布的子级。我在应用程序运行时添加和删除子页面。但是，从子集合中删除的页面仍在运行并响应键盘快捷键。如何强制完全删除旧页面？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-01T03:04:34.597

当您显示 XAML 页面时，您是否正在注册键盘事件？如果是这样，当您从屏幕上删除这些页面时，您是否忘记从键盘事件中注销？

由于 Silverlight 中的 UserControl 或 Page 类上没有类似“Unloading”的事件（至少我知道），我所做的是让我的页面实现一个我定义的接口，该接口包含一个单一的方法，如“Cleanup”或“关闭”。在从屏幕上删除控件之前，我调用控件上的 Cleanup() 并让它执行一些操作，例如从它可能已注册的事件中取消注册。

如果您不从事件中注销该页面的对象将永远不会被垃圾回收，因为 CLR 认为该对象仍然是活动的。

# c# - IEnumerator 到泛型。

> ID：329876
> 
> 赞同：0
> 
> 时间：2008-12-01T02:36:45.480
> 
> 标签：c#, generics, ienumerable

我有一些课程正在尝试使用泛型

第一类：曲线

这个类有以下代码：

```
public class Curve : IEnumerable

  IEnumerator IEnumerable.GetEnumerator()
    {
        return GetEnumerator(); // Calls non-interface method
    }

  public RTRatePointEnumerator GetEnumerator()
    {
        return new RTRatePointEnumerator(_hash);
    } 
```

第 2 类：

```
 public class CurvePointEnumerator : IEnumerator 
```

建议将这两个类转换为使用泛型的方法是什么

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T03:03:46.483

您没有指定从枚举器返回的类型。但我会根据它的名称来猜测它是 RTRatePoint 和 CurvePoint。我会将代码更改为以下

```
class Curve: IEnumerable<RTRatePoint> {
  IEnumerator<RTRatePoint> IEnumerable<RTRatePoint>.GetEnumerator() { 
    return GetEnumerator();
  }
  public RTRatePointEnumerator GetEnumerator() {
    return new RTRatePointEnumerator(_hash);
  }
}

class CurvePointEnumerator : IEnumerator<CurvePoint> 
```

可能会让您感到困惑的一项是 IEnumerator<T> 还实现了 IDisposable 因此 CurvePointEnumerator 和 RTRatePointEnumerator 将需要添加一个 Dispose 方法。尽管这种方法可能几乎是空的。原因是如果你以前没有处理任何东西，现在就没有必要了。

```
void IDispose.Dispose() {
  // Nothing to see here
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T02:45:47.147

`IEnumerable<T> and IEnumerator<T>`

啊，它吞噬了我的代码

# python - 在 Python 中，是否有一种简洁的方法来使用具有多个迭代器的列表推导？

> ID：329886
> 
> 赞同：10
> 
> 时间：2008-12-01T02:44:03.420
> 
> 标签：python, iterator, list-comprehension

基本上，我想在两个迭代器的“笛卡尔积”上建立一个列表理解。想想下面的[Haskell 代码](http://www.haskell.org/haskellwiki/List_comprehension)：

```
[(i,j) | i <- [1,2], j <- [1..4]] 
```

产生

```
[(1,1),(1,2),(1,3),(1,4),(2,1),(2,2),(2,3),(2,4)] 
```

我可以以简洁的方式在 Python 中获得类似的行为吗？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-01T02:58:14.950

你是在问这个吗？

```
[ (i,j) for i in range(1,3) for j in range(1,5) ] 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-01T03:40:28.347

笛卡尔积在[itertools 模块](http://docs.python.org/library/itertools.html#itertools.product)中（在 2.6 中）。

```
>>> import itertools
>>> list(itertools.product(range(1, 3), range(1, 5)))
[(1, 1), (1, 2), (1, 3), (1, 4), (2, 1), (2, 2), (2, 3), (2, 4)] 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-01T09:12:21.310

关于嵌套理解的有趣事实：它模仿嵌套的“for”循环，因此内部循环可以使用外部循环的值。这在笛卡尔积中没有用，但很高兴知道。例如：

```
[ (i,j) for i in range(10) for j in range(i) ] 
```

生成所有对`(i,j)`其中`0>=i>j>10`.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-01T03:03:33.660

这似乎符合您的描述：

[[a,b] 对于范围内的 a (1,3) 对于范围内的 b (1,5)]

更新：德拉特！应该在发布之前重新加载页面以查看 S.Lott 的答案。嗯……怎么做一点增值？也许是对 Python 交互模式有用性的简短证明。

我最近来自 Perl 的背景，所以对于这样的问题，我发现在命令行中键入“python”并进入交互模式非常有帮助，然后 a) 开始尝试，b) 通过点击来完善细节-箭头并调整我之前的尝试，直到我得到我想要的。每当我对某个关键字感到模糊时，帮助就在眼前。只需输入：help("some_keyword")，阅读简短摘要，然后点击“Q”，我就可以与 python 解释器直接对话。

如果您是初学者并且不使用它，建议您使用它。

# c# - MVC：关于数据访问等的视图和模型交互

> ID：329891
> 
> 赞同：7
> 
> 时间：2008-12-01T02:49:12.520
> 
> 标签：c#, model-view-controller

模型应该只是数据结构吗？服务（数据访问、业务逻辑）在 MVC 中位于何处？

假设我有一个显示客户订单列表的视图。我有一个控制器类来处理视图控件（按钮等）上的点击。

控制器应该启动数据访问代码吗？想按钮点击，重新加载订单查询。或者这应该通过模型层吗？

任何示例代码都会很棒！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-01T03:23:06.803

通常我实现MVC如下：

查看 - 从控制器接收数据并生成输出。通常这里应该只出现显示逻辑。例如，如果您想使用现有网站并制作它的移动/iPhone 版本，您应该能够通过替换视图来做到这一点（假设您想要相同的功能）。

模型 - 在模型中包装对数据的访问。在我的应用程序中，所有 SQL 都位于模型层中，视图或控制器中不允许直接数据访问。正如 Elie 在另一个答案中指出的那样，这里的想法是（至少部分地）将您的控制器/视图与数据库结构的变化隔离开来。模型也是实现逻辑的好地方，例如每当字段更改时更新“最后修改”日期。如果您的应用程序的主要数据源是外部 Web 服务，请考虑是否将其包装在模型类中。

控制器 - 用于将模型和视图粘合在一起。在此处实现应用程序逻辑、验证表单、将数据从模型传输到视图等。

例如，在我的应用程序中，当请求页面时，控制器将从模型中获取所需的任何数据，并将其传递给视图以生成用户看到的页面。如果该页面是表单，则可以提交表单，控制器处理验证，创建必要的模型并使用它来保存数据。

如果您遵循这种方法，模型最终会变得非常通用且可重用。您的控制器具有可管理的大小和复杂性，因为数据访问和显示已分别移至模型和视图，并且您的视图应该足够简单，设计人员（经过一些培训）可以理解它们。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-09T09:19:48.967

我不会将数据访问代码放在控制器中。

为了建立已经说过的内容，重要的是要考虑在层内分层。例如，您可能在模型本身中有多个层——一个执行任何 ORM 和数据库访问的数据访问层和一个代表业务对象的更抽象的层（不知道如何访问它们的数据）。

这将允许您更轻松地测试系统的组件，因为它支持模拟。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-01T03:20:44.813

我喜欢在域（模型）层中保留模型持久性或服务访问的“合同”或接口。我将数据访问或服务调用的实现放在另一层。

控制器通过将服务接口（例如 ISomeService）作为参数的构造函数进行实例化。控制器本身不知道服务层是如何实现的，但他们可以访问它们。然后我可以轻松地替换 SqlSomeService 或 InMemorySomeService。

我也对将域（模型）层存储库作为其构造函数的参数的具体服务实现非常满意。例如：ICatalogRepository 和 SqlServerCatalogRepositry ：ICatalogRepository 被交给 CatalogService（ICatalogRepository，ISomeOtherDependency）。

这种分离使用依赖注入框架更容易。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-01T02:56:56.170

View 会将在 UI 中单击时应该发生的事情传递给 Control 层，该层将包含所有业务逻辑，然后会调用 Model 层，该层只会进行数据库调用。只有模型层应该进行数据库调用，否则您将违背 MVC 设计模式的目的。

这样想吧。假设您更改了数据库。您可能希望限制所需的代码更改量，并将所有这些更改放在一起，而不影响应用程序的其他部分。因此，通过将所有数据访问保留在模型层中，即使是简单的调用，您也可以限制模型层所需的任何更改。如果您出于任何原因绕过模型层，您现在必须将所需的任何更改扩展到任何了解数据库的代码，这使得此类维护比应有的复杂。

# c++ - 如果 CFile::Write 抛出异常会发生什么？

> ID：329899
> 
> 赞同：1
> 
> 时间：2008-12-01T02:54:08.703
> 
> 标签：c++, exception, cfile

假设写操作中途抛出异常。文件中是否写入了任何数据，或者文件中没有写入数据？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-01T03:22:55.307

由于您不了解 CFile 的内部结构（或者不应该，如果它被正确封装），您需要依赖 API 的“合同”。换句话说，除非文档具体告诉您在某些情况下会发生什么，否则您不能依赖它。

即使您有源代码并且可以弄清楚，**API 规范**就是合同，任何未指定的内容都可能随时更改。这就是为什么一些软件开发人员对发布内部内容持谨慎态度的原因之一，因为这样可以看出他们将他们锁定为永远支持这一点。

如果您真的想确保您的文件在异常发生后处于已知状态，则需要围绕该行为编写代码。这可能是这样的：

*   在程序启动时备份文件（简单）；或者
*   在每次保存操作之前备份它（仍然相对简单）；或者
*   在任何写操作（复杂且缓慢）之前备份它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-01T03:11:40.010

简短的回答：很可能一些数据将被写入文件，除非磁盘在写入操作开始时已满。

更长的答案：这将取决于从 Write 调用中抛出的 CFileException 。

[http://msdn.microsoft.com/en-us/library/as5cs056(VS.80).aspx](http://msdn.microsoft.com/en-us/library/as5cs056(VS.80).aspx)

# css - CSS：固定布局还是浮动布局？

> ID：329900
> 
> 赞同：3
> 
> 时间：2008-12-01T02:54:24.367
> 
> 标签：css, presentation-layer

我的问题围绕着 CSS 固定布局与扩展以填充浏览器宽度的浮动布局。

现在我遇到的问题是根据页面的宽度调整标头广告的大小（鉴于当前浏览器的[CSS3 实现，我理解这是不可能的`background-image: size;`](http://www.w3.org/TR/2002/WD-css3-background-20020802/)）。在这一点上，我觉得我已经陷入了僵局：我是要重新设计网站以使用固定的 CSS 布局，还是保持当前布局并尝试使标头图像扩展以填充提供的大部分空间? 此外，转向固定宽度布局的利弊是什么，以及使用一种布局而不是另一种布局的其他（看不见的）后果？

有问题的网站将作为对此问题的评论给出——我不想被视为试图增加它的流量。

编辑：还有其他想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-02T11:01:04.943

当浏览器调整大小而不是缩放图像时，如何显示更多或更少的图像？这不是完全相同的效果，但它是一种用图像填充整个空间的简单方法。

让我们假设，为了示例，您的标头广告的背景图像包含某种标志，例如，城市天际线的照片。总体而言，这是 1600 像素宽。标志位于图像的左侧，而城市景观则延伸到最右侧。我们假设您的标记大致如下所示：

```
<div id="page">
  <div id="masthead">...</div>
  <div id="navigation">...</div>
  ...
</div> 
```

我们可以将#page 元素设置为[弹性](http://www.alistapart.com/articles/elastic)宽度并将背景图像应用到#masthead 元素：

```
#page {
  max-width: 1600px;
  min-width: 800px;
  width: 80%;
}

#masthead {
  background: url('path/to/image.jpg') no-repeat left top;
  height: 100px;
  width: auto;
} 
```

这里发生的情况是，#masthead 元素将扩展到 #page 元素的宽度，该宽度将介于 800px 和 1600px 之间（含），具体取决于浏览器窗口的宽度。当#page 元素为 800px 宽时，您只能看到天际线最左边的 800px；当它的宽度为 1600 像素时，您会看到整个天际线。这样，您的徽标始终可见，并且在调整浏览器大小时，会显示更多的城市景观。

这确实需要有一个更大的图像开始（至少与你的最大宽度一样宽，如果你使用弹性的话），但结果是一个无论大小都看起来不错的标头 - 而不依赖于，因为strager 提到，浏览器的图像大小调整算法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-02T10:17:21.680

它是什么样的形象？它的任何部分是可重复的吗？有时使用两层，一层或标签用于图像的重复元素，另一层用于固定元素。

我们可以看一个例子吗？为您的问题找到正确的答案会更容易。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-01T03:39:43.230

如果您尝试将背景图像扩展到页面的宽度，最好使用固定大小的布局，因为没有跨浏览器的方法可以使背景图像扩展到不同的大小，这取决于访客分辨率。

固定宽度布局为设计者提供了更大的灵活性，但对访问者却没有。如果您创建一个 X 像素宽的布局，那么您可以根据自己的喜好逐个像素地微调您的网站，而“浮动”布局（我称之为液体布局）完全基于百分比值，因此会有所不同从计算机到计算机。我觉得这很困难，因为您可以在屏幕上测试布局，但不知道它在其他人的屏幕上是如何显示的，而且（例如）20 像素的边距对 768 像素或 960 像素的固定宽度布局的影响比它在一个 1280 像素的液体电脑屏幕。

IMO 对固定宽度布局的主要缺点是它在大屏幕上看起来太小而在小屏幕上看起来太大。768px 曾经是一个相当标准的固定宽度布局，但现在它太小了，因为世界远离了 800x600。现在 960px 是相当标准的，对于 800x600 来说太大了，但在 1280x1024 上仍然太小了。

这完全取决于您的受众以及您的网站如何组合在一起。一些布局可以变成流动的并且工作得很好，而另一些则必须固定（就像你描述的那样）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-01T03:52:15.170

为什么不为您的标题图片（标头）使用**<img>**标签，而不是使用背景图片？

我建议不要缩放标题图形；大多数浏览器在图像缩放方面都很糟糕（最近的邻居是什么？）而且对很多人来说看起来并不好。

我自己喜欢流体/浮动/液体布局。事实上，我的大多数网站都使用单列，所以我不必担心“正常”网站布局所具有的所有复杂性。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-02T18:03:45.310

创建一个文本列扩展到浏览器的布局通常是一个坏主意。如果线条变长，文本会变得难以阅读。我建议为 text-column 设置一个固定的 with，大概 50 个字母宽。

# macos - 在 Mac OS X 上运行 ocaml 会出现总线错误

> ID：329911
> 
> 赞同：0
> 
> 时间：2008-12-01T03:02:11.747
> 
> 标签：macos, installation, ocaml

我刚刚在 Mac OS X 上安装了 Ocaml，当我运行 ocaml 程序时，我得到一个“总线错误”，没有其他线索可以知道发生了什么。任何人都可以就从这里去哪里提供建议吗？

编辑：

我通过包安装：

[http://caml.inria.fr/pub/distrib/ocaml-3.10/ocaml-3.10.2-ppc.dmg](http://caml.inria.fr/pub/distrib/ocaml-3.10/ocaml-3.10.2-ppc.dmg)

（我有 iBook G4，所以 PPC 比较合适）

要运行 ocaml，我只需输入：

```
ocaml 
```

在终端窗口中

我也试过

```
/usr/local/bin/ocaml 
```

并从 xterm 窗口运行。这三个都给出：

```
Bus Error 
```

我按照自述文件的要求安装了 Xcode 和 X11。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-01T05:19:27.287

原来我正在运行 10.4.x (Tiger) 的机器上安装为 Mac OS X 10.5.x (Leopard) 构建的 OCaml 版本。有人会认为安装程序很容易抓住这一点，但是唉……

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T03:04:05.547

你是从macports安装的吗？它对我来说很好。你能描述一些关于你的安装的更多细节吗？也许你正在做什么来得到错误？

# c# - 如何使用 C# 将 CSV 数据粘贴到 Windows 剪贴板

> ID：329918
> 
> 赞同：34
> 
> 时间：2008-12-01T03:05:40.130
> 
> 标签：c#, windows, csv, clipboard, paste

## 我想要完成的事情

*   我的应用程序生成一些表格数据
*   我希望用户能够启动 Excel 并单击“粘贴”以将数据作为单元格放置在 Excel 中
*   Windows 接受一种名为“CommaSeparatedValue”的格式，它与它的 API 一起使用，所以这似乎是可能的
*   将原始文本放在剪贴板上是可行的，但尝试使用这种格式却不行
*   注意：我可以正确地从剪贴板检索 CSV 数据，我的问题是将 CSV 数据粘贴到剪贴板。

## 我尝试过的不起作用

剪贴板.SetText()

```
System.Windows.Forms.Clipboard.SetText(  
  "1,2,3,4\n5,6,7,8", 
  System.Windows.Forms.TextDataFormat.CommaSeparatedValue
  ); 
```

剪贴板.SetData()

```
System.Windows.Forms.Clipboard.SetData(
  System.Windows.Forms.DataFormats.CommaSeparatedValue,
  "1,2,3,4\n5,6,7,8", 
  ); 
```

在这两种情况下，剪贴板上都有一些东西，但是当粘贴到 Excel 中时，它会显示为一个垃圾文本单元格：“–§žý;pC¦yVk²ˆû”

## 更新 1：使用 SetText() 的解决方法

正如 BFree 的回答所示，使用**TextDataFormat的****SetText**作为一种解决方法

 **```
System.Windows.Forms.Clipboard.SetText(  
  "1\t2\t3\t4\n5\t6\t7\t8", 
  System.Windows.Forms.TextDataFormat.Text
  ); 
```

我已经尝试过了，并确认现在粘贴到 Excel 和 Word 中可以正常工作。在每种情况下，它都粘贴为带有单元格而不是纯文本的表格。

仍然好奇为什么 CommaSeparatedValue*不起作用*。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-12-15T18:09:17.150

.NET Framework`DataFormats.CommaSeparatedValue`作为 Unicode 文本放置在剪贴板上。但正如[http://www.syncfusion.com/faq/windowsforms/faq_c98c.aspx#q899q](http://www.syncfusion.com/faq/windowsforms/faq_c98c.aspx#q899q)所述，Excel 期望 CSV 数据是 UTF-8 内存流（很难说是 .NET 还是 Excel 有问题因为不兼容）。

我在自己的应用程序中提出的解决方案是将两个版本的表格数据同时作为制表符分隔的文本和 CSV 内存流放在剪贴板上。这允许目标应用程序以它的首选格式获取数据。记事本和 Excel 更喜欢制表符分隔的文本，但您可以强制 Excel 通过选择性粘贴...命令获取 CSV 数据以进行测试。

这是一些示例代码（请注意，此处使用了 WPF 命名空间中的 WinForms 等效项）：

```
// Generate both tab-delimited and CSV strings.
string tabbedText = //...
string csvText = //...

// Create the container object that will hold both versions of the data.
var dataObject = new System.Windows.DataObject();

// Add tab-delimited text to the container object as is.
dataObject.SetText(tabbedText);

// Convert the CSV text to a UTF-8 byte stream before adding it to the container object.
var bytes = System.Text.Encoding.UTF8.GetBytes(csvText);
var stream = new System.IO.MemoryStream(bytes);
dataObject.SetData(System.Windows.DataFormats.CommaSeparatedValue, stream);

// Copy the container object to the clipboard.
System.Windows.Clipboard.SetDataObject(dataObject, true); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-01T03:35:33.940

使用制表符代替逗号。IE：

```
Clipboard.SetText("1\t2\t3\t4\t3\t2\t3\t4", TextDataFormat.Text); 
```

刚刚自己测试了这个，它对我有用。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-01T03:56:13.213

我已经成功地使用 \t （参见 BFree 的答案）作为列分隔符和 \n 作为行分隔符粘贴到 Excel 中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-07-27T00:25:54.097

通过使用 CSV 库 ( [KBCsv](https://github.com/kentcb/KBCsv) ) 将数据写入临时文件夹中的 CSV 文件，然后在 Excel 中使用`Process.Start()`. 一旦它在 Excel 中，格式化位很容易（呃），从那里复制粘贴。

```
string filePath = System.IO.Path.GetTempPath() + Guid.NewGuid().ToString() + ".csv";

using (var streamWriter = new StreamWriter(filePath))
using (CsvWriter csvWriter = new CsvWriter(streamWriter))
{
    // optional header
    csvWriter.WriteRecord(new List<string>(){"Heading1", "Heading2", "YouGetTheIdea" });

    csvWriter.ValueSeparator = ',';
    foreach (var thing in YourListOfThings ?? new List<OfThings>())
    {
        if (thing != null)
        {
            List<string> csvLine = new List<string>
                                         {
                                             thing.Property1, thing.Property2, thing.YouGetTheIdea
                                         };

            csvWriter.WriteRecord(csvLine);
        }
    }
}

Process.Start(filePath); 
```

BYO 错误处理和记录。

# c++ - 从 UUID 中提取 MAC 地址

> ID：329925
> 
> 赞同：4
> 
> 时间：2008-12-01T03:13:51.940
> 
> 标签：c++, windows, uuid

我处理的一个程序假定由 Windows RPC API 调用 UuidCreateSequential() 生成的 UUID 包含主以太网适配器的 MAC 地址。这个假设是正确的还是我应该使用不同的方法来获取 MAC 地址？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-01T03:17:54.427

我不会依赖这个 - UuidCreateSequential 具有 MAC 地址的唯一原因是它试图保证 UUID 在整个网络中是唯一的。另外，为什么要使用这种奇怪的方式来获取 MAC 地址？使用 WMI 并*实际*询问 MAC 地址，而不是 UUID 创建函数的副作用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-01T03:16:29.720

这似乎是一个有效的假设。[MSDN](http://msdn.microsoft.com/en-us/library/aa379322.aspx)上的文档特别说明这将包含机器上以太网卡的地址。它没有提及多卡场景，但选择主卡似乎是一个合乎逻辑的飞跃。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-01T03:40:30.357

如果您正在编写托管代码，我会使用[`NetworkInterface`](http://msdn.microsoft.com/en-us/library/system.net.networkinformation.networkinterface.aspx)该类并调用`GetAllNetworkInterfaces()`. 或者来自 C++ 代码， call [`GetAdaptersInfo`](http://msdn.microsoft.com/en-us/library/aa365917(VS.85).aspx)，这是托管实现使用的。

即使`UuidCreateSequential`确实适用于此，它也是一种获取信息的非常晦涩的方式，并且隐藏了潜在问题，例如具有多个适配器的计算机。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-24T17:04:50.613

只有版本 1 UUID 包含 MAC 地址，并且只有在原始生成器可以访问 MAC 地址的情况下才能开始。如果原始生成器无法访问 MAC 地址，它将使用来自加密安全随机数生成器的 6 个随机字节，根据 RFC 4122 的第 4.5 节。因此，无法保证 MAC 地址UUID 中给出的实际上是一个 MAC 地址。

在大多数情况下，任何人都需要从 UUID 中解析出 MAC 地址的唯一原因是出于取证目的。例如，查看 Melissa 病毒的 Word 文档有效负载中嵌入的 UUID。调查人员从这些 ID 中提取了 MAC 地址，并将其与嫌疑人主网络适配器的 MAC 地址相匹配。

如果您尝试获取自己计算机的 MAC 地址，则有更好的方法来解决此问题。

# javascript - To Ajaxify Or Not?

> ID：329929
> 
> 赞同：4
> 
> 时间：2008-12-01T03:15:45.167
> 
> 标签：javascript, ajax, asynchronous, scaling

I really love the way Ajax makes a web app perform more like a desktop app, but I'm worried about the hits on a high volume site. I'm developing a database app right now that's intranet based, that no more then 2-4 people are going to be accessing at one time. I'm Ajaxing the hell out of it, but it got me to wondering, how much Ajax is too much?

At what point does the volume of hits, outweigh the benefits seen by using Ajax? It doesn't really seem like it would, versus a whole page refresh, since you are, in theory, only updating the parts that need updating.

I'm curious if any of you have used Ajax on high volume sites and in what capacity did you use it? Does it create scaling issues?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-01T03:46:18.957

On my current project, we do use Ajax and we have had scaling problems. Since my current project is a J2EE site that does timekeeping for the employees of a large urban city, we've found that it's best if the browser side can cache data that won't change for the duration of a user session. Fortunately we're moving to a model where we have a single admin process the timekeeping for as many employees as possible. This would be akin to how an ERP application might work (or an email application). Consequently our business need is that the browser-side can hold a lot of data, but we don't expect the volume of hits to be a serious problem. So we've kept an XML data island on the browser-side. In addition, we load data only on an as-needed basis.

I highly recommend the book *Ajax Design Patterns* or their [site](http://ajaxpatterns.org/).

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-01T03:46:55.947

Ajax should help your bandwidth on a high volume site if that is your concern as you are, like you said, only updating the parts that need updating. My problem with Ajax is that your site can be rendered useless if the visitors do not have javascript enabled, and most of the time I do not feel like coding the site again for non-javascript users.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-01T10:30:53.757

Look at it this way: AJAX must not be the *only* option because of the possibility of !script, it must exist as a layer on top of an existing architecture to provide a superior experience in some regards. Given that, it is impossible for AJAX to create *more* requests or more work than simple HTML because it is handling the exact same data transfer.

Where it can save you bandwidth and server load is because AJAX provides you the ability to transfer *only* the data. You can save on redundant HTML, image, css, etc requests with every page refresh whilst providing a snappier user experience.

As **mike nvck** points out the technique of polling is a big exception to this rule, but that's about the technique not the tech: you would have the same kind of impact if you had a simple page poll.

Understand the tool and use it for what it was designed. If AJAX implementation is reducing performance, you've done something wrong.

(fwiw, my experience of profiling AJAX vs simple HTML tends to result in ~60% bandwidth, ~80-90% performance benefits)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-01T09:41:11.177

The most common scaling issue of ajax apps is when they are to set up to check back with the server to see if the content got updated in the meantime without the need for user actively requesting it. 5 clients checking every 10 seconds is not 5000 clients checking every 10 sec.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-01T10:03:06.577

Ajax on one side reduces the server workload because it usually shows or refreshes just part of the page, while on the other side it increases number of hits to the server. I would say that all then depends of the architecture of your web application. If your application needs a lot of processing for every hit (like database access) regardless of size of the response, then Ajax will hit you a lot.

# sql - SQL select join：是否可以为所有列添加前缀“prefix.*”？

> ID：329931
> 
> 赞同：269
> 
> 时间：2008-12-01T03:15:58.347
> 
> 标签：sql, join

我想知道这在 SQL 中是否可行。假设您有两个表 A 和 B，并且您在表 A 上进行选择并在表 B 上连接：

```
SELECT a.*, b.* FROM TABLE_A a JOIN TABLE_B b USING (some_id); 
```

如果表 A 有列 'a_id'、'name' 和 'some_id'，而表 B 有 'b_id'、'name' 和 'some_id'，则查询将返回列 'a_id'、'name'、'some_id '、'b_id'、'name'、'some_id'。有没有办法在不单独列出每一列的情况下为表 B 的列名添加前缀？相当于：

```
SELECT a.*, b.b_id as 'b.b_id', b.name as 'b.name', b.some_id as 'b.some_id'
FROM TABLE_A a JOIN TABLE_B b USING (some_id); 
```

但是，如前所述，没有列出每一列，所以类似于：

```
SELECT a.*, b.* as 'b.*'
FROM TABLE_A a JOIN TABLE_B b USING (some_id); 
```

基本上要说的是，“在 b.* 返回的每一列前面加上 'something'”。这是可能的还是我不走运？

### 编辑

关于不使用`SELECT *`等的建议是有效的建议，但与我的上下文无关，所以请坚持手头的问题——是否可以为 a 的所有列名添加前缀（在 SQL 查询中指定的常量）表中的连接？

我的最终目标是能够通过`SELECT *`连接对两个表执行 a 操作，并且能够从我在结果集中获得的列的名称中分辨出哪些列来自表 A，哪些列来自表 B。同样，我不想单独列出列，我需要能够执行`SELECT *`.

* * *

## 回答 #1

> 赞同：111
> 
> 时间：2012-03-29T13:16:43.963

您的问题的答案似乎是否定的，但是您可以使用的一种技巧是分配一个虚拟列来分隔每个新表。如果您正在循环使用脚本语言（如 Python 或 PHP）中的列列表的结果集，这尤其适用。

```
SELECT '' as table1_dummy, table1.*, '' as table2_dummy, table2.*, '' as table3_dummy, table3.* FROM table1
JOIN table2 ON table2.table1id = table1.id
JOIN table3 ON table3.table1id = table1.id 
```

我意识到这并不能准确回答您的问题，但如果您是编码人员，这是分隔具有重复列名的表的好方法。希望这可以帮助某人。

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2008-12-01T03:42:24.863

我在这里看到两种可能的情况。首先，您想知道是否有针对此的 SQL 标准，无论数据库如何，您都可以使用该标准。不，那里没有。其次，您想了解特定的 dbms 产品。然后你需要识别它。但我想最有可能的答案是你会得到类似“a.id, b.id”的东西，因为这就是你需要识别 SQL 表达式中的列的方式。找出默认值的最简单方法就是提交这样的查询，看看你会得到什么。如果要指定点之前的前缀，例如，可以使用“SELECT * FROM a AS my_alias”。

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2012-01-19T16:17:05.823

我完全理解为什么这是必要的 - 至少对我来说，当有很多表需要连接时，它在快速原型制作过程中很方便，包括许多内部连接。一旦第二个“joinedtable.*”字段通配符中的列名相同，主表的字段值就会被joinedtable值覆盖。当不得不一遍又一遍地手动指定具有别名的表字段时，容易出错、令人沮丧并且违反 DRY...

这是一个通过代码生成实现此目的的 PHP (Wordpress) 函数以及如何使用它的示例。在示例中，它用于快速生成自定义查询，该查询将提供通过*高级自定义字段*字段引用的相关 wordpress 帖子的字段。

```
function prefixed_table_fields_wildcard($table, $alias)
{
    global $wpdb;
    $columns = $wpdb->get_results("SHOW COLUMNS FROM $table", ARRAY_A);

    $field_names = array();
    foreach ($columns as $column)
    {
        $field_names[] = $column["Field"];
    }
    $prefixed = array();
    foreach ($field_names as $field_name)
    {
        $prefixed[] = "`{$alias}`.`{$field_name}` AS `{$alias}.{$field_name}`";
    }

    return implode(", ", $prefixed);
}

function test_prefixed_table_fields_wildcard()
{
    global $wpdb;

    $query = "
    SELECT
        " . prefixed_table_fields_wildcard($wpdb->posts, 'campaigns') . ",
        " . prefixed_table_fields_wildcard($wpdb->posts, 'venues') . "
        FROM $wpdb->posts AS campaigns
    LEFT JOIN $wpdb->postmeta meta1 ON (meta1.meta_key = 'venue' AND campaigns.ID = meta1.post_id)
    LEFT JOIN $wpdb->posts venues ON (venues.post_status = 'publish' AND venues.post_type = 'venue' AND venues.ID = meta1.meta_value)
    WHERE 1
    AND campaigns.post_status = 'publish'
    AND campaigns.post_type = 'campaign'
    LIMIT 1
    ";

    echo "<pre>$query</pre>";

    $posts = $wpdb->get_results($query, OBJECT);

    echo "<pre>";
    print_r($posts);
    echo "</pre>";
} 
```

输出：

```
SELECT
    `campaigns`.`ID` AS `campaigns.ID`, `campaigns`.`post_author` AS `campaigns.post_author`, `campaigns`.`post_date` AS `campaigns.post_date`, `campaigns`.`post_date_gmt` AS `campaigns.post_date_gmt`, `campaigns`.`post_content` AS `campaigns.post_content`, `campaigns`.`post_title` AS `campaigns.post_title`, `campaigns`.`post_excerpt` AS `campaigns.post_excerpt`, `campaigns`.`post_status` AS `campaigns.post_status`, `campaigns`.`comment_status` AS `campaigns.comment_status`, `campaigns`.`ping_status` AS `campaigns.ping_status`, `campaigns`.`post_password` AS `campaigns.post_password`, `campaigns`.`post_name` AS `campaigns.post_name`, `campaigns`.`to_ping` AS `campaigns.to_ping`, `campaigns`.`pinged` AS `campaigns.pinged`, `campaigns`.`post_modified` AS `campaigns.post_modified`, `campaigns`.`post_modified_gmt` AS `campaigns.post_modified_gmt`, `campaigns`.`post_content_filtered` AS `campaigns.post_content_filtered`, `campaigns`.`post_parent` AS `campaigns.post_parent`, `campaigns`.`guid` AS `campaigns.guid`, `campaigns`.`menu_order` AS `campaigns.menu_order`, `campaigns`.`post_type` AS `campaigns.post_type`, `campaigns`.`post_mime_type` AS `campaigns.post_mime_type`, `campaigns`.`comment_count` AS `campaigns.comment_count`,
    `venues`.`ID` AS `venues.ID`, `venues`.`post_author` AS `venues.post_author`, `venues`.`post_date` AS `venues.post_date`, `venues`.`post_date_gmt` AS `venues.post_date_gmt`, `venues`.`post_content` AS `venues.post_content`, `venues`.`post_title` AS `venues.post_title`, `venues`.`post_excerpt` AS `venues.post_excerpt`, `venues`.`post_status` AS `venues.post_status`, `venues`.`comment_status` AS `venues.comment_status`, `venues`.`ping_status` AS `venues.ping_status`, `venues`.`post_password` AS `venues.post_password`, `venues`.`post_name` AS `venues.post_name`, `venues`.`to_ping` AS `venues.to_ping`, `venues`.`pinged` AS `venues.pinged`, `venues`.`post_modified` AS `venues.post_modified`, `venues`.`post_modified_gmt` AS `venues.post_modified_gmt`, `venues`.`post_content_filtered` AS `venues.post_content_filtered`, `venues`.`post_parent` AS `venues.post_parent`, `venues`.`guid` AS `venues.guid`, `venues`.`menu_order` AS `venues.menu_order`, `venues`.`post_type` AS `venues.post_type`, `venues`.`post_mime_type` AS `venues.post_mime_type`, `venues`.`comment_count` AS `venues.comment_count`
    FROM wp_posts AS campaigns
LEFT JOIN wp_postmeta meta1 ON (meta1.meta_key = 'venue' AND campaigns.ID = meta1.post_id)
LEFT JOIN wp_posts venues ON (venues.post_status = 'publish' AND venues.post_type = 'venue' AND venues.ID = meta1.meta_value)
WHERE 1
AND campaigns.post_status = 'publish'
AND campaigns.post_type = 'campaign'
LIMIT 1

Array
(
    [0] => stdClass Object
        (
            [campaigns.ID] => 33
            [campaigns.post_author] => 2
            [campaigns.post_date] => 2012-01-16 19:19:10
            [campaigns.post_date_gmt] => 2012-01-16 19:19:10
            [campaigns.post_content] => Lorem ipsum
            [campaigns.post_title] => Lorem ipsum
            [campaigns.post_excerpt] => 
            [campaigns.post_status] => publish
            [campaigns.comment_status] => closed
            [campaigns.ping_status] => closed
            [campaigns.post_password] => 
            [campaigns.post_name] => lorem-ipsum
            [campaigns.to_ping] => 
            [campaigns.pinged] => 
            [campaigns.post_modified] => 2012-01-16 21:01:55
            [campaigns.post_modified_gmt] => 2012-01-16 21:01:55
            [campaigns.post_content_filtered] => 
            [campaigns.post_parent] => 0
            [campaigns.guid] => http://example.com/?p=33
            [campaigns.menu_order] => 0
            [campaigns.post_type] => campaign
            [campaigns.post_mime_type] => 
            [campaigns.comment_count] => 0
            [venues.ID] => 84
            [venues.post_author] => 2
            [venues.post_date] => 2012-01-16 20:12:05
            [venues.post_date_gmt] => 2012-01-16 20:12:05
            [venues.post_content] => Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
            [venues.post_title] => Lorem ipsum venue
            [venues.post_excerpt] => 
            [venues.post_status] => publish
            [venues.comment_status] => closed
            [venues.ping_status] => closed
            [venues.post_password] => 
            [venues.post_name] => lorem-ipsum-venue
            [venues.to_ping] => 
            [venues.pinged] => 
            [venues.post_modified] => 2012-01-16 20:53:37
            [venues.post_modified_gmt] => 2012-01-16 20:53:37
            [venues.post_content_filtered] => 
            [venues.post_parent] => 0
            [venues.guid] => http://example.com/?p=84
            [venues.menu_order] => 0
            [venues.post_type] => venue
            [venues.post_mime_type] => 
            [venues.comment_count] => 0
        )
) 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2008-12-01T03:39:56.270

我知道这样做的唯一数据库是 SQLite，具体取决于您使用`PRAGMA full_column_names`和配置的设置`PRAGMA short_column_names`。见[http://www.sqlite.org/pragma.html](http://www.sqlite.org/pragma.html)

否则，如果在查询中键入列名太麻烦的话，我只能建议按序号位置而不是按列名获取结果集中的列。

这是一个很好的例子，说明了为什么[使用它是不好的做法`SELECT *`](https://stackoverflow.com/questions/262450/why-is-using-to-build-a-view-bad#262509)——因为最终你还是需要输入所有的列名。

我了解支持可能更改名称或位置的列的需要，但使用通配符会使这*更难*，而不是更容易。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2014-10-22T03:43:16.680

这个问题在实践中非常有用。只需要列出软件编程中的每一个显式列，您需要特别小心地处理所有条件。

想象一下，在调试时，或者，尝试使用 DBMS 作为日常办公工具，而不是特定程序员抽象底层基础设施的可更改实现，我们需要编写大量 SQL。这种场景随处可见，如数据库转换、迁移、管理等。这些 SQL 中的大多数只会执行一次，永远不会再次使用，给每一列命名只是浪费时间。并且不要忘记 SQL 的发明不仅是供程序员使用的。

通常我会创建一个以列名为前缀的实用程序视图，这是 pl/pgsql 中的函数，这并不容易，但您可以将其转换为其他过程语言。

```
-- Create alias-view for specific table.

create or replace function mkaview(schema varchar, tab varchar, prefix varchar)
    returns table(orig varchar, alias varchar) as $$
declare
    qtab varchar;
    qview varchar;
    qcol varchar;
    qacol varchar;
    v record;
    sql varchar;
    len int;
begin
    qtab := '"' || schema || '"."' || tab || '"';
    qview := '"' || schema || '"."av' || prefix || tab || '"';
    sql := 'create view ' || qview || ' as select';

    for v in select * from information_schema.columns
            where table_schema = schema and table_name = tab
    loop
        qcol := '"' || v.column_name || '"';
        qacol := '"' || prefix || v.column_name || '"';

        sql := sql || ' ' || qcol || ' as ' || qacol;
        sql := sql || ', ';

        return query select qcol::varchar, qacol::varchar;
    end loop;

    len := length(sql);
    sql := left(sql, len - 2); -- trim the trailing ', '.
    sql := sql || ' from ' || qtab;

    raise info 'Execute SQL: %', sql;
    execute sql;
end
$$ language plpgsql; 
```

例子：

```
-- This will create a view "avp_person" with "p_" prefix to all column names.
select * from mkaview('public', 'person', 'p_');

select * from avp_person; 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-12-02T14:06:34.710

我与 OP 处于同一条船上 - 我有来自我要加入的 3 个不同表的数十个字段，其中一些具有相同的名称（即 id、名称等）。我不想列出每个字段，因此我的解决方案是为共享名称的字段设置别名，并为具有唯一名称的字段使用 select *。

例如 ：

表 a : id, name, field1, field2 ...

表 b : id, name, field3, field4 ...

选择 a.id 作为 aID，a.name 作为 aName，a. * , b.id 作为 bID, b.name 作为 bName, b. * ......

访问结果时，我使用这些字段的别名并忽略“原始”名称。

也许不是最好的解决方案，但它适用于我....我使用 mysql

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2020-01-20T18:26:28.983

在 postgres 中，我使用 json 函数来返回 json 对象......然后，在查询之后，我使用 _json 后缀对字段进行 json_decode。

IE：

```
select row_to_json(tab1.*),tab1_json, row_to_json(tab2.*) tab2_json 
 from tab1
 join tab2 on tab2.t1id=tab1.id 
```

然后在 PHP（或任何其他语言）中，如果它们具有“_json”后缀（也删除后缀），我会遍历返回的列和 json_decode() 它们。最后，我得到一个名为“tab1”的对象，其中包括所有tab1 字段，另一个称为“tab2”，包括所有 tab2 字段。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-12-01T03:19:07.780

不同的数据库产品会给你不同的答案；但是如果你把这件事走得太远，你就会让自己受到伤害。你最好选择你想要的列，并给它们你自己的别名，这样每列的标识就很清楚了，你可以在结果中区分它们。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2013-03-22T05:34:42.137

我完全理解您关于重复字段名称的问题。

在我编写自己的函数来解决它之前，我也需要它。如果您使用的是 PHP，则可以使用它，或者如果您有以下设施，则可以使用您正在使用的语言编写您的代码。

这里的技巧是`mysql_field_table()`返回表名和`mysql_field_name()`结果中每一行的字段（如果有的话），`mysql_num_fields()`这样您就可以将它们混合在一个新数组中。

这为所有列添加前缀；）

问候，

```
function mysql_rows_with_columns($query) {
    $result = mysql_query($query);
    if (!$result) return false; // mysql_error() could be used outside
    $fields = mysql_num_fields($result);
    $rows = array();
    while ($row = mysql_fetch_row($result)) { 
        $newRow = array();
        for ($i=0; $i<$fields; $i++) {
            $table = mysql_field_table($result, $i);
            $name = mysql_field_name($result, $i);
            $newRow[$table . "." . $name] = $row[$i];
        }
        $rows[] = $newRow;
    }
    mysql_free_result($result);
    return $rows;
} 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-12-01T04:58:11.933

对此没有 SQL 标准。

然而，通过代码生成（在创建或更改表时按需或在运行时），您可以很容易地做到这一点：

```
CREATE TABLE [dbo].[stackoverflow_329931_a](
    [id] [int] IDENTITY(1,1) NOT NULL,
    [col2] [nchar](10) NULL,
    [col3] [nchar](10) NULL,
    [col4] [nchar](10) NULL,
 CONSTRAINT [PK_stackoverflow_329931_a] PRIMARY KEY CLUSTERED 
(
    [id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]

CREATE TABLE [dbo].[stackoverflow_329931_b](
    [id] [int] IDENTITY(1,1) NOT NULL,
    [col2] [nchar](10) NULL,
    [col3] [nchar](10) NULL,
    [col4] [nchar](10) NULL,
 CONSTRAINT [PK_stackoverflow_329931_b] PRIMARY KEY CLUSTERED 
(
    [id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]

DECLARE @table1_name AS varchar(255)
DECLARE @table1_prefix AS varchar(255)
DECLARE @table2_name AS varchar(255)
DECLARE @table2_prefix AS varchar(255)
DECLARE @join_condition AS varchar(255)
SET @table1_name = 'stackoverflow_329931_a'
SET @table1_prefix = 'a_'
SET @table2_name = 'stackoverflow_329931_b'
SET @table2_prefix = 'b_'
SET @join_condition = 'a.[id] = b.[id]'

DECLARE @CRLF AS varchar(2)
SET @CRLF = CHAR(13) + CHAR(10)

DECLARE @a_columnlist AS varchar(MAX)
DECLARE @b_columnlist AS varchar(MAX)
DECLARE @sql AS varchar(MAX)

SELECT @a_columnlist = COALESCE(@a_columnlist + @CRLF + ',', '') + 'a.[' + COLUMN_NAME + '] AS [' + @table1_prefix + COLUMN_NAME + ']'
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_NAME = @table1_name
ORDER BY ORDINAL_POSITION

SELECT @b_columnlist = COALESCE(@b_columnlist + @CRLF + ',', '') + 'b.[' + COLUMN_NAME + '] AS [' + @table2_prefix + COLUMN_NAME + ']'
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_NAME = @table2_name
ORDER BY ORDINAL_POSITION

SET @sql = 'SELECT ' + @a_columnlist + '
,' + @b_columnlist + '
FROM [' + @table1_name + '] AS a
INNER JOIN [' + @table2_name + '] AS b
ON (' + @join_condition + ')'

PRINT @sql
-- EXEC (@sql) 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-12-02T14:44:50.313

或者您可以使用 Red Gate SQL Refactor 或 SQL Prompt，通过单击 Tab 按钮将您的 SELECT * 扩展为列列表

所以在你的情况下，如果你输入 SELECT * FROM A JOIN B ...转到 * 的末尾，Tab 按钮，瞧！你会看到 SELECT A.column1, A.column2, .... , B.column1, B.column2 FROM A JOIN B

虽然它不是免费的

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2017-09-15T13:36:17.610

我通过重命名所涉及的表中的字段解决了我的类似问题。是的，我有幸这样做，并且了解每个人可能都没有这样做。我为代表表名的表中的每个字段添加了前缀。因此，OP 发布的 SQL 将保持不变 -

```
SELECT a.*, b.* FROM TABLE_A a JOIN TABLE_B b USING (some_id); 
```

并且仍然给出预期的结果 - 易于识别输出字段属于哪个表。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2018-03-21T04:42:42.643

最近在 NodeJS 和 Postgres 中遇到了这个问题。

**ES6 方法**

我所知道的没有任何 RDBMS 功能提供此功能，因此我创建了一个包含我所有字段的对象，例如：

```
const schema = { columns: ['id','another_column','yet_another_column'] } 
```

定义了一个 reducer 来连接字符串和一个表名：

```
const prefix = (table, columns) => columns.reduce((previous, column) => {
  previous.push(table + '.' + column + ' AS ' + table + '_' + column);
  return previous;
}, []); 
```

这将返回一个字符串数组。为每个表调用它并组合结果：

```
const columns_joined = [...prefix('tab1',schema.columns), ...prefix('tab2',schema.columns)]; 
```

输出最终的 SQL 语句：

```
console.log('SELECT ' + columns_joined.join(',') + ' FROM tab1, tab2 WHERE tab1.id = tab2.id'); 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-12-01T03:24:31.420

select * 通常会产生糟糕的代码，因为往往会添加新列或表中的列顺序经常更改，这通常会以非常微妙的方式破坏 select *。所以列出列是正确的解决方案。

至于如何进行查询，不确定 mysql 但在 sqlserver 中，您可以从 syscolumns 中选择列名并动态构建 select 子句。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-12-01T04:13:01.463

有两种方法可以让我以可重用的方式实现这一点。一种是使用它们来自的表的前缀重命名所有列。我已经看过很多次了，但我真的不喜欢它。我发现它是多余的，会导致大量输入，并且当您需要涵盖来源不明的列名的情况时，您始终可以使用别名。

另一种方法，如果你致力于看到这一点，我会建议你在你的情况下这样做，是为每个表创建别名表名的视图。然后你加入这些视图，而不是表。这样，如果您愿意，您可以自由使用 *，如果您愿意，可以自由使用具有原始列名的原始表，并且它还使编写任何后续查询更容易，因为您已经在视图中完成了重命名工作。

最后，我不清楚为什么您需要知道每列来自哪个表。这有关系吗？最终重要的是它们包含的数据。UserID 是来自 User 表还是来自 UserQuestion 表并不重要。当然，当您需要更新它时，这很重要，但此时您应该已经足够了解您的模式以确定这一点。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-07-08T06:38:30.567

如果担心架构更改，这可能对您有用： 1\. 对所有涉及的表运行“DESCRIBE table”查询。2\. 使用返回的字段名称来动态构造以您选择的别名为前缀的列名字符串。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2010-04-07T22:33:49.040

对于那些使用 MySQL C-API 的人来说，您的问题有一个直接的答案。

给定 SQL：

```
 SELECT a.*, b.*, c.* FROM table_a a JOIN table_b b USING (x) JOIN table_c c USING (y) 
```

'mysql_stmt_result_metadata()' 的结果将您准备好的 SQL 查询中的字段定义提供给结构 MYSQL_FIELD[]。每个字段包含以下数据：

```
 char *name;                 /* Name of column (may be the alias) */
  char *org_name;             /* Original column name, if an alias */
  char *table;                /* Table of column if column was a field */
  char *org_table;            /* Org table name, if table was an alias */
  char *db;                   /* Database for table */
  char *catalog;              /* Catalog for table */
  char *def;                  /* Default value (set by mysql_list_fields) */
  unsigned long length;       /* Width of column (create length) */
  unsigned long max_length;   /* Max width for selected set */
  unsigned int name_length;
  unsigned int org_name_length;
  unsigned int table_length;
  unsigned int org_table_length;
  unsigned int db_length;
  unsigned int catalog_length;
  unsigned int def_length;
  unsigned int flags;         /* Div flags */
  unsigned int decimals;      /* Number of decimals in field */
  unsigned int charsetnr;     /* Character set */
  enum enum_field_types type; /* Type of field. See mysql_com.h for types */ 
```

注意字段：目录，表，org_name

您现在知道 SQL 中的哪些字段属于哪个模式（也称为目录）和表。这足以从多表 sql 查询中通用地识别每个字段，而不必为任何内容设置别名。

一个实际的产品 SqlYOG 被展示为在这样的庄园中使用这个确切的数据，当 PK 字段存在时，它们能够独立地更新多表连接的每个表。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2011-12-14T05:45:54.093

没有别名就无法做到这一点，仅仅是因为，如果该字段存在于您要加入的 2 个或 3 个表中，您将如何引用 where 子句中的字段？mysql 不清楚您要引用哪一个。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2015-09-09T17:02:10.020

从[这个解决方案](https://stackoverflow.com/questions/32481055/alternatives-to-using-in-a-join-for-sql-server-for-avoiding-duplicated-columns-i/32482404#32482404)开发，这就是我解决问题的方式：

首先创建所有`AS`语句的列表：

```
DECLARE @asStatements varchar(8000)

SELECT @asStatements = ISNULL(@asStatements + ', ','') + QUOTENAME(table_name) + '.' + QUOTENAME(column_name) + ' AS ' + '[' + table_name + '.' + column_name + ']'
FROM INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_NAME = 'TABLE_A' OR TABLE_NAME = 'TABLE_B'
ORDER BY ORDINAL_POSITION 
```

然后在您的查询中使用它：

```
EXEC('SELECT ' + @asStatements + ' FROM TABLE_A a JOIN TABLE_B b USING (some_id)'); 
```

但是，这可能需要修改，因为类似的东西只在 SQL Server 中进行了测试。但此代码在 SQL Server 中并不完全适用，因为不支持 USING。

**请评论您是否可以测试/更正此代码，例如 MySQL。**

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2018-06-22T20:41:24.500

PHP 7.2 + MySQL/Mariadb

MySQL 将向您发送多个具有相同名称的字段。即使在终端客户端。但是，如果您想要一个关联数组，则必须自己制作键。

感谢@axelbrz 的原创。我已将其移植到较新的 php 并对其进行了一些清理：

```
function mysqli_rows_with_columns($link, $query) {
    $result = mysqli_query($link, $query);
    if (!$result) {
        return mysqli_error($link);
    }
    $field_count = mysqli_num_fields($result);
    $fields = array();
    for ($i = 0; $i < $field_count; $i++) {
        $field = mysqli_fetch_field_direct($result, $i);
        $fields[] = $field->table . '.' . $field->name; # changed by AS
        #$fields[] = $field->orgtable . '.' . $field->orgname; # actual table/field names
    }
    $rows = array();
    while ($row = mysqli_fetch_row($result)) {
        $new_row = array();
        for ($i = 0; $i < $field_count; $i++) {
            $new_row[$fields[$i]] = $row[$i];
        }
        $rows[] = $new_row;
    }
    mysqli_free_result($result);
    return $rows;
}

$link = mysqli_connect('localhost', 'fixme', 'fixme', 'fixme');
print_r(mysqli_rows_with_columns($link, 'select foo.*, bar.* from foo, bar')); 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2018-11-01T21:08:10.517

我根据建议在节点中[使用虚拟列或哨兵列的答案实施了一个解决方案。](https://stackoverflow.com/a/9926134/39396)您可以通过生成如下 SQL 来使用它：

```
select 
    s.*
  , '' as _prefix__creator_
  , u.*
  , '' as _prefix__speaker_
  , p.*
from statements s 
  left join users u on s.creator_user_id = u.user_id
  left join persons p on s.speaker_person_id = p.person_id 
```

然后对从数据库驱动程序返回的行进行后处理，例如`addPrefixes(row)`.

实现（基于我的驱动程序返回的`fields`/ `rows`，但对于其他数据库驱动程序应该很容易更改）：

```
const PREFIX_INDICATOR = '_prefix__'
const STOP_PREFIX_INDICATOR = '_stop_prefix'

/** Adds a <prefix> to all properties that follow a property with the name: PREFIX_INDICATOR<prefix> */
function addPrefixes(fields, row) {
  let prefix = null
  for (const field of fields) {
    const key = field.name
    if (key.startsWith(PREFIX_INDICATOR)) {
      if (row[key] !== '') {
        throw new Error(`PREFIX_INDICATOR ${PREFIX_INDICATOR} must not appear with a value, but had value: ${row[key]}`)
      }
      prefix = key.substr(PREFIX_INDICATOR.length)
      delete row[key]
    } else if (key === STOP_PREFIX_INDICATOR) {
      if (row[key] !== '') {
        throw new Error(`STOP_PREFIX_INDICATOR ${STOP_PREFIX_INDICATOR} must not appear with a value, but had value: ${row[key]}`)
      }
      prefix = null
      delete row[key]
    } else if (prefix) {
      const prefixedKey = prefix + key
      row[prefixedKey] = row[key]
      delete row[key]
    }
  }
  return row
} 
```

测试：

```
const {
  addPrefixes,
  PREFIX_INDICATOR,
  STOP_PREFIX_INDICATOR,
} = require('./BaseDao')

describe('addPrefixes', () => {
  test('adds prefixes', () => {
    const fields = [
      {name: 'id'},
      {name: PREFIX_INDICATOR + 'my_prefix_'},
      {name: 'foo'},
      {name: STOP_PREFIX_INDICATOR},
      {name: 'baz'},
    ]
    const row = {
      id: 1,
      [PREFIX_INDICATOR + 'my_prefix_']: '',
      foo: 'bar',
      [STOP_PREFIX_INDICATOR]: '',
      baz: 'spaz'
    }
    const expected = {
      id: 1,
      my_prefix_foo: 'bar',
      baz: 'spaz',
    }
    expect(addPrefixes(fields, row)).toEqual(expected)
  })
}) 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2019-01-29T13:57:23.037

我所做的是使用 Excel 来连接过程。例如，首先我选择 * 并获取所有列，将它们粘贴到 Excel 中。然后写出我需要围绕该列的代码。假设我需要在一堆列中添加 prev。我将我的字段放在 a 列中，将“as prev_”放在 B 列中，并将我的字段再次放在 c 列中。在 d 列中，我将有一列。

然后在 e 列中使用 concatenate 并将它们合并在一起，确保包含空格。然后将其剪切并粘贴到您的 sql 代码中。我还使用这种方法为同一个字段和其他更长的代码制作案例陈述，我需要为数百个字段表中的每个字段做。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2021-03-25T08:23:51.170

这将创建具有给定前缀的字段列表

```
select
    name + ' as prefix.' + name + ','
from sys.columns where object_id = object_id('mytable')
order by column_id 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2021-10-09T17:25:04.640

我使用`to_jsonb`PostgreSQL 13 中的函数将**连接**表中的所有字段作为单列获取。

```
select
  TABLE_A.*,
  to_jsonb(TABLE_B.*) as b,
  to_jsonb(TABLE_C.*) as c
from TABLE_A
left join TABLE_B on TABLE_B.a_id=TABLE_A.id
left join TABLE_C on TABLE_C.a_id=TABLE_A.id
where TABLE_A.id=1 
```

结果，您将获得 TABLE_A 列的数量加上 b 和 c 列：

| ID | 姓名 | some_other_col | b | C |
| --- | --- | --- | --- | --- |
| 1 | 一些名字 | 其他一些价值 | {"id":1,"a_id":1,"prop":"value"} | {"id":1,"a_id":1,"prop":"value"} |
| 1 | 其他一些名字 | 另一个价值 | {"id":1,"a_id":1,"prop":"value"} | {"id":1,"a_id":1,"prop":"value"} |

您只需要解析 b 和 c 列即可将它们转换为对象。

# asp.net - 在 ASP.NET 中何时调用 AppInitialize 方法？

> ID：329936
> 
> 赞同：19
> 
> 时间：2008-12-01T03:17:51.230
> 
> 标签：asp.net, startup

在自定义VirtualPathProvider的实践中，我发现自定义的VirtualPathProvider可以注册在Global.asax或者根据MSDN [http://msdn.microsoft.com/en-us/library/system.web.hosting.virtualpathprovider的AppInitialize方法中.aspx](http://msdn.microsoft.com/en-us/library/system.web.hosting.virtualpathprovider.aspx)。但是，MSDN 并没有明确描述 AppInitialize 方法。

App_code 文件夹中的任何静态 AppInitialize 方法是否会在启动时由 ASP.NET 运行时自动调用？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-12-01T12:45:23.487

虽然关于 AppInitialize() 方法的文档很少，但您的假设是正确的，即您的 App_Code 文件夹中的任何类都包含这样的方法签名：

```
public static void AppInitialize() 
```

将在 Asp.Net 应用程序启动时调用。请记住，App_Code 是 Asp.Net 的一个特殊文件夹，其中的所有内容都略有不同。祝你好运找到关于 App_Code 文件夹的所有小怪癖（如前面提到的）的文档。

但是要记住的另一件事是，只有一个类可以包含 AppInitialize() 方法的签名，否则您将在运行时收到类似于以下内容的编译器错误：

> AppInitialize 方法在“App_Code.SomeClassOne”和“App_Code.SomeClassTwo”中都定义了。

因此，虽然这是完全有效的：

```
public class SomeClassOne
{
    public static void AppInitialize()
    {
        HostingEnvironment.Cache["InitializationTimeOne"] = DateTime.Now;
    } 
} 
```

这将产生我上面提到的编译器错误：

```
public class SomeClassOne
{
    public static void AppInitialize()
    {
        HostingEnvironment.Cache["InitializationTimeOne"] = DateTime.Now;
    } 
}

public class SomeClassTwo
{
    public static void AppInitialize()
    {
        HostingEnvironment.Cache["InitializationTimeTwo"] = DateTime.Now;
    } 
} 
```

我希望这可以为您解决一些问题:)

# uml - 如何使用starUml 绘制它

> ID：329940
> 
> 赞同：-1
> 
> 时间：2008-12-01T03:19:30.087
> 
> 标签：uml, staruml

我正在使用staruml，当关系复杂时，我发现很难绘制出完美的UML类图。[uml图](http://img360.imageshack.us/my.php?image=serviceloadertw5.jpg)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-01T14:29:13.857

如果您的 UML 图表变得过于复杂，请尝试将图表分解为多个图表，每个图表涵盖较小的类子集。您甚至可能希望将您的课程移动到单独的包中以保持它们的组织性。在 Star UML（和其他 UML 工具）中，类可以出现在一个以上的图表中，因此您可以包括来自一个包的所有类以及来自不同包的公共接口的类。

# c++ - 在 C/C++ 中返回 0 作为默认值的基本原理

> ID：329950
> 
> 赞同：15
> 
> 时间：2008-12-01T03:27:16.610
> 
> 标签：c++, c

将零用作“默认”函数返回值是否有原因？我注意到来自 stdlib 和几乎所有其他地方的几个函数，当没有返回正确的数字（例如 pow()、strcpy()）或错误（负数）时，只返回零。

在看到使用否定逻辑执行的几个测试后，我变得很好奇。非常混乱。

为什么不返回 1、0xff 或任何正数呢？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-12-01T03:37:25.980

基本原理是您希望将与不同错误相对应的所有可能（负）返回值的集合与一切正常*的*唯一情况区分开来。追求这种区别的最简单、最简洁和最 C-ish 的方法是逻辑测试，因为在 C 中所有整数都是“真”，除了零，你想返回零来表示“唯一的情况”，即你想要零作为“好”值。

同样的推理适用于 Unix 程序的返回值，但实际上在 Unix shell 脚本中的测试中，逻辑是相反的：返回值 0 表示“真”（例如，查看 /bin/ 的返回值）真的）。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-12-01T03:34:39.607

最初，C 没有“void”。如果函数没有返回任何内容，您只需将声明中的返回类型留空即可。但这意味着，它返回了一个 int。

所以，一切都返回了一些东西，即使它没有任何意义。而且，如果您没有专门提供返回值，那么编译器用来返回值的寄存器中的任何值都会成为函数的返回值。

```
// Perfectly good K&R C code.
NoReturn()
{
   // do stuff;
   return;
}

int unknownValue = NoReturn(); 
```

人们开始将其清除为零以避免出现问题。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-01T03:32:20.703

在 shell 脚本中，0 代表真，而另一个数字通常代表错误代码。从主应用程序返回 0 意味着一切顺利。可以将相同的逻辑应用于库代码。

也可能只是它们什么都不返回，这被解释为 0。（本质上是相同的概念。）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-01T05:31:29.760

另一个（次要）原因与机器级速度和代码大小有关。

在大多数处理器中，任何导致零的操作都会自动设置零标志，并且有一个非常便宜的操作可以跳过零标志。

换句话说，如果最后一个机器操作（例如，PUSH）让我们归零，我们所需要的只是一个零跳或非零跳。

另一方面，如果我们针对某个其他值进行测试，那么我们必须将该值移动到寄存器中，运行一个本质上将两个数字相减的比较操作，并且相等导致我们的零。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-01T03:32:00.000

因为 Bash 和大多数其他 UNIX shell 环境将 0 视为成功，将 -x 视为系统错误，将 x 视为用户定义的错误。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-01T03:34:27.610

可能有一堆被遗忘的历史可以追溯到一切都用 asm 编写的日子。一般来说，测试零比测试其他特定值要容易得多。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-01T03:37:05.497

我对此可能错了，但我认为这主要是出于历史原因（歇斯底里的葡萄干？）。我相信 K&R C (pre-ANSI) 没有 void 类型，所以编写一个不返回任何有趣的函数的逻辑方法是让它返回 0。

如果我错了，这里肯定有人会纠正我...... :)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-01T05:22:10.183

我的理解是它与系统调用的行为有关。

考虑`open()`系统调用；如果成功，则返回一个非负整数，即创建的文件描述符。但是，在汇编程序级别（有一条特殊的非 C 指令会陷入内核），当返回错误时，它会作为负值返回。当它检测到错误返回时，围绕系统调用的 C 代码包装器将取反的值存储到`errno`（因此`errno`具有正值），并且函数返回 -1。

对于其他一些系统调用，汇编器级别的负返回码仍然被取反并放入`errno`并返回 -1。但是，这些系统调用没有特殊的返回值，因此选择零表示成功。显然，系统调用种类繁多，但大多数都符合这些约定。例如，`stat()`它的亲戚返回一个结构，但指向该结构的指针作为输入参数传递，返回值为 0 或 -1 状态。甚至`signal()`管理它；-1 是 SIG_DFL，0 是 SIG_IGN，其他值是函数指针。有一些没有错误返回的系统调用 -`getpid()`等等`getuid()`。

这种零指示成功机制随后被其他实际上不是系统调用的函数模拟。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-01T05:54:06.657

按照惯例，返回码 0 表示您的程序已正常结束并且一切正常。（您可以记住这是“零错误”，尽管出于技术原因，您不能使用程序发现的错误数作为返回码。请参阅样式。）返回码不是 0 表示发生了某种错误。如果您的代码在遇到错误时终止，请使用 exit 并指定非零返回码。[资源](http://www.linuxtopia.org/online_books/programming_books/gnu_c_programming_tutorial/The-exit-function.html)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-01T07:16:13.527

除了以前的海报提出的所有要点之外，当函数在成功时返回 0 时，它还大大清理了代码。

考虑：

```
if ( somefunc() ) {
   // handle error
} 
```

比：

```
if ( !somefunc() ) {
   // handle error
} 
```

或者：

```
if ( somefunc() == somevalue ) {
   // handle error 
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-01T03:32:31.857

因为 0 在 C/C++ 中是 false 和 null，当发生这种情况时，您可以使用方便的捷径。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-12-01T04:29:16.390

这是因为在 UNIX shell 中使用返回 0 的命令表示成功。

任何其他值都表示失败。正如 Paul Betts 指出的那样，正值和负值界定了错误可能起源的位置，但这只是一个惯例，而不是绝对的。用户应用程序可能会返回一个负值而不会产生任何不良后果（除了它向外壳指示应用程序失败之外）。

# python - Python crypt 模块——盐的正确用法是什么？

> ID：329956
> 
> 赞同：9
> 
> 时间：2008-12-01T03:31:45.540
> 
> 标签：python, linux, cryptography, crypt

首先，上下文：我正在尝试创建一个需要登录的基于命令行的工具（Linux）。此工具上的帐户与系统级帐户无关——这些都与 /etc/passwd 无关。

我计划使用与 /etc/passwd 相同的格式（大致）将用户帐户存储在文本文件中。

尽管不使用系统级密码文件，但与以明文形式存储密码相比，使用 crypt 似乎是一种很好的做法。（虽然 crypt 肯定比以明文形式存储密码更好，但我对其他方法持开放态度。）

我的地穴知识基于此： [https ://docs.python.org/2/library/crypt.html](https://docs.python.org/2/library/crypt.html)

该文档似乎要求一些不可能的事情：“建议在检查密码时使用完整的加密密码作为盐。”

嗯？如果我正在创建加密密码（如创建用户记录时），我如何将加密密码用作盐？它还不存在。（我假设您必须使用相同的盐来创建和检查密码。）

我试过使用明文密码作为盐。这确实有效，但有两个问题；一种容易克服，一种严重：

1）明文密码的前两个字母包含在加密密码中。您可以通过不将前两个字符写入文件来解决此问题：

```
user_record = '%s:%s:%s' % (user_name, crypted_pw[2:], user_type) 
```

2）通过使用明文密码作为盐，您似乎正在减少系统中的熵量。可能我误解了盐的用途。

我能够得出的最佳实践是使用用户名中的前两个字符作为盐。这是合适的，还是我错过了什么使这成为一个糟糕的举动？

我对盐的理解是它可以防止从字典中预先计算密码哈希。我可以对所有密码使用标准盐（例如我的首字母“JS”），但这对于攻击者来说似乎比使用每个用户用户名中的两个字符要少。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-01T04:20:23.523

Python 的 crypt() 是系统的 crypt() 函数的包装器。从 Linux crypt() 手册页：

```
char *crypt(const char *key, const char *salt);

key 是用户输入的密码。
salt 是从集合 [a–zA–Z0–9./] 中选择的两个字符的字符串。
此字符串用于扰乱 4096 之一中的算法
不同的方法。

```

重点是“*两个字符的*字符串”。现在，如果您查看 crypt() 在 Python 中的行为：

```
>>> crypt.crypt("Hello", "World")
'Wo5pEi/H5/mxU'
>>> crypt.crypt("Hello", "ABCDE")
'AB/uOsC7P93EI' 
```

您会发现结果的前两个字符总是与原始盐的前两个字符重合，这确实构成了真正的双字符盐本身。也就是说， crypt() 的结果形式为 2char-salt + encrypted-pass。因此，如果不是传递两个字符的盐或原始的多字符盐，而是传递整个加密密码，则结果没有区别。

注意：集合[a–zA–Z0–9./]包含64个字符，64*64=4096。以下是*两个*字符与“ *4096*种不同方式”的关系。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-01T03:54:55.897

对于 crypt 模块的使用：

生成加密密码时，您提供盐。只要满足列出的条件，增加对暴力破解的抵抗力也可能是随机的。检查密码时，您应该提供 getpwname 中的值，以防您使用的系统支持更大的盐大小并且不是自己生成的。

普通的留言：

如果这与实际系统登录无关，那么没有什么能阻止您使用比 crypt 更强大的方法。您可以随机生成 N 个字符的每个用户 salt，以与 SHA-1 哈希中的用户密码组合。

```
string_to_hash = user.stored_salt + entered_password
successful_login = (sha1(string_to_hash) == user.stored_password_hash) 
```

更新：虽然这对彩虹表要安全得多，但上述方法仍然存在加密弱点。正确应用 HMAC 算法可以进一步提高您的安全性，但这超出了我的专业范围。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-01T03:51:59.540

您误解了文档；它说由于盐的长度可能会根据底层 crypt() 实现而有所不同，因此您应该*在检查密码时*提供整个加密密码作为盐值。也就是说，不要把前两个字符拉出来作为盐，而是把整个东西都扔进去。

您让初始盐基于用户名的想法似乎没问题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-01T04:01:13.140

以下是一些关于加盐密码的一般建议：

1.  一般来说，salts 用于制作[ranbow 表](http://en.wikipedia.org/wiki/Rainbow_table)，计算成本太高。因此，您应该在所有密码哈希中添加一点随机盐，并将其以明文形式存储在哈希密码值旁边。
2.  使用[HMAC](http://en.wikipedia.org/wiki/HMAC) - 这是一个很好的标准，它比连接密码和盐更安全。
3.  使用 SHA1：MD5 已损坏。如果您知道这一点，就没有冒犯的意思，只是彻底。;)

我**不会**让盐成为密码的功能。攻击者必须生成一个彩虹表才能拥有一个即时查找密码数据库，但他们只需要这样做一次。如果您选择一个随机的 32 位整数，他们必须生成 2^32 个表，这（与确定性盐不同）会耗费太多内存（和时间）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-01T16:09:13.000

为了增加一些强度，您可以通过在格式中使用盐来让 crypt 模块使用 md5。

```
$1$ABCDEFGH$ 
```

其中 ABCDEFGH 是你的盐字符串。

```
>>> p = crypt.crypt('password', '$1$s8Ty3/f$')
>>> p
Out: '$1$s8Ty3/f$0H/M0JswK9pl3X/e.n55G1'
>>> p == crypt.crypt('password', p)
Out: True 
```

（请注意，这是 crypt 的 gnu 扩展，请参阅 linux 系统上的“man crypt”）。MD5（现在甚至是 SHA1）可能会“损坏”，但它们对于密码哈希仍然相对较好，并且 md5 仍然是 linux 本地密码的标准。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-01T04:40:02.860

密码或从密码派生的任何内容都不应用作盐。特定密码的盐应该是不可预测的。

用户名或用户名的一部分是可以容忍的，但更好的是来自加密 RNG 的随机字节。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-01T19:12:07.840

使用 PBKDF2，在不同的线程上看到[这个评论（包括 Python 实现）。](https://stackoverflow.com/questions/287517/encryptinghashing-plain-text-passwords-in-database#287883)

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-12-07T01:01:21.220

查看Björn Edström解释的文章[TrueCrypt 。](http://blog.bjrn.se/2008/01/truecrypt-explained.html)它包含对 truecrypt 工作原理的易于理解的解释，以及对一些 truecrypt 功能（**包括密码管理**）的简单 Python 实现。

> 他说的是 Python crypt() 模块，而不是 Python 中的 TrueCrypt

Python 2 中的默认值`crypt.crypt()`不是很安全，[文章](http://blog.bjrn.se/2008/01/truecrypt-explained.html)解释了更安全的替代方案如何工作。

# .net - 截断十进制数不四舍五入

> ID：329957
> 
> 赞同：37
> 
> 时间：2008-12-01T03:31:54.243
> 
> 标签：.net, floating-point, truncate

> **可能重复：**
> [c# - 如何将十进制值四舍五入到小数点后 2 位（用于页面上的输出）](https://stackoverflow.com/questions/164926/c-sharp-how-do-i-round-a-decimal-value-to-2-decimal-places-for-output-on-a-pa)

我想像下面这样截断小数

IE

*   2.22939393 -> 2.229
*   2.22977777 -> 2.229

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2008-12-01T03:41:15.223

您可以使用[Math.Round](http://msdn.microsoft.com/en-us/library/zy06z30k.aspx)：

```
decimal rounded = Math.Round(2.22939393, 3); //Returns 2.229 
```

或者，您可以将 ToString 与 N3[数字格式](http://msdn.microsoft.com/en-us/library/dwhawy9k.aspx)一起使用。

```
string roundedNumber = number.ToString("N3"); 
```

**编辑：**由于您不想四舍五入，因此可以轻松使用[Math.Truncate](http://msdn.microsoft.com/en-us/library/system.math.truncate.aspx)：

```
Math.Truncate(2.22977777 * 1000) / 1000; //Returns 2.229 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-12-01T03:57:06.033

```
double d = 2.22977777;
d = ( (double) ( (int) (d * 1000.0) ) ) / 1000.0 ; 
```

当然，如果您尝试截断舍入误差，这将不起作用，但它应该适用于您在示例中给出的值。有关为什么有时它不起作用的详细信息，请参阅[此问题](https://stackoverflow.com/questions/304011/truncate-a-decimal-value-in-c)的前两个答案。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-07-22T13:15:00.890

截断任意小数位数的函数：

```
public decimal Truncate(decimal number, int digits)
{
  decimal stepper = (decimal)(Math.Pow(10.0, (double)digits));
  int temp = (int)(stepper * number);
  return (decimal)temp / stepper;
} 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2011-08-02T20:35:50.213

这是一个不受整数溢出影响的扩展方法（就像上面的一些答案一样）。它还缓存了一些 10 的幂以提高效率。

```
static double[] pow10 = { 1e0, 1e1, 1e2, 1e3, 1e4, 1e5, 1e6, 1e7, 1e8, 1e9, 1e10 };
public static double Truncate(this double x, int precision)
{
    if (precision < 0)
        throw new ArgumentException();
    if (precision == 0)
        return Math.Truncate(x);
    double m = precision >= pow10.Length ? Math.Pow(10, precision) : pow10[precision];
    return Math.Truncate(x * m) / m;
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-02-10T22:06:00.880

这类似于上面的 TcKs 建议，但使用 math.truncate 而不是 int 转换

VB：但你会明白的

```
Private Function TruncateToDecimalPlace(byval ToTruncate as decimal, byval DecimalPlaces as integer) as double 
dim power as decimal = Math.Pow(10, decimalplaces)
return math.truncate(totruncate * power) / power
end function 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-01T09:07:57.327

你想要什么格式的输出？

如果您对字符串感到满意，请考虑以下 C# 代码：

```
double num = 3.12345;
num.ToString("G3"); 
```

结果将是“3.12”。

如果您使用的是 .NET，则此链接可能有用。 [http://msdn.microsoft.com/en-us/library/dwhawy9k.aspx](http://msdn.microsoft.com/en-us/library/dwhawy9k.aspx)

我希望这会有所帮助....但除非您确定您使用的语言和您想要输出的格式，否则很难提出适当的解决方案。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-01-21T14:29:55.600

也许另一个快速的解决方案可能是：

```
>>> float("%.1f" % 1.00001)
1.0
>>> float("%.3f" % 1.23001)
1.23
>>> float("%.5f" % 1.23001)
1.23001 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-09-26T13:14:17.507

试试这个

```
double d = 2.22912312515;
int demention = 3;
double truncate = Math.Truncate(d) + Math.Truncate((d - Math.Truncate(d)) * Math.Pow(10.0, demention)) / Math.Pow(10.0, demention); 
```

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2008-12-01T09:22:52.633

试试这个：

```
decimal original = GetSomeDecimal(); // 22222.22939393
int number1 = (int)original; // contains only integer value of origina number
decimal temporary = original - number1; // contains only decimal value of original number
int decimalPlaces = GetDecimalPlaces(); // 3
temporary *= (Math.Pow(10, decimalPlaces)); // moves some decimal places to integer
temporary = (int)temporary; // removes all decimal places
temporary /= (Math.Pow(10, decimalPlaces)); // moves integer back to decimal places
decimal result = original + temporary; // add integer and decimal places together 
```

它可以写得更短，但这更具描述性。

**编辑：**捷径：

```
decimal original = GetSomeDecimal(); // 22222.22939393
int decimalPlaces = GetDecimalPlaces(); // 3
decimal result = ((int)original) + (((int)(original * Math.Pow(10, decimalPlaces)) / (Math.Pow(10, decimalPlaces)); 
```

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2010-02-16T06:24:34.777

忘记一切，看看这个

```
double num = 2.22939393;
num  = Convert.ToDouble(num.ToString("#0.000")); 
```

# c++ - 静态变量，单独编译

> ID：329962
> 
> 赞同：0
> 
> 时间：2008-12-01T03:32:44.493
> 
> 标签：c++, file, variables, static

我写了一个程序，它都在一个文件中，方法在标题中前向声明。该程序最初在一个文件中时运行良好。但是当我分离程序时，我不断地随机出现在头文件中声明的类之一的析构函数。

我的标题中有一个静态变量来计算特定类的对象数。每当我构造对象时，我都会增加这个变量。然后在我的析构函数中，我从那个变量中减去 1，检查它是否为 0（意味着它是最后一个对象）并做一些事情。有时值似乎关闭，我不知道为什么。我的应用程序中确实有随机调用，但我不明白为什么这会影响我上面描述的内容，谢谢。任何帮助或见解表示赞赏！

[更新]：有一个基类，其中包含在头文件中实现的析构函数..，然后我有两个派生类，它们在它们的构造函数中递增静态变量.. 那我该怎么办？

我想做的是以下内容：在我的标题中，我有这个：

```
class A {
public:
    virtual ~A() {
        count --;
        if (count == 0) { /* this is the last one, do something */ }
    }

class B : public A {
public:
    B();
} 
```

然后在 BI 类有

```
B::B() { 
    count++;
} 
```

我在哪里可以定义计数，这样我就不会得到误导性计数？谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-01T04:37:34.987

您必须在 A （全部）中定义构造函数来增加计数。

请注意，除非您定义它们，否则编译器会自动生成以下四种方法：

*   默认构造函数（如果没有定义其他构造函数）
*   默认析构函数
*   复制构造函数
*   赋值运算符

以下代码覆盖编译器默认值，以便您获得准确的计数。

```
 class A
 {
    static int count;

    public:
        A()   // Default constructor.
        {
            ++count;
        }
        A(A const& copy)  // Copy constructor/
        {                 // Note If you do not define it the compiler
            ++count;      // will automatically do it for you
        }
        virtual ~A()
        {
            --count;
            if (count == 0)
            {  // PLOP
            }
        }
        // A& operator=(A const& copy)
        // do not need to override this as object has
        // already been created and accounted for.
}; 
```

//// 在源文件中：

```
int A::count = 0; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-01T03:52:10.897

您的静态变量在哪里定义？也许您不小心在头文件中定义了它，并且内联使事情变得混乱（并且编译器没有捕获多个定义，这很奇怪，但您永远不会知道）。

确保在一个翻译单元中定义了一个类静态变量。你这样定义它：

```
int MyClass::static_var; 
```

这也是你放置初始化程序的地方，如果有的话。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-01T03:38:43.247

您能否详细说明“价值似乎已关闭”是什么意思？你有太多的建筑吗？破坏力不够？如果你得到了太多的构造而没有足够的破坏，那么它与静力学没有任何关系。

另外，静态变量是什么意思？您的意思是静态成员字段还是实际的静态变量？

如果您在标头中仅声明一个静态变量（我怀疑您是否这样做），那么包含该标头的每个 C 文件都将具有该变量的单独实例（因为全局变量之前的静态意味着它仅限于该对象文件）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-01T04:29:19.667

```
class A {
public:
    virtual ~A() {
        count --;
        if (count == 0) { // this is the last one, do something }
    }
protected:
    static int count;
};

class B : public A{
public:
B();
}; 
```

然后，在一个且只有一个源文件中，您需要放置以下内容。它应该放在包含 A 类代码的源文件中。

```
int A::count(0); 
```

您需要这样做，因为头文件声明将有一个名为 count 的变量，但没有为它分配任何存储空间。如果你没有把它放在源文件中，链接器会抱怨它没有找到。

# python - 在 Django Admin 中用富文本编辑器替换 textarea？

> ID：329963
> 
> 赞同：46
> 
> 时间：2008-12-01T03:32:46.443
> 
> 标签：python, django, admin

我想知道在 Django Admin 中用富文本编辑器替换标准 textarea 字段的最佳方法？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-12-01T05:12:28.520

有一个[附加的 Django 应用程序](http://pypi.python.org/pypi/django-tinymce/)可以为 Django 管理表单提供[TinyMCE](http://tinymce.moxiecode.com/)支持，而无需使用管理模板或 Django 新表单内部。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-12-03T13:34:31.000

看看这个[片段](http://www.djangosnippets.org/snippets/1035/)- 基本想法是在您的管理定义中包含自定义 JS，它将用富文本编辑器替换标准文本区域。

对于 jQuery/FCKEditor，这样的 JS 可能看起来像这样：

```
$(document).ready(function() {
    $("textarea").each(function(n, obj) {
        fck = new FCKeditor(obj.id) ;
            fck.BasePath = "/admin-media/fckeditor/" ;
            fck.ReplaceTextarea() ;
    });
}); 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-12-06T13:14:21.647

我会说：定义您自己的 ModelAdmin 类并覆盖用于特定字段的小部件，例如：

```
class ArticleAdminModelForm(forms.ModelForm):
    description = forms.CharField(widget=widgets.AdminWYMEditor)

    class Meta:
        model = models.Article 
```

（AdminWYMEditor 是一个`forms.Textarea`子类，它添加了具有特定于 Django 管理应用程序的配置的 WYMEditor）。

请参阅[Jannis Leidel 的这篇博客文章，](http://web.archive.org/web/20101123194618/http://jannisleidel.com/2008/11/wysiwym-editor-widget-django-admin-interface/)了解如何实现这个小部件。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2015-03-16T13:09:13.003

在发布日期和答案 TinyMCE 非常受欢迎（因为它可能今天仍然存在）。但一段时间后 ckeditor 出现了，许多人认为这是一个更好的选择，包括许多 SO 用户：

[比较 TinyMCE 和 CKeditor 的 Wiki](https://stackoverflow.com/questions/1470067/compare-tinymce-and-ckeditor-for-a-wiki)

[http://www.turnkeylinux.org/blog/tinymce-vs-ckeditor](http://www.turnkeylinux.org/blog/tinymce-vs-ckeditor)

还有 2013 年对 WISIWYG 编辑器的 Django 俄语评论：

[http://habrahabr.ru/company/htdt/blog/202782/](http://habrahabr.ru/company/htdt/blog/202782/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-03-09T20:31:53.080

目前在 django admin 中使用 tinymce 最直接的方法是使用 Grappelli。

[http://code.google.com/p/django-grappelli/](http://code.google.com/p/django-grappelli/)

Grappelli 也是[django-filebrowser](http://code.google.com/p/django-filebrowser/)的要求，所以如果你想要整个 shebang，无论如何你都需要它。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-10-14T02:01:27.423

```
class KindEditor(forms.Textarea):
    class Media:
        css ={
            'all':(settings.STATIC_ROOT + 'editor/themes/default/default.css',)
        }
        js = (settings.STATIC_ROOT + 'editor/kindeditor-min.js',settings.STATIC_ROOT + 'editor/lang/zh_CN.js',)
    def __init__(self):
        attrs = {}
        attrs['rel'] = 'kind'
        super(KindEditor, self).__init__(attrs)

class NewsAdminForm(forms.ModelForm):
    pass

    class Meta:
        model = News
        widgets = {
            'body':KindEditor()
        }

class NewsAdmin(admin.ModelAdmin):
    form = NewsAdminForm

admin.site.register(News, NewsAdmin) 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-04-23T02:42:53.987

好的，为了更新这篇文章，我想说实现 TinyMCE 的最简单方法是使用[django-tinymce](https://github.com/aljosa/django-tinymce)应用程序。您还必须从[TinyMCE 页面](http://tinymce.moxiecode.com/index.php)下载 JS 文件。我在 django 国际化方面遇到了一些错误，但是从 TinyMCE 下载语言包就足够了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2022-02-19T17:37:00.050

安装这个包

```
pip install django-ckeditor 
```

然后运行这些命令进行迁移。

```
python manage.py makemigrations
python manage.py migrate
python manage.py collectstatic 
```

最后重新启动你的 Django 服务器。

完成上述步骤后，您可以在管理面板字段中看到富文本编辑器。

# objective-c - 文字 NSString 是自动释放还是需要释放？

> ID：329977
> 
> 赞同：21
> 
> 时间：2008-12-01T03:40:17.237
> 
> 标签：objective-c, cocoa-touch, memory-management, nsstring, literals

使用以下表示法创建字符串时：

```
NSString *foo = @"Bar"; 
```

需要释放`foo`吗？还是`foo`在这种情况下自动释放？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-01T03:43:15.530

编译器分配的字符串（格式为@"STRING"）是常量，因此给它们的-retain、-release 和-autorelease 消息将被忽略。在这种情况下，您不必释放或自动释放 foo （但它不会受到伤害）。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-12-01T04:12:01.153

如文档中所述

[http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/Tasks/MemoryManagementRules.html](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/Tasks/MemoryManagementRules.html)

> 如果您使用名称以“alloc”或“new”开头或包含“copy”（例如，alloc、newObject 或 mutableCopy）的方法创建对象，或者向其发送保留消息，则您将获得对象的所有权。您有责任放弃使用 release 或 autorelease 拥有的对象的所有权。任何其他时间您收到一个对象，您都不能释放它。

由于您没有使用 alloc、copy 等，因此您无需担心释放对象。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-12-17T10:46:18.607

我同意@Ben\ Gottlieb 在“编译器分配的字符串（格式为@“STRING”）是常量”但由于您没有通过传递`alloc`或`retain`消息初始化它们，因此您不能向它们传递`release`或`autorelease`消息，否则您的应用程序将崩溃使用以下日志

> “未分配被释放的指针”

**[笔记](https://stackoverflow.com/questions/2713843/iphone-memory-management-a-newbie-question/2713941#2713941)**

```
NSString *str = [NSString string]; 
```

相当于：

```
NSString *str = [[[NSString alloc] init] autorelease]; 
```

所以`release`或者也`autorelease`不能在这里通过。

# javascript - 在 Greasemonkey/Javascript 中激活 Firefox 选项卡？这可能吗？

> ID：329986
> 
> 赞同：3
> 
> 时间：2008-12-01T03:43:35.470
> 
> 标签：javascript, firefox, tabs, greasemonkey

我开发了一个greasemonkey 脚本来刷新页面并检查某些更新。我想在一个选项卡中运行此脚本并在另一个选项卡中浏览互联网，然后让脚本在找到更新时自动激活它的选项卡。

我不确定那有多清楚，也许这更好：

选项卡 1 正在运行一个greasemonkey 脚本，每x 秒刷新一次以查找单词“foo”

选项卡 2 正在浏览 stackoverflow

-- 现在在刷新时，GM 脚本会找到单词“foo”。这是我希望选项卡焦点自动从选项卡 2 转移到选项卡 1 的时候。

这是否可能，如果可以，我该如何实现？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-01T07:35:14.220

我很确定 Firefox 将焦点放在调用`alert()`. 所以只要弹出一个
`alert('found foo')`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-03-07T00:09:08.647

您可以通过[Scriptish](https://addons.mozilla.org/en-US/firefox/addon/scriptish/)的[`GM_openInTab`](https://github.com/erikvold/scriptish/wiki/GM_openInTab)实现来实现这一点，如下所示：

```
GM_openInTab(window.location.href, true); 
```

这应该会导致 GM 脚本所在的页面成为焦点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-01T17:13:09.843

你看过[GM_openInTab()](http://wiki.greasespot.net/GM_openInTab)吗？

# wpf - 如何对 ObservableCollection 进行分页？

> ID：329988
> 
> 赞同：4
> 
> 时间：2008-12-01T03:44:55.543
> 
> 标签：wpf, pagination, observablecollection, paginator

我有一个 ListBox，里面有太多的项目，而且 UI 越来越慢（虚拟化等）。所以我在考虑只显示前 20 个项目并允许用户浏览结果集（即 ObservableCollection）。

**有人知道 ObservableCollection 是否存在分页机制吗？以前有人做过吗？**

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-01T04:18:40.250

此工具在基本 ObservableColleton 类中不直接可用。您可以扩展 ObservableCollection 并创建执行此操作的自定义 Collection。您需要将原始 Collection 隐藏在这个新类中，并基于 FromIndex 和 ToIndex 动态地将项目范围添加到类中。覆盖 InsertItem 和 RemoveItem。我在下面给出一个未经测试的版本。但请把它当作伪代码。

```
 //This class represents a single Page collection, but have the entire items available in the originalCollection
public class PaginatedObservableCollection : ObservableCollection<object>
{
    private ObservableCollection<object> originalCollection;

    public int CurrentPage { get; set; }
    public int CountPerPage { get; set; }

    protected override void InsertItem(int index, object item)
    {
        //Check if the Index is with in the current Page then add to the collection as bellow. And add to the originalCollection also
        base.InsertItem(index, item);
    }

    protected override void RemoveItem(int index)
    {
        //Check if the Index is with in the current Page range then remove from the collection as bellow. And remove from the originalCollection also
        base.RemoveItem(index);
    }
} 
```

更新：我在这里有一篇关于这个主题的博客文章 - [http://jobijoy.blogspot.com/2008/12/paginated-observablecollection.html](http://jobijoy.blogspot.com/2008/12/paginated-observablecollection.html)并且源代码已上传到[Codeplex](http://www.codeplex.com/PaginatedCollection)。

# css - Firefox 以外的浏览器是否计划支持 -moz CSS 属性，或者 CSS3 是否有等价物？

> ID：329993
> 
> 赞同：2
> 
> 时间：2008-12-01T03:50:31.057
> 
> 标签：css, firefox, cross-browser, browser-support

截至目前，我相信只有 Firefox 支持`-moz-border-radius`属性。我很惊讶 twitter 使用它。

是否有任何其他浏览器计划支持此功能，或者 CSS3 是否有类似的功能？

**编辑：**我还找到了[-webkit-border-top-left-radius](http://www.css3.info/preview/rounded-border/)然后是[CSS3 版本](http://www.w3.org/TR/2002/WD-css3-border-20021107/#border-radius)

那么CSS3什么时候出来呢？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-01T04:01:10.753

[CSS3 有`border-radius`](http://www.w3.org/TR/css3-background/#the-border-radius).

目前，基于 Mozilla 和 WebKit 的浏览器具有实验性支持，`-moz-border-radius`并且`-webkit-border-radius`. 现在使用它们还不错，只要您了解它们是临时措施，直到它们被正确实施。我预计不久之后您就会看到对`border-radius`Mozilla、Firefox 和 IE 的全面支持。（好吧，希望是 IE。）

**更新：**截至 2016 年 8 月，[border-radius](http://caniuse.com/#search=border-radius)在所有原生桌面浏览器（以及大多数移动浏览器，更不用说）中原生可用，使用`-moz-border-radius`,`-webkit-border-radius`和类似的严格性正在慢慢放松。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-01T04:19:35.910

由于 CSS3 规范尚未最终确定，Mozilla 和 Webkit 决定实现自己的圆角方法，以正确的方式进行，方法是在前面添加特定于供应商的标签。

这样做是为了当 CSS3 最终发布时，如果他们改变了边框半径应该如何工作（例如：参数的顺序），那么使用供应商特定方法的站点都不会被破坏。Mozilla 和 WebKit 可以继续实现 W3C 风格，开发人员可以慢慢转向。

您看到一些网站使用它并不奇怪，尤其是对于圆角之类的东西，它不会对用户体验产生巨大影响。我的意思是，错过的只是 IE 用户，他们应得的一切。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-02T18:44:18.473

当人们谈论 CSS3 的问世时，我感到很烦。它不像以前的那样是一个完整的规范。它已被分解为单独的模块，可以独立地增加它们的版本。

所以*选择器级别 4可能会在**CSS 背景和边框级别 3*之前进行推荐。

那么，CSS3 会到来吗？最终，但不是一次。所以不要等待它，现在就开始使用它（如果适用）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-01T03:52:15.000

CSS3 正在开发类似的东西。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-01T04:18:59.593

据此[，](http://msdn.microsoft.com/en-us/library/cc351024.aspx#border) IE 8 将***不***支持border-radius。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-01T13:56:01.940

任何以破折号开头的 CSS 属性（例如`-moz`, `-webkit`）都是特定于浏览器的属性。

这允许浏览器供应商试验新的 CSS 属性。这样做是编写新 CSS 规范过程中的一个常见部分，以允许 Web 开发人员查看属性如何工作并引发问题。

因此，您会发现许多 CSS 3 属性，例如`border-radius`当前在某些具有供应商特定扩展的浏览器中实现的。

只要您知道它们只能在一个浏览器中工作，在生产站点上使用它们并没有什么特别的错误。

CSS 3 应该会在任何十年出现 :)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-10-26T18:10:11.727

基于浏览器的属性仅用于该特定浏览器的临时修复，并且应该在 W3C 将它们纳入 CSS 时被弃用。我不会依赖它们来跨浏览器，甚至不会依赖于特定的浏览器。**********