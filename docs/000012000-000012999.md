# StackOverflow 问答 12000-12999

# architecture - 你是如何进行系统集成的？

> ID：12008
> 
> 赞同：5
> 
> 时间：2008-08-15T06:06:13.720
> 
> 标签：architecture, system-integration

我很好奇不同的人如何解决系统集成问题。我有一种感觉，在过去的几年中，越来越多的工作进入了集成系统，并且这种工作需求也会增加。

我想知道您是否可以通过开发自己的小型服务来解决它，然后再连接，或者您是否使用某种产品（WebSphere、BizTalk、[Mule](http://mule.mulesource.org/display/MULE/Home)等）。我还认为了解如何管理和维护这些解决方案（您如何解决安全性、仪器等）、您的解决方案遇到过什么样的问题等等会很有趣。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-08-15T07:10:14.217

哇 - 好的 - 会得到一个关于这个的帖子，但会很大。

集成需要得到业务对好处的深刻理解来支持 - 整理出一个运营模型 - 因为业务可能实际上需要标准化而不是集成，因为这可能代价高昂 - 这就是大多数 SOA 失败的原因！[企业架构：从 IT 中获得业务收益 作者：Jeanne W. Ross](http://mitsloan.mit.edu/cisr/papers.php)

如果需要集成，则需要确定集成类型。

速度和性能指标是什么？

我们有一个带有复合应用程序的 .NET SOA，该复合应用程序使用 BizTalk 2006 和带有业务线应用程序的 web 服务。复合端应用程序的性能（消耗） - 受限于业务线应用程序中 Web 服务（及其实现）的速度！我们需要低于 3 秒的结果返回 - 案例列表。无法在 Web 服务中实现，因此我们需要直接进入数据库进行初始搜索。然后通过 Web 服务创建案例。成本影响和维护在这里成为一个问题。

这里的重点是查看规范和业务需求中的性能标准，这将有助于查看您需要执行的集成类型 - WebServices (HTTP)、File Drop/EDI 等

在功能上，您需要查看建议架构中的故障点——因为这将导致 SLA/OLA 中的责任链。您可能需要将集成/故障点包装到您控制的事物中。

关于与业务线集成的类似点是，在集成之前您需要了解多少其他产品？是的，Web 服务应该是按合同设计的，但实现通常是有漏洞的，你需要了解很多关于正在发生的事情 - 如果这是一个你无法控制抽象的产品，即使 Web 服务泄漏到你的集成技术也就是 BizTalk 中。

将这两点结合在一起，您最好的建议是获得像 BizTalk 这样的集成中心类型 - 将业务线应用程序包装在您创建的 Web 服务中 - 这样 BizTalk 端就可以避免抽象泄漏，然后您还可以减少故障点因为您已将业务线应用程序与集成中心和故障点分离到单个源而不是编排内部。

SOA 和 Intergation 项目中的检测和诊断很难实现！- 不要让任何闪亮的销售人员尝试以不同的方式告诉你！是的，带有 MOM Ent 的 MOM 可以做到这一点，UniCenter 可以做到。

主要问题是了解错误（又名打嗝）的含义以及如何从中恢复……您最终会收到卡住的消息，您需要了解这对业务流程意味着什么。您可以收到警报说 - 处理器是 100% Ram 100% 编排失败 - 但没有真正的意义。您必须从一开始就将这些东西设计到解决方案中 - 并希望成为您的失败点。

集成模式的类型以及如何执行它们也需要考虑。

以上是在 LIVE 实现中使用 BizTalk 的 .NET SOA 的真实世界视图。但也正是由于这个架构的限制——BizTalk主要是HUB和SPOKE模式。

查看[Martin Fowler 的企业应用程序模式](http://www.amazon.co.uk/Enterprise-Application-Architecture-Addison-Wesley-Signature/dp/0321127420/ref=sr_1_2?ie=UTF8&s=books&qid=1218785778&sr=8-2)

有很多方法可以完成任务！

其他注意事项...平台/开发者语言等

对我们来说，重要的因素之一是开始这些东西所需的技能。我们有了解 Java 和 C# 的 OO 开发人员，但主要是 C#。所以我们选择了 MS 堆栈。但是，当您选择集成类型和产品来管理它时，他们将需要更多技能来理解该技术。但是，嘿，这对我们开发人员来说很正常，对吧？错误的许多开发人员，无论有没有经验，都可能无法使用 BizTalk 之类的软件！范式的重大转变——部分原因是消息传递而不是代码。

最后一点最好！

集成中可能面临的交易数量可能是所有这一切中最大的一个因素。因为这将指导什么模式、故障点和对此类事情的容忍度。

您需要在预期的卷上选择最好的那个。可以扩大和扩大规模的东西！我们选择 BizTalk 是因为它可以正确扩展和扩展，并且比其他一些更好地理解。

如果你没有卷，那么看看没有什么东西来管理它们，并采用没有管理的 webservice 到 webservice 类型的样式 - 需要将性能和故障理解编码到它们中。

如果您在带有 .net 3 的 Windows 平台上查看 WWF/WCF，因为这可以帮助 web 服务到 web 服务 - 现在在实际平台中更多地解决所有这些问题，而无需 BizTalk 和其他人的开销。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-15T15:44:50.313

根据我的经验，这取决于您要解决的问题类型。

根据我的经验，很难以物超所值的价格击败 BizTalk 2006 R2，但它确实意味着使用 Microsoft 技术堆栈。

Websphere MQ 似乎更容易向大型企业销售，而且它可能在企业级得到更多使用。

两者都提供了良好的仪器，但作为开发人员，您可以根据客户的要求对其进行自定义。

在某些情况下，我发现定制解决方案是最合适的或利用 MSMQ 等技术来降低成本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-04T20:12:06.497

您提到了 WebSphere、BizTalk、Mule。每一个都有非常不同的特点，有好有坏。如果只是集成，我会推荐 Mule。我有很好的经验，更重要的是架构师是非侵入性的，所以你总是可以迁移到不同的 ESB 或其他 Buzz word 投诉解决方案。Mule 的优点之一是它可以嵌入到您的应用程序中，并且您的最终工件可以部署在 Webshpere、WLS、Glassfish 等上……甚至无需显示您嵌入了 ESB。然后这个 ESB 可以执行所有集成管道（管理连接类型和协议）。而某些端点可能是您提到的其他集成解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-01T19:46:24.480

我们使用 Mule 有一段时间了（现在研究从 1.4 到 2.1.x 版本的迁移）。

嗯，它是最好的 ESB 之一，具有实时社区和供应商方面的快速反应，但 IMO 版本 2.1.x 仍然有点原始（或者我们只是使用它来调用 CXF web 的公司 :) 另请参阅我的帖子了解详细信息[http://www.nabble.com/Migration-from-XFire-to-CXF:-Is-Web-Service-Client-in-Mule-2.x-broken--to19969320.html#a19969320](http://www.nabble.com/Migration-from-XFire-to-CXF:-Is-Web-Service-Client-in-Mule-2.x-broken--to19969320.html#a19969320) )

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-25T21:44:35.880

我们有一份甲骨文合同。所以我们正在使用 Oracle 堆栈。SOA 套件 10.1.3.4。大多数是 BPEL 解决方案，对于简单的转换，我们尝试使用 ESB。

ESB 有一个糟糕的故障处理机制。对于 BPEL，有很多方法可以处理错误。我们尝试开发 Java Web 服务来连接 SOA 套件，我们的主要系统是 Oracle EBS 系统。它们通过 SOA 套件附带的默认 EBS 适配器与遗留系统或其他 EBS 环境进行通信。

我们遇到的问题是缺乏关于 EBS 适配器的知识。我们遇到了从 EBS 系统接收信息的 BPEL 解决方案的一些问题。准备好解决方案的生产是一项艰巨的工作。

保护我们的网络服务不是一个大问题。Oracle 堆栈附带了 Oracle Web 服务管理器。有了它，我们可以保护、记录等所有网络服务。

我们遇到的最大问题是缺乏自己的标准。让企业感觉他们也可以构建 SOA 解决方案。我们无法解释他们从 SOA 解决方案中获得的好处。快点？不 ！更便宜？一定不行！更简单的解决方案？好吧，也许当我们获得良好的可重用服务时……好吧，那个更简单的部分有一个问题：我们如何知道哪些应用程序使用了可重用的 Web 服务？

我们需要一个可以显示此类信息的寄存器。因为我们找不到好的开源解决方案，所以我们正在尝试构建自己的寄存器。简单的 APEX 解决方案，同样来自 Oracle 堆栈。;)

那么有人知道注册这种信息的好产品吗？

# automation - 管道密码到 smbpasswd

> ID：12009
> 
> 赞同：33
> 
> 时间：2008-08-15T06:08:55.243
> 
> 标签：automation, installation, debian, samba

如何将新密码通过管道传输到 smbpasswd，以便自动执行安装过程。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-08-15T06:38:59.287

感谢马克，我找到了答案：

```
(echo newpassword; echo confirmNewPassword) | smbpasswd -s 
```

顺便说一句：（回声旧密码；回声新密码）| smbpasswd -s 不起作用。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-09-15T13:20:38.980

我在我的一个脚本中使用以下内容：

```
 echo -ne "$PASS\n$PASS\n" | smbpasswd -a -s $LOGIN 
```

有回声：

-e : 转义序列，如 \n

-n ：不要在末尾添加隐式换行符

使用 smbpasswd：

-a : 添加新用户

-s：沉默

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-08-15T06:31:29.427

尝试这样的事情：

```
(echo oldpasswd; echo newpasswd) | smbpasswd -s 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-11-04T14:47:40.153

用这个 `echo 'somepassword' | tee - | smbpasswd -s`

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2018-11-22T09:56:05.690

我不得不在 Puppet 5.x Exec 资源中创建一个新的 Samba 用户，但由于各种原因，上述方法都不起作用。幸运的是，这个看起来很傻的命令奏效了：

```
yes vagrant|head -n 2|smbpasswd -a -s vagrant 
```

这里的密码当然是“vagrant”。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-04-05T18:37:29.983

不幸的是，这不是可取的，原因有两个：1）如果用户在密码中使用了“\n”的组合，则输入将不匹配 2）如果系统上有 unix 用户，那么使用该实用程序的用户ps 可能会看到密码

更好的方法是将名称放在文件中并从文件中读取并使用 python pexpect 读取它们，不像下面那样，但简单的脚本足以了解如何使用 pexpect

```
#!/usr/bin/python
#converted from: http://pexpect.sourceforge.net/pexpect.html
#child = pexpect.spawn('scp foo myname@host.example.com:.')
#child.expect ('Password:')
#child.sendline (mypassword)
import pexpect
import sys
user=sys.argv[1]
passwd=sys.argv[2]
child = pexpect.spawn('/usr/bin/smbpasswd -a '+str(user))
child.expect('New SMB password:')
child.sendline (passwd)
child.expect ('Retype new SMB password:')
child.sendline (passwd) 
```

然后尝试： ./smbpasswd.py userName1 'f#@(&*(_\n895'

* * *

## 回答 #7

> 赞同：-4
> 
> 时间：2008-08-15T06:16:12.187

使用[管道](http://en.wikipedia.org/wiki/Pipeline_(Unix))或[重定向](http://en.wikipedia.org/wiki/Redirection_(Unix))。

# windows - 尝试读取转储时“无法加载符号”

> ID：12039
> 
> 赞同：7
> 
> 时间：2008-08-15T06:51:59.557
> 
> 标签：windows, windows-xp, crash-dumps, bsod

我有一个应用程序有时会在 Win XP 机器上导致蓝屏死机。为了了解更多信息，我加载了生成的 *.dmp 文件（来自 C:\Windows\Minidump），但是在执行此操作时在大部分读数中都会收到此消息：

```
*********************************************************************
* Symbols can not be loaded because symbol path is not initialized. *
*                                                                   *
* The Symbol Path can be set by:                                    *
*   using the _NT_SYMBOL_PATH environment variable.                 *
*   using the -y <symbol_path> argument when starting the debugger. *
*   using .sympath and .sympath+                                    *
********************************************************************* 
```

这是什么意思，我该如何“修复”它？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-08-15T10:56:39.937

我通常去系统控制面板，然后是高级选项卡，然后是环境。然后，您可以添加必要的`_NT_SYMBOL_PATH`变量。然后在运行 WinDbg 之前，您无需在命令行上执行任何操作。

`srv*C:\Windows\Symbols*http`:的设置`//msdl.microsoft.com/download/symbols`正如 Staffan 所建议的那样很好。不过，我通常更喜欢使用自己的配置文件来存储符号（这样我就不需要编辑 的权限`C:\Windows\Symbols`，因为我故意以受限用户身份运行，以保持良好的安全卫生）。因此（就我而言） my `_NT_SYMBOL_PATH`is `srv*C:\Documents and Settings\cky\symbols*http`: `//msdl.microsoft.com/download/symbols`。

希望这可以帮助。:-)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-08-15T08:24:51.630

快速回答是

c:\> 设置 _NT_SYMBOL_PATH=SRV*C:\WINDOWS\Symbols*http://msdl.microsoft.com/download/symbols

在启动windbg之前。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-09-29T16:02:08.550

更快的答案：

```
!symfix 
```

但它只影响当前的windbg/ntsd/cdb/kd。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-08-15T06:58:44.770

您实际上需要将符号下载到您的计算机，或者如果您在调试时在线，则将其配置为随时下载。

这是详细讨论此问题的链接：http: [//www.microsoft.com/whdc/DevTools/Debugging/debugstart.mspx](http://www.microsoft.com/whdc/DevTools/Debugging/debugstart.mspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-18T13:57:43.000

正如@Vaibhav 所指出的，您实际上需要下载符号并配置windbg 以使用它们。

还要注意以下几点： !sym 噪声——激活噪声符号加载 lm v——与“m”参数一起使用以查看已加载模块的信息。lme D sm - 列出所有没有符号的模块。

# c# - 对基于计时器的应用程序进行单元测试？

> ID：12045
> 
> 赞同：20
> 
> 时间：2008-08-15T07:02:45.993
> 
> 标签：c#, .net, unit-testing, timer

我目前正在用 C# 编写一个简单的、基于计时器的迷你应用程序，它每 k 秒执行一次操作 n 次。
我正在尝试采用测试驱动的开发风格，所以我的目标是对应用程序的所有部分进行单元测试。

所以，我的问题是：有没有一种对基于计时器的类进行单元测试的好方法？

正如我所看到的，问题在于测试执行的时间会非常长，这是一个很大的风险，因为它们必须等待很长时间才能发生所需的操作。
特别是如果想要真实的数据（秒），而不是使用框架允许的最小时间分辨率（1 毫秒？）。
我正在为动作使用模拟对象，以记录动作被调用的次数，这样动作几乎不需要时间。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-08-15T07:43:18.110

我所做的是模拟计时器以及当前系统时间，以便我的事件可以立即触发，但就被测代码而言，经过的时间是几秒钟。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-08-15T21:01:50.173

[Len Holgate](http://www.lenholgate.com/)有[20 篇关于测试基于计时器的代码](http://www.lenholgate.com/archives/000306.html)的系列文章。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-08-15T07:09:04.780

我认为在这种情况下我要做的是测试计时器滴答时实际执行的代码，而不是整个序列。您真正需要决定的是是否值得您测试应用程序的实际行为（例如，如果每个滴答从一个滴答到另一个滴答发生剧烈变化之后发生的情况），或者是否足够（也就是说，每次的动作都是一样的）来测试你的逻辑。

由于定时器的行为保证永远不会改变，它要么正常工作（即，你配置正确）要么不正常；如果您实际上不需要，将其包含在您的测试中似乎是浪费精力。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-15T21:28:51.710

我同意 Danny 的观点，因为从单元测试的角度来看，简单地忘记计时器机制并验证操作本身是否按预期工作可能是有意义的。我还要说我不同意，将计时器的配置包含在某种自动化测试套件中是浪费精力。在使用计时应用程序时有很多边缘情况，并且很容易通过只测试易于测试的东西来产生错误的安全感。

我建议有一套运行计时器以及实际操作的测试。该套件可能需要一段时间才能运行，而且您可能不会一直在本地计算机上运行。但是在夜间自动构建中设置这些类型的东西可以真正帮助在错误变得难以找到和修复之前根除错误。

所以简而言之，我对你的问题的回答是不要担心编写一些需要很长时间才能运行的测试。尽可能进行单元测试，使测试套件快速且频繁地运行，但请确保使用运行频率较低但涵盖更多应用程序及其配置的集成测试来补充这一点。

# c# - 在 C# 中调用基本构造函数

> ID：12051
> 
> 赞同：1727
> 
> 时间：2008-08-15T07:39:23.097
> 
> 标签：c#, .net, inheritance, constructor

如果我从基类继承并想将继承类的构造函数中的某些内容传递给基类的构造函数，我该怎么做？

例如，如果我从 Exception 类继承，我想做这样的事情：

```
class MyExceptionClass : Exception
{
     public MyExceptionClass(string message, string extraInfo)
     {
         //This is where it's all falling apart
         base(message);
     }
} 
```

基本上我想要的是能够将字符串消息传递给基异常类。

* * *

## 回答 #1

> 赞同：2093
> 
> 时间：2008-08-15T07:40:22.157

将您的构造函数修改为以下内容，以便它正确调用基类构造函数：

```
public class MyExceptionClass : Exception
{
    public MyExceptionClass(string message, string extrainfo) : base(message)
    {
        //other stuff here
    }
} 
```

请注意，构造函数不是您可以在方法中随时调用的东西。这就是您在构造函数主体中的调用中遇到错误的原因。

* * *

## 回答 #2

> 赞同：590
> 
> 时间：2010-04-28T17:34:20.497

请注意，您可以在对基本构造函数的调用中使用**静态方法。**

```
class MyExceptionClass : Exception
{
     public MyExceptionClass(string message, string extraInfo) : 
         base(ModifyMessage(message, extraInfo))
     {
     }

     private static string ModifyMessage(string message, string extraInfo)
     {
         Trace.WriteLine("message was " + message);
         return message.ToLowerInvariant() + Environment.NewLine + extraInfo;
     }
} 
```

* * *

## 回答 #3

> 赞同：114
> 
> 时间：2013-02-27T02:22:07.103

如果您需要调用基本构造函数但不是立即调用，因为您的新（派生）类需要进行一些数据操作，最好的解决方案是诉诸工厂方法。您需要做的是将派生构造函数标记为私有，然后在您的类中创建一个静态方法，该方法将完成所有必要的工作，然后调用构造函数并返回对象。

```
public class MyClass : BaseClass
{
    private MyClass(string someString) : base(someString)
    {
        //your code goes in here
    }

    public static MyClass FactoryMethod(string someString)
    {
        //whatever you want to do with your string before passing it in
        return new MyClass(someString);
    }
} 
```

* * *

## 回答 #4

> 赞同：44
> 
> 时间：2013-11-11T11:32:42.350

确实使用`base`(something) 调用基类构造函数，但在重载的情况下使用`this`关键字

```
public ClassName() : this(par1,par2)
{
// do not call the constructor it is called in the this.
// the base key- word is used to call a inherited constructor   
} 

// Hint used overload as often as needed do not write the same code 2 or more times 
```

* * *

## 回答 #5

> 赞同：32
> 
> 时间：2009-12-04T05:03:34.580

```
public class MyExceptionClass : Exception
{
    public MyExceptionClass(string message,
      Exception innerException): base(message, innerException)
    {
        //other stuff here
    }
} 
```

您可以将内部异常传递给构造函数之一。

* * *

## 回答 #6

> 赞同：22
> 
> 时间：2016-01-24T07:34:21.750

**来自[框架设计指南](https://books.google.co.th/books?id=39d1wZ598ecC&pg=PT394&lpg=PT394&dq=exception%20fxcop&source=bl&ots=bO6nGDVi4f&sig=DFZ7ucCPK__LvIzTVaTSZ2rlXpY&hl=fr&sa=X&ved=0ahUKEwi88-qO9MHKAhUPH44KHVmdCh8Q6AEIUDAG#v=onepage&q=exception%20fxcop&f=false)和 FxCop 规则。**：

**1.自定义异常应该有一个以异常结尾的名字**

```
 class MyException : Exception 
```

**2.异常应该是公开的**

```
 public class MyException : Exception 
```

**3\. [CA1032：异常应该实现标准构造函数。](https://msdn.microsoft.com/en-us/library/ms182151.aspx)**

*   公共无参数构造函数。
*   带有一个字符串参数的公共构造函数。
*   具有一个字符串和异常的公共构造函数（因为它可以包装另一个异常）。
*   如果类型不是密封的，则序列化构造函数受保护，如果类型是密封的，则为私有。基于[MSDN](https://msdn.microsoft.com/en-us/library/ms182151.aspx)：

    ```
    [Serializable()]
    public class MyException : Exception
    {
      public MyException()
      {
         // Add any type-specific logic, and supply the default message.
      }

      public MyException(string message): base(message) 
      {
         // Add any type-specific logic.
      }
      public MyException(string message, Exception innerException): 
         base (message, innerException)
      {
         // Add any type-specific logic for inner exceptions.
      }
      protected MyException(SerializationInfo info, 
         StreamingContext context) : base(info, context)
      {
         // Implement type-specific serialization constructor logic.
      }
    } 
    ```

或者

```
 [Serializable()]
    public sealed class MyException : Exception
    {
      public MyException()
      {
         // Add any type-specific logic, and supply the default message.
      }

      public MyException(string message): base(message) 
      {
         // Add any type-specific logic.
      }
      public MyException(string message, Exception innerException): 
         base (message, innerException)
      {
         // Add any type-specific logic for inner exceptions.
      }
      private MyException(SerializationInfo info, 
         StreamingContext context) : base(info, context)
      {
         // Implement type-specific serialization constructor logic.
      }
    } 
```

* * *

## 回答 #7

> 赞同：20
> 
> 时间：2016-05-27T21:27:43.060

您还可以对构造函数中的参数进行条件检查，这具有一定的灵活性。

```
public MyClass(object myObject=null): base(myObject ?? new myOtherObject())
{
} 
```

或者

```
public MyClass(object myObject=null): base(myObject==null ? new myOtherObject(): myObject)
{
} 
```

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2017-03-14T12:38:53.823

根据此处列出的其他一些答案，您可以将参数传递给基类构造函数。建议在继承类的构造函数的开头调用基类构造函数。

```
public class MyException : Exception
{
    public MyException(string message, string extraInfo) : base(message)
    {
    }
} 
```

我注意到在您的示例中您从未使用过`extraInfo`参数，因此我假设您可能希望将`extraInfo`字符串参数连接到`Message`异常的属性（似乎在接受的答案和问题中的代码中忽略了这一点） .

这只需调用基类构造函数，然后使用额外信息更新 Message 属性即可实现。

```
public class MyException: Exception
{
    public MyException(string message, string extraInfo) : base($"{message} Extra info: {extraInfo}")
    {
    }
} 
```

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2016-04-07T12:06:09.330

```
public class MyException : Exception
{
    public MyException() { }
    public MyException(string msg) : base(msg) { }
    public MyException(string msg, Exception inner) : base(msg, inner) { }
} 
```

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2020-03-12T15:37:45.557

使用较新的 C# 功能，即`out var`，您可以摆脱静态工厂方法。我刚刚（偶然）发现称为 inse base-"call" 的方法的 out var 参数流向构造函数主体。

例如，使用您要从中派生的这个基类：

```
public abstract class BaseClass
{
    protected BaseClass(int a, int b, int c)
    {
    }
} 
```

您要执行的非编译伪代码：

```
public class DerivedClass : BaseClass
{
    private readonly object fatData;

    public DerivedClass(int m)
    {
        var fd = new { A = 1 * m, B = 2 * m, C = 3 * m };
        base(fd.A, fd.B, fd.C); // base-constructor call
        this.fatData = fd;
    }
} 
```

解决方案是使用静态私有辅助方法，该方法生成所有必需的基本参数（如果需要，还可以添加其他数据），并且不使用静态工厂方法，只需向外部构造简单的构造函数：

```
public class DerivedClass : BaseClass
{
    private readonly object fatData;

    public DerivedClass(int m)
        : base(PrepareBaseParameters(m, out var b, out var c, out var fatData), b, c)
    {
        this.fatData = fatData;
        Console.WriteLine(new { b, c, fatData }.ToString());
    }

    private static int PrepareBaseParameters(int m, out int b, out int c, out object fatData)
    {
        var fd = new { A = 1 * m, B = 2 * m, C = 3 * m };
        (b, c, fatData) = (fd.B, fd.C, fd); // Tuples not required but nice to use
        return fd.A;
    }
} 
```

# .net - 我应该担心混淆我的 .NET 代码吗？

> ID：12075
> 
> 赞同：26
> 
> 时间：2008-08-15T08:36:19.783
> 
> 标签：.net, obfuscation

我相信 SO 上的许多读者都使用[Lutz Roeder](https://www.lutzroeder.com/dotnet/)的[.NET 反射器](http://www.reflector.net/)来反编译他们的 .NET 代码。我很惊讶我们的源代码可以多么准确地从我们编译的程序集中重建。

我很想知道你们中有多少人使用混淆技术，以及用于什么类型的产品？

我敢肯定，对于您提供通过 Internet 下载的 .NET 应用程序来说，这是一个更重要的问题，而不是为特定客户端定制的应用程序。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-08-15T08:39:57.140

我不会担心太多。我宁愿专注于推出一个很棒的产品，获得良好的用户群，并正确对待你的客户，而不是担心担心窃取你的代码或查看源代码的用户比例最低。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-08-15T16:46:02.810

请记住，混淆不是加密。恕我直言，如果有人认为对您的代码进行逆向工程的价值，他们就会这样做。无论是否经过混淆，托管代码或本机代码都是如此。当然，混淆会阻止不经意的观察者，但您的业务真的受到这些人的威胁吗？我见过的每一种 .NET 混淆方法都会让您作为开发人员的生活更加艰难。

有些服务可以提供真正的加密，例如 Microsoft 的 SLPS。请参阅[http://www.microsoft.com/slps/default.aspx](http://www.microsoft.com/slps/default.aspx)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-08-15T09:00:43.463

我们目前混淆了我们所有的输出，尽管我们是一家向少数客户销售专业软件的小公司。

我们做出这个决定的原因很简单——我们发现一位心怀不满的前雇员正在积极接近我们的客户请求二进制文件——有人担心他打算对更新的功能进行逆向工程以提供竞争功能。

当然，如果他使用该软件，他仍然可以做到这一点，但没有理由让他轻松。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-08-15T09:14:09.270

没有新的混淆，但自 1.1 以来有很多编译器技巧

例如，每次你使用匿名类型时，你都会得到一个用相当晦涩的名字编译回来的 IL。每次使用 yield 时，您都会得到一个实现 IEnumerable 和 IEnumerator 的全新类（巧妙的优化，不可读的代码）。每次使用匿名委托时，都会得到一个新方法，其名称在我所知道的每种 .Net 语言中都是无效的，但在 IL 中这很好。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-08-15T12:54:55.680

@罗伯·库珀

> 在工作中与我的经理进行了一些讨论后，他说他不会混淆，但会在安装时使用 NGEN，显然这应该足以阻止 Reflector 处理您的程序集，但我不知道这是否属实以及在多大程度上，所以请不要把它当作福音:)

这不提供任何形式的反拆卸保护。首先，我想从任何安装包（如 MSI 或 CAB 文件）中提取原始文件是很可能的。

但更重要的是，Ngen 在安装程序集后在客户端计算机上运行。Ngen 只是强制程序集现在编译，而不是稍后使用 JIT。原始程序集保留且未修改，它必须保留，因为 Ngen 可能无法编译整个程序集。

Ngen 是为了性能，而不是安全性，并且不会阻止拆卸或使其更加困难。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-08-15T08:38:23.787

对我来说很容易——如果你需要保护知识产权——混淆——如果不是的话。

使用正确的工具很容易做到。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-08-15T08:39:54.330

我认为在某种程度上我们都应该担心我们的 IP :)

很好的问题，尽管我很想了解更多（我目前**不**混淆）。

在工作中与我的经理进行了一些讨论后，他说他不会混淆，但会在安装时使用 NGEN，显然这应该足以阻止 Reflector 处理您的程序集，但我不知道这是否属实以及在多大程度上，所以请不要把它当作福音:)

好问题:) +1

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-15T16:59:42.077

我们不对“非公开”应用程序使用混淆，但我们将其用于公开可用的应用程序。混淆的应用程序包含大量高度复杂的代码，这花费了我们大量的时间来编写，这就是让我认为混淆是必须的原因——至少在这种情况下是这样。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-15T17:07:25.250

迷惑的有效性是有限的，它可能会使随便的人远离。最有效的混淆是只向用户提供最少量的代码。如果可以的话，让你的应用程序在很大程度上依赖于胖服务器。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-01-22T19:41:36.013

同意，大多数懂一点代码的人都不需要窃取你的代码！

# java - 您是否混淆了您的商业 Java 代码？

> ID：12088
> 
> 赞同：51
> 
> 时间：2008-08-15T08:55:28.997
> 
> 标签：java, obfuscation

我想知道是否有人在他自己的商业产品上使用商业/免费的 java 混淆器。我只知道一个项目在发布的 ant 构建步骤中实际上有一个混淆步骤。

你混淆视听吗？如果是这样，你为什么要混淆？

这真的是一种保护代码的方法，还是只是对开发人员/经理来说更好的感觉？

**编辑：**好的，我要准确地说出我的观点：您是否为了保护您的 IP（您的算法，您在产品中投入的工作）而进行混淆处理？出于安全原因，我不会混淆，这感觉不对。所以我只是在谈论保护您的应用程序代码免受竞争对手的侵害。

[@staffan](https://stackoverflow.com/users/988/staffan)有一个很好的观点：

> 远离链接代码流的原因是，其中一些更改使 JVM 无法有效地优化代码。实际上，它实际上会降低应用程序的性能。

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2008-08-15T10:57:31.463

如果您进行了混淆，请远离通过更改代码流和/或添加异常块等来修改代码的混淆器，从而使其难以反汇编。为了使代码不可读，通常只需更改方法、字段和类的所有名称即可。

远离更改代码流的原因是，其中一些更改使 JVM 无法有效地优化代码。实际上，它实际上会降低应用程序的性能。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2012-04-13T08:00:02.973

我认为混淆的旧（经典）方式正在逐渐失去其相关性。因为在大多数情况下，经典混淆器会破坏堆栈跟踪（它不利于支持您的客户）

现在的重点不是保护某些算法，而是保护敏感数据：API 登录名/密码/密钥，负责许可的代码（盗版仍然存在，尤其是西欧，俄罗斯，亚洲，恕我直言），广告帐户 ID 等.

有趣的事实：我们在字符串中拥有所有这些敏感数据。实际上，字符串约占我们应用程序逻辑的 50-80%。在我看来，混淆的未来是“字符串加密工具”。

但现在“字符串加密”功能仅在商业混淆器中可用，例如：[Allatori](http://www.allatori.com/)、[Zelix KlassMaster](http://www.zelix.com/klassmaster/index.html)、[Smokescreen](http://www.leesw.com/smokescreen/)、[Stringer Java Obfuscation Toolkit](https://jfxstore.com/stringer)、[DashO](http://www.preemptive.com/)。

注意，我是 Licel LLC 的首席执行官。Stringer Java 混淆器的开发者。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-08-15T09:29:07.790

我使用 proguard 进行 JavaME 开发。它不仅非常擅长使 jar 文件更小（对于移动设备来说必不可少），而且它还可以作为一种更好的方式来编写特定于设备的代码，而无需使用对 IDE 不友好的预处理工具，例如天线。

例如

```
public void doSomething()
{
    /* Generated config class containing static finals: */
    if (Configuration.ISMOTOROLA)
    {
        System.out.println("This is a motorola phone");
    }
    else
    {
        System.out.println("This is not a motorola phone");
    }
} 
```

这会被编译、混淆，并且类文件最终就像您编写的一样：

```
public void doSomething()
{
    System.out.println("This is a motorola phone");
} 
```

因此，您可以使用代码变体来解决 JVM/库实现中的制造商错误，而无需增加最终的可执行类文件。

我相信一些商业混淆器在某些情况下也可以将类文件合并在一起。这很有用，因为您拥有的类越多，您在 zip (jar) 文件中的大小开销就越大。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-09-21T07:23:26.520

今年我花了一些时间尝试各种 Java 混淆器，我发现其中一个比其他混淆器领先几英里：[JBCO](http://www.sable.mcgill.ca/JBCO/)。不幸的是，它设置起来有点麻烦，并且没有 GUI，但就它产生的混淆程度而言，它是无与伦比的。你尝试给它一个简单的循环，如果你的反编译器在尝试加载它时没有崩溃，你会看到如下内容：

```
 if(i < ll1) goto _L6; else goto _L5
_L5:
    char ac[] = run(stop(lI1l));
    l7 = (long)ac.length << 32 & 0xffffffff00000000L ^ l7 & 0xffffffffL;
    if((int)((l7 & 0xffffffff00000000L) >> 32) != $5$)
    {
        l = (long)III << 50 & 0x4000000000000L ^ l & 0xfffbffffffffffffL;
    } else
    {
        for(l3 = (long)III & 0xffffffffL ^ l3 & 0xffffffff00000000L; (int)(l3 & 0xffffffffL) < ll1; l3 = (long)(S$$ + (int)(l3 & 0xffffffffL)) ^ l3 & 0xffffffff00000000L)
        {
            for(int j = III; j < ll1; j++)
            {
                l2 = (long)actionevent[j][(int)(l3 & 0xffffffffL)] & 65535L ^ l2 & 0xffffffffffff0000L;
                l6 = (long)(j << -351) & 0xffffffffL ^ l6 & 0xffffffff00000000L;
                l1 = (long)((int)(l6 & 0xffffffffL) + j) & 0xffffffffL ^ l1 & 0xffffffff00000000L;
                l = (long)((int)(l1 & 0xffffffffL) + (int)(l3 & 0xffffffffL)) << 16 & 0xffffffff0000L ^ l & 0xffff00000000ffffL;
                l = (long)ac[(int)((l & 0xffffffff0000L) >> 16)] & 65535L ^ l & 0xffffffffffff0000L;
                if((char)(int)(l2 & 65535L) != (char)(int)(l & 65535L))
                {
                    l = (long)III << 50 & 0x4000000000000L ^ l & 0xfffbffffffffffffL;
                }
            }

        }

    } 
```

你不知道 Java 有 goto 的吗？好吧，JVM 支持它们 =)

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2009-05-02T07:32:26.430

我使用[ProGuard](http://proguard.sourceforge.net)并强烈推荐它。虽然混淆确实可以保护您的代码免受临时攻击者的攻击，但它的主要好处是最大程度地减少了删除未使用的类和方法并将所有标识符缩短为 1 或 2 个字符的影响。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2009-05-16T06:39:12.183

我认为在大多数情况下，混淆是没有意义的：即使有完整的源代码，通常也很难弄清楚到底是什么意图（假设没有注释，也没有对局部变量有意义的名称——当重新- 从字节码生成源）。混淆只是装饰蛋糕。

我认为开发人员，尤其是他们的经理往往会过分夸大有人看到源代码的风险。虽然好的反编译器可以生成漂亮的源代码，但使用它并非易事，并且相关的成本（更不用说法律风险）高到足以使这种方法很少有用。我只反编译以调试闭源供应商产品的问题（数据库抽象层中的死锁，呃）。我认为字节码实际上被混淆了，但我们仍然发现了根本问题——这是一个实际的设计问题。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-08-15T09:22:45.320

我想这真的取决于*你*的 Java 代码的用途、它的分布方式以及你的客户是谁。我们不会混淆任何东西，因为我们从来没有找到一个特别好的东西，而且它往往比它的价值更麻烦。如果有人可以访问我们的 JAR 文件并且知道能够嗅探其中的内容，那么他​​们可以做的事情远比窃取我们的源代码更令人担忧。

# windows - Windows 窗体线程和事件 - ListBox 及时更新，但进度条出现巨大延迟

> ID：12095
> 
> 赞同：4
> 
> 时间：2008-08-15T09:19:04.050
> 
> 标签：windows, multithreading, events, forms, delegates

我们的团队正在创建一个新的招聘工作流程系统来替换旧的。我的任务是将旧数据迁移到新模式中。我决定通过创建一个小型 Windows 窗体项目来做到这一点，因为架构完全不同，直接的 TSQL 脚本不是一个合适的解决方案。

完成这项工作的主要密封类“ImportController”声明了以下委托事件：

```
public delegate void ImportProgressEventHandler(object sender, ImportProgressEventArgs e);
public static event ImportProgressEventHandler importProgressEvent; 
```

主窗口使用新线程在该类中启动一个静态方法：

```
Thread dataProcessingThread = new Thread(new ParameterizedThreadStart(ImportController.ImportData));
dataProcessingThread.Name = "Data Importer: Data Processing Thread";
dataProcessingThread.Start(settings); 
```

ImportProgressEvent 参数携带字符串消息、进度条的最大 int 值和当前进度 int 值。Windows 窗体订阅该事件：

```
ImportController.importProgressEvent += new ImportController.ImportProgressEventHandler(ImportController_importProgressEvent); 
```

并使用它自己的委托以这种方式响应事件：

```
 private delegate void TaskCompletedUIDelegate(string completedTask, int currentProgress, int progressMax);

private void ImportController_importProgressEvent(object sender, ImportProgressEventArgs e)
            {
                this.Invoke(new TaskCompletedUIDelegate(this.DisplayCompletedTask), e.CompletedTask, e.CurrentProgress, e.ProgressMax);
            } 
```

最后更新进度条和列表框：

```
private void DisplayCompletedTask(string completedTask, int currentProgress, int progressMax)
        {
            string[] items = completedTask.Split(new string[] { Environment.NewLine }, StringSplitOptions.RemoveEmptyEntries);

            foreach (string item in items)
            {
                this.lstTasks.Items.Add(item);
            }

            if (currentProgress >= 0 && progressMax > 0 && currentProgress <= progressMax)
            {
                this.ImportProgressBar.Maximum = progressMax;
                this.ImportProgressBar.Value = currentProgress;
            }
        } 
```

问题是 ListBox 似乎更新得很快，但进度条永远不会移动，直到批处理几乎完成？是什么赋予了 ？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-15T09:38:36.613

也许你可以试试 BackgroundWorker 组件。它使线程更容易。这里的例子：

*   [BackgroundWorker 线程和支持取消](http://www.codeproject.com/KB/cpp/BackgroundWorker_Threads.aspx)
*   [在 .NET 2 应用程序中使用 BackgroundWorker 组件](http://www.c-sharpcorner.com/UploadFile/LivMic/BGWorker07032007000515AM/BGWorker.aspx)
*   [BackgroundWorker 示例](http://www.danielmoth.com/Blog/2004/12/backgroundworker-sample.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-15T09:58:15.797

也许超出了范围，但有时它有助于`Application.DoEvents();`使 gui 部件对用户输入做出反应，例如按下状态栏对话框上的取消按钮。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-15T10:01:57.550

您是否有机会运行 Windows Vista？我在一些与工作相关的应用程序中注意到了完全相同的事情。不知何故，进度条“动画”时似乎有延迟。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-15T10:07:06.447

@约翰

感谢您的链接。

@将要

线程池没有任何好处，因为我知道它只会产生一个线程。线程的使用纯粹是为了在 SQL Server 受到读写冲击的同时拥有响应式 UI。这当然不是一个短命的线程。

关于大锤，你是对的。但是，事实证明我的问题毕竟是在屏幕和椅子之间。我似乎有一批不寻常的数据，其外键记录比其他批次多得多，并且恰好在过程的早期被选中，这意味着 currentProgress 在 10 秒内没有得到 ++'d。

@全部

感谢您的所有输入，它让我思考，这让我在代码的其他地方寻找，这导致了我的谦逊时刻，我再次证明错误通常是人为的:)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-08-15T09:50:34.517

您确定 UI 线程在所有这些过程中都在自由运行吗？即它没有被阻塞在加入或其他等待中？这就是我的样子。

使用 BackgroundWorker 的建议是一个很好的建议 - 绝对优于尝试通过大量 Refresh/Update 调用来解决问题。

BackgroundWorker 将使用池线程，这比创建自己的短期线程更友好。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-08-15T10:20:01.663

> 线程池没有任何好处，因为我知道它只会产生一个线程。线程的使用纯粹是为了在 SQL Server 受到读写冲击的同时拥有响应式 UI。这当然不是一个短命的线程。

好的，我很感激，很高兴你发现了你的错误，但是你看过 BackgroundWorker 吗？它几乎与您正在做的事情完全相同，但是以标准化的方式（即没有您自己的委托）并且不需要创建新线程 - 这两者都是（可能很小，但可能仍然有用）的优点。

# perl - 为什么我的 Perl 映射不返回任何内容？

> ID：12103
> 
> 赞同：5
> 
> 时间：2008-08-15T09:38:31.250
> 
> 标签：perl, map

当我运行以下语句时：

```
@filtered = map {s/&nbsp;//g} @outdata; 
```

它返回一个空列表，而不是我期望的过滤列表。我要做的是`&nbsp;`从字符串数组（这是一个 XML 文件）中删除每次出现的 。

显然，我不明白一些事情。谁能告诉我这样做的正确方法可能是，为什么这对我不起作用？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-08-22T04:51:03.680

请注意， map 也将修改您的源数组。所以你可以这样做：

```
map {s/&nbsp;//g} @outdata; 
```

并完全跳过 @filtered 变量，或者如果您需要保留原件，

```
@filtered = @outdata;
map {s/&nbsp;//g} @filtered; 
```

虽然在这种情况下，使用 foreach 可能更具可读性：

```
s/&nbsp;//g foreach @filtered; 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-08-15T09:49:17.153

试试这个：

```
@filtered = map {s/&nbsp;//g; $_} @outdata; 
```

问题是 perl 中的 s 运算符修改了 $_ 但实际上返回了它所做的更改次数。因此，最后额外的 $_ 导致 perl 返回 @outdata 的每个元素的修改后的字符串。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-15T14:18:34.320

Greg 的答案有一个问题，即它会修改原始数组，因为 $_ 是通过别名传递的。你需要：

```
@filtered = map { (my $new = $_) =~ s/&nbsp;//g; $new} @outdata; 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-15T14:04:43.807

为了跟进 Tithonium 的观点，这也可以解决问题：

```
@filtered = map {local $_=$_; s/&nbsp;//g; $_} @outdata; 
```

“本地”确保您正在处理副本，而不是原件。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-05-18T17:31:29.930

在 perl 5.14 中，您可以使用*/r*正则表达式修饰符[进行非破坏性替换](http://perldoc.perl.org/perl5140delta.html#Regular-Expressions)。

```
@filtered = map {s/&nbsp;//gr} @outdata; 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-12-01T03:35:43.613

```
use Algorithm::Loops "Filter";
@filtered = Filter { s/&nbsp;//g } @outdata; 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-08-17T15:51:55.073

作为 Greg 答案的对立面，您可能会误用 grep：

```
@filtered = grep {s/&nbsp;//g; 1} @outdata; 
```

**不要这样做。**

# svn - 将 VisualSVN 服务器配置为使用 _svn 而不是 .svn

> ID：12107
> 
> 赞同：3
> 
> 时间：2008-08-15T09:47:38.110
> 
> 标签：svn, version-control, visualsvn-server

我们的构建服务器出现了问题，尽管我们认识到存在更改，但没有从源代码管理中检查修改。

它被追踪到控制文件夹（不确定它的真实名称是什么），现有的工作版本使用 _svn。清除工作文件夹会强制进行新的完整结帐，我注意到现在控制文件夹是 .svn。看起来我们的集成例程最初是使用 _svn 检查代码，但现在它使用的是 .svn。

*集成期间使用的 svn.exe 来自 VisualSVN 服务器，我可以将其设置为再次使用 _svn 吗？*

我不知道原始工作副本是如何使用 _svn 的！- 我们只使用过 VisualSVN 服务器并且没有改变它。

我们根据建议将 TortoiseSVN 设置为使用 _svn，这对 Visual Studio 更有效，并且还在构建服务器上安装了 TortoiseSVN，以备不时之需。这可能是原因吗？

*这真的有必要吗？由于 MSBuild 是 Microsoft 的，因此是否像 Visual Studio 那样推荐它？*

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-15T09:57:38.620

关于 _svn 与 .svn 的业务仅是 Visual Studio Web 项目的问题（而且我相当肯定它已在 VS2005 中修复），这不是一般的“_svn 与 VS 配合得更好”的事情。

这也只是一个工作副本问题，而不是存储库问题 - 即 SVN 的一些用户是否使用设置为执行 _svn 的客户端和一些使用 .svn 无关紧要 - 存储库不会知道或关心 - (除非您最终以某种方式最终将这些 _svn/.svn 文件加载到存储库中，这将是极端混乱的。）

除非您有绝对的具体证据表明 .SVN 给您带来了问题，否则我会尽可能地坚持这一点。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-15T09:50:59.587

我一直在将 .svn 与 Visual Studio 2008 和 2005 以及我们的 CC.Net 集成服务器（使用 MSBuild）一起使用，没有任何问题。我会坚持使用 .svn 格式。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-15T10:01:03.217

> [http://subversion.tigris.org/svn_1.3_releasenotes.html](http://subversion.tigris.org/svn_1.3_releasenotes.html)
> 
> 需要阅读“官方支持 Windows '_svn' 目录（客户端和语言绑定）”部分

并且需要注意您正在阅读几年前的文档，这可能是相关的，也可能不是相关的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-15T09:54:52.150

据我所知 _svn 是需要的，因为当 WebApplications 的一个目录以点开头时会出现问题。

# c# - FileNotFoundException for mscorlib.XmlSerializers.DLL, which doesn't exist

> ID：12135
> 
> 赞同：12
> 
> 时间：2008-08-15T11:03:30.157
> 
> 标签：c#, .net, serialization, assemblies

I'm using an XmlSerializer to deserialize a particular type in mscorelib.dll

```
XmlSerializer ser = new XmlSerializer( typeof( [.Net type in System] ) );
return ([.Net type in System]) ser.Deserialize( new StringReader( xmlValue ) ); 
```

This throws a caught `FileNotFoundException` when the assembly is loaded:

> "Could not load file or assembly 'mscorlib.XmlSerializers, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089' or one of its dependencies. The system cannot find the file specified."

FusionLog:

```
=== Pre-bind state information ===
LOG: User = ###
LOG: DisplayName = mscorlib.XmlSerializers, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089, processorArchitecture=x86
 (Fully-specified)
LOG: Appbase = file:///C:/localdir
LOG: Initial PrivatePath = NULL
Calling assembly : System.Xml, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089.
===
LOG: This bind starts in default load context.
LOG: Using application configuration file: C:\localdir\bin\Debug\appname.vshost.exe.Config
LOG: Using machine configuration file from c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\config\machine.config.
LOG: Post-policy reference: mscorlib.XmlSerializers, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089, processorArchitecture=x86
LOG: Attempting download of new URL file:///C:/localdir/bin/Debug/mscorlib.XmlSerializers.DLL.
LOG: Attempting download of new URL file:///C:/localdir/bin/Debug/mscorlib.XmlSerializers/mscorlib.XmlSerializers.DLL.
LOG: Attempting download of new URL file:///C:/localdir/bin/Debug/mscorlib.XmlSerializers.EXE.
LOG: Attempting download of new URL file:///C:/localdir/bin/Debug/mscorlib.XmlSerializers/mscorlib.XmlSerializers.EXE. 
```

As far as I know there is no mscorlib.XmlSerializers.DLL, I think the DLL name has bee auto generated by .Net looking for the serializer.

You have the option of creating a myApplication.XmlSerializers.DLL when compiling to optimise serializations, so I assume this is part of the framework's checking for it.

The problem is that this appears to be causing a delay in loading the application - it seems to hang for a few seconds at this point.

Any ideas how to avoid this or speed it up?

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-15T11:06:41.773

The delay is because, having been unable to find the custom serializer dll, the system is building the equivalent code (which is very time-consuming) on the fly.

The way to avoid the delay is to have the system build the DLL, and make sure it's available to the .EXE - have you tried this?

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-04T23:10:45.467

Okay, so I ran into this problem and have found a solution for it specific to my area.

This occurred because I was trying to serialize a list into an XML document (file) without an XML root attribute. Once I added the following files, the error goes away.

```
XmlRootAttribute rootAttribute = new XmlRootAttribute();
rootAttribute.ElementName = "SomeRootName";
rootAttribute.IsNullable = true; 
```

Dunno if it'll fix your problem, but it fixed mine.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-15T11:44:33.513

I'm guessing now. but:

1.  The system might be generating a serializer for the whole of mscorlib, which could be very slow.
2.  You could probably avoid this by wrapping the system type in your own type and serialising that instead - then you'd get a serializer for your own assembly.
3.  You might be able to build the serializer for mscorlib with sgen.exe, which was the old way of building serializer dlls before it got integrated into VS.

# language-agnostic - 访问全局应用程序设置

> ID：12140
> 
> 赞同：2
> 
> 时间：2008-08-15T11:12:35.240
> 
> 标签：language-agnostic, oop

我目前正在开发的一个数据库应用程序将各种设置存储在数据库中。这些设置中的大多数用于自定义某些业务规则，但其中也有一些其他的东西。

该应用程序包含专门执行某项任务的对象，例如某项复杂的计算。这些非 UI 对象是经过单元测试的，但也需要访问许多全局设置。我们现在实现这一点的方式是提供由应用程序控制器在运行时填充的对象属性。测试时，我们在测试中创建对象并填写测试值（不是来自数据库）。

这比让所有这些对象都需要一些全局*设置*对象更好——这当然有效地使单元测试变得不可能:) 缺点可能是您有时需要设置十几个属性，或者您需要让这些属性“渗透”到子对象中。

**所以一般的问题是**：你如何在你的项目中提供对全局应用程序设置的访问，而不需要全局变量，同时仍然能够对你的代码进行单元测试？这一定是一个已经解决了 100 次的问题......

（注意：我不是一个经验丰富的程序员，你会注意到的；但我喜欢学习！当然，我已经对这个主题进行了研究，但我真的想先找一些-手经验）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-15T12:25:19.483

您可以使用 Martin Fowlers ServiceLocator 模式。在 php 中它可能看起来像这样：

```
class ServiceLocator {
  private static $soleInstance;
  private $globalSettings;

  public static function load($locator) {
    self::$soleInstance = $locator;
  }

  public static function globalSettings() {
    if (!isset(self::$soleInstance->globalSettings)) {
      self::$soleInstance->setGlobalSettings(new GlobalSettings());
    }
    return self::$soleInstance->globalSettings;
  }
} 
```

然后，您的生产代码会像这样初始化服务定位器：

```
ServiceLocator::load(new ServiceLocator()); 
```

在您的测试代码中，您插入模拟设置，如下所示：

```
ServiceLocator s = new ServiceLocator();
s->setGlobalSettings(new MockGlobalSettings());
ServiceLocator::load(s); 
```

它是一个可以交换用于测试目的的单例存储库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-15T12:57:22.337

我喜欢使用服务定位器模式来模拟我的配置访问。这给了我一个点来获取我需要的任何配置值，并将其放在应用程序之外的单独库中，它允许重用和可测试性。这是一些示例代码，我不确定您使用的是什么语言，但我是用 C# 编写的。

首先，我创建一个通用类来模拟我的 ConfigurationItem。

```
public class ConfigurationItem<T>
{
    private T item;

    public ConfigurationItem(T item)
    {
        this.item = item;
    }

    public T GetValue()
    {
        return item;
    }
} 
```

然后，我创建了一个公开配置项的公共静态只读变量的类。在这里，我只是从配置文件中读取 ConnectionStringSettings，这只是 xml。当然，对于更多项目，您可以从任何来源读取值。

```
public class ConfigurationItems
{
    public static ConfigurationItem<ConnectionStringSettings> ConnectionSettings = new ConfigurationItem<ConnectionStringSettings>(RetrieveConnectionString());

    private static ConnectionStringSettings RetrieveConnectionString()
    {
        // In .Net, we store our connection string in the application/web config file.
        // We can access those values through the ConfigurationManager class.
        return ConfigurationManager.ConnectionStrings[ConfigurationManager.AppSettings["ConnectionKey"]];
    }
} 
```

然后，当我需要使用 ConfigurationItem 时，我会这样称呼它：

```
ConfigurationItems.ConnectionSettings.GetValue(); 
```

它会返回一个类型安全的值，然后我可以缓存或做任何我想做的事情。

这是一个示例测试：

```
[TestFixture]
public class ConfigurationItemsTest
{
    [Test]
    public void ShouldBeAbleToAccessConnectionStringSettings()
    {
        ConnectionStringSettings item = ConfigurationItems.ConnectionSettings.GetValue();
        Assert.IsNotNull(item);
    }
} 
```

希望这可以帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-15T11:44:52.217

通常这是由 ini 文件或 XML 配置文件处理的。然后你就有了一个在需要时读取设置的类。

.NET 内置了 ConfigurationManager 类，但它很容易实现，只需读取文本文件，或将 XML 加载到 DOM 或在代码中手动解析它们。

在数据库中有配置文件是可以的，但它确实将您与数据库联系起来，并为您的应用程序创建了 ini/xml 文件解决的额外依赖关系。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-15T12:20:26.450

我这样做了：

```
public class MySettings
{
    public static double Setting1
        { get { return SettingsCache.Instance.GetDouble("Setting1"); } }

    public static string Setting2
        { get { return SettingsCache.Instance.GetString("Setting2"); } }
} 
```

我把它放在一个单独的基础设施模块中，以消除循环依赖的任何问题。
这样做我不依赖于任何特定的配置方法，并且在我的应用程序代码中没有运行严重破坏的字符串。

# database - 您在生产中发生的最严重的数据库事故是什么？

> ID：12141
> 
> 赞同：6
> 
> 时间：2008-08-15T11:13:53.070
> 
> 标签：database, production

例如：更新客户表的所有行，因为您忘记添加 where 子句。

1.  意识到它并将其报告给您的同事或客户是什么感觉？
2.  吸取了哪些教训？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-08-15T11:28:08.407

我认为我最大的错误是

```
truncate table Customers
truncate table Transactions 
```

我没有看到我登录的 MSSQL 服务器，我想清除我的本地副本...熟悉的“哦 s**t”，当删除时间明显超过大约半秒时，我的老板注意到我去了明显的白色，并问我刚刚做了什么。大约半分钟后，我们的站点监视器发疯了，并开始给我们发电子邮件说站点已关闭。

学过的知识？永远不要让实时数据库的连接打开时间超过绝对需要的时间。

直到凌晨 4 点才从备份中恢复数据！老板对不起我，请我吃饭...

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-08-15T13:17:26.040

我在一家小型电子商务公司工作，有 2 名开发人员和一名 DBA，我是其中一名开发人员。我通常不习惯即时更新生产数据，如果我们已经更改了存储过程，我们会将它们通过源代码控制并进行正式部署例程设置。

无论如何，一个用户来找我需要对我们的联系人数据库进行更新，批量更新一堆设施。所以我在我们的测试环境中写出了查询，比如

```
update facilities set address1 = '123 Fake Street'
    where facilityid in (1, 2, 3) 
```

类似的东西。在测试中运行它，更新了 3 行。将其复制到剪贴板，将其粘贴到我们的生产 sql 框上的终端服务中，运行它，惊恐地看着它花了 5 秒执行并更新了 100000 行。不知何故，我复制了第一行而不是第二行，并且没有注意我`CTRL`+ `V`, `CTRL`+ `E`'d。

我的 DBA，一位年长的希腊绅士，可能是我见过的最脾气暴躁的人，他并不激动。幸运的是，我们有一个备份，它没有破坏任何页面，幸运的是该字段仅用于显示目的（和计费/运输）。

吸取的教训是注意您正在复制和粘贴的内容，可能还有其他一些内容。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-08-15T11:20:21.573

初级 DBA 打算：

```
delete from [table] where [condition] 
```

相反，他们键入：

```
delete [table] where [condition] 
```

哪个是有效的 T-Sql 但基本上完全忽略了 where [condition] 位（至少在 MSSQL 2000/97 上确实如此——我忘记了）并擦除了整个表。

那很有趣 ：-/

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-08-15T15:46:59.577

大约 7 年前，我在工作到很晚后正在为客户的数据库生成更改脚本。我只更改了存储过程，但是当我生成 SQL 时，我检查了“脚本相关对象”。我在本地机器上运行它，一切似乎都运行良好。我在客户端的服务器上运行它并且脚本成功了。

然后我加载了网站，网站是空的。令我惊恐的是，“脚本相关对象”设置`DROP TABLE`为我的存储过程所触及的每个表都做了一个。

我立即打电话给首席开发人员和老板，让他们知道发生了什么，并询问最新的数据库备份在哪里。其他 2 位开发人员参加了会议，我们得出的结论是，甚至没有备份系统，也无法恢复数据。客户丢失了他们整个网站的内容，我是根本原因。结果是我们的客户获得了**5000 美元的信用额度。**

对我来说，这是一个很好的教训，现在我对运行任何更改脚本以及首先备份数据库都非常谨慎。我今天仍然在同一家公司工作，每当关于备份或数据库脚本的笑话出现时，总会有人提出著名的“DROP TABLE”事件。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-11-23T22:20:58.693

大意是：

> `update email set processedTime=null,sentTime=null`

在生产时事通讯数据库上，重新发送数据库中的每封电子邮件。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-08-15T14:39:26.547

我曾经设法编写一个从未退出的更新游标。在 2M+ 行表上。锁定不断升级，直到这个 16 核、8GB RAM（在 2002 年！）盒子实际上停止了（蓝屏类型）。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-08-15T14:20:12.917

```
update Customers set ModifyUser = 'Terrapin' 
```

我忘记了 where 子句 - 很无辜，但在有 5000 多个客户的桌子上，我的名字将在一段时间内出现在每条记录上......

经验教训：使用事务提交和回滚！

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-08-15T18:02:40.613

我们试图修复 Oracle 集群上的损坏节点。

存储管理模块出现问题，因此我们单击了卸载按钮，目的是重新安装并从另一个节点复制配置。

嗯，原来卸载按钮是应用于整个集群的，所以它兴高采烈地从系统中的所有节点上移除了存储管理模块。

导致生产集群中的每个节点崩溃。而且由于没有一个节点有存储管理器，所以它们不会出现！

这是关于备份的一个有趣的事实……最旧的备份在异地轮换，您知道数据库上最旧的文件是什么吗？安装系统时设置的配置文件。

所以我们不得不让异地的人派快递员带着那个磁带，几个小时后，我们重新安装并运行了所有东西。现在我们保留安装和配置文件的本地副本！

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-24T16:58:55.003

I don't remember all the sql statements that ran out of control but I have one lesson learned - **do it in a transaction** if you can (beware of the big logfiles!).

In production, if you can, proceed the old fashioned way:

1.  Use a maintenance window
2.  Backup
3.  Perform your change
4.  **verify**
5.  restore if something went wrong

Pretty uncool, but generally working and even possible to give this procedure to somebody else to run it during their night shift while you're getting your well deserved sleep :-)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-08-15T16:00:13.683

我以为我在测试数据库中工作（显然不是这样），所以当我完成“测试”时，我运行一个脚本将*所有*数据重置回我们使用的标准测试数据......哎呀！
幸运的是，这发生在一个有备份的数据库上，所以在发现我做错了什么之后，我们可以轻松地恢复原始数据库。

然而这件事确实教会了我工作的公司*真正*分离生产和测试环境。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-11-23T21:59:26.710

我完全按照你的建议做了。我更新了包含客户文档的表中的所有行，因为我忘记在末尾添加“where ID = 5”。那是个错误。

但我既聪明又偏执。我知道我有一天会搞砸的。我已经发出了“开始交易”。我发出回滚，然后检查表是否正常。

**不是。**

生产中的经验教训：尽管我们喜欢在 MySQL 中使用 InnoDB 表有很多原因......请确保您没有设法找到少数不尊重事务并且您无法滚动的 MyISAM 表之一重新开始。任何情况下都不要相信MySQL，习惯性地发出“启动事务”是好事。即使在最坏的情况下（这里发生的事情）它也没有伤害任何东西，它会在 InnoDB 表上保护我。

我不得不从备份中恢复表。幸运的是，我们有每晚的备份，数据几乎从不改变，而且表格有几十行，所以几乎是即时的。作为参考，没有人知道我们周围还有非 InnoDB 表，我们以为我们早就转换了它们。没有人告诉我要注意这个问题，没有人知道它的存在。我的老板也会做同样的事情（如果他在输入 where 子句之前过早地按了 enter）。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-08-15T11:15:45.483

我删除了实时数据库并将其删除。

经验教训：确保你知道你的 SQL - 并确保在你接触东西之前备份。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-08-15T11:22:33.643

我发现我不理解 Oracle 重做日志文件（术语？这是很久以前的事了）并且丢失了一周的交易数据，这些数据必须从纸质票据中手动重新输入。

有一线希望——在我输入的周末，我学到了很多关于我的交易输入屏幕的可用性，此后显着改善*。*

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-08-15T11:30:17.903

对于大多数人来说，最糟糕的情况是生产数据丢失，但如果他们不运行夜间备份或将数据复制到 DR 站点，那么他们应得的一切！

@[在 T-SQL 中，对于DELETE](https://stackoverflow.com/questions/12141/whats-your-worst-database-accident-happened-in-production#12145)，FROM 关键字不是可选的吗？这两个语句的作用完全相同......

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-08-22T05:23:10.310

> 更新客户表的所有行，因为您忘记添加 where 子句。

那正是我所做的：| . 我已将所有用户的密码列更新为我在控制台上键入的示例字符串。最糟糕的部分是我正在访问生产服务器，并且在执行此操作时正在检查一些查询。然后，我的前辈不得不恢复旧的备份，并且不得不接听一些非常不满的客户的电话。当然还有一次我确实使用了 delete 语句，我什至不想谈论它;-)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-08-15T13:23:23.267

发生在我身上的最糟糕的事情是生产服务器占用了 HD 中的所有空间。我使用的是 SQL Server，所以我看到了数据库文件并看到日志大约为 10 Gb，所以我决定做我想要截断日志文件时一直做的事情。我做了分离删除日志文件，然后再次附加。好吧，我意识到如果日志文件未正确关闭，此过程将不起作用。所以我最终得到一个 mdf 文件而没有日志文件。谢天谢地，我去了微软网站，我找到了一种方法来恢复数据库作为恢复并移动到另一个数据库。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-11-23T20:48:57.770

这没有发生在我身上，只是我们的一个客户，我不得不清理他的烂摊子。

他们有一个在 RAID5 磁盘阵列上运行的 SQL 服务器 - 不错的热插拔驱动器，配有发光的磁盘状态指示器。绿色 = 好，红色 = 坏。

他们的一个驱动器从绿色变为红色，而被告知要拔出并更换（红色）坏驱动器的天才取而代之的是（绿色）好驱动器。好吧，这并没有完全降低raid集-在几分钟内选择了一些可读的（红色）与不可用的（绿色）..在意识到错误并将驱动器交换回在此期间写入的任何数据块之后由于磁盘同步丢失，时间变得乱七八糟）...... 24 小时后，编写元程序来恢复可读数据并重建他们备份并运行的中等大小的模式。

这个故事的寓意包括......永远不要使用 RAID5，始终保持备份，小心你雇用的人。

我曾经在客户的生产系统上犯了一个重大错误——幸运的是，当我想知道为什么命令需要这么长时间才能执行时，我意识到我做了什么，并在世界末日之前取消了它。

这个故事的寓意包括……在改变任何东西之前总是开始一个新的事务，测试结果是你所期望的，然后才提交事务。

作为一般观察，可以通过在架构上正确定义外键约束并远离任何标有“CASCADE”的命令来防止许多类别的 rm -rf / 类型错误

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-08-31T07:38:55.640

> 截断表 T_DAT_STORE

T_DAT_STORE 是我工作部门的事实表。我想我连接到了开发数据库。幸运的是，我们有一个每日备份，直到那天才使用，并且在六个小时内恢复了数据。

从那以后，我在截断之前修改了所有内容，并定期要求对次要表进行备份恢复，只是为了检查备份是否正常（备份不是由我的部门完成的）

# .net - 在实体框架中更新数据库架构

> ID：12142
> 
> 赞同：8
> 
> 时间：2008-08-15T11:15:05.080
> 
> 标签：.net, entity-framework, schema

我安装了 VS SP1 并使用了 Entity Framework。

我从现有数据库创建了一个模式并尝试了一些基本操作。

大部分进展顺利，除了数据库模式更新。

我以各种基本方式更改了数据库：

*   添加了一个新表
*   删除了一个表
*   向现有表添加新列
*   从现有表中删除一列
*   更改了现有列的类型

前三个进展顺利，但类型更改和列删除没有跟随数据库更改。

有什么办法可以让设计师工作吗？还是暂时不支持？我还没有找到任何相关材料，但仍在搜索。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-15T16:18:22.633

我猜想这些可能不会发生，因为它们会破坏现有代码的构建，但这只是我的猜测。

这是我的逻辑：

首先，EF 应该是超过 1:1 的表映射，因此很可能仅仅因为您从表 A 中删除一列并不意味着对于该实体，不应该有属性 Description。您可能只是将该属性映射到另一个表。

其次，更改类型可能会破坏构建。这是唯一的理由。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-24T18:34:18.470

我发现，总的来说，“从数据库更新模型”功能仍然存在很多错误。

键是我的杀手 - 我还没有对外键关系进行任何修改或将主键添加到表并让更新程序正常工作（因为它会在生成时产生编译错误代码） - 但要解决问题，删除模型并重新导入（只需要一分钟）很简单 - 这显然不太理想，但我从未因“新”导入而失败。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-19T03:55:57.450

从我看到的设计师的演示来看，它不是一个完美的工具。是1.0版本的产品，难免会有一些痛点。更改类型似乎就是其中之一。通过观察设计器和代码生成，我认为一个会在编译时（不太可能）或运行时（模型实际执行时）中断。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T07:40:16.803

您需要自己从设计器或 XML 文件中删除该列。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-03T23:41:53.813

如前所述，您可以从设计器中删除该列。至于更改列的数据类型：只需从数据库中刷新模型，然后转到表映射并选择您在数据库中更改的列。右侧的值代表您的模型，奇怪的是这不会自动更新，而只需选择右侧的列并转到属性并在那里更改数据类型。它应该成为一个下拉菜单。

干杯。

红润

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-09T21:00:40.943

我按照您的要求构建了类似的应用程序。但我的解决方案太难了。我会试着告诉；

1.  您必须创建自己的数据库管理类，这些对象将负责创建、更新数据库模式（我手动创建的）。

2.  [我在ADO.NET Team 博客](http://blogs.msdn.com/adonet/archive/2008/06/20/edm-tools-options-part-1-of-4.aspx)上看到了很好的文章和源代码，然后你也可以从这个博客下载 EDMTools，它是开源的。您还可以在项目中实现模型生成和更新例程。

3.  最后，当您的架构发生更改时，您应该重新创建和绑定您的模型并在运行时重建您的数据程序集。但是你必须知道最重要的想法，你应该将你的数据模型程序集与你的项目以松散耦合的方式联系起来（查看这篇[文章](http://social.msdn.microsoft.com/forums/en-US/clr/thread/093c3606-e68e-46f4-98a1-f2396d3f88ca)）

    否则，您应该等待 EF 4.0 版本（现在是 CTP 1），他们宣布将提供创建、删除、更新 DatabaseScript 功能。

好锁

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-02-13T14:03:25.997

我这样做的方式（我正在做你提到的所有事情，加上重命名列）是通过更改数据库并使用 EF Code First 重新生成 EF 代码。

我不会为了好坏而篡改 EF Code First 类（包括用于关系的无意义命名列）以简化流程。

如果生产数据库中包含受约束的数据，则任何设计人员或 ORM 模式生成器都无法更改您的生产数据库。这就是为什么您应该始终首先检查您对数据库的更改是否可行，在开发数据库上尝试它们，然后调整您的代码以反映更改。

# java - 应用程序配置文件

> ID：12144
> 
> 赞同：41
> 
> 时间：2008-08-15T11:19:51.137
> 
> 标签：java, xml, json, cross-platform, configuration-files

好的，所以我不想在这里开始一场圣战，但我们正在尝试整合我们处理应用程序配置文件的方式，并且我们正在努力决定采用的最佳方法. 目前，我们分发的每个应用程序都使用它自己的临时配置文件，无论是属性文件（ini 样式）、XML 还是 JSON（目前仅供内部使用！）。

目前我们的大部分代码都是 Java，所以我们一直在研究[Apache Commons Config](http://commons.apache.org/configuration/)，但我们发现它非常冗长。我们还研究了[XMLBeans](http://xmlbeans.apache.org/)，但它看起来很无聊。我也觉得好像我正被推向将 XML 作为一种格式，但我的客户和同事对尝试其他东西感到担忧。我可以从客户的角度理解它，每个人都听说过 XML，但归根结底，不应该使用正确的工具来完成这项工作吗？

现在人们在生产系统中使用什么格式和库，还有其他人试图避免[尖括号税](http://www.codinghorror.com/blog/archives/001114.html)吗？

***编辑：****确实需要一个跨平台解决方案：Linux、Windows、Solaris 等，用于与配置文件接口的库的选择与格式的选择同样重要。*

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-08-15T14:17:33.890

YAML，原因很简单，与 XML 相比，它提供了非常易读的配置文件。

XML:

```
<user id="babooey" on="cpu1">
    <firstname>Bob</firstname>
    <lastname>Abooey</lastname>
    <department>adv</department>
    <cell>555-1212</cell>
    <address password="xxxx">ahunter@example1.com</address>
    <address password="xxxx">babooey@example2.com</address>
</user> 
```

YAML：

```
 babooey:
        computer : cpu1
        firstname: Bob
        lastname: Abooey
        cell: 555-1212
        addresses:
            - address: babooey@example1.com
              password: xxxx
            - address: babooey@example2.com
              password: xxxx 
```

示例取自此页面：[http ://www.kuro5hin.org/story/2004/10/29/14225/062](http://www.kuro5hin.org/story/2004/10/29/14225/062)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-08-15T15:19:04.813

第一：这是一个非常大的辩论问题，而不是快速问答。

我现在最喜欢的是简单地包含[Lua](http://www.lua.org)，因为

*   我可以允许像 width=height*(1+1/3) 这样的东西
*   我可以提供自定义功能
*   我可以禁止其他任何事情。（例如，在 Python（包括泡菜）中是不可能的。）
*   无论如何，我可能会在项目的其他地方需要一种脚本语言。

另一种选择，如果有很多数据是使用[sqlite3](http://www.sqlite.org/)，因为他们有权要求

*   小的。
*   快速地。
*   可靠的。

*选择任何三个。*

我想补充一点：

*   备份很简单。（只需复制 db 文件。）
*   更容易切换到另一个数据库、ODBC 等等。（比它来自 fugly 文件）

但同样，这是一个更大的问题。对此的“大”答案可能涉及某种特征矩阵或情况列表，例如：

## 数据量大，或运行时间短

*   对于大量数据，您可能需要高效的存储，例如 db。
*   对于短期运行（通常），您可能想要一些不需要进行大量解析的东西，考虑可以直接使用 mmap:ed 的东西。

## 配置与什么有关？

*   主持人：
    *   我喜欢 /etc 中的 YAML。这是在Windows中重新实现的吗？
*   用户：
    *   您是否允许用户使用文本编辑器编辑配置？
    *   它应该是集中管理的吗？注册表/gconf/远程数据库？
    *   用户可以有几个不同的*配置文件*吗？
*   项目：
    *   项目目录中的文件？（版本控制通常遵循这个模型......）

## 复杂

*   只有几个平面值吗？考虑 YAML。
*   数据是嵌套的，还是以某种方式依赖的？（这就是有趣的地方。）
*   允许某种形式的脚本编写可能是一个理想的功能吗？
*   模板可以看作是一种配置文件。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-08-15T13:45:26.670

XML XML XML XML。我们在*这里谈论配置文件*。如果您不在性能密集型情况下序列化对象，则没有“尖括号税”。

除了机器可读之外，配置文件还必须是人类可读且易于理解的。XML 是两者之间的一个很好的折衷。

如果您的商店里有人害怕这种新奇的 XML 技术，我为您感到难过。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-08-15T12:24:13.713

在没有开始新的圣战的情况下，“尖括号税”帖子的情绪是我*主要不同意*杰夫的一个领域。XML 没有任何问题，它是人类可读的（就像 YAML 或 JSON 或 INI 文件一样），但请记住它的意图是由机器读取。大多数语言/框架组合都带有某种免费的 XML 解析器，这使得 XML 成为一个不错的选择。

此外，如果您使用的是像 Visual Studio 这样的优秀 IDE，并且如果 XML 带有架构，您可以将架构提供给 VS，然后神奇地获得智能感知（例如，您可以为 NHibernate 获得一个）。

最终，您需要考虑在生产中接触这些文件的频率，可能不会那么频繁。

这仍然为我说明了关于 XML 的一切，以及为什么它仍然是配置文件的有效选择（来自[Tim Bray](http://www.tbray.org/ongoing/When/200x/2006/12/21/JSON)）：

*“如果你想提供通用数据，接收者可能想做一些无法预料的奇怪和疯狂的事情，或者如果你想对 i18n 非常偏执和挑剔，或者如果你发送的内容更像是一份文件而不是一个结构，或者数据的顺序是否重要，或者数据是否可能长期存在（例如，超过几秒钟）XML 是要走的路。在我看来，XML 和 XPath 的组合也达到了需要可扩展的数据格式的最佳选择；也就是说，很容易编写 XML 处理代码，在消息格式发生更改时不会失败，而这些更改不涉及您关心的部分。 "*

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-08-15T20:26:46.687

@Guy

但应用程序配置并不总是键/值对。查看类似 tomcat 配置的内容，了解它侦听的端口。这是一个例子：

```
 <Connector port="80" maxHttpHeaderSize="8192"
           maxThreads="150" minSpareThreads="25" maxSpareThreads="75"
           enableLookups="false" redirectPort="8443" acceptCount="100"
           connectionTimeout="20000" disableUploadTimeout="true" />

    <Connector port="8009" 
           enableLookups="false" redirectPort="8443" protocol="AJP/1.3" /> 
```

您可以有任意数量的连接器。在文件中定义更多，并且存在更多连接器。不再定义，不再存在。使用普通的旧键/值对没有好方法（恕我直言）。

如果您的应用程序的配置很简单，那么像读入字典的 INI 文件这样简单的东西可能就可以了。但是对于像服务器配置这样更复杂的东西，INI 文件维护起来会很痛苦，而像 XML 或 YAML 这样更结构化的东西会更好。这一切都取决于问题集。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-08-15T12:41:32.337

我们正在使用 ini 样式的配置文件。我们使用[Nini](http://nini.sourceforge.net/ "妮妮")库来管理它们。Nini 使它非常易于使用。Nini 最初用于 .NET，但已使用 Mono 移植到其他平台。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-08-15T14:26:55.807

XML、JSON、INI。
他们都有自己的长处和短处。
在应用程序上下文中，我觉得抽象层很重要。
如果您可以选择一种在人类可读性和您希望如何访问/抽象代码中的数据之间取得良好中间立场的数据结构方式，那么您就是黄金。

我们主要在我工作的地方使用 XML，我真的不敢相信配置文件在第一次读取或写入后作为对象加载到缓存中，然后从程序的其余部分抽象出来，真的是对 CPU 和磁盘空间都没有影响。
只要您正确构建文件，它也非常可读。

所有平台上的所有语言都通过一些非常常见的库支持 XML。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-15T13:58:27.190

@Herms

我真正的意思是坚持软件应该为任何给定平台存储配置值的推荐方式。

你经常得到的也是这些应该/可以修改的推荐方法。就像程序中的配置菜单或“系统首选项”应用程序中的配置面板（用于系统服务软件，即）。不要让最终用户直接通过 RegEdit 或记事本修改它们......

为什么？

1.  最终用户（=客户）习惯于他们的平台
2.  备份系统可以更好地保存“安全设置”等

@nineside

关于“*库的选择*”，尝试链接（静态链接）任何选定的库，以降低在最终用户机器上陷入版本冲突的风险。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-19T16:40:22.513

如果您的配置文件是一次写入、启动时只读，并且您的数据是一堆名称值对，那么您最好的选择是开发人员可以首先使用的那个。

如果你的数据有点复杂，有嵌套等，你可能最好使用 YAML、XML 或 SQLite。

如果您需要嵌套数据和/或启动后查询配置数据的能力，请使用 XML 或 SQLite。对于结构化/嵌套数据，两者都有很好的查询语言（XPATH 和 SQL）。

如果您的配置数据是高度规范化的（例如第 5 范式），您最好使用 SQLite，因为 SQL 更适合处理高度规范化的数据。

如果您计划在程序运行期间写入配置数据集，那么您最好使用 SQLite。例如，如果您正在从另一台计算机下载配置数据，或者如果您正在根据之前程序执行中收集的数据做出未来的程序执行决策。SQLite 实现了一个非常健壮的数据存储引擎，当您遇到停电或由于错误而处于不一致状态的程序时，该引擎极难损坏。损坏的数据会导致高昂的现场支持成本，而 SQLite 将比任何本土解决方案甚至围绕 XML 或 YAML 的流行库做得更好。

[查看我的页面](http://www.squidoo.com/sqlitehammer)以获取有关 SQLite 的更多信息。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-15T12:04:00.743

据我所知，如果您使用 .NET，Windows 注册表不再是存储配置的首选方式 - 现在大多数应用程序都使用 System.Configuration [1, 2]。由于这也是基于 XML 的，因此似乎一切都朝着使用 XML 进行配置的方向发展。

如果你想保持跨平台，我会说使用某种文本文件是最好的选择。至于所述文件的格式，您可能需要考虑是否有人要操作它。由于文件的可见结构，XML 似乎比 INI 文件更易于手动操作。

至于尖括号税——我并不经常担心它，因为 XML 库会负责抽象它。唯一可能需要考虑的是，如果您的存储空间非常小并且每个字节都很重要。

[1] System.Configuration 命名空间 - [http://msdn.microsoft.com/en-us/library/system.configuration.aspx](http://msdn.microsoft.com/en-us/library/system.configuration.aspx)

[2] 在 .NET 中使用应用程序配置文件 - [http://www.developer.com/net/net/article.php/3396111](http://www.developer.com/net/net/article.php/3396111)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-08-15T12:32:36.317

我们使用属性文件，仅仅是因为 Java 本身就支持它们。几个月前，我看到 SpringSource Application Platform 使用 JSON 来配置他们的服务器，它看起来非常有趣。我[比较了各种配置符号](http://dlinsin.blogspot.com/2008/07/configuration-notations.html)并得出结论，XML 似乎是目前最合适的。它有很好的工具支持，并且相当独立于平台。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-08-15T13:18:51.170

回复：epatel 的评论

我认为最初的问题是询问管理员将要执行的应用程序配置，而不仅仅是存储用户偏好。您提供的建议似乎更多地针对用户偏好而不是应用程序配置，并且通常不是用户会直接处理的东西（应用程序应该在 UI 中提供配置选项，然后更新文件）。我真的希望您永远不要让用户必须查看/编辑注册表。:)

至于实际问题，我会说 XML 可能没问题，因为很多人会习惯于使用它进行配置。只要您以易于使用的方式组织配置值，那么“尖括号税”应该不会太糟糕。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-08-15T15:23:52.463

这里可能有点切线，但我认为配置文件应该在应用程序首次启动时读入键值字典/哈希表，并且从那时起始终通过该对象访问以提高速度。通常，键/值表以字符串到字符串的形式开始，但对象中的辅助函数会执行 DateTime GetConfigDate(string key) 等操作...

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-11-13T17:54:13.160

我认为唯一重要的是选择您喜欢的格式并且可以快速导航。XML 和 JSON 都是很好的配置格式，并且得到了广泛的支持——我认为，技术实现并不是问题的关键。这是 100% 让您更轻松地完成配置文件任务的原因。

我已经开始使用 JSON，因为我经常使用它作为一种数据传输格式，并且序列化程序可以轻松加载到任何开发框架中。我发现 JSON 比 XML 更容易阅读，这使得处理多个服务，每个服务都使用一个经常修改的配置文件，这对我来说更容易！

* * *

## 回答 #15

> 赞同：-3
> 
> 时间：2008-08-15T11:27:09.033

你在哪个平台上工作？我建议尝试使用首选/常用方法。

1.  MacOSX - plists
2.  Win32 - 注册表（或者这里有一个新的，很久以来我就在上面开发过）
3.  Linux/Unix - ~/.apprc（可能是名称-值）

# multithreading - 我应该如何对多线程代码进行单元测试？

> ID：12159
> 
> 赞同：766
> 
> 时间：2008-08-15T11:44:33.280
> 
> 标签：multithreading, unit-testing

到目前为止，我已经避免了测试多线程代码的噩梦，因为它看起来像是一个雷区。我想问一下人们是如何测试依赖线程成功执行的代码的，或者人们是如何测试那些仅在两个线程以给定方式交互时才出现的问题的？

对于今天的程序员来说，这似乎是一个非常关键的问题，将我们的知识集中在这个恕我直言上会很有用。

* * *

## 回答 #1

> 赞同：267
> 
> 时间：2008-08-15T13:29:01.523

看，没有简单的方法可以做到这一点。我正在研究一个本质上是多线程的项目。事件来自操作系统，我必须同时处理它们。

处理测试复杂的多线程应用程序代码的最简单方法是：如果测试太复杂，则说明您做错了。如果您有一个有多个线程作用于它的单个实例，并且您无法测试这些线程相互交叉的情况，那么您的设计需要重做。它既简单又复杂。

有许多多线程编程方法可以避免线程同时通过实例运行。最简单的方法是使所有对象不可变。当然，这通常是不可能的。因此，您必须在设计中识别线程与同一实例交互的那些位置，并减少这些位置的数量。通过这样做，您可以隔离一些实际发生多线程的类，从而降低测试系统的整体复杂性。

但是您必须意识到，即使这样做，您仍然无法测试两个线程相互踩踏的所有情况。为此，您必须在同一个测试中同时运行两个线程，然后准确控制它们在任何给定时刻正在执行的行。你能做的最好的就是模拟这种情况。但这可能需要您专门为测试编写代码，而这充其量只是迈向真正解决方案的一半。

测试代码是否存在线程问题的最佳方法可能是通过代码的静态分析。如果您的线程代码不遵循有限的线程安全模式集，那么您可能会遇到问题。我相信 VS 中的代码分析确实包含一些线程知识，但可能不多。

看，就目前的情况来看（并且可能会在未来的好时机出现），测试多线程应用程序的最佳方法是尽可能降低线程代码的复杂性。尽量减少线程交互的区域，尽可能进行测试，并使用代码分析来识别危险区域。

* * *

## 回答 #2

> 赞同：106
> 
> 时间：2009-01-18T12:30:21.310

这个问题已经有一段时间了，但仍然没有回答......

[kleolb02](https://stackoverflow.com/questions/12159/how-should-i-unit-test-threaded-code/17835#17835)的回答很好。我会尝试更详细的。

有一种方法，我为 C# 代码练习。对于单元测试，您应该能够编写可*重现*的测试，这是多线程代码中的最大挑战。因此，我的答案旨在将异步代码强制转换为*同步*工作的测试工具。

这是 Gerard Meszaros 的书“ [xUnit Test Patterns](http://xunitpatterns.com/) ”中的一个想法，被称为“Humble Object”（第 695 页）：您必须将核心逻辑代码和任何闻起来像异步代码的东西分开。这将产生一个用于核心逻辑的类，它可以*同步*工作。

这使您能够以*同步*的方式测试核心逻辑代码。您可以完全控制您在核心逻辑上执行的调用的时间，因此可以进行*可重复*的测试。这是分离核心逻辑和异步逻辑的收获。

这个核心逻辑需要被另一个类包裹起来，该类负责异步接收对核心逻辑的调用，并将这些调用*委托给核心逻辑。*生产代码只能通过该类访问核心逻辑。因为这个类应该只委托调用，所以它是一个非常“愚蠢”的类，没有太多逻辑。因此，您可以将这个异步工作类的单元测试保持在最低限度。

任何高于此（测试类之间的交互）都是组件测试。同样在这种情况下，如果您坚持“Humble Object”模式，您应该能够绝对控制时间。

* * *

## 回答 #3

> 赞同：72
> 
> 时间：2008-08-15T13:26:26.537

确实是硬汉！在我的 (C++) 单元测试中，我按照所使用的并发模式将其分为几个类别：

1.  对在单线程中运行且不支持线程的类进行单元测试——简单，像往常一样测试。

2.  [公开同步公共 API 的Monitor 对象](https://web.archive.org/web/20171215050902/http://www.cse.wustl.edu/%7Eschmidt/PDF/monitor.pdf)（在调用者的控制线程中执行同步方法的对象）的单元测试——实例化多个执行 API 的模拟线程。构建锻炼被动对象内部条件的场景。包括一个运行时间较长的测试，它基本上可以在很长一段时间内从多个线程中击败它。我知道这是不科学的，但它确实建立了信心。

3.  [活动对象](https://web.archive.org/web/20151019023537/http://www.cse.wustl.edu/%7Eschmidt/PDF/Act-Obj.pdf)的单元测试（那些封装了自己的线程或控制线程的对象）——类似于上面的#2，但根据类设计而有所不同。公共 API 可能是阻塞的或非阻塞的，调用者可能会获得期货，数据可能会到达队列或需要出队。这里有许多可能的组合；白盒子走了。仍然需要多个模拟线程来调用被测对象。

作为旁白：

在我进行的内部开发人员培训中，我教授[并发支柱](http://www.ddj.com/hpc-high-performance-computing/200001985)和这两种模式作为思考和分解并发问题的主要框架。显然有更高级的概念，但我发现这套基础知识有助于让工程师远离困境。如上所述，它还导致代码更易于单元测试。

* * *

## 回答 #4

> 赞同：58
> 
> 时间：2015-09-11T21:00:39.647

近年来，在为多个项目编写线程处理代码时，我曾多次遇到过这个问题。我提供了一个较晚的答案，因为大多数其他答案虽然提供了替代方案，但实际上并没有回答有关测试的问题。我的回答是针对没有多线程代码替代方案的情况。为了完整性，我确实涵盖了代码设计问题，但也讨论了单元测试。

**编写可测试的多线程代码**

首先要做的是将您的生产线程处理代码与所有进行实际数据处理的代码分开。这样，数据处理可以作为单线程代码进行测试，而多线程代码所做的唯一事情就是协调线程。

要记住的第二件事是多线程代码中的错误是概率性的。最不常出现的错误是会潜入生产中的错误，即使在生产中也难以重现，因此会导致最大的问题。出于这个原因，快速编写代码然后调试它直到它工作的标准编码方法对于多线程代码来说是一个坏主意。它将导致代码中容易的错误被修复而危险的错误仍然存​​在。

相反，在编写多线程代码时，您必须以一开始就避免编写错误的态度编写代码。如果你已经正确删除了数据处理代码，线程处理代码应该足够小——最好是几行，最坏是几十行——这样你就有机会在不写错误的情况下编写它，当然也不会写很多错误，如果您了解线程，请慢慢来，并且要小心。

**为多线程代码编写单元测试**

一旦尽可能仔细地编写多线程代码，仍然值得为该代码编写测试。测试的主要目的不是测试高度依赖于时间的竞争条件错误——不可能重复测试这种竞争条件——而是测试你防止此类错误的锁定策略是否允许多个线程按预期交互.

要正确测试正确的锁定行为，测试必须启动多个线程。为了使测试可重复，我们希望线程之间的交互以可预测的顺序发生。我们不想在测试中对线程进行外部同步，因为这将掩盖生产中可能发生的线程未外部同步的错误。这就留下了线程同步的时间延迟的使用，这是我在必须编写多线程代码测试时成功使用的技术。

如果延迟太短，那么测试就会变得脆弱，因为微小的时间差异——比如可能运行测试的不同机器之间——可能会导致时间关闭和测试失败。我通常做的是从导致测试失败的延迟开始，增加延迟以便测试在我的开发机器上可靠地通过，然后将延迟加倍，这样测试就有很大的机会在其他机器上通过。这确实意味着测试将花费大量时间，尽管根据我的经验，仔细的测试设计可以将时间限制在不超过十几秒。由于您的应用程序中不应该有很多地方需要线程协调代码，因此您的测试套件应该可以接受。

最后，跟踪您的测试捕获的错误数量。如果您的测试有 80% 的代码覆盖率，那么它有望捕获大约 80% 的错误。如果您的测试设计良好但没有发现任何错误，那么您很有可能没有其他只会出现在生产环境中的错误。如果测试发现一两个错误，您可能仍然很幸运。除此之外，您可能需要考虑仔细审查甚至完全重写您的线程处理代码，因为代码可能仍然包含隐藏的错误，这些错误在代码投入生产之前很难找到，而且非常那时很难修复。

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2008-08-20T12:29:59.070

我在测试多线程代码时也遇到了严重的问题。然后我在 Gerard Meszaros 的“xUnit 测试模式”中找到了一个非常酷的解决方案。他描述的模式被称为**Humble object**。

基本上，它描述了如何将逻辑提取到一个单独的、易于测试的组件中，该组件与其环境分离。在你测试了这个逻辑之后，你可以测试复杂的行为（多线程、异步执行等......）

* * *

## 回答 #6

> 赞同：19
> 
> 时间：2010-07-08T12:23:19.390

周围有一些非常好的工具。这里是一些 Java 的总结。

一些好的静态分析工具包括[FindBugs](http://findbugs.sourceforge.net/)（提供一些有用的提示）、[JLint](http://jlint.sourceforge.net/)、[Java Pathfinder](http://babelfish.arc.nasa.gov/trac/jpf)（JPF 和 JPF2）和[Bogor](http://bogor.projects.cis.ksu.edu/)。

[MultithreadedTC](http://code.google.com/p/multithreadedtc/)是一个很好的动态分析工具（集成到 JUnit 中），您必须在其中设置自己的测试用例。

[IBM Research 的竞赛](https://www.research.ibm.com/haifa/projects/verification/contest/)很有趣。它通过插入各种线程修改行为（例如睡眠和屈服）来检测您的代码，以尝试随机发现错误。

[SPIN](http://spinroot.com/spin/whatispin.html)是一个非常酷的工具，用于对 Java（和其他）组件进行建模，但您需要有一些有用的框架。它很难按原样使用，但如果你知道如何使用它，它就会非常强大。相当多的工具在引擎盖下使用 SPIN。

MultithreadedTC 可能是最主流的，但上面列出的一些静态分析工具绝对值得一看。

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2010-11-19T17:26:44.147

[等待](https://github.com/awaitility/awaitility)也可以帮助您编写确定性单元测试。它允许您等到系统中某处的某个状态被更新。例如：

```
await().untilCall( to(myService).myMethod(), greaterThan(3) ); 
```

或者

```
await().atMost(5,SECONDS).until(fieldIn(myObject).ofType(int.class), equalTo(1)); 
```

它还支持 Scala 和 Groovy。

```
await until { something() > 4 } // Scala example 
```

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2008-09-24T05:16:55.283

另一种（有点）测试线程代码和非常复杂的系统的方法是通过[Fuzz Testing](http://en.wikipedia.org/wiki/Fuzz_testing)。它不是很好，它不会找到所有东西，但它可能很有用并且操作简单。

引用：

> 模糊测试或模糊测试是一种软件测试技术，它为程序的输入提供随机数据（“模糊”）。如果程序失败（例如，由于崩溃，或由于内置代码断言失败），则可以记录缺陷。模糊测试的最大优点是测试设计非常简单，并且没有对系统行为的先入之见。
> 
> ...
> 
> 模糊测试通常用于采用黑盒测试的大型软件开发项目。这些项目通常有开发测试工具的预算，而模糊测试是提供高收益成本比的技术之一。
> 
> ...
> 
> 然而，模糊测试并不能替代穷举测试或形式化方法：它只能提供系统行为的随机样本，而且在许多情况下，通过模糊测试可能只能证明一个软件处理了异常而没有崩溃，而不是行为正确。因此，模糊测试只能被视为一种错误发现工具，而不是质量保证。

* * *

## 回答 #9

> 赞同：13
> 
> 时间：2008-09-24T04:58:52.970

我已经做了很多这样的事情，是的，这很糟糕。

一些技巧：

*   [GroboUtils](http://groboutils.sourceforge.net/)用于运行多个测试线程
*   [alphaWorks ConTest](http://www.alphaworks.ibm.com/tech/contest?open&S_TACT=105AGX59&S_CMP=GR&ca=dgr-lnxw03awcontest)对仪器类进行测试，以使交叉在迭代之间发生变化
*   创建一个`throwable`字段并将其签入`tearDown`（参见清单 1）。如果您在另一个线程中捕获到错误异常，只需将其分配给 throwable。
*   我在清单 2 中创建了 utils 类，发现它非常宝贵，尤其是 waitForVerify 和 waitForCondition，它们将大大提高您的测试性能。
*   `AtomicBoolean`在你的测试中好好利用。它是线程安全的，您通常需要一个最终引用类型来存储来自回调类等的值。请参见清单 3 中的示例。
*   确保总是给你的测试一个超时时间（例如，`@Test(timeout=60*1000)`），因为并发测试有时会在它们被破坏时永远挂起。

清单 1：

```
@After
public void tearDown() {
    if ( throwable != null )
        throw throwable;
} 
```

清单 2：

```
import static org.junit.Assert.fail;
import java.io.File;
import java.lang.reflect.InvocationHandler;
import java.lang.reflect.Proxy;
import java.util.Random;
import org.apache.commons.collections.Closure;
import org.apache.commons.collections.Predicate;
import org.apache.commons.lang.time.StopWatch;
import org.easymock.EasyMock;
import org.easymock.classextension.internal.ClassExtensionHelper;
import static org.easymock.classextension.EasyMock.*;

import ca.digitalrapids.io.DRFileUtils;

/**
 * Various utilities for testing
 */
public abstract class DRTestUtils
{
    static private Random random = new Random();

/** Calls {@link #waitForCondition(Integer, Integer, Predicate, String)} with
 * default max wait and check period values.
 */
static public void waitForCondition(Predicate predicate, String errorMessage) 
    throws Throwable
{
    waitForCondition(null, null, predicate, errorMessage);
}

/** Blocks until a condition is true, throwing an {@link AssertionError} if
 * it does not become true during a given max time.
 * @param maxWait_ms max time to wait for true condition. Optional; defaults
 * to 30 * 1000 ms (30 seconds).
 * @param checkPeriod_ms period at which to try the condition. Optional; defaults
 * to 100 ms.
 * @param predicate the condition
 * @param errorMessage message use in the {@link AssertionError}
 * @throws Throwable on {@link AssertionError} or any other exception/error
 */
static public void waitForCondition(Integer maxWait_ms, Integer checkPeriod_ms, 
    Predicate predicate, String errorMessage) throws Throwable 
{
    waitForCondition(maxWait_ms, checkPeriod_ms, predicate, new Closure() {
        public void execute(Object errorMessage)
        {
            fail((String)errorMessage);
        }
    }, errorMessage);
}

/** Blocks until a condition is true, running a closure if
 * it does not become true during a given max time.
 * @param maxWait_ms max time to wait for true condition. Optional; defaults
 * to 30 * 1000 ms (30 seconds).
 * @param checkPeriod_ms period at which to try the condition. Optional; defaults
 * to 100 ms.
 * @param predicate the condition
 * @param closure closure to run
 * @param argument argument for closure
 * @throws Throwable on {@link AssertionError} or any other exception/error
 */
static public void waitForCondition(Integer maxWait_ms, Integer checkPeriod_ms, 
    Predicate predicate, Closure closure, Object argument) throws Throwable 
{
    if ( maxWait_ms == null )
        maxWait_ms = 30 * 1000;
    if ( checkPeriod_ms == null )
        checkPeriod_ms = 100;
    StopWatch stopWatch = new StopWatch();
    stopWatch.start();
    while ( !predicate.evaluate(null) ) {
        Thread.sleep(checkPeriod_ms);
        if ( stopWatch.getTime() > maxWait_ms ) {
            closure.execute(argument);
        }
    }
}

/** Calls {@link #waitForVerify(Integer, Object)} with <code>null</code>
 * for {@code maxWait_ms}
 */
static public void waitForVerify(Object easyMockProxy)
    throws Throwable
{
    waitForVerify(null, easyMockProxy);
}

/** Repeatedly calls {@link EasyMock#verify(Object[])} until it succeeds, or a
 * max wait time has elapsed.
 * @param maxWait_ms Max wait time. <code>null</code> defaults to 30s.
 * @param easyMockProxy Proxy to call verify on
 * @throws Throwable
 */
static public void waitForVerify(Integer maxWait_ms, Object easyMockProxy)
    throws Throwable
{
    if ( maxWait_ms == null )
        maxWait_ms = 30 * 1000;
    StopWatch stopWatch = new StopWatch();
    stopWatch.start();
    for(;;) {
        try
        {
            verify(easyMockProxy);
            break;
        }
        catch (AssertionError e)
        {
            if ( stopWatch.getTime() > maxWait_ms )
                throw e;
            Thread.sleep(100);
        }
    }
}

/** Returns a path to a directory in the temp dir with the name of the given
 * class. This is useful for temporary test files.
 * @param aClass test class for which to create dir
 * @return the path
 */
static public String getTestDirPathForTestClass(Object object) 
{

    String filename = object instanceof Class ? 
        ((Class)object).getName() :
        object.getClass().getName();
    return DRFileUtils.getTempDir() + File.separator + 
        filename;
}

static public byte[] createRandomByteArray(int bytesLength)
{
    byte[] sourceBytes = new byte[bytesLength];
    random.nextBytes(sourceBytes);
    return sourceBytes;
}

/** Returns <code>true</code> if the given object is an EasyMock mock object 
 */
static public boolean isEasyMockMock(Object object) {
    try {
        InvocationHandler invocationHandler = Proxy
                .getInvocationHandler(object);
        return invocationHandler.getClass().getName().contains("easymock");
    } catch (IllegalArgumentException e) {
        return false;
    }
}
} 
```

清单 3：

```
@Test
public void testSomething() {
    final AtomicBoolean called = new AtomicBoolean(false);
    subject.setCallback(new SomeCallback() {
        public void callback(Object arg) {
            // check arg here
            called.set(true);
        }
    });
    subject.run();
    assertTrue(called.get());
} 
```

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2014-09-18T10:37:01.277

如前所述，测试 MT 代码的正确性是一个相当困难的问题。最后归结为确保代码中没有错误同步的数据竞争。这样做的问题是线程执行（交错）的可能性有无数种，您无法对其进行太多控制（不过，请务必阅读[这篇](http://www.cs.umd.edu/projects/PL/multithreadedtc/overview.html)文章）。在简单的场景中，可以通过推理实际证明正确性，但通常情况并非如此。特别是如果您想避免/最小化同步并且不选择最明显/最简单的同步选项。

我遵循的一种方法是编写高度并发的测试代码，以使潜在的未被检测到的数据竞争可能发生。然后我运行这些测试一段时间 :) 我曾经偶然发现一些计算机科学家在演讲中展示了一种可以做到这一点的工具（从规范中随机设计测试，然后同时疯狂地运行它们，检查定义的不变量被打破）。

顺便说一句，我认为这里没有提到测试 MT 代码的这一方面：识别可以随机检查的代码的不变量。不幸的是，找到这些不变量也是一个相当困难的问题。此外，它们可能不会在执行期间一直保持，因此您必须找到/执行您可以期望它们为真的执行点。将代码执行到这样的状态也是一个难题（并且本身可能会引发并发问题。哇，这太难了！

一些有趣的阅读链接：

*   [Deterministic interleaving](http://www.cs.umd.edu/projects/PL/multithreadedtc/overview.html)：一个允许强制执行某些线程交错然后检查不变量的框架
*   [jMock Blitzer](http://jmock.org/threading-blitzer.html)：压力测试同步
*   [assertConcurrent](https://github.com/junit-team/junit/wiki/Multithreaded-code-and-concurrency) : JUnit 版本的压力测试同步
*   [测试并发代码](http://tempusfugitlibrary.org/recipes/2012/05/20/testing-concurrent-code/)：简要概述蛮力（压力测试）或确定性（寻求不变量）的两种主要方法

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2010-02-26T23:38:20.337

我处理线程组件的单元测试的方式与处理任何单元测试的方式相同，即控制反转和隔离框架。我在 .Net-arena 中开发，开箱即用，线程（除其他外）很难（我会说几乎不可能）完全隔离。

因此，我编写了看起来像这样（简化）的包装器：

```
public interface IThread
{
    void Start();
    ...
}

public class ThreadWrapper : IThread
{
    private readonly Thread _thread;

    public ThreadWrapper(ThreadStart threadStart)
    {
        _thread = new Thread(threadStart);
    }

    public Start()
    {
        _thread.Start();
    }
}

public interface IThreadingManager
{
    IThread CreateThread(ThreadStart threadStart);
}

public class ThreadingManager : IThreadingManager
{
    public IThread CreateThread(ThreadStart threadStart)
    {
         return new ThreadWrapper(threadStart)
    }
} 
```

从那里，我可以轻松地将 IThreadingManager 注入到我的组件中，并使用我选择的隔离框架使线程在测试期间按预期运行。

到目前为止，这对我来说效果很好，我对线程池、System.Environment、Sleep 等中的东西使用相同的方法。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2008-09-17T16:35:12.273

对于 Java，请查看[JCIP](https://rads.stackoverflow.com/amzn/click/com/0321349601)的第 12 章。有一些编写确定性多线程单元测试的具体示例，至少可以测试并发代码的正确性和不变性。

用单元测试“证明”线程安全性要困难得多。我的信念是，通过在各种平台/配置上进行自动化集成测试可以更好地实现这一点。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2011-01-06T13:56:14.530

看看我的相关答案

[为自定义 Barrier 设计测试类](https://stackoverflow.com/questions/4418373/designing-a-test-class-for-a-custom-barrier/4427499#4427499)

它偏向于 Java，但对选项进行了合理的总结。

总之，虽然（IMO）它不是使用一些花哨的框架来确保正确性，而是你如何设计你的多线程代码。拆分关注点（并发性和功能性）对提高信心大有帮助。[以测试为导向的面向对象软件的增长](http://www.amazon.co.uk/Growing-Object-Oriented-Software-Guided-Signature/dp/0321503627/ref=sr_1_1?ie=UTF8&qid=1294321919&sr=1-1)比我能更好地解释一些选项。

静态分析和形式化方法（请参阅[并发：状态模型和 Java 程序](http://www.amazon.co.uk/gp/product/0470093552/)）是一种选择，但我发现它们在商业开发中的用途有限。

不要忘记任何负载/浸泡式测试很少保证能突出问题。

祝你好运！

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2008-09-08T05:34:05.417

我喜欢编写两个或多个测试方法在并行线程上执行，每个测试方法都调用被测对象。我一直在使用 Sleep() 调用来协调来自不同线程的调用顺序，但这并不可靠。它也慢了很多，因为你必须睡足够长的时间才能正常工作。

我从编写 FindBugs 的同一组中找到了[Multithreaded TC Java 库。](http://www.cs.umd.edu/projects/PL/multithreadedtc/overview.html)它允许您在不使用 Sleep() 的情况下指定事件的顺序，并且它是可靠的。我还没试过。

这种方法的最大限制是它只能让您测试您怀疑会引起麻烦的场景。正如其他人所说，您确实需要将多线程代码隔离为少量简单的类，以便有希望彻底测试它们。

一旦你仔细测试了你预计会引起麻烦的场景，一个不科学的测试会在一段时间内在课堂上抛出一堆并发请求，这是寻找意外问题的好方法。

**更新：**我玩了一点多线程 TC Java 库，它运行良好。我还将它的一些功能移植到了我称为[TickingTest](https://github.com/donkirkby/donkirkby/tree/master/TickingTest)的 .NET 版本中。

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2008-08-15T20:59:45.590

[Pete Goodliffe](http://goodliffe.blogspot.com/)有一系列关于[线程](http://goodliffe.blogspot.com/search/label/threads)代码的单元测试。

这个很难（硬。我采取了更简单的方法，并尝试将线程代码从实际测试中抽象出来。皮特确实提到我这样做的方式是错误的，但我要么正确地分开，要么我很幸运。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2014-05-24T22:09:42.163

我最近（对于 Java）发现了一个名为 Threadsafe 的工具。它是一个类似于 findbugs 的静态分析工具，但专门用于发现多线程问题。它不能替代测试，但我可以推荐它作为编写可靠的多线程 Java 的一部分。

它甚至可以捕捉到一些非常微妙的潜在问题，例如类包含、通过并发类访问不安全的对象以及在使用双重检查锁定范例时发现丢失的 volatile 修饰符。

如果您编写多线程 Java ，请[试一试。](http://www.contemplateltd.com/threadsafe)

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2013-07-31T14:40:42.543

以下文章建议了 2 个解决方案。包装信号量（CountDownLatch）并添加功能，例如从内部线程外部化数据。实现此目的的另一种方法是使用线程池（请参阅兴趣点）。

[Sprinkler - 高级同步对象](http://www.codeproject.com/Articles/628843/Sprinkler-Advanced-synchronization-object#_rating)

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2008-08-15T13:15:47.697

我有一个不幸的任务是测试线程代码，它们绝对是我写过的最难的测试。

在编写测试时，我使用了委托和事件的组合。基本上，这都是关于使用`PropertyNotifyChanged`带有某种`WaitCallback`或某种`ConditionalWaiter`民意调查的事件。

我不确定这是否是最好的方法，但它对我来说很有效。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2009-03-22T22:45:10.960

我上周大部分时间都在大学图书馆学习并发代码的调试。核心问题是并发代码是不确定的。通常，学术调试已落入以下三个阵营之一：

1.  事件跟踪/重播。这需要一个事件监视器，然后查看已发送的事件。在 UT 框架中，这将涉及手动发送事件作为测试的一部分，然后进行事后审查。
2.  可编写脚本。这是您使用一组触发器与正在运行的代码交互的地方。“在 x > foo，baz()”上。这可以解释为一个 UT 框架，其中您有一个运行时系统在特定条件下触发给定测试。
3.  交互的。这显然不适用于自动测试情况。;)

现在，正如上述评论员所注意到的，您可以将并发系统设计为更具确定性的状态。但是，如果你没有正确地做到这一点，你就只能重新设计一个顺序系统。

我的建议是专注于制定一个非常严格的设计协议，关于什么是线程化的，什么不是线程化的。如果你限制你的界面，使元素之间的依赖最小，那就容易多了。

祝你好运，继续解决这个问题。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2019-03-21T09:10:12.810

假设在“多线程”代码下的意思是

*   有状态的和可变的
*   由多个线程同时访问/修改

换句话说，我们正在谈论测试**自定义有状态线程安全类/方法/单元**——这在当今应该是一种非常罕见的野兽。

因为这种野兽很少见，首先我们需要确保有所有正当的借口来写它。

**步骤 1.**考虑在相同的同步上下文中修改状态。

今天很容易编写可组合的并发和异步代码，其中 IO 或其他慢速操作被卸载到后台，但共享状态在一个同步上下文中更新和查询。例如，.NET 中的异步/等待任务和 Rx 等 - 它们都可以通过设计进行测试，“真实”任务和调度程序可以替代以使测试具有确定性（但这超出了问题的范围）。

听起来可能很受限制，但这种方法的效果出奇的好。可以以这种风格编写整个应用程序，而无需使任何状态线程安全（我这样做）。

**步骤 2.**如果在单个同步上下文上操作共享状态绝对是不可能的。

确保轮子没有被重新发明/绝对没有可以适应这项工作的标准替代品。代码应该很可能是非常内聚的并且包含在一个单元中，例如很有可能它是一些标准线程安全数据结构（如哈希映射或集合等）的特例。

*注意：如果代码很大/跨越多个类并且需要多线程状态操作，那么很有可能设计不好，重新考虑第 1 步*

**第 3 步。**如果达到此步骤，那么我们需要测试**我们自己的自定义有状态线程安全类/方法/单元**。

老实说：我从来不需要为这样的代码编写适当的测试。大部分时间我都在第 1 步，有时在第 2 步。上一次我必须编写自定义线程安全代码是多年前的事了，那是在我采用单元测试之前/可能我不必编写它无论如何，以目前的知识。

如果我真的必须测试这样的代码（**最后是实际答案**），那么我会尝试以下几件事

1.  非确定性压力测试。例如同时运行 100 个线程并检查最终结果是否一致。这对于多用户场景的更高级别/集成测试更为典型，但也可以在单元级别使用。

2.  公开一些测试“钩子”，其中测试可以注入一些代码，以帮助确定一个线程必须在另一个线程之前执行操作的确定性场景。这么丑，我想不出更好的了。

3.  延迟驱动测试，使线程以特定顺序运行和执行操作。严格来说，这样的测试也是非确定性的（有可能系统冻结/停止世界 GC 收集，这可能会扭曲原本精心安排的延迟），它也很丑陋，但可以避免挂钩。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2017-09-25T21:14:33.060

对于 J2E 代码，我使用 SilkPerformer、LoadRunner 和 JMeter 对线程进行并发测试。他们都做同样的事情。基本上，它们为您提供了一个相对简单的界面来管理他们的代理服务器版本，以便分析 TCP/IP 数据流，并模拟多个用户同时向您的应用服务器发出请求。代理服务器可以让您通过在处理请求后显示发送到服务器的整个页面和 URL 以及来自服务器的响应来执行分析请求等操作。

您可以在不安全的 http 模式中找到一些错误，您至少可以在其中分析正在发送的表单数据，并为每个用户系统地更改这些数据。但真正的测试是在 https（安全套接字层）中运行时。然后，您还必须应对系统地更改会话和 cookie 数据，这可能有点复杂。

我在测试并发性时发现的最好的错误是当我发现开发人员在登录时依赖 Java 垃圾收集来关闭登录时建立的连接请求到 LDAP 服务器。这导致用户被暴露对于其他用户的会话和非常混乱的结果，当试图分析服务器瘫痪时发生的事情时，每隔几秒钟几乎无法完成一项事务。

最后，您或其他人可能不得不认真分析代码中的错误，就像我刚才提到的那样。跨部门的公开讨论，就像我们展开上述问题时发生的那样，是最有用的。但这些工具是测试多线程代码的最佳解决方案。JMeter 是开源的。SilkPerformer 和 LoadRunner 是专有的。如果您真的想知道您的应用程序是否是线程安全的，那么大男孩就是这样做的。我已经专业地为非常大的公司做过这个，所以我不是在猜测。我是从个人经历说的。

提醒一句：理解这些工具确实需要一些时间。这不是简单地安装软件和启动 GUI 的问题，除非您已经接触过多线程编程。我试图确定需要理解的 3 个关键领域类别（表单、会话和 cookie 数据），希望至少从理解这些主题开始可以帮助您专注于快速结果，而不是必须通读整个文档。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2018-06-20T08:06:29.003

并发是内存模型、硬件、缓存和我们的代码之间复杂的相互作用。在 Java 的情况下，至少这些测试主要由[jcstress](https://wiki.openjdk.java.net/display/CodeTools/jcstress)部分解决。众所周知，该库的创建者是许多 JVM、GC 和 Java 并发特性的作者。

但即使是这个库也需要对 Java 内存模型规范有很好的了解，这样我们才能准确地知道我们正在测试什么。但我认为这项工作的重点是 mircobenchmarks。不是庞大的业务应用程序。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2020-04-28T04:14:14.260

有一篇关于该主题的文章，在示例代码中使用 Rust 作为语言：

[https://medium.com/@polyglot_factotum/rust-concurrency-five-easy-pieces-871f1c62906a](https://medium.com/@polyglot_factotum/rust-concurrency-five-easy-pieces-871f1c62906a)

总而言之，诀窍是编写并发逻辑，使其对涉及多个执行线程的非确定性具有鲁棒性，使用通道和 condvars 等工具。

然后，如果这就是您构建“组件”的方式，那么测试它们的最简单方法是使用通道向它们发送消息，然后阻塞其他通道以断言组件发送某些预期的消息。

链接到的文章完全使用单元测试编写。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2021-01-14T21:27:28.570

它并不完美，但我为我在 C# 中的测试编写了这个助手：

```
using System;
using System.Collections.Generic;
using System.Threading;
using System.Threading.Tasks;

namespace Proto.Promises.Tests.Threading
{
    public class ThreadHelper
    {
        public static readonly int multiThreadCount = Environment.ProcessorCount * 100;
        private static readonly int[] offsets = new int[] { 0, 10, 100, 1000 };

        private readonly Stack<Task> _executingTasks = new Stack<Task>(multiThreadCount);
        private readonly Barrier _barrier = new Barrier(1);
        private int _currentParticipants = 0;
        private readonly TimeSpan _timeout;

        public ThreadHelper() : this(TimeSpan.FromSeconds(10)) { } // 10 second timeout should be enough for most cases.

        public ThreadHelper(TimeSpan timeout)
        {
            _timeout = timeout;
        }

        /// <summary>
        /// Execute the action multiple times in parallel threads.
        /// </summary>
        public void ExecuteMultiActionParallel(Action action)
        {
            for (int i = 0; i < multiThreadCount; ++i)
            {
                AddParallelAction(action);
            }
            ExecutePendingParallelActions();
        }

        /// <summary>
        /// Execute the action once in a separate thread.
        /// </summary>
        public void ExecuteSingleAction(Action action)
        {
            AddParallelAction(action);
            ExecutePendingParallelActions();
        }

        /// <summary>
        /// Add an action to be run in parallel.
        /// </summary>
        public void AddParallelAction(Action action)
        {
            var taskSource = new TaskCompletionSource<bool>();
            lock (_executingTasks)
            {
                ++_currentParticipants;
                _barrier.AddParticipant();
                _executingTasks.Push(taskSource.Task);
            }
            new Thread(() =>
            {
                try
                {
                    _barrier.SignalAndWait(); // Try to make actions run in lock-step to increase likelihood of breaking race conditions.
                    action.Invoke();
                    taskSource.SetResult(true);
                }
                catch (Exception e)
                {
                    taskSource.SetException(e);
                }
            }).Start();
        }

        /// <summary>
        /// Runs the pending actions in parallel, attempting to run them in lock-step.
        /// </summary>
        public void ExecutePendingParallelActions()
        {
            Task[] tasks;
            lock (_executingTasks)
            {
                _barrier.SignalAndWait();
                _barrier.RemoveParticipants(_currentParticipants);
                _currentParticipants = 0;
                tasks = _executingTasks.ToArray();
                _executingTasks.Clear();
            }
            try
            {
                if (!Task.WaitAll(tasks, _timeout))
                {
                    throw new TimeoutException($"Action(s) timed out after {_timeout}, there may be a deadlock.");
                }
            }
            catch (AggregateException e)
            {
                // Only throw one exception instead of aggregate to try to avoid overloading the test error output.
                throw e.Flatten().InnerException;
            }
        }

        /// <summary>
        /// Run each action in parallel multiple times with differing offsets for each run.
        /// <para/>The number of runs is 4^actions.Length, so be careful if you don't want the test to run too long.
        /// </summary>
        /// <param name="expandToProcessorCount">If true, copies each action on additional threads up to the processor count. This can help test more without increasing the time it takes to complete.
        /// <para/>Example: 2 actions with 6 processors, runs each action 3 times in parallel.</param>
        /// <param name="setup">The action to run before each parallel run.</param>
        /// <param name="teardown">The action to run after each parallel run.</param>
        /// <param name="actions">The actions to run in parallel.</param>
        public void ExecuteParallelActionsWithOffsets(bool expandToProcessorCount, Action setup, Action teardown, params Action[] actions)
        {
            setup += () => { };
            teardown += () => { };
            int actionCount = actions.Length;
            int expandCount = expandToProcessorCount ? Math.Max(Environment.ProcessorCount / actionCount, 1) : 1;
            foreach (var combo in GenerateCombinations(offsets, actionCount))
            {
                setup.Invoke();
                for (int k = 0; k < expandCount; ++k)
                {
                    for (int i = 0; i < actionCount; ++i)
                    {
                        int offset = combo[i];
                        Action action = actions[i];
                        AddParallelAction(() =>
                        {
                            for (int j = offset; j > 0; --j) { } // Just spin in a loop for the offset.
                            action.Invoke();
                        });
                    }
                }
                ExecutePendingParallelActions();
                teardown.Invoke();
            }
        }

        // Input: [1, 2, 3], 3
        // Ouput: [
        //          [1, 1, 1],
        //          [2, 1, 1],
        //          [3, 1, 1],
        //          [1, 2, 1],
        //          [2, 2, 1],
        //          [3, 2, 1],
        //          [1, 3, 1],
        //          [2, 3, 1],
        //          [3, 3, 1],
        //          [1, 1, 2],
        //          [2, 1, 2],
        //          [3, 1, 2],
        //          [1, 2, 2],
        //          [2, 2, 2],
        //          [3, 2, 2],
        //          [1, 3, 2],
        //          [2, 3, 2],
        //          [3, 3, 2],
        //          [1, 1, 3],
        //          [2, 1, 3],
        //          [3, 1, 3],
        //          [1, 2, 3],
        //          [2, 2, 3],
        //          [3, 2, 3],
        //          [1, 3, 3],
        //          [2, 3, 3],
        //          [3, 3, 3]
        //        ]
        private static IEnumerable<int[]> GenerateCombinations(int[] options, int count)
        {
            int[] indexTracker = new int[count];
            int[] combo = new int[count];
            for (int i = 0; i < count; ++i)
            {
                combo[i] = options[0];
            }
            // Same algorithm as picking a combination lock.
            int rollovers = 0;
            while (rollovers < count)
            {
                yield return combo; // No need to duplicate the array since we're just reading it.
                for (int i = 0; i < count; ++i)
                {
                    int index = ++indexTracker[i];
                    if (index == options.Length)
                    {
                        indexTracker[i] = 0;
                        combo[i] = options[0];
                        if (i == rollovers)
                        {
                            ++rollovers;
                        }
                    }
                    else
                    {
                        combo[i] = options[index];
                        break;
                    }
                }
            }
        }
    }
} 
```

示例用法：

```
[Test]
public void DeferredMayBeBeResolvedAndPromiseAwaitedConcurrently_void0()
{
    Promise.Deferred deferred = default(Promise.Deferred);
    Promise promise = default(Promise);

    int invokedCount = 0;

    var threadHelper = new ThreadHelper();
    threadHelper.ExecuteParallelActionsWithOffsets(false,
        // Setup
        () =>
        {
            invokedCount = 0;
            deferred = Promise.NewDeferred();
            promise = deferred.Promise;
        },
        // Teardown
        () => Assert.AreEqual(1, invokedCount),
        // Parallel Actions
        () => deferred.Resolve(),
        () => promise.Then(() => { Interlocked.Increment(ref invokedCount); }).Forget()
    );
} 
```

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2018-04-09T15:36:22.337

如果您正在测试简单的*new Thread(runnable).run()* 您可以模拟 Thread 以按顺序运行可运行

例如，如果测试对象的代码像这样调用一个新线程

```
Class TestedClass {
    public void doAsychOp() {
       new Thread(new myRunnable()).start();
    }
} 
```

然后模拟新线程并按顺序运行可运行参数会有所帮助

```
@Mock
private Thread threadMock;

@Test
public void myTest() throws Exception {
    PowerMockito.mockStatic(Thread.class);
    //when new thread is created execute runnable immediately 
    PowerMockito.whenNew(Thread.class).withAnyArguments().then(new Answer<Thread>() {
        @Override
        public Thread answer(InvocationOnMock invocation) throws Throwable {
            // immediately run the runnable
            Runnable runnable = invocation.getArgumentAt(0, Runnable.class);
            if(runnable != null) {
                runnable.run();
            }
            return threadMock;//return a mock so Thread.start() will do nothing         
        }
    }); 
    TestedClass testcls = new TestedClass()
    testcls.doAsychOp(); //will invoke myRunnable.run in current thread
    //.... check expected 
} 
```

* * *

## 回答 #26

> 赞同：-4
> 
> 时间：2013-07-04T08:11:57.177

（如果可能）不要使用线程，使用演员/活动对象。易于测试。

* * *

## 回答 #27

> 赞同：-6
> 
> 时间：2014-01-13T11:48:15.807

您可以使用 EasyMock.makeThreadSafe 使测试实例线程安全

# .net - .NET 程序集中的 SVN 修订版，不带 CC.NET

> ID：12176
> 
> 赞同：26
> 
> 时间：2008-08-15T12:15:31.250
> 
> 标签：.net, svn, versioning

有没有办法在 .NET 程序集的版本字符串中包含 SVN 存储库修订号？像 Major.Minor.SVNRev 这样的东西

我已经看到提到使用 CC.NET 之类的东西（虽然实际上是在 ASP.NET 上），但有没有任何方法可以在没有任何额外软件的情况下做到这一点？在使用构建批处理脚本之前，我在 C/C++ 中做过类似的事情，但是通过读取版本号来完成，然后让脚本每次都写出一个名为“ver.h”的文件，效果如下：

```
#define MAJORVER 4
#define MINORVER 23
#define SOURCEVER 965 
```

然后我们将使用这些定义来生成版本字符串。

.NET 可以做到这样的事情吗？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2013-01-07T12:01:10.763

这是用于自动更新程序集中的修订信息的 C# 示例。它基于 Will Dean 的回答，不是很详细。

例子 ：

1.  将 AssemblyInfo.cs 复制到项目文件夹*Properties*中的 AssemblyInfoTemplate.cs 。
2.  *将 AssemblyInfoTemplate.cs 的构建操作*更改为*无*。
3.  将带有 AssemblyFileVersion 的行修改为：

    `[assembly: AssemblyFileVersion("1.0.0.$WCREV$")]`

4.  考虑添加：

    `[assembly: AssemblyInformationalVersion("Build date: $WCNOW=%Y-%m-%d %H:%M:%S$; Revision date: $WCDATE=%Y-%m-%d %H:%M:%S$; Revision(s) in working copy: $WCRANGE$$WCMODS?; WARNING working copy had uncommitted modifications:$.")]`,

    这将提供有关构建程序集的源的修订状态的详细信息。

5.  将以下 Pre-build 事件添加到项目文件属性中：

    `subwcrev "$(SolutionDir)." "$(ProjectDir)Properties\AssemblyInfoTemplate.cs" "$(ProjectDir)Properties\AssemblyInfo.cs" -f`

6.  考虑将 AssemblyInfo.cs 添加到 svn 忽略列表中。替换的修订号和日期将修改文件，这会导致微不足道的更改和修订，并且 $WCMODS$ 将评估为真。当然，AssemblyInfo.cs 必须包含在项目中。

针对 Wim Coenen 的反对意见，我注意到，与 Darryl 的建议相反，AssemblyFileVersion**也不**支持 2^16 以上的数字。构建将完成，但实际程序集中的属性*文件版本*将是 AssemblyFileVersion 模 65536。因此，1.0.0.65536 以及 1.0.0.131072 将产生 1.0.0.0 等。在此示例中，始终存在真实的修订号在 AssemblyInformalVersion 属性中。如果您认为这是一个重要问题，您可以省略第 3 步。

编辑：使用此解决方案一段时间后的一些附加信息。

1.  它现在使用 AssemblyInfo.cst 而不是 AssemblyInfoTemplate.cs，因为它会自动具有*Build Action*选项*None*，并且不会使您的错误列表混乱，但您会失去语法突出显示。
2.  我在 AssemblyInfo.cst 文件中添加了两个测试：

    ```
    #if(!DEBUG)    
        $WCMODS?#error Working copy has uncommitted modifications, please commit all modifications before creating a release build.:$ 
    #endif 
    #if(!DEBUG)       
        $WCMIXED?#error Working copy has multiple revisions, please update to the latest revision before creating a release build.:$ 
    #endif 
    ```

    使用它，您通常必须在提交之后和成功发布构建之前执行完整的 SVN 更新。否则，$WCMIXED 将为真。这似乎是由于提交的文件在提交后重新进行了头部修订，但其他文件没有。

3.  我怀疑 subwcrev 的第一个参数“$(SolutionDir)”，它设置了检查 svn 版本信息的范围，是否总是按预期工作。也许，它应该是 $(ProjectDir)，如果您对每个单独的程序集都处于一致的修订版感到满意。

**补充** *回答@tommylux 的评论。*

SubWcRev 可用于项目中的任何文件。如果你想在网页中显示修订信息，你可以使用这个 VersionInfo 模板：

```
public class VersionInfo
{       
    public const int RevisionNumber = $WCREV$;
    public const string BuildDate = "$WCNOW=%Y-%m-%d %H:%M:%S$";
    public const string RevisionDate = "$WCDATE=%Y-%m-%d %H:%M:%S$";
    public const string RevisionsInWorkingCopy = "$WCRANGE$";
    public const bool UncommitedModification = $WCMODS?true:false$;
} 
```

添加一个与 AssemblyInfo.cst 类似的预构建事件，您将可以轻松访问所有相关的 SubVersion 信息。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-17T13:51:17.447

这是可能的，但您不应该：程序集版本字符串的组件仅限于 16 位数字（最大 65535）。Subversion 版本号很容易变得比这个大，所以在某些时候编译器会突然抱怨。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-08-15T12:29:04.327

看看 SubWCRev - [http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-subwcrev.html](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-subwcrev.html)

程序集版本号通常在 assemblyinfo.cs

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-17T08:21:08.737

阅读/浏览这些文档：

[使用 DotSVN 从 .NET 访问 Subversion 存储库](http://www.codeproject.com/KB/library/subversion_using_dotsvn.aspx?display=PrintAll)

[如何：编写任务](http://msdn.microsoft.com/en-us/library/t9883dzc.aspx)

[在 C# AssemblyInfo 文件中插入 SVN 版本和内部版本号](http://florent.clairambault.fr/insert-svn-version-and-build-number-in-your-c-assemblyinfo-file)

[使用 Microsoft Build Engine 的自定义任务编译应用程序](http://msdn.microsoft.com/en-us/magazine/cc163589.aspx)

第三个参考文献中提到的 MSBuildCommunityTasks svnversion 无法在 Mac 10.5.6 和 VS2008 C# 项目中使用 svn 在 Parallels 托管 Vista 中执行（即跨操作系统）。

编写您自己的任务以使用 DotSVN 从存储库中检索修订：

```
using System;
using Microsoft.Build.Framework;
using Microsoft.Build.Utilities;
using DotSVN.Common;
using DotSVN.Common.Entities;
using DotSVN.Common.Util;
using DotSVN.Server.RepositoryAccess;

namespace GetSVNVersion
{
    public class GetRevision : Task
    {
        [Required]
        public string Repository { get; set; }
        [Output]
        public string Revision { get; set; }

        public override bool Execute()
        {
            ISVNRepository repo;
            bool connected = true;
            try
            {
                repo = SVNRepositoryFactory.Create(new SVNURL(Repository));
                repo.OpenRepository();
                Revision = repo.GetLatestRevision().ToString();
                Log.LogCommandLine(Repository + " is revision " + Revision);
                repo.CloseRepository();
            }
            catch(Exception e)
            {
                Log.LogError("Error retrieving revision number for " + Repository + ": " + e.Message);
                connected = false;
            }
            return connected;
        }
    }
} 
```

这种方式允许存储库路径为“file:///Y:/repo”，其中 Y: 是映射到 Vista 的 Mac 目录。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-02-11T02:40:58.757

另一个答案提到SVN修订号可能不是一个好主意，因为数字大小的限制。

以下链接不仅提供了 SNV 修订号，还提供了日期版本信息模板。

将它添加到 .NET 项目很简单——只需要做很少的工作。

这是一个解决此问题的 github 项目 [https://github.com/AndrewFreemantle/When-The-Version/downloads](https://github.com/AndrewFreemantle/When-The-Version/downloads)

以下 url 可能加载缓慢，但是如何使这项工作的分步说明（简单而简短的 3 或 4 个步骤）

[http://www.fatlemon.co.uk/2011/11/wtv-automatic-date-based-version-numbering-for-net-with-whentheversion/](http://www.fatlemon.co.uk/2011/11/wtv-automatic-date-based-version-numbering-for-net-with-whentheversion/)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-08-15T13:51:52.243

svn info，告诉你你正在使用的版本，你可以在 VS 中对你的项目进行“预构建”事件，通过运行 svn info 并使用自制的命令行应用程序解析其结果来生成 assemblyinfo.cs。

我以前做过，但很快切换到让 ccnet 将它作为变量传递给 nant。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-12T05:48:31.607

如果您想更新项目 AssemblyInfo.cs 中的版本号，您可能会对本文感兴趣：

[CodeProject：在 Visual Studio 项目中使用 Subversion 修订号](http://www.codeproject.com/KB/architecture/svn_visual_studio.aspx)

> 如果您启用 SVN 关键字，那么每次您签入项目时，Subversion 都会扫描您的文件中的某些“关键字”，并用一些信息替换关键字。
> 
> 例如，在我的源文件的顶部，我将创建一个包含以下关键字的标题：
> 
> '$作者:$
> '$Id:$
> '$Rev:$
> 
> 当我将此文件签入 Subversion 时，这些关键字将替换为以下内容：
> 
> '$Author: paulbetteridge $
> '$Id: myfile.vb 145 2008-07-16 15:24:29Z paulbetteridge $
> '$Rev: 145 $

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-08T16:34:24.253

您可以使用可以在所有项目中引用的共享程序集版本文件。

[UppercuT](http://uppercut.googlecode.com)这样做 - [http://ferventcoder.com/archive/2009/05/21/uppercut---automated-builds---versionbuilder.aspx](http://ferventcoder.com/archive/2009/05/21/uppercut---automated-builds---versionbuilder.aspx)

这将使您了解如何在程序集中获取版本。

# asp.net - 问题数据绑定 ASP.Net AJAX 工具包 MaskedEditExtender

> ID：12225
> 
> 赞同：2
> 
> 时间：2008-08-15T13:16:25.263
> 
> 标签：asp.net, validation, asp.net-ajax

我有一个包含日期的数据库，我们正在使用 MaskedEditExtender (MEE) 和 MaskedEditValidator 来确保日期是合适的。但是，我们希望管理员能够在必要时进入并更改数据（特别是日期）。

当数据显示在页面上时，如何让 MEE 字段预填充数据库值？我尝试在“InitialValue”属性中使用“绑定”，但它没有填充文本框。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-19T18:44:53.757

今天早上我们发现了为什么我们的代码错误地处理了扩展程序。由于数据库将日期作为日期/时间处理，因此它以 99/99/9999 99:99:99 这种格式返回日期，但我们让扩展器掩码寻找这种格式 99/99/9999 99:99

```
Mask="99/99/9999 99:99:99"
```

上面的代码解决了这个问题。感谢大家的帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-15T13:45:53.580

您是否指的是 asp.Net Ajax 工具包扩展，位于：

[http://www.asp.net/AJAX/AjaxControlToolkit/Samples/MaskedEdit/MaskedEdit.aspx](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/MaskedEdit/MaskedEdit.aspx)

如果是这样，您是否检查过您的数据是否以正确的格式返回？它必须与您的日期格式匹配才能显示。

# architecture - 命名空间/解决方案结构

> ID：12243
> 
> 赞同：10
> 
> 时间：2008-08-15T13:30:42.690
> 
> 标签：architecture, module, namespaces, legacy

对于提出如此笼统的问题，我深表歉意，但这对我来说可能具有挑战性。我的团队即将开始一个大型项目，希望将多年来发展的所有随机一次性代码库整合在一起。鉴于该项目将涵盖整个公司的标准化逻辑实体（“客户”、“员工”）、小任务、控制小任务的大任务以及公用事业服务，我正在努力找出构建命名空间和代码结构。

虽然我想我没有给你足够的细节来继续下去，**但你有任何资源或建议来说明如何在逻辑上分割你的域**吗？如果有帮助，大部分功能将通过 Web 服务显示，我们是一家拥有所有最新小玩意和小工具的**Microsoft商店。**

*   我正在讨论一个带有子项目的大规模解决方案，以使引用更容易，但这会使其过于笨拙吗？
*   我应该封装遗留的应用程序功能，还是在命名空间中完全不可知（例如，创建一个`OurCRMProduct.Customer`类而不是一个泛型`Customer`类）？
*   每个服务/项目应该有自己的`BAL`and `DAL`，还是应该是一个完全独立的程序集，所有内容都引用？

我没有组织过如此深远的项目的经验，只有一次性的，所以我正在寻找我能得到的任何指导。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-08-15T13:39:01.987

给猫剥皮的方法有一百万种。然而，最简单的总是最好的。哪种方式对您来说最简单？取决于你的要求。但是我遵循一些一般的经验法则。

一是尽可能减少项目总数。当你每天编译 20 次时，额外的一分钟就会增加。

如果您的应用程序是为可扩展性而设计的，请考虑按照设计与实现的方式拆分您的程序集。将接口和基类放在公共程序集中。为贵公司的这些类的实现创建一个程序集。

对于大型应用程序，请将您的 UI 逻辑和业务逻辑分开。

简化您的解决方案。如果它看起来太复杂，它可能是。结合，减少。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-08-15T14:01:08.433

我的建议是，在进行了类似的工作后，不要为名称空间而苦恼。

只需从一些重要的松散准则开始开发，因为无论您从什么开始，您的项目都是有机的，随着时间的推移您最终会重新组织名称空间和类*。*

不要浪费时间过多谈论你的项目。去做就对了。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-08-15T13:39:06.730

我最近在工作中遇到了完全相同的情况。许多需要结构化和组织的临时代码。

一开始真的很难，因为有这么多。我认为我能给出的最好建议就是在周五下午的**风吹草动中投入时间**，几周后我会选择一个应用程序/代码块，检查那里有什么，想想我们能做些什么制作通用的，复制它，把它放到我认为应该放在的新库中。一旦我迁移了应用程序中的所有代码，我就会着手重构应用程序以从通用框架中工作。这有时会导致需要修复的问题，但只要你彻底它不应该太大一个交易。

一点一点，这是唯一的方法。

在结构方面，我试图模仿 MS 命名空间，因为大部分情况下它非常合乎逻辑（例如*Company.Data*、*Company.Web*、*Company.Web.UI*等等。

主要好处之一可能是删除了代码重复的数量。是的，应用程序需要进行一些重构，但代码库要精简得多，并且在许多方面“更智能”。

我注意到的另一件事是，由于我不确定它属于什么，所以我经常在试图弄清楚将东西放在*哪里（在命名空间方面）时遇到问题。*现在这**真的**让我很担心，我认为它是一种难闻的气味。由于重组，现在一切都更好地落入太空。并且使用（现在非常少量的）应用程序特定代码，它们被放入*Company.Applications.ApplicationName*这有助于我更多地考虑业务对象，因为我不想在这个命名空间中有太多东西，所以我想出了更多灵活的设计。

抱歉发了这么长的帖子。这有点漫无边际！

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-08-15T13:43:38.373

我们在 .NET 中使用以下方式命名程序集 Company.Project.XXXX.YYYY，其中 XXXX 是项目，YYYYY 是子项目，例如：

*   LCP.AdmCom.Common
*   LCP.AdmCom.BusinessObjects
*   LCP.AdmCom.Common.Dal

我们从 Krzysztof Cwalina（作者）、Brad Abrams（作者）的[《框架设计指南》一书中获取这一点](https://rads.stackoverflow.com/amzn/click/com/0321545613)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-08-15T13:46:10.413

对于大型项目，我喜欢采用的方法是为我的业务对象创建一个域命名空间，然后在需要存储和检索业务对象的层中使用数据传输对象 (DTO)。DTO 是一个不包含任何业务逻辑的简单对象。

这是一个解释 DTO 的链接：

[http://martinfowler.com/eaaCatalog/dataTransferObject.html](http://martinfowler.com/eaaCatalog/dataTransferObject.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-15T13:40:31.297

包含大量项目的大型解决方案编译起来可能会很慢，但更容易一起管理。

我经常将单元测试程序集与他们正在测试的解决方案放在同一个解决方案中，因为您倾向于一起对它们进行更改。

# .net - Have you ever reflected Reflector?

> ID：12268
> 
> 赞同：2
> 
> 时间：2008-08-15T14:01:15.030
> 
> 标签：.net, reflector

Lutz Roeder's Reflector, that is.

Its obfuscated.

![enter image description here](../Images/d6f595e8e9752142c3983b03e3ee2480.png)

I still don't understand this. Can somebody please explain?

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-08-15T16:55:53.603

I'll accept Keith's answer, but he's 180 degrees off. Its ironic that the tool used to peer at the source of assemblies is obfuscated.

Also, I'm suprised how serious some of you are. Lighten up! What are you, cobol programmers?

<-- (edit: Maybe some of you are!)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-08-15T14:07:58.543

It would have been kind of ironic if it weren't ;-)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-08-15T14:24:13.143

I'm curious what product he uses to obfuscate Reflector. Or maybe it's his custom solution - he obviously knows tons about IL.

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-02-03T13:51:16.590

Of course, I did. For example to find out that .NET Reflector is obfuscated with Dotfuscator.

[DotfuscatorAttribute in Reflector.exe (version 5.1.6.0) http://www.freeimagehosting.net/uploads/7f6eda286f.png](http://www.freeimagehosting.net/uploads/7f6eda286f.png)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-08-15T15:35:47.320

It's always been the case that its been obfuscated. It was one of the first things I tried with it years ago ;).

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-08-15T14:04:06.180

What needs explaining, Reflector isn't open source, Lutz decided to obfuscate to protect his IP. Fair game.

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-16T02:48:30.130

It may have been obfuscated by tools such as Xenocode or Dotfuscator. Or as someone said, Lutz may know a lot about IL.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-15T15:03:04.500

Are you allowed to reflect it according to the EULA (if any) ? I would guess not, and not surprised that you can't.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-20T19:13:25.323

I think you have your answer right here: [Reflector sold to Red Gate](http://blog.lutzroeder.com/2008/08/future-of-net-reflector.html)

# visual-studio - 在“Windows”类别下创建 Visual Studio 模板。

> ID：12271
> 
> 赞同：3
> 
> 时间：2008-08-15T14:04:01.017
> 
> 标签：visual-studio, templates

我为 Visual Studio 2008 创建了一个模板，它目前显示在 File->New Project->Visual C# 下。但是，它只是真正特定于 Visual C#/Windows，但我不知道如何让它显示在“Windows”类别下，而不是更通用的“Visual C#”。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-15T17:17:11.797

查看 MSDN“[如何：定位和组织项目和项目模板](http://msdn.microsoft.com/en-us/library/y3kkate1.aspx)”

在其中一个中创建一个文件夹

```
<VisualStudioInstallDir>\Common7\IDE\ItemTemplates\CSharp\
My Documents\Visual Studio 2008\Templates\ProjectTemplates\CSharp\ 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-15T14:31:21.867

模板的分类取决于设置（例如，如果您选择“C#”设置，所有其他语言会突然移动到“其他语言”树）。

你的模板在哪个文件夹？

# asp.net - 考虑 N2 CMS 但担心性能。这是合理的吗？

> ID：12290
> 
> 赞同：6
> 
> 时间：2008-08-15T14:29:20.887
> 
> 标签：asp.net, performance, .net-3.5, content-management-system, n2

嗨，有没有人使用过 N2 内容管理系统（[http://www.codeplex.com/n2](http://www.codeplex.com/n2)）。如果是，它的性能如何（在重负载下）？它看起来非常简单易用。

阿德里安

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-19T01:24:09.923

也许在[http://www.codeplex.com/n2/Thread/List.aspx试试这个问题](http://www.codeplex.com/n2/Thread/List.aspx)

他们可能会告诉您性能限制或瓶颈。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-05-07T13:27:49.300

[http://whocanhelpme.codeplex.com/](http://whocanhelpme.codeplex.com/)和[http://www.fancydressoutfitters.co.uk/](http://www.fancydressoutfitters.co.uk/)基于 n2cms。

阅读更多关于詹姆斯布鲁姆的博客[http://jamesbroo.me/integrating-n2cms-into-who-can-help-me/](http://jamesbroo.me/integrating-n2cms-into-who-can-help-me/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-07-04T12:49:14.917

我们在 N2 中建立了许多站点，我们喜欢它。

其中许多网站每天有超过 20,000 名用户访问。我们还对多达 50,000 名用户进行了负载测试，没有出现任何问题。

它运行在相当普通的硬件上——一台网络服务器，一台数据库服务器。

启用缓存后速度非常快，因为数据库几乎不会受到影响！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-30T16:16:37.917

我试过了，一开始看起来很有希望，但很快就遇到了实际将它部署到 Medium Trust 主机的问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-06-20T11:15:52.587

我有 2 个使用 N2 CMS 的高流量网站，它快速可靠

# charts - 有什么创建时间线的好工具吗？

> ID：12294
> 
> 赞同：8
> 
> 时间：2008-08-15T14:32:52.003
> 
> 标签：charts, timeline

我需要创建一个从 1600 年代到现在的历史时间线。我还需要某种方式在时间轴上显示事件，这样当许多事件靠近时它们不会显得混乱。

我曾尝试使用 Visio 2007 以及 Excel 2007 Radar Charts，但无法获得我想要的结果。Visio 中的时间线模板不是很好，在 Excel 中使用雷达图表会导致数据混乱。

我可以使用其他任何工具或技术来创建这些吗？

**@Darren：**
第一个链接看起来很棒。谢谢！第二个链接在 Firefox 中不起作用，并呈现为 ASCII。它在 IE 中打开得很好。
是的，这是针对最终用户的。所以我希望它看起来尽可能像样，如果你明白我的意思的话。
再次感谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-15T14:33:25.123

SIMILIE Timeline 可能会满足您的需求。 [http://simile.mit.edu/timeline/](http://simile.mit.edu/timeline/)

时间线 .NET： http: [//www.codeplex.com/timelinenet](http://www.codeplex.com/timelinenet)

哦，我想我应该问...供个人使用还是向最终用户展示？这可能会改变我的建议，但我想这也可以用于内部目的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-08-15T14:44:32.730

[Lifehacker](http://lifehacker.com/)对[SIMILIE Timeline](http://simile.mit.edu/timeline/)有很好的[概述和教程](http://lifehacker.com/software/memory/geek-to-live--roll-your-own-timeline-207426.php)。他们似乎非常喜欢它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-15T14:47:39.367

如果您需要来自 RSS Feeds 的时间线，请尝试 xTimeline。我刚用过

[http://lifehacker.com/software/rss/create-a-timeline-from-rss-feeds-with-xtimeline-283098.php](http://lifehacker.com/software/rss/create-a-timeline-from-rss-feeds-with-xtimeline-283098.php)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-15T15:25:44.503

@Pascal 这个页面？[http://tools.mscorlib.com/timeline/Default.aspx](http://tools.mscorlib.com/timeline/Default.aspx)。如果它看起来像 ascii 可能会寻找 js 错误，但这在我的系统上呈现正常。如果一切都失败了，它是 MIT 团队的一个不错的 js 库，所以你可以连接你自己的实现

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T20:08:22.863

我还推荐 Simile Timeline... 我刚刚实现了一个网页，它使用它和 JQuery 并产生了奇妙的结果。缺点是您需要通过一些 html 页面来实现它，将其与 js 挂钩并创建一些 xml 文件，因此它可能不适用于演示工具。

[http://infosthetics.com/](http://infosthetics.com/)是一个很好的数据可视化博客，也许你会在那里找到一些东西。还要检查flowingdata.com

对于基于网络的时间线，还有：

circavie：[http ://flowingdata.com/2007/10/25/create-share-and-embed-custom-timelines-with-circavie/](http://flowingdata.com/2007/10/25/create-share-and-embed-custom-timelines-with-circavie/)

dipity（看起来很杀手）：[http ://flowingdata.com/2008/08/18/tell-stories-with-interactive-timelines-from-dipity/](http://flowingdata.com/2008/08/18/tell-stories-with-interactive-timelines-from-dipity/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-03-31T05:41:15.007

您可以使用这个用 JavaScript 构建的出色时间线工具。

你可以在这里免费下载：http: [//timeline.verite.co/#examples](http://timeline.verite.co/#examples)

# asp.net - 如何从 SiteMapNodeCollection 中删除节点？

> ID：12297
> 
> 赞同：1
> 
> 时间：2008-08-15T14:38:18.920
> 
> 标签：asp.net, .net, vb.net, repeater, sitemap

我有一个Repeater，它列出`web.sitemap`了ASP.NET 页面上的所有子页面。它`DataSource`是一个`SiteMapNodeCollection`. 但是，我不希望我的注册表单页面出现在那里。

```
Dim Children As SiteMapNodeCollection = SiteMap.CurrentNode.ChildNodes

'remove registration page from collection
For Each n As SiteMapNode In SiteMap.CurrentNode.ChildNodes
If n.Url = "/Registration.aspx" Then
    Children.Remove(n)
End If
Next

RepeaterSubordinatePages.DataSource = Children 
```

该`SiteMapNodeCollection.Remove()`方法抛出一个

> NotSupportedException：“集合是只读的”。

如何在 DataBinding 中继器之前从集合中删除节点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-15T14:44:45.380

使用 Linq 和 .Net 3.5：

```
//this will now be an enumeration, rather than a read only collection
Dim children = SiteMap.CurrentNode.ChildNodes.Where( _
    Function (x) x.Url <> "/Registration.aspx" )

RepeaterSubordinatePages.DataSource = children 
```

没有 Linq，但使用 .Net 2：

```
Function IsShown( n as SiteMapNode ) as Boolean
    Return n.Url <> "/Registration.aspx"
End Function

...

//get a generic list
Dim children as List(Of SiteMapNode) = _
    New List(Of SiteMapNode) ( SiteMap.CurrentNode.ChildNodes )

//use the generic list's FindAll method
RepeaterSubordinatePages.DataSource = children.FindAll( IsShown ) 
```

避免从集合中删除项目，因为这总是很慢。除非您要循环多次，否则最好过滤。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-15T15:28:40.987

你不应该需要 CType

```
Dim children = _
    From n In SiteMap.CurrentNode.ChildNodes.Cast(Of SiteMapNode)() _
    Where n.Url <> "/Registration.aspx" _
    Select n 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-15T15:25:15.547

我让它与下面的代码一起工作：

```
Dim children = From n In SiteMap.CurrentNode.ChildNodes _
               Where CType(n, SiteMapNode).Url <> "/Registration.aspx" _
               Select n
RepeaterSubordinatePages.DataSource = children 
```

有没有更好的方法我不必使用`CType()`？

此外，这会将 children 设置为`System.Collections.Generic.IEnumerable(Of Object)`. 有没有一种好方法可以找回像 a`System.Collections.Generic.IEnumerable(Of System.Web.SiteMapNode)`甚至更好的 a类型更强的东西`System.Web.SiteMapNodeCollection`？

# sql-server - 为什么Sql Server 2005 维护计划对dbcc checkdb 使用错误的数据库？

> ID：12304
> 
> 赞同：0
> 
> 时间：2008-08-15T14:45:33.070
> 
> 标签：sql-server, sql-server-2005

这是我看到除了我自己之外的其他人的问题，我还没有找到一个很好的解释。

假设您有一个维护计划，其中包含检查数据库的任务，如下所示：

```
USE [MyDb]
GO
DBCC CHECKDB with no_infomsgs, all_errormsgs 
```

如果您在任务执行后查看日志，您可能会看到如下内容：

```
08/15/2008 06:00:22,spid55,Unknown,DBCC CHECKDB (mssqlsystemresource) executed by NT AUTHORITY\SYSTEM found 0 errors and repaired 0 errors. Elapsed time: 0 hours 0 minutes 0 seconds.
08/15/2008 06:00:21,spid55,Unknown,DBCC CHECKDB (master) executed by NT AUTHORITY\SYSTEM found 0 errors and repaired 0 errors. Elapsed time: 0 hours 0 minutes 0 seconds. 
```

它没有检查 MyDb，而是检查了 master 和 msssqlsystemresource。

为什么？

我的解决方法是使用以下方法创建一个 Sql Server 代理作业：

```
dbcc checkdb ('MyDb') with no_infomsgs, all_errormsgs; 
```

这总是很好。

```
08/15/2008 04:26:04,spid54,Unknown,DBCC CHECKDB (MyDb) WITH all_errormsgs<c/> no_infomsgs executed by NT AUTHORITY\SYSTEM found 0 errors and repaired 0 errors. Elapsed time: 0 hours 26 minutes 3 seconds. 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-15T15:00:16.380

对于初学者，永远记住那`GO`不是 SQL 关键字；它只是（通常）由客户端而不是服务器实现/识别的批处理分隔符。因此，根据上下文和客户端，确实不能保证当前数据库在批次之间得到保留。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-15T15:34:09.180

如果您正在使用维护计划，您可能最好使用检查数据库完整性任务。如果你真的想运行你自己用 t-sql 编写的维护，那么使用作业中的一个步骤来运行它，而不是在维护计划中，上面的代码可以正常工作。就像 Stu 所说，GO 语句是客户端指令而不是 sql 关键字，并且似乎只受到 isql、wsql、osql 等客户端和 sql 代理的尊重。我认为它适用于 DTS 包。显然，不是在 DTSX 中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-15T19:22:39.093

你有一个检查数据库完整性任务，你双击它选择MyDb，当计划运行时它只检查master？诡异的。你确定你没有另一个计划运行吗？

# c# - 我可以序列化 C# 类型对象吗？

> ID：12306
> 
> 赞同：60
> 
> 时间：2008-08-15T14:46:07.687
> 
> 标签：c#, serialization

我正在尝试通过以下方式序列化 Type 对象：

```
Type myType = typeof (StringBuilder);
var serializer = new XmlSerializer(typeof(Type));
TextWriter writer = new StringWriter();
serializer.Serialize(writer, myType); 
```

当我这样做时，对 Serialize 的调用会引发以下异常：

> “类型 System.Text.StringBuilder 不是预期的。使用 XmlInclude 或 SoapInclude 属性指定静态未知的类型。”

有没有办法让我序列化`Type`对象？请注意，我不是要序列化`StringBuilder`自身，而是`Type`包含有关`StringBuilder`该类的元数据的对象。

* * *

## 回答 #1

> 赞同：98
> 
> 时间：2008-08-15T15:12:43.373

我不知道可以仅使用包含完全限定名称的字符串来创建 Type 对象。要获取完全限定名称，您可以使用以下内容：

```
string typeName = typeof (StringBuilder).FullName; 
```

然后，您可以根据需要保留此字符串，然后像这样重建类型：

```
Type t = Type.GetType(typeName); 
```

如果需要创建该类型的实例，可以这样做：

```
object o = Activator.CreateInstance(t); 
```

如果您检查 o.GetType() 的值，它将是 StringBuilder，正如您所期望的那样。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2012-03-21T17:34:43.790

我遇到了同样的问题，我的解决方案是创建一个 SerializableType 类。它自由地与 System.Type 相互转换，但它序列化为字符串。您所要做的就是将变量声明为 SerializableType，然后您就可以将其称为 System.Type。

这是课程：

```
// a version of System.Type that can be serialized
[DataContract]
public class SerializableType
{
    public Type type;

    // when serializing, store as a string
    [DataMember]
    string TypeString
    {
        get
        {
            if (type == null)
                return null;
            return type.FullName;
        }
        set
        {
            if (value == null)
                type = null;
            else
            {
                type = Type.GetType(value);
            }
        }
    }

    // constructors
    public SerializableType()
    {
        type = null;
    }
    public SerializableType(Type t)
    {
        type = t;
    }

    // allow SerializableType to implicitly be converted to and from System.Type
    static public implicit operator Type(SerializableType stype)
    {
        return stype.type;
    }
    static public implicit operator SerializableType(Type t)
    {
        return new SerializableType(t);
    }

    // overload the == and != operators
    public static bool operator ==(SerializableType a, SerializableType b)
    {
        // If both are null, or both are same instance, return true.
        if (System.Object.ReferenceEquals(a, b))
        {
            return true;
        }

        // If one is null, but not both, return false.
        if (((object)a == null) || ((object)b == null))
        {
            return false;
        }

        // Return true if the fields match:
        return a.type == b.type;
    }
    public static bool operator !=(SerializableType a, SerializableType b)
    {
        return !(a == b);
    }
    // we don't need to overload operators between SerializableType and System.Type because we already enabled them to implicitly convert

    public override int GetHashCode()
    {
        return type.GetHashCode();
    }

    // overload the .Equals method
    public override bool Equals(System.Object obj)
    {
        // If parameter is null return false.
        if (obj == null)
        {
            return false;
        }

        // If parameter cannot be cast to SerializableType return false.
        SerializableType p = obj as SerializableType;
        if ((System.Object)p == null)
        {
            return false;
        }

        // Return true if the fields match:
        return (type == p.type);
    }
    public bool Equals(SerializableType p)
    {
        // If parameter is null return false:
        if ((object)p == null)
        {
            return false;
        }

        // Return true if the fields match:
        return (type == p.type);
    }
} 
```

和一个使用示例：

```
[DataContract]
public class A
{

    ...

    [DataMember]
    private Dictionary<SerializableType, B> _bees;

    ...

    public B GetB(Type type)
    {
        return _bees[type];
    }

    ...

} 
```

您也可以考虑使用 AssemblyQualifiedName 而不是 Type.FullName - 请参阅@GreyCloud 的评论

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2014-01-29T15:19:01.660

[如果类型与调用在同一个程序集中， Brian 的](https://stackoverflow.com/a/12342/752842)回答效果很好（就像 GreyCloud 在其中一条评论中指出的那样）。因此，如果该类型在另一个程序集中，您需要使用[AssemblyQualifiedName](http://msdn.microsoft.com/en-us/library/system.type.assemblyqualifiedname%28v=vs.110%29.aspx)，正如 GreyCloud 还指出的那样。

但是，当[AssemblyQualifiedName](http://msdn.microsoft.com/en-us/library/system.type.assemblyqualifiedname%28v=vs.110%29.aspx)保存版本时，如果您的程序集的版本与您拥有该类型的字符串中的版本不同，它将不起作用。

就我而言，这是一个问题，我这样解决了：

```
string typeName = typeof (MyClass).FullName;

Type type = GetTypeFrom(typeName);

object myInstance = Activator.CreateInstance(type); 
```

**GetTypeFrom 方法**

```
private Type GetTypeFrom(string valueType)
    {
        var type = Type.GetType(valueType);
        if (type != null)
            return type;

        try
        {
            var assemblies = AppDomain.CurrentDomain.GetAssemblies();                

            //To speed things up, we check first in the already loaded assemblies.
            foreach (var assembly in assemblies)
            {
                type = assembly.GetType(valueType);
                if (type != null)
                    break;
            }
            if (type != null)
                return type;

            var loadedAssemblies = assemblies.ToList();

            foreach (var loadedAssembly in assemblies)
            {
                foreach (AssemblyName referencedAssemblyName in loadedAssembly.GetReferencedAssemblies())
                {
                    var found = loadedAssemblies.All(x => x.GetName() != referencedAssemblyName);

                    if (!found)
                    {
                        try
                        {
                            var referencedAssembly = Assembly.Load(referencedAssemblyName);
                            type = referencedAssembly.GetType(valueType);
                            if (type != null)
                                break;
                            loadedAssemblies.Add(referencedAssembly);
                        }
                        catch
                        {
                            //We will ignore this, because the Type might still be in one of the other Assemblies.
                        }
                    }
                }
            }                
        }
        catch(Exception exception)
        {
            //throw my custom exception    
        }

        if (type == null)
        {
            //throw my custom exception.
        }

        return type;
    } 
```

我发布这个以防有人需要。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-15T14:50:59.097

根据 System.Type [1] 的 MSDN 文档，您应该能够序列化 System.Type 对象。但是，由于错误明确引用 System.Text.StringBuilder，这可能是导致序列化错误的类。

[1] 类型类（系统） - [http://msdn.microsoft.com/en-us/library/system.type.aspx](http://msdn.microsoft.com/en-us/library/system.type.aspx)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-02-22T15:36:07.530

我在尝试在 .net 标准 2.0 中进行二进制序列化时遇到了这个问题。我最终使用自定义`SurrogateSelector`和`SerializationBinder`.

是必需的`TypeSerializationBinder`，因为框架`System.RuntimeType`在获得`SurrogateSelector`. 我真的不明白为什么必须在此步骤之前解析类型...

这是代码：

```
// Serializes and deserializes System.Type
public class TypeSerializationSurrogate : ISerializationSurrogate {
    public void GetObjectData(object obj, SerializationInfo info, StreamingContext context) {
        info.AddValue(nameof(Type.FullName), (obj as Type).FullName);
    }

    public object SetObjectData(object obj, SerializationInfo info, StreamingContext context, ISurrogateSelector selector) {
        return Type.GetType(info.GetString(nameof(Type.FullName)));
    }
}

// Just a stub, doesn't need an implementation
public class TypeStub : Type { ... }

// Binds "System.RuntimeType" to our TypeStub
public class TypeSerializationBinder : SerializationBinder {
    public override Type BindToType(string assemblyName, string typeName) {
        if(typeName == "System.RuntimeType") {
            return typeof(TypeStub);
        }
        return Type.GetType($"{typeName}, {assemblyName}");
    }
}

// Selected out TypeSerializationSurrogate when [de]serializing Type
public class TypeSurrogateSelector : ISurrogateSelector {
    public virtual void ChainSelector(ISurrogateSelector selector) => throw new NotSupportedException();

    public virtual ISurrogateSelector GetNextSelector() => throw new NotSupportedException();

    public virtual ISerializationSurrogate GetSurrogate(Type type, StreamingContext context, out ISurrogateSelector selector) {
        if(typeof(Type).IsAssignableFrom(type)) {
            selector = this;
            return new TypeSerializationSurrogate();
        }
        selector = null;
        return null;
    }
} 
```

使用示例：

```
byte[] bytes
var serializeFormatter = new BinaryFormatter() {
    SurrogateSelector = new TypeSurrogateSelector()
}
using (var stream = new MemoryStream()) {
    serializeFormatter.Serialize(stream, typeof(string));
    bytes = stream.ToArray();
}

var deserializeFormatter = new BinaryFormatter() {
    SurrogateSelector = new TypeSurrogateSelector(),
    Binder = new TypeDeserializationBinder()
}
using (var stream = new MemoryStream(bytes)) {
    type = (Type)deserializeFormatter .Deserialize(stream);
    Assert.Equal(typeof(string), type);
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-15T14:50:09.520

刚刚看了一下它的定义，并没有标记为Serializable。如果您确实需要序列化此数据，则可能必须将其转换为标记为此类的自定义类。

```
public abstract class Type : System.Reflection.MemberInfo
    Member of System

Summary:
Represents type declarations: class types, interface types, array types, value types, enumeration types, type parameters, generic type definitions, and open or closed constructed generic types.

Attributes:
[System.Runtime.InteropServices.ClassInterfaceAttribute(0),
System.Runtime.InteropServices.ComDefaultInterfaceAttribute(System.Runtime.InteropServices._Type),
System.Runtime.InteropServices.ComVisibleAttribute(true)] 
```

# c++ - Mac OS X 下的 _wfopen 等效项

> ID：12319
> 
> 赞同：18
> 
> 时间：2008-08-15T14:59:11.653
> 
> 标签：c++, winapi, macos, porting, fopen

我正在寻找相当于[`_wfopen()`](http://msdn.microsoft.com/fr-fr/library/yeby3zcb.aspx)Mac OS X 下的 Windows。知道吗？

我需要这个来移植一个`wchar*`用于其文件接口的 Windows 库。由于这是一个跨平台库，我无法依赖客户端应用程序如何获取文件路径并将其提供给库。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-11-05T15:07:26.817

Mac OS X 中的 POSIX API 可用于 UTF-8 字符串。为了将 wchar_t 字符串转换为 UTF-8，可以使用 Mac OS X 的 CoreFoundation 框架。

这是一个类，它将从 wchar_t 字符串包装一个 UTF-8 生成的字符串。

```
class Utf8
{
public:
    Utf8(const wchar_t* wsz): m_utf8(NULL)
    {
        // OS X uses 32-bit wchar
        const int bytes = wcslen(wsz) * sizeof(wchar_t);
        // comp_bLittleEndian is in the lib I use in order to detect PowerPC/Intel
        CFStringEncoding encoding = comp_bLittleEndian ? kCFStringEncodingUTF32LE
                                                       : kCFStringEncodingUTF32BE;
        CFStringRef str = CFStringCreateWithBytesNoCopy(NULL, 
                                                       (const UInt8*)wsz, bytes, 
                                                        encoding, false, 
                                                        kCFAllocatorNull
                                                        );

        const int bytesUtf8 = CFStringGetMaximumSizeOfFileSystemRepresentation(str);
        m_utf8 = new char[bytesUtf8];
        CFStringGetFileSystemRepresentation(str, m_utf8, bytesUtf8);
        CFRelease(str);
    }   

    ~Utf8() 
    { 
        if( m_utf8 )
        {
            delete[] m_utf8;
        }
    }

public:
    operator const char*() const { return m_utf8; }

private:
    char* m_utf8;
}; 
```

用法：

```
const wchar_t wsz = L"Here is some Unicode content: éà€œæ";
const Utf8 utf8 = wsz;
FILE* file = fopen(utf8, "r"); 
```

这将适用于读取或写入文件。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-08-17T08:43:14.877

您只想使用可能包含 Unicode 字符的路径打开文件句柄，对吗？*只需将文件系统表示*中的路径传递给`fopen`.

*   如果路径来自现有的 Mac OS X 框架（例如，无论是 Carbon 还是 Cocoa 的 Open 面板），您不需要对其进行任何转换，并且可以按原样使用它。

*   如果您自己生成路径的一部分，您应该从您的路径创建一个 CFStringRef，然后在文件系统表示中获取它以传递给 POSIX API，如`open`或`fopen`.

一般来说，对于大多数应用程序，您不必做很多这样的事情。例如，许多应用程序可能将辅助数据文件存储在用户的应用程序支持目录中，但只要这些文件的名称是 ASCII，并且您使用标准 Mac OS X API 来定位用户的应用程序支持目录，则不需要对用这两个组件构建的路径进行一堆偏执的转换。

*编辑添加：* 我强烈警告**不要**使用类似的东西任意将所有内容转换为 UTF-8，`wcstombs`因为文件系统编码不一定与生成的 UTF-8 相同。Mac OS X 和 Windows 都对文件系统路径中使用的编码使用特定（但不同）的规范分解规则。

例如，他们需要决定是否将“é”存储为一个或两个代码单元（`LATIN SMALL LETTER E WITH ACUTE`或者`LATIN SMALL LETTER E`后跟`COMBINING ACUTE ACCENT`）。这将导致两个不同且长度不同的字节序列，并且 Mac OS X 和 Windows 都努力避免将多个具有相同名称的文件（如用户感知的那样）放在同一目录中。

如何执行这种规范分解的规则可能会变得非常复杂，因此与其尝试自己实现它，最好将其留给系统框架为您提供的功能来完成繁重的工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-02T11:24:19.660

@JKP：

并非 MacOS X 中的所有函数都接受 UTF8，但文件名和文件路径可能是 UTF8，因此所有处理文件访问（open、fopen、stat 等）的 POSIX 函数都接受 UTF8。

见[这里](http://lists.apple.com/archives/applescript-users/2002/Sep/msg00319.html)。引用：

> 文件名在 API 级别的外观取决于 API。当前的 Carbon API 将文件名处理为 UTF-16 字符数组；POSIX 将它们作为 UTF-8 数组处理，这就是 UTF-8 在终端中运行良好的原因。它在磁盘上的存储方式取决于磁盘格式；HFS+ 使用 UTF-16，但这在大多数情况下并不重要。

其他一些 POSIX 函数也处理 UTF8。例如处理用户名、组名或用户密码的函数使用UTF8 来存储信息（因此用户名可以是日语，密码可以是中文，没问题）。

但并非所有人都处理 UTF8。例如，对于所有字符串函数，UTF8 字符串只是一个普通的 C 字符串，126 以上的字符没有特殊含义。他们不理解形成单个 Unicode 字符的多个字节（C 中的字符）的概念。其他 API 处理传递给它们的 char * 指针的方式因 API 不同而不同。但是，根据经验，您可以说：

该函数要么只接受带有纯 ASCII 字符（仅在 0 到 126 范围内）的 C 字符串，要么接受 UTF8。通常函数不允许超过 126 的字符并以除 UTF8 之外的任何其他编码来解释它们。如果确实是这种情况，则会记录在案，然后必须有一种方法可以将编码与字符串一起传递。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-15T15:26:26.920

如果您使用的是 Cocoa，则使用 NSString 相当容易。只需使用 -initWithBytes:length:encoding: （或者可能是 -initWithCString:encoding:) 加载 UTF16 数据，然后通过在结果上调用 UTF8String 来获取 UTF8 版本。然后，只需使用新的 UTF8 字符串作为参数调用 fopen。

无论语言如何，您绝对可以使用 UTF-8 字符串调用 fopen - 虽然在 OSX 上无法使用 C++ - 抱歉。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-12-27T11:46:16.403

我已经通过**wifstream**从配置 UTF8 文件中读取了文件名（它使用**wchar_t**缓冲区）。

Mac 实现不同于 Linux 和 Windows。wifstream 从文件中读取每个字节以分隔缓冲区中的 wchar_t 单元。所以我们有 3 个空字节，尽管**open**需要**char**字符串。因此程序员可以使用**wcstombs**函数将宽字符串转换为多字节字符串。

API 支持 UTF8。为了更好地理解您的文件，请使用内存观察程序和十六进制编辑器。

# vbscript - 以编程方式列出 WMI 类及其属性

> ID：12330
> 
> 赞同：7
> 
> 时间：2008-08-15T15:06:31.873
> 
> 标签：vbscript, wmi

是否有任何已知方法可以列出特定系统可用的 WMI 类及其属性？我对 vbscript 方法感兴趣，但请提出任何真正的建议:)

PS 很棒的网站。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-15T15:33:42.847

我相信这就是你想要的。

[WMI 代码创建者](http://www.microsoft.com/downloads/details.aspx?familyid=2cc30a64-ea15-4661-8da4-55bbc145c30e&displaylang=en)

这个漂亮实用程序的一部分允许您浏览本地和远程 PC 上的命名空间/类/属性，更不用说在 VBScript/C#/VB 中即时生成 WMI 代码。很有用。

此外，用于创建实用程序的源代码包含在下载中，如果您想创建自己的浏览器式界面，可以提供参考。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T23:15:47.687

此 MSDN 页面介绍了枚举可用类：[如何：列出 WMI 命名空间中的类](http://msdn.microsoft.com/en-us/library/bb429532.aspx)

从类中检索属性：

```
ManagementPath l_Path = new ManagementPath(l_className);
ManagementClass l_Class = new ManagementClass(myScope, l_ManagementPath, null);
foreach (PropertyData l_PropertyData in l_Class.Properties)
{
    string l_type = l_PropertyData.Type.ToString());
    int l_length = Convert.ToInt32(l_PropertyData.Qualifiers["maxlen"].Value);           
} 
```

# c++ - 在 C/C++ 程序中，系统（windows、linux、mac OS X）如何调用 main() 函数？

> ID：12332
> 
> 赞同：18
> 
> 时间：2008-08-15T15:08:48.560
> 
> 标签：c++, c, main

我正在寻找更技术性的解释，然后操作系统调用该函数。

任何人都可以帮助我或将我指向一个网站或书籍吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-08-15T15:50:12.457

.exe 文件（或其他平台上的等效文件）包含一个“入口点”地址。大致上，操作系统将 .EXE 文件的相关部分加载到 ram 中，然后跳转到入口点。

正如其他人所说，这个入口点不会是“main”，而是运行时库的一部分——它会做一些事情，比如初始化静态对象、设置 argc/argv 参数、设置 stdin/stdout/stderr等。完成所有这些后，它将调用您的 main() 函数。当 main 退出时，运行时会经历一个类似的过程，将返回代码传回环境，调用静态析构函数，调用 _atexit 例程等。

如果你有 MS 工具（也许不是免费的），那么你就有了所有运行时源代码，查看它的一种简单方法是在 main() 方法的右大括号上放置一个断点，然后单步备份进入运行时。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-08-15T15:19:16.713

`main()`是 C 库的一部分，不是系统函数。我不知道 OS X 或 Linux，但 Windows 通常以`WinMainCRTStartup()`. 此符号初始化您的进程，提取命令行参数和环境 ( `argc, argv, end`) 并调用`main()`。它还负责调用应该在之后运行的任何代码`main()`，例如`atexit()`.

通过查看您的 Visual Studio 文件，您应该能够找到 的默认实现`WinMainCRTStartup`以了解它的作用。

您还可以定义自己的函数以在启动时调用，这是通过更改链接器选项中的“入口点”来完成的。这通常是一个不带参数并返回 void 的函数。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-08-28T20:23:52.437

就 Windows 而言，入口点功能是：

*   安慰：`void __cdecl mainCRTStartup( void ) {}`
*   图形用户界面：`void __stdcall WinMainCRTStartup( void ) {}`
*   动态链接库：`BOOL __stdcall _DllMainCRTStartup(HINSTANCE hinstDLL,DWORD fdwReason,void* lpReserved) {}`

使用这些而不是普通的 main/WinMain/DllMain 的唯一原因是如果您想使用自己的运行时库（如果您想要更小的文件大小或自定义功能）

有关自定义运行时实现和其他获取更小的 PE 文件的技巧，请参阅：

*   [http://www.microsoft.com/msj/archive/S569.aspx](http://www.microsoft.com/msj/archive/S569.aspx)
*   [http://www.codeproject.com/KB/tips/aggressiveoptimize.aspx](http://www.codeproject.com/KB/tips/aggressiveoptimize.aspx)
*   [http://www.catch22.net/tuts/minexe.asp](http://www.catch22.net/tuts/minexe.asp)
*   [http://www.hailstorm.net/papers/smallwin32.htm](http://www.hailstorm.net/papers/smallwin32.htm)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-15T16:35:07.403

[Expert C++/CLI](http://books.google.com/books?id=wZoQyVi5f60C&printsec=frontcover&dq=expert+c%2B%2B%2Fcli&ei=MKylSPz2JJOaigHlkLn7BA&sig=ACfU3U36tvex7dO7wVyGtuy1arcJuU3N0g)（查看第 279 页）有非常具体的关于本机、混合和纯 CLR 程序集的不同引导方案的详细信息。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-27T18:40:29.043

它取决于操作系统。在 OS X 中，mach 标头中有一个帧，其中包含 EIP（指令指针）寄存器的起始地址。

一旦二进制文件被加载，操作系统就会从这个地址开始执行：

```
cristi:test diciu$ otool -l ./a.out | grep -A 10 LC_UNIXTHREAD
        cmd LC_UNIXTHREAD
    cmdsize 80
     风味 i386_THREAD_STATE
      计数 i386_THREAD_STATE_COUNT
[..]
        ss 0x00000000 eflags 0x00000000 eip 0x00001f8c cs 0x00000000
[..]

```

地址是二进制文件中“start”函数的地址：

```
cristi:test diciu$ nm ./a.out
0000200c D_NXArgc
00002008 D_NXArgv
00002000 D ___程序名称
00001fe0 t __dyld_func_lookup
00001000 A __mh_execute_header
[..]
00001f8c T 开始

```

在 Mac OS X 中，首先调用的是“start”函数，甚至在“main”函数之前：

```
(gdb) b 开始
0x1f90 处的断点 1
(gdb) b 主要
0x1ff4 处的断点 2
(gdb) r
启动程序：/Users/diciu/Programming/test/a.out
共享库 ++ 的读取符号。完毕

断点 1, 0x00001f90 in start()

```

# php - Windows 上的 PHP/cURL 安装：“找不到指定的模块。”

> ID：12348
> 
> 赞同：29
> 
> 时间：2008-08-15T15:17:30.073
> 
> 标签：php, windows, curl

我在带有 IIS 5 的 Windows 2000 Server 上运行 PHP 5.2.3。我试图让 cURL 工作，所以在我的**php.ini**文件中，我有这一行：

> extension_dir ="F:\PHP\ext"

后来，我有：

> 扩展=php_curl.dll

文件**F:\PHP\ext\php_curl.dll**存在，但是当我尝试运行任何 PHP 脚本时，我在错误日志中得到这个：

> PHP 警告：PHP 启动：无法加载动态库 'F:\PHP\ext \php_curl.dll' - 找不到指定的模块。在第 0 行的未知中

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-08-15T15:18:53.063

问题解决了！

虽然错误信息说**找不到指定的模块**，但这有点误导——不是找不到`php_curl.dll`，而是找不到`php_curl.dll`需要的模块。它需要的 2 个 DLL 是`libeay32.dll`和`SSLeay32.dll`.

因此，您必须将这 2 个 DLL 放在 PATH 中的某个位置（例如，`C:\Windows\system32`）。这里的所有都是它的。

然而，即使这样最初对我也不起作用。所以我下载了最新版本的 PHP 的 Windows zip，其中包括所有必要的 DLL。我没有重新安装 PHP，我只是将“ext”文件夹中的所有 DLL 复制到我的 PHP 扩展文件夹（在 中的`extension_dir`变量中指定），然后将 PHP 下载的版本和`php.ini`版本复制到我的 System32 目录中。`libeay32.dll``SSLeay32.dll`

我也做了一个iisreset，但我不知道这是否有必要。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2015-02-18T18:53:25.173

`libeay32.dll`并且`ssleay32.dll`必须是路径可访问的`php_curl.dll`才能正常工作。

在**Control Panel** -> **Search** -> **Advanced System Settings**并使用按钮**Environment Variables**。

在**系统变量**下找到**路径**添加`c:/php`文件夹（或任何路径）并重新启动 Apache。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-08-15T15:18:58.667

提示是使用[WAMP-installer](http://www.wampserver.com/en/)。一切正常。虽然它不是 IIS - 所以如果它很重要 - 你应该忽略我的建议。;)

编辑：我看到你找到了解决方案，所以我投了赞成票。+1

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-06-08T07:02:34.347

我一直有同样的问题，虽然我做了上面的建议，我得到了互联网上的许多其他建议

> 抱歉，这个插件需要在你的服务器上激活 libcurl。

当我尝试激活我的插件时。

编辑：我使用 php 5.3.13 有 win64 windows 7 并且没有一个解决方案对我有用。

1.我试图复制 windows\system32 文件夹中的 libeay32.dll SSLeay32.dll 不起作用 2\. 编辑和取消注释两个 php.ini 文件都不起作用 3\. php 扩展中激活的 php_curl 不起作用 4\. 复制并替换几次 www.anindya.com 的[php_curl.dll](http://www.anindya.com/php-5-4-3-and-php-5-3-13-x64-64-bit-for-windows/)版本，但似乎我下载了错误的版本。对我有用的版本在 Fixed curl extensions 部分的第二个文件 php_curl-5.3.13-VC9-x64

希望这对其他人有帮助

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-01-18T22:42:53.753

当我将 UwAmp 中的 php 升级到 7.2.* 时遇到了这个问题。唯一对我有用的解决方案是下载当时最新版本的 apache (Apache/2.4.37 (Win32)) 并替换 UwAmp 附带的那个。这还涉及编辑示例 httpd.conf 以生成 httpd_uwamp.conf 文件。UwAmp 需要此模板，然后在启动时生成实际的 httpd.conf。不幸的是，上述所有其他建议都没有为我解决。另请注意，从 OpenSSL 1.1 开始，不再需要 libeay32.dll 和 ssleay32.dll（请参阅[http://php.net/manual/en/curl.installation.php](http://php.net/manual/en/curl.installation.php)）

# .net - 如何在.net中配置一个类？

> ID：12368
> 
> 赞同：44
> 
> 时间：2008-08-15T15:26:41.987
> 
> 标签：.net, memory, dispose

.NET 垃圾收集器最终会释放内存，但如果您想立即恢复内存怎么办？你需要在类中使用什么代码`MyClass`来调用

```
MyClass.Dispose() 
```

并通过变量和对象释放所有使用的空间`MyClass`？

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2008-08-15T15:40:33.567

IDisposable 与释放内存无关。IDisposable 是一种释放*非托管*资源的模式——内存绝对是一种托管资源。

指向 GC.Collect() 的链接是正确答案，尽管 Microsoft .NET 文档通常不鼓励使用此函数。

**编辑：**已经为这个答案赢得了大量的业力，我觉得有一定的责任来详细说明它，以免.NET 资源管理的新手产生错误的印象。

在 .NET 进程中，有两种资源——托管和非托管。“托管”意味着运行时控​​制资源，而“非托管”意味着它是程序员的责任。今天，我们在.NET 中真正关心的托管资源只有一种——内存。程序员告诉运行时分配内存，然后由运行时确定何时可以释放内存。.NET 用于此目的的机制称为[垃圾收集](http://en.wikipedia.org/wiki/Garbage_collection_(computer_science))，您只需使用 Google 就可以在 Internet 上找到大量有关 GC 的信息。

对于其他类型的资源，.NET 对清理它们一无所知，因此它必须依靠程序员来做正确的事情。为此，平台为程序员提供了三种工具：

1.  VB 和 C# 中的 IDisposable 接口和“使用”语句
2.  终结者
3.  许多 BCL 类实现的 IDisposable 模式

其中第一个允许程序员有效地获取资源，使用它，然后在同一个方法中释放它。

```
using (DisposableObject tmp = DisposableObject.AcquireResource()) {
    // Do something with tmp
}
// At this point, tmp.Dispose() will automatically have been called
// BUT, tmp may still a perfectly valid object that still takes up memory 
```

如果“AcquireResource”是（例如）打开文件并且“Dispose”自动关闭文件的工厂方法，则此代码不能泄漏文件资源。但是“tmp”对象本身的内存可能仍然被分配。那是因为 IDisposable 接口与垃圾收集器完全没有联系。如果您*确实*想确保内存被释放，您唯一的选择是调用`GC.Collect()`强制垃圾回收。

但是，无论如何强调这可能不是一个好主意。通常让垃圾收集器完成它的设计目的要好得多，即管理内存。

如果资源使用时间较长，以至于它的生命周期跨越了几种方法，会发生什么？显然，“using”语句不再适用，因此程序员在使用完资源后必须手动调用“Dispose”。如果程序员忘记了会发生什么？如果没有回退，那么进程或计算机最终可能会用尽没有正确释放的任何资源。

这就是终结器的用武之地。终结器是您的类上与垃圾收集器有特殊关系的方法。GC 承诺——在为该类型的任何对象释放内存之前——它将首先让终结器有机会进行某种清理。

所以在文件的情况下，理论上我们根本不需要手动关闭文件。我们可以等到垃圾收集器到达它，然后让终结器完成工作。不幸的是，这在实践中效果不佳，因为垃圾收集器运行不确定。该文件可能保持打开的时间比程序员预期的要长得多。如果有足够多的文件保持打开状态，则系统在尝试打开其他文件时可能会失败。

对于大多数资源，我们想要这两样东西。我们希望约定能够说“我们现在已经完成了这个资源”，并且我们希望确保如果我们忘记手动进行清理，至少有一些机会自动进行清理。这就是“IDisposable”模式发挥作用的地方。这是一个允许 IDispose 和终结器很好地一起运行的约定。您可以通过查看[IDisposable 的官方文档来](http://msdn.microsoft.com/en-us/library/system.idisposable.aspx)了解该模式的工作原理。

**底线：**如果您真正想做的只是确保释放内存，那么 IDisposable 和终结器将无济于事。但是 IDisposable 接口是所有 .NET 程序员都应该理解的极其重要的模式的一部分。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-08-15T15:48:42.957

您只能释放实现 IDisposable 接口的实例。

**要强制垃圾收集立即释放（非托管）内存：**

```
GC.Collect();  
GC.WaitForPendingFinalizers(); 
```

这通常是不好的做法，但例如在 x64 版本的 .NET 框架中存在一个错误，它使 GC 在某些情况下表现得奇怪，然后您可能想要这样做。不知道bug是否已经解决了。有人知道吗？

**要处置一个类，您可以这样做：**

```
instance.Dispose(); 
```

或像这样：

```
using(MyClass instance = new MyClass())
{
    // Your cool code.
} 
```

这将在编译时转换为：

```
MyClass instance = null;    

try
{
    instance = new MyClass();        
    // Your cool code.
}
finally
{
    if(instance != null)
        instance.Dispose();
} 
```

**您可以像这样实现 IDisposable 接口：**

```
public class MyClass : IDisposable
{
    private bool disposed;

    /// <summary>
    /// Construction
    /// </summary>
    public MyClass()
    {
    }

    /// <summary>
    /// Destructor
    /// </summary>
    ~MyClass()
    {
        this.Dispose(false);
    }

    /// <summary>
    /// The dispose method that implements IDisposable.
    /// </summary>
    public void Dispose()
    {
        this.Dispose(true);
        GC.SuppressFinalize(this);
    }

    /// <summary>
    /// The virtual dispose method that allows
    /// classes inherithed from this one to dispose their resources.
    /// </summary>
    /// <param name="disposing"></param>
    protected virtual void Dispose(bool disposing)
    {
        if (!disposed)
        {
            if (disposing)
            {
                // Dispose managed resources here.
            }

            // Dispose unmanaged resources here.
        }

        disposed = true;
    }
} 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-08-31T09:56:24.013

对这个问题的回答有点混乱。

标题询问了处置，但随后说他们希望立即恢复记忆。

.Net 是*托管*的，这意味着当您编写 .Net 应用程序时，您无需直接担心内存，代价是您也无法直接控制内存。

.Net 决定何时最好清理和释放内存，而不是您作为 .Net 编码器。

这`Dispose`是一种告诉 .Net 你已经完成了某些事情的方法，但它实际上不会释放内存，直到它是这样做的最佳时间。

基本上.Net实际上会在最容易的时候收集内存——它非常擅长决定什么时候。除非你正在写一些非常占用内存的东西，否则你通常不需要推翻它（这是游戏不经常用 .Net 编写的部分原因——它们需要完全控制）

在 .Net 中，您可以使用`GC.Collect()`它来立即强制它，但这几乎总是不好的做法。如果.Net 还没有清理它，这意味着它不是清理它的好时机。

`GC.Collect()`拾取 .Net 识别为已完成的对象。如果您尚未处理需要它的对象，.Net 可能会决定保留该对象。这意味着`GC.Collect()`只有在您正确实施一次性实例时才有效。

`GC.Collect()`**不能替代**正确使用 IDisposable。

所以 Dispose 和 memory 没有直接关系，但也没有必要。正确处理将使您的 .Net 应用程序更高效，因此使用更少的内存。

* * *

在 .Net 中 99% 的情况下，以下是最佳实践：

**规则 1：**如果你不处理任何*非托管*或实现的东西，`IDisposable` 那么不要担心 Dispose。

**规则 2：**如果您有一个实现 IDisposable 的局部变量，请确保在当前范围内摆脱它：

```
//using is best practice
using( SqlConnection con = new SqlConnection("my con str" ) )
{
    //do stuff
} 

//this is what 'using' actually compiles to:
SqlConnection con = new SqlConnection("my con str" ) ;
try
{
    //do stuff
}
finally
{
    con.Dispose();
} 
```

**规则 3：**如果一个类具有实现 IDisposable 的属性或成员变量，那么该类也应该实现 IDisposable。在该类的 Dispose 方法中，您还可以处理您的 IDisposable 属性：

```
//rather basic example
public sealed MyClass :
   IDisposable
{   
    //this connection is disposable
    public SqlConnection MyConnection { get; set; }

    //make sure this gets rid of it too
    public Dispose() 
    {
        //if we still have a connection dispose it
        if( MyConnection != null )
            MyConnection.Dispose();

        //note that the connection might have already been disposed
        //always write disposals so that they can be called again
    }
} 
```

这并不完整，这就是示例被密封的原因。继承类可能需要遵守下一条规则......

**规则 4：**如果类使用*非托管*资源，则实现 IDispose*并*添加终结器。

.Net 无法对*非托管*资源做任何事情，所以现在我们谈论的是内存。如果你不清理它，你可能会出现内存泄漏。

Dispose 方法需要同时处理*托管*和*非托管*资源。

终结器是一个安全问题 - 它确保如果其他人创建了您的类的实例并且未能处理它，那么.Net 仍然可以清理“危险的”*非托管资源。*

```
~MyClass()
{
    //calls a protected method 
    //the false tells this method
    //not to bother with managed
    //resources
    this.Dispose(false);
}

public void Dispose()
{
    //calls the same method
    //passed true to tell it to
    //clean up managed and unmanaged 
    this.Dispose(true);

    //as dispose has been correctly
    //called we don't need the 

    //'backup' finaliser
    GC.SuppressFinalize(this);
} 
```

最后这个 Dispose 的重载带有一个布尔标志：

```
protected virtual void Dispose(bool disposing)
{
    //check this hasn't been called already
    //remember that Dispose can be called again
    if (!disposed)
    {
        //this is passed true in the regular Dispose
        if (disposing)
        {
            // Dispose managed resources here.
        }

        //both regular Dispose and the finaliser
        //will hit this code
        // Dispose unmanaged resources here.
    }

    disposed = true;
} 
```

请注意，一旦这一切就绪，其他创建类实例的托管代码就可以像对待任何其他 IDisposable 一样对待它（规则 2 和 3）。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-08-15T15:41:02.803

还提到 dispose 并不总是指内存是否合适？我比内存更频繁地处理资源，例如对文件的引用。GC.Collect() 直接与 CLR 垃圾收集器相关，可能会也可能不会释放内存（在任务管理器中）。它可能会对您的应用程序产生负面影响（例如性能）。

归根结底，您为什么要立即恢复记忆？如果有来自其他地方的内存压力，操作系统会在大多数情况下为您提供内存。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-08-17T14:22:44.940

看看这篇[文章](http://www.codeproject.com/KB/cs/idisposable.aspx)

实现 Dispose 模式、IDisposable 和/或终结器与内存何时回收完全无关；相反，它与告诉 GC***如何***回收该内存有关。当您调用 Dispose() 时，您绝不会与 GC 交互。

GC 只会在它确定需要（称为内存压力）时运行，然后（并且只有在那时）才会为未使用的对象释放内存并压缩内存空间。

你*可以*调用 GC.Collect() 但你真的不应该调用，除非有**很好**的理由（几乎总是“从不”）。当您像这样强制执行带外收集周期时，实际上会导致 GC 做更多的工作，最终可能会损害您的应用程序性能。在 GC 收集周期期间，您的应用程序实际上处于冻结状态……运行的 GC 周期越多，您的应用程序冻结的时间就越多。

您还可以进行一些本机 Win32 API 调用来释放您的工作集，但即使是那些也应该避免，除非有**很好**的理由这样做。

垃圾收集运行时背后的整个前提是您不需要（尽可能多地）担心运行时何时分配/取消分配实际内存；您只需要担心确保您的对象在被询问时知道如何自行清理。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2012-05-02T22:13:37.387

[我在http://codingcraftsman.wordpress.com/2012/04/25/to-dispose-or-not-to-dispose/](http://codingcraftsman.wordpress.com/2012/04/25/to-dispose-or-not-to-dispose/)上写了 Destructors 和 Dispose 和 Garbage 收集的摘要

要回答原始问题：

1.  不要试图管理你的记忆
2.  Dispose 不是关于内存管理，而是关于非托管资源管理
3.  终结器是 Dispose 模式的固有部分，实际上会减慢托管对象的内存释放速度（因为它们必须进入终结队列，除非已经 Dispose d）
4.  GC.Collect 不好，因为它使一些短期对象似乎需要更长的时间，从而减慢它们被收集的速度。

但是，如果您有代码的性能关键部分并希望减少垃圾收集减慢它的可能性，GC.Collect 可能会很有用。你以前这么叫。

最重要的是，有一个支持这种模式的论点：

```
var myBigObject = new MyBigObject(1);
// something happens
myBigObject = new MyBigObject(2);
// at the above line, there are temporarily two big objects in memory and neither can be collected 
```

对比

```
myBigObject = null; // so it could now be collected
myBigObject = new MyBigObject(2); 
```

但主要的答案是垃圾收集只是工作，除非你乱用它！

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-08-15T15:32:02.413

```
public class MyClass : IDisposable
{
    public void Dispose()
    {
       // cleanup here
    }
} 
```

那么你可以做这样的事情

```
MyClass todispose = new MyClass();
todispose.Dispose(); // instance is disposed right here 
```

或者

```
using (MyClass instance = new MyClass())
{

}
// instance will be disposed right here as it goes out of scope 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-08-26T09:36:18.907

Joe Duffy 对“ [Dispose, Finalization, and Resource Management](http://www.bluebytesoftware.com/blog/PermaLink.aspx?guid=88e62cdf-5919-4ac7-bc33-20c06ae539ae) ”的完整解释：

> 在 .NET Framework 生命周期的早期，C# 程序员一直将终结器称为析构函数。随着时间的推移，我们变得越来越聪明，我们试图接受这样一个事实，即**Dispose 方法实际上更等同于 C++ 析构函数（确定性）**，而 **终结器是完全独立的（非确定性）**。C# 借用了 C++ 析构函数语法（即 ~T()）这一事实肯定至少与这个误称的发展有一点关系。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-08-15T15:42:36.217

您不能真正强制 GC 在需要时清理对象，尽管有一些方法可以强制它运行，但没有说它会清理您想要/期望的所有对象。最好以 try catch ex finally dispose end try (VB.NET rulz) 方式调用 dispose。但是 Dispose 用于清理对象以确定性方式分配的系统资源（内存、句柄、数据库连接等）。Dispose 不会（也不能）清理对象本身使用的内存，只有 GC可以做到这一点。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-08-15T15:30:57.393

[这篇文章](http://www.codeguru.com/csharp/.net/net_general/tipstricks/article.php/c7047/ "在.Net中强制垃圾收集")有一个非常简单的演练。但是，*不得不*调用 GC 而不是让它自然运行通常是设计/内存管理不佳的标志，**尤其是**在没有消耗有限资源（连接、句柄、通常导致实现 IDisposable 的任何其他内容）的情况下。

是什么导致你需要这样做？

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-08-25T21:29:10.013

抱歉，这里选择的答案不正确。正如一些人随后所说的那样，Dispose 和实现 IDisposable 与释放与 .NET 类关联的内存无关。它主要和传统上用于释放非托管资源，例如文件句柄等。

虽然您的应用程序可以调用 GC.Collect() 来尝试强制垃圾收集器进行收集，但这只会对那些处于可访问队列中正确生成级别的项目产生影响。因此，如果您已经清除了对该对象的所有引用，那么在实际内存被释放之前，可能仍然需要对 GC.Collect() 进行几次调用。

你没有在你的问题中说为什么你觉得需要立即释放内存。我知道有时可能会出现不寻常的情况，但严重的是，在托管代码中，让运行时处理内存管理几乎总是最好的。

如果您认为您的代码比 GC 释放内存的速度更快地耗尽内存，这可能是最好的建议，那么您应该检查您的代码，以确保在静态成员等的任何数据结构中都没有引用不再需要的对象. 也尽量避免你有循环对象引用的情况，因为它们也可能不会被释放。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-08-31T10:26:30.247

@基思，

我同意你的所有规则，除了#4。添加终结器只能在非常特定的情况下完成。如果一个类使用非托管资源，则应在 Dispose(bool) 函数中清理这些资源。当 bool 为真时，这个相同的函数应该只清理托管资源。添加终结器会增加使用对象的复杂性成本，因为每次创建新实例时，它还必须放在终结队列中，每次 GC 运行收集周期时都会检查该队列。实际上，这意味着您的对象在一个周期/代中的存活时间比它应该运行的时间长，因此可以运行终结器。终结器不应被视为“安全网”。

GC 只会在确定 Gen0 堆中没有足够的可用内存来执行下一次分配时运行一个收集周期，除非您通过调用 GC.Collect() 来“帮助”它强制进行带外收集.

底线是，无论如何，GC 只知道如何通过调用 Dispose 方法来释放资源（如果实现的话，可能还有终结器）。由该方法“做正确的事”并清理使用的任何非托管资源并指示任何其他托管资源调用其 Dispose 方法。只要没有带外收集周期的帮助，它的工作效率就很高，并且可以在很大程度上进行自我优化。话虽如此，如果没有显式调用 GC.Collect，您将无法控制何时以及以何种顺序处理对象和释放内存。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-08-15T15:32:40.337

如果 MyClass 实现了 IDisposable 你就可以做到这一点。

```
MyClass.Dispose(); 
```

C# 的最佳实践是：

```
using( MyClass x = new MyClass() ) {
    //do stuff
} 
```

因为这在 try-finally 中结束了处置，并确保它永远不会错过。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-08-15T15:33:55.373

如果你不想（或不能）在你的类上实现 IDisposable，你可以像这样强制垃圾收集（但它很慢） -

```
GC.Collect(); 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-08-15T16:48:49.967

IDisposable 接口实际上适用于包含非托管资源的类。如果您的类不包含非托管资源，为什么**需要**在垃圾收集器执行之前释放资源？否则，只需确保您的对象尽可能晚地实例化并尽快超出范围。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-08-21T08:05:08.073

您可以在 C++ 中进行确定性对象破坏

你永远不想调用 GC.Collect，它会干扰垃圾收集器的自我调整以检测内存压力，并且在某些情况下除了增加堆上每个对象的当前代数之外什么也不做。

对于那些发布 IDisposable 答案的人。正如提问者所描述的那样，调用 Dispose 方法不会破坏对象。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-08-26T09:01:30.970

@Curt Hagenlocher - 回到前面。我不知道为什么有这么多人在它错了的时候投了赞成票。

`IDisposable`用于*托管*资源。

终结者适用于*非托管*资源。

只要您只使用托管资源，@Jon Limjap 和我自己都是完全正确的。

对于使用非托管资源的类（请记住，绝大多数 .Net 类不使用）Patrik 的答案是全面的最佳实践。

避免使用 GC.Collect - 这是一种处理托管资源的缓慢方法，并且除非您正确构建了 ~Finalizers，否则不会对非托管资源执行任何操作。

* * *

我已根据[https://stackoverflow.com/questions/14593/e ​​tiquette-for-modifying-posts 从原始问题中删除了版主评论](https://stackoverflow.com/questions/14593/etiquette-for-modifying-posts)

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-08-26T09:11:17.703

@基思：

> IDisposable 用于托管资源。
> 
> 终结者适用于非托管资源。

对不起，那是错误的。通常，终结器什么都不做。但是，如果[dispose 模式](http://blogs.msdn.com/bclteam/archive/2007/10/30/dispose-pattern-and-object-lifetime-brian-grunkemeyer.aspx)已正确实现，则终结器会尝试调用`Dispose`.

`Dispose`有两个工作：

*   释放非托管资源，以及
*   释放嵌套的托管资源。

在这里，您的声明发挥了作用，因为确实在完成时，对象不应该尝试释放嵌套的托管资源，因为这些资源可能已经被释放。但它仍然必须释放非托管资源。

`Dispose`尽管如此，终结器除了调用并告诉它不要接触托管对象之外没有其他工作。`Dispose`，当手动（或通过`Using`）调用时，应释放所有非托管资源并将`Dispose`消息传递给嵌套对象（和基类方法），但这*永远不会*释放任何（托管）内存。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-08-26T09:30:21.620

Konrad Rudolph - 是的，通常终结者什么都不做。除非您正在处理非托管资源，否则您不应该实现它。

然后，当你实现它时，你使用[微软的 dispose 模式](http://msdn.microsoft.com/en-us/library/fs2xkftw.aspx)（如前所述）

*   `public Dispose()`调用`protected Dispose(true)`- 处理托管和非托管资源。调用`Dispose()`应该抑制最终确定。

*   `~Finalize`调用`protected Dispose(false)`- 仅处理非托管资源。如果您未能调用`public Dispose()`

`~Finalize`速度很慢，除非您确实有非托管资源要处理，否则不应使用。

托管资源不会发生内存泄漏，它们只会为当前应用程序浪费资源并减慢其垃圾收集速度。非托管资源可能会泄漏，`~Finalize`最好的做法是确保它们不会泄漏。

在任何一种情况下`using`都是最佳实践。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2012-03-23T00:50:11.163

在回答原始问题时，根据原始发布者迄今为止提供的信息，可以 100% 确定他对 .NET 编程的了解不够，甚至无法得到答案：使用 GC.Collect()。正如大多数海报所指出的那样，我会说他根本不需要使用 GC.Collect() 的可能性为 99.99%。

正确的答案归结为'让 GC 完成它的工作。时期。你还有其他事情要担心。但是您可能需要考虑是否以及何时应该处置或清理特定对象，以及是否需要在您的类中实现 IDisposable 和可能的 Finalize。

关于基思的帖子和他的规则#4：

有些海报混淆了规则 3 和规则 4。基思的规则 4 绝对正确，毫不含糊。这是四个规则中的一个，根本不需要编辑。我会稍微改写他的一些其他规则以使其更清晰，但如果您正确解析它们，它们基本上是正确的，并且实际上阅读了整篇文章以了解他如何扩展它们。

1.  如果您的类不使用非托管资源并且它也从不实例化本身直接或最终使用非托管对象的类的另一个对象（即，实现 IDisposable 的类），那么您的类就不需要要么实现 IDisposable 本身，甚至调用 .dispose 任何东西。（在这种情况下，认为您实际上需要通过强制 GC 立即释放内存是愚蠢的。）

2.  如果您的类使用非托管资源，或者实例化另一个本身实现 IDisposable 的对象，那么您的类应该：

    a) 在创建它们的本地环境中立即处置/释放它们，或者......

    b) 以 Keith 的帖子中推荐的模式，或互联网上的几千个地方，或现在大约 300 本书中推荐的模式实施 IDisposable。

    b.1) 此外，如果 (b)，并且它是已打开的非托管资源，则 IDisposable 和 Finalize 都应该始终按照 Keith 的规则 #4 实施。
    在这种情况下，Finalize 在某种意义上绝对是一个安全网：如果有人实例化了使用非托管资源的您的 IDisposable 对象，并且他们未能调用 dispose，那么 Finalize 是您的对象正确关闭非托管资源的最后机会。
    （Finalize 应该通过调用 Dispose 来执行此操作，即 Dispose 方法跳过释放除非托管资源之外的任何内容。或者，如果您的对象的 Dispose 方法被任何实例化您的对象正确调用，那么它都将 Dispose 调用传递给它已实例化的所有 IDisposable 对象，并正确释放非托管资源，并以抑制对对象的 Finalize 的调用结束，这意味着如果调用者正确处置对象，则使用 Finalize 的影响会降低。所有这些点包含在基思的帖子中，顺便说一句。）

    b.2) 如果您的类只实现 IDisposable 因为它需要将 Dispose 传递给它已实例化的 IDisposable 对象，那么在这种情况下不要在您的类中实现 Finalize 方法。Finalize 用于处理任何实例化对象都未调用 BOTH Dispose 并且使用了仍未释放的非托管资源的情况。

总之，关于基思的帖子，他是完全正确的，在我看来，那个帖子是最正确和最完整的答案。他可能会使用一些有些人认为“错误”或反对的简短陈述，但他的完整帖子完全扩展了 Finalize 的用法，他是绝对正确的。在跳到他的帖子中的一条规则或初步声明之前，请务必完整阅读他的帖子。

# visual-studio-2008 - 调试 XSLT 文件时 VS2008 SP1 崩溃

> ID：12369
> 
> 赞同：5
> 
> 时间：2008-08-15T15:27:16.700
> 
> 标签：visual-studio-2008, xslt, visual-sourcesafe-plugin

我正在使用 VS2008 SP1 - 不知道在我应用 SP1 之前是否会发生这种情况，因为我在昨天之前从未尝试过。我尝试使用 VS2008 SP1 调试一个相当简单的 XSLT 文件，并从 VS2008 SP1 得到这个崩溃：

* * *

## 微软视觉工作室

遇到意外错误。建议您尽快重新启动应用程序。

错误：未指定的错误

文件：vsee\pkgs\vssprovider\sccprj.cpp

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-17T13:34:43.877

是的，听起来如此。要使用它，我每次都必须通过将工具、选项、源代码控制、插件选择、当前源代码控制插件设置为“无”来临时禁用 VSS。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-19T18:46:42.073

我们已经重现了这个问题，并将在 Visual Studio 的下一版本中修复它。

欢迎您使用[Microsoft Connect](http://connect.microsoft.com/)站点报告与 Visual Studio 相关的任何问题。

最好的问候，
Anton Lapounov
数据可编程团队 @ Microsoft

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-04-08T18:48:11.880

这是 Microsoft 的错误和“修复”报告的链接，其中包括有关解决方法的信息（禁用源代码管理插件）：[VS2008 sp1 - sccprj.cpp 中的 XSLT 调试错误](https://connect.microsoft.com/VisualStudio/feedback/details/366646/vs2008-sp1-xslt-debugging-error-in-sccprj-cpp)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-19T12:31:26.137

同样的问题，样式表完成处理后，我收到未指定的错误（关闭错误消息框后一切似乎都正常）。在 VS 选项中将源代码控制插件选择为“无”可以解决问题。

# sql - 有没有人在单元测试 SQL 存储过程方面取得任何成功？

> ID：12374
> 
> 赞同：37
> 
> 时间：2008-08-15T15:29:14.837
> 
> 标签：sql, unit-testing, linq-to-sql

我们发现我们为 C#/C++ 代码编写的单元测试确实得到了回报。但是我们在存储过程中仍然有数千行业务逻辑，只有在我们的产品向大量用户推出时才会真正得到愤怒的测试。

更糟糕的是，其中一些存储过程最终会变得很长，因为在 SP 之间传递临时表时会降低性能。这阻止了我们进行重构以使代码更简单。

我们已经多次尝试围绕我们的一些关键存储过程构建单元测试（主要是测试性能），但发现为这些测试设置测试数据真的很困难。例如，我们最终会复制测试数据库。除此之外，测试最终对更改非常敏感，甚至对存储过程的最小更改也是如此。or table 需要对测试进行大量更改。因此，在由于这些数据库测试间歇性失败而导致许多构建中断之后，我们不得不将它们从构建过程中拉出来。

所以，我的主要问题是：有没有人成功地为他们的存储过程编写过单元测试？

我的问题的第二部分是使用 linq 进行单元测试是否会/更容易？

我在想，不必设置测试数据表，您可以简单地创建一个测试对象集合，并在“linq to objects”的情况下测试您的 linq 代码？（我对 linq 完全陌生，所以不知道这是否可行）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-08-24T17:20:14.487

不久前我遇到了同样的问题，发现如果我为数据访问创建了一个简单的抽象基类，允许我注入连接和事务，我可以对我的存储过程进行单元测试，看看它们是否在 SQL 中完成了我的工作要求他们做然后回滚，所以没有任何测试数据留在数据库中。

这比通常的“运行脚本来设置我的测试数据库，然后在测试运行后清理垃圾/测试数据”感觉更好。这也感觉更接近于单元测试，因为这些测试可以单独运行而没有大量的“在我运行这些测试之前，数据库中的所有内容都需要‘正常’”。

**这是用于数据访问的抽象基类的片段**

```
Public MustInherit Class Repository(Of T As Class)
    Implements IRepository(Of T)

    Private mConnectionString As String = ConfigurationManager.ConnectionStrings("Northwind.ConnectionString").ConnectionString
    Private mConnection As IDbConnection
    Private mTransaction As IDbTransaction

    Public Sub New()
        mConnection = Nothing
        mTransaction = Nothing
    End Sub

    Public Sub New(ByVal connection As IDbConnection, ByVal transaction As IDbTransaction)
        mConnection = connection
        mTransaction = transaction
    End Sub

    Public MustOverride Function BuildEntity(ByVal cmd As SqlCommand) As List(Of T)

    Public Function ExecuteReader(ByVal Parameter As Parameter) As List(Of T) Implements IRepository(Of T).ExecuteReader
        Dim entityList As List(Of T)
        If Not mConnection Is Nothing Then
            Using cmd As SqlCommand = mConnection.CreateCommand()
                cmd.Transaction = mTransaction
                cmd.CommandType = Parameter.Type
                cmd.CommandText = Parameter.Text
                If Not Parameter.Items Is Nothing Then
                    For Each param As SqlParameter In Parameter.Items
                        cmd.Parameters.Add(param)
                    Next
                End If
                entityList = BuildEntity(cmd)
                If Not entityList Is Nothing Then
                    Return entityList
                End If
            End Using
        Else
            Using conn As SqlConnection = New SqlConnection(mConnectionString)
                Using cmd As SqlCommand = conn.CreateCommand()
                    cmd.CommandType = Parameter.Type
                    cmd.CommandText = Parameter.Text
                    If Not Parameter.Items Is Nothing Then
                        For Each param As SqlParameter In Parameter.Items
                            cmd.Parameters.Add(param)
                        Next
                    End If
                    conn.Open()
                    entityList = BuildEntity(cmd)
                    If Not entityList Is Nothing Then
                        Return entityList
                    End If
                End Using
            End Using
        End If

        Return Nothing
    End Function
End Class 
```

**接下来，您将看到使用上述基础获取产品列表的示例数据访问类**

```
Public Class ProductRepository
    Inherits Repository(Of Product)
    Implements IProductRepository

    Private mCache As IHttpCache

    'This const is what you will use in your app
    Public Sub New(ByVal cache As IHttpCache)
        MyBase.New()
        mCache = cache
    End Sub

    'This const is only used for testing so we can inject a connectin/transaction and have them roll'd back after the test
    Public Sub New(ByVal cache As IHttpCache, ByVal connection As IDbConnection, ByVal transaction As IDbTransaction)
        MyBase.New(connection, transaction)
        mCache = cache
    End Sub

    Public Function GetProducts() As System.Collections.Generic.List(Of Product) Implements IProductRepository.GetProducts
        Dim Parameter As New Parameter()
        Parameter.Type = CommandType.StoredProcedure
        Parameter.Text = "spGetProducts"
        Dim productList As List(Of Product)
        productList = MyBase.ExecuteReader(Parameter)
        Return productList
    End Function

    'This function is used in each class that inherits from the base data access class so we can keep all the boring left-right mapping code in 1 place per object
    Public Overrides Function BuildEntity(ByVal cmd As System.Data.SqlClient.SqlCommand) As System.Collections.Generic.List(Of Product)
        Dim productList As New List(Of Product)
        Using reader As SqlDataReader = cmd.ExecuteReader()
            Dim product As Product
            While reader.Read()
                product = New Product()
                product.ID = reader("ProductID")
                product.SupplierID = reader("SupplierID")
                product.CategoryID = reader("CategoryID")
                product.ProductName = reader("ProductName")
                product.QuantityPerUnit = reader("QuantityPerUnit")
                product.UnitPrice = reader("UnitPrice")
                product.UnitsInStock = reader("UnitsInStock")
                product.UnitsOnOrder = reader("UnitsOnOrder")
                product.ReorderLevel = reader("ReorderLevel")
                productList.Add(product)
            End While
            If productList.Count > 0 Then
                Return productList
            End If
        End Using
        Return Nothing
    End Function
End Class 
```

**现在在您的单元测试中，您还可以从一个非常简单的基类继承您的设置/回滚工作 - 或者在每个单元测试的基础上保持它**

**下面是我使用的简单测试基类**

```
Imports System.Configuration
Imports System.Data
Imports System.Data.SqlClient
Imports Microsoft.VisualStudio.TestTools.UnitTesting

Public MustInherit Class TransactionFixture
    Protected mConnection As IDbConnection
    Protected mTransaction As IDbTransaction
    Private mConnectionString As String = ConfigurationManager.ConnectionStrings("Northwind.ConnectionString").ConnectionString

    <TestInitialize()> _
    Public Sub CreateConnectionAndBeginTran()
        mConnection = New SqlConnection(mConnectionString)
        mConnection.Open()
        mTransaction = mConnection.BeginTransaction()
    End Sub

    <TestCleanup()> _
    Public Sub RollbackTranAndCloseConnection()
        mTransaction.Rollback()
        mTransaction.Dispose()
        mConnection.Close()
        mConnection.Dispose()
    End Sub
End Class 
```

**最后 - 下面是一个使用该测试基类的简单测试，它显示了如何测试整个 CRUD 循环以确保所有 sproc 都完成它们的工作并且您的 ado.net 代码正确地进行左右映射**

**我知道这不会测试上述数据访问示例中使用的“spGetProducts”存储过程，但是您应该看到这种单元测试存储过程方法背后的力量**

```
Imports SampleApplication.Library
Imports System.Collections.Generic
Imports Microsoft.VisualStudio.TestTools.UnitTesting

<TestClass()> _
Public Class ProductRepositoryUnitTest
    Inherits TransactionFixture

    Private mRepository As ProductRepository

    <TestMethod()> _
    Public Sub Should-Insert-Update-And-Delete-Product()
        mRepository = New ProductRepository(New HttpCache(), mConnection, mTransaction)
        '** Create a test product to manipulate throughout **'
        Dim Product As New Product()
        Product.ProductName = "TestProduct"
        Product.SupplierID = 1
        Product.CategoryID = 2
        Product.QuantityPerUnit = "10 boxes of stuff"
        Product.UnitPrice = 14.95
        Product.UnitsInStock = 22
        Product.UnitsOnOrder = 19
        Product.ReorderLevel = 12
        '** Insert the new product object into SQL using your insert sproc **'
        mRepository.InsertProduct(Product)
        '** Select the product object that was just inserted and verify it does exist **'
        '** Using your GetProductById sproc **'
        Dim Product2 As Product = mRepository.GetProduct(Product.ID)
        Assert.AreEqual("TestProduct", Product2.ProductName)
        Assert.AreEqual(1, Product2.SupplierID)
        Assert.AreEqual(2, Product2.CategoryID)
        Assert.AreEqual("10 boxes of stuff", Product2.QuantityPerUnit)
        Assert.AreEqual(14.95, Product2.UnitPrice)
        Assert.AreEqual(22, Product2.UnitsInStock)
        Assert.AreEqual(19, Product2.UnitsOnOrder)
        Assert.AreEqual(12, Product2.ReorderLevel)
        '** Update the product object **'
        Product2.ProductName = "UpdatedTestProduct"
        Product2.SupplierID = 2
        Product2.CategoryID = 1
        Product2.QuantityPerUnit = "a box of stuff"
        Product2.UnitPrice = 16.95
        Product2.UnitsInStock = 10
        Product2.UnitsOnOrder = 20
        Product2.ReorderLevel = 8
        mRepository.UpdateProduct(Product2) '**using your update sproc
        '** Select the product object that was just updated to verify it completed **'
        Dim Product3 As Product = mRepository.GetProduct(Product2.ID)
        Assert.AreEqual("UpdatedTestProduct", Product2.ProductName)
        Assert.AreEqual(2, Product2.SupplierID)
        Assert.AreEqual(1, Product2.CategoryID)
        Assert.AreEqual("a box of stuff", Product2.QuantityPerUnit)
        Assert.AreEqual(16.95, Product2.UnitPrice)
        Assert.AreEqual(10, Product2.UnitsInStock)
        Assert.AreEqual(20, Product2.UnitsOnOrder)
        Assert.AreEqual(8, Product2.ReorderLevel)
        '** Delete the product and verify it does not exist **'
        mRepository.DeleteProduct(Product3.ID)
        '** The above will use your delete product by id sproc **'
        Dim Product4 As Product = mRepository.GetProduct(Product3.ID)
        Assert.AreEqual(Nothing, Product4)
    End Sub

End Class 
```

我知道这是一个很长的例子，但它有助于为数据访问工作提供一个可重用的类，并为我的测试提供另一个可重用的类，因此我不必一遍又一遍地进行设置/拆卸工作；）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-08-15T15:35:02.907

你试过[DBUnit](http://dbunit.sourceforge.net/)吗？它旨在对您的数据库进行单元测试，并且只是对您的数据库进行单元测试，而无需通过您的 C# 代码。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-08-15T15:51:15.433

如果您考虑单元测试倾向于促进的那种代码：小型高内聚和低耦合例程，那么您应该几乎能够看到至少部分问题可能出在哪里。

在我的愤世嫉俗的世界中，存储过程是 RDBMS 世界长期以来试图说服您将业务处理转移到数据库中的一部分，当您考虑到服务器许可成本往往与处理器数量等因素相关时，这是有道理的。您在数据库中运行的东西越多，它们从您那里获得的东西就越多。

但我的印象是你实际上更关心性能，这根本不是单元测试的保留。单元测试应该是相当原子的，旨在检查行为而不是性能。在这种情况下，您几乎可以肯定需要生产级负载来检查查询计划。

我认为您需要不同类别的测试环境。假设安全不是问题，我建议将生产副本作为最简单的方法。然后对于每个候选版本，您从以前的版本开始，使用您的发布过程进行迁移（这将为那些提供良好的测试作为副作用）并运行您的计时。

类似的东西。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-08-15T17:27:51.963

测试存储过程的关键是编写一个脚本，该脚本使用预先计划好的数据填充空白数据库，以便在调用存储过程时产生一致的行为。

我必须投票赞成大力支持存储过程，并将您的业务逻辑放在我（和大多数 DBA）认为属于数据库的位置。

我知道，作为软件工程师，我们希望用我们最喜欢的语言编写精美的重构代码，以包含我们所有的重要逻辑，但是大容量系统中的性能现实以及数据完整性的关键性质，要求我们做出一些妥协. Sql 代码可能丑陋、重复且难以测试，但我无法想象在不完全控制查询设计的情况下调整数据库的难度。

我经常被迫完全重新设计查询，包括对数据模型的更改，以使事情在可接受的时间内运行。使用存储过程，我可以确保更改对调用者是透明的，因为存储过程提供了如此出色的封装。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-08-15T15:40:50.320

我假设您希望在 MSSQL 中进行单元测试。查看 DBUnit，它对 MSSQL 的支持存在一些限制。例如，它不支持 NVarChar。 [下面是一些真实的用户以及他们在使用 DBUnit 时遇到的问题。](http://dbunit.wikidot.com/mssql)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-02T11:40:52.273

好问题。

我也有类似的问题，而且我走的是阻力最小的道路（无论如何对我来说）。

还有很多其他解决方案，其他人已经提到过。他们中的许多人更好/更纯粹/更适合其他人。

我已经在使用 Testdriven.NET/MbUnit 来测试我的 C#，所以我只是在每个项目中添加了测试来调用该应用程序使用的存储过程。

我知道我知道。这听起来很糟糕，但我需要的是通过*一些*测试开始工作，然后从那里开始。这种方法意味着尽管我的覆盖率很低，但我在测试将调用它们的代码的同时测试了一些存储的过程。这有一些逻辑。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-02T06:08:33.443

我的情况与原始海报完全相同。它归结为性能与可测试性。我偏向于可测试性（使其工作，使其正确，使其快速），这表明将业务逻辑排除在数据库之外。数据库不仅缺乏在 Java 等语言中发现的测试框架、代码分解结构以及代码分析和导航工具，而且高度分解的数据库代码也很慢（而高度分解的 Java 代码则不然）。

但是，我确实认识到数据库集处理的强大功能。如果使用得当，SQL 可以用很少的代码完成一些非常强大的事情。所以，我可以接受一些基于集合的逻辑存在于数据库中，即使我仍然会尽我所能对它进行单元测试。

在相关的说明中，似乎非常长的程序数据库代码通常是其他东西的症状，我认为这样的代码可以转换为可测试的代码而不会导致性能下降。理论上，这样的代码通常代表周期性地处理大量数据的批处理。如果要将这些批处理转换为更小的实时业务逻辑块，在输入数据更改时运行，则该逻辑可以在中间层（可以对其进行测试）上运行而不会影响性能（因为这项工作是实时分小块完成的）。作为副作用，这也消除了批处理错误处理的长反馈循环。当然，这种方法并不适用于所有情况，但它可能适用于某些情况。还，如果您的系统中有大量此类无法测试的批处理数据库代码，那么拯救之路可能漫长而艰巨。YMMV。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-08-15T16:53:22.110

> 但我的印象是你实际上更关心性能，这根本不是单元测试的保留。单元测试应该是相当原子的，旨在检查行为而不是性能。在这种情况下，您几乎可以肯定需要生产级负载来检查查询计划。

我认为这里有两个截然不同的测试领域：性能和存储过程的实际逻辑。

我给出了过去测试 db 性能的示例，幸运的是，我们已经达到了性能足够好的地步。

我完全同意数据库中所有业务逻辑的情况很糟糕，但这是我们在大多数开发人员加入公司之前继承的东西。

但是，我们现在正在为我们的新功能采用 Web 服务模型，并且我们一直在尝试尽可能地避免存储过程，将逻辑保留在 C# 代码中并在数据库中触发 SQLCommands（尽管 linq 现在将是首选方法）。现有的 SP 仍有一些用途，这就是我考虑对它们进行回顾性单元测试的原因。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-08-18T09:41:19.873

您还可以尝试[Visual Studio for Database Professionals](http://msdn.microsoft.com/en-gb/vsts2008/products/bb933747.aspx)。它主要是关于变更管理，但也有生成测试数据和单元测试的工具。

它相当昂贵。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-08-15T16:41:34.100

我们使用[DataFresh](http://blogs.ent0.com/files/default.aspx)来回滚每个测试之间的更改，然后测试 sprocs 相对容易。

仍然缺乏的是代码覆盖工具。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-04-29T03:32:32.710

我做穷人的单元测试。如果我很懒惰，那么测试只是几个具有潜在问题参数值的有效调用。

```
/*

--setup
Declare @foo int Set @foo = (Select top 1 foo from mytable)

--test
execute wish_I_had_more_Tests @foo

--look at rowcounts/look for errors
If @@rowcount=1 Print 'Ok!' Else Print 'Nokay!'

--Teardown
Delete from mytable where foo = @foo
*/
create procedure wish_I_had_more_Tests
as
select.... 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-08-15T15:44:00.127

仅当您从存储过程中删除逻辑并将其重新实现为 linq 查询时，LINQ 才会简化这一点。肯定会更健壮，更容易测试。但是，听起来您的要求会排除这种情况。

TL;DR：你的设计有问题。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-08-15T15:51:21.313

我们对调用 SP 的 C# 代码进行单元测试。
我们有构建脚本，创建干净的测试数据库。
我们在测试夹具期间连接和拆卸更大的夹具。
这些测试可能需要几个小时，但我认为这是值得的。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-08-15T17:09:23.060

重构代码的一种选择（我承认这是一个丑陋的黑客）是通过 CPP（C 预处理器）M4（从未尝试过）等生成它。我有一个项目正在这样做，它实际上大部分是可行的。

我认为可能有效的唯一情况是 1) 作为 KLOC+ 存储过程的替代方案和 2) 这是我的情况，当项目的重点是看看你可以将技术推到多远（疯狂）时。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-08-15T19:35:27.680

好家伙。sprocs 不适合（自动）单元测试。我通过在 t-sql 批处理文件中编写测试并手动检查打印语句的输出和结果来对复杂的存储过程进行排序“单元测试”。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-08-18T00:07:13.277

对任何类型的数据相关编程进行单元测试的问题在于，您必须从一组可靠的测试数据开始。很大程度上还取决于存储过程的复杂性及其作用。对于修改许多表的非常复杂的过程，自动化单元测试将非常困难。

其他一些海报提到了一些自动化手动测试它们的简单方法，以及一些可以与 SQL Server 一起使用的工具。在 Oracle 方面，PL/SQL 大师 Steven Feuerstein 开发了一个免费的 PL/SQL 存储过程单元测试工具，称为 utPLSQL。

然而，他放弃了这项工作，然后将 Quest 的 Code Tester for PL/SQL 投入商业。Quest 提供可免费下载的试用版。我正处于尝试的边缘；我的理解是，它擅长处理建立测试框架的开销，这样你就可以只关注测试本身，它会保留测试，这样你就可以在回归测试中重用它们，这是最大的好处之一测试驱动开发。此外，它应该擅长的不仅仅是检查输出变量，并且确实提供了验证数据更改的功能，但我仍然需要自己仔细研究一下。我认为这些信息可能对 Oracle 用户有价值。

# .net - 如何将 ChangeEvent 处理程序附加到继承的依赖项属性？

> ID：12385
> 
> 赞同：2
> 
> 时间：2008-08-15T15:34:20.367
> 
> 标签：.net, silverlight, dependency-properties

如何将 propertychanged 回调附加到继承的属性？像这样：

```
class A {
  DependencyProperty prop;
}

class B : A {
   //...
   prop.AddListener(PropertyChangeCallback);
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-15T16:14:18.913

（编辑删除使用 DependencyPropertyDescriptor 的建议，这在 Silverlight 中不可用）

[PropertyDescriptor AddValueChanged 替代方案](http://agsmith.wordpress.com/2008/04/07/propertydescriptor-addvaluechanged-alternative/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-15T19:34:06.653

您是否尝试过两个依赖属性之间的双向数据绑定？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-03T13:08:53.453

@MojoFilter，

Jon 的最后一个建议链接将为您提供您正在寻找的内容：它使用弱引用通过将属性包装在新对象中来注册监听更改。滚动到“PropertyDescriptor AddValueChanged Alternative”的底部。由于 BindingOperations 不存在，因此您必须稍微更改 Binding 代码。

# asp.net - .NET VirtualPathProviders 和预编译

> ID：12397
> 
> 赞同：6
> 
> 时间：2008-08-15T15:41:53.160
> 
> 标签：asp.net, virtualpathprovider

我们一直在开发一个非常依赖 ASP.NET 中的 VirtualPathProviders 的应用程序。

我们刚刚将这个东西放在实时服务器上进行演示，看起来 VirtualPathProviders在站点预编译时根本*不起作用！*

我一直在查看已在此处发布的解决方法：http: [//sunali.com/2008/01/09/virtualpathprovider-in-precompiled-web-sites/](http://sunali.com/2008/01/09/virtualpathprovider-in-precompiled-web-sites/)，但到目前为止我还没有能够得到那工作，要么！（嗯 - 它在 Visual Studio 的 Web 开发服务器上运行良好 - 只是不在我们的 IIS 机器上 - 再次！）。

这里有人有关于这个问题的更多信息吗？它是否在 .NET v3.5 中修复（我们目前正在为 v2.0 构建）？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-20T23:03:37.457

不幸的是，这不受官方支持。请参阅以下[MSDN 文章](http://msdn.microsoft.com/en-us/library/system.web.hosting.virtualpathprovider.aspx)。

> 如果为部署而预编译网站，则不会编译由 VirtualPathProvider 实例提供的内容，并且预编译站点不会使用任何 VirtualPathProvider 实例。

您提到的网站是一个非官方的解决方法。我认为它没有在 .NET 3.5 SP1 中得到修复

# asp.net - FOSS ASP.Net 会话复制解决方案？

> ID：12401
> 
> 赞同：6
> 
> 时间：2008-08-15T15:45:21.217
> 
> 标签：asp.net, session, cluster-computing, failover, session-replication

我一直在为 asp.net 寻找免费/开源会话集群和复制解决方案（但收效甚微）。我遇到了常见的嫌疑人（indexus sharedcache、memcached），但是，每个人都有一些限制。

*   **Indexus** - 非常不成熟的存根会话接口实现。不过，它在其他方面是一个很好的缓存解决方案。
*   **Memcached** - 很少支持复制/故障转移，无需进入数据库后端。几个 SF.Net 项目 - 都在早期阶段中止......似乎没有任何吸引力，一个似乎已经完全商业化。
*   **Microsoft Velocity** - 不是 OSS，但看起来不错。不幸的是，我没有看到 CTP1 支持故障转移的地方，也没有明确的路线图。我担心这个可能会像许多其他 MS 开发项目一样掉入以太中。

我相当习惯于 Java 世界，在这种情况下，FOSS 世界可以提供许多解决此类问题的解决方案，这是理所当然的。

.Net 世界上是否有任何合适的替代品？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-15T16:08:17.053

就 Velocity 而言，我最近听到了一些关于该项目的好消息。它仍处于开发阶段，可能还没有准备好黄金时段。但我认为该项目有坚实的基础，将成为微软强大的成熟产品，不会像你预测的那样堕落。

最近，我听到了[Scott Hanselman](http://www.hanselman.com/blog/HanselminutesPodcast116DistributedCachingWithMicrosoftsVelocity.aspx)和[Polymorphic Podcast](http://www.polymorphicpodcast.com/shows/scaletheweb/)关于 Velocity 的播客。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-06-09T03:37:11.403

只是为了完成而对这个线程进行快速更新。

Velocity（现在称为 Windows Server AppFabric）已经投入生产，并提供了一个出色的分布式缓存平台。更多详细信息可在 msdn 网站上找到

[http://msdn.microsoft.com/en-us/windowsserver/ee695849.aspx](http://msdn.microsoft.com/en-us/windowsserver/ee695849.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-09T06:00:07.663

顺便说一句，Windows Server AppFabric 已经过测试版。这就是我在上一篇文章中提到的。

这是关于一般可用性的链接；- [http://blogs.technet.com/b/appfabric/archive/2010/06/07/windows-server-appfabric-now-generally-available.aspx](http://blogs.technet.com/b/appfabric/archive/2010/06/07/windows-server-appfabric-now-generally-available.aspx)

您认为可以在 NCache 而不是 AppFabric 上获得哪些特定功能？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-05T13:04:13.260

尽管 Velocity 从 CTP1 到 CTP2 取得了进展，但仍有许多不足之处。他们需要一段时间才能在分布式缓存中提供所有重要功能，甚至更长时间才能在市场上进行测试。我祝他们好运。

同时，NCache 已经提供了所有的 CTP2 & V1 以及更多的特性。NCache 是 .NET 空间中第一个、最成熟、功能最丰富的分布式缓存。NCache 是 .NET 的企业级内存分布式缓存，还提供分布式 ASP.NET 会话状态。[在分布式缓存](http://www.alachisoft.com/rp.php?dest=/ncache/index.html)中查看。

NCache Express 是一个完全免费的 NCache 版本。[在免费分布式缓存](http://www.alachisoft.com/rp.php?dest=/ncache/ncache_express.html)中查看。

# visual-studio-2008 - 是否可以集成 Visual Studio 2008 SP1 安装？

> ID：12406
> 
> 赞同：9
> 
> 时间：2008-08-15T15:48:58.527
> 
> 标签：visual-studio-2008, visual-studio-2008-sp1

根据我的阅读，[VS 2008 SP1 和 Team Foundation Server SP1 软件包是传统的服务包，需要您先安装原始版本，然后才能安装 SP](http://blogs.msdn.com/astebner/archive/2008/08/11/8849574.aspx)。

有没有办法支持或不支持安装？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-15T16:06:39.427

这是一个[MSDN 论坛帖子](https://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=3337363&SiteID=1)，其中 MSFTie 表明这是可能的，并且详细信息即将发布。另一张海报正在传达她几乎成功的尝试的结果。看起来这将很快实现。

相关：[如何整合 Team Foundation Server 2008 SP1 (TFS 2008 SP1)](http://www.woodwardweb.com/tfs/000444.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-11-10T10:49:46.483

**以下是使用 Service Pack 1 整合 Visual Studio 2008 的步骤**

1.  假设您在 G: 驱动器上安装了 Visual Studio 2008 ISO 文件或 DVD。如果您的驱动器号不同，请不要担心。我将在第 4 步中回到这一点。

2.  你有足够的空间说在分区中的硬盘说D：大约8GB。

3.  将 Visual Studio 2008 Service Pack 1 解压到 D:\VS\SP1 文件夹

4.  将以下命令复制到批处理文件并将其命名为“integrate.bat”并将其放在“D:\VS\”文件夹中。如果你的 DVD 盘符不同，那么适当修改批处理文件中的 G: 为对应的盘符。

    ```
    ::Extract the original visual studio 2008 installation to directory VS2k8WithSP1.
    msiexec.exe /a "g:\vs_setup.msi" TARGETDIR="%CD%\VS2k8WithSP1"

    ::Copy some file to make slipstream integration successful.
    copy "VS2k8WithSP1\Program Files\Microsoft Visual Studio 9.0\Common7\1033\*.chm" "VS2k8WithSP1\Program Files\Microsoft Visual Studio 9.0\Common7\IDE\"

    ::Extract each .msp files to directory VS2k8WithSP1.
    msiexec.exe /a "%cd%\VS2k8WithSP1\vs_setup.msi" /p "%cd%\SP1\vs90sp1\VS90sp1-KB945140-X86-ENU.msp"
    msiexec.exe /a "%cd%\VS2k8WithSP1\vs_setup.msi" /p "%cd%\SP1\vs90sp1\VC90sp1-KB947888-x86-enu.msp"
    msiexec.exe /a "%cd%\VS2k8WithSP1\vs_setup.msi" /p "%cd%\SP1\vs90sp1\VC90sp1-KB948484-x86_x64-enu.msp"
    msiexec.exe /a "%cd%\VS2k8WithSP1\vs_setup.msi" /p "%cd%\SP1\vs90sp1\VC90sp1-KB948560-x86_IA64-enu.msp"

    ::Copy the product key file
    copy "VS2k8WithSP1\Setup\Setup.sdb"

    ::Copy the setup bootstrapper files
    copy "VS2k8WithSP1\Program Files\Microsoft Visual Studio 9.0\CSetupMM\*.*" "VS2k8WithSP1\Setup"

    ::Copy VC runtime files
    md VS2k8WithSP1\wcu\VCRuntimes
    copy SP1\vs90sp1\vc_*runtime.exe VS2k8WithSP1\wcu\VCRuntimes

    ::copy SQL Server Database Publishing Wizard
    copy SP1\vs90sp1\SqlPubWizInstaller.exe VS2k8WithSP1\wcu\SqlPub

    ::copy SQL Server 2008 Management Objects and SQL Server System CLR Types configuration.
    md VS2k8WithSP1\wcu\SMO
    copy SP1\vs90sp1\SharedManagementObjects.msi VS2k8WithSP1\wcu\SMO
    copy SP1\vs90sp1\SQLSysClrTypes.msi VS2k8WithSP1\wcu\SMO

    ::copy SQL Server Compact 3.5 SP1 English with the Microsoft SQL Server Compact 3.5 SP1 Design Tools English.
    copy /Y SP1\vs90sp1\SSCERuntime-enu.msi VS2k8WithSP1\wcu\SSCE
    copy /Y SP1\vs90sp1\SSCEVSTools-enu.msi VS2k8WithSP1\wcu\SSCE

    ::Extract the dotnetfx35.exe manually to a %tmp% folder. Copy all files and subdirectories from %tmp%\wcu\dotnetframework to vs2k8WithSP1\wcu\dotnetframework and overwrite files
    ::Sorry I could not able to automate this step as /extract option is disabled in the dotnetfx35.exe file. 
    ```

5.  转到命令提示符并导航到“D:\VS\”。

6.  使用“D:\VS”作为当前目录执行Integrate.bat 批处理文件。这将需要大约 1 小时。所以放松并与其他东西并行工作。

7.  批处理文件完全执行后，手动将 dotnetfx35.exe 解压缩到“D:\VS\tmp 文件夹”。将所有文件和子目录从“D:VS\tmp\wcu\dotnetframework”复制并覆盖到“D:\VS\vs2k8WithSP1\wcu\dotnetframework”

8.  现在您已经成功地将 Visual Studio 2008 与 Service Pack1 整合在一起。现在 D:\VS\VS2k8WithSP1 文件夹包含 Visual Studio 2008 的整合副本。现在您可以删除 ISO 文件（如果有）以及 D:\VS\VS2k8WithSP1 以外的任何其他文件或文件夹。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-09-13T13:35:18.513

上面发布的步骤工作，有一些小的调整：

```
::Copy some file to make slipstream integration successful. 
copy "VS2k8WithSP1\Program Files\Microsoft Visual Studio 9.0\Common7\1033*.chm" "VS2k8WithSP1\Program Files\Microsoft Visual Studio 9.0\Common7\IDE\" 
```

我建议手动复制 1033 文件夹中的多个文件。只有他们两个。在批处理文件中使用星号 (*) 似乎有些混乱。

我还建议手动复制以下文件：

```
::Copy the setup bootstrapper files 
copy "VS2k8WithSP1\Program Files\Microsoft Visual Studio 9.0\CSetupMM*.*" "VS2k8WithSP1\Setup" 
```

对于 SQL 发布向导 1.3：

```
::copy SQL Server Database Publishing Wizard 
copy SP1\vs90sp1\SqlPubWizInstaller.exe VS2k8WithSP1\wcu\SqlPub 
```

Visual Studio 2008 安装程序将在安装结束时告诉您此组件安装失败。

```
VS70pgui: [2] DepCheck indicates Microsoft SQL Publishing Wizard 1.3 is not installed. 
```

但是，在检查事件查看器以及 Visual Studio 安装日志时，情况**并非如此**。所有迹象都表明它安装成功。并且实际使用向导的真实测试效果很好。

除此之外，本教程效果很好！

非常感谢作者。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-06T13:50:09.637

::复制一些文件以使滑流集成成功。复制 "VS2k8WithSP1\Program Files\Microsoft Visual Studio 9.0\Common7\1033*.chm" "VS2k8WithSP1\Program Files\Microsoft Visual Studio 9.0\Common7\IDE\"

这里有错误，应该是：

::复制一些文件以使滑流集成成功。复制 "VS2k8WithSP1\Program Files\Microsoft Visual Studio 9.0\Common7\1033\*.chm" "VS2k8WithSP1\Program Files\Microsoft Visual Studio 9.0\Common7\IDE\"

在这种情况下，“\”必须加倍，因为其中一个用作“*”的转义字符

# scripting - 自动将条目添加到 wiki

> ID：12428
> 
> 赞同：3
> 
> 时间：2008-08-15T16:09:37.783
> 
> 标签：scripting, automation, webautomation

一旦我有了重命名的文件，我需要将它们添加到我的项目的 wiki 页面。这是一个相当重复的手动任务，所以我想我可以编写脚本，但我不知道从哪里开始。

过程是：

```
Got to appropriate page on the wiki

for each team member (DeveloperA, DeveloperB, DeveloperC)
{
    for each of two files ('*_current.jpg', '*_lastweek.jpg')
    {
        Select 'Attach' link on page
        Select the 'manage' link next to the file to be updated
        Click 'Browse' button
        Browse to the relevant file (which has the same name as the previous version)
        Click 'Upload file' button
    }
} 
```

不一定要寻找完整的解决方案，因为我想自己尝试一下。

从哪里开始？我可以使用什么语言来做到这一点，它有多难？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-15T17:11:40.967

检查您要与之交谈的 wiki 是否支持[XMLRPC](http://www.jspwiki.org/wiki/WikiRPCInterface2)，因为如果支持，它应该很容易。我编写了一个名为[WikiUp](http://trac.gargoyle.ath.cx/trac/wiki/WikiUp)的工具来解决类似的问题（更新 wiki 页面上划定的部分）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-15T16:16:22.170

如果您使用 C# 编写，WebClient 类可能是一个不错的起点。我敢打赌，如果您提到您使用的是哪个 wiki 平台，以及它是否需要身份验证，人们会给出更具体的建议。

我可能会先下载 fiddler 并手动查看 http 请求。然后，您可以使用一些简单的脚本和正则表达式来构建您的 http 请求以使流程自动化。

当然，如果你非常幸运，你的 wiki 会有一个足够简单的后端，你可以直接将它们插入到它的数据库中。:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-15T16:23:47.927

您可能会发现[CoScripter](http://services.alphaworks.ibm.com/coscripter)很有用——它是一个 Firefox 扩展，可让您自动执行在网站上执行的任务。我不确定您如何将其与您在本地系统上更改的文件列表集成，但它当然可以处理通过网络表单上传的文件。

更好的选择可能是在您选择的编程语言中使用[cURL](http://curl.haxx.se/)或类似的 HTTP 库。如果你在 *nix 上，你可以在你的 shell 脚本中使用[cURL 命令行程序](http://curl.haxx.se/docs/manpage.html)来相当容易地完成这项工作。（就像@jsight 所说，您需要分析您在网页上使用的实际表单，使用 Fiddler 或只是查看表单元素并通过 cURL 重新创建 POST。）

# asp.net - 为什么我的 asp.net 应用程序抛出 ThreadAbortException？

> ID：12476
> 
> 赞同：23
> 
> 时间：2008-08-15T17:02:44.867
> 
> 标签：asp.net, multithreading

这是一个不言自明的问题：

为什么即使没有任何问题，这个东西也会冒泡到我的 try catch 中？

为什么它会在我的日志中出现数百次？

**我知道这是一个新手问题，但如果这个网站要获得搜索排名并吸引新手，我们必须问他们**

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-08-15T17:11:32.213

这可能来自 Response.Redirect 调用。检查此链接以获取说明：

[http://dotnet.org.za/armand/archive/2004/11/16/7088.aspx](http://dotnet.org.za/armand/archive/2004/11/16/7088.aspx)

（在大多数情况下，调用 Response.Redirect(url, false) 可以解决问题）

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-08-15T17:12:45.283

ThreadAbortException 最常见的原因是调用[Response.End、Response.Redirect 或 Server.Transfer](http://support.microsoft.com/kb/312629)。Microsoft 已发布了一些建议的函数，应使用这些函数代替这些函数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-05T00:40:07.537

正如其他人所说，它发生在您调用 Response.End() 时（当您调用 Response.Redirect 而不传递 false 作为第二个参数时发生）。这是按设计工作的；通常，如果您调用 Response.Redirect，您希望重定向立即发生。有关更多信息，请参见：

[Response.Redirect 和 ThreadAbortException](http://www.sagara.net/2008/04/05/response-redirect-and-the-threadabortexception-and-why-its-a-good-thing/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-08-29T09:30:06.490

知道有（至少）三个内部使用的 API `Thread.Abort`，我想用更实际的术语回答，如何解决它。

对我们来说，这个错误开始被记录下来。发生了什么变化？我们修复了一些处理站点地图的数据库过程中的错误。

log4net 日志显示 X-Forwarded-For 标头（我们在 NLB 后面）是 Googlebot 的 IP 地址 66.249.78.x，这支持了我关于站点地图更改导致 Google 更积极地抓取我们的站点以查找图像的理论。

首先是找出为什么只有 Googlebot 能够导致这个问题。没有其他客户端触发任何代码路径使用`Response.Redirect`，或其他。

因此，在`HttpApplication.Error`处理程序中，我添加了一些代码来记录带有所有标题的额外详细输出，以及其中的大多数数据`HttpResponse`并`HttpContext`喷入日志。

这让我看到问题在于 Googlebot 正在使用 iPhone 用户代理字符串并使用它，我能够在代码库中搜索“iPhone”并提出：

```
private void CheckIPhoneAccess() { ... } 
```

这使用了重定向。

该怎么办？

好吧，对于这个陈旧的代码库，不值得对所有`Response.Redirect`调用进行追溯修补​​，因此我将降低`ThreadAbortException`应用程序的日志记录级别。

我将更改 Googlebot 的移动爬虫的行为，这*不会*导致我们的网站向手机提供的服务“撒谎”，因为它只会在第一次点击时重定向，随后它会读取 cookie 并显示图像。Googlebot 似乎没有缓存该 cookie。

它并不完美，但该网站将被重建。可能是由另一个团队使用 Scala 之类的，所以实际上，我认为这是一个不错的选择。我将添加评论，稍后可能会重新讨论该问题，构建一个`Response.SafeRedirect`封装此建议的扩展：

[为什么 Response.Redirect 会导致 System.Threading.ThreadAbortException？](https://stackoverflow.com/questions/2777105/why-response-redirect-causes-system-threading-threadabortexception)

卢克

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-08-29T09:53:49.130

The reason of why Response.Redirect will give this exception is asp.net internally implement this API with Thread.Abort(). When this method is called, a special ThreadAbortException is thrown.This exception wont be swallowed by any catch block. It will be re thrown at the end of each catch block.

# msbuild - 如何通过 CruiseControl.NET 发布 ClickOnce 应用程序？

> ID：12482
> 
> 赞同：24
> 
> 时间：2008-08-15T17:08:19.583
> 
> 标签：msbuild, clickonce, cruisecontrol.net, publish

我在我的开发服务器上设置了 CruiseControl.NET 1.4 版。每当开发人员签入代码时，都会进行编译。

现在我们可以开始将我们的应用程序提供给测试人员了。我们想使用 ClickOnce 来分发应用程序，其想法是当测试人员去测试应用程序时，他们拥有最新的构建。

我找不到使用 CruiseControl.NET 实现这一点的方法。我们使用 MSBUILD 来执行构建。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-08-15T17:29:01.757

我们已经完成了这项工作，可以为您提供一些开始的指导。

你应该注意的2件事：

*   MSBuild 可以为您生成必要的部署文件。
*   MSBuild 不会将文件部署到 FTP 或 UNC 共享。为此，您需要一个单独的步骤。

要使用 MSBuild 生成 ClickOnce 清单，您需要发出以下命令：

```
msbuild /target:publish /p:Configuration=Release /p:Platform=AnyCPU; "c:\yourProject.csproj" 
```

这将告诉 MSBuild 构建您的项目并在*bin\Release\YourProject.publish*目录中生成 ClickOnce 部署文件。

剩下的就是将这些文件复制到 FTP/UNC 共享/任何地方，一切就绪。

您可以告诉 CruiseControl.NET 使用这些 MSBuild 参数进行构建。

然后，您将需要 CruiseControl.NET 构建任务来获取生成的部署文件并将它们复制到 FTP 或 UNC 共享。我们为此使用了一个自定义的小 C# 控制台程序，但您也可以轻松地使用 Powershell 脚本。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-20T18:37:54.870

感谢所有的帮助。我们实施的最终解决方案从每个答案中提取了一点。

我们发现使用简单的批处理文件可以更轻松地处理多个环境。我并不是说这是最好的方法，但是对于我们给定的场景和要求，这很有效。用您的项目名称补充“项目”，用您的环境名称（开发、测试、阶段、生产等）补充“环境”。

这是我们的“ccnet.config”文件的任务区域。

```
<!-- override settings  -->
<exec>
    <executable>F:\Source\Project\Environment\CruiseControl\CopySettings.bat</executable>
</exec>

<!-- compile -->
<msbuild>
    <executable>C:\WINDOWS\Microsoft.NET\Framework\v3.5\MSBuild.exe</executable>
    <workingDirectory>F:\Source\Project\Environment\</workingDirectory>
    <projectFile>Project.sln</projectFile>
    <buildArgs>/noconsolelogger /p:Configuration=Debug /v:diag</buildArgs>
    <targets>Rebuild</targets>
    <timeout>0</timeout>
    <logger>ThoughtWorks.CruiseControl.MsBuild.XmlLogger,ThoughtWorks.CruiseControl.MsBuild.dll</logger>
</msbuild>

<!-- clickonce publish  -->
<exec>
    <executable>F:\Source\Project\Environment\CruiseControl\Publish.bat</executable>
</exec> 
```

您会注意到的第一件事是 CopySettings.bat 运行。这会复制环境的特定设置，例如数据库连接。

接下来，标准的 MSBUILD 任务运行。任何编译错误都会在这里捕获并正常处理。

最后要执行的是 Publish.bat。这实际上从命令行再次执行 MSBUILD“重建”，并且 CruiseControl 的参数会自动传入和构建。接下来，为“发布”目标调用 MSBUILD。发布重建时为发布提供完全相同的参数。这使内部版本号保持同步。此外，我们的可执行文件的名称也不同（即 ProjectDev 和 ProjectTest）。我们最终得到不同的版本号和名称，这允许 ClickOnce 完成它的工作。

Publish.bat 的最后一部分将实际文件复制到他们的新家。我们不使用 publish.htm，因为我们所有的用户都在网络上，我们只是为他们提供了桌面上清单文件的快捷方式，他们可以单击并始终运行正确的可执行文件，其版本号与巡航控制。

这是 CopySettings.bat

```
XCOPY "F:\Source\Project\Environment\CruiseControl\Project\app.config" "F:\Source\Project\Environment\Project" /Y /I /R
XCOPY "F:\Source\Project\Environment\CruiseControl\Project\My Project\Settings.Designer.vb" "F:\Source\Project\Environment\Project\My Project" /Y /I /R
XCOPY "F:\Source\Project\Environment\CruiseControl\Project\My Project\Settings.settings" "F:\Source\Project\Environment\Project\My Project" /Y /I /R 
```

最后，这里是 Publish.bat

```
C:\WINDOWS\Microsoft.NET\Framework\v3.5\MSBuild.exe /target:rebuild "F:\Source\Project\Environment\Project\Project.vbproj" /property:ApplicationRevision=%CCNetLabel% /property:AssemblyName="ProjectEnvironment" /property:PublishUrl="\\Server\bin\Project\Environment\\"
C:\WINDOWS\Microsoft.NET\Framework\v3.5\MSBuild.exe /target:publish "F:\Source\Project\Environment\Project\Project.vbproj" /property:ApplicationVersion="1.0.0.%CCNetLabel%" /property:AssemblyVersion="1.0.0.%CCNetLabel%" /property:AssemblyName="ProjectEnvironment" 

XCOPY "F:\Source\Project\Environment\Project\bin\Debug\app.publish" "F:\Binary\Project\Environment" /Y /I
XCOPY "F:\Source\Project\Environment\Project\bin\Debug\app.publish\Application Files" "F:\Binary\Project\Environment\Application Files" /Y /I /S 
```

就像我说的，它可能没有按照 CruiseControl 和 MSBUILD 开发人员的预期工作方式完成，但它确实有效。如果您需要在昨天完成这项工作，它可能就是您正在寻找的解决方案。祝你好运！

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-19T17:05:04.703

我记得去年我正在为一个 ClickOnce 项目做这个。我记得我花了很长时间才弄清楚，但它就在这里。我希望我的脚本做的是生成一个不同的安装程序，指向我们的开发环境和一个不同的产品环境。不仅如此，我还需要它来注入正确的版本信息，这样现有的客户就会“意识到”有一个新版本，这就是 clickOnce 的全部意义所在。在这个脚本中，你必须用你自己的服务器名称等替换。诀窍是保存 publish.htm 和 project.publish 文件，并根据 CC.NET 提供给你的版本注入新的版本号。

这是我的构建脚本的样子：

```
<target name="deployProd">
  <exec program="<framework_dir>\msbuild.exe" commandline="<project>/<project>.csproj /property:Configuration=PublishProd /property:ApplicationVersion=${build.label}.*;PublishUrl=\\<prod_location>\binups$\;InstallUrl=\\<prod_location>\binups$\;UpdateUrl=\\<prod_location>\binups$\;BootstrapperComponentsUrl=\\<prod_location>\prereqs$\ /target:publish"/>

  <copy todir="<project>\bin\PublishProd\<project>.publish">

    <fileset basedir=".">
      <include name="publish.htm"/>
    </fileset>

    <filterchain>
      <replacetokens>
        <token key="CURRENT_VERSION" value="${build.label}"/>
      </replacetokens>
     </filterchain>
  </copy>

</target> 
```

希望这可以帮助

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-03T14:27:04.673

只要能够在 CCNET.config msbuild 任务中传递 ${CCNetLabel} 将是一个很大的改进。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-08-15T17:22:33.423

您想在 msbuild 中使用 ClickOnce 清单生成任务。这个过程有点冗长，所以我只想为您指出几个链接。这是[msdn 上的参考资料](http://msdn.microsoft.com/en-us/library/6wc2ccdc.aspx)和[示例文章](http://windowsclient.net/articles/ClickOnce_MsBuild.aspx)，希望能帮助您入门。

# c - 如何在 C 中获得目录列表？

> ID：12489
> 
> 赞同：65
> 
> 时间：2008-08-15T17:15:04.670
> 
> 标签：c, file, directory, cross-platform, common-tasks

如何在 C 中扫描目录中的文件夹和文件？它需要是跨平台的。

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2008-08-15T17:27:32.307

以下 POSIX 程序将打印当前目录中文件的名称：

```
#define _XOPEN_SOURCE 700
#include <stdio.h>
#include <sys/types.h>
#include <dirent.h>

int main (void)
{
  DIR *dp;
  struct dirent *ep;     
  dp = opendir ("./");

  if (dp != NULL)
  {
    while (ep = readdir (dp))
      puts (ep->d_name);

    (void) closedir (dp);
  }
  else
    perror ("Couldn't open the directory");

  return 0;
} 
```

信用：[http ://www.gnu.org/software/libtool/manual/libc/Simple-Directory-Lister.html](http://www.gnu.org/software/libtool/manual/libc/Simple-Directory-Lister.html)

在 Ubuntu 16.04 中测试。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-08-15T17:27:42.383

严格的答案是“你不能”，因为文件夹的概念并不是真正的跨平台。

在 MS 平台上，您可以使用 _findfirst、_findnext 和 _findclose 获得“c”类的感觉，并使用 FindFirstFile 和 FindNextFile 获得底层 Win32 调用。

这是 C-FAQ 的答案：

[http://c-faq.com/osdep/readdir.html](http://c-faq.com/osdep/readdir.html)

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2013-02-04T00:52:29.670

我创建了一个开源 (BSD) C 头文件来处理这个问题。它目前支持 POSIX 和 Windows。请检查一下：

[https://github.com/cxong/tinydir](https://github.com/cxong/tinydir)

```
tinydir_dir dir;
tinydir_open(&dir, "/path/to/dir");

while (dir.has_next)
{
    tinydir_file file;
    tinydir_readfile(&dir, &file);

    printf("%s", file.name);
    if (file.is_dir)
    {
        printf("/");
    }
    printf("\n");

    tinydir_next(&dir);
}

tinydir_close(&dir); 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-08-15T17:29:29.557

没有标准的 C（或 C++）方法来枚举目录中的文件。

在 Windows 下，您可以使用 FindFirstFile/FindNextFile 函数枚举目录中的所有条目。在 Linux/OSX 下使用 opendir/readdir/closedir 函数。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-09-17T20:18:26.230

[GLib](http://library.gnome.org/devel/glib/stable/)是 C 的可移植性/实用程序库，它构成了 GTK+ 图形工具包的基础。它可以用作一个独立的库。

它包含用于管理目录的可移植包装器。有关详细信息，请参阅[Glib 文件实用程序](http://library.gnome.org/devel/glib/stable/glib-File-Utilities.html)文档。

就个人而言，如果没有像 GLib 这样的东西，我什至不会考虑编写大量的 C 代码。可移植性是一回事，但免费获得数据结构、线程助手、事件、主循环等也很好

Jikes，我几乎开始听起来像个销售员了 :) （别担心，glib 是开源的（LGPL），我与它没有任何关系）

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-08-15T17:26:02.387

opendir/readdir 是 POSIX。如果 POSIX 不足以实现您想要实现的可移植性，请检查[Apache Portable Runtime](http://apr.apache.org/docs/apr/1.3/group__apr__dir.html)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-07-24T07:42:21.093

最*相似*的方法`readdir`可能是使用鲜为人知[`_find`的函数族](http://msdn.microsoft.com/en-us/library/kda16keh.aspx)。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-08-15T20:20:24.267

目录列表根据所考虑的操作系统/平台而有很大差异。这是因为，各种操作系统使用自己的内部系统调用来实现这一点。

这个问题的解决方案是寻找一个可以掩盖这个问题并且可移植的库。不幸的是，没有可以在所有平台上完美运行的解决方案。

在与 POSIX 兼容的系统上，您可以使用 Clayton 发布的代码（最初引用自 W. Richard Stevens 的《UNIX 下的高级编程》一书）使用该库来实现此目的。此解决方案将在 *NIX 系统下运行，如果您安装了 Cygwin，也可以在 Windows 上运行。

或者，您可以编写代码来检测底层操作系统，然后调用适当的目录列表函数，该函数将保持在该操作系统下列出目录结构的“正确”方式。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-11-28T19:21:44.157

[您可以在wikibooks 链接](https://en.wikibooks.org/wiki/C_Programming/dirent.h)上找到示例代码

```
/**************************************************************
 * A simpler and shorter implementation of ls(1)
 * ls(1) is very similar to the DIR command on DOS and Windows.
 **************************************************************/
#include <stdio.h>
#include <dirent.h>

int listdir(const char *path) 
{
  struct dirent *entry;
  DIR *dp;

  dp = opendir(path);
  if (dp == NULL) 
  {
    perror("opendir");
    return -1;
  }

  while((entry = readdir(dp)))
    puts(entry->d_name);

  closedir(dp);
  return 0;
}

int main(int argc, char **argv) {
  int counter = 1;

  if (argc == 1)
    listdir(".");

  while (++counter <= argc) {
    printf("\nListing %s...\n", argv[counter-1]);
    listdir(argv[counter-1]);
  }

  return 0;
} 
```

# xml - 在 Emacs 上漂亮地打印 XML 文件

> ID：12492
> 
> 赞同：85
> 
> 时间：2008-08-15T17:17:14.823
> 
> 标签：xml, emacs, editor

我使用 emacs 编辑我的 xml 文件（nxml 模式），并且这些文件是由机器生成的，没有任何漂亮的标签格式。

我已经搜索了带有缩进的漂亮打印整个文件并保存它，但无法找到自动方式。

有办法吗？或者至少有一些 Linux 上的编辑器可以做到这一点。

* * *

## 回答 #1

> 赞同：113
> 
> 时间：2009-02-27T16:47:05.117

您甚至不需要编写自己的函数 - sgml-mode（一个 gnu emacs 核心模块）有一个名为 (sgml-pretty-print ...) 的内置漂亮打印函数，它接受区域开始和结束参数。

如果您正在剪切和粘贴 xml，并且您发现您的终端正在任意位置截断线条，您可以使用这[台漂亮的打印机](http://curiousprogrammer.wordpress.com/2009/02/27/pretty-printing-xml/)，它首先修复断线。

* * *

## 回答 #2

> 赞同：89
> 
> 时间：2009-02-20T15:41:39.950

如果您只需要漂亮的缩进而不引入任何新的换行符，则可以`indent-region`使用以下击键将该命令应用于整个缓冲区：

```
C-x h
C-M-\ 
```

如果您还需要引入换行符，以便开始和结束标签在不同的行上，您可以使用以下非常好的 elisp 函数，由[Benjamin Ferrari](http://blog.bookworm.at/2007/03/pretty-print-xml-with-emacs.html)编写。我在他的博客上找到了它，希望我可以在这里复制它：

```
(defun bf-pretty-print-xml-region (begin end)
  "Pretty format XML markup in region. You need to have nxml-mode
http://www.emacswiki.org/cgi-bin/wiki/NxmlMode installed to do
this.  The function inserts linebreaks to separate tags that have
nothing but whitespace between them.  It then indents the markup
by using nxml's indentation rules."
  (interactive "r")
  (save-excursion
    (nxml-mode)
    (goto-char begin)
    (while (search-forward-regexp "\>[ \\t]*\<" nil t) 
      (backward-char) (insert "\n") (setq end (1+ end)))
    (indent-region begin end))
  (message "Ah, much better!")) 
```

这不依赖于像 Tidy 这样的外部工具。

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2010-02-02T03:50:04.800

Emacs 可以使用 M-| 运行任意命令。如果您安装了 xmllint：

"M-| xmllint --format -" 将格式化所选区域

"Cu M-| xmllint --format -" 将做同样的事情，用输出替换区域

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2008-08-15T17:47:29.893

当我想格式化和缩进 XML 或 HTML 时，我使用[nXML 模式](http://www.thaiopensource.com/nxml-mode/)进行编辑和[整理。](http://tidy.sourceforge.net/)[Tidy](http://www.emacswiki.org/emacs/tidy.el)还有一个 Emacs 接口。

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2010-11-25T21:00:50.373

感谢上面的 Tim Helmstedt，我做了这样的 st：

```
(defun nxml-pretty-format ()
    (interactive)
    (save-excursion
        (shell-command-on-region (point-min) (point-max) "xmllint --format -" (buffer-name) t)
        (nxml-mode)
        (indent-region begin end))) 
```

快速简单。非常感谢。

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2016-05-31T07:52:00.807

用于引入换行符，然后进行漂亮的打印

```
M-x sgml-mode
M-x sgml-pretty-print 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2011-03-04T19:19:28.820

这是我对 Benjamin Ferrari 的版本进行的一些调整：

*   没有`search-forward-regexp`指定结束，因此它将对从区域开始到缓冲区结束（而不是区域结束）的内容进行操作
*   `end`正如 Cheeso 所指出的，现在正确递增。
*   它将在 之间插入一个中断`<tag></tag>`，从而修改其值。是的，从技术上讲，我们正在修改这里所有内容的值，但是空的开始/结束更可能是重要的。现在使用两个单独的、稍微更严格的搜索来避免这种情况。

仍然有“不依赖外部整洁”等。但是，它确实需要`cl`宏`incf`。

```
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;; pretty print xml region
(defun pretty-print-xml-region (begin end)
  "Pretty format XML markup in region. You need to have nxml-mode
http://www.emacswiki.org/cgi-bin/wiki/NxmlMode installed to do
this.  The function inserts linebreaks to separate tags that have
nothing but whitespace between them.  It then indents the markup
by using nxml's indentation rules."
  (interactive "r")
  (save-excursion
    (nxml-mode)
    (goto-char begin)
    ;; split <foo><foo> or </foo><foo>, but not <foo></foo>
    (while (search-forward-regexp ">[ \t]*<[^/]" end t)
      (backward-char 2) (insert "\n") (incf end))
    ;; split <foo/></foo> and </foo></foo>
    (goto-char begin)
    (while (search-forward-regexp "<.*?/.*?>[ \t]*<" end t)
      (backward-char) (insert "\n") (incf end))
    (indent-region begin end nil)
    (normal-mode))
  (message "All indented!")) 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2011-11-04T02:32:33.367

一种方法是如果您有以下格式的内容

```
<abc>     <abc><abc>   <abc></abc> </abc></abc>       </abc> 
```

在 Emacs 中，尝试

```
M-x nxml-mode
M-x replace-regexp RET  > *< RET >C-q C-j< RET 
C-M-\ to indent 
```

这会将上面的 xml 示例缩进到下面

```
<abc>
  <abc>
    <abc>
      <abc>
      </abc>
    </abc>
  </abc>
</abc> 
```

在 VIM 中，您可以通过

```
:set ft=xml
:%s/>\s*</>\r</g
ggVG= 
```

希望这可以帮助。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-12T08:14:40.567

1.  Emacs nxml-mode 可以处理呈现的格式，但您必须拆分行。
2.  对于根本不值得的较长文件。对较长的文件运行此样式表（最好使用 Saxon，恕我直言，行缩进正确）以获得漂亮的打印效果。对于要保留空格的任何元素，请在“programlisting”旁边添加它们的名称，如“programlisting yourElementName”

高温高压

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2013-01-29T18:21:56.437

我采用了[Jason Viers 的版本](https://stackoverflow.com/a/5198243/48082)并添加了将 xmlns 声明放在自己的行中的逻辑。这假设您有 xmlns= 和 xmlns: 没有中间空格。

```
(defun cheeso-pretty-print-xml-region (begin end)
  "Pretty format XML markup in region. You need to have nxml-mode
http://www.emacswiki.org/cgi-bin/wiki/NxmlMode installed to do
this.  The function inserts linebreaks to separate tags that have
nothing but whitespace between them.  It then indents the markup
by using nxml's indentation rules."
  (interactive "r")
  (save-excursion
    (nxml-mode)
    ;; split <foo><bar> or </foo><bar>, but not <foo></foo>
    (goto-char begin)
    (while (search-forward-regexp ">[ \t]*<[^/]" end t)
      (backward-char 2) (insert "\n") (incf end))
    ;; split <foo/></foo> and </foo></foo>
    (goto-char begin)
    (while (search-forward-regexp "<.*?/.*?>[ \t]*<" end t)
      (backward-char) (insert "\n") (incf end))
    ;; put xml namespace decls on newline
    (goto-char begin)
    (while (search-forward-regexp "\\(<\\([a-zA-Z][-:A-Za-z0-9]*\\)\\|['\"]\\) \\(xmlns[=:]\\)" end t)
      (goto-char (match-end 0))
      (backward-char 6) (insert "\n") (incf end))
    (indent-region begin end nil)
    (normal-mode))
  (message "All indented!")) 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-08-15T18:09:10.227

整洁看起来是一个不错的模式。必须看看它。如果我真的需要它提供的所有功能，我会使用它。

无论如何，这个问题困扰了我大约一个星期，我没有正确搜索。发布后，我开始搜索并找到一个具有[elisp 功能](http://blog.bookworm.at/2007/03/pretty-print-xml-with-emacs.html)的网站，它做得很好。作者还建议使用 Tidy。

感谢 Marcel 的回答~~（太糟糕了，我没有足够的积分来升级你）~~。

~~很快就会在我的博客上发布它。~~这是一篇[关于它](http://codelog.blogial.com/2008/08/15/pretty-print-xml-files-in-emacs/)的帖子（带有指向 Marcel 网站的链接）。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-02-02T14:35:39.653

我**`xml-reformat-tags`**从**[xml-parse.el](http://www.emacswiki.org/emacs/xml-parse.el)**使用。通常，在运行此命令时，您会希望该点位于文件的开头。

有趣的是，该文件被合并到[Emacspeak](http://emacspeak.sourceforge.net/)中。当我每天使用 Emacspeak 时，我认为`xml-reformat-tags`它是 Emacs 内置的。有一天我把它弄丢了，不得不在网上搜索它，然后就进入了上面提到的维基页面。

我还附上了我的代码以启动 xml-parse。不确定这是否是最好的 Emacs 代码，但似乎对我有用。

```
(if (file-exists-p "~/.emacs.d/packages/xml-parse.el")
  (let ((load-path load-path))
    (add-to-list 'load-path "~/.emacs.d/packages")
    (require 'xml-parse))
) 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2016-08-10T08:33:32.453

如果您使用[spacemacs](http://spacemacs.org)，只需使用命令“spacemacs/indent-region-or-buffer”。

```
M-x spacemacs/indent-region-or-buffer 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2017-04-07T03:22:12.277

自 2017 年起，emacs 已默认提供此功能，但您必须将这个小功能写入您的`~/.emacs.d/init.el`：

```
(require 'sgml-mode)

(defun reformat-xml ()
  (interactive)
  (save-excursion
    (sgml-pretty-print (point-min) (point-max))
    (indent-region (point-min) (point-max)))) 
```

然后打电话`M-x reformat-xml`

来源：[https ://davidcapello.com/blog/emacs/reformat-xml-on-emacs/](https://davidcapello.com/blog/emacs/reformat-xml-on-emacs/)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-05-12T18:18:21.687

恐怕我更喜欢本杰明法拉利版本。内部漂亮的打印总是将结束标签放在值之后的新行中，在标签值中插入不需要的 CR。

# powershell - PowerShell 的 Invoke-Expression 缺少参数

> ID：12501
> 
> 赞同：2
> 
> 时间：2008-08-15T17:26:44.663
> 
> 标签：powershell, powershell-2.0

我以为我有最新的 PowerShell 2 CTP，但是当我尝试命令时：

`invoke-expression –computername Server01 –command 'get-process PowerShell'`

我收到一条错误消息：
**找不到与参数名称“计算机名”匹配的参数。**

所以问题是：如何知道我安装了哪个版本的 PowerShell？最新版本是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-22T15:59:14.993

从昨晚的构建开始（这意味着您可能在 CTP3 中拥有它，但如果没有，您将在下一次公开发布中获得它）：

```
[4120:0]PS> $psversiontable
Name                           Value
----                           -----
CLRVersion                     2.0.50727.3521
BuildVersion                   6.1.7047.0
PSVersion                      2.0
WSManStackVersion              2.0
PSCompatibleVersions           {1.0, 2.0}
SerializationVersion           1.1.0.1
PSRemotingProtocolVersion      2.0 
```

实验！享受！从事！

Jeffrey Snover [MSFT] Windows 管理合作伙伴架构师

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T02:35:36.823

问题是，从 CTP 1 到 CTP2，他们切换了 Invoke 的东西，所有远程处理的东西现在都完成`Invoke-Command`了，并且`Invoke-Expression`只是为了将字符串转换为脚本；）

PS：如果您使用的是 v2，您可以运行`$PSVersionTable`以查看版本列表，包括 CLR 和 Build 版本。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-15T17:38:50.427

`$host.version.tostring()`将返回版本号。

v1 的 RTM 为 1.0.0.0

不能诚实地告诉你最新版本的预览是什么，因为我还没有机会玩。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-15T21:25:02.700

最新的 CTP 是 2008 年 5 月 2 日发布的 CTP2，可以在[这里](http://www.microsoft.com/downloads/details.aspx?FamilyId=7C8051C2-9BFC-4C81-859D-0864979FA403&displaylang=en)找到。远程处理需要在调用机器和目标机器上都安装 WinRM。CTP 中包含一个用于配置 WS-Management 的脚本，称为 Configure-WSMan.ps1。

此命令应为您提供已安装的 PowerShell 版本号。获取命令“$PSHome\powershell.exe”| 格式列表 FileVersionInfo V1.0 是 6.0.5430.0 CTP2 是 6.1.6585.1

我手头没有第一个 CTP 的版本号，但如果你真的需要，我可以找到它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-17T21:37:37.230

我猜这是在配置过程 Configure-Wsman.ps1 期间对 cmdlet 所做的更改。我现在没有要测试的环境设置，但我猜配置出了点问题。我可以验证在 XP 上该参数不可用（duh）。我假设您会在没有完成配置的情况下在 Vista/08 上找到相同的内容。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-11T19:08:51.717

如果`$PSVersionTable`变量不存在，那么您正在运行 V1。

如果存在，则该版本将作为`$PSVersionTable.PSVersion`.

```
function Get-PSVersion {  
    if (test-path variable:psversiontable) 
        {$psversiontable.psversion} 
    else 
        {[version]"1.0.0.0"}  
} 
```

# xml - 为什么人们仍在创建 RSS 提要？

> ID：12509
> 
> 赞同：40
> 
> 时间：2008-08-15T17:27:52.213
> 
> 标签：xml, rss, atom-feed

...而不是使用 Atom 联合格式？

Atom 是一种[定义明确](http://www.atomenabled.org/developers/syndication/)的通用 XML 联合格式。RSS 分为四个不同的版本。从我记事起，所有主要的提要阅读器都支持 Atom，那么为什么它的使用没有更普遍呢？

最糟糕的是提供两种格式的提要的网站 - 有什么意义？！

*   更新（8 月 18 日）：有趣的是，该站点本身使用 Atom 作为其提要，而不是 RSS。

* * *

## 回答 #1

> 赞同：111
> 
> 时间：2008-08-15T18:36:55.007

Atom 的创建者不理解的基本问题（并且 Atom 支持者仍然不理解）是 Atom 与 RSS 并没有以某种方式分离。有一个想法是 RSS 分裂了，而 Atom 以某种方式解决了这个问题。但事实并非如此。Atom 只是另一个 RSS 分裂。一个新名称并不会改变这样一个事实，即它只是为了完成同样的工作而竞争的一个标准，*任何*竞争标准都足以胜任的工作。

除了一小部分人之外，没有人关心使用哪种标准。他们只是想让它工作。Atom、RSS 2.0、RSS 1.0、RSS 401(k) 等等。只要它有效，用户就会感到高兴。不过，RSS“品牌”在很大程度上定义了整个提要类别，因此在很少有人知道足以选择的*情况*下，他们会倾向于选择 RSS，因为它有“名称”。他们也会倾向于选择 RSS 2.0，因为它的数量更大。

RSS，尤其是 RSS 2.0，在提要“行业”中根深蒂固。Atom 还没有起飞，因为它除了一个新名称之外并没有带来什么。当 RSS 运行良好时，为什么要放弃它？如果 RSS 足够了，为什么还要在新项目上使用 Atom？切换到新的提要格式主要意味着要花费额外的时间来学习新格式。

如果不出意外，[Apple 将 RSS 2.0 独家用于播客](http://www.apple.com/itunes/store/podcaststechspecs.html)意味着 RSS 2.0 在可预见的未来就会出现。

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2008-08-21T18:25:22.403

如果你问为什么 Atom 联合格式没有比 RSS 格式的各种版本更广泛地采用，我认为很难得出一个客观的答案。各种因素，例如在 Atom 之前对 RSS 的投资量、实现 RSS 与 Atom 相比的相对容易程度以及“营销”都发挥了作用。

但是，我可以想到在选择用于表示资源的联合格式时应考虑的一些事项：

**原子**

*   Atom 是一个官方的 Internet 标准跟踪协议。
*   Atom 为其提要和条目表示具有已注册的内容媒体类型。
*   如果不使用联合扩展，Atom 往往是一种更健壮的格式，尤其是在链接关系领域。
*   使用 Atom 表示资源允许您利用 Atom 发布协议 (AtomPub) 来提供 RESTful API。
*   Atom 使用的 RFC-3339 DateTime 格式易于解析。
*   只有一个不推荐使用的 Atom (0.3) 版本您可能不得不支持。
*   实现 Atom 通常比 RSS 需要更多的时间来正确完成，因为有更多的限制并且技术规范可能有点密集。

**RSS**

*   RSS 是一种在短时间内实现的相对简单的格式。
*   RSS 上的约束/规则没有 Atom 上那么多。
*   RSS 不是官方的 Internet 标准跟踪协议。但是，RSS 的采用率已经足够高，您可以合理地期望它可以被各种客户使用。
*   由于有很多“不推荐”的 RSS 版本，您可能不得不支持格式细节差异很大的 RSS 提要。
*   RSS 没有注册的媒体内容类型。然而，足够多的发布者使用相同的未注册内容类型，几乎是事实上的 MIME 类型。
*   RSS 使用的 RFC-822 DateTime 格式更难解析，因为这种特殊的时间戳格式允许格式中更多可能的变化，但仍被认为是有效的。
*   当您开始尝试表示具有复杂链接关系的资源时，您将需要使用各种已发布的联合扩展来扩展 RSS 格式。

我认为重要的是要记住，对于最终用户来说，您选择使用哪种联合格式并不是很重要，因为大多数提要阅读器和浏览器都能很好地处理这两种格式。然而，联合格式的选择对开发人员来说可能非常重要，因为有些技术细节会影响软件开发方面的事情。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-13T01:14:30.390

[越差越好](http://www.codinghorror.com/blog/2008/01/is-worse-really-better.html)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-14T18:03:38.560

“为什么”得到了很好的回答，但我建议开发人员只在网站上实现 Atom。没有理由为网站提供多种格式，并且任何现代提要客户端现在都可以解析 Atom 提要。

Atom 与 RSS 相比具有相当多的技术优势，并被 Google 和 Microsoft 等大公司广泛支持和使用。

至于品牌，我真的不在乎使用什么首字母缩写词。我认为通用橙色广播图标或“饲料”一词是人们关心的。尽管 RSS 和 Atom 提要激增，但我想说普通的网络用户仍然不知道它们是什么。以这种方式来看，联合供稿的整个概念仍处于起步阶段。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-08-15T17:38:19.180

出于同样的原因，每个“更好”的解决方案都没有在大众市场上取得成功。RSS 被广泛部署，它解决了 Atom 试图解决的相同问题。

就个人而言，我有大量自己生成的 RSS 提要。他们今天正在工作并解决问题。我想知道您如何说服我将所有这些提要重写为 Atom，只是为了使用“更好”的格式。

现在，如果您考虑一下 REST 架构如何因为更好、更简单的缓存和可扩展性而获得可见性，这些都是真正的论据。我知道 Atom 与 REST 炒作密切相关，它可能是推销它的最佳方式。随着 REST 的知名度越来越高，其相关格式（如 Atom）也将获得知名度。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-15T17:33:13.217

与人们对 HTML 4 松散、严格、XHTML 过渡、XHTML 严格等的原因相同。遗留代码/使用您已经知道的内容。

此外，这两种格式都有其优点。最好支持几种不同的格式，而不是让一个完全订阅所有内容的订阅源变得臃肿。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-15T17:36:19.153

因为对于大多数目的，两者都可以工作，并且 RSS 具有作为定义类别的首字母缩写词的优势。

除此之外，您还必须向各个网站发送电子邮件并询问他们。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-15T18:13:11.777

文森特，我并不是建议任何人仅​​仅为了它而重写现有的 RSS 提要，那将是极大的浪费时间！就 RSS 是定义类别的首字母缩写词而言，我猜大多数用户现在都认同橙色提要图标，而不是它背后的特定 XML 风格。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-05-19T15:53:06.000

我认为 RSS 有一个更好的市场名称 :-) RSS 说起来容易，听起来很严肃，但实际上毫无意义。真的听起来像一个银弹技术。“原子”这个词是有道理的，但很少有人把它与一些宇宙高科技联系起来，更常见的联想是学生、高中物理、共产党人的武器——炒作“web 2.0”。那里的一小部分人真正将它与它的真正含义以及它为什么得名 - 一个原子精确的描述性结构化知识表示框架相关联。如果我在非 IT 专业人群中说“RSS”，我有一个很好的机会立即理解我今天的意思，但是如果我说“Atom”——几乎没有人会这么快和清楚地理解它。RSS 实际上是联合提要的名称。那' s 为什么认为将其标记为 RSS 是一个好主意，同时在技术上提供 100% Atom 并且仅提供 Atom - 软件不在乎按钮上绘制的燕麦，最终用户会得到他们想要得到的东西。恕我直言。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-15T17:30:37.230

有很多人们习惯使用的 RSS 提要阅读器，最重要的是，RSS 非常有名并且已经存在了很长时间。如果它有效，为什么要搞砸一些东西？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-08-15T17:32:08.023

因为 sed 景点的开发者从他们的营销经理那里得到了回报，他们通过不提供 rss 来“排除”人们。由于营销先生从未听说过 Atom，因此您只需提供两者。

如果你正在安心地实施它，那么两者都做而不被其他部门大喊大叫并不是什么大不了的事。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-09-24T18:14:00.317

RSS 更简单，这就是它的强项所在。是的，Atom 的定义更好，但这就是问题所在：当您最终想要一个简化的摘要时，它们使编写非常复杂的提要变得容易。

为什么这么多人喜欢RSS？这很容易，可以完成工作。您可以手动编辑它；使用 Atom 并不容易。你有没有试过写一个提要阅读器？

恕我直言，Atom 唯一做得好的就是多个外壳。

为什么有些网站提供 RSS 和 Atom 两种提要？因为他们可以而且因为一些古老的提要阅读器可能不支持 Atom。

# oop - 使用多态性的表达式评估和树行走？（阿拉史蒂夫耶格）

> ID：12516
> 
> 赞同：27
> 
> 时间：2008-08-15T17:31:39.427
> 
> 标签：oop, recursion, polymorphism, binary-tree

今天早上，我在阅读[Steve Yegge 的《当多态性失败](http://steve.yegge.googlepages.com/when-polymorphism-fails)时》时，遇到了一个问题，他的一位同事曾经在潜在员工来亚马逊面试时问他们这个问题。

> 作为多态性的一个例子，让我们看一下经典的“eval”面试问题，（据我所知）是由 Ron Braunstein 带到亚马逊的。这个问题非常丰富，因为它设法探讨了各种各样的重要技能：OOP 设计、递归、二叉树、多态性和运行时类型、一般编码技能，以及（如果你想让它更难的话）解析理论.
> 
> 在某些时候，候选人希望意识到您可以将算术表达式表示为二叉树，假设您只使用诸如“+”、“-”、“*”、“/”之类的二元运算符。叶节点都是数字，内部节点都是算子。评估表达式意味着遍历树。如果应聘者没有意识到这一点，你可以温和地引导他们，或者如果有必要，直接告诉他们。
> 
> 即使你告诉他们，这仍然是一个有趣的问题。
> 
> 问题的前半部分，有些人（我将保护他们的名字直到我垂死的呼吸，但他们的名字首字母是威利刘易斯）觉得如果你想称自己为开发人员并在亚马逊工作，这是一个工作要求，实际上有点难. 问题是：如何从诸如“2 + (2)”之类的算术表达式（例如在字符串中）到表达式树。在某个时候，我们可能会在这个问题上遇到 ADJ 挑战。
> 
> 后半部分是：假设这是一个 2 人项目，你的搭档，我们称之为“Willie”，负责将字符串表达式转换为树。你得到了简单的部分：你需要决定 Willie 用什么类来构造树。你可以用任何一种语言来做，但一定要选择一种，否则威利会把汇编语言交给你。如果他感到不耐烦，那将是针对不再生产的处理器。
> 
> 你会惊讶于有多少候选人喜欢这个。
> 
> 我不会给出答案，但标准错误解决方案涉及使用 switch 或 case 语句（或只是好的老式级联 ifs）。稍微好一点的解决方案涉及使用函数指针表，而可能最好的解决方案涉及使用多态性。我鼓励你在某个时候完成它。好玩的东西！

所以，让我们尝试通过三种方式来解决这个问题。如何使用级联-if、函数指针表和/或多态性从算术表达式（例如在字符串中）如“2 + (2)”到表达式树？

随意解决一个，两个或所有三个。

[更新：修改标题以更好地匹配大多数答案。]

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-08-15T22:56:41.813

**多态树行走**，Python版

```
#!/usr/bin/python

class Node:
    """base class, you should not process one of these"""
    def process(self):
        raise('you should not be processing a node')

class BinaryNode(Node):
    """base class for binary nodes"""
    def __init__(self, _left, _right):
        self.left = _left
        self.right = _right
    def process(self):
        raise('you should not be processing a binarynode')

class Plus(BinaryNode):
    def process(self):
        return self.left.process() + self.right.process()

class Minus(BinaryNode):
    def process(self):
        return self.left.process() - self.right.process()

class Mul(BinaryNode):
    def process(self):
        return self.left.process() * self.right.process()

class Div(BinaryNode):
    def process(self):
        return self.left.process() / self.right.process()

class Num(Node):
    def __init__(self, _value):
        self.value = _value
    def process(self):
        return self.value

def demo(n):
    print n.process()

demo(Num(2))                                       # 2
demo(Plus(Num(2),Num(5)))                          # 2 + 3
demo(Plus(Mul(Num(2),Num(3)),Div(Num(10),Num(5)))) # (2 * 3) + (10 / 2) 
```

测试只是通过使用构造函数来构建二叉树。

程序结构：

抽象基类：节点

*   所有节点都继承自这个类

抽象基类：BinaryNode

*   所有二元运算符都继承自此类
*   process 方法执行评估表达式并返回结果的工作

二元运算符类：Plus、Minus、Mul、Div

*   两个子节点，一个用于左侧子表达式和右侧子表达式

号码等级：Num

*   保存叶节点数值，例如 17 或 42

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-08-15T20:04:21.723

> 我认为问题在于我们需要解析括号，但它们不是二元运算符？我们是否应该将 (2) 作为单个标记，计算结果为 2？

括号不需要出现在表达式树中，但它们确实会影响其形状。例如，(1+2)+3 的树不同于 1+(2+3)：

```
 +
   / \
  +   3
 / \
1   2 
```

相对

```
 +
   / \
  1   +
     / \
    2   3 
```

括号是对解析器的“提示”（例如，根据 superjoe30，“递归下降”）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-08-15T21:58:53.053

这涉及到解析/编译器理论，这有点像兔子洞…… [Dragon Book](http://en.wikipedia.org/wiki/Compilers:_Principles,_Techniques,_and_Tools)是编译器构造的标准文本，并将其发挥到了极致。在这种特殊情况下，您想为基本算术构造一个[上下文无关文法](http://en.wikipedia.org/wiki/Context-free_grammar#Example_3)，然后使用该文法解析出[抽象语法树](http://en.wikipedia.org/wiki/Abstract_syntax_tree)。然后，您可以遍历树，从下往上减少它（此时您将应用多态性/函数指针/switch 语句来减少树）。

我发现[这些注释](http://cg.scs.carleton.ca/~morin/teaching/3002/#notes)对编译器和解析理论非常有帮助。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-08-15T23:38:03.290

表示节点

如果我们想包含括号，我们需要 5 种节点：

*   二元节点： Add Minus Mul Div
    这些有两个孩子，一个左侧和右侧

    ```
     +
        / \
    node   node 
    ```

*   保存值的节点： Val
    没有子节点，只是一个数值

*   跟踪括号的节点：
    为子表达式Paren单个子节点

    ```
     ( )
         |
        node 
    ```

对于多态解决方案，我们需要有这种类关系：

*   节点
*   BinaryNode : 从 Node 继承
*   加：从二进制节点继承
*   减号：从二进制节点继承
*   Mul : 从二进制节点继承
*   div : 从二进制节点继承
*   值：从节点继承
*   Paren : 从节点继承

所有节点都有一个名为 eval() 的虚函数。如果您调用该函数，它将返回该子表达式的值。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-08-15T17:50:11.853

String Tokenizer + LL(1) Parser 会给你一个表达式树......多态方式可能涉及一个带有“evaluate(a,b)”函数的抽象算术类，该函数被涉及的每个运算符覆盖（另外，减法等）以返回适当的值，并且树包含整数和算术运算符，它们可以通过树的后（？）顺序遍历来评估。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-08-17T13:59:12.630

> 我不会给出答案，但标准错误解决方案涉及使用 switch 或 case 语句（或只是好的老式级联 ifs）。稍微好一点的解决方案涉及使用函数指针表，而可能最好的解决方案涉及使用多态性。

解释器过去 20 年的演变可以看作是另一种方式——多态性（例如朴素的 Smalltalk 元循环解释器）到函数指针（朴素的 lisp 实现、线程代码、C++）到切换（朴素的字节码解释器），然后再往前走到 JIT 等等——它们要么需要非常大的类，要么（在单一多态语言中）双重调度，这将多态性减少到类型案例，你又回到了第一阶段。这里使用的“最佳”定义是什么？

对于简单的东西，多态解决方案是可以的——[这是我之前做的一个](http://www.tincancamera.com/examples/java/expressions/ExpressionParser.java.txt)，但是如果你要绘制一个包含几千个数据点的函数，那么堆栈和字节码/切换或利用运行时的编译器通常会更好。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-10T12:49:51.820

嗯...我认为您不能为此编写自上而下的解析器而无需回溯，因此它必须是某种移位减少解析器。LR(1) 甚至 LALR 当然可以很好地使用以下（临时）语言定义：

开始 -> E1
E1 -> E1+E1 | E1-E1
E1 -> E2*E2 | E2/E2 | E2
E2 ->*数字*| (E1)

将它分成 E1 和 E2 是必要的，以保持 * 和 / 高于 + 和 - 的优先级。

但是，如果我必须手动编写解析器，我会这样做：

*   两个栈，一个存储树的节点作为操作数，一个存储操作符
*   从左到右读取输入，制作数字的叶节点并将它们推入操作数堆栈。
*   如果堆栈上有 >= 2 个操作数，则弹出 2，将它们与操作符堆栈中最顶部的操作符组合并将此结构推回操作数树，*除非*
*   下一个运算符的优先级高于当前位于堆栈顶部的运算符。

这给我们留下了处理括号的问题。一种优雅的（我认为）解决方案是将每个运算符的优先级存储为变量中的数字。所以一开始，

*   整数加，减 = 1；
*   int mul, div = 2;

现在，每次看到左括号时，所有这些变量都增加 2，每次看到右括号时，所有变量都减少 2。

这将确保 3*(4+5) 中的 + 比 * 具有更高的优先级，并且 3*4 不会被压入堆栈。相反，它将等待 5，按 4+5，然后按 3*(4+5)。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-15T20:14:33.030

回复：贾斯汀

我认为这棵树看起来像这样：

```
 +
 / \
2  ( )
    |
    2 
```

基本上，你会有一个“eval”节点，它只是评估它下面的树。然后将其优化为：

```
 +
 / \
2   2 
```

在这种情况下，不需要括号，也不添加任何内容。他们没有在逻辑上添加任何东西，所以他们就会离开。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-08-21T16:52:15.093

我认为问题在于如何编写解析器，而不是评估器。或者更确切地说，如何从字符串创建表达式树。

返回基类的 case 语句不完全计数。

“多态”解决方案的基本结构（这是另一种说法，我不在乎你用什么构建它，我只想通过重写尽可能少的代码来扩展它）是从一个反序列化对象层次结构具有一组（动态）已知类型的流。

实现多态解决方案的关键是有一种方法可以从模式匹配器创建表达式对象，可能是递归的。即，将 BNF 或类似语法映射到对象工厂。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-15T19:28:32.513

应该使用功能语言imo。树在面向对象语言中更难表示和操作。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-08-15T19:50:45.323

> 或者这可能是真正的问题：你如何将 (2) 表示为 BST？那是让我绊倒的部分。

递归。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-08-15T23:12:36.167

@贾斯汀：

查看我关于表示节点的注释。如果您使用该方案，那么

```
2 + (2) 
```

可以表示为

```
 .
          / \
         2  ( )
             |
             2 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-08-25T15:21:17.853

正如人们之前提到的，当您使用表达式树时，不需要括号。当您查看表达式树时，操作顺序变得微不足道且显而易见。括号是对解析器的提示。

虽然公认的答案是解决问题的一半，但另一半——实际上是解析表达式——仍未解决。通常，这些问题可以使用[递归下降解析器](http://en.wikipedia.org/wiki/Recursive_descent_parser)来解决。编写这样的解析器通常是一个有趣的练习，但是大多数[现代的语言解析工具](http://www.antlr.org/)都会为您抽象出它。

如果您在字符串中允许浮点数，解析器也会**变得更加困难。**我必须创建一个 DFA 来接受 C 中的浮点数——这是一项非常艰苦和详细的任务。请记住，有效的浮点数包括：10, 10., 10.123, 9.876e-5, 1.0f, .025 等。我假设在采访中对此有所豁免（有利于简单和简洁）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-21T01:29:37.410

我用一些基本技术编写了这样的解析器，例如 [Infix -> RPN](http://en.wikipedia.org/wiki/Reverse_Polish_notation)和 [Shutting Yard](http://en.wikipedia.org/wiki/Shunting_yard_algorithm) and [Tree Traversals](http://en.wikipedia.org/wiki/Tree_traversal)。 [这是我想出的实现](http://perlhobby.googlecode.com/svn/trunk/parser_v0.1/)。
它是用 C++ 编写的，可以在 Linux 和 Windows 上编译。
欢迎任何建议/问题。

> 所以，让我们尝试通过三种方式来解决这个问题。如何使用级联-if、函数指针表和/或多态性从算术表达式（例如在字符串中）如“2 + (2)”到表达式树？

这很有趣，但我认为这不属于面向对象编程的领域......我认为它更多地与[解析技术](ftp://ftp.cs.vu.nl/pub/dick/PTAPG_1st_Edition/BookBody.pdf)有关。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-23T22:00:02.120

我有点把这个 c# 控制台应用程序放在一起作为概念证明。感觉它可能会好很多（GetNode 中的 switch 语句有点笨拙（因为我在尝试将类名映射到运算符时遇到了空白））。任何关于如何改进的建议都非常受欢迎。

```
using System;

class Program
{
    static void Main(string[] args)
    {
        string expression = "(((3.5 * 4.5) / (1 + 2)) + 5)";
        Console.WriteLine(string.Format("{0} = {1}", expression, new Expression.ExpressionTree(expression).Value));
        Console.WriteLine("\nShow's over folks, press a key to exit");
        Console.ReadKey(false);
    }
}

namespace Expression
{
    // -------------------------------------------------------

    abstract class NodeBase
    {
        public abstract double Value { get; }
    }

    // -------------------------------------------------------

    class ValueNode : NodeBase
    {
        public ValueNode(double value)
        {
            _double = value;
        }

        private double _double;
        public override double Value
        {
            get
            {
                return _double;
            }
        }
    }

    // -------------------------------------------------------

    abstract class ExpressionNodeBase : NodeBase
    {
        protected NodeBase GetNode(string expression)
        {
            // Remove parenthesis
            expression = RemoveParenthesis(expression);

            // Is expression just a number?
            double value = 0;
            if (double.TryParse(expression, out value))
            {
                return new ValueNode(value);
            }
            else
            {
                int pos = ParseExpression(expression);
                if (pos > 0)
                {
                    string leftExpression = expression.Substring(0, pos - 1).Trim();
                    string rightExpression = expression.Substring(pos).Trim();

                    switch (expression.Substring(pos - 1, 1))
                    {
                        case "+":
                            return new Add(leftExpression, rightExpression);
                        case "-":
                            return new Subtract(leftExpression, rightExpression);
                        case "*":
                            return new Multiply(leftExpression, rightExpression);
                        case "/":
                            return new Divide(leftExpression, rightExpression);
                        default:
                            throw new Exception("Unknown operator");
                    }
                }
                else
                {
                    throw new Exception("Unable to parse expression");
                }
            }
        }

        private string RemoveParenthesis(string expression)
        {
            if (expression.Contains("("))
            {
                expression = expression.Trim();

                int level = 0;
                int pos = 0;

                foreach (char token in expression.ToCharArray())
                {
                    pos++;
                    switch (token)
                    {
                        case '(':
                            level++;
                            break;
                        case ')':
                            level--;
                            break;
                    }

                    if (level == 0)
                    {
                        break;
                    }
                }

                if (level == 0 && pos == expression.Length)
                {
                    expression = expression.Substring(1, expression.Length - 2);
                    expression = RemoveParenthesis(expression);
                }
            }
            return expression;
        }

        private int ParseExpression(string expression)
        {
            int winningLevel = 0;
            byte winningTokenWeight = 0;
            int winningPos = 0;

            int level = 0;
            int pos = 0;

            foreach (char token in expression.ToCharArray())
            {
                pos++;

                switch (token)
                {
                    case '(':
                        level++;
                        break;
                    case ')':
                        level--;
                        break;
                }

                if (level <= winningLevel)
                {
                    if (OperatorWeight(token) > winningTokenWeight)
                    {
                        winningLevel = level;
                        winningTokenWeight = OperatorWeight(token);
                        winningPos = pos;
                    }
                }
            }
            return winningPos;
        }

        private byte OperatorWeight(char value)
        {
            switch (value)
            {
                case '+':
                case '-':
                    return 3;
                case '*':
                    return 2;
                case '/':
                    return 1;
                default:
                    return 0;
            }
        }
    }

    // -------------------------------------------------------

    class ExpressionTree : ExpressionNodeBase
    {
        protected NodeBase _rootNode;

        public ExpressionTree(string expression)
        {
            _rootNode = GetNode(expression);
        }

        public override double Value
        {
            get
            {
                return _rootNode.Value;
            }
        }
    }

    // -------------------------------------------------------

    abstract class OperatorNodeBase : ExpressionNodeBase
    {
        protected NodeBase _leftNode;
        protected NodeBase _rightNode;

        public OperatorNodeBase(string leftExpression, string rightExpression)
        {
            _leftNode = GetNode(leftExpression);
            _rightNode = GetNode(rightExpression);

        }
    }

    // -------------------------------------------------------

    class Add : OperatorNodeBase
    {
        public Add(string leftExpression, string rightExpression)
            : base(leftExpression, rightExpression)
        {
        }

        public override double Value
        {
            get
            {
                return _leftNode.Value + _rightNode.Value;
            }
        }
    }

    // -------------------------------------------------------

    class Subtract : OperatorNodeBase
    {
        public Subtract(string leftExpression, string rightExpression)
            : base(leftExpression, rightExpression)
        {
        }

        public override double Value
        {
            get
            {
                return _leftNode.Value - _rightNode.Value;
            }
        }
    }

    // -------------------------------------------------------

    class Divide : OperatorNodeBase
    {
        public Divide(string leftExpression, string rightExpression)
            : base(leftExpression, rightExpression)
        {
        }

        public override double Value
        {
            get
            {
                return _leftNode.Value / _rightNode.Value;
            }
        }
    }

    // -------------------------------------------------------

    class Multiply : OperatorNodeBase
    {
        public Multiply(string leftExpression, string rightExpression)
            : base(leftExpression, rightExpression)
        {
        }

        public override double Value
        {
            get
            {
                return _leftNode.Value * _rightNode.Value;
            }
        }
    }
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-10-25T20:39:14.880

好的，这是我的幼稚实现。抱歉，我不觉得为那个使用对象，但它很容易转换。我觉得有点像邪恶的威利（来自史蒂夫的故事）。

```
#!/usr/bin/env python

#tree structure [left argument, operator, right argument, priority level]
tree_root = [None, None, None, None]
#count of parethesis nesting
parenthesis_level = 0
#current node with empty right argument
current_node = tree_root

#indices in tree_root nodes Left, Operator, Right, PRiority
L, O, R, PR = 0, 1, 2, 3

#functions that realise operators
def sum(a, b):
    return a + b

def diff(a, b):
    return a - b

def mul(a, b):
    return a * b

def div(a, b):
    return a / b

#tree evaluator
def process_node(n):
    try:
        len(n)
    except TypeError:
        return n
    left = process_node(n[L])
    right = process_node(n[R])
    return n[O](left, right)

#mapping operators to relevant functions
o2f = {'+': sum, '-': diff, '*': mul, '/': div, '(': None, ')': None}

#converts token to a node in tree
def convert_token(t):
    global current_node, tree_root, parenthesis_level
    if t == '(':
        parenthesis_level += 2
        return
    if t == ')':
        parenthesis_level -= 2
        return
    try: #assumption that we have just an integer
        l = int(t)
    except (ValueError, TypeError):
        pass #if not, no problem
    else:
        if tree_root[L] is None: #if it is first number, put it on the left of root node
            tree_root[L] = l
        else: #put on the right of current_node
            current_node[R] = l
        return

    priority = (1 if t in '+-' else 2) + parenthesis_level

    #if tree_root does not have operator put it there
    if tree_root[O] is None and t in o2f:
            tree_root[O] = o2f[t]
            tree_root[PR] = priority
            return

    #if new node has less or equals priority, put it on the top of tree
    if tree_root[PR] >= priority:
        temp = [tree_root, o2f[t], None, priority]
        tree_root = current_node = temp
        return

    #starting from root search for a place with higher priority in hierarchy
    current_node = tree_root
    while type(current_node[R]) != type(1) and priority > current_node[R][PR]:
        current_node = current_node[R]
    #insert new node
    temp = [current_node[R], o2f[t], None, priority]
    current_node[R] = temp
    current_node = temp

def parse(e):
    token = ''
    for c in e:
        if c <= '9' and c >='0':
            token += c
            continue
        if c == ' ':
            if token != '':
                convert_token(token)
                token = ''
            continue
        if c in o2f:
            if token != '':
                convert_token(token)
            convert_token(c)
            token = ''
            continue
        print "Unrecognized character:", c
    if token != '':
        convert_token(token)

def main():
    parse('(((3 * 4) / (1 + 2)) + 5)')
    print tree_root
    print process_node(tree_root)

if __name__ == '__main__':
    main() 
```

# testing - 用于自动发送到 Windows 应用程序的鼠标和键盘事件的工具

> ID：12523
> 
> 赞同：10
> 
> 时间：2008-08-15T17:37:06.280
> 
> 标签：testing, automation

哪些工具可用于自动单击 Windows 窗体应用程序？这甚至有用吗？我看到我公司的测试人员做了很多工作，这似乎是在浪费时间。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-08-15T17:50:31.730

查看[https://github.com/TestStack/White](https://github.com/TestStack/White)和[http://nunitforms.sourceforge.net/](http://nunitforms.sourceforge.net/)。我们成功地使用了 White 项目。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-08-15T18:05:07.987

尽管它们主要针对自动化管理任务或用户的快捷方式，但[Autohotkey](http://www.autohotkey.com/)和[AutoIT 可](http://www.autoitscript.com/autoit3/)让您自动化几乎任何您想要的鼠标/键盘交互。

当真正告诉它你想要点击什么的唯一方法是 X，Y 坐标时，一些鼠标的东西可能会变得棘手，但对于在 Windows 机器上自动执行完全任意的任务，它就可以了。

就像我说的那样，它们不一定是为了测试目的，所以它们没有被用于单元测试约定。但是，我一直使用它们来自动化与测试无关的东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-15T18:07:28.043

您可以通过[Microsoft UI 自动化 API 以编程方式执行此操作。](http://msdn.microsoft.com/en-us/ms750446.aspx)有一篇关于它的[MSDN 杂志文章](http://msdn.microsoft.com/en-us/magazine/cc163465.aspx)。

与单元测试框架很好地集成。比基于坐标的脚本运行器更好的选择，因为您不必在布局更改时重写脚本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-15T17:47:02.110

外面有一对。它们都连接到 Windows API 以记录项目点击，然后重现它们以进行测试。

我们现在主要是基于网络的（使用 WatiN），但我们曾经使用 Mercury Quicktest。

不要使用 Quicktest，因为一长串原因，这很糟糕。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-15T19:58:51.503

这就是我一直在寻找的。

查看[http://www.codeplex.com/white](http://www.codeplex.com/white)和[http://nunitforms.sourceforge.net/](http://nunitforms.sourceforge.net/)。我们成功地使用了 White 项目。

# sql-server - 您如何将从 datepart 获得的数字转换为当天的名称？

> ID：12533
> 
> 赞同：7
> 
> 时间：2008-08-15T17:47:28.677
> 
> 标签：sql-server, datepart

是否有一种快速的单线器可以在 Sql Server 中调用 datepart 并取回当天的名称而不仅仅是数字？

```
select datepart(dw, getdate()); 
```

这将返回 1-7，周日为 1。我想要“周日”而不是 1。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-08-15T17:54:22.143

```
select datename(weekday, getdate()); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-15T17:54:26.667

实际上，我花了比我想象的更多的时间来寻找这个答案。有趣的是，您可以使用多年的技术却永远不知道像这样的简单功能。

```
select datename(dw,  getdate()) 
```

我不确定本地化如何使用此功能。获得名称客户端可能是答案，但最好在数据库上这样做。Sql Server 会使用排序规则设置来确定输出吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-15T17:50:32.883

如果不使用结果自己选择日期，这是不可能的。一方面，当天的文本表示取决于区域设置。另一方面，返回值取决于 'datefirst' 设置。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-15T17:52:04.627

如果您想要一个可本地化的解决方案，只需将结果与包含名称和数字的表连接起来。

# cross-browser - 您使用 TIBCO 通用界面的体验如何？

> ID：12556
> 
> 赞同：8
> 
> 时间：2008-08-15T18:00:04.020
> 
> 标签：cross-browser, tibco

它看起来很有趣，我已经玩过一些 --- 但 Web 浏览器中的开发 IDE 最终似乎是一场噩梦。

有没有人有使用它的经验，你的想法是什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-08-19T14:06:46.810

几个月前，我们为一个项目评估了 GI，但最终没有选择它。

IDE-in-a-browser（它本身是用 GI 构建的）实际上工作得非常好，尽管您通常期望编辑器缺少一些功能，最值得注意的是（而且令人恼火）撤消命令。从 IDE 中执行子文档包含（实际上是团队开发的必需品）之类的事情也是不可能的，尽管您可以在底层 XML 中手动执行它们并且 IDE 会尊重它们。

最后，我们没有采用它的主要原因是很难使最终的 Web 应用程序看起来像设计师真正想要的那样好。构建功能相对容易，但组件的外观和感觉非常受限。GI 将其自己的文档模型呈现为 HTML 的方式涉及许多`style`属性，这使得在 CSS 中进行蒙皮几乎是不可能的。它似乎更喜欢制作看起来像应用程序的 Web 应用程序，而不是看起来像网站的 Web 应用程序。

因此，它可能非常适合构建外观和感觉不是大问题的 Intranet 类型的应用程序，但我可能不会使用它来制作面向公众的网站。

顺便说一下，对于那些不知道的人，TIBCO GI 是与 TIBCO 的其他 SOA 业务集成产品完全独立的产品 - General Interface 是一家独立的公司，几年前被 TIBCO 收购。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-15T20:09:25.677

来自一位曾在 TIBCO 工作的同事：

> TIBCO 是一个复杂、难以使用的系统，因为它用于解决复杂、难以解决的问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-17T16:49:27.573

Kieron 在总结 GI 方面做得很好。它确实适用于企业 Web 应用程序，而不是面向消费者的小部件。加载整个 GI 框架并等待一两秒钟以加载它的开销似乎并不多，如果您正在启动一个呼叫中心或您将在接下来的几个小时内使用的员工配置应用程序。但是，如果您正在等待小部件加载到现有网页中，这似乎是永远的。而且，尽管 GI 支持一些不错的功能和性能 QA 工具，但它们确实是矫枉过正，除非你正在处理一些重要而复杂的事情。所以，如果你只想在屏幕上扔一个看起来很性感的日期选择器，那么肯定会使用其他东西。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-02-09T16:57:13.053

是的，不能再同意了。我使用 TIBCO GI 开发了一些应用程序，并将其与 TIBCO CIM 集成。我在 TIBCO 工作，而 GI 是我一直在做一些复杂的事情。在这样做的同时，我遇到了 GI 的奇怪方面，有时你无法解释但它们就是这样的事情，使用 JavaScript 和处理多线程问题可能是一场噩梦等。快速创建一些东西而不是很好对应用程序的性感过于挑剔，因此对内部应用程序有利，但对消费者不利，除非您想迷失在疯狂的 CSS 样式丛林中。XML Mapping 实用程序是一个很棒的功能，可以为您节省大量时间来实现 SOA 应用程序。另一个好处是部署非常简单——GI 应用程序使用 XML、XSLT、X-Path 和 JavaScript 的组合。在 GI 3.8 中还有一些测试工具。不幸的是，在 GI 的编辑器中开发既缓慢又痛苦，所以我建议使用像 Notepad++ 这样的外部编辑器。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-09-07T17:26:45.273

您不需要从网络浏览器运行 tibco-GI，但您需要运行作为 ActiveX 应用程序的 Programfile GI_Builder.exe。只需双击它并运行它。

# ruby - Ruby 中不同的括号是什么意思？

> ID：12565
> 
> 赞同：86
> 
> 时间：2008-08-15T18:09:52.267
> 
> 标签：ruby, syntax

`{}`在 Ruby 中，和 和有什么区别`[]`？

`{}`似乎用于代码块和哈希。

`[]`仅适用于数组？

文档不是很清楚。

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2008-08-17T21:17:44.680

这取决于上下文：

1.  单独使用或分配给变量时，`[]`会创建数组并`{}`创建散列。例如

    ```
    a = [1,2,3] # an array
    b = {1 => 2} # a hash 
    ```

2.  `[]`可以作为自定义方法重写，通常用于从哈希中获取内容（标准库设置`[]`为哈希上的`fetch`方法
    ，与您可能会使用`static Create`C# 或 Java 中的方法。例如

    ```
    a = {1 => 2} # create a hash for example
    puts a[1] # same as a.fetch(1), will print 2

    Hash[1,2,3,4] # this is a custom class method which creates a new hash 
    ```

    最后一个示例请参见 Ruby [Hash 文档](http://www.ruby-doc.org/core-2.0/Hash.html#method-c-5B-5D)。

3.  这可能是最棘手的一个 - `{}`也是块的语法，但仅在传递给参数括号之外的方法时。

    当你调用不带括号的方法时，Ruby 会查看你放置逗号的位置以找出参数的结束位置（如果你输入了括号，它们会在哪里）

    ```
    1.upto(2) { puts 'hello' } # it's a block
    1.upto 2 { puts 'hello' } # syntax error, ruby can't figure out where the function args end
    1.upto 2, { puts 'hello' } # the comma means "argument", so ruby sees it as a hash - this won't work because puts 'hello' isn't a valid hash 
    ```

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-04-02T15:47:21.460

另一个不太明显的用法`[]`是作为 Proc#call 和 Method#call 的同义词。当您第一次遇到它时，这可能会有点令人困惑。我想它背后的原因是它使它看起来更像一个普通的函数调用。

例如

```
proc = Proc.new { |what| puts "Hello, #{what}!" }
meth = method(:print)

proc["World"]
meth["Hello",","," ", "World!", "\n"] 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-08-15T18:24:06.933

从广义上讲，你是对的。与散列一样，一般风格是花括号`{}`通常用于可以全部放在一行中的块，而不是在多行中使用`do`/ `end`。

方括号`[]`在许多 Ruby 类中用作类方法，包括 String、BigNum、Dir 和令人困惑的 Hash。所以：

```
Hash["key" => "value"] 
```

和以下一样有效：

```
{ "key" => "value" } 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-17T07:52:50.970

方括号 [ ] 用于初始化数组。[ ] 的初始化案例的文档在

```
ri Array::[] 
```

花括号 { } 用于初始化哈希。{ } 的初始化案例的文档在

```
ri Hash::[] 
```

方括号也常用作许多核心 ruby​​ 类中的方法，如 Array、Hash、String 等。

您可以访问定义了方法“[]”的所有类的列表

```
ri [] 
```

大多数方法还有一个 "[ ]=" 方法，允许分配东西，例如：

```
s = "hello world"
s[2]     # => 108 is ascii for e
s[2]=109 # 109 is ascii for m
s        # => "hemlo world" 
```

花括号也可以用来代替块上的“do ... end”，如“{ ... }”。

您可以看到使用方括号或大括号的另一种情况 - 是在可以使用任何符号的特殊初始化程序中，例如：

```
%w{ hello world } # => ["hello","world"]
%w[ hello world ] # => ["hello","world"]
%r{ hello world } # => / hello world /
%r[ hello world ] # => / hello world /
%q{ hello world } # => "hello world"
%q[ hello world ] # => "hello world"
%q| hello world | # => "hello world" 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-08-15T19:03:12.893

几个例子：

```
[1, 2, 3].class
# => Array

[1, 2, 3][1]
# => 2

{ 1 => 2, 3 => 4 }.class
# => Hash

{ 1 => 2, 3 => 4 }[3]
# => 4

{ 1 + 2 }.class
# SyntaxError: compile error, odd number list for Hash

lambda { 1 + 2 }.class
# => Proc

lambda { 1 + 2 }.call
# => 3 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-10-13T21:47:50.233

请注意，您可以`[]`为自己的类定义方法：

```
class A
 def [](position)
   # do something
 end

 def @rank.[]= key, val
    # define the instance[a] = b method
 end

end 
```

# unit-testing - 严格捕获测试用例以进行单元测试

> ID：12569
> 
> 赞同：6
> 
> 时间：2008-08-15T18:14:28.327
> 
> 标签：unit-testing, testing, sorting

假设我们有一个用伪语言定义的简单函数。

```
List<Numbers> SortNumbers(List<Numbers> unsorted, bool ascending); 
```

我们传入一个未排序的数字列表和一个指定升序或降序排序的布尔值。作为回报，我们得到一个排序的数字列表。

根据我的经验，有些人比其他人更擅长捕捉边界条件。问题是，“你怎么知道你什么时候'完成'捕获测试用例”？

我们现在可以开始列出案例，一些聪明的人无疑会想到以前没有涵盖的“再一个”案例。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-08-15T18:17:17.387

不要浪费太多时间去考虑*每一个*边界条件。您的测试将无法在第一时间捕获*每个错误。*这个想法是进行*非常好的*测试，然后每次出现错误时*，*专门针对该错误编写一个新测试，这样您就再也不会收到它的消息了。

我想对代码覆盖工具做另一个说明。在像 C# 或 Java 这样有很多 get/set 和类似方法的语言中，你**不**应该追求 100% 的覆盖率。这意味着您浪费了太多时间为琐碎的代码编写测试。您*只*希望 100% 覆盖您的复杂业务逻辑。如果您的完整代码库覆盖率接近 70-80%，那么您做得很好。如果您的代码覆盖率工具允许多个覆盖率指标，那么最好的一个是“块覆盖率”，它测量“基本块”的覆盖率。其他类型是类和方法覆盖（不会给你太多信息）和行覆盖（太细了）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-08-16T09:08:23.623

> 你怎么知道你什么时候“完成”了捕获测试用例？

你没有。除了最微不足道的情况外，你无法达到 100%。此外，100% 的覆盖率（线、路径、条件......）并不能告诉你你已经达到了所有的边界条件。

最重要的是，测试用例不是“一写即忘”。**每次发现错误时，都要编写一个额外的测试。**使用原始程序检查它是否失败，使用更正的程序检查它是否通过并将其添加到您的测试集中。

Glenford J. Myers[*的软件测试艺术*](https://rads.stackoverflow.com/amzn/click/com/0471469122)节选：

1.  如果输入条件指定了一个值范围，则为范围的末端编写测试用例，并为超出末端的情况编写无效输入测试用例。
2.  如果输入条件指定了多个值，请为最小和最大数量的值以及低于和超出这些值的一个值编写测试用例。
3.  对每个输出条件使用准则 1。
4.  对每个输出条件使用准则 2。
5.  如果程序的输入或输出是有序集合，则将注意力集中在集合的第一个和最后一个元素上。
6.  另外，用你的聪明才智去寻找其他的边界条件

（*出于版权原因，我只粘贴了最低限度的内容。*）

以上第 3 点和第 4 点非常重要。人们倾向于忘记输出的边界条件。5.没问题。6.真的没有帮助:-)

## 短期考试

这比看起来更困难。迈尔斯提供了这个测试：

> 该程序从输入对话框中读取三个整数值。这三个值表示三角形边的长度。程序会显示一条消息，说明三角形是不等边三角形、等腰三角形还是等边三角形。
> 
> 请记住，不等边三角形是没有两条边相等的三角形，而等腰三角形有两条相等的边，等边三角形有三条等长的边。此外，等腰三角形中等边对边的对角也相等（由此可知三角形中等角对边相等），等边三角形中所有内角都相等。

编写你的测试用例。你有多少？Myers 询问了 14 个关于您的测试集的问题，并报告说，高素质的专业课程平均 7.8 分（满分 14 分）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-26T01:42:25.813

从实际的角度来看，我创建了一个我认为在接受之前必须通过的测试列表。我测试这些并尽可能自动化。根据我为任务估计的时间或给了我多少时间，我将测试范围扩大到包括在接受之前应该通过的项目。当然，必须和应该之间的界限是主观的。之后，我会在发现错误时更新自动化测试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-15T18:18:57.430

一个好的代码覆盖率工具真的很有帮助。

100% 的覆盖率并不意味着它肯定是经过充分测试的，但它是一个很好的指标。

对于.Net NCover 来说相当不错，但不再是开源的。

* * *

@Mike Stone - 是的，也许那应该是“高覆盖率” - 我们的目标是最低 80%，超过 95% 通常是收益递减，特别是如果你有带“n”大括号的代码。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-15T18:33:05.527

@基思

我认为你做到了，如果你想看看你有多“完成”，代码覆盖率很重要，但我认为 100% 的目标有点不切实际。争取 75-90% 将为您提供相当不错的覆盖率而不会过火……不要纯粹为了达到 100% 而进行测试，因为那时您只是在浪费时间。

# php - PHP 性能

> ID：12576
> 
> 赞同：15
> 
> 时间：2008-08-15T18:25:25.763
> 
> 标签：php, performance

我可以做些什么来提高我的 PHP 脚本的性能/速度而不在我的服务器上安装软件？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-08-15T18:34:49.957

轮廓。轮廓。轮廓。我不确定 PHP 是否有任何东西，但编写一个小工具在代码中插入分析信息应该很简单。您将需要分析函数时间和 SQL 查询时间。

所以你有一个功能：

```
function foo($stuff) {
    ...
    return ...;
} 
```

我会将其更改为：

```
function foo($stuff) {
    trace_push_fn('foo');
    ...
    trace_pop_fn('foo');
    return ...;
} 
```

（这是函数中的多个返回成为障碍的情况之一。）

和 SQL：

```
function bar($stuff) {
    trace_push_fn('bar');

    $query = ...;
    trace_push_sql($query);
    mysql_query($query);
    trace_pop_sql($query);

    trace_pop_fn('bar');
    return ...;
} 
```

最后，您可以生成程序执行的完整跟踪，并使用各种技术来识别您的瓶颈。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-08-15T22:50:50.767

一种可以轻松下架的合理技术是缓存。大量时间倾向于为请求之间（甚至跨客户端）共同的客户端生成资源；消除这种运行时工作可以导致速度显着提高。您可以将生成的资源（或资源片段）转储到 Web 树之外的文件中，然后在需要时将其读回。显然，需要进行一些分析以确保这实际上比重新生成更快 - 强制 Web 服务器定期返回磁盘可能是有害的，因此资源确实需要大量重用。

您可能还会惊讶于编写糟糕的数据库查询花费了多少时间。时间常见的生成查询，看看它们是否可以重写。执行实际 PHP 代码所花费的时间通常非常有限，除非您使用一些次优算法。

这些都不限于 PHP，尽管一些 PHP“神奇”的方法/功能可以过度保护人们不去考虑这些问题。例如，我最近更新了一个脚本，该脚本使用 array_search 对排序数组使用二进制搜索，并获得了预期的指数加速。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-17T21:39:20.310

真正考虑使用 XDebug 探查器：它有助于检查某个函数的执行量与您的预期相反。

我尝试通过在适当的时候用数组查找替换逻辑来减少指令，同时提高代码的可读性。这就是 Jeff Atwood 在 [The Best Code is No Code][1] 中所写的。

*   此外，避免在另一个循环中出现循环，以及嵌套 if/else 语句。
*   简短的功能。有时，当结果值已知时，不需要执行很多代码。
*   不必要的测试：

    > if (count($array) === 0) 返回；

    也可以写成：

    > if (!$array) 返回；

    消除了另一个函数调用！

    [1]： http: [//www.codinghorror.com/blog/archives/000878.html](http://www.codinghorror.com/blog/archives/000878.html) “最好的代码就是没有代码”

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-06-06T04:53:01.900

你可以用两个基本的东西来优化代码：

## 优化 PHP 关联库和服务器

通过[https://www.digitalocean.com/community/articles/how-to-optimize-apache-web-server-performance](https://www.digitalocean.com/community/articles/how-to-optimize-apache-web-server-performance)或

您可以使用 xhprof 之类的分析工具来查看可以优化的代码部分，下面是链接： http: [//michaelsanford.com/compiling-xhprof-for-php-5-4/](http://michaelsanford.com/compiling-xhprof-for-php-5-4/)

## 使用代码分析器和代码分析器优化您的代码

您需要安装 Netbeans 才能使用此插件。以下是您需要遵循的步骤：

1) 打开 NetBeans，然后从菜单栏工具 > 插件中选择选项。然后在可用的插件选项卡中搜索插件名称“phpcsmd”并从那里安装它。

2）现在打开终端并通过输入命令“sudo su”以超级用户身份出现。

3) 通过在终端中运行以下命令将 PEAR 库（如果未安装）安装到系统中

```
a) wget http://pear.php.net/go-pear.phar
b) php go-pear.phar 
```

因为我们需要它来安装更多的插件。

4）然后运行命令

```
"pear config-set auto_discover 1" 
```

这将用于为所需插件设置自动发现路径“true”。所以他们会自动安装到所需的位置。

5) 然后运行下面的命令来安装 PHP 代码嗅探器。

```
"pear install --alldeps pear/PHP_CodeSniffer" 
```

6) 现在通过运行以下命令安装 PHP Mess Detector

```
"pear install --alldeps phpmd/PHP_PMD" 
```

如果您在安装此模块时收到“无效的包名称/包文件“phpmd/PHP_PMD””之类的错误。您需要使用此“pear channel-discover pear.phpmd.org”命令来消除此错误。在此命令之后，您可以再次运行上述命令来安装 Mess 检测器。

7) 现在通过运行以下命令来安装 PHP Depend

```
"pear install --alldeps pdepend/PHP_Depend" 
```

8) 现在通过运行以下命令安装 PHP Copy Paste Detector

```
"pear install --alldeps phpunit/phpcpd" 
```

9）然后运行命令

```
"pear config-set auto_discover 0" 
```

这将用于设置自动发现路径“false”。

10）然后打开net beans并按照路径Tools>Options>PHP>PHPCSMD

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-08-15T18:28:47.317

没有神奇的解决方案，尝试提供通用解决方案很可能只是浪费时间。

你的瓶颈在哪里？例如，您的脚本处理器/数据库/内存是否密集？

您是否进行了任何分析？

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-17T21:50:21.673

包含文件很慢，要求它们更慢。如果您使用 __autoload 包含每个类，那么这将加起来。例如。

如果它牺牲了代码清晰度，我总是有点担心在代码优化方面过于聪明。如果您需要使代码变得模糊以使其快速运行，那么升级硬件而不是浪费时间尝试调整代码不是更便宜吗？毕竟，处理器周期比程序员周期便宜。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-19T14:59:57.500

我能想到的那些...

*   [循环不变量](http://hudzilla.org/phpwiki/index.php?title=Get_your_loops_right_first)总是值得关注的。

*   编写符合 E_STRICT 和 E_NOTICE 的代码，尤其是在记录错误时。

*   避免使用 @ 运算符。

*   要求和包含的绝对路径。

*   尽可能使用 strpos、str_replace 等代替正则表达式。

然后还有许多其他方法可能有效，但可能不会给您带来太多好处。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-15T18:29:48.483

每当我查看性能问题时，我认为最好的办法是计算页面运行的时间，然后查看最慢的页面。当您获得这些真实指标时，您通常可以通过修复缓慢的 SQL 查询或稍微收紧代码来将最慢的指标的性能提高几个数量级。

这当然不需要新的硬件或特殊软件，只需对现有代码进行批判性观察。

也就是说，这只会工作这么长时间......如果你真的获得足够的流量来达到你的硬件限制，和/或有一些代码本身就很慢并且确实需要，你将不得不看看其他可能性。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-15T22:49:29.303

我负责一个大型报告系统，我们跟踪最慢的报告。当报告开始时，我将一个唯一键输入数据库，然后当它完成时，我可以确定花费了多长时间。我正在使用数据库，因为这样我可以检测页面何时超时（这比我想要的要多得多）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-15T23:06:04.823

首先遵循其他一些建议，例如分析和做出良好的资源分配决策，例如缓存。

此外，还要考虑数据库等外部资源的性能。例如，在 MySQL 中，您可以检查[慢查询日志](http://dev.mysql.com/doc/refman/5.0/en/slow-query-log.html)。此外，请确保您没有设计数据库而忘记它。针对真实数据优化您的查询（[再次针对 MySQL](http://dev.mysql.com/doc/refman/5.0/en/using-explain.html)）可能会付出很大的代价。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-17T22:43:02.733

Rasmus Lerdorf 在他最近在 FrOSCon '08上的演讲“[简单就是难”中给出了一些很好的建议。](http://talks.php.net/show/froscon08)如果您正在使用字节码缓存（并且您真的应该使用一个），包含路径未命中会造成很大的伤害，因此请优化您的 require/require_once。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-08-31T07:38:30.777

您可以使用 xhprof 之类的分析工具来查看代码的哪些部分可以优化！

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-12-27T11:39:06.513

1) 使用最新版本的 PHP

核心团队正在努力提高 PHP 在每个版本中的性能。

2）使用字节码缓存

从 PHP 5.5 开始，一个字节码缓存被添加到 PHP 中，命名为`OPcache`. 使用`OPcache`可以产生巨大的差异，特别是从 PHP 7 开始。它在每个 PHP 版本中都得到了改进，甚至可能[在未来获得 JIT 实现](https://externals.io/message/95531)。

3) 剖析

在开发分析时，您可以深入了解到底发生了什么。这有助于发现代码中的瓶颈。

最常用的工具之一是`XHProf`但不再受到官方支持，并且 PHP >= 7 存在问题。当您想要分析 PHP >= 7 时，另一种选择[`Tideways`是`XHProf`](https://tideways.io/profiler/xhprof-for-php7-php5.6).

# sql-server - 在 SSAS 中处理多维数据集期间没有跟踪信息

> ID：12578
> 
> 赞同：5
> 
> 时间：2008-08-15T18:28:45.350
> 
> 标签：sql-server, visual-studio-2005, ssas, trace, olap

当我在 Visual Studio 2005 中处理多维数据集时，我收到以下消息：

> 处理成功。跟踪信息仍在传输中。如果您不想等待所有信息到达，请按停止。

并且不显示任何跟踪信息。多维数据集被它处理好有点烦人。有任何想法吗？我通过网络服务器访问多维数据集。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-03-02T15:17:46.167

通过 GUI 处理时，我收到相同的消息。我以前从未遇到过这种情况，即使在 Dev 或其他公司也是如此。我找不到解决方法，这里似乎有一个真正的问题（连接问题：[http ://connect.microsoft.com/SQLServer/feedback/details/536543/ssas-process-progress-window-blank-no-详情](http://connect.microsoft.com/SQLServer/feedback/details/536543/ssas-process-progress-window-blank-no-details)）

任何解决方法都会很棒...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-06T00:23:15.010

当我处理一个多维数据集时，我会收到相同的消息，但如果我等待几秒钟，跟踪信息就会到达。您是在处理大量数据还是非常复杂的多维数据集？也许这是一个愚蠢的问题，但你试过等几分钟吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T15:04:52.857

你是如何处理立方体的？通过 XMLA 还是通过 GUI？如果您在 XMLA 中执行此操作，那么您应该在输出窗口中看到结果

# python - 将 XML 目录与 Python 的 lxml 一起使用？

> ID：12591
> 
> 赞同：10
> 
> 时间：2008-08-15T18:42:20.503
> 
> 标签：python, xml, lxml

当我使用 lxml 解析 XML 文档时，有没有办法使用外部目录文件根据其 DTD 验证该文档？我需要能够处理文档 DTD 中定义的固定属性。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2011-12-05T20:54:36.420

您可以将目录添加到`XML_CATALOG_FILES`环境变量中：

```
os.environ['XML_CATALOG_FILES'] = 'file:///to/my/catalog.xml' 
```

看到[这个线程](http://thread.gmane.org/gmane.comp.python.lxml.devel/5907)。请注意，其中的条目`XML_CATALOG_FILES`是以空格分隔的 URL。您可以使用 Python 的`pathname2url`and `urljoin`(with `file:`) 从路径名生成 URL。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-16T07:57:53.657

Can you give an example? According to the [lxml validation docs](http://codespeak.net/lxml/validation.html), lxml can handle DTD validation (specified in the XML doc or externally in code) and system catalogs, which covers most cases I can think of.

```
f = StringIO("<!ELEMENT b EMPTY>")
dtd = etree.DTD(f)
dtd = etree.DTD(external_id = "-//OASIS//DTD DocBook XML V4.2//EN") 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-30T18:10:33.757

似乎 lxml 没有公开这个 libxml2 功能，grepping 源代码只会出现一些#defines 用于错误处理：

```
C:\Dev>grep -ir --include=*.px[id] catalog lxml-2.1.1/src | sed -r "s/\s+/ /g"
lxml-2.1.1/src/lxml/dtd.pxi: catalog.
lxml-2.1.1/src/lxml/xmlerror.pxd: XML_FROM_CATALOG = 20 # The Catalog module
lxml-2.1.1/src/lxml/xmlerror.pxd: XML_WAR_CATALOG_PI = 93 # 93
lxml-2.1.1/src/lxml/xmlerror.pxd: XML_CATALOG_MISSING_ATTR = 1650
lxml-2.1.1/src/lxml/xmlerror.pxd: XML_CATALOG_ENTRY_BROKEN = 1651 # 1651
lxml-2.1.1/src/lxml/xmlerror.pxd: XML_CATALOG_PREFER_VALUE = 1652 # 1652
lxml-2.1.1/src/lxml/xmlerror.pxd: XML_CATALOG_NOT_CATALOG = 1653 # 1653
lxml-2.1.1/src/lxml/xmlerror.pxd: XML_CATALOG_RECURSION = 1654 # 1654
lxml-2.1.1/src/lxml/xmlerror.pxi:CATALOG=20
lxml-2.1.1/src/lxml/xmlerror.pxi:WAR_CATALOG_PI=93
lxml-2.1.1/src/lxml/xmlerror.pxi:CATALOG_MISSING_ATTR=1650
lxml-2.1.1/src/lxml/xmlerror.pxi:CATALOG_ENTRY_BROKEN=1651
lxml-2.1.1/src/lxml/xmlerror.pxi:CATALOG_PREFER_VALUE=1652
lxml-2.1.1/src/lxml/xmlerror.pxi:CATALOG_NOT_CATALOG=1653
lxml-2.1.1/src/lxml/xmlerror.pxi:CATALOG_RECURSION=1654 
```

从[libxml2 页面中的目录实现](http://xmlsoft.org/catalog.html)看来，通过 /etc/xml/catalog 中的安装进行的“透明”处理似乎仍然可以在 lxml 中工作，但如果您需要更多，您可以随时放弃 lxml 并使用默认的 python 绑定，它确实公开了目录功能。

# python - 你能检查一下 Python 中的 doctest 是否引发了异常吗？

> ID：12592
> 
> 赞同：73
> 
> 时间：2008-08-15T18:43:17.177
> 
> 标签：python, doctest

是否可以编写一个`doctest`单元测试来检查是否引发了异常？
例如，如果我有一个`foo(x)`应该引发异常 if 的函数，`x < 0`我将如何为此编写`doctest`？

* * *

## 回答 #1

> 赞同：97
> 
> 时间：2008-08-15T19:04:13.093

是的。你能行的。[doctest 模块文档](https://docs.python.org/3/library/doctest.html)和维基百科有一个[例子](http://en.wikipedia.org/wiki/Doctest#Example_2:_doctests_embedded_in_a_README.txt_file)。

```
 >>> x
   Traceback (most recent call last):
     ...
   NameError: name 'x' is not defined 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2020-08-22T17:56:22.767

```
>>> scope # doctest: +IGNORE_EXCEPTION_DETAIL
Traceback (most recent call last):
NameError: name 'scope' is not defined 
```

不知道为什么以前的答案没有IGNORE_EXCEPTION_DETAIL。我需要它才能工作。Py 版本：3.7.3。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2015-11-18T18:22:25.677

```
>>> import math
>>> math.log(-2)
Traceback (most recent call last):
 ...
ValueError: math domain error 
```

ellipsis flag *# doctest: +ELLIPSIS* is not required to use ... in Traceback doctest

# .net - System.Xml 是否使用 MSXML？

> ID：12593
> 
> 赞同：11
> 
> 时间：2008-08-15T18:45:07.003
> 
> 标签：.net, xml, msxml

我正在开发一个使用少量 XML 文件和 System.Xml 中的一些类的 C# 应用程序。一位同事坚持将 MSXML6 可再发行组件与 .NET 框架一起添加到我们的安装中，但我认为 .NET 框架无论如何都不会使用或需要 MSXML。我很清楚不支持使用 .NET 中的 MSXML，但我认为 System.Xml 本身在理论上可以将 MSXML 包装在低级别。我还没有找到任何明确的 .NET 有自己的实现，但我也找不到任何表明它需要 MSXML 的东西。

帮我解决争论。System.Xml 是否使用 MSXML？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-08-15T18:47:01.617

System.Xml 不使用 MSXML6。它们是独立的 xml 处理引擎。请参阅此处的帖子：http: [//blogs.msdn.com/stan_kitsis/archive/2005/09/20/472185.aspx](http://blogs.msdn.com/stan_kitsis/archive/2005/09/20/472185.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-16T02:39:54.297

System.Xml 位于核心框架中，不依赖于 MSXML 6.0，但它共享一些通用 API（DOM 解析器、SAX 解析器、XPath 节点选择）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-15T18:57:43.467

这类东西没有必要成为繁琐的工作场所辩论的主题，因为框架的源代码是可用的，并且只需少量工作，您就可以将全部内容下载到您的机器上。 [http://www.codeplex.com/NetMassDownloader](http://www.codeplex.com/NetMassDownloader)

再做一点点工作，您就可以制作一个包含所有框架源代码的 VS 项目，这使得浏览起来更加容易。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-07T12:45:59.587

.Net 框架使用 MSXML6 安装在 WinXP SP2 和 W2K3 SP2 上，只有 MSXML6 不在框中。System.Xml 是与 MSXML6 不同的产品，尽管某些 API 具有相似的签名。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-08-15T18:51:10.797

我认为某些 MsSql-XML 功能需要它，但 System.Xml 在核心框架中。

无论如何，您都应该在新机器上测试您的安装程序，以确保这一点。

# c++ - Windows/C++：如何确定与共享驱动器关联的共享名称？

> ID：12594
> 
> 赞同：1
> 
> 时间：2008-08-15T18:45:36.190
> 
> 标签：c++, windows, networking, share

假设我有一个驱动器，例如**C:\**，我想知道它是否共享以及它的共享名称（例如**C$**）是什么。

要确定它是否共享，我可以使用[NetShareCheck](https://docs.microsoft.com/en-us/windows/desktop/api/Lmshare/nf-lmshare-netsharecheck)。

然后如何将驱动器映射到其共享名称？我认为[NetShareGetInfo](https://docs.microsoft.com/en-us/windows/desktop/api/Lmshare/nf-lmshare-netsharegetinfo)会这样做，但它看起来将共享名称而不是本地驱动器名称作为输入。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-15T18:55:15.297

如果一切都失败了，您总是可以使用[NetShareEnum](https://docs.microsoft.com/en-us/windows/win32/api/lmshare/nf-lmshare-netshareenum)并在每个上调用[NetShareGetInfo](https://docs.microsoft.com/windows/desktop/api/lmshare/nf-lmshare-netsharegetinfo)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-16T02:10:10.677

我相信您正在寻找[WNetGetConnectionA](https://docs.microsoft.com/en-us/windows/win32/api/winnetwk/nf-winnetwk-wnetgetconnectiona)或[WNetGetConnectionW](https://docs.microsoft.com/en-us/windows/win32/api/winnetwk/nf-winnetwk-wnetgetconnectionw)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-15T19:31:37.640

采用;

```
SHGetFileInfo with SHGFI_ATTRIBUTES 
```

返回时检查 SFGAO_SHARE 的 dwAttributes 标志。

我不确定如何找到实际路径。

# asp.net - 为什么配置文件提供程序没有内置到 Web 应用程序中？

> ID：12603
> 
> 赞同：2
> 
> 时间：2008-08-15T18:58:54.430
> 
> 标签：asp.net

如果您创建一个 ASP.NET Web 文件项目，您可以直接访问 web.config 文件中的配置文件信息。如果您将其转换为 Web 应用程序并一直在使用 ProfileCommon 等，那么您必须跳过一大堆障碍才能使您的 Web 应用程序正常工作。

为什么配置文件提供程序不像在 Web 文件项目中那样内置到 ASP.NET Web 应用程序项目中？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-11T04:17:21.247

实际上，微软确实有解决这个已知问题的方法。它是“Web Profiler Builder”。我将它用于我的 Web 应用程序，效果很好。 [http://code.msdn.microsoft.com/WebProfileBuilder/Release/ProjectReleases.aspx?ReleaseId=980](http://code.msdn.microsoft.com/WebProfileBuilder/Release/ProjectReleases.aspx?ReleaseId=980)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-15T19:02:40.430

配置文件提供程序使用 ASP.NET 生成提供程序系统，该系统不适用于 Web 应用程序项目。

> 将自定义的 BuildProvider 类添加到 Web.config 文件在 ASP.NET 网站中有效，但在 ASP.NET Web 应用程序项目中无效。在 Web 应用程序项目中，BuildProvider 类生成的代码不能包含在应用程序中。

来源：[MSDN Build Provider 文档](http://msdn.microsoft.com/en-us/library/system.web.compilation.buildprovider.aspx)

# algorithm - 设计像谷歌日历这样的日历系统

> ID：12611
> 
> 赞同：14
> 
> 时间：2008-08-15T19:10:15.827
> 
> 标签：algorithm, calendar

我必须创建类似于谷歌日历的东西，所以我创建了一个包含用户所有事件的事件表。

困难的部分是处理重复发生的事件，事件表中的行有一个 event_type 字段，它告诉您它是什么类型的事件，因为一个事件只能针对一个日期，或者每 x 天重新发生一个事件.

**主要的设计挑战是处理重复发生的事件。**

当用户使用月份视图查看日历时，如何显示给定月份的所有事件？查询会很棘手，所以我认为创建另一个表并为每个事件创建一行会更容易，包括重新发生的事件。

你们有什么感想？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-15T20:06:09.863

尝试存储每个事件的每个实例似乎真的有问题，而且，嗯，不可能。如果有人创建了一个“每个星期四，永远”发生的事件，那么您显然无法存储所有未来的事件。

您*可以*尝试按需生成未来事件，并仅在必要时填充未来事件以显示它们或发送有关它们的通知。但是，如果您无论如何都要构建“按需”生成代码，为什么不一直使用它呢？无需从事件表中提取，然后必须使用按需事件生成来填充尚未添加到表中的任何新事件，只需专门使用按需事件生成即可。最终结果将是相同的。使用此方案，您只需要存储开始和结束日期以及事件频率。

我看不出有任何方法可以避免按需生成事件，因此我在事件表中看不到该实用程序。如果您为了缓存而想要它，那么我认为您采用了错误的方法。首先，它的缓存很差，因为无论如何您都无法避免按需生成事件。其次，无论如何，您可能应该在更高级别进行缓存。如果要缓存，则缓存生成的页面，而不是事件。

就提高轮询效率而言，如果您仅每 15 分钟轮询一次，并且您的数据库和/或服务器无法处理负载，那么您已经注定要失败。如果您的数据库无法处理更多、更频繁的轮询而不费力气，那么您的数据库将无法处理*用户*。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-08-15T21:22:01.520

如前所述，***不要重新发明轮子***，只需增强它。

签[出 VCalendar](http://www.ultraapps.com/app_overview.php?app_id=19)，它是开源的，并且有 PHP、ASP 和 ASP.Net (C#) 版本！

您还可以查看[Day Pilot](http://www.daypilot.org/)，它提供了用 Asp.Net 2.0 编写的日历。他们提供了一个精简版，您可以签出，如果它适合您，您可以购买许可证。

**更新（9/30/09）：**

除非当然轮子坏了！此外，如果您愿意，您可以涂上一层闪亮的新油漆（即：制作更好的 UI）。但至少尝试找到一些基础来构建，因为日历系统可能很棘手（重复事件），并且已经完成了数千次。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-08-22T22:19:10.480

我正在解决这个问题，并且在阅读此线程之前，我已经完全间隔了[iCalendar](http://en.wikipedia.org/wiki/ICalendar) ( [rfc 2445](https://www.rfc-editor.org/rfc/rfc2445) )，所以我不知道这将与该线程集成或不会集成得有多好。无论如何，到目前为止我提出的设计看起来像这样：

*   您不可能存储重复事件的所有实例，至少不能在它们发生之前存储，所以我只有一个表，将事件的第一个实例存储为实际日期、可选的到期时间以及可为空的 repeat_unit 和 repeat_increment 字段来形容重复。对于单个实例，repition 字段为空，否则单位将是“日”、“周”、“月”、“年”，并且增量只是添加到下一次出现的开始日期的单位的倍数。
*   仅当您需要与模型中的其他实体建立关系时，存储过去的事件似乎是有利的，即使这样，也没有必要在每种情况下都有一个明确的“事件实例”表。如果其他实体已经有日期/时间“实例”数据，那么事件的外键（或多对多的连接表）很可能就足够了。
*   要做“更改此实例”/“更改所有未来实例”，我计划只是复制事件并使过时的事件过期。因此，要更改单个实例，您将在最后一次出现旧实例时使旧实例过期，为新的、唯一的实例制作一个副本，其中包含所做的更改且不重复，并在下一次重复出现的原始实例的另一个副本中重复到未来。更改所有未来实例是类似的，您只需使原始实例过期并使用更改和重复详细信息制作新副本。

到目前为止，我在此设计中看到的两个问题是：

1.  它使 MWF 类型的事件难以表示。这是可能的，但会强制用户创建三个单独的事件，这些事件每周在 M、W、F 上单独重复，并且他们想要进行的任何更改也必须分别在每个事件上完成。这类事件在我的应用程序中并不是特别有用，但它确实在模型上留下了一个缺陷，这使得它不像我想要的那样通用。
2.  通过复制事件进行更改，您打破了它们之间的关联，这在某些情况下可能很有用（或者，它可能只是偶尔会出现问题。）事件表理论上可以包含一个“copied_from”id字段来跟踪一个事件起源，但我还没有完全考虑过这样的事情会有多大用处。一方面，从 SQL 查询父/子层次关系是一件很痛苦的事情，因此收益需要相当大才能超过查询该数据的成本。我想你可以改用[嵌套集](http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/)。

最后，我认为*可以*使用直接 SQL 计算给定时间跨度的事件，但我还没有计算出确切的细节，而且我认为查询通常最终过于繁琐，不值得。但是，为了便于讨论，您可以使用以下表达式来计算给定月份和年份之间的月差：

```
(:month + (:year * 12)) - (MONTH(occursOn) + (YEAR(occursOn) * 12)) 
```

在最后一个示例的基础上，您可以使用 MOD 来确定月份差异是否是正确的倍数：

```
MOD(:month + (:year * 12)) - (MONTH(occursOn) + (YEAR(occursOn) * 12), repeatIncrement) = 0 
```

无论如何，这并不完美（它不会忽略过期事件，不考虑事件的开始/结束时间等），因此它只是作为一个激励示例。一般来说，虽然我认为大多数查询最终都会过于复杂。您最好查询在给定范围内发生的事件，或者在范围之前不过期，并在代码而不是 SQL 中计算实例本身。如果您*真的*希望数据库进行处理，那么存储过程可能会让您的生活更轻松。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-08-15T19:14:02.950

我会说从 ical 标准开始。如果您使用它作为您的模型，那么您将能够执行 google 日历、outlook、mac ical（程序）的所有操作，并且几乎可以立即与它们集成。

从那里开始，是时候完善您的 ajax 和 javascript，因为如果没有大量的 ajax 和 javascript，您将无法拥有带有拖放功能和多个日历的华丽 Web ui。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-08-16T04:40:32.290

The brute-force-ish but still reasonable way would be to create a new row in your single events table for every instance of the recurring event, all pointing **not to the event preceding it in the series** but to the *first* event in the series. This simplifies selecting and/or deleting all elements in a particular series, since you can select based on parent id. It also allows users to delete individual items from a series without affecting the rest of them.

This query gets you the series that starts on element 3:

```
SELECT * FROM events WHERE id = 3 OR parentid = 3 
```

To get all items for this month, assuming you'd have a start date and an end date in your events table, all you'd have to do is:

```
SELECT * FROM events WHERE startdate >= '2008-08-01' AND enddate <= '2008-08-31' 
```

Handling the creation/modification of series programmatically wouldn't be very difficult, but it really would depend on the feature set you want to provide and how you think it'll be used. If you want to differentiate between series and events, you could have a separate series table and a nullable series_id on your events, allowing you the freedom to muck about with individual events while still retaining control over your series.

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-08-15T19:20:32.610

您应该有一个开始日期、结束日期和到期日期。单日活动将具有相同的开始日期和结束日期，并且还允许您进行部分日活动。至于重复发生的事件，那么开始和结束日期将是同一天，但有不同的时间，然后你有一个指定重复频率（每天、每周、每月等）的枚举或表。

这使您可以说“此事件每天出现”表示每天，“此事件出现在每周的第二天”表示每周，“此事件出现在每个月的第 5 天”表示每月，“此事件出现在每年的第 215 天”，只要该日期小于到期日期即可。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-08-15T19:27:27.290

达伦，

这就是我实际设计事件表的方式，但是考虑到它，假设我有 10 万个创建事件的用户，这个表会受到很大的打击，特别是如果我要发送电子邮件来提醒人们他们的事件（事件也可以是一天中的特定时间！），所以我可能每 15 分钟轮询一次这个表！

这就是为什么我想创建另一个表来扩展所有事件/重新发生的事件，这样我可以简单地点击该表并获取用户月份的事件视图，而无需执行任何复杂的查询和业务逻辑，并且它将使轮询也更加有效。

问题是，这个辅助表应该是下一天还是下个月？什么更有意义？由于用户可以查看的最大值是月份视图，因此我倾向于使用一个表格来写出给定月份的所有事件。

（当然，对于用户可能对原始事件表进行的任何编辑，我必须维护这个辅助表）。

灿灿，

我实际上已经设计了具有相同功能的它，但我只是指我将如何存储事件，特别是如何处理重复发生的事件。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-15T19:19:04.890

根据过去的经验，我会为每个发生的事件创建一个新记录，然后有一个引用前一个事件的列，这样您就可以跟踪一系列事件中的所有事件。

这有两个优点：

1.  没有复杂的例程来计算下一个活动日期
2.  可以编辑单个事件而不影响其余事件

希望这能给你一些思考的食物:)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-08-15T19:22:35.397

我必须同意@ChanChan 阅读有关如何存储这些东西的 ical 规范。没有简单的方法来处理重复，尤其是那些有异常的。我已经建立、重建和重建了一个数据库来处理这个问题，并且我不断地回到 ical。

根据用例创建从属表不是一个坏主意。准确计算发生时间的算法。. . 嗯，发生。. . 确实可以很复杂。运行它是不可避免的，但值得考虑缓存结果。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-08-15T19:25:04.720

@GateKiller

我没有想到您编辑个别事件的情况。在这种情况下，您将单独存储事件是有道理的。

但是，当您这样做时，您将事件存储在多远的将来？你选择任意日期吗？您是否会在用户第一次浏览未来几个月/几年时自动生成新事件？

此外，您如何处理用户想要编辑整个系列的情况。“我们每周二早上 10:30 开会，但我们将在周三 8 点开始开会”

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-08-16T04:22:20.503

> That is how I have designed my events table actually, but when thinking about it, say I have 100K users who have create events, this table will be hit pretty hard, especially if I am going to be sending out emails to remind people of their events (events can be for specific times of the day also!), so I could be polling this table every 15 minutes potentially!

Databases do exception jobs of handling sets of data, so i wouldn't be too worried about that. What you should do is use this as your primary table, and then as events expire then move them into another table (like an archive).

The next thing is you want to try is to query the db as little as possible, so move the information into a caching tier (like [velocity](http://msdn.microsoft.com/en-us/data/cc655792.aspx)) and just persist data to the database.

Then, you can partition the information across multiple databases for scaling purposes. ie users 1-10000 calendars exist on server 1, 10001 - 20000 exist on server 2, etc.

That's how i would scale a solution like this, but i still think the original solution i proposed is the way to go, it's just how you scale it that becomes the question.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-11-25T01:01:24.437

[Ra-Ajax Calendar starter-kit](http://ra-ajax.org/samples/Viewport-Calendar-Starter-Kit.aspx)提供了一个处理 RenderDate 事件的示例，该事件可以专门修改日期。虽然“重复事件”更像是一种算法，但在这里我怀疑很少有日历会对你有多大帮助......

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-08-15T19:17:51.803

我想我理解您的第二段意味着您正在考虑第二个事件表，该表在每次发生事件时都有一行。我会避免这种情况。

重复发生的事件应该有一个开始日期和一个停止日期（对于每 X 天“永远”持续一次的事件，这可能是 Null）你必须决定你想要允许什么样的频率 - 每 X 天，每个月的第 N 天，每个给定的工作日等。

我可能倾向于使用两张桌子 - 一张用于一次性事件，另一张用于重复事件。您必须分别查询和显示两者。

如果我要解决这个问题（并且我会尽我所能避免重新发明这个轮子），我会寻找开源库，或者至少，你可以查看带有日历的开源项目. 有什么建议吗？

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-08-15T21:44:55.423

> **[未定义](https://stackoverflow.com/users/1368/undefined)**写道：
> 
> …这张桌子会受到很大的打击，特别是如果我要发送电子邮件来提醒人们他们的事件（事件也可以是一天中的特定时间！），所以我可能每 15 分钟轮询一次这张桌子！

为通知创建一个表。仅轮询它。

更新事件（重复或其他）时更新通知表。

编辑：如果这是一个问题，数据库视图可能不会违反正常形式。但是，您可能想要跟踪哪些通知已发送，哪些尚未发送到某个地方。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-08-15T22:08:13.627

Derek Park，我将在表中创建事件的每个实例，并且该表将每月重新生成（因此任何设置为“永远”重复发生的事件都将使用 Windows 服务提前一个月重新生成或也许在 sql server 级别）。投票不仅每 15 分钟进行一次，而且可能只针对与电子邮件通知相关的投票。当有人想查看他们一个月的事件时，我将不得不提取他们所有的事件，并重新发生事件并找出要显示的事件（因为重新发生的事件可能是在 6 个月前创建的，但与用户正在查看的一个月）。

Zack，我不太关心拥有一个完美规范化的数据库，我正在考虑创建一个辅助表的事实已经违反了规则之一，呵呵。我的核心数据库表遵循“规则”，但有时我不介意创建辅助表/列，这有助于提高性能。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-02-01T17:15:07.417

如果有人在做 Ruby，那么有一个很棒的库 Runt 可以做这种事情。值得一试。 [http://runt.rubyforge.org/](http://runt.rubyforge.org/)

# permissions - 访问控制列表和访问控制对象，好的教程？

> ID：12612
> 
> 赞同：2
> 
> 时间：2008-08-15T19:11:31.800
> 
> 标签：permissions, acl

我们正在开发一个网络应用程序来涵盖印刷公司的所有方面，从财务、工资到工作成本。能够控制谁可以访问这些应用程序的哪些部分非常重要。不想让一线员工给自己加薪等等……

我听说过 ACL 和 ACO 的概念，但还没有找到一个可以适应我们项目的好例子。

有人知道我在哪里可以找到好的工作信息吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-15T20:31:23.557

可以在此处找到 ACL 的简要概述，应在何处使用它们以及应如何为各种应用程序和用户级别构建和实现它们：

[关联](http://c2.com/cgi/wiki?AccessControlList)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-15T19:19:07.667

我不得不多次实施这种类型的安全性。不幸的是，我不知道任何提供示例的非常好的文章。我的实现主要是通过反复试验将各个部分拼凑在一起。

但是，我确实在 MSDN 上看到了这个链接：

[http://msdn.microsoft.com/en-us/library/52kd59t0(VS.71).aspx](http://msdn.microsoft.com/en-us/library/52kd59t0(VS.71).aspx)

它有一些概念。

* * *

在我的原始帖子之后，我做了更多的研究。我找到了这篇文章：

[http://www.aspfree.com/c/a/C-Sharp/Implementing-Role-Based-Security-using-CSharp/](http://www.aspfree.com/c/a/C-Sharp/Implementing-Role-Based-Security-using-CSharp/)

看起来很有希望，我没有详细介绍所有细节，但它至少可以引导您了解高级主题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-15T20:24:03.573

如果您使用的是 .NET/Windows，您可能需要查看 Windows 授权管理器 (AzMan)。Enterprise Library 中支持 AzMan，但也有其他使用方式。

[http://msdn.microsoft.com/en-us/library/ms998336.aspx](http://msdn.microsoft.com/en-us/library/ms998336.aspx) [http://alt.pluralsight.com/wiki/default.aspx/Keith.GuideBook/WhatIsAuthorizationManager.html](http://alt.pluralsight.com/wiki/default.aspx/Keith.GuideBook/WhatIsAuthorizationManager.html)

# sql - 在 Emacs sql-mysql 中指定端口号

> ID：12613
> 
> 赞同：19
> 
> 时间：2008-08-15T19:12:24.217
> 
> 标签：sql, mysql, emacs

我一直在使用 Emacs 的 sql 交互模式与 MySQL db 服务器对话并开始享受它。开发人员在新的非默认端口号上设置了另一个数据库，但我不知道如何使用 sql-mysql 访问它。

尝试连接数据库时如何指定端口号？

如果 Emacs 可以提示我输入端口号，如果我不指定就使用默认值，那就更好了。有这样的机会吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2012-09-21T21:58:36.923

在挖掘了 sql.el 文件后，我发现了一个变量，它允许我在尝试创建连接时指定一个端口。

GNU Emacs 24.1 添加了这个选项。

> **sql-mysql-登录参数**
> 
> 连接到 MySQL 所需的登录参数列表。

我将此添加到我的 Emacs 初始化文件中：

```
(setq sql-mysql-login-params (append sql-mysql-login-params '(port))) 
```

默认端口为 0。如果您想将其设置为默认 MySQL 端口，您可以自定义`sql-port`

```
(setq sql-port 3306) ;; default MySQL port 
```

GNU Emacs 24.1 中所有流行的 RDMS 系统都有一个`sql-*-login-params`变量。`sql-port`用于 MySQL 和 PostreSQL

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-08-15T19:27:09.133

```
(setq sql-mysql-options (list "-P <port number>")) 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-08-15T19:51:45.463

我找到了使用的选项：

```
M-x customize-group
SQL 
```

这包括一个标记为：

```
Mysql Options: 
```

如果您设置选项并保存它，将在您的 .emacs 中添加一个新行：

```
(custom-set-variables
 '(sql-mysql-options (quote ("-P ???")))) 
```

（显然，您应该使用实际的端口号。）

我使用 XEmacs，所以你的里程可能会有所不同。

# c++ - 在 C++ 中解析 INI 文件的最简单方法是什么？

> ID：12633
> 
> 赞同：89
> 
> 时间：2008-08-15T19:31:01.747
> 
> 标签：c++, winapi, ini, fileparse

我正在尝试使用 C++ 解析 INI 文件。关于实现这一目标的最佳方法的任何提示？我应该使用 Windows API 工具来处理 INI 文件（我完全不熟悉）、开源解决方案还是尝试手动解析它？

* * *

## 回答 #1

> 赞同：118
> 
> 时间：2008-08-23T01:21:09.857

如果您需要跨平台解决方案，请尝试 Boost 的[Program Options](http://www.boost.org/doc/libs/1_36_0/doc/html/program_options.html)库。

* * *

## 回答 #2

> 赞同：115
> 
> 时间：2008-08-15T20:06:53.140

您可以使用 Windows API 函数，例如[GetPrivateProfileString()](https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-getprivateprofilestring)和[GetPrivateProfileInt()](https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-getprivateprofileint)。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-08-15T19:33:31.397

我从来没有解析过ini文件，所以我不能对这个问题太具体。
但我有一个建议：
**只要现有的满足您的要求，就不要重新发明轮子**

[http://en.wikipedia.org/wiki/INI_file#Accessing_INI_files](http://en.wikipedia.org/wiki/INI_file#Accessing_INI_files)
[http://sdl-cfg.sourceforge.net/](http://sdl-cfg.sourceforge.net/)
[http://sourceforge.net/projects/libini/](http://sourceforge.net/projects/libini/)
[http://www.codeproject.com/KB /files/config-file-parser.aspx](http://www.codeproject.com/KB/files/config-file-parser.aspx)

祝你好运 ：）

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2010-12-03T06:59:42.550

如果你已经在使用 Qt

```
QSettings my_settings("filename.ini", QSettings::IniFormat); 
```

然后读取一个值

```
my_settings.value("GroupName/ValueName", <<DEFAULT_VAL>>).toInt() 
```

还有许多其他转换器可以将您的 INI 值转换为标准类型和 Qt 类型。有关更多信息，请参阅 QSettings 上的 Qt 文档。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2008-09-22T17:58:15.750

我使用[SimpleIni](https://github.com/brofield/simpleini)。它是跨平台的。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-12-26T22:11:04.453

这个问题有点老了，但我会发布我的答案。我已经测试了各种 INI 类（你可以在我的[网站](http://www.24hsoftware.com/DevelopersForum/CrossPlatform-C-Library.html#comment-1400)上看到它们）并且我也使用 simpleIni，因为我想在 windows 和 winCE 上使用 INI 文件。Window 的 GetPrivateProfileString() 仅适用于 winCE 上的注册表。

使用 simpleIni 很容易阅读。这是一个例子：

```
#include "SimpleIni\SimpleIni.h"    
CSimpleIniA ini;
ini.SetUnicode();
ini.LoadFile(FileName);
const char * pVal = ini.GetValue(section, entry, DefaultStr); 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2013-08-13T12:24:26.717

[inih](https://code.google.com/p/inih/)是一个用 C 编写的简单 ini 解析器，它也带有一个 C++ 包装器。示例用法：

```
#include "INIReader.h"    

INIReader reader("test.ini");

std::cout << "version="
          << reader.GetInteger("protocol", "version", -1) << ", name="
          << reader.Get("user", "name", "UNKNOWN") << ", active="
          << reader.GetBoolean("user", "active", true) << "\n"; 
```

作者在[这里](http://blog.brush.co.nz/2009/02/inih/)也有一个现有库的列表。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-12-16T17:13:30.133

你试过[libconfig 吗](http://www.hyperrealm.com/libconfig/)？非常类似于 JSON 的语法。我更喜欢它而不是 XML 配置文件。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-03-18T19:40:28.750

如果你对平台可移植性感兴趣，你也可以试试 Boost.PropertyTree。它支持 ini 作为持久性格式，尽管属性树只有 1 级深。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-08-15T20:10:46.143

除非您打算使应用程序跨平台，否则使用 Windows API 调用将是最好的方法。只需忽略 API 文档中关于仅为 16 位应用程序兼容性提供的说明。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2018-01-10T01:32:51.390

我知道这个问题很老了，但是我遇到了这个问题，因为我需要一些跨平台的 linux，win32 ......我写了下面的函数，它是一个可以解析 INI 文件的函数，希望其他人会发现它有用。

规则和警告：要解析的 buf 必须是 NULL 终止的字符串。将您的 ini 文件加载到 char 数组字符串中并调用此函数来解析它。部分名称必须有 [] 括号，例如 [MySection]，值和部分也必须从没有前导空格的行开始。它将解析带有 Windows \r\n 或 Linux \n 行结尾的文件。注释应使用 # 或 // 并从文件顶部开始，不得将注释与 INI 条目数据混合。从返回字符串的两端修剪引号和刻度。只有在引号之外的空格才会被修剪。字符串不需要有引号，如果缺少引号，空格会被修剪。您还可以提取数字或其他数据，例如，如果您有一个浮点数，只需在 ret 缓冲区上执行 atof(ret)。

```
//  -----note: no escape is nessesary for inner quotes or ticks-----
//  -----------------------------example----------------------------
//  [Entry2]
//  Alignment   = 1
//  LightLvl=128
//  Library     = 5555
//  StrValA =  Inner "quoted" or 'quoted' strings are ok to use
//  StrValB =  "This a "quoted" or 'quoted' String Value"
//  StrValC =  'This a "tick" or 'tick' String Value'
//  StrValD =  "Missing quote at end will still work
//  StrValE =  This is another "quote" example
//  StrValF =  "  Spaces inside the quote are preserved "
//  StrValG =  This works too and spaces are trimmed away
//  StrValH =
//  ----------------------------------------------------------------
//12oClocker super lean and mean INI file parser (with section support)
//set section to 0 to disable section support
//returns TRUE if we were able to extract a string into ret value
//NextSection is a char* pointer, will be set to zero if no next section is found
//will be set to pointer of next section if it was found.
//use it like this... char* NextSection = 0;  GrabIniValue(X,X,X,X,X,&NextSection);
//buf is data to parse, ret is the user supplied return buffer
BOOL GrabIniValue(char* buf, const char* section, const char* valname, char* ret, int retbuflen, char** NextSection)
{
    if(!buf){*ret=0; return FALSE;}

    char* s = buf; //search starts at "s" pointer
    char* e = 0;   //end of section pointer

    //find section
    if(section)
    {
        int L = strlen(section);
        SearchAgain1:
        s = strstr(s,section); if(!s){*ret=0; return FALSE;}    //find section
        if(s > buf && (*(s-1))!='\n'){s+=L; goto SearchAgain1;} //section must be at begining of a line!
        s+=L;                                                   //found section, skip past section name
        while(*s!='\n'){s++;} s++;                              //spin until next line, s is now begining of section data
        e = strstr(s,"\n[");                                    //find begining of next section or end of file
        if(e){*e=0;}                                            //if we found begining of next section, null the \n so we don't search past section
        if(NextSection)                                         //user passed in a NextSection pointer
        { if(e){*NextSection=(e+1);}else{*NextSection=0;} }     //set pointer to next section
    }

    //restore char at end of section, ret=empty_string, return FALSE
    #define RESTORE_E     if(e){*e='\n';}
    #define SAFE_RETURN   RESTORE_E;  (*ret)=0;  return FALSE

    //find valname
    int L = strlen(valname);
    SearchAgain2:
    s = strstr(s,valname); if(!s){SAFE_RETURN;}             //find valname
    if(s > buf && (*(s-1))!='\n'){s+=L; goto SearchAgain2;} //valname must be at begining of a line!
    s+=L;                                                   //found valname match, skip past it
    while(*s==' ' || *s == '\t'){s++;}                      //skip spaces and tabs
    if(!(*s)){SAFE_RETURN;}                                 //if NULL encounted do safe return
    if(*s != '='){goto SearchAgain2;}                       //no equal sign found after valname, search again
    s++;                                                    //skip past the equal sign
    while(*s==' '  || *s=='\t'){s++;}                       //skip spaces and tabs
    while(*s=='\"' || *s=='\''){s++;}                       //skip past quotes and ticks
    if(!(*s)){SAFE_RETURN;}                                 //if NULL encounted do safe return
    char* E = s;                                            //s is now the begining of the valname data
    while(*E!='\r' && *E!='\n' && *E!=0){E++;} E--;         //find end of line or end of string, then backup 1 char
    while(E > s && (*E==' ' || *E=='\t')){E--;}             //move backwards past spaces and tabs
    while(E > s && (*E=='\"' || *E=='\'')){E--;}            //move backwards past quotes and ticks
    L = E-s+1;                                              //length of string to extract NOT including NULL
    if(L<1 || L+1 > retbuflen){SAFE_RETURN;}                //empty string or buffer size too small
    strncpy(ret,s,L);                                       //copy the string
    ret[L]=0;                                               //null last char on return buffer
    RESTORE_E;
    return TRUE;

    #undef RESTORE_E
    #undef SAFE_RETURN
} 
```

如何使用...示例....

```
char sFileData[] = "[MySection]\r\n"
"MyValue1 = 123\r\n"
"MyValue2 = 456\r\n"
"MyValue3 = 789\r\n"
"\r\n"
"[MySection]\r\n"
"MyValue1 = Hello1\r\n"
"MyValue2 = Hello2\r\n"
"MyValue3 = Hello3\r\n"
"\r\n";
char str[256];
char* sSec = sFileData;
char secName[] = "[MySection]"; //we support sections with same name
while(sSec)//while we have a valid sNextSec
{
    //print values of the sections
    char* next=0;//in case we dont have any sucessful grabs
    if(GrabIniValue(sSec,secName,"MyValue1",str,sizeof(str),&next)) { printf("MyValue1 = [%s]\n",str); }
    if(GrabIniValue(sSec,secName,"MyValue2",str,sizeof(str),0))     { printf("MyValue2 = [%s]\n",str); }
    if(GrabIniValue(sSec,secName,"MyValue3",str,sizeof(str),0))     { printf("MyValue3 = [%s]\n",str); }
    printf("\n");
    sSec = next; //parse next section, next will be null if no more sections to parse
} 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2019-04-08T20:11:03.550

我最终使用了该线程中未提及的 inipp。

[https://github.com/mcmtrofaes/inipp](https://github.com/mcmtroffaes/inipp)

是仅获得 MIT 许可的标头实现，它非常简单，可以添加到项目中并使用 4 行代码。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-02-09T17:36:16.337

也许是一个迟到的答案..但是，值得了解的选项..如果您需要跨平台解决方案，绝对可以尝试 GLIB，它很有趣..（[https://developer.gnome.org/glib/stable/glib-键值文件解析器.html](https://developer.gnome.org/glib/stable/glib-Key-value-file-parser.html) )

# sql - 建立审计制度；SQL Server 后端上的 MS Access 前端

> ID：12638
> 
> 赞同：4
> 
> 时间：2008-08-15T19:35:13.313
> 
> 标签：sql, sql-server, ms-access, triggers

所以基本上我正在为我的公司构建一个应用程序，它需要使用 MS Access 构建，它需要在 SQL Server 上构建。

我已经制定了大部分计划，但很难找到处理审计系统的方法。

由于它仅在内部使用，您甚至无法从建筑物外部触摸数据库，我们没有使用登录系统，因为该程序只有在用户已经通过 Active 登录到我们的内部网络后才会使用目录。知道了这一点，我们正在使用[一个系统来自动检测 Active Directory 用户的名称](https://stackoverflow.com/questions/9052/is-there-a-way-for-ms-access-to-grab-the-current-active-directory-user)以及他们在其中一个数据库表中的权限，从而决定他们可以做什么或不可以做什么。

所以实际的审计表将有 3 列（这个设计可能会改变，但对于这个问题没关系）；谁（Active Directory 用户）、何时（添加/删除/编辑时间）、什么（更改了什么）

我的问题是我应该如何处理这个问题。理想情况下，我知道我应该使用触发器，以便在没有记录审计的情况下更新数据库，但是我不知道如何以这种方式获取 Active Directory 用户。另一种方法是将其直接编码到 Access 源中，以便每当发生变化时，我都会运行 INSERT 语句。显然这是有缺陷的，因为如果 Access 发生某些事情或数据库被其他东西触及，那么它将不会记录审计。

任何可能对我有帮助的建议、示例或文章将不胜感激！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-15T19:44:23.013

这对你有用吗？

```
 select user_name(),suser_sname() 
```

* * *

嗬！我忘了逃避我的代码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-15T20:52:27.900

好的，它在这里工作。更新表格时，我看到了我的 Windows 凭据。所以，我敢打赌我们错过了一步。让我把我所做的事情的 1,2,3 序列放在一起，也许我们可以找出这对你来说是什么地方。

* * *

1.  创建一个新的 MSAccess 数据库（空）
2.  点击表格部分
3.  选择外部数据
4.  选择 ODBC 数据库
5.  通过创建链接表来选择链接到数据源
6.  选择机器数据源
7.  选择新...
8.  系统数据源
9.  从列表中选择 SQL Server，然后单击 Next、Finish。
10.  为新数据源命名和描述，并为服务器选择（本地）。点击下一步。
11.  选择“使用网络登录 ID 进行 Windows NT 身份验证”。点击下一步。
12.  选中将默认数据库更改为，然后选择数据库。点击下一步。单击完成。
13.  测试数据源。
14.  选择与触发器关联的表，然后单击确定。
15.  在 Access 中打开表并修改其中一个条目（触发器不会在插入时触发，只是更新）
16.  从您的审计表中选择 *

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T23:24:36.363

我们还有一个专门在组织内使用的数据库系统，并使用 Window NT 登录。此函数返回当前用户的登录名：

```
CREATE FUNCTION dbo.UserName() RETURNS varchar(50)
AS
    BEGIN
    RETURN  (SELECT nt_username FROM master.dbo.sysprocesses WHERE spid = @@SPID)
    END 
```

您可以在触发器中使用此功能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-15T19:53:32.167

如果您在与 Sql 的连接字符串中指定 SSPI，我认为您的 Windows 凭据已提供。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-15T20:07:23.950

我试着玩一下 Access，看看能不能找到适合你的方法。我认为您可以为您的 SQL 表指定一个新的数据源，然后选择 Windows NT 身份验证作为您的连接类型。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-15T20:14:30.097

当然 ：）

Access 中应该有一个名为“外部数据”的部分（我正在运行新版本的 Access，因此菜单选择可能会有所不同）。

形成这个应该有一个选项来指定一个 ODBC 连接。

我可以通过创建链接表来链接到数据源。

然后我创建了一个机器数据源。我从下拉列表中选择了 SqlServer。然后，当我单击下一步时，系统会提示我如何进行身份验证。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-15T20:46:22.840

```
CREATE TRIGGER testtrigger1
ON testdatatable
AFTER update
AS 
BEGIN
    INSERT INTO testtable (datecol,usercol1,usercol2) VALUES (getdate(),user_name(),suser_sname());
END
GO 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T03:02:04.530

我的解决方案是不要让 Access 使用链接表修改数据。

我只会在 Access 中创建 UI，并使用在连接字符串中经过身份验证的 Windows 创建与服务器的 ADO 连接。将您的 Access 应用程序编译为 dbe 以保护 VB 代码。

我不会发出 SQL 语句，但我会调用存储过程来执行数据库中的更改，并在原子事务中创建审计日志条目。

UI（访问）不需要知道服务器上的内部工作。它需要做的就是使用您为此目的创建的存储过程请求和更新/插入/删除。服务器应该处理这项工作。

使用在服务器中实现的提示 NOLOCK 的视图通过 ADO 检索记录集，并将此数据缓存在 Access 中以供本地显示。或者检索单个记录并仅锁定该行以进行编辑。

使用链接表，您的用户将相互锁定。

使用 ADO 连接，您将不必在每个客户端上设置 ODBC。

创建一个表来设置服务器状态。您的应用程序将在任何操作之前对其进行检查。您可以使用它来关闭应用程序的服务器，以防您需要执行更改或维护。

访问是一个很棒的工具。但它应该只处理它的本地数据，而不是被允许与宝贵的服务器混为一谈。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-15T19:40:43.787

该应用程序将有多少用户？是否有可能使用 Windows 集成身份验证进行 SQL 身份验证？

**更新**：如果您可以为每个用户提供 SQL 登录名（集成 Windows），那么您可以使用 SYSTEM_USER 函数获取已登录的用户。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-15T19:49:23.300

它应该是

```
select user name(),suser sname() 
```

用下划线替换空格

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-08-15T20:02:55.533

您需要使用集成安全性即可信连接进行连接，请参阅 ( [http://www.connectionstrings.com/?carrier=sqlserver](http://www.connectionstrings.com/?carrier=sqlserver) )

# .net - 使用 Silverlight 2b2 上传二进制数据

> ID：12642
> 
> 赞同：4
> 
> 时间：2008-08-15T19:37:57.863
> 
> 标签：.net, silverlight

我正在尝试将文件或数据流上传到我们的网络服务器，但我找不到合适的方法。我都试过了`WebClient`，`WebRequest`两者都有问题。

**WebClient**
很好很简单，但是您没有收到任何异步上传已完成的通知，并且`UploadProgressChanged`事件不会被任何有用的回调。另一种方法是将二进制数据转换为字符串并使用`UploadStringASync`，因为至少你会得到一个`UploadStringCompleted`，问题是你需要大量的内存来存储大文件，因为它对所有数据进行编码并一次性上传。

**HttpWebRequest**
有点复杂，但仍然需要做，我得到的问题是，即使它是在后台线程上调用的（据说），它似乎仍然阻塞我的 UI 和整个浏览器，直到上传完成，这似乎没有完全正确。

普通 .net 确实有一些适当`WebClient`的方法用于[OnUploadDataCompleted](http://msdn.microsoft.com/en-us/library/system.net.webclient.onuploaddatacompleted.aspx)和进度，但这些在 Silverlight .net 中不可用……我认为这是一个很大的遗漏！

有没有人有任何解决方案，我需要上传多个二进制文件，最好有进度，但我需要在文件完成上传后执行一些操作。

期待一些帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-15T20:17:44.257

我解决它的方法是通过 INotifyPropertyChanged 和事件通知。

要点：

```
 public void DoIt(){
this.IsUploading = True;    

        WebRequest postRequest = WebRequest.Create(new Uri(ServiceURL));

        postRequest.BeginGetRequestStream(new AsyncCallback(RequestOpened), postRequest);
    }

private void RequestOpened(IAsyncResult result){
      WebRequest req = result.AsyncState as WebRequest;
   req.BeginGetResponse(new AsyncCallback(GetResponse), req);
    }

  private void GetResponse(IAsyncResult result)
        {
            WebRequest req = result.AsyncState as WebRequest;
              string  serverresult = string.Empty;
              WebResponse postResponse = req.EndGetResponse(result);

              StreamReader responseReader = new StreamReader(postResponse.GetResponseStream());

this.IsUploading= False;
}

 private Bool_IsUploading;
        public Bool IsUploading
        {
            get { return _IsUploading; }
          private  set
            {

                _IsUploading = value;

                OnPropertyChanged("IsUploading");
            }
        } 
```

由于双重和三重异步调用，现在 silverlight 是一个 PiTA。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-15T19:44:06.680

Matt Berseth 对此有一些想法，可能会有所帮助：

[http://mattberseth.com/blog/2008/07/aspnet_file_upload_with_realti_1.html](http://mattberseth.com/blog/2008/07/aspnet_file_upload_with_realti_1.html)

**@Dan** - 抱歉，伙计，我可以发誓马特的文章是关于 Silverlight 的，但显然不是。归咎于我刚刚喝下的那两大杯智利红。:-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-15T19:56:42.910

谢谢，我在这篇文章中看到的问题是它不是在谈论 Silverlight，而且 Silverlight 的功能有限，出于某种原因，他们无缘无故地删除了一些必要的二进制传输事件和方法。

我需要使用 Silverlight，因为我需要/想要上传多个文件，而 HTML 不允许上传多个文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-15T23:01:08.280

这几乎就是我正在做的事情，我遇到的问题是我的 UI 被锁定了。

正如您建议我已经在做的那样，我认为问题出在其他地方，所以我使用旧的分而治之来缩小问题范围，这不是实际的更新代码，这是我尝试**调度**更新进度条的请求在上传流代码期间。

感谢您的建议。

# perl - 如何判断一个变量在 Perl 中是否有数值？

> ID：12647
> 
> 赞同：95
> 
> 时间：2008-08-15T19:43:15.293
> 
> 标签：perl, numbers

Perl 中是否有一种简单的方法可以让我确定给定变量是否为数字？类似于以下内容：

```
if (is_number($x))
{ ... } 
```

将是理想的。`-w`在使用开关时不会发出警告的技术当然是首选。

* * *

## 回答 #1

> 赞同：143
> 
> 时间：2008-08-26T16:53:34.377

Use `Scalar::Util::looks_like_number()`which 使用内部Perl C API 的looks_like_number() 函数，这可能是最有效的方法。请注意，字符串“inf”和“infinity”被视为数字。

## 例子：

```
#!/usr/bin/perl

use warnings;
use strict;

use Scalar::Util qw(looks_like_number);

my @exprs = qw(1 5.25 0.001 1.3e8 foo bar 1dd inf infinity);

foreach my $expr (@exprs) {
    print "$expr is", looks_like_number($expr) ? '' : ' not', " a number\n";
} 
```

给出这个输出：

```
1 is a number
5.25 is a number
0.001 is a number
1.3e8 is a number
foo is not a number
bar is not a number
1dd is not a number
inf is a number
infinity is a number 
```

## 也可以看看：

*   [perldoc 标量::Util](http://perldoc.perl.org/Scalar/Util.html)
*   [perldoc perlapi](http://perldoc.perl.org/perlapi.html#SV-Body-Allocation)用于`looks_like_number`

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2010-09-27T17:16:12.517

最初的问题是如何判断一个变量是否为数字，而不是它是否“具有数值”。

有一些运算符对数字和字符串操作数有不同的操作模式，其中“数字”表示最初是数字或曾经在数字上下文中使用的任何内容（例如`$x = "123"; 0+$x`，在加法之前，`$x`是字符串，之后是被认为是数字）。

一种说法是这样的：

```
if ( length( do { no warnings "numeric"; $x & "" } ) ) {
    print "$x is numeric\n";
} 
```

如果启用了按位功能，即`&`仅生成数字运算符并添加单独的字符串`&.`运算符，则必须禁用它：

```
if ( length( do { no if $] >= 5.022, "feature", "bitwise"; no warnings "numeric"; $x & "" } ) ) {
    print "$x is numeric\n";
} 
```

（按位在 perl 5.022 及更高版本中可用，如果您`use 5.028;`或更高版本默认启用。）

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-08-15T21:01:16.790

查看 CPAN 模块[Regexp::Common](http://search.cpan.org/dist/Regexp-Common)。我认为它完全符合您的需要并处理所有边缘情况（例如实数、科学记数法等）。例如

```
use Regexp::Common;
if ($var =~ /$RE{num}{real}/) { print q{a number}; } 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-08-15T19:58:52.907

通常数字验证是​​使用正则表达式完成的。此代码将确定某些内容是否为数字，并检查未定义的变量以不引发警告：

```
sub is_integer {
   defined $_[0] && $_[0] =~ /^[+-]?\d+$/;
}

sub is_float {
   defined $_[0] && $_[0] =~ /^[+-]?\d+(\.\d+)?$/;
} 
```

这里有一些你应该看的[阅读材料。](http://www.perl.com/doc/FMTEYEWTK/is_numeric.html)

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2012-10-17T15:10:45.050

这个问题的一个简单（也许是简单化）的答案*是`$x`numeric*的内容如下：

```
if ($x  eq  $x+0) { .... } 
```

`$x`它对原始值与`$x`转换为数值的值进行文本比较。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-08-15T20:44:02.673

我不相信有任何内置的东西可以做到这一点。有关该主题的更多信息，请参阅[Perlmonks on Detecting Numeric](http://www.perlmonks.org/?node_id=408607)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-08-15T19:49:44.563

不完美，但您可以使用正则表达式：

```
sub isnumber 
{
    shift =~ /^-?\d+\.?\d*$/;
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-08-15T20:56:36.223

可以在[Regexp::Common](http://search.cpan.org/dist/Regexp-Common)中找到更强大的正则表达式。

听起来您想知道 Perl 是否认为变量是数字的。这是一个捕获该警告的函数：

```
sub is_number{
  my $n = shift;
  my $ret = 1;
  $SIG{"__WARN__"} = sub {$ret = 0};
  eval { my $x = $n + 1 };
  return $ret
} 
```

另一种选择是在本地关闭警告：

```
{
  no warnings "numeric"; # Ignore "isn't numeric" warning
  ...                    # Use a variable that might not be numeric
} 
```

请注意，非数字变量将被静默转换为 0，这可能是您想要的。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2010-12-10T18:58:12.393

rexep 不完美......这是：

```
use Try::Tiny;

sub is_numeric {
  my ($x) = @_;
  my $numeric = 1;
  try {
    use warnings FATAL => qw/numeric/;
    0 + $x;
  }
  catch {
    $numeric = 0;
  };
  return $numeric;
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-05-31T16:01:54.270

试试这个：

```
If (($x !~ /\D/) && ($x ne "")) { ... } 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-10-01T14:15:28.637

我发现这很有趣

```
if ( $value + 0 eq $value) {
    # A number
    push @args, $value;
} else {
    # A string
    push @args, "'$value'";
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-12-31T13:47:24.677

我个人认为要走的路是依靠 Perl 的内部上下文来使解决方案防弹。一个好的正则表达式可以匹配所有有效的数值，而不匹配任何非数值（反之亦然），但是由于有一种方法可以使用解释器正在使用的相同逻辑，因此直接依赖它应该更安全。

由于我倾向于使用 运行我的脚本`-w`，我不得不将“值加零”的结果与原始值进行比较的想法与`no warnings`@ysth 的基于方法相结合：

```
do { 
    no warnings "numeric";
    if ($x + 0 ne $x) { return "not numeric"; } else { return "numeric"; }
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-02-26T16:55:43.127

您可以使用正则表达式来确定 $foo 是否是一个数字（或不是）。

看看这里： [如何确定标量是否为数字](http://perldoc.perl.org/perlfaq4.html#How-do-I-determine-whether-a-scalar-is-a-number%2fwhole%2finteger%2ffloat%3f)

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2013-09-21T16:14:58.190

if ( 定义 $x && $x !~ m/\D/ ) {} 或 $x = 0 if ! $x; 如果 ( $x !~ m/\D/) {}

这与 Veekay 的回答略有不同，但让我解释一下我做出这种改变的理由。

对未定义的值执行正则表达式将导致错误溢出，并导致代码在许多（如果不是大多数）环境中退出。在运行表达式之前测试该值是否已定义或像我在替代示例中所做的那样设置默认情况，至少会保存您的错误日志。

# php - 可变参数/结果与准备好的语句绑定

> ID：12656
> 
> 赞同：9
> 
> 时间：2008-08-15T19:50:52.517
> 
> 标签：php, mysql, mysqli

在我即将结束的一个项目中，我为 PHP 编写并实现了一个对象关系映射解决方案。在怀疑者和梦想家大声喊出“到底是怎么回事？”之前，放松一下——我还没有找到一种方法来使后期的静态绑定起作用——我只是在以尽可能最好的方式解决它。

无论如何，我目前没有使用准备好的语句进行查询，因为我想不出一种方法来将可变数量的参数传递给`bind_params()`or`bind_result()`方法。

你问，为什么我需要支持可变数量的参数？因为我的模型的超类（将我的解决方案想象成一个被破解的 PHP ActiveRecord 崇拜者）是定义查询的地方，因此例如 find() 方法不知道它需要绑定多少参数.

现在，我已经考虑过构建一个参数列表并将一个字符串传递给 eval()，但我不太喜欢这种解决方案——我宁愿只实现自己的安全检查并传递语句。

有没有人对如何完成这项工作有任何建议（或成功案例）？如果你能帮我解决第一个问题，也许我们可以解决结果集的绑定问题（如果涉及到确定表结构的初始查询，我怀疑这会更困难，或者至少更耗费资源）。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-08-16T10:58:05.587

在 PHP 中，您可以使用[`call_user_func_array`](http://www.php.net/call_user_func_array). 一个方法的例子是：

```
call_user_func_array(array(&$stmt, 'bindparams'), $array_of_params); 
```

将调用该函数，并将数组中的每个成员作为其自己的参数传递。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2019-10-13T13:51:01.367

更现代的动态绑定参数的方法是通过 splat/spread 运算符 ( `...`)。

假设：

*   您有一个非空值数组要绑定到您的查询和
*   您的数组值在查询的上下文中被适当地处理为字符串类型值，并且
*   你的输入数组被称为`$values`

PHP5.6 及更高版本的代码：

```
$stmt->bind_param(str_repeat('s', count($values)), ...$values); 
```

事实上，`bind_param()`如果您愿意，可以使用 splat/spread 运算符解压缩所有输入的参数——数据类型字符串只需是数组的第一个元素。

```
array_unshift($values, str_repeat('s', count($values)));
$stmt->bind_param(...$values); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-08-30T09:03:23.973

您必须确保 $array_of_params 是**指向 variables 的链接**数组，而不是值本身。应该：

```
$array_of_params[0] = &$param_string; //link to variable that stores types 
```

进而...

```
$param_string .= "i";
$user_id_var = $_GET['user_id'];//
$array_of_params[] = &$user_id_var; //link to variable that stores value 
```

否则（如果它是值数组）你会得到：

> PHP 警告：mysqli_stmt::bind_param() 的参数 2 应为参考

* * *

再举一个例子：

```
$bind_names[] = implode($types); //putting types of parameters in a string
for ($i = 0; $i < count($params); $i++)
{
   $bind_name = 'bind'.$i; //generate a name for variable bind1, bind2, bind3...
   $$bind_name = $params[$i]; //create a variable with this name and put value in it
   $bind_names[] = & $$bind_name; //put a link to this variable in array
} 
```

和 BOOOOOM：

```
call_user_func_array( array ($stmt, 'bind_param'), $bind_names); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T05:45:35.987

我不允许编辑，但我相信代码

```
call_user_func_array(array(&$stmt, 'bindparams'), $array_of_params); 
```

$stmt 前面的引用不是必须的。由于`$stmt`是对象并且`bindparams`是该对象中的方法，因此不需要引用。它应该是：

```
call_user_func_array(array($stmt, 'bindparams'), $array_of_params); 
```

有关更多信息，请参阅有关[回调函数](http://au2.php.net/manual/en/language.pseudo-types.php#language.types.callback)的 PHP 手册。”

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-04-04T20:11:05.623

```
call_user_func_array(array(&$stmt, 'bindparams'), $array_of_params); 
```

在我的环境中对我不起作用，但这个答案让我走上了正轨。实际起作用的是：

```
$sitesql = '';
$array_of_params = array();
foreach($_POST['multiselect'] as $value){
    if($sitesql!=''){
        $sitesql .= "OR siteID=? ";
        $array_of_params[0] .= 'i';
        $array_of_params[] = $value;
    }else{
        $sitesql = " siteID=? ";
        $array_of_params[0] .= 'i';
        $array_of_params[] = $value;
    }
}

$stmt = $linki->prepare("SELECT IFNULL(SUM(hours),0) FROM table WHERE ".$sitesql." AND week!='0000-00-00'");
call_user_func_array(array(&$stmt, 'bind_param'), $array_of_params);
$stmt->execute(); 
```

# asp.net - 我可以使用动态 GroupItemCount 创建 ListView 吗？

> ID：12657
> 
> 赞同：2
> 
> 时间：2008-08-15T19:51:05.417
> 
> 标签：asp.net, .net-3.5, listview

我正在使用新的 ASP.Net ListView 控件来列出数据库项，这些数据库项将根据它们的列之一按部分分组，如下所示：

```
region1
    store1
    store2
    store3
region2
    store4
region3
    store5
    store6 
```

这可能与 ListView 的 GroupItemTemplate 有关吗？我看到的每个示例都使用每个组的静态项目数，这对我不起作用。我是否误解了 GroupItem 的目的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-15T20:56:08.033

我没有使用过 GroupItemCount，但我采用了[Matt Berseth](http://mattberseth.com/)编写的题为“[使用 ASP.NET 3.5 LinqDataSource 和 ListView 控件构建分组网格](http://mattberseth.com/blog/2008/01/building_a_grouping_grid_with.html)”的示例，并按照您的需要通过键对项目进行了分组。

它涉及使用外部和内部 ListView 控件。效果很好，试试看。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-01-23T04:12:35.680

确保在设置 GroupItemCount 属性**之后执行 DataBind。**我有同样的问题，这就是我为解决它所做的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-27T15:44:08.073

我尝试以编程方式使用 GroupItemCount，但它没有给我预期的结果。

我按照 Otto 的建议，实现了一个外部和内部的 ListView 控件。这似乎是最好的可用解决方案。

# php - PHP 中高效的 JPEG 图像大小调整

> ID：12661
> 
> 赞同：84
> 
> 时间：2008-08-15T19:55:17.000
> 
> 标签：php, image, gd, jpeg

在 PHP 中调整大图像大小的最有效方法是什么？

我目前正在使用[GD](http://en.wikipedia.org/wiki/GD_Graphics_Library)函数 imagecopyresampled 来获取高分辨率图像，并将它们干净地调整为 Web 查看的大小（大约 700 像素宽 x 700 像素高）。

这对小型（小于 2 MB）照片非常有效，整个调整大小操作在服务器上花费的时间不到一秒。但是，该网站最终将为可能上传最大 10 MB 的图像（或最大 5000x4000 像素的图像）的摄影师提供服务。

对大图像执行这种调整大小操作往往会大大增加内存使用量（更大的图像可能会使脚本的内存使用量超过 80 MB）。有什么方法可以使这个调整大小操作更有效？我应该使用其他图像库，例如[ImageMagick](http://en.wikipedia.org/wiki/ImageMagick)吗？

现在，调整大小的代码看起来像这样

```
function makeThumbnail($sourcefile, $endfile, $thumbwidth, $thumbheight, $quality) {
    // Takes the sourcefile (path/to/image.jpg) and makes a thumbnail from it
    // and places it at endfile (path/to/thumb.jpg).

    // Load image and get image size.
    $img = imagecreatefromjpeg($sourcefile);
    $width = imagesx( $img );
    $height = imagesy( $img );

    if ($width > $height) {
        $newwidth = $thumbwidth;
        $divisor = $width / $thumbwidth;
        $newheight = floor( $height / $divisor);
    } else {
        $newheight = $thumbheight;
        $divisor = $height / $thumbheight;
        $newwidth = floor( $width / $divisor );
    }

    // Create a new temporary image.
    $tmpimg = imagecreatetruecolor( $newwidth, $newheight );

    // Copy and resize old image into new image.
    imagecopyresampled( $tmpimg, $img, 0, 0, 0, 0, $newwidth, $newheight, $width, $height );

    // Save thumbnail into a file.
    imagejpeg( $tmpimg, $endfile, $quality);

    // release the memory
    imagedestroy($tmpimg);
    imagedestroy($img); 
```

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-08-15T22:08:38.993

人们说 ImageMagick 快得多。充其量只是比较两个库并进行衡量。

1.  准备 1000 张典型图像。
2.  编写两个脚本——一个用于 GD，一个用于 ImageMagick。
3.  运行它们几次。
4.  比较结果（总执行时间、CPU 和 I/O 使用情况、结果图像质量）。

别人最好的东西，对你来说不可能是最好的。

另外，在我看来，ImageMagick 有更好的 API 接口。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-08-15T21:50:18.423

这是我在项目中使用的 php.net 文档中的一个片段，并且工作正常：

```
<?
function fastimagecopyresampled (&$dst_image, $src_image, $dst_x, $dst_y, $src_x, $src_y, $dst_w, $dst_h, $src_w, $src_h, $quality = 3) {
    // Plug-and-Play fastimagecopyresampled function replaces much slower imagecopyresampled.
    // Just include this function and change all "imagecopyresampled" references to "fastimagecopyresampled".
    // Typically from 30 to 60 times faster when reducing high resolution images down to thumbnail size using the default quality setting.
    // Author: Tim Eckel - Date: 09/07/07 - Version: 1.1 - Project: FreeRingers.net - Freely distributable - These comments must remain.
    //
    // Optional "quality" parameter (defaults is 3). Fractional values are allowed, for example 1.5\. Must be greater than zero.
    // Between 0 and 1 = Fast, but mosaic results, closer to 0 increases the mosaic effect.
    // 1 = Up to 350 times faster. Poor results, looks very similar to imagecopyresized.
    // 2 = Up to 95 times faster.  Images appear a little sharp, some prefer this over a quality of 3.
    // 3 = Up to 60 times faster.  Will give high quality smooth results very close to imagecopyresampled, just faster.
    // 4 = Up to 25 times faster.  Almost identical to imagecopyresampled for most images.
    // 5 = No speedup. Just uses imagecopyresampled, no advantage over imagecopyresampled.

    if (empty($src_image) || empty($dst_image) || $quality <= 0) { return false; }
    if ($quality < 5 && (($dst_w * $quality) < $src_w || ($dst_h * $quality) < $src_h)) {
        $temp = imagecreatetruecolor ($dst_w * $quality + 1, $dst_h * $quality + 1);
        imagecopyresized ($temp, $src_image, 0, 0, $src_x, $src_y, $dst_w * $quality + 1, $dst_h * $quality + 1, $src_w, $src_h);
        imagecopyresampled ($dst_image, $temp, $dst_x, $dst_y, 0, 0, $dst_w, $dst_h, $dst_w * $quality, $dst_h * $quality);
        imagedestroy ($temp);
    } else imagecopyresampled ($dst_image, $src_image, $dst_x, $dst_y, $src_x, $src_y, $dst_w, $dst_h, $src_w, $src_h);
    return true;
}
?> 
```

[http://us.php.net/manual/en/function.imagecopyresampled.php#77679](http://us.php.net/manual/en/function.imagecopyresampled.php#77679)

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-08-15T20:53:14.903

[phpThumb](http://phpthumb.sourceforge.net/)尽可能使用 ImageMagick 来提高速度（必要时回退到 GD），并且似乎缓存得很好以减少服务器上的负载。试用它非常轻巧（要调整图像大小，只需使用包含图形文件名和输出尺寸的 GET 查询调用 phpThumb.php），因此您可以试一试，看看它是否满足您的需求。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2011-01-06T09:15:58.990

对于较大的图像，使用 libjpeg 在 ImageMagick 中调整图像加载大小，从而显着减少内存使用并提高性能，而 GD 则无法实现。

```
$im = new Imagick();
try {
  $im->pingImage($file_name);
} catch (ImagickException $e) {
  throw new Exception(_('Invalid or corrupted image file, please try uploading another image.'));
}

$width  = $im->getImageWidth();
$height = $im->getImageHeight();
if ($width > $config['width_threshold'] || $height > $config['height_threshold'])
{
  try {
/* send thumbnail parameters to Imagick so that libjpeg can resize images
 * as they are loaded instead of consuming additional resources to pass back
 * to PHP.
 */
    $fitbyWidth = ($config['width_threshold'] / $width) > ($config['height_threshold'] / $height);
    $aspectRatio = $height / $width;
    if ($fitbyWidth) {
      $im->setSize($config['width_threshold'], abs($width * $aspectRatio));
    } else {
      $im->setSize(abs($height / $aspectRatio), $config['height_threshold']);
    }
    $im->readImage($file_name);

/* Imagick::thumbnailImage(fit = true) has a bug that it does fit both dimensions
 */
//  $im->thumbnailImage($config['width_threshold'], $config['height_threshold'], true);

// workaround:
    if ($fitbyWidth) {
      $im->thumbnailImage($config['width_threshold'], 0, false);
    } else {
      $im->thumbnailImage(0, $config['height_threshold'], false);
    }

    $im->setImageFileName($thumbnail_name);
    $im->writeImage();
  }
  catch (ImagickException $e)
  {
    header('HTTP/1.1 500 Internal Server Error');
    throw new Exception(_('An error occured reszing the image.'));
  }
}

/* cleanup Imagick
 */
$im->destroy(); 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2013-10-30T06:28:47.877

从您的问题来看，您似乎对GD有点陌生，我将分享一些我的经验，也许这有点离题，但我认为这对像您这样的GD新手会有所帮助：

**第 1 步，验证文件。**使用以下函数检查`$_FILES['image']['tmp_name']`文件是否为有效文件：

```
 function getContentsFromImage($image) {
      if (@is_file($image) == true) {
         return file_get_contents($image);
      } else {
         throw new \Exception('Invalid image');
      }
   }
   $contents = getContentsFromImage($_FILES['image']['tmp_name']); 
```

**第 2 步，获取文件格式**尝试以下带有 finfo 扩展名的函数来检查文件（内容）的文件格式。你会说你为什么不只是`$_FILES["image"]["type"]`用来检查文件格式？因为它只检查文件扩展名而不是文件内容，如果有人将最初名为 world.png 的文件重命名*为 world.jpg* **，**将*返回*jpeg而不是 png，因此可能会返回错误结果。*`$_FILES["image"]["type"]``$_FILES["image"]["type"]`*

 *```
 function getFormatFromContents($contents) {
      $finfo = new \finfo();
      $mimetype = $finfo->buffer($contents, FILEINFO_MIME_TYPE);
      switch ($mimetype) {
         case 'image/jpeg':
            return 'jpeg';
            break;
         case 'image/png':
            return 'png';
            break;
         case 'image/gif':
            return 'gif';
            break;
         default:
            throw new \Exception('Unknown or unsupported image format');
      }
   }
   $format = getFormatFromContents($contents); 
```

**Step.3、获取GD**资源 从我们之前的内容中获取GD资源：

```
 function getGDResourceFromContents($contents) {
      $resource = @imagecreatefromstring($contents);
      if ($resource == false) {
         throw new \Exception('Cannot process image');
      }
      return $resource;
   }
   $resource = getGDResourceFromContents($contents); 
```

**第 4 步，获取图像尺寸**现在您可以使用以下简单代码获取图像尺寸：

```
 $width = imagesx($resource);
  $height = imagesy($resource); 
```

**现在，**让我们看看我们从原始图像中得到了什么变量：

```
 $contents, $format, $resource, $width, $height
       OK, lets move on 
```

**第5步，计算调整大小的图像参数**这一步与你的问题有关，以下函数的目的是为GD函数获取调整大小的参数`imagecopyresampled()`，代码有点长，但效果很好，它甚至有三个选项：拉伸，收缩, 并填充。

***拉伸***：输出图像的尺寸与您设置的新尺寸相同。不会保持高/宽比。

***收缩***：输出图像的尺寸不会超过你给的新尺寸，并保持图像的高/宽比。

***填充***：输出图像的尺寸将与您提供的新尺寸相同，如果需要，它将***裁剪和调整***图像大小，并保持图像的高/宽比。**此选项是您在问题中需要的。**

```
 function getResizeArgs($width, $height, $newwidth, $newheight, $option) {
      if ($option === 'stretch') {
         if ($width === $newwidth && $height === $newheight) {
            return false;
         }
         $dst_w = $newwidth;
         $dst_h = $newheight;
         $src_w = $width;
         $src_h = $height;
         $src_x = 0;
         $src_y = 0;
      } else if ($option === 'shrink') {
         if ($width <= $newwidth && $height <= $newheight) {
            return false;
         } else if ($width / $height >= $newwidth / $newheight) {
            $dst_w = $newwidth;
            $dst_h = (int) round(($newwidth * $height) / $width);
         } else {
            $dst_w = (int) round(($newheight * $width) / $height);
            $dst_h = $newheight;
         }
         $src_x = 0;
         $src_y = 0;
         $src_w = $width;
         $src_h = $height;
      } else if ($option === 'fill') {
         if ($width === $newwidth && $height === $newheight) {
            return false;
         }
         if ($width / $height >= $newwidth / $newheight) {
            $src_w = (int) round(($newwidth * $height) / $newheight);
            $src_h = $height;
            $src_x = (int) round(($width - $src_w) / 2);
            $src_y = 0;
         } else {
            $src_w = $width;
            $src_h = (int) round(($width * $newheight) / $newwidth);
            $src_x = 0;
            $src_y = (int) round(($height - $src_h) / 2);
         }
         $dst_w = $newwidth;
         $dst_h = $newheight;
      }
      if ($src_w < 1 || $src_h < 1) {
         throw new \Exception('Image width or height is too small');
      }
      return array(
          'dst_x' => 0,
          'dst_y' => 0,
          'src_x' => $src_x,
          'src_y' => $src_y,
          'dst_w' => $dst_w,
          'dst_h' => $dst_h,
          'src_w' => $src_w,
          'src_h' => $src_h
      );
   }
   $args = getResizeArgs($width, $height, 150, 170, 'fill'); 
```

**第六步，调整图片大小**使用我们从上面得到的`$args`, `$width`, `$height`,和 $resource 到下面的函数中，得到调整后图片的新资源：`$format`

```
 function runResize($width, $height, $format, $resource, $args) {
      if ($args === false) {
         return; //if $args equal to false, this means no resize occurs;
      }
      $newimage = imagecreatetruecolor($args['dst_w'], $args['dst_h']);
      if ($format === 'png') {
         imagealphablending($newimage, false);
         imagesavealpha($newimage, true);
         $transparentindex = imagecolorallocatealpha($newimage, 255, 255, 255, 127);
         imagefill($newimage, 0, 0, $transparentindex);
      } else if ($format === 'gif') {
         $transparentindex = imagecolorallocatealpha($newimage, 255, 255, 255, 127);
         imagefill($newimage, 0, 0, $transparentindex);
         imagecolortransparent($newimage, $transparentindex);
      }
      imagecopyresampled($newimage, $resource, $args['dst_x'], $args['dst_y'], $args['src_x'], $args['src_y'], $args['dst_w'], $args['dst_h'], $args['src_w'], $args['src_h']);
      imagedestroy($resource);
      return $newimage;
   }
   $newresource = runResize($width, $height, $format, $resource, $args); 
```

**第七步，获取新内容**，使用以下函数从新的GD资源中获取内容：

```
 function getContentsFromGDResource($resource, $format) {
      ob_start();
      switch ($format) {
         case 'gif':
            imagegif($resource);
            break;
         case 'jpeg':
            imagejpeg($resource, NULL, 100);
            break;
         case 'png':
            imagepng($resource, NULL, 9);
      }
      $contents = ob_get_contents();
      ob_end_clean();
      return $contents;
   }
   $newcontents = getContentsFromGDResource($newresource, $format); 
```

**步骤 8 获取扩展名**，使用以下函数获取图片格式的扩展名（注意，图片格式不等于图片扩展名）：

```
 function getExtensionFromFormat($format) {
      switch ($format) {
         case 'gif':
            return 'gif';
            break;
         case 'jpeg':
            return 'jpg';
            break;
         case 'png':
            return 'png';
      }
   }
   $extension = getExtensionFromFormat($format); 
```

**步骤 9 保存图像**如果我们有一个名为 mike 的用户，您可以执行以下操作，它将保存到与此 php 脚本相同的文件夹中：

```
$user_name = 'mike';
$filename = $user_name . '.' . $extension;
file_put_contents($filename, $newcontents); 
```

**Step 10 销毁资源**别忘了销毁GD资源！

```
imagedestroy($newresource); 
```

或者您可以将所有代码写入一个类，并简单地使用以下内容：

```
 public function __destruct() {
      @imagedestroy($this->resource);
   } 
```

**尖端**

**我建议不要转换用户上传的文件格式，你会遇到很多问题。**

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-04-04T08:25:53.690

我建议您按照以下方式工作：

1.  对上传的文件执行 getimagesize( ) 以检查图像类型和大小
2.  将任何上传的小于 700x700 像素的 JPEG 图像“按原样”保存到目标文件夹
3.  使用 GD 库处理中等大小的图像（代码示例请参见本文：[使用 PHP 和 GD 库调整图像大小](http://salman-w.blogspot.com/2008/10/resize-images-using-phpgd-library.html)）
4.  使用 ImageMagick 处理大图像。如果您愿意，可以在后台使用 ImageMagick。

要在后台使用 ImageMagick，请将上传的文件移动到临时文件夹并安排一个 CRON 作业，将所有文件“转换”为 jpeg 并相应地调整它们的大小。参见命令语法：[imagemagick-command line processing](http://www.imagemagick.org/script/command-line-processing.php)

您可以提示用户文件已上传并计划处理。CRON 作业可以安排为每天以特定的时间间隔运行。处理后可以删除源图像，以确保图像不被处理两次。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-02-15T13:21:05.543

我听说过有关 Imagick 库的大事，不幸的是，我无法将它安装在我的工作计算机上，也不能在家里安装（相信我，我在各种论坛上花了好几个小时）。

后记，我决定试试这个 PHP 类：

[http://www.verot.net/php_class_upload.htm](http://www.verot.net/php_class_upload.htm)

这很酷，我可以调整各种图像的大小（我也可以将它们转换为 JPG）。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-11-30T05:37:32.817

ImageMagick 是多线程的，所以它看起来更快，但实际上比 GD 使用更多的资源。如果您使用 GD 并行运行多个 PHP 脚本，那么它们的简单操作速度会超过 ImageMagick。ExactImage 不如 ImageMagick 强大，但速度要快得多，虽然不能通过 PHP 获得，但您必须将其安装在服务器上并通过`exec`.

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-06-05T18:40:02.707

对于较大的图像，请使用[phpThumb()](http://phpthumb.sourceforge.net/)。以下是如何使用它：[http](http://abcoder.com/php/problem-with-resizing-corrupted-images-using-php-image-functions/) ://abcoder.com/php/problem-with-resizing-corrupted-images-using-php-image-functions/ 。它也适用于大型损坏的图像。*

# language-agnostic - 开始 Web 开发的资源？

> ID：12669
> 
> 赞同：14
> 
> 时间：2008-08-15T20:00:28.660
> 
> 标签：language-agnostic

假设我今天醒来，想创建一个 StackOverflow.com 的克隆，并获得数百万美元的 0.02 美元广告点击的财务意外之财。我从哪里开始？

我对网络技术的理解是：

*   HTML 是最终显示的内容
*   CSS 是一种使 HTML 看起来令人愉悦的机制
*   ASP.NET 允许您使用 .NET(?) 添加功能
*   JavaScript 做事
*   AJAX 做异步的事情
*   ... 而这样的例子不胜枚举！

要写一个好的网站，我只需要买七本书并全部阅读？Web 2.0 网站真的是所有这些技术的协同作用吗？

有人从哪里开始创建具有专业外观的网站，以及沿途有哪些步骤。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-08-15T20:11:40.667

虽然我的知识主要基于使用互联网搜索我想知道的内容（w3schools.com 帮助了很多，A List Apart 也提供了很多帮助），但一些好书在此过程中帮助了我，尽管它们一直是特定于平台/语言的，所以除非有人好奇，否则我会避免提及它们。至少对我来说，打开一本书这样我就不必调整窗口大小或在它们之间切换是非常有价值的。

您列表的第一部分还可以，但最后几项需要调整。ASP.NET 将*服务器端*功能（大部分）添加到您的应用程序中。它存在于浏览器之外，因此非常强大并且可以轻松地与各种最终用户共享。

服务器端处理的问题（有人说）是，当您要求执行某个操作时，您的应用程序必须发出新的 HTTP 请求。因此，如果您单击指向产生一组新数据的页面的链接，您不会立即获得结果。页面重新加载，或加载单独的页面。

Javascript 在一定程度上解决了这个问题——它允许您即时响应用户输入。您想在用户单击按钮时显示两个数字的总和吗？你可以用Javascript来做。

Javascript 的问题在于它不能直接与数据库对话，或探索服务器的文件系统，或其他类似的东西。它存在于浏览器中——时期。

AJAX 在您的用户浏览器和您的服务器之间架起了一座桥梁。使用 AJAX，*Javascript*在不刷新页面或加载新页面的情况下发出 HTTP 请求。Javascript 与服务器端脚本（不一定是 ASP，也可以与 PHP、Rails、Coldfusion 等一起使用）对话并发送和接收信息。而且由于 Javascript 不依赖于页面加载，一个快速、快速的 AJAX 脚本几乎可以给人一种普通桌面应用程序的感觉，在这种应用程序中，您在对应用程序的数据执行简单操作时不必等待 HTTP 请求。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-08-15T20:18:46.860

我认为这一系列[Opera 文章](http://www.opera.com/wsc/)会让您对 Web 标准和 Web 开发的基本概念有一个很好的了解。

*2014 年更新*：Opera 文档于 2012 年重新定位到[webplatform.org](http://webplatform.org)的这一部分：

[http://docs.webplatform.org/wiki/Main_Page](http://docs.webplatform.org/wiki/Main_Page)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-18T19:39:33.660

伊恩的回答很有分量。您可以购买所有这些书籍并阅读它们，而对 Web 开发一无所知。你真正需要做的就是从没有 Stack Overflow 这么大的东西开始。从您的个人网站开始。阅读[列表中的](http://www.alistapart.com/)一些 web dev/css 文章。了解文档类型以及使用它们的原因。添加一些 css 并更改周围的颜色。转到[quirksmode](http://www.quirksmode.org/)并仔细阅读该网站。添加一些js。关注[Crockfords 网站](http://www.crockford.com/)上的一些链接。您可能会偶然发现他的精彩视频讲座，您应该观看。然后回到你写的所有js并重写它。然后选择您想学习的服务器端语言。[Python](http://python.org)很容易，但你选择什么并不重要。然后回来将所有这些整合到您的站点中。在这一点上，您至少会开始使用 Web 开发，并且会使用多种不同的技术。

**编辑：**我忘了提。**阅读书籍**。

过去与我合作过的许多开发人员在他们的职业生涯中都没有真正进步。我可能完全错了，但我将其归因于没有阅读足够的书籍并依赖于一遍又一遍地使用相同的错误代码。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-15T23:55:01.713

你可以出去买一堆书并开始阅读，然后很快就会被看似巨大的学习曲线所淹没成为。

或者，我的建议是，您可以定义一个要解决的问题，然后着手寻找该问题的解决方案。从小事做起。“我有一个问题：我没有关于我自己的网站。”。定义你需要做什么来解决这个问题，学习基础知识，然后去做。然后，定义一个新问题，它可能依赖于第一个问题的解决方案，找到你需要做的事情，然后去做。

这就是所有技术专业人员的发展方式。我的第一个网站是一个只有文字的个人网站。然后我添加了一些笑话和一些电影名言。然后我厌倦了人工处理所有更新，我学会了如何将它们放入数据库并从数据库中检索它们以进行显示。它会一直持续下去。

当你从你的意外之财中得到的钱多到你不知道该怎么处理时，请打电话给我。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-08-21T15:40:06.733

如果您真的只想双脚跳入，我建议您查看 Adob​​e 的 ColdFusion。开发者版是免费的，可以在 windows、os x 和 linux 上运行。文档是权威且广泛的，有一个非常活跃的开发者社区，只有几本书你可能想深入研究。权威指南是一系列书籍，可在[亚马逊上找到](https://rads.stackoverflow.com/amzn/click/com/032151548X)

ColdFusion 的好处是您可以将其用作其他语言的垫脚石，并在此过程中保持高效。您甚至可以将它与 Java 混合在一起，因为它本身是用 Java 编写的。还有很多内置的好东西，你必须在网上搜索或用其他语言支付更多费用。诸如全文索引、图形、服务器监控、基于 ajax 的控件、flash/flex 集成、异步操作系统调用等。

您甚至可以选择构建面向对象的代码或过程代码，尽管有些人不会认为这是一种好处。不过，这些人很少就哪种风格应该获胜达成一致。

干杯!

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-29T12:00:01.363

我认为 sitepoint 是学习 Web 开发最佳实践的最佳资源。他们有[很棒的文章](http://www.sitepoint.com/recentarticles/)、[很好的参考资料](http://reference.sitepoint.com/)，并且可能是[最好的论坛](http://www.sitepoint.com/forums/)之一。但是那里的人可能有点脾气暴躁。;) 如果你是一个真正的书呆子，阅读 HTML 5 和 CSS 的规范也是一个很好的学习方式。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-19T10:16:15.903

我和伊恩在这件事上。读书固然很好，但没有什么比陷入困境更好的了。实际上，早在 1999 年，我就从 ASP 傻瓜指南（那将是“经典” ASP）开始。

如果我今天要从头开始，我会寻找涵盖完整堆栈解决方案的东西，无论是 Apache/PHP/MySQL、RoR 还是其他。

ATM 我没有使用 Rails 的经验，但它可能是一个很好的起点，因为它包含很多你必须尽早弄清楚的东西（与 Scriptaculous，一个 JS 框架集成）——你总是可以稍后了解幕后发生的事情。

.NET 始终是一种选择，如果您对 Visual Studio 感到满意，它可能是您的最佳选择，但除此之外它不是最容易上手的。

如果您了解一点 HTML，但对服务器端编程基本上是新手，您可能会看看 ColdFusion。它实际上非常强大，并且像 Rails 一样包含许多“开箱即用”的好处。[有一家名为Railo](http://www.railo.ch)的瑞士公司目前正在发布一个隶属于 JBoss 的开源 ColdFusion 引擎。

最后也是最重要的 - 不要忘记数据库！迟早你需要掌握一些非常严肃的SQL......

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-29T11:54:37.147

CFML（又名“ColdFusion”，尽管它真的是 Adob​​e 产品，而不是语言）绝对容易学习，如果你想要 CFML 的 FOSS，除了 Railo，你还可以使用[Open BlueDragon](http://openbluedragon.org)，它是一个 GPL CFML 引擎。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-29T12:02:01.203

使用 Web 标准进行设计是一本很棒的入门读物！

[http://www.zeldman.com/dwws/](http://www.zeldman.com/dwws/)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-15T20:08:55.973

我会推荐这本书：
[http ://www.amazon.com/MCTS-Self-Paced-Training-Exam-70-528/dp/0735623341/ref=sr_1_1?ie=UTF8&s=books&qid=1218830714&sr=8-1](https://rads.stackoverflow.com/amzn/click/com/0735623341)

刚考完才看完，虽然知道网络理论部分，但觉得很有价值。
这当然是一本特定于 ASP.NET 的书，但无论如何我都建议学习。

在你学习了所有 ASP.NET 的东西之后，我建议你阅读一下[JQuery](http://jquery.com/)。

快乐编码:)

# c# - 如何将数据从 aspx 页面传递到 ascx 模式弹出窗口？

> ID：12671
> 
> 赞同：5
> 
> 时间：2008-08-15T20:01:23.010
> 
> 标签：c#, asp.net, asp.net-ajax

我对 ASP.NET 还很陌生，并试图了解事情是如何完成的。我来自 C# 背景，所以代码隐藏部分很容易，但像 Web 开发人员一样思考是不熟悉的。

我有一个包含复选框网格的 aspx 页面。我有一个通过 Button_Click 事件编码的按钮，用于收集检查哪些行的列表，并从该列表中创建一个会话变量。我的 ascx 页面的 ModalPopupExtender 引用了相同的按钮（通过 TargetControlID），它控制 ascx 页面上的面板。

单击按钮时，模式弹出窗口打开，但 Button_Click 事件从未触发，因此模式不会获取其会话数据。

由于这两个页面是分开的，我无法从 aspx.cs 代码调用 ModalPopupExtender，我无法从 ascx.cs 代码访问复选框列表，而且我看不到填充会话变量的方法然后以编程方式激活其他一些隐藏按钮或控件，然后打开我的模式弹出窗口。

有什么想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-15T20:25:28.017

所有 usercontrol(.ascx) 文件都是一组控件，您将它们组合在一起以提供一些可重用的功能。在页面生命周期期间，其中定义的控件仍会添加到页面的控件集合 (.aspx) 中。ModalPopupExtender 使用 javascript 和 dhtml 来显示和隐藏用户控件客户端中的控件。您所看到的是，ModalPoupExtender 正在客户端处理单击事件，并且它正在取消回发到服务器。这是设计的默认行为。您当然可以从用户控件的代码隐藏中访问页面的控件集合，因为它都是同一控件树的一部分。只需使用任何控件的 FindControl(xxx) 方法来搜索您需要的子控件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-18T14:50:46.117

在对 DancesWithBamboo 的回答进行了一些研究之后，我想出了如何让它发挥作用。
在我的 ascx 页面中对我的 ascx 页面的示例引用：

```
<uc1:ChildPage ID="MyModalPage" runat="server" /> 
```

获取并打开 ModalPopupExtender（名为 modalPopup）的 aspx 代码如下所示：

```
AjaxControlToolkit.ModalPopupExtender mpe = 
    (AjaxControlToolkit.ModalPopupExtender) 
          MyModalPage.FindControl("modalPopup");
mpe.Show(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-15T20:06:41.940

对不起，但我很困惑。你不能直接调用 ascx，所以......

您是从同一页面中调用的模态代码，例如隐藏面板等；

还是您在单击事件上调用的另一个 aspx 页面？

# asp.net - IronPython and ASP.NET

> ID：12692
> 
> 赞同：7
> 
> 时间：2008-08-15T20:17:49.450
> 
> 标签：asp.net, ironpython

Has anyone built a website with IronPython and ASP.NET. What were your experiences and is the combination ready for prime-time?

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-08-15T20:37:24.920

The current version of ASP.NET integration for IronPython is not very up-to-date and is more of a "proof-of-concept." I don't think I'd build a production website based on it.

**Edit:**: I have a very high level of expectation for how things like this should work, and might setting the bar a little high. Maybe you should take what's in "ASP.NET Futures", write a test application for it and see how it works for you. If you're successful, I'd like to hear about it. Otherwise, I think there should be a newer CTP of this in the next six months.

(I'm a developer on IronPython and IronRuby.)

**Edit 2:** Since I originally posted this, a [newer version](http://www.codeplex.com/aspnet/Wiki/View.aspx?title=Dynamic%20Language%20Support) has been released.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-27T08:41:47.340

Check out the [Dynamic Languages in ASP.NET](http://www.codeplex.com/aspnet/Wiki/View.aspx?title=Dynamic%20Language%20Support&referringTitle=Home) page on Codeplex. This has the newest IronPython bits. It doesn't give you any Visual Studio integration, other than the sample website project, but that's coming.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-21T20:48:29.923

Keep a look out for ASP.NET MVC

The IronRuby guys have got some internal builds of MVC to work with IronRuby, and IronPython 2 and IronRuby have a lot of code in common with the DLR.

I'm not sure if they'll support IronPython/IronRuby when MVC is released, but it's definitely worth keeping your eye on anyway - The old ASP.NET forms-based development model is old, busted, and the sooner it goes away the better.

# c# - 在 WCF/.NET 中返回数据表

> ID：12702
> 
> 赞同：51
> 
> 时间：2008-08-15T20:26:01.447
> 
> 标签：c#, .net, wcf, web-services, datatable

我有一个 WCF 服务，我想从中返回一个 DataTable。我知道这通常是一个备受争议的话题，就返回 DataTables 是否是一个好习惯而言。让我们把它放在一边。

当我从头开始创建 DataTable 时，如下所示，没有任何问题。该表已创建、填充并返回给客户端，一切正常：

```
[DataContract]
public DataTable GetTbl()
{
    DataTable tbl = new DataTable("testTbl");
    for(int i=0;i<100;i++)
    {
        tbl.Columns.Add(i);
        tbl.Rows.Add(new string[]{"testValue"});
    }
    return tbl;
} 
```

但是，我一出去打数据库创建表，如下所示，我得到一个 CommunicationException“底层连接已关闭：连接意外关闭。”

```
[DataContract]
public DataTable GetTbl()
{
    DataTable tbl = new DataTable("testTbl");
    //Populate table with SQL query

    return tbl;
} 
```

该表在服务器端正确填充。它比我循环并返回的测试表要小得多，而且查询小而快——这里没有超时或大数据传输的问题。正在使用相同的确切功能和 DataContracts/ServiceContracts/BehaviorContracts。

为什么表格的填充方式会对表格成功返回有任何影响？

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2008-09-03T19:14:32.540

对于任何有类似问题的人，我已经解决了我的问题。这是几倍的。

*   正如 Darren 建议和 Paul 支持的那样，需要扩大配置中的 Max..Size 属性。SvcTraceViewer 实用程序有助于确定这一点，但它并不总是提供最有用的错误消息。
*   似乎在客户端更新服务参考时，配置有时不会正确更新（例如，更改服务器上的配置值不会总是在客户端正确更新。我不得不进去更改 Max..在我的调试过程中，在客户端和服务器端多次调整属性）
*   要使 DataTable 可序列化，需要为其命名。默认构造函数没有给表命名，所以：

    ```
    return new DataTable(); 
    ```

    将不可序列化，而：

    ```
    return new DataTable("someName"); 
    ```

    将命名表作为参数传递的任何内容。

    请注意，可以随时通过将字符串分配给`TableName`DataTable 的属性来为表命名。

    ```
    var table = new DataTable();
    table.TableName = "someName"; 
    ```

希望这会对某人有所帮助。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-08-23T18:56:50.147

诊断这些类型的 WCF 错误（实际上并不能告诉您太多）的最佳方法是启用跟踪。在您的 web.config 文件中，添加以下内容：

```
 <system.diagnostics>
    <sources>
      <source name="System.ServiceModel" 
              switchValue="Information" 
              propagateActivity="true">
        <listeners>
          <add name="ServiceModelTraceListener" 
               type="System.Diagnostics.XmlWriterTraceListener, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" 
               initializeData="wcf-traces.svclog"/>
        </listeners>
      </source>
    </sources>
  </system.diagnostics> 
```

然后，您可以在 .NET Framework SDK（或 Visual Studio）中的 SvcTraceViewer.exe 实用程序中打开生成的文件。在我的机器上，可以在 %PROGRAMFILES%\Microsoft SDKs\Windows\v6.0A\Bin\SvcTraceViewer.exe 中找到它。

只需查找错误消息（以红色粗体显示），它将具体告诉您您的问题是什么。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-12-21T13:33:49.277

除了为所有绑定属性设置最大值之外。

确保您从 web 服务传递/返回的每个表都必须有一个表名，这意味着该`table.tablename`属性不应为空。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-10-24T08:29:51.093

我将Datable添加到数据集中并像这样返回表......

```
DataTable result = new DataTable("result");

//linq to populate the table

Dataset ds = new DataSet();
ds.Tables.Add(result);
return ds.Tables[0]; 
```

希望能帮助到你 ：）

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-08-15T20:35:00.977

您想要的属性是 OperationContract（在接口上）/ Operation Behavior（在方法上）：

```
[ServiceContract]
public interface ITableProvider
{
    [OperationContract]
    DataTable GetTbl();
}

[OperationBehavior]
public DataTable GetTbl(){
    DataTable tbl = new DataTable("testTbl");
    //Populate table with SQL query

    return tbl;
} 
```

另外，在...我认为服务配置...您要指定可以发送错误。您可能会遇到诸如消息大小过大等错误。您可以通过捏造读者配额等来解决此问题。

默认情况下，wsHttpBinding 的接收大小配额为 65 KB，因此如果序列化数据表的 XML 超过此值，则会引发错误（我 95% 确定数据表超过 65 KB，其中包含数据）。

`web.config`您可以在/中更改读者配额等的设置，`app.config`也可以在代码中的绑定实例上进行设置。但是，是的，如果您默认情况下没有更改它，那可能就是您的问题。

*[WSHttpBindingBase 成员](http://msdn.microsoft.com/en-us/library/system.servicemodel.wshttpbindingbase_members.aspx)*- 查看 ReaderQuotas 属性以及 MaxReceivedMessageSize 属性。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-24T13:33:35.373

您可能超出了配额 - 数据表大于您的连接允许的最大数据包大小。

您可能需要在连接上将**MaxReceivedMessageSize**和**MaxBufferSize**设置为更高的值。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-12-02T05:14:45.053

`datatable`与 WCF 服务一样，返回类型失败有 3 个原因

*   您必须指定数据表名称，例如：

    ```
    MyTable=new DataTable("tableName"); 
    ```

*   当您在 WCF 服务的客户端添加引用时，请选择可重用的 dll`system.data`

*   `datatable`在成员变量上指定属性，例如

    ```
    [DataMember]
    public DataTable MyTable{ get; set; } 
    ```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-02T14:18:57.300

我认为 Darren 很可能是正确的 - 为 WCF 提供的默认值小得可笑，如果碰到它们，最终会出现难以追踪的错误。当您尝试做任何超出简单测试用例的事情时，它们似乎就会出现。我浪费的时间比我想承认的调试问题要多，这些问题最终与客户端和服务器上的各种配置（大小）设置有关。我想我最终修改了几乎所有这些，例如。MaxBufferPoolSize、MaxBufferSize、MaxConnections、MaxReceivedMessageSize 等。

话虽如此，还提到的 SvcTraceViewer 实用程序很棒。我确实遇到了一些情况，它没有我希望的那么有用，但总的来说，它是分析通信流和错误的好工具。

# asp.net - 在 ASP.NET 中自定义编辑记录的最佳方式？

> ID：12706
> 
> 赞同：1
> 
> 时间：2008-08-15T20:30:37.663
> 
> 标签：asp.net

我来自 Rails 背景，在 ASP.NET 项目（不是 ASP MVC）上做一些工作。新手问题：为记录表制作自定义编辑器的最简单方法是什么？

例如：我有一堆数据行，并且想更改每个数据行上的“类别”字段——可能是一个下拉列表，可能是一个链接，可能是用户输入的。

在 Rails 中，我会遍历行来构建一个表，并且每行都有一个表单。该表单将有一个输入框或下拉列表，并将数据提交给像“/item/edit/15?category=foo”这样的控制器，其中 15 是 itemID，新类别是“foo”。

我是 ASP.NET 模型的新手，不确定执行此操作的“正确”方法——这只是取回新数据并将其保存的最简单方法。我会制作一个自定义控件并将其附加到每一行吗？任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-15T20:42:30.230

现在你真的可以作弊，看看 .NET 3.5 SP1 附带的新动态数据。Scott Guthrie 有一篇博客文章演示了它将如何快速和轻松地为您流动：

[http://weblogs.asp.net/scottgu/archive/2007/12/14/new-asp-net-dynamic-data-support.aspx](http://weblogs.asp.net/scottgu/archive/2007/12/14/new-asp-net-dynamic-data-support.aspx)

如果没有获得最先进的技术，我将使用 XSD 生成器来生成与相关表一致的强类型 DataSet。这还将生成可用于执行所有 CRUD 语句的 TableAdapter。

从那里，将其绑定到 DataGrid 并利用与之相关的所有标准模板/事件，例如 EditIndex、SelectedIndex、RowEditing、RowUpdated 等。

从 .NET 的早期 1.0 天开始，我就一直在这样做，并且随着框架的每次更新，这种功能只会变得越来越精简。

编辑：我也想对 Matt Berseth 博客快速点头。我一直在关注他的很多东西有一段时间了，这很棒！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-15T20:39:45.320

有一些控件可以为您执行此操作，其复杂程度取决于它们的相对灵活性。

执行此操作的传统方法是 DataGrid 控件，它为您提供表格布局。如果您想要外观更灵活的东西，DataList 和 ListView 控件还具有对编辑、插入或删除字段的内置支持。

查看[Matt Berseth 的博客](http://mattberseth.com/)，了解一些实际使用的 asp.net 控件的优秀示例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-15T23:11:50.100

谢谢你们的答案。看起来自定义 DataGrid 是要走的路。对于任何 ASP.NET 新手，这就是我正在做的

```
<asp:DataGrid ID="GridView1" runat="server" AutoGenerateColumns="False">
    <Columns>
        <asp:BoundColumn DataField="RuleID" Visible="False" HeaderText="RuleID"></asp:BoundColumn>
        <asp:TemplateColumn HeaderText="Category">
        <ItemTemplate>
            <!-- in case we want to display an image -->
            <asp:Literal ID="litImage" runat="server">
            </asp:Literal>
            <asp:DropDownList ID="categoryListDropdown" runat="server"></asp:DropDownList>
         </ItemTemplate>
        </asp:TemplateColumn>

    </Columns>
</asp:DataGrid> 
```

这将创建一个数据网格。然后我们可以将它绑定到数据源（在我的例子中是 DataTable）并使用类似的东西

```
foreach (DataGridItem item in this.GridView1.Items)
{
     DropDownList categoryListDropdown = ((DropDownList)item.FindControl("categoryListDropdown"));
     categoryListDropdown.Items.AddRange(listItems.ToArray());
} 
```

填充数据网格中的初始下拉列表。在这种情况下，您还可以访问 item.Cells[0].text 以获取 RuleID。

我自己的注意事项： ASP.NET 模型在代码隐藏文件中执行所有操作。在较高级别上，您始终可以遍历 GridView1.Items 以获取每一行，并通过 item.findControl("ControlID") 查询存储在每个项目中的值，例如在按下“更新”按钮之后。

# xml - 将 XmlNodeList 加载到 XmlDocument 中而不循环？

> ID：12709
> 
> 赞同：2
> 
> 时间：2008-08-15T20:33:33.833
> 
> 标签：xml, vb.net, xmldocument, xmlnode, xmlnodelist

[我最初在RefactorMyCode](http://refactormycode.com/codes/36-load-xmlnodelist-into-an-xmldocument)上问过这个问题，但那里没有得到任何回应......

基本上我只是尝试将一个加载`XmlNodeList`到一个`XmlDocument`中，我想知道是否有比循环更有效的方法。

```
Private Function GetPreviousMonthsXml(ByVal months As Integer, ByVal startDate As Date, ByVal xDoc As XmlDocument, ByVal path As String, ByVal nodeName As String) As XmlDocument
    '' build xpath string with list of months to return
    Dim xp As New StringBuilder("//")
    xp.Append(nodeName)
    xp.Append("[")
    For i As Integer = 0 To (months - 1)
      '' get year and month portion of date for datestring
      xp.Append("starts-with(@Id, '")
      xp.Append(startDate.AddMonths(-i).ToString("yyyy-MM"))
      If i < (months - 1) Then
        xp.Append("') or ")
      Else
        xp.Append("')]")
      End If
    Next

    '' *** This is the block that needs to be refactored ***
    '' import nodelist into an xmldocument
    Dim xnl As XmlNodeList = xDoc.SelectNodes(xp.ToString())
    Dim returnXDoc As New XmlDocument(xDoc.NameTable)
    returnXDoc = xDoc.Clone()
    Dim nodeParents As XmlNodeList = returnXDoc.SelectNodes(path)
    For Each nodeParent As XmlNode In nodeParents
      For Each nodeToDelete As XmlNode In nodeParent.SelectNodes(nodeName)
        nodeParent.RemoveChild(nodeToDelete)
      Next
    Next

    For Each node As XmlNode In xnl
      Dim newNode As XmlNode = returnXDoc.ImportNode(node, True)
      returnXDoc.DocumentElement.SelectSingleNode("//" & node.ParentNode.Name & "[@Id='" & newNode.Attributes("Id").Value.Split("-")(0) & "']").AppendChild(newNode)
    Next

    '' *** end ***
    Return returnXDoc
End Function 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-19T14:28:49.483

```
Dim returnXDoc As New XmlDocument(xDoc.NameTable)
returnXDoc = xDoc.Clone() 
```

这里的第一行是多余的——您正在创建一个 XmlDocument 的实例，然后重新分配变量：

```
Dim returnXDoc As XmlDocument = xDoc.Clone() 
```

这也是一样的。

看到您似乎将节点列表中的每个 XmlNode 插入到新 XmlDocument 中的不同位置，那么我看不出您如何以其他方式做到这一点。

您可以编写更快的 XPath 表达式，例如在 XPath 表达式前面加上“//”几乎总是最慢的方法，尤其是当您的 XML 结构良好时。您尚未显示您的 XML，因此我无法对此进一步发表评论。

# c# - .NET 进程外服务器的#import 问题

> ID：12716
> 
> 赞同：4
> 
> 时间：2008-08-15T20:40:11.980
> 
> 标签：c#, c++, com, interop

在 C++ 程序中，我正在尝试 #import TLB of .NET out-of-proc server。

我收到如下错误：

> z:\server.tlh(111) : 错误 C2146: 语法错误: 缺少 ';' 在标识符“GetType”之前
> 
> z:\server.tlh(111) : 错误 C2501: '_TypePtr' : 缺少存储类或类型说明符
> 
> z:\server.tli(74)：错误 C2143：语法错误：缺少“；” 在'标签::id'之前
> 
> z:\server.tli(74) : error C2433: '_TypePtr' : 'inline' 不允许在数据声明中使用
> 
> z:\server.tli(74)：错误 C2501：'_TypePtr'：缺少存储类或类型说明符
> 
> z:\server.tli(74) : 致命错误 C1004: 发现文件意外结尾

TLH 看起来像：

```
_bstr_t GetToString();
VARIANT_BOOL Equals (const _variant_t & obj);
long GetHashCode();
_TypePtr GetType();
long Open(); 
```

我对拥有基本对象 .NET 对象方法（如 GetType()、Equals() 等）并不真正感兴趣。但 GetType() 似乎会导致问题。

一些谷歌研究表明我可以`#import mscorlib.tlb`（或将其放入路径中），但我也无法编译。

有小费吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-04-28T17:17:27.517

```
#import "C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\mscorlib.tlb" 
```

是我的解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-15T21:06:51.660

在我的#import 中添加了 no_namespace 和 raw_interfaces_only：

```
#import "server.tlb" no_namespace named_guids 
```

也使用 TLBEXP.EXE 而不是 REGASM.EXE 似乎有助于解决这个问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T03:41:16.187

通常，当 MSVC 将 COM 源编译为 a`TLB`时，会留下如下提示：

```
#import "C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\mscorlib.tlb" 
```

您应该将其添加到`stdafx.h`该行之前

```
#import "your_own.tlb" 
```

之后，基本类型（如`_Type`, ）`_ObjRef`将添加到您的项目中以生成原型。

我希望这能解决你的问题。

但更大的问题是，一切都完成后，在程序中调用 Ptr 时可能会出现运行时错误

有人可以帮忙吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-01-15T13:36:14.040

看来你需要使用

```
[ClassInterface(ClassInterfaceType.None)] 
```

这是关于类似问题的[另一个讨论。](http://osdir.com/ml/windows.devel.dotnet.cx/2004-05/msg00016.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-20T17:08:27.310

此外，请确保您的 C# 类没有此属性：

[ClassInterface(ClassInterfaceType.AutoDual)] <-- 似乎在 C++ 中使用 _TypePtr 导致错误

# svn - 在 Windows 上将 Subversion 设置为服务

> ID：12718
> 
> 赞同：1
> 
> 时间：2008-08-15T20:41:54.940
> 
> 标签：svn, version-control

在将 subversion 安装为服务时，我使用了以下命令：

```
c:\>svnservice -install --daemon --root "c:\documents and settings\my_repository" 
```

然后我得到了这个错误：

```
Could not create service in service control manager. 
```

在查看了服务控制管理器上的一些 MSDN 文档后，我尝试在 HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services 的注册表项的权限中授予所有人完全控制权，但这没有任何效果。

有谁知道我做错了什么，或者如何克服这个问题？

*注意#1：我在这个盒子上以管理员身份运行*

*注意＃2：我按照[此处](http://blogs.vertigosoftware.com/teamsystem/archive/2006/01/16/Setting_up_a_Subversion_Server_under_Windows.aspx)给出的说明进行操作，因此我对目录的选择可能被误导了。而且我的存储库实际上并不称为“my_repository”。我使用了当前在*gasp* VSS 中受源代码控制的实际项目的名称。*

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-15T21:04:08.827

[VisualSVN 服务器](http://www.visualsvn.com/server)作为 Windows 服务安装。它是免费的，包括 Apache、OpenSSL 和一个存储库/权限管理工具。它还可以与 Active Directory 集成以进行用户身份验证。我强烈推荐它在 Windows 上托管 SVN。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-15T21:14:03.130

我已按照 Collabnet 网站上的说明进行操作：

[http://svn.apache.org/repos/asf/subversion/trunk/notes/windows-service.txt](http://svn.apache.org/repos/asf/subversion/trunk/notes/windows-service.txt)

他们使用 windows SC 来创建服务（运行 svnserve）。这对我来说没有任何问题（使用 svn 1.4 和 1.5）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-15T21:15:38.307

我认为 svnservice 已经过时了，因为从 1.4 开始，svnserve 本身已经能够作为 Windows 服务运行。（svnserve 是正常 SVN 二进制分发的一部分）

[http://svn.apache.org/repos/asf/subversion/trunk/notes/windows-service.txt](http://svn.apache.org/repos/asf/subversion/trunk/notes/windows-service.txt)包含如何设置它的详细信息。

你想要的二进制文件在这里： [http ://subversion.tigris.org/servlets/ProjectDocumentList?folderID=91](http://subversion.tigris.org/servlets/ProjectDocumentList?folderID=91)

但正如其他人所说，现在有更友好的包包含 svn 的东西 - VisualSVN 服务器（如此糟糕的名字让我哭泣）和 Collabnet 发行版 - 后者只是 Apache，并且是在处女的大腿上手工滚动的，意味着它似乎总是比其他人晚大约三周出现。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-15T20:48:06.677

我从来没有为此使用过命令行安装程序。我假设您正在从以下位置下载最新版本：

[http://svnservice.tigris.org/](http://svnservice.tigris.org/)

我运行安装程序，然后使用配置工具（在开始菜单、SVN 服务、SVN 服务管理中）进行设置。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-15T20:51:20.320

我目前唯一能想到的是：确保您在管理员帐户下运行。这对于安装服务是绝对必要的，AFAIK。

玩 Subversion，顺便说一句 :)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-15T20:57:39.450

我建议您将存储库移到更安全的地方，也许是“c:\SVNRepo”。

我会犹豫将存储库放在“文档和设置”中。您的存储库实际上是否称为“my_repository”？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-15T21:04:49.623

我建议你使用[Visual SVN 服务器](http://www.visualsvn.com/server/)。非常容易安装

# .net-2.0 - 添加 .NET 2.0 SP1 作为部署项目的先决条件

> ID：12720
> 
> 赞同：2
> 
> 时间：2008-08-15T20:42:51.523
> 
> 标签：.net-2.0, installation, dependencies

我有一个 .NET 2.0 应用程序，它最近有依赖于 Service Pack 1 的贡献。部署项目已将 .NET 2.0 检测为先决条件，但不是 SP1。如何在我的部署项目中包含 SP1 作为依赖项/先决条件？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-15T20:51:14.580

您需要在部署项目中设置启动条件，以确保安装了 2.0 SP1 版。您需要根据 MsiNetAssemblySupport 变量设置一个要求，该变量与 .NET 2.0 SP1 的版本号相关联（根据[此页面](http://blogs.msdn.com/astebner/archive/2005/07/12/what-net-framework-version-numbers-go-with-what-service-pack.aspx)为 2.0.50727.1433 及更高版本。）

如果未安装框架，则引导项目以实际下载框架是另一回事，并且有很多关于如何做到这一点的文章。

# php - PHP中的奇怪字符

> ID：12765
> 
> 赞同：10
> 
> 时间：2008-08-15T21:18:30.843
> 
> 标签：php, encoding

这真让我抓狂。

我在工作的测试服务器上有一个 php 文件，但它不起作用。我一直从它删除东西，直到它变成

```
<?
打印'你好';
?>

```

它输出

> ï»¿你好

如果我创建一个新文件并将相同的脚本复制/粘贴到它，它就可以工作！为什么这个文件总是给我奇怪的字符？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-08-15T21:20:49.870

这就是您看到的[BOM（字节顺序标记） 。](http://en.wikipedia.org/wiki/Byte_Order_Mark)

在您的编辑器中，应该有一种方法可以在没有 BOM 的情况下强制保存，这将消除问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-15T21:28:53.083

找到了，file -> encoding -> UTF8 with BOM ，改为 UTF :-)

在浪费时间试图弄清楚之前我应该​​问一下:-)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-17T18:16:38.270

以防万一，这里是 BOM 的字节列表

```
编码表示（十六进制）
UTF-8 EF BB BF
UTF-16 (BE) FE FF
UTF-16 (LE) FF FE
UTF-32 (BE) 00 00 FE FF
UTF-32 (LE) FF FE 00 00
UTF-7 2B 2F 76，以及以下字节之一：[ 38 | 39 | 2B | 2F ]†
UTF-1 F7 64 4C
UTF-EBCDIC DD 73 66 73
SCSU 0E FE FF
BOCU-1 FB EE 28 可选后跟 FF†

```

# html - 这个网站的 HTML 怎么这么干净？

> ID：12768
> 
> 赞同：10
> 
> 时间：2008-08-15T21:19:48.437
> 
> 标签：html, semantic-markup

我在工作中使用 C#，但不喜欢 webforms 如何喷出大量 JavaScript，不包括它创建的许多视图状态行。

这就是我喜欢使用 PHP 编码的原因，因为我拥有完全的控制权。

但我只是想知道这个网站的 HTML 是如何如此干净和优雅的？

使用MVC与它有关吗？我看到使用了 JQuery，但您肯定还在使用 asp:required 验证器吗？如果你这样做了，它通常产生的所有可怕的代码在哪里？

如果他们不使用必填字段验证器，为什么不呢？开发起来肯定比使用 JQuery 快吗？

我用 PHP 编写我的个人网站的主要原因之一是它生成的 HTML 更优雅，但如果我可以生成像这个网站这样的代码，那么我将全职使用 .net！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-08-15T21:30:36.043

ASP.NET MVC 的目标之一是让您控制您的标记。但是，ASP.NET 总是有一些选择可以让您生成相对干净的 HTML。

例如，ASP.NET 一直提供带有验证器控件的选择。您是否重视开发速度而不是标记？使用验证器。价值加成高于开发速度？选择另一种验证机制。您对验证器的评论在那里有点矛盾 - 可以使用 ASP.NET 并且仍然选择标记纯度而不是开发速度。

此外，对于 web 表单，我们使用 CSS 友好控件适配器已有几年了，它将修改控件以呈现更多语义标记。ASP.NET 3.5 包含 ListView，这使得编写发出语义 HTML 的转发器类型控件变得非常容易。我们在 Microsoft PDC 站点上使用 ASP.NET 网络表单并保持 HTML 相当干净：[http](http://microsoftpdc.com/Agenda/Speakers.aspx) ://microsoftpdc.com/Agenda/Speakers.aspx - Viewstate 可能在大多数页面上被禁用，尽管实际上它只是少数十几个字节。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-15T21:22:59.553

你走在正确的轨道上。这是他们使用 ASP.NET MVC Web 框架的事实。它允许您完全控制您的输出 html。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-15T21:30:21.863

[ASP.NET MVC 框架](http://www.asp.net/mvc/)是进行 ASP.NET 开发的常规“Web 表单”方式的替代方案。有了它，你失去了很多抽象，但获得了很多控制权。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-15T21:25:41.343

是的 - MVC 不利用 ASP.NET 视图状态垃圾。

# svn - 将 VisualSVN 服务器附加到现有存储库

> ID：12774
> 
> 赞同：3
> 
> 时间：2008-08-15T21:22:36.340
> 
> 标签：svn, version-control, visualsvn-server, svn-repository

所有最近的 VisualSVN Server 帖子都让我想去看看。我现在通过 Apache 运行 SVN，但我想尝试 VisualSVN Server，主要用于 Active Directory 集成。他们的文档没有描述您是否可以轻松迁移现有存储库。

以前有人做过吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-15T21:30:02.910

VisualSVN 服务器管理器控制台上有一个选项可以导入现有存储库。您只需为其提供现有存储库位置和导入存储库的名称。很简单。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-08-15T21:23:40.957

[VisualSVN Server](http://www.visualsvn.com/server)将毫无问题地使用您现有的 SVN 存储库。我已经多次成功地将存储库从 SVN + Apache 迁移到 VisualSVN Server。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-15T21:27:18.983

SVN 服务器并没有真正“附加”到存储库，它只需要能够查看其文件。存储库本身不知道也不关心它是否通过 svnserve、Apache mod_svn 或直接 file:// URLs 访问

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-09-25T15:21:04.647

有一篇关于该案例的 VisualSVN 服务器知识库文章：

[**如何将现有存储库导入新安装的 VisualSVN 服务器？**](http://www.visualsvn.com/support/topic/00010/)

![](../Images/12de15638986551ebaf44a72d4177c03.png)

# javascript - 如何使用 jQuery 在代码标签中添加 pre 标签？

> ID：12794
> 
> 赞同：12
> 
> 时间：2008-08-15T21:35:51.260
> 
> 标签：javascript, jquery, html, internet-explorer

我正在尝试使用`jQuery`格式化代码块，特别是在`<pre>`标签内添加`<code>`标签：

```
$(document).ready(function() {
   $("code").wrapInner("<pre></pre>");
}); 
```

Firefox 正确应用格式，但 IE 将整个代码块放在一行上。如果我添加警报

```
alert($("code").html()); 
```

我看到 IE 在 pre 标记中插入了一些额外的文本：

```
<PRE jQuery1218834632572="null"> 
```

如果我重新加载页面，jQuery 后面的数字会发生变化。

如果我使用`wrap()`而不是`wrapInner()`, 来包装标签的`<pre>`外部`<code>`，IE 和 Firefox 都会正确处理它。但不应该*在里面*`<pre>`工作吗？ *`<code>`*

 *我更喜欢使用`wrapInner()`，因为我可以在`<pre>`标签中添加一个 CSS 类来处理所有格式，但是如果我使用`wrap()`，我必须将页面格式 CSS 放在`<pre>`标签中，并将文本/字体格式放在`<code>`标签中，或者 Firefox 和 IE都窒息。没什么大不了的，但我想让它尽可能简单。

有人遇到过这种情况么？我错过了什么吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-08-16T04:04:09.713

[这就是块元素和内联](http://www.w3.org/TR/html4/struct/global.html#h-7.5.3)元素之间的区别。[`pre`是块级元素](http://www.w3.org/TR/html4/sgml/dtd.html#block)。把它放在一个[只能包含内联内容](http://www.w3.org/TR/html4/struct/text.html#h-9.2.1)`code`的标签内是不合法的。

因为浏览器必须支持他们可能在真实网络上找到的任何可怕的标签汤，Firefox 试图按照你的意思去做。IE 碰巧以不同的方式处理它，这在规范中很好；这种情况下的行为是未指定的，因为它不应该发生。

*   你可以用替换*元素*`code`吗`pre`？（由于块/内联问题，从技术上讲，这仅在元素位于[具有“流”内容](http://www.w3.org/TR/html4/sgml/dtd.html#flow)的元素内时才有效，但浏览器可能会做你想做的事。）
*   `code`如果您想要`pre`的行为，为什么它首先是一个元素？
*   您还可以使用 CSS 赋予`code`元素`pre`的空白保留功能[`white-space: pre`](http://www.blooberry.com/indexdot/css/properties/text/whitespace.htm)，但显然[IE 6 仅在严格模式下才尊重这一点](http://www.quirksmode.org/css/whitespace.html)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-15T21:56:18.817

顺便说一句，我不知道它是否相关，但代码标签内的 pre 标签在严格模式下不会验证。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-15T21:50:14.897

您使用的是最新的 jQuery 吗？如果你尝试怎么办

```
$("code").wrapInner(document.createElement("pre")); 
```

它更好还是你得到相同的结果？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-18T12:13:36.557

正如 markpasc 所述，HTML 中不允许在 CODE 元素中使用 PRE 元素。最好的解决方案是将您的 HTML 代码更改为直接在 HTML 中使用 <pre><code> （这意味着包含代码的预格式化块）作为代码块。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-08-18T14:21:51.453

您可以使用 html() 来包装它：

```
$('code').each(function(i,e)
{
    var self = $(e);
    self.html('<pre>' + self.html() + '</pre>');
}); 
```

如上所述，您最好更改您的 html。但是这个解决方案应该有效。*

# com - 如何从 VS Setup 项目注册 COM？

> ID：12807
> 
> 赞同：3
> 
> 时间：2008-08-15T21:51:29.480
> 
> 标签：com, registry

我已将我的 DLL 标记为 vsdraCOM，安装后我可以在注册表中看到它，但我的应用程序在手动调用 RegAsm 之前看不到 COM 接口。为什么会这样？

COM注册在Vista（本人确认）和XP（经同事确认）上不起作用。在 XP 上使用 Visual Studio 2005。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-18T13:37:12.923

好吧，我找到了解决方案：

1.  使用 /regfile 选项运行 RegAsm.exe 以生成注册表项。
2.  通过查看注册表、右键单击并选择“导入...”，手动将 .reg 文件导入 VS 安装项目

# testing - 有人使用可执行需求吗？

> ID：12815
> 
> 赞同：13
> 
> 时间：2008-08-15T22:02:15.573
> 
> 标签：testing, process, automation

根据我对它们的有限经验，可执行需求（即将所有需求指定为损坏的自动化测试）已被证明是非常成功的。我曾参与过一个项目，在该项目中，我们非常重视创建高级自动化测试，这些测试可以执行给定用例/用户故事的所有功能。在我们开始这种练习之后，开发变得多么容易，这让我感到非常惊讶。编写测试后，实现功能变得非常容易，我们能够对系统进行重大的架构更改，并对世界充满信心，一切仍然像昨天一样工作。

我们遇到的最大问题是管理这些类型测试的工具不是很好。我们经常使用 Fitnesse，因此我现在讨厌 Fit 框架。

我想知道 1）是否有其他人有使用这种类型的测试驱动的需求定义进行开发的经验，以及 2）你们都使用了哪些工具来促进这一点。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-01T19:31:22.987

我还使用的主要工具是 FitNesse。我已经在几家公司使用它，效果非常好。我们确实有数以千计的测试用例，我们必须非常严格地组织和使用它们。

我尝试了其他一些工具，包括编写我自己的 DSL（特定领域语言）和使用 RSpec 之类的东西。我真的很喜欢 RSpec，但它肯定更像是一种开发工具而不是商业工具。

我知道 Rick Mugridge 一直在开发一个名为 ZiBreve 的工具（[http://www.zibreve.com/visit.php?page=index](http://www.zibreve.com/visit.php?page=index)）应该有更强的重构支持。我自己没有使用过它，但我认识 Rick 并且和他谈过几次。我知道在 Agile 2008 上讨论了一些不同的方法来处理一般的 Fitnesse 测试。

除此之外，我还没有看到很多好的工具。甚至像 WinRunner 这样的工具也适用于 QA 类型测试，但对于业务需求的探索性测试，FitNesse 或自定义 DSL 似乎是现在要走的路。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T10:23:44.493

您可能想看看 Robot Framework ( [http://robotframework.org](http://robotframework.org) )。它类似于 FIT，但希望更容易集成到不同的测试工具、版本控制和持续集成中。测试数据中不同的抽象级别也使得数据维护变得更加容易，当单独的[测试数据编辑器](http://code.google.com/p/robotframework-ride/)变得更加成熟时，维护变得更加容易。[快速入门指南](http://code.google.com/p/robotframework/wiki/QuickStartGuide)介绍了框架最重要的功能，也可作为可执行演示。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-07-08T13:06:35.027

我不得不为我的工作使用、测试和设置 Fitnesse 和它的竞争对手之一[GreenPepper](http://www.greenpeppersoftware.com/en/)，我能说的是：

GreenPepper 是一个 confluence 插件（confluence 是来自 atlassian 的企业 wiki），并且在“企业”级工具中拥有许多您需要的东西，几乎不需要额外的工作：

*   更好的用户友好 - 富文本 - wiki 语法（让非技术人员更容易使用）
*   它与许多开发工具集成得非常好：Eclipse、VB、maven2 和 Nant 插件，我测试最多，非常满意。
*   用户和访问权限由 confluence 管理，也就是说它很好并且可以使用您喜欢的数据库（这可能是强制性的，具体取决于您的工作地点）
*   许多其他可能需要也可能不需要的功能：ssl 支持、远程执行（在 unix 上安装 wiki，如果您正在处理 C# 项目，则在 Windows 上执行，或者相反）
*   看起来好多了:D

GreenPepper 的最大缺点是：配置非常**困难**，文档**很差**（尽管他们似乎正在研究它并且他们在论坛上回答得很快）而且它**不是免费**的，你必须为 confluence 和 GreenPepper 付费，其中可能加起来很多。

Fitnesse 在我看来是非常基础的，很容易设置，它可以工作但仅此而已，你可以使用一些开源社区开发的 Fitnesse 插件，甚至一些 Fit 插件，例如 Eclipse 插件（构建骨架来自fitnesse测试文件的夹具，只要它的扩展名为.fit，非常有用）。集成并不理想，身份验证和访问权限管理很差，但它是**免费**的，如果你需要什么，你可以去做，因为它是开源的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-23T18:05:59.143

我发现使用[合同](http://blog.mauricecodik.com/2005/10/ruby-meta-programming-software.html)是一种很好的方法。元编程合同通常比您描述的集成测试类型低，但两者肯定不是相互排斥的。我发现合同有助于保持文档、实现和测试的同步——这是 TDD 的一个主要问题（并不是说它在非 TDD 中不是问题）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-16T07:48:08.013

My experience is limited to personal projects and found much the same advantages you mentioned. I recommend [http://metacpan.org/pod/Test::Simple::Tutorial](http://metacpan.org/pod/Test::Simple::Tutorial) which was my inspiration for trying out testing-based development. The perl testing modules seem pretty useful and flexible, though I have nothing to compare them to.

I also believe tests are vital for the maintenance period of a project. If you have good tests to begin with, it saves a lot of time and mistakes later on. I wish I had put more work into tests on my current project.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-16T15:01:27.217

I've tried Fitnesse and its really awful (particularly integration with SVN). And our company develop similar open-source tool with fit engine: [FitPro](http://sourceforge.net/projects/fitpro)

Another brilliant tool I've used is [Concordion](http://www.concordion.org/). It has the only disadvantage - requrements in html format

# location - 按邮政编码或其他基于位置的数据检索策略过滤

> ID：12823
> 
> 赞同：4
> 
> 时间：2008-08-15T22:09:05.343
> 
> 标签：location, zipcode

我的小站点应该使用活动用户的位置作为过滤器从表中汇集项目列表。想想[Craigslist](http://craigslist.org)，您在其中搜索“dvd”，但结果并非来自所有数据库，它们是按您选择的位置过滤的。我的问题有 2 个级别：

1.  我应该去 a-la-craigslist 并要求用户使用城市级别的位置吗？我的问题是您需要生成在我看来是硬编码的手工制作的位置列表。
2.  我应该去一个-la-zipCode。只要求用户输入他的邮政编码，然后汇集所有与他的邮政编码相同或有一定距离的项目的想法。

我似乎更喜欢邮政编码方式，因为它似乎更优雅的解决方案，但是究竟如何创建所有邮政编码的数据库并实现给定邮政编码 12345 的功能，获取 1 英里距离内的所有邮政编码？

这应该是相当普遍的“任务”，因为许多网站都有与我类似的需求，所以我希望不要在这里重新发明轮子。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-15T23:12:26.323

获取邮政编码数据库没有问题。你可以试试这个免费的：http: [//zips.sourceforge.net/](http://zips.sourceforge.net/)

虽然我不知道它的最新情况，但您也可以使用众多提供商之一。我们对[ZipCodeDownload.com](http://www.ZipCodeDownload.com)进行年度订阅，只需100 美元，我们就可以每月更新最新的邮政编码数据，包括邮政编码中心的纬度/经度。

至于查询某个半径内的所有拉链，您将需要某种空间库。如果您只有一个带有 lats/longs 的 zips 表，您将需要一个面向数据库的机制。SQL Server 2008 具有内置的功能，并且有一些[开源库](http://www.codeplex.com/Wiki/View.aspx?ProjectName=MsSqlSpatial)和[商业库](http://www.spatialdb.com/default.aspx?AspxAutoDetectCookieSupport=1)会将这些功能添加到 SQL Server 2005。开源数据库 PostgreSQL 有一个项目 PostGIS，它将这种功能添加到该数据库中。它在这里： http: [//postgis.refractions.net/](http://postgis.refractions.net/)

其他数据库平台可能有类似的项目，但这些是我所知道的。使用这些基于数据库的库之一，您应该能够直接查询给定半径内的任何邮政编码（或任何具有纬度/经度列的任何类型的行）。

如果您想走不同的路线，可以使用带有地图库的空间工具。这里也有开源选项，例如[SharpMap](http://www.codeplex.com/SharpMap)和[许多其他](http://opensourcegis.org/)（[谷歌可以提供帮助](http://www.google.com/search?q=Open+Source+GIS+tools)）可以使用美国的免费老虎地图作为数据源。但是，如果您只需要半径搜索，则此路线会稍微复杂一些并且性能可能会降低。

最后，您可能想要研究 Web 服务。正如您所说，这是一种常见的需求，我想您可以订阅任何数量的 ob 网络服务，这些服务可以从提供的邮政编码提供给定半径内的所有邮政编码。一个快速的谷歌搜索出现了这个： [http](http://www.zip-codes.com/free-zip-code-tools.asp#radius) ://www.zip-codes.com/free-zip-code-tools.asp#radius 但是对于这个主题[的搜索有很多资源。](http://www.google.com/search?q=all+zip+codes+in+radius)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-16T00:22:39.690

> [...] 到底如何实现给定邮政编码 12345 的功能，获取 1 英里距离内的所有邮政编码？

这是有关如何执行此操作的示例：

[http://www.codeproject.com/KB/cs/zipcodeutil.aspx](http://www.codeproject.com/KB/cs/zipcodeutil.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T05:50:34.017

只是为了技术...... PostGIS 不是 Postgres 社区的项目......它是一个建立在 Postgres 之上的独立项目。如果您需要 PostGIS 的帮助或支持，您将希望去它的社区而不是 Postgres。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-22T07:54:57.323

您可以使用 PostGIS。此外，我使用了 deCarta 的映射库。他们拥有允许您对任意数据类型进行地理定位的技术。然后你可以在空间上查询这些。

免责声明：我为 deCarta 工作

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-18T22:42:52.083

仅找出 1 英里半径范围内的城市并将该信息存储在表格中不是更有效吗？这样您就不必一直在数据库中进行计算。

# c# - C# 数据库访问：DBNull 与 null

> ID：12836
> 
> 赞同：13
> 
> 时间：2008-08-15T22:23:21.490
> 
> 标签：c#, orm, null, dbnull

我们在这里使用自己的 ORM，并为我们所有的数据库表提供强类型包装器。我们还允许执行弱类型的 ad-hoc SQL，但这些查询仍然通过同一个类从数据读取器中获取值。

在调整该类以使用 Oracle 时，我们遇到了一个有趣的问题。使用 DBNull.Value 还是 null 更好？使用 DBNull.Value 有什么好处吗？使用 null 似乎更“正确”，因为我们已经将自己与 DB 世界分开了，但是有一些影响（例如，当值为 null 时，你不能盲目地`ToString()`）所以它绝对是我们需要意识到的关于的决定。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-08-16T00:55:43.510

我发现使用 null 而不是 DB null 更好。

原因是，正如您所说，您将自己与数据库世界分开。

检查引用类型以确保它们不为空通常是一种好习惯。您将检查数据库数据以外的内容是否为 null，我发现最好在整个系统中保持一致性，并使用 null，而不是`DBNull`.

从长远来看，在架构上我发现它是更好的解决方案。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-08-16T04:34:46.063

如果您已经编写了自己的 ORM，那么我会说只使用 null，因为您可以随心所欲地使用它。我相信 DBNull 最初仅用于解决值类型（int、DateTime 等）不能*为*null 的事实，而不是返回诸如零或 DateTime.Min 之类的值，这*意味着*null（坏、坏)，他们创建了 DBNull 来表明这一点。也许还有更多，但我一直认为这就是原因。但是，现在我们在 C# 3.0 中有了可为空的类型，不再需要 DBNull。事实上，LINQ to SQL 只是到处使用 null。完全没有问题。拥抱未来……使用 null。;-)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-15T22:37:33.773

根据我的经验，.NET DataTables 和 TableAdapters 与 DBNull 一起工作得更好。它还在强类型时打开了一些特殊方法，例如 DataRow.IsFirstNameNull 到位时。

我希望我能给你一个比这更好的技术答案，但对我来说，底线是在处理与数据库相关的对象时使用 DBNull，然后在处理对象和 .NET 相关代码时使用“标准”空值。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-15T22:46:43.800

使用`DBNull`.
我们在使用 null 时遇到了一些问题。
如果我没记错的话，您不能将空值插入到字段中，只能插入 DBNull。
可能只是 Oracle 相关的，抱歉，我不知道细节了。

# mercurial - 如何在 Mercurial 中合并两个项目？

> ID：12843
> 
> 赞同：84
> 
> 时间：2008-08-15T22:29:44.770
> 
> 标签：mercurial

我有两个独立的 mercurial 存储库。在这一点上，它们“合二为一”是有道理的，因为我想同时处理这两个项目。

我真的希望这两个项目都成为新存储库中的子目录。

1.  如何合并这两个项目？
2.  这是个好主意，还是我应该将它们分开？

看来我应该能够从一个存储库推送到另一个存储库......也许这真的很简单？

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-08-21T17:23:08.013

我能够以这种方式组合我的两个存储库：

1.  用于`hg clone first_repository`克隆其中一个存储库。
2.  用于`hg pull -f other_repository`从其他存储库中提取代码。

pull 上的`-f`(force) 标志是关键——它表示忽略两个存储库不是来自同一来源的事实。

这是此功能[的文档](https://www.mercurial-scm.org/wiki/MergingUnrelatedRepositories)。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-09-16T03:49:45.177

hg从 1.3 (2009-07-01)开始有[subrepo 。](https://www.mercurial-scm.org/wiki/Subrepositories)早期版本不完整且不稳定，但现在它非常有用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-20T15:05:01.037

如果您没有在项目中使用相同的代码，请将它们分开。您可以将每个项目*的*个人存储库设置为仅一个目录。当你不需要的时候，为什么要混合所有的分支、合并和提交评论。

**关于您的编辑：**从一个存储库推送到另一个存储库。您始终可以使用该[`transplant`](https://www.mercurial-scm.org/wiki/TransplantExtension)命令。虽然，所有这一切实际上都在阻碍你将两者结合起来的*愿望*，所以你可能会觉得使用我的建议会感到不舒服。然后你可以使用森林扩展或其他东西。

```
hg transplant -s REPOSITORY lower_rev:high_rev 
```

# sql - 数据库不区分大小写索引？

> ID：12855
> 
> 赞同：6
> 
> 时间：2008-08-15T22:47:57.370
> 
> 标签：sql, database, oracle, indexing, db2

我有一个查询，我正在搜索一个字符串：

```
SELECT county FROM city WHERE UPPER(name) = 'SAN FRANCISCO'; 
```

现在，这工作正常，但它不能很好地扩展，我需要优化它。我[找到了一个](http://www.ibm.com/developerworks/db2/library/techarticle/0203adamache/0203adamache.html)类似于创建生成视图的选项，或者类似的东西，但我希望使用索引有一个更简单的解决方案。

我们正在使用 DB2，我真的想[在 index 中使用表达式](http://ibmsystemsmag.blogs.com/db2utor/2007/11/db2-9-index-wit.html)，但是这个选项似乎只在 z/OS 上可用，但是我们正在运行 Linux。我还是尝试了表达式索引：

```
CREATE INDEX city_upper_name_idx
ON city UPPER(name) ALLOW REVERSE SCANS; 
```

但当然，它会在 UPPER(name) 上窒息。

有没有另一种方法可以以这种方式创建索引或类似的东西，这样我就不必重组现有查询以使用新生成的视图，或更改现有列或任何其他此类侵入性更改？

编辑：我愿意听取其他数据库的解决方案......它可能会延续到 DB2......

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-08-15T23:28:22.687

您可以添加一个索引列，其中包含城市名称的数字哈希键。（允许重复）。

然后你可以做一个多子句 where ：

```
hash = [compute hash key for 'SAN FRANCISCO']

SELECT county 
FROM city 
WHERE cityHash = hash 
  AND UPPER(name) = 'SAN FRANCISCO' ; 
```

或者，查看您的数据库手册并查看创建表索引的选项。可能会有一些帮助。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-07T06:22:22.897

简短的回答，不。

长答案，是的，如果你在大型机上运行，​​但你不是，所以你必须使用其他诡计。

DB2（从 DB2/LUW v8 开始）现在已生成列，因此您可以：

```
CREATE TABLE tbl (
    lname  VARCHAR(20),
    fname  VARCHAR(20),
    ulname VARCHAR(20) GENERATED ALWAYS AS UPPER(lname)
); 
```

然后在 ulname 上创建一个索引。我不确定您是否会比这更简单。

在此之前，您必须使用插入和更新触发器的组合来确保 ulname 列保持同步，而这是维护的噩梦。此外，既然这个功能是核心 DBMS 的一部分，它已经过高度优化（它比基于触发器的解决方案快得多）并且不会妨碍真正的用户触发器，因此不需要维护额外的 DB 对象。

有关详细信息，请参见[此处](http://publib.boulder.ibm.com/infocenter/db2luw/v8/index.jsp?topic=/com.ibm.db2.udb.doc/ad/c0007004.htm)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-19T16:59:22.657

我不知道这在 DB2 中是否可行，但我会告诉您如何在 SQL Server 中执行此操作。我*认为*MSSQL 这样做的方式是 ANSI 标准，尽管具体的排序规则字符串可能不同。无论如何，如果您可以在不破坏应用程序的其余部分的情况下做到这一点——是否还有其他地方的“名称”列需要区分大小写？-- 尝试通过更改排序规则使整列不区分大小写，然后对该列进行索引。

```
ALTER TABLE city ALTER COLUMN name nvarchar(200) 
    COLLATE SQL_Latin1_General_CP1_CI_AS 
```

...其中“nvarchar(200)”代表您当前的列数据类型。排序规则字符串的“CI”部分在 MSSQL 中将其标记为不区分大小写。

解释一下......我的理解是索引将按照索引列的排序规则存储值。使列的排序规则不区分大小写将使索引存储 'San Francisco'、'SAN FRANCISCO' 和 'san francisco' 放在一起。然后您应该只需要从查询中删除“UPPER()”，DB2 应该知道它可以使用您的索引。

同样，这完全基于我对 SQL Server 的了解，加上几分钟查看 SQL-92 规范；它可能适用于 DB2，也可能不适用于 DB2。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-16T12:40:25.117

PostgreSQL 还支持对函数的结果进行索引：

```
CREATE INDEX mytable_lower_col1_idx ON mytable (lower(col1)); 
```

我能想到的唯一其他选择是通过创建另一列来保存大写版本（由触发器更新）并对其进行索引，从而对您的数据进行一些反规范化。布莱赫！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-03T23:04:09.993

DB2 在整理方面并不强。而且它没有基于函数的索引。

如果您可以接受散列必须在您的应用程序中发生（因为据我所知，DB2 没有 SHA 或 MD5 函数），Niek Sanders 的建议会奏效。

但是，如果我是你，我会使用[CREATE TABLE AS](http://publib.boulder.ibm.com/infocenter/db2luw/v9r5/topic/com.ibm.db2.luw.sql.ref.doc/doc/r0000927.html)创建一个物化视图（MQT == Materialized Query Table，用 db2 的说法） ，添加一个具有预先计算的名称大写变体的列。注意：您可以向 DB2 中的物化视图添加索引。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-16T02:13:32.883

Oracle 支持基于函数的索引。他们的典型例子：

```
 create index emp_upper_idx on emp(upper(ename)); 
```

# mercurial - Mercurial卡在“等待锁定”

> ID：12865
> 
> 赞同：357
> 
> 时间：2008-08-15T23:01:16.533
> 
> 标签：mercurial

克隆 mercurial 存储库时在 Windows 中出现蓝屏。

重新启动后，我现在几乎所有 hg 命令都收到此消息：

```
c:\src\>hg 提交
等待 '\x00\x00\x00\x00\x00\ 持有的存储库 c:\src\McVrsServer 的锁定
x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'
打断了！

```

谷歌没有帮助。

有小费吗？

* * *

## 回答 #1

> 赞同：504
> 
> 时间：2008-08-15T23:20:18.820

当“等待锁定存储库”时，删除存储库文件：（`.hg/wlock`或者它可能在``.hg/store/lock``）

删除锁定文件时，您必须确保没有其他人正在访问存储库。（如果锁是一串零或空白，这几乎肯定是真的）。

* * *

## 回答 #2

> 赞同：350
> 
> 时间：2010-06-02T18:39:16.287

时`waiting for lock on working directory`，删除`.hg/wlock`。

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2017-01-07T23:16:34.297

我遇到了这个问题，没有可检测到的锁定文件。我在这里找到了解决方案：http: [//schooner.uwaterloo.ca/twiki/bin/view/MAG/HgLockError](http://schooner.uwaterloo.ca/twiki/bin/view/MAG/HgLockError)

这是 Tortoise Hg Workbench 控制台的成绩单

```
% hg debuglocks
lock:  user None, process 7168, host HPv32 (114213199s)
wlock: free
[command returned code 1 Sat Jan 07 18:00:18 2017]
% hg debuglocks --force-lock
[command completed successfully Sat Jan 07 18:03:15 2017]
cmdserver: Process crashed
PaniniDev% hg debuglocks
% hg debuglocks
lock:  free
wlock: free
[command completed successfully Sat Jan 07 18:03:30 2017] 
```

在此之后，中止的拉动成功运行。

该锁已在 2 多年前由不再位于 LAN 上的机器上的进程设置。hg 开发人员感到羞耻 a) 没有充分记录锁；b) 当它们变得陈旧时，不给它们加时间戳以便自动删除。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2013-05-07T15:36:57.763

同事今天遇到了这个确切的问题，在尝试推动时出现了 BSoD。他不得不：

*   删除文件`.hg/store/lock`（根据[接受的答案](https://stackoverflow.com/a/12879/70345)）
*   删除文件`.hg/store/phaseroots`（根据[这个 TortoiseHG 错误报告](https://bitbucket.org/tortoisehg/thg/issue/2366/valueerror-need-more-than-1-value-to#comment-2867642)）

然后他的回购再次工作。

**编辑：**根据@Marmoute 的评论 - 在处理与锁定相关的问题时，使用`hg debuglock`是一种更安全的替代方法，而不是盲目地删除`.hg/store/lock`文件。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2011-11-02T13:36:33.463

我非常熟悉 Mercurial 的锁定代码（从 1.9.1 开始）。上面的建议很好，但我要补充一点：

1.  我在野外见过这种情况，但很少见，而且只在 Windows 机器上见过。
2.  删除锁定文件是最简单的解决方法，但您必须确保没有其他任何东西正在访问存储库。（如果锁是一串零，这几乎肯定是真的）。

（出于好奇：我还没有找到这个问题的原因，但怀疑它要么是旧版本的 Mercurial 访问存储库，要么是 Python 在某些版本的 Windows 上的 socket.gethostname() 调用中的问题。）

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2018-07-24T05:47:15.463

我有同样的问题。当我尝试提交时收到以下消息：

```
waiting for lock on working directory of <MyProject> held by '...' 
```

`hg debuglock`显示了这一点：

```
lock:  free
wlock:  (66722s) 
```

所以我执行了以下命令，这为我解决了问题：

```
hg debuglocks -W 
```

使用 Win7 和 TortoiseHg 4.8.7。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2015-03-12T09:24:12.107

我在 Win 7 上遇到了同样的问题。解决方案是删除以下文件：

1.  .hg/store/phaseroots
2.  .hg/wlock

至于 .hg/store/lock - 没有这样的文件。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2014-08-01T22:22:55.170

我不认为这是一个成功的答案，但这是一个相当不寻常的情况。提到以防我以外的人遇到它。

今天我在 hg push 命令上得到了“等待锁定存储库”。

当我杀死挂起的 hg 命令时，我看不到 .hg/store/lock

当我在命令挂起时查找 .hg/store/lock 时，它存在。但是当 hg 命令被杀死时，锁定文件被删除了。

当我到达推送的目标，并执行 hg pull 时，没问题。

最终我意识到 hg push 上的进程 ID 是锁等待消息每次都在变化。事实证明，“hg push”正在等待自己持有的锁（或者可能是一个子进程，我没有进一步调查）。

事实证明，这两个工作区，我们称它们为 A 和 B，具有由符号链接共享的 .hg 树：

```
A/.hg --symlinked-to--> B/.hg 
```

这对 Mercurial 来说不是一件好事。Mercurial 不理解两个工作区共享同一个存储库的概念。但是，我确实理解从另一个 VCS 来到 Mercurial 的人可能想要这个（Perforce 确实如此，尽管不是 DVCS；据报道 Bazaar DVCS 可以这样做）。我很惊讶符号链接的 REP-ROOT/.hg 完全有效，尽管它似乎除了这个推送。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-08-16T20:54:27.880

如果锁定的仓库是原始的，我无法想象它正在*修改*它以克隆它，所以它只是阻止你在中间更改它并弄乱克隆。拆锁后应该没问题。

但是，新的克隆副本（如果它是本地克隆）可能处于任何格式错误的状态，因此您应该将其丢弃并重新开始。（如果是远程克隆，我希望它失败并且已经丢弃了不完整的副本。）

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2014-11-24T18:10:12.287

我在 Mac OS X 10.7.5 和 Mercurial 2.6.2 上尝试推送时遇到了这个问题。升级到 Mercurial 3.2.1 后，我得到“未找到更改”而不是“等待存储库锁定”。我发现默认路径以某种方式被设置为指向同一个存储库，因此 Mercurial 会感到困惑也就不足为奇了。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-07-12T05:20:48.943

如果它只发生在映射驱动器上，则可能是错误[https://bitbucket.org/tortoisehg/thg/issue/889/cant-commit-file-over-network-share](https://bitbucket.org/tortoisehg/thg/issue/889/cant-commit-file-over-network-share)。使用 UNC 路径而不是驱动器号似乎可以回避这个问题。

# java - Java中的数组数组

> ID：12870
> 
> 赞同：17
> 
> 时间：2008-08-15T23:07:03.400
> 
> 标签：java, php, jsp, tomcat

这对我来说是一件令人讨厌的事情……我是一名在 Java 中从事 JSP 项目的 PHP 人员。我知道如何通过太多代码和完全缺乏技巧来做我正在尝试的事情。

我宁愿做对。情况如下：

我正在写一个小型显示器，以向客户展示他们可以根据浇水组 (ABCDE) 浇灌草坪的日期以及一年中的什么时间。我们的季节是这样的： 夏季（5-1 到 8-31） 春季（3-1 到 4-30） 秋季（9-1 到 10-31） 冬季（11-1 到 2-28）

一个例子可能是：

如果我在 A 组，以下是我允许的时间： 冬季：仅限周一 春季：周二、周四、周六 夏季：任何一天 秋季：周二、周四、周六

如果我用 PHP 写这个，我会使用这样的数组：

```
//M=Monday,t=Tuesday,T=Thursday.... etc
$schedule["A"]["Winter"]='M';
$schedule["A"]["Spring"]='tTS';
$schedule["A"]["Summer"]='Any';
$schedule["A"]["Fall"]='tTS';
$schedule["B"]["Winter"]='t'; 
```

我可以制作天数数组 (array("Tuesday","Thursday","Saturday")) 等，但这对于我真正想要完成的事情来说并不是必需的。

我还需要设置数组来确定我所处的季节：

```
$seasons["Summer"]["start"]=0501;
$seasons["Summer"]["end"]=0801; 
```

谁能提出一个非常酷的方法来做到这一点？我会有今天的约会和群信。我需要一天（M）或一系列天（tTS），（Any）离开我的职能。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-08-15T23:16:52.383

您可以使用 Hashtables（或其他一些 Map）执行基本相同的代码：

```
Hashtable<String, Hashtable<String, String>> schedule
    = new Hashtable<String, Hashtable<String, String>>();
schedule.put("A", new Hashtable<String, String>());
schedule.put("B", new Hashtable<String, String>());
schedule.put("C", new Hashtable<String, String>());
schedule.put("D", new Hashtable<String, String>());
schedule.put("E", new Hashtable<String, String>());

schedule.get("A").put("Winter", "M");
schedule.get("A").put("Spring", "tTS");
// Etc... 
```

没有那么优雅，但话又说回来，Java 不是一种动态语言，它在语言级别上没有散列。

注意：您也许可以做一个更好的解决方案，当我阅读您的问题时，这只是突然出现在我的脑海中。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-08-16T00:21:05.763

不要试图像 PHP 那样动态。您可以尝试首先**定义**您需要什么。

```
interface Season
{
    public string getDays();
}

interface User
{
    public Season getWinter();
    public Season getSpring();
    public Season getSummer();
    public Season getFall();
}

interface UserMap
{
    public User getUser(string name);
} 
```

请在使用之前阅读[Hashtable的文档。](http://java.sun.com/javase/6/docs/api/java/util/Hashtable.html)这个类是同步的，这意味着每个调用都受到多线程的保护，当您不需要额外的保护时，这确实会减慢访问速度。请使用任何[Map](http://java.sun.com/javase/6/docs/api/java/util/Map.html)实现，例如[HashMap](http://java.sun.com/javase/6/docs/api/java/util/HashMap.html)或[TreeMap](http://java.sun.com/javase/6/docs/api/java/util/TreeMap.html)。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-08-16T00:28:34.220

似乎每个人都试图找到 Java 的方式来做这件事，就像你在 PHP 中做的那样，而不是应该在 Java 中做的方式。只需将数组的每一部分视为一个对象，或者至少将数组的第一级视为对象，将每个子级别视为对象内的变量。构建您使用所述对象填充的数据结构，并通过数据结构的给定访问器访问对象。

就像是：

```
class Schedule
{
  private String group;
  private String season;
  private String rundays;
  public Schedule() { this.group = null; this.season = null; this.rundays= null; }
  public void setGroup(String g) { this.group = g; }
  public String getGroup() { return this.group; }
  ...
}

public ArrayList<Schedule> schedules = new ArrayList<Schedule>();
Schedule s = new Schedule();
s.setGroup(...);
...
schedules.add(s);
... 
```

当然，这也可能是不对的。我会让每个季节成为一个对象，也许每个工作日列表也是一个对象。无论如何，它比试图模仿您的 PHP 代码的笨拙的 Hashtable 更容易重用、理解和扩展。当然，PHP 也有对象，你应该尽可能以类似的方式使用它们，而不是你的超级数组。不过，我确实理解作弊的诱惑。PHP 让它变得如此简单，如此有趣！

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-08-16T07:37:11.967

这是它*可能*看起来的一种方式，你可以弄清楚其余的：

```
A = new Group();
A.getSeason(Seasons.WINTER).addDay(Days.MONDAY);
A.getSeason(Seasons.SPRING).addDay(Days.TUESDAY).addDay(Days.THURSDAY);
A.getSeason(Seasons.SPRING).addDays(Days.MONDAY, Days.TUESDAY, ...);

schedule = new Schedule();
schedule.addWateringGroup( A ); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-08-15T23:56:20.010

我不是 Java 程序员，但远离 Java，只是用与语言无关的术语来思考 - 一种更简洁的方法可能是使用常量或枚举类型。这应该适用于支持多维数组的任何语言。

如果使用命名常量，例如：

```
int A = 0;
int B = 1;
int C = 2;
int D = 3;

int Spring = 0; 
int Summer = 1;
int Winter = 2; 
int Fall = 3;
... 
```

然后常量用作更具可读性的数组下标：

```
schedule[A][Winter]="M";
schedule[A][Spring]="tTS";
schedule[A][Summer]="Any";
schedule[A][Fall]="tTS";
schedule[B][Winter]="t"; 
```

使用枚举类型：

```
enum groups
{
  A = 0,
  B = 1,
  C = 2,
  D = 3
}

enum seasons
{
  Spring = 0,
  Summer = 1,
  Fall = 2,
  Winter = 3
}
...
schedule[groups.A][seasons.Winter]="M";
schedule[groups.A][seasons.Spring]="tTS";
schedule[groups.A][seasons.Summer]="Any";
schedule[groups.A][seasons.Fall]="tTS";
schedule[groups.B][seasons.Winter]="t"; 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-08-16T01:07:35.577

我完全不知道为什么你们中的一些人似乎认为向代码扔大量对象是要走的路。例如，恰好有四个季节，它们不做也不*存储*任何*东西*。它如何简化使它们成为对象的任何事情？Wing 非常正确，这些应该是***常量***（或者可能是枚举）。

Bruce 需要的只是一个查找表。他不需要对象和接口的层次结构；他需要一种方法来根据季节和组标识符查找时间表。将事物转化为对象只有在它们具有责任或状态时才有意义。如果两者都没有，那么它们只是标识符，为它们构建特殊对象只会使代码库更大。

例如，您*可以*`Group`构建每个包含一组时间表字符串（每个季节一个）的对象，但如果所有`Group`对象都提供查找功能，那么您已经以一种不太直观的方式重新发明了查找表。如果他必须查找组，然后查找时间表，他所拥有的只是一个两步查找表，编码时间更长，更容易出错，并且更难维护。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-08-16T12:04:54.377

我和那些建议在对象中封装函数的人在一起。

```
import java.util.Date;
import java.util.Map;
import java.util.Set;

public class Group {

    private String groupName;

    private Map<Season, Set<Day>> schedule;

    public String getGroupName() {
        return groupName;
    }

    public void setGroupName(String groupName) {
        this.groupName = groupName;
    }

    public Map<Season, Set<Day>> getSchedule() {
        return schedule;
    }

    public void setSchedule(Map<Season, Set<Day>> schedule) {
        this.schedule = schedule;
    }

    public String getScheduleFor(Date date) {
        Season now = Season.getSeason(date);
        Set<Day> days = schedule.get(now);
        return Day.getDaysForDisplay(days);
    }

} 
```

编辑：此外，您的日期范围不考虑闰年：

> 我们的季节是这样的： 夏季（5-1 到 8-31） 春季（3-1 到 4-30） 秋季（9-1 到 10-31） 冬季（11-1 到 2-28）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-16T00:53:11.563

我同意你绝对应该把这个逻辑放在干净的界面后面：

```
public String lookupDays(String group, String date); 
```

但也许您应该将数据粘贴在属性文件中。我不反对在源文件中硬编码这些数据，但正如您所注意到的，Java 在嵌套集合方面可能会非常冗长。您的文件可能如下所示：

> A.夏天=M A.春天=
> tTS B.夏天
> =T

通常我不喜欢将这样的静态数据移动到外部文件，因为它增加了数据和使用它的代码之间的“距离”。但是，每当您处理嵌套集合，尤其是地图时，事情会变得非常丑陋，非常快。

如果你不喜欢这个想法，也许你可以这样做：

```
public class WaterScheduler
{
  private static final Map<String, String> GROUP2SEASON = new HashMap<String, String>();
  static
  {
    addEntry("A", "Summer", "M");
    addEntry("A", "Spring", "tTS");
    addEntry("B", "Summer", "T");
  }

  private static void addEntry(String group, String season, String value)
  {
    GROUP2SEASON.put(group + "." + season, value);
  }

} 
```

您失去了一些可读性，但至少数据更接近将要使用的位置。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-08-16T01:46:37.243

更好的解决方案可能是将所有数据放入数据库中，而不是在源中硬编码或使用属性文件。

使用数据库会更容易维护，并且有[多种](http://www.mysql.com/) [免费](http://hsqldb.sourceforge.net/)[的](http://www.postgresql.org/) [数据库](http://db.apache.org/derby/)引擎可供选择。

其中两个数据库引擎完全用 Java 实现，只需包含一个 jar 文件就可以嵌入到应用程序中。当然，它有点重量级，但它更具可扩展性且更易于维护。仅仅因为今天有 20 条记录并不意味着以后不会因为需求变化或功能蔓延而出现更多记录。

如果在几周或几个月后，您决定要添加例如一天中的浇水时间限制，那么如果您已经在使用数据库，那么添加该功能会容易得多。即使这从未发生过，您也已经花费了几个小时来学习如何在应用程序中嵌入数据库。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-08-16T04:35:49.557

“日期”是否必须是参数？如果您只是显示当前的浇水时间表，WateringSchedule 类本身可以计算出今天是哪一天，因此是什么季节。然后只需有一个方法返回一个映射，其中键是组字母。就像是：

```
public Map<String,List<String>> getGroupToScheduledDaysMap() {
  // instantiate a date or whatever to decide what Map to return
} 
```

然后在JSP页面中

```
<c:forEach var="day" items="${scheduler.groupToScheduledDaysMap["A"]}">
   ${day}
</c:forEach> 
```

如果您需要显示多个季节的时间表，您应该在 WateringSchedule 类中有一个方法，该方法返回一个地图，其中 Seasons 是键，然后 groupToScheduledDays 的 Maps 是值。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-08-15T23:27:13.673

没有漂亮的解决方案。Java 就是不能很好地完成这样的事情。如果您希望字符串作为索引（键），迈克的解决方案几乎就是这样做的方法。如果散列设置太难看，另一种选择是将字符串附加在一起（无耻地从 Mike 那里窃取并修改）：

```
Hashtable<String, String> schedule = new Hashtable<String, String>();
schedule.put("A-Winter", "M");
schedule.put("A-Spring", "tTS"); 
```

然后查找：

```
String val = schedule.get(group + "-" + season); 
```

如果您对一般的丑陋不满意（我不怪您），请将其全部放在方法调用后面：

```
String whenCanIWater(String group, Date date) { /* ugliness here */ } 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-01-30T01:55:14.090

# java - 尝试查看表时 Oracle SQL Developer 没有响应（或建议使用 Oracle Mac 客户端）

> ID：12877
> 
> 赞同：4
> 
> 时间：2008-08-15T23:15:27.470
> 
> 标签：java, oracle, macos

我整天都在拿沙滩球（几个小时都没有做任何事情）。它不占用 CPU，不从磁盘读取，不使用网络。

我在**Mac OS X 10.5.4上使用****Java 1.6**。它曾经工作过，现在即使重新启动计算机也无济于事。活动监视器说它是“（不响应）”。我唯一能做的就是杀死-9那个傻逼。

 **当我对过程进行采样时，我看到了：

```
 mach_msg_trap        16620
    read        831
    semaphore_wait_trap        831 
```

一个不能解决此问题的可接受答案将包括一个用于 Mac 的体面的免费 Oracle 客户端的 URL。

编辑：@Mark Harrison 可悲的是，每次我启动它时都会发生这种情况，这不是旧的连接。我想避免在我的笔记本电脑上运行 Windows。我正在为我的 IDE 提供一些插件，但对我来说仍然没有解决方案。@Matthew Schinckel Navicat 似乎只有一个非商业的 Oracle 产品......我需要一个商业友好的产品（即使它需要花钱）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-16T02:10:30.613

在活动连接闲置一段时间后，我遇到了同样的问题。我通过每隔一段时间重新启动 sql developer 来解决它。

我还在 vmware XP 会话上运行 Toad for Oracle，它运行良好。如果你不介意钱，那就试试吧。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-16T01:09:24.603

[Navicat](http://www.navicat.com/)公司已经发布了一个适用于 Mac 的 Oracle 客户端（他们也有一个 Windows 版本）。

它不是免费的，但我认为您可以获得 30 天的演示。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-08T16:42:26.330

你看过[http://www.aquafold.com/](http://www.aquafold.com/)吗？他们有一个非常适合 JDBC/java Mac 的实用程序，Aqua Data Studio (ADS)，我想你可以试用 30 天。它不是免费的，但是...

通过雅虎组提供出色的支持。非常敏感的重新错误或增强请求。

与他们没有任何关系——只是一个粉丝。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-20T10:37:59.277

[Squirrel](http://www.squirrelsql.org/)是一个很好的与数据库无关的应用程序开发客户端。没有 Oracle 特有的特性，但在 mac 上运行良好

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-19T00:09:08.910

我在 Mac 上使用 SQLDeveloper 并且遇到了它变得无响应的问题。通常，我可以通过进入活动监视器并终止进程来解决此问题。但是，这并不总是可以结束该过程。发生这种情况时，我会去终端并找到进程 ID 并向其发送 SIGKILL，然后下次它会正常工作。

然而，更重要的是，我曾一度评估[过 SQLGrinder](http://www.sqlgrinder.com/)。我最终没有购买该软件，主要是因为我有一台 Mac 笔记本电脑和一台 Windows 台式机。因此，我更经常在 Windows 桌面上使用 Toad，不值得为我购买 SQLGrinder。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-12-11T05:06:46.477

使用[RazorSQL](http://www.razorsql.com/)。帮自己一个忙，花 60 美元。它会在使用的一两个小时内收回成本。您甚至可以免费获得 60 天。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-08-26T10:16:58.950

最新版本的 SQL Developer 非常好，我在我的 Mac Pro 上没有遇到任何问题。DB Solo 3 也相当不错。**

# mysql - 什么是非规范化 mysql 数据库的好方法？

> ID：12890
> 
> 赞同：21
> 
> 时间：2008-08-15T23:36:30.207
> 
> 标签：mysql, database, denormalization

我有一个规范化订单数据的大型数据库，查询报告变得非常缓慢。我在报表中使用的许多查询连接了五六个表，并且必须检查数万或数十万行。

有很多查询，并且大多数都已尽可能优化以减少服务器负载并提高速度。我认为是时候开始以非规范化格式保存数据副本了。

关于方法的任何想法？我应该从几个最糟糕的查询开始，然后从那里开始吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-08-16T01:36:31.040

我对 mssql 和 mysql 有更多的了解，但我认为您所说的连接数或行数不会导致您在正确的索引上出现太多问题。您是否分析了查询计划以查看是否缺少任何内容？

[http://dev.mysql.com/doc/refman/5.0/en/explain.html](http://dev.mysql.com/doc/refman/5.0/en/explain.html)

话虽如此，一旦您对索引感到满意并用尽了所有其他途径，反规范化可能是正确的答案。如果您只有一个或两个查询有问题，那么手动方法可能是合适的，而某种数据仓库工具可能更适合创建一个平台来开发数据立方体。

这是我发现的一个涉及该主题的网站：

[http://www.meansandends.com/mysql-data-warehouse/?link_body%2Fbody=%7Bincl%3AAggregation%7D](http://www.meansandends.com/mysql-data-warehouse/?link_body%2Fbody=%7Bincl%3AAggregation%7D)

这是一种简单的技术，您可以使用它来保持非规范化查询的简单性，如果您一次只做几个（我不会替换您的 OLTP 表，只是创建一个新的用于报告目的）。假设您的应用程序中有此查询：

```
select a.name, b.address from tbla a 
join tblb b on b.fk_a_id = a.id where a.id=1 
```

您可以创建一个非规范化表并使用几乎相同的查询进行填充：

```
create table tbl_ab (a_id, a_name, b_address); 
-- (types elided) 
```

注意下划线与您使用的表别名匹配

```
insert tbl_ab select a.id, a.name, b.address from tbla a
join tblb b on b.fk_a_id = a.id 
-- no where clause because you want everything 
```

然后修复您的应用程序以使用新的非规范化表，将点切换为下划线。

```
select a_name as name, b_address as address 
from tbl_ab where a_id = 1; 
```

对于大型查询，这可以节省大量时间并明确数据的来源，并且您可以重复使用已有的查询。

请记住，我只是提倡将其作为最后的手段。我敢打赌，有一些索引会对您有所帮助。当你去规范化时，不要忘记考虑磁盘上的额外空间，并确定何时运行查询来填充新表。这可能应该在晚上，或者活动量低的时候。当然，该表中的数据永远不会是最新的。

[又一次编辑] 不要忘记您创建的新表也需要索引！好的部分是您可以索引到您的心脏内容而不必担心更新锁争用，因为除了您的批量插入之外，该表只会看到选择。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-16T00:04:20.523

MySQL 5 确实支持[视图](http://dev.mysql.com/doc/refman/5.0/en/create-view.html)，这在这种情况下可能会有所帮助。听起来您已经做了很多优化，但如果没有，您可以使用 MySQL 的[EXPLAIN](http://dev.mysql.com/doc/refman/5.0/en/explain.html)语法来查看实际使用的索引以及降低查询速度的原因。

至于规范化数据（无论您是使用视图还是以更有效的方式复制数据），我认为从最慢的查询开始并逐步完成是一个很好的方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-15T23:58:13.907

我知道这有点切题，但是您是否尝试过查看是否可以添加更多索引？

我没有很多数据库背景，但我最近经常使用数据库，我发现很多查询可以通过添加索引来改进。

我们正在使用 DB2，并且有一个命令叫做 db2expln 和 db2advis，第一个将指示是否正在使用表扫描与索引扫描，第二个将推荐您可以添加的索引以提高性能。我敢肯定 MySQL 有类似的工具......

无论如何，如果这是你还没有考虑过的事情，它对我有很大帮助......但如果你已经走了这条路，那么我想这不是你想要的。

另一种可能性是“物化视图”（或者他们在 DB2 中称之为），它允许您指定一个基本上由多个表的部分构建的表。因此，您可以提供此视图来访问数据，而不是规范化实际列……但我不知道这是否对插入/更新/删除有严重的性能影响（但如果它是“物化的”，那么它应该有助于选择，因为这些值是单独物理存储的）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-16T02:30:31.947

根据其他一些评论，我肯定会看看你的索引。

我今年早些时候在我们的 MySQL 数据库中发现的一件事是复合索引的强大功能。例如，如果您要报告日期范围内的订单号，则订单号和订单日期列的复合索引可能会有所帮助。我相信 MySQL 只能使用一个索引进行查询，因此如果您只是在订单号和订单日期上有单独的索引，则必须决定只使用其中一个。使用 EXPLAIN 命令可以帮助确定这一点。

为了说明良好索引（包括大量复合索引）的性能，我可以运行查询连接我们数据库中的 3 个表，并且在大多数情况下几乎可以立即获得结果。对于更复杂的报告，大多数查询在 10 秒内运行。这 3 个表分别有 3300 万、1.1 亿和 1.4 亿行。请注意，我们也已经对这些进行了轻微的规范化，以加快我们对数据库最常见的查询。

有关您的表格和报告查询类型的更多信息可能会提供进一步的建议。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-18T15:03:36.463

对于 MySQL，我喜欢这个演讲：[Real World Web: Performance & Scalability, MySQL Edition](http://develooper.com/talks/rww-mysql-2008.pdf)。这包含许多不同的建议，以提高 MySQL 的速度。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-16T00:20:37.887

您可能还需要考虑选择一个临时表，然后对该临时表执行查询。这将避免为您发出的每个查询重新加入您的表（当然，假设您可以将临时表用于大量查询）。这基本上为您提供了非规范化数据，但如果您只进行选择调用，则无需担心数据一致性。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-16T02:53:00.027

除了我之前的回答，我们在某些情况下采取的另一种方法是将关键报告数据存储在单独的汇总表中。即使在非规范化和优化之后，某些报告查询也会变得很慢，我们发现创建一个表并存储整个月的运行总计或摘要信息，这使得月末报告也更快。

我们发现这种方法很容易实现，因为它不会破坏任何已经在工作的东西——它只是在某些点进行额外的数据库插入。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-17T16:52:00.257

我一直在玩复合索引，并看到了一些真正的好处......也许我会设置一些测试，看看是否可以在这里拯救我......至少更长一点。

# php - 在php中解析原始电子邮件

> ID：12896
> 
> 赞同：33
> 
> 时间：2008-08-15T23:50:17.527
> 
> 标签：php, email

我正在寻找使用 PHP 代码将原始电子邮件解析为部分的良好/工作/简单的方法。

我已经写了几个蛮力解决方案，但是每次都会出现一个小的变化/标题/空间/某些东西，我的整个解析器都会失败，项目就会崩溃。

在我被指向 PEAR/PECL 之前，我需要实际的代码。我的主机有一些古怪的配置或其他东西，我似乎永远无法正确构建 .so。如果我确实得到了 .so，路径/环境/php.ini 的一些差异并不总是使其可用（apache vs cron vs CLI）。

哦，还有最后一件事，我正在解析原始电子邮件文本，而不是 POP3，而不是 IMAP。它通过 .qmail 电子邮件重定向传送到 PHP 脚本中。

我不希望 SOF 为我编写它，我正在寻找一些“正确”的技巧/起点。这是我知道已经解决的那些“轮子”问题之一。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-08-16T02:18:11.893

你希望最后得到什么？正文、主题、发件人、附件？您应该花一些时间了解[RFC2822](http://www.faqs.org/rfcs/rfc2822.html)以了解邮件的格式，但以下是格式正确的电子邮件的最简单规则：

```
HEADERS\n
\n
BODY 
```

也就是说，第一个空行（双换行符）是 HEADERS 和 BODY 之间的分隔符。标题看起来像这样：

```
HSTRING:HTEXT 
```

HSTRING 始终从行首开始，并且不包含任何空格或冒号。HTEXT 可以包含多种文本，包括换行符，只要换行符后跟空格即可。

“BODY”实际上只是第一个双换行符之后的任何数据。（如果您通过 SMTP 传输邮件，则有不同的规则，但通过管道处理它，您不必担心）。

因此，用非常简单的大约 1982 年[RFC822](http://www.faqs.org/rfcs/rfc822.html)术语来说，一封电子邮件如下所示：

```
HEADER: HEADER TEXT
HEADER: MORE HEADER TEXT
  INCLUDING A LINE CONTINUATION
HEADER: LAST HEADER

THIS IS ANY
ARBITRARY DATA
(FOR THE MOST PART) 
```

大多数现代电子邮件都比这更复杂。标头可以编码为字符集或[RFC2047](http://www.faqs.org/rfcs/rfc2047.html)哑剧词，或者我现在没有想到的大量其他内容。如果您希望它们有意义，这些天真的很难滚动您自己的代码。几乎所有由 MUA 生成的电子邮件都将进行[MIME](http://www.faqs.org/rfcs/rfc2045.html)编码。那可能是 uuencoded 文本，它可能是 html，它可能是一个 uuencoded excel 电子表格。

我希望这有助于为理解一些非常基本的电子邮件桶提供一个框架。如果您提供更多有关您尝试处理数据的背景信息，我（或其他人）可能会提供更好的指导。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2011-05-15T21:56:52.790

试试 Plancake PHP 电子邮件解析器： [https ://github.com/plancake/official-library-php-email-parser](https://github.com/plancake/official-library-php-email-parser)

我已经将它用于我的项目。它工作得很好，它只是一个类，它是开源的。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-05-10T18:27:22.740

我把它拼凑在一起，一些代码不是我的，但我不知道它来自哪里......我后来采用了更强大的“MimeMailParser”，但这很好用，我使用 cPanel 将我的默认电子邮件发送给它，它可以工作伟大的。

```
#!/usr/bin/php -q
<?php
// Config
$dbuser = 'emlusr';
$dbpass = 'pass';
$dbname = 'email';
$dbhost = 'localhost';
$notify= 'services@.com'; // an email address required in case of errors
function mailRead($iKlimit = "") 
    { 
        // Purpose: 
        //   Reads piped mail from STDIN 
        // 
        // Arguements: 
        //   $iKlimit (integer, optional): specifies after how many kilobytes reading of mail should stop 
        //   Defaults to 1024k if no value is specified 
        //     A value of -1 will cause reading to continue until the entire message has been read 
        // 
        // Return value: 
        //   A string containing the entire email, headers, body and all. 

        // Variable perparation         
            // Set default limit of 1024k if no limit has been specified 
            if ($iKlimit == "") { 
                $iKlimit = 1024; 
            } 

            // Error strings 
            $sErrorSTDINFail = "Error - failed to read mail from STDIN!"; 

        // Attempt to connect to STDIN 
        $fp = fopen("php://stdin", "r"); 

        // Failed to connect to STDIN? (shouldn't really happen) 
        if (!$fp) { 
            echo $sErrorSTDINFail; 
            exit(); 
        } 

        // Create empty string for storing message 
        $sEmail = ""; 

        // Read message up until limit (if any) 
        if ($iKlimit == -1) { 
            while (!feof($fp)) { 
                $sEmail .= fread($fp, 1024); 
            }                     
        } else { 
            while (!feof($fp) && $i_limit < $iKlimit) { 
                $sEmail .= fread($fp, 1024); 
                $i_limit++; 
            }         
        } 

        // Close connection to STDIN 
        fclose($fp); 

        // Return message 
        return $sEmail; 
    }  
$email = mailRead();

// handle email
$lines = explode("\n", $email);

// empty vars
$from = "";
$subject = "";
$headers = "";
$message = "";
$splittingheaders = true;
for ($i=0; $i < count($lines); $i++) {
    if ($splittingheaders) {
        // this is a header
        $headers .= $lines[$i]."\n";

        // look out for special headers
        if (preg_match("/^Subject: (.*)/", $lines[$i], $matches)) {
            $subject = $matches[1];
        }
        if (preg_match("/^From: (.*)/", $lines[$i], $matches)) {
            $from = $matches[1];
        }
        if (preg_match("/^To: (.*)/", $lines[$i], $matches)) {
            $to = $matches[1];
        }
    } else {
        // not a header, but message
        $message .= $lines[$i]."\n";
    }

    if (trim($lines[$i])=="") {
        // empty line, header section has ended
        $splittingheaders = false;
    }
}

if ($conn = @mysql_connect($dbhost,$dbuser,$dbpass)) {
  if(!@mysql_select_db($dbname,$conn))
    mail($email,'Email Logger Error',"There was an error selecting the email logger database.\n\n".mysql_error());
  $from    = mysql_real_escape_string($from);
  $to    = mysql_real_escape_string($to);
  $subject = mysql_real_escape_string($subject);
  $headers = mysql_real_escape_string($headers);
  $message = mysql_real_escape_string($message);
  $email   = mysql_real_escape_string($email);
  $result = @mysql_query("INSERT INTO email_log (`to`,`from`,`subject`,`headers`,`message`,`source`) VALUES('$to','$from','$subject','$headers','$message','$email')");
  if (mysql_affected_rows() == 0)
    mail($notify,'Email Logger Error',"There was an error inserting into the email logger database.\n\n".mysql_error());
} else {
  mail($notify,'Email Logger Error',"There was an error connecting the email logger database.\n\n".mysql_error());
}
?> 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-11-05T14:36:40.127

您可以尝试使用 Mailparse 函数：http://php.net/manual/en/book.mailparse.php [，](http://php.net/manual/en/book.mailparse.php)但不在默认的 php conf 中。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-11-07T20:49:34.487

Pear 库 Mail_mimeDecode 是用纯 PHP 编写的，您可以在此处查看：[Mail_mimeDecode 源](http://svn.php.net/viewvc/pear/packages/Mail_mimeDecode/trunk/Mail/mimeDecode.php?revision=337165&view=markup)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-07-02T13:51:57.273

有一个用于将原始电子邮件消息解析为 php 数组的库 - [http://flourishlib.com/api/fMailbox#parseMessage](http://flourishlib.com/api/fMailbox#parseMessage)。

> 静态方法 parseMessage() 可用于将完整的 MIME 电子邮件解析为与 fetchMessage() 返回相同的格式，减去 uid 键。
> 
> $parsed_message = fMailbox::parseMessage(file_get_contents('/path/to/email'));
> 
> 以下是已解析消息的示例：

```
array(
    'received' => '28 Apr 2010 22:00:38 -0400',
    'headers'  => array(
        'received' => array(
            0 => '(qmail 25838 invoked from network); 28 Apr 2010 22:00:38 -0400',
            1 => 'from example.com (HELO ?192.168.10.2?) (example) by example.com with (DHE-RSA-AES256-SHA encrypted) SMTP; 28 Apr 2010 22:00:38 -0400'
        ),
        'message-id' => '<4BD8E815.1050209@flourishlib.com>',
        'date' => 'Wed, 28 Apr 2010 21:59:49 -0400',
        'from' => array(
            'personal' => 'Will Bond',
            'mailbox'  => 'tests',
            'host'     => 'flourishlib.com'
        ),
        'user-agent'   => 'Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.1.9) Gecko/20100317 Thunderbird/3.0.4',
        'mime-version' => '1.0',
        'to' => array(
            0 => array(
                'mailbox' => 'tests',
                'host'    => 'flourishlib.com'
            )
        ),
        'subject' => 'This message is encrypted'
    ),
    'text'      => 'This message is encrypted',
    'decrypted' => TRUE,
    'uid'       => 15
); 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-11-23T12:34:43.630

这个[https://github.com/zbateson/MailMimeParser](https://github.com/zbateson/MailMimeParser)对我有用，不需要 mailparse 扩展。

```
<?php
echo $message->getHeaderValue('from');          // user@example.com
echo $message
    ->getHeader('from')
    ->getPersonName();                          // Person Name
echo $message->getHeaderValue('subject');       // The email's subject

echo $message->getTextContent();                // or getHtmlContent 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-16T16:06:14.577

编写自己的 MIME 解析器可能不会有太多乐趣。您发现“过度开发的邮件处理包”的原因是因为 MIME 是一组非常复杂的规则/格式/编码。MIME 部分可以递归，这是乐趣的一部分。我认为您最好的选择是编写最好的 MIME 处理程序，解析消息，丢弃所有不是 text/plain 或 text/html 的内容，然后强制传入字符串中的命令以 COMMAND: 或类似内容作为前缀这样你就可以在泥土中找到它。如果你从这样的规则开始，你就有很大的机会处理新的提供者，但你应该准备好在新的提供者出现时进行调整（或者，如果你当前的提供者选择改变他们的消息传递架构）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-08-16T18:19:41.810

我不确定这是否会对您有所帮助——希望如此——但它肯定会帮助其他有兴趣了解更多关于电子邮件的人。[Marcus Bointon](http://marcus.bointon.com/)在今年 3 月的 PHP 伦敦会议上做了题为“Mail() 和 Mail() 之后的生活”的最佳演讲之一，[幻灯片](http://www.phpconference.co.uk/media/docs/marcus_bointon_mail_presentation.pdf)和[MP3](http://www.phpconference.co.uk/media/audio/mail_and_life_beyond_mail_marcus_bointon.mp3)在线。他说话有一定的权威性，曾在电子邮件和 PHP 方面进行过深入的广泛工作。

我的看法是，您在尝试编写一个真正通用的解析器时遇到了一个痛苦的世界。

编辑 - PHP London 网站上的文件似乎已被删除；在 Marcus[自己的网站](http://marcus.bointon.com/archives/53-PHPLondon.html)上找到了幻灯片：[第 1](http://marcus.bointon.com/uploads/MarcusBointonMailpresentation.pdf) [部分第 2 部分](http://marcus.bointon.com/uploads/MarcusBointonLifeaftermailpresentation.pdf)虽然在任何地方都看不到 MP3

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-11-20T20:49:47.417

在 PHP 中解析电子邮件并非不可能完成的任务。我的意思是，你不需要一个工程师团队来做这件事；作为个人是可以实现的。我发现真正最困难的部分是创建 FSM 来解析 IMAP BODYSTRUCTURE 结果。我在 Internet 上的任何地方都没有看到这个，所以我自己写了。我的例程基本上从命令输出创建了一个嵌套数组的数组，数组中的深度大致对应于执行查找所需的部件号。所以它非常优雅地处理嵌套的 MIME 结构。

问题是 PHP 的默认 imap_* 函数没有提供太多粒度......所以我必须打开一个到 IMAP 端口的套接字并编写函数来发送和检索必要的信息（IMAP FETCH 1 BODY.PEEK[1.2]例如），这涉及查看 RFC 文档。

数据的编码（quoted-printable、base64、7bit、8bit等）、消息长度、content-type等都提供给您；对于附件、文本、html 等。您可能还必须弄清楚邮件服务器的细微差别，因为并非所有字段都始终 100% 实现。

宝石是 FSM……如果你有 Comp Sci 的背景，那么做这个真的很有趣（关键是括号不是常规语法；））；否则，使用传统方法将是一场斗争和/或导致丑陋的代码。你也需要一些时间！

希望这可以帮助！

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-08-16T05:09:11.907

是的，我已经能够根据 rfc 和其他一些基本教程编写一个基本的解析器。但它的多部分 mime 嵌套边界一直让我感到困惑。

我发现从我的手机发送的彩信（不是短信）只是标准电子邮件，所以我有一个系统可以读取传入的电子邮件，检查发件人（只允许来自我的手机），并使用正文部分运行不同的我的服务器上的命令。它有点像通过电子邮件进行的远程控制。

因为该系统是为发送图片而设计的，所以它有一堆不同编码的部分。一个 mms.smil.txt 部分，一个 text/plain（没用，只是说“这是一条 html 消息”），一个 application/smil 部分（手机会在上面拍照的部分），一个 text/html 部分有我的运营商的广告，然后是我的消息，但全部用 html 包装，最后是带有我的纯消息的文本文件附件（这是我使用的部分）（如果我将图像作为附件推到消息中，则放在附件 1，base64 编码，然后我的文本部分作为附件 2 附加）

我让它与我的运营商的确切邮件格式一起工作，但是当我通过它从别人的电话中运行一条消息时，它以一大堆悲惨的方式失败了。

我有其他项目我想将此电话->邮件->解析->命令系统扩展到，但我需要有一个稳定/可靠/通用的解析器来从邮件中取出不同的部分来使用它。

我的最终目标是拥有一个函数，我可以将原始管道邮件输入，并取回一个大数组，其中包含标题 var:val 对的关联子数组，一个用于将正文文本作为整个字符串

我在这方面搜索得越多，我就越发现相同的东西：巨大的过度开发的邮件处理包，它们可以在阳光下完成与邮件相关的所有事情，或者无用的（对我来说，在这个项目中）教程。

我想我将不得不咬紧牙关，认真地写一些我自己的东西。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-11-08T21:27:33.653

这个库工作得很好：

[http://www.phpclasses.org/package/3169-PHP-Decode-MIME-e-mail-messages.html](http://www.phpclasses.org/package/3169-PHP-Decode-MIME-e-mail-messages.html)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-10-23T21:47:40.823

我遇到了同样的问题，所以我编写了以下类：Email_Parser。它接收原始电子邮件并将其变成一个不错的对象。

它需要 PEAR Mail_mimeDecode，但应该很容易通过 WHM 或直接从命令行安装。

在这里获取：[https ://github.com/optimumweb/php-email-reader-parser](https://github.com/optimumweb/php-email-reader-parser)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-11-04T12:15:35.260

简单的 PhpMimeParser [https://github.com/breakermind/PhpMimeParser](https://github.com/breakermind/PhpMimeParser) Yuo可以从文件、字符串中剪切 mime 消息。获取文件、html 和内联图像。

```
$str = file_get_contents('mime-mixed-related-alternative.eml');

// MimeParser
$m = new PhpMimeParser($str);

// Emails
print_r($m->mTo);
print_r($m->mFrom);

// Message
echo $m->mSubject;
echo $m->mHtml;
echo $m->mText;

// Attachments and inline images
print_r($m->mFiles);
print_r($m->mInlineList); 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-06-10T15:06:19.537

如果您尝试从 Docker 容器执行此操作，请在构建时使用 PEAR 安装 Mail 和 Mail_mimeDecode。

```
FROM php:7.4-apache
WORKDIR /var/www/html
EXPOSE 80
WORKDIR /var/www
RUN chown -R www-data html
RUN docker-php-ext-install mysqli
RUN pear install --alldeps mail
RUN pear install Mail_mimeDecode 
```

然后在您的 PHP 代码中，如下所示：

```
<?php

require_once "/usr/local/lib/php/Mail.php";
require_once "/usr/local/lib/php/Mail/mimeDecode.php";

$mailfiles = ['/var/www/mail/mailFile1','/var/www/mail/mailFile2'];

foreach($mailfiles as $filename){
    $theFile = fopen($filename, "r") or die("Unable to open file!");
    $rawEmail = fread($theFile, filesize($filename));
    fclose($theFile);

    $args = [];
    $args['include_bodies'] = true;
    $args['decode_bodies'] = FALSE;
    $args['decode_headers'] = FALSE;
    $objMail = new Mail_mimeDecode($rawEmail);
    $return = $objMail->decode($args);

    if (PEAR::isError($return)) {
        echo("<p>" . $return->getMessage() . "</p>");
        var_dump($return);
    } else {
        //echo("No error in PEAR::isError(return)");
    }

    if($return->body){
        $decoded = base64_decode($return->body, true);
        var_dump($decoded);
    }//end if(body)

}//end foreach(mailfiles as file)

?> 
```

# ms-office - 创建操纵设计时表单的 Infopath 2007 插件

> ID：12905
> 
> 赞同：2
> 
> 时间：2008-08-16T00:08:23.637
> 
> 标签：ms-office, infopath

我正在尝试为 Infopath 2007 创建一个加载项。文档非常少。我试图确定的是加载项在设计表单时可以采取什么样的操作。大多数讨论和示例都是针对用户填写表格时的。例如，我可以在设计器的表单中添加一个新字段吗？向架构中添加新项目？在设计图面上移动表单域？它似乎不是这样，但我找不到任何确定的东西。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-08-28T08:03:27.693

InfoPath 设计器没有对象模型。

我相信您可以获得的最接近的是 InfoPath 支持的 Visual Studio 托管的公开 API；但我不相信这会给你你想要的设计师的程序控制。

[http://msdn.microsoft.com/en-us/library/aa813327.aspx#office2007infopathVSTO_InfoPathDesignerAPIIntegratingInfoPath2007VisualStudio](http://msdn.microsoft.com/en-us/library/aa813327.aspx#office2007infopathVSTO_InfoPathDesignerAPIIntegratingInfoPath2007VisualStudio "用于将 InfoPath 2007 集成到 Visual Studio 2005 的 InfoPath Designer API 概述")

对不起凯文。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-03T02:11:55.573

不幸的是，布莱恩可能是对的。我已经尝试制作一个用于 InfoPath 开发的 VS 插件。它非常严格且难以使用。对于快速编写脚本工作不是很有效。

我发现[AutoHotKey](http://www.autohotkey.com/)是与 InfoPath 一起使用的最佳临时脚本工具。它不直接与 InfoPath 集成，但我发现键+鼠标自动化可以完成我需要的大部分工作。

# sql-server - 找出完整的 SQL Server 数据库大小

> ID：12906
> 
> 赞同：8
> 
> 时间：2008-08-16T00:10:24.443
> 
> 标签：sql-server

我需要知道 SQL Server 2000 中的所有数据库占用了多少空间。我做了一些研究，但找不到任何脚本来帮助我。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-16T00:19:14.863

来源：[http](http://searchsqlserver.techtarget.com/tip/0,289483,sid87_gci1313431,00.html) : //searchsqlserver.techtarget.com/tip/0,289483,sid87_gci1313431,00.html 适用于 SQL2000,2005,2008

```
USE master;
GO

IF OBJECT_ID('dbo.sp_SDS', 'P') IS NOT NULL
  DROP PROCEDURE dbo.sp_SDS;
GO

CREATE PROCEDURE dbo.sp_SDS 
  @TargetDatabase sysname = NULL,     --  NULL: all dbs
  @Level varchar(10) = 'Database',    --  or "File"
  @UpdateUsage bit = 0,               --  default no update
  @Unit char(2) = 'MB'                --  Megabytes, Kilobytes or Gigabytes
AS

/**************************************************************************************************
**
**  author: Richard Ding
**  date:   4/8/2008
**  usage:  list db size AND path w/o SUMmary
**  test code: sp_SDS   --  default behavior
**             sp_SDS 'maAster'
**             sp_SDS NULL, NULL, 0
**             sp_SDS NULL, 'file', 1, 'GB'
**             sp_SDS 'Test_snapshot', 'Database', 1
**             sp_SDS 'Test', 'File', 0, 'kb'
**             sp_SDS 'pfaids', 'Database', 0, 'gb'
**             sp_SDS 'tempdb', NULL, 1, 'kb'
**   
**************************************************************************************************/

SET NOCOUNT ON;

IF @TargetDatabase IS NOT NULL AND DB_ID(@TargetDatabase) IS NULL
  BEGIN
    RAISERROR(15010, -1, -1, @TargetDatabase);
    RETURN (-1)
  END

IF OBJECT_ID('tempdb.dbo.##Tbl_CombinedInfo', 'U') IS NOT NULL
  DROP TABLE dbo.##Tbl_CombinedInfo;

IF OBJECT_ID('tempdb.dbo.##Tbl_DbFileStats', 'U') IS NOT NULL
  DROP TABLE dbo.##Tbl_DbFileStats;

IF OBJECT_ID('tempdb.dbo.##Tbl_ValidDbs', 'U') IS NOT NULL
  DROP TABLE dbo.##Tbl_ValidDbs;

IF OBJECT_ID('tempdb.dbo.##Tbl_Logs', 'U') IS NOT NULL
  DROP TABLE dbo.##Tbl_Logs;

CREATE TABLE dbo.##Tbl_CombinedInfo (
  DatabaseName sysname NULL, 
  [type] VARCHAR(10) NULL, 
  LogicalName sysname NULL,
  T dec(10, 2) NULL,
  U dec(10, 2) NULL,
  [U(%)] dec(5, 2) NULL,
  F dec(10, 2) NULL,
  [F(%)] dec(5, 2) NULL,
  PhysicalName sysname NULL );

CREATE TABLE dbo.##Tbl_DbFileStats (
  Id int identity, 
  DatabaseName sysname NULL, 
  FileId int NULL, 
  FileGroup int NULL, 
  TotalExtents bigint NULL, 
  UsedExtents bigint NULL, 
  Name sysname NULL, 
  FileName varchar(255) NULL );

CREATE TABLE dbo.##Tbl_ValidDbs (
  Id int identity, 
  Dbname sysname NULL );

CREATE TABLE dbo.##Tbl_Logs (
  DatabaseName sysname NULL, 
  LogSize dec (10, 2) NULL, 
  LogSpaceUsedPercent dec (5, 2) NULL,
  Status int NULL );

DECLARE @Ver varchar(10), 
        @DatabaseName sysname, 
        @Ident_last int, 
        @String varchar(2000),
        @BaseString varchar(2000);

SELECT @DatabaseName = '', 
       @Ident_last = 0, 
       @String = '', 
       @Ver = CASE WHEN @@VERSION LIKE '%9.0%' THEN 'SQL 2005' 
                   WHEN @@VERSION LIKE '%8.0%' THEN 'SQL 2000' 
                   WHEN @@VERSION LIKE '%10.0%' THEN 'SQL 2008' 
              END;

SELECT @BaseString = 
' SELECT DB_NAME(), ' + 
CASE WHEN @Ver = 'SQL 2000' THEN 'CASE WHEN status & 0x40 = 0x40 THEN ''Log''  ELSE ''Data'' END' 
  ELSE ' CASE type WHEN 0 THEN ''Data'' WHEN 1 THEN ''Log'' WHEN 4 THEN ''Full-text'' ELSE ''reserved'' END' END + 
', name, ' + 
CASE WHEN @Ver = 'SQL 2000' THEN 'filename' ELSE 'physical_name' END + 
', size*8.0/1024.0 FROM ' + 
CASE WHEN @Ver = 'SQL 2000' THEN 'sysfiles' ELSE 'sys.database_files' END + 
' WHERE '
+ CASE WHEN @Ver = 'SQL 2000' THEN ' HAS_DBACCESS(DB_NAME()) = 1' ELSE 'state_desc = ''ONLINE''' END + '';

SELECT @String = 'INSERT INTO dbo.##Tbl_ValidDbs SELECT name FROM ' + 
                 CASE WHEN @Ver = 'SQL 2000' THEN 'master.dbo.sysdatabases' 
                      WHEN @Ver IN ('SQL 2005', 'SQL 2008') THEN 'master.sys.databases' 
                 END + ' WHERE HAS_DBACCESS(name) = 1 ORDER BY name ASC';
EXEC (@String);

INSERT INTO dbo.##Tbl_Logs EXEC ('DBCC SQLPERF (LOGSPACE) WITH NO_INFOMSGS');

--  For data part
IF @TargetDatabase IS NOT NULL
  BEGIN
    SELECT @DatabaseName = @TargetDatabase;
    IF @UpdateUsage <> 0 AND DATABASEPROPERTYEX (@DatabaseName,'Status') = 'ONLINE' 
          AND DATABASEPROPERTYEX (@DatabaseName, 'Updateability') <> 'READ_ONLY'
      BEGIN
        SELECT @String = 'USE [' + @DatabaseName + '] DBCC UPDATEUSAGE (0)';
        PRINT '*** ' + @String + ' *** ';
        EXEC (@String);
        PRINT '';
      END

    SELECT @String = 'INSERT INTO dbo.##Tbl_CombinedInfo (DatabaseName, type, LogicalName, PhysicalName, T) ' + @BaseString; 

    INSERT INTO dbo.##Tbl_DbFileStats (FileId, FileGroup, TotalExtents, UsedExtents, Name, FileName)
          EXEC ('USE [' + @DatabaseName + '] DBCC SHOWFILESTATS WITH NO_INFOMSGS');
    EXEC ('USE [' + @DatabaseName + '] ' + @String);

    UPDATE dbo.##Tbl_DbFileStats SET DatabaseName = @DatabaseName; 
  END
ELSE
  BEGIN
    WHILE 1 = 1
      BEGIN
        SELECT TOP 1 @DatabaseName = Dbname FROM dbo.##Tbl_ValidDbs WHERE Dbname > @DatabaseName ORDER BY Dbname ASC;
        IF @@ROWCOUNT = 0
          BREAK;
        IF @UpdateUsage <> 0 AND DATABASEPROPERTYEX (@DatabaseName, 'Status') = 'ONLINE' 
              AND DATABASEPROPERTYEX (@DatabaseName, 'Updateability') <> 'READ_ONLY'
          BEGIN
            SELECT @String = 'DBCC UPDATEUSAGE (''' + @DatabaseName + ''') ';
            PRINT '*** ' + @String + '*** ';
            EXEC (@String);
            PRINT '';
          END

        SELECT @Ident_last = ISNULL(MAX(Id), 0) FROM dbo.##Tbl_DbFileStats;

        SELECT @String = 'INSERT INTO dbo.##Tbl_CombinedInfo (DatabaseName, type, LogicalName, PhysicalName, T) ' + @BaseString; 

        EXEC ('USE [' + @DatabaseName + '] ' + @String);

        INSERT INTO dbo.##Tbl_DbFileStats (FileId, FileGroup, TotalExtents, UsedExtents, Name, FileName)
          EXEC ('USE [' + @DatabaseName + '] DBCC SHOWFILESTATS WITH NO_INFOMSGS');

        UPDATE dbo.##Tbl_DbFileStats SET DatabaseName = @DatabaseName WHERE Id BETWEEN @Ident_last + 1 AND @@IDENTITY;
      END
  END

--  set used size for data files, do not change total obtained from sys.database_files as it has for log files
UPDATE dbo.##Tbl_CombinedInfo 
SET U = s.UsedExtents*8*8/1024.0 
FROM dbo.##Tbl_CombinedInfo t JOIN dbo.##Tbl_DbFileStats s 
ON t.LogicalName = s.Name AND s.DatabaseName = t.DatabaseName;

--  set used size and % values for log files:
UPDATE dbo.##Tbl_CombinedInfo 
SET [U(%)] = LogSpaceUsedPercent, 
U = T * LogSpaceUsedPercent/100.0
FROM dbo.##Tbl_CombinedInfo t JOIN dbo.##Tbl_Logs l 
ON l.DatabaseName = t.DatabaseName 
WHERE t.type = 'Log';

UPDATE dbo.##Tbl_CombinedInfo SET F = T - U, [U(%)] = U*100.0/T;

UPDATE dbo.##Tbl_CombinedInfo SET [F(%)] = F*100.0/T;

IF UPPER(ISNULL(@Level, 'DATABASE')) = 'FILE'
  BEGIN
    IF @Unit = 'KB'
      UPDATE dbo.##Tbl_CombinedInfo
      SET T = T * 1024, U = U * 1024, F = F * 1024;

    IF @Unit = 'GB'
      UPDATE dbo.##Tbl_CombinedInfo
      SET T = T / 1024, U = U / 1024, F = F / 1024;

    SELECT DatabaseName AS 'Database',
      type AS 'Type',
      LogicalName,
      T AS 'Total',
      U AS 'Used',
      [U(%)] AS 'Used (%)',
      F AS 'Free',
      [F(%)] AS 'Free (%)',
      PhysicalName
      FROM dbo.##Tbl_CombinedInfo 
      WHERE DatabaseName LIKE ISNULL(@TargetDatabase, '%') 
      ORDER BY DatabaseName ASC, type ASC;

    SELECT CASE WHEN @Unit = 'GB' THEN 'GB' WHEN @Unit = 'KB' THEN 'KB' ELSE 'MB' END AS 'SUM',
        SUM (T) AS 'TOTAL', SUM (U) AS 'USED', SUM (F) AS 'FREE' FROM dbo.##Tbl_CombinedInfo;
  END

IF UPPER(ISNULL(@Level, 'DATABASE')) = 'DATABASE'
  BEGIN
    DECLARE @Tbl_Final TABLE (
      DatabaseName sysname NULL,
      TOTAL dec (10, 2),
      [=] char(1),
      used dec (10, 2),
      [used (%)] dec (5, 2),
      [+] char(1),
      free dec (10, 2),
      [free (%)] dec (5, 2),
      [==] char(2),
      Data dec (10, 2),
      Data_Used dec (10, 2),
      [Data_Used (%)] dec (5, 2),
      Data_Free dec (10, 2),
      [Data_Free (%)] dec (5, 2),
      [++] char(2),
      Log dec (10, 2),
      Log_Used dec (10, 2),
      [Log_Used (%)] dec (5, 2),
      Log_Free dec (10, 2),
      [Log_Free (%)] dec (5, 2) );

    INSERT INTO @Tbl_Final
      SELECT x.DatabaseName, 
           x.Data + y.Log AS 'TOTAL', 
           '=' AS '=', 
           x.Data_Used + y.Log_Used AS 'U',
           (x.Data_Used + y.Log_Used)*100.0 / (x.Data + y.Log)  AS 'U(%)',
           '+' AS '+',
           x.Data_Free + y.Log_Free AS 'F',
           (x.Data_Free + y.Log_Free)*100.0 / (x.Data + y.Log)  AS 'F(%)',
           '==' AS '==',
           x.Data, 
           x.Data_Used, 
           x.Data_Used*100/x.Data AS 'D_U(%)',
           x.Data_Free, 
           x.Data_Free*100/x.Data AS 'D_F(%)',
           '++' AS '++', 
           y.Log, 
           y.Log_Used, 
           y.Log_Used*100/y.Log AS 'L_U(%)',
           y.Log_Free, 
           y.Log_Free*100/y.Log AS 'L_F(%)'
      FROM 
      ( SELECT d.DatabaseName, 
               SUM(d.T) AS 'Data', 
               SUM(d.U) AS 'Data_Used', 
               SUM(d.F) AS 'Data_Free' 
          FROM dbo.##Tbl_CombinedInfo d WHERE d.type = 'Data' GROUP BY d.DatabaseName ) AS x
      JOIN 
      ( SELECT l.DatabaseName, 
               SUM(l.T) AS 'Log', 
               SUM(l.U) AS 'Log_Used', 
               SUM(l.F) AS 'Log_Free' 
          FROM dbo.##Tbl_CombinedInfo l WHERE l.type = 'Log' GROUP BY l.DatabaseName ) AS y
      ON x.DatabaseName = y.DatabaseName;

    IF @Unit = 'KB'
      UPDATE @Tbl_Final SET TOTAL = TOTAL * 1024,
      used = used * 1024,
      free = free * 1024,
      Data = Data * 1024,
      Data_Used = Data_Used * 1024,
      Data_Free = Data_Free * 1024,
      Log = Log * 1024,
      Log_Used = Log_Used * 1024,
      Log_Free = Log_Free * 1024;

     IF @Unit = 'GB'
      UPDATE @Tbl_Final SET TOTAL = TOTAL / 1024,
      used = used / 1024,
      free = free / 1024,
      Data = Data / 1024,
      Data_Used = Data_Used / 1024,
      Data_Free = Data_Free / 1024,
      Log = Log / 1024,
      Log_Used = Log_Used / 1024,
      Log_Free = Log_Free / 1024;

      DECLARE @GrantTotal dec(11, 2);
      SELECT @GrantTotal = SUM(TOTAL) FROM @Tbl_Final;

      SELECT 
      CONVERT(dec(10, 2), TOTAL*100.0/@GrantTotal) AS 'WEIGHT (%)', 
      DatabaseName AS 'DATABASE',
      CONVERT(VARCHAR(12), used) + '  (' + CONVERT(VARCHAR(12), [used (%)]) + ' %)' AS 'USED  (%)',
      [+],
      CONVERT(VARCHAR(12), free) + '  (' + CONVERT(VARCHAR(12), [free (%)]) + ' %)' AS 'FREE  (%)',
      [=],
      TOTAL, 
      [=],
      CONVERT(VARCHAR(12), Data) + '  (' + CONVERT(VARCHAR(12), Data_Used) + ',  ' + 
      CONVERT(VARCHAR(12), [Data_Used (%)]) + '%)' AS 'DATA  (used,  %)',
      [+],
      CONVERT(VARCHAR(12), Log) + '  (' + CONVERT(VARCHAR(12), Log_Used) + ',  ' + 
      CONVERT(VARCHAR(12), [Log_Used (%)]) + '%)' AS 'LOG  (used,  %)'
        FROM @Tbl_Final 
        WHERE DatabaseName LIKE ISNULL(@TargetDatabase, '%')
        ORDER BY DatabaseName ASC;

    IF @TargetDatabase IS NULL
      SELECT CASE WHEN @Unit = 'GB' THEN 'GB' WHEN @Unit = 'KB' THEN 'KB' ELSE 'MB' END AS 'SUM', 
      SUM (used) AS 'USED', 
      SUM (free) AS 'FREE', 
      SUM (TOTAL) AS 'TOTAL', 
      SUM (Data) AS 'DATA', 
      SUM (Log) AS 'LOG' 
      FROM @Tbl_Final;
  END

RETURN (0)

GO 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-16T00:15:10.940

我知道这可能听起来有点神秘，但为什么不只是统计包含数据库的目录。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-01-13T03:47:00.927

如果您使用 SQL Server Management Studio（从 SQL 2005 或更高版本），您只需右键单击数据库本身的属性，然后单击存储选项卡。

# java - 如果您的 Java 应用程序在不做任何事情时正在消耗 CPU，您如何确定它在做什么？

> ID：12927
> 
> 赞同：16
> 
> 时间：2008-08-16T00:45:38.210
> 
> 标签：java, profiling

我正在调用供应商的 Java API，在某些服务器上，JVM 在登录 API 后似乎进入了低优先级轮询循环（CPU 使用率为 100%）。其他服务器上的同一应用程序不会出现此行为。这发生在 WebSphere 和 Tomcat 上。环境设置起来很棘手，因此很难尝试在 Eclipse 中进行分析。

有没有办法分析（或其他检查方法）在 Tomcat 中运行的现有 Java 应用程序，以找出处于这种 spinwait 状态时正在执行的方法？当应用程序处于此状态时，它只执行一种方法（供应商的方法）。供应商无法复制该行为（当然）。

* * *

更新：

使用 JConsole，我能够确定谁在运行以及他们在做什么。我花了几个小时才弄清楚它为什么这样做。问题最终是正在使用的供应商 API jar 与它正在使用的数据库配置不完全匹配。默认情况下，在配置略有不匹配的服务器上启用跟踪和性能监控。我用了一个不同的罐子，一切都很好。

所以，谢谢，约书亚，你的回答。JConsole 非常易于设置和用于监控现有应用程序。

@Cringe - 我对您建议的一些选项进行了一些试验。我在设置 JProfiler 时遇到了一些问题，它看起来不错（但价格昂贵）。展望未来，我继续添加了 Eclipse Profiler 插件，我将查看不同的开源分析器以比较功能。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-08-16T02:12:04.090

如果您使用的是 Java 5 或更高版本，则可以使用[jconsole](http://docs.oracle.com/javase/6/docs/technotes/guides/management/jconsole.html)连接到您的应用程序以查看所有正在运行的线程。jstack 也会做一个堆栈转储。我认为即使在像 Tomcat 这样的容器中，这仍然应该有效。

这两个工具都包含在 JDK5 和更高版本中（我假设该过程至少需要 Java 5，尽管我可能是错的）

更新：还值得注意的是，从 JDK 1.6 update 7 开始，现在有一个名为[VisualVM](http://java.sun.com/javase/6/docs/technotes/guides/visualvm/)的捆绑分析器，可以使用“jvisualvm”启动。它看起来像是一个[java.net 项目](http://visualvm.java.net/)，因此该页面上可能会提供其他信息。我还没有使用它，但它看起来对更严肃的分析很有用。

希望有帮助

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-08-16T18:26:17.587

面对同样的问题，我使用了[YourKit profiler](http://www.yourkit.com/overview/index.jsp)。除非您实际连接到它，否则它的加载器不会激活（尽管它确实打开了一个端口来侦听连接）。探查器本身有一个很好的“获取每种方法所花费的时间”，同时在它不那么突兀的模式下工作。

另一种方法是在具有最高优先级的“看门狗”线程中检测 CPU 负载（通过 JNI，因此您需要一个外部库），并在 CPU 足够高足够长的时间时开始记录所有线程。你可能会发现[这篇文章](http://www.javaworld.com/javaworld/javaqa/2002-11/01-qa-1108-cpu.html)很有启发性。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-16T05:40:53.403

如果出于专业目的并且您有一些钱可以花，请尝试使用[JProfiler](http://www.ej-technologies.com/products/jprofiler/overview.html)。如果您只是想获得一些见解，请尝试使用[Eclipse Profiler 插件](http://eclipsecolorer.sourceforge.net/index_profiler.html)。我用了好几次，但我不知道现在的状态。

来自 eclipse 项目本身的新（？）项目也可用：http: [//www.eclipse.org/tptp/](http://www.eclipse.org/tptp/)（请参阅[本文](http://www.eclipse.org/articles/Article-TPTP-Profiling-Tool/tptpProfilingArticle.html)）。从来没有用过，所以我不知道它是否值得努力。

[在http://www.manageability.org/blog/stuff/open-source-profilers-for-java](http://www.manageability.org/blog/stuff/open-source-profilers-for-java)上还有一个很好的开源分析器列表

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-08-23T08:22:58.703

如果无法使用 JConsole，您可以

*   在 Windows 下按`CTRL`+`BREAK`
*   `kill -3 <process id>`Linux下发送

得到一个完整的线程转储。这不会影响性能，并且始终可以在生产中运行。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-29T21:00:24.403

**JRockit 任务控制延迟分析器。**

JRockit 附带的延迟分析器向您显示当 JVM 什么都不做时它正在“做什么”。在最新版本中，您可以看到以下延迟：

*   Java 等待/阻塞/睡眠/停放。
*   文件输入/输出
*   网络 I/O
*   内存分配
*   GC 暂停
*   JVM 延迟，例如代码生成和类加载
*   线程暂停

该工具会在延迟发生时为您提供堆栈跟踪。您可以通过多种不同方式查看延迟数据（聚合跟踪、作为直方图、在线程图中等）。该工具还允许您查看线程之间的转换，例如当一个线程通知另一个线程时。

[延迟分析器 http://blogs.oracle.com/hirt/WindowsLiveWriter/The.0LatencyAnalyserMigratedfromtheoldBE_7246/latency_graph_2.png](http://blogs.oracle.com/hirt/WindowsLiveWriter/The.0LatencyAnalyserMigratedfromtheoldBE_7246/latency_graph_2.png)

开销可以忽略不计，并且与许多其他工具不同，它可以在生产环境中使用。这篇[博](https://blogs.oracle.com/hirt/entry/the_mission_control_30_latency)文给你一个简单的介绍，程序可以在[这里](http://www.oracle.com/technology/products/jrockit/missioncontrol/)下载。

它可以免费用于开发！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-21T12:49:59.327

**使用分析器。**是的，它们要花钱，使用它们有时会有点尴尬，但它们确实为您提供了更多真实的证据，而不是猜测。

人类普遍不善于猜测性能瓶颈在哪里。这似乎是我们的大脑不能很好地完成的事情。看起来很明显，您可能对问题所在有很好的想法，但现实世界往往会做一些不同的事情。优化代码的错误部分，充其量意味着做大量工作以获取最小的收益。更常见的是，它会使事情变慢，有时它会完全破坏事情。因此，在为优化而进行任何更改之前，您应该*始终*拥有来自分析器或其他准确工具的真实证据。

如前所述，JProfiler 和 YourKit 都相当不错，而且价格也不贵。上次我看的时候，他们都有免费的演示。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-19T18:50:40.873

为了完整起见：即使我的公司或多或少地在 Eclipse 上标准化，我们每天都使用 Netbeans（6 及更高版本）及其[包含的免费分析器。](http://profiler.netbeans.org/)它比 Eclipse TPTP 插件（3 个月前最后一次检查）工作得更好，对我们来说，它消除了对 JProfiler 等商业分析器的任何需求，它非常好，但很快就变得不必要了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-21T11:51:46.923

VisualVM 应该是来自 netbeans 的独立分析器。我为 Eclipse 尝试了 TPTP，但 visualVm 似乎是一个更好的选择！

# cross-platform - 同构开发平台对行业有利吗？

> ID：12929
> 
> 赞同：5
> 
> 时间：2008-08-16T00:46:54.167
> 
> 标签：cross-platform

**一种框架、浏览器或语言赢得战争**并成为事实上的标准是否符合软件开发行业的最佳利益？一方面它消除了跨平台的挑战，但它为单点故障打开了大门。它还会导致创新停滞，还是会让行业专注于更重要的事情（无论是什么）。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-08-16T01:16:51.750

事实标准很糟糕，因为它们通常由单一方控制。对行业来说最好的是有一个开放标准的基础，每个人都可以在此基础上竞争。

网络就是一个很好的例子。当 IE 赢得浏览器大战时，它停滞了*多年*，现在才刚刚开始改善，因为它正在流失市场份额。在那之前的网景也好不了多少。CSS 2.1 标准是十年前发布的，但仍然没有得到很好的支持。因此，Web 开发是一种让网站始终呈现一致的黑客和变通方法的黑艺术。

如果我能根据网络标准建立一个网站并确信它会正确显示，我的工作会轻松一百倍。想想我们本可以做的所有很酷的事情，而不是修复 IE 的呈现错误。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-16T00:56:30.560

我相信只要只有一种选择，创新肯定会停滞不前。如果我们只有一种语言，那么除了该语言旨在解决的问题外，我们将无法解决任何问题。

Java 和 C# 等命令式语言很好地解决了某些问题，但有时也有助于以函数式方式思考，例如使用 Haskell 和 Lisp。

此外，如果您谈论的是 Web 应用程序，跨平台问题不是问题，因为您控制硬件和软件（注意，我说的当然是服务器端代码，浏览器跨平台问题是分开的）。

Paul Graham 写了[一篇很棒的文章](http://www.paulgraham.com/road.html)，讲述了 Web 如何让您作为开发人员使用您认为最能解决问题的工具。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-16T00:57:52.850

不，竞争是好的。它可能会使 Web 开发人员的工作更轻松，但我认为这对行业不利。我个人更喜欢有选择。

我相信 Joel Spolsky 创建自己的语言（Wasabi）以使他的公司免受平台特定的影响的技术是一个很好的技术。我也相信使用能够完成类似事情的产品是一个好主意，这些产品更针对特定问题，如 JQuery。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-16T01:10:51.497

我将不得不同意迈克的观点，并说没有竞争就几乎没有创新的动力。

# php - 使用 MMCache 或 Zend Accelerator 等 PHP 加速器是否会使 PHP 更快？

> ID：12936
> 
> 赞同：17
> 
> 时间：2008-08-16T00:55:53.010
> 
> 标签：php, caching, zend-optimizer

有人有使用 PHP 加速器（如[MMCache](http://turck-mmcache.sourceforge.net/)或[Zend Accelerator](http://www.zend.com/en/) ）的经验吗？我想知道使用其中任何一个是否使 PHP 可以与*更快*的网络技术相媲美。此外，使用这些是否有权衡？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-08-19T19:03:26.540

请注意，Zend Optimizer 和 MMCache（或类似的应用程序）是完全不同的东西。Zend Optimizer 尝试优化程序操作码时，MMCache 会将脚本缓存在内存中并重用预编译的代码。

我前段时间做了一些基准测试，你可以在我的博客中找到[结果（虽然是德语）。](http://blogs.interdose.com/dominik/2008/04/11/benchmarking-php-eaccelerator-und-andere-opcode-caches/)基本结果：

单独的 Zend Optimizer 根本没有帮助。实际上我的脚本比没有优化器要慢。

缓存方面：* 最快：[eAccelerator](http://eaccelerator.net/) * [XCache](http://xcache.lighttpd.net/) * [APC](http://www.php.net/manual/en/book.apc.php)

并且：您确实想安装操作码缓存！

例如： [替代文字 http://blogs.interdose.com/dominik/wp-content/uploads/2008/04/opcode_wordpress.png](http://blogs.interdose.com/dominik/wp-content/uploads/2008/04/opcode_wordpress.png)

这是调用 wordpress 主页 10.000 次所需的持续时间。

*编辑：*顺便说一句，eAccelerator 本身包含一个优化器。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-08-16T03:37:34.867

MMCache 已被弃用。我推荐[http://pecl.php.net/package/APC](http://pecl.php.net/package/APC)或[http://xcache.lighttpd.net/](http://xcache.lighttpd.net/)，它们都可以为您提供可变存储（如 Memcache）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-16T02:34:13.327

两者都很有趣，并且将提供速度提升，因为它们将源代码编译为二进制表示，然后由 PHP 引擎执行。

任何使用 PHP 运行的大型网站（例如 Facebook）都在运行某种操作码缓存系统，例如 MMCache。

问题是它们不是很容易根据您的系统进行设置。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-16T01:20:55.127

根据实际执行了多少 PHP 代码以及执行需要多长时间，它们可能是一个非常大的胜利。这当然不会受到伤害，但是您看到的收益将在很大程度上取决于您当前花费的时间。

顺便说一句，mmcache 现在已经被整合到一个不同的项目中，我忘记了名字，但谷歌会告诉你。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-08-17T04:41:36.127

我在生产服务器上使用 APC，它开箱即用效果很好。编译它并将其添加到 PHP 中，没有太多的调整要做。我每隔一段时间检查一次只是为了查看统计信息，但由于我使用 MVC 很多所有主要文件（路由器、控制器等）很少在日常基础上更改，因此代码保持编译并非常有效地运行.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-17T18:43:18.487

目前我们使用免费的apc，只是在我们的实时服务器上简单的即插即用。为我们的网站提供了巨大的性能提升，尤其是随着项目规模的增加。我还禁用了 apc.stat，因此它不会检查代码是否已更新，因此每当我们需要更新实时站点上的代码时，我们都会重新启动 apache。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-28T10:30:32.473

我使用 APC，并且可以证明，如果您保持较高的缓存命中率，它可以显着降低应用服务器上的 CPU 和 I/O 负载。它不仅使您免于编译，而且完全免于从磁盘读取 php 文件。（即字节码直接从主内存提供，因此速度非常快）它降低了渲染单个页面的速度，并增加了服务器每秒可以处理的请求数。

如果你使用 RedHat 或 CentOS，安装 APC 超级简单：

```
yum install php-devel httpd-devel php-pear
pecl install apc 
echo "extension=apc.so" > /etc/php.d/apc.ini
# if you're using SELinux:
chcon "system_u:object_r:textrel_shlib_t" /usr/lib/php/modules/apc.so
/etc/init.d/httpd restart 
```

你问了缺点。唯一的缺点是它需要一些内存。APC 上的默认值为 30MB，但它可以进行调整，随着速度和响应速度的提高，一点点内存的成本是不言而喻的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-30T18:44:52.897

BlaM 的测试包括 WordPress 进行的所有数据库调用。当您进行更少的数据库调用时，您会看到操作码缓存的性能提升更加显着。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-16T06:58:09.987

你检查过Phalanger吗？它将 PHP 编译为 .NET 代码。以下是[一些基准](http://web.archive.org/web/20101126094453/http://php-compiler.net/doku.php?id=core%3abenchmarks)，表明它可以显着提高性能。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-16T12:26:06.423

我曾经使用过 Zend Accelerator（2004 年左右）。它确实在可以使用的代码上获得了一些显着的性能提升，但不幸的是，我使用的系统被设计为经常动态加载代码然后对其进行评估，当时 Zend Accelerator 无法做太多事情（而且我我猜还是不能）。

不利的一面是，我们确实看到了一些缓存问题（代码可能会发生变化，但编译后的版本会出于某种原因与更改同步）。我想这些问题现在可能已经解决了。

无论如何，我没有任何硬比较的数字，当然也没有在不同的环境中编写相同的系统进行比较，但是对于绝大多数系统，PHP 不会在性能方面扼杀你。

# sql-server - 数据库复制。2台服务器，主数据库，第二台是只读的

> ID：12946
> 
> 赞同：7
> 
> 时间：2008-08-16T01:18:46.007
> 
> 标签：sql-server, replication

假设您有 2 个数据库服务器，一个数据库是执行所有写入操作的“主”数据库，它被视为“真实/原始”数据库。另一台服务器的数据库是主数据库（从？）的镜像副本，将用于对应用程序的某个部分进行只读操作。

你如何设置一个从数据库来镜像主数据库上的数据？据我了解，从/只读数据库是使用主数据库的事务日志文件来镜像数据正确吗？
在从属数据库镜像数据的频率方面，我有哪些选择？（实时/每 x 分钟？）。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-08-16T03:31:52.867

您想要的是 SQL Server 2005 中的事务复制。它会在发布者（即“主”）数据库更新时近乎实时地复制更改。

[这是一个很好的如何设置它的演练。](http://blogs.techrepublic.com/howdoi/?p=123)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-08-16T07:00:28.123

SQL Server 2008 具有三种不同的复制模式。

*   单向只读复制的[事务性](http://msdn.microsoft.com/en-us/library/ms151706.aspx)
*   合并进行双向复制
*   快照

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-16T15:01:07.797

> 据我了解，从/只读数据库是使用主数据库的事务日志文件来镜像数据正确吗？在从属数据库镜像数据的频率方面，我有哪些选择？（实时/每 x 分钟？）。

这听起来像是您在谈论日志传送而不是复制。[尽管我同意Jeremy McCollum](https://stackoverflow.com/users/1436/jeremy-mccollum)并说要进行事务复制，但对于您计划做的事情。如果您要在数据库每 x 分钟恢复一次时进行日志传送，则数据库将不可用。

这是两者之间差异的一个很好的演练。遗憾的是，您必须注册一个帐户才能阅读它。=/ [http://www.sqlservercentral.com/articles/Replication/logshippingvsreplication/1399/](http://www.sqlservercentral.com/articles/Replication/logshippingvsreplication/1399/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-16T02:55:48.913

这个问题的答案将根据您用于执行此操作的数据库服务器而有所不同。

编辑：对不起，也许我需要学习查看标签而不仅仅是问题 - 我可以看到您将其标记为 sqlserver。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-31T14:45:10.237

事务复制是实时的。

If you do not have any updates to be done on your database , what you need is just retrieving of data say once a day : then use snapshot replication instead of transactional replication. In snapshot replication, changes will replicate when and as defined by the user say once in 24 hrs.

# .net - 通过 Web 服务发送复杂数据的首选方法是什么？

> ID：12982
> 
> 赞同：9
> 
> 时间：2008-08-16T03:58:24.687
> 
> 标签：.net, web-services, soap, wsdl

现在是 2008 年，我仍然对这个感到困惑。因此，我正在开发一种需要将复杂类型传递到其中并从中返回的 Web 方法。我正在玩弄的两个选项是：

1.  传递和返回具有数据和行为的*实际业务对象。*运行 wsdl.exe 时，它​​会自动创建仅包含数据部分的代理类，并且这些代理类将自动与服务器端的真实业务对象相互转换。在客户端，他们只能使用哑代理类型，并且他们必须将它们映射到他们认为合适的一些真实的业务对象中。这里的一个很大的缺点是，如果我同时“拥有”服务器端和客户端，并且我想使用同一组真实的业务对象，我可能会遇到名称冲突等问题。（因为真实对象和代理名称相同。）

2.  忘记尝试传递“真实”的业务对象。相反，只需创建简单的 DataTransfer 对象，我将手动将其映射到我的真实业务对象。无论如何，它们仍然会被 wsdl.exe 复制到新的代理对象，但至少我没有欺骗自己认为 Web 服务可以本机处理具有业务逻辑的对象。

顺便说一句 - 有谁知道如何告诉 wsdl.exe*不要*复制对象？我们不应该直接告诉它，“嘿，在这里使用这个现有的类型。不要复制它！”

无论如何，我现在已经确定了#2，但我很好奇你们的想法。我感觉一般来说有*更好*的方法可以做到这一点，而且我的所有观点可能都不完全准确，所以请让我知道你的经历。

**更新**：我刚刚发现 VS 2008 在添加“服务引用”时可以选择重用现有类型，而不是在代理文件中创建全新的相同类型。甜的。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-16T04:31:53.667

我会做一个混合动力车。我会使用这样的对象

```
public class TransferObject
{
    public string Type { get; set; }
    public byte[] Data { get; set; }
} 
```

然后我有一个很好的小实用程序，可以序列化一个对象然后压缩它。

```
public static class CompressedSerializer
{
    /// <summary>
    /// Decompresses the specified compressed data.
    /// </summary>
    /// <typeparam name="T"></typeparam>
    /// <param name="compressedData">The compressed data.</param>
    /// <returns></returns>
    public static T Decompress<T>(byte[] compressedData) where T : class
    {
        T result = null;
        using (MemoryStream memory = new MemoryStream())
        {
            memory.Write(compressedData, 0, compressedData.Length);
            memory.Position = 0L;

            using (GZipStream zip= new GZipStream(memory, CompressionMode.Decompress, true))
            {
                zip.Flush();
                var formatter = new System.Runtime.Serialization.Formatters.Binary.BinaryFormatter();
                result = formatter.Deserialize(zip) as T;
            }
        }

        return result;
    }

    /// <summary>
    /// Compresses the specified data.
    /// </summary>
    /// <typeparam name="T"></typeparam>
    /// <param name="data">The data.</param>
    /// <returns></returns>
    public static byte[] Compress<T>(T data)
    {
        byte[] result = null;
        using (MemoryStream memory = new MemoryStream())
        {
            using (GZipStream zip= new GZipStream(memory, CompressionMode.Compress, true))
            {
                var formatter = new System.Runtime.Serialization.Formatters.Binary.BinaryFormatter();
                formatter.Serialize(zip, data);
            }

            result = memory.ToArray();
        }

        return result;
    }
} 
```

然后，您只需传递具有类型名称的传输对象。所以你可以做这样的事情

```
[WebMethod]
public void ReceiveData(TransferObject data)
{
    Type originType = Type.GetType(data.Type);
    object item = CompressedSerializer.Decompress<object>(data.Data);
} 
```

现在压缩的序列化器使用泛型使其强类型化，但是您可以轻松地创建一个方法来使用上面的 originType 来反序列化 Type 对象，这一切都取决于您的实现。

希望这能给你一些想法。哦，要回答您的其他问题，wsdl.exe 不支持重用类型，但 WCF 支持。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-16T04:49:33.850

> **Darren**写道: 我会做一个混合动力车。我会使用这样的对象...

有趣的想法...传递对象的序列化版本而不是（wsdl-ed）对象本身。在某种程度上，我喜欢它的优雅，但在另一方面，它似乎违背了将您的 Web 服务公开给潜在的第三方或合作伙伴或其他任何东西的目的。他们怎么知道要通过什么？他们是否必须完全依赖文档？它还失去了一些“异构客户端”方面，因为序列化是非常特定于.Net 的。我并不是要批评，我只是想知道您的提议是否也适用于这些类型的用例。不过，我认为在封闭环境中使用它没有任何问题。

我应该研究 WCF ......我一直在避免它，但也许是时候了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-16T05:16:55.213

哦，当然，我只在我是 web 服务的消费者时这样做，或者如果你有某种控制器从它们请求对象，然后你处理序列化和发送，而不是它们直接使用 web 服务。但实际上，如果他们直接使用 web 服务，那么他们就不需要或不一定拥有首先包含该类型的程序集，并且应该使用 wsdl 生成的对象。

是的，我提出的内容非常特定于 .NET，因为我不喜欢使用其他任何东西。我唯一一次在.net 之外使用 web 服务是在 javascript 中，但现在我只使用 json 响应而不是 xml webservice 响应:)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-21T12:31:34.190

there is also an argument for separating the tiers - have a set of serializable objects that get passed to and from the web service and a translator to map and convert between that set and the business objects (which might have properties not suitable for passing over the wire)

Its the approach favoured by the web service software factory [service factory](http://www.codeplex.com/servicefactory) and means that you can change your business objects without breaking the web service interface/contract