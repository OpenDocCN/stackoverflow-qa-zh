# StackOverflow 问答 000076000-000076999

# git - git pack 文件入口格式

> ID：76002
> 
> 赞同：6
> 
> 时间：2008-09-16T19:27:31.277
> 
> 标签：git, file-format

我对 Git 包文件格式的理解是这样的： ![替代文字](https://content.screencast.com/users/aggieben/folders/Jing/media/dc42fabf-6fd6-47f3-9244-446b9ec04494/2008-09-16_1424.png)

其中表是 32 位宽，前三个 32 位字是包文件头。最后一行 32 位是条目的前 4 个字节。据我了解，条目的大小由设置 MSB 的连续字节指定，然后是压缩数据。

在没有设置 MSB 的第一个字节中，MSB 是压缩数据的一部分，还是有间隙？如果它是压缩数据的一部分，您如何保证压缩数据时不会设置该位？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-16T19:30:32.720

我对[包文件文档](http://repo.or.cz/w/git.git?a=blob;f=Documentation/technical/pack-format.txt;h=1803e64e465fa4f8f0fe520fc0fd95d0c9def5bd;hb=HEAD)的阅读表明，大小的最后一个字节（在您的示例中偏移 15）将 MSB 设置为 0。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-06-01T05:57:58.103

还有一些图形文档解释了[这里](http://shafiulazam.com/gitbook/7_the_packfile.html)的一些格式。此部分不再出现在社区手册中，但仍然可以在上面的位置找到。

# linux - 您如何衡量每位用户的下行带宽？

> ID：76029
> 
> 赞同：1
> 
> 时间：2008-09-16T19:30:00.600
> 
> 标签：linux, bandwidth, inbound

在基于 Linux 的系统（特别是 Ubuntu Server 8.04）中，如何测量每个用户的下行带宽？理想情况下，我想要一种直接提供数据的方法，而不必运行另一个进程并解析其输出。我有一种通过为每个用户设置一个 iptables 过滤器并定期检查其计数器来测量每个用户上游带宽的技术，但这似乎不支持下游连接，我认为这是因为 iptables 在它们之前检查数据包被路由到一个进程。

`[edit 20080916 153434 EST]`“每个用户”是指系统上的文字帐户。也就是说，任何具有真实 POSIX UID 的帐户都拥有实际运行的进程。因此，对于 Ubuntu Server 8.04，测量值将包括`root`、`www-data`、我自己的帐户等的值。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T19:39:12.887

我没有看到任何明显的方法来实现这一点，但我希望这将是你可以使用自定义`ip_conntrack`模块做的事情。您将在首次创建 conntrack 条目时捕获 uid，然后在两个方向上应用相同的 uid。

# java - Java 1.6 JDK 工具，VisualVM

> ID：76042
> 
> 赞同：4
> 
> 时间：2008-09-16T19:31:29.830
> 
> 标签：java, profiling

有没有人使用新的 Java 1.6 JDK 工具[VisualVM](http://web.archive.org/web/20070724060100/https://visualvm.dev.java.net/)来分析生产应用程序以及应用程序在分析时如何执行？

文档说它是为生产和开发使用而设计的，但是基于以前的分析经验，使用其他分析工具，我很犹豫。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-16T20:29:50.987

虽然我没有亲自使用过 VisualVM，但我今天看到了这篇[博](http://blog.xebia.com/loitering-objects-make-web-company-lose-money/)文，可能对你有一些有用的信息。他谈到了使用它来分析生产应用程序。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-08T20:46:08.427

仅仅为了监控你的应用程序，远程运行 VisualVM 应该不会减慢它的速度。如果系统没有处于崩溃的边缘，我仍然没有看到任何问题。它基本上只是从 JVM 的粗粒度内置工具中读取信息。但是，如果您开始分析，您将遇到与其他分析器相同的问题。基本上是因为它们几乎都以相同的方式工作，通常使用 JVM 中的支持。

由于防火墙问题，许多人在远程运行 VisualVM 时遇到问题，但您甚至[可以通过 ssh 远程运行 Visual VM](http://spjelkavik.wordpress.com/2009/08/27/running-visualvm-through-an-ssh-tunnel-with-socks/)，并设置一些系统属性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T14:39:07.120

我在开发盒上尝试过，发现当我关闭分析时，它会意外关闭 Tomcat。对于将其推广到生产环境，我会非常谨慎-您可以在暂存环境中模拟负载吗？它不如真实的东西，但如果它出错了，它可能不会让你被解雇......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-07T20:51:32.373

我以前使用 VisualVM 来分析本地运行的东西。一个巨大的胜利是我刚刚启动它，它可以连接到正在运行的 JVM。它比我以前使用过的其他分析工具更容易使用，而且似乎没有那么多开销。

我认为它可以采样。CPU 密集型应用程序的开销似乎并不显着。我没有测量任何东西（我对我的应用程序的性能感兴趣，而不是工具的性能如何），但它绝对没有我习惯于从分析中看到的 10 倍减速因素。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-01T13:47:11.230

可以使用 VisualVM 从另一台计算机远程连接到您的服务器。您只需右键单击“远程”节点并说“添加远程主机”。

这至少可以消除 VisualVM 开销（如果有的话）在运行时影响性能。

这可能无法消除所有性能问题，尤其是在生产环境中，但它会有所帮助。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-07T21:13:23.190

我使用了 Net Beans 分析器，它使用与 Visual VM 相同的基础。

我正在使用旧版本的 Weblogic，这意味着使用 1.5 JVM，所以我无法进行动态附加。我正在分析的应用程序有数千个类，而我的工作站几乎无法使用，而分析器对它们都进行了检测。仪器安装完成后，系统运行缓慢，但并非完全无法使用。减速量实际上取决于您需要捕获的内容。基本的 CPU 指标非常轻量级。分析内存分配会使事情变慢很多。

我不会在生产系统上使用它。除了可能会降低速度之外，我最终用完了 PermGen 空间，因为当您更改设置时，分析器会重新检测和重新加载类。（这个可能在1.6代理中修复了，不知道）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-06-01T15:07:41.987

我已经非常广泛地使用了 VVM（VavaVoom？），在轻量模式下工作就像一个魅力，即没有分析，只是从 VM 获取基本数据。但是一旦你开始分析并且有很多类，那么就会出现相当大的减速。即使您有 128 个核心板和 2 兆内存，我也不会在生产环境中进行分析，纯粹因为类的重新加载和重新定义很棘手，服务器类加载器是另一回事，也因服务器实现而异，在生产中干扰它们并不是一个好主意。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-01-28T18:57:41.407

自从 VisualVM 包含在 JDK 中之前，我就一直在使用它。它对系统性能的影响可以忽略不计。我从来没有注意到它会导致系统性能出现问题，但话又说回来，我们的 Java 服务器当时有足够的空间来支持一点额外的负载。如果您的服务器运行在一个完全被淘汰的水平并且无法处理 VisualVM 的运行，那么我会说您更有可能需要购买另一台服务器。任何生产服务器都应该有一些内存空间，否则你所拥有的只是等待发生的灾难。

# silverlight - 有没有办法在不购买 VS2008 的情况下高效地进行 Silverlight 开发？

> ID：76044
> 
> 赞同：2
> 
> 时间：2008-09-16T19:31:38.737
> 
> 标签：silverlight, visual-studio-express

微软似乎希望 Silverlight 起飞，但如果不购买 Visual Studio 2008，我就找不到在其中开发的简单方法。有没有人找到在 Visual Studio 的快速版中获得 silverlight 开发环境的方法？还有其他工具吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T19:39:47.907

这是你的链接：[HOWTO：Silverlight 和 Visual Studio Express](http://www.informikon.com/component/option,com_mamblog/Itemid,0/&Itemid=/task,show/action,view/id,263/)，
不过我自己还没有尝试过。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-14T17:23:17.813

他们刚刚发布[了 Silverlight (eclipse4SL) 的 Eclipse 工具](http://www.eclipse4sl.org/)，我记得这个帖子！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T19:36:53.547

[显然](http://blogs.msdn.com/webdevtools/archive/2008/05/12/error-installing-visual-studio-2008-sp1-beta-and-silverlight-tools-beta-1.aspx#8636636)，最终版本将提供明确的支持

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T19:39:11.997

根据您认为“高效”的内容，您可以使用 XAMLPad 处理许多基本的声明性内容。
Moonlight 项目正在开发一个名为 Lunar Eclipse 的 IDE，我认为他们最终将集成到 MonoDevelop 中。维基百科说它已经在 SVN 存储库中，但我不知道是否有任何代码可以实际有效运行。我认为如果它在那里，即使它甚至可以编译，它也将是无法使用的基本......仍然，需要研究的东西！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T19:49:30.083

我只使用 Visual Studio 作为 xaml 和 C# 的文本编辑器。我根本不使用 Visual Studio 中的设计器。您可以使用 Blend 将您的大部分 UI 放在一起，使用 Express 单独打开您的 C# 文件。无论如何，您在 Visual Studio 中对 xaml 没有太多智能感知。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-17T04:05:33.090

正如@Brian 所说，您可以使用 Expression blend 并创建任何 WPF/Silverlight 应用程序。特别是如果你有一些Flash背景/对交互设计（UX）更感兴趣，我建议你购买表情混合而不是VS2008。您可以在记事本中编写 C# 代码，Blend 将负责编译。

# mysql - 如何将变量传递给 mysql 脚本？

> ID：76065
> 
> 赞同：24
> 
> 时间：2008-09-16T19:35:34.343
> 
> 标签：mysql, variables, scripting

我知道使用 mysql 您可以将 SQL 语句写入 .sql 文件并从 mysql 命令行运行该文件，如下所示：

```
mysql> source script.sql 
```

如何将变量传递给脚本？例如，如果我想运行一个脚本来检索部门中的所有员工，我希望能够将部门编号作为变量传递。

我不想通过 shell 脚本运行查询。我从 mysql 命令行运行了一些简单的查询。我厌倦了一直重新输入它们，为它们编写一个 shell 脚本将是矫枉过正的。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-09-16T19:40:53.850

像这样：

```
set @department := 'Engineering'; 
```

然后，`@department`在 script.sql 中引用您需要的任何位置：

```
update employee set salary = salary + 10000 where department = @department; 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2014-08-03T21:14:23.570

```
 #!/bin/bash

    #verify the passed params
    echo 1 cmd arg : $1
    echo 2 cmd arg : $2

    export db=$1
    export tbl=$2

    #set the params ... Note the quotes ( needed for non-numeric values )
    mysql -uroot -pMySecretPaassword \
    -e "set @db='${db}';set @tbl='${tbl}';source run.sql ;" ;

    #usage: bash run.sh my_db my_table
    #
    #eof file: run.sh

    --file:run.sql

    SET @query = CONCAT('Select * FROM ', @db , '.' , @tbl ) ;
    SELECT 'RUNNING THE FOLLOWING query : ' , @query ;
    PREPARE stmt FROM @query;
    EXECUTE stmt;
    DEALLOCATE PREPARE stmt;

    --eof file: run.sql 
```

[您可以从以下项目](https://github.com/YordanGeorgiev/mysql-starter)中重用整个概念

* * *

## 回答 #3

> 赞同：-15
> 
> 时间：2008-09-16T19:59:04.210

你真的应该寻找一种更合适的方式来做到这一点。我猜你正在尝试通过 shell 脚本运行 mysql 查询。您应该改用 PERL 或 PHP 之类的东西。

# flash - 如何在 Flash 组件控制的 WindowMediaPlayer activeX 中播放 WMV？

> ID：76069
> 
> 赞同：1
> 
> 时间：2008-09-16T19:36:18.227
> 
> 标签：flash, video, wmp

如何在 Flash 组件控制的 WindowMediaPlayer activeX 中播放 WMV？

我在这里看到过：[http](http://sport5.co.il/) : //sport5.co.il/ 有人知道怎么做吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T02:42:27.423

我看到两者交互的唯一方法是将 WMP 和 Flash 组件放在网页上，然后让 JavaScript 来操作这两者。例如，您可以有用于播放/停止/等的 Flash 按钮，当单击这些按钮时，javascript 会处理单击事件并告诉 WMP 控件开始/停止播放。

这有帮助吗？

# windows-services - 如何在 Windows 中删除服务？

> ID：76074
> 
> 赞同：477
> 
> 时间：2008-09-16T19:36:41.130
> 
> 标签：windows-services, sysadmin, administration

我有几个旧服务要完全卸载。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：890
> 
> 时间：2008-09-16T19:41:17.217

使用*SC*命令，如下所示（您需要在命令提示符下执行本文中的命令）：

```
SC STOP shortservicename
SC DELETE shortservicename 
```

* * *

**注意：**您需要以管理员身份运行命令提示符，不仅要以管理员身份登录，还要具有管理权限。如果您收到上述关于没有停止和/或删除服务的必要访问权限的错误，请以管理员身份运行命令提示符。您可以通过在开始菜单上搜索命令提示符，然后右键单击并选择“以管理员身份运行”来执行此操作。**PowerShell 用户注意：** `sc`别名为`set-content`. 所以`sc delete service`实际上会创建一个名为`delete`content的文件`service`。要在 Powershell 中执行此操作，请`sc.exe delete service`改用

* * *

如果您需要查找服务的短服务名称，请使用以下命令生成包含服务列表及其状态的文本文件：

```
SC QUERY state= all >"C:\Service List.txt" 
```

要获得更简洁的列表，请执行以下命令：

```
SC QUERY state= all | FIND "_NAME" 
```

短服务名称将列在显示名称上方，如下所示：

```
SERVICE_NAME: MyService
DISPLAY_NAME: My Special Service 
```

因此要删除该服务：

```
SC STOP MyService
SC DELETE MyService 
```

* * *

## 回答 #2

> 赞同：60
> 
> 时间：2008-09-16T19:39:10.733

点击*开始*| **运行**并输入`regedit`Open: 行。单击确定。

导航`HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services`

向下滚动左窗格，找到服务名称，右键单击它并**选择 Delete**。

重新启动系统。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2008-09-16T19:44:56.070

使用**services.msc**或（开始 > 控制面板 > 管理工具 > 服务）查找有问题的服务。双击以查看服务名称和可执行文件的路径。

检查 exe 版本信息以获取有关服务所有者的线索，并尽可能使用添加/删除程序进行干净卸载。

做不到这一点，从命令提示符：

```
sc stop servicexyz
sc delete servicexyz 
```

不需要重新启动。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2013-09-18T06:22:26.467

```
SC DELETE "service name" 
```

以管理员身份在 cmd 上运行命令，否则您将收到此错误：-

> openservice failed 5 访问被拒绝

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2018-03-08T04:22:55.323

如上所述，我执行了：

```
sc delete ServiceName 
```

但是，当我从 PowerShell 执行它时，这不起作用。

使用 PowerShell 时，您必须指定完整路径，`sc.exe`因为 PowerShell 有一个默认别名用于`sc`将其分配给`Set-Content`. 由于它是一个有效的命令，它实际上并没有显示错误消息。

为了解决这个问题，我执行如下：

```
C:\Windows\System32\sc.exe delete ServiceName 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2013-09-23T16:50:23.790

我们可以通过两种不同的方式来做到这一点

**通过注册表删除 Windows 服务**

如果您知道正确的路径，从注册表中删除服务非常容易。我是这样做的：

1.  运行**Regedit**或**Regedt32**

2.  转到注册表项“HKEY_LOCAL_MACHINE/SYSTEM/CurrentControlSet/Services”

3.  查找您要删除的服务并将其删除。您可以查看密钥以了解服务正在使用哪些文件并删除它们（如有必要）。

**通过命令行窗口删除 Windows 服务**

或者，您也可以使用命令提示符并使用以下命令删除服务：

**sc 删除**

您还可以使用以下命令创建服务

sc create "MorganTechService" binpath= "C:\Program Files\MorganTechSPace\myservice.exe"

注意：您可能必须重新启动系统才能在服务管理器中更新列表。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2013-03-07T16:00:18.100

如果您有 Windows Vista 或更高版本，请以管理员身份从命令提示符运行：

```
sc delete [your service name as shown in service.msc e.g moneytransfer] 
```

例如：`sc delete moneytransfer`

删除文件夹`C:\Program Files\BBRTL\moneytransfer\`

查找汇款注册表项并将其删除：

```
 HKEY_CLASSES_ROOT\Installer\Products\
 HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Uninstall\
 HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\EventLog\
 HKEY_LOCAL_MACHINE\System\CurrentControlSet002\Services\
 HKEY_LOCAL_MACHINE\System\CurrentControlSet002\Services\EventLog\
 HKEY_LOCAL_MACHINE\Software\Classes\Installer\Assemblies\ [remove .exe references]
 HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Installer\Folders 
```

这些步骤已经在 Windows XP、Windows 7、Windows Vista、Windows Server 2003 和 Windows Server 2008 上进行了测试。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2008-10-28T04:37:49.203

如果它们是 .NET 创建的服务，您可以使用 installutil.exe 和 /u 开关在 .net 框架文件夹中，如 C:\Windows\Microsoft.NET\Framework64\v2.0.50727

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-16T19:53:47.500

这是一个传给我的 vbs 脚本：

```
Set servicelist = GetObject("winmgmts:").InstancesOf ("Win32_Service")

for each service in servicelist
    sname = lcase(service.name)
    If sname = "NameOfMyService" Then 
        msgbox(sname)
        service.delete ' the internal name of your service
    end if
next 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-16T19:42:52.173

sc 删除名称

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-03-21T14:26:58.580

在删除服务之前，您应该查看依赖项。

你可以检查它：

打开`services.msc`并找到服务名称，切换到“依赖项”选项卡。

资料来源：[http ://www.sysadmit.com/2016/03/windows-eliminar-un-servicio.html](http://www.sysadmit.com/2016/03/windows-eliminar-un-servicio.html)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2021-08-13T11:50:34.257

这在 Windows 10 上为我完成了这项工作：

*   以管理员身份启动 cmd.exe
*   运行 SC DELETE “com.docker.service”
*   重新安装泊坞窗

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-10-14T22:33:50.770

对我来说，我创建的服务必须在控制面板 > 程序和功能中卸载

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-02-27T09:25:17.693

您可以使用我的小型服务列表编辑器实用程序**服务管理器**

[![预览](https://i.stack.imgur.com/Kw4Lc.png)](https://i.stack.imgur.com/Kw4Lc.png)

您可以选择任何服务 > 修改 > 删除。方法立即生效，无需重启。

可执行文件：[[下载]](https://drive.google.com/drive/folders/1NXu810HDv3KYe3LcT8q2gZxQ9zLwuI_n)

源代码：[[下载]](https://github.com/devowl/winservicemanager)

博客文章：[[博客链接]](http://www.devowl.net/2019/08/windows-service-create-edit-delete-servicesmsc.html)

服务编辑器类：[WinServiceUtils.cs](https://github.com/devowl/winservicemanager/blob/master/WS.Manager/WinService/WinServiceUtils.cs)

# c - C中计算高效的三维数组

> ID：76076
> 
> 赞同：7
> 
> 时间：2008-09-16T19:36:50.537
> 
> 标签：c, arrays, multidimensional-array, numerical

我正在尝试以数值方式求解一组三维的偏微分方程。在每个方程中，一个点中未知数的下一个值取决于最近点中每个未知数的当前值。

为了编写高效的代码，我需要在（一维）内存空间中保持三个维度中的点接近，以便每个值只从内存中调用一次。

我正在考虑使用八叉树，但我想知道是否有人知道更好的方法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-16T19:48:12.490

八叉树是要走的路。您将数组细分为 8 个八分圆：

```
1 2
3 4

---

5 6
7 8

```

然后按照上面的 1、2、3、4、5、6、7、8 的顺序将它们放在内存中。您在每个八分圆内递归地重复此操作，直到您减小到某个基本大小，可能约为 128 个字节左右（这只是一个猜测——确保分析以确定最佳截止点）。与朴素布局相比，这具有更好的缓存一致性和引用局部性。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-17T13:43:34.293

树方法的一种替代方法：使用 Morton-Order 对数据进行编码。

在三维中它是这样的：取坐标分量并将每个位交错两个零位。这里以二进制显示：11111b 变为 1001001001b

执行此操作的 C 函数如下所示（为清楚起见，仅显示 11 位）：

```
int morton3 (int a)
{
  int result = 0;
  int i;
  for (i=0; i<11; i++)
  {
     // check if the i'th bit is set.
     int bit = a&(1<<i);
     if (bit)
     {
       // if so set the 3*i'th bit in the result:
       result |= 1<<(i*3);
     }
  }
  return result;
} 
```

您可以使用此功能来组合您的职位，如下所示：

```
index = morton3 (position.x) + 
        morton3 (position.y)*2 +
        morton3 (position.z)*4; 
```

这会将您的三维索引变成一维索引。最好的部分：在 3D 空间中接近的值在 1D 空间中也接近。如果您经常访问彼此接近的值，您还将获得非常好的加速，因为 morton-order 编码在缓存局部性方面是最佳的。

对于 morton3 你最好不要使用上面的代码。使用一个小表一次查找 4 或 8 位并将它们组合在一起。

希望它有帮助，尼尔斯

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-16T20:38:46.080

[《多维和度量数据结构基础](https://rads.stackoverflow.com/amzn/click/com/0123694469)》一书可以帮助您确定哪种数据结构对于范围查询最快：八叉树、kd 树、R 树……它还描述了将点放在内存中的数据布局。

# .net - 最小化时如何将.net应用程序放在系统托盘中？

> ID：76079
> 
> 赞同：9
> 
> 时间：2008-09-16T19:37:06.790
> 
> 标签：.net, system, system-tray

任何人都可以建议一个很好的 vb.net/c#**代码示例，以便在最小化时将应用程序放在系统托盘中。**

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-16T19:40:43.397

在表单中添加一个 NotifyIcon 控件，然后使用以下代码：

```
 private void frm_main_Resize(object sender, EventArgs e)
    {
        if (this.WindowState == FormWindowState.Minimized)
        {
           this.ShowInTaskbar = false;
           this.Hide();
           notifyIcon1.Visible = true;
        }
    }

    private void notifyIcon1_MouseDoubleClick(object sender, MouseEventArgs e)
    {
        this.Show();
        this.WindowState = FormWindowState.Normal;
        this.ShowInTaskbar = true;
        notifyIcon1.Visible = false;
    } 
```

您可能不需要设置 ShowInTaskbar 属性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T19:45:04.650

您可以利用名为 NotifyIcon 的内置控件。这会在显示时创建一个托盘图标。@Phillip 有一个有点完整的代码示例。

不过有一个问题：

您必须覆盖您的应用程序主窗体 Dispose 方法才能在 NotifyIcon 上调用 Dispose，否则它会在应用程序退出后留在您的托盘中。

```
public void Form_Dispose(object sender, EventArgs e)
{
   if (this.Disposing)
      notifyIcon1.Dispose();
} 
```

类似的东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T20:34:15.360

您可以通过向表单添加 NotifyIcon 并处理表单的调整大小事件来完成此操作。要从托盘返回，请处理 NotifyIcon 的双击事件。

如果你想添加一点动画，你也可以这样做......

1）添加以下模块：

```
Module AnimatedMinimizeToTray
Structure RECT
    Public left As Integer
    Public top As Integer
    Public right As Integer
    Public bottom As Integer
End Structure

Structure APPBARDATA
    Public cbSize As Integer
    Public hWnd As IntPtr
    Public uCallbackMessage As Integer
    Public uEdge As ABEdge
    Public rc As RECT
    Public lParam As IntPtr
End Structure

Enum ABMsg
    ABM_NEW = 0
    ABM_REMOVE = 1
    ABM_QUERYPOS = 2
    ABM_SETPOS = 3
    ABM_GETSTATE = 4
    ABM_GETTASKBARPOS = 5
    ABM_ACTIVATE = 6
    ABM_GETAUTOHIDEBAR = 7
    ABM_SETAUTOHIDEBAR = 8
    ABM_WINDOWPOSCHANGED = 9
    ABM_SETSTATE = 10
End Enum

Enum ABNotify
    ABN_STATECHANGE = 0
    ABN_POSCHANGED
    ABN_FULLSCREENAPP
    ABN_WINDOWARRANGE
End Enum

Enum ABEdge
    ABE_LEFT = 0
    ABE_TOP
    ABE_RIGHT
    ABE_BOTTOM
End Enum

Public Declare Function SHAppBarMessage Lib "shell32.dll" Alias "SHAppBarMessage" (ByVal dwMessage As Integer, ByRef pData As APPBARDATA) As Integer
Public Const ABM_GETTASKBARPOS As Integer = &H5&
Public Const WM_SYSCOMMAND As Integer = &H112
Public Const SC_MINIMIZE As Integer = &HF020

Public Sub AnimateWindow(ByVal ToTray As Boolean, ByRef frm As Form, ByRef icon As NotifyIcon)
    ' get the screen dimensions
    Dim screenRect As Rectangle = Screen.GetBounds(frm.Location)

    ' figure out where the taskbar is (and consequently the tray)
    Dim destPoint As Point
    Dim BarData As APPBARDATA
    BarData.cbSize = System.Runtime.InteropServices.Marshal.SizeOf(BarData)
    SHAppBarMessage(ABMsg.ABM_GETTASKBARPOS, BarData)
    Select Case BarData.uEdge
        Case ABEdge.ABE_BOTTOM, ABEdge.ABE_RIGHT
            ' Tray is to the Bottom Right
            destPoint = New Point(screenRect.Width, screenRect.Height)

        Case ABEdge.ABE_LEFT
            ' Tray is to the Bottom Left
            destPoint = New Point(0, screenRect.Height)

        Case ABEdge.ABE_TOP
            ' Tray is to the Top Right
            destPoint = New Point(screenRect.Width, 0)

    End Select

    ' setup our loop based on the direction
    Dim a, b, s As Single
    If ToTray Then
        a = 0
        b = 1
        s = 0.05
    Else
        a = 1
        b = 0
        s = -0.05
    End If

    ' "animate" the window
    Dim curPoint As Point, curSize As Size
    Dim startPoint As Point = frm.Location
    Dim dWidth As Integer = destPoint.X - startPoint.X
    Dim dHeight As Integer = destPoint.Y - startPoint.Y
    Dim startWidth As Integer = frm.Width
    Dim startHeight As Integer = frm.Height
    Dim i As Single
    For i = a To b Step s
        curPoint = New Point(startPoint.X + i * dWidth, startPoint.Y + i * dHeight)
        curSize = New Size((1 - i) * startWidth, (1 - i) * startHeight)
        ControlPaint.DrawReversibleFrame(New Rectangle(curPoint, curSize), frm.BackColor, FrameStyle.Thick)
        System.Threading.Thread.Sleep(15)
        ControlPaint.DrawReversibleFrame(New Rectangle(curPoint, curSize), frm.BackColor, FrameStyle.Thick)
    Next

    If ToTray Then
        ' hide the form and show the notifyicon
        frm.Hide()
        icon.Visible = True
    Else
        ' hide the notifyicon and show the form
        icon.Visible = False
        frm.Show()
    End If

End Sub
End Module 
```

2）在您的表单中添加一个 NotifyIcon 并添加以下内容：

```
Protected Overrides Sub WndProc(ByRef m As System.Windows.Forms.Message)
    If m.Msg = WM_SYSCOMMAND AndAlso m.WParam.ToInt32() = SC_MINIMIZE Then
        AnimateWindow(True, Me, NotifyIcon1)
        Exit Sub
    End If
    MyBase.WndProc(m)
End Sub

Private Sub NotifyIcon1_DoubleClick(ByVal sender As Object, ByVal e As System.EventArgs) Handles NotifyIcon1.DoubleClick
    AnimateWindow(False, Me, NotifyIcon1)
End Sub 
```

# windows - 如何可靠地获取 XP 和 Vista 中的 Quick Launch 文件夹？

> ID：76080
> 
> 赞同：1
> 
> 时间：2008-09-16T19:37:07.913
> 
> 标签：windows, visual-c++

我们需要在 Vista 和 XP 下为 All 和 Current 用户可靠地获取 Quick Launch 文件夹。我正在用 C++ 开发，但这可能更像是一个一般的 Windows API 问题。

作为参考，下面是获取两个系统下的 Application Data 文件夹的代码：

```
 HRESULT hres; 
    CString basePath;
    hres = SHGetSpecialFolderPath(this->GetSafeHwnd(), basePath.GetBuffer(MAX_PATH), CSIDL_APPDATA, FALSE);
    basePath.ReleaseBuffer(); 
```

我怀疑这只是知道微软使用哪个子文件夹的问题。

在 Windows XP 下，应用程序数据子文件夹是：

Microsoft\Internet Explorer\快速启动

在 Vista 下，子文件夹似乎已更改为：

漫游\Microsoft\Internet Explorer\快速启动

但我想确保这是确定正确位置的正确方法。

找到确定此位置的*正确*方法非常重要，因为当您进入国际安装等时，依赖硬编码的文件夹名称几乎总是会中断......事实上，该文件夹在 Vista 中被命名为“漫游”，这让我想知道是否有是与该文件夹相关的一些特殊处理（类似于 XP 下的 Local Settings 文件夹）。

编辑：以下 msdn 文章： http: [//msdn.microsoft.com/en-us/library/bb762494.aspx](http://msdn.microsoft.com/en-us/library/bb762494.aspx)表明 CSIDL_APPDATA 具有 FOLDERID_RoamingAppData 的等效 ID，这似乎支持 StocksR 的断言，即 CSIDL_APPDATA 确实返回 C:\ Users\xxxx\AppData\Roaming，因此应该可以为 CSIDL_APPDATA 使用相同的相对路径来快速启动（\Microsoft\Internet Explorer\Quick Launch）。

因此，以下算法对于每个 MS 都是正确的：

```
HRESULT hres; 
CString basePath;
hres = SHGetSpecialFolderPath(this->GetSafeHwnd(), basePath.GetBuffer(MAX_PATH), CSIDL_APPDATA, FALSE);
basePath.ReleaseBuffer();
CString qlPath = basePath + "\\Microsoft\\Internet Explorer\\Quick Launch"; 
```

检查 hres 以确保对 SHGetSpecialFolderPath 的调用成功也是一个好主意。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T19:54:15.907

vista 上的 AppData 指的是 C:\Users\xxxx\AppData\Roaming 而不是 C:\Users\xxxx\AppData 文件夹，它是自己的。

此外，微软网站上的这篇文章[http://www.microsoft.com/technet/scriptcenter/resources/qanda/sept05/hey0901.mspx](http://www.microsoft.com/technet/scriptcenter/resources/qanda/sept05/hey0901.mspx)暗示您只需使用相对于 appdata 文件夹的路径

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T20:02:28.290

好问题！

无论您做什么，**都不要屈服于**[挖掘注册表](http://blogs.msdn.com/oldnewthing/archive/2003/11/03/55532.aspx)以查找此信息的诱惑！

此外，我们必须抵制对某些路径进行硬编码的诱惑，即使是部分路径。如果我们获得特殊的 AppData 路径，然后只需在末尾附加一个字符串，这可能会在文件夹名称本地化为该语言的软件的非美国安装中中断。例如`GetSpecialFolderPath(APP_DATA) + "\\Fonts"`不能在非英语版本的 Windows 上工作。

希望有人能正确回答您的问题；我很想知道自己！

# python - 使用 GTK TextView 撤消

> ID：76096
> 
> 赞同：10
> 
> 时间：2008-09-16T19:38:45.397
> 
> 标签：python, gtk, text-editor, undo

我正在尝试将我贡献的程序的依赖关系降至最低，它是一个小型文本编辑器。

GTK Textview 似乎没有内置的撤消功能。到目前为止，我是否缺少任何参考实现？每个人都在为他们的 TextView 小部件编写自己的撤消功能吗？

我会对任何示例代码感到高兴——最高兴的是 python 示例代码，因为我们的项目是在 python 中。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-25T14:09:27.493

作为后续：我将 gtksourceview 的撤消机制移植到 python：[http ://bitbucket.org/tiax/gtk-textbuffer-with-undo/](http://bitbucket.org/tiax/gtk-textbuffer-with-undo/)

作为 gtksourceview 撤消的替代品

（此处为 OP，但启动板 open-id 不再起作用）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-16T20:15:54.577

据我所知，GTK TextView 不包含撤消功能。因此，虽然我不熟悉 Python 的 GTK 库，但我认为它没有。

Ruby-GNOME2 项目有一个[示例文本编辑器](http://ruby-gnome2.sourceforge.jp/hiki.cgi?Simple+Text+Editor)，它具有撤消/重做功能。基本上，它们连接到 TextView 小部件的 insert_text 和 delete_range 信号，并在列表中记录事件和相关数据。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-17T08:05:09.707

根据您对依赖的厌恶程度以及您正在构建的文本编辑器类型，[GtkSourceView](http://projects.gnome.org/gtksourceview/)添加了撤消/重做以及许多其他功能。如果您想要它提供的其他一些[功能](http://projects.gnome.org/gtksourceview/features.html)，非常值得一看。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-02-22T12:15:22.543

# 使用 GtkSource

*   [https://wiki.gnome.org/Projects/GtkSourceView](https://wiki.gnome.org/Projects/GtkSourceView)
*   [https://lazka.github.io/pgi-docs/GtkSource-3.0/](https://lazka.github.io/pgi-docs/GtkSource-3.0/)
*   [https://lazka.github.io/pgi-docs/GtkSource-3.0/classes.html](https://lazka.github.io/pgi-docs/GtkSource-3.0/classes.html)

.

*   [Cmnd] + [Z] 撤消（默认）
*   [Cmnd] + [Shift] + [Z] 重做（默认）
*   [Cmnd] + [Y] 用于重做（手动添加）

# 例子：

```
#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import gi
gi.require_version('Gtk', '3.0')
from gi.repository import Gtk
from gi.repository import Gdk
gi.require_version('GtkSource', '3.0')
from gi.repository import GtkSource

import os

class TreeviewWindow(Gtk.Window):
    def __init__(self):
        Gtk.Window.__init__(self, title="TreeviewWindow")
        self.set_size_request(300, 300)
        self.connect("key-press-event", self._key_press_event)
        self.mainbox = Gtk.VBox(spacing=10)
        self.add(self.mainbox) 

        self.textbuffer = GtkSource.Buffer()
        textview = GtkSource.View(buffer=self.textbuffer)
        textview.set_editable(True)
        textview.set_cursor_visible(True)
        textview.set_show_line_numbers(True)
        self.mainbox.pack_start(textview, True, True, 0)
        self.show_all()  

    def _key_press_event(self, widget, event):
        keyval_name = Gdk.keyval_name(event.keyval)
        ctrl = (event.state & Gdk.ModifierType.CONTROL_MASK)
        if ctrl and keyval_name == 'y':
            if self.textbuffer.can_redo():
                self.textbuffer.do_redo(self.textbuffer)

    def main(self):
        Gtk.main()

if __name__ == "__main__":
    base = TreeviewWindow()
    base.main() 
```

# 3d - 如何将 2D 点反向投影到 3D？

> ID：76134
> 
> 赞同：75
> 
> 时间：2008-09-16T19:42:33.250
> 
> 标签：3d, geometry, 2d, photogrammetry, reverseprojection

我在屏幕空间中有 4 个 2D 点，我需要将它们反向投影回 3D 空间。我知道这 4 个点中的每一个都是 3D 旋转刚性矩形的一个角，并且我知道矩形的大小。如何从中获得 3D 坐标？

我没有使用任何特定的 API，也没有现有的投影矩阵。我只是在寻找基本的数学来做到这一点。当然没有足够的数据将单个 2D 点转换为 3D 没有其他参考，但我想如果你有 4 个点，你就会知道它们在同一平面上彼此成直角，而且你知道它们之间的距离，你应该能够从那里弄清楚。不幸的是，我无法完全弄清楚如何。

这可能属于摄影测量的范畴，但谷歌搜索并没有让我找到任何有用的信息。

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2015-11-28T21:39:27.687

好吧，我来这里是为了寻找答案，但没有找到简单明了的东西，所以我继续做了愚蠢但有效（且相对简单）的事情：蒙特卡洛优化。

简单地说，算法如下：随机扰动您的投影矩阵，直到它将您已知的 3D 坐标投影到您已知的 2D 坐标。

这是托马斯坦克引擎的静态照片：

[![托马斯坦克引擎](https://i.stack.imgur.com/YUhsm.png)](https://i.stack.imgur.com/YUhsm.png)

假设我们使用 GIMP 在地平面上找到我们认为是正方形的 2D 坐标（它是否真的是正方形取决于您对深度的判断）：

[![带有正方形的轮廓](https://i.stack.imgur.com/u8nKF.png)](https://i.stack.imgur.com/u8nKF.png)

我在 2D 图像中得到四个点：`(318, 247)`、`(326, 312)`、`(418, 241)`和`(452, 303)`。

按照惯例，我们说这些点应该对应于 3D 点：`(0, 0, 0)`、`(0, 0, 1)`、`(1, 0, 0)`和`(1, 0, 1)`。换言之，y=0 平面中的单位正方形。

将这些 3D 坐标中的每一个投影到 2D 中是通过将 4D 向量`[x, y, z, 1]`与 4x4 投影矩阵相乘，然后将 x 和 y 分量除以 z 来实际获得透视校正来完成的。这或多或少是[gluProject()](https://www.opengl.org/sdk/docs/man2/xhtml/gluProject.xml)所做的，除了`gluProject()`还考虑当前视口并考虑单独的模型视图矩阵（我们可以假设模型视图矩阵是单位矩阵）。查看文档非常方便，`gluProject()`因为我实际上想要一个适用于 OpenGL 的解决方案，但请注意文档中缺少公式中的 z 除法。

请记住，该算法是从一些投影矩阵开始并随机扰动它，直到它给出我们想要的投影。所以我们要做的是投影四个 3D 点中的每一个，看看我们离我们想要的 2D 点有多近。如果我们的随机扰动导致投影的 2D 点更接近我们上面标记的点，那么我们保留该矩阵作为对我们最初（或之前）猜测的改进。

让我们定义我们的观点：

```
# Known 2D coordinates of our rectangle
i0 = Point2(318, 247)
i1 = Point2(326, 312)
i2 = Point2(418, 241)
i3 = Point2(452, 303)

# 3D coordinates corresponding to i0, i1, i2, i3
r0 = Point3(0, 0, 0)
r1 = Point3(0, 0, 1)
r2 = Point3(1, 0, 0)
r3 = Point3(1, 0, 1) 
```

我们需要从一些矩阵开始，单位矩阵似乎是一个自然的选择：

```
mat = [
    [1, 0, 0, 0],
    [0, 1, 0, 0],
    [0, 0, 1, 0],
    [0, 0, 0, 1],
] 
```

我们需要实际实现投影（基本上是矩阵乘法）：

```
def project(p, mat):
    x = mat[0][0] * p.x + mat[0][1] * p.y + mat[0][2] * p.z + mat[0][3] * 1
    y = mat[1][0] * p.x + mat[1][1] * p.y + mat[1][2] * p.z + mat[1][3] * 1
    w = mat[3][0] * p.x + mat[3][1] * p.y + mat[3][2] * p.z + mat[3][3] * 1
    return Point(720 * (x / w + 1) / 2., 576 - 576 * (y / w + 1) / 2.) 
```

这基本上是什么`gluProject()`，720 和 576 分别是图像的宽度和高度（即视口），我们从 576 中减去以计算我们从顶部计算 y 坐标的事实，而 OpenGL 通常从底部。你会注意到我们没有计算 z，那是因为我们在这里并不真正需要它（尽管它可以很方便地确保它落在 OpenGL 用于深度缓冲区的范围内）。

现在我们需要一个函数来评估我们与正确解决方案的接近程度。该函数返回的值是我们将用来检查一个矩阵是否优于另一个矩阵的值。我选择按距离平方和，即：

```
# The squared distance between two points a and b
def norm2(a, b):
    dx = b.x - a.x
    dy = b.y - a.y
    return dx * dx + dy * dy

def evaluate(mat): 
    c0 = project(r0, mat)
    c1 = project(r1, mat)
    c2 = project(r2, mat)
    c3 = project(r3, mat)
    return norm2(i0, c0) + norm2(i1, c1) + norm2(i2, c2) + norm2(i3, c3) 
```

为了扰动矩阵，我们只需在某个范围内随机选择一个元素进行扰动：

```
def perturb(amount):
    from copy import deepcopy
    from random import randrange, uniform
    mat2 = deepcopy(mat)
    mat2[randrange(4)][randrange(4)] += uniform(-amount, amount) 
```

（值得注意的是，我们的`project()`函数实际上根本没有使用`mat[2]`，因为我们不计算 z，并且由于我们所有的 y 坐标都是 0，所以这些`mat[*][1]`值也是无关紧要的。我们可以使用这个事实，并且永远不要试图扰乱这些值，这将提供一个小的加速，但这留作练习......）

`perturb()`为方便起见，让我们添加一个函数，通过一遍又一遍地调用我们迄今为止找到的最佳矩阵来完成大部分近似：

```
def approximate(mat, amount, n=100000):
    est = evaluate(mat)

    for i in xrange(n):
        mat2 = perturb(mat, amount)
        est2 = evaluate(mat2)
        if est2 < est:
            mat = mat2
            est = est2

    return mat, est 
```

现在剩下要做的就是运行它......：

```
for i in xrange(100):
    mat = approximate(mat, 1)
    mat = approximate(mat, .1) 
```

我发现这已经给出了一个非常准确的答案。运行一段时间后，我发现的矩阵是：

```
[
    [1.0836000765696232,  0,  0.16272110011060575, -0.44811064935115597],
    [0.09339193527789781, 1, -0.7990570384334473,   0.539087345090207  ],
    [0,                   0,  1,                    0                  ],
    [0.06700844759602216, 0, -0.8333379578853196,   3.875290562060915  ],
] 
```

误差约为`2.6e-5`. （注意我们所说的未在计算中使用的元素实际上并没有从我们的初始矩阵中改变；那是因为改变这些条目不会改变评估的结果，所以改变永远不会继续。）

我们可以使用以下方法将矩阵传递给 OpenGL `glLoadMatrix()`（但请记住先转置它，并记住使用单位矩阵加载模型视图矩阵）：

```
def transpose(m):
    return [
        [m[0][0], m[1][0], m[2][0], m[3][0]],
        [m[0][1], m[1][1], m[2][1], m[3][1]],
        [m[0][2], m[1][2], m[2][2], m[3][2]],
        [m[0][3], m[1][3], m[2][3], m[3][3]],
    ]

glLoadMatrixf(transpose(mat)) 
```

现在我们可以例如沿 z 轴平移以获得沿轨道的不同位置：

```
glTranslate(0, 0, frame)
frame = frame + 1

glBegin(GL_QUADS)
glVertex3f(0, 0, 0)
glVertex3f(0, 0, 1)
glVertex3f(1, 0, 1)
glVertex3f(1, 0, 0)
glEnd() 
```

[![带 3D 翻译](https://i.stack.imgur.com/dfeEx.gif)](https://i.stack.imgur.com/dfeEx.gif)

从数学的角度来看，这肯定不是很优雅。你没有得到一个封闭形式的方程，你可以将你的数字插入并得到一个直接（和准确）的答案。但是，它确实允许您添加额外的约束，而不必担心使方程式复杂化；例如，如果我们也想合并高度，我们可以使用房子的那个角落并说（在我们的评估函数中）从地面到屋顶的距离应该是某某，然后再次运行该算法。所以，是的，这是一种蛮力，但有效，而且运作良好。

[![咻咻咻！](https://i.stack.imgur.com/smdR8.png)](https://i.stack.imgur.com/smdR8.png)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2012-12-18T16:21:50.147

这是基于标记的增强现实的经典问题。

您有一个方形标记（2D 条形码），并且您想在找到标记的四个边缘后找到它的姿势（相对于相机的平移和旋转）。 [概览-图片](http://www.brightsideofnews.com/Data/2009_10_26/Zombies-nVidia-Tegra-Augmented-Reality/Zombies_AR_Marker_675.jpg)

我不知道对该领域的最新贡献，但至少在一定程度上（2009 年）RPP 应该优于上面提到的 POSIT（并且确实是一个经典的方法）请查看链接，他们也提供来源。

*   [http://www.emt.tugraz.at/~vmg/schweighofer](http://www.emt.tugraz.at/~vmg/schweighofer)

*   [http://www.emt.tugraz.at/publications/EMT_TR/TR-EMT-2005-01.pdf](http://www.emt.tugraz.at/publications/EMT_TR/TR-EMT-2005-01.pdf)

*   [http://www.emt.tugraz.at/system/files/rpp_MATLAB_ref_implementation.tar.gz](http://www.emt.tugraz.at/system/files/rpp_MATLAB_ref_implementation.tar.gz)

（PS - 我知道这是一个有点老的话题，但无论如何，这篇文章可能对某人有帮助）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-08-24T08:38:37.770

*D. DeMenthon*设计了一种算法，在知道对象模型的情况下，根据 2D 图像中的特征点计算对象的*姿势*（其在空间中的位置和方向）——**这正是您的问题**：

> 我们描述了一种从单个图像中找到对象姿势的方法。我们假设我们可以在图像中检测和匹配对象的四个或更多非共面特征点，并且我们知道它们在对象上的相对几何形状。

该算法被称为**Posit**，在其经典文章“25 行代码中基于模型的对象姿势”中进行了描述（可在[其网站上获得](http://www.cfar.umd.edu/~daniel/Site_2/Research.html)，第 4 节）。

文章直接链接：[http](http://www.cfar.umd.edu/~daniel/daniel_papersfordownload/Pose25Lines.pdf) ://www.cfar.umd.edu/~daniel/daniel_papersfordownload/Pose25Lines.pdf OpenCV 实现： http: [//opencv.willowgarage.com/wiki/Posit](http://opencv.willowgarage.com/wiki/Posit)

这个想法是通过*缩放的正交投影*反复逼近透视投影，直到收敛到准确的姿势。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-16T22:42:05.863

对于我的 OpenGL 引擎，以下片段会将鼠标/屏幕坐标转换为 3D 世界坐标。阅读评论以了解正在发生的事情的实际描述。

```
/* 功能：YCamera :: 计算世界坐标
     参数：x 鼠标 x 坐标
                      y 鼠标 y 坐标
                      vec 在哪里存储坐标
     返回：不适用
     描述：将鼠标坐标转换为世界坐标
*/

```

```
void YCamera :: CalculateWorldCoordinates(float x, float y, YVector3 *vec)
{
    //  START
    GLint viewport[4];
    GLdouble mvmatrix[16], projmatrix[16];

    GLint real_y;
    GLdouble mx, my, mz;

    glGetIntegerv(GL_VIEWPORT, viewport);
    glGetDoublev(GL_MODELVIEW_MATRIX, mvmatrix);
    glGetDoublev(GL_PROJECTION_MATRIX, projmatrix);

    real_y = viewport[3] - (GLint) y - 1;   // viewport[3] is height of window in pixels
    gluUnProject((GLdouble) x, (GLdouble) real_y, 1.0, mvmatrix, projmatrix, viewport, &mx, &my, &mz);

    /*  'mouse' is the point where mouse projection reaches FAR_PLANE.
        World coordinates is intersection of line(camera->mouse) with plane(z=0) (see LaMothe 306)

        Equation of line in 3D:
            (x-x0)/a = (y-y0)/b = (z-z0)/c      

        Intersection of line with plane:
            z = 0
            x-x0 = a(z-z0)/c  <=> x = x0+a(0-z0)/c  <=> x = x0 -a*z0/c
            y = y0 - b*z0/c

    */
    double lx = fPosition.x - mx;
    double ly = fPosition.y - my;
    double lz = fPosition.z - mz;
    double sum = lx*lx + ly*ly + lz*lz;
    double normal = sqrt(sum);
    double z0_c = fPosition.z / (lz/normal);

    vec->x = (float) (fPosition.x - (lx/normal)*z0_c);
    vec->y = (float) (fPosition.y - (ly/normal)*z0_c);
    vec->z = 0.0f;
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-16T20:00:57.920

从二维空间将有 2 个可以构建的有效矩形。在不知道原始矩阵投影的情况下，您将不知道哪个是正确的。这与“盒子”问题相同：您看到两个正方形，一个在另一个内部，其中 4 个内部顶点连接到 4 个相应的外部顶点。你是从自上而下还是自下而上看一个盒子？

话虽如此，您正在寻找矩阵变换 T ，其中...

{{x1, y1, z1}, {x2, y2, z2}, {x3, y3, z3}, {x4, y4, z4}} x T = {{x1, y1}, {x2, y2}, { x3, y3}, {x4, y4}}

(4 x 3) x T = (4 x 2)

所以 T 必须是 (3 x 2) 矩阵。所以我们有6个未知数。

现在在 T 上建立一个约束系统并用 Simplex 求解。要构建约束，您知道通过前两个点的线必须平行于通过后两个点的线。您知道通过点 1 和 3 的线必须平行于通过点 2 和 4 的线。您知道通过 1 和 2 的线必须与通过点 2 和 3 的线正交。您知道长度从 1 到 2 的线的长度必须等于从 3 到 4 的线的长度。你知道从 1 到 3 的线的长度必须等于从 2 到 4 的线的长度。

为了让这更容易，你知道矩形，所以你知道所有边的长度。

这应该会给你很多限制来解决这个问题。

当然，要回来，你可以找到T-inverse。

@Rob：是的，有无限数量的投影，但不是无限数量的点必须满足矩形要求的项目。

@nlucaroni：是的，这只有在投影中有四个点时才能解决。如果矩形仅投影到 2 个点（即矩形的平面与投影面正交），则无法解决此问题。

嗯...我应该回家写这个小宝石。这听起来很有趣。

更新：

1.  除非您修复其中一个点，否则有无限数量的投影。如果您固定原始矩形的点，则有两个可能的原始矩形。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-18T15:50:04.230

To follow up on Rons approach: You can find your z-values if you know how you've rotated your rectangle.

The trick is to find the projective matrix that did the projection. Fortunately this is possible and even cheap to do. The relevant math can be found in the paper "Projective Mappings for Image Warping" by Paul Heckbert.

[http://pages.cs.wisc.edu/~dyer/cs766/readings/heckbert-proj.pdf](http://pages.cs.wisc.edu/~dyer/cs766/readings/heckbert-proj.pdf)

This way you can recover the homogenous part of each vertex back that was lost during projection.

Now you're still left with four lines instead of points (as Ron explained). Since you know the size of your original rectangle however nothing is lost. You can now plug the data from Ron's method and from the 2D approach into a linear equation solver and solve for z. You get the exact z-values of each vertex that way.

Note: This just works because:

1.  The original shape was a rectangle
2.  You know the exact size of the rectangle in 3D space.

It's a special case really.

Hope it helps, Nils

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-16T19:58:35.413

假设这些点确实是矩形的一部分，我给出一个通用的想法：

找到最大间距的两个点：这些最有可能定义对角线（例外：矩形几乎平行于 YZ 平面的特殊情况，留给学生）。称它们为 A、C。计算 BAD、BCD 角度。与直角相比，这些为您提供 3d 空间中的方向。要了解 z 距离，您需要将投影边与已知边相关联，然后根据 3d 投影方法（是 1/z 吗？），您在正确的轨道上了解距离。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-10-05T14:53:00.047

感谢@Vegard 的出色回答。我稍微清理了代码：

```
import pandas as pd
import numpy as np

class Point2:
    def __init__(self,x,y):
        self.x = x
        self.y = y

class Point3:
    def __init__(self,x,y,z):
        self.x = x
        self.y = y
        self.z = z

# Known 2D coordinates of our rectangle
i0 = Point2(318, 247)
i1 = Point2(326, 312)
i2 = Point2(418, 241)
i3 = Point2(452, 303)

# 3D coordinates corresponding to i0, i1, i2, i3
r0 = Point3(0, 0, 0)
r1 = Point3(0, 0, 1)
r2 = Point3(1, 0, 0)
r3 = Point3(1, 0, 1)

mat = [
    [1, 0, 0, 0],
    [0, 1, 0, 0],
    [0, 0, 1, 0],
    [0, 0, 0, 1],
]

def project(p, mat):
    #print mat
    x = mat[0][0] * p.x + mat[0][1] * p.y + mat[0][2] * p.z + mat[0][3] * 1
    y = mat[1][0] * p.x + mat[1][1] * p.y + mat[1][2] * p.z + mat[1][3] * 1
    w = mat[3][0] * p.x + mat[3][1] * p.y + mat[3][2] * p.z + mat[3][3] * 1
    return Point2(720 * (x / w + 1) / 2., 576 - 576 * (y / w + 1) / 2.)

# The squared distance between two points a and b
def norm2(a, b):
    dx = b.x - a.x
    dy = b.y - a.y
    return dx * dx + dy * dy

def evaluate(mat): 
    c0 = project(r0, mat)
    c1 = project(r1, mat)
    c2 = project(r2, mat)
    c3 = project(r3, mat)
    return norm2(i0, c0) + norm2(i1, c1) + norm2(i2, c2) + norm2(i3, c3)    

def perturb(mat, amount):
    from copy import deepcopy
    from random import randrange, uniform
    mat2 = deepcopy(mat)
    mat2[randrange(4)][randrange(4)] += uniform(-amount, amount)
    return mat2

def approximate(mat, amount, n=1000):
    est = evaluate(mat)
    for i in xrange(n):
        mat2 = perturb(mat, amount)
        est2 = evaluate(mat2)
        if est2 < est:
            mat = mat2
            est = est2

    return mat, est

for i in xrange(1000):
    mat,est = approximate(mat, 1)
    print mat
    print est 
```

.1 的近似调用对我不起作用，所以我把它拿出来了。我也运行了一段时间，最后我检查它是在

```
[[0.7576315397559887, 0, 0.11439449272592839, -0.314856490473439], 
[0.06440497208710227, 1, -0.5607502645413118, 0.38338196981556827], 
[0, 0, 1, 0], 
[0.05421620936883742, 0, -0.5673977598434641, 2.693116299312736]] 
```

误差在 0.02 左右。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-16T19:59:20.420

如果没有人回答，我回家后会拿出我的线性代数书。但是@DG，并非所有矩阵都是可逆的。[奇异矩阵是不可逆的](http://mathworld.wolfram.com/SingularMatrix.html)（当行列式 = 0 时）。这实际上会一直发生，因为投影矩阵*必须*具有 0 和 1 的特征值，并且是正方形的（因为它是幂等的，所以 p^2 = p）。

一个简单的例子是，[[0 1][0 1]] 因为行列式 = 0，那是在 x = y 线上的投影！

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-16T20:00:56.373

您在 2D 表面上的投影具有无限多个 3D 矩形，它们将投影到相同的 2D 形状。

这样想：你有四个 3D 点组成 3D 矩形。称它们为 (x0,y0,z0)、(x1,y1,z1)、(x2,y2,z2) 和 (x3,y3,z3)。当您将这些点投影到 xy 平面上时，您会删除 z 坐标：(x0,y0)、(x1,y1)、(x2,y2)、(x3,y3)。

现在，您想投影回 3D 空间，您需要对 z0,..,z3 进行逆向工程。但是任何一组 z 坐标 a）在点之间保持相同的 xy 距离，并且 b）保持矩形的形状都可以。所以，这个（无限）集合的任何成员都可以：{(z0+i, z1+i, z2+i, z3+i) | 我<-R}。

编辑@Jarrett：想象一下你解决了这个问题并最终在 3D 空间中得到了一个矩形。现在，想象一下在 z 轴上上下滑动该矩形。那些无限量的平移矩形都具有相同的 xy 投影。你怎么知道你找到了“正确的”？

编辑#2：好的，这是我对这个问题的评论——一种更直观的推理方法。

想象一下在你的桌子上方放一张纸。假设纸的每个角落都附有一个无重量的激光笔，指向桌子。纸是3D物体，桌上的激光笔点是2D投影。

现在，您如何*仅*通过激光笔点来判断纸张离桌面有多高？

你不能。上下移动纸张。无论纸张的高度如何，激光笔仍会照在桌子上的相同点上。

在反向投影中找到 z 坐标就像试图仅根据桌子上的激光指针点来找到纸张的高度。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-16T20:58:35.160

当您从 3D 投影到 2D 时，您会丢失信息。

在单点的简单情况下，逆投影将为您提供穿过 3d 空间的无限光线。

立体重建通常从两个 2D 图像开始，然后将两者都投影回 3D。然后寻找产生的两条 3D 射线的交点。

投影可以采取不同的形式。正交或透视。我猜你假设正交投影？

在您的情况下，假设您拥有原始矩阵，您将在 3D 空间中拥有 4 条光线。然后，您将能够通过 3d 矩形尺寸限制问题并尝试解决。

该解决方案将不会是唯一的，因为围绕平行于 2d 投影平面的任一轴的旋转在方向上将是不明确的。换句话说，如果 2d 图像垂直于 z 轴，那么围绕 x 轴顺时针或逆时针旋转 3d 矩形将产生相同的图像。对于 y 轴也是如此。

在矩形平面平行于 z 轴的情况下，您有更多的解决方案。

由于您没有原始投影矩阵，因此任何投影中都存在任意比例因子会引入进一步的歧义。您无法区分投影中的缩放和在 z 轴方向上的 3d 平移。如果您只对 3d 空间中 4 个点彼此相关而不是 2d 投影平面的相对位置感兴趣，这不是问题。

在透视投影中，事情变得更加困难......

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-16T21:13:59.723

如果您知道该形状是平面中的矩形，则可以大大进一步限制该问题。您当然无法确定“哪个”平面，因此您可以选择它位于 z=0 且其中一个角位于 x=y=0 的平面上，并且边缘平行于 x/y 轴。

因此 3d 中的点是 {0,0,0}、{w,0,0}、{w,h,0} 和 {0,h,0}。我很确定绝对尺寸不会被发现，所以只有 w/h 的比率是相关的，所以这是一个未知数。

相对于该平面，相机必须位于空间中的某个点 cx,cy,cz，必须指向 nx,ny,nz 方向（长度为 1 的向量，因此其中一个是多余的），并且具有 focus_length/image_width w 的因数。这些数字变成了一个 3x3 的投影矩阵。

这给出了总共 7 个未知数：w/h、cx、cy、cz、nx、ny 和 w。

你总共有 8 个已知：4 个 x+y 对。

所以这个可以解决。

下一步是使用 Matlab 或 Mathmatica。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-05-05T09:48:06.687

是的，蒙特卡洛有效，但我为这个问题找到了更好的解决方案。此代码完美运行（并使用 OpenCV）：

```
Cv2.CalibrateCamera(new List<List<Point3f>>() { points3d }, new List<List<Point2f>>() { points2d }, new Size(height, width), cameraMatrix, distCoefs, out rvecs, out tvecs, CalibrationFlags.ZeroTangentDist | CalibrationFlags.FixK1 | CalibrationFlags.FixK2 | CalibrationFlags.FixK3); 
```

此函数采用已知的 3d 和 2d 点、屏幕大小并返回旋转 (rvecs[0])、平移 (tvecs[0]) 和相机的内在值矩阵。这是你需要的一切。

# asp.net - 如何判断用户的浏览器是否可以查看PDF文件

> ID：76179
> 
> 赞同：10
> 
> 时间：2008-09-16T19:47:36.187
> 
> 标签：asp.net, javascript, pdf, browser

确定用户的浏览器是否可以查看 PDF 文件的最佳方法是什么？

理想情况下，它在浏览器或操作系统上应该无关紧要。

在 ASP.NET 中是否有特定的方法，或者答案只是 JavaScript？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-16T19:55:10.833

没有，没有，不要尝试。

重新[黎明](https://stackoverflow.com/questions/76179/how-to-determine-if-the-users-browser-can-view-pdf-files#76220)：插件检测不是正确的答案。我的浏览器（Ubuntu 上的 Firefox）中没有安装 PDF 插件，但我可以使用操作系统的文档查看器（不是 Acrobat Reader）查看 PDF 文件。

今天，任何可以运行网络浏览器的操作系统都可以开箱即用地查看 PDF 文件。

如果特定系统没有安装 PDF 查看器并且浏览器配置为使用它，这可能意味着它要么是手工安装的 Windows，要么是非常精简的替代操作系统，要么是真正复古的东西。

可以合理地假设，在任何一种情况下，用户都会知道 PDF 文件是什么，并且故意选择不能够查看它们或知道如何安装所需的软件。

如果我在自欺欺人，我很想向我解释我错在哪里。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-16T19:51:09.660

一个快速的谷歌搜索[发现了这个](http://www.oreillynet.com//cs/user/view/cs_msg/9920)。适用于各种插件。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-16T20:02:05.343

有些用户选择不在浏览器中打开 PDF 并禁用插件（这允许文件在浏览器窗口外部的本机应用程序中打开）。最好让用户知道打开某些东西（无论是否是 PDF）需要软件，而不是尝试检测插件是否可用。

检测的另一个问题是您需要查找版本之间的变化（例如，请参阅：Adobe PDF 查看器的“PDF.PdfCtrl.*”与“AcroPDF.PDF.*”）和不同的浏览器实现（例如前面提到的字符串在IE中使用，而Firefox使用完全不同的检测方式。那么我们需要考虑Opera和Safari和???)。此外，有不同的供应商（想想 Foxit 和 Ghostscript，虽然我不确定他们是否为浏览器提供插件），在检测插件方面可能存在差异。

有关 2008 年编写的脚本和有关警告的更多信息，请参阅[Detecting plugins in Internet Explorer（以及所有其他的一些提示）](http://www.builtfromsource.com/2007/06/26/detecting-plugins-in-internet-explorer-and-a-few-hints-for-all-the-others/)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-17T21:30:31.300

在最初忽略此页面上的建议后，架构师继续使用 Acrobat 检测，导致不可避免的支持噩梦。

正如 ddaa 所提到的，并非所有场景都可以通过插件检测准确捕获。例如，某些用户可能会选择使用 FoxIt Reader 而不是 acrobat 来查看 PDF 文件。一些用户的浏览器不会标记他们已准备好 Acrobat，当然也不总是以相同的方式。

更好的解决方案是让用户选择他们希望如何查看相关文档。就个人而言，我不喜欢让任何网站依赖插件——它破坏了网络的美感。

# oop - 应始终禁止受保护的属性吗？

> ID：76194
> 
> 赞同：15
> 
> 时间：2008-09-16T19:48:44.703
> 
> 标签：oop, inheritance, class-design, protected

我很少使用继承，但是当我这样做时，我从不使用受保护的属性，因为我认为它破坏了继承类的封装。

你使用受保护的属性吗？你用它们做什么？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-10-09T23:41:06.967

在Bill Venners 对 Design 的[采访中，](http://www.artima.com/intv/blochP.html) *Effective Java*的作者 Joshua Bloch说：

> ## 信任子类
> 
> **Bill Venners：** *我应该比非子类更信任子类吗？例如，我是否让子类实现比非子类更容易破坏我？特别是，您如何看待受保护的数据？*
> 
> **乔什·布洛赫：**假设您允许子类访问您的内部数据结构，那么编写既可子类化又能抵抗恶意子类的东西实际上是一件非常困难的事情。如果子类无法访问普通用户无法访问的任何内容，那么子类就更难造成损害。但是，除非您将所有方法都设置为最终方法，否则子类仍然可以通过对方法调用做出错误的事情来破坏您的契约。这正是像 String 这样的安全关键类是 final 的原因。否则，有人可以编写一个子类，使字符串看起来是可变的，这足以破坏安全性。所以你必须信任你的子类。如果你不信任他们，那么你就不能允许他们，
> 
> 就一般受保护的数据而言，这是一种必要的邪恶。它应该保持在最低限度。大多数受保护的数据和受保护的方法相当于对实现细节的承诺。受保护字段是您使子类可见的实现细节。即使是受保护的方法也是您使子类可见的内部结构。
> 
> 你让它可见的原因是它通常是必要的，以便允许子类完成它们的工作，或者有效地完成它。但是一旦你完成了它，你就会致力于它。它现在是不允许更改的，即使您以后找到不再涉及使用特定字段或方法的更有效的实现也是如此。
> 
> 因此，在所有其他条件相同的情况下，您根本不应该有任何受保护的成员。但是就是说，如果您的课程太少，那么您的课程可能无法用作超课程，或者至少不能用作高效的超课程。通常你会在事后发现。我的理念是在你第一次编写类时尽可能少地包含受保护的成员。然后尝试对其进行子类化。您可能会发现，如果没有特定的受保护方法，所有子类都将不得不做一些坏事。
> 
> 例如，如果您查看 `AbstractList`，您会发现有一种受保护的方法可以一次性删除列表的范围（`removeRange`）。为什么会在里面？因为基于公共 API 删除范围的正常习惯用法是调用`subList`以获取子对象`List`，然后调用`clear`该子对象`List`。然而，如果没有这种特殊的受保护方法，唯一`clear`可以做的就是反复删除单个元素。
> 
> 想想看。如果你有一个数组表示，它会做什么？它会反复折叠数组，做 N 次工作 N 次。因此，它将需要二次工作量，而不是它应该做的线性工作量。通过提供这种受保护的方法，我们允许任何可以有效删除整个范围的实现这样做。并且任何合理`List`的实现都可以一次更有效地删除一个范围。
> 
> 我们需要这种受保护的方法，你必须比我更聪明才能预先知道。基本上，我实现了这个东西。然后，当我们开始对其进行子类化时，我们意识到范围删除是二次的。我们负担不起，所以我使用了受保护的方法。我认为这是使用受保护方法的最佳方法。尽可能少地放入，然后根据需要添加更多。受保护的方法代表对您可能想要更改的设计的承诺。您始终可以添加受保护的方法，但不能将它们取出。
> 
> **Bill Venners：** *还有受保护的数据？*
> 
> **Josh Bloch：**同样的事情，但更多。就弄乱数据不变量而言，受保护的数据更加危险。如果您让其他人访问某些内部数据，他们就可以自由支配这些数据。

简短的版本：它打破了封装，但它是一个必要的邪恶，应该保持在最低限度。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-16T19:52:27.893

C＃：

我将 protected 用于我希望基类覆盖的抽象或虚拟方法。如果它可以被基类调用，我也会保护一个方法，但我不希望它在类层次结构之外调用。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-16T19:51:36.723

您可能需要它们作为静态（或“全局”）属性，您希望您的子类或来自同一包（如果它是关于 java）的类从中受益。

那些代表某种“常量值”的静态最终属性很少有 getter 函数，因此在这种情况下，受保护的静态最终属性可能是有意义的。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-16T19:59:02.870

Scott Meyers 说*不要*在 Effective C++（第 3 版）中使用受保护的属性：

> 第 22 项：将数据成员声明为私有。

原因与您给出的相同：它破坏了封装。结果是，否则对类布局的局部更改可能会破坏依赖类型并导致许多其他地方的更改。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-16T19:51:37.147

我不在 Java 中使用受保护的属性，因为它们只是在那里受到包保护。但是在 C++ 中，我会在抽象类中使用它们，允许继承类直接继承它们。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-16T19:52:46.330

拥有受保护的属性从来没有任何充分的理由。基类必须能够依赖于状态，这意味着通过访问器方法限制对数据的访问。你不能让任何人访问你的私人数据，即使是孩子。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-17T20:35:37.327

我最近从事的一个项目是“受保护”成员是一个非常好的主意。类层次结构类似于：

```
[+] Base
 |
 +--[+] BaseMap
 |   |
 |   +--[+] Map
 |   |
 |   +--[+] HashMap
 |
 +--[+] // something else ? 
```

Base 实现了一个 std::list 但没有别的。用户禁止直接访问列表，但由于基类不完整，它无论如何都依赖派生类来实现对列表的间接访问。

间接可能来自至少两种风格：std::map 和 stdext::hash_map。两个映射的行为方式相同，但 hash_map 需要 Key 是可散列的（在 VC2003 中，可转换为 size_t）。

因此 BaseMap 将 TMap 实现为模板类型，它是一个类似地图的容器。

Map 和 HashMap 是 BaseMap 的两个派生类，一个专门针对 std::map 的 BaseMap，另一个专门针对 stdext::hash_map。

所以：

*   Base 不能这样使用（没有公共访问器！），仅提供通用功能和代码

*   BaseMap 需要轻松读取/写入 std::list

*   Map 和 HashMap 需要对 BaseMap 中定义的 TMap 进行简单的读/写访问。

对我来说，唯一的解决方案是对 std::list 和 TMap 成员变量使用 protected。我没有办法将这些“私有”，因为无论如何我都会通过读/写访问器公开它们的所有或几乎所有功能。

最后，我想如果你最终将你的类划分为多个对象，每个派生都为其母类添加所需的特性，并且只有最派生的类才真正可用，那么受保护的方法就是要走的路。“受保护的成员”是一个类，因此几乎不可能“破坏”这一事实，这一点有所帮助。

但除此之外，应尽可能避免使用protected（即：默认使用private，当您必须公开该方法时使用public）。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2016-04-16T05:26:07.880

关键字是概念性错误和语言设计拙劣，以及经过精心设计的几种`protected`现代语言，例如 Nim 和 Ceylon（参见[http://ceylon-lang.org/documentation/faq/language-design/#no_protected_modifier](http://ceylon-lang.org/documentation/faq/language-design/#no_protected_modifier) ）不要只是复制常见的错误，不要有这样的关键字。

破坏封装的不是受保护的成员，而是暴露不应该暴露的成员破坏封装......无论它们是受保护的还是公共的都没有关系。问题`protected`在于它是错误的和误导性的......声明成员`protected`（而不是`private`）并不能保护它们，它会起到相反的作用，完全一样`public`。一个受保护的成员，可以在类外部访问，暴露给世界，因此它的语义必须永远保持，就像`public`. “受保护”的整个想法是无稽之谈......封装不是安全，而关键字只是进一步混淆了两者。您可以通过避免所有使用`protected`在你自己的类中——如果某些东西是实现的内部部分，不是类语义的一部分，并且将来可能会发生变化，那么将其设为私有或内部到你的包、模块、程序集等。如果它是类语义中不可更改的部分，然后将其公开，然后您就不会惹恼您的类的用户，他们可以看到文档中有一个有用的成员但不能使用它，除非他们正在创建自己的实例并且可以通过子类化来解决。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-16T19:53:37.763

一般来说，不，您真的不想使用受保护的数据成员。如果您编写 API，则更是如此。一旦有人从你的类继承，你就永远不能真正进行维护，也不能以一种奇怪的，有时甚至是狂野的方式破坏它们。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-16T19:53:57.967

我用它们。简而言之，如果您想共享某些属性，这是一个好方法。当然，您可以为它们编写 set/get 函数，但如果没有验证，那有什么意义呢？它也更快。

考虑一下：你有一个类，它是你的基类。它有很多你不想在子对象中使用的属性。您可以为每个函数编写一个 get/set 函数，也可以只设置它们。

我的典型示例是文件/流处理程序。您想访问处理程序（即文件描述符），但您想对其他类隐藏它。这比为其编写 set/get 函数要容易得多。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-16T19:54:22.427

我认为受保护的属性是一个坏主意。我使用[CheckStyle](http://checkstyle.sourceforge.net/)与我的 Java 开发团队强制执行该规则。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-16T19:58:18.893

一般来说，是的。受保护的方法通常更好。

在使用中，通过对一个类的所有子级共享的对象使用受保护的**final变量可以提供一定程度的简单性。**我总是建议不要将它与原语或集合一起使用，因为无法为这些类型定义合同。

最近，我开始将您使用原语和原始集合所做的事情与您使用格式良好的类所做的事情分开。基元和集合应该始终是私有的。

此外，我开始偶尔公开公共成员变量，因为它们被声明为 final 并且是不太灵活的格式良好的类（同样，不是原语或集合）。

**这不是什么愚蠢的捷径，我非常认真地考虑了一下，并决定公开最终**变量公开对象和吸气剂之间绝对没有区别。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-01-09T16:51:57.527

这取决于你想要什么。如果你想要一个快速的类，那么数据应该受到保护并使用受保护的和公共的方法。因为我认为您应该假设从您的类派生的用户非常了解您的类，或者至少他们已经阅读了他们将要覆盖的功能的手册。

如果您的用户弄乱了您的课程，那不是您的问题。每个恶意用户都可以在覆盖您的一个虚拟对象时添加以下行：

（C＃）

```
static Random rnd=new Random();
//...
if (rnd.Next()%1000==0) throw new Exception("My base class sucks! HAHAHAHA! xD");
//... 
```

你不能密封每个班级来防止这种情况。

当然，如果您想对某些字段进行约束，则使用访问器函数或属性或您想要的东西并将该字段设为私有，因为没有其他解决方案......

但我个人不喜欢不惜一切代价坚持 oop 原则。尤其是使属性的唯一目的是使数据成员私有。

（C＃）：

```
private _foo;
public foo
{
   get {return _foo;}
   set {_foo=value;}
} 
```

这是我个人的看法。

但是做你老板要求的（如果他想要私人领域，那就这样做。）

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-01-09T17:07:31.453

我在我知道不打算更改为方法的基类中使用受保护的变量/属性。这样，子类可以完全访问它们继承的变量，并且没有通过 getter/setter 访问它们的（人为创建的）开销。一个示例是使用底层 I/O 流的类；几乎没有理由不允许子类直接访问底层流。

这对于在基类和所有子类中以直接简单的方式使用的成员变量很好。但是对于具有更复杂用途的变量（例如，访问它会导致类中的其他成员产生副作用），直接访问的变量是不合适的。在这种情况下，可以将其设为私有，而可以提供公共/受保护的 getter/setter。一个例子是基类提供的内部缓冲机制，直接从子类访问缓冲区会损害基类用来管理它们的算法的完整性。

这是一个设计判断决定，基于成员变量的简单程度以及在未来版本中的预期程度。

封装很棒，但它可能太过分了。我见过自己的私有方法仅使用 getter/setter 方法访问其成员变量的类。这太过分了，因为如果一个类不能用自己的私有数据信任自己的私有方法，它还能信任谁呢？

# xml - 使用具有未知名称空间的 XSLT 时如何获取属性值？

> ID：76204
> 
> 赞同：3
> 
> 时间：2008-09-16T19:49:32.720
> 
> 标签：xml, xslt, namespaces

我收到了一个无法确定名称空间的第 3 方提要，因此我目前不得不在我的 XSLT 中使用 local-name() 函数来获取元素值。但是，我需要从一个这样的元素中获取一个属性，并且当命名空间未知时我不知道如何执行此操作（因此需要 local-name() 函数）。

注意我正在使用 .net 2.0 来处理 XSLT

这是 XML 的示例：

```
<?xml version="1.0" encoding="UTF-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
   <id>some id</id>
   <title>some title</title>
   <updated>2008-09-11T15:53:31+01:00</updated>
   <link rel="self" href="http://www.somefeedurl.co.uk" />
   <author>
      <name>some author</name>
      <uri>http://someuri.co.uk</uri>
   </author>
   <generator uri="http://aardvarkmedia.co.uk/">AardvarkMedia script</generator>
   <entry>
      <id>http://soemaddress.co.uk/branded3/80406</id>
      <title type="html">My Ttile</title>
      <link rel="alternate" href="http://www.someurl.co.uk" />
      <updated>2008-02-13T00:00:00+01:00</updated>
      <published>2002-09-11T14:16:20+01:00</published>
      <category term="mycategorytext" label="restaurant">Test</category>
      <content type="xhtml">
         <div xmlns="http://www.w3.org/1999/xhtml">
            <div class="vcard">
               <p class="fn org">some title</p>
               <p class="adr">
                  <abbr class="type" title="POSTAL" />
                  <span class="street-address">54 Some Street</span>
                  ,
                  <span class="locality" />
                  ,
                  <span class="country-name">UK</span>
               </p>
               <p class="tel">
                  <span class="value">0123456789</span>
               </p>
               <div class="geo">
                  <span class="latitude">51.99999</span>
                  ,
                  <span class="longitude">-0.123456</span>
               </div>
               <p class="note">
                  <span class="type">Review</span>
                  <span class="value">Some content</span>
               </p>
               <p class="note">
                  <span class="type">Overall rating</span>
                  <span class="value">8</span>
               </p>
            </div>
         </div>
      </content>
      <category term="cuisine-54" label="Spanish" />
      <Point xmlns="http://www.w3.org/2003/01/geo/wgs84_pos#">
         <lat>51.123456789</lat>
         <long>-0.11111111</long>
      </Point>
   </entry>
</feed> 
```

这是 XSLT

```
<?xml version="1.0" encoding="UTF-8" ?>

<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:wgs="http://www.w3.org/2003/01/geo/wgs84_pos#" exclude-result-prefixes="atom wgs">
  <xsl:output method="xml" indent="yes"/>

  <xsl:key name="uniqueVenuesKey" match="entry" use="id"/>
  <xsl:key name="uniqueCategoriesKey" match="entry" use="category/@term"/>

  <xsl:template match="/">
    <locations>
      <!-- Get all unique venues -->
      <xsl:for-each select="/*[local-name()='feed']/*[local-name()='entry']">
        <xsl:variable name="CurrentVenueKey" select="*[local-name()='id']" ></xsl:variable>
        <xsl:variable name="CurrentVenueName" select="*[local-name()='title']" ></xsl:variable>
        <xsl:variable name="CurrentVenueAddress1" select="*[local-name()='content']/*[local-name()='div']/*[local-name()='div']/*[local-name()='p'][@class='adr']/*[local-name()='span'][@class='street-address']" ></xsl:variable>
        <xsl:variable name="CurrentVenueCity" select="*[local-name()='content']/*[local-name()='div']/*[local-name()='div']/*[local-name()='p'][@class='adr']/*[local-name()='span'][@class='locality']" ></xsl:variable>
        <xsl:variable name="CurrentVenuePostcode" select="*[local-name()='postcode']" ></xsl:variable>
        <xsl:variable name="CurrentVenueTelephone" select="*[local-name()='telephone']" ></xsl:variable>
        <xsl:variable name="CurrentVenueLat" select="*[local-name()='Point']/*[local-name()='lat']" ></xsl:variable>
        <xsl:variable name="CurrentVenueLong" select="*[local-name()='Point']/*[local-name()='long']" ></xsl:variable>
        <xsl:variable name="CurrentCategory" select="WHATDOIPUTHERE"></xsl:variable>

            <location>
              <locationName>
                <xsl:value-of select = "$CurrentVenueName" />
              </locationName>
              <category>
                <xsl:value-of select = "$CurrentCategory" />
              </category>
              <description>
                  <xsl:value-of select = "$CurrentVenueName" />
              </description>
              <venueAddress>
                <streetName>
                  <xsl:value-of select = "$CurrentVenueAddress1" />
                </streetName>
                <town>
                  <xsl:value-of select = "$CurrentVenueCity" />
                </town>
                <postcode>
                  <xsl:value-of select = "$CurrentVenuePostcode" />
                </postcode>
                <wgs84_latitude>
                  <xsl:value-of select = "$CurrentVenueLat" />
                </wgs84_latitude>
                <wgs84_longitude>
                  <xsl:value-of select = "$CurrentVenueLong" />
                </wgs84_longitude>
              </venueAddress>
              <venuePhone>
                <phonenumber>
                  <xsl:value-of select = "$CurrentVenueTelephone" />
                </phonenumber>
              </venuePhone>
          </location>
        </xsl:for-each>
    </locations>
  </xsl:template>
</xsl:stylesheet> 
```

我正在尝试将 $CurrentCategory 变量替换为适当的代码以显示*mycategorytext*

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-16T20:19:29.620

我这里没有 XSLT 编辑器，但你试过用

```
*[local-name()='category']/@*[local-name()='term'] 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T20:30:20.703

根据[http://www.w3.org/TR/2006/REC-xml-names-20060816/#scoping-defaulting](http://www.w3.org/TR/2006/REC-xml-names-20060816/#scoping-defaulting)

“默认命名空间声明不直接应用于属性名称；无前缀属性的解释由它们出现的元素决定。”

这意味着您的属性不在命名空间中。只需使用“@term”。

为了更清楚一点，没有必要使用 local-name() 来解决这个问题。处理它的常规方法是在 XSLT 中为 atom 命名空间声明一个前缀，然后在 xpath 查询中使用它。

您已经在样式表元素上得到了这个声明（xmlns:atom="http://www.w3.org/2005/Atom"），所以剩下的就是使用它。

正如我已经解释过的，该属性不受默认命名空间的影响，因此您的代码将如下所示（假设您要添加“xmlns:xhtml=' [http](http://www.w3.org/1999/xhtml) ://www.w3.org/1999/xhtml ' "):

```
 <xsl:for-each select="/atom:feed/atom:entry">
        <xsl:variable name="CurrentVenueKey" select="atom:id" />
        <xsl:variable name="CurrentVenueName" select="atom:title" />
        <xsl:variable name="CurrentVenueAddress1" 
             select="atom:content/xhtml:div/xhtml:div/xhtml:p[@class='adr']/xhtml:span[@class='street-address']" />
        <xsl:variable name="CurrentVenueCity" 
             select="atom:content/xhtml:div/xhtml:div'/xhtml:p[@class='adr']/xhtml:span[@class='locality'] />
...
        <xsl:variable name="CurrentCategory" select="atom:category/@term" />

..... 
```

如果您真的不知道要转换的 XML 的结构，local-name() 会非常有用，但在这种情况下，如果您收到的不是您所期望的，无论如何它都会中断。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T20:28:47.540

我不太确定你为什么必须使用 local-name()，但如果你分享更多关于你正在使用的 xslt 处理器以及语言的信息，我会想出来的。我说这个 b/c 你应该能够做类似的事情：

```
<xsl:stylesheet xmlns="http://www.w3.org/2005/Atom" ..>

<xsl:template match="feed">
  <xsl:apply-templates />
</xsl:template>

<xsl:template match="entry">
  ... 
  <xsl:variable name="current-category" select="category/@term" />
  ...
</xsl:template> 
```

我希望对您有所帮助的两件事是顶部的 xmlns 声明，没有前缀。这设置了默认命名空间，因此您不必使用命名空间前缀。同样，您可以调用 do 'xmlns:a="http://www.w3.org/2005/Atom"' 然后执行 'select="a:feed"'。要注意的另一件事是使用选择属性的“@term”。如果您想匹配任何属性 '@*' 就像匹配元素一样。

同样，根据处理器的不同，可能还有其他有用的工具可供您使用，因此如果您可以提供更多信息，它可能会有所帮助。此外，[XSL 邮件列表](http://www.mulberrytech.com/xsl/xsl-list/)可能是另一个有用的资源。

# c# - 带有简单 DB 的快速 C# 原型程序

> ID：76206
> 
> 赞同：0
> 
> 时间：2008-09-16T19:49:52.283
> 
> 标签：c#, database, prototype

好的，我以前见过但没有用 C# 编程过。您可以假设我精通 C++，并且精通 C（这对我有什么好处）。我了解继承、多态性等，所以 OO 概念不会成为一个大问题。

假设我被分配了一个任务来制作一个快速而肮脏的程序的原型，该程序与我在短时间内在访问中可以做的没有太大区别。

*   它将有一个包含 5-6 个表的数据库（大部分很小，少数有几千行但只有 4 个左右的列等）
*   我需要从其中一个数据库动态生成表单
*   表单的结果将存储在另一个表中
*   数据库不是多用户

基本上你运行的工厂访问应用程序......除非没有访问权限。我确信我可以糊弄过去并创建非常糟糕的代码，但我同样确信这里的很多人可以推动我朝着正确的方向前进（教程、向导、信息、差异和从 C/C++ 转移的杀手）到 C# 等）。

除了 mdb 之外，我是否可以插入一个简单的数据库来开始使用，或者这是这个特定钉子的最佳选择？我的目标是快速且无依赖的安装。

谢谢！

-亚当

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T19:53:31.383

听起来对于这个应用程序，您可以使用[Microsoft Dynamic Data](http://www.asp.net/dynamicdata/)或[Castle Active Record](http://www.castleproject.org/activerecord/index.html)，并在完成数据库后几分钟让应用程序运行。这些工具连接到数据库并生成用于输入数据的表单。看看他们。

Access 可能是您最好的数据库选择。MS Sql 2005/2008 Express 也可以正常工作，但这需要安装。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T19:53:52.943

如果您使用 C# 进行编程，Visual Studio 附带 SQL Server Express 的附加安装。如果你想快速搞定一些东西，那么在构建你的应用程序时利用该数据库非常容易。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-09-23T12:55:22.947

如果并发*不是*问题，那么我会说使用 SQLite。可以在此处找到 ADO.NET 提供程序：http: [//sourceforge.net/projects/sqlite-dotnet2/files](http://sourceforge.net/projects/sqlite-dotnet2/files)。至于并发问题，当执行一堆插入时，该操作需要包含在事务中。但是，该事务会在数据库上放置一个排他锁，直到事务被提交或回滚。至少这是我的经验，但我自己只使用了一两个星期。

希望有帮助！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T19:52:40.387

如果您已经安装了 MS Access，那么是的，mdb 可能是您最快的入门方式。

此外，您还想从快速 ADO.NET 教程开始。有数百个（几乎有数百个，我没有数过）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T19:53:35.923

使用 SQLlite 而不是访问 db 怎么样？我从未使用过它，但听说它适用于一些轻量级和快速的数据库任务。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-16T20:21:29.210

SqlExpress 将是您最好的选择，因为您已经在 System.Data.SqlClient 中获得了所需的所有支持。除此之外，MSDN 上有一些不错的帮助。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-17T09:18:35.613

[SQLite](http://sqlite.phxsoftware.com/)正是您所追求的。它是一个用于访问基于文件的关系数据库的 C 库。引用的站点具有完整的 Visual Studio 支持 (System.Data.SQLite)。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-17T09:21:39.477

我建议使用[SubSonic](http://subsonicproject.com/)生成您的数据访问代码并搭建您的屏幕。

# .net - 使用 Linq to SQL 时为 SQL 查询计时的好方法

> ID：76208
> 
> 赞同：6
> 
> 时间：2008-09-16T19:50:06.557
> 
> 标签：.net, linq, linq-to-sql, optimization, logging

使用 Linq to SQL 时，有没有一种很好的方法来计时 SQL 查询？我真的很喜欢日志记录功能，但如果你能以某种方式也可以为该查询计时，那就太好了。有任何想法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-17T03:29:17.263

正如两个人已经说过的，SQL Profiler 是开箱即用的工具。我不想成为回应，但我想更详细地阐述：它不仅提供来自 SQL Server 的实际时间（而不是来自网络 i/o、连接和连接的应用程序端的时间）池计时被添加到蛋糕中），但它也为您提供 [通常更重要的] I/O 统计数据、锁定信息（根据需要）等。

I/O 统计数据之所以重要，是因为一个非常昂贵的查询可能会在消耗过多服务器资源的同时快速运行。例如，如果执行的查询经常命中大型表并且没有匹配的索引导致表扫描，则受影响的表将由 SQL Server 缓存在内存中（如果可以的话）。这有时会导致相同的查询以极快的速度执行，而实际上它通过消耗服务器资源来损害系统/应用程序/数据库的其余部分。

锁定信息几乎同样重要 -> 由于锁定和阻塞，对单个记录进行 PK 查找的微小查询可能会出现错误的计时。我在某处读到，这个网站在其早期的测试阶段就被死锁所困扰。SQL Profiler 也是您识别和解决由锁定引起的问题的朋友。

总结一下；无论您使用 L2S、EF 还是普通 ADO - 如果您想确保您的应用程序对数据库“表现良好”，在开发和测试期间始终准备好 SQL Profiler。它有回报！

**编辑：**自从我写了上面的答案以来，我已经为 L2S 开发了一个新的运行时分析工具，它将两个世界的精华结合在一起；来自 SQL Server 的 I/O 统计信息和服务器端计时、SQL Server 执行计划、SQL Server 的“缺失索引”警报，结合托管调用堆栈，以便轻松查找生成某个查询的代码，以及一些高级筛选选项仅记录满足特定条件的查询。此外，日志组件可以与应用程序一起分发，以便更轻松地在实时客户环境中进行运行时查询分析。该工具可以从以下位置下载：

[http://www.huagati.com/L2SProfiler/](http://www.huagati.com/L2SProfiler/)在这里您还可以获得免费的 45 天试用许可证。

此处还发布了更长的背景描述和工具介绍：http:
[//huagati.blogspot.com/2009/06/profiling-linq-to-sql-applications.html](http://huagati.blogspot.com/2009/06/profiling-linq-to-sql-applications.html)

...以及使用一些更高级的过滤器选项的示例/演练可在此处获得：http:
[//huagati.blogspot.com/2009/08/walkthrough-of-newest-filters-and.html](http://huagati.blogspot.com/2009/08/walkthrough-of-newest-filters-and.html)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-17T03:33:17.863

SQL Profiler 获取查询和时间，以及查询分析器中的执行路径以查看瓶颈在哪里。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T19:56:05.793

您可以使用`System.Diagnostics.Stopwatch`它来跟踪查询执行的时间。请记住，在您枚举它们之前，不会执行 Linq->SQL 查询。另请注意，如果您正在登录，`Console.Out`则会对性能造成重大影响。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T19:33:28.323

您可以做的是向 DataContext.Log 添加一个自定义 TextWriter 实现，它将生成的 sql 写入文件或内存。然后遍历这些查询，使用原始 ADO.NET 代码执行它们，并用秒表包围每个查询。

I've used a similar technique before because it seemed whenever I was developing some code I never had Profiler open, and it was really easy to output those results to a HTML page. Sure your executing them twice per website request, but its helpful to see execution times asap instead of waiting until you catch something in Profiler.

Also if your going to the SQL Tool route I would recommend googling "slowest query DMV" and getting a stored procedure that can give you stats on the slowest queries in your db. Its not always easy to scroll through profiler results to find the bad queries. Also with the right queries over sql 2005's dmv you can also do ordering by lets say cpu vs. time and so forth.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T19:53:27.967

我们使用 SQL Profiler 通过 LLBLGen Pro 测试我们的查询。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T19:59:56.923

最好的办法是将查询记录到文件中，然后他们使用 SQL Profiler 对其进行计时并调整查询的索引。

# security - 生产、测试 、开发环境与安全

> ID：76210
> 
> 赞同：3
> 
> 时间：2008-09-16T19:50:20.033
> 
> 标签：security

使开发人员能够构建包含私有数据的系统的当前做法是什么？谁能指出这类事情的“最佳实践”指南？

我们这里有一个 Catch-22，因为开发人员需要编写应用程序来对抗具有被认为是“私有”数据的系统。IT 管理部门希望我们的开发人员无法访问数据（即提供模式或数据结构，但不提供数据本身），而大多数开发人员（包括我自己）希望能够访问生产数据，因为没有有代表性的数据集可能会导致错误的假设（例如数据格式）和以后的错误。

有没有人对这类事情有任何正式的“最佳实践”？特别是来自一些“BigCo”（例如微软、IBM）的官方公会可能会有所帮助，因为它需要说服管理层。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-16T20:04:21.593

我的世界观可能不同，因为我在英国，但在过去的 20 多年里，我主要在公共部门工作，负责处理敏感数据的系统。这些规则是**完全**的。开发区不允许使用生产数据。

作为一项基本原则，我们不想为敏感数据的丢失负责。用户自己非常擅长这一点。

在过去的 12 个月里，我的妻子已经从同一个政权转移到私营部门的一个政权，他们允许开发人员访问生产数据，她对此感到震惊。法律影响（至少在英国）可能很严重。

开发人员不需要**访问生产数据。简直是懒惰。定义和创建测试数据以执行定义的测试用例（包括边缘用例），不要依赖生产数据的随机性。

如果您**必须**使用生产数据（即您设法说服不了解的人相信它是可以接受的），请确保数据在**到达开发区之前**匿名。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-16T19:53:20.963

通常，将提供代表私有数据但不代表私有数据本身的净化数据子集。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T19:57:24.667

在我的公司，我们开始使用[Red-gate](http://www.red-gate.com/products/sql_data_generator/index.htm)的数据生成器来生成测试数据。有一些设置，但您可以使用这些工具生成非常有用的测试数据。是的，我更喜欢使用实时生产数据，但这是不可行的（特别是如果您需要在 HIPAA 中考虑）。它对每一列使用正则表达式，并允许您使用查找表来查找相关表。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T19:55:30.863

在 MediumCo，我们从测试和开发中的生产数据中剥离专有数据。过去，没有完全具有代表性的数据对我们造成了一些伤害，但客户之前曾询问过这一点，这通常不是问题，因为环境中填充了大量虚假的专有数据。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T19:57:32.233

我没有任何最佳实践论文或任何东西。但我认为，如果您是在一个与在生产中托管数据的环境*一样受保护*的环境中开发的，那么就不会有很多反对它的论据。

也就是说，如果您的生产数据库位于由您的 IT 人员托管、控制和保护的数据中心中，如果您的开发数据库位于完全相同的场景中并且不提供任何新的信息访问方式 - 您将状态很好。作为善意的附加标志 - 允许任何担心安全性的人有机会进行某种渗透测试以确保您说出有关安全性的真相可能会很好。

当然，另一方面是分析不使用数据的成本：也就是说，它会导致错误的代码，这将花费 $xxxxxx.xx 的开发时间，而几乎没有成本允许一个小的您的开发团队的子集访问所述数据。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T20:03:27.320

为了避免手动清理/匿名数据的需要，您可以使用随机文本替换 - 用随机字母数字替换每个文本字段中的每个字母数字字符。这个：

*   从开发人员的角度来看，使数据在长度、大小等方面保持相似
*   不会导致字符集问题
*   保留日期和数字字段不变，从而可以对日期范围和数量进行准确测试
*   将满足大多数隐私要求

如果您想更进一步，您可以在电话号码和邮政编码上运行随机数字替换，同时在其他文本字段上使用字母数字替换。

拥有自动替换脚本可以让您定期从实时系统中获取最新的数据转储，因此您的测试在实际数据的大小和可变性方面是最新的。

这确实意味着少量操作将是不现实的（例如，对名称字段进行索引，在现实生活中，这些操作是围绕常见字母聚集的），但这些应该是有限的。

# windows-mobile - Windows Mobile 6 J2SE 规模的 JVM 实现

> ID：76214
> 
> 赞同：2
> 
> 时间：2008-09-16T19:50:35.510
> 
> 标签：windows-mobile, java-me, java

有没有人有过适用于 Windows Mobile 6 的像样的 J2SE（最好至少是 Java JDK 1.5 级别）Java 虚拟机的经验？如果您知道任何 CLDC VM，我也很感兴趣，因为即使这样也会比我们[目前](http://www.nsicom.com/Default.aspx?tabid=138)为该平台所拥有的更好。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-16T23:13:07.473

是的，我尝试过在 Windows Mobile 上使用 Java。我真的很努力。我能给你的最好建议是：立即停止，开始使用 .NET Compact Framework。

无论如何，用于 WM 的两个“好”JVM 是[IBM-J9](http://www-01.ibm.com/software/wireless/weme/)和 NSICom Creme，它们仍然很难使用。您已经看过 Creme - IBM-J9 也好不到哪里去。它们速度慢、笨拙、看起来不是原生的并且难以为最终用户安装。也永远不要考虑做一些奇特的事情，比如拨打电话号码，甚至启动另一个应用程序。如果你真的想尝试，这里有 J9 的评估[版](http://www-128.ibm.com/developerworks/websphere/zones/wireless/weme_eval_runtimes.html?S_CMP=rnav)。（与完整版相同）。

我不反对 Java，但在 Windows Mobile 上，我建议省去麻烦并使用 C#。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T20:02:22.627

老实说，我搜索了一段时间，并没有适用于 windows mobile 的像样的 JVM。我认为最好的选择是：[http](http://www2s.biglobe.ne.jp/~dat/java/project/jvm/index_en.html) ://www2s.biglobe.ne.jp/~dat/java/project/jvm/index_en.html但我上次检查时它符合 JDK 1.3。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T13:21:10.260

您还可以查看[Skelmir 的 CEEJ](http://www.skelmir.com/solutions/handheld.html)。我使用它已经有好几年了，但即便如此，我仍然对它们的代码覆盖率，尤其是性能印象深刻。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-15T12:11:20.837

请检查以下内容，这是适用于 WM5/WM6 的 J2SE 兼容 JVM：

[http://www2s.biglobe.ne.jp/~dat/java/project/jvm/index_en.html](http://www2s.biglobe.ne.jp/~dat/java/project/jvm/index_en.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-08-11T18:57:31.447

试试 CEEJ 虚拟机。它是非常低占用空间的 Java vm，针对嵌入式系统进行了优化。快速和原生的编译器和解释器。

# java - 有哪些（好的）Java RADIUS 服务器库？

> ID：76217
> 
> 赞同：10
> 
> 时间：2008-09-16T19:50:58.020
> 
> 标签：java, hammer

到目前为止，我只能找到两个，即[TinyRadius](http://tinyradius.sourceforge.net/)，它本身不鼓励生产使用和[AXL](http://www.axlradius.com/)，它是付费的。

[JRadius](http://coova.org/wiki/index.php/JRadius)似乎与[FreeRADIUS](http://freeradius.org/)相关联，它不是一个库，需要大量的哄骗才能像一个库一样运行。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-17T06:27:45.383

来自[http://freeradius.org/related/opensource.html](http://freeradius.org/related/opensource.html)的列表（不复制描述，因为页面说它是版权*rolleyes*）：

顺斯龙 - [http://www.radius.cistron.nl/](http://www.radius.cistron.nl/)

GNU 半径 - [http://www.gnu.org/software/radius/](http://www.gnu.org/software/radius/)

FreeRADIUS - [http://freeradius.org/](http://freeradius.org/)

JRadius - [http://www.coova.org/JRadius](http://www.coova.org/JRadius)

ICRADIUS - [http://www.icradius.org/](http://www.icradius.org/)

OpenRADIUS - [http://www.openradius.net/](http://www.openradius.net/)

XtRADIUS - [http://xtradius.sourceforge.net/](http://xtradius.sourceforge.net/)

码半径 - [http://sourceforge.net/projects/yardradius](http://sourceforge.net/projects/yardradius)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-02T10:09:10.637

OK, it seems a pure JAVA open-source RADIUS server simply does not exist.

For completeness, I think I'm going to try one of the Python implementations through Jython to get it running in Java and start replacing pieces as and when needed.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-10-06T07:15:34.610

Apache Directory 项目 ( [http://directory.apache.org](http://directory.apache.org) ) 正在研究这个问题，因为人们打算捐赠一些 java 代码。如果成功结束，我们（Directory 社区）很可能会启动一个子项目并建立一个社区，以将此代码进一步发展为一个成熟的基于 Java 的 Open Source Radius 服务器。

# java - 用 Java 获取每月的最后一个星期五

> ID：76223
> 
> 赞同：18
> 
> 时间：2008-09-16T19:51:21.843
> 
> 标签：java, date, calendar

我正在做一个项目，要求将日期计算为给定月份的最后一个星期五。我想我有一个只使用标准 Java 的解决方案，但我想知道是否有人知道更简洁或更高效的方法。以下是我今年测试的内容：

```
 for (int month = 0; month < 13; month++) {
        GregorianCalendar d = new GregorianCalendar();
        d.set(d.MONTH, month);
        System.out.println("Last Week of Month in " + d.getDisplayName(d.MONTH, Calendar.LONG, Locale.ENGLISH) + ": " + d.getLeastMaximum(d.WEEK_OF_MONTH));
        d.set(d.DAY_OF_WEEK, d.FRIDAY);
        d.set(d.WEEK_OF_MONTH, d.getActualMaximum(d.WEEK_OF_MONTH));
        while (d.get(d.MONTH) > month || d.get(d.MONTH) < month) {
            d.add(d.WEEK_OF_MONTH, -1);
        }
        Date dt = d.getTime();
        System.out.println("Last Friday of Last Week in  " + d.getDisplayName(d.MONTH, Calendar.LONG, Locale.ENGLISH) + ": " + dt.toString());
    } 
```

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2010-03-30T13:49:33.870

让 Calendar.class 为您施展魔法；）

```
pCal.set(GregorianCalendar.DAY_OF_WEEK,Calendar.FRIDAY);
pCal.set(GregorianCalendar.DAY_OF_WEEK_IN_MONTH, -1); 
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-09-16T21:04:14.677

根据[marked23的](https://stackoverflow.com/questions/76223/get-last-friday-of-month-in-java#76437)建议：

```
public Date getLastFriday( int month, int year ) {
   Calendar cal = Calendar.getInstance();
   cal.set( year, month + 1, 1 );
   cal.add( Calendar.DAY_OF_MONTH, -( cal.get( Calendar.DAY_OF_WEEK ) % 7 + 1 ) );
   return cal.getTime();
} 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2015-11-23T09:51:28.530

# java.time

使用Java 8 及更高版本中内置的[java.time](http://docs.oracle.com/javase/8/docs/api/java/time/package-summary.html)[`TemporalAdjusters.lastInMonth`](https://docs.oracle.com/javase/8/docs/api/java/time/temporal/TemporalAdjusters.html#lastInMonth-java.time.DayOfWeek-)库，您可以使用：

```
val now = LocalDate.now() 
val lastInMonth = now.with(TemporalAdjusters.lastInMonth(DayOfWeek.FRIDAY)) 
```

您可以从[`DayOfWeek`](http://docs.oracle.com/javase/8/docs/api/java/time/DayOfWeek.html)枚举中选择任何一天。

如果您需要添加时间信息，您可以使用任何可[`LocalDate`](http://docs.oracle.com/javase/8/docs/api/java/time/LocalDate.html)用于[`LocalDateTime`](http://docs.oracle.com/javase/8/docs/api/java/time/LocalDateTime.html)转换的信息，例如

```
lastFriday.atStartOfDay() // e.g. 2015-11-27T00:00 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-16T20:14:17.137

你永远不需要循环来找出这个。要确定本月的“最后一个星期五”日期，请从下个月的第一天开始。根据该月的第一天所在的星期几（数字）减去适当的天数。这是你的“上周五”。我很确定它可以归结为一个较长的单行，但我不是 Java 开发人员。所以我会把它留给别人。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-16T20:13:47.513

我会使用像[Jodatime](http://joda-time.sourceforge.net)这样的库。它有一个非常有用的 API，它使用正常的月份数字。最重要的是，它是线程安全的。

我认为你可以有一个解决方案（但可能不是最短的，但肯定更具可读性）：

```
DateTime now = new DateTime();      
DateTime dt = now.dayOfMonth().withMaximumValue().withDayOfWeek(DateTimeConstants.FRIDAY);
if (dt.getMonthOfYear() != now.getMonthOfYear()) {
  dt = dt.minusDays(7);
}       
System.out.println(dt); 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-16T20:36:58.037

您需要知道两件事 - 该月的天数，以及该月的第一天所在的工作日。

如果该月的第一天是

*   星期天，那么最后一个星期五*总是*27 号。
*   星期一，然后最后一个星期五*总是*26 号。
*   星期二，然后最后一个星期五*总是*25 号。
*   星期三，那么最后一个星期五就是 24 号，除非这个月有 31 天，那么就是 31 号
*   星期四，那么最后一个星期五就是 23 号，除非这个月有 30 天或更多天，否则就是 30 号。
*   星期五，那么最后一个星期五就是 22 号，除非这个月有 29 天或更多，那么就是 29 号。
*   星期六，那么最后一个星期五*总是*28 号。

只有三种特殊情况。一个 switch 语句和三个 if 语句（或三元运算符，如果您希望每个案例都有一行......）

把它写在纸上。不需要任何特殊的库、函数、朱利安转换等（好吧，除了获得第一个工作日的工作日，也许是那个月的天数......）

[Aaron 用 Ja​​va 实现了它。](https://stackoverflow.com/questions/76223/get-last-friday-of-month-in-java#77315)

-亚当

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-16T21:27:28.007

[亚当戴维斯算法的](https://stackoverflow.com/questions/76223/get-last-friday-of-month-in-java#76744)代码

```
public static int getLastFriday(int month, int year)
{
Calendar cal = Calendar.getInstance();
cal.set(year, month, 1, 0, 0, 0); // set to first day of the month
cal.set(Calendar.MILLISECOND, 0);

int firstDay = cal.get(Calendar.DAY_OF_WEEK);
int daysOfMonth = cal.getMaximum(Calendar.DAY_OF_MONTH);

switch (firstDay)
{
    case Calendar.SUNDAY :
        return 27;
    case Calendar.MONDAY :
        return 26;
    case Calendar.TUESDAY :
        return 25;
    case Calendar.WEDNESDAY :
        if (daysOfMonth == 31) return 31;
        return 24;
    case Calendar.THURSDAY :
        if (daysOfMonth >= 30) return 30;
        return 23;
    case Calendar.FRIDAY :
        if (daysOfMonth >= 29) return 29;
        return 22;
    case Calendar.SATURDAY :
        return 28;
}
throw new RuntimeException("what day of the month?");
}} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-10-18T10:55:03.150

以下是获取本月最后一个星期五或任何工作日的方法：

```
Calendar thisMonth = Calendar.getInstance();
dayOfWeek = Calendar.FRIDAY; // or whatever
thisMonth.set(Calendar.WEEK_OF_MONTH, thisMonth.getActualMaximum(Calendar.WEEK_OF_MONTH);;
thisMonth.set(Calendar.DAY_OF_WEEK, dayOfWeek);
int lastDay = thisMonth.get(Calendar.DAY_OF_MONTH); // this should be it. 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-16T20:09:12.190

更容易阅读的蛮力方法：

```
public int getLastFriday(int month, int year) {
    Calendar cal = Calendar.getInstance();
    cal.set(year, month, 1, 0, 0, 0); // set to first day of the month
    cal.set(Calendar.MILLISECOND, 0);

    int friday = -1;
    while (cal.get(Calendar.MONTH) == month) { 
        if (cal.get(Calendar.DAY_OF_WEEK) == Calendar.FRIDAY) { // is it a friday?
            friday = cal.get(Calendar.DAY_OF_MONTH);
            cal.add(Calendar.DAY_OF_MONTH, 7); // skip 7 days
        } else {
            cal.add(Calendar.DAY_OF_MONTH, 1); // skip 1 day
        }
    }
    return friday;
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-16T20:15:11.723

虽然我同意 scubabbl，但这是一个没有内在时间的版本。

```
int year = 2008;
for (int m = Calendar.JANUARY; m <= Calendar.DECEMBER; m++) {
    Calendar cal = new GregorianCalendar(year, m, 1);
    cal.set(Calendar.DAY_OF_MONTH, cal.getActualMaximum(Calendar.DAY_OF_MONTH));
    int diff = Calendar.FRIDAY - cal.get(Calendar.DAY_OF_WEEK);
    if (diff > 0) {
        diff -= 7;
    }
    cal.add(Calendar.DAY_OF_MONTH, diff);
    System.out.println(cal.getTime());
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-06-06T21:54:44.323

以下节目适用于每个月的最后一个星期五。它可用于获取任何月份中一周中任何一天的最后一天。变量`offset=0`表示当前月份（系统日期），offset=1 表示下个月，依此类推。该`getLastFridayofMonth(int offset)`方法将返回上周五。

```
import java.text.SimpleDateFormat;
import java.util.Calendar;

public class LastFriday {

  public static Calendar getLastFriday(Calendar cal,int offset){
    int dayofweek;//1-Sunday,2-Monday so on....
    cal.set(Calendar.MONTH,cal.get(Calendar.MONTH)+offset);
    cal.set(Calendar.DAY_OF_MONTH, cal.getActualMaximum(Calendar.DAY_OF_MONTH)); //set calendar to last day of month
    dayofweek=cal.get(Calendar.DAY_OF_WEEK); //get the day of the week for last day of month set above,1-sunday,2-monday etc
    if(dayofweek<Calendar.FRIDAY)  //Calendar.FRIDAY will return integer value =5 
      cal.set(Calendar.DAY_OF_MONTH, cal.get(Calendar.DAY_OF_MONTH)-7+Calendar.FRIDAY-dayofweek);
    else
      cal.set(Calendar.DAY_OF_MONTH, cal.get(Calendar.DAY_OF_MONTH)+Calendar.FRIDAY-dayofweek); 

    return cal;
  }

  public static String  getLastFridayofMonth(int offset) { //offset=0 mean current month
    final String DATE_FORMAT_NOW = "dd-MMM-yyyy";
    Calendar cal = Calendar.getInstance();
    SimpleDateFormat sdf = new SimpleDateFormat(DATE_FORMAT_NOW);
    cal=getLastFriday(cal,offset);
    return sdf.format(cal.getTime()); 

  }

  public static void main(String[] args) {
    System.out.println(getLastFridayofMonth(0)); //0 = current month
    System.out.println(getLastFridayofMonth(1));//1=next month
    System.out.println(getLastFridayofMonth(2));//2=month after next month
  }

} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2016-12-06T11:11:36.413

在 Java 8 中，我们可以简单地这样做：

```
LocalDate lastFridayOfMonth = LocalDate
                                    .now()
                                    .with(lastDayOfMonth())
                                    .with(previous(DayOfWeek.FRIDAY)); 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-16T19:56:49.333

这看起来是一个完全可以接受的解决方案。如果可行，请使用它。这是最少的代码，除非您必须这样做，否则没有理由对其进行优化。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-07-01T07:19:00.857

希望这可以帮助..

```
public static void getSundaysInThisMonth(int monthNumber, int yearNumber){
    //int year =2009;
    //int dayOfWeek = Calendar.SUNDAY;
    // instantiate Calender and set to first Sunday of 2009
    Calendar cal = new GregorianCalendar();
    cal.set(Calendar.MONTH, monthNumber-1);
    cal.set(Calendar.YEAR, yearNumber);
    cal.set(Calendar.DATE, 1);
    int dayOfWeek = cal.get(Calendar.DAY_OF_WEEK);
    int dateOfWeek = cal.get(Calendar.DATE);
    while (dayOfWeek  != Calendar.SUNDAY) {
       cal.set(Calendar.DATE, ++dateOfWeek);
       dayOfWeek = cal.get(Calendar.DAY_OF_WEEK);
      }
    cal.set(Calendar.DATE, dateOfWeek);

    int i = 1;
    while (cal.get(Calendar.YEAR) == yearNumber && cal.get(Calendar.MONTH)==monthNumber-1)
    {
            System.out.println("Sunday " + " " + i + ": " + cal.get(Calendar.DAY_OF_MONTH));
            cal.add(Calendar.DAY_OF_MONTH, 7);
            i++;
    }

  }
  public static void main(String args[]){
    getSundaysInThisMonth(1,2009);
  } 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-03-14T06:01:38.780

```
public static int lastSundayDate()
{
    Calendar cal = getCalendarInstance();
    cal.setTime(new Date(getUTCTimeMillis()));
    cal.set( Calendar.DAY_OF_MONTH , 25 );
    return (25 + 8 - (cal.get(Calendar.DAY_OF_WEEK) != Calendar.SUNDAY ? cal.get(Calendar.DAY_OF_WEEK) : 8));
} 
```

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2012-02-27T17:22:59.023

```
public static Calendar getNthDow(int month, int year, int dayOfWeek, int n) {
    Calendar cal = Calendar.getInstance();
    cal.set(year, month, 1);
    cal.set(Calendar.DAY_OF_WEEK, dayOfWeek);
    cal.set(Calendar.DAY_OF_WEEK_IN_MONTH, n);
    return (cal.get(Calendar.MONTH) == month) && (cal.get(Calendar.YEAR) == year) ? cal : null;
} 
```

# language-agnostic - 有哪些游戏具有相当简单的启发式来评估位置？

> ID：76227
> 
> 赞同：13
> 
> 时间：2008-09-16T19:52:25.787
> 
> 标签：language-agnostic, artificial-intelligence, heuristics

我正在教一个孩子编程，目前正在介绍一些基本的人工智能概念。首先，我们将实现一个井字游戏，它搜索整个游戏树并因此完美地进行游戏。一旦我们完成了，我想将相同的概念应用到一个有太多位置来评估每一个位置的游戏，因此我们需要实现一个启发式来评估中间位置。

我能想到的最好的东西是[Dots and Boxes](http://en.wikipedia.org/wiki/Dots-and-boxes)。它的好处是我可以将棋盘大小设置为任意大以阻止他搜索整棵树，并且我可以制作一个非常基本的评分函数，即我的盒子数量减去对手盒子的数量。不幸的是，这意味着在游戏开始的大部分时间里，每个位置都将被等同地评估为 0 分，因为在玩家真正开始制作盒子之前需要相当多的动作。

有人对游戏有更好的想法吗？（或者对点和框有更好的评分功能）？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-16T20:01:34.937

另一种游戏选择可能是[黑白棋](http://en.wikipedia.org/wiki/Reversi)又名奥赛罗。

一个幼稚的启发式方法是简单地计算每个有效移动获得的瓷砖数量并选择最大的。从那里你可以考虑棋盘位置并最小化对手的脆弱性。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-16T20:03:59.923

您可以考虑的一款游戏是[Connect Four](http://en.wikipedia.org/wiki/Connect_Four)。简单的游戏，规则简单，但比井字游戏更复杂。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-16T20:08:56.947

跳棋会让你教几种方法。简单的前瞻，对最佳情况最坏情况决策的深度搜索，短期和长期收益之间的差异，以及他们在学习了你想教给他们的东西后可以继续研究的东西。

我个人认为最后一点是最关键的——人工智能开发中有一些自然的点，可以停下来，看看你能不能打败它，然后深入研究更深层次的人工智能机制。它可以让您的学生保持兴趣而不会感到非常沮丧，并且如果他们想继续该项目，可以让他们自己做更多的事情。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-17T13:57:54.460

[Rubik's Infinity](http://www.boardgamegeek.com/game/10060)很有趣，有点像 Connect Four 但又略有不同。评估职位非常容易。

前段时间我拼凑了一个 Perl 脚本来播放它，实际上不得不减少它看起来前面的移动次数，或者它每次都击败我，通常是用非常令人惊讶的策略。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-16T19:59:24.100

[黑白棋](http://en.wikipedia.org/wiki/Reversi)怎么样？它有一个非常好的启发式空间，基于件数、边缘件数和角件数。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-16T20:08:49.350

[五子棋](http://en.wikipedia.org/wiki/Gomoku)是一款不错的、简单的游戏，而且很有趣，可以为它编写 AI。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-16T20:05:57.783

[曼卡拉](http://en.wikipedia.org/wiki/Mancala)怎么样？每回合只有 6 种可能的移动，并且很容易计算每个移动的结果，但重要的是要考虑对手的反应，并且游戏树会很快变大。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-16T20:04:08.177

[四个连成一条线](http://en.wikipedia.org/wiki/Connect_Four)够难，但也很容易想出一个简单的工作评估函数，例如，（从我最长的线到四个的距离 - 从我的对手最长的线到四个的距离）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-01T13:50:18.860

我真的很喜欢连接四。使用 Minimax 算法非常容易编程。一个好的评估函数可以是：

```
eval_score = 0
for all possible rows/lines/diagonals of length 4 on the board:
    if (#player_pieces = 0) // possible to connect four here?
        if (#computer_pieces = 4)
            eval_score = 10000
            break for loop
        else
            eval_score = eval_score + #computer_pieces
            (less pieces to go -> higher score)
        end if
    else if (#player_pieces = 4)
        eval_score = -10000
        break for loop
    end if
end for 
```

要改进程序，您可以添加：

1.  如果计算机先移动，则在中间列播放（这已被证明是最佳的）
2.  Alpha-Beta 修剪
3.  移动排序
4.  Zobrist 哈希

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-16T20:00:04.863

用已经添加的随机线开始你的点和盒子游戏怎么样。这可以让你快速投入行动。只需要确保你没有用任何盒子开始游戏。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-24T20:29:05.577

关于点和框的更好启发式方法，我建议查看游戏的在线策略指南。Google 上关于“点和框策略”的[第一个结果](http://cf.geocities.com/ilanpi/tutorial1.html)非常有帮助。

知道如何使用链式法则将优秀的玩家与优秀的玩家区分开来。知道什么时候链式法则会对你不利，这是区分最佳玩家和优秀玩家的关键。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-16T20:03:50.737

看看围棋。

*   对于非常小的板上的孩子来说足够简单。
*   复杂性无限扩展。
*   有很多可用的论文、算法和程序可用作量表或基础。

更新：提到了黑白棋，它是 Go 的简化变体。可能是更好的选择。

# java - Access to auto increment identity field after SQL insert in Java

> ID：76254
> 
> 赞同：17
> 
> 时间：2008-09-16T19:55:17.293
> 
> 标签：java, sql

Any advice on how to read auto-incrementing identity field assigned to newly created record from call through `java.sql.Statement.executeUpdate`?

I know how to do this in SQL for several DB platforms, but would like to know what database independent interfaces exist in `java.sql` to do this, and any input on people's experience with this across DB platforms.

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-16T20:04:51.293

The following snibblet of code should do ya':

```
PreparedStatement stmt = conn.prepareStatement(sql, 
                                 Statement.RETURN_GENERATED_KEYS);
// ...

ResultSet res = stmt.getGeneratedKeys();
while (res.next())
    System.out.println("Generated key: " + res.getInt(1)); 
```

This is known to work on the following databases

*   Derby
*   MySQL
*   SQL Server

For databases where it doesn't work (HSQLDB, Oracle, PostgreSQL, etc), you will need to futz with database-specific tricks. For example, on PostgreSQL you would make a call to `SELECT NEXTVAL(...)` for the sequence in question.

Note that the parameters for `executeUpdate(...)` are analogous.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-16T20:08:40.333

```
ResultSet keys = statement.getGeneratedKeys(); 
```

Later, just iterate over ResultSet.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T19:59:27.937

I've always had to make a second call using query after the insert.

You could use an ORM like hibernate. I think it does this stuff for you.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T20:08:18.680

@ScArcher2 : I agree, Hibernate needs to make a second call to get the newly generated identity UNLESS an advanced generator strategy is used (sequence, hilo...)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T20:15:46.090

@ScArcher2

Making a second call is *extremely* dangerous. The process of `INSERT`ing and selecting the resultant auto-generated keys must be atomic, otherwise you may receive inconsistent results on the key select. Consider two asynchronous `INSERT`s where they both complete before either has a chance to select the generated keys. Which process gets which list of keys? Most cross-database ORMs have to do annoying things like in-process thread locking in order to keep results deterministic. This is *not* something you want to do by hand, especially if you are using a database which does support atomic generated key retrieval (HSQLDB is the only one I know of which does not).

# asp.net - 跨服务器的 IIS 身份验证

> ID：76258
> 
> 赞同：0
> 
> 时间：2008-09-16T19:55:34.610
> 
> 标签：asp.net, .net-2.0, iis-6, single-sign-on, .net-1.1

我的生产环境涉及一对 IIS 6 Web 服务器，一个运行旧的 .NET 1.1 应用程序，另一个运行 .NET 2.0 应用程序。我们不能在同一台机器上安装 .NET 2.0 和 1.1，因为它是一个受到严格监管的“验证系统”，重新验证会带来官僚主义的噩梦。

两台服务器上的网站都对 Active Directory 用户帐户使用基本身份验证。

1.1 服务器上的 Web 应用程序是否可以安全地将用户重定向到 2.0 服务器上提供的页面，而无需用户重新进行身份验证？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T20:03:19.287

不，因为在那种情况下您没有使用 cookie 进行身份验证，所以 ScaleOvenStove 的链接无济于事。

基本身份验证在每个请求的 HTTP 标头中发送登录信息，但是当浏览器看到新服务器和新密码请求时，它会执行此操作。

（或者确实按照建议更改两个系统上的身份验证以支持单点登录）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T20:02:44.437

为了实现这一点，您可以实施单点登录解决方案。

此解决方案将有一台服务器作为您的主身份验证服务器。该服务器将负责身份验证并为用户创建 cookie。当您重定向到其他服务器（在同一域上）时，请检查是否存在由身份验证服务器创建的身份验证 cookie，如果存在并且具有有效数据，则自动登录用户。确保您在表单身份验证票和 cookie 上设置域，然后存在于同一域中的两个服务器将能够访问此 cookie。

我会在 asp.net 上谷歌单点登录。有很多方法可以实现它，但它绝对是可以实现的。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-09-16T19:59:01.900

是的，看看这里

[http://weblogs.asp.net/scottgu/archive/2005/12/10/432851.aspx](http://weblogs.asp.net/scottgu/archive/2005/12/10/432851.aspx)

# sms - 在使用 GSM 调制解调器处理 SMS 时，您如何处理未经请求的响应（如来电/短信）？

> ID：76268
> 
> 赞同：1
> 
> 时间：2008-09-16T19:57:03.123
> 
> 标签：sms, response, gsm, modem

我试图开发一个 GSM 调制解调器库来处理围绕`system.io.ports.serialport`.

它不能很好地处理不请自来的响应，尤其是来电。

我已经为每个来电发送 AT 挂断命令，但是即使在您执行其他任务时，仍然会弹出未经请求的响应。

这使得正确处理非常困难。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-21T12:48:20.377

您可能需要一个单独的线程来充当会话处理程序，并带有一个面向应用程序其余部分的消息队列接口。它应该等待来自您的应用程序（以启动会话）或调制解调器（来电）的输入。当它拒绝来电时，来自应用程序的会话启动请求可以等待。

# cil - 是否可以在堆栈上间接加载值类型

> ID：76274
> 
> 赞同：7
> 
> 时间：2008-09-16T19:57:58.800
> 
> 标签：cil, reflection.emit

在 Microsoft IL 中，要调用值类型的方法，您需要间接引用。假设我们有一个名为“il”的 ILGenerator，并且当前我们在堆栈顶部有一个 Nullable，如果我们想检查它是否有值，那么我们可以发出以下内容：

```
var local = il.DeclareLocal(typeof(Nullable<int>));
il.Emit(OpCodes.Stloc, local);
il.Emit(OpCodes.Ldloca, local);
var method = typeof(Nullable<int>).GetMethod("get_HasValue");
il.EmitCall(OpCodes.Call, method, null); 
```

但是，最好跳过将其保存为局部变量，而只需在堆栈上已经存在的变量地址上调用该方法，例如：

```
il.Emit(/* not sure */);
var method = typeof(Nullable<int>).GetMethod("get_HasValue");
il.EmitCall(OpCodes.Call, method, null); 
```

ldind 指令系列看起来很有希望（尤其是 ldind_ref），但我找不到足够的文档来知道这是否会导致值的装箱，我怀疑它可能会。

我看过 C# 编译器的输出，但它使用局部变量来实现这一点，这让我相信第一种方法可能是唯一的方法。有人有更好的想法吗？

****编辑：附加说明****

尝试直接调用该方法，如以下程序中注释掉的行，不起作用（错误将是“操作可能破坏运行时”）。取消注释这些行，您会看到它确实按预期工作，返回“True”。

```
var m = new DynamicMethod("M", typeof(bool), Type.EmptyTypes);
var il = m.GetILGenerator();
var ctor = typeof(Nullable<int>).GetConstructor(new[] { typeof(int) });
il.Emit(OpCodes.Ldc_I4_6);
il.Emit(OpCodes.Newobj, ctor);
//var local = il.DeclareLocal(typeof(Nullable<int>));
//il.Emit(OpCodes.Stloc, local);
//il.Emit(OpCodes.Ldloca, local);
var getValue = typeof(Nullable<int>).GetMethod("get_HasValue");
il.Emit(OpCodes.Call, getValue);
il.Emit(OpCodes.Ret);
Console.WriteLine(m.Invoke(null, null)); 
```

因此，您不能简单地使用堆栈上的值调用方法，因为它是值类型（尽管如果它是引用类型，则可以）。

我想要实现（或知道是否可能）是替换显示注释掉的三行，但保持程序正常工作，而不使用临时本地。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T20:02:13.673

如果变量已经在堆栈上，您可以继续并发出方法调用。

似乎构造函数没有以类型化的形式将变量压入堆栈。在深入研究 IL 之后，似乎有两种方法可以在构造变量后使用它。

您可以在调用构造函数之前加载将存储引用到评估堆栈的变量，然后在调用构造函数之后再次加载该变量，如下所示：

```
DynamicMethod method = new DynamicMethod("M", typeof(bool), Type.EmptyTypes);
ILGenerator il = method.GetILGenerator();
Type nullable = typeof(Nullable<int>);
ConstructorInfo ctor = nullable.GetConstructor(new Type[] { typeof(int) });
MethodInfo getValue = nullable.GetProperty("HasValue").GetGetMethod();
LocalBuilder value = il.DeclareLocal(nullable);         

// load the variable to assign the value from the ctor to
il.Emit(OpCodes.Ldloca_S, value);
// load constructor args
il.Emit(OpCodes.Ldc_I4_6);
il.Emit(OpCodes.Call, ctor);
il.Emit(OpCodes.Ldloca_S, value);

il.Emit(OpCodes.Call, getValue);
il.Emit(OpCodes.Ret);
Console.WriteLine(method.Invoke(null, null)); 
```

另一种选择是按照您展示的方式进行操作。我能看到的唯一原因是 ctor 方法返回 void，因此它们不会像其他方法一样将它们的值放在堆栈上。如果新对象不在堆栈上，您可以调用 Setloc 似乎很奇怪。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2016-03-18T05:08:36.207

我想到了！幸运的是，我正在阅读有关`unbox`操作码的信息，并注意到它会推送值的**地址**。`unbox.any`推动实际值。因此，为了在值类型上调用方法而不必将其存储在局部变量中然后加载其地址，您可以简单地`box`后跟`unbox`. 使用你的最后一个例子：

```
var m = new DynamicMethod("M", typeof(bool), Type.EmptyTypes);
var il = m.GetILGenerator();
var ctor = typeof(Nullable<int>).GetConstructor(new[] { typeof(int) });
il.Emit(OpCodes.Ldc_I4_6);
il.Emit(OpCodes.Newobj, ctor);
il.Emit(OpCodes.Box, typeof(Nullable<int>)); // box followed by unbox
il.Emit(OpCodes.Unbox, typeof(Nullable<int>));
var getValue = typeof(Nullable<int>).GetMethod("get_HasValue");
il.Emit(OpCodes.Call, getValue);
il.Emit(OpCodes.Ret);
Console.WriteLine(m.Invoke(null, null)); 
```

这样做的缺点是装箱会导致为装箱对象分配内存，因此它比使用局部变量（已经分配）要慢一些。但是，它使您不必确定、声明和引用您需要的所有局部变量。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-18T07:10:03.560

在对选项进行了更多和进一步的考虑之后，我认为您认为它无法完成是正确的。如果您检查 MSIL 指令的堆栈行为，您会发现没有任何操作将其操作数留在堆栈上。由于这将是“获取堆栈条目地址”操作的要求，因此我相当有信心不存在。

剩下的就是 dup+box 或 stloc+ldloca。正如您所指出的，后者可能更有效。

@greg：许多指令将其*结果*留在堆栈上，但没有指令将其任何*操作数*留在堆栈上，这是“获取堆栈元素地址”指令所必需的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-06-04T15:06:08.773

刚刚编写了一个执行 OP 要求的类...这是 C# 编译器生成的 IL 代码：

```
 IL_0008:  ldarg.0
  IL_0009:  ldarg.1
  IL_000a:  newobj     instance void valuetype [mscorlib]System.Nullable`1<int32>::.ctor(!0)
  IL_000f:  stfld      valuetype [mscorlib]System.Nullable`1<int32> ConsoleApplication3.Temptress::_X
  IL_0014:  nop
  IL_0015:  ret 
```

# vbscript - 如何使用 VBScript 终止由特定用户启动的进程

> ID：76275
> 
> 赞同：5
> 
> 时间：2008-09-16T19:58:05.320
> 
> 标签：vbscript, windows-server-2003, kill

我有多个用户在 Windows 2003 服务器上运行 attachemate。我想杀死 user_1 启动的 attachemate.exe 而不杀死 user_2 启动的 attachemate.exe。

我想使用 VBScript。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-18T02:11:13.230

您可以使用它来找出进程所有者是谁，然后一旦有了，您就可以使用 Win32_Process 通过进程 ID 终止进程。

[MSDN Win32_Process 类详细信息](http://msdn.microsoft.com/en-us/library/aa394372.aspx)

[MSDN 使用 Win32_Process 终止进程](http://msdn.microsoft.com/en-us/library/aa393907(VS.85).aspx)

肯定有一种更清洁的方法可以做到这一点，但这就是我想出的。注意：这当然不处理同名的多个进程，但我认为您可以使用数组来处理该部分以保存它们或类似的东西。:)

```
strComputer = "."
strOwner = "A111111"
strProcess = "'notepad.exe'"

' Connect to WMI service and Win32_Process filtering by name'
Set objWMIService = GetObject("winmgmts:{impersonationLevel=impersonate}!\\" _
    & strComputer & "\root\cimv2")
Set colProcessbyName = objWMIService.ExecQuery("Select * from Win32_Process Where Name = " _
    & strProcess)

' Get the process ID for the process started by the user in question'
For Each objProcess in colProcessbyName
    colProperties = objProcess.GetOwner(strUsername,strUserDomain)
    if strUsername = strOwner then
        strProcessID = objProcess.ProcessId
    end if
next

' We have the process ID for the app in question for the user, now we kill it'
Set colProcessList = objWMIService.ExecQuery("Select * from Win32_Process where ProcessId =" & strProcessID)
For Each objProcess in colProcess
    objProcess.Terminate()
Next 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T20:01:21.397

[从http://sysinternals.com/](http://sysinternals.com/)转到 pskill

命令行：pskill -u user_1 attachemate.exe

# java - 找到最小必要的 java 类路径

> ID：76291
> 
> 赞同：8
> 
> 时间：2008-09-16T19:59:25.987
> 
> 标签：java, jar, dependencies

是否有检测不需要的 jar 文件的工具？

例如，假设我有 myapp.jar，我可以使用包含 hibernate.jar、junit.jar 和 easymock.jar 的类路径来启动它。但实际上它只使用 hibernate.jar 就可以正常工作，因为调用 junit.jar 的代码不可访问。

我意识到反射可能会使事情复杂化，但我可以使用忽略反射的工具。除此之外，这似乎是一个相对简单的问题。

如果没有这样的工具，确定需要哪些依赖项的最佳实践是什么？在我看来，这一定是一个普遍的问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T20:03:51.687

这在可能使用反射的系统中是不可能的。

也就是说，如果您不使用任何反射，静态分析工具可以做得很好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T21:00:16.153

你看过 Dependency Finder 吗？

[http://depfind.sourceforge.net/](http://depfind.sourceforge.net/)

该站点上还提供了大多数其他可用 Java 依赖项工具的方便列表。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T21:03:31.293

我用过

[http://code.google.com/p/jarjar/](http://code.google.com/p/jarjar/)

并发现它非常好。

此外，如果你有一套好的单元/验收测试，你会发现你是否轻松地打破了任何反射:)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T21:04:41.883

在 Bill K 的回复中添加一些内容：您可能根本不使用反射，但您正在使用的 JAR 可能会。我记得在 xalan 和 xerces 中遇到过类似的情况，其中在运行时抛出了 ClassNotFoundException。

# java - 从syncExec返回变量的最佳方式是什么？

> ID：76300
> 
> 赞同：2
> 
> 时间：2008-09-16T20:00:16.267
> 
> 标签：java, multithreading, swt

在我的 SWT Java 应用程序中，我经常希望从 Display.syncExec() 调用中返回信息。到目前为止，我发现的最佳方法是：

```
final ArrayList<Integer> result = new ArrayList<Integer>();
GUI.display().syncExec(new Runnable(){ public void run() {
   MessageBox mb = /* ... */;
    /* set up messagebox */
   result.add(mb.open());
}});
if (SWT.OK == result.get(0)) { /* ... */ } 
```

我认为这是允许的，因为 ArrayList 是线程安全的，但是我应该使用更好的容器还是更简单的方法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-16T20:13:55.767

[`ArrayList`不是线程安全的](http://docs.oracle.com/javase/7/docs/api/java/util/ArrayList.html)。您可以`List`使用[`Collections.synchronizedList`](http://docs.oracle.com/javase/7/docs/api/java/util/Collections.html#synchronizedList%28java.util.List%29). `AtomicInteger`但是，在您的情况或`AtomicReference`更一般的情况下使用它要简单得多。

```
final AtomicInteger resultAtomicInteger = new AtomicInteger();
Display.getCurrent().syncExec(new Runnable() { 
    public void run() {
        MessageBox mb = /* ... */;
            /* set up messagebox */
        resultAtomicInteger.set(mb.open());
}});
if (SWT.OK == resultAtomicInteger.get()) { /* ... */ } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-01-20T12:28:41.010

我刚刚解决了这个问题，我的第一次尝试是类似的 - 数组或所需类型项目的列表。但过了一会儿，我编造了这样的东西：

```
abstract class MyRunnable<T> implements Runnable{
    T result;
}
MyRunnable<Integer> runBlock = new MyRunnable<Integer>(){
   MessageBox mb = /* ... */;
    /* set up messagebox */
   result = mb.open();
}
GUI.display().syncExec(runBlock);
runBlock.result; //holds a result Integer 
```

它更整洁并删除了冗余变量。

顺便提一句。我真正的第一次尝试是使用 UIThreadRunnable，但我不想依赖 SWTBot，所以我放弃了这个解决方案。在我发现自己的解决方案后，他们在那里使用了类似的工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T20:09:47.897

ArrayList*不是*线程安全的。从相关的[Javadoc](http://java.sun.com/j2se/1.5.0/docs/api/java/util/ArrayList.html)：

> 请注意，此实现不同步。如果多个线程同时访问一个 ArrayList 实例，并且至少有一个线程在结构上修改了列表，则必须在外部进行同步。

如果您需要 List 的线程安全实现，JDK 中（至少）提供了两个：CopyOnWriteArrayList 和 Vector。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T20:14:43.783

您可以使用 Integer[1] 数组使其更简洁，但我认为它不能直接从匿名内部类内部更新非最终变量。

```
final Integer[] result = new Integer[1]; 
```

我认为您必须将结果声明为最终结果（但该更改不会影响您的代码）。由于当前线程阻塞直到内部线程完成，我认为您不需要担心同步（但您可能需要使变量违反以便看到结果）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-19T11:58:31.913

如果这种情况经常发生，您最好在流程和视图之间使用订阅/通知模型。您的视图订阅了应该触发该消息框的事件，并在满足条件时收到通知。

# java - 如何以人类可读的方式打开 Java .class 文件？

> ID：76314
> 
> 赞同：131
> 
> 时间：2008-09-16T20:01:49.743
> 
> 标签：java, windows, class, applet

我试图弄清楚 Java 小程序的类文件在后台做什么。用记事本或文本板打开它只会显示一堆狼吞虎咽的东西。

有什么办法可以把它重新转换成某种可读的格式，这样我就可以试着弄清楚它在做什么？

*   环境 == 安装了 VS 2008 的 Windows。

* * *

## 回答 #1

> 赞同：220
> 
> 时间：2008-09-16T20:11:27.020

[jd-gui](http://jd.benow.ca/)是目前最好的反编译器。与尘土飞扬的 JAD 相比，它可以处理 Java 中的新功能。

* * *

## 回答 #2

> 赞同：83
> 
> 时间：2008-09-16T20:08:16.357

如果您不介意阅读字节码，javap 应该可以正常工作。它是标准 JDK 安装的一部分。

```
Usage: javap <options> <classes>...

where options include:
   -c                        Disassemble the code
   -classpath <pathlist>     Specify where to find user class files
   -extdirs <dirs>           Override location of installed extensions
   -help                     Print this usage message
   -J<flag>                  Pass <flag> directly to the runtime system
   -l                        Print line number and local variable tables
   -public                   Show only public classes and members
   -protected                Show protected/public classes and members
   -package                  Show package/protected/public classes
                             and members (default)
   -private                  Show all classes and members
   -s                        Print internal type signatures
   -bootclasspath <pathlist> Override location of class files loaded
                             by the bootstrap class loader
   -verbose                  Print stack size, number of locals and args for methods
                             If verifying, print reasons for failure 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2018-02-16T15:51:07.263

正如@MichaelMyers 所指出的，使用

```
javap -c <name of java class file> 
```

获取 JVM 汇编代码。您还可以将输出重定向到文本文件以获得更好的可见性。

```
javap -c <name of java class file> > decompiled.txt 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-16T20:05:14.040

你想要一个java反编译器，你可以使用命令行工具`javap`来做到这一点。此外，[Java Decompiler HOW-TO](http://www.faqs.org/docs/Linux-HOWTO/Java-Decompiler-HOWTO.html)描述了如何反编译类文件。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-16T20:03:26.057

使用[Jad](http://www.javadecompilers.com/jad)反编译它可能是你最好的选择。除非代码被混淆，否则它会产生一个好的结果。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-16T20:05:58.780

你正在寻找的是一个java反编译器。我推荐 JAD [http://www.kpdus.com/jad.html](http://www.kpdus.com/jad.html) 它可以免费用于非商业用途，并且可以完成工作。

注意：这不会使代码与编写的完全相同。即你会丢失注释和可能的变量名，所以它会比仅仅阅读普通的源代码更难一些。如果开发人员真的很神秘，他们也会混淆他们的代码，使其更难阅读。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-23T17:56:50.067

cpuguru，如果你的小程序是用 javac 1.3（或更低）编译的，你最好的选择是使用 Jad。

不幸的是，JAD 1.5.8（2001 年 4 月 14 日）支持的最后一个 JDK 是 JDK 1.3。

如果你的小程序是用更新的编译器编译的，你可以试试[JD-GUI](http://java.decompiler.free.fr)：这个反编译器正在开发中，不过，它大多数时候会为使用 JDK 1.4、1.5 或 1.6 编译的类生成正确的 Java 源代码。

DarenW，谢谢你的帖子。JD-GUI 还不是最好的反编译器……但我正在努力:)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-09-27T10:05:57.617

jd-gui " [http://code.google.com/p/innlab/downloads/detail?name=jd-gui-0.3.3.windows.zip&can=2&q=](http://code.google.com/p/innlab/downloads/detail?name=jd-gui-0.3.3.windows.zip&can=2&q=) " 是反编译 .class 的最佳且用户友好的选项文件....

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2018-02-23T11:50:23.187

您还可以使用可用的在线 java 反编译器。例如[http://www.javadecompilers.com](http://www.javadecompilers.com)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-16T20:03:44.650

那是编译后的代码，你需要使用像 JAD 这样的反编译器：[http ://www.kpdus.com/jad.html](http://www.kpdus.com/jad.html)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-16T20:12:50.683

您需要使用反编译器。其他人建议JAD，还有其他选择，JAD是最好的。

我将回应与原始源代码相比您可能会丢失一点的评论。如果代码使用泛型，由于擦除，它看起来会特别有趣。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-16T20:35:47.617

当然，JAD 和/或 JADclipse Eclipse 插件。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-17T15:29:36.737

如果您要查看的类文件是开源的，则不应反编译它，而应将源文件直接附加到您的 IDE 中。这样，您就可以查看某个库类的代码，就好像它是您自己的一样

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-16T20:07:55.420

按照建议，您可以使用 JAD 对其进行反编译并查看文件。为了更容易阅读，您可以使用 eclipse 的 JADclipse 插件将 JAD 直接集成到 eclipse 或使用比命令行 JAD 更容易使用的 DJ Java Decompiler

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-16T20:09:25.853

如果您希望获得可读的 Java 代码，那么 JAD 是一个很好的选择。如果你真的想深入研究`.class`文件格式的内部结构，你会想要`javap`. 它与 JDK 捆绑在一起，允许您将十六进制字节码“反编译”为可读的 ASCII。它产生的语言仍然是字节码（不像 Java），但它具有相当的可读性和极强的指导意义。

此外，如果您*真的*愿意，您可以在十六进制编辑器中打开任何`.class`文件并直接读取字节码。结果与使用`javap`.

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-16T20:45:34.597

无需反编译 Applet.class。公共 Java API 类源代码随 JDK 一起提供（如果您选择安装它），并且比反编译的字节码更具可读性。您可以在 src.zip 中找到压缩文件（位于 JDK 安装文件夹中）。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2017-01-18T13:54:18.733

[CFR - 另一个 java 反编译器](http://www.benf.org/other/cfr/)是一个很好的现代 Java 反编译器，它是用 Java 6 编写的。

# php - 在 Windows 上设置 Openssl 的简单扩展

> ID：76324
> 
> 赞同：2
> 
> 时间：2008-09-16T20:02:38.943
> 
> 标签：php, openssl, gdata-api, google-calendar-api

我真的很想让 google Calendar Api 运行起来。我找到了[一篇](http://www.ibm.com/developerworks/library/x-googleclndr/)关于如何开始的好文章。我下载了 Zend GData 类。我在我的开发盒上运行了 php 5，所有的扩展都应该加载。

当我尝试运行应连接到我的 Google 日历的任何示例页面时，我无法运行 openssl 并收到以下错误。

```
Uncaught exception 'Zend_Gdata_App_HttpException' with message 'Unable to Connect to ssl://www.google.com:443\. Error #24063472: Unable to find the socket transport "ssl" - did you forget to enable it when you configured PHP?' 
```

我在很多地方都试图让 OpenSSL 在我的机器上运行并安装。

有谁知道一个简单的故障安全教程来启动和运行这个组合？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-14T21:01:50.930

首先，如果您提到您的操作系统会很有帮助，我假设是 windows。

检查输出

```
<?php echo phpinfo();?> 
```

如果启用了 OpenSSL 库，“Registered Stream Socket Transports”将提及 ssl

你的 php.ini 应该有

```
[PHP_OPENSSL]
extension=php_openssl.dll 
```

如果它不存在，或者您添加它并且 php 抱怨，那么您应该重新运行安装程序并浏览扩展列表，它将在 OpenSSL 下。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T20:56:33.043

我认为 SSL 的这种使用是 Zend GData 库的一部分，所以我认为它是正确的。我认为没有正确安装 OpenSSL 是我的主要问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T20:27:26.297

您是否在 URL 中输入了错误的 PROTOCOL？它应该是 HTTPS，而不是“SSL”。例如，不是 SSL://www.google.com:443。您能否在示例客户端中仔细检查并确保它是 HTTPS，而不是 SSL。

# powershell - 使用 Powershell 将 Active Directory 组移动到另一个 OU

> ID：76325
> 
> 赞同：7
> 
> 时间：2008-09-16T20:02:42.923
> 
> 标签：powershell, active-directory

如何使用 Powershell 将 Active Directory 组移动到另一个组织单位？

IE。

我想将组“IT部门”从：

```
 (CN=IT Department, OU=Technology Department, OU=Departments,DC=Company,DC=ca) 
```

到：

```
 (CN=IT Department, OU=Temporarily Moved Groups, DC=Company,DC=ca) 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-17T17:36:25.543

您的脚本非常接近正确（我非常感谢您的回复）。

以下脚本是我用来解决问题的脚本：

```
$from = [ADSI]"LDAP://CN=IT Department, OU=Technology Department, OU=Departments,DC=Company,DC=ca"
$to = [ADSI]"LDAP://OU=Temporarily Moved Groups, DC=Company,DC=ca"
$from.PSBase.MoveTo($to,"cn="+$from.name) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-17T05:21:23.483

我还没有尝试过，但这应该可以..

```
$objectlocation= 'CN=IT Department, OU=Technology Department, OU=Departments,DC=Company,DC=ca'
$newlocation = 'OU=Temporarily Moved Groups, DC=Company,DC=ca'

$from = new-object System.DirectoryServices.DirectoryEntry("LDAP://$objectLocation")
$to = new-object System.DirectoryServices.DirectoryEntry("LDAP://$newlocation")
$from.MoveTo($newlocation,$from.name) 
```

# java - 如何防止 Java 创建 hsperfdata 文件？

> ID：76327
> 
> 赞同：49
> 
> 时间：2008-09-16T20:03:08.087
> 
> 标签：java, performance, report

我正在编写一个在 Linux 上运行的 Java 应用程序（使用 Sun 的 JDK）。它不断创建`/tmp/hsperfdata_username`目录，我想阻止。有没有办法阻止java创建这些文件？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-09-16T20:13:00.153

尝试 JVM 选项**-XX:-UsePerfData**

[更多信息](http://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html)

以下链接可能会有所帮助[https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html](https://docs.oracle.com/javase/8/docs/technotes/tools/unix/java.html)

```
-XX:+UsePerfData

    Enables the perfdata feature. This option is enabled by default
    to allow JVM monitoring and performance testing. Disabling it 
    suppresses the creation of the hsperfdata_userid directories. 
    To disable the perfdata feature, specify -XX:-UsePerfData. 
```

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2010-10-14T13:24:28.543

使用 JVM 选项**`-XX:-UsePerfData`**。

正如其他一些答案所说，这不会对性能产生负面影响。

默认情况下，在 HotSpot JVM 中打开 jvmstat 检测。JVM 选项`-XX:-UsePerfData`将其关闭。如果有的话，我会推测，关闭仪器会提高性能（微不足道）。

所以关闭 jvmstat 检测的缺点是你会丢失性能监控信息。

jvmstat 在这里描述[http://java.sun.com/performance/jvmstat/](http://java.sun.com/performance/jvmstat/)

这是一个担心通过打开 jvmstat（带有该选项）会损害性能的人**的**线程`-XX:+UsePerfData`。 [http://www.theserverside.com/discussions/thread.tss?thread_id=33833](http://www.theserverside.com/discussions/thread.tss?thread_id=33833)
（它可能不会，因为 jvmstat 被设计为“始终在线”，但对性能的影响可以忽略不计。）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-03-25T17:12:57.483

与其关闭它，不如更改 java.io.tmpdir 位置。将 -Djava.io.tmpdir=/mydir/somewhere/else/ 添加到您的 Java 启动命令中，然后该文件将位于您控制的某个位置。

* * *

请注意@simonc 的评论：这只适用于 JVM 的几个版本，不再受支持。见[http://bugs.sun.com/view_bug.do?bug_id=6447182](http://bugs.sun.com/view_bug.do?bug_id=6447182) , [http://bugs.sun.com/view_bug.do?bug_id=6938627](http://bugs.sun.com/view_bug.do?bug_id=6938627) , [http://bugs.sun.com/view_bug.do ?bug_id=7009828](http://bugs.sun.com/view_bug.do?bug_id=7009828)了解更多信息。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-06-17T09:09:36.850

还有一个`"-XX:+PerfDisableSharedMem"`选项（由 Sun 推荐），它应该比使用选项引起的性能问题更少`"-XX:-UsePerfData"`。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2018-10-03T15:12:48.857

作为 Mack 回复的附录（2011 年 3 月 25 日 17:12 回答），java.tmp.dir 选项自 Java 8 以来看起来不再可用。请参阅以下位置的信息：[https://bugs.java.com/view_bug。 do?bug_id=8189674](https://bugs.java.com/view_bug.do?bug_id=8189674)

因此，使用 -XX:-UsePerfData 禁用该选项似乎是唯一没有 hsperfdata_* 文件的选项。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-16T20:12:43.163

*编辑：清理信息并总结*

概括：

*   它是一个功能，而不是一个错误
*   可以使用 -XX:-UsePerfData 关闭它，这可能会损害性能

相关资料：

*   [太阳论坛](http://forums.sun.com/thread.jspa?threadID=587299&messageID=4257939)
*   [错误报告](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=5012932)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-16T20:19:47.203

从 svrist 的链接：

> [http://java.sun.com/performance/jvmstat/faq.html](http://java.sun.com/performance/jvmstat/faq.html)中的第一项提到了一个选项，您可以关闭该选项以禁用整套功能：-XX:-UsePerfData。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-16T20:20:04.067

根据[提交的错误报告](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=5012932)，有一个解决方法：

> 此未记录的选项将禁用 perfdata 功能：
> -XX:-UsePerfData

值得一提的是，它是一项功能，而不是错误。上述解决方法只是禁用了该功能。

# php4 - 有没有办法在 PHP4 中模拟 PHP5 的 __call() 魔术方法？

> ID：76328
> 
> 赞同：2
> 
> 时间：2008-09-16T20:03:18.740
> 
> 标签：php4, delegation

PHP5 有一个“魔术方法” `__call()`，可以在调用未定义方法时调用的任何类上定义它——它大致相当于 Ruby`method_missing`或 Perl 的`AUTOLOAD`. 是否有可能在旧版本的 PHP 中做这样的事情？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-22T00:02:50.360

我缺少的最重要的一点是`__call`存在于 PHP4 中，但是您必须通过调用在每个类的基础上启用它`overload()`，如[php docs here](http://us2.php.net/manual/en/function.overload.php)中所示。不幸的是， __call() 函数签名在 PHP4 和 PHP5 之间是不同的，并且似乎没有一种方法可以在两者中运行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T20:10:23.480

我记得使用它，并且有点谷歌搜索表明

```
function __call($method_name, $parameters, &$return)
{
  $return_value = "You called ${method_name}!";
} 
```

作为成员函数将完成这项工作。

# c - C中的编译时LCM / GCD

> ID：76334
> 
> 赞同：3
> 
> 时间：2008-09-16T20:03:33.093
> 
> 标签：c, visual-c++, gcc

**有谁知道在编译时计算C**中至少两个数字的 LCM（最小公倍数）和/或 GCD（最大公分母）的机制（**不是 C++**，我知道那里有模板魔术）？

我通常使用**GCC**，并记得它可以在所有输入已知的编译时计算某些值（例如：sin、cos 等）。

我正在寻找如何在**GCC**中执行此操作（最好以其他编译器可以处理的方式），并希望相同的机制可以在 Visual Studio 中工作。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-16T20:37:03.450

毕竟我想通了...

```
#define GCD(a,b) ((a>=b)*GCD_1(a,b)+(a<b)*GCD_1(b,a))
#define GCD_1(a,b) ((((!(b)))*(a)) + (!!(b))*GCD_2((b), (a)%((b)+!(b))))
#define GCD_2(a,b) ((((!(b)))*(a)) + (!!(b))*GCD_3((b), (a)%((b)+!(b))))
#define GCD_3(a,b) ((((!(b)))*(a)) + (!!(b))*GCD_4((b), (a)%((b)+!(b))))
#define GCD_4(a,b) ((((!(b)))*(a)) + (!!(b))*GCD_5((b), (a)%((b)+!(b))))
#define GCD_5(a,b) ((((!(b)))*(a)) + (!!(b))*GCD_6((b), (a)%((b)+!(b))))
#define GCD_6(a,b) ((((!(b)))*(a)) + (!!(b))*GCD_7((b), (a)%((b)+!(b))))
#define GCD_7(a,b) ((((!(b)))*(a)) + (!!(b))*GCD_8((b), (a)%((b)+!(b))))
#define GCD_8(a,b) ((((!(b)))*(a)) + (!!(b))*GCD_last((b), (a)%((b)+!(b))))
#define GCD_last(a,b) (a)

#define LCM(a,b) (((a)*(b))/GCD(a,b))

int main()
{
    printf("%d, %d\n", GCD(21,6), LCM(21,6));
    return 0;
} 
```

请注意，根据您的整数有多大，您可能需要包括更多的中间步骤（即 GCD_9、GCD_10 等...）。

我希望这有帮助！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T01:01:38.413

部分基于凯文的回答，这里有一个宏序列，它对常量值有编译时错误，否则有运行时错误。

如果不能选择失败，它也可以配置为引入非编译时函数。

```
#define GCD(a,b) ( ((a) > (b)) ? ( GCD_1((a), (b)) ) : ( GCD_1((b), (a)) ) )

#define GCD_1(a,b) ( ((b) == 0) ? (a) : GCD_2((b), (a) % (b) ) )
#define GCD_2(a,b) ( ((b) == 0) ? (a) : GCD_3((b), (a) % (b) ) )
#define GCD_3(a,b) ( ((b) == 0) ? (a) : GCD_4((b), (a) % (b) ) )
#define GCD_4(a,b) ( ((b) == 0) ? (a) : GCD_5((b), (a) % (b) ) )
#define GCD_5(a,b) ( ((b) == 0) ? (a) : GCD_6((b), (a) % (b) ) )
#define GCD_6(a,b) ( ((b) == 0) ? (a) : GCD_7((b), (a) % (b) ) )
#define GCD_7(a,b) ( ((b) == 0) ? (a) : GCD_8((b), (a) % (b) ) )
#define GCD_8(a,b) ( ((b) == 0) ? (a) : GCD_9((b), (a) % (b) ) )
#define GCD_9(a,b) (assert(0),-1) 
```

请注意将其扩展得太大，即使它会提前终止，因为编译器必须在评估之前完全插入所有内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T22:04:14.050

我意识到您只对 C 实现感兴趣，但我想我还是会对 C++ 和模板元编程发表评论。我不完全相信在 C++ 中这是可能的，因为您需要明确定义的初始条件才能终止递归扩展。

```
template<int A, int B>
struct GCD {
    enum { value = GCD<B, A % B>::value };
};

/*
Because GCD terminates when only one of the values is zero it is impossible to define a base condition to satisfy all GCD<N, 0>::value conditions
*/
template<>
struct GCD<A, 0> { // This is obviously not legal
    enum { value = A };
};

int main(void)
{
    ::printf("gcd(%d, %d) = %d", 7, 35, GCD<7, 35>::value);
} 
```

这可能在 C++0x 中是可能的，但不是 %100 确定的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-11-20T15:22:53.477

```
 int gcd(int n1,int n2){
       while(n1!=n2){
        if(n1 > n2) n1 -= n2;
        else n2 -= n1;
    }
    return n1;
}
int lcm(int n1, int n2){
    int total =n1*n2;
    return total/gcd(n1,n2);
} 
```

# sql - 为什么当 xact_abort 开启时 Sql Server 在 raiserror 之后继续执行？

> ID：76346
> 
> 赞同：92
> 
> 时间：2008-09-16T20:04:35.977
> 
> 标签：sql, sql-server, tsql

我只是对 TSQL 中的某些东西感到惊讶。我认为如果 xact_abort 开启，调用类似

```
raiserror('Something bad happened', 16, 1); 
```

将停止执行存储过程（或任何批处理）。

但我的 ADO.NET 错误消息正好相反。我在异常消息中收到了 raiserror 错误消息，以及在那之后发生的下一个问题。

这是我的解决方法（无论如何这是我的习惯），但似乎没有必要：

```
if @somethingBadHappened
    begin;
        raiserror('Something bad happened', 16, 1);
        return;
    end; 
```

文档是这样说的：

> 当 SET XACT_ABORT 为 ON 时，如果 Transact-SQL 语句引发运行时错误，则整个事务将终止并回滚。

这是否意味着我必须使用显式事务？

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2008-09-16T20:12:29.123

这是 By Design ^(TM)，您可以在 SQL Server 团队对类似问题的回答中看到[Connect ：](http://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=275308)

> 感谢您的反馈意见。按照设计，XACT_ABORT 设置选项不会影响 RAISERROR 语句的行为。我们将考虑您的反馈，以便为 SQL Server 的未来版本修改此行为。

是的，对于一些希望`RAISERROR`高严重性（如`16`）与 SQL 执行错误相同的人来说，这是一个问题——事实并非如此。

您的解决方法就是您需要做的事情，并且使用显式事务对您想要更改的行为没有任何影响。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-09-16T21:09:44.820

如果您使用 try/catch 块，严重性为 11-19 的 raiserror 错误号将导致执行跳转到 catch 块。

任何高于 16 的严重性都是系统错误。为了演示以下代码，我们设置了一个 try/catch 块并执行我们假设会失败的存储过程：

假设我们有一个表 [dbo].[Errors] 来保存错误假设我们有一个存储过程 [dbo].[AssumeThisFails]，当我们执行它时会失败

```
-- first lets build a temporary table to hold errors
if (object_id('tempdb..#RAISERRORS') is null)
 create table #RAISERRORS (ErrorNumber int, ErrorMessage varchar(400), ErrorSeverity int, ErrorState int, ErrorLine int, ErrorProcedure varchar(128));

-- this will determine if the transaction level of the query to programatically determine if we need to begin a new transaction or create a save point to rollback to
declare @tc as int;
set @tc = @@trancount;
if (@tc = 0)
 begin transaction;
else
 save transaction myTransaction;

-- the code in the try block will be executed
begin try
 declare @return_value = '0';
 set @return_value = '0';
 declare
  @ErrorNumber as int,
  @ErrorMessage as varchar(400),
  @ErrorSeverity as int,
  @ErrorState as int,
  @ErrorLine as int,
  @ErrorProcedure as varchar(128);

 -- assume that this procedure fails...
 exec @return_value = [dbo].[AssumeThisFails]
 if (@return_value <> 0)
  raiserror('This is my error message', 17, 1);

 -- the error severity of 17 will be considered a system error execution of this query will skip the following statements and resume at the begin catch block
 if (@tc = 0)
  commit transaction;
 return(0);
end try

-- the code in the catch block will be executed on raiserror("message", 17, 1)
begin catch
  select
   @ErrorNumber = ERROR_NUMBER(),
   @ErrorMessage = ERROR_MESSAGE(),
   @ErrorSeverity = ERROR_SEVERITY(),
   @ErrorState = ERROR_STATE(),
   @ErrorLine = ERROR_LINE(),
   @ErrorProcedure = ERROR_PROCEDURE();

  insert #RAISERRORS (ErrorNumber, ErrorMessage, ErrorSeverity, ErrorState, ErrorLine, ErrorProcedure)
   values (@ErrorNumber, @ErrorMessage, @ErrorSeverity, @ErrorState, @ErrorLine, @ErrorProcedure);

  -- if i started the transaction
  if (@tc = 0)
  begin
   if (XACT_STATE() <> 0)
   begin
     select * from #RAISERRORS;
    rollback transaction;
    insert into [dbo].[Errors] (ErrorNumber, ErrorMessage, ErrorSeverity, ErrorState, ErrorLine, ErrorProcedure)
     select * from #RAISERRORS;
    insert [dbo].[Errors] (ErrorNumber, ErrorMessage, ErrorSeverity, ErrorState, ErrorLine, ErrorProcedure)
     values (@ErrorNumber, @ErrorMessage, @ErrorSeverity, @ErrorState, @ErrorLine, @ErrorProcedure);
    return(1);
   end
  end
  -- if i didn't start the transaction
  if (XACT_STATE() = 1)
  begin
   rollback transaction myTransaction;
   if (object_id('tempdb..#RAISERRORS') is not null)
    insert #RAISERRORS (ErrorNumber, ErrorMessage, ErrorSeverity, ErrorState, ErrorLine, ErrorProcedure)
     values (@ErrorNumber, @ErrorMessage, @ErrorSeverity, @ErrorState, @ErrorLine, @ErrorProcedure);
   else
    raiserror(@ErrorMessage, @ErrorSeverity, @ErrorState);
   return(2); 
  end
  else if (XACT_STATE() = -1)
  begin
   rollback transaction;
   if (object_id('tempdb..#RAISERRORS') is not null)
    insert #RAISERRORS (ErrorNumber, ErrorMessage, ErrorSeverity, ErrorState, ErrorLine, ErrorProcedure)
     values (@ErrorNumber, @ErrorMessage, @ErrorSeverity, @ErrorState, @ErrorLine, @ErrorProcedure);
   else
    raiserror(@ErrorMessage, @ErrorSeverity, @ErrorState);
   return(3);
  end
 end catch
end 
```

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2011-05-13T11:16:40.017

`RETURN`之后立即使用`RAISERROR()`，它不会进一步执行该过程。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2013-08-14T03:18:10.100

正如 docs 中所指出的那样，应该使用[`SET XACT_ABORT`](https://docs.microsoft.com/en-us/sql/t-sql/statements/set-xact-abort-transact-sql)该语句而不是.`THROW``RAISERROR`

两者的行为[略有不同](https://docs.microsoft.com/en-us/sql/t-sql/language-elements/throw-transact-sql)。但是当`XACT_ABORT`设置为 ON 时，您应该始终使用该`THROW`命令。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-08-03T14:07:44.793

微软建议使用 throw 而不是 raiserror。使用 XACT_State 确定 try catch 块的提交或回滚

```
set XACT_ABORT ON;

BEGIN TRY
     BEGIN TRAN;

     insert into customers values('Mark','Davis','markdavis@mail.com', '55909090');
    insert into customer values('Zack','Roberts','zackroberts@mail.com','555919191');
    COMMIT TRAN;
  END TRY

BEGIN CATCH
    IF XACT_STATE()=-1
        ROLLBACK TRAN;
    IF XACT_STATE()=1
       COMMIT TRAN;
    SELECT ERROR_MESSAGE() AS error_message
END CATCH 
```

# asp.net - 调试时编辑源代码

> ID：76349
> 
> 赞同：9
> 
> 时间：2008-09-16T20:04:53.620
> 
> 标签：asp.net, debugging

我有 VS2005，目前正在尝试调试 ASP.net Web 应用程序。我想在文件后面的代码中更改一些代码，但是每次我停在断点并尝试编辑某些内容时，我都会收到以下错误消息：“当调试器已附加到已运行的进程时，不允许更改或者被调试的代码被优化。”

我很确定我启用了所有“编辑并继续”选项。有什么建议么？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-16T20:40:48.400

这可能看起来违反直觉，但请关闭编辑并继续。

可能还有另一个“允许我编辑只读文件”或“即使我在调试时也允许我编辑......不是真的！” 设置在某个地方，但我没有 2005 年可以查看。

在 2008 年，关闭编辑并继续，您可以在运行时进行编辑（但不会应用这些更改。）

如果您真的想使用编辑并继续，您还必须在项目设置的 Web 选项卡上为项目启用它。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-16T20:07:55.827

该应用程序实际上是在您的代码的编译版本之外运行的。如果您修改它，它必须重新编译它才能使您的更改生效，这意味着它需要将正在运行的版本换成新的编译版本。这是一个相当困难的问题——这就是为什么我认为微软让它不可能做到。更多的是保护您免于思考某些更改实际上并没有发生。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-31T21:47:11.833

对于 Asp.net，可以考虑两种类型的“编辑和继续”。

一个是经典的编辑和刷新浏览器。这是有效的，因为浏览器刷新会重新编译除文件后面的预编译代码之外的所有内容。这不称为“编辑并继续”，尽管在实践中它提供了类似的效果。在这种模式下，您无法更改文件背后的代码，因为它们已经过预编译和部署，但您几乎可以更改任何其他内容。

另一种模式允许您更改文件后面的预编译代码，但仅此而已......（这是 Chris Bilson 提到的模式，需要在 ASP.Net 的项目属性上设置）。在这种情况下，您使用的是调试器的“编辑并继续”功能，它对 ASP.net 知之甚少。调试器只看到一个加载的 .Net 程序集，并且可以在调试器中停止时对其进行修改，因为解决方案中有一个项目声称知道如何构建它。在这种情况下，您将无法修改否则会弄乱调试会话的内容。但是，此方法是在代码运行时更改代码而不需要刷新浏览器的唯一方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T20:12:08.970

您可以在文件运行时对其进行更改`*.aspx`，并且您可以在您的 Web 实例上点击刷新以立即查看这些更改。但是，您不能在程序运行时更改`*.cs/*.vb`或文件。`*.designer.cs/*.designer.vb`

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-06-10T21:17:48.457

我在 Visual Studio 2008 WAP（Web 应用程序项目）上搜索这个，我花了两天时间才找到解决方案，所以在这里希望它可以帮助其他人：

有两个地方要检查，一个在tools-options-debugging-Edit And Continue-Enable Edit And Continue下，另一个是右键project-properties-Web-Enable Edit And Continue

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-10-04T14:46:09.207

作为记录，我在 VS 2008 上遇到了类似的问题，而另一个解决方案为我解决了这个问题。 [在调试模式下在 Visual Studio 2008 中编辑代码](https://stackoverflow.com/questions/2781060/editing-code-in-visual-studio-2008-in-debug-mode)

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2010-05-13T10:42:30.340

检查您是否未处于发布模式。在发布模式下，您无法在调试时编辑代码。只需将模式更改为调试

# sql - 免费/便宜的 PowerDesigner 替代品？

> ID：76350
> 
> 赞同：18
> 
> 时间：2008-09-16T20:04:59.780
> 
> 标签：sql, sql-server, database, modeling

我们在工作中使用 PowerDesigner 进行数据库建模。但是该软件的价格标签非常昂贵。坦率地说，我使用的只是 MS SQL 的物理图，这大约是 PD 所知道的 1%。

有什么好的选择吗？我知道 Visio 和 MS SQL 图表，但正在寻找其他选项。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-26T20:13:41.967

[Power*Architect](http://www.sqlpower.ca/page/architect)是必经之路。它是免费的、开源的，并且在帮助您构建 ERD 方面做得非常出色。此外，它还可以在 Windows、Linux 和 OSX 上运行。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-08-13T07:39:58.217

开放系统架构师：www.codebydesign.com - 它对我来说非常完美

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-10-22T17:52:30.160

还可以查看 Sparx Enterprise Architect。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T20:24:23.713

我只是通过图表文件夹使用 SQL Server。设计器使用起来非常简单，可以用来相当快速地生成表格。考虑到它是免费的软件，我没有看到这个问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-08-26T19:31:34.513

SourceForge.net 德鲁伊项目

有一个模板引擎来生成 DDL 或任何你喜欢的东西。能够在一个模型中包含多个图表。只做物理数据模型。它是免费的，并且有可用的资源。它是一个基于 java 的工具，因此可以在 Unix 或 Windows 上运行。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-07-16T15:35:17.973

魔术绘图怎么样？这是一个非常强大的工具，但我认为它和 PowerDesigner 一样昂贵，不确定。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T20:30:00.267

您可能想查看[https://www.xcase.com/demo.php](https://www.xcase.com/demo.php)。它不是免费的，但据我所知，它比 PowerDesigner 便宜很多。我使用过早期版本，但最近我可以轻松访问 Visio，因此继续使用该版本，而不是投资 xCase。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-17T09:07:54.877

VS Enterprise Architect 附带的 Visio 版本具有生成 SQL 的正向工程功能。建模引擎还有一个类型库，但（至少在旧版本上）它不会提取某些项目，例如评论。但是，生成的 SQL 的注释结构相当简单，有助于解析生成的 SQL。

您可以在 E-bay 上以不高的价格获得旧版本的 VS 企业架构师（我认为我的成本约为 250 英镑）。

对逆向工程师的一个警告是，所有 VS2005 之前的 visio DB 建模引擎都不能很好地与 SQL Server 2005 本机客户端配合使用。您需要编写数据库脚本并将其重新加载到 SQL2000 服务器上（处理 SQL2005 的特定功能（例如模式）作为练习留给读者）或获取更新的版本。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-26T20:07:53.417

那么还有另一种选择。使用它不仅仅是制作桌子！利用它，让你的钱物有所值。您已经为此付费，您可以放弃维护并按原样使用它。总之，有什么值得深思的。

# php - PHP ADOdb 中的变量绑定

> ID：76359
> 
> 赞同：4
> 
> 时间：2008-09-16T20:06:18.937
> 
> 标签：php, binding, parameters, sql-injection, adodb-php

默认情况下，ADOdb 是否在同一功能内进行数据清理或转义？还是我只是将它与 Code Igniter 的内置进程混淆了？

将变量绑定到 ADOdb for PHP 中的参数是否以任何方式防止 SQL 注入？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T20:21:32.207

是的，您传递参数数组。

```
$rs = $db->Execute('select * from table where val=?', array('10')); 
```

他们的其余文档可以在[这里](http://adodb.sourceforge.net/#docs)找到：

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T20:23:48.690

正确绑定的参数不易受到 SQL 注入攻击。

# language-agnostic - 代码生成器与 ORM 与存储过程

> ID：76395
> 
> 赞同：15
> 
> 时间：2008-09-16T20:09:58.380
> 
> 标签：language-agnostic, architecture, stored-procedures, orm, code-generation

这些软件架构各自在哪些领域发光或失败？

哪些关键要求会促使您选择其中一项？

请假设您有可用的开发人员，他们可以编写良好的面向对象代码以及良好的数据库开发。

另外，请避免圣战 :) 这三种技术各有利弊，我对最适合使用哪种技术感兴趣。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-16T20:42:10.363

这些工具中的每一个都提供了不同的抽象层，以及覆盖行为的不同点。这些都是架构选择，所有架构选择都取决于技术、控制和组织之间的权衡，包括应用程序本身和将要部署的环境。

*   如果您正在处理一种 DBA “称雄”的文化，那么基于存储过程的体系结构将更易于部署。另一方面，管理和版本存储过程可能非常困难。

*   当您使用静态类型语言时，代码生成器会大放异彩，因为您可以在编译时而不是在运行时捕获错误。

*   ORM 是集成工具的理想选择，您可能需要在安装到安装的基础上处理不同的 RDBMS 和模式。更改一张地图，您的应用程序就会从在 Oracle 上使用 PeopleSoft 到在 SQL Server 上使用 Microsoft Dynamics。

我见过使用生成代码与存储过程交互的应用程序，因为可以调整存储过程以绕过代码生成器中的限制。

最终，唯一正确的答案将取决于您尝试解决的问题以及解决方案需要执行的环境。其他任何事情都在争论“土豆”的正确发音。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-16T20:44:42.773

我会加两分钱：

**存储过程**

*   可以轻松优化
*   抽象基本业务规则，增强数据完整性
*   提供良好的安全模型（无需向面向前端的 db 用户授予读取或写入权限）
*   当您有许多应用程序访问相同的数据时会发光

**ORM**

*   让你只专注于领域，拥有更“纯”的面向对象的开发方式
*   当您的应用程序必须与跨数据库兼容时闪耀
*   当您的应用程序主要由行为而不是数据驱动时，您会大放异彩

**代码生成器**

*   为您提供与 ORM 类似的好处，但维护成本更高，但可定制性更好。
*   通常优于 ORM，因为 ORM 倾向于用编译时错误换取运行时错误，这通常是可以避免的

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-16T20:14:39.557

我同意每件事都有利有弊，很大程度上取决于您的架构。话虽如此，我尝试在有意义的地方使用 ORM。许多功能已经存在，通常它们有助于防止 SQL 注入（另外它有助于避免重新发明轮子）。

有关更多信息，请参阅有关该主题的其他两篇文章（动态 SQL 与存储过程与 ORM）

**动态 SQL 与存储过程**
[哪个更好：即席查询还是存储过程？](https://stackoverflow.com/questions/22907/which-is-better-ad-hoc-queries-or-stored-procedures)

**ORM 与存储过程**
[为什么 NHibernate 生成参数化 SQL 的速度与存储过程一样快？](https://stackoverflow.com/questions/50346/why-is-parameterized-sql-generated-by-nhibernate-just-as-fast-as-a-stored-proce)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-16T20:24:38.097

ORM 和代码生成器在该领域的一侧，而存储过程在另一侧。通常，在新建项目中使用 ORM 和代码生成器会更容易，因为您可以定制数据库模式以匹配您创建的域模型。将它们用于遗留项目要困难得多，因为一旦以“数据优先”的心态编写软件，就很难用域模型来包装它。

话虽如此，所有三种方法都有价值。存储过程可能更容易优化，但将可能在应用程序本身中重复的业务逻辑放入其中可能很诱人。如果您的架构与 ORM 的概念匹配，ORM 就可以很好地工作，但如果不匹配，则可能难以自定义。代码生成器可能是一个很好的中间地带，因为它们提供了 ORM 的一些好处，但允许自定义生成的代码——但是，如果你养成了更改生成的代码的习惯，你就会遇到两个问题，因为你每次重新生成它时都必须更改它。

没有一个真正的答案，但我更倾向于 ORM 方面，因为我相信以对象优先的思维方式思考更有意义。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-16T20:30:06.477

**存储过程**

*   **优点：**封装数据访问代码并且独立于应用程序
*   **缺点：**可以是 RDBMS 特定的并增加开发时间

**甲骨文**

*至少一些 ORM 允许映射到存储过程*

*   **优点：**抽象数据访问代码并允许以特定于域的方式编写实体对象
*   **缺点：**可能的性能开销和有限的映射能力

**代码生成**

*   **优点：**可用于生成基于存储过程的代码或 ORM 或两者的混合
*   **缺点：**除了理解生成的代码之外，可能还必须维护代码生成器层

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-19T20:38:53.720

您忘记了一个值得拥有自己类别的重要选项：混合数据映射框架，例如[iBatis](http://ibatis.apache.org/)。

我对 iBatis 很满意，因为它让您的 OO 代码本质上保持 OO，并且您的数据库本质上保持关系，并通过添加第三个抽象（对象和关系之间的映射层）来解决阻抗不匹配问题映射两者，而不是试图将一种范式强制适应另一种范式。

# sql - 如何防止插入查询注册到分布式事务？

> ID：76403
> 
> 赞同：5
> 
> 时间：2008-09-16T20:10:49.923
> 
> 标签：sql, sql-server, transactions, linked-server, msdtc

我在存储过程中有一个 SQL 插入查询，用于将行插入到**链接服务器**表中。

由于存储过程在父事务中被调用，因此此 Insert 语句尝试使用 DTC 将行插入链接服务器。

我想**避免**DTC 参与其中。

有什么方法可以让插入 SQL 语句忽略事务范围？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T20:32:43.583

我的建议是您将要插入的任何内容存储到临时表中，并且一旦该过程结束运行跨服务器插入。据我所知，一旦您在 SProc 执行中，就无法忽略您所在的事务。

相反，如果您使用 .NET 2.0 的 System.Transaction 命名空间，您可以告诉特定语句不要参与任何父范围事务。这将要求您在代码而不是存储过程中编写一些逻辑，但会起作用。

这是一个[相关链接](http://decipherinfosys.wordpress.com/2007/02/01/simulating-autonomous-transaction-behavior-in-sql-server/)。

祝你好运，艾伦。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2018-03-27T10:56:06.327

尝试使用 openquery 调用链接服务器查询/sp 而不是直接调用这对我有用

所以不要插入... select * from mylinkedserver.pubs.dbo.authors

例如 DECLARE @TSQL varchar(8000), @VAR char(2) SELECT @VAR = 'CA' SELECT @TSQL = 'SELECT * FROM OPENQUERY(MyLinkedServer,''SELECT * FROM pubs.dbo.authors WHERE state = ''' '' + @VAR + ''''''')'

插入......执行（@TSQL）

# python - 这些脚本语言中哪一种更适合渗透测试？

> ID：76408
> 
> 赞同：6
> 
> 时间：2008-09-16T20:11:22.217
> 
> 标签：python, ruby, perl, security, penetration-testing

首先，我想避免语言上的火焰战争。可供选择的语言有 Perl、Python 和 Ruby。我想提一下，我对所有这些都很满意，但问题是我不能只专注于一个。

例如，如果我看到一个很酷的 Perl 模块，我必须尝试一下。如果我看到一个不错的 Python 应用程序，我必须知道它是如何制作的。如果我看到 Ruby DSL 或一些 Ruby 巫术，我会迷上 Ruby 一段时间。

现在我是一名 Java 开发人员，但计划在不久的将来学习 CEH。我的问题是：对于工具编写和漏洞利用开发，您认为哪种语言最合适？

再说一次，我不想引起一场激烈的战争或任何麻烦，我只想从知道自己在做什么的脚本编写者那里得到诚实的意见。

还有一件事：也许你们中的一些人会问“为什么要选择一种语言？”。回答这个问题：我只想选择一种语言，以便尝试掌握它。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-09-17T00:11:01.187

您可能需要 Ruby，因为它是 Metasploit 的原生语言，它是事实上的标准开源渗透测试框架。Ruby 会给你：

*   [Metasploit 的](http://www.metasploit.com/)框架、操作码和 shellcode 数据库
*   Metasploit 的[Ruby lorcon](http://rubyforge.org/projects/ruby-lorcon/)绑定用于原始 802.11 工作。
*   Metasploit 用于 802.11 客户端重定向的 KARMA 绑定。
*   用于 Web 工具编写的[Libcurl和 net/http。](http://curl.haxx.se/libcurl/ruby/)
*   [EventMachine](http://rubyforge.org/projects/eventmachine)用于 Web 代理和模糊测试工作（或 RFuzz，它扩展了著名的 Mongrel 网络服务器）。
*   用于 shellcode 生成的[Metasm 。](http://metasm.cr0.org/)
*   用于 x86 反汇编的[Distorm 。](http://www.ragestorm.net/distorm/)
*   [BinData](http://blogfranz.blogspot.com/2008/01/bindata-for-ruby-fuzzers.html)用于二进制文件格式的模糊测试。

这里的第二名是 Python。Python 中可用的渗透测试库比 Ruby 中更多（但不足以抵消 Metasploit）。商业工具也倾向于支持 Python --- 如果您是 Immunity CANVAS 或 CORE Impact 客户，那么您需要 Python。Python 为您提供：

*   [扭曲](http://twistedmatrix.com/trac/)的网络访问。
*   [PaiMei](http://www.openrce.org/downloads/details/208/PaiMei)用于程序跟踪和可编程调试。
*   画布和影响支持。
*   [Dornseif 的](http://www.matasano.com/log/695/windows-remote-memory-access-though-firewire/)用于远程调试的火线库。
*   [准备好与 WinDbg 集成以](http://pydbgeng.sourceforge.net/)进行远程 Windows 内核调试（Ruby 中对于内核调试仍然没有好的答案，这就是我仍然偶尔使用 Python 的原因）。
*   [Peach Fuzzer](http://peachfuzzer.com/)和 Sully 用于模糊测试。
*   用于 Web 渗透测试的 SpikeProxy（也称为[OWASP Pantera](http://www.owasp.org/index.php/Category:OWASP_Pantera_Web_Assessment_Studio_Project)）。

毫不奇怪，很多 Web 工作都使用 Java 工具。事实上的标准网络渗透测试工具是 Burp Suite，它是一个 Java swing 应用程序。Ruby 和 Python 都有 Java 变体，您可以使用这些变体来访问此类工具。此外，Ruby 和 Python 都提供：

*   与 libpcap 直接集成以进行原始数据包工作。
*   加密的 OpenSSL 绑定。
*   IDA Pro 扩展。
*   用于 API 访问的成熟（或至少合理的）C 外部函数接口。
*   用于 UI 工作的 WxWindows，以及用于 Web UI 的不错的 Web 堆栈。

任何一种语言都不会出错，尽管对于主流的渗透测试工作，Metasploit 可能会排除 Python 的所有优势，而目前，对于 x86 逆向工作，Python 卓越的调试接口会排除所有 Ruby 的好处。

另外：现在是 2008 年。它们不是“脚本语言”。他们是编程语言。;)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-16T22:04:39.027

[免责声明：我主要是一名 Perl 程序员，这可能会影响我的判断。然而，我不是一个特别部落的人，我认为在这个特殊问题上我的论点是相当客观的。]

Perl 被设计为无缝融入 Unix 环境，这就是为什么对于以 OO 背景为主的人（尤其是 Java 学派的 OOP）感觉如此陌生的原因。但是，出于这个原因，它非常广泛地安装在具有任何类型的 Unixoid OS 的机器上，并且许多供应商系统实用程序都在其中编写。同样出于同样的原因，既没有安装 Python 也没有安装 Ruby 的服务器上仍然可能有 Perl，这再次使得熟悉它变得很重要。因此，如果您的 CEH 活动包括在 Unix 上的广泛活动，那么无论如何您都必须对 Perl 有一定的了解，并且您不妨专注于它。

也就是说，这在很大程度上是一个偏好问题。语言没有太多区别。他们的表现力几乎是相同的。有些事情在其中一种语言中容易一些，有些在另一种语言中容易一些。

在库方面，我不知道 Ruby 和 Python 如何相互比较——我确实知道 Perl 让它们领先一步。话又说回来，有时（特别是当您正在寻找满足共同需求的库时）唯一的影响就是您会被选择淹没。而且，如果您只是想在 Python 或 Ruby 的库很好地涵盖的某个特定领域做事，那么 CPAN 上的大量*其他*东西不一定是优势。然而，在利基领域，它很重要，你永远不知道你最终会有什么不可预见的需求（错误，根据定义）。

对于命令行上的单行使用，Python 是一种非入门者。

在交互式解释器环境方面，Perl……嗯……嗯，你可以使用调试器，它不是那么好，或者你可以从 CPAN 安装一个，但 Perl 本身并没有提供一个好的。

所以我认为 Perl 确实对你的需求有非常小的优势，但只是而已。如果您选择 Ruby，您可能根本不会变得更糟。Python 可能会给您带来更明显的不便，但这也不是一个*糟糕*的选择。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-16T22:48:56.533

我可以为这三个方面提出一个论据:-)

Perl 具有 CPAN 的所有特性——在快速整合功能方面为您提供了巨大的优势。它还具有很好的灵活测试基础架构，这意味着您可以在同一框架中插入许多不同的自动化测试样式（包括其他语言的测试）。

Ruby 是一门很好学的语言——它缺少 Perl 5 中的一些笨拙的东西。如果你在做基于 Web 的测试，它还有 watir 库——它对 trez 很有用（参见[http://wtr.rubyforge.org/](http://wtr.rubyforge.org/)）

Python - 不错的语言，而且（虽然这不是我个人的喜好）有些人发现它的结构方式更容易掌握。

他们中的任何一个（以及许多其他人）都将是一门很好的学习语言。

与其看语言，不如看你的工作环境。如果您周围有其他人在做类似的事情，那么学习东西总是更容易。如果您当前的开发/测试人员已经专注于上述之一 - 我会这样做。如果没有，请选择对您当前的工作环境最适用/最有用的一个。与团队的其他成员聊天，看看他们的想法。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-16T20:14:39.353

这取决于实现，如果它是分布式的，我会使用 Java，正如你所知，因为它的可移植性。如果它只是供内部使用，或者将在半受控环境中使用，那么请使用您最舒适的维护方式，以及具有最佳长期前景的方式。

现在只是回答这个问题，我会使用 Perl，但我是一个 linux 人，所以我可能对此有点偏见。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-16T22:49:14.910

如果您打算使用 Metasploit 进行渗透测试和漏洞利用开发，我会推荐 ruby​​，如前所述 Metasploit 是用 ruby​​ 编写的，您可能希望进行的任何漏洞利用/模块开发都需要 ruby​​。

如果您将使用 Immunity CANVAS 进行渗透测试，那么出于同样的原因，我会推荐 Python，因为 CANVAS 是用 Python 编写的。还有很多像 Peach 和 Sulley 这样的模糊测试框架都是用 Python 编写的。

我不会推荐 Perl，因为在 Perl 中你会发现很少有与笔测试/模糊测试/漏洞利用/...相关的工具/脚本/框架。

由于您的问题是“工具编写和漏洞利用开发”，如果您选择 Metasploit，我会推荐 Ruby；如果您选择 CANVAS，我会推荐 Python。

希望有帮助:)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-16T20:48:21.410

作为一名 CEH，首先学习 CEH 材料。这将使您接触到用于发起各种攻击的各种工具和平台。一旦你很好地理解了你的目标，就可以研究一下已经可用的工具和平台的功能（前面提到的 metasploit 框架非常彻底和健壮）。如何扩展它们以满足您的需求？一旦你知道了这一点，你就可以比较语言的能力。

我还建议查看[BackTrack](http://www.remote-exploit.org/backtrack.html)发行版上可用的工具。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-16T20:19:25.737

所有这些都应该足够了。除非您需要一些仅以一种语言提供的库，否则我会让个人喜好指导我。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-16T20:20:05.843

如果您正在寻找一种可以很好地与 Java 配合使用的脚本语言，那么您可能想看看 Groovy。它具有 Perl 的灵活性和强大功能（闭包、内置正则表达式、每个角落的关联数组），但您可以从中访问 Java 代码，因此您可以访问大量库，尤其是您系统的其余部分重新开发。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-16T20:22:50.830

[metasploit](http://www.metasploit.com/)是一个很好的渗透测试框架。它主要是用 Ruby 编写的，所以如果你对这种语言很熟悉，也许你可以在那里学习。但是，要*使用*metasploit，您根本不需要了解任何语言。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-07-11T20:58:06.647

如果您对 CEH 感兴趣，我会看看[Gray Hat Python](https://rads.stackoverflow.com/amzn/click/com/1593271921)。它展示了一些非常有趣和相关的东西。

话虽如此，任何语言都应该没问题。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-16T20:17:11.593

好吧，你在想什么样的攻击？如果您想编写一些需要低级内容（ptrace、原始套接字等）的东西，那么您需要学习 C。但是 Perl 和 Python 都可以使用。真正的问题是哪一个更适合你的风格？

至于工具制作，Perl 具有良好的字符串处理能力，更接近系统，具有良好的支持，但恕我直言，这非常令人困惑。我更喜欢 Python：它是一种干净、易于使用、易于学习的语言，具有良好的支持（完整的语言/库参考、第 3 方库等）。它（严格恕我直言）很酷。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2011-02-07T22:24:32.513

我和tqbf在一起。我使用过 Python 和 Ruby。目前我正在使用 JRuby。它具有 Ruby 的所有功能，可以访问 Java 库，因此如果您绝对需要低级语言来解决某些问题，您可以使用高级语言来解决。到目前为止，我不需要真正使用太多 Java，因为 Ruby 已经能够完成我作为 API 测试人员所需的一切。

# regex - 如何使用正则表达式循环分隔标记？

> ID：76411
> 
> 赞同：1
> 
> 时间：2008-09-16T20:11:29.470
> 
> 标签：regex

如何创建一个从字符串中获取分隔文本的正则表达式？例如，给定一个字符串

```
text ###token1### text text ###token2### text text 
```

我想要一个可以退出的正则表达式`###token1###`。是的，我也想要分隔符。通过添加另一个组，我可以同时获得：

```
(###(.+?)###) 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T20:13:33.740

```
/###(.+?)###/ 
```

如果你想要###，那么你需要

```
/(###.+?###)/ 
```

**？** _ 表示非贪婪，如果你没有**?** ，那么它会抓住太多。

例如`'###token1### text text ###token2###'`，都会被抓住。

我最初的答案是 * 而不是 +。* 表示 0 或更多。+ 表示 1 或更多。* 是错误的，因为这将允许 ###### 作为有效的查找对象。

用于玩正则表达式。我强烈推荐用于 Windows 的[http://www.weitz.de/regex-coach/ 。](http://www.weitz.de/regex-coach/)你可以输入你想要的字符串和你的正则表达式，看看它实际上在做什么。

您选择的文本将存储在 \1 或 $1 中，具体取决于您使用正则表达式的位置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T20:21:02.660

在 Perl 中，你实际上想要这样的东西：

```
$text = 'text ###token1### text text ###token2### text text';

while($text =~ m/###(.+?)###/g) {
  print $1, "\n";
} 
```

这将在 while 循环中依次为您提供每个令牌。(.*?) 确保您获得分隔符之间的*最短*位，防止它认为令牌是 'token1### text text ###token2'。

或者，如果您只想保存它们，不要立即循环：

```
@tokens = $text =~ m/###(.+?)###/g; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T20:14:55.873

假设您也想匹配 ###token2### ......

```
/###.+###/ 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T20:19:07.830

使用 () 和 \x。假设标记中的文本始终由 # 分隔的天真示例：

```
text (#+.+#+) text text (#+.+#+) text text 
```

然后可以通过使用 \1 和 \2 来获取 () 中的内容（第一组为 \1，替换表达式中的第二个为 \2（假设您正在编辑器中进行搜索/替换）。对于例如，替换表达式可以是：

```
token1: \1, token2: \2 
```

对于上面的例子，这应该产生：

```
token1: ###token1###, token2: ###token2### 
```

如果您在程序中使用正则表达式库，您可能会调用一个函数来获取第一个和第二个标记的内容，您已经用它们周围的 ()s 表示。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T20:20:10.650

好吧，当您使用诸如此类的分隔符时，基本上您只需抓住第一个分隔符，然后抓住与结束分隔符不匹配的任何内容，然后是结束分隔符。需要特别注意的是，在上面的示例中，[^#] 不能作为检查以确保不存在结束分隔符，因为单个 # 会导致正则表达式失败（即。“###foo#bar# ##). 在上面要解析的正则表达式的情况下，假设允许使用空标记（如果不允许，请将 * 更改为 +）：

###([^#]|#[^#]|##[^#])*###

# wpf - 公开 DependencyProperty

> ID：76412
> 
> 赞同：18
> 
> 时间：2008-09-16T20:11:42.120
> 
> 标签：wpf, data-binding, user-controls

在开发 WPF UserControls 时，将子控件的 DependencyProperty 公开为 UserControl 的 DependencyProperty 的最佳方法是什么？以下示例显示了我当前如何在 UserControl 中公开 TextBox 的 Text 属性。当然有更好/更简单的方法来实现这一点？

```
 <UserControl x:Class="WpfApplication3.UserControl1"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
        <StackPanel Background="LightCyan">
            <TextBox Margin="8" Text="{Binding Text, RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UserControl}}}" />
        </StackPanel>
    </UserControl> 
```

```
 using System;
    using System.Windows;
    using System.Windows.Controls;

    namespace WpfApplication3
    {
        public partial class UserControl1 : UserControl
        {
            public static DependencyProperty TextProperty = DependencyProperty.Register("Text", typeof(string), typeof(UserControl1), new PropertyMetadata(null));
            public string Text
            {
                get { return GetValue(TextProperty) as string; }
                set { SetValue(TextProperty, value); }
            }

            public UserControl1() { InitializeComponent(); }
        }
    } 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-16T21:06:29.710

这就是我们在团队中的做法，不使用 RelativeSource 搜索，而是通过命名 UserControl 并通过 UserControl 的名称引用属性。

```
<UserControl x:Class="WpfApplication3.UserControl1" x:Name="UserControl1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <StackPanel Background="LightCyan">
        <TextBox Margin="8" Text="{Binding Path=Text, ElementName=UserControl1}" />
    </StackPanel>
</UserControl> 
```

有时我们发现自己做了太多 UserControl 的东西，并且经常缩减我们的使用量。我还遵循按照 PART_TextDisplay 或其他方式命名文本框之类的传统，以便将来您可以将其模板化，但保持代码隐藏相同。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-03T19:04:59.487

您可以在 UserControl 的构造函数中将 DataContext 设置为 this，然后仅通过路径绑定。

CS：

```
DataContext = this; 
```

XAML：

```
<TextBox Margin="8" Text="{Binding Text} /> 
```

# .net - 如何使用 .NET XML API 删除 xmlns 属性

> ID：76424
> 
> 赞同：8
> 
> 时间：2008-09-16T20:13:04.833
> 
> 标签：.net, xml, api, xml-namespaces

XmlElement.Attributes.Remove* 方法适用于任意属性，导致从 XmlDocument.OuterXml 属性中删除已删除的属性。但是 Xmlns 属性是不同的。这是一个例子：

```
XmlDocument doc = new XmlDocument();
doc.InnerXml = @"<Element1 attr1=""value1"" xmlns=""http://mynamespace.com/"" attr2=""value2""/>";
doc.DocumentElement.Attributes.RemoveNamedItem("attr2");
Console.WriteLine("xmlns attr before removal={0}", doc.DocumentElement.Attributes["xmlns"]);
doc.DocumentElement.Attributes.RemoveNamedItem("xmlns");
Console.WriteLine("xmlns attr after removal={0}", doc.DocumentElement.Attributes["xmlns"]); 
```

结果输出是

```
xmlns attr before removal=System.Xml.XmlAttribute
xmlns attr after removal=
<Element1 attr1="value1" xmlns="http://mynamespace.com/" /> 
```

该属性似乎已从 Attributes 集合中删除，但并未从 XmlDocument.OuterXml 中删除。我猜是因为这个属性的特殊含义。

问题是如何使用 .NET XML API 删除 xmlns 属性。显然我可以从这个字符串表示中删除属性，但我想知道是否可以使用 API 做同样的事情。

@Edit：我说的是.NET 2.0。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-02-12T12:05:30.453

非常感谢 Ali Shah，这个帖子完美地解决了我的问题！这是一个 C# 转换：

```
var dom = new XmlDocument();
        dom.Load("C:/ExampleFITrade.xml));
        var loaded = new XDocument();
        if (dom.DocumentElement != null)
            if( dom.DocumentElement.NamespaceURI != String.Empty)
            {
                dom.LoadXml(dom.OuterXml.Replace(dom.DocumentElement.NamespaceURI, ""));
                dom.DocumentElement.RemoveAllAttributes();
                loaded = XDocument.Parse(dom.OuterXml);
            } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T20:51:51.417

.NET DOM API 不支持修改元素的命名空间，而这实际上是您想要做的。因此，为了解决您的问题，您必须以一种或另一种方式构建一个新文档。您可以使用相同的 .NET DOM API 并创建一个新元素，而无需指定其命名空间。或者，您可以创建一个 XSLT 样式表，将您原来的“命名空间”文档转换为一个新文档，其中的元素将不是命名空间限定的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T21:46:26.310

这不应该删除名称空间吗？

```
XmlNamespaceManager mgr = new XmlNamespaceManager("xmlnametable");
mgr.RemoveNamespace("prefix", "uri"); 
```

但无论如何，在这里切线，来自 System.Xml.Linq 命名空间 (.Net 3.0) 的 XElement、XDocument 和[XNameSpace 类比](http://msdn.microsoft.com/en-us/library/system.xml.linq.xnamespace.aspx)旧的 XmlDocument 模型好很多。搏一搏。我上瘾了。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-12-09T16:21:14.037

我在这个线程中看到了各种选项，并来解决我自己的删除 xml 中的 xmlns 属性的解决方案。这工作正常，没有问题：

```
'Remove the Equifax / Transunian / Experian root node attribute that have xmlns and load xml without xmlns attributes.
If objXMLDom.DocumentElement.NamespaceURI <> String.Empty Then
  objXMLDom.LoadXml(objXMLDom.OuterXml.Replace(objXMLDom.DocumentElement.NamespaceURI, ""))
  objXMLDom.DocumentElement.RemoveAllAttributes()
  ResponseXML = objXMLDom.OuterXml
End If 
```

无需执行任何其他操作即可从 xml 中删除 xmlns。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-01-11T22:14:13.190

```
public static string RemoveXmlns(string xml)
{
    //Prepare a reader
    StringReader stringReader = new StringReader(xml);
    XmlTextReader xmlReader = new XmlTextReader(stringReader);
    xmlReader.Namespaces = false; //A trick to handle special xmlns attributes as regular
    //Build DOM
    XmlDocument xmlDocument = new XmlDocument();
    xmlDocument.Load(xmlReader);
    //Do the job
    xmlDocument.DocumentElement.RemoveAttribute("xmlns"); 
    //Prepare a writer
    StringWriter stringWriter = new StringWriter();
    XmlTextWriter xmlWriter = new XmlTextWriter(stringWriter);
    //Optional: Make an output nice ;)
    xmlWriter.Formatting = Formatting.Indented;
    xmlWriter.IndentChar = ' ';
    xmlWriter.Indentation = 2;
    //Build output
    xmlDocument.Save(xmlWriter);
    return stringWriter.ToString();
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T20:20:24.067

是的，因为它是一个 ELEMENT 名称，所以您不能明确删除它。使用 XmlTextWriter 的 WriteStartElement 和 WirteStartAttribute，并用空格替换属性可能会完成工作。

我现在正在检查它。将更新。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T20:35:09.880

也许通过 XmlNamespaceManager ？[http://msdn.microsoft.com/en-us/library/system.xml.xmlnamespacemanager.removenamespace.aspx](http://msdn.microsoft.com/en-us/library/system.xml.xmlnamespacemanager.removenamespace.aspx)但这只是一个猜测。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-10T09:36:19.643

我们可以将 xml 转换为字符串，从该字符串中删除 xmlns，然后使用该字符串创建另一个 XmlDocument，它没有命名空间。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-03-28T18:40:13.003

这是我在 vb.net 上的解决方案！

```
 Dim pathXmlTransformado As String = "C:\Fisconet4\process\11790941000192\2015\3\28\38387-1\38387_transformado.xml"
    Dim nfeXML As New XmlDocument
    Dim loaded As New XDocument

    nfeXML.Load(pathXmlTransformado)

    nfeXML.LoadXml(nfeXML.OuterXml.Replace(nfeXML.DocumentElement.NamespaceURI, ""))
    nfeXML.DocumentElement.RemoveAllAttributes()

    Dim dhCont As XmlNode = nfeXML.CreateElement("dhCont")
    Dim xJust As XmlNode = nfeXML.CreateElement("xJust")
    dhCont.InnerXml = 123
    xJust.InnerXml = 123777

    nfeXML.GetElementsByTagName("ide")(0).AppendChild(dhCont)
    nfeXML.GetElementsByTagName("ide")(0).AppendChild(xJust)

    nfeXML.Save("C:\Fisconet4\process\11790941000192\2015\3\28\38387-1\teste.xml") 
```

# agile - 极限编程

> ID：76440
> 
> 赞同：-3
> 
> 时间：2008-09-16T20:14:37.403
> 
> 标签：agile, extreme-programming

作为开发人员和专业工程师，您是否接触过 Kent Beck 在“版本 1”中定义的极限编程的租户。你觉得这 12 条核心原则中的哪一条被允许实践，或者至少成为你当前工作或其他工作的一部分？

```
* Pair programming[5]
* Planning game
* Test driven development
* Whole team (being empowered to deliver)
* Continuous integration
* Refactoring or design improvement
* Small releases
* Coding standards
* Collective code ownership
* Simple design
* System metaphor
* Sustainable pace 
```

从工程师的角度来看，我觉得 XP 的主要工程原理远远优于我所参与的任何其他工作。您的意见是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T20:25:03.900

我们正在遵循您提到的这些做法：

*   规划游戏
*   测试驱动开发
*   整个团队（被授权交付）
*   持续集成
*   重构或设计改进
*   小版本
*   编码标准
*   集体代码所有权
*   简单的设计

我必须说，一年后我无法想象以不同的方式工作。

至于结对编程，我必须说它在某些领域是有意义的，那里有一个非常困难的领域，或者最初的良好设计是必不可少的（例如设计界面）。但是我不认为这是非常有效的。在我看来，最好对较小的部分进行代码和设计审查，而结对编程在这方面是有意义的。

至于“整体团队”的做法，我必须承认，随着我们团队的成长，它受到了影响。它只是让计划会议时间过长，每个人都可以提供他的个人意见。目前，一个核心团队正在通过一些初步的、粗略的规划来准备规划游戏。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T20:22:38.663

我认为自己很幸运，除了“结对编程”之外，我们都可以做到，但只是为了解决大问题，而不是在日常基础上。“集体代码所有权”也很难实现，如果不进行结对编程，我们倾向于在迭代中保持逻辑下一个用户故事。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-18T13:57:37.260

除了小版本之外，我们已经完成了所有工作，这很棒。我无法想象以其他方式工作。根据我的经验，我最看重的原则是：

*   持续集成（使用可靠的测试套件）。
*   集体代码所有权。
*   TDD
*   团队授权和决策。
*   编码标准。
*   重构。
*   可持续的步伐。

其余的也很好，但我发现只要我们有 TDD、集体所有权和重构，我就可以在没有配对的情况下生活。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T21:06:43.377

*   整个团队（被授权交付）
*   小版本
*   编码标准
*   集体代码所有权

但是，我确实在一个相当保守的关键任务开发团队工作。我不一定认为 XP 是一种很好的开发方式，您必须找到适合您的方式并忽略教条。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-04-04T22:56:24.227

*   结对编程[5]

在这方面很难说服管理层。但是我发现当工程师遇到困难或者我们有一个对技术或工作不熟悉的工程师时，这是可行的。

*   规划游戏

是的。

*   测试驱动开发

易于销售给管理层。然而，一些管理的困难部分是增加更多的时间。许多经理认为极限和敏捷编程将节省他们的时间。他们不会节省时间给你送东西。事实上，测试不断的需求收集增加了工作量。它的作用是让客户更快地得到他们想要的东西。

*   整个团队（被授权交付）

毫无疑问，这对 Xtreme 来说是一个了不起的方面。

*   持续集成

在每次迭代（冲刺）结束时，会发生完全集成。不会发生每日完全集成。

*   重构或设计改进

你的第一次努力很少是最好的。所以是的，我发现 Xtreme 不断产生越来越好的解决方案。

*   小版本

我发现考虑到基础设施和资源可以延长建议的 1 或 2 周迭代长度。这在很大程度上取决于您要部署到的位置。如果您的系统被部署到生产环境中，正式系统和压力测试会增加很多开销。因此，在这种环境下，我们会进行持续一个月甚至 2 个月的迭代。如果系统正在部署到开发区域并且尚未部署到生产环境，那么即使像持续 1 天的迭代一样紧凑也是可行的。

*   编码标准

新团队成员的结对编程可以促进这一点。代码审查在这里也可以提供帮助。这在很大程度上取决于你们彼此合作了多长时间。

*   集体代码所有权

我还没有发现 Xtreme 在这里真的有帮助。每个人都自然而然地落入代码库的某些领域。因此，人们获得了他们花费大量时间的事物的所有权。这实际上可以是一个很好的驱动程序，因为优秀的软件工程师会为他们以这种方式编写的内容感到自豪。

*   简单的设计

事实上，较短的迭代周期确实促进了简单的设计。它需要在短期版本中保持可维护性。

*   系统隐喻

不知道这里是什么意思？

*   可持续步伐

团队的速度是一项只能通过适当的指标进行敏锐估计的任务。需要保留有关任务估计和任务完成持续时间的指标。

# c# - 如何更改组框边框的颜色？

> ID：76455
> 
> 赞同：34
> 
> 时间：2008-09-16T20:16:02.593
> 
> 标签：c#, winforms, user-interface, controls, groupbox

在 C#.NET 中，我试图以编程方式更改组框中边框的颜色。

更新：在我们切换到 .NET 之前，当我在 winforms 系统上工作时，有人问过这个问题。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2013-11-18T07:10:51.350

只需添加绘画事件。

```
 private void groupBox1_Paint(object sender, PaintEventArgs e)
    {
        GroupBox box = sender as GroupBox;
        DrawGroupBox(box, e.Graphics, Color.Red, Color.Blue);
    }

    private void DrawGroupBox(GroupBox box, Graphics g, Color textColor, Color borderColor)
    {
        if (box != null)
        {
            Brush textBrush = new SolidBrush(textColor);
            Brush borderBrush = new SolidBrush(borderColor);
            Pen borderPen = new Pen(borderBrush);
            SizeF strSize = g.MeasureString(box.Text, box.Font);
            Rectangle rect = new Rectangle(box.ClientRectangle.X,
                                           box.ClientRectangle.Y + (int)(strSize.Height / 2),
                                           box.ClientRectangle.Width - 1,
                                           box.ClientRectangle.Height - (int)(strSize.Height / 2) - 1);

            // Clear text and border
            g.Clear(this.BackColor);

            // Draw text
            g.DrawString(box.Text, box.Font, textBrush, box.Padding.Left, 0);

            // Drawing Border
            //Left
            g.DrawLine(borderPen, rect.Location, new Point(rect.X, rect.Y + rect.Height));
            //Right
            g.DrawLine(borderPen, new Point(rect.X + rect.Width, rect.Y), new Point(rect.X + rect.Width, rect.Y + rect.Height));
            //Bottom
            g.DrawLine(borderPen, new Point(rect.X, rect.Y + rect.Height), new Point(rect.X + rect.Width, rect.Y + rect.Height));
            //Top1
            g.DrawLine(borderPen, new Point(rect.X, rect.Y), new Point(rect.X + box.Padding.Left, rect.Y));
            //Top2
            g.DrawLine(borderPen, new Point(rect.X + box.Padding.Left + (int)(strSize.Width), rect.Y), new Point(rect.X + rect.Width, rect.Y));
        }
    } 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2011-04-29T02:12:52.813

基于上一个答案，一个更好的解决方案，包括组框的标签：

```
groupBox1.Paint += PaintBorderlessGroupBox;

private void PaintBorderlessGroupBox(object sender, PaintEventArgs p)
{
  GroupBox box = (GroupBox)sender;
  p.Graphics.Clear(SystemColors.Control);
  p.Graphics.DrawString(box.Text, box.Font, Brushes.Black, 0, 0);
} 
```

您可能想调整文本的 x/y，但对于我的使用来说，这是正确的。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-11-30T21:32:05.693

只需将任何对象（不仅仅是按钮）上的绘制动作设置为此方法即可绘制边框。

```
 private void UserControl1_Paint(object sender, PaintEventArgs e)
    {
        ControlPaint.DrawBorder(e.Graphics, this.ClientRectangle, Color.Red, ButtonBorderStyle.Solid);

    } 
```

它仍然不会像原来的那样漂亮和圆润，但它要简单得多。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2018-08-02T23:35:57.750

FWIW，这是我使用的实现。它是 GroupBox 的子对象，但不仅可以设置 BorderColor，还可以设置边框的粗细和圆角的半径。此外，您可以为 GroupBox 标签设置所需的缩进量，并使用右侧的负缩进缩进。

```
using System;
using System.Drawing;
using System.Windows.Forms;

namespace BorderedGroupBox
{
    public class BorderedGroupBox : GroupBox
    {
        private Color _borderColor = Color.Black;
        private int _borderWidth = 2;
        private int _borderRadius = 5;
        private int _textIndent = 10;

        public BorderedGroupBox() : base()
        {
            InitializeComponent();
            this.Paint += this.BorderedGroupBox_Paint;
        }

        public BorderedGroupBox(int width, float radius, Color color) : base()
        {
            this._borderWidth = Math.Max(1,width);
            this._borderColor = color;
            this._borderRadius = Math.Max(0,radius);
            InitializeComponent();
            this.Paint += this.BorderedGroupBox_Paint;
        }

        public Color BorderColor
        {
            get => this._borderColor;
            set
            {
                this._borderColor = value;
                DrawGroupBox();
            }
        }

        public int BorderWidth
        {
            get => this._borderWidth;
            set
            {
                if (value > 0)
                {
                    this._borderWidth = Math.Min(value, 10);
                    DrawGroupBox();
                }
            }
        }

        public int BorderRadius
        {
            get => this._borderRadius;
            set
            {   // Setting a radius of 0 produces square corners...
                if (value >= 0)
                {
                    this._borderRadius = value;
                    this.DrawGroupBox();
                }
            }
        }

        public int LabelIndent
        {
            get => this._textIndent;
            set
            {
                this._textIndent = value;
                this.DrawGroupBox();
            }
        }

        private void BorderedGroupBox_Paint(object sender, PaintEventArgs e) =>
            DrawGroupBox(e.Graphics);

        private void DrawGroupBox() =>
            this.DrawGroupBox(this.CreateGraphics());

        private void DrawGroupBox(Graphics g)
        {
            Brush textBrush = new SolidBrush(this.ForeColor);
            SizeF strSize = g.MeasureString(this.Text, this.Font);

            Brush borderBrush = new SolidBrush(this.BorderColor);
            Pen borderPen = new Pen(borderBrush,(float)this._borderWidth);
            Rectangle rect = new Rectangle(this.ClientRectangle.X,
                                            this.ClientRectangle.Y + (int)(strSize.Height / 2),
                                            this.ClientRectangle.Width - 1,
                                            this.ClientRectangle.Height - (int)(strSize.Height / 2) - 1);

            Brush labelBrush = new SolidBrush(this.BackColor);

            // Clear text and border
            g.Clear(this.BackColor);

            // Drawing Border (added "Fix" from Jim Fell, Oct 6, '18)
            int rectX = (0 == this._borderWidth % 2) ? rect.X + this._borderWidth / 2 : rect.X + 1 + this._borderWidth / 2;
            int rectHeight = (0 == this._borderWidth % 2) ? rect.Height - this._borderWidth / 2 : rect.Height - 1 - this._borderWidth / 2;
            // NOTE DIFFERENCE: rectX vs rect.X and rectHeight vs rect.Height
            g.DrawRoundedRectangle(borderPen, rectX, rect.Y, rect.Width, rectHeight, (float)this._borderRadius);

            // Draw text
            if (this.Text.Length > 0)
            {
                // Do some work to ensure we don't put the label outside
                // of the box, regardless of what value is assigned to the Indent:
                int width = (int)rect.Width, posX;
                posX = (this._textIndent < 0) ? Math.Max(0-width,this._textIndent) : Math.Min(width, this._textIndent);
                posX = (posX < 0) ? rect.Width + posX - (int)strSize.Width : posX;
                g.FillRectangle(labelBrush, posX, 0, strSize.Width, strSize.Height);
                g.DrawString(this.Text, this.Font, textBrush, posX, 0);
            }
        }

        #region Component Designer generated code
        /// <summary>Required designer variable.</summary>
        private System.ComponentModel.IContainer components = null;

        /// <summary>Clean up any resources being used.</summary>
        /// <param name="disposing">true if managed resources should be disposed; otherwise, false.</param>
        protected override void Dispose(bool disposing)
        {
            if (disposing && (components != null))
                components.Dispose();

            base.Dispose(disposing);
        }

        /// <summary>Required method for Designer support - Don't modify!</summary>
        private void InitializeComponent() => components = new System.ComponentModel.Container();
        #endregion
    }
} 
```

要使其工作，您还必须扩展基本 Graphics 类（注意：这是从我在尝试创建圆角面板控件时发现的一些代码派生的，但我找不到原始帖子在此处链接）：

```
static class GraphicsExtension
{
    private static GraphicsPath GenerateRoundedRectangle(
        this Graphics graphics,
        RectangleF rectangle,
        float radius)
    {
        float diameter;
        GraphicsPath path = new GraphicsPath();
        if (radius <= 0.0F)
        {
            path.AddRectangle(rectangle);
            path.CloseFigure();
            return path;
        }
        else
        {
            if (radius >= (Math.Min(rectangle.Width, rectangle.Height)) / 2.0)
                return graphics.GenerateCapsule(rectangle);
            diameter = radius * 2.0F;
            SizeF sizeF = new SizeF(diameter, diameter);
            RectangleF arc = new RectangleF(rectangle.Location, sizeF);
            path.AddArc(arc, 180, 90);
            arc.X = rectangle.Right - diameter;
            path.AddArc(arc, 270, 90);
            arc.Y = rectangle.Bottom - diameter;
            path.AddArc(arc, 0, 90);
            arc.X = rectangle.Left;
            path.AddArc(arc, 90, 90);
            path.CloseFigure();
        }
        return path;
    }

    private static GraphicsPath GenerateCapsule(
        this Graphics graphics,
        RectangleF baseRect)
    {
        float diameter;
        RectangleF arc;
        GraphicsPath path = new GraphicsPath();
        try
        {
            if (baseRect.Width > baseRect.Height)
            {
                diameter = baseRect.Height;
                SizeF sizeF = new SizeF(diameter, diameter);
                arc = new RectangleF(baseRect.Location, sizeF);
                path.AddArc(arc, 90, 180);
                arc.X = baseRect.Right - diameter;
                path.AddArc(arc, 270, 180);
            }
            else if (baseRect.Width < baseRect.Height)
            {
                diameter = baseRect.Width;
                SizeF sizeF = new SizeF(diameter, diameter);
                arc = new RectangleF(baseRect.Location, sizeF);
                path.AddArc(arc, 180, 180);
                arc.Y = baseRect.Bottom - diameter;
                path.AddArc(arc, 0, 180);
            }
            else path.AddEllipse(baseRect);
        }
        catch { path.AddEllipse(baseRect); }
        finally { path.CloseFigure(); }
        return path;
    }

    /// <summary>
    /// Draws a rounded rectangle specified by a pair of coordinates, a width, a height and the radius
    /// for the arcs that make the rounded edges.
    /// </summary>
    /// <param name="brush">System.Drawing.Pen that determines the color, width and style of the rectangle.</param>
    /// <param name="x">The x-coordinate of the upper-left corner of the rectangle to draw.</param>
    /// <param name="y">The y-coordinate of the upper-left corner of the rectangle to draw.</param>
    /// <param name="width">Width of the rectangle to draw.</param>
    /// <param name="height">Height of the rectangle to draw.</param>
    /// <param name="radius">The radius of the arc used for the rounded edges.</param>
    public static void DrawRoundedRectangle(
        this Graphics graphics,
        Pen pen,
        float x,
        float y,
        float width,
        float height,
        float radius)
    {
        RectangleF rectangle = new RectangleF(x, y, width, height);
        GraphicsPath path = graphics.GenerateRoundedRectangle(rectangle, radius);
        SmoothingMode old = graphics.SmoothingMode;
        graphics.SmoothingMode = SmoothingMode.AntiAlias;
        graphics.DrawPath(pen, path);
        graphics.SmoothingMode = old;
    }

    /// <summary>
    /// Draws a rounded rectangle specified by a pair of coordinates, a width, a height and the radius
    /// for the arcs that make the rounded edges.
    /// </summary>
    /// <param name="brush">System.Drawing.Pen that determines the color, width and style of the rectangle.</param>
    /// <param name="x">The x-coordinate of the upper-left corner of the rectangle to draw.</param>
    /// <param name="y">The y-coordinate of the upper-left corner of the rectangle to draw.</param>
    /// <param name="width">Width of the rectangle to draw.</param>
    /// <param name="height">Height of the rectangle to draw.</param>
    /// <param name="radius">The radius of the arc used for the rounded edges.</param>

    public static void DrawRoundedRectangle(
        this Graphics graphics,
        Pen pen,
        int x,
        int y,
        int width,
        int height,
        int radius)
    {
        graphics.DrawRoundedRectangle(
            pen,
            Convert.ToSingle(x),
            Convert.ToSingle(y),
            Convert.ToSingle(width),
            Convert.ToSingle(height),
            Convert.ToSingle(radius));
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-04-12T03:06:56.343

我不确定这是否适用于所有情况，但多亏了这个线程，我们使用以下方式快速以编程方式连接到 Paint 事件：

```
GroupBox box = new GroupBox();
[...]
box.Paint += delegate(object o, PaintEventArgs p)
{
    p.Graphics.Clear(someColorHere);
}; 
```

干杯!

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-05-21T15:19:03.450

我已经实现了与新手可能更容易理解的东西相同的边界：

```
 private void groupSchitaCentru_Paint(object sender, PaintEventArgs e)
    {
        Pen blackPen = new Pen(Color.Black, 2);
        Point pointTopLeft = new Point(0, 7);
        Point pointBottomLeft = new Point(0, groupSchitaCentru.ClientRectangle.Height);
        Point pointTopRight = new Point(groupSchitaCentru.ClientRectangle.Width, 7);
        Point pointBottomRight = new Point(groupSchitaCentru.ClientRectangle.Width, groupSchitaCentru.ClientRectangle.Height);

        e.Graphics.DrawLine(blackPen, pointTopLeft, pointBottomLeft);
        e.Graphics.DrawLine(blackPen, pointTopLeft, pointTopRight);
        e.Graphics.DrawLine(blackPen, pointBottomRight, pointTopRight);
        e.Graphics.DrawLine(blackPen, pointBottomLeft, pointBottomRight);
    } 
```

1.  在 GroupBox 控件上设置 Paint 事件。在此示例中，我的控件的名称是“groupSchitaCentru”。因为它的参数 e 需要这个事件。
2.  通过使用 System.Drawing.Pen 类设置笔对象：[https ://msdn.microsoft.com/en-us/library/f956fzw1(v=vs.110).aspx](https://msdn.microsoft.com/en-us/library/f956fzw1(v=vs.110).aspx)
3.  设置表示控件表示的矩形的角的点。使用控件的属性 ClientRectangle 来获取其尺寸。我使用 TopLeft (0,7) 因为我想尊重控件的边框，并围绕其文本画线。要获取有关坐标系统的更多信息，请访问此处：[https ://docs.microsoft.com/en-us/dotnet/framework/winforms/windows-forms-coordinates](https://docs.microsoft.com/en-us/dotnet/framework/winforms/windows-forms-coordinates)

我不知道，这可能有助于寻求实现这种边界调整的人。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-08-07T10:30:12.790

对 Jim Fell 的代码进行的这个调整让我的边框更好一些，但是添加为注释太长了

...

```
 Rectangle rect = new Rectangle(this.ClientRectangle.X,
                                        this.ClientRectangle.Y + (int)(strSize.Height / 2),
                                        this.ClientRectangle.Width,
                                        this.ClientRectangle.Height - (int)(strSize.Height / 2));

    Brush labelBrush = new SolidBrush(this.BackColor);

    // Clear text and border
    g.Clear(this.BackColor);

    int drawX = rect.X;
    int drawY = rect.Y;
    int drawWidth = rect.Width;
    int drawHeight = rect.Height;

    if (this._borderWidth > 0)
    {
        drawX += this._borderWidth / 2;
        drawY += this._borderWidth / 2;

        drawWidth -= this._borderWidth;
        drawHeight -= this._borderWidth;

        if (this._borderWidth % 2 == 0)
        {
            drawX -= 1;
            drawWidth += 1;

            drawY -= 1;
            drawHeight += 1;
        }
    }

    g.DrawRoundedRectangle(borderPen, drawX, drawY, drawWidth, drawHeight, (float)this._borderRadius); 
```

# asp.net - 创建使用最终用户可修改模板的 DNN 模块

> ID：76464
> 
> 赞同：1
> 
> 时间：2008-09-16T20:16:39.097
> 
> 标签：asp.net, module, dotnetnuke

我想在 DNN 中创建一个模块，类似于 Announcements 控件，它提供了一个模板，门户管理员可以修改该模板以进行格式化。我有一个控件，该控件当前使用带有模板的 Repeater 控件。有没有办法覆盖转发器 ItemTemplate、HeaderTemplate 和 FooterTemplate 属性的内容？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T05:34:37.243

您可以通过多种不同的方式来完成此操作，通常最好/最简单的方式是简单地将文字控件放入 Header、Footer 和 Item 模板中。然后处理 ItemDataBound 事件，您可以查看项目类型并对其执行特定操作以加载所需的数据。

如果您想查看此模型的一些实现，您可以下载我的可扩展文本/HTML 模块的代码，以及我的 Guesbook 模块，两者均免费提供，无需登录[http://www.iowacomputergurus.com](http://www.iowacomputergurus.com)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T11:56:15.283

您可以在默认的 Starertkit 模块、FAQ 模块、存储库模块和 UDT 中看到模板示例。所有这些都具有不同级别的模板控制。

# ruby - 在 Windows 上检查 Ruby 中的文件版本

> ID：76472
> 
> 赞同：11
> 
> 时间：2008-09-16T20:17:13.183
> 
> 标签：ruby, file, dll, version

Ruby 中有没有办法找到文件的版本，特别是 .dll 文件？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-16T21:41:25.883

对于 Windows EXE 和 DLL：

```
require "Win32API"
FILENAME = "c:/ruby/bin/ruby.exe" #your filename here
s=""
vsize=Win32API.new('version.dll', 'GetFileVersionInfoSize', 
                   ['P', 'P'], 'L').call(FILENAME, s)
p vsize
if (vsize > 0)
  result = ' '*vsize
  Win32API.new('version.dll', 'GetFileVersionInfo', 
               ['P', 'L', 'L', 'P'], 'L').call(FILENAME, 0, vsize, result)
  rstring = result.unpack('v*').map{|s| s.chr if s<256}*''
  r = /FileVersion..(.*?)\000/.match(rstring)
  puts "FileVersion = #{r ? r[1] : '??' }"
else
  puts "No Version Info"
end 
```

'unpack'+regexp 部分是 hack，“正确”的方式是 VerQueryValue API，但这应该适用于大多数文件。（可能在扩展字符集上失败得很惨。）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-27T00:13:26.540

如果您想使用 ruby​​ 获取版本信息，但 ruby​​ 代码没有在 Windows 上运行怎么办？

以下就是这样做的（注意相同的扩展字符集警告）：

```
#!/usr/bin/ruby

s = File.read(ARGV[0])
x = s.match(/F\0i\0l\0e\0V\0e\0r\0s\0i\0o\0n\0*(.*?)\0\0\0/)

if x.class == MatchData
  ver=x[1].gsub(/\0/,"")
else
  ver="No version"
end

puts ver 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-16T20:38:52.197

如果您在 Microsoft 平台上工作，您应该能够使用 Ruby 中的 Win32 API 调用 GetFileVersionInfo()，它将返回您正在寻找的信息。 [http://msdn.microsoft.com/en-us/library/ms647003.aspx](http://msdn.microsoft.com/en-us/library/ms647003.aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-06-12T14:58:30.073

从 Ruby 2.0 开始，该`DL`模块已被弃用。这是使用[Fiddle](http://www.ruby-doc.org/stdlib-2.0/libdoc/fiddle/rdoc/Fiddle.html)的 AShelly 答案的更新版本：

```
version_dll = Fiddle.dlopen('version.dll')

s=''
vsize = Fiddle::Function.new(version_dll['GetFileVersionInfoSize'],
            [Fiddle::TYPE_VOIDP, Fiddle::TYPE_VOIDP],
            Fiddle::TYPE_LONG).call(filename, s)

raise 'Unable to determine the version number' unless vsize > 0

result = ' '*vsize
Fiddle::Function.new(version_dll['GetFileVersionInfo'],
                     [Fiddle::TYPE_VOIDP, Fiddle::TYPE_LONG,
                      Fiddle::TYPE_LONG, Fiddle::TYPE_VOIDP],
        Fiddle::TYPE_VOIDP).call(filename, 0, vsize, result)

rstring = result.unpack('v*').map{|s| s.chr if s<256}*''
r = /FileVersion..(.*?)\000/.match(rstring)

puts r[1] 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T20:23:20.860

对于任何文件，您都需要发现文件的格式，然后打开文件并读取必要的字节以找出文件的版本。Ruby 中没有确定文件版本的 API 或通用方法。

请注意，如果文件版本在文件名中会更容易。

# encoding - Powershell：为获取内容管道设置编码

> ID：76482
> 
> 赞同：47
> 
> 时间：2008-09-16T20:18:26.973
> 
> 标签：encoding, powershell

我有一个保存为 UCS-2 Little Endian 的文件我想更改编码，所以我运行了以下代码：

```
cat tmp.log -encoding UTF8 > new.log 
```

生成的文件仍在 UCS-2 Little Endian 中。这是因为管道总是采用这种格式吗？有没有一种简单的方法可以将它作为 UTF8 传输到新文件？

* * *

## 回答 #1

> 赞同：57
> 
> 时间：2008-09-16T20:41:58.397

正如[这里](https://stackoverflow.com/questions/64860/best-way-to-convert-text-files-between-character-sets#64937)所建议的：

```
Get-Content tmp.log | Out-File -Encoding UTF8 new.log 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2008-09-16T20:36:07.133

我会这样做：

```
get-content tmp.log -encoding Unicode | set-content new.log -encoding UTF8 
```

我的理解是 -encoding 选项选择文件应该被读取或写入的编码。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2014-06-05T10:33:39.197

使用编码从 xml 文件加载内容。

(Get-Content -Encoding UTF8 $fileName)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-07-20T16:45:37.233

如果您正在读取 XML 文件，这里有一个更好的方法来适应您的 XML 文件的编码：

```
$xml = New-Object -Typename XML
$xml.load('foo.xml') 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-05-24T20:20:11.367

PowerShell 的 get-content/set-content 编码标志不处理所有编码类型。您可能需要使用 IO.File，例如使用 Windows-1252 加载文件：

```
$myString = [IO.File]::ReadAllText($filePath, [Text.Encoding]::GetEncoding(1252)) 
```

[Text.Encoding::GetEncoding](https://docs.microsoft.com/en-us/dotnet/api/system.text.encoding.getencoding?view=net-5.0) [Text.Encoding::GetEncodings](https://docs.microsoft.com/en-us/dotnet/api/system.text.encoding.getencodings?view=net-5.0)

# mobile - 如何判断一个进程是否在移动设备上运行

> ID：76484
> 
> 赞同：0
> 
> 时间：2008-09-16T20:18:35.223
> 
> 标签：mobile, process, native, pocketpc, evc

我在 Pocket PC 2003 设备上有进程“A”的句柄。我需要确定该进程是否仍在从进程“B”运行。进程“B”是用 Embedded Visual C++ 4.0 编写的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T20:43:26.833

如果调用函数时进程正在运行，GetExitCodeProcess 将返回 STILL_ACTIVE。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T00:49:29.690

进程句柄是可等待的。当进程退出时，它们会收到信号 - 将释放任何等待的线程。您可以将它们与 WaitForSingleObject、WaitForMultipleObjects 等一起使用。

# mysql - 将 MySQL 与实体框架一起使用

> ID：76488
> 
> 赞同：268
> 
> 时间：2008-09-16T20:18:50.747
> 
> 标签：mysql, .net, entity-framework, ado.net

在 Google 上找不到任何有关 Entity Framework/MySQL 的信息，所以我希望有人知道。

* * *

## 回答 #1

> 赞同：192
> 
> 时间：2009-05-11T15:02:03.860

它已发布 - 获取[.Net v6.5 的 MySQL 连接器](http://www.mysql.com/downloads/connector/net)- 这支持 [Entity Framework]

我一直在等待这个，虽然支持是基本的，但适用于数据库交互的大多数基本场景。它还具有基本的 Visual Studio 集成。

**更新** [http://dev.mysql.com/downloads/connector/net/](http://dev.mysql.com/downloads/connector/net/) 从 6.7 版开始，Connector/Net 将不再包含 MySQL for Visual Studio 集成。该功能现在可在名为 MySQL for Visual Studio 的单独产品中使用，该产品可使用 Windows 的 MySQL 安装程序（请参阅[http://dev.mysql.com/tech-resources/articles/mysql-installer-for-windows.html](http://dev.mysql.com/tech-resources/articles/mysql-installer-for-windows.html)）。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-04-03T03:12:49.863

看看我关于这个主题的帖子。

[http://pattersonc.com/blog/index.php/2009/04/01/using-mysql-with-entity-framework-and-aspnet-mvc-–-part-i/](http://pattersonc.com/blog/index.php/2009/04/01/using-mysql-with-entity-framework-and-aspnet-mvc-%e2%80%93-part-i/)

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-28T13:20:23.440

MySQL 将在几天内举办一次关于 EF 的网络研讨会……看这里：[http ://www.mysql.com/news-and-events/web-seminars/display-204.html](http://www.mysql.com/news-and-events/web-seminars/display-204.html)

**编辑：**该网络研讨会现在位于[http://www.mysql.com/news-and-events/on-demand-webinars/display-od-204.html](http://www.mysql.com/news-and-events/on-demand-webinars/display-od-204.html)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-03-25T00:27:54.253

这与 MS 和他们想要的无关。他们为其他人创建了一个*开放系统以插入“提供者”-postgres 和 sqlite 拥有它-mysql 只是滞后...但是，对于那些感兴趣的人来说是个好消息，我也在寻找这个并发现 MySql 连接器/Net 6.0 将拥有它...您可以在这里查看：

[http://www.upfromthesky.com/blog/post/2009/03/24/MySql-Supports-the-Entity-Framework.aspx](http://www.upfromthesky.com/blog/post/2009/03/24/MySql-Supports-the-Entity-Framework.aspx)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-16T20:32:12.913

您将需要 MySQL 的映射提供程序。这是 Entity Framework 需要额外的东西才能让魔法发生。[这篇博客](http://blogs.msdn.com/adonet/)讨论了除了微软提供的地图供应商之外的其他地图供应商。我还没有发现任何关于 MySQL 的提及。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-11-06T11:36:00.397

文塔纳，

奇怪的是，现在有些东西已经准备好了。[http://www.devart.com/products.html](http://www.devart.com/products.html) - 虽然它是商业的（你有一个 30 天的试用 IIRC）。他们以写作提供者为生，所以我想它应该又快又稳定。我知道真正的大公司使用他们的 Oracle 供应商而不是 Orace 和 MS 供应商。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-06-05T07:20:19.113

您还可以查看[https://www.devart.com/dotconnect/mysql/](https://www.devart.com/dotconnect/mysql/)

DevArt 的连接器支持 EF 和 MySQL。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-04-27T15:58:36.573

小心使用连接器 .net，连接器 6.6.5 有一个错误，它不适用于插入 tinyint 值作为标识，例如：

```
create table person(
    Id tinyint unsigned primary key auto_increment,
    Name varchar(30)
); 
```

如果您尝试插入这样的对象：

```
Person p;
p = new Person();
p.Name = 'Oware'
context.Person.Add(p);
context.SaveChanges(); 
```

你会得到一个空引用异常：

```
Referencia a objeto no establecida como instancia de un objeto.:
   en MySql.Data.Entity.ListFragment.WriteSql(StringBuilder sql)
   en MySql.Data.Entity.SelectStatement.WriteSql(StringBuilder sql)
   en MySql.Data.Entity.InsertStatement.WriteSql(StringBuilder sql)
   en MySql.Data.Entity.SqlFragment.ToString()
   en MySql.Data.Entity.InsertGenerator.GenerateSQL(DbCommandTree tree)
   en MySql.Data.MySqlClient.MySqlProviderServices.CreateDbCommandDefinition(DbProviderManifest providerManifest, DbCommandTree commandTree)
   en System.Data.Common.DbProviderServices.CreateCommandDefinition(DbCommandTree commandTree)
   en System.Data.Common.DbProviderServices.CreateCommand(DbCommandTree commandTree)
   en System.Data.Mapping.Update.Internal.UpdateTranslator.CreateCommand(DbModificationCommandTree commandTree)
   en System.Data.Mapping.Update.Internal.DynamicUpdateCommand.CreateCommand(UpdateTranslator translator, Dictionary`2 identifierValues)
   en System.Data.Mapping.Update.Internal.DynamicUpdateCommand.Execute(UpdateTranslator translator, EntityConnection connection, Dictionary`2 identifierValues, List`1 generatedValues)
   en System.Data.Mapping.Update.Internal.UpdateTranslator.Update(IEntityStateManager stateManager, IEntityAdapter adapter)
   en System.Data.EntityClient.EntityAdapter.Update(IEntityStateManager entityCache)
   en System.Data.Objects.ObjectContext.SaveChanges(SaveOptions options)
   en System.Data.Entity.Internal.InternalContext.SaveChanges()
   en System.Data.Entity.Internal.LazyInternalContext.SaveChanges()
   en System.Data.Entity.DbContext.SaveChanges() 
```

直到现在我还没有找到解决方案，我不得不将我的 tinyint 身份更改为 unsigned int 身份，这解决了问题，但这不是正确的解决方案。

如果您使用较旧版本的 Connector.net（我使用的是 6.4.4），则不会出现此问题。

如果有人知道解决方案，请与我联系。

干杯!

尾件

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-07-13T18:32:47.210

我没有看到这里的链接，但是有一个用于 MySql 的 beta .NET 连接器。点击“Development Releases”下载6.3.2 beta，集成EF4/VS2010：

[http://dev.mysql.com/downloads/connector/net/5.0.html#downloads](http://dev.mysql.com/downloads/connector/net/5.0.html#downloads)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-04-07T09:09:54.580

如果您有兴趣在 mono/linux/macos 上使用 MySql 运行实体框架，这可能会有所帮助 [https://iyalovoi.wordpress.com/2015/04/06/entity-framework-with-mysql-on-mac-os/](https://iyalovoi.wordpress.com/2015/04/06/entity-framework-with-mysql-on-mac-os/)

# .net - 我的 C# .NET 团队是否应该迁移到 Windows Presentation Foundation？

> ID：76522
> 
> 赞同：15
> 
> 时间：2008-09-16T20:21:10.943
> 
> 标签：.net, wpf

我们为一家商业银行提供基础设施服务（数据检索和存储）和小型智能客户端应用程序（主要是花式报告）。我们的团队很大，有 40 多名合同工，都是 C# .NET 程序员。我们支持我们开发的 50 多种应用程序和系统。

团队的一些成员开始制作基于[WPF](http://en.wikipedia.org/wiki/Windows_Presentation_Foundation)、[WF](http://en.wikipedia.org/wiki/Windows_Workflow_Foundation)和[WCF](http://en.wikipedia.org/wiki/Windows_Communication_Foundation)的应用程序。鉴于他们是第一个，大多数成员不了解这些技术。他们传达的哪些好处可以克服重新培训团队的成本？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-16T20:42:29.333

我们刚刚结束了一个项目，其中我和其他 4 人开发了一个相当成功的分布式企业应用程序。我们开始使用 Win32，然后在第一次迭代后切换到 WPF，以满足我们可用性专家的需求。这是我的经验。

WPF 有一些非常非常棒的特性。一般来说，它使真正困难的事情变得微不足道（例如创建显示丰富演示数据的列表框，例如与表格混合的图像、副本等），但反过来又可以使“这在 Win32 中变得如此简单”痛苦地令人沮丧。我已经在 WPF 中工作了 6 个月，但我仍然发现将组合框数据绑定到 XML 数据提供者是一种可怕的体验。

正如我上面所提到的，WPF 有一些很棒的和不太好的绑定。我喜欢如何使用[XPath](http://en.wikipedia.org/wiki/XPath)绑定到 XML 文档或内联片段，但我讨厌如果您的绑定是双向的，那么您只能使用内置绑定验证（而且我非常讨厌您不能强制内置绑定验证将用户输入传递回对象，即使数据超出某些业务规则的范围）。

WPF 有一个巨大的学习曲线。它甚至不是曲线——它是一堵墙。这是一个艰难的过程。这是一种完全不同的使用 Windows 演示文稿的方式，而且，无论如何，对我来说，在我开始感到有点舒服之前，它需要大量的阅读和播放。[这不是世界上最简单的事情，但它允许您做一些非常强大的事情（例如，在我们的项目中，我创建了一个表单引擎，它使用大约 300 行XSLT](http://en.wikipedia.org/wiki/XSLT)从 XML 创建完整的 XAML 表单- 完成了完整的绑定和验证）。

总体而言，我对我们选择 XAML 感到非常满意，尽管学习曲线、这一切都有些错误的性质以及一些深刻的挫败感。积极的一面远远超过了消极的一面，它让我们可以做一些我认为不可能的事情，而不会对性能造成巨大的影响。

如果你决定走 WPF 的路线，我强烈推荐这两本书：

*   Windows Presentation Foundation Unleashed，作者 Adam Nathan 是一个很棒的介绍，全彩！它读起来像一个博客，给你一个很棒的介绍 - [http://www.amazon.ca/Windows-Presentation-Foundation-Unleashed-WPF/dp/0672328917/ref=pd_ys_iyr3](http://www.amazon.ca/Windows-Presentation-Foundation-Unleashed-WPF/dp/0672328917/ref=pd_ys_iyr3)

*   编程 WPF：使用 Windows Presentation Foundation 构建 Windows Ui，作者：Chris Sells。WPF Unleashed 附带的更多详细信息和一本好书 - [http://www.amazon.co.uk/Programming-WPF-Building-Presentation-Foundation/dp/0596510373](http://www.amazon.co.uk/Programming-WPF-Building-Presentation-Foundation/dp/0596510373)

祝你好运！

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-16T20:24:43.960

WPF UI 比当前的 C# 替代方案更易于设计实现和维护，因此如果您的许多代码库负责处理 UI，迁移可能会带来好处——例如，您会发现您的团队将节省处理他们的时间界面层。如果您的大部分代码都是业务逻辑，那么它不会有太大帮助。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-09-17T02:05:38.213

WPF 使您能够做一些令人惊奇的事情，我喜欢它……但是，每当开发人员问我是否认为他们应该转向新技术时，我总是觉得有义务证明我的建议。

您的开发人员是否愿意（最好是 EAGER）花时间学习有效地使用 WPF？我从来没有想过要对 MFC、Windows 窗体甚至非托管 DirectX 这么说，但您可能不希望团队在正常开发过程中尝试“拿起”WPF。运输产品的周期！

是否至少有一两个开发人员具有一定的设计敏感性，并且具有最终设计权限的个人是否对开发问题有很好的理解，因此您可以利用 WPF 功能来创建实际上更好的东西，而不仅仅是更“多彩” ，以免费动画为特色？

您的目标客户群中是否有一部分运行在可能不支持您计划的功能的集成图形芯片组上——或者他们是否仍在运行 Windows 2000，这将完全排除他们作为客户的身份？有些人还会问您的客户是否真的关心增强的视觉效果，但是在经历了 1990 年代初期公司内部“我们的业务客户不关心颜色和图片”的辩论之后，我知道您的竞争对手精心设计的解决方案会让他们关心，真正的问题是条件是否合适，使您能够提供让他们现在关心的东西。

项目是否涉及底层开发，至少对于表示层，以避免尝试挂钩到不兼容的遗留脚手架的额外复杂性（与 Windows 窗体的互操作性不是无缝的）？

您的经理能否接受（或分散注意力）在四到六个月内开发人员生产力的显着下降？

最后一个问题是由于我喜欢将其视为 WPF 的“FizzBin”性质，有十种不同的方式来实现任何任务，并且没有明显的理由偏爱一种方法而不是另一种方法，并且很少有指导可以帮助您制作选择。不仅您所做的任何选择的缺点只会在项目的后期才变得清晰，而且您几乎可以保证项目中的每个开发人员都采用不同的方法，从而导致严重的维护问题。最令人沮丧的是，当您尝试学习该框架时，经常会遇到不一致性。

您可以在我的博客上的条目中找到更深入的 WPF 相关信息：

[http://missedmemo.com/blog/2008/09/13/WPFTheFizzBinAPI.aspx](http://missedmemo.com/blog/2008/09/13/WPFTheFizzBinAPI.aspx)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-10T05:29:55.513

WPF：

*   都是关于图形的！
*   是一个与分辨率无关的框架（意思是——WPF完全采用了矢量图形的概念——并且还让位图图形的缩放成为了一个轻率的过程）
*   硬件加速了！！！！WPF 图形在可能的情况下通过[Direct3D](http://en.wikipedia.org/wiki/Microsoft_Direct3D)进行硬件加速- 它不是基于[GDI](http://en.wikipedia.org/wiki/Graphics_Device_Interface)的！
*   没有`Paint()`功能 - WPF 基于保留的图形模式/基于树的绘图系统。最后！
*   在图形上非常动态 - 一切都可以动画 - 并且动画内置在框架中。记住....没有`Paint()`！
*   非常可定制 - 尽管进入细节`ControlTemplates`是复杂性开始的地方。您只需将对象添加到显示树并让 WPF 担心更新。
*   非常丰富的文字渲染功能。
*   希望通过使用用于图形定义的声明性语言 ( [XAML](http://en.wikipedia.org/wiki/Extensible_Application_Markup_Language) ) 和复杂的 GUI 设计软件 ( [Expression Blend](http://en.wikipedia.org/wiki/Microsoft_Expression_Blend) ) 来改进设计人员/编码人员的工作流程。尽管重要的是要意识到可以以声明方式完成的任何事情也可以在代码中完成。WPF 的复杂性吓跑了许多设计师，这一点也值得商榷——但它已经将一个强大的框架交到了编码人员的手中。

WPF：

*   不是[Windows 窗体](http://en.wikipedia.org/wiki/Windows_Forms)++ - 它只是一个完全不同的概念
*   不是 Silverlight - Silverlight 是 WPF 的子集。相当轻的子集。
*   不是 MFC - 好的，这应该很明显
*   不容易通过 Windows XP 分发 - 这是一种耻辱，也许是它最大的失败之一
*   不是 XAML。这种区别需要理解。XAML 是一种**可选**的声明性语言，可用于 WPF 应用程序的开发过程。它绝对不是必需的组件，尽管一旦理解，它肯定会改进复杂图形框架的工作流程、设计和重构。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-17T10:54:15.870

WPF 与 Windows 窗体完全不同。这意味着对您的团队进行大量培训。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T20:28:16.900

我认为您最初问题的关键词是“花哨”。如果您的客户真的期望交付物有很多亮点，那么您可能确实从切换到 WPF 中获得了一些好处。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T20:35:37.133

起初我不确定，大多数应用程序似乎都非常滞后（当然，WinForms 也不是闪电般快速）。这似乎已在 .NET 3.5 SP1 中得到解决，其中集成了多种技术的硬件加速。

集成的动画/故事板/矢量功能非常好，朝着正确的方向迈出了一步。如果您掌握了 Expression Blend，您将能够非常快速地制作应用程序原型。在我看来，这些都是明显的好处。

从长远来看，我不认为 WinForms 和旧技术是可持续的选择。

还有 Adob​​e Flex，Adobe/Macromedia 由于他们在 Flash 方面的经验而在更强大和“令人兴奋”的 GUI 解决方案方面有经验。

我只是希望我们不要在台式电脑上安装 10 个不同的 VM，只是为了运行所有这些不同的框架......

关于：

> 花哨的报道

幻想可能是 WPF 的优势之一......

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T21:45:52.330

WPF 是一种非常新颖的 UI 设计方法。唯一的问题是它引入了大量的概念，其中一些只是为了隐藏 XAML (XML) 的冗长性。它也受到[建筑宇航员](http://www.joelonsoftware.com/articles/fog0000000018.html)设计方法的影响，但总的来说我对它非常满意。它将您以前不会说的事情变成可以管理的事情。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-01-31T13:39:38.727

WPF 是当前 UI 方法中的“最先进技术”。如果它在人们学习编写 UI 时可用（而不是 GDI、Win32 和后来的相对相似的 WinForms），那么学习它不会花很长时间。您可能会认为它就像切换到 Dvorak 键盘 - 最困难的部分是改变您对您认为自己熟悉的 UI 设计部分的思考。

也就是说，您至少应该鼓励您的团队成员在业余时间尝试 WPF。从一开始就提供资源，可能通过以下方式：

*   有指向页面的链接，这些页面告诉您需要安装什么才能使用 WPF - 如果它没有提到 Blend，那么我不会相信它。
*   Look on here for "getting started" questions, since they'll probably have good answers from experienced individuals.
*   Buy at least a few good books and let people borrow them if they want.

# project-management - 一个月后我需要这个孩子——送我九个女人！

> ID：76526
> 
> 赞同：185
> 
> 时间：2008-09-16T20:21:25.157
> 
> 标签：project-management

在什么情况下——如果有的话——将程序员添加到团队中实际上会加速已经延迟的项目的开发？

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2008-09-16T21:41:13.793

确切的情况显然对您的项目非常具体（例如开发团队、管理风格、流程成熟度、主题的难度等）。为了更好地界定这个范围，以便我们可以用任何东西来谈论它，而不是过于简单化，我将重申你的问题：

> 在什么情况下（如果有的话），将团队成员添加到延迟运行的软件开发项目会导致实际交付日期的减少，其质量水平与允许现有团队工作直到完成的质量水平相同？

我认为有很多事情是*必要*的，但还不够，这会发生（没有特别的顺序）：

*   **拟添加到项目中的个人必须具备：**
    *   至少对项目的问题域有一个合理的理解
    *   精通项目语言以及他们将用于完成任务的特定技术
    *   他们的熟练程度必须/不/分别比最弱或最强的现有成员少得多或多得多。软弱的成员会因第三个问题而耗尽现有员工，而过于强大的新成员会因为他们所做和正在做的一切都是错误的而扰乱团队。
    *   具备良好的沟通能力
    *   积极主动（例如能够独立工作而无需刺激）
*   **现有团队成员必须具备：**
    *   高超的交流技巧
    *   优秀的时间管理能力
*   **项目负责人/管理层必须具备：**
    *   良好的优先级和资源分配能力
    *   现有团队成员的高度尊重
    *   高超的交流技巧
*   **该项目必须具有：**
    *   一个好的、完整的和文档化的软件设计规范
    *   已经实现的东西的良好文档
    *   模块化设计，允许划分明确的责任块
    *   足够的自动化流程来保证所需缺陷级别的质量。这些可能包括：单元测试、回归测试、自动化构建部署等）
    *   团队当前就位并正在使用的错误/功能跟踪系统（例如 trac、SourceForge、FogBugz 等）。

首先应该讨论的事情之一是是否*可以*推迟发布日期，是否可以削减功能，以及两者的某些组合是否可以让您满足现有员工的发布。很多时候，它的几个功能确实占用了团队的资源，而这些资源无法提供与投资相等的价值。因此，请先认真审查您项目的优先事项。

如果上一段的结果还不够，请访问上面的列表。如果你提前发现了进度表，那么在正确的时间添加正确的团队成员可能会挽救发布。不幸的是，您越接近预期的发货日期，添加人员时出现的问题就越多。在某一时刻，您将跨越“不归路”，没有任何更改（除了发布当前的开发分支）可以保存您的发布。

我可以继续说下去，但我认为我达到了要点。在项目之外，就你的职业生涯、公司未来的成功等而言，你绝对应该做的一件事就是弄清楚你迟到的原因，如果有什么事情可以提前提醒你，以及你需要什么措施采取以防止它在未来。延迟项目通常是因为您是：

*   在你开始之前迟到了（比时间更多的东西）和/或
*   滑倒了 1 小时 1 天。

希望有帮助！

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-09-16T20:27:50.770

只有当您有一个资源驱动的项目时，它才会有所帮助。

例如，考虑一下：

你需要画一张大海报，比如 4 x 6 米。这么大的海报，你大概可以放两三个人在它前面，让他们平行画。但是，将 20 个人放在它前面是行不通的。此外，除非您想要一张糟糕的海报，否则您将需要熟练的人。

但是，如果您的项目是用现成的打印信件塞入信封（就像*您可能赢了！*），那么您添加的人越多，进度就越快。分发一堆工作会产生一些开销，因此您无法在只有一个人的情况下获得福利。信封，但您可以从不止 2 或 3 个人那里获得好处。

因此，如果您的项目可以很容易地分成小块，并且如果团队成员可以快速上手（比如……瞬间），那么在一定程度上增加更多的人会使其进展得更快。

可悲的是，在我们的世界上没有多少项目是这样的，这就是为什么 docgnome 关于 Mythical Man-Month 书的提示是一个非常好的建议。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-09-16T20:27:11.303

也许如果以下条件适用：

1.  新程序员已经了解该项目，不需要任何启动时间。
2.  新程序员已经精通开发环境。
3.  无需管理时间即可将开发人员添加到团队中。
4.  团队成员之间几乎不需要沟通。

当我第一次看到所有这些时，我会告诉你的。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-09-16T22:33:26.587

根据 Mythical Man-Month，将人员添加到延迟项目使其延迟的主要原因是 O(n^2) 通信开销。

我经历过一个主要的例外：如果一个项目只有*一个*人，它几乎总是注定要失败的。几乎每次添加第二个都会加快速度。那是因为在这种情况下，沟通不是*开销*——这是一个澄清你的想法并减少愚蠢错误的有用机会。

此外，正如您在发布问题时显然知道的那样，神话人月的建议仅适用于*后期*项目。如果您的项目还没有迟到，那么添加人员很可能不会迟到。当然，前提是你做得正确。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-09-16T20:23:06.603

如果现有的程序员完全不称职，那么增加称职的程序员可能会有所帮助。

我可以想象这样一种情况，你有一个非常模块化的系统，而现有的程序员甚至还没有*从*一个非常孤立的模块上开始。在这种情况下，将项目的那一部分分配给新程序员可能会有所帮助。

基本上神话人月的参考是正确的，除了像我编造的那样人为的情况。Brooks 先生进行了扎实的研究以证明，在某个时间点之后，将新程序员添加到项目中的网络和通信成本将超过您从他们的生产力中获得的任何好处。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-09-16T20:29:43.373

*   如果新人专注于测试
*   如果您可以隔离不创建新依赖项的独立功能
*   如果您可以正交化项目的某些方面（尤其是非编码任务，例如视觉设计/布局、数据库调整/索引或服务器设置/网络配置），以便一个人可以从事该工作，而其他人则可以继续使用应用程序代码
*   如果人们彼此了解，技术、业务需求和设计，足够了解他们何时会踩到对方的脚趾以及如何避免这样做（这个，当然，如果不是这样的话，就很难安排了）

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-16T20:38:12.103

只有当你在那个后期阶段有一些独立的（与项目其他部分的交互几乎为 0%）尚未被任何人解决的任务时，你才能在团队中引入该领域的专家。增加一名团队成员必须尽量减少对团队其他成员的干扰。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-17T09:38:03.447

与其增加程序员，不如考虑增加管理帮助。任何可以消除干扰、提高注意力或提高动力的方法都会有所帮助。这包括系统和管理，以及更平淡无奇的事情，比如吃午饭。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-16T20:43:44.900

我认为在工作结束时增加人员可能会加快速度，如果：

1.  这项工作可以并行完成。

2.  增加资源所节省的时间比让有项目经验的人向没有经验的人解释所损失的时间要多。

编辑：我忘了提，这种事情不会经常发生。通常它是相当直截了当的东西，比如对表格进行简单 CRUD 的管理屏幕。如今，这些类型的工具大多可以自动生成。

不过要小心那些寄希望于这种工作的经理。听起来不错，但实际上通常没有足够的时间来减少项目的任何重要时间。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-16T22:31:26.183

显然，每个项目都是不同的，但大多数开发工作可以确保在开发人员之间进行一定程度的协作。在这种情况下，我的经验是，新资源实际上可能会无意中减慢他们赖以加快速度的人的速度，在某些情况下，这可能是您的关键人员（顺便说一下，通常是“关键”人员会占用教育新手的时间b）。当他们*赶上*进度时，无法保证他们的工作将与团队其他成员一起符合既定的“规则”或“工作文化”。再说一次，它弊大于利。因此，除此之外，这些是可能有益的情况：

1) 新资源的任务很紧张，需要与其他开发人员进行最少的交互，并且需要具备已经展示的技能。（即将现有代码移植到新平台，从外部重构当前锁定在现有代码库中的死模块）。

2) 项目的管理方式可以让其他更高级的团队成员的时间可以共享，以帮助新手加快速度并在整个过程中指导他们，以确保他们的工作与已经完成的工作相兼容。

3）其他团队成员非常有耐心。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-16T20:24:48.190

*   尚未启动的独立模块
*   缺乏可以集成的开发工具（例如自动构建管理器）

首先，我正在考虑让他们远离当前正在发展的人们的方式。我确实同意 Mythical Man-Month，但我也认为一切都有例外。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-17T03:33:36.880

我认为将人员添加到团队中可能会比将人员添加到项目本身更能加快项目速度。

我经常遇到并发项目太多的问题。如果我可以单独专注于那个项目，那么其中任何一个项目都可以更快地完成。通过添加团队成员，我可以过渡到其他项目。

当然，这假设您雇佣了有能力、有上进心的开发人员，他们能够继承大型项目并独立学习。:-)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-09-21T21:19:48.740

如果额外的资源**补充**您现有的团队，它可能是理想的。例如，如果您要设置生产硬件并验证数据库是否经过实际调整，而不是仅仅返回良好的结果（您的团队作为领域专家知道的），然后向接下来从事该项目的优秀 dba 借时间对你来说可以加速团队而不需要太多的培训成本

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-17T04:16:05.140

简单的说。它归结为比较剩余时间和从某人那里获得的生产力，不包括额外资源加快速度和提高生产力所需的时间，并减去现有资源投入的教学时间。关键因素（按重要性排序）：

1.  资源在拾取方面有多好。最好的开发人员可以在几乎没有帮助的情况下进入一个新站点并几乎立即高效地修复错误。这种技能很少见，但可以学习。
2.  任务的可分离性。他们需要能够处理对象和函数，而不会绊倒现有的开发人员并减慢他们的速度。
3.  项目和可用文档的复杂性。如果它是一个普通的最佳实践 ASP.Net 应用程序和常见的有据可查的业务场景，那么优秀的开发人员可能会立即陷入困境。这个因素比任何其他因素都更能决定现有资源需要投入多少时间在教学上，从而决定新资源的初始负面影响。
4.  剩余时间。这也经常被错误估计。通常情况下，我们只剩下 x 周的时间，而且需要 x+1 周的时间才能让某人跟上进度。实际上，该项目将会失败，并且实际上还有 2 周的开发时间要进行，并且尽早而不是稍后获得更多资源会有所帮助。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-17T10:29:16.320

如果一个团队已经习惯了结对编程，那么添加另一个*已经擅长*结对的开发人员可能不会减慢项目的速度，尤其是在以 TDD 风格进行开发的情况下。

随着新开发人员对代码库的了解越来越多，他们将慢慢变得更有效率，任何误解都会被他们的搭档或在每次签入之前运行的测试套件很早就发现（理想情况下应该有一个检查至少每十分钟一次）。

但是，需要考虑额外通信开销的影响。重要的是不要过多地淡化项目的现有知识。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2011-07-22T20:35:55.083

当额外开发人员贡献的生产力超过培训和管理这些开发人员所损失的生产力时，添加开发人员是有意义的。

# .net - Multiview 控件如何处理其 Viewstate？

> ID：76534
> 
> 赞同：2
> 
> 时间：2008-09-16T20:21:54.750
> 
> 标签：.net, asp.net, .net-2.0

Multiview 控件是否包含其每个视图的视图状态信息，而不管视图当前是否可见？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-18T11:00:31.320

是的，所有视图仍然存在，只是不活动的视图被隐藏/禁用。

[http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.multiview_properties.aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.multiview_properties.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T20:54:46.650

我相信是的，是的。使用 ViewState 解码器确认将非常简单（谷歌搜索，Fritz Onion 提供工具或 FireFox 插件）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T20:55:08.820

我不得不假设视图状态包含每个多视图的视图/控件的信息。否则，它将无法跟踪每个视图中控件的状态——除非您使用某种自定义状态管理。

# java - 整数数组如何在 JVM 内部存储？

> ID：76549
> 
> 赞同：5
> 
> 时间：2008-09-16T20:23:02.187
> 
> 标签：java, jvm

Java 中的整数数组作为 32 位值块存储在内存中。如何存储 Integer 对象数组？IE

```
int[] vs. Integer[] 
```

我想 Integer 数组中的每个元素都是对 Integer 对象的引用，并且 Integer 对象具有对象存储开销，就像任何其他对象一样。

然而，我希望 JVM 在后台做一些神奇的聪明，因为整数是不可变的，并且像整数数组一样存储它。

我的希望是不是太天真了？在每最后一盎司的性能都很重要的应用程序中，整数数组是否比 int 数组慢得多？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-17T07:12:47.117

我所知道的任何 VM 都不会像 int[] 数组那样存储 Integer[] 数组，原因如下：

1.  数组中可以有**null** Integer 对象，并且在 int 数组中没有剩余用于指示这一点的位。但是，VM 可以将每个阵列槽的 1 位信息存储在一个隐藏的位阵列中。
2.  您可以在整数数组的元素中进行同步。作为第一点，这更难克服，因为您必须为每个数组插槽存储一个监视器对象。
3.  Integer[] 的元素可以进行身份​​比较。**例如，您可以通过new**创建两个值为 1 的 Integer 对象，并将它们存储在不同的数组槽中，然后您可以检索它们并通过 == 进行比较。这一定会导致错误，因此您必须将此信息存储在某处。或者，您在某处保留对 Integer 对象之一的引用并将其用于比较，并且您必须确保 == 比较之一为假，一个为真。*这意味着对于优化*的Integer 数组，对象标识的整个概念很难处理。
4.  您可以将 Integer[] 强制转换为例如 Object[] 并将其传递给只需要 Object[] 的方法。这意味着所有处理 Object[] 的代码现在也必须能够处理特殊的 Integer[] 对象，这使得它变得更慢和更大。

考虑到所有这些，可能有可能制作一个特殊的 Integer[] 与*幼稚*的实现相比节省一些空间，但额外的复杂性可能会影响许多其他代码，最终使其变慢。

使用 Integer[] 而不是 int[] 的开销在空间和时间上可能会很大。在典型的 32 位 VM 上，一个 Integer 对象将消耗 16 个字节（8 个字节用于对象标头，4 个字节用于负载，4 个额外字节用于对齐），而 Integer[] 使用与 int[] 一样多的空间。在 64 位 VM（使用 64 位指针，并非总是如此）中，整数对象将消耗 24 个字节（16 个用于标头，4 个用于有效负载，4 个用于对齐）。此外，Integer[] 中的插槽将使用 8 个字节而不是 int[] 中的 4 个字节。这意味着您可以预期每个插槽的开销为**16 到 28**个字节，与普通 int 数组相比，这是**4 到 7 倍。**

性能开销也很重要，主要有两个原因：

1.  由于您使用了更多内存，因此您对内存子系统施加了更大的压力，从而在 Integer[] 的情况下更有可能发生缓存未命中。例如，如果您以线性方式遍历 int[] 的内容，则缓存将在您需要它们时已经获取大部分条目（因为布局也是线性的）。但是在 Integer 数组的情况下，Integer 对象本身可能会随机分散在堆中，使得缓存很难猜测下一个内存引用将指向哪里。
2.  由于使用了额外的内存，垃圾收集必须做更多的工作，因为它必须单独扫描和移动每个 Integer 对象，而在 int[] 的情况下，它只是一个对象，对象的内容不会必须被扫描（它们不包含对其他对象的引用）。

总而言之，在性能关键的工作中使用 int[] 将比在当前 VM 中使用 Integer 数组更快且内存效率更高，并且在不久的将来这不太可能发生太大变化。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-17T05:15:38.600

John Rose在 JVM 中使用[fixnums](http://blogs.oracle.com/jrose/entry/fixnums_in_the_vm)来解决这个问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T20:25:41.883

我认为你的希望太天真了。具体来说，它需要处理 Integer 可能为 null 而 int 不能为 null 的问题。仅此一项就足以存储对象指针。

也就是说，实际的对象指针将指向一个不可变的 int 实例，特别是对于整数的选择子集。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T20:26:18.607

它不会慢很多，但是因为 Integer[] 必须接受“null”作为条目而 int[] 不必接受，所以即使 Integer[] 由整数 []。

因此，如果每一盎司的性能都很重要，用户 int[]

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T20:35:16.637

Integer 可以为 null 而 int 不能为空的原因是，Integer 是一个成熟的 Java 对象，其中包含所有开销。这是有价值的，因为你可以写

```
Integer foo = new Integer();
foo = null; 
```

这很适合说 foo 将具有价值，但还没有。

另一个区别是不`int`执行溢出计算。例如，

```
int bar = Integer.MAX_VALUE;
bar++; 
```

将愉快地增加 bar 并且你最终得到一个非常负数，这可能不是你最初想要的。

```
foo = Integer.MAX_VALUE;
foo++; 
```

会抱怨，我认为这是更好的行为。

最后一点是，作为 Java 对象的 Integer 带有对象的空间开销。我认为其他人可能需要在这里插话，但我相信每个对象都会消耗 12 个字节的开销，然后是数据存储本身的空间。如果您追求性能和空间，我想知道 Integer 是否是正确的解决方案。

# windows - 将项目添加到 Windows 中的桌面上下文菜单

> ID：76553
> 
> 赞同：2
> 
> 时间：2008-09-16T20:23:17.897
> 
> 标签：windows, user-interface, desktop

我想在桌面上下文菜单（右键单击 Windows 桌面上的空白区域时看到的菜单）中添加一个项目。

此屏幕截图中类似于 Catalyst Control Center 的内容：
![嵌入式示例](https://i361.photobucket.com/albums/oo51/Stark3000/ContextMenuExample.png)

我知道如何通过注册表将项目添加到文件和文件夹的上下文菜单中，但桌面的工作方式似乎有所不同：我什至没有在注册表中找到文本。

那么，如何将新项目添加到桌面菜单中，以及如何将一些代码与其关联？
我认为该解决方案与语言无关，如果不是，我将不胜感激任何有帮助的代码。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T16:08:45.037

这样的处理程序必须在 HKCR\Directory\Background 中注册，而不是在通常的位置，如 HKCR\Directory、HKCR\Folder 等。

查看在 MSDN中[创建 Shell 扩展处理程序。](http://msdn.microsoft.com/en-us/library/cc144067(VS.85).aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T20:39:44.613

CodeProject上有一系列文章详细介绍了编写Shell Extensions，非常好：

[http://www.codeproject.com/KB/shell/shellextguide1.aspx](http://www.codeproject.com/KB/shell/shellextguide1.aspx)

# html - 更改 html 列表中项目符号的颜色？

> ID：76564
> 
> 赞同：89
> 
> 时间：2008-09-16T20:23:47.210
> 
> 标签：html, css, html-lists

我想要的只是能够将列表中项目符号的颜色更改为浅灰色。它默认为黑色，我不知道如何更改它。

我知道我可以只使用图像；如果我能帮上忙，我宁愿不这样做。

* * *

## 回答 #1

> 赞同：161
> 
> 时间：2008-09-16T20:28:38.367

项目符号从文本中获取颜色。因此，如果您想在列表中使用与文本不同的颜色项目符号，则必须添加一些标记。

将列表文本包装在一个跨度中：

```
<ul>
  <li><span>item #1</span></li>
  <li><span>item #2</span></li>
  <li><span>item #3</span></li>
</ul> 
```

然后稍微修改你的样式规则：

```
li {
  color: red; /* bullet color */
}
li span {
  color: black; /* text color */
} 
```

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2010-11-26T21:14:16.433

我在没有添加标记的情况下进行了管理，而是使用了 li:before。这显然具有`:before`（不支持旧的 IE 支持）的所有限制，但经过一些非常有限的测试后，它似乎可以与 IE8、Firefox 和 Chrome 一起使用。它在我们的控制器环境中工作，想知道是否有人可以检查一下。项目符号样式也受到 unicode 的限制。

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <style type="text/css">
    li {
      list-style: none;
    }

    li:before {
      /* For a round bullet */
      content:'\2022';
      /* For a square bullet */
      /*content:'\25A0';*/
      display: block;
      position: relative;
      max-width: 0px;
      max-height: 0px;
      left: -10px;
      top: -0px;
      color: green;
      font-size: 20px;
    }
  </style>
</head>

<body>
  <ul>
    <li>foo</li>
    <li>bar</li>
  </ul>
</body>
</html> 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2013-04-16T15:10:03.817

这在 2008 年是不可能的，但很快就会（希望如此）成为可能！

根据[W3C CSS3 规范](https://www.w3.org/TR/css-lists-3/#marker-pseudo-element)，您可以完全控制在带有`::marker`伪元素的列表项之前生成的任何数字、字形或其他符号。将此应用于投票最多的答案的解决方案：

```
<ul>
  <li>item #1</li>
  <li>item #2</li>
  <li>item #3</li>
</ul>

li::marker {
  color: red; /* bullet color */
}
li {
  color: black /* text color */
} 
```

[JSFiddle 示例](http://jsfiddle.net/9Srpq/)

但请注意，**截至 2016 年 7 月**，此解决方案只是 W3C 工作草案的一部分，尚不适用于任何主流浏览器。

如果您想要此功能，请执行以下操作：

*   [**Blink**（Chrome、Opera、Vivaldi、Yandex 等）：star Chromium 的问题](https://code.google.com/p/chromium/issues/detail?id=457718&thanks=457718&ts=1423675756)
*   [**Gecko**（Firefox、Iceweasel 等）：在此错误上单击“（投票）”](https://bugzilla.mozilla.org/show_bug.cgi?id=205202)
*   ~~[**Trident**（IE，Windows 网页视图）：单击“X 用户可以重现此错误”下的“我也可以”](https://connect.microsoft.com/IE/feedbackdetail/view/1125247/support-marker-pseudo-element#tabs)~~
    ^(Trident 开发已停止)
*   [**EdgeHTML**（MS Edge、Windows Web 视图、Windows Modern 应用程序）：在此提案上单击“投票”](https://wpdev.uservoice.com/forums/257854-internet-explorer-platform/suggestions/7084750-css-3-marker-pseudo-element)
*   [**Webkit**（Safari、Steam、WebOS 等）：CC 自己解决这个 bug](https://bugs.webkit.org/show_bug.cgi?id=141477)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-16T20:27:05.593

```
<ul>
  <li style="color: #888;"><span style="color: #000">test</span></li>
</ul> 
```

这种方法的最大问题是额外的标记。（跨度标签）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-07-05T06:21:40.590

您好，也许这个答案已经晚了，但它是实现这一目标的正确答案。

好的，事实是您必须指定一个内部标记以使 LIst 文本显示为通常的黑色（或者您想要的任何内容）。但是，您也可以使用 CSS 重新定义任何标签和内部标签。因此，最好的方法是使用 SHORTER 标签进行重新定义

使用这个 CSS 定义：

```
li { color: red; }
li b { color: black; font_weight: normal; }
.c1 { color: red; }
.c2 { color: blue; }
.c3 { color: green; } 
```

这个html代码：

```
<ul>
<li><b>Text 1</b></li>
<li><b>Text 2</b></li>
<li><b>Text 3</b></li>
</ul> 
```

你得到所需的结果。您还可以使每个光盘的颜色不同：

```
<ul>
    <li class="c1"><b>Text 1</b></li>
    <li class="c2"><b>Text 2</b></li>
    <li class="c3"><b>Text 3</b></li>
 </ul> 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-04-19T22:11:00.583

只需在图形程序中做一个项目符号并使用`list-style-image`：

```
ul {
  list-style-image:url('gray-bullet.gif');
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T20:27:43.563

使用 span（或其他元素）将列表项中的文本包裹起来，并将项目符号颜色应用于列表项，并将文本颜色应用于 span。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T20:29:26.150

根据[W3C 规范](http://www.w3.org/TR/CSS2/generate.html#lists)，

> 列表属性...不允许作者为列表标记指定不同的样式（颜色、字体、对齐方式等）...

但是上面列表中带有跨度的想法应该可以正常工作！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-16T20:34:09.603

```
<ul>
<li style="color:#ddd;"><span style="color:#000;">List Item</span></li>
</ul> 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-01-05T20:34:05.377

如果您有很多页面并且不需要自己编辑标记，则可以使用 Jquery。

这是一个简单的例子：

```
$("li").each(function(){
var content = $(this).html();
var myDiv = $("<div />")
myDiv.css("color", "red"); //color of text.
myDiv.html(content);
$(this).html(myDiv).css("color", "yellow"); //color of bullet
}); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-11-25T03:47:45.393

对于 2008 年的问题，我想我可能会添加一个更新和最新的答案，说明如何更改列表中项目符号的颜色。

如果您愿意使用外部库，[Font Awesome 为您提供了可缩放的矢量图标](https://fortawesome.github.io/Font-Awesome/examples/#list)，并且当与[Bootstrap 的帮助类](http://getbootstrap.com/css/#helper-classes)（例如`text-success`）结合使用时，您可以制作一些非常酷且可自定义的列表。

[我已经扩展了下面的 Font Awesome 列表示例页面](https://fortawesome.github.io/Font-Awesome/examples/#list)的摘录：

> 使用`fa-ul`和`fa-li`轻松替换无序列表中的默认项目符号。

```
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" />
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" />

<ul class="fa-ul">
  <li><i class="fa-li fa fa-circle"></i>List icons</li>
  <li><i class="fa-li fa fa-check-square text-success"></i>can be used</li>
  <li><i class="fa-li fa fa-spinner fa-spin text-primary"></i>as bullets</li>
  <li><i class="fa-li fa fa-square text-danger"></i>in lists</li>
</ul>
```

Font Awesome [（大部分）支持 IE8 ，如果您使用](http://getbootstrap.com/getting-started/#support-ie8-font-face)[旧版本 3.2.1](http://fortawesome.github.io/Font-Awesome/3.2.1/get-started/#need-ie7)，则仅支持 IE7 。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-06-15T12:57:35.980

如果我们为每个元素设置颜色，它也会起作用，例如：我现在向左添加了一些边距。

```
<article class="event-item">
    <p>Black text here</p>
</article>

.event-item{
    list-style-type: disc;
    display: list-item;
    color: #ff6f9a;
     margin-left: 25px;
}
.event-item p {
    margin: 0;
    color: initial;
} 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2008-09-16T20:29:27.163

```
<ul style="color: red;">
<li>One</li>
<li>Two</li>
<li>Three</li>
</ul> 
```

*   一*   二*   三

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2008-09-16T20:53:30.007

您可以使用 CSS 来实现这一点。通过以您选择的颜色和样式指定列表，您还可以将文本指定为不同的颜色。

按照[http://www.echocho.com/csslists.htm](http://www.echoecho.com/csslists.htm)上的示例进行操作。

* * *

## 回答 #15

> 赞同：-2
> 
> 时间：2008-09-16T20:28:17.307

只需使用 CSS：

```
<li style='color:#e0e0e0'>something</li> 
```

* * *

## 回答 #16

> 赞同：-5
> 
> 时间：2008-09-16T20:28:01.490

你会想通过 CSS 设置一个“列表样式”，并给它一个颜色：值。例子：

```
ul.colored {list-style: color: green;} 
```

# javascript - F# 中原型的 Enumerable#pluck？

> ID：76571
> 
> 赞同：2
> 
> 时间：2008-09-16T20:24:23.557
> 
> 标签：javascript, f#, functional-programming, prototypejs

在 JavaScript 中，使用 Prototype 库，以下函数构造是可能的：

```
var words = ["aqueous", "strength", "hated", "sesquicentennial", "area"];
words.pluck('length');
//-> [7, 8, 5, 16, 4] 
```

请注意，此示例代码等效于

```
words.map( function(word) { return word.length; } ); 
```

我想知道在 F# 中是否有类似的东西：

```
let words = ["aqueous"; "strength"; "hated";"sesquicentennial"; "area"]
//val words: string list
List.pluck 'Length' words
//int list = [7; 8; 5; 16; 4] 
```

无需写：

```
List.map (fun (s:string) -> s.Length) words 
```

这对我来说似乎很有用，因为这样您就不必为每个属性编写函数来访问它们。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T18:19:21.930

我在 F# 邮件列表中看到了您的请求。希望我能帮上忙。

您可以使用类型扩展和反射来允许这样做。我们使用 pluck 函数简单地扩展了通用列表类型。然后我们可以在任何列表上使用 pluck() 。未知属性将返回一个列表，其中包含错误字符串作为其唯一内容。

```
type Microsoft.FSharp.Collections.List<'a> with
    member list.pluck property = 
        try 
            let prop = typeof<'a>.GetProperty property 
            [for elm in list -> prop.GetValue(elm, [| |])]
        with e-> 
            [box <| "Error: Property '" + property + "'" + 
                            " not found on type '" + typeof<'a>.Name + "'"]

let a = ["aqueous"; "strength"; "hated"; "sesquicentennial"; "area"]

a.pluck "Length" 
a.pluck "Unknown" 
```

在交互式窗口中产生以下结果：

```
> a.pluck "长度" ;;
验证它：obj 列表 = [7; 8个；5个；16; 4]

> a.pluck "未知";;
验证它：obj list = [“错误：在类型'String'上找不到属性'Unknown'”]

```

温暖的问候，

丹尼阿舍

> > > > >

注意：当使用`<pre`> 周围的尖括号

```
<'一个>
```

虽然在预览窗口中没有显示它看起来不错。反引号对我不起作用。不得不求助于你的彩色版本，这是完全错误的。在完全支持 FSharp 语法之前，我想我不会再在这里发帖了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T03:01:17.940

Prototype`pluck`在 Javascript 中利用了这`object.method()`一点，与`object[method]`.

不幸的是，您不能调用`String.Length`任何一个，因为它不是静态方法。但是，您可以使用：

```
#r "FSharp.PowerPack.dll" 
open Microsoft.FSharp.Compatibility
words |> List.map String.length 
```

[http://research.microsoft.com/fsharp/manual/FSharp.PowerPack/Microsoft.FSharp.Compatibility.String.html](http://research.microsoft.com/fsharp/manual/FSharp.PowerPack/Microsoft.FSharp.Compatibility.String.html)

但是，使用`Compatibility`可能会使查看您的代码的人更加困惑。

# cryptography - 我有 P & G——如何使用 Wincrypt API 生成 Diffie-Hellman 密钥对？

> ID：76581
> 
> 赞同：0
> 
> 时间：2008-09-16T20:25:21.807
> 
> 标签：cryptography, cryptoapi, diffie-hellman

[这里](http://msdn.microsoft.com/en-us/library/aa919730.aspx)有一篇 MSDN 文章，但我并没有走得太远：

```
p = 139;
g = 5;

CRYPT_DATA_BLOB pblob;
pblob.cbData = sizeof( ULONG );
pblob.pbData = ( LPBYTE ) &p;

CRYPT_DATA_BLOB gblob;
gblob.cbData = sizeof( ULONG );
gblob.pbData = ( LPBYTE ) &g;

HCRYPTKEY hKey;
if ( ::CryptGenKey( m_hCryptoProvider, CALG_DH_SF,
                    CRYPT_PREGEN, &hKey ) )
{
    ::CryptSetKeyParam( hKey, KP_P, ( LPBYTE ) &pblob, 0 ); 
```

在这里失败`NTE_BAD_DATA`。我正在使用`MS_DEF_DSS_DH_PROV`. 是什么赋予了？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T00:06:37.890

可能是它不喜欢您使用的非常短的键。

我发现[那篇文章的桌面版本](http://msdn.microsoft.com/en-us/library/aa381969.aspx)可能会有所帮助，因为它有一个完整的示例。

编辑：

OP 从示例中意识到，您必须告诉 CryptGenKey 密钥的长度，您可以通过将标志的前 16 位设置为您要使用的位数来做到这一点。如果将此保留为 0，则您将获得默认密钥长度。这记录在设备文档的*备注***部分**，以及[桌面文档中的](http://msdn.microsoft.com/en-us/library/aa379941(VS.85).aspx)*dwFlags*参数。

对于 Diffie-Hellman 密钥交换算法，在 Windows XP 及更高版本上，基本提供程序默认为 512 位密钥，而增强提供程序（这是默认设置）默认为 1024 位密钥。CE 上的默认长度似乎没有任何文档。

因此，代码应为：

```
BYTE p[64] = { 139 }; // little-endian, all other bytes set to 0
BYTE g[64] = { 5 };

CRYPT_DATA_BLOB pblob;
pblob.cbData = sizeof( p);
pblob.pbData = p;

CRYPT_DATA_BLOB gblob;
gblob.cbData = sizeof( g );
gblob.pbData = g;

HCRYPTKEY hKey;
if ( ::CryptGenKey( m_hCryptoProvider, CALG_DH_SF,
                    ( 512 << 16 ) | CRYPT_PREGEN, &hKey ) )
{
    ::CryptSetKeyParam( hKey, KP_P, ( LPBYTE ) &pblob, 0 ); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T22:54:32.417

在我看来`KP_P`，`KP_G`,`KP_Q`是用于 DSS 密钥（数字签名标准？）。对于 Diffie-Hellman 来说，看起来您应该使用`KP_PUB_PARAMS`并传递`DATA_BLOB`指向`DHPUBKEY_VER3`结构的 a 。

请注意，您指向的文章来自 Windows Mobile/Windows CE SDK。CE 与桌面/服务器的工作方式不同，这并不是第一次。

编辑：CE 没有实现`KP_PUB_PARAMS`. 要在桌面上使用此结构，请参阅[Diffie-Hellman 版本 3 公钥 BLOB](http://msdn.microsoft.com/en-us/library/aa381974(VS.85).aspx)。

# .net - Rhino Mocks：有什么方法可以验证对象属性的约束吗？

> ID：76584
> 
> 赞同：3
> 
> 时间：2008-09-16T20:25:27.203
> 
> 标签：.net, rhino-mocks

如果我有

```
class ObjA {
  public ObjB B;
}
class ObjB {
  public bool Val;
} 
```

和

```
class ObjectToMock {
  public DoSomething(ObjA obj){...}
} 
```

有没有办法定义一个期望，不仅会调用 DoSomething 还会调用 obj.B.Val == true？

我试过了

```
Expect.Call(delegate { 
    mockObj.DoSomething(null);
}).Constraints(new PropertyIs("B.Val", true)); 
```

但无论价值如何，它似乎都失败了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T20:53:39.180

您可以尝试使用 Is.Matching() 并提供谓词约束（为了清楚起见，移出线外）：

```
 Predicate nestedBValIsTrue = delegate(ObjA a) { return a.B.Val == true;};
    Expect.Call( delegate {mockobj.DoSomething(null);})
           .Constraints( Is.Matching(nestedBValIsTrue)); 
```

# java - 在 Maven 测试期间未找到 persistence.xml

> ID：76591
> 
> 赞同：9
> 
> 时间：2008-09-16T20:25:55.817
> 
> 标签：java, testing, maven-2, jpa, automated-tests

我正在尝试在 Maven 构建期间将测试数据加载到测试数据库中以进行集成测试。persistence.xml 被`target/test-classes/META-INF/`正确复制到，但是在运行测试时出现此异常。

> javax.persistence.PersistenceException：没有名为目标数据库的 EntityManager 的持久性提供程序

看起来它没有找到或加载persistence.xml。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2010-01-25T08:49:26.447

刚刚用基于 Maven/Eclipse 的 JPA 项目解决了同样的问题。

我有我的 META-INF 目录`src/main/java`，因为它在测试阶段之前没有被复制到目标目录。

移动此目录以`src/main/resources`解决问题并确保在运行测试时该`META-INF/persistence.xml`文件存在。`target/classes`

我*认为*JPA 方面将我的`META-INF/persistence.xml`文件放入 中`src/main/java`，结果证明这是我的问题的根源。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-09-04T16:30:04.300

我正在使用 Maven2，我忘记在我的 pom.xml 文件中添加这个依赖项：

```
 <dependency>
   <groupId>org.hibernate</groupId>
   <artifactId>hibernate-entitymanager</artifactId>
   <version>3.4.0.GA</version>
 </dependency> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-17T00:23:58.350

如果这是在 Windows 上，您可以使用 sysinternal 的 procmon 来确定它是否正在检查正确的路径。

只需按路径过滤 -> 包含 -> persistence.xml。Procmon 将拾取任何打开名为 persistenc.xml 的文件的尝试，您可以检查以查看尝试的路径。

有关 procmon 的更多详细信息，请参见此处：[http ://technet.microsoft.com/en-us/sysinternals/bb896645.aspx](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-24T00:35:05.097

我遇到了同样的问题，不是找不到persistence.xml文件，而是找不到XML中指定的提供程序。

确保您的 xml 文件中有正确的 JPA 提供程序依赖项和正确的提供程序定义。

IE。`<provider>oracle.toplink.essentials.PersistenceProvider</provider>`

使用 maven，我必须在本地安装 2 个 toplink-essentials jar，因为没有包含依赖项的公共存储库。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-07-09T11:45:26.207

您的 persistence.xml 是否位于 scr/test/resources 中？因为我面临着类似的问题。

只要我的**persistence.xml**位于**src/main/resources**中，一切正常。

如果我将**persistence.xml**移动到**src/test/resources**就没有任何效果了。

唯一有用但可悲的答案在这里：http: [//jira.codehaus.org/browse/SUREFIRE-427](http://jira.codehaus.org/browse/SUREFIRE-427)

由于不明原因，现在似乎不可能。:-(

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-07T14:14:28.267

我们遇到了同样的问题，对项目进行了一些调整，最后发现了以下问题（更清晰的错误描述）：在 oracle.toplink.essentials.ejb.cmp3.persistence。PersistenceUnitProcessor.computePURootURL(PersistenceUnitProcessor.java:248)

有了这些信息，我们想起了一个主要规则：路径名中没有空格！！！

尝试这个。为我们*微笑*。也许有一天这会得到解决。

希望这对你有用。祝你好运。

# xml - 用于 Web 服务的 SOAP 或 REST？

> ID：76595
> 
> 赞同：389
> 
> 时间：2008-09-16T20:26:17.903
> 
> 标签：xml, web-services, rest, soap

REST 是更好的 Web 服务方法还是 SOAP？还是它们是针对不同问题的不同工具？或者这是一个微妙的问题——也就是说，在某些领域中，一个比另一个稍微好一点，等等？

我将特别感谢有关这些概念及其与 PHP 世界以及现代高端 Web 应用程序的关系的信息。

* * *

## 回答 #1

> 赞同：563
> 
> 时间：2008-09-16T20:59:47.670

当我在 Hewlett-Packard 工作时，我根据正在开发的原始规范构建了第一批 SOAP 服务器之一，包括代码生成和 WSDL 生成。我不建议将 SOAP 用于任何事情。

首字母缩写词“SOAP”是一个谎言。它不是简单的，它不是面向对象的，它没有定义访问规则。可以说，它是一个协议。这是 Don Box 有史以来最糟糕的规格，这是一项了不起的壮举，因为他是犯下“COM”的人。

在 SOAP 中，没有什么是 REST 用于传输、JSON、XML 甚至纯文本用于数据表示的。为了传输安全，您可以使用 https。对于身份验证，基本身份验证。对于会话，有 cookie。REST 版本会更简单、更清晰、运行速度更快、使用的带宽更少。

XML-RPC 清楚地定义了请求、响应和错误协议，并且对于大多数语言都有很好的库。但是，对于许多任务，XML 比您需要的要重。

* * *

## 回答 #2

> 赞同：200
> 
> 时间：2008-09-16T20:37:56.753

REST 是一种架构，SOAP 是一种协议。

这是第一个问题。

您可以在 REST 应用程序中发送 SOAP 信封。

SOAP 本身实际上是非常基本和简单的，正是它之上的 WSS-* 标准使它变得非常复杂。

如果您的消费者是其他应用程序和其他服务器，那么今天有很多对 SOAP 协议的支持，并且移动数据的基础本质上是现代 IDE 中的鼠标单击。

如果您的消费者更可能是 RIA 或 Ajax 客户端，那么您可能需要比 SOAP 更简单的东西，并且更适合客户端（尤其是 JSON）。

通过 HTTP 发送的 JSON 数据包不一定是 REST 架构，它只是到 URL 的消息。一切都完美无缺，但 REST 习语有一些关键组件。但是很容易将两者混淆。但仅仅因为你在谈论 HTTP 请求并不一定意味着你有一个 REST 架构。您可以拥有一个完全没有 HTTP 的 REST 应用程序（请注意，这种情况很少见）。

因此，如果您拥有对 SOAP“满意”的服务器和消费者，那么 SOAP 和 WSS 堆栈可以很好地为您服务。如果您正在做更多临时性的事情并希望更好地与 Web 浏览器交互，那么一些基于 HTTP 的更轻量级的协议也可以很好地工作。

* * *

## 回答 #3

> 赞同：102
> 
> 时间：2008-09-16T20:42:10.427

REST 是与 SOAP 完全不同的范例。可以在此处找到有关 REST 的好读物：[我如何向妻子解释 REST](http://katgleason.tumblr.com/post/37836552900/how-i-explained-rest-to-my-wife)。

如果您没有时间阅读它，这里有一个简短的版本：REST 通过关注“名词”并限制您可以应用于这些名词的“动词”的数量来进行范式转换。唯一允许的动词是“get”、“put”、“post”和“delete”。这与 SOAP 不同，在 SOAP 中，许多不同的动词可以应用于许多不同的名词（即许多不同的功能）。

对于 REST，四个动词映射到相应的 HTTP 请求，而名词由 URL 标识。这使得状态管理比在 SOAP 中透明得多，在 SOAP 中，它通常不清楚服务器上的状态以及客户端上的状态。

在实践中，尽管大部分都消失了，REST 通常只是指以[JSON](http://www.json.org/)格式返回结果的简单 HTTP 请求，而 SOAP 是一种更复杂的 API，它通过传递 XML 进行通信。两者都有其优点和缺点，但我发现，根据我的经验，REST 通常是更好的选择，因为您很少需要从 SOAP 获得的全部功能。

* * *

## 回答 #4

> 赞同：59
> 
> 时间：2012-12-24T03:08:34.147

快速了解 2012 年的问题：

REST 非常适用的领域是：

*   **有限的带宽和资源。**请记住，返回结构实际上是任何格式（开发人员定义的）。此外，可以使用任何浏览器，因为 REST 方法使用标准的 GET、PUT、POST 和 DELETE 动词。同样，请记住，REST 还可以使用当今大多数现代浏览器支持的 XMLHttpRequest 对象，这增加了 AJAX 的额外好处。

*   **完全无状态的操作。** 如果需要继续操作，那么 REST 不是最好的方法，而 SOAP 可能更适合它。但是，如果您需要无状态的 CRUD（创建、读取、更新和删除）操作，那么 REST 就是它。

*   **缓存情况。** 如果因为 REST 方式的完全无状态的操作，信息可以被缓存，那就完美了。这涵盖了上面三个中的很多解决方案。

那么我为什么还要考虑 SOAP？同样，SOAP 相当成熟且定义明确，并且带有完整的规范。REST 方法就是这样，一种方法并且对开发非常开放，所以如果您有以下内容，那么 SOAP 是一个很好的解决方案：

*   **异步处理和调用。** 如果您的应用程序需要保证级别的可靠性和安全性，那么 SOAP 1.2 提供了额外的标准来确保这种类型的操作。诸如 WSRM – WS-Reliable Messaging 之类的东西。

*   **正式合同。** 如果双方（提供者和消费者）必须就交换格式达成一致，那么 SOAP 1.2 为这种类型的交互提供了严格的规范。

*   **有状态的操作。**如果应用程序需要上下文信息和会话状态管理，那么 SOAP 1.2 在 WS* 结构中具有额外的规范来支持这些东西（安全、事务、协调等）。相比之下，REST 方法将使开发人员构建这种自定义管道。

[http://www.infoq.com/articles/rest-soap-when-to-use-each](http://www.infoq.com/articles/rest-soap-when-to-use-each)

* * *

## 回答 #5

> 赞同：44
> 
> 时间：2008-09-16T20:36:37.723

**SOAP**目前具有更好的工具的优势，它们将为服务层以及从任何给定的 WSDL 生成客户端生成大量样板代码。

**REST**更简单，因此更易于维护，位于 Web 架构的核心，允许更好的协议可见性，并且已被证明可以在 WWW 本身的大小上进行扩展。有些框架可以帮助您构建 REST 服务，例如 Ruby on Rails，有些甚至可以帮助您编写客户端，例如 ADO.NET 数据服务。但在大多数情况下，缺乏工具支持。

* * *

## 回答 #6

> 赞同：40
> 
> 时间：2008-09-16T20:50:52.510

从工具的角度来看，SOAP 很有用，因为 WSDL 很容易被工具使用。因此，您可以获得以您喜欢的语言为您生成的 Web 服务客户端。

REST 与 AJAX'y 网页配合得很好。如果您的请求保持简单，您可以直接从 JavaScript 进行服务调用，这非常方便。尽量不要在响应 XML 中包含任何名称空间，我已经看到浏览器对这些名称感到窒息。因此，xsi:type 可能不适合您，没有过于复杂的 XML 模式。

REST 也往往具有更好的性能。生成 REST 响应的代码对 CPU 的要求往往低于 SOAP 框架的要求。而且，如果您将 XML 生成鸭子放在服务器端，您可以有效地将 XML 流式传输到客户端。因此，假设您正在读取数据库游标的行。当您读取一行时，将其格式化为 XML 元素，然后将其直接写出给服务使用者。这样，您不必在开始编写 XML 输出之前收集内存中的所有数据库行 - 您可以同时读取和写入。研究新颖的模板引擎或 XSLT 以使流式处理适用于 REST。

另一方面，SOAP 倾向于由工具生成的服务生成为一个大块，然后才被写入。请注意，这不是绝对的事实，有一些方法可以从 SOAP 中获取流特性，例如使用附件。

我的决策过程如下：如果我希望我的服务易于被消费者使用，并且我编写的消息将是中小型（10MB 或更少），并且我不介意消耗一些额外的 CPU在服务器上循环，我使用 SOAP。如果我需要在 Web 浏览器上为 AJAX 提供服务，或者我需要流式传输，或者我的响应是巨大的，我会选择 REST。

最后，围绕 SOAP 建立了许多出色的标准，例如 WS-Security 和获得有状态的 Web 服务，如果您使用正确的工具，您可以插入这些标准。那种东西真的很重要，可以帮助你满足一些毛茸茸的要求。

* * *

## 回答 #7

> 赞同：29
> 
> 时间：2010-07-23T21:19:18.547

我知道这是一个老问题，但我必须发布我的答案——也许有人会觉得它有用。我不敢相信有多少人推荐 REST over SOAP。我只能假设这些人不是开发人员，或者从未真正实现过任何合理规模的 REST 服务。实现 REST 服务比实现 SOAP 服务花费的时间要长很多。最后它也变得更加混乱。以下是我 99% 的时间会选择 SOAP 的原因：

1) 实现 REST 服务比实现 SOAP 服务花费的时间无限长。所有现代语言/框架/平台都存在用于读取 WSDL 并输出代理类和客户端的工具。实现 REST 服务是手动完成的，并且 - 通过阅读文档来获得这一点。此外，在实现这两个服务时，您必须对通过管道返回的内容做出“猜测”，因为没有真正的模式或参考文档。

2) 为什么要编写一个返回 XML 的 REST 服务？唯一的区别是，使用 REST，您不知道每个元素/属性代表的类型 - 您需要自己实现它，并希望有一天字符串不会出现在您认为始终是 int 的字段中。SOAP 使用 WSDL 定义数据结构，所以这很简单。

3）我听说过使用 SOAP 会产生 SOAP 信封的“开销”。在这个时代，我们真的需要担心一些字节吗？

4) 我听说过使用 REST 您可以将 URL 弹出到浏览器中并查看数据的论点。当然，如果您的 REST 服务使用简单身份验证或不使用身份验证。例如，Netflix 服务使用 OAuth，它要求您在提交请求之前对内容进行签名和编码。

5) 为什么每个资源都需要一个“可读”的 URL？如果我们使用工具来实现服务，我们真的关心实际的 URL 吗？

我需要继续吗？

* * *

## 回答 #8

> 赞同：19
> 
> 时间：2009-09-22T15:36:38.087

我编写的大多数应用程序都是服务器端 C# 或 Java，或者 WinForms 或 WPF 中的桌面应用程序。这些应用程序往往需要比 REST 所能提供的更丰富的服务 API。另外，我不想花几分钟时间来创建我的 Web 服务客户端。WSDL 处理客户端生成工具允许我实现我的客户端并继续增加业务价值。

现在，如果我正在为一些 javascript ajax 调用显式编写 Web 服务，它可能会在 REST 中；只是为了了解客户端技术并利用 JSON。在我看来，从 javascript 使用的 Web 服务 API 可能不应该很复杂，因为这种复杂性似乎在服务器端处理得更好。

话虽如此，有一些用于 javascript 的 SOAP 客户端；我知道 jQuery 有一个。*因此，可以*从 javascript 中利用SOAP ；只是不如返回 JSON 字符串的 REST 服务好。因此，如果我有一个 Web 服务，我希望它足够复杂，可以灵活地用于任意数量的客户端技术和用途，我会选择 SOAP。

* * *

## 回答 #9

> 赞同：17
> 
> 时间：2008-09-17T11:18:06.327

我建议您先使用 REST - 如果您使用 Java，请查看 JAX-RS 和[Jersey](http://jersey.java.net/)实现。REST 更简单且易于与多种语言进行互操作。

正如其他人在该线程中所说，SOAP 的问题是当其他 WS-* 规范出现时它的复杂性，如果您误入 WSDL、XSD、SOAP、WS-Addressing 等的错误部分，则会出现无数互操作问题。

判断 REST 与 SOAP 辩论的最佳方法是查看互联网 - 几乎所有网络空间的大玩家，谷歌、亚马逊、ebay、twitter 等 - 都倾向于使用和更喜欢 RESTful API 而不是 SOAP 的。

使用 REST 的另一个不错的方法是，您可以在 Web 应用程序和 REST 前端之间重用大量代码和基础设施。例如，使用 JAX-RS 和隐式视图等框架，渲染资源的 HTML 与 XML 与 JSON 通常非常容易 - 再加上使用 Web 浏览器轻松处理 RESTful 资源

* * *

## 回答 #10

> 赞同：16
> 
> 时间：2008-09-16T20:54:41.457

我确信 Don Box 创建 SOAP 是在开玩笑——“看你*可以*在网络上调用 RPC 方法”，今天当他意识到它已经变成了一个臃肿的网络标准噩梦时，他呻吟着:-)

REST 很好，很简单，在任何地方都可以快速轻松地实现（所以比标准更像是一个“标准”）。使用 REST。

* * *

## 回答 #11

> 赞同：15
> 
> 时间：2011-11-21T15:57:23.413

我认为两者都有自己的位置。在我看来：

**SOAP**：遗留/关键系统和 Web/Web 服务系统之间集成的更好选择，在基础层，WS-* 有意义（安全、策略等）。

**RESTful**：网站之间集成的更好选择，与公共 API，在层的 TOP（VIEW，即，javascripts 调用 URIs）。

* * *

## 回答 #12

> 赞同：13
> 
> 时间：2009-08-19T09:51:20.060

还没有提到的一件事是 SOAP 信封可以包含标题以及正文部分。这使您可以使用 XML 的完整表达能力来发送和接收带外信息。据我所知，REST 将您限制在 HTTP 标头和结果代码中。

（otoh，您可以使用带有 REST 服务的 cookie 来发送“标头”类型的带外数据吗？）

* * *

## 回答 #13

> 赞同：10
> 
> 时间：2008-09-16T20:34:58.587

不要忽视 XML-RPC。如果您只是在追求轻量级解决方案，那么对于可以在几页文本中定义并以最少代码量实现的协议来说，有很多话要说。XML-RPC 已经存在多年，但已经过时了一段时间——但极简主义的吸引力似乎使它最近得到了某种复兴。

* * *

## 回答 #14

> 赞同：10
> 
> 时间：2012-12-19T12:38:40.023

回答 2012 年更新的（通过第二个赏金）问题，并查看今天的结果（其他答案）。

* * *

# 肥皂，优点和缺点

关于 SOAP 1.2，与“REST”相比的优缺点……嗯，从 2007 年开始， [您可以使用 WSDL 来描述 REST Web 服务](http://www.ibm.com/developerworks/webservices/library/ws-restwsdl/)，并使用 SOAP 协议……也就是说，如果您再努力一点，**[所有 W3C 标准的Web 服务协议栈](http://en.wikipedia.org/wiki/Web_services_protocol_stack)可以是 REST**！

这是一个很好的起点，因为我们可以想象一个暂时避免所有哲学和方法论讨论的场景。我们可以在技术上将“SOAP-REST”与类似服务中的“NON-SOAP-REST”进行比较，

*   **SOAP-REST** (="REST-SOAP")：如[L.Mandel 所示](http://www.ibm.com/developerworks/webservices/library/ws-restwsdl/)，WSDL2 可以描述 REST Web 服务，如果我们假设示例 XML 可以封装在 SOAP 中，那么所有的实现都将是“SOAP-REST” .

*   **NON-SOAP-REST**：任何不能是 SOAP 的 REST Web 服务……也就是说，“90%”的众所周知的 REST 示例。有些不使用 XML（例如，典型的 AJAX REST 使用 JSON 代替），有些使用另一种 XML 结构，没有 SOAP 标头或规则。PS：为了避免非正式性，我们可以在比较中假设[REST 级别 2](http://martinfowler.com/articles/richardsonMaturityModel.html)。

当然，为了在概念上进行比较，将“NON-REST-SOAP”与“NON-SOAP-REST”进行比较，作为不同的建模方法。因此，完成此 Web 服务分类：

*   **NON-REST-SOAP**：任何不能 REST 的 SOAP Web 服务……也就是说，“90%”的众所周知的 SOAP 示例。

*   **NON-REST-NEITHER-SOAP**：是的，“Web 服务建模”的领域包括其他东西（例如[XML-RPC](http://xmlrpc.scripting.com/spec)）。

## REST 条件中的 SOAP

比较可比较的东西：*SOAP-REST*与*NON-SOAP-REST*。

### 优点

解释一些术语，

*   *合同稳定性*：适用于各种合同（如“书面协议”），

    *   通过*使用标准：* [W3C 堆栈](http://en.wikipedia.org/wiki/Web_services_protocol_stack)的所有级别 都是相互兼容的。另一方面，REST 不是 W3C 或 ISO 标准，并且没有关于服务外围设备的规范化细节。所以，正如[我](https://stackoverflow.com/a/13969577/287948)，@DaveWoldrich（20 票），@cynicalman（5），@Exitos（0）之前所说，在需要标准的上下文中，你需要 SOAP。

    *   通过*使用最佳实践：* *W3C 堆栈*实现的“详细方面”翻译相关的人类/法律/司法协议。

*   *鲁棒性*：SOAP 结构和标头的安全性。通过元数据通信（具有 XML 的完整表达能力）和[验证](http://en.wikipedia.org/wiki/Formal_verification)，您拥有针对任何更改或噪音的“保险政策”。
    SOAP 具有“处理通信故障的事务可靠性 (...)。SOAP 对重试逻辑有更多的控制，因此可以提供更多的端到端可靠性和服务保证”，[E. Terman](http://esj.com/Articles/2011/08/01/SOAP-and-REST-101.aspx?Page=2)。

按受欢迎程度对专业人士进行排序，

*   **更好的工具**（约 70 票）：自 2007 年到 2012 年，SOAP 目前具有更好工具的优势，因为它是一个定义明确且被广泛接受的标准。参见@MarkCidade（27 票）、@DaveWoldrich（20）、@JoshM（13）、@TravisHeseman（9）。

*   **标准合规性**（25 票）：正如[我](https://stackoverflow.com/a/13969577/287948)、@DaveWoldrich（20 票）、@cynicalman（5）、@Exitos（0）之前所说，在需要标准的情况下，您需要 SOAP。

*   **稳健性**：SOAP 标头的保险，@JohnSaunders（8 票）。

### 缺点

*   **SOAP 结构更复杂**（超过 300 票）：这里的所有答案，以及有关“SOAP 与 REST”的来源，都表现出对 SOAP 的冗余和复杂性的某种程度的厌恶。这是*形式验证*（见下文）和*稳健性*（见上文）要求的自然结果。“REST NON-SOAP”（以及 XML-RPC，[SOAP 的发起者](http://en.wikipedia.org/wiki/XML-RPC#History)）可以更加简单和非正式。

*   **使用小型服务（约 50 票）时**，“仅 XML”限制是性能障碍：请参阅**[json.org/xml](http://www.json.org/xml.html)和[这个问题](https://stackoverflow.com/q/4862310/287948)，或[其他](https://stackoverflow.com/q/3951047/287948)问题。这一点由@toluju(41) 和其他人展示。
    PS：由于[JSON 不是 IETF 标准](https://www.rfc-editor.org/rfc/rfc4627)，但我们可以考虑成为Web 软件社区*事实上的标准*。**

 *** * *

## 使用 SOAP 建模服务

现在，我们可以添加*SOAP-NON-REST*与*NON-SOAP-REST*比较，并解释**何时使用 SOAP 更好**：

*   *需要标准*和稳定的合约（参见“PROS”部分）。PS：参见[@saille 描述的典型“B2B 需要标准”](https://stackoverflow.com/a/7521548/287948)。

*   *需要工具*（参见“PROS”部分）。PS：*标准*和*形式验证*的存在（见下文）是工具自动化的重要问题。

*   *并行繁重处理*（请参阅下面的“上下文/基础”部分）：对于更大和/或更慢的进程，无论 SOAP 稍微复杂一点，可靠性和稳定性都是最好的投资。

*   *需要更多安全性*：当需要的不仅仅是 HTTPS，并且您确实需要额外的保护功能时，SOAP 是更好的选择（[参见 @Bell](https://stackoverflow.com/a/853732/287948)，32 票）。“沿着比请求/响应更复杂的路径或通过不涉及 HTTP 的传输方式发送消息”，[S. Seely](http://msdn.microsoft.com/en-us/library/ms977327.aspx)。XML 是一个核心问题，它提供了*XML 加密*、*XML 签名*和*XML 规范化的标准，并且只有使用 SOAP，您才能通过**WS-Security*等广为接受的标准将这些机制嵌入到消息中。

*   *需要更大的灵活性*（更少的限制）：SOAP 不需要与 URI 精确对应；不限制 HTTP；不需要限制为4个动词。正如@TravisHeseman（9 票）所说，如果您想要“灵活地用于任意数量的客户端技术和用途”，请使用 SOAP。
    PS：请记住，XML 比 JSON（等）更通用/更具表现力。

*   *需要[正式验证](http://en.wikipedia.org/wiki/Formal_verification)*：了解*W3C 堆栈*使用[正式方法](http://en.wikipedia.org/wiki/Formal_methods)很重要，而 REST 更非正式。您的 WSDL（一种[正式语言](http://en.wikipedia.org/wiki/Specification_language)）服务描述是您的 Web 服务接口的[正式规范](http://en.wikipedia.org/wiki/Formal_methods) ，而 SOAP 是一个健壮的协议，可以接受所有可能的 WSDL 规定。

# 语境

## 历史

评估趋势是必要的历史视角。对于这个主题，从 10 年或 15 年的角度来看……

在 W3C 标准化之前，存在一些无政府状态。很难实现具有不同框架的可互操作服务，并且实现公司之间可互操作的东西更加困难、昂贵和耗时。*W3C 堆栈*标准一直是一组复杂的 Web 服务互操作的一个轻量级标准。

对于日常任务，比如实现 AJAX，SOAP 很重......所以，需要简单的方法需要选择一个新的理论框架......还有大的“网络软件玩家”，如谷歌、亚马逊、 Yahoo 等人选择了最佳替代方案，即 REST 方法。在这种情况下，REST 概念作为“竞争框架”出现，而在今天（2012 年），这种替代方案已成为程序员的[事实上的标准](http://en.wikipedia.org/wiki/De_facto_standard)。

## 基础

在*并行计算*的上下文中，Web 服务提供并行子任务；和协议，如 SOAP，确保良好的同步和通信。不是“任何任务”：Web 服务可以归类为
[粗粒度和令人尴尬的并行性](http://en.wikipedia.org/wiki/Parallel_computing#Fine-grained.2C_coarse-grained.2C_and_embarrassing_parallelism)。

随着任务变得越来越大，“复杂性辩论”变得不那么重要，而与通信的稳健性和合约的可靠性变得更加相关。

* * *

## 回答 #15

> 赞同：9
> 
> 时间：2008-09-16T20:28:22.627

它很微妙。

如果您需要与您的服务有其他系统接口，那么由于您对合同、WSDL 和 SOAP 标准的“验证”层，很多客户会更喜欢 SOAP。

对于调用系统的日常系统，我认为当一个简单的 HTML 调用就可以时，SOAP 是很多不必要的开销。

* * *

## 回答 #16

> 赞同：9
> 
> 时间：2013-10-19T07:04:13.213

我正在看同样的东西，我认为 **它们是针对不同问题的不同工具**。

简单对象访问协议 (SOAP) 标准是一种定义消息架构和消息格式的 XML 语言，被 Web 服务使用，它包含对操作的描述。WSDL 是一种基于 XML 的语言，用于描述 Web 服务以及如何访问它们。将在 SMTP、HTTP、FTP 等上运行。需要中间件支持、定义良好的机制来定义 WSDL+XSD、WS-Policy 等服务 SOAP 将返回基于 XML 的数据 SOAP 提供安全性和可靠性标准

具象状态转移 (RESTful) Web 服务。它们是第二代 Web 服务。RESTful Web 服务通过 HTTP 而不是基于 SOAP 的服务进行通信，并且不需要 XML 消息或 WSDL 服务 API 定义。对于 REST，不需要中间件，只需要 HTTP 支持。WADL 标准，REST 可以返回 XML、纯文本、JSON、HTML 等

许多类型的客户端更容易使用 RESTful Web 服务，同时使服务器端能够发展和扩展。客户可以选择使用服务的部分或全部方面，并将其与其他基于 Web 的服务混合。

1.  REST 使用标准 HTTP，因此创建客户端、开发 API 更简单
2.  REST 允许许多不同的数据格式，例如 XML、纯文本、JSON、HTML，而 SOAP 只允许 XML。
3.  REST 具有更好的性能和可扩展性。
4.  休息并且可以被缓存而SOAP不能
5.  SOAP 没有错误处理的内置错误处理
6.  REST 对 PDA 和其他移动设备特别有用。

REST 是易于与现有网站集成的服务。

SOAP 具有一组协议，这些协议提供安全性和可靠性等标准，并与其他符合 WS 的客户端和服务器互操作。SOAP Web 服务（例如 JAX-WS）在处理异步处理和调用方面很有用。

对于复杂 API 的 SOAP 会更有用。

* * *

## 回答 #17

> 赞同：8
> 
> 时间：2011-08-16T23:03:56.953

REST 是 Roy Fielding 发明的一种架构，在他的论文[架构风格和基于网络的软件架构的设计中进行](http://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm)了描述。Roy 也是 HTTP 的主要作者 - [HTTP](http://www.w3.org/Protocols/rfc2616/rfc2616.html)定义了万维网上文档传输的协议。HTTP 是一种 RESTful 协议。当开发人员谈论“使用 REST Web 服务”时，说“使用 HTTP”可能更准确。

SOAP 是一种基于 XML 的协议，它在 HTTP 请求/响应中进行隧道传输，因此即使您使用 SOAP，您也在使用 REST。关于 SOAP 是否向基本 HTTP 添加任何重要功能存在一些争论。

在编写 Web 服务之前，我建议学习 HTTP。奇怪的是，您的要求可以使用规范中已经定义的功能来实现，因此不需要其他协议。

* * *

## 回答 #18

> 赞同：7
> 
> 时间：2011-06-17T17:16:17.030

我正在研究同样的问题。在我看来，实际上 REST 快速、简单，适用于轻量级调用和响应，并且非常适合调试（这可能比将 URL 输入浏览器并查看响应更好）。

然而，REST 似乎失败的地方在于它不是一个标准（尽管它是由标准组成的）。大多数编程库都有一种检查 WSDL 的方法，以自动生成使用基于 SOAP 的服务所需的客户端代码。到目前为止，使用基于 REST 的 Web 服务似乎是一种更特别的方法，可以编写一个接口来匹配可能的调用。发出手动 http 请求，然后解析响应。这本身就很危险。

SOAP 的美妙之处在于，一旦发布了 WSDL，那么业务就可以构建他们的逻辑环绕，即设置合同对接口的任何更改都会更改 wsdl。没有任何回旋余地。您可以针对该 WSDL 验证所有请求。但是，由于 WSDL 没有正确描述 REST 服务，因此您无法就通信接口达成一致意见。

从商业角度来看，这似乎确实让沟通变得容易被解释和改变，这似乎是个坏主意。

该线程中的顶部“答案”似乎说 SOAP 代表简单的面向对象访问协议，但是查看 wiki 中的 O 表示对象不是面向对象的。它们是不同的东西。

我知道这篇文章已经很老了，但我认为我应该用我自己的发现来回应。

* * *

## 回答 #19

> 赞同：6
> 
> 时间：2008-09-16T20:29:16.243

这是一个很好的问题......我不想让你误入歧途，所以我和你一样愿意接受其他人的答案。对我来说，这实际上归结为开销成本和 API 的用途。在创建客户端软件时，我更喜欢使用 Web 服务，但是我不喜欢 SOAP 的重量。我相信 REST 的重量更轻，但从客户的角度来看，我不太喜欢使用它。

我很好奇别人怎么想。

* * *

## 回答 #20

> 赞同：6
> 
> 时间：2008-12-20T19:58:42.600

收听[这个播客](http://www.se-radio.net/2008/05/episode-98-stefan-tilkov-on-rest/)找出答案。如果你想不听就知道答案，那么好吧，它的 REST。但我真的建议听。

* * *

## 回答 #21

> 赞同：6
> 
> 时间：2013-05-15T15:33:36.170

我的一般规则是，如果您希望浏览器 Web 客户端直接连接到服务，那么您可能应该使用 REST。如果要在后端服务之间传递结构化数据，请使用 SOAP。

有时设置 SOAP 确实很痛苦，而且对于简单的 Web 客户端和服务器数据交换而言，它通常是多余的。不幸的是，我见过（并从中学到的）大多数简单的编程示例都在某种程度上强化了这种看法。

也就是说，当您开始将多个 SOAP 服务组合在一起作为由数据工作流（想想企业软件）驱动的更大流程的一部分时，SOAP 真的会大放异彩。这是许多 SOAP 编程示例未能传达的内容，因为用于执行某些操作（例如获取股票价格）的简单 SOAP 操作通常对于它本身所做的操作来说过于复杂，除非它在提供机器的上下文中呈现可读的 API 详细说明了具有用于输入和输出的设定数据格式的特定功能，而这些数据格式又由更大的进程编写脚本。

这在某种程度上是可悲的，因为它确实给 SOAP 带来了坏名声，因为如果不在最终产品的使用方式的完整上下文中展示 SOAP 的优势，就很难展示它。

* * *

## 回答 #22

> 赞同：4
> 
> 时间：2013-01-07T07:00:42.700

**SOAP**体现了一种面向服务的 Web 服务方法——其中方法（或动词）是您与服务交互的主要方式。**REST**采用面向资源的方法，其中对象（或名词）占据中心位置。

* * *

## 回答 #23

> 赞同：4
> 
> 时间：2013-02-26T17:03:49.263

从某种意义上说，“PHP 世界”对任何高级 SOAP 的 PHP 支持都非常耗时。一旦满足基本需求，您最终将使用类似[http://wso2.com/products/web-services-framework/php/的东西，甚至启用 WS-Security 或 WS-RM 没有内置支持。](http://wso2.com/products/web-services-framework/php/)

我觉得在 PHP 中创建 SOAP 信封非常混乱，它创建名称空间的方式、xsd:nil、xsd:anytype 和老式的肥皂服务在 SOAP 消息中使用 SOAP 编码（天知道有什么不同）。

通过坚持使用 REST 来避免所有这些混乱，自 WWW 开始以来，我们一直在使用 REST 并没有什么大不了的。[我们只有在这篇http://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm](http://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm)论文发表时才意识到，它展示了我们如何使用 HTTP 功能来实现 RESTFul 服务。HTTP 本质上是 REST，这并不意味着仅使用 HTTP 会使您的服务成为 RESTFul。

SOAP 忽略了 HTTP 的核心功能，将 HTTP 视为一种传输协议，因此它在理论上是独立于传输协议的（实际上并非如此，您是否听说过 SOAP Action 标头？如果不是现在谷歌它！）。

随着 JSON 适配的增加和 HTML5 与 javascript 的成熟 REST 与 JSON 已成为处理服务的最常见方式。JSON Schema 也已定义可用于企业级解决方案（仍处于早期阶段）以及 WADL（如果需要）。

PHP 对 REST 和 JSON 的支持肯定比现有的内置 SOAP 支持更好。

在此处添加更多 BUZZ 词 SOA、WOA、ROA

[http://blog.dhananjaynene.com/2009/06/rest-soa-woa-or-roa/](http://blog.dhananjaynene.com/2009/06/rest-soa-woa-or-roa/)

[http://www.scribd.com/doc/15657444/REST-White-Paper](http://www.scribd.com/doc/15657444/REST-White-Paper)

顺便说一句，我确实喜欢 SOAP，尤其是 WS-Security 规范，这是一个很好的规范，如果有人考虑企业 JSON 适配，肯定需要为 JSON 提供一些类似的东西，比如字段级加密等。

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2013-11-12T11:55:51.023

一个快点——传输协议和编排；

出于速度、可靠性和安全性的原因，我使用 SOAP over TCP，包括编排的机器对机器服务 (ESB) 和外部服务。更改服务定义，编排会从 WSDL 更改中引发错误，并且其立即显而易见并且可以重新构建/部署。

不确定您是否可以对 REST 做同样的事情 - 我正在等待更正或课程！使用 REST，更改服务定义 - 在它返回 400（或其他）之前，什么都不知道。

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2008-09-16T20:34:18.620

如果您正在寻找不同系统和语言之间的互操作性，我肯定会选择 REST。例如，我在尝试让 SOAP 在 .NET 和 Java 之间工作时遇到了很多问题。

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2016-01-23T11:53:30.167

我创建了一个基准来查找其中哪些更快！我看到了这个结果：

对于 1000 个请求：

*   REST 耗时 3 秒
*   SOAP 耗时 7 秒

10,000 个请求：

*   REST 耗时 33 秒
*   SOAP 耗时 69 秒

对于 1,000,000 个请求：

*   REST 耗时 62 秒
*   SOAP 耗时 114 秒

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2015-03-12T02:46:49.400

一个古老的问题，但今天仍然相关......由于企业领域的许多开发人员仍在使用它。

我的工作涉及设计和开发 IoT（物联网）解决方案。其中包括为与云通信的小型嵌入式设备开发代码。

很明显，REST 现在已被广泛接受和使用，并且几乎是 Web 的事实上的标准，甚至 Microsoft 在整个 Azure 中都包含 REST 支持。如果我需要依赖 SOAP，我将无法做我需要做的事情，因为它对于小型嵌入式设备来说太大、笨重且烦人。

REST 简单、干净、小巧。使其成为小型嵌入式设备的理想选择。当我与向我发送 WSDL 的 Web 开发人员一起工作时，我总是尖叫。因为我将不得不开始一场关于为什么这不起作用以及为什么他们必须学习 REST 的教育活动。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2015-09-30T07:01:47.297

1.根据我的经验。我想说 REST 让您可以选择访问已经构建的 URL。例如-> google 中的单词搜索。该 URL 可以用作 REST 的 Web 服务。在 SOAP 中，您可以创建自己的 Web 服务并通过 SOAP 客户端访问它。

2.  REST 支持文本、JSON、XML 格式。因此，对于两个应用程序之间的通信更加通用。而 SOAP 只支持 XML 格式的消息通信。

# html - 页面无法显示

> ID：76601
> 
> 赞同：1
> 
> 时间：2008-09-16T20:26:44.550
> 
> 标签：html

我有一个客户，只要他们在他们的网站上执行某个操作，就会看到“无法显示页面”（没有别的）。我从来没有得到错误。我尝试过 IE、FF、Chrome，但没有看到错误。客户端在 IE 上看到错误。

当他们按下只有隐藏字段的表单提交按钮时会发生错误。

我认为这可能是某种反恶意软件/病毒问题。有没有人处理过这个问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T20:32:33.757

在 IE 中，转到“Internet 选项”的“高级”部分并取消选中“显示友好的 HTTP 错误”。这应该给你*真正的*错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T20:37:23.697

这是 IE 消息吗？要求他们在 IE 选项深处的某处关闭“短错误消息”（或英文版中的任何名称） - 这将使 IE 显示您的服务器正在发送的错误消息，而不是其自身无用的消息。

此外，我听说如果页面足够长/足够大，IE 可能会被迫显示服务器提供的错误消息，因此您可能希望在错误消息中添加更长的“   ”部分。这些信息已经足够老了，它可能会影响旧版本的 IE - 我通常会通过消除“短错误消息”来找到问题的根源

注意：我既没有运行IE也没有运行Windows，因此关于IE6的配置选项名称只能在内存上操作......

*更新*：更正建议中的用法以提供更长的错误消息...如果更长的错误页面仍然强制 IE 显示原始错误页面而不是*用户友好的*（原文如此）页面，那么可能有权访问 IE 的人可以批准。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T20:29:39.690

找出返回的错误代码对您很有用。是 404 - 找不到资源还是 503 - 禁止访问？还有一些，但无论如何，它会帮助您找出问题的原因。

如果您的客户端运行的是 IE，请让他在高级选项中禁用友好的错误消息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T20:31:23.477

检查他们的“主机文件”。这个文件的位置对于 XP 和 vista 是不同的

在 XP 中我相信它是`C:\windows\hosts`或`C:\windows\system32\hosts`

寻找任何可疑的域。一般来说，在定义 localhost 和其他本地 ip 定义的文件中应该只有 ~2 个定义（除了注释）。如果还有其他东西，请确保它应该在那里。

否则，也许该网站只是有问题？另外，AFAIK，FF 从不显示“无法显示页面”，所以您确定所有浏览器都是这种情况吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T20:48:50.847

您可以尝试使用 ieHTTPHeaders 查看幕后发生的情况。

您是否有任何事件应用于您的提交按钮？您是否正在做一个自定义提交按钮，它是一个带有“javascript:void(0)”之类的超链接的超链接和一个提交表单的附加事件？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-03-11T15:55:37.390

虽然这是一个 2008 年的线程，
但我想也许有人像我一样在 2018 年仍然在虚拟机中使用 windows xp。

我在2018年遇到的问题是：
1\. ping 8.8.8.8 能得到正确响应。
2\. HTTP 站点工作正常，但 HTTPS 不行。
3\. 我无法使用 HTTPS 连接到任何网站，因此无法下载 Chrome 或 Firefox。

我的解决方案是启用`TLS 1.0`安全连接
一切都很好。

[![在此处输入图像描述](https://i.stack.imgur.com/Bhdus.png)](https://i.stack.imgur.com/Bhdus.png)

# refactoring - 重写遗留代码

> ID：76622
> 
> 赞同：18
> 
> 时间：2008-09-16T20:28:22.813
> 
> 标签：refactoring, cobol, legacy, maintenance

我的部门目前面临着维护相当大的 COBOL 代码库的任务。我们想知道如何添加新功能以满足业务需求。现在 COBOL 程序员很难找到，而且我们还认为使用 Java 或 C# 等更现代的语言可以提高工作效率。

我们觉得我们有四种选择：

1.  从头开始重写所有内容，将旧应用程序留给自己，直到它准备好被替换
2.  从头开始重写一切，让一些人维护旧应用程序以应对新的业务需求，因为正在构建新的应用程序
3.  用现代语言编写所有新功能，并找到将新代码与旧功能集成的方法。
4.  继续维护旧应用程序。

您认为对我们来说最好的选择是什么，为什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-16T20:42:43.980

诚然，问题涉及 cobol，它会根据您的需求给出任何答案，如果您说“我们有一个旧的 VB 应用程序”或旧的 C 应用程序，那么选项 #3 始终是正确的选择。

我曾在 3 家决定选择选项 2 的公司工作过。2 试图为新系统买单而破产，而只能从旧系统中获得收入，3 确实非常接近。

opetion #3 的另一个因素是您可以保留多年来所做的所有旧错误修复。每次重写都会引入越来越多的错误，部分原因是您希望快速完成重写，部分原因是您将使用一种新的、不熟悉的语言编写它，部分原因是所有新代码都有错误。

重构并替换旧应用程序的逻辑块，最终您将拥有一个漂亮闪亮的新应用程序。从 GUI 开始，以获得最安全的新方法。此外，当你用新的东西重写应用程序时，更新的东西将是最酷的，你的新应用程序将过时，你将再次发布相同的问题！

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-02T22:26:11.223

这是选项 3 的变体：

[Microfocus](http://www.microfocus.com/)提供了一个名为 Enterprise Server 的工具，它允许 COBOL 与 Web 服务进行交互。

如果您有一个 COBOL 程序 A 和另一个 COBOL 程序 B 并且 A 通过接口部分调用 B，则该工具允许您将 B 的接口部分公开为 Web 服务。

对于程序 A，然后生成客户端代理，A 现在可以通过 Web 服务调用 B。

当然，因为 B 现在有一个 Web 服务，任何其他类型的程序（命令行、Windows 应用程序、Java、ASP 等）现在也可以调用它。

使用这种方法，您可以“蚕食边缘”，将 GUI 移动到使用 ASP 之类的现代、基于浏览器的方法，同时仍然使用 COBOL 业务引擎。

一旦你拥有了一套不错的 Web 服务，它们就可以用于任何新的开发，从长远来看，它提供了一种远离 COBOL 的方式。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-16T20:33:58.683

尝试完全重写时要小心。对于许多软件公司来说，有很多这样的例子。网景是一个[典型的例子](http://www.joelonsoftware.com/articles/fog0000000069.html)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-16T20:45:25.877

**遵守 80/20 规则。**与客户坐下来，为获得 80% 使用率的 20% 的应用编写规范。在现代系统中写下来。然后要么保留旧系统以减少特殊情况的数量，要么在充实新系统时逐步淘汰它。

**不要试图 100% 重写旧代码。**这很愚蠢。最好的情况是您拥有一个过时系统的完整端口。最坏的情况是您花费大量时间和金钱来建立一个失败的新系统，而您仍然坚持使用旧系统。

花时间和精力来改进系统，而不仅仅是移植它。在移植了最重要的部分之后，利用时间重新考虑特殊情况。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-16T20:34:55.217

选项#2 和#3 是您的最佳选择。如果您的 COBOL 应用程序将其数据存储在 SQL DB 或其他一些健全的格式中，您可以从最便宜/最简单的解决方案的现代语言轻松访问。

如果没有，那么在您重建时，需要有人在工作人员中实施关键的新功能。但我仍然建议要求每个人将旧代码库中的新功能限制在真正关键的功能上。

从长远来看，维护 COBOL 只会变得更加困难。你等待的时间越长，它就越难。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-16T21:02:36.680

逐步迁移应用程序？

有没有一种方法可以将其他代码连接到 COBOL，并随着变化的涌现逐渐重写组件？您可能永远无法摆脱所有这些，但这真的重要吗？

重写现有代码通常是一个坏主意。这将是非常冒险的（例如，可能会破坏某人所依赖的一些知之甚少的功能）并且会花费大量时间而没有实现大多数利益相关者可见的任何有用的东西。

如果需要，不要假设一个称职的程序员将无法学习 COBOL——一种编程语言与另一种很相似。如果您雇用（比如）C++ 或 Java 方面有能力的人，他们将能够学习 COBOL。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2010-01-06T14:22:59.927

我自己已经将旧系统迁移到新系统（尽管规模要小得多）。

对于客户端/服务器系统（一种小型的内部编写的报告系统），我们非常成功地使用了“逐步替换”（#2）方法。实际上，我们通过使用“代理”方法做了一些改动：

*   首先，我们实现了一个新服务器，它提供了旧服务器的所有功能/调用接口，但在内部只是将所有内容委托给了旧服务器，它一直在运行。
*   然后所有客户端都切换到新系统；这是相对轻松的，因为新系统本质上只是一个包装器。
*   最后，我们逐渐重写了新服务器以实现功能，而无需回调旧系统。

这种方法提供了很大的灵活性，并且允许在不触及旧代码的情况下实现新的东西。转换持续了一年多，应用程序的最后部分仅迁移到新系统，因为旧服务器运行在专用的、老化的硬件上，即将退役。

我实际上是在迁移所有内容时亲自下到服务器机房将旧服务器关闭。那很有趣 ：-）。

顺便说一句，这种“逐渐转换”的方法还允许我们在新系统中实现一些日志记录，以决定使用哪些功能的频率。这样，一些旧的服务器功能可能会被废弃，因为事实证明客户端不再使用它。这是“代理”方法的一个显着优势。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-07T15:13:39.527

我会使用 Microfocus/AcuCOBOL 中的一些很棒的东西来维护旧代码并为其添加新功能。您可以直接从“遗留”代码中创建 GUI 应用程序并调用 .NET 和 Java 内容。

如果它对你有用，为什么要打破后端？保留工作的后端并更换疲惫的前端是我工作的公司开始采用的解决方案。

所以我想我的选择是选项#3，因为那里有这样的解决方案。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-10-30T16:41:05.033

数据不足，无法确定正确的路线。

尽管许多人在特定情况下给出了适当的答案，但正确的答案实际上取决于您公司所处的业务情况。

现有的路线图、交付承诺、服务合同、新功能所需的发布时间等将决定什么是最适合您的情况。

也就是说，许多技术专家的答案是#1，而许多商务人士的答案是#4。只知道所呈现的内容，我会推动团队深入调查#3，因为它可能是最低风险。＃1有失败的记录，而＃2只是资源较少的＃1。#4 可能不是一个长期的解决方案，除非您在近期/中期终止此产品线。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-16T20:32:28.343

老实说，在帮助将应用程序从 ColdFusion 5“移植”到 PHP 到 ColdFusion 8 之后，我会说选择 #1。保留旧应用程序并冻结开发。与客户会面并说明新功能是什么，以及旧系统如何工作/应该如何工作并生成良好的需求文档。剩下的只是构造和设计细节，然后您可以智能地为您的应用程序选择最佳语言和平台。

在我现在工作的地方，我们实际上是在构建替换的 .NET 应用程序时维护一个旧的 CF 应用程序。您能想象 .NET 人员在完成基本应用程序后必须编写的代码吗？这就是为什么我建议冻结开发。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-16T20:40:47.917

我坚信将遗留应用程序更新为尖端技术（这让我的经理很沮丧）。这应该始终是一个分阶段的方法，并且只有在必要时才进行。尝试保持遗留应用程序运行并服务于它的目的，但在更新的技术中创建它的一小部分，并且随着时间的推移逐步淘汰旧代码并用更新的代码替换它。我总是确保我优先考虑这些对企业的收益/成本。

如果应用程序过于紧密，那么听起来您需要聘请一些 COBOL 脚本编写人员来帮助提取隔离的服务，以便在准备好时可以将它们贬低。

请注意：有时原始遗留代码中的错误和怪癖服务于业务所依赖的目的，因此请注意修复其他代码以后依赖的错误。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-16T20:53:02.520

另一种解决方案可能是：

*将代码翻译成您选择的现代语言。*

通常，这将涉及几个大块：

*   重写旧版应用程序中无法翻译的部分。至少，在任何地方都使用结构化编程结构。
*   实现一个[内部 DSL](http://martinfowler.com/dslwip/InternalOverview.html)，它可以更容易地将旧语言的结构映射到新语言中。
*   为 90% 的代码实现一次性源代码翻译器。
*   手动翻译剩余 10% 的棘手代码。
*   花大量时间编译该死的东西。
*   通过一些认真的测试和修复来完成整个事情。
*   慢慢清理产生的动物，使其具有惯用语。

这种方法的主要优点是它将保留多年来在代码库中编码的所有令人讨厌的业务角落案例。从头开始重写的最大问题是它们丢弃了所有这些积累的知识。

另一个优点是它把一个烦人的问题（维护一个 cobol 应用程序）变成了一个有趣的问题（自动语言翻译），所以你有机会让一个优秀的程序员参与这个项目。

> 吉姆丹佛评论
> 
> > 编写一个可以翻译成可读性和可维护性代码的翻译器不是很难吗？我们的问题是 COBOL 应用程序是维护的噩梦。我们不希望这成为另一种语言的噩梦。

我说不出会有多难。如果您开始的代码是常规的，那就更容易了。但无论如何，您最终都会得到“用 $LANG 编写的 COBOL”。这只是增量重写的起点，直到修复了维护噩梦。

这只是“从头开始重写”和“在 COBOL 中维护”的替代方案。可能只是代码库中积累的知识价值低于增量清理的预期成本。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-10-30T16:34:48.480

如何使用第三方应用程序之一，该应用程序采用 cobol 并将其转换为 C#，例如：

[http://www.softwaremining.com/index.jsp](http://www.softwaremining.com/index.jsp)

或者将其移植到 COBOL.net，这应该更容易，然后您添加的所有内容都可以使用其他 .net 语言之一。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-09-17T13:08:19.853

我会维护旧的应用程序，但是，我是一名 cobol 程序员....

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-10-30T16:59:31.550

如果您使用 OpenVMS，[BridgeWorks](http://h71000.www7.hp.com/commercial/bridgeworks/faq.html)可以帮助您使用旧代码稍作修改来构建 Web 应用程序。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-10-30T16:35:18.573

COBOL 的美妙之处在于，数据要求就在代码的顶部进行了说明。COBOL 被设计为使用（相对）简单的商务英语（TXTSPKers 不需要申请）编写也有帮助。

当然，如果您的割草机比您的某些程序员年长，请忘记让他们阅读源代码。他们只会抱怨太多。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-10-30T16:44:09.927

我认识的一家公司多年来一直在为同样的问题苦苦挣扎；最终，他们放弃了 COBOL 应用程序并转而使用 SAP。这样做是一个巨大的项目，需要几年时间才能完成，但效果很好。

# c++ - C ++中的64位枚举？

> ID：76624
> 
> 赞同：19
> 
> 时间：2008-09-16T20:28:33.233
> 
> 标签：c++, enums, 64-bit

有没有办法在 C++ 中使用 64 位枚举？在重构一些代码时，我遇到了一堆#defines，它们作为枚举会更好，但大于 32 位会导致编译器出错。

出于某种原因，我认为以下方法可能有效：

```
enum MY_ENUM : unsigned __int64  
{  
    LARGE_VALUE = 0x1000000000000000,  
}; 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-16T20:32:14.020

我认为 C++98 不可能。枚举的底层表示由编译器决定。在这种情况下，您最好使用：

```
const __int64 LARGE_VALUE = 0x1000000000000000L; 
```

从 C++11 开始，可以使用枚举类来指定枚举的基本类型：

```
enum class MY_ENUM : unsigned __int64 {
    LARGE_VALUE = 0x1000000000000000ULL
}; 
```

此外，枚举类引入了一个新的名称范围。因此，不要引用`LARGE_VALUE`，而是引用`MY_ENUM::LARGE_VALUE`。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-16T20:56:40.843

C++11 支持这一点，使用以下语法：

```
enum class Enum2 : __int64 {Val1, Val2, val3}; 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-04-13T15:27:59.450

所谓的[C++0x](http://en.wikipedia.org/wiki/C%2B%2B0x)的当前草案，即[n3092](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2010/n3092.pdf)在**7.2 Enumeration declarations**第 6 段中说：

> 使用哪种整数类型作为基础类型由实现定义，除非基础类型不得大于 int，除非枚举数的值不能适合 int 或 unsigned int。

同一段还说：

> 如果没有整数类型可以表示所有枚举数值，则枚举格式错误。

除非枚举器的 **值不能适合 int 或 unsigned** int执行。

例如：

```
enum MyEnum
{
    Undefined = 0xffffffffffffffffULL
}; 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-17T09:42:45.010

答案是指`__int64`错过的问题。枚举在所有具有真正 64 位整数类型的 C++ 编译器中有效，即任何 C++11 编译器或具有适当扩展的 C++03 编译器*。*对 C++03 的扩展`__int64`在编译器中的工作方式不同，包括它作为枚举的基本类型的适用性。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-16T20:37:58.937

如果编译器不通过编译标志或任何其他方式支持 64 位枚举，我认为没有解决方案。

您可以在示例中创建类似的内容，例如：

```
namespace MyNamespace {
const uint64 LARGE_VALUE = 0x1000000000000000;
}; 
```

并像使用枚举一样使用它

```
MyNamespace::LARGE_VALUE 
```

或者

```
using MyNamespace;
....
val = LARGE_VALUE; 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-16T20:34:00.150

由于您使用 C++，另一种选择可能是

```
const __int64 LARVE_VALUE = ... 
```

这可以在 H 文件中指定。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-16T20:38:00.763

您的代码片段不是 C++ 标准：

> 枚举 MY_ENUM : 无符号 __int64

没有意义。

正如 Torlack 建议的那样，改用 const __int64

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-12-07T02:05:00.500

枚举类型通常由第一个枚举初始值设定项的数据类型确定。如果该值应超出该整数数据类型的范围，则 c++ 编译器将确保它适合使用更大的整数数据类型。如果编译器发现它不属于任何整数数据类型，则编译器将抛出错误。参考：[http](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2005/n1905.pdf)
://www.open-std.org/jtc1/sc22/wg21/docs/papers/2005/n1905.pdf编辑：但这完全取决于机器架构

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-16T20:30:32.077

C++ 中的枚举可以是任何整数类型。例如，您可以有一个字符枚举。IE：

```
enum MY_ENUM
{
   CHAR_VALUE = 'c',
}; 
```

我*假设*这包括 __int64。试一试

```
enum MY_ENUM
{
   LARGE_VALUE = 0x1000000000000000,
}; 
```

根据我的评论者，sixlettervariables 的说法，在 C 中，基本类型将始终是 int，而在 C++ 中，基本类型是大到足以容纳最大包含值的任何内容。所以上面的两个枚举都应该工作。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-09-24T09:05:10.857

在 MSVC++ 中，您可以这样做：

枚举 MYLONGLONGENUM:__int64 { BIG_KEY=0x3034303232303330, ... };

# c# - 使用 Visual Studio 在 Windows 上混合 C# 代码和非托管 C++ 代码

> ID：76629
> 
> 赞同：6
> 
> 时间：2008-09-16T20:28:49.147
> 
> 标签：c#, windows, visual-c++, unmanaged

我想从我的 C# 代码中调用我的非托管 C++ 库。有哪些潜在的陷阱和需要采取的预防措施？感谢您的时间。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T20:33:14.830

有几种方法可以使用 - 一种，您可以更新非托管 C++ 库，使其周围有一个托管 C++ 扩展包装器，并让 C# 直接利用这些类。这有点费时，但它为遗留非托管代码提供了一个很好的桥梁。但请注意，托管 C++ 扩展有时难以自行导航，因为语法类似于非托管 C++，但足够接近，训练有素的眼睛将能够看到差异。

另一条途径是让你的非管理 C++ 实现 COM 类，并让 C# 通过自动生成的互操作程序集使用它。如果您对 COM 有足够的了解，这种方式会更容易。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T20:40:22.333

您正在描述 P/Invoke。这意味着您的 C++ 库需要通过 DLL 接口公开自己，并且该接口需要足够简单，以便通过调用属性向 P/Invoke 描述。当托管代码调用非托管世界时，必须对参数进行编组，因此似乎可能会对性能造成轻微影响，但您必须进行一些测试以查看编组是否重要。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T20:46:21.727

最简单的开始方法是确保所有 C++ 功能都公开为“C”风格的函数。确保将函数声明为 _stdcall。

extern "C" __declspec(dllexport) int _stdcall Foo(int a)

确保你得到正确的编组，尤其是指针和 wchar_t * 之类的东西。如果你弄错了，可能很难调试。

从任一侧调试它，但不能同时调试它。在调试混合原生和托管时，调试器会变得非常慢。一次调试一侧可以节省大量时间。

变得更具体需要一个更具体的问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T21:32:27.653

这个问题太笼统了。唯一合理的答案是 P/Invoke，但这有点像说，如果你想为 Windows 编程，你需要知道 Win32 API。

几乎整本书都是关于 P/Invoke ( [http://www.amazon.com/NET-COM-Complete-Interoperability-Guide/dp/067232170X](https://rads.stackoverflow.com/amzn/click/com/067232170X) )，当然还有整个网站：[http:// www.pinvoke.net/](http://www.pinvoke.net/)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T20:39:28.967

您还可以通过 P/Invoke 调用非托管代码。如果您的代码当前不使用 COM，这可能会更容易。如果你走这条路，我想你可能需要使用“C”绑定在你的代码中编写一些特定的导出点。

根据我的经验，您需要注意的最重要的事情可能是缺乏确定性垃圾收集意味着您的析构函数不会像您以前认为的那样运行。您需要牢记这一点，并使用 IDisposable 或其他方法来确保您的托管代码在需要时被清理。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T20:44:32.900

当然，如果您将代码打包为带有外部入口点的 DLL，那么总会有 PInvoke。没有一个选项是无痛的。它们取决于 a) 你在编写 COM 或托管 C 包装器方面的技能 b) 在 PInvoke 中碰巧你的手臂。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T21:00:21.677

我会看一下[swig](http://www.swig.org/)，我们使用它来对我们的项目产生良好的效果，以将我们的 C++ API 暴露给其他语言平台。

这是一个维护良好的项目，它有效地围绕您的 C++ 库构建了一个瘦包装器，它可以允许诸如 C# 之类的语言直接与您的本机代码进行通信 - 省去了您必须实现（和调试）胶水代码的麻烦。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T21:13:06.450

如果您想要一个好的 PInvoke 示例，您可以查看[PInvoke.net](http://www.pinvoke.net/)。它有如何调用大多数 win api 函数的示例。

您还可以使用本文[Clr Inside Out: PInvoke](http://msdn.microsoft.com/en-us/magazine/cc164193.aspx)中的工具，它将您的 .h 文件转换为 c# 包装器。

# linux - 使用 CUPS 打印，我的应用程序何时可以退出？

> ID：76637
> 
> 赞同：2
> 
> 时间：2008-09-16T20:29:25.883
> 
> 标签：linux, printing, cups

我有一个使用杯子进行打印的 linux 应用程序，但我注意到如果我打印然后立即退出我的应用程序，我的打印输出永远不会出现。所以我假设我的应用程序必须等待它在退出之前真正从打印机中出来，所以有谁知道如何判断它何时完成打印？

我正在使用 libcups 打印我的应用程序生成的 postscript 文件。所以我使用命令打印文件，然后返回到我的应用程序。所以我的应用程序认为该文档在我猜它还没有到达打印机队列时已经进入打印机队列。因此，与其让我的所有用户都必须在屏幕上查看系统托盘中的打印机图标，我宁愿有一个代码解决方案，所以如果他们在它真正被发送之前尝试退出，我可以提醒他们这个事实. 此外，我生成的文件是一个临时文件，所以很高兴知道它何时完成，以便我可以删除它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T11:34:03.790

一旦您的 CUPS Web 界面 (localhost:631) 或其他可以查看 CUPS 所见内容的内容显示您 CUPS 收到了工作，您就可以退出应用程序。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-10T11:24:21.330

`lpr`使用&之类的打印假脱机服务怎么样`lpq`？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-11T11:18:05.967

您当然不需要等到纸张从打印机中取出。但是，您需要等到 cupsd 在其假脱机区域（通常是`/var/spool/cups/`）中完全接收到您的临时文件。

如果您在命令行上打印（使用 CUPS`lp`或`lpr`命令之一），如果 shell 提示返回（该命令甚至会报告已发送作业的 CUPS 作业 ID）并且退出代码 ( `$?`) 为 0。

您没有指明您正在使用 libcups 的哪个部分以及哪个函数调用来实现您想要的。如果我必须这样做，我会使用 IPP 函数[`cupsSendRequest`](http://www.cups.org/documentation.php/doc-1.4/api-httpipp.html#cupsSendRequest)然后[`cupsGetResponse`](http://www.cups.org/documentation.php/doc-1.4/api-httpipp.html#cupsGetResponse)知道结果。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T20:42:16.993

当您退出时，您的应用程序可能尚未完成打印。如果您使用 evince 打印 PDF 或其他文档，这是一个已知错误 - 没有视觉确认打印操作正在进行中。如果已提交打印作业，系统托盘中将出现一个打印机图标，直到实际打印完成。您可以单击系统托盘中的打印机图标，查看当前正在运行和待处理的作业。

# perl - Perl：在 /Date/Manip.pm 处使用数字 lt (<) 中的未初始化值

> ID：76650
> 
> 赞同：4
> 
> 时间：2008-09-16T20:29:52.623
> 
> 标签：perl, date, module, warnings

这让我很困惑。此代码在另一台服务器上工作，但在 Perl v5.8.8 上失败，[Date::Manip](http://search.cpan.org/dist/Date-Manip)今天从 CPAN 加载。

```
Warning:
Use of uninitialized value in numeric lt (<) at /home/downside/lib/Date/Manip.pm line 3327.
at dailyupdate.pl line 13
        main::__ANON__('Use of uninitialized value in numeric lt (<) at
/home/downsid...') called at
/home/downside/lib/Date/Manip.pm line 3327
        Date::Manip::Date_SecsSince1970GMT(09, 16, 2008, 00, 21, 22) called at
/home/downside/lib/Date/Manip.pm line 1905
        Date::Manip::UnixDate('today', '%Y-%m-%d') called at
TICKER/SYMBOLS/updatesymbols.pm line 122
        TICKER::SYMBOLS::updatesymbols::getdate() called at
TICKER/SYMBOLS/updatesymbols.pm line 439
        TICKER::SYMBOLS::updatesymbols::updatesymbol('DBI::db=HASH(0x87fcc34)',
'TICKER::SYMBOLS::symbol=HASH(0x8a43540)') called at
TICKER/SYMBOLS/updatesymbols.pm line 565
TICKER::SYMBOLS::updatesymbols::updatesymbols('DBI::db=HASH(0x87fcc34)', 1, 0, -1) called at
dailyupdate.pl line 149
        EDGAR::updatesymbols('DBI::db=HASH(0x87fcc34)', 1, 0, -1) called at
dailyupdate.pl line 180
        EDGAR::dailyupdate() called at dailyupdate.pl line 193 
```

失败的代码很简单：

```
sub getdate()
{    my $err;                ## today
    &Date::Manip::Date_Init('TZ=EST5EDT');       
    my $today = Date::Manip::UnixDate('today','%Y-%m-%d'); ## today's date
    ####print "Today is ",$today,"\n";        ## ***TEMP***
    return($today);
} 
```

这是正确的; [Date::Manip](http://search.cpan.org/dist/Date-Manip)失败`"today"`。

[Date::Manip](http://search.cpan.org/dist/Date-Manip)中失败的行是：

```
 my($tz)=$Cnf{"ConvTZ"};  
  $tz=$Cnf{"TZ"}  if (! $tz);  
  $tz=$Zone{"n2o"}{lc($tz)}  if ($tz !~ /^[+-]\d{4}$/);  

  my($tzs)=1;  
  $tzs=-1 if ($tz<0); ### ERROR OCCURS HERE 
```

所以[Date::Manip](http://search.cpan.org/dist/Date-Manip)假设`$Cnf`已经用元素`"ConvTZ"`或`"TZ"`. 那些在 中初始化`Date_Init`，所以应该已经处理好了。

它只是在我的大程序中失败了。如果我只是提取`getdate()`上面的“”并独立运行它，就没有错误。所以有一些关于全球环境的东西会影响到这一点。

这似乎是一个已知但未理解的问题。如果您在 Google 上搜索“使用未初始化的生效日期操作”，则大约有 2400 次点击。[MythTV](http://www.lemis.com/grog/videorecorder/mythsetup-sep-2006.html)和[grepmail](http://www.cpan.org/modules/by-module/Mail/grepmail-4.51.readme)已报告此错误。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-03T15:05:54.507

这是适用于 Win32 的 Date::Manip 版本 5.48-5.54 中的一个[错误](http://rt.cpan.org/Public/Bug/Display.html?id=29655)。我在使用时区的标准/日光变体时遇到了困难，例如“EST5EDT”、“US/Eastern”。唯一有效的时区是那些没有夏令时的时区，例如“EST”。

可以在 Date::Manip 模块中关闭时区转换处理：

```
Date::Manip::Date_Init("ConvTZ=IGNORE"); 
```

**如果您正确处理日期，这将产生不良副作用**。除非您确信永远不会处理来自不同时区的日期，否则我不会使用此解决方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T20:33:33.427

几乎可以肯定您的主机没有您指定的时区的定义，这就是导致值未定义的原因。

您是否检查过以确保主机上确实存在同名的 TZ 定义文件？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T20:42:48.427

Date::Manip 应该是独立的。它在它自己的源代码中有一个所有时区的列表，跟在“$zonesrfc=”之后。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-09-17T11:23:25.860

你可以尝试单步调试调试器，看看到底出了什么问题吗？%Zone 很容易出错 - %tz 可能在第 1 行或第 2 行正确设置，但随后第 3 行的查找失败，以 undef 结束。

编辑：%Date::Manip::Cnf 和 %Date::Manip::Zone 是全局变量，因此您应该能够在调用 Date::Manip::Date_Init 之前和之后对它们进行转储。如果我正确阅读了源代码，%Cnf 应该在调用 Date_Init 之前包含配置选项的基本框架，并且 %Zone 应该是空的；在 Date_Init 之后，TZ 应该具有您选择的值，并且 %Zone 应该由时区查找表填充。

我在 %Cnf 中看到对 .DateManip.cnf 的引用，这可能值得一看 - 您的主目录或当前工作目录中是否有这样的文件，它覆盖了默认设置？

# graphics - 脏矩形

> ID：76651
> 
> 赞同：14
> 
> 时间：2008-09-16T20:29:56.693
> 
> 标签：graphics, framebuffer, bounding-box, dirtyrectangle

在哪里可以找到关于实现一种计算“脏矩形”以最小化帧缓冲区更新的算法的参考资料？允许任意编辑并计算更新显示所需的最小“位 blit”操作集的显示模型。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T22:46:57.083

要构建包含所有需要重新绘制的区域的最小矩形：

*   从空白区域开始（也许是一个设置为 0,0,0,0 的矩形 - 您可以将其检测为“不需要更新”）

对于添加的每个脏区：

*   规范化新区域（即保证left小于right，top小于bottom）
*   如果脏矩形当前为空，请将其设置为提供的区域
*   否则，将脏矩形的左上坐标设置为 {dirty,new} 的最小值，将右下坐标设置为 {dirty,new} 的最大值。

至少，Windows 会维护它所获知的更改的*更新区域*，以及由于窗口被遮挡和显示而需要进行的任何重新绘制。*区域*是由许多可能不连续的矩形、多边形和椭圆组成的对象。您通过调用 InvalidateRect 告诉 Windows 需要重新绘制屏幕的一部分 - 对于更复杂的区域还有一个 InvalidateRgn 函数。如果您选择在下一个 WM_PAINT 消息到达之前进行一些绘画，并且您想将其排除在脏区之外，则可以使用 ValidateRect 和 ValidateRgn 函数。

当您开始使用 BeginPaint 进行绘画时，您提供了一个 PAINTSTRUCT，Windows 会在其中填充有关需要绘画的内容的信息。其中一个成员是包含无效区域的最小矩形。如果您想在有多个小的无效区域时最小化绘图，您可以使用 GetUpdateRgn 获取区域本身（您必须在 BeginPaint 之前调用它，因为 BeginPaint 将整个窗口标记为有效）。

我会假设，由于在最初编写这些环境时，在 Mac 和 X 上最小化绘图很重要，因此存在用于维护更新区域的等效机制。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-06-29T12:50:54.287

Vexi 是一个参考实现。该类是[org.vexi.util.DirtyList](http://vexi.svn.sourceforge.net/viewvc/vexi/trunk/org.vexi-core.main/src/main/java/org/vexi/util/DirtyList.java?revision=4163&view=markup) （Apache 许可证），并用作生产系统的一部分，即经过彻底测试，并得到很好的评论。

需要注意的是，当前的类描述有点不准确，*“一种通用数据结构，用于保存需要重新绘制的矩形区域列表，具有智能合并功能。”* 实际上，它目前不进行合并。因此，您可以认为这是一个基本的 DirtyList 实现，因为它只与dirty() 请求相交以确保没有重叠的脏区域。

这个实现的一个细微差别是，区域不是使用 Rect 或其他类似的区域对象，而是存储在一个整数数组中，即在一维数组中的 4 个整数块中。这样做是为了提高运行时效率，尽管回想起来我不确定这是否有很多优点。（是的，我实现了它。）用 Rect 代替正在使用的数组块应该很简单。

上课的目的是要*快*。使用 Vexi，脏可能每帧调用数千次，因此脏区域与脏请求的交集必须尽可能快。不超过 4 个数字比较用于确定两个区域的相对位置。

由于缺少合并，它不是完全最优的。虽然它确实确保脏/绘制区域之间没有重叠，但您最终可能会得到对齐的区域并且可以合并到更大的区域中 - 从而减少绘制调用的数量。

代码片段。在线完整代码[在这里](http://vexi.svn.sourceforge.net/viewvc/vexi/trunk/org.vexi-core.main/src/main/java/org/vexi/util/DirtyList.java?revision=4163&view=markup)。

```
public class DirtyList {

    /** The dirty regions (each one is an int[4]). */
    private int[] dirties = new int[10 * 4]; // gets grown dynamically

    /** The number of dirty regions */
    private int numdirties = 0;

    ...

    /** 
     *  Pseudonym for running a new dirty() request against the entire dirties list
     *  (x,y) represents the topleft coordinate and (w,h) the bottomright coordinate 
     */
    public final void dirty(int x, int y, int w, int h) { dirty(x, y, w, h, 0); }

    /** 
     *  Add a new rectangle to the dirty list; returns false if the
     *  region fell completely within an existing rectangle or set of
     *  rectangles (i.e. did not expand the dirty area)
     */
    private void dirty(int x, int y, int w, int h, int ind) {
        int _n;
        if (w<x || h<y) {
            return;
        }
        for (int i=ind; i<numdirties; i++) {
            _n = 4*i;
            // invalid dirties are marked with x=-1
            if (dirties[_n]<0) {
                continue;
            }

            int _x = dirties[_n];
            int _y = dirties[_n+1];
            int _w = dirties[_n+2];
            int _h = dirties[_n+3];

            if (x >= _w || y >= _h || w <= _x || h <= _y) {
                // new region is outside of existing region
                continue;
            }

            if (x < _x) {
                // new region starts to the left of existing region

                if (y < _y) {
                    // new region overlaps at least the top-left corner of existing region

                    if (w > _w) {
                        // new region overlaps entire width of existing region

                        if (h > _h) {
                            // new region contains existing region
                            dirties[_n] = -1;
                            continue;
                        }// else {
                        // new region contains top of existing region
                        dirties[_n+1] = h;
                        continue;

                    } else {
                        // new region overlaps to the left of existing region

                        if (h > _h) {
                            // new region contains left of existing region
                            dirties[_n] = w;
                            continue;
                        }// else {
                        // new region overlaps top-left corner of existing region
                        dirty(x, y, w, _y, i+1);
                        dirty(x, _y, _x, h, i+1);
                        return;

                    }
                } else {
                    // new region starts within the vertical range of existing region

                    if (w > _w) {
                        // new region horizontally overlaps existing region

                        if (h > _h) {
                            // new region contains bottom of existing region
                            dirties[_n+3] = y;
                            continue;
                        }// else {
                        // new region overlaps to the left and right of existing region
                        dirty(x, y, _x, h, i+1);
                        dirty(_w, y, w, h, i+1);
                        return;

                    } else {
                        // new region ends within horizontal range of existing region

                        if (h > _h) {
                            // new region overlaps bottom-left corner of existing region
                            dirty(x, y, _x, h, i+1);
                            dirty(_x, _h, w, h, i+1);
                            return;
                        }// else {
                        // existing region contains right part of new region
                        w = _x;
                        continue;
                    }
                }
            } else {
                // new region starts within the horizontal range of existing region

                if (y < _y) {
                    // new region starts above existing region

                    if (w > _w) {
                        // new region overlaps at least top-right of existing region

                        if (h > _h) {
                            // new region contains the right of existing region
                            dirties[_n+2] = x;
                            continue;
                        }// else {
                        // new region overlaps top-right of existing region
                        dirty(x, y, w, _y, i+1);
                        dirty(_w, _y, w, h, i+1);
                        return;

                    } else {
                        // new region is horizontally contained within existing region

                        if (h > _h) {
                            // new region overlaps to the above and below of existing region
                            dirty(x, y, w, _y, i+1);
                            dirty(x, _h, w, h, i+1);
                            return;
                        }// else {
                        // existing region contains bottom part of new region
                        h = _y;
                        continue;
                    }
                } else {
                    // new region starts within existing region

                    if (w > _w) {
                        // new region overlaps at least to the right of existing region

                        if (h > _h) {
                            // new region overlaps bottom-right corner of existing region
                            dirty(x, _h, w, h, i+1);
                            dirty(_w, y, w, _h, i+1);
                            return;
                        }// else {
                        // existing region contains left part of new region
                        x = _w;
                        continue;
                    } else {
                        // new region is horizontally contained within existing region

                        if (h > _h) {
                            // existing region contains top part of new region
                            y = _h;
                            continue;
                        }// else {
                        // new region is contained within existing region
                        return;
                    }
                }
            }
        }

        // region is valid; store it for rendering
        _n = numdirties*4;
        size(_n);
        dirties[_n] = x;
        dirties[_n+1] = y;
        dirties[_n+2] = w;
        dirties[_n+3] = h;
        numdirties++;
    }

    ...
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-21T16:00:36.433

听起来您需要的是要渲染到屏幕的每个形状的边界框。请记住，多边形的边界框可以定义为“左下”（最小点）和“右上”（最大点）。即最小点的 x 分量定义为多边形中每个点的所有 x 分量中的最小值。对 y 分量（在 2D 的情况下）和边界框的最大点使用相同的方法。

如果每个多边形有一个边界框（又名“脏矩形”）就足够了，那么你就完成了。如果您需要一个整体的复合边界框，则应用相同的算法，除了您可以只填充具有最小和最大点的单个框。

现在，如果您在 Java 中执行所有这些操作，则可以使用[方法](http://java.sun.com/javase/6/docs/api/java/awt/geom/Area.html#getBounds2D())`Area`直接获取 an （您可以从 any 构造）的边界框。`Shape`[`getBound2D()`](http://java.sun.com/javase/6/docs/api/java/awt/geom/Area.html#getBounds2D())

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-26T22:15:55.067

我最近刚刚编写了一个 Delphi 类来计算两个图像的差异矩形，并且对它的运行速度感到非常惊讶 - 速度足以在短计时器中运行，并且在鼠标/键盘消息用于记录屏幕活动之后运行。

它如何工作的分步要点是：

1.  通过矩形将图像细分为逻辑 12x12。

2.  循环遍历每个像素，如果有差异，那么我告诉子矩形该像素属于哪个像素，其中一个像素和位置存在差异。

3.  每个子矩形都记住它自己最左边、最上面、最右边和最下面的差异的坐标。

4.  找到所有差异后，我会遍历所有有差异的子矩形，如果它们彼此相邻，则从它们中形成更大的矩形，并使用最左侧、最顶部、最右侧和底部-这些子矩形的大多数差异是我使用的实际差异矩形。

这对我来说似乎工作得很好。如果您还没有实现自己的解决方案，请告诉我，如果您愿意，我会通过电子邮件将我的代码发送给您。同样到目前为止，我是 StackOverflow 的新用户，所以如果您欣赏我的回答，请投票。:)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-16T23:09:09.450

您使用什么语言？在 Python 中，Pygame 可以为您做到这一点。使用 RenderUpdates Group 和一些具有 image 和 rect 属性的 Sprite 对象。

例如：

```
#!/usr/bin/env python
import pygame

class DirtyRectSprite(pygame.sprite.Sprite):
    """Sprite with image and rect attributes."""
    def __init__(self, some_image, *groups):
        pygame.sprite.Sprite.__init__(self, *groups)
        self.image = pygame.image.load(some_image).convert()
        self.rect = self.image.get_rect()
    def update(self):
        pass #do something here

def main():
    screen = pygame.display.set_mode((640, 480))
    background = pygame.image.load(open("some_bg_image.png")).convert()
    render_group = pygame.sprite.RenderUpdates()
    dirty_rect_sprite = DirtyRectSprite(open("some_image.png"))
    render_group.add(dirty_rect_sprite)

    while True:
        dirty_rect_sprite.update()
        render_group.clear(screen, background)
        pygame.display.update(render_group.draw(screen)) 
```

如果你不使用 Python+Pygame，我会这样做：

*   制作一个更新（）、移动（）等的 Sprite 类。方法设置一个“脏”标志。
*   为每个精灵保留一个矩形
*   如果您的 API 支持更新矩形列表，请在精灵脏的矩形列表上使用它。在 SDL 中，这是 SDL_UpdateRects。
*   如果您的 API 不支持更新 rects 列表（我从来没有机会使用除 SDL 之外的任何东西，所以我不知道），请测试是否可以更快地调用 blit 函数多次或一次大矩形 我怀疑任何 API 使用一个大矩形会更快，但同样，除了 SDL，我没有使用任何其他东西。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-03-25T14:20:36.577

[研究](http://en.wikipedia.org/wiki/Quadtree)[R-tree](http://en.wikipedia.org/wiki/R-tree)和quadtree数据结构。

# sql - 按用户获取未读消息

> ID：76680
> 
> 赞同：0
> 
> 时间：2008-09-16T20:32:10.807
> 
> 标签：sql, mysql, database

我想维护一个将向 Web 应用程序的所有用户显示的全局消息列表。我希望每个用户都能够将这些消息标记为单独阅读。我创建了 2 个表；`messages (id, body)`和`messages_read (user_id, message_id)`。

你能提供一个sql语句来选择单个用户的未读消息吗？或者你有什么更好的处理方法的建议吗？

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-16T20:33:54.157

好吧，你可以使用

```
SELECT id FROM messages m WHERE m.id NOT IN(
    SELECT message_id FROM messages_read WHERE user_id = ?) 
```

在哪里 ？由您的应用传入。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T00:43:47.957

如果您提到的表定义是完整的，您可能希望为每条消息包含一个日期，以便您可以按日期对它们进行排序。

此外，这可能是一种更有效的选择方式：

```
SELECT id, message
FROM messages
LEFT JOIN messages_read
    ON messages_read.message_id = messages.id
    AND messages_read.[user_id] = @user_id
WHERE
    messages_read.message_id IS NULL 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T20:36:05.603

就像是：

```
SELECT id, body FROM messages LEFT JOIN
  (SELECT message_id FROM messages_read WHERE user_id = ?)
  ON id=message_id WHERE message_id IS NULL 
```

有点棘手，我不确定性能将如何扩大，但它应该可以工作。

# php - 关于构建分布式 CMS 的建议？

> ID：76689
> 
> 赞同：3
> 
> 时间：2008-09-16T20:32:54.677
> 
> 标签：php, content-management-system

我正在设计一个基于 PHP 的内容管理系统供个人使用并最终分发。我知道那里已经有很多 CMS，但我真的没有找到一个能满足我所有需求的，我也想有学习经验。安全性是一个很大的焦点，可扩展性和易用性也是如此。对于那些已经建立了自己的 CMS 的人，您能提供什么建议？哪些功能对核心至关重要？什么是必须的附加组件？在开始之前你希望你知道什么？最大的潜在障碍/问题是什么？欢迎任何和所有的建议。

编辑：任何关于营销的建议和不应该的也将不胜感激。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-16T20:49:06.757

在构建 CMS 的几次迭代中，一些关键的事情被证明是：

*   拥有一个好的富文本编辑器——最终用户真的不想做 HTML。共识似乎是 FCKEditor 是最好的 - 最近这里有几个问题
*   允许人们添加新页面并轻松创建菜单/选项卡结构或页面之间的交叉链接
*   确定如何将内容放入模板和/或允许用户自己开发模板
*   弄清楚如何（以及是否）让人们从 Microsoft Word 粘贴内容 - 转换魔术引号、破折号和奇怪的 Wordish HTML
*   包括一个拼写检查功能（虽然 Firefox 有一些内置的东西，而 iespell 可以为 IE 做这项工作）

一些不太重要但有用的功能是： - 能够动态创建可读且对 SEO 友好的 URL（StackOverflow 的方式也不错） - 能够在修改后显示早期版本的内容 - 能够拥有一个沙箱来存放内容发布前校对或检查 - 处理多种语言和非英语/非 ASCII 字符

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-17T08:17:13.030

好吧，构建自己的 CMS 实际上意味着它不是企业级产品。这意味着您将无法真正实现让 CMS 用户满意的所有功能。甚至大多数功能都没有。我想澄清一下，我所说的 CMS 实际上是指用于创建 Web 应用程序或网站的平台，而不是博客平台或缩小版本。根据个人经验，我可以告诉您我最想要的 CMS 中的内容。
1\. 可扩展 - 提供干净且强大的 API，以便程序员可以通过代码完成大部分工作，而不是使用 UI
2\. 轻松创建和编辑页面 - 使用模板，单个页面有多个 URL，提供 URL 重写选项
3\. 使其基于组件。允许用户添加自定义功能。让某人轻松添加他的代码来做某事
4\. 使其对 SEO 友好。这包括元数据、URL 重写、良好的站点地图等。

现在有一些我也喜欢的企业特性，但我怀疑你是否有从一开始就深入研究它们的实现的愿望。它们包括工作流（内容创建的批准过程，可定制）、通用功能的内置模块（博客、电子商务、新闻）、编写自己的模块的能力、不同用户的权限、内置联合等。

毕竟我是站在开发者的角度讲的，我的观点可能不是主流，所以最终还是要你自己决定。正如 ahockley 所说——您必须知道为什么需要构建自己的 CMS。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T20:50:38.017

如果您询问 100 位不同的 CMS 用户关于他们的 CMS 最重要的事情，您可能会得到 80 多个不同的答案。

最大的障碍可能是人们问你为什么要从头开始构建一个新的 CMS。如果您不知道该问题的答案，我不确定您为什么要走这条路。

要记住的一件事是，对于互联网 CMS，人们会想要与许多“常规”服务的集成点。在构建您自己的专有解决方案之前，利用现有服务，例如照片共享网站、Twitter、OpenID 等。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-16T20:50:40.373

好吧，我写了一个供个人使用的 CMS，并将其发布到有史以来最大的啁啾蟋蟀合唱团中！不过，没什么大不了的。我确实学到了很多，我鼓励你继续前进。我的客户使用它并且喜欢它并且它保持得很好。

但如果我要重新开始（我可能会），这是我会给自己的建议：

1.  擦洗用户输入的*所有* **内容**
2.  用户管理是产品差异化因素。能够处理某人从 WORD 复制/粘贴的奖励积分。
3.  可扩展性。我收到的 90% 的评论来自希望使用 cms 来托管“某些”网站页面而不是其他页面的开发人员。或者他们想将他们的自定义脚本嵌入到内容中的页面中。我的下一个 cms 将尽可能地模块化。
4.  许多人对干净的网址非常狂热。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-17T00:09:24.390

从营销角度：

1）使其模板*能够*。

2) 制作 CMS SEF 并拥有经过 SEO 处理的 URL。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-06-09T16:10:29.797

如果您需要构建自定义功能，而您的 CMS 确实是其他业务层的窗口，那么请使用基于 CodeIgniter 框架的 PyroCMS 或 FuelCMS 之类的东西。

开发人员通常会迷失在 Drupal 和 Joomla 的杂草中！/ 随着时间的推移，Wordpress 很快就变成了意大利面条式的代码。它是你已经从 Kool-aid 潘趣酒碗中喝了多少。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T20:48:54.747

我知道这不是您要查找的内容的直接答案，但如果您还没有看过它，我建议您查看[CMS made simple](http://www.cmsmadesimple.org/)。与其他 CMS 相比，它的臃肿程度要小得多，而且速度快、效率高。它是开源的，因此它可能是您遇到的任何问题的一个很好的参考点。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2010-08-31T10:32:08.330

只需使用 Drupal。

开箱即用，它非常轻便快速。您为几乎所有东西添加模块，这可能会令人生畏，但它很棒。

它的安全性（NASA 和白宫使用它）、模块化、开源、得到很好的支持、以干净的 API 着称，并拥有从 SEO 到 Wysiwyg 的数百个模块......

# linux - 将管道输入转储到文件的简单方法是什么？(Linux)

> ID：76700
> 
> 赞同：7
> 
> 时间：2008-09-16T20:33:39.820
> 
> 标签：linux, pipe, exim

我正在寻找一个小的 shell 脚本，它将把任何东西通过管道输入，并将其转储到一个文件中......用于电子邮件调试目的。有任何想法吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-16T20:35:22.267

unix 命令 tee 执行此操作。

```
man tee 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-16T20:35:58.660

```
cat > FILENAME 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-16T20:36:22.483

你并不孤单需要类似的东西......事实上，几十年前有人想要这个功能并开发了[tee](http://linux.die.net/man/1/tee) :-)

当然，您可以使用 > 字符将 stdout 直接重定向到任何 shell 中的文件：

```
echo "hello, world!" > the-file.txt 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-16T20:36:22.310

标准的 unix 工具 tee 可以做到这一点。它将输入复制到输出，同时还将其记录到文件中。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-16T20:35:16.493

使用 Procmail。Procmail 是你的朋友。Procmail 就是为这种事情而设计的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-16T20:36:50.483

如果要在脚本中分析：

```
while /bin/true; do
    read LINE
    echo $LINE > $OUTPUT
done 
```

但是你可以简单地使用 cat。如果 cat 在标准输入上得到了某些东西，它会将其回显到标准输出，因此您必须将其通过管道传送到 cat >$OUTPUT。这些也会做同样的事情。第二个也适用于二进制数据。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-16T20:37:40.110

如果你想要一个 shell 脚本，试试这个：

```
#!/bin/sh
exec cat >/path/to/file 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-16T20:38:25.643

如果 exim 或 sendmail 是写入管道的内容，那么 procmail 是一个很好的答案，因为它会为您提供文件锁定/序列化，并且您可以将它们全部放在同一个文件中。

如果您只想写入文件，那么 - tee > /tmp/log.$$ 或 - cat > /tmp/log.$$ 可能就足够了。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-17T00:03:12.360

用于`<<command>> | tee <<file>>`将命令通过管道`<<command>>`传输到文件`<<file>>`中。

这也将显示输出。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-16T20:36:39.347

嗯？我想，我不明白这个问题？

你不能把你的管子端成一个`>> ~file`

例如

```
echo "Foobar" >> /home/mo/dumpfile 
```

将 Foobar 附加到转储文件（并在必要时创建转储文件）。不需要 shell 脚本......这就是你要找的吗？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-16T20:37:05.820

如果你不关心输出结果

```
cat - > filename 
```

或者

```
cat > filename 
```

# php - 为多个主机上的 PHP 站点处理会话的最佳方法是什么？

> ID：76712
> 
> 赞同：22
> 
> 时间：2008-09-16T20:34:39.460
> 
> 标签：php, mysql, session, load-balancing, memcached

PHP 将其会话信息存储在建立该会话的服务器主机的文件系统中。在多主机 PHP 环境中，负载不智能地分布在每个主机之间，PHP 会话变量不可用于每个请求（除非偶然将请求分配给同一主机 - 假设我们无法控制负载均衡器） .

[该站点被称为“PHP 负载平衡 Hitchhikers 指南”，](http://porteightyeight.com/archives/121-The-Hitchhikers-Guide-to-PHP-Load-Balancing.html)建议覆盖 PHP 会话处理程序并将会话信息存储在共享数据库中。

在您看来，在多 PHP 主机环境中维护会话信息的*最佳方式是什么？*

**更新：**感谢您的反馈。对于任何寻找示例代码的人，我们发现了一个[关于为 MySQL 编写会话管理器类的有用教程](http://www.devshed.com/c/a/PHP/Storing-PHP-Sessions-in-a-Database/)，我建议您查看。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-16T20:48:00.723

数据库，或数据库+内存缓存。一般来说，会话​​不应经常写入。*从仅在会话数据更改*时才写入数据库的数据库解决方案开始。稍后应添加 Memcache 作为性能增强。数据库解决方案将非常快，因为您只需要查找主键。确保数据库具有行锁定，而不是表锁定（myISAM）。MemCache only 是个坏主意……如果它溢出、崩溃或重新启动，用户将被注销。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T21:14:04.670

无论您做什么，都不要将其存储在服务器本身（即使您只使用一台服务器，或在 1+1 故障转移方案中）。它会让你陷入死胡同。

我会说，使用 Database+Memcache 进行存储/检索，它会让你脱离 Zend 的掌握（相信我在 Zend 的某个时候确实会出现问题）。由于您将能够轻松地按 UserID 或 SessionID 进行分区，因此即使使用 MySQL 也会使事情具有相当大的可扩展性。

（编辑：此外，使用 DB+Memcache 不会将您绑定到商业派对，也不会将您绑定到 PHP ——这可能会让您感到高兴）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T20:41:22.457

将会话数据存储在共享数据库中是可行的，但速度可能很慢。如果它是一个非常大的站点，[memcache](http://en.wikipedia.org/wiki/Memcached)可能是一个更好的选择。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T20:53:51.707

根据您项目的预算，您还可以考虑将 Zend 平台用于您的生产机器，除了许多其他出色的功能外，它还包括可配置的会话集群，它的工作方式有点像 CDN。

# image - 密集的像素级反向投影

> ID：76718
> 
> 赞同：1
> 
> 时间：2008-09-16T20:35:16.073
> 
> 标签：image, 3d, computer-vision, photogrammetry

我看到一个关于反向投影 4 个 2D 点以导出 3D 空间中矩形角的问题。对于同样的问题，我有一种更一般的版本：

给定焦距（可以求解以产生弧秒/像素）或固有相机矩阵（定义正在使用的针孔相机模型的属性的 3x2 矩阵 - 它与焦距直接相关），计算相机射线穿过每个像素。

我想拍摄一系列帧，从每一帧中导出候选光线，并使用某种迭代求解方法从每一帧中导出相机姿势（当然，给定足够大的样本）......所有其中实际上只是广义霍夫算法的大规模并行实现......它首先获得了我遇到问题的候选光线......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T20:41:53.750

我的一个朋友从一所大学找到了 PhotoSynth 中相机匹配的源代码。如果我是你，我会用谷歌搜索它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T14:47:45.137

稍微摸索了一下，不是外在矩阵告诉你相机在 3 空间中的实际位置吗？

我在一家做很多此类事情的公司工作，但我总是使用算法人员编写的工具。:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T20:58:03.117

这是一个很好的建议......我肯定会研究它（光合成器重新激发了我对这个主题的兴趣 - 但我已经为 robochamps 研究了几个月） - 但它是一个稀疏的实现 - 它寻找“好” 特征（应该在同一图像的其他视图中很容易识别的图像中的点），虽然我当然计划根据匹配的特征的好坏对每个匹配进行评分，但我希望全密集算法推导出每个像素...或者我应该说体素哈哈？

# sql - 获取同一日期有多个条目的记录列表

> ID：76724
> 
> 赞同：5
> 
> 时间：2008-09-16T20:35:36.400
> 
> 标签：sql

我需要从一个表中返回一个记录 ID 列表，该表在同一日期可能/可能没有多个具有该记录 ID 的条目。相同的日期标准是关键 - 如果一条记录在 2008 年 9 月 10 日有三个条目，那么我需要返回所有三个条目。如果记录在 2008 年 9 月 12 日只有一个条目，那么我不需要它。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-16T20:40:11.397

```
SELECT id, datefield, count(*) FROM tablename GROUP BY datefield
  HAVING count(*) > 1 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-19T00:35:14.217

```
SELECT RecordID
FROM aTable
WHERE SameDate IN
    (SELECT SameDate
    FROM aTable
    GROUP BY SameDate
    HAVING COUNT(SameDate) > 1) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T20:45:38.920

由于您提到需要所有三个记录，我假设您也需要数据。如果您只需要 id，则可以按查询使用 group。要返回数据，只需将其作为子查询加入

```
select * from table
inner join (
     select id, date
     from table 
     group by id, date 
     having count(*) > 1) grouped 
       on table.id = grouped.id and table.date = grouped.date 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-16T21:25:42.817

顶帖 (Leigh Caldwell) 不会返回重复记录，需要向下修改。它将识别重复的键。此外，如果您的数据库不允许 group by 不包括所有选择字段（许多不包括），它将不起作用。

如果您的日期字段包含时间戳，那么您需要使用上面记录的方法之一将其截断（我更喜欢： dateadd(dd,0, datediff(dd,0,@DateTime)) ）。

我认为 Scott Nichols 给出了正确的答案，这是一个证明它的脚本：

```
declare @duplicates table (
id int,
datestamp datetime,
ipsum varchar(200))

insert into @duplicates (id,datestamp,ipsum) values (1,'9/12/2008','ipsum primis in faucibus')
insert into @duplicates (id,datestamp,ipsum) values (1,'9/12/2008','Vivamus consectetuer. ')
insert into @duplicates (id,datestamp,ipsum) values (2,'9/12/2008','condimentum posuere, quam.')
insert into @duplicates (id,datestamp,ipsum) values (2,'9/13/2008','Donec eu sapien vel dui')
insert into @duplicates (id,datestamp,ipsum) values (3,'9/12/2008','In velit nulla, faucibus sed')

select a.* from @duplicates a
inner join (select id,datestamp, count(1) as number
              from @duplicates
          group by id,datestamp
            having count(1) > 1) b
       on (a.id = b.id and a.datestamp = b.datestamp) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T20:40:17.153

`GROUP BY`和`HAVING`是你的朋友：

```
select id, count(*) from records group by date having count(*) > 1 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-16T20:41:15.730

```
select id from tbl where date in
(select date from tbl group by date having count(*)>1) 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-16T20:41:19.850

仅匹配 Datetime 的日期部分：

```
select * from Table
where id in (
    select alias1.id from Table alias1, Table alias2
    where alias1.id != alias2.id
        and datediff(day, alias1.date, alias2.date) = 0
) 
```

我认为。这是基于我的假设，即您在年月的同一天需要它们，但不是一天中的同一时间，所以我没有使用 Group by 子句。从其他帖子看来，我可以更巧妙地使用 Have 子句。您可以在 datediff 表达式上使用 have 或 group by 吗？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-16T20:42:26.167

如果我正确理解你的问题，你可以做类似的事情：

```
select
     recordID
from
    tablewithrecords as a
    left join (
        select
          count(recordID) as recordcount
        from
          tblwithrecords
        where
          recorddate='9/10/08'
     ) as b on a.recordID=b.recordID
where
     b.recordcount>1 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-16T20:43:09.207

[http://www.sql-server-performance.com/articles/dba/delete_duplicates_p1.aspx](http://www.sql-server-performance.com/articles/dba/delete_duplicates_p1.aspx)将助您一臂之力。此外，[http ://en.allexperts.com/q/MS-SQL-1450/2008/8/SQL-query-fetch-duplicate.htm](http://en.allexperts.com/q/MS-SQL-1450/2008/8/SQL-query-fetch-duplicate.htm)

我通过在 Google 上搜索“sql 重复数据”找到了这些。你会发现这不是一个不寻常的问题。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-16T20:44:49.203

```
SELECT * FROM the_table WHERE ROW(record_id,date) IN 
  ( SELECT record_id, date FROM the_table 
    GROUP BY record_id, date WHERE COUNT(*) > 1 ) 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-19T01:06:10.197

TrickyNixon 写道；

> 顶帖 (Leigh Caldwell) 不会返回重复记录，需要向下修改。

然而，这个问题并没有询问重复记录。它询问同一日期的重复记录ID...

GROUP-BY,HAVING 对我来说似乎很好。我以前在生产中使用过它。

.

需要注意的事项：

SELECT ... FROM ... GROUP BY ... HAVING count(*)>1

在大多数数据库系统上，将在 O(NlogN) 时间内运行。这是一个很好的解决方案。（选择是O（N），排序是O（NlogN），分组是O（N），拥有是O（N）——最坏的情况。最好的情况，日期被索引并且排序操作更有效。）

.

选择 ... from ..., .... where a.data = b.date

授予只有白痴才能进行笛卡尔连接。但是您正在查看 O(N^2) 时间。对于某些数据库，这也会创建一个“临时”表。当您的表只有 10 行时，这一切都微不足道。但是当那张桌子变大时会很痛！

OB 链接： [http://en.wikipedia.org/wiki/Join_(SQL)](http://en.wikipedia.org/wiki/Join_(SQL))

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-16T20:47:45.123

我不确定我是否理解你的问题，但也许你想要这样的东西：

```
SELECT id, COUNT(*) AS same_date FROM foo GROUP BY id, date HAVING same_date = 3; 
```

这只是从我的脑海中写出来的，没有经过任何测试。[在此处](http://dev.mysql.com/doc/refman/5.0/en/select.html)阅读 GROUP BY 和 HAVING 部分。如果这不是您的意思，请忽略此答案。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-16T20:47:57.713

请注意，如果您使用 SQL DateTime 字段，则需要进行一些额外的处理。如果您在那里有额外的时间数据，那么您不能按原样使用该列。对于当天包含的所有记录，您必须将 DateTime 标准化为单个值。

在 SQL Server 中，有一个小技巧可以做到这一点：

```
SELECT CAST(FLOOR(CAST(CURRENT_TIMESTAMP AS float)) AS DATETIME) 
```

您将 DateTime 转换为浮点数，它将 Date 表示为整数部分，将 Time 表示为一天中过去的分数。去掉那个小数部分，然后把它转换回一个 DateTime，你就在那天开始时得到了午夜。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-16T20:48:08.180

```
选择 ID，计数（*）
进入#tmp
FROM 表名
WHERE 日期 = @date
按 ID 分组
有计数（*）> 1

选择 *
FROM 表名 t
存在的位置（从#tmp 中选择 1，其中 id = t.id）

DROP TABLE 表名

```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-16T20:49:23.170

如果不知道您的表的确切结构或您使用的是什么类型的数据库，则很难回答。但是，如果您使用的是 MS SQL，并且如果您有一个真实的日期/时间字段，该字段的时间与在同一日期输入的记录的时间不同，那么这样的事情应该可以工作：

```
select record_id, 
       convert(varchar, date_created, 101) as log date, 
       count(distinct date_created) as num_of_entries
from record_log_table
group by convert(varchar, date_created, 101), record_id
having count(distinct date_created) > 1 
```

希望这可以帮助。

# visual-studio-2008 - VS2008 安装项目：共享（由所有用户）应用程序数据文件？

> ID：76760
> 
> 赞同：31
> 
> 时间：2008-09-16T20:38:21.510
> 
> 标签：visual-studio-2008, deployment, installation, desktop, projects-and-solutions

类人猿同胞、睡莲和桨轮！

我正在使用 VS 2008 在 C#/.NET/WPF 中开发一个 Windows 桌面应用程序。该应用程序需要在 Vista 和 XP 机器上安装和运行。我正在使用安装程序/Windows 安装程序项目来安装该应用程序。

我的应用程序需要对 SQLCE 数据库文件 (.sdf) 和与我正在使用的第三方控件相关的一些其他数据库类型文件的读/修改/写访问权限。这些文件应在 PC 上的所有用户/登录名之间共享，其中任何一个都不需要成为管理员。当然，这意味着文件不能放在程序自己的安装目录中（就像在 Vista 到来之前经常发生的那样，是的，是的！）。

我原以为解决方案很简单。**Vista 和 XP 都有用于此目的的共享应用程序数据文件夹。**（Vista 中的“\ProgramData”，XP 中的“\Documents and Settings\All Users\Application Data”。） .NET Environment.GetFolderPath(SpecialFolder.CommonApplicationData) 调用可用于在给定 PC 上查找这些文件夹的路径，是的， 是的！

**但我不知道如何将 shared-application-data 文件夹指定为安装项目中的目标。**

Setup 项目提供了一个“Common Files”文件夹，但该文件夹用于共享程序组件（不是数据文件），通常位于“\Program Files”下，并且具有与“\Program files”中其他任何内容相同的安全限制，是的是的！

安装项目提供了一个“用户的应用程序数据”文件夹，但这是一个每个用户的文件夹，这正是我想要避免的，是的，是的！

是否可以从 VS 2008 安装项目以强大的跨 Windows 版本的方式将文件添加到 shared-app-data 文件夹？谁能告诉我怎么做？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-01T20:02:58.470

我已经通过其他来源了解了我的问题的答案，是的，是的！可悲的是，它并没有解决我的问题！是什么让我——一个固定鞋面？是的是的！

要将内容放在 VS2008 安装项目的 Common Application Data 文件夹的子目录中，您可以执行以下操作：

1.  在解决方案资源管理器中右键单击您的设置项目，然后选择“查看 -> 文件系统”。

2.  右键单击“目标机器上的文件系统”并选择“添加特殊文件夹 -> 自定义文件夹”。

3.  将自定义文件夹重命名为“通用应用程序数据文件夹”。（这不是将用于生成文件夹的名称，它只是为了帮助您保持直截了当。）

4.  将文件夹的 DefaultLocation 属性更改为“[CommonAppDataFolder][Manufacturer]\[ProductName]”。请注意与应用程序文件夹的 DefaultLocation 属性的相似之处，包括奇怪地使用单个反斜杠。

5.  惊叹于可笑（但不可否认）的事实，即有一个名为“Property”的文件夹属性。

6.  将文件夹的 Property 属性更改为“COMMONAPPDATAFOLDER”。

放置在“Common Application Data”文件夹中的数据文件将被复制到“\ProgramData\Manufacturer\ProductName”（在 Vista 上）或“\Documents and Settings\All Users\Application Data\Manufacturer\ProductName”（在 XP 上）。安装程序运行。

现在事实证明，在 Vista 下，非管理员无法对此处的文件进行修改/写入访问。因此，所有用户都可以阅读文件，但他们也可以在“\Program Files”中获得这些文件。那么，我想知道 Common Application Data 文件夹的意义是什么？

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2010-12-08T21:12:45.360

无需检查“启用 ClickOnce 安全设置”并选择“这是一个完全信任的应用程序”，可以使用安装项目的“安装”部分下的自定义操作来更改应用程序的 CommonAppDataDirectory 的权限。这是我所做的：

1.  添加了一个自定义操作来调用正在安装的应用程序（或者您可以创建一个单独的程序/dll 并调用它）
2.  将参数属性设置为“安装”
3.  修改 Program.cs 中的 Main 以检查该 arg：

    ```
     static void Main(string[] args)
    {
       if (args != null && args.Length > 0 && args[0] == "Install")
       {
          ApplicationData.SetPermissions();
       }
       else
       {
          // Execute app "normally"
        }
    } 
    ```

4.  编写了 SetPermissions 函数以编程方式更改权限

    ```
     public static void SetPermissions()
    {
        String path = GetPath();
        try
        {
            // Create security idenifier for all users (WorldSid)
            SecurityIdentifier sid = new SecurityIdentifier(WellKnownSidType.WorldSid, null);
            DirectoryInfo di = new DirectoryInfo(path);
            DirectorySecurity ds = di.GetAccessControl();
            // add a new file access rule w/ write/modify for all users to the directory security object

            ds.AddAccessRule(new FileSystemAccessRule(sid, 
                                                  FileSystemRights.Write | FileSystemRights.Modify,
                                                  InheritanceFlags.ObjectInherit | InheritanceFlags.ContainerInherit,   // all sub-dirs to inherit
                                                  PropagationFlags.None,
                                                  AccessControlType.Allow));                                            // Turn write and modify on
            // Apply the directory security to the directory
            di.SetAccessControl(ds);
        }
        catch (Exception ex)
        {
            MessageBox.Show(ex.Message);
        }
    } 
    ```

由于安装程序以管理员权限运行，因此程序将能够更改权限。我在某处读到“启用 ClickOnce 安全性”可能会导致用户在应用程序启动时看到不需要的提示。如上所述进行操作将防止这种情况发生。我希望这可以帮助别人。我知道我可以从几天前看到这样的事情中受益！

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-29T04:05:43.120

我是这样解决的。我将数据库文件 (.sdf) 保存在与应用程序安装位置（应用程序文件夹）相同的文件夹中。在主项目属性窗口的安全选项卡上，我检查了“启用 ClickOnce 安全设置”并选择“这是一个完全信任的应用程序”，重建并运行设置。之后没有安全问题

我正在使用 Visual Studio 2008 和 Windows Vista

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-17T11:36:33.430

这对我使用 VS2005 有效，但我必须更改 DefaultLocation，我添加了一个“\”来分隔 CommonAppDataFolder。

`[CommonAppDataFolder]\[Manufacturer]\[ProductName]`

不知道这是否是一个错字，但莱曼确实提到了单个反斜杠的奇怪使用，但这似乎不正确。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-12T13:22:57.703

我遇到过同样的问题。安装项目让用户可以选择“仅为当前用户”或“为所有用户：”安装应用程序。因此，数据库文件最终将位于当前用户或所有用户应用程序数据文件夹中。安装程序将必须在某处写入此信息，以便应用程序稍后在访问数据库时检索它。否则它怎么知道要查看哪个应用程序数据文件夹？

为了避免这个问题，我只想将数据库安装在 All Users/Application Data 文件夹中，无论应用程序是为一个用户还是为所有用户安装的。当然，我意识到两个用户无法在不覆盖彼此数据的情况下将应用程序安装在同一台计算机上。不过，这种可能性很小，我不想考虑。

我在[这里](http://snipplr.com/view/10502/set-the-directory-connection-string-for-an-sql-server-database-connection/)得到的第一块拼图：

```
Form_Load(object sender, EventArgs e)
{
  // Set the db directory to the common app data folder
  AppDomain.CurrentDomain.SetData("DataDirectory", 
            System.Environment.GetFolderPath
           (System.Environment.SpecialFolder.CommonApplicationData));
} 
```

现在我们需要确保数据源包含 DataDirectory 占位符。这件作品来自[这里](http://social.msdn.microsoft.com/Forums/en-US/sqlce/thread/d18724a8-0be2-4d8e-8311-3a08b87ec10e)。在 DataSet 设计器中，找到 DataSet 的属性，打开 Connection 节点并编辑 ConnectionString 属性，如下所示：

```
Data Source=|DataDirectory|\YourDatabase.sdf 
```

然后我按照上面 Lyman Enders Knowles 的说明，了解如何将 Common Application Data 文件夹添加到安装项目并将数据库文件放在该文件夹中。

然后我按照上面的 Ove 的建议，即我检查了“启用 ClickOnce 安全设置”并选择“这是一个完全信任的应用程序。

之后，应用程序在 Vista 上部署良好，并且数据库文件可以读写。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-05-18T18:12:05.497

我喜欢下面的概念，一些东西取自上面

1.  在解决方案资源管理器中右键单击您的设置项目，然后选择“查看 -> 文件系统”。

2.  右键单击“目标机器上的文件系统”并选择“添加特殊文件夹 -> 自定义文件夹”。

3.  将自定义文件夹重命名为“通用应用程序数据文件夹”。（这不是将用于生成文件夹的名称，它只是为了帮助您保持直截了当。）

4.  将文件夹的 DefaultLocation 属性更改为“[CommonAppDataFolder][Manufacturer][ProductName]”。请注意与应用程序文件夹的 DefaultLocation 属性的相似之处，包括奇怪地使用单个反斜杠。

5.  惊叹于可笑（但不可否认）的事实，即有一个名为“Property”的文件夹属性。满是狂犬病的宝宝，这玩意是谁想出来的？

6.  将文件夹的 Property 属性更改为“COMMONAPPDATAFOLDER”。

```
string userAppData = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData);
string commonAppData = Environment.GetFolderPath(Environment.SpecialFolder.CommonApplicationData); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-12T19:39:13.490

我不确定这是否会对您的情况有所帮助。

但是，如果您将私有部分添加到应用程序的配置文件中

您可以指定额外的文件夹来签入您的应用程序。

如果您说的是您希望能够安装到机器上的其他文件夹中，那么这是一个问题。本质上，微软限制这些东西的全部原因是为了让恶意代码远离用户不知道他们正在安装什么的机器。

因此，如果您需要另一个目录，这将不起作用。此修复程序的作用是允许您指定在应用程序中搜索文件的位置......

# sql - 低成本扩展：MySQL 和 MS SQL

> ID：76762
> 
> 赞同：2
> 
> 时间：2008-09-16T20:38:25.380
> 
> 标签：sql, mysql, sql-server, scalability, scaling

当您拥有大量数据（和连接/搜索）时，MySQL 与 MS SQL 相比有多便宜？考虑一个像 stackoverflow 这样的网站，已经和被挖掘后充满了问答。

我的 ASP.NET 站点目前在 SQL Server Express 上，所以我不知道从长远来看成本如何比较。虽然经过快速研究，我开始羡慕 MySQL 人员所获得的节省。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-16T20:47:44.670

*MSSQL 标准版（32 位或 64 位）每个 CPU 插槽*的成本约为 5000 美元。64 位将允许您根据需要使用尽可能多的 RAM。对于大多数部署而言，企业版并不是真正需要的，因此不必担心获得该许可证所需的 2 万美元。

MySQL 只有在您放弃许多随许可证提供的有用工具时才免费，而且可能（至少在 2008 年）要让它像 Sql Server 一样扩展需要做更多的工作。

从长远来看，我认为您将在硬件和人员上花费更多，而不仅仅是在许可证上。如果你需要扩大规模，那么你可能会有足够的现金流来处理这里和那里的 5000 美元。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-16T20:45:12.290

MS SQL 相对于 MySQL 的性能优势几乎可以忽略不计，特别是如果您通过服务器和客户端优化（如服务器缓存（在 RAM 中）、客户端缓存（缓存和过期标头）和 gzip 压缩）来缓解它们。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T20:44:59.840

我知道 stackoverflow 遇到了来自以奇数间隔出现的读/写死锁的问题，但他们声称他们的架构 (MSSQL) 运行良好。这当然是在公开测试版之前，根据杰夫今天早些时候的推特：

> 在私人测试版中，前 32 个最新/修改过的问题的范围约为 20 分钟；现在大约 2 分钟。

该站点尚未崩溃是对数据库的证明（以及良好的编码和测试）。

但是为什么不发布一些关于您的网站的具体数字呢？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T20:48:19.590

当您拥有带有 MySQL 企业版的发行版（或构建人员）时，MySQL 非常便宜。这是一个高可用性版本，可在许多服务器上提供多主复制。

优点是初始购买硬件（需要千兆内存！）和设置时间后的低（许可）成本。

缺点是性能欠佳，有许多连接、没有全文索引、存储过程（我认为）以及需要将授权复制到每个主节点。

然而，它比可用于 PostgreSQL 的复制/代理平衡设置更容易运行。

# c# - 如何 TDD 自定义会员提供者和自定义会员用户？

> ID：76781
> 
> 赞同：4
> 
> 时间：2008-09-16T20:40:05.890
> 
> 标签：c#, asp.net, authentication

我需要为 ASP.NET mvc 应用程序创建一个自定义成员用户和提供程序，并且我希望使用 TDD。我创建了一个继承自 MembershipUser 类的 User 类，但是当我尝试对其进行测试时，我得到了一个我无法弄清楚的错误。如何给它一个有效的提供者名称？我只需要将它添加到 web.config 中吗？但此时我什至没有测试网络应用程序。

[失败] UserTests.SetUp.UserShouldHaveMembershipUserProperties TestCase 'UserTests.SetUp.UserShouldHaveMembershipUserProperties' 失败：指定的成员资格提供程序名称无效。参数名称：providerName System.ArgumentException 消息：指定的成员资格提供程序名称无效。参数名称：providerName 来源：System.Web

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-28T16:01:18.853

添加到单元测试项目配置文件的配置如下所示：

```
 <connectionStrings>
     <remove name="LocalSqlServer"/>
     <add name="LocalSqlServer" connectionString="<connection string>" providerName="System.Data.SqlClient"/>
  </connectionStrings>
  <system.web>
     <membership defaultProvider="provider">
       <providers>
         <add name="provider" applicationName="MyApp" type="System.Web.Security.SqlMembershipProvider" connectionStringName="LocalSqlServer" minRequiredPasswordLength="6" minRequiredNonalphanumericCharacters="0" requiresQuestionAndAnswer="false" maxInvalidPasswordAttempts="3" passwordAttemptWindow="15"/>
       </providers>
     </membership>
  </system.web> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T20:48:06.183

是的，您需要在配置文件中配置它（对于测试库，可能不是 web.config，而是 app.config）。您仍然使用该部分并在该部分内进行配置。一旦你有了它，你就可以实例化你的用户并开始测试它。我认为，此时您可能会遇到新问题，您应该将其作为单独的问题发布。

# .net - .NET XML 序列化

> ID：76793
> 
> 赞同：0
> 
> 时间：2008-09-16T20:41:01.380
> 
> 标签：.net, xml, serialization, xml-serialization

我正在研究一组将用于序列化为 XML 的类。XML 不是由我控制的，而且组织得很好。不幸的是，有几组嵌套节点，其中一些的目的只是为了保存它们的子节点的集合。根据我目前对 XML 序列化的了解，这些节点需要另一个类。

有没有办法让一个类序列化到一组 XML 节点而不是一个。因为我觉得我像泥一样清楚，所以说我们有xml：

```
<root>
    <users>
        <user id="">
            <firstname />
            <lastname />
            ...
        </user>
        <user id="">
            <firstname />
            <lastname />
            ...
        </user>
    </users>
    <groups>
        <group id="" groupname="">
            <userid />
            <userid />
        </group>
        <group id="" groupname="">
            <userid />
            <userid />
        </group>
    </groups>
</root> 
```

理想情况下，最好是 3 节课。`root`具有集合`user`和`group`对象的类。但是，我能想到的最好的办法是，我需要一个用于`root`、`users`、和的类`user`，其中和分别只包含 和 的集合，并且包含一个、和对象。`groups``group``users``groups``user``group``root``users``groups`

有谁比我更懂？（别说谎，我知道有）。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-16T20:43:18.677

您不使用[XmlSerializer](http://msdn.microsoft.com/en-us/library/system.xml.serialization.xmlserializer.aspx)吗？它非常好，让做这样的事情变得非常容易（我经常使用它！）。

你可以简单地用一些属性装饰你的类属性，其余的都为你完成。

您是否考虑过使用 XmlSerializer 或者是否有特殊原因？

这是使上述序列化（两种方式）所需的所有工作的代码片段：

```
[XmlArray("users"),
XmlArrayItem("user")]
public List<User> Users
{
    get { return _users; }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T20:47:20.820

您只需要将用户定义为用户对象的数组。XmlSerializer 将为您适当地呈现它。

有关示例，请参见此链接：http: [//www.informit.com/articles/article.aspx?p=23105 &seqNum=4](http://www.informit.com/articles/article.aspx?p=23105&seqNum=4)

此外，我建议使用 Visual Studio 生成 XSD 并使用命令行实用程序 XSD.EXE 为您吐出类层次结构，如[http://quickstart.developerfusion.co.uk/quickstart/howto/doc/xmlserialization /XSDToCls.aspx](http://quickstart.developerfusion.co.uk/quickstart/howto/doc/xmlserialization/XSDToCls.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T21:21:36.803

我在那天写这门课是为了做我认为的事情，类似于你想做的事情。您可以对希望序列化为 XML 的对象使用此类的方法。例如，给定一个员工...

使用实用程序；使用 System.Xml.Serialization；

[XmlRoot("Employee")] public class Employee { private String name = "Steve";

```
 [XmlElement("Name")]
 public string Name { get { return name; } set{ name = value; } }

 public static void Main(String[] args)
 {
      Employee e = new Employee();
      XmlObjectSerializer.Save("c:\steve.xml", e);
 } 
```

}

此代码应输出：

```
<Employee>
  <Name>Steve</Name>
</Employee> 
```

对象类型 (Employee) 必须是可序列化的。尝试 [Serializable(true)]。我在某个地方有此代码的更好版本，我在编写它时只是在学习。不管怎样，看看下面的代码。我在某个项目中使用它，所以它肯定有效。

```
using System;
using System.IO;
using System.Xml.Serialization;

namespace Utilities
{
    /// <summary>
    /// Opens and Saves objects to Xml
    /// </summary>
    /// <projectIndependent>True</projectIndependent>
    public static class XmlObjectSerializer
    {
        /// <summary>
        /// Serializes and saves data contained in obj to an XML file located at filePath <para></para>        
        /// </summary>
        /// <param name="filePath">The file path to save to</param>
        /// <param name="obj">The object to save</param>
        /// <exception cref="System.IO.IOException">Thrown if an error occurs while saving the object. See inner exception for details</exception>
        public static void Save(String filePath, Object obj)
        {
            // allows access to the file
            StreamWriter oWriter =  null;

            try
            {
                // Open a stream to the file path
                 oWriter = new StreamWriter(filePath);

                // Create a serializer for the object's type
                XmlSerializer oSerializer = new XmlSerializer(obj.GetType());

                // Serialize the object and write to the file
                oSerializer.Serialize(oWriter.BaseStream, obj);
            }
            catch (Exception ex)
            {
                // throw any errors as IO exceptions
                throw new IOException("An error occurred while saving the object", ex);
            }
            finally
            {
                // if a stream is open
                if (oWriter != null)
                {
                    // close it
                    oWriter.Close();
                }
            }
        }

        /// <summary>
        /// Deserializes saved object data of type T in an XML file
        /// located at filePath        
        /// </summary>
        /// <typeparam name="T">Type of object to deserialize</typeparam>
        /// <param name="filePath">The path to open the object from</param>
        /// <returns>An object representing the file or the default value for type T</returns>
        /// <exception cref="System.IO.IOException">Thrown if the file could not be opened. See inner exception for details</exception>
        public static T Open<T>(String filePath)
        {
            // gets access to the file
            StreamReader oReader = null;

            // the deserialized data
            Object data;

            try
            {
                // Open a stream to the file
                oReader = new StreamReader(filePath);

                // Create a deserializer for the object's type
                XmlSerializer oDeserializer = new XmlSerializer(typeof(T));

                // Deserialize the data and store it
                data = oDeserializer.Deserialize(oReader.BaseStream);

                //
                // Return the deserialized object
                // don't cast it if it's null
                // will be null if open failed
                //
                if (data != null)
                {
                    return (T)data;
                }
                else
                {
                    return default(T);
                }
            }
            catch (Exception ex)
            {
                // throw error
                throw new IOException("An error occurred while opening the file", ex);
            }
            finally
            {
                // Close the stream
                oReader.Close();
            }
        }
    }
} 
```

# c++ - 在 C++ 中避免内存泄漏的一般准则

> ID：76796
> 
> 赞同：131
> 
> 时间：2008-09-16T20:41:14.670
> 
> 标签：c++, memory, memory-management, raii

有哪些一般提示可以确保我不会在 C++ 程序中泄漏内存？如何确定谁应该释放动态分配的内存？

* * *

## 回答 #1

> 赞同：202
> 
> 时间：2008-09-16T22:38:07.683

我完全赞同有关 RAII 和智能指针的所有建议，但我还想添加一个稍微高级一点的提示：最容易管理的内存是您从未分配过的内存。与 C# 和 Java 等几乎所有内容都是引用的语言不同，在 C++ 中，您应该尽可能将对象放在堆栈上。正如我看到几个人（包括 Stroustrup 博士）指出的那样，垃圾收集在 C++ 中从未流行过的主要原因是，编写良好的 C++ 首先不会产生太多垃圾。

不要写

```
Object* x = new Object; 
```

甚至

```
shared_ptr<Object> x(new Object); 
```

当你可以写

```
Object x; 
```

* * *

## 回答 #2

> 赞同：105
> 
> 时间：2008-09-16T22:22:07.143

## 使用[RAII](http://en.wikipedia.org/wiki/RAII)

*   **忘记垃圾收集**（改用 RAII）。请注意，即使是垃圾收集器也可能泄漏（如果您忘记在 Java/C# 中将某些引用“设为空”），并且垃圾收集器不会帮助您处理资源（如果您有一个对象获得了一个句柄一个文件，如果您不在 Java 中手动执行或使用 C# 中的“dispose”模式，当对象超出范围时，该文件将不会自动释放）。
*   **忘记“每个函数一个返回”规则**。这是避免泄漏的一个很好的 C 建议，但它在 C++ 中已经过时，因为它使用了异常（改用 RAII）。
*   虽然**“三明治模式”**是一个很好的 C 建议，但它**在 C++ 中已经过时，** 因为它使用了异常（改用 RAII）。

这篇文章似乎是重复的，但在 C++ 中，要知道的最基本的模式是[RAII](http://en.wikipedia.org/wiki/RAII)。

学习使用智能指针，无论是来自 boost、TR1 还是低级（但通常足够高效）的 auto_ptr（但你必须知道它的局限性）。

RAII 是 C++ 中异常安全和资源处理的基础，没有其他模式（三明治等）可以同时提供（而且大多数情况下，它不会提供）。

请参阅下面的 RAII 和非 RAII 代码的比较：

```
void doSandwich()
{
   T * p = new T() ;
   // do something with p
   delete p ; // leak if the p processing throws or return
}

void doRAIIDynamic()
{
   std::auto_ptr<T> p(new T()) ; // you can use other smart pointers, too
   // do something with p
   // WON'T EVER LEAK, even in case of exceptions, returns, breaks, etc.
}

void doRAIIStatic()
{
   T p ;
   // do something with p
   // WON'T EVER LEAK, even in case of exceptions, returns, breaks, etc.
} 
```

## 关于[RAII](http://en.wikipedia.org/wiki/RAII)

总结一下（在*Ogre Psalm33*的评论之后），RAII 依赖于三个概念：

*   **一旦构造了对象，它就可以工作了！**在构造函数中获取资源。
*   **对象破坏就够了！**在析构函数中释放资源。
*   **都是关于范围的！**作用域对象（参见上面的 doRAIIStatic 示例）将在其声明时构造，并在执行退出作用域的那一刻被销毁，无论退出方式如何（返回、中断、异常等）。

这意味着在正确的 C++ 代码中，大多数对象不会用 构造`new`，而是在堆栈上声明。而对于那些使用 构造的`new`，所有都将以某种方式*限定范围*（例如附加到智能指针）。

作为开发人员，这确实非常强大，因为您不需要关心手动资源处理（就像在 C 中所做的那样，或者对于 Java 中的某些对象，在这种情况下大量使用`try`/ `finally`）......

## 编辑 (2012-02-12)

> “作用域对象......将被破坏......无论出口如何”这并不完全正确。有办法欺骗RAII。任何类型的 terminate() 都会绕过清理。exit(EXIT_SUCCESS) 在这方面是矛盾的。
> 
> ——[威廉泰尔](https://stackoverflow.com/users/456/wilhelmtell)

[wilhelmtell](https://stackoverflow.com/users/456/wilhelmtell)对此非常正确：有一些*特殊*的方法可以欺骗 RAII，所有这些都会导致进程突然停止。

这些是**特殊**的方式，因为 C++ 代码没有乱扔终止、退出等，或者在有异常的情况下，我们确实希望一个[未处理的异常](https://stackoverflow.com/questions/1104136/c-raii-not-working)使进程崩溃并且核心转储其内存映像，而不是在清理之后。

但我们仍然必须了解这些情况，因为虽然它们很少发生，但它们仍然可能发生。

*（谁调用`terminate`或`exit`使用随意的 C++ 代码？...我记得在玩[GLUT](http://www.opengl.org/resources/libraries/glut/)时必须处理这个问题：这个库非常面向 C，甚至积极设计它以使 C++ 开发人员遇到困难，比如不关心关于[堆栈分配的数据，或者有关于](http://www.opengl.org/resources/faq/technical/glut.htm#glot0070)[永远不会从主循环返回的](http://www.opengl.org/resources/faq/technical/glut.htm#glot0090)“有趣”决定......我不会对此发表评论）*。

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2008-09-16T20:45:17.203

与其手动管理内存，不如尝试在适用的情况下使用智能指针。
看看[Boost 库](http://www.boost.org/)、[TR1](http://en.wikipedia.org/wiki/Technical_Report_1)和[智能指针](http://www.boost.org/doc/libs/1_36_0/libs/smart_ptr/smart_ptr.htm)。
智能指针现在也是 C++ 标准的一部分，称为[C++11](http://en.wikipedia.org/wiki/Smart_pointer)。

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2008-09-16T20:42:45.090

您需要查看智能指针，例如[boost 的智能指针](http://www.boost.org/doc/libs/1_36_0/libs/smart_ptr/shared_ptr.htm)。

代替

```
int main()
{ 
    Object* obj = new Object();
    //...
    delete obj;
} 
```

boost::shared_ptr 将在引用计数为零时自动删除：

```
int main()
{
    boost::shared_ptr<Object> obj(new Object());
    //...
    // destructor destroys when reference count is zero
} 
```

请注意我的最后一条注释，“当引用计数为零时，这是最酷的部分。因此，如果您的对象有多个用户，则不必跟踪该对象是否仍在使用中。一旦没有人引用您的共享指针，它会被销毁。

然而，这不是灵丹妙药。尽管您可以访问基指针，但您不希望将其传递给第三方 API，除非您对它的工作有信心。很多时候，您在创建范围完成后将内容“发布”到其他线程以完成工作。这在 Win32 中的 PostThreadMessage 中很常见：

```
void foo()
{
   boost::shared_ptr<Object> obj(new Object()); 

   // Simplified here
   PostThreadMessage(...., (LPARAM)ob.get());
   // Destructor destroys! pointer sent to PostThreadMessage is invalid! Zohnoes!
} 
```

与往常一样，将您的思维上限与任何工具一起使用...

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-09-16T20:45:39.403

阅读[RAII](http://en.wikipedia.org/wiki/Resource_acquisition_is_initialization)并确保您理解它。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2008-09-16T21:01:22.640

呸，你们这些年幼的孩子和你们新奇的垃圾收集器……

关于“所有权”的非常严格的规则 - 哪些对象或软件的一部分有权删除该对象。清晰的注释和明智的变量名称，以使指针“拥有”或“只看，不要碰”变得明显。为了帮助决定谁拥有什么，请在每个子例程或方法中尽可能遵循“三明治”模式。

```
create a thing
use that thing
destroy that thing 
```

有时需要在不同的地方进行创建和销毁；我认为很难避免这种情况。

在任何需要复杂数据结构的程序中，我都会使用“所有者”指针创建一个包含其他对象的严格清晰的对象树。此树对应用程序域概念的基本层次结构进行建模。示例 3D 场景拥有对象、灯光、纹理。在程序退出时渲染结束时，有一个明确的方法可以销毁所有内容。

每当一个实体需要访问另一个实体、扫描数组或其他任何东西时，都会根据需要定义许多其他指针；这些是“只是看”。对于 3D 场景示例 - 对象使用纹理但不拥有；其他对象可能使用相同的纹理。对象的销毁*不会*调用任何纹理的销毁。

是的，这很耗时，但这就是我所做的。我很少有内存泄漏或其他问题。但后来我在有限的高性能科学、数据采集和图形软件领域工作。我不经常处理银行和电子商务、事件驱动的 GUI 或高度网络化的异步混乱等交易。也许新奇的方法在那里有优势！

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2008-09-19T16:41:12.187

大多数内存泄漏是由于不清楚对象所有权和生命周期造成的。

首先要做的是尽可能在堆栈上分配。这处理了您需要为某种目的分配单个对象的大多数情况。

如果您确实需要“新建”一个对象，那么大多数情况下，它在其剩余生命周期内都会有一个明显的所有者。对于这种情况，我倾向于使用一组集合模板，这些模板旨在通过指针“拥有”存储在其中的对象。它们是使用 STL 矢量和地图容器实现的，但有一些区别：

*   无法复制或分配这些集合。（一旦它们包含对象。）
*   指向对象的指针被插入其中。
*   当集合被删除时，首先对集合中的所有对象调用析构函数。（我有另一个版本，它断言是否已破坏且不为空。）
*   由于它们存储指针，因此您还可以将继承的对象存储在这些容器中。

我对 STL 的看法是它如此专注于 Value 对象，而在大多数应用程序中，对象是唯一的实体，没有在这些容器中使用所需的有意义的复制语义。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-09-17T08:31:20.377

好问题！

如果您使用 c++ 并且正在开发实时 CPU 和内存应用程序（如游戏），则需要编写自己的内存管理器。

我认为你可以做的更好的是合并不同作者的一些有趣的作品，我可以给你一些提示：

*   固定大小分配器被广泛讨论，在网络中无处不在

*   小对象分配是由 Alexandrescu 于 2001 年在他的完美著作《现代 c++ 设计》中介绍的

*   在 Game Programming Gem 7 (2008) 中一篇由 Dimitar Lazarov 撰写的名为“高性能堆分配器”的惊人文章中可以找到一个巨大的进步（已分发源代码）

*   可以在[本文](http://entland.homelinux.com/blog/2008/08/19/practical-efficient-memory-management/)中找到大量资源

不要自己开始编写一个noob无用的分配器......首先记录你自己。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2008-09-16T20:47:17.993

一种在 C++ 中流行的内存管理技术是[RAII](http://en.wikipedia.org/wiki/Resource_acquisition_is_initialization)。基本上，您使用构造函数/析构函数来处理资源分配。当然，由于异常安全性，C++ 中还有一些其他令人讨厌的细节，但基本思想非常简单。

这个问题通常归结为所有权之一。我强烈推荐阅读 Scott Meyers 的 Effective C++ 系列和 Andrei Alexandrescu 的 Modern C++ Design。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-09-16T21:10:31.527

已经有很多关于如何不泄漏的信息，但是如果您需要一个工具来帮助您跟踪泄漏，请查看：

*   VS下的[BoundsChecker](http://www.compuware.com/products/devpartner/visualc.htm)
*   FluidStudio 的 MMGR C/C++ 库 [http://www.paulnettle.com/pub/FluidStudios/MemoryManagers/Fluid_Studios_Memory_Manager.zip](http://www.paulnettle.com/pub/FluidStudios/MemoryManagers/Fluid_Studios_Memory_Manager.zip)（它覆盖分配方法并创建分配、泄漏等报告）

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-09-16T20:42:23.170

随处可见的用户智能指针！整个类的内存泄漏就会消失。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2008-09-16T20:44:39.857

在您的项目中共享和了解内存所有权规则。使用 COM 规则可实现最佳一致性（[in] 参数归调用者所有，被调用者必须复制；[out] 参数归调用者所有，如果保留引用，则被调用者必须复制；等等）

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2008-09-16T20:46:27.263

**valgrind**也是在运行时检查程序内存泄漏的好工具。

它适用于大多数版本的 Linux（包括 Android）和 Darwin。

如果你曾经为你的程序编写单元测试，你应该养成在测试中系统地运行 valgrind 的习惯。它可能会在早期阶段避免许多内存泄漏。通常在简单的测试中比在完整的软件中更容易确定它们。

当然，这个建议对任何其他内存检查工具都有效。

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2008-09-16T20:47:51.503

此外，如果有标准库类（例如向量），请不要使用手动分配的内存。确保您是否违反了该规则，即您有一个虚拟析构函数。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-09-16T20:47:45.497

如果您不能/不使用智能指针（尽管这应该是一个巨大的危险信号），请输入您的代码：

```
allocate
if allocation succeeded:
{ //scope)
     deallocate()
} 
```

这很明显，但请确保在键入范围内的任何代码*之前键入它*

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-09-17T08:32:19.097

这些错误的常见来源是当您有一个方法接受对象的引用或指针但所有权不明确时。样式和注释约定可以降低这种可能性。

让函数获得对象所有权的情况成为特例。在发生这种情况的所有情况下，请务必在头文件中的函数旁边写一个注释来表明这一点。您应该努力确保在大多数情况下分配对象的模块或类也负责释放它。

在某些情况下，使用 const 会有很大帮助。如果一个函数不会修改一个对象，并且不存储在它返回后仍然存在的对它的引用，则接受一个 const 引用。通过阅读调用者的代码，很明显您的函数没有接受对象的所有权。你可以让同一个函数接受一个非常量指针，调用者可能会也可能不会假设被调用者接受了所有权，但是使用 const 引用是毫无疑问的。

不要在参数列表中使用非常量引用。在阅读调用者代码时，很不清楚被调用者可能保留了对参数的引用。

我不同意推荐引用计数指针的评论。这通常工作得很好，但是当你有一个错误并且它不起作用时，特别是如果你的析构函数做了一些不平凡的事情，比如在多线程程序中。如果不太难的话，一定要尝试调整你的设计以不需要引用计数。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-09-17T09:44:12.043

提示按重要性排序：

-Tip#1 永远记得将你的析构函数声明为“虚拟的”。

-提示#2 使用 RAII

-Tip#3 使用 boost 的智能指针

-Tip#4 不要编写自己的有缺陷的智能指针，使用 boost（在我现在正在进行的项目中，我不能使用 boost，而且我不得不调试自己的智能指针，我肯定不会使用再次使用相同的路线，但现在我无法向我们的依赖项添加提升）

-提示#5 如果它的一些随意/非性能关键（如在具有数千个对象的游戏中）的工作，请查看 Thorsten Ottosen 的 boost 指针容器

-提示#6 为您选择的平台查找泄漏检测标头，例如 Visual Leak Detection 的“vld”标头

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-09-16T20:46:00.323

如果可以，请使用 boost shared_ptr 和标准 C++ auto_ptr。那些传达所有权语义。

当你返回一个 auto_ptr 时，你是在告诉调用者你给了他们内存的所有权。

当你返回一个 shared_ptr 时，你是在告诉调用者你有一个对它的引用并且他们拥有部分所有权，但这不仅仅是他们的责任。

这些语义也适用于参数。如果调用者传递给你一个 auto_ptr，他们就给了你所有权。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-09-16T20:52:05.393

如果要手动管理内存，有两种情况：

1.  我创建了对象（可能间接地，通过调用分配新对象的函数），使用它（或者我调用的函数使用它），然后释放它。
2.  有人给了我参考，所以我不应该释放它。

如果您需要违反任何这些规则，请记录下来。

这都是关于指针所有权的。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-09-16T21:17:37.877

其他人首先提到了避免内存泄漏的方法（如智能指针）。但是，分析和内存分析工具通常是一旦遇到内存问题就可以追踪它们的唯一方法。

[Valgrind memcheck](http://valgrind.org/info/tools.html#memcheck)是一款出色的免费工具。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-09-17T08:20:41.900

仅对于 MSVC，将以下内容添加到每个 .cpp 文件的顶部：

```
#ifdef _DEBUG
#define new DEBUG_NEW
#endif 
```

然后，在使用 VS2003 或更高版本进行调试时，您会在程序退出时被告知任何泄漏（它会跟踪新/删除）。这是基本的，但它在过去帮助了我。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2008-09-17T13:45:16.643

valgrind（仅适用于 *nix 平台）是一个非常好的内存检查器

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2009-01-08T22:45:38.357

*   尽量避免动态分配对象。只要类具有适当的构造函数和析构函数，使用类类型的变量，而不是指向它的指针，并且避免动态分配和释放，因为编译器会为您完成。
    实际上，这也是“智能指针”使用的机制，并被其他一些作者称为 RAII ;-)。
*   当您将对象传递给其他函数时，更喜欢引用参数而不是指针。这避免了一些可能的错误。
*   尽可能声明参数 const，尤其是指向对象的指针。这样就不能“意外”释放对象（除非您将 const 扔掉；-)））。
*   尽量减少程序中进行内存分配和释放的位置数量。例如。如果您确实多次分配或释放相同的类型，请为它编写一个函数（或工厂方法;-)）。
    如果需要，您可以通过这种方式轻松创建调试输出（分配和取消分配的地址，...）。
*   使用工厂函数从单个函数分配多个相关类的对象。
*   如果您的类有一个带有虚拟析构函数的公共基类，您可以使用相同的函数（或静态方法）释放所有这些类。
*   使用 purify 之类的工具检查您的程序（不幸的是，很多 $/€/...）。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2008-09-16T20:55:21.097

您可以拦截内存分配函数，看看是否有一些内存区域在程序退出时未释放（尽管它并不适合*所有*应用程序）。

也可以在编译时通过替换操作符 new 和 delete 以及其他内存分配函数来完成。

例如检查这个[站点](http://www.scs.cs.nyu.edu/~dm/c++-new.html)[Debugging memory allocation in C++] 注意：删除运算符也有一个技巧，如下所示：

```
#define DEBUG_DELETE PrepareDelete(__LINE__,__FILE__); delete
#define delete DEBUG_DELETE 
```

您可以在一些变量中存储文件的名称以及重载的删除运算符何时知道它是从哪个位置调用的。这样，您就可以跟踪程序中的每个 delete 和 malloc。在内存检查序列结束时，您应该能够报告哪些分配的内存块没有被“删除”，通过文件名和行号来识别它，我猜这就是你想要的。

您也可以在 Visual Studio 下尝试类似[BoundsChecker](http://www.compuware.com/products/devpartner/visualc.htm)的东西，它非常有趣且易于使用。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2008-09-16T21:01:59.677

我们用一个层包裹所有分配函数，该层在前面附加一个简短的字符串，在最后附加一个标记标志。因此，例如，您将调用“myalloc(pszSomeString, iSize, iAlignment); 或 new("description", iSize) MyObject(); 它在内部为您的标题和标记分配指定的大小加上足够的空间。当然，不要忘记为非调试版本注释掉这个！这样做需要更多的内存，但好处远远超过成本。

这有三个好处 - 首先，它允许您轻松快速地跟踪哪些代码正在泄漏，通过快速搜索分配在某些“区域”但在这些区域应该释放时没有清理的代码。通过检查以确保所有哨兵完好无损，检测边界何时被覆盖也很有用。当我们试图找到那些隐藏得很好的崩溃或数组失误时，这为我们节省了很多次。第三个好处是跟踪内存的使用以查看谁是大玩家——例如，MemDump 中某些描述的整理会告诉您“声音”何时占用的空间比您预期的要多。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2008-09-16T21:13:27.323

C++ 在设计时考虑了 RAII。我认为在 C++ 中管理内存确实没有更好的方法。但请注意不要在本地范围内分配非常大的块（如缓冲区对象）。它可能导致堆栈溢出，如果在使用该块时边界检查存在缺陷，您可以覆盖其他变量或返回地址，从而导致各种安全漏洞。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2008-09-17T08:13:50.670

关于在不同位置分配和销毁的唯一示例之一是线程创建（您传递的参数）。但即使在这种情况下也很容易。这是创建线程的函数/方法：

```
struct myparams {
int x;
std::vector<double> z;
}

std::auto_ptr<myparams> param(new myparams(x, ...));
// Release the ownership in case thread creation is successfull
if (0 == pthread_create(&th, NULL, th_func, param.get()) param.release();
... 
```

这里改为线程函数

```
extern "C" void* th_func(void* p) {
   try {
       std::auto_ptr<myparams> param((myparams*)p);
       ...
   } catch(...) {
   }
   return 0;
} 
```

很容易不是吗？如果线程创建失败，资源将被 auto_ptr 释放（删除），否则所有权将传递给线程。如果线程如此之快以至于在创建之后它会在创建之前释放资源怎么办？

```
param.release(); 
```

在主函数/方法中被调用？没有！因为我们将“告诉”auto_ptr 忽略释放。C++ 内存管理容易吗？干杯，

艾玛！

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2008-09-17T13:42:56.743

以与管理其他资源（句柄、文件、数据库连接、套接字......）相同的方式管理内存。GC 也不会帮助你。

* * *

## 回答 #29

> 赞同：-3
> 
> 时间：2008-09-16T20:49:51.373

任何函数都返回一个。这样你就可以在那里进行释放并且永远不会错过它。

否则很容易出错：

```
new a()
if (Bad()) {delete a; return;}
new b()
if (Bad()) {delete a; delete b; return;}
... // etc. 
```

# google-app-engine - 有人在使用 web2py 吗？

> ID：76809
> 
> 赞同：66
> 
> 时间：2008-09-16T20:42:02.173
> 
> 标签：google-app-engine, web2py

有人在使用[web2py](http://web2py.com/)吗？

具体来说：

*   在生产中？
*   用什么数据库？
*   使用谷歌应用引擎？

    *   “外面”是指在stackoverflow。

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2008-10-13T04:23:21.697

欢迎您在[google group](http://groups.google.com/group/web2py)上提出同样的问题。您会在那里找到 500 多个用户，其中一些是开发公司，为他们的客户构建项目。

我的印象是，他们中的大多数人使用 postgresql（我就是这么做的），而其他一些人则使用 Google App Engine。事实上，web2py 是唯一允许您编写一次代码并且相同的代码将在 GAE、SQLite、MySQL、PostgreSQL、Oracle、MSSQL 和 FireBird 上运行的框架（具有 GAE 施加的限制）。

[您可以在此处](http://mdp.cti.depaul.edu/appliances)找到带有 GAE 源代码的 Reddish（reddit 克隆）设备

[在这里](http://mdp.cti.depaul.edu/who)您可以找到一些制作应用程序的链接。有些在 GAE 上运行。

@阿明：

Django 或 Pylons 没有任何问题。它们是优秀的框架。我在开发 web2py 之前使用过它们。你可以用 web2py 做一些你不能用它们做的事情。例如：

*   web2py 使用 Postgresql 进行分布式事务，Armin 要求使用此功能。
*   Django ORM 本身不进行迁移（参见[South](http://south.aeracode.org/)），web2py 可以。
*   Django ORM 不允许部分求和（计数（字段））和分组，web2py 允许。
*   web2py 可以一次连接到多个数据库，~~Django 和~~Pylons 需要被破解才能做到这一点，并且
*   web2py 在应用程序中有一个配置文件，而不是在项目级别，就像他们一样。
*   webp2y 为管理员记录所有回溯服务器端，Django 和 Pylons 没有。
*   web2py 程序通常在未经修改的 GAE 上运行。
*   web2py 具有内置的 xmlrpc Web 服务。
*   web2py 带有 jQ​​uery。

web2py 在很多方面做得更好（使用更一致的 API）和更快（例如处理模板和生成 SQL）。web2py 也非常紧凑（所有模块都适合 265K 字节），因此它比那些竞争项目更容易维护。

您只需学习 Python 和 81 个新函数/类（其中 50 个与相应的 HTML 标记具有相同的名称和属性`BR`， , `DIV`,`SPAN`等，19 个是验证器，`IS_IN_SET`,`IS_INT_IN_RANGE`等）。

无论如何，最重要的问题是 web2py 比 Django、Pylons、PHP 和 Rails 更容易。

您还会注意到 web2py 托管在 Google Code 和 Launchpad 上，并且没有打开的票证。所有过去的问题都在不到 24 小时内得到解决。

您还可以在 google 邮件列表中查看所有线程（今天的 10056 条消息）在 24 小时内得到了我或其他开发人员之一的答复。

你可以在亚马逊上找到一本关于 web2py 的书。

Armin，我知道你是 Jinja 的开发者。我喜欢 Jinja，但有不同的设计理念。Django 和 Jinja 都定义了自己的模板语言（特别是 Jinja 有很好的文档），但我更喜欢在模板中使用纯 Python，这样我的用户根本不需要学习模板语言。我很清楚每种方法的优缺点。让用户决定他们喜欢什么。没有必要互相批评。

@Andre： db.table.field 指的是字段对象。'table.field' 是一个字段名。当需要字段名称时，您始终可以传递字段对象，因为 str(db.table.field) 是“table.field”。唯一需要使用字符串而不是对象的情况是，当您需要按名称引用尚未定义的字段时……也许我们应该将此讨论移到适当的位置。;-)

我希望您决定尝试一下 web2py，无论您喜欢与否，我都希望听到您的意见。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-08-25T00:17:13.770

我正在将 web2py 用于小型网络应用程序。它在 Mechanical Turk 项目上运行 HIT，并为我提供了一个界面来控制和可视化它们。我开始使用 Google App Engine，但后来厌倦了无法直接访问数据库以及每次要上传代码时都必须永远等待的小烦恼，并使用 postgres 转移到本地服务器。GAE 使大多数事情变得更难，以使一些缩放事情更容易......除非你真的需要他们的缩放帮助，否则远离它。

我非常喜欢 web2py。与 Django 和 Ruby on Rails 相比，它更容易学习和上手。一切都很简单。您可以快速完成工作。Massimo 到处都在解决您的问题（即使在这个板上哈哈）。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-07T15:11:41.963

我大约 6 个月前开始使用 web2py。我之所以选择它，是因为我想从 PHP 迁移到 Python，因为 Python 的语言特性，我想拥有一个更加面向对象的方法。

web2py 的一体化方法真的很神奇，而且启动速度非常快。

作为一个前 symfony 用户，我很快就开始怀念不依赖于表结构的组件和表单。

仅使用一个简单的注册表单，我就无法找到 DRY 表格的方法。对我来说，真正的麻烦是表单验证。我忘记了细节，但我最终在表单本身中进行了表单验证。因为有些事情在其他方面不起作用。

此外，带有大量重复字符的大写单词的命名概念也不是我的事。

```
dba.users.name.requires=IS_NOT_EMPTY()
dba.users.email.requires=[IS_EMAIL(), IS_NOT_IN_DB(dba,'users.email')]
dba.dogs.owner_id.requires=IS_IN_DB(dba,'users.id','users.name')
dba.dogs.name.requires=IS_NOT_EMPTY()
dba.dogs.type.requires=IS_IN_SET(['small','medium','large'])
dba.purchases.buyer_id.requires=IS_IN_DB(dba,'users.id','users.name')
dba.purchases.product_id.requires=IS_IN_DB(dba,'products.id','products.name')
dba.purchases.quantity.requires=IS_INT_IN_RANGE(0,10) 
```

有时名称必须用引号括起来，有时则不需要……如果我查看了已经使用 web2py 制作的示例或站点，我真的没有看到使用 php 向前迈出了一大步。

我建议你：看看 web2py 是否适合你。这会很好，因为社区，尤其是 massimo（创建者）非常乐于助人和友善。

此外，与 django 相比，您的启动速度更快，如果您更改数据库模型，部署更容易且麻烦更少。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2010-09-30T00:49:18.370

正如 Massimo 上面所指出的，tenthrow 的团队使用 web2py 为[tenthrow.com](http://www.tenthrow.com/)

我们在 2009 年完成了大部分开发工作。我们的堆栈使用 cherokee、web2py、postgresql 和 amazon s3。在此之前，我们已经在各种框架和后端上完成了许多 Python Web 实现。如果说没有 web2py，我们根本不可能如此快速和轻松地完成 tenthrow，这是一种轻描淡写的说法。这是 Web 开发中最好的秘密。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2008-11-26T09:20:10.717

我正在评估 Web 框架很长时间了。我用 Perl 和 PHP 编写了我自己的（不是开放的）框架。嗯，PHP 有一个内置的死胡同，整个基础设施仍然很差，但我不想回到 Perl，所以我检查了 Python 和 Python Web 框架，如 Django、Turbogears、Pylon 和 web2py。有很多事情需要考虑，如果你想选择一个不是你自己的代码栈，你会经常挠头，因为仍然没有“正确的方法”来编程。然而，web2py 是我目前最喜欢的，因为尽管作者是一个“真正的程序员”，但让事情变得简单！看看 web2py 网站上的比较——我想知道为什么像 django 或 turbogears 这样的 python 框架必须在它们的代码中引入这种冗余和复杂的语法——web2py 显示，

@Armin：你能具体说明你的批评吗？您究竟在哪里看到 web2py “绕过 Python 语义”？我不明白你的意思。我必须承认我现在对 python 的了解还不是很深，但我认为 web2py 代码没有问题——事实上，我认为它非常出色，并且是当今可用的最好的框架之一。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2015-03-22T14:39:02.240

我将 web2py 用于学术目的。大约一年前，我在 pythonanywhere 上发表了一[本德语语法数字教科书](https://alexgoro.pythonanywhere.com/well)。

该资源需要身份验证，看起来像一个带有角色、活动和成绩的小型 LMS。这是我第一次有这种体验。它是成功的，因为 PHP 对我来说太难了，只有 web2py 可以提供一种清晰的方式来处理数据库。使用 Python，我可以轻松解决我的问题，例如文本分析和下载报告。至于数据库，那么 SQLite 就足够了。

我的学生喜欢设计和一切运作的方式。所以我对结果非常满意，并将为我的大学开发其他有趣的应用程序。

我认为 web2py 非常适合应用语言学家和 L2 教师，他们在计算机科学方面的经验不如程序员。所以这是我的拙见。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-09-29T11:29:32.373

我开始将它与 Postgresql 一起使用。但是距离生产还有很长的路要走……我也玩过 Zope V2 和 Ruby on Rails，真的很喜欢 web2py 的方法。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-08-03T18:54:18.433

我投票支持 Web2py。我只有时间开发一些小而有用的东西供我自己使用。

希望下个月我将有机会创建一个非常适合 Web2py 并在 Google 应用程序引擎上运行的应用程序。

Web2py = 呼吸新鲜空气！

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-09-16T20:56:48.800

这里列出了一些用户：http: [//mdp.cti.depaul.edu/who](http://mdp.cti.depaul.edu/who)。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2013-07-23T06:02:50.700

我们将它与我们的中文教师网站[www.dominochinese.com 一起使用](http://www.dominochinese.com)。我们的主机是[pythonanywhere.com](http://www.pythonanywhere.com)，我们喜欢它的简单性。我致力于构建东西，而不是希望我能让东西正常工作。我与 django 一起工作了 1.5 年，我讨厌它。从某种意义上说，我觉得 web2py 是 PHP 但在 python 中。它使人们无需进入面向对象编程就可以快速完成工作，这对于初学者和中级程序员来说真的很困惑。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-10-01T21:18:40.817

I am not using web2py. But I had a look at the source code and it's horrible for so many reasons. For one the database definitions as well as the views and models and I don't know what, are evaluated against a global dictionary of values. It feels like PHP in that regard (it's bypassing Python semantics in name behaviour) and is very inefficient and I could imagine that it's hard to maintain.

I have no idea where all that fuzz about web2py is coming from lately, but I really can't see a reason why anyone would want to use it.

What's wrong with Django or Pylons? What does web2py do that you can't do with Django in a few lines of code with a better performance, code that's easier to read and on an established platform where tons of developers will jump in and fix problems in no time if they appear. (Well, there are exceptions I must admit, but in general the developers fix problems quickly)

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2013-01-08T10:36:37.520

我使用 web2py 已经 2 年了，这个 web 框架很棒而且很独特。易于使用，接受很多 DB，但支持的最佳 DB 是 postgres。我已经使用 web2py 创建了 2 个项目，并且非常喜欢它的简单程度。1 项目是财务管理和其他邮件跟踪器，两者都在生产系统（4 linux lpar 和 postgres）中运行良好。web2py 是个不错的选择

[使用 web2py 2.5.1 创建的小应用程序] 更新

[http://freitasmgustavo.pythonanywhere.com/calculoST/](http://freitasmgustavo.pythonanywhere.com/calculoST/)

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2013-11-09T23:35:49.293

我在 Google [Appengine](http://www.crowdgrader.org)的 www.crowdgrader.org 上使用它。我存储数据如下：

*   我需要 ACID 的核心元数据存储在 Google Cloud SQL 中，这对我来说非常有效。对于大文本字段，我将键存储在 Google Cloud SQL 中，并将键值存储在数据存储区中。
*   用户输入的文本存储在 Google Datastore 中，见上文，密钥存储在 Cloud SQL 中。
*   文件上传进入 blobstore。

我正在慢慢地将更多的存储迁移到数据存储区，以便为不需要复杂查询并且可以处理一些最终一致性的事情获得更多的写入带宽。

我对 web2py + appengine + Google Cloud SQL + Datastore + Blobstore 感到非常高兴。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2008-12-09T19:29:18.923

实际上它使用的是 MySQL，但它可以立即切换到 postgresql，因为 web2py 是如此多样化:)

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2009-10-02T01:29:04.383

一段时间以来，我一直在评估 Web 框架。我更喜欢 web2py，因为它易于理解、紧凑而强大。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2010-09-20T08:40:46.013

我们在 7 个月前开始使用 Web2py。我们已经在埃尔普拉多（西班牙国家博物馆）有一个生产应用程序。我们开发了一个应用程序来检查和自动化所有系统，进行服务器统计、访问统计等。

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2010-01-16T12:32:06.577

我喜欢它，因为它很小，我可以很容易地与我的应用程序一起分发。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2009-09-01T06:21:20.553

我在 webfaction 和 GAE 上使用 web2py 在生产中使用 postgres。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2011-06-19T07:16:27.293

到目前为止，我将 web2py 用于小型项目，但我希望在我的公司中引入它。这是我最喜欢的网络框架。

[我的博客](http://uolter-blog.appspot.com/)使用 web2py 在 GAE 上运行。

我还有一个在 web2py 上运行的 Facebook 应用程序：[我的十大礼物](http://apps.facebook.com/mytop_ten_gift/)

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2018-12-11T07:39:33.453

我在生产环境中使用带有 Google App Engine 的 Web2py。请参阅[https://www.nittiolearn.com](https://www.nittiolearn.com)。

对于存储数据，使用谷歌数据存储（通过 web2py DAL 访问）除了存储使用谷歌云存储的大型资源。在过去的 5 年里，我在生产环境上进行了多次 web2py 版本升级，没有任何重大问题。

多年来，谷歌应用引擎也基本没有摩擦。

但是 Web2py 和 Google 应用引擎都没有像我 5-6 年前所想的那样被广泛采用。如果我开始一个新项目，我不太可能使用 web2py 或应用程序引擎，因为对这些技术感兴趣的开发人员数量有限。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2017-02-12T05:20:57.703

我在[定制应用程序](http://softqrate.appspot.com)的生产中使用带有 gae 和 google 数据存储的 web2py ，它是一个非常好的框架。

我确实对 GAE 上的工作进行了一些小修复，工作快速且稳定，我已经在我的 github soyharso 上发布了 Web2Py 版本更改使用。

上传到 GAE 的速度很快，版本控制应用程序引擎是安全的，谷歌提供的用于调整代码的免费套餐非常好，每月的费用足够

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2012-01-13T00:16:45.977

[http://www.noobmusic.com](http://www.noobmusic.com)正在使用 Google App Engine。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2011-10-01T22:47:45.797

好吧，我正在专业地使用 Web2Py，使用 PostgreSQL 和 linux。我正在开发名为“ [Ourway](http://www.ourway.ir) ”的社交网络。您可能会喜欢它的一些功能，例如“[博客](http://www.ourway.ir/pages/blog)”部分。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2013-08-12T18:26:55.483

我在生产中使用 web2py。目前，在早期生产阶段，我们正在使用 SQLite 进行开发，因为它很容易并且开箱即用，但稍后我们可能会切换到 MySQL。我不认为有任何使用 Google App Engine 的计划。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2019-04-30T06:49:46.687

这是相当古老的回应，但无论如何我都会加入。在 2008 年，这可能是一个很好的选择，还有 Django/Flask。它仍然可能是好的。但是现在人们想要立竿见影的效果，学习曲线更短。

公平地说，web2py 并不是那么直观。

我是否需要学习使用 MS Access 的 MVC 概念？我不在乎 URL 路由，只需要在 Web 上显示一些表格，最好进行一些验证。加上一些身份验证。

这就是像[http://jam-py.com/](http://jam-py.com/)这样的框架大放异彩的地方！不仅你不会迷路，而且它确实让你想起了几十年来统治办公室的 Access。2019 年仍然是规则。为什么？几乎没有学习曲线。

# language-agnostic - DoSomethingToThing(Thing n) 与 Thing.DoSomething()

> ID：76812
> 
> 赞同：12
> 
> 时间：2008-09-16T20:42:12.563
> 
> 标签：language-agnostic, oop, coding-style

哪些因素决定了哪种方法更合适？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-16T20:56:35.117

我认为两者都有自己的位置。

你不应该`DoSomethingToThing(Thing n)`仅仅因为你认为“函数式编程很好”就使用它。同样，您不应该简单地使用`Thing.DoSomething()`，因为“面向对象编程很好”。

我认为这取决于您要传达的内容。停止将您的代码视为一系列指令，并开始将其视为故事的段落或句子。从手头任务的角度考虑哪些部分是最重要的。

例如，如果您要强调的“句子”部分是宾语，则应使用 OO 样式。

例子：

```
fileHandle.close(); 
```

大多数时候，当您传递文件句柄时，您考虑的主要事情是跟踪它所代表的文件。

反例：

```
string x = "Hello World";
submitHttpRequest( x ); 
```

在这种情况下，提交 HTTP 请求远比作为正文的字符串重要，因此`submitHttpRequst(x)`最好`x.submitViaHttp()`

不用说，这些并不是相互排斥的。你可能实际上有

```
networkConnection.submitHttpRequest(x) 
```

您将它们混合在一起。重要的是要考虑要强调哪些部分，以及将要传达给代码的未来读者的内容。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-16T20:44:09.047

要面向对象，告诉，不要问： http: [//www.pragmaticprogrammer.com/articles/tell-dont-ask](http://www.pragmaticprogrammer.com/articles/tell-dont-ask)。

所以，Thing.DoSomething() 而不是 DoSomethingToThing(Thing n)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-16T20:47:22.520

如果您正在处理事物的内部状态，则 Thing.DoSomething() 更有意义，因为即使您更改了事物的内部表示或它的工作方式，与之对话的代码也不必改变。如果您正在处理事物的集合，或者编写一些实用方法，那么过程式的 DoSomethingToThing() 可能更有意义或更直接；但是，通常可以表示为表示该集合的对象上的方法：例如

```
GetTotalPriceofThings(); 
```

对比

```
Cart.getTotal(); 
```

这实际上取决于您的代码是如何面向对象的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-16T20:58:15.723

1.  **如果 Thing 是您句子的主题，则 **Thing.DoSomething是合适的。**

    *   **如果 Thing 是句子的宾语，则**DoSomethingToThing(Thing n)是合适的。****
    ***   **ThingA.DoSomethingToThingB(ThingB m)**是一种不可避免的组合，因为在我能想到的所有语言中，函数属于一个类而不是相互拥有的。但这是有道理的，因为你可以有一个主体和一个客体。**** 

 ****主动语态比被动语态更直接，因此请确保您的句子的主题不仅仅是“计算机”。这意味着，经常使用表格 1 和表格 3，而很少使用表格 2。

为了清楚起见：

```
// Form 1:  "File handle, close."
fileHandle.close(); 

// Form 2:  "(Computer,) close the file handle."
close(fileHandle);

// Form 3:  "File handle, write the contents of another file handle."
fileHandle.writeContentsOf(anotherFileHandle); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T21:25:42.100

我同意 Orion 的观点，但我将重新表述决策过程。

你有一个名词和一个动词/一个宾语和一个动作。

*   如果许多此类对象将使用此操作，请尝试将操作作为对象的一部分。
*   否则，请尝试将操作单独分组，但要使用相关操作。

我喜欢文件/字符串示例。有许多字符串操作，例如“SendAsHTTPReply”，对于您的普通字符串不会发生，但在特定设置中经常发生。但是，您基本上总是会关闭一个文件（希望如此），因此将 Close 操作放在类接口中是非常有意义的。

另一种思考方式是购买娱乐系统的一部分。将电视遥控器与电视捆绑在一起很有意义，因为您总是将它们一起使用。但是将特定录像机的电源线与电视捆绑在一起会很奇怪，因为许多客户永远不会使用它。关键思想是**这个动作在这个对象上使用的频率是多少**？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T20:43:58.597

这里几乎没有足够的信息。这取决于您的语言是否甚至支持构造“Thing.something”或等价物（即它是一种面向对象的语言）。如果是这样，那就更合适了，因为那是 OO 范式（成员应该与他们所作用的对象相关联）。当然，在程序风格中，DoSomethingtoThing() 是您唯一的选择……或者 ThingDoSomething()

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T20:44:09.750

DoSomethingToThing(Thing n) 更像是一种功能方法，而 Thing.DoSomething() 更像是一种面向对象的方法。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T20:44:22.807

那是面向对象与过程编程的选择:)

我认为有据可查的 OO 优势适用于 Thing.DoSomething()

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-16T20:47:46.153

这已被问到[设计问题：电话是否拨打电话号码，或者电话号码是否在电话上自行拨打？](https://stackoverflow.com/questions/68617/design-question-does-the-phone-dial-the-phonenumber-or-does-the-phonenumber-dia)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-16T20:49:38.817

以下是需要考虑的几个因素：

*   你能修改或扩展`Thing`类吗？如果没有，请使用前者
*   可以`Thing`实例化。如果没有，请使用后者作为静态方法
*   如果`Thing`实际得到修改（即具有更改的属性），则更喜欢后者。如果`Thing`未修改，则后者同样可以接受。
*   否则，由于对象旨在映射到现实世界的对象，请选择看起来更符合现实的方法。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-16T20:49:53.463

即使您不是使用 OO 语言工作，也可以使用 Thing.DoSomething()，以提高代码的整体可读性，具有一组函数，例如：

ThingDoSomething() ThingDoAnotherTask() ThingWeDoSomethingElse()

然后

另一件事做某事（）

等等要好得多。

所有适用于“事物”的代码都在一个位置。当然，“DoSomething”和其他任务的命名应该一致——所以你有一个 ThingOneRead()、一个 ThingTwoRead()……现在你应该明白了。当你在 12 个月后重新开始编写代码时，你会很高兴花时间让事情变得合乎逻辑。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-16T20:50:07.660

一般来说，如果“某事”是“事物”自然知道怎么做的动作，那么你应该使用 thing.doSomething()。这是很好的 OO 封装，因为否则 DoSomethingToThing(thing) 将不得不访问“事物”的潜在内部信息。

例如 invoice.getTotal()

如果“某物”自然不是“事物”域模型的一部分，那么一种选择是使用辅助方法。

例如：Logger.log(invoice)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-16T20:53:49.600

如果对对象执行某项操作可能会在另一种情况下产生不同的结果，那么我建议您使用 oneThing.DoSomethingToThing(anotherThing)。

例如，您可能在程序中保存了两个东西，因此您可能采用 DatabaseObject.Save(thing) SessionObject.Save(thing) 比 thing.Save() 或 thing.SaveToDatabase 或 thing.SaveToSession() 更有利.

我很少不向类传递任何参数，除非我正在检索公共属性。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-16T20:55:14.137

要添加到 Aeon 的答案，这取决于事情以及您想对它做什么。因此，如果您正在编写 Thing，并且 DoSomething 改变了 Thing 的内部状态，那么最好的方法是 Thing.DoSomething。但是，如果动作不仅仅改变内部状态，那么 DoSomething(Thing) 更有意义。例如：

```
Collection.Add(Thing) 
```

好于

```
Thing.AddSelfToCollection(Collection) 
```

如果您没有编写 Thing，并且无法创建派生类，那么您别无选择，只能做 DoSomething(Thing)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-16T20:59:41.163

即使在面向对象的编程中，使用函数调用而不是方法（或者就此而言调用对象的方法而不是我们调用它的方法）可能很有用。想象一个简单的数据库持久性框架，您只想在一个对象上调用 save()。您可以创建一个接口定义 save(Class1)、save(Class2 ) 等及其实施。然后您实际上会调用 databaseSaver.save(class1) 并将所有内容放在一个地方。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-16T21:06:10.260

我必须同意[凯文康纳](https://stackoverflow.com/users/10906/kevin-conner)

还要记住这两种形式中的任何一种的调用者。调用者可能是其他对象的一个​​方法，它肯定会对你的事物做一些事情:)

# apache-flex - 如何使用 Flex 在 ISO-8859-1 中发送 SOAP 请求？

> ID：76817
> 
> 赞同：1
> 
> 时间：2008-09-16T20:42:30.503
> 
> 标签：apache-flex, actionscript, soap, encoding, character-encoding

Flex 默认使用 UTF-8。我还没有找到在 actionscript WebService 类上指定不同编码/字符集的方法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T07:18:36.137

嗯，看这里：

[http://www.adobe.com/devnet/flex/articles/struts_06.html](http://www.adobe.com/devnet/flex/articles/struts_06.html)

我认为该示例意味着将您的 mxml 文件声明为 iso-8859-1 可能会奏效，但我真的不这么认为。

我可能错了，但据我所知 Flash 播放器只处理 UTF-8 编码。我已经搜索了指向官方页面的链接，但找不到。

如果是这种情况，您可以：

a) 更新 web 服务以处理 UTF-8 编码

b) 如果这不可能，请将您的呼叫代理到您自己的接受 UTF-8 的网络服务，然后调用实际的网络服务。

您可能想尝试使用旧的 system.useCodepage=true 技巧，但是当用户使用 Linux 或 Mac 时该技巧无法使用，请谨慎使用！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-17T09:09:17.120

还有一种方法可以为 flex 编译器指定编码，但这似乎不起作用。现在我发现的唯一解决方案是在服务器端重新编码传入的请求。我很惊讶这个限制在 flex 参考文档中没有写成白底黑字。

# html - 解释浏览器异常的 CSS“框架”？

> ID：76854
> 
> 赞同：7
> 
> 时间：2008-09-16T20:46:07.093
> 
> 标签：html, css, frameworks, cross-browser

我为一家小型媒体公司建立网站。不幸的是，我们大约 45-50% 的客户群使用 IE6，而另一半则在 Firefox 和基于 Webkit 的浏览器之间几乎平分秋色，还有少量 Opera 用户。

我的每一个站点都使用类似于 Eric Meyer 的重置样式表，并进行了一些修改。最近我一直在使用 Blueprint CSS“框架”，它让我的生活变得轻松了很多，尽管我并不特别喜欢它。

我大约 60% 的开发时间都花在确保我创建的网站在每个浏览器中看起来不会有太大的不同。我为 Firefox 3 编写代码，然后从那里进行调整。

有谁知道那里有任何样式表/框架试图抢先解决所有那些愚蠢的小浏览器怪癖？我知道没有什么可以完全解释所有浏览器的怪异之处，但如果有一些更可靠的东西开始就好了。

我正在努力创建自己的，但如果有一些东西可以开始就好了。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T20:51:16.113

Yahoo YUI 库有助于处理跨浏览器呈现问题。也就是说，Reset 组件 ( [http://developer.yahoo.com/yui/reset/](http://developer.yahoo.com/yui/reset/) ) 将恢复所有浏览器特定的渲染（例如某些元素的边距和填充），在设计网站时创建一个公平的竞争环境.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T20:51:47.297

看看[YAML](http://www.yaml.de/en/home.html)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T21:45:54.140

阅读并在内心消化Andy Clarke、Molly E. Holzschlag、Aaron Gustafson 和 Mark Boulton 的[Transcending CSS](http://www.transcendingcss.com/)。

它提供了一套技术来处理您可以处理的那些怪癖，并提供有关使旧版或功能较弱的浏览器或使用其他技术（例如屏幕阅读器）的浏览器可以访问网站的建议。

基本的推动力是使网站能够优雅地降级。

它包含许多指向处理这些问题的资源的链接。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T20:57:02.603

Dean Edwards 的[IE7 库](http://dean.edwards.name/IE7/)处理了一些 Internet Explorer 怪癖。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-18T10:27:59.107

Blueprint 是这个领域的早期出现之一，被认为是相当成熟的。

[http://code.google.com/p/blueprintcss/](http://code.google.com/p/blueprintcss/)

这是可用框架的巨大列表：

[http://www.cssnolanche.com.br/css-frameworks/](http://www.cssnolanche.com.br/css-frameworks/)

当时，Web 开发社区中存在很多关于 CSS 框架的有趣辩论。许多人担心这违反了某些结构/表示分离，并引入了非语义类名称和结构。

一些观点：

[http://jeffcroft.com/blog/2007/nov/17/whats-not-love-about-css-frameworks/](http://jeffcroft.com/blog/2007/nov/17/whats-not-love-about-css-frameworks/)

[http://playgroundblues.com/posts/2007/aug/10/blueprints-are-not-final/](http://playgroundblues.com/posts/2007/aug/10/blueprints-are-not-final/)

[http://www.markboulton.co.uk/journal/comments/blueprint_a_css_framework/](http://www.markboulton.co.uk/journal/comments/blueprint_a_css_framework/)

[http://peter.mapledesign.co.uk/weblog/archives/blueprint-semantics-markup-frameworks](http://peter.mapledesign.co.uk/weblog/archives/blueprint-semantics-markup-frameworks)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T20:47:30.757

你看过雅虎 YUI 的东西吗？他们有一个跨浏览器的 CSS 框架。

# caching - 在网络场中远程重置服务器缓存的最佳方法是什么？

> ID：76855
> 
> 赞同：1
> 
> 时间：2008-09-16T20:46:21.210
> 
> 标签：caching

我们的每个生产 Web 服务器都为单独的网站（ASP.NET Web 应用程序）维护自己的缓存。目前要清除缓存，我们登录服务器并“触摸”web.config 文件。

有没有人有一个安全/可靠的方式来**远程**重置特定 Web 应用程序的缓存的示例？理想情况下，我们可以说“清除所有服务器上运行的应用程序 X 的缓存”，但也可以说“清除服务器 Y 上运行的应用程序 X 的缓存”。

编辑/澄清：

*   我可能应该澄清一下，通过应用程序本身执行此操作并不是一个真正的选择（即某种登录到应用程序、浏览特定页面或清除缓存的处理程序）。为了做这样的事情，我们需要禁用/绕过日志记录和统计跟踪代码，或者弄乱我们的统计数据。

*   是的，缓存会定期过期。不过，我想做的是设置一些东西，这样我就可以根据需要使特定的缓存过期，通常是在我们更改数据库中的某些内容之后（我们使用的是 SQL 2000）。我们现在可以做到这一点，但只能通过登录服务器本身。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T22:17:37.903

对于每个应用程序，您可以编写一个小的 cache-dump.aspx 脚本来杀死缓存/应用程序数据。将其复制到您的所有应用程序并编写一个集线器脚本来管理调用。

为了安全起见，您可以添加各种身份验证查找或 IP 检查。

这是我进行实际应用程序转储的方式：

```
Context.Application.Lock()
Context.Session.Abandon()
Context.Application.RemoveAll()
Context.Application.UnLock() 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T12:30:07.883

找到一篇关于看起来很有用的触摸实用程序 的[DevX文章。](http://archive.devx.com/dotnet/articles/rj060502/rj060502-1.asp)

我将尝试将其与数据库中的表（添加记录，触摸实用程序找到它并更新相应的 web.config 文件）或 Web 服务（拨打电话并调用触摸实用程序进行更新）相应的 web.config 文件）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T21:11:11.213

这可能不是“优雅的”，但您可以设置执行批处理脚本的计划任务。该脚本基本上会为您“接触”web.config（或导致重新编译的其他文件）。

否则，您的应用程序缓存是否未设置为 N 分钟后过期？

# .net - 我可以更改在 .NET 中解析和实例化类型的方式吗？

> ID：76864
> 
> 赞同：0
> 
> 时间：2008-09-16T20:47:05.077
> 
> 标签：.net, new-operator

在某些语言中，您可以覆盖“new”关键字来控制类型的实例化方式。您不能直接在 .NET 中执行此操作。但是，我想知道是否有一种方法可以处理“找不到类型”异常并在“新建”该类型的人爆炸之前手动解析类型？

我正在使用一个序列化程序，它读取基于 xml 的文件并实例化其中描述的类型。我对序列化程序没有任何控制权，但我想与该过程进行交互，希望无需编写我自己的 appdomain 主机。

请不要建议替代序列化方法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-16T20:50:26.897

您可以将事件处理程序附加到 AppDomain.CurrentDomain.AssemblyResolve 以参与该过程。

您的 EventHandler 应返回负责在 ResolveEventArgs 中传递的类型的程序集。

[您可以在MSDN](http://msdn.microsoft.com/en-us/library/system.appdomain.assemblyresolve.aspx)上阅读有关它的更多信息

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T20:54:58.443

您还可以覆盖[AppDomain.TypeResolve](http://msdn.microsoft.com/en-us/library/system.appdomain.typeresolve(VS.80).aspx)事件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T20:56:35.163

[select is not broken](http://lingpipe-blog.com/2007/06/27/select-isnt-broken-or-horses-not-zebras/)讨论了如何以不同的方式看待它 - 错误可能出在您的设计中，而不是您的工具上。

我认为试图让“新”去做其他事情是错误的做法。

想想为什么必须谨慎使用运算符重载 - 当语言语义中有隐藏的变化时，它是违反直觉的并且难以调试。

退后一步，在更大的背景下看待设计，尝试找到更明智的方法来解决问题。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-16T20:49:26.290

您应该查看 Reflection 和 Activator 类。它们将允许您从字符串创建对象。当然，该对象必须位于您有权访问的程序集中之一。

# .net - 有没有办法在 NAnt 中动态加载属性文件？

> ID：76870
> 
> 赞同：20
> 
> 时间：2008-09-16T20:47:26.280
> 
> 标签：.net, build, automation, nant

我想根据一个变量加载不同的属性文件。

基本上，如果进行开发构建使用此属性文件，如果进行测试构建使用此其他属性文件，如果进行生产构建使用第三个属性文件。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-09-17T21:16:05.500

**第 1 步**：在您的 NAnt 脚本中定义一个属性以跟踪您正在构建的环境（本地、测试、生产等）。

```
<property name="environment" value="local" /> 
```

**第 2 步**：如果您还没有所有目标都依赖的配置或初始化目标，则创建一个配置目标，并确保您的其他目标都依赖它。

```
<target name="config">
    <!-- configuration logic goes here -->
</target>

<target name="buildmyproject" depends="config">
    <!-- this target builds your project, but runs the config target first -->
</target> 
```

**第 3 步**：更新您的配置目标以根据环境属性拉入适当的属性文件。

```
<target name="config">
    <property name="configFile" value="${environment}.config.xml" />
    <if test="${file::exists(configFile)}">
        <echo message="Loading ${configFile}..." />
        <include buildfile="${configFile}" />
    </if>
    <if test="${not file::exists(configFile) and environment != 'local'}">
        <fail message="Configuration file '${configFile}' could not be found." />
    </if>
</target> 
```

注意，我喜欢允许团队成员定义他们自己的 local.config.xml 文件，这些文件不会提交到源代码管理。这提供了一个存储本地连接字符串或其他本地环境设置的好地方。

**第 4 步**：在调用 NAnt 时设置环境属性，例如：

*   南特-D：环境=开发
*   南特-D：环境=测试
*   南特-D：环境=生产

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-17T00:13:51.260

您可以使用该[`include`](http://nant.sourceforge.net/release/latest/help/tasks/include.html)任务在主构建文件中包含另一个构建文件（包含您的属性）。任务的`if`属性`include`可以针对变量进行测试以确定是否应包含构建文件：

```
<include buildfile="devPropertyFile.build" if="${buildEnvironment == 'DEV'}"/>
<include buildfile="testPropertyFile.build" if="${buildEnvironment == 'TEST'}"/>
<include buildfile="prodPropertyFile.build" if="${buildEnvironment == 'PROD'}"/> 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-07T21:09:21.883

我有一个类似的问题，scott.caligan 的答案部分解决了，但是我希望人们能够设置环境并加载适当的属性文件，只需指定一个目标，如下所示：

*   南特开发
*   南特测试
*   南台

您可以通过添加一个设置环境变量的目标来做到这一点。例如：

```
<target name="dev">
  <property name="environment" value="dev"/>
  <call target="importProperties" cascade="false"/>
</target>

<target name="test">
  <property name="environment" value="test"/>
  <call target="importProperties" cascade="false"/>
</target>

<target name="stage">
  <property name="environment" value="stage"/>
  <call target="importProperties" cascade="false"/>
</target>

<target name="importProperties">
  <property name="propertiesFile" value="properties.${environment}.build"/>
  <if test="${file::exists(propertiesFile)}">
    <include buildfile="${propertiesFile}"/>
  </if>
  <if test="${not file::exists(propertiesFile)}">
    <fail message="Properties file ${propertiesFile} could not be found."/>
  </if>
</target> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T21:06:56.497

我做这种事情的方式是根据使用[nant task](http://nant.sourceforge.net/release/latest/help/tasks/nant.html)的构建类型包含单独的构建文件。一种可能的替代方法是使用[nantcontrib 中的 iniread 任务](http://nantcontrib.sourceforge.net/release/latest/help/tasks/iniread.html)。

# python - Python 程序员资源

> ID：76882
> 
> 赞同：21
> 
> 时间：2008-09-16T20:48:05.950
> 
> 标签：python, vba, porting

我用 Python 写了很多代码，也因此非常习惯 Python 的语法、对象结构等。

什么是为我提供基础知识的最佳在线指南或资源站点，以及 VBA 与 Python 中等效功能/特性的比较或查找指南。

例如，我无法将 Python 中的简单列表等同于 VBA 代码。我也有数据结构的问题，比如字典等等。

有哪些资源或教程可以为我提供将 python 功能移植到 VBA 的指南，或者只是从强大的 OOP 语言背景适应 VBA 语法？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-10-09T09:52:30.017

VBA 与 Python 完全不同，因此您至少应该阅读您将要使用的应用程序（Excel、Access...）提供的“Microsoft Visual Basic 帮助”。

一般来说，VBA 相当于 Python 模块；它们被称为“库”，它们不像 Python 模块那样容易创建。我之所以提到它们，是因为库将为您提供可以使用的更高级别的类型。

作为启动助推器，有两种类型可以替代`list`和`dict`。

## `list`

VBA 的类型为`Collection`. 默认情况下它是可用的（它在库中`VBA`）。所以你只需做一个
`dim alist as New Collection`
，从那时起，你就可以使用它的方法/属性：

*   `.Add(item)`( list.append(item) ),
*   `.Count`( len(list) ),
*   `.Item(i)`( list[i] ) 和
*   `.Remove(i)`（删除列表[i]）。非常原始，但它就在那里。

您还可以使用 VBA Array 类型，它像 python 数组是相同类型项目的列表，与 python 数组不同，您需要`ReDim`更改它们的大小（即您不能只是追加和删除项目）

## `dict`

要拥有类似字典的对象，您应该将脚本库添加到您的 VBA 项目中¹。之后，您可以
`Dim adict As New Dictionary`
然后使用它的属性/方法：

*   `.Add(key, item)`( dict[key] = item ),
*   `.Exists(key)`( dict.has_key[key] ),
*   `.Items()`( dict.values() ),
*   `.Keys()`( dict.keys() )，
    以及您将在对象浏览器²中找到的其他内容。

¹ 打开 VBA 编辑器 (Alt+F11)。转到工具→参考，并检查列表中的“Microsoft Scripting Runtime”。

² 要查看对象浏览器，在 VBA 编辑器中按 F2（或查看→对象浏览器）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T20:54:10.660

本教程不适合“python 程序员”，但我认为它是一个非常好的 vba 资源：

[http://www.vbtutor.net/VBA/vba_tutorial.html](http://www.vbtutor.net/VBA/vba_tutorial.html)

这个网站使用列表回顾了一个真实的例子：

[http://www.ozgrid.com/VBA/count-of-list.htm](http://www.ozgrid.com/VBA/count-of-list.htm)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-16T20:57:01.920

可能不完全是您正在寻找的，但如果您有一些编程背景，这是一个不错的 VBA 站点。这不是这个=那个的列表，而是更多的问题/解决方案

[http://www.mvps.org/access/toc.htm](http://www.mvps.org/access/toc.htm)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-09T21:36:01.017

虽然我不是 Python 程序员，但您也许可以使用 Iron Python 和 Visual Studio 运行 VSTO。至少这样，您不必学习 VBA 语法。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-16T20:57:22.010

作为 Office 2000、2003 和 VB6 的一部分实施的 VBA 已被弃用，取而代之的是 .Net 技术。除非您坚持使用 python 维护旧代码，或者甚至使用 IronPython for .Net。如果您使用 IronPython，则在处理各种 COM 对象（例如 Office 中的对象）时，您可能必须在各处编写一些 C#/VB.Net 帮助程序类，否则它应该是非常实用且美观的。几乎所有的 Python 优点都在 IronPython 中结束了。如果您只是在编写一些 COM 脚本，请查看 ActiveState 输出的内容。我过去用它来做一些 COM 工作。特别是使用 Python 作为主动脚本语言（经典 ASP）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-08T23:46:32.440

我认为就常用用法而言，列表的等价物是数组。在 Python 中通常使用列表的地方，您通常会在 VB 中使用数组。但是，与 Python 列表相比，VB 数组非常不灵活，更像 C 中的数组。

```
' An array with 3 elements
'' The number inside the brackets represents the upper bound index
'' ie. the last index you can access
'' So a(2) means you can access a(0), a(1), and a(2) '

Dim a(2) As String
a(0) = "a"
a(1) = "b"
a(2) = "c"

Dim i As Integer
For i = 0 To UBound(a)
    MsgBox a(i)
Next 
```

请注意，如果您声明元素的初始数量，则无法调整 VB 中的数组大小。

```
' Declare a "dynamic" array '

Dim a() As Variant

' Set the array size to 3 elements '

ReDim a(2)
a(0) = 1
a(1) = 2

' Set the array size to 2 elements
'' If you dont use Preserve then you will lose
'' the existing data in the array '

ReDim Preserve a(1) 
```

您还将在 VB 中遇到各种集合。例如。[http://devguru.com/technologies/vbscript/14045.asp](http://devguru.com/technologies/vbscript/14045.asp)

VB中的字典可以这样创建：

```
Set cars = CreateObject("Scripting.Dictionary")
cars.Add "a", "Alvis"
cars.Add "b", "Buick"
cars.Add "c", "Cadillac" 
```

[http://devguru.com/technologies/vbscript/13992.asp](http://devguru.com/technologies/vbscript/13992.asp)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-17T00:41:57.323

> “我无法将 Python 中的简单列表与 VBA 中的某些内容等同起来......”

这不是学习语言的最佳方式。在某种程度上，您正在放弃大量 Python，因为 VBA 中没有类似的东西。

如果在 VBA 中没有像 Python 列表那样的东西，那么——嗯——它是新的东西。而 new 将是 Python 部分的重要价值。

[Python内置类型](http://docs.python.org/lib/types.html)的第一部分可能无法很好地映射到 VBA。这使学习显得令人生畏。但是将自己限制在 VBA 中出现的内容往往会妨碍学习。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-09T10:15:59.063

这听起来可能很奇怪，但是由于我在 C++ 中学习了数据结构，所以我很难弄清楚如何在没有指针的情况下创建它们。VB6/VBA 有些东西让我觉得它们不自然。无论如何，我遇到了 MSDN 的这一部分，其中有几个用 VBA 编写的数据结构示例。我发现它很有用。

[使用类模块创建动态数据结构](http://msdn.microsoft.com/en-us/library/aa227473(VS.60).aspx)

# sql-server - 排除超时 SqlExceptions

> ID：76891
> 
> 赞同：4
> 
> 时间：2008-09-16T20:48:30.287
> 
> 标签：sql-server, ado.net, sqlexception

我有一些奇怪的行为，我无法弄清楚为什么会发生。我看到间歇性超时异常。我很确定它与体积有关，因为它在我们的开发环境中不可重现。作为一个创可贴的解决方案，我尝试将 sql 命令超时时间提高到 60 秒，但正如我发现的那样，这似乎没有帮助。这是奇怪的部分，当我检查失败的进程的日志时，这里是开始和结束时间：

*   2008 年 9 月 16 日 16:21:49
*   2008 年 9 月 16 日 16:22:19

那么当我将命令超时设置为六十时，它怎么会在三十秒内超时？

仅供参考，这是抛出的异常：

```
System.Data.SqlClient.SqlException: Timeout expired.  The timeout period elapsed prior to completion of the operation or the server is not responding.
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj)
   at System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj)
   at System.Data.SqlClient.SqlDataReader.ConsumeMetaData()
   at System.Data.SqlClient.SqlDataReader.get_MetaData()
   at System.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString)
   at System.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean async)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method, DbAsyncResult result)
   at System.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior, String method)
   at System.Data.SqlClient.SqlCommand.ExecuteReader()
   at SetClear.DataAccess.SqlHelper.ExecuteReader(CommandType commandType, String commandText, SqlParameter[] commandArgs) 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T20:53:19.680

这听起来可能很愚蠢，但请听我说完。检查查询中涉及的所有索引和主键。它们存在吗？它们是碎片化的吗？我遇到了一个问题，出于某种原因，直接运行脚本只是找到了，但是当我通过应用程序执行此操作时，它就像泥土一样慢。阅读器基本上就像游标一样，所以索引非常重要。

可能不是这个，但它始终是我检查的第一件事。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-17T00:39:03.523

SQL 命令超时，因为您正在使用的查询需要比执行时间更长的时间。在 Query Analyzer 或 Management Studio 中执行它，*在数据库中有代表性的数据量*，并查看执行计划以找出慢的地方。

如果某事占用了大量时间并被描述为“表扫描”或“聚集索引扫描”，请查看是否可以创建一个索引，将该操作转换为键查找（索引查找或聚集索引）寻找）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T20:50:24.103

尝试更改 SqlConnection 的超时属性，而不是命令的超时属性

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T20:51:06.037

因为超时发生在连接上，而不是命令上。您需要设置[connection.TimeOut](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqlconnection.connectiontimeout.aspx)属性

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T20:58:00.403

我曾经遇到过这个问题，我在我的一个数据库视图中将它跟踪到一些非常低效的 SQL 代码。有人将带有子查询的复杂条件放入表连接的 ON 子句中，而不是放入它所属的 WHERE 子句中。一旦我纠正了这个错误，问题就消失了。

# javascript - swfObject + scriptaculous 自动完成器 = 失败

> ID：76905
> 
> 赞同：2
> 
> 时间：2008-09-16T20:49:43.950
> 
> 标签：javascript, scriptaculous, swfobject

由于某种原因，同一页面上的 swfobject.js 和 script.aculo.us Ajax.Autocompleter 的组合导致后者失败。自动完成程序不会发出其 Ajax 请求。同一页面上使用 Ajax.Updater 的单独 Ajax 控件似乎没有相同的问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-16T13:49:40.677

如果您在本地计算机上使用 Firefox，出于安全原因，AJAX 请求不起作用。

要么上传到服务器，要么尝试[xampp 之](http://www.apachefriends.org/en/xampp.html)类的东西来轻松地在您自己的机器上运行网络服务器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-16T20:56:17.287

prototype.js（由 scriptaculous 使用）和 swfobject.js 可能不兼容。您使用的这些工具的版本是什么？您是否尝试切换“脚本”导入标签的顺序以便首先导入 swfobject？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T21:16:15.290

呸，我应该在原始问题中包含尝试过的版本。

我尝试了 swfobject 1.5、2.0 和 2.1（当前）以及 scriptaculous 的 1.7.x 和 1.8.x 版本的组合，它们分别依赖于prototype.js 的 1.5.x 和 1.6.x。我尝试在原型/脚本库之前和之后加载 swfobject，但无济于事。

我被引导相信某处潜伏着根本的不兼容性，但在谷歌上却找不到任何关于它的东西，这本身似乎有点奇怪。

# wcf - 如何格式化用于执行从 VBScript / ASP 到 WCF 服务的 HTTP 发布的消息并获得响应？

> ID：76925
> 
> 赞同：1
> 
> 时间：2008-09-16T20:51:35.723
> 
> 标签：wcf, asp-classic, vbscript

做帖子不是问题！格式化消息以便我得到响应是问题所在。

理想情况下，我能够构建一条消息并使用 WinHTTP 向 WCF 服务（托管在 IIS 中）执行发布并获得响应，但到目前为止，我一直无法构建正常工作的东西。

有没有人有一个这样做的例子是直截了当的？

在 2.0 Web 服务世界中，这就像在 web.config 中设置一个设置以使服务响应帖子然后使用正确的参数调用适当的 Web 方法一样简单。在 WCF 世界中似乎没有类似的东西。

到目前为止，我没有选择将使用者（vbscript 端）转换为 .NET。

假设此时在端点我可以转换为使用任何可用的绑定，直到 .NET 3.5 支持的任何绑定，但同时如果这可以使用 WsHttpBinding 或 BasicHttpBinding 完成，那么正确的答案将是描述如何在 VBScript 的上下文中为这些绑定中的任何一个设置消息格式，或者如果没有办法这样做，那么就说，你不能这样做。如果这可以使用 WebHTTPBinding 完成，那么我还没有找到实现它的方法，因为我已经研究了 WebInvoke 属性并且无法创建从 VBScript 到 WCF 的正常工作的测试。

假设发布的数据类型是字符串，响应也是字符串。

这个问题也与 WinHTTP 无关。我已经知道如何使用 WinHTTP 执行发布，这是构建 WCF 服务将响应的消息的问题。

虽然我可以使用 WinHTTP 以外的其他东西来执行从 ASP 到 WCF 服务（如 XMLHTTP）的发布，但我仍然存在构建 WCF 服务将响应的 XML 消息的问题。我已经对此进行了尝试，但仍然无法理解我需要使用哪种格式来实现这一点。

从理论上讲，我知道所有 WCF 服务需要的是格式正确的消息。我只是无法正确构建消息，通常虽然每个人都对如何发送消息有一些建议，但我还没有看到有人给出一个实际示例来说明在这种情况下正确的消息格式是什么，因为每个人都习惯于使用 .NET 发送消息，在这种情况下一切都已为您完成。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T01:24:01.793

您没有指定一件事：您将服务公开为什么绑定？如果您使用的是 WsHttpBinding 或 BasicHttpBinding，那么就没有简单的“http post”可以做，因为您至少需要包含整个 SOAP 信封（带有正确的 SOAP 版本和潜在的安全标头等）。

如果您正在使用（或可以迁移到）.NET 3.5，那么有一个明确创建的新绑定来支持这样的场景，您希望您的服务不是作为 SOAP 服务而是作为完全类似 REST 的服务公开，或者就像基于 HTTP 的 XML/JSON 一样。它被称为 WebHttpBinding。

您可以调整许多选项，但很有可能您可以使用 webHttpBinding 添加一个新端点，并且几乎可以立即使用。

这可能会让您在新的编程模型上领先一步：http: [//msdn.microsoft.com/en-us/library/bb412169.aspx](http://msdn.microsoft.com/en-us/library/bb412169.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-18T18:26:30.157

这是我在 ASP 中进行后台 HTTP 发布的最简单代码

```
Set objXML = CreateObject("MSXML2.ServerXMLHTTP.6.0")
objXML.open "POST", url, false
objXML.setRequestHeader "Content-Type", "application/x-www-form-urlencoded"
objXML.send("key="& Server.URLEncode(xmlvalue))
Set responseXML = objXML.responseXML
Set objXML = nothing 
```

这只需要您在服务器上安装 MSXML 对象。我将它用于各种事物，包括 ASP 中的 XML-RPC 服务器/客户端。

编辑：重新阅读您的问题，如果您以特定方式设置，那么这将无济于事，但如果您真的只是在寻找一种访问网络服务的方法，只要您构建 XML 以正确发布，这将起作用.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T21:08:10.143

不久前，我为一个读取 XML 文件、将内容发布到 URL 然后保存结果的 excel 宏编写了一些代码。

```
Sub ExportToHTTPPOST()
Dim sURL, sExtraParams
Const ForReading = 1, ForWriting = 2, ForAppending = 3

Set rs = CreateObject("Scripting.FileSystemObject")
Set r = rs.OpenTextFile("y:\test.xml", ForReading)

Set Ws = CreateObject("Scripting.FileSystemObject")
Set w = Ws.OpenTextFile("Y:\test2.xml", ForWriting, True)

Do Until r.AtEndOfStream

    sData = sData & r.readline

Loop

sURL = "http://MyServer/MyWebApp.asp"

sData = "payload=" & sData

    Set objHTTP = New WinHttp.WinHttpRequest

            objHTTP.Open "POST", sURL, False
            objHTTP.setRequestHeader "Content-Type", "application/x-www-form-urlencoded"
            objHTTP.send sData
            w.writeline objHTTP.ResponseText
    Set objHTTP = Nothing
    w.Close
    r.Close
End Sub 
```

# exif - 在 Windows Vista 中调整来自多个相机的照片的 EXIF 时间戳的最简单方法是什么？

> ID：76930
> 
> 赞同：3
> 
> 时间：2008-09-16T20:52:02.133
> 
> 标签：exif, photo-management

**场景：** 几个人一起去度假，带着数码相机，然后匆匆离开。有的人记得把相机时钟调到当地时间，有的人把他们留在家里的时间，有的人把他们留在他们出生国家的当地时间，还有一些人把他们的相机留在工厂时间。

**问题：**照片的 EXIF 元数据中的时间戳不会同步，因此很难将所有照片聚合到一个组合集合中。

**问题：**假设您已发现所有相机时钟之间的差异，在 Windows Vista 中纠正这些时间戳差异的*最简单方法是什么？*

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-16T21:08:41.563

使用 exiftool。开源，用 perl 编写，但也可作为独立的 .exe 文件使用。作者似乎拥有*一切*与 exif 相关的东西。成熟的代码。

例子：

```
exiftool "-DateTimeOriginal+=5:10:2 10:48:0" DIR

exiftool -AllDates-=1 DIR 
```

参考：

*   [http://www.sno.phy.queensu.ca/~phil/exiftool/](http://www.sno.phy.queensu.ca/~phil/exiftool/)
*   [http://www.sno.phy.queensu.ca/~phil/exiftool/#shift](http://www.sno.phy.queensu.ca/~phil/exiftool/#shift)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-17T20:09:31.540

Windows Live Photo Gallery Wave 3 Beta 包括此功能。从帮助：

> 如果您同时更改多张照片的日期和时间设置，则每张照片的时间戳都会更改相同的量，因此所有选定照片的时间戳都会保持其原始时间顺序。

**指示：**

1.  选择要更改的照片（您可以使用搜索功能来限制相机型号等）。
2.  右键单击并选择“更改所用时间...”。
3.  选择一个新时间，然后单击确定。

当前下载位置来自[LiveSide.net](http://www.liveside.net/main/archive/2008/09/16/windows-live-wave-3-betas-download-now.aspx)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T21:01:29.083

最简单的，可能是一个小的 python 脚本，它将使用类似 os.walk 的东西来遍历文件夹下的所有文件，然后使用[pyexiv2](http://tilloy.net/dev/pyexiv2/index.htm)实际读取并修改 EXIF 数据。可以在[此处](http://tilloy.net/dev/pyexiv2/tutorial.htm)找到有关 pyexiv2 的教程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-12-06T08:00:56.520

为此，我敢于建议我的软件：[EXIFTimeEdit](https://github.com/Fr0sT-Brutal/App_EXIFTimeEdit)。开源且简单，它支持我能想象到的所有可能的变体：

*   将日期部分（年/月/日/小时/分钟）移动任意值
*   将日期部分设置为任何值
*   确定必要的班次值
*   将生成的时间戳复制到 EXIF DateTime 字段和最后修改的属性

# .net - 引用 Microsoft.SqlServer.Smo 的应用程序需要在目标计算机上包含其他程序集吗？

> ID：76933
> 
> 赞同：5
> 
> 时间：2008-09-16T20:52:13.710
> 
> 标签：.net, reference

我有一个引用 Microsoft.SqlServer.Smo 程序集的小应用程序（因此我可以向用户显示他们可以连接的服务器和数据库的列表）。

我的应用程序最初引用了 Microsoft.SqlServer.Smo 和 Microsoft.SqlServer.ConnectionInfo。事情在我的开发盒上按预期工作。

当我在测试机器上安装应用程序时，我收到了**System.IO.FileNotFoundException**。该消息的详细信息包括以下内容： **无法加载文件或程序集 Microsoft.SqlServer.SmoEnum**

除了上面提到的那些，我最终通过引用以下程序集解决了这个问题：

*   Microsoft.SqlServer.SmoEnum
*   Microsoft.SqlServer.SqlEnum
*   Microsoft.SqlServer.BatchParser
*   Microsoft.SqlServer.Replication

任何人都可以确认我确实需要在我的应用程序中包含这些附加程序集（并因此将它们安装在用户的机器上），即使应用程序在我的开发盒上构建良好而没有引用它们？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2014-05-13T14:29:25.177

您需要在目标机器上安装两个 MSI 文件，即：

1) SQLSysClrTypes.msi [C#需要这个-> SMO GAC]

2) SharedManagementObjects.msi

对于 SQL Server 2014，您可以[在此处](http://www.microsoft.com/en-us/download/details.aspx?id=42295)下载这些内容。

此外，您必须确保版本正确。这两个文件可以通过一些谷歌搜索找到。这样您就不会将任何内容复制到本地，它们将由 GAC 解决。

我知道这是个老问题，但答案并不令人满意。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T21:34:15.230

是的，它们确实需要包括在内。在开发机器上，您可能安装了 SQL Server，它将这些程序集放入全局程序集缓存中。每当您构建时，Visual Studio 只是从 GAC 中提取它们。它还假定将部署它的任何计算机的 GAC 也将具有这些文件。如果不是，它会抛出 FileNotFound 异常。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T21:31:18.590

由于 JIT 在运行时链接到外部程序集，因此如果不分析您的代码并查看您调用的内容以及这些调用调用的内容等，就无法回答这个问题。

如果你想自己分析这个，最好的办法是只引用你需要的程序集，然后从异常和内部异常中了解发生了什么。

您应该研究的另一件事是为什么您提到的四个程序集不在 GAC 中。看起来他们应该是。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-04-27T17:58:26.017

对我来说，这个答案原来不是真的。我添加了上述参考，但没有解决方案。最终我发现我只需要参考：

微软.SqlServer.Smo

...以及以下决议：

[我在 SQL Server 复制项目上收到“尝试加载格式不正确的程序”错误](https://stackoverflow.com/questions/41449/i-get-a-an-attempt-was-made-to-load-a-program-with-an-incorrect-format-error-on/2926982#2926982)

总而言之，我需要启用我的 IIS 6 以在 IIS 应用程序池上启用 32 位应用程序。这是因为我安装了 Win 7 x64 但安装了 SQL x86。太糟糕了，错误消息不能更具体吧？

# database - 数据库在管理信息方面有多重要？

> ID：76934
> 
> 赞同：2
> 
> 时间：2008-09-16T20:52:24.520
> 
> 标签：database

我受雇帮助编写一个为最终用户管理某些信息的应用程序。它旨在管理几兆字节的信息，但也可以管理全分辨率的扫描图像。这个项目是否应该使用数据库，为什么或为什么不？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T20:54:23.873

任何问题“我应该使用某种工具吗？” 归结为确切地询问您想做什么。你应该问自己——“我想为这些数据编写自己的存储吗？”

大多数基于 Web 的应用程序都是针对数据库编写的，因为大多数数据库都支持许多“免费”功能——您可以拥有多个 Web 服务器。您可以使用标准工具来编辑、验证和备份您的数据。您可以拥有具有事务的强大存储解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T20:56:20.593

数据库在处理图像数据本身时对您没有多大帮助，但任何管理一堆图像的东西都会有关于您将要处理的图像的元数据。根据元数据和你想用它做什么，一个数据库确实很有帮助。

仅仅因为数据库对图像数据的帮助不大，这并不意味着您不能将图像存储在数据库中。您可以将它们存储在 SQL 数据库的 BLOB 列中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T20:58:35.283

如果数据量很小，或者安装在许多客户端机器上，您可能不需要数据库的开销。

它是否打算安装在许多用户的机器上？添加确保您可以在客户端安装的应用程序上运行您选择的任何数据库引擎的开销并不是最佳的。由于数据量很小，我认为 XML 在这里就足够了。您可以对图像进行 Base64 编码并将它们存储为 CDATA。

应用程序会在服务器上运行吗？如果您有并发用户，那么数据库具有处理这些场景（事务）的概念，这可能会有所帮助。并且扫描的图像数据适用于 BLOB。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T21:03:21.247

您不应该将图像存储在数据库中，这是[这里](https://stackoverflow.com/questions/3748/storing-images-in-db-yea-or-nay)的普遍共识。

文件系统在存储图像方面比您的数据库要好得多。

您应该使用数据库来存储有关这些图像的元信息，例如标题、描述等，并且只存储图像的 URL 或路径。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T21:17:14.663

当谈到在数据库中存储图像时，我尽量避免它。在你的情况下，我可以从你的问题中收集到大量相当大的图像，所以我可能会强烈反对。

如果这是一个 Web 应用程序，我会使用数据库来使用关键字和其他参数快速搜索和索引图像。如果可能的话，使用某种文件夹结构在文件系统中设置一个指向图像位置的列，以帮助进一步减少图像加载时间。

如果由于目录可用（网络共享）而需要更高的安全性并且应用程序是本地的，那么您可能应该硬着头皮将图像存储在数据库中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T20:55:39.347

我的直觉反应是“为什么不呢？” 数据库将提供一个用于存储信息的框架，所有输入/输出/优化功能都以文档格式提供。您可以使用服务器端解决方案，或本地数据库，例如 SQLite 或本地版本的 SQL Server。无论哪种方式，您都有一个健壮的、记录在案的数据管理框架。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-16T20:55:57.520

[这篇文章](https://stackoverflow.com/questions/3748/storing-images-in-db-yea-or-nay)应该为您提供有关在数据库中存储图像所需的大部分意见。你的意思是“我应该使用数据库来获取其他信息吗？” 还是您只是在询问图像？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-16T20:56:05.290

我们的 CMS 存储我们处理的所有支票图像。它使用数据库存储元数据，并让文件系统处理扫描的图像。

像 SQLite 这样的简单数据库听起来很合适——它可以让您以一致的、事务性的方式存储文件元数据。然后将每个图像的路径存储在数据库中，让文件系统做它最擅长的事情——管理文件。

SQL Server 2008 有一种为数据库内文件构建的新数据类型，但在此之前，BLOB 是在数据库中存储文件的方式。在小范围内也可以。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-16T20:59:45.390

数据库旨在管理大量数据，并且应该让您快速访问以读取和写入该数据，而不管其大小。简而言之，他们管理数据的规模——你不想处理的规模。如果您只有几个用户（数百个？），您可以轻松地管理磁盘上的数据（比如 XML？）并将数据保存在内存中。图像显然不应该进入数据库，所以问题是有多少数据，或者你为多少用户维护这个数据库实例？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-16T20:59:49.523

如果您想要一种结构化的方式来存储和检索信息，那么数据库绝对是您的最佳选择。它使您的应用程序更灵活、更强大，并让您专注于实际应用程序，而不是像尝试编写自己的存储系统这样的杂事。

对于个人应用程序，[SQLite](http://www.sqlite.org/ "SQLite")非常棒。它适合作为文件的应用程序；不需要整个 DRBMS 主宰。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-16T21:00:56.730

这有很多因素。但是，作为一个数据库小精灵，我会在拥有数据库方面犯错。当事情发生变化时，它只会让生活更轻松。事情*会*发生变化。

根据图像的不同，您可以将它们存储在文件系统上，或者将它们实际放在 blob 中并将它们放入数据库中（并非所有 DBMS 都支持）。如果文件非常小，那么我会删除它们。如果它们很大，那么我会将它们保存在文件系统中并自己管理它们。

那里有很多免费或便宜的 DBMS，真的没有理由不使用它们。我是一个 SQL Server 人，但如果你的应用程序那么简单，那么免费版本的 mysql 应该可以完成这项工作。事实上，它里面有一些很酷的东西。

# visual-studio - x64 上的 x86 远程调试器服务

> ID：76939
> 
> 赞同：10
> 
> 时间：2008-09-16T20:52:58.933
> 
> 标签：visual-studio, debugging, remote-debugging

是否可以在 64 位机器上安装 x86 远程调试器即服务？我需要将调试器附加到会话 0 进程中的托管代码。该进程运行 32 位，但安装的调试器服务是 64 位，不会附加到 32 位进程。

我尝试使用 SC 命令创建服务，并且能够启动服务，并验证它是否在任务管理器进程中运行。但是，当我尝试使用 Visual Studio 连接到它时，它说远程调试器监视器未启用。当我停止 x86 服务并启动 x64 服务时，它能够找到监视器，但仍然出现错误。

这是我尝试使用远程调试器时的错误：无法附加到进程。64 位版本的 Visual Studio 远程调试监视器 (MSVSMON.EXE) 无法调试 32 位进程或 32 位转储。请改用 32 位版本。

这是我尝试在本地附加时出现的错误：此计算机不支持附加到不同终端服务器会话中的进程。尝试远程调试机器并在进程会话中运行 Microsoft Visual Studio 远程调试监视器。

如果我尝试将 32 位远程调试器作为应用程序运行，它将无法工作附加 b/c 远程调试器正在我的会话中而不是在会话 0 中运行。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-15T03:12:37.013

在安装 rdbgsetup_x64.exe 并通过配置向导后，这适用于我的机器（TM）：

```
sc stop msvsmon90
sc config msvsmon90 binPath= "C:\Program Files\Microsoft Visual Studio 9.0\Common7\IDE\Remote Debugger\x86\msvsmon.exe /service msvsmon90"
sc start msvsmon90 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-12-08T12:03:08.987

在尝试远程调试在 64 位 IIS 中以 32 位运行的网站时，我们遇到了同样的问题。

你也可以这样做：

*   停止默认的调试服务（它将是 x64，因为安装程序会很聪明并配置它来运行）。
*   导航到远程调试器开始菜单文件夹并运行 x86 调试服务。忽略关于
    32bit/64bit 的警告。
*   打开远程调试器应用程序窗口的工具->选项窗口，并
    记下“服务器
    名称”文本框中的值。
*   现在，您可以通过将“服务器名称”
    值复制到 Visual Studio 的“附加到进程”对话框上的“限定符”文本/组合框中来附加您
    的 Visual Studio。

在相关说明中，如果您从 Windows 2008/7/Vista 连接到 2003 机器，则通过此处的连接报告给 MS（然后作为“外部”关闭），则 Kerberos 身份验证也存在低级错误：[https： //connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=508455](https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=508455)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-16T22:27:00.767

我没有尝试过，但无论如何这里有一个建议：

尝试手动安装 x86 远程调试器服务。

```
sc create "Remote Debugger" binpath= "C:\use\short\filename\in\the\path\x86\msvsmon.exe /service msvsmon90" 
```

两个注意事项：

*   您需要在 msvsmon.exe 的路径中使用短文件名，以防止必须引用路径（因为需要引用整个命令）
*   “binpath=”之后必须有一个空格（“=”字符之前不能有空格）。为 sc 命令编写命令行解析器的人应该受到诅咒。

然后，您可以使用 services.msc 控制面板小程序以正确的凭据运行它。

您可能不得不停止甚至删除现有的 x64 远程调试器服务。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-15T03:23:08.707

我可以确认你想做的事情确实有效。我经常用 VS2008 远程调试器将我的 32 位 xp 优化连接到 x64 win2003 服务器。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-04-10T14:57:49.973

1) 安装 x64 版本。这也会安装 x86 调试器，但不会创建快捷方式。

2) 你可以在这里找到 x86 进程调试的可执行文件... C:\Program Files\Microsoft Visual Studio 14.0\Common7\IDE\Remote Debugger\x86\msvsmon.exe

3) 如果需要，请将其固定到任务栏。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-09-25T11:21:25.740

为我工作而无需安装其他软件。我刚刚复制了`C:\Program Files (x86)\Microsoft Visual Studio 10.0\Common7\IDE\Remote Debugger`VM 上的文件夹并`msvsmon.exe`从该`x86`文件夹启动。我的客人和主人都是`x64`。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-01-31T11:35:31.937

有时会出现这个错误，我只是关闭了Visual Studio并再次打开它，一切正常！

来自vs的非常奇怪的行为

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-12-27T00:06:03.617

我今天遇到了这个问题（64 位操作系统和 VS 2019）。我将配置更改为对项目使用 x64，将 IISExpress 更改为使用 64 位，将平台目标更改为 x64。它仍然使用 32 位调试器并抱怨。最后，当我启用脚本调试时，它开始使用 64 位调试器。所以我会说所有的组合都成功了。

# rss - 我应该使用哪个库在 Common Lisp 中生成 RSS？

> ID：76945
> 
> 赞同：5
> 
> 时间：2008-09-16T20:53:45.890
> 
> 标签：rss, common-lisp

为用 Common Lisp 编写的网络服务器生成 RSS 的最佳库是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T21:13:30.473

[xml-emitter](http://www.cliki.net/xml-emitter)说它内置了一个 RSS 2.0 发射器。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-17T01:17:34.397

CL-WHO 可以很容易地生成 XML。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-18T12:22:38.613

大多数事情可能都会做。就个人而言，我一直在为我的博客的 Atom 提要使用 xml-emitter，到目前为止效果很好。

我会说，只要选择您喜欢的任何 XML 生成库并破解即可。正如其他人所说，RSS 很简单。手动生成它的工作量很小。

也就是说，我建议不要直接生成纯字符串。处理引用数据比安装 XML 库更麻烦，而且如果您的提要包含网站访问者提交的数据，这也是[不安全的。](http://en.wikipedia.org/wiki/Cross-site_scripting "跨站脚本")

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T08:32:07.427

我不知道任何特定的 RSS 库。但是格式相当简单，因此任何可以编写 xml 的库都可以在该级别上执行。

例如，您可以查看 nuclblog ( [http://cyrusharmon.org/projects?project=nuclblog](http://cyrusharmon.org/projects?project=nuclblog) ) 项目，因为它能够为它维护的博客条目生成 RSS 提要。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-06-16T08:36:39.757

[cl-rss-gen](http://www.cliki.net/cl-rss-gen)是一个小型库（LGPL，取决于 CL-WHO），它为您做一些样板工作（通过指定哪个插槽映射到哪个属性，支持直接从 CLOS 类实例生成 RSS 条目）。

在使用它之前看一下代码，它可能会让您了解它是如何工作的以及您是否需要它（正如其他海报所说，您可以使用 CL-WHO 或任何 XML 生成库自己生成 RSS）。

哦，很抱歉复活了一个四年前的帖子，但是如果有人搜索类似的库，他/她会在这里找到答案。

# c# - 寻找一个简单的 C# 数字编辑控件

> ID：76963
> 
> 赞同：1
> 
> 时间：2008-09-16T20:55:24.810
> 
> 标签：c#, edit, numeric

我是一名 MFC 程序员，不熟悉 C#，正在寻找一个允许数字输入和范围验证的简单控件。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-16T20:58:49.433

查看“NumericUpDown”控件。它具有范围验证，输入将始终是数字，并且具有那些漂亮的增量/减量按钮。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T22:17:03.567

我必须实现一个只接受数字、整数或实数的控件。我将控件构建为 TextBox 控件的特化（阅读：派生自），并使用输入控件和常规表达式进行验证。添加范围验证非常简单。

这是构建正则表达式的代码。_numericSeparation 是一个字符串，其字符接受为十进制逗号值（例如，“.”或“,”：$10.50 10,50€</p>

```
private string ComputeRegexPattern()
{
   StringBuilder builder = new StringBuilder();
   if (this._forcePositives)
   {
       builder.Append("([+]|[-])?");
   }
   builder.Append(@"[\d]*((");
   if (!this._useIntegers)
   {
       for (int i = 0; i < this._numericSeparator.Length; i++)
       {
           builder.Append("[").Append(this._numericSeparator[i]).Append("]");
           if ((this._numericSeparator.Length > 0) && (i != (this._numericSeparator.Length - 1)))
           {
               builder.Append("|");
           }
       }
   }
   builder.Append(@")[\d]*)?");
   return builder.ToString();
} 
```

正则表达式匹配任何数字（即任何带有数字字符的字符串），只有一个字符作为数字分隔符，并且字符串开头有一个“+”或“-”可选字符。创建正则表达式后（实例化控件时），检查值是否正确覆盖 OnValidating 方法。CheckValidNumber() 只是将正则表达式应用于引入的文本。如果正则表达式匹配失败，则激活具有指定错误的错误提供程序（使用 ValidationError 公共属性设置）并引发 ValidationError 事件。在这里您可以进行验证以了解该号码是否在要求的范围内。

```
private bool CheckValidNumber()
{
   if (Regex.Match(this.Text, this.RegexPattern).Value != this.Text)
   {
       this._errorProvider.SetError(this, this.ValidationError);
       return false;
   }
   this._errorProvider.Clear();
   return true;
}

protected override void OnValidating(CancelEventArgs e)
{
   bool flag = this.CheckValidNumber();
   if (!flag)
   {
      e.Cancel = true;
      this.Text = "0";
   }
   base.OnValidating(e);
   if (!flag)
   {
      this.ValidationFail(this, EventArgs.Empty);
   }
} 
```

正如我所说，我还阻止用户在文本框中输入数据，而不是覆盖 OnKeyPress 方法的数字字符：

```
protected override void OnKeyPress(KeyPressEventArgs e)
{
    if ((!char.IsDigit(e.KeyChar) && !char.IsControl(e.KeyChar)) && (!this._numberSymbols.Contains(e.KeyChar.ToString()) && !this._numericSeparator.Contains(e.KeyChar.ToString())))
    {
        e.Handled = true;
    }
    if (this._numberSymbols.Contains(e.KeyChar.ToString()) && !this._forcePositives)
    {
        e.Handled = true;
    }
    if (this._numericSeparator.Contains(e.KeyChar.ToString()) && this._useIntegers)
    {
        e.Handled = true;
    }
    base.OnKeyPress(e);
} 
```

优雅的触感：每次用户释放按键时，我都会检查数字是否有效，以便用户在键入时获得反馈。（但请记住，您必须小心 ValidationFail 事件；））

```
protected override void OnKeyUp(KeyEventArgs e)
{
    this.CheckValidNumber();
    base.OnKeyUp(e);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-16T20:59:02.960

您可以使用常规文本框和验证器控件来控制输入。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T21:08:12.860

尝试使用错误提供程序控件来验证文本框。您可以使用 int.TryParse() 或 double.TryParse() 检查它是否为数字，然后验证范围。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T21:16:11.170

您可以使用RequiredFieldValidator 和CompareValidator 的组合（设置为DataTypeCheck 运算符和类型设置为整数）

如果您愿意，可以使用普通文本框获得它，否则上面的建议很好。

# c# - 使用 Outlook API 访问特定文件夹

> ID：76964
> 
> 赞同：3
> 
> 时间：2008-09-16T20:55:34.153
> 
> 标签：c#, api, outlook

我正在尝试编写一些 C# 代码来访问 Outlook 邮箱中的特定文件夹。我有以下代码：

```
Outlook.Application oApp = new Outlook.Application();
Outlook.NameSpace oNS = oApp.GetNamespace("mapi");
Outlook.Recipient oRecip = oNS.CreateRecipient("AccountNameHere");
oRecip.Resolve();
if (oRecip.Resolved)
{
  oInbox = oNS.GetSharedDefaultFolder(oRecip, Outlook.OlDefaultFolders.olFolderInbox);
  oInboxMsgs = oInbox.Items;
  ItemCount = oInboxMsgs.Count;
  Console.Writeline("There are {0] items.", ItemCount.ToString())
} 
```

这将使我进入“收件箱”文件夹。我正在尝试访问与收件箱文件夹处于同一级别的文件夹。我相信我需要使用 GetFolderFromID 而不是 GetSharedDefaultFolder，但我不明白如何使用它。有没有办法遍历所有顶级文件夹？如何确定文件夹的 EntryID 和 StoreID？

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-16T21:13:41.393

您可以使用 Outlook.NameSpace 对象的 Folders 集合成员。这样您就可以遍历集合并通过其名称找到您的文件夹。如果您仍想使用 GetFolderFromID，您可以使用[OutlookSpy](http://www.dimastr.com/outspy/)工具获取 EntryID 和 StoreID 值。

# sql - 一旦数据在系统中，就修复糟糕的 BAD 数据库设计

> ID：76967
> 
> 赞同：7
> 
> 时间：2008-09-16T20:55:50.393
> 
> 标签：sql, ms-access, database-design

我知道这不是一个问题……无论如何，这就是问题所在。

我继承了一个数据库，其中包含 1（一个）表，看起来很像这样。其目的是记录在各个（200 多个）国家发现的物种。

```
ID 
Species
Afghanistan
Albania
Algeria
American Samoa
Andorra
Angola
....
Western Sahara
Yemen
Zambia
Zimbabwe 
```

数据样本将是这样的

```
id Species Afghanistan Albania American Samoa
1  SP1         null     null        null
2  SP2          1         1         null
3  SP3         null      null         1 
```

在我看来，这是典型的多对多情况，我想要 3 张桌子。物种、国家和物种FoundInCountry

链接表 (SpeciesFoundInCountry) 在物种和国家表中都有外键。

（很难画图！）

```
Species
SpeciesID  SpeciesName

Country
CountryID CountryName

SpeciesFoundInCountry
CountryID SpeciesID 
```

有没有一种神奇的方法可以生成一个插入语句，该语句将根据列名和原始巨型表中有 1 的 SpeciesID 从新的 Country 表中获取 CountryID？

我可以为一个国家做这件事（这是一个展示我想要的东西的选择）

```
SELECT Species.ID, Country.CountryID
FROM Country, Species
WHERE (((Species.Afghanistan)=1)) AND (((Country.Country)="Afghanistan")); 
```

（巨型表称为物种）

但是使用这种策略，我需要对原始表中的每一列进行查询。

有没有办法在sql中做到这一点？

我想我可以 OR 一堆我的 where 子句并编写一个脚本来制作 sql，虽然看起来不优雅！

有什么想法（或需要澄清）？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-16T20:58:26.033

为什么要在 SQL 中执行此操作？只需编写一个进行转换的小脚本。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-16T21:00:37.480

我会使用一个脚本来生成所有单独的查询，因为这是一个一次性的导入过程。

某些程序（例如 Excel）擅长混合不同维度的数据（将列名与行内的数据进行比较），但关系数据库很少这样做。

但是，您可能会发现某些系统（例如 Microsoft Access，令人惊讶的是）具有方便的工具，您可以使用这些工具来规范化数据。就我个人而言，我会发现编写脚本更快，但您在 Access 和脚本方面的相关技能可能与我的不同。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-16T21:01:38.380

当我遇到这些时，我编写了一个脚本来进行转换，而不是尝试在 SQL 中进行转换。对我来说，它通常更快更容易。选择您喜欢的任何语言。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-16T21:24:02.760

如果这是 SQL Server，您将使用 Unpivot 命令，但查看您分配给它的用于访问的标记 - 我说的对吗？

尽管 [access 中有一个旋转命令](http://www.blueclaw-db.com/accessquerysql/pivot_query.htm)，但没有反向语句。

看起来可以通过复杂的连接来完成。查看这篇[有趣](http://weblogs.sqlteam.com/jeffs/archive/2008/04/23/unpivot.aspx)的文章，了解如何在选择命令中取消透视。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T20:59:46.233

您可能想要在适当的位置创建替换表。脚本种类取决于您可以使用的脚本语言，但您应该能够通过列出您现在拥有的表的列来创建国家/地区 ID 表。完成此操作后，您可以进行一些字符串替换以遍历所有唯一的国家名称并插入给定国家列不为空的 speciesFoundInCountry 表中。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-16T21:01:43.747

您可能会变得聪明并在系统表中查询列名，然后构建一个动态查询字符串来执行，但老实说，这可能比为您生成 SQL 语句的快速脚本更难看。

希望您没有太多动态 SQL 代码来访问隐藏在代码库中的旧表。那可能是*真正*困难的部分。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-16T21:03:02.793

在 SQL Server 中，这将生成您演示的自定义选择。您可以推断插入

> ```
> select 
>   'SELECT Species.ID, Country.CountryID FROM Country, Species WHERE (((Species.' + 
>  c.name + 
>  ')=1)) AND (((Country.Country)="' +
>  c.name + 
>  '"))'
> from syscolumns c
> inner join sysobjects o
> on o.id = c.id
> where o.name = 'old_table_name' 
> ```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-16T21:03:36.210

与其他人一样，我很可能只是以任何适合您的方式一次性快速修复它。

使用这些类型的转换，它们是一次性的，快速修复，并且代码不必优雅，它只需要工作。对于这些类型的事情，我已经做了很多方法。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-16T21:03:46.740

如果这是 SQL Server，您可以使用 sys.columns 表来查找原始表的所有列。然后你可以使用动态 SQL 和 pivot 命令来做你想做的事。在线查找语法。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-16T21:10:32.353

我绝对同意您编写一个小脚本来生成 SQL 并为每一列查询的建议。

实际上，您的脚本可能在您花时间思考这个神奇的查询时就已经完成（您只会使用一次然后扔掉，那么让它变得神奇和完美有什么用）

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-16T21:55:51.560

我会通过对您的 SpeciesFoundInCountry 表进行轻微临时修改来使其成为一个三步过程。我会在该表中添加一列来存储国家名称。然后步骤如下。

1) 创建/运行一个脚本，遍历源表中的列，并在 SpeciesFoundInCountry 中为每个具有真值的列创建一条记录。该记录将包含国家名称。2) 运行一条 SQL 语句，通过加入 Country Name 上的 Country 表来更新 SpeciesFoundInCountry.CountryID 字段。3) 通过删除 CountryName 列来清理 SpeciesFoundInCountry 表。

这是一个小的 MS Access VB/VBA 伪代码，为您提供要点

```
Public Sub CreateRelationshipRecords()

  Dim rstSource as DAO.Recordset
  Dim rstDestination as DAO.Recordset
  Dim fld as DAO.Field
  dim strSQL as String
  Dim lngSpeciesID as Long

  strSQL = "SELECT * FROM [ORIGINALTABLE]"
  Set rstSource = CurrentDB.OpenRecordset(strSQL)
  set rstDestination = CurrentDB.OpenRecordset("SpeciesFoundInCountry")

  rstSource.MoveFirst

  ' Step through each record in the original table
  Do Until rstSource.EOF
    lngSpeciesID = rstSource.ID
    ' Now step through the fields(columns). If the field
    ' value is one (1), then create a relationship record
    ' using the field name as the Country Name
    For Each fld in rstSource.Fields
      If fld.Value = 1 then
        with rstDestination
          .AddNew
          .Fields("CountryID").Value = Null
          .Fields("CountryName").Value = fld.Name
          .Fields("SpeciesID").Value = lngSpeciesID
          .Update
        End With
      End IF
    Next fld  
    rstSource.MoveNext
  Loop

  ' Clean up
  rstSource.Close
  Set rstSource = nothing
  ....

End Sub 
```

在此之后，您可以运行一个简单的 SQL 语句来更新 SpeciesFoundInCountry 表中的 CountryID 值。

UPDATE SpeciesFoundInCountry INNER JOIN Country ON SpeciesFoundInCountry.CountryName = Country.CountryName SET SpeciesFoundInCountry.CountryID = Country.CountryID;

最后，您所要做的就是通过删除 CountryName 列来清理 SpeciesFoundInCountry 表。

****旁注：我发现拥有包含 ISO 缩写（国家代码）的国家/地区表很有用。有时，它们在其他表中用作外键，因此查询中不必包含对 Country 表的连接。

欲了解更多信息： [http ://en.wikipedia.org/wiki/Iso_country_codes](http://en.wikipedia.org/wiki/Iso_country_codes)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-16T21:57:48.903

抱歉，该死的帖子解析器删除了我帖子中的空格和格式。它使日志更难阅读。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-16T22:51:27.510

@跺脚：

在您键入答案的框上方，有几个按钮。101010 是代码示例。您选择所有作为代码的文本，然后单击该按钮。然后它不会被弄乱。

```
cout>>"I don't know C"
cout>>"Hello World" 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-16T23:13:02.497

我会使用一个联合查询，非常粗略：

```
Dim db As Database
Dim tdf As TableDef

Set db = CurrentDb

Set tdf = db.TableDefs("SO")

strSQL = "SELECT ID, Species, """ & tdf.Fields(2).Name _
    & """ AS Country, [" & tdf.Fields(2).Name & "] AS CountryValue FROM SO "

For i = 3 To tdf.Fields.Count - 1
    strSQL = strSQL & vbCrLf & "UNION SELECT ID, Species, """ & tdf.Fields(i).Name _
    & """ AS Country, [" & tdf.Fields(i).Name & "] AS CountryValue FROM SO "
Next

db.CreateQueryDef "UnionSO", strSQL 
```

然后，您将拥有一个可以附加到您的新设计的视图。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-16T23:30:41.097

当我读到标题“糟糕的 BAD 数据库设计”时，我很想知道它有多糟糕。你没有让我失望：）

正如其他人提到的，脚本将是最简单的方法。这可以通过用 PHP 编写大约 15 行代码来完成。

```
SELECT * FROM ugly_table;
while(row)
foreach(row as field => value)
if(value == 1)
SELECT country_id from country_table WHERE country_name = field;

if(field == 'Species')
SELECT species_id from species_table WHERE species_name = value;

INSERT INTO better_table (...) 
```

显然这是伪代码，不会按原样工作。您还可以通过在此处添加插入语句来动态填充国家和物种表。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-09-16T23:54:20.307

抱歉，我几乎没有做过 Access 编程，但我可以提供一些应该有所帮助的指导。

首先让我们来解决这个问题。假设您通常需要在 SpeciesFoundInCountry 中为原始表中的每一行生成多行。换句话说，物种往往存在于不止一个国家​​。这实际上很容易用笛卡尔积实现，即没有连接条件的连接。

要进行笛卡尔积，您需要创建 Country 表。该表应具有从 1 到 N 的 country_id（N 是唯一国家/地区的数量，200 左右）和国家/地区名称。为了让生活更轻松，只需按列顺序使用数字 1 到 N。这将使阿富汗 1 和阿尔巴尼亚 2 ...津巴布韦 N。您应该能够使用系统表来执行此操作。

接下来从包含物种和每个国家/地区的 0 或 1 刺痛的原始表创建一个表或视图。您需要将 null 而不是 null 转换为文本 0 或 1，并将所有值连接成一个字符串。表格的描述和带有正则表达式的文本编辑器应该使这很容易。首先对单个列进行试验，一旦起作用，编辑所有列的创建视图/插入。

接下来将两个表连接在一起，没有连接条件。这将为您提供每个国家/地区每个物种的记录，您几乎就在那里。

现在您所要做的就是过滤掉无效的记录，它们将在字符串中的相应位置有一个零。由于 country 表的 country_code 列具有子字符串位置，您需要做的就是过滤掉它为 0 的记录。

```
where substring(new_column,country_code) = '1' 
```

您仍然需要创建物种表并加入该表

```
where a.species_name = b.species_name 
```

a 和 b 是表别名。

希望这有帮助

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-09-17T00:02:16.327

OBTW,

如果您有已经针对旧表运行的查询，则需要创建一个视图，该视图使用新表复制旧表。您将需要对表进行非规范化分组。

告诉您的用户将来将不支持旧表/视图，并且所有新查询或对旧查询的更新都必须使用新表。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-09-23T03:59:26.960

如果我必须创建一大堆类似的 SQL 语句并执行所有这些语句，我经常会发现 Excel 非常方便。接受您的原始查询。如果 A 列中有国家列表，B 列中有 SQL 语句，格式为文本（带引号），并在国家出现在 sql 中的位置插入单元格引用

例如 ="INSERT INTO new_table SELECT ... (species." & A1 & ")= ... ));"

然后只需将公式复制下来以创建 200 条不同的 SQL 语句，将列复制/粘贴到您的编辑器并按 F5。当然，您可以根据需要使用尽可能多的变量来执行此操作。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2008-10-13T14:07:44.683

这是（希望）一次性练习，所以一个不优雅的解决方案可能没有听起来那么糟糕。

问题（因为，我相信您只是太清楚了！）是在您的查询中的某个时刻，您必须列出所有这些列。:(问题是，最优雅的方法是什么？下面是我的尝试。它看起来很笨拙，因为有很多列，但它可能是你所追求的，或者至少它可能会指向你正确的方向。

## 可能的 SQL 解决方案：

```
/* if you have N countries */
CREATE TABLE Country
(id    int, 
 name  varchar(50)) 

INSERT Country
      SELECT 1, 'Afghanistan'
UNION SELECT 2, 'Albania', 
UNION SELECT 3, 'Algeria' ,
UNION SELECT 4, 'American Samoa' ,
UNION SELECT 5, 'Andorra' ,
UNION SELECT 6, 'Angola' ,
...
UNION SELECT N-3, 'Western Sahara', 
UNION SELECT N-2, 'Yemen', 
UNION SELECT N-1, 'Zambia', 
UNION SELECT N, 'Zimbabwe', 

CREATE TABLE #tmp
(key        varchar(N),  
 country_id int) 
/* "key" field needs to be as long as N */  

INSERT #tmp 
SELECT '1________ ... _', 'Afghanistan' 
/* '1' followed by underscores to make the length = N */

UNION SELECT '_1_______ ... ___', 'Albania'
UNION SELECT '__1______ ... ___', 'Algeria'
...
UNION SELECT '________ ... _1_', 'Zambia'
UNION SELECT '________ ... __1', 'Zimbabwe'

CREATE TABLE new_table
(country_id int, 
species_id int) 

INSERT new_table
SELECT species.id, country_id
FROM   species s , 
       #tmp    t
WHERE  isnull( s.Afghanistan, ' ' ) +  
       isnull( s.Albania, ' ' ) +  
       ... +  
       isnull( s.Zambia, ' ' ) +  
       isnull( s.Zimbabwe, ' ' ) like t.key 
```

## 我的建议

就个人而言，我不会这样做。我会像你提到的那样做一个快速而肮脏的解决方案，除了我会对国家 ID 进行硬编码（因为你只会这样做一次，对吗？你可以在创建国家表，所以你知道所有的 ID 是什么）：

```
INSERT new_table SELECT Species.ID, 1 FROM Species WHERE Species.Afghanistan = 1 
INSERT new_table SELECT Species.ID, 2 FROM Species WHERE Species.Albania= 1 
...
INSERT new_table SELECT Species.ID, 999 FROM Species WHERE Species.Zambia= 1 
INSERT new_table SELECT Species.ID, 1000 FROM Species WHERE Species.Zimbabwe= 1 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-10-22T11:59:56.013

当我遇到类似的问题时，我发现生成一个生成 SQL 脚本的脚本很方便。这是您提供的示例，抽象为使用 %PAR1% 代替阿富汗。

```
SELECT Species.ID, Country.CountryID
FROM Country, Species
WHERE (((Species.%PAR1%)=1)) AND (((Country.Country)="%PAR1%"))
UNION 
```

此外，还添加了关键字 union 作为组合所有选择的一种方式。

接下来，您需要从现有数据生成的国家/地区列表：

阿富汗阿尔巴尼亚。, .

接下来，您需要一个可以遍历国家/地区列表的脚本，并且对于每次迭代，生成一个输出，在第一次迭代中将阿富汗替换为 %PAR1%，在第二次迭代中替换阿尔巴尼亚，依此类推。该算法就像文字处理器中的邮件合并。编写这个脚本需要一点工作。但是，一旦你拥有它，你就可以在几十个像这样的一次性项目中使用它。

Finally, you need to manually change the last "UNION" back to a semicolon.

If you can get Access to perform this giant union, you can get the data you want in the form you want, and insert it into your new table.

# javascript - 如何从 XMLHttpRequest 获取进度

> ID：76976
> 
> 赞同：137
> 
> 时间：2008-09-16T20:56:33.730
> 
> 标签：javascript, ajax, progress-bar

是否可以获得 XMLHttpRequest 的进度（上传的字节数，下载的字节数）？

这对于在用户上传大文件时显示进度条很有用。标准 API 似乎不支持它，但也许在任何浏览器中都有一些非标准扩展？毕竟，这似乎是一个非常明显的功能，因为客户端知道上传/下载了多少字节。

注意：我知道“轮询服务器以获取进度”替代方案（这就是我现在正在做的事情）。这样做的主要问题（除了复杂的服务器端代码）通常是，在上传大文件时，用户的连接完全中断，因为大多数 ISP 提供的上游服务很差。所以提出额外的请求并不像我希望的那样响应迅速。我希望有一种方法（可能是非标准的）来获取浏览器始终拥有的这些信息。

* * *

## 回答 #1

> 赞同：139
> 
> 时间：2010-09-12T10:03:26.047

对于上传的字节，这很容易。只是监视`xhr.upload.onprogress`事件。浏览器知道它必须上传的文件的大小和上传数据的大小，因此它可以提供进度信息。

对于下载的字节数（使用 获取信息时`xhr.responseText`），这有点困难，因为浏览器不知道服务器请求中将发送多少字节。在这种情况下，浏览器唯一知道的是它正在接收的字节大小。

有一个解决方案，`Content-Length`在服务器脚本上设置一个标题就足够了，以获得浏览器将接收的字节的总大小。

有关更多信息，请访问[https://developer.mozilla.org/en/Using_XMLHttpRequest](https://developer.mozilla.org/en/Using_XMLHttpRequest)。

示例：我的服务器脚本读取一个 zip 文件（需要 5 秒）：

```
$filesize=filesize('test.zip');

header("Content-Length: " . $filesize); // set header length
// if the headers is not set then the evt.loaded will be 0
readfile('test.zip');
exit 0; 
```

现在我可以监控服务器脚本的下载过程，因为我知道它的总长度：

```
function updateProgress(evt) 
{
   if (evt.lengthComputable) 
   {  // evt.loaded the bytes the browser received
      // evt.total the total bytes set by the header
      // jQuery UI progress bar to show the progress on screen
     var percentComplete = (evt.loaded / evt.total) * 100;  
     $('#progressbar').progressbar( "option", "value", percentComplete );
   } 
}   
function sendreq(evt) 
{  
    var req = new XMLHttpRequest(); 
    $('#progressbar').progressbar();    
    req.onprogress = updateProgress;
    req.open('GET', 'test.php', true);  
    req.onreadystatechange = function (aEvt) {  
        if (req.readyState == 4) 
        {  
             //run any callback here
        }  
    };  
    req.send(); 
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2010-07-29T08:18:12.600

Firefox 支持[XHR 下载进度事件](https://developer.mozilla.org/en/using_xmlhttprequest#Monitoring_progress)。

**编辑 2021-07-08 10:30 PDT**

上面的链接已经死了。在 Mozilla WebDev 网站上进行搜索发现了以下链接：

[https://developer.mozilla.org/en-US/docs/Web/API/ProgressEvent](https://developer.mozilla.org/en-US/docs/Web/API/ProgressEvent)

它描述了如何将进度事件与 XMLHttpRequest 一起使用，并提供了一个示例。我已经包括了下面的例子：

```
var progressBar = document.getElementById("p"),
    client = new XMLHttpRequest()
client.open("GET", "magical-unicorns")
client.onprogress = function(pe) {
  if(pe.lengthComputable) {
    progressBar.max = pe.total
    progressBar.value = pe.loaded
  }
}
client.onloadend = function(pe) {
  progressBar.value = pe.loaded
}
client.send() 
```

我也找到了这个链接，这就是我认为原始链接指向的内容。

[https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/progress_event](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/progress_event)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-16T21:04:06.877

最有希望的方法之一似乎是向服务器打开第二个通信通道，询问它已经完成了多少传输。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-16T21:11:37.657

对于上传的总数，似乎没有办法处理它，但有一些类似于你想要下载的东西。一旦 readyState 为 3，您可以定期查询 responseText 以获取下载的所有内容作为字符串（这在 IE 中不起作用），直到所有内容都可用，此时它将转换为 readyState 4。总数在任何给定时间下载的字节数将等于 responseText 中存储的字符串中的总字节数。

对于上传问题的全有或全无方法，因为您必须传递一个字符串进行上传（并且可以确定该字符串的总字节数），为 readyState 0 和 1 发送的总字节数将为 0，而为 readyState 发送的总字节数2 将是您传入的字符串中的总字节数。在 readyState 3 和 4 中发送和接收的总字节数将是原始字符串中的字节数加上 responseText 中的总字节数。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2016-01-29T09:21:55.090

```
<!DOCTYPE html>
<html>
<body>
<p id="demo">result</p>
<button type="button" onclick="get_post_ajax();">Change Content</button>
<script type="text/javascript">
	function update_progress(e)
	{
	  if (e.lengthComputable)
	  {
	    var percentage = Math.round((e.loaded/e.total)*100);
	    console.log("percent " + percentage + '%' );
	  }
	  else 
	  {
	  	console.log("Unable to compute progress information since the total size is unknown");
	  }
	}
	function transfer_complete(e){console.log("The transfer is complete.");}
	function transfer_failed(e){console.log("An error occurred while transferring the file.");}
	function transfer_canceled(e){console.log("The transfer has been canceled by the user.");}
	function get_post_ajax()
	{
	  	var xhttp;
	  	if (window.XMLHttpRequest){xhttp = new XMLHttpRequest();}//code for modern browsers} 
	 	else{xhttp = new ActiveXObject("Microsoft.XMLHTTP");}// code for IE6, IE5	  	
	  	xhttp.onprogress = update_progress;
		xhttp.addEventListener("load", transfer_complete, false);
		xhttp.addEventListener("error", transfer_failed, false);
		xhttp.addEventListener("abort", transfer_canceled, false);	  	
	  	xhttp.onreadystatechange = function()
	  	{
	    	if (xhttp.readyState == 4 && xhttp.status == 200)
	    	{
	      		document.getElementById("demo").innerHTML = xhttp.responseText;
	    	}
	  	};
	  xhttp.open("GET", "http://it-tu.com/ajax_test.php", true);
	  xhttp.send();
	}
</script>
</body>
</html>
```

[![结果](https://i.stack.imgur.com/K0f91.jpg)](https://i.stack.imgur.com/K0f91.jpg)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-16T21:06:53.580

如果您有权访问您的 apache 安装并信任第三方代码，则可以使用[apache 上传进度模块](http://drogomir.com/blog/2008/6/18/upload-progress-bar-with-mod_passenger-and-apache)（如果您使用 apache；还有一个[nginx 上传进度模块](http://wiki.codemongers.com/NginxHttpUploadProgressModule)）。

否则，您必须编写一个可以带外访问的脚本来请求文件的状态（例如检查 tmp 文件的文件大小）。

我相信在 Firefox 3 中正在进行一些工作以向浏览器添加上传进度支持，但这不会进入所有浏览器并在一段时间内被广泛采用（更遗憾的是）。

* * *

## 回答 #7

> 赞同：-7
> 
> 时间：2008-09-16T21:24:02.773

使用纯 javascript 做到这一点的唯一方法是实现某种轮询机制。您需要以固定的时间间隔（例如每 5 秒）发送 ajax 请求，以获取服务器接收到的字节数。

更有效的方法是使用闪存。flex 组件[FileReference](http://livedocs.adobe.com/flex/3/langref/flash/net/FileReference.html)定期调度一个 'progress' 事件，保存已上传的字节数。如果您需要坚持使用 javascript，可以使用 actionscript 和 javascript 之间的桥梁。好消息是这项工作已经为您完成了 :)

[**swf上传**](http://www.swfupload.org)

这个库允许在 flash 进度事件上注册一个 javascript 处理程序。

该解决方案具有不需要服务器端额外资源的巨大优势。

# cluster-computing - 如何设置低成本集群

> ID：76983
> 
> 赞同：7
> 
> 时间：2008-09-16T20:56:53.433
> 
> 标签：cluster-computing

在我的家里，我有大约 10 台计算机，所有不同的处理器和速度（所有 x86 兼容）。我想对这些进行聚类。我看过 openMosix，但由于他们停止了对它的开发，我决定不使用它。我更喜欢使用 Linux 主流发行版（Suse 11、Suse 10.3、Fedora 9 等）的最新或接近最新版本。

有谁知道任何好的网站（或书籍）可以解释如何使用大多数主流发行版上常见的免费开源应用程序来启动和运行集群？

我想要一个用于我将要编写的自定义软件的负载平衡集群。我不能使用像 Folding@home 这样的东西，因为我需要与应用程序的每个部分保持联系。例如，如果我正在运行一个模拟，而一台计算机正在控制下雨的位置，另一台控制我的食草动物在模拟中所做的事情。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-16T21:03:26.897

我最近使用 Ubuntu 建立了一个 OpenMPI 集群。一些现有的文章位于[https://wiki.ubuntu.com/MpichCluster](https://wiki.ubuntu.com/MpichCluster)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-16T21:08:33.543

你的问题太模糊了。您要使用什么集群应用程序？

到目前为止，设置“集群”的最简单方法是在您的每台机器上安装 Folding@Home。但我怀疑这真的是你所要求的。

我之前使用简单的 bash 脚本和 ssh 共享密钥为音乐/视频转码设置了集群。

我在工作中管理邮件服务器集群。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T21:07:11.613

如果您知道自己想要做什么，您只需要一个集群。带着实际需求回来，有人会提出解决方案。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-24T19:18:17.627

看看[岩石](http://www.rocksclusters.org)。它是基于 CentOS 5.1 的成熟集群“发行版”。它安装了运行集群所需的所有东西（库、应用程序和工具），而且安装和使用非常简单。您在主节点上进行所有调整和配置，它可以帮助您启动所有其他节点。我最近一直在用它安装一个 1200 多个节点（超过 10.000 个核心！）集群！并且会毫不犹豫地将其安装在 4 节点集群上，因为安装主节点的工作量为零！

您可以运行为集群库（如 MPI 或 PVM）编写的应用程序，也可以使用队列系统（Sun Grid Engine）来分发任何类型的作业。或者 distcc 在所有节点上编译选择的代码！

它是开源的、gpl 的、免费的，你喜欢的一切！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-16T22:16:46.000

我认为他正在寻找与 openMosix 类似的东西，某种通用集群，任何应用程序都可以在其之上分布在节点之间运行。AFAIK 没有类似的东西可用。基于 MPI 的集群是你能得到的最接近的东西，但我认为你只能在它们上运行 MPI 应用程序。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-22T11:21:49.083

Linux 虚拟服务器

[http://www.linuxvirtualserver.org/](http://www.linuxvirtualserver.org/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-24T19:26:57.937

我使用 pvm，它可以工作。但即使有一个很好的 ssh 设置，允许在不输入机器密码的情况下登录，您也可以轻松地在不同的计算节点上远程启动命令。

# sockets - 如何在不需要 root 权限的情况下运行类似 traceroute 的程序？

> ID：76988
> 
> 赞同：5
> 
> 时间：2008-09-16T20:57:21.230
> 
> 标签：sockets, traceroute

我已经看到另一个程序在其中提供了跟踪路由功能，但不需要 root（超级用户）权限？我一直认为原始套接字需要是 root，但是还有其他方法吗？（我认为有人提到了“supertrace”或“tracepath”？）谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-16T21:00:41.363

Ping 目标，逐渐增加 TTL 并观察“TTL 超出”响应的来源。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-16T21:02:29.753

一些应用程序不使用原始套接字，而是使用编号更高的 tcp 或 udp 端口​​。通过将该 tcp 端口指向已知 Web 服务器上的端口 80，您可以跟踪路由到该服务器。缺点是您需要知道目标设备上打开了哪些端口才能对其进行 tcpping。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-16T21:26:50.973

**ping**和**traceroute**使用 ICMP 协议。与 UDP 和 TCP 一样，这可以通过普通的套接字 API 访问。只有小于 1024 的 UDP 和 TCP 端口号受到保护，不能被 root 使用。ICMP 可供所有用户免费使用。

如果您真的想了解 ping 和 traceroute 是如何工作的，您可以从[CodeProject](http://www.codeproject.com/KB/IP/Ping_and_Traceroute.aspx)下载一个示例 C 代码实现。

简而言之，他们简单地打开一个 ICMP 套接字，然后 traceroute 使用 setsockopt 更改 TTL 的增量，直到达到目标。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-16T21:03:18.033

您不需要使用原始套接字来发送和接收 ICMP 数据包。至少在 Windows 上没有。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-09-16T21:15:19.253

如果你有一个现代 Linux 发行版，你可以查看 traceroute（或 tracepath，在 traceroute 没有 setuid 之前出现）和 tcptraceroute 的源代码。这些都不需要 RAW 套接字——在 Fedora 9 上检查过，它们不是 setuid 并且使用普通用户的默认选项。

使用 tcptraceroute 所做的代码可能是 esp。很有用，因为到一个地址的 ICMP 数据包不一定会在与到端口 80 的 TCP 连接相同的位置结束，例如。

执行 strace 的 traceroute（作为普通用户）显示它正在执行以下操作：

```
 int opt_on  = 1;
int opt_off = 0;

fd = socket(PF_INET, SOCK_DGRAM, IPPROTO_UDP)
setsockopt(fd, SOL_IP, IP_MTU_DISCOVER, &opt_off, sizeof int)
setsockopt(fd, SOL_SOCKET, SO_TIMESTAMP, &opt_on, sizeof int)
setsockopt(fd, SOL_IP, IP_RECVTTL, &opt_on, sizeof int) 
```

...然后从 CMSG 结果中读取数据。

# c# - 如何在表单上加倍缓冲 .NET 控件？

> ID：76993
> 
> 赞同：53
> 
> 时间：2008-09-16T20:57:43.353
> 
> 标签：c#, winforms, flicker, doublebuffered

如何`DoubleBuffered`在出现闪烁的表单上设置控件的受保护属性？

* * *

## 回答 #1

> 赞同：90
> 
> 时间：2008-09-16T21:17:28.110

[这是Dummy 解决方案](https://stackoverflow.com/questions/76993/how-to-double-buffer-net-controls-on-a-form#77041)的更通用版本。

我们可以使用反射来获取受保护的[DoubleBuffered](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.doublebuffered.aspx)属性，然后可以将其设置为**true**。

**注意**：如果用户在终端服务会话（例如远程桌面）中运行，您应该[支付开发人员税](https://devblogs.microsoft.com/oldnewthing/20050822-11/?p=34483)并且不要[使用双缓冲如果用户在](https://devblogs.microsoft.com/oldnewthing/20060103-12/?p=32793)远程桌面中运行，此帮助方法将不会打开双缓冲。

```
public static void SetDoubleBuffered(System.Windows.Forms.Control c)
{
   //Taxes: Remote Desktop Connection and painting
   //http://blogs.msdn.com/oldnewthing/archive/2006/01/03/508694.aspx
   if (System.Windows.Forms.SystemInformation.TerminalServerSession)
      return;

   System.Reflection.PropertyInfo aProp = 
         typeof(System.Windows.Forms.Control).GetProperty(
               "DoubleBuffered", 
               System.Reflection.BindingFlags.NonPublic | 
               System.Reflection.BindingFlags.Instance);

   aProp.SetValue(c, true, null); 
} 
```

* * *

## 回答 #2

> 赞同：69
> 
> 时间：2008-09-18T01:13:37.427

检查[这个线程](http://social.msdn.microsoft.com/Forums/en-US/winforms/thread/aaed00ce-4bc9-424e-8c05-c30213171c2c)

重复该答案的核心，您可以打开窗口上的 WS_EX_COMPOSITED 样式标志，以使表单及其所有控件都双缓冲。样式标志从 XP 开始可用。它不会使绘画速度更快，但整个窗口都被绘制在屏幕外缓冲区中，并一次将其传送到屏幕上。使其在用户眼中看起来是即时的，没有可见的绘画伪影。它并非完全没有问题，一些视觉样式渲染器可能会出现故障，尤其是 TabControl 选项卡太多时。YMMV。

将此代码粘贴到您的表单类中：

```
protected override CreateParams CreateParams {
    get {
        var cp = base.CreateParams;
        cp.ExStyle |= 0x02000000;    // Turn on WS_EX_COMPOSITED
        return cp;
    } 
} 
```

这种技术与 Winform 的双缓冲支持之间的最大区别在于 Winform 的版本一次只能在一个控件上工作。您仍然会看到每个单独的控件绘制本身。这也可能看起来像闪烁效果，特别是如果未绘制的控制矩形与窗口的背景形成鲜明对比。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-09-16T21:02:02.373

```
System.Reflection.PropertyInfo aProp = typeof(System.Windows.Forms.Control)
    .GetProperty("DoubleBuffered", System.Reflection.BindingFlags.NonPublic |
    System.Reflection.BindingFlags.Instance);
aProp.SetValue(ListView1, true, null); 
```

[Ian](https://stackoverflow.com/questions/76993/how-to-double-buffer-net-controls-on-a-form#77233)有更多关于在终端服务器上使用它的信息。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2008-09-16T21:00:19.197

```
public void EnableDoubleBuffering()
{
   this.SetStyle(ControlStyles.DoubleBuffer | 
      ControlStyles.UserPaint | 
      ControlStyles.AllPaintingInWmPaint,
      true);
   this.UpdateStyles();
} 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-09-16T21:03:48.377

一种方法是扩展您想要双缓冲的特定控件并在控件的 ctor 内设置 DoubleBuffered 属性。

例如：

```
class Foo : Panel
{
    public Foo() { DoubleBuffered = true; }
} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-10-29T11:25:12.470

[nobugz](https://stackoverflow.com/questions/76993/how-to-double-buffer-net-controls-on-a-form/89125#89125)在他的链接中获得了该方法的功劳，我只是重新发布。将此覆盖添加到表单：

```
protected override CreateParams CreateParams
{
    get
    {
        CreateParams cp = base.CreateParams;
        cp.ExStyle |= 0x02000000;
        return cp;
    }
} 
```

这对我来说效果最好，在 Windows 7 上，当我调整重控件的大小时，我会出现大的黑块。控件现在弹跳了！但它更好。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2013-01-11T16:20:17.233

**为控件打开或关闭双缓冲的**扩展方法****

 **```
public static class ControlExtentions
{
    /// <summary>
    /// Turn on or off control double buffering (Dirty hack!)
    /// </summary>
    /// <param name="control">Control to operate</param>
    /// <param name="setting">true to turn on double buffering</param>
    public static void MakeDoubleBuffered(this Control control, bool setting)
    {
        Type controlType = control.GetType();
        PropertyInfo pi = controlType.GetProperty("DoubleBuffered", BindingFlags.Instance | BindingFlags.NonPublic);
        pi.SetValue(control, setting, null);
    }
} 
```

用法（例如如何使 DataGridView DoubleBuffered）：

```
DataGridView _grid = new DataGridView();
//  ...
_grid.MakeDoubleBuffered(true); 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-16T21:05:18.997

在尝试双缓冲之前，请查看 SuspendLayout()/ResumeLayout() 是否能解决您的问题。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2013-06-24T16:03:07.863

在我追查到它之前，这让我在第三方控制的情况下痛苦了两天**。**

```
protected override CreateParams CreateParams
{
    get
    {
        CreateParams cp = base.CreateParams;
        cp.ExStyle |= 0x02000000;
        return cp;
    }
} 
```

我最近在重新调整大小/重绘包含其他几个控件的控件时遇到了很多漏洞（粪便）。

我尝试了 WS_EX_COMPOSITED 和 WM_SETREDRAW 但在我使用它之前没有任何效果：

```
private void myPanel_SizeChanged(object sender, EventArgs e)
{
     Application.DoEvents();
} 
```

只是想传下去。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2016-09-06T07:34:40.760

这个很好的解决方案的vb.net版本......：

```
Protected Overrides ReadOnly Property CreateParams() As CreateParams
    Get
        Dim cp As CreateParams = MyBase.CreateParams
        cp.ExStyle = cp.ExStyle Or &H2000000
        Return cp
    End Get
End Property 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-16T21:03:04.930

您还可以将控件继承到您自己的类中，并在其中设置属性。如果您倾向于在所有控件上进行大量相同的设置，则此方法也很好。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-16T21:29:55.943

我发现只需在表单上设置 DoubleBuffered 设置就会自动设置此处列出的所有属性。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2021-04-26T20:11:23.273

## FWIW

以我之前的人的工作为基础：
[Dummy 的解决方案](https://stackoverflow.com/a/77041/4496560)，[Ian Boyd 的解决方案](https://stackoverflow.com/a/77233/4496560)，[Amo 的解决方案](https://stackoverflow.com/a/77023/4496560)

`SetStyle`这是一个在 PowerShell 中使用反射设置双缓冲的版本

```
function Set-DoubleBuffered{
<#
.SYNOPSIS
Turns on double buffering for a [System.Windows.Forms.Control] object
.DESCRIPTION
Uses the Non-Public method 'SetStyle' on the control to set the three
style flags recomend for double buffering: 
   UserPaint
   AllPaintingInWmPaint
   DoubleBuffer
.INPUTS
[System.Windows.Forms.Control]
.OUTPUTS
None
.COMPONENT  
System.Windows.Forms.Control
.FUNCTIONALITY
Set Flag, DoubleBuffering, Graphics
.ROLE
WinForms Developer
.NOTES
Throws an exception when trying to double buffer a control on a terminal 
server session becuase doing so will cause lots of data to be sent across 
the line
.EXAMPLE
#A simple WinForm that uses double buffering to reduce flicker
Add-Type -AssemblyName System.Windows.Forms
[System.Windows.Forms.Application]::EnableVisualStyles()

$Pen = [System.Drawing.Pen]::new([System.Drawing.Color]::FromArgb(0xff000000),3)

$Form = New-Object System.Windows.Forms.Form
Set-DoubleBuffered $Form
$Form.Add_Paint({
   param(
      [object]$sender,
      [System.Windows.Forms.PaintEventArgs]$e
   )
   [System.Windows.Forms.Form]$f = $sender
   $g = $e.Graphics
   $g.SmoothingMode = 'AntiAlias'
   $g.DrawLine($Pen,0,0,$f.Width/2,$f.Height/2)
})
$Form.ShowDialog()

.LINK
https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.control.setstyle?view=net-5.0
.LINK
https://docs.microsoft.com/en-us/dotnet/api/system.windows.forms.controlstyles?view=net-5.0
#>
   param(
      [parameter(mandatory=$true,ValueFromPipeline=$true)]
      [ValidateScript({$_ -is [System.Windows.Forms.Control]})]
      #The WinForms control to set to double buffered
      $Control,

      [switch]
      #Override double buffering on a terminal server session(not recomended)
      $Force
   )
   begin{try{
      if([System.Windows.Forms.SystemInformation]::TerminalServerSession -and !$Force){
         throw 'Double buffering not set on terminal server session.'
      }

      $SetStyle = ([System.Windows.Forms.Control]).GetMethod('SetStyle',
         [System.Reflection.BindingFlags]::NonPublic -bor [System.Reflection.BindingFlags]::Instance
      )
      $UpdateStyles = ([System.Windows.Forms.Control]).GetMethod('UpdateStyles',
         [System.Reflection.BindingFlags]::NonPublic -bor [System.Reflection.BindingFlags]::Instance
      )
   }catch {$PSCmdlet.ThrowTerminatingError($PSItem)}
   }process{try{
      $SetStyle.Invoke($Control,@(
         ([System.Windows.Forms.ControlStyles]::UserPaint -bor
           [System.Windows.Forms.ControlStyles]::AllPaintingInWmPaint -bor
           [System.Windows.Forms.ControlStyles]::DoubleBuffer
         ),
         $true
      ))
      $UpdateStyles.Invoke($Control,@())
   }catch {$PSCmdlet.ThrowTerminatingError($PSItem)}}
} 
```********