# StackOverflow 问答 000171000-000171999

# asp.net - 如何使用带有 asp.net 的 jQuery 进行 onclientclick 回发

> ID：171000
> 
> 赞同：12
> 
> 时间：2008-10-04T21:06:25.090
> 
> 标签：asp.net, javascript, jquery, postback

我想在不使用更新面板进行回发的情况下重新创建更新面板回发。这样做的通用方法是什么？

例如，在 Stackoverflow 上，当您对某个问题投赞成票或反对票时，它会回发以更新数据库，我敢打赌他们没有使用更新面板。

我有什么？

我有一张带有表格数据的表格。当我单击`td`整个列的项目时，我想更新数据库并更新页面本身的网格视图。网格视图显示了表中所有当前单击的项目，因为它是通过“我们的方法”更新的。

寻找一种好的通用方法，我可以在没有更新面板的情况下用于许多异步回发。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-10-05T03:13:37.717

Stack Overflow 的工作方式与那篇 CodeProject 文章在两个重要方面不同。

*   Stack Overflow 正在针对 ASP.NET MVC 控制器操作而不是独立的 ASPX 页面发出 AJAX 请求。您可能会将其视为 ASP.NET AJAX 页面方法的 MVC 类似物。在这两种情况下，ASPX 方法在性能方面都会落后。

*   Stack Overflow 的 AJAX 请求返回 JSON 序列化结果，而不是任意纯文本或 HTML。这使得在客户端处理它更加标准化并且通常更清洁。

例如：当我投票赞成这个问题时，向 /questions/171000/vote 发出了一个 XmlHttpRequest 请求，POST 数据中的“voteTypeId”为 2。

处理请求的控制器将我的投票添加到某处的表中，然后用这个 JSON 响应：

```
{"Success":true,"NewScore":1,"Message":"","LastVoteTypeId":2} 
```

使用该信息，此 JavaScript 负责更新客户端显示：

```
var voteResult = function(jClicked, postId, data) {
  if (data.Success) {
    jClicked.parent().find("span.vote-count-post").text(data.NewScore);
    if (data.Message)
      showFadingNotification(jClicked, data.Message);
  }
  else {
    showNotification(jClicked, data.Message);
    reset(jClicked, jClicked);

    if (data.LastVoteTypeId) {
      selectPreviousVote(jClicked, data.LastVoteTypeId);
    }
  }
}; 
```

如果您使用的是 WebForms，那么您在我的博客上找到的调用页面方法的示例绝对是正确的。

但是，我建议您考虑任何集中式功能的 Web 服务（例如这个投票示例），而不是页面方法。页面方法似乎更容易编写，但它们也有一些重用的缺点，并且往往会提供一种实际上并不存在的附加安全性的错觉。

这是一个执行与您发现的相同的事情的示例，但使用 Web 服务（此帖子的评论实际上导致了您找到的帖子）：

[http://encosia.com/2008/03/27/using-jquery-to-consume-aspnet-json-web-services/](http://encosia.com/2008/03/27/using-jquery-to-consume-aspnet-json-web-services/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-04T21:18:33.160

您可以使用标准的 AJAX 调用来完成此操作。创建一个 .aspx 页面，该页面在其 Page_Load 方法中更新数据库，并将任何所需信息（如更新后的当前 DB 值）显示为 XML。然后使用 jQuery 对该页面进行 AJAX 调用。

您还可以返回一个 HTML 片段（即更新的 GridView），并使用 jQuery 将更新的 HTML 插入当前页面。

编辑：此页面上的示例 2 应该非常接近您想要的：http:
[//www.codeproject.com/KB/ajax/AjaxJQuerySample.aspx](http://www.codeproject.com/KB/ajax/AjaxJQuerySample.aspx)

# iphone - iphone <-> 现实世界的连接

> ID：171003
> 
> 赞同：4
> 
> 时间：2008-10-04T21:09:43.037
> 
> 标签：iphone, serial-communication

有关如何启动与 iphone 的串行通信的任何指示？或者任何其他与外部硬件交互的想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-05T00:12:25.773

将外部硬件连接到 iPhone 的唯一受支持方式是通过 iPod 附件协议，通过 30 针连接器。有关该程序的详细信息，请访问[http://developer.apple.com/ipod/accessories.html](http://developer.apple.com/ipod/accessories.html)。它不是免费程序，30 针连接器仅支持某些功能，但它是当今唯一可用的选项。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-05T00:17:47.900

使用非官方工具包编译的应用程序（并在越狱的 iPhone 上运行）据说可以访问坞站连接器中的串行端口。

参见： [http ://devdot.wikispaces.com/Iphone+Serial+Port+Tutorial](http://devdot.wikispaces.com/Iphone+Serial+Port+Tutorial)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-04T22:01:11.890

这取决于你想做什么。对于 SSH 终端连接，我推荐 TouchTerm（搜索应用商店）。

我没有电气连接经验，但您可以在此处找到 iPod/iPhone 连接器的引脚排列：http: [//pinouts.ru/PortableDevices/ipod_pinout.shtml](http://pinouts.ru/PortableDevices/ipod_pinout.shtml)

然后，您可以在此处下载 iPhone 开发人员工具包：http: [//developer.apple.com/iphone/](http://developer.apple.com/iphone/)

# iis - 接受来自任何 CA 的客户端证书

> ID：171020
> 
> 赞同：4
> 
> 时间：2008-10-04T21:23:39.140
> 
> 标签：iis, ssl, iis-6

我正在为用户设置使用客户端证书登录的支持。不幸的是，IIS 拒绝承认任何未链接到已安装 CA 的证书（[请参阅本文](http://support.microsoft.com/kb/257587 "SSL握手过程中服务器认证过程说明")）。

由于该功能仅为用户的方便而实施，因此允许任何客户端证书会很棒。有没有办法做到这一点？

我的服务器正在运行 Windows Server 2003 和 IIS 6，但在本地运行的 IIS 7 上的行为没有什么不同。如果可以自定义 IIS 7 以支持任何客户端证书，我将能够进行更改（鉴于没有可用的 IIS 6 解决方案）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-04T21:35:35.733

我认为正常的方法是让您向他们颁发证书，然后让您设置 IIS 以接受您的证书作为根。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-29T19:57:22.637

实现这个类：

```
 public class TrustAllCertificatePolicy : System.Net.ICertificatePolicy
    {
        public TrustAllCertificatePolicy() {}

        public bool CheckValidationResult(ServicePoint sp, X509Certificate cert,WebRequest req, int problem)
        {
            return true;
        }
    } 
```

使用以下代码行设置它。之后任何证书，无论是否过期、名称不匹配等都将被接受。

```
 System.Net.ServicePointManager.CertificatePolicy = new TrustAllCertificatePolicy(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-04T21:43:43.437

我认为您可以通过命令添加新的*根*CA 证书`certmgr`

```
certmgr --add -c -m Trust <CA_cert_DER_fmt> 
```

*注意：与 UNIX 不同，Windows同时*管理所有应用程序的证书，这可能会产生安全隐患，因此请注意

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-04T21:50:07.480

WCF 允许您编写[自定义 X.509 证书处理程序](http://msdn.microsoft.com/en-us/library/aa354512.aspx)。在代码中，您可以进行一些检查，例如将指纹与数据库中的已知值进行比较。

# algorithm - 接近检测点

> ID：171022
> 
> 赞同：1
> 
> 时间：2008-10-04T21:28:47.273
> 
> 标签：algorithm, language-agnostic, optimization, geometry, spatial

我有一大组 3D 的三阶多项式。

矩阵形式

> Pn = [1,t,t ² ,t ⁴ ]*[An]
> 
> `[Pn]`分别`[An]`是`1xN`和`4xN`矩阵

每个函数都有一个权重 Wn。`n, m, T`对于某些人，我想`t0`找到第一个这样的`t`地方`t>t0`

> (Wn*Wm) * |Pn-Pm| ^(-2) > T

除了 O(n ² ) “尝试一切”方法之外，我什至不确定从哪里开始，就此而言，即使对于已知的 n 和 m，我也不知道如何回答这个问题。

有任何想法吗

编辑：

*   设置大小约为 10-1000
*   权重是分布的〜对数（很少大，很多小）
*   这个测试将在一个多体模拟器的内部循环中，所以它会运行很多
*   在改变一条路径后，在找到新答案方面表现良好（摊销）的版本是一件好事。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-04T22:03:52.990

不知道这是否可以通过分析方法解决，有很多方法可以搜索空间并尝试找到任何符合该标准的 t。

遗传算法、模拟退火和其他优化算法浮现在脑海中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-04T22:16:00.050

确定播种锅：

*   使用某种形式的“close pair finder”算法在 t0 和其他时间用这些对在堆中播种。
*   拉出找到的最近的一对
*   如果足够接近并且比目前最好的更快，保持
*   找出它们是否更近或更远
*   将当前对和下一个对之间的差异拆分到“更近”的一侧，然后添加堆。

想法？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-04T22:35:42.443

N有多大？是否有可能进行详尽的搜索？

[我会在numpy](http://groups.google.com/group/Numpy-discussion)或[scipy](http://groups.google.com/group/scipy-user)讨论板上提问，并复习你的 Python 技能。我敢打赌，您可能会将其变成一个最小化问题，并使用 fmin 或[BFGS](http://en.wikipedia.org/wiki/BFGS)或其他一些有界准牛顿算法来找到一个合理的最小值。也许最小化 t 和 T 之间的差异。除非你的矩阵中有什么奇怪的东西，否则你的搜索空间看起来至少是连续的。

由于您在标题中提到了最接近的方法，请在 numpy 板上[查看此帖子。](http://groups.google.com/group/Numpy-discussion/browse_thread/thread/0d4f89f885f7b83b#)

# javascript - 在jQuery中添加表格行

> ID：171027
> 
> 赞同：2578
> 
> 时间：2008-10-04T21:33:10.247
> 
> 标签：javascript, jquery, html-table

在 jQuery 中将附加行作为最后一行添加到表中的最佳方法是什么？

这可以接受吗？

```
$('#myTable').append('<tr><td>my data</td><td>more data</td></tr>'); 
```

您可以添加到这样的表中的内容是否有限制（例如输入、选择、行数）？

* * *

## 回答 #1

> 赞同：2261
> 
> 时间：2008-10-04T21:49:32.520

您建议的方法不能保证给您提供您正在寻找的结果 - 如果您有一个`tbody`例如：

```
<table id="myTable">
  <tbody>
    <tr>...</tr>
    <tr>...</tr>
  </tbody>
</table> 
```

你最终会得到以下结果：

```
<table id="myTable">
  <tbody>
    <tr>...</tr>
    <tr>...</tr>
  </tbody>
  <tr>...</tr>
</table> 
```

因此，我会推荐这种方法：

```
$('#myTable tr:last').after('<tr>...</tr><tr>...</tr>'); 
```

您可以在`after()`方法中包含任何内容，只要它是有效的 HTML，包括上面示例中的多行。

**更新：**在最近有这个问题的活动之后重新访问这个答案。eyelidlessness 很好地说明了 DOM 中总会有 a `tbody`；这是真的，但前提是至少有一行。如果您没有行，`tbody`除非您自己指定行，否则将没有行。

DaRKoN_[建议](https://stackoverflow.com/questions/171027/jquery-add-table-row/468240#468240)附加到`tbody`而不是在最后一个之后添加内容`tr`。这解决了没有行的问题，但仍然不是防弹的，因为理论上你可以有多个`tbody`元素并且行会被添加到每个元素中。

权衡一切，我不确定是否有一个单一的解决方案可以解决所有可能的情况。您需要确保 jQuery 代码与您的标记相符。

我认为最安全的解决方案可能是确保您`table`始终在标记中包含至少一个`tbody`，即使它没有行。在此基础上，您可以使用以下内容，无论您拥有多少行（并且还考虑多个`tbody`元素）：

```
$('#myTable > tbody:last-child').append('<tr>...</tr><tr>...</tr>'); 
```

* * *

## 回答 #2

> 赞同：810
> 
> 时间：2009-08-14T15:30:37.330

jQuery 有一个内置的工具来动态操作 DOM 元素。

**您可以像这样向表中添加任何内容：**

```
$("#tableID").find('tbody')
    .append($('<tr>')
        .append($('<td>')
            .append($('<img>')
                .attr('src', 'img.png')
                .text('Image cell')
            )
        )
    ); 
```

jQuery中的`$('<some-tag>')`东西是一个标签对象，可以有几个`attr`可以设置和获取的属性，还有`text`，这里代表标签之间的文本：`<tag>text</tag>`.

*这是一些非常奇怪的缩进，但你更容易看到这个例子中发生了什么。*

* * *

## 回答 #3

> 赞同：327
> 
> 时间：2012-06-05T20:12:48.013

因此，自从[@Luke Bennett](https://stackoverflow.com/a/171049/362006)回答了这个问题后，事情就发生了变化。这是一个更新。

jQuery 从 1.4(?) 版本开始自动检测您尝试插入的元素（使用任何[`append()`](http://api.jquery.com/append/)、[`prepend()`](http://api.jquery.com/prepend/)、[`before()`](http://api.jquery.com/before/)或[`after()`](http://api.jquery.com/after/)方法）是否为 a`<tr>`并将其插入到表中的第一个元素中，如果不是则将`<tbody>`其包装成新元素`<tbody>`存在。

所以是的，您的示例代码是可以接受的，并且可以在 jQuery 1.4+ 上正常工作。;)

```
$('#myTable').append('<tr><td>my data</td><td>more data</td></tr>'); 
```

* * *

## 回答 #4

> 赞同：178
> 
> 时间：2009-01-22T06:47:03.307

如果你有 a`<tbody>`和 a`<tfoot>`怎么办？

如：

```
<table>
    <tbody>
        <tr><td>Foo</td></tr>
    </tbody>
    <tfoot>
        <tr><td>footer information</td></tr>
    </tfoot>
</table> 
```

然后它会在页脚中插入新行 - 而不是在正文中。

因此，最好的解决方案是包含一个`<tbody>`标签并使用`.append`，而不是`.after`.

```
$("#myTable > tbody").append("<tr><td>row content</td></tr>"); 
```

* * *

## 回答 #5

> 赞同：79
> 
> 时间：2012-04-20T17:38:43.803

我知道您要求使用 jQuery 方法。我看了很多，发现我们可以通过以下函数以比直接使用 JavaScript 更好的方式做到这一点。

```
tableObject.insertRow(index) 
```

`index`是一个整数，它指定要插入的行的位置（从 0 开始）。也可以使用-1的值；这导致新行将插入到最后一个位置。

此参数在 Firefox 和[Opera](http://en.wikipedia.org/wiki/Opera_%28web_browser%29)中是必需的，但在 Internet Explorer、[Chrome](http://en.wikipedia.org/wiki/Google_Chrome)和[Safari](http://en.wikipedia.org/wiki/Safari_%28web_browser%29)中是可选的。

如果省略此参数，则[`insertRow()`](https://developer.mozilla.org/en-US/docs/Web/API/HTMLTableElement/insertRow)在 Internet Explorer 的最后一个位置以及 Chrome 和 Safari 的第一个位置插入一个新行。

**它适用于所有可接受的 HTML 表格结构。**

以下示例将在最后插入一行（-1 用作索引）：

```
<html>
    <head>
        <script type="text/javascript">
        function displayResult()
        {
            document.getElementById("myTable").insertRow(-1).innerHTML = '<td>1</td><td>2</td>';
        }
        </script>
    </head>

    <body>       
        <table id="myTable" border="1">
            <tr>
                <td>cell 1</td>
                <td>cell 2</td>
            </tr>
            <tr>
                <td>cell 3</td>
                <td>cell 4</td>
            </tr>
        </table>
        <br />
        <button type="button" onclick="displayResult()">Insert new row</button>            
    </body>
</html> 
```

我希望它有所帮助。

* * *

## 回答 #6

> 赞同：38
> 
> 时间：2010-10-22T21:34:25.710

我建议

```
$('#myTable > tbody:first').append('<tr>...</tr><tr>...</tr>'); 
```

与

```
$('#myTable > tbody:last').append('<tr>...</tr><tr>...</tr>'); 
```

`first`and`last`关键字作用于要开始的第一个或最后一个标签，而不是关闭。因此，如果您不希望更改嵌套表，而是添加到整个表中，这与嵌套表配合得更好。至少，这是我发现的。

```
<table id=myTable>
  <tbody id=first>
    <tr><td>
      <table id=myNestedTable>
        <tbody id=last>
        </tbody>
      </table>
    </td></tr>
  </tbody>
</table> 
```

* * *

## 回答 #7

> 赞同：36
> 
> 时间：2014-06-30T12:40:29.930

在我看来，最快和最清晰的方法是

```
//Try to get tbody first with jquery children. works faster!
var tbody = $('#myTable').children('tbody');

//Then if no tbody just select your table 
var table = tbody.length ? tbody : $('#myTable');

//Add row
table.append('<tr><td>hello></td></tr>'); 
```

这是演示 **[小提琴](http://jsfiddle.net/zwmpN/)**

我也可以推荐一个小功能来进行更多的 html 更改

```
//Compose template string
String.prototype.compose = (function (){
var re = /\{{(.+?)\}}/g;
return function (o){
        return this.replace(re, function (_, k){
            return typeof o[k] != 'undefined' ? o[k] : '';
        });
    }
}()); 
```

如果你使用我的弦乐作曲家，你可以这样做

```
var tbody = $('#myTable').children('tbody');
var table = tbody.length ? tbody : $('#myTable');
var row = '<tr>'+
    '<td>{{id}}</td>'+
    '<td>{{name}}</td>'+
    '<td>{{phone}}</td>'+
'</tr>';

//Add row
table.append(row.compose({
    'id': 3,
    'name': 'Lee',
    'phone': '123 456 789'
})); 
```

这是演示 **[小提琴](http://jsfiddle.net/w2YmD/)**

* * *

## 回答 #8

> 赞同：27
> 
> 时间：2010-01-26T13:34:15.150

这可以使用 jQuery 的“last()”函数轻松完成。

```
$("#tableId").last().append("<tr><td>New row</td></tr>"); 
```

* * *

## 回答 #9

> 赞同：20
> 
> 时间：2017-10-12T17:54:33.917

我是这样解决的。

使用 jQuery

```
$('#tab').append($('<tr>')
    .append($('<td>').append("text1"))
    .append($('<td>').append("text2"))
    .append($('<td>').append("text3"))
    .append($('<td>').append("text4"))
  ) 
```

* * *

## 片段

```
$('#tab').append($('<tr>')
  .append($('<td>').append("text1"))
  .append($('<td>').append("text2"))
  .append($('<td>').append("text3"))
  .append($('<td>').append("text4"))
)
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<table id="tab">
  <tr>
    <th>Firstname</th>
    <th>Lastname</th> 
    <th>Age</th>
    <th>City</th>
  </tr>
  <tr>
    <td>Jill</td>
    <td>Smith</td> 
    <td>50</td>
    <td>New York</td>
  </tr>
</table>
```

* * *

## 回答 #10

> 赞同：18
> 
> 时间：2010-12-16T05:30:14.513

当表格中没有任何行时，我正在使用这种方式，并且每一行都非常复杂。

样式.css：

```
...
#templateRow {
  display:none;
}
... 
```

xxx.html

```
...
<tr id="templateRow"> ... </tr>
...

$("#templateRow").clone().removeAttr("id").appendTo( $("#templateRow").parent() );

... 
```

* * *

## 回答 #11

> 赞同：14
> 
> 时间：2011-01-21T22:21:43.990

对于此处发布的最佳解决方案，如果最后一行有嵌套表，则新行将添加到嵌套表而不是主表中。一个快速的解决方案（考虑有/没有 tbody 的表格和带有嵌套表格的表格）：

```
function add_new_row(table, rowcontent) {
    if ($(table).length > 0) {
        if ($(table + ' > tbody').length == 0) $(table).append('<tbody />');
        ($(table + ' > tr').length > 0) ? $(table).children('tbody:last').children('tr:last').append(rowcontent): $(table).children('tbody:last').append(rowcontent);
    }
} 
```

使用示例：

```
add_new_row('#myTable','<tr><td>my new row</td></tr>'); 
```

* * *

## 回答 #12

> 赞同：12
> 
> 时间：2009-10-05T19:17:01.137

我遇到了一些相关问题，试图在单击的行之后插入一个表格行。一切都很好，除了 .after() 调用不适用于最后一行。

```
$('#traffic tbody').find('tr.trafficBody).filter(':nth-child(' + (column + 1) + ')').after(insertedhtml); 
```

我找到了一个非常不整洁的解决方案：

如下创建表（每行的 id）：

```
<tr id="row1"> ... </tr>
<tr id="row2"> ... </tr>
<tr id="row3"> ... </tr> 
```

ETC ...

进而 ：

```
$('#traffic tbody').find('tr.trafficBody' + idx).after(html); 
```

* * *

## 回答 #13

> 赞同：11
> 
> 时间：2009-03-02T13:21:48.080

您可以使用这个很棒的[jQuery 添加表格行](http://jquery-howto.blogspot.com/2009/02/add-table-row-using-jquery-and.html)功能。它适用于有`<tbody>`和没有的表。它还考虑了最后一个表格行的 colspan。

这是一个示例用法：

```
// One table
addTableRow($('#myTable'));
// add table row to number of tables
addTableRow($('.myTables')); 
```

* * *

## 回答 #14

> 赞同：11
> 
> 时间：2015-12-06T04:13:14.757

```
 // Create a row and append to table
    var row = $('<tr />', {})
        .appendTo("#table_id");

    // Add columns to the row. <td> properties can be given in the JSON
    $('<td />', {
        'text': 'column1'
    }).appendTo(row);

    $('<td />', {
        'text': 'column2',
        'style': 'min-width:100px;'
    }).appendTo(row); 
```

* * *

## 回答 #15

> 赞同：10
> 
> 时间：2012-03-09T00:48:03.793

我的解决方案：

```
//Adds a new table row
$.fn.addNewRow = function (rowId) {
    $(this).find('tbody').append('<tr id="' + rowId + '"> </tr>');
}; 
```

**用法：**

```
$('#Table').addNewRow(id1); 
```

* * *

## 回答 #16

> 赞同：9
> 
> 时间：2011-12-05T01:09:57.217

我发现这个[AddRow 插件](http://www.examplet.org/jquery/table.addrow.php)对于管理表行非常有用。不过，如果您只需要添加新行，卢克的[解决方案将是最合适的。](https://stackoverflow.com/a/171049/288671)

* * *

## 回答 #17

> 赞同：9
> 
> 时间：2014-05-11T12:04:23.787

[尼尔的答案](https://stackoverflow.com/a/1278557/604004)是迄今为止最好的答案。然而事情变得非常快。我的建议是使用变量来存储元素并将它们附加到 DOM 层次结构中。

**HTML**

```
<table id="tableID">
    <tbody>
    </tbody>
</table> 
```

**JAVASCRIPT**

```
// Reference to the table body
var body = $("#tableID").find('tbody');

// Create a new row element
var row = $('<tr>');

// Create a new column element
var column = $('<td>');

// Create a new image element
var image = $('<img>');
image.attr('src', 'img.png');
image.text('Image cell');

// Append the image to the column element
column.append(image);
// Append the column to the row element
row.append(column);
// Append the row to the table body
body.append(row); 
```

* * *

## 回答 #18

> 赞同：9
> 
> 时间：2016-01-19T20:09:33.783

```
<table id="myTable">
  <tbody>
    <tr>...</tr>
    <tr>...</tr>
  </tbody>
  <tr>...</tr>
</table> 
```

用 javascript 函数编写

```
document.getElementById("myTable").insertRow(-1).innerHTML = '<tr>...</tr><tr>...</tr>'; 
```

* * *

## 回答 #19

> 赞同：8
> 
> 时间：2017-07-20T02:34:42.373

这是我的解决方案

```
$('#myTable').append('<tr><td>'+data+'</td><td>'+other data+'</td>...</tr>'); 
```

* * *

## 回答 #20

> 赞同：7
> 
> 时间：2013-03-28T21:51:47.210

这是一些hackti hack代码。我想在[HTML](http://en.wikipedia.org/wiki/HTML)页面中维护一个行模板。表行 0...n 在请求时呈现，此示例有一个硬编码行和一个简化的模板行。模板表是隐藏的，并且行标签必须在有效的表中，否则浏览器可能会将其从[DOM](http://en.wikipedia.org/wiki/Document_Object_Model)树中删除。添加一行使用 counter+1 标识符，当前值保存在 data 属性中。它保证每一行都有唯一的[URL](http://en.wikipedia.org/wiki/Uniform_Resource_Locator)参数。

我已经在 Internet Explorer 8、Internet Explorer 9、Firefox、Chrome、Opera、[Nokia Lumia 800](http://en.wikipedia.org/wiki/Nokia_Lumia_800)、[Nokia C7](http://en.wikipedia.org/wiki/Nokia_C7-00)（带有[Symbian](http://en.wikipedia.org/wiki/Symbian) 3）、Android stock 和 Firefox beta 浏览器上运行测试。

```
<table id="properties">
<tbody>
  <tr>
    <th>Name</th>
    <th>Value</th>
    <th>&nbsp;</th>
  </tr>
  <tr>
    <td nowrap>key1</td>
    <td><input type="text" name="property_key1" value="value1" size="70"/></td>
    <td class="data_item_options">
       <a class="buttonicon" href="javascript:deleteRow()" title="Delete row" onClick="deleteRow(this); return false;"></a>
    </td>
  </tr>
</tbody>
</table>

<table id="properties_rowtemplate" style="display:none" data-counter="0">
<tr>
 <td><input type="text" name="newproperty_name_\${counter}" value="" size="35"/></td>
 <td><input type="text" name="newproperty_value_\${counter}" value="" size="70"/></td>
 <td><a class="buttonicon" href="javascript:deleteRow()" title="Delete row" onClick="deleteRow(this); return false;"></a></td>
</tr>
</table>
<a class="action" href="javascript:addRow()" onclick="addRow('properties'); return false" title="Add new row">Add row</a><br/>
<br/>

- - - - 
// add row to html table, read html from row template
function addRow(sTableId) {
    // find destination and template tables, find first <tr>
    // in template. Wrap inner html around <tr> tags.
    // Keep track of counter to give unique field names.
    var table  = $("#"+sTableId);
    var template = $("#"+sTableId+"_rowtemplate");
    var htmlCode = "<tr>"+template.find("tr:first").html()+"</tr>";
    var id = parseInt(template.data("counter"),10)+1;
    template.data("counter", id);
    htmlCode = htmlCode.replace(/\${counter}/g, id);
    table.find("tbody:last").append(htmlCode);
}

// delete <TR> row, childElem is any element inside row
function deleteRow(childElem) {
    var row = $(childElem).closest("tr"); // find <tr> parent
    row.remove();
} 
```

PS：我把所有的功劳都归功于 jQuery 团队；他们应得的一切。没有 jQuery 的 JavaScript 编程——我什至不想去想那个噩梦。

* * *

## 回答 #21

> 赞同：7
> 
> 时间：2013-12-21T11:54:45.717

```
<tr id="tablerow"></tr>

$('#tablerow').append('<tr>...</tr><tr>...</tr>'); 
```

* * *

## 回答 #22

> 赞同：7
> 
> 时间：2014-01-31T06:13:58.103

我想我已经在我的项目中完成了，这里是：

**html**

```
<div class="container">
    <div class = "row">
    <div class = "span9">
        <div class = "well">
          <%= form_for (@replication) do |f| %>
    <table>
    <tr>
      <td>
          <%= f.label :SR_NO %>
      </td>
      <td>
          <%= f.text_field :sr_no , :id => "txt_RegionName" %>
      </td>
    </tr>
    <tr>
      <td>
        <%= f.label :Particular %>
      </td>
      <td>
        <%= f.text_area :particular , :id => "txt_Region" %>
      </td>
    </tr>
    <tr>
      <td>
        <%= f.label :Unit %>
      </td>
      <td>
        <%= f.text_field :unit ,:id => "txt_Regio" %>
      </td>
      </tr>
      <tr>

      <td> 
        <%= f.label :Required_Quantity %>
      </td>
      <td>
        <%= f.text_field :quantity ,:id => "txt_Regi" %>
      </td>
    </tr>
    <tr>
    <td></td>
    <td>
    <table>
    <tr><td>
    <input type="button"  name="add" id="btn_AddToList" value="add" class="btn btn-primary" />
    </td><td><input type="button"  name="Done" id="btn_AddToList1" value="Done" class="btn btn-success" />
    </td></tr>
    </table>
    </td>
    </tr>
    </table>
    <% end %>
    <table id="lst_Regions" style="width: 500px;" border= "2" class="table table-striped table-bordered table-condensed">
    <tr>
    <td>SR_NO</td>
    <td>Item Name</td>
    <td>Particular</td>
    <td>Cost</td>
    </tr>
    </table>
    <input type="button" id= "submit" value="Submit Repication"  class="btn btn-success" />
    </div>
    </div>
    </div>
</div> 
```

**js**

```
$(document).ready(function() {     
    $('#submit').prop('disabled', true);
    $('#btn_AddToList').click(function () {
     $('#submit').prop('disabled', true);
    var val = $('#txt_RegionName').val();
    var val2 = $('#txt_Region').val();
    var val3 = $('#txt_Regio').val();
    var val4 = $('#txt_Regi').val();
    $('#lst_Regions').append('<tr><td>' + val + '</td>' + '<td>' + val2 + '</td>' + '<td>' + val3 + '</td>' + '<td>' + val4 + '</td></tr>');
    $('#txt_RegionName').val('').focus();
    $('#txt_Region').val('');
        $('#txt_Regio').val('');
        $('#txt_Regi').val('');
    $('#btn_AddToList1').click(function () {
         $('#submit').prop('disabled', false).addclass('btn btn-warning');
    });
      });
}); 
```

* * *

## 回答 #23

> 赞同：7
> 
> 时间：2016-10-14T05:18:02.890

如果你有另一个变量，你可以`<td>`像这样尝试在标签中访问。

这样我希望它会有所帮助

```
var table = $('#yourTableId');
var text  = 'My Data in td';
var image = 'your/image.jpg'; 
var tr = (
  '<tr>' +
    '<td>'+ text +'</td>'+
    '<td>'+ text +'</td>'+
    '<td>'+
      '<img src="' + image + '" alt="yourImage">'+
    '</td>'+
  '</tr>'
);

$('#yourTableId').append(tr); 
```

* * *

## 回答 #24

> 赞同：6
> 
> 时间：2012-04-13T10:47:12.497

```
<table id=myTable>
    <tr><td></td></tr>
    <style="height=0px;" tfoot></tfoot>
</table> 
```

您可以缓存页脚变量并减少对 DOM 的访问（注意：使用假行而不是页脚可能会更好）。

```
var footer = $("#mytable tfoot")
footer.before("<tr><td></td></tr>") 
```

* * *

## 回答 #25

> 赞同：6
> 
> 时间：2013-05-20T09:14:50.013

因为我也有办法在最后或任何特定的地方添加行，所以我想我也应该分享这个：

首先找出长度或行：

```
var r=$("#content_table").length; 
```

然后使用下面的代码添加您的行：

```
$("#table_id").eq(r-1).after(row_html); 
```

* * *

## 回答 #26

> 赞同：6
> 
> 时间：2013-08-29T11:35:58.503

要在该主题上添加一个很好的示例，如果您需要在特定位置添加一行，这里是有效的解决方案。

额外的行添加在第 5 行之后，或者如果少于 5 行，则添加到表的末尾。

```
var ninja_row = $('#banner_holder').find('tr');

if( $('#my_table tbody tr').length > 5){
    $('#my_table tbody tr').filter(':nth-child(5)').after(ninja_row);
}else{
    $('#my_table tr:last').after(ninja_row);
} 
```

我将内容放在表格下方的现成（隐藏）容器中..因此，如果您（或设计师）必须更改它，则不需要编辑 JS。

```
<table id="banner_holder" style="display:none;"> 
    <tr>
        <td colspan="3">
            <div class="wide-banner"></div>
        </td>   
    </tr> 
</table> 
```

* * *

## 回答 #27

> 赞同：5
> 
> 时间：2012-04-19T10:53:35.660

```
$('#myTable').append('<tr><td>my data</td><td>more data</td></tr>'); 
```

**将在表的第一** 行添加一个新行`TBODY`，而不依赖于任何`THEAD`或`TFOOT`存在。（我没有从哪个版本的 jQuery 中找到`.append()`这种行为存在的信息。）

您可以在以下示例中尝试：

```
<table class="t"> <!-- table with THEAD, TBODY and TFOOT -->
<thead>
  <tr><th>h1</th><th>h2</th></tr>
</thead>
<tbody>
  <tr><td>1</td><td>2</td></tr>
</tbody>
<tfoot>
  <tr><th>f1</th><th>f2</th></tr>
</tfoot>
</table><br>

<table class="t"> <!-- table with two TBODYs -->
<thead>
  <tr><th>h1</th><th>h2</th></tr>
</thead>
<tbody>
  <tr><td>1</td><td>2</td></tr>
</tbody>
<tbody>
  <tr><td>3</td><td>4</td></tr>
</tbody>
<tfoot>
  <tr><th>f1</th><th>f2</th></tr>
</tfoot>
</table><br>

<table class="t">  <!-- table without TBODY -->
<thead>
  <tr><th>h1</th><th>h2</th></tr>
</thead>
</table><br>

<table class="t">  <!-- table with TR not in TBODY  -->
  <tr><td>1</td><td>2</td></tr>
</table>
<br>
<table class="t">
</table>

<script>
$('.t').append('<tr><td>a</td><td>a</td></tr>');
</script> 
```

在哪个示例`a b`行插入之后`1 2`，而不是`3 4`在第二个示例之后。如果表是空的，jQuery 会创建`TBODY`一个新行。

* * *

## 回答 #28

> 赞同：5
> 
> 时间：2013-10-02T05:06:13.180

如果您使用的是 Datatable JQuery 插件，您可以尝试。

```
oTable = $('#tblStateFeesSetup').dataTable({
            "bScrollCollapse": true,
            "bJQueryUI": true,
            ...
            ...
            //Custom Initializations.
            });

//Data Row Template of the table.
var dataRowTemplate = {};
dataRowTemplate.InvoiceID = '';
dataRowTemplate.InvoiceDate = '';
dataRowTemplate.IsOverRide = false;
dataRowTemplate.AmountOfInvoice = '';
dataRowTemplate.DateReceived = '';
dataRowTemplate.AmountReceived = '';
dataRowTemplate.CheckNumber = '';

//Add dataRow to the table.
oTable.fnAddData(dataRowTemplate); 
```

请参阅数据表 fnAddData[数据表 API](http://datatables.net/api)

* * *

## 回答 #29

> 赞同：5
> 
> 时间：2015-06-16T12:11:44.080

以一种简单的方式：

```
$('#yourTableId').append('<tr><td>your data1</td><td>your data2</td><td>your data3</td></tr>'); 
```

* * *

## 回答 #30

> 赞同：5
> 
> 时间：2019-03-26T11:47:51.083

**试试这个：非常简单的方法**

```
$('<tr><td>3</td></tr><tr><td>4</td></tr>').appendTo("#myTable tbody");
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
<table id="myTable">
  <tbody>
    <tr><td>1</td></tr>
    <tr><td>2</td></tr>
  </tbody>
</table>
```

* * *

## 回答 #31

> 赞同：5
> 
> 时间：2019-05-12T05:39:38.253

上面的答案非常有帮助，但是当学生参考此链接从表单中添加数据时，他们通常需要一个样本。

我想贡献一个示例 get input from from 并使用`.after()`string 将 tr 插入 table `interpolation`。

```
function add(){
  let studentname = $("input[name='studentname']").val();
  let studentmark = $("input[name='studentmark']").val();

  $('#student tr:last').after(`<tr><td>${studentname}</td><td>${studentmark}</td></tr>`);
} 
```

```
function add(){
let studentname = $("input[name='studentname']").val();
let studentmark = $("input[name='studentmark']").val();

$('#student tr:last').after(`<tr><td>${studentname}</td><td>${studentmark}</td></tr>`);
}
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<!DOCTYPE html>
<html>
<head>
<style>
table {
  font-family: arial, sans-serif;
  border-collapse: collapse;
  width: 100%;
}

td, th {
  border: 1px solid #dddddd;
  text-align: left;
  padding: 8px;
}

tr:nth-child(even) {
  background-color: #dddddd;
}
</style>
</head>
<body>
<form>
<input type='text' name='studentname' />
<input type='text' name='studentmark' />
<input type='button' onclick="add()" value="Add new" />
</form>
<table id='student'>
  <thead>
    <th>Name</th>
    <th>Mark</th>
  </thead>
</table>
</body>
</html>
```

* * *

## 回答 #32

> 赞同：3
> 
> 时间：2017-03-16T09:07:45.600

**如果要在第一个孩子`row`之前添加。`<tr>`**

```
$("#myTable > tbody").prepend("<tr><td>my data</td><td>more data</td></tr>"); 
```

**如果要在最后一个孩子`row`之后添加。`<tr>`**

```
$("#myTable > tbody").append("<tr><td>my data</td><td>more data</td></tr>"); 
```

* * *

## 回答 #33

> 赞同：2
> 
> 时间：2019-02-05T19:27:39.100

**使用 JQuery 添加表行：**

如果你想**在表的最后一行子之后**添加行，你可以试试这个

```
$('#myTable tr:last').after('<tr>...</tr><tr>...</tr>'); 
```

如果你想添加**表的行子的第一行**，你可以试试这个

```
$('#myTable tr').after('<tr>...</tr><tr>...</tr>'); 
```

* * *

## 回答 #34

> 赞同：2
> 
> 时间：2020-05-13T19:50:29.933

在您的情况下，纯 JS 很短

```
myTable.firstChild.innerHTML += '<tr><td>my data</td><td>more data</td></tr>' 
```

```
function add() {
  myTable.firstChild.innerHTML+=`<tr><td>date</td><td>${+new Date}</td></tr>`
}
```

```
td {border: 1px solid black;}
```

```
<button onclick="add()">Add</button><br>
<table id="myTable"><tbody></tbody> </table>
```

（如果我们删除它`<tbody>`也`firstChild`可以工作，但用 包裹每一行`<tbody>`）

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2020-09-06T12:39:44.763

我尝试了最受好评的一个，但它对我不起作用，但下面的效果很好。

```
$('#mytable tr').last().after('<tr><td></td></tr>'); 
```

即使那里有一个托比，这也能奏效。

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2017-03-30T07:24:13.197

这也可以这样做：

```
$("#myTable > tbody").html($("#myTable > tbody").html()+"<tr><td>my data</td><td>more data</td></tr>") 
```

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2020-01-24T16:54:01.173

要在当前行的最后一行添加新行，您可以像这样使用

```
$('#yourtableid tr:last').after('<tr>...</tr><tr>...</tr>'); 
```

您可以如上所述附加多行。您也可以像这样添加内部数据

```
$('#yourtableid tr:last').after('<tr><td>your data</td></tr>'); 
```

以另一种方式，您可以这样做

```
let table = document.getElementById("tableId");

let row = table.insertRow(1); // pass position where you want to add a new row

//then add cells as you want with index
let cell0 = row.insertCell(0);
let cell1 = row.insertCell(1);
let cell2 = row.insertCell(2);
let cell3 = row.insertCell(3);

//add value to added td cell
 cell0.innerHTML = "your td content here";
 cell1.innerHTML = "your td content here";
 cell2.innerHTML = "your td content here";
 cell3.innerHTML = "your td content here"; 
```

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2020-01-29T11:04:32.087

在这里，您只需单击按钮即可获得输出。当您单击**添加行**按钮时，又添加了一行。

我希望它很有帮助。

```
<html> 

<head> 
    <script src= 
            "https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"> 
    </script> 

    <style> 
        table { 
            margin: 25px 0; 
            width: 200px; 
        } 

        table th, table td { 
            padding: 10px; 
            text-align: center; 
        } 

        table, th, td { 
            border: 1px solid; 
        } 
    </style> 
</head> 

<body> 

    <b>Add table row in jQuery</b> 

    <p> 
        Click on the button below to 
        add a row to the table 
    </p> 

    <button class="add-row"> 
        Add row 
    </button> 

    <table> 
        <thead> 
            <tr> 
                <th>Rows</th> 
            </tr> 
        </thead> 
        <tbody> 
            <tr> 
                <td>This is row 0</td> 
            </tr> 
        </tbody> 
    </table> 

    <!-- Script to add table row -->
    <script> 
        let rowno = 1; 
        $(document).ready(function () { 
            $(".add-row").click(function () { 
                rows = "<tr><td>This is row " 
                    + rowno + "</td></tr>"; 
                tableBody = $("table tbody"); 
                tableBody.append(rows); 
                rowno++; 
            }); 
        }); 
    </script> 
</body> 
</html> 
```

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2021-01-31T02:20:51.647

)达里尔：

您可以使用 appendTo 方法将其附加到 tbody，如下所示：

```
$(() => {
   $("<tr><td>my data</td><td>more data</td></tr>").appendTo("tbody");
}); 
```

您可能想要使用最新的 JQuery 和 ECMAScript。然后，您可以使用后端语言将数据添加到表中。您也可以将其包装在一个变量中，如下所示：

```
$(() => {
  var t_data = $('<tr><td>my data</td><td>more data</td></tr>');
  t_data.appendTo('tbody');
}); 
```

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2022-01-25T14:02:02.463

```
var html = $('#myTableBody').html();
html += '<tr><td>my data</td><td>more data</td></tr>';
$('#myTableBody').html(html); 
```

或者

```
$('#myTableBody').html($('#myTableBody').html() + '<tr><td>my data</td><td>more data</td></tr>'); 
```

* * *

## 回答 #41

> 赞同：-1
> 
> 时间：2018-08-18T07:58:21.763

**提示：**在某些浏览器（类似）中，在`html table`via中插入行`innerHTML or .html()`无效，并且在任何浏览器中使用都不是好的建议。**最好**和**最快**的方法是使用代码。`IE9``.append("<tr></tr>")`****`pure javascript`****

 ****要以这种方式与 结合`jQuery`，只需添加类似于以下的新插件`jQuery`：

```
$.fn.addRow=function(index/*-1: add to end  or  any desired index*/, cellsCount/*optional*/){
    if(this[0].tagName.toLowerCase()!="table") return null;
    var i=0, c, r = this[0].insertRow((index<0||index>this[0].rows.length)?this[0].rows.length:index);
    for(;i<cellsCount||0;i++) c = r.insertCell(); //you can use c for set its content or etc
    return $(r);
}; 
```

现在在整个项目中使用它，类似于：

```
var addedRow = $("#myTable").addRow(-1/*add to end*/, 2); 
```

# user-interface - Win32API 的任何替代 API？

> ID：171030
> 
> 赞同：6
> 
> 时间：2008-10-04T21:34:55.577
> 
> 标签：user-interface, winapi, api, replace

我需要一个 API 可以制作像 Win32API 这样的菜单，
但比 WinAPI 更简单更好。
这可以使带有文本区域、按钮等的 GUI 像普通的 Windows 程序一样。（Windows GUI 风格）
任何人都可以推荐一个喜欢它的人吗？谢谢。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-04T21:37:28.490

[wxWidgets](http://www.wxwidgets.org/)：

> wxWidgets 允许开发人员使用一个代码库为 Win32、Mac OS X、GTK+、X11、Motif、WinCE 等创建应用程序。它可以用于 C++、Python、Perl 和 C#/.NET 等语言。与其他跨平台工具包不同，wxWidgets 应用程序的外观和感觉都是原生的。这是因为 wxWidgets 使用平台自己的原生控件而不是模拟它们。它也是广泛的、免费的、开源的和成熟的。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-04T21:42:18.400

虽然我从未使用过它，但 QT 似乎是一个相当不错的框架，而且也是开源的，多平台的，也有移动 api，可以用 Java 或 C++ 编码。

[http://trolltech.com/downloads](http://trolltech.com/downloads)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-04T21:38:11.607

看看[http://www.wxwidgets.org/](http://www.wxwidgets.org/) - 看看他们的一些[教程](http://www.wxwidgets.org/docs/tutorials.htm)来感受一下。

也可以看看

*   [GUI 编程 API](https://stackoverflow.com/questions/610/gui-programming-apis#658)
*   [什么是适用于 Windows 的良好 GUI / Widget 工具包？](https://stackoverflow.com/questions/84057/what-is-a-good-gui-widget-toolkit-for-windows#84805)

（**编辑**：我在 2008 年 10 月写了这个答案，从那以后我变成了[Qt](http://www.qtsoftware.com/products/)的转换者——它使高质量的跨平台开发变得*轻而易举*！）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-04T21:45:58.550

[！](http://www.gtk.org/) _

尽管它需要 Windows 用户安装 GTK 库包才能使用您的程序（对此表示反对），但它有一个漂亮的代码结构，尤其是与[Python](http://www.pygtk.org/)配对时。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-04T22:11:39.823

1.  [SmartWin](http://smartwin.sourceforge.net/) - 仅限 Win32
2.  [Ultimate++](http://www.ultimatepp.org/) - 跨平台
3.  [FLTK](http://www.fltk.org/) - 跨平台

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-04T21:40:09.420

如果你真的是直接使用 Win32，你可以试试 MFC。

或者如果你想要更现代的东西，WTL

[http://wtl.sourceforge.net/](http://wtl.sourceforge.net/)

> Windows 模板库 (WTL) 是用于开发 Windows 应用程序和 UI 组件的 C++ 库。它扩展了 ATL（活动模板库）并为控件、对话框、框架窗口、GDI 对象等提供了一组类。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-04T22:02:55.553

WinForms 和 WPF 是 .NET 编程的替代方案。您将无法在 Win32 API 中做所有事情，但有一个相当大的子集。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-04T22:03:53.210

Delphi 的 VCL 如果你的目标是 win32 平台。

# language-agnostic - 在 80 端口阻塞的网络上创建舞台环境

> ID：171044
> 
> 赞同：1
> 
> 时间：2008-10-04T21:46:27.893
> 
> 标签：language-agnostic, mod-rewrite, hosting, infrastructure

我目前使用我的本地 Web 服务器来允许客户预览一些应用程序，并允许下载我的开源库的“夜间构建”。

问题是我更改了我的 ISP，现在我的端口 80 被阻止了。

虽然我知道我可以轻松更改 Apache 服务器上的端口，但我想避免这种情况，除非没有其他选择。

您是否知道任何第三方服务（免费或付费）可以将端口转发到我的网站，使其对访问它的人透明？

我听说的另一个想法是使用我当前的虚拟主机中的 mod rewrite 来重写我的域，但我也不想走这条路。除此之外，您知道任何实际有效的 .htaccess 示例吗？我试过这个：

```
RewriteEngine on
RewriteRule ^/(.*) http://www.example.com:8080/$1 
```

但这似乎不起作用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-04T22:26:57.110

“并以透明的方式再次返回给客户”....将由 NAT 处理，因此这应该不是问题。

要处理从一个字符串到另一个字符串的请求转换，这是一个问题，因为您需要在请求到达服务器之前对其进行转换。研究某种 URL 转发服务

[http://www.dnsexit.com/Direct.sv?cmd=webforward](http://www.dnsexit.com/Direct.sv?cmd=webforward)

您还可以在提供商服务器上设置一个单独的站点，并将请求转发到您服务器上的特定地址/链接。

希望这可以帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-04T22:03:46.750

由于端口 80 被阻塞，通过动态服务路由将无济于事，除非客户端在域中指定新端口。

让您的本地路由器“端口转发”流量从新端口（例如 8080）到端口 80。让所有内容保持不变。

在 DynDNS.org 创建一个帐户并设置您的动态服务。然后让你的客户做[http://mydomain.com:8080](http://mydomain.com:8080)

这应该够了吧

仍然考虑 Rolf 的建议，因为它们不是真正的 ISP，.... 说真的。

谢谢

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-04T22:06:38.103

如果您无法让您的 ISP 为您打开端口 80，并且您无法切换 ISP，请使用 htacccess 重定向指令：

重定向 301 / [http://yourserver.com:8000/](http://yourserver.com:8000/)

用户可能会注意到重定向，但他们可能不会在意。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-04T23:29:49.497

> 我想让客户输入 [http://myaddress.com/hello/there?a=1&b=2](http://myaddress.com/hello/there?a=1&b=2) 并将其翻译为 [http://mylocalserver.com:8080/hello/there?a=1&b =2](http://mylocalserver.com:8080/hello/there?a=1&b=2) 并以透明的方式再次返回给客户。

我相信这是您正在寻找重定向任何 URL 的 Apache RewriteRule：

```
RewriteRule ^(.*)$ http://mylocalserver.com:8080$1 [R] 
```

从那时起，客户将浏览`mylocalserver.com:8080`，这就是他们将在地址栏中看到的内容。如果您所说的“再回来”是他们仍然认为他们正在浏览`myaddress.com`，那么您所说的是重写代理服务器。

我的意思是，您不仅要重写 HTTP 标头中的所有 URL，还要重写 HTML 内容中的所有 URL（即在 HTML 上进行正则表达式搜索/替换），并解码、重写和重新发送所有 GET、POST、PUT 数据， 也。我曾经写过这样一个代理，让我告诉你这不是一个简单的练习，虽然原理看起来很简单。

我想说，如果您可以让重定向工作并让他们从那时`mylocalserver.com:8080`起浏览，那就太高兴了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-06T01:22:21.467

好吧，尽管我很欣赏这些答案，但我对最终结果并不十分满意。我希望我的 ISP 更改对我的客户来说是透明的，我想我设法让它发挥作用。

这是我所做的：

我租了一个便宜的 VPS 服务器 - [VPSLink](http://vpslink.com/) - 并选择了它最便宜的计划：64Mb RAM、2Gb HD 和 1Gb 每月流量。在终身 10% 的折扣之后，每月只需 7.16 美元，对于这项工作来说相当实惠，并且您可以获得沙盒 VPS 服务器作为奖励。到目前为止，托管似乎很好 - 没有问题。如果您想试一试，您可以从其网站（如上所示）或通过推荐代码注册。网上有很多，你只需要搜索一下。此外，如果您愿意，我可以轻松地为您创建一个，只需在此答案上发表评论：您将获得 10% 的折扣，我可以免费使用一个月。我不会直接在这里发布，因为这似乎是这篇文章背后的意图——但事实并非如此。

此帐户不受管理，但它提供 root 访问权限。然后我将 apache 配置为我的 80 端口请求的代理，透明地将它们转发到我在 8081 端口上的本地网站。

下面是我的 Apache 的 httpd.conf 配置文件的一些片段。

**VPS服务器配置：**

```
<VirtualHost *:80>
    ServerName mydomain.com
    ServerAlias www.mydomain.com *.mydomain.com
    RewriteEngine On
    RewriteCond %{HTTP_HOST} (.*)\.mydomain\.com [NC]
    RewriteRule (.*) http://mylocalserverdns.mydomain.com:8081/%1$1 [P]
</VirtualHost> 
```

这使得像[http://subdomain1.mydomain.com/script?a=b](http://subdomain1.mydomain.com/script?a=b)这样的请求在服务器端被透明地转发到[http://mylocalserverdns.mydomain.com:8081/subdomain1/script?a=b](http://mylocalserverdns.mydomain.com:8081/subdomain1/script?a=b)，所以我可以从那里做任何我想做的事。

在我的本地服务器上，我做了同样的事情来分发我的子域处理程序。例如，我有两个在本地端口 8088 和 8089 上运行的 Java 服务器应用程序。我所要做的就是另一个代理转发，现在在内部

**本地服务器配置：**

```
<VirtualHost *:8081>
    ServerName mylocalserverdns.mydomain.com

    ProxyPass /app1 http://127.0.0.1:8088
    ProxyPassReverse /app1 http://127.0.0.1:8088
    ProxyPassReverse /app1 http://mylocalserverdns.mydomain.com:8088/app1

    ProxyPass /app2 http://127.0.0.1:8089
    ProxyPassReverse /app2 http://127.0.0.1:8089
    ProxyPassReverse /app2 http://mylocalserverdns.mydomain.com:8089/app2
</VirtualHost> 
```

如果其他人正在寻找相同的选择，希望这是值得的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-04T21:56:24.520

我认为大多数 DynamicDNS 服务都允许端口转发。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-04T21:56:58.247

询问您的 ISP 为什么会这样，如果您没有得到答案，请再次切换 ISP。

# .net - Adobe Air 和 .NET

> ID：171054
> 
> 赞同：5
> 
> 时间：2008-10-04T21:50:36.810
> 
> 标签：.net, air, adobe

我的 Adob​​e Air 完全是 JavaScript？我不能使用像 VB.NET 或 C#.NET 这样的 .NET 语言吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-04T22:01:52.713

正如官方回答所说，Adobe Air 不支持 .Net 语言。如果您正在为支持 .Net 的 Windows 桌面编程寻找类似的东西，我建议您使用[WPF](http://en.wikipedia.org/wiki/Windows_Presentation_Foundation)。如果您想快速上手，WPF Unleashed 这本书非常 好[。](https://rads.stackoverflow.com/amzn/click/com/0672328917)

WPF 内置于 .Net 3.0 和 3.5 中，可在 WinXP SP2、Vista、Win2k3 和 Win2k8 服务器上运行。

**注意**：这是在另一个答案被标记为接受的“官方”答案时编写的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-07T05:38:24.743

您不能直接在 Adob​​e AIR 应用程序中使用 .net 语言（至少现在还不能）。最好的解决方案是代理 AIR 应用程序和 .net 代码之间的调用：

[http://www.mikechambers.com/blog/2008/01/17/commandproxy-net-air-integration-proof-of-concept/](http://www.mikechambers.com/blog/2008/01/17/commandproxy-net-air-integration-proof-of-concept/)

迈克室

网格@adobe.com

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-04T21:53:12.233

不可以，您不能为 Adob​​e Air 使用 .NET 语言。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-09T10:42:25.600

是的，您可以将 .NET 与 Adob​​e AIR 一起使用，

访问：[教程](http://www.adobe.com/devnet/flashmediaserver/articles/first_im_app.html)

还请继续关注 Adob​​e 的网站，因为他们可以随时宣布 Visual Studio 2008 的插件（支持 Flex）

同时您可以使用[另一个受支持的插件](http://blog.flashgen.com/2008/12/02/sapphiresteel-produce-visual-studio-flex-plugin/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-11-19T11:41:12.387

不，您不能使用 .Net 直接编写 Adob​​e AIR 应用程序，您只能使用（向 AIR 应用程序提供数据）任何使用 .NET、PHP、Java 或 Coldfusion 的后端服务。您只能使用 Flex、Flash/Flex Builder 中的 Actionscript 或 Flash Pro 中的 Javascript/HTML/CSS(Ajax) 创建 adobe Adob​​e AIR 应用程序。

# javascript - AJAX 和相对路径范围

> ID：171074
> 
> 赞同：0
> 
> 时间：2008-10-04T22:00:03.857
> 
> 标签：javascript, jquery, ajax, relative-path, facebox

我正在尝试通过 Facebox 中漂亮的 AJAX 功能（用于 jQuery）对包含 SWF 的页面进行灯箱化。问题是路径现在相对于主索引页面起作用，而不是包含闪存页面的目录。这是目录细分：

./
  - index.html (加载项目/projectName/index.html)
  + js/
      + jquery/
          - facebox.js
          - jquery.js
      + swfobject/
          - swfobject.js
  + projects
      + projectName
          - index.html本身带有到 JS 的相对路径）
      + swf/

谁能告诉我是否有某种方法可以通过 jQuery（或任何 Javascript）保留相对路径的范围？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-11T19:20:55.830

您不想像现在这样使用相对路径，这些路径以备份文件夹树的方式工作。尝试使用从 Web 根目录开始的路径，而不是沿着文件夹树向下移动。所以代替这个：

**../../images/image.gif**

或这个：

**./images/image.gif**

你应该试试这个：

**/images/image.gif**

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-05T02:07:02.813

更多信息可能会有所帮助。主要是`index.html`重定向到下面的那个`projectName`，还是在 FRAME/IFRAME 中打开它？哪一个有`.facebox()`电话？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-05T04:31:06.190

抱歉没有上传！不得不清除一些还不能展示的项目。

[http://www.kevinsweeneydesign.com/help/](http://www.kevinsweeneydesign.com/help/)

你可以在这里看到，当我自己查看文件时，路径都是正确的（当我尝试对内容进行面部处理时，它会变得很糟糕）：

[http://www.kevinsweeneydesign.com/help/projects/propod/](http://www.kevinsweeneydesign.com/help/projects/propod/)

facebox 调用来自 ./help/index.html 文件。它尝试在 facebox 调用中加载 ./help/projects/propod/index.html。但是，./help/projects/propod/index.html 文件使用位于 ./help/js/swfobject/ 中的 JS

更新：我尝试设置基本标签（将其设置为 ./projects/propod）...有效，但仅适用于图像。我仍在修改“base”参数以提供 SWF，但无济于事......当我查看 Firebug 中的对象标记时，我没有看到任何附加的“_base_href”，就像我在链接到图片=/

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-05T01:49:31.913

我不确定我是否完全理解了这个问题（你有源代码/网址示例）。

[Base HREF](http://www.w3schools.com/TAGS/tag_base.asp)标签可以让您在iFrame 中设置相对路径开始，并且您应该能够从那里使用相对路径。

# javascript - 火狐中的鼠标移动

> ID：171089
> 
> 赞同：0
> 
> 时间：2008-10-04T22:07:19.567
> 
> 标签：javascript, firefox, events, esri

你如何在 Firefox 中实现 onmousemove？我让它在 IE7 中工作，但`alert`在 Firefox 中没有弹出。是不支持还是做的不同？

```
<esri:Map ID="Map1" runat="server" MapResourceManager="MapResourceManager1" 
    Height="100%" Width="100%" VirtualDirectory="" 
    PrimaryMapResource="ESRI_Imagery_World_2D" Extent="-130,37,-117,46" 
    onmousemove="alert()" >
</esri:Map> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-04T22:13:50.757

我认为问题在于您需要在 alert() 中放入一些内容，例如：

```
<esri:Map ID="Map1" runat="server" MapResourceManager="MapResourceManager1" 
                    Height="100%" Width="100%" VirtualDirectory="" 
                    PrimaryMapResource="ESRI_Imagery_World_2D" Extent="-130,37,-117,46" 
                    onmousemove="alert('test');" >
                </esri:Map> 
```

我刚试过这个，它在FF中工作：

```
<div onmousemove="alert('test');" style="height:100px; width:300px; background-color:#f00;"></div> 
```

# active-directory - 如何将 Microsoft ADAM 配置为类似于 Active Directory？

> ID：171092
> 
> 赞同：6
> 
> 时间：2008-10-04T22:08:17.070
> 
> 标签：active-directory, ldap, adam

我想将用户放入 ADAM 的实例中，以便 ADAM 看起来类似于典型的、真实的 Active Directory 服务器。

我正在开发一个与 LDAP 集成的应用程序。我已经使用 OpenLDAP 及其 core.schema 进行了测试。现在我想使用 Active Directory 进行测试，但使用我的设备最接近的方法是使用 Microsoft ADAM 进行测试。

我不知道如何从 ADAM 开始。它和 Active Directory 的零经验。我猜我需要导入 MS-AdamSchemaW2K3.LDF 因为我在那里看到“sAMAccountName”，我想我希望它像 Active Directory？

* * *

在阅读了几个答案后添加...

到目前为止，答案对于我正在寻找的内容还不够具体。我确实让 ADAM 工作并且我的应用程序可以与之对话，但我想做的是让 ADAM 以典型（如果有的话）Active Directory 安装的方式工作，相同的架构，身份验证，即使我只是在 Windows XP 上的工作组网络中使用 ADAM。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-04T23:02:28.633

ADAM 并不是 Active Directory 的完全替代品。例如，ADAM 不了解不同的组类型，并且默认情况下不包含 RootDSE。您可以针对 ADAM 进行测试，但您的查询结构可能会略有不同。

如果您正在开发依赖于 Active Directory 的应用程序，那么您确实应该针对 Active Directory 构建应用程序。我已经能够让几个域控制器在[Virtual PC](http://www.microsoft.com/downloads/details.aspx?familyid=04D26402-3199-48A3-AFA2-2DC0B40A73B6&displaylang=en)（免费）中运行良好，仅使用 300mb 内存和[Windows Server 的免费评估版](http://www.microsoft.com/windowsserver2008/en/us/try-it.aspx)。

但是，如果您正在构建的应用程序只需要一个 LDAP 目录并且不打算使用 Active Directory，那么 ADAM 可能会正常工作。您提到的架构扩展文件 (MS-AdamSchemaW2K3.LDF) 可以正常工作，但您需要设置 RootDSE 以便于绑定。

最后，Microsoft AD/AM 对管理员并不友好，尤其是在故障排除方面。 [我最终编写了一个应用程序](http://www.dscoduc.com/post/2008/01/ADAM-Services-Debug.aspx)来帮助解决您可能会发现有用的 AD/AM 问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-05T02:21:03.550

我不确定您所说的不能使用您的设备来运行 Active Directory 实例而不是使用 ADAM 是什么意思。我已经在只有 256 MB RAM 的虚拟机中运行测试 AD 服务器。在我看来，ADAM 永远不会成为一个充分的测试，这取决于你在做什么。

我会花时间尝试启动并运行适当的 AD。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-04T22:35:23.410

我只知道导入 MS-Users 文件。我看到有一个分步指南

[http://www.microsoft.com/downloads/details.aspx?FamilyID=5163b97a-7df3-4b41-954e-0f7c04893e83&DisplayLang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=5163b97a-7df3-4b41-954e-0f7c04893e83&DisplayLang=en)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T10:21:11.457

最好的方法是安装 Windows 2003 服务器，并将 Active Directory 作为域控制器加载。仅使用 ADAM 无法 100% 复制 AD 特征。

# java - 如何更改 Ant 的 XMLValidate 任务提供的验证“级别”？

> ID：171097
> 
> 赞同：0
> 
> 时间：2008-10-04T22:11:35.130
> 
> 标签：java, xml, ant, dtd

我正在尝试使用 Ant 的 XMLValidate 任务来根据 DTD 验证 XML 文档。问题不在于它不工作，而在于它工作得太好了。我的 DTD 包含一个具有 IDREF 类型的“@linkend”属性的外部参照元素。大多数这些参考 ID 在当前文档之外。因此，我的构建失败，因为解析器抱怨 IDREF 引用的 ID 不存在。那么，有什么方法可以根据 DTD 验证我的 XML 文档，但忽略这种类型的错误？

我尝试过的一些事情： 在 XMLValidate 上设置“宽松”选项使任务只检查文档的格式正确，而不是针对 DTD 的有效性。 [Ant 手册中的 XMLValidate 任务](http://ant.apache.org/manual/Tasks/xmlvalidate.html)列出了一些您可以设置的 JAXP 和 SAX 选项，但似乎没有一个适用。

这是我的代码：

```
 <target name="validate">
        <echo message="Validating ${input}"/>
        <xmlvalidate file="${input}" failonerror="yes"
            classname="org.apache.xml.resolver.tools.ResolvingXMLReader">
            <classpath refid="xslt.processor.classpath"/>
        </xmlvalidate>
 </target> 
```

如您所见，我使用 ResolvingXMLReader 来根据公共标识符目录解析 DTD。但是，如果我直接使用嵌套的 xmlcatalog 元素指定 DTD，我会得到相同的行为。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-22T01:18:53.233

您的问题源于对 DTD 的两种解释之间的差异：您的和[规范的](http://www.w3.org/TR/REC-xml/#idref):-)。IDREF 必须引用同一文档中的 id，而您的则引用跨文档的元素。

我的建议是创建您自己的 DTD 版本，为该属性指定 NMTOKEN 而不是 IDREF，并使用它来执行验证。这将确保内容是有效的 xml id 值。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-06T12:11:25.667

不确定这是否有帮助，但你能试试这个解决方法吗？创建一个临时文件，合并所有 XML，然后进行验证。

# http - 以编程方式发出请求时要使用的合理 HTTP POST 超时值？

> ID：171099
> 
> 赞同：9
> 
> 时间：2008-10-04T22:12:31.837
> 
> 标签：http, post, timeout

当以编程方式发出 HTTP POST 请求时，什么超时值是合理的？

就我而言，我希望在 PHP 中发出 POST 请求时设置“合理的”超时值，但这适用于任何语言。

我需要能够发出一组请求，每个请求都发送到用户指定的 URL。如果我确实需要连续而不是同时处理请求，我想指定一个合理的时间，超过该时间请求被视为超时。

PHP 的[默认套接字超时](https://stackoverflow.com/questions/170938/what-is-the-default-time-after-which-an-http-request-is-deemed-to-have-timed-out)为 60 秒。在决定一个请求不会完成之前，这似乎是一个不必要的等待时间。

由于这些是 POST 请求，它们应该快速完成 - 没有数据可以像 GET 请求一样被检索和返回。

*在大多数情况下*，我们应该能够假设，未能在 X 秒内对请求发出响应意味着主机不太可能在合理的时间内对 X 的值*显着*小于 60 发出响应。

当然，主机很少需要超过 60 秒的时间来响应一个简单的 POST 请求。他们甚至很少需要超过 10 秒的时间吗？5秒？

在实践中 X 的合理值是多少？伴随建议的理由将是非常有益的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-04T23:31:57.243

我建议设置一个测试，因为涉及的因素太多，无法给出一个始终合理的值。

POST 请求发送要处理的数据。处理需要多长时间？这将是特定于应用程序/数据的。

主机在哪里？用户正在提供 URL，所以这将是未知的。我们无法知道您的应用程序和主机之间的流量是什么样的。我们无法知道主机的服务器负载。

本质上，没有通用的合理超时。您必须根据自己的具体需求做出最佳判断。设置测试并使用它来确定您的限制。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-05T03:40:53.297

大多数库都有连接超时和读取超时。也就是说，尝试连接到远程服务器之间的超时，以及发送请求后的超时，他们应该等待响应。

如果这是本地 Web 服务，我会将连接超时设置为低 1 秒或更短（如果您的库支持）。如果您要连接的远程服务不可用恕我直言，最好立即向用户返回响应，而不是让您的所有工作线程阻塞该远程服务，从而导致其他上游错误。

至于读取超时，这更棘手，您需要将其设置为低，这样您就不会耗尽等待远程服务返回的工作人员池，但您也不希望它太低以至于它关闭读取响应之前的连接。这是您必须测试的内容，然后在您的系统投入生产时将其作为指标进行跟踪。

# mobile - 允许用户通过手机将图片发布到 Web 应用程序？

> ID：171112
> 
> 赞同：0
> 
> 时间：2008-10-04T22:21:27.653
> 
> 标签：mobile

有几个网络应用程序允许您从手机发送照片并将它们发布到网站/应用程序。这些是如何工作的，人们将使用什么样的技术来实现这样的功能？它是 MMS 服务器还是需要进入套接字编程？例如，某些应用程序会为您提供一个电子邮件地址，以便您通过手机将照片发送到该地址。我很想知道这些东西是如何工作的。我可以自己弄清楚它们是如何工作的，但我想知道这个功能是正常实现的。

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-04T22:32:11.687

我认为您有三种选择来支持这一点：

1.  MMS - 您需要一个[MMS 网关](http://www.google.com/search?hl=en&q=mms+gateway&btnG=Google+Search&aq=1&oq=mms+gate)来接收 MMS 消息。这可以是您自己运行的软件/硬件，也可以是您为每条消息付费的服务。您可能需要在应用程序端编写自己的消息处理。
2.  电子邮件 - 您只需为用户提供一个电子邮件地址以发送图片，然后您可以通过 POP/IMAP 与电子邮件服务器连接，也可以直接与消息存储连接。
3.  Web 表单 - 您实现了一个专门为移动设备设计的 Web 表单，可以让他们上传图片。事实上，我不知道是否以及有多少设备支持`<input type="file" />`，所以这实际上可能根本不是一个选择。

您可以使用您喜欢的任何服务器端技术来处理其中的每一个。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-04T12:06:16.203

不幸的是，由于沙盒，包括 iPhone 在内的许多流行手机都不允许浏览器访问，因此您必须使用本机应用程序或其他方法之一

# php - PHP 中 MySQL、MSSQL 和 Oracle 的标准连接库

> ID：171115
> 
> 赞同：4
> 
> 时间：2008-10-04T22:24:01.967
> 
> 标签：php, database

我正在寻找一种标准的方式来连接到 PHP 中的数据库。我们都经历过——首先从一些基本的代码开始连接/查询/迭代/插入/断开连接，然后代码随着程序的增长而增长，最终导致难以重用的混乱。

我知道有许多 PEAR、PECL 和其他 PHP 库/类可以符合我的描述 - 但哪些是维护、使用并已被证明是无错误且高效的？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-04T22:41:02.777

如果您使用的是 PHP 5 ，请[尝试 PDO](http://php.net/pdo)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-04T22:58:10.230

尝试[对象关系映射](http://en.wikipedia.org/wiki/Object-relational_mapping)库，例如[Propel](http://propel.phpdb.org)和[Doctrine](http://www.doctrine-project.org)，它们都使用 PDO 作为数据库抽象层，因此它们几乎可以在所有引擎上工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-05T04:36:59.657

我很惊讶*Zend_Db*还没有被提及......

*   PEAR 的**MDB2**：非常稳定，还提供了一个层，在至少可以模拟的所有数据库中实现所有*MDB2支持的特性。*我已经使用这个多年了，并取得了很大的成功。
*   Zend Framework 的**Zend_Db**：我刚刚开始使用 Zend 整个 DB 基础架构的更高级别，但它似乎相当稳定且经过深思熟虑。
*   PHP5 的原生**PDO**：我根本没用过，但我相信它是所有这些中最简单的。事实上，*MDB2*和*Zend_Db*都可以使用 PDO 作为底层。

以上所有实现准备和执行。其中，*MDB2*是最成熟的，因为它已经存在了很长时间，并且基于*DB*和*MDB*。*Zend_Db*似乎是经过深思熟虑的。我知道还有其他人，但我对其中任何一个都没有经验或任何知识。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-04T22:40:33.073

这两个是我认为最好的。我不能声称已经尝试过所有这些:)

*   [MDB2](http://pear.php.net/package/MDB2)（PEAR DB 的继任者）
*   [数据库](http://phplens.com/adodb/)

如果在 Linux 上，无论您最终选择哪种库，都需要 FreeTDS 连接到 MSSQL。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-04T23:04:08.033

在尝试决定由谁编写或使用新库时查看新的数据库连接/查询对象时，我们认为最好自己编写。最后，它可能不具备许多其他库所具有的灵活性，但我们添加了一些功能，例如`GetAll()`检索键控数组中的所有行或`GetAllKeyed()`返回以 ID 作为键的键控数组。`GetOne()`当您的选择只有 1 列时，可以使用另一个很棒的方法。这些都大大减少了代码量。

另一个功能是，当您进行查询时，它会确定它是什么类型的查询（`INSERT`、`UPDATE`、`SELECT`、`DELETE`等），然后返回适当的信息（例如`INSERT`，最后插入的 id 或`DELETE`删除的行数）。

但我们也复制了 PEAR:DB 中的 Prepare & Execute 等功能。

# php - 集成 AJAX 和 PHP

> ID：171121
> 
> 赞同：8
> 
> 时间：2008-10-04T22:31:04.060
> 
> 标签：php, ajax, frameworks, integration

我已经编写 PHP Web 应用程序有一段时间了，并且遇到了非常好的 Javascript 框架，例如 JQuery、ExtJS、Scriptaculous 等。关于 PHP 方面我不能说同样的话 - 我总是编写代码的那部分从头开始的客户端-服务器对话。

我使用了 CodeIgniter ( [http://codeigniter.com/](http://codeigniter.com/) )，它很好，但不能作为一个整体处理 AJAX - 而是提供输入检查、图像处理和一些输出帮助程序。

是否有标准的 PHP 库/类/框架可以处理/集成 Javascript 框架？可以捕获用户的响应/请求、验证身份和输入、提供进度状态、跟踪会话、注意异步事件等的东西。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-04T22:50:36.610

[Zend 框架](http://framework.zend.com/)与[Dojo Toolkit](http://dojotoolkit.org/)集成在一起。我还没有使用过最新的 Zend 框架，但我知道在过去，它已被证明是可靠的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-04T22:48:08.487

可能有一个，但我无法想象为什么。从服务器的角度来看，AJAX 请求的外观和行为就像 HTTP 请求。您可以获取和设置 cookie。您期望从 HTTP 请求中获得的所有环境变量都在那里。所有的 HTTP 动词都像任何头字段一样工作。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-04T22:58:06.347

在下一个主要版本 1.5 中，CakePHP 将附带 jQuery。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-05T01:30:35.337

Sajax 是众多库之一，这些库提供了一种将回调从客户端 (JS) 链接到服务器端 (PHP) 的简单方法。另一个类似的库是 JPSpan，但我不确定它是否仍然受到积极支持。我只对这两个库做了一些小实验，所以你的里程可能会有所不同。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-05T04:16:55.280

一旦你理解了这个概念，使用一个库就很方便了，而且你可能会这样做，但是对于阅读这篇文章的其他人，我建议先手动做几次并真正理解它。我还推荐这本书[Bulletproof AJAX](https://rads.stackoverflow.com/amzn/click/com/0321472667)。它相当短，写得很好，不仅描述了如何使用 AJAX，使用 PHP 作为编程语言，还描述了如何创建利用 AJAX 的页面，但如果用户关闭了 JavaScript，仍然可以正常工作。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-04T22:57:45.503

当我将 JavaScript 或 HTML 返回到 AJAX 浏览器时，我所做的唯一区别是不输出标头或任何额外数据。（我使用的错误处理在调试时会输出错误，所以我也禁用了它。）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-12T14:56:35.467

是的，PHP 可以为 Ajax 输出 XML 和 JSON，但并非所有 PHP 框架都同样支持 JSON/XML。

例如：我在 Drupal (4.7) 中遇到了一个问题，在输出 JSON 响应后 PHP 会话将被删除。（HTML 输出代码明确关闭会话，这是必需的，否则会话将被删除。）

我也很想知道 PHP 框架可以更容易地管理 javascript 代码。甚至一些基本的东西，比如只在需要它的页面上包含 jQuery。或帮助管理最小化/打包 javascript 代码。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-11-02T00:52:30.553

请原谅在旧问题上发帖，但相对较新的框架[Agile Toolkit](http://agiletoolkit.org/)是对 OP 的完美答案。

它允许您创建完全面向对象的 Web-GUI，而无需进入 HTML/JavaScript。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-08-19T19:49:24.073

我强烈推荐你使用 Cjax Framework 100% PHP Side Ajax Framework。

你永远不会看到一行 JavaScript。

Cjax 让您在大多数情况下只用一行代码就可以完成 ajaxy 的工作。
Cjax 也集成到 CodeIgniter 中，就像您的手指集成到戒指中一样！

这是 CodeIgniter 论坛中的一个主题：http: [//forum.codeigniter.com/thread-65967.html](http://forum.codeigniter.com/thread-65967.html)

Cjax 不是 CodeIgniter 独有的，因为任何网站或应用程序都可以使用它，但它内置了对它的支持。

还有大量文档：（来自 CodeIgniter wiki）：[https ://github.com/bcit-ci/CodeIgniter/wiki/ajax-framework-for-codeigniter](https://github.com/bcit-ci/CodeIgniter/wiki/ajax-framework-for-codeigniter)

# java - 自动启动弹簧应用程序

> ID：171130
> 
> 赞同：2
> 
> 时间：2008-10-04T22:42:46.063
> 
> 标签：java, spring

那么有没有一种方法可以在不编写 main 方法的情况下初始化和启动命令行 Spring 应用程序。似乎所有这些主要方法都具有相同的形式

```
public static void main(final String[] args) throws Exception {
    ApplicationContext ctx = new ClassPathXmlApplicationContext("context.xml", Boot.class);
    FooService fooService = (FooService) ctx.getBean("fooService");
    fooService.bar();
} 
```

我想这并不复杂，但是有人找到了一种方法来提供一种方法来仅`context.xml`在命令行中指定，或者更好的是，在清单文件中指定？

这里的目标是简化 Spring 应用程序作为可执行 jar 的创建。我希望我可以`Main-Class`在清单中指定一些实用程序类。我想我还需要指定应用程序的起点、一个 bean 和一个开始该过程的方法。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-04T23:53:37.340

我将尝试按照我的理解回答这个问题：

> 如何打包一个包含我只需要使用的 spring 配置的 jar `java -jar myjar.jar`？

您在问题中的代码片段很有效。您不必参数化`context.xml`. 您只需将代码及其依赖项（spring 等）捆绑在一个 jar 中，并在 jar 文件中为主类提供适当的清单条目。

我个人使用[maven 2](http://maven.apache.org)，这是一个[pom.xml](http://maven.apache.org/pom.html)，我会使用它来做到这一点：

```
<project>
  <modelVersion>4.0.0</modelVersion>
  <groupId>com.stackoverflow</groupId>
  <artifactId>stackoverflow-autostart-spring-app</artifactId>
  <version>0.1</version>

  <dependencies>
    <dependency>
      <groupId>org.springframework</groupId>
      <artifactId>spring</artifactId>
      <version>2.5.2</version>
    </dependency>
  </dependencies>
  <build>
    <plugins>
      <plugin>
        <artifactId>maven-jar-plugin</artifactId>
        <configuration>
          <archive>
            <manifest>
              <mainClass>com.stackoverflow.spring.autostart.Autostart</mainClass>
            </manifest>
          </archive>
        </configuration>
      </plugin>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-shade-plugin</artifactId>
        <executions>
          <execution>
            <phase>package</phase>
            <goals>
              <goal>shade</goal>
            </goals>
          </execution>
        </executions>
      </plugin>
    </plugins>
  </build>
</project> 
```

这是假设 java 代码的一些包名称，源代码在`src/main/java`目录中，文件`context.xml`在`src/main/resources`目录中。

所以在这`pom.xml`有几个重要的点：

1.  弹簧依赖性（我相信不言自明）
2.  [maven jar 插件](http://maven.apache.org/plugins/maven-jar-plugin/)的配置，它将主类添加为清单条目
3.  [maven shade 插件](http://maven.apache.org/plugins/maven-shade-plugin/)，该插件负责收集所有依赖项/类并将它们打包到一个 jar 中。

可执行 jar 将在`target\stackoverflow-autostart-spring-app-0.1.jar`运行时可用`mvn package`。

~~我的盒子上都有这段代码，但我意识到我无法在此处附加 zip 文件。任何人都知道我可以这样做的地方并在这里链接？~~

如果您想查看它，我在 github 上创建了一个带有与此问题相关的代码的[git 存储库。](http://github.com/sleberrigaud/sof)

希望这可以帮助。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-05T15:20:41.573

是的。编写一个简单的函数`SpringMain`，它以任意数量的`xml`和`properties`文件作为参数。然后，您可以（在 main 方法中）从这些文件初始化应用程序。启动您的程序只需：

```
java -cp myapp.jar util.SpringMain context.xml 
```

然后，您使用相关 bean 上的生命周期属性 ( `init-method`) 来启动应用程序

# sql - 如何在 SQL Server 中稍微翻转一下？

> ID：171173
> 
> 赞同：83
> 
> 时间：2008-10-04T23:21:24.770
> 
> 标签：sql, sql-server, bit-manipulation

我正在尝试在 SQL Server 中执行按位 NOT。我想做这样的事情：

```
update foo
set Sync = NOT @IsNew 
```

注意：我开始写这篇文章并在完成之前找到了我自己问题的答案。我仍然想与社区分享，因为 MSDN 上缺少这段文档（直到我也将它添加到社区内容中）。

* * *

## 回答 #1

> 赞同：123
> 
> 时间：2008-10-04T23:40:54.060

是的， ~ 运算符将起作用。

```
update foo
set Sync = ~@IsNew 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2008-10-04T23:21:44.940

**按位非：~**

按位与：&

按位或：|

按位异或：^

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-04T23:37:35.813

缺少 MSDN？ [http://msdn.microsoft.com/en-us/library/ms173468(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms173468(SQL.90).aspx)

> ~：对整数值执行按位逻辑非运算。~ 按位运算符对表达式执行按位逻辑 NOT，依次取每个位。如果表达式的值为 0，则结​​果集中的位设置为 1；否则，结果中的位被清零。换句话说，1 变为 0，0 变为 1。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-08-06T16:27:07.593

为了完整起见：

```
SELECT b, 1 - b
FROM
  (SELECT cast(1 AS BIT) AS b
   UNION ALL
   SELECT cast(0 AS BIT) AS b) sampletable 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-07-11T19:38:14.500

~ 运算符仅适用于 BIT，

试试：~ CAST(@IsNew AS BIT)

# sharepoint - 这里有没有人从事 KOFAX-SharePoint 2007 集成工作？

> ID：171177
> 
> 赞同：2
> 
> 时间：2008-10-04T23:22:20.180
> 
> 标签：sharepoint, ecm, kofax

我们希望能够通过利用KOFAX 和SharePoint 2007 的强大功能来推进我们的业务。开发方面的任何指针？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T14:32:32.603

几年前我们考虑过做这样的事情。我们正在考虑扫描打印的文档，使用 OCR 进行转换，并在一种存储库中进行数字化组织。

我们实际上对 OCR 工具和存储库/协作工具进行了分析，这将是最容易集成的。我们检查了 Kofax、OCR for AnyDoc 和 OCR 方面的其他几个，以及存储库/协作方面的 SharePoint WSS、SharePoint MOSS、Hyland OnBase、SAP Collaboration Manager 和 Documentum。

您的想法很好，并且在银行业和其他行业中使用了它的变体。至于集成，根据我的经验，如果您使用的是 SharePoint，如果您在双方都利用 API 并通过简单的 Web 部件和 iFrame 获得创意，那么使用 Kofax 应该很容易。

K A

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T17:53:38.980

我们通过从 Kofax 构建自定义发布脚本来完成此操作。

关键问题是您希望在集成中具有多大的灵活性以供将来扩展。构建处理单个文档库或列表的一次性发布脚本很容易。构建可配置的东西要多得多。

如果您正在寻找工作流程和其他 ECM 优势，OnBase 是一个不错的选择。您可以扫描到 OnBase，然后 OnBase 会自动将链接直接推送到库或 SP 中的列表中。

您还需要了解，如果没有其他工具，在 SP 中搜索和查看大量文档图像可能会很麻烦。

如果您想讨论，请发送电子邮件至 sales@imagesoftinc.com。

斯科特

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-10T22:12:50.600

PSIGEN 为 SharePoint 提供了一个很好的入口

[SharePoint 的扫描和捕获](http://www.psigen.com/sharepoint/sharepoint_scanning_capture_imaging.aspx)

# c# - 正在寻找 C# 中的后缀树实现？

> ID：171196
> 
> 赞同：14
> 
> 时间：2008-10-04T23:49:00.050
> 
> 标签：c#, data-structures, suffix-tree

我已经对一个研究项目进行了基本搜索。我试图通过构建[后缀树](http://en.wikipedia.org/wiki/Suffix_tree)来提高搜索效率。我对[Ukkonen](http://en.wikipedia.org/wiki/Ukkonen%27s_algorithm)算法的 C# 实现感兴趣。如果存在这样的实现，我不想浪费时间自己动手。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-11T05:31:00.343

难以回答的问题。这是我能找到的最接近的匹配：http: [//www.codeproject.com/KB/recipes/ahocorasick.aspx](http://www.codeproject.com/KB/recipes/ahocorasick.aspx)，它是 Aho-Corasick 字符串匹配算法的实现。现在，该算法使用类似后缀树的结构：[http ://en.wikipedia.org/wiki/Aho-Corasick_algorithm](http://en.wikipedia.org/wiki/Aho-Corasick_algorithm)

现在，如果你想要一个前缀树，这篇文章声称为你提供了一个实现：http: [//www.codeproject.com/KB/recipes/prefixtree.aspx](http://www.codeproject.com/KB/recipes/prefixtree.aspx)

<*幽默*> 既然我做了你的功课，你修剪我的草坪怎么样。（参考： http: [//flyingmoose.org/tolksarc/homework.htm](http://flyingmoose.org/tolksarc/homework.htm)）< */HUMOR* >

*编辑*：我发现了一个 C# 后缀树实现，它是在博客上发布的 C++ 的一个端口： [http ://code.google.com/p/csharsuffixtree/source/browse/#svn/trunk/suffixtree](http://code.google.com/p/csharsuffixtree/source/browse/#svn/trunk/suffixtree)

*编辑*：Codeplex 有一个专注于后缀树的新项目：http: [//suffixtree.codeplex.com/](http://suffixtree.codeplex.com/)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2017-09-27T14:46:00.420

嘿，刚刚完成了包含不同 trie 实现的 .NET (c#) 库。其中：

*   经典特里
*   帕特里夏特里
*   后缀特里
*   使用**Ukkonen**算法的 trie

我试图使源代码易于阅读。用法也很简单：

```
using Gma.DataStructures.StringSearch;

...

var trie = new UkkonenTrie<int>(3);
//var trie = new SuffixTrie<int>(3);

trie.Add("hello", 1);
trie.Add("world", 2);
trie.Add("hell", 3);

var result = trie.Retrieve("hel"); 
```

该库经过良好测试，并作为[TrieNet](https://www.nuget.org/packages/TrieNet/) NuGet 包发布。

见[github.com/gmamaladze/trienet](https://github.com/gmamaladze/trienet)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-09-13T13:47:28.070

这是一个相当有效的后缀树的实现。我没有研究过 Ukkonen 的实现，但是我相信这个算法的运行时间是相当合理的，大约`O(N Log N)`. 请注意，创建的树中的内部节点数等于父字符串中的字母数。

```
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using NUnit.Framework;

namespace FunStuff
{
    public class SuffixTree
    {
        public class Node
        {
            public int Index = -1;
            public Dictionary<char, Node> Children = new Dictionary<char, Node>();
        }

        public Node Root = new Node();
        public String Text;

        public void InsertSuffix(string s, int from)
        {             
            var cur = Root;
            for (int i = from; i < s.Length; ++i)
            {
                var c = s[i];
                if (!cur.Children.ContainsKey(c))
                {
                    var n = new Node() {Index = from};
                    cur.Children.Add(c, n);

                    // Very slow assertion. 
                    Debug.Assert(Find(s.Substring(from)).Any());

                    return;
                }
                cur = cur.Children[c];
            }
            Debug.Assert(false, "It should never be possible to arrive at this case");
            throw new Exception("Suffix tree corruption");
        }

        private static IEnumerable<Node> VisitTree(Node n)
        {
            foreach (var n1 in n.Children.Values)
                foreach (var n2 in VisitTree(n1))
                    yield return n2;
            yield return n;
        }

        public IEnumerable<int> Find(string s)
        {
            var n = FindNode(s);
            if (n == null) yield break;
            foreach (var n2 in VisitTree(n))
                yield return n2.Index;
        }

        private Node FindNode(string s)
        {
            var cur = Root;
            for (int i = 0; i < s.Length; ++i)
            {
                var c = s[i];
                if (!cur.Children.ContainsKey(c))
                {
                    // We are at a leaf-node.
                    // What we do here is check to see if the rest of the string is at this location. 
                    for (var j=i; j < s.Length; ++j)
                        if (cur.Index + j >= Text.Length || Text[cur.Index + j] != s[j])
                            return null;
                    return cur;
                }
                cur = cur.Children[c];
            }
            return cur;
        }

        public SuffixTree(string s)
        {
            Text = s;
            for (var i = s.Length - 1; i >= 0; --i)
                InsertSuffix(s, i);
            Debug.Assert(VisitTree(Root).Count() - 1 == s.Length);
        }
    }

    [TestFixture]
    public class TestSuffixTree
    {
        [Test]
        public void TestBasics()
        {
            var s = "banana";
            var t = new SuffixTree(s);
            var results = t.Find("an").ToArray();
            Assert.AreEqual(2, results.Length);
            Assert.AreEqual(1, results[0]);
            Assert.AreEqual(3, results[1]);
        }
    } 
} 
```

# java - Windows XP 上的 Java 最大内存

> ID：171205
> 
> 赞同：105
> 
> 时间：2008-10-05T00:02:04.110
> 
> 标签：java, windows, memory

我一直能够为在 32 位 Windows XP（Java 1.4、1.5 和 1.6）上运行的 Java SE 分配 1400 兆字节。

```
java -Xmx1400m ... 
```

今天我在使用 Java 1.5_16 和 1.6.0_07 的新 Windows XP 机器上尝试了相同的选项并得到了错误：

```
Error occurred during initialization of VM
Could not reserve enough space for object heap
Could not create the Java virtual machine. 
```

经过反复试验，我在这台机器上最多可以分配 1200 兆字节。

有什么想法为什么一台机器允许 1400 而另一台机器只允许 1200？

编辑：这台机器有 4GB 的 RAM，Windows 可以识别大约 3.5GB。

* * *

## 回答 #1

> 赞同：129
> 
> 时间：2009-01-31T00:02:39.267

请记住，Windows 具有虚拟内存管理，而 JVM 只需要*在其地址空间*中连续的内存。因此，系统上运行的其他程序不一定会影响您的堆大小。会妨碍您的是加载到您的地址空间中的 DLL。不幸的是，Windows 中的优化可以最大限度地减少链接期间 DLL 的重定位，这使得您更有可能拥有碎片化的地址空间。除了通常的东西之外，可能会侵入您的地址空间的东西包括安全软件、CBT 软件、间谍软件和其他形式的恶意软件。差异的可能原因是不同的安全补丁、C 运行时版本等。设备驱动程序和其他内核位有自己的地址空间（4GB 32 位空间中的另外 2GB）。

您*可以*尝试在您的 JVM 进程中检查您的 DLL 绑定，并尝试将您的 DLL 重新设置为更紧凑的地址空间。不好玩，但如果你绝望...

或者，您可以只切换到 64 位 Windows 和 64 位 JVM。尽管其他人建议，虽然它会消耗更多的 RAM，但您将拥有*更多*连续的虚拟地址空间，并且连续分配 2GB 将是微不足道的。

* * *

## 回答 #2

> 赞同：51
> 
> 时间：2009-01-31T01:26:14.917

这与连续内存有关。

[这是我在网上找到的一些信息](http://www.unixville.com/~moazam/)，之前有人问过这个问题，据说是来自“虚拟机之神”：

> 我们需要一个连续的内存区域用于堆的原因是我们有一堆边数据结构，这些数据结构由从堆开始的（缩放的）偏移量索引。例如，我们使用“卡片标记数组”跟踪对象引用更新，该数组每 512 字节堆有一个字节。当我们在堆中存储一个引用时，我们必须在卡片标记数组中标记相应的字节。我们右移存储的目标地址并使用它来索引卡片标记数组。有趣的寻址算术游戏，你不能在 Java 中做，你必须（必须：-）在 C++ 中玩。
> 
> 通常我们可以轻松获得适度的连续区域（在 Windohs 上最多约 1.5GB，在 Solaris 上最多约 3.8GB。YMMV。）。在 Windohs 上，问题主要是在 JVM 启动之前加载了一些库，从而破坏了地址空间。使用 /3GB 开关不会变基这些库，所以它们对我们来说仍然是一个问题。
> 
> 我们知道如何制作分块堆，但使用它们会有一些开销。与 32 位 JVM 中更大的堆相比，我们对更快的存储管理的要求更多。如果您真的想要大堆，请切换到 64 位 JVM。我们仍然需要连续的内存，但进入 64 位地址空间要容易得多。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2009-01-31T01:56:39.190

Windows 的 Java 堆大小限制为：

*   **32 位 Java 上可能的**最大堆大小：** **1.8 GB****
***   **32 位 Java 的**推荐堆大小限制：** **1.5 GB**（或**1.8 GB**，带 /3GB 选项）****

 ****这并不能帮助您获得更大的 Java 堆，但现在您知道不能超出这些值。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-02-01T22:25:58.490

[Oracle JRockit](http://blogs.oracle.com/jrockit/2008/09/how_to_get_almost_3_gb_heap_on_windows.html)可以处理非连续堆，在 Windows 2003/XP 上使用 /3GB 开关可以拥有 2.85 GB 的 Java 堆大小。似乎碎片对 Java 堆的大小有相当大的影响。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-05T04:26:43.780

JVM 需要连续内存，根据正在运行的其他内容、之前运行的内容以及 Windows 管理内存的方式，您最多可以获得 1.4GB 的连续内存。我认为 64 位 Windows 将允许更大的堆。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-06T19:59:41.790

Sun 的 JVM 需要连续内存。因此，可用内存的最大数量取决于内存碎片。特别是驱动程序的 dll 在加载到某些预定义的基地址时往往会导致内存碎片化。因此，您的硬件及其驱动程序决定了您可以获得多少内存。

来自 Sun 工程师的声明的两个来源：[论坛](http://forums.sun.com/thread.jspa?messageID=2715152#2715152) [博客](http://www.unixville.com/~moazam/)

也许另一个JVM？你试过[和谐](http://harmony.apache.org)吗？我认为他们计划允许非连续记忆。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-05T23:48:23.060

我认为这与此响应所暗示的 Windows 的配置方式有关： [Java -Xmx Option](http://coding.derkeiler.com/Archive/Java/comp.lang.java/2005-07/msg00014.html)

更多测试：我能够在一台只有 768MB 物理 RAM（加上虚拟内存）的旧 Windows XP 机器上分配 1300MB。在我的 2GB RAM 机器上，我只能获得 1220MB。在其他各种公司机器（使用较旧的 Windows XP）上，我能够获得 1400MB。具有 1220MB 限制的机器是相当新的（刚从戴尔购买），所以它可能有更新（而且更臃肿）的 Windows 和 DLL（它运行的是 Window XP Pro 版本 2002 SP2）。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-04-07T02:38:34.230

从（有限内存）virtuozzo VPS 运行 java 程序时，我收到此错误消息。我没有指定任何内存参数，并且发现我必须显式设置*少量*，因为默认值一定太高了。例如 -Xmx32m （显然需要根据您运行的程序进行调整）。

只是把它放在这里以防其他人收到上述错误消息而没有像提问者那样指定大量内存。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-05T05:09:02.603

如果您分配一个巨大的块，sun 的 JDK/JRE 需要连续的内存量。

操作系统和初始应用程序倾向于在加载过程中分配零碎的可用 RAM。如果连续块不可用，则 SUN JDK 无法使用它。Bea 的 JRockit（被 Oracle 收购）可以从块中分配内存。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-06-12T16:17:53.747

每个人似乎都在回答有关连续记忆的问题，但忽略了承认一个更紧迫的问题。

即使有 100% 的连续内存分配，您也不能在 32 位 Windows 操作系统上拥有 2 GiB 的堆大小（*默认情况下）。这是因为 32 位 Windows 进程不能处理超过 2 GiB 的空间。

**除了 heap 之外，** Java 进程还将包含 perm gen（Java 8 之前）、每个线程的堆栈大小、JVM / 库开销（几乎随着每次构建而增加）。

此外，JVM 标志及其默认值在版本之间会发生变化。只需运行以下命令，您就会有所了解：

```
 java -XX:+PrintFlagsFinal 
```

许多选项会影响堆内和堆外的内存划分。留给您或多或少的 2 GiB 可玩...

要重用我的[这个](https://stackoverflow.com/a/9533056/575766)答案的一部分（关于 Tomcat，但适用于任何 Java 进程）：

> Windows 操作系统将 32 位进程的内存分配总量限制为 2 GiB（默认情况下）。
> 
> [您将只能] 分配大约 1.5 GiB 的堆空间，因为还有其他内存分配给进程（JVM / 库开销、perm gen 空间等）。
> 
> [为什么 32 位 Windows 施加 2 GB 进程地址空间限制，而 64 位 Windows 施加 4GB 限制？](https://superuser.com/questions/372498/why-does-32-bit-windows-impose-a-2-gb-process-address-space-limit-but-64-bit-wi)
> 
> 其他现代操作系统 [cough Linux] 允许 32 位进程使用全部（或大部分）4 GiB 可寻址空间。
> 
> 也就是说，64 位 Windows 操作系统可以配置为将 32 位进程的限制增加到 4 GiB（32 位为 3 GiB）：
> 
> [http://msdn.microsoft.com/en-us/library/windows/desktop/aa366778(v=vs.85).aspx](http://msdn.microsoft.com/en-us/library/windows/desktop/aa366778(v=vs.85).aspx)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-12-17T21:25:44.450

这是增加分页大小的方法

1.  右键我的电脑--->属性--->高级
2.  在性能部分点击设置
3.  单击高级选项卡
4.  在虚拟内存部分，单击更改。它将显示您当前的分页大小。
5.  选择可用硬盘空间的驱动器。
6.  提供初始大小和最大大小...例如初始大小 0 MB 和最大大小 4000 MB。（根据您的需要）

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-02-17T16:47:35.367

**有很多方法可以改变堆大小，比如，

1.  **文件->设置->构建、执行、部署->编译器** 在这里你会发现堆大小
2.  **file->setting->build, exceution, deployment->compiler->andriod**在这里你也会发现堆大小。如果您遇到同样的问题，您可以将其用于 andriod 项目。

对我有用的是

1.  设置适当的 JAVA_HOME 路径，以防你更新了 java。

2.  创建**新系统变量计算机->属性->高级设置-** >创建新系统变量

## ***名称：_JAVA_OPTION 值：-Xmx750m***

**仅供参考：您可以在 Intellij help->edit custom VM option**中找到默认 VMoption ，在此文件中您可以看到堆的最小和最大大小。**

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2009-02-02T23:03:48.197

首先，当你有 4 GB 的 RAM 时使用页面文件是没有用的。Windows 不能访问超过 4GB（实际上是因为内存漏洞而减少了），因此不使用页面文件。

其次，地址空间一分为二，一半给内核，一半给用户态。如果您的应用程序需要更多 RAM，请使用 boot.ini 中的 /3GB 选项（确保 java.exe 被标记为“大地址感知”（谷歌了解更多信息）。

第三，我认为你不能分配完整的 2 GB 地址空间，因为 java 在内部浪费了一些内存（用于线程、JIT 编译器、VM 初始化等）。使用 /3GB 开关了解更多信息。

# c++ - 如何阻止运行同一程序的两个实例？

> ID：171213
> 
> 赞同：23
> 
> 时间：2008-10-05T00:05:44.977
> 
> 标签：c++

我需要确保用户一次只能运行我的程序的一个实例。
这意味着，我必须以编程方式检查同一个程序是否已经在运行，并在这种情况下退出。

我想到的第一件事是在程序启动时在某个地方创建一个文件。然后，程序的每个其他实例将检查该文件并在找到它时退出。
问题是，程序必须始终正常退出并能够删除它创建的文件，才能正常工作。例如，在断电的情况下，锁定文件仍然存在，程序无法再次启动。

为了解决这个问题，我决定将第一个程序的进程 ID 存储到锁定文件中，当另一个实例启动时，它会检查文件中的 PID 是否附加到某个正在运行的进程。
如果文件不存在、为空或 PID 与任何现有进程不对应，程序将继续运行并将自己的 PID 写入文件。

这似乎工作得很好——即使在意外关闭之后，（现在已过时的）进程 ID 与其他程序相关联的机会似乎也很低。

但它仍然感觉不对（有*可能*被一些不相关的进程锁定）并且使用进程 ID 似乎超出了标准 C++ 并且可能也不是很便携。

那么，是否有另一种（更干净和安全）的方式来做到这一点？理想情况下，它可以使用 ISO 98 C++ 标准以及 Windows 和 *nix 等。
如果不能独立于平台完成，Linux/Unix 对我来说是一个优先事项。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-10-05T00:10:42.610

您可以使用几种方法来完成仅允许应用程序的一个实例：

**方法一：全局同步对象或内存**

它通常通过创建一个命名的全局互斥锁或事件来完成。如果它已经创建，那么您知道该程序已经在运行。

例如在windows中你可以这样做：

```
 #define APPLICATION_INSTANCE_MUTEX_NAME "{BA49C45E-B29A-4359-A07C-51B65B5571AD}"

    //Make sure at most one instance of the tool is running
    HANDLE hMutexOneInstance(::CreateMutex( NULL, TRUE, APPLICATION_INSTANCE_MUTEX_NAME));
    bool bAlreadyRunning((::GetLastError() == ERROR_ALREADY_EXISTS));
    if (hMutexOneInstance == NULL || bAlreadyRunning)
    {
        if(hMutexOneInstance)
        {
            ::ReleaseMutex(hMutexOneInstance);
            ::CloseHandle(hMutexOneInstance);
        }
        throw std::exception("The application is already running");
    } 
```

**方法二：锁定文件，第二个程序打不开文件，所以打开**

您还可以通过在应用程序打开时锁定文件来独占打开文件。如果文件已经被独占打开，并且您的应用程序无法接收文件句柄，那么这意味着程序已经在运行。在 Windows 上，您根本不会在使用API`FILE_SHARE_WRITE`打开的文件上指定共享标志。`CreateFile`在 linux 上你会使用`flock`.

**方法三：搜索进程名：**

您可以枚举活动进程并使用您的进程名称搜索一个。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-05T00:12:06.867

您将进程 pid 写入文件的方法是在许多不同的已建立应用程序中使用的常用方法。事实上，如果你`/var/run`现在查看你的目录，我敢打赌你`*.pid`已经找到了几个文件。

正如您所说，它不是 100% 健壮的，因为 pid 有可能会感到困惑。我听说过`flock()`用于锁定特定于应用程序的文件的程序，该文件将在进程退出时由操作系统自动解锁，但这种方法更特定于平台且不太透明。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-05T00:09:57.980

我实际上完全使用了您描述的过程，它工作正常，除了当您突然用完磁盘空间并且无法再创建文件时发生的边缘情况。

这样做的“正确”方法可能是使用共享内存：[http ://www.cs.cf.ac.uk/Dave/C/node27.html](http://www.cs.cf.ac.uk/Dave/C/node27.html)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-05T13:38:37.583

禁止一个程序的多个实例运行是非常 unix 的。

如果程序是一个网络守护进程，它不需要主动禁止多个实例——只有第一个实例可以监听套接字，所以后续实例会自动崩溃。如果它是一个 RDBMS，它不需要主动禁止多个实例——只有第一个实例可以打开和锁定文件。等等

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-05T03:44:59.573

如果您想要一些标准的东西，那么使用文件作为“锁”几乎是要走的路。它确实有您提到的缺点（如果您的应用程序没有清理，重新启动可能是一个问题）。

这种方法被很多应用程序使用，但我唯一能想到的就是 VMware。是的，有时您必须进入并删除“* .lck”，当事情被楔入时。

使用[Brian Bondy](https://stackoverflow.com/questions/171213/how-to-block-running-two-instances-of-the-same-program#171220)提到的全局互斥锁或其他系统对象是一种更好的方法，但这些是特定于平台的（除非您使用其他一些库来抽象平台细节）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-05T00:13:33.213

我没有一个好的解决方案，但有两个想法：

1.  您可以添加 ping 功能来查询其他进程并确保它不是不相关的进程。Firefox 在 Linux 上做了类似的事情，当一个新实例已经在运行时，它不会启动一个新实例。

2.  如果您使用信号处理程序，您可以确保 pid 文件在除`kill -9`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-05T00:17:14.783

我扫描进程列表以查找具有匹配命令行参数的应用程序可执行文件的名称，然后如果匹配则退出。

我的应用程序可以运行多次，但我不希望它同时运行同一个配置文件。

显然，这是特定于 Windows 的，但即使没有特定库，只需打开 shell 命令“ps -ef”或变体并查找您的应用程序，在任何 *NIX 系统上都可以轻松实现相同的概念。

```
 '*************************************************************************
   '     Sub: CheckForProcess()
   '  Author: Ron Savage
   '    Date: 10/31/2007
   '
   ' This routine checks for a running process of this app with the same
   ' command line parameters.
   '*************************************************************************
   Private Function CheckForProcess(ByVal processText As String) As Boolean
      Dim isRunning As Boolean = False
      Dim search As New ManagementObjectSearcher("SELECT * FROM Win32_process")
      Dim info As ManagementObject
      Dim procName As String = ""
      Dim procId As String = ""
      Dim procCommandLine As String = ""

      For Each info In search.Get()
         If (IsNothing(info.Properties("Name").Value)) Then procName = "NULL" Else procName = Split(info.Properties("Name").Value.ToString, ".")(0)
         If (IsNothing(info.Properties("ProcessId").Value)) Then procId = "NULL" Else procId = info.Properties("ProcessId").Value.ToString
         If (IsNothing(info.Properties("CommandLine").Value)) Then procCommandLine = "NULL" Else procCommandLine = info.Properties("CommandLine").Value.ToString

         If (Not procId.Equals(Me.processId) And procName.Equals(processName) And procCommandLine.Contains(processText)) Then
            isRunning = True
         End If
      Next

      Return (isRunning)
   End Function 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-03-20T02:36:25.530

我找到了一种跨平台的方法来使用`boost/interprocess/sync/named_mutex`. 请参考这个答案[https://stackoverflow.com/a/42882353/4806882](https://stackoverflow.com/a/42882353/4806882)

# rss - PHP 访问 RSS 提要中的 iTunes 标签

> ID：171230
> 
> 赞同：3
> 
> 时间：2008-10-05T00:16:51.070
> 
> 标签：rss, itunes, podcast, simplepie

我需要使用 PHP 访问 RSS 提要中的 iTunes 标签。我以前使用过 simplepie 的播客提要，但我不确定如何使用它来获取 iTunes 标签。有没有办法使用 simplepie 来做到这一点，或者有更好的方法吗？

* * *

好的，我尝试了简单的 XML。

所有这些（下面的代码）似乎都有效

```
$feed = simplexml_load_file('http://sbhosting.com/feed/');
$channel = $feed->channel;
$channel_itunes = $channel->children('http://www.itunes.com/dtds/podcast-1.0.dtd');
$summary = $channel_itunes->summary;
$subtitle = $channel_itunes->subtitle;
$category = $channel_itunes->category;
$owner = $channel_itunes->owner->name; 
```

现在我需要获取 iTunes 类别。似乎以几种方式表示。在这种情况下，我得到以下 XML：

```
<itunes:category text="Technology"/>
<itunes:category text="Technology">
  <itunes:category text="Software How-To"/>
</itunes:category> 
```

我希望能够通过以下方式获得类别：

```
$category_text = $channel_itunes->category['text']; 
```

但这似乎不起作用。

我见过其他方式来表示我真的不知道该找谁的类别。

例如：

科技商业教育

这是媒体的事情还是iTunes的事情或两者兼而有之？

谢谢你的帮助。G

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-05T02:33:17.067

SimplePie 有一个[`get_item_tags()`函数](http://simplepie.org/wiki/reference/simplepie_item/get_item_tags)可以让你访问它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-20T04:45:29.853

这段代码对我有用：

```
//$pie is a SimplePie object
$iTunesCategories=$pie->get_channel_tags(SIMPLEPIE_NAMESPACE_ITUNES,'category');
if ($iTunesCategories) {
  foreach ($iTunesCategories as $iTunesCategory) {
    $category=$iTunesCategory['attribs']['']['text'];
    $subcat=$iTunesCategory['child']["http://www.itunes.com/dtds/podcast-1.0.dtd"]['category'][0]['attribs']['']['text'];
    if ($subcat) {
      $category.=":$subcat";
    }
    //do something with $category
  }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2018-07-31T07:47:00.683

要使用 SimpleXML 获取属性，请改为：

```
$category_text = $channel_itunes->category['text']; 
```

采用：

```
$category_text = $channel_itunes->category->attributes()->text; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2022-02-09T10:30:33.057

```
<?php echo $feed_item->children('itunes', true)->image->attributes()->href;?> 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-05T00:19:54.213

如果您有 PHP5，使用简单 XML 可以帮助解析您需要的信息。

# apache - Apache Webserver 安全和优化技巧

> ID：171237
> 
> 赞同：5
> 
> 时间：2008-10-05T00:19:23.077
> 
> 标签：apache, security, optimization, webserver

我即将管理和运行我的第一个 Internet 连接的 Apache 网络服务器，我想知道是否有任何系统管理员和开发人员愿意分享他们关于运行 Apache 网络服务器的安全和优化技巧的一些知识。

也许您可以分享您在安装 Apache 网络服务器（在 Linux 机器上）后立即执行的前五（或十）项列表。

非常感谢任何帮助。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-05T00:32:36.123

## 基本的

1.  **一定要安装最新的稳定版本**。运行旧版本或不稳定版本的 Apache 可能会使您的系统面临安全漏洞或未经测试的解决方案
2.  **确保只实际处理预期的请求**。您应该考虑*谁*必须访问 Apache 公开的 Web 资源以及*如何*访问。
3.  **避免以 root 身份运行 Apache**。这是必须的。
4.  **处理您的日志**。原木趋于变得越来越大；考虑设置 logrotate 或定期清理日志。
5.  **使用监控系统监控 Apache 运行状况**。我喜欢将 munin 和 monit 结合起来，既易于设置又易于维护。Nagios 等人值得一看。
6.  如果 Apache 正在为 Web 应用程序（即 PHP、Perl、Rails）提供服务，**请确保请求由正确的模块以正确的顺序处理**。
7.  **写一个漂亮的 404 和 500 消息**。您的访问者迟早会发现错误。
8.  **停止并重新启动 Apache**，因此您可以确保喊叫和启动过程都正常工作。
9.  使用**mod_security**

## 安全

1.  保护 Apache 免受 DOS 攻击。
2.  仅加载真正需要的模块。
3.  监控你的日志，看看是否发生了奇怪的事情。

## 表现

1.  如果您从源代码编译 Apache，请务必使用 MPM（多处理模块）。
2.  仅加载真正需要的模块。
3.  检查 MaxClients 设置，这样您的服务器就不会产生太多它开始交换的子节点。
4.  使用 mod_deflate 模块，它提供了 DEFLATE 输出过滤器，允许您的服务器的输出在通过网络发送到客户端之前被压缩。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-05T00:21:11.170

*   确保 Apache 进程没有以 root 身份运行。
*   确保使用最新的稳定版本
*   如果盒子直接连接到互联网，请确保您考虑过所有其他服务，例如 ssh。
*   仔细检查您的本地防火墙规则，将其收紧。（见 iptables）
*   不要打开您不理解或不打算使用的选项
*   考虑订阅 Apache 安全邮件列表，以便您立即了解任何关键补丁

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-05T02:48:23.103

1.  [chroot](http://www.linux.com/articles/36331)网络服务器
2.  禁用您不需要的任何模块
3.  您需要的是[mod_security](http://www.modsecurity.org/)
4.  为您的 webroot设置[文件完整性检查器](http://la-samhna.de/library/scanners.html)
5.  保护同一台服务器上的所有其他内容并关闭任何未使用的内容
6.  [使用nmap](http://nmap.org/)或[Metasploit](http://www.metasploit.com/)等工具对您的服务器运行测试

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-25T11:24:11.467

我将“在机器上安装 Apache 之后”解释为“准备新的服务器安装以供生产使用”，因为当然这一切都将在开发服务器上完成并提交给 SCM 或内置到自动安装中。

您为优化所做的一切都必须基于实际测量。尽可能真实地使用您打算运行的实际应用程序设置测试环境。需要考虑的几点是：

*   不要将 MaxClients 设置得太高。您可能会占用大量 RAM，特别是对于其中嵌入了大型应用程序（例如 mod_perl、PHP 等）的 prefork 服务器。使用过多的内存会适得其反。对于客户来说，等待成功的服务比服务错误要好。
*   仔细考虑你是否开启了 Keepalives。这些可以根据您的环境加速和减速。如果您选择启用它们，您应该根据实际用例考虑您的 keepalive 超时。
*   如果您在生产中使用 HTTPS，请在启用 HTTPS 的情况下进行性能测试
*   在不经常更改的对象上适当地设置“Last-modified”和“Expires”标头（以最大化客户端缓存）。在各种浏览器中测试客户端缓存。
*   确保您的应用程序正确使用 HTTPS，而不是导致浏览器生成安全警告（这是您在测试期间需要使用 HTTPS 的另一个好理由）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-05T00:25:08.010

如果您正在运行标准 LAMP（Linux、Apache、MySQL、PHP/PEARL/PYTHON）环境：将 MySQL 放在 Apache 以外的另一台机器上。只有几个并发进程会慢一点（由于网络延迟），但有很多并发进程会快得多。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-05T00:31:14.567

确保您已将其配置为检测 DOS（拒绝服务）攻击。

# visual-studio - 在 Visual Studio 中的 Asus EEE Pc 上编程

> ID：171246
> 
> 赞同：6
> 
> 时间：2008-10-05T00:26:55.650
> 
> 标签：visual-studio, eeepc

有人试过在 Visual Studio 中的 EEE Pc 上编程吗？

我正在考虑购买一个，这样我就可以即时展示一些应用程序，但也可以在必要时对它们进行一些小改动，而不会带来大型笔记本电脑的不便。

我追求的一些关键点：

*   它有多快
*   它是否适合开发人员对代码进行小的更改的需求？

听起来规格将完全拥有，但我听说过/看到过关于 EEE Pc 的奇怪的好东西，比如它如何在 nLite'd XP 安装上超级快速地启动 Word 2007。:)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-05T00:45:37.453

我拥有一台 eeepc 900 并已成功安装 Visual Studio 2008、MSDN 库和 SQL Server 2005 开发人员版。

最大的问题是将其全部安装在 4GB 固态 C 驱动器中。简而言之，你不能。因此使用 16GB 二级内置闪存驱动器是必不可少的。

实用程序[nlite](http://www.nliteos.com/)就是我需要做的所有事情。总之，nlite 可以让您创建一个更紧凑的 Windows XP 版本，其中只包含您需要的组件。然而，对于 eeePC 来说最重要的是它让我可以轻松地告诉 Windows 使用 D:\ 而不是 C:\ 作为“程序文件”和“文档和设置”的目的地。

然后从 nlite windows 映像重新安装 windows，并根据需要自动设置所需的路径。（我强烈推荐这种方法，而不是尝试更改现有/正在运行的 Windows 安装的路径，因为它可能会导致应用程序兼容性等诸多问题）。

不幸的是（至少在 eepc900 上）D:\ 驱动器在一般使用中比固态闪存驱动器慢。对于 Visual Studio，这意味着启动时间可能比理想的慢（即 30 秒）。但是我有 2GB 的 RAM 并且完全禁用了 windows 交换文件，所以一旦数据被加载到 RAM 中，Visual Studio 运行良好。

总的来说，我在我的 eeePC 上将 Visual Studio 用于较小的项目，它非常适合在移动时创建概念验证类型的应用程序。虽然它永远不会成为理想的主要开发机器，但我完全可以推荐在其上安装 Visual Studio 等。

为了帮助解决可能的混淆：

eeePC 9系列（900、901）拥有8.9英寸屏幕，分辨率1024*600，内部存储共20GB，RAM可升级至2GB。
较旧的 eeePC 7 系列具有 7 英寸的屏幕，分辨率为 800* 480，内置 4GB 内部存储（RAM 高达 2GB？）。作为一款开发机，7系确实不能胜任，但9系肯定可以。

[更新]

我现在拥有一个 eeePC 900HA、1.6Ghz Atom、2G RAM、160GB 硬盘。用于概念验证和较小程序的很棒的小机器。最大的性能改进在于标准的 160GB 硬盘，比假装的固态硬盘好得多，**比**同等的真正 SSD 便宜得多。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-05T04:19:54.917

或多或少像 Ash，我有一台 EEE PC 901，安装了没有 SP1、Resharper 和 MSDN 库的 VS2008。我没有安装 SQL Server，因为我大部分时间都使用 MySQL。我在 C: 上安装了我所有的“重要”工具，即 VS2008，其余的东西在 D: 中，因为我更喜欢为我的 VS2008 提供最大性能。就像其他人提到的那样，屏幕尺寸是一个相当大的限制因素，所以我在 8 时使用 ProFont，缩小了默认窗口的 UI，也不要忘记关闭主题。

性能方面，CPU 运行良好，但 SSD 读/写速度是一个因素。我进行了基准测试，读取速度约为 30MB/s，写入速度略高于 10MB/s。当我尝试加载多个应用程序时，或者当 VS2008 忙于某些事情时，甚至加载记事本都需要更长的时间，所以我有点练习耐心并一次加载一个东西（在我的桌面上，我永远不能等待在 1 个镜头中加载所有内容）。我有 2GB 的 RAM，一直试图为磁盘缓存分配更多的 ram，但仍然没有取得任何成果。

我用它来进行现场故障排除和轻微修饰，或者每当我外出时，以及在旅行时观看我最喜欢的 CSI ：P。无论如何，我得到这个的主要原因是因为它的**电池运行时间，7小时**。我怀疑你能找到另一个可以匹配它的像样的笔记本。它产生的热量很少，所以它可以在我的腿上玩得很好，而且待机也非常无缝。我广泛使用待机，甚至让它待机好几天。电池每天仅下降约 10%。我可以坐下来处理我的程序，下一分钟关闭我的笔记本并移动到下一个位置，而不用担心它不会进入待机状态（即使它没有待机，它仍然可以持续到下一次打开它起来，而不是一路烧袋）

在获得 EEE PC 之前，我确实研究了 Acer AspireOne，AspireOne 确实有更宽的键盘，更容易打字，但触摸板和电池让我失望。在决定使用 EEE PC 之前，我也一直在考虑各种 12 英寸笔记本电脑，因为我曾经拥有 4 年的 12 英寸笔记本电脑。但是 12 英寸没有那么多汁液让我工作超过 2 小时。那些可以运行 4 小时的太贵了。

有一次我比平时早到了客户办公室，早上9点开始写笔记本，我去吃午饭的时候一直待着，然后一直工作到晚上5点，当所有人都离开时，我仍然我的电池还剩 20%。知道了这一点，我什至可以将电源适配器留在酒店，然后随身携带一个小袋子。华硕一路走好

编辑：对于错误信息的家伙，我很抱歉，我没有意识到我的 Eee PC 上只有没有 SP1 的 VS2008。直到 Menelmacar 和我一样才意识到“困难”。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-05T00:31:45.097

我会推荐除了华硕 EEE 以外的东西，它们太小了“上网本”而且屏幕分辨率很糟糕。

[HP Mini Note](http://www.buy.com/prod/hp-business-notebook-2133-mini-note-pc-8-9-wxga-display-via-c7-m-ulv-1/q/loc/101/207955124.html)有一个漂亮的8.9 英寸显示屏，几乎是全尺寸键盘，最重要的是有一个可以做 1280 x 768 的显示屏，尽管你可能需要稍微调整一下字体大小。:)

您还可以选择[Acer Aspire One](http://www.buy.com/prod/acer-aspire-one-a150-1006-atom-n270-1-6-ghz-ram-1-gb-hdd-120-gb-gma/q/loc/101/208344721.html)，它似乎是一款价格低廉的更好的上网本。

如果你用谷歌搜索任何其他上网本，你会发现很多评论，如果你打开 YouTube，你会发现很多视频评论。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-05T00:31:04.643

我认为700系列只是一只狗。900 系列将是一个更好的选择，它具有更大的屏幕和更快的 RAM（但使用相同的处理器），但它仍然不适用于 Visual Studio 2008。我发现 VS 在我的 12 英寸平板电脑上显得局促。

看看戴尔 Inspiron Mini。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-10T23:38:56.970

我设法在我的eee pc 901 附带的XP 上安装了Visual Web Developer，但C 驱动器上还剩下1.3Gb。

1.  首先，我在 VWD 需要进行安装的 C 驱动器上获得了所需的 1.4gb 免费空间，我按照此处的说明进行操作... [http://forum.eeeuser.com/viewtopic.php?id=40356](http://forum.eeeuser.com/viewtopic.php?id=40356)（ Windows 安装程序/microsoft.net 目录的“创建连接”步骤可节省大量空间）
2.  我从这里下载了“离线”Visual Studio ISO（位于下载页面底部）...... [http://www.microsoft.com/express/download/](http://www.microsoft.com/express/download/)
3.  然后我从这个 ISO 安装了 VWD，记得选择 C ​​盘以外的安装位置！

安装完成后，C 盘实际上只使用了大约 200mb-300mb。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-06T07:22:37.263

哇，我刚刚安装了 .net 3.5，磁盘需求降到了 1090MB。希望我能够在不重新安装和更改程序文件路径的情况下安装 SP1。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-05T00:39:46.233

我认为这在很大程度上取决于您项目的规模。一个小项目可能不会有太多麻烦。但是一个大型项目可能会让事情陷入困境。我已经看到我在 VS.Net 2008 上的工作项目本身就吃掉了 350 MB pf RAM。不计算加载操作系统和实际运行项目。此外，您可能会通过在其上安装 Visual Studio 来占用大量硬盘空间。EEE 上没有太多空间，除非您打算使用某种外部 USB 硬盘。

就个人而言，我会推荐一台更真实的笔记本电脑。你可以买到[便宜又小](http://www.bestbuy.com/site/olspage.jsp?skuId=9052945&type=product&id=1218012528210)的东西，最后你可能会更快乐。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-06T07:04:29.500

I am just trying to install SP1 and it seems that I will not be successfull. So you think that pointing Program Files to the D drive will force the installer to use drive D: for service pack installation? Currently, I have 1 GB free on drive C but the installation needs 1,9 although Visual Studio is installed to the D drive. You can see details about the installation here: [http://blogs.msdn.com/heaths/archive/2008/07/24/why-windows-installer-may-require-so-much-disk-space.aspx](http://blogs.msdn.com/heaths/archive/2008/07/24/why-windows-installer-may-require-so-much-disk-space.aspx) .

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-05T00:46:29.980

[http://www.hardforum.com/showthread.php?t=1303682](http://www.hardforum.com/showthread.php?t=1303682)

好像其他人都试过了，都在抱怨屏幕分辨率，但出乎意料的不是CPU。不用说，我不想打开所有面板/想主要将它用于开发机器，我只是希望尽可能选择这样做。

我正在看一个 700 系列，如果它有效，那就是奖金，如果它没有，我可能只需要考虑使用 SharpDevelop（我是一个没有太多钱的学生，所以它真的需要预算.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-07T12:09:24.000

好吧，它有效！所以 - 如果您在应用 VS2008 SP1 时磁盘空间不足（需要 1.9GB），请先尝试安装 .net 3.5。我还建议从 ISO 包安装它（即，您不需要下载安装程序文件）。

我对性能感到非常惊讶——我用五个 DLL 项目编译了一个网站，还启动了 SQL 和开发人员 Web 服务器，它真的很棒。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-25T12:39:23.357

只是一个可能适用的想法或替代建议......

我经常在我的 eeePC 上使用 Visual Studio，没有任何问题。诀窍是我只需访问另一台远程运行 Visual Studio 的机器来执行此操作。这让我拥有上网本的便利性和便携性，以及真实开发环境的全面计算能力。

显然，如果您没有连接，这将不起作用，但对我来说这是一个理想的设置..

# javascript - 如何动态合并两个 JavaScript 对象的属性？

> ID：171251
> 
> 赞同：2959
> 
> 时间：2008-10-05T00:30:54.833
> 
> 标签：javascript, javascript-objects

我需要能够在运行时合并两个（非常简单的）JavaScript 对象。例如我想：

```
var obj1 = { food: 'pizza', car: 'ford' }
var obj2 = { animal: 'dog' }

obj1.merge(obj2);

//obj1 now has three properties: food, car, and animal 
```

有没有内置的方法来做到这一点？我不需要递归，也不需要合并函数，只需要平面对象上的方法。

* * *

## 回答 #1

> 赞同：3579
> 
> 时间：2008-10-05T00:33:25.077

**ECMAScript 2018 标准方法**

您将使用[对象传播](https://github.com/tc39/proposal-object-rest-spread)：

```
let merged = {...obj1, ...obj2}; 
```

`merged`现在是 和 的`obj1`并集`obj2`。中的属性`obj2`将覆盖`obj1`.

```
/** There's no limit to the number of objects you can merge.
 *  Later properties overwrite earlier properties with the same name. */
const allRules = {...obj1, ...obj2, ...obj3}; 
```

这里也是这个语法的[MDN 文档](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax)。如果你使用 babel，你需要[babel-plugin-transform-object-rest-spread](https://babeljs.io/docs/en/babel-plugin-transform-object-rest-spread.html)插件才能工作。

**ECMAScript 2015 (ES6) 标准方法**

```
/* For the case in question, you would do: */
Object.assign(obj1, obj2);

/** There's no limit to the number of objects you can merge.
 *  All objects get merged into the first object. 
 *  Only the object in the first argument is mutated and returned.
 *  Later properties overwrite earlier properties with the same name. */
const allRules = Object.assign({}, obj1, obj2, obj3, etc); 
```

（见[MDN JavaScript 参考](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign#Browser_compatibility)）

* * *

**ES5 及更早版本的方法**

```
for (var attrname in obj2) { obj1[attrname] = obj2[attrname]; } 
```

请注意，如果您仍想使用未修改`obj2`的.`obj1``obj1`

如果你使用的框架在你的原型上都是废话，那么你必须通过类似的检查来获得更好的检查`hasOwnProperty`，但该代码将适用于 99% 的情况。

示例函数：

```
/**
 * Overwrites obj1's values with obj2's and adds obj2's if non existent in obj1
 * @param obj1
 * @param obj2
 * @returns obj3 a new object based on obj1 and obj2
 */
function merge_options(obj1,obj2){
    var obj3 = {};
    for (var attrname in obj1) { obj3[attrname] = obj1[attrname]; }
    for (var attrname in obj2) { obj3[attrname] = obj2[attrname]; }
    return obj3;
} 
```

* * *

## 回答 #2

> 赞同：1226
> 
> 时间：2008-10-05T03:56:40.673

jQuery 也为此提供了一个实用程序：[http](http://api.jquery.com/jQuery.extend/) ://api.jquery.com/jQuery.extend/ 。

取自 jQuery 文档：

```
// Merge options object into settings object
var settings = { validate: false, limit: 5, name: "foo" };
var options  = { validate: true, name: "bar" };
jQuery.extend(settings, options);

// Now the content of settings object is the following:
// { validate: true, limit: 5, name: "bar" } 
```

上面的代码将**改变**名为*`settings`*.

* * *

如果你想创建一个**新对象**而不修改任何一个参数，使用这个：

```
var defaults = { validate: false, limit: 5, name: "foo" };
var options = { validate: true, name: "bar" };

/* Merge defaults and options, without modifying defaults */
var settings = $.extend({}, defaults, options);

// The content of settings variable is now the following:
// {validate: true, limit: 5, name: "bar"}
// The 'defaults' and 'options' variables remained the same. 
```

* * *

## 回答 #3

> 赞同：374
> 
> 时间：2014-10-05T19:14:36.653

[Harmony ECMAScript 2015 (ES6)](http://www.ecma-international.org/ecma-262/6.0/#sec-object.assign)指定[**`Object.assign`**](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)了执行此操作的程序。

```
Object.assign(obj1, obj2); 
```

当前的浏览器支持[越来越好](http://kangax.github.io/compat-table/es6/#test-Object_static_methods_Object.assign)，但是如果您正在为不支持的浏览器进行开发，您可以使用[polyfill](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign#Polyfill)。

* * *

## 回答 #4

> 赞同：284
> 
> 时间：2008-12-20T12:05:47.297

我搜索了合并对象属性的代码并最终到了这里。但是，由于没有任何用于递归合并的代码，我自己编写了它。（也许 jQuery 扩展是递归 BTW？）无论如何，希望其他人也会发现它也很有用。

（现在代码不使用`Object.prototype`:)

## 代码

```
/*
* Recursively merge properties of two objects 
*/
function MergeRecursive(obj1, obj2) {

  for (var p in obj2) {
    try {
      // Property in destination object set; update its value.
      if ( obj2[p].constructor==Object ) {
        obj1[p] = MergeRecursive(obj1[p], obj2[p]);

      } else {
        obj1[p] = obj2[p];

      }

    } catch(e) {
      // Property in destination object not set; create it and set its value.
      obj1[p] = obj2[p];

    }
  }

  return obj1;
} 
```

## 一个例子

```
o1 = {  a : 1,
        b : 2,
        c : {
          ca : 1,
          cb : 2,
          cc : {
            cca : 100,
            ccb : 200 } } };

o2 = {  a : 10,
        c : {
          ca : 10,
          cb : 20, 
          cc : {
            cca : 101,
            ccb : 202 } } };

o3 = MergeRecursive(o1, o2); 
```

**产生像 o3 这样的对象**

```
o3 = {  a : 10,
        b : 2,
        c : {
          ca : 10,
          cb : 20,
          cc : { 
            cca : 101,
            ccb : 202 } } }; 
```

* * *

## 回答 #5

> 赞同：178
> 
> 时间：2012-02-19T11:44:52.633

请注意，[`underscore.js`](http://underscorejs.org/)'s [`extend`-method](http://underscorejs.org/#extend)在单行中执行此操作：

```
_.extend({name : 'moe'}, {age : 50});
=> {name : 'moe', age : 50} 
```

* * *

## 回答 #6

> 赞同：83
> 
> 时间：2014-01-27T21:00:57.983

与 jQuery extend() 类似，您在[AngularJS](http://en.wikipedia.org/wiki/AngularJS)中具有相同的功能：

```
// Merge the 'options' object into the 'settings' object
var settings = {validate: false, limit: 5, name: "foo"};
var options  = {validate: true, name: "bar"};
angular.extend(settings, options); 
```

* * *

## 回答 #7

> 赞同：66
> 
> 时间：2011-12-24T15:09:55.837

我今天需要合并对象，这个问题（和答案）对我帮助很大。我尝试了一些答案，但没有一个适合我的需要，所以我结合了一些答案，自己添加了一些东西，并想出了一个新的合并功能。这里是：

```
var merge = function() {
    var obj = {},
        i = 0,
        il = arguments.length,
        key;
    for (; i < il; i++) {
        for (key in arguments[i]) {
            if (arguments[i].hasOwnProperty(key)) {
                obj[key] = arguments[i][key];
            }
        }
    }
    return obj;
}; 
```

一些示例用法：

```
var t1 = {
    key1: 1,
    key2: "test",
    key3: [5, 2, 76, 21]
};
var t2 = {
    key1: {
        ik1: "hello",
        ik2: "world",
        ik3: 3
    }
};
var t3 = {
    key2: 3,
    key3: {
        t1: 1,
        t2: 2,
        t3: {
            a1: 1,
            a2: 3,
            a4: [21, 3, 42, "asd"]
        }
    }
};

console.log(merge(t1, t2));
console.log(merge(t1, t3));
console.log(merge(t2, t3));
console.log(merge(t1, t2, t3));
console.log(merge({}, t1, { key1: 1 })); 
```

* * *

## 回答 #8

> 赞同：60
> 
> 时间：2017-01-27T09:55:11.533

您可以使用[对象扩展语法](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax)来实现这一点。它是 ES2018 及更高版本的一部分。

```
const obj1 = { food: 'pizza', car: 'ford' };
const obj2 = { animal: 'dog' };

const obj3 = { ...obj1, ...obj2 };
console.log(obj3);
```

* * *

## 回答 #9

> 赞同：41
> 
> 时间：2008-12-21T13:02:01.270

应该修改给定的解决方案以在分配之前检查`source.hasOwnProperty(property)`循环`for..in`- 否则，您最终会复制整个原型链的属性，这很少需要......

* * *

## 回答 #10

> 赞同：41
> 
> 时间：2015-12-15T16:59:21.563

# 在一行代码中合并 N 个对象的属性

`Object.assign`方法是 ECMAScript 2015 (ES6) 标准的一部分，完全符合您的需要。（`IE`不支持）

```
var clone = Object.assign({}, obj); 
```

> Object.assign() 方法用于将所有可枚举自身属性的值从一个或多个源对象复制到目标对象。

[阅读更多...](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)

支持旧浏览器的**polyfill ：**

```
if (!Object.assign) {
  Object.defineProperty(Object, 'assign', {
    enumerable: false,
    configurable: true,
    writable: true,
    value: function(target) {
      'use strict';
      if (target === undefined || target === null) {
        throw new TypeError('Cannot convert first argument to object');
      }

      var to = Object(target);
      for (var i = 1; i < arguments.length; i++) {
        var nextSource = arguments[i];
        if (nextSource === undefined || nextSource === null) {
          continue;
        }
        nextSource = Object(nextSource);

        var keysArray = Object.keys(nextSource);
        for (var nextIndex = 0, len = keysArray.length; nextIndex < len; nextIndex++) {
          var nextKey = keysArray[nextIndex];
          var desc = Object.getOwnPropertyDescriptor(nextSource, nextKey);
          if (desc !== undefined && desc.enumerable) {
            to[nextKey] = nextSource[nextKey];
          }
        }
      }
      return to;
    }
  });
} 
```

* * *

## 回答 #11

> 赞同：36
> 
> 时间：2015-01-30T00:59:48.303

以下两个可能是一个很好的起点。lodash 还具有针对那些特殊需求的定制器功能！

`_.extend`( [http://underscorejs.org/#extend](http://underscorejs.org/#extend) )
`_.merge`( [https://lodash.com/docs#merge](https://lodash.com/docs#merge) )

* * *

## 回答 #12

> 赞同：30
> 
> 时间：2013-04-23T20:45:20.060

这是我的刺

1.  支持深度合并
2.  不改变参数
3.  接受任意数量的参数
4.  不扩展对象原型
5.  不依赖于其他库（[jQuery](http://en.wikipedia.org/wiki/JQuery)、[MooTools](http://en.wikipedia.org/wiki/MooTools)、[Underscore.js](https://en.wikipedia.org/wiki/Underscore.js)等）
6.  包括检查 hasOwnProperty
7.  是短 ：）

    ```
    /*
        Recursively merge properties and return new object
        obj1 &lt;- obj2 [ &lt;- ... ]
    */
    function merge () {
        var dst = {}
            ,src
            ,p
            ,args = [].splice.call(arguments, 0)
        ;

        while (args.length > 0) {
            src = args.splice(0, 1)[0];
            if (toString.call(src) == '[object Object]') {
                for (p in src) {
                    if (src.hasOwnProperty(p)) {
                        if (toString.call(src[p]) == '[object Object]') {
                            dst[p] = merge(dst[p] || {}, src[p]);
                        } else {
                            dst[p] = src[p];
                        }
                    }
                }
            }
        }

       return dst;
    } 
    ```

例子：

```
a = {
    "p1": "p1a",
    "p2": [
        "a",
        "b",
        "c"
    ],
    "p3": true,
    "p5": null,
    "p6": {
        "p61": "p61a",
        "p62": "p62a",
        "p63": [
            "aa",
            "bb",
            "cc"
        ],
        "p64": {
            "p641": "p641a"
        }
    }
};

b = {
    "p1": "p1b",
    "p2": [
        "d",
        "e",
        "f"
    ],
    "p3": false,
    "p4": true,
    "p6": {
        "p61": "p61b",
        "p64": {
            "p642": "p642b"
        }
    }
};

c = {
    "p1": "p1c",
    "p3": null,
    "p6": {
        "p62": "p62c",
        "p64": {
            "p643": "p641c"
        }
    }
};

d = merge(a, b, c);

/*
    d = {
        "p1": "p1c",
        "p2": [
            "d",
            "e",
            "f"
        ],
        "p3": null,
        "p5": null,
        "p6": {
            "p61": "p61b",
            "p62": "p62c",
            "p63": [
                "aa",
                "bb",
                "cc"
            ],
            "p64": {
                "p641": "p641a",
                "p642": "p642b",
                "p643": "p641c"
            }
        },
        "p4": true
    };
*/ 
```

* * *

## 回答 #13

> 赞同：29
> 
> 时间：2012-09-19T12:58:10.390

顺便说一句，你们所做的是覆盖属性，而不是合并......

这就是 JavaScript 对象区域真正合并的方式：只有`to`对象本身不是对象的键才会被`from`. 其他一切都将***真正合并***。当然，您可以更改此行为以不覆盖仅存在的任何内容，例如 if`to[n] is undefined`等...：

```
var realMerge = function (to, from) {

    for (n in from) {

        if (typeof to[n] != 'object') {
            to[n] = from[n];
        } else if (typeof from[n] == 'object') {
            to[n] = realMerge(to[n], from[n]);
        }
    }
    return to;
}; 
```

用法：

```
var merged = realMerge(obj1, obj2); 
```

* * *

## 回答 #14

> 赞同：20
> 
> 时间：2015-11-16T16:35:04.607

**对象.assign()**

**ECMAScript 2015 (ES6)**

这是一项新技术，是 ECMAScript 2015 (ES6) 标准的一部分。该技术的规范已经最终确定，但请查看兼容性表以了解各种浏览器中的使用情况和实施情况。

Object.assign() 方法用于将所有可枚举自身属性的值从一个或多个源对象复制到目标对象。它将返回目标对象。

```
var o1 = { a: 1 };
var o2 = { b: 2 };
var o3 = { c: 3 };

var obj = Object.assign(o1, o2, o3);
console.log(obj); // { a: 1, b: 2, c: 3 }
console.log(o1);  // { a: 1, b: 2, c: 3 }, target object itself is changed. 
```

* * *

## 回答 #15

> 赞同：19
> 
> 时间：2010-02-26T19:13:58.743

对于不太复杂的对象，您可以使用[JSON](http://en.wikipedia.org/wiki/JSON)：

```
var obj1 = { food: 'pizza', car: 'ford' }
var obj2 = { animal: 'dog', car: 'chevy'}
var objMerge;

objMerge = JSON.stringify(obj1) + JSON.stringify(obj2);

// {"food": "pizza","car":"ford"}{"animal":"dog","car":"chevy"}

objMerge = objMerge.replace(/\}\{/, ","); //  \_ replace with comma for valid JSON

objMerge = JSON.parse(objMerge); // { food: 'pizza', animal: 'dog', car: 'chevy'}
// Of same keys in both objects, the last object's value is retained_/ 
```

请注意，在此示例中，“}{”***不得出现***在字符串中！

* * *

## 回答 #16

> 赞同：17
> 
> 时间：2014-06-22T21:02:47.060

[`deepmerge`](https://github.com/nrf110/deepmerge)在[GitHub 上](http://en.wikipedia.org/wiki/GitHub)有一个名为的库：这似乎受到了一些关注。它是独立的，可通过[npm](https://en.wikipedia.org/wiki/Npm_(software))和 bower 包管理器获得。

我倾向于使用或改进这一点，而不是从答案中复制粘贴代码。

* * *

## 回答 #17

> 赞同：16
> 
> 时间：2010-11-09T22:09:35.300

执行此操作的最佳方法是使用 Object.defineProperty 添加一个不可枚举的正确属性。

这样，您仍然可以迭代您的对象属性，而无需使用 Object.prototype.extend 创建属性时获得的新创建的“扩展”。

希望这会有所帮助：

```
Object.defineProperty（Object.prototype，“扩展”，{
    可枚举：假，
    值：函数（来自）{
        var props = Object.getOwnPropertyNames(from);
        var dest = 这个；
        props.forEach（函数（名称）{
            如果（目标中的名称）{
                var destination = Object.getOwnPropertyDescriptor(from, name);
                Object.defineProperty(dest, name, destination);
            }
        });
        返回这个；
    }
});

```

一旦你有这个工作，你可以这样做：

```
变量 obj = {
    名称：'堆栈'，
    完成：'溢出'
}
变量替换 = {
    名称：'库存'
};

obj.extend（替换）；

```

我刚刚在这里写了一篇关于它的博客文章：http: [//onemoredigit.com/post/1527191998/extending-objects-in-node-js](http://onemoredigit.com/post/1527191998/extending-objects-in-node-js)

* * *

## 回答 #18

> 赞同：15
> 
> 时间：2008-10-05T00:36:01.983

[原型](http://en.wikipedia.org/wiki/Prototype_JavaScript_Framework)有这个：

```
Object.extend = function(destination,source) {
    for (var property in source)
        destination[property] = source[property];
    return destination;
} 
```

`obj1.extend(obj2)`会做你想做的。

* * *

## 回答 #19

> 赞同：15
> 
> 时间：2015-08-31T06:51:16.670

你可以简单地使用 jQuery**`extend`**

```
var obj1 = { val1: false, limit: 5, name: "foo" };
var obj2 = { val2: true, name: "bar" };

jQuery.extend(obj1, obj2); 
```

现在包含和`obj1`的所有值`obj1``obj2`

* * *

## 回答 #20

> 赞同：13
> 
> 时间：2018-03-20T21:41:44.883

`Object.assign`**使用扩展运算符很​​简单合并对象`...`**

```
var obj1 = { food: 'pizza', car: 'ford' }
var obj2 = { animal: 'dog', car: 'BMW' }
var obj3 = {a: "A"}

var mergedObj = Object.assign(obj1,obj2,obj3)
 // or using the Spread operator (...)
var mergedObj = {...obj1,...obj2,...obj3}

console.log(mergedObj);
```

对象从右到左合并，这意味着与右侧对象具有相同属性的对象将被覆盖。

在这个例子中`obj2.car`覆盖`obj1.car`

* * *

## 回答 #21

> 赞同：13
> 
> 时间：2018-05-01T18:44:14.177

哇.. 这是我看到的第一个包含多个页面的 StackOverflow 帖子。抱歉添加另一个“答案”

### ES5 及更早版本

此方法适用于*ES5 及更早版本*- 还有很多其他解决 ES6 的答案。

我没有看到任何使用该属性合并的*“深层”*[`arguments`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/arguments)对象。这是我的答案 - **compact** & **recursive**，允许传递无限的对象参数：

```
function extend() {
    for (var o = {}, i = 0; i < arguments.length; i++) {
        // Uncomment to skip arguments that are not objects (to prevent errors)
        // if (arguments[i].constructor !== Object) continue;
        for (var k in arguments[i]) {
            if (arguments[i].hasOwnProperty(k)) {
                o[k] = arguments[i][k].constructor === Object
                    ? extend(o[k] || {}, arguments[i][k])
                    : arguments[i][k];
            }
        }
    }
    return o;
} 
```

### 例子

```
/**
 * Extend objects
 */
function extend() {
    for (var o = {}, i = 0; i < arguments.length; i++) {
        for (var k in arguments[i]) {
            if (arguments[i].hasOwnProperty(k)) {
                o[k] = arguments[i][k].constructor === Object
                    ? extend(o[k] || {}, arguments[i][k])
                    : arguments[i][k];
            }
        }
    }
    return o;
}

/**
 * Example
 */
document.write(JSON.stringify(extend({
    api: 1,
    params: {
        query: 'hello'
    }
}, {
    params: {
        query: 'there'
    }
})));
// outputs {"api": 1, "params": {"query": "there"}}
```

*这个答案现在不过是沧海一粟……*

* * *

## 回答 #22

> 赞同：12
> 
> 时间：2012-04-19T21:23:04.890

就像有人在使用[Google Closure Library](http://closure-library.googlecode.com/svn/docs/closure_goog_object_object.js.html)一样：

```
goog.require('goog.object');
var a = {'a': 1, 'b': 2};
var b = {'b': 3, 'c': 4};
goog.object.extend(a, b);
// Now object a == {'a': 1, 'b': 3, 'c': 4}; 
```

[数组存在类似的辅助函数](http://closure-library.googlecode.com/svn/docs/closure_goog_array_array.js.html)：

```
var a = [1, 2];
var b = [3, 4];
goog.array.extend(a, b); // Extends array 'a'
goog.array.concat(a, b); // Returns concatenation of array 'a' and 'b' 
```

* * *

## 回答 #23

> 赞同：11
> 
> 时间：2011-04-02T11:49:39.893

我扩展了 David Coallier 的方法：

*   添加了合并多个对象的可能性
*   支持深层对象
*   覆盖参数（如果最后一个参数是布尔值，则检测到该参数）

如果 override 为 false，则不会覆盖任何属性，但将添加新属性。

用法：obj.merge(merges... [, override]);

这是我的代码：

```
Object.defineProperty(Object.prototype, "merge", {
    enumerable: false,
    value: function () {
        var override = true,
            dest = this,
            len = arguments.length,
            props, merge, i, from;

        if (typeof(arguments[arguments.length - 1]) === "boolean") {
            override = arguments[arguments.length - 1];
            len = arguments.length - 1;
        }

        for (i = 0; i < len; i++) {
            from = arguments[i];
            if (from != null) {
                Object.getOwnPropertyNames(from).forEach(function (name) {
                    var descriptor;

                    // nesting
                    if ((typeof(dest[name]) === "object" || typeof(dest[name]) === "undefined")
                            && typeof(from[name]) === "object") {

                        // ensure proper types (Array rsp Object)
                        if (typeof(dest[name]) === "undefined") {
                            dest[name] = Array.isArray(from[name]) ? [] : {};
                        }
                        if (override) {
                            if (!Array.isArray(dest[name]) && Array.isArray(from[name])) {
                                dest[name] = [];
                            }
                            else if (Array.isArray(dest[name]) && !Array.isArray(from[name])) {
                                dest[name] = {};
                            }
                        }
                        dest[name].merge(from[name], override);
                    } 

                    // flat properties
                    else if ((name in dest && override) || !(name in dest)) {
                        descriptor = Object.getOwnPropertyDescriptor(from, name);
                        if (descriptor.configurable) {
                            Object.defineProperty(dest, name, descriptor);
                        }
                    }
                });
            }
        }
        return this;
    }
}); 
```

示例和测试用例：

```
function clone (obj) {
    return JSON.parse(JSON.stringify(obj));
}
var obj = {
    name : "trick",
    value : "value"
};

var mergeObj = {
    name : "truck",
    value2 : "value2"
};

var mergeObj2 = {
    name : "track",
    value : "mergeObj2",
    value2 : "value2-mergeObj2",
    value3 : "value3"
};

assertTrue("Standard", clone(obj).merge(mergeObj).equals({
    name : "truck",
    value : "value",
    value2 : "value2"
}));

assertTrue("Standard no Override", clone(obj).merge(mergeObj, false).equals({
    name : "trick",
    value : "value",
    value2 : "value2"
}));

assertTrue("Multiple", clone(obj).merge(mergeObj, mergeObj2).equals({
    name : "track",
    value : "mergeObj2",
    value2 : "value2-mergeObj2",
    value3 : "value3"
}));

assertTrue("Multiple no Override", clone(obj).merge(mergeObj, mergeObj2, false).equals({
    name : "trick",
    value : "value",
    value2 : "value2",
    value3 : "value3"
}));

var deep = {
    first : {
        name : "trick",
        val : "value"
    },
    second : {
        foo : "bar"
    }
};

var deepMerge = {
    first : {
        name : "track",
        anotherVal : "wohoo"
    },
    second : {
        foo : "baz",
        bar : "bam"
    },
    v : "on first layer"
};

assertTrue("Deep merges", clone(deep).merge(deepMerge).equals({
    first : {
        name : "track",
        val : "value",
        anotherVal : "wohoo"
    },
    second : {
        foo : "baz",
        bar : "bam"
    },
    v : "on first layer"
}));

assertTrue("Deep merges no override", clone(deep).merge(deepMerge, false).equals({
    first : {
        name : "trick",
        val : "value",
        anotherVal : "wohoo"
    },
    second : {
        foo : "bar",
        bar : "bam"
    },
    v : "on first layer"
}));

var obj1 = {a: 1, b: "hello"};
obj1.merge({c: 3});
assertTrue(obj1.equals({a: 1, b: "hello", c: 3}));

obj1.merge({a: 2, b: "mom", d: "new property"}, false);
assertTrue(obj1.equals({a: 1, b: "hello", c: 3, d: "new property"}));

var obj2 = {};
obj2.merge({a: 1}, {b: 2}, {a: 3});
assertTrue(obj2.equals({a: 3, b: 2}));

var a = [];
var b = [1, [2, 3], 4];
a.merge(b);
assertEquals(1, a[0]);
assertEquals([2, 3], a[1]);
assertEquals(4, a[2]);

var o1 = {};
var o2 = {a: 1, b: {c: 2}};
var o3 = {d: 3};
o1.merge(o2, o3);
assertTrue(o1.equals({a: 1, b: {c: 2}, d: 3}));
o1.b.c = 99;
assertTrue(o2.equals({a: 1, b: {c: 2}}));

// checking types with arrays and objects
var bo;
a = [];
bo = [1, {0:2, 1:3}, 4];
b = [1, [2, 3], 4];

a.merge(b);
assertTrue("Array stays Array?", Array.isArray(a[1]));

a = [];
a.merge(bo);
assertTrue("Object stays Object?", !Array.isArray(a[1]));

a = [];
a.merge(b);
a.merge(bo);
assertTrue("Object overrides Array", !Array.isArray(a[1]));

a = [];
a.merge(b);
a.merge(bo, false);
assertTrue("Object does not override Array", Array.isArray(a[1]));

a = [];
a.merge(bo);
a.merge(b);
assertTrue("Array overrides Object", Array.isArray(a[1]));

a = [];
a.merge(bo);
a.merge(b, false);
assertTrue("Array does not override Object", !Array.isArray(a[1])); 
```

我的 equals 方法可以在这里找到：[JavaScript 中的对象比较](https://stackoverflow.com/questions/1068834/object-comparison-in-javascript/5522917#5522917)

* * *

## 回答 #24

> 赞同：10
> 
> 时间：2009-07-31T20:06:38.167

在[MooTools](http://en.wikipedia.org/wiki/MooTools)中，有[Object.merge()](http://mootools.net/docs/core/Types/Object#Object:Object-merge)：

```
Object.merge(obj1, obj2); 
```

* * *

## 回答 #25

> 赞同：9
> 
> 时间：2011-07-22T08:50:53.740

在[Ext JS](http://en.wikipedia.org/wiki/Ext_JS) 4 中，它可以按如下方式完成：

```
var mergedObject = Ext.Object.merge(object1, object2)

// Or shorter:
var mergedObject2 = Ext.merge(object1, object2) 
```

请参阅*[合并（对象）：对象](http://docs.sencha.com/ext-js/4-0/#/api/Ext.Object-method-merge)*。

* * *

## 回答 #26

> 赞同：8
> 
> 时间：2018-09-18T01:55:43.813

```
var obj1 = { food: 'pizza', car: 'ford' }
var obj2 = { animal: 'dog' }

// result
result: {food: "pizza", car: "ford", animal: "dog"} 
```

**使用 jQuery.extend()** -[链接](https://api.jquery.com/jquery.extend/)

```
// Merge obj1 & obj2 to result
var result1 = $.extend( {}, obj1, obj2 ); 
```

**使用 _.merge()** -[链接](https://lodash.com/docs/4.17.10#merge)

```
// Merge obj1 & obj2 to result
var result2 = _.merge( {}, obj1, obj2 ); 
```

**使用 _.extend()** -[链接](https://underscorejs.org/#extend)

```
// Merge obj1 & obj2 to result
var result3 = _.extend( {}, obj1, obj2 ); 
```

**使用 Object.assign() ECMAScript 2015 (ES6)** -[链接](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign)

```
// Merge obj1 & obj2 to result
var result4 = Object.assign( {}, obj1, obj2 ); 
```

全部输出

```
obj1: { animal: 'dog' }
obj2: { food: 'pizza', car: 'ford' }
result1: {food: "pizza", car: "ford", animal: "dog"}
result2: {food: "pizza", car: "ford", animal: "dog"}
result3: {food: "pizza", car: "ford", animal: "dog"}
result4: {food: "pizza", car: "ford", animal: "dog"} 
```

* * *

## 回答 #27

> 赞同：7
> 
> 时间：2012-01-06T21:47:46.357

基于[Markus](https://stackoverflow.com/questions/171251/how-can-i-merge-properties-of-two-javascript-objects-dynamically/383245#383245)和[vsync 的回答](https://stackoverflow.com/questions/171251/how-can-i-merge-properties-of-two-javascript-objects-dynamically/7965071#7965071)，这是一个扩展版本。该函数接受任意数量的参数。它可用于在[DOM](http://en.wikipedia.org/wiki/Document_Object_Model)节点上设置属性并制作值的深层副本。但是，第一个参数是通过引用给出的。

要检测 DOM 节点，使用 isDOMNode() 函数（请参阅 Stack Overflow 问题*[JavaScript isDOM — How do you check if a JavaScript Object is a DOM Object?](https://stackoverflow.com/a/8736129/1131084)*）

它在[Opera](http://en.wikipedia.org/wiki/Opera_%28web_browser%29) 11、Firefox 6、[Internet Explorer 8](http://en.wikipedia.org/wiki/Internet_Explorer_8)和 Google Chrome 16 中进行了测试。

## 代码

```
function mergeRecursive() {

  // _mergeRecursive does the actual job with two arguments.
  var _mergeRecursive = function (dst, src) {
    if (isDOMNode(src) || typeof src !== 'object' || src === null) {
      return dst;
    }

    for (var p in src) {
      if (!src.hasOwnProperty(p))
        continue;
      if (src[p] === undefined)
        continue;
      if ( typeof src[p] !== 'object' || src[p] === null) {
        dst[p] = src[p];
      } else if (typeof dst[p]!=='object' || dst[p] === null) {
        dst[p] = _mergeRecursive(src[p].constructor===Array ? [] : {}, src[p]);
      } else {
        _mergeRecursive(dst[p], src[p]);
      }
    }
    return dst;
  }

  // Loop through arguments and merge them into the first argument.
  var out = arguments[0];
  if (typeof out !== 'object' || out === null)
    return out;
  for (var i = 1, il = arguments.length; i < il; i++) {
    _mergeRecursive(out, arguments[i]);
  }
  return out;
} 
```

## 一些例子

设置 HTML 元素的 innerHTML 和样式

```
mergeRecursive(
  document.getElementById('mydiv'),
  {style: {border: '5px solid green', color: 'red'}},
  {innerHTML: 'Hello world!'}); 
```

合并数组和对象。请注意，未定义可用于保留左侧数组/对象中的值。

```
o = mergeRecursive({a:'a'}, [1,2,3], [undefined, null, [30,31]], {a:undefined, b:'b'});
// o = {0:1, 1:null, 2:[30,31], a:'a', b:'b'} 
```

任何不是 JavaScript 对象的参数（包括 null）都将被忽略。除了第一个参数，DOM 节点也被丢弃。请注意，像 new String() 这样创建的字符串实际上是对象。

```
o = mergeRecursive({a:'a'}, 1, true, null, undefined, [1,2,3], 'bc', new String('de'));
// o = {0:'d', 1:'e', 2:3, a:'a'} 
```

如果要将两个对象合并为一个新对象（不影响两者中的任何一个），请提供 {} 作为第一个参数

```
var a={}, b={b:'abc'}, c={c:'cde'}, o;
o = mergeRecursive(a, b, c);
// o===a is true, o===b is false, o===c is false 
```

**编辑**（由 ReaperSoon）：

也合并数组

```
function mergeRecursive(obj1, obj2) {
  if (Array.isArray(obj2)) { return obj1.concat(obj2); }
  for (var p in obj2) {
    try {
      // Property in destination object set; update its value.
      if ( obj2[p].constructor==Object ) {
        obj1[p] = mergeRecursive(obj1[p], obj2[p]);
      } else if (Array.isArray(obj2[p])) {
        obj1[p] = obj1[p].concat(obj2[p]);
      } else {
        obj1[p] = obj2[p];
      }
    } catch(e) {
      // Property in destination object not set; create it and set its value.
      obj1[p] = obj2[p];
    }
  }
  return obj1;
} 
```

* * *

## 回答 #28

> 赞同：5
> 
> 时间：2014-03-15T10:54:56.193

使用[Underscore.js](https://en.wikipedia.org/wiki/Underscore.js)，合并对象数组：

```
var arrayOfObjects = [ {a:1}, {b:2, c:3}, {d:4} ];
_(arrayOfObjects).reduce(function(memo, o) { return _(memo).extend(o); }); 
```

结果是：

```
Object {a: 1, b: 2, c: 3, d: 4} 
```

* * *

## 回答 #29

> 赞同：5
> 
> 时间：2015-12-22T11:02:49.647

你应该使用 lodash 的[defaultsDeep](https://lodash.com/docs#defaultsDeep)

```
_.defaultsDeep({ 'user': { 'name': 'barney' } }, { 'user': { 'name': 'fred', 'age': 36 } });
// → { 'user': { 'name': 'barney', 'age': 36 } } 
```

* * *

## 回答 #30

> 赞同：5
> 
> 时间：2019-01-17T11:30:02.960

```
let obj1 = {a:1, b:2};
let obj2 = {c:3, d:4};
let merged = {...obj1, ...obj2};
console.log(merged);
```

* * *

## 回答 #31

> 赞同：5
> 
> 时间：2019-11-13T22:24:30.023

看起来这应该是你所需要的：

```
var obj1 = { food: 'pizza', car: 'ford' }
var obj2 = { animal: 'dog' }

var obj3 = { ...obj1, ...obj2 } 
```

之后 obj3 现在应该具有以下值：

```
{food: "pizza", car: "ford", animal: "dog"} 
```

在这里尝试一下：

```
var obj1 = { food: 'pizza', car: 'ford' }
var obj2 = { animal: 'dog' }

var obj3 = { ...obj1, ...obj2 }

console.log(obj3);
```

* * *

## 回答 #32

> 赞同：4
> 
> 时间：2012-10-19T09:44:38.437

值得一提的是，[140bytes.es 集合](http://www.140byt.es/)中的版本正在最小空间内解决任务，为此值得一试：

代码：

```
function m(a,b,c){for(c in b)b.hasOwnProperty(c)&&((typeof a[c])[0]=='o'?m(a[c],b[c]):a[c]=b[c])} 
```

用于您的目的：

```
m(obj1,obj2); 
```

这是[原始 Gist](https://gist.github.com/988478)。

* * *

## 回答 #33

> 赞同：4
> 
> 时间：2019-03-14T06:55:09.473

**ES2018/TypeScript：很多答案都可以，但是当您需要合并两个对象而不覆盖重叠的对象键**时，我想出了一个更优雅的解决方案来解决这个问题。

我的函数还接受**无限数量的对象**作为函数参数合并：

*`:object[]`（我在这里使用 TypeScript 表示法，如果您使用纯 JavaScript ，请随意删除函数参数中的类型）。*

```
const merge = (...objects: object[]) => {
  return objects.reduce((prev, next) => {
    Object.keys(prev).forEach(key => {
      next[key] = { ...next[key], ...prev[key] }
    })
    return next
  })
} 
```

* * *

## 回答 #34

> 赞同：4
> 
> 时间：2020-01-11T12:59:01.493

> 使用遵循 ES6 版本的 Spread 运算符

```
var obj1 = { food: 'pizza', car: 'ford' }
var obj2 = { animal: 'dog' }
let result = {...obj1,...obj2};
console.log(result)

output { food: 'pizza', car: 'ford', animal: 'dog' } 
```

* * *

## 回答 #35

> 赞同：3
> 
> 时间：2019-12-26T06:32:46.017

你可以使用`Object.assign`方法。例如：

```
var result = Object.assign(obj1, obj2); 
```

另外，请注意，它会创建对象的浅表副本。

* * *

## 回答 #36

> 赞同：2
> 
> 时间：2011-07-09T14:53:06.697

采用：

```
//Takes any number of objects and returns one merged object
var objectMerge = function(){
    var out = {};
    if(!arguments.length)
        return out;
    for(var i=0; i<arguments.length; i++) {
        for(var key in arguments[i]){
            out[key] = arguments[i][key];
        }
    }
    return out;
} 
```

它经过以下测试：

```
console.log(objectMerge({a:1, b:2}, {a:2, c:4})); 
```

结果是：

```
{ a: 2, b: 2, c: 4 } 
```

* * *

## 回答 #37

> 赞同：2
> 
> 时间：2011-08-24T09:39:27.423

gossi 对 David Coallier 方法的扩展：

检查这两行：

```
from = arguments[i];
Object.getOwnPropertyNames(from).forEach(function (name) { 
```

需要针对空对象检查“来自”...例如，如果合并来自[Ajax](http://en.wikipedia.org/wiki/Ajax_%28programming%29)响应的对象，该对象之前在服务器上创建，则对象属性的值可以为“空”，在这种情况下，上述情况代码生成一个错误说：

> "from" 不是一个有效的对象

例如，用“if (from != null) { ... }”包装“...Object.getOwnPropertyNames(from).forEach...”函数将防止该错误发生。

* * *

## 回答 #38

> 赞同：2
> 
> 时间：2011-11-01T10:20:14.680

```
function extend(o, o1, o2){
    if( !(o instanceof Object) ) o = {};

    copy(o, o1);
    if( o2 )
        copy(o, o2)

    function isObject(obj) {
        var type = Object.prototype.toString.call(obj);
        return obj === Object(obj) && type != '[object Array]' && type != '[object Function]';
    };

    function copy(a,b){
        // copy o2 to o
        for( var key in b )
            if( b.hasOwnProperty(key) ){
                if( isObject(b[key]) ){
                    if( !isObject(a[key]) )
                        a[key] = Object.assign({}, b[key]); 
                    else copy(a[key], b[key])
                }
                else
                    a[key] = b[key];
            }
    }

    return o;
};

var o1 = {a:{foo:1}, b:1},
    o2 = {a:{bar:2}, b:[1], c:()=>{}},
    newMerged = extend({}, o1, o2);

console.log( newMerged )
console.log( o1 )
console.log( o2 )
```

* * *

## 回答 #39

> 赞同：2
> 
> 时间：2013-08-01T16:03:10.153

我的方式：

```
function mergeObjects(defaults, settings) {
    Object.keys(defaults).forEach(function(key_default) {
        if (typeof settings[key_default] == "undefined") {
            settings[key_default] = defaults[key_default];
        } else if (isObject(defaults[key_default]) && isObject(settings[key_default])) {
            mergeObjects(defaults[key_default], settings[key_default]);
        }
    });

    function isObject(object) {
        return Object.prototype.toString.call(object) === '[object Object]';
    }

    return settings;
} 
```

:)

* * *

## 回答 #40

> 赞同：2
> 
> 时间：2015-04-21T21:18:27.650

我使用纯 JavaScript 中的以下内容。它从最右边的参数开始，并将它们一直组合到第一个参数。没有返回值，只有第一个参数被修改，最左边的参数（除了第一个参数）具有最高的属性权重。

```
var merge = function() {
  var il = arguments.length;

  for (var i = il - 1; i > 0; --i) {
    for (var key in arguments[i]) {
      if (arguments[i].hasOwnProperty(key)) {
        arguments[0][key] = arguments[i][key];
      }
    }
  }
}; 
```

* * *

## 回答 #41

> 赞同：2
> 
> 时间：2019-12-23T08:03:33.653

**浅的**

```
var obj = { name : "Jacob" , address : ["America"] }
var obj2 = { name : "Shaun" , address : ["Honk Kong"] }

var merged = Object.assign({} , obj,obj2 ); //shallow merge 
obj2.address[0] = "new city" 
```

result.address[0] 更改为 "new city" ，即合并对象也更改。这就是浅合并的问题。

**深的**

```
var obj = { name : "Jacob" , address : ["America"] }
var obj2 = { name : "Shaun" , address : ["Honk Kong"] }

var result = Object.assign({} , JSON.parse(JSON.stringify(obj)),JSON.parse(JSON.stringify(obj2)) )

obj2.address[0] = "new city" 
```

result.address[0] 没有改变

* * *

## 回答 #42

> 赞同：2
> 
> 时间：2020-10-20T05:13:52.987

```
Object.assign(TargetObject, Obj1, Obj2, ...); 
```

* * *

## 回答 #43

> 赞同：1
> 
> 时间：2009-03-13T12:48:14.157

[Prototype](http://en.wikipedia.org/wiki/Prototype_JavaScript_Framework)中的正确实现应该是这样的：

```
var obj1 = {food: 'pizza', car: 'ford'}
var obj2 = {animal: 'dog'}

obj1 = Object.extend(obj1, obj2); 
```

* * *

## 回答 #44

> 赞同：1
> 
> 时间：2011-07-01T12:45:33.093

我有点开始使用 JavaScript，如果我错了，请纠正我。

但是如果你可以合并任意数量的对象不是更好吗？这是我使用本机`Arguments`对象的方法。

关键是您实际上可以将任意数量的参数传递给 JavaScript 函数，而无需在函数声明中定义它们。如果不使用 Arguments 对象，您将无法访问它们。

```
function mergeObjects() (
    var tmpObj = {};

    for(var o in arguments) {
        for(var m in arguments[o]) {
            tmpObj[m] = arguments[o][m];
        }
    }
    return tmpObj;
} 
```

* * *

## 回答 #45

> 赞同：1
> 
> 时间：2012-02-08T18:29:35.537

在[YUI](http://en.wikipedia.org/wiki/Yahoo!_UI_Library) [`Y.merge`](http://yuilibrary.com/yui/docs/yui/yui-merge.html)中应该完成工作：

```
Y.merge(obj1, obj2, obj3....) 
```

* * *

## 回答 #46

> 赞同：1
> 
> 时间：2013-12-04T16:42:20.597

我使用 Object.create() 来保留默认设置（使用 __proto__ 或 Object.getPrototypeOf() ）。

```
function myPlugin( settings ){
    var defaults = {
        "keyName": [ "string 1", "string 2" ]
    }
    var options = Object.create( defaults );
    for (var key in settings) { options[key] = settings[key]; }
}
myPlugin( { "keyName": ["string 3", "string 4" ] } ); 
```

这样我以后总是可以'concat（）'或'push（）'。

```
var newArray = options['keyName'].concat( options.__proto__['keyName'] ); 
```

**注意**：您需要在连接之前进行 hasOwnProperty 检查以避免重复。

* * *

## 回答 #47

> 赞同：1
> 
> 时间：2014-04-08T21:30:26.567

对于那些使用[Node.js](http://en.wikipedia.org/wiki/Node.js)的人，有一个 NPM 模块：[node.extend](https://www.npmjs.com/package/node.extend)

# 安装：

```
npm install node.extend 
```

# 用法：

```
var extend = require('node.extend');
var destObject = extend(true, {}, sourceObject);
// Where sourceObject is the object whose properties will be copied into another. 
```

* * *

## 回答 #48

> 赞同：1
> 
> 时间：2015-10-14T10:10:31.550

您可以按照我的方法合并对象

```
var obj1 = { food: 'pizza', car: 'ford' };
var obj2 = { animal: 'dog' };

var result = mergeObjects([obj1, obj2]);

console.log(result);
document.write("result: <pre>" + JSON.stringify(result, 0, 3) + "</pre>");

function mergeObjects(objectArray) {
    if (objectArray.length) {
        var b = "", i = -1;
        while (objectArray[++i]) {
            var str = JSON.stringify(objectArray[i]);
            b += str.slice(1, str.length - 1);
            if (objectArray[i + 1]) b += ",";
        }
        return JSON.parse("{" + b + "}");
    }
    return {};
}
```

* * *

## 回答 #49

> 赞同：1
> 
> 时间：2017-04-20T17:31:53.103

## JSON 兼容 JavaScript 对象的合并

我鼓励使用和利用不修改原始源的非破坏性方法，'Object.assign' 是一种*破坏性方法*，而且它也恰好对生产不太*友好*，因为它停止在早期浏览器上工作，你没有办法用另一种方法干净地修补它。

无论采用何种解决方案，合并 JS 对象总是遥不可及或不完整。但是，合并兼容 JSON 的兼容对象距离编写一段简单且可移植的代码仅一步之遥，该代码是一种将一系列 JS 对象合并到包含所有唯一属性名称及其在用于预期目的的单个主对象。

记住 MSIE8 是第一个添加了对 JSON 对象的本机支持的浏览器是一个很大的解脱，并且重用已经存在的技术总是一个受欢迎的机会。

将您的代码限制为 JSON 兼容标准对象比限制更有利，因为这些对象也可以通过 Internet 传输。当然，对于那些想要更深层次的向后兼容性的人来说，总有一个 json 插件。它的方法可以很容易地分配给外部代码中的 JSON 变量，而无需修改或重写正在使用的方法。

```
function Merge( ){
    var a = [].slice.call( arguments ), i = 0;
        while( a[i] )a[i] = JSON.stringify( a[i++] ).slice( 1,-1 );
        return JSON.parse( "{"+ a.join() +"}" );
    } 
```

（当然总可以给它起一个更有意义的名字，我还没决定；应该命名为 JSONmerge）

用例：

```
var master = Merge( obj1, obj2, obj3, ...objn ); 
```

现在，与`Object.assign`此相反，所有对象都保持不变并处于其原始状态（如果您做错了什么并且需要重新排序合并对象或能够在再次合并之前单独使用它们进行其他操作）。

合并参数的数量也*仅*受参数长度限制 [这是巨大的] 限制。原生支持的 JSON parse / stringify 已经过机器优化，这意味着：它应该比任何脚本形式的 JS 循环更快。对给定参数的迭代是使用`while`- 被证明是 JS 中最快的循环来完成的。

简单提一下我们已经知道唯一对象标签（键）的重复属性将被包含相同键标签的后续对象覆盖这一事实并没有什么坏处，这意味着您可以控制哪个属性正在接管通过简单地对参数列表进行排序或重新排序。以及获得干净和更新的主对象的好处，没有重复作为最终输出。

```
;
var obj1 = {a:1}, obj2 = {b:2}, obj3 = {c:3}
;
function Merge( ){
    var a = [].slice.call( arguments ), i = 0;
        while( a[i] )a[i] = JSON.stringify( a[i++] ).slice( 1,-1 );
        return JSON.parse( "{"+ a.join() +"}" );
    }
;
var master = Merge( obj1, obj2, obj3 )
;
console.log( JSON.stringify( master ) )
;
```

* * *

## 回答 #50

> 赞同：1
> 
> 时间：2017-04-24T18:29:34.010

ES5 兼容原生单行：

```
var merged = [obj1, obj2].reduce(function(a, o) { for(k in o) a[k] = o[k]; return a; }, {}) 
```

* * *

## 回答 #51

> 赞同：1
> 
> 时间：2018-11-07T13:16:06.043

使用以下帮助程序，您可以将两个对象合并为一个新对象：

```
function extend(obj, src) {
    for (var key in src) {
        if (src.hasOwnProperty(key)) obj[key] = src[key];
    }
    return obj;
}

// example
var a = { foo: true }, b = { bar: false };
var c = extend(a, b);

console.log(c);
// { foo: true, bar: false } 
```

当将选项字典与函数或插件中的默认设置合并时，这通常很有用。

如果不需要支持 IE 8，您可以改用`Object.keys`相同的功能：

```
function extend(obj, src) {
    Object.keys(src).forEach(function(key) { obj[key] = src[key]; });
    return obj;
} 
```

这涉及的代码略少，速度也更快。

* * *

## 回答 #52

> 赞同：1
> 
> 时间：2019-10-14T05:13:54.360

***使用Object.assign**和**扩展运算**符合并两个对象。*

 ****错误的方式（修改原始对象，因为针对 o1）**

```
var o1 = { X: 10 };
var o2 = { Y: 20 };
var o3 = { Z: 30 };
var merge = Object.assign(o1, o2, o3);
console.log(merge)  // {X:10, Y:20, Z:30}
console.log(o1)     // {X:10, Y:20, Z:30} 
```

**正确的方法**

*   Object.assign({}, o1, o2, o3) **==>**定位新对象

*   {...o1, ...o2, ...o3} **==>**传播对象

```
var o1 = { X: 10 };
var o2 = { Y: 20 };
var o3 = { Z: 30 };

console.log('Does not modify original objects because target {}');
var merge = Object.assign({}, o1, o2, o3);
console.log(merge); // { X: 10, Y: 20, Z: 30 }
console.log(o1)

console.log('Does not modify original objects')
var spreadMerge = {...o1, ...o2, ...o3};
console.log(spreadMerge);
console.log(o1);
```

* * *

## 回答 #53

> 赞同：1
> 
> 时间：2020-10-06T09:42:50.273

有不同的方法可以实现这一点：

```
Object.assign(targetObj, sourceObj);

targetObj = {...targetObj, ...sourceObj}; 
```

* * *

## 回答 #54

> 赞同：1
> 
> 时间：2021-02-11T11:20:11.520

您可以通过三种方式做到这一点：-

**方法1：-**

```
// using spread ...
    let obj1 = {
        ...obj2
    }; 
```

**方法2：-**

```
// using  Object.assign() method
let obj1 = Object.assign({}, obj2); 
```

**方法3：-**

```
// using JSON
let obj1 = JSON.parse(JSON.stringify(obj2)); 
```

* * *

## 回答 #55

> 赞同：0
> 
> 时间：2012-10-01T08:31:46.340

这合并`obj`为“默认” `def`。`obj`对两者中存在的任何东西都具有优先权，因为`obj`被复制到`def`. 另请注意，这是递归的。

```
function mergeObjs(def, obj) {
    if (typeof obj == 'undefined') {
        return def;
    } else if (typeof def == 'undefined') {
        return obj;
    }
    for (var i in obj) {
        if (obj[i] != null && obj[i].constructor == Object) {
            def[i] = mergeObjs(def[i], obj[i]);
        } else {
            def[i] = obj[i];
        }
    }
    return def;
}

a = {x : {y : [123]}}
b = {x : {z : 123}}
console.log(mergeObjs(a, b));
// {x: {y : [123], z : 123}} 
```

* * *

## 回答 #56

> 赞同：0
> 
> 时间：2012-12-19T17:39:32.857

```
A={a:1,b:function(){alert(9)}}
B={a:2,c:3}
A.merge = function(){for(var i in B){A[i]=B[i]}}
A.merge() 
```

结果是：{a:2,c:3,b:function()}

* * *

## 回答 #57

> 赞同：0
> 
> 时间：2013-07-29T18:57:03.937

您可以为每个对象分配一个默认合并（也许“继承”一个更好的名称）方法：

它应该与对象或实例化函数一起使用。

如果需要，下面的代码会处理覆盖合并的值：

```
Object.prototype.merge = function(obj, override) {
// Don't override by default

    for (var key in obj) {
        var n = obj[key];
        var t = this[key];
        this[key] = (override && t) ? n : t;
    };

}; 
```

测试数据如下：

```
var Mammal = function () {
    this.eyes = 2;
    this.thinking_brain = false;
    this.say = function () {
    console.log('screaming like a mammal')};
}

var Human = function () {
    this.thinking_brain = true;
    this.say = function() {console.log('shouting like a human')};
}

john = new Human();

// Extend mammal, but do not override from mammal
john.merge(new Mammal());
john.say();

// Extend mammal and override from mammal
john.merge(new Mammal(), true);
john.say(); 
```

* * *

## 回答 #58

> 赞同：0
> 
> 时间：2014-10-14T12:33:32.147

此解决方案创建一个**新对象**并能够处理**多个对象**。

此外，它是**递归**的，您可以选择**要****覆盖 Values**和**Objects**的天气。

```
 function extendObjects() {

        var newObject        = {};
        var overwriteValues  = false;
        var overwriteObjects = false;

        for ( var indexArgument = 0; indexArgument < arguments.length; indexArgument++ ) {

            if ( typeof arguments[indexArgument] !== 'object' ) {

                if ( arguments[indexArgument] == 'overwriteValues_True' ) {

                    overwriteValues = true;            
                } else if ( arguments[indexArgument] == 'overwriteValues_False' ) {

                    overwriteValues = false;                             
                } else if ( arguments[indexArgument] == 'overwriteObjects_True' ) {

                    overwriteObjects = true;     
                } else if ( arguments[indexArgument] == 'overwriteObjects_False' ) {

                    overwriteObjects = false; 
                }

            } else {

                extendObject( arguments[indexArgument], newObject, overwriteValues, overwriteObjects );
            }

        }

        function extendObject( object, extendedObject, overwriteValues, overwriteObjects ) {

            for ( var indexObject in object ) {

                if ( typeof object[indexObject] === 'object' ) {

                    if ( typeof extendedObject[indexObject] === "undefined" || overwriteObjects ) {
                        extendedObject[indexObject] = object[indexObject];
                    }

                    extendObject( object[indexObject], extendedObject[indexObject], overwriteValues, overwriteObjects );

                } else {

                    if ( typeof extendedObject[indexObject] === "undefined" || overwriteValues ) {
                        extendedObject[indexObject] = object[indexObject];
                    }

                }

            }     

            return extendedObject;

        }

        return newObject;
    }

    var object1           = { a : 1, b : 2, testArr : [888, { innArr : 1 }, 777 ], data : { e : 12, c : { lol : 1 }, rofl : { O : 3 } } };
    var object2           = { a : 6, b : 9, data : { a : 17, b : 18, e : 13, rofl : { O : 99, copter : { mao : 1 } } }, hexa : { tetra : 66 } };
    var object3           = { f : 13, g : 666, a : 333, data : { c : { xD : 45 } }, testArr : [888, { innArr : 3 }, 555 ]  };

    var newExtendedObject = extendObjects( 'overwriteValues_False', 'overwriteObjects_False', object1, object2, object3 ); 
```

**newExtendedObject 的内容：**

```
{"a":1,"b":2,"testArr":[888,{"innArr":1},777],"data":{"e":12,"c":{"lol":1,"xD":45},"rofl":{"O":3,"copter":{"mao":1}},"a":17,"b":18},"hexa":{"tetra":66},"f":13,"g":666} 
```

小提琴：http: [//jsfiddle.net/o0gb2umb/](http://jsfiddle.net/o0gb2umb/)

* * *

## 回答 #59

> 赞同：0
> 
> 时间：2015-03-31T17:09:41.107

另一种方法：

```
function concat_collection(obj1, obj2) {
    var i;
    var arr = new Array();

    var len1 = obj1.length;
    for (i=0; i<len1; i++) {
        arr.push(obj1[i]);
    }

    var len2 = obj2.length;
    for (i=0; i<len2; i++) {
        arr.push(obj2[i]);
    }

    return arr;
}

var ELEMENTS = concat_collection(A,B);
for(var i = 0; i < ELEMENTS.length; i++) {
    alert(ELEMENTS[i].value);
} 
```

* * *

## 回答 #60

> 赞同：0
> 
> 时间：2015-09-26T18:17:09.757

如果您使用的是[Dojo Toolkit](http://en.wikipedia.org/wiki/Dojo_Toolkit)，那么合并两个对象的最佳方法是使用 mixin。

下面是 Dojo Toolkit mixin 的示例：

```
// Dojo 1.7+ (AMD)
require(["dojo/_base/lang"], function(lang){
  var a = { b:"c", d:"e" };
  lang.mixin(a, { d:"f", g:"h" });
  console.log(a); // b:c, d:f, g:h
});

// Dojo < 1.7
var a = { b:"c", d:"e" };
dojo.mixin(a, { d:"f", g:"h" });
console.log(a); // b:c, d:f, g:h 
```

更多详情，请*[混入](http://dojotoolkit.org/reference-guide/1.7/dojo/mixin.html)*。

* * *

## 回答 #61

> 赞同：0
> 
> 时间：2015-12-30T16:40:27.813

实现此目的的一种可能方法如下。

```
if (!Object.prototype.merge){
    Object.prototype.merge = function(obj){
        var self = this;
        Object.keys(obj).forEach(function(key){
            self[key] = obj[key]
        });
    }
}; 
```

我不知道它是否比其他答案更好。在此方法中，您将添加`merge function`到`Objects`原型。这样你就可以调用 `obj1.merge(obj2);`

注意：您应该验证您的论点以查看它是否是一个对象并“抛出”一个正确的`Error`. 如果不是`Object.keys`，将“抛出”一个“错误”

* * *

## 回答 #62

> 赞同：0
> 
> 时间：2016-01-11T09:20:26.717

这是我在代码库中用来合并的内容。

```
function merge(to, from) {
  if (typeof to === 'object' && typeof from === 'object') {
    for (var pro in from) {
      if (from.hasOwnProperty(pro)) {
        to[pro] = from[pro];
      }
    }
  }
  else{
      throw "Merge function can apply only on object";
  }
} 
```

* * *

## 回答 #63

> 赞同：0
> 
> 时间：2018-05-31T13:11:32.293

我们可以创建一个空对象，并通过以下方式组合它们`for-loop`：

```
var obj1 = {
  id: '1',
  name: 'name'
}

var obj2 = {
  c: 'c',
  d: 'd'
}

var obj3 = {}

for (var attrname in obj1) { obj3[attrname] = obj1[attrname]; }
for (var attrname in obj2) { obj3[attrname] = obj2[attrname]; }

console.log( obj1, obj2, obj3)
```

* * *

## 回答 #64

> 赞同：0
> 
> 时间：2021-05-25T14:31:33.857

使用 jQuery 库尝试这种方式

```
let obj1 = { food: 'pizza', car: 'ford' }
let obj2 = { animal: 'dog' }

console.log(jQuery.extend(obj1, obj2)) 
```

* * *

## 回答 #65

> 赞同：-1
> 
> 时间：2012-06-02T14:52:19.077

```
function extend()
{ 
    var o = {}; 

    for (var i in arguments)
    { 
        var s = arguments[i]; 

        for (var i in s)
        { 
            o[i] = s[i]; 
        } 
    } 

    return o;
} 
```

* * *

## 回答 #66

> 赞同：-2
> 
> 时间：2016-12-31T11:04:17.073

如果您需要一个深度合并，它还将通过在结果中连接它们来“合并”数组，那么这个 ES6 函数可能就是您所需要的：

```
function deepMerge(a, b) {
    // If neither is an object, return one of them:
    if (Object(a) !== a && Object(b) !== b) return b || a;
    // Replace remaining primitive by empty object/array
    if (Object(a) !== a) a = Array.isArray(b) ? [] : {};
    if (Object(b) !== b) b = Array.isArray(a) ? [] : {};
    // Treat arrays differently:
    if (Array.isArray(a) && Array.isArray(b)) {
        // Merging arrays is interpreted as concatenation of their deep clones:
        return [...a.map(v => deepMerge(v)), ...b.map(v => deepMerge(v))];
    } else {
        // Get the keys that exist in either object
        var keys = new Set([...Object.keys(a),...Object.keys(b)]);
        // Recurse and assign to new object
        return Object.assign({}, ...Array.from(keys,
            key => ({ [key]: deepMerge(a[key], b[key]) }) ));
    }
}

// Sample data for demo:
var a = {
    groups: [{
        group: [{
            name: 'John',
            age: 12
        },{
            name: 'Mary',
            age: 20
        }],
        groupName: 'Pair'
    }],
    config: {
        color: 'blue',
        range: 'far'
    }
};

var b = {
    groups: [{
        group: [{
            name: 'Bill',
            age: 15
        }],
        groupName: 'Loner'
    }],
    config: {
        range: 'close',
        strength: 'average'
    }
};

var merged = deepMerge(a, b);

console.log(merged);
```

```
.as-console-wrapper { max-height: 100% !important; top: 0; }
```

请注意，如果只有一个参数传递给此函数，则它充当深度克隆函数。

* * *

## 回答 #67

> 赞同：-2
> 
> 时间：2017-02-02T12:15:00.940

您可以在 EcmaScript2016 中执行以下操作

更正：这是第 3 阶段的提案，但它一直对我有用

```
const objA = {
  attrA: 'hello',
  attrB: true
}

const objB = {
  attrC: 2
}

const mergedObj = {...objA, ...objB} 
```

# javascript - 你可以在运行时使用javascript修改div的onmousedown吗

> ID：171259
> 
> 赞同：4
> 
> 时间：2008-10-05T00:36:43.777
> 
> 标签：javascript, events

我想编写一些 JavaScript 来在运行时更改 div 的 onmousedown。因此，在加载时，鼠标按下 div 会做一件事，如果调用 JavaScript 函数，鼠标按下 div 会做其他事情。这可能吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-05T00:41:52.253

您可以只分配 onMouseDown 属性。

```
document.getElementById('myDiv').onmousedown = function() {
  alert('New mouse down handler.');
}; 
```

请记住，javascript 属性区分大小写。“onmousedown”全是小写。

# python - UNIX shell 用一种合理的语言编写吗？

> ID：171267
> 
> 赞同：9
> 
> 时间：2008-10-05T00:42:54.263
> 
> 标签：python, unix, shell

有没有人听说过用一种合理的语言（如 Python）编写的 UNIX shell？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-05T01:08:31.170

*   [Eshell](http://www.gnu.org/software/emacs/manual/html_node/eshell/index.html)是 Emacs Lisp 中的一个类似 Bash 的 shell。
*   IPython 可以[用作系统 shell](http://ipython.org/ipython-doc/stable/interactive/shell.html)，尽管语法有点奇怪（支持所有 Python 加上基本的 sh 结构）。
*   [fish](http://fishshell.com/)有一个用 C 编写的核心，但它的大部分功能都是自己实现的。与许多稀有的 shell 不同，它可以用作您的登录 shell。
*   [Hotwire](https://code.google.com/p/hotwire-shell/)值得一提。它的基本设计似乎是“Python 中的 PowerShell”，但它也在 UI 上做了一些巧妙的事情。最后一次发布是在 2008 年。
*   [Zoidberg](http://www.pardus.nl/projects/zoidberg/)是用 Perl 编写的，并使用 Perl 语法。一个好看的项目，可惜它似乎停滞了。
*   [Scsh](http://www.scsh.net/)用作登录 shell 会很痛苦（文档中的示例命令：） `(run/strings (find "." -name *.c -print))`，但它看起来像是一个很好的“Perl in Scheme”。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-05T00:52:02.747

[iPython](http://ipython.scipy.org/moin/) (Python) 和[Rush](http://rush.heroku.com/) (Ruby) 是为更高级的语言设计的 shell。还有 Hotwire，它是一种奇怪的集成外壳/终端仿真器。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-05T01:15:26.740

从表面上看，Python 是一个外壳。它运行`#!`并且可以交互运行。在`os`和`shutil`包之间，您拥有标准 Unix shell 的所有功能。

由于您可以使用简单而强大的脚本在 Python 中做任何事情，因此您真的不需要花任何时间来弄乱其他 shell。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-05T00:45:09.937

嗯，有 emacs，可以说是一个用 lisp 编写的 shell :)

不过说真的，您是否正在寻找用不同的语言（例如 Python）重新实现现有的 shell 设计？或者您是否正在寻找一种与您选择的语言相似的 shell 语言的新实现？

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2016-08-30T18:37:50.387

现在有xon：

[http://xon.sh/](http://xon.sh/)

[http://xon.sh/tutorial.html#running-commands](http://xon.sh/tutorial.html#running-commands)

PyCon 视频 - [https://www.youtube.com/watch?v=uaje5I22kgE](https://www.youtube.com/watch?v=uaje5I22kgE)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-05T01:05:42.233

Tclsh 非常好（当然，假设你喜欢 Tcl）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-11-07T20:52:30.713

尝试[皮疹](https://github.com/willghatch/racket-rash)。它是一种用 Racket 编写的 shell 语言。它有一个很好的交互友好的语法。您可以将 Rash 嵌入到任何普通的 Racket 文件中，也可以将普通的 Racket 嵌入到 Rash 中。它是可扩展的，您可以定义新的管道运算符。目前它仍然是 alpha 质量，但它非常酷。完全披露：我写的。

# silverlight - Silverlight：空故事板与 BackgroundWorker

> ID：171268
> 
> 赞同：1
> 
> 时间：2008-10-05T00:42:58.460
> 
> 标签：silverlight, multithreading

哪一个在运行游戏主循环时表现更好？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-05T01:11:15.703

RC0 中有一个新选项，即 CompositionTarget.Rendering 事件。它似乎有望成为最佳选择。

至于其他游戏循环方法，通常认为空的 Storyboard 是最好的。所以我首先推荐新的渲染事件，如果这似乎有问题，请使用空的故事板。

关于新的渲染事件，我有一些信息：

[http://silverlightrocks.com/cs/blogs/silverlight_games_101/archive/2008/09/26/a-much-cleaner-game-loop-in-silverlight-2-rc0.aspx](http://silverlightrocks.com/cs/blogs/silverlight_games_101/archive/2008/09/26/a-much-cleaner-game-loop-in-silverlight-2-rc0.aspx)

# ruby - 如何将字符代码转换回字符？

> ID：171279
> 
> 赞同：8
> 
> 时间：2008-10-05T00:51:54.633
> 
> 标签：ruby, string

如何获得以下返回的 Fixnum：

```
"abc"[2] 
```

变回角色？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-05T00:54:24.833

这将做到这一点（如果 n 是一个整数）：

```
n.chr 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-05T03:07:20.897

请注意，因为 Ruby 1.9 及更高版本将返回一个单字符串 for `"abc"[2]`，它不会响应该`chr`方法。你可以这样做：

```
"abc"[2,1] 
```

请务必阅读强大且多方面的[String#[] 方法](http://ruby-doc.org/core/classes/String.html#M000786)。

# ruby - merb_auth_password_slice 不维护会话

> ID：171283
> 
> 赞同：1
> 
> 时间：2008-10-05T01:00:08.050
> 
> 标签：ruby, merb, merb-auth

`merb_auth_password_slice`根据自述文件进行集成后，我可以成功登录`redirect_after_login`，尽管`session.authenticated?`返回错误。

现在只是尝试基本的身份验证策略（密码形式），似乎无法让它工作，有什么想法吗？

我的初始化文件：

```
require 'dm-validations'

dependencies "merb-more", "merb_helpers", "merb-slices", "merb_auth_password_slice"

Merb::BootLoader.before_app_loads do
  DataMapper.setup(:default, "sqlite3://config/dev.db")
end

Merb::BootLoader.after_app_loads do
    # have already done this
    # raise "You must specify a valid openid in Merb.root/config/open_id to use this example app" unless File.exists?(Merb.root / "config" / "open_id")
    # # DataMapper.auto_migrate!
    # User.create(:login => "admin", 
    #             :password => "password", :password_confirmation => "password", 
    #             :email => "admin@example.com", 
    #             :identity_url => File.read(Merb.root / "config" / "open_id"))
end

Merb::Config.use do |c|
  c[:session_secret_key]  = 'my key'
  c[:session_store] = 'cookie'
end 
```

安装程序.rb

```
class Authentication

  def store_user(user)
    return nil unless user
    user.id
  end

  def fetch_user(session_info)
    User.get(session_info)
  end

end # Authentication 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-05T13:03:01.040

```
 # before(nil, :only => [:update, :destroy]) { session.abandon! } 
```

这是切片的会话控制器中的罪魁祸首

# .net - 自动记录方法的进入和退出以及参数？

> ID：171285
> 
> 赞同：12
> 
> 时间：2008-10-05T01:02:11.913
> 
> 标签：.net, logging, log4net

有没有办法让我添加日志记录，以便以某种方式自动记录进入和退出方法以及参数以进行跟踪？我该怎么做？

我正在使用 Log4Net。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-05T01:17:28.827

实现这种事情的最好方法是使用拦截，有几种方法可以做到这一点，尽管它们都倾向于有点侵入性。一种是从 ContextBoundObject 派生所有对象。 [这](http://www.codeproject.com/KB/cs/aspectintercept.aspx)是使用这种方法的示例。另一种方法是使用现有的 AOP 库之一来实现这一点。[Castle Project](http://www.castleproject.org/)中的DynamicProxy 之类的东西是其中许多的核心。这里有几个链接： [Spring.Net](http://www.springframework.net/) [PostSharp](http://www.postsharp.org) [Cecil](http://www.mono-project.com/Cecil)

可能还有其他几个，我知道[Castle Windsor](http://www.castleproject.org/container/index.html)和[Ninject](http://www.ninject.org)都在 IoC 功能之上提供 AOP 功能。

一旦 AOP 到位，您只需编写一个拦截器类，它将有关方法调用的信息写入 log4net。

如果其中一个 AOP 框架能够为您提供开箱即用的那种功能，我实际上不会感到惊讶。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-05T01:45:24.200

我不确定您的实际需求是什么，但这里有一个低租金的选择。它不完全是“自动的”，但您可以使用 StackTrace 以不需要传递参数的方式剥离您正在寻找的信息 - 类似于 ckramer 关于拦截的建议：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;

using System.Diagnostics;

namespace TracingSample
{
    class Program
    {
        static void Main(string[] args)
        {
            DoSomething();
        }

        static void DoSomething()
        {
            LogEnter();

            Console.WriteLine("Executing DoSomething");

            LogExit();
        }

        static void LogEnter()
        {
            StackTrace trace = new StackTrace();
            if (trace.FrameCount > 1)
            {
                string ns = trace.GetFrame(1).GetMethod().DeclaringType.Namespace;
                string typeName = trace.GetFrame(1).GetMethod().DeclaringType.Name;
                Console.WriteLine("Entering {0}.{1}.{2}", ns, typeName, trace.GetFrame(1).GetMethod().Name);
            }
        }

        static void LogExit()
        {
            StackTrace trace = new StackTrace();
            if (trace.FrameCount > 1)
            {
                string ns = trace.GetFrame(1).GetMethod().DeclaringType.Namespace;
                string typeName = trace.GetFrame(1).GetMethod().DeclaringType.Name;
                Console.WriteLine("Exiting {0}.{1}.{2}", ns, typeName, trace.GetFrame(1).GetMethod().Name);
            }
        }
    }
} 
```

您可以将上述示例与继承相结合，使用基类型中的非虚拟公共成员来表示操作方法，然后调用虚拟成员来实际完成工作：

```
public abstract class BaseType
{
    public void SomeFunction()
    {

        LogEnter();
        DoSomeFunction();
        LogExit();
    }

    public abstract void DoSomeFunction();
}

public class SubType : BaseType
{
    public override void DoSomeFunction()
    {
        // Implementation of SomeFunction logic here...
    }
} 
```

再一次 - 关于这一点并没有太多“自动”，但如果您不需要对每个方法调用进行检测，它将在有限的基础上工作。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-05T01:40:51.493

看一下：

[如何在 C# 中拦截方法调用？](https://stackoverflow.com/questions/25803/how-do-i-intercept-a-method-call-in-c#25825) [PostSharp - il weaving - 想法](https://stackoverflow.com/questions/91635/postsharp-il-weaving-thoughts)

还搜索“AOP”或“面向方面的编程”和 PostSharp……你会得到一些有趣的结果。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-05T01:18:02.507

您可以使用[Postsharp](http://www.postsharp.org/)之类的后编译器。该网站的示例讨论了设置用于进入/退出方法的跟踪器，这与您想要的非常相似。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-12-11T02:28:24.047

您可以在具有 LogInjector 的 CodePlex 上使用开源框架[CInject](http://codeinject.codeplex.com)来标记方法调用的进入和退出。

或者，您可以按照本文中提到的[使用 IL 拦截方法调用](http://www.codetails.com/punitganshani/intercepting-method-calls-using-il/20121202)的步骤操作，并使用 C# 中的 Reflection.Emit 类创建自己的拦截器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-01-13T23:25:45.317

# 功能

要扩展 Jared 的答案，避免代码重复并包括[参数选项](https://stackoverflow.com/a/6928253/940217)：

```
private static void LogEnterExit(bool isEnter = true, params object[] args)
{
    StackTrace trace = new StackTrace(true);  // need `true` for getting file and line info
    if (trace.FrameCount > 2)
    {
        string ns = trace.GetFrame(2).GetMethod().DeclaringType.Namespace;
        string typeName = trace.GetFrame(2).GetMethod().DeclaringType.Name;
        string args_string = args.Length == 0 ? "" : "\narguments: [" + args.Aggregate((current, next) => string.Format("{0},{1};", current, next))+"]";
        Console.WriteLine("{0} {1}.{2}.{3}{4}", isEnter ? "Entering" : "Exiting", ns, typeName, trace.GetFrame(2).GetMethod().Name, args_string );
    }
}

static void LogEnter(params object[] args)
{
    LogEnterExit(true, args);
}

static void LogExit(params object[] args)
{
    LogEnterExit(false, args);
} 
```

# 用法

```
static void DoSomething(string arg1)
{
    LogEnter(arg1);
    Console.WriteLine("Executing DoSomething");
    LogExit();
} 
```

# 输出

`DoSomething`在控制台中，如果使用“blah”运行，这将是输出`arg1`

```
Entering Program.DoSomething
arguments: [blah]
Executing DoSomething
Exiting Program.DoSomething 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-12-31T18:49:51.630

这不适用于所有 C# 应用程序，但我在 Asp.Net Core 应用程序中执行以下操作，通过实现以下接口将日志记录添加到控制器方法调用：

IActionFilter，IAsyncActionFilter。

```
public void OnActionExecuting(ActionExecutingContext context)    

public void OnActionExecuted(ActionExecutedContext context)    

public async Task OnActionExecutionAsync(ActionExecutingContext context, ActionExecutionDelegate next) 
```

# php - php中数组的最大键数是多少

> ID：171289
> 
> 赞同：11
> 
> 时间：2008-10-05T01:04:43.190
> 
> 标签：php, arrays

我正在编写一个我调用的 php 脚本

```
$lines = file('base_list.txt'); 
```

将文件分解为数组。该文件中有超过 100,000 行，这应该是数组中的 100,000 个元素，但是当我运行

```
print_r($lines);
exit; 
```

该数组仅包含 7280 个元素。

所以我很好奇，WTF？数组可以拥有的键数量是否有限制？我在具有 2GB RAM 的双核 2.0Ghz 上本地运行它（虽然是 Vista 和 IIS）；所以我有点困惑一个 4MB 的文件怎么会抛出这样的结果。

编辑：我可能应该提到我之前在 php.ini 中也将 memory_limit 设置为 512MB。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-05T20:35:42.747

达里尔·海因

是的，错误日志中没有任何内容。我什至增加了错误报告，但仍然与 print_r() 无关。

回应杰：我跑了

```
echo count($lines); 
```

我得到 105,546 的结果，但 print_r() 仍然只显示 7280。

根据 Rob Walker 的建议，我遍历了数组中的所有元素，它实际上包含了所有结果。这让我相信问题在于 print_r() 本身，而不是数组大小的限制。

另一个奇怪的事情是，我在我的一个 REHL 服务器上尝试了它，结果应该是这样。现在我不想将此归咎于 Windows/IIS，但你去吧。

考虑到上述情况，我认为这个问题应该重新命名，因为它不再与数组相关，而是与 print_r 相关。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-05T01:21:04.920

编辑：正如 Rob 所说，如果您的应用程序内存不足，那么它甚至可能不会上`print_r`线。这也是我的预感，但如果*是*内存问题，以下可能会有所帮助。

查看 php.ini 文件中的这一行，或许将其增加到 16 或更多。

```
memory_limit = 8M 
```

如果您无权访问 php.ini（例如，如果这发生在共享服务器上），您可以使用这样的`.htaccess`文件修复它

```
php_value memory_limit 16M 
```

显然有些主机不允许你这样做。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-05T03:16:24.903

两个建议：

1.  计算数组中的实际项数并查看数组是否是正确的条目数（因此消除或确定`print_r()`为罪魁祸首）

2.  验证输入...文件中的行结尾是否有可能导致问题？例如，是否混合了不同类型的行尾？请参阅[手册页`file()`](http://us2.php.net/function.file)和有关`auto_detect_line_endings`设置的注释，尽管这不太可能与 mac 行结尾有关。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-05T01:23:54.663

print_r 的输出是否可能存在固有限制。我建议在文件中查找第一行和最后一行，看看它们是否在数组中。如果您在插入数组时遇到内存限制，您将永远无法到达 print_r 行。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-05T07:35:39.810

每次我用完 PHP 中的内存时，我都会收到一条错误消息，说明这一事实。所以，我还要说，如果你的内存不足，那么脚本将无法到达`print_r()`

尝试`auto_detect_line_endings`在 php.ini 中启用或使用
`ini_set('auto_detect_line_endings', 1)`. 可能有一些 Windows 不理解的行尾，这个 ini 选项可能会有所帮助。可以在[此处找到有关此 ini 选项的更多信息](http://us.php.net/manual/en/filesystem.configuration.php#ini.auto-detect-line-endings)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-02T21:15:18.433

PHP 的`print_r`功能确实有局限性。但是，即使您没有“看到”打印的整个数组，它也都在那里。在打印大型数据对象时，我也遇到过同样的问题。

它使调试变得困难，如果您必须查看整个数组，您可以创建一个循环来打印每一行。

```
foreach ($FileLines as $Line) echo $Line; 
```

那应该让您无限制地查看所有行。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-05T01:10:09.730

我相信它基于 php.ini 文件中设置的可用内存量。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-05T07:53:05.080

**您应该使用`count`来计算数组中的项目数**，而不是`print_r`. 如果这个大数组的输出由于超时或其他原因而中止怎么办？或者一些错误/功能`print_r`？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-05T01:22:56.443

我会同意科里的。我在想你的 PHP 可能配置了 8MB 的默认内存，而 4MB x 2 已经更多了。x2 的原因是因为您必须加载文件，然后要创建数组，您需要再次将文件放在内存中。我只是猜测，但这是有道理的。

您确定 PHP 没有记录错误吗？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-22T23:01:58.423

如果您要输出到 Internet Explorer 之类的东西，您可能需要确保它可以显示您尝试放入的所有信息。我知道 html 页面有限制，但我不确定它是什么。

# nhibernate - 为 NHibnernate 结合 Fluent 和 XML 映射

> ID：171292
> 
> 赞同：5
> 
> 时间：2008-10-05T01:07:19.017
> 
> 标签：nhibernate, fluent, fluent-interface

我刚刚爱上了 NHibernate 和流畅的界面。后者通过重构支持实现了非常好的映射（不再需要 xml 文件）。

但是没有人是完美的，所以我错过了流利的多对任意映射。有人知道它是否已经存在吗？如果是这样，一个简单的代码行会很好。

但要坚持问题的标题，有没有办法结合流畅和正常的 NHibernate 映射。

目前，我将以下几行用于我的测试设置 WITH fluent，以及我的测试的第二个代码块，而不使用 fluent（使用 XML 映射）。我怎么能告诉流利使用流利的 IF AVAILABLE 和 XML 否则......

```
 var cfg = new Configuration();
        cfg.AddProperties(MsSqlConfiguration.MsSql2005.ConnectionString.Is(_testConnectionstring).ToProperties());
        cfg.AddMappingsFromAssembly(typeof(CatMap).Assembly);
        new SchemaExport(cfg).Create(true, true);

        var persistenceModel = new PersistenceModel();
        persistenceModel.addMappingsFromAssembly(typeof(CatMap).Assembly);
        IDictionary<string, string> properties = MsSqlConfiguration.MsSql2005.UseOuterJoin().ShowSql().ConnectionString.Is(_testConnectionstring).ToProperties();
        properties.Add("command_timeout", "340");

        session = new SessionSource(properties, persistenceModel).CreateSession(); 
```

没有流利...

```
 config = new Configuration();
        IDictionary props = new Hashtable();

        props["connection.provider"] = "NHibernate.Connection.DriverConnectionProvider";
        props["dialect"] = "NHibernate.Dialect.MsSql2005Dialect";
        props["connection.driver_class"] = "NHibernate.Driver.SqlClientDriver";
        props["connection.connection_string"] = "Server=localhost;initial catalog=Debug;Integrated Security=SSPI";
        props["show_sql"] = "true";
        foreach (DictionaryEntry de in props)
        {
            config.SetProperty(de.Key.ToString(), de.Value.ToString());
        }
        config.AddAssembly(typeof(CatMap).Assembly);

        SchemaExport se = new SchemaExport(config);
        se.Create(true, true);

        factory = config.BuildSessionFactory();
        session = factory.OpenSession(); 
```

就是这样……克里斯

PS：我真的很喜欢这个网站，界面非常完美，所有文章的质量都令人难以置信。我认为这将是巨大的:-) 必须注册...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-18T00:12:51.557

`Foo`从到映射`Baa`：

```
HasManyToMany< Baa > ( x => Baas )
  .AsBag ( ) //can also be .AsSet()
  .WithTableName ( "foobar" )
  .WithParentKeyColumn ( "fooId" )
  .WithChildKeyColumn ( "barId" ) ; 
```

查看中的示例[`ClassMapXmlCreationTester`](http://github.com/jagregory/fluent-nhibernate/blob/master/src/FluentNHibernate.Testing/DomainModel/Mapping/ClassMapXmlCreationTester.cs)- 它们还显示了默认列名是什么。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T13:01:53.330

ManyToAny 目前尚未实现（截至撰写本文时）。

关于流畅和非流畅映射的设置，您的第一个示例几乎已经完成。

```
var cfg = MsSqlConfiguration.MsSql2005
  .ConnectionString.Is(_testConnectionstring)
  .ConfigureProperties(new Configuration());

cfg.AddMappingsFromAssembly(typeof(CatMap).Assembly); // loads hbm.xml files

var model = new PersistenceModel();
model.addMappingsFromAssembly(typeof(CatMap).Assembly); // loads fluent mappings
mode.Configure(cfg);

new SchemaExport(cfg).Create(true, true); 
```

主要区别在于 SchemaExport 位于最后。我假设您的第一个示例实际上是加载流利的映射，但到那时它已经创建了模式。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-12-12T05:29:16.283

您可以完全在 Fluent NHibernate 中完成您想做的事情。

以下代码将使用 Fluent NHibernate 语法流畅地配置会话工厂，该工厂从多个可能的程序集中查找 HBM (xml) 映射文件、流畅映射和约定。

```
var _mappingAssemblies = new Assembly[] { typeof(CatMap).Assembly };
var _autoPersistenceModel = CreateAutoPersistenceModel();
Fluently.Configure()
        .Database(MsSqlConfiguration.MsSql2005.ConnectionString(_testConnectionstring))
        .Mappings(m =>
                  {
                      foreach (var assembly in _mappingAssemblies)
                      {
                          m.HbmMappings.AddFromAssembly(assembly);
                          m.FluentMappings.AddFromAssembly(assembly)
                              .Conventions.AddAssembly(assembly);
                      }
                      m.AutoMappings.Add(_autoPersistenceModel );
                   })
        .ExposeConfiguration(c => c.SetProperty("command_timeout", "340"))
        .BuildSessionFactory(); 
```

还有许多其他选项可供您使用：[Fluent NHibernate 数据库配置](http://wiki.fluentnhibernate.org/Database_configuration "流畅的 NHibernate 数据库配置")

# optimization - 将整数除以 3 的最快方法是什么？

> ID：171301
> 
> 赞同：41
> 
> 时间：2008-10-05T01:13:19.537
> 
> 标签：optimization, bit-manipulation, division

```
int x = n / 3;  // <-- make this faster

// for instance

int a = n * 3; // <-- normal integer multiplication

int b = (n << 1) + n; // <-- potentially faster multiplication 
```

* * *

## 回答 #1

> 赞同：126
> 
> 时间：2008-10-05T02:27:33.287

说“把它留给编译器”的人是对的，但我没有“声誉”来修改或评论他。我让 gcc 编译 int test(int a) { return a / 3; } 对于 ix86，然后反汇编输出。仅出于学术兴趣，它所做的就是*大致*乘以 0x55555556，然后取其 64 位结果的前 32 位。您可以通过以下方式向自己展示这一点：

```
$ ruby​​ -e 'puts(60000 * 0x55555556 >> 32)'
20000
$ ruby​​ -e 'puts(72 * 0x55555556 >> 32)'
24
$

```

[关于蒙哥马利分部](http://en.wikipedia.org/wiki/Montgomery_reduction)的维基百科页面很难阅读，但幸运的是编译器人员已经完成了，所以你不必这样做。

* * *

## 回答 #2

> 赞同：61
> 
> 时间：2008-10-05T01:30:32.840

这是最快的，因为编译器会根据输出处理器对其进行优化。

```
int a;
int b;

a = some value;
b = a / 3; 
```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2011-04-19T01:20:52.810

如果您知道值的范围，有一种更快的方法可以做到这一点，例如，如果您将一个有符号整数除以 3，并且您知道要除以的值的范围是 0 到 768，那么您可以将其相乘乘以一个因子并将其向左移动 2 的幂除以该因子除以 3。

例如。

范围 0 -> 768

你可以使用 10 位的移位，乘以 1024，你想除以 3，所以你的乘数应该是 1024 / 3 = 341，

所以你现在可以使用 (x * 341) >> 10
（如果使用有符号整数，请确保移位是有符号移位），还要确保移位是实际移位而不是位 ROLL

这将有效地除以值 3，并且运行速度大约是标准 x86 / x64 CPU 上自然除以 3 的 1.6 倍。

当然，当编译器无法进行此优化时，您可以进行此优化的唯一原因是因为编译器不知道 X 的最大范围，因此无法做出此决定，但作为程序员的您可以。

有时将值移动到更大的值然后做同样的事情甚至可能更有益，即。如果您有一个完整范围的 int，您可以将其设为 64 位值，然后进行乘法和移位，而不是除以 3。

我最近不得不这样做以加快图像处理速度，我需要找到 3 个颜色通道的平均值，每个颜色通道都有一个字节范围（0 - 255）。红绿蓝。

起初我只是简单地使用：

平均值 = (r + g + b) / 3;

（所以 r + g + b 最大为 768，最小为 0，因为每个通道都是一个字节 0 - 255）

经过数百万次迭代后，整个操作耗时 36 毫秒。

我将行更改为：

平均 = (r + g + b) * 341 >> 10;

这将其缩短到 22 毫秒，这令人惊叹，只需一点点独创性就可以完成。

即使我打开了优化并且在没有调试信息并且没有通过 IDE 的情况下本机运行程序，这种加速也发生在 C# 中。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-10-05T01:31:28.953

有关更有效地除以 3 的扩展讨论，请参阅[如何](http://babbage.cs.qc.edu/courses/cs345/divideby3.xhtml)除以 3，重点是进行 FPGA 算术运算。

也相关：

*   [在 C# 中使用乘法移位优化整数除法](http://www.codeproject.com/KB/cs/FindMulShift.aspx?display=Print)

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-01-12T18:47:48.717

根据您的平台和 C 编译器，本机解决方案就像使用

```
y = x / 3 
```

可能很快，也可能非常慢（即使除法完全在硬件中完成，如果使用 DIV 指令完成，该指令也比现代 CPU 上的乘法慢 3 到 4 倍）。开启优化标志的非常好的 C 编译器可能会优化此操作，但如果您想确定，最好自己优化它。

对于优化，重要的是具有已知大小的整数。在 C 中，int 没有已知的大小（它可能因平台和编译器而异！），所以最好使用 C99 固定大小的整数。下面的代码假设您想将一个无符号的 32 位整数除以 3，并且您的 C 编译器知道大约 64 位整数（**注意：即使在 32 位 CPU 架构上，大多数 C 编译器也可以处理 64 位整数**）：

```
static inline uint32_t divby3 (
    uint32_t divideMe
) {
    return (uint32_t)(((uint64_t)0xAAAAAAABULL * divideMe) >> 33);
} 
```

这听起来很疯狂，但上面的方法确实除以 3。它只需要一个 64 位乘法和一次移位（就像我说的，乘法可能比 CPU 上的除法快 3 到 4 倍）。在 64 位应用程序中，此代码将比 32 位应用程序中快得多（在 32 位应用程序中，将两个 64 位数字相乘需要 3 次乘法和 3 次 32 位值的加法） - 但是，它可能仍然比在 32 位机器上进行除法。

另一方面，如果您的编译器是一个非常好的编译器，并且知道如何优化整数除法的技巧（最新的 GCC 可以，我刚刚检查过），它无论如何都会生成上面的代码（GCC 将为"/3" 如果您至少启用优化级别 1)。对于其他编译器......你不能依赖或期望它会使用这样的技巧，即使这种方法在互联网上到处都有很好的记录和提及。

问题是它只适用于常数，而不适用于变量。您总是需要知道幻数（此处为 0xAAAAAAAB）和乘法后的正确操作（在大多数情况下是移位和/或加法），两者都不同，具体取决于您要除以的数字，并且都需要太多 CPU 时间即时计算它们（这将比硬件除法慢）。但是，编译器很容易在编译期间计算这些（其中一秒钟或多或少的编译时间几乎没有作用）。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2018-01-28T01:31:37.753

对于 64 位数字：

```
uint64_t divBy3(uint64_t x)
{
    return x*12297829382473034411ULL;
} 
```

然而，这不是您可能期望的截断整数除法。如果该数字已经被 3 整除，则它可以正常工作，但如果不是，它会返回一个巨大的数字。

例如，如果你在 11 上运行它，它会返回 6148914691236517209。这看起来像垃圾，但实际上它是正确的答案：将它乘以 3，你会得到 11！

如果您正在寻找截断除法，那么只需使用 / 运算符。我非常怀疑你能比这快得多。

理论：

64 位无符号算术是模 2^64 算术。这意味着对于每个与 ​​2^64 模数互质的整数（基本上所有奇数）都存在一个乘法逆元，您可以使用它来相乘而不是除法。这个幻数可以通过`3*x + 2^64*y = 1`使用扩展欧几里得算法求解方程来获得。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-05-13T17:57:40.387

如果你*真的*不想乘法或除法怎么办？这是我刚刚发明的一个近似值。它之所以有效，是因为 (x/3) = (x/4) + (x/12)。但是因为 (x/12) = (x/4) / 3 我们只需要重复这个过程直到它足够好。

```
#include <stdio.h>

void main()
{
    int n = 1000;
    int a,b;
    a = n >> 2;
    b = (a >> 2);
    a += b;
    b = (b >> 2);
    a += b;
    b = (b >> 2);
    a += b;
    b = (b >> 2);
    a += b;
    printf("a=%d\n", a);
} 
```

结果是 330。使用 b = ((b+2)>>2); 可以更准确。考虑四舍五入。

如果允许乘法，只需*为*(1/3) 选择一个合适的近似值，并使用 2 的幂除数。例如，n * (1/3) ~= n * 43 / 128 = (n * 43) >> 7。

这种技术在[印第安纳州最有用。](http://www.wired.com/science/discoveries/news/2008/02/dayintech_0205)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-05T01:19:31.457

我不知道它是否更快，但如果您想使用按位运算符执行二进制除法，您可以使用[本页](http://courses.cs.vt.edu/~cs1104/BuildingBlocks/divide.030.html)描述的移位和减法方法：

> *   将商设置为 0
> *   对齐被除数和除数中的最左边的数字
> *   重复：
>     *   如果除数之上的那部分被除数大于或等于除数：
>         *   然后从那部分被除数中减去除数，然后
>         *   将 1 连接到商的右手端
>         *   否则将 0 连接到商的右手端
>     *   将除数右移一位
> *   直到股息小于除数：
> *   商是正确的，被除数是余数
> *   停止

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-05T01:21:50.657

如果你真的想看这篇关于[整数除法](https://web.archive.org/web/20201111205745/https://docs.microsoft.com/en-us/archive/blogs/devdev/integer-division-by-constants)的文章，但它只具有学术价值……这将是一个有趣的应用程序，它实际上需要从这种技巧中受益。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-05-20T13:30:51.670

对于非常大的整数除法（例如大于 64 位的数字），您可以将您的数字表示为 int[] 并通过一次取两位数并将它们除以 3 来快速执行除法。余数将是接下来两位数的一部分等等。

例如。11004 / 3 你说

11/3 = 3，余数 = 2（从 11-3*3）

20/3 = 6，余数 = 2（从 20-6*3）

20/3 = 6，余数 = 2（从 20-6*3）

24/3 = 8，余数 = 0

因此结果为**3668**

```
internal static List<int> Div3(int[] a)
{
  int remainder = 0;
  var res = new List<int>();
  for (int i = 0; i < a.Length; i++)
  {
    var val = remainder + a[i];
    var div = val/3;

    remainder = 10*(val%3);
    if (div > 9)
    {
      res.Add(div/10);
      res.Add(div%10);
    }
    else
      res.Add(div);
  }
  if (res[0] == 0) res.RemoveAt(0);
  return res;
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-05-09T15:30:05.843

易于计算...最多 n 次迭代，其中 n 是您的位数：

```
uint8_t divideby3(uint8_t x)
{
  uint8_t answer =0;
  do
  {
    x>>=1;
    answer+=x;
    x=-x;
  }while(x);
  return answer;
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-07-17T06:55:33.880

在某些架构中，查找表方法也会更快。

```
uint8_t DivBy3LU(uint8_t u8Operand)
{
   uint8_t ai8Div3 = [0, 0, 0, 1, 1, 1, 2, 2, 2, 3, 3, 3, 4, ....];

   return ai8Div3[u8Operand];
} 
```

# php - 如何将 PHP 输出捕获到变量中？

> ID：171318
> 
> 赞同：64
> 
> 时间：2008-10-05T01:27:17.403
> 
> 标签：php, xml

当用户单击表单按钮时，我正在生成大量要作为 post 变量传递给 API 的 XML。我还希望能够事先向用户展示 XML。

代码在结构上类似于以下内容：

```
<?php
    $lots of = "php";
?>

<xml>
    <morexml>

<?php
    while(){
?>
    <somegeneratedxml>
<?php } ?>

<lastofthexml>

<?php ?>

<html>
    <pre>
      The XML for the user to preview
    </pre>

    <form>
        <input id="xml" value="theXMLagain" />
    </form>
</html> 
```

我的 XML 是用一些 while 循环和东西生成的。然后它需要显示在两个地方（预览和表单值）。

我的问题是。如何在变量或其他任何内容中捕获生成的 XML，因此我只需生成一次，然后将其打印出来，与在预览中生成它，然后在表单值中再次生成一样？

* * *

## 回答 #1

> 赞同：122
> 
> 时间：2008-10-05T01:33:46.203

```
<?php ob_start(); ?>
<xml/>
<?php $xml = ob_get_clean(); ?>
<input value="<?php echo $xml ?>" />͏͏͏͏͏͏ 
```

* * *

## 回答 #2

> 赞同：46
> 
> 时间：2008-10-05T01:31:33.557

把它放在你的开始：

```
ob_start();
```

并取回缓冲区：

```
$value = ob_get_contents();
ob_end_clean();
```

有关详细信息，请参阅[http://us2.php.net/manual/en/ref.outcontrol.php](http://us2.php.net/manual/en/ref.outcontrol.php)和各个函数。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-10-05T01:33:20.697

听起来你想要[PHP 输出缓冲](http://us3.php.net/ob_start)

```
ob_start(); 
// make your XML file

$out1 = ob_get_contents();
//$out1 now contains your XML 
```

请注意，输出缓冲会停止发送输出，直到您“刷新”它。有关更多信息，请参阅[文档](http://us3.php.net/manual/en/outcontrol.examples.php)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-06T01:23:56.037

你可以试试这个：

```
<?php
$string = <<<XMLDoc
<?xml version='1.0'?>
<doc>
  <title>XML Document</title>
  <lotsofxml/>
  <fruits>
XMLDoc;

$fruits = array('apple', 'banana', 'orange');

foreach($fruits as $fruit) {
  $string .= "\n    <fruit>".$fruit."</fruit>";
}

$string .= "\n  </fruits>
</doc>";
?>
<html>
<!-- Show XML as HTML with entities; saves having to view source -->
<pre><?=str_replace("<", "&lt;", str_replace(">", "&gt;", $string))?></pre>
<textarea rows="8" cols="50"><?=$string?></textarea>
</html> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2022-02-24T20:33:19.837

经常使用时，一个小帮手可能会*有所帮助*：

```
class Helper
{
    /**
     * Capture output of a function with arguments and return it as a string.
     */
    public static function captureOutput(callable $callback, ...$args): string
    {
        ob_start();
        $callback(...$args);
        $output = ob_get_contents();
        ob_end_clean();
        return $output;
    }
} 
```

# windows - 如何将密钥重复率提高到操作系统限制之外？

> ID：171326
> 
> 赞同：60
> 
> 时间：2008-10-05T01:33:28.903
> 
> 标签：windows, visual-studio, macos, keyboard

我有使用键盘上的光标键浏览源代码的坏习惯。这是我 15 年来一直在做的事情，这当然意味着我的导航速度受到键盘速度的限制。在 Vista 和 OS X 上（我双启动 MacBook），我的按键重复率一直上升。但在 Visual Studio 和其他应用程序中，速度仍然比我希望的要慢得多。

如何在 Visual Studio 和其他文本编辑器中提高键重复率？

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2012-06-15T18:58:38.433

在 Windows 中，您可以使用系统调用 ( `SystemParametersInfo(SPI_SETFILTERKEYS,...)`) 进行设置。

我为自己写了一个实用程序：`keyrate <delay> <repeat>`.

[Github 存储库](https://github.com/EricTetz/keyrate/releases)。

万一链接消失的完整来源：

```
#include <windows.h>
#include <stdlib.h>
#include <stdio.h>

BOOL parseDword(const char* in, DWORD* out)
{
   char* end;
   long result = strtol(in, &end, 10);
   BOOL success = (errno == 0 && end != in);
   if (success)
   {
       *out = result;
   }
   return success;
}

int main(int argc, char* argv[])
{
   FILTERKEYS keys = { sizeof(FILTERKEYS) };

   if (argc == 1)
   {
      puts ("No parameters given: disabling.");
   }
   else if (argc != 3)
   {
      puts ("Usage: keyrate <delay ms> <repeat ms>\nCall with no parameters to disable.");
      return 0;
   }
   else if (parseDword(argv[1], &keys.iDelayMSec) 
         && parseDword(argv[2], &keys.iRepeatMSec))
   {
      printf("Setting keyrate: delay: %d, rate: %d\n", (int) keys.iDelayMSec, (int) keys.iRepeatMSec);
      keys.dwFlags = FKF_FILTERKEYSON|FKF_AVAILABLE;
   }

   if (!SystemParametersInfo (SPI_SETFILTERKEYS, 0, (LPVOID) &keys, 0))
   {
      fprintf (stderr, "System call failed.\nUnable to set keyrate.");
   }

   return 0;
} 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2010-09-01T17:29:38.493

很多时候我想在我的窗口中居中一个功能。滚动是唯一的方法。此外，在有很多非单词字符的代码中，Ctrl-left/right 仍然会很慢。我也使用键盘。不过，它对我来说有几个问题。一，它有时使用默认速度而不是我设置的实际值。另一个是有时它会忽略初始延迟。我仍然觉得它非常有用。他们在 4 年前说他们将在 6 个月内发布源代码...... :(

好的，根据修改 HCU\...\Keyboard Response 的人的建议，这对我来说效果很好。

```
[HKEY_CURRENT_USER\Control Panel\Accessibility\Keyboard Response]
"AutoRepeatDelay"="250"
"AutoRepeatRate"="13"
"BounceTime"="0"
"DelayBeforeAcceptance"="0"
"Flags"="59" 
```

Windows 标准自动重复延迟。13 毫秒（77 字符/秒）重复率。标志打开过滤键？这些值在登录时读取。请记住注销并重新登录以使其生效。

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2009-01-09T19:54:56.417

在 Mac OS X 上，打开 Global Preferences plist

```
open ~/Library/Preferences/.GlobalPreferences.plist 
```

然后更改 KeyRepeat 字段。较小的数字将加快您的光标速度。设置对话框只会将其设置为最小值 2，因此如果您选择 0 或 1，您将获得更快的光标。

我必须重新启动才能生效。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-05T04:59:30.423

对于 Windows，打开 regedit.exe 并导航到`HKEY_CURRENT_USER\Control Panel\Keyboard`. 根据您的喜好更改键盘速度。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-02-07T21:46:30.360

Visual Assist 有一个选项可以将您在 Visual Studio 中的有效键动作加倍，我一直在使用它。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-04-11T06:44:40.290

我在我的电脑上使用键盘王。它是免费软件，它可以将重复率提高到 200，这已经足够了。我建议将进程优先级设置为“高”，以实现更流畅的移动和更少的“重复锁定”，这种情况有时会发生并且非常烦人。具有高优先级，它完美地工作。

没有人理解我们为什么用箭头导航。这很有趣。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-06-27T07:20:49.660

[![键盘首选项窗口](https://i.stack.imgur.com/tqbmu.png)](https://i.stack.imgur.com/tqbmu.png)

正如*hyperlogic*中提到的，在 Mac OS X 上，内部有两个参数处理键盘速度：`KeyRepeat`和`InitialKeyRepeat`. 在系统偏好设置中，它们被映射到`Key Repeat Rate`和`Delay Until Repeat`滑块。滑块范围和相关的内部参数值（括号中）如下所示。它们似乎是 15 毫秒键盘采样间隔的乘数。

```
Key Repeat Rate (KeyRepeat)                 Delay Until Repeat (InitialKeyRepeat)
|--------------------------------|          |----------------------|-----------------|
slow (120)                      fast (2)    off (30000)            long (120)        short (25)
0.5 char/s                      33 char/s 
```

幸运的是，这些参数可以直接在`~/Library/Preferences/.GlobalPreferences.plist`文件中设置超出预定义的限制。我发现以下值对自己最方便：

```
KeyRepeat = 1         --> 1/(1*15 ms) = 66.7 char/s
InitialKeyRepeat = 15 --> 15*15 ms = 225 ms 
```

请注意，在最新的 Mac OS X 版本中，滑块的名称略有不同。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-05T01:38:34.383

我不知道如何加速超越极限，但我知道如何一键跳得更远。我的知识仅在 Windows 中，因为我没有 Mac 可以在其中执行此操作。`Ctrl`+`Arrow`跳过一个单词，并且根据编辑器的不同，它可能只是跳到空白的下一部分。您还可以使用`Ctrl`++`Shift`从`Arrow`任何方向选择一个单词。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-10-05T02:46:33.107

我喜欢一个人在键盘上工作。为什么？因为当你使用鼠标时，你必须抓住它。时间损失。

另一方面，有时似乎每个应用程序都有自己的内置键盘类型速率。更不用说 BIOS 属性或操作系统设置了。因此，我收集了可以非常快的快捷键（即，您键入`Ctrl`+ 右（箭头）-右-右比将手指放在右（箭头）键上更快:)。

以下是我认为最有价值的一些键盘快捷键（它适用于 Windows；我不确定 OS X）：

```
ctrl-right: Go to the end of the previous/the next word (stated before)
ctrl-left:  Go to the beginning of the previous/the word before (stated before)
ctrl-up:    Go to the beginning of this paragraph
            (or to the next paragraph over this)
ctrl-down:  Go to the end of this paragraph
            (or to the next paragraph after this)
ctrl-pos1:  Go to the beginning of the file
ctrl-end:   Go to the end of the file 
```

所有这些都可以与 shift 键结合使用，以便在执行此操作时选择文本。现在让我们来看看更奇怪的东西：

```
alt-esc:     Get the actual application into the background
ctrl-esc:    This is like pressing the "start-button" in Windows: You can
             navigate with arrow keys or shortcuts to start programs from here
ctrl-l:      While using Firefox this accesses the URL-entry-field to simply
             type URLs (does not work on Stack Overflow :)
ctrl-tab,
ctrl-pageup
ctrl-pagedwn Navigate through tabs (even in your development environment) 
```

所以这些是我在编程时需要的最常用的快捷方式。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2010-09-01T11:32:59.797

对于 OS X，内核扩展 KeyRemap4MacBook 将允许您微调各种键盘参数，其中包括按键重复率（我将我的设置为 15 毫秒，效果很好）。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-05T02:26:20.327

在 Mac 上，它是选项箭头来跳过一个单词和`⌥</kbd>+`Shift`+`Arrow` to select. `⌘</kbd>+`Arrow` skips to the end or beginning of a line or the end or beginning of a document. There are also the page up, page down, home and end keys ;) Holding shift selects with those too.``

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-04-14T13:50:38.077

似乎你不能在 Windows 7 上轻松做到这一点。

当您按住按钮时，速度由 Windows 注册表项控制：HCU->控制面板->键盘->键盘延迟。

通过将此参数设置为 0，您可以获得最大重复率。戏剧性的是，如果重复速度对你来说仍然很慢，你就不能低于 0。0-delay表示重复延迟为250ms。但是，250 毫秒的延迟仍然非常慢。看到这个：[http ://technet.microsoft.com/en-us/library/cc978658.aspx](http://technet.microsoft.com/en-us/library/cc978658.aspx)

您仍然可以访问辅助功能，但您应该知道这些选项是为了帮助残疾人使用他们的键盘，而不是为快速打字的极客提供帮助。他们不会帮忙。他们告诉你，使用 Linux。

我相信 Windows 的解决方案在于硬件控制。为您的键盘寻找特殊的驱动程序或尝试调整现有的驱动程序。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-01-05T14:54:55.457

尽管这个问题已经有好几年了，但我仍然不时在几个不同的开发者网站上遇到同样的问题。所以我想我可以提供一个替代解决方案，用于我的日常开发人员工作（因为 Windows 注册表设置从未对我有用）。

以下是我的小型 Autorepeat-Script（~ 125 行），可以通过 AutoHotkey_L 运行（缺点是它只能在 Windows 下运行，至少是 Vista、7、8.1）：

```
; ====================================================================
; DeveloperTools - Autorepeat Key Script
;
; This script provides a mechanism to do key-autorepeat way faster
; than the Windows OS would allow. There are some registry settings
; in Windows to tweak the key-repeat-rate, but according to widely 
; spread user feedback, the registry-solution does not work on all 
; systems.
;
; See the "Hotkeys" section below. Currently (Version 1.0), there
; are only the arrow keys mapped for faster autorepeat (including 
; the control and shift modifiers). Feel free to add your own 
; hotkeys.
;
; You need AutoHotkey (http://www.autohotkey.com) to run this script.
; Tested compatibility: AutoHotkey_L, Version v1.1.08.01
; 
; (AutoHotkey Copyright © 2004 - 2013 Chris Mallet and 
; others - not me!)
;
; @author   Timo Rumland <timo.rumland ${at} gmail.com>, 2014-01-05
; @version  1.0
; @updated  2014-01-05
; @license  The MIT License (MIT)
;           (http://opensource.org/licenses/mit-license.php)
; ====================================================================

; ================
; Script Settings
; ================

#NoEnv
#SingleInstance     force
SendMode            Input 
SetWorkingDir       %A_ScriptDir%

; Instantiate the DeveloperTools defined below the hotkey definitions
developerTools      :=  new DeveloperTools()

; ========
; Hotkeys
; ========

    ; -------------------
    ; AutoRepeat Hotkeys
    ; -------------------

    ~$UP::
    ~$DOWN::
    ~$LEFT::
    ~$RIGHT::
        DeveloperTools.startAutorepeatKeyTimer( "" )
    return

    ~$+UP::
    ~$+DOWN::
    ~$+LEFT::
    ~$+RIGHT::
        DeveloperTools.startAutorepeatKeyTimer( "+" )
    return

    ~$^UP::
    ~$^DOWN::
    ~$^LEFT::
    ~$^RIGHT::
        DeveloperTools.startAutorepeatKeyTimer( "^" )
    return

    ; -------------------------------------------------------
    ; Jump label used by the hotkeys above. This is how 
    ; AutoHotkey provides "threads" or thread-like behavior.
    ; -------------------------------------------------------
    DeveloperTools_AutoRepeatKey:
        SetTimer , , Off
        DeveloperTools.startAutorepeatKey()
    return

; ========
; Classes
; ========

    class DeveloperTools
    {
        ; Configurable by user
        autoRepeatDelayMs       :=  180
        autoRepeatRateMs        :=  40

        ; Used internally by the script
        repeatKey               :=  ""
        repeatSendString        :=  ""
        keyModifierBaseLength   :=  2

        ; -------------------------------------------------------------------------------
        ; Starts the autorepeat of the current captured hotkey (A_ThisHotKey). The given
        ; 'keyModifierString' is used for parsing the real key (without hotkey modifiers
        ; like "~" or "$").
        ; -------------------------------------------------------------------------------
        startAutorepeatKeyTimer( keyModifierString )
        {
            keyModifierLength := this.keyModifierBaseLength + StrLen( keyModifierString )

            this.repeatKey := SubStr( A_ThisHotkey, keyModifierLength + 1 )
            this.repeatSendString := keyModifierString . "{" . this.repeatKey . "}"

            SetTimer DeveloperTools_AutoRepeatKey, % this.autoRepeatDelayMs
        }

        ; ---------------------------------------------------------------------
        ; Starts the loop which repeats the key, resulting in a much faster 
        ; autorepeat rate than Windows provides. Internally used by the script
        ; ---------------------------------------------------------------------
        startAutorepeatKey()
        {
            while ( GetKeyState( this.repeatKey, "P" ) )
            {
                Send % this.repeatSendString
                Sleep this.autoRepeatRateMs
            }
        }
    } 
```

1.  将上述代码保存在文本文件 (UTF-8) 中，例如名为“AutorepeatScript.ahk”
2.  安装 AutoHotkey_L
3.  双击“AutorepeatScript.ahk”以享受更快的箭头键（或将文件放入您的自动启动文件夹）

（您可以在脚本中调整重复延迟和速率，请参阅“；可由用户配置”）。

希望这可以帮助！

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-10-06T09:59:55.900

好吧，这可能很明显，但是：

*   对于水平导航，我知道的所有编辑器都可以使用Home（行开始）、End（行结束）、 `Ctrl`- `Left`（左字）、`Ctrl`- （右字）`Right`

*   对于垂直导航，Page Up、Page Down、`Ctrl`- `Home`（文本开始）、`Ctrl`- `End`（文本结束）也可以

另外（附带说明），我想强制我的 Backspace 和 Delete 键不重复，以便删除（或替换）文本的唯一方法是*首先*标记它，*然后*删除它（或键入替换文本）。

* * *

## 回答 #15

> 赞同：-3
> 
> 时间：2008-10-05T04:35:54.667

不要逐个字符地导航。

在 Vim 中（参见[ViEmu](http://www.viemu.com/) for Visual Studio）：

*   `bw`-- 上一个/下一个词
*   `()`-- 上一个/下一个句子（句号分隔的文本）
*   `{}`-- 上/下一段（文本的空白行分隔部分）
*   `/?`-- 将光标移动到找到的文本的上一个/下一个出现处（w/ `set incsearch`）

此外，每个动作都以数字作为前缀，让您指定重复命令的次数，例如：

*   `20j`-- 向下跳 20 行
*   `3}`-- 下三段
*   `4w`-- 向前移动 4 个单词
*   `40G`-- 移动到（绝对）第 40 行

在编辑器中浏览文本很可能有等效的方法。如果没有，你应该考虑换一个更好的。

# c# - 通过 System.Reflection 访问内部成员？

> ID：171332
> 
> 赞同：24
> 
> 时间：2008-10-05T01:41:23.317
> 
> 标签：c#, .net, reflection, internal

我正在尝试对具有许多内部功能的类进行单元测试。这些显然也需要测试，但我的测试项目是独立的，主要是因为它涵盖了许多相关的小型项目。到目前为止，我所拥有的是：

```
FieldInfo[] _fields = 
    typeof(ButtonedForm.TitleButton).GetFields(
        BindingFlags.NonPublic | BindingFlags.Instance | 
        BindingFlags.DeclaredOnly);
Console.WriteLine("{0} fields:", _fields.Length);
foreach (FieldInfo fi in _fields)
{
    Console.WriteLine(fi.Name);
} 
```

这很好地吐出了所有私人成员，但仍然不显示内部。我知道这是可能的，因为当我在处理 Visual Studio 可以生成的自动生成测试时，它询问了与向测试项目显示内部结构有关的事情。好吧，现在我正在使用 NUnit 并且非常喜欢它，但是我怎样才能用它实现同样的目标呢？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-10-05T01:44:30.940

使用该[`InternalsVisibleTo`](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.internalsvisibletoattribute.aspx)属性向您的单元测试程序集授予对程序集内部成员的访问权限会更合适。

这是一个链接，其中包含一些有用的附加信息和演练：

*   [内部结构的奇迹可见](https://jason.whitehorn.us/blog/2007/11/08/the-wonders-of-internalsvisibleto/)

要实际回答您的问题... Internal 和 protected 在 .NET Reflection API 中无法识别。这是来自[MSDN](http://msdn.microsoft.com/en-us/library/ms173183.aspx)的引文：

> C# 关键字 protected 和 internal 在 IL 中没有意义，也没有在反射 API 中使用。IL 中对应的术语是 Family 和 Assembly。要使用反射识别内部方法，请使用[IsAssembly](http://msdn.microsoft.com/en-us/library/system.reflection.methodbase.isassembly.aspx)属性。要识别受保护的内部方法，请使用[IsFamilyOrAssembly](http://msdn.microsoft.com/en-us/library/system.reflection.methodbase.isfamilyorassembly.aspx)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-05T01:44:43.483

将[InternalsVisibleTo](http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.internalsvisibletoattribute.aspx)程序集级别属性添加到您的主项目，以及测试项目的程序集名称应该使内部成员可见。

例如，将以下内容添加到任何类之外的程序集中：

```
[assembly: InternalsVisibleTo("AssemblyB")] 
```

或者对于更具体的定位：

```
[assembly:InternalsVisibleTo("AssemblyB, PublicKey=32ab4ba45e0a69a1")] 
```

请注意，如果您的应用程序程序集具有强名称，那么您的测试程序集也需要具有强名称。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-05T01:47:13.133

我认为您需要问是否应该为私有方法编写单元测试？如果您为公共方法编写单元测试，并具有“合理”的代码覆盖率，那么您是否已经测试了任何需要调用的私有方法？

将测试绑定到私有方法将使测试更加脆弱。您应该能够在不破坏任何测试的情况下更改任何私有方法的实现。

参考：

[http://weblogs.asp.net/tgraham/archive/2003/12/31/46984.aspx](http://weblogs.asp.net/tgraham/archive/2003/12/31/46984.aspx) [http://richardsbraindump.blogspot.com/2008/08/should-i-unit-test-private-methods.html](http://richardsbraindump.blogspot.com/2008/08/should-i-unit-test-private-methods.html) [http://junit.sourceforge.net/doc/faq/faq.htm#tests_11](http://junit.sourceforge.net/doc/faq/faq.htm#tests_11) [http://geekswithblogs.net/geekusconlivus/archive/2006/07/13/85088.aspx](http://geekswithblogs.net/geekusconlivus/archive/2006/07/13/85088.aspx)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-05T06:48:48.423

您的代码仅显示字段 - 所以我希望它不会显示任何内部成员，因为字段应该始终是私有的 IMO。（常量可能是个例外。）

ButtonedForm.TitleButton 实际上有任何非私有字段吗？如果您试图找到内部*方法*，那么显然您需要调用`GetMethods`（或`GetMembers`）来获取它们。

正如其他人所建议的那样，`InternalsVisibleTo`对于测试非常方便（并且几乎仅用于测试！）。至于你是否应该测试内部方法——我当然发现这样做很有用。我不认为单元测试*完全*是黑盒测试。通常，当您知道公共功能是使用以简单方式连接的一些内部方法来实现时，更容易对每个内部方法进行彻底测试，并对公共方法进行一些“伪集成”测试。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-03T20:41:40.400

使用 InternalsVisible 的理由是在我的情况下。我们购买了图表控件的源代码。我们找到了需要对源代码控制进行一些修改并编译我们自己的版本的地方。现在为了确保我们没有破坏任何东西，我需要编写一些需要访问一些内部字段的单元测试。

这是 InternalsVisible 有意义的完美案例。

不过，我想知道，如果您无法访问源代码，您会怎么做？你怎么能进入内部领域？.Net Reflector 可以看到该代码，但我猜它只是在查看 IL。

# ruby-on-rails - 验证终端命令在 Rails 中成功运行的最佳方法是什么？

> ID：171343
> 
> 赞同：6
> 
> 时间：2008-10-05T01:51:07.307
> 
> 标签：ruby-on-rails, ruby, validation, terminal, system

我正在编写一个快速的 Rails 应用程序，并且想知道如何验证 exec'd 命令是否成功。我正在运行的两个命令是和 SVN 更新，以及从一个目录到另一个目录的 cp。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-05T02:32:54.133

如果您使用[Kernel.system()](http://www.ruby-doc.org/core/classes/Kernel.html#M005982)方法，它将返回一个布尔值，指示命令成功。

```
result = system("cp -r dir1 dir2")
if(result)
#do the next thing
else
# handle the error 
```

[这里](http://blog.jayfields.com/2006/06/ruby-kernel-system-exec-and-x.html)对不同的 ruby​​ 系统命令进行了很好的比较。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-05T02:31:12.640

你是如何执行外部命令的？Ruby`system()`函数返回`true`或`false`取决于命令是否成功。此外，`$?`还包含错误状态。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-05T04:02:30.833

1.  只是为了迂腐，您不能验证`exec`'d 命令，因为用 'd 命令`exec`替换当前程序`exec`，因此该命令永远不会返回到 Ruby 进行验证。
2.  至少对于 cp，您可能会更好地使用 FileUtils 模块（Ruby 标准库的一部分），而不是直接使用 shell。
3.  如上所述，预定义变量将为您提供要由反引号运算符`$?`执行的最后一个命令的返回码。`system()`

* * *

## 回答 #4

> 赞同：-4
> 
> 时间：2008-10-05T02:16:33.513

对于 SVN 更新，请检查更新前后的版本号。

```
svn_start_version = IO.popen("svn info").readlines[4]
`svn update`
svn_end_version = IO.popen("svn info").readlines[4]
if svn_end_version > svn_start_version
  "success"
end 
```

对于 cp，您可以对原始文件与复制文件进行文件大小检查。

```
source_file_size = IO.popen("du file1").readlines
`cp file1 file2`
dest_file_size = IO.popen("du file2").readlines
if dest_file_size == source_file_size
  "success"
end 
```

# matlab - matlab 快速傅里叶变换。卡住频率和结果之间的理解关系

> ID：171345
> 
> 赞同：6
> 
> 时间：2008-10-05T01:52:17.243
> 
> 标签：matlab, fft

我们正在尝试分析围绕圆柱体的流动，并且我们有一组从风洞实验中获得的 Cp 值。最初，我们以 20 Hz 的采样频率开始，并尝试在 matlab 中使用 FFT 找到涡旋脱落的频率。我们得到了大约 7 Hz 的频率。接下来，我们做了同样的实验，但我们唯一改变的是采样频率——从 20 Hz 到 200 Hz。我们得到涡旋脱落的频率约为 70 Hz（这是图中峰值所在的位置）。无论我们输入什么 Cp 数据，图表都不会改变。峰值不同的唯一时间是我们改变采样频率的时候。涡旋脱落频率的增加似乎与采样频率成正比，这似乎根本没有意义。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-05T05:57:07.530

您看到的问题与“数据混叠”有关，因为 FFT 能够检测到高于[**奈奎斯特频率**](http://en.wikipedia.org/wiki/Nyquist_Frequency)（采样频率的一半）的频率的限制。

使用数据混叠，实际频率的峰值将以（实际频率*模*奈奎斯特频率）为中心。在您的 20 Hz 采样中（假设 70 Hz 是真实频率，这会导致频率为零，这意味着您没有看到真实信息。可以帮助您解决此问题的一件事是使用 FFT“窗口”。

您可能遇到的另一个问题与通过单 FFT 测量生成噪声数据有关。最好获取大量数据，使用重叠窗口，并确保您至少有 5 个 FFT，您平均可以找到您的结果。正如 Steven Lowe 所提到的，如果可能，您还应该以更快的速度进行采样。我建议以您的仪器可以采样的最快速度进行采样。

最后，我建议您阅读[**C 中的数字食谱的**](http://www.nrbook.com/a/bookcpdf.php)一些摘录（<-- 链接）：

*   [**第 12.0 节——FFT 简介**](http://www.nrbook.com/a/bookcpdf/c12-0.pdf)
*   [**第 12.1 节**](http://www.nrbook.com/a/bookcpdf/c12-1.pdf)（讨论数据别名）
*   [**第 13.4 节**](http://www.nrbook.com/a/bookcpdf/c13-4.pdf)（讨论 FFT 开窗）

您无需阅读 C 源代码——只需阅读说明即可。C 的数字食谱有关于这个主题的极好的浓缩信息。

如果您还有其他问题，请在评论中留下。我会尽力回答他们。

祝你好运！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-05T02:17:05.070

这可能不是编程问题，听起来像是实验测量问题

我认为采样频率必须至少是振荡频率的两倍，否则你会得到伪影；这可能解释了差异。请注意，在这两种情况下，FFT 频率与采样频率的比率都是 0.35。你能用更高的采样率重复这个实验吗？我在想，如果这是一个在强风中的狭窄圆柱体，它的振动/振荡速度可能比采样率可以检测到的快。.

我希望这会有所帮助——有 97.6% 的可能性我不知道我在说什么；-)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-05T09:39:44.630

如果这不是混叠问题，听起来您可以在归一化频率范围内绘制频率响应，该频率响应将随采样频率而变化。这是一个在 Matlab 中绘制信号频率响应的相当好的方法示例：

```
Fs = 100;
Tmax = 10;
time = 0:1/Fs:Tmax; 
omega = 2*pi*10; % 10 Hz
signal = 10*sin(omega*time) + rand(1,Tmax*Fs+1);

Nfft = 2^8;
[Pxx,freq] = pwelch(signal,Nfft,[],[],Fs)
plot(freq,Pxx) 
```

请注意，必须将采样频率显式传递给`pwelch`命令才能输出“真实”频率数据。否则，当您更改采样频率时，发生共振的 bin 似乎会发生变化，这与您描述的问题类似。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-02T14:49:32.433

我认为您需要认真阅读数字信号处理，然后才能开始了解 DFT (FFT) 的所有细微差别。如果我是你，我会首先阅读这本好书：

[离散时间信号处理](https://rads.stackoverflow.com/amzn/click/com/0137549202)

如果你想要更多能够真正扩展你能力的数学处理，

[Körner 的傅里叶分析](https://rads.stackoverflow.com/amzn/click/com/0521389917)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-05T02:05:55.810

看看[这个](https://stackoverflow.com/questions/138558/vb-fft-stuck-understanding-relationship-of-results-to-frequency)相关的问题。虽然最初被问及关于 VB 的问题，但回答通常是关于 FFT

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-07T00:03:09.427

我尝试使用上面的频率响应代码，但似乎我在 Matlab 中没有合适的工具箱。有没有办法在不使用 fft 命令的情况下做同样的事情？到目前为止，这就是我所拥有的：

```
 % FFT Algorithm

Fs = 200;                     % Sampling frequency
T = 1/Fs;                     % Sample time
L = 65536;                    % Length of signal
t = (0:L-1)*T;                % Time vector
y = data1;                    % Your CP values go in this vector

NFFT = 2^nextpow2(L); % Next power of 2 from length of y
Y = fft(y,NFFT)/L;
f = Fs/2*linspace(0,1,NFFT/2);

% Plot single-sided amplitude spectrum.
loglog(f,2*abs(Y(1:NFFT/2))) 
title(' y(t)')
xlabel('Frequency (Hz)')
ylabel('|Y(f)|') 
```

我认为我使用的代码可能有问题。我不确定是什么。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-07T07:04:10.717

我的一位同事为频谱分析编写了一些很好的 GPL 许可函数： [http ://www.mecheng.adelaide.edu.au/~pvl/octave/](http://www.mecheng.adelaide.edu.au/~pvl/octave/)

（**更新**：此代码现在是 Octave 模块之一的一部分：http:
[//octave.svn.sourceforge.net/viewvc/octave/trunk/octave-forge/main/signal/inst/](http://octave.svn.sourceforge.net/viewvc/octave/trunk/octave-forge/main/signal/inst/)。
但这可能会很棘手从那里只提取你需要的部分。）

它们是为 Matlab 和 Octave 编写的，主要用作信号处理工具箱中类似函数的替代品。（所以[上面的代码](https://stackoverflow.com/questions/171345/matlab-fft-stuck-understanding-relationship-between-frequency-and-result#171758)应该仍然可以正常工作。）

它可能有助于您的数据分析；比滚动你自己的更好`fft`。

# c# - c# 将用户设置存储在数据库中

> ID：171352
> 
> 赞同：5
> 
> 时间：2008-10-05T02:06:34.780
> 
> 标签：c#, .net, database, repost

有没有一种简单的方法可以将一个人的用户设置存储在 sql 2000 数据库中。理想情况下，所有设置都在一个字段中，这样我就不必每次添加设置时都编辑表格。如果有人有示例，我正在考虑序列化设置类。

我不想使用存储在持久存储中的内置 .NET 用户设置的原因是工作使用超级强制配置文件，因此在用户注销时，设置会被清除，这很痛苦。我之前发布过要求任何解决方案，但没有得到太多回应。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-05T04:32:11.693

VS 设计器将属性设置保存在[ApplicationSettingsBase](http://msdn.microsoft.com/en-us/library/system.configuration.applicationsettingsbase.aspx)类中。默认情况下，这些属性被序列化/反序列化为每个用户的 XML 文件。您可以使用自定义[SettingsProvider](http://msdn.microsoft.com/en-us/library/system.configuration.settingsprovider.aspx)覆盖此行为，您可以在其中添加数据库功能。只需将`SettingsProvider`属性添加到 VS 生成的`Settings`类中：

```
[SettingsProvider(typeof(CustomSettingsProvider))]
internal sealed partial class Settings { 
   ...
} 
```

[RegistrySettingsProvider](http://msdn.microsoft.com/en-us/library/ms181001.aspx)就是一个很好的例子。

[我在这里](https://stackoverflow.com/questions/170825/how-to-serialize-systemconfigurationsettingsproperty#170932)以同样的方式回答了另一个类似的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-05T02:10:11.700

您可以轻松地在 C# 中序列化类：[http](http://www.google.com/search?q=c%23+serializer) ://www.google.com/search?q=c%23+serializer 。您可以将 XML 存储在 varchar 字段中，或者如果要使用二进制序列化程序，可以将其存储在“图像”数据类型中，这实际上只是二进制。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-05T02:15:53.997

您可以序列化到数据库中，或者您可以创建一个包含名称-值对并由 UserId 键入的用户设置表。这样做的好处是更容易通过 RDMS 工具进行查询和更新。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-05T04:08:05.253

首先你需要你的桌子。

```
create table user_settings
(
  user_id nvarchar(256) not null,
  keyword nvarchar(64) not null,
    constraint PK_user_settings primary key (user_id, keyword),
  value nvarchar(max) not null
) 
```

然后你可以构建你的 API：

```
public string GetUserSetting(string keyword, string defaultValue);
public void SetUserSetting(string keyword, string value); 
```

如果您已经在进行 CRUD 开发（我从数据库的存在和可用性假设），那么这应该很容易实现。

# real-time - 大量数据的第三方数据交付

> ID：171363
> 
> 赞同：0
> 
> 时间：2008-10-05T02:22:35.560
> 
> 标签：real-time

有谁知道拥有大量数据实时馈送的网站是如何工作的？我指的是股票网站之类的东西，他们可以在其中实时告诉您（嗯，主要是 20 分钟的延迟，但仍然是实时的——据我所知是 20 分钟）。

他们每秒都有成千上万的数据块交付给他们，我想：MSFT 25.00 +.23 VOL 12000 ???? 对于在某个时间间隔内发生变化的每只股票。

那么，是否只有不断的小推动？还是您认为网站会从拥有真实数据的地方拉出并说“给我从 CST 12:23:45 到现在的所有更改”类型查询？

我问这个是因为在工作中我们可能会遇到这样的情况，我们需要在我们的应用程序的指尖获得这样的实时信息，并且每秒一遍又一遍地点击我们的第三方提供商是没有意义的......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-05T02:50:54.097

通常在两方之间定义了一个服务器/客户端协议。在我为之工作的公司里，这种联系始终保持着。

这是与您的股票示例一起使用的实时数据馈送信息

[纽交所](http://www.nyxdata.com/)、[纳斯达克](http://www.nasdaqtrader.com/trader.aspx?id=dpspecs)

数据提供者通常还拥有包含（延迟）批处理数据的 FTP 站点。想到的一个是[NWS EMWIN](http://www.weather.gov/emwin/user-intro.htm)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-05T02:50:15.910

[Twitter](http://twitter.com/)等网站通过[XMPP](http://xmpp.org/)（[Wiki 链接](http://en.wikipedia.org/wiki/Jabber)）将数据实时馈送到某些已批准的网站。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-05T03:14:40.663

从广义上讲，推送模型将是实现“实时”传输的最佳方式，特别是在您谈论大量数据时。

但是，在使用纯推送模型来从丢失的数据中恢复时，您总是会遇到问题。

取决于您的数据的性质，这可能不是问题（将视频传输视为模拟，其中数据量很大，但有足够的冗余可以从丢失的数据中恢复）。而且，如果您对数据有任何控制权，则可以在其中构建一些冗余。例如，在每个更改事件上，您都可以提供绝对值而不是更改，或者以前的值和新的值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-09T16:56:57.487

我已经这样做了，试图从源中检索股票报价，并在主源失败或超时时回退到报价的带时间戳的磁盘缓存。

# asp.net - 将更新推送到 ASP.NET webfarm 的策略？

> ID：171365
> 
> 赞同：2
> 
> 时间：2008-10-05T02:25:05.693
> 
> 标签：asp.net, iis, deployment, server-push, web-farm

大多数人如何处理更新在 webfarm 中运行的 ASP.NET 应用程序？我遇到的问题是，由于应用程序正在使用并且请求关联性不粘，当我们推送更新时，用户在进程请求时遇到错误，请求可能由错误版本的应用程序处理。你怎么做到这一点？使整个应用程序脱机并完成推送，还是您实时更新并让芯片落在可能的地方？理想情况下，我们希望尽可能减少停机时间。

任何想法/建议/指针将不胜感激

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-05T02:43:38.417

使一半服务器不可访问，更新它们，将所有不可访问的服务器翻转为可访问，反之亦然，更新另一半，然后将另一半备份。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-05T14:39:28.100

这就是我们所做的：

在场中的特定服务器上耗尽活动会话，在此期间不会将新流量路由到该服务器。

将补丁应用到耗尽的服务器

耗尽剩余服务器的会话

允许流量返回原始服务器

当其他服务器耗尽时，应用补丁并让它们恢复生机。

# reflection - 什么是反射？

> ID：171366
> 
> 赞同：6
> 
> 时间：2008-10-05T02:26:06.287
> 
> 标签：reflection, metaprogramming

我对 ASP.NET 很陌生。我来自 VB6/ASP（经典）/SQL Server 2000 背景。我正在阅读很多有关 Visual Studio 2008 的内容（已经安装并正在四处寻找）。我已经阅读了有关“反射”的内容，并希望有人尽可能地向我上面编写的技术的老开发人员解释，反射到底是什么以及我为什么要使用它......我很难得到我的头围绕着那个。谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-05T02:32:19.813

反射是您如何探索不同类型的内部，而无需通常访问（即私有、受保护等成员）。

它还用于动态加载 DLL 并访问其中定义的类型和方法，而无需将它们静态编译到您的项目中。

简而言之：Reflection 是你的工具包，用于窥探一段代码的底层。

至于为什么要使用它，它通常只用于复杂的情况，或者代码分析。另一个常见用途是将预编译的插件加载到您的项目中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-05T02:40:47.753

反射允许您以编程方式加载程序集，获取程序集中所有类型的列表，获取这些类型中所有属性和方法的列表等。

举个例子：

```
myobject.GetType().GetProperty("MyProperty").SetValue(myobject, "wicked!", null) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-05T02:39:10.267

它允许将对象的内部反映到外部世界（使用所述对象的代码）。

在像 C#（和 Java）这样的静态类型语言中的一个实际用途是允许在运行时通过字符串调用方法/成员（例如方法的名称 - 也许您不知道将在编译时使用的方法的名称时间）。

在动态语言的上下文中，我没有听过这个术语（因为通常你不担心上面的问题），然后可能遍历方法/成员列表等......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-05T02:39:38.317

**反射是.Net 在运行时**操作或提取程序集、类或方法信息的手段。例如，您可以在运行时创建一个类，包括它的方法。正如 monoxide 所述，反射用于动态加载程序集作为插件，或者在预先情况下，它用于创建面向 .Net 的 .Net 编译器，如 IronPython。

**更新**：您可以参考[元编程](http://en.wikipedia.org/wiki/Metaprogramming)主题及其相关主题以获取更多详细信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-05T02:44:38.167

当您在 .NET（ASP.NET、Windows 窗体、命令行、类库等）中构建*任何*程序集时，还会在程序集中创建许多元数据“定义表”，存储有关方法、字段和类型的信息您在代码中编写的类型、字段和方法。

.NET 中 System.Reflection 命名空间中的类允许您对这些表进行枚举和交互，为您提供“对象模型”来查询和访问这些表中的项目。

反射的一种常见用途是为您的应用程序提供可扩展性（插件）。例如，反射允许您从文件路径动态加载程序集，查询其类型以获得特定的有用类型（例如您的应用程序可以调用的接口），然后实际调用此外部程序集上的方法。

自定义属性也与反射齐头并进。例如，NUnit 单元测试框架允许您通过将 [Test] {TestFixture] 属性添加到您自己的代码来指示测试类和测试方法。

但是，NUnit 测试运行程序必须使用反射来加载您的程序集，搜索所有出现的具有 test 属性的方法，然后实际调用您的测试。

这大大简化了它，但是它为您提供了一个很好的实际示例，说明反射是必不可少的。

反射当然很强大，但是请注意，它允许您完全忽略面向对象编程中访问修饰符（封装）的基本概念。

例如，您可以轻松地使用它来检索类中的私有方法列表并实际调用它们。出于这个原因，您需要仔细考虑如何以及在何处使用它，以避免绕过封装和非常紧密耦合（不良）的代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-11-17T12:05:28.560

反射是检查应用程序元数据的过程。换句话说，在阅读属性时，您已经看过反射提供的一些功能。反射使应用程序能够收集有关自身的信息并根据这些信息采取行动。反射比正常执行静态代码要慢。但是，它可以为您提供静态代码无法提供的灵活性

# javascript - 我可以将 Windows 小工具中的记录保存在文件或其他存储（数据库等）中吗？

> ID：171367
> 
> 赞同：3
> 
> 时间：2008-10-05T02:26:11.450
> 
> 标签：javascript, html, windows-desktop-gadgets

我打算创建一个简单的小工具来创建一个 TO DO 列表应用程序。**这只是为了练习和探索 Windows Gadget**。如何将值存储在数据库中？尽可能地，我不想将本地 http 处理程序文件设置为将值存储到文件或数据库的一种手段。

**注意**：我用 html 和 javascript 标记它，因为我知道它使用这样的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-05T03:02:01.720

安装后，小工具将以登录用户的所有权限运行。因此，您应该能够访问本地文件系统并实例化 COM 对象（例如 ADO）以连接到数据库。

这里的小伙子写了一个小工具设置持久性管理器，以允许小工具在侧边栏中在卸载和重新安装之间保存它们的设置。他使用 将`Scripting.FileSystemObject`设置写入文件：

> [http://channel9.msdn.com/playground/Sandbox/231595/](http://channel9.msdn.com/playground/Sandbox/231595/)

这也值得一读以了解小工具的安全性：

> [http://msdn.microsoft.com/en-us/library/aa965881(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa965881(VS.85).aspx)

# optimization - 这些天什么时候使用定点

> ID：171399
> 
> 赞同：23
> 
> 时间：2008-10-05T02:53:37.087
> 
> 标签：optimization, floating-point, performance, numerical, fixed-point

对于激烈的数字运算，我正在考虑使用定点而不是浮点。当然，定点类型的大小有多少字节，它将在什么 CPU 上运行，我是否可以使用（对于英特尔）MMX 或 SSE 或任何新事物出现……

我想知道这些天浮点运行速度是否比以往任何时候都快，是否值得考虑定点？是否有一般的经验法则，我们可以说它会影响超过几个百分点？35,000 英尺的数值性能概述是什么？（顺便说一句，我假设大多数计算机都使用通用 CPU，而不是 DSP 或专用嵌入式系统。）

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-10-05T02:55:34.323

它仍然值得。浮点比过去快，但定点也是。如果您关心超出 IEEE 754 所保证的精度，那么固定仍然是唯一的方法。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-10-07T12:37:08.860

在处理大量数据的情况下，定点的内存效率可以提高一倍，例如，一个四字节长的整数而不是一个八字节的双精度数。大型地理空间数据集中经常使用的一种技术是将所有数据减少到一个共同的来源，以便可以处理最高有效位，并使用定点整数处理其余数据。浮点仅在点确实浮动时才重要，即您正在以非常高的精度处理非常广泛的数字。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-10-05T08:18:42.203

使用固定小数的另一个好理由是舍入更简单且可预测。大多数财务软件使用定点任意精度小数和半偶数舍入来表示货币。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-10-05T12:38:18.110

使用定点几乎总是更快（x86、奔腾、68k 和 ARM 的经验）。但是，它也可以取决于应用程序类型。对于图形编程（定点的主要用途之一），我已经能够使用预构建的余弦表、日志表等来优化代码。而且基本的数学运算也被证明更快。

对财务软件的评论。在较早的答案中说过，定点对于财务计算很有用。以我自己的经验（大型金库管理系统的开发和信用卡处理的丰富经验）我不会使用定点。使用浮点数或定点数都会出现舍入误差。我们总是使用整数来表示货币金额，计算可能的最低金额（欧元或美元为 1c）。这确保不会丢失部分金额。在进行复杂计算时，会将值转换为双精度数，应用特定于应用程序的舍入规则，并将结果转换回整数。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-05T08:40:21.083

当硬件不支持浮点或硬件实现很糟糕时使用定点。

为它上课时也要小心。由于（非）必要的类副本，在进行分析时，您认为很快的东西实际上可能会变成狗。然而，这是另一个问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-05-28T11:07:48.557

**使用定点的**另一个原因**`ARM`是设备，如手机和平板电脑，缺乏 FPU（至少其中很多）。**

 **对于开发实时应用程序，使用定点算法优化函数是有意义的。FFT（快速傅立叶变换）的实现对图形非常重要，它的改进基于依赖浮点运算的效率。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-10-05T03:10:43.980

由于您使用的是通用 CPU，我建议不要使用定点，除非性能对您的应用程序非常重要，以至于您必须计算每个 tic。当你有一个 CPU 时，实现定点和处理溢出等问题的麻烦是不值得的，它会为你做这件事。

恕我直言，仅当您使用没有硬件支持浮点运算的 DSP 时，才需要定点。

# php - PHP-MySQL 或 MySQLi 中哪个最快？

> ID：171400
> 
> 赞同：56
> 
> 时间：2008-10-05T02:53:44.623
> 
> 标签：php, mysql, mysqli

我想知道是否有人对这种二分法有任何第一手经验。一些博客说mysql扩展比mysqli快。这是真的？

我只问速度。我知道 mysqli 具有旧扩展中不存在的功能。

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2008-10-05T03:47:53.593

在我见过的大多数基准测试中，MySQL 扩展比 MySQLi 快得多。然而，差异是如此之小，以至于这可能不应该成为您在两者之间做出决定的标准。

其他因素使 mysql 和 mysqli 之间的性能差异相形见绌。使用 mod_php 或 FastCGI、像 APC 这样的字节码缓存，或者明智地使用数据缓存来减少数据库命中，比选择 MySQL 扩展对 PHP 脚本的整体性能更有好处。

不要一分钱一分货，一分钱一分货！:-)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-12-29T15:28:33.917

“这取决于。”

例如，[PHP MySQL vs MySQLi Database Access Metrics](http://af-design.com/blog/2009/01/30/php-mysql-vs-mysqli-database-access-metrics/)和随后的评论指出了两种方式的论点。

如果你有一个成熟的数据库和代码库，做一些测试，看看你的系统有什么用。如果没有，请停止担心过早的优化。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-01-17T08:33:32.787

见[http://php.net/manual/en/mysqlinfo.api.choosing.php](http://php.net/manual/en/mysqlinfo.api.choosing.php)

> 所有三个扩展的整体性能被认为是大致相同的。尽管扩展的性能只占 PHP Web 请求总运行时间的一小部分。通常，影响低至 0.1%。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-08T18:46:24.337

PHP 文档[对 mysql、mysqli 和 PDO 进行了很好的比较](http://ca3.php.net/manual/en/mysqli.overview.php)。我知道您只询问了速度，但其他人可能会觉得这很有用。它讨论了选项之间的功能差异。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-07-15T18:04:25.643

> 也许，这可能是做出正确选择的理由 :: [The Plot to Kill PHP MySQL Extension](http://www.phpclasses.org/blog/post/153-The-Plot-to-Kill-PHP-MySQL-Extension.html)

“是的，你没看错。最近，Phillip Olson 向 PHP 内部邮件列表发送了一份提议，在未来的 PHP 版本中取消原有的 PHP MySQL 扩展。”

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-10-05T03:08:27.137

根据[ceejayoz](https://stackoverflow.com/users/2297/ceejayoz)链接的所有 Google 基准测试结果，在所有基准测试中，MySQL 似乎至少比 MySQLi 快一点。我确实建议阅读结果以了解详细信息，但只是想我会发布一些直接回答问题并提高 ceejayoz 答案的内容。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-12-28T07:24:29.487

相对于 PHP 编程语言，MySQL 是旧的数据库驱动程序，而 MySQLi 是改进的驱动程序。MySQLi 利用了 MySQL 5 的新特性。

MySQLi 的功能取自 php.net 站点：

*   面向对象的接口
*   支持准备好的报表
*   支持多个语句
*   交易支持
*   增强的调试功能
*   嵌入式服务器支持

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-02-25T16:08:22.047

除非毫秒很重要，否则不要担心。当然，如果您不需要 mysqli 提供的额外功能，那么只需坚持使用久经考验的 mysql。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-12-24T20:11:56.753

```
<?php
$start = microtime();
$c = new mysqli('localhost', 'username', 'userpass', 'username_dbname');
$c -> select_db('username_dbname');

$q = $c -> query("SELECT * FROM example");

while ($r = $q -> fetch_array(MYSQLI_ASSOC))
  {
  echo $r['col1'] . "<br/>\n";
  }

$me = $c -> query("SELECT col1 FROM example WHERE id='11'") -> fetch_array(MYSQLI_ASSOC);

echo $me['col1'];
echo (microtime() - $start);
?> 
```

为什么在使用 mysqli oop 时，使用 mysql 或 mysqli 程序风格的这个脚本会略微提高速度？测试上述脚本时，我得到的时间比使用其他脚本时要多 0.0009 秒。当使用 mysql 或 mysqli 程序时，我以每种不同的样式加载脚本 20 倍，并且两者始终高于 0.001。我将上述脚本加载 20 倍，但低于 0.001 5 倍。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2013-06-22T19:33:36.497

**MySQLi与****MySQL**相比有两个基本优势；准备好的语句是避免 SQL 注入攻击的好方法。其次，MySQL（或 mariaDB）将尽最大努力优化准备好的语句，因此您有可能在那里进行速度优化。使数据库满意而提高速度将大大超过 MySQL 和 MySQLi 之间的微小差异。

如果您正在输入语句，您自己会像`SELECT * FROM users WHERE ID=$user_id`数据库一样将其视为一个独特的语句，每个新值为`$user_id`. 但是准备好的语句`SELECT * FROM users WHERE ID=?`更有可能让数据库执行一些优化/缓存。

但是比较没有实际意义，因为 MySQL 现在已被**正式弃用**。从马口中：

PHP 5.5.x 中已弃用的功能

ext/mysql 弃用

原来的 MySQL 扩展现已弃用，并且`E_DEPRECATED`在连接到数据库时会产生错误。相反，使用**MySQLi**或**PDO_MySQL**扩展。

# javascript - 在 Internet Explorer 中实现 Mozilla 的 toSource() 方法

> ID：171407
> 
> 赞同：14
> 
> 时间：2008-10-05T03:03:41.077
> 
> 标签：javascript

有没有人为 Internet Explorer 和其他非 Gecko 浏览器实现了 Mozilla 的 Object.toSource() 方法？我正在寻找一种将简单对象序列化为字符串的轻量级方法。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2011-04-11T21:55:11.867

请考虑以下事项：（使用 FireFox 3.6 时）

```
javascript:
  x=function(){alert('caveat compter')};
  alert(['JSON:\t',JSON.stringify(x),'\n\ntoSource():\t',x.toSource()].join('')); 
```

显示：

> JSON：
> 
> toSource(): (function () {alert("caveat compter");})

甚至：

```
javascript:
x=[];x[3]=x;
alert('toSource():\t'+x.toSource());
alert('JSON can not handle this at all and goes "infinite".');
alert('JSON:\n'+JSON.stringify(x)); 
```

显示：

> toSource(): #1=[, , , #1#]

以及 JSON 的 stackoverflow 递归题外话之后的“going 'infinite'”消息。

这些示例强调了从 toSource() 呈现的 JSON 表示中明确排除的表达式的微妙之处。

在所有情况下，编写一个程序来复制相同的结果并不容易，就像 Gecko toSource() 原语一样，它非常强大。

以下是复制 toSource() 功能的程序必须成功处理的一些“移动目标”：

```
javascript:
function render(title,src){ (function(objRA){
    alert([ title, src,
        '\ntoSource():',objRA.toSource(),
        '\nJSON:',JSON.stringify(objRA)     ].join('\n'));
    })(eval(src));
}
render('Simple Raw Object source code:',
    '[new Array, new Object, new Number, new String, ' +
        'new Boolean, new Date, new RegExp, new Function]'  );

render( 'Literal Instances source code:',
    '[ [], 1, true, {}, "", /./, new Date(), function(){} ]'    );

render( 'some predefined entities:',
    '[JSON, Math, null, Infinity, NaN, ' +
        'void(0), Function, Array, Object, undefined]'      ); 
```

显示：

```
    简单原始对象源代码：
    [新数组，新对象，新数字，新字符串，
                新布尔值、新日期、新正则表达式、新函数]

    源（）：
    [[], {}, (new Number(0)), (new String("")),
                (new Boolean(false)), (new Date(1302637995772)), /(?:)/,
                            （函数匿名（）{}）]

    JSON：
    [[],{},0,"",false,"2011-04-12T19:53:15.772Z",{},null]

```

然后显示：

```
    文字实例源代码：
    [ [], 1, true, {}, "", /./, new Date(), function(){} ]

    源（）：  
    [[], 1, true, {}, "", /./, (new Date(1302638514097)), (function () {})]

    JSON：  
    [[],1,true,{},"",{},"2011-04-12T20:01:54.097Z",null]

```

最后：

```
    一些预定义的实体：
    [JSON, 数学, null, Infinity, NaN, void(0),
                        函数，数组，对象，未定义]

    源（）：
    [JSON, 数学, null, Infinity, NaN, (void 0),
        函数函数（）{[本机代码]}，函数数组（）{[本机代码]}，
            function Object() {[native code]}, (void 0)]

    JSON：
    [{},{},null,null,null,null,null,null,null,null]

```

如果翻译是“要使用的”，或者如果需要简单的良性人类消费来查看对象的内部结构，则前面的分析很重要。作为一种表示形式，主要的 JSON 特征是在环境之间传输一些“要使用”的结构化信息。

toSource() 函数的质量是影响程序的指称语义的一个因素，但不限于：
往返计算、最小不动点属性和反函数。

*   代码转换的重复是否会停顿到静态？
*   obj.toSource() == eval(eval(eval(obj.toSource()).toSource()).toSource()).toSource() 吗？
*   考虑 obj == eval(obj.toSource()) 是否有意义？
*   撤消转换是否会导致不仅是相似的对象，而是相同的对象？
    在克隆操作对象时，这是一个具有深远意义的问题。

还有很多很多...

请注意，当 obj 包含已执行的代码对象（例如 (new Function ... )()）时，上述问题会变得更加重要！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-05T03:13:27.953

如果匹配 Firefox 的确切序列化格式不是您的目标，您可以使用[http://json.org](http://json.org)中列出的 JavaScript JSON 序列化/反序列化库之一。使用像 JSON 这样的标准方案可能比模仿专有的 Gecko 格式更好。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-01-05T11:32:22.300

如果您需要使用循环引用序列化对象，您可以使用 Douglas Crockford 对 JSON 对象的 cycle.js 扩展，可在[https://github.com/douglascrockford/JSON-js](https://github.com/douglascrockford/JSON-js)获得。这很像 toSource()，虽然它不会序列化函数（但可能适合使用函数的 toString 方法）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-05T03:16:14.030

你可以这样做：

```
Object.prototype.getSource = function() {
    var output = [], temp;
    for (var i in this) {
        if (this.hasOwnProperty(i)) {
            temp = i + ":";
            switch (typeof this[i]) {
                case "object" :
                    temp += this[i].getSource();
                    break;
                case "string" :
                    temp += "\"" + this[i] + "\"";    // add in some code to escape quotes
                    break;
                default :
                    temp += this[i];
            }
            output.push(temp);
        }
    }
    return "{" + output.join() + "}";
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-09-06T15:27:48.073

为了更进一步：当你发送一些东西——要处理——接收者必须得到它并且能够处理它。因此，下一段代码将起到作用——改编自[Eliran Malka](https://stackoverflow.com/users/547020/eliran-malka "伊莱兰·马尔卡")先前的回答。

```
// SENDER IS WRAPPING OBJECT TO BE SENT AS STRING
// object to serialize
var s1 = function (str) {
    return {
        n: 8,
        o: null,
        b: true,
        s: 'text',
        a: ['a', 'b', 'c'],
        f: function () {
            alert(str)
        }
    }
};
// test
s1("this function call works!").f();
// serialized object; for newbies: object is now a string and can be sent ;)
var code = s1.toString();

// RECEIVER KNOWS A WRAPPED OBJECT IS COMING IN
// you have to assign your wrapped object to somevar
eval('var s2  = ' + code);
// and then you can test somevar again
s2("this also works!").f(); 
```

注意使用`eval`. 如果您拥有所有正在传输的代码：请随意使用它（尽管它也可能有缺点）。如果您不知道来源来自哪里：这是不可以的。

[javascript](/questions/tagged/javascript "显示标记为“javascript”的问题") [对象](/questions/tagged/object "显示标记为“对象”的问题") [tosource](/questions/tagged/tosource "显示标记为“tosource”的问题") [字符串化](/questions/tagged/stringify "显示标记为“字符串化”的问题") [eval](/questions/tagged/eval "显示标记为“评估”的问题")

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-03-03T10:43:25.950

您不必使用`toSource()`; 将要序列化的代码包装在返回 JSON 结构的函数中，并`function#toString()`改用：

```
var serialized = function () {
    return {
        n: 8,
        o: null,
        b: true,
        s: 'text',
        a: ['a', 'b', 'c'],
        f: function () {
            alert('!')
        }
    }
};
serialized.toString(); 
```

在 jsFiddle 上查看**[现场演示](http://jsfiddle.net/7zhUZ/)**。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-05T08:31:54.080

另请参阅[JavaScript 数据格式化/漂亮的打印机](https://stackoverflow.com/questions/130404/javascript-data-formattingpretty-printer "JavaScript 数据格式化/漂亮的打印机")。我认为例程以有效的 JS 格式导出，因此可以通过 eval 将其取回。

[编辑] 实际上，不是！快速转储可以，但不能用于真正的序列化。我改进了它，结果如下：

```
function SerializeObject(obj, indentValue)
{
  var hexDigits = "0123456789ABCDEF";
  function ToHex(d)
  {
    return hexDigits[d >> 8] + hexDigits[d & 0x0F];
  }
  function Escape(string)
  {
    return string.replace(/[\x00-\x1F'\\]/g,
        function (x)
        {
          if (x == "'" || x == "\\") return "\\" + x;
          return "\\x" + ToHex(String.charCodeAt(x, 0));
        })
  }

  var indent;
  if (indentValue == null)
  {
    indentValue = "";
    indent = ""; // or " "
  }
  else
  {
    indent = "\n";
  }
  return GetObject(obj, indent).replace(/,$/, "");

  function GetObject(obj, indent)
  {
    if (typeof obj == 'string')
    {
      return "'" + Escape(obj) + "',";
    }
    if (obj instanceof Array)
    {
      result = indent + "[";
      for (var i = 0; i < obj.length; i++)
      {
        result += indent + indentValue +
            GetObject(obj[i], indent + indentValue);
      }
      result += indent + "],";
      return result;
    }
    var result = "";
    if (typeof obj == 'object')
    {
      result += indent + "{";
      for (var property in obj)
      {
        result += indent + indentValue + "'" +
            Escape(property) + "' : " +
            GetObject(obj[property], indent + indentValue);
      }
      result += indent + "},";
    }
    else
    {
      result += obj + ",";
    }
    return result.replace(/,(\n?\s*)([\]}])/g, "$1$2");
  }
} 
```

indentValue 可以是 null、""、""、"\t" 或其他任何值。如果为 null，则没有缩进，输出一个相当紧凑的结果（可以使用更少的空格......）。

我可以使用数组来堆叠结果然后加入它们，但除非你有巨大的对象，否则字符串连接应该足够好......
也不处理循环引用......

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-08-25T21:23:19.863

还没有人提到它，所以我会指出`Object.toSource`在[https://github.com/oliver-moran/toSource.js上有一个可用于 Mozilla 的 polyfill](https://github.com/oliver-moran/toSource.js)

# sql - 我可以在 t-sql 中进行查找/替换吗？

> ID：171412
> 
> 赞同：25
> 
> 时间：2008-10-05T03:08:52.830
> 
> 标签：sql, xml, tsql

我基本上有一个 xml 列，我需要在每条记录中查找并替换一个标记值。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2011-06-23T08:35:23.673

对于任何真实的东西，我会使用 xpaths，但有时你只需要一个快速而肮脏的解决方案：

您可以使用 CAST 将该 xml 列转换为常规 varchar，然后进行正常替换。

`UPDATE xmlTable SET xmlCol = REPLACE( CAST( xmlCol as varchar(max) ), '[search]', '[replace]')`

当您只需要运行快速查询来查找某些内容并且不想处理 xpaths 时，同样的技术也使搜索 XML 变得轻而易举。

`SELECT * FROM xmlTable WHERE CAST( xmlCol as varchar(max) ) LIKE '%found it!%'`

编辑：只是想稍微更新一下，如果您收到一条消息，*类似于 Conversion of an or more characters from XML to target collat​​ion possible*，那么您只需要使用支持 unicode 的 nvarchar 即可。

`CAST( xmlCol as nvarchar(max) )`

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-05T03:29:42.677

要在 XML 列中查找内容，请查看 exists() 方法，如 MSDN [here](http://msdn.microsoft.com/en-us/library/ms189869(SQL.90).aspx)中所述。

```
SELECT * FROM Table
WHERE XMLColumn.exist('/Root/MyElement') = 1 
```

...要替换，请使用 modify() 方法，如此[处](http://msdn.microsoft.com/en-us/library/ms190675(SQL.90).aspx)所述。

```
SET XMLColumn.modify('
  replace value of (/Root/MyElement/text())[1]
  with "new value"
') 
```

..所有假设 SqlServer 2005 或 2008。这是基于 XPath，您需要知道。

* * *

## 回答 #3

> 赞同：-5
> 
> 时间：2008-10-05T03:31:07.277

```
update my_table
set xml_column = replace(xml_column, "old  value", "new value") 
```

# c++ - #warning 预处理器指令的可移植性

> ID：171435
> 
> 赞同：58
> 
> 时间：2008-10-05T03:40:47.103
> 
> 标签：c++, compiler-construction, warnings, c-preprocessor, portability

我知道 #warning 指令不是标准的**C** /C++，但有几个编译器支持它，包括 gcc/g++。但是对于那些不支持它的人，他们会默默地忽略它还是会导致编译失败？换句话说，我可以在我的项目中安全地使用它而不破坏不支持它的编译器的构建吗？

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2008-11-11T00:30:06.230

需要注意的是，MSVC 使用以下语法：

```
#pragma message ("你的警告文本在这里")

```

通常的#warning 语法会产生致命错误

```
C1021：无效的预处理器命令“警告”

```

所以它不能移植到那些编译器。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2008-10-05T03:53:13.550

如果编译器不支持#warning，它很可能会发出错误。与#pragma 不同，不建议预处理器忽略它不理解的指令。

话虽如此，我已经在各种不同（相当常见的）平台上使用了编译器，它们都支持#warning。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-05T03:56:31.780

即使代码块未包含在您的编译中，您也可能至少会从无法识别#warning 的编译器中收到无法识别的指令警告。这可能会或可能不会被视为错误 - 编译器可以合法地将其视为错误，但许多会更加宽松。

您是否知道（您能说出）提供#warning 的GCC/G++ 以外的编译器吗？[*编辑：* Sun Solaris 10 (Sparc) 和 Studio 11 C/C++ 编译器都接受#warning。]

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-05T04:20:20.343

我曾经在使用 Atmel 处理器的编译器时遇到过这个问题。由于未知的#warning 令牌，它确实产生了预处理器错误。

不幸的是，解决方案似乎是将整个源代码树转换为使用 #pragma 等效项，并接受如果使用 gcc 构建行为会有所不同。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-10-20T07:24:57.213

从 mingw 切换到 Visual Studio 时，我将这些行添加到我的全局配置标题中。（将其包含在 stdafx.h 中）

```
#ifdef __GNUC__
//from https://gcc.gnu.org/onlinedocs/gcc/Diagnostic-Pragmas.html
//Instead of put such pragma in code:
//#pragma GCC diagnostic ignored "-Wformat"
//use:
//PRAGMA_GCC(diagnostic ignored "-Wformat")
#define DO_PRAGMA(x) _Pragma (#x)
#define PRAGMA_GCC(x) DO_PRAGMA(GCC #x)

#define PRAGMA_MESSAGE(x) DO_PRAGMA(message #x)
#define PRAGMA_WARNING(x) DO_PRAGMA(warning #x)
#endif //__GNUC__
#ifdef _MSC_VER
/*
#define PRAGMA_OPTIMIZE_OFF __pragma(optimize("", off))
// These two lines are equivalent
#pragma optimize("", off)
PRAGMA_OPTIMIZE_OFF
*/
#define PRAGMA_GCC(x)
// https://support2.microsoft.com/kb/155196?wa=wsignin1.0
#define __STR2__(x) #x
#define __STR1__(x) __STR2__(x)
#define __PRAGMA_LOC__ __FILE__ "("__STR1__(__LINE__)") "
#define PRAGMA_WARNING(x) __pragma(message(__PRAGMA_LOC__ ": warning: " #x))
#define PRAGMA_MESSAGE(x) __pragma(message(__PRAGMA_LOC__ ": message : " #x))

#endif

//#pragma message "message quoted"
//#pragma message message unquoted

//#warning warning unquoted
//#warning "warning quoted"

PRAGMA_MESSAGE(PRAGMA_MESSAGE unquoted)
PRAGMA_MESSAGE("PRAGMA_MESSAGE quoted")

#warning "#pragma warning quoted"

PRAGMA_WARNING(PRAGMA_WARNING unquoted)
PRAGMA_WARNING("PRAGMA_WARNING quoted") 
```

现在我使用 PRAGMA_WARNING（这需要修复）

遗憾的是 gcc 中没有`#pragma warning`，因此它会警告未指定的编译指示。

我怀疑 gcc 会添加`#pragma warning"`而不是 microsoft 添加`#warning`。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-05T03:48:19.037

实际上，我所知道的大多数编译器都会忽略未知的#pragma 指令，并输出一条警告消息——所以在最坏的情况下，你仍然会收到一条警告。

# windows - 使用 Windows shell 脚本自动打开文件

> ID：171439
> 
> 赞同：1
> 
> 时间：2008-10-05T03:43:03.087
> 
> 标签：windows, vbscript

我有一个打开应用程序的 Windows shell 脚本。我想修改它以使其在打开应用程序时自动打开文件。

我知道它使用 VBscript，但我不熟悉该语言；我发现的所有教程都谈到了将 VBS 用于网页，而不是用于 Windows 脚本。我知道语法不同，因为我收到错误消息。

我找到的最好的“解决方案”是在运行语句的末尾使用“&”符号简单地添加文件路径，但是 Windows 会弹出一个错误，说找不到文件。我错过了什么吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-05T03:54:44.093

您需要引用文件名，以便路径中的任何空格都不会导致问题。

不要只使用**& filename**来附加文件名，而是使用：**& Chr(34) & filename & Chr(34)**

此行为还将依赖于应用程序接受要在命令行上打开的文件，这虽然很常见，但并不是强制性的。另一种方法是尝试使用 Shell.Execute 直接执行文件。这相当于在资源管理器中双击文件，并且应该启动注册来处理该文件类型的应用程序。

# internet-explorer - 通过 VB 将命令行参数传递给 Internet Explorer

> ID：171452
> 
> 赞同：0
> 
> 时间：2008-10-05T03:55:03.610
> 
> 标签：internet-explorer, vba, command-line

我有一个应用程序，我的客户想要打开一个信息亭窗口，即在启动时进入他们的公司互联网。Vb 不是我的东西，但他们希望它集成到他们当前的程序中，我认为这很容易，所以我得到了

```
Shell ("explorer.exe http://www.corporateintranet.com") 
```

需要传递的命令行是 -k

无法弄清楚到底该在哪里放弃它以使其工作。提前致谢！:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-05T04:00:24.753

如果您想使用 -k，您可能需要调用`iexplore.exe`而不是`explorer.exe`.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-05T04:06:30.450

这对我有用，不是最优雅的，但它会做：

```
Shell ("C:\Program Files\Internet Explorer\iexplore.exe -k http://www.corporateintranet.com") 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-12-23T12:46:23.377

有点晚了。但是对于以后遇到这个话题的人，我的建议是：使用 Shell32.dll 中的 ShellExecute 函数

例子：

```
ShellExecute(Application.hwnd, "open", "http://www.corporateintranet.com", vbNullString, vbNullString, SW_SHOWNORMAL) 
```

这是放入模块的声明：

```
Public Declare Function ShellExecute Lib "shell32.dll" Alias "ShellExecuteA" (ByVal hwnd As Long, ByVal lpOperation As String, ByVal lpFile As String, ByVal lpParameters As String, ByVal lpDirectory As String, ByVal nShowCmd As Long) As Long
Public Const SW_SHOW = 5
Public Const SW_SHOWDEFAULT = 10
Public Const SW_SHOWNORMAL = 1 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-04-11T03:40:37.373

您现在拥有它，但我认为您在 iexplore.exe 之后缺少结束引号

您可能还想取出 [space]-k，将缩放级别设置为在 kiosk 模式下适合您的水平，然后将 [space]-k 放回原处。我猜有一个参数或参数，因为它们调用它以将打开的缩放级别传递给 iexplore，但还不知道该怎么做。

# .net - .NET 中的 User32 API 调用

> ID：171457
> 
> 赞同：4
> 
> 时间：2008-10-05T03:59:17.347
> 
> 标签：.net, managed, user32

我目前正在计划一个项目，涉及为 Windows 创建一个 shell 替代品（基于 Blackbox，特别是 bblean）。但是，我希望利用 .NET 的力量来做到这一点。我需要的许多 API 调用都包含在 User32 库中。我当然可以使用 P/Invoke 并创建一个静态类来为我处理这个问题。

但是，很多这种功能已经在 .NET 框架中可用，特别是在 System.Management 命名空间中用于处理进程和活动窗口等。其中一些似乎缺失，例如 SetForegroundWindow 函数。

您是否知道已经提供此功能的 .NET 框架中内置的任何内容，或者我是否需要采用 P/Invoke 路线？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-05T04:10:20.817

我最近正在尝试创建自己的窗口系统，实际上只是在所有窗口周围创建新边框，但它需要我添加到 P/Invoke 的 Win32 API 中的许多函数。

但是 .NET 中有一个现成的库，它包含了[这里已经找到的大部分 Win32 API](http://www.codeproject.com/KB/cs/win32.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-05T05:46:07.007

不幸的是，对于很多事情，您将不得不走 P/Invoke 路线。幸运的是，[pinvoke.net](http://pinvoke.net)上有很多 Win32 API 的定义。

# flowchart - 你用什么来创建流程图？

> ID：171474
> 
> 赞同：5
> 
> 时间：2008-10-05T04:13:38.703
> 
> 标签：flowchart

我很好奇人们发现哪些工具对构建流程图有用。显然 MS Visio 和 OmniGraffle 浮现在我的脑海中，但它们都感觉很臃肿，并且往往强调文档格式/打印方面，而不是帮助组织实际逻辑。还有什么其他开发人员会推荐的吗？

我希望找到一些相当简单的东西，当我处理复杂的逻辑时，它可以让我快速地将流程图拼凑在一起。我不关心格式或字体之类的东西，只是在我处理它时可以帮助我保持逻辑井井有条。甚至可以安排图表本身并简单地让我指定分支的位置和检查的内容等。

任何操作系统都可以，尽管我个人倾向于使用 OS X 应用程序，因为这是我最近的主要工作环境。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-06T02:15:46.180

看看[graphviz](http://www.graphviz.org/)。

例子：

```
digraph finite_state_machine {
    rankdir=LR;
    size="8,5"
    node [shape = doublecircle]; LR_0 LR_3 LR_4 LR_8;
    node [shape = circle];
    LR_0 -> LR_2 [ label = "SS(B)" ];
    LR_0 -> LR_1 [ label = "SS(S)" ];
    LR_1 -> LR_3 [ label = "S($end)" ];
    LR_2 -> LR_6 [ label = "SS(b)" ];
    LR_2 -> LR_5 [ label = "SS(a)" ];
    LR_2 -> LR_4 [ label = "S(A)" ];
    LR_5 -> LR_7 [ label = "S(b)" ];
    LR_5 -> LR_5 [ label = "S(a)" ];
    LR_6 -> LR_6 [ label = "S(b)" ];
    LR_6 -> LR_5 [ label = "S(a)" ];
    LR_7 -> LR_8 [ label = "S(b)" ];
    LR_7 -> LR_5 [ label = "S(a)" ];
    LR_8 -> LR_6 [ label = "S(b)" ];
    LR_8 -> LR_5 [ label = "S(a)" ];
} 
```

产生：

[![替代文字](https://i.stack.imgur.com/gxQ8Y.png)](https://i.stack.imgur.com/gxQ8Y.png)
[（来源：[graphviz.org](http://www.graphviz.org/Gallery/directed/fsm.png)）]

它特别适合从程序中生成。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-05T05:50:33.750

纸和铅笔呢？还是白板？

有时，物理对象的轻松和触觉反馈是最合适的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-05T04:18:36.480

尽管您将其列为臃肿，但我仍然使用[OmniGraffle](http://www.omnigroup.com/applications/omnigraffle/)。

为了快速绘制一系列带有磁铁线的框就足够了，但其余的格式化选项可以稍后再使用。我发现我花时间绘制的任何流程图通常都会在某个文档中结束。即使我只是想理解一些困难的代码，我最终也会得到一个单页文档，它试图为下一个必须深入研究的可怜的笨蛋解释该代码。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-05T04:46:22.990

我在 Linux 上使用[Dia 。](http://live.gnome.org/Dia)它非常轻巧且易于使用，但它不会自动定位元素，而且我发现界面有时会有些抑制。

[dia.darwinports.com](http://dia.darwinports.com)上有一个 OS X 端口，虽然我没有使用过。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-05T04:38:31.947

[Open Office](http://www.openoffice.org/)的 Draw 也很不错。我用它来创建从简单的流程图到复杂的家谱树的所有东西。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-07-19T14:21:00.650

对于 OmniGraffle，它的免费版本是否足够好？即经过14天的试用，它仍然是一个不错的选择吗？

我正在尝试使用[yEd](http://www.yworks.com/en/products_yed_about.html)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-05T04:41:24.250

我不会做很多复杂的流程图，但是当我绘制流程图或将数据流放在一起时，我倾向于使用 Powerpoint。这很简单，我很清楚。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-06T01:46:31.280

我使用 Microsoft Visio 2003，它带有我不需要的所有额外垃圾，有点矫枉过正，但我​​喜欢它的简单 UI。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-06T02:19:11.853

我一般不做流程图，但做状态图。我在白板上做一个高级流程，然后在 A3 纸上做一个较低级别的流程。

一旦一切正常，我在 Visio 中创建它，它成为发布文档的一部分。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-01-23T21:24:34.083

我不将它用于编程相关任务，但我不明白为什么它不起作用。[Mindjet Mindmanager](http://www.mindjet.com)是用于创造性思维映射的绝佳工具。（但它可能非常昂贵）

# regex - 正则表达式：在引号之间抓取值

> ID：171480
> 
> 赞同：310
> 
> 时间：2008-10-05T04:22:06.520
> 
> 标签：regex

我有这样的价值：

```
"Foo Bar" "Another Value" something else 
```

什么正则表达式将返回引号中的值（例如`Foo Bar`和`Another Value`）？

* * *

## 回答 #1

> 赞同：448
> 
> 时间：2008-10-05T04:40:14.453

我一直在使用以下内容并取得了巨大成功：

```
(["'])(?:(?=(\\?))\2.)*?\1 
```

它也支持嵌套引号。

对于那些想要更深入地解释它是如何工作的人，这里是来自用户[ephemient](https://stackoverflow.com/users/20713/ephemient)的解释：

> `([""'])`匹配报价；`((?=(\\?))\2.)`如果反斜杠存在，吞噬它，无论是否发生，匹配一个字符；`*?`匹配多次（非贪婪，不吃结束语）；`\1`匹配用于打开的相同报价。

* * *

## 回答 #2

> 赞同：431
> 
> 时间：2008-10-05T04:24:49.227

通常，您正在寻找以下正则表达式片段：

```
"(.*?)" 
```

这使用了非贪婪 *? 运算符捕获直到但不包括下一个双引号的所有内容。然后，您使用特定于语言的机制来提取匹配的文本。

在 Python 中，你可以这样做：

```
>>> import re
>>> string = '"Foo Bar" "Another Value"'
>>> print re.findall(r'"(.*?)"', string)
['Foo Bar', 'Another Value'] 
```

* * *

## 回答 #3

> 赞同：114
> 
> 时间：2008-10-05T04:34:35.700

我会去：

```
"([^"]*)" 
```

**[^"]是除 '** **"** '以外的任何字符的正则表达式，我
在非贪婪的 many 运算符上使用它的原因是我必须继续查找它以确保我得到正确。

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2015-04-05T00:13:03.480

让我们看看两种处理转义引号的有效方法。这些模式的设计不是为了简洁或美观，而是为了高效。

这些方法使用第一个字符区分来快速找到字符串中的引号，而无需进行替换。*（这个想法是在不测试交替的两个分支的情况下快速丢弃不是引号的字符。）*

引号之间的内容用展开的循环（而不是重复的交替）来描述，这样也更有效率：`[^"\\]*(?:\\.[^"\\]*)*`

显然，要处理没有平衡引号的字符串，您可以改用所有格量词：`[^"\\]*+(?:\\.[^"\\]*)*+`或者模拟它们的解决方法，以防止过多的回溯。您也可以选择带引号的部分可以是开始引号，直到下一个（非转义）引号或字符串结尾。在这种情况下，不需要使用所有格量词，您只需要将最后一个引号设为可选。

注意：有时引号不是用反斜杠转义的，而是通过重复引用来转义的。在这种情况下，内容子模式如下所示：`[^"]*(?:""[^"]*)*`

这些模式避免使用捕获组和反向引用*（我的意思是类似的东西`(["']).....\1`）*并使用简单的交替，但`["']`在开始时，in factor。

**Perl 喜欢：**

```
["'](?:(?<=")[^"\\]*(?s:\\.[^"\\]*)*"|(?<=')[^'\\]*(?s:\\.[^'\\]*)*') 
```

*（请注意，这`(?s:...)`是在非捕获组内打开 dotall/singleline 模式的语法糖。如果不支持此语法，您可以轻松地为所有模式打开此模式或将点替换为`[\s\S]`）*

*（这种模式的编写方式完全是“手动驱动的”，没有考虑最终的引擎内部优化）*

**ECMA 脚本：**

```
(?=["'])(?:"[^"\\]*(?:\\[\s\S][^"\\]*)*"|'[^'\\]*(?:\\[\s\S][^'\\]*)*') 
```

**POSIX 扩展：**

```
"[^"\\]*(\\(.|\n)[^"\\]*)*"|'[^'\\]*(\\(.|\n)[^'\\]*)*' 
```

或者简单地说：

```
"([^"\\]|\\.|\\\n)*"|'([^'\\]|\\.|\\\n)*' 
```

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2017-11-10T01:22:45.203

奇怪的是，这些答案都不会产生一个正则表达式，其中返回的匹配是引号内的文本，这是所要求的。MA-Madden 尝试但仅将内部比赛作为一个被捕获的组而不是整个比赛。实际做到这一点的一种方法是：

```
(?<=(["']\b))(?:(?=(\\?))\2.)*?(?=\1) 
```

在此演示中可以看到此示例[https://regex101.com/r/Hbj8aP/1](https://regex101.com/r/Hbj8aP/1)

这里的关键是开始时的正向后视 (the `?<=`) 和结束时的正向前瞻 (the `?=`)。向后查找是在当前字符后面查找引号，如果找到则从那里开始，然后向前查找正在检查前面的字符以查找引号，如果找到则停止该字符。后视组 (the `["']`) 用括号括起来，以便为在开始时找到的任何引用创建一个组，然后在末尾使用前瞻`(?=\1)`来确保它仅在找到相应的引用时才停止。

唯一的其他复杂情况是，因为前瞻实际上并没有消耗结束引号，它会被起始后向再次找到，这会导致同一行上结束引号和开始引号之间的文本匹配。在开头的引号 ( ) 上放置一个单词边界`["']\b`有助于这一点，尽管理想情况下我想超越前瞻，但我认为这是不可能的。我直接从亚当的回答中获取了中间允许转义字符的位。

* * *

## 回答 #6

> 赞同：23
> 
> 时间：2016-09-14T09:15:10.100

接受答案的正则表达式返回值，包括它们周围的引号：`"Foo Bar"`和`"Another Value"`作为匹配项。

这里是正则表达式，它只返回引号***之间的值（正如提问者所要求的那样）：***

**仅双引号**（使用捕获组 #1 的值）：

`"(.*?[^\\])"`

**仅单引号**（使用捕获组 #1 的值）：

`'(.*?[^\\])'`

**两者**（捕获组#2的使用价值）：

`(["'])(.*?[^\\])\1`

-

所有支持转义和嵌套引号。

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2014-10-29T15:18:07.337

一个很晚的答案，但喜欢回答

```
(\"[\w\s]+\") 
```

[http://regex101.com/r/cB0kB8/1](http://regex101.com/r/cB0kB8/1)

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2018-05-13T21:36:39.633

我喜欢[Eugen Mihailescu 的解决方案](https://stackoverflow.com/a/34198968/8291949)，它可以匹配引号之间的内容，同时允许转义引号。但是，我发现了一些转义问题，并想出了以下正则表达式来修复它们：

```
(['"])(?:(?!\1|\\).|\\.)*\1 
```

它可以解决问题，并且仍然非常简单且易于维护。

[**演示**](https://regex101.com/r/W4qMDG/1)（带有更多测试用例；随意使用并扩展它）。

* * *

[PS：如果您只想要完整匹配中引号*之间*`$0`的内容（ ），并且不怕性能损失，请使用：]

```
(?<=(['"])\b)(?:(?!\1|\\).|\\.)*(?=\1) 
```

[不幸的是，如果没有引号作为锚点，我不得不`\b`在起始引号之后添加一个不能很好地处理空格和非单词边界字符的边界。]

[[或者，通过简单地添加一个组并提取字符串形式`$2`](https://regex101.com/r/W4qMDG/25)来修改初始版本：]

```
(['"])((?:(?!\1|\\).|\\.)*)\1 
```

[PPS：如果您只关注效率，请选择[Casimir et Hippolyte 的解决方案](https://stackoverflow.com/a/29452781/8291949)；这是一个很好的。]

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2015-12-10T10:08:08.220

上面的模式`(["'])(?:(?=(\\?))\2.)*?\1`可以完成工作，但我担心它的表现（它还不错，但可能会更好）。低于它的我的速度要快约 20%。

模式`"(.*?)"`只是不完整的。我对每个阅读本文的人的建议就是不要使用它！！！

例如，它无法捕获许多字符串（如果需要，我可以提供详尽的测试用例），如下所示：

> $string = '你好吗？我`\'`很好，谢谢';

其余的和上面的一样“好”。

如果您真的关心性能和精度，请从以下开始：

`/(['"])((\\\1|.)*?)\1/gm`

在我的测试中，它涵盖了我遇到的每一个字符串，但如果你发现一些不起作用的东西，我很乐意为你更新它。

[在在线正则表达式测试器中检查我的模式](https://regex101.com/?regex=%28%5B%5C%27%22%5D%29%28%28%5C%5C%5C1%7C.%29%2A%3F%29%5C1&options=gm&text=defined+%28+%27WP_DEBUG%27+%29+||+define%28+%27%5CWP_DEBUG%27%2C+true+%29%3B%0Aecho+%27class%3D%22input-text+card-number%22+type%3D%22text%22+maxlength%3D%2220%22%27%3B%0Aecho+%27How+are+you%3F+I%5C%27m+fine%2C+thank+you%27%3B)。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2008-10-06T01:42:52.377

这个版本

*   解释转义引号
*   控制回溯

    ```
    /(["'])((?:(?!\1)[^\\]|(?:\\\\)*\\[^\\])*)\1/ 
    ```

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2013-10-01T19:41:10.133

我喜欢 Axeman 更广泛的版本，但遇到了一些问题（例如，它不匹配

```
foo "string \\ string" bar 
```

或者

```
foo "string1"   bar   "string2" 
```

正确，所以我尝试修复它：

```
# opening quote
(["'])
   (
     # repeat (non-greedy, so we don't span multiple strings)
     (?:
       # anything, except not the opening quote, and not 
       # a backslash, which are handled separately.
       (?!\1)[^\\]
       |
       # consume any double backslash (unnecessary?)
       (?:\\\\)*       
       |
       # Allow backslash to escape characters
       \\.
     )*?
   )
# same character as opening quote
\1 
```

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2016-11-10T03:06:42.320

更多答案！这是我使用的解决方案

`\"([^\"]*?icon[^\"]*?)\"`

TLDR；用您在所述引号中查找的内容
替换单词**图标，瞧！**

* * *

它的工作方式是查找关键字，而不关心引号之间的其他内容。EG：
`id="fb-icon"`
`id="icon-close"`
`id="large-icon-close"`
正则表达式查找引号，`"`
然后查找任何可能的字母组，`"`
直到找到为止`icon`
，任何可能的字母组不是`"`
它，然后查找结束`"`

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2014-02-12T07:28:34.067

```
string = "\" foo bar\" \"loloo\""
print re.findall(r'"(.*?)"',string) 
```

试试这个，就像一个魅力！

`\`表示跳过字符

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2018-05-06T03:32:28.623

与亚当的回答不同，我有一个简单但有效的答案：

```
(["'])(?:\\\1|.)*?\1 
```

如果您想在引号中获取内容，只需添加括号：

```
(["'])((?:\\\1|.)*?)\1 
```

然后`$1`匹配引号字符并`$2`匹配内容字符串。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-10-05T12:45:42.447

```
echo 'junk "Foo Bar" not empty one "" this "but this" and this neither' | sed 's/[^\"]*\"\([^\"]*\)\"[^\"]*/>\1</g' 
```

这将导致：>Foo Bar<><>但这<

在这里，为了清楚起见，我在 >< 之间显示了结果字符串，还使用带有这个 sed 命令的非贪婪版本，我们首先在“”之前和之后扔掉垃圾，然后用“”之间的部分替换它's 并用 ><'s 包围它。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2011-11-29T15:59:09.190

从 Greg H. 我能够创建这个正则表达式来满足我的需要。

我需要匹配一个在引号内限定的特定值。它必须是完全匹配，没有部分匹配会触发命中

例如，“test”不能匹配“test2”。

```
reg = r"""(['"])(%s)\1"""
if re.search(reg%(needle), haystack, re.IGNORECASE):
    print "winning..." 
```

猎人

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2018-03-02T16:51:53.627

如果您尝试查找仅具有特定后缀的字符串，例如点语法，您可以尝试以下操作：

`\"([^\"]*?[^\"]*?)\".localized`

`.localized`后缀在哪里。

例子：

`print("this is something I need to return".localized + "so is this".localized + "but this is not")`

它会捕获`"this is something I need to return".localized`，`"so is this".localized`但不会`"but this is not"`。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2018-05-04T13:35:27.327

**Microsoft VBA 编码器**子集的补充答案只有一个使用该库`Microsoft VBScript Regular Expressions 5.5`，这给出了以下代码

```
Sub TestRegularExpression()

    Dim oRE As VBScript_RegExp_55.RegExp    '* Tools->References: Microsoft VBScript Regular Expressions 5.5
    Set oRE = New VBScript_RegExp_55.RegExp

    oRE.Pattern = """([^""]*)"""

    oRE.Global = True

    Dim sTest As String
    sTest = """Foo Bar"" ""Another Value"" something else"

    Debug.Assert oRE.test(sTest)

    Dim oMatchCol As VBScript_RegExp_55.MatchCollection
    Set oMatchCol = oRE.Execute(sTest)
    Debug.Assert oMatchCol.Count = 2

    Dim oMatch As Match
    For Each oMatch In oMatchCol
        Debug.Print oMatch.SubMatches(0)

    Next oMatch

End Sub 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2020-05-24T12:08:34.433

上面的所有答案都很好......除了**它们不支持所有的Unicode字符！**在 ECMA 脚本 (Javascript)

If you are a Node users, you might want the the modified version of accepted answer that support all unicode characters :

```
/(?<=((?<=[\s,.:;"']|^)["']))(?:(?=(\\?))\2.)*?(?=\1)/gmu 
```

Try [here](https://regex101.com/r/JXWF6e/1/).

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2011-10-02T16:52:31.937

对我来说，这是一个：

```
|([\'"])(.*?)\1|i 
```

我用过这样的一句话：

```
preg_match_all('|([\'"])(.*?)\1|i', $cont, $matches); 
```

效果很好。

# scala - Scala 中的显式类型转换

> ID：171489
> 
> 赞同：77
> 
> 时间：2008-10-05T04:32:52.847
> 
> 标签：scala, type-conversion

可以说我有以下代码：

```
abstract class Animal
case class Dog(name:String) extends Animal
var foo:Animal = Dog("rover")
var bar:Dog = foo //ERROR! 
```

如何修复此代码的最后一行？基本上，我只想用一种类似 C 的语言做些什么：

```
var bar:Dog = (Dog) foo 
```

* * *

## 回答 #1

> 赞同：148
> 
> 时间：2008-10-05T05:09:59.450

我自己想通了。有两种解决方案：

1）做明确的演员：

```
var bar:Dog = foo.asInstanceOf[Dog] 
```

2）使用模式匹配为您转换它，这也会捕获错误：

```
var bar:Dog = foo match {
  case x:Dog => x
  case _ => {
    // Error handling code here
  }
} 
```

# ruby - 从 ruby -ncurses 中获得 256 种颜色

> ID：171490
> 
> 赞同：8
> 
> 时间：2008-10-05T04:33:15.937
> 
> 标签：ruby, ncurses, terminal, 256color

我有 256 种颜色在我的终端（[这里的测试脚本](http://www.frexx.de/xterm-256-notes/)）中工作得很好，但是当我使用 ncurses（通过 Ruby-ncurses）时它停止工作。打印该页面上给出的转义序列可以正常工作，但是当我初始化 ncurses 'puts' 时停止工作，并且我无法使用我发现的任何各种 ncurses 颜色更改/字符串输出函数输出颜色。是什么赋予了？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-05T04:42:22.843

我不确定这是否就是全部内容，但请确保您的终端功能确实提供了 256 色描述。

TERM 环境变量值是什么？尝试将其设置为 xterm-256color 并重新运行它。然后 ncurses 应该得到正确的颜色转义序列。

您还可以使用我们在 SXEmacs 开发中使用的程序测试终端功能和终端颜色输出：

[http://www.triatlantico.org/tmp/tty-colors.c](http://www.triatlantico.org/tmp/tty-colors.c)

使用 gcc -o tty-colors tty-colors.c -lncurses 编译

编辑：请注意，仅仅因为在网上找到的脚本输出 256 种颜色，这并不是“全部设置”。诅咒程序依靠 terminfo 和 termcap 以及 TERM 环境变量来找出如何与终端交互。因此，为了让 curses 应用程序能够使用 256 色，应该将 TERM 变量设置为支持 256 色的现有终端名称。上面的 C 程序将向您*展示*ncurses 对您的终端的看法，而不仅仅是像大多数脚本一样输出 xterm 序列 [甚至来自 X.org 的那个]

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-05T22:18:14.617

njsf：你部分地在这里，经过更多的修补后，我最终让它工作了。谢谢你的帮助。故事：XTerm（以及 rxvt 和 Eterm）通过转义序列（我所看到的）支持 256 种颜色，但 'tput colours' 会说 '8' 并且 ncurses 无法获取它们，因为 ncurses 玩得很好并尝试通过 terminfo 访问。

为了任何有类似疼痛的人的利益：

我发现我需要安装 ncurses-term (Ubuntu) 包来获取 /lib/terminfo/x/xterm-256color 和其他 256 色 terminfo 文件。然后我将我的 TERM 设置为 xterm-256color 并将行“*customization:-color”添加到我的 ~/.Xdefaults 中，运行“xrdb -merge ~/.Xdefaults”来加载它，从那时起我就有了正确的 256 色支持新的 xterms。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-09-14T19:55:40.367

环境

ENV['TERM'] += '-256color' if ENV['TERM'] == 'xterm' # 激活 256 种颜色

适用于 ubuntu 10.04 +

# build - 在 CentOS/RHEL 上制作和构建实用程序？

> ID：171506
> 
> 赞同：31
> 
> 时间：2008-10-05T04:45:39.047
> 
> 标签：build, centos, utilities, rhel

我一直在寻找`make`在我的 CentOS 5.2 上安装实用程序的方法，但没有成功。我浏览了一些 RPM 存储库和在线，但无济于事。安装`gcc`，`gcc-c++`没用！软件包`build-essential`不是为 CentOS/RHEL 制作的。我在 YUM 中启用了 RPMFORGE 存储库。

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2010-08-19T15:30:25.683

```
yum groupinstall "Development Tools" 
```

或者

```
yum install gcc gcc-c++ kernel-devel 
```

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2009-10-08T17:13:37.810

```
yum install make 
```

也有效。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-10-05T05:12:37.057

我只是仔细检查了一下，CentOS 5.2 已经包含了 make！

我也在其中一个在线镜像中找到了它，如果它对你来说更容易的话：

[http://centos.cogentcloud.com/5.2/os/i386/CentOS/make-3.81-3.el5.i386.rpm](http://centos.cogentcloud.com/5.2/os/i386/CentOS/make-3.81-3.el5.i386.rpm)

如果您安装的是 64 位版本：

[http://centos.cogentcloud.com/5.2/os/x86_64/CentOS/make-3.81-3.el5.x86_64.rpm](http://centos.cogentcloud.com/5.2/os/x86_64/CentOS/make-3.81-3.el5.x86_64.rpm)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-08-31T18:14:25.430

如果 groupinstall 不起作用，您将需要这个：

`yum install -y gcc-c++ make`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-05-21T22:21:02.497

这个命令对我有用

```
yum groupinstall "Development Tools" -y 
```

# python - 我将如何实现位图？

> ID：171512
> 
> 赞同：4
> 
> 时间：2008-10-05T04:51:11.967
> 
> 标签：python, class

我希望在 Python 中实现一个 2d 位图类。该类将具有以下要求：

1.  允许创建任意大小的 2d 位图。即创建一个 8 x 8 位图（8 个字节），例如：

    ```
    bitmap = Bitmap(8,8) 
    ```

2.  提供一个 API 来访问这个 2d 映射中的位作为布尔值甚至整数值，即：

    ```
    if bitmap[1, 2] or bitmap.get(0, 1) 
    ```

3.  能够将数据检索为打包的二进制数据。本质上，它将位图的每一行连接起来并作为二进制数据返回。它可以填充到最近的字节或类似的东西。

    ```
    bitmap.data() 
    ```

4.  能够从检索到的二进制数据创建新地图：

    ```
    new_bitmap = Bitmap(8, 8, bitmap.data()) 
    ```

我知道 Python 能够执行二进制操作，但我想要一些关于如何最好地使用它们来实现此类的建议。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-05T08:16:06.890

[Bit-Packing](http://mentat.za.net/numpy/refguide/routines.bitwise.xhtml#bit-packing) numpy ( [SciPY](http://www.scipy.org/) ) 数组可以满足您的需求。该示例显示了打包成 4 个 8 位字节的 4x3 位（布尔）数组。*unpackbits 将*uint8 数组解包到一个布尔输出数组中，您可以在计算中使用该数组。

```
>>> a = np.array([[[1,0,1],
...                [0,1,0]],
...               [[1,1,0],
...                [0,0,1]]])
>>> b = np.packbits(a,axis=-1)
>>> b
array([[[160],[64]],[[192],[32]]], dtype=uint8) 
```

如果您需要 1 位像素图像，PIL 是您的最佳选择。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-05T07:11:25.197

无需自己创建。

使用非常好的[Python 图像库](http://www.pythonware.com/products/pil/)(PIL)

# asp.net - 在 Session_End 期间访问 HttpApplicationState

> ID：171516
> 
> 赞同：0
> 
> 时间：2008-10-05T04:52:14.010
> 
> 标签：asp.net, application-state

在我使用 InProc 会话的 ASP.NET 应用程序中，Session_End 调用另一个对象中的静态方法来执行特定于会话的清理。此清理使用我存储在应用程序状态中的共享数据库连接。

问题是如果不将应用程序状态（或者更确切地说是数据库连接）作为参数传递给清理方法，我看不到如何访问应用程序状态。由于我不在请求中，因此我没有当前的 HttpContext，并且找不到任何其他静态方法来访问该状态。

我错过了什么吗？

**更新**：看来我的问题需要进一步澄清，所以让我试试下面的代码示例。我想要做的是：

```
// in Global.asax
void Session_End(object sender, EventArgs e) 
{
    NeedsCleanup nc = Session["NeedsCleanup"] as NeedsCleanup;
    nc.CleanUp();
} 
```

但问题是该`CleanUp`方法又需要存储在应用程序状态中的信息。我已经在做以下事情，但这正是我希望避免的；这就是我上面所说的“......没有传递它......作为清理方法的参数”的意思。

```
// in Global.asax
void Session_End(object sender, EventArgs e) 
{
    NeedsCleanup nc = Session["NeedsCleanup"] as NeedsCleanup;
    nc.CleanUp(this.Application);
} 
```

我只是不喜欢`Global.asax` *必须*知道`NeedsCleanup`对象从哪里获取信息的想法。那种在课堂上自成一体更有意义的事情。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-06T05:06:47.443

您应该能够使用 Session_End 内部的 Application 属性访问 ApplicationState 对象。

```
void Session_End(object sender, EventArgs e) 
{
     HttpApplicationState state = this.Application;
} 
```

（不得不以不同的答案回复，因为我没有直接评论所需的声誉）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-05T05:18:40.040

您应该能够使用 Session_End 内部的 Session 属性访问 SessionState 对象。

```
void Session_End(object sender, EventArgs e) 
{
    HttpSessionState session = this.Session;
} 
```

这个属性和更多属性来自 Global.asax 的基类

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T04:38:43.363

您在哪里创建“NeedsCleanup”实例？如果它在 Session_Start 中，那么您的全局类将知道如何/何时创建和销毁这些实例是有道理的。

我了解您希望将 NeedsCleanup 的清理与其调用方分离。也许一种更简洁的方法是通过“this”引用传入“HttpContext.Current.ApplicationInstance”以及全局类中的“HttpApplication”实例。或者，您也可以在构造上指定任何上述实例，这将使清理的耦合度降低。

# php - 通过 Active Directory 使用 LDAP 在 PHP 中进行身份验证

> ID：171519
> 
> 赞同：111
> 
> 时间：2008-10-05T04:59:11.640
> 
> 标签：php, authentication, active-directory, ldap

我正在寻找一种通过 LDAP 和 PHP 对用户进行身份验证的方法（Active Directory 是提供者）。理想情况下，它应该能够在 IIS 7 上运行（[adLDAP](http://adldap.sourceforge.net/)在 Apache 上运行）。有人做过类似的事情，成功了吗？

*   编辑：我更喜欢带有可以使用的代码的库/类......当有人已经这样做时，发明轮子是愚蠢的。

* * *

## 回答 #1

> 赞同：175
> 
> 时间：2008-10-05T14:10:07.097

当您只需要两行代码时，导入整个库似乎效率低下......

```
$ldap = ldap_connect("ldap.example.com");
if ($bind = ldap_bind($ldap, $_POST['username'], $_POST['password'])) {
  // log them in!
} else {
  // error message
} 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2016-04-09T20:55:58.850

您会认为在 Active Directory 中简单地对用户进行身份验证将是一个在 PHP 中使用 LDAP 的非常简单的过程，而无需库。但是有很多事情会很快使它复杂化：

*   您必须验证输入。否则，空的用户名/密码将通过。
*   绑定时应确保用户名/密码正确编码。
*   您应该使用 TLS 加密连接。
*   使用单独的 LDAP 服务器进行冗余，以防万一出现故障。
*   如果身份验证失败，则会收到信息性错误消息。

在大多数情况下，使用支持上述内容的 LDAP 库实际上更容易。我最终推出了自己的库来处理上述所有问题：[LdapTools](https://github.com/ldaptools/ldaptools)（嗯，不仅仅是用于身份验证，它还可以做更多事情）。它可以像下面这样使用：

```
use LdapTools\Configuration;
use LdapTools\DomainConfiguration;
use LdapTools\LdapManager;

$domain = (new DomainConfiguration('example.com'))
    ->setUsername('username') # A separate AD service account used by your app
    ->setPassword('password')
    ->setServers(['dc1', 'dc2', 'dc3'])
    ->setUseTls(true);
$config = new Configuration($domain);
$ldap = new LdapManager($config);

if (!$ldap->authenticate($username, $password, $message)) {
    echo "Error: $message";
} else {
    // Do something...
} 
```

上面的身份验证调用将：

*   验证用户名或密码都不是空的。
*   确保用户名/密码正确编码（默认为 UTF-8）
*   尝试备用 LDAP 服务器以防万一出现故障。
*   使用 TLS 加密身份验证请求。
*   如果失败（即锁定/禁用帐户等），请提供其他信息

还有其他库也可以执行此操作（例如 Adldap2）。但是，我觉得有足够的必要提供一些额外的信息，因为投票最多的答案实际上是一个安全风险，在没有完成输入验证并且不使用 TLS 的情况下依赖。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-05T13:38:49.297

我只是通过将用户凭据传递给 ldap_bind() 来做到这一点。

[http://php.net/manual/en/function.ldap-bind.php](http://php.net/manual/en/function.ldap-bind.php)

如果账号可以绑定LDAP，则有效；如果不能，那就不是。如果您所做的只是身份验证（而不是帐户管理），那么我认为不需要图书馆。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-10-05T05:21:13.560

我喜欢[Zend_Ldap](https://framework.zend.com/manual/2.3/en/modules/zend.ldap.introduction.html)类，你可以在你的项目中只使用这个类，而不需要 Zend 框架。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-05T05:01:35.923

PHP 有库：[http ://ca.php.net/ldap](http://ca.php.net/ldap)

PEAR 还有很多包：[http ://pear.php.net/search.php?q=ldap&in=packages&x=0&y=0](http://pear.php.net/search.php?q=ldap&in=packages&x=0&y=0)

我也没有使用过，但我打算在某个时候使用它们，它们似乎应该可以工作。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2014-01-08T19:09:39.037

对于那些寻找完整示例的人，请查看[http://www.exchangecore.com/blog/how-use-ldap-active-directory-authentication-php/](http://www.exchangecore.com/blog/how-use-ldap-active-directory-authentication-php/)。

我已经测试了从 Windows Server 2003 Web Server (IIS6) 和运行 IIS 8 的 Windows Server 2012 企业到 Windows Server 2003 和 Windows Server 2008 R2 域控制器的连接。

# ruby-on-rails - act_as_tree 不会破坏模型的孩子

> ID：171529
> 
> 赞同：5
> 
> 时间：2008-10-05T05:08:50.527
> 
> 标签：ruby-on-rails, ruby, acts-as-tree

我有这个任务模型：

```
class Task < ActiveRecord::Base
  acts_as_tree :order => 'sort_order'
end 
```

我有这个测试

```
class TaskTest < Test::Unit::TestCase
  def setup
    @root = create_root
  end

  def test_destroying_a_task_should_destroy_all_of_its_descendants
    d1 = create_task(:parent_id => @root.id, :sort_order => 2)
    d2 = create_task(:parent_id => d1.id, :sort_order => 3)
    d3 = create_task(:parent_id => d2.id, :sort_order => 4)
    d4 = create_task(:parent_id => d1.id, :sort_order => 5)
    assert_equal 5, Task.count

    d1.destroy

    assert_equal @root, Task.find(:first)
    assert_equal 1, Task.count
  end
end 
```

测试成功：当我销毁d1时，它会销毁d1的所有后代。因此，在销毁之后只剩下根。

但是，在我向任务添加了 before_save 回调之后，这个测试现在失败了。这是我添加到任务的代码：

```
before_save :update_descendants_if_necessary

def update_descendants_if_necessary
  handle_parent_id_change if self.parent_id_changed?
  return true
end

def handle_parent_id_change
  self.children.each do |sub_task|
    #the code within the loop is deliberately commented out
  end
end 
```

当我添加此代码时，`assert_equal 1, Task.count`失败，带有`Task.count == 4`. 我认为`self.children`under`handled_parent_id_change`是罪魁祸首，因为当我注释掉该`self.children.each do |sub_task|`块时，测试再次通过。

有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-06T04:02:30.317

我发现了这个错误。线

```
d1 = create_task(:parent_id => @root.id, :sort_order => 2) 
```

创建 d1。这会调用`before_save`回调，而回调又会调用`self.children`. 正如 Orion 指出的那样，这缓存了 d1 的孩子。

但是，此时 d1 还没有任何子节点。所以 d1 的孩子缓存是空的。

因此，当我尝试销毁 d1 时，程序会尝试销毁 d1 的孩子。它遇到缓存，发现它是空的，结果没有破坏 d2、d3 和 d4。

我通过改变这样的任务创建解决了这个问题：

```
@root.children << (d1 = new_task(:sort_order => 2))
@root.save! 
```

这行得通，所以我可以接受:) 我认为也可以通过重新加载 d1 ( `d1.reload`) 或 self.children ( `self.children(true)`) 来解决这个问题，尽管我没有尝试任何这些解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-05T20:07:08.123

`children` [是一个简单的 has_many 关联](http://github.com/rails/acts_as_tree/tree/master/lib/active_record/acts/tree.rb#L47)

这意味着，当您调用 时`.children`，它将从数据库中加载它们（如果尚未存在）。然后它将缓存它们。

我要说的是，您的第二个“测试”实际上将查看缓存值而不是真正的数据库，但这不应该发生，因为您只是使用`Task.count`而不是`d1.children.count`. 人力资源管理

你看过日志吗？他们将向您展示正在执行的 SQL。你可能会在那里看到一个 mysql 错误，它会告诉你发生了什么

# php - 使用 PHP 更新 XML 文件

> ID：171539
> 
> 赞同：2
> 
> 时间：2008-10-05T05:20:57.820
> 
> 标签：php, xml

使用 PHP 在不重写和保存文件的情况下更新 XML 标记中的单个属性的最简单方法是什么？有什么方法可以使用常规的 DOM 东西来做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-05T06:14:58.867

如果您的服务器上有 PHP5，您可以尝试：

```
$string = "<?xml version='1.0'?>
<doc>
 <title>XML Document</title>
 <date timezone=\"GMT+1\">2008-01-01 13:42:53</date>
 <message>Daylight savings starting soon!</message>
</doc>";

$xml = simplexml_load_string($string);

// Show current timezone
echo $xml->date['timezone'].'<br>';

// Set a new timezone
$xml->date['timezone'] = 'GMT+10';
echo $xml->date['timezone']; 
```

**注意**：注意空格——XML 需要格式正确，SimpleXML 才能正确解析。

替代方案包括`simplexml_load_file()`和`simplexml_import_dom()`。

# c# - 如何获取我的应用程序创建的应用程序域列表？

> ID：171541
> 
> 赞同：2
> 
> 时间：2008-10-05T05:21:33.140
> 
> 标签：c#, .net, clr, appdomain

我有一个服务应用程序，它在用于长时间运行的任务的过程中创建 AppDomain。我一直在通过将它们存储在具有唯一 ID 的哈希表中来跟踪它们。

任务完成后，服务应用程序会卸载分配给该任务的 AppDomain，然后将其从 appdomain 哈希表中删除。

纯粹从完整性检查的角度来看，有没有一种方法可以查询 CLR 以查看创建应用程序域仍加载哪些应用程序域（即，我可以将跟踪 Hashtable 与 CLR 实际看到的内容进行比较）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-05T07:57:59.250

AFAIK，您需要保留自己的列表 - 就像您已经一样。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-07T08:27:18.640

如果您使用非托管 API，您可以设置一个 DomainManager，在每次创建 AppDomain 时调用它，您会发现许多部分正在创建自己的 AppDomain，例如 WCF。[自定义 Microsoft .NET Framework 公共语言运行时](https://rads.stackoverflow.com/amzn/click/com/0735619883)中有详细说明

另一条路线是使用调试 API。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-28T14:17:07.297

我想你也想看看这篇文章——“[在 WPF 中使用应用程序域](http://www.infosysblogs.com/microsoft/2008/10/working_with_application_domai_1.html)”。

# javascript - 正确的 IE6 HTML 元素尺寸

> ID：171542
> 
> 赞同：1
> 
> 时间：2008-10-05T05:22:56.397
> 
> 标签：javascript, internet-explorer

我正在尝试使用 javascript 设置元素的宽度和高度以覆盖整个浏览器视口，并且我成功使用

```
document.body.clientHeight
```

但在 IE6 中，我似乎总是得到水平和垂直滚动条，因为元素必须稍微太大。

现在，我真的不想使用浏览器特定的逻辑并从每个维度中减去一个或 2 个像素，只是为了 IE6。另外，我没有为此使用 CSS（宽度：100% 等），因为我需要像素数量。

有谁知道用 IE6+ 中的元素填充视口的更好方法（显然也是所有好的浏览器）？

编辑：感谢 Owen 的建议，我确信 jQuery 会起作用。我应该指定我需要一个与工具包无关的解决方案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-05T05:32:31.713

这*可能*有助于导致...

> 来自[http://andylangton.co.uk/articles/javascript/get-viewport-size-javascript/](http://andylangton.co.uk/articles/javascript/get-viewport-size-javascript/)：

```
<script type="text/javascript">
<!--

 var viewportwidth;
 var viewportheight;

 // the more standards compliant browsers (mozilla/netscape/opera/IE7) use window.innerWidth and window.innerHeight

 if (typeof window.innerWidth != 'undefined')
 {
      viewportwidth = window.innerWidth,
      viewportheight = window.innerHeight
 }

// IE6 in standards compliant mode (i.e. with a valid doctype as the first line in the document)

 else if (typeof document.documentElement != 'undefined'
     && typeof document.documentElement.clientWidth !=
     'undefined' && document.documentElement.clientWidth != 0)
 {
       viewportwidth = document.documentElement.clientWidth,
       viewportheight = document.documentElement.clientHeight
 }

 // older versions of IE

 else
 {
       viewportwidth = document.getElementsByTagName('body')[0].clientWidth,
       viewportheight = document.getElementsByTagName('body')[0].clientHeight
 }
document.write('<p>Your viewport width is '+viewportwidth+'x'+viewportheight+'</p>');
//-->
</script> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-05T07:33:24.340

你考虑过使用[jQuery](http://jquery.com)吗？它将大多数浏览器特定功能抽象为一个通用界面。

```
var width = $(document).width();
var height = $(document.height();

$('#mySpecialElement').width(width).height(height); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-10T17:00:55.177

啊哈！我忘了

```
document.documentElement.clientLeft
```

和

```
document.documentElement.clientTop
```

.

它们在 IE 中为 2，在好的浏览器中为 0。所以使用

```
var WIDTH = ((document.documentElement.clientWidth - document.documentElement.clientLeft) || document.body.clientWidth);
```

等做了伎俩，高度的类似想法！

# php - 记录 AJAX + PHP 代码的最佳方式？

> ID：171548
> 
> 赞同：10
> 
> 时间：2008-10-05T05:41:06.937
> 
> 标签：php, ajax, documentation

我一直喜欢编写代码文档，但是当涉及到 AJAX + PHP 时，这并不总是那么容易：代码真的很分散！逻辑、数据、表示——你可以命名它——在服务器端和客户端代码之间被分割和混合。有时还有数据库端代码（存储过程、视图等）在做部分工作。

这挑战我想出一种有效的方法来记录此类代码。我通常在 .php 文件中提供 .js 文件列表以及在 .js 文件中提供 .php 文件列表。我还做内嵌注释和函数描述，其中我列出了哪些文件使用了哪些函数以及预期的输出。我为数据库过程执行类似的任务。也许有更好的方法？

有什么想法或经验吗？

注意：这个问题适用于任何客户端+服务器端应用程序，而不仅仅是 Javascript+PHP。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-05T06:39:17.553

我觉得你的方法很不错。唯一的问题是 js 文件中的所有内容都可以被其他人读取，因此记录使用了哪些 PHP 文件可能会导致安全漏洞，因为他们可能会获得返回不应该返回的内容的文件。此外，虽然没什么大不了的，但在流量较高的网站上，下载 500 字节的评论可以加起来。

这两个都不大，只是我以前的想法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-05T15:15:17.747

我认为最好采用分层方法。

对于函数和类级别的 api 级别文档，在代码中编写内联文档并使用许多文档工具（[JSDoc](http://jsdoc.sourceforge.net/)、[phpDocumentor](http://www.phpdoc.org/)、[OraDoclet](http://oradoclet.sourceforge.net/)等）从中生成 html 文档。如果您的文档工具可以与您的源代码控制工具集成，那么您可以从您的 api 文档跳转到特定的代码行。

准备好文档工具后，开始为每个新构建生成文档作为构建过程的一部分（您有构建过程，对吗？），并将文档推送到标准 Web 位置。

一旦这些 api 文档上线，您就可以为高级文档创建一个 wiki，例如浏览器->web->db 交互、用户故事、模式图等。最好为高级文档编写简短的散文或要点，必要时链接到 api 文档和源代码管理。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-10T15:34:41.890

通过 PHP 提供您的 javascript（和 css） - 您可以将源文件放在一起以便于交叉引用，并且仔细使用标头可以轻松处理缓存。这样做还可以让您拥有格式良好的重注释源版本，然后您可以在发送到浏览器之前对其进行压缩或混淆。

```
function OutputJs($Content) {
    ob_start();
    echo $Content;
    $expires = DAY_IN_S;
    header("Content-type: x-javascript");
    header('Content-Length: ' . ob_get_length());
    header('Cache-Control: max-age='.$expires.', must-revalidate');
    header('Pragma: public');
    header('Expires: '. gmdate('D, d M Y H:i:s', time()+$expires).'GMT');
    ob_end_flush(); 
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-12T15:12:04.700

对于包含大量 javascript 的项目，我使用带有[javascript 最小化](http://www.crockford.com/javascript/jsmin.html "JSMin")程序的构建系统（makefile） 。正如 jsmin 作者所指出的，剥离注释“鼓励了更具表现力的编程风格，因为它消除了干净、有文化的自我文档的下载成本。”

好处是 jsmin 还从 CSS 中删除了评论——所以你也可以在那里自由地开始评论。（我发现使用 css 类对于编写清晰的 javascript 至关重要。）

使用 PHP 动态剥离代码并组织 javascript 文件是一个有趣的想法。请记住，Web 应用程序的一项重要优化是[减少 HTTP 请求](http://developer.yahoo.com/performance/rules.html)，因此将较小的 javascript 文件连接在一起通常是明智的。（我发现简单地将最小化的 js 文件连接到一个文件中，效果很好。）

# git - 找出本地分支正在跟踪哪个远程分支

> ID：171550
> 
> 赞同：1044
> 
> 时间：2008-10-05T05:41:56.453
> 
> 标签：git, branch, git-remote

> **另请参阅：**
> *[如何查看哪些 Git 分支正在跟踪哪个远程/上游分支？](https://stackoverflow.com/questions/4950725)*

如何找出本地分支正在跟踪的远程分支？

我是否需要解析`git config`输出，或者是否有可以为我执行此操作的命令？

* * *

## 回答 #1

> 赞同：1206
> 
> 时间：2012-09-21T21:54:31.247

[这](https://git-scm.com/docs/git-branch#Documentation/git-branch.txt--vv)是一个为您提供所有跟踪分支的命令（配置为“拉”），请参阅：

```
$ git branch -vv
  main   aaf02f0 [main/master: ahead 25] Some other commit
* master add0a03 [jdsumsion/master] Some commit 
```

您必须浏览 SHA 和任何长包装的提交消息，但输入速度很快，而且我在第三列中垂直对齐了跟踪分支。

如果您需要有关每个分支的“拉”和“推”配置的信息，请参阅`git remote show origin`.

* * *

**更新**

从 git 版本 1.8.5 开始，您可以使用`git status`和显示上游分支`git status -sb`

* * *

## 回答 #2

> 赞同：447
> 
> 时间：2012-03-17T20:17:11.723

两种选择：

```
% git rev-parse --abbrev-ref --symbolic-full-name @{u}
origin/mainline 
```

或者

```
% git for-each-ref --format='%(upstream:short)' "$(git symbolic-ref -q HEAD)"
origin/mainline 
```

* * *

## 回答 #3

> 赞同：243
> 
> 时间：2011-10-11T22:25:28.213

我认为`git branch -av`只会告诉您您拥有哪些分支以及它们所在的提交，让您推断本地分支正在跟踪哪些远程分支。

`git remote show origin`明确告诉您哪些分支正在跟踪哪些远程分支。这是来自存储库的示例输出，其中包含一个提交和一个名为的远程分支`abranch`：

```
$ git branch -av
* abranch                d875bf4 initial commit
  master                 d875bf4 initial commit
  remotes/origin/HEAD    -> origin/master
  remotes/origin/abranch d875bf4 initial commit
  remotes/origin/master  d875bf4 initial commit 
```

相对

```
$ git remote show origin
* remote origin
  Fetch URL: /home/ageorge/tmp/d/../exrepo/
  Push  URL: /home/ageorge/tmp/d/../exrepo/
  HEAD branch (remote HEAD is ambiguous, may be one of the following):
    abranch
    master
  Remote branches:
    abranch tracked
    master  tracked
  Local branches configured for 'git pull':
    abranch merges with remote abranch
    master  merges with remote master
  Local refs configured for 'git push':
    abranch pushes to abranch (up to date)
    master  pushes to master  (up to date) 
```

* * *

## 回答 #4

> 赞同：87
> 
> 时间：2011-08-31T00:37:39.040

**更新：**嗯，自从我发布这个已经好几年了！对于我将 HEAD 与上游进行比较的特定目的，我现在使用`@{u}`，它是指上游跟踪分支的 HEAD 的快捷方式。（参见[https://git-scm.com/docs/gitrevisions#gitrevisions-emltbranchnamegtupstreamemegemmasterupstreamememuem](https://git-scm.com/docs/gitrevisions#gitrevisions-emltbranchnamegtupstreamemegemmasterupstreamememuem)）。

**原始答案：**我也遇到过这个问题。我经常在一个存储库中使用多个遥控器，很容易忘记您当前的分支正在跟踪哪个。有时知道这一点很方便，例如当您想通过`git log remotename/branchname..HEAD`.

所有这些东西都存储在 git config 变量中，但您不必解析 git config 输出。如果您调用 git config 后跟一个变量的名称，它只会打印该变量的值，不需要解析。考虑到这一点，这里有一些命令可以获取有关当前分支跟踪设置的信息：

```
LOCAL_BRANCH=`git name-rev --name-only HEAD`
TRACKING_BRANCH=`git config branch.$LOCAL_BRANCH.merge`
TRACKING_REMOTE=`git config branch.$LOCAL_BRANCH.remote`
REMOTE_URL=`git config remote.$TRACKING_REMOTE.url` 
```

就我而言，因为我只对找出当前遥控器的名称感兴趣，所以我这样做：

```
git config branch.`git name-rev --name-only HEAD`.remote 
```

* * *

## 回答 #5

> 赞同：54
> 
> 时间：2016-07-16T00:37:53.593

本地分支机构及其远程。

```
git branch -vv 
```

所有分支机构和跟踪遥控器。

```
git branch -a -vv 
```

查看本地分支在何处显式配置为推送和拉取。

```
git remote show {remote_name} 
```

* * *

## 回答 #6

> 赞同：32
> 
> 时间：2019-11-15T08:18:00.733

`git branch -vv | grep 'BRANCH_NAME'`

`git branch -vv`：这部分将显示所有本地分支及其上游分支。

`grep 'BRANCH_NAME'`：它将从分支列表中过滤当前分支。

* * *

## 回答 #7

> 赞同：29
> 
> 时间：2016-11-16T11:26:25.003

这将向您显示您所在的分支：

```
$ git branch -vv 
```

这将**仅**显示您所在的当前分支：

```
$ git for-each-ref --format='%(upstream:short)' $(git symbolic-ref -q HEAD) 
```

例如：

```
myremote/mybranch 
```

**您可以找到您所在的当前分支**使用的**远程**URL ：

 **```
$ git remote get-url $(git for-each-ref --format='%(upstream:short)' $(git symbolic-ref -q HEAD)|cut -d/ -f1) 
```

例如：

```
https://github.com/someone/somerepo.git 
```

* * *

## 回答 #8

> 赞同：24
> 
> 时间：2014-10-23T10:27:46.023

您可以使用`git checkout`，即“签出当前分支”。这是一个无操作，具有显示当前分支的跟踪信息（如果存在）的副作用。

```
$ git checkout 
Your branch is up-to-date with 'origin/master'. 
```

* * *

## 回答 #9

> 赞同：20
> 
> 时间：2011-06-21T12:17:29.973

我不知道这是否算作解析 git config 的输出，但这将确定 master 正在跟踪的远程 URL：

```
$ git config remote.$(git config branch.master.remote).url

```

* * *

## 回答 #10

> 赞同：16
> 
> 时间：2015-09-16T16:17:40.587

还有一种方式

```
git status -b --porcelain 
```

这会给你

```
## BRANCH(...REMOTE)
modified and untracked files 
```

* * *

## 回答 #11

> 赞同：12
> 
> 时间：2020-02-19T09:44:07.287

git-status瓷器（机器可读）v2输出如下所示：

```
$ git status -b --porcelain=v2
# branch.oid d0de00da833720abb1cefe7356493d773140b460
# branch.head the-branch-name
# branch.upstream gitlab/the-branch-name
# branch.ab +2 -2 
```

并且仅获取上游分支：

```
$ git status -b --porcelain=v2 | grep -m 1 "^# branch.upstream " | cut -d " " -f 3-
gitlab/the-branch-name 
```

如果分支没有上游，上述命令将产生一个空输出（或失败`set -o pipefail`）。

* * *

## 回答 #12

> 赞同：11
> 
> 时间：2014-12-10T07:19:42.593

另一种简单的方法是使用

`cat .git/config`在 git 仓库中

这将列出本地分支机构的详细信息

* * *

## 回答 #13

> 赞同：9
> 
> 时间：2016-03-07T02:36:16.620

```
git branch -r -vv 
```

将列出所有分支，包括远程。

* * *

## 回答 #14

> 赞同：9
> 
> 时间：2015-08-27T17:26:36.413

另一种方法（感谢 osse），如果您只想知道它是否存在：

```
if git rev-parse @{u} > /dev/null 2>&1
then
  printf "has an upstream\n"
else
  printf "has no upstream\n"
fi 
```

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2019-04-15T23:30:20.173

列出本地和远程分支：

```
$ git branch -ra 
```

输出：

```
 feature/feature1
  feature/feature2
  hotfix/hotfix1
* master
  remotes/origin/HEAD -> origin/master
  remotes/origin/develop
  remotes/origin/master 
```

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2019-05-03T11:18:03.833

你可以试试这个：

```
git remote show origin | grep "branch_name" 
```

`branch_name`需要替换为您的分支

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2018-10-22T13:43:35.133

如果您想找到*任何*分支的上游（而不仅仅是您所在的分支），这里对@cdunn2001 的答案稍作修改：

`git rev-parse --abbrev-ref --symbolic-full-name YOUR_LOCAL_BRANCH_NAME@{upstream}`

这将为您提供名为的本地分支的远程分支名称`YOUR_LOCAL_BRANCH_NAME`。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2020-08-25T19:07:37.880

在这里尝试了所有解决方案后，我意识到它们在所有情况下都不是很好：

*   在当地分支机构工作
*   在分离的树枝上工作
*   在 CI 下工作

此命令获取所有名称：

```
git branch -a --contains HEAD --list --format='%(refname:short)' 
```

对于我的应用程序，我必须过滤掉 HEAD 和 master refs，更喜欢 remote refs，并去掉“origin/”这个词。然后如果没有找到，使用第一个没有 a`/`或 a`(`的非 HEAD ref。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2012-04-04T15:27:20.583

我使用这个别名

```
git config --global alias.track '!sh -c "
if [ \$# -eq 2 ]
 then
   echo \"Setting tracking for branch \" \$1 \" -> \" \$2;
   git branch --set-upstream \$1 \$2;
 else
   git for-each-ref --format=\"local: %(refname:short) <--sync--> remote: %(upstream:short)\" refs/heads && echo --URLs && git remote -v;
fi  
" -' 
```

然后

```
git track 
```

请注意，该脚本也可用于设置跟踪。

[https://github.com/orefalo/bash-profiles](https://github.com/orefalo/bash-profiles)上有更多很棒的别名

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2015-07-09T04:30:19.583

以下命令将远程起源当前叉指

> git 远程 -v

要添加远程路径，

> git 远程添加源路径名

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2018-10-19T16:32:58.477

改进[这个答案](https://stackoverflow.com/a/7251377/5353461)，我想出了这些`.gitconfig`别名：

```
branch-name = "symbolic-ref --short HEAD"
branch-remote-fetch = !"branch=$(git branch-name) && git config branch.\"$branch\".remote || echo origin #"
branch-remote-push  = !"branch=$(git branch-name) && git config branch.\"$branch\".pushRemote || git config remote.pushDefault || git branch-remote-fetch #"
branch-url-fetch = !"remote=$(git branch-remote-fetch) && git remote get-url        \"$remote\" #"  # cognizant of insteadOf
branch-url-push  = !"remote=$(git branch-remote-push ) && git remote get-url --push \"$remote\" #"  # cognizant of pushInsteadOf 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2016-09-12T18:20:22.987

如果你使用 Gradle，

```
def gitHash = new ByteArrayOutputStream()
    project.exec {
        commandLine 'git', 'rev-parse', '--short', 'HEAD'
        standardOutput = gitHash
    }

def gitBranch = new ByteArrayOutputStream()
    project.exec {
        def gitCmd = "git symbolic-ref --short -q HEAD || git branch -rq --contains "+getGitHash()+" | sed -e '2,\$d'  -e 's/\\(.*\\)\\/\\(.*\\)\$/\\2/' || echo 'master'"
        commandLine "bash", "-c", "${gitCmd}"
        standardOutput = gitBranch
    } 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2022-02-08T19:57:27.270

```
git branch -vv | grep 'hardcode-branch-name'
# "git rev-parse --abbrev-ref head" will get your current branch name
# $(git rev-parse --abbrev-ref head) save it as string
#  find the tracking branch by grep filtering the current branch 
git branch -vv | grep $(git rev-parse --abbrev-ref head) 
```

* * *

## 回答 #24

> 赞同：-2
> 
> 时间：2008-10-05T14:39:10.503

我使用[EasyGit（又名“eg”）](https://people.gnome.org/~newren/eg/)作为 Git 顶部（或旁边）的超轻量级包装器。EasyGit 有一个“info”子命令，可以为你提供各种超级有用的信息，包括当前分支远程跟踪分支。这是一个示例（当前分支名称为“foo”）：

```
pknotz@s883422: (foo) ~/workspace/bd
$ 例如信息
总提交：175
本地存储库：.git
命名的远程存储库：（名称 -> 位置）
  起源-> git://sahp7577/home/pknotz/bd.git
当前分支： foo
  加密校验和（sha1sum）：bd248d1de7d759eb48e8b5ff3bfb3bb0eca4c5bf
  默认拉/推存储库：原点
  默认拉/推选项：
    branch.foo.remote = 原点
    branch.foo.merge = refs/heads/aal_devel_1
  贡献者人数：3
  文件数：28
  目录数量：20
  最大文件大小，以字节为单位：32473 (pygooglechart-0.2.0/COPYING)
  提交：62

```

# javascript - Firefox 的 Javascript 内存分析器

> ID：171565
> 
> 赞同：51
> 
> 时间：2008-10-05T06:10:00.483
> 
> 标签：javascript, firefox, memory, profiling

是否有用于 Firefox 的工具/插件/功能可以转储您在页面/脚本中创建的 Javascript 对象的内存使用情况？我知道 Firebug 的分析器，但我想要的不仅仅是时间。类似于 Yourkit 用于 Java 内存使用分析的东西。

原因是一位同事在数组中使用 id 作为“键”，并在他这样做时创建了 1000 个空槽。他认为这是无害的，而我的看法不同。我想提供一些证据来证明我是否正确。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-05T18:27:41.960

我还没有尝试过软件验证工具，但 Mozilla 有一些工具可以跟踪 firefox 消耗的整体内存以阻止泄漏：

[http://www.mozilla.org/performance/tools.html](http://www.mozilla.org/performance/tools.html)

和：

[https://wiki.mozilla.org/Performance:Leak_Tools](https://wiki.mozilla.org/Performance:Leak_Tools)

还有一个人说要避免在闭包的情况下使用大数组，朝向文章底部

[http://ajax.sys-con.com/node/352585](http://ajax.sys-con.com/node/352585)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-05T06:31:29.940

我认为Software Verification Limited 的[JavaScript Memory Validator](http://www.softwareverify.com/javascript/memory/feature.html)可以为您提供帮助，它有分配视图、对象视图、世代视图等。它不是免费的，但您可以使用评估版来检查您同事的代码。他们还有一个性能和覆盖率验证器......

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-05T15:02:42.687

查看[源代码](http://mxr.mozilla.org/mozilla-central/source/js/src/jsarray.cpp#41)。稀疏数组不会占用大量内存，但是如果您的同事不需要任何`Array`功能，那么无论如何他都应该使用 plain `Object`s。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2014-03-17T15:28:51.467

还可以尝试`about:memory`显示每个窗口占用多少内存以及其中有多少专用于 JS 对象。它提供了没有每个对象使用情况的高级摘要，但它是调查站点内存需求的一个很好的起点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-07-12T09:32:23.773

您可以使用 Mozilla 的开发者工具。为了使用 Firefox 的高级开发人员工具，您需要创建一个调试版本而不是发布版本。有关构建过程的更多信息，请参阅[页面](https://developer.mozilla.org/en-US/docs/Simple_Firefox_build#Building)。此外，您可以在[本文](http://injoit.org/index.php/j1/article/view/218/169)中找到有关使用 Mozilla 开发人员工具的更多信息。

# delphi - 使用 TTreeview 作为菜单

> ID：171566
> 
> 赞同：1
> 
> 时间：2008-10-05T06:14:17.353
> 
> 标签：delphi

我使用 delphi 的 ttreeview 作为“选项”菜单。我将如何在运行时选择下一个节点，如上一个和下一个按钮？我尝试了 getprev 和 getnext 方法，但没有运气。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-05T08:56:15.203

在这里，您有“下一步”行为。对于“以前”，我留给你做练习：:-)

```
procedure TForm8.btn1Click(Sender: TObject);  
var  
  crt: TTreeNode;

begin
  with tv1 do //this is our tree
  begin
    if Selected=nil then
      crt:=Items[0] //the first one
    else
      crt:=Selected.GetNext; //for previous you'll have 'GetPrev' 

    if crt<>nil then //can be 'nil' if we reached to the end
      Selected:=crt;
  end;
end; 
```

高温高压

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-06T22:16:31.157

也许树项中有一些空间来存储指向您正确页面的指针。

但是 - 如果你有时间 - 尝试探索[Virtual Treeview](http://www.delphi-gems.com/index.php?option=com_content&task=view&id=12&Itemid=38) - 它是 Delphi 最好的 treeview 组件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-03T18:58:05.257

这是另一种方法：

```
type TfrmMain = class(TForm)
...
   public
      DLLHandle : THandle;
      function GetNodePath(node: TTreeNode; delimiter: string = '\') : String;

...

function TfrmMain.GetNodePath(node: TTreeNode; delimiter: string = '\') : String;
begin
   Result:='';
   while Assigned(node) do
    begin
      Result:=delimiter+node.Text+Result;
      node:=node.Parent;
   end;
   if Result <> '' then
      Delete(Result, 1, 1);
end;

... 
```

这里是如何使用它：在你的树视图的单击或双击事件上执行此操作

```
...
var
   path : String;
begin
   path:=GetNodePath(yourTreeView.Selected);
   ShowMessage(path);
... 
```

如果您有一个“项目 1”和一个名为“项目 1”的子项目，然后单击项目 2，则消息应该是“项目 1\项目 2”。通过这样做，您可以更好地控制...

希望这能给你另一个想法来增强你的代码

# linux - Ubuntu JeOS 是否适合生产目的？

> ID：171569
> 
> 赞同：1
> 
> 时间：2008-10-05T06:21:17.840
> 
> 标签：linux, ubuntu

实际上，我想将那个 JeOS 用于我们的网络服务器。这是一个不错的选择吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-05T07:25:36.867

谢谢你激起了我的兴趣。从[Ubuntu 网站](http://www.ubuntu.com/products/whatisubuntu/serveredition/jeos)：

> Ubuntu Server Edition JeOS（发音为“Juice”）是我们服务器操作系统的一种高效变体，专门为虚拟设备配置。JeOS 目前可作为 CD-Rom ISO 下载，它是 Ubuntu 服务器版的专门安装，具有经过调整的内核，仅包含在虚拟化环境中运行所需的基本元素。

这对我来说看起来很有希望——我运行了几个完整的 Ubuntu 8.04 虚拟机，所以我一定会检查一下。为什么不试试呢？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-05T09:47:49.590

请注意，它安装的内核被精简为仅具有虚拟机所需的东西，因此您可能会在从真机访问网络时遇到问题。（请注意，install-CD 内核也与已安装的内核不同）。

如果你能绕过它（IIRC 我从 CD 启动，并下载了正常的服务器内核，一切正常），那么你最终会得到一个绝对最小的 Linux 系统，但由完整的 Ubuntu 存储库支持，所以它是一个很好的基础为服务器。

另请注意，最小实际上意味着最小 - 例如，默认情况下没有 cron。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-05T12:31:49.743

> 这是一个不错的选择吗？

如果您打算在虚拟机中运行 JeOS，那么是的，这是一个不错的选择。

# migration - 将 Web 应用程序从 Netscape 迁移到 IIS 的最佳实践？

> ID：171578
> 
> 赞同：0
> 
> 时间：2008-10-05T06:29:41.737
> 
> 标签：migration, dns

我们正在开发基于 .NET 的 IIS 托管 Web 应用程序，作为重新平台项目的一部分。最初的 Web 应用程序位于 Netscape 服务器上，在迁移过程中，我们需要将 dns 指向 IIS 服务器，以便 IIS 响应请求。同时，我们仍然需要 Netscape 服务器，以便将用户从 IIS Web 应用程序重定向到新应用程序尚未处理的网站区域。

旧应用程序是基于框架的，因此我们计划在内容区域（Web 客户端软件工厂中的母版页）中使用 IFrame，并使用 URL 重写引擎在 iframe 中呈现来自旧系统的页面。

我们还需要将当前指向 Netscape 服务器的 DNS 条目指向 IIS。

上述活动是否有最佳实践？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-05T10:55:39.580

也许此链接可以提供帮助：[将 Web 服务器迁移到 IIS：基本步骤](http://technet.microsoft.com/en-us/library/bb742537.aspx)

它讨论了为 Internet 信息服务 (IIS) 做好准备可以采取的步骤。在本文中，作者采用“具体细节”的方法来迁移单个 Web 服务器。

您将找到有关将配置设置和内容从其他类型的 Web 服务器（例如 Apache HTTP Server 或**Netscape Enterprise Server** ）迁移到运行 IIS 5.0 的服务器的详细信息。

# windows - 是否有从 Windows 的命令提示符刷新环境变量的命令？

> ID：171588
> 
> 赞同：593
> 
> 时间：2008-10-05T06:49:38.407
> 
> 标签：windows, cmd, environment-variables

如果我修改或添加环境变量，我必须重新启动命令提示符。有没有我可以执行的命令可以在不重新启动 CMD 的情况下执行此操作？

* * *

## 回答 #1

> 赞同：211
> 
> 时间：2017-06-28T16:23:48.243

在 Windows 7/8/10 上，您可以安装 Chocolatey，它有一个内置脚本。

安装 Chocolatey 后，只需键入`refreshenv`.

* * *

## 回答 #2

> 赞同：149
> 
> 时间：2008-10-05T09:10:28.247

可以用vbs脚本捕获系统环境变量，但是需要bat脚本才能真正改变当前的环境变量，所以这是一个组合解决方案。

创建一个名为`resetvars.vbs`包含此代码的文件，并将其保存在路径中：

```
Set oShell = WScript.CreateObject("WScript.Shell")
filename = oShell.ExpandEnvironmentStrings("%TEMP%\resetvars.bat")
Set objFileSystem = CreateObject("Scripting.fileSystemObject")
Set oFile = objFileSystem.CreateTextFile(filename, TRUE)

set oEnv=oShell.Environment("System")
for each sitem in oEnv 
    oFile.WriteLine("SET " & sitem)
next
path = oEnv("PATH")

set oEnv=oShell.Environment("User")
for each sitem in oEnv 
    oFile.WriteLine("SET " & sitem)
next

path = path & ";" & oEnv("PATH")
oFile.WriteLine("SET PATH=" & path)
oFile.Close 
```

创建另一个包含此代码的文件名 resetvars.bat，位置相同：

```
@echo off
%~dp0resetvars.vbs
call "%TEMP%\resetvars.bat" 
```

当您要刷新环境变量时，只需运行`resetvars.bat`

* * *

*道歉*：

我提出这个解决方案的两个主要问题是

**一种。**我找不到将环境变量从 vbs 脚本导出回命令提示符的简单方法，并且

**湾。**PATH 环境变量是用户和系统 PATH 变量的串联。

我不确定用户和系统之间的变量冲突的一般规则是什么，所以我选择让用户覆盖系统，除了专门处理的 PATH 变量。

我使用怪异的vbs+bat+临时bat机制来解决从vbs导出变量的问题。

**注意**：此脚本不会删除变量。

这大概可以改进。

**添加**

如果您需要将环境从一个 cmd 窗口导出到另一个，请使用此脚本（我们称之为`exportvars.vbs`）：

```
Set oShell = WScript.CreateObject("WScript.Shell")
filename = oShell.ExpandEnvironmentStrings("%TEMP%\resetvars.bat")
Set objFileSystem = CreateObject("Scripting.fileSystemObject")
Set oFile = objFileSystem.CreateTextFile(filename, TRUE)

set oEnv=oShell.Environment("Process")
for each sitem in oEnv 
    oFile.WriteLine("SET " & sitem)
next
oFile.Close 
```

`exportvars.vbs`在要导出的窗口中**运行**，然后切换到要导出到的窗口**，**然后键入：

```
"%TEMP%\resetvars.bat" 
```

* * *

## 回答 #3

> 赞同：144
> 
> 时间：2015-09-06T06:01:33.660

这是 Chocolatey 使用的。

[https://github.com/chocolatey/choco/blob/master/src/chocolatey.resources/redirects/RefreshEnv.cmd](https://github.com/chocolatey/choco/blob/master/src/chocolatey.resources/redirects/RefreshEnv.cmd)

```
@echo off
::
:: RefreshEnv.cmd
::
:: Batch file to read environment variables from registry and
:: set session variables to these values.
::
:: With this batch file, there should be no need to reload command
:: environment every time you want environment changes to propagate

::echo "RefreshEnv.cmd only works from cmd.exe, please install the Chocolatey Profile to take advantage of refreshenv from PowerShell"
echo | set /p dummy="Refreshing environment variables from registry for cmd.exe. Please wait..."

goto main

:: Set one environment variable from registry key
:SetFromReg
    "%WinDir%\System32\Reg" QUERY "%~1" /v "%~2" > "%TEMP%\_envset.tmp" 2>NUL
    for /f "usebackq skip=2 tokens=2,*" %%A IN ("%TEMP%\_envset.tmp") do (
        echo/set "%~3=%%B"
    )
    goto :EOF

:: Get a list of environment variables from registry
:GetRegEnv
    "%WinDir%\System32\Reg" QUERY "%~1" > "%TEMP%\_envget.tmp"
    for /f "usebackq skip=2" %%A IN ("%TEMP%\_envget.tmp") do (
        if /I not "%%~A"=="Path" (
            call :SetFromReg "%~1" "%%~A" "%%~A"
        )
    )
    goto :EOF

:main
    echo/@echo off >"%TEMP%\_env.cmd"

    :: Slowly generating final file
    call :GetRegEnv "HKLM\System\CurrentControlSet\Control\Session Manager\Environment" >> "%TEMP%\_env.cmd"
    call :GetRegEnv "HKCU\Environment">>"%TEMP%\_env.cmd" >> "%TEMP%\_env.cmd"

    :: Special handling for PATH - mix both User and System
    call :SetFromReg "HKLM\System\CurrentControlSet\Control\Session Manager\Environment" Path Path_HKLM >> "%TEMP%\_env.cmd"
    call :SetFromReg "HKCU\Environment" Path Path_HKCU >> "%TEMP%\_env.cmd"

    :: Caution: do not insert space-chars before >> redirection sign
    echo/set "Path=%%Path_HKLM%%;%%Path_HKCU%%" >> "%TEMP%\_env.cmd"

    :: Cleanup
    del /f /q "%TEMP%\_envset.tmp" 2>nul
    del /f /q "%TEMP%\_envget.tmp" 2>nul

    :: capture user / architecture
    SET "OriginalUserName=%USERNAME%"
    SET "OriginalArchitecture=%PROCESSOR_ARCHITECTURE%"

    :: Set these variables
    call "%TEMP%\_env.cmd"

    :: Cleanup
    del /f /q "%TEMP%\_env.cmd" 2>nul

    :: reset user / architecture
    SET "USERNAME=%OriginalUserName%"
    SET "PROCESSOR_ARCHITECTURE=%OriginalArchitecture%"

    echo | set /p dummy="Finished."
    echo . 
```

* * *

## 回答 #4

> 赞同：68
> 
> 时间：2008-10-05T06:55:40.157

按照设计，Windows 没有**内置**机制将环境变量添加/更改/删除传播到已经运行的 cmd.exe，无论是从另一个 cmd.exe 还是从“我的电脑 -> 属性 -> 高级设置 ->环境变量”。

如果在现有打开的命令提示符范围之外修改或添加新环境变量，则需要重新启动命令提示符，或者在现有命令提示符中使用 SET 手动添加。

[最新接受](https://stackoverflow.com/questions/171588/is-there-a-command-to-refresh-environment-variables-from-the-command-prompt-in#171737)的答案显示了通过手动刷新脚本中的*所有*环境变量的部分解决方法。该脚本处理在“我的电脑...环境变量”中全局更改环境变量的用例，但如果在一个 cmd.exe 中更改了环境变量，该脚本将不会将其传播到另一个正在运行的 cmd.exe。

* * *

## 回答 #5

> 赞同：45
> 
> 时间：2014-02-25T22:11:12.547

在最终找到更简单的解决方案之前，我遇到了这个答案。

只需`explorer.exe`在任务管理器中重新启动。

我没有测试，但您可能还需要重新打开命令提示符。

[在此感谢 Timo Huovinen](https://stackoverflow.com/users/175071/timo-huovinen)：虽然[已成功安装，但无法识别节点](https://stackoverflow.com/questions/10129505/node-not-recognized-although-successfully-installed#comment19877828_10129850)（如果这对您有帮助，请给这个人的评论信用）。

* * *

## 回答 #6

> 赞同：29
> 
> 时间：2012-01-26T09:37:44.087

这适用于 Windows 7：`SET PATH=%PATH%;C:\CmdShortcuts`

通过键入 echo %PATH% 进行测试，它工作正常。如果你打开一个新的 cmd，也可以设置，不再需要那些讨厌的重启:)

* * *

## 回答 #7

> 赞同：24
> 
> 时间：2012-08-14T15:38:38.403

**使用“setx”并重新启动 cmd 提示符**

该作业有一个名为“ [setx](http://technet.microsoft.com/en-us/library/cc755104%28v=ws.10%29.aspx) ”的命令行工具。它用于**读取和写入**环境变量。命令窗口关闭后，变量仍然存在。

它“在用户或系统环境中创建或修改环境变量，无需编程或编写脚本[。setx](http://technet.microsoft.com/en-us/library/cc755104%28v=ws.10%29.aspx)命令还检索注册表项的值并将它们写入文本文件。”

注意：此工具创建或修改的变量将在未来的命令窗口中可用，但在当前的 CMD.exe 命令窗口中不可用。所以，你必须重新开始。

如果`setx`缺少：

*   [http://download.microsoft.com/download/win2000platform/setx/1.00.0.1/nt5/en-us/setx_setup.exe](http://download.microsoft.com/download/win2000platform/setx/1.00.0.1/nt5/en-us/setx_setup.exe)

* * *

**或者修改注册表**

[MSDN](https://msdn.microsoft.com/en-us/library/ms682653(v=vs.85).aspx)说：

> 要以编程方式添加或修改系统环境变量，请将它们添加到 **HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\Environment**注册表项，然后广播**WM_SETTINGCHANGE** 消息，并将**lParam**设置为字符串“ **Environment** ”。
> 
> 这允许应用程序（例如 shell）获取您的更新。

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2010-03-19T18:15:39.027

调用此函数对我有用：

```
VOID Win32ForceSettingsChange()
{
    DWORD dwReturnValue;
    ::SendMessageTimeout(HWND_BROADCAST, WM_SETTINGCHANGE, 0, (LPARAM) "Environment", SMTO_ABORTIFHUNG, 5000, &dwReturnValue);
} 
```

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2012-06-21T21:36:20.570

我想出的最好的方法是只做一个注册表查询。这是我的例子。

在我的示例中，我使用添加了新环境变量的批处理文件进行了安装。安装完成后，我需要立即执行此操作，但无法使用这些新变量生成新进程。我测试了生成另一个资源管理器窗口并回调到 cmd.exe 并且这有效，但是在 Vista 和 Windows 7 上，资源管理器仅作为单个实例运行，并且通常在登录的人时运行。这会因自动化而失败，因为我需要我的管理员凭据无论是从本地系统运行还是以管理员身份在盒子上运行。对此的限制是它不处理路径之类的东西，这只适用于简单的环境变量。这使我可以使用批处理来访问目录（带有空格）并复制运行 .exes 等文件。这是今天从 stackoverflow.com 上的可能资源编写的

原始批次调用新批次：

testenvget.cmd SDROOT（或任何变量）

```
@ECHO OFF
setlocal ENABLEEXTENSIONS
set keyname=HKLM\System\CurrentControlSet\Control\Session Manager\Environment
set value=%1
SET ERRKEY=0

REG QUERY "%KEYNAME%" /v "%VALUE%" 2>NUL| FIND /I "%VALUE%"
IF %ERRORLEVEL% EQU 0 (
ECHO The Registry Key Exists 
) ELSE (
SET ERRKEY=1
Echo The Registry Key Does not Exist
)

Echo %ERRKEY%
IF %ERRKEY% EQU 1 GOTO :ERROR

FOR /F "tokens=1-7" %%A IN ('REG QUERY "%KEYNAME%" /v "%VALUE%" 2^>NUL^| FIND /I "%VALUE%"') DO (
ECHO %%A
ECHO %%B
ECHO %%C
ECHO %%D
ECHO %%E
ECHO %%F
ECHO %%G
SET ValueName=%%A
SET ValueType=%%B
SET C1=%%C
SET C2=%%D
SET C3=%%E
SET C4=%%F
SET C5=%%G
)

SET VALUE1=%C1% %C2% %C3% %C4% %C5%
echo The Value of %VALUE% is %C1% %C2% %C3% %C4% %C5%
cd /d "%VALUE1%"
pause
REM **RUN Extra Commands here**
GOTO :EOF

:ERROR
Echo The the Enviroment Variable does not exist.
pause
GOTO :EOF 
```

还有另一种方法是我从各种不同的想法中提出的。请看下文。这基本上会从注册表中获取最新的路径变量，但是，这会导致一些问题，因为注册表查询本身会给出变量，这意味着任何地方都有一个变量不起作用，所以为了解决这个问题，我基本上是双倍的路径。非常讨厌。更优选的方法是： Set Path=%Path%;C:\Program Files\Software....\

不管这里是新的批处理文件，请谨慎使用。

```
@ECHO OFF
SETLOCAL ENABLEEXTENSIONS
set org=%PATH%
for /f "tokens=2*" %%A in ('REG QUERY "HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Environment" /v Path ^|FIND /I "Path"') DO (
SET path=%%B
)
SET PATH=%org%;%PATH%
set path 
```

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2016-06-28T22:18:17.140

在不为当前会话重新启动的情况下将变量添加到路径的最简单方法是打开命令提示符并键入：

```
PATH=(VARIABLE);%path% 
```

并按`enter`。

要检查您的变量是否已加载，请键入

```
PATH 
```

并按`enter`。但是，在您重新启动之前，该变量将只是路径的一部分。

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2017-02-08T15:03:41.840

重新启动资源管理器为我做了这个，但只适用于新的 cmd 终端。

我设置路径的终端已经可以看到新的 Path 变量（在 Windows 7 中）。

```
taskkill /f /im explorer.exe && explorer.exe 
```

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2013-08-15T16:28:22.200

可以通过覆盖指定进程本身内的环境表来做到这一点。

作为概念证明，我编写了这个示例应用程序，它只是在 cmd.exe 进程中编辑了一个（已知的）环境变量：

```
typedef DWORD (__stdcall *NtQueryInformationProcessPtr)(HANDLE, DWORD, PVOID, ULONG, PULONG);

int __cdecl main(int argc, char* argv[])
{
    HMODULE hNtDll = GetModuleHandleA("ntdll.dll");
    NtQueryInformationProcessPtr NtQueryInformationProcess = (NtQueryInformationProcessPtr)GetProcAddress(hNtDll, "NtQueryInformationProcess");

    int processId = atoi(argv[1]);
    printf("Target PID: %u\n", processId);

    // open the process with read+write access
    HANDLE hProcess = OpenProcess(PROCESS_QUERY_LIMITED_INFORMATION | PROCESS_VM_READ | PROCESS_VM_WRITE | PROCESS_VM_OPERATION, 0, processId);
    if(hProcess == NULL)
    {
        printf("Error opening process (%u)\n", GetLastError());
        return 0;
    }

    // find the location of the PEB
    PROCESS_BASIC_INFORMATION pbi = {0};
    NTSTATUS status = NtQueryInformationProcess(hProcess, ProcessBasicInformation, &pbi, sizeof(pbi), NULL);
    if(status != 0)
    {
        printf("Error ProcessBasicInformation (0x%8X)\n", status);
    }
    printf("PEB: %p\n", pbi.PebBaseAddress);

    // find the process parameters
    char *processParamsOffset = (char*)pbi.PebBaseAddress + 0x20; // hard coded offset for x64 apps
    char *processParameters = NULL;
    if(ReadProcessMemory(hProcess, processParamsOffset, &processParameters, sizeof(processParameters), NULL))
    {
        printf("UserProcessParameters: %p\n", processParameters);
    }
    else
    {
        printf("Error ReadProcessMemory (%u)\n", GetLastError());
    }

    // find the address to the environment table
    char *environmentOffset = processParameters + 0x80; // hard coded offset for x64 apps
    char *environment = NULL;
    ReadProcessMemory(hProcess, environmentOffset, &environment, sizeof(environment), NULL);
    printf("environment: %p\n", environment);

    // copy the environment table into our own memory for scanning
    wchar_t *localEnvBlock = new wchar_t[64*1024];
    ReadProcessMemory(hProcess, environment, localEnvBlock, sizeof(wchar_t)*64*1024, NULL);

    // find the variable to edit
    wchar_t *found = NULL;
    wchar_t *varOffset = localEnvBlock;
    while(varOffset < localEnvBlock + 64*1024)
    {
        if(varOffset[0] == '\0')
        {
            // we reached the end
            break;
        }
        if(wcsncmp(varOffset, L"ENVTEST=", 8) == 0)
        {
            found = varOffset;
            break;
        }
        varOffset += wcslen(varOffset)+1;
    }

    // check to see if we found one
    if(found)
    {
        size_t offset = (found - localEnvBlock) * sizeof(wchar_t);
        printf("Offset: %Iu\n", offset);

        // write a new version (if the size of the value changes then we have to rewrite the entire block)
        if(!WriteProcessMemory(hProcess, environment + offset, L"ENVTEST=def", 12*sizeof(wchar_t), NULL))
        {
            printf("Error WriteProcessMemory (%u)\n", GetLastError());
        }
    }

    // cleanup
    delete[] localEnvBlock;
    CloseHandle(hProcess);

    return 0;
} 
```

样本输出：

```
>set ENVTEST=abc

>cppTest.exe 13796
Target PID: 13796
PEB: 000007FFFFFD3000
UserProcessParameters: 00000000004B2F30
environment: 000000000052E700
Offset: 1528

>set ENVTEST
ENVTEST=def 
```

## 笔记

这种方法也将仅限于安全限制。如果目标运行在更高的高度或更高的帐户（例如 SYSTEM），那么我们将无权编辑其内存。

如果您想对 32 位应用程序执行此操作，则上面的硬编码偏移量将分别更改为 0x10 和 0x48。这些偏移量可以通过在调试器中转储 _PEB 和 _RTL_USER_PROCESS_PARAMETERS 结构来找到（例如在 WinDbg`dt _PEB`和中`dt _RTL_USER_PROCESS_PARAMETERS`）

要将概念验证更改为 OP 所需的内容，它只需枚举当前系统和用户环境变量（例如 @tsadok 的回答所记录的）并将整个环境表写入目标进程的内存。

*编辑：*环境块的大小也存储在 _RTL_USER_PROCESS_PARAMETERS 结构中，但内存是在进程的堆上分配的。因此，从外部进程我们将无法调整它的大小并使其变大。我尝试使用 VirtualAllocEx 在目标进程中为环境存储分配额外的内存，并且能够设置和读取一个全新的表。不幸的是，任何从正常方式修改环境的尝试都会崩溃并烧毁，因为地址不再指向堆（它将在 RtlSizeHeap 中崩溃）。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2011-02-24T22:05:32.223

环境变量保存在 HKEY_LOCAL_MACHINE\SYSTEM\ControlSet\Control\Session Manager\Environment 中。

许多有用的环境变量（例如 Path）存储为 REG_SZ。有几种方法可以访问注册表，包括 REGEDIT：

``REGEDIT /E &lt;filename&gt; "HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\Session Manager\Environment"``

输出以幻数开头。因此，要使用 find 命令搜索它，需要键入并重定向它：`type <filename> | findstr -c:\"Path\"`

因此，如果您只想使用系统属性中的内容刷新当前命令会话中的路径变量，则以下批处理脚本可以正常工作：

刷新路径.cmd：

```
    @echo 关闭

    REM 此解决方案请求提升以便从注册表中读取。

    如果存在 %temp%\env.reg del %temp%\env.reg /q /f

    REGEDIT /E %temp%\env.reg "HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Control\Session Manager\Environment"

    如果不存在 %temp%\env.reg (
       echo "无法将注册表写入临时位置"
       1号出口
       )

    SETLOCAL EnableDelayedExpansion

    for /f "tokens=1,2* delims==" %%i in ('type %temp%\env.reg ^| findstr -c:\"Path\"=') 做 (
       设置路径=%%~j
       回声 !upath:\\=\! >%temp%\新路径
       )

     本地化

     for /f "tokens=*" %%i in (%temp%\newpath) 设置路径=%%i
```

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2015-12-22T20:53:58.363

尝试以管理员身份打开新的命令提示符。这在 Windows 10 上对我有用。（我知道这是一个旧答案，但我不得不分享这个，因为必须为此编写 VBS 脚本是荒谬的）。

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2017-07-13T12:37:50.457

令人困惑的事情可能是有几个地方可以启动 cmd。在我的情况下，我**从 Windows 资源管理器运行 cmd**并且环境**变量没有改变，而****从“运行”**（windows key + r）启动 cmd 时，环境**变量被改变了**。

在我的情况下，我只需**要从任务管理器中终止 Windows 资源管理器进程，然后从任务管理器中重新启动它**。

一旦我这样做了，我就可以从 Windows 资源管理器生成的 cmd 访问新的环境变量。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2014-05-21T08:32:29.613

我在批处理脚本中使用以下代码：

```
if not defined MY_ENV_VAR (
    setx MY_ENV_VAR "VALUE" > nul
    set MY_ENV_VAR=VALUE
)
echo %MY_ENV_VAR% 
```

通过在**SETX**之后使用**SET** ，可以直接使用“本地”变量，而无需重新启动命令窗口。在下一次运行时，将使用环境变量。

 *** * *

## 回答 #17

> 赞同：4
> 
> 时间：2017-06-21T07:49:33.043

如果它只涉及您想要更改的一个（或几个）特定变量，我认为最简单的方法是一种**解决方法**：只需在您的环境和当前的控制台会话中设置

*   Set 会将 var 放入当前会话中
*   SetX 会将 var 放入环境中，但不在您当前的会话中

我有这个简单的批处理脚本来将我的 Maven 从 Java7 更改为 Java8（它们都是 env.vars）批处理文件夹在我的*PATH* var 中，所以我总是可以在我的控制台和环境中调用“ **j8** ”以及我的 JAVA_HOME var变了：

**j8.bat：**

```
@echo off
set JAVA_HOME=%JAVA_HOME_8%
setx JAVA_HOME "%JAVA_HOME_8%" 
```

到目前为止，我发现这个工作最好，最简单。您可能希望它在一个命令中，但它根本不存在于 Windows 中......

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2019-11-27T07:38:18.223

我已经使用了几年的解决方案：

```
@echo off
rem Refresh PATH from registry.
setlocal
set USR_PATH=
set SYS_PATH=
for /F "tokens=3* skip=2" %%P in ('%SystemRoot%\system32\reg.exe query "HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Environment" /v PATH') do @set "SYS_PATH=%%P %%Q"
for /F "tokens=3* skip=2" %%P in ('%SystemRoot%\system32\reg.exe query "HKCU\Environment" /v PATH') do @set "USR_PATH=%%P %%Q"
if "%SYS_PATH:~-1%"==" " set "SYS_PATH=%SYS_PATH:~0,-1%"
if "%USR_PATH:~-1%"==" " set "USR_PATH=%USR_PATH:~0,-1%"
endlocal & call set "PATH=%SYS_PATH%;%USR_PATH%"
goto :EOF 
```

**编辑：**糟糕，这是更新版本。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2016-05-21T00:49:18.503

我喜欢巧克力遵循的方法，正如匿名懦夫的回答中所发布的那样，因为它是一种纯粹的批处理方法。但是，它会留下一个临时文件和一些临时变量。我为自己制作了一个更干净的版本。

在. `refreshEnv.bat`_ `PATH`通过执行刷新控制台环境`refreshEnv`。

```
@ECHO OFF
REM Source found on https://github.com/DieterDePaepe/windows-scripts
REM Please share any improvements made!

REM Code inspired by http://stackoverflow.com/questions/171588/is-there-a-command-to-refresh-environment-variables-from-the-command-prompt-in-w

IF [%1]==[/?] GOTO :help
IF [%1]==[/help] GOTO :help
IF [%1]==[--help] GOTO :help
IF [%1]==[] GOTO :main

ECHO Unknown command: %1
EXIT /b 1 

:help
ECHO Refresh the environment variables in the console.
ECHO.
ECHO   refreshEnv       Refresh all environment variables.
ECHO   refreshEnv /?        Display this help.
GOTO :EOF

:main
REM Because the environment variables may refer to other variables, we need a 2-step approach.
REM One option is to use delayed variable evaluation, but this forces use of SETLOCAL and
REM may pose problems for files with an '!' in the name.
REM The option used here is to create a temporary batch file that will define all the variables.

REM Check to make sure we don't overwrite an actual file.
IF EXIST %TEMP%\__refreshEnvironment.bat (
  ECHO Environment refresh failed!
  ECHO.
  ECHO This script uses a temporary file "%TEMP%\__refreshEnvironment.bat", which already exists. The script was aborted in order to prevent accidental data loss. Delete this file to enable this script.
  EXIT /b 1
)

REM Read the system environment variables from the registry.
FOR /F "usebackq tokens=1,2,* skip=2" %%I IN (`REG QUERY "HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Environment"`) DO (
  REM /I -> ignore casing, since PATH may also be called Path
  IF /I NOT [%%I]==[PATH] (
    ECHO SET %%I=%%K>>%TEMP%\__refreshEnvironment.bat
  )
)

REM Read the user environment variables from the registry.
FOR /F "usebackq tokens=1,2,* skip=2" %%I IN (`REG QUERY HKCU\Environment`) DO (
  REM /I -> ignore casing, since PATH may also be called Path
  IF /I NOT [%%I]==[PATH] (
    ECHO SET %%I=%%K>>%TEMP%\__refreshEnvironment.bat
  )
)

REM PATH is a special variable: it is automatically merged based on the values in the
REM system and user variables.
REM Read the PATH variable from the system and user environment variables.
FOR /F "usebackq tokens=1,2,* skip=2" %%I IN (`REG QUERY "HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Environment" /v PATH`) DO (
  ECHO SET PATH=%%K>>%TEMP%\__refreshEnvironment.bat
)
FOR /F "usebackq tokens=1,2,* skip=2" %%I IN (`REG QUERY HKCU\Environment /v PATH`) DO (
  ECHO SET PATH=%%PATH%%;%%K>>%TEMP%\__refreshEnvironment.bat
)

REM Load the variable definitions from our temporary file.
CALL %TEMP%\__refreshEnvironment.bat

REM Clean up after ourselves.
DEL /Q %TEMP%\__refreshEnvironment.bat

ECHO Environment successfully refreshed. 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2021-10-01T16:11:12.023

我为 cmd 和 cygwin 制作了 Chocolatey refreshenv 的更好替代品，它解决了很多问题，例如：

*   如果变量有一些 cmd 元字符，Chocolatey **refreshenv**会非常**糟糕，请参阅此测试：**

    将此添加到 HKCU\Environment: 中的路径`test & echo baaaaaaaaaad`，然后运行巧克力`refreshenv`，您会看到它打印出来 `baaaaaaaaaad`的内容非常糟糕，并且新路径未添加到您的路径变量中。

    这个脚本解决了这个问题，你可以用任何元字符来测试它，甚至是像这样糟糕的东西：

    ```
    ; & % ' ( ) ~ + @ # $ { } [ ] , ` ! ^ | > < \ / " : ? * = . - _ & echo baaaad 
    ```

*   refreshenv 仅添加**系统**和**用户** 环境变量，但 CMD 也添加了**volatile**变量（HKCU\Volatile Environment）。此脚本将合并所有三个并 **删除所有重复项**。

*   refreshenv 重置您的 PATH。此脚本将新路径附加到调用此脚本的父脚本的旧路径。这比覆盖旧路径要好，否则它将删除父脚本新添加的任何路径。

*   此脚本解决了@Gene Mayevsky 在此处的评论中描述的此问题：refreshenv*修改了环境变量 TEMP 和 TMP，将它们替换为存储在 HKCU\Environment 中的值。在我的情况下，我运行脚本来更新 Jenkins 作业修改的环境变量，该变量在 SYSTEM 帐户下运行的从属设备上运行，因此 TEMP 和 TMP 被 %USERPROFILE%\AppData\Local\Temp 代替，而不是 C:\Windows\Temp。这会破坏构建，因为链接器无法打开系统配置文件的 Temp 文件夹。*

我为 cmd 制作了一个脚本，为 cygwin/bash 制作了另一个脚本，您可以在这里找到它们：[https ://github.com/badrelmers/RefrEnv](https://github.com/badrelmers/RefrEnv)

## 对于 cmd

此脚本使用 vbscript，因此它适用于所有 Windows 版本**xp+**

使用它将它保存为**refrenv.bat**并调用它`call refrenv.bat`

```
<!-- : Begin batch script
@echo off
REM PUSHD "%~dp0"

REM author: Badr Elmers 2021
REM description: refrenv = refresh environment. this is a better alternative to the chocolatey refreshenv for cmd
REM https://github.com/badrelmers/RefrEnv
REM https://stackoverflow.com/questions/171588/is-there-a-command-to-refresh-environment-variables-from-the-command-prompt-in-w

REM ___USAGE_____________________________________________________________
REM usage: 
REM        call refrenv.bat        full refresh. refresh all non critical variables*, and refresh the PATH

REM debug:
REM        to debug what this script do create this variable in your parent script like that
REM        set debugme=yes
REM        then the folder containing the files used to set the variables will be open. Then see
REM        _NewEnv.cmd this is the file which run inside your script to setup the new variables, you
REM        can also revise the intermediate files _NewEnv.cmd_temp_.cmd and _NewEnv.cmd_temp2_.cmd 
REM        (those two contains all the variables before removing the duplicates and the unwanted variables)

REM you can also put this script in windows\systems32 or another place in your %PATH% then call it from an interactive console by writing refrenv

REM *critical variables: are variables which belong to cmd/windows and should not be refreshed normally like:
REM - windows vars:
REM ALLUSERSPROFILE APPDATA CommonProgramFiles CommonProgramFiles(x86) CommonProgramW6432 COMPUTERNAME ComSpec HOMEDRIVE HOMEPATH LOCALAPPDATA LOGONSERVER NUMBER_OF_PROCESSORS OS PATHEXT PROCESSOR_ARCHITECTURE PROCESSOR_ARCHITEW6432 PROCESSOR_IDENTIFIER PROCESSOR_LEVEL PROCESSOR_REVISION ProgramData ProgramFiles ProgramFiles(x86) ProgramW6432 PUBLIC SystemDrive SystemRoot TEMP TMP USERDOMAIN USERDOMAIN_ROAMINGPROFILE USERNAME USERPROFILE windir SESSIONNAME

REM ___INFO_____________________________________________________________
REM :: this script reload environment variables inside cmd every time you want environment changes to propagate, so you do not need to restart cmd after setting a new variable with setx or when installing new apps which add new variables ...etc

REM This is a better alternative to the chocolatey refreshenv for cmd, which solves a lot of problems like:

REM The Chocolatey refreshenv is so bad if the variable have some cmd meta-characters, see this test:
    REM add this to the path in HKCU\Environment: test & echo baaaaaaaaaad, and run the chocolatey refreshenv you will see that it prints baaaaaaaaaad which is very bad, and the new path is not added to your path variable.
    REM This script solve this and you can test it with any meta-character, even something so bad like:
    REM ; & % ' ( ) ~ + @ # $ { } [ ] , ` ! ^ | > < \ / " : ? * = . - _ & echo baaaad

REM refreshenv adds only system and user environment variables, but CMD adds volatile variables too (HKCU\Volatile Environment). This script will merge all the three and remove any duplicates.

REM refreshenv reset your PATH. This script append the new path to the old path of the parent script which called this script. It is better than overwriting the old path, otherwise it will delete any newly added path by the parent script.

REM This script solve this problem described in a comment by @Gene Mayevsky: refreshenv modifies env variables TEMP and TMP replacing them with values stored in HKCU\Environment. In my case I run the script to update env variables modified by Jenkins job on a slave that's running under SYSTEM account, so TEMP and TMP get substituted by %USERPROFILE%\AppData\Local\Temp instead of C:\Windows\Temp. This breaks build because linker cannot open system profile's Temp folder.

REM ________
REM this script solve things like that too:
REM The confusing thing might be that there are a few places to start the cmd from. In my case I run cmd from windows explorer and the environment variables did not change while when starting cmd from the "run" (windows key + r) the environment variables were changed.

REM In my case I just had to kill the windows explorer process from the task manager and then restart it again from the task manager.
REM Once I did this I had access to the new environment variable from a cmd that was spawned from windows explorer.

REM my conclusion:
REM if I add a new variable with setx, i can access it in cmd only if i run cmd as admin, without admin right i have to restart explorer to see that new variable. but running this script inside my script (who sets the variable with setx) solve this problem and i do not have to restart explorer

REM ________
REM windows recreate the path using three places at less:
REM the User namespace:    HKCU\Environment
REM the System namespace:  HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Environment
REM the Session namespace: HKCU\Volatile Environment
REM but the original chocolatey script did not add the volatile path. This script will merge all the three and remove any duplicates. this is what windows do by default too

REM there is this too which cmd seems to read when first running, but it contains only TEMP and TMP,so i will not use it
REM HKEY_USERS\.DEFAULT\Environment

REM ___TESTING_____________________________________________________________
REM to test this script with extreme cases do
    REM :: Set a bad variable
    REM add a var in reg HKCU\Environment as the following, and see that echo is not executed.  if you use refreshenv of chocolatey you will see that echo is executed which is so bad!
    REM so save this in reg:
    REM all 32 characters: & % ' ( ) ~ + @ # $ { } [ ] ; , ` ! ^ | > < \ / " : ? * = . - _ & echo baaaad
    REM and this:
    REM (^.*)(Form Product=")([^"]*") FormType="[^"]*" FormID="([0-9][0-9]*)".*$
    REM and use set to print those variables and see if they are saved without change ; refreshenv fail dramatically with those variables

REM invalid characters (illegal characters in file names) in Windows using NTFS
REM \ / : * ? "  < > |  and ^ in FAT 

REM __________________________________________________________________________________________
REM __________________________________________________________________________________________
REM __________________________________________________________________________________________
REM this is a hybrid script which call vbs from cmd directly
REM :: The only restriction is the batch code cannot contain - - > (without space between - - > of course)
REM :: The only restriction is the VBS code cannot contain </script>.
REM :: The only risk is the undocumented use of "%~f0?.wsf" as the script to load. Somehow the parser properly finds and loads the running .BAT script "%~f0", and the ?.wsf suffix mysteriously instructs CSCRIPT to interpret the script as WSF. Hopefully MicroSoft will never disable that "feature".
REM :: https://stackoverflow.com/questions/9074476/is-it-possible-to-embed-and-execute-vbscript-within-a-batch-file-without-using-a

if "%debugme%"=="yes" (
    echo RefrEnv - Refresh the Environment for CMD - ^(Debug enabled^)
) else (
    echo RefrEnv - Refresh the Environment for CMD
)

set "TEMPDir=%TEMP%\refrenv"
IF NOT EXIST "%TEMPDir%" mkdir "%TEMPDir%"
set "outputfile=%TEMPDir%\_NewEnv.cmd"

REM detect if DelayedExpansion is enabled
REM It relies on the fact, that the last caret will be removed only in delayed mode.
REM https://www.dostips.com/forum/viewtopic.php?t=6496
set "DelayedExpansionState=IsDisabled"
IF "^!" == "^!^" (
    REM echo DelayedExpansion is enabled
    set "DelayedExpansionState=IsEnabled"
)

REM :: generate %outputfile% which contain all the new variables
REM cscript //nologo "%~f0?.wsf" %1
cscript //nologo "%~f0?.wsf" "%outputfile%" %DelayedExpansionState%

REM ::set the new variables generated with vbscript script above
REM for this to work always it is necessary to use DisableDelayedExpansion or escape ! and ^ when using EnableDelayedExpansion, but this script already solve this, so no worry about that now, thanks to God
REM test it with some bad var like:
REM all 32 characters: ; & % ' ( ) ~ + @ # $ { } [ ] , ` ! ^ | > < \ / " : ? * = . - _ & echo baaaad
REM For /f delims^=^ eol^= %%a in (%outputfile%) do %%a
REM for /f "delims== tokens=1,2" %%G in (%outputfile%) do set "%%G=%%H"
For /f delims^=^ eol^= %%a in (%outputfile%) do set %%a

REM for safely print a variable with bad charachters do:
REM SETLOCAL EnableDelayedExpansion
REM echo "!z9!"
REM or
REM set z9
REM but generally paths and environment variables should not have bad metacharacters, but it is not a rule!

if "%debugme%"=="yes" (
    explorer "%TEMPDir%"
) else (
    rmdir /Q /S "%TEMPDir%"
)

REM cleanup
set "TEMPDir="
set "outputfile="
set "DelayedExpansionState="
set "debugme="

REM pause
exit /b

REM #############################################################################
REM :: to run jscript you have to put <script language="JScript"> directly after ----- Begin wsf script --->
----- Begin wsf script --->
<job><script language="VBScript">
REM #############################################################################
REM ### put you code here #######################################################
REM #############################################################################

REM based on itsadok script from here
REM https://stackoverflow.com/questions/171588/is-there-a-command-to-refresh-environment-variables-from-the-command-prompt-in-w

REM and it is faster as stated by this comment
REM While I prefer the Chocolatey code-wise for being pure batch code, overall I decided to use this one, since it's faster. (~0.3 seconds instead of ~1 second -- which is nice, since I use it frequently in my Explorer "start cmd here" entry) – 

REM and it is safer based on my tests, the Chocolatey refreshenv is so bad if the variable have some cmd metacharacters

Const ForReading = 1 
Const ForWriting = 2
Const ForAppending = 8 

Set WshShell = WScript.CreateObject("WScript.Shell")
filename=WScript.Arguments.Item(0)
DelayedExpansionState=WScript.Arguments.Item(1)

TMPfilename=filename & "_temp_.cmd"
Set fso = CreateObject("Scripting.fileSystemObject")
Set tmpF = fso.CreateTextFile(TMPfilename, TRUE)

set oEnvS=WshShell.Environment("System")
for each sitem in oEnvS
    tmpF.WriteLine(sitem)
next
SystemPath = oEnvS("PATH")

set oEnvU=WshShell.Environment("User")
for each sitem in oEnvU
    tmpF.WriteLine(sitem)
next
UserPath = oEnvU("PATH")

set oEnvV=WshShell.Environment("Volatile")
for each sitem in oEnvV
    tmpF.WriteLine(sitem)
next
VolatilePath = oEnvV("PATH")

set oEnvP=WshShell.Environment("Process")
REM i will not save the process env but only its path, because it have strange variables like  =::=::\ and  =F:=.... which seems to be added by vbscript
REM for each sitem in oEnvP
    REM tmpF.WriteLine(sitem)
REM next
REM here we add the actual session path, so we do not reset the original path, because maybe the parent script added some folders to the path, If we need to reset the path then comment the following line
ProcessPath = oEnvP("PATH")

REM merge System, User, Volatile, and process PATHs
NewPath = SystemPath & ";" & UserPath & ";" & VolatilePath & ";" & ProcessPath

REM ________________________________________________________________
REM :: remove duplicates from path
REM :: expand variables so they become like windows do when he read reg and create path, then Remove duplicates without sorting 
    REM why i will clean the path from duplicates? because:
    REM the maximum string length in cmd is 8191 characters. But string length doesnt mean that you can save 8191 characters in a variable because also the assignment belongs to the string. you can save 8189 characters because the remaining 2 characters are needed for "a="

    REM based on my tests: 
    REM when i open cmd as user , windows does not remove any duplicates from the path, and merge system+user+volatil path
    REM when i open cmd as admin, windows do: system+user path (here windows do not remove duplicates which is stupid!) , then it adds volatil path after removing from it any duplicates 

REM ' https://www.rosettacode.org/wiki/Remove_duplicate_elements#VBScript
Function remove_duplicates(list)
    arr = Split(list,";")
    Set dict = CreateObject("Scripting.Dictionary")
    REM ' force dictionary compare to be case-insensitive , uncomment to force case-sensitive
    dict.CompareMode = 1

    For i = 0 To UBound(arr)
        If dict.Exists(arr(i)) = False Then
            dict.Add arr(i),""
        End If
    Next
    For Each key In dict.Keys
        tmp = tmp & key & ";"
    Next
    remove_duplicates = Left(tmp,Len(tmp)-1)
End Function

REM expand variables
NewPath = WshShell.ExpandEnvironmentStrings(NewPath)
REM remove duplicates
NewPath=remove_duplicates(NewPath)

REM remove_duplicates() will add a ; to the end so lets remove it if the last letter is ;
If Right(NewPath, 1) = ";" Then 
    NewPath = Left(NewPath, Len(NewPath) - 1) 
End If

tmpF.WriteLine("PATH=" & NewPath)
tmpF.Close

REM ________________________________________________________________
REM :: exclude setting variables which may be dangerous to change

    REM when i run a script from task scheduler using SYSTEM user the following variables are the differences between the scheduler env and a normal cmd script, so i will not override those variables
    REM APPDATA=D:\Users\LLED2\AppData\Roaming
    REM APPDATA=D:\Windows\system32\config\systemprofile\AppData\Roaming

    REM LOCALAPPDATA=D:\Users\LLED2\AppData\Local
    REM LOCALAPPDATA=D:\Windows\system32\config\systemprofile\AppData\Local

    REM TEMP=D:\Users\LLED2\AppData\Local\Temp
    REM TEMP=D:\Windows\TEMP

    REM TMP=D:\Users\LLED2\AppData\Local\Temp
    REM TMP=D:\Windows\TEMP

    REM USERDOMAIN=LLED2-PC
    REM USERDOMAIN=WORKGROUP

    REM USERNAME=LLED2
    REM USERNAME=LLED2-PC$

    REM USERPROFILE=D:\Users\LLED2
    REM USERPROFILE=D:\Windows\system32\config\systemprofile

    REM i know this thanks to this comment
    REM The solution is good but it modifies env variables TEMP and TMP replacing them with values stored in HKCU\Environment. In my case I run the script to update env variables modified by Jenkins job on a slave that's running under SYSTEM account, so TEMP and TMP get substituted by %USERPROFILE%\AppData\Local\Temp instead of C:\Windows\Temp. This breaks build because linker cannot open system profile's Temp folder. – Gene Mayevsky Sep 26 '19 at 20:51

REM Delete Lines of a Text File Beginning with a Specified String
REM those are the variables which should not be changed by this script 
arrBlackList = Array("ALLUSERSPROFILE=", "APPDATA=", "CommonProgramFiles=", "CommonProgramFiles(x86)=", "CommonProgramW6432=", "COMPUTERNAME=", "ComSpec=", "HOMEDRIVE=", "HOMEPATH=", "LOCALAPPDATA=", "LOGONSERVER=", "NUMBER_OF_PROCESSORS=", "OS=", "PATHEXT=", "PROCESSOR_ARCHITECTURE=", "PROCESSOR_ARCHITEW6432=", "PROCESSOR_IDENTIFIER=", "PROCESSOR_LEVEL=", "PROCESSOR_REVISION=", "ProgramData=", "ProgramFiles=", "ProgramFiles(x86)=", "ProgramW6432=", "PUBLIC=", "SystemDrive=", "SystemRoot=", "TEMP=", "TMP=", "USERDOMAIN=", "USERDOMAIN_ROAMINGPROFILE=", "USERNAME=", "USERPROFILE=", "windir=", "SESSIONNAME=")

Set objFS = CreateObject("Scripting.FileSystemObject")
Set objTS = objFS.OpenTextFile(TMPfilename, ForReading)
strContents = objTS.ReadAll
objTS.Close

TMPfilename2= filename & "_temp2_.cmd"
arrLines = Split(strContents, vbNewLine)
Set objTS = objFS.OpenTextFile(TMPfilename2, ForWriting, True)

REM this is the equivalent of findstr /V /I /L  or  grep -i -v  , i don t know a better way to do it, but it works fine
For Each strLine In arrLines
    bypassThisLine=False
    For Each BlackWord In arrBlackList
        If Left(UCase(LTrim(strLine)),Len(BlackWord)) = UCase(BlackWord) Then
            bypassThisLine=True
        End If
    Next
    If bypassThisLine=False Then
        objTS.WriteLine strLine
    End If
Next

REM ____________________________________________________________
REM :: expand variables because registry save some variables as unexpanded %....%
REM :: and escape ! and ^ for cmd EnableDelayedExpansion mode

set f=fso.OpenTextFile(TMPfilename2,ForReading)
REM Write file:  ForAppending = 8 ForReading = 1 ForWriting = 2 , True=create file if not exist
set fW=fso.OpenTextFile(filename,ForWriting,True)
Do Until f.AtEndOfStream
    LineContent = f.ReadLine
    REM expand variables
    LineContent = WshShell.ExpandEnvironmentStrings(LineContent)

    REM _____this part is so important_____
    REM if cmd delayedexpansion is enabled in the parent script which calls this script then bad thing happen to variables saved in the registry if they contain ! . if var have ! then ! and ^ are removed; if var do not have ! then ^ is not removed . to understand what happens read this :
    REM how cmd delayed expansion parse things
    REM https://stackoverflow.com/questions/4094699/how-does-the-windows-command-interpreter-cmd-exe-parse-scripts/7970912#7970912
    REM For each parsed token, first check if it contains any !. If not, then the token is not parsed - important for ^ characters. If the token does contain !, then scan each character from left to right:
    REM     - If it is a caret (^) the next character has no special meaning, the caret itself is removed
    REM     - If it is an exclamation mark, search for the next exclamation mark (carets are not observed anymore), expand to the value of the variable.
    REM         - Consecutive opening ! are collapsed into a single !
    REM         - Any remaining unpaired ! is removed
    REM ...
    REM Look at next string of characters, breaking before !, :, or <LF>, and call them VAR

    REM conclusion:
    REM when delayedexpansion is enabled and var have ! then i have to escape ^ and ! ,BUT IF VAR DO NOT HAVE ! THEN DO NOT ESCAPE ^  .this made me crazy to discover
    REM when delayedexpansion is disabled then i do not have to escape anything

    If DelayedExpansionState="IsEnabled" Then
        If InStr(LineContent, "!") > 0 Then
            LineContent=Replace(LineContent,"^","^^")
            LineContent=Replace(LineContent,"!","^!")
        End If
    End If
    REM __________

    fW.WriteLine(LineContent)
Loop

f.Close
fW.Close

REM #############################################################################
REM ### end of vbscript code ####################################################
REM #############################################################################
REM this must be at the end for the hybrid trick, do not remove it
</script></job> 
```

## 对于 cygwin/bash：

我无法在此处发布我已达到发布限制，因此请从[此处下载](https://github.com/badrelmers/RefrEnv/blob/main/refrenv.sh)

从 bash 调用它：`source refrenv.sh`

## 对于 Powershell：

从[这里下载](https://github.com/badrelmers/RefrEnv/blob/main/refrenv.ps1)

从 Powershell 调用它：`. .\refrenv.ps1`

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2019-06-12T12:24:34.113

感谢您发布这个非常有趣的问题，即使在 2019 年（确实，更新 shell cmd 并不容易，因为它是上面提到的单个实例），因为在 windows 中更新环境变量可以完成许多自动化任务而无需必须手动重新启动命令行。

例如，我们使用它来允许在我们定期重新安装的大量机器上部署和配置软件。而且我必须承认，在我们的软件部署期间必须重新启动命令行是非常不切实际的，并且需要我们找到不一定令人愉快的解决方法。让我们来解决我们的问题。我们进行如下。

1 - 我们有一个批处理脚本，它依次调用这样的 powershell 脚本

**[文件：task.cmd]**。

命令`> powershell.exe -executionpolicy unrestricted -File C:\path_here\refresh.ps1`

2 - 此后，refresh.ps1 脚本使用注册表项（GetValueNames() 等）更新环境变量。然后，在同一个 powershell 脚本中，我们只需要调用可用的新环境变量。例如，在典型情况下，如果我们之前使用 cmd 使用静默命令安装了 nodeJS，则在调用该函数后，我们可以直接调用 npm 在同一个会话中安装特定的包，如下所示。

**[文件：刷新.ps1]**

```
function Update-Environment {
    $locations = 'HKLM:\SYSTEM\CurrentControlSet\Control\Session  Manager\Environment',
                 'HKCU:\Environment'
    $locations | ForEach-Object {
        $k = Get-Item $_
        $k.GetValueNames() | ForEach-Object {
            $name  = $_
            $value = $k.GetValue($_)

            if ($userLocation -and $name -ieq 'PATH') {
                $env:Path += ";$value"
            } else {

                Set-Item -Path Env:\$name -Value $value
            }
        }
        $userLocation = $true
    }
}
Update-Environment
#Here we can use newly added environment variables like for example npm install.. 
npm install -g create-react-app serve 
```

一旦 powershell 脚本结束，cmd 脚本就会继续执行其他任务。现在，要记住的一件事是，在任务完成后，cmd 仍然无法访问新的环境变量，即使 powershell 脚本已经在自己的会话中更新了这些变量。这就是为什么我们在 powershell 脚本中执行所有需要的任务，当然它可以调用与 cmd 相同的命令。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2008-10-05T14:17:35.303

正如凯夫所说，没有直接的方法。在大多数情况下，生成另一个 CMD 框更简单。更烦人的是，正在运行的程序也不知道更改（尽管 IIRC 可能有一个广播消息要观看以通知此类更改）。

更糟糕的是：在旧版本的 Windows 中，您必须注销然后重新登录以考虑更改...

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2017-01-12T11:25:57.200

我使用这个 Powershell 脚本添加到**PATH**变量中。我相信，只要稍加调整，它也可以适用于你的情况。

```
#REQUIRES -Version 3.0

if (-not ("win32.nativemethods" -as [type])) {
    # import sendmessagetimeout from win32
    add-type -Namespace Win32 -Name NativeMethods -MemberDefinition @"
[DllImport("user32.dll", SetLastError = true, CharSet = CharSet.Auto)]
public static extern IntPtr SendMessageTimeout(
   IntPtr hWnd, uint Msg, UIntPtr wParam, string lParam,
   uint fuFlags, uint uTimeout, out UIntPtr lpdwResult);
"@
}

$HWND_BROADCAST = [intptr]0xffff;
$WM_SETTINGCHANGE = 0x1a;
$result = [uintptr]::zero

function global:ADD-PATH
{
    [Cmdletbinding()]
    param ( 
        [parameter(Mandatory=$True, ValueFromPipeline=$True, Position=0)] 
        [string] $Folder
    )

    # See if a folder variable has been supplied.
    if (!$Folder -or $Folder -eq "" -or $Folder -eq $null) { 
        throw 'No Folder Supplied. $ENV:PATH Unchanged'
    }

    # Get the current search path from the environment keys in the registry.
    $oldPath=$(Get-ItemProperty -Path 'Registry::HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\Environment' -Name PATH).Path

    # See if the new Folder is already in the path.
    if ($oldPath | Select-String -SimpleMatch $Folder){ 
        return 'Folder already within $ENV:PATH' 
    }

    # Set the New Path and add the ; in front
    $newPath=$oldPath+';'+$Folder
    Set-ItemProperty -Path 'Registry::HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\Environment' -Name PATH -Value $newPath -ErrorAction Stop

    # Show our results back to the world
    return 'This is the new PATH content: '+$newPath

    # notify all windows of environment block change
    [win32.nativemethods]::SendMessageTimeout($HWND_BROADCAST, $WM_SETTINGCHANGE, [uintptr]::Zero, "Environment", 2, 5000, [ref]$result)
}

function global:REMOVE-PATH {
    [Cmdletbinding()]
    param ( 
        [parameter(Mandatory=$True, ValueFromPipeline=$True, Position=0)]
        [String] $Folder
    )

    # See if a folder variable has been supplied.
    if (!$Folder -or $Folder -eq "" -or $Folder -eq $NULL) { 
        throw 'No Folder Supplied. $ENV:PATH Unchanged'
    }

    # add a leading ";" if missing
    if ($Folder[0] -ne ";") {
        $Folder = ";" + $Folder;
    }

    # Get the Current Search Path from the environment keys in the registry
    $newPath=$(Get-ItemProperty -Path 'Registry::HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\Environment' -Name PATH).Path

    # Find the value to remove, replace it with $NULL. If it's not found, nothing will change and you get a message.
    if ($newPath -match [regex]::Escape($Folder)) { 
        $newPath=$newPath -replace [regex]::Escape($Folder),$NULL 
    } else { 
        return "The folder you mentioned does not exist in the PATH environment" 
    }

    # Update the Environment Path
    Set-ItemProperty -Path 'Registry::HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager\Environment' -Name PATH -Value $newPath -ErrorAction Stop

    # Show what we just did
    return 'This is the new PATH content: '+$newPath

    # notify all windows of environment block change
    [win32.nativemethods]::SendMessageTimeout($HWND_BROADCAST, $WM_SETTINGCHANGE, [uintptr]::Zero, "Environment", 2, 5000, [ref]$result)
}

# Use ADD-PATH or REMOVE-PATH accordingly.

#Anything to Add?

#Anything to Remove?

REMOVE-PATH "%_installpath_bin%" 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2013-01-12T01:51:23.220

编辑：这仅在您正在执行的环境更改是由于运行批处理文件时才有效。

如果一个批处理文件以`SETLOCAL`then 开头，即使您忘记`ENDLOCAL`在批处理退出之前调用，或者如果它意外中止，它也会在退出时解开回您的原始环境。

几乎我编写的每个批处理文件都以`SETLOCAL`因为在大多数情况下我不希望环境更改的副作用保留。如果我确实希望某些环境变量更改传播到批处理文件之外，那么我的最后一个`ENDLOCAL`看起来像这样：

```
ENDLOCAL & (
  SET RESULT1=%RESULT1%
  SET RESULT2=%RESULT2%
) 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2015-04-27T08:45:40.303

为了解决这个问题，我使用 setx 和 set 更改了环境变量，然后重新启动了 explorer.exe 的所有实例。这样，随后启动的任何进程都将具有新的环境变量。

我的批处理脚本执行此操作：

```
setx /M ENVVAR "NEWVALUE"
set ENVVAR="NEWVALUE"

taskkill /f /IM explorer.exe
start explorer.exe >nul
exit 
```

这种方法的问题是当前打开的所有资源管理器窗口都将关闭，这可能是一个坏主意 - 但请参阅 Kev 的帖子以了解为什么这是必要的

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2021-12-28T07:59:03.557

我只想说明，那些使用 Anaconda 的人，当你使用 Chocolatey`Refreshenv`命令时；所有与 conda 相关的环境变量都将丢失。为了解决这个问题，最好的方法是重新启动 CMD。:(

# deployment - 是否可以部署已经构建的 Drupal 站点？

> ID：171590
> 
> 赞同：3
> 
> 时间：2008-10-05T06:50:56.577
> 
> 标签：deployment, drupal

我是 Drupal 新手。是否可以设置所有内容并在服务器上部署 Drupal？我的意思是诸如放入内容、设置模块等……然后你把它全部放到生产服务器上？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-05T06:59:04.813

当然。

*   复制所有文件
*   编辑数据库凭据（sites/default/settings.php）
*   通过 mysqldump 或 phpMyAdmin 导出数据库内容（假设您使用 MySQL）
*   在目标服务器导入数据库内容

我已经做过好几次了。

# c++ - C++策略设计模式，制作接口数组

> ID：171596
> 
> 赞同：4
> 
> 时间：2008-10-05T06:57:13.290
> 
> 标签：c++, design-patterns, strategy-pattern

在实现了策略模式之后，我想创建一个接口类型的数组，然后我可以向其中添加任何具体类型。

对于那些不知道策略模式的人： [http](http://en.wikipedia.org/wiki/Strategy_pattern) ://en.wikipedia.org/wiki/Strategy_pattern 在这个特定的例子中，我想做一个 StrategyInterface 数组，然后我可以用具体类型的 A、B 和 C 填充. 但是，因为这是一个抽象类，我无法完成它。有没有办法做到这一点，或者完全不可能，而不删除抽象方法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-05T07:03:31.653

使数组存储指向接口类型的指针：

```
typedef std::vector<Interface *> Array;
Array myArray;
myArray.push_back(new A()); 
```

此外，您可以使用 ptr_vector 为您管理内存：

```
typedef boost::ptr_vector<Interface> Array;
// the rest is the same 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-05T06:59:38.400

存储指针而不是对象.....如果要存储对象，请使用 boost::shared_ptr 。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-05T07:04:26.537

错误，例如... std::vector< boost::shared_ptr< AbstractStrategy >>

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-05T08:19:29.147

使用 boost any 怎么样？

这是它的外观示例

```
#include <list>
#include <boost/any.hpp>

using boost::any_cast;
typedef std::list<boost::any> many;

void append_int(many & values, int value)
{
   boost::any to_append = value;
   values.push_back(to_append);
}

void append_string(many & values, const std::string & value)
{
   values.push_back(value);
}

void append_char_ptr(many & values, const char * value)
{
   values.push_back(value);
}

void append_any(many & values, const boost::any & value)
{
   values.push_back(value);
}

void append_nothing(many & values)
{
   values.push_back(boost::any());
} 
```

看起来不错且优雅，而且您获得了经过良好测试的代码，并且可以将您的值视为对象而不是指针

注意：这些函数名称是信息性的，但您可以使用覆盖来获得单个接口。

# development-environment - 加快编程环境的速度

> ID：171600
> 
> 赞同：3
> 
> 时间：2008-10-05T07:00:10.677
> 
> 标签：development-environment

我不是一个全职的软件人。事实上，在过去的十年中，我 90% 的工作要么在硬件上，要么在编写低级（嵌入式）代码。

但另外 10% 涉及为开发工具编写 shell 脚本、更改内核以添加特殊功能以及为最终用户编写 GUI 应用程序。

问题是我发现自己在知识方面面临重大漏洞，通常是因为我已经多年没有完成“X”了，我要么忘记了，要么环境发生了变化。

每隔一段时间，TheDailyWTF.com 上就会出现这样的主题：“WTF：这家伙花了一整天的时间编写大量代码，而他本可以在库 baz 中调用 foobar()”。我自己去过那里，因为除了#include <stdio.h> 东西（例如）之外我不记得太多了，而且我的快速搜索不知何故错过了正确的库。

在您很少接触的编程环境中，您发现哪些方法可以有效地让自己快速学习和/或刷新自己？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-05T07:12:12.447

*   询问您知道在您感兴趣的环境中工作的开发人员。
*   大量搜索网络。
*   在相关的 IRC 频道中提出具体问题（Freenode 很棒）。
*   在 StackOverflow 和其他网站上提出具体问题。

在所讨论的编程环境的“日常流程中”确实没有任何替代品。对当前最先进的技术有良好的感觉是您只能从经验中获得的东西，因为我相信您可以在自己的专业领域进行验证。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-05T07:25:32.187

我尝试了解有关我感兴趣但目前不一定使用的语言的一般新闻。能够遵循一般更改对于您必须重新拾取它有很大帮助。

除此之外，我个人认为最容易获取最新的参考书，并编写一些基本的东西让我再次适应环境，即作为一名网络程序员，我会制作一个简单的 crud 应用程序，或者一个快速的网络服务/客户。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-05T12:50:37.180

对于框架/API（例如 JavaScript 框架或小部件库）：

1.  快速浏览整个 API 文档；瞥见那里的所有内容，而不是选择似乎适合您需求的第一种方法。
2.  如果可用，请查看框架的源代码以了解 API 的用途。看看幕后的东西会有所帮助。还有一些方法将在内部使用，展示它们的真实意图。
3.  不一定总是相信现有的代码（谷歌搜索，来自同事，来自书籍），因为不是每个人都会尽职尽责地找出使用 API 的最合适方法。有时甚至 API 文档中的示例也可能已过时。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-01-05T20:25:38.737

在 Java、.NET 和 Python 等更新的全功能环境中，几乎所有常见问题都有库解决方案。不要想“我怎样才能用纯 C 编程”，而是“哪个库为我解决了这个问题？” 这是一种态度转变。就资源而言，我提到的三个环境的库文档都很好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-29T13:24:23.107

只是一个。当我们在处理我们的代码时，我们知道我们需要非常努力地优化关键路径，但在非关键路径上我们通常不会花费太多精力来优化。
根据您的描述，您在嵌入式上工作 90%，在休息上工作 10%，让我们假设在 50% 的休息时间中，您花费了更多所需的时间。所以根据我的计算，你正在优化大约 5% 的工作流程......
当然，在你做一些新的事情之前，通常的 google/SO/forums 搜索很有用，但在我看来，投资不仅仅是浪费时间，除非你想浪费一些时间只是为了娱乐或普通教育...... :)，但这是另一个故事。
顺便说一句，我处于相同的位置，上次我需要一些 GUI 并使用了 MFC（因为我有时在 10 年前使用它:)）并且我完全理解我可能会在 C# 和朋友中获得更好的结果，但是学习曲线只是不能证明这一点，特别是知道我需要将 C 代码与 GUI 混合。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-05T07:13:50.853

我认为最好的解决方案是买一本关于你需要赶上的主题/环境的书。

向您认识的在该领域有经验的开发人员提问。

您还可以查看新闻组（Google Groups 使这变得容易）和论坛。您可以提出问题，但即使阅读 10 分钟针对特定主题/环境的最新热门问题，也会让您有点“了解”。

如果你能找到一个专注的博客，同样的事情也适用于博客。虽然这些非常罕见，但我个人并不希望通过博客让我“了解”特定环境。（我个人认为“这里有一些简洁的东西”或“这是我失败的原因，你可以避免它”或“一般实践”领域中最受欢迎和最有趣的博客。）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-05T07:54:35.513

除了上面的答案，我认为你所要求的将花费你大量的时间，你必须愿意花时间来实现你的目标。我的方法与欧文的答案几乎相同；获取参考书或教程，并在您尝试任何给定事物的工作原理时通过更改示例进行修改。我会说作为最低限度，每隔一天分配一个小时来做​​这件事，在你知道你不会被打断的时间里。再少一点，你可能会继续挣扎。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-05T12:25:04.593

速成学习的最佳方法很简单，只需执行此操作，使用 google 搜索 X 教程，打开您喜欢的浏览器并开始输入即可。一旦你对 X 的感觉达到一定程度，看看其他人的东西，那里有很多开源的，肯定有人以前用过 X，看看他们如何解决某些问题并从中学习，这个是一种简单的方法来验证您是否“走在正确的轨道上”，或者您正在按照其他人定义为“常识”的模式做事或思考。

由于您已经有一个暂停的学习曲线，因此刷新某些东西要容易得多，我这样做的方式是保留您在编写时所做的一些示例或保留您所做的一些项目。然后您可以轻松地刷新并使用您自己的示例。

你在这里提到的图书馆问题，只有提高你的搜索技能才能提高那个（尽管看看其他人如何解决这个问题也会有所帮助）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-21T23:56:52.213

不要试图拿起每一个环境。

专注于有用和/或有趣的内容，然后选择一些高质量的博客定期阅读或收听播客。您将很快掌握环境的当前状态。

*具体例子：我已经离开Java世界很长时间了，但最近几个月我一直在做一个Java项目。从那以后，我收听了 Java Posse 播客并阅读了一些博客，虽然我离 Java 大师还很远，但我已经恢复了速度，没有太多麻烦。*

# c# - WPF 和 WinForms WebBrowser 控件之间存在哪些功能差异？

> ID：171601
> 
> 赞同：13
> 
> 时间：2008-10-05T07:00:18.573
> 
> 标签：c#, .net, wpf, winforms, webbrowser-control

WPF WebBrowser 控件看起来很棒，但是随着时间的推移积累的关于 WinForms WebBrowser 的知识非常丰富，并且很难忽视像 csExWB 这样的工作。很高兴知道 .NET 3.5 的 WPF WebBrowser 控件相对于 WinForms WebBrowser 控件存在哪些功能缺点或优点。特别是，是否可以在 WPF WebBrowser 之上构建类似 csExWB 的功能？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-07-20T07:19:25.820

从对 wpf 组件的一整天的沮丧中，这就是我发现的。显然，winforms webbrowser 公开了更多的方法和属性。例如，wpf webbrowser 中没有`IsWebBrowserContextMenuEnabled`,`ActiveXInstance`等。

此外，`document`每个属性都包含不同类型的对象。Winform 包含一个文档类型`System.Windows.Forms.HtmlDocument`，其中包含一些有趣的方法和属性，例如`PointToClient`和`GetElementFromPoint`。Wpf webbrowser 文档是一种`Object`可以转换为 的类型文档`mshtml.HtmlDocument`，它仅提供与标准 html + javascript 文档相同的方法和属性。不是很令人兴奋。我不知道它是否可以转换为其他东西（很有用），因为没有关于它的真实文档。

关于winforms webbrowser，我注意到的唯一缺点是组件内的按钮和滚动条与wpf本机控件的外观不同。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-05T09:38:10.530

我必须承认我不知道这些差异，但如果你遇到问题，你也许可以使用[WindowsFormsHost](http://msdn.microsoft.com/en-us/library/system.windows.forms.integration.windowsformshost.aspx)在 WPF 中托管 winform 版本，[像这样](http://nayyeri.net/blog/host-windows-forms-controls-in-wpf/v)吗？最终，两者都是 shdocvw 的包装，因此“纯 WPF”之类的原则并不真正适用。

# wcf - 多层环境中的 LINQ 基准测试

> ID：171624
> 
> 赞同：0
> 
> 时间：2008-10-05T07:21:32.647
> 
> 标签：wcf, linq-to-sql, benchmarking

我参与了一个分层应用程序的开发，该应用程序使用与 Web 服务器分离的 LINQ2SQL，并在 WCF 上使用 NET.TCP 绑定。

我的问题是：

1.  我应该采取什么样的措施来达到最佳性能？
2.  由于 LINQ 返回的实体对象每次都需要转换为 IEnumerable 列表以进行序列化，是否有办法消除这种依赖关系？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-10T23:28:21.013

1) 专注于适当规范化的数据库设计。我想说，当您被迫在代码与数据库设计中进行设计权衡时，如果性能是您的目标，请在对象设计而不是数据库设计中进行权衡。了解您将无法进行适当的超类型/子类型数据库设计，该设计将与 Linq to SQL 一起使用（我被告知您需要改用 EF）。

2）取决于你在这里的意思。如果你问如何通过网络序列化匿名类，简单的答案是：“你不能，所以不要尝试”。如果您想通过网络放置对象列表，只需使用 IEnumerable 集合上的 ToArray() 扩展方法通过网络传送业务对象数组。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-10T09:53:11.410

除非您编译查询，否则 Linq to SQL 非常慢。否则，您的应用程序将受 CPU 限制，因为大部分时间将花费在将表达式树转换为 SQL 上。

如果您使用编译查询，我们谈论的是 10 倍的性能提升。尝试一下 ：）

# c# - 将 Gtk# NodeView 绑定到 IList？

> ID：171625
> 
> 赞同：3
> 
> 时间：2008-10-05T07:23:32.817
> 
> 标签：c#, .net, mono, gtk#, ilist

我有一个数据对象，其中包含一个 System.Collections.Generic.IList 组件，我想将该列表的更改反映到 Gtk# NodeView 中，以便在将项目添加到列表时，NodeView 将添加一个新项目。

我将如何监听 IList 的更改？我考虑过用一个实现 IList 的类来包装 IList，委托必要的方法，并在更改其内容时广播一个事件，但这对于可能已经被其他人解决的事情来说似乎需要做很多工作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-05T08:00:55.640

System.Componen.BindingList 或 System.Collections.ObjectModel.ObservableCollection 是否存在于单声道中？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-30T22:52:22.303

[Gtk.DataBindings](http://gtk-databind.sourceforge.net/)是您正在寻找的。

# javascript - Greasemonkey：爱它还是恨它？

> ID：171630
> 
> 赞同：2
> 
> 时间：2008-10-05T07:29:58.560
> 
> 标签：javascript, greasemonkey

作为用户，我们喜欢 Greasemonkey 的强大功能。作为开发人员，它会使事情复杂化。

有些[人](http://dean.edwards.name/weblog/2005/03/ungreased/)主张防御性地禁用用户脚本；其他人愿意为保卫他们而死。

有中间立场吗？我们如何才能减少用户和无良广告商之间进化性军备竞赛的威胁？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-05T07:45:38.183

您认为您对站点访问者使用哪些用户代理的任何控制都是虚幻的。然而，绝大多数人将使用普通的 IE/Firefox/Safari。但是，如果您的网站的观众已经大量采用了 Greasemonkey 脚本，那么请将其视为您的用户对该网站需要更改的强烈投票！

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-05T08:05:57.923

如果您的用户正在使用 Greasemonkey 脚本*并且回来了*，那么就将其视为幸运：他们需要的东西您没有给他们，而且他们还没有离开。

如果他们没有 Greasemonkey，他们就会消失。你能做些什么来留住它们？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-05T10:51:09.167

如果有人使用浏览器插件或任何形式的修改，您不应该尝试阻止或禁用它们 - 这可能会导致更多问题。

另一方面，您也不应该支持它们。如果它工作，让它工作，如果它坏了，让它坏。

很多人使用不可靠的浏览器插件，有时是无意的，有时是没有任何选择的（企业 IT 对它们进行了一些不可靠的 IE 修改）。试着和每个人都玩得很好。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-05T11:59:45.067

我同意 MarkR（顺便说一句，+1）。

### 该应用程序在客户端...

因此，无论网页设计师会试图做什么来阻止某些功能，他们要么会激怒用户，要么让他们破解另一个解决方案，或者转移到更友好的网站。

（我讨厌某个崩溃的站点需要我打开我的 Firefox 调试器以使我能够完成我的正确操作，因为一些脑残的开发人员忘记声明他的 i 循环变量，因此，使它成为一个全局变量......我又做了一次不到两天前）

由于在线应用程序永远不应该依赖客户端控制和保护（即在客户端测试日期值是一个很酷的奖励，但无论如何都要在服务器上测试它）。

可能发生的最糟糕的事情是应用程序由于某些错误的脚本而在 GM 用户上中断。但从服务器的角度来看，它应该保持原始状态。

### ...因此，客户应承担责任...

这意味着无论用户添加到浏览器中的什么黑客，用户都是他自己的。在最好的情况下，他/她可以发现一些隐藏的错误并报告它。最糟糕的是，该网站将无法正常工作

### ...现在，这是否也意味着客户端/服务器合作？

大多数使用 GM 或其他任何东西来增强网站的人都表明该网站不完全适合人们的口味。就像 Rich 所写的那样，好处是它们仍在您的网站上，而不是其他地方。

要么“增强”是为了他/她自己非常个人的口味，而且，嘿，如果他/她想看到你的黑白网页和黄底蓝有什么问题？或者也许“增强”为您的网站增加了很多价值。在这种情况下，我猜你想要的要么是为每个人提供相同的功能（感谢 GM 的作者的想法可能是个好主意），要么可能支持它作为可选功能（“单击此处查看高级经验”）或... GreaseMonkey 脚本？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-05T14:03:53.070

我不明白为什么开发人员应该讨厌它？

广告商？现在，我怀疑人们编写 GM 脚本来摆脱广告，他们使用 AdBlock [Plus] 代替......

一般来说，我会写GM脚本来改善我经常去的网站所缺少的东西，所以如果你试图采取措施禁用GM，我会非常沮丧，可能会抵制该网站。

此外，我猜想能够安装 GM 的人数（即使是那些使用预制脚本的人）相对于访问者总数来说是相当少的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-05T10:09:03.153

我们已经接受了我们平台的现实：一旦您的网站在浏览者的（计算机）内存中，他们就可以用它做任何他们想做的事，而无需您的许可。试图向观众规定自己的观看条件的热门网站通常会立即遭到愤怒的强烈反对——与其试图按照自己的方式去做，不如让用户做他们想做的事，接受它，你最终会提供更好的服务，您的用户会欣赏和奖励的。

# windows - 更改最小/最大/关闭按钮主题

> ID：171631
> 
> 赞同：3
> 
> 时间：2008-10-05T07:32:32.343
> 
> 标签：windows, mfc

我目前正在覆盖`WM_NCPAINT`,`WM_NCCALCSIZE`并`WM_NCACTIVATE`为我正在处理的应用程序绘制我自己的颜色/主题标题栏。现在这很好用，但是最小、最大和关闭按钮仍然是 xp 默认主题。

我研究了控制它们和鼠标消息的作用。然而，他们也控制调整大小和我不想失去的其他功能。

有没有简单的方法来改变这些按钮的主题？

*   视窗
*   MFC 表单
*   视觉工作室 2005

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-05T08:21:01.497

我认为您最好的选择是禁用按钮并使用类似于[我在此答案中发布的代码](https://stackoverflow.com/questions/106912/how-to-draw-custom-button-in-window-titlebar-with-windows-forms#107437)重新绘制它们。它在带有 WinForms 的 C# 中，但绝大多数都重载了 WndProc()，您应该几乎可以将其复制/粘贴到 MFC 中。

实现点击处理程序来做你想让他们做的事情是微不足道的。

注意：该问题的提问者说代码在 Vista 中不起作用。我没有 Vista 盒子，但它适用于我的 XP。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-05T10:14:16.947

这也有帮助： http: [//www.catch22.net/tuts/titlebar](http://www.catch22.net/tuts/titlebar)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-07T13:34:14.580

您还可以查看它是如何在 MFC Next (VS2008 SP1) 中完成的。那里的主题支持对整个标题栏进行自定义绘制，您可以从中获得一些想法。我想他们也在 Vista 上对其进行了测试；）

# iphone - 访问用于临时分发的 iPhone 上的崩溃日志

> ID：171633
> 
> 赞同：16
> 
> 时间：2008-10-05T07:34:50.797
> 
> 标签：iphone, logging

当使用自己的 iPhone 进行开发时，很容易通过 XCode->Organizer->Crash Logs 访问任何崩溃日志。

如果他们没有为 XCode 中的开发设置它，如何访问另一个人手机上的崩溃日志，如果您通过临时分发将您的应用程序分发给他们进行 beta 测试，可能会出现这种情况？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-05T14:06:17.400

两种方式：

*   iTunes 在定期同步期间同步所有崩溃报告。它们可以在 Mac 上的 Library/Logs/CrashReporter/MobileDevice 中找到，在 Windows 上可能在 %APPDATA% 的某个位置。

*   ~~您可以在任何 Mac 上使用[适用于 Mac OS X 的 iPhone 配置实用程序](http://www.apple.com/downloads/macosx/apple/application_updates/iphoneconfigurationutility101formacosx.html)来访问手机的控制台和崩溃日志。注意：*适用于 Windows 和 Mac 的 iPhone Web 配置实用程序（请注意名称中的“web”）**不允许**此类访问，仅提供配置实用程序的部分功能*。~~呃，不，你不能。Xcode 在 Organizer（来自 Window 菜单）中提供了这个功能，但 iPCU 没有。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2010-12-21T23:20:34.230

来自 Apple 的[技术说明 TN2151](https://developer.apple.com/library/ios/#technotes/tn2008/tn2151.html)：

For applications that have been distributed using Ad Hoc or Enterprise methods, getting crash reports requires user cooperation. Specifically, the user will need to retrieve the crash report from the directory where it was copied by iTunes. Depending on the platform, the directory is:

Mac OS X: `~/Library/Logs/CrashReporter/MobileDevice/<DEVICE_NAME>`

Windows XP: `C:\Documents and Settings\<USERNAME>\Application Data\Apple Computer\Logs\CrashReporter\MobileDevice\<DEVICE_NAME>`

Windows Vista or 7: `C:\Users\<USERNAME>\AppData\Roaming\Apple Computer\Logs\CrashReporter\MobileDevice\<DEVICE_NAME>`

`<USERNAME>` is the user's login name for the computer. `<DEVICE_NAME>` is the name of the iPod touch or iPhone, for example, "John's iPhone".

You are only interested in .crash files. The crash report's file name begins with the application name and contains date/time information. In addition, `<DEVICE_NAME>` will appear at the end of the file name, before the extension.

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-05T16:22:33.773

[http://www.ispeeddial.com/how-to-find-the-crash-log-for-an-iphone-application/](http://www.ispeeddial.com/how-to-find-the-crash-log-for-an-iphone-application/)

这也会有所帮助；

[http://furbo.org/2008/08/08/symbolicatifination/](http://furbo.org/2008/08/08/symbolicatifination/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-05T16:32:56.293

与@millenomi 所说的相关——据我所知，崩溃日志是在您将 iPhone 连接到计算机时下载的，而不是在您通过 iTunes 同步手机时下载的。如果您的用户将 iTunes 配置为在连接时不同步，那么知道这可以为他们节省同步时间。同样，如果您的应用程序在连接到计算机时崩溃，仅通过 iTunes 同步不足以下载崩溃日志 - 我发现我需要断开手机与计算机的连接并重新连接。

我只在配置为开发设备的 iPhone 和 iPod touch 上对此进行了测试。不知道这是否有什么不同。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-07-11T20:53:12.463

On an iPhone 5, you do not need to connect the iPhone to iTunes to see the logs. Not sure about other iPhone versions but you can get to the logs by opening up Settings and then navigating to:

Settings -> General -> About -> Diagnostics & Usage -> Diagnostics & Usage Data

For the app you are looking for all crash logs should be in this area as:

-.ips

Not 100% sure if this works only for ad hoc apps or not. I think it works for any apps.

# c# - 使 MTA 中的锁定更容易

> ID：171640
> 
> 赞同：1
> 
> 时间：2008-10-05T07:44:18.653
> 
> 标签：c#, multithreading, locking

在多线程代码中，当一个实例可能被多个线程读取或写入时，它们需要被锁定以安全地执行这些操作。

为了避免重复创建要锁定的对象并通过代码编写一堆锁定语句，我创建了一个通用类来处理锁定。

从概念上讲，我错过了什么吗？这应该有效，对吧？

```
public class Locked<T> where T : new()
{
    private readonly object locker = new object();

    private T value;

    public Locked()
        : this(default(T))
    { }

    public Locked(T value)
    {
        this.value = value;
    }

    public T Get()
    {
        lock (this.locker)
        {
            return this.value;
        }
    }

    public void Set(T value)
    {
        lock (this.locker)
        {
            this.value = value;
        }
    }    
} 
```

还有一个在类中使用它的例子：

```
private Locked<bool> stopWorkerThread = new Locked<bool>();

public void WorkerThreadEntryPoint()
{
    while (true)
    {
        if (this.stopWorkerThread.Get())
        {
            break;

} 
```

另外，我将如何以自动化的方式测试这样的东西（例如创建一个单元测试）？

最后，我可以做些什么来实现 ++ 和 -- 运算符，以避免这种情况：

```
 this.runningThreads.Set(this.runningThreads.Get() + 1); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-05T08:06:29.360

仅在获取/设置期间锁定；当然，在许多常见情况下，这将是原子的，这仅仅是由于数据大小。

然而，实际上大多数锁需要跨越的范围不止于此，就像集合锁定在 Add 等上并没有多大帮助一样——调用者通常需要一个锁来跨越“它在那里吗？如果是这样更新，否则添加”序列。

对于像 bool 这样简单的东西，“volatile”可能会更简单地解决问题 - 特别是如果它只是用于循环退出。

您可能还想考虑 [MethodImpl(MethodImplOptions.Synchronized)] - 尽管我个人更喜欢私有锁对象（就像您使用过的那样）来防止外部人员锁定对象的问题（上面使用“this”作为锁） .

对于这个单元测试，你需要先证明它被破坏了——这很难，因为操作是如此之小（并且对于大多数数据类型来说已经是原子的）。它避免的另一件事（易失性也修复了）是缓存在寄存器中，但这又是一种优化，很难强制证明它被破坏了。

如果您对锁包装器感兴趣，您可以考虑这样的现有[代码](http://www.yoda.arachsys.com/csharp/miscutil/usage/locking.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-05T08:11:05.853

您上面的代码有很多潜在的和真正的多线程问题，我不会在现实世界的情况下使用类似的东西。例如：

```
this.runningThreads.Set(this.runningThreads.Get() + 1); 
```

这里有一个非常明显的竞争条件。当`Get()`调用返回时，对象不再被锁定。要进行真正的 post 或 pre 递增，需要将计数器从 . 之前锁定`Get`到`Set`.

此外，如果您所做的只是同步读取，您并不总是需要完全锁定。

更好的锁定接口（我认为）需要您显式锁定需要执行此操作的实例。我的经验主要是 C++，所以我不能推荐一个完整的实现，但我喜欢的语法可能看起来像这样：

```
using (Locked<T> lock = Locked<T>(instance))
{
  // write value
  instance++;
}

// read value
print instance; 
```

# com - 空 BSTR 和 NULL BSTR 之间应该有区别吗？

> ID：171641
> 
> 赞同：9
> 
> 时间：2008-10-05T07:45:02.257
> 
> 标签：com, string, bstr

在维护`COM`接口时，是否应该以`BSTR`与`NULL`? 换句话说，这两个函数调用是否应该产生相同的结果？

```
 // Empty BSTR
 CComBSTR empty(L""); // Or SysAllocString(L"")
 someObj->Foo(empty);

 // NULL BSTR
 someObj->Foo(NULL); 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-05T07:50:55.710

是的 - NULL BSTR 与空 BSTR 相同。我记得当我们从 VS6 切换到 2003 时，我们发现了各种各样的错误 - CComBSTR 类对使用 NULL 而不是空字符串分配它的默认构造函数进行了更改。例如，当您将 BSTR 视为常规 C 样式字符串并将其传递给某个函数（如`strlen`）或尝试`std::string`用它初始化 a 时，就会发生这种情况。

[Eric Lippert 在Eric 的 BSTR 语义完整指南](https://docs.microsoft.com/en-us/archive/blogs/ericlippert/erics-complete-guide-to-bstr-semantics)中详细讨论了 BSTR ：

> 让我先列出差异，然后详细讨论每一点。
> 
> 1.  BSTR 对于 NULL 和 "" 必须具有相同的语义。PWSZ 通常具有不同的语义。
>     
>     
> 2.  必须使用 SysAlloc* 系列函数分配和释放 BSTR。PWSZ 可以是堆栈中的自动存储缓冲区，也可以使用 malloc、new、LocalAlloc 或任何其他内存分配器分配。
>     
>     
> 3.  BSTR 是固定长度的。PWSZ 可以是任意长度，仅受其缓冲区中有效内存量的限制。
>     
>     
> 4.  BSTR 始终指向缓冲区中的第一个有效字符。PWSZ 可以是指向字符串缓冲区中间或结尾的指针。
>     
>     
> 5.  分配 n 字节 BSTR 时，您有空间容纳 n/2 个宽字符。当您为 PWSZ 分配 n 个字节时，您可以存储 n / 2 - 1 个字符——您必须为空值留出空间。
>     
>     
> 6.  BSTR 可以包含任何 Unicode 数据，包括零字符。PWSZ 从不包含零字符，除非作为字符串结束标记。BSTR 和 PWSZ 在其最后一个有效字符之后总是有一个零字符，但在 BSTR 中，一个有效字符可能是一个零字符。
>     
>     
> 7.  BSTR 实际上可能包含奇数个字节——它可能用于移动二进制数据。PWSZ 几乎总是偶数字节，仅用于存储 Unicode 字符串。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-05T10:55:35.447

处理这种困境的最简单方法是使用 CComBSTR 并检查 .Length() 是否为零。这适用于空值和 NULL 值。

但是，请记住，必须释放空 BSTR，否则会出现内存泄漏。我最近在其他人的代码中看到了其中的一些。如果你不仔细看的话，很难找到。

# python - 将文本列表格式化为列

> ID：171662
> 
> 赞同：16
> 
> 时间：2008-10-05T08:09:52.237
> 
> 标签：python, string, formatting

我正在尝试将字符串值列表输出为 2 列格式。将字符串列表转换为“普通文本”的标准方法是使用**string.join**方法。但是，它只需要 2 个参数，所以我只能使用“\n”创建一个列。我认为尝试创建一个只需在列之间添加一个选项卡的循环就可以了，但逻辑无法正常工作。

我发现了一个[ActiveState 页面](http://code.activestate.com/recipes/302380/)，它的操作方式相当复杂，但它是 4 年前的。现在有没有简单的方法来做到这一点？

* * *

**编辑**这是我要使用的列表。

```
skills_defs = ["ACM:Aircraft Mechanic", "BC:Body Combat", "BIO:Biology",
    "CBE:Combat Engineer", "CHM:Chemistry", "CMP:Computers", 
    "CRM:Combat Rifeman", "CVE:Civil Engineer", "DIS:Disguise",
    "ELC:Electronics","EQ:Equestrian", "FO:Forward Observer",
    "FOR:Forage", "FRG:Forgery", "FRM:Farming", "FSH:Fishing",
    "GEO:Geology", "GS:Gunsmith", "HW:Heavy Weapons", "IF:Indirect Fire",
    "INS:Instruction", "INT:Interrogation", "JP:Jet Pilot", "LB:Longbow",
    "LAP:Light Aircraft Pilot", "LCG:Large Caliber Gun", "LNG:Language",
    "LP:Lockpick", "MC:Melee Combat", "MCY:Motorcycle", "MEC:Mechanic",
    "MED:Medical", "MET:Meterology", "MNE:Mining Engineer",
    "MTL:Metallurgy", "MTN:Mountaineering", "NWH:Nuclear Warhead",
    "PAR:Parachute", "PST:Pistol", "RCN:Recon", "RWP:Rotary Wing Pilot",
    "SBH:Small Boat Handling","SCD:Scuba Diving", "SCR:Scrounging",
    "SWM:Swimming", "TW:Thrown Weapon", "TVD:Tracked Vehicle Driver",
    "WVD:Wheeled Vehicle Driver"] 
```

我只想将此列表输出为简单的 2 列格式以减少空间。理想情况下，列之间应该有标准数量的空间，但我可以使用它。

```
ACM:Aircraft Mechanic        BC:Body Combat 
BIO:Biology         CBE:Combat Engineer 
CHM:Chemistry       CMP:Computers
CRM:Combat Rifeman      CVE:Civil Engineer 
DIS:Disguise            ELC:Electronics 
EQ:Equestrian           FO:Forward Observer
FOR:Forage          FRG:Forgery 
FRM:Farming             FSH:Fishing
GEO:Geology             GS:Gunsmith 
HW:Heavy Weapons        IF:Indirect Fire
INS:Instruction             INT:Interrogation 
JP:Jet Pilot            LB:Longbow
 LAP:Light Aircraft Pilot       LCG:Large Caliber Gun 
LNG:Language            LP:Lockpick 
MC:Melee Combat         MCY:Motorcycle 
MEC:Mechanic            MED:Medical 
MET:Meterology      MNE:Mining Engineer
MTL:Metallurgy      MTN:Mountaineering 
NWH:Nuclear Warhead     PAR:Parachute 
PST:Pistol          RCN:Recon 
RWP:Rotary Wing Pilot       SBH:Small Boat Handling 
SCD:Scuba Diving        SCR:Scrounging
SWM:Swimming        TW:Thrown Weapon 
TVD:Tracked Vehicle Driver  WVD:Wheeled Vehicle Driver 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-10-05T08:40:22.847

由制表符分隔的两列连接成行。在*itertools*中查找迭代器等价物，以实现节省空间的解决方案。

```
import string
def fmtpairs(mylist):
    pairs = zip(mylist[::2],mylist[1::2])
    return '\n'.join('\t'.join(i) for i in pairs)

print fmtpairs(list(string.ascii_uppercase))

A   B
C   D
E   F
G   H
I   J
... 
```

糟糕……被 S.Lott 抓住了（谢谢）。

一个更通用的解决方案，处理任意数量的列和奇数列表。从[S.lott](https://stackoverflow.com/questions/171662/formatting-a-list-of-text-into-columns#173823)略微修改，使用生成器来节省空间。

```
def fmtcols(mylist, cols):
    lines = ("\t".join(mylist[i:i+cols]) for i in xrange(0,len(mylist),cols))
    return '\n'.join(lines) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-10-04T06:34:10.787

这有效

```
it = iter(skills_defs)
for i in it:
    print('{:<60}{}'.format(i, next(it, ""))) 
```

请参阅： [字符串格式示例](http://docs.python.org/library/string.html#format-examples)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-06T10:33:04.913

太啰嗦了，所以我把它分成两部分。

```
def columns( skills_defs, cols=2 ):
    pairs = [ "\t".join(skills_defs[i:i+cols]) for i in range(0,len(skills_defs),cols) ]
    return "\n".join( pairs ) 
```

显然，它可以作为一个单独的 loooong 语句来完成。

这也适用于奇数个技能。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-07-22T00:12:19.323

这是 gimel 提供的解决方案的扩展，它允许打印等间距的列。

```
def fmtcols(mylist, cols):
    maxwidth = max(map(lambda x: len(x), mylist))
    justifyList = map(lambda x: x.ljust(maxwidth), mylist)
    lines = (' '.join(justifyList[i:i+cols]) 
             for i in xrange(0,len(justifyList),cols))
    print "\n".join(lines) 
```

它返回这样的东西

`ACM:Aircraft Mechanic BC:Body Combat`
`BIO:Biology CBE:Combat Engineer`
`CHM:Chemistry CMP:Computers`
`CRM:Combat Rifeman CVE:Civil Engineer`
`DIS:Disguise ELC:Electronics` ... ...`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-06T11:21:44.050

该`format_columns`功能应该做你想做的事：

```
from __future__ import generators
try: import itertools
except ImportError: mymap, myzip= map, zip
else: mymap, myzip= itertools.imap, itertools.izip

def format_columns(string_list, columns, separator=" "):
    "Produce equal-width columns from string_list"
    sublists= []

    # empty_str based on item 0 of string_list
    try:
        empty_str= type(string_list[0])()
    except IndexError: # string_list is empty
        return

    # create a sublist for every column
    for column in xrange(columns):
            sublists.append(string_list[column::columns])

    # find maximum length of a column
    max_sublist_len= max(mymap(len, sublists))

    # make all columns same length
    for sublist in sublists:
         if len(sublist) < max_sublist_len:
             sublist.append(empty_str)

    # calculate a format string for the output lines
    format_str= separator.join(
        "%%-%ds" % max(mymap(len, sublist))
         for sublist in sublists)

    for line_items in myzip(*sublists):
        yield format_str % line_items

if __name__ == "__main__":
    skills_defs = ["ACM:Aircraft Mechanic", "BC:Body Combat", "BIO:Biology",
        "CBE:Combat Engineer", "CHM:Chemistry", "CMP:Computers",
        "CRM:Combat Rifeman", "CVE:Civil Engineer", "DIS:Disguise",
        "ELC:Electronics","EQ:Equestrian", "FO:Forward Observer",
        "FOR:Forage", "FRG:Forgery", "FRM:Farming", "FSH:Fishing",
        "GEO:Geology", "GS:Gunsmith", "HW:Heavy Weapons", "IF:Indirect Fire",
        "INS:Instruction", "INT:Interrogation", "JP:Jet Pilot", "LB:Longbow",
        "LAP:Light Aircraft Pilot", "LCG:Large Caliber Gun", "LNG:Language",
        "LP:Lockpick", "MC:Melee Combat", "MCY:Motorcycle", "MEC:Mechanic",
        "MED:Medical", "MET:Meterology", "MNE:Mining Engineer",
        "MTL:Metallurgy", "MTN:Mountaineering", "NWH:Nuclear Warhead",
        "PAR:Parachute", "PST:Pistol", "RCN:Recon", "RWP:Rotary Wing Pilot",
        "SBH:Small Boat Handling","SCD:Scuba Diving", "SCR:Scrounging",
        "SWM:Swimming", "TW:Thrown Weapon", "TVD:Tracked Vehicle Driver",
        "WVD:Wheeled Vehicle Driver"]

    for line in format_columns(skills_defs, 2):
        print line 
```

这假设您有一个带有可用生成器的 Python。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-11-19T21:30:54.017

我认为这些解决方案中的许多都将两个不同的东西合二为一。

你想要：

1.  能够强制字符串具有一定的宽度
2.  打印表格

这是一个非常简单的方法：

```
import sys

skills_defs = ["ACM:Aircraft Mechanic", "BC:Body Combat", "BIO:Biology",
"CBE:Combat Engineer", "CHM:Chemistry", "CMP:Computers",
"CRM:Combat Rifeman", "CVE:Civil Engineer", "DIS:Disguise",
"ELC:Electronics","EQ:Equestrian", "FO:Forward Observer",
"FOR:Forage", "FRG:Forgery", "FRM:Farming", "FSH:Fishing",
"GEO:Geology", "GS:Gunsmith", "HW:Heavy Weapons", "IF:Indirect Fire",
"INS:Instruction", "INT:Interrogation", "JP:Jet Pilot", "LB:Longbow",
"LAP:Light Aircraft Pilot", "LCG:Large Caliber Gun", "LNG:Language",
"LP:Lockpick", "MC:Melee Combat", "MCY:Motorcycle", "MEC:Mechanic",
"MED:Medical", "MET:Meterology", "MNE:Mining Engineer",
"MTL:Metallurgy", "MTN:Mountaineering", "NWH:Nuclear Warhead",
"PAR:Parachute", "PST:Pistol", "RCN:Recon", "RWP:Rotary Wing Pilot",
"SBH:Small Boat Handling","SCD:Scuba Diving", "SCR:Scrounging",
"SWM:Swimming", "TW:Thrown Weapon", "TVD:Tracked Vehicle Driver",
"WVD:Wheeled Vehicle Driver"]

# The only thing "colform" does is return a modified version of "txt" that is
# ensured to be exactly "width" characters long. It truncates or adds spaces
# on the end as needed.
def colform(txt, width):
    if len(txt) > width:
        txt = txt[:width]
    elif len(txt) < width:
        txt = txt + (" " * (width - len(txt)))
    return txt

# Now that you have colform you can use it to print out columns any way you wish.
# Here's one brain-dead way to print in two columns:
for i in xrange(len(skills_defs)):
    sys.stdout.write(colform(skills_defs[i], 30))
    if i % 2 == 1:
        sys.stdout.write('\n') 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-05T08:22:22.493

```
data = [ ("1","2"),("3","4") ]
print "\n".join(map("\t".join,data)) 
```

不如 ActiveState 解决方案灵活，但更短:-)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-06-21T06:27:04.667

这也可能对您有所帮助。

```
for i in skills_defs:
if skills_defs.index(i)%2 ==0:
    print(i.ljust(30),end = " ")
else:
    print(i.ljust(30)) 
```

# c# - 如何使用 C# 泛型将这 3 种方法合二为一？

> ID：171664
> 
> 赞同：6
> 
> 时间：2008-10-05T08:10:08.867
> 
> 标签：c#, generics

我没有太多使用泛型，因此无法弄清楚是否可以使用泛型将以下三种方法合二为一以减少重复。实际上我的代码目前有六种方法，但如果你能解决这三种方法，那么其余的应该都可以使用相同的解决方案。

```
 private object EvaluateUInt64(UInt64 x, UInt64 y)
    {
        switch (Operation)
        {
            case BinaryOp.Add:
                return x + y;
            case BinaryOp.Subtract:
                return x - y;
            case BinaryOp.Multiply:
                return x * y;
            case BinaryOp.Divide:
                return x / y;
            case BinaryOp.Remainder:
                return x % y;
            default:
                throw new ApplicationException("error");
        }
    }

    private object EvaluateFloat(float x, float y)
    {
        switch(Operation)
        {
            case BinaryOp.Add:
                return x + y;
            case BinaryOp.Subtract:
                return x - y;
            case BinaryOp.Multiply:
                return x * y;
            case BinaryOp.Divide:
                return x / y;
            case BinaryOp.Remainder:
                return x % y;
            default:
                throw new ApplicationException("error");
        }
    }

    private object EvaluateDouble(double x, double y)
    {
        switch (Operation)
        {
            case BinaryOp.Add:
                return x + y;
            case BinaryOp.Subtract:
                return x - y;
            case BinaryOp.Multiply:
                return x * y;
            case BinaryOp.Divide:
                return x / y;
            case BinaryOp.Remainder:
                return x % y;
            default:
                throw new ApplicationException("error");
        }
    } 
```

我正在构建一个简单的表达式解析器，然后需要评估简单的二进制运算，例如加法/减法等。我使用上述方法来获取使用相关类型执行的实际数学运算。但必须有更好的答案！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-05T08:14:59.827

泛型本身不支持算术。但是，可以使用 .NET 3.5 来完成，[就像这样](http://www.pobox.com/~skeet/csharp/miscutil/usage/genericoperators.html)。Operator 类是[MiscUtil](http://www.yoda.arachsys.com/csharp/miscutil/)的一部分。然后变成：

```
 public T Evaluate<T>(T x, T y) {
      switch (Operation)
      {
        case BinaryOp.Add:
            return Operator.Add(x, y);
        case BinaryOp.Subtract:
            return Operator.Subtract(x, y);
     ... etc 
```

由于您正在编写表达式解析器，因此直接使用 Expression 可能是一个好主意，但欢迎您使用上述内容。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-05T08:16:25.923

Marc Gravell 在使通用数学可行方面做了大量工作。请参阅有关该问题的[MiscUtil](http://www.yoda.arachsys.com/csharp/miscutil/usage/genericoperators.html) 和[一般文章](http://www.yoda.arachsys.com/csharp/genericoperators.html)。

当前版本的 MiscUtil 中的代码需要 .NET 3.5，因为它使用了表达式树。但是，我相信 Marc 也有一个适用于 .NET 2.0 的版本。如果这对人们有用，我相信我们可以以某种方式合并它（可能在 MiscUtil 本身中使用一个外观，它将在运行时使用基于框架版本的适当实现）。

对于未来，我希望看到[静态接口](http://msmvps.com/blogs/jon_skeet/archive/2008/08/29/lessons-learned-from-protocol-buffers-part-4-static-interfaces.aspx)可以提供一种使用通用数学类型的替代方法。

# visual-studio-2008 - 如何在 Visual Studio 2008 中创建 Windows Media Player 插件

> ID：171673
> 
> 赞同：2
> 
> 时间：2008-10-05T08:16:22.130
> 
> 标签：visual-studio-2008, windows-media-player

我一直在尝试在 Visual Studio 2008 中创建一个 Windows Media Player 插件，并且很难找到正确的模板。MSDN[在此处](http://msdn.microsoft.com/en-us/library/bb262076(VS.85).aspx)提供了建议，但似乎与 VS2008 无关。

谁能建议如何在 Visual Studio 中启动 WMP 插件？

编辑：我接受了这个答案，因为它对我有用，但恐怕它不是最优雅的解决方案。如果有人有更好的想法，请补充！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-05T08:38:58.280

下载 platfrom SDK，它有一堆示例。但是它们都不太可能针对VS2008进行更新，但这并不重要，转换项目很容易。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-27T14:05:00.913

请参阅 MSDN 论坛上的此帖子：

[http://forums.microsoft.com/msdn/ShowPost.aspx?PostID=2627171&SiteID=1](http://forums.microsoft.com/msdn/ShowPost.aspx?PostID=2627171&SiteID=1)

基本上按照这里的说明[http://msdn.microsoft.com/en-us/library/bb262326(VS.85).aspx](http://msdn.microsoft.com/en-us/library/bb262326(VS.85).aspx)使用 VS2005 向导。

然后编辑 wmpwiz.vsz 使第一行读取 Wizard=VsWizard.VsWizardEngine.9.0

# linux - 在 linux 中链接特定的共享库版本

> ID：171676
> 
> 赞同：4
> 
> 时间：2008-10-05T08:16:53.720
> 
> 标签：linux, build-process, linker

我的构建过程包括 Qt 的 qmake Makefile 生成器和与 linux 捆绑的典型 make 实用程序。
我的应用程序由几个共享库组成，主应用程序与它们相关联。
如何在我的库上应用典型的 linux 版本控制方案？（使用版本 2 -> 对指向 foo.so.2.yz 的 foo.so.2 的链接使用 ldconfig 生成的链接）。

答案不必特定于我的构建过程。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-05T08:20:43.793

您的库应该命名为`libfoo.so.2.y.z`，并带有符号链接`libfoo.so.2`和`libfoo.so`都指向它。该库应`-soname libfoo.so.2`在链接器命令行（或`-Wl,-soname,libfoo.so.2`gcc 命令行）中创建。

希望有帮助！

# python - 将通用字体方案应用于 wxPython 中的多个对象

> ID：171694
> 
> 赞同：3
> 
> 时间：2008-10-05T08:27:57.193
> 
> 标签：python, fonts, wxpython

很多时候，我会在 wxPython 应用程序中对静态文本使用相同的字体方案。目前我正在`SetFont()`调用每个静态文本对象，但这似乎是很多不必要的工作。但是，wxPython 演示和 wxPython In Action 书中没有讨论这个问题。

有没有一种方法可以轻松地将相同的`SetFont()`方法应用于所有这些文本对象，而无需每次都单独调用？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-08T19:55:40.720

您可以通过在添加任何小部件之前在父窗口（框架、对话框等）上调用 SetFont 来完成此操作。子小部件将继承字体。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-05T08:38:36.050

也许尝试子类化文本对象并在您的类`__init__`方法中调用 SetFont()？

或者，执行以下操作：

```
def f(C):
  x = C()
  x.SetFont(font) # where font is defined somewhere else
  return x 
```

然后用它装饰你创建的每个文本对象：

```
text = f(wx.StaticText) 
```

（当然，如果`StaticText`构造函数需要一些参数，则需要更改`f`函数定义中的第一行）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T14:01:16.880

如果所有小部件都已创建，您可以`SetFont`递归应用，例如使用以下函数：

```
def changeFontInChildren(win, font):
    '''
    Set font in given window and all its descendants.
    @type win: L{wx.Window}
    @type font: L{wx.Font}
    '''
    try:
        win.SetFont(font)
    except:
        pass # don't require all objects to support SetFont
    for child in win.GetChildren():
        changeFontInChildren(child, font) 
```

一个示例用法，它导致所有文本`frame`成为斜体样式的默认字体：

```
newFont = wx.SystemSettings_GetFont(wx.SYS_DEFAULT_GUI_FONT)
newFont.SetStyle(wx.FONTSTYLE_ITALIC)
changeFontInChildren(frame, newFont) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-02-01T19:55:16.437

@DzinX 上面给出的解决方案在我已经有孩子并且已经显示的面板中动态更改字体时对我有用。

我最终对其进行了如下修改，因为原件在极端情况下给我带来了麻烦（即，当使用`AuiManager`浮动框架时）。

```
def change_font_in_children(win, font):
    '''
    Set font in given window and all its descendants.
    @type win: L{wx.Window}
    @type font: L{wx.Font}
    '''
    for child in win.GetChildren():
        change_font_in_children(child, font)
    try:
        win.SetFont(font)
        win.Update()
    except:
        pass # don't require all objects to support SetFont 
```

# nhibernate - Windows 服务应用程序中的 NHibernate 会话管理

> ID：171699
> 
> 赞同：12
> 
> 时间：2008-10-05T08:33:02.580
> 
> 标签：nhibernate

我正在开发和作为 Windows 服务运行的应用程序。还有其他组件，包括一些 WCF 服务、客户端 GUI 等 - 但访问数据库的是 Windows 服务。

因此，该应用程序是一个长时间运行的服务器，我想提高它的性能和可扩展性，我希望改进数据访问等。我在另一个线程中发布了关于二级缓存的帖子。

这篇文章是关于访问数据库的长时间运行线程的会话管理。我应该使用线程静态上下文吗？如果是这样，是否有任何示例说明如何实施。

网络上所有使用 NHibernate 的人似乎都非常关注 Web 应用程序风格的架构。似乎非常缺乏非 Web 应用程序设计的文档/讨论。

目前，我长期运行的线程这样做：

1.  调用 3 或 4 个 DAO 方法
2.  验证返回的分离对象的状态。
3.  如果需要，更新状态。
4.  调用几个 DAO 方法来持久化更新的实例。（传入对象的 id 和实例本身 - DAO 将再次从数据库中检索对象，并在提交事务之前设置更新的值和 session.SaveOrUpdate()。
5.  睡眠'n'秒
6.  再重复一遍！

因此，以下是我们用于每个 DAO 方法的常见模式：

*   使用 sessionFactory.OpenSession() 打开会话
*   开始交易
*   做数据库工作。检索/更新等
*   提交反式
*   （异常情况下回滚）
*   最后总是处理事务和 session.Close()

*对 DAO 类的每个*方法调用都会发生这种情况。我怀疑这是我们正在做的某种反模式。

但是，我无法在任何地方找到足够的方向来改进它。

请注意，当这个线程在后台运行时，做它的工作，有来自 WCF 客户端的请求，每个客户端都可以自己调用 2-3 个 DAO - 有时查询/更新长时间运行的线程处理的相同对象.

任何改进我们设计的想法/建议/指针将不胜感激。如果我们能进行一些很好的讨论，我们可以把它变成一个社区维基，并可能从[http://nhibernate.info链接到这里](http://nhibernate.info)

克里希纳

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-05T08:45:23.773

> 似乎非常缺乏非 Web 应用程序设计的文档/讨论。

这也是我的经历。但是，您所遵循的模型对我来说似乎是正确的。您应该始终打开一个会话，提交更改，然后再次关闭它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-03-03T14:25:03.057

这个问题现在有点老了，但另一种技术是使用上下文会话而不是在每个 DAO 中创建一个新会话。

在我们的例子中，我们正在考虑为每个线程创建一次会话（对于我们的多线程 win32 服务），并使用返回 SessionFactory.GetCurrentSession() 的属性（使用 ThreadContext 当前会话提供程序）使其对 DAO 可用，所以它是每线程会话）或通过 DI（依赖注入 - 再次使用 ThreadContext。）

[有关 GetCurrentSession 和上下文会话的更多信息](http://lozanotek.com/blog/archive/2009/02/18/Contextual_Sessions_with_NHibernate_ndash_Part_2.aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-27T16:32:42.093

我同意，有状态应用程序的示例并不多。我正在考虑执行以下操作：

像你一样，我有一个托管许多 WCF 服务的 Windows 服务。所以 WCF 服务是入口点。最终，我所有的 WCF 服务都继承自 AbstractService - 它处理大量日志记录和基本的数据库插入/更新。

在我见过的最好的 NHibernate 帖子之一中，HttpModule 执行以下操作：请参阅[http://www.codeproject.com/KB/architecture/NHibernateBestPractices.aspx](http://www.codeproject.com/KB/architecture/NHibernateBestPractices.aspx)

```
private void BeginTransaction(object sender, EventArgs e) {
    NHibernateSessionManager.Instance.BeginTransaction();
}
private void CommitAndCloseSession(object sender, EventArgs e) {
    try {
        NHibernateSessionManager.Instance.CommitTransaction();
    }
    finally {
        NHibernateSessionManager.Instance.CloseSession();
    }
} 
```

* * *

所以也许我应该在 AbstractService 中做类似的事情。如此有效地，我最终会为每个服务调用提供一个会话。如果您检查上面的 NHibernate 最佳实践文章链接，您会发现 NHibernateSessionManager 应该处理其他所有事情，只要我打开和关闭会话（AbstractService 构造函数和析构函数）。

只是一个想法。但是我遇到了错误，因为我的会话似乎停留了太久，并且我遇到了臭名昭著的错误 - NHibernate.AssertionFailure: null id in entry（发生异常后不要刷新会话）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-11T21:51:44.997

您也可以在不实际关闭会话的情况下刷新会话，它可以实现相同的效果。我愿意。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-05-04T15:03:07.147

我们最近开始使用 IoC 容器来管理会话生命周期，作为上述上下文会话的替代品。（更多细节[在这里](http://blogs.7digital.com/dev/2011/05/04/managing-session-lifecycle-using-nested-containers/)）。

# latex - LaTeX Beamer 包，在 \againframe 中更改框架标题

> ID：171708
> 
> 赞同：15
> 
> 时间：2008-10-05T08:41:54.827
> 
> 标签：latex, beamer

在 LaTeX 中使用 Beamer 包中的 \againframe 时是否可以更改框架标题？我想在框架内的特定幻灯片上显示上一个框架，但这次使用不同的标题。

谢谢。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-10-05T09:31:34.133

尝试执行以下操作：

```
\begin{frame}[label=my_frame]
  \frametitle<1>{Title to be displayed the first time}
  \frametitle<2>{Title to be displayed the second time}
  %Other frame contents
\end{frame}

\againframe<2>{my_frame} 
```

这称为使用“覆盖规范”。请参阅 Beamer 用户指南（版本 3.01）的第 3.10 节。

# c# - 在 C# 中使用 Java 类

> ID：171717
> 
> 赞同：4
> 
> 时间：2008-10-05T08:52:15.117
> 
> 标签：c#, java

我有一个用 Java (>1.5) 编写的项目。

是否可以使用 C# 编写项目的一部分？
例如 GUI 和调用方法并实例化用 java 编写的类？

如果是，如何？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-10-31T19:36:29.400

I am author of [jni4net](http://jni4net.sf.net/), open source intraprocess bridge between JVM and CLR. It's build on top of JNI and PInvoke. No C/C++ code needed. I hope it will help you.

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-05T09:00:58.377

[并非没有ikvm](http://www.ikvm.net/)之类的东西- 或者使用 Web 服务等在双方之间进行通信。基本上，这可能比用 C# 重写现有项目代码或用 Java 编写 GUI 要多得多。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-05T09:02:24.067

有一种称为.NET 的[Java 语言转换助手](http://msdn.microsoft.com/en-nz/vjsharp/aa718346.aspx)。您可以将 Java 类转换为 c# 并开始编码。

还有一种叫做[JNBridge](http://www.jnbridge.com/)的东西（不是免费的）。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-05T09:08:30.420

**看来我的解决方案非常有限。并且仅适用于特定版本的 java。**

我可能会继续使用旧的好 C :) 无法想象没有共享库如何工作 :)

本[文档](http://www.excelsior-usa.com/kb/000001.html)解释了如何从 java 创建一个 dll 并在 C 代码中使用它。我不是 C# 或 java 专家，但我确信您也可以在 C# 中加载外部 dll。因此，恕我直言，这不是一个完整的解决方案，而是一个很好的起点。通常 dll 它是混合语言的完美方式。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-05T15:43:51.557

以简单的方式，您可以将 java 类打包到 jar 文件中，然后在 C# 中使用*Process*类来执行和映射 IO 流

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-12T20:04:15.093

几年前（我相信是 2005 年）我对此进行了一些研究，我喜欢 JNBridgePro 作为最好的第三方产品来做到这一点。在这里查看[http://www.jnbridge.com/](http://www.jnbridge.com/)

祝你好运！

# java - 删除 Derby DB 中的所有表

> ID：171727
> 
> 赞同：14
> 
> 时间：2008-10-05T09:01:52.197
> 
> 标签：java, sql, jdbc, derby

如何使用 JDBC 删除 Apache Derby DB 架构中的所有表？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2014-04-06T04:58:54.123

感谢[博客](http://stuetzpunkt.wordpress.com/2013/02/02/drop-tables-in-derby-db/)：

### 第1步：

运行 SQL 语句，但不要忘记在以下 2 次出现中将模式名称“APP”替换为您的模式名称：

```
SELECT
'ALTER TABLE '||S.SCHEMANAME||'.'||T.TABLENAME||' DROP CONSTRAINT '||C.CONSTRAINTNAME||';'
FROM
    SYS.SYSCONSTRAINTS C,
    SYS.SYSSCHEMAS S,
    SYS.SYSTABLES T
WHERE
    C.SCHEMAID = S.SCHEMAID
AND
    C.TABLEID = T.TABLEID
AND
S.SCHEMANAME = 'APP'
UNION
SELECT 'DROP TABLE ' || schemaname ||'.' || tablename || ';'
FROM SYS.SYSTABLES
INNER JOIN SYS.SYSSCHEMAS ON SYS.SYSTABLES.SCHEMAID = SYS.SYSSCHEMAS.SCHEMAID
where schemaname='APP'; 
```

### 第2步：

上述执行的结果是一组 SQL 语句，将它们复制到 SQL 编辑器，执行它们，然后删除约束和表。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-11-14T15:32:05.087

有关执行此操作的实际代码，请检查Derby 分发版的 Derby 测试套件部分中的[CleanDatabaseTestSetup.java 。](http://svn.apache.org/viewvc/db/derby/code/trunk/java/org.apache.derby.tests/org/apache/derbyTesting/junit/CleanDatabaseTestSetup.java?view=markup)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-05T09:58:09.727

在java中执行一个小方法，在其中执行

```
DROP TABLE [tablename] 
```

`tablename`是通过参数传递的。

还有另一种方法，您可以在其中循环由查询形成的记录集

```
SELECT tablename FROM SYSTABLES 
```

调用第一种方法。

[德比最新文档](http://db.apache.org/derby/docs/10.4/ref/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-05T09:44:49.160

我认为大多数数据库提供商不允许 DROP TABLE * （或类似的）。

我认为最好的方法是显示表，然后通过结果集在循环中遍历每个删除。

HTH。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-05T10:31:08.613

JDBC 允许您以与数据库无关的方式解决您的任务：

1.  打开连接
2.  获取数据库元数据
3.  使用它列出数据库[JavaDoc中的所有表](http://java.sun.com/j2se/1.4.2/docs/api/java/sql/DatabaseMetaData.html#getTables(java.lang.String,%20java.lang.String,%20java.lang.String,%20java.lang.String[]))
4.  遍历结果集并为每个表触发 DROP TABLE

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-05T15:48:51.047

1.  您必须从 Derby DB 系统目录生成模式和表名。
2.  按关系对所有表进行排序。
3.  生成删除所有表的java语句
4.  使用 autoCommit() 方法并将此方法设置为 false。出错时用于手动提交或回滚事务。
5.  运行你的java进程。祝你好运。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-05T23:20:04.007

一个更简单的解决方案是使用 JDBC 运行“drop database foo”然后“create database foo”。但是，这将导致数据库中的所有对象都被删除（即不仅仅是表）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-12-18T07:55:28.263

如果您从命令提示符而不是通过 JDBC 工作，这应该可以帮助您入门。

```
SELECT 'DROP TABLE ' || schemaname ||'.' || tablename || ';'
FROM SYS.SYSTABLES
INNER JOIN SYS.SYSSCHEMAS ON SYS.SYSTABLES.SCHEMAID = SYS.SYSSCHEMAS.SCHEMAID
; 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-08-23T07:57:16.490

一个简单的解决方案是右键单击-> 断开连接，然后删除包含数据库的文件夹并重新连接。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-11-17T15:41:20.003

[从http://squirrel-sql.sourceforge.net/](http://squirrel-sql.sourceforge.net/)下载 Squirrel SQL

连接到数据库。

展开表节点。

选择要删除的表。

右键单击并选择 -> 脚本 -> 删除表脚本

运行生成的查询

您甚至可以选择删除记录来清空选定的表。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2022-01-14T04:24:40.613

对于那些希望以编程方式删除所有模式而不必每次都手动复制粘贴 SQL 的人，这里是从*org.apache.derbyTesting.junit.CleanDatabaseTestSetup*和*org.apache.derbyTesting.junit.JDBC*中提取的代码。你只需调用 dropAllSchemas(connection);

```
public static void dropAllSchemas(Connection conn) throws SQLException {
    DatabaseMetaData dmd = conn.getMetaData();
    SQLException sqle = null;
    // Loop a number of arbitary times to catch cases
    // where objects are dependent on objects in
    // different schemas.
    for (int count = 0; count < 5; count++) {
        // Fetch all the user schemas into a list
        List<String> schemas = new ArrayList<String>();
        ResultSet rs = dmd.getSchemas();
        while (rs.next()) {
            String schema = rs.getString("TABLE_SCHEM");
            if (schema.startsWith("SYS"))
                continue;
            if (schema.equals("SQLJ"))
                continue;
            if (schema.equals("NULLID"))
                continue;
            schemas.add(schema);
        }
        rs.close();
        // DROP all the user schemas.
        sqle = null;
        for (String schema : schemas) {
            try {
                dropSchema(dmd, schema);
            } catch (SQLException e) {
                sqle = e;
            }
        }
        // No errors means all the schemas we wanted to
        // drop were dropped, so nothing more to do.
        if (sqle == null)
            return;
    }
    throw sqle;
}

/**
 * Constant to pass to DatabaseMetaData.getTables() to fetch
 * just tables.
 */
public static final String[] GET_TABLES_TABLE = new String[] {"TABLE"};
/**
 * Constant to pass to DatabaseMetaData.getTables() to fetch
 * just views.
 */
public static final String[] GET_TABLES_VIEW = new String[] {"VIEW"};
/**
 * Constant to pass to DatabaseMetaData.getTables() to fetch
 * just synonyms.
 */
public static final String[] GET_TABLES_SYNONYM =
    new String[] {"SYNONYM"};
/**
 * Drop a database schema by dropping all objects in it
 * and then executing DROP SCHEMA. If the schema is
 * APP it is cleaned but DROP SCHEMA is not executed.
 * 
 * TODO: Handle dependencies by looping in some intelligent
 * way until everything can be dropped.
 * 

 * 
 * @param dmd DatabaseMetaData object for database
 * @param schema Name of the schema
 * @throws SQLException database error
 */
public static void dropSchema(DatabaseMetaData dmd, String schema) throws SQLException{     
    Connection conn = dmd.getConnection();
    Statement s = dmd.getConnection().createStatement();

    // Triggers
    PreparedStatement pstr = conn.prepareStatement(
            "SELECT TRIGGERNAME FROM SYS.SYSSCHEMAS S, SYS.SYSTRIGGERS T "
            + "WHERE S.SCHEMAID = T.SCHEMAID AND SCHEMANAME = ?");
    pstr.setString(1, schema);
    ResultSet trrs = pstr.executeQuery();
    while (trrs.next()) {
        String trigger = trrs.getString(1);
        s.execute("DROP TRIGGER " + escape(schema, trigger));
    }
    trrs.close();
    pstr.close();

    // Functions - not supported by JDBC meta data until JDBC 4
    // Need to use the CHAR() function on A.ALIASTYPE
    // so that the compare will work in any schema.
    PreparedStatement psf = conn.prepareStatement(
            "SELECT ALIAS FROM SYS.SYSALIASES A, SYS.SYSSCHEMAS S" +
            " WHERE A.SCHEMAID = S.SCHEMAID " +
            " AND CHAR(A.ALIASTYPE) = ? " +
            " AND S.SCHEMANAME = ?");
    psf.setString(1, "F" );
    psf.setString(2, schema);
    ResultSet rs = psf.executeQuery();
    dropUsingDMD(s, rs, schema, "ALIAS", "FUNCTION");        

    // Procedures
    rs = dmd.getProcedures((String) null,
            schema, (String) null);

    dropUsingDMD(s, rs, schema, "PROCEDURE_NAME", "PROCEDURE");

    // Views
    rs = dmd.getTables((String) null, schema, (String) null,
            GET_TABLES_VIEW);

    dropUsingDMD(s, rs, schema, "TABLE_NAME", "VIEW");

    // Tables
    rs = dmd.getTables((String) null, schema, (String) null,
            GET_TABLES_TABLE);

    dropUsingDMD(s, rs, schema, "TABLE_NAME", "TABLE");

    // At this point there may be tables left due to
    // foreign key constraints leading to a dependency loop.
    // Drop any constraints that remain and then drop the tables.
    // If there are no tables then this should be a quick no-op.
    ResultSet table_rs = dmd.getTables((String) null, schema, (String) null,
            GET_TABLES_TABLE);

    while (table_rs.next()) {
        String tablename = table_rs.getString("TABLE_NAME");
        rs = dmd.getExportedKeys((String) null, schema, tablename);
        while (rs.next()) {
            short keyPosition = rs.getShort("KEY_SEQ");
            if (keyPosition != 1)
                continue;
            String fkName = rs.getString("FK_NAME");
            // No name, probably can't happen but couldn't drop it anyway.
            if (fkName == null)
                continue;
            String fkSchema = rs.getString("FKTABLE_SCHEM");
            String fkTable = rs.getString("FKTABLE_NAME");

            String ddl = "ALTER TABLE " +
                escape(fkSchema, fkTable) +
                " DROP FOREIGN KEY " +
                escape(fkName);
            s.executeUpdate(ddl);
        }
        rs.close();
    }
    table_rs.close();
    conn.commit();

    // Tables (again)
    rs = dmd.getTables((String) null, schema, (String) null,
            GET_TABLES_TABLE);        
    dropUsingDMD(s, rs, schema, "TABLE_NAME", "TABLE");

    // drop UDTs
    psf.setString(1, "A" );
    psf.setString(2, schema);
    rs = psf.executeQuery();
    dropUsingDMD(s, rs, schema, "ALIAS", "TYPE");        

    // drop aggregates
    psf.setString(1, "G" );
    psf.setString(2, schema);
    rs = psf.executeQuery();
    dropUsingDMD(s, rs, schema, "ALIAS", "DERBY AGGREGATE");        
    psf.close();

    // Synonyms - need work around for DERBY-1790 where
    // passing a table type of SYNONYM fails.
    rs = dmd.getTables((String) null, schema, (String) null,
            GET_TABLES_SYNONYM);

    dropUsingDMD(s, rs, schema, "TABLE_NAME", "SYNONYM");

    // sequences
    if ( sysSequencesExists( conn ) )
    {
        psf = conn.prepareStatement
            (
             "SELECT SEQUENCENAME FROM SYS.SYSSEQUENCES A, SYS.SYSSCHEMAS S" +
             " WHERE A.SCHEMAID = S.SCHEMAID " +
             " AND S.SCHEMANAME = ?");
        psf.setString(1, schema);
        rs = psf.executeQuery();
        dropUsingDMD(s, rs, schema, "SEQUENCENAME", "SEQUENCE");
        psf.close();
    }

    // Finally drop the schema if it is not APP
    if (!schema.equals("APP")) {
        s.executeUpdate("DROP SCHEMA " + escape(schema) + " RESTRICT");
    }
    conn.commit();
    s.close();
}

    /**
 * Return true if the SYSSEQUENCES table exists.
 */
private static boolean sysSequencesExists( Connection conn ) throws SQLException
{
    PreparedStatement ps = null;
    ResultSet rs =  null;
    try {
        ps = conn.prepareStatement
            (
             "select count(*) from sys.systables t, sys.sysschemas s\n" +
             "where t.schemaid = s.schemaid\n" +
             "and ( cast(s.schemaname as varchar(128)))= 'SYS'\n" +
             "and ( cast(t.tablename as varchar(128))) = 'SYSSEQUENCES'" );
        rs = ps.executeQuery();
        rs.next();
        return ( rs.getInt( 1 ) > 0 );
    }
    finally
    {
        if ( rs != null ) { rs.close(); }
        if ( ps != null ) { ps.close(); }
    }
}

/**
 * Escape a non-qualified name so that it is suitable
 * for use in a SQL query executed by JDBC.
 */
public static String escape(String name)
{
    StringBuffer buffer = new StringBuffer(name.length() + 2);
    buffer.append('"');
    for (int i = 0; i < name.length(); i++) {
        char c = name.charAt(i);
        // escape double quote characters with an extra double quote
        if (c == '"') buffer.append('"');
        buffer.append(c);
    }
    buffer.append('"');
    return buffer.toString();
}   

/**
 * Escape a schema-qualified name so that it is suitable
 * for use in a SQL query executed by JDBC.
 */
public static String escape(String schema, String name)
{
    return escape(schema) + "." + escape(name);
}

/**
 * DROP a set of objects based upon a ResultSet from a
 * DatabaseMetaData call.
 * 
 * TODO: Handle errors to ensure all objects are dropped,
 * probably requires interaction with its caller.
 * 
 * @param s Statement object used to execute the DROP commands.
 * @param rs DatabaseMetaData ResultSet
 * @param schema Schema the objects are contained in
 * @param mdColumn The column name used to extract the object's
 * name from rs
 * @param dropType The keyword to use after DROP in the SQL statement
 * @throws SQLException database errors.
 */
private static void dropUsingDMD(
        Statement s, ResultSet rs, String schema,
        String mdColumn,
        String dropType) throws SQLException
{
    String dropLeadIn = "DROP " + dropType + " ";

    // First collect the set of DROP SQL statements.
    ArrayList<String> ddl = new ArrayList<String>();
    while (rs.next())
    {
        String objectName = rs.getString(mdColumn);
        String raw = dropLeadIn + escape(schema, objectName);
        if (
            "TYPE".equals( dropType )  ||
            "SEQUENCE".equals( dropType ) ||
            "DERBY AGGREGATE".equals( dropType )
            )
        { raw = raw + " restrict "; }
        ddl.add( raw );
    }
    rs.close();
    if (ddl.isEmpty())
        return;

    // Execute them as a complete batch, hoping they will all succeed.
    s.clearBatch();
    int batchCount = 0;
    for (Iterator i = ddl.iterator(); i.hasNext(); )
    {
        Object sql = i.next();
        if (sql != null) {
            s.addBatch(sql.toString());
            batchCount++;
        }
    }

    int[] results;
    boolean hadError;
    try {
        results = s.executeBatch();
        //Assert.assertNotNull(results);
        //Assert.assertEquals("Incorrect result length from executeBatch", batchCount, results.length);
        hadError = false;
    } catch (BatchUpdateException batchException) {
        results = batchException.getUpdateCounts();
        //Assert.assertNotNull(results);
        //Assert.assertTrue("Too many results in BatchUpdateException", results.length <= batchCount);
        hadError = true;
    }

    // Remove any statements from the list that succeeded.
    boolean didDrop = false;
    for (int i = 0; i < results.length; i++)
    {
        int result = results[i];
        if (result == Statement.EXECUTE_FAILED)
            hadError = true;
        else if (result == Statement.SUCCESS_NO_INFO || result >= 0) {
            didDrop = true;
            ddl.set(i, null);
        }
        //else
            //Assert.fail("Negative executeBatch status");
    }
    s.clearBatch();
    if (didDrop) {
        // Commit any work we did do.
        s.getConnection().commit();
    }

    // If we had failures drop them as individual statements
    // until there are none left or none succeed. We need to
    // do this because the batch processing stops at the first
    // error. This copes with the simple case where there
    // are objects of the same type that depend on each other
    // and a different drop order will allow all or most
    // to be dropped.
    if (hadError) {
        do {
            hadError = false;
            didDrop = false;
            for (ListIterator<String> i = ddl.listIterator(); i.hasNext();) {
                String sql = i.next();
                if (sql != null) {
                    try {
                        s.executeUpdate(sql);
                        i.set(null);
                        didDrop = true;
                    } catch (SQLException e) {
                        hadError = true;
                    }
                }
            }
            if (didDrop)
                s.getConnection().commit();
        } while (hadError && didDrop);
    }
} 
```

[PS：当我将我的数据库从支持 DROP ALL OBJECTS 的 H2 迁移到不](https://db.apache.org/derby/docs/10.0/manuals/reference/sqlj28.html)支持 DROP ALL OBJECTS 的 Apache Derby 时，这段代码派上了用场（头痛）。我从 H2 迁移出来的唯一原因是它是一个完全在内存中的数据库，并且对于我的服务器的 RAM 来说太大了，所以我决定尝试 Apache Derby。H2 比 Derby 更容易、更人性化，我强烈推荐它。我很遗憾我买不起 RAM 来继续使用 H2。顺便说一句，对于那些受 Derby 缺乏 LIMIT 或 UPSERT 影响的人，请参阅这篇关于替换[FETCH NEXT](https://stackoverflow.com/questions/33613748/vaadin-sqlsyntaxerrorexception-using-javadb-derby-encountered-limit-at-line-1/70675622#70675622)而不是 LIMIT 的文章以及关于正确使用[MERGE INTO](https://stackoverflow.com/questions/34734653/can-i-use-merge-into-to-simulate-upsert-in-apache-derby/51406647)的这篇文章。

# delphi - 接口“递归”和引用计数

> ID：171730
> 
> 赞同：4
> 
> 时间：2008-10-05T09:04:20.413
> 
> 标签：delphi, oop, interface

我对接口有一个小问题。这是伪代码：

```
type
  Interface1 = interface
  end;

  Interface2 = interface
  end;

  TParentClass = class(TInterfacedObject, Interface1)
  private
    fChild : Interface2;
  public
    procedure AddChild(aChild : Interface2);
  end;

  TChildClass = class(TInterfacedObject, Interface2)
  private
    fParent : Interface2;
  public
    constructor Create(aPArent : Interface1);
  end; 
```

任何人都可以看到缺陷吗？我需要孩子引用它的父母，但在这种情况下引用计数不起作用。如果我创建一个 ParentClass 实例并添加一个子类，则永远不会释放父类。我明白为什么了。我如何绕过它？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-05T10:23:13.793

引用计数的引用有两种语义：它充当所有权共享以及导航对象图的一种方式。

通常，您不需要在引用图中的循环中的所有链接上同时使用这两种语义**。**也许只有父母拥有孩子，而不是相反？如果是这种情况，您可以通过将它们存储为指针来使子引用指向父*弱链接*，如下所示：

```
TChildClass = class(TInterfacedObject, Interface2)
private
  fParent : Pointer;
  function GetParent: Interface1;
public
  constructor Create(aPArent : Interface1);
  property Parent: Interface1 read GetParent;
end;

function TChildClass.GetParent: Interface1;
begin
  Result := Interface1(fParent);
end;

constructor TChildClass.Create(AParent: Interface1);
begin
  fParent := Pointer(AParent);
end; 
```

如果保证实例树的根在某处保持活动状态，则这是安全的，即您不仅仅依赖于保持对树分支的引用并且仍然能够导航整个树。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-05T10:14:40.067

好吧，在这种情况下，引用计数当然**可以**工作——它只是不能解决问题。

这是引用计数的最大问题——当你有一个循环引用时，你必须明确地“打破”它（例如，将一个接口引用设置为“nil”）。这也是为什么引用计数不能真正替代垃圾收集的原因——垃圾收集器知道循环可能存在，并且可以在没有从“外部”引用它们时释放这样的循环结构。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-05T09:11:12.537

您必须创建一个明确取消链接正确引用的方法。在这种情况下，无法让自动引用计数正常工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-06T19:51:26.097

在第一个示例中使用函数指针，则不存在循环引用问题。.NET 使用委托，而 VB6 使用事件。所有这些都具有不增加被指向对象的引用计数的好处。

# memcached - 使用 openNMS 监控 memcached 统计信息

> ID：171733
> 
> 赞同：0
> 
> 时间：2008-10-05T09:05:48.537
> 
> 标签：memcached, monitoring, opennms

有人试过用 openNMS 监控 memcached 统计信息吗？如果你这样做了，你用了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-12-31T16:09:38.953

从 1.7.4 版本开始，有一个与[OpenNMS](http://www.opennms.org/wiki/Main_Page)捆绑在一起的[memcached 监视器](http://www.opennms.org/wiki/Memcached_Monitor)。

# c++ - 访客模式+开放/封闭原则

> ID：171755
> 
> 赞同：17
> 
> 时间：2008-10-05T09:37:31.140
> 
> 标签：c++, oop, design-patterns, visitor-pattern, open-closed-principle

是否可以实现尊重[开放/封闭原则的](http://en.wikipedia.org/wiki/Open/closed_principle)[访问者模式](http://en.wikipedia.org/wiki/Visitor_pattern)，但仍然能够添加新的可访问类？

开放/封闭原则指出“软件实体（类、模块、函数等）应该对扩展开放，但对修改关闭”。

```
struct ConcreteVisitable1;
struct ConcreteVisitable2;

struct AbstractVisitor
{
   virtual void visit(ConcreteVisitable1& concrete1) = 0;
   virtual void visit(ConcreteVisitable2& concrete2) = 0;
};

struct AbstractVisitable
{
   virtual void accept(AbstractVisitor& visitor) = 0;
};

struct ConcreteVisitable1 : AbstractVisitable
{
   virtual void accept(AbstractVisitor& visitor)
   {
      visitor.visit(*this);
   }
};

struct ConcreteVisitable2 : AbstractVisitable
{
   virtual void accept(AbstractVisitor& visitor)
   {
      visitor.visit(*this);
   }
}; 
```

您可以实现任意数量的从 AbstractVisitor 派生的类：它对扩展开放。您不能添加新的可访问类，因为从 AbstractVisitor 派生的类将无法编译：它已关闭以供修改。

AbstractVisitor 类树遵循开放/封闭原则。AbstractVisitable 类树不遵守开放/封闭原则，因为它不能扩展。

除了如下扩展 AbstractVisitor 和 AbstractVisitable 之外，还有其他解决方案吗？

```
struct ConcreteVisitable3;

struct AbstractVisitor2 : AbstractVisitor
{
   virtual void visit(ConcreteVisitable3& concrete3) = 0;
};

struct AbstractVisitable2 : AbstractVisitable
{
   virtual void accept(AbstractVisitor2& visitor) = 0;
};

struct ConcreteVisitable3 : AbstractVisitable2
{
   virtual void accept(AbstractVisitor2& visitor)
   {
      visitor.visit(*this);
   }
}; 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-05T10:55:34.323

在 C++ 中，[非循环访问者](https://condor.depaul.edu/dmumaugh/OOT/Design-Principles/acv.pdf)(pdf) 可以为您提供所需的内容。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-05T09:52:36.960

您可能想查看有关“表达问题”的研究，例如

[http://lambda-the-ultimate.org/node/2232](http://lambda-the-ultimate.org/node/2232)

我认为这个问题主要是学术问题，但它已经被研究了很多，所以你可以阅读一些关于在现有语言或各种语言扩展中实现它的不同方法的东西。

# python - 获得一个数字的所有除数的最佳方法是什么？

> ID：171765
> 
> 赞同：126
> 
> 时间：2008-10-05T09:48:58.480
> 
> 标签：python, algorithm, math

这是非常愚蠢的方式：

```
def divisorGenerator(n):
    for i in xrange(1,n/2+1):
        if n%i == 0: yield i
    yield n 
```

我想得到的结果与这个相似，但我想要一个更智能的算法（这个太慢太笨了:-)

我可以足够快地找到主要因素及其多样性。我有一个以这种方式生成因子的生成器：

(factor1, multiplicity1) (factor2,
multiplicity2)
(factor3, multiplicity3)
等等...

即输出

```
for i in factorGenerator(100):
    print i 
```

是：

```
(2, 2)
(5, 2) 
```

我不知道这对我想做的事情有多大用处（我为其他问题编写了代码），无论如何我想要一种更聪明的方法

```
for i in divisorGen(100):
    print i 
```

输出这个：

```
1
2
4
5
10
20
25
50
100 
```

* * *

**更新：**非常感谢 Greg Hewgill 和他的“聪明的方式” :) 计算 100000000 的所有除数用他的方式花费了 0.01 秒，而愚蠢的方式在我的机器上采用了 39 秒，非常酷：D

**更新2：**不要说这是[这篇](https://stackoverflow.com/questions/110344/algorithm-to-calculate-the-number-of-divisors-of-a-given-number)文章的副本。计算给定数的除数不需要计算所有除数。这是一个不同的问题，如果您认为不是，请在维基百科上查找“除数函数”。在发布之前阅读问题和答案，如果您不了解主题是什么，请不要添加无用且已经给出的答案。

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2008-10-05T10:09:20.127

鉴于您的`factorGenerator`功能，这里`divisorGen`应该可以工作：

```
def divisorGen(n):
    factors = list(factorGenerator(n))
    nfactors = len(factors)
    f = [0] * nfactors
    while True:
        yield reduce(lambda x, y: x*y, [factors[x][0]**f[x] for x in range(nfactors)], 1)
        i = 0
        while True:
            f[i] += 1
            if f[i] <= factors[i][1]:
                break
            f[i] = 0
            i += 1
            if i >= nfactors:
                return 
```

该算法的整体效率将完全取决于`factorGenerator`.

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2008-10-05T10:03:51.337

为了扩展 Shimi 所说的内容，您应该只运行从 1 到 n 的平方根的循环。然后找到对，做`n / i`，这将涵盖整个问题空间。

如前所述，这是一个 NP 或“困难”问题。详尽的搜索，你正在做的方式，几乎与保证答案一样好。加密算法等使用这一事实来帮助保护它们。如果有人要解决这个问题，我们当前的“安全”通信大部分（如果不是全部）都会变得不安全。

Python代码：

```
import math

def divisorGenerator(n):
    large_divisors = []
    for i in xrange(1, int(math.sqrt(n) + 1)):
        if n % i == 0:
            yield i
            if i*i != n:
                large_divisors.append(n / i)
    for divisor in reversed(large_divisors):
        yield divisor

print list(divisorGenerator(100)) 
```

应该输出如下列表：

```
[1、2、4、5、10、20、25、50、100]

```

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2016-04-18T17:13:37.050

我认为你可以停下`math.sqrt(n)`来而不是 n/2。

我会给你一个例子，这样你就可以很容易地理解它。现在`sqrt(28)`是6。`5.29`所以`ceil(5.29)`如果我在 6 处停下来，我就可以得到所有的除数。如何？

先看代码再看图：

```
import math
def divisors(n):
    divs = [1]
    for i in xrange(2,int(math.sqrt(n))+1):
        if n%i == 0:
            divs.extend([i,n/i])
    divs.extend([n])
    return list(set(divs)) 
```

现在，请参见下图：

假设我已经添加到我的除数列表中，我`1`开始`i=2`

[![28 的除数](https://i.stack.imgur.com/jsBas.jpg)](https://i.stack.imgur.com/jsBas.jpg)

因此，在所有迭代结束时，当我将商和除数添加到我的列表中时，所有 28 的除数都会被填充。

资料来源：[如何确定一个数的除数](http://www.wikihow.com/Determine-the-Number-of-Divisors-of-an-Integer)

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2016-05-05T19:25:54.523

虽然已经有很多解决方案，但我真的必须发布这个:)

这个是：

*   可读
*   短的
*   自包含，可复制和粘贴
*   快速（在有很多素因数和除数的情况下，比公认的解决方案快 > 10 倍）
*   兼容 python3、python2 和 pypy

代码：

```
def divisors(n):
    # get factors and their counts
    factors = {}
    nn = n
    i = 2
    while i*i <= nn:
        while nn % i == 0:
            factors[i] = factors.get(i, 0) + 1
            nn //= i
        i += 1
    if nn > 1:
        factors[nn] = factors.get(nn, 0) + 1

    primes = list(factors.keys())

    # generates factors from primes[k:] subset
    def generate(k):
        if k == len(primes):
            yield 1
        else:
            rest = generate(k+1)
            prime = primes[k]
            for factor in rest:
                prime_to_i = 1
                # prime_to_i iterates prime**i values, i being all possible exponents
                for _ in range(factors[prime] + 1):
                    yield factor * prime_to_i
                    prime_to_i *= prime

    # in python3, `yield from generate(0)` would also work
    for factor in generate(0):
        yield factor 
```

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2019-01-04T22:50:39.867

一个说明性的 Pythonic 单线：

```
from itertools import chain
from math import sqrt

def divisors(n):
    return set(chain.from_iterable((i,n//i) for i in range(1,int(sqrt(n))+1) if n%i == 0)) 
```

但更好的是，只需使用 sympy：

```
from sympy import divisors 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2008-12-16T12:17:12.103

我喜欢 Greg 解决方案，但我希望它更像 python。我觉得它会更快，更具可读性；所以经过一段时间的编码后，我得出了这个结论。

需要前两个函数来生成列表的笛卡尔积。并且可以在出现此问题时重复使用。顺便说一句，我必须自己编程，如果有人知道这个问题的标准解决方案，请随时与我联系。

“Factorgenerator”现在返回一个字典。然后将字典输入“除数”，后者使用它首先生成一个列表列表，其中每个列表是 p^n 形式的因子列表，其中 p 素数。然后我们制作这些列表的笛卡尔积，最后使用 Greg 的解决方案生成除数。我们对它们进行分类，然后将它们归还。

我测试了它，它似乎比以前的版本快一点。我将它作为一个更大程序的一部分进行了测试，所以我真的不能说它快了多少。

彼得罗·斯佩罗尼 (pietrosperoni dot it)

```
from math import sqrt

##############################################################
### cartesian product of lists ##################################
##############################################################

def appendEs2Sequences(sequences,es):
    result=[]
    if not sequences:
        for e in es:
            result.append([e])
    else:
        for e in es:
            result+=[seq+[e] for seq in sequences]
    return result

def cartesianproduct(lists):
    """
    given a list of lists,
    returns all the possible combinations taking one element from each list
    The list does not have to be of equal length
    """
    return reduce(appendEs2Sequences,lists,[])

##############################################################
### prime factors of a natural ##################################
##############################################################

def primefactors(n):
    '''lists prime factors, from greatest to smallest'''  
    i = 2
    while i<=sqrt(n):
        if n%i==0:
            l = primefactors(n/i)
            l.append(i)
            return l
        i+=1
    return [n]      # n is prime

##############################################################
### factorization of a natural ##################################
##############################################################

def factorGenerator(n):
    p = primefactors(n)
    factors={}
    for p1 in p:
        try:
            factors[p1]+=1
        except KeyError:
            factors[p1]=1
    return factors

def divisors(n):
    factors = factorGenerator(n)
    divisors=[]
    listexponents=[map(lambda x:k**x,range(0,factors[k]+1)) for k in factors.keys()]
    listfactors=cartesianproduct(listexponents)
    for f in listfactors:
        divisors.append(reduce(lambda x, y: x*y, f, 1))
    divisors.sort()
    return divisors

print divisors(60668796879) 
```

PS这是我第一次发布到stackoverflow。我期待着任何反馈。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2017-10-09T00:32:59.600

这是在纯 Python 3.6 中对 10**16 以内的数字执行此操作的一种智能且快速的方法，

```
from itertools import compress

def primes(n):
    """ Returns  a list of primes < n for n > 2 """
    sieve = bytearray([True]) * (n//2)
    for i in range(3,int(n**0.5)+1,2):
        if sieve[i//2]:
            sieve[i*i//2::i] = bytearray((n-i*i-1)//(2*i)+1)
    return [2,*compress(range(3,n,2), sieve[1:])]

def factorization(n):
    """ Returns a list of the prime factorization of n """
    pf = []
    for p in primeslist:
      if p*p > n : break
      count = 0
      while not n % p:
        n //= p
        count += 1
      if count > 0: pf.append((p, count))
    if n > 1: pf.append((n, 1))
    return pf

def divisors(n):
    """ Returns an unsorted list of the divisors of n """
    divs = [1]
    for p, e in factorization(n):
        divs += [x*p**k for k in range(1,e+1) for x in divs]
    return divs

n = 600851475143
primeslist = primes(int(n**0.5)+1) 
print(divisors(n)) 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-02-22T13:11:56.290

改编自[CodeReview](https://codereview.stackexchange.com/a/23015/8431)，这是一个适用于`num=1`!

```
from itertools import product
import operator

def prod(ls):
   return reduce(operator.mul, ls, 1)

def powered(factors, powers):
   return prod(f**p for (f,p) in zip(factors, powers))

def divisors(num) :

   pf = dict(prime_factors(num))
   primes = pf.keys()
   #For each prime, possible exponents
   exponents = [range(i+1) for i in pf.values()]
   return (powered(primes,es) for es in product(*exponents)) 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2020-08-14T16:06:45.210

如果您的 PC 有大量内存，那么使用 numpy 单行就可以足够快：

```
N = 10000000; tst = np.arange(1, N); tst[np.mod(N, tst) == 0]
Out: 
array([      1,       2,       4,       5,       8,      10,      16,
            20,      25,      32,      40,      50,      64,      80,
           100,     125,     128,     160,     200,     250,     320,
           400,     500,     625,     640,     800,    1000,    1250,
          1600,    2000,    2500,    3125,    3200,    4000,    5000,
          6250,    8000,   10000,   12500,   15625,   16000,   20000,
         25000,   31250,   40000,   50000,   62500,   78125,   80000,
        100000,  125000,  156250,  200000,  250000,  312500,  400000,
        500000,  625000, 1000000, 1250000, 2000000, 2500000, 5000000]) 
```

在我的慢速 PC 上花费不到 1 秒。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-03-17T20:01:32.053

老问题，但这是我的看法：

```
def divs(n, m):
    if m == 1: return [1]
    if n % m == 0: return [m] + divs(n, m - 1)
    return divs(n, m - 1) 
```

您可以使用以下代理：

```
def divisorGenerator(n):
    for x in reversed(divs(n, n)):
        yield x 
```

注意：对于支持的语言，这可能是尾递归的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-08-21T19:29:02.253

假设`factors`函数返回*n*的因数（例如，`factors(60)`返回列表 [2, 2, 3, 5]），这里有一个计算*n*的因数的函数：

```
function divisors(n)
    divs := [1]
    for fact in factors(n)
        temp := []
        for div in divs
            if fact * div not in divs
                append fact * div to temp
        divs := divs + temp
    return divs 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-07-10T12:05:26.927

这是我的解决方案。它似乎很愚蠢，但效果很好......我试图找到所有合适的除数，所以循环从 i = 2 开始。

```
import math as m 

def findfac(n):
    faclist = [1]
    for i in range(2, int(m.sqrt(n) + 2)):
        if n%i == 0:
            if i not in faclist:
                faclist.append(i)
                if n/i not in faclist:
                    faclist.append(n/i)
    return facts 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-04-17T23:03:09.360

如果您只关心使用列表推导而不关心其他任何事情！

```
from itertools import combinations
from functools import reduce

def get_devisors(n):
    f = [f for f,e in list(factorGenerator(n)) for i in range(e)]
    fc = [x for l in range(len(f)+1) for x in combinations(f, l)]
    devisors = [1 if c==() else reduce((lambda x, y: x * y), c) for c in set(fc)]
    return sorted(devisors) 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-05-09T08:37:32.173

尝试计算给定数字的平方根，然后循环 range(1,square_root+1)。

```
number = int(input("Enter a Number: "))
square_root = round(number ** (1.0 / 2))
print(square_root)
divisor_list = []
for i in range(1,square_root+1):
    if number % i == 0: # Check if mod return 0 if yes then append i and number/i in the list
        divisor_list.append(i)
        divisor_list.append(int(number/i))

print(divisor_list) 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-10-06T11:13:39.460

```
def divisorGen(n): v = n last = [] for i in range(1, v+1) : if n % i == 0 : last.append(i) 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-12-18T19:03:48.667

我不明白为什么这个问题有这么多复杂的解决方案。

这是我的看法：

```
def divisors(n):
  lis =[1]
  s = math.ceil(math.sqrt(n))
  for g in range(s,1, -1):
     if n % g == 0:
        lis.append(g)
        lis.append(int(n / g))
  return (set(lis)) 
```

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2014-06-01T19:20:42.763

```
return [x for x in range(n+1) if n/x==int(n/x)] 
```

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2014-09-12T17:42:43.717

对我来说，这很好用，也很干净（Python 3）

```
def divisors(number):
    n = 1
    while(n<number):
        if(number%n==0):
            print(n)
        else:
            pass
        n += 1
    print(number) 
```

不是很快，但可以根据需要逐行返回除数，如果你真的想要，你也可以做 list.append(n) 和 list.append(number)

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2020-08-17T11:53:38.517

我通过生成器函数的解决方案是：

```
def divisor(num):
    for x in range(1, num + 1):
        if num % x == 0:
            yield x
    while True:
        yield None 
```

# linq - 如何在 Entity Framework 中强制沿导航关系完全加载？

> ID：171771
> 
> 赞同：2
> 
> 时间：2008-10-05T09:55:37.203
> 
> 标签：linq, entity-framework, ado.net

好的，所以我第一次尝试使用 ADO.NET 实体框架。

我现在的测试用例包括一个 SQL Server 2008 数据库，它有 2 个表，成员和配置文件，关系为 1:1。

然后我使用实体数据模型向导从数据库中自动生成 EDM。它生成了一个具有正确关联的模型。现在我想这样做：

```
ObjectQuery<Member> members = entities.Member;
IQueryable<Member> membersQuery = from m in members select m;
foreach (Member m in membersQuery)
{
   Profile p = m.Profile;
   ...
} 
```

哪个成功了。我能够遍历所有成员。但我遇到的问题是 m.Profile 始终为空。MSDN 库上的 LINQ to Entities 示例似乎表明我将能够无缝地遵循这样的导航关系，但它似乎不是那样工作的。我发现如果我首先以某种方式在单独的调用中加载配置文件，例如使用entities.Profile.ToList，那么m.Profile 将指向一个有效的配置文件。

所以我的问题是，是否有一种优雅的方式来强制框架自动加载导航关系中的数据，或者我是否需要通过连接或其他方式明确地做到这一点？

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-06T05:36:45.993

好的，我设法在这里找到了我需要的答案[http://msdn.microsoft.com/en-us/magazine/cc507640.aspx](http://msdn.microsoft.com/en-us/magazine/cc507640.aspx)。以下查询将确保已加载 Profile 实体：

```
IQueryable<Member> membersQuery = from m in members.Include("Profile") select m; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-30T20:48:10.707

我在一对多的关系上使用了这种技术并且效果很好。我有一个调查类和许多问题作为来自不同数据库表的一部分，并使用这种技术设法提取相关问题......

```
context.Survey.Include("SurveyQuestion").Where(x => x.Id == id).First() 
```

（上下文是生成的 ObjectContext）。

```
context.Survey.Include<T>().Where(x => x.Id == id).First() 
```

我只花了 10 分钟试图组合一个扩展方法来做到这一点，我能想出的最接近的是......

```
 public static ObjectQuery<T> Include<T,U>(this ObjectQuery<T> context)
    {
        string path = typeof(U).ToString();
        string[] split = path.Split('.');

        return context.Include(split[split.Length - 1]);
    } 
```

任何改进的指针都将受到欢迎:-)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-30T21:13:14.697

在做更多的研究后发现了这个...... [StackOverflow 链接](https://stackoverflow.com/questions/179700/get-the-name-of-a-class-as-a-string-in-c)，其中有一个到[Func 链接](http://msmvps.com/blogs/matthieu/archive/2008/06/06/entityframework-include-with-func.aspx)的帖子，这比我的扩展方法尝试要好得多:-)

# design-patterns - 使用策略模式的好处在哪里？

> ID：171776
> 
> 赞同：12
> 
> 时间：2008-10-05T10:00:00.097
> 
> 标签：design-patterns, strategy-pattern

我[在 Wikipedia 上查看了这个解释](http://en.wikipedia.org/wiki/Strategy_pattern)，特别是 C++ 示例，但未能认识到仅定义 3 个类、创建实例并调用它们与该示例之间的区别。我所看到的只是将另外两个类放入该过程中，并且看不到哪里会有好处。现在我确定我错过了一些明显的东西（树木的木材） - 有人可以用一个明确的现实世界的例子来解释它吗？

* * *

到目前为止，我可以从答案中得出什么，在我看来，这只是一种更复杂的方法：

```
have an abstract class: MoveAlong with a virtual method: DoIt()
have class Car inherit from MoveAlong, 
     implementing DoIt() { ..start-car-and-drive..}
have class HorseCart inherit from MoveAlong, 
     implementing DoIt() { ..hit-horse..}
have class Bicycle inherit from MoveAlong, 
     implementing DoIt() { ..pedal..}
now I can call any function taking MoveAlong as parm 
passing any of the three classes and call DoIt
Isn't this what Strategy intents? (just simpler?) 
```

[Edit-update] 我上面提到的函数被替换为另一个类，其中 MoveAlong 将是基于在这个新类中实现的算法根据需要设置的属性。（类似于接受的答案中展示的内容。）

* * *

[编辑更新]**结论**

策略模式有它的用途，但我是 KISS 的坚定信徒，并且倾向于更直接和更少混淆的技术。主要是因为我想传递易于维护的代码（并且'因为我很可能是必须进行更改的人！）。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-05T10:37:32.143

关键是将算法分成可以在运行时插入的类。例如，假设您有一个包含时钟的应用程序。绘制时钟的方法有很多种，但大部分基本功能是相同的。这样就可以创建时钟显示界面了：

```
class IClockDisplay
{
    public:
       virtual void Display( int hour, int minute, int second ) = 0;
}; 
```

然后你的 Clock 类连接到一个计时器并每秒更新一次时钟显示。所以你会有类似的东西：

```
class Clock
{
   protected:
      IClockDisplay* mDisplay;
      int mHour;
      int mMinute;
      int mSecond;

   public:
      Clock( IClockDisplay* display )
      {
          mDisplay = display;
      }

      void Start(); // initiate the timer

      void OnTimer()
      {
         mDisplay->Display( mHour, mMinute, mSecond );
      }

      void ChangeDisplay( IClockDisplay* display )
      {
          mDisplay = display;
      }
}; 
```

然后在运行时用适当的显示类实例化你的时钟。即，您可以让 ClockDisplayDigital、ClockDisplayAnalog、ClockDisplayMartian 都实现 IClockDisplay 接口。

因此，您以后可以通过创建一个新类来添加任何类型的新时钟显示，而不必弄乱您的 Clock 类，也不必重写可能难以维护和调试的方法。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-10-05T10:08:08.600

在 Java 中，您使用密码输入流进行解密，如下所示：

```
String path = ... ;
InputStream = new CipherInputStream(new FileInputStream(path), ???); 
```

但是密码流不知道您打算使用什么加密算法或块大小、填充策略等......新算法将一直添加，因此硬编码它们是不切实际的。相反，我们传入一个密码**策略对象**来告诉它如何执行解密......

```
String path = ... ;
Cipher strategy = ... ;
InputStream = new CipherInputStream(new FileInputStream(path), strategy); 
```

通常，只要您有任何对象知道**它**需要做什么但不**知道如何**做，您就可以使用策略模式。另一个很好的例子是 Swing 中的布局管理器，尽管在这种情况下它并没有很好地工作，请参阅[Totally GridBag](http://madbean.com/anim/totallygridbag)以获得有趣的插图。

注意：这里有两种模式在起作用，因为在流中包装流是[Decorator](http://en.wikipedia.org/wiki/Decorator_pattern)的一个例子。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-05T13:22:01.297

战略和决策/选择之间是有区别的。大多数时候，我们会在代码中处理决策/选择，并使用 if()/switch() 构造来实现它们。当需要将逻辑/算法与使用分离时，策略模式很有用。

例如，考虑一种轮询机制，不同的用户将检查资源/更新。现在，我们可能希望以更快的周转时间或更多详细信息通知某些特权用户。本质上，所使用的逻辑会根据用户角色而变化。从设计/架构的角度来看，策略是有意义的，在较低的粒度级别上，它应该始终受到质疑。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-05T10:28:43.847

策略模式允许您在不扩展主类的情况下利用多态性。本质上，您将所有可变部分放在策略接口和实现中，并将主类委托给它们。如果您的主对象仅使用一种策略，则几乎与在每个子类中具有抽象（纯虚拟）方法和不同实现相同。

该策略方法提供了一些好处：

*   您可以在运行时更改策略 - 将此与在运行时更改类类型进行比较，这要困难得多，编译器特定且对于非虚拟方法是不可能的
*   一个主要类可以使用一种以上的策略，这允许您以多种方式重新组合它们。考虑一个遍历树并根据每个节点和当前结果评估函数的类。你可以有一个步行策略（深度优先或广度优先）和计算策略（一些函子 - 即“计数正数”或“总和”）。如果您不使用策略，则需要为每个步行/计算组合实现子类。
*   代码更容易维护，因为修改或理解策略不需要你理解整个主要对象

缺点是在许多情况下，策略模式是一种矫枉过正——switch/case 操作符的存在是有原因的。考虑从简单的控制流语句（switch/case 或 if）开始，然后仅在必要时移至类层次结构，并且如果您有多个维度的可变性，则从中提取策略。函数指针位于这个连续体的中间。

推荐阅读：

*   [http://www.industriallogic.com/xp/refactoring/](http://www.industriallogic.com/xp/refactoring/)
*   [http://www.refactoring.com/](http://www.refactoring.com/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-05T10:20:34.720

这种设计模式允许**将算法封装**在类中。

使用策略的类，客户端类，与算法实现分离。您可以更改算法实现，或添加新算法而无需修改客户端。这也可以动态完成：客户端可以选择他将使用的算法。

例如，想象一个需要将图像保存到文件的应用程序；图像可以保存为不同的格式（PNG、JPG ...）。编码算法都将在共享相同接口的不同类中实现。客户端类将根据用户偏好选择一个。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-07T23:35:03.477

一种看待这种情况的方法是，当您有各种想要执行的操作并且这些操作是在运行时确定的。如果您创建一个哈希表或策略字典，您可以检索与命令值或参数对应的那些策略。选择子集后，您可以简单地迭代策略列表并连续执行。

一个具体的例子是计算订单的总额。您的参数或命令将是基本价格、地方税、城市税、州税、陆运和优惠券折扣。当您处理订单的变化时，灵活性就会发挥作用——一些州不会征收销售税，而其他订单则需要申请优惠券。您可以动态分配计算顺序。只要您考虑了所有计算，就可以适应所有组合而无需重新编译。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-05T10:07:32.483

在 Wikipedia 示例中，可以将这些实例传递给不必关心这些实例属于哪个类的函数。该函数只是调用`execute`传递的对象，并且知道正确的事情会发生。

策略模式的一个典型例子是文件在 Unix 中的工作方式。给定一个文件描述符，你可以读取它、写入它、轮询它、寻找它、发送`ioctl`s 给它等等，而不必知道你是否在处理文件、目录、管道、套接字、设备等。（当然，某些操作，如查找，不适用于管道和套接字。但在这些情况下，读取和写入将正常工作。）

这意味着您可以编写通用代码来处理所有这些不同类型的“文件”，而不必编写单独的代码来处理文件与目录等。Unix 内核负责将调用委托给正确的代码。

现在，这是内核代码中使用的策略模式，但您没有指定它必须是用户代码，只是一个真实世界的示例。:-)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-02-21T05:34:33.527

策略模式适用于简单的想法，即“优先组合优于继承”，因此可以在运行时更改策略/算法。为了说明，让我们举一个例子，我们需要根据其类型加密不同的消息，例如 MailMessage、ChatMessage 等。

```
class CEncryptor
{
    virtual void encrypt () = 0;
    virtual void decrypt () = 0;
};
class CMessage
{
private:
    shared_ptr<CEncryptor> m_pcEncryptor;
public:
    virtual void send() = 0;

    virtual void receive() = 0;

    void setEncryptor(cost shared_ptr<Encryptor>& arg_pcEncryptor)
    {
        m_pcEncryptor =  arg_pcEncryptor;
    }

    void performEncryption()
    {
        m_pcEncryptor->encrypt();
    }
}; 
```

现在在运行时，您可以使用不同的加密器（如 CDESEncryptor:public CEncryptor）实例化从 CMessage 继承的不同消息（如 CMailMessage:public CMessage）

```
CMessage *ptr = new CMailMessage();
ptr->setEncryptor(new CDESEncrypto());
ptr->performEncryption(); 
```

# nhibernate - nhibernate - 最后排序为空

> ID：171778
> 
> 赞同：1
> 
> 时间：2008-10-05T10:02:02.480
> 
> 标签：nhibernate

以与 MS SQL Server 2005/2008（最好是 Oracle）兼容的方式使用 C# 中的 NHibernate 和仅 HQL（不是 SQL）。

有没有办法编写 order by 子句，以便空值将在查询结果的末尾排序，而非空结果将按升序排序？

根据 nickf 引用的问题的答案，答案是：

```
select x from MyClass x order by case when x.MyProperty is null then 1 else 0 end, x.MyProperty 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-10-05T10:13:46.840

我不知道这是否有帮助，但是还有[另一个问题询问有关如何使用 MySQL 执行此操作的相同问题](https://stackoverflow.com/questions/151195)。

也许相同的逻辑可以应用于 HQL？

* * *

编辑：这被接受了，所以显然，是的。

这是该问题的公认答案（[Bill Karwin](https://stackoverflow.com/users/20860)）：

```
SELECT * FROM myTable
WHERE ...
ORDER BY CASE WHEN myDate IS NULL THEN 1 ELSE 0 END, myDate; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-18T16:27:17.483

有一次，我只是放弃并修复了我的收藏类中的排序顺序。

因为我只是在移动 NULL，所以我所要做的就是在集合的开头剥离 null 并将它们附加到末尾。

有了切刀编码的赌注，它甚至可以在数组上完成。

尽管如此，ORDER BY CASE 是一个利落且易读的技巧。

# python - 你如何组织 Python 模块？

> ID：171785
> 
> 赞同：14
> 
> 时间：2008-10-05T10:09:28.113
> 
> 标签：python, module

在组织 python 模块时，我的 Mac OS X 系统是一团糟。我的硬盘上到处都有包裹，没有特定的系统来组织它们。

你如何保持一切可控？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-06T09:48:54.330

我的建议：

*   阅读[安装 Python 模块](http://docs.python.org/install/index.html)。
*   阅读[分发 Python 模块](http://docs.python.org/distutils/index.html)。
*   [从setuptools](http://peak.telecommunity.com/DevCenter/setuptools)开始使用 easy_install 。阅读 setuptools 的文档。
*   始终使用[virtualenv](http://pypi.python.org/pypi/virtualenv)。我的 site-packages 目录**仅包含 setuptools 和 virtualenv**。
*   查看 Ian Bicking 的新项目[pyinstall](http://www.openplans.org/projects/topp-engineering/blog/2008/09/24/pyinstall-a-new-hope/)。
*   关注[Ian Bicking](http://blog.ianbicking.org)的所有工作。永远是善良。
*   创建自己的包时，请使用 distutils/setuptools。考虑使用`paster create`（参见[http://pythonpaste.org](http://pythonpaste.org)）来创建您的初始目录布局。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-05T13:47:05.707

除了 PEP8 和 easy_install，您还应该查看 virtualenv。Virtualenv 允许您拥有多个不同的 python 库树。在工作中，我们使用带有引导环境的 virtualenv 来快速建立一个开发/生产环境，我们都在同步 wrt 库版本等。我们通常协调库升级。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-05T19:54:07.793

有几个 Python 组件系列。

1.  Python 附带的东西。这会照顾好自己。

2.  您使用 easy_install 获得的东西。这也照顾好自己。

3.  您必须通过其他方式获得的软件包，无论是作为 TARballs 还是 SVN 结帐。创建一个`Components`文件夹。首先将下载或 SVN 放在那里。每一次。从那里安装。

4.  您编写的可重复使用的包。我在该`Projects`文件夹中有一个包含每个项目的文件夹。如果该项目是一个高度可重用的东西，它有一个`setup.py`，我实际上运行安装就像我下载它一样。我没有很多，但有一些。其中一些可能会成为开源项目。

5.  您编写的最终应用程序。我在`Projects`每个顶级应用程序中都有一个文件夹。这些通常是大的、杂乱无章的东西（比如 Django 站点）并且没有`setup.py`. 为什么？它们通常非常复杂，只需管理几个服务器安装，并且每个服务器安装都是独一无二的。这些通常依靠`PYTHONPATH`来识别它们的部件。

注意共同的主题。它们要么是您下载的组件，要么是您正在处理的项目。

此外，我将其与客户分开（在一定程度上）。我有一个客户文件夹的主目录，每个文件夹都有项目，每个项目都有销售和交付。并非所有项目都有销售和交付。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-05T13:38:32.183

也许[PEP8](http://www.python.org/dev/peps/pep-0008/)和[easy_install](http://peak.telecommunity.com/DevCenter/EasyInstall)可以帮助你？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-05T15:30:55.140

我将我的包的所有源代码保存在 ~/Packages/ 中，然后在它们上使用“python2.5 setup.py install”进行标准安装。这扔进（对我来说） /Library/Frameworks/Python/Versions/current/lib/python2.5/site-packages/ 。对于我自己的软件的开发，我设置了别名来在trunk/branches/1.0等之间切换，方法是预先放置到PYTHONPATH上。（我必须在每个目录中运行“setup.py build_ext --inplace”才能正确导入。）

值得注意的是，Python2.6 有一个[per-user site-packages 目录](http://docs.python.org/dev/whatsnew/2.6.html#pep-370-per-user-site-packages-directory)，您可能会发现它更方便。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-05T13:50:39.383

[“模块”Python 文档页面](http://www.python.org/doc/2.5.2/tut/node8.html)是组织代码的有用指南，特别是“包”部分

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-05T16:11:30.113

我的建议是尝试将所有内容放入您的站点包目录中，除非您有充分的理由不这样做。而且我尽量避免使用easy_install，因为我发现它往往会用鸡蛋位置破坏我的sys.path，但这只是我。有些人觉得它很有用。

如果您有很多程序使用可能相互冲突的不同库，您可能还想查看[virtualenv](http://pypi.python.org/pypi/virtualenv)。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-12-19T23:25:15.080

刚刚从另一个 StackOverflow 问题中遇到了这个网站：http: [//infinitemonkeycorps.net/docs/pph/](http://infinitemonkeycorps.net/docs/pph/)这不仅仅涉及模块放置，而且一旦你放置它，你就可以编写如何轻松处理文档、测试和分发。

# svn - TSVN DNS 错误：请求的名称有效，但未找到请求类型的数据

> ID：171805
> 
> 赞同：4
> 
> 时间：2008-10-05T10:38:24.590
> 
> 标签：svn, dns, tortoisesvn

我已经更新了我的 TortoiseSVN 客户端，现在在尝试更新或提交到不同的存储库时出现错误：

> 请求的名称有效，但未找到请求类型的数据

关于如何解决这个问题的任何想法？Internet Explorer 显示适当的 URL 就好了。

*TortoiseSVN 1.5.3，内部版本 13783。*

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2014-05-15T12:56:32.260

我正在努力解决这个问题..最后我找到了解决方案...

在提供的 URL 中，提供 IP 地址而不是 ServerName

例如：' [http://xxx.xxx.xx:8080/svn/RepositoryName](http://xxx.xxx.x.x:8080/svn/RepositoryName) '

我通过这样做解决了问题...

希望这条信息会有所帮助

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-05T11:05:08.280

报告的此错误是 winsock 错误，而不是特定于 TSVN。从[Windows 套接字错误代码](http://msdn.microsoft.com/en-us/library/ms740668(VS.85).aspx)：

> 请求的名称有效并且在数据库中找到，但它没有正确的关联数据正在解析，例如返回 MX 记录但没有 A 记录 - 表明主机本身存在，但无法直接访问。

奇怪的是，您可以通过 IE 访问主机。是否有可能在 TSVN 中您指定了远程主机上不可用的端口号，而 IE 正在访问端口 80 上的主机？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-05T11:17:59.783

您是否更改了连接协议（例如，从 svn 到 http 或从 http 到 https）？或者您的 PC 和 SVN 服务器之间的防火墙配置是否发生了变化？SVN over HTTP 使用 DAV 动词来执行操作，因此这些操作可能在防火墙中被阻止。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-08-23T07:48:16.977

我意识到这是一个旧线程，但我刚刚遇到了同样的问题并找到了解决方案，所以分享没有害处。

**我的解决方案包括在TortoiseSVN |**中设置适当的代理设置。**设置 |** **网络**（已经在我的浏览器中设置，因此可以在那里查看存储库）。因此，如果您使用代理服务器，请确保正确设置 TortoiseSVN。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-05T17:34:00.400

伙计们，谢谢你的回答。再次重新启动（TSVN 更新后重新启动 2 次）修复了所有问题。

我仍然无法解释发生了什么。:)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T09:47:31.777

尝试在同一台虚拟 PC 上同时运行 TeamCity 和 Visual SVN Server 时出现此错误。启用 TeamCity 服务为我解决了这个问题。两个 Web 服务器之间可能存在一些冲突。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-03-25T23:27:37.053

我已经尝试了所有解决方案，但它们的混合工作。

1.  擦除 C:\Users\%USERNAME%\AppData\Subversion\servers 下的所有有效行
2.  擦除 C:\ProgramData\Subversion\servers 下的所有有效行
3.  打开 TortoiseSvn -> 网络然后取消选中“启用代理服务器”

为我工作。祝你好运 ：）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-09-01T12:41:03.410

我有一个静态 IP，导致没有 DNS 服务器。将您的 IP 设置为 DHCP，它会有所帮助。

# latex - 是否有任何用于绘制甘特图的 LaTeX 包？

> ID：171809
> 
> 赞同：22
> 
> 时间：2008-10-05T10:43:02.927
> 
> 标签：latex, gantt-chart

是否有用于（或多或少）轻松绘制甘特图的 LaTeX 包？

谢谢。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2011-05-09T21:54:59.423

pgfgantt包非常易于使用并且可以进行链接[。](http://www.ctan.org/pkg/pgfgantt)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-05T10:58:59.917

我自己没用过，但看起来 PSTricks 提供了一些甘特图绘制功能。

PSTricks 主站点：[http ://tug.org/PSTricks/main.cgi](http://tug.org/PSTricks/main.cgi)

使用 PSTricks 的甘特图示例：[http ://tug.org/PSTricks/main.cgi?file=Examples/Charts/gantt](http://tug.org/PSTricks/main.cgi?file=Examples/Charts/gantt)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-05-05T09:48:22.127

有[pst-gantt 包](http://www.ctan.org/tex-archive/graphics/pstricks/contrib/pst-gantt/)。坏消息是，您必须自己绘制任务之间的依赖关系。所以你需要使用`\psline`宏来绘制线条和箭头。

# c++ - VC9 和 VC8 库兼容性

> ID：171816
> 
> 赞同：3
> 
> 时间：2008-10-05T10:55:32.263
> 
> 标签：c++, dll, visual-c++-2008, vc8

（最初的问题是在那里提出的：[http](http://www.ogre3d.org/phpBB2/viewtopic.php?t=44832) ://www.ogre3d.org/phpBB2/viewtopic.php?t=44832 ）

有人问：“虽然我想在 vs2008 (VC9) 中构建所有内容，但 PhysX SDK 是使用 vs2005 (VC8) 构建的。使用所有 vc9 编译的库并与此 vc8 库结合使用会导致任何问题吗？”

我回答说，在我尝试使用 VC8 生成的 .lib 文件（和 .dll）并将其包含在 vc9 编译的 exe 中的前一天，编译器无法打开 .lib 文件。

现在，其他人回答说他们这样做没有问题......

我找不到有关 vc9 和 vc8 之间的 lib 兼容性的信息。

所以……救命？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-05T13:36:49.660

它可以工作，但是在共享 CRT/STL 对象时会遇到问题。

因此，当您在 vc8 库中执行“新建”并将其返回给 vc9 函数时，该函数又会删除该对象，您会从删除中获得一个断言。

```
 T* funcInVc8Lib()
 {
     return new T();
 }

 void funcInVC9Program()
 {
     T* p = funcInVc8Lib();
     // ...
     delete p; // it should at least assert here (in _CrtIsValidHeapPtr() )
 } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-05T13:43:09.210

lib 格式为 COFF（[http://msdn.microsoft.com/en-us/library/7ykb2k5f](http://msdn.microsoft.com/en-us/library/7ykb2k5f(VS.71).aspx) (VS.71).aspx ），PE 格式也使用 COFF。因此，我希望大多数（如果不是全部）用 vc8 构建的库都可以与 vc9 链接。

但是我在 msdn 上发现了一个线程，其中 MS 似乎不能保证用 VC8 编译的库将与 VC9 很好地链接。[http://social.msdn.microsoft.com/Forums/en-US/vcgeneral/thread/8042a534-aa8b-4f99-81ee-e5ff39ae6e69/](http://social.msdn.microsoft.com/Forums/en-US/vcgeneral/thread/8042a534-aa8b-4f99-81ee-e5ff39ae6e69/)）

考虑到这 2 位信息，我会得出结论：虽然 MS 不能保证完全 100% 的兼容性，但我希望在大多数情况下，将 vc8 库与 vc9 链接起来可以工作。

希望这可以帮助。PS你写“编译器无法打开.lib文件。”。链接器是试图打开要链接的库的链接器，而不是编译器。

# eclipse - 以编程方式显示来自 Eclipse 插件的视图

> ID：171824
> 
> 赞同：32
> 
> 时间：2008-10-05T11:00:10.617
> 
> 标签：eclipse, eclipse-plugin, eclipse-rcp, rcp, eclipse-pde

我有一个 Eclipse RCP 应用程序的插件，它有一个视图。在 RCP 应用程序中发生事件后，插件被实例化，它的方法被调用来填充插件的模型，但是我找不到如何在不转到“显示视图...”菜单的情况下显示视图.

我认为工作台单例中会有一些东西可以处理这个问题，但我还没有找到任何地方。

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-10-05T14:44:33.003

您可能正在寻找这个：

```
PlatformUI.getWorkbench().getActiveWorkbenchWindow().getActivePage().showView("viewId"); 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-03-23T20:44:00.040

如果从命令的处理程序调用

```
HandlerUtil.getActiveWorkbenchWindow(event).getActivePage().showView(viewId); 
```

据我所知，会更好。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-20T15:37:10.893

我发现需要在打开视图并将其推到后台后将其带到前面。激活方法可以解决问题。

```
PlatformUI.getWorkbench()
    .getActiveWorkbenchWindow()
    .getActivePage()
    .activate(workbenchPartToActivate); 
```

注意：workbenchPartToActivate 是`IWorkbenchPart`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-03-24T14:33:05.887

在 e4 中，EPartService 负责打开 Parts。这也可用于打开 e3 ViewParts。通过您的 IEclipseContext 实例化以下类，调用 openPart-Method，您应该会看到 Eclipse 内部浏览器视图。

```
public class Opener {
    @Inject
    EPartService partService;

    public void openPart() {
        MPart part = partService.createPart("org.eclipse.ui.browser.view");
        part.setLabel("Browser");

        partService.showPart(part, PartState.ACTIVATE);
    }
} 
```

[在这里](http://www.vogella.com/tutorials/Eclipse4Services/article.html#selectedservices_partservice5)，您可以找到一个如何与 Application.e4xmi 一起使用的示例。

# delphi - 寻找完整的 Delphi (object pascal) 语法

> ID：171827
> 
> 赞同：28
> 
> 时间：2008-10-05T11:07:02.660
> 
> 标签：delphi, syntax, grammar

我需要一个完整的 Object Pascal 语法（最好是 Delphi 2009）。帮助文件提供了一些语法，但并未提供所有信息。所以我开始收集零散的信息。最近我将这些添加到或多或少完整的语法描述中（类似 EBNF）。

虽然它看起来很广泛，但仍然存在错误，而且我确信缺少部分（特别是在 .NET 语法中）。所以我在问 SO Delphi 社区。你有任何信息或者你能纠正错误吗？作为回报，我向社区提供了完整的语法。它可能会为您节省一些时间；-)。将来，我喜欢对其他语言（如 C#/C++/Java）做同样的事情。

我已经给出了语法描述：[My Syntax sofar](http://www.dragonkiller.nl/Delphi/syntax.html)。或者，如果您喜欢[文本版本](http://www.dragonkiller.nl/Delphi/syntax.txt)。（XHTML 是从文本版本生成的）。

请注意，语法侧重于句法部分，因为词法部分并不是真正的问题。

**更新**

我有一个新版本的 Delphi 语法。[.html 版本](http://www.dragonkiller.nl/Delphi/delphi2009.html)。它包括所有版本，包括 2009。棱镜扩展仍在待办事项列表中。而且我不确定我是否要把它们放在一起。

对于真正的纯粹主义者，它还包含完整的汇编代码（它不支持完整的 100% 的英特尔集，但仅遗漏了几条指令。）。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-10-05T16:23:30.290

试试这个：**[DGrok](http://dgrok.excastle.com/)** - Delphi 语法

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-05T16:33:26.293

Delphi 没有完整的、已发布的语法。请记住，.net 和 win32 delphi 有不同的语法。

[这个项目](http://sourceforge.net/projects/jedicodeformat/)中有手工构建的 Delphi 解析器。以及许多可以编译但突破语法限制的代码测试用例。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-03T22:06:19.017

这可能是一个很好的帮助。它是[TwoDesk 的 Castalia](http://www.TwoDesk.com/)中使用的[解析器](http://code.google.com/p/castaliadelphiparser/)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-08T19:19:33.850

Delphi 7 的语法在 Object Pascal 书的后面。

你的意思是几千美元他们甚至不寄给你吗？他们甚至会寄给您一张 6' x 6' 的海报吗？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-05T11:59:12.667

您缺少哪些错误和功能？

通过扫描您的文档，您似乎混合了语法和语义。我不明白为什么要在语法级别上区分 SimpleTypeFloat 和 SimpleTypeOrdinal，或者代码运算符优先级作为 AddOp 和 MulOp 中的语法特征。true、false、nil 是标识符，就像您选择的任何变量名一样。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-05T13:52:25.307

您总是可以阅读[Free Pascal Compiler](http://www.freepascal.org/)的源代码。它支持对象帕斯卡。

# java - How best to store Subversion version information in EAR's?

> ID：171828
> 
> 赞同：8
> 
> 时间：2008-10-05T11:11:00.983
> 
> 标签：java, svn, ant, release

When receiving a bug report or an it-doesnt-work message one of my initials questions is always what version? With a different builds being at many stages of testing, planning and deploying this is often a non-trivial question.

I the case of releasing Java JAR (ear, jar, rar, war) files I would like to be able to look in/at the JAR and switch to the same branch, version or tag that was the source of the released JAR.

How can I best adjust the ant build process so that the version information in the svn checkout remains in the created build?

I was thinking along the lines of:

*   adding a VERSION file, but with what content?
*   storing information in the META-INF file, but under what property with which content?
*   copying sources into the result archive
*   added svn:properties to all sources with keywords in places the compiler leaves them be

* * *

I ended up using the svnversion approach (the accepted anwser), because it scans the entire subtree as opposed to svn info which just looks at the current file / directory. For this I defined the SVN task in the ant file to make it more portable.

```
<taskdef name="svn" classname="org.tigris.subversion.svnant.SvnTask">
  <classpath>
    <pathelement location="${dir.lib}/ant/svnant.jar"/>
    <pathelement location="${dir.lib}/ant/svnClientAdapter.jar"/>
    <pathelement location="${dir.lib}/ant/svnkit.jar"/>
    <pathelement location="${dir.lib}/ant/svnjavahl.jar"/>
  </classpath>        
</taskdef> 
```

Not all builds result in webservices. The ear file before deployment must remain the same name because of updating in the application server. Making the file executable is still an option, but until then I just include a version information file.

```
<target name="version">
  <svn><wcVersion path="${dir.source}"/></svn>
  <echo file="${dir.build}/VERSION">${revision.range}</echo>
</target> 
```

Refs:
svnrevision: [http://svnbook.red-bean.com/en/1.1/re57.html](http://svnbook.red-bean.com/en/1.1/re57.html)
svn info [http://svnbook.red-bean.com/en/1.1/re13.html](http://svnbook.red-bean.com/en/1.1/re13.html)
subclipse svn task: [http://subclipse.tigris.org/svnant/svn.html](http://subclipse.tigris.org/svnant/svn.html)
svn client: [http://svnkit.com/](http://svnkit.com/)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-05T12:52:18.377

Use the *svnversion* command in your Ant script to get the revision number:

```
<exec executable="svnversion" outputproperty="svnversion" failonerror="true">
  <env key="path" value="/usr/bin"/>
  <arg value="--no-newline" />
</exec> 
```

Then use the *${svnversion}* property somewhere in your EAR. We put it in the EAR file name, but you could also put it in a readme or version file inside the EAR, or specify the version in the EAR's *META-INF/manifest.mf*:

```
<!-- myapp-r1234.ear -->
<property name="ear" value="myapp-r${svnrevision}.ear" /> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-05T11:55:29.943

You'd want to provide the Subversion branch and repository number. As discussed in [How to access the current Subversion build number?](https://stackoverflow.com/questions/110175/how-to-access-the-current-subversion-build-number), the `svn info` command will give you this information, which you can then use to build a VERSION file or place in any of the other files that you're building into your *AR files. If you've nothing else in mind, you could consider using the [XmlProperty Ant task](http://ant.apache.org/manual/Tasks/xmlproperty.html) to extract the relevant information from the output of your svn info --xml command

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-04-02T11:20:35.073

Check out the [jreleaseinfo](http://jreleaseinfo.sourceforge.net/intro_e.html) project. Contains a ANT task that can generate a java class that can be called at runtime to display the release info for your project.

I like its simplicity.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-05-21T21:35:15.127

See also this question: [Build and Version Numbering for Java Projects (ant, cvs, hudson)](https://stackoverflow.com/questions/690419/build-and-version-numbering-for-java-projects-ant-cvs-hudson)

It includes several helpful code snippets.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-05T11:51:44.850

From the top of my mind. A tag for each jar build?

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-05T11:55:26.603

We have the first part of our build create a version.txt file in the root of the package and dump the tag used to check the code out from (in our case) CVS... Additionally, the final part of our build process checks the fully built EAR back into CVS for future reference.

That way, if we have an issue with a webapp - it's just a case of asking the reporter to hit /app/version.txt - from there we can drill down the particular build history in CVS to locate the relevant components (handles different versions of libraries in apps) to locate the error.

Not sure how much help this is to our support folk - but it's definitely something they complain about **not** being there!

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-05T11:57:00.220

Do automatic builds, and place a tag (with a date stamp) on the codebase when the build is succesful (with unittest ofcourse).

In your delivery process, only deliver tagged builds to the customer. This way you are in control, and can place the tag name in a readme.txt somewhere, or have the filename of the ear file reflect the tagname.

I personally switched back to CVS, and this is one of the reasons. In CVS, I can have a class report it's tag. All my jar files contain a "main" which makes them runnable. With support questions, I ask the customer to do a "java -jar somejar.jar" and send the output to me alongside the question.

This way I'm sure of the build they-re using, and I can even have information like java version, OS type and version. Without the customer having to answer strange questions.

It's simple but very effective.

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-05T11:59:14.850

Why not put the build number into a properties file... this can then be easily read by the java and output to a Help | About dialog (applet/application), web-page footer or whatever other GUI you might have.

(See the footer on every SOF page.... has the SVN version number there.)

Seems a load easier than looking in the WAR/EAR/JAR etc easy time?

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-20T20:49:19.080

I store the absolute repository revision as a part of my full version number. This gives people a quick glance to see if a given change is in a given version or not.

We also store the version number / build date / etc in the manifest file of the ear as custom properties, these are mostly informational only. We also store it in a properties file that is built into our jar, so the application can read it.

# c# - 自定义控件中的双缓冲子控件 (C#)

> ID：171830
> 
> 赞同：5
> 
> 时间：2008-10-05T11:13:48.483
> 
> 标签：c#, winforms, drawing, doublebuffered

我想双缓冲一个包含按钮的自定义控件。我尝试了各种方法来双重缓冲控件；SetStyle、BufferedGraphicsContext 和绘制到位图。这些都适用于控件的自定义绘图，但它们都不能处理将按钮绘制到后台缓冲区。我如何实现这一目标？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-05T11:37:46.657

从技术上讲，你不能，如果它们是标准的 .NET WinForms 按钮，你真的不需要。

按钮本身通过受保护的 DoubleBuffered 属性进行控制。访问它的唯一方法是从 SWFButton 派生一个新类，并实现代码以在该类的实例上启用 DoubleBuffered 属性（我可能会在构造函数中这样做）。最后，在表单上使用该新类的对象而不是 SWFButtons。

但是，我记得，按钮纯粹是从 WinAPI 中提取的。它们不是 GDI+。因此，您*不需要*对他们的绘图进行双重缓冲。也就是说，我不知道您的使用场景，也不知道您的应用程序正在显示什么症状，所以我可能是错的。:)

您可以考虑查看[Pro .NET 2.0 Windows Forms and Custom Controls in C#](http://www.apress.com/book/view/9781590594391)一书。所有这些都是从那本书的信息中总结出来的。

# python - 你会为 Linux 系统管理员推荐哪本书？

> ID：171835
> 
> 赞同：1
> 
> 时间：2008-10-05T11:28:15.427
> 
> 标签：python, linux, sysadmin, system-administration

[用于 Unix 和 Linux 系统管理的 Python](http://oreilly.com/catalog/9780596515829/)是针对系统管理员的。除此以外的任何其他收藏夹。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-07-19T11:49:50.780

首先，您可以从 Python 文档索引开始学习 Python 的基础知识。还有有趣的教程，图书馆参考资料。对于系统管理员，您可以使用的一些库是，仅举几例

1.  shutil（移动/复制文件）
2.  os 例如 os.walk() -> 查找文件的递归目录
    os.path.join() -> 加入文件路径
    os.getmtime(), os.getatime() -> 文件时间戳
    os.remove(), os.removedirs () -> 删除文件
    os.rename() -> 重命名文件 .. 还有更多...请参阅帮助（os）了解更多操作系统内容...
3.  系统
4.  ftplib, telnetlib --> 用于文件传输和远程登录...
5.  glob() -> 文件通配符，通配​​符
6.  re -> 正则表达式，如果你需要使用它。（但它不是必需的）
7.  paramiko -> SSH，如果你想使用安全外壳
8.  socket -> 套接字库，如果你需要做网络的话....
9.  大多数情况下，作为系统管理员，您将需要读/写文件，因此请了解这样做

10.  a) 使用 for 循环

    ```
     for line in open("file"):
         print line 
    ```

11.  b) 带有文件句柄

    ```
     f=open("file")
      for line in f:
         print line
      f.close() 
    ```

12.  c) 使用 while 循环

    ```
     f=open("file")
      while 1:
          line=f.readline()
          if not line: break
          print line
      f.close() 
    ```

13.  datetime, time -> 处理日期和时间，例如计算多少天或两个日期之间的差异等

14.  fileinput -> 用于就地编辑文件。

15.  md5 或 hashlib -> 计算哈希摘要/md5 例如查找重复文件...

当然，还有更多，但我留给你去探索。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-05T11:54:40.397

Mark Pilgrim 的[http://www.diveintopython.net/](http://www.diveintopython.net/)很好很清晰。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-05T17:32:29.967

+1 用于[Dive into Python](http://www.diveintopython.net)和 Python in a Nutshell。我也强烈推荐 effbot 的[标准库指南](http://effbot.org/zone/librarybook-index.htm)。您可能还想查看[Python Cookbook](https://rads.stackoverflow.com/amzn/click/com/0596007973)以获取一些惯用 Python 代码的好示例。查看[《Python 网络基础》](https://rads.stackoverflow.com/amzn/click/com/1590593715)，了解 SysAdmin 书籍在网络协议方面的遗漏之处（仅供参考：所有 APress 书籍都以 PDF 格式提供，我很喜欢）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-05T11:55:17.447

如果你不懂 Python，你可以从这里开始：[Dive into Python](http://www.diveintopython.net/)（如果你懂一点编码的话）。这是一个免费下载。Python.org 上的[Python 教程](http://docs.python.org/tutorial/)也很不错，我主要是从这里学到的，然后是 Dive into Python。您也可以从观看此[Google Tech Talk 视频](http://video.google.com/videoplay?docid=1135114630744003385&ei=JanoSO2JN4KM-QHv2-3IBg&q=engedu+python)开始。标题说 Python 适合程序员，但它仍然很有帮助。一旦你知道了这一点，据我所知，你提到的用于 Unix 和 Linux 系统管理的 Python 是一个非常好的和足够的。我强烈建议您在深入了解使用 Python 进行系统管理的细节之前先了解它的基础知识。

快乐的蟒蛇。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-05T16:10:54.077

我想你会想在你的书架上简单地包含[Python 。](http://oreilly.com/catalog/9780596001889/)优秀的、详尽的参考资料，作者 Alex Martelli。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-07-19T11:10:36.430

[《Python入门：从新手到专业](http://apress.com/book/view/9781590599822)》是一本很棒的书。我可以推荐它。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-05T12:05:11.623

我也是从 python.org 上的 Python 教程开始的，它让我开始得相当快，之后我正在阅读 O'Reilly 的 Programming Python。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-08-28T04:22:43.623

我从 Mark Lutz 的 Programming Python (O'Reilly) 开始。

# asp.net - 在 UpdatePanel 中使用 ASP.NET FileUpload 控件时出现问题？

> ID：171840
> 
> 赞同：5
> 
> 时间：2008-10-05T11:33:34.603
> 
> 标签：asp.net, ajax, file

我遇到了一个问题，我在 UpdatePanel 中有一个 FileUpload 控件。当我尝试保存更改并上传文件时，找不到文件。如果我删除 UpdatePanel 一切似乎工作正常。

任何想法为什么会发生这种情况？有解决方法吗？

![截屏](https://farm4.static.flickr.com/3086/2914877750_0a68e10ffd.jpg?v=0)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-05T11:46:21.147

要上传文件，您需要执行完整的 ASP.NET 页面回发，它不会通过部分回发方法进行操作。

您需要将“上传”文件的按钮注册为 UpdatePanel 触发器的 PostBackTrigger。

有很多免费（和非免费）的 AJAX 文件上传解决方案，或者您可以轻松创建一个，只需将文件上传控件放在 iframe 中并将 iframe 页面提交回服务器即可。它不是*真正*的 ajax，但它给人一种 AJAX 的视觉印象。

# xml - Excel 2003 XML 格式 - AutoFitWidth 不起作用

> ID：171849
> 
> 赞同：12
> 
> 时间：2008-10-05T11:49:10.203
> 
> 标签：xml, excel, openxml

我有一个程序可以输出 Excel 2003 XML 格式的 Excel 工作簿。它可以很好地解决一个问题，我无法自动设置列宽。

我制作的片段：

```
 <Table >
   <Column ss:AutoFitWidth="1" ss:Width="2"/>
   <Row ss:AutoFitHeight="0" ss:Height="14.55">
    <Cell ss:StyleID="s62"><Data ss:Type="String">Database</Data></Cell> 
```

这不会将列设置为自动调整。我试过不设置宽度，我尝试了很多东西，但我被卡住了。

谢谢。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-10-05T14:22:21.533

只有日期和数字值是自动调整的 :-( quote: "... We do not autofit textual values"

[http://msdn.microsoft.com/en-us/library/aa140066.aspx#odc_xmlss_ss:column](http://msdn.microsoft.com/en-us/library/aa140066.aspx#odc_xmlss_ss:column)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-11-11T17:17:21.157

在传递给 XML 之前获取您的字符串长度并构造 ss:Width="length"。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-09-25T19:12:33.933

Autofit 不适用于带有字符串的单元格。尝试用以下代码替换示例中的 Column-line：

```
 <xsl:for-each select="/*/*[1]/*">
      <Column>
        <xsl:variable name="columnNum" select="position()"/>
        <xsl:for-each select="/*/*/*[position()=$columnNum]">
          <xsl:sort select="concat(string-length(string-length(.)),string-length(.))" order="descending"/>
          <xsl:if test="position()=1">
            <xsl:if test="string-length(.) &lt; 201">
              <xsl:attribute name="ss:Width">
                <xsl:value-of select="5.25 * (string-length(.)+2)"/>
              </xsl:attribute>
            </xsl:if>
            <xsl:if test="string-length(.) &gt; 200">
              <xsl:attribute name="ss:Width">
                <xsl:value-of select="1000"/>
              </xsl:attribute>
            </xsl:if>
          </xsl:if>
          <xsl:if test = "local-name() = 'Sorteer'">
            <xsl:attribute name="ss:Width">
              <xsl:value-of select="0"/>
            </xsl:attribute>
          </xsl:if>
        </xsl:for-each>
      </Column>
    </xsl:for-each> 
```

说明：它按字符串长度排序（最长的字符串优先），取第一行排序的字符串，取该字符串的长度 * 5.25，你将有一个合理的自动调整。

分拣线：

```
 <xsl:sort select="concat(string-length(string-length(.)),string-length(.))" order="descending"/> 
```

解释：如果你只是按长度排序，比如

```
 <xsl:sort select="string-length(.)" order="descending"/> 
```

因为长度是作为字符串处理的，所以 2 在 10 之后，这是您不想要的。所以你应该左填充长度以使其正确排序（因为 002 在 010 之前）。但是，由于我找不到该填充功能，我通过将长度的长度与长度连接来解决它。长度为 100 的字符串将被转换为 3100（第一个数字是长度的长度），您将看到解决方案将始终正确地进行字符串排序。例如：2 将是“12”，10 将是“210”，所以这将是正确的字符串排序。只有当length的长度> 9时才会出现问题，但是Excel无法处理长度为100000000的字符串。

的解释

```
 <xsl:if test="string-length(.) &lt; 201">
              <xsl:attribute name="ss:Width">
                <xsl:value-of select="5.25 * (string-length(.)+2)"/>
              </xsl:attribute>
            </xsl:if>
            <xsl:if test="string-length(.) &gt; 200">
              <xsl:attribute name="ss:Width">
                <xsl:value-of select="1000"/>
              </xsl:attribute>
            </xsl:if> 
```

我想将字符串的长度最大化到大约 200，但我无法让 Min 函数工作，比如

```
 <xsl:value-of select="5.25 * Min((string-length(.)+2),200)"/> 
```

所以我不得不用肮脏的方式来做。

我希望你现在可以自动调整！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-07-10T15:32:07.953

我知道这篇文章很旧，但是如果有人仍在使用 openXml，我将使用我编写的解决方案对其进行更新。它适用于大文件和小文件。

该算法在vb中，它需要一个arraylist of arraylist of string（可根据需要更改）来实现一个excel数组。

我使用 Windows 窗体来查找渲染文本的宽度，以及仅选择最大单元格的链接（以提高大文件效率）

那里：

```
Dim colsTmp as ArrayList '(of Arraylist(of String))
Dim cols as Arraylist '(of Integer) Max size of cols
'Whe populate the Arraylist
Dim width As Integer
'For each column
For i As Integer = 0 To colsTmp.Count - 1
    'Whe sort cells by the length of their String
    colsTmp(i) = (From f In CType(colsTmp(i), String()) Order By f.Length).ToArray
    Dim deb As Integer = 0
    'If they are more than a 100 cells whe only take the biggest 10%
    If colsTmp(i).length > 100 Then
        deb = colsTmp(i).length * 0.9
    End If
    'For each cell taken
    For j As Integer = deb To colsTmp(i).length - 1
        'Whe messure the lenght with the good font and size
        width = Windows.Forms.TextRenderer.MeasureText(colsTmp(i)(j), font).Width
        'Whe convert it to "excel lenght"
        width = (width / 1.42) + 10
        'Whe update the max Width
        If width > cols(i) Then cols(i) = width
    Next
Next 
```

# macos - 在 osx 上检测卷的出现/消失

> ID：171855
> 
> 赞同：1
> 
> 时间：2008-10-05T11:53:12.583
> 
> 标签：macos, volume, device, iokit, diskarbitration

我想在用户插入 USB 密钥、添加外部磁盘和挂载磁盘映像时更新存储设备列表。IOKit 的 IOServiceAddInterestNotification 看起来像是要走的路，但是在 kIOMediaClass 中注册一般兴趣的明显用途只会给你通知卸载卷，然后只是有时。

这样做的正确方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-11T21:35:33.343

DiskArbitration.h 中的以下调用正是我想要的：

*   `DARegisterDiskAppearedCallback`
*   `DARegisterDiskDisappearedCallback`
*   `DARegisterDiskDescriptionChangedCallback`

这些包括插入、删除（甚至是不可安装的卷）
元数据更改事件。

PS不要忘记将您添加`DASession`到运行循环
，否则您将不会收到任何回调。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-01-09T14:57:50.220

> 我想在用户插入 USB 密钥、添加外部磁盘和挂载磁盘映像时更新存储设备列表。

我可以通过这段代码得到三分之二，我想这不需要更多的工作来给你第三个。

```
File:               USBNotificationExample.c

Description:        This sample demonstrates how to use IOKitLib and IOUSBLib to set up asynchronous
                    callbacks when a USB device is attached to or removed from the system.
                    It also shows how to associate arbitrary data with each device instance. 
```

[http://opensource.apple.com/source/IOUSBFamily/IOUSBFamily-385.4.1/Examples/Another%20USB%20Notification%20Example/USBNotificationExample.c](http://opensource.apple.com/source/IOUSBFamily/IOUSBFamily-385.4.1/Examples/Another%20USB%20Notification%20Example/USBNotificationExample.c)

我个人使用（此代码的稍微修改的副本）很长时间来监视 USB 硬盘的连接。

正如您从这个小样本中看到的那样，它很容易被证明适用于监控已安装的驱动器。或者它可能不会。YMMV。

```
 matchingDict = IOServiceMatching(kIOUSBDeviceClassName);        // Interested in instances of class
                                                                    // IOUSBDevice and its subclasses 
```

当它匹配时

```
void DeviceAdded(void *refCon, io_iterator_t iterator)
{
    kern_return_t           kr;
    io_service_t            usbDevice;
    IOCFPlugInInterface     **plugInInterface=NULL;
    SInt32                  score;
    HRESULT                 res;    

    while ( (usbDevice = IOIteratorNext(iterator)) )
    {
        io_name_t                   deviceName;
        CFStringRef                 deviceNameAsCFString;
        MyPrivateData               *privateDataRef = NULL;
        UInt32                      locationID;

        printf("Device 0x%08x added.\n", usbDevice); 
```

等等，等等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-05T13:32:14.287

观察`/Volumes`变化会满足你的需要吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-12-30T14:36:43.360

如果您恰好在 Cocoa 级别工作，您还可以注册以接收来自[NSWorkspace](http://developer.apple.com/documentation/Cocoa/Reference/ApplicationKit/Classes/NSWorkspace_Class/)的以下通知：

*   NSWorkspaceDidMountNotification
*   NSWorkspaceDidRenameVolumeNotification
*   NSWorkspaceWillUnmountNotification
*   NSWorkspaceDidUnmountNotification

# c++ - C++ 中的命名空间和运算符重载

> ID：171862
> 
> 赞同：38
> 
> 时间：2008-10-05T11:58:04.850
> 
> 标签：c++, operator-overloading, namespaces

在特定命名空间中编写库时，为该命名空间中的类提供重载运算符通常很方便。似乎（至少在 g++ 中）重载的运算符可以在库的命名空间中实现：

```
namespace Lib {
class A {
};

A operator+(const A&, const A&);
} // namespace Lib 
```

或全局命名空间

```
namespace Lib {
class A {
};
} // namespace Lib

Lib::A operator+(const Lib::A&, const Lib::A&); 
```

根据我的测试，它们似乎都运行良好。这两个选项之间有什么实际区别吗？哪种方法更好？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-10-05T12:03:24.857

您应该在库名称空间中定义它们。编译器无论如何都会通过参数相关查找找到它们。

无需污染全局命名空间。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-05T12:21:18.487

由于[Koenig lookup](http://en.wikipedia.org/wiki/Argument_dependent_name_lookup) ，将其放入库命名空间是可行的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-05T12:20:24.183

您应该在命名空间中定义它，因为语法不会那么冗长，而且不会使全局命名空间混乱。

实际上，如果您在类定义中定义重载，这将成为一个没有实际意义的问题：

```
namespace Lib {

class A {
public:
    A operator+(const A&);
};

} // namespace Lib 
```

# database - 如何查找和跟踪 Oracle 警报日志

> ID：171868
> 
> 赞同：7
> 
> 时间：2008-10-05T12:03:08.197
> 
> 标签：database, perl, oracle, bash

当您第一次查看 Oracle 数据库时，第一个问题通常是“警报日志在哪里？”。网格控制可以告诉您，但它通常在环境中不可用。

一段时间前，我发布了一些 bash 和 Perl 脚本来查找和跟踪[我博客上](http://tardate.blogspot.com/2007/04/find-and-tail-oracle-alert-log.html)的警报日志，我很惊讶地看到该帖子仍然获得了很多点击。

使用的技术是从 v$parameter 中查找 background_dump_dest。但我只在 Oracle 数据库 10g 上测试过这个。

还有比这更好的方法吗？有谁知道这在 11g 中是否仍然有效？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-05T12:04:18.473

确信它会在 11g 中工作，该参数已经存在了很长时间。

对我来说似乎是找到它的正确方法。

如果未设置 background_dump_dest 参数，alert.log 将被放入 $ORACLE_HOME/RDBMS/trace

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-06T00:56:28.260

打开日志后，我会考虑使用[File::Tail](http://search.cpan.org/perldoc?File::Tail)或[File::Tail::App](http://search.cpan.org/perldoc?File::Tail::App)在写入时显示它，而不是休眠和阅读。 `File::Tail::App`特别聪明，因为它会检测到文件被旋转和切换，并且会记住你在程序调用之间的位置。

我还考虑在使用它之前锁定你的缓存文件。竞争条件可能不会打扰您，但是让多个人尝试同时启动您的程序可能会导致争吵谁可以写入缓存文件。

然而，这两个都是挑剔的。我对您的代码的简短浏览并没有发现任何明显的错误。

# arrays - KSH 脚本：当值已转义逗号时，如何拆分“，”？

> ID：171873
> 
> 赞同：1
> 
> 时间：2008-10-05T12:07:03.477
> 
> 标签：arrays, shell, ksh, quoting

我尝试编写 KSH 脚本来处理由名称-值对组成的文件，每行有几个。

格式为：

```
NAME1 VALUE1,NAME2 VALUE2,NAME3 VALUE3, etc 
```

假设我写：

```
read l
IFS=","
set -A nvls $l
echo "$nvls[2]" 
```

这将给我第二个名称-值对，既好又简单。现在，假设任务已扩展，因此值可以包含逗号。他们应该被逃脱，像这样：

```
NAME1 VALUE1,NAME2 VALUE2_1\,VALUE2_2,NAME3 VALUE3, etc 
```

显然，我的代码不再有效，因为“读取”会删除所有引用，并且数组的第二个元素将只是“NAME2 VALUE2_1”。

我被没有“read -A array”的旧 ksh 卡住了。我用“read -r”和“eval set -A ....”尝试了各种技巧，但无济于事。我不能使用“read nvl1 nvl2 nvl3”在读取中进行转义和拆分，因为我事先不知道每行中有多少个名称-值对。

有人对我有用吗？

PS 我知道我在 Perl、Python 甚至 awk 中都在短时间内完成了这项工作。但是，我必须在 ksh 中执行此操作（...或死去尝试；）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-05T13:06:03.093

正如经常发生的那样，我在公共论坛提出问题后几分钟就得到了答案:(

我通过以下 sed 脚本管道输入文件来解决引用/取消引用问题：

```
sed -e 's/\([^\]\),/\1\
/g;s/$/\
/ 
```

它将输入转换为：

```
NAME1.1 VALUE1.1
NAME1.2 VALUE1.2_1\,VALUE1.2_2
NAME1.3 VALUE1.3
<empty line>
NAME2.1 VALUE2.1
<second record continues> 
```

现在，我可以像这样解析这个输入：

```
while read name value ; do
  echo "$name => $value"
done 
```

值的逗号将不被“读取”引用，如果我愿意，我可以将“名称”和“值”填充到某个关联数组中。

PS既然我不能接受自己的答案，我应该删除问题，还是......？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T02:54:06.837

您还可以将`\,`模式更改为其他已知不会出现在任何字符串中的模式，然后在将输入拆分为数组后将其更改回来。您可以使用 ksh 内置模式替换语法来执行此操作，您不需要使用 sed 或 awk 或任何东西。

```
read l
l=${l//\\,/!!}
IFS=","
set -A nvls $l
unset IFS
echo ${nvls[2]/!!/,} 
```

# database - 两阶段提交如何防止最后一秒的失败？

> ID：171876
> 
> 赞同：85
> 
> 时间：2008-10-05T12:12:06.710
> 
> 标签：database, distributed-transactions

我正在研究两阶段提交如何跨分布式事务工作。据我了解，在该阶段的最后一部分，事务协调器会询问每个节点是否准备好提交。如果每个人都同意，那么它会告诉他们继续并承诺。

是什么阻止了以下失败？

1.  所有节点都响应他们准备好提交
2.  事务协调器告诉他们“继续并提交”，但其中一个节点在收到此消息之前崩溃
3.  所有其他节点都成功提交，但现在分布式事务已损坏
4.  据我了解，当崩溃的节点回来时，它的事务将被回滚（因为它从未收到提交消息）

我假设每个节点都在运行一个对分布式事务一无所知的普通数据库。我错过了什么？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-10-05T12:23:35.330

不，他们没有被指示回滚，因为在原始发布者的场景中，一些节点已经提交。发生的情况是当崩溃的节点变得可用时，事务协调器告诉它再次提交。

因为节点在“准备”阶段做出了积极响应，所以它需要能够“提交”，即使它从崩溃中恢复。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-02-13T03:49:45.453

总结一下大家的答案：

1.  不能将普通数据库与分布式事务一起使用。数据库必须明确支持事务协调器。

2.  没有指示节点回滚，因为一些节点已经提交。发生的情况是，当崩溃的节点返回时，事务协调器告诉它完成提交。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-10-05T12:19:25.247

不，第 4 点不正确。每个节点在稳定的存储中记录它能够提交或回滚事务，因此即使在崩溃时它也能够按照命令执行。当崩溃的节点重新启动时，它必须意识到它有一个处于预提交状态的事务，恢复任何相关的锁或其他控制，然后尝试联系协调器站点以收集事务的状态。

只有当崩溃的节点永远不会恢复时才会出现问题（然后其他一切都认为事务正常，或者当崩溃的节点恢复时）。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-10-05T12:22:15.537

两阶段提交并不是万无一失的，它只是被设计为在 99% 的情况下工作。

“该协议假设每个节点都有一个带有预写日志的稳定存储，没有节点永远崩溃，预写日志中的数据永远不会在崩溃中丢失或损坏，并且任何两个节点都可以通信彼此。”

[http://en.wikipedia.org/wiki/Two-phase_commit_protocol](http://en.wikipedia.org/wiki/Two-phase_commit_protocol)

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-10-05T12:43:34.230

有很多方法可以解决两阶段提交的问题。几乎所有这些都是 Paxos 三阶段提交算法的变体。在 Google 设计基于 Paxos 的 Chubby 锁服务的 Mike Burrows 在我看到的一次讲座中说，有两种类型的分布式提交算法——“Paxos 和不正确的”。

当崩溃的节点重新唤醒时，它可以做的一件事是说“我从未听说过这个事务，它应该被提交吗？” 给协调员，它会告诉它投票是什么。

请记住，这是一个更普遍问题的示例：崩溃的节点在恢复之前可能会错过许多事务。因此，非常重要的是，在恢复后，它应该与协调器或另一个副本通信，然后再使其可用。如果节点本身无法判断它是否已经崩溃，那么事情就会变得更加复杂，但仍然可以处理。

如果您使用仲裁系统进行数据库读取，则不一致性将被屏蔽（并使数据库本身知道）。

# directory - 不使用映射驱动器浏览目录

> ID：171878
> 
> 赞同：1
> 
> 时间：2008-10-05T12:14:57.733
> 
> 标签：directory, mapped-drive

是否有应用程序或方法可以在不使用映射驱动器的情况下浏览需要不同登录凭据的目录？

问题在于一个登录凭据 Windows Explorer 仅允许您将其映射到一个驱动器，并且不允许使用相同的登录凭据映射到不同的驱动器。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-05T12:31:12.007

据我所知，您不能将驱动器映射到具有不同用户名和密码的另一个映射驱动器在同一服务器上的一个用户名/密码的共享文件夹。

如果您以编程方式执行此操作，则可以将多个凭据添加到凭据缓存中，这将允许您使用多个权限集授权自己。

我一直能够使用相同的用户名和密码将驱动器映射到两个不同的服务器。

例如

```
net use x: \\server1\shareFolder /user:domain\username
net use y: \\server2\shareFolder /user:domain\username 
```

如果您希望将网络共享映射为当前用户，则可以省略 /user 部分。

只要您有足够的驱动器号，您就可以在不同的机器上拥有任意数量的网络驱动器。

或者，您可以使用 unc 路径 \server1\share1 和 \server2\share1，如果您当前未登录的用户名和密码没有访问权限，窗口将提示您输入用户名和密码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-05T13:41:20.323

这根本不是真的……您可以使用相同的登录凭据对多个服务器进行身份验证。你不能做的是：

*   自动向第二台服务器进行身份验证
*   使用不同的凭据连接到同一台服务器

我的理解是，这两个问题的原因是 Windows[按服务器名称存储凭据](http://support.microsoft.com/kb/938120/en-us)。

# orm - 使用 db4o 的示例网站

> ID：171892
> 
> 赞同：4
> 
> 时间：2008-10-05T12:26:17.633
> 
> 标签：orm, enterprise, db4o, object-oriented-database

我对 db4o 的初始测试印象深刻。但是，我想知道有多少企业级网站由 db4o 提供支持，我在主网站上看不到任何内容？

我看不出不应该使用 db4o 的任何原因。例如，似乎对事务和处理并发的方式有足够的支持。

谁有我可以看的网站列表？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-13T06:11:04.317

一个特定的搜索引擎曾经由 db4o 提供支持（我说“曾经”是因为我很长时间没有与作者谈论过这个）。

[http://www.rel8r.com/](http://www.rel8r.com/)

作者是特拉维斯·里德。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-02-05T17:08:16.370

看：

[http://developer.db4o.com/Projects/html/projectspaces/gaabormarkt.html](http://developer.db4o.com/Projects/html/projectspaces/gaabormarkt.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-05T13:03:00.180

虽然我看不到具体的网站，但这里是来自 db4o 网站的开源项目列表：

[http://developer.db4o.com/ProjectSpaces/view.aspx/Open_Source_Products](http://developer.db4o.com/ProjectSpaces/view.aspx/Open_Source_Products)

# file - 使用多个标准对项目进行分组的最佳通用策略

> ID：171899
> 
> 赞同：7
> 
> 时间：2008-10-05T12:30:24.427
> 
> 标签：file, directory-structure

我有一个简单的现实生活问题，我想使用 OO 方法来解决。**我的硬盘一团糟。**我有 1.500.000 个文件、重复文件、完整的重复文件夹等等......

当然，第一步是将所有文件解析到我的数据库中。到目前为止没有问题，现在我得到了很多不错的条目，它们是“自然分组”的。可以使用简单的查询来获得这种简单分组的示例，例如：

1.  给我所有大于 100MB 的文件
2.  显示所有超过 3 天的文件
3.  获取所有以 docx 结尾的文件

但是现在假设我想找到具有更自然意义的组。对此有不同的策略，具体取决于“用例”。

假设我有一个坏习惯，将所有下载的文件首先放在桌面上。然后我将它们解压缩到适当的文件夹，而不总是删除 ZIP 文件。我将它们移到“阁楼”文件夹中。对于系统而言，要找到这组文件，一种**面向时间的**搜索方法，也许结合“检查 ZIP 是否相同然后文件夹 X”将是合适的。

假设另一个复制文件的坏习惯，有一些“干净文件”位于**结构良好**的文件夹，以及另一个**凌乱的文件夹**。现在我的干净文件夹有 20 个图片库，我凌乱的文件夹有 5 个重复的和 1 个新的画廊。人类用户可以通过看到“哦，这都是重复的，那是一个新的，所以我将新的放在干净的文件夹中并丢弃所有重复的”来轻松识别此逻辑。

**所以，现在进入正题：**

您将使用哪种策略或模式组合来解决这种情况。如果我链接过滤器，“最难”的将获胜，我不知道如何让系统“测试”合适的组合。在我看来，这不仅仅是过滤。其动态分组通过组合多个标准来找到“最佳”组。

一种非常粗略的方法是：

1.  一开始，所有文件都是平等的
2.  第一个，不是那么“好”的组是目录
3.  如果您是一个大而干净的目录，您可以获得积分（均匀分布的名称）
4.  如果所有文件的创建日期相同，您可能会被“自动创建”
5.  如果你是 Program-Files 的孩子，我根本不在乎你
6.  如果我将 A 组的你移到 C 组，这会提高“熵”吗

适合这种情况的最佳模式是什么。策略，过滤器和管道，“分组”.. 欢迎任何评论！

**编辑以回应答案：**

**标记方法：** 当然，我想到了标记。但是我在哪里画线。我可以创建不同的标签类型，例如 InDirTag、CreatedOnDayXTag、TopicZTag、AuthorPTag。这些标签可以按层次结构构建，但如何分组的问题仍然存在。但我会考虑一下并在这里添加我的见解..

**拖延评论：** 是的，听起来是这样。但这些文件只是我能想到的最简单的例子（也是目前最相关的例子）。它实际上是以动态方式对相关数据进行分组的大局的一部分。也许我应该保持更抽象，强调这一点：我**不是在寻找**文件标记**工具**或搜索引擎，**而是解决这个问题的算法或模式**......（或者更好的想法，比如标记）

克里斯

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-05T13:40:32.523

你在[拖延](http://en.wikipedia.org/wiki/Procrastination)。停下来，清理你的烂摊子。如果它真的很大，我推荐以下策略：

1.  将驱动器上的所有内容复制到外部磁盘（USB 或其他）上
2.  全新安装您的系统
3.  一旦你发现你需要一些东西，从你的副本中获取它，并将它放在一个明确定义的位置
4.  6 个月后，丢弃您的外部驱动器。那里的任何东西都不可能那么重要。

您还可以安装 Google 桌面，它不会清理您的烂摊子，但至少可以让您有效地搜索它。

如果你想防止这种情况在未来发生，你必须改变你在计算机上组织事物的方式。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-05T13:40:22.600

我没有解决方案（并且很想看到一个），但我可能会建议从您的文件中提取元数据，除了明显的名称、大小和时间戳。

*   带内元数据，例如 MP3 ID3 标签、EXE / DLL 的版本信息、HTML 标题和关键字、Office 文档的摘要信息等。甚至图像文件也可以包含有趣的元数据。如果查找重复项，整个内容的哈希值会有所帮助。
*   带外元数据，例如可以存储在 NTFS 备用数据流中 - 例如。您可以在非 Office 文件的“摘要”选项卡中编辑的内容
*   如果您可以阅读，您的浏览器会保存您从何处下载文件的信息（尽管 Opera 不会保存很长时间）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-05T13:57:10.400

你发烧了，唯一的处方就是标签云！您仍然需要清理内容，但使用[TaggCloud](http://www.taggtool.com/index.php)或[Tag2Find](http://www.tag2find.com)等工具，您可以按元数据而不是驱动器上的位置来组织文件。Tag2Find 将监视共享，当任何内容保存到共享时，会出现一个弹出窗口并要求您标记文件。

您还应该获得 Google 桌面。

# c++ - 现代编译器在 C++ 中的“memset”功能状态

> ID：171917
> 
> 赞同：19
> 
> 时间：2008-10-05T12:46:16.220
> 
> 标签：c++, c, optimization, memory

## 语境：

不久前，我偶然发现了 Alexandrescu 在 2001 年发表的这篇 DDJ 文章： [http ://www.ddj.com/cpp/184403799](http://www.ddj.com/cpp/184403799)

它是关于比较将缓冲区初始化为某个值的各种方法。就像“memset”对单字节值所做的一样。他比较了各种实现（memcpy、显式“for”循环、duff 的设备），并没有真正找到跨越所有数据集大小和所有编译器的最佳候选者。

引用：

> 这一切背后都有一个非常深刻和悲伤的认识。我们是在 2001 年，空间奥德赛之年。(...) 跳出框框看看我们——50 年后，我们仍然不擅长填充和复制记忆。

## 问题：

1.  有没有人有关于这个问题的最新信息？最近的 GCC 和 Visual C++ 实现的性能是否明显优于 7 年前？
2.  我正在编写生命周期为 5 年以上（可能 10 年以上）的代码，它将处理从几个字节到数百兆字节的数组大小。我不能假设我现在的选择在 5 年后仍然是最优的。我应该怎么办：
    *   a) 使用系统的 memset（或等效项）并忘记最佳性能，或者假设运行时和编译器会为我处理这个问题。
    *   b) 对各种数组大小和编译器一劳永逸地进行基准测试，并在运行时在多个例程之间切换。
    *   c) 在程序初始化时运行基准测试，并在运行时根据准确的 (?) 数据进行切换。

编辑：我正在研究图像处理软件。我的数组项是 POD，每毫秒都很重要！

编辑2：感谢第一个答案，这里有一些附加信息：

*   缓冲区初始化可能占某些算法总运行时间的 20%-40%。
*   该平台在未来 5 年以上可能会发生变化，尽管它将保持在“可以从 DELL 购买的最快 CPU”类别中。编译器将是某种形式的 GCC 和 Visual C++。雷达上没有嵌入的东西或异国情调的架构
*   我想听听那些在 MMX 和 SSE 出现时必须更新软件的人的意见，因为当“SSE2015”可用时我也必须这样做...... :)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-05T12:58:45.010

DDJ 文章承认 memset 是最好的答案，而且比他试图实现的要快得多：

> C 的内存操作函数 memset、memcpy 和 memcmp 有一些神圣不可侵犯的地方。编译器供应商可能对它们进行了高度优化，以至于编译器可能会检测到对这些函数的调用并用内联汇编指令替换它们——MSVC 就是这种情况。

因此，如果 memset 适合您（即您正在使用单个字节进行初始化），那么请使用它。

虽然每毫秒都可能很重要，但您应该确定在设置内存方面浪费了多少执行时间。考虑到您还有有用的工作要做，它可能非常低（1% 或 2%？？）。鉴于优化工作可能会在其他地方获得更好的回报率。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-05T19:19:55.023

[MASM 论坛](http://www.masm32.com/board/index.php)有很多令人难以置信的汇编语言程序员/爱好者，他们已经彻底解决了这个问题（看看实验室）。结果很像 Christopher 的回答：SSE 对于大的、对齐的缓冲区来说是不可思议的，但是向下你最终会达到如此小的大小，以至于基本`for`循环也一样快。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-05T13:53:19.767

Memset/memcpy 主要是在考虑基本指令集的情况下编写的，因此可以被专门的 SSE 例程超越，另一方面，它会强制执行某些对齐约束。

但要将其简化为列表：

1.  对于 <= 几百千字节的数据集，memcpy/memset 的执行速度比您可以模拟的任何东西都快。
2.  对于 > 兆字节的数据集，使用 memcpy/memset 的组合来获得对齐，然后使用您自己的 SSE 优化例程/回退到来自英特尔等的优化例程。
3.  在启动时强制对齐并使用您自己的 SSE 例程。

此列表仅适用于您需要性能的事物。太小/或一旦初始化的数据集不值得麻烦。

[这](http://cdrom.amd.com/devconn/memcpy_amd.zip)是 AMD 的 memcpy 实现，我找不到描述代码背后概念的文章。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-05T12:48:37.947

d) 接受尝试在初始化时玩“绝地思维技巧”会导致程序员损失更多的时间，而不是一些晦涩但快速的方法与一些明显而清晰的方法之间的累积毫秒差异。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-05T13:26:22.083

这取决于你在做什么。如果您有一个非常具体的案例，您通常可以大大优于 memset 和 memcpy 的系统 libc（和/或编译器内联）。

例如，对于我正在处理的程序，我编写了一个 16 字节对齐的 memcpy 和 memset，专为小数据大小而设计。memcpy 仅适用于大于或等于 64 的 16 倍数（数据与 16 对齐），memset 仅适用于 128 倍数。这些限制让我获得了极大的速度，并且由于我控制了应用程序，我可以根据需要专门定制功能，还可以定制应用程序以对齐所有必要的数据。

memcpy 的执行速度大约是 Windows 原生 memcpy 的 8-9 倍，将 460 字节的副本缩短到仅 50 个时钟周期。memset 快了大约 2.5 倍，以极快的速度填充零堆栈数组。

如果您对这些功能感兴趣，可以在[这里](http://git.videolan.org/?p=x264.git;a=blob;f=common/x86/mc-a2.asm;h=c6c8221a4f87665d29937bed9f91239b9d83f72e;hb=cc510478de710f86ab400f610b6e075304d902cb)找到它们；对于 memcpy 和 memset，下拉到第 600 行左右。它们相当琐碎。请注意，它们是为应该在缓存中的小缓冲区而设计的；如果您想在绕过缓存的同时初始化内存中的大量数据，您的问题可能会更复杂。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-05T18:51:48.230

您可以查看 liboil，它们（尝试）提供相同功能的不同实现并选择最快的初始化。Liboil 拥有相当自由的许可证，因此您也可以将其用于专有软件。

[http://liboil.freedesktop.org/](http://liboil.freedesktop.org/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-06T08:19:37.850

As always with these types of questions, the problem is constrained by factors outside of your control, namely, the bandwidth of the memory. And if the host OS decides to start paging the memory then things get far worse. On Win32 platforms, the memory is paged and pages are only allocated on first use which will generate a big pause every page boundary whilst the OS finds a page to use (this may require another process' page to be paged to disk).

This, however, is the absolute fastest `memset` ever written:

```
void memset (void *memory, size_t size, byte value)
{
} 
```

Not doing something is always the fastest way. Is there any way the algorithms can be written to avoid the initial `memset`? What are the algorithms you're using?

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-05T13:06:00.160

好吧，这一切都取决于您的问题域和您的规范，您是否遇到过性能问题，未能满足时间期限并将 memset 确定为万恶之源？如果是这样，那么您是唯一一种可以考虑进行 memset 调整的情况。

那么你还应该记住，memset 无论如何都会在它所运行的平台上的硬件上有所不同，在这五年中，软件会在同一个平台上运行吗？在同一架构上？如果您得出这个结论，您可以尝试“滚动您自己的”memset，通常使用缓冲区的对齐方式，确保根据您的架构上性能最高的内容一次将 32 位值归零。

我曾经遇到过相同的 memcmpt 对齐开销导致一些问题的情况，通常这不会导致奇迹，如果有的话，只有很小的改进。如果您在数量级上缺少您的要求，那么这不会让您更进一步。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-05T13:44:53.217

如果内存不是问题，则预先创建所需大小的静态缓冲区，并初始化为您的值。据我所知，这两个编译器都在优化编译器，因此如果您使用简单的 for 循环，编译器应该生成最佳的汇编器命令来复制缓冲区。

如果内存有问题，请使用较小的缓冲区并将其在 sizeof(..) 偏移处复制到新缓冲区中。

高温高压

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-05T14:50:47.747

我总是会选择一种初始化方法，它是我正在使用的运行时或操作系统（memset）的一部分（更糟糕的情况是选择我正在使用的库的一部分）。

原因：如果您正在实现自己的初始化，您现在可能会得到一个稍微好一点的解决方案，但很可能在几年后运行时有所改善。而且您不想做与维护运行时的人一样的工作。

如果运行时的改进是微不足道的，那么所有这些都代表着。如果你在 memset 和你自己的初始化之间有一个数量级的差异，那么让你的代码运行是有意义的，但我真的怀疑这种情况。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-05T23:33:04.277

如果您必须分配内存并对其进行初始化，我会：

*   使用 calloc 代替 malloc
*   将我的默认值尽可能多地更改为零（例如：让我的默认枚举值为零；或者如果布尔变量的默认值为“真”，则将其逆值存储在结构中）

这样做的原因是 calloc 为您零初始化内存。虽然这将涉及归零内存的开销，但大多数编译器可能会高度优化此例程——通过调用 memcpy 比 malloc/new 更优化。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-06T14:35:44.533

这一年不再是 2001 年了。从那时起，出现了新版本的 Visual Studio。我花时间研究了其中的 memset。他们将 SSE 用于 memset（当然，如果可用）。如果您的旧代码是正确的，那么*统计*上 if 现在会更快。但是您可能会遇到不幸的情况。尽管我没有研究过代码，但我对 GCC 也有同样的期望。这是一个相当明显的改进，并且是一个开源编译器。*有人*会创建补丁。

# linux - 如何在不运行 Bash 脚本的情况下对其进行语法检查？

> ID：171924
> 
> 赞同：301
> 
> 时间：2008-10-05T12:51:25.120
> 
> 标签：linux, bash, unix, syntax, gnu

是否可以在不执行的情况下检查 bash 脚本语法？

使用 Perl，我可以运行`perl -c 'script name'`. bash 脚本是否有任何等效命令？

* * *

## 回答 #1

> 赞同：425
> 
> 时间：2008-10-05T12:55:00.523

```
bash -n scriptname 
```

也许一个明显的警告：这会验证语法，但不会检查您的 bash 脚本是否尝试执行不在您的路径中的命令，例如`ech hello`代替`echo hello`.

* * *

## 回答 #2

> 赞同：144
> 
> 时间：2013-10-24T17:55:18.517

时间改变一切。这是一个为 shell 脚本提供在线语法检查的[网站。](http://www.shellcheck.net)

我发现它检测常见错误非常强大。

![在此处输入图像描述](https://i.stack.imgur.com/21zpv.png)

### 关于壳牌检查

[ShellCheck](http://www.shellcheck.net/about.html)是用于 sh/bash 脚本的静态分析和 linting 工具。它主要专注于处理典型的初学者和中级语法错误和陷阱，其中 shell 只是给出一个神秘的错误消息或奇怪的行为，但它也报告了一些更高级的问题，其中极端情况可能导致延迟失败。

Haskell 源代码在 GitHub 上可用！

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2012-05-23T14:10:30.973

我还在我编写的每个 bash 脚本上启用了“u”选项，以便进行一些额外的检查：

```
set -u 
```

这将报告未初始化变量的使用情况，如以下脚本“check_init.sh”

```
#!/bin/sh
set -u
message=hello
echo $mesage 
```

运行脚本：

```
$ check_init.sh 
```

将报告以下内容：

> ./check_init.sh[4]：消息：未设置参数。

捕捉错别字非常有用

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2011-02-02T13:16:05.993

```
sh  -n   script-name 
```

运行这个。如果脚本中有任何语法错误，那么它会返回相同的错误消息。如果没有错误，那么它就会出现而不给出任何消息。您可以立即使用 进行检查`echo $?`，它将返回`0`确认成功，没有任何错误。

它对我很有效。我在 Linux 操作系统 Bash Shell 上运行。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2017-08-03T11:58:06.250

我实际上检查了当前目录中的所有 bash 脚本是否存在语法错误，而没有使用`find`工具运行它们：

**例子：**

`find . -name '*.sh' -print0 | xargs -0 -P"$(nproc)" -I{} bash -n "{}"`

如果要将其用于单个文件，只需使用文件名编辑通配符。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-01-17T10:41:34.497

null 命令 [冒号] 在调试以查看变量值时也很有用

```
set -x
for i in {1..10}; do
    let i=i+1
    : i=$i
done
set - 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2015-12-05T18:17:21.730

[IntelliJ IDEA](https://www.jetbrains.com/idea/)的[BashSupport 插件](https://plugins.jetbrains.com/plugin/4230?pr=idea)可以检查语法。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2021-02-13T01:52:48.527

仅用于**验证**语法：

> [shellcheck](https://www.shellcheck.net/) [程序路径]

**仅当语法通过时才运行**程序，因此调试语法和执行：

> [防壳](https://gitlab.com/es20490446e/shellproof)[programPath]

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-07-16T09:17:48.693

如果你需要一个变量中所有文件在一个目录中的有效性（git pre-commit hook，build lint script），你可以捕获“sh -n”或“bash -n”命令的stderr输出（见其他答案）在一个变量中，并有一个基于它的“if/else”

```
bashErrLines=$(find bin/ -type f -name '*.sh' -exec sh -n {} \;  2>&1 > /dev/null)
  if [ "$bashErrLines" != "" ]; then 
   # at least one sh file in the bin dir has a syntax error
   echo $bashErrLines; 
   exit; 
  fi 
```

根据您的需要将“sh”更改为“bash”

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2021-08-30T03:28:59.667

如果您启用语法检查，Bash shell 脚本将运行语法检查

```
set -o noexec 
```

如果你想关闭语法检查

```
set +o noexec 
```

# javascript - jquery-ui-dialog - 如何挂钩对话框关闭事件

> ID：171928
> 
> 赞同：192
> 
> 时间：2008-10-05T12:52:53.197
> 
> 标签：javascript, jquery, jquery-ui, modal-dialog, jquery-ui-dialog

我正在使用[`jquery-ui-dialog`](https://jqueryui.com/dialog/)插件

我正在寻找在某些情况下关闭对话框时刷新页面的方法。

有没有办法从对话框中捕获关闭事件？

我知道我可以在单击关闭按钮时运行代码，但这不包括用户使用转义或右上角的 x 关闭。

* * *

## 回答 #1

> 赞同：253
> 
> 时间：2008-10-05T13:42:54.967

我找到了！

您可以使用以下代码捕获关闭事件：

```
 $('div#popup_content').on('dialogclose', function(event) {
     alert('closed');
 }); 
```

显然，我可以用我需要做的任何事情来替换警报。
**编辑：**从 Jquery 1.7 开始，bind() 已变为 on()

* * *

## 回答 #2

> 赞同：201
> 
> 时间：2008-10-05T19:35:17.393

我相信您也可以在创建对话框时执行此操作（从我所做的项目中复制）：

```
dialog = $('#dialog').dialog({
    modal: true,
    autoOpen: false,
    width: 700,
    height: 500,
    minWidth: 700,
    minHeight: 500,
    position: ["center", 200],
    close: CloseFunction,
    overlay: {
        opacity: 0.5,
        background: "black"
    }
}); 
```

笔记`close: CloseFunction`

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2009-11-10T08:06:13.043

```
$("#dialog").dialog({
    autoOpen: false,
    resizable: false,
    width: 400,
    height: 140,
    modal: true, 
    buttons: {
        "SUBMIT": function() { 
        $("form").submit();
    }, 
        "CANCEL": function() { 
        $(this).dialog("close");
    } 
    },
    close: function() {
      alert('close');
    }
}); 
```

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2014-07-17T08:43:59.880

```
$( "#dialogueForm" ).dialog({
              autoOpen: false,
              height: "auto",
              width: "auto",
              modal: true,
                my: "center",
                at: "center",
                of: window,
              close : function(){
                  // functionality goes here
              }  
              }); 
```

对话框的“关闭”属性给出了相同的关闭事件。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2012-06-20T09:45:16.223

你也可以试试这个

```
$("#dialog").dialog({
            autoOpen: false,
            resizable: true,
            height: 400,
            width: 150,
            position: 'center',
            title: 'Term Sheet',
            beforeClose: function(event, ui) { 
               console.log('Event Fire');
            },
            modal: true,
            buttons: {
                "Submit": function () {
                    $(this).dialog("close");
                },
                "Cancel": function () {
                    $(this).dialog("close");
                }
            }
        }); 
```

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2011-07-19T17:59:36.337

这对我有用...

```
$('#dialog').live("dialogclose", function(){
   //code to run on dialog close
}); 
```

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2014-11-10T08:07:26.410

> 从 jQuery 1.7 开始，.on() 方法是将事件处理程序附加到文档的首选方法。

因为没有人真正使用 using 创建答案。`on()`而不是`bind()`我决定创建一个。

```
$('div#dialog').on('dialogclose', function(event) {
     //custom logic fired after dialog is closed.  
}); 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2016-11-24T10:57:37.047

在示例下添加选项“关闭”并执行您想要的内联函数

```
close: function(e){
    //do something
} 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-10-05T13:12:27.370

如果我了解您正在谈论的窗口类型，**$(window).unload()**（对于对话框窗口）不会给您所需的钩子吗？

（如果我误解了，并且您说的是通过 CSS 制作的对话框而不是弹出式浏览器窗口，那么关闭该窗口的**所有**方式都是您可以注册点击处理程序的元素。）

**编辑：**啊，我现在看到你在谈论 jquery-ui 对话框，它是通过 CSS 制作的。**您可以通过使用类ui-dialog-titlebar-close**为元素注册一个单击处理程序来挂钩关闭窗口的 **X。**

**也许更有用的是你告诉你如何快速解决这个问题。在显示对话框时，只需弹出打开 FireBug 并**检查**可以关闭窗口的元素。您将立即看到它们是如何定义的，并为您提供了注册点击处理程序所需的内容。**

**因此，要直接回答您的问题，我相信答案确实是“否”-没有可以挂钩的关闭事件，但是“是”-您可以很容易地挂钩所有关闭对话框并获得你想要什么。**

 *** * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-06-16T11:56:27.567

您可以尝试以下代码来捕获任何项目的关闭事件：页面、对话框等。

```
$("#dialog").live('pagehide', function(event, ui) {
      $(this).hide();
}); 
```

# vmware - 在“无头模式”下运行虚拟操作系统是什么意思？

> ID：171948
> 
> 赞同：28
> 
> 时间：2008-10-05T13:11:01.897
> 
> 标签：vmware, virtualization

我听说过很多关于新版 VMWare Fusion 如何在“无头模式”下运行虚拟操作系统的信息。

谷歌搜索清楚地表明其他虚拟化产品也具有类似的功能，但是，我无法找到一个很好的描述这实际上意味着什么？当你这样做时会发生什么？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-10-05T14:20:58.603

无头模式意味着虚拟机在后台运行，没有任何可见的前台元素（如 Vmware Fusion 应用程序）
您将看不到运行前端的屏幕；即屏幕/控制台将不可见，即使操作系统正在运行，并且通常必须通过 SSH 访问机器。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-05T13:12:23.920

对于任何感兴趣的人，您可以通过在 Terminal.app 中运行以下命令来激活 VMWare Fusion 中的无头模式

```
defaults write com.vmware.fusion fluxCapacitor -bool YES 
```

# java - Java有析构函数吗？

> ID：171952
> 
> 赞同：640
> 
> 时间：2008-10-05T13:12:25.450
> 
> 标签：java, garbage-collection, destructor, finalize

Java有析构函数吗？我似乎无法找到任何有关此的文档。如果没有，我怎样才能达到同样的效果？

为了使我的问题更具体，我正在编写一个处理数据的应用程序，并且规范说应该有一个“重置”按钮，可以将应用程序恢复到其刚启动的原始状态。但是，除非应用程序关闭或按下重置按钮，否则所有数据都必须是“实时的”。

通常作为 C/C++ 程序员，我认为这很容易实现。（因此我计划最后实现它。）我构建了我的程序，使所有“可重置”对象都在同一个类中，这样我就可以在按下重置按钮时销毁所有“活动”对象。

我在想如果我所做的只是取消引用数据并等待垃圾收集器收集它们，如果我的用户反复输入数据并按下重置按钮，会不会出现内存泄漏？我也在想，既然 Java 作为一门语言已经相当成熟，应该有一种方法可以防止这种情况发生或优雅地解决这个问题。

* * *

## 回答 #1

> 赞同：569
> 
> 时间：2008-10-05T13:17:15.533

因为 Java 是一种垃圾收集语言，所以您无法预测对象何时（或什至）会被销毁。因此，没有直接等效的析构函数。

有一个名为 的继承方法`finalize`，但这完全由垃圾收集器决定调用。因此，对于需要明确整理的类，约定是定义一个*close*方法并仅将 finalize 用于完整性检查（即，如果尚未调用*close则立即执行并记录错误）。*

最近有[一个问题引发了对 finalize 的深入讨论](https://stackoverflow.com/questions/158174/why-would-you-ever-implement-finalize)，所以如果需要的话应该提供更多的深度......

* * *

## 回答 #2

> 赞同：141
> 
> 时间：2011-12-02T03:25:14.493

查看[try-with-resources](http://docs.oracle.com/javase/tutorial/essential/exceptions/tryResourceClose.html)语句。例如：

```
try (BufferedReader br = new BufferedReader(new FileReader(path))) {
  System.out.println(br.readLine());
} catch (Exception e) {
  ...
} finally {
  ...
} 
```

这里不再需要的资源在`BufferedReader.close()`方法中被释放。您可以创建自己的类，`AutoCloseable`以类似的方式实现和使用它。

这条语句比`finalize`代码结构方面更受限制，但同时它使代码更易于理解和维护。此外，不能保证`finalize`在应用程序的生存期内完全调用方法。

* * *

## 回答 #3

> 赞同：115
> 
> 时间：2008-10-05T13:20:20.660

不，这里没有析构函数。原因是所有 Java 对象都是堆分配和垃圾收集的。如果没有显式释放（即 C++ 的删除运算符），就没有明智的方法来实现真正的析构函数。

Java 确实支持终结器，但它们仅用于保护持有本地资源（如套接字、文件句柄、窗口句柄等）句柄的对象。当垃圾收集器收集没有终结器的对象时，它只是标记内存区域免费，仅此而已。当对象有终结器时，它首先被复制到一个临时位置（请记住，我们在这里进行垃圾收集），然后将其排入等待终结队列，然后终结器线程以非常低的优先级轮询队列并运行终结器。

当应用程序退出时，JVM 会停止而无需等待未决对象完成，因此实际上无法保证您的终结器将永远运行。

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2008-10-05T13:50:53.500

应避免使用*finalize()方法。*它们不是一种可靠的资源清理机制，滥用它们可能会导致垃圾收集器出现问题。

如果您需要在对象中进行释放调用，例如释放资源，请使用显式方法调用。这种约定可以在现有的 API（例如[Closeable](http://java.sun.com/j2se/1.5.0/docs/api/java/io/Closeable.html)、[Graphics.dispose()](http://java.sun.com/javase/6/docs/api/java/awt/Graphics.html#dispose())、[Widget.dispose()](http://help.eclipse.org/stable/nftopic/org.eclipse.platform.doc.isv/reference/api/org/eclipse/swt/widgets/Widget.html#dispose())）中看到，并且通常通过 try/finally 调用。

```
Resource r = new Resource();
try {
    //work
} finally {
    r.dispose();
} 
```

尝试使用已处置对象应引发运行时异常（请参阅[IllegalStateException](http://java.sun.com/javase/6/docs/api/java/lang/IllegalStateException.html)）。

* * *

编辑：

> 我在想，如果我只是取消引用数据并等待垃圾收集器收集它们，如果我的用户重复输入数据并按下重置按钮，会不会出现内存泄漏？

通常，您需要做的就是取消引用对象 - 至少，这是它应该工作的方式。如果您担心垃圾收集，请查看[Java SE 6 HotSpot[tm] Virtual Machine Garbage Collection Tuning](http://java.sun.com/javase/technologies/hotspot/gc/gc_tuning_6.html)（或您的 JVM 版本的等效文档）。

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2012-07-30T15:30:09.143

随着 Java 1.7 的发布，您现在可以选择使用该`try-with-resources`块。例如，

```
public class Closeable implements AutoCloseable {
    @Override
    public void close() {
        System.out.println("closing..."); 
    }
    public static void main(String[] args) {
        try (Closeable c = new Closeable()) {
            System.out.println("trying..."); 
            throw new Exception("throwing..."); 
        }
        catch (Exception e) {
            System.out.println("catching..."); 
        }
        finally {
            System.out.println("finalizing..."); 
        } 
    }
} 
```

如果你执行这个类，`c.close()`将在`try`离开块时执行，并且在执行`catch`和`finally`块之前执行。与`finalize()`方法的情况不同，`close()`保证被执行。但是，不需要在`finally`子句中显式执行它。

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2008-10-05T14:03:21.667

我完全同意其他答案，说不依赖finalize的执行。

除了 try-catch-finally 块之外，您还可以使用[Runtime#addShutdownHook](http://java.sun.com/javase/6/docs/api/java/lang/Runtime.html#addShutdownHook(java.lang.Thread))（在 Java 1.3 中引入）在程序中执行最终清理。

**这与析构函数不同**，但可以实现一个关闭钩子，其中注册了侦听器对象，可以调用清理方法（关闭持久数据库连接、删除文件锁等）——**通常会在析构函数**。再说一遍 - 这不是析构函数的替代品，但在某些情况下，您可以使用它来实现所需的功能。

这样做的好处是解构行为与程序的其余部分**松散耦合**。

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2008-10-05T13:14:11.967

不，[`java.lang.Object#finalize`](http://docs.oracle.com/javase/7/docs/api/java/lang/Object.html#finalize())是你能得到的最接近的。

但是，不能保证何时（以及是否）调用它。
看：[`java.lang.Runtime#runFinalizersOnExit(boolean)`](http://docs.oracle.com/javase/7/docs/api/java/lang/Runtime.html#runFinalizersOnExit(boolean))

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-10-05T15:42:26.927

首先，请注意，由于 Java 是垃圾收集的，因此很少需要对对象销毁做任何事情。首先是因为您通常没有任何可释放的托管资源，其次是因为您无法预测何时或是否会发生，因此对于“一旦没有人再使用我的对象”就需要发生的事情是不合适的”。

可以在使用 java.lang.ref.PhantomReference 销毁对象后通知您（实际上，说它已被销毁可能有点不准确，但如果对它的幻像引用排队，则它不再可恢复，这通常相当于一样的东西）。一个常见的用途是：

*   将类中需要销毁的资源分离到另一个辅助对象中（请注意，如果您所做的只是关闭连接，这是一种常见情况，则无需编写新类：在这种情况下，要关闭的连接将是“帮助对象”）。
*   当您创建主对象时，还要为其创建一个 PhantomReference。要么让 this 引用新的辅助对象，要么设置从 PhantomReference 对象到它们对应的辅助对象的映射。
*   收集到主要对象后，PhantomReference 被排队（或者更确切地说，它可能被排队 - 像终结器一样，不能保证它永远是，例如如果 VM 退出，那么它不会等待）。确保您正在处理其队列（在特殊线程中或不时处理）。由于对辅助对象的硬引用，辅助对象尚未被收集。所以对辅助对象做任何你喜欢的清理，然后丢弃 PhantomReference，辅助对象最终也会被收集。

还有finalize()，它看起来像一个析构函数，但行为不像一个析构函数。这通常不是一个好的选择。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-10-05T13:16:46.940

该`finalize()`函数是析构函数。

但是，通常不应该使用它，因为它是**在 GC 之后**调用的，并且您无法确定何时会发生这种情况（如果有的话）。

此外，需要不止一次 GC 来释放具有`finalize()`.

`try{...} finally{...}`您应该尝试使用语句清理代码中的逻辑位置！

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2016-05-13T15:50:59.350

我同意大多数答案。

你不应该完全依赖任何一个`finalize`或`ShutdownHook`

[敲定](http://javarevisited.blogspot.in/2012/03/finalize-method-in-java-tutorial.html)

1.  JVM 不保证何时`finalize()`调用此方法。

2.  `finalize()`GC线程只调用一次。如果一个对象从 finalizing 方法中恢复过来，则`finalize`不会再次被调用。

3.  在您的应用程序中，您可能有一些活动对象，它们永远不会调用垃圾收集。

4.  `Exception`GC 线程会忽略 finalizing 方法抛出的任何内容

5.  `System.runFinalization(true)`和`Runtime.getRuntime().runFinalization(true)`方法增加了调用`finalize()`方法的概率，但现在这两种方法已被弃用。由于缺乏线程安全性和可能产生死锁，这些方法非常危险。

[关闭钩子](https://docs.oracle.com/javase/8/docs/api/java/lang/Runtime.html#addShutdownHook-java.lang.Thread)

```
public void addShutdownHook(Thread hook) 
```

> 注册一个新的虚拟机关闭挂钩。

Java 虚拟机关闭以响应两种事件：

1.  程序正常退出，当最后一个非守护线程退出或`System.exit`调用 exit（等效地，）方法时，或

2.  虚拟机响应用户中断（例如键入 ^C）或系统范围的事件（例如用户注销或系统关闭）而终止。

3.  关闭挂钩只是一个已初始化但未启动的线程。当虚拟机开始其关闭序列时，它将以某种未指定的顺序启动所有已注册的关闭挂钩并让它们同时运行。当所有钩子都完成后，如果 finalization-on-exit 已启用，它将运行所有未调用的终结器。

4.  最后，虚拟机将停止。请注意，如果关闭是通过调用 exit 方法启动的，则守护线程将在关闭序列期间继续运行，非守护线程也将继续运行。

5.  关闭挂钩也应该快速完成它们的工作。当程序调用 exit 时，期望虚拟机将立即关闭并退出。

    但即使是 Oracle 文档也引用了这一点

> 在极少数情况下，虚拟机可能会中止，即在没有干净关闭的情况下停止运行

当虚拟机在外部终止时会发生这种情况，例如`SIGKILL`Unix 上的信号或`TerminateProcess`Microsoft Windows 上的调用。如果本地方法出错，例如破坏内部数据结构或尝试访问不存在的内存，虚拟机也可能中止。如果虚拟机中止，则无法保证是否会运行任何关闭挂钩。

***结论***：***适当使用`try{} catch{} finally{}`块并在块中释放关键资源 `finally(}`。在`finally{}`块中释放资源期间，catch`Exception`和`Throwable`.***

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-10-05T16:04:31.860

如果您担心的只是记忆，请不要。只要相信 GC，它做得不错。实际上，我看到它是如此高效，以至于在某些情况下，创建小对象堆比使用大型数组更能提高性能。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-10-05T13:51:17.167

也许您可以使用 try ... finally 块来最终确定您正在使用该对象的控制流中的对象。当然它不会自动发生，但 C++ 中的破坏也不会。您经常会在 finally 块中看到资源关闭。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2016-12-28T12:58:52.883

Lombok 中有一个[@Cleanup](https://projectlombok.org/features/Cleanup.html "@清理")注释，它主要类似于 C++ 析构函数：

```
@Cleanup
ResourceClass resource = new ResourceClass(); 
```

在处理它时（在编译时），Lombok 插入适当的`try-finally`块，以便`resource.close()`在执行离开变量的范围时被调用。您还可以明确指定另一种释放资源的方法，例如`resource.dispose()`：

```
@Cleanup("dispose")
ResourceClass resource = new ResourceClass(); 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-10-05T13:20:01.783

与 Java 中的析构函数最接近的是[finalize()](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Object.html#finalize())方法。与传统析构函数的最大区别在于您无法确定何时调用它，因为这是垃圾收集器的职责。我强烈建议您在使用它之前仔细阅读此内容，因为文件句柄等的典型 RAIA 模式无法与 finalize() 一起可靠地工作。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2016-11-03T20:21:24.183

想想最初的问题......我认为我们可以从所有其他学到的答案中得出结论，也可以从 Bloch 的 Essential [Effective Java](https://www.amazon.co.uk/Effective-Java-Second-Joshua-Bloch/dp/0321356683/ref=sr_1_1?ie=UTF8&qid=1482344538&sr=8-1&keywords=effective%20java)的第7 项“避免终结器”中得出结论，它以一种方式寻求合法问题的解决方案不适合Java语言...：

...不会是一个非常明显的解决方案来做OP实际想要的是将所有需要重置的对象保留在一种“游戏笔”中，所有其他不可重置的对象只能通过某种方式引用访问器对象...

然后，当您需要“重置”时，您断开现有的围栏并制作一个新围栏：围栏中的所有对象网络都被抛在一边，永远不会返回，并且有一天会被 GC 收集。

如果这些对象中的任何一个是`Closeable`（或没有，但有一个`close`方法），您可以在`Bag`它们被创建（并且可能打开）时将它们放在围栏中，并且在切断围栏之前访问者的最后一个动作是去通过所有`Closeables`关闭它们...？

代码可能看起来像这样：

```
accessor.getPlaypen().closeCloseables();
accessor.setPlaypen( new Playpen() ); 
```

`closeCloseables`可能是一种阻塞方法，可能涉及锁存器（例如`CountdownLatch`），以处理（并在适当时等待）任何特定于要适当结束的线程中的任何`Runnables`/ ，特别是在 JavaFX 线程中。`Callables``Playpen`

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2019-07-24T18:16:02.450

这里有很多很好的答案，但是还有一些关于为什么你应该避免使用[finalize()](https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html#finalize())的附加信息。

如果 JVM 由于`System.exit()`or而退出`Runtime.getRuntime().exit()`，则默认情况下不会运行终结器。来自[Runtime.exit() 的 Javadoc](https://docs.oracle.com/javase/7/docs/api/java/lang/Runtime.html#exit(int))：

> *虚拟机的关闭顺序包括两个阶段。在第一阶段，所有已注册的关闭挂钩（如果有）都以某种未指定的顺序启动，并允许同时运行直到它们完成。在第二阶段，如果 finalization-on-exit 已启用，则所有未调用的终结器都会运行。完成此操作后，虚拟机将停止。*

你可以打电话[`System.runFinalization()`](https://docs.oracle.com/javase/7/docs/api/java/lang/System.html#runFinalization())，但它只会“尽最大努力完成所有未完成的最终确定”——而不是保证。

有一种[`System.runFinalizersOnExit()`](https://docs.oracle.com/javase/7/docs/api/java/lang/System.html#runFinalizersOnExit(boolean))方法，但不要使用它——它不安全，很久以前就被弃用了。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-08-25T14:54:00.307

如果您正在编写 Java Applet，则可以覆盖 Applet 的“destroy()”方法。这是...

> ```
>  * Called by the browser or applet viewer to inform
>  * this applet that it is being reclaimed and that it should destroy
>  * any resources that it has allocated. The stop() method
>  * will always be called before destroy(). 
> ```

显然不是*你*想要的，但可能是其他人正在寻找的。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-10-05T17:39:56.317

尽管 Java 的 GC 技术已经取得了相当大的进步，但您仍然需要注意您的引用。脑海中浮现出许多看似微不足道的参考模式实际上是老鼠窝的案例。

从您的帖子看来，您似乎并没有试图实现一个重置方法以实现对象重用（真的吗？）。您的对象是否拥有需要清理的任何其他类型的资源（即必须关闭的流、必须归还的任何池化或借用对象）？如果您唯一担心的是内存释放，那么我会重新考虑我的对象结构并尝试验证我的对象是自包含结构，将在 GC 时清理。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2020-05-23T19:48:10.050

没有Java没有任何析构函数。Java中它背后的主要原因是垃圾收集器始终在后台被动工作，所有对象都在堆内存中生成，这就是GC工作的地方。在c ++中，我们必须显式调用删除函数，因为没有类似垃圾收集器的东西。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2020-09-13T17:22:42.237

在 Java 中，垃圾收集器会自动删除未使用的对象以释放内存。因此，Java 没有可用的析构函数是明智的。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2021-09-23T08:05:07.937

当涉及到 android 编程时，尝试调用 onDestroy() 方法。这是在 Activity/Service 类被终止之前执行的最后一个方法。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2021-12-17T16:30:12.473

缺少我刚刚扫描的所有答案是终结器的更安全替代品。关于使用 try-with-resources 和避免终结器，所有其他答案都是正确的，因为它们不可靠并且现在已弃用......

但是他们没有提到清洁工。Java 9 中添加了清理器，以比终结器更好的方式显式处理清理工作。

[https://docs.oracle.com/javase/9​​/docs/api/java/lang/ref/Cleaner.html](https://docs.oracle.com/javase/9/docs/api/java/lang/ref/Cleaner.html)

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2022-01-20T16:26:21.067

如果您有机会使用诸如[Weld之类的](https://weld.cdi-spec.org/)**上下文和依赖注入 (CDI)**框架，您可以使用 Java 注释*@Predestroy*进行清理工作等。

 *```
@javax.enterprise.context.ApplicationScoped
public class Foo {

  @javax.annotation.PreDestroy
  public void cleanup() {
    // do your cleanup    
  }
} 
```

* * *

## 回答 #24

> 赞同：-1
> 
> 时间：2018-07-05T09:16:25.650

Java中没有完全的析构函数类，java中的类被垃圾收集器自动销毁。但你可以使用下面的一个来做到这一点，但它并不完全相同：

**完成（）**

有[一个问题引发了对 finalize 的深入讨论](https://stackoverflow.com/questions/158174/why-would-you-ever-implement-finalize)，因此如果需要，您应该更深入地讨论......

* * *

## 回答 #25

> 赞同：-3
> 
> 时间：2013-05-17T16:14:28.310

我过去主要处理 C++，这也是我寻找析构函数的原因。我现在经常使用 JAVA。我做了什么，它可能不是对每个人来说都是最好的情况，但我通过一个函数将所有值重置为 0 或默认值来实现我自己的析构函数。

例子：

```
public myDestructor() {

variableA = 0; //INT
variableB = 0.0; //DOUBLE & FLOAT
variableC = "NO NAME ENTERED"; //TEXT & STRING
variableD = false; //BOOL

} 
```

理想情况下，这并不适用于所有情况，但是在存在全局变量的情况下，只要您没有大量变量，它就会起作用。

我知道我不是最好的 Java 程序员，但它似乎对我有用。

# .net - Silverlight 中 StaticResource 的 AG_E_PARSER_BAD_PROPERTY_VALUE

> ID：171962
> 
> 赞同：0
> 
> 时间：2008-10-05T13:21:52.640
> 
> 标签：.net, silverlight, silverlight-2-rc0

我将所有可本地化的字符串存储在`ResourceDictionary`(in `App.xaml`) 中，并通过`StaticResource`标记扩展名将它们分配给`TextBlock.Text`等`Button.Content`。

在 Beta 2 和 RC0 中，*有时*解析 XAML`InitializeComponent()`会失败，`AG_E_PARSER_BAD_PROPERTY_VALUE`并在我将属性值设置为`StaticResource`.

它只是有时会发生：重新启动应用程序时，它会解析并显示没有任何问题。相同的界面代码可以工作数天或数周，然后再次发生。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-07T17:49:16.700

解析器，至少在 beta 2 中，不喜欢空格......

例如：

```
Text="{StaticResource bleh}" 
```

工作过

但是这个：

```
Text = "{StaticResource bleh}" 
```

轰炸

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-10-13T18:36:14.497

基本上，这意味着代码中某处的 xaml 错误，您可以看到行号和位置并发现有问题.. 我的 xaml 中出现了同样的错误一旦更正，一切似乎都正常

# c# - 如何找到调用当前方法的方法？

> ID：171970
> 
> 赞同：583
> 
> 时间：2008-10-05T13:28:41.797
> 
> 标签：c#, .net, logging, stack-trace, system.diagnostics

登录 C# 时，如何知道调用当前方法的方法的名称？我知道一切`System.Reflection.MethodBase.GetCurrentMethod()`，但我想在堆栈跟踪中更进一步。我考虑过解析堆栈跟踪，但我希望找到一种更清晰更明确的方式，比如`Assembly.GetCallingAssembly()`but for 方法。

* * *

## 回答 #1

> 赞同：594
> 
> 时间：2008-10-05T13:33:34.003

试试这个：

```
using System.Diagnostics;
// Get call stack
StackTrace stackTrace = new StackTrace(); 
// Get calling method name
Console.WriteLine(stackTrace.GetFrame(1).GetMethod().Name); 
```

单线：

```
(new System.Diagnostics.StackTrace()).GetFrame(1).GetMethod().Name 
```

它来自*[Get Calling Method using Reflection [C#]](http://www.csharp-examples.net/reflection-calling-method-name/)*。

* * *

## 回答 #2

> 赞同：448
> 
> 时间：2012-03-08T16:55:42.897

在 C# 5 中，您可以使用[caller info](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/attributes/caller-information)获取该信息：

```
//using System.Runtime.CompilerServices;
public void SendError(string Message, [CallerMemberName] string callerName = "") 
{ 
    Console.WriteLine(callerName + "called me."); 
} 
```

您还可以获得`[CallerFilePath]`and `[CallerLineNumber]`。

* * *

## 回答 #3

> 赞同：121
> 
> 时间：2012-11-21T15:07:04.090

您可以使用呼叫者信息和可选参数：

```
public static string WhoseThere([CallerMemberName] string memberName = "")
{
       return memberName;
} 
```

该测试说明了这一点：

```
[Test]
public void Should_get_name_of_calling_method()
{
    var methodName = CachingHelpers.WhoseThere();
    Assert.That(methodName, Is.EqualTo("Should_get_name_of_calling_method"));
} 
```

虽然 StackTrace 在上面运行得非常快，并且在大多数情况下不会成为性能问题，但调用者信息仍然快得多。在 1000 次迭代的样本中，我将其计时速度提高了 40 倍。

* * *

## 回答 #4

> 赞同：82
> 
> 时间：2015-11-26T12:55:06.587

快速回顾这两种方法，速度比较是重要部分。

[http://geekswithblogs.net/BlackRabbitCoder/archive/2013/07/25/c.net-little-wonders-getting-caller-information.aspx](http://geekswithblogs.net/BlackRabbitCoder/archive/2013/07/25/c.net-little-wonders-getting-caller-information.aspx)

**在编译时确定调用者**

```
static void Log(object message, 
[CallerMemberName] string memberName = "",
[CallerFilePath] string fileName = "",
[CallerLineNumber] int lineNumber = 0)
{
    // we'll just use a simple Console write for now    
    Console.WriteLine("{0}({1}):{2} - {3}", fileName, lineNumber, memberName, message);
} 
```

**使用堆栈确定调用者**

```
static void Log(object message)
{
    // frame 1, true for source info
    StackFrame frame = new StackFrame(1, true);
    var method = frame.GetMethod();
    var fileName = frame.GetFileName();
    var lineNumber = frame.GetFileLineNumber();

    // we'll just use a simple Console write for now    
    Console.WriteLine("{0}({1}):{2} - {3}", fileName, lineNumber, method.Name, message);
} 
```

**两种方法的比较**

```
Time for 1,000,000 iterations with Attributes: 196 ms
Time for 1,000,000 iterations with StackTrace: 5096 ms 
```

> 所以你看，使用属性要快得多！事实上，速度快了近 25 倍。

* * *

## 回答 #5

> 赞同：68
> 
> 时间：2008-10-05T19:16:48.897

我们可以通过仅实例化我们实际需要的帧而不是整个堆栈来稍微改进阿萨德先生的代码（当前接受的答案）：

```
new StackFrame(1).GetMethod().Name; 
```

这可能会表现得更好一些，尽管很可能它仍然必须使用完整的堆栈来创建单个帧。此外，它仍然有 Alex Lyman 指出的相同警告（优化器/本机代码可能会破坏结果）。最后，您可能需要检查以确保返回`new StackFrame(1)`或`.GetFrame(1)`不返回`null`，尽管这种可能性看起来不太可能。

看到这个相关的问题： [你可以使用反射来找到当前正在执行的方法的名称吗？](https://stackoverflow.com/questions/44153/can-you-use-reflection-to-find-the-name-of-the-currently-executing-method)

* * *

## 回答 #6

> 赞同：61
> 
> 时间：2008-10-05T13:52:50.360

一般来说，你可以使用[`System.Diagnostics.StackTrace`](http://msdn.microsoft.com/en-us/library/system.diagnostics.stacktrace.aspx)类来获取一个[`System.Diagnostics.StackFrame`](http://msdn.microsoft.com/en-us/library/system.diagnostics.stackframe.aspx)，然后使用[`GetMethod()`](http://msdn.microsoft.com/en-us/library/system.diagnostics.stackframe.getmethod.aspx)方法来获取一个[`System.Reflection.MethodBase`](http://msdn.microsoft.com/en-us/library/system.reflection.methodbase.aspx)对象。但是，这种方法有[一些注意事项](http://blogs.msdn.com/jmstall/archive/2005/03/20/399287.aspx)：

1.  它代表**运行时**堆栈——优化可以内联一个方法，您***不会***在堆栈跟踪中看到该方法。
2.  它***不会***显示任何本机框架，因此如果您的方法甚至有可能被本机方法调用，这将***不起作用***，实际上目前没有可用的方法来做到这一点。

（*注意：我只是在扩展Firas Assad 提供[的答案](https://stackoverflow.com/questions/171970/how-can-i-find-the-method-that-called-the-current-method#171974)*。）

* * *

## 回答 #7

> 赞同：49
> 
> 时间：2015-10-20T13:15:27.737

*从 .NET 4.5 开始，您可以使用[调用者信息](https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/caller-information)属性：*

*   [`CallerFilePath`](https://docs.microsoft.com/en-us/dotnet/api/system.runtime.compilerservices.callerfilepathattribute)- 调用函数的源文件；
*   [`CallerLineNumber`](https://docs.microsoft.com/en-us/dotnet/api/system.runtime.compilerservices.callerlinenumberattribute)- 调用函数的代码行；
*   [`CallerMemberName`](https://docs.microsoft.com/en-us/dotnet/api/system.runtime.compilerservices.callermembernameattribute)- 调用函数的成员。

    ```
    public void WriteLine(
        [CallerFilePath] string callerFilePath = "", 
        [CallerLineNumber] long callerLineNumber = 0,
        [CallerMemberName] string callerMember= "")
    {
        Debug.WriteLine(
            "Caller File Path: {0}, Caller Line Number: {1}, Caller Member: {2}", 
            callerFilePath,
            callerLineNumber,
            callerMember);
    } 
    ```

此功能也存在于“.NET Core”和“.NET Standard”中。

**参考**

1.  [Microsoft - 来电者信息 (C#)](https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/caller-information)
2.  [微软 -`CallerFilePathAttribute`类](https://docs.microsoft.com/en-us/dotnet/api/system.runtime.compilerservices.callerfilepathattribute)
3.  [微软 -`CallerLineNumberAttribute`类](https://docs.microsoft.com/en-us/dotnet/api/system.runtime.compilerservices.callerlinenumberattribute)
4.  [微软 -`CallerMemberNameAttribute`类](https://docs.microsoft.com/en-us/dotnet/api/system.runtime.compilerservices.callermembernameattribute)

* * *

## 回答 #8

> 赞同：16
> 
> 时间：2016-06-17T15:47:38.097

显然这是一个迟到的答案，但如果您可以使用 .NET 4.5 或更高版本，我有更好的选择：

```
internal static void WriteInformation<T>(string text, [CallerMemberName]string method = "")
{
    Console.WriteLine(DateTime.Now.ToString() + " => " + typeof(T).FullName + "." + method + ": " + text);
} 
```

这将打印当前日期和时间，然后是“Namespace.ClassName.MethodName”并以“：text”结尾。
样本输出：

```
6/17/2016 12:41:49 PM => WpfApplication.MainWindow..ctor: MainWindow initialized 
```

样品用途：

```
Logger.WriteInformation<MainWindow>("MainWindow initialized"); 
```

* * *

## 回答 #9

> 赞同：14
> 
> 时间：2008-10-05T13:36:31.393

请注意，由于优化，这样做在发布代码中是不可靠的。此外，在沙盒模式（网络共享）下运行应用程序根本不允许您抓取堆栈帧。

考虑[面向方面的编程](http://en.wikipedia.org/wiki/Aspect-oriented_programming)(AOP)，例如[PostSharp](https://www.postsharp.net/)，它不是从您的代码中调用，而是修改您的代码，因此始终知道它在哪里。

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2010-05-28T20:08:14.047

```
/// <summary>
/// Returns the call that occurred just before the "GetCallingMethod".
/// </summary>
public static string GetCallingMethod()
{
   return GetCallingMethod("GetCallingMethod");
}

/// <summary>
/// Returns the call that occurred just before the the method specified.
/// </summary>
/// <param name="MethodAfter">The named method to see what happened just before it was called. (case sensitive)</param>
/// <returns>The method name.</returns>
public static string GetCallingMethod(string MethodAfter)
{
   string str = "";
   try
   {
      StackTrace st = new StackTrace();
      StackFrame[] frames = st.GetFrames();
      for (int i = 0; i < st.FrameCount - 1; i++)
      {
         if (frames[i].GetMethod().Name.Equals(MethodAfter))
         {
            if (!frames[i + 1].GetMethod().Name.Equals(MethodAfter)) // ignores overloaded methods.
            {
               str = frames[i + 1].GetMethod().ReflectedType.FullName + "." + frames[i + 1].GetMethod().Name;
               break;
            }
         }
      }
   }
   catch (Exception) { ; }
   return str;
} 
```

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2008-10-05T20:09:42.160

也许你正在寻找这样的东西：

```
StackFrame frame = new StackFrame(1);
frame.GetMethod().Name; //Gets the current method name

MethodBase method = frame.GetMethod();
method.DeclaringType.Name //Gets the current class name 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2011-03-04T18:40:54.570

```
private static MethodBase GetCallingMethod()
{
  return new StackFrame(2, false).GetMethod();
}

private static Type GetCallingType()
{
  return new StackFrame(2, false).GetMethod().DeclaringType;
} 
```

精彩的课程在这里：[http ://www.csharp411.com/c-get-calling-method/](http://www.csharp411.com/c-get-calling-method/)

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2018-12-27T08:36:00.687

要获取方法名称和类名称，请尝试以下操作：

```
 public static void Call()
    {
        StackTrace stackTrace = new StackTrace();

        var methodName = stackTrace.GetFrame(1).GetMethod();
        var className = methodName.DeclaringType.Name.ToString();

        Console.WriteLine(methodName.Name + "*****" + className );
    } 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-10-05T13:36:42.937

查看*[.NET 中的 Logging 方法名称](http://www.codeproject.com/KB/dotnet/MethodName.aspx)*。小心在生产代码中使用它。StackFrame 可能不可靠...

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-10-16T01:06:21.327

我使用的另一种方法是向相关方法添加参数。例如，代替`void Foo()`，使用`void Foo(string context)`。然后传入一些指示调用上下文的唯一字符串。

如果您只需要调用者/上下文进行开发，您可以`param`在发货前删除。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2018-12-27T09:19:17.327

Firas Assaad 回答的额外信息。

我`new StackFrame(1).GetMethod().Name;`在 .net core 2.1 中使用了依赖注入，并且我将调用方法作为“开始”。

我试过了`[System.Runtime.CompilerServices.CallerMemberName] string callerName = ""` ，它给了我正确的调用方法

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2012-12-14T08:20:41.080

```
StackFrame caller = (new System.Diagnostics.StackTrace()).GetFrame(1);
string methodName = caller.GetMethod().Name; 
```

就够了，我想。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2013-05-30T15:43:07.947

我们也可以使用 lambda 来查找调用者。

假设您有一个由您定义的方法：

```
public void MethodA()
    {
        /*
         * Method code here
         */
    } 
```

你想找到它的来电者。

*1* . 更改方法签名，以便我们有一个 Action 类型的参数（Func 也可以使用）：

```
public void MethodA(Action helperAction)
        {
            /*
             * Method code here
             */
        } 
```

*2* . Lambda 名称不是随机生成的。规则似乎是： > <CallerMethodName>__X 其中 CallerMethodName 被前一个函数替换， X 是一个索引。

```
private MethodInfo GetCallingMethodInfo(string funcName)
    {
        return GetType().GetMethod(
              funcName.Substring(1,
                                funcName.IndexOf("&gt;", 1, StringComparison.Ordinal) - 1)
              );
    } 
```

*3* . 当我们调用 MethodA 时，Action/Func 参数必须由调用方方法生成。例子：

```
MethodA(() => {}); 
```

*4* . 在 MethodA 中，我们现在可以调用上面定义的辅助函数并找到调用方方法的 MethodInfo。

例子：

```
MethodInfo callingMethodInfo = GetCallingMethodInfo(serverCall.Method.Name); 
```

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2015-07-06T09:02:13.163

```
var callingMethod = new StackFrame(1, true).GetMethod();
string source = callingMethod.ReflectedType.FullName + ": " + callingMethod.Name; 
```

# perl - 如何提取一行或一行？

> ID：171999
> 
> 赞同：3
> 
> 时间：2008-10-05T13:41:43.050
> 
> 标签：perl, parsing

如何提取一行中的整行，例如第 3 行。这些数据保存在我在 linux 中的文本编辑器中。这是我的数据：

```
1,julz,kath,shiela,angel
2,may,ann,janice,aika
3,christal,justine,kim
4,kris,allan,jc,mine 
```

我想要像这样的输出：

```
3,christal,justine,kim 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-05T14:16:17.427

以下代码段读取前三行，仅打印第三行，然后退出以确保不会发生不必要的处理。

如果没有退出，脚本将继续处理输入文件，尽管您知道对它没有用处。

```
perl -ne 'if ($. == 3) {print;exit}' infile.txt 
```

正如[perlvar](http://perldoc.perl.org/perlvar.html)指出的，`$.`是最后访问的文件句柄的当前行号。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-05T13:53:34.353

```
$ perl -ne'print if $. == 3' your_file.txt 
```

以下是[@ysth 答案](https://stackoverflow.com/questions/171999/how-can-i-extract-a-line-or-row-in-perl#172665)的脚本版本：

```
$ perl -mTie::File -e'tie @lines, q(Tie::File), q(your_file.txt); 
> print $lines[2]' 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-05T17:55:22.243

如果它总是第三行：

```
perl -ne 'print if 3..3' <infile >outfile 
```

如果始终是第一列的数值为“3”的那个：

```
perl -F, -nae 'print if $F[0] == 3' <infile >outfile # thanks for the comment doh! 
```

由于你没有说你是如何识别那条线的，所以我提供了替代方案。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-06T11:32:43.077

对于更通用的解决方案：

```
open my $fh, '<', 'infile.txt';
while (my $line = <$fh>) {
  print $line if i_want_this_line($line);
} 
```

其中 i_want_this_line 实现了定义您想要的行的标准。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-05T21:04:02.767

嗯， -n 答案假设问题是“什么是……的脚本”。在这种情况下，perl 甚至不是最好的答案。但我没有将其读入问题。

通常，如果行不是固定长度的，则必须逐行阅读文件，直到到达所需的行。 [Tie::File](http://search.cpan.org/dist/Tie-File)为您自动执行此过程（尽管由于它将替换的代码非常琐碎，我自己很少为此烦恼）。

```
use Tie::File;
use Fcntl "O_RDONLY";
tie my @line, "Tie::File", "yourfilename", mode => O_RDONLY
    or die "Couldn't open file: $!";
print "The third line is ", $line[2]; 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-05T13:45:53.323

您可以将文件句柄上的菱形运算符分配给列表，每个元素将是一行或一行。

```
open $fh, "myfile.txt";
my @lines = <$fh>; 
```

**编辑：**此解决方案抓取所有行，以便您可以访问任何您想要的行，例如第 3 行将是`$lines[2]`......如果您真的只想要一个特定的行，那将是一个不同的解决方案，就像其他回答者一样。*******************