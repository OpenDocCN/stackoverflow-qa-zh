# StackOverflow 问答 000554000-000554999

# iphone - 带有静态标题的 uiwebview (mobilesafari)

> ID：554000
> 
> 赞同：2
> 
> 时间：2009-02-16T18:01:09.023
> 
> 标签：iphone, uiwebview

我尝试了多种方法来获取 UIWebView 上的静态标题，以便它仅滚动 html 标题下方的内容。有没有人成功做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-09T20:55:52.923

If this needs to work only on the phone, you could just place two UIWebViews, one above the other. Display the header in one, and the content in another.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-08T01:24:14.853

CSS 标准指定了一个`position: fixed`属性来执行此操作，但 iPhone 上的 WebKit 不支持它。（我没有这方面的任何内部信息，但我怀疑这是因为没有明智的方法来支持缩放。）所以如果你想这样做，你必须从 web 视图之外通过 (例如）将第二个 webview 放在第一个 webview 之上，并带有静态标题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-06T13:02:18.203

我正在寻找本质上相同的东西...您可以为 div 做它，但是需要使用 2 个手指滚动 div...。

有关更多信息，请参见StackOverflow 上的[讨论](https://stackoverflow.com/questions/615357/scrollable-div-on-iphone-without-using-2-fingers)

布拉德

# visual-studio - 允许使用 2008 打开 2005 解决方案的 Visual Studio 插件？

> ID：554007
> 
> 赞同：0
> 
> 时间：2009-02-16T18:02:12.077
> 
> 标签：visual-studio, visual-studio-2008, visual-studio-2005, plugins

有谁知道是否有 Visual Studio 2008 的插件可以以非破坏性方式打开 VS2005 解决方案？

我在想的是转换后的项目文件保存在内存中，而不是替换磁盘上的原始文件，默认情况下，.Net framework 2.0 将成为目标？

当前行为需要一个复杂的转换过程，该过程会破坏原始解决方案文件并最终生成一个针对较新框架的项目。我想要一些能让仍在使用 2005 的开发人员继续从事该项目的东西。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-16T18:06:02.177

我在开源项目中看到的处理方式是为每个版本的 VS 创建一个解决方案文件。由于项目文件（csproj、vbproj 等）跨版本兼容，因此您不需要这些文件的单独版本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-16T20:46:45.020

只需在 2008 年打开您的 2005 年项目并允许它升级您的解决方案/项目。您可能会收到一个对话框，要求您更新 CLR 版本，只需说不。

一旦你有一个工作的 2008 解决方案，将 *.sln 文件复制到另一个名称（我将我的副本称为 *.2005.sln），在记事本或你喜欢的文本编辑器中打开复制的 *.sln 文件。在第 2 行找到“Format Version 10.0”，并更改为“Format Version 9.0”。保存文件。

就是这样，您升级的解决方案文件在 VS 2008 中运行，而您复制和更改的解决方案文件在 VS 2005 中运行。

如果您有 Web 应用程序项目，那么还有一个额外的步骤。在 Web 应用程序的 vbproj 或 csproj 文件中，找到以下行：

```
<Import Project="$(MSBuildExtensionsPath)\Microsoft\VisualStudio\v9.0\WebApplications\Microsoft.WebApplications.targets" Condition="" /> 
```

并用这两行替换这一行：

```
<Import Project="$(MSBuildExtensionsPath)\Microsoft\VisualStudio\v8.0\WebApplications\Microsoft.WebApplications.targets" Condition="'$(Solutions.VSVersion)' == '8.0'" />
<Import Project="$(MSBuildExtensionsPath)\Microsoft\VisualStudio\v9.0\WebApplications\Microsoft.WebApplications.targets" Condition="'$(Solutions.VSVersion)' == '9.0'" /> 
```

这两行将根据使用的 VS 版本有条件地选择正确的 MSBuild 路径。

# iphone - 在 iPhone 应用升级上部署 sqlite DB

> ID：554009
> 
> 赞同：9
> 
> 时间：2009-02-16T18:02:46.383
> 
> 标签：iphone, xcode, sqlite, app-store

我在 iPhone 应用程序中使用 sqlite 作为数据源。我有两个关于应用程序升级的问题。

1.) 数据都是配置/非事务性的。意思是，它是只读的。当我更新/添加配置数据时，我将为应用程序发布升级。当用户获得更新的 iPhone 应用程序时，是否会卸载原来的应用程序？如果是这种情况，我很好，因为将部署新的数据库配置数据。如果不是这种情况，我该如何替换数据？

2.) 数据是配置和事务性的。这意味着用户可以将数据保存到数据库中。当用户升级到应用程序的新版本时，我想维护他们现有的数据但替换所有配置数据。我猜我需要在应用程序中存储 INSERT 和 UPDATE 脚本才能完成此操作。什么是有效的方法？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-28T02:02:20.883

cdespinosa 已经很好地描述了场景 #1，所以我将处理 #2。

我还没有在 iPhone 上这样做过，但在桌面环境中，最简单的处理方法是将配置数据保存在单独的数据库中。您可以很容易地附加到多个数据库。首先打开您的主数据库，它可能应该是可以更改的数据库。然后`sqlite3_exec`是一个`ATTACH`语句，如下所示：

```
ATTACH 'filepath' AS config; 
```

从那时起，您可以执行以下操作：

```
SELECT * FROM UserTableName;
SELECT * FROM config.ConfigurationTableName; 
```

我的理解是，如果您写入配置数据库，应用程序将无法通过签名检查并且无法启动，并且 iPhone 附带的 SQLite 版本太旧，不支持只读标志。出于这个原因，您应该将配置数据库文件复制到沙箱中并打开该副本，而不是捆绑包中的那个。

（当然，您可以使用 SQL 并将值从一个数据库复制到另一个数据库。但是，如果您已经将整个配置数据库复制到您的沙箱......并且您应该......那么这只是一个额外的步骤。附上就好。）

我希望其他人可以为您提供更多详细信息。:)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-17T17:13:09.677

当用户升级应用程序时，旧的应用程序包被卸载并安装了新的应用程序包，但与应用程序包关联的用户数据是完整的。

因此，您的选择是 a) 将数据保留在应用程序包中（它将被自动替换）或 b) 在首次运行时单方面将其复制到用户数据区域（因此您将在升级时有意替换它）。

我会将 #2 留给熟悉 sqlite 的人，但如果您实际上正在这样做，您可能想要使用“sqlite”标签而不是“mysql”标签。

# .net - 如何从 PowerShell 获取文件的实际磁盘大小？

> ID：554010
> 
> 赞同：8
> 
> 时间：2009-02-16T18:03:01.500
> 
> 标签：.net, powershell

我正在编写一个管理脚本，我需要计算磁盘上文件的大小。

这些文件位于压缩的 NTFS 卷上。

我不能使用`FileInfo.Length`，因为那是文件大小而不是磁盘大小。例如，如果我有一个 100MB 的文件，但由于 NTFS 压缩仅使用 25MB，我需要我的脚本返回 25MB。

有没有办法在 Powershell 中做到这一点？

（我知道`GetCompressedFileSize()`Win32 调用，但我希望这已经在某种程度上被包装了。）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-20T19:50:26.543

（编辑）

我想出了如何向 Fileobject 动态添加一个属性（称为“脚本属性”），所以现在我可以使用语法：$theFileObject.CompressedSize 来读取大小。

（编辑结束）

阅读 Goyuix 的回复，我想“很酷，但是 Powershell 中没有某种类型扩展功能吗？”。于是我发现了这个 Scott Hanselman 的帖子：[http ://www.hanselman.com/blog/MakingJunctionsReparsePointsVisibleInPowerShell.aspx](http://www.hanselman.com/blog/MakingJunctionsReparsePointsVisibleInPowerShell.aspx)

我为 FileInfo 对象创建了一个脚本属性：CompressedSize。

这就是我所做的：（注意：我对 Powershell 很陌生，或者至少我不怎么使用它。这可能会变得更好，但这就是我所做的：

首先，我从 Goyuix 的帖子中编译了 Ntfs.ExtendedFileInfo。我将 DLL 放在我的 Powershell 配置文件目录 (Documents\WindowsPowershell)

接下来，我在我的配置文件目录中创建了一个名为 My.Types.ps1xml 的文件。

我将以下 XML 放入文件中：

```
<Types>
<Type>
    <Name>System.IO.FileInfo</Name>
    <Members>
        <ScriptProperty>
          <Name>CompressedSize</Name>
          <GetScriptBlock>
            [Ntfs.ExtendedFileInfo]::GetCompressedFileSize($this.FullName)
          </GetScriptBlock>
        </ScriptProperty>
    </Members>
</Type>
</Types> 
```

该代码（一旦合并到类型系统中）将动态地将名为 CompressedSize 的属性添加到 get-childitem/dir 返回的 FileInfo 对象。但是 Powershell 还不知道代码，也不知道我的 DLL。我们在下一步中处理它：

编辑 Profile.ps1。在同一目录中。现在，我的个人资料文件中恰好已经有一些东西，因为我安装了 Powershell 的社区扩展。希望我在下一个代码片段中包含了您需要的所有内容，以便它甚至可以在没有扩展的机器上工作。将以下代码添加到 Profile.ps1：

```
#This will load the ExtendedfileInfo assembly to enable the GetCompressedFileSize method.  this method is used by the
#PSCompressedSize Script Property attached to the FileInfo object.
$null = [System.Reflection.Assembly]::LoadFile("$ProfileDir\ntfs.extendedfileinfo.dll") 

#merge in my extended types
$profileTypes = $ProfileDir | join-path -childpath "My.Types.ps1xml"
Update-TypeData $profileTypes 
```

现在，我引用的 $ProfileDir 变量在前面的 Profile.ps1 脚本中定义。以防万一它不在您的范围内，这是定义：

```
$ProfileDir = split-path $MyInvocation.MyCommand.Path -Parent 
```

就是这样。下次运行 Powershell 时，您可以访问 FileInfo 对象上的 CompressedSize 属性，就像它是任何其他属性一样。例子：

$myFile = 目录 c:\temp\myfile.txt

$myFile.CompressedSize

这可行（无论如何在我的机器上），但我很想知道它是否符合最佳实践。我知道我做错了一件事：在 Profile.ps1 文件中，我将 LoadFile 的结果返回到我不会使用的变量中 ($null = blah blah)。我这样做是为了抑制将加载文件的结果显示到控制台。可能有更好的方法来做到这一点。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-17T17:33:44.993

加载托管 Windows API ([http://mwinapi.sourceforge.net/](http://mwinapi.sourceforge.net/)）并查看 ExtendedFileInfo 类。有一种方法[GetPhysicalFileSize()](http://mwinapi.sourceforge.net/doc/html/M_ManagedWinapi_ExtendedFileInfo_GetPhysicalFileSize.htm)将返回文件在磁盘上所需的大小。

```
public static ulong GetPhysicalFileSize(string filename) 
```

或者，您可以编译自己的 DLL 并为该函数加载程序集：

```
using System;
using System.Runtime.InteropServices;

namespace NTFS {
  public class ExtendedFileInfo
  {
    [DllImport("kernel32.dll", SetLastError=true, EntryPoint="GetCompressedFileSize")]
    static extern uint GetCompressedFileSizeAPI(string lpFileName, out uint lpFileSizeHigh);
    public static ulong GetCompressedFileSize(string filename)
    {
      uint high;
      uint low;
      low = GetCompressedFileSizeAPI(filename, out high);
      int error = Marshal.GetLastWin32Error();
      if (high == 0 && low == 0xFFFFFFFF && error != 0)
      {
        throw new System.ComponentModel.Win32Exception(error);
      }
      else
      {
        return ((ulong)high << 32) + low;
      }
    }
  }
} 
```

然后编译：

```
csc /target:library /out:ntfs.extendedfileinfo.dll ntfs.extendedfileinfo.cs 
```

最后，在 PowerShell 中加载和运行：

```
PS C:\> [System.Reflection.Assembly]::LoadFile("C:\ntfs.extendedfileinfo.dll")
PS C:\> [NTFS.ExtendedFileInfo]::GetCompressedFileSize("C:\sample.txt") 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-21T16:31:09.790

使用 V2 Add-Type 和 Pinvoke.NET 很容易做到：

```
add-type -type  @'
using System;
using System.Runtime.InteropServices;
using System.ComponentModel;

namespace Win32Functions
{
    public class ExtendedFileInfo
    {
        [DllImport("kernel32.dll", SetLastError=true, EntryPoint="GetCompressedFileSize")]
        static extern uint GetCompressedFileSizeAPI(string lpFileName, out uint lpFileSizeHigh);

        public static ulong GetCompressedFileSize(string filename)
        {
            uint high;
            uint low;
            low = GetCompressedFileSizeAPI(filename, out high);
            int error = Marshal.GetLastWin32Error();
            if (high == 0 && low == 0xFFFFFFFF && error != 0)
            throw new Win32Exception(error);
            else
            return ((ulong)high << 32) + low;
        }
    }
}
'@

[Win32Functions.ExtendedFileInfo]::GetCompressedFileSize( "C:\autoexec.bat") 
```

实验！享受！从事！

Jeffrey Snover [MSFT] Windows 管理合作伙伴架构师 访问 Windows PowerShell 团队博客：http: [//blogs.msdn.com/PowerShell](http://blogs.msdn.com/PowerShell) 访问 Windows PowerShell 脚本中心：http: [//www.microsoft.com/technet/scriptcenter/hubs /msh.mspx](http://www.microsoft.com/technet/scriptcenter/hubs/msh.mspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-18T15:15:24.347

如果找不到喜欢的托管 API，在 PowerShell V2 中 P/Invoke Win32 API 会容易得多。阅读[PowerShell P/Invoke 演练](http://www.leeholmes.com/blog/PowerShellPInvokeWalkthrough.aspx)以获取说明。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-06-20T08:19:18.243

请注意，这不会返回 Windows 资源管理器显示的“磁盘大小”，尤其是。对于小文件。

[在 Powershell 中获取小文件的“磁盘大小”](https://stackoverflow.com/questions/22507523/getting-size-on-disk-for-small-files-in-powershell/22508299)中描述了获取该信息的（几乎）正确方法

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-03T14:46:15.593

$s=(compact /q C:\whatever.dat | where-object {$_.contains('total bytes')}).split()};$s[8].padleft(20)+$s[ 0].padleft(20)

# git - 如何反转 git 存储库与其克隆之间的关系？

> ID：554011
> 
> 赞同：8
> 
> 时间：2009-02-16T18:03:25.647
> 
> 标签：git

设置了一个 git clone 以支持推/拉回原始存储库。如何使用 git-remote （和/或其他命令、配置文件等）来更改两个存储库，以便原始存储库现在将像克隆一样，默认情况下推入和拉入其中，克隆现在将起作用作为原始人，对克隆人一无所知？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-16T18:11:14.723

在曾经是远程的地方发出这些命令：

```
% git remote add origin user@machine:/path/to/repo
% git config branch.master.remote origin
% git config branch.master.merge  refs/heads/master
% git pull 
```

然后在旧克隆上：

```
% git remote rm origin 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-16T18:13:01.600

您只需在两个存储库中编辑 .git/config 文件并更改远程“来源”的“url”

因此，您可以使用 git-config 命令（请参阅[man](http://git-scm.com/docs/git-config)选项）来更改 git 存储库的全局选项。

# c# - 正则表达式在空格上拆分，除非在引号中

> ID：554013
> 
> 赞同：68
> 
> 时间：2009-02-16T18:03:59.343
> 
> 标签：c#, .net, regex

我想使用 .Net Regex.Split 方法将此输入字符串拆分为一个数组。**除非用引号括起来，否则它必须在空格上拆分。**

输入：这是“我的字符串”，它有“六个匹配项”

预期输出：

1.  这里
2.  是
3.  我的弦
4.  它
5.  拥有
6.  六场比赛

我需要什么模式？我还需要指定任何 RegexOptions 吗？

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2009-02-16T18:16:11.203

无需选项

正则表达式：

```
\w+|"[\w\s]*" 
```

C＃：

```
Regex regex = new Regex(@"\w+|""[\w\s]*"""); 
```

**或者，如果您需要排除 " 字符：**

```
 Regex
        .Matches(input, @"(?<match>\w+)|\""(?<match>[\w\s]*)""")
        .Cast<Match>()
        .Select(m => m.Groups["match"].Value)
        .ToList()
        .ForEach(s => Console.WriteLine(s)); 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-04-08T02:03:25.417

Lieven 的解决方案取得了大部分进展，正如他在评论中所说，这只是将结局更改为 Bartek 解决方案的问题。最终结果是以下工作正则表达式：

```
(?<=")\w[\w\s]*(?=")|\w+|"[\w\s]*" 
```

输入：这是“我的字符串”，它有“六个匹配项”

输出：

1.  这里
2.  是
3.  “我的弦”
4.  它
5.  拥有
6.  “六场比赛”

不幸的是，它包括引号。如果您改为使用以下内容：

```
(("((?<token>.*?)(?<!\\)")|(?<token>[\w]+))(\s)*) 
```

并显式捕获“令牌”匹配，如下所示：

```
 RegexOptions options = RegexOptions.None;
    Regex regex = new Regex( @"((""((?<token>.*?)(?<!\\)"")|(?<token>[\w]+))(\s)*)", options );
    string input = @"   Here is ""my string"" it has   "" six  matches""   ";
    var result = (from Match m in regex.Matches( input ) 
                  where m.Groups[ "token" ].Success
                  select m.Groups[ "token" ].Value).ToList();

    for ( int i = 0; i < result.Count(); i++ )
    {
        Debug.WriteLine( string.Format( "Token[{0}]: '{1}'", i, result[ i ] ) );
    } 
```

调试输出：

```
Token[0]: 'Here'
Token[1]: 'is'
Token[2]: 'my string'
Token[3]: 'it'
Token[4]: 'has'
Token[5]: ' six  matches' 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2011-12-19T22:00:07.960

最佳答案对我来说不太适用。我试图用空格分割这种字符串，但看起来它也在点（'。'）上分割。

```
"the lib.lib" "another lib".lib 
```

我知道这个问题是关于正则表达式的，但我最终写了一个非正则表达式函数来做到这一点：

```
 /// <summary>
    /// Splits the string passed in by the delimiters passed in.
    /// Quoted sections are not split, and all tokens have whitespace
    /// trimmed from the start and end.
    public static List<string> split(string stringToSplit, params char[] delimiters)
    {
        List<string> results = new List<string>();

        bool inQuote = false;
        StringBuilder currentToken = new StringBuilder();
        for (int index = 0; index < stringToSplit.Length; ++index)
        {
            char currentCharacter = stringToSplit[index];
            if (currentCharacter == '"')
            {
                // When we see a ", we need to decide whether we are
                // at the start or send of a quoted section...
                inQuote = !inQuote;
            }
            else if (delimiters.Contains(currentCharacter) && inQuote == false)
            {
                // We've come to the end of a token, so we find the token,
                // trim it and add it to the collection of results...
                string result = currentToken.ToString().Trim();
                if (result != "") results.Add(result);

                // We start a new token...
                currentToken = new StringBuilder();
            }
            else
            {
                // We've got a 'normal' character, so we add it to
                // the curent token...
                currentToken.Append(currentCharacter);
            }
        }

        // We've come to the end of the string, so we add the last token...
        string lastResult = currentToken.ToString().Trim();
        if (lastResult != "") results.Add(lastResult);

        return results;
    } 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2011-03-08T00:55:21.957

我正在使用 Bartek Szabat 的答案，但我需要在令牌中捕获的不仅仅是“\w”字符。为了解决这个问题，我稍微修改了他的正则表达式，类似于 Grzenio 的回答：

```
Regular Expression: (?<match>[^\s"]+)|(?<match>"[^"]*")

C# String:          (?<match>[^\\s\"]+)|(?<match>\"[^\"]*\") 
```

Bartek 的代码（返回去掉了引号的标记）变为：

```
Regex
        .Matches(input, "(?<match>[^\\s\"]+)|(?<match>\"[^\"]*\")")
        .Cast<Match>()
        .Select(m => m.Groups["match"].Value)
        .ToList()
        .ForEach(s => Console.WriteLine(s)); 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2013-02-15T10:22:03.130

我发现这个[答案](https://stackoverflow.com/a/366532/1140783)中的正则表达式非常有用。要使其在 C# 中工作，您必须使用 MatchCollection 类。

```
//need to escape \s
string pattern = "[^\\s\"']+|\"([^\"]*)\"|'([^']*)'";

MatchCollection parsedStrings = Regex.Matches(line, pattern);

for (int i = 0; i < parsedStrings.Count; i++)
{
    //print parsed strings
    Console.Write(parsedStrings[i].Value + " ");
}
Console.WriteLine(); 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-16T18:14:15.857

此正则表达式将根据您在上面给出的情况进行拆分，尽管它不会去除引号或多余的空格，因此您可能需要对字符串进行一些后期处理。不过，这应该正确地将引用的字符串保持在一起。

```
"[^"]+"|\s?\w+?\s 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-16T18:15:35.510

有点混乱，正则语言可以跟踪引号的偶数/奇数计数，但是如果您的数据可以包含转义引号 (\")，那么您将在生成或理解正确处理该问题的正则表达式时遇到麻烦.

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-16T18:07:44.747

编辑：对不起我以前的帖子，这显然是可能的。

要处理所有非字母数字字符，您需要以下内容：

```
MatchCollection matchCollection = Regex.Matches(input, @"(?<match>[^""\s]+)|\""(?<match>[^""]*)""");
foreach (Match match in matchCollection)
        {
            yield return match.Groups["match"].Value;
        } 
```

如果您使用 .Net >2.0，您可以让 foreach 更智能

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-16T18:12:16.017

肖恩

我相信以下正则表达式应该这样做

```
(?<=")\w[\w\s]*(?=")|\w+ 
```

问候，
利文

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-16T18:29:52.743

在 Code 项目中查看 LSteinle 的“[支持文本限定符的拆分函数”](http://www.codeproject.com/KB/dotnet/TextQualifyingSplit.aspx)

这是您感兴趣的他的项目的片段。

```
using System.Text.RegularExpressions;

public string[] Split(string expression, string delimiter, string qualifier, bool ignoreCase)
{
    string _Statement = String.Format("{0}(?=(?:[^{1}]*{1}[^{1}]*{1})*(?![^{1}]*{1}))", 
                        Regex.Escape(delimiter), Regex.Escape(qualifier));

    RegexOptions _Options = RegexOptions.Compiled | RegexOptions.Multiline;
    if (ignoreCase) _Options = _Options | RegexOptions.IgnoreCase;

    Regex _Expression = New Regex(_Statement, _Options);
    return _Expression.Split(expression);
} 
```

只需注意在循环中调用它，因为它每次调用它时都会创建和编译 Regex 语句。因此，如果您需要多次调用它，我会考虑创建某种正则表达式缓存。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-07-26T02:52:46.963

如果您想以免费的开源 javascript 对象的形式查看此问题的通用解决方案，您可以访问[http://splitterjsobj.sourceforge.net/](http://splitterjsobj.sourceforge.net/)进行现场演示（和下载） . 该对象具有以下特点：

*   成对的用户定义的引号字符可用于转义分隔符（防止引号内的拆分）。引号可以使用用户定义的转义字符和/或“双引号转义”进行转义。转义字符可以被转义（用它自己）。在 5 个输出数组（对象的属性）之一中，输出未转义。（例如，如果转义字符 = /，则 "a///"b" 未转义为 a/"b）
*   在分隔符数组上拆分；一次调用解析文件。（输出数组将被嵌套。）
*   javascript 识别的所有转义序列都可以在拆分过程和/或预处理过程中进行评估。
*   回调功能
*   跨浏览器一致性

该对象也可作为 jQuery 插件使用，但作为此站点的新用户，我只能在此消息中包含一个链接。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-09-14T18:46:24.580

我需要支持嵌套，所以这些都不适合我。我放弃了尝试通过正则表达式来做，只是编码：

```
 public static Argument[] ParseCmdLine(string args) {
    List<string> ls = new List<string>();
    StringBuilder sb = new StringBuilder(128);

    // support quoted text nesting up to 8 levels deep
    Span<char> quoteChar = stackalloc char[8];
    int quoteLevel = 0;

    for (int i = 0; i < args.Length; ++i) {
      char ch = args[i];
      switch (ch) {
        case ' ':
          if (quoteLevel == 0) {
            ls.Add(sb.ToString());
            sb.Clear();
            break;
          } 
          goto default; 
        case '"':
        case '\'':
          if (quoteChar[quoteLevel] == ch) {
            --quoteLevel;
          } else {
            quoteChar[++quoteLevel] = ch;
          }
          goto default; 
        default:
          sb.Append(ch);
          break;
      }
    }
    if (sb.Length > 0) { ls.Add(sb.ToString()); sb.Clear(); }

    return Arguments.ParseCmdLine(ls.ToArray());
  } 
```

这里有一些额外的代码来解析对象的命令行参数：

```
 public struct Argument {
    public string Prefix;
    public string Name;
    public string Eq;
    public string QuoteType;
    public string Value;

    public string[] ToArray() => this.Eq == " " ? new string[] { $"{Prefix}{Name}", $"{QuoteType}{Value}{QuoteType}" } : new string[] { this.ToString() };
    public override string ToString() => $"{Prefix}{Name}{Eq}{QuoteType}{Value}{QuoteType}";
  }

  private static readonly Regex RGX_MatchArg = new Regex(@"^(?<prefix>-{1,2}|\/)(?<name>[a-zA-Z][a-zA-Z_-]*)(?<assignment>(?<eq>[:= ]|$)(?<quote>[""'])?(?<value>.+?)(?:\k<quote>|\s*$))?");
  private static readonly Regex RGX_MatchQuoted = new Regex(@"(?<quote>[""'])?(?<value>.+?)(?:\k<quote>|\s*$)");

  public static Argument[] ParseCmdLine(string[] rawArgs) {
    int count = 0;
    Argument[] pairs = new Argument[rawArgs.Length];

    int i = 0;
    while(i < rawArgs.Length) {
      string current = rawArgs[i];
      i+=1;
      Match matches = RGX_MatchArg.Match(current);
      Argument arg = new Argument();
      arg.Prefix = matches.Groups["prefix"].Value;
      arg.Name = matches.Groups["name"].Value;
      arg.Value = matches.Groups["value"].Value;
      if(!string.IsNullOrEmpty(arg.Value)) {
        arg.Eq = matches.Groups["eq"].Value;
        arg.QuoteType = matches.Groups["quote"].Value;
      } else if ((i < rawArgs.Length) && !rawArgs[i].StartsWith('-') && !rawArgs[i].StartsWith('/')) {
        arg.Eq = " ";
        Match quoted = RGX_MatchQuoted.Match(rawArgs[i]);
        arg.QuoteType = quoted.Groups["quote"].Value;
        arg.Value = quoted.Groups["value"].Value;
        i+=1;
      }
      if(string.IsNullOrEmpty(arg.QuoteType) && arg.Value.IndexOfAny(new char[] { ' ', '/', '\\', '-', '=', ':' }) >= 0) {
        arg.QuoteType = "\"";
      }
      pairs[count++] = arg;
    }

    return pairs.Slice(0..count);
  }

  public static ILookup<string, Argument> ToLookup(this Argument[] args) => args.ToLookup((arg) => arg.Name, StringComparer.OrdinalIgnoreCase);
} 
```

它能够解析所有不同类型的参数变体：

```
-test -environment staging /DEqTest=avalue /Dcolontest:anothervalue /DwithSpaces="heys: guys" /slashargflag -action="Do: 'The Thing'" -action2 "do: 'Do: \"The Thing\"'" -init 
```

嵌套引用只需要在不同的引用类型之间交替。

# c# - 如何从虚拟键代码转换为 System.Windows.Forms.Keys

> ID：554015
> 
> 赞同：10
> 
> 时间：2009-02-16T18:04:25.597
> 
> 标签：c#, .net, winapi, key

如果我使用 win32 调用拦截按键，我现在有一个键码。有没有办法将其转换为 System.Windows.Forms.Keys 值？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-02-16T18:16:49.657

使用[`KeyInterop.KeyFromVirtualKey()`](https://docs.microsoft.com/en-us/dotnet/api/system.windows.input.keyinterop.keyfromvirtualkey).

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-16T18:38:34.050

System.Windows.Forms.Keys 枚举的整数值与 Win32 调用的值匹配。

```
Keys keyData = (Keys)rawWin32KeyCode; 
```

# c# - 将工作扩展到多台机器的最佳方法是什么？

> ID：554024
> 
> 赞同：4
> 
> 时间：2009-02-16T18:06:38.090
> 
> 标签：c#, performance, scaling

我们正在开发一个 .NET 应用程序，它必须对第 3 方 Web 服务进行多达数万次小型 Web 服务调用。我们更喜欢更“矮胖”的电话，但第 3 方不支持它。我们将客户端设计为使用可配置数量的工作线程，并通过测试获得了针对一台多核机器进行了相当优化的代码。但是，我们仍然希望提高速度，并且正在考虑将工作分散到多台机器上。我们精通典型的客户端/服务器/数据库应用程序，但对多台机器的设计却很陌生。因此，与此相关的几个问题：

*   除了多线程之外，是否还有其他客户端优化可以提高 http 请求/响应的速度？（我应该注意这是一个非标准的 web 服务，所以是使用 WebClient 实现的，而不是 WCF 或 SOAP 客户端）
*   我们目前的想法是使用 WCF 将工作块发布到 MSMQ，并在一台或多台机器上运行客户端以将工作从队列中拉出。我们有使用 WCF + MSMQ 的经验，但要确保我们不会错过更好的选择。今天还有其他更好的方法吗？
*   我见过一些 3rd 方工具，例如 DigiPede 和 Microsoft 的 HPC 产品，但这些似乎有点矫枉过正。对这些产品有任何经验或我们应该考虑使用它们而不是我们自己的产品吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-16T18:54:32.920

听起来您的目标是尽可能快地执行所有这些 Web 服务调用，并将结果制成表格。鉴于此，您最大的效率控制将是通过扩展您可以发出的并发请求的数量。

请务必查看您的[客户端连接限制](http://msdn.microsoft.com/en-us/library/system.net.servicepoint.connectionlimit.aspx)。默认情况下，我认为系统默认是2个连接。我自己没有尝试过，但是通过使用此属性增加连接数，理论上您应该会看到通过从单台机器生成更多连接来生成更多请求方面的乘数效应。MS论坛上有[更多信息](http://social.microsoft.com/forums/en-US/netfxnetcom/thread/1f863f20-09f9-49a5-8eee-17a89b591007)。

MSMQ 选项运行良好。我自己正在运行该配置。ActiveMQ 也是一个很好的解决方案，但是 MSMQ 已经在服务器上。

你有一个很好的起点。让它运行起来，然后转向性能和吞吐量。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T18:58:12.443

在今年的 CodeMash 上，Wesley Faler 就这类问题做了一个有趣的演示。他的解决方案是将“工作”存储在数据库中，然后使用客户端下拉工作并在完成时标记状态。

然后，他将整个基础设施推到了亚马逊的 EC2 上。

[这是他的演示文稿中的幻灯片](http://docs.google.com/Present?docid=dc6tbhk6_0cngb9zkw)——它们应该给你基本的想法：

我在本地使用多台 PC 做过类似的事情——管理工作负载的基础与 Faler 的方法相似。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-16T19:03:07.440

如果您已优化代码，则可以考虑优化网络端以最小化发送的数据包数量：

*   重用 HTTP 会话（即：通过保持连接打开将多个事务合并到一个会话中，减少 TCP 开销）
*   将请求中的 HTTP 标头数量减少到最少以节省带宽
*   如果服务器支持，请使用 gzip 压缩请求的正文（需要平衡 CPU 使用率进行压缩，以及节省的带宽）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-16T18:55:29.813

您可能需要考虑[Rhino Service Bus](http://ayende.com/Blog/archive/2008/12/17/rhino-service-bus.aspx)而不是 MSMQ。源代码可[在此处](https://rhino-tools.svn.sourceforge.net/svnroot/rhino-tools/trunk/rhino-service.bus/)获得。

# cookies - iframe 中的 Facebook Connect 应用程序在 IE7 中不起作用

> ID：554039
> 
> 赞同：5
> 
> 时间：2009-02-16T18:10:06.163
> 
> 标签：cookies, facebook

我正在构建一个在 Google 小工具中运行的 Facebook Connect 应用程序。作为一个小工具意味着应用程序在 iframe 中运行。在应用程序内部，有一个允许注册用户发表评论的表单。提交是使用 AJAX 进行的，但我使用普通表单得到了相同的结果。问题是我需要获取用户的 facebook id。在 Firefox 中，它工作正常，但在 Internet Explorer 7 上，我收到以下错误：

```
 'A session key is required for calling this method' 
```

我相信这是由于 IE 处理第三方 cookie 的方式，因为如果我转到 Internet 选项/隐私/高级，并选中覆盖自动 cookie 处理并接受所有 cookie，它工作正常。我无法通过 javascript 传递 Facebook id，因为任何人都可以篡改它。

编辑：如果我直接打开 iframe 的内容，应用程序工作正常。问题实际上是由于 IFRAME 和 IE 安全模型造成的。

我做错了什么？我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-17T03:01:00.770

您是否尝试过添加 P3P 策略？

如果设置 cookie 的响应具有紧凑策略，IE 将使用它来确定是否允许 3rd 方 cookie。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-30T18:20:41.393

我通过修改在 FB 连接登录后检查用户是否在 PHP 页面上登录的方式解决了同样的问题。

因此，他们使用 IE7 登录 FB Connect。我需要验证它们确实登录到 FaceBook 的下一个和后续页面加载我使用了以下代码（注意 $facebook->require_login() 和其他函数不起作用 - 它们仅在 IE 7 中返回 null）：

`// Validate from Facebook that session is valid and user is logged in. require_once 'facebook/facebook.php'; $facebook = new Facebook(YourAppsAPIKeyPublic, YourAppsAPIKeySecret); $facebook->api_client->session_key = $this->userAPISessionKey; $fb_user_id = $facebook->api_client->users_getLoggedInUser();`

$fb_user_id 现在应该有一个有效的 Facebook 用户 ID。

# 关于隐私政策和 facebook connect + IE 7：

虽然这对我不起作用，但似乎对其他人有用。在 HTAccess 中：

`Header append P3P "CP=\"HONK\""`

或在 PHP 文件中：

`header('P3P: CP="CAO PSA OUR"');` 或者 `header('P3P: CP="HONK"');`

参考： http: [//forum.developers.facebook.com/viewtopic.php?id=28636](http://forum.developers.facebook.com/viewtopic.php?id=28636)

ASP.NET：

```
protected void Application_BeginRequest(Object sender, EventArgs e)
{
    HttpContext.Current.Response.AddHeader("p3p", "CP=\"CAO PSA OUR\"");
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-16T20:17:12.970

我找到了一个可行的解决方法，尽管它有点难看：当用户单击“登录”按钮时，它会打开一个来自我自己的站点的弹出窗口，其中包含 Facebook Connect 登录按钮。用户登录后，我关闭弹出窗口并重新加载 iframe。

这真的很难看，因为它打开了两个弹出窗口，但至少它有效。我将检测是否使用 javascript 启用了 cookie，如果启用，我将跳过第一个弹出窗口。

我仍然愿意接受更好的解决方案......

* * *

**编辑**：Facebook 现在在我的弹出窗口中使用“假”弹出窗口，而不是打开另一个窗口。现在我只有一个对我来说没问题的弹出窗口。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-22T11:38:46.747

你可能还想看看这个线程，它是在 facebook 开发者平台下创建的

[http://forum.developers.facebook.com/viewtopic.php?id=452](http://forum.developers.facebook.com/viewtopic.php?id=452)

# c# - LINQ to Data：聪明的类型识别

> ID：554044
> 
> 赞同：1
> 
> 时间：2009-02-16T18:11:02.680
> 
> 标签：c#, linq, types, casting

在处理数学问题时，我非常喜欢 LINQ to Data。

当我使用的 IEnumerable 已经是一个数组时，我想知道 LINQ 是否足够聪明，可以避免像 .ToArray() 这样的强制转换。请参见下面的示例：

```
/// <summary> Transforms an array of timeSeries into one ModelData. </summary>
public static ModelData ToModelData(this IEnumerable<TimeSerieInfo> timeSeries)
{
    var seriesArray = timeSeries as TimeSerieInfo[];
    return null != seriesArray ? 
        new ModelData(seriesArray) : 
        new ModelData(timeSeries.ToArray());
} 
```

当 已经是数组时，LINQ 是否会避免转换为`IEnumerable<TimeSerieInfo> timeSeries`数组？

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-16T19:33:18.240

LINQ 创建数组的副本，这是IMO*的正确行为。*`ToArray()`如果调用然后修改返回的数组*有时会*修改原始集合而*有时*不会，这将是非常混乱的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-16T18:15:45.290

我怀疑它会按照您的要求创建一个新数组。你不能改变你的构造函数`ModelData`来`IEnumerable`代替吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-16T18:48:58.707

LINQ 确实创建了数组的副本；它创建一个`System.Linq.Buffer<T>`，它创建数组的副本。

您可以创建自己的扩展方法：

```
public static TSource[] ToArrayPreserved<TSource>(this IEnumerable<TSource> source)
{
    return (source as TSource[]) ??  source.ToArray();
} 
```

# sql-server - 以编程方式确定 SQL 故障转移方案中的主服务器

> ID：554059
> 
> 赞同：1
> 
> 时间：2009-02-16T18:14:08.307
> 
> 标签：sql-server, wmi, monitoring, failover

第 1 部分：在 Microsoft SQL Server 2005 故障转移场景中，如何查询数据库以确定哪个服务器是主服务器，哪个服务器是从服务器？我正在寻找比尝试在服务器上查询并查看哪个引发异常更优雅的东西。

第 2 部分：有没有办法监控和确定主 SQL Server 何时故障转移到从服务器？

这样做的最终目标是有一个脚本或其他方法来跟踪服务器并在发生故障转移时发送通知。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-16T20:18:58.177

从 SQL 2005 BOL 开始，有这篇文章[Monitoring Mirroring Status](http://msdn.microsoft.com/en-us/library/ms365781(SQL.90).aspx)看起来很有用。

否则，如果您从镜像数据库中的存储过程中查询 SELECT @@SERVERNAME，您将能够确定哪个 SQL Server 是主服务器。

# c++ - 如何使用 cout 以全精度打印双精度值？

> ID：554063
> 
> 赞同：404
> 
> 时间：2009-02-16T18:15:18.240
> 
> 标签：c++, floating-point, precision, iostream, cout

在我[之前的问题](https://stackoverflow.com/questions/553974/why-does-int55-54-in-c)中，我正在打印一个在我没有预料到的情况下被四舍五入的`double`使用。`cout`如何使用全精度进行`cout`打印？`double`

* * *

## 回答 #1

> 赞同：469
> 
> 时间：2009-02-16T18:38:50.290

您可以直接设置精度`std::cout`并使用[`std::fixed`](http://en.cppreference.com/w/cpp/io/manip/fixed)格式说明符。

```
double d = 3.14159265358979;
cout.precision(17);
cout << "Pi: " << fixed << d << endl; 
```

您`#include <limits>`可以获得浮点数或双精度数的最大精度。

```
#include <limits>

typedef std::numeric_limits< double > dbl;

double d = 3.14159265358979;
cout.precision(dbl::max_digits10);
cout << "Pi: " << d << endl; 
```

* * *

## 回答 #2

> 赞同：83
> 
> 时间：2009-02-16T18:18:08.513

使用[`std::setprecision`](http://en.cppreference.com/w/cpp/io/manip/setprecision)：

```
#include <iomanip>
std::cout << std::setprecision (15) << 3.14159265358979 << std::endl; 
```

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2009-02-16T22:10:04.150

这是我会使用的：

```
std::cout << std::setprecision (std::numeric_limits<double>::digits10 + 1)
          << 3.14159265358979
          << std::endl; 
```

基本上，limits 包具有所有内置类型的特征。
浮点数（float/double/long double）的特征之一是digits10属性。这定义了以 10 为底的浮点数的准确性（我忘记了确切的术语）。

有关其他属性的详细信息，请参见：[http ://www.cplusplus.com/reference/std/limits/numeric_limits.html。](http://www.cplusplus.com/reference/std/limits/numeric_limits.html)

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2020-12-16T19:19:17.153

在 C++20 中，您将能够使用它[`std::format`](https://en.cppreference.com/w/cpp/utility/format)来执行此操作：

```
std::cout << std::format("{}", M_PI); 
```

输出（假设 IEEE754 `double`）：

```
3.141592653589793 
```

默认浮点格式是具有往返保证的最短十进制表示。与 I/O 操纵器相比，这种方法的优势`setprecision`在于它不会打印不必要的数字。

同时你可以使用[基于的 {fmt}](https://github.com/fmtlib/fmt)库`std::format`。{fmt} 还提供了`print`使这更容易和更高效的功能（[godbolt](https://godbolt.org/z/ej48Wa)）：

```
fmt::print("{}", M_PI); 
```

**免责声明**：我是 {fmt} 和 C++20 的作者`std::format`。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2011-08-05T17:35:07.943

iostreams 方式有点笨拙。我更喜欢使用[`boost::lexical_cast`](http://www.boost.org/doc/libs/release/libs/conversion/lexical_cast.htm)，因为它为我计算了正确的精度。而且[它也很快](http://www.boost.org/doc/libs/1_47_0/libs/conversion/lexical_cast.htm#performance)。

```
#include <string>
#include <boost/lexical_cast.hpp>

using boost::lexical_cast;
using std::string;

double d = 3.14159265358979;
cout << "Pi: " << lexical_cast<string>(d) << endl; 
```

输出：

> 圆周率：3.14159265358979

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2018-09-12T16:24:22.113

> 如何`double`使用 cout 以全精度打印值？

使用`hexfloat`或
使用`scientific`设置精度

```
std::cout.precision(std::numeric_limits<double>::max_digits10 - 1);
std::cout << std::scientific <<  1.0/7.0 << '\n';

// C++11 Typical output
1.4285714285714285e-01 
```

* * *

太多的答案只针对 1) 基础 2) 固定/科学布局或 3) 精度之一。太多*精确*的答案不能提供所需的正确值。因此，这是对一个老问题的回答。

1.  什么基础？

A`double`肯定是使用 base 2 编码的。使用 C++11 的直接方法是使用`std::hexfloat`.
如果非十进制输出是可以接受的，我们就完成了。

```
std::cout << "hexfloat: " << std::hexfloat << exp (-100) << '\n';
std::cout << "hexfloat: " << std::hexfloat << exp (+100) << '\n';
// output
hexfloat: 0x1.a8c1f14e2af5dp-145
hexfloat: 0x1.3494a9b171bf5p+144 
```

* * *

2.  否则：`fixed`或`scientific`？

A`double`是*浮点*类型，而不是*定点*。

请勿使用，因为它**无法**`std::fixed`打印小`double`，但`0.000...000`. 对于 large `double`，它会打印许多数字，可能是*数百个*有问题的信息量。

```
std::cout << "std::fixed: " << std::fixed << exp (-100) << '\n';
std::cout << "std::fixed: " << std::fixed << exp (+100) << '\n';
// output
std::fixed: 0.000000
std::fixed: 26881171418161356094253400435962903554686976.000000 
```

要以全精度打印，首先使用`std::scientific`它将“以科学计数法写入浮点值”。注意小数点后6位的默认值，不足的数量，下一点处理。

```
std::cout << "std::scientific: " << std::scientific << exp (-100) << '\n';  
std::cout << "std::scientific: " << std::scientific << exp (+100) << '\n';
// output
std::scientific: 3.720076e-44
std::scientific: 2.688117e+43 
```

* * *

3.  多少精度（总位数）？

`double`使用二进制基数 2 编码的A在 2 的各种幂之间编码相同的精度。这通常是 53 位。

[1.0...2.0) 有 2 ^(53)种不同`double`，
[2.0...4.0) 有 2 ^(53)种不同`double`，
[4.0...8.0) 有 2 ^(53)种不同`double`，
[8.0...10.0) 有 2/ 8 * 2 ^(53)不同`double`。

然而，如果代码以十进制打印且`N`有效数字，则组合数 [1.0...10.0) 为 9/10 * 10 ^N。

**无论选择什么（精度） ，十进制文本`N`之间都不会存在一对一的映射。`double`** 如果选择了一个固定值，有时它会比某些值`N`真正需要的稍多或少一些。`double`我们可能会在太少（`a)`下）或太多（`b)`下）上出错。

3名候选人`N`：

a) 在从 text--text 转换时使用`N`so，`double`我们会为 all 得到相同的文本`double`。

```
std::cout << dbl::digits10 << '\n';
// Typical output
15 
```

b)`N`在从`double`-text-转换时使用 so，我们对 all`double`得出相同的结果。`double``double`

```
// C++11
std::cout << dbl::max_digits10 << '\n';
// Typical output
17 
```

当`max_digits10`不可用时，请注意，由于 base 2 和 base 10 属性`digits10 + 2 <= max_digits10 <= digits10 + 3`，我们可以使用`digits10 + 3`来确保打印足够的十进制数字。

c) 使用`N`随值变化的 an。

当代码想要显示最少的文本 ( `N == 1`) 或 a 的*确切*值`double`（`N == 1000-ish`在 的情况下`denorm_min`）时，这可能很有用。然而，由于这是“工作”并且不太可能是 OP 的目标，因此它将被搁置一旁。

* * *

通常是 b) 用于“`double`以全精度打印值”。一些应用程序可能更喜欢 a) 在不提供太多信息时出错。

使用`.scientific`,`.precision()`设置要在小数点后打印的位数，因此`1 + .precision()`会打印数字。代码需要`max_digits10`总位数，因此`.precision()`用`max_digits10 - 1`.

```
typedef std::numeric_limits< double > dbl;
std::cout.precision(dbl::max_digits10 - 1);
std::cout << std::scientific <<  exp (-100) << '\n';
std::cout << std::scientific <<  exp (+100) << '\n';
// Typical output
3.7200759760208361e-44
2.6881171418161356e+43
//2345678901234567  17 total digits 
```

[类似的 C 题](https://stackoverflow.com/q/16839658/2410359)

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2016-01-01T13:57:17.447

以下是如何以全精度显示双精度：

```
double d = 100.0000000000005;
int precision = std::numeric_limits<double>::max_digits10;
std::cout << std::setprecision(precision) << d << std::endl; 
```

这显示：

> 100.0000000000005

max_digits10 是唯一表示所有不同的双精度值所需的位数。max_digits10 表示小数点前后的位数。

**不要将 set_precision(max_digits10) 与 std::fixed 一起使用。**
在固定表示法上， set_precision()仅设置小数点**后的位数。****这是不正确的，因为**max_digits10 表示小数点**前后**的位数。

 **```
double d = 100.0000000000005;
int precision = std::numeric_limits<double>::max_digits10;
std::cout << std::fixed << std::setprecision(precision) << d << std::endl; 
```

这显示不正确的结果：

> 100.00000000000049738

注意：需要头文件

```
#include <iomanip>
#include <limits> 
```

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2015-10-24T20:36:30.767

通过全精度，我假设有足够的精度来显示预期值的最佳近似值，但应该指出的`double`是，使用 base 2 表示存储，base 2 不能`1.1`准确地表示微不足道的东西。**获得实际双**精度的唯一方法（没有 ROUND OFF 错误）是打印出二进制位（或十六进制 nybbles）。

这样做的一种方法是使用 a`union`将其键入`double`到整数，然后打印整数，因为整数不会受到截断或舍入问题的影响。（C++ 标准不支持像这样的类型双关语，但在 C 中支持。但是，大多数 C++ 编译器可能无论如何都会打印出正确的值。我认为 g++ 支持这一点。）

```
union {
    double d;
    uint64_t u64;
} x;
x.d = 1.1;
std::cout << std::hex << x.u64; 
```

这将为您提供双精度的 100% 准确度......并且完全不可读，因为人类无法阅读 IEEE 双格式！ [维基百科](https://en.wikipedia.org/wiki/Double-precision_floating-point_format)对如何解释二进制位有很好的描述。

在较新的 C++ 中，您可以这样做

```
std::cout << std::hexfloat << 1.1; 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2020-12-12T15:20:48.580

**C++20`std::format`**

这个伟大的新 C++ 库功能具有不影响状态的`std::cout`优点`std::setprecision`：

```
#include <format>
#include <string>

int main() {
    std::cout << std::format("{:.2} {:.3}\n", 3.1415, 3.1415);
} 
```

预期输出：

```
3.14 3.142 
```

如[https://stackoverflow.com/a/65329803/895245](https://stackoverflow.com/a/65329803/895245)所述，如果您没有明确传递精度，它将打印具有往返保证的最短十进制表示。TODO 更详细地了解它与以下内容的比较：如`dbl::max_digits10`https://stackoverflow.com/a/554134/895245[所示](https://stackoverflow.com/a/554134/895245)`{:.{}}`：

```
#include <format>
#include <limits>
#include <string>

int main() {
    std::cout << std::format("{:.{}}\n",
        3.1415926535897932384626433, dbl::max_digits10);
} 
```

也可以看看：

*   [在 C++ 中设置默认浮点打印精度，](https://stackoverflow.com/questions/12560291/set-back-default-floating-point-print-precision-in-c/53673686#53673686)以了解如何在 pre-c++20 中恢复初始精度
*   [std::string 格式化，如 sprintf](https://stackoverflow.com/questions/2342162/stdstring-formatting-like-sprintf/57286312#57286312)
*   [https://en.cppreference.com/w/cpp/utility/format/formatter#Standard_format_specification](https://en.cppreference.com/w/cpp/utility/format/formatter#Standard_format_specification)

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2020-06-23T19:59:50.913

[IEEE 754](https://en.wikipedia.org/wiki/IEEE_754)浮点值使用 base 2 表示存储。任何以 2 为底的数字都可以表示为完全精度的小数（以 10 为底）。然而，所有提议的答案都没有。它们**都**截断十进制值。

这似乎是由于对[`std::numeric_limits<T>::max_digits10`](https://en.cppreference.com/w/cpp/types/numeric_limits/max_digits10)代表的误解：

> 的值`std::numeric_limits<T>::max_digits10`是唯一表示 type 的所有不同值所必需的以 10 为基数的位数`T`。

换句话说：如果你想从二进制到十进制再到二进制，它是输出所需的（最坏情况）位数，而不会丢失任何信息。如果您至少输出`max_digits10`小数并重建浮点值，则可以保证获得与开始时完全相同的二进制表示。

重要的是：`max_digits10`通常既不会产生最短的小数，也不足以表示完整的精度。我不知道 C++ 标准库中有一个常量，它编码包含浮点值的完整精度所需的最大十进制数字。我相信这类似于`double`s ¹的 767 。以全精度输出浮点值的一种方法是使用足够大的精度值，[例如](https://godbolt.org/z/K6c0_l)²，并让库去除任何尾随零：

```
#include <iostream>

int main() {
    double d = 0.1;
    std::cout.precision(767);
    std::cout << "d = " << d << std::endl;
} 
```

这会产生以下输出，其中包含完整的精度：

```
d = 0.1000000000000000055511151231257827021181583404541015625 
```

请注意，这比`max_digits10`建议的小数点要多得多。

* * *

虽然这回答了所提出的问题，但更常见的目标是获得任何给定浮点值的*最短十进制表示，它保留所有信息。*同样，我不知道有任何方法可以指示标准 I/O 库输出该值。从 C++17 开始，进行这种转换的可能性终于以[`std::to_chars`](https://en.cppreference.com/w/cpp/utility/to_chars). 默认情况下，它会生成保留全部信息的任何给定浮点值的最短十进制表示。

它的界面有点笨拙，您可能希望将其包装到一个函数模板中，该模板返回您可以输出的`std::cout`内容（如 a `std::string`），例如

```
#include <charconv>
#include <array>
#include <string>
#include <system_error>

#include <iostream>
#include <cmath>

template<typename T>
std::string to_string(T value)
{
    // 24 characters is the longest decimal representation of any double value
    std::array<char, 24> buffer {};
    auto const res { std::to_chars(buffer.data(), buffer.data() + buffer.size(), value) };
    if (res.ec == std::errc {})
    {
        // Success
        return std::string(buffer.data(), res.ptr);
    }

    // Error
    return { "FAILED!" };
}

int main()
{
    auto value { 0.1f };
    std::cout << to_string(value) << std::endl;
    value = std::nextafter(value, INFINITY);
    std::cout << to_string(value) << std::endl;
    value = std::nextafter(value, INFINITY);
    std::cout << to_string(value) << std::endl;
} 
```

这将打印出来（使用[Microsoft 的 C++ 标准库](https://github.com/microsoft/STL)）：

```
0.1
0.10000001
0.10000002 
```

* * *

¹ *来自 Stephan T. Lavavej 的 CppCon 2019 演讲，标题为[Floating-Point <charconv>: Making Your Code 10x Faster With C++17's Final Boss](https://youtu.be/4P_kbF0EbZM?t=688)。（整个演讲值得一看。）*

² *这还需要使用 和 的组合`scientific`，`fixed`以较短者为准。我不知道使用 C++ 标准 I/O 库设置此模式的方法。*

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2010-01-24T17:34:56.330

```
printf("%.12f", M_PI); 
```

%.12f 表示浮点数，精度为 12 位。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-16T18:39:43.830

最便携...

```
#include <limits>

using std::numeric_limits;

    ...
    cout.precision(numeric_limits<double>::digits10 + 1);
    cout << d; 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2021-04-26T12:01:09.890

在[这个问题](https://stackoverflow.com/q/53683457/3882652)中，有一个关于如何无损地将双精度转换为字符串的描述（在 Octave 中，但它可以在 C++ 中轻松复制）。想法是对浮点数进行简短的人类可读描述和六进制形式的无损描述，例如：pi -> 3.14{54442d18400921fb}。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-04-11T13:39:33.107

**这将在点后显示最多两位小数的值。**

```
#include <iostream>
#include <iomanip>

double d = 2.0;
int n = 2;
cout << fixed << setprecision(n) << d; 
```

**见这里：** [定点符号](https://www.tutorialspoint.com/fixed-point-and-floating-point-number-representations)

[标准::固定](http://www.cplusplus.com/reference/ios/fixed/)

> 使用固定浮点表示法 将 str 流的浮点字段格式标志设置为固定。
> 
> 当 floatfield 设置为 fixed 时，浮点值使用定点表示法写入：该值由精度字段 (precision) 指定的小数部分中的位数表示，并且没有指数部分。

[std::setprecision](http://www.cplusplus.com/reference/iomanip/setprecision/)

> 设置小数精度 设置用于格式化输出操作的浮点值的小数精度。

**如果您熟悉表示浮点数的 IEEE 标准，您就会知道在标准范围之外不可能以全精度显示浮点数**，也就是说，它总是会导致实际值的四舍五入。

*您需要首先检查该值是否在范围内*，如果是，则使用：

```
cout << defaultfloat << d ; 
```

[std::defaultfloat](http://www.cplusplus.com/reference/ios/defaultfloat/)

> 使用默认浮点表示法 将 str 流的 floatfield 格式标志设置为 defaultfloat。
> 
> 当 floatfield 设置为 defaultfloat 时，浮点值使用默认表示法写入：表示使用尽可能多的有意义的数字，直到流的小数精度（precision），计算小数点之前和之后的数字（如果有）。

这也是 的默认行为`cout`，这意味着您不会显式使用它。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-06-23T16:11:07.970

这是一个适用于任何浮点类型的函数，而不仅仅是`double`，它还可以将流恢复为后来找到的方式。不幸的是，它不能与线程很好地交互，但这就是 iostreams 的本质。您需要在文件开头包含以下内容：

```
#include <limits>
#include <iostream> 
```

这是函数，如果你经常使用它，你可以在头文件中使用它：

```
template <class T>
void printVal(std::ostream& os, T val)
{
    auto oldFlags = os.flags();
    auto oldPrecision = os.precision();

    os.flags(oldFlags & ~std::ios_base::floatfield);
    os.precision(std::numeric_limits<T>::digits10);
    os << val;

    os.flags(oldFlags);
    os.precision(oldPrecision);
} 
```

像这样使用它：

```
double d = foo();
float f = bar();
printVal(std::cout, d);
printVal(std::cout, f); 
```

如果您希望能够使用正常的插入`<<`运算符，您可以使用这个额外的包装代码：

```
template <class T>
struct PrintValWrapper { T val; };
template <class T>
std::ostream& operator<<(std::ostream& os, PrintValWrapper<T> pvw) {
    printVal(os, pvw.val);
    return os;
}
template <class T>
PrintValWrapper<T> printIt(T val) {
    return PrintValWrapper<T>{val};
} 
```

现在你可以像这样使用它：

```
double d = foo();
float f = bar();
std::cout << "The values are: " << printIt(d) << ", " << printIt(f) << '\n'; 
```

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2009-08-11T11:28:59.150

使用 ostream::precision(int)

```
cout.precision( numeric_limits<double>::digits10 + 1);
cout << M_PI << ", " << M_E << endl; 
```

将产生

```
3.141592653589793, 2.718281828459045 
```

为什么你必须说“+1”我不知道，但你得到的额外数字是正确的。

# java - 这些 HPROF 错误是什么意思？

> ID：554064
> 
> 赞同：0
> 
> 时间：2009-02-16T18:15:20.940
> 
> 标签：java, debugging, weblogic, hprof

我在控制台日志中看到以下错误：

```
HPROF ERROR: unable to resolve a method id
HPROF ERROR: got NULL trace in obj_alloc
HPROF ERROR: duplicate obj_id in object_alloc
HPROF ERROR: unable to resolve a method id
HPROF ERROR: got NULL trace in obj_alloc
HPROF ERROR: unable to resolve a method id
HPROF ERROR: got NULL trace in obj_alloc
HPROF ERROR: unable to resolve a method id
HPROF ERROR: got NULL trace in obj_alloc
HPROF ERROR: unable to resolve a method id
HPROF ERROR: got NULL trace in obj_alloc
HPROF ERROR: class ID already in use 
```

我在带有 SUN 1.4.2-12 JDK 的 BEA Weblogic App Server 8.1 上运行。

我在启动时将这些调试标志传递给 JVM：

```
-verbose:gc -XX:+PrintGCTimeStamps -XX:+PrintGCDetails -Xrunhprof:heap=sites,format=a,file=server1.endurance.txt 
```

启动服务器后几乎立即输出错误。

任何想法错误是什么意思？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-16T20:27:08.190

它可能是

*   JVM 中的错误，尝试使用更新的 JVM，看看是否遇到同样的问题。
*   您有一个错误地创建对象的 JNI 库。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-12T17:35:08.793

我认为这个[报告的错误](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=5053405)可能会帮助您跟踪您的问题。

> **概要：**如果线程组名称为空（jvmpi 也是），GetThreadGroupInfo 会崩溃
> 
> **报告**对象：1.4.2_03，tiger-beta2
> 
> **发布固定** 1.5(tiger-b56)
> 
> **评估：**旧版 java.lang.ThreadGroup 允许名称为空，因此 vm 需要允许这样做。

由于您使用的是类似的 jvm，我建议您检查错误报告中提供的测试代码，以确定您是否发现了相同的错误。

# sql - ON DELETE CASCADE 的临时启用

> ID：554067
> 
> 赞同：3
> 
> 时间：2009-02-16T18:15:48.050
> 
> 标签：sql, sql-server, sql-server-2005

我正在使用 SQL Server 2005。

如果不是逻辑删除，我们的应用程序几乎从不删除，因此我们不需要级联删除。

事实上，知道外键约束为我们提供了一些防止意外删除语句的保护，这是相当令人欣慰的。

但是，偶尔我需要删除顶级表及其所有子表。目前，我在写入顺序中使用多个 DELETE 语句来执行此操作，它变得非常庞大、复杂且无法保持最新​​的脚本。

我想知道是否有一种方法可以自动为数据库中的所有外键打开级联删除，执行我的顶级删除，然后再次将它们全部重新打开？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-16T18:42:20.203

编写一对脚本怎么样——一个在您要删除记录时手动运行，该记录为约束适当地启用 on delete 级联，然后让另一个脚本在完成删除后运行以禁用它们并取回正常吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T19:29:22.587

只是一个想法：在父表上使用 INSTEAD OF TRIGGER 进行删除，以便所有子记录删除逻辑都在一个地方

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-16T19:22:14.727

对于这里的另一个问题，[我编写了一个](https://stackoverflow.com/questions/485581/generate-delete-statement-from-foreign-key-relationships-in-sql-2008/485760#485760)应该自动生成删除的脚本。

# vb.net - 什么在 .NET 中占用 IsNumeric() 这么长时间？

> ID：554074
> 
> 赞同：2
> 
> 时间：2009-02-16T18:17:26.270
> 
> 标签：vb.net, performance, isnumeric

今天正在使用 IsNumeric 进行一些基准测试，并将其与以下函数进行比较：

```
Private Function IsNumeric(ByVal str As String) As Boolean
    If String.IsNullOrEmpty(Str) Then Return False
    Dim c As Char

    For i As Integer = 0 To Str.Length - 1
        c = Str(i)
        If Not Char.IsNumber(c) Then Return False
    Next

    Return True
End Function 
```

我对结果感到非常惊讶。使用数值时，它比常规 IsNumeric() 快 8-10 倍，使用空值或非数值时，它快 1000-1500 倍。

什么是 IsNumeric 这么长时间？在用上面的函数替换它之前，我还应该考虑其他事情吗？我在我的网站上大约 50 个不同的地方使用 IsNumeric，主要用于验证表单和查询字符串。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-16T18:20:12.690

您在哪里检查特定于语言环境的分隔符和小数位？否定？指数符号？

你看，你的函数只是数字字符串的一小部分。

```
1,000,000.00
1,5E59
-123456789 
```

你错过了所有这些。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-16T18:21:26.260

单个 char 只能包含 0、1、2、3、4、5、6、7、8、9

但完整的字符串可能包含以下任何内容：

```
1
1234
12.34
-1234
-12.34
0001 
```

所以 IsNumeric 应该会慢一些。

还有文化和国际化问题。即，如果您正在处理 Unicode 字符串，IsNumeric 是否也处理来自所有其他语言的数字？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-16T18:35:32.450

一般来说，我会避免重复或替换这样的语言功能，尤其是在像 VB 这样的语言中，它必然会为您实现许多用例。至少，我会将您的方法命名为不同的名称，以免其他开发人员感到困惑。

速度差异必然是因为您的代码所做的工作远远少于 VB 语言功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T20:46:49.007

我会用

```
整数.TryParse()
```

或者

```
Double.TryParse()
```

取决于您使用的数据类型，因为这两者都考虑了地区差异。

# session - 清除所有网站缓存？

> ID：554088
> 
> 赞同：2
> 
> 时间：2009-02-16T18:21:00.240
> 
> 标签：session, caching, browser-cache

是否可以清除所有站点缓存？我想在用户注销或会话到期时执行此操作，而不是指示浏览器不要缓存每个请求。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-16T18:31:03.913

据我所知，没有办法指示浏览器清除它为您的网站缓存的所有页面。当浏览器尝试访问该页面时，您作为网站作者可以对页面进行过度缓存的唯一控制。您可以使用标头指定页面的缓存版本应在特定时间过期`Expires`，但即使那样浏览器实际上也不会在那时从其缓存中清除页面。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-16T18:41:06.133

我当然不希望 - 这会给网站对客户端机器的破坏力！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-16T18:52:37.963

如果安全是您主要关心的问题，为什么不使用 HTTPS？浏览器不会缓存通过 HTTPS 接收的内容（或仅将其缓存在内存中）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-16T19:11:13.660

模仿这一点的一种棘手方法是在引用站点上的任何静态内容时将 session-id 作为参数包含在内。当用户建立会话时，由于包含此参数，浏览器会将所有内容片段识别为新内容。在会话期间，浏览器将使用其缓存中的静态内容。用户注销并重新登录后，静态内容的 session-id 参数将有所不同，因此浏览器将识别这是全新的内容并重新下载所有内容。

That being said... this is a hack and I wouldn't recommend pursuing it.. For what reason do you want the user's cache to be cleared after their session expires? There's probably a better solution that can fit your situation as opposed to what you are currently asking for.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-16T18:50:09.153

如果你在谈论 asp.net 缓存对象，你可以使用这个：

```
 For Each elem As DictionaryEntry In Cache
      Cache.Remove(elem.Key)
    Next 
```

从缓存中删除项目，但这可能不是您尝试完成的全部内容。

# vb.net - 来自 VB .NET 中非托管 dll 的回调函数

> ID：554091
> 
> 赞同：0
> 
> 时间：2009-02-16T18:22:52.807
> 
> 标签：vb.net, dll, interop, unmanaged

我正在尝试在 VB.NET 中使用非托管 dll。随 dll 提供的示例源代码在 VB6 中，下面是我尝试将其转换为 .NET。当 dll 尝试执行回调时，我收到“尝试读取或写入受保护的内存”异常。我真的不关心实际调用的回调函数。我的代码：

```
<DllImport("AlertMan.dll")> _
Public Shared Function AlertManC( _
    ByVal CallbackAddr As AlertManCallbackDel) As Long
End Function

Public Delegate Sub AlertManCallbackDel(ByVal data As Long)

Public Sub AlertManCallback(ByVal data As Long)       
End Sub

Public mydel As New AlertManCallbackDel(AddressOf AlertManCallback)
'protected memeory exception here
Dim IStat as Long = AlertManC(mydel) 
```

原始VB6示例代码：

```
Declare Function AlertManC _
    Lib "AlertMan.dll" _
    Alias "AlertManC" (ByVal CallbackAddr As Long) As Long

Private Sub AlertManCallback(ByVal data As Long)
End Sub

' calling code
Dim IStat As Long
IStat = AlertManC(AddressOf AlertManCallBack) 
```

原始dll头

```
typedef void TACBFUNC(char *);
int AlertManC(TACBFUNC *WriteCaller cHANDLEPARM); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-16T18:29:46.520

您可以发布 AlertManC 的原始本地定义吗？

不过我的猜测是回调函数的数据参数实际上是一个整数与一个长整数。在 VB6 中，我相信 Long 实际上只有 32 位，而 VB.Net 是 64 位。试试这个

```
 <DllImport("AlertMan.dll")> _
   Public Shared Function AlertManC(ByVal CallbackAddr As AlertManCallbackDel) As Long
   End Function

   Public Delegate Sub AlertManCallbackDel(ByVal data As IntPtr)

   Public Sub AlertManCallback(ByVal data As IntPtr)       
   End Sub 
```

**编辑**

我根据您发布的本机签名更新了代码。你能试试这个吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-16T19:15:45.847

您的回调应如下所示：

```
Public Delegate Sub AlertManCallbackDel(ByRef data As Byte) 
```

这样做的原因是您通过引用传递了一个单字节值。

至于非托管函数的声明，应该是这样的：

```
<DllImport("AlertMan.dll")> _
Public Shared Function AlertManC( _
    ByVal CallbackAddr As AlertManCallbackDel) As Integer
End Function 
```

请注意，返回类型是整数，在 VB.NET 中是 32 位值。在 VB6 中，Long 是一个 32 位的值，因此需要在 VB.NET 中进行更改。

顺便说一句，回调定义也很重要。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-16T19:17:01.260

如果回调的调用约定是 cdecl，则不能直接在 C# 或 VB.NET 中执行此操作。

您必须修改委托的 IL 才能正确运行。

您可以在 CodeProject 上搜索深入的文章。

更新：

我猜这不是正确的答案:) 但会留下我的回复。

# sql-server - SSIS将字符转换为布尔值/位

> ID：554092
> 
> 赞同：15
> 
> 时间：2009-02-16T18:23:04.023
> 
> 标签：sql-server, ssis

我有一个 SSIS 包来加载数据；您可能还记得，当我尝试将它们作为位标志加载到 SQL Server 中时，数据文件中的标志为 Y/N char(1)。我将数据文件中的列指定为，`String [DT_STR]`并且我有一个数据转换任务来根据以下表达式将它们转换为布尔值（我收到了相同的转换错误，只是将它们指定为 DT_BOOL 开始，尽管 SSIS 要求我说什么它应视为布尔值的值）：

```
[ColumnName] == "Y" ? (DT_BOOL)1 : (DT_BOOL)0 
```

运行包会出现错误并告诉我`Invalid character value for cast specification`实际`The value could not be converted because of a potential loss of data`导入到 SQL Server（通过 OLE DB 目标）。

我在这里缺少什么以使其正确转换？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-17T14:30:10.223

试试这个：

```
(DT_BOOL)([ColumnName] == "Y" ? 1 : 0) 
```

这还具有自动正确设置派生列的数据类型的优点。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-17T14:35:43.983

我能够通过使用派生列来解决它，而不是替换 char 列，而是创建设置为`DT_BOOL`如下类型的新列：

```
[Recycled] == "Y" ? True : False 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-04T22:09:41.160

我有同样的问题

(DT_BOOL)([ColumnName] == "Y" ? 1 : 0)

我只能通过从表达式中取出“（DT_BOOL）”部分并通过选择“Boolean [DT_BOOL]将其转换为布尔值到“数据类型”部分的工作来使其工作。之后没有问题那。

# asp.net - asp.net mvc 添加到 AUTHORIZE 属性

> ID：554094
> 
> 赞同：12
> 
> 时间：2009-02-16T18:23:48.203
> 
> 标签：asp.net, asp.net-mvc, attributes

如何创建自定义属性以扩展 MVC 中现有的 Authorize 属性？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-16T18:34:00.877

从 AuthorizeAttribute 派生您的类。覆盖 OnAuthorization 方法。添加并设置一个 CacheValidationHandler。

```
public void CacheValidationHandler( HttpContext context,
                                    object data,
                                    ref HttpValidationStatus validationStatus )
{
    validationStatus = OnCacheAuthorization( new HttpContextWrapper( context ) );
}

public override void OnAuthorization( AuthorizationContext filterContext )
{
    if (filterContext == null)
    {
        throw new ArgumentNullException( "filterContext" );
    }

    if (AuthorizeCore( filterContext.HttpContext ))
    {
       ... your custom code ...
       SetCachePolicy( filterContext );
    }
    else if (!filterContext.HttpContext.User.Identity.IsAuthenticated)
    {
        // auth failed, redirect to login page
        filterContext.Result = new HttpUnauthorizedResult();
    }
    else
    {
       ... handle a different case than not authenticated
    }
}

protected void SetCachePolicy( AuthorizationContext filterContext )
 {
     // ** IMPORTANT **
     // Since we're performing authorization at the action level, the authorization code runs
     // after the output caching module. In the worst case this could allow an authorized user
     // to cause the page to be cached, then an unauthorized user would later be served the
     // cached page. We work around this by telling proxies not to cache the sensitive page,
     // then we hook our custom authorization code into the caching mechanism so that we have
     // the final say on whether a page should be served from the cache.
     HttpCachePolicyBase cachePolicy = filterContext.HttpContext.Response.Cache;
     cachePolicy.SetProxyMaxAge( new TimeSpan( 0 ) );
     cachePolicy.AddValidationCallback( CacheValidationHandler, null /* data */);
 } 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-16T19:29:59.653

你不需要扩展这个属性，web.config 就足够了。请阅读有关[用于身份验证的表单元素](http://msdn.microsoft.com/en-us/library/1d3t3c61(VS.80).aspx)。请注意 defaultUrl。这是你需要的东西。

```
<system.web>
  <authentication mode="Forms">
    <forms defaultUrl="YourUrlGoesHere"/>
  </authentication>
</system.web> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-16T18:29:36.177

```
public class CoolAuthorizeAttribute :  AuthorizeAttribute
{
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-07-05T19:28:39.417

我建议如果您只想扩展当前的 AuthorizeAttribute 并在其之上添加您自己的授权，而不是覆盖 OnAuthorization 只需覆盖 AuthorizeCore 并将您的 MyCustomAuthorizationHolds 条件添加到它。

```
public class CustomAuthorizeAttribute : AuthorizeAttribute
{
    // This method must be thread-safe since it is called by the thread-safe OnCacheAuthorization() method.
    protected override bool AuthorizeCore(HttpContextBase httpContext)
    {
        if (base.AuthorizeCore(httpContext) && MyCustomAuthorizationHolds)
            return true;

        return false;
    }
} 
```

# c# - 在 TreeNode (WinForms) 中访问文本选择

> ID：554095
> 
> 赞同：2
> 
> 时间：2009-02-16T18:24:03.820
> 
> 标签：c#, .net, winforms, treeview, treenode

**是否可以在**`TreeNode`WinForms的可编辑中访问有关文本选择的信息`TreeView`？

我发现了诸如`BeginEdit()`and之类的方法`EndEdit(bool cancel)`，但我需要更精细的控制粒度——诸如`TextBoxBase.SelectionStart`和`SelectionLength`属性之类的东西，但在节点本身上。

这在 C#/.Net 中可行吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-16T19:12:14.047

您将需要做一些本机互操作工作来获取用于标签的编辑控件。要获得此控制，您需要使用该[`TVM_GETEDITCONTROL`](http://msdn.microsoft.com/en-us/library/bb773576(VS.85).aspx)消息，将其发送到您想要此行为的树视图实例。

从该消息中获得窗口句柄后，您可以使用[`EM_SETSEL`](http://msdn.microsoft.com/en-us/library/bb761661(VS.85).aspx)句柄上的消息来设置选择。

# delphi - 如何知道什么是 var 类型？

> ID：554100
> 
> 赞同：10
> 
> 时间：2009-02-16T18:25:12.227
> 
> 标签：delphi, runtime, typeinfo

TypeInfo(Type) 返回指定类型的信息，有没有办法知道 var 的类型信息？

```
var
  S: string;
  Instance: IObjectType;
  Obj: TDBGrid;
  Info: PTypeInfo;
begin
  Info:= TypeInfo(S);
  Info:= TypeInfo(Instance);
  Info:= TypeInfo(Obj);
end 
```

此代码返回：

**[DCC 错误] Unit1.pas(354): E2133 TYPEINFO 标准函数需要类型标识符**

我知道非实例化的 var 只是一个指针地址。在编译时，编译器解析并进行类型安全检查。

**在运行时，有什么方法可以了解更多关于 var 的信息，只传递它的地址？**

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-02-16T18:54:47.990

不。

首先，没有“非实例化变量”之类的东西。您只需键入其名称并将其键入源文件即可实例化它。

其次，通过在源代码中查看变量，您已经了解了有关变量的所有信息。编译程序后，该变量*将不复存在。*在那之后，一切都只是一点点。

指针仅在编译时具有类型。在运行时，可以对该地址执行的所有操作都已确定。正如您已经指出的那样，编译器会对此进行检查。在运行时检查变量的类型仅在变量类型可能改变的语言中有用，例如在动态语言中。最接近德尔福的是它的`Variant`类型。变量的类型总是`Variant`，但您可以在其中存储多种类型的值。要找出它的内容，您可以使用该`VarType`功能。

任何时候你想用来`TypeInfo`获取与变量关联的类型的类型信息，你也可以直接命名你感兴趣的类型；如果变量在范围内，那么您可以找到它的声明并在调用中使用声明的类型`TypeInfo`。

如果您想将任意地址传递给函数并让该函数自己发现类型信息，那么您就不走运了。相反，您需要将该`PTypeInfo`值作为附加参数传递。这就是所有内置的 Delphi 函数所做的。例如，当您调用`New`指针变量时，编译器会插入一个附加参数，该参数保存`PTypeInfo`您正在分配的类型的值。当你调用`SetLength`一个动态数组时，编译器会插入一个`PTypeInfo`数组类型的值。

[您给出的答案](https://stackoverflow.com/questions/554100/how-to-know-what-type-is-a-var/595100#595100)表明您正在寻找与您所要求的不同的东西。鉴于您的问题，我认为您正在寻找一个可以满足此代码的假设函数：

```
var
  S: string;
  Instance: IObjectType;
  Obj: TDBGrid;
  Info: PTypeInfo;
begin
  Info:= GetVariableTypeInfo(@S);
  Assert(Info = TypeInfo(string));

  Info:= GetVariableTypeInfo(@Instance);
  Assert(Info = TypeInfo(IObjectType));

  Info:= GetVariableTypeInfo(@Obj);
  Assert(Info = TypeInfo(TDBGrid));
end; 
```

让我们使用[JCL中的](http://jcl.svn.sourceforge.net/viewvc/jcl/trunk/jcl/source/common/JclSysUtils.pas?view=markup)[`IsClass`and`IsObject`](http://jcl.svn.sourceforge.net/viewvc/jcl/trunk/jcl/source/common/JclSysUtils.pas?view=markup)函数来构建该函数：

```
function GetVariableTypeInfo(pvar: Pointer): PTypeInfo;
begin
  if not Assigned(pvar) then
    Result := nil
  else if IsClass(PPointer(pvar)^) then
    Result := PClass(pvar).ClassInfo
  else if IsObject(PPointer(pvar)^) then
    Result := PObject(pvar).ClassInfo
  else
    raise EUnknownResult.Create;
end; 
```

它显然不适用于`S`或`Instance`更高版本，但让我们看看会发生什么`Obj`：

```
Info := GetVariableTypeInfo(@Obj); 
```

这应该会导致访问冲突。`Obj`没有价值，因此`IsClass`两者`IsObject`都将读取一个未指定的内存地址，可能不属于您的进程。您要求一个使用变量地址作为输入的例程，但仅仅地址是不够的。

现在让我们仔细看看如何`IsClass`以及`IsObject`真正的表现。这些函数采用任意值并检查该值是否*看起来*可能是给定类型的值，无论是对象（实例）还是类。像这样使用它：

```
// This code will yield no assertion failures.
var
  p: Pointer;
  o: TObject;
  a: array of Integer;
begin
  p := TDBGrid;
  Assert(IsClass(p));

  p := TForm.Create(nil);
  Assert(IsObject(p));

  // So far, so good. Works just as expected.
  // Now things get interesting:

  Pointer(a) := p;
  Assert(IsObject(a));
  Pointer(a) := nil;
  // A dynamic array is an object? Hmm.

  o := nil;
  try
    IsObject(o);
    Assert(False);
  except
    on e: TObject do
      Assert(e is EAccessViolation);
  end;
  // The variable is clearly a TObject, but since it
  // doesn't hold a reference to an object, IsObject
  // can't check whether its class field looks like
  // a valid class reference.
end; 
```

请注意，这些函数不会告诉您有关变量的*任何*信息，而只会告诉您它们所持有的*值。*那么，我不会真正考虑这些函数来回答如何获取有关变量的类型信息的问题。

此外，您说您对变量的所有了解都是它的地址。您找到的函数不采用变量的地址。它们取变量的*值*。这是一个演示：

```
var
  c: TClass;
begin
  c := TDBGrid;
  Assert(IsClass(c));
  Assert(not IsClass(@c)); // Address of variable
  Assert(IsObject(@c)); // Address of variable is an object?
end; 
```

您可能会反对我通过将明显是垃圾的东西传递给它们来滥用这些功能。但我认为这是谈论这个话题的*唯一方式。*如果你知道你永远不会有垃圾值，那么你无论如何都不需要你要求的函数，因为你已经对你的程序有足够的了解，可以为你的变量使用真正的类型。

总的来说，你问错了问题。与其问你如何确定变量的类型或内存中的值的类型，**不如问你是如何使自己处于不知道变量和数据类型的位置的**。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2019-02-15T05:09:35.677

使用泛型，现在可以在不指定的情况下获取类型信息。某些用户表示以下代码无法编译而不会出现错误。从 Delphi 10 Seattle 版本 23.0.20618.2753 开始，它编译时没有错误，如下面的屏幕截图所示。

```
program TypeInfos;
{$APPTYPE CONSOLE}
{$R *.res}

uses
  System.SysUtils, System.TypInfo;

type
  TTypeInfo = class
    class procedure ShowTypeInfo<T>(const X: T);
  end;

{ TTypeInfo }

class procedure TTypeInfo.ShowTypeInfo<T>(const X: T);
var
  LTypeInfo: PTypeInfo;
begin
  LTypeInfo := TypeInfo(T);
  WriteLn(LTypeInfo.Name);
end;

var
  L: Exception;
  B: Boolean;
begin
                             // Console output
  TTypeInfo.ShowTypeInfo(L); // Exception
  TTypeInfo.ShowTypeInfo(B); // Boolean
end. 
```

[![在此处输入图像描述](https://i.stack.imgur.com/69JSX.png)](https://i.stack.imgur.com/69JSX.png)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-16T18:38:55.593

从来没听说过。您可以获取关于类的已发布属性的 RTTI（运行时类型信息），但不能获取字符串和整数等“普通”变量。信息根本不存在。

此外，在不传递类型的情况下传递 var 的唯一方法是使用泛型 TObject 参数、泛型类型（D2008，如 中）或作为无类型参数。我想不出另一种传递它的方式，甚至可以编译。

# asp.net - 使用 ASP.NET 日历控件时如何隐藏周末？

> ID：554111
> 
> 赞同：6
> 
> 时间：2009-02-16T18:29:40.187
> 
> 标签：asp.net, calendar

有时在显示日历时需要防止显示周末和周末名称在日期标题中，有没有办法使用[ASP.NET 日历控件](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.calendar.aspx)来做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-16T18:43:30.700

由于提供了控件，因此在不覆盖控件的情况下无法执行此操作。这样做的一种方法是重写[OnDayRender](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.calendar.ondayrender.aspx)和[Render](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.calendar.render.aspx)方法，以在将信息发送回客户端之前从输出中删除信息。

以下是渲染时控件外观的屏幕截图：

![工作日日历示例](https://i.stack.imgur.com/Bodnx.png)

下面是一个基本的控件覆盖，它演示了从控件中删除周末日列。

```
/*------------------------------------------------------------------------------
 * Author - Rob (http://stackoverflow.com/users/1185/rob)
 * -----------------------------------------------------------------------------
 * Notes
 * - This might not be the best way of doing things, so you should test it
 *   before using it in production code.
 * - This control was inspired by Mike Ellison's article on The Code Project
 *   found here: http://www.codeproject.com/aspnet/MellDataCalendar.asp
 * ---------------------------------------------------------------------------*/
using System;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.Text;
using System.IO;
using System.Xml;

namespace DataControls
{
    /// <summary>
    /// Example of a ASP.NET Calendar control that has been overriden to force
    /// the weekend columns to be hidden on demand.
    /// </summary>
    public class DataCalendar : Calendar
    {
        private bool _hideWeekend;
        private int _saturday;
        private int _sunday;

        /// <summary>Constructor</summary>
        public DataCalendar()
            : base()
        {
            // Default to showing the weekend
            this._hideWeekend = false;
            // Set the default values for Saturday and Sunday
            this.Saturday = 6;
            this.Sunday = 0;
        }

        /// <summary>
        /// Indicate if the weekend days should be shown or not, set to true
        /// if the weekend should be hidden, false otherwise. This field 
        /// defaults to false.
        /// </summary>
        public bool HideWeekend
        {
            get { return this._hideWeekend; }
            set { this._hideWeekend = value; }
        }

        /// <summary>
        /// Override the default index for Saturdays.
        /// </summary>
        /// <remarks>This option is provided for internationalization options.</remarks>
        public int Saturday 
        {
            get { return this._saturday; }
            set { this._saturday = value; }
        }

        /// <summary>
        /// Override the default index for Sundays.
        /// </summary>
        /// <remarks>This option is provided for internationalization options.</remarks>
        public int Sunday 
        {
            get { return this._sunday; }
            set { this._sunday = value; }
        }

        /// <summary>
        /// Render the day on the calendar with the information provided.
        /// </summary>
        /// <param name="cell">The cell in the table.</param>
        /// <param name="day">The calendar day information</param>
        protected override void OnDayRender(TableCell cell, CalendarDay day)
        {
            // If this is a weekend day and they should be hidden, remove
            // them from the output
            if (day.IsWeekend && this._hideWeekend)
            {
                day = null;
                cell.Visible = false;
                cell.Text = string.Empty;
            }
            // Call the base render method too
            base.OnDayRender(cell, day);
        }

        /// <summary>
        /// Render the calendar to the HTML stream provided.
        /// </summary>
        /// <param name="html">The output control stream to write to.</param>
        protected override void Render(HtmlTextWriter html)
        {
            // Setup a new HtmlTextWriter that the base class will use to render
            StringBuilder sb = new StringBuilder();
            StringWriter sw = new StringWriter(sb);
            HtmlTextWriter calendar = new HtmlTextWriter(sw);
            // Call the base Calendar's Render method allowing OnDayRender() 
            // to be executed.
            base.Render(calendar);
            // Check to see if we need to remove the weekends from the header,
            // if we do, then remove the fields and use the new verison for
            // the output. Otherwise, just use what was previously generated.
            if (this._hideWeekend && this.ShowDayHeader)
            {
                // Load the XHTML to a XML document for processing
                XmlDocument xml = new XmlDocument();
                xml.Load(new StringReader(sw.ToString()));
                // The Calendar control renders as a table, so navigate to the
                // second TR which has the day headers.
                XmlElement root = xml.DocumentElement;
                XmlNode oldNode = root.SelectNodes("/table/tr")[1];
                XmlNode sundayNode = oldNode.ChildNodes[this.Sunday];
                XmlNode saturdayNode = oldNode.ChildNodes[this.Saturday];
                XmlNode newNode = oldNode;
                newNode.RemoveChild(sundayNode);
                newNode.RemoveChild(saturdayNode);
                root.ReplaceChild(oldNode, newNode);
                // Replace the buffer
                html.WriteLine(root.OuterXml);
            }
            else
            {
                html.WriteLine(sw.ToString());
            }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-16T18:34:21.237

据我所知，您不能，但您可以尝试使用 WeekendDayStyle，例如使用 display:none 设置样式。或者，您可以创建从 Calendar 继承的自定义控件并覆盖 ether Render、OnDayRender 或其他内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-16T18:39:46.107

我相信您可以处理 Day Render 事件并隐藏单元格或分配 CSS 属性以使其不可见或变灰。下面是一个简单的例子，希望对您有所帮助。

```
protected void Calendar_DayRender(object sender, DayRenderEventArgs e)
{

  e.Cell.Visible = False;
  // or
  // e.Cell.Attributes.Add("class", "Invisible");
  // or
  // e.Cell.Attributes.Add("style", "display: none");
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-10-19T19:56:35.393

如果您可以使用 jQuery 解决方案，则只需几行代码：

```
<script type="text/javascript">
    $(document).ready(function () {
        $('._title').parent().attr('colspan', '5'); // title row initially has a colspan of seven
        $('._dayheader:first, ._dayheader:last', $('#<%= Calendar1.ClientID %>')).hide(); // remove first and last cells from day header row
        $('._weekendday').hide(); // remove all the cells marked weekends
    });
</script>

<asp:Calendar runat="server" ID="Calendar1">
    <TitleStyle CssClass="_title" />
    <DayHeaderStyle CssClass="_dayheader" />
    <WeekendDayStyle CssClass="_weekendday" />
</asp:Calendar> 
```

以下是这种方法的一些注意事项：

*   如果 JavaScript 被禁用，客户端将看到周末。
*   在较旧、速度较慢的浏览器中，当 jQuery 在加载时执行时，日历会发生跳跃。
*   这个解决方案可以用[:first-child](http://www.w3schools.com/cssref/sel_firstchild.asp)直接用 CSS 实现。
*   如果向页面添加另一个日历，则需要复制 JavaScript 的中间行。这是必要的，因为我们使用的是 :first 和 :last。
*   如果页面上只有一个日历控件，可以通过删除 jQuery 选择器的第二个参数来简化 JavaScript 的中间行：`$('#<%= Calendar1.ClientID %>')`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-06-27T10:59:08.407

正如 zacharydl 所建议的那样，我设法使用 jQuery 隐藏了周末。我对原始代码做了一些小改动。

```
 <script type="text/javascript">
   HideWeekEnd();

    function HideWeekEnd ()
    {
        $('._title').parent().attr('colspan', '7');  
        $('._dayheader:nth-last-child(1) , ._dayheader:nth-last-child(2) ', $('#<%= Calendar1.ClientID %>')).hide(); // remove last two cells from day header row
        $('._weekendday').hide(); // remove all the cells marked weekends
    }

 Sys.Application.add_init(appl_init);

        function appl_init() {
            var pgRegMgr = Sys.WebForms.PageRequestManager.getInstance();
            pgRegMgr.add_endRequest(HideWeekEnd);
        }

</script> 
```

您必须在页面 endRequest 中注册 HideWeekEnd() 以确保在页面回发期间调用它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-06-09T06:15:42.703

这是另一种仅使用 CSS 来实现此目的的方法：

> ```
>  <style>
>    .hidden,
>    #Calendrier tr > th[abbr=Saturday],
>    #Calendrier tr > th[abbr=Sunday] { display:none; }
>    #Calendrier tr > th { text-align: center; }
>  </style>
> 
>  <asp:Calendar ID="Calendar1" DayNameFormat="Full" runat="server" 
>                WeekendDayStyle-CssClass="hidden" ClientIDMode="Static"  >
>  </asp:Calendar> 
> ```

# c# - 如何检索 Oracle 过程或函数的主体

> ID：554115
> 
> 赞同：6
> 
> 时间：2009-02-16T18:31:31.273
> 
> 标签：c#, .net, oracle, stored-procedures, plsql

我想做的是从 Oracle 9i 数据库中检索子程序、函数、包规范和包主体的模式信息，以便我可以使用系统中的类在 C# 客户端中将它们呈现给用户。 Data.OracleClient 命名空间。

到目前为止，我已经能够比 Java 应用程序更快地显示高级模式数据，但是包和函数超出了我的掌握。我可以以非常有用的方式显示列、它们的类型、索引、表和列级别的注释以及各种*非常*有用的信息。现在，如果我能进入程序。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-16T18:42:16.227

查询数据字典表ALL_SOURCE [http://download.oracle.com/docs/cd/B10501_01/server.920/a96536/ch2124.htm#1300946](http://download.oracle.com/docs/cd/B10501_01/server.920/a96536/ch2124.htm#1300946)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-16T18:41:23.247

这有帮助吗？不清楚您是想通过 System.Data.OracleClient 还是通过 SQL 获得这个？

```
SELECT TEXT
FROM   ALL_SOURCE
WHERE  NAME = <proc_name>
AND    OWNER = <schema> 
```

# javascript - 知道 JavaScript 模板引擎吗？

> ID：554118
> 
> 赞同：0
> 
> 时间：2009-02-16T18:33:06.840
> 
> 标签：javascript, templates, air

我需要根据以巨大形式输入的数据生成非常大的 html 文件。该项目是在 Adob​​eAIR (js) 中完成的。除了 Dojo dtl，您还会推荐哪些模板技术？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-16T20:28:53.147

查看[John Resig 的微模板](http://ejohn.org/blog/javascript-micro-templating/)。这很简单，也很漂亮。现在，我不知道你需要去那个兔子洞多远，但如果它不是太远......这很好用。

# java - 从 System.getProperties() 将属性合并到 ResourceBundle

> ID：554120
> 
> 赞同：2
> 
> 时间：2009-02-16T18:33:49.617
> 
> 标签：java, properties, parameters

我正在从一个文件构建一个 ResourceBundle，这个包包含 < String, String> 值。

```
InputStream in = getClass().getResourceAsStream("SQL.properties");
properties = new PropertyResourceBundle(in);
in.close(); 
```

我想在这个捆绑包上添加/**替换**一些我使用 -Dsome.option.val.NAME1=HiEarth 从命令行传递的属性

我不在乎丢弃旧捆绑包并创建一个新捆绑包。

你能给小费吗？

我认为我需要做的是：

1.  从包中创建一个 HashMap< String, String>
2.  替换值。
3.  将 HashMap 转换为 InputStream。//这是复杂的部分...
4.  从中构建新的捆绑包。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-16T19:49:18.670

这可以满足您的一些需求（将 System.properties 转换为 ResourceBundle）。更好的错误处理由您决定:-)

```

    公共静态资源包 createBundle()
    {
        最终的 ResourceBundle 捆绑包；
        最终属性属性；
        最后的 CharArrayWriter charWriter;
        最终的 PrintWriter printWriter;
        最后的 CharArrayReader charReader;

        charWriter = new CharArrayWriter();
        printWriter = new PrintWriter(charWriter);

        属性 = System.getProperties();
        properties.list(printWriter);

        charReader = new CharArrayReader(charWriter.toCharArray());

        尝试
        {
            bundle = new PropertyResourceBundle(charReader);

            返回（捆绑）；
        }
        捕获（最终 IOException 前）
        {
            // 不可能发生
            ex.printStackTrace();
        }

        抛出新的错误（）；
    }

```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-16T18:44:20.730

这可能不是最好的方法，但它是我能想到的最好的方法：实现一个`ResourceBundle`存储您要添加/替换的属性的子类，然后将该包的父类设置为`PropertyResourceBundle`您从输入流加载的.

```
InputStream in = getClass().getResourceAsStream("SQL.properties");
properties = new PropertyResourceBundle(in);
in.close();
MyCLIResourceBundle b = new MyCLIResourceBundle(properties);
// use b as your bundle 
```

实施将类似于

```
public class MyCLIResourceBundle extends ResourceBundle {
    public MyCLIResourceBundle(ResourceBundle parent) {
        super();
        this.setParent(parent);
        // go on and load your chosen properties from System.getProperties() or wherever
    }
} 
```

# sharepoint - SharePoint：如何以编程方式确定网站的网站目录

> ID：554123
> 
> 赞同：1
> 
> 时间：2009-02-16T18:34:35.183
> 
> 标签：sharepoint, moss, sitedirectory

有没有办法获取站点的（站点集合）站点目录，该目录在协作或发布门户的网站集合设置中定义？

当然，我可以遍历站点集合的所有 SPWeb，但我希望有一种更简单的方法来获取目录，因为信息似乎已经存储在某个地方。

再见，弗洛

**更新**

当然，我想以编程方式获取信息。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T17:58:26.557

站点目录路径存储在根网络属性包中

下面的代码取自内部实用程序类 SiteDirectoryUtil 显示了如何确定路径的逻辑

```
 internal static string GetLocalSiteDirectoryLocation(SPWeb rootWeb)
{
    if (rootWeb != null)
    {
        if (rootWeb.AllProperties.ContainsKey("DefaultSiteDirectorySiteId"))
        {
            string str = rootWeb.AllProperties["DefaultSiteDirectorySiteId"] as string;
            if (string.IsNullOrEmpty(str))
            {
                return string.Empty;
            }
            if (!rootWeb.AllProperties.ContainsKey("DefaultSiteDirectoryWebId"))
            {
                return string.Empty;
            }
            string str2 = rootWeb.AllProperties["DefaultSiteDirectoryWebId"] as string;
            if (string.IsNullOrEmpty(str2))
            {
                return string.Empty;
            }
            try
            {
                using (SPSite site = new SPSite(new Guid(str), rootWeb.Site.Zone))
                {
                    using (SPWeb web = site.OpenWeb(new Guid(str2)))
                    {
                        return web.ServerRelativeUrl;
                    }
                }
            }
            catch (FileNotFoundException)
            {
                return string.Empty;
            }
        }
        else
        {
            return string.Empty;
        }
    }
    return string.Empty;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T02:50:55.567

您指的是**站点内容和结构**下的站点目录吗？

如果是这样，您可以浏览以`http://sitename/_layouts/sitemanager.aspx`查看站点目录（假设您对该站点有足够的权限）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T11:07:21.520

对于它的价值，如果您可以访问 WSS 数据库，您可以利用现有的 SP 或创建自己的。我想返回诸如“RequestAccessEmail”之类的内容并将其合并到我们自己的站点地图中（有时很容易知道站点所有者是谁）。我们的 SP 是最基本的...

```
创建过程 [dbo].[my_sitemap](
   @PartialUrl nvarchar(260)
)

作为
   选择 ID、FullUrl、标题、RequestAccessEmail
   来自网络
   在哪里 FullUrl LIKE @PartialUrl + '%'
   按完整网址订购
去

```

对我来说效果很好。希望这可以帮助。

# javascript - javascript/dom——创建与重新排列 dom 节点的成本是多少？

> ID：554128
> 
> 赞同：7
> 
> 时间：2009-02-16T18:36:01.670
> 
> 标签：javascript, optimization, dom

我正在尝试优化我编写的可排序表。瓶颈在于 dom 操作。我目前正在创建新的表格行并在每次对表格进行排序时插入它们。我想知道是否可以通过简单地重新排列行而不是重新创建节点来加快速度。为了产生显着的差异，dom 节点重新排列必须比节点创建快得多。是这样吗？谢谢，-摩根

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-16T18:56:40.607

我不知道创建或操作是否更快，但我知道如果您在整个表格不在页面上时对其进行操作然后一次将其全部放置，它会更快。按照这些思路，除非首先从 DOM 中删除整个表，否则重新排列现有行可能会更慢。

[此页面](http://www.peachpit.com/articles/article.aspx?p=31567&seqNum=5 "这一页")建议克隆当前表，根据需要对其进行操作，然后替换 DOM 上的表，这是最快的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-16T22:06:35.097

我现在使用innerHTML 以大约两倍的速度绘制这张表，将整个内容构建为一个字符串，而不是一个接一个地插入节点。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-16T18:44:13.850

您可能会发现此页面对一些基准测试很方便：

[http://www.quirksmode.org/dom/innerhtml.html](http://www.quirksmode.org/dom/innerhtml.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-03-30T10:56:17.307

我正在寻找这个问题的答案并决定建立一个快速基准[http://jsfiddle.net/wheresrhys/2g6Dn/6/](http://jsfiddle.net/wheresrhys/2g6Dn/6/)

它使用 jQuery，因此不是纯粹的基准测试，而且它也可能在其他方面存在偏差。但它给出的结果是每次移动 DOM 节点的速度大约是创建和销毁 dom 节点的两倍

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-03-11T14:54:41.633

如果可以的话，最好不要将 dom 操作作为实际的 dom 操作，而是作为脚本中的某种方法，然后再操作 dom。因此，不是在每个节点上进行所谓的重绘，而是将每个节点上的重绘聚集到它自己的方法中，然后将这些节点附加到父节点中，然后将其附加到实际的 dom，结果只需两次重绘，而不是数百次。我说两个 b/c 在使用新数据更新之前，您需要清理 dom 中的内容。

# installation - 在安装项目中调用 Directory.Exists("\\SERVER\SHARE\")

> ID：554132
> 
> 赞同：3
> 
> 时间：2009-02-16T18:38:22.663
> 
> 标签：installation, .net

我有一个 .NET 安装项目，向其中添加了自定义安装程序操作。在设置过程中，用户必须为其文件服务器上的共享提供路径（通常是 UNC 路径）。在继续确保目录存在之前，我尝试进行一些验证，例如：

```
if (!Directory.Exists(serverDirectory)) { 
    throw new InstallException("Specified path does not exist or ..."); 
} 
```

非常普通——在控制台应用程序中，*Directory.Exists()*代码按预期工作。但是，在 MSI 的上下文中，它没有。具体来说，在使用网络资源时，对*Directory.Exists的调用总是失败。**Directory.Exists*的文档确实说明[了原因](http://msdn.microsoft.com/en-us/library/system.io.directory.exists.aspx "为什么")：

> **Exists 方法不执行网络身份验证。如果您查询现有的网络共享而未经过预先身份验证，则 Exists 方法将返回 false。**

搜索使我想到了 ASP.NET 中的其他类似场景，其中模拟是解决方案。这在这里不适用，但它说明了这个问题。

如何检查网络路径是否存在？使用文档的语言 - 我如何在通话之前进行预身份验证？用户以管理员身份安装，并且在 Windows 资源管理器中浏览到该路径成功，因此这不是用户的权限，而是缺少代码检查。

我是否造成了不必要的担忧——我是否应该忽略它并稍后在尝试使用网络资源时抛出异常......这在很大程度上是相同的严重故障，对吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-16T18:46:05.937

这不仅仅是存在：您还需要检查权限，并担心如果在您检查和实际使用该值之间的时间段内它们发生变化会发生什么。

因此，正常的机制是假设一切正常。相反，当假设被证明是错误的时，将您的开发工作投入到处理异常上，因为无论如何您都需要能够优雅地做到这一点。

对于这种情况，您可以通过立即在相关目录中创建一个小的占位符文件并锁定该文件直到您完全完成该文件夹来改进这一点。这将允许您提供更好的反馈，因为您会在尝试创建文件时立即收到错误消息。它还有助于确保文件夹*保持*可访问性，因为在 Windows 下，只要您锁定该文件，至少用户将很难删除或显着更改文件夹。

# c - 在 C 中捕获段错误

> ID：554138
> 
> 赞同：12
> 
> 时间：2009-02-16T18:40:02.080
> 
> 标签：c, macos, error-handling, segmentation-fault

我有一个程序有时会从指针算术中出错。我知道会发生这种情况，但我不能轻易地提前检查它是否存在段错误 - 我可以“预扫描”输入数据以查看它是否会导致段错误（这可能无法确定），或者我可以修改它以不使用指针算术，这需要大量的工作，或者我可以尝试捕获段错误。所以我的问题：

1）如何在 C 中捕获段错误？我知道操作系统中的*某些东西*会导致段错误，但是如果 C 程序在段错误中比仅仅更优雅地死掉，那么它可以做什么`Segmentation fault`呢？

2）这有多便携？

我想这是一个非常不可移植的行为，所以如果您发布任何代码来捕获段错误，请告诉我它的工作原理。我在 Mac OS X 上，但我希望我的程序可以在尽可能多的平台上运行，我想看看我的选择是什么。

别担心 - 基本上我想做的就是打印一个更用户友好的错误消息并释放一些`malloc()`ed 内存，然后死掉。我不打算只是忽略我得到的所有段错误并继续前进。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-02-16T18:45:22.957

好吧，SIGSEGV 是可捕获的，这是 POSIX，因此在这个意义上它是可移植的。

Bu 我担心您似乎想要处理段错误而不是修复导致段错误的问题。如果我必须选择是操作系统有问题还是我自己的代码有问题，我知道我会选择哪一个。我建议你找到那个错误，修复它，然后编写一个测试用例以确保它不会再咬你。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-02-16T18:49:59.060

您可以使用函数*signal*为信号安装新的信号处理程序：

```
 #include <signal.h>
   void (*signal(int signum, void (*sighandler)(int)))(int); 
```

类似于以下代码：

```
signal(SIGINT , clean_exit_on_sig);
signal(SIGABRT , clean_exit_on_sig);
signal(SIGILL , clean_exit_on_sig);
signal(SIGFPE , clean_exit_on_sig);
signal(SIGSEGV, clean_exit_on_sig); // <-- this one is for segmentation fault
signal(SIGTERM , clean_exit_on_sig);

void 
clean_exit_on_sig(int sig_num)
{
        printf ("\n Signal %d received",sig_num);
} 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-02-16T18:44:30.400

您必须定义一个信号处理程序。这是在 Unix 系统上使用函数完成的[`sigaction`](http://opengroup.org/onlinepubs/007908775/xsh/sigaction.html)。我在 Fedora 64 位和 32 位以及 Sun Solaris 上使用相同的代码完成了这项工作。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-16T19:17:51.850

The safe actions in a signal handler are **very** limited. It's unsafe to call any library function not known to be re-entrant, which will exclude, for example, `free()` and `printf()`. Best practice is to set a variable and return, but this doesn't help you very much. It's also safe to use system calls such as `write()`.

Note that in the two backtrace examples given here, the `backtrace_symbols_fd()` function will be safe because it uses the raw fd directly, but the call to `fprintf()` is incorrect, and should be replaced by a use of `write()`.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-16T18:51:44.033

你需要提供一个 SIGSEGV 处理程序，[这个看起来相当不错。](http://www.tlug.org.za/wiki/index.php/Obtaining_a_stack_trace_in_C_upon_SIGSEGV)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-16T18:56:45.473

这里有一个如何使用 glibc 的 backtrace() 捕获 SIGSEGV 并打印堆栈跟踪的示例：

[当我的 C++ 应用程序崩溃时如何生成堆栈跟踪](https://stackoverflow.com/questions/77005/how-to-generate-a-stacktrace-when-my-gcc-c-app-crashes)

您可以使用它来捕获您的段错误并进行清理，但请注意：您不应该在信号处理程序中做太多的事情，尤其是涉及像 malloc() 这样的调用的事情。有很多调用不是信号安全的，如果你从 malloc 中调用 malloc，你最终可能会自取其辱。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-16T19:00:07.087

信号处理（相对）可跨 unix 机器（包括 mac 和 linux）移植。最大的区别在于异常细节，它作为参数传递给信号处理例程。抱歉，但如果您想打印更合理的错误消息（例如故障发生的位置和原因），您可能需要一堆#ifdefs ...

好的，这是一个代码片段供您开始：

```
#include <signal.h>

/* reached when a segv occurrs */
void
SEGVFunction( SIGARGS )
{
     ...
}

...
main(...) {
    signal(SIGSEGV, SEGVFunction); /* tell the OS, where to go in case... */
    ...
    ... do your work ...
} 
```

你的任务是：

*   检查 SIGARGS 是什么（取决于操作系统，所以使用 ifdef）
*   查看如何从 sigArgs 中的异常信息中提取故障地址和 pc
*   打印合理的信息
*   出口

理论上，您甚至可以在信号处理程序中修补 pc（在错误指令之后），然后继续。但是，典型的信号处理程序要么 exit() 要么将 longjmp() 返回到 main 中的保存位置。

问候

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-16T18:48:44.837

我认为您正在尝试解决一个不存在的问题。至少你的工作是错误的。您将无法*捕获*分段错误，因为此错误/异常是由操作系统引发的（它是由您的程序*引起*的，操作系统只是*捕获*它）。

我建议您重新考虑有关输入的策略：为什么无法对其进行消毒？最重要的是大小检查，为此 C 标准库具有适当的功能。然后，您当然必须检查有关内容的有效输入。是的，这可能会导致大量工作，但这是编写健壮程序的唯一方法。

**编辑：**我不是 C 专家，不知道即使是分段错误也可以由信号处理程序处理。尽管如此，由于上述原因，我认为这不是正确的方法。

# multithreading - Indy 10 IdTCPClient 使用单独的线程读取数据？

> ID：554142
> 
> 赞同：5
> 
> 时间：2009-02-16T18:41:17.583
> 
> 标签：multithreading, delphi, sockets, indy

**问题：**我正在寻找的是在 Indy 10 中使用 IdTCPClient 使用单独线程接收数据的*最典型或最佳实践方式。*

**背景：**为了清楚起见，下面的代码是我尝试删除的实际数据处理部分的示例。线程的想法是接收所有数据（带有声明其余消息长度的标头的可变大小）然后解析它（这就是 HandleData 过程所做的）并根据命令触发事件处理程序。

TIdIOHandlerSocket 由主应用程序传递给线程，主应用程序也会在需要时将数据写入套接字。

```
TScktReceiveThread = class(TThread)
  private
    { Private declarations }
    procedure HandleData;
  protected
    procedure Execute; override;
  public
    FSocket: TIdIOHandlerSocket;
    constructor Create(CreateSuspended: boolean);
  end;

procedure TScktReceiveThread.Execute;
var
  FixedHeader: TBytes;
begin
  Assert(FSocket <> nil, 'You must assign the connected socket to the receiving thread');
  SetLength(FixedHeader, 2);
   while not Terminated do
    begin
      if not FSocket.Connected then
        Suspend
      else
        begin
          FSocket.CheckForDataOnSource(10);
          if not FSocket.InputBufferIsEmpty then
           begin
            FSocket.ReadBytes(FixedHeader, SizeOf(FixedHeader), false);
            // Removed the rest of the reading and parsing code for clarity
            Synchronize(HandleData);
           end;
        end;
    end;
end; 
```

作为前缀，我使用了另一个处理 Indy 的服务器组件的 StackOverflow 问题：“ [Delphi 2009, Indy 10, TIdTCPServer.OnExecute, how to grab all the bytes in the InputBuffer](https://stackoverflow.com/questions/544204/delphi-2009-indy-10-tidtcpserver-onexecute-how-to-grab-all-the-bytes-in-the-in) ” 来获得我目前所拥有的基础.

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-17T07:40:53.217

如果您想避免为每个客户端-服务器数据交换创建线程类所带来的开销，您可以创建一个移动线程类，如

[http://delphidicas.blogspot.com/2008/08/anonymous-methods-when-should-they-be.html](http://delphidicas.blogspot.com/2008/08/anonymous-methods-when-should-they-be.html)

几天前我遇到了同样的问题，我刚刚给我写了一个 TMotileThreading 类，它具有静态函数，可以让我使用 D2009 的新匿名方法特性创建线程。看起来像这样：

```
type
  TExecuteFunc = reference to procedure;

  TMotileThreading = class
  public
    class procedure Execute (Func : TExecuteFunc);
    class procedure ExecuteThenCall (Func : TExecuteFunc; ThenFunc : TExecuteFunc);
  end; 
```

第二个过程允许我像您的情况一样执行客户端-服务器通信，并在数据到达时执行一些操作。匿名方法的好处是您可以使用调用上下文的局部变量。所以通信看起来像这样：

```
var
  NewData  : String;
begin
  TMotileThreading.ExecuteThenCall (
    procedure
    begin
      NewData := IdTCPClient.IOHandler.Readln;
    end,
    procedure
    begin
      GUIUpdate (NewData);
    end);
 end; 
```

Execute 和 ExecuteThenCall 方法只是创建一个工作线程，将 FreeOnTerminate 设置为 true 以简化内存管理并执行工作线程的 Execute 和 OnTerminate 过程中提供的函数。

希望有帮助。

**编辑**（根据要求完整实现类 TMotileThreading）

```
type
  TExecuteFunc = reference to procedure;

  TMotileThreading = class
  protected
    constructor Create;
  public
    class procedure Execute (Func : TExecuteFunc);
    class procedure ExecuteAndCall (Func : TExecuteFunc; OnTerminateFunc : TExecuteFunc;
                                SyncTerminateFunc : Boolean = False);
  end;

  TMotile = class (TThread)
  private
    ExecFunc             : TExecuteFunc;
    TerminateHandler     : TExecuteFunc;
    SyncTerminateHandler : Boolean;
  public
    constructor Create (Func : TExecuteFunc); overload;
    constructor Create (Func : TExecuteFunc; OnTerminateFunc : TExecuteFunc;
                        SyncTerminateFunc : Boolean); overload;
    procedure OnTerminateHandler (Sender : TObject);
    procedure Execute; override;
  end;

implementation

constructor TMotileThreading.Create;
begin
  Assert (False, 'Class TMotileThreading shouldn''t be used as an instance');
end;

class procedure TMotileThreading.Execute (Func : TExecuteFunc);
begin
  TMotile.Create (Func);
end;

class procedure TMotileThreading.ExecuteAndCall (Func : TExecuteFunc;
                                                 OnTerminateFunc : TExecuteFunc;
                                                 SyncTerminateFunc : Boolean = False);
begin
  TMotile.Create (Func, OnTerminateFunc, SyncTerminateFunc);
end;

constructor TMotile.Create (Func : TExecuteFunc);
begin
  inherited Create (True);
  ExecFunc := Func;
  TerminateHandler := nil;
  FreeOnTerminate := True;
  Resume;
end;

constructor TMotile.Create (Func : TExecuteFunc; OnTerminateFunc : TExecuteFunc;
                            SyncTerminateFunc : Boolean);
begin
  inherited Create (True);
  ExecFunc := Func;
  TerminateHandler := OnTerminateFunc;
  SyncTerminateHandler := SyncTerminateFunc;
  OnTerminate := OnTerminateHandler;
  FreeOnTerminate := True;
  Resume;
end;

procedure TMotile.Execute;
begin
  ExecFunc;
end;

procedure TMotile.OnTerminateHandler (Sender : TObject);
begin
  if Assigned (TerminateHandler) then
    if SyncTerminateHandler then
      Synchronize (procedure
                   begin
                     TerminateHandler;
                   end)
    else
      TerminateHandler;
end; 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-16T19:15:34.710

你在正确的轨道上。Indy 就是这样*使用*的。它使用*阻塞套接字*，因此在`ReadBytes`读取您所要求的内容之前调用不会返回。与非阻塞套接字相比，调用可能会提前返回，因此您可以轮询或异步获取通知以确定何时填充请求。

Indy 的设计期望套接字对象有自己的线程（或纤维）。Indy 提供`TIdAntifreeze`给那些想要将套接字组件拖放到他们的表单和数据模块上并使用主 GUI 线程中的 Indy 组件的人，但如果可以避免它，这通常不是一个好主意。

由于您的线程没有被分配就无法工作`FSocket`，我建议您只需在类的构造函数中接收该值。如果未分配，则在构造函数中断言。此外，创建非暂停线程是*错误的，那么为什么还要提供选项呢？*（如果线程没有被创建挂起，那么它会开始运行，检查是否`FSocket`被赋值，并失败，因为创建线程还没有分配到那个字段。）

# javascript - 如何在 TestGen4Web 脚本中为子弹出窗口使用条件？

> ID：554144
> 
> 赞同：0
> 
> 时间：2009-02-16T18:41:55.040
> 
> 标签：javascript, testing, web-applications, automation, automated-tests

我有 TestGen4Web 脚本，用于在具有弹出窗口的基于 Web 的用户界面上自动测试（嘿，我没有写那个 ui ..）。为了编写一个完整的测试脚本，该脚本根据弹出窗口中某些内容的存在来分支流程，我需要编写一个简单的 if 条件来执行类似 if的操作`document.getElementById("xyz").value`- 它将在弹出窗口而不是父窗口上运行窗户。

关于如何做到这一点的任何想法？目前，条件失败，因为它在父窗口上运行。

另外，如何从 dom 中提取一些文本并在测试结束时将其吐出到文件中？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-11T17:02:16.167

与 TestGen4Web 的作者交谈。他总结说这是一个错误，将在下一个版本中修复。这是带有临时解决方法修复的电子邮件：

我已经解决了您的问题 - 我将在下一个版本中添加。在那之前，你可以使用这个补丁。

在您的个人资料的 extensions/{3c20433a-61bc-42fe-831d-415860e17283}/chrome/recorder/cont ent/ 目录下，

1.  在扩展安装目录下找到recorder.js。
2.  在 recorder.js 中，找到名为的方法

Recorder.prototype.fixAction = function(action) {

3.  在返回方法之前，添加以下 2 行。

newAction.winref = this.fixDatasetsAndVariables(newAction.winref); newAction.pagerefreshed = this.fixDatasetsAndVariables(newAction.pagerefreshed);

4.  重新启动 Firefox，然后运行您的测试。

希望能解决您的问题。让我知道修复是否有更多问题。

* * *

1.  在你的循环之外初始化一个循环计数变量将它初始化为“1”（'count'，在附加的例子中）2.用“tg4wnamed${count}”替换所有“tg4wnamed1”

    * * *

2.  在你的循环之外初始化一个循环计数变量将它初始化为“1”（'count'，在附加的例子中）2.用“tg4wnamed${count}”替换所有“tg4wnamed1”

# c# - Liskov 替换和组合

> ID：554145
> 
> 赞同：9
> 
> 时间：2009-02-16T18:42:15.633
> 
> 标签：c#, .net, composition, liskov-substitution-principle

假设我有这样的课程：

```
public sealed class Foo
{
    public void Bar
    {
       // Do Bar Stuff
    }
} 
```

而且我想扩展它以添加超出扩展方法可以做的东西......我唯一的选择是组合：

```
public class SuperFoo
{
    private Foo _internalFoo;

    public SuperFoo()
    {
        _internalFoo = new Foo();        
    }

    public void Bar()
    {
        _internalFoo.Bar();
    }

    public void Baz()
    {
        // Do Baz Stuff
    }
} 
```

虽然这可行，但工作量很大......但是我仍然遇到了一个问题：

```
 public void AcceptsAFoo(Foo a) 
```

我可以在这里传入一个 Foo，但不能传入一个超级 Foo，因为 C# 不知道 SuperFoo 在 Liskov 替换意义上确实符合条件......这意味着我通过组合扩展类的用途非常有限。

所以，修复它的唯一方法是希望原始 API 设计者留下一个接口：

```
public interface IFoo
{
     public Bar();
}

public sealed class Foo : IFoo
{
     // etc
} 
```

现在，我可以在 SuperFoo 上实现 IFoo（因为 SuperFoo 已经实现了 Foo，只是改变签名的问题）。

```
public class SuperFoo : IFoo 
```

在完美世界中，使用 Foo 的方法会使用 IFoo 的：

```
public void AcceptsAFoo(IFoo a) 
```

现在，由于通用接口，C# 理解了 SuperFoo 和 Foo 之间的关系，一切都很好。

**最大的问题是 .NET 封装了许多偶尔会很好扩展的类，而且它们通常不实现通用接口，因此采用 Foo 的 API 方法不会接受 SuperFoo 并且您不能添加重载.**

所以，对于所有的作曲爱好者来说......你如何绕过这个限制？

我唯一能想到的就是将内部的 Foo 公开，这样你可以偶尔通过它，但这似乎很乱。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-16T18:56:28.983

在我开始研究自己的可重用库之前，我发现自己也在问同样的问题。很多时候，如果不要求实现者的晦涩或神秘的调用序列，您就无法扩展某些类。

当允许扩展你的类时，你必须问：如果开发人员扩展了我的类，并将这个新类传递给我的库，我可以透明地使用这个新类吗？我可以正常使用这个新课程吗？这个新班级真的会表现得一样吗？

我发现大多数时候 .Net 框架中的密封类具有某些您不知道的底层要求，并且鉴于当前的实现不能安全地暴露给子类。

这并不能完全回答您的问题，但它提供了关于为什么并非所有类都可以在 .Net 框架中继承的见解（以及为什么您可能也应该考虑密封您的一些类）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-16T19:19:05.793

恐怕简短的回答是，你不能不做需要做的事情，即传递组合的实例变量。

您**可以**允许对该类型进行隐式或显式强制转换（其实现只是传递了组合实例），但这将是 IMO 非常邪恶。

Sixlettervariable 的答案很好，我不会重复它，但如果你指出你希望你可以扩展哪些类，我们可能会告诉你他们为什么阻止它。

# javascript - Javascript 内存分析 - IE6

> ID：554156
> 
> 赞同：1
> 
> 时间：2009-02-16T18:44:31.040
> 
> 标签：javascript, ajax, memory-leaks, internet-explorer-6

我们有一个在 IE6 中表现非常糟糕的应用程序，该应用程序严重依赖 javascript，并且大部分活动都发生在一个页面中。

在 IE6 中，似乎内存不断堆积，即使您导航到不同的站点也永远不会被清除！

由于在浏览器中运行的代码并不多，因此我正在寻找一种外部工具，该工具将阐明应用程序的内存消耗，以便我们可以集中精力进行优化。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-08T18:28:12.333

我发现的最好的工具之一是 IE Sieve，Internet Explorer 的内存泄漏检测器，它是滴水的改进版本 - [http://home.wanadoo.nl/jsrosman/](http://home.wanadoo.nl/jsrosman/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T19:01:30.843

好吧，IE6 从根本上被破坏了，这对任何 Web 开发人员来说都不足为奇。浏览器是否仍然在您的用户中广泛使用以至于这是一个问题？

无论如何，我知道每当您在 Javascript 中使用循环引用时，IE6 都会泄漏内存。它的垃圾收集器太坏了，无法处理这些，所以它们永远不会被释放。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-16T19:04:32.880

这些是很好的读物：

*   [了解和解决 Internet Explorer 泄漏模式](http://msdn.microsoft.com/en-us/library/bb250448.aspx)
*   [JScript 内存泄漏](http://javascript.crockford.com/memory/leak.html)
*   [修复 Internet Explorer 6 的内存泄漏](http://dertompson.com/2008/03/10/fixing-memory-leaks-of-internet-explorer-6/)

一个对我有帮助的工具是：

*   [Process Explorer](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx) - 显示进程内存的实际内存使用情况。

我所做的是刷新 javascript-heavy 页面并查看内存使用量是否上升（它不应该）。如果是这样，那就有泄漏。然后我注释掉代码块，直到它不泄漏，并尝试进一步缩小范围。

# c# - 方便或“懒惰编程” IList 管理 - 保护 IList.Add 方法

> ID：554159
> 
> 赞同：1
> 
> 时间：2009-02-16T18:45:25.797
> 
> 标签：c#, architecture

当您有一个带有项目列表的对象时，您如何管理这个简单的场景。例如：

```
public class ContainerObject
{
    IList<ChildObject> Children { get; }

    public void AddCustom(ChildObject toAdd)
    {
        // Some validation ...
        Children.Add(toAdd);
    }
} 
```

假设集合被初始化为 IList 的实现，是否有任何方法可以控制将项目添加到列表中的方式？

例如，我在 ContainerObject 类上有另一个方法，它接受一个 ChildObject 并将其添加到列表中。在添加 ChildObject 之前，需要此方法对其执行一些基本验证。

我很懒，因为我不想乱七八糟地写一个消费开发人员需要实现的自定义列表接口（没有添加方法）。我还在 IQueryable 接口上使用 ToList() 方法，所以这是坚持使用 IList 的另一个原因 - 它可以正常工作。

那么，是否有一种方法可以控制如何将项目添加到 IList 实例，即阻止使用 Add 方法，只允许通过我的自定义方法添加到集合中，还是我只是要求不可能？...和懒惰:(

我可以想到一些 hacky 方法来检查何时通过我的自定义方法或直接在列表中添加项目，但这些似乎 hacky！

有人遇到过类似的事情吗？如果是这样，你做了什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-16T18:52:10.833

您可以使用 使您的属性返回原始列表周围的包装器[`ReadOnlyCollection<T>`](http://msdn.microsoft.com/en-us/library/ms132474.aspx)。这将确保调用者自己不会添加任何项目。您可以保留对原始可变列表的引用。请注意，由于只读集合只是一个包装器，缓存只读集合的​​调用者仍会看到您对原始列表所做的添加。根据您的预期用途，这可能是也可能不是一件好事。

编辑：解释我的缓存评论......

假设客户做了：

```
IList<ChildObject> originalChildren = container.Children;    
container.AddChild(new ChildObject());
IList<ChildObject> updatedChildren = container.Children; 
```

像这样实现的`Children`属性：

```
private IList<ChildObject> children = new List<ChildObject>();
public IList<ChildObject> Children
{
    get { return new ReadOnlyCollection<ChildObject>(children); }
} 
```

然后`originalChildren`并且`updateChildren`两者都具有相同的内容 - 返回的`ReadOnlyCollection`不会是第一行的子集合的*快照*。它只是集合的*包装。*客户不能依赖它不改变——他们只是不能自己改变它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-16T18:53:38.583

[将ReadOnlyCollection](http://msdn.microsoft.com/en-us/library/ms132474.aspx)返回到包含您管理添加到的列表的世界。

# sql - 在MySQL中排名，如何在频繁更新和大数据集的情况下获得最佳性能？

> ID：554161
> 
> 赞同：0
> 
> 时间：2009-02-16T18:46:22.970
> 
> 标签：sql, mysql, rdbms

我想在一张非常大的桌子上进行分组排名，我已经找到了一些解决这个问题的方法，例如在[这篇文章](https://stackoverflow.com/questions/532878/how-to-perform-grouped-ranking-in-mysql)和网络上的其他地方。但是，我无法弄清楚这些解决方案的最坏情况复杂性。具体问题包括一个表格，其中每一行都有一些点和一个关联的名称。我希望能够请求排名间隔，例如 1-4。以下是一些数据示例：

```
name | points
Ab     14
Ac     14
B      16
C      16
Da     15
De     13 
```

使用这些值创建以下“排名”：

```
Query id | Rank | Name
1          1      B
2          1      C
3          3      Da
4          4      Ab
5          4      Ac
6          6      De 
```

并且应该可以在查询 ID 上创建以下间隔：2-5 给出排名：1、3、4 和 4。

该数据库包含大约 300 万条记录，因此如果可能，我希望避免使用复杂度大于 log(n) 的解决方案。数据库上不断更新和插入，因此这些操作最好也以 log(n) 复杂度执行。我不确定这是否可能，我已经尝试过一段时间了。我得出的结论是二进制搜索应该是可能的，但我无法创建执行此操作的查询。我正在使用 MySQL 服务器。

我将详细说明过滤的伪代码如何工作。首先，需要一个关于 (points, name) 的索引。作为输入，您给出一个 fromrank 和一个 tillrank。数据库中的记录总数为 n。伪代码应如下所示：

找到中点值，计算小于该值的行数（计数给出了粗略估计的排名，不考虑具有相同点数的那些）。如果返回的数字大于 fromrank 分隔符，我们细分前半部分并找到它的中位数。我们一直这样做，直到我们确定 fromrank 应该开始的点数。然后我们使用名称索引在该数量的点内执行相同的操作，并找到中位数，直到我们到达正确的行。我们对tillrank 做同样的事情。

结果应该是 log(n) 的细分数。因此，考虑到中位数和计数可以在 log(n) 时间内完成，应该可以在最坏情况复杂度 log(n) 中解决问题。如果我错了，请纠正我。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-16T20:04:20.910

您需要一个存储过程才能使用参数调用它：

```
CREATE TABLE rank (name VARCHAR(20) NOT NULL, points INTEGER NOT NULL);

CREATE INDEX ix_rank_points ON rank(points, name);

CREATE PROCEDURE prc_ranks(fromrank INT, tillrank INT)
BEGIN
  SET @fromrank = fromrank;
  SET @tillrank = tillrank;
  PREPARE STMT FROM
  '
  SELECT  rn, rank, name, points
  FROM  (
    SELECT  CASE WHEN @cp = points THEN @rank ELSE @rank := @rn + 1 END AS rank,
            @rn := @rn + 1 AS rn,
            @cp := points,
            r.*
    FROM (
         SELECT @cp := -1, @rn := 0, @rank = 1
         ) var,
         (
         SELECT *
         FROM rank
         FORCE INDEX (ix_rank_points)
         ORDER BY
           points DESC, name DESC
         LIMIT ?
         ) r
    ) o
  WHERE rn >= ?
  ';
  EXECUTE STMT USING @tillrank, @fromrank;
END;

CALL prc_ranks (2, 5); 
```

如果您创建索引并强制`MySQL`使用它（如在我的查询中），那么查询的复杂性将根本不取决于行数，它将仅取决于`tillrank`.

它实际上会`tillrank`从索引中获取最后一个值，对它们执行一些简单的计算并过滤掉第一个`fromrank`值。

如您所见，此操作的时间仅取决于`tillrank`，而不取决于有多少条记录。

我刚刚检查了行，它在几秒钟内从到`400,000`选择排名（即立即）`5``100``0,004`

**重要提示：**这仅在您按名称排序时有效`DESCENDING`。`MySQL`不支持`DESC`索引中的子句，这意味着`points`and`name`必须按一个顺序排序`INDEX SORT`才能使用（两者`ASCENDING`或两者`DESCENDING`）。如果你想快速`ASC`排序`name`，你需要在数据库中保留**负数**，并更改`SELECT`子句中的符号。

您也可以完全从索引中删除，并在不使用索引的情况下`name`执行最终'ing：`ORDER`

```
CREATE INDEX ix_rank_points ON rank(points);

CREATE PROCEDURE prc_ranks(fromrank INT, tillrank INT)
BEGIN
  SET @fromrank = fromrank;
  SET @tillrank = tillrank;
  PREPARE STMT FROM
  '
  SELECT  rn, rank, name, points
  FROM  (
    SELECT  CASE WHEN @cp = points THEN @rank ELSE @rank := @rn + 1 END AS rank,
            @rn := @rn + 1 AS rn,
            @cp := points,
            r.*
    FROM (
         SELECT @cp := -1, @rn := 0, @rank = 1
         ) var,
         (
         SELECT *
         FROM rank
         FORCE INDEX (ix_rank_points)
         ORDER BY
           points DESC
         LIMIT ?
         ) r
    ) o
  WHERE rn >= ?
  ORDER BY rank, name
  ';
  EXECUTE STMT USING @tillrank, @fromrank;
END; 
```

这将影响大范围的性能，但您几乎不会在小范围内注意到它。

# eclipse - Subversive（Eclipse SVN 插件）将外部报告为受阻

> ID：554163
> 
> 赞同：3
> 
> 时间：2009-02-16T18:47:21.580
> 
> 标签：eclipse, svn, subversive

在使用 Subversive 进行全新结帐后，由于 svn:external 属性而检索到的一些目录显示为受阻。然而，并非所有人都是。“svn status”的命令行使用正确地将所有目录显示为外部目录，没有任何障碍。

为什么会这样？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-16T19:03:26.067

这看起来像[这个线程](http://forums.polarion.org/viewtopic.php?f=8&t=664)

> 我们检查了情况，发现如果**工作副本在更新时被外部进程锁定，**可能会出现问题。
> 
> 例如，与TortoiseSVN相关的进程TSVNCache时常产生与工作副本访问冲突，JavaSVN库无法正确完成工作副本修改。结果工作副本进入“阻塞”状态，即它已损坏。
> 
> 相同的诊断与任何在工作副本元数据修改时锁定工作副本的进程有关。（我们发现 MS Visual Studio 2005 Express Edition 的行为相同，但我不知道为什么 Studio 会锁定 WC？）

因此，请务必以尽可能少的应用程序运行数量进行结帐。

* * *

另一个冲突来源可能是：

> SVN 1.4.x 兼容客户端会自动将工作副本转换为 1.4.x 兼容格式。目前 Subversive Default 客户端与 SVN 1.4.x 工作副本格式不兼容。
> 
> 因此，如果您在您的情况下使用命令行 SVN 客户端对工作副本进行了任何修改，您将在工作区树中的资源上显示“阻塞”状态。
> 
> 为了解决这个问题，我建议您切换 SVN 客户端选项并选择基于 SVN Kit 1.1.0 的客户端或 Native JavaHL 1.4.2 客户端。
> 接下来，如果资源已经被修饰为“阻塞”，请关闭然后重新打开相应的项目，或者干脆重新启动 Eclipse IDE 以重新加载 SVN 元信息缓存。

现在：您的确切版本可能不一样，但这是另一个需要检查的线索。

# javascript - 在 HTML 页面上绘制箭头以可视化文本跨度之间的语义链接

> ID：554167
> 
> 赞同：41
> 
> 时间：2009-02-16T18:49:17.160
> 
> 标签：javascript, html, visualization

我有一个 HTML 页面，其中一些文本跨度标记如下：

```
...
<span id="T2" class="Protein">p50</span>
...
<span id="T3" class="Protein">p65</span>
...
<span id="T34" ids="T2 T3" class="Positive_regulation">recruitment</span>
... 
```

即每个跨度都有一个 ID，并通过它们的 ID 引用零个或多个跨度。

我想将这些参考可视化为箭头。

两个问题：

*   如何将跨度的 ID 映射到跨度渲染的屏幕坐标？
*   如何绘制从一个渲染到另一个渲染的箭头？

该解决方案应该在 Firefox 中工作，在其他浏览器中工作是一个加号，但不是真正必要的。该解决方案可以使用 jQuery 或其他一些轻量级 JavaScript 库。

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2009-03-08T16:03:12.463

这引起了我足够长的兴趣，并产生了一个小测试。代码如下，您可以[看到它的实际效果](http://www.things.org.uk/examples/arrowtest.html)

![截屏](https://i.stack.imgur.com/WOrC8.png)

它列出了页面上的所有跨度（如果合适的话，可能希望将其限制为 id 以 T 开头的那些），并使用 'ids' 属性来构建链接列表。在跨度后面使用画布元素，它在每个源跨度的跨度上方和下方交替绘制弧形箭头。

```
<script type="application/x-javascript"> 

function generateNodeSet() {
  var spans = document.getElementsByTagName("span");
  var retarr = [];
  for(var i=0;i<spans.length; i++) { 
     retarr[retarr.length] = spans[i].id; 
  } 
  return retarr; 
} 

function generateLinks(nodeIds) { 
  var retarr = []; 
  for(var i=0; i<nodeIds.length; i++) { 
    var id = nodeIds[i];
    var span = document.getElementById(id); 
    var atts = span.attributes; 
    var ids_str = false; 
    if((atts.getNamedItem) && (atts.getNamedItem('ids'))) { 
      ids_str = atts.getNamedItem('ids').value; 
    } 
    if(ids_str) { 
      retarr[id] = ids_str.split(" ");
    }
  } 
  return retarr; 
} 

// degrees to radians, because most people think in degrees
function degToRad(angle_degrees) {
   return angle_degrees/180*Math.PI;
}
// draw a horizontal arc
//   ctx: canvas context;
//   inax: first x point
//   inbx: second x point
//   y: y value of start and end
//   alpha_degrees: (tangential) angle of start and end
//   upside: true for arc above y, false for arc below y.
function drawHorizArc(ctx, inax, inbx, y, alpha_degrees, upside)
{
  var alpha = degToRad(alpha_degrees);
  var startangle = (upside ? ((3.0/2.0)*Math.PI + alpha) : ((1.0/2.0)*Math.PI - alpha));
  var endangle = (upside ? ((3.0/2.0)*Math.PI - alpha) : ((1.0/2.0)*Math.PI + alpha));

  var ax=Math.min(inax,inbx);
  var bx=Math.max(inax,inbx);

  // tan(alpha) = o/a = ((bx-ax)/2) / o
  // o = ((bx-ax)/2/tan(alpha))
  // centre of circle is (bx+ax)/2, y-o
  var circleyoffset = ((bx-ax)/2)/Math.tan(alpha);
  var circlex = (ax+bx)/2.0;
  var circley = y + (upside ? 1 : -1) * circleyoffset;
  var radius = Math.sqrt(Math.pow(circlex-ax,2) + Math.pow(circley-y,2));

  ctx.beginPath();
  if(upside) {
      ctx.moveTo(bx,y);
    ctx.arc(circlex,circley,radius,startangle,endangle,1);
  } else {
    ctx.moveTo(bx,y);
    ctx.arc(circlex,circley,radius,startangle,endangle,0);
  }
  ctx.stroke();
}

// draw the head of an arrow (not the main line)
//  ctx: canvas context
//  x,y: coords of arrow point
//  angle_from_north_clockwise: angle of the line of the arrow from horizontal
//  upside: true=above the horizontal, false=below
//  barb_angle: angle between barb and line of the arrow
//  filled: fill the triangle? (true or false)
function drawArrowHead(ctx, x, y, angle_from_horizontal_degrees, upside, //mandatory
                       barb_length, barb_angle_degrees, filled) {        //optional
   (barb_length==undefined) && (barb_length=13);
   (barb_angle_degrees==undefined) && (barb_angle_degrees = 20);
   (filled==undefined) && (filled=true);
   var alpha_degrees = (upside ? -1 : 1) * angle_from_horizontal_degrees; 

   //first point is end of one barb
   var plus = degToRad(alpha_degrees - barb_angle_degrees);
   a = x + (barb_length * Math.cos(plus));
   b = y + (barb_length * Math.sin(plus));

   //final point is end of the second barb
   var minus = degToRad(alpha_degrees + barb_angle_degrees);
   c = x + (barb_length * Math.cos(minus));
   d = y + (barb_length * Math.sin(minus));

   ctx.beginPath();
   ctx.moveTo(a,b);
   ctx.lineTo(x,y);
   ctx.lineTo(c,d);
   if(filled) {
    ctx.fill();
   } else {
    ctx.stroke();
   }
   return true;
}

// draw a horizontal arcing arrow
//  ctx: canvas context
//  inax: start x value
//  inbx: end x value
//  y: y value
//  alpha_degrees: angle of ends to horizontal (30=shallow, >90=silly)
function drawHorizArcArrow(ctx, inax, inbx, y,                 //mandatory
                           alpha_degrees, upside, barb_length) { //optional
   (alpha_degrees==undefined) && (alpha_degrees=45);
   (upside==undefined) && (upside=true);
   drawHorizArc(ctx, inax, inbx, y, alpha_degrees, upside);
   if(inax>inbx) { 
    drawArrowHead(ctx, inbx, y, alpha_degrees*0.9, upside, barb_length); 
   } else { 
    drawArrowHead(ctx, inbx, y, (180-alpha_degrees*0.9), upside, barb_length); 
   }
   return true;
}

function drawArrow(ctx,fromelem,toelem,    //mandatory
                     above, angle) {        //optional
  (above==undefined) && (above = true);
  (angle==undefined) && (angle = 45); //degrees 
  midfrom = fromelem.offsetLeft + (fromelem.offsetWidth / 2) - left - tofromseparation/2; 
  midto   =   toelem.offsetLeft + (  toelem.offsetWidth / 2) - left + tofromseparation/2;
  //var y = above ? (fromelem.offsetTop - top) : (fromelem.offsetTop + fromelem.offsetHeight - top);
  var y = fromelem.offsetTop + (above ? 0 : fromelem.offsetHeight) - canvasTop;
  drawHorizArcArrow(ctx, midfrom, midto, y, angle, above);
}

    var canvasTop = 0;
function draw() { 
  var canvasdiv = document.getElementById("canvas");
  var spanboxdiv = document.getElementById("spanbox");
  var ctx = canvasdiv.getContext("2d");

  nodeset = generateNodeSet(); 
  linkset = generateLinks(nodeset);
  tofromseparation = 20;

  left = canvasdiv.offsetLeft - spanboxdiv.offsetLeft;
  canvasTop = canvasdiv.offsetTop - spanboxdiv.offsetTop; 
  for(var key in linkset) {  
    for (var i=0; i<linkset[key].length; i++) {  
      fromid = key; 
      toid = linkset[key][i]; 
      var above = (i%2==1);
      drawArrow(ctx,document.getElementById(fromid),document.getElementById(toid),above);
    } 
  } 
} 

</script> 
```

你只需要在某处调用 draw() 函数：

```
<body onload="draw();"> 
```

然后是一组跨度后面的画布。

```
<canvas style='border:1px solid red' id="canvas" width="800" height="7em"></canvas><br /> 
<div id="spanbox" style='float:left; position:absolute; top:75px; left:50px'>
<span id="T2">p50</span>
...
<span id="T3">p65</span> 
...
<span id="T34" ids="T2 T3">recruitment</span>
</div> 
```

据我所知，未来的修改：

*   展平较长箭头的顶部
*   重构能够绘制非水平箭头：为每个添加一个新的画布？
*   使用更好的例程来获取画布和跨度元素的总偏移量。

[2011 年 12 月编辑：已修复，感谢 @Palo]

希望这既有用又有趣。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-02-16T19:07:30.283

您有几个选择：[svg](http://developer.mozilla.org/en/SVG/Tutorial/Getting_Started)或[canvas](http://developer.mozilla.org/en/Canvas_tutorial)。

从外观上看，您不需要这些箭头具有任何特定的数学形式，您只需要它们在元素之间移动即可。

试试[WireIt](http://neyric.github.io/wireit/)。看看这个[WireIt Demo](http://neyric.github.io/wireit/sandbox/presentation.html)（*已被弃用*）。它`canvas`为浮动对话框之间的每条线使用一个标签`div`，然后调整每个元素的大小和位置`canvas`，以在正确的位置给出连接线的外观。您可能必须实现一个额外的旋转箭头，除非您不介意以相同角度进入每个元素的箭头。

**编辑**：[演示已被弃用](https://github.com/neyric/wireit/commit/73fab603636490e68ce9e82ef05e9d99086e675c)。

**编辑**：忽略这个答案，[*@Phil H 搞定*了](https://stackoverflow.com/questions/554167/drawing-arrows-on-an-html-page-to-visualize-semantic-links-between-textual-spans#623770)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-02-22T08:37:14.317

一个很棒的箭头库是基于 Raphael的[JointJS ，如上所示。](http://www.jointjs.com)使用 JointJS，您可以轻松绘制带有曲线或顶点的箭头，而无需任何复杂的东西；-)

```
var j34 = s3.joint(s4, uml.arrow).setVertices(["170 130", "250 120"]); 
```

这定义了一个箭头“j34”，它将两个 js 项 s3 与 s4 连接起来。其他所有内容都可以在 JointJS 的文档中阅读。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-25T16:09:28.127

你可以试试[这个 JavaScript Vector Graphics Library](http://www.walterzorn.com/jsgraphics/jsgraphics_e.htm) - 这是非常聪明的东西，希望对你有帮助。

编辑：由于此链接已失效，这是来自[Archive.org](http://web.archive.org/web/20090220143503/http://walterzorn.com/jsgraphics/jsgraphics_e.htm)的另一个链接。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-28T19:53:41.260

如果您不需要弯曲箭头，则可以在列表上方或下方使用绝对定位的 div。然后，您可以使用 css 来设置这些 div 以及构成箭头的几个图像的样式。下面是一个使用 jQuery UI 项目中的图标集的示例（抱歉，URL 太长了）。

这是开始使用的 CSS：

```
<style>
 .below{
     border-bottom:1px solid #000;
     border-left:1px solid #000;
     border-right:1px solid #000;
 }
 .below span{
    background-position:0px -16px;
    top:-8px;
 }
 .above{
     border-top:1px solid #000;
     border-left:1px solid #000;
     border-right:1px solid #000;
 }
 .above span{
    background-position:-64px -16px;
    bottom:-8px;
 }

 .arrow{
    position:absolute;
    display:block;
    background-image:url(http://jquery-ui.googlecode.com/svn/trunk/themes/base/images/ui-icons_454545_256x240.png);
    width:16px;
    height:16px;
    margin:0;
    padding:0;
 }

.left{left:-8px;}

.right{right:-9px;}

</style> 
```

现在我们可以开始组装箭头 div。例如，要在上面的示例中设置从“需要”到“启动器”的箭头样式，您可以在 div 上使用左、下和右边框，并在 div 的左上角使用朝上的箭头图形。

```
<div class='below' style="position:absolute;top:30px;left:30px;width:100px;height:16px">
   <span class='arrow left'></span>
</div> 
```

在确定需要连接的事物的位置后，需要通过脚本应用内联样式。假设您的列表如下所示：

```
<span id="promoter">Promoter</span><span>Something Else</span><span id="requires">Requires</span> 
```

然后以下脚本将定位您的箭头：

```
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js"></script> 
<script>
$(function(){
 var promoterPos=$("#promoter").offset();
 var requiresPos=$("#requires").offset();
 $("<div class='below'><span class='arrow left'></span></div>")
 .css({position:"absolute",left:promoterPos.left,right:promoterPos.top+$("#promoter").height()})
 .width(requiresPos.left-promoterPos.left)
 .height(16)
 .appendTo("body");
});
</script> 
```

继续将上面的示例粘贴到一个空白的 html 页面中。这有点整洁。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-27T19:50:56.423

我尝试尽可能使用开放的 Web 技术，但事实是 HTML 和 JavaScript（或 jQuery）不是这项特定工作的工具（可悲但真实），尤其是当您绘制的图表变得越来越复杂时。

另一方面，**Flash**就是为此而生的。[解析 XML、布局文本（对字体和超级/下标有更多控制）和渲染曲线（参见flash.display.Graphics 类](http://help.adobe.com/en_US/AS3LCR/Flash_10.0/flash/display/Graphics.html)方法，如）所需的 ActionScript 3.0 代码要少得多`curveTo`。总体而言，您将看到更少的代码、更好的可维护性、更少的 hack、更广泛的兼容性和更稳定的绘图库。

祝项目顺利。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-28T02:09:09.757

正如其他人所提到的，Javascript 和 html 不是这类事情的好工具。

John Resig 用 Ja​​vaScript 编写[了 Processing.org 的实现](http://ejohn.org/blog/processingjs/)。它使用 canvas 元素，因此它可以在现代版本的 Firefox 中工作，但它不适用于所有浏览器。如果您只关心 Firefox，那么这可能是您要走的路。

您也许可以使用 SVG，但同样，并非所有浏览器都支持。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-28T20:23:03.607

您可以使用一些设置为透明 GIF 的`position:absolute`div来获得弯曲的箭头末端`background-image`……一组用于开始（顶部和底部）……一个`bacground:repeat`div 用于可扩展的中间，另一对用于结束（顶部和底部）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-11-17T09:16:21.107

我需要一个类似的解决方案，我正在研究[RaphaelJS JavaScript Library](http://raphaeljs.com/)。例如，您可以从`(x1,y1)`to绘制直箭头`(x2,y2)`：

```
Raphael.fn.arrow = function (x1, y1, x2, y2, size) {
  var angle = Math.atan2(x1-x2,y2-y1);
  angle = (angle / (2 * Math.PI)) * 360;
  var arrowPath = this.path(“M” + x2 + ” ” + y2 + ” L” + (x2 - size) + ” ” + (y2 - size) + ” L” + (x2 - size) + ” ” + (y2 + size) + ” L” + x2 + ” ” + y2 ).attr(“fill”,”black”).rotate((90+angle),x2,y2);
  var linePath = this.path(“M” + x1 + ” ” + y1 + ” L” + x2 + ” ” + y2);
  return [linePath,arrowPath];
} 
```

我还没有弄清楚如何画一个弯曲的箭头，但我相信这是可能的。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-01-29T15:54:47.840

您可以使用[这个库](https://github.com/thSoft/SvgConnectors)：只需使用源和目标元素的 id 注释您的 SVG 行。它使用[MutationObserver](https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver)来观察连接元素的变化。

# jquery - 连续的，非并发的 jQuery AJAX 帖子

> ID：554181
> 
> 赞同：2
> 
> 时间：2009-02-16T18:52:49.943
> 
> 标签：jquery, ajax, post

我可能遗漏了一些明显的东西，但我似乎无法让我的 AJAX 帖子连续运行而不是与 jQuery 同时运行。

`ad_numbers`是一个数字 ID 数组。

```
$(ad_numbers).each(function() {
  ad_number = $.trim(this);

  if(!ad_number) { return true; }

  $.post('/fetch.php', { ad_number: ad_number }, function(data, textStatus) {
    $('#log').prepend('<p>' + data + '</p>');
  });
}); 
```

在`fetch.php`，我已经拥有它，`sleep(2)`所以我可以确保它正常工作。与其等待第一个 POST 完成，然后再进入数组中的下一个广告编号，它似乎同时同时运行所有这些。

我猜`$.post()`是在完成之前返回？避免这种情况的最佳方法是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-16T18:55:43.743

尝试添加`async: false`到您的选项中。

```
$(ad_numbers).each(function() {
    ad_number = $.trim(this);

    if(!ad_number) { return true; }

    $.ajax({
        type: 'POST',
        url: '/fetch.php',
        data: {ad_number: ad_number},
        async: false,
        success: function(data, textStatus) {
            $('#log').prepend('<p>' + data + '</p>');
        }
    });
}); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-16T18:56:31.043

AJAX 是异步的。`fetch.php`可能正在调用`sleep`，但 JavaScript 以异步模式工作，不会等待您`sleep`结束。

# nhibernate - NHibernate - 将同一实体映射到同一数据库中的不同表

> ID：554200
> 
> 赞同：4
> 
> 时间：2009-02-16T19:00:14.917
> 
> 标签：nhibernate, nhibernate-mapping

假设我们有一个 Employee 实体，它由一些其他实体组成，例如一对多的地址和联系人，以及一些字段（姓名、年龄等）。我们将这个实体映射出来并且可以很好地使用它，将每个部分保存到“Employee”、“EmployeeAddresses”和“EmployeeContacts”表中。

但是，我们几乎将所有该员工的信息用于大型计算，并有一个单独的“EmployeeInput”对象，该对象由相同的 Address 和 Contact 对象列表组成（即 Employee 和 EmployeeInputs 对象都有一个 Address 和 Contact 实体列表）。当我们为以后的审计目的进行计算时，我们需要保存这些信息。我们希望将此 EmployeeInput 实体保存到数据库中的“EmployeeInput”表中。

我们遇到的问题是如何保存地址和联系人列表？我们希望将它们粘贴到“EmployeeInputAddresses”和“EmployeeInputContacts”之类的东西中，但地址和联系人实体已经分别映射到“EmployeeAddresses”和“EmployeeContacts”。

在不创建新的“EmployeeInputAddress”和“EmployeeInputContact”实体以及为每个实体单独映射文件的情况下完成此操作的最简单方法是什么（因为这些字段实际上会一个一个地复制）。换句话说，我们如何将单个实体 Address 映射到两个不同的表，具体取决于它所属的父对象（如果是从 Employee 对象保存的 EmployeeAddresses 表，如果是从 EmployeeInput 对象保存的 EmployeeInputAddresses 表）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T19:09:07.150

最简单的方法是将地址和联系人映射为复合元素。这样，您就可以对集合进行不同的映射`Employee`，`EmployeeInput`因为映射归容器所有。

例如：

```
public class Employee
{
    public List<Address> Addresses{get; set;}
}

public class EmployeeInput
{
    public List<Address> Addresses{get; set;}
}

public class Address
{
    public string Street{get;set;}
    public string City{get; set;}
} 
```

会有以下映射：

```
<class name="Employee" table="Employees">
    <id name="id">
        <generator class="native"/?
    </id>
    <list name="Addresses" table="EmployesAddresses">
        <key column="Id" />
        <index column="Item_Index" />
        <composite-element class="Address">
            <property name="Street" />
            <property name="City" />
        </composite-element>
    </list>
</class>

<class name="EmployeeInput" table="EmployeesInput">
    <id name="id">
        <generator class="native"/?
    </id>
    <list name="Addresses" table="EmployeesInputAddresses">
        <key column="Id" />
        <index column="Item_Index" />
        <composite-element class="Address">
            <property name="Street" />
            <property name="City" />
        </composite-element>
    </list>
</class> 
```

# java - Guice 可以初始化 bean 吗？

> ID：554201
> 
> 赞同：4
> 
> 时间：2009-02-16T19:00:49.707
> 
> 标签：java, dependency-injection, inversion-of-control, guice

我以前使用过 Spring（并且喜欢它），但我想看看[Guice](http://code.google.com/p/google-guice/)。

有没有办法使用 Guice 将地图或列表之类的东西初始化为 bean？

例如，我之前在 Spring 中完成了以下操作，将我想要处理的项目列表注入到某个 bean 中。

```
<property name="FilesToProcess">
   <list>
      <value>file1.xml</value>
      <value>file2.xml</value>
   </list>
</property> 
```

我怎样才能在 Guice 中做到这一点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-16T19:24:21.287

Guice2 有 MultiBindings 和 MapBindings，应该适合你。

[https://github.com/google/guice/wiki/Multibindings](https://github.com/google/guice/wiki/Multibindings)

更新：

再次查看后，您可能会问如何将运行时值注入 Guice，可能是任意对象。

Guice 非常专注于将所有事情都作为类型安全代码来做，所以它并不自然地适合这一点。我为 Guice 提供输入所做的工作是创建一个 XML 模式并使用 jaxb 将其吸入并注入结果对象。

有一个 Names.bindProperties 方法用于将常规旧属性绑定到 Guice 常量中。

还与 Spring 进行了某种程度的集成，因此您可能也想看看这个。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T19:45:12.347

Guice 允许您注入类型文字。语法有点奇怪。有一个[博客条目](http://publicobject.com/2008/11/guice-punches-erasure-in-face.html)解释了原因。

绑定看起来像这样：

```
public class SampleModule extends AbstractModule {
    protected void configure() {
        bind(new TypeLiteral<List<String>>() {}).
                annotatedWith(Names.named("FilesToProcess")).
                toInstance(Arrays.asList("file1.xml", "file2.xml"));
    }
} 
```

然后您的应用程序代码可以按名称注入列表，如下所示：

```
public class SampleClass {
    private final List<String> files;

    @Inject
    public SampleClass(@Named("FilesToProcess") List<String> files) {
        this.files = files;
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T16:23:41.750

我同意 Dave Stenglein 的运行时值。

有像[Obix](http://obix-framework.sourceforge.net/)这样专门用于配置的框架。我喜欢 Guice 的*代码注入*，但它们更适合*配置注入*。

# c++ - C++ 中的 Round() 在哪里？

> ID：554204
> 
> 赞同：38
> 
> 时间：2009-02-16T19:01:57.130
> 
> 标签：c++, rounding

### 重复：[round() 用于 C++ 中的浮点数](https://stackoverflow.com/questions/485525/round-for-float-in-c)

* * *

我正在使用 VS2008 并且我已经包含了 math.h 但我仍然找不到圆形函数。它存在吗？

我在 google 上看到一堆“添加 0.5 并转换为 int”的解决方案。这是最佳做法吗？

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-02-16T19:07:02.810

您可以使用 C++11 的[`std::round()`](http://en.cppreference.com/w/cpp/numeric/math/round).

如果您仍然坚持旧标准，您可以使用[`std::floor()`](http://en.cppreference.com/w/cpp/numeric/math/floor)，它总是四舍五入到较小的数字，并且[`std::ceil()`](http://en.cppreference.com/w/cpp/numeric/math/ceil)，它总是四舍五入到较大的数字。

要获得正常的舍入行为，您确实会使用`floor(i + 0.5)`.

这种方式会给您带来负数问题，解决该问题的方法是使用 ceil() 处理负数：

```
double round(double number)
{
    return number < 0.0 ? ceil(number - 0.5) : floor(number + 0.5);
}
```

另一种更简洁但更耗费资源的方法是使用字符串流和输入/输出操纵器：

```
#include <iostream>
#include <sstream>

double round(double val, int precision)
{
    std::stringstream s;
    s << std::setprecision(precision) << std::setiosflags(std::ios_base::fixed) << val;
    s >> val;
    return val;
}
```

如果您的资源不低和/或需要控制精度，请仅使用第二种方法。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-16T19:15:59.903

使用`floor(num + 0.5)`不适用于负数。在这种情况下，您需要使用`ceil(num - 0.5)`.

```
double roundToNearest(double num) {
    return (num > 0.0) ? floor(num + 0.5) : ceil(num - 0.5);
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-16T19:07:49.423

Microsoft math.h 中实际上没有圆形函数。
但是，您可以改用静态方法 Math::Round()。
（取决于您的项目类型。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-16T19:08:51.293

我不知道这是否是最佳实践，但使用 0.5 技术和 floor() 似乎是要走的路。

# sql - 使用 MySQL，如何在另一个表中不存在该值的情况下插入一个表？

> ID：554205
> 
> 赞同：3
> 
> 时间：2009-02-16T19:02:53.647
> 
> 标签：sql, mysql, insert, conditional

我有一个 MySQL 数据库，我想在一个表中插入一些值，假设我插入的特定值与不同表中的值不匹配。

这是一个简化/示例结构：

```
Table: invites
    id : int (auto-increment index)
    name : varchar
    message : varchar

Table: donotinvite
    name : varchar (index) 
```

假设“名称”与单个语句中的“donotinvite”表中的任何“名称”都不匹配，是否可以有条件地将“名称”和“消息”对插入到“邀请”表中？

大概是这样的吧？

```
INSERT INTO invites
    SET name = 'joe', message = 'This is an invite'
WHERE NOT EXISTS 
    (SELECT name 
    FROM donotinvite
    WHERE name = 'joe') 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-16T19:25:16.170

```
INSERT
INTO invites (name, message)
SELECT a.name, a.message
FROM (SELECT @name AS name, @message AS message) a
LEFT JOIN donotinvite d
ON a.name = d.name
WHERE d.name IS NULL 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-16T19:12:02.223

（我是一个 MSSQL 人，所以不确定是否都适合 MySQL）

```
INSERT INTO invites
(
    name, message
)
SELECT name = 'joe', message = 'This is an invite'
WHERE NOT EXISTS 
    (SELECT *
    FROM donotinvite
    WHERE name = 'joe') 
```

在实践中，您可能会将所有名称/消息放在一个临时表中，然后执行以下操作：

```
INSERT INTO invites
(
    name, message
)
SELECT T.name, T.message
FROM MyTempTable AS T
WHERE NOT EXISTS 
(
    SELECT *
    FROM donotinvite AS DNI
    WHERE DNI.name = T.name
) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-16T19:20:37.473

这可以完成这项工作，但我不确定它会表现得那么好。它可能适用于您的应用程序：

```
INSERT INTO invites(name, message) 
SELECT p.name, "This is an invite" 
FROM people AS p  
WHERE p.name NOT IN (SELECT name FROM donotinvite); 
```

你有没有一张表`people`，你可以向所有人发送邀请的目录？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-10-31T03:56:10.233

```
INSERT INTO invites (name, message) 
SELECT 'joe', 'This is an invite' FROM (SELECT 1) t 
WHERE NOT EXISTS (SELECT * FROM donotinvite WHERE name = 'joe'); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-16T19:48:37.330

[这是jonstjohn](https://stackoverflow.com/users/67009/jonstjohn)奇怪删除的答案的重新发布，由我稍作修改：

```
INSERT INTO invites (name, message) 
    SELECT 'joe','This is an invite' 
    FROM donotinvite 
    WHERE name <> 'joe' 
```

编辑：这不符合我的要求:)。

# css - 用于网页布局和设计的 css 或母版页之间哪个更好？

> ID：554209
> 
> 赞同：-1
> 
> 时间：2009-02-16T19:03:53.833
> 
> 标签：css, layout, master-pages, graphic-design

当然，请告诉我 css 更好更快，或者是网页布局和图形设计的母版页。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-16T19:05:28.120

它们是互补的，您应该同时学习并一起使用它们。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T19:08:47.847

您的母版页将提供一个 HTML 模板。此 HTML 模板应链接到一个 CSS 文件，该文件将为您的内容设置样式。所以你应该同时使用两者。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-16T22:06:26.983

啊。我想我现在理解了您的问题：“请给我一些合乎逻辑的理由，为什么要使用 CSS 进行布局，而不是将硬编码布局（表格？）推入母版页？”

我从许多通过 Windows 背景跳入 Web 编程的人那里听到这个问题。

由于以下几点，Web 世界中的布局比 Windows 编程产生的影响要大得多：

1.  不同的浏览器以不同的方式呈现 html。
2.  对于盲人和残疾人，某些蛮力技术会阻碍可访问性和/或基于选项卡的访问。（“为什么该控件会获得焦点？！”）
3.  布局调整。哇。这个很大。当您有一个需要大量用户输入的表单时，如果标签出现在带有一些简单 css 类的控件的左侧或顶部，则调整起来会更容易。

另外，许多人忘记预定义 CSS 库的一件事是它们是 UI 的类库。仅仅了解包装控件的标准方法可以极大地改善您的布局问题，并且由于大多数预定义的 CSS 库使用相同的类名，您可以将它们换掉以获得完全不同的外观。

# php - 查找 PHP 孤儿页面

> ID：554210
> 
> 赞同：1
> 
> 时间：2009-02-16T19:04:08.793
> 
> 标签：php

我继承了一个 PHP 应用程序，它具有页面的“版本”（viewacct.php、viewacct2.php、viewacct_rcw.php 等）。我想知道哪些页面是从应用程序中的其他页面调用的，哪些不是。有没有可用的工具可以帮助解决这个问题？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-16T19:08:44.133

使用您喜欢的任何工具（Linux 上的 Find/Grep/Sed，我在 Windows 上使用 Visual Studio），只需爬取源代码树以获取每个文件中文件名的引用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T19:32:43.250

与 FlySwat 的回答类似：任何具有多文件搜索功能的优秀文本编辑器或 IDE 都应该能够帮助您找到孤立页面。在 Mac OS XI 上，建议使用 TextWrangler(free)、TextMate($) 或 BBEdit($$)。我使用这些工具都取得了很好的成功，但你的里程可能会有所不同。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-16T22:07:30.663

如果您想找出其他页面调用了哪些页面，则需要查看调用内容的位置。显然，在 php 代码中，您只能通过 include 或 requires 以及这些函数的单数版本来引用其他文件。

因此，如果我是你，我会 grep 你的包含代码，然后要求并尝试制作某种地图来显示什么在调用什么。最终你应该得到一个非常清晰的 php 文件如何相互通信的地图。然后你需要弄清楚应用程序的各个点是如何通过 HTML/AJAX 等从那里相互通信的。

祝你好运。我以前做过，这需要一段时间，但你会到达那里，只要确保你记录下你发现的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-27T07:56:54.910

您可能想试用[nWire for PHP](http://www.nwiresoftware.com/products/nwire-php)。

nWire for PHP 是一个创新的 Eclipse 插件（与 Eclipse PDT 和 Zend Studio 7 一起使用），它通过帮助开发人员浏览他们的代码并更好地理解他们的应用程序的架构来加速 PHP 开发。nWire 为实时代码可视化、导航和搜索提供独特的工具。

nWire 分析项目中的所有组件和关联。打开文件时，您可以立即看到它在哪里（以及是否）被使用。

# browser - 缓存和重用 HtmlElement 对象树

> ID：554213
> 
> 赞同：0
> 
> 时间：2009-02-16T19:06:03.033
> 
> 标签：browser, webbrowser-control, dom

我`WebBrowser`在我的项目中使用控件来显示在运行时生成/操作的复杂 HTML 文档。

我注意到，通过创建`HtmlElement`对象以编程方式从 C# 构造 DOM 比生成 HTML 字符串并将其传递给 DOM 慢约 3 倍`WebBrowser`，后者又解析它以生成 DOM。在冗长的文档之间导航时，这两种方式都会产生明显的延迟。

我正在寻找在同一`WebBrowser`控件中的多个文档之间切换的最快方法，理想情况下无需为每个文档重复生成 DOM 树。是否可以在我的程序中的某处缓存对象树`HtmlElement`，然后根据需要将它们重新插入`WebBrowser`？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T22:24:01.347

我将根据本机 win32 COM API 来描述解决方案；在 C# 中编写互操作（或在 pinvoke.net 上找到）应该不会太难。或者，您可能需要使用托管对象公开的属性来获取本机对象。

您自己构建 DOM 的速度可能不会比 IE 的解析器快，因此创建一个空白 HTMLDocument（在本机代码中为 CoCreateInstance(CLSID_HTMLDocument)）和 QueryInterface() 用于其 IMarkupServices 实现的 HTMLDocument。还使用 IMarkupServices::CreateMarkupPointer() 方法创建两个 IMarkupPointer。

接下来调用 IMarkupServices::ParseString() 来解析您的 HTML。这将为您提供一个指向包含您的 DOM 的 IMarkupContainer 的指针，以及指向您的 DOM 开头和结尾的两个 IMarkupPointer。现在您可以使用 IMarkupServices::Move() 将数据从一个 IMarkupContainer 移动到另一个。

因此，您将使用的一般方案是拥有一个 HTMLDocument，它是您的“显示”文档，并且它与 IMarkupContainer 相关联（您可以只使用 QueryInterface() ）。然后你有一个向量或列表或所有非显示标记容器中的任何一个。然后，您只需为显示文档创建一个标记指针，调用 IMarkupPointer::MoveToContainer(displayDocumentContainer, true)，然后使用它将内容从显示容器移动到不显示的容器，反之亦然。

需要注意的一件事：您只能在创建它们或获取它们的线程上访问这些对象。所有 IE 对象都是 STA 对象。如果需要多线程访问，则必须编组。

如果您有具体的后续问题，请告诉我。

参考：

*   [标记容器](http://msdn.microsoft.com/en-us/library/aa703631(VS.85).aspx)
*   [IMarkupServices](http://msdn.microsoft.com/en-us/library/aa703587(VS.85).aspx)
*   [标记服务简介](http://msdn.microsoft.com/en-us/library/bb508514(VS.85).aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-13T00:52:06.640

这会做到的

```
// On screen webbrowser control
webBrowserControl.Navigate("about:blank");
webBrowserControl.Document.Write("<div id=\"div1\">This will change</div>");
var elementToReplace = webBrowserControl.Document.GetElementById("div1");
var nodeToReplace = elementToReplace.DomElement as mshtml.IHTMLDOMNode;

// In memory webbrowser control to load fragement into
// It needs this base object as it is a COM control
var webBrowserFragement = new WebBrowser();
webBrowserFragement.Navigate("about:blank");
webBrowserFragement.Document.Write("<div id=\"div1\">Hello World!</div>");
var elementReplacement = webBrowserFragement.Document.GetElementById("div1");
var nodeReplacement = elementReplacement.DomElement as mshtml.IHTMLDOMNode;

// The magic happens here!
nodeToReplace.replaceNode(nodeReplacement); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-10T22:23:21.347

我真的需要更多地了解您如何生成这些文档。将数据转换为 XML 文档，然后使用 XSL 转换将数据转换为 HTML 并将其传递给 WebBrowser 控件可能会更快。

.NET 的 XSLT 实现的好处在于它采用 XSL 源并将其编译为临时程序集以加快转换速度。

如果您决定走这条路，请查看 MVP.XML 项目，该项目为现有的 XSLT 实现添加了一些不错的 exslt 功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-25T16:24:08.590

也许您可以在表单上的几个 WebBrowser 控件之间切换而不是缓存 DOM - 只有活动的控件是可见的？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-10T22:25:46.147

你能做这样的事情吗？

*   创建要在 DIV 中显示的内容
*   在不可见的 DIV 中创建辅助内容（在后台）
*   通过玩可见性来交换内容

# c# - 为什么我不能在 C# 中关闭表单？

> ID：554227
> 
> 赞同：0
> 
> 时间：2009-02-16T19:09:38.437
> 
> 标签：c#, .net, winforms

我无法以编程方式关闭我的表单之一。有人能帮我吗？

这是代码：

```
 private void WriteCheck_Load(object sender, EventArgs e) {
        SelectBankAccountDialog sbad = new SelectBankAccountDialog();
        DialogResult result = sbad.ShowDialog();
        if (result == DialogResult.Cancel) {
            this.Close();
        } else {
            MessageBox.Show(result.ToString());
        }
        MessageBox.Show(sbad.bankaccountID.ToString());
    } 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-16T20:36:38.260

正如配置器所提到的（在评论中），表单必须在关闭之前显示，因此，您应该在*Shown事件中执行此操作，而不是**Load*事件。

 *如果您不希望对话框对表单可见，我想您可以将事件代码包装在 Visible = false;

总之，基本代码将是

```
 private void WriteCheck_Shown(object sender, EventArgs e)
    {
        Visible = false;
        SelectBankAccountDialog sbad = new SelectBankAccountDialog();
        DialogResult result = sbad.ShowDialog();
        if (result == DialogResult.Cancel) {
            this.Close();
        } else {
            MessageBox.Show(result.ToString());
        }
        MessageBox.Show(sbad.bankaccountID.ToString());
        Visible = true;
    } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-16T19:17:36.920

通过调用`Form.Close()`，表单应该关闭，但要等到所有等待事件都已处理完毕。您还有机会取消在`FormClosing`活动中关闭的表格。

首先，您可能希望`return`在调用`this.Close()`. 如果它仍然没有关闭，请单步执行您的代码并查看发生了什么。您可能必须设置并检查“强制关闭”标志，并在它实际关闭之前从任何其他处理方法返回。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-16T19:20:28.707

实际的问题是窗口不会让表单关闭它的加载方法。我必须在构造中显示对话框，然后如果对话框结果是取消，我必须抛出异常并在表单创建时捕获异常。

[这个地方](http://www.devnewsgroups.net/group/microsoft.public.dotnet.framework.windowsforms/topic18413.aspx)更多地谈论它

# boolean - 布尔值的任何助记技巧？

> ID：554230
> 
> 赞同：3
> 
> 时间：2009-02-16T19:11:04.847
> 
> 标签：boolean, mnemonics

我想这对于大多数优秀的¹程序员来说是微不足道的，但我已经习惯了使用`true`和`false`²进行编程，以至于当我遇到 0 和 1 时，我永远记不起哪个代表真，哪个代表假。

有什么建议么？

¹好：[我的意思是一个知道 C 的人，当然](http://www.joelonsoftware.com/articles/ThePerilsofJavaSchools.html):)
²我是一名 Java 开发人员，正如你所猜到的 ;)

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-16T19:14:34.183

助记符是“这其中有多少真相？” 零整数意味着零真理。其他任何事情都是非零真理。:)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-16T19:19:50.473

我有一位同事，他的办公桌旁边的墙上只贴了一张便利贴：

> 错误 = 0
> 正确 != 0

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-16T19:43:19.027

如果你真的有那么大的麻烦，我会用这种语言把它抽象出来。

例如在 C 中

```
#define TRUE 1
#define FALSE 0 
```

一般来说，无论如何我都会避免在代码中放置常量。

考虑，

```
if(my_var == TRUE) 
```

相反，

```
if(my_var == 1) 
```

不过，在这里你需要确保你正在测试正确的东西，

```
if(my_var != FALSE) 
```

会抓到更多的病例。

干杯!

基督教

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-16T19:22:59.967

“不好了！”
（哦 == 0）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-16T19:35:14.677

由于在 shell (sh, bash) 中 true 为 0 而 false 为 1，这使情况变得复杂：

```
$ 真
$回声$？
0
$假
$回声$？
1

```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-16T19:59:36.430

你有没有注意到日常用品的电源开关用一个[圆圈代表关闭，一条线代表打开](http://en.wikipedia.org/wiki/Power_symbol)？

将它们链接起来并不是一件容易的事。

关 = 圆 = 零 = 假

开 = 行 = 一 = 真

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-16T19:14:39.923

记住“无==假”，“某事==真”

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-16T19:17:52.443

没有助记符 - 如果您来自硬件背景，它会变得更加复杂。但是对于程序员来说，只要问一个问题：

是否设置了任何位？

答案是真或假，就是结果。只有 0（即使是有符号整数）没有设置位。

-亚当

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-16T19:13:59.580

映射到`On`和`Off`。我认为大多数程序员都会以相同的方式映射这两个集合：1/true 都进入“开”，而 0/false 都进入“关”。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-16T20:47:31.057

这取决于语言。

*   **C**：`( 0 ? "never happens" : "false")`和`( 1 ? "true" : "never happens")`

*   **Ruby** , **ELisp** : 两者`0`都是`1`真的

*   **bash**（或**cmd.exe**）：`true`命令（来自 coreutils）以`0`状态码`false`退出，命令以非零状态码退出

许多现代流行的编程语言具有强大的 C 传统，因此它们认为`0`是错误的并且`1`（或任何非零数字）是正确的。

不要将助记符用于布尔值，使用您的语言的习语来测试真实性。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-16T19:38:20.053

爱c - 因为你不能增加谎言。:)

# c# - 使用 C# 以编程方式删除 HtmlElement 对象

> ID：554233
> 
> 赞同：6
> 
> 时间：2009-02-16T19:11:34.063
> 
> 标签：c#, browser, webbrowser-control, dom

在`WebBrowser`控件中，如何删除`HtmlElement`对象？类中没有方法`HtmlElement`可以完成此操作。作为一种解决方法，我可以创建一个“虚拟” `HtmlElement`（不将其插入`HtmlDocument`），然后将要删除`AppendChild`的对象插入（通过）其中。`HtmlElement`这感觉就像一个黑客。有一个更好的方法吗？

PS我想保留`HtmlElement`内存以供以后使用，而不是简单地销毁它（这就是将其父级设置`innerHtml`为空字符串的作用）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-12T05:06:36.737

看看这个 WebControl 继承，有很多功能： http: [//www.codeproject.com/KB/miscctrl/csEXWB.aspx](http://www.codeproject.com/KB/miscctrl/csEXWB.aspx)

您可以通过 id 向 del 元素添加删除方法。

希望这可以帮助

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-11T15:56:01.690

您可以通过将其 outerhtml 设置为空字符串来删除该元素。

elem.OuterHtml = ""

我希望这就是你要找的。

通用汽车

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-08-02T13:10:37.467

添加对 Microsoft.mshtml 的引用（来自 .Net 选项卡）

```
using Microsoft.mshtml;
....
{
...
    // To Remove     
    HTMLDocumentClass htmldoc = wbCtrl.Document.DomDocument as HTMLDocumentClass;
    IHTMLDOMNode node = htmldoc.getElementById("xBar") as IHTMLDOMNode;
    node.parentNode.removeChild(node);
...
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-16T19:41:40.513

我知道的唯一其他方法是更改​​父母的[`InnerHtml`](http://msdn.microsoft.com/en-us/library/system.windows.forms.htmlelement.innerhtml.aspx).

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-16T19:47:38.767

有一种称为`IHTMLDOMNode::removeNode`“官方”方法的方法，但这是`mshtml.dll`. 我正在寻找更适合 C# 的东西。

# internet-explorer - Internet Explorer Active X 硬件访问

> ID：554236
> 
> 赞同：0
> 
> 时间：2009-02-16T19:12:22.113
> 
> 标签：internet-explorer, hardware

这是一个快速的问题，

我们有一个客户端，希望在网页中嵌入一个活动 X，该网页可以访问（读/写）COM 端口。

通过初始测试，我们能够列出端口，但在尝试读取或写入它们时会被拒绝访问。有没有办法绕过这个，或者它是 Internet Explorer 的内置功能吗？

在 IDE 中运行时，该控件工作正常。但是当它嵌入到 IE 中时它会失败

该控件内置于 VS2008 VB.net 中，使用 IO.Ports.SerialPort 访问 COM 端口。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-16T19:29:43.850

哇，这个问题带回了一些噩梦。

我认为您需要调整权限-在.net 1.1中，包含控制台插件，但更高版本需要下载它（尝试[http://msdn.microsoft.com/en-us/library/2bc0cxhc.aspx](http://msdn.microsoft.com/en-us/library/2bc0cxhc.aspx) ) 我没有安装它，但这应该给你一个起点。

# sql-server - SQL Server 2005 - 阻塞进程报告

> ID：554240
> 
> 赞同：1
> 
> 时间：2009-02-16T19:14:24.353
> 
> 标签：sql-server, sql-server-profiler

我需要调查在我们的 SQL 2008 服务器上随机发生的一系列阻塞和死锁。我是该网站的主要开发人员，没有可以依靠的 DBA...

我计划在 2005 年使用阻塞进程报告并启用跟踪。

我会遇到哪些性能问题？数据库服务器适用于流量适中的网站，我想尽量减少跟踪将造成的影响。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T10:54:08.010

使用[事件通知](http://weblogs.sqlteam.com/mladenp/archive/2008/07/18/Immediate-deadlock-notifications-without-changing-existing-code.aspx)方法。它在 2005 年和 2008 年工作。它在检测死锁方面没有任何性能问题

# facebook - facebook 聊天窗口是如何实现的？

> ID：554243
> 
> 赞同：16
> 
> 时间：2009-02-16T19:14:58.860
> 
> 标签：facebook, iframe, frames

在[Facebook 上](http://www.facebook.com/)，您可以在不影响浮动聊天窗口的情况下浏览该网站。好像主页在 iFrame 内，而页脚和聊天窗口则漂浮在外面。

[![替代文字](https://i.stack.imgur.com/Ay9zD.gif)](https://i.stack.imgur.com/Ay9zD.gif)
[（来源：[k-director.com](http://www.k-director.com/blog/upload/FacebookChat03.gif)）]

是 iframe 中的主要内容还是 iframe 中的页脚和聊天窗口？

后者似乎不可能，因为在这种情况下，当您单击主页中的链接时，所有内容都必须重新加载，包括页脚 iframe。

如果您刷新页面，聊天窗口会重新加载，但如果您通过单击链接浏览站点，则不会。

谢谢你。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-22T08:02:02.940

如果您安装 FireBug 并为 Facebook 启用网络监视器，您会看到，当您单击应用程序内的大多数链接时，您并没有进行整页刷新，而是使用 AJAX 调用更新页面的新内容。

它看起来像一个新页面，但实际上您在同一页面上，几乎所有内容都被替换了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T20:06:55.867

可能只是一个绝对定位的 div，包含内容的滚动 div。Ajax 将提供内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-16T19:19:27.820

当您加载新页面时，聊天窗口确实会刷新，但是它们会保持其视图状态（打开/关闭/聊天历史记录）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-16T19:39:16.337

它是一个绝对定位的 div，位于浏览器窗口的底部。这并不难，我在一个周末从头开始克隆了 ClockingIT 的 Facebook 聊天。

# objective-c - 在 otest 下运行 Cocoa 应用程序会导致 Release 模式下的 dyld_misaligned_stack_error

> ID：554250
> 
> 赞同：0
> 
> 时间：2009-02-16T19:16:48.280
> 
> 标签：objective-c, cocoa, macos

我有一个问题，我一直在努力解决。

我有一个 Cocoa 库，它充当 C++ 库的包装器。C++ 库使用一组 BOOST 单元测试进行测试。测试在调试和发布模式下都能正常运行。

为了测试 Cocoa 包装器，我使用了 otest。这是奇怪的部分，测试在调试模式下正常运行，但在发布模式下失败。为了确保它不在代码中，我获取了测试内容并将它们编译为使用包装器代码的单独 Cocoa 应用程序。这通常在发布和调试下运行。

当 otest 失败时，我得到一个毫无意义的堆栈跟踪，并以 dyld_misaligned_stack_error 结束。

我注意到的另一件奇怪的事情是，当我从命令行而不是从 XCode 启动 otest 时，如果我将 DYLD_LIBRARY_PATH 和 DYLD_FRAMEWORK_PATH 指向 C++ 库的调试版本，则测试通过了。我已经确认我所有的测试代码都是用 Release 标志编译的。

任何帮助将不胜感激！

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T05:52:36.253

尝试在发布版本的 C 标志中添加标志“-mstackrealign”。

> -mstackrealign
> 
> 在入口处重新对齐堆栈。在 Intel x86 上，-mstackrealign 选项将生成重新对齐运行时堆栈的备用序言/尾声。这支持将保留 4 字节对齐堆栈的旧代码与保留 16 字节堆栈以实现 SSE 兼容性的现代代码混合。

请参阅 GCC 的手册页以供参考。

# iphone - 整数常量

> ID：554256
> 
> 赞同：15
> 
> 时间：2009-02-16T19:18:04.547
> 
> 标签：iphone, objective-c, cocoa-touch

如果我像这样声明一个字符串常量：

您应该创建一个头文件，如

```
// Constants.h
extern NSString * const MyFirstConstant;
extern NSString * const MySecondConstant;
//etc. 
```

您可以将此文件包含在每个使用常量的文件中或项目的预编译头文件中。

您在 .m 文件中定义这些常量，例如

```
// Constants.m

NSString * const MyFirstConstant = @"FirstConstant";
NSString * const MySecondConstant = @"SecondConstant"; 
```

我该怎么做才能定义整数常量？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-02-16T19:26:03.483

将 NSString* 替换为 NSInteger。

对于任何常量类型都是如此，无论是 int/float 等基本类型，还是 NSString 或 NSInteger 等类。

唯一需要注意的是您是否需要常量或指向常量的指针（例如 withNSString），以及它是如何在 .m 文件中初始化的

**整数示例：**

```
// constants.h
extern NSInteger const MyIntegerConstant;

// constants.m
NSInteger const MyIntegerConstant = 666; 
```

（注意：为什么 NSInteger 而不是普通的“int”，请参阅[这篇文章](https://stackoverflow.com/questions/13725/in-cocoa-do-you-prefer-nsinteger-or-just-regular-int-and-why)）

**类示例：**

```
// constants.h
extern MyClass* const MyClassConstant;

// constants.m
MyClass* const MyClassConstant= [[MyClass alloc] initWith: paramOne and:paramTwo]; 
```

# sql-server - 表分组方式 - Tsql -

> ID：554259
> 
> 赞同：1
> 
> 时间：2009-02-16T19:18:18.197
> 
> 标签：sql-server, database, tsql, group-by

[替代文字 http://img187.imageshack.us/img187/8453/testhc3.png](http://img187.imageshack.us/img187/8453/testhc3.png)

[替代文字 http://img145.imageshack.us/img145/3306/test2bn4.png](http://img145.imageshack.us/img145/3306/test2bn4.png)

第一张图片是我的查询。我需要在第二张图片中获得结果。

```
select OrarioA, OrarioB, MAX(VW_DettaglioOrariLinee_FromAToB.IDOrario), dbo.VW_DettaglioOrariLinee_FromAToB.IDDettaglioOrarioA, dbo.VW_DettaglioOrariLinee_FromAToB.IDDettaglioOrarioB
FROM         dbo.VW_DettaglioOrariLinee_FromAToB INNER JOIN
                      Tb_Linee ON dbo.VW_DettaglioOrariLinee_FromAToB.IDRelA = Tb_Linee.IDRelA AND 
                      dbo.VW_DettaglioOrariLinee_FromAToB.IDRelB = Tb_Linee.IDRelB INNER JOIN
                      dbo.periodi ON dbo.VW_DettaglioOrariLinee_FromAToB.IDOrario = dbo.periodi.IDOrario INNER JOIN
                      dbo.relgiornisettimanaorarilinee ON dbo.VW_DettaglioOrariLinee_FromAToB.IDOrario = dbo.relgiornisettimanaorarilinee.IDOrario 
```

这是我真正的查询：

```
WITH Tb_Linee AS
(
    SELECT * FROM VW_rellineestazionamenti 
    WHERE 
    IDLINEA = @IDLINEA 
    AND 
    IDStazA = @IDStazA 
    AND
    IDStazB = @IDStazB 
    AND
    PosizioneA = @PosizioneA
    AND
    PosizioneB = @PosizioneB
)

select OrarioA, OrarioB, VW_DettaglioOrariLinee_FromAToB.IDOrario, dbo.VW_DettaglioOrariLinee_FromAToB.IDDettaglioOrarioA, dbo.VW_DettaglioOrariLinee_FromAToB.IDDettaglioOrarioB
FROM         dbo.VW_DettaglioOrariLinee_FromAToB INNER JOIN
                      Tb_Linee ON dbo.VW_DettaglioOrariLinee_FromAToB.IDRelA = Tb_Linee.IDRelA AND 
                      dbo.VW_DettaglioOrariLinee_FromAToB.IDRelB = Tb_Linee.IDRelB INNER JOIN
                      dbo.periodi ON dbo.VW_DettaglioOrariLinee_FromAToB.IDOrario = dbo.periodi.IDOrario INNER JOIN
                      dbo.relgiornisettimanaorarilinee ON dbo.VW_DettaglioOrariLinee_FromAToB.IDOrario = dbo.relgiornisettimanaorarilinee.IDOrario 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-16T19:30:33.893

如果您只想分区`OrarioA`：

```
SELECT OrarioA, OrarioB, IDOrario, IDDettaglioOrarioA, IDDettaglioOrarioB
FROM (
  SELECT *, ROW_NUMBER() OVER (PARTITION BY OrarioA ORDER BY OrarioB DESC, IDOrario DESC) AS rn
  FROM table
  ) t
WHERE rn = 1 
```

，这将导致结果集为 on `picture 2`。

如果要按`OrarioA`and分区`OrarioB`：

```
SELECT OrarioA, OrarioB, IDOrario, IDDettaglioOrarioA, IDDettaglioOrarioB
FROM (
  SELECT *, ROW_NUMBER() OVER (PARTITION BY OrarioA, OrarioB ORDER BY IDOrario DESC) AS rn
  FROM table
  ) t
WHERE rn = 1 
```

，但这不会过滤掉结果集中的第一行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-16T21:28:45.123

根据您在屏幕截图中解释的数据，我理解为您需要按 OrarioA 和 OrarioB 分组的最高 IDOrario 的 id 字段？

```
SELECT IDDettaglioOrarioA, IDDettaglioOrarioB
FROM TABLE 
GROUP BY
OrarioA, OrarioB
ORDER BY IDOrario DESC 
```

如果您需要选择更多列，请随意选择更多。

# java - Java：从文本文件中读取尾随新行

> ID：554266
> 
> 赞同：6
> 
> 时间：2009-02-16T19:21:34.960
> 
> 标签：java, file-io

如何在保留文本文件末尾是否有换行符的同时获取文本文件的内容？使用这种技术，无法判断文件是否以换行符结尾：

```
BufferedReader reader = new BufferedReader(new FileReader(fromFile));
StringBuilder contents = new StringBuilder();

String line = null;
while ((line=reader.readLine()) != null) {
  contents.append(line);
  contents.append("\n");
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-16T19:27:05.477

不要使用 readLine(); 使用 read() 方法一次传输一个字符。如果您在 BufferedReader 上使用它，这将具有相同的性能，尽管与上面的代码不同，它不会“规范化”Windows 样式的 CR/LF 换行符。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-16T19:38:46.637

[您可以使用此处](https://stackoverflow.com/questions/326390/how-to-create-a-java-string-from-the-contents-of-a-file/326440)列出的技术之一阅读整个文件内容

我最喜欢的是这个：

```
public static long copyLarge(InputStream input, OutputStream output)
       throws IOException {
   byte[] buffer = new byte[DEFAULT_BUFFER_SIZE];
   long count = 0;
   int n = 0;
   while ((n = input.read(buffer))>=0) {
       output.write(buffer, 0, n);
       count += n;
   }
   return count; 
```

}

# sql - 每天一个新的 SQL 序列

> ID：554267
> 
> 赞同：1
> 
> 时间：2009-02-16T19:21:52.090
> 
> 标签：sql, date

在 SQL 数据库中每天创建一个新的序列号序列的好方法是什么？

类似于某些数据库系统中整数列的自动增量功能。

我正在创建/记录交易，交易由“日期，序列号”对标识。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-16T19:25:05.483

这取决于您拥有什么样的数据库。如果您可以访问全局变量或生成器，只需每天重置它并使用它来为您的序列号列播种。如果没有，您可以将值存储在一个表中并查找它以播种您的列，每天再次重置它。

如有必要，不要忘记手动增加种子。（生成器是一种特殊的全局变量，如果设置为可以自动递增。其他变量，当然还有表中的记录都不会。）

要重置该值，只需在插入时设置一个触发器，检查是否`COUNT(DATE = today)`为 0。如果是，请重置该值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T19:35:30.327

仅用于此目的的特定表怎么样？

```
create table AvailableSerialNumbers (
  AvailableOn datetime primarykey,
  NextAvailableNumber int
) 
```

您必须提前填充它，但这很简单（确保这是自动完成的，而不是手动完成的）。

请注意，如果同时创建大量序列号记录，则创建逻辑将成为更新 AvailbleSerialNumbers 记录的瓶颈。该问题的最简单解决方案是每天定义多个 AvailableSerialNumbers 记录（比如 100 个）并随机选择 1 个进行更新。如果使用这种方法而不是“NextAvailableNumber”字段，它应该是从/到范围。当范围达到 0 时，删除范围记录。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-16T19:24:24.220

最好的方法是使用日期作为数字的一部分，例如今天从 080216001 到 080216999。你可以有不连续的数字吗？

# objective-c - iPhone 使用带有异步 URL 请求的互斥锁

> ID：554270
> 
> 赞同：15
> 
> 时间：2009-02-16T19:22:32.773
> 
> 标签：objective-c, iphone, cocoa, multithreading, mutex

我的 iPhone 客户端大量参与异步请求，很多时候不断修改字典或数组的静态集合。因此，我经常看到较大的数据结构需要更长时间才能从服务器检索并出现以下错误：

```
*** Terminating app due to uncaught exception 'NSGenericException', reason: '*** Collection <NSCFArray: 0x3777c0> was mutated while being enumerated.' 
```

这通常意味着对服务器的两个请求会返回试图修改同一个集合的数据。我正在寻找的是关于如何正确构建我的代码以避免这种有害错误的教程/示例/理解。我确实相信正确的答案是互斥锁，但我还没有亲自使用过它们。

这是使用 NSURLConnection 发出异步 HTTP 请求，然后在请求完成后使用 NSNotification Center 作为委托方式的结果。当触发改变相同集合集的请求时，我们会遇到这些冲突。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-02-16T19:39:53.387

有几种方法可以做到这一点。在您的情况下，最简单的可能是使用 @synchronized 指令。这将允许您使用任意对象作为锁动态创建互斥锁。

```
@synchronized(sStaticData) {
  // Do something with sStaticData
} 
```

另一种方法是使用 NSLock 类。创建您要使用的锁，然后在获取互斥锁时您将有更多的灵活性（关于如果锁不可用时的阻塞等）。

```
NSLock *lock = [[NSLock alloc] init];
// ... later ...
[lock lock];
// Do something with shared data
[lock unlock];
// Much later
[lock release], lock = nil; 
```

如果您决定采用这些方法中的任何一种，则有必要为读取和写入获取锁，因为您使用 NSMutableArray/Set/whatever 作为数据存储。正如您所见，NSFastEnumeration 禁止对被枚举的对象进行突变。

但我认为这里的另一个问题是多线程环境中数据结构的选择。是否有必要从多个线程访问您的字典/数组？或者后台线程是否可以合并他们接收到的数据，然后将其传递给主线程，主线程将是唯一允许访问数据的线程？

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-16T19:43:34.673

如果有可能同时从两个线程访问任何数据（包括类），您必须采取措施保持这些同步。

幸运的是，Objective-C 使用 synchronized 关键字可以轻松地做到这一点。此关键字将任何 Objective-C 对象作为参数。在同步部分中指定相同对象的任何其他线程将暂停，直到第一个完成。

```
-(void) doSomethingWith:(NSArray*)someArray
 {    
    // the synchronized keyword prevents two threads ever using the same variable
    @synchronized(someArray)
    {
       // modify array
    }
 } 
```

如果您需要保护的不仅仅是一个变量，您应该考虑使用表示对该数据集的访问的信号量。

```
// Get the semaphore.
id groupSemaphore = [Group semaphore];

@synchronized(groupSemaphore) 
{
    // Critical group code.
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-25T16:07:22.303

为了响应 sStaticData 和 NSLock 的答案（评论限制为 600 个字符），您是否需要非常小心地以线程安全的方式创建 sStaticData 和 NSLock 对象（以避免出现多个锁的不太可能的情况由不同的线程创建）？

我认为有两种解决方法：

1）您可以要求在一天开始时在单个根线程中创建这些对象。

2) 定义一个在一天开始时自动创建的静态对象用作锁，例如可以内联创建静态 NSString：

```
static NSString *sMyLock1 = @"Lock1"; 
```

那么我认为你可以安全地使用

```
@synchronized(sMyLock1) 
{
  // Stuff
} 
```

否则，我认为您将始终以线程安全的方式创建锁而陷入“鸡和蛋”的境地？

当然，您不太可能遇到任何这些问题，因为大多数 iPhone 应用程序都在单线程中运行。

我不知道之前的 [Group semaphore] 建议，这也可能是一个解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-09-22T17:44:49.510

注意如果您使用同步，请不要忘记添加`-fobjc-exceptions`到您的 GCC 标志：

> Objective-C 提供了对线程同步和异常处理的支持，这在本文和“异常处理”中进行了解释。要打开对这些功能的支持，请使用 GNU 编译器集合 (GCC) 3.3 版及更高版本的 -fobjc-exceptions 开关。

[http://developer.apple.com/library/ios/#documentation/cocoa/Conceptual/ObjectiveC/Articles/ocThreading.html](http://developer.apple.com/library/ios/#documentation/cocoa/Conceptual/ObjectiveC/Articles/ocThreading.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-10-19T11:28:01.280

使用对象的副本来修改它。由于您正在尝试修改数组（集合）的引用，而其他人也可能会修改它（多次访问），因此创建副本对您有用。创建一个副本，然后枚举该副本。

```
NSMutableArray *originalArray = @[@"A", @"B", @"C"];
NSMutableArray *arrayToEnumerate = [originalArray copy]; 
```

现在修改arrayToEnumerate。由于它没有引用 originalArray，而是 originalArray 的副本，因此不会引起问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-06-09T06:53:55.737

如果您不想要 Locking 的开销，还有其他方法，因为它有成本。您可以创建一个队列来序列化访问您的关键部分代码的任务，而不是使用锁来保护共享资源（在您的情况下它可能是字典或数组）。队列不会像锁那样受到相同数量的惩罚，因为它不需要陷入内核来获取互斥锁。简单的说

```
 dispatch_async(serial_queue, ^{
    <#critical code#>
}) 
```

如果您希望当前执行等到任务完成，您可以使用

```
dispatch_sync(serial_queue Or concurrent, ^{
    <#critical code#>
}) 
```

一般来说，如果执行不需要等待，异步是首选的方式。

# javascript - 使用 jQuery 更改图像源

> ID：554273
> 
> 赞同：854
> 
> 时间：2009-02-16T19:23:59.027
> 
> 标签：javascript, jquery, image

我的 DOM 看起来像这样：

```
<div id="d1">
   <div class="c1">
            <a href="#"><img src="img1_on.gif"></a>
            <a href="#"><img src="img2_on.gif"></a>
   </div>
</div> 
```

当有人点击图像时，我希望图像 src 更改为代表图像编号 1 或 2 的`<img src="imgx_off.gif">`位置。`x`

这是可能的还是我必须使用 CSS 来更改图像？

* * *

## 回答 #1

> 赞同：1816
> 
> 时间：2009-02-16T19:27:48.113

您可以使用 jQuery 的[attr()](http://api.jquery.com/attr/)函数。例如，如果您的`img`标签具有`id`“my_image”属性，您可以这样做：

```
<img id="my_image" src="first.jpg"/> 
```

然后你可以`src`像这样用 jQuery 改变你的图像：

```
$("#my_image").attr("src","second.jpg"); 
```

要将其附加到`click`事件中，您可以编写：

```
$('#my_image').on({
    'click': function(){
        $('#my_image').attr('src','second.jpg');
    }
}); 
```

要旋转图像，您可以这样做：

```
$('img').on({
    'click': function() {
         var src = ($(this).attr('src') === 'img1_on.jpg')
            ? 'img2_on.jpg'
            : 'img1_on.jpg';
         $(this).attr('src', src);
    }
}); 
```

* * *

## 回答 #2

> 赞同：89
> 
> 时间：2012-03-22T16:35:49.650

人们在更改图像源时常犯的错误之一是没有等待图像加载来执行诸如成熟图像大小等后续操作。您将需要使用 jQuery`.load()`方法在图像加载后执行操作。

```
$('yourimageselector').attr('src', 'newsrc').load(function(){
    this.width;   // Note: $(this).width() will not work for in memory images

}); 
```

编辑原因：[https ://stackoverflow.com/a/670433/561545](https://stackoverflow.com/a/670433/561545)

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2020-01-16T20:05:43.503

> 如果您多次更新图像并且它被**缓存**并且没有更新，请在末尾添加一个随机字符串：

```
// update image in dom
$('#target').attr('src', 'https://example.com/img.jpg?rand=' + Math.random()); 
```

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2016-07-20T10:01:23.297

了解更多信息。我尝试使用以下语法在 jquery 中使用 attr 方法为广告图像设置 src 属性，例如：`$("#myid").attr('src', '/images/sample.gif');`

此解决方案很有用并且有效，但如果更改路径也会更改图像路径并且无法正常工作。

我一直在寻找解决此问题的方法，但一无所获。

解决方案是将“\”放在路径的开头： `$("#myid").attr('src', '\images/sample.gif');`

这个技巧对我非常有用，我希望它对其他人有用。

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2011-09-13T21:44:03.413

如果不仅有 jQuery 或其他资源杀戮框架 - 每个用户每次下载许多 kb 只是为了一个简单的技巧 - 还有原生 JavaScript（！）：

```
<img src="img1_on.jpg" 
    onclick="this.src=this.src.match(/_on/)?'img1_off.jpg':'img1_on.jpg';">
<img src="img2_on.jpg" 
    onclick="this.src=this.src.match(/_on/)?'img2_off.jpg':'img2_on.jpg';"> 
```

这可以写得更笼统，更优雅：

```
<html>
<head>
<script>
function switchImg(img){
    img.src = img.src.match(/_on/) ? 
        img.src.replace(/_on/, "_off") : 
        img.src.replace(/_off/, "_on");
}
</script>
</head>
<body>
    <img src="img1_on.jpg" onclick="switchImg(this)">
    <img src="img2_on.jpg" onclick="switchImg(this)">
</body>
</html> 
```

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2010-09-11T23:27:19.577

我将向您展示如何更改图像`src`，以便当您单击图像时，它会旋转浏览 HTML 中的所有图像（特别是在您的`d1`id 和`c1`类中）......无论您的 HTML 中有 2 个**或更多图像**.

我还将向您展示如何在文档准备好后清理页面，以便最初只显示一张图像。

**完整代码**

```
$(function() {

    var $images = $("#d1 > .c1 > a").clone();  

    var $length = $images.length;
    var $imgShow = 0;

    $("#d1 > .c1").html( $("#d1 > .c1 > a:first") );  

    $("#d1 > .c1 > a").click(function(event) { 

        $(this).children().attr("src", 
                        $("img", $images).eq(++$imgShow % $length).attr("src") );
        event.preventDefault();

    });
}); 
```

**击穿**

1.  创建包含图像的链接的副本（注意：您还可以使用链接的 href 属性来添加功能......例如**[在每个图像下方显示工作链接](http://jsfiddle.net/NHASn/)**）：

    ```
     var $images = $("#d1 > .c1 > a").clone();  ; 
    ```

2.  检查 HTML 中有多少图像并创建一个变量来跟踪正在显示的图像：

    ```
    var $length = $images.length;
    var $imgShow = 0; 
    ```

3.  修改文档的 HTML，以便**只**显示第一个图像。删除所有其他图像。

    ```
    $("#d1 > .c1").html( $("#d1 > .c1 > a:first") ); 
    ```

4.  点击图片链接时绑定一个函数来处理。

    ```
     $("#d1 > .c1 > a").click(function(event) { 
            $(this).children().attr("src", $("img", $images).eq(++$imgShow % $length).attr("src") );
            event.preventDefault();
        }); 
    ```

    上面代码的核心是`++$imgShow % $length`循环遍历包含图像的 jQuery 对象。`++$imgShow % $length`首先将我们的计数器加一，然后根据图像的数量修改该数字。这将使生成的索引从`0`到循环`length-1`，这是`$images`对象的索引。这意味着此代码将适用于 2、3、5、10 或 100 张图像......按顺序循环浏览每个图像，并在到达最后一张图像时从第一张图像重新开始。

    此外，**[`.attr()`](http://api.jquery.com/attr/)**用于获取和设置图像的“src”属性。为了从`$images`对象中挑选元素，我使用 form设置`$images`为**[jQuery 上下文](http://api.jquery.com/jQuery/)**`$(selector, context)`。然后我**[`.eq()`](http://api.jquery.com/eq/)**只用我感兴趣的特定索引来选择元素。

* * *

## **[带有 3 张图片的 jsFiddle 示例](http://jsfiddle.net/YXXHy/)**

您还可以将`src`s 存储在数组中。
**[带有 3 张图片的 jsFiddle 示例](http://jsfiddle.net/wjapW/)**

以下是如何在图像周围合并来自锚标记的href：
**[jsFiddle示例](http://jsfiddle.net/ZRTDS/)**

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2018-05-21T12:45:54.783

希望这可以工作

```
<img id="dummyimage" src="http://dummyimage.com/450x255/" alt="" />
<button id="changeSize">Change Size</button> 
```

```
$(document).ready(function() {
    var flag = 0;
    $("button#changeSize").click(function() {
        if (flag == 0) {
            $("#dummyimage").attr("src", "http://dummyimage.com/250x155/");
            flag = 1;
        } else if (flag == 1) {
            $("#dummyimage").attr("src", "http://dummyimage.com/450x255/");
            flag = 0;
        }
    });
}); 
```

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2019-04-28T11:17:20.170

您应该将 id 属性添加到您的图像标签，如下所示：

```
<div id="d1">
   <div class="c1">
            <a href="#"><img id="img1" src="img1_on.gif"></a>
            <a href="#"><img id="img2" src="img2_on.gif"></a>
   </div>
</div> 
```

那么您可以使用此代码更改图像的来源：

```
 $(document).ready(function () {
        $("#img1").attr({ "src": "logo-ex-7.png" });
        $("#img2").attr({ "src": "logo-ex-8.png" });
    }); 
```

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2010-09-28T00:44:59.853

你也可以用 jQuery 这样做：

```
$(".c1 img").click(function(){
     $(this).attr('src','/new/image/src.jpg');   
}); 
```

如果图像源有多个状态，您可以有一个条件。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2017-07-24T12:57:15.970

尝试调用重新验证码按钮时我遇到了同样的问题。经过一番搜索，现在以下功能在几乎所有著名的浏览器（chrome、Firefox、IE、Edge、...）中都可以正常工作：

```
function recaptcha(theUrl) {
  $.get(theUrl, function(data, status){});
  $("#captcha-img").attr('src', "");
  setTimeout(function(){
       $("#captcha-img").attr('src', "captcha?"+new Date().getTime());
  }, 0);
 } 
```

'theUrl' 用于渲染新的验证码图像，在您的情况下可以忽略。最重要的一点是生成新的 URL，它会强制 FF 和 IE 重新渲染图像。

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2019-04-04T13:59:58.067

使用 jQuery 更改图像源`click()`

元素：

```
 <img class="letstalk btn"  src="images/chatbuble.png" /> 
```

代码：

```
 $(".letstalk").click(function(){
        var newsrc;
        if($(this).attr("src")=="/images/chatbuble.png")
        {
            newsrc="/images/closechat.png";
            $(this).attr("src", newsrc);
        }
        else
        {
            newsrc="/images/chatbuble.png";
            $(this).attr("src", newsrc);
        }
    }); 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2020-12-30T15:46:14.483

我在这里制作了一个具有此功能的代码笔。我也会在这里给你一个代码的细分。

[密码笔](https://codepen.io/Neil_Meyer_ZA/pen/PoGQGRa)

```
$(function() {

  //Listen for a click on the girl button
  $('#girl-btn').click(function() {

    // When the girl button has been clicked, change the source of the #square image to be the girl PNG
    $('#square').prop("src", "https://homepages.cae.wisc.edu/~ece533/images/girl.png");
  });

  //Listen for a click on the plane button
  $('#plane-btn').click(function() {

    // When the plane button has been clicked, change the source of the #square image to be the plane PNG
    $('#square').prop("src", "https://homepages.cae.wisc.edu/~ece533/images/airplane.png");
  });

  //Listen for a click on the fruit button
  $('#fruits-btn').click(function() {

    // When the fruits button has been clicked, change the source of the #square image to be the fruits PNG
    $('#square').prop("src", "https://homepages.cae.wisc.edu/~ece533/images/fruits.png");
  });
});
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<img src="https://homepages.cae.wisc.edu/~ece533/images/girl.png" id="square" />
<div>
  <button id="girl-btn">Girl</button>
  <button id="plane-btn">Plane</button>
  <button id="fruits-btn">Fruits</button>

  <a href="https://homepages.cae.wisc.edu/~ece533/images/">Source of Images</a>
</div>
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2018-11-13T10:46:38.650

这是在 Vanilla（或简单的纯）JavaScript 中完成它的保证方法：

```
var picurl = 'pictures/apple.png';
document.getElementById("image_id").src=picurl; 
```

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2016-04-04T17:48:10.047

我今天也有同样的疑惑，我就是这样做的：

```
//<img src="actual.png" alt="myImage" class=myClass>
$('.myClass').attr('src','').promise().done(function() {
$(this).attr('src','img/new.png');  
}); 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2018-10-27T16:53:00.287

只是一个补充，使它更小：

```
$('#imgId').click(function(){
    $(this).attr("src",$(this).attr('src') == 'img1_on.gif' ? 'img1_off.gif':'img1_on.gif');
}); 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2020-06-14T22:00:43.120

# 简短但准确

```
$("#d1 img").click(e=> e.target.src= pic[e.target.src.match(pic[0]) ? 1:0] ); 
```

```
let pic=[
  "https://picsum.photos/id/237/40/40", // arbitrary - eg: "img1_on.gif",
  "https://picsum.photos/id/238/40/40", // arbitrary - eg: "img2_on.gif"
];

$("#d1 img").click(e=> e.target.src= pic[e.target.src.match(pic[0]) ? 1:0] );
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<div id="d1">
   <div class="c1">
            <a href="#"><img src="img1_on.gif"></a>
            <a href="#"><img src="img2_on.gif"></a>
   </div>
</div>
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2016-04-08T05:55:12.667

无法使用 CSS 更改图像源。

唯一可能的方法是使用[Javascript](https://developer.mozilla.org/en-US/docs/Web/JavaScript)或任何[Javascript](https://developer.mozilla.org/en-US/docs/Web/JavaScript)库，如[jQuery](https://jquery.com/)。

## 逻辑-

图像在 div 内，并且没有`class`或`id`带有该图像。

因此逻辑将选择`div`图像所在位置内的元素。

然后使用循环选择所有图像元素并使用[Javascript](https://developer.mozilla.org/en-US/docs/Web/JavaScript) / [jQuery](https://jquery.com/)更改图像 src 。

## 带有演示输出的示例代码 -

```
$(document).ready(function()
{
    $("button").click(function()
    {
      $("#d1 .c1 a").each(function()
      {
          $(this).children('img').attr('src', 'https://www.gravatar.com/avatar/e56672acdbce5d9eda58a178ade59ffe');
      });
    });
});
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>

<div id="d1">
   <div class="c1">
            <a href="#"><img src="img1_on.gif"></a>
            <a href="#"><img src="img2_on.gif"></a>
   </div>
</div>

<button>Change The Images</button>
```

# c# - 用 .NET 编写的服务可以自行终止吗？

> ID：554276
> 
> 赞同：21
> 
> 时间：2009-02-16T19:24:29.180
> 
> 标签：c#, windows-services

我有一个用 C# 编写的服务应用程序，在某些情况下，我希望它自行终止。这将在服务运行一段时间后发生，因此在 OnStart() 事件中不会发生这种情况。

到目前为止，我所阅读的所有内容都表明，终止服务的唯一安全方法是通过服务控制管理器。我的服务作为本地服务运行，并且没有启动或停止服务的权限，因此我无法从服务本身访问 SCM。是否有另一种方法可以在仍然按照 SCM 规则玩的同时自行终止？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-02-16T19:28:25.007

试试[`ServiceBase.Stop()`](http://msdn.microsoft.com/en-us/library/system.serviceprocess.servicebase.stop.aspx)。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2010-07-15T11:51:08.950

如果你想终止服务而不是停止它（可能是因为服务已经捕获了一个未处理的异常），你可以使用`Environment.Exit(1)`（如果你愿意，可以使用另一个退出代码）。

Windows 将发现该服务已意外终止。如果服务已配置为恢复，则将使用恢复过程，其中包括重新启动服务、运行程序或重新启动计算机的选项。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-16T19:28:30.920

如果你只是让所有正在执行的线程完成会发生什么？我可以想象三种可能的结果：

*   SCM 通知，并决定您正确完成
*   SCM 注意到，认为你死了，然后重启你
*   SCM 没有注意到，并显示您仍在运行

编辑：我怀疑[这个答案](http://msdn.microsoft.com/en-us/library/system.serviceprocess.servicebase.stop.aspx)确实是最好的答案，但为了感兴趣，我会（暂时）留下这个答案。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-02-16T19:28:41.370

不要让服务在本地服务下运行。让它在有权停止服务的用户下运行。

尽管自我终止服务的想法并不是最好的想法。仅这一事实就意味着它应该是一个应用程序，而不是一个服务。

# c# - 如何在 ASP.NET MVC 中浏览服务器上的文件？

> ID：554302
> 
> 赞同：2
> 
> 时间：2009-02-16T19:31:09.790
> 
> 标签：c#, asp.net-mvc

我对 ASP.NET MVC 很陌生，但更重要的是，我对 Web 开发也很陌生。我想做的很简单。我的 MVC 项目中有一个名为 /Content/Images 的文件夹，其中有一些图像。我想让我的控制器抓取这个文件夹中的所有图像，并将它们发送到视图。然后视图将在 div 中呈现这些图像，并在它们的点击事件中向它们添加一个 Javascript 函数。所以，我的问题基本上是，你如何在 ASP.NET MVC 中浏览服务器上的文件。

如果我一起以错误的方式解决这个问题，也请告诉我。这里的主要目标是在页面的一部分上有一个小的可滚动区域，其中包含特定文件夹中的所有图片，并且所有图像都应该有一个 onclick，它调用一个传入图像名称的 javascript 函数。希望这是有道理的！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-16T19:40:59.827

您可以使用 DirectoryInfo 获取图像目录中所有文件的列表

```
DirectoryInfo folder = new DirectoryInfo(Server.MapPath("/content/images"));
foreach(FileInfo file in folder.Files)
    // find all your files here 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-05-23T12:54:12.187

以我的经验 DirectoryInfo.Files 不起作用，而是我使用 DirectoryInfo.GetFiles() （但是 .Files 方法可能是以前的 ASP 版本？）

```
DirectoryInfo folder = new DirectoryInfo(Server.MapPath("~/resources/uploads"));
foreach (FileInfo file in folder.GetFiles())
{
// find all your files here
} 
```

# scripting - spawn 和 exec 有什么区别？

> ID：554304
> 
> 赞同：22
> 
> 时间：2009-02-16T19:31:29.837
> 
> 标签：scripting, exec, tcl, expect, spawn

我正在学习编写 TCL（预期）脚本，我注意到一些示例显示使用 spawn，而其他示例显示命令 exec。我尝试谷歌搜索，但找不到有什么区别？

假设我在一个很长的期望脚本中间调用 'exec'，我会发生什么？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-16T19:50:52.143

`spawn`是`expect`命令不是`tcl`命令。`exec`是一个`tcl`命令。

`spawn`创建一个过程。进程的输入和输出连接到 expect 以供其他 expect 命令使用`send`：`expect`和`interact`.

`exec`在 tcl 下创建一个子进程。通常，tcl 会暂停，直到子进程完成。但是，**可以**在后台创建子进程（使用 & 作为最后一个参数），如果正确连接输入和输出，tcl 可以与子进程交互。这是非常笨拙的，并且正是期望旨在顺利处理的那种交互。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-03-01T05:58:17.967

回答这个问题的一个更简单的方法是改写它以询问何时应该使用 exec 与 spawn。简而言之，将 spawn 用于交互式命令，将 exec 用于非交互式命令。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-13T14:33:09.633

还值得注意的是，一些（很多？）程序在由用户（即在命令行）运行时与作为批处理过程的一部分/从另一个进程运行时表现不同。实际的区别在于进程是否附加了终端。

spawn 命令是 Tcl 的 Expect 扩展的一部分，它进行设置，使执行的程序将自己视为由用户运行，然后添加功能以允许 tcl 程序以方便的方式与外部程序交互（即匹配它通过正则表达式输出并分支这些匹配项）。通过 spawn 运行的东西是异步运行的。

exec 命令是运行其他程序并返回其输出的核心 Tcl 命令。它不会像 spawn 那样做任何复杂的设置，但是对于运行一个程序并查看它的输出（以及它的返回码）来说非常方便。默认情况下，由 exec 运行的东西是同步运行的，但是命令末尾的 & 号会导致它在后台运行（很像传统的 shell 脚本）。

open 命令虽然通常用于读/写文件，但也可用于运行外部进程。通过在命令名称前加上管道 (|) 符号，您可以告诉它运行外部进程，并获得对读/写文件描述符的访问权限以与生成的进程进行交互。这是 exec 和 spawn 之间的一种中间立场，与可用的进程有更多的交互，但没有 spawn 所做的复杂环境设置。它可以非常方便地与需要输入但仍然可以很好地设置自动化的程序进行交互。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-16T19:40:03.730

据我所知，spawn 返回一个进程 ID（并与 Expect 链接），而 exec 只返回最终的标准输出，除非你通过“&”。所以它不会影响你的期望。

# c# - 如何将整数转换为其口头表示？

> ID：554314
> 
> 赞同：58
> 
> 时间：2009-02-16T19:35:35.787
> 
> 标签：c#, .net, .net-3.5

是否有一个库或类/函数可用于将整数转换为它的口头表示？

示例输入：

> 4,567,788`

示例输出：

> 四百万，五十六万七千，七百八十八

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2014-06-03T14:03:53.457

目前最好、最强大的库绝对是[Humanizer](https://github.com/MehdiK/Humanizer)。它是开源的，可作为 nuget 使用：

```
Console.WriteLine(4567788.ToWords()); // => four million five hundred and sixty-seven thousand seven hundred and eighty-eight 
```

它还具有广泛的工具来解决每个应用程序与`string`s、`enum`s、`DateTime`s、`TimeSpan`s 等有关的小问题，并支持许多不同的语言。

```
Console.WriteLine(4567788.ToOrdinalWords().Underscore().Hyphenate().ApplyCase(LetterCasing.AllCaps)); // => FOUR-MILLION-FIVE-HUNDRED-AND-SIXTY-SEVEN-THOUSAND-SEVEN-HUNDRED-AND-EIGHTY-EIGHTH 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2011-10-19T23:40:55.580

如果您使用以下代码中的代码： [将数字转换为单词 C#](https://stackoverflow.com/questions/2729752/converting-numbers-in-to-words-c-sharp) ，并且您需要将它用于十进制数字，请执行以下操作：

```
public string DecimalToWords(decimal number)
{
    if (number == 0)
        return "zero";

    if (number < 0)
        return "minus " + DecimalToWords(Math.Abs(number));

    string words = "";

    int intPortion = (int)number;
    decimal fraction = (number - intPortion)*100;
    int decPortion = (int)fraction;

    words = NumericToWords(intPortion);
    if (decPortion > 0)
    {
        words += " and ";
        words += NumericToWords(decPortion);
    }
    return words;
} 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2013-11-26T17:46:04.343

完全递归版本：

```
private static string[] ones = {
    "zero", "one", "two", "three", "four", "five", "six", "seven", "eight", "nine", 
    "ten", "eleven", "twelve", "thirteen", "fourteen", "fifteen", "sixteen", "seventeen", "eighteen", "nineteen",
};

private static string[] tens = { "zero", "ten", "twenty", "thirty", "forty", "fifty", "sixty", "seventy", "eighty", "ninety" };

private static string[] thous = { "hundred", "thousand", "million", "billion", "trillion", "quadrillion" };

private static string fmt_negative = "negative {0}";
private static string fmt_dollars_and_cents = "{0} dollars and {1} cents";
private static string fmt_tens_ones = "{0}-{1}"; // e.g. for twenty-one, thirty-two etc. You might want to use an en-dash or em-dash instead of a hyphen.
private static string fmt_large_small = "{0} {1}"; // stitches together the large and small part of a number, like "{three thousand} {five hundred forty two}"
private static string fmt_amount_scale = "{0} {1}"; // adds the scale to the number, e.g. "{three} {million}";

public static string ToWords(decimal number) {
    if (number < 0)
        return string.format(fmt_negative, ToWords(Math.Abs(number)));

    int intPortion = (int)number;
    int decPortion = (int)((number - intPortion) * (decimal) 100);

    return string.Format(fmt_dollars_and_cents, ToWords(intPortion), ToWords(decPortion));
}

private static string ToWords(int number, string appendScale = "") {
    string numString = "";
    // if the number is less than one hundred, then we're mostly just pulling out constants from the ones and tens dictionaries
    if (number < 100) {
        if (number < 20)
            numString = ones[number];
        else {
            numString = tens[number / 10];
            if ((number % 10) > 0)
                numString = string.Format(fmt_tens_ones, numString, ones[number % 10]);
        }
    } else {
        int pow = 0; // we'll divide the number by pow to figure out the next chunk
        string powStr = ""; // powStr will be the scale that we append to the string e.g. "hundred", "thousand", etc.

        if (number < 1000) { // number is between 100 and 1000
            pow = 100; // so we'll be dividing by one hundred
            powStr = thous[0]; // and appending the string "hundred"
        } else { // find the scale of the number
            // log will be 1, 2, 3 for 1_000, 1_000_000, 1_000_000_000, etc.
            int log = (int)Math.Log(number, 1000);
            // pow will be 1_000, 1_000_000, 1_000_000_000 etc.
            pow = (int)Math.Pow(1000, log);
            // powStr will be thousand, million, billion etc.
            powStr = thous[log];
        }

        // we take the quotient and the remainder after dividing by pow, and call ToWords on each to handle cases like "{five thousand} {thirty two}" (curly brackets added for emphasis)
        numString = string.Format(fmt_large_small, ToWords(number / pow, powStr), ToWords(number % pow)).Trim();
    }

    // and after all of this, if we were passed in a scale from above, we append it to the current number "{five} {thousand}"
    return string.Format(fmt_amount_scale, numString, appendScale).Trim();
} 
```

电流可达（短规模）千万亿。可以通过更改变量简单地添加额外的支持（对于更大的数字，或者对于[长比例）。](http://en.wikipedia.org/wiki/Long_and_short_scales)`thous`

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2014-08-08T05:38:13.417

如果有人想要 JavaScript 版本

```
Number.prototype.numberToWords = function () {
    var unitsMap = ["zero", "one", "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten", "eleven", "twelve", "thirteen", "fourteen", "fifteen", "sixteen", "seventeen", "eighteen", "nineteen"];
    var tensMap = ["zero", "ten", "twenty", "thirty", "forty", "fifty", "sixty", "seventy", "eighty", "ninety"];

    var num = this.valueOf();
    if (Math.round(num == 0)) {
        return "zero";
    }
    if (num < 0) {
        var positivenum = Math.abs(num);
        return "minus " + Number(positivenum).numberToWords();
    }
    var words = "";
    if (Math.floor(num / 1000000) > 0) {
        words += Math.floor(num / 1000000).numberToWords() + " million ";
        num = Math.floor(num % 1000000);
    }
    if (Math.floor(num / 1000) > 0) {
        words += Math.floor(num / 1000).numberToWords() + " thousand ";
        num = Math.floor(num % 1000);
    }
    if (Math.floor(num / 100) > 0) {
        words += Math.floor(num / 100).numberToWords() + " hundred ";
        num = Math.floor(num % 100);
    }
    if (Math.floor(num > 0)) {
        if (words != "") {
            words += "and ";
        }
        if (num < 20) {
        words += unitsMap[num];
        }
        else {
            words += tensMap[Math.floor(num / 10)];
            if ((num % 10) > 0) {
                words += "-" + unitsMap[Math.round(num % 10)];
            }
        }
    }
    return words.trim();
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2017-06-01T15:12:41.910

> 这是西班牙语版本：

```
 public static string numeroALetras(int number)
    {
        if (number == 0)
            return "cero";

        if (number < 0)
            return "menos " + numeroALetras(Math.Abs(number));

        string words = "";

        if ((number / 1000000) > 0)
        {
            words += numeroALetras(number / 1000000) + " millón ";
            number %= 1000000;
        }

        if ((number / 1000) > 0)
        {
            words += (number / 1000) == 1? "mil ": numeroALetras(number / 1000) + " mil ";
            number %= 1000;
        }
        if ((number / 100) == 1)
        {
            if (number == 100)
                words += "cien";
            else words += (number / 100)> 1? numeroALetras(number / 100) + " ciento ":"ciento ";
            number %= 100;
        }
        if ((number / 100) > 1)
        {
            var hundredMap = new[] {"","", "dosc", "tresc", "cuatroc", "quin", "seisc", "sietec", "ochoc", "novec" };
            if (number > 199)
                words += hundredMap[number/100] + "ientos ";
            else {
                words += numeroALetras(number / 100) + " ientos ";
            }
            number %= 100;
        }

        if (number > 0)
        {
            if (words != "")
                words += " ";

            var unitsMap = new[] { "cero", "uno", "dos", "tres", "cuatro", "cinco", "seis", "siete", "ocho", "nueve", "diez", "once", "doce", "trece", "catorce", "quince", "dieciseis", "diecisiete", "dieciocho", "diecinueve", "veinte" };
            var tensMap = new[] { "cero", "diez", "veinti", "treinta", "cuarenta", "cincuenta", "sesenta", "setenta", "ochenta", "noventa" };

            if (number < 21)
                words += unitsMap[number];
            else
            {                    
                words += tensMap[number / 10];
                if ((number % 10) > 0)
                    words += ((number % 10)>2?" y ": "") + unitsMap[number % 10];                    
            }
        }

        return words;
    } 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-09-24T06:16:44.150

```
Imports System.Text

Public Class NumberWriter

    Public Shared Function Parse(ByVal Number As String) As String
        If Not AreNumbers(Number) Then Return ""
        Dim TempQueue As New Queue(Of String)
        For Each ItemA As Char In Number.Replace(",", "").Reverse
            TempQueue.Enqueue(ItemA)
        Next
        Dim Blocks As New List(Of String)
        Dim BlockEmpty As New List(Of Boolean)
        Do
            Dim TempBlock As New StringBuilder(3)
            TempBlock.Append(TempQueue.Dequeue)
            If TempQueue.Count > 0 Then
                TempBlock.Append(TempQueue.Dequeue)
                If TempQueue.Count > 0 Then
                    TempBlock.Append(TempQueue.Dequeue)
                End If
            End If
            Blocks.Add(StrReverse(TempBlock.ToString))
            BlockEmpty.Add(TempBlock.ToString = "000")
            If TempQueue.Count < 1 Then Exit Do
        Loop
        Dim ResultStack As New Stack(Of String)
        For int1 As Integer = 0 To Blocks.Count - 1
            ResultStack.Push(ReadBlock(Blocks(int1)) & If(Not int1 = 0, If(Not BlockEmpty(int1), " " & CapitalizeWord(GetPlaceValueSet(int1)) & If(BlockEmpty(int1 - 1), "", ", "), ""), ""))
        Next
        Dim Result1 As String = ""
        Do Until ResultStack.Count < 1
            Result1 &= ResultStack.Pop
        Loop
        Return RemoveGrammarErrors(Result1)
    End Function

    Private Shared Function RemoveGrammarErrors(ByVal Str As String) As String
        Dim tstr As String = Str
        tstr.Replace("  ", " ")
        tstr.Replace(" , ", ", ")
        Return tstr
    End Function

    Private Shared Function AreNumbers(ByVal Str1 As String) As Boolean
        Dim Numbers() As String = {"0", "1", "2", "3", "4", "5", "6", "7", "8", "9", ","}
        For Each ItemA As Char In Str1
            Dim IsN As Boolean = False
            For Each ItemB As String In Numbers
                If ItemA = ItemB Then IsN = True
            Next
            If Not IsN Then
                Return False
            End If
        Next
        Return True
    End Function

    Private Shared Function ReadBlock(ByVal Block As String)
        Select Case Block.Length
            Case 1
                Return ReadSingleDigit(Block)
            Case 2
                Return ReadTwoDigits(Block)
            Case 3
                Return ReadThreeDigits(Block)
            Case Else
                Throw New Exception
        End Select
    End Function

    Private Shared Function ReadThreeDigits(ByVal Digits As String)
        If Digits.Length > 3 Then Throw New ArgumentException("There are too many digits.")
        Dim Result As String = ""
        If Not Digits(0) = "0" Then
            Result &= ReadSingleDigit(Digits(0)) & " Hundred "
        End If
        Result &= ReadTwoDigits(Digits.Substring(1))
        Return Result
    End Function

    Private Shared Function ReadTwoDigits(ByVal Digits As String)
        If Digits.Length > 2 Then Throw New ArgumentException("There are too many digits.")
        Select Case Digits(0)
            Case "0"
                Return ReadSingleDigit(Digits(1))
            Case "1"
                Return ReadTeenNumber(Digits)
            Case Else
                Return ReadFirstInNumberPair(Digits(0)) & If(Digits(1) = "0", "", "-" & ReadSingleDigit(Digits(1)))
        End Select
    End Function

    Private Shared Function ReadSingleDigit(ByVal Digit As String) As String
        If Not Digit.Length = 1 Then Throw New ArgumentException("There must be only one digit and it must be more than zero.")
        Select Case Digit
            Case "0"
                Return ""
            Case "1"
                Return "One"
            Case "2"
                Return "Two"
            Case "3"
                Return "Three"
            Case "4"
                Return "Four"
            Case "5"
                Return "Five"
            Case "6"
                Return "Six"
            Case "7"
                Return "Seven"
            Case "8"
                Return "Eight"
            Case "9"
                Return "Nine"
            Case Else
                Throw New Exception()
        End Select
    End Function

    Private Shared Function ReadTeenNumber(ByVal Num As String) As String
        Select Case Num
            Case "11"
                Return "Eleven"
            Case "12"
                Return "Twelve"
            Case "13"
                Return "Thirteen"
            Case "14"
                Return "Fourteen"
            Case "15"
                Return "Fifteen"
            Case "16"
                Return "Sixteen"
            Case "17"
                Return "Seventeen"
            Case "18"
                Return "Eighteen"
            Case "19"
                Return "Nineteen"
            Case Else
                Throw New Exception()
        End Select
    End Function

    Private Shared Function ReadFirstInNumberPair(ByVal Num As String) As String
        If Not (Num > 1 OrElse Num < 10) Then Throw New ArgumentException("Number must be more than 1 and less than 10")
        Select Case Num
            Case "2"
                Return "Twenty"
            Case "3"
                Return "Thirty"
            Case "4"
                Return "Fourty"
            Case "5"
                Return "Fifty"
            Case "6"
                Return "Sixty"
            Case "7"
                Return "Seventy"
            Case "8"
                Return "Eighty"
            Case "9"
                Return "Ninety"
            Case Else
                Throw New Exception()
        End Select
    End Function

    Private Shared Function CapitalizeWord(ByVal Word As String) As String
        Return Word.Substring(0, 1).ToUpper & Word.Substring(1)
    End Function

    Private Shared Function GetPlaceValueSet(ByVal Num As Byte) As String
        Select Case Num
            Case 0
                Return "" 'Hundreds
            Case 1
                Return "Thousand"
            Case 2
                Return "Million"
            Case 3
                Return "Billion"
            Case 4
                Return "Trillion"
            Case 5
                Return "Quadrillion"
            Case 6
                Return "Quintillion"
            Case 7
                Return "Sextillion"
            Case 8
                Return "Septillion"
            Case 9
                Return "Octillion"
            Case 10
                Return "Nonillion"
            Case 11
                Return "octillion"
            Case 12
                Return "nonillion"
            Case 13
                Return "decillion"
            Case 14
                Return "undecillion"
            Case 15
                Return "dodecillion,"
            Case 16
                Return "tredecillion"
            Case 17
                Return "quattuordecillion"
            Case 18
                Return "quindecillion"
            Case 19
                Return "sexdecillion"
            Case 20
                Return "septendecillion"
            Case 21
                Return "octodecillion"
            Case 22
                Return "novemdecillion"
            Case 23
                Return "vigintillion"
            Case 24
                Return "unvigintillion"
            Case 25
                Return "dovigintillion"
            Case 26
                Return "trevigintillion"
            Case 27
                Return "quattuorvigintillion"
            Case 28
                Return "quinvigintillion"
            Case 29
                Return "sexvigintillion"
            Case 30
                Return "septenvigintillion"
            Case 31
                Return "octovigintillion"
            Case 32
                Return "novemvigintillion"
            Case 33
                Return "trigintillion"
            Case 34
                Return "untrigintillion"
            Case 35
                Return "dotrigintillion"
            Case 36
                Return "tretrigintillion"
            Case 37
                Return "quattuortrigintillion"
            Case 38
                Return "quintrigintillion"
            Case 39
                Return "sextrigintillion"
            Case 40
                Return "septentrigintillion"
            Case 41
                Return "octotrigintillion"
            Case Else
                Throw New Exception
        End Select
    End Function
End Class 
```

抱歉，它在 VB.NET 中，但它完全可以工作。这是一种方式。数字到口头。我相信可以处理长达 123 个字符的数字。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-07-18T17:11:55.010

[http://www.exchangecore.com/blog/convert-number-words-c-sharp-console-application/](http://www.exchangecore.com/blog/convert-number-words-c-sharp-console-application/)有一些 C# 脚本，看起来可以处理非常大的数字和非常小的小数。

```
using System;
using System.Collections.Generic;
using System.Text;

namespace NumWords
{
    class Program
    {
        // PROGRAM HANDLES NEGATIVE AND POSITIVE DOUBLES

        static String NumWordsWrapper(double n)
        {
            string words = "";
            double intPart;
            double decPart = 0;
            if (n == 0)
                return "zero";
            try {
                string[] splitter = n.ToString().Split('.');
                intPart = double.Parse(splitter[0]);
                decPart = double.Parse(splitter[1]);
            } catch {
                intPart = n;
            }

            words = NumWords(intPart);

            if (decPart > 0) {
                if (words != "")
                    words += " and ";
                int counter = decPart.ToString().Length;
                switch (counter) {
                    case 1: words += NumWords(decPart) + " tenths"; break;
                    case 2: words += NumWords(decPart) + " hundredths"; break;
                    case 3: words += NumWords(decPart) + " thousandths"; break;
                    case 4: words += NumWords(decPart) + " ten-thousandths"; break;
                    case 5: words += NumWords(decPart) + " hundred-thousandths"; break;
                    case 6: words += NumWords(decPart) + " millionths"; break;
                    case 7: words += NumWords(decPart) + " ten-millionths"; break;
                }
            }
            return words;
        }

        static String NumWords(double n) //converts double to words
        {
            string[] numbersArr = new string[] { "one", "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten", "eleven", "twelve", "thirteen", "fourteen", "fifteen", "sixteen", "seventeen", "eighteen", "nineteen" };
            string[] tensArr = new string[] { "twenty", "thirty", "fourty", "fifty", "sixty", "seventy", "eighty", "ninty" };
            string[] suffixesArr = new string[] { "thousand", "million", "billion", "trillion", "quadrillion", "quintillion", "sextillion", "septillion", "octillion", "nonillion", "decillion", "undecillion", "duodecillion", "tredecillion", "Quattuordecillion", "Quindecillion", "Sexdecillion", "Septdecillion", "Octodecillion", "Novemdecillion", "Vigintillion" };
            string words = "";

            bool tens = false;

            if (n < 0) {
                words += "negative ";
                n *= -1;
            }

            int power = (suffixesArr.Length + 1) * 3;

            while (power > 3) {
                double pow = Math.Pow(10, power);
                if (n >= pow) {
                    if (n % pow > 0) {
                        words += NumWords(Math.Floor(n / pow)) + " " + suffixesArr[(power / 3) - 1] + ", ";
                    } else if (n % pow == 0) {
                        words += NumWords(Math.Floor(n / pow)) + " " + suffixesArr[(power / 3) - 1];
                    }
                    n %= pow;
                }
                power -= 3;
            }
            if (n >= 1000) {
                if (n % 1000 > 0) words += NumWords(Math.Floor(n / 1000)) + " thousand, ";
                else words += NumWords(Math.Floor(n / 1000)) + " thousand";
                n %= 1000;
            }
            if (0 <= n && n <= 999) {
                if ((int)n / 100 > 0) {
                    words += NumWords(Math.Floor(n / 100)) + " hundred";
                    n %= 100;
                }
                if ((int)n / 10 > 1) {
                    if (words != "")
                        words += " ";
                    words += tensArr[(int)n / 10 - 2];
                    tens = true;
                    n %= 10;
                }

                if (n < 20 && n > 0) {
                    if (words != "" && tens == false)
                        words += " ";
                    words += (tens ? "-" + numbersArr[(int)n - 1] : numbersArr[(int)n - 1]);
                    n -= Math.Floor(n);
                }
            }

            return words;

        }
        static void Main(string[] args)
        {
            Console.Write("Enter a number to convert to words: ");
            Double n = Double.Parse(Console.ReadLine());

            Console.WriteLine("{0}", NumWordsWrapper(n));
        }
    }
} 
```

编辑：从博客文章中引入代码

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-07-08T01:21:36.767

我实际上需要这个用于我正在开发的应用程序，但对这里的任何解决方案都不满意。仅供参考，此解决方案利用了 C# 7.0 对本地函数的支持。我还使用了新的数字分隔符来使较大的数字更具可读性。

```
public static class NumberExtensions
{
    private const string negativeWord = "negative";
    private static readonly Dictionary<ulong, string> _wordMap = new Dictionary<ulong, string>
    {
        [1_000_000_000_000_000_000] = "quintillion",
        [1_000_000_000_000_000] = "quadrillion",
        [1_000_000_000_000] = "trillion",
        [1_000_000_000] = "billion",
        [1_000_000] = "million",
        [1_000] = "thousand",
        [100] = "hundred",
        [90] = "ninety",
        [80] = "eighty",
        [70] = "seventy",
        [60] = "sixty",
        [50] = "fifty",
        [40] = "forty",
        [30] = "thirty",
        [20] = "twenty",
        [19] = "nineteen",
        [18] = "eighteen",
        [17] = "seventeen",
        [16] = "sixteen",
        [15] = "fifteen",
        [14] = "fourteen",
        [13] = "thirteen",
        [12] = "twelve",
        [11] = "eleven",
        [10] = "ten",
        [9] = "nine",
        [8] = "eight",
        [7] = "seven",
        [6] = "six",
        [5] = "five",
        [4] = "four",
        [3] = "three",
        [2] = "two",
        [1] = "one",
        [0] = "zero"
    };

    public static string ToWords(this short num)
    {
        var words = ToWords((ulong)Math.Abs(num));
        return num < 0 ? $"{negativeWord} {words}" : words;
    }

    public static string ToWords(this ushort num)
    {
        return ToWords((ulong)num);
    }

    public static string ToWords(this int num)
    {
        var words = ToWords((ulong)Math.Abs(num));
        return num < 0 ? $"{negativeWord} {words}" : words;
    }

    public static string ToWords(this uint num)
    {
        return ToWords((ulong)num);
    }

    public static string ToWords(this long num)
    {
        var words = ToWords((ulong)Math.Abs(num));
        return num < 0 ? $"{negativeWord} {words}" : words;
    }

    public static string ToWords(this ulong num)
    {
        var sb = new StringBuilder();
        var delimiter = String.Empty;

        void AppendWords(ulong dividend)
        {
            void AppendDelimitedWord(ulong key)
            {
                sb.Append(delimiter);
                sb.Append(_wordMap[key]);
                delimiter = 20 <= key && key < 100 ? "-" : " ";
            }

            if (_wordMap.ContainsKey(dividend))
            {
                AppendDelimitedWord(dividend);
            }
            else
            {
                var divisor = _wordMap.First(m => m.Key <= dividend).Key;
                var quotient = dividend / divisor;
                var remainder = dividend % divisor;

                if (quotient > 0 && divisor >= 100)
                {
                    AppendWords(quotient);
                }

                AppendDelimitedWord(divisor);

                if (remainder > 0)
                {   
                    AppendWords(remainder);
                }
            }
        }

        AppendWords(num);
        return sb.ToString();
    }    
} 
```

肉处于最后的`ToWords`超载状态。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-10-20T02:51:15.593

我的任务是创建一个使用 C# 将数字转换为单词的 WEB API。

可以是整数，也可以是 48 小时内的小数点。

调用将来自使用 Ajax Post 方法的前端应用程序，并在网页中返回转换后的结果。

我已在 GitHub 中公开共享该项目以供参考：[https ://github.com/marvinglennlacuna/NumbersToWordsConverter.Api](https://github.com/marvinglennlacuna/NumbersToWordsConverter.Api)

采用以下技术实现：

1.  MVC 结构化
2.  API 控制器
3.  服务
4.  模型
5.  错误处理
6.  使用 MSTest 进行单元测试
7.  代码覆盖率 - 98%
8.  jQuery

以及有关以下内容的技术文档：

1.  目的
2.  先决条件
3.  功能要求
4.  流程图和输出

**结果通过网页 (US-001) **

> US-001 通过网页过程将数字转换为单词

[![在此处输入图像描述](https://i.stack.imgur.com/igoc9.jpg)](https://i.stack.imgur.com/igoc9.jpg)

> US-001 通过网页输出将数字转换为单词

[![在此处输入图像描述](https://i.stack.imgur.com/dyhjC.png)](https://i.stack.imgur.com/dyhjC.png)

**结果来自邮递员 (US-002)**

> US-002 - 通过 Postman 流程将数字转换为单词

[![在此处输入图像描述](https://i.stack.imgur.com/Hle97.jpg)](https://i.stack.imgur.com/Hle97.jpg)

> US-002 - 通过 Postman 输出将数字转换为单词

[![在此处输入图像描述](https://i.stack.imgur.com/UutQH.png)](https://i.stack.imgur.com/UutQH.png)

我认为值得分享一个可行的解决方案，以防您在面试/代码测试/学校中需要它以供参考或仅供娱乐。

干杯，马文

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-01-17T12:13:40.703

这是我的解决方案希望对你有帮助

```
namespace ConsoleApplication3
{

    class Program
    {

        static void Main(string[] args)
        {

            string s = Console.ReadLine();
            ConvertMyword(int.Parse(s));

            Console.Read();

        }

        static void ConvertMyword(int number)
        {
            int flag = 0;
            int lflag = 0;
            string words = String.Empty;
            string[] places = { "ones", "ten", "hundred", "thousand", "ten thousand", "lacs","tenlacs","crore","tencrore" };
            string rawnumber = number.ToString();
            char[] a = rawnumber.ToCharArray();
            Array.Reverse(a);
            for (int i = a.Length - 1; i >= 0; i--)
            {
                if (i % 2 == 0 && i > 2)
                {
                    if (int.Parse(a[i].ToString()) > 1)
                    {
                        if (int.Parse(a[i - 1].ToString()) == 0)
                        {
                            words = words + getNumberStringty(int.Parse(a[i].ToString())) + " " + places[i - 1] + " ";
                        }
                        else
                        {
                            words = words + getNumberStringty(int.Parse(a[i].ToString())) + " ";
                        }
                    }
                    else if (int.Parse(a[i].ToString()) == 1)
                    {
                        if (int.Parse(a[i - 1].ToString())== 0)
                        {
                            words = words +"Ten" + " ";
                        }
                        else
                        {
                            words = words + getNumberStringteen(int.Parse(a[i - 1].ToString())) + " ";
                        }
                        flag = 1;
                    }
                }
                else
                {
                    if (i == 1 || i == 0)
                    {
                        if (int.Parse(a[i].ToString()) > 1)
                        {
                            words = words + getNumberStringty(int.Parse(a[i].ToString())) + " " + getNumberString(int.Parse(a[0].ToString())) + " ";
                            break;
                        }
                        else if (int.Parse(a[i].ToString()) == 1)
                        {
                            if (int.Parse(a[i - 1].ToString()) == 0)
                            {
                                words = words + "Ten" + " ";
                            }
                            else
                            {
                                words = words + getNumberStringteen(int.Parse(a[i - 1].ToString())) + " ";
                            }

                            break;
                        }
                        else if (int.Parse(a[i - 1].ToString()) != 0)
                        {
                            words = words + getNumberString(int.Parse(a[i - 1].ToString())) + " ";
                            break;
                        }
                        else
                        {
                            break;
                        }
                    }
                    else
                    {
                        if (flag == 0)
                        {
                            for(int l=i;l>=0;l--)
                            {
                                if (int.Parse(a[l].ToString())!=0)
                                {
                                    lflag = 1;
                                }
                            }
                            if (lflag == 1 && int.Parse(a[i].ToString())!=0)
                            {

                                    words = words + getNumberString(int.Parse(a[i].ToString())) + " " + places[i] + " ";
                                    lflag = 0;

                            }
                            else if(lflag == 0)
                            {
                               // words = words + getNumberString(int.Parse(a[i].ToString())) + " " + places[i] + " ";
                                lflag = 0;
                                break;
                            }

                        }
                        else
                        {
                            words = words + " " + places[i] + " ";
                            flag = 0;
                        }

                    }
                }
            }
            Console.WriteLine(words);
        }
        static string getNumberString(int num)
        {
            string Word = String.Empty;
            switch (num)
            {
                case 1:
                    Word = "one";
                    break;
                case 2:
                    Word = "two";
                    break;

                case 3:
                    Word = "three";
                    break;

                case 4:
                    Word = "four";
                    break;

                case 5:
                    Word = "five";
                    break;

                case 6:
                    Word = "six";
                    break;
                case 7:
                    Word = "seven";
                    break;

                case 8:
                    Word = "eight";
                    break;

                case 9:
                    Word = "nine";
                    break;

            }
            return Word;
        }
        static string getNumberStringty(int num)
        {
            string Word = String.Empty;
            switch (num)
            {

                case 2:
                    Word = "twenty";
                    break;

                case 3:
                    Word = "thirty";
                    break;

                case 4:
                    Word = "fourty";
                    break;

                case 5:
                    Word = "fifty";
                    break;

                case 6:
                    Word = "sixty";
                    break;
                case 7:
                    Word = "seventy";
                    break;

                case 8:
                    Word = "eighty";
                    break;

                case 9:
                    Word = "ninty";
                    break;

            }
            return Word;
        }
        static string getNumberStringteen(int num)
        {
            string Word = String.Empty;
            switch (num)
            {
                    case 1:
                    Word = "eleven";
                    break;
                case 2:
                    Word = "tewlve";
                    break;

                case 3:
                    Word = "thirteen";
                    break;

                case 4:
                    Word = "fourteen";
                    break;

                case 5:
                    Word = "fifteen";
                    break;

                case 6:
                    Word = "sixteen";
                    break;
                case 7:
                    Word = "seventeen";
                    break;

                case 8:
                    Word = "eighteen";
                    break;

                case 9:
                    Word = "ninteen";
                    break;

            }
            return Word;
        }
    }

} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-06-25T02:43:03.303

这个类完美地转换你的浮点数或双精度（直到 2 精度）。只需复制并粘贴到您的 IDE 中即可查看结果。

```
class ConversionClass
{
    private static Dictionary<int, string> InitialNumbers = new Dictionary<int, string>();
    private static Dictionary<int, string> MultipleOfTen = new Dictionary<int, string>();
    private static Dictionary<int, string> MultipleOfHundered = new Dictionary<int, string>();

    private static void InitializeStatic()
    {
        //InitialNumbers.Add(0, "zero");
        InitialNumbers.Add(1, "one");
        InitialNumbers.Add(2, "two");
        InitialNumbers.Add(3, "three");
        InitialNumbers.Add(4, "four");
        InitialNumbers.Add(5, "five");
        InitialNumbers.Add(6, "six");
        InitialNumbers.Add(7, "seven");
        InitialNumbers.Add(8, "eight");
        InitialNumbers.Add(9, "nine");
        InitialNumbers.Add(10, "ten");
        InitialNumbers.Add(11, "eleven");
        InitialNumbers.Add(12, "tweleve");
        InitialNumbers.Add(13, "thirteen");
        InitialNumbers.Add(14, "fourteen");
        InitialNumbers.Add(15, "fifteen");
        InitialNumbers.Add(16, "sixteen");
        InitialNumbers.Add(17, "seventeen");
        InitialNumbers.Add(18, "eighteen");
        InitialNumbers.Add(19, "nineteen");

        MultipleOfTen.Add(1, "ten");
        MultipleOfTen.Add(2, "twenty");
        MultipleOfTen.Add(3, "thirty");
        MultipleOfTen.Add(4, "fourty");
        MultipleOfTen.Add(5, "fifty");
        MultipleOfTen.Add(6, "sixty");
        MultipleOfTen.Add(7, "seventy");
        MultipleOfTen.Add(8, "eighty");
        MultipleOfTen.Add(9, "ninety");

        MultipleOfHundered.Add(2, "hundred");                      //                100
        MultipleOfHundered.Add(3, "thousand");                     //              1 000
        MultipleOfHundered.Add(4, "thousand");                     //             10 000
        MultipleOfHundered.Add(5, "thousand");                     //            100 000
        MultipleOfHundered.Add(6, "million");                      //          1 000 000
        MultipleOfHundered.Add(7, "million");                      //        100 000 000
        MultipleOfHundered.Add(8, "million");                      //      1 000 000 000
        MultipleOfHundered.Add(9, "billion");                      //  1 000 000 000 000
    }

    public static void Main()
    {
        InitializeStatic();
        Console.WriteLine("Enter number :");
        var userInput = Console.ReadLine();
        double userValue ;
        if (double.TryParse(userInput, out userValue))  // userValue = 193524019.50
        {
            int decimalPortion = (int)userValue;
            //var fractionPortion = Math.Ceiling(((userValue < 1.0) ? userValue : (userValue % Math.Floor(userValue))) * 100);
            int fractionPortion = (int)(userValue * 100) - ((int)userValue * 100);

            int digit; int power;
            StringBuilder numberInText = new StringBuilder();

            while (decimalPortion > 0)
            {
                GetDigitAndPower(decimalPortion, out digit, out power);
                numberInText.Append(ConvertToText(ref decimalPortion, ref digit, ref power));
                if (decimalPortion > 0)
                {
                    decimalPortion = GetReminder(decimalPortion, digit, power);
                }
            }
            numberInText.Append(" point ");
            while (fractionPortion > 0)
            {
                GetDigitAndPower(fractionPortion, out digit, out power);
                numberInText.Append(ConvertToText(ref fractionPortion, ref digit, ref power));
                if (fractionPortion > 0)
                {
                    fractionPortion = GetReminder(fractionPortion, digit, power);
                }
            }

            Console.WriteLine(numberInText.ToString());
        }
        Console.ReadKey();
    }

    private static int GetReminder(int orgValue, int digit, int power)
    {
        int returningValue = orgValue - (digit * (int)Math.Pow(10, power));
        return returningValue;
    }

    private static void GetDigitAndPower(int originalValue, out int digit, out int power)
    {
        for (power = 0, digit = 0; power < 10; power++)
        {
            var divisionFactor = (int)Math.Pow(10, power);
            int operationalValue = (originalValue / divisionFactor);
            if (operationalValue <= 0)
            {
                power = power - 1;
                digit = (int)(originalValue / Math.Pow(10, power));
                break;
            }
        } 
    }

    private static string ConvertToText(ref int orgValue, ref int digit, ref int power)
    {
        string numberToText = string.Empty;

        if (power < 2)
        {
            if (InitialNumbers.ContainsKey(orgValue))
            {
                //This is for number 1 to 19
                numberToText = InitialNumbers[orgValue];
                orgValue = 0;
            }
            else if (MultipleOfTen.ContainsKey(digit))
            {
                //This is for multiple of 10 (20,30,..90)
                numberToText = MultipleOfTen[digit];
            }
        }
        else
        {
            if (power < 4)
            {
                numberToText = string.Format("{0} {1}", InitialNumbers[digit], MultipleOfHundered[power]);
            }
            else
            {
                StringBuilder sb = new StringBuilder();
                int multiplicationFactor = power / 3;
                int innerOrgValue = (int) (orgValue / Math.Pow(10, (multiplicationFactor * 3)));
                digit = innerOrgValue;
                var multiple = MultipleOfHundered[power];
                power = power - ((int)Math.Ceiling(Math.Log10(innerOrgValue)) - 1);

                int innerPower = 0;
                int innerDigit = 0;
                while (innerOrgValue > 0)
                {
                    GetDigitAndPower(innerOrgValue, out innerDigit, out innerPower);
                    var text = ConvertToText(ref innerOrgValue, ref innerDigit, ref innerPower);
                    sb.Append(text);
                    sb.Append(" ");
                    if (innerOrgValue > 0)
                    {
                        innerOrgValue = GetReminder(innerOrgValue, innerDigit, innerPower);
                    }
                }
                sb.Append(multiple);
                numberToText = sb.ToString();

            }
        }

        return numberToText + " ";
    }

} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-11-23T14:38:05.637

虽然这是一个老问题，但我已经用更详细的方法实现了这个功能

```
public static class NumberToWord
    {
        private static readonly Dictionary<long, string> MyDictionary = new Dictionary<long, string>();

        static NumberToWord()
        {
            MyDictionary.Add(1000000000000000, "quadrillion");
            MyDictionary.Add(1000000000000, "trillion");
            MyDictionary.Add(1000000000, "billion");
            MyDictionary.Add(1000000, "million");
            MyDictionary.Add(1000, "thousand");
            MyDictionary.Add(100, "hundread");
            MyDictionary.Add(90, "ninety");
            MyDictionary.Add(80, "eighty");
            MyDictionary.Add(70, "seventy");
            MyDictionary.Add(60, "sixty");
            MyDictionary.Add(50, "fifty");
            MyDictionary.Add(40, "fourty");
            MyDictionary.Add(30, "thirty");
            MyDictionary.Add(20, "twenty");
            MyDictionary.Add(19, "nineteen");
            MyDictionary.Add(18, "eighteen");
            MyDictionary.Add(17, "seventeen");
            MyDictionary.Add(16, "sixteen");
            MyDictionary.Add(15, "fifteen");
            MyDictionary.Add(14, "fourteen");
            MyDictionary.Add(13, "thirteen");
            MyDictionary.Add(12, "twelve");
            MyDictionary.Add(11, "eleven");
            MyDictionary.Add(10, "ten");
            MyDictionary.Add(9, "nine");
            MyDictionary.Add(8, "eight");
            MyDictionary.Add(7, "seven");
            MyDictionary.Add(6, "six");
            MyDictionary.Add(5, "five");
            MyDictionary.Add(4, "four");
            MyDictionary.Add(3, "three");
            MyDictionary.Add(2, "two");
            MyDictionary.Add(1, "one");
            MyDictionary.Add(0, "zero");
        }

        /// <summary>
        /// To the verbal.
        /// </summary>
        /// <param name="value">The value.</param>
        /// <returns></returns>
        public static string ToVerbal(this int value)
        {
            return ToVerbal((long) value);
        }

        /// <summary>
        /// To the verbal.
        /// </summary>
        /// <param name="value">The value.</param>
        /// <returns></returns>
        public static string ToVerbal(this long value)
        {
            if (value == 0) return MyDictionary[value];

            if (value < 0)
                return $" negative {ToVerbal(Math.Abs(value))}";

            var builder = new StringBuilder();

            for (var i = 1000000000000000; i >= 1000; i = i/1000)
                value = ConstructWord(value, builder, i);

            value = ConstructWord(value, builder, 100);

            for (var i = 90; i >= 20; i = i - 10)
                value = ConstructWordForTwoDigit(value, builder, i);

            if (MyDictionary.ContainsKey(value))
                builder.AppendFormat("{0}" + MyDictionary[value], builder.Length > 0 
                    ? " " 
                    : string.Empty);

            return builder.ToString();
        }

        private static long ConstructWord(long value, StringBuilder builder, long key)
        {
            if (value >= key)
            {
                var unit = (int) (value/key);
                value -= unit*key;
                builder.AppendFormat(" {0} {1} " + MyDictionary[key], builder.Length > 0
                    ? ", "
                    : string.Empty, ToVerbal(unit));
            }
            return value;
        }
        private static long ConstructWordForTwoDigit(long value, StringBuilder builder, long key)
        {
            if (value >= key)
            {
                value -= key;
                builder.AppendFormat(" {0} " + MyDictionary[key], builder.Length > 0
                    ? " "
                    : string.Empty);
            }
            return value;
        } 
    } 
```

仅供参考：我有用户字符串插值，仅在 4.6.1 中可用

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-12-01T15:07:46.370

占用更少代码的解决方案。

最重要的部分只有几行：

```
static Func<long, string> remainder = t => t > 0 ? " " + ToEN(t) : "";

public static string ToEN(this long val, double d = 20, long th = 20)
{
    switch ((long)d)
    {
        case 20:   return val >= d ? ToEN(val, 1e2)             : en[val];
        case 100:  return val >= d ? ToEN(val, 1e3, 100)        : en[val / 10 * 10] + remainder(val % 10);
        default:   return val >= d ? ToEN(val, d * 1e3,(long)d) : ToEN(val / th) + " " + en[th] + remainder(val % th);
    }
} 
```

此处提供完整代码[https://dotnetfiddle.net/wjr4hF](https://dotnetfiddle.net/wjr4hF)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-03-22T01:23:43.650

以下 C# 控制台应用程序代码将接受最多 2 位小数的货币值，并以英文打印。您可以将其作为参考来实现您的结果。

 `````
 namespace ConsoleApplication2
{
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Text.RegularExpressions;
    class Program
    {
       static void Main(string[] args)
        {
            bool repeat = true;
            while (repeat)
            {
                string inputMonetaryValueInNumberic = string.Empty;
                string centPart = string.Empty;
                string dollarPart = string.Empty;
                Console.Write("\nEnter the monetary value : ");
                inputMonetaryValueInNumberic = Console.ReadLine();
                inputMonetaryValueInNumberic = inputMonetaryValueInNumberic.TrimStart('0');

                if (ValidateInput(inputMonetaryValueInNumberic))
                {

                    if (inputMonetaryValueInNumberic.Contains('.'))
                    {
                        centPart = ProcessCents(inputMonetaryValueInNumberic.Substring(inputMonetaryValueInNumberic.IndexOf(".") + 1));
                        dollarPart = ProcessDollar(inputMonetaryValueInNumberic.Substring(0, inputMonetaryValueInNumberic.IndexOf(".")));
                    }
                    else
                    {
                        dollarPart = ProcessDollar(inputMonetaryValueInNumberic);
                    }
                    centPart = string.IsNullOrWhiteSpace(centPart) ? string.Empty : " and " + centPart;
                    Console.WriteLine(string.Format("\n\n{0}{1}", dollarPart, centPart));
                }
                else
                {
                    Console.WriteLine("Invalid Input..");
                }

                Console.WriteLine("\n\nPress any key to continue or Escape of close : ");
                var loop = Console.ReadKey();
                repeat = !loop.Key.ToString().Contains("Escape");
                Console.Clear();
            }

        }

        private static string ProcessCents(string cents)
        {
            string english = string.Empty;
            string dig3 = Process3Digit(cents);
            if (!string.IsNullOrWhiteSpace(dig3))
            {
                dig3 = string.Format("{0} {1}", dig3, GetSections(0));
            }
            english = dig3 + english;
            return english;
        }
        private static string ProcessDollar(string dollar)
        {
            string english = string.Empty;
            foreach (var item in Get3DigitList(dollar))
            {
                string dig3 = Process3Digit(item.Value);
                if (!string.IsNullOrWhiteSpace(dig3))
                {
                    dig3 = string.Format("{0} {1}", dig3, GetSections(item.Key));
                }
                english = dig3 + english;
            }
            return english;
        }
        private static string Process3Digit(string digit3)
        {
            string result = string.Empty;
            if (Convert.ToInt32(digit3) != 0)
            {
                int place = 0;
                Stack<string> monetaryValue = new Stack<string>();
                for (int i = digit3.Length - 1; i >= 0; i--)
                {
                    place += 1;
                    string stringValue = string.Empty;
                    switch (place)
                    {
                        case 1:
                            stringValue = GetOnes(digit3[i].ToString());
                            break;
                        case 2:
                            int tens = Convert.ToInt32(digit3[i]);
                            if (tens == 1)
                            {
                                if (monetaryValue.Count > 0)
                                {
                                    monetaryValue.Pop();
                                }
                                stringValue = GetTens((digit3[i].ToString() + digit3[i + 1].ToString()));
                            }
                            else
                            {
                                stringValue = GetTens(digit3[i].ToString());
                            }
                            break;
                        case 3:
                            stringValue = GetOnes(digit3[i].ToString());
                            if (!string.IsNullOrWhiteSpace(stringValue))
                            {
                                string postFixWith = " Hundred";
                                if (monetaryValue.Count > 0)
                                {
                                    postFixWith = postFixWith + " And";
                                }
                                stringValue += postFixWith;
                            }
                            break;
                    }
                    if (!string.IsNullOrWhiteSpace(stringValue))
                        monetaryValue.Push(stringValue);
                }
                while (monetaryValue.Count > 0)
                {
                    result += " " + monetaryValue.Pop().ToString().Trim();
                }
            }
            return result;
        }
        private static Dictionary<int, string> Get3DigitList(string monetaryValueInNumberic)
        {
            Dictionary<int, string> hundredsStack = new Dictionary<int, string>();
            int counter = 0;
            while (monetaryValueInNumberic.Length >= 3)
            {
                string digit3 = monetaryValueInNumberic.Substring(monetaryValueInNumberic.Length - 3, 3);
                monetaryValueInNumberic = monetaryValueInNumberic.Substring(0, monetaryValueInNumberic.Length - 3);
                hundredsStack.Add(++counter, digit3);
            }
            if (monetaryValueInNumberic.Length != 0)
                hundredsStack.Add(++counter, monetaryValueInNumberic);
            return hundredsStack;
        }
        private static string GetTens(string tensPlaceValue)
        {
            string englishEquvalent = string.Empty;
            int value = Convert.ToInt32(tensPlaceValue);
            Dictionary<int, string> tens = new Dictionary<int, string>();
            tens.Add(2, "Twenty");
            tens.Add(3, "Thirty");
            tens.Add(4, "Forty");
            tens.Add(5, "Fifty");
            tens.Add(6, "Sixty");
            tens.Add(7, "Seventy");
            tens.Add(8, "Eighty");
            tens.Add(9, "Ninty");
            tens.Add(10, "Ten");
            tens.Add(11, "Eleven");
            tens.Add(12, "Twelve");
            tens.Add(13, "Thrteen");
            tens.Add(14, "Fourteen");
            tens.Add(15, "Fifteen");
            tens.Add(16, "Sixteen");
            tens.Add(17, "Seventeen");
            tens.Add(18, "Eighteen");
            tens.Add(19, "Ninteen");
            if (tens.ContainsKey(value))
            {
                englishEquvalent = tens[value];
            }

            return englishEquvalent;

        }
        private static string GetOnes(string onesPlaceValue)
        {
            int value = Convert.ToInt32(onesPlaceValue);
            string englishEquvalent = string.Empty;
            Dictionary<int, string> ones = new Dictionary<int, string>();
            ones.Add(1, " One");
            ones.Add(2, " Two");
            ones.Add(3, " Three");
            ones.Add(4, " Four");
            ones.Add(5, " Five");
            ones.Add(6, " Six");
            ones.Add(7, " Seven");
            ones.Add(8, " Eight");
            ones.Add(9, " Nine");

            if (ones.ContainsKey(value))
            {
                englishEquvalent = ones[value];
            }

            return englishEquvalent;
        }
        private static string GetSections(int section)
        {
            string sectionName = string.Empty;
            switch (section)
            {
                case 0:
                    sectionName = "Cents";
                    break;
                case 1:
                    sectionName = "Dollars";
                    break;
                case 2:
                    sectionName = "Thousand";
                    break;
                case 3:
                    sectionName = "Million";
                    break;
                case 4:
                    sectionName = "Billion";
                    break;
                case 5:
                    sectionName = "Trillion";
                    break;
                case 6:
                    sectionName = "Zillion";
                    break;
            }
            return sectionName;
        }
        private static bool ValidateInput(string input)
        {
            return Regex.IsMatch(input, "[0-9]{1,18}(\\.[0-9]{1,2})?"))
        }
    }
} 
````  `# asp.net - ASP.net 2.0 嵌套gridview：如何跨越父gridview 列？

> ID：554316
> 
> 赞同：1
> 
> 时间：2009-02-16T19:36:28.373
> 
> 标签：asp.net, gridview, nested

再会，

我有一个带有几列的父网格视图。在每一行上，我想要一个嵌套的网格视图。但是，我在正确显示嵌套的网格视图时遇到了问题。

如果我把嵌套的gridview放在父gridview的第一列，当我将嵌套的一个可见属性设置为true时，当然父gridview的所有列都会向右移动（腾出一些空间对于子网格视图）。

如何使该子网格视图跨越父网格视图的列？如果不可能，我该如何实现类似的目标。当然，我不想将子gridview放在父gridview的最后一列...

非常感谢你！

编辑：我们必须使用 asp.net 2.0

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-16T19:59:13.497

这对于网格视图控件来说会有些棘手。您需要处理网格上的事件，然后更新包含列上的 HTML colspan 属性，您将在其控制树中添加网格（不推荐）。

如果可以使用 3.5 框架，更好的选择是使用 ListView 控件。此控件使您可以完全控制标记。使用此控件，您可以轻松地指定父列的列跨度，甚至可以根据内联表达式 (<%# Eval(condition) %>) 使其成为条件。

如果 3.5 框架不是一个选项。我将尝试一种解决方案，该解决方案至少对父表使用中继器控件，以便您对表布局的标记进行声明式控制。

我希望这有帮助。

# sharepoint - 网站所有者无法在两个子网站之间移动或复制页面？

> ID：554318
> 
> 赞同：2
> 
> 时间：2009-02-16T19:37:39.993
> 
> 标签：sharepoint, sharepoint-2007, permissions

我在根站点的站点所有者组中有用户，试图在两个子网站的页面库之间复制（或移动）页面。子网站的权限是从父网站继承的，没有任何变化，因此根的站点所有者也是子网站的站点所有者。

当所有者组的成员尝试移动或复制页面时，它会失败。12-Hive 日志显示正在引发访问被拒绝错误。

有没有办法在不授予这些用户网站集管理员访问权限的情况下允许这种情况发生？

**编辑：**这是通过发布站点上站点操作中的管理站点内容链接。在两个资源管理器窗口之间复制/粘贴或拖放可以正常工作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T12:20:46.750

我们在几个网站上也遇到了这个问题。事实证明，与我们试图移动的内容页面相关的页面布局存在问题。奇怪的是，如果关联的页面布局在其版本历史记录中有任何草稿版本，那么移动操作将失败并出现拒绝访问错误。一旦我们删除页面布局上的所有草稿版本，移动操作就会成功。

我仍然不完全确定为什么会这样 - 我希望在不久的将来能找到一些时间做更多的调查。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T00:35:20.010

也许您可以尝试将子站点的权限明确授予所需用户。

您是指使用“资源管理器视图”复制/移动吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T01:16:40.067

这不是真正的权限问题。SharePoint 并没有真正提供在库/网站之间移动内容的机制。

如果您运行的是 Windows，我建议您在两个库的工具菜单下使用“在资源管理器中查看”，然后在两个窗口之间拖动文件。这应该可供网站上的贡献者使用*。

*   除非有人搞砸了“贡献者”的定义..

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-23T18:18:40.810

管理站点内容页面基于 PRIME API，它是 ~buggy。尝试找出您的用户正在尝试做什么（即找出他们移动页面的原因）并给他们一个解决方法（例如要求他们创建新的内容页面并粘贴数据；向他们展示内容批准的工作原理，让他们感觉在生产站点上工作很舒服；使用正式的内容部署流程。）

根据您的用户尝试执行的操作，我建议的大多数/所有具体解决方法都将偏离基础。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-24T10:42:47.933

虽然我个人没有遇到过这个问题，但位于[http://[yourdomain]/Long%20Running%20Operation%20Status/AllItems.aspx的隐藏列表](http://[yourdomain]/Long%20Running%20Operation%20Status/AllItems.aspx)**“长期运行状态”在***复制*/*移动*期间被多次写入或通过管理站点内容（又名站点管理器）工具*删除操作。*

 ***可能值得检查您的问题用户是否具有此列表的写入权限，或者明确分配贡献访问权限并查看这是否解决了您的问题。

参考：

*   [http://sharepoint.microsoft.com/blogs/LKuhn/Lists/Posts/Post.aspx?ID=77](http://sharepoint.microsoft.com/blogs/LKuhn/Lists/Posts/Post.aspx?ID=77)向您展示如何在浏览器中访问此列表。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-08-05T19:16:14.723

我基本上用命令行中的相同权限覆盖了权限策略。

这是我使用的命令： stsadm -o addpermissionpolicy -url -userlogin -permissionlevel <"Full Control">

关键是–permissionlevel 参数上的双引号。在我这样做之后，用户可以移动/复制页面而不是网站集管理员。

# silverlight - 从数据库馈送 DeepZoom 控件

> ID：554323
> 
> 赞同：0
> 
> 时间：2009-02-16T19:38:40.910
> 
> 标签：silverlight, deepzoom

有谁知道从数据库而不是文件系统提供 DeepZoom 控制的示例？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-21T17:14:25.677

所以我最初的想法是，你可能需要编写自己的[MultiScaleTileSource](http://msdn.microsoft.com/en-us/library/system.windows.media.multiscaletilesource(VS.95).aspx)，它从文件系统以外的源返回切片。

关于那个主题的快速谷歌已经抛出了这篇文章，看起来正是你所追求的：http: [//www.codeproject.com/KB/silverlight/DatabaseDeepZoom.aspx](http://www.codeproject.com/KB/silverlight/DatabaseDeepZoom.aspx)

# java - JVM 是否有最坏的情况实现？

> ID：554339
> 
> 赞同：9
> 
> 时间：2009-02-16T19:43:58.090
> 
> 标签：java, multithreading, memory, synchronization, jvm

[Java 内存模型](http://en.wikipedia.org/wiki/Java_Memory_Model)清楚地说明了关于线程如何通过内存进行交互的假设和不可以假设。例如，如果一个线程在没有适当同步的情况下将新值写入字段，则不能保证其他线程可以观察到新值。然而，在实践中，尽管同步不充分，其他线程仍可能读取新值，这取决于写入和读取之间的时间、硬件架构等。

这可能导致难以发现且难以重现的错误。[因此，在超出Java 内存模型](http://en.wikipedia.org/wiki/Java_Memory_Model)保证的线程之间绝对没有内存同步的最坏情况 JVM 上运行 Java 应用程序可能很有用。这种最坏情况的 JVM 实现是否存在？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-16T19:52:06.290

您可以尝试使用[Terracotta](http://www.terracotta.org/)来集群您的程序。不正确的同步是令人难以置信的无情（即使集群中只有一个节点也会变得很明显）。这是一个**很好的**问题：我经常想要这种能力——我很惊讶标准 JRE 中没有开关`-XXJMMExtreme`

Terracotta 是开源的，基本产品免费。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T19:56:18.137

这可能会有所帮助：http: [//javapathfinder.sourceforge.net/](http://javapathfinder.sourceforge.net/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-16T19:52:32.407

我不知道有任何 VM 可以一直保证最坏情况的行为，这似乎是您所要求的。您所描述的情况可能发生在 Sun VM（以及许多其他 VM）上，但这只是由于缓存问题。我不熟悉一直故意这样做的虚拟机。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-16T20:35:41.927

有很多方法可以触发并发错误。

*   将您的应用程序加载到比您通常预期的更多的线程上。确保这足以获得 99% 以上的 CPU。
*   在启用探查器或禁用 JIT 的情况下运行您的程序。这会改变应用程序的计时行为。
*   测试 Java 5 和 Java 6 （这通常是找到一些错误的最简单和最好的方法）我没有发现使用 Java 7 的错误，它没有出现在 5/6 中。

对于最坏情况下的 JVM，请尝试使用手机。（您的应用程序可能根本无法运行）；）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-02-27T22:38:34.160

同步错误通常很难重现，因为它们取决于不同线程之间的微妙计时，因此实际上尝试“只运行您的程序”的任何实现都不会总是“最糟糕的”。如果您只执行一次这些指令，则无法重现两个线程可以交错其指令的一种以上不同的方式。在一次运行中测试所有这些组合甚至更不可能。其他海报之一建议使用 Java Pathfinder，这听起来是个好主意 - 但请注意，它是一个多次运行相同代码的应用程序，因此您不能真正将其视为另一个 JVM 实现。

另一个实用技巧是尝试在尽可能多的不同 JVM 上运行应用程序。尝试不同的供应商，同一供应商的不同版本，不同的 CPU 架构等等。几年前，我曾在 Sun 的 JVM 上在 Xeon CPU 上开发、测试和运行一个高度多线程的应用程序，它运行良好。有一次，我尝试在 IBM 的 J9 Java Virtual Machine on POWER 架构上运行它，第一次尝试时，大约 2/3 的测试由于同步错误而失败。因此，在不同环境中进行测试可以很好地暴露隐藏的同步问题。

# runas - 得到“不支持 RUNAS 命令”。在 iexplore.exe 上使用 runas 时

> ID：554341
> 
> 赞同：2
> 
> 时间：2009-02-16T19:44:52.033
> 
> 标签：runas

当尝试使用 runas 命令在不同用户帐户下在 Windows Server 2008 上运行 IE 时，我收到消息“不支持 RUNAS 命令”。此命令适用于其他应用程序，但不适用于 IE。还有其他人遇到这个并找到解决方法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-16T19:49:38.310

是的，这在 Vista / Server 2008 下是不可能的。

[http://support.microsoft.com/kb/922980](http://support.microsoft.com/kb/922980)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-03-31T01:17:51.403

我不完全确定您的环境，但该功能确实适用于 otb`windows 2008 R2`服务器。您可以按住`shift+right click`图标并选择以其他用户身份运行。您是否尝试`iexplore.exe`从命令提示符或远程 shell 启动？

# c# - 这还是闭包吗？

> ID：554345
> 
> 赞同：3
> 
> 时间：2009-02-16T19:45:52.983
> 
> 标签：c#, .net, function, closures, anonymous-methods

testit() 方法是一个闭包。aString 已超出范围，但 testit() 仍然可以在其上执行。testit2() 使用的变量没有超出范围（mystring），但也没有传递给 testit2()。testit2() 是否被视为闭包？

```
string mystring = "hello world";
Action testit = new Action(delegate { string aString = "in anon method"; Debug.WriteLine(aString); });
testit();

//capture mystring.  Is this still a closure?
Action testit2 = new Action(delegate { Debug.WriteLine(mystring); });
//mystring is still in scope
testit2(); 
```

在第二个示例中，可以在方法之外更新 mystring，这些更改将反映在 testit2() 中。这不像普通方法，它只能将 mystring 作为参数捕获。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-16T19:48:56.360

这两个示例都是匿名函数。第二个使用闭包来捕获局部变量。变量相对于匿名函数的作用域生命周期不影响是否创建闭包来使用它。只要变量在匿名函数外部定义并在内部使用，就会创建一个闭包。

第一个匿名函数不使用本地状态，因此不需要闭包。它应该编译成静态方法。

这是必要的，因为匿名函数可以超过当前函数的生命周期。因此，必须捕获匿名函数中使用的所有本地变量，以便以后执行委托。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-16T19:50:02.193

闭包不会捕获范围内的*值*，而是捕获范围的实际*定义*。因此，任何其他引用同一范围的代码都可以修改其中的变量。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-16T19:50:59.320

`testit`并不是`testit2`真正的闭包——它只使用*本地定义*的变量，而不是“父”环境中的变量（例如`mystring`）。

但是，我认为两者都是闭包，因为它们有*能力*从其封闭环境中捕获变量，这要归功于匿名方法。

# jquery - 使用jQuery将所有具有类的对象加载到数组中

> ID：554348
> 
> 赞同：10
> 
> 时间：2009-02-16T19:46:52.153
> 
> 标签：jquery

我的页面上有一堆 div 类 testClass。

我想将它们加载到一个数组中，然后检查数组的大小。

但它不起作用？

```
myArray = $('testClass');

alert(myArray.count); 
```

怎么了？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-16T20:00:51.013

你有：

```
myArray = $('testClass');
alert(myArray.count); 
```

你要：

```
myArray = $('.testClass');
alert(myArray.length); 
```

请注意，首先， . 用于测试类。然后，myArray 是一个 JavaScript 对象，因此您可以访问长度键。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-16T19:52:24.077

您提供的代码返回一个可迭代的 jQuery 对象，但不是一个数组。此外，您在类选择器中犯了一个错误。

要检查该 jQuery 对象的大小，您可以使用：

```
var $j_object = $(".testClass");
alert($j_object.size()); 
```

要遍历该对象，您可以使用 each() 函数：

```
var $j_object = $(".testClass");
$j_object.each( function(i) { doSomethingHere(); } ); 
```

查看 jQuery 文档以获取有关如何使用 each() 的更多信息。

另一个注意事项。如果你想对每个函数中的 dom 对象做一些事情，你可以参考 'this'。要从 dom 对象中获取 jQuery 对象，可以使用 $(this)。

此外，$ 符号是完全可选的，但可以帮助区分 jQuery 对象和其他变量，例如那些表示 dom 元素的变量。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-16T21:56:30.737

您可以在不使用数组的情况下执行此操作：

```
$('.testClass').length 
```

就这样。

# sql - 将 ms sql“分组依据”查询转换为 linq 到 sql

> ID：554349
> 
> 赞同：1
> 
> 时间：2009-02-16T19:47:08.783
> 
> 标签：sql, sql-server, linq

我有两个表，产品和类别。如何将以下 sql 查询转换为 linq 格式？

```
select c.Name, c.DisplayName, count(p.id) from categories as c
LEFT join products as p on p.categoryId = c.id
group by c.Name, c.DisplayName 
```

某些类别中将有 0 个产品，因此 LEFT JOIN 很重要

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-16T20:45:06.180

如果您在模型中正确定义了关系，那么客户表应该与所有产品关联，因此您只需使用“c.Products”即可访问与客户关联的产品。然后应该能够简单地编写如下内容：

```
 var q = 
    from c in categories
    select new { c.Name, c.DisplayName, Count = c.Products.Count() } 
```

T。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-16T20:47:27.267

```
dc.categories
.Select(c => new
{
  Name = c.Name,
  DisplayName = c.DisplayName,
  TheCount = c.Products.Count()
} 
```

如果您想在其他情况下进行左加入，请查看“组加入”。

```
dc.categories
.GroupJoin(dc.products,
  c => c.id,
  p => p.categoryid,
  (c, g) => new { Name = c.Name, TheCount = g.Count() }
); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-04T18:53:42.200

显示分组的基础。

```
 var q =   from c in db.categories
    group c by new {c.Name , c.DisplayName} into alias
    select new { alias.Name, 
                 alias.DisplayName, 
                 Count = alias.Count(p => p.id) 
                } 
```

# deployment - 重新定位 ClickOnce 部署

> ID：554364
> 
> 赞同：8
> 
> 时间：2009-02-16T19:52:08.383
> 
> 标签：deployment, clickonce

有没有人有过重新定位 ClickOnce 部署的经验？我通过 ClickOnce 在公司内部部署了多个应用程序，现在托管应用程序的驱动器已移动到不同网络映射上的不同计算机。

我需要更改“配置”的哪些部分以反映移动？谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-08T21:00:09.787

您可以在 VS2008 属性中对此进行配置。

```
1\. 转到项目属性 --> 发布 --> 更新
 2\. 将新位置/服务器添加到更新位置文本。
 3\. 最后一次将项目发布到原始发布位置。
 4\. 在步骤 2 中发布该位置的所有未来更新。

```

# c# - 覆盖子类中的 ReadOnly 属性以使其成为读/写（VB.NET 或 C#）

> ID：554369
> 
> 赞同：6
> 
> 时间：2009-02-16T19:55:10.310
> 
> 标签：c#, vb.net, inheritance, properties, readonly

这在带有属性的 VB.NET 中似乎是不可能的，因为属性语句本身必须描述它是否`ReadOnly`存在。

在下面的示例中，它不允许我进行`ReadWriteChild`编译。我想我可以让父级读/写，然后让 ReadOnlyChild 的设置器不做任何事情，但这似乎有点 hacky。在这种情况下，最好的选择似乎是放弃属性，转而使用 getter/setter 方法。

```
Public MustInherit Class Parent

    Public MustOverride ReadOnly Property Foo() As String

End Class

Public Class ReadOnlyChild
    Inherits Parent

    Public Overrides ReadOnly Property Foo() As String
        Get
            ' Get the Property
        End Get
    End Property

End Class

Public Class ReadWriteChild
    Inherits Parent

    Public Overrides Property Foo() As String
        Get
            ' Get the property.
        End Get
        Set(ByVal value As String)
           ' Set the property.
        End Set
    End Property

End Class 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-16T21:09:32.377

鉴于您要完成的工作以及您发布的示例代码，VB.NET 不会让您这样做。

通常，您可以像这样在 VB.NET 中声明一个属性：

```
Public Class qwqwqw
  Public Property xyz() As String
      Get
          Return ""
      End Get
      Private Set(ByVal value As String)
          '
      End Set
  End Property
End Class 
```

基本上将整个属性标记为公共的，但给 setter（或 getter）一个更严格的范围。

您的主要问题是 MustInherit （即抽象）基类。由于您在其中定义的属性被标记为 MustOverride，因此您不能提供默认实现（即它也是抽象的），因此这包括“Get”和“Set”大纲，因此，无论哪个“整体" 你给这个抽象属性声明的范围，VB.NET 将强制你在派生类中为 getter 和 setter 使用这个*范围*。

在基类的属性上使用 ReadOnly 限定符将强制所有派生类和此属性的实现也为 ReadOnly。离开 ReadOnly 限定符仍然行不通，因为您赋予抽象属性的任何范围都将是您必须应用于派生实现中的 setter 和 getter 的范围。

例如：

```
Public MustInherit Class Parent
  Public MustOverride Property Foo() As String
End Class

Public Class ReadOnlyChild
  Inherits Parent

  Public Overrides Property Foo() As String
    Get
        '
    End Get
    Private Set(ByVal value As String)
        '
    End Set
  End Property
End Class 
```

（注意 setter 上的 Private 范围）。这将不起作用，因为 VB.NET 坚持认为，由于您要覆盖基类属性，因此您的整个属性必须与您要覆盖的属性具有相同的范围（在本例中为公共）。

尝试使基类的抽象属性受保护也不起作用，因为您将需要在与基类中声明的相同范围级别（即受保护）中实现该属性。通常，当不使用特定范围级别覆盖基类的抽象定义时，您可以为 getter 或 setter 提供*更*严格的范围级别，但不能为其提供限制*较少*的范围级别。

所以：

```
Public MustInherit Class Parent
  Protected MustOverride Property Foo() As String       
End Class

Public Class ReadOnlyChild
  Inherits Parent

  Protected Overrides Property Foo() As String
      Public Get
          '
      End Get
      Set(ByVal value As String)
          '
      End Set
  End Property
End Class 
```

（注意 getter 的公共范围）。由于公共范围比受保护的整体属性范围限制更少，而且与基类的抽象属性声明中定义的范围级别不同，因此不起作用。

如果您的类的设计如您在问题中提到的那样，我个人会使用“java-style”getter 和 setter*方法*，因为它们可以使用自己的范围级别单独声明。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-16T20:06:36.803

可能是一个远景......鉴于我对VB.NET的了解很少......

在 C# 中，您可以独立于属性指定属性访问器的可见性：

```
public virtual string Name
{
    get { ... }
    protected set { ... }
} 
```

在此示例中，子类可以访问设置器，但其他类不能。

另请注意，覆盖可以比它们覆盖的内容具有更大的可见性 - 因此您可以这样做：

```
public overide string Name
{
    get { ... }
    public set { ... }
} 
```

你能在 VB.NET 中做这样的事情吗？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-16T21:25:52.323

确认 MrEdmuno 是正确的，因为您可以使用 Shadow。但是，您似乎无法直接遮蔽标记为 MustInherit 的东西，因此您需要继承到一个类（Parent 2）中……然后再继承到您的只读中（实际上考虑一下，如果您可能不需要使用阴影继承到一个类）

我认为我的评论问题仍然存在，你为什么需要这样做？如果它们是您自己的类，您会更好地修改它们，还是作为接口实现？

```
Public MustInherit Class Parent

    Public MustOverride ReadOnly Property Foo() As String

End Class

Public Class ReadOnlyChild
    Inherits Parent

    Public Overrides ReadOnly Property Foo() As String
        Get
            'Get the Property
            Return "Return"
        End Get
    End Property

End Class

Public Class Parent2
    Inherits Parent

    Public Overrides ReadOnly Property Foo() As String
        Get
            Return "Return 2"
        End Get
    End Property
End Class

Public Class ReadWriteChild
    Inherits Parent2

    Public Shadows Property Foo() As String
        Get
            '// Get the property.
            Return "2"
        End Get
        Set(ByVal value As String)
            '** Set something
        End Set
    End Property 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-16T21:08:54.330

不幸的是，我这里没有视觉工作室，所以我无法确认。

您是否看过使用阴影，这实际上与在 C# 属性声明中说“新”相同。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-03T10:24:17.723

为了解决 Bevan 的建议，在 VB.NET 中，您可以将属性声明为具有公共 getter 和受保护的 setter，如下所示：

```
Private _ExpectedTotalRoyalties As Decimal

Public Property ExpectedTotalRoyalties() As Decimal
    Get
        Return _ExpectedTotalRoyalties
    End Get
    Protected Set(ByVal value As Decimal)
        If Not _ExpectedTotalRoyalties.Equals(value) Then
            _ExpectedTotalRoyalties = value
            SendPropertyChanged("ExpectedTotalRoyalties")
        End If
    End Set
End Property 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-06-21T18:30:28.397

不要尝试覆盖该属性，因为它不是虚拟的。覆盖 OnReadOnlyChanged 方法并在那里处理您的业务。祝你好运

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-12-20T19:47:55.707

您需要添加另一个层次结构；不幸的是，真正正确界定事物的唯一方法是使用嵌套类：

```
Public Class IntermediateClassForPrivateInheritanceOnly
  Inherits Parent
  Public Overrides ReadOnly Property Foo() As String
  ' etc.
  Private Sub New(whatever)
    MyBase.New(whatever)
  End Sub

  ' Most other stuff for the class goes here.

  Public Class ReadWriteChild
    Inherits IntermediateClassForPrivateInheritanceOnly
    Shadows Property Foo()
    ' etc.
    Public Sub New(whatever)
      MyBase.New(whatever)
    End Sub
  End Class
End Class

Public Class ReadWriteChild  ' Would use an alias, if such things existed
  Inherits IntermediateClassForPrivateInheritanceOnly
  Public Sub New(whatever)
    MyBase.New(whatever)
  End Sub
End Class 
```

# assemblies - 从引用的程序集中抑制 MessageBox

> ID：554373
> 
> 赞同：1
> 
> 时间：2009-02-16T19:56:24.673
> 
> 标签：assemblies, reference

如何禁止 MessageBox 显示来自对我不拥有（也没有代码）的程序集的引用？

例如，我的应用程序 (MyApplication.exe) 正在引用由其他人 (SomeoneElsesAssembly.dll) 编码的程序集。在这个程序集中，我调用了一个静态方法，该方法执行它应该做的事情，但也正在触发一个我想要抑制的 MessageBox。

我认为有一种方法可以在非交互模式下引用程序集或类似的方式。

感谢您的帮助。

-杰西·豪尔

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-16T20:02:21.400

您要问的基本上是“如何修改第三方程序集中代码的行为”。

没有拆卸/重新组装，答案是“你不能”。

有一些讨厌的选择；

使用托管代码，您始终拥有某种形式的源代码。如果函数有点独立，您可以使用 Reflector 将其复制到您自己的代码中

您可以有一个等待消息框出现然后自动关闭它的第二个线程。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-16T20:31:04.327

这篇[文章](http://www.codeproject.com/KB/dialog/WindowInterceptor.aspx?fid=1070466&df=90&mpp=25&noise=3&sort=Position&view=Quick&select=2624936)可能会有所帮助

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-16T20:09:37.887

> 我认为有一种方法可以在非交互模式下引用程序集或类似的方式。

我相信可以在非交互模式下运行进程（例如 Windows 服务），但是程序集被加载到进程中，并且受制于与进程中的其他程序集相同的交互级别，afaik。

因此，无论是反汇编重组还是直接向框发送 Windows 消息以自动关闭它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-16T20:01:39.263

基本上你是在问你是否可以引用一个调用 MessageBox() 的程序集并且让代码实际上不显示一个消息框。不幸的是，答案是否定的。

最好的办法是在消息框出现后使用屏幕抓取来关闭它。这篇文章有一些关于如何关闭 InProc 消息框的示例代码。 [http://www.codeproject.com/KB/dialog/AutoCloseMessageBox.aspx](http://www.codeproject.com/KB/dialog/AutoCloseMessageBox.aspx)

# cocoa - 如何在 Mac OS X Leopard 中检测用户所在的空间？

> ID：554380
> 
> 赞同：5
> 
> 时间：2009-02-16T19:59:42.403
> 
> 标签：cocoa, macos, applescript

Mac OS X Leopard 有一个名为 Spaces 的虚拟桌面实现。我想以**编程方式检测用户当前所在的空间**。

**可可更可取**，但如果没有其他方法， **AppleScript 也是可以接受的。**

我见过几个 AppleScript 实现，但他们使用的技术似乎有点太老套了，无法在生产代码中使用（一个依赖于导致错误然后解析错误消息以获取当前空间，另一个询问 Spaces 菜单图形用户界面）

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-16T20:04:09.477

使用 HIWindowGetCGWindowID 获取 WindowRef 的 CGWindowID。

将该 ID 与 CGWindow.h 中的 CGWindowListCreateDescriptionFromArray 一起使用以获取有关窗口的信息。

查看返回的字典并提取（可选）kCGWindowWorkspace 键。那是您窗口的空间 ID。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2010-03-25T07:09:28.697

如果有人仍然关心，我已经根据您可以在[http://github.com/shabble/osx-space-id获得的答案整理了一个小命令行实用程序](http://github.com/shabble/osx-space-id)

# c# - SharpDevelop 或 Express 版本

> ID：554382
> 
> 赞同：18
> 
> 时间：2009-02-16T20:00:16.100
> 
> 标签：c#, .net, ide, sharpdevelop

既然有 Sharpdevelop 3.0 ( [http://www.icsharpcode.net/OpenSource/SD/Download/](http://www.icsharpcode.net/OpenSource/SD/Download/) )，谁能告诉我它与 Express Editions 相比如何？( [http://www.microsoft.com/Express/](http://www.microsoft.com/Express/) )

我试图找出差异，但只能找到这个旧帖子[http://community.icharpcode.net/blogs/mattward/pages/VisualStudioExpressComparison.aspx](http://community.icsharpcode.net/blogs/mattward/pages/VisualStudioExpressComparison.aspx)

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-17T07:11:40.043

我写了一篇关于它的博客文章，你可以在[这里找到它](http://blog.softwarefun.nl/?p=10)

在我的结论中，我说：

结论 如果我必须为 Web 应用程序选择，那么 Express 版将轻松胜出。内置网络服务器、具有分屏功能的图形设计器和 javascript 调试让它变得太好了。如果您认为您确实需要在 IDE 中使用数据库，那么 SharpDevelop 也不适合您。如果您想创建 Windows 窗体或控制台应用程序，两者都可以正常工作，如果您想更认真地构建这些应用程序并使用源代码控制系统、静态代码分析和 IDE 中的 stylecop，您需要 SharpDevelop ！

如果速成版允许第三方可扩展性（Resharper）并解决我的小烦恼，那将是第一名。如果 SharpDevelop 能获得一个 resharper 插件、一个网页图形设计器和一个内置的网络服务器，那它将是第一名。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-16T21:41:10.147

SharpDevelop 是一个免费/开源项目。Microsoft Visual Studio Express Edition 是一个残缺的 Visual Studio，缺少一些有助于发布商业软件的工具/功能。

如果您计划将来使用 Visual Studio，请使用 Express Edition。否则我强烈推荐SharpDevelop。

在功能方面，它们都有调试器，它们都有语法高亮和代码完成。它们都将具有您期望从完整的 RAD IDE for .Net 中获得的所有功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-12-06T05:02:11.513

另一个值得一提的问题是 Sharpdevelop 中的单元测试支持。Nunit 可以集成到 IDE 中，这是 IMO 的巨大收获。#Develop 中的单元测试远远优于 MSTest，并且带有 VS 的 Nunit 没有集成到 IDE 中。

# c# - 规定类中需要一个属性 - 编译时

> ID：554405
> 
> 赞同：3
> 
> 时间：2009-02-16T20:11:55.870
> 
> 标签：c#, .net, compiler-construction, clr

有没有办法规定一个类的客户应该为一个类中的一组属性指定一个值。例如（见下面的代码），我可以规定应在编译时指定就业类中的“EmploymentType”属性吗？我知道我可以使用参数化构造函数等。我专门寻找在编译期间输出自定义警告或错误。那可能吗？

```
public class Employment
{
   public EmploymentType EmploymentType {get; set;}
}

public enum EmploymentType
{
    FullTime = 1,
    PartTime= 2
}

public class Client
{
    Employment e = new Employment();
// if i build the above code, i should get a error or warning saying you should specify value for EmploymentType
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-16T20:20:53.353

正如 cmsjr 所说，您需要做的是：

```
public class Employment
{
    public Employment(EmploymentType employmentType)
    {
        this.EmploymentType = employmentType;
    }

    public EmploymentType EmploymentType { get; set; }
} 
```

这将强制调用者在创建时传递值，如下所示：

```
Employment e = new Employment(EmploymentType.FullTime); 
```

在您需要有默认构造函数（如序列化）但仍想强制执行规则的情况下，您将需要某种状态验证。例如，每当您尝试对就业类执行操作时，您都可以让它检查如下的有效状态：

```
public EmploymentType? EmploymentType { get; set; } // Nullable Type

public void PerformAction()
{
    if(this.Validate())
        // Perform action
}
protected bool Validate()
{
    if(!EmploymentType.HasValue)
        throw new InvalidOperationException("EmploymentType must be set.");
} 
```

如果您正在寻找抛出自定义编译器警告，这并不完全可能。我在这里问了一个类似的问题[Custom Compiler Warnings](https://stackoverflow.com/questions/154109/custom-compiler-warnings)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-16T20:17:35.403

您可以通过没有默认构造函数来实现您想要做的事情，而是定义一个将就业类型作为参数的构造函数。如果有人试图使用无参数构造函数来实例化类，他们会得到一个编译错误。

编辑代码示例

```
 public Employment(EmploymentType eType)
    {
      this.EmploymentType = eType;
    } 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-16T20:24:28.833

OO 原则规定对象永远不应处于无效状态。所以这应该是一个构造函数参数。

没有办法表明在编译时需要一个属性。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-16T20:27:14.133

您在原始帖子中提到您已经知道使用构造函数执行此操作，这绝对是正确的方法。我不相信会有任何方式来做你想做的事，即使是属性（这通常是你操作编译器警告等的方式）。由于可以创建对象，然后将其传递给另一个方法来设置参数，因此不一定像“客户端必须指定值”那样明显。

您可以尝试创建自定义 FxCop 或 VSTS 静态分析规则，但我认为您无法仅使用 C# 编译器来执行此操作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-11-07T20:43:44.910

```
Interface Icontrol
 ' Declare an interface.
 Property MustHave() As String

End Interface 
```

然后在您的用户控件中包括

```
 Public Class mycontrol
 Inherits System.Web.UI.UserControl
 Implements Icontrol 
```

它使这个属性成为必需的

# javascript - 有没有办法通过 AJAX 从客户端 JavaScript 代码调用服务器端 Groovy 对象方法？

> ID：554406
> 
> 赞同：1
> 
> 时间：2009-02-16T20:11:59.660
> 
> 标签：javascript, ajax, grails, groovy, rpc

有[DWR](http://directwebremoting.org/)可以满足我在 Java 中的需求。如果有任何 Groovier 方式来做同样的事情，我很感兴趣 - 使用约定优于配置、动态方法调用等。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-16T22:55:42.950

我认为目前没有这样的框架。同时，您可以尝试将 Groovy 对象与 DWR 一起使用。

或者如果你打算使用 Grails，你可以看看 Grails DWR 插件： http: [//grails.org/DWR+Plugin](http://grails.org/DWR+Plugin)

这是 DWR 3 的非官方更新：http: [//www.nabble.com/Updated-DWR-Plugin-for-DWR-3-td21421849.html](http://www.nabble.com/Updated-DWR-Plugin-for-DWR-3-td21421849.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T00:22:22.397

我建议研究[Grails](http://grails.org)。内容协商功能可用于从 grails 控制器以不同格式（xml、json 等）返回 Groovy 对象，您可以在客户端使用 JSON。它实际上只需要从 grails 控制器中获取几行代码即可返回对象的 HTML、JSON 和 XML 表示形式。

# c# - 为什么 Application.Exit 无法工作？

> ID：554408
> 
> 赞同：28
> 
> 时间：2009-02-16T20:12:42.967
> 
> 标签：c#, .net, winforms

我有一个应用程序在取消对话框时出现奇怪的错误。如果该框被取消，应用程序将无法继续，因此它会退出，但由于某种原因它无法正常工作，因此它会继续运行并崩溃。

我调试了这个问题，不知何故，应用程序运行在 Application.Exit 调用之后。我在调试模式下运行，这是相关的，因为少量代码取决于定义的 RELEASE 变量。这是我的应用退出代码。我跟踪了代码，它进入了 ExitApp 方法，并继续运行，将控制权返回给调用者并最终崩溃。

这是一个通过远程桌面连接提供报告的应用程序，这就是退出代码有点奇怪的原因。它试图终止远程会话，但仅在发布时运行，因为我不想在每次测试运行时关闭我的开发机器。

```
 private void ExitApp()
    {
        HardTerminalExit();
        Application.Exit();
    }

    // When in Debug mode running on a development computer, this will not run to avoid shutting down the dev computer
    // When in release mode the Remote Connection or other computer this is run on will be shut down.
    [Conditional("RELEASE")]
    private void HardTerminalExit()
    {
        WTSLogoffSession(WTS_CURRENT_SERVER_HANDLE, WTS_CURRENT_SESSION, false);
    } 
```

我已经在 Application.Exit 行之后运行了一个调试器，但没有任何反应，然后在我越过该行后控制权返回给调用者。

这是怎么回事？这是一个 Windows 窗体应用程序。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-02-16T20:22:25.923

这是一篇文章，它扩展了您正在经历的同一思路：http: [//www.dev102.com/2008/06/24/how-do-you-exit-your-net-application/](http://www.dev102.com/2008/06/24/how-do-you-exit-your-net-application/)

基本上：

> *   Environment.Exit - 来自 MSDN：终止此进程并为底层操作系统提供指定的退出代码。这是您使用控制台应用程序时要调用的代码。
>     
>     
> *   Application.Exit - 来自 MSDN：通知所有消息泵它们必须终止，然后在处理完消息后关闭所有应用程序窗口。如果您已调用 Application.Run（WinForms 应用程序），这是要使用的代码，此方法会停止所有线程上所有正在运行的消息循环并关闭应用程序的所有窗口。此方法还有一些问题，请在 MSDN 页面中阅读。

对此的另一个讨论：http: [//geekswithblogs.net/mtreadwell/archive/2004/06/06/6123.aspx](http://geekswithblogs.net/mtreadwell/archive/2004/06/06/6123.aspx)

这篇文章指出了一个很好的提示：

您可以通过检查 System.Windows.Forms.Application.MessageLoop 属性来确定是否调用了 System.Windows.Forms.Application.Run。如果为真，则 Run 已被调用，您可以假设 WinForms 应用程序正在执行如下。

```
if (System.Windows.Forms.Application.MessageLoop)
{
  // Use this since we are a WinForms app
  System.Windows.Forms.Application.Exit();
}
else
{
  // Use this since we are a console app
  System.Environment.Exit(1);
} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-11-15T06:18:38.733

最近遇到了这个问题（Application.Exit 未能正确终止带有 Application.Run(new Form()) 的 win-forms 的消息泵），我发现如果您在构造函数中生成新线程或启动后台工作程序，这将阻止 Application.Exit 运行。

将所有 'RunWorkerAsync' 调用从构造函数移至表单 Load 方法：

```
public Form()
{
  this.Worker.RunWorkerAsync();
} 
```

搬去：

```
public void Form_Load(object sender, EventArgs e)
{
  this.Worker.RunWorkerAsync();
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-16T20:21:16.503

试试`Environment.Exit(exitCode)`。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-10-23T12:24:55.257

我在很多情况下都经历过这种情况，我使用 Thread.CurrentThread.Abort()

并且该过程已关闭。似乎 Application.Exit 没有与当前线程正确连接。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-10-23T12:29:10.817

还要确保应用程序中运行的所有线程都将 IsBackground 属性设置为 true。非后台线程很容易阻止应用程序退出。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-01-05T17:51:05.853

确保你没有 Console.ReadLine(); 在您的应用和 Environment.Exit(1) 中；将工作并关闭您的应用程序。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2021-01-12T21:03:35.120

我创建了以下内容，它将在任何地方退出应用程序。您不必担心表单是否正在运行，测试会确定并调用适当的退出。

```
 public void exit(int exitCode)
    {
        if (System.Windows.Forms.Application.MessageLoop)
        {
            // Use this since we are a WinForms app
            System.Windows.Forms.Application.Exit()
        }
        else
        {
            // Use this since we are a console app
            System.Environment.Exit(exitCode);
        }
    } //* end exit() 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-16T20:17:36.603

此应用程序是否使用（在`Main`方法中）运行`Application.Run()`？否则，`Application.Exit()`将无法正常工作。

如果您编写了自己的`Main`方法并且想要停止应用程序，则只能通过从`Main`方法返回（或终止进程）来停止。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-11-09T05:28:51.243

试试这个 ：

在 Program.cs 文件中：

在 **Application.Run(new form()) 之后；**

添加**Application.Exit();**

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2021-10-08T16:58:01.737

```
 private void frmLogin_FormClosing(object sender, FormClosingEventArgs e)
    {

        if (e.CloseReason == CloseReason.UserClosing)
        {
            DialogResult result = MessageBox.Show("Do you really want to exit?", "Dialog Title", MessageBoxButtons.YesNo);
            if (result == DialogResult.Yes)
            {
                Environment.Exit(0);
            }
            else
            {
                e.Cancel = true;
            }
        }
        else
        {
            e.Cancel = true;
        }

    } 
```

# objective-c - 整数常量“不会减少为整数”

> ID：554419
> 
> 赞同：17
> 
> 时间：2009-02-16T20:18:30.330
> 
> 标签：objective-c

我使用此代码来设置我的常量

```
// Constants.h
extern NSInteger const KNameIndex;

// Constants.m
NSInteger const KNameIndex = 0; 
```

在导入 Constant.h 文件的文件中的 switch 语句中，我有这个：

```
switch (self.sectionFromParentTable) {
    case KNameIndex:
        self.types = self.facilityTypes;
        break;
    ... 
```

我在编译时收到错误消息：“错误：case 标签不会减少为整数常量”

有什么想法可能会搞砸吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-16T20:36:03.080

对于 C/C++ 和 Objective-C，case 语句必须在编译时具有固定值 - “减少为整数*（读取值） ”*

你的常量不是一个真正的“常量”，因为它是一个变量，我想它可以通过一个指针来改变——即`&KNameIndex`

通常将常量定义为`enum`

```
enum {
    KNameIndex = 0,
    kAnotherConstant = 42
}; 
```

如果您使用 C++ 或 Objective-C++（以 .mm 作为文件扩展名），您可以使用 const 语句作为

```
const int KNameIndex = 0; 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2010-08-04T09:48:46.523

您可以使用

```
#define KNameIndex 0

...

switch (self.sectionFromParentTable) {
        case KNameIndex:
                self.types = self.facilityTypes;
                break;
        ... 
```

它应该可以工作。

只是遇到了同样的问题，我决定使用#define 而不是枚举。为我工作™ ;-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-16T20:34:01.057

这是在黑暗中刺伤，因为我已经很长时间没有使用 Cocoa / ObjC 了，但是成员变量 sectionFromParentTable 不是 int 类型吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-16T22:04:28.250

我没有使用过Objective C，但我会尝试使用'extern'。至少如果这是 C++，该`Constants.m`文件将不是 的编译单元的一部分，因此编译器将不知道`Other.m`的值。`KNameIndex`这可以解释错误；一个不可知的值不能是一个常数。

将定义而不只是声明放在`Constants.h`文件中是否有帮助？

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-02-16T20:33:40.327

我认为你坚持使用 a`const int`而不是`const NSInteger`as 开关只适用于内置的整数类型。（不确定你的语法在类型之后翻转了 const ）。

看看相关的问题：[Objective-C switch using objects？](https://stackoverflow.com/questions/104339/objective-c-switch-using-objects)

# c# - 如何创建深度克隆用户控件的方法

> ID：554422
> 
> 赞同：0
> 
> 时间：2009-02-16T20:19:48.190
> 
> 标签：c#

我想在我的程序中创建一个用户控件的深层克隆。这是怎么做的。谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-16T20:23:56.013

如果你使用`MemberwiseClone()`你会得到一个浅拷贝，这可能不是你想要的，因为它不是真正的“副本”。如果您不介意`UserControls`对子对象的两个共享引用，那么`MemberwiseClone()`应该这样做。否则，您将不得不编写自己的实现来支持您的要求。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T20:30:45.153

安德鲁是正确的。如果要进行深度克隆，则需要向用户控件添加一个返回深度克隆的方法。

这很烦人，因为您需要在用户控件中的每个引用类型上调用此 Deep Clone 方法等等。

IClonable 接口本应促进这种模式，但它完全被搞砸了，基本上没用。

# visual-studio-2008 - VSTS 2008 测试版中的数据驱动验证规则

> ID：554425
> 
> 赞同：0
> 
> 时间：2009-02-16T20:21:22.587
> 
> 标签：visual-studio-2008, testing, mstest

我们正在使用 VSTS 2008 对我们正在开发的 Web 应用程序执行一些相对简单的 Web 测试。我们定义了数据源以向测试提供输入数据，并且还希望基于此数据源执行我们的验证。我遇到的问题是 VS GUI 不允许我将验证规则中的值绑定到数据源。

我发现了如何将测试转换为代码，然后更新代码以引用数据源中的相应列：

```
validationRule.FindText = this.Context["UsersDataSource.Users#csv.?UserName"].ToString(); 
```

但是，如果不将其转换为代码，我似乎找不到将其输入任何内置验证器的属性/值字段的正确语法。有没有人设法做到这一点，或者我必须总是将网络测试转换为代码来实现这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-17T19:50:50.740

更多分析表明，没有办法通过 VS GUI 执行此操作。可以通过将测试转换为代码，并更新代码以使用数据源来实现：

```
validationRule.FindText = this.Context["UsersDataSource.Users#csv.?UserName"].ToString(); 
```

也许在未来的版本中，这将通过 GUI 实现。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-10T13:21:59.577

可以*通过*GUI 来完成，尽管无可否认，修复与手动编辑代码几乎相同。如果您手动将数据库引用插入验证响应字段，结果将是您想要的。这种方法简单地省去了必须在源代码中查找要修改的行的麻烦，这取决于用户的经验水平，这会让一些人不太舒服。我与一组测试人员一起工作，他们虽然有技术倾向，但尽可能避免直接修改源代码。

前任。对于简单的“查找文本”验证类型 {{boundname.database.column}}

# objective-c - Objective-C 2.0 和快速枚举抛出异常

> ID：554430
> 
> 赞同：5
> 
> 时间：2009-02-16T20:22:32.740
> 
> 标签：objective-c, cocoa, cocoa-touch, enumeration

我有一个类似于以下的代码块：

```
for (NSDictionary *tmp in aCollection) {
   if ([[bar valueForKey:@"id"] isEqualToString:[tmp valueForKey:@"id"]])
   {
      break;
   }
   else
   {
      [aCollection addObject:bar];
       }
 } 
```

这在技术上是 Objective-C 2.0 中的一个例外吗？看来您无法通过快速枚举来改变集合。这是错误的结果：

```
*** Terminating app due to uncaught exception 'NSGenericException', reason: '*** Collection <NSCFArray: 0x396000> was mutated while being enumerated.' 
```

解决这个问题的最佳方法是什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-16T20:34:12.167

那么解决它的方法是在枚举它时不要改变数组（例如添加一个对象）:)

这里的问题是通过添加/删除元素来修改数组可能会导致枚举值变得无效，因此这是一个问题。

在您的情况下，解决此问题的最简单方法是修复代码中的错误。您的代码正在为数组中的每个项目执行“else add”子句，我很确定这不是您想要的。

尝试这个;

```
bool found = false;
for (NSDictionary *tmp in aCollection)
{
   if ([[bar valueForKey:@"id"] isEqualToString:[tmp valueForKey:@"id"]])
   {
      found = true;
      break;
   }
}

if (!found)
{
 [aCollection addObject:bar];
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-16T20:33:53.790

制作集合的副本并对其进行迭代。然后，您可以毫无问题地换出或添加到您的原始收藏中。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-16T20:34:37.687

线

```
[aCollection addObject:bar] 
```

是你的问题。`aCollection`枚举时不能修改。更好的方法是创建一个临时的`NSMutableArray`，添加`bar`到那个，然后`[aCollection addObjectsFromArray:]`用你的临时数组调用。

例如：

```
NSMutableArray *foundObjects = [NSMutableArray array];
for (NSDictionary *aDictionary in aCollection) {
    if ([[bar objectForKey:@"id"] isEqual:[aDictionary objectForKey:@"id"]])
       break;

    [foundObjects addObject:bar];
}
[aCollection addObjectsFromArray:foundObjects]; 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-16T20:33:28.627

在[Objective-C 2.0 Programming Language](http://developer.apple.com/documentation/Cocoa/Conceptual/ObjectiveC/Articles/chapter_8_section_2.html#//apple_ref/doc/uid/TP30001163-CH18-SW3)中，您不能修改被枚举的集合：

> 枚举是“安全的”——枚举器有一个突变保护，因此如果您在枚举期间尝试修改集合，则会引发异常。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-11-19T23:57:11.260

只需复制数组。否则你会弄乱你正在迭代的集合：

```
for (NSDictionary *tmp in aCollection.copy) {
  if ([[bar valueForKey:@"id"] isEqualToString:[tmp valueForKey:@"id"]])
     break;
  [aCollection addObject:bar];
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-01-27T04:21:28.337

其他人都提供了有用的答案，所有这些似乎都是正确的。

然而，你的代码并没有像他们认为的那样做。它可能也不会像您认为的那样做。

如果枚举器返回的第一个对象与 bar 不匹配，则尝试将“bar”添加到集合中。

如果集合中根本不存在 bar，每个人都认为您正在尝试添加 bar。

我怀疑您采用了 Python 构造并错误地移植了它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-02-25T13:56:55.570

**解决了**

我在 coredata 对象枚举中有同样的问题。

不要更改依赖于循环正在运行的 ARRAY 的子对象

就像，如果我在循环中更改/修改对象..它会给出这个错误

```
 for (LoadList *objLL in ArrLoadList) {             // here Enumaration is Going on
        // here i has removed objects in ArrLoadList and reassign the ArrLoadList .. 
        // it will gives me this error 
        // So Don't change the Main Array object 
 } 
```

# asp.net - 使用 FormsAuthentication 的跨域 Cookie

> ID：554436
> 
> 赞同：10
> 
> 时间：2009-02-16T20:24:30.300
> 
> 标签：asp.net, cookies, asp.net-membership, forms-authentication, cross-domain

我知道相关的安全风险并已将其与业务联系起来，但他们希望让他们的 5 个域共享登录 cookie。

我们正在使用并且没有计划停止使用 ASP.Net Membership and Profiles。这可能吗？一个黑客甚至会不胜感激。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-16T20:52:17.940

开箱即用的 ASP.NET 是不可能的。

基于表单的身份验证基于 cookie，cookie 只能设置到特定域。

如果您想要真正的跨域（而不是子域）共享身份验证，则需要单点登录解决方案。

我已经推出了自己的，它相对简单。基本原则是您有一个主域来保存您的身份验证 cookie（票证）。然后，您从所有其他域重定向到该域。它不是很漂亮，但是 Microsoft Passport 就是这样工作的。

你可以在网上找到很多例子，看看这两个链接：

[身份验证 cookie](http://www.codeproject.com/KB/aspnet/SingleSignon.aspx)

[跨域认证](http://aspalliance.com/1513_Cross_Site_Authentication_and_Data_Transfer.all)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-04-20T02:28:18.817

您可以将所有这些域设置为您公司的子域：

```
www.company.com
shop.company.com
sales.company.com
research.company.com
.. 
```

然后您将能够将 cookie 设置为父域，并且它将对所有子域可见。

```
var cookie = new HttpCookie(FormsAuthentication.FormsCookieName, encTicket);
cookie.Domain = ".company.com";
Repsonse.Cookies.Add(cookie); 
```

问候， Max Chernyshov [http://prontocoder.com](http://prontocoder.com)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-16T20:56:38.447

不仅使用 ASP.Net 是不可能的，而且根本不可能。Cookie 始终是特定于域的 - 没有任何商业浏览器可以以任何其他方式工作。这是设计使然，对于防止广泛滥用 cookie 非常必要。Muerte 为您指明了正确的方向（单点登录）。

# mysql - wordpress 的自定义 mysql 选择语句

> ID：554439
> 
> 赞同：3
> 
> 时间：2009-02-16T20:26:01.920
> 
> 标签：mysql, wordpress

我已经为我一直在工作的一个网站开发了一个分类法，该网站可能滥用了 wordpress 的分类系统——帖子被分类在它们所指的主题（比如猫、狗、猴子）以及什么类型的发布它（例如，专家、组织、文章）。所以我想找到所有关于猫和狗以及组织的帖子。类似于 IN（猫、狗）和 IN（组织）的东西......至少对我来说这很有意义，但我无法为该任务找出正确的 SQL 语法。

根据我[在 wordpress.com 上的这篇文章中](http://codex.wordpress.org/Displaying_Posts_Using_a_Custom_Select_Query)找到的内容，我正在从下面的查询中构建......但我不确定如何说“我想要属于的东西（类别 1 或2）和（属于第 3 类）（例如，猫 1=猫，2=狗，3=组织）。

这可能真的很简单，当我得到回应时，我会踢自己。

```
SELECT * FROM $wpdb->posts
LEFT JOIN $wpdb->postmeta ON($wpdb->posts.ID = $wpdb->postmeta.post_id)
LEFT JOIN $wpdb->term_relationships ON($wpdb->posts.ID = $wpdb->term_relationships.object_id)
LEFT JOIN $wpdb->term_taxonomy ON($wpdb->term_relationships.term_taxonomy_id = $wpdb->term_taxonomy.term_taxonomy_id)
WHERE $wpdb->term_taxonomy.term_id = 1,2,3
AND $wpdb->term_taxonomy.taxonomy = 'category'
AND $wpdb->posts.post_status = 'publish'
ORDER BY $wpdb->postmeta.meta_value ASC 
```

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-16T20:58:38.720

由于这两个条件存在于表的不同行上`term_taxonomy`，因此您必须连接到该表两次才能在结果集中的一行中比较它们。

此外，我认为您不需要使用 LEFT JOIN，因为您在 WHERE 子句中使用了条件。外连接的执行速度通常比内连接慢。

您可以使用表别名，因此您不必不断重复变量表名称。

所以我没有对此进行测试，但以下应该更接近您的需要：

```
SELECT * FROM $wpdb->posts p
 INNER JOIN $wpdb->postmeta m ON (p.ID = m.post_id)
 INNER JOIN $wpdb->term_relationships r1 ON (p.ID = r1.object_id)
 INNER JOIN $wpdb->term_taxonomy x1
  ON (r1.term_taxonomy_id = x1.term_taxonomy_id)
 INNER JOIN $wpdb->term_relationships r2 ON (p.ID = r2.object_id)
 INNER JOIN $wpdb->term_taxonomy x2
  ON (r2.term_taxonomy_id = x2.term_taxonomy_id)
WHERE x1.term_id IN (1, 2) AND x1.taxonomy = 'category'
 AND x2.term_id = 3 AND x2.taxonomy = 'category'
 AND p.post_status = 'publish'
ORDER BY m.meta_value ASC 
```

# entity-framework - 实体框架中与代理键的多对多关系

> ID：554440
> 
> 赞同：1
> 
> 时间：2009-02-16T20:26:25.023
> 
> 标签：entity-framework, many-to-many, surrogate-key

Entity Framework 神奇地将下表结构解释为多对多关系。

```
table foo (int id)
table foo_bar (int foo_id, int bar_id)
table bar (int id) 
```

但是如果连接表有任何附加字段，它将被解释为两个一对多的关系。

我正在使用一个数据库，其中连接表有一个代理键作为主键。因此，EF 将其解释为两个一对多的关系。

```
table foo (int id)
table foo_bar (int surrogate_pk, int foo_id, int bar_id)
table bar (int id) 
```

是否可以修改 EF:s 解释以使其成为模型中实际的多对多关系？可以使用设计器完成吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-01-04T20:15:59.253

这是可能的，但它需要在 EDMX 文件中进行大量手动工作，而且我无法让 EF 使用代理键作为链接表上的实际主键。您必须让 EF 使用 foo_id 和 bar_id 的组合键作为主键。

在您的存储模型中，您必须将链接表的 EntityType 从

```
<EntityType Name="foo_bar">
    <Key>
        <PropertyRef Name="surrogate_pk" />
    </Key>
    <Property Name="surrogate_pk" Type="bigint" Nullable="false" StoreGeneratedPattern="Identity" />
    <Property Name="foo_id" Type="int" Nullable="false" StoreGeneratedPattern="None" />
    <Property Name="bar_id" Type="int" Nullable="false" StoreGeneratedPattern="None" />
</EntityType> 
```

到：

```
<EntityType Name="foo_bar">
    <Key>
        <PropertyRef Name="foo_id" />
        <PropertyRef Name="bar_id" />
    </Key>
    <Property Name="foo_id" Type="int" Nullable="false" StoreGeneratedPattern="None" />
    <Property Name="bar_id" Type="int" Nullable="false" StoreGeneratedPattern="None" />
</EntityType> 
```

因此，您使代理键对 EF 不可见，并告诉它使用两个外键的组合作为主键。

在您的概念模型中，您需要定义多对多关联：

```
<Association Name="foo_bar_association">
    <End Role="foo" Type="foo" Multiplicity="*" />
    <End Role="bar" Type="bar" Multiplicity="*" />
</Association> 
```

在您的映射中，AssociationSetMapping：

```
<AssociationSetMapping Name="foo_bar_association" TypeName="foo_bar_association" StoreEntitySet="foo_bar">
    <EndProperty Name="foo">
        <ScalarProperty Name="id" ColumnName="foo_id" />
    </EndProperty>
    <EndProperty Name="bar">
        <ScalarProperty Name="id" ColumnName="bar_id" />
    </EndProperty>
</AssociationSetMapping> 
```

到目前为止，最简单的方法是从数据库中删除代理键，生成 EDMX，然后将此模型放在原始数据库中。结果将是相同的。EF 并不需要任何东西的代理键，该表在多对多关联中是不可见的

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T20:47:47.280

我很肯定这不能使用设计器来完成。我不知道是否有办法在 EDMX 中手动执行此操作，但我从未见过它的示例。一种可能的解决方法可能是根本不映射代理键。如果您可以在数据库上生成它，那么您的模型中可能不需要它。

# web - 为什么登录字段大多是右对齐的？

> ID：554445
> 
> 赞同：4
> 
> 时间：2009-02-16T20:29:28.683
> 
> 标签：web, user-interface

> 大多数需要您登录的流行网站在页面右侧都有身份验证表单。或多或少。作为一个惯用右手的人，我发现它看起来非常直观并且使用起来很方便——我不必扭伤脖子或移动鼠标太多来选择用户名字段（尽管最近，大多数页面都这样做默认情况下，加载完成后立即执行）。我不是无所不知，我想知道一个左撇子会如何对相同的 UI 做出反应。这就引出了一个问题：这不应该是为左撇子翻转表单的网站设计目标的一部分吗？另外，我想您使用哪种语言进行交互很重要。对于像英语这样从左到右阅读的语言，将表格放在右边可能更有意义。

使用不同的身份验证表单布局查看一些示例：

> Facebook、Gmail、Y！ **右**
> 流行语 **中心**
> SOF **左**

随意分享您的 0.02 美元。**我也很想知道实际研究是否涉及到这一点。**

**更新：（02/20）**那里有一些优秀的帖子。总结的好时机：

**到目前为止的故事：**

*   大多数网页在机动性方面都是静态的。

*   用户几乎没有/没有选择如何提供内容的选择。

*   英语作为互联网的通用语，随着时间的推移，网站最终使用英语从左到右的阅读顺序作为*顺序*。这符合 UI 设计指南。

*   在使用此类网站时，左撇子会让您感到不安（也许不是一般规则，但人们遇到过问题）

*   用户倾向于改变习惯而不是抱怨。

***澄清：**你们中的一些人似乎误解了我提到的鼠标操作。它应该作为一个例子，我认为如果事情不是这样，我需要时间来适应。干杯!*

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-16T20:36:49.570

我是左撇子。更重要的是，我是我所知道的唯一一个在左侧使用鼠标并交换按钮的人（所以“主”按钮是我的索引）。但我不明白为什么你认为屏幕上的任何东西都应该“为了我们的利益”而移动。

我通过着迷的观察发现了一件事情（我在 13 岁的时候就这个问题进行了第一次半正式的民意调查），其他左撇子的习惯是，我们之间的多样性比右撇子的要多得多。所以，如果你想做一些“多手”人体工程学，你不应该假设任何东西，只允许最大的灵活性。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-16T20:35:06.343

我认为这与自然无关。至少现在没有了。不管最初的原因是什么，它现在都是自我延续的。大多数网站的页面右侧都有登录表单。因此，如果您的目标是“不要让我思考”，您应该将登录表单放在页面的右侧......

...从而增加在页面右侧具有登录表单的站点数量以及将登录表单放在页面右侧的建议强度，这样您的用户就不会拥有想...

......因此增加......你明白了。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-16T20:35:10.137

我猜想把它放在右上角的原因是它在页面上是一件很重要的事情，但不如页面/网站的标题那么重要，而且它位于左上角. 这都是关于阅读顺序的。

我怀疑惯用右手或惯用左手有什么区别。你的手和脖子使用独立的肌肉群。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-17T20:15:31.593

UI 设计 101 要求您使用客户的自然阅读顺序来定位用户界面（桌面应用程序、网页等）的控件。对于英语用户，这将需要从左到右、从上到下的方法。也就是说，最重要的信息应该在左上角，最不重要的信息应该在右下角。

各种网站将其登录控件放在不同位置的原因与其是否符合某些行业标准有关，而是与网站设计者认为最重要的信息有关。

以 Gmail 为例。谷歌更关心向新用户宣传他们的各种产品（Gmail、网络历史记录、iGoogle 等），而不是你登录。因此，他们在大多数用户首先看到的位置（左上角）宣传他们的产品角落。如果您已经拥有一个帐户，则立即跳过此步骤并在右侧输入您的登录凭据。请记住，一旦您登录，您就再也不会看到这个屏幕了。通过这种方法，谷歌显然是在尝试适应新用户，而不是现有用户。从商业角度来看，这是有道理的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-17T20:06:39.070

你可能会觉得[这个页面](http://www.onlinecontentguide.co.uk/written-content/page-layout-size.html)很有趣。

“作为网站的所有者，您希望人们能够轻松使用您的网站并快速访问内容 - 这是您的最终目标。在菜单和内容的定位方面与其他网站保持一致将有助于您的访问者，给他们"

将登录框放在右侧还可以让已登录和未登录的人保持左侧导航栏相同。有关示例，请参见 ING Direct 的网站。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-20T22:29:34.383

我发现Joel 的[这篇文章](http://www.joelonsoftware.com/uibook/chapters/fog0000000061.html)很有启发性。为了避免困惑和沮丧而与您所在领域的领导者保持一致的部分特别适用于您的问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-06T19:48:41.270

我是左撇子，但我用右手使用鼠标，一直都是……现在我用左手使用鼠标时感觉很尴尬。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-16T20:41:35.017

我以前从来没有真正想过这个……很有趣。我认为这与从左到右的语言世界的组织有关。

由于大多数语言都是从左到右移动的，因此让网站从左到右扩展是有意义的。同样，如果您需要扩展菜单，则从左到右扩展菜单是有意义的。但是，用户链接（例如登录名、个人资料等）通常是静态的。如果您想让它们不影响导航的其余部分，最好将它们放在页面的另一个角落 - 因此是右边的角落，而不是左边。

编辑：对不起，我想我将您的问题误解为“为什么右上角的登录链接”而不是“为什么页面右侧的整个表单”。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-16T21:01:54.830

我不是设计专家，但我对这个主题有自己的看法。

右边有对齐的主要原因应该与阅读方式有关。大多数现有语言。大多数人不关心少数人，他们只关心大多数人。

> 不是无所不知，我想知道左撇子会如何对相同的 UI 做出反应

我认为这对任何人都不重要。但我不是谈论这个的合适人选......我用右手写：S

为了一个更美好的世界，所有公司都开始担心这个问题会很棒：D

* * *

## 决定你命运的是选择，而不是机会。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-17T19:36:33.230

我不明白你用哪只手使用鼠标有多重要（FWIW，我是右手，但用左手使用鼠标）。

您使用哪只手不会改变光标在屏幕上的位置，因此您不必用一只手比另一只手进一步移动它。距离是相同的 - 即距离您最后点击的内容有多远。

# python - 如何防止 Python 的 urllib(2) 跟随重定向

> ID：554446
> 
> 赞同：47
> 
> 时间：2009-02-16T20:29:30.117
> 
> 标签：python, urllib2

我目前正在尝试使用 Python 登录一个站点，但是该站点似乎在同一页面上发送了一个 cookie 和一个重定向语句。Python 似乎遵循该重定向，因此阻止我读取登录页面发送的 cookie。如何防止 Python 的 urllib（或 urllib2）urlopen 跟随重定向？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-02-16T21:13:43.600

你可以做几件事：

1.  构建自己的 HTTPRedirectHandler 来拦截每个重定向
2.  创建 HTTPCookieProcessor 的实例并安装该开启程序，以便您可以访问 cookiejar。

This is a quick little thing that shows both

```
import urllib2

#redirect_handler = urllib2.HTTPRedirectHandler()

class MyHTTPRedirectHandler(urllib2.HTTPRedirectHandler):
    def http_error_302(self, req, fp, code, msg, headers):
        print "Cookie Manip Right Here"
        return urllib2.HTTPRedirectHandler.http_error_302(self, req, fp, code, msg, headers)

    http_error_301 = http_error_303 = http_error_307 = http_error_302

cookieprocessor = urllib2.HTTPCookieProcessor()

opener = urllib2.build_opener(MyHTTPRedirectHandler, cookieprocessor)
urllib2.install_opener(opener)

response =urllib2.urlopen("WHEREEVER")
print response.read()

print cookieprocessor.cookiejar 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2012-07-31T16:33:51.010

If all you need is stopping redirection, then there is a simple way to do it. For example I only want to get cookies and for a better performance I don't want to be redirected to any other page. Also I hope the code is kept as 3xx. let's use 302 for instance.

```
class MyHTTPErrorProcessor(urllib2.HTTPErrorProcessor):

    def http_response(self, request, response):
        code, msg, hdrs = response.code, response.msg, response.info()

        # only add this line to stop 302 redirection.
        if code == 302: return response

        if not (200 <= code < 300):
            response = self.parent.error(
                'http', request, response, code, msg, hdrs)
        return response

    https_response = http_response

cj = cookielib.CookieJar()
opener = urllib2.build_opener(urllib2.HTTPCookieProcessor(cj), MyHTTPErrorProcessor) 
```

In this way, you don't even need to go into urllib2.HTTPRedirectHandler.http_error_302()

**Yet more common case is that we simply want to stop redirection (as required):**

```
class NoRedirection(urllib2.HTTPErrorProcessor):

    def http_response(self, request, response):
        return response

    https_response = http_response 
```

And normally use it this way:

```
cj = cookielib.CookieJar()
opener = urllib2.build_opener(NoRedirection, urllib2.HTTPCookieProcessor(cj))
data = {}
response = opener.open('http://www.example.com', urllib.urlencode(data))
if response.code == 302:
    redirection_target = response.headers['Location'] 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-02-16T20:38:43.980

`urllib2.urlopen``build_opener()`使用此处理程序类列表的调用：

```
handlers = [ProxyHandler, UnknownHandler, HTTPHandler,
HTTPDefaultErrorHandler, HTTPRedirectHandler,
FTPHandler, FileHandler, HTTPErrorProcessor] 
```

您可以尝试`urllib2.build_opener(handlers)`使用省略的列表调用自己`HTTPRedirectHandler`，然后调用`open()`结果上的方法以打开您的 URL。如果你真的不喜欢重定向，你甚至可以调用`urllib2.install_opener(opener)`你自己的非重定向开启器。

听起来你真正的问题是`urllib2`没有按照你想要的方式做 cookie。另请参阅[如何使用 Python 登录网页并检索 cookie 以供以后使用？](https://stackoverflow.com/questions/189555/how-to-use-python-to-login-to-a-webpage-and-retrieve-cookies-for-later-usage)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-16T20:46:59.640

这个问题之前在[这里](https://stackoverflow.com/questions/110498/is-there-an-easy-way-to-request-a-url-in-python-and-not-follow-redirects/110808)被问过。

**编辑：**如果您必须处理古怪的 Web 应用程序，您可能应该尝试[mechanize](http://wwwsearch.sourceforge.net/mechanize/)。这是一个很棒的库，可以模拟 Web 浏览器。您可以控制重定向、cookie、页面刷新……如果网站不[严重] 依赖 JavaScript，您将与 mechanize 相处得很好。

# c# - 如何使用 asp.net mvc Html.DropDownList 帮助器将自定义项添加到下拉列表的顶部？

> ID：554453
> 
> 赞同：1
> 
> 时间：2009-02-16T20:33:03.137
> 
> 标签：c#, asp.net, jquery, asp.net-mvc

我的 asp.net mvc 站点上有一个下拉列表：

```
<%= Html.DropDownList("CustCodes") %> 
```

我的控制器：

```
 ICallService sc = new CallService();
 IList<CustCode> custCodes = sc.GetCustCodes();
 ViewData["CustCodes"] = new SelectList(custCodes, "ID", "Name"); 
```

我想要的是，一旦下拉列表显示在顶部有一个空白条目或显示“选择客户”的选项。我是否需要使用 jquery 来执行此操作，或者 DropDowList 帮助程序中是否有一些我缺少的东西？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-16T20:36:48.867

使用包含选项标签的覆盖。

```
 <%= Html.DropDownList("CustCodes",
                       ViewData["CustCodes"] as SelectList,
                       "Select a Customer",
                       null ) %> 
```

# version-control - 在另一个仓库中包含 DLL 的许可限制？

> ID：554468
> 
> 赞同：0
> 
> 时间：2009-02-16T20:35:46.453
> 
> 标签：version-control, dll, licensing

**回答**：

> 据推测，他们不允许对 2.6 进行任何形式的重新分发，除非您拥有它的许可证。但他们不出售许可证。但他们免费赠送。但是，谁知道呢，我认为他们只是想让我们购买价格过高的东西，我们不需要编写免费的实用程序。我想我会看看 NVelocity 或 TaHoGen ......

我担心放置一些与项目一起使用的 DLL，这些 DLL 也是免费的（在 SF.net 上），但还没有与之关联的特定许可证。这有点合法，但希望不是太多，以至于无法通过经验来回答。这里有很多这样的:)

**我认为问题出在 CodeSmith 2.6**上，因为它们有自己的“自定义”eula。要查看“sourcelicense.txt”，您需要下载 zip 并打开它，但我已将相关部分复制到帖子中（抱歉，它们太长了！）

*编辑：*

> 该应用程序使用 CodeSmith 2.6 dll 以及一组自定义模板来生成类文件/等。我们不需要 codesmith 源，只需要编译结果。当然，这些 dll 将与 .exe 中的应用程序一起分发。问题是，将它们塞入 repo 是否与将它们放入 .msi/.exe 安装程序有某种不同（或在法律上更成问题）。
> 
> 我将就此与 codesmith 联系，但我希望比现在有更好的理解，仅此而已。它们目前不在 repo 中，但如果它们在，它将简化开发过程。 *结束编辑*

*   1 个 MIT 许可组件（似乎不是问题）
*   Mysql.Data.dll（不确定许可证）
*   [CodeSmith 2.6 免费软件](http://www.codesmithtools.com/freeware.aspx)DLLS
    *   编译成DLL形式
    *   SchemaExplorer.dll / 等
    *   CodeSmith.Engine.dll

我希望能够使项目自托管，而不是让用户四处走动，下载和/或编译源代码的副本（特别是如果他们找到了较新的版本或较旧的版本，这很容易发生在MIT/msql 组件。）

如果不能包含 DLL，将会有很好的说明，但如果可以，生活会变得*无限*简单，而且如果其中一个突然被拉出，项目就不会“死”。

* * *

源代码许可证（*来自 CodeSmith 2.6 eula/sourcelicense.txt）*

源代码受美国版权法和国际版权条约以及其他知识产权法律和条约的保护。源代码已获得许可，而非出售。

1.  授予许可。本 EULA 授予您以下权利：

    1.  源代码。您可以在单台计算机上安装和编译一份源代码。安装源代码的计算机的主要用户可以制作第二份副本，供他或她在便携式计算机上专用。
    2.  存储/网络使用。您还可以在存储设备（例如网络服务器）上存储或安装源代码的副本，仅用于通过内部网络在您的其他计算机上安装或编译源代码；但是，您必须为从存储设备安装或编​​译源代码的每台单独的计算机获取并专用许可证。源代码的许可证不得在不同的计算机上共享或同时使用。
    3.  使用和修改。SMITH 授予您使用和修改源代码以更好地满足您的需求的权利。您不得以任何形式分发源代码或源代码的任何修改版本。对源代码所做的任何修改将继续受本 EULA 的条款和条件的约束。源代码的任何修改版本只能由同时拥有源代码许可证的用户或拥有 CodeSmith Professional 许可证的用户以对象形式执行。
    4.  使用生成的输出。您可以以任何方式分发您的自定义模板或包含的模板的输出。
2.  其他权利和限制的描述。

    1.  组件分离。源代码作为单一产品获得许可。
    2.  重新分配。不得以任何方式重新分发源代码。
    3.  自定义模板分发。只有在免费提供的情况下，您才可以分发源代码的自定义模板。
    4.  没有出租。您不得使用源代码向第三方出租、租赁、出借或提供商业托管服务。
    5.  不可转让。本许可不得以任何方式转让或出售。
    6.  终止。在不损害任何其他权利的情况下，如果您未能遵守本 EULA 的条款和条件，SMITH 可以终止本 EULA。在这种情况下，您必须销毁源代码及其所有组成部分的所有副本。
3.  附加软件/服务。

    1.  支持服务。SMITH 可以但没有义务为您提供与源代码相关的支持服务。
    2.  补充剂。本 EULA 适用于 SOURCE CODE 的附加软件和更新，包括但不限于 SMITH 可能提供给您的补充、服务包、热修复或附加组件（统称为“补充”）获取源代码的初始副本，除非与此类补充一起提供了其他条款。
4.  版权。源代码的所有所有权和版权（包括但不限于任何图像、照片、动画、视频、音频、音乐、文本、示例代码和包含在源代码中的“小程序”）以及源代码的任何副本CODE 归 SMITH 所有。源代码受版权法和国际条约规定的保护。因此，您必须像对待任何其他受版权保护的材料一样对待源代码，但您可以安装源代码。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-16T21:36:11.750

我不熟悉 CodeSmith 的功能，也不知道您在用它做什么。显然，您不会重新分发源代码，但他们似乎并不关心您可能重新分发的内容。

有那个“使用生成的输出”条款；你打算只分发模板输出吗？你打算为这个项目更改他们的源代码吗？在不知道这些问题的答案的情况下，我无法为您提供建议。

你可以澄清你在做什么，或者问 CodeSmith。我不确定找到可以回答您的具体问题的律师是否容易，因为该许可证中有很多技术内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T21:59:07.080

第一：Stackoverflow 不是律师，不能提供法律意见。在这里保留任何法律信息，并询问律师是否重要。

嗯，这与自由软件许可证一点也不接近，所以我认为它不符合[sf.net](http://sourceforge.net "源锻造")规则。

它也不授予您任何重新分发的权限。事实上，它禁止它：

> 2.2 再分配。不得以任何方式重新分发源代码。

可能，您的 DLL 是“自定义模板”，在这种情况下，它必须免费分发，这违反了[开源定义的第 1 条](http://www.opensource.org/docs/definition.php)

> 自定义模板分发。只有在免费提供的情况下，您才可以分发源代码的自定义模板。

除此之外，你肯定需要澄清你在做什么。

# xml - XML 比较工具，可以“整理”XML 并忽略属性差异

> ID：554470
> 
> 赞同：0
> 
> 时间：2009-02-16T20:36:14.173
> 
> 标签：xml, comparison

我正在考虑使用**Beyond Compare 3**和*XML Tidy*比较比较格式。 如果 XML 文件全部放在一行上， *XML Tidy会使用***适当的换行符和缩进**格式化所有节点。...所以我想要一个可以做到这一点并且可以**忽略属性差异**的工具，甚至根本不显示属性（这是因为属性与我的用户无关）。

有没有可以做到这一点的工具？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T01:23:47.850

省略属性并将输出设置为缩进的 XSLT 标识转换应该可以工作：

```
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0">

<xsl:output indent="yes" />

<xsl:template match="/">
    <xsl:apply-templates />
</xsl:template>

<xsl:template match="node()">
    <xsl:copy>
        <xsl:apply-templates />
    </xsl:copy>
</xsl:template>

</xsl:stylesheet> 
```

# c++ - 这个包含可变大小数组的 C++ 类是否使用动态内存分配？

> ID：554476
> 
> 赞同：4
> 
> 时间：2009-02-16T20:39:17.193
> 
> 标签：c++, templates, memory-management

做这样的事情是否使用动态内存分配？

```
template <class T, int _size> 
class CArray 
{ 
public:
    ... 
private:
    T m_data[_size]; 
}; 
```

有人可以向我解释创建对象时幕后发生的事情吗？

```
CArray<SomeObject, 32> myStupidArray; 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-16T20:44:03.420

不，它将就地分配（例如，在堆栈上或作为包含对象的一部分）。

使用模板，参数在编译时进行评估，因此您的代码有效地变为；

```
class CArray 
{ 
public:
    ... 
private:
    SomeObject m_data[32]; 
}; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-16T21:12:17.533

如其他答案中所述，模板在编译时进行评估。如果您有兴趣，可以让 g++ 吐出类层次结构，您可以在其中验证其大小：

```
template <class T, int _size>
class CArray
{
public:
private:
  T m_data[_size];
};

int main(int argc, char **argv) {
  CArray<int, 32> myStupidArray1;
  CArray<int, 8> myStupidArray2;
  CArray<int, 64> myStupidArray3;
  CArray<int, 1000> myStupidArray4;
} 
```

编译`-fdump-class-hierarchy`：

```
g++ -fdump-class-hierarchy blah.cc 
```

`blah.cc.t01.class`当前目录中应该有一个名为的文件：

```
Class CArray<int, 32>
   size=128 align=4
   base size=128 base align=4
CArray<int, 32> (0x40be0d80) 0

Class CArray<int, 8>
   size=32 align=4
   base size=32 base align=4
CArray<int, 8> (0x40be0e80) 0

Class CArray<int, 64>
   size=256 align=4
   base size=256 base align=4
CArray<int, 64> (0x40be0f80) 0

Class CArray<int, 1000>
   size=4000 align=4
   base size=4000 base align=4
CArray<int, 1000> (0x40be6000) 0 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-16T20:42:39.587

[模板](http://www.cplusplus.com/doc/tutorial/templates.html)在编译时进行评估，因此 m_data[_size] 被编译为 m_data[32]。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-16T20:43:34.500

不，它不使用动态内存分配。编译器知道需要分配多少内存，它是在编译时决定的，而不是在运行时决定的。

在这里解释 C++ 模板没有任何意义，它们在其他页面上得到了很好的解释，比如在[C++ faq lite](http://www.parashift.com/c++-faq-lite/templates.html#faq-35.1)中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-16T20:44:51.220

数组的大小在编译时是已知的，所以不，这里不会使用动态内存分配。如果您在函数范围内声明数组，那么它将像任何其他类型的对象一样放入堆栈。

当您像这样定义可变大小的对象时，真正发生的是编译器正在构建一个“按顺序”定义的类。您将只使用其中包含“T m_data[32]”的类定义。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-16T20:45:24.807

1- 模板仅在编译时进行评估。所以这个数组的大小是 32

2-您不能使用变量在堆栈上创建数组，它必须是可以在编译时评估的常量，否则您可以使用 new（或 malloc）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-16T20:55:34.453

动态内存分配通常发生在您调用`new`运算符（或其朋友之一）时。这从通常称为堆的内存保留中分配一块内存。请记住，与静态分配不同，编译器不负责释放内存，因此您必须使用`delete`运算符（或其合适的版本）手动完成。

# javascript - 如何使用 XFBML.ProfilePic

> ID：554479
> 
> 赞同：0
> 
> 时间：2009-02-16T20:41:02.850
> 
> 标签：javascript, facebook, xfbml

我正在尝试使用 XFBML 显示 Facebook 用户的个人资料图片。我正在使用以下代码：

```
var container = document.getElementById("profilePicture");
var profilePic = new FB.XFBML.ProfilePic(container);
//profilePic.setAttribute("uid", userId);
FB.XFBML.Host.addElement(profilePic); 
```

如何设置元素的uid属性？（注释行不起作用）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-26T22:58:14.703

在将属性发送到 ProfilePic 进行处理之前设置属性：

```
var container = document.getElementById("profilePicture");
container.setAttribute("uid", userId);
var profilePic = new FB.XFBML.ProfilePic(container);
FB.XFBML.Host.addElement(profilePic); 
```

# java - 如何从 Hibernate Criteria API 获取 SQL（*not* 用于日志记录）

> ID：554481
> 
> 赞同：76
> 
> 时间：2009-02-16T20:41:30.103
> 
> 标签：java, sql, hibernate, criteria

有没有办法从 Hibernate 获取（要生成的）SQL `Criteria`？

理想情况下，我会有类似的东西：

```
Criteria criteria = session.createCriteria(Operator.class);

... build up the criteria ...
... and then do something like ...

String sql = criteria.toSql()

(But this of course does not exist) 
```

然后的想法是将SQL用作巨大的“MINUS”查询的一部分（我需要找到2个相同模式之间的差异 - 结构相同，而不是数据 - 并且Hibernate不支持MINUS）

（顺便说一句，我知道我可以从日志文件中检查 SQL）

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2010-10-08T08:28:37.227

这是获取 SQL 的“另一种”方法：

```
CriteriaImpl criteriaImpl = (CriteriaImpl)criteria;
SessionImplementor session = criteriaImpl.getSession();
SessionFactoryImplementor factory = session.getFactory();
CriteriaQueryTranslator translator=new CriteriaQueryTranslator(factory,criteriaImpl,criteriaImpl.getEntityOrClassName(),CriteriaQueryTranslator.ROOT_SQL_ALIAS);
String[] implementors = factory.getImplementors( criteriaImpl.getEntityOrClassName() );

CriteriaJoinWalker walker = new CriteriaJoinWalker((OuterJoinLoadable)factory.getEntityPersister(implementors[0]), 
                        translator,
                        factory, 
                        criteriaImpl, 
                        criteriaImpl.getEntityOrClassName(), 
                        session.getLoadQueryInfluencers()   );

String sql=walker.getSQLString(); 
```

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2009-02-17T00:52:10.593

我已经使用 Spring AOP 完成了类似的操作，因此我可以获取应用程序中运行的任何查询的 sql、参数、错误和执行时间，无论它是 HQL、Criteria 还是本机 SQL。

这显然是脆弱的、不安全的，可能会因 Hibernate 等的变化而中断，但它说明了获取 SQL 是可能的：

```
CriteriaImpl c = (CriteriaImpl)query;
SessionImpl s = (SessionImpl)c.getSession();
SessionFactoryImplementor factory = (SessionFactoryImplementor)s.getSessionFactory();
String[] implementors = factory.getImplementors( c.getEntityOrClassName() );
CriteriaLoader loader = new CriteriaLoader((OuterJoinLoadable)factory.getEntityPersister(implementors[0]),
    factory, c, implementors[0], s.getEnabledFilters());
Field f = OuterJoinLoader.class.getDeclaredField("sql");
f.setAccessible(true);
String sql = (String)f.get(loader); 
```

将整个东西包装在 try/catch 中，使用风险自负。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2010-11-12T15:15:40.043

对于那些使用 NHibernate 的人，这是 [ram] 代码的一个端口

```
public static string GenerateSQL(ICriteria criteria)
    {
        NHibernate.Impl.CriteriaImpl criteriaImpl = (NHibernate.Impl.CriteriaImpl)criteria;
        NHibernate.Engine.ISessionImplementor session = criteriaImpl.Session;
        NHibernate.Engine.ISessionFactoryImplementor factory = session.Factory;

        NHibernate.Loader.Criteria.CriteriaQueryTranslator translator = 
            new NHibernate.Loader.Criteria.CriteriaQueryTranslator(
                factory, 
                criteriaImpl, 
                criteriaImpl.EntityOrClassName, 
                NHibernate.Loader.Criteria.CriteriaQueryTranslator.RootSqlAlias);

        String[] implementors = factory.GetImplementors(criteriaImpl.EntityOrClassName);

        NHibernate.Loader.Criteria.CriteriaJoinWalker walker = new NHibernate.Loader.Criteria.CriteriaJoinWalker(
            (NHibernate.Persister.Entity.IOuterJoinLoadable)factory.GetEntityPersister(implementors[0]),
                                translator,
                                factory,
                                criteriaImpl,
                                criteriaImpl.EntityOrClassName,
                                session.EnabledFilters);

        return walker.SqlString.ToString();
    } 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2012-06-11T14:26:20.147

如果您使用的是 Hibernate 3.6，您可以使用接受的答案（由 Brian Deterling 提供）中的代码稍作修改：

```
 CriteriaImpl c = (CriteriaImpl) criteria;
  SessionImpl s = (SessionImpl) c.getSession();
  SessionFactoryImplementor factory = (SessionFactoryImplementor) s.getSessionFactory();
  String[] implementors = factory.getImplementors(c.getEntityOrClassName());
  LoadQueryInfluencers lqis = new LoadQueryInfluencers();
  CriteriaLoader loader = new CriteriaLoader((OuterJoinLoadable) factory.getEntityPersister(implementors[0]), factory, c, implementors[0], lqis);
  Field f = OuterJoinLoader.class.getDeclaredField("sql");
  f.setAccessible(true);
  String sql = (String) f.get(loader); 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-11-09T11:58:54.127

如果您只想获取查询的某些部分，我喜欢这样：

```
new CriteriaQueryTranslator(
    factory,
    executableCriteria,
    executableCriteria.getEntityOrClassName(), 
    CriteriaQueryTranslator.ROOT_SQL_ALIAS)
        .getWhereCondition(); 
```

例如这样的：

```
String where = new CriteriaQueryTranslator(
    factory,
    executableCriteria,
    executableCriteria.getEntityOrClassName(), 
    CriteriaQueryTranslator.ROOT_SQL_ALIAS)
        .getWhereCondition();

String sql = "update my_table this_ set this_.status = 0 where " + where; 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2016-03-02T20:53:46.567

这是我使用并为我工作的方法

```
public static String toSql(Session session, Criteria criteria){
    String sql="";
    Object[] parameters = null;
    try{
        CriteriaImpl c = (CriteriaImpl) criteria;
        SessionImpl s = (SessionImpl)c.getSession();
        SessionFactoryImplementor factory = (SessionFactoryImplementor)s.getSessionFactory();
        String[] implementors = factory.getImplementors( c.getEntityOrClassName() );
        CriteriaLoader loader = new CriteriaLoader((OuterJoinLoadable)factory.getEntityPersister(implementors[0]), factory, c, implementors[0], s.getEnabledFilters());
        Field f = OuterJoinLoader.class.getDeclaredField("sql");
        f.setAccessible(true);
        sql = (String)f.get(loader);
        Field fp = CriteriaLoader.class.getDeclaredField("traslator");
        fp.setAccessible(true);
        CriteriaQueryTranslator translator = (CriteriaQueryTranslator) fp.get(loader);
        parameters = translator.getQueryParameters().getPositionalParameterValues();
    }
    catch(Exception e){
        throw new RuntimeException(e);
    }
    if (sql !=null){
        int fromPosition = sql.indexOf(" from ");
        sql = "SELECT * "+ sql.substring(fromPosition);

        if (parameters!=null && parameters.length>0){
            for (Object val : parameters) {
                String value="%";
                if(val instanceof Boolean){
                    value = ((Boolean)val)?"1":"0";
                }else if (val instanceof String){
                    value = "'"+val+"'";
                }
                sql = sql.replaceFirst("\\?", value);
            }
        }
    }
    return sql.replaceAll("left outer join", "\nleft outer join").replace(" and ", "\nand ").replace(" on ", "\non ");
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-06-27T13:12:54.960

该答案基于 user3715338 的答案（纠正了一个小的拼写错误）并与 Michael 对 Hibernate 3.6 的答案混合 - 基于 Brian Deterling 接受的答案。然后我扩展了它（对于 PostgreSQL），用更多的类型替换了问号：

```
public static String toSql(Criteria criteria)
{
    String sql = "";
    Object[] parameters = null;
    try
    {
        CriteriaImpl criteriaImpl = (CriteriaImpl) criteria;
        SessionImpl sessionImpl = (SessionImpl) criteriaImpl.getSession();
        SessionFactoryImplementor factory = sessionImpl.getSessionFactory();
        String[] implementors = factory.getImplementors(criteriaImpl.getEntityOrClassName());
        OuterJoinLoadable persister = (OuterJoinLoadable) factory.getEntityPersister(implementors[0]);
        LoadQueryInfluencers loadQueryInfluencers = new LoadQueryInfluencers();
        CriteriaLoader loader = new CriteriaLoader(persister, factory,
            criteriaImpl, implementors[0].toString(), loadQueryInfluencers);
        Field f = OuterJoinLoader.class.getDeclaredField("sql");
        f.setAccessible(true);
        sql = (String) f.get(loader);
        Field fp = CriteriaLoader.class.getDeclaredField("translator");
        fp.setAccessible(true);
        CriteriaQueryTranslator translator = (CriteriaQueryTranslator) fp.get(loader);
        parameters = translator.getQueryParameters().getPositionalParameterValues();
    }
    catch (Exception e)
    {
        throw new RuntimeException(e);
    }
    if (sql != null)
    {
        int fromPosition = sql.indexOf(" from ");
        sql = "\nSELECT * " + sql.substring(fromPosition);

        if (parameters != null && parameters.length > 0)
        {
            for (Object val : parameters)
            {
                String value = "%";
                if (val instanceof Boolean)
                {
                    value = ((Boolean) val) ? "1" : "0";
                }
                else if (val instanceof String)
                {
                    value = "'" + val + "'";
                }
                else if (val instanceof Number)
                {
                    value = val.toString();
                }
                else if (val instanceof Class)
                {
                    value = "'" + ((Class) val).getCanonicalName() + "'";
                }
                else if (val instanceof Date)
                {
                    SimpleDateFormat sdf = new SimpleDateFormat(
                        "yyyy-MM-dd HH:mm:ss.SSS");
                    value = "'" + sdf.format((Date) val) + "'";
                }
                else if (val instanceof Enum)
                {
                    value = "" + ((Enum) val).ordinal();
                }
                else
                {
                    value = val.toString();
                }
                sql = sql.replaceFirst("\\?", value);
            }
        }
    }
    return sql.replaceAll("left outer join", "\nleft outer join").replaceAll(
        " and ", "\nand ").replaceAll(" on ", "\non ").replaceAll("<>",
        "!=").replaceAll("<", " < ").replaceAll(">", " > ");
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-10-17T11:04:46.390

对于希望在单行中执行此操作的任何人（例如，在显示/立即窗口中，调试会话中的监视表达式或类似内容），以下将执行此操作并“漂亮地打印”SQL：

```
new org.hibernate.jdbc.util.BasicFormatterImpl().format((new org.hibernate.loader.criteria.CriteriaJoinWalker((org.hibernate.persister.entity.OuterJoinLoadable)((org.hibernate.impl.CriteriaImpl)crit).getSession().getFactory().getEntityPersister(((org.hibernate.impl.CriteriaImpl)crit).getSession().getFactory().getImplementors(((org.hibernate.impl.CriteriaImpl)crit).getEntityOrClassName())[0]),new org.hibernate.loader.criteria.CriteriaQueryTranslator(((org.hibernate.impl.CriteriaImpl)crit).getSession().getFactory(),((org.hibernate.impl.CriteriaImpl)crit),((org.hibernate.impl.CriteriaImpl)crit).getEntityOrClassName(),org.hibernate.loader.criteria.CriteriaQueryTranslator.ROOT_SQL_ALIAS),((org.hibernate.impl.CriteriaImpl)crit).getSession().getFactory(),(org.hibernate.impl.CriteriaImpl)crit,((org.hibernate.impl.CriteriaImpl)crit).getEntityOrClassName(),((org.hibernate.impl.CriteriaImpl)crit).getSession().getEnabledFilters())).getSQLString()); 
```

...或者这是一个更易于阅读的版本：

```
new org.hibernate.jdbc.util.BasicFormatterImpl().format(
  (new org.hibernate.loader.criteria.CriteriaJoinWalker(
     (org.hibernate.persister.entity.OuterJoinLoadable)
      ((org.hibernate.impl.CriteriaImpl)crit).getSession().getFactory().getEntityPersister(
        ((org.hibernate.impl.CriteriaImpl)crit).getSession().getFactory().getImplementors(
          ((org.hibernate.impl.CriteriaImpl)crit).getEntityOrClassName())[0]),
     new org.hibernate.loader.criteria.CriteriaQueryTranslator(
          ((org.hibernate.impl.CriteriaImpl)crit).getSession().getFactory(),
          ((org.hibernate.impl.CriteriaImpl)crit),
          ((org.hibernate.impl.CriteriaImpl)crit).getEntityOrClassName(),
          org.hibernate.loader.criteria.CriteriaQueryTranslator.ROOT_SQL_ALIAS),
     ((org.hibernate.impl.CriteriaImpl)crit).getSession().getFactory(),
     (org.hibernate.impl.CriteriaImpl)crit,
     ((org.hibernate.impl.CriteriaImpl)crit).getEntityOrClassName(),
     ((org.hibernate.impl.CriteriaImpl)crit).getSession().getEnabledFilters()
   )
  ).getSQLString()
); 
```

**笔记：**

1.  答案基于[ramdane.i 发布的解决方案](https://stackoverflow.com/questions/554481/46788621#3888873)。
2.  它假定[Criteria](https://docs.jboss.org/hibernate/orm/3.5/javadocs/org/hibernate/Criteria.html)对象名为`crit`。*如果名称不同，请搜索并替换*。
3.  它假定 Hibernate 版本晚于 3.3.2.GA 但早于 4.0，以便使用[BasicFormatterImpl](https://docs.jboss.org/hibernate/stable/core.old/api/org/hibernate/jdbc/util/BasicFormatterImpl.html)来“漂亮地打印”HQL。*如果使用不同的版本，请参阅[此答案](https://stackoverflow.com/questions/312552#559120)以了解如何修改。或者也许只是完全删除漂亮的印刷品，因为它只是“很高兴拥有”*。
4.  它使用[`getEnabledFilters`](https://docs.jboss.org/hibernate/orm/3.5/api/org/hibernate/engine/SessionImplementor.html#getEnabledFilters())而不是[`getLoadQueryInfluencers()`](https://docs.jboss.org/hibernate/orm/3.5/api/org/hibernate/engine/SessionImplementor.html#getLoadQueryInfluencers())向后兼容，因为后者是在 Hibernate 的更高版本（3.5？？？）中引入的
5.  如果查询被参数化，它不会输出使用的实际参数值。

# .net - 将 web 项目更改为类库

> ID：554484
> 
> 赞同：1
> 
> 时间：2009-02-16T20:42:03.583
> 
> 标签：.net, visual-studio, csproj, webproject

除了复制 .cs 文件之外，还有其他方法吗？

更改 .csproj 文件？但是怎么做？

有一个相关的问题，但我对答案不满意：[link](https://stackoverflow.com/questions/546979/how-to-convert-web-application-project-to-class-library-project)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-16T20:46:49.653

您可能对答案不满意，但它仍然是正确的答案，恐怕这仍然是一个骗局。

老实说，重构不会超过一个小时。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-08-01T01:42:59.990

您需要手动编辑 .proj 文件并删除 <ProjectTypeGuids> 元素。

您可能还想删除与 IIS 相关的其他元素。对此 .proj 文件和正确设置的类库中的文件进行比较。

# wpf - WPF 是否支持本机读取/写入 WMF/EMF 文件？

> ID：554492
> 
> 赞同：10
> 
> 时间：2009-02-16T20:44:32.343
> 
> 标签：wpf, winforms, winapi, wmf, .emf

Windows Presentation Foundation 可以在无需使用 WinForms Interop 或 Win32 的情况下读取/写入 WMF/EMF 文件。

如果没有，原因是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-16T22:01:15.280

在 MSDN 上快速搜索会发现[一个](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/7010cefa-e596-45af-b193-40206451dd90/)帖子，其中包含 Microsoft 的 PM 佩吉·古德温 (Peggi Goodwin) 的帖子：

> WPF 不支持 EMF 和 WMF 图像格式。这些格式比其他图像格式更容易受到安全漏洞的影响，因此我们不打算支持它们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-08T22:33:33.023

我做的 ！！！

我在我的真实代码中使用了 ComponentOne 的 WPF 图表，但为了使示例简单，我只是做了一个按钮。但它确实适用于复杂的 wpf 小部件。字体、透明度、AntiAlias 等一切正常。我可以粘贴到 Word 中并更改图表上的标签等。

基本上，我将 XAML 抽取到 XPS，然后将其导入回 XAML。

然后我使用了一个名为 XAMLToys 的将 XAML 转换为 WMF 的开源项目。

XAMLToys 将在 99% 的情况下失败，因为您无法序列化复杂的 XAML 对象

[http://softronix.com/download/WpfToWmfClipboard.zip](http://softronix.com/download/WpfToWmfClipboard.zip)

对这两个项目大加赞赏

[http://xamltoys.codeplex.com/](http://xamltoys.codeplex.com/)

[http://khason.net/blog/converting-fixeddocument-xpsdocument-too-to-flowdocument/](http://khason.net/blog/converting-fixeddocument-xpsdocument-too-to-flowdocument/)

# java - Java 等价于 WPF

> ID：554493
> 
> 赞同：10
> 
> 时间：2009-02-16T20:44:50.487
> 
> 标签：java, wpf

是否有与 WPF 平台等效的 Java？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-16T20:49:12.630

不，但是有可以与 Flash/Flex 和 SilverLight 相提并论的[JavaFX](http://javafx.com/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-01-16T07:13:10.070

最有可能的答案是[Soyatec 的 eFace](http://www.soyatec.com/eface/)。它支持 WPF 的几个关键特性。它使用 XAML 和数据绑定，因此您可以应用 MVVM 并测试您的 ViewModel。它还支持模板。

此外，这在[Eclipse e4](http://eclipse.org/e4/)中使用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-16T20:48:03.317

[JavaFX](http://en.wikipedia.org/wiki/JavaFX)是 SUN 与 WPF 竞争的试验品。

它可以在 Applet 和桌面应用程序中使用

你可以看到[这个](http://socialmode.com/2008/12/07/javafx-vs-adobe-air-vs-wpfxamlsilverlight/)比较

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-04-09T22:01:01.497

请看一下Qt Jambi。它使用 Qt 框架：

[http://qt-jambi.org/](http://qt-jambi.org/)

# sql - SQL - improve NOT EXISTS query performance

> ID：554509
> 
> 赞同：17
> 
> 时间：2009-02-16T20:48:27.060
> 
> 标签：sql, sql-server, performance, where-clause, not-exists

Is there a way I can improve this kind of SQL query performance:

```
INSERT
INTO ...
WHERE NOT EXISTS(Validation...) 
```

The problem is when I have many data in my table (like million of rows), the execution of the `WHERE NOT EXISTS` clause if very slow. I have to do this verification because I can't insert duplicated data.

I use SQLServer 2005

thx

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-16T20:50:35.853

Make sure you are searching on indexed columns, with no manipulation of the data within those columns (like substring etc.)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-16T20:58:21.873

Off the top of my head, you could try something like:

```
 TRUNCATE temptable
 INSERT INTO temptable ...
 INSERT INTO temptable ... 
 ...
 INSERT INTO realtable
 SELECT temptable.* FROM temptable
 LEFT JOIN realtable on realtable.key = temptable.key
 WHERE realtable.key is null 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-16T20:56:56.260

Try to replace the NOT EXISTS with a left outer join, it sometimes performs better in large data sets.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-16T20:56:46.073

Pay attention to the other answer regarding indexing. NOT EXISTS is typically quite fast if you have good indexes.

But I **have** had performance issues with statements like you describe. One method I've used to get around that is to use a temp table for the candidate values, perform a DELETE FROM ... WHERE EXISTS (...), and then blindly INSERT the remainder. Inside a transaction, of course, to avoid race conditions. Splitting up the queries sometimes allows the optimizer to do its job without getting confused.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-09-30T20:29:12.790

Outer Apply tends to work for me...

instead of:

```
from t1
where not exists (select 1 from t2 where t1.something=t2.something) 
```

I'll use:

```
from t1
outer apply (
    select top 1 1 as found from t2 where t1.something=t2.something
) t2f
where t2f.found is null 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-16T20:57:35.837

If you can at all reduce your problem space, then you'll gain heaps of performance. Are you absolutely sure that every one of those rows in that table needs to be checked?

The other thing you might want to try is a `DELETE InsertTable FROM InsertTable INNER JOIN ExistingTable ON <Validation criteria>` before your insert. However, your mileage may vary

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-16T21:09:09.897

```
insert into customers 
select * 
from newcustomers 
where customerid not in (select customerid 
                         from customers) 
```

..may be more efficient. As others have said, make sure you've got indexes on any lookup fields.

# iphone - 在单个属性上组合动画

> ID：554515
> 
> 赞同：3
> 
> 时间：2009-02-16T20:53:55.533
> 
> 标签：iphone, cocoa, cocoa-touch, core-animation

如何使用两个单独的 CABasicAnimations 同时为同一属性设置动画？

例如两个 CABasicAnimations，都为 position.y 设置动画。

第一个动画将是一个反弹（从 100 到 300，持续时间 = 1，自动反转 = 是，重复计数 = 10）

第二个动画将是一个缓慢的滚动（100，持续时间 = 10）

我看到的行为是，如果第一个动画正在进行中并且我使用：

```
[pickle.layer addAnimation:[self makescrollanimation] forKey:@"scrollit"]; 
```

添加第二个...第二个被忽略。

我知道第二个动画有效，因为如果我从第二个开始，那么第一个被忽略。

谢谢你-马特

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-17T15:45:58.293

如果我理解正确，您希望视图在整个弹跳运动缓慢向下移动时上下弹跳。您可以通过使用它们的additive 属性使动画相加来做到这一点。例如：

```
CABasicAnimation *bounceAnimation = [CABasicAnimation animationWithKeyPath:@"position.y"];
bounceAnimation.duration = 1;
bounceAnimation.fromValue = [NSNumber numberWithInt:100];
bounceAnimation.toValue = [NSNumber numberWithInt:300];
bounceAnimation.repeatCount = 10;
bounceAnimation.autoreverses = YES;
bounceAnimation.fillMode = kCAFillModeForwards;
bounceAnimation.removedOnCompletion = NO;
bounceAnimation.additive = YES;
[view.layer addAnimation:bounceAnimation forKey:@"bounceAnimation"];

CABasicAnimation *scrollAnimation = [CABasicAnimation animationWithKeyPath:@"position.y"];
scrollAnimation.duration = 10;
scrollAnimation.fromValue = [NSNumber numberWithInt:0];
scrollAnimation.toValue = [NSNumber numberWithInt:100];
scrollAnimation.fillMode = kCAFillModeForwards;
scrollAnimation.removedOnCompletion = NO;
scrollAnimation.additive = YES;
[view.layer addAnimation:scrollAnimation forKey:@"scrollAnimation"]; 
```

如果我正确阅读您的问题，应该完成您想要的动画。滚动动画应该能够在反弹动画期间的任何时候触发。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-05-14T17:25:39.790

我写了一个关于如何使用附加动画的[快速总结](http://tech.groups.yahoo.com/group/CocoaHeads-NYC/message/1055)

简而言之，在事务中设置新模型值，然后您从旧模型值减去新模型值进行动画处理，目标是 NSZeroPoint、NSZeroRect 或恒等变换。您将获得美丽的曲线，而不是在飞行中更改动画时产生颠簸。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T03:07:38.630

如果要跨不同属性捆绑多个动画，可以使用 CAAnimationGroup，但我不确定使用两个 CABasicAnimation 是否可行。您一次只能将每个属性的一个属性动画应用于视图。

我能想到的一种方法是将您的视图嵌套在另一个 UIView 中，并在封闭视图上执行“滚动”动画，同时继续反弹封闭视图。

想知道更好的答案！

# php - 标题刷新

> ID：554517
> 
> 赞同：5
> 
> 时间：2009-02-16T20:54:43.800
> 
> 标签：php, header

```
if (strlen($_POST['reply']) < 6) {
header("Refresh: 2; url=thread.php?id=$tid#reply");
die("The text you have entered is too short. Please write a longer text and try again.");
} 
```

*当我添加#reply*时，为什么标题刷新不起作用？给出一个空白页。它适用于标题位置。任何想法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-16T21:36:04.560

井号 (#) 之后的任何内容都是 URL 的本地部分，不应强制刷新。此外，如果您在浏览器的 URL 中有 #reply 并在地址栏中再次按 enter，则页面不会刷新，您只会被带到页面的 #reply 部分（目标）。

另请注意，您不使用完整的 URL 违反了标准。您应该使用： url= [http://server.com/thread.php?id=](http://server.com/thread.php?id=) $tid#reply

PS：我建议使用`Header("Location: xxxxxxxx");` 你应该把刷新放在 META 标签中

# .net - 利用 .NET 属性的力量

> ID：554519
> 
> 赞同：2
> 
> 时间：2009-02-16T20:54:55.720
> 
> 标签：.net, custom-attributes

我想知道是否可以使用属性将功能“混合”到类/方法/属性中。

就像是：

```
[TrackChanges]
public Foo
{
   get;
   set;
} 
```

如果可能的话，有谁会如何实施？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-16T20:57:09.083

看看[PostSharp](http://www.postsharp.org/about/getting-started)，一个[AOP](http://www.postsharp.org/aop-net/overview)框架。它是一个后编译器，它使用自定义属性向现有代码注入额外的行为。大多数示例通常是跟踪和安全性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-16T20:56:45.153

他们当然可以，但你必须使用反射来做到这一点。也仅仅因为你能做到并不意味着它很容易或优雅。

反射将使您可以访问任何类型的每个成员。您必须检索这些成员并通过 .NET 反射 API 来操作它们。虽然这可能有效，但维护或阅读并不是最容易的事情。

# zero-pad - 如何在没有字符串转换的情况下计算整数中的数字？

> ID：554521
> 
> 赞同：34
> 
> 时间：2009-02-16T20:55:37.043
> 
> 标签：zero-pad

我担心这个问题有一个简单而明显的答案。我需要确定一个项目的数量有多少位宽，以便我可以用保持对齐所需的*最少前导零数填充每个项目编号。*例如，如果总数 < 10，我不想要前导零，如果总数在 10 到 99 之间，我想要 1，等等。

一种解决方案是将项目计数转换为字符串，然后计数字符。呸！有没有更好的办法？

编辑：我不会想到使用[常用对数](http://en.wikipedia.org/wiki/Common_logarithm)（我不知道存在这样的东西）。所以，对我来说并不明显——但绝对简单。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-02-16T20:58:35.697

这应该这样做：

```
int length = (number ==0) ? 1 : (int)Math.log10(number) + 1; 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-16T21:00:31.697

```
int length = (int)Math.Log10(Math.Abs(number)) + 1; 
```

您可能需要考虑负号..

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-02-16T21:19:03.913

如果语句具有乘法...例如（其中 n 是需要其位数的数字），则将重复比重复除法更有效的解决方案

```
unsigned int test = 1;
unsigned int digits = 0;
while (n >= test)
{
  ++digits;
  test *= 10;
} 
```

如果项目计数有一些合理的上限（例如，无符号整数的 32 位范围），那么更好的方法是与某个静态数组的成员进行比较，例如

```
// this covers the whole range of 32-bit unsigned values
const unsigned int test[] = { 1, 10, 100, 1000, 10000, 100000, 1000000, 10000000, 100000000, 1000000000 };

unsigned int digits = 10;
while(n < test[digits]) --digits; 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-16T20:59:29.127

您可以使用 while 循环，它可能比对数更快，因为它仅使用整数算术：

```
int len = 0;
while (n > 0) {
    len++;
    n /= 10;
} 
```

我把它作为练习留给读者来调整这个算法来处理零和负数。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-16T21:02:12.737

如果您要在.Net中填充数字，那么

```
num.ToString().PadLeft(10, '0') 
```

可能会做你想做的事。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-16T23:24:21.930

我会发表评论，但我的代表分数不会让我有这种区别。

我想指出的是，尽管 Log(10) 是一种非常优雅（阅读：代码行数很少）的解决方案，但它可能是对处理器负担最重的解决方案。

我认为 jherico 的回答可能是最有效的解决方案，因此应该得到奖励。

特别是如果你要为很多数字这样做..

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-16T21:03:52.813

由于数字没有前导零，因此您无论如何都要转换以添加它们。我不确定您为什么要如此努力地避免它来找到最终结果无论如何都必须是字符串的长度。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-16T20:58:44.697

以 10 为底的对数提供了一种解决方案，有点矫枉过正。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-16T20:59:35.413

可以循环10次删除，计算循环次数；

```
int num = 423;
int minimum = 1;
while (num > 10) {
    num = num/10;
    minimum++;
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-16T21:04:38.443

好吧，我无法抗拒：使用`/=`：

```
#include <stdio.h>

int
main(){
        int num = 423;
        int count = 1;
        while( num /= 10)
                count ++;
        printf("Count: %d\n", count);
        return 0;
}
534 $ gcc count.c && ./a.out
Count: 3
535 $ 
```

# database-design - 类似于数据库设计中的继承

> ID：554522
> 
> 赞同：24
> 
> 时间：2009-02-16T20:55:44.813
> 
> 标签：database-design, polymorphic-associations, class-table-inheritance

假设您正在建立一个数据库来存储各种车辆的碰撞测试数据。您想要存储快艇、汽车和卡丁车的碰撞测试数据。

您可以创建三个单独的表：SpeedboatTests、CarTests 和 GokartTests。但是每个表中的很多列都是相同的（例如，执行测试的人员的员工 ID、碰撞方向（前、侧、后）等）。但是，很多列会有所不同，因此您不想将所有测试数据放在一个表中，因为您将有很多列对于快艇始终为空，还有很多列将始终为空对汽车来说是空的，而对于卡丁车来说，相当多的总是空的。

假设您还想存储一些与测试不直接相关的信息（例如被测试事物的设计者的员工 ID）。这些列似乎根本不适合放在“测试”表中，特别是因为它们将在同一辆车上的所有测试中重复。

让我说明一种可能的表格排列方式，以便您了解所涉及的问题。

```
快艇
编号 | col_about_speedboats_but_not_tests1 | col_about_speedboats_but_not_tests2

汽车
编号 | col_about_cars_but_not_tests1 | col_about_cars_but_not_tests2

卡丁车
编号 | col_about_gokarts_but_not_tests1 | col_about_gokarts_but_not_tests2

测试
编号 | 类型 | id_in_type | col_about_all_tests1 | col_about_all_tests2
（id_in_type 将引用接下来三个表之一的 id 列，
取决于类型的值）

快艇测试
编号 | speedboat_id | col_about_speedboat_tests1 | col_about_speedboat_tests2

汽车测试
编号 | 车牌号 | col_about_car_tests1 | col_about_car_tests2

卡丁车测试
编号 | gokart_id | col_about_gokart_tests1 | col_about_gokart_tests2

```

这种结构有什么好处/坏处，实现这样的东西的首选方式是什么？

如果还有一些适用于您希望在 Vehicles 表中拥有的所有车辆的信息怎么办？CarTests 表会看起来像......

```
编号 | 车辆编号 | ...

使用这样的 Vehicles 表：
编号 | 类型 | id_in_type
（id_in_type 指向快艇、汽车或卡丁车的 ID）

```

看起来这只是一个皇家混乱。应该如何设置这样的东西？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-02-16T21:42:53.013

和`type`设计`id_in_type`被称为[多态关联](http://en.wikipedia.org/wiki/Polymorphic_association)。这种设计以多种方式打破了规范化规则。如果没有别的，它应该是一个危险信号，你*不能*声明一个真正的外键约束，因为它`id_in_type`可能引用几个表中的任何一个。

这是定义表格的更好方法：

*   制作抽象表`Vehicles`，为所有车辆子类型和车辆测试提供抽象参考点。
*   每个车辆子类型都有一个不会自动递增的主键，而是引用`Vehicles`.
*   每个测试子类型都有一个不会自动递增的主键，而是引用`Tests`.
*   每个测试子类型还具有对应车辆子类型的外键。

这是示例 DDL：

```
CREATE TABLE Vehicles (
 vehicle_id INT AUTO_INCREMENT PRIMARY KEY
);

CREATE TABLE Speedboats (
 vehicle_id INT PRIMARY KEY,
 col_about_speedboats_but_not_tests1 INT,
 col_about_speedboats_but_not_tests2 INT,
 FOREIGN KEY(vehicle_id) REFERENCES Vehicles(vehicle_id)
);

CREATE TABLE Cars (
 vehicle_id INT PRIMARY KEY,
 col_about_cars_but_not_tests1 INT,
 col_about_cars_but_not_tests2 INT,
 FOREIGN KEY(vehicle_id) REFERENCES Vehicles(vehicle_id)
);

CREATE TABLE Gokarts (
 vehicle_id INT PRIMARY KEY,
 col_about_gokarts_but_not_tests1 INT,
 col_about_gokarts_but_not_tests2 INT,
 FOREIGN KEY(vehicle_id) REFERENCES Vehicles(vehicle_id)
);

CREATE TABLE Tests (
 test_id INT AUTO_INCREMENT PRIMARY KEY,
 col_about_all_tests1 INT,
 col_about_all_tests2 INT
);

CREATE TABLE SpeedboatTests (
 test_id INT PRIMARY KEY,
 vehicle_id INT NOT NULL,
 col_about_speedboat_tests1 INT,
 col_about_speedboat_tests2 INT,
 FOREIGN KEY(test_id) REFERENCES Tests(test_id),
 FOREIGN KEY(vehicle_id) REFERENCES Speedboats(vehicle_id)
);

CREATE TABLE CarTests (
 test_id INT PRIMARY KEY,
 vehicle_id INT NOT NULL,
 col_about_car_tests1 INT,
 col_about_car_tests2 INT,
 FOREIGN KEY(test_id) REFERENCES Tests(test_id),
 FOREIGN KEY(vehicle_id) REFERENCES Cars(vehicle_id)
);

CREATE TABLE GokartTests (
 test_id INT PRIMARY KEY,
 vehicle_id INT NOT NULL,
 col_about_gokart_tests1 INT,
 col_about_gokart_tests2 INT,
 FOREIGN KEY(test_id) REFERENCES Tests(test_id),
 FOREIGN KEY(vehicle_id) REFERENCES Gokarts(vehicle_id)
); 
```

您也可以声明`Tests.vehicle_id`哪些引用`Vehicles.vehicle_id`并删除每个测试子类型表中的 vehicle_id 外键，但这将允许异常，例如引用 gokart id 的快艇测试。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-16T21:05:00.733

对于将继承层次结构映射到数据库表，我认为 Martin Fowler 在他的《企业应用程序架构模式》一书中很好地列出了替代方案。

[http://martinfowler.com/eaaCatalog/singleTableInheritance.html](http://martinfowler.com/eaaCatalog/singleTableInheritance.html)

[http://martinfowler.com/eaaCatalog/classTableInheritance.html](http://martinfowler.com/eaaCatalog/classTableInheritance.html)

[http://martinfowler.com/eaaCatalog/concreteTableInheritance.html](http://martinfowler.com/eaaCatalog/concreteTableInheritance.html)

如果子类的附加字段/列的数量很少，那么单表继承通常是最容易处理的。

如果您将 PostgreSQL 用于您的数据库并且您愿意将自己绑定到特定于数据库的功能，那么它直接支持表继承：

[http://www.postgresql.org/docs/8.3/static/ddl-inherit.html](http://www.postgresql.org/docs/8.3/static/ddl-inherit.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-16T21:00:39.513

我会将其分解为不同的表，例如 Vehicle（ID、类型等）VehicleAttributes（）VehicleID、AttributeID、Value）、CrashTestInfo（VehicleID、CrashtestID、Date 等）CrashtestAttributes（CrashTestID、AttributeID、Value）

或者不是属性，而是为应该记录的每组相似细节单独的表。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-16T21:59:39.667

如果您使用[SQLAlchemy](http://www.sqlalchemy.org/)，这是一个 Python 的对象关系映射器，您可以[配置继承层次结构如何映射到数据库表](http://www.sqlalchemy.org/docs/05/mappers.html#mapping-class-inheritance-hierarchies)。对象关系映射器非常适合驯服原本乏味的 SQL。

您的问题可能非常适合垂直表。与其将所有内容存储在模式中，不如将对象的类型和主键存储在一个表中，并将每个对象的键/值元组存储在另一个表中。如果您真的要存储汽车测试，此设置将使添加新类型的结果变得更加容易。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-02-16T21:58:45.193

在“gen-spec 关系建模”上进行谷歌搜索。您将找到有关如何设置存储通用实体（OO 程序员可能称为超类）属性的表、为每个专用实体（子类）单独表以及如何使用外键链接它的文章全部一起。

最好的文章 IMO 讨论了 ER 建模方面的 gen-spec。如果您知道如何将 ER 模型转换为关系模型，然后转换为 SQL 表，那么一旦他们向您展示了如何在 ER 中对 gen-spec 进行建模，您就会知道该怎么做。

如果您只是在“gen-spec”上搜索，您将看到的大部分内容都是面向对象的，而不是面向关系的。只要您知道如何克服对象关系阻抗不匹配，这些东西也可能很有用。

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2009-02-16T21:19:13.743

您的设计是合理的，并且遵循正确的规范化规则。您可能缺少带有 Vehicle Id 和 Type 的 Vehicle 表（即 Speedboats、Cars 和 Gokarts 的“父级”......您将在其中保留“DesignedByUserId”之类的内容）。Vehicle 表和 Speedboats 表之间是一对一的关系，Vehicle 和 Speedboat/Cars/GoKarts 之间是一对一的关系（即，一辆车只能有一条快艇记录，汽车或卡丁车）...尽管大多数数据库都没有为此提供简单的执行机制。

有助于识别此类事物的一个规范化规则是字段应仅取决于表的主键。在快艇、汽车和 gokart 测试结果存储在一起的综合表中，与汽车相关的字段不仅取决于测试日期，还取决于车辆 ID 和车辆类型。测试结果表的主键是测试日期 + 车辆 id，车辆类型并不是使测试数据行唯一的原因（即是否有在 01/01/200912:30pm 对一辆特定车辆进行测试那既是快艇又是汽车……不……做不到）。

我没有特别好地解释规范化规则......但是当我阅读正式描述时，第 3/4/5 范式规则总是让我感到困惑。其中之一（3rd/4th/5th）处理取决于主键且仅主键的字段。该规则假设主键已被正确识别（错误地定义主键太容易了）。

# internet-explorer - IE 和 iframe 的 P3P 问题

> ID：554527
> 
> 赞同：1
> 
> 时间：2009-02-16T20:56:55.027
> 
> 标签：internet-explorer, iframe, cookies, p3p

我的问题与此问题中概述的[问题有关](https://stackoverflow.com/questions/389456/cookie-blocked-not-saved-in-iframe-in-internet-explorer)。

据我所知，我已经很好地设置了我的 p3p（p3p 验证器没有返回任何错误），但我仍然得到阻止的 cookie。`src`我的`iframe`网站是一个外部网站，如果我要接受的 cookie 来自外部网站，我有什么特别需要做的吗？

这是我的 p3p.xml：

```
<?xml version="1.0" encoding="UTF-8" ?>
<META xmlns="http://www.w3.org/2002/01/P3Pv1">
<!-- Policy Generated by P3PWiz http://www.p3pwiz.com -->
<POLICY-REFERENCES>
  <EXPIRY date="Tue, 16 Feb 2010 08:50:40 -0600"/>
  <POLICY-REF about="/w3c/Policies.xml#Privacy">
    <INCLUDE>/*</INCLUDE>
  </POLICY-REF>
  <POLICY-REF about="/w3c/Policies.xml#WSC">
    <INCLUDE>*/*</INCLUDE>
    <COOKIE-INCLUDE name="*" value="*" domain="*" path="*" />
  </POLICY-REF>
</POLICY-REFERENCES>
</META> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-10-27T17:04:24.743

好吧，我不确定您是否按照文章中的描述正确设置了标题：

> 发送带有响应的紧凑标头
> 
> 我在 example.com 上设置了网络服务器以发送带有响应的紧凑标头，如下所示：
> 
> HTTP/1.1 200 OK P3P: policyref="/w3c/p3p.xml", CP="IDC DSP COR IVAi IVDi OUR TST" // ... 其他标头和内容
> 
> policyref 是 Policy Reference 文件的相对 URI（反过来又引用隐私策略），CP 是紧凑的策略表示

如您所见，其他人也遇到了同样的问题：

> 我完成了 95%，但我的标题只说：P3P: CP="...." 并且没有包含 policyref 链接，这使它在 IE7 中工作，但不是 IE6... 现在工作得很好。谢谢！– AndreasKnudsen 5 月 12 日 10:17

我还想知道策略文件的托管位置与实际站点的托管位置之间是否存在任何关系。

# ruby-on-rails - 如何在 ActiveRecord 中设置数据之前使设置方法加密数据？

> ID：554546
> 
> 赞同：2
> 
> 时间：2009-02-16T21:02:36.823
> 
> 标签：ruby-on-rails, ruby, reflection, metaprogramming

我想实现一个 Rails`User`模型，它有一个名为`password`. 我想做到这一点，以便当我打电话时......

```
user_instance.password = 'cleartext' 
```

该方法在将明文设置在实例上之前对其进行哈希处理，如下所示：

```
Digest::SHA1.hexdigest(cleartext) 
```

我试过使用回调，但问题是每次保存用户时都会对 pw 进行哈希处理，即使 pw 没有更新也是如此。所以它被一遍又一遍地散列和重新散列。

我尝试重新定义`password=`方法...

```
alias password= old_password=
def password=(cleartext)
  old_password=(Digest::SHA1.hexdigest(cleartext))
end 
```

但得到一个错误说不`password=`存在。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-16T21:11:15.650

仅供参考，您可能需要查看 restful_authentication 插件，因为它会为您执行此操作。为什么要自己滚动？

act_as_authenticated 的方式：

1.  数据库/模型有一个名为“encrypted_pa​​ssword”的列
2.  创建一个名为密码的虚拟属性
3.  密码未在 find(..) 上填充，因此如果密码为空，请不要加密
4.  如果密码是非空的，这意味着用户输入了一个，所以继续加密并在 encrypted_pa​​ssword 中填充

代码片段（从我的用户类中随机复制粘贴，所以不要盲目粘贴）：

```
require 'digest/sha1'
class User < ActiveRecord::Base

  # stuff

  # callback
  before_save   :encrypt_password
  attr_accessor :password

  # methods
    def encrypt_password
      return if password.blank?
      salt = Digest::SHA1.hexdigest("--#{Time.now.to_s}--#{login}--") if new_record?
      crypted_password = Digest::SHA1.hexdigest("--#{salt}--#{self.password}--")
    end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T01:41:39.650

针对 Ethan 的评论，什么是虚拟属性，虚拟属性是不在数据库中的属性，例如 Matt 的 attr_accessor :password，这样您就可以接受来自用户的输入，但不一定以那种形式存储它，在这种情况下，我们希望能够接受明文密码，但我们希望将其加密存储。为此，我们有一个虚拟属性：password，并在数据库中将其存储为 encrypted_pa​​ssword。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T05:06:09.127

好吧，您可以覆盖设置器：

```
def password=(value)
  self[:password] = Digest::SHA1.hexdigest(value)
end 
```

这*总是*会加密价值。您不需要 before_save*或*attr_accessor。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T08:24:55.593

请注意，为每个用户选择一个随机的 n 位值（在创建该用户时）并在您对其进行哈希处理时将其添加到密码中可能是个好主意。

原因是：如果有人掌握了你的数据库，他们不仅不能立即看到用户的密码，他们也不能看到两个用户是否有相同的密码（如果其中一个用户抓住了你的数据库，这很重要）和某种类型的哈希破解攻击（彩虹表）变得更加困难。

# c# - 如何处理 LINQ 返回的数据类型

> ID：554548
> 
> 赞同：3
> 
> 时间：2009-02-16T21:03:34.683
> 
> 标签：c#, asp.net, linq, ado.net

我是 LINQ 的新手，我使用 LINQ to SQL 链接到两个表，它确实返回数据，这很酷。我想了解的是返回的数据类型以及如何使用此数据类型？

我习惯于处理数据表。如果使用 LINQ，我们现在是否要丢弃数据表（以及所有其他 ADO.Net 对象，如行、数据集等）？如果是这样，我们将用什么替换它，我如何使用它来完成我之前对数据表所做的一切？另外——替换数据表有意义吗，它们有缺陷吗？

这是一些代码：

```
protected IEnumerable<string> GetMarketCodes()
{
    LINQOmniDataContext db = new LINQOmniDataContext();

    var mcodes = from p in db.lkpMarketCodes 
                    orderby 0
                    select p;

    return (IEnumerable<string>) mcodes;
} 
```

此代码当前确实返回数据（我可以在调试中看到它），但在“返回”行出现错误，因为显然我的数据类型不是 IEnumerables，这是我的最佳猜测。所以，我还想了解的一件事是我的数据被放入什么数据类型以及如何将其返回给调用函数。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-16T21:05:55.677

它返回一个`IQueryable<lkpMarketCode>`，假设那`lkpMarketCode`是 中的数据类型`db.lkpMarketCodes`。如果你想要字符串，你需要`select p.SomeProperty;`，而不仅仅是`select p;`.

您不需要强制转换（因为`IQueryable<T>`implements `IEnumerable<T>`）；如果您将鼠标悬停在 上，它也应该告诉您这一点`mcodes`。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-16T21:10:39.287

我发现返回 List<> 更方便，所以我知道我在处理什么。所以你的代码是：

```
protected List<string> GetMarketCodes()
{
    LINQOmniDataContext db = new LINQOmniDataContext();

    var mcodes = from p in db.lkpMarketCodes 
                    orderby 0
                    select p.SomeProperty;

    return mcodes.ToList();
} 
```

话虽如此，我几乎没有使用过 LINQ-to-SQL，所以可能有更好的方法......

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-16T21:07:31.150

它返回一个[IQueryable](http://msdn.microsoft.com/en-us/library/system.linq.iqueryable.aspx)对象。你的桌子怎么样？我猜这个错误是因为你的 lkpMarketCodes 表不仅仅是一个字符串列。它正在返回整个表。

如果您只想返回一个 IEnumerable 字符串，则必须返回如下所示的内容（我确信语法有点偏离）：

```
var mcodes = from p in db.lkpMarketCodes 
orderby 0
select new { p.StringColumnName }; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-16T22:08:15.717

LINQ 返回 IQueryable<type>。这是 IEnumerable 的超集。您收到错误的原因是您的查询没有返回 IQueryable<string>，而是返回了 IQueryable<lkpMarketCodes>。lkpMarketCodes 很可能是一个对象，可以认为它类似于一行记录。

LINQ 是一个对象关系映射器，它将列和行映射到字段和对象。

您可以做几乎所有在 ADO 中可以做的事情，但它适用于对象而不是通用行，因此它更安全。

在您的示例中，我将假设 lkpMarketCodes 是一个表，并且该表至少包含两个字段，即 mcode 和 description。

如果您想返回 mcode 的 IEnumerable<string>，您可以执行以下操作：

```
protected IEnumerable<string> GetMarketCodes()
{
    LINQOmniDataContext db = new LINQOmniDataContext();
    var mcodes = from p in db.lkpMarketCodes 
        orderby 0 
        select p.mcode;
    return mcodes;
} 
```

这将返回您的 IEnumerable<string> 代码。您可以用来找出类型的一个技巧是在声明后简单地使用变量，然后将鼠标悬停在变量名称上，弹出窗口会告诉您它的类型。

也就是说，如果您将鼠标悬停在返回的 mcodes 上，它会告诉您类型，但如果您将鼠标悬停在 var mcodes 上，它不会告诉您类型。

# c++ - 在没有标题的c ++ dll中调用函数

> ID：554551
> 
> 赞同：15
> 
> 时间：2009-02-16T21:04:41.203
> 
> 标签：c++, dll, signature, method-signature, dumpbin

我想从 dll 中调用一个方法，但我既没有源文件也没有头文件。我尝试使用 dumpbin /exports 查看方法的名称，但我可以找到方法签名？

有没有办法调用这个方法？

谢谢，

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-16T21:18:02.170

如果该函数是 C++ 函数，则您可以从损坏的名称中派生函数签名。[Dependency Walker](http://www.dependencywalker.com/)是一种可以为您执行此操作的工具。但是，如果 DLL 是使用 C 链接创建的（Dependency Walker 会告诉您这一点），那么您就不走运了。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-16T21:18:57.050

C++ 语言对 dll 一无所知。

这是在 Windows 上吗？一种方法是：

*   打开`depends.exe`随附的 dll (Visual Studio)
*   验证您要调用的函数的签名
*   用于`LoadLibrary()`加载此 dll（注意路径）
*   用于`GetProcAddress()`获取指向要调用的函数的指针
*   使用这个指向函数的指针来使用有效参数进行调用
*   用于`FreeLibrary()`释放手柄

> *顺便说一句：此方法通常也称为运行时动态链接，而不是编译时动态链接，您可以使用关联`lib`文件编译源代码。*

*nixes with 存在一些类似的机制`dlopen`，但在那之后我的记忆开始失败。调用`objdump`或`nm`应该让你开始检查函数的东西。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-16T21:25:16.363

如您所见，DLL 中的导出列表仅存储名称，而不存储签名。如果您的 DLL 导出 C 函数，您可能必须对函数进行反汇编和反向工程以确定方法签名。但是，C++ 在导出名称中对方法签名进行编码。这种结合方法名称和签名的过程称为[“名称修饰”](http://en.wikipedia.org/wiki/Name_mangling)。 [这个 Stackoverflow 问题](https://stackoverflow.com/questions/491115/where-is-documentation-on-the-microsoft-visual-studio-c-name-mangling-scheme)有一个参考，用于根据损坏的导出名称确定方法签名。

试试免费的[“Dependency Walker”（又名“depends”）](http://www.dependencywalker.com/)实用程序。“Undecorate C++ Functions”选项应该确定 C++ 方法的签名。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-08T07:10:06.457

可以通过分析其反汇编的开始来找出 C 函数签名。函数参数将在堆栈上，并且该函数将执行一些“弹出”以以相反的顺序读取它们。您不会找到参数名称，但您应该能够找到它们的编号和类型。返回值可能会变得更加困难 - 它可能是通过“eax”寄存器或通过作为最后一个伪参数（在堆栈顶部）传递给函数的特殊指针。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-16T21:20:23.117

如果您确实知道或强烈怀疑该函数存在，您可以使用 loadLibrary 动态加载 DLL 并使用 getProcAddress 获取指向该函数的指针。见[MSDN](http://msdn.microsoft.com/en-us/library/ms683212(VS.85).aspx)

请注意，这是一种手动的动态加载库的方式；您仍然必须知道正确的函数签名才能映射到函数指针才能使用它。AFAIK 无法在加载时功能中使用 dll 并使用没有头文件的函数。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-16T21:25:38.877

每当更新第 3 方 DLL 时，调用非外部函数是让程序中断的好方法。

也就是说，[undname](http://msdn.microsoft.com/en-us/library/5x49w699(VS.80).aspx)实用程序也可能会有所帮助。

# colors - OCR：如何找到正确的 ColorMatrix 来定义新颜色？

> ID：554561
> 
> 赞同：2
> 
> 时间：2009-02-16T21:09:04.187
> 
> 标签：colors, matrix, ocr

我现在被困在定义每条线的尺寸上。我要抓取的列表中有各种颜色，最让我不安的是一个选择：

![例子](https://i.stack.imgur.com/Qapho.jpg)

如您所见，我尝试分析的图片是带有绿色文本的白色背景。选择背景为灰色，带有黑色文本。并且每一行都有一个稍微灰色的背景，但我设法用 ColorMatrix 来控制对比度。

仅供参考，我确实有一些其他的 ColorMatrizes，如 Greyscale、Negative、SetContrast、SetBrightness 等。

我的搜索线条的方法确实适用于图片的大部分部分，但选择会阻止它。

所以现在我被卡住了，不知道该怎么办。我google了一个小时，但没有找到解决方案。

* * *

我想，也许我可以将背景灰色从选择转换为白色，而不影响文本和灰度图片的其余部分。但我找不到能完成这项工作的 ColorMatrix。

你知道一个或有更好的解决方案吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2012-08-19T18:00:05.660

为什么要使用颜色矩阵？

通过 ImageMagick 的操作，它（至少对于您的具体示例）更容易`-threshold`工作：

```
 convert                                              \
    http://img18.imageshack.us/img18/210/lobbymd9.jpg \
   -threshold 50%                                     \
    result.jpg 
```

**视觉结果：**

![原来的](https://i.stack.imgur.com/6KF3w.jpg)   `=>`   ![阈值 50%](https://i.stack.imgur.com/MBD0v.jpg)

阈值基本上只为每种颜色留下 2 个值（零或最大值）。低于阈值的每个值都设置为 0，高于阈值的值设置为 255（如果工作在 16 位深度，则设置为 65535）。最终效果是纯黑+白画面。

# php - 换行符有什么用？

> ID：554566
> 
> 赞同：5
> 
> 时间：2009-02-16T21:09:41.130
> 
> 标签：php, html

我真的不明白：换行符的目的是什么？

如果我这样做：

```
<?php
echo "This is a test. \n";
echo "This is another test.";
?> 
```

代码导致两个句子在同一行。为什么 \n 不会导致第二句出现在第二行？

如果我这样做的话，这些句子都在它自己的行中：

```
<?php
echo "This is a test. <br>";
echo "This is another test.";
?> 
```

但我也看到人们这样做：

```
<?php
echo "This is a test. <br>\n";
echo "This is another test.";
?> 
```

这基本上导致与第二个代码片段相同的输出。有人愿意解释一下吗？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-02-16T21:11:41.560

[HTML 标准](http://www.w3.org/TR/html401/struct/text.html#h-9.1)将换行符视为另一个空白字符，这就是`<br>`标签存在的原因。但是请注意，换行符将在`<pre>`标签或具有[white-space:pre](https://developer.mozilla.org/en/CSS/white-space) CSS 样式的元素中起作用。

第三个示例只是制作“漂亮”的 HTML：它使“查看源代码”和肉眼检查变得更容易。否则，您将拥有一长串 HTML。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-16T21:12:45.880

正如您所观察到的，有不同的方法可以创建新行。

## **`<br />`**

这不是换行符，这是一个**XHTML**标记，这意味着它可以在 XHTML 中工作。正确地说，它不是换行符，但标签确保插入一个=它强制换行。结束标签是强制性的。

[XHTML 规范](http://www.w3.org/TR/xhtml1/#diffs)

* * *

## **`<br>`**

这是一个强制换行的 HTML 标签。禁止结束标签。

[HTML 4.1 规范](http://www.w3.org/TR/1999/REC-html401-19991224/struct/text.html#h-9.3.2)

* * *

## **`\n`**

是 ASCII 换行符 char LF 的转义序列。一个常见问题是在使用强制使用 ASCII CR+LF 作为结尾行的 Internet 协议进行通信时使用“\n”。将 '\n' 写入文本模式流在 Windows 系统上可以正常工作，但在 Unix 上只产生 LF，而在更奇特的系统上则完全不同。在二进制模式下使用 "\r\n" 稍微好一些，因为它适用于许多 ASCII 兼容系统，但在一般情况下仍然失败。一种方法是使用二进制模式并直接指定控制序列的数值，“\x0D\x0A”。

[阅读更多](http://en.wikipedia.org/wiki/Newline)

* * *

## **PHP_EOL**

是一个 php 新行常量，它被正确的系统相关新行替换。

所以信息是，在正确的地方使用一切。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-16T21:11:47.880

`<br>`将在用户视图中为您提供一个新行；`\n`将为您提供源代码中的新行，即。开发者的观点。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-16T21:14:56.763

渲染 html 时，只有 " `<br />`" 渲染断线。但是，当打印“”时，标记更容易阅读`<br />\n`，因此所有内容都不会排在一条长线上。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-16T22:18:49.013

`\n`是基于代码的

`<br />`是基于 HTML 标记的

两者之间有明显的区别。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-16T21:14:11.477

您的问题是 html 的呈现方式。如果您查看源代码，第一个示例将两行放在不同的行上，但浏览器不会将换行符视为应显示的换行符。这允许您在源代码中有一个长段落：

```
rghruio grgo rhgior hiorghrg hg rgui  
ghergh ugi rguihg rug hughuigharug 
hruauruig huilugil guiui rui ghruf hf 
uhrguihgui rhguibuihfioefhw8u 
beruvbweuilweru gwui  rgior 
```

这只会在浏览器需要时包装，允许它以正确的行长度轻松编辑，但以任何分辨率显示。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-16T21:18:31.170

HTML 不关心源代码中的新行，您可以将它们全部放在一行中。它只会解释`<br />`为新行。您应该使用 \n 来美化您的 HTML 输出，但更好的方法是不要使用 PHP 输出它，而是在 HTML 本身中使用它并且只将 PHP 内容嵌入其中，如下所示：

```
<ul id="menu">
    <?php foreach ($menu_items as $item): ?>
    <li>
        <a href="<?= htmlspecialchars($item['link']) ?>" title="<?= htmlspecialchars($item['title']) ?>">
            <?= htmlspecialchars($item['title']) ?>
        </a>
    </li>
    <?php endforeach; ?>
</ul>
```

这样您就不必费心在 PHP 中进行格式化，但您可以通过设计自动在 HTML 中使用它。此外，您像这样将模型逻辑和视图逻辑彼此分开，并将输出留给您的 HTTP 服务器而不是 PHP 引擎。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-16T21:17:22.327

那是因为您正在创建 HTML 并在浏览器中查看它，而那里或多或少会忽略空格。十个空格不会产生比一个空格更大的间隙，但这并不意味着空格字符不起作用。尝试将内容类型设置为`text/plain`或查看 HTML 源代码以查看换行符的效果。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-16T21:17:34.543

正确的 XHTML 语法是

```
echo "This is the test code <br />\n"; 
```

在`<br />`屏幕上呈现新行，“\n”在源代码中呈现新行

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-16T21:18:42.777

换行符在其他方面很有用，例如在 PDF 中。您是正确的，正如其他人所说，换行符与 HTML 几乎没有关系，它被视为另一个空格字符。`<pre>`虽然它在标签内部很有用。它还可用于格式化 HTML 输出以使其更易于阅读。（尝试在 1000 个字符宽的字符串中查找一段 HTML 有点烦人。）

在数据库中存储数据时，换行符也很有用。通常您希望存储没有 HTML 特殊字符的数据，`<br />`以便可以轻松地以其他格式（再次，例如 PDF）使用。在输出时，您想使用该`nl2br()`函数将新行转换为`<br />`s。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-17T06:37:30.157

换行符对于字符串函数很有用。

例如：

```
 explode( '\n' , $input ); 
```

将用新行拆分字符串。

```
str_replace( '\n' , '<br />' , $input ); 
```

将 $input 中的每个换行符替换为 br 标签。

另外因为 PHP 也有 CLI，\n 对格式化很有用：

例如。

```
echo 'Hello world'; 
```

将在 CLI 中输出；

> 你好世界php>

```
echo 'Hello world' . "\n"; 
```

会输出；

> 你好世界
> php>

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-17T14:43:59.643

尽管它在编写基于 Web 的脚本时也有用处，但请记住 PHP 不仅仅是一个 Web 引擎；它还有一个 CLI，其中 br 标签是无用的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-17T16:51:08.417

`<br />`如果您从命令行运行脚本也无用。

```
$ php -f file.php
Output <br />$ 
```

我知道没有太多人从命令行使用 PHP，但它确实出现了：

文件.php：

```
<?php
print "Output\n";
?> 
```

在命令行：

```
$ php -f file.php
Output
$ 
```

# wpf - Silverlight 中缺少的某些 WPF 功能的解决方法

> ID：554570
> 
> 赞同：7
> 
> 时间：2009-02-16T21:11:37.927
> 
> 标签：wpf, silverlight

我正在将 WPF 应用程序移植到 silverlight 2，并且遇到了 SL 目前缺少的几个 WPF 功能。任何人都可以帮助我提供等价物或建议解决方法。

1.  我想处理嵌入在列表框中的文本框的点击和双击。WPF 实现在列表框控件上使用 PreviewMouseLeftButtonDown/Up。这怎么能在silverlight中完成，似乎在silverlight中缺少PreviewMouseLeftButtonDown/Up。

2.  我想处理嵌入在列表框中的文本框上的按钮按下（F2/Delete）。WPF 实现在作为项目嵌入列表框中的文本框控件上使用 PreviewKeyDown。Silverlight 中似乎缺少 PreviewKeyDown。KeyDown 事件处理程序似乎没有被调用。

3.  我想根据一些自定义附加属性的值更改文本框的一些外观属性。WPF 实现使用 DataTrigger 来执行此操作。如何在 Silverlight 中做到这一点。Silverlight 中似乎缺少 DataTriggers。

4.  我想根据包含文本框的列表框的实际宽度来更改文本框的宽度。WPF 实现使用RelativeSource 绑定。什么是 silverlight 等效项或解决方法。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-16T21:26:44.927

我对 Silverlight 比对完整的 WPF 更熟悉。请相应地考虑我的回答。

对于数字 2。对于许多键，我检查 KeyUp 和 KeyDown。我在尝试查看键被按住的整个时间时使用 KeyDown，而在仅使用一次时使用 KeyUp。您应该知道这是针对没有单独文本框的游戏。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-16T21:28:05.687

对于第 4 项，您可以将列表框宽度和文本框宽度都绑定到静态资源的属性，以便它充当绑定的路由器。您还可以使用通过引用列表框初始化的[值转换器](http://msdn.microsoft.com/en-us/library/system.windows.data.ivalueconverter(VS.95).aspx)，然后将转换器用于您的文本框宽度。

对于第 3 项，您可以使用类似的方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T00:16:54.487

对于第 1 项和第 2 项，访问这些输入事件的最佳方法是创建一个从内置 TextBox 派生的自定义 TextBox。然后您可以覆盖 OnKeyDown 和 OnMouseLeftButton 向下。从那里您可以调用必要的代码，或触发一个新事件。例如：

```
public class MyTextBox : TextBox
{
    public event MouseButtonEventHandler MySpecialMouseLeftButtonDown;

    protected override void OnMouseLeftButtonDown(MouseButtonEventArgs e)
    {
        if (MySpecialMouseLeftButtonDown != null)
        {
            MySpecialMouseLeftButtonDown(this, e);
        }
        base.OnMouseLeftButtonDown(e);
    }
} 
```

与 OnKeyDown 类似。

# windows-mobile - 如何读取 pim.vol 文件

> ID：554578
> 
> 赞同：5
> 
> 时间：2009-02-16T21:13:02.930
> 
> 标签：windows-mobile

是否有任何基于桌面的方式来读取在 Windows Mobile 设备上存储联系人、任务和日历信息的 pim.vol 文件？理想情况下，我想找到一个导出工具，可以让我从我的数据中提取数据，但我也会选择一个允许我与文件交互并从中提取数据的库。

我已经用谷歌搜索了很多，但没有提出任何好的答案。我会很感激任何指示。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-17T00:32:39.347

没有基于桌面的方式来读取 vol 文件。

Vol 文件是 CE 数据库文件，可以是两种格式之一（[CEDB](http://msdn.microsoft.com/en-us/library/aa916035.aspx)，[EDB](http://msdn.microsoft.com/en-us/library/aa914733.aspx)）。pim.vol 文件为 EDB 格式。这些格式没有桌面数据库库。

您可以编写一个 Windows Mobile 应用程序来导出任何 vol 文件（这并不难）。您将遇到的问题是 pim.vol 数据库表格式在不同版本的 WM 之间是不同的。

如果您希望某些东西与 WM 版本无关，您可以使用[POOM](http://msdn.microsoft.com/en-us/library/aa914277.aspx) API，它是用于访问 PIM 数据的 WM 本机 API。它比直接数据库访问慢得多。

# user-interface - 比较可以掩盖差异的工具？

> ID：554581
> 
> 赞同：4
> 
> 时间：2009-02-16T21:13:51.367
> 
> 标签：user-interface, diff, compare, mask

我做了很多文件比较（源、日志等）并且需要屏蔽某些部分，例如日期/时间/行号，这会导致每一行都不同。

Beyond Compare 允许您对文件进行预处理，但是您必须编写一些代码来执行此操作。

是否有 GUI 类型的工具允许您通过过滤器屏蔽文件的各个部分，例如跳过第 10 - 16 列、跳过单词 x 和单词 y 之间的数据等？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T00:30:09.680

查看[WinMerge](http://winmerge.org/)。它具有基于正则表达式过滤行的能力。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-16T21:23:41.157

我不知道任何 GUI 工具，但如果您在 unix 环境中，您可以通过 sed 或 awk 管道传输这两个文件

```
#Example: skip first word
sed 's/^[^[:space:]]*//' yourfile1 >file1.tmp
sed 's/^[^[:space:]]*//' yourfile2 >file2.tmp
diff file1.tmp file2.tmp 
```

# vb.net - 有没有一种简单的方法可以在 VB.NET 中随机化一个列表？

> ID：554587
> 
> 赞同：7
> 
> 时间：2009-02-16T21:15:13.347
> 
> 标签：vb.net, visual-studio-2008, list, random

我有一个 type 列表`System.IO.FileInfo`，我想随机化该列表。我想我记得不久前看到过类似`list.randomize()`的东西，但我找不到我可能在哪里看到过。

我第一次涉足这个让我有了这个功能：

```
Private Shared Sub GetRandom(ByVal oMax As Integer, ByRef currentVals As List(Of Integer))
    Dim oRand As New Random(Now.Millisecond)
    Dim oTemp As Integer = -1
    Do Until currentVals.Count = IMG_COUNT
        oTemp = oRand.Next(1, oMax)
        If Not currentVals.Contains(oTemp) Then currentVals.Add(oTemp)
    Loop
End Sub 
```

我向它发送我希望它迭代到的最大 val，以及对我想要随机化内容的列表的引用。该变量`IMG_COUNT`在脚本中设置得更远，指定我想要显示多少随机图像。

谢谢大家，我很感激 :D

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-16T21:26:01.637

在此处查看 Fisher-Yates 洗牌算法：[http ://en.wikipedia.org/wiki/Knuth_shuffle](http://en.wikipedia.org/wiki/Knuth_shuffle)

本网站的主要霸主在这里进行了更简洁的讨论：http: [//www.codinghorror.com/blog/archives/001015.html](http://www.codinghorror.com/blog/archives/001015.html)

博客条目中有一个简单的 C# 实现，应该很容易更改为 VB.NET

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-09-22T10:45:09.860

我`List`使用以下`Randomize()`函数扩展了该类以使用 Fisher-Yates shuffle 算法：

```
''' <summary>
''' Randomizes the contents of the list using Fisher–Yates shuffle (a.k.a. Knuth shuffle).
''' </summary>
''' <typeparam name="T"></typeparam>
''' <param name="list"></param>
''' <returns>Randomized result</returns>
''' <remarks></remarks>
<Extension()>
Function Randomize(Of T)(ByVal list As List(Of T)) As List(Of T)
    Dim rand As New Random()
    Dim temp As T
    Dim indexRand As Integer
    Dim indexLast As Integer = list.Count - 1
    For index As Integer = 0 To indexLast
        indexRand = rand.Next(index, indexLast)
        temp = list(indexRand)
        list(indexRand) = list(index)
        list(index) = temp
    Next index
    Return list
End Function 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-16T21:35:05.157

建立一个比较器：

```
Public Class Randomizer(Of T)
    Implements IComparer(Of T)

    ''// Ensures different instances are sorted in different orders
    Private Shared Salter As New Random() ''// only as random as your seed
    Private Salt As Integer
    Public Sub New()
        Salt = Salter.Next(Integer.MinValue, Integer.MaxValue)
    End Sub

    Private Shared sha As New SHA1CryptoServiceProvider()
    Private Function HashNSalt(ByVal x As Integer) As Integer
      Dim b() As Byte = sha.ComputeHash(BitConverter.GetBytes(x))
      Dim r As Integer = 0
      For i As Integer = 0 To b.Length - 1 Step 4
          r = r Xor BitConverter.ToInt32(b, i)
      Next

      Return r Xor Salt
    End Function

    Public Function Compare(x As T, y As T) As Integer _
        Implements IComparer(Of T).Compare

        Return HashNSalt(x.GetHashCode()).CompareTo(HashNSalt(y.GetHashCode()))
    End Function
End Class 
```

像这样使用它，假设您的意思是通用的`List(Of FileInfo)`：

```
list.Sort(New Randomizer(Of IO.FileInfo)()) 
```

您还可以使用闭包使随机值“粘性”，然后在其上使用 linq 的 .OrderBy() （这次是 C#，因为 VB lambda 语法很难看）：

```
list = list.OrderBy(a => Guid.NewGuid()).ToList(); 
```

在这里解释，以及为什么它甚至可能不如真正的随机播放快：http:
[//www.codinghorror.com/blog/archives/001008.html? r=31644](http://www.codinghorror.com/blog/archives/001008.html?r=31644)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-16T22:27:23.563

有几种合理的洗牌方法。

已经提到了一个。（Knuth 洗牌。）

另一种方法是为每个元素分配一个“权重”，并根据该“权重”对列表进行排序。这种方法是可行的，但会很笨拙，因为您不能从 FileInfo 继承。

最后一种方法是在原始列表中随机选择一个元素并将其添加到新列表中。当然，也就是说，如果您不介意创建一个新列表。（尚未测试此代码...）

```
 Dim rnd As New Random
        Dim lstOriginal As New List(Of FileInfo)
        Dim lstNew As New List(Of FileInfo)

        While lstOriginal.Count > 0
            Dim idx As Integer = rnd.Next(0, lstOriginal.Count - 1)
            lstNew.Add(lstOriginal(idx))
            lstOriginal.RemoveAt(idx)
        End While 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-16T21:28:02.503

您还可以实现随机播放，有很多方法可以做到这一点，最简单的方法是随机选择一个项目并将其多次插入新位置。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-16T21:30:35.073

如果您有元素数量，则可以使用伪随机方法，您可以随机选择第一个元素（例如使用内置随机数函数），然后添加一个素数并在除以值的数量后取余数。例如，对于 10 个列表，您可以执行 i = (i + prime) % 10 从某个起始值生成索引 i 。只要素数大于列表中值的数量，那么您就可以创建一个序列，该序列贯穿所有数字 0...n，其中 n 是值的数量 - 1，但以伪随机顺序排列。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-20T18:03:15.880

```
Dim oRand As New Random() 'do not seed!!!!
Private Sub GetRandom(ByRef currentVals As List(Of Integer))
    Dim i As New List(Of Integer), j As Integer
    For x As Integer = 0 To currentVals.Count - 1
        j = oRand.Next(0, currentVals.Count)
        i.Add(currentVals(j))
        currentVals.RemoveAt(j)
    Next
    currentVals = i
End Sub 
```

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2009-02-16T21:18:06.007

您可以创建仅返回随机数的自定义比较器，然后使用此比较器对列表进行排序。它可能非常低效并导致几乎无限循环，但可能值得一试。

# jquery - 订阅 jQuery 中的 $().ready 函数

> ID：554588
> 
> 赞同：1
> 
> 时间：2009-02-16T21:15:20.163
> 
> 标签：jquery

在每个页面上，我都创建了我的自定义 js 对象。

我想订阅 $().ready 事件，这样当它触发时，我的对象 init 函数也会触发。

这可能吗？

**更新**

我的对象看起来像：

```
var blah = function() {
    var init = function() {
     //init function stuff
    };
    return {
     InitPage: function() { init(); }
    };
 }(); 
```

然后在我的页面上我会做：

```
blah.init(); 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-16T21:21:08.573

```
$(document).ready(function() {
    YourObject.init();
}); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-16T21:23:03.530

也许我误解了你的问题，但我认为你想要做的是将你的初始化代码放在这个块中：

```
$(document).ready(function() {
    // your code here
}); 
```

当您将一个函数传递给 jQuery`ready()`函数时，它会将新函数与所有以前的函数聚合在一起。换句话说，这将起作用：

```
$(document).ready(function() {
    alert("a");
});

$(document).ready(function() {
    alert("b");
}); 
```

您不必担心会覆盖您之前的`ready()`通话。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-16T21:21:58.010

查看 jQuery[现场](http://docs.jquery.com/Events/live#typefn)活动。

> 当您绑定“实时”事件时，它将绑定到页面上所有当前和未来的元素（使用事件委托）。例如，如果您将实时点击绑定到页面上的所有“li”元素，然后稍后添加另一个 li - 该点击事件将继续对新元素起作用（这不是必须重新绑定的情况绑定在所有新元素上）。

例子：

```
$("p").live("click", function(){
    $(this).after("<p>Another paragraph!</p>");
}); 
```

# xhtml - 描绘与描绘

> ID：554594
> 
> 赞同：1
> 
> 时间：2009-02-16T21:18:05.727
> 
> 标签：xhtml, semantic-web, rdfa, foaf

我正在使用 FOAF 和 RDFa，并努力弄清楚我是否应该使用 foaf:depiction 或 foaf:depicts 以及使用它们的正确方法。这是我已经建立的：

```
<div class="profile" typeof="foaf:Person">
<p>Employee Name: <span property="foaf:name">Fred Flintstone</span></p>
<p><img src="http://www.example.com/fred.jpg" alt="Photo of Fred Flintstone" /></p>
</div> 
```

我知道描绘和描绘是反向相关的。我搜索了互联网的广阔范围，但找不到任何具体的例子。根据我的阅读，Image 描绘了 Person，所以我倾向于使用 foaf:depiction，因为我的主题是 Person，但我不确定如何正确使用。相对还是转速？在图像本身还是在封闭段落上？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T21:54:07.813

看起来我正在处理一个利基主题。我做了更多的搜索和阅读，我想我在这里找到了答案：[http://www.w3.org/TR/2008/WD-xhtml-rdfa-primer-20080317/#using-src-on-img](http://www.w3.org/TR/2008/WD-xhtml-rdfa-primer-20080317/#using-src-on-img)。

总而言之，我对术语的怀疑是正确的：
图像->描绘->人物
人物->描绘->图像

但是，[foaf:img](http://xmlns.com/foaf/spec/#term_img)属性是一个更具体的术语，而不仅仅是专门用于将 Person 与代表他们的 Image 相关联的描述。所以使用它本来是正确的，使用`rel="foaf:depiction"`它（在我的情况下）更正确`rel="foaf:img"`。

这是最终的代码：

```
<div class="profile" typeof="foaf:Person">
<p>Employee Name: <span property="foaf:name">Fred Flintstone</span></p>
<p rel="foaf:img" rev="foaf:depicts"><img src="http://www.example.com/fred.jpg" alt="Photo of Fred Flintstone" /></p>
</div> 
```

该`rev`属性指定图像与人的反向关系。这巩固了这些对象之间存在相互关系，而不是单方面的关系。

So whether it is correct to use `rel` or `rev` depends on what your subject is. If I had a foaf:Image and with a list of multiple people in the image, the correct markup would be `rel="depicts"`.

It's a shame that many examples were removed in future version of the RDFa Primer, but fortunately all previous versions are retained for the future.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-24T10:03:35.697

Scott - the answer is that depicts and depiction are inverse properties of each other, as you found out, it is defined like this in the FOAF spec:

```
<rdf:Property rdf:about="http://xmlns.com/foaf/0.1/depicts" rdfs:comment="A thing depicted in this representation.">
[...]
<owl:inverseOf rdf:resource="http://xmlns.com/foaf/0.1/depiction"/> 
```

This means that if you have proper inference in your store, it doesn't matter which one you use, they should both appear.

FOAF uses a few things like that, primaryTopic/isTopicOf, topic/page, maker/made, etc. FOAF also makes use of inverseFunctionalProperties, i.e. properties where a certain value is tied uniquely to a single person. The usual example is mbox, if you find two FOAF Person entities with the same email address, you can infer that they are actually the same person, since they are uniqiuely identified by their email address.

# lucene.net - Lucene.net 的最新版本是什么？

> ID：554608
> 
> 赞同：2
> 
> 时间：2009-02-16T21:21:12.257
> 
> 标签：lucene.net

从哪里下载最新版本的 Lucene.net dll？我现在使用的是 2.0.0.4 版本，但它的 MultiFieldQueryParser 的构造函数不接受 boost 值。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-16T21:24:39.253

[这里！](http://incubator.apache.org/lucene.net/download/)看起来 v2.0-004 是最新版本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-13T15:15:46.143

2.0.0.4 是他们可用的最新软件包。但是，如果您不介意从源代码构建，2.3.1 是他们在主干中拥有的最新稳定版本。你可以只拉下[TortoiseSVN](http://tortoisesvn.tigris.org/)之类的东西，然后从[存储库](https://github.com/apache/lucenenet)中拉出来。

我完全没有问题地构建它。

# .net - 是否可以使用 ASP.NET Sitemap 生成面包屑？

> ID：554615
> 
> 赞同：3
> 
> 时间：2009-02-16T21:23:23.577
> 
> 标签：.net, asp.net, sitemap, breadcrumbs, sitemappath

我希望我的 ASP.NET 站点有简单的菜单字符串，也就是面包屑。我已经创建了包含所有必需元素的站点地图并注册到 Web.config。例如：

```
<siteMap>
    <siteMapNode url="Default.aspx" title="Home" >
        <siteMapNode url="hosting/Default.aspx" title="Hosting" />
        <siteMapNode url="software/Default.aspx" title="Software">
            <siteMapNode url="firefox/Default.aspx" title="Firefox">
                <siteMapNode url="Download.aspx" title="Download" />
                <siteMapNode url="Support.aspx" title="Support" />
            </siteMapNode>
        </siteMapNode>
    </siteMapNode>
</siteMap> 
```

并创建了一个放置在 Masterpage 上的控件。这是菜单生成代码：

```
protected void Control_Load(Object sender, EventArgs e)
{
    string path = String.Empty;
    StringCollection list = new StringCollection();

    foreach (string str in Request.Url.Segments)
    {
        path += str;
        string link = String.Format("<a href=\"{0}://{1}{2}\">{3}</a>", Request.Url.Scheme, Request.Url.Authority, path, this.names[str]);
        list.Add(link);
    }

    foreach (string str in list)
    {
        menu += String.Concat(str, SeparatorLine);
    }
    menu = menu.Remove(menu.LastIndexOf(SeparatorLine));
} 
```

但它使用像 { { "/", "Home" }, { "hosting/", "Hosting" }, { "software/", "Software" } .. } 这样的 StringDictionary

如何使用对站点地图的查询而不是它？或者可能是其他东西，不是站点地图，而是事先发明的。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-16T21:26:37.750

[ASP.NET SiteMapPath 控件](http://msdn.microsoft.com/en-us/library/x20z8c51.aspx)

```
<asp:SiteMapPath ID="SiteMapPath1" Runat="server" /> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-16T21:26:26.643

您可以使用[SiteMapPath](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.sitemappath.aspx)控件（应该在工具箱的导航类别中）。检查[此页面](http://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/navigation/sitemappath.aspx)以获取教程。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-18T12:03:29.317

只需将 SiteMapProvider 属性设置为您要用于面包屑的站点地图的提供程序，您就可以设置好了。我通常只是将 SiteMapPath 放在一个 div 中，然后在 div 上设置 CSS 来设置面包屑的样式。

不过要注意一个问题。如果您抑制站点地图中的任何根节点，它们仍将显示在您的面包屑中。我通过尝试将相同的站点地图用于面包屑和将 SiteMapDataSource 用于我不想显示起始节点的树视图来遇到此问题。

祝你好运！

# linq-to-sql - 无法更新 Linq2Sql 中的表映射

> ID：554622
> 
> 赞同：1
> 
> 时间：2009-02-16T21:25:00.390
> 
> 标签：linq-to-sql, insert-update

我现在遇到了麻烦，我无法在 DBDataContext 中更新表 X，所以这是我的片段，顺便说一下，当我只更新一个表时它可以工作！但是当我插入然后更新时，它会抛出异常：“无法将对象从 System.Int32 转换为 System.String 类型”

```
{
            using (DBDataContext db = new DBDataContext())
            {
                int codigo = Convert.ToInt32(lblNroInforme.Content);
                int sucessfull = 0;

                INFORMEMEDICO varInf = (from i in db.INFORMEMEDICOs
                                        where i.numeroinforme == codigo
                                        select i).SingleOrDefault();

                if (varInf == null)
                {
                    varInf = new INFORMEMEDICO();
                    varInf.codigoclase = Convert.ToInt32(lblCodigoClase.Content.ToString());
                    varInf.codigoestudio = lblCodigoEstudio.Content.ToString();
                    varInf.codigopaciente = Convert.ToInt32(lblCodigoPaciente.Content.ToString());
                    varInf.conclusion = GetText(rtbConclusion);
                    varInf.fechainforme = DateTime.Today;
                    varInf.firmauno = getJPGFromImageControl(firmaUno.Source as BitmapImage);
                    varInf.firmados = getJPGFromImageControl(firmaDos.Source as BitmapImage);
                    varInf.hallazgo = GetText(rtbHallazgo);
                    varInf.horainforme = Convert.ToDateTime(DateTime.Today.ToShortTimeString());
                    varInf.impreso = 0;
                    varInf.medicoinforma = cboTurnoMed.SelectedValue.ToString();
                    varInf.nombreinforme = txtNombreExamen.Text;
                    varInf.numeroinforme = Convert.ToInt32(lblNroInforme.Content.ToString());
                    varInf.tecnica = GetText(rtbTecnica);
                    varInf.turnosocio = lblTurnoMedico.Content.ToString();

                    try
                    {
                        db.INFORMEMEDICOs.InsertOnSubmit(varInf);
                        db.SubmitChanges();
                        sucessfull = 1;
                    }
                    catch (Exception ex)
                    {
                        MessageBox.Show("Error : " + ex.Message);
                    }
                    if (sucessfull==1)
                    {
                        EXAMENXATENCION varExA = (from ea in db.EXAMENXATENCIONs
                                                  where ea.codigo == codigo
                                                  select ea).SingleOrDefault();
                        varExA.estadoestudio = 'I';
                        db.SubmitChanges();
                    }

                }

            }

        } 
```

当我执行更新时，我从调试器中获取了这个堆栈：

```
en System.Data.Linq.IdentityManager.StandardIdentityManager.MultiKeyManager`3.TryCreateKeyFromValues(Object[] values, MultiKey`2& k)
   en System.Data.Linq.IdentityManager.StandardIdentityManager.MultiKeyManager`3.TryCreateKeyFromValues(Object[] values, MultiKey`2& k)
   en System.Data.Linq.IdentityManager.StandardIdentityManager.MultiKeyManager`3.TryCreateKeyFromValues(Object[] values, MultiKey`2& k)
   en System.Data.Linq.IdentityManager.StandardIdentityManager.MultiKeyManager`3.TryCreateKeyFromValues(Object[] values, MultiKey`2& k)
   en System.Data.Linq.IdentityManager.StandardIdentityManager.IdentityCache`2.Find(Object[] keyValues)
   en System.Data.Linq.IdentityManager.StandardIdentityManager.Find(MetaType type, Object[] keyValues)
   en System.Data.Linq.CommonDataServices.GetCachedObject(MetaType type, Object[] keyValues)
   en System.Data.Linq.ChangeProcessor.GetOtherItem(MetaAssociation assoc, Object instance)
   en System.Data.Linq.ChangeProcessor.BuildEdgeMaps()
   en System.Data.Linq.ChangeProcessor.SubmitChanges(ConflictMode failureMode)
   en System.Data.Linq.DataContext.SubmitChanges(ConflictMode failureMode)
   en System.Data.Linq.DataContext.SubmitChanges()
   en Demo.View.InformeMedico.btnGuardar_Click(Object sender, RoutedEventArgs e) en D:\cs_InformeMedico\app\InformeMedico.xaml.cs:línea 430 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-02T19:14:05.730

LINQ to Sql 不支持唯一键约束的外键（即备用键）。我遇到了同样的问题，发现阅读了一些博客。我想这不是一个错误。

[非主键和 LINQ to SQL 问题（这是一个错误）？](http://social.msdn.microsoft.com/Forums/en-US/linqprojectgeneral/thread/ce806ee0-3bbe-4261-b39f-8dd6db02d480)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-08-24T10:17:15.993

After a lot of research, I found out that this bug only exists on WinXP-Machines with .net 3.5 SP1. On Windows 7 it works fine. Unfortunately, there are two different builds of the same framework.

There is a hotfix from microsoft, which resolves my problem on the xp machines. [http://support.microsoft.com/hotfix/KBHotfix.aspx?kbln=ja&kbnum=963657](http://support.microsoft.com/hotfix/KBHotfix.aspx?kbln=ja&kbnum=963657)

Regards, Florian

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-16T21:30:50.017

将您的 DMBL 文件作为 XML 文件打开。检查每一列的类型，看看应该是 int 的东西是否真的是字符串。

# jquery - jQueries 等价于 YAHOO.util.Event.addListener

> ID：554630
> 
> 赞同：1
> 
> 时间：2009-02-16T21:26:58.437
> 
> 标签：jquery

jQuery 是否有与 YAHOO.util.Event.addListener 等效的方法？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-16T21:50:42.137

是的。

签出[绑定](http://docs.jquery.com/Events/bind#typedatafn)。你可以做类似的事情

```
$("#elementID").bind("click", function(e) {
    // whatever you want
}); 
```

或者你可以直接调用[click](http://docs.jquery.com/Events/click#fn)

```
$("#elementID").click(function(e) {
    // whatever you want
}); 
```

# flash - Flash/ActionScript：将显示对象“绘制”到另一个“上”

> ID：554631
> 
> 赞同：-1
> 
> 时间：2009-02-16T21:27:04.317
> 
> 标签：flash, actionscript-3, actionscript, graphics, bitmap

## 如何在 ActionScript 中正确地将一个矢量对象绘制到另一个矢量对象的特定位置，并考虑定位、透明度等？

我的想法（如[这里](http://www.actionscript.org/forums/archive/index.php3/t-157588.html)所建议的那样）是使用`beginBitmapFill`() 和() 将一个 MovieClip`drawRect`的位图副本（使用() 制作）绘制到 . 另一个 MovieClip 的属性，但事实证明这比我想象的要困难，主要是因为以下原因：`BitmapData.draw``graphics`

1.  ~~**不保留透明度**：源影片剪辑是透明的，目标图形变为白色。我试过使用 a `BlendMode`，但它没有帮助。似乎白色像素实际上被复制到 BitmapData 中。我一定错过了什么，但我不知道是什么。~~似乎问题在于`BitmapData`构造函数的文档是错误的：透明度不默认为*true*，而是*false*。所以如果你创建的`new BitmapData(x, y, true)`透明度是保留的，否则不会。

2.  **定位**。如果源影片剪辑居中（中心位于 (0, 0)，则在将其复制到 BitmapData 时必须应用矩阵来移动它，否则位图将仅包含源影片剪辑的右下角。弄清楚如何移动它很棘手，我认为它涉及以某种方式获取边界。（如果源对象在其画布中完全居中，您可以简单地将其偏移其宽度和高度的一半，当然。）

3.  **`beginBitmapFill`平铺**。似乎如果您不在`drawRect`(0, 0) 处开始 ()，则位图填充也不会从位图中的 (0, 0) 开始。这意味着您必须根据要开始绘制的位置再次移动源位图。

（然后还有其他东西，比如必须 lineStyle(0,0,0) 所以 drawRect() 不画边框等）

所有这些棘手的麻烦让我相信我正在以错误的方式解决这个问题。有没有更简单的方法来做到这一点？有没有图书馆可以帮助我？有没有人成功做到这一点？也许我的绘图画布不应该是 Sprite 而是 Bitmap？但是后来我不知道如何使用`lineTo`() 等来绘制它。

**情况**如下：我有一个 Sprite，我使用它的 .graphics、lineTo() 等绘制它。现在我想在绘制时使用一个 MovieClip 作为画笔（或者只是将另一个 MovieClip 的副本放在绘图表面上），使另一个 MovieClip 成为第一个的图形的一部分。我不能`addChild`() 因为那样矢量图形不会与绘制的图形交互。

* * *

**编辑**：[Theo](https://stackoverflow.com/questions/554631/flash-actionscript-draw-a-display-object-onto-another/554890#554890)提供了一个完美的工作解决方案，*除了*它不应用应用于被绘制到图形表面上的 DisplayObject的**旋转和缩放。**这是[Theo 的解决方案](https://stackoverflow.com/questions/554631/flash-actionscript-draw-a-display-object-onto-another/554890#554890)：

```
private function drawOntoGraphics(source : IBitmapDrawable, target : Graphics, position : Point = null) : void
{
    position = position == null ? new Point() : position;
    var bounds : Rectangle = DisplayObject(source).getBounds(DisplayObject(source));
    var bitmapData : BitmapData = new BitmapData(bounds.width, bounds.height, true, 0x00000000);
    bitmapData.draw(source, new Matrix(1, 0, 0, 1, -bounds.x, -bounds.y), null, null, null, true);
    target.beginBitmapFill(bitmapData, new Matrix(1, 0, 0, 1, bounds.x + position.x, bounds.y + position.y));
    target.drawRect(bounds.x + position.x, bounds.y + position.y, bounds.width, bounds.height);
} 
```

为了支持旋转和缩放，我假设必须修改以下内容：

1.  使用`Matrix`的`draw()`应该从源复制缩放和旋转`DisplayObject`？
2.  `Matrix`使用的 in也`beginBitmapFill()`应该复制这个缩放和旋转？或者这可能会产生“双重”缩放和旋转？
3.  `drawRect()`应该修改坐标以匹配缩放和旋转的大小`DisplayObject`？哪种方式`getBounds()`不准确？

* * *

**编辑**：这是一个支持缩放和旋转的工作实现，由所有反馈制成：

```
static function DrawOntoGraphics(source:MovieClip, target:Graphics, 
        position:Point = null):void {
    var sourceClass:Class = getDefinitionByName(getQualifiedClassName(source)) 
        as Class;   
    var sourceCopy:MovieClip = new sourceClass();
    sourceCopy.rotation = source.rotation;
    sourceCopy.scaleX = source.scaleX;
    sourceCopy.scaleY = source.scaleY;
    sourceCopy.graphics.clear();
    var placeholder:MovieClip = new MovieClip();
    placeholder.addChild(sourceCopy);
    if (!position) 
        position = new Point();
    var bounds:Rectangle = placeholder.getBounds(placeholder);
    var bitmapData:BitmapData = new BitmapData(bounds.width, bounds.height, 
        true, 0x00000000);
    var drawMatrix:Matrix = new Matrix(1, 0, 0, 1, -bounds.x, -bounds.y);
    bitmapData.draw(placeholder, drawMatrix);           
    placeholder.removeChild(sourceCopy);
    var fillMatrix:Matrix = new Matrix(1, 0, 0, 1, bounds.x + position.x, 
        bounds.y + position.y);
    target.beginBitmapFill(bitmapData, fillMatrix);
    target.lineStyle(0, 0x00000000, 0);
    target.drawRect(bounds.x + position.x, bounds.y + position.y, 
        bounds.width, bounds.height);
    target.endFill();
} 
```

* * *

有点相关但不那么热门的问题：[如何在 Flex 3 中的图形上放置图像（例如 PNG）？](https://stackoverflow.com/questions/261386/how-to-put-an-image-say-png-on-a-graphics-in-flex-3)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T09:30:12.207

在我看来，你有几种方法可以解决这个问题：

*   **使用“画布”形状的图形属性**
    优点：漂亮而简单
    缺点：非常有限，特别是如果您需要删除东西，因为您必须重新绘制整个画布。

*   **使用位图和 .draw() 方法**
    优点：也很简单，你可以更轻松地进行复制。
    缺点：基本上和之前的方法有同样的问题，删除任何东西都需要完全重绘。由于它是位图，因此它也无法扩展。

*   **使用 Sprite 并将基元添加为子项**
    优点：非常灵活。
    缺点：这允许您单独移动、缩放和删除对象。但是，它会比前两个选项稍微复杂一些。

使用最后一种方法（如果你要做的不仅仅是一些非常小的事情，我会建议你）你的问题可以通过使用添加到“绘图”中的位图来解决，这些支持透明度（就像你已经发现）并且比使用 bitmapFill 更简单（这有点棘手）。

我的博客上有一个[使用位图克隆和绘制其他 DisplayObject的示例。](http://grapefrukt.com/blog/the-need-for-stupid-amounts-of-objects/)这不完全是您想要的，但代码可能有一些用处，至少是 draw 方法的矩阵部分。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T22:46:23.940

使用显示对象 getBounds 函数可以是在绘图时转换坐标的可靠解决方案：

```
private function drawOntoGraphics(source : IBitmapDrawable, target : Graphics, position : Point = null) : void
{
        position = position == null ? new Point() : position;

        var bounds : Rectangle = DisplayObject(source).getBounds(DisplayObject(source));
        var bitmapData : BitmapData = new BitmapData(bounds.width, bounds.height, true, 0x00000000);

        bitmapData.draw(source, new Matrix(1, 0, 0, 1, -bounds.x, -bounds.y), null, null, null, true);
        target.beginBitmapFill(bitmapData, new Matrix(1, 0, 0, 1, bounds.x + position.x, bounds.y + position.y));
        target.drawRect(bounds.x + position.x, bounds.y + position.y, bounds.width, bounds.height);
} 
```

除了您的评论...下面使用**BitmapData**而不是 Graphics 对象作为画布的相同方法：

```
private function drawOntoBitmapData(source : IBitmapDrawable, target : BitmapData, position : Point = null) : void
{
    position = position == null ? new Point() : position;
    var bounds : Rectangle = DisplayObject(source).getBounds(DisplayObject(source));
    var bitmapData : BitmapData = new BitmapData(bounds.width, bounds.height, true, 0x00000000);
    bitmapData.draw(source, new Matrix(1, 0, 0, 1, -bounds.x, -bounds.y), null, null, null, true);
    target.draw(bitmapData, new Matrix(1, 0, 0, 1, bounds.x + position.x, bounds.y + position.y));
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-16T16:18:22.963

bzlm - 您总是可以使起始 X 位置为常数，并将 drawRect 与矩阵转换结合使用。

```
var xPos:Number = 750;
var matrix:Matrix = new Matrix();
matrix.translate(xPos,0);
mySprite.graphics.beginBitmapFill(myBitmap,matrix);
mySprite.graphics.drawRect(xPos,yPos,imgWidth,imgHeight); 
```

# javascript - 如何通过 Google Maps API 找到最近的十字路口？

> ID：554638
> 
> 赞同：9
> 
> 时间：2009-02-16T21:29:49.630
> 
> 标签：javascript, api, google-maps, geocoding

如何找到我拥有坐标的街道最近的十字路口？

例如，假设我有一条从南到北的街道 A，它与北面的 X 街和南面的 Y 街交叉。

Google Maps API 是否允许查找街道 A 的最近十字路口（X 或 Y）的坐标？我找不到任何地方提到它。

PS：我知道的唯一解决方案是猜测街道 A 上建筑物的最低数量和最高数量，并在它们之间绘制折线。不过我不确定。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T23:59:35.830

[见上面的评论]

很不幸的是，不行。即使使用 gdirections，也无法定位街道的起点和终点（坐标）。我已经通过使用上面提出的技巧解决了这个问题：循环从 1 到 XXX 的建筑物编号。

如果一段时间内准确度为 6（8 = 建筑物编号，7 = 交叉点，6 = 仅近似地址），则表示不存在新数字。所以我只取第一点（纬度/经度）、中间点和最后一点（精度均为 8）并在它们之间创建路径。然而，这有时只提供街道的一部分，因为其他部分要么没有任何建筑物，要么谷歌没有进一步的数据:(

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T00:24:09.200

您可以考虑使用来自 USGS 的 TIGER 数据。你可以从那里获得这些信息，但它不像谷歌数据那样容易使用。

# java - 在 NTFS 分区上时，Powermock 会减慢 Eclipse/Fedora 10 上的测试启动速度

> ID：554641
> 
> 赞同：2
> 
> 时间：2009-02-16T21:30:40.657
> 
> 标签：java, linux, junit, ntfs, powermock

我刚刚开始适当地使用 Powermock，并注意到它极大地减慢了测试启动速度。在它运行时快速查看顶部显示 mount.nfts-3g 占用了大部分 CPU。我将 Eclipse 和我的源目录移动到 ext3 分区，看看这是否是个问题，测试现在启动得更快，但仍然有明显的延迟。这对于 Powermock 是正常的还是我遗漏了一些明显的东西？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T15:55:34.257

PowerMock 在启动时有点慢，因为它使用自己的类加载器，但所需的时间还取决于您如何使用 PowerMock 编写测试。例如，如果您在测试的类或方法级别使用 PrepareForTest 注释。如果您在方法级别使用它，则会为每个测试方法创建一个新的类加载器。时间也可能取决于 junit fork 模式。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T21:08:12.947

尝试在没有 Eclipse 的情况下运行 Powermock。是否会出现相同的症状？

模拟古怪的小单位。性能损失和以前一样高吗？

# php - PHP 接口

> ID：554645
> 
> 赞同：1
> 
> 时间：2009-02-16T21:32:18.297
> 
> 标签：php, interface

我已经为数据结构类型定义了一个接口。我试图强制实现该接口的任何类也实现其他两个接口（迭代器和可数）。

有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-16T21:35:52.330

如果你想强制它，你可以声明你的接口扩展了你需要的接口，例如

```
interface c extends a, b
{
   ...
} 
```

不过一般来说，您可能应该编写代码来检查对象在执行特定操作之前是否具有特定操作所需的所有接口。从长远来看，使事情更容易维护和扩展......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-16T21:34:11.757

让你的接口实现它们，然后只传递抽象方法（即不要在你的接口中实现方法）

# c++ - 使用 Boost 对复杂数据进行 C++ 序列化

> ID：554646
> 
> 赞同：2
> 
> 时间：2009-02-16T21:32:20.933
> 
> 标签：c++, serialization, stl, boost

我有一组希望从中序列化数据的类。但是有很多数据（我们说的是一个 std::map 具有多达一百万个或更多类实例）。

不希望过早优化我的代码，我想尝试一个简单而干净的 XML 实现，所以我使用 tinyXML 将数据保存到 XML，但它太慢了。所以我开始研究使用 Boost.Serialization 编写和读取标准 ascii 或二进制文件。

它似乎更适合这项任务，因为我不必在开始之前将所有这些内存作为开销分配。

我的问题本质上是如何为文件格式规划最佳序列化策略。如果没有必要，我并不特别想序列化整个地图，因为它实际上只是我所追求的内容。玩了一下序列化（并查看了输出），我不明白如何重新加载数据可以知道它何时到达地图的末尾，例如，如果我只是一个接一个地保存所有项目. 在规划序列化策略时需要考虑哪些问题？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-16T21:34:56.747

阅读此[常见问题解答](http://www.parashift.com/c++-faq-lite/serialization.html)！这对开始有帮助吗？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-23T12:36:35.860

boost.serialization 有很多优点。例如，正如您所说，仅包含具有指定签名的方法，就允许框架序列化和反序列化您的数据。此外，boost.serialization 包括所有标准 STL 容器的序列化器和读取器，因此您不必担心是否已存储所有键（它们会）或在反序列化时如何检测映射中的最后一个条目（它将是自动检测）。

但是，需要考虑一些因素。例如，如果您的类中有一个字段可以计算或用于加速，例如索引或哈希表，您不必存储这些，**但**您必须考虑到您必须根据从磁盘读取的数据重建这些结构。

至于您提到的“文件格式”，我认为有时我们会尝试关注格式而不是数据。我的意思是，只要您能够使用（例如）boost.serialization 无缝检索数据，文件的确切格式并不重要。如果您想与其他不使用序列化的实用程序共享文件，那是另一回事。但仅出于（反）序列化的目的，您不必关心内部文件格式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-16T22:03:27.910

*如果没有必要，我并不特别想序列化整个地图，因为它实际上只是我所追求的内容。*

这是否意味着您真的不需要序列化整个对象？也许您应该重新考虑仅使用基于文本的格式。如果您真的只需要序列化映射中键/值对的子集，那么您可能应该将它们写入文本文件并稍后读取它们。你不一定需要`XML`；每个映射键只有一行，然后是带有值的一行应该可以工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-16T22:49:11.280

如果您想要的只是键值对，那么重要的是键和值所采用的类型，这将影响您处理事物的方式。

序列化地图本身通常是一个糟糕的计划，因为您可能希望稍后更改关联容器类型，但不要使之前的序列化文件无效（或必须翻译）。

如果您希望避免再次重建容器的成本（但预先调整容器大小通常足以避免绝大多数此类开销），则序列化容器在某些情况下可能很有用，但这应该是基于特定方面的决定您的应用程序和使用情况。

如果您提供键/值的类型，我们可以提供更多帮助。没有这个，这里有一些一般提示：

*   如果它们适合字符串表示，那么一个简单的 CSV 文件可能就足够了（但使用现有的读写器库，读取和写入合法的 CSV 比表面上看起来更难）
*   如果它们是固定宽度，那么简单的二进制格式将使读写变得非常容易（和快速），但应注意确认以下问题：
    *   字节序
    *   您是否希望允许将此类文件简单地组合在一起或添加类似 CRC 的值以实现完整性（您可以同时执行这两种操作，但更难）
    *   您失去了 grep 文件的能力（这是一个真正的损失，您可能最终不得不为此重新发明部分工具链）
    *   改变 platform/compiler/size_t 是否会破坏格式
*   一些比 XML 更轻量的结构化文本格式。有几个 JSOM/YAML 等。这些将提供您很可能不需要的可扩展性。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-20T21:13:22.397

使用 Google 的[协议缓冲区](http://code.google.com/apis/protocolbuffers/docs/overview.html)，这是一种语言中立、平台中立、可扩展的结构化数据序列化方式，可用于通信协议、数据存储等。Google 几乎所有内部​​ RPC 协议和文件格式都使用协议缓冲区。

有 C++、Java、Python、Perl、C# 和 Ruby 的绑定。

您在元数据 .proto 文件中描述您的数据

```
message Person {
  required int32 id = 1;
  required string name = 2;
  optional string email = 3;
} 
```

然后你会像这样在 C++ 中使用它：

```
Person person;
person.set_id(123);
person.set_name("Bob");
person.set_email("bob@example.com");

fstream out("person.pb", ios::out | ios::binary | ios::trunc);
person.SerializeToOstream(&out);
out.close(); 
```

或者像这样：

```
Person person;
fstream in("person.pb", ios::in | ios::binary);
if (!person.ParseFromIstream(&in)) {
  cerr << "Failed to parse person.pb." << endl;
  exit(1);
}

cout << "ID: " << person.id() << endl;
cout << "name: " << person.name() << endl;
if (person.has_email()) {
  cout << "e-mail: " << person.email() << endl;
} 
```

有关更完整的示例，请参阅[教程](http://code.google.com/apis/protocolbuffers/docs/tutorials.html)。

# c# - 如何将 LINQ 数据绑定到下拉列表

> ID：554649
> 
> 赞同：19
> 
> 时间：2009-02-16T21:34:14.893
> 
> 标签：c#, asp.net, linq, ado.net

此代码的最后两行无法正常工作——结果来自 LINQ 查询。我只是不确定如何将结果中的指示列成功绑定到下拉列表的文本字段和值字段：

```
 protected void BindMarketCodes()
    {
        List<lkpMarketCode> mcodesList = new List<lkpMarketCode>();

        LINQOmniDataContext db = new LINQOmniDataContext();

        var mcodes = from p in db.lkpMarketCodes 
                        orderby 0
                        select p;

        mcodesList = mcodes.ToList<lkpMarketCode>();

        //bind to Country COde droplist
        dd2.DataSource = mcodesList;
        dd2.DataTextField = mcodesList[0].marketName;
        dd2.DataValueField = mcodesList[0].marketCodeID.ToString();

    } 
```

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-02-20T18:47:02.173

```
protected void BindMarketCodes()
{
    using(var dc = new LINQOmniDataContext())
    {
        dd2.DataSource = from p in db.lkpMarketCodes
                         orderby 0
                         select new {p.marketName, p.marketCodeID };
        dd2.DataTextField = "marketName";
        dd2.DataValueField = "marketCodeID";
        dd2.DataBind();
    }
}

// no need to use ToList()
// no need to use a temp list;
// using an anonymous type will limit the columns in your resulting SQL select
// make sure to wrap in a using block; 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-02-16T21:38:17.627

请参阅下面的修改后的代码

```
protected void BindMarketCodes()
{    
    using (var dataContext = new LINQOmniDataContext()) {
        //bind to Country COde droplist
        dd2.DataSource = from p in dataContext.lkpMarketCodes 
            orderby p.marketName
            select new {p.marketCodeID, p.marketName};
        dd2.DataTextField = "marketName";
        dd2.DataValueField = "marketCodeID";
        dd2.DataBind();
    }
} 
```

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2013-09-06T11:13:11.123

```
DropDownList ddl_RouteLocation = (DropDownList)e.Row.FindControl("ddl_RouteLocation");   

ddl_RouteLocation.DataSource = dtLocation;--(dtlocation i have return method of linq in dtlocation)
ddl_RouteLocation.DataTextField =dtLocation.Rows[0]"LocationName"].ToString();
ddl_RouteLocation.DataValueField =dtLocation.Rows[0]["LocationId"].ToString();
ddl_RouteLocation.DataBind();
ddl_RouteLocation.Items.Insert(0, new ListItem("--Select--", "0")); 
```

# jquery - 如何保护我的 JsonResult GET 调用？

> ID：554650
> 
> 赞同：5
> 
> 时间：2009-02-16T21:34:39.133
> 
> 标签：jquery, asp.net-mvc, csrf

我知道如何使用 MVC 的 AntiForgeryToken 属性及其关联的 HTML 帮助程序来帮助 XSRF 保护我的应用程序的表单 POST。

可以为实现 GET 的 JsonResults 做类似的事情吗？

例如，我的 View 包含一个 onSubmit jQuery 调用，如下所示：

```
$.getJSON("/allowActivity/YesOrNo/" + someFormValue, "{}", function(data) {
  if(data.Allow) {
    //Do something.
  }
}); 
```

我想确定这个 JsonResult 只能从预期的页面调用。

编辑：

我发现[这篇](https://stackoverflow.com/questions/470011/security-and-cross-domain-with-asp-net-mvc-jsonresult-and-jquery/470039)关于类似问题的帖子，没有具体答案。

确保我的 GET（非破坏性）URL 仅由我自己页面的 AJAX 调用使用的最简单方法是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-16T22:41:30.377

您可以将 AntiForgeryToken 与一些自定义逻辑结合使用。在服务器上创建 AntiForgery 令牌是相同的，但默认情况下，该值不包含在您的 XmlHttpRequest 中。

此令牌的值位于仅 HTTP cookie“__RequestVerificationToken”中，并且还应该以发布到服务器的表单数据中。因此，在您的 XmlHttpRequest 中包含一个键/值对并在您的控制器上使用 ValidateAntiForgeryToken - 属性

编辑：

今天我自己尝试使用 AntiForgeryToken 来处理 Ajax 请求，它工作正常。只需使用以下 javascript：

```
$.post('my_url',  $.getAntiForgeryTokenString(), function() { ... });

$.getAntiForgeryTokenString = function() {
    return $(document.getElementsByName("__RequestVerificationToken")).fieldSerialize();
}; 
```

在服务器端，您不必更改代码 - 只需为您的操作使用 ValidateAntiForgeryToken- 属性。

希望这可以帮助

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T23:48:44.820

首先为什么不使用 $.post(url, data, callback, 'json') 而不是 getJSON？正如 kleolb02 所说，您可以使用[cookie 插件](http://plugins.jquery.com/project/Cookie)将 cookie 中的值添加到帖子数据中- {__RequestVerificationToken: $.cookie('__RequestVerificationToken')}

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-02-10T02:03:55.347

我在 ASP.NET MVC 项目中使用了类似的代码来使用元素的模糊功能，而没有 Ajax 表单。当某个 HTML 元素 Blur 事件发生时，此代码提供了用服务器数据填充文本字段。

希望这也有帮助。这是我的代码：

Javascript：

```
var mytext = { 'myText': 'example text' };
$.post('/MyController/JsonResultMethod', AddAntiForgeryToken(myText), function (resultData) {
        $('#htmlElement').val(resultData);
});
AddAntiForgeryToken = function (data) {
    data.__RequestVerificationToken = $('input[name=__RequestVerificationToken]').val();
    return data;
}; 
```

C-Sharp 代码：

```
 [HttpPost]
    [ValidateAntiForgeryToken]
    public JsonResult SeoString(string myText)
    {
        try
        {
            // do something here
            return this.Json("result text");
        }
        catch (Exception)
        { return this.Json(string.Empty); }
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-16T22:30:25.770

您可以执行与反 XSRF 方法类似的操作。只需生成一些 ID 将其插入到 javascript 中，当用户调用您的 JSON url 时，让该 url 包含生成的 ID 并检查它是否存在。

针对 XSRF 的防御也使用 sessionID 作为密钥，但这不会阻止用户从另一个网站为自己的帐户执行它。

基于会话和时间的一些哈希可能会起作用。当然，如果用户从 JS 复制值，他仍然可以从另一个位置执行它，但是您可以让该值每 x 分钟过期一次。另一种选择是使用 JS 设置一个 cookie 并在服务器端读取它。

希望这能给你一些想法，让你开始。

# java - 在核心库中包含 3rd 方 jar 的最佳实践？

> ID：554654
> 
> 赞同：2
> 
> 时间：2009-02-16T21:35:22.457
> 
> 标签：java, jar

我们有一个核心库，我们将其作为 JAR 包含在我们所有的 Web 应用程序中，以最大限度地重用代码。现在我们想通过第 3 方库 (iText) 通过这个核心库包含一些功能。

将 iText JAR 添加到核心库不起作用，因为类加载器找不到嵌套的 JAR。我们不想将 iText JAR 添加到每个 Web 应用程序，因为 Web 应用程序不使用 iText，它们使用的是使用 iText 的库。语义？也许吧，但是将第三方 JAR 添加到 Web 应用程序以便它使用的库可以访问 JAR 中的类似乎很麻烦。

我是否错过了解决此问题的简单实践，或者 jar 合并和自定义类加载器是最佳方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-16T21:42:54.747

欢迎来到 JAR 地狱，这是 Java 开发中一个持续存在的问题，也是 OSGi 获得成功的主要原因之一。“凌乱”的方法直到最近才成为行业的标准，清洁方法的成本可能远远超过快速和肮脏方法的成本。

但要回答您的问题，大多数应用程序服务器都有一个地方可以放置可跨所有 Web 应用程序访问的 JARS。例如，Tomcat 有 common/lib 目录。你可能想把你的 JAR 放在那里。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T21:40:52.113

EAR 可能是合适的选择。没有什么比另一层间接更重要了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-21T00:33:27.660

如果您分发战争，则必须将 iText jar 放在战争中。
如果分配耳朵，您可以将多个战争共有的所有罐子放在耳朵根内。
如果 jar 对许多人来说是通用的，则可以选择将其放置在 Web 服务器库目录中。在我看来，最后一个选项是不推荐的，因为您可能在每个耳朵中使用不同版本的 jar，从而产生冲突，并且将 jar 放在服务器根目录中通常不是标准的分发机制。
有一些工具可以重新打包所有库并将它们嵌入到单个 jar 中，例如[Jar Jar Links。](http://code.google.com/p/jarjar/)
最后，我推荐使用[Maven](http://maven.apache.org/)或类似的工具来管理你的依赖和自动化你的构建。随着依赖项的数量开始增长，它会很有帮助。

# git - 如何搜索 git 存储库历史记录以查找合并错误？

> ID：554660
> 
> 赞同：8
> 
> 时间：2009-02-16T21:36:39.940
> 
> 标签：git, merge

在过去的某个时候，我们在 git 中的开发分支被合并了。但是，做出了错误的合并决定，因此一些代码没有进入我们预期的主分支。（在最终合并到主分支之前，有多个不同分支的合并。因此分支和合并历史相当复杂。）

有没有一种简单的方法来搜索 git 存储库以确定在哪个合并上做出了“错误”的决定？

（我已经知道这个特殊案例的答案，但是找到它的过程有点乏味。）

编辑： git blame 被证明不足的原因是在合并错误之后的某个时间提交中触及了该行。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-17T13:40:04.993

如果没有更多细节，我只能暗示**可能的**解决方案。如果您知道受影响的文件或行，您可以尝试[git-blame](http://git.or.cz/man/git-blame "混帐责备(1)") (`git blame *file*`或)，或者您可以使用[git-log](http://git.or.cz/man/git-log "git-log(1)")`git blame *revision* *file*`尝试所谓的“ **pickaxe** search” ，即尝试查找引入给定行或删除给定行的修订. 您可以找到并检查所有合并，例如通过，并检查它们与父级的关系（显示所有父级的差异；或者显示组合的差异，但不显示微不足道的合并更改，即如果采用一侧）。`git log -S'*line*``git log -p -m --grep=Merge``-m``-c`

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-16T21:41:09.930

[git-bisect](http://www.kernel.org/pub/software/scm/git/docs/git-bisect.html)可以帮助您吗？

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2011-08-12T04:40:42.953

Git 日志具有强大的搜索选项。由于有迹象表明您可能知道一段消失的代码，您可以搜索那段代码

`git log <HERE>..<THERE> -S"line I care about" --diff-filter=M`

`-S`将在修改（添加或删除）行之后且仅在该行之后从 HERE 到 THERE 搜索字符串

如果使用 -G 而不是 -S，则可以在搜索中获得更高的精度。-G 使用 -S 提供正则表达式搜索而不是字符串文字搜索。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-16T21:44:36.753

如果您知道文件中的某行被 git 分支合并修改，您可以执行 'git blame file.txt' 并确定文件中该行的提交哈希号和提交作者。然后，您可以查看 git 日志并提取与错误分支合并相关的确切提交。

编辑：针对作者的评论，如果您正在寻找某行的消失，那么 'git diff' 结合 grep 和二进制搜索可能就是您想要的。假设您的提交编号为 0,1,2,3,4,5,6。您知道该行存在于修订版 0 中，但在修订版 6 中消失了。使用 'git diff' 加 grep 搜索消失。

```
git diff 0 6 | grep '- line I care about' 
```

第一次迭代，你会看到你关心的那条线消失了。然后你把修订号减半，然后再试一次

```
git diff 0 3 | grep '- line I care about' 
```

如果 grep 仍然显示该行消失（带有“-”符号），那么您知道该行在修订版 0 到 3 中消失了。如果 grep*没有*显示该行消失，那么该行在修订版 4-6 中消失了.

继续将修订减半，直到找到罪魁祸首。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-01-18T07:08:54.817

对于寻找更简单解决方案的其他人，启动`gitk`（或从 Git GUI 转到 Repository > Visualize *X* History）并使用它的查找工具。

# ruby - Ruby：将变量合并到字符串中

> ID：554666
> 
> 赞同：106
> 
> 时间：2009-02-16T21:40:25.033
> 
> 标签：ruby, string

我正在寻找一种在 Ruby 中将变量合并到字符串中的更好方法。

例如，如果字符串类似于：

“`animal` `action`那个`second_animal`”

而且我有`animal`,`action`和`second_animal`的变量，将这些变量放入字符串的首选方法是什么？

* * *

## 回答 #1

> 赞同：265
> 
> 时间：2009-02-16T21:42:11.283

惯用的方法是这样写：

```
"The #{animal} #{action} the #{second_animal}" 
```

注意字符串周围的双引号 (")：这是 Ruby 使用其内置占位符替换的触发器。您不能用单引号 (') 替换它们，否则字符串将保持原样。

* * *

## 回答 #2

> 赞同：124
> 
> 时间：2009-02-16T22:42:04.353

您可以使用类似 sprintf 的格式将值注入字符串。为此，字符串必须包含占位符。将您的参数放入一个数组并使用以下方式：（有关更多信息，请[查看 Kernel::sprintf 的文档](http://ruby-doc.org/core/classes/Kernel.html#M005984)。）

```
fmt = 'The %s %s the %s'
res = fmt % [animal, action, other_animal]  # using %-operator
res = sprintf(fmt, animal, action, other_animal)  # call Kernel.sprintf 
```

您甚至可以显式指定参数编号并将它们随机排列：

```
'The %3$s %2$s the %1$s' % ['cat', 'eats', 'mouse'] 
```

或者使用哈希键指定参数：

```
'The %{animal} %{action} the %{second_animal}' %
  { :animal => 'cat', :action=> 'eats', :second_animal => 'mouse'} 
```

请注意，您必须为运算符的所有参数提供一个值`%`。例如，您不能避免定义`animal`.

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2014-02-21T19:52:49.237

`#{}`如其他答案所述，我将使用构造函数。我还想指出这里有一个真正的微妙之处需要注意：

```
2.0.0p247 :001 > first_name = 'jim'
 => "jim" 
2.0.0p247 :002 > second_name = 'bob'
 => "bob" 
2.0.0p247 :003 > full_name = '#{first_name} #{second_name}'
 => "\#{first_name} \#{second_name}" # not what we expected, expected "jim bob"
2.0.0p247 :004 > full_name = "#{first_name} #{second_name}"
 => "jim bob" #correct, what we expected 
```

虽然可以用单引号创建字符串（如`first_name`and`last_name`变量所示，**但`#{}`构造函数只能用在带双引号的字符串中。**

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2011-09-15T00:09:32.770

```
["The", animal, action, "the", second_animal].join(" ") 
```

是另一种方法。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2015-02-17T15:58:19.030

这称为字符串插值，您可以这样做：

```
"The #{animal} #{action} the #{second_animal}" 
```

重要提示：它仅在字符串位于双引号 (" ") 内时有效。

无法按预期工作的代码示例：

```
'The #{animal} #{action} the #{second_animal}' 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-02-09T01:41:21.127

标准 ERB 模板系统可能适用于您的方案。

```
def merge_into_string(animal, second_animal, action)
  template = 'The <%=animal%> <%=action%> the <%=second_animal%>'
  ERB.new(template).result(binding)
end

merge_into_string('tiger', 'deer', 'eats')
=> "The tiger eats the deer"

merge_into_string('bird', 'worm', 'finds')
=> "The bird finds the worm" 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-11-03T16:20:16.743

您可以将其与局部变量一起使用，如下所示：

`@animal = "Dog"`
`@action = "licks"`
`@second_animal = "Bird"`

`"The #{@animal} #{@action} the #{@second_animal}"`

输出将是：“**狗** **舔**鸟**”**

# asp.net - VS 插件：查看标记。是否存在类似的东西？

> ID：554667
> 
> 赞同：5
> 
> 时间：2009-02-16T21:40:43.660
> 
> 标签：asp.net, visual-studio, add-in, designer

在使用 Visual Studio (2008) 使用 ASP.NET 时，我遇到了不适的问题：源代码编辑器上下文菜单只有项目 ' `View Designer`' 但没有任何东西可以快速查看标记！

要查看它，您需要打开 Designer 并单击窗口底部的标记标签。或者使用 Shift+F7 热键（默认）。

所以我想在' `View Markup`'之外添加一个项目菜单' `View Designer`'。我想我必须使用 Visual Studio 加载项，如果它已经存在或自己编写。

你怎么看？是否可以？还是已经存在一些解决方案？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2010-09-02T09:31:31.750

工具 > 选项 > 键盘

`View.ToggleDesigner`在“显示包含的命令”中搜索。

使用 F7 向 Global/Editor 添加新的快捷方式。

这无需 VS2008/2010 的宏即可工作

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-09T23:12:26.080

当您在代码视图中并希望查看标记视图时，没有键盘快捷键。这对我有用：

[http://www.karpach.com/Visual-Studio-F7-View-Source.htm](http://www.karpach.com/Visual-Studio-F7-View-Source.htm)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-16T21:45:52.773

如果您在“解决方案资源管理器”中右键单击该文件，您将获得“查看标记”选项。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-17T00:30:15.420

通常，要将命令添加到上下文菜单，您需要执行以下操作：

工具 | 定制

在“工具栏”选项卡上，在“上下文菜单”项旁边打勾 - 这将为您的 IDE 添加一个新工具栏，其中包含编辑器上下文菜单、类视图上下文菜单、调试器上下文菜单等按钮

然后切换到“命令”选项卡，选择您想要的命令，并将其拖到相应的菜单中，您就完成了 - 在这种情况下，在左侧窗格中选择“查看”，然后在右侧窗格中，向下滚动，直到您到达“查看标记”。

话虽这么说，在这种情况下，我可以将按钮添加到代码编辑器的上下文菜单中，但它是灰色的，并且无法使用 - 我想它需要一些从解决方案资源管理器中获取的上下文，而不是从代码窗口 - 这很奇怪，因为它为“查看设计器”和“查看代码”提取了相同的细节。

我想我会使用 Shift+F7 ，对此感到抱歉。

# fluent-nhibernate - Fluent NHibernate 一对多单向映射

> ID：554674
> 
> 赞同：15
> 
> 时间：2009-02-16T21:41:14.937
> 
> 标签：fluent-nhibernate

我有 Post 和 Comment 类，它们有一对多的关系，其中 Post 有一个 Comments 列表。我如何将其映射为与 Fluent NHibernate 的单向关系，因为评论不需要知道其父 Post？目前，这是我的评论映射：

```
Id(x => x.Id);
Map(x => x.Body);
References(x => x.User); 
```

和邮政：

```
Id(x => x.Id);
Map(x => x.Title);
HasMany(x => x.Comments)
    .Inverse()
    .WithKeyColumn("PostId")
    .Cascade.AllDeleteOrphan(); 
```

这不起作用，因为当我尝试使用新添加的评论保存 Post 实例时，评论 (PostId) 上的外键为空。当然，不能使用 NULL PostId 保存评论。我试过删除 .Inverse() 子句，但这也不起作用。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-17T22:28:42.567

当您的外键有非空约束时，NHibernate 不支持这种映射。如果您删除该约束，您将看到 NHibernate 使用空 PostId 插入评论，然后使用新帖子的 Id 更新它们。

您要么需要：

1.  删除非空约束*和*`Inverse`调用
2.  保持约束，并映射关系的另一端（使其成为双向关系，并允许`Inverse`正常工作）

[一对多的 NHibernate 文档](http://www.nhforge.org/doc/nh/en/index.html#collections-onetomany)对此进行了介绍，请参阅最后的*非常重要*的说明。

# php - 添加额外的 HTML 行：将代码放在哪里？

> ID：554679
> 
> 赞同：0
> 
> 时间：2009-02-16T21:42:29.460
> 
> 标签：php, javascript, jquery, html, ajax

我有以下情况：

```
<table><tr><td width="50">
<select name="angle">
<option value="1">1</option>
<option value="2">2</option>
<option value="3">3</option>
<option value="4">4</option>
<option value="5">5</option>
<option value="6">6</option>
</select>
</td><td>
<input type="text" name="what" value="" />
</td></tr></table>
<a href="">+ Add Row</a> 
```

因此，计划是当用户第一次访问页面时，他们将看到 1 行。他们将输入数据并多次单击“添加行”以输入所有数据。稍后，他们应该能够回来编辑或删除任何行。

我的问题/问题是：在 javascript 中，我需要完整的 HTML 来生成每一行或执行 AJAX 请求以从服务器获取新行。在服务器上，当用户返回编辑或者我使用 json 数组传递值时，我需要使用 HTML 来生成行。

我想知道你会怎么做，因为我试图避免在 2 个地方使用 HTML。你会把所有的 HTML 都放在 JS 中吗？或者您会将所有 HTML 放在服务器 (PHP) 上并使用 AJAX 调用？或者你只是在 2 个地方有 HTML？（顺便说一句，我正在工作的案例有 5 列和更多 HMTL。）

我正在使用：PHP + MySQL + jQuery

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-16T21:50:33.307

在 jquery 教程中，您可以使用一个很好的示例来执行此操作。

在现场示例（示例 C）中，您有

```
$("div.contentToChange p:not(.alert)")
  .append("<strong class="addedtext"> This text was just appended to this paragraph</strong>")}); 
```

为什么你不只是添加一个新的输入行而不是“<strong...”？

由于它是您要附加的字符串，因此您几乎可以使用 javascript 更改名称，因此您可以轻松控制它。

喜欢

```
.append("<input type=\"text\" name=\"row_"+id+"\">..... 
```

我会那样做:)

这样您就可以避免每次添加一行时都必须刷​​新网页。您还可以在提交后通过解析“row_id”在 php 端检测您有多少行

希望能帮助到你

编辑：回答评论和问题的其余部分

我会把所有的 HTML 都通过 append 生成，它会让你的服务器上的负载少一点（虽然不是那么多），而且事情会很容易组织。哦，你会避免刷新:)（这用于添加行）

对于添加的从数据库加载的行，那必须是服务器端的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T21:57:25.053

正如您所描述的，有几种方法可以解决这个问题，每种方法都需要权衡取舍。我已经尝试了一些。我会避免将 HTML 放在两个地方，因为这将是未来维护的更多工作。

一种方法是将 HTML 保留在初始页面上 - 您可以在隐藏行中创建“模板”。然后，您可以使用您的网络语言（PHP 或其他语言）来生成保存的数据行以及隐藏的模板行。当用户单击添加行链接/按钮时，您可以克隆该行并将其插入到表的末尾，或模板行之前。这样做的好处是用户不必等待 ajax 调用来加载额外的行。此外，您可以轻松地修改设计。一个潜在的缺点是通过隐藏行来掩盖它的工作原理。

另一种方法是通过 ajax 完成所有加载并请求每个 HTML 行。在这种情况下，我建议将您的 HTML 放在可以包含在初始页面中或通过 ajax 调用加载的模板中。所有 HTML 集中在一处。您还可以预先加载一个额外的行，这样您就没有 ajax 延迟。当用户单击“添加行”时，显示隐藏的预加载行并加载附加的隐藏行。

最后，另一种方法是使用上述模板行方法（第一个选项）并在页面加载时对 JSON 执行 ajax 请求。然后，您可以通过您的 js 和 JSON 数据填充必要的已保存数据行。用户将不得不等待数据加载，但它可以简化一些事情。

# wysiwyg - 从 Microsoft Excel 导出的 HTML 文档的 WYSIWYG 编辑

> ID：554684
> 
> 赞同：0
> 
> 时间：2009-02-16T21:44:25.960
> 
> 标签：wysiwyg

WYSIWYG 编辑器在编辑由 Microsoft 程序（如 Excel）导出的 HTML 文档时通常会遇到问题吗？

我目前正在使用 TinyMCE，但在编辑 Excel 保存的 html 文档时遇到问题。html 文件有很多内联“mso”css 样式，我猜这些样式是微软特有的。TinyMCE 无法在编辑器中正确呈现 html 文档。这些东西通常会破坏像 TinyMCE 这样的所见即所得编辑器吗？

是否有 WYSIWYG 编辑器可以规避这些问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-16T21:49:14.527

是的，特定于 MS 的样式可能是问题所在。

Excel 生成的 HTML 所见即所得编辑器是 Excel。它理解所有的风格等等。如果您不想使用 Excel 作为编辑器，首先不要使用 Excel 生成 HTML；改用别的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T21:49:52.030

Microsoft Frontpage 可能会更好。我没有安装它，所以我无法测试这个理论。

从代码清洁度的角度来看，首先从 Excel 或 Word 导出并不是一个好主意。我有一种预感，您正在从其他人那里收到导出的文件。

# .net - 签名的程序集阻止我的服务启动

> ID：554688
> 
> 赞同：6
> 
> 时间：2009-02-16T21:44:59.110
> 
> 标签：.net, service, code-signing

当我使用 Verisign signtool.exe 对我的服务中的程序集进行签名时，它在机器启动时无法在运行 Windows 2003 Server 的机器上启动。事件日志有两个事件：

“超时（30000 毫秒）等待 xxx Service 服务连接。” 和“由于以下错误导致xxx Service服务启动失败：该服务没有及时响应启动或控制请求。”

一旦机器运行，它就可以正常启动。它在 XP 和 Vista 中启动良好。当程序集未签名时，它开始正常。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-03-11T21:28:40.480

This problem is very common for signed .NET service executables: the service will fail to start at boot time, but run fine when started manually afterwards. Whether ServiceBase.RequestAdditionalTime is used is irrelevant: in fact, no user code is executed at all prior to the service start request timing out. This effect is even more pronounced on machines without Internet connectivity: in that case, even manually starting the service from the SCM will fail.

To resolve this issue, [disable the verification of the Authenticode signature at load time in order to create Publisher evidence](http://msdn.microsoft.com/en-us/library/bb629393.aspx), by adding the following elements to your .exe.config file:

```
<configuration>
    <runtime>
        <generatePublisherEvidence enabled="false"/>
    </runtime>
</configuration> 
```

Publisher evidence is a little-used Code Access Security (CAS) feature: only if your service relies on the PublisherMembershipCondition will disabling it cause issues. In all other cases, it will make the permanent or intermittent startup failures go away, by no longer requiring the runtime to do expensive certificate checks (including revocation list lookups).

**Edit, July 2010:** For applications using version 4.0 of the .NET Framework, this workaround is no longer required.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-16T21:50:22.387

Authenticode 对您的程序集进行签名可能会对冷启动产生非常负面的影响。有关详细信息，请参阅此知识库文章。

[http://support.microsoft.com/default.aspx/kb/936707](http://support.microsoft.com/default.aspx/kb/936707)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-16T22:02:05.730

正如 spacedog 所说，Authenticode 会对启动时间产生不良影响。所以问题是你签的是什么？仅对您的服务可执行文件进行 Authenticode 签名就足够了，而该可执行文件又必须仅引用强命名程序集。因此验证 Authenticode 签名的开销。

您可以将您的程序集安装到 GAC - 如果可能的话 - 这将略微提高启动性能，因为跳过了强名称验证（请参阅[Authenticode 和](http://blogs.msdn.com/shawnfa/archive/2005/12/13/502779.aspx)程序集）和/或如果启动时间仍然是一个问题，您也可以生成您的程序集。

从Romulo A. Ceccon对*[Windows 服务启动超时的回答：](https://stackoverflow.com/questions/216401/windows-service-startup-timeout)*

> 最好尽快完成启动服务。所以，在启动状态下，只做你绝对需要确认它启动成功的事情；其余的稍后再做。如果启动仍然是一个漫长的过程，请定期使用 SetServiceStatus 通知服务控制管理器您尚未完成，因此它不会使您的服务超时。

除此之外，`SetServiceStatus`您还可以尝试通过调用`[ServiceBase.RequestAdditionalTime](http://msdn.microsoft.com/en-us/library/system.serviceprocess.servicebase.requestadditionaltime.aspx)`.

# asp.net - 生成 Jquery CRUD ajax 操作的 Javascript 结果

> ID：554689
> 
> 赞同：2
> 
> 时间：2009-02-16T21:45:08.203
> 
> 标签：asp.net, jquery, asp.net-mvc, t4

最新的 Asp.Net MVC RC 允许返回 JavaScript ActionResult。
我想从控制器动态生成 Jquery 脚本代码，以执行对控制器的经典 $.ajax 调用，以在 ajax 中创建读取更新删除操作，而不是经典的获取/发布表单操作。我应该在设计时（就像现在使用 T4 模板）还是在运行时生成 javascript 代码？
我知道这会打破视图和控制器的清晰分离，但有更好的方法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T05:42:13.383

在我看来，这是一种返回 javascript 操作结果的糟糕技术。当您对 html 元素使用内联样式时，您会收到代码混乱。为什么不将 js 写在单独的文件中并将其包含在页面中？为了在您的 ajax 调用后执行一些操作，您可以轻松地使用回调。如果您需要指定需要更新或删除的元素或其他内容，您可以使用 JsonResult 和 $.getJSON 或 $.post(url, data, callback, 'json')。为了 ajaxify 你的表单，你可以使用 jquery.form 插件。另请查看 jquery.jframe 插件，它提供了根据请求响应更新一些其他元素的功能。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-10-29T21:36:04.997

大多数时候，当我创建一个返回 JsonResult 的控制器方法时，我最终会编写相同的样板 javascript 代码来访问它，我已经编写了数十次（可能是数百次）但使用不同的参数和传入的回调函数。我一直认为这是代码生成的绝佳机会。我仍在研究这个，但这里有一些我遇到的资源：

*   Steve Sanderson 的一篇博客文章探讨了如何使用 T4 搭建一个 AJAX 网格控制器，其中包括一些生成的连接网格的 javascript。[http://blog.stevensanderson.com/2011/04/08/mvcscaffolding-scaffolding-custom-collections-of-files/](http://blog.stevensanderson.com/2011/04/08/mvcscaffolding-scaffolding-custom-collections-of-files/)
*   Jayrock (http://jayrock.berlios.de/) 是一个 JSON RPC 框架，可帮助您创建返回 JSON 的服务并生成它自己的代理 javascript 类，这些代理 javascript 类处理 ajax 编码以对服务器进行同步和异步调用。来自项目站点的示例：

    var s = new HelloWorld();

    alert("sync:" + s.greetings());

    s.greetings(function(response) { alert("async:" + response.result) });

此外，它还会生成类似于 .NET Web 服务所做的测试页面。我过去使用过这个库，发现它很有效。虽然我喜欢继续将相关代码保留在控制器中的想法，但为了方便起见，我可能会回到这一点，这样我就可以将更多时间花在计算机无法生成的代码上。

*   最后，Phil Haack 谈到了我们在这里谈论的事情（我还没有尝试过），[http://haacked.com/archive/2011/08/18/calling-asp-net-mvc-action -methods-from-javascript.aspx](http://haacked.com/archive/2011/08/18/calling-asp-net-mvc-action-methods-from-javascript.aspx)

# java - 有没有办法结合 xpath 和 regexp 来提取节点值的一部分？

> ID：554691
> 
> 赞同：3
> 
> 时间：2009-02-16T21:46:02.633
> 
> 标签：java, regex, xpath

这就是我要的...

假设我试图获得“B”的价值

```
<tree>
<nodea>
<nodeb>
A=foo;
B=bar;
C=goo;
</nodeb>
</nodea>
</tree> 
```

以下是有意义的神奇语法......我正在寻找实际有效的可比较的东西:)

```
string = "./nodea/nodeb/[ REGEX( 'B=(.*?);' ) ]/ $1" 
```

在任何 java xpath 库中都有这样的东西吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-16T21:51:16.113

[XPath 2.0 添加了正则表达式](http://www.w3.org/TR/xpath-functions/#regex-syntax)。我认为这样的事情应该做你想做的事：

```
fn:replace(./nodea/nodeb, ".*B=(.*?);.*", "$1") 
```

# css - 如何使用 css 做到这一点

> ID：554692
> 
> 赞同：2
> 
> 时间：2009-02-16T21:46:22.383
> 
> 标签：css

我目前正在开发一个 Web 应用程序，我需要以表格方式显示一些字段。例如：

```
-------------------------------------------------- ----
名字：约翰姓氏：史密斯年龄：26
-------------------------------------------------- ----
城市：马德里国家：加拿大颜色：蓝色
-------------------------------------------------
ETC  
-------------------------------------------------
```

字段需要对齐（在上面的示例中，“城镇”应该正好低于“名字”，“国家”应该低于“姓氏”等）。我正在考虑使用一个 html 表（并在每个单元格中放置一个字段名/值），但是在我在这个网站上阅读了所有内容之后，看起来我应该使用 css，因为我想要显示的数据并不是真正的表格。我只是希望它看起来像表格。不过，我找不到用 css 执行此操作的简单方法。有任何想法吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-16T22:06:55.360

在这些情况下，摸索 CSS 是一个 PITA，我几乎总是会建议一个表。正如 Scott 已经说过的，从语义上讲，定义列表将是不错的选择：

```
<dl>
  <dt>First Name</dt><dd>John</dd>
  <dt>Last Name</dt> <dd>Smith</dd>
  <dt>Age</dt>       <dd>26</dd>
  <dt>Town</dt>      <dd>Madrid</dd>
  <dt>Country</dt>   <dd>Canada</dd>
  <dt>Colour</dt>    <dd>Blue</dd>
</dl> 
```

你可以这样设计它：

```
dl {
    margin: 0;
}
dt {
    float: left;
    background: #eee;
    width: 10%;
    margin: 0;
    white-space: nowrap;
    padding: 0.25em;
}
dt:after {
    content: ':';
}
dd {
    float: left;
    width: 20%;
    margin: 0;
    padding: 0.25em;
} 
```

要使每行对齐的 X 值，您必须明确指定每个元素的宽度，这可能并不总是那么实用。虽然要获得新行，但您可以使用 :nth-child 选择器（或为旧浏览器使用属性）并放入`clear: left;`其定义中。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-16T21:55:03.593

我认为您对何时使用 CSS 以及何时使用表格感到有些困惑。当你有这么多数据时，你可能应该使用表。使用 CSS 定位它所在的实际 BOX 很好，但据我所知，框内的数据应该在表格内。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-16T21:55:55.293

这实际上是使用 HTML 表格的绝佳机会。这正是 HTML 表格的用途。数据对我来说看起来很表格。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-16T21:53:30.570

从语义上讲，您可能想要使用定义列表。您可以为 dt 和 dd 元素指定宽度以将它们对齐，然后将它们浮动到左侧。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-16T22:44:25.707

我可能会因为这种反应而被*桌舞者杀死，但***在发展方面，吝啬是一文不值的**。`<b>`使用粗体标签比使用 . 标签更容易`<strong>`。`<i>`使用斜体比使用.更容易`<em>`。

在进行布局时，使用像表格布局这样的古老方法比*正确地做事*和使用语义上正确的标记更容易。

*正确的方法并不总是最简单的方法。*

话虽如此，选择一个合适的基地开始。这里有些人提出了定义列表，我不一定不同意。你几乎可以使用任何列表，真的。

然后根据自己的喜好为您的项目设置样式，使用`float`和`inline-display`块元素。

```
<ul>
  <li class="fname">
    <label>First Name</label> <input type="text" name="fname" />
  </li>
  <li class="lname">
    <label>Last Name</label> <input type="text" name="lname" />
  </li>
</ul> 
```

然后，您可以设置然后浮动这两个 li：

```
ul.userData {margin:0;padding:0;}
ul.userData li {float:left} 
```

甚至为每个 li 设置特定的宽度，因为它们有自己的类：

```
li.fname {width:100px;}
li.fname label {width:50px;margin-right:10px;}
li.fname input {width:40px;} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-16T23:33:57.273

使用表格。表格用于表格数据。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-16T23:39:51.937

使用表格来实现这种布局将无法将演示与内容分开。您的内容是键/值对列表；您想将其显示为 3 x X 网格的事实并不能使其成为表格。

考虑一个屏幕阅读器用户试图浏览这样一个表格；要到达下一个键/值对，他必须决定是向右还是向下。由于元素之间的横向和纵向关系没有区别，他无法做出决定，会迷失方向，不得不猜测。

关于如何以语义上有效的方式标记它有一些选项，但我更喜欢使用无序列表：

```
<ul class="details">
    <li>First name: John</li>
    <li>Last Name: Smith</li>
    <li>Age: 26</li>
    <li>Town: Madrid</li>
    <li>Country: Canada</li>
    <li>Colour: Blue</li>
</ul> 
```

CSS：

```
.details
{
    width:600px;
    margin:0;
    padding:0;
}
.details li
{
    float:left;
    width:200px;
    border-bottom:1px solid #333;
    list-style-type:none;
} 
```

如果值有可能换行，您要么需要修复列表项的高度，要么每隔三个项目清除左浮动。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-16T22:49:46.397

尽管对所有内容都使用嵌套表格绝对是个坏主意，但当您想要显示的是表格时不要害怕使用它们。每个标记标签都是出于某种原因而创建的，而表格标签也是为此目的而创建的。

如果您想更好地了解标记最佳实践以及如何使用 CSS，我推荐这本书是再合适不过的了：

[http://www.amazon.co.uk/Bulletproof-Web-Design-Flexibility-Protecting/dp/0321509021/ref=sr_1_1?ie=UTF8&s=books&qid=1234824362&sr=8-1](http://www.amazon.co.uk/Bulletproof-Web-Design-Flexibility-Protecting/dp/0321509021/ref=sr_1_1?ie=UTF8&s=books&qid=1234824362&sr=8-1)

正是这本书让 CSS 真正吸引了我，并提高了我不断创造的网站的标准。

请记住，当对使用哪个 HTML 标记有疑问时，请考虑它的名称以及可能与之相关的内容。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-17T06:15:55.370

```
------------------------------------------------------
First Name: John   Last Name: Smith   Age: 26
------------------------------------------------------
Town: Madrid       Country: Canada   Colour: Blue 
------------------------------------------------------ 
```

是否只有一个人以这种方式显示？如果是这样，那么不，从语义上讲它不是一个表，它是一个列表。

这是我的规则：表格数据是*只能通过坐标知道其含义*的数据。

```
First name             Last Name                   Age
------------------------------------------------------
John                   Smith                        26
------------------------------------------------------
Jane                   Jones                        23
------------------------------------------------------ 
```

上表中的“23”是什么*意思*？它表示 Jane Jones 的年龄，但您只能知道它在“Age”列下的 Jane Jones 行中，并且您知道这不是她的房子号或她在这里工作的年数。或者，当然，约翰史密斯的年龄。

```
Age: 26 
```

是一个键值对。

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2009-02-16T22:57:40.823

我会去吃桌子。用于`<th>`您的标题和`<td>`您的详细信息：

```
<table>
    <tr>
        <th>First Name:</th>
        <td>John</td>
        <th>Last Name:</th>
        <td>Smith</td>
        <th>Age:</th>
        <td>26</td>
    </tr>
    <tr>
        etc. 
```

# design-patterns - OO设计问题

> ID：554693
> 
> 赞同：1
> 
> 时间：2009-02-16T21:47:02.897
> 
> 标签：design-patterns

当你注意到一个应用程序有很多类时，你会怎么做，但这些类并不是真正的无形对象，而是一组常用函数？

例子：

```
Class Point 
{ 
 calculatePoints(something) {} 
 calculatePointsAnotherWay(something) {} 
} 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-16T22:00:07.263

我会查看这些函数以了解它们如何使用可实例化对象。如果一个函数：

*   将用户定义类型的对象作为参数，
*   从该对象中提取数据，并且
*   基于对这些提取数据的计算产生结果，

那么该函数是成为其参数类的方法的候选者。这种编码有时暗示创建原始类型的程序员或编写“外部”函数（或两者兼而有之）的程序员可能仍在以命令式/过程式风格思考，而不是 OO 风格。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-16T21:50:51.513

如果语言允许，我会让它们成为免费（非成员）功能。如果他们不属于一个类，他们就属于它之外。

如果要对它们进行分组，请将它们放在单独的命名空间中。

当然，在 C# 或 Java 中，这是不可能的，所以我可能会将它们放在一个单独的静态类中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-16T21:54:29.570

将方法和类设为静态（如果可以的话），如果命名错误（例如，Point 对该类来说是一个非常糟糕的名称），则重命名类，然后在适当的情况下移动或重新组合方法。

我的猜测是，您关心的是类的名称。如果周围有很多这样的类，则需要简洁命名，并应遵守[单一职责原则](http://en.wikipedia.org/wiki/Single_responsibility_principle)，而不仅仅是泛型方法分组。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-16T21:53:20.837

根据我的经验，以及从问题中有限的信息来看，在这种情况下您似乎没有什么应该做的。拥有一个仅包含常用函数和子例程的静态对象（不可实例化）是完全合法的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-16T22:07:39.337

正如您将问题命名为 OO 一样。我想您想知道如何将其构建为 OO 代码。

目前，正如您所描述的，作者已经编写了过程代码，但恰好使用了面向对象的语言。

如果您到处都有这样的代码并希望它采用更纯粹的 OO 形式，那么您需要认真研究什么是 OO，以及如何在您的设计中使用它的特性。

这超出了我在这里的答案。我认为一本书或 10 本书应该能让你走上正轨。

这可能是一个好的开始： [http ://www.amazon.com/Object-Oriented-Modeling-Design-James-Rumbaugh/dp/0136298419](https://rads.stackoverflow.com/amzn/click/com/0136298419)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-16T23:22:21.153

听起来您可以将类命名为 PointUtilities，并将函数设为静态。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-16T21:56:52.293

根据我的阅读，对相关函数进行分组显然是对 OOP 世界中类的有效使用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-16T22:05:45.113

可能代码是用程序风格编写的，这本身还不错。我会首先尝试确保所有方法都比较小，不超过 50 行。如果有大型方法，我会将它们拆分为更小的方法。这样，我将确保我有良好的程序设计。同样，如果做得好，过程编程也不是一件坏事。

然后我会寻找参数超过 5 个的方法，并尝试根据参数创建类。然后我会做我称之为 C 到 C++ 的转换：将这些“参数”类与操作它们的方法捆绑在一起，这样 OO 风格就会开始出现。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-16T23:33:48.457

好吧，似乎框架中的常用方法（例如 Java API 中的 java.lang.Math，.NET Framework 类库中的 System.Math）是将这些方法分组到一个静态/最终/密封类中，并使方法 statis/最终/密封。

是的 - 这是一种程序方法。

另一方面，如果您阅读大量书籍（开个玩笑），也许您可​​以使其更加面向对象......

在我看来，在适当的地方我并不反对这种观点——也许最终承认世界不是纯粹面向对象的更容易。:)

# c# - 如何修复 ASP.NET 网站中的 EmbeddedRessources？

> ID：554695
> 
> 赞同：3
> 
> 时间：2009-02-16T21:48:29.397
> 
> 标签：c#, asp.net, reference, invalidoperationexception

我正在尝试在 ASP.NET 的类中引用 js 文件，但收到此错误：

程序集“XXX”包含名称为“XXX”的 Web 资源，但不包含名称为“XXX”的嵌入资源

在网上搜索告诉我，我一定有路径引用问题，但我不知道是什么问题。

这是层次结构

```
<Root>
   <App_Code>
      <Application>
          <MyClass.cs NameSpace="None" />
      </Application>
   </App_Code>
   <JS>
      <MyJSFile.js NameSpace="MyControls" Name="MyJSFile">
   </JS>
</Root> 
```

所以在 MyClass.cs 我有：

```
[assembly: WebResource("MyControls.JS.MyJSFile.js", "text/javascript")]

[ClientScriptResource("MyControls.JS.MyJSFile", "MyControls.JS.MyJSFile.js")]
public class MyClass : ExtenderControlBase
{} 
```

所以我想我在引用时没有得到一些东西：(RootNampeSpace).(Path).(FileName).(Extension)

我的项目是一个 ASP.NET 网站，所以我没有在 Embedded Resources 中设置的 Build Action 属性。

同样在文件夹 App_Code 中，如果我将我的 JS 文件说语言与 App_Code 中的其他文件不同，则会收到错误消息。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-16T22:38:18.280

你会认为这是可能的，但老实说我找不到方法。我可能只是错过了一些非常简单的东西......

您总是有另一种选择，即创建一个单独的类库项目，将您的资源嵌入其中，然后从您的网站项目中引用它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-04T10:40:32.723

> 我的项目是一个 ASP.NET 网站，所以我没有在 Embedded Resources 中设置的 Build Action 属性。

我认为这是你的问题，你不能真正嵌入资源，因为没有构建步骤。如果省略了程序集属性会发生什么？

# compact-framework - C# - 存储然后更新属性

> ID：554709
> 
> 赞同：0
> 
> 时间：2009-02-16T21:52:42.163
> 
> 标签：compact-framework, .net-2.0, properties, c#-2.0

晚上所有，

我编写了一个需要执行更新的传输应用程序，然后更新与该更新对应的日期。IE

```
string content = string.Empty;
IIvdManager manager;
DateTime configDate;

if (table == Tables.Asset)
{
    content = WebService.GetTblAsset(companyId);
    manager = ivdData.Instance.Asset;
    configDate = ivdConfig.LAST_UPDATE_ASSET;
}
else if (table == Tables.Site)
{
    content = WebService.GetTblSite(companyId);
    manager = ivdData.Instance.Site;
    configDate = ivdConfig.LAST_UPDATE_SITE;
}
else if (table...)
{
    ...
}

if (content.Length > 0)
{
    if (UpdateManager(manager, content))
    {
        configDate = DateTime.Now;
    }

} 
```

我想要的是 configDate 属性在我的 ivdConfig 静态类中更新相应的 Date Get/Set。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-16T21:58:04.197

并不是说我认为这是好的代码，但这是您要找的吗？

```
private DateTime configDate;

private DateTime ConfigDate
{
  get { return configDate; }
  set 
  {
    configDate = value;
    ivdConfig.TheDate = value;
  }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-23T17:57:07.680

你考虑过状态模式吗？

子类化您的表（表变量）并添加一个虚拟方法（也许是 Update()？），然后在每个特定的表类型中覆盖该方法。这将完全删除 else ifs，因为它将变成：

```
table.Update(); 
```

将您需要的任何对象传递给此调用，然后从表中取回值（因为它可以在其 Update() 的实现中更新其自己的特定日期属性）。

如果我有错误的一端，我深表歉意，但我不能 100% 确定你的要求是诚实的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-16T21:55:23.483

这听起来很简单，你需要这样做：

```
manager.Date = configDate; 
```

这意味着我几乎肯定是错的......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-16T23:15:26.850

DateTime 类型是值类型，因此上面的代码只会将 ivdConfig.LAST_UPDATE_SITE 的值复制到 dateToUpdate 而不是对的引用。

要解决您的问题，您可以执行以下操作：

```
if (table == Tables.Asset)
{
    content = WebService.GetTblAsset(companyId);
    manager = ivdData.Instance.Asset;
}
else if (table == Tables.Site)
{
    content = WebService.GetTblSite(companyId);
    manager = ivdData.Instance.Site;
}
else if (table...)
{
    ...
}

if ((content.Length > 0) && UpdateManager(manager, content))
{
    DateTime updateDate = DateTime.Now;

    if (table == Tables.Asset)
    {
        ivdConfig.LAST_UPDATE_ASSET = updateDate;
    }
    else if (table == Tables.Site)
    {
        ivdConfig.LAST_UPDATE_SITE = updateDate;
    }
    else if (table...)
    {
        ...
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T07:49:58.017

好吧，确实有 PropertyInfo.SetValue 方法。

# ruby-on-rails - 迁移可以应用于 Ruby on Rails 中的固定装置吗？

> ID：554722
> 
> 赞同：2
> 
> 时间：2009-02-16T21:56:07.537
> 
> 标签：ruby-on-rails, migration, fixtures

我发现在 Ruby on Rails 中使用固定装置有点乏味，部分原因是我需要在大多数迁移后手动更正它们。

有没有办法（插件？）我可以在运行迁移时修改我的固定装置？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T00:19:17.053

添加到上面 womble 的答案，您可以使用 topfunky 的 ar_fixures 插件从您的开发数据库生成固定装置：

[http://github.com/topfunky/ar_fixtures/tree/master](http://github.com/topfunky/ar_fixtures/tree/master)

在我看来，在rails 中仍然有一个小的、管理良好的固定装置的有效位置——就像模拟对象一样……但我们将把它留到另一天！

也值得考虑fixture-sets-for-rails插件，虽然我自己没有使用它： [http](http://thatswhatimtalkingabout.org/news/2006/8/31/fixture-sets-for-rails) ://thatswhatimtalkingabout.org/news/2006/8/31/fixture-sets-for-rails 似乎是一个合理的想法，尽管我对构建大量令人困惑的固定装置非常谨慎 - 当您的域模型发生变化时，您可能必须修复每一个固定装置。我可能会坚持使用模拟（这个插件看起来很旧，可能是在 mocha 出现之前编写的）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T23:48:03.557

Rails 社区中有很多关于使用或不使用固定装置的争论。就我个人而言，我使用的是[factory_girl](http://www.thoughtbot.com/projects/factory_girl)，当我对模型进行更改时，我会手动更新它。

如果您选择使用固定装置，我认为您应该手动更新它们，因为它们是您的测试套件的一部分，它必须检查您的代码是否按预期工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-16T22:08:49.847

我很确定有一个插件可以将数据库的当前内容转储到固定文件中（尽管我不记得它的名字了）。处理此问题的一种方法是加载固定装置，运行迁移，然后使用此插件将固定装置转储出去。

另一方面，如果您的数据库模式发生了变化，那么您的测试条件、极端情况和约束现在可能会有所不同，因此手动检查您的固定装置和测试用例可能不是一个坏主意。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-16T22:10:46.787

我也觉得固定装置有点乏味，这就是为什么我尽量不使用它们。

相反，我使用[mocks](http://en.wikipedia.org/wiki/Mock_Object)。查看[rspec](http://rspec.info/)或[mocha](http://mocha.rubyforge.org/)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T06:04:45.350

Factory Girl 或 Machinist 都是固定装置的绝佳替代品，您只需要定义模型的有效实例，然后根据需要使用任意数量或尽可能少的数量。我使用的是 Machinist，但开始使用 Factory Girl，因为它对模型之间的关联有更好的支持。

# c# - C#：如何将变量放入元标记

> ID：554725
> 
> 赞同：1
> 
> 时间：2009-02-16T21:56:49.563
> 
> 标签：c#, .net

我有一个 html 文件需要每 10 秒刷新一次，所以我在 html 中有这一行：

```
meta http-equiv="Refresh" content="10; url=Default.aspx" 
```

在我的 C# 代码中，我有这个：

```
public partial class _Default : System.Web.UI.Page<Br>
{
  public static List<String> Active_User_List=
      new List<String>(), User_List_To_Remove;
  public static int Refresh_In_Seconds=10;<Br>
  ..
} 
```

如何用变量“Refresh_In_Seconds”替换 10？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-16T22:00:00.430

尝试：

```
<meta http-equiv="Refresh" content="<%=Refresh_In_Seconds%>; url=default.aspx" /> 
```

仅供参考，那可能不应该是静态成员。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T21:59:55.440

用这个：

```
<meta http-equiv="Refresh"
      content="<%= Refresh_In_Seconds %>; url=Default.aspx" /> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-16T22:21:27.633

不要做内联代码黑客，做对了：

```
public partial class _Default : System.Web.UI.Page
{
    private const int _refresh_In_Seconds = 10;

    public override void OnInit(object sender, EventArgs e)
    {
        HtmlMeta meta = new HtmlMeta();
        meta.Name = "refresh";
        meta.Content = _refresh_In_Seconds + "; url=Default.aspx"; 

        this.Header.Controls.Add(meta);
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-16T22:19:01.367

用这个：

```
<meta http-equiv="Refresh" content="<%= _Default.Refresh_In_Seconds %>"; url=Default.aspx" /> 
```

# c# - 提高 C# 代码的性能

> ID：554729
> 
> 赞同：1
> 
> 时间：2009-02-16T21:57:36.147
> 
> 标签：c#, performance, multithreading

如何提高以下情况的性能？

我有一个通过网络接受多个连接的应用程序。该应用程序是用 C# 编写的，并接受 Socket 连接。每五分钟，应用程序需要执行一个函数调用来更新应用程序并将信息报告回套接字。截断的代码如下

```
...
{
    new Thread(Loop).Start();
}

public Loop()
{
    ...
    while (true)
    {
        ...
        string line = user.Read();
        ...
    }
    ...
} 
```

上面的代码是 Socket 连接到服务器时运行的代码。以下代码是每五分钟运行一次的代码。

```
...
{
    new Thread(TryTick).Start();
}

public void TryTick()
{
    while(true)
    {
        Tick();
        Thread.Sleep(new TimeSpan(0, 5, 0));
    }
} 
```

Tick() 执行一些文件 I/O 操作以及解析非常有限（小于 1MB）的 XML 数据集。但是，这段代码对我的处理器的负担比我想象的要多。一旦出现滴答声，系统似乎抓住了我双核开发机的整个Core，不松手。这似乎是一件相当简单的事情，但也许我正在以简单的方式而不是快速的方式来做这件事。

该系统旨在处理多达 100 个用户、更多数据并且在加载期间的响应时间不到 1 秒，因此性能是一个问题。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-16T22:41:47.133

在决定做什么之前，您确实需要分析此代码。. . 如果您无法访问探查器，请添加简单的检测以确定瓶颈所在。从计时 Tick() 开始，以验证它是问题的根源（而不是程序中的其他地方），然后根据需要重复 Tick() 的子部分。

你真的需要在这里进行分析和测量。. . 假设您的性能问题在哪里可能会导致您浪费大量时间。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-17T00:09:54.660

您正在使用一段时间（真）。大多数 .NET 套接字的东西应该实现某种形式的事件处理程序。您可以制作自定义的通用事件处理程序，这样侦听器实际上除了侦听连接并转发到事件之外什么都不做。套接字接收处理程序的一些示例位于[http://www.c-sharpcorner.com/Forums/ShowMessages.aspx?ThreadID=37717](http://www.c-sharpcorner.com/Forums/ShowMessages.aspx?ThreadID=37717)

当您将所有内容放入while循环并使用 Thread.Sleep() 时，您仍在使用处理器，而 Thread 处于“睡眠”状态。

还要确保在使用完线程后执行 Thread.Join()。否则，您最终会得到许多等待工作的线程，除了占用过多的内存和处理器之外什么都不做。

通常，如果你的代码中有一个 while(true) 循环和一个 Thread.Sleep() 你应该问自己是否做错了什么。在大多数情况下，您是，重构的最佳点是找出在不使用资源的情况下处理请求的方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-16T22:02:43.967

您是否尝试过在发布模式下编译以查看速度是否有很大差异？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-16T22:05:12.273

我想我必须知道您在 Tick 中所做的一切以及为什么要在 Tick 中执行此操作，但是每当我处于类似情况时，我都会使用[EventWaitHandles](http://msdn.microsoft.com/en-us/library/kad9xah9.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-16T22:09:38.207

您正在递归调用您的滴答声。顺便说一句，在这种情况下，您可以使用一个完全符合您要求的计时器。另请注意，它可能会在一段时间后给出 stackoverflow 异常 - 因为它是一个线程，所以不会在您的主执行中报告它（为所有未处理的异常设置全局日志以获取有关该异常的信息）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-16T22:32:12.397

您可以查看线程 Tick 和文件读取操作，以查看系统是否可以更好地分配负载。IO 非常昂贵，因此让它在不同的线程上运行有时可以加快速度。为什么不试试[.NET Framework 的 Parallel Extension](http://msdn.microsoft.com/en-us/concurrency/default.aspx)来帮助解决这个问题，它们有一些不错的、简单的 API 函数来帮助使循环并行运行。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-16T23:12:33.300

我注意到在 public Loop() 中，在 while(true) 循环中你没有包含 Thread.Sleep(0)。如果你还没有，你应该考虑添加它。Thread.Sleep(0) 将告诉处理器将分配给该线程的剩余时间用于可能需要它的其他线程/进程。如果没有这样的调用，您实际上是无缘无故地挂在处理器时间上。

```
 public Loop()
  {
      ...
      while (true)
      {
          ...
          string line = user.Read();
          ...
          Thread.Sleep(0);
      }
      ...
  } 
```

这对您来说可能不再是问题，我的建议可能不适用于您的情况，但由于您尚未披露完整来源，因此很难确切知道问题的根源。这只是需要考虑的事情。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-06-07T10:09:33.613

我建议您使用 Timer 并使用 Tick 事件，而不是打开线程并使其进入睡眠状态，这就是它们的用途。

你也应该写下勾号的作用，这样我们可以更好地帮助你

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-02-16T22:03:33.933

看起来您对 Tick() 的调用是递归的。

我还建议您添加一些代码，允许您插入收集有关您关注的功能的更好指标 - 例如运行“Tick”功能需要多长时间。

它真的可以帮助诊断“哎呀！” 诸如此类的问题。

# .net - ADO.NET Entity Framework 生成意外的问题 INSERT

> ID：554731
> 
> 赞同：0
> 
> 时间：2009-02-16T21:58:06.113
> 
> 标签：.net, wpf, linq, entity-framework, ado.net-entity-data-model

我需要一些帮助来理解 ADO.NET 实体框架。

我正在尝试使用 ADO.NET 实体框架表示和操作 WPF TreeView 控件中的分层数据。

[ADO.NET 实体框架对象与父和子 http://img14.imageshack.us/img14/7158/thingpi1.gif](http://img14.imageshack.us/img14/7158/thingpi1.gif)

这些事物中的每一个都有一个单亲和零个或多个孩子。

我的“删除”按钮...

```
私有子按钮DeleteThing_Click(...)
    db.DeleteObject(DirectCast(TreeViewThings.SelectedItem, Thing))
    db.SaveChanges()
结束子

```

我在调试应用程序时正在监视 SQL Server Profiler：

1.  第一个按钮单击删除就好了。
2.  第二个按钮单击插入一个重复的父项（但具有空的 GUID 唯一标识符主键），然后执行删除。
3.  第三个按钮单击失败（违反 PRIMARY KEY 约束），因为它无法插入具有空 GUID 主键的另一行。

意外生成的 T-SQL 重复...

```
exec sp_executesql N'insert [dbo].[Thing]([Id], [ParentId], ...)
values (@0, @1, ...) ',N'@0 uniqueidentifier,@1 uniqueidentifier,...',
@0='00000000-0000-0000-0000-000000000000',
@1='389D987D-79B1-4A9D-970F-CE15F5E3E18A',
...

```

但是，它不仅仅是删除。我的“添加”按钮具有与意外插入类似的行为。它遵循相同的模式。

这让我觉得我如何将这些实体类绑定到 WPF TreeView 或我的数据模型本身存在一个更根本的问题。

这是相关的代码...

XAML...

```
<TreeView Name="TreeViewThings"
          ItemsSource="{Binding}"
          TreeViewItem.Expanded="TreeViewThings_Expanded"
          TreeViewItem.Selected="TreeViewThings_Selected"
          ... >
    <TreeView.Resources>
        <HierarchicalDataTemplate DataType="{x:Type local:Thing}"
                                  ItemsSource="{Binding Children}">
            <TextBlock Text="{Binding Path=Title}" />
        </HierarchicalDataTemplate>
    </TreeView.Resources>
</TreeView>
<Button Name="ButtonAddThing" Content="Add Thing" ... />
<Button Name="ButtonDeleteThing" Content="Delete Thing" ... /> 
```

视觉基本...

```
部分公开课窗口1

    Dim db 作为新事物ProjectEntities

    Private Sub Window1_Loaded(...) 处理 MyBase.Loaded
        TreeViewThings.ItemsSource = _
            从 t 在 db.Thing.Include("Children") _
            哪里（t.Parent 什么都不是）_
            选择
    结束子

    私有子 TreeViewThings_Expanded(...)
        将 ExpandedTreeViewItem 调暗为 TreeViewItem = _
            DirectCast（e.OriginalSource，TreeViewItem）
        LoadTreeViewChildren(ExpandedTreeViewItem)
    结束子

    Sub LoadTreeViewChildren(ByRef Parent As TreeViewItem)
        Dim ParentId As Guid = DirectCast(Parent.DataContext, Thing).Id
        将 ChildThings 调暗为 System.Linq.IQueryable(Of Thing)
        ChildThings = From t In db.Thing.Include("Children") _
                      其中 t.Parent.Id = ParentId _
                      选择
        Parent.ItemsSource = ChildThings
    结束子

    私有子按钮AddThing_Click(...)
        将新事物视为新事物
        NewThing.Id = Guid.NewGuid()
        将 ParentId 调暗为 Guid = _
            DirectCast(TreeViewThings.SelectedItem, Thing).Id
        NewThing.Parent =（从 t 在 db.Thing _
                           其中 t.Id = ParentId _
                           选择 t).First
        ...
        db.AddToThing（新事物）
        db.SaveChanges()
        TreeViewThings.UpdateLayout()
    结束子

    私有子按钮DeleteThing_Click(...)
        db.DeleteObject(DirectCast(TreeViewThings.SelectedItem, Thing))
        db.SaveChanges()
    结束子

    ...

结束类

```

我究竟做错了什么？为什么会产生这些奇怪的插入？

* * *

更新：

我取得了突破。但是，我还是无法解释。

当我为这个问题简化代码时，我已经摆脱了原因。

而不是使用 Linq，例如：

```
从 t 在 db.Thing.Include("Children") 哪里...

```

我一直在使用 Linq，例如：

```
From t In db.Thing.Include("Children").Include("Brand") where ...

```

您会看到，My Thing 实体与另一个 Brand 实体相关。

[ADO.NET 实体框架对象与父子和相关对象 http://img25.imageshack.us/img25/3268/thingbrandct4.gif](http://img25.imageshack.us/img25/3268/thingbrandct4.gif)

我认为这无关紧要，所以我没有将其包含在上面的问题中。

显然，这是在我的 Thing 表中插入意外问题的原因。

但为什么？谁能解释为什么会这样？我想更好地理解它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-24T11:17:54.997

当您已经拥有对象时，为什么在添加新孩子时再次加载父母？虽然这对数据库来说没有问题，但它会在对象级别引入不一致。您可以像这样使用现有的父级：

```
Private Sub ButtonAddThing_Click(...)
    Dim NewThing As New Thing
    NewThing.Id = Guid.NewGuid()
    Dim Parent As Thing = DirectCast(TreeViewThings.SelectedItem, Thing)
    NewThing.Parent = Parent
    ...
    db.AddToThing(NewThing)
    db.SaveChanges()
    TreeViewThings.UpdateLayout()
End Sub 
```

关于删除：您是否在数据库中指定了级联删除？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T20:54:15.603

我没有详细查看代码，但首先要考虑的是您不需要在层次结构的每个级别调用 DeleteObject。EF 像其他 O/RM 一样为您跟踪对象及其关联。

例如，假设您有一个 parent->child 1..* 关系。如果您查询父对象，从父子集合中删除子对象，然后调用 SaveChanges()，EF 将为您生成适当的 DELETE SQL 语句 - 您不需要自己跟踪。

因此，实现您的方案的更好方法是执行以下操作：

1.  从 EF 中查询对象层次结构。
2.  将其绑定到您的 UI。让您的 UI 在您认为合适的时候修改内存中的对象。
3.  完成后，调用 SaveChanges 并让 EF 弄清楚要做什么。

让我知道这是否有帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T15:26:04.313

这里有两件事。我不完全了解他们之间的关系，但我想我可以让你走上你的路。

您需要了解的第一件事是实体框架不能很好地处理删除未完全实现的实例。这就是 Include 改变您所看到的行为的原因。因此，如果您有一个聚合子列表的实体，则需要在调用删除之前加载这些子。只有当子实例在内存中时，它们才会在父实例之前被删除。因此，无论是否包含 Include，您都需要在调用 Delete 之前执行类似的操作。

```
if (!thing.BrandReference.IsLoaded) thing.BrandReference.Load(); 
```

如果你在关系上调用了 Include ，那么如果你没有调用，这将无济于事，那么它将确保一切都在你之前实现

unique 理解的第二件事是[插入一个与现有实体有关系的新实体在概念上是两个不同的插入](http://blogs.msdn.com/alexj/archive/2009/02/20/side-effects-of-first-class-associations.aspx "一流协会的副作用")。这是实体框架中关系是一流的事实的结果。第一个插入是实体本身，第二个是关系。在这种情况下，关系没有单独的表，因此只有一个根据需要实际插入到数据库中。但是，实体框架只有在正确映射的情况下才能解决这个问题。

那么在这种情况下发生了什么？以下是我根据我在这里看到的一些事情的推测。但我认为情况比我描述的还要复杂，所以我认为下面的一些细节是不正确的。不过，它可能足以帮助您解决实际问题。

1.  在您尝试删除它之前，您有一个未完全实现的实例。
2.  当您尝试删除其他内容时，框架会尝试查看相同的关系。它发现事情不正常，并试图将事情恢复到良好状态，但没有成功。
3.  然后你再次尝试删除，重复2次，只是这次更不成功，由于数据库限制。
4.  使用 Include 修复了 1 中的问题。

# coding-style - LabVIEW不鼓励使用集群吗？

> ID：554736
> 
> 赞同：4
> 
> 时间：2009-02-16T21:59:13.507
> 
> 标签：coding-style, labview

我在 LabVIEW[仪器驱动指南](http://www.ni.com/devzone/idnet/library/instrument_driver_guidelines.htm)（第 6.2 节）中找到了这条评论：

> 如果您需要比推荐模式更多的终端，请重新考虑 VI 上的控件和显示控件的分组。除错误输入和错误输出外，避免使用集群以尽量减少终端数量。集群通常需要用户从集群中解绑和重新绑定数据。

如果 National Instruments 不鼓励集群，那么“重新考虑 VI 上的控件和指示器的分组”是什么意思？

我真的很喜欢使用集群，而且我认为它们改进了我的 VI。我错过了什么吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-17T17:41:44.880

我认为这可能是 NI 文档中的措辞不佳。如果一次向仪器或其驱动程序写入或读取许多不同的值是有意义的，那么集群是合适的数据类型。您想尝试避免用户必须将集群中的数据读取出来，以便他们可以在更改一个值的情况下将其写回的情况。使用集群的其他好的一般原则，当然是在可分发/可重用的代码中，如仪器驱动程序，是：

*   将集群保存为严格的 typedef
*   始终按名称捆绑/取消捆绑集群元素。

这样您就可以在不破坏现有代码的情况下更改集群中的内容。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-17T01:16:58.163

捆绑和拆分是相对微不足道的处理器和内存命中，因此除非您在紧密循环中工作，否则不必担心性能。

但是，当连线板开始看起来像杂色豪猪时，许多人会开始将所有内容放入“巨型集群”输入中。虽然这确实有效（有一段时间），但它最终会导致大量不必要的内存膨胀和调试痛苦，因为函数中不需要的东西仍然会在代码中复制。

更糟糕的是，最终可能会为不同的 VI 提供*不同*的巨型集群，然后需要在结构之间进行转换。

我通常觉得最好是，当输入和输出开始变得过多时，返回并将一个 VI 重构为多个，每个 VI 都有一个更小、定义更明确的函数。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-16T22:57:09.077

集群作为一种数据类型很好。NI 不鼓励将数据捆绑到集群中，其唯一目的是将数据传递给 sub-vi。如果您有必须在众多 vis（或 sub-vis）之间共享的数据，那么您应该考虑使用功能全局，或更改您的架构以规范化您的数据。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-11-24T17:34:49.010

正如错误输入和错误输出集群在逻辑上对数据进行分组并允许分层 VI 参数一样，我认为集群的使用也应该遵循这个模型。我同意，应该避免“大型集群”。就个人而言，作为一名前 C++ 开发人员，我不喜欢全局变量（尽管在某些情况下它们是不可避免的）。我写了很多显式的多线程LabVIEW代码，通过消息队列进行线程间通信。（我想这是我的 Windows 开发人员时代的遗产。）如果没有集群或类型定义，消息传递几乎是不可能的。当然，我肯定会使用集群来减少终端上的引脚数量。我认为这没有问题，只要它不过分并且合乎逻辑。

# inversion-of-control - 在 Windsor 容器中使用 DynamicProxy 作为装饰器模式

> ID：554737
> 
> 赞同：2
> 
> 时间：2009-02-16T21:59:32.600
> 
> 标签：inversion-of-control, castle-windsor, decorator, castle-dynamicproxy

我正在寻找有关使用和配置 Windsor 以提供动态代理来拦截对另一个类的实例的调用的一些信息。

我的类表示一个资源，出于性能原因，该资源应该由容器作为长期存在的实例保留。但是，有时此资源可能会转变为不可用状态，并且需要更新。我希望容器来处理这个，所以客户端代码不必这样做。我可以创建自己的工厂来做到这一点，我想知道是否有一些温莎注册很酷可以为我做这件事，所以我不必创建单独的工厂类:)

下面是一些伪代码来演示这个问题：

```
public interface IVeryImportantResource
{
    void SomeOperation();
}

public class RealResource : IVeryImportantResource
{
    public bool Corrupt { get; set; }

    public void SomeOperation()
    {
        //do some real implementation
    }
}

public class RealResourceInterceptor : IInterceptor
{
    private readonly IKernel kernel;

    public RealResourceInterceptor(IKernel Kernel)
    {
        kernel = Kernel;
    }

    public void Intercept(IInvocation invocation)
    {
        RealResource resource = invocation.InvocationTarget as RealResource;

        if(resource.Corrupt)
        {
            //tidy up this instance, as it is corrupt
            kernel.ReleaseComponent(resource);
            RealResource newResource = kernel.Resolve<RealResource>(); //get a new one
            //now what i would like to happen is something like this
            //but this property has no setter, so this doesn't work
            //also, i would like to know how to register RealResourceInterceptor as well RealResourceInterceptor
            invocation.InvocationTarget = newResource;
        }
        invocation.Proceed();
    }
} 
```

任何想法如何实现我的 RealResourceInterceptor 类，以及如何配置容器以使用它？谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-17T02:01:52.347

这个问题更多是关于更新单例组件而不是拦截。这个问题回答了更新单例的[问题](https://stackoverflow.com/questions/85183)。

底线：这并不像看起来那么容易，这种方法有**很多**陷阱。

也许问题在于这个组件被破坏了（为什么会发生这种情况？）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T09:47:38.450

我的对象是 WCF 代理。这些对象将转换为故障状态，使它们无法使用。我无法控制他们何时或是否会过渡。我只能检测到它已经发生，并重新创建一个新代理。

感谢您的链接，下面引用的部分大致描述了我目前的操作方式：

> 或者，另一种方法是使用单例生活方式在容器中注册您的服务的装饰器，但您在容器中注册的实际底层服务具有瞬态生活方式 - 然后当您需要刷新组件时，只需处置持有的瞬态底层组件由装饰器替换它并用一个新解决的实例替换它（使用 components 键而不是服务来解决它，以避免获取装饰器） - 这避免了与其他单例服务（未被“刷新”）持有的问题到过时的服务上，这些服务已经被处理使它们无法使用，但确实需要一些铸造等才能使其工作

我的问题是，而不是其中任何一个：

1）使用静态类型的装饰器来包装我的 RealResource（如上）。一旦你获得了许多这样的代理，为它们创建装饰器就变得很痛苦。

2) 使用创建动态代理的工厂对象来管理任何 WCF 代理的状态。

2) 到目前为止是优越的，但似乎温莎可能已经能为我做些什么。所以，我想知道是否有任何容器 automagic，它可以让我在配置时注册一个拦截器，而不是创建自己的工厂？

像这样的伪代码：

```
container.AddComponent("dynamicProxyWrapper", typeof(IRealResource), typeof(RealResource)).UsingInterceptor(typeof(RealResourceInterceptor)); 
```

# variables - 重新评估 makefile 变量

> ID：554742
> 
> 赞同：11
> 
> 时间：2009-02-16T22:00:13.037
> 
> 标签：variables, makefile

有没有办法在每次使用时重新评估变量的定义？例如：

```
MAP_FILES = $(shell find $(TMP) -name "*.map")

all: generate_map_files work_with_map_files

generate_map_files:
   ./map-builder

work\_with\_map_files: $(MAP_FILES)
   ./map-user

%.map:
   ./map-edit $@ 
```

因此，在读取 makefile 时将评估 MAP_FILES，如果 $TMP 目录中没有 .map 文件，则该变量将为空。但是，在 generate_map_files 规则完成后，目录中会有 .map 文件，我希望这些 .map 文件的列表成为 work_with_map_files 规则的先决条件。

在生成 .map 文件之前，我不知道它们的文件名，因此我无法明确声明带有文件名的变量。生成地图文件后，我需要使用地图文件列表设置变量。任何建议都会非常有帮助。谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-16T22:39:41.990

您可以尝试进行递归制作，例如

```
MAP_FILES = $(shell find $(TMP) -name "*.map")

all: generate_map_files

generate_map_files:
   ./map-builder; $(MAKE) work_with_map_files

work\_with\_map_files: $(MAP_FILES)
   ./map-user

%.map:
   ./map-edit $@ 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-22T05:21:43.683

使用 GNU make，您可以利用 makefile remaking 功能，如果任何包含的 makefile 在初始阶段发生更改，它会导致 GNU make 自动重新启动。例如：

```
.PHONY: map_files.d
-include map_files.d
map_files.d:
        ./map_builder
        echo "work_with_map_files: `ls *.map`" > map_files.d

work_with_map_files:
        ./map_user 
```

除了 makefile 重新制作功能之外，此解决方案还利用了 GNU make 允许您为目标指定多行先决条件这一事实。在这种情况下，映射文件 prereqs 在动态生成的 map_files.d 文件中声明。将 map_files.d 声明为 PHONY 目标可确保在运行构建时始终重新生成它；根据您的需要，这可能合适也可能不合适。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-16T22:13:47.933

一般来说，这在 Makefile 中是不可能的，因为要确定要制作的目标和顺序，`make`需要在执行规则之前提前知道它们的依赖关系。

在您的示例中，如何`make`知道何时评估规则`$(MAP_FILES)`中的`work_with_map_files`？顺序没有明确定义，而是从依赖关系中推导出来的。在您的示例中，您希望在`generate_map_files`执行规则后对其进行评估，但是无法`make`知道这一点，因为它需要知道此变量的值，以确定此值的顺序所需的依赖项被评估——这是一个自我参照的循环。

一个简单的技巧当然是运行两次 make - 您可以通过在模板中的`make work_with_map_files`命令之后添加命令来自动完成此操作，但通常要小心这一点，因为 if实际上会被声明为依赖（它应该）这将导致无限递归循环。当然，这违背了自动确定顺序的想法。否则，您将需要一个可以在此类订单上提示并进行多次通行证的替代品。 `./mapbuilder``generate_map_files``work_with_map_files``generate_map_files``make``make``make`

`Makefile`这就是为什么在具有多个包含文件的较大代码库中，不想`makedepend`在`Makefile`. 要构建一个，然后首先运行`make depend`调用`makedepend`以生成包含文件依赖项，然后运行`make`​​.

# c# - 如何让我的用户控件知道父级何时听到用户控件的 OnHide 事件？

> ID：554743
> 
> 赞同：1
> 
> 时间：2009-02-16T22:00:33.160
> 
> 标签：c#, asp.net, user-controls

我有一个 asp.net 页面，旁边有一个任务栏。单击任务会打开该任务的用户控件，其中包含一些控件和一个关闭按钮。

当通过单击关闭按钮隐藏该用户控件时，如何运行一些 C# 代码？

控件上的大部分内容都被更新面板包围，我现在只想说我*必须*使用它。无论如何，我只会使用 page_unload 事件，但在许多其他实例中都会调用它，而不是我希望调用它的一个实例（窗口正在关闭），部分原因是更新面板。

关闭按钮不是我实现的，它只是用于这些控件的框架的一部分，因此它没有任何代码。

我真正想要完成的只是让一些 C# 代码仅在控件关闭时运行，这实际上只是隐藏了它。有没有类似于 Page_Closing/Hiding 的东西？有的话好像找不到

有什么办法可以做到这一点？

**编辑：**我应该注意到我确实找到了控件的 OnHide 事件，但是这个逻辑背后的代码应该真的在控件中，而不是页面中。主要是因为需要发生的是当控件隐藏时，在控件中设置一些文本，以便稍后加载它时会显示正确的信息。

**编辑：**感谢所有的见解。我仍然无法真正解决问题，teedyay 建议...

“如果您不想处理页面上的代码，请制作您自己的控件版本，从原始版本继承。您可以在其中以更独立的方式处理 OnHide 事件。”

可能是最接近我需要的。我想知道是否有可能将事件从父控件冒泡到用户控件？从逻辑上讲，在我看来这是不可能的，我还没有找到任何关于它的信息，但我想我会问。

**更新：** 我认为退后一步并更清楚地说明我想要完成的事情可能会消除一些混乱。

我有一个用户控件，它是一个悬停在我的主页上的浮动面板。它继承自我没有代码的控件。此控件生成 URL（根据用户请求）并在控件中显示它们，它还显示最后生成的 3 个 URL 的历史记录。

当页面识别出控件 OnHide 事件被触发时，我需要用户控件中的代码来禁用某些按钮并将 url 存储在历史队列中。如何让我的用户控件知道父级何时听到 OnHide 事件？

另外，我是不是在想这个错误，如果是这样，有没有更聪明的方法来做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-16T22:51:36.157

您可以将一个事件放入您的自定义控件中，当用户点击按钮关闭它时触发该事件。发生这种情况时，您可以通过对其进行控制的页面来处理它，并对页面的其余部分或应用程序进行所需的任何更改。如果控件不是您可以访问代码隐藏的自定义控件，那么您可能只想测试它的可见性，这在某些情况下可能会起作用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T22:40:15.513

Page_Unload 事件对您没有好处：这发生在服务器上页面生命周期的末尾——即在页面内容甚至还没有发送到客户端之前。

请记住，网络是无状态的，因此服务器不记得它提供给谁的页面，除非你特意去记住。

如果您正在使用的用户控件有一个关闭按钮，并且您想连接到被单击的那个按钮，那么您只能真正使用该控件的开发人员提供给您的任何界面。在这种情况下，这听起来像是 OnHide 事件是你的方式。

如果您不想在页面上处理该代码，请制作您自己的控件版本，从原始版本继承。您可以在其中以更独立的方式处理 OnHide 事件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T00:16:26.140

我不确定我是否理解正确，您有一个包含“关闭”按钮的用户控件。单击此按钮时，您隐藏了控件，并且想要完成某些操作？

如果您不想在控件中使用它，则可以在隐藏之后将其添加到按钮单击事件中（因为按钮应该有效地隐藏控件吗？）。

如果您不想在页面本身的用户控件之外处理您的操作，您可以简单地添加一个自定义事件（如 Middletone 建议的那样）。这是它的工作原理，在代码隐藏中：

```
/// <summary>
/// This is the Event Delegate
/// </summary>
public delegate void MyEventHandler(object sender, EventArgs e);

/// <summary>
/// This event is thrown when <...>
/// </summary>
public event MyEventHandler NewMyEvent;

/// <summary>
/// Internal event that triggers the external events
/// </summary>
/// <param name="e"></param>
private void OnNewMyEvent(EventArgs e)
{
    if (NewMyEvent != null)
        NewMyEvent(this, e);
} 
```

现在，每当您希望事件被取消时（例如，当关闭按钮的处理完成时）只需调用

```
NewMyEvent(new EventArgs()); 
```

一切就绪。在这种情况下，您可以在设置隐藏命令后调用它。

希望能帮助到你 ：）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-16T23:02:41.263

在自定义控件中，您可以覆盖几种方法 - 特别是：

```
protected override void OnUnload(EventArgs e) {

    // Insert custom code here

    base.OnUnload(e);
} 
```

# sql - 使用 JPA 或在数据库内部级联删除/更新？

> ID：554750
> 
> 赞同：5
> 
> 时间：2009-02-16T22:02:11.597
> 
> 标签：sql, hibernate, jpa, hsqldb, cascade

性能是关键：在数据库内部级联删除/更新更好还是让 Hibernate/JPA 处理它更好？

如果级联位于 DBMS 内部，这会影响查询数据的能力吗？

如果这很重要，我正在使用 HSQLDB。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-22T01:03:01.387

在级联更新的情况下，如果数据库中有外键约束，则根本无法在应用程序空间中执行此操作。

示例：假设您有一个美国各州的查找表，主键是两个字母的缩写。然后你有一个用于引用它的邮寄地址的表格。有人告诉您，您错误地将蒙大拿州的缩写“MO”而不是“MT”，因此您需要在查找表中更改它。

```
CREATE TABLE States (st CHAR(2) PRIMARY KEY, state VARCHAR(20) NOT NULL);
INSERT INTO States VALUES ('MO', 'Montana');

CREATE TABLE Addresses (addr VARCHAR(20), city VARCHAR(20), st CHAR(2), zip CHAR(6),
  FOREIGN KEY (st) REFERENCES States(st));
INSERT INTO Addresses VALUES ('1301 East Sixth Ave.', 'Helena', 'MO', '59620'); 
```

现在您可以在不借助数据库端级联更新的情况下修复错误。下面是一个使用 MySQL 5.0 的测试（假设没有密苏里州的记录，它实际上使用了缩写“MO”）。

```
UPDATE States SET st = 'MT' WHERE st = 'MO';

ERROR 1451 (23000): Cannot delete or update a parent row: 
 a foreign key constraint fails (`test/addresses`, 
 CONSTRAINT `addresses_ibfk_1` FOREIGN KEY (`st`) REFERENCES `states` (`st`))

UPDATE Addresses SET st = 'MT' WHERE st = 'MO';

ERROR 1452 (23000): Cannot add or update a child row: 
 a foreign key constraint fails (`test/addresses`, 
 CONSTRAINT `addresses_ibfk_1` FOREIGN KEY (`st`) REFERENCES `states` (`st`))

UPDATE Addresses JOIN States USING (st)
SET Addresses.st = 'MT', States.st = 'MT'
WHERE States.st = 'MO';

ERROR 1451 (23000): Cannot delete or update a parent row: 
 a foreign key constraint fails (`test/addresses`, 
 CONSTRAINT `addresses_ibfk_1` FOREIGN KEY (`st`) REFERENCES `states` (`st`)) 
```

没有应用程序端的查询可以解决这种情况。您需要在数据库中进行级联更新，以便在执行参照完整性约束之前以原子方式在两个表中执行更新。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T00:03:37.827

1.  正确性是关键

也就是说，在这种情况下，正确性和性能几乎肯定会齐头并进，因为数据库是对数据完整性施加（和强制）硬约束的正确位置，并且在严重的删除级联中它会明显更快，因为它：

*   避免多次往返数据库
*   减少可能必须进行交易的时间
*   可以利用与外键索引相关的内部结构来完成它，而无需锻炼/重用某些执行计划

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T07:58:34.283

**更新：**看起来类似的问题已经在这里回答了[When/Why to use Cascading in SQL Server?](https://stackoverflow.com/questions/59297/whenwhy-to-use-cascading-in-sql-server)

IMO**对您的问题的正确答案**将像往常一样**“视情况而定”**。如果您使用数据库作为敏感信息的存储（例如财务、医疗等），或者如果您的应用程序之外的其他人可以访问数据库，我将投票支持 Hibernate/JPA 方法。如果您的数据库用于记录（例如网站流量等），或者如果您正在开发带有嵌入式数据库的软件，您可以相对安全地使用级联操作。

**2\. 在大多数情况下，我会投票支持 Hibernate/JPA 方法，因为它更易于管理和预测。**

我给你讲一个故事。前段时间，年轻的国家决定改变本国货币（这发生在年轻的国家）。几年后，新的 DBA 在货币表行中看到过时的货币并决定将其删除（谁知道为什么）。猜猜发生了什么？由于级联删除操作，30% 的数据库被删除。具有级联操作的 IMO，您必须非常小心地从一方面删除/更新语句，另一方面您将失去约束（即外键）的能力以进行数据库验证。

# ruby-on-rails - Rails - 按字母顺序分页/导航

> ID：554755
> 
> 赞同：6
> 
> 时间：2009-02-16T22:03:45.397
> 
> 标签：ruby-on-rails, plugins, pagination

是否有可以按字母顺序进行分页/导航的 Rails 插件？

我有一个非常大的数据集，除了 1..2...3...4...5 分页之外，我更喜欢能够为用户提供更直接导航提示的东西。

我可以自己编写代码，但想知道是否已经有一个像样的插件可以为我做这件事。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-17T04:07:57.550

为什么不能将要查看结果的字母表作为参数传递？然后对结果进行分页？那是，

```
# show results of params[:alphabet] alphabet
@results = fetch_results(params[:alphabet]) 
# Use Will Paginate to fetch results internally and give a condition that 
# fetches results starting with the passed alphabet. 
```

并在视图上显示分页结果（编号）`<%= will_paginate @results %>`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T22:44:03.040

我不久前实现了类似的东西（基于流行的 will_paginate 插件）： [实现分组链接](http://www.hennessynet.com/blog/?p=70)。它可以生成如下链接：

[替代文字 http://www.hennessynet.com/blog/wp-content/uploads/2008/09/letters.png](http://www.hennessynet.com/blog/wp-content/uploads/2008/09/letters.png)

注意：我没有更新它以使用命名范围（因为我不需要它们）。如果你想增加对它们的支持，请给我发一个补丁。

# php - PHP标准输入？

> ID：554760
> 
> 赞同：68
> 
> 时间：2009-02-16T22:05:15.253
> 
> 标签：php, file-io, stdin

*我知道 PHP通常*用于没有标准输入的 Web 开发，但 PHP 声称可以用作通用脚本语言，如果您确实遵循它的时髦的基于 Web 的约定。我知道 PHP 用 and 打印到（`stdout`或任何你想调用的东西），这很简单，但我想知道 PHP 脚本如何从（特别是 with ，但任何输入函数都很好）获取输入，或者是这甚至可能吗？`print``echo``stdin``fgetc()`

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2009-02-16T22:08:39.507

例如，可以`stdin`通过创建一个文件句柄来`php://stdin`读取它，然后从中读取`fgets()`一行（或者，如您已经说过的，`fgetc()`对于单个字符）：

```
<?php
$f = fopen( 'php://stdin', 'r' );

while( $line = fgets( $f ) ) {
  echo $line;
}

fclose( $f );
?> 
```

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2010-12-17T23:22:17.477

[推荐](http://php.net/manual/en/wrappers.php.php)从**STDIN**读取

```
<?php
while (FALSE !== ($line = fgets(STDIN))) {
   echo $line;
}
?> 
```

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2012-02-27T12:09:19.813

为了避免弄乱文件句柄，请使用`file_get_contents()`and `php://stdin`：

```
$ echo 'Hello, World!' | php -r 'echo file_get_contents("php://stdin");'
Hello, World! 
```

（如果您正在从您那里读取真正大量的数据，`stdin`您可能想要使用文件句柄方法，但这对于许多兆字节来说应该是好的。）

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2012-03-26T08:33:55.397

一个简单的方法是

```
$var = trim(fgets(STDIN)); 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2014-03-10T21:26:49.310

一口气抓住一切：

```
$contents = file_get_contents("php://stdin");
echo $contents; 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-02-16T22:08:07.713

您可以[`fopen()`](http://www.php.net/fopen)使用`php://stdin`：

```
$f = fopen('php://stdin', 'r'); 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2015-08-14T12:55:22.823

这也有效：

```
$data = stream_get_contents(STDIN); 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-02-16T23:09:29.983

IIRC，您还可以使用以下内容：

```
$in = fopen(STDIN, "r");
$out = fopen(STDOUT, "w"); 
```

技术上相同，但语法更简洁。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2018-03-05T11:50:21.680

使用 fgets 时，如果`stdin`未设置或为空，它可能会阻塞在 bash 脚本中，包括在使用`@` [php 错误控制运算符](http://php.net/manual/en/language.operators.errorcontrol.php)时。

```
#!/usr/bin/php
<?php
$pipe = @trim(fgets(STDIN));
// Script was called with an empty stdin
// Fail to continue, php warning 
```

`stream_set_blocking`通过设置php 标头可以避免这种行为：

```
#!/usr/bin/php
<?php
stream_set_blocking(STDIN, false);
$pipe = @trim(fgets(STDIN));
// Script was called with an empty stdin
// No errors or warnings, continue 
echo $pipe . "!"; 
```

例如，调用如下：

```
echo "Hello world" | ./myPHPscript
// Output "Hello world!"
./myPHPscript
// Output "!" 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-11-06T03:08:18.590

如果您只想阅读单行而没有太多麻烦，请使用内置的 readline() 函数，而不是手动打开 STDIN 流：

```
<?php
$age= readline("Enter your age: ");
echo "Your age is : ".$age; 
```

PHP 文档是你的朋友： [https ://www.php.net/manual/en/function.readline.php](https://www.php.net/manual/en/function.readline.php)

# database-design - 一对一运动的数据库设计

> ID：554761
> 
> 赞同：1
> 
> 时间：2009-02-16T22:05:38.903
> 
> 标签：database-design

假设我正在开发一个应用程序来跟踪拳击结果。跟踪这些以拥有两个表的最佳方法是，如下所示：

```
Boxers
======
id
name

Matches
=======
id
match_number
boxer_id
opponent_id
result 
```

...然后每场比赛有两条记录，一条为获胜者，一条为失败者，如下所示：

```
id match_number boxer_id opponent_id result
-- ------------ -------- ----------- ------
1  1            1001     2001        WIN
2  1            2001     1001        LOSS 
```

...还是我错过了更好的方法来做到这一点？

如果没有存储结果，只是两个对手匹配的记录怎么办？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-16T22:13:57.387

好吧，为了完全标准化，我会选择：

拳击手 - 如引用。

火柴：

```
id  / match_number   (Don't think these need to be distinct anymore)
winner (FK-Boxers; Nullable, for for matches scheduled, but not decided yet) 
```

反对者：

```
id  (meaningless PK value.  Optional. 
     you could use the other two fields as the PK)
match_id
boxer_id 
```

每场比赛在对手中有两行，在比赛中有一排。

（更新以添加其他答案的建议）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-16T22:11:24.007

存储`winner_id`在同一记录中。
这使您可以显示即将到来的战斗，这与建议存储的解决方案不同，`winner_id`并且`loser_id`仅在战斗发生之前不存在赢家或输家的情况下。

### 火柴

*   match_id
*   比赛日期
*   获胜者ID

### 比赛战士

*   match_id
*   战斗机ID

### 战士

*   战斗机ID
*   战斗机名称

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-16T22:15:22.250

存储获胜者 ID 会将 Matches 表中的记录数减少一半。否则存储对手 ID 是没有意义的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-16T22:31:34.677

拳击手如问题

匹配：

```
match_id int pk
winner_id int fk
loser_id int fk
result(_id) int/bool nullable
date
... 
```

如果结果只能是“赢”或“未知”，则可以为空的布尔值就足够了。

如果有不同的结果类型（例如，导致相扑中获胜/失败的技术名称），请使用可为空的 int。

当您存储数据时，您应该始终问自己：我的数据应该能够回答什么样的问题。

# java - 在 Java 中，公开对象的成员是不是一个坏主意？

> ID：554767
> 
> 赞同：7
> 
> 时间：2009-02-16T22:06:52.503
> 
> 标签：java, field, private, encapsulation, public

我的应用程序中有一个数据类。我的应用程序永远不会被用作公共 API，我将是唯一在我的项目中开发代码的人。

我正在努力节省每一盎司的处理器和内存容量。

让我的数据类中的数据成员具有公共/受保护/默认保护以便我不必使用吸气剂是一个坏主意吗？使用吸气剂将需要更多的内存和堆栈的创建等等......我认为这是没有必要的。我可以看到使用 getter 的唯一原因是为了保护/隐私，但如果我是唯一的编码人员并且没有其他人会使用我的 API，那么不使用 getter 是不是一个坏主意？

如果这很愚蠢，请告诉我。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-16T22:21:04.687

如果您要替换 getter/setter 以优化性能/内存，那么您采取了错误的方法。这些几乎肯定不会成为您的应用程序运行缓慢或使用过多内存的原因。

优化的主要罪过是在你知道你需要做之前就去做。仅当您有真实信息向您显示最浪费时间/内存的位置时才进行优化，然后再花时间进行优化。这背后的想法是，通过在占用总运行时间 80% 的代码中节省 5% 的时间，比在仅占总运行时间 5% 的代码中节省 20% 的时间，您将获得更多收益。总运行时间。（同样适用于内存）。

另外，我会按照您的建议小心设计应用程序，因为这意味着某些属性（例如：简单属性）将可以直接访问，而其他属性（更复杂的派生属性或您不想公开的属性）基础类型）将具有 getter/setter。所以你最终会得到混合的访问样式，这将是不太可维护的。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-16T22:23:11.717

将成员公开**作为优化**是一个**坏主意**。正如其他人所说，它几乎不会产生任何影响。但是，如果对象是一个行为很少的简单数据结构，**那么**这样写就可以了。只要您这样做是**为了简单性和可读性**，而不是性能。

 ******* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-16T22:15:05.403

无论如何，微不足道的 getter 和 setter 很有可能会被内联 - 但是对于公共字段，您将失去合同 (API) 和实现之间的区别。即使这只是*您*将使用的 API，保持 IMO 松散耦合也是很好的。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-16T22:15:14.793

Python 的人不使用 getter，他们也不会在地狱中燃烧。

Getter/setter 是一种将类的一部分暴露给 Java 的简单内省的方法。Java Bean 规范依赖于公共 getter 和 setter 来确定哪些属性是重要的。

虽然对于需要/生产/使用 bean 的东西来说是必不可少的，但它不是 OO 编程或 Java 编程的基本特征。它只是 Bean 规范的一部分，对于任何想要参与类似 bean 的事情的类都是必需的。

公共属性很好。它们简单、直接、明显。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-16T22:22:54.870

与任何优化一样，在之前和之后进行测量，看看是否有任何好处可以证明缺点是合理的。

我认为您会发现它不会对代码的性能产生任何明显的影响（但请自己尝试）。JVM 将内联常用的 getter 和 setter。

使用分析器并在您的应用程序中找到真正的热点。没有证据的优化只是猜测。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-16T22:11:38.530

这有点异端，但我同意你的观点，如果你知道没有其他人会使用你的课程，你可以跳过那些东西。我不会在可能被重用的代码中这样做，甚至隐藏在 API 后面，但在你的情况下，它似乎相当安全。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-17T00:19:12.623

我认为这个问题的反面是一个更好的问题：

**让对象成员公开可用是个好主意吗？**

在开发过程中，从使用所需的最低可访问性级别的原则来处理事情通常是一个好主意；换句话说，只公开你需要的尽可能多的数据。如果你普遍应用这个原则，那么它就变成了一种只在需要时共享的做法。

话虽如此 - 为什么要这样做？

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-16T22:13:09.400

我很确定使用的内存量可以忽略不计。如果您为生产环境构建，JVM 甚至可能会根据运行时的实现优化调用以使其内联。如果您自己开发它，它可能仍然有帮助，因为如果您有一个难以跟踪的错误，您可以在 getter/setter 中设置一个断点，并准确查看您何时更改值。它也不应该是任何代码，因为大多数现代 IDE 都具有自动生成代码的功能。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-16T22:24:31.057

考虑一下，一旦您将某些内容放入公共 API 中，它就会一成不变。你不能改变它的名字，你不能改变它的类型，你不能改变它的存储方式。

把它放在一个方法后面不会导致现代虚拟机的性能下降（过去 10 年几乎没有）。

在我看来，从获得价值的方法中获得的灵活性更为重要。

如果您决定将它们公开，请确保将它们标记为最终的并且它们是不可变的。

```
公共课点
{
    公共最终整数 x；
    public final int y；

    公共点（最终 int xVal，最终 int yVal）
    {
        x = xVal；
        y = yVal；
    }
}

```

编辑：

公共 API 是指任何公开的变量，而不是类本身将成为其他开发人员公开 API 的一部分。通过将其公开，您可能会在以后引起自己的问题（如果它是其他开发人员可以访问的“真实”公共 API，除非您喜欢在发布更新时破坏其他人的代码，否则它实际上是一成不变的）。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-16T23:04:08.763

我从不希望我有一个公共领域而不是一个财产，但我无法计算我想要一个财产并拥有一个公共领域的次数。最终你最终会想要其中的逻辑。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-02-16T22:40:18.290

所有过早的优化问题都已在前面的答案中讨论过。

我只是认为值得一提的是，在 Java 中，您可以通过定义一个只有公共成员的类来模仿 C 的结构，如下所示：

```
public class DataClass {
    public int a;
    public String b;
    public char c;
} 
```

并且只能通过引用这些公共成员来访问（获取和设置）。

这个成语在某些特定场景下是完全可以接受的。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-02-16T22:45:56.577

getter 和 setter 不仅仅是为了保护/隐私。主要用途是改变你暴露底层数据的方式。

例如，在 asp.net c# 中，控件的可见属性可能具有以下内容：

```
private bool visible = true;

public bool Visible
{
    get
    {
        return visible && Parent.Visible;
    }
    set
    {
        visible = value;
    }
} 
```

外部属性（访问器/修改器）与底层变量具有不同的含义。此外，如果您在开始时没有上述功能，那么当您有简单的获取/设置时，它就会成为您以后可以轻松添加的东西。

至于性能点，您可以节省每一盎司的处理器和内存。如果这会产生明显的影响，那么您最好还是看看另一种语言。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-16T22:13:18.073

这并不愚蠢，但我认为这可能也不是一个好主意。

我理解这种诱惑......如果没有其他人使用过该代码，那么您无需担心。但一次又一次，事实证明这与实际发生的情况不符......您发现您将在比您想象的更多地方使用它，或者项目变得比预期更大，或者某人只是掌握了它并认为它很有用……本来不应该永久或公开的事物有办法变成那样。

处理器能力和内存真的有那么严格的限制吗？我不知道你的情况（也许是嵌入式应用程序？），但作为一个（过度概括的）规则，你最好在其他地方寻找资源......在你的数据结构、算法或架构中看到更好的改进内存或 CPU。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-02-16T22:16:37.583

你永远不知道，总是像阅读你的代码的人知道你住在哪里并且是连环杀手一样编写代码。即使您只是为自己开发代码，尝试 (imo) 就像您在团队中开发一样。通过这种方式，您将习惯于构建可读的最佳实践代码。至于性能开销，如果你真的真的真的需要你的每一点内存和你的 CPU 的每个周期，也许最好用 C 之类的东西来做。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-02-16T22:28:50.330

恕我直言，对于本质上只是被动地保存数据并且不能做任何更复杂的事情而不从 API 用户的角度完全改变其含义的属性，getter 和 setter 只是不必要的样板。如果该属性是，并且就其性质而言，显然永远都是，只是一个数据持有者，例如与 C 结构类似使用的类，那么只需将愚蠢的事情公开。作为一个更笼统的说法，如果过度热心地应用最佳实践，而不考虑为什么它们是最佳实践，则很容易成为浪费时间甚至是最糟糕的实践。哎呀，即使 goto 有时也可以说是合理的。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-02-16T22:52:59.180

使用的潜在缺点

> `public final` *输入* *变量*`;`

代替

> `private final` *输入* *变量*`;`
> 
> `public` *输入* `get`*var* `() {return` *var* `;}`

（我亲身经历过）包括：

*   前景——不管现在看起来多么不可能——表示将需要在基类或未来的某个子类中改变。

*   混合暴露的不可变类型和可变类型字段的潜在尴尬。

*   记住哪些类使用`public final`和哪些使用`get`*var*的麻烦。

*   向以后可能会看到源代码的其他人解释这种不一致的麻烦。

即使我尝试过，我也无法说服自己这是值得的。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-02-16T23:20:54.697

我创建了两个小类，并测试它们。

*   首先，我创建了一个对象作为原型。

*   然后我创建了一个 2,000,000 数组来存储它们。

*   然后我运行了一个循环，在那里创建一个新实例并从原型中获取值。

比较每一个的平均结果（以秒为单位）是：

```
WithGS  Without
1.1323  1.1116

Diff  = 0.0207 secs. 
```

**因此，对于这种情况，我认为首先**有一个未优化的解决方案会更好，一旦不需要进一步的要求，就继续进行分析。

这是代码：

```
PersonGetSet.java

public class PersonGetSet {
    private String name;
    private boolean deceased;

    public void setName( String name ) {
        this.name = name;
    }
    public String getName() {
        return name;
    }

    public void setDeceased( boolean deceased ) {
        this.deceased = deceased;
    }
    public boolean isDeceased() {
        return this.deceased;
    }

    public static void main( String [] args )  {
        PersonGetSet pb = new PersonGetSet();
        pb.setName( "name" );
        pb.setDeceased( true ) ;

        long start = System.currentTimeMillis();
        PersonGetSet [] array = new PersonGetSet[2000000];
        for( int i = 0 ; i < array.length; i++ ) {
            PersonGetSet personGs = new PersonGetSet();
            personGs.setName( pb.getName() );
            personGs.setDeceased( pb.isDeceased() );
            array[i] =  personGs;
        }
        System.out.println( "PersonGetSet took " + ( System.currentTimeMillis() - start ) + " ms. " );
    }
}

Person.java

public class Person {
    String name;
    boolean deceased;
    public static void main( String [] args )  {
        Person pb = new Person();
        pb.name=  "name" ;
        pb.deceased = true;

        long start = System.currentTimeMillis();
        Person [] array = new Person[2000000];
        for( int i = 0 ; i < array.length; i++ ) {
            Person simplePerson = new Person();
            simplePerson.name=  pb.name;
            simplePerson.deceased = pb.deceased;
            array[i] =  simplePerson;
        }
        System.out.println( "Person took " + ( System.currentTimeMillis() - start ) + " ms. " );
    }
} 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-02-17T22:57:06.273

如果您的首要任务是性能，您应该研究您选择的 Java 虚拟机以及它如何执行程序。Sun 的 Desktop Java 花费大量时间分析和编译 Java 字节码为机器码，这导致程序运行速度可能非常快，但会占用大量内存。

如果你发现你想使用基于 HotSpot 的 JVM，你应该研究所有的技巧来帮助它。getter 和 setter 通常是内联的（即直接在机器代码中替换，而不是调用子例程）并且常量是折叠的。小范围的 switch 语句通常转换为跳转表。

通常我发现“head-under-the-arm”方法适用于编写大部分代码，然后你分析正在运行的代码并找到瓶颈。例如，我发现 StringBuffers 在很多事情上都很快，但 deleteCharAt(0) 不是其中之一。重写以对字符串使用简单的迭代而不是在字符串缓冲区中删除，确实很神奇。您也很可能会发现最大的好处在于算法——而不是小捷径。

在 C 世界中，人类几乎无法再聪明地超越编译器了。在 Java 世界中，人类可以通过直接编写 Java 来帮助 HotSpot。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-02-20T18:46:44.403

在我们的团队中，我们使用以下规则：如果类字段表示的状态是可变的，则始终将其设为私有并提供修改器；但是，如果它是不可变的（即在类实例化后不会重新分配），那么它可以被声明为`public final [type] [field-name]`-- 访问安全。

请注意，这里的“不可变状态”具体意味着该字段被声明为`final`. 不应与`public [immutable-type] [field-name]`可以执行重新分配的位置混淆，尽管不可变类型实例本身是不可变的。

请注意，即使对于不可变字段，也有很多充分的理由拥有访问器。例如，在读取字段时需要执行某些操作（例如安全检查）的情况。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-02-16T22:16:34.773

任何堆栈的使用都将是高度暂时的，无论如何都不是确定性的。您可能会发现编译器无论如何都会优化任何不必要的开销，因此您可能会发现实际上没有任何收获。

我同意私有非 API 类使用公共成员不一定是坏事，但你获得的东西太少（如果有的话）我不会打扰。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-02-16T22:17:46.783

从谁编写代码以及谁将使用它的角度来看，无论是您还是其他任何人都没有关系，您可能仍然需要 getter 和 setter - 如果以后有人在事实上的公众中使用它API。

但是，如果它真的只是数据并且您不需要与该类相关的任何行为，那么一定要让成员公开。

对我来说，类是否有任何行为，或者您是否可能想要更改其数据成员的名称或类型作为真正重要的实现细节。

至于处理器能力和内存——你测量过吗？

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-02-17T12:50:35.047

你需要吸气剂*吗*？也就是说，您的对象是否应该为您工作，而不是您的客户获取数据值并自己执行工作？

OOP 的一个关键方面是告诉一个对象做某事，而不是把这些部分拿出来自己做。例如

```
double ret = myObj.calculateReturn() 
```

对比

```
int v = myObj.getValue();
int ov = myObj.getOldValue();
double ret = (v-ov)/ov * 100; // do I work about dividing by zero etc.? 
```

我看到很多。通常你确实需要getter（也许还有setter），但是当我写一个getter时，我总是问自己是否应该公开这些数据，或者对象是否应该为我完全隐藏它。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2009-02-22T02:43:21.177

该代码仅供您自己使用的论点是一个非常容易陷入的陷阱 - 大多数代码都是这种情况，公开暴露的位通常非常小。因此，假设大多数代码都是供私人使用的，为什么还要使用 private、protected、final、const (C/C++) - 我知道的反驳问题，但我希望这一点很清楚。

这里遗漏的另一件事是锁定。如果您直接访问成员，您将只能在整个对象或成员级别锁定此代码。并且该锁定将由使用代码控制，而不是对象本身。也许可以，也许不行，因为在所有事情上，它都是课程的马。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2009-02-22T03:20:37.717

如果性能至关重要，我建议仅在同一类中访问时将字段设为私有，如果在另一个类中访问则将它们设为本地包。如果你给一个内部/嵌套类私有字段，编译器将添加/使用访问器方法（因为 VM 不允许类访问另一个类中的字段，即使 Java 允许）

拥有公共可变字段对我来说是一个设计问题。跨包拆分性能关键代码并不意味着您需要对性能关键代码进行严格编码。

如果您有不可变的字段，那么如果字段改变行为，您期望更高的开发成本，那么公开该字段是没有问题的。事实上，我建议使用公共不可变字段，如果您认为这会使代码更简单/更容易理解。

然而，首要任务仍然应该是代码的可读性。最简单的代码通常也表现最好。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2009-02-16T23:01:47.193

如果速度如此关键，那么用 C 或 C++ 编写它可能是值得的。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2009-02-17T13:13:43.980

公开非最终字段**总是**一个坏主意。

如果您以后想添加事件通知怎么办？

如果您以后想要子类化并更改行为怎么办？

如果您想强制执行一些跨领域约束怎么办？

TofuBeer 显示了一个带有 final 字段的 Point 类——没关系。但是，AWT 中的 Point 类不使用 final，并且在 Java 早期让我很伤心。

我正在编写一些 3D 代码并希望将 Point 子类化，这样每当 x 和 y 更改时，我都可以根据需要自动调整 z。因为 Point 的字段是公开的，所以无法知道 x 或 y 何时更改！

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2009-02-17T07:15:50.470

设计你永远不需要的功能（getter/setter）和过早的优化一样糟糕。如果这真的只是供您使用，请不要将其公开，然后构建您认为最简单的结构。

只有当您确实需要优化和/或吸气剂时，才应添加它们。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2011-03-26T11:20:51.027

一般来说：如果你想手动优化某些东西，你应该考虑架构改进而不是这种微优化。在许多情况下，微优化可以由工具自动完成。

对于 Java：有 ProGuard 工具，可以做很多优化。但是，如果您使用现代 JVM（例如 HotSpot 或 OpenJDK），则 JVM 可以即时执行这些优化。如果您有一个长时间运行的应用程序，ProGuard 可能会对性能产生轻微影响。

# java - 根据其成员项的“toString”值按字母顺序对 Java 集合进行排序

> ID：554769
> 
> 赞同：26
> 
> 时间：2009-02-16T22:06:56.233
> 
> 标签：java, sorting, collections

假设我有一个名为 Foo 的用户定义 Java 类，例如：

```
public class Foo 
{

    private String aField;

    @Override
    public String toString()
    {
        return aField;
    }

} 
```

和一个集合，例如：

```
List<Foo> aList; 
```

我要做的是根据每个成员返回的“.toString()”值按字母顺序对列表进行排序。

我曾尝试使用 Collections.sort() 方法，但结果不是我想要的。我需要做什么才能做到这一点？

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2009-02-16T22:15:32.780

```
Collections.sort(fooList,
                 new Comparator<Foo>()
                 {
                     public int compare(Foo f1, Foo f2)
                     {
                         return f1.toString().compareTo(f2.toString());
                     }        
                 }); 
```

假设 toString 永远不会返回 null 并且列表中没有 null 项。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-02-16T22:09:03.577

使用指定比较器的 API `sort(List list, Comparator c)`，并按照您的意愿实施。

或者，如果您不是特别需要 List，请使用 a [`SortedSet`](http://java.sun.com/javase/6/docs/api/java/util/SortedSet.html)，比较器也是如此。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-09-07T00:20:28.293

[google-collections使用](http://code.google.com/p/google-collections/)[Ordering](http://google-collections.googlecode.com/svn/trunk/javadoc/com/google/common/collect/Ordering.html)使这变得非常容易：

```
Collections.sort(list, Ordering.usingToString()); 
```

引入一个完整的第 3 方库只是为了使用您可以使用 Comparator（正如其他人提供的那样）轻松编写的东西是否值得？不，但是 google-collections 太酷了，出于许多其他原因，您无论如何都想拥有它。

在排序方面，您还可以轻松地执行反转之类的操作：

```
Ordering.usingToString().reverse(); 
```

或打破关系：

```
Ordering.usingToString().compound(someOtherComparator); 
```

或处理空值：

```
Ordering.usingToString().nullsFirst(); 
```

等等，但是那里还有很多东西（当然不仅仅是与排序相关的），它们会导致真正富有表现力的代码。看看这个！

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-16T22:14:22.690

```
public class Foo
   implements Comparable<Foo>
{

    private String aField;

    public Foo(String s)
       {
       aField=s;
        }

    public String getAField()
        {
        return aField;
        }

   public int compareTo(Foo other)
        {
        return getAField().compareTo(other.getAField());
        }

    @Override
    public String toString()
    {
    return getAField();
    }

} 
```

进而

Collections.sort(list);

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-16T22:20:16.093

我会做一些与皮埃尔非常相似的事情：

```
public class Foo implements Comparable<Foo>
{
    private String aField;

    @Override
    public String toString()
    {
        return aField;
    }

    public int compareTo(Foo o)
    {
        return this.toString().compareTo(o.toString());
    }
} 
```

然后，像皮埃尔一样，我会`Collections.sort(list)`按照皮埃尔的建议使用。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2016-12-07T16:12:48.413

Java 8 版本：

```
list.sort(Comparator.comparing(Object::toString)); 
```

或流式传输：

```
List<Foo> sortedList = unsortedList
    .stream()
    .sorted(Comparator.comparing(Object::toString)))
    .collect(Collectors.toList()); 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-16T22:19:52.130

我强烈建议您仅将 toString 用于调试目的...但是...扩展 Yuval A 上面写的内容...

```
公共课 X
    实现比较器
{
    公共 int 比较（最终 Foo a，最终 Foo b）
    {
        返回 (a.toString().compareTo(b.toString()));
    }
}

```

但是，您确实应该让 Foo 实现 Comarable 或编写一个不使用 toString 的适当 Compartor。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-09-06T14:04:10.593

lambdaj 允许您对集合进行排序、过滤和一般操作，而无需编写循环或晦涩的内部类。例如，您要求的排序可以如下实现：

```
sort(foos, on(Foo.class).toString()); 
```

如果您对它感兴趣，请查看：

[http://code.google.com/p/lambdaj/](http://code.google.com/p/lambdaj/)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-16T22:13:09.930

如果您希望集合保持排序，而不是在特定点对其进行排序，您可以将其放入具有已定义比较器的 TreeSet 中。否则，我会使用 Yuval 已经提到的 Collections.sort 方法。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-09-14T07:15:53.127

## 对 POJO int 属性（升序或降序）的 ArrayList 进行排序：

```
Collections.sort(myPojoList, (a, b) -> a.getId() - b.getId()); //ASC
Collections.sort(myPojoList, (a, b) -> b.getId() - a.getId()); //DESC

//Alternatively use Integer.compare()
Collections.sort(myPojoList, (a, b) -> Integer.compare(a.getId(), b.getId())); //ASC
Collections.sort(myPojoList, (a, b) -> Integer.compare(b.getId(), a.getId())); //DESC 
```

## 在 POJO String 属性上对 ArrayList 进行排序：

```
Collections.sort(myPojoList, (a, b) -> a.getName().compareTo(b.getName())); //ASC
Collections.sort(myPojoList, (a, b) -> b.getName().compareTo(a.getName())); //DESC 
```

## 在 POJO 布尔属性上排序 ArrayList：

```
Collections.sort(myPojoList, (a, b) -> Boolean.compare(a.isMale(), b.isMale())); //ASC
Collections.sort(myPojoList, (a, b) -> Boolean.compare(b.isMale(), a.isMale())); //DESC 
```

## *额外：获取不同的 ArrayList*

```
myPojoList= new ArrayList<>(new LinkedHashSet<>(myPojoList)); //Distinct 
```

# javascript - 如何在 JavaScript 中的线程之间进行通信？

> ID：554783
> 
> 赞同：2
> 
> 时间：2009-02-16T22:11:09.717
> 
> 标签：javascript, multithreading, firefox, firefox-addon

我在 C++ 中为 FireFox 扩展创建了一个 XPCOM 对象。我正在使用工作线程来监听事件，当它发生时，我需要在主线程上做一些事情。显然，我不能只是坐在主线程上的 JavaScript 中等待，因为您需要能够使用浏览器（我的事件很少发生）。

我尝试在线程中执行此操作（xpcom guy 向 javascript 发送事件）：

```
window.setTimeout( myImportantWorkFunction, 100 ); 
```

这有效（在主线程上，如预期的那样），但它会无限期地暂停。它不会按预期在 100 毫秒后发生。您必须单击一下或调整窗口大小，然后突然调用该函数。就像 JavaScript 突然醒了。我认为这是因为它发生在一个线程中。

工人有没有更好的方法让主线程做点什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-16T22:19:32.613

JavaScript 只有一个线程。函数调用总是阻塞，直到它们返回。如果你是从 JS 到浏览器（在这种情况下是浏览器的扩展）通信，你应该确保你的浏览器端代码立即返回到 JS，并记住在你的工作完成时调用的回调（这就是 setTimeout作品）。

我怀疑“点击”只是一个巧合。您是否尝试过在事件触发后立即发出警报？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T14:24:47.590

对于那些关心的人，我放弃了尝试在线程之间发送消息。我找到了一种用一些 Objective-C++ 编译 XPCOM 对象的方法，这样我就可以使用他们的 NSDistributedNotificationCenter。这让我可以在 javascript 满意的主线程上获取我的事件。

这个问题仍然有效，但我现在可能不会花时间验证任何人的答案......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-29T09:31:38.517

你试过[https://developer.mozilla.org/en/nsISupports_proxies](https://developer.mozilla.org/en/nsISupports_proxies)吗？

# asp.net-mvc - ASP.NET MVC：将复杂类型绑定到选择

> ID：554790
> 
> 赞同：19
> 
> 时间：2009-02-16T22:12:12.367
> 
> 标签：asp.net-mvc, binding

我正在尝试确定是否有将复杂类型绑定到表单元素的内置支持。

使用一个常见的假设情况：我有一个属于某个类别的产品实体 - 模型看起来像这样：

```
public class Product
{
    public int ID { get; set; }
    public string Description { get; set; }
    public Category Category { get; set; }
}
public class Category
{
    public int ID { get; set; }
    public string Title { get; set; }
} 
```

使用 ASP.Net MVC 框架创建一个表单来水合一个只包含简单值类型的新实体非常简单，例如：

```
public ActionResult Create(Product product); 
```

但是，在您的实体包含其他复杂类型的上述场景中呢？是否有内置机制将 IEnumerable< *T* > 绑定到下拉列表，然后在提交表单时自动水合正确的*T ？*

手动完成是相当微不足道的 - 我只是想确定我可以免费获得什么。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-16T23:38:33.987

我还没有尝试将 DefaultModelBinder 用于复杂类型，但您始终可以使用[MvcContrib](http://www.codeplex.com/MVCContrib)的 CastleBind（从[Castle Project](http://castleproject.org/)借来），它可以轻松地为您提供复杂的类型绑定，包括数组。

见[http://blogger.forgottenskies.com/?p=258](http://blogger.forgottenskies.com/?p=258)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-10-06T23:27:54.470

请检查[这个](http://msmvps.com/blogs/luisabreu/archive/2009/05/06/the-s-arp-framework-the-sharpmodelbinder.aspx)，因为我认为这谈到了你的问题，似乎 S#arp 家伙已经解决了它，如果你不使用他们的东西，它很容易“撕裂”。

无论如何，我认为从用户发布的任何内容中自动加载实体有点危险......必须考虑一下。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-16T23:07:39.863

我认为最接近的方法是覆盖`ToString()`类中的方法以将有意义的信息输出到 DropDownList - 但仅此而已。

您可以将 IEnumerable 集合绑定到 DropDownList，然后在提交表单时检索其 SelectedItem - 这是我能想到的最便宜的方式。

# python - Stackless python 网络性能随着时间的推移而下降？

> ID：554805
> 
> 赞同：8
> 
> 时间：2009-02-16T22:16:06.883
> 
> 标签：python, performance, networking, io, python-stackless

所以我在玩stackless python，编写一个*非常简单*的网络服务器来教自己使用微线程/tasklet 编程。但是现在我的问题是，当我`ab -n 100000 -c 50 http://192.168.0.192/`在 apache bench 中运行类似（100k 个请求，50 个并发）之类的东西时，我得到类似 6k req/s 的东西，第二次运行它我得到 5.5k，第三次 5k，第四次，4.5k等一直到 100req/s 或其他东西。

不过，当我重新启动 python 脚本时，问题就消失了。

现在我的问题是为什么？我忘记删除小任务了吗？我已经检查了 stackless.getrunco​​unt() （由于某种原因，它似乎总是返回 1），所以它似乎不会有任何死的 tasklet 闲逛？我尝试在所有已完成的小任务上调用 .kill() ，但没有帮助。我就是想不通这个。

```
import socket
import select
import stackless
import time

class socket_wrapper(object):
    def __init__(self, sock, sockets):
        super(socket_wrapper, self).__init__()
        self.sock = sock
        self.fileno = sock.fileno
        self.sockets_list = sockets
        self.channel = stackless.channel()
        self.writable = False
        self.error = False

    def remove(self):
        self.sock.close()
        self.sockets_list.remove(self)

    def send(self, data):
        self.sock.send(data)

    def push(self, bytes):
        self.channel.send(self.sock.recv(bytes))

def stackless_accept(accept, handler, recv_size=1024, timeout=0):
    sockets = [accept]

    while True:
        read, write, error = select.select(sockets, sockets, sockets, timeout)

        for sock in read:
            if sock is accept:
                # Accept socket and create wrapper
                sock = socket_wrapper(sock.accept()[0], sockets)

                # Create tasklett for this connection
                tasklet = stackless.tasklet(handler)
                tasklet.setup(sock)

                # Store socket
                sockets.append(sock)

            else:
                # Send data to handler
                sock.push(recv_size)

        # Tag all writable sockets
        for sock in write:
            if sock is not accept:
                sock.writable = True

        # Tag all faulty sockets
        for sock in error:
            if sock is not accept:
                sock.error = True
            else:
                pass # should do something here if the main socket is faulty

        timeout = 0 if socket else 1
        stackless.schedule() 

def simple_handler(tsock):
    data = ""

    while data[-4:] != "\r\n\r\n":
        data += tsock.channel.receive()

    while not tsock.writable and not tsock.error:
        stackless.schedule()

    if not tsock.error:
        tsock.send("HTTP/1.1 200 OK\r\nContent-length: 8\r\n\r\nHi there")
        tsock.remove()

sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
sock.bind(("192.168.0.192", 8000))
sock.listen(5)

stackless.tasklet(stackless_accept)(sock, simple_handler)
stackless.run() 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-16T22:52:41.693

两件事情。

首先，请让 Class Name 以大写字母开头。它更传统，更容易阅读。

更重要的是，在`stackless_accept`函数中你积累了`list`一个`Sock`名为`sockets`. 这个列表似乎在无限增长。是的，你有一个`remove`，但它并不*总是*被调用。如果套接字出现错误，那么它似乎将永远留在集合中。

# vim - 如何使用 vim 自定义缩进文件？

> ID：554815
> 
> 赞同：5
> 
> 时间：2009-02-16T22:19:03.317
> 
> 标签：vim, binary, indentation

我最近阅读了有关在 Vim 中缩进源文件的[文章。](http://vim.wikia.com/wiki/Indenting_source_code)但是，我希望能够自定义缩进其中的一些。当我按下 = 时，有没有办法指定运行哪个二进制文件？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-16T22:21:24.980

从帮助：

```
={motion} 通过外部程序过滤 {motion} 行
                用 'equalprg' 选项给出。当'equalprg'
                选项为空（这是默认设置），使用
                内部格式化函数|C-缩进|。但当
                'indentexpr' 不为空，它将被使用
                |缩进表达式|。

```

看起来设置`equalprg`选项是您想要的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-16T22:24:47.173

您可以设置`equalprg`- 选项。（请参阅 :he = 了解更多信息）。

# java - Java Applet - MVC - 如何将模型绑定到视图？

> ID：554816
> 
> 赞同：0
> 
> 时间：2009-02-16T22:19:17.607
> 
> 标签：java, model-view-controller, binding, model, view

构建一个具有与模型数据绑定并在模型更新时更新的组件的视图的小程序的最简单方法是什么？

理想情况下代码尽可能少，最好没有/声明性:)

如果需要解释组件类型，请考虑使用 String getText() 访问器将文本绑定到 bean 的 JLabel - 但如果这只是简单的愚蠢，请给我一个更好的例子！

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-16T22:37:13.913

首先想到的是`PropertyChangeListener`在 bean 上注册 a ，它会在其`propertyChange`方法中更新标签的文本。这是链接模型和视图的常用方式，向模型添加一个监听器，它会在任何相关更改上更新视图。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T22:51:33.100

除非您的模型非常小，否则数据绑定不是那么容易：

[http://www.jgoodies.com/](http://www.jgoodies.com/)示例：[http ://www.java2s.com/Code/Java/Swing-Components/Data-Binding.htmjgoodies](http://www.java2s.com/Code/Java/Swing-Components/Data-Binding.htmjgoodies)

BeansBinding：[http ://www.artima.com/forums/flat.jsp?forum=276&thread=213997](http://www.artima.com/forums/flat.jsp?forum=276&thread=213997)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T14:16:33.280

我建议避免`PropertyChangeEvent`使用 s 和任何愚蠢的东西。

制作细粒度模型：例如，表示一段文本的模型（文档难以使用且重量级，但您可以使用适配器）。您还需要能够对约束（例如整数边界）和派生模型进行建模。那么你的“真正的”“业务”可以是复合的，没有设置器或事件处理。避免在模型中重复数据。

有了简单的模型，连接到组件很容易。例如，要创建一个连接到文本模型的标签，有一个工厂方法来获取文本模型并返回一个新的连接`JLabel`。

# jquery - 单击 div，但希望子元素对单击做出反应

> ID：554817
> 
> 赞同：0
> 
> 时间：2009-02-16T22:19:19.043
> 
> 标签：jquery, ajax

我的 dom 看起来像这样：

```
<div class="profile">
       <a href="#"><img src="/img1.gif" /></a> <b>100</b>
       <a href="#"><img src="/img2.gif" /></a>
</div> 
```

好的，所以我的页面上有很多这样的元素，所以使用 jQuery 我绑定了所有这样的事件：

```
$(".profile").live('click', myCallback);

var myCallback = function(event) {
         // ??
}; 
```

现在，当有人点击第一个超链接时，我想将图像更改为“/img1_on.gif”，然后对网页进行 ajax 调用并替换**与返回的值。**

 **单击另一个图像时会发生同样的事情，除了图像更改为“/img2_on.gif”并转到另一个 URL。

如果我转换它会更容易吗**进入一个div并添加一些css？**

 *** * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-16T22:33:22.923

```
$(".profile a").live("click", function(e) {
  var temp = $("img", this);
  var temp2 = temp.attr("src").split('.');

  temp.attr("src", temp2[0] + "_on" + temp2[1]);

  // Ajax goes here.

  e.preventDefault();
}); 
```

您拥有它，以便 div 是被点击的那个，而不是 div 内的链接。假设您填写了 ajax 部分，此功能应该适合您。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T22:37:03.680

我不完全确定你在问什么，但如果你想找到导致点击事件的元素，你可以使用 e.target，然后从那里使用 $(e.target)。像这样的东西。

```
$(".profile").live('click', function(e){
  if($(e.target).is("a"))
     $(e.target).find("img").attr("src","/new/url.jpg");
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-16T22:40:13.063

例如，仅选择子链接（*这*将是链接）：

```
$(".profile > a") 
```

对于图像（*这*将是要操作的图像）：

```
$(".profile > a > img").live("click", function(event) {
    var src = $(this).attr("src");
    $(this).attr("src", src.replace(".gif", "_on.gif"));
    // ajax call in any way you prefer
    // in callback you can switch button state back
}); 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-17T01:22:12.537

您会发现这篇[文章](http://www.quirksmode.org/js/events_order.html)准确地解释了事件顺序是什么，在捕获或冒泡阶段监听事件意味着什么以及何时取消进一步的事件传播。

# regex - Visual Studio 搜索问题

> ID：554819
> 
> 赞同：0
> 
> 时间：2009-02-16T22:19:40.913
> 
> 标签：regex, search, ide, visual-studio-2005

我在 VS2005 中遇到问题。当我尝试使用正则表达式选项搜索文件时，我只收到一条错误消息说明

```
Unknown argument for ':' operator. Complete Regular Expression required in search string. 
```

我尝试使用的模式是有效的，并且可以在其他文本编辑器中使用：

```
<asp:textbox.+?(type="text"|size=|autocomplete=|class=|value=) 
```

如何让这种模式与 VS2005 搜索一起使用？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-16T22:33:41.193

这是有效的：

```
\<asp\:textbox.+?(type=\"text\"|size=|autocomplete=|class=|value=) 
```

但我认为 .+ 有错误**？**部分。没有它我可以得到匹配：

```
// <asp:textboxtype="text" 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-16T22:25:10.933

尝试： `< asp\:textbox.+?(type="text"|size=|autocomplete=|class=|value=)`

（添加小于和“asp”之间的空白以安抚 wmd 编辑器。它不应该在那里）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-16T22:48:37.490

您的错误的具体原因是 Visual Studio 正则表达式搜索使用 : 来指示字符类型，并且 :te 不是字符属性。用 \ 转义 : 会导致它被读取为 :。

# .net - 从 .NET 应用程序执行 SQL Server 脚本的最佳实践？

> ID：554842
> 
> 赞同：4
> 
> 时间：2009-02-16T22:31:30.590
> 
> 标签：.net, sql-server

从 .NET 应用程序中执行 SQL Server 脚本的推荐方法是什么？为什么？

我正在创建一个应用程序，我们可以在安装应用程序的早期版本时从我们的安装程序运行以处理升级我们的数据库。数据库有一个版本表，我可以通过编程方式访问并确定要运行哪些升级脚本来升级数据库。将它嵌入到我们的安装程序可以调用以进行升级的应用程序中对我来说是有意义的。

我正在寻找如何最好地执行适当的升级脚本。在网上搜索我看到了通过“GO”语句拆分脚本并使用[SqlCommand.ExecuteNonQuery()](http://www.mattberther.com/2005/04/11/executing-a-sql-script-using-adonet/)的建议。我还看到了使用[SQL Server Management Objects (SMO)](http://msdn.microsoft.com/en-us/library/ms162169.aspx)的建议。

我正在寻找有关从 .NET 应用程序中执行这些脚本的各种方法的优缺点的建议。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-16T23:01:55.930

尽管它可能无法特别满足您在 .NET 应用程序中运行的需求，但[sqlcmd](http://msdn.microsoft.com/en-us/library/ms162773.aspx)非常适合（并且设计为）此过程。通过实现解析和运行 SQL 脚本的能力，您可以复制工具功能。sqlcmd 在可以与您的应用程序捆绑在一起的[独立安装程序中可用。](http://www.microsoft.com/downloads/details.aspx?familyid=d09c1d60-a13c-4479-9b91-9e8b9d835cdc&displaylang=en)

如果您选择使用链接的 SqlCommand.ExecuteNonQuery() 解决方案，则大型脚本将脚本读入较小的缓冲区以搜索“GO”语句“而不是一次性”将更节省内存。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T23:00:45.357

我使用 System.Diagnostics.Process 并调用 OSQL.exe 得到了一致的结果。它是为一个 sql 文件制作的....

我创建了一个临时文件，在其中编写了我的嵌入式 sql 文件，让 OSQL 执行它，然后清理它。

```
 process.StartInfo = new System.Diagnostics.ProcessStartInfo();
    process.StartInfo.FileName = OSQLpath;
    process.StartInfo.UseShellExecute = false;
    ...
    if (!System.IO.Directory.Exists(workingDirectory))
                        System.IO.Directory.CreateDirectory(workingDirectory);
    ...
    StringBuilder sbArgs = new StringBuilder();

    sbArgs.Append("-S ").Append(_serverName);
    sbArgs.Append(" -d ").Append(_databaseName);
    sbArgs.Append(" -E");
    sbArgs.Append(" -i ").Append("\"").Append(inputSQLFilePath).Append("\""); // input file
    sbArgs.Append(" -o ").Append("\"").Append(System.IO.Path.Combine(workingDirectory, String.Format("osqloutput_{1}_{0}.txt", fileUnique, fileName))).Append("\""); // output file

    process.StartInfo.RedirectStandardOutput = true;
    process.StartInfo.RedirectStandardError = true;

    process.StartInfo.Arguments = sbArgs.ToString();
    process.StartInfo.WindowStyle = System.Diagnostics.ProcessWindowStyle.Hidden;
    process.StartInfo.CreateNoWindow = true;

...

    System.Windows.Forms.Cursor.Current = System.Windows.Forms.Cursors.WaitCursor;
    process.Start();
    process.WaitForExit(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T15:23:35.163

最好的方法是满足所有功能性和非功能性限制的任何方法。

您需要什么样的速度，目前的情况有什么问题您的备份/故障策略是什么

我可能会使用 SqlCommand.ExecuteNonQuery() 因为它是 .net 运行时的一部分，不需要额外安装用户可能不需要的应用程序。

根据您的问题，我认为现有的应用程序包含大量嵌入式查询字符串。我会尝试将它们放入某种存储库中，该存储库会自动将它们放置在服务器上（作为存储过程）和您的代码中。

不要害怕简单的文本文件或其他带有查询的配置文件。

# c++ - 如果我有一点其他编程经验，学习 C++ 的最佳方式是什么？

> ID：554847
> 
> 赞同：22
> 
> 时间：2009-02-16T22:32:56.483
> 
> 标签：c++

只是想了解一下您对我学习 C++ 的策略的看法。虽然我知道掌握一门编程语言需要数年时间，但我只是想尽快达到我被认为有能力的地步。为什么要快？好吧，当我说得*很快*时，我真的是在说我已经承诺了，而且我不希望它永远永远不会永远存在。如果需要五年时间才能胜任，那就需要五年时间。我不期待 24 小时或 30 天。

关于我：我没有计算机科学学位，我有人类学学位和图书馆学硕士学位。学习大 O 表示法等 CS 基础知识，以及二叉树和链表等基础知识，排序算法一直是一个挑战。可能没有什么可以替代良好的 CS 学位。:( 我确实有多年的编程经验，从 2001 年开始使用 PHP，2003 年开始使用 ActionScript，不久之后使用 JavaScript。我已经用 Python 编写程序大约两年了，我已经学习了 C（通过阅读 K&R 的书并写了一些程序），但我可能不会被聘为 C 工作。最近还学习了 Objective C。我目前在一个网站担任 JavaScript 和 Python 和 CSS 开发人员。

无论如何，这是我的策略：阅读 Stroustrup 的书（我刚开始第 I 部分），同时开始一个简单的 C++ 项目，同时做许多 Stroustrup 练习。

想法？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-02-16T22:39:02.723

Bjarne 的书很棒，尤其是对于 C++ 语法，但真正能让你成为称职的 C++ 程序员的一本书是 Meyers 的[Effective C++](https://rads.stackoverflow.com/amzn/click/com/0321334876)。得到它。阅读。

我也没有计算机科学学位，但我为硅谷的一家初创公司工作。有可能，你只需要知道那里有什么并且永远不要停止学习。许多获得计算机科学学位的学生最终会使用他们没有学习过的语言工作，所以一定要打好基础。如果你听到一些你不熟悉的东西，一定要找一本好书和一家咖啡店去看看。C++ 会及时出现 - 与 Stroustrup 和 Meyers 一起，你已经掌握了精通 C++ 所需的 90%

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-02-16T22:40:55.200

我通常的建议是将 C 和 C++ 分开。不要假设 C 建议或最佳实践适用于 C++，反之亦然。记住这一点可能会帮助你避免很多坏习惯。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-16T22:38:25.737

真正变得更好的关键之一是让其他人看看你的代码。当别人对你的代码说“WTF”时，你可以改进它并从错误中吸取教训。

尝试使用代码分析工具，尝试使用 C++ 约定（例如 google 的[http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml](http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml)），尝试使用 valgrind 进行内存泄漏检测。学习如何手动编写 Make 脚本，尝试一些跨平台编译，看看哪些部分比较棘手。

您可能还想看看一些流行的库，例如 boost。

从项目开始，将其开源，以便人们可以查看它并给你建议。要真正整合您缺乏 CS 教育，请获取一篇科学论文并尝试使用 c++ 实现它。检查结果并进行比较。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-16T22:41:54.357

我不认为 Stroustrop 的书是一个很好的起点。它更像是一本高级/参考书。我会从[Thinking in C++（第 1 卷）](https://rads.stackoverflow.com/amzn/click/com/0139798099)（和[第 2](https://rads.stackoverflow.com/amzn/click/com/0130353132)卷）开始。并编写大量代码。一旦你对代码有了基本的掌握，我就会得到 Scott Meyer Effective C++ 书籍，当然还有 Stroustrop 书籍。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-17T08:51:44.263

这是我建议的阅读/学习清单

*   首先阅读 Thinking in C++ 第一版（直接了解语法）
*   阅读 Scott Meyer 的《Effective C++》一书（了解更细微的差别）

之后，您可以分支到以下内容。您可以跳过除第一个以外的所有内容。您可以使用 boost、STL 来学习这些 1 学习使用字符串和其他容器（知道何时使用哪个容器） 2 假设您已经了解 XML，学习使用 C++ 中的 XML（可能编写一个 WBXML 到 XML 转换器） 3复习您的 TCP/IP 基础知识，（可能编写简单的基于 XMPP 的聊天客户端） 4 您可能希望学习一些 GUI 工具包 GTK+、Qt、MFC 等

此时，您可能想扩展阅读有关设计模式的内容。我推荐“设计模式解释”。

在您使用 C++ 工作了一年多之后，您可能想阅读“深入 C++ 对象模型”等内容。

另外，我不建议您阅读 Stroustrup，而是阅读 YMMV。

高温高压

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-11-12T00:31:21.900

学习[Qt](http://qt.nokia.com/)。相信我；我以开发各种 C++ 应用程序为生。带有 Qt 的 C++ 让您的工作效率无限提高。我曾经结合了这么多不同的库（Boost、Intel、数据库连接器等），只是为了实现我们所做的那种东西（高性能/实时计算）。最后，我发现我需要的 80% 以上已经包含在 Qt 中了。

更不用说，imo，Qt 在我工作过的任何框架/库上都有最好的文档，这使得自己学习一切变得*非常*容易。

试试看，自己看看。

免责声明：我只是一名开发人员——我不为诺基亚工作。=p

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-16T22:36:26.787

听起来不错。开始吧！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-16T22:39:01.553

听起来你在正确的轨道上；

1) 为自己设置难度不断增加的迷你项目（Hello World、Lottery Picker 等）

2）找一两本包含练习的好书，可以作为参考。

我读它已经有 15 年了，但我似乎记得 Stroustrup 的书并不是“如何学习……”C++ 书籍中最友好的。您可能想在亚马逊上花一些时间并进行一些比较。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-16T22:39:37.230

坦率地说，如果您在学习 C 方面做得很好，并且您已经完成了面向对象的编程（因为您已经学习了目标 C），那么您无需过度考虑学习 C++ 的方法。

也就是说，你的计划很好。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-16T22:40:15.653

如果你对 C 有很强的掌握，那么一旦你对 OOP 概念有了很好的掌握，C++ 就不是一个巨大的飞跃……希望你能从精通 Python 中获得。来自 C，在 C++ 中学习的最大的事情是真正熟悉标准模板库 (STL)，所有微妙的东西都伴随着使用它而来。

就个人而言，我认为 Stroustrup 的书对于学习语言来说并不是那么好，它更像是一个参考。我会推荐[C++ Primer Plus](https://rads.stackoverflow.com/amzn/click/com/0672326973)作为一本更好的书和 Meyers 的[Effective C++ 书籍](https://rads.stackoverflow.com/amzn/click/com/0321334876)，以便真正学习连贯地使用该语言。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-16T22:41:10.817

还请务必查看[How Not to Program in C++](https://rads.stackoverflow.com/amzn/click/com/1886411956)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-16T22:41:50.097

有几十种[学习](http://en.wikipedia.org/wiki/Learning_styles)方式。你选择了一个你认为对你有用的。

您有具体的问题或问题吗？例如，你的问题真的是请求增加或不同的书吗？如果您不问比“想法？”更具体的问题，您可能不会得到很多真正符合您实际寻找的答案。

顺便说一句，程序是目标导向的。你的学习也要以目标为导向。你的问题，同样必须是目标导向的。编程是关于有形的、具体的细节。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-16T22:45:23.583

如果您正在阅读这本 Stroustrup 书籍：

C++ 编程语言
[http://www.research.att.com/~bs/3rd.html](http://www.research.att.com/~bs/3rd.html)

并且发现它很难......它可以是。您可能想要切换并从这个开始：

编程——使用 C++ 的原理和实践
[http://www.research.att.com/~bs/programming.html](http://www.research.att.com/~bs/programming.html)

# dependency-injection - 依赖注入框架值得额外的间接层吗？

> ID：554868
> 
> 赞同：11
> 
> 时间：2009-02-16T22:40:16.760
> 
> 标签：dependency-injection

您是否发现依赖注入框架使代码更难遵循？间接性是否大于好处？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-16T22:44:00.810

是的，您的代码变得更加解耦并且更加可测试。当您有大量测试并且每个测试都需要一个沉重的对象（例如数据库层）时，这尤其会变得很方便。

如果您使用依赖注入，您可以简单地创建所谓的“模拟”对象或存根，并使用它们让您的测试更快地运行并减少副作用（数据库状态）。

确实不能通过查看代码直接看到使用了哪个实现。您将看到对该界面的引用。一个好的 IDE 可能具有查看特定接口的所有实现的功能，因此请充分利用它。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-16T22:58:37.280

对于非平凡的“企业”应用程序，是的，这是值得的。在 DI 框架出现之前，每家商店都在其他项目使用的一些内部库中实现了自己花哨的*“ServiceLocator”*类。所以你在整个代码库中都调用了那个东西。

这些调用代表对象需要发现/配置它们自己的依赖项。DI 框架消除了所有这些代码，因此您的对象变得更简单，因此更易于测试。

现在，如果您的对象依赖项没有太多可变性，那么间接（集中配置）的价值对您来说就更少了。

有关将 DI 与 ServiceLocator 进行对比的更多详细信息，请参阅 Fowler 的[控制容器反转和依赖注入模式](http://martinfowler.com/articles/injection.html)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-17T00:33:26.600

我发现自定义静态 HashTable 工厂可以很好地解耦我的依赖关系并满足我的需求。我已经尝试过几次使用完整的 IOC 容器，每次我都对团队其他成员必须忍受的学习曲线（和所有配置）感到吃惊......或者我的香草没有附加功能。

所以，我猜依赖注入的更大问题不在于模式本身，而在于它目前在开发者社区中产生的时尚。这听起来很酷，所以使用它有压力，即使工程不是由相应的要求驱动的。

我们倾向于拿一把大枪来对付蚊子，因为这把枪看起来很酷。

磷

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-20T17:06:39.683

DI 的好处很难一目了然。可测试性是最明显的。我将尝试创造一个非常简短的例子来说明这些好处。想象一下您的应用程序正在使用某个数据库提供程序。如果您让所有代码只看到 DB 提供程序接口，您将轻松地从一种实现切换到另一种实现。现在，如果您制作企业应用程序，那么不依赖特定的数据库提供商可能是非常可取的，例如当客户已经购买了数据库许可证时。这实际上是依赖于接口而不是实现的好处。到现在为止还挺好。现在，我需要以某种方式抓住我的具体对象。我的具体对象只能是具体提供者的一个实例。我该怎么做？

1.  使用 new 创建对象。
    我必须重新编译项目才能分发它。一个巨大的缺点：必须测试、部署、维护新的代码分支等。
2.  使用工厂。
    我的代码将洒满获取工厂并获取实例的代码。此外，我将不得不返回一个通用实例并将其转换为我期望的对象类型。如果没有，我每次添加工厂创建的新对象时都必须更改工厂接口。
3.  使用服务定位器。
    与 2 类似。只是，取决于服务定位器可能并不总是存在，如 Java JNDI。

DI 将这一点外部化并采取注入是单独关注的方法。您的对象应该关注领域，而不是寻找合适的合作者。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-17T01:09:20.117

我最初喜欢依赖注入框架的想法，但除了支持单元测试之外，我仍然不相信使用依赖注入框架的好处。对于接管我的项目的人来说，这意味着多了一种框架/API/技术来学习，并且在某些情况下实际上可能更冗长。您可以在这两个相互竞争的博客条目的优缺点上找到一个很好的来回

[对于 DI 框架](http://kohari.org/2007/08/15/defending-dependency-injection/)

[反对 DI 框架](http://scruffylookingcatherder.com/archive/2007/08/07/dependency-injection.aspx)

归根结底是它是否*真的*减少了耦合并增加了凝聚力，或者它只是将问题推到了表面之下。在我现在的项目中，我认为它没有太多需要，即使支持单元测试也是如此。如果你打算为 C# 挑选一个，我强烈推荐 Ninject。它是轻量级、简单且完全流畅的配置……没有 XML！甜:)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-16T22:46:35.467

在我看来，依赖注入框架不会使代码阅读起来更复杂。您只看到对接口的引用而不是对具体实现的引用这一事实很好——因为您不必关心具体实现是如何工作的。

如果浏览源代码太困难，请获取 Resharper，一切都很好。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-16T23:01:08.910

依赖注入是一个绝妙的主意；*尽管胜利*的很大一部分在于您可以纯粹为接口编写代码。它强制（或鼓励）您将程序中的关注点分成多个协作的服务类型实例，这些实例不知道彼此是如何实现的*。*这使得您不太可能在类之间引入不需要的和不必要的依赖关系。

然而，控制反转并不是唯一的方法。一位同事通过编写自己的`JNDI`. 我花了很长时间才赢得我的认可，但它非常棒，并且只有典型[Spring](http://www.springframework.org)项目的一小部分配置。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-17T01:11:58.783

您可以设计您的类以注入其依赖项（通过构造函数或属性），而无需使用依赖项注入框架。只需自己实例化依赖项并将其传入或从您一起折腾的服务定位器或注册表类中获取它。但是，与其让类本身通过调用服务定位器来解决其依赖关系，不如让实例化该类的类为它解决依赖关系。您可以维护可测试的类设计，而无需其他库和框架的开销和复杂性。

我一个人知道，每当我尝试使用 DI 框架时，这基本上就是我真正最终使用它的全部目的。我还看到人们将他们的 DI 容器包装在一个静态 IoC 类中以在层次结构中构建对象的情况，在我看来，这种做法违背了目的；那时不是刚刚回到服务定位器吗？我想我在实际使用中不太明白。我说的是恶作剧，你正在使用反射并在初创公司大受打击来做同样的事情。

您无法消除依赖关系，但您肯定可以在 XML 配置文件中混淆它们。在某些时候，*有些东西*会调用`new`。您真的要在不重新编译或重新测试您的应用程序的情况下更换接口的实现吗？如果没有，请保持简单。很高兴单击“查找定义”并看到在服务定位器类中实际实例化的东西具有显式单例或`ThreadStatic`其他行为。

只是我的两分钱——我对 DI 框架仍然很陌生，但这是我目前的思路：控制反转很有用，但实际的框架本身可能只适用于非常大的项目。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-16T22:44:58.827

我认为好处取决于你如何使用它。

例如，在我当前的项目中，我们使用 dep inj 根据应用配置注入不同的项目，特别是单元测试。一个很好的例子是让生产系统使用真正的“登录”实现，但让单元测试使用模拟“登录”，它总是为知道登录返回真/有效，但没有其他人。

# .net - 为什么 .Net 中存在“密封”关键字？

> ID：554894
> 
> 赞同：14
> 
> 时间：2009-02-16T22:47:35.557
> 
> 标签：.net, keyword, sealed

.Net 框架中的大量类被标记为“密封”，从而阻止您用自己的类继承这些类。当然，这违背了面向对象的本质，您可以在其中扩展和重新定义现有对象的行为。

“密封”关键字的存在是否有充分的理由？

> *例如，Silverlight 中的 NotifyCollectionChangedEventArgs 是密封的。我想创建自己的支持 AddRange 和 RemoveRange 的 ObservableCollection 版本，但是 NCCEA 的 Silverlight 版本不提供支持 NewItems 和 OldItems 属性的多个项目的构造函数，这些项目已经定义为 IList。通常，我只是用我自己的变体来扩展这个类，它覆盖了 NewItems 和 OldItems 属性，但在这种情况下，我不能，而且我看不出为什么会这样。*

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-16T22:59:33.767

设计可扩展的类（或框架）并非易事，简单地说，继承并不是面向对象编程的单一原则。

因此`sealed`存在允许开发人员/设计师表达和保留这些意图。密封类还可以通过减少维护负担让他们的生活更轻松。它允许原始开发人员控制类（或框架）的扩展方式，因此他们可以进行内部更改而不必担心破坏其他代码的更改。

一个原则是开发人员应该默认密封任何**叶**类。然后，当开发人员有意创建一个未密封的类时，它会迫使他们考虑可扩展性。

* * *

参考：Eric Lippert -[为什么这么多框架类是密封的？](http://blogs.msdn.com/b/ericlippert/archive/2004/01/22/61803.aspx)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-16T22:50:15.863

我今天问的一个有点相关的问题的答案可能有助于澄清密封类的目的：

> 在我开始研究自己的可重用库之前，我发现自己也在问同样的问题。很多时候，如果不要求实现者的晦涩或神秘的调用序列，您就无法扩展某些类。
> 
> 当允许扩展你的类时，你必须问：如果开发人员扩展了我的类，并将这个新类传递给我的库，我可以透明地使用这个新类吗？我可以正常使用这个新课程吗？这个新班级真的会表现得一样吗？
> 
> 我发现大多数时候 .Net 框架中的密封类具有某些您不知道的底层要求，并且鉴于当前的实现不能安全地暴露给子类。

[Liskov 替换和组合](https://stackoverflow.com/questions/554145/liskov-substition-and-composition/554192#554192)

现在点击该链接并为实际作者投票。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-16T22:49:58.563

简短的回答是，因为微软是这么说的。更长的答案是微软提供了一种扩展密封类的机制，称为扩展方法。

一般来说，扩展没有源代码的类是个坏主意。例如，你不知道调用基方法对对象的内部数据做了什么。是的，您可以使用反射器或其他任何东西来解决它，但通常使用组合或扩展方法要好得多。

您还必须考虑继承实际上是什么。它不仅仅是一种改变类的方法，它还提供了多态性。如果您更改字符串类的语义，然后将新的字符串类传递给期望字符串以特定方式起作用的对象，该怎么办？密封本质上强制执行该对象将始终按照您期望的方式工作的合同。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-16T22:55:07.083

无需深入挖掘，了解 Microsoft 倾向于在存在潜在的安全性、可维护性或向后兼容性问题而必须在下游处理时密封一个类。例如，`System.String`出于安全和性能原因而被密封。

在这种特殊情况下，您需要询问 Microsoft 开发人员为什么选择密封该类。然而，我最近阅读的架构指导文献倾向于支持“除非你**知道**它需要扩展，否则密封”的方法。该文献倾向于在可能的情况下使用扩展方法。（我并不是说我同意它；我只是说这就是我最近一直在阅读的内容。）

即使该类没有密封，所讨论的属性也可能不是虚拟的，这仍然会让您陷入困境。

在您的特定情况下，我会使用具有您自己唯一名称的扩展方法。这是关于你能做的一切。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-16T22:50:02.400

虽然我同意 .NET 可能密封太多，但它通常是为了保护生态系统的完整性。当您的首要任务之一是保持整体框架/API/运行时稳定，并且类之间存在一些脆弱的相互依赖关系时，防止人们覆盖该行为并无意中破坏核心功能可能是最安全的。

尽管如此，我确实倾向于认为 .NET 团队封装了太多类。密封有时可能只是开发人员的懒惰，因为适当的类设计工作量太大。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-16T23:33:34.200

我建议除了保护无知的错误之外，没有充分的理由封闭课程，我的意思是无辜的。你知道那句老话，“给他们足够的绳索，他们就会上吊”。让他们动摇我说。也许这是我的 C++ 背景，但我很自在地知道，如果我不勤奋，我有能力把事情完全塞满。

我倾向于通过界面编程。接口当然是公共的，任何人都可以自由地提供自己的实现，以遵守接口所表达的约定。我实现这些接口的具体类往往是私有的，并被标记为内部和/或私有。我不觉得我需要密封这样的课程。

在需要代码重用的地方，我避免通过继承重用，偏爱组合和其他技术。

密封也可能对被认为是普通旧数据类型的类型有效，但我不相信这种方式会枯萎。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-16T23:00:43.733

视情况而定，有些类打算被实例化（继承，如果存在，仅用于简化实现），其他类打算被继承以提供特定的实现。

密封类有一些优点：

*   他们没有任何虚拟方法，因此他们不必担心非“异常安全”实现的覆盖方法。
*   如果一个类是不可变的，它可以保持和保证不变性。

否则，如果您想用“舒适”方法装饰密封类，请使用扩展方法 (C# 3.0)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-16T23:13:29.287

仅仅因为某物是一个对象，并不意味着它应该总是对每个人都敞开大门来扩展或重新定义它的行为。

一个很好的类比是门和锁。门的本质是让人通过，这就是它的目的。然而，大多数门都设计有锁，可以限制人们通过它们的能力。决定一扇门是否有锁以及该锁是否默认锁定由房间的建筑师决定，取决于房间里有什么以及谁应该可以访问它，而不是它是一扇门的事实。

当然，如果特定建筑物中的大多数门默认都被锁定，这可能会令人沮丧，特别是如果你真的想通过一扇门。:-) 我自己去过那里，我也问过同样的问题。简短的回答是，有时在设计一个复杂的框架时，人们往往会在更谨慎的方面犯一些错误，并且默认情况下密封类，除非有明确的场景需要扩展它们。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-07-27T12:28:41.933

我发现sealed 关键字有用的实际用途之一是避免“脆弱的类问题”。这是一个视频，显示了一个脆弱的基类问题[http://www.youtube.com/watch?v=xnA3RUJcyY4](http://www.youtube.com/watch?v=xnA3RUJcyY4)

让我详细解释一下。

考虑下面的场景，我们有一个名为“DbParent”的父类和一个虚拟方法“Insert”。

类 DbParent {

```
 public virtual void Insert()
    {
        Console.WriteLine("Parent insert");
    } 
```

}

下面是一个简单的子类，它有自己的“插入”实现，安装在不同的位置。

```
 class DbChildClass : DbParent
  {
  public void  Insert()
    {
        Console.WriteLine("Child inserts");
    } 
```

}

现在让我们说，经过几个月的部署，父类开发人员在不了解对子类的影响的情况下，去添加一个新方法“Add”。这个“添加”方法在内部调用“插入”方法（下面是相同的代码片段）。

```
 class DbParent
  {
  public  void Add() // Adds method with out consulting
  {
  this.Insert();
  }

  public virtual void Insert()
  {
        Console.WriteLine("Parent insert");
  }
  } 
```

现在，通过创建子类对象调用“Add”方法的客户端程序期望调用“Child”类“Insert”实现。

```
 DbChildClass o = new DbChildClass();
  o.Add();
  Console.Read(); 
```

但是哇哦，如果你运行下面的代码，你会看到父类“Insert”被调用，这不是预期的。

所以我会把课程标记为“密封”以避免此类问题。

# apache-flex - Flex 3 UI ActionScript 编程入门

> ID：554899
> 
> 赞同：1
> 
> 时间：2009-02-16T22:48:54.620
> 
> 标签：apache-flex, actionscript-3

在 ActionScript 中开始 Flex 3 UI 编程有什么好的资源吗？如果有人有任何想法，我会遇到以下问题。它的尺寸合适，但我的按钮没有显示出来。有人有想法么？

```
package 
{
    import flash.display.*;

    import mx.controls.Button;
    import mx.controls.TileList;
    import mx.controls.sliderClasses.Slider;
    import mx.controls.ProgressBar;

    import flash.net.FileReferenceList;

    [SWF(width="720", height="480", backgroundColor="#ffffff", framerate="30")]

    public class PhotoUploader extends Sprite
    {
        var AddPhotosButton:Button;
        var RemovePhotoButton:Button;
        var UploadPhotosButton:Button;

        public function PhotoUploader():void
        {
            stage.scaleMode = StageScaleMode.NO_SCALE;
            stage.align = StageAlign.TOP_LEFT;

            AddPhotosButton = new Button();
            AddPhotosButton.x = 10;
            AddPhotosButton.y = 10;
            AddPhotosButton.width = 100;
            AddPhotosButton.height = 20;

            RemovePhotoButton = new Button();
            UploadPhotosButton = new Button();

            addChild(AddPhotosButton);
            addChild(RemovePhotoButton);
            addChild(UploadPhotosButton);
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-17T00:32:28.473

对于真正的 Flex 应用程序，我认为您需要从顶层`mx.core.Application`（通常在 MXML 而不是 ActionScript 中定义）开始，您可以在其中添加`mx.core.UIComponent`s. 我认为您`PhotoUploader`将是自定义 UIComponent 的一个很好的例子。

[Flex 帮助/教程](http://livedocs.adobe.com/flex/3/html/)页面非常好。我建议从那里开始。 [自定义组件](http://livedocs.adobe.com/flex/3/html/Part1_intro_1.html)已明确涵盖，但您可能希望在流中更早开始。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T12:18:42.410

尝试覆盖组件的`createChildren()`方法（不要忘记在其中调用`super.createChildren()`）并将三个调用`addChild()`移至它。不要调用自己的`createChildren`方法；Flex 框架将确保在您的组件添加到显示列表时调用它。

用 MXML 编写组件让您不必了解很多关于[Flex 组件生命周期](http://flexcomps.wordpress.com/2008/05/09/flex-component-life-cycle/)的知识，因为 mxmlc 会为您生成正确的 AS3 源代码，但是当您想自己在 AS3 中编写自定义组件时，您确实需要熟悉用它。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-17T05:14:44.863

检查[有关 actionscript 项目的 livedocs 页面](http://livedocs.adobe.com/flex/3/html/help.html?content=projects_6.html)。即：

> # 关于 ActionScript 项目
> 
> Flex Builder 允许您创建**使用 Flash API（不是 Flex 框架）的**ActionScript 项目。这利用了 Flex Builder 工作台工具和 ActionScript 编辑器，这意味着您拥有一个用于开发 ActionScript 应用程序的功能齐全的 IDE。

因此，您不能在 ActionScript 项目中使用 Flex 组件。我很惊讶你甚至成功地编译了这个类。如果您使用不同的方法，请在问题中指定。

如果您使用的是 Flex 3 和`addChild`，我假设您使用的是 ActionScript 3。在这种情况下，您的 import 语句指向了错误的包。`Button`, `TileList`,`Slider`和`ProgressBar`在 中`fl.controls package`。

此外，ActionScript 指南建议以小写字符开头命名属性和方法。

哦，最后一件事。我不建议导入整个显示包，因为那里有一大堆类，真的。

# c# - 通过网络触发事件

> ID：554907
> 
> 赞同：0
> 
> 时间：2009-02-16T22:50:25.473
> 
> 标签：c#, networking

我从哪里开始通过网络触发事件？就我而言，当我更改数据库记录时，我想通知网络上运行同一应用程序的任何其他用户它已更改。

编辑：

这没什么聪明的，不要激动。我正在编写一个文档管理系统，当文档以任何方式发生更改（删除、签出、发布等）时，我想“告诉”每个人有些东西发生了变化。我打算使用 FileSystemWatcher 监视服务器上的文件夹，将每个实例注册到它的 Deleted 事件，然后在监视的目录中创建和删除一个文件，但这很脏不是吗？如您所知，我不是专业程序员:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-16T22:57:45.957

您需要什么样的通知时间范围？我个人会让客户端机器轮询服务器以获取更新 - 例如“我最近的更新是在 17/02/2009 11:56:00 - 从那以后发生了什么变化？” - 通过在实际服务器上实现 web 服务或简单的基于套接字的服务器。

否则，如果它是一个分布式应用程序，你的“最简单”的赌注将是一个 UDP 广播——假设它们在同一个子网上并且没有被 20 度的路由器隔开。

你能告诉我们更多关于你的情况吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-16T22:56:20.373

您的客户端应用程序的每个实例都可能正在侦听一个消息套接字。

当您的服务器应用程序更改数据库记录（代表客户端或出于任何其他原因）时，它还会在每个客户端的消息队列中插入一条“更改的内容”消息。

服务器应用程序可以立即将消息发送到客户端应用程序 - 或者客户端应用程序可以轮询。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-16T22:56:35.023

让客户在中央应用程序中注册自己。每当客户端更新记录时，它可以通知中央应用程序，然后将其广播给注册的客户端。

自行决定传输机制，但您可能需要考虑套接字。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T00:04:52.987

WCF 可以为您实现这一目标。我有一台服务器，可以在发生某些事情时向所有客户端发送警报。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T00:05:55.400

您如何跟踪文件编辑？

我假设您正在使用数据库（如果没有，现在是设置数据库的好时机） - 在这种情况下，我建议您编写一个 ASP.NET Web 服务（.asmx 扩​​展名 - Visual Studio 可以让它们变得非常容易）进行通信使用这个数据库并告诉客户端自上次检查以来是否有任何文件被修改。

尝试在 Visual Studio 中为服务器创建一个 Web 服务，看看它是如何完成的。要在客户端机器上使用（“使用”）网络服务，请打开您的 VS 项目，右键单击项目下的“引用”节点并选择“添加 Web 引用”。

但是，客户端需要轮询 Web 服务，因为它是一种单向调用响应类型的机制。

这样做的好处是您不必担心网络共享等问题。然而，缺点是您需要支持 ASP.NET 的网络服务器和数据库引擎，除非它们已经存在。

# datetime - 使用 XSL 按日期排序 RSS 提要的问题

> ID：554909
> 
> 赞同：5
> 
> 时间：2009-02-16T22:50:58.857
> 
> 标签：datetime, xslt, rss, sorting

我正在创建一个网站，我需要在其中显示来自 RSS 提要的前 5 条记录，并且这些记录需要按日期和时间排序。

RSS 提要中的日期字段采用以下格式：“Mon, 16 Feb 2009 16:02:44 GMT”

我在让记录正确排序时遇到了很大的问题——我尝试了很多不同的代码示例，但似乎没有一个可以正确排序记录。我的 XSL 工作表的代码如下所示，有问题的提要在 [此处](http://newsrss.bbc.co.uk/rss/newsonline_uk_edition/business/rss.xml)。

非常感谢任何人的帮助！！！

谢谢，

克里斯。

* * *

XSL 代码：

```
<xsl:stylesheet version="1.1" 
xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
xmlns:digg="http://digg.com//docs/diggrss/"
xmlns:dc="http://purl.org/dc/elements/1.1/">
<xsl:template match="/">    
<xsl:for-each select="//*[local-name()='item'][position() < 6]">    
    <p>
        <a>
        <xsl:attribute name="href">
        <xsl:value-of select="*[local-name()='link']"/></xsl:attribute>
        <xsl:attribute name="target">
        <xsl:text>top</xsl:text>
        </xsl:attribute>
        <xsl:value-of select="*[local-name()='title']"/>
        </a>
        <br/>
    <span class="smaller"><xsl:value-of select="*[local-name()='pubDate']" disable-output-escaping="yes"/></span>
    </p>
</xsl:for-each> 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-17T04:34:53.883

**以下转换**：

```
<xsl:stylesheet version="1.0"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
 <xsl:output omit-xml-declaration="yes" indent="yes"/>

  <xsl:variable name="vrtfMonths">
    <m name="Jan" num="01"/>
    <m name="Feb" num="02"/>
    <m name="Mar" num="03"/>
    <m name="Apr" num="04"/>
    <m name="May" num="05"/>
    <m name="Jun" num="06"/>
    <m name="Jul" num="07"/>
    <m name="Aug" num="08"/>
    <m name="Sep" num="09"/>
    <m name="Oct" num="10"/>
    <m name="Nov" num="11"/>
    <m name="Dec" num="12"/>
  </xsl:variable>

  <xsl:variable name="vMonths" select=
   "document('')/*/xsl:variable
                   [@name='vrtfMonths']/*"
   />

    <xsl:template match="channel">
      <xsl:for-each select="item">
        <xsl:sort data-type="number" order="descending" select=
        "concat(substring(pubDate,13,4),
                $vMonths[@name 
                        = 
                         substring(current()/pubDate,9,3)]/@num,

                substring(pubDate,6,2),
                translate(substring(pubDate,18,8),
                          ':',
                          ''
                          )
                )
         "/>

         <xsl:if test="not(position() > 5)">
           <xsl:copy-of select="."/>

         </xsl:if>
      </xsl:for-each>
    </xsl:template>
</xsl:stylesheet> 
```

**当应用于提供的源 XML 文档时（此处无法列出，请参见[链接](http://newsrss.bbc.co.uk/rss/newsonline_uk_edition/business/rss.xml)）**，

**产生想要的结果**：

```
<item xmlns:media="http://search.yahoo.com/mrss">
        <title>Inflation rate expected to fall</title>
        <description>The latest figures for the rate of inflation, for the 12 months to January, are expected to show that it has fallen again.</description>
        <link>http://news.bbc.co.uk/go/rss/-/1/hi/business/7893873.stm</link>
        <guid isPermaLink="false">http://news.bbc.co.uk/1/hi/business/7893873.stm</guid>
        <pubDate>Tue, 17 Feb 2009 02:58:03 GMT</pubDate>
        <category>Business</category>
        <media:thumbnail width="66" height="49" url="http://newsimg.bbc.co.uk/media/images/45483000/jpg/_45483998_cash226.jpg" />
    </item><item xmlns:media="http://search.yahoo.com/mrss">
        <title>Farming pressures</title>
        <description>Are farmers being forced to use GM seeds?</description>
        <link>http://news.bbc.co.uk/go/rss/-/1/hi/business/7892328.stm</link>
        <guid isPermaLink="false">http://news.bbc.co.uk/1/hi/business/7892328.stm</guid>
        <pubDate>Tue, 17 Feb 2009 00:06:31 GMT</pubDate>
        <category>Business</category>
        <media:thumbnail width="66" height="49" url="http://newsimg.bbc.co.uk/media/images/45481000/jpg/_45481936_005666785-1.jpg" />
    </item><item xmlns:media="http://search.yahoo.com/mrss">
        <title>Engine room?</title>
        <description>Western Australia's economy may be hitting reverse. </description>
        <link>http://news.bbc.co.uk/go/rss/-/1/hi/business/7840370.stm</link>
        <guid isPermaLink="false">http://news.bbc.co.uk/1/hi/business/7840370.stm</guid>
        <pubDate>Tue, 17 Feb 2009 00:05:25 GMT</pubDate>
        <category>Business</category>
    </item><item xmlns:media="http://search.yahoo.com/mrss">
        <title>Coining it in? </title>
        <description>Investors turning to old and rare coins in the downturn </description>
        <link>http://news.bbc.co.uk/go/rss/-/1/hi/business/7878606.stm</link>
        <guid isPermaLink="false">http://news.bbc.co.uk/1/hi/business/7878606.stm</guid>
        <pubDate>Tue, 17 Feb 2009 00:04:29 GMT</pubDate>
        <category>Business</category>
        <media:thumbnail width="66" height="49" url="http://newsimg.bbc.co.uk/media/images/45459000/jpg/_45459789_dsc_4982.jpg" />
    </item><item xmlns:media="http://search.yahoo.com/mrss">
        <title>Home sales may rise say surveyors</title>
        <description>Property sales may pick in the next few months, according to the Royal Institution of Chartered Surveyors (Rics).</description>
        <link>http://news.bbc.co.uk/go/rss/-/1/hi/business/7893193.stm</link>
        <guid isPermaLink="false">http://news.bbc.co.uk/1/hi/business/7893193.stm</guid>
        <pubDate>Tue, 17 Feb 2009 00:02:19 GMT</pubDate>
        <category>Business</category>
        <media:thumbnail width="66" height="49" url="http://newsimg.bbc.co.uk/media/images/45483000/jpg/_45483075_006771638-1.jpg" />
    </item> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-27T08:00:34.317

绕过文档限制的另一种方法是使用以下内容：

```
<xsl:template name="getMonth">
    <xsl:param name="name" />
    <xsl:choose>
        <xsl:when test="$name = 'Jan'">01</xsl:when>
        <xsl:when test="$name = 'Feb'">02</xsl:when>
        <xsl:when test="$name = 'Mar'">03</xsl:when>
        <xsl:when test="$name = 'Apr'">04</xsl:when>
        <xsl:when test="$name = 'May'">05</xsl:when>
        <xsl:when test="$name = 'Jun'">06</xsl:when>
        <xsl:when test="$name = 'Jul'">07</xsl:when>
        <xsl:when test="$name = 'Aug'">08</xsl:when>
        <xsl:when test="$name = 'Sep'">09</xsl:when>
        <xsl:when test="$name = 'Oct'">10</xsl:when>
        <xsl:when test="$name = 'Nov'">11</xsl:when>
        <xsl:when test="$name = 'Dec'">12</xsl:when>
        <xsl:otherwise>99</xsl:otherwise>
    </xsl:choose>
</xsl:template> 
```

调用使用

```
 <xsl:call-template name="getMonth">
       <xsl:with-param name="name" select="substring(./pubDate,9,3)" />
   </xsl:call-template> 
```

不漂亮，但至少不用担心安全问题

# java - 是否有人在愤怒中使用 Scala（以及对 Java 程序员的什么建议）？

> ID：554913
> 
> 赞同：18
> 
> 时间：2009-02-16T22:51:53.100
> 
> 标签：java, scala, jvm-languages

自从开始使用 Smalltalk 以来，我已经成为一名 Java 程序员 10 多年了。我认为*下一个主流语言*很可能是在无处不在的 Java 虚拟机上运行的语言。我想利用 Scala（以及其他语言）具有的一些特性——`case`类层次结构、闭包、类型推断的语句，因为它可以让我编写更简洁明了（我希望）的代码。更接近 Smalltalk！

Java 中所有的第二天性：

*   建筑与`ant`
*   将应用程序/库部署到逻辑`jar`s
*   强大的 IDE 工具支持
*   编写 GUI（或者通过某种远程处理让 Swing GUI 与它对话？）
*   3rd 方库/框架
*   配置（属性`XML`等`Spring`）
*   数据库驱动程序等

我担心玩一些宠物项目和实际在工作场所愤怒地使用它之间的区别有点太大了。

1.  有没有人实现这个飞跃？
2.  它值得吗？
3.  你学到了什么？

（显然人们正在*使用*Scala——但是否有人正在构建实际的**企业**应用程序，为了更好的说法？）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-17T06:29:29.567

我在我们现有的 Java 基础设施上使用了 Scala 来查询和操作大型 xml 文档。使用标准 Java xml 库是不可能的，或者不那么容易。

我很想将它用于投资组合性能计算，但已经完成了 Java 版本。Scala 版本会更容易维护，因为更容易将公式直接转换为代码。

您可以潜入 Scala 的另一个领域是多线程。对此没有真正的经验，但在 Scala 中似乎更容易。

关键是，现在不要试图将其视为 Java 的替代品，而是在您可以在现有 Java 代码旁边利用它的地方使用它。

我将 Intellij 与 Scala 插件一起用作 IDE，但它还没有。它可以与 maven 插件和控制台结合使用。

我也是一名 Smalltalk 程序员，喜欢在 Scala 中使用代码块。与 Java 相比，代码更少，但仍不如 Smalltalk 代码可读性好。

*顺便说一句，由于 Seaside 框架，smalltalk 社区再次增长，所以您可能想返回*

我学到或更好地理解的事情：

*   构造函数的使用
*   不变的概念
*   使用列表和递归
*   一般的函数式编程

所以是的，我认为这是值得的。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-17T02:02:13.080

Jonas Bonér：http: [//jonasboner.com/2009/01/30/slides-pragmatic-real-world-scala.html](http://jonasboner.com/2009/01/30/slides-pragmatic-real-world-scala.html)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-06-05T21:03:45.693

在我们上一个项目中，我基本上用 Scala 代码打了每个人的头，因为我厌倦了调试由于对 Hibernate + JBoss 缺乏了解而导致的相同问题。（真的很神奇。*编写*原始系统的开发人员仍然在那儿，仍然迷失在 Hibernate 细节中。）

我们所拥有的 -> 一个古怪的系统，主要由一堆无状态 EJB bean 与一些休眠代码和一些 SQL 组合在一起构建而成。（基本上，我们是一个 ASP。生产集群相当小 -> 只有大约 100 台机器。）

我所做的 -> 将各种基于 REST 的服务放在一起，我们在其中重新定义了一些服务器之间的 RPC。这使得一切都非常容易编码，此外，将公共 API 实现到一个不关注依赖关系的系统中。

到目前为止，我们已经开始在 JBoss 实例内外部署代码，没有任何实际问题。当您第一次尝试`object`在 Java 中使用 Scala 时，您可能会皱起鼻子。但除此之外，没有人真正注意到。

到目前为止，距离我们真正开始已经大约 5 个月了。我们已经进行了几次重大修改，随后落后了，但该系统的测试远比过去好得多。因此，虽然我们在真正学习系统时有一些不好的想法潜入其中，但我们现在已经能够将它们全部删除，并且非常接近生产部署。总而言之，我想说典型的家伙需要 2-3 个月才能停止像 Java 程序员那样编码，并“熟悉”大多数标准库。

编写 JDBC 代码而不是 ORM 系统基本上已经排除了我们几乎所有的性能问题。速度实际上要好得多，但这主要是因为我能够用更少的实际应用程序代码完成我想做的一切。

我正在使用的工具：

1.  [Restlet](http://www.restlet.org)：对这个框架非常满意。我们的 restlet 层是非常琐碎的代码。
2.  [JDBC](http://scala.sygneca.com/code/simplifying-jdbc) -> 注意：我们已经调整了 wiki 中的基本内容
3.  XML（很快，JSON）
4.  buildr，我不想转换的几个项目的专家（加上 Nexus 和 Hudson）。我正在试验 sbt，这对于 scala 项目来说已经*非常*好了。

我们在重用任何旧的 java 库方面绝对没有问题，但我们确实倾向于将它们包装在可扩展的层中。主要是为了写更少的代码。

到目前为止，我的图书馆模式中的[皮条客](http://www.artima.com/weblogs/viewpost.jsp?thread=179766)是最重要的一种。“蛋糕”模式很好，但您必须控制实例化，这有时不是很有用。我也在混合环境中使用过 Guice，也不是很难。但我发现混合代码的用处远没有我最初想象的那么有用，尽管这可能是因为我要替换很多非常非常糟糕的 Java 代码。

我的编辑环境主要是 OS X 上的 TextMate，但我们部署在 Linux 服务器上。

PS 是的，我知道这大约是 4 个月大，但无论如何。这是相关的，尤其是现在我们有一些经验。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-16T23:44:08.853

我已将 clojure 添加到[开普勒](http://kepler.nasa.gov)任务科学运营中心使用的软件基础架构中。现在它可以进行交互式调试；运行 REPL，加载一些类并以特别的方式执行方法。

编辑：好的，所以“加载一些类并执行方法”是模糊的。例如，我们可以加载我们的 crud 类，然后执行将一种航天器时间转换为另一种航天器时间的方法。

```
用户=>（导入'（gov.nasa.kepler.hibernate.dr LogCrud））
user=> (def crud (new LogCrud))
#'用户/crud
user=> (def shortCadences (.longCadenceToShortCadence crud 0 2500))
user=> (prn shortCadences)
#>

```

可以调用其他方法将此时间转换为其他类型的时间格式，这些格式可能对调试有用。我们可以制作命令行工具来封装所有这些功能，但没有必要，因为一切都可以从 clojure 获得。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-17T11:17:29.297

另请参阅：[Scala 应用程序的真实示例？](https://stackoverflow.com/questions/190110/real-world-examples-of-scala-applications)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-12-31T15:01:28.353

我在相关链接上看到了这个，并认为我会插话，现在我们已经过了几年。

IDE 支持有了很大改进，IntelliJ 11 在这一点上对 Scala 有很好的支持。语法突出显示效果很好，尽管调试仍然有点烦人。

SBT 看起来正在迅速取代 maven 或 ant/ivy，谢天谢地，SBT 比 Maven 更容易使用，并且更适合 Scala。IntelliJ for one 也有一个 SBT 控制台，结合交互式调试确实可以使 Scala 中的调试非常快，但老实说，现在语法突出显示变得非常好，我发现我需要的调试量大大减少了。Scala 的流动性比 Java 好得多，而且似乎导致代码更不容易出错。

数据库交互似乎还有点悬而未决，但有一些框架还不错，可以让您以一种或另一种方式快速使用数据库。

此时第三方库和框架比比皆是，当然您仍然可以使用任何普通的旧 Java 第三方库。

在这一点上，我要问一个问题：为什么不将 Scala 或其他下一代 JVM 语言用于项目？虽然简单的答案是今天许多开发人员还没有准备好与 Scala 打交道，但老实说，他们需要让他们的集体头脑清醒并参与到游戏中，而强制使用它的公司将持续很长时间实现这一目标的方法（我们所有人有时都需要推动才能重新回到游戏中）。另外，如果你在做任何类型的“企业”或大批量开发，而你不了解函数式编程并且想不通，请帮我们大家一个忙，放下你的 IDE，或者上帝-禁止 vim，坚持脚本或寻找新的职业道路。

今天有许多知名公司在使用 Scala，其中最公开的可能是 Twitter。他们还为开源世界贡献了一些框架。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-16T23:18:17.403

是的，人们正在使用 Scala（和 Clojure）构建实际的“企业”应用程序。去做就对了。

当然，人们也在使用 Smalltalk，所以如果你喜欢 Smalltalk，为什么不使用它呢？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-05-20T19:33:05.263

我曾经在“审判愤怒”中使用它来加载几 GB 的数据（对于我们所做的工作来说，这是一个相当轻的工作量）。我希望它比 PyPy 具有更高的性能和更少的内存开销。它在内存使用上失败了。太糟糕了，我吓坏了，不好意思说出来，再也没有看它。

# asp.net - ASP.NET MVC RC1 路由问题

> ID：554922
> 
> 赞同：1
> 
> 时间：2009-02-16T22:55:47.300
> 
> 标签：asp.net, asp.net-mvc

我有一个类似的路由表

```
// Allow browsing categories by name, instead of by ID.
routes.MapRoute("Categories", "Categories/{action}/{name}",
    new { controller = "Categories", action = "Index", name = "" }
);

// All other pages use the default route.
routes.MapRoute("Default", "{controller}/{action}/{id}",
    new { controller = "Applications", action = "Index", id = "" }
);

// Show a 404 error page for anything else.
routes.MapRoute("Error", "{*url}",
    new { controller = "Error", action = "404" }
); 
```

然而，最后的通配符路由没有被调用......如果我输入一个不存在的控制器或 URL，它会尝试通配符路由上方的默认路由......从而导致找不到信息资源 ASP.net 错误页面...我想要一个自定义错误页面...请帮助

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-16T23:07:09.520

如果您输入一个不存在的控制器，例如“BadController/SomeAction/123”，它将被第二条路由拾取。

最后一条路线只有在前两条都没有的情况下才会被拾取，例如 '/SomeRandomFile.aspx' 的 URL，或者甚至不接近 '{controller}/{action}/{ 的其他东西id}' 语法。

在我的项目中，我使用`<customErrors mode="RemoteOnly" defaultRedirect="/Error" />`我的 web.config 文件内部作为例外的“包罗万象”规则。假设您没有将请求路由到“/Error”的规则，您将需要一个错误控制器。

然后，您可以使用该`protected void Application_Error(object sender, EventArgs e)`方法在出现异常的情况下执行一些代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T23:07:26.243

为什么不创建标准的 ASP .NET 自定义错误页面？

```
<customErrors
       mode="RemoteOnly" 
       defaultRedirect="~/View/Shared/CustomErrorPasge.aspx" 
/> 
```

# java - servlet 中的无限循环 - 可以恢复吗？

> ID：554936
> 
> 赞同：5
> 
> 时间：2009-02-16T23:00:46.213
> 
> 标签：java, servlets

今天我修复了一个应用程序中的一个错误，该错误可能导致 servlet 请求/响应周期中的无限循环。

所以只是出于好奇：如果我的 servlet 实际上被困在 for(;;) 循环中，会发生什么？

有没有可能恢复？tomcat会检测到这个吗？可以在不重新启动服务器的情况下杀死此实例吗？

或者这是可能发生的最糟糕的事情之一，并且是杀死网络容器的一种非常快速的方法？

编辑：这是一个真正的无限循环，一直在消耗 CPU，而不是内存。我让它运行了几分钟。我想，我可以确认tomcat不会检测到这种事情:-)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-16T23:10:08.220

不确定 Tomcat 是否有这样的检测，但例如 Websphere 的 web 容器有。但是，显然容器需要相对较长的时间来检测“挂起”的线程。负载下的服务器可以轻松快速地被此类代码杀死。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T23:12:37.603

我认为 Tomcat 不会检测到无限循环。如果 servlet 没有通过其循环消耗所有 CPU 时间，您可能能够使用 Tomcat 管理器停止 servlet。否则，重新启动服务器可能是最安全和最简单的。

这就是为什么您在部署应用程序之前在本地进行大量测试的原因 ;-) 并且要非常小心所有循环都有退出条件......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-16T23:20:59.893

如果无限循环是由无限重定向引起的，它迟早会用 StackOverflowException 终止该请求。

它是一个“真正的”无限循环，您可能会永久占用一个 CPU/内核，并最终导致整个应用程序因 OutOfMemoryException 而崩溃。

据我所知，tomcat 没有明确检测这些问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-16T23:36:24.613

我想你可以通过适当的超时设置来处理这个问题：

[http://tomcat.apache.org/connectors-doc/generic_howto/timeouts.html](http://tomcat.apache.org/connectors-doc/generic_howto/timeouts.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-17T01:28:07.857

WebLogic 可以检测卡住的线程： [http ://edocs.bea.com/wls/docs81/perform/WLSTuning.html#1125714](http://edocs.bea.com/wls/docs81/perform/WLSTuning.html#1125714)

不过，在Tomcat中还没有看到这个。

# winapi - 透明的顶层窗口

> ID：554939
> 
> 赞同：4
> 
> 时间：2009-02-16T23:01:51.000
> 
> 标签：winapi, gdi, alpha

我想创建一个透明的顶级（即不是 WS_CHILD）窗口。但是，我不希望它是一个简单的蒙版，其中给定的像素要么是完全透明的，要么是完全不透明的。而且我不希望整个窗口都具有一定的 alpha 级别。相反，我希望窗口基本上是完全透明的，并使用 alpha 通道绘制位图，以便位图与它后面的任何窗口混合。比如说，一个朝阳，图像自身的 alpha 从中心向外从不透明混合到完全透明。

我发现了两种方法都接近我想要做的，但不完全是。使用区域，我可以切出一个完全透明的部分。使用分层窗口，我也可以做类似的事情（甚至可以使整个窗口稍微透明，但这根本不是我想要的）。我研究了其他样式，例如 WS_EX_TRANSPARENT 和 WS_EX_COMPOSITE，但无济于事。

我可以让这种效果在子窗口上正常工作，因为它们在其父区域内与其父窗口混合。让它在顶级窗口中以类似方式工作仍然让我难以理解。

我知道这是可以做到的，因为人们向我保证他们已经在其他程序中看到了它。我觉得我只是没有完全理解这里关于绘画窗户的简单事情。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-16T23:14:54.010

[分层](http://msdn.microsoft.com/en-us/library/ms997507.aspx)窗口（`WS_EX_LAYERED`_ [`UpdateLayeredWindow()`](http://msdn.microsoft.com/en-us/library/ms633556(VS.85).aspx)_[`SetLayeredWindowAttributes()`](http://msdn.microsoft.com/en-us/library/ms633540(VS.85).aspx)对于整个窗口或颜色键）。

你说你已经尝试过了——你遇到了什么问题？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T00:54:53.317

我知道在窗口上获取每像素 alpha 的唯一方法是 UpdateLayeredWindow()。
查看此 MSDN 链接：http: [//msdn.microsoft.com/en-us/library/ms997507.aspx](http://msdn.microsoft.com/en-us/library/ms997507.aspx)

> 请注意，当使用 UpdateLayeredWindow 时，应用程序不需要响应 WM_PAINT 或其他绘画消息，因为它已经为窗口提供了可视化表示，并且系统将负责存储该图像、合成它并在屏幕。**UpdateLayeredWindow 非常强大，但它通常需要修改现有 Win32 应用程序的绘制方式**。

我敢打赌，这些都是您遇到的问题。

# c# - 优化类结构

> ID：554948
> 
> 赞同：0
> 
> 时间：2009-02-16T23:05:30.447
> 
> 标签：c#, class, uml

我的应用程序中有以下类结构（为了时间而缩写，名称已更改）。当我编写代码时，我觉得 Action1 和 Action2 之间的相似之处应该保证某种概括。我已经提供了带有相关部分的 UML 类图（接口除外，我在下面的代码中进行了描述）。我想知道是否有人对如何制作这种“更好”的架构/类设计有想法。此外，非常相似的动作可以在近期的迭代中实现。

[UML 图 http://img16.imageshack.us/img16/2569/mainmm2.jpg](http://img16.imageshack.us/img16/2569/mainmm2.jpg)

接口代码

```
public IActor1
{
    public Property1 { get; set; }
    public Property2 { get; set; }
}

public IActor2
{
    public Property3 { get; set; }
    public Property2 { get; set; }
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-16T23:09:30.590

我第一次看到这个想出了以下内容：

*重载接口，因为两者都已经实现了接口。然后，创建了一个 Action 接口，封装了 Action1 的 List、List 和 ActionType 属性，让 Action2 有一个空的虚拟 ActionType 属性。但是，这似乎非常混乱且不可扩展（因为未来有新动作的计划）*

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-17T01:21:24.673

我不确定这是否能回答你的问题，但这里有。

首先，IActor1 和 IActor2 应该有一个具有共享属性的公共基础接口：

```
public interface IActorBase {
    public Property2 { get; set; }
} 
```

现在，动作应该有一个通用的基础

```
public abstract class ActionBase<TActor> where TActor: IActorBase {
    public List<String> StringList { get; set; }
    public List<TActor> ActorList  { get; set; }
} 
```

然后，您可以这样实现 Action1 和 Action2：

```
public class Action2 : ActionBase<IActor2> { }

public class Action1 : ActionBase<IActor1> {
    public enum Action1Type Type { get; set; }
} 
```

如果没有更多细节，我不确定你还能在这里做什么......

# lisp - Common Lisp 中的 LET 与 LET*

> ID：554949
> 
> 赞同：86
> 
> 时间：2009-02-16T23:05:34.220
> 
> 标签：lisp, common-lisp

我了解 LET 和 LET* （并行与顺序绑定）之间的区别，从理论上讲，它非常有意义。但是在任何情况下你真的需要 LET 吗？在我最近查看的所有 Lisp 代码中，您可以将每个 LET 替换为 LET* 而无需更改。

编辑：好的，我明白*为什么*有些人发明了 LET*，大概是作为一个宏，早在什么时候。我的问题是，鉴于 LET* 存在，LET 是否有理由留下来？你写过任何实际的 Lisp 代码，其中 LET* 不能像普通的 LET 那样工作吗？

我不赞成效率论点。首先，识别 LET* 可以编译为与 LET 一样高效的情况似乎并不难。其次，CL 规范中有很多东西看起来根本不像是围绕效率设计的。（你最后一次看到带有类型声明的 LOOP 是什么时候？这些很难弄清楚我从未见过它们使用过。） 在 1980 年代后期 Dick Gabriel 的基准测试之前，CL*非常*缓慢。

看起来这是向后兼容的另一种情况：明智的是，没有人愿意冒险破坏像 LET 这样基本的东西。这是我的预感，但令人欣慰的是，没有人有一个我错过的愚蠢简单的案例，LET 使一堆事情比 LET* 容易得多。

* * *

## 回答 #1

> 赞同：90
> 
> 时间：2009-02-25T21:03:43.957

`LET`它本身不是*函数式编程语言*中的真正原语，因为它可以替换为`LAMBDA`. 像这样：

```
(let ((a1 b1) (a2 b2) ... (an bn))
  (some-code a1 a2 ... an)) 
```

类似于

```
((lambda (a1 a2 ... an)
   (some-code a1 a2 ... an))
 b1 b2 ... bn) 
```

但

```
(let* ((a1 b1) (a2 b2) ... (an bn))
  (some-code a1 a2 ... an)) 
```

类似于

```
((lambda (a1)
    ((lambda (a2)
       ...
       ((lambda (an)
          (some-code a1 a2 ... an))
        bn))
      b2))
   b1) 
```

你可以想象哪个更简单。`LET`而不是`LET*`。

`LET`使代码理解更容易。一个人会看到一堆绑定，并且可以单独阅读每个绑定，而无需了解“效果”（重新绑定）的自上而下/左右流动。向程序员`LET*`（读取代码的人）发出信号，表明绑定不是独立的，但存在某种自上而下的流程——这会使事情复杂化。

Common Lisp 的规则是绑定的值`LET`是从左到右计算的。只是如何评估函数调用的值 - 从左到右。所以，`LET`是概念上更简单的语句，默认情况下应该使用它。

**输入`LOOP`**? 经常使用。有一些类型声明的原始形式很容易记住。例子：

```
(LOOP FOR i FIXNUM BELOW (TRUNCATE n 2) do (something i)) 
```

上面将变量声明`i`为 a `fixnum`。

Richard P. Gabriel 于 1985 年出版了他关于 Lisp 基准的书，当时这些基准也用于非 CL Lisps。Common Lisp 本身在 1985 年是全新的——描述该语言的*CLtL1*书刚刚在 1984 年出版。难怪当时的实现不是很优化。实现的优化与之前的实现（如 MacLisp）基本相同（或更少）。

但是对于`LET`与`LET*`主要区别在于，使用的代码`LET`对于人类来说更容易理解，因为绑定子句彼此独立 - 特别是因为利用从左到右的评估是不好的风格（不将变量设置为边影响）。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-02-17T00:21:23.913

您*不需要*LET，但您通常*需要*它。

LET 建议您只是在做标准的并行绑定，没有任何棘手的事情发生。LET* 对编译器产生限制，并向用户建议需要顺序绑定是有原因的。在**样式**方面，当您不需要 LET* 施加的额外限制时，LET 会更好。

使用 LET 比使用 LET* 更有效（取决于编译器、优化器等）：

*   并行绑定可以**并行执行**（但我不知道是否有任何 LISP 系统实际上这样做，并且 init 表单仍然必须按顺序执行）
*   并行绑定为所有绑定创建一个新的环境（范围）。顺序绑定为每个绑定创建一个新的嵌套环境。并行绑定使用**更少的内存**并且具有**更快的变量查找**。

（以上要点适用于 Scheme，另一种 LISP 方言。clisp 可能不同。）

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2009-02-16T23:21:18.690

我是带着人为的例子来的。比较这个结果：

```
(print (let ((c 1))
         (let ((c 2)
               (a (+ c 1)))
           a))) 
```

运行结果如下：

```
(print (let ((c 1))
         (let* ((c 2)
                (a (+ c 1)))
           a))) 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-02-16T23:18:38.777

在 LISP 中，通常希望使用最弱的结构。例如，一些样式指南会告诉您使用，`=`而不是`eql`当您知道比较的项目是数字时。这个想法通常是指定您的意思，而不是有效地对计算机进行编程。

但是，仅说出您的意思而不使用更强大的结构可能会提高效率。如果你有初始化`LET`，它们可以并行执行，而`LET*`初始化必须按顺序执行。我不知道是否有任何实现会真正做到这一点，但将来可能会有一些实现。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2009-02-18T21:46:33.720

LET 和 LET* 之间的 Common List 的主要区别在于 LET 中的符号是并行绑定的，而 LET* 中的符号是顺序绑定的。*使用 LET 不允许并行执行 init-forms，也不允许更改 init-forms 的顺序。*原因是 Common Lisp 允许函数有副作用。因此，评估的顺序很重要，并且在表格中始终是从左到右的。因此，在 LET 中，初始化形式首先被评估，从左到右，然后创建绑定，~~从左到右~~并行。在 LET* 中，初始化形式被求值，然后按从左到右的顺序绑定到符号。

[CLHS：特殊运算符 LET、LET*](http://www.lispworks.com/documentation/HyperSpec/Body/s_let_l.htm)

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2012-02-27T02:13:28.840

我最近在写一个有两个参数的函数，如果我们知道哪个参数更大，那么算法就可以最清楚地表达出来。

```
(defun foo (a b)
  (let ((a (max a b))
        (b (min a b)))
    ; here we know b is not larger
    ...)
  ; we can use the original identities of a and b here
  ; (perhaps to determine the order of the results)
  ...) 
```

假设`b`更大，如果我们使用`let*`，我们会不小心将`a`和设置`b`为相同的值。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-02-17T00:31:49.223

我更进一步，使用了将, ,等统一起来的[bind](http://common-lisp.net/project/metabang-bind/user-guide.html)，它甚至是可扩展的。`let``let*``multiple-value-bind``destructuring-bind`

通常我喜欢使用“最弱的构造”，但不喜欢`let`和朋友一起使用，因为他们只会给代码带来噪音（主观性警告！无需试图说服我相反......）

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2010-05-19T08:54:30.993

```
(let ((list (cdr list))
      (pivot (car list)))
  ;quicksort
 ) 
```

当然，这会起作用：

```
(let* ((rest (cdr list))
       (pivot (car list)))
  ;quicksort
 ) 
```

和这个：

```
(let* ((pivot (car list))
       (list (cdr list)))
  ;quicksort
 ) 
```

但重要的是思想。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-02-16T23:21:11.437

据推测，通过使用`let`编译器可以更灵活地重新排序代码，也许是为了空间或速度的改进。

从风格上讲，使用并行绑定表明绑定组合在一起的意图；这有时用于保留动态绑定：

```
(let ((*PRINT-LEVEL* *PRINT-LEVEL*)
      (*PRINT-LENGTH* *PRINT-LENGTH*))
  (call-functions that muck with the above dynamic variables)) 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2018-02-25T16:31:02.097

在 下`let`，所有变量初始化表达式都看到完全相同的词法环境：围绕`let`. 如果这些表达式碰巧捕获了词法闭包，它们都可以共享同一个环境对象。

在 下`let*`，每个初始化表达式都在不同的环境中。对于每个连续的表达式，必须扩展环境以创建新的。至少在抽象语义上，如果捕获了闭包，它们就有不同的环境对象。

A`let*`必须经过优化以折叠不必要的环境扩展，以便适合作为`let`. 必须有一个编译器可以计算出哪些表单正在访问什么，然后将所有独立的表单转换为更大的组合`let`.

（即使`let*`只是一个发出级联`let`形式的宏运算符也是如此；优化是在那些级联`let`的 s 上完成的）。

您不能实现`let*`为单个 naive `let`，并使用隐藏变量赋值来进行初始化，因为将显示缺乏适当的范围：

```
(let* ((a (+ 2 b))  ;; b is visible in surrounding env
       (b (+ 3 a)))
  forms) 
```

如果这变成

```
(let (a b)
  (setf a (+ 2 b)
        b (+ 3 a))
  forms) 
```

在这种情况下它不起作用；内部`b`遮蔽了外部`b`，所以我们最终将 2 添加到`nil`. 如果我们对所有这些变量进行 alpha 重命名，就可以完成**这种**转换。然后环境被很好地展平：

```
(let (#:g01 #:g02)
  (setf #:g01 (+ 2 b) ;; outer b, no problem
        #:g02 (+ 3 #:g01))
  alpha-renamed-forms) ;; a and b replaced by #:g01 and #:g02 
```

为此，我们需要考虑调试支持；如果程序员使用调试器进入这个词法范围，我们是否希望他们处理`#:g01`而不是`a`.

所以基本上，`let*`复杂的构造必须经过优化才能很好地执行，以及`let`在它可以减少到`let`.

`let`仅凭这一点并不能证明偏袒`let*`. 假设我们有一个好的编译器；为什么不`let*`一直使用？

作为一般原则，我们应该支持使我们高效并减少错误的高级构造，而不是容易出错的低级构造，并尽可能依赖高级构造的良好实现，这样我们就不必牺牲为了性能而使用它们。这就是为什么我们首先使用像 Lisp 这样的语言。

该推理不适用于`let`vs `let*`，因为`let*`相对于 . 而言显然不是更高级别的抽象`let`。它们大约是“同等水平”。使用`let*`，您可以引入一个错误，只需切换到`let`. *反之亦然*。_ `let*`真的只是视觉上折叠`let`嵌套的一种温和的语法糖，而不是一个重要的新抽象。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2010-09-28T22:02:09.813

With Let you use parallel binding,

```
(setq my-pi 3.1415)

(let ((my-pi 3) (old-pi my-pi))
     (list my-pi old-pi))
=> (3 3.1415) 
```

And with Let* serial binding,

```
(setq my-pi 3.1415)

(let* ((my-pi 3) (old-pi my-pi))
     (list my-pi old-pi))
=> (3 3) 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2013-02-23T03:04:29.153

OP询问“曾经真正需要LET”吗？

在创建 Common Lisp 时，有大量现有的 Lisp 代码以各种方言形式出现。设计 Common Lisp 的人们接受的简报是创建一种能够提供共同点的 Lisp 方言。他们“需要”让将现有代码移植到 Common Lisp 中变得容易且有吸引力。将 LET 或 LET* 排除在语言之外可能还有其他一些优点，但它会忽略这个关键目标。

我使用 LET 而不是 LET*，因为它告诉读者数据流是如何展开的。至少在我的代码中，如果您看到 LET*，您就知道早期绑定的值将在以后的绑定中使用。我是否“需要”这样做，不；但我认为这很有帮助。也就是说，我很少阅读默认为 LET* 的代码，而 LET 的出现表明作者确实想要它。即例如交换两个变量的含义。

```
(let ((good bad)
     (bad good)
...) 
```

有一个有争议的场景接近“实际需要”。它与宏一起出现。这个宏：

```
(defmacro M1 (a b c)
 `(let ((a ,a)
        (b ,b)
        (c ,c))
    (f a b c))) 
```

比

```
(defmacro M2 (a b c)
  `(let* ((a ,a)
          (b ,b)
          (c ,c))
    (f a b c))) 
```

因为 (M2 cba) 行不通。但是出于各种原因，这些宏非常草率。这样就破坏了“实际需要”的论点。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2021-04-15T17:24:58.770

`let`和之间肯定存在效率争论`let*`。但我们拥有的主要原因`let`是历史性的，因为与`lambda`.

`let`**在代码遍历 Lisp 解释器**中实现更容易、更简单、更高效。如果环境有一些半体面的数据结构，而不仅仅是一个`assoc`列表，则尤其如此。

假设解释器将环境实现为对象链。所以 for istance`(let (a b) (let (c d) (let (e f))))`会将三个环境节点添加到环境链中。这些新节点中的每一个都包含两个绑定（在单独的列表或哈希表中）。

当我们解释`let`表单时，我们可以评估传入环境链中的所有初始化表达式。我们可以在单个操作中为所有新绑定创建单个环境节点，并使用值填充绑定。

当我们解释`let*`表格时，我们不能这样做。对于 中提到的每个连续绑定`let*`，我们必须调用`make-environment`、填充它并将其添加到环境链中，以便我们随后在扩展环境中解释下一个初始化形式。

这导致退化的运行时环境结构。虽然`(let (a b c d ...))`生成了一个包含漂亮哈希表的环境对象，但`(let* (a b c d ...))`生成了一个效率低下的链，需要 O(n) 遍历才能找到绑定。

`let`我们可以消除和的解释器性能之间的差异，但只能通过将`let*`性能拖到。如果我们将环境链表示为一个简单的列表，那么这个问题就无关紧要了；所有变量查找都是线性搜索。事实上，这样更容易实现：评估每个 init 表达式，并将新绑定推送到当前环境。`let``let*``assoc``let*`

**现在，在图片中输入编译。** Lisp 编译器`let*`只需对`let`. 为了编译`let*`，我们可以为所有绑定分配一个单一的环境（这会导致解释器中的范围不正确）。我们将该环境留空，并将其添加到编译时环境链中。因此，我们在该新环境的范围内编译 init 表达式。当我们遍历 init 表达式来编译它们时，我们将每个对应的变量一一添加到该环境中，以便后续 init 表达式的编译将在范围内具有该变量。

`let*`是一个简单的 hack，当你有一个处理`let`.

Lisp 编译器很容易生成环境的有效表示，而不管范围规则如何，解释器不一定如此。

由于口译员首先出现，这就解释了为什么`let`是并行的。至少部分。另一个原因是它`let`被实现为语法糖 over `lambda`。但是`lambda`（最初）在它自己的范围内根本没有初始化表达式；它只是指定变量。该`lambda`表达式生成一个运行时对象，以便在调用函数时在运行时将值绑定到参数。参数表达式的评估在完全不同的范围内。

现在在立即调用`lambda`中，这仍然是正确的：表达式的范围完全在 之外`lambda`：

```
((lambda (a b) (+ a b)) 1 2) 
```

表达式`1`与;`2`无关 `lambda`它们没有包含在其中。

所以很明显，如果我们想要一个`let`与上述相对应的糖表示法，我们必须小心地保留这个属性：

```
(let ((a 1) (b 2))
  (+ a b)) 
```

如果我们想让 this`let`和之前的一样`lambda`，我们必须让它看起来好像`a`and`b`是函数参数，`1`and`2`是参数表达式。

如果您是一名研究人员，正在使用一种有`lambda`和没有s 的语言，并且`let`渴望一种更好的方式来编写立即称为`lambda`s 的语言，那么您不太可能发明`let*`绑定语义。您将发明一些对您在整个代码中使用的现有结构具有清晰翻译策略的东西，以便您可以重构代码以毫无意外地使用它。

请注意，`lambda`像 Common Lisp 这样的现代方言**中确实**嵌入了表达式：即可选参数和关键字参数！

```
(lambda (a &optional (b x) (c y) ...)) 
```

这些默认值表达式在周围的词法范围`x`内`y`进行评估，无论何时缺少参数，每次调用函数时。那么，这些表达式使用什么范围界定规则呢？为什么，串行，而不是并行！

```
[1]> (defun foo (x &optional (y (1+ x)) (z (1+ y)))
       (list x y z))
FOO
[2]> (foo 10)
(10 11 12) 
```

于是，事情就这样循环了。起初，有`LAMBDA`. `LAMBDA`开始`LET`。`LET`begat `LET*`，并通过可选参数 init-forms 的顺序绑定`LET*`开始更新。`LAMBDA`:)

结果是将现代的直接称为 lambda 转换`let`为非常复杂。例如：

```
(funcall (lambda (x y &optional (z x) (w (1+ z))) a b c) 
```

可以编译成：

```
 (let ((x a) (y b))   ;; we put the fixed params into a let
   (let* ((z c))      ;; z arg present, so refer to c, not x
          (w (1+ z))) ;; w arg absent, use (1+ z)
     ...)) 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2010-08-11T22:59:17.630

除了[Rainer Joswig 的](https://stackoverflow.com/questions/554949/let-versus-let-in-common-lisp/587837#587837)回答，从纯粹主义者或理论的角度来看。Let & Let* 代表两种编程范式；分别是功能性和顺序性。

至于我为什么要继续使用 Let* 而不是 Let，嗯，你让我回家后用纯函数式语言思考的乐趣，而不是我大部分时间都在使用的顺序语言:)

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2009-02-20T14:33:23.280

我主要使用 LET，除非我特别需要 LET*，但有时我编写明确*需要*LET 的代码，通常是在执行各种（通常很复杂）默认设置时。不幸的是，我手头没有任何方便的代码示例。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2011-12-24T04:52:53.187

谁想再次重写 letf vs letf*？解除保护电话的数量？

更容易优化顺序绑定。

也许它会影响*环境*？

允许动态范围的延续？

有时 (let (xyz) (setq z 0 y 1 x (+ (setq x 1) (prog1 (+ xy) (setq x (1- x))))) (values () ))

[我认为可行] 要点是，有时更简单更容易阅读。

# synchronize - 您使用什么应用程序将工作目录与 ftp 目录同步？

> ID：554950
> 
> 赞同：3
> 
> 时间：2009-02-16T23:05:42.083
> 
> 标签：synchronize

我想对这个问题进行投票：您使用什么应用程序来同步本地 PC 上的工作目录和远程目录（通过 FTP）？

我有点厌倦了使用 FTP 客户端来传输我一直编辑的每个文件。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-16T23:17:35.610

在一个简单的情况下，您可以使用命令行程序`scp`或`ftp`命令行程序编写一个可以上传所有文件的小型命令行脚本。我使用 bash 脚本压缩所有文件，将其放在我的网络空间中，然后通过 ssh 解压缩文件。虽然这很容易在 linux 上使用 bash 来完成，但我认为你可以`bat`在 Windows 上使用类似的文件。

对于较大的 Web 开发项目，将代码提交到服务器端源存储库并使用[Capistrano](http://www.capify.org/)等工具将其部署到远程服务器，这是一个功能强大且功能齐全的各种 Web 应用程序部署工具。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T01:16:54.997

如果您要直接查看服务器上的文件，使用网络挂载可能会更容易。您可以在 Linux/OS X（通过 FUSE+ftpfs）或 Windows（它可以将 FTP 目录映射为网络驱动器，IIRC）中执行此操作。我自己更喜欢 sshfs，因为这意味着少了一项暴露给网络的服务。

但我同意其他人的观点——从长远来看，SCM 更好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T01:27:49.247

我使用 Subversion 将我的网站的本地副本（我在其上进行修改）与实时副本同步：每当我签入修订版时，SVN 挂钩脚本会自动更新实时站点......所以是的，我同意其他人谁在推荐源代码控制系统（SVN 或 Git）。它对我来说效果很好。

要考虑的一种替代方法是，一个类似于但仅传输已更改文件[`rsync`](http://samba.anu.edu.au/rsync/)的 Linux 程序。`scp`即使对于那些，它也使用类似 diff/patch 的算法来仅传输文件的更改部分。就像`scp`，它通常通过 SSH 隧道运行，尽管还有其他不安全的操作模式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T03:04:07.300

You can have a look at some FTP tool that provides visual synchronization. For example, on Windows, Mac, or Linux, you can use CrossFTP to do one-way or two-way synchronization. It supports masks and filters, and you can preview/modify the results as shown in the picture. [alt text http://img509.imageshack.us/img509/9417/picture1t.png](http://img509.imageshack.us/img509/9417/picture1t.png)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T12:19:11.650

ftp upload 现在应该已经死了；如果你可以 ssh 到 ftp 服务器，scp 和 rsync -e ssh 会好很多。有 Windows GUI 客户端，但我使用 Cygwin 命令行

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-18T12:22:09.770

尽管听起来到目前为止的答案足以满足您的需求（问题听起来像是您只是在上传更改，而不是下载更改），但基于 ftp/scp/rsync 的答案仅真正适合单向同步。如果您需要双向同步（上传和下载更改），那么您需要使用基于远程文件系统的解决方案或（更好，IMO）适当的修订控制系统，例如 git、svn 或 cvs .

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-17T01:07:08.187

也许是转向颠覆的好时机，即使它不是 ftp。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-17T01:24:24.463

如果您直接处理文件，那么也许您应该检查一个文本编辑器，该编辑器对处理 FTP 站点上的文件具有本机支持。UltraEdit (Windows) 和 BBEdit (Mac) 是我最喜欢的两个。

# python - Python中的参数化正则表达式

> ID：554957
> 
> 赞同：3
> 
> 时间：2009-02-16T23:07:59.660
> 
> 标签：python, regex

在 Python 中，有没有更好的方法将**字符串参数化为正则表达式**，而不是像这样手动执行：

```
test = 'flobalob'
names = ['a', 'b', 'c']
for name in names:
    regexp = "%s" % (name)
    print regexp, re.search(regexp, test) 
```

*这个点头示例尝试依次匹配每个名称。我知道有更好的方法可以做到这一点，但它只是一个简单的例子来说明这一点。*

* * *

**答案似乎是否定的，没有真正的选择。在 python 中参数化正则表达式的最佳方法是如上或使用诸如`str.format()`.** 我试图写一个通用问题，而不是*'fix ma codez, kthxbye'*。对于那些仍然感兴趣的人，我在这里充实了一个更接近我需求的示例：

```
for diskfilename in os.listdir(''):
    filenames = ['bob.txt', 'fred.txt', 'paul.txt']
    for filename in filenames:
        name, ext = filename.split('.')
        regexp = "%s.*\.%s" % (name, ext)
        m = re.search(regexp, diskfilename)
        if m:
          print diskfilename, regexp, re.search(regexp, diskfilename)
          # ... 
```

我试图根据文件名来确定文件的“类型”，格式为`<filename>_<date>.<extension>`. 在我的真实代码中，`filenames`数组是一个字典，包含一个找到匹配项后调用的函数。

我考虑过的其他方式：

*   **在数组中有一个正则表达式。**我已经有一个没有任何正则表达式魔法的文件名数组，所以我不愿意这样做。我在我的代码中的其他地方做了这个，它一团糟（尽管在那里是必要的）。

*   **仅匹配文件名的开头。**这会起作用，但会破坏文件的 .bak 副本等。在某些时候，我可能想从文件名中提取日期，因此无论如何都需要使用正则表达式。

* * *

感谢您的回复，建议使用正则表达式的替代方法来实现相同的最终结果。我对现在和未来的正则表达式参数化更感兴趣。我从来没有遇到过*fnmatch*，所以从长远来看它都是有用的。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-16T23:15:59.017

好吧，当您从字符串构建正则表达式时，我看不到其他方法。但是您可以使用字典*参数化字符串本身：*

```
d = {'bar': 'a', 'foo': 'b'}
regexp = '%(foo)s|%(bar)s' % d 
```

或者，根据问题，您可以使用列表推导：

```
vlist = ['a', 'b', 'c']
regexp = '|'.join([s for s in vlist]) 
```

**编辑：**马特澄清了他的问题，这让事情变得不同，上面提到的完全无关紧要。

我可能会采用这样的方法：

```
filename = 'bob_20090216.txt'

regexps = {'bob': 'bob_[0-9]+.txt',
           'fred': 'fred_[0-9]+.txt',
           'paul': 'paul_[0-9]+.txt'}

for filetype, regexp in regexps.items():
    m = re.match(regexp, filename)
    if m != None:
        print '%s is of type %s' % (filename, filetype) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-16T23:40:00.270

```
import fnmatch, os

filenames = ['bob.txt', 'fred.txt', 'paul.txt']

                  # 'b.txt.b' -> 'b.txt*.b'
filepatterns = ((f, '*'.join(os.path.splitext(f))) for f in filenames) 
diskfilenames = filter(os.path.isfile, os.listdir(''))
pattern2filenames = dict((fn, fnmatch.filter(diskfilenames, pat))
                         for fn, pat in filepatterns)

print pattern2filenames 
```

输出：

```
{'bob.txt': ['bob20090217.txt'], 'paul.txt': [], 'fred.txt': []} 
```

对您问题的先前版本的回答如下：

* * *

我不明白你更新的问题，但`filename.startswith(prefix)`在你的具体情况下可能就足够了。

更新问题后，下面的旧答案就不那么重要了。

* * *

1.  `re.escape(name)`如果您想匹配`name`字面意思，请使用。

2.  任何可用于字符串参数化的工具都适用于此。例如：

    ```
    import string
    print string.Template("$a $b").substitute(a=1, b="B")
    # 1 B 
    ```

    或者[`str.format()`](http://docs.python.org/library/string.html#format-string-syntax)在 Python 2.6+ 中使用：

    ```
    print "{0.imag}".format(1j+2)
    # 1.0 
    ```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-16T23:41:48.300

可能[glob](http://docs.python.org/library/glob.html)和[fnmatch](http://docs.python.org/library/fnmatch.html)模块对您有帮助吗？

# ftp - 如何阻止 Filezilla 更改我的换行符？

> ID：554960
> 
> 赞同：49
> 
> 时间：2009-02-16T23:08:25.337
> 
> 标签：ftp, line-breaks, filezilla

我正在从 Linux Web 服务器下载一个 perl CGI 文件。

它有 Unix 换行符。我在 Windows PC 上用一个不错的文本编辑器 (Geany) 编辑它，它保留了这些换行符。

然后我用 Filezilla 再次上传它，它有 DOS 换行符，这使它停止工作。

我知道它是 Filezilla，而不是 Geany，因为即使我只是下载它并重新上传它，问题也会再次出现。

Filezilla 每次都会问我是否可以上传本地文件 (3611) 字节并覆盖远程文件 (3753 字节)，这些数字之间的差异是我文件中的行数。但是当我这样做时，服务器上的那个又是 3753 字节并且不起作用。

我正在通过代理服务器，这可能是一个因素吗？真正奇怪的是，前几天我在另一台 XP PC 上做了同样的事情，结果很好。命令行 FTP 也可以正常工作。

* * *

## 回答 #1

> 赞同：128
> 
> 时间：2009-02-16T23:20:58.973

在 FileZilla 2.2.32 中，转到编辑 > 设置 > 文件传输设置 > ASCII/二进制。将其设置为始终二进制：这应该可以解决问题。

在 FileZilla 3.5.0 中，设置位于“编辑”>“设置”>“传输”>“文件类型”>“默认传输类型”>“二进制”中。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-16T23:20:19.520

您使用什么 FTP 传输模式（二进制还是 ASCII？）？我不是 100% 肯定，但我认为如果你强制二进制模式，你不应该有这个问题。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-12-20T00:03:15.973

FileZilla 的开发人员似乎对默认情况下应如何传输未知文件有非常独特的看法。

该[错误报告](http://trac.filezilla-project.org/ticket/4235)自 2008 年以来一直存在。当然，如果更多人加入并请求修复此漏洞可能会有所帮助。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-02-03T10:10:24.397

实际问题在于**Filezilla FTP 客户端默认传输模式**，默认为**“自动”**。按照以下步骤将其转换为**“二进制”**。

转到**“编辑|设置...”**

[![在此处输入图像描述](https://i.stack.imgur.com/Alsuc.png)](https://i.stack.imgur.com/Alsuc.png)

在新窗口中，转到**“传输|文件类型”**并在***“默认传输类型”***中选择**“二进制”**。

[![在此处输入图像描述](https://i.stack.imgur.com/Q5Sbs.png)](https://i.stack.imgur.com/Q5Sbs.png)

# php - 如何将 PHP 表单中的数据添加到数组中？

> ID：554961
> 
> 赞同：1
> 
> 时间：2009-02-16T23:08:39.987
> 
> 标签：php, arrays, forms, request

如果我有一个循环从我的表单中请求我的数据：

```
for ($i=0;$i < count($_POST['checkbx']);$i++) {
    // calculate the file from the checkbx
    $filename = $_POST['checkbx'][$i];
    $clearfilename = substr($filename, strrpos ($filename, "/") + 1);
    echo "'".$filename."',";       
} 
```

如何将其添加到下面的示例数组中？：

```
$files = array(
  'files.extension',
  'files.extension', 
); 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-16T23:14:55.430

更小：

```
$files = array();
foreach($_POST['checkbx'] as $file)
{
    $files[] = basename($file);
} 
```

如果您不确定它是否`$_POST['checkbx']`存在并且是一个数组，您应该这样做：

```
$files = array();
if (is_array(@$_POST['checkbx']))
{
    foreach($_POST['checkbx'] as $file)
    {
        $files[] = basename($file);
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-16T23:13:11.097

请记住，您还需要在 HTML 中为这些复选框命名，并在其名称后加上“[]”。例如：

```
<input type="checkbox" name="checkbx[]"  ...etc... > 
```

然后，您将能够访问它们：

```
<?php

// This will loop through all the checkbox values
for ($i = 0; $i < count($_POST['checkbx']); $i++) {
   // Do something here with $_POST['checkbx'][$i]
}

?> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-17T00:10:05.907

您可以使用 array_push 函数：

```
<?php
$stack = array("orange", "banana");
array_push($stack, "apple", "raspberry");
print_r($stack);
?> 
```

会给 ：

```
Array
(
    [0] => orange
    [1] => banana
    [2] => apple
    [3] => raspberry
) 
```

只需使用 array_push 为每个文件填充数组。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-16T23:11:10.760

```
$files[] =$filename; 
```

或者

```
array_push($files, $filename); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-16T23:11:04.613

大概是这样的：

```
for ($i=0;$i < count($_POST['checkbx']);$i++) {
// calculate the file from the checkbx
$filename = $_POST['checkbx'][$i];
$clearfilename = substr($filename, strrpos ($filename, "/") + 1);

$files[] = $filename; // of $clearfilename if that's what you wanting the in the array  
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-16T23:13:17.040

我不完全确定要添加到该数组中的内容，但这是使用 php 将数据“推送”到数组中的一般方法：

```
<?php
$array[] = $var;
?> 
```

例如你可以这样做：

```
for ($i=0;$i < count($_POST['checkbx']);$i++)
{
   // calculate the file from the checkbx
   $filename = $_POST['checkbx'][$i];
   $clearfilename = substr($filename, strrpos ($filename, "/") + 1);

   echo "'".$filename."',";       
   $files[] = $filename;
} 
```

# java - Spring框架-类加载器关系

> ID：554963
> 
> 赞同：3
> 
> 时间：2009-02-16T23:08:59.407
> 
> 标签：java, spring, classloader

我遇到了一个可能与 Spring / 类加载器关系有关的问题。

我现在为这个问题的冗长道歉。

我有许多最初编写并打算在专用 JVM 中运行的遗留 Java 应用程序。我们在检查资源使用情况后决定，可以通过在单个 JVM 中运行多个应用程序来提高效率。在这种情况下，我编写了一个专门为我们的环境设计的容器管理器，它能够在容器（或沙箱）中运行每个应用程序。这种隔离容器的能力的基础当然是自定义类加载器。

一切正常，直到我们遇到一个使用 Spring 框架的应用程序。我有一个带有片段的 Spring 配置文件，如下所示。

```
<bean id="MDDStructurPackager" class="abc.def.mdd.msg.alarm.huawei.MDDPackagerAlarmM2000">
    <property name="logger">
        <ref local="Logger"/>
    </property>
    <property name="realm">
        <value>unpack</value>
    </property>
</bean>

<bean id="Jakarta" class="abc.def.mdd.channel.corba.M2000AlarmChannel">
    <constructor-arg>
        <ref bean="MDDStructurPackager"/>
    </constructor-arg>
    <property name="interactionLayer">
        <ref local="MDDInteractionLayer"/>
    </property>
    <property name="logger">
        <ref local="Logger"/>
    </property>
    <property name="tempFile" value="/opt/app/abcdef/rt_dev/var/cache/dat/Huawei_M2000_Jakarta.dat"/>
    <property name="host" value="M2000Jakarta.ior"/>
    <property name="irpReference" value="clarity"/>
    <property name="name" value="M2000Jakarta"/>
    <property name="realm" value="Jakarta"/>
	<property name="natAddress" value="99.999.99.9" />
</bean> 
```

* * *

以下是 Spring 实例化 bean 时日志文件的片段。

调试 [South Agent 1] (DefaultSingletonBeanRegistry.java:162) - 创建单例 bean 'MDDStructurPackager' 的共享实例

调试 [South Agent 1] (AbstractAutowireCapableBeanFactory.java:378) - 创建 bean 'MDDStructurPackager' 的实例

调试 [South Agent 1] (AbstractAutowireCapableBeanFactory.java:453) - 急切地缓存 bean 'MDDStructurPackager' 以允许解析潜在的循环引用

调试 [South Agent 1] (AbstractBeanFactory.java:213) - 返回单例 bean 'Logger' 的缓存实例

DEBUG [South Agent 1] (CachedIntrospectionResults.java:242) - 获取类 [abc.def.mdd.msg.alarm.huawei.MDDPackagerAlarmM2000] 的 BeanInfo

DEBUG [South Agent 1] (CachedIntrospectionResults.java:258) - 缓存类 [abc.def.mdd.msg.alarm.huawei.MDDPackagerAlarmM2000] 的 PropertyDescriptors

调试 [South Agent 1] (CachedIntrospectionResults.java:267) - 找到类型 [java.lang.Class] 的 bean 属性“类”

调试 [South Agent 1] (CachedIntrospectionResults.java:267) - 找到类型 [java.lang.String] 的 bean 属性“colectionDate”

调试 [South Agent 1] (CachedIntrospectionResults.java:267) - 找到类型为 [abc.def.mdd.msg.MDDComponent] 的 bean 属性“组件”

调试 [South Agent 1] (CachedIntrospectionResults.java:267) - 找到类型 [java.lang.String] 的 bean 属性“fileType”

调试 [South Agent 1] (CachedIntrospectionResults.java:267) - 找到类型为 [java.util.ArrayList] 的 bean 属性“listCommonWords”

调试 [South Agent 1] (CachedIntrospectionResults.java:267) - 找到 [java.util.ArrayList] 类型的 bean 属性“listHeader”

调试 [South Agent 1] (CachedIntrospectionResults.java:267) - 找到 [abc.def.mdd.logger.Logger] 类型的 bean 属性“记录器”

调试 [South Agent 1] (CachedIntrospectionResults.java:267) - 找到类型 [java.util.Map] 的 bean 属性“mapDelimiter”

调试 [South Agent 1] (CachedIntrospectionResults.java:267) - 找到 [java.util.Map] 类型的 bean 属性“mapElement”

调试 [South Agent 1] (CachedIntrospectionResults.java:267) - 找到类型 [java.lang.String] 的 bean 属性“namePackager”

调试 [South Agent 1] (CachedIntrospectionResults.java:267) - 找到类型 [java.lang.String] 的 bean 属性“nameSpaceXMLSchema”

调试 [South Agent 1] (CachedIntrospectionResults.java:267) - 找到类型 [java.lang.String] 的 bean 属性“nodeName”

调试 [South Agent 1] (CachedIntrospectionResults.java:267) - 找到类型 [java.lang.String] 的 bean 属性“packageXMLSchema”

调试 [South Agent 1] (CachedIntrospectionResults.java:267) - 找到类型 [abc.def.mdd.channel.ProcessingLayerListener] 的 bean 属性“processingLayerListener”

调试 [South Agent 1] (CachedIntrospectionResults.java:267) - 找到类型 [java.lang.String] 的 bean 属性“领域”

调试 [South Agent 1] (CachedIntrospectionResults.java:267) - 找到类型 [java.lang.String] 的 bean 属性“statesObject”

DEBUG [South Agent 1] (AbstractAutowireCapableBeanFactory.java:406) - 完成创建 bean 'MDDStructurPackager' 的实例

调试 [South Agent 1] (DefaultSingletonBeanRegistry.java:162) - 创建单例 bean 'ListAlarmChannel' 的共享实例

调试 [South Agent 1] (AbstractAutowireCapableBeanFactory.java:378) - 创建 bean 'ListAlarmChannel' 的实例

调试 [South Agent 1] (AbstractAutowireCapableBeanFactory.java:453) - 急切地缓存 bean 'ListAlarmChannel' 以允许解析潜在的循环引用

调试 [South Agent 1] (DefaultSingletonBeanRegistry.java:162) - 创建单例 bean 'Jakarta' 的共享实例

调试 [South Agent 1] (AbstractAutowireCapableBeanFactory.java:378) - 创建 bean 'Jakarta' 的实例

调试 [South Agent 1] (AbstractBeanFactory.java:213) - 返回单例 bean 'MDDStructurPackager' 的缓存实例

信息：CORBA_HUAWEI_M2KJKT_ALARM (23447542)：在类路径中添加了“/opt/app/abcdef/rt_dev/lib/logkit-1.2.jar”。

信息：CORBA_HUAWEI_M2KJKT_ALARM (23447542)：在类路径中添加了“/opt/app/abcdef/rt_dev/lib/avalon-framework-4.1.5.jar”。

信息：CORBA_HUAWEI_M2KJKT_ALARM (23447542)：在类路径中添加了“/opt/app/abcdef/rt_dev/lib/concurrent-1.3.2.jar”。

信息：CORBA_HUAWEI_M2KJKT_ALARM (23447542)：在类路径中添加了“/opt/app/abcdef/rt_dev/lib/antlr-2.7.2.jar”。

调试 [South Agent 1] (ConstructorResolver.java:195) -
忽略构造函数 [public abc.def.mdd.channel.corba.M2000AlarmChannel(
java.lang.String, int, java.lang.String, java.lang.String, com.citycorp.mdd.msg.MDDComponent ）抛出
bean 'Jakarta' 的 java.lang.Exception ]：org.springframework.beans.factory.UnsatisfiedDependencyException：
创建文件 [/opt/app/ 中定义的名称为 'Jakarta' 的 bean 时出错abcdef/rt_dev/etc/HUAWEI_M2KJKT_ALARM.xml]：
通过构造函数参数表达的不满足的依赖关系，索引为0，类型为[java.lang.String]：
无法将类型 [abc.def.mdd.msg.alarm.huawei.MDDPackagerAlarmM2000] 的构造函数参数值转换为所需类型 [java.lang.String]：
无法转换类型 [abc.def.mdd.msg.alarm] 的值.huawei.MDDPackagerAlarmM2000] 到所需类型 [java.lang.String];
嵌套异常是 java.lang.IllegalArgumentException：无法将类型 [abc.def.mdd.msg.alarm.huawei.MDDPackagerAlarmM2000] 的值转换为所需类型 [java.lang.String]：
找不到匹配的编辑器或转换策略

* * *

以下是 abc.def.mdd.channel.corba.M2000AlarmChannel 类的构造函数的签名：

公共 M2000AlarmChannel（MDDComponent 组件）

public M2000AlarmChannel(String host, int port, String username, String password, MDDComponent componenet)

abc.def.mdd.msg.alarm.huawei.MDDPackagerAlarmM2000类实现了MDDComponent（bean MDDStructurPackager）。

* * *

* * *

如您所见，Spring 正在实例化一些 bean，即。MDDStructurPackager 没有问题。

问题是实例化“Jakarta”bean。

线条的含义：

**在文件 [/opt/app/abcdef/rt_dev/etc/HUAWEI_M2KJKT_ALARM.xml] 中定义名称为“Jakarta”的 bean 创建错误：**

**通过类型为 [java.lang.String] 的索引 0 的构造函数参数表示的不满足依赖关系：**

**无法将类型 [abc.def.mdd.msg.alarm.huawei.MDDPackagerAlarmM2000] 的构造函数参数值转换为所需类型 [java.lang.String]：**

不清楚。在尝试确定适当的构造函数时，我不确定类型混淆的原因。问题可能与接口 MDDComponent 的加载有关。如果它被加载两次，在类加载器层次结构中不相关的不同类加载器，您可以想象与确定正确构造函数相关的问题。

任何感激地接受的想法，我都在抓住稻草。

谢谢布莱恩

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-17T00:01:11.280

从错误消息中，听起来 Spring 正在尝试使用此构造函数实例化对象：

```
public M2000AlarmChannel(String host, int port, String username, String password, MDDComponent componenet) 
```

看起来 Spring 对使用哪个构造函数感到困惑，可能是因为两个构造函数都有一个`MDDComponent`参数（在某种程度上，两个构造函数都将 this 作为最后一个参数，我很好奇这是否与 Spring 在确定时使用的逻辑有关使用哪个构造函数。无论如何......）。

根据[Spring 手册](http://static.springframework.org/spring/docs/2.5.x/reference/beans.html#beans-constructor-injection)，您可以向`<constructor-arg>`元素添加一些参数，以帮助容器解析要使用的构造函数：

您可以添加“类型”：

```
<bean id="exampleBean" class="examples.ExampleBean">
  <constructor-arg type="int" value="7500000"/>
  <constructor-arg type="java.lang.String" value="42"/>
</bean> 
```

或者你可以添加一个索引：

```
<bean id="exampleBean" class="examples.ExampleBean">
  <constructor-arg index="0" value="7500000"/>
  <constructor-arg index="1" value="42"/>
</bean> 
```

（如果你真的想，你可以同时指定两者）

添加其中一个或两个应该有助于 Spring 解决要使用的构造函数。

作为推论，如果这没有帮助，您是否可以简单地更改 XML 定义以传递另一个构造函数所需的参数，即 Spring 试图使用的构造函数？

顺便说一句，在 WMD 中使用引号标签可能会使您的问题更具可读性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-16T23:23:54.910

事实上，我认为是。您传递给 Jakarta 对象的第一个构造函数参数的类型为 abc.def.mdd.msg.alarm.huawei.MDDPackagerAlarmM2000，但 ctor 需要一个字符串。使类型正确匹配。

它读作直截了当的消息。我错过了什么？

我将从包结构中假设这些是您的类。真的？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-16T23:37:25.173

你能控制`AlarmChannel`班级吗？如果是这样，您是否可以滚动一个在构造函数中具有打印语句的新版本（您也可以在初始化程序中使用`try-catch`从`static`初始化类的位置获取堆栈跟踪）？

这样，您可能会了解是否涉及重复的类

同样在 Spring 配置文件中，您可以`ClassLoader`使用 a 打印出`MethodInvokingFactoryBean`- 这也可能对此事有所帮助？

# xpath - Selenium：如何在测试中执行 Xpath 函数或表达式？

> ID：554964
> 
> 赞同：3
> 
> 时间：2009-02-16T23:09:03.417
> 
> 标签：xpath, selenium

有没有办法在 Selenium 测试中执行一些 Xpath 代码？我知道你可以执行 javascript，但我正在寻找一种方法来执行一些 Xpath 代码，而不仅仅是在页面上定位一个元素。

有人遇到这个吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-05T17:55:57.803

据我了解，XPath 函数是 XPath 2.0 的一部分。Selenium 不支持 2.0。因此，在 selenium 中执行 XPath 函数是不可能的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-04-09T22:53:30.167

我相信接受的答案是不正确的。我目前正在使用 Java 学习 Selenium WebDriver，我被定向到以下博客文章，以了解如何在 Selenium 2 中执行 XPath 函数来管理变量 xpath。我相信这就是您正在寻找的。

[http://automationtricks.blogspot.com/2010/09/how-to-use-functions-in-xpath-in.html](http://automationtricks.blogspot.com/2010/09/how-to-use-functions-in-xpath-in.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T15:26:46.233

安德鲁，有趣的问题。您可能想尝试 Selenium 开发人员论坛或高级使用论坛，因为我可能是目前唯一一个在 StackOverflow 上闲逛的 Selenium 开发人员 :)

也就是说，我很肯定你可以做到这一点，但我现在不能给你代码（在没有 Selenium 源的笔记本电脑上）。它将需要获取“浏览器机器人”的句柄（请参阅运行任意 JS 代码的示例以了解如何执行此操作）。从那里，可能有一个函数调用（或可能的调用链）可以得到你想要的：对 Selenium 的 XPath 抽象的调用。

或者，如果您只支持 Firefox 没问题，只需查找 JS 代码来执行 Firefox XPath 查询并调用它。嵌入到 storeEval 类型的命令中相当容易。或者，请记住 Selenium 在 Selenium 的 JS 库旁边注入了一个 XPath 库。也可以直接调用。您不会得到 Selenium 为一些简单的 XPath 表达式提供的快捷方式和抽象，但我确信它会起作用。

你能分享你正在尝试做的事情吗？通常，当我尝试从元素中获取属性或文本值时，这些东西会出现。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-26T11:57:25.820

根据 W3C XPath 1.0 规范，XPath 1.0 支持函数，但可用函数集相当有限：http: [//www.w3.org/TR/xpath#section-String-Functions](http://www.w3.org/TR/xpath#section-String-Functions)

特别是“ends-with”功能不可用 - 我使用像这样的表达式

`//input[substring(@id, string-length(@id) - string-length('<idSuffix>') +1) = '<idSuffix>']`

作为一种解决方法（在这种情况下，要找到一个以 id 结尾的输入元素`'<idSuffix>'`）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-30T22:46:03.720

查看 Selenium 1.0.1 版本中 htmlutils.js 文件的第 1177 行（在处理所有 XPath 查询的 eval_xpath() 函数中）：

```
 var result = xpathResult.iterateNext(); 
```

这里的问题是，根据[XPathResult 规范](http://www.w3.org/TR/DOM-Level-3-XPath/xpath.html#XPathResult-iterateNext)，如果结果类型不是可迭代的节点集，iterateNext() 将抛出异常。由于 Selenium 盲目地假定所有 XPath 查询都会产生一个节点集，因此您无法执行返回数字或字符串的查询。

您可以做的是修改 htmlutils.js，将第 1177-1181 行替换为以下内容：

```
 var iterable =
     xpathResult.resultType == xpathResult.ORDERED_NODE_ITERATOR_TYPE ||
     xpathResult.resultType == xpathResult.UNORDERED_NODE_ITERATOR_TYPE;

    if (iterable) {
     var result = xpathResult.iterateNext();
     while (result) {
         results.push(result);
         result = xpathResult.iterateNext();
     }
    } else if (xpathResult.resultType == xpathResult.NUMBER_TYPE) {
     results.push(inDocument.createTextNode(xpathResult.numberValue));
    } 
```

这个想法是，如果我们看到一个数字值，我们将它包装在 DOM TextNode 中并像往常一样传递它，就 Selenium 而言，这种变化或多或少是透明的。Selenium 的 getText 命令对 TextNodes 进行了特殊处理（它将其文本内容作为字符串返回），因此现在您可以执行类似的操作

```
int count = Integer.parseInt(selenium.getText("xpath=count(//td) + 1"), 10); 
```

如果您像我一样使用 SeleniumRC Java 客户端，那么*selenium是 DefaultSelenium 的一个实例。*当然，这是一个简单的示例，因为您可以只使用 getXpathCount() 并且还有其他 XPathResult 类型要处理，但这应该可以让您走上正确的道路。

另请注意，上面提到的特定行仅用于 XPath 查询的浏览器本机执行。使用 Selenium 的内置 XPath 库的执行会在 eval_xpath() 内部立即处理，并且可能需要类似的修改 - 但我还没有研究过这个。

# objective-c - 定义缓存变量时在objective-c中使用static关键字

> ID：554969
> 
> 赞同：42
> 
> 时间：2009-02-16T23:10:59.840
> 
> 标签：objective-c, caching, static

我正在查看以下苹果示例源代码：

```
 /*
 Cache the formatter. Normally you would use one of the date formatter styles (such as NSDateFormatterShortStyle), but here we want a specific format that excludes seconds.
 */
static NSDateFormatter *dateFormatter = nil;
if (dateFormatter == nil) {
    dateFormatter = [[NSDateFormatter alloc] init];
    [dateFormatter setDateFormat:@"h:mm a"];
} 
```

试图弄清楚：

*   为什么要使用 static 关键字？

*   如果每次调用该方法时将其设置为 nil，这如何等同于缓存变量。

代码来自[Tableview Suite 演示中的示例 4](https://developer.apple.com/iphone/library/samplecode/TableViewSuite/index.html#//apple_ref/doc/uid/DTS40007318)

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-02-16T23:21:28.567

静态变量在重复调用函数时保留其分配的值。它们基本上就像全局值，仅对该函数“可见”。

然而，初始化语句只执行一次。

此代码在第一次使用该函数时将 dateFormatter 初始化为 nil。在随后对该函数的每次调用中，都会对 dateFormatter 的值进行检查。如果未设置（仅第一次为真），则会创建一个新的 dateFormatter。如果已设置，则将使用静态 dateFormatter 变量。

熟悉静态变量是值得的。它们可能非常方便，但也有缺点（例如，在此示例中，不可能释放 dateFormatter 对象）。

只是一个提示：有时在代码中放置一个断点并看看发生了什么可能是有教育意义的。随着程序复杂性的增加，这将成为一项宝贵的技能。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-02-16T23:20:38.553

在这种情况下， “ `static`”在功能上意味着“不要每次都评估等号右侧的内容，而是使用其先前的值”。

以重大责任使用这种强大的力量：您冒着使用大量内存的风险，因为这些是永远不会消失的对象。除了在这种情况下，它很少适合使用`NSDateFormatter`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-01-06T21:36:30.333

出于参考目的，这就是我使用静态日期格式化程序在表格视图控制器中使用的方式。

```
+ (NSDateFormatter *) relativeDateFormatter
{
     static NSDateFormatter *dateFormatter;
     static dispatch_once_t onceToken;
     dispatch_once(&onceToken, ^{
         //NSLog(@"Created");
         dateFormatter = [[NSDateFormatter alloc] init];
         [dateFormatter setTimeStyle:NSDateFormatterNoStyle];
         [dateFormatter setDateStyle:NSDateFormatterMediumStyle];
         NSLocale *locale = [NSLocale currentLocale];
         [dateFormatter setLocale:locale];
         [dateFormatter setDoesRelativeDateFormatting:YES];
     });
     return dateFormatter;
} 
```

# c# - 如何从类型列表的子类访问一个类

> ID：554974
> 
> 赞同：0
> 
> 时间：2009-02-16T23:12:10.773
> 
> 标签：c#, list, class

我在 C# 中有以下代码，我试图找出为什么我无法从类型列表中的子类访问类地址的元素。这是代码

```
MemberList list = MemberDB.GetMembers("sql", m_page, 
    m_RecordPerPage, out count, _state);

/*******************************/

public static MemberList GetMembers(string sql, int page, 
    int pageSize, out int count, string parState)
{
    MemberList retval = new MemberList();

    SqlParameter pOut = new SqlParameter("@Count", SqlDbType.Int, 4);
    pOut.Direction = ParameterDirection.Output;

    SqlParameter[] param = new SqlParameter[]{
    new SqlParameter("@Sql", sql),
    new SqlParameter("@parState", parState),
    new SqlParameter("@Page", page),
    new SqlParameter("@PageSize", pageSize),
    pOut };

    using (SqlDataReader reader = SqlHelper.ExecuteReader(
        Helper.ConnectionString, CommandType.StoredProcedure, 
        "[app_Member_Search]", param))
    {
        while (reader.Read())
        //if (reader.Read())
        {
            retval.Add(Read(reader));
            //retval = Read(reader);
        }
    }

    count = Helper.ToInt32(pOut.Value);

    return retval;
} 
```

* * *

* * *

```
public class Member
{
    private Address m_address;

    public Address Address
    {
        get { return m_address; }
        set { m_address = value; }
    }

    public Member()
    {
        m_address = new Address();
    }
}

public class MemberList : List<Member>
{
    public MemberList() { }
} 
```

* * *

```
case "Address": 
    retval.Address.Address1 = Helper.ToString(reader[i]);
    //throw new Exception(Helper.ToString(reader[i]));
    //retval.Address1 = Helper.ToString(reader[i]);
    break;

case "Address2": 
    retval.Address.Address2 = Helper.ToString(reader[i]); 
    //retval.Address2 = Helper.ToString(reader[i]); 
    break;

case "City": 
    retval.Address.City = Helper.ToString(reader[i]);
    //retval.City = Helper.ToString(reader[i]); 
    break;

case "State": 
    retval.Address.State = Helper.ToString(reader[i]);
    //retval.State = Helper.ToString(reader[i]); 
    break; 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T23:53:34.087

我认为您的问题可能来自对*MemberList*类的继承层次结构感到困惑。它实际上根本不是 member 的子类，它是 List(Of T) 的子类。当您将*T*替换为某个类名时，您只是在说该列表应该是该类型的列表，但该列表仍然是一个列表，而不是该类型的子类。这是使用称为泛型的 .net 功能。[您可以在此处](http://msdn.microsoft.com/en-us/library/ms379564.aspx)阅读有关泛型的更多信息。

如果您的示例中的 switch 语句引用了在您的第一个代码片段中可以看到的相同*retval ，您将需要在列表中指定一个索引才能使其工作。*如：

```
//index should be set to the correct index for the Member you are modifying
retval[index].Address.Address1 = "Some Value"; 
```

但是，这将需要您在列表中添加一个新成员才能起作用。我可能会创建一个新的 Member 实例，在 switch 语句中设置属性，然后将其添加到最后的 MemberList 中。这样，您就避免了每次要设置属性时都必须索引到列表中，因此它是一种更简洁且稍快的解决方案（在执行时间和写入时间方面）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-16T23:23:41.557

引用基类上的公共或受保护方法或属性时，请务必在其前面加上`base.`

我写了一个非常抽象的例子，它应该引导你正确地了解如何从子类调用父类中的函数

```
using System;

namespace simpletest
{
    class Program
    {
        static void Main(string[] args)
        {
            Bird sparrow = new Bird();
            Console.WriteLine("Is the bird flying? " + sparrow.IsFlying + "\n");

            Console.WriteLine("Make the bird fly.");
            sparrow.Fly();
            Console.WriteLine("Is the bird flying? " + sparrow.IsFlying + "\n");

            Console.WriteLine("Make the bird land.");
            sparrow.Land();
            Console.WriteLine("Is the bird flying? " + sparrow.IsFlying);
            Console.ReadLine();
        }
    }

    public abstract class Animal
    {
        bool _isMoving = false;

        protected bool IsMoving
        {
          get { return _isMoving; }
        }

        protected void StartMoving()
        {
            _isMoving = true;
        }

        protected void StopMoving()
        {
            _isMoving = false;
        }
    }

    public class Bird : Animal, IFlyable
    {
        public void Fly()
        {
            base.StartMoving();
        }

        public void Land()
        {
            base.StopMoving();
        }

        public bool IsFlying
        {
            get { return base.IsMoving; }
        }
    }

   interface IFlyable
   {
       void Fly();
       bool IsFlying { get; }
       void Land();
   }
} 
```

# browser - 如何在浏览器中录制语音？

> ID：554982
> 
> 赞同：11
> 
> 时间：2009-02-16T23:14:27.913
> 
> 标签：browser, record, voice

我需要用户在浏览器上录制他们的声音，然后自动将生成的 mp3 上传到网络服务器。

我在想用户按下一个大胖开始记录/停止记录按钮来做到这一点。

然后，这会将文件保存在用户硬盘上。然后它将被有效地压缩并自动 ftp'​​d 到一个网站。

是否可以使用 ActiveX 或 Java 来做到这一点？或者有没有图书馆可以提供帮助？

该应用程序适用于可以在需要时安装软件的用户，因此可以安装 exe 或其他任何东西。

任何建议都非常感谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-16T23:15:56.910

理想的解决方案是`getUserMedia`Stream API。不幸的是，它目前在现代浏览器中并没有得到很好的支持。截至 2012 年 6 月 14 日，根据[caniuse.com](https://caniuse.com/#feat=stream)确认支持的唯一浏览器是 Chrome 21。[其他](https://docs.microsoft.com/en-us/archive/blogs/ie/media-capture-prototype-improved-support-for-real-world-web-apps)浏览器似乎正在研究可靠的实现。

在原生支持到来之前，Flash 可以访问和录制[音频](https://web.archive.org/web/20120225084910/http://livedocs.adobe.com:80/fms/2/docs/00000550.html)和[视频](http://livedocs.adobe.com/fms/2/docs/wwhelp/wwhimpl/common/html/wwhelp.htm?context=LiveDocs_Parts&file=00000526.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-16T23:17:00.543

您可以使用闪光灯与客户的麦克风进行交互，这需要用户的许可。有关实现细节，请访问我的参考。

参考： http: [//fmsguru.com/showarticle.cfm?articleID=25](http://fmsguru.com/showarticle.cfm?articleID=25)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-11-27T05:26:31.347

带宽方面最有效的免费解决方案可能是开发一个将 Speex 数据流式传输到 Flash 媒体服务器（例如 Red5/Wowza）的 Flash 应用程序。虽然这是一个巨大的痛苦。

一个更简单的解决方案是通过标准 HTTP 发布流式传输原始音频。这可以在*没有*专有媒体服务器的情况下在 Flash 中完成：

[https://code.google.com/p/wami-recorder/](https://code.google.com/p/wami-recorder/)

如果您在服务器端需要 MP3，您可以使用[lame](http://www.example.com/)进行转码。

# flash - 如何从外部类访问 MovieClip 符号中的动态文本？

> ID：554996
> 
> 赞同：1
> 
> 时间：2009-02-16T23:19:15.450
> 
> 标签：flash, actionscript, actionscript-2

我正在使用 Flash CS3 和 ActionScript 2。我有一个包含标识符为“innerText”的动态文本块的 MovieClip 符号（标识为“MySymbol”）。使用以下“MySymbol.as”文件将该符号标记为“Export for ActionScript”：

```
MySymbol 类扩展了 MovieClip
{
        函数 SetText(文本)
        {
                innerText.text = 文本；
        }
}

```

在框架动作中，我尝试执行以下操作：

```
var symInst = _root.attachMovie("MySymbol", "MySymbol" + _root.getNextHighestDepth(), _root.getNextHighestDepth());
symInst.SetText("hi"); // 失败
symInst.innerText.text = "嗨"; // 工作

```

我得到编译错误：

```
没有名称为“innerText”的属性。
```

为什么我可以从框架操作中访问 innerText，但不能在 .as 文件本身中引用它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-16T23:48:04.010

您收到编译器错误，因为“innerText”在编译时对类不可用（即它在*运行时*可用）。

快速解决方法是使用

```
this['innerText'].text = text; 
```

代替

```
innerText.text = text; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-17T21:33:41.623

我猜测 TextField“innerText”是使用 Flash CS3 中的文本工具创建的。如果是这种情况，那么编译器在一定程度上了解它，因为它需要从 .FLA 文件中获取关于它需要在舞台上创建哪些元素或它需要在库中放置哪些符号的信息。

要从您的类中访问该属性，您需要在您的类中为它定义一个变量，即使它在技术上是该 MovieClip 的一部分。

尝试像这样修改你的类：

```
class MySymbol extends MovieClip 
```

{

```
 private var innerText:TextField;

    function SetText(text)
    {
            innerText.text = text;
    } 
```

}

通过在类中添加 innerText 的声明，编译器将确定它在寻找什么而不是假设该属性存在，就像使用 this['innerText'] 一样。（尽管这仍然是访问该属性的有效方式。

# ios - 取消 UIView 动画？

> ID：554997
> 
> 赞同：251
> 
> 时间：2009-02-16T23:19:41.253
> 
> 标签：ios, core-animation, uiviewanimation

是否可以在动画进行时取消`UIView`动画？还是我必须降到CA级别？

即我做了这样的事情（也许也设置了一个结束动画动作）：

```
[UIView beginAnimations:nil context:NULL];
[UIView setAnimationDuration:duration];
[UIView setAnimationCurve: UIViewAnimationCurveLinear];
// other animation properties

// set view properties

[UIView commitAnimations]; 
```

但是在动画完成并且我得到动画结束事件之前，我想取消它（缩短它）。这可能吗？谷歌搜索发现有几个人问同样的问题却没有答案——还有一两个人推测这不可能完成。

* * *

## 回答 #1

> 赞同：363
> 
> 时间：2010-03-19T06:53:32.753

采用：

```
#import <QuartzCore/QuartzCore.h>

.......

[myView.layer removeAllAnimations]; 
```

* * *

## 回答 #2

> 赞同：115
> 
> 时间：2009-05-08T21:46:03.680

我这样做的方法是为您的终点创建一个新动画。设置一个非常短的持续时间并确保您使用该`+setAnimationBeginsFromCurrentState:`方法从当前状态开始。当您将其设置为 YES 时，当前动画将被缩短。看起来像这样：

```
[UIView beginAnimations:nil context:NULL];
[UIView setAnimationBeginsFromCurrentState:YES];
[UIView setAnimationDuration:0.1];
[UIView setAnimationCurve: UIViewAnimationCurveLinear];
// other animation properties

// set view properties

[UIView commitAnimations]; 
```

* * *

## 回答 #3

> 赞同：63
> 
> 时间：2012-01-03T23:03:22.647

*立即*停止特定视图上*所有*动画的最简单方法是：

 *将项目链接到 QuartzCore.framework。在代码的开头：

```
#import <QuartzCore/QuartzCore.h> 
```

现在，当你想停止视图中的所有动画时，可以这样说：

```
[CATransaction begin];
[theView.layer removeAllAnimations];
[CATransaction commit]; 
```

中间线可以自己工作，但是在运行循环完成之前会有延迟（“重绘时刻”）。为了防止这种延迟，请将命令包装在显式事务块中，如图所示。如果在当前运行循环中没有对该层执行其他更改，则此工作有效。

* * *

## 回答 #4

> 赞同：48
> 
> 时间：2011-08-11T08:30:54.467

在 iOS 4 和更高版本上，**使用第二个动画上的`UIViewAnimationOptionBeginFromCurrentState`选项**来缩短第一个动画。

例如，假设您有一个带有活动指示器的视图。您希望在一些可能耗时的活动开始时淡入活动指示器，并在活动完成时将其淡出。在下面的代码中，上面带有活动指示器的视图被称为`activityView`。

```
- (void)showActivityIndicator {
    activityView.alpha = 0.0;
    activityView.hidden = NO;
    [UIView animateWithDuration:0.5
                 animations:^(void) {
                     activityView.alpha = 1.0;
                 }];

- (void)hideActivityIndicator {
    [UIView animateWithDuration:0.5
                 delay:0 options:UIViewAnimationOptionBeginFromCurrentState
                 animations:^(void) {
                     activityView.alpha = 0.0;
                 }
                 completion:^(BOOL completed) {
                     if (completed) {
                         activityView.hidden = YES;
                     }
                 }];
} 
```

* * *

## 回答 #5

> 赞同：42
> 
> 时间：2010-06-19T17:09:34.700

要取消动画，您只需在 UIView 动画之外设置当前正在动画的属性。这将在任何地方停止动画，并且 UIView 将跳转到您刚刚定义的设置。

* * *

## 回答 #6

> 赞同：31
> 
> 时间：2017-11-09T17:57:47.473

很抱歉恢复这个答案，但在 iOS 10 中，情况发生了一些变化，现在可以取消，您甚至可以优雅地取消！

在 iOS 10 之后，您可以使用[UIViewPropertyAnimator](https://developer.apple.com/documentation/uikit/uiviewpropertyanimator)取消动画！

```
UIViewPropertyAnimator(duration: 2, dampingRatio: 0.4, animations: {
    view.backgroundColor = .blue
})
animator.stopAnimation(true) 
```

如果你传递 true ，它会取消动画并在你取消它的地方停止。不会调用完成方法。但是，如果您传递 false 您负责完成动画：

```
animator.finishAnimation(.start) 
```

您可以完成动画并保持当前状态 (.current) 或进入初始状态 (.start) 或结束状态 (.end)

顺便说一句，您甚至可以稍后暂停并重新启动...

```
animator.pauseAnimation()
animator.startAnimation() 
```

注意：如果您不想突然取消，您可以在暂停后反转动画甚至更改动画！

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2014-11-07T17:21:23.377

如果您通过更改常量而不是视图属性来为约束设置动画，则其他方法都不能在 iOS 8 上运行。

示例动画：

```
self.constraint.constant = 0;
[self.view updateConstraintsIfNeeded];
[self.view layoutIfNeeded];
[UIView animateWithDuration:1.0f
                      delay:0.0f
                    options:UIViewAnimationOptionCurveLinear
                 animations:^{
                     self.constraint.constant = 1.0f;
                     [self.view layoutIfNeeded];
                 } completion:^(BOOL finished) {

                 }]; 
```

**解决方案：**

您需要从受约束更改影响的任何视图的图层及其子图层中删除动画。

```
[self.constraintView.layer removeAllAnimations];
for (CALayer *l in self.constraintView.layer.sublayers)
{
    [l removeAllAnimations];
} 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2015-06-29T11:02:59.250

如果您只想平稳地暂停/停止动画

```
self.yourView.layer.speed = 0; 
```

来源：[如何暂停图层树的动画](https://developer.apple.com/library/ios/qa/qa1673/_index.html)

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2011-08-16T17:21:54.660

以上都没有为我解决它，但这有帮助：`UIView`动画立即设置属性，然后对其进行动画处理。当表示层匹配模型（设置属性）时，它会停止动画。

我解决了我的问题，即“我想从你看起来像你出现的地方开始制作动画”（'你'意味着视图）。如果你想要那个，那么：

1.  添加石英核心。
2.  `CALayer * pLayer = theView.layer.presentationLayer;`

将位置设置为表示层

我使用了一些选项，包括`UIViewAnimationOptionOverrideInheritedDuration`

但是因为苹果的文档比较模糊，我不知道它在使用时是否真的会覆盖其他动画，或者只是重置计时器。

```
[UIView animateWithDuration:blah... 
                    options: UIViewAnimationOptionBeginFromCurrentState ... 
                    animations: ^ {
                                   theView.center = CGPointMake( pLayer.position.x + YOUR_ANIMATION_OFFSET, pLayer.position.y + ANOTHER_ANIMATION_OFFSET);
                   //this only works for translating, but you get the idea if you wanna flip and scale it. 
                   } completion: ^(BOOL complete) {}]; 
```

现在这应该是一个不错的解决方案。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2015-02-06T05:30:56.547

```
[UIView setAnimationsEnabled:NO];
// your code here
[UIView setAnimationsEnabled:YES]; 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2017-12-26T15:09:46.620

Stephen Darlington 解决方案的 Swift 版本

```
UIView.beginAnimations(nil, context: nil)
UIView.setAnimationBeginsFromCurrentState(true)
UIView.setAnimationDuration(0.1)
// other animation properties

// set view properties
UIView.commitAnimations() 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-05-08T17:03:03.813

我也有同样的问题; API 没有任何东西可以取消某些特定的动画。这

`+ (void)setAnimationsEnabled:(BOOL)enabled`

禁用所有动画，因此对我不起作用。有两种解决方案：

1）使您的动画对象成为子视图。然后，当您想取消该视图的动画时，删除该视图或将其隐藏。非常简单，但是如果您需要将其保留在视图中，则需要重新创建没有动画的子视图。

2) 只重复一个动画，并在需要时制作一个委托选择器来重新启动动画，如下所示：

```
-(void) startAnimation {
NSLog(@"startAnim alpha:%f", self.alpha);
[self setAlpha:1.0];
[UIView beginAnimations:nil context:nil];
[UIView setAnimationDuration:1.0];
[UIView setAnimationRepeatCount:1];
[UIView setAnimationRepeatAutoreverses:YES];
[UIView setAnimationDelegate:self];
[UIView setAnimationDidStopSelector:@selector(pulseAnimationDidStop:finished:context:)];
[self setAlpha:0.1];
[UIView commitAnimations];
}

- (void)pulseAnimationDidStop:(NSString *)animationID finished:(NSNumber *)finished context:(void *)context {
if(hasFocus) {
    [self startAnimation];
} else {
    self.alpha = 1.0;
}
}

-(void) setHasFocus:(BOOL)_hasFocus {
hasFocus = _hasFocus;
if(hasFocus) {
    [self startAnimation];
}
} 
```

2) 的问题是动画在完成当前动画周期时总是会延迟停止。

希望这可以帮助。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-10-05T08:52:39.933

即使您以上述方式取消动画，动画`didStopSelector`仍然运行。因此，如果您的应用程序中有由动画驱动的逻辑状态，您就会遇到问题。出于这个原因，通过上述方式，我使用`UIView`动画的上下文变量。如果您通过上下文参数将程序的当前状态传递给动画，那么当动画停止时，您的`didStopSelector`函数可能会根据当前状态和作为上下文传递的状态值来决定它是否应该执行某些操作或仅返回。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-01-28T14:54:35.710

```
CALayer * pLayer = self.layer.presentationLayer;
[UIView setAnimationBeginsFromCurrentState:YES];
[UIView animateWithDuration:0.001 animations:^{
    self.frame = pLayer.frame;
}]; 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-12-03T21:43:48.233

要暂停动画而不将状态恢复到原始或最终状态：

```
CFTimeInterval paused_time = [myView.layer convertTime:CACurrentMediaTime() fromLayer:nil];
myView.layer.speed = 0.0;
myView.layer.timeOffset = paused_time; 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2019-02-07T09:03:02.137

当我使用`UIStackView`动画时，除了`removeAllAnimations()`我需要将一些值设置为初始值，因为`removeAllAnimations()`可以将它们设置为不可预测的状态。我有`stackView`with`view1`和`view2`inside，一个视图应该是可见的，一个是隐藏的：

```
public func configureStackView(hideView1: Bool, hideView2: Bool) {
    let oldHideView1 = view1.isHidden
    let oldHideView2 = view2.isHidden
    view1.layer.removeAllAnimations()
    view2.layer.removeAllAnimations()
    view.layer.removeAllAnimations()
    stackView.layer.removeAllAnimations()
    // after stopping animation the values are unpredictable, so set values to old
    view1.isHidden = oldHideView1 //    <- Solution is here
    view2.isHidden = oldHideView2 //    <- Solution is here

    UIView.animate(withDuration: 0.3,
                   delay: 0.0,
                   usingSpringWithDamping: 0.9,
                   initialSpringVelocity: 1,
                   options: [],
                   animations: {
                    view1.isHidden = hideView1
                    view2.isHidden = hideView2
                    stackView.layoutIfNeeded()
    },
                   completion: nil)
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2019-08-20T11:52:05.047

没有一个回答的解决方案对我有用。我以这种方式解决了我的问题（我不知道这是否正确？），因为我在调用它时遇到了问题（当之前的动画尚未完成时）。**我通过customAnim**块传递我想要的动画。

```
extension UIView
{

    func niceCustomTranstion(
        duration: CGFloat = 0.3,
        options: UIView.AnimationOptions = .transitionCrossDissolve,
        customAnim: @escaping () -> Void
        )
    {
        UIView.transition(
            with: self,
            duration: TimeInterval(duration),
            options: options,
            animations: {
                customAnim()
        },
            completion: { (finished) in
                if !finished
                {
                    // NOTE: This fixes possible flickering ON FAST TAPPINGS
                    // NOTE: This fixes possible flickering ON FAST TAPPINGS
                    // NOTE: This fixes possible flickering ON FAST TAPPINGS
                    self.layer.removeAllAnimations()
                    customAnim()
                }
        })

    }

} 
```**************``***