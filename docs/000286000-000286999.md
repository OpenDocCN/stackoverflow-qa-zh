# StackOverflow 问答 000286000-000286999

# apache - mod_rewrite 的隐藏特性

> ID：286004
> 
> 赞同：119
> 
> 时间：2008-11-13T01:15:19.570
> 
> 标签：apache, .htaccess, mod-rewrite

最近似乎有相当数量的`mod_rewrite`线程在浮动，对于它的某些方面如何工作有些困惑。因此，我编写了一些关于常见功能的注释，也许还有一些恼人的细微差别。

您在使用时遇到过哪些其他功能/常见问题`mod_rewrite`？

* * *

## 回答 #1

> 赞同：203
> 
> 时间：2008-11-13T01:15:42.970

## 在哪里放置 mod_rewrite 规则

`mod_rewrite`规则可以放在`httpd.conf`文件中，也可以放在`.htaccess`文件中。如果您有权访问`httpd.conf`，则在此处放置规则将提供性能优势（因为规则被处理一次，而不是每次`.htaccess`调用文件时）。

## 记录 mod_rewrite 请求

可以从`httpd.conf`文件中启用日志记录（包括`<Virtual Host>`）：

```
# logs can't be enabled from .htaccess
# loglevel > 2 is really spammy!
RewriteLog /path/to/rewrite.log
RewriteLogLevel 2 
```

## 常见用例

1.  要将所有请求集中到一个点：

    ```
    RewriteEngine on
    # ignore existing files
    RewriteCond %{REQUEST_FILENAME} !-f   
    # ignore existing directories
    RewriteCond %{REQUEST_FILENAME} !-d   
    # map requests to index.php and append as a query string
    RewriteRule ^(.*)$ index.php?query=$1 
    ```

    从 Apache 2.2.16 开始，您还可以使用[`FallbackResource`](http://httpd.apache.org/docs/2.2/mod/mod_dir.html#fallbackresource).

2.  处理 301/302 重定向：

    ```
    RewriteEngine on
    # 302 Temporary Redirect (302 is the default, but can be specified for clarity)
    RewriteRule ^oldpage\.html$ /newpage.html [R=302]  
    # 301 Permanent Redirect
    RewriteRule ^oldpage2\.html$ /newpage.html [R=301] 
    ```

    *注意*：外部重定向是隐含的 302 重定向：

    ```
    # this rule:
    RewriteRule ^somepage\.html$ http://google.com
    # is equivalent to:
    RewriteRule ^somepage\.html$ http://google.com [R]
    # and:
    RewriteRule ^somepage\.html$ http://google.com [R=302] 
    ```

3.  强制 SSL

    ```
    RewriteEngine on
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://example.com/$1 [R,L] 
    ```

4.  常用标志：

    *   `[R]`或`[redirect]`- 强制重定向（默认为 302 临时重定向）
    *   `[R=301]`或`[redirect=301]`- 强制执行 301 永久重定向
    *   `[L]`或`[last]`- 停止重写过程（请参阅下面的常见陷阱中的注释）
    *   `[NC]`或`[nocase]`- 指定匹配不区分大小写

    使用长格式的标志通常更具可读性，并且会帮助以后阅读您的代码的其他人。

    您可以用逗号分隔多个标志：

    ```
    RewriteRule ^olddir(.*)$ /newdir$1 [L,NC] 
    ```

## 常见的陷阱

1.  混合`mod_alias`风格重定向`mod_rewrite`

    ```
    # Bad
    Redirect 302 /somepage.html http://example.com/otherpage.html
    RewriteEngine on
    RewriteRule ^(.*)$ index.php?query=$1

    # Good (use mod_rewrite for both)
    RewriteEngine on
    # 302 redirect and stop processing
    RewriteRule ^somepage.html$ /otherpage.html [R=302,L] 
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    # handle other redirects
    RewriteRule ^(.*)$ index.php?query=$1 
    ```

    *注意*：您可以与 混合`mod_alias`使用`mod_rewrite`，但它涉及的工作不仅仅是处理上述基本重定向。

2.  上下文影响语法

    在`.htaccess`文件中，RewriteRule 模式中不使用前导斜杠：

    ```
    # given: GET /directory/file.html

    # .htaccess
    # result: /newdirectory/file.html
    RewriteRule ^directory(.*)$ /newdirectory$1

    # .htaccess
    # result: no match!
    RewriteRule ^/directory(.*)$ /newdirectory$1

    # httpd.conf
    # result: /newdirectory/file.html
    RewriteRule ^/directory(.*)$ /newdirectory$1

    # Putting a "?" after the slash will allow it to work in both contexts:
    RewriteRule ^/?directory(.*)$ /newdirectory$1 
    ```

3.  [L] 不是最后！（有时）

    该标志停止处理*通过规则集的*`[L]`任何进一步重写规则。但是，如果 URL 在该传递中被修改并且您在上下文或部分中，那么您修改的请求将再次通过 URL 解析引擎传递回。并且在下一次通过时，它可能会匹配不同的规则。如果您不理解这一点，通常看起来您的标志无效。*`.htaccess``<Directory>``[L]`*

     *```
    # processing does not stop here
    RewriteRule ^dirA$ /dirB [L] 
    # /dirC will be the final result
    RewriteRule ^dirB$ /dirC 
    ```

    我们的重写日志显示规则运行了两次并且 URL 更新了两次：

    ```
    rewrite 'dirA' -> '/dirB'
    internal redirect with /dirB [INTERNAL REDIRECT]
    rewrite 'dirB' -> '/dirC' 
    ```

    如果您真的想停止所有进一步的规则处理（以及后续传递），最好的解决方法是使用`[END]`标志（[请参阅 Apache 文档](http://httpd.apache.org/docs/current/rewrite/flags.html#flag_end)）而不是标志。`[L]`但是，该`[END]`标志仅适用于**Apache v2.3.9+**，因此如果您拥有 v2.2 或更低版本，则只能使用该`[L]`标志。

    对于早期版本，您必须依靠`RewriteCond`语句来防止在 URL 解析引擎的后续传递中匹配规则。

    ```
    # Only process the following RewriteRule if on the first pass
    RewriteCond %{ENV:REDIRECT_STATUS} ^$
    RewriteRule ... 
    ```

    或者您必须确保您的 RewriteRule 位于`httpd.conf`不会导致您的请求被重新解析的上下文中（即）。* 

 ** * *

## 回答 #2

> 赞同：22
> 
> 时间：2010-04-22T06:05:22.997

如果您需要在 .htaccess 中“阻止”内部重定向/重写，请查看

```
RewriteCond %{ENV:REDIRECT_STATUS} ^$ 
```

条件，如此[处所述](http://sltaylor.co.uk/blog/ignoring-internal-rewrites-in-htaccess/)。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-08-27T03:07:26.327

与 RewriteBase 的交易：

您几乎总是需要设置 RewriteBase。如果你不这样做，apache 会猜测你的 base 是你目录的物理磁盘路径。所以从这个开始：

```
RewriteBase / 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-08-19T10:08:10.930

**其他陷阱：**

1- 有时禁用 MultiViews 是个好主意

```
Options -MultiViews 
```

我对 MultiViews 的所有功能都不太了解，但我知道它在激活时会弄乱我的 mod_rewrite 规则，因为它的一个属性是尝试“猜测”它认为我正在寻找的文件的扩展名.

我将解释：假设您的 web 目录中有 2 个 php 文件，file1.php 和 file2.php，并且您将这些条件和规则添加到您的 .htaccess 中：

```
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ file1.php/$1 
```

您假设所有与文件或目录不匹配的 url 都将被 file1.php 抓取。惊喜！[url http://myhost/file2/somepath](http://myhost/file2/somepath)不遵守此规则。相反，您被带入了 file2.php。

发生的事情是 MultiViews 自动猜测您真正想要的 url 是[http://myhost/file2.php/somepath](http://myhost/file2.php/somepath)并很乐意带您到那里。

现在，您不知道刚刚发生了什么，并且您正在质疑您认为自己知道的关于 mod_rewrite 的一切。然后，您开始使用规则来尝试理解这种新情况背后的逻辑，但是您测试的越多，它的意义就越小。

好的，简而言之，如果您希望 mod_rewrite 以近似逻辑的方式工作，关闭 MultiViews 是朝着正确方向迈出的一步。

2-启用 FollowSymlinks

```
Options +FollowSymLinks 
```

那个，具体细节我也不是很清楚，但是看过很多次，就照着做吧。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-01-19T21:42:26.580

**方程可以用下面的例子来完成：**

```
RewriteCond %{REQUEST_URI} ^/(server0|server1).*$ [NC]
# %1 is the string that was found above
# %1<>%{HTTP_COOKIE} concatenates first macht with mod_rewrite variable -> "test0<>foo=bar;"
#RewriteCond search for a (.*) in the second part -> \1 is a reference to (.*)
# <> is used as an string separator/indicator, can be replaced by any other character
RewriteCond %1<>%{HTTP_COOKIE} !^(.*)<>.*stickysession=\1.*$ [NC]
RewriteRule ^(.*)$ https://notmatch.domain.com/ [R=301,L] 
```

**动态负载平衡：**

如果您使用 mod_proxy 来平衡您的系统，则可以添加一个动态范围的工作服务器。

```
RewriteCond %{HTTP_COOKIE} ^.*stickysession=route\.server([0-9]{1,2}).*$ [NC]
RewriteRule (.*) https://worker%1.internal.com/$1 [P,L] 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2014-11-14T12:25:23.070

为了更好地理解 [L] 标志。[L] 标志**是**最后一个，您只需要了解导致您的请求再次通过 URL 解析引擎路由的原因。从文档（[http://httpd.apache.org/docs/2.2/rewrite/flags.html#flag_l](http://httpd.apache.org/docs/2.2/rewrite/flags.html#flag_l)）（强调我的）：

> [L] 标志导致 mod_rewrite 停止处理规则集。在大多数情况下，这意味着如果规则匹配，则不会处理更多规则。这对应于 Perl 中的最后一条命令，或 C 中的 break 命令。使用此标志指示应立即应用当前规则而不考虑进一步的规则。
> 
> ***`<Directory>`如果您在 .htaccess 文件或section中使用 RewriteRule***，那么了解规则的处理方式很重要。其简化形式是，一旦处理了规则，***重写的请求就会被交回***URL 解析引擎来做它可能做的事情。处理重写的请求时，`<Directory>` 可能会再次遇到 .htaccess 文件或部分，因此可能会从头开始再次运行规则集。最常见的情况是，如果其中一个规则导致重定向（内部或外部）导致请求过程重新开始。

因此，[L] 标志***确实***停止处理通过规则集的任何进一步的重写***规则***。但是，如果您用 [L] 标记的规则修改了请求，并且您在 .htaccess 上下文或该`<Directory>`部分中，那么您修改后的请求将再次通过 URL 解析引擎传回。并且在下一次通过时，它可能会匹配不同的规则。如果您不明白发生了什么，看起来您的第一个带有 [L] 标志的重写规则无效。

最好的解决方法是使用 [END] 标志 ( [http://httpd.apache.org/docs/current/rewrite/flags.html#flag_end](http://httpd.apache.org/docs/current/rewrite/flags.html#flag_end) ) 而不是 [L] 标志，如果你真的想停止规则的所有进一步处理（以及随后的重新分析）。但是，[END] 标志仅适用于 Apache v2.3.9+，因此如果您拥有 v2.2 或更低版本，则只能使用 [L] 标志。在这种情况下，您必须依靠 RewriteCond 语句来防止在 URL 解析引擎的后续传递中匹配规则。或者您必须确保您的 RewriteRule 位于不会导致您的请求被重新解析的上下文中（即 httpd.conf）。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-08-19T10:18:10.787

另一个很棒的功能是 rewrite-map-expansions。如果您有大量的主机/重写要处理，它们特别有用：

它们就像键值替换：

```
RewriteMap examplemap txt:/path/to/file/map.txt 
```

然后，您可以在规则中使用映射，例如：

```
RewriteRule ^/ex/(.*) ${examplemap:$1} 
```

可以在此处找到有关此主题的更多信息：

[http://httpd.apache.org/docs/2.0/mod/mod_rewrite.html#mapfunc](http://httpd.apache.org/docs/2.0/mod/mod_rewrite.html#mapfunc)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2014-02-12T16:22:11.273

mod_rewrite 可以在不改变 URL 的情况下修改请求处理的各个方面，例如设置环境变量、设置 cookie 等。这非常有用。

有条件地设置一个环境变量：

```
RewriteCond %{HTTP_COOKIE} myCookie=(a|b) [NC]
RewriteRule .* - [E=MY_ENV_VAR:%b] 
```

返回 503 响应： `RewriteRule`的`[R]`标志可以采用非 3xx 值并返回非重定向响应，例如托管停机/维护：

```
RewriteRule .* - [R=503,L] 
```

将返回 503 响应（本身不是*重定向）。*

此外，mod_rewrite 可以充当 mod_proxy 的超级接口，因此您可以这样做而不是编写`ProxyPass`指令：

```
RewriteRule ^/(.*)$ balancer://cluster%{REQUEST_URI} [P,QSA,L] 
```

意见：使用`RewriteRule`s 和`RewriteCond`s 将请求路由到不同的应用程序或基于请求的几乎任何可以想象的方面的负载均衡器非常强大。控制到达后端的请求，并能够在返回的途中修改响应，这使得 mod_rewrite 成为集中所有与路由相关的配置的理想场所。

花点时间学习一下，非常值得！:)

# java - 如何在不使用配置程序的情况下调整 Tomcat 5.5 JVM 内存设置

> ID：286007
> 
> 赞同：42
> 
> 时间：2008-11-13T01:17:21.983
> 
> 标签：java, tomcat, memory, jvm

我需要将 Tomcat 内存设置配置为大型安装的一部分，因此事后使用配置应用程序手动配置 Tomcat 是不可能的。我以为我可以将 JVM 内存设置放入 JAVA_OPTS 环境变量中，但我正在使用 jconsole 对其进行测试，以查看它是否有效，但它……没有。

根据下面的评论， CATALINA_OPTS 也不起作用。到目前为止，我可以让它工作的唯一方法是通过 Tomcat 配置 GUI，这不是我的问题可接受的解决方案。

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2008-12-03T17:34:48.410

Serhii 的建议有效，这里有更多细节。

如果您查看安装的 bin 目录，您将看到 catalina.sh 或 .bat 脚本。如果您查看这些，您将看到它们分别运行 setenv.sh 或 setenv.bat 脚本（如果存在）来设置环境变量。catalina.sh/bat 顶部的注释中描述了相关的环境变量。例如，要使用它们，请创建一个包含内容的文件 $CATALINA_HOME/bin/setenv.sh

```
export JAVA_OPTS="-server -Xmx512m" 
```

对于 Windows，您将需要在 setenv.bat 中类似

```
set JAVA_OPTS=-server -Xmx768m 
```

希望这会有所帮助，格伦

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-11-28T09:11:07.880

在 tomcat/bin 目录中创建一个 setenv.(sh|bat) 文件，其中包含您要修改的环境变量。

catalina 脚本检查 setenv 脚本是否存在并运行它来设置环境变量。这样，您可以将参数更改为只有一个 tomcat 实例，并且更容易将其复制到另一个实例。

可能您的配置应用程序已经创建了 setenv 脚本，这就是 tomcat 忽略环境变量的原因。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-13T01:20:05.567

使用`CATALINA_OPTS`环境变量。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-11-21T03:46:36.337

如果您使用 Ubuntu 11.10 和 apache-tomcat6（从 apt-get 安装），您可以将此配置放在**/usr/share/tomcat6/bin/catalina.sh**

```
# -----------------------------------------------------------------------------

JAVA_OPTS="-Djava.awt.headless=true -Dfile.encoding=UTF-8 -server -Xms1024m \
-Xmx1024m -XX:NewSize=512m -XX:MaxNewSize=512m -XX:PermSize=512m \
-XX:MaxPermSize=512m -XX:+DisableExplicitGC" 
```

之后，您可以通过 ps -ef | 检查您的配置。grep tomcat :)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-09-06T15:20:40.777

我使用以下`setenv.bat`内容：

```
==============setenv.bat============

    set JAVA_OPTS=-XX:MaxPermSize=256m -Xms256M -Xmx768M -Xdebug -Xnoagent  -Xrunjdwp:transport=dt_socket,address=7777,server=y,suspend=n %JAVA_OPTS%

==================================== 
```

它还启用调试并将调试端口设置为 7777，并附加`JAVA_OPTS`.

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-10-19T00:43:18.240

方便用于 linux 虚拟机；将 75% 的总系统内存用于 Tomcat。耶 AWK。

放在“{tomcat}/bin/startup.sh”的开头

```
export CATALINA_OPTS="-Xmx`cat /proc/meminfo | grep MemTotal | awk '{ print $2*0.75 } '`k" 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-18T18:00:43.040

只是为了添加到前面的评论，用于更新 Tomcat 服务设置（如果 Tomcat 在 Windows 上作为服务运行）的命令行工具的文档在[这里](http://tomcat.apache.org/tomcat-5.5-doc/windows-service-howto.html)。此工具使用正确的设置更新注册表。因此，如果您想更新 Tomcat 服务的最大内存设置，您可以运行它（从 tomcat/bin 目录），假设默认服务名称为 Tomcat5：

```
tomcat5 //US//Tomcat5 --JvmMx=512 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-11-13T13:32:44.033

我喜欢根据可用服务器内存设置 tomcat6 内存的想法（这很酷，因为我不必在硬件升级后更改设置）。这是我的（有点扩展的内存设置）：

> 出口 CATALINA_OPTS="-Xmx ``cat /proc/meminfo | grep MemTotal | awk '{ print $2*0.75 } '``k -Xms ``cat /proc/meminfo | grep MemTotal | awk '{ print $2*0.75 } '``k -XX:NewSize= ``cat /proc/meminfo | grep MemTotal | awk '{ print $2*0.15 } '``k -XX:MaxNewSize= ``cat /proc/meminfo | grep MemTotal | awk '{ print $2*0.15 } '``k -XX:PermSize= ``cat /proc/meminfo | grep MemTotal | awk '{ print $2*0.15 } '``k -XX:MaxPermSize= ``cat /proc/meminfo | grep MemTotal | awk '{ print $2*0.15 } '``k"

把它放到：“{tomcat}/bin/startup.sh”（例如 Ubuntu 10.10 的“/usr/share/tomcat6/bin”）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-13T06:53:24.427

不确定它是否适合您。但是，真正对我们有用的监控 tomcat 内存设置以及连接数等的唯一方法是[Lambda Probe](http://www.lambdaprobe.org)。

它显示了 Tomcat 调优所需的大部分信息。我们使用 Tomcat 5.5 和 6.0 对其进行了测试，尽管 beta 状态和上次更新日期为 2006 年底，但它运行良好。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-13T07:15:24.163

如果您要手动启动 Tomcat（而不是作为服务），那么 CATALINA_OPTS 环境变量就是要走的路。如果您将其作为服务启动，则设置可能存储在注册表中的某个位置。我在我的机器上安装了 Tomcat 6，我找到了`HKLM\SOFTWARE\Apache Software Foundation\Procrun 2.0\Tomcat6\Parameters\Java`关键的设置。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-06-20T13:47:09.647

如果您在 Windows 上运行 Tomcat，您可以使用 Tomcat 附带的简洁的“Tomcat Monitor”应用程序。

转到 Java 选项卡。在底部的“Java 选项”文本区域下方，您会发现 3 个输入字段：

*   初始内存池***_* __** MB
*   最大内存池***_* __** MB
*   线程堆栈大小***_* ____** KB

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-04-30T22:58:38.037

只需编辑您的 catalina/bin/startup.sh 脚本。在其中添加以下命令：

```
#Adjust it to the size you want. Ignore the from bit.
export CATALINA_OPTS="-Xmx1024m"
#This should point to your catalina base directory 
export CATALINA_BASE=/usr/local/tomcat
#This is only used if you editing the instance of your tomcat
/usr/share/tomcat6/bin/startup.sh 
```

Sailab： http: [//www.facejar.com/member/page-id-477.html](http://www.facejar.com/member/page-id-477.html)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-03-22T18:45:34.337

就我而言，有一个 /etc/sysconfig/tomcat5.conf 文件覆盖了 /etc/tomcat5/tomcat5.conf 中的所有设置

# active-directory - LDAP 和 Active Directory 结果缺少某些结果的字段

> ID：286018
> 
> 赞同：7
> 
> 时间：2008-11-13T01:23:56.883
> 
> 标签：active-directory, ldap

在针对我们的 Active Directory 结构使用 LDAP 查询以查找用户帐户时，一些记录（但不是全部）缺少某些关键字段，特别是 memberOf 和 userAccountControl（它具有指示帐户是否被禁用的位标志）。

以下是一些精炼细节：

*   如果查询设置为过滤这些字段中的任何一个（例如获取营销部门组中未禁用帐户的列表），它们将从结果集中消失（因为就 AD 而言，它们丢失了） .

*   如果使用高权限域管理员帐户执行查询，则查询工作正常。

*   有问题的记录大约占用户记录总数的 1/4 - 1/3。大多数*确实*似乎是较新的记录（我们一度认为这可能与在域控制器服务器上升级到 2003 有关），尽管一些较旧的记录似乎也受到影响。

*   粗略查看两条相似的记录，一条其整个记录可供任何帐户查看，另一条不显示任何明显差异。

所以我最好的猜测是有某种权限拒绝集（可能在模式级别？）这使得某些字段受到限制。我应该注意到域管理员从不故意设置任何此类权限。

**更新/解决方案：** ADSI 编辑（在[Windows 2003 支持工具](http://support.microsoft.com/kb/892777)中）帮助我将其归结为对经过身份验证的用户角色的默认权限的更改。对于某些人来说，该角色包含读取帐户限制（其中包含 userAccountControl）和读取组成员资格 (memberOf)，而对于其他人则没有。

差异的最初原因仍然不清楚，尽管大多数“坏”记录是在域控制器切换到 Windows 2003*之后*创建的，这可能是一个因素。

**解决方案：** 这仍然有点不确定，但很可能是更新的组策略，结合脚本来更新现有帐户。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-19T18:03:25.267

您可以通过 adsi edit 查看特定用户的特定字段的权限。必须以某种方式更改它们，您必须将它们恢复为默认值。也许他们在某些用户的 ou 级别发生了变化。在这种情况下，您可以批量修复它们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-20T17:45:11.917

有趣的是，您建议的两个属性都是只读的。成员（组的属性）在 Active Directory 中维护。User 上的 MemberOf 值是根据查询计算得出的，实际上并没有静态存储在用户对象上。

我很确定 userAccountControl 也是一个只读属性，通过 LDAP。（需要其他方法来直接操作它。）。

不确定这是否有帮助，但可能是正确方向的提示。（否则完全错误..）

# apache-flex - 检测 YouTube 是否被公司/ISP 屏蔽

> ID：286021
> 
> 赞同：15
> 
> 时间：2008-11-13T01:24:28.070
> 
> 标签：apache-flex, youtube

我们在一个网站上有 YouTube 视频，并希望检测他们是否可能由于（很可能）公司政策或其他原因而无法观看这些视频。

我们有两个站点：

1) Flex / Flash 2) HTML

我认为使用 Flex 我可以尝试下载[http://youtube.com/crossdomain.xml](http://youtube.com/crossdomain.xml)，如果它是有效的 XML，则假设该站点可用

但是对于 HTML，我不知道该怎么做。我什至想不出一个“不错的黑客”。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-11-26T16:29:11.340

我喜欢缺乏者的解决方案，但是是的，它创造了一个[竞争条件](http://en.wikipedia.org/wiki/Race_condition "维基百科上的种族条件")。这将起作用并且不会创建比赛条件：

```
var image = new Image();
image.onload = function(){
// The user can access youtube
};
image.onerror = function(){
// The user can't access youtube
};
image.src = "http://youtube.com/favicon.ico"; 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-11-13T02:10:30.050

您可以使用 javascript 从 youtube 加载图像并检查其属性。favicon 很小并且具有一致的 url -

```
var image = new Image();
image.src = "http://youtube.com/favicon.ico";
if (image.height > 0) {
    // The user can access youtube
} else {
    // The user can't access youtube
} 
```

我认为这比加载 javascript 稍微好一点，因为这不会尝试运行任何代码，虽然 youtube 可能会重命名他们的 javascript 文件或这些文件中的函数，但他们不太可能重命名他们的 favicon。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-11-13T02:02:28.710

这应该有效。基本上，它会加载一个 youtube.com javascript 文件，然后检查该文件中的函数是否存在。

```
<html>

<head>
    <script src="http://www.youtube.com/js/account.js"></script>
    <script>
        function has_you_tube()
        {
            if(typeof addVideosToQuicklist == 'function')
            {
                return true;
            }
            else
            {
                return false;
            }

        }
    </script>

</head>
<body>
    <script>alert( "has_youtube: " + has_you_tube() ); </script>
</body>

</html> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-11-11T18:21:49.010

我今天被困在这个问题上并尝试了 favicon 测试，但它在 IE 中不起作用。我正在使用[YouTube Player API Reference for iframe Embeds](https://developers.google.com/youtube/iframe_api_reference#loadVideoById)将 youtube 视频嵌入到我的网站中，所以我所做的是对在 onYouTubeIFrameReady 之前定义的播放器变量进行检查，并延迟 javascript 调用。

```
<script> function YouTubeTester() {            
            if (player == undefined) {
                alert("youtube blocked");
            }
        }
</script>
<script>window.setTimeout("YouTubeTester()", 500);</script> 
```

似乎对我有用。我需要延迟让它在 IE 中工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-08-19T15:29:07.380

这对我有用......这也是我的第一篇文章，希望它也能帮助一些人。

```
<?php

$v = file_get_contents("https://www.youtube.com/iframe_api");

//Tie counts to a variable
$test = substr_count($v, 'loading');

if ($test > 0)

{ ?>
    <iframe>YOUTUBE VIDEO GOES HERE</iframe>

    <?php
}

else

{

echo "<br/> no connection";

}

?> 
```

# jquery - 使用 ASP.NET MVC 和 AJAX 的分页表

> ID：286022
> 
> 赞同：11
> 
> 时间：2008-11-13T01:25:12.047
> 
> 标签：jquery, ajax, asp.net-mvc, pagination

我正在寻找在 ASP.NET MVC 中通过 AJAX 提供的排序、过滤和分页实现结果分页表的良好模式。在我看来，我应该让我的控制器操作只提供数据而不是标记以保持关注点的分离——因此 Ajax 回调将提供新的表数据和分页器设置，客户端将使用这些数据和寻呼机重新呈现表. 或者，我可以使用让控制器返回一个部分视图，我只需在页面上的容器内替换它。

我是 ASP.NET MVC 世界的新手，所以我也有兴趣听取意见和其他替代方案。

你会怎么做呢？

我也有兴趣了解与 Ajax 配合良好的 jquery 表插件。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-15T08:17:39.163

以下是一些结帐选项：

*   [jQuery 弹性网格](http://www.codeproject.com/KB/aspnet/MVCFlexigrid.aspx)
*   [雅虎数据表](http://developer.yahoo.com/yui/datatable/)
*   [分机JS](http://extjs.com/deploy/dev/examples/grid/array-grid.html)

我倾向于雅虎的解决方案 atm，因为它提供的不仅仅是网格控件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T01:49:03.947

[JQuery Grid](http://www.trirand.com/blog/)似乎可以满足您的要求。它有很好的文档和示例。我还没有使用它，但我计划很快使用它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-10-01T02:18:56.170

不要使用tablesorter。当您从表中删除一些记录时，很难通过分页和排序重新呈现表。我很难受。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-23T07:00:32.590

我真的很喜欢[tablesorter](http://tablesorter.com/docs/)

它更轻巧，更易于管理...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-01-18T15:30:37.167

我喜欢为 MVC 使用 Telerik 扩展，它们是开源的并且有很多示例： [http ://www.telerik.com/products/aspnet-mvc/grid.aspx](http://www.telerik.com/products/aspnet-mvc/grid.aspx)

# visual-studio-2008 - 使用 VS 2008 在 WCF 中共享类型不起作用

> ID：286031
> 
> 赞同：0
> 
> 时间：2008-11-13T01:32:19.380
> 
> 标签：visual-studio-2008, wcf, svcutil.exe

我正在尝试在客户端和 WCF 服务之间共享来自我的数据层程序集的 DTO。这在使用 svcutil 时有效，但在使用 VS2008 时不起作用。VS2008 生成它自己的 DTO 对象，而 svcutil 使用共享数据类型。

我使用的 svcutil 参数是：

```
"C:\Program Files\Microsoft SDKs\Windows\v6.0A\bin\SvcUtil" 
          /serializer:DataContractSerializer
          /language:vb 
          /out:ServiceClient.cs
          /namespace:*,CommonWCF 
          /noconfig
          /reference:"D:\trunk\DataLayer\bin\Debug\DataLayer.dll"
          /collectionType:System.Collections.Generic.List`1
          http://localhost:3371/Common.svc 
```

我读到 VS2008 只是在幕后调用 svcutil，那么为什么它不起作用呢？我真的想避免在构建过程中添加手动过程。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-29T15:52:45.743

只需使用`ClientFactory<T>`.

您实际上不需要 svcutil 或服务参考。他们生成的代码只是 ClientFactory 的一个臃肿的包装器，几乎没有添加任何功能。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T05:21:15.947

如果您避免使用服务引用，而只包含对 svcutil 生成的代码的引用，那么这应该可以避免这个问题。我们的 DTO 在共享程序集中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-15T10:04:49.603

我创建了一个调用 svcutil 的批处理文件并将其添加为预构建任务，以避免这是手动操作。这解决了我的问题，但我仍然不确定为什么 svcutil 和 vs2008 gui 方法之间存在不同的行为。

# mysql - 获取 MySQL 数据库中所有表的记录数

> ID：286039
> 
> 赞同：394
> 
> 时间：2008-11-13T01:41:32.417
> 
> 标签：mysql, sql, rowcount

有没有一种方法可以获取 MySQL 数据库中所有表中的行数，而无需`SELECT count()`在每个表上运行 a？

* * *

## 回答 #1

> 赞同：468
> 
> 时间：2008-11-13T01:53:55.920

```
SELECT SUM(TABLE_ROWS) 
     FROM INFORMATION_SCHEMA.TABLES 
     WHERE TABLE_SCHEMA = '{your_db}'; 
```

[不过来自文档的注意事项：](https://dev.mysql.com/doc/refman/5.7/en/tables-table.html)对于 InnoDB 表，**行数只是**SQL 优化中使用的粗略估计。您需要使用 COUNT(*) 进行精确计数（这更昂贵）。

* * *

## 回答 #2

> 赞同：205
> 
> 时间：2008-11-13T01:50:37.017

您可能可以将某些东西与[Tables table](http://dev.mysql.com/doc/refman/5.0/en/tables-table.html)放在一起。我从来没有做过，但它看起来有一个*TABLE_ROWS*列和一个*TABLE NAME*列。

要获取每个表的行数，可以使用如下查询：

```
SELECT table_name, table_rows
FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_SCHEMA = '**YOUR SCHEMA**'; 
```

* * *

## 回答 #3

> 赞同：143
> 
> 时间：2011-12-31T20:05:19.190

像@Venkatramanan 和其他人一样，我发现 INFORMATION_SCHEMA.TABLES 不可靠（使用 InnoDB、MySQL 5.1.44），即使在静默表上运行它时也会给出不同的行数。这是一种生成大 SQL 语句的相对 hacky（但灵活/适应性强）的方法，您可以将其粘贴到新查询中，而无需安装 Ruby gems 和其他东西。

```
SELECT CONCAT(
    'SELECT "', 
    table_name, 
    '" AS table_name, COUNT(*) AS exact_row_count FROM `', 
    table_schema,
    '`.`',
    table_name, 
    '` UNION '
) 
FROM INFORMATION_SCHEMA.TABLES 
WHERE table_schema = '**my_schema**'; 
```

它产生如下输出：

```
SELECT "func" AS table_name, COUNT(*) AS exact_row_count FROM my_schema.func UNION                         
SELECT "general_log" AS table_name, COUNT(*) AS exact_row_count FROM my_schema.general_log UNION           
SELECT "help_category" AS table_name, COUNT(*) AS exact_row_count FROM my_schema.help_category UNION       
SELECT "help_keyword" AS table_name, COUNT(*) AS exact_row_count FROM my_schema.help_keyword UNION         
SELECT "help_relation" AS table_name, COUNT(*) AS exact_row_count FROM my_schema.help_relation UNION       
SELECT "help_topic" AS table_name, COUNT(*) AS exact_row_count FROM my_schema.help_topic UNION             
SELECT "host" AS table_name, COUNT(*) AS exact_row_count FROM my_schema.host UNION                         
SELECT "ndb_binlog_index" AS table_name, COUNT(*) AS exact_row_count FROM my_schema.ndb_binlog_index UNION 
```

复制并粘贴除了最后一个 UNION 以获得不错的输出，例如，

```
+------------------+-----------------+
| table_name       | exact_row_count |
+------------------+-----------------+
| func             |               0 |
| general_log      |               0 |
| help_category    |              37 |
| help_keyword     |             450 |
| help_relation    |             990 |
| help_topic       |             504 |
| host             |               0 |
| ndb_binlog_index |               0 |
+------------------+-----------------+
8 rows in set (0.01 sec) 
```

* * *

## 回答 #4

> 赞同：53
> 
> 时间：2013-07-23T20:28:15.237

我只是运行：

```
show table status; 
```

这将为您提供每个表的行数以及一堆其他信息。我曾经使用上面选择的答案，但这更容易。

我不确定这是否适用于所有版本，但我使用的是 5.5 和 InnoDB 引擎。

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2019-06-21T20:24:10.023

简单的方法：

```
SELECT
  TABLE_NAME, SUM(TABLE_ROWS)
FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_SCHEMA = '{Your_DB}'
GROUP BY TABLE_NAME; 
```

结果示例：

```
+----------------+-----------------+
| TABLE_NAME     | SUM(TABLE_ROWS) |
+----------------+-----------------+
| calls          |            7533 |
| courses        |             179 |
| course_modules |             298 |
| departments    |              58 |
| faculties      |             236 |
| modules        |             169 |
| searches       |           25423 |
| sections       |             532 |
| universities   |              57 |
| users          |           10293 |
+----------------+-----------------+ 
```

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2012-08-02T13:36:42.037

```
 SELECT TABLE_NAME,SUM(TABLE_ROWS) 
 FROM INFORMATION_SCHEMA.TABLES 
 WHERE TABLE_SCHEMA = 'your_db' 
 GROUP BY TABLE_NAME; 
```

这就是你所需要的。

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2011-03-29T18:34:02.487

此存储过程列出表、统计记录并在最后生成记录总数。

添加此过程后运行它：

```
CALL `COUNT_ALL_RECORDS_BY_TABLE` (); 
```

-

步骤：

```
DELIMITER $$

CREATE DEFINER=`root`@`127.0.0.1` PROCEDURE `COUNT_ALL_RECORDS_BY_TABLE`()
BEGIN
DECLARE done INT DEFAULT 0;
DECLARE TNAME CHAR(255);

DECLARE table_names CURSOR for 
    SELECT table_name FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = DATABASE();

DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;

OPEN table_names;   

DROP TABLE IF EXISTS TCOUNTS;
CREATE TEMPORARY TABLE TCOUNTS 
  (
    TABLE_NAME CHAR(255),
    RECORD_COUNT INT
  ) ENGINE = MEMORY; 

WHILE done = 0 DO

  FETCH NEXT FROM table_names INTO TNAME;

   IF done = 0 THEN
    SET @SQL_TXT = CONCAT("INSERT INTO TCOUNTS(SELECT '" , TNAME  , "' AS TABLE_NAME, COUNT(*) AS RECORD_COUNT FROM ", TNAME, ")");

    PREPARE stmt_name FROM @SQL_TXT;
    EXECUTE stmt_name;
    DEALLOCATE PREPARE stmt_name;  
  END IF;

END WHILE;

CLOSE table_names;

SELECT * FROM TCOUNTS;

SELECT SUM(RECORD_COUNT) AS TOTAL_DATABASE_RECORD_CT FROM TCOUNTS;

END 
```

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2016-11-25T13:03:24.670

这个估计问题有一些技巧/解决方法。

Auto_Increment - 如果您在表上设置了自动增量，由于某种原因，这将为您的数据库返回更准确的行数。

在探索为什么显示表信息与实际数据不匹配时发现了这一点。

```
SELECT
table_schema 'Database',
SUM(data_length + index_length) AS 'DBSize',
SUM(TABLE_ROWS) AS DBRows,
SUM(AUTO_INCREMENT) AS DBAutoIncCount
FROM information_schema.tables
GROUP BY table_schema;

+--------------------+-----------+---------+----------------+
| Database           | DBSize    | DBRows  | DBAutoIncCount |
+--------------------+-----------+---------+----------------+
| Core               |  35241984 |   76057 |           8341 |
| information_schema |    163840 |    NULL |           NULL |
| jspServ            |     49152 |      11 |            856 |
| mysql              |   7069265 |   30023 |              1 |
| net_snmp           |  47415296 |   95123 |            324 |
| performance_schema |         0 | 1395326 |           NULL |
| sys                |     16384 |       6 |           NULL |
| WebCal             |    655360 |    2809 |           NULL |
| WxObs              | 494256128 |  530533 |        3066752 |
+--------------------+-----------+---------+----------------+
9 rows in set (0.40 sec) 
```

然后，您可以轻松地使用 PHP 或其他方法返回 2 个数据列的最大值，以给出行数的“最佳估计”。

IE

```
SELECT
table_schema 'Database',
SUM(data_length + index_length) AS 'DBSize',
GREATEST(SUM(TABLE_ROWS), SUM(AUTO_INCREMENT)) AS DBRows
FROM information_schema.tables
GROUP BY table_schema; 
```

自动增量将始终关闭 +1 *（表计数）行，但即使有 4,000 个表和 300 万行，也有 99.9% 的准确率。比估计的行好得多。

这样做的美妙之处在于，performance_schema 中返回的行数也会为您删除，因为最大不适用于空值。但是，如果您没有具有自动增量功能的表，这可能是一个问题。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2016-11-07T09:32:40.843

另一种选择：对于非 InnoDB，它使用来自 information_schema.TABLES 的数据（因为它更快），对于 InnoDB - 选择 count(*) 以获得准确的计数。它也忽略视图。

```
SET @table_schema = DATABASE();
-- or SET @table_schema = 'my_db_name';

SET GROUP_CONCAT_MAX_LEN=131072;
SET @selects = NULL;

SELECT GROUP_CONCAT(
        'SELECT "', table_name,'" as TABLE_NAME, COUNT(*) as TABLE_ROWS FROM `', table_name, '`'
        SEPARATOR '\nUNION\n') INTO @selects
  FROM information_schema.TABLES
  WHERE TABLE_SCHEMA = @table_schema
        AND ENGINE = 'InnoDB'
        AND TABLE_TYPE = "BASE TABLE";

SELECT CONCAT_WS('\nUNION\n',
  CONCAT('SELECT TABLE_NAME, TABLE_ROWS FROM information_schema.TABLES WHERE TABLE_SCHEMA = ? AND ENGINE <> "InnoDB" AND TABLE_TYPE = "BASE TABLE"'),
  @selects) INTO @selects;

PREPARE stmt FROM @selects;
EXECUTE stmt USING @table_schema;
DEALLOCATE PREPARE stmt; 
```

如果您的数据库有很多大型 InnoDB 表，计算所有行可能需要更多时间。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2014-02-15T06:26:44.957

你可以试试这个。它对我来说很好。

```
SELECT IFNULL(table_schema,'Total') "Database",TableCount 
FROM (SELECT COUNT(1) TableCount,table_schema 
      FROM information_schema.tables 
      WHERE table_schema NOT IN ('information_schema','mysql') 
      GROUP BY table_schema WITH ROLLUP) A; 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-11-10T11:29:41.743

如果您使用数据库 information_schema，则可以使用此 mysql 代码（where 部分使查询不显示行具有空值的表）：

```
SELECT TABLE_NAME, TABLE_ROWS
FROM `TABLES`
WHERE `TABLE_ROWS` >=0 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-08-03T20:49:56.487

以下查询生成一个（另一个）查询，它将从 information_schema.tables 中列出的每个模式中获取每个表的 count(*) 值。此处显示的查询的整个结果 - 所有行加在一起 ​​- 包含一个以分号结尾的有效 SQL 语句 - 没有悬空的“联合”。通过在下面的查询中使用联合来避免悬空联合。

```
select concat('select "', table_schema, '.', table_name, '" as `schema.table`,
                          count(*)
                 from ', table_schema, '.', table_name, ' union ') as 'Query Row'
  from information_schema.tables
 union
 select '(select null, null limit 0);'; 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-03-18T15:14:12.767

这是我为获得实际计数所做的（不使用架构）

它更慢但更准确。

这是一个两步过程

1.  获取您的数据库的表列表。你可以使用它

    ```
    mysql -uroot -p mydb -e "show tables" 
    ```

2.  在此 bash 脚本中创建表列表并将其分配给数组变量（由单个空格分隔，就像在下面的代码中一样）

    ```
    array=( table1 table2 table3 )

    for i in "${array[@]}"
    do
        echo $i
        mysql -uroot mydb -e "select count(*) from $i"
    done 
    ```

3.  运行：

    ```
    chmod +x script.sh; ./script.sh 
    ```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-04-04T10:24:59.780

这就是我使用 PHP 计算 TABLES 和 ALL RECORDS 的方式：

```
$dtb = mysql_query("SHOW TABLES") or die (mysql_error());
$jmltbl = 0;
$jml_record = 0;
$jml_record = 0;

while ($row = mysql_fetch_array($dtb)) { 
    $sql1 = mysql_query("SELECT * FROM " . $row[0]);            
    $jml_record = mysql_num_rows($sql1);            
    echo "Table: " . $row[0] . ": " . $jml_record record . "<br>";      
    $jmltbl++;
    $jml_record += $jml_record;
}

echo "--------------------------------<br>$jmltbl Tables, $jml_record > records."; 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-08-19T00:21:45.050

海报想要不计算行数，但没有指定哪个表引擎。对于 InnoDB，我只知道一种方法，那就是计数。

这就是我挑选土豆的方式：

```
# Put this function in your bash and call with:
# rowpicker DBUSER DBPASS DBNAME [TABLEPATTERN]
function rowpicker() {
    UN=$1
    PW=$2
    DB=$3
    if [ ! -z "$4" ]; then
        PAT="LIKE '$4'"
        tot=-2
    else
        PAT=""
        tot=-1
    fi
    for t in `mysql -u "$UN" -p"$PW" "$DB" -e "SHOW TABLES $PAT"`;do
        if [ $tot -lt 0 ]; then
            echo "Skipping $t";
            let "tot += 1";
        else
            c=`mysql -u "$UN" -p"$PW" "$DB" -e "SELECT count(*) FROM $t"`;
            c=`echo $c | cut -d " " -f 2`;
            echo "$t: $c";
            let "tot += c";
        fi;
    done;
    echo "total rows: $tot"
} 
```

我没有对此做出任何断言，除了这是一种非常丑陋但有效的方法来获取数据库中每个表中存在多少行，而不管表引擎如何，并且无需获得安装存储过程的权限，也无需安装红宝石或PHP。是的，它生锈了。是的，它很重要。count(*) 是准确的。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2019-07-18T18:27:41.003

基于上面@Nathan 的回答，但不需要“删除最终联合”并且可以选择对输出进行排序，我使用以下 SQL。它生成另一个 SQL 语句，然后运行：

```
select CONCAT( 'select * from (\n', group_concat( single_select SEPARATOR ' UNION\n'), '\n ) Q order by Q.exact_row_count desc') as sql_query
from (
    SELECT CONCAT(
        'SELECT "', 
        table_name, 
        '" AS table_name, COUNT(1) AS exact_row_count
        FROM `', 
        table_schema,
        '`.`',
        table_name, 
        '`'
    ) as single_select
    FROM INFORMATION_SCHEMA.TABLES 
    WHERE table_schema = 'YOUR_SCHEMA_NAME'
      and table_type = 'BASE TABLE'
) Q 
```

您确实需要足够大的`group_concat_max_len`服务器变量值，但从 MariaDb 10.2.4 开始，它应该默认为 1M。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2011-11-17T07:46:43.307

如果您想要确切的数字，请使用以下 ruby​​ 脚本。你需要 Ruby 和 RubyGems。

安装以下宝石：

```
$> gem install dbi
$> gem install dbd-mysql 
```

文件：count_table_records.rb

```
require 'rubygems'
require 'dbi'

db_handler = DBI.connect('DBI:Mysql:database_name:localhost', 'username', 'password')

# Collect all Tables
sql_1 = db_handler.prepare('SHOW tables;')
sql_1.execute
tables = sql_1.map { |row| row[0]}
sql_1.finish

tables.each do |table_name|
  sql_2 = db_handler.prepare("SELECT count(*) FROM #{table_name};")
  sql_2.execute
  sql_2.each do |row|
    puts "Table #{table_name} has #{row[0]} rows."
  end
  sql_2.finish
end

db_handler.disconnect 
```

回到命令行：

```
$> ruby count_table_records.rb 
```

输出：

```
Table users has 7328974 rows. 
```

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2020-04-26T05:10:15.867

下面的代码为所有故事生成选择查询。只需删除最后一个“UNION ALL”选择所有结果并粘贴一个新的查询窗口即可运行。

```
SELECT 
concat('select ''', table_name ,''' as TableName, COUNT(*) as RowCount from ' , table_name , ' UNION ALL ')  as TR FROM
information_schema.tables where 
table_schema = 'Database Name' 
```

* * *

## 回答 #19

> 赞同：-4
> 
> 时间：2015-03-31T14:55:09.657

如果您知道表的数量及其名称，并假设它们都有主键，则可以结合使用交叉连接`COUNT(distinct [column])`来获取来自每个表的行：

```
SELECT 
   COUNT(distinct t1.id) + 
   COUNT(distinct t2.id) + 
   COUNT(distinct t3.id) AS totalRows
FROM firstTable t1, secondTable t2, thirdTable t3; 
```

这是一个[SQL Fiddle](http://sqlfiddle.com/#!9/772b4/1)示例。

# c# - 在 .NET 中读取 Excel，如何获取特定行？

> ID：286044
> 
> 赞同：2
> 
> 时间：2008-11-13T01:48:28.613
> 
> 标签：c#, .net, oledb, ado

我从[这里](http://davidhayden.com/blog/dave/archive/2006/05/26/2973.aspx)获得了以下代码来使用 C# .NET 读取 Excel 文件：

```
string connectionString = @"Provider=Microsoft.Jet.OLEDB.4.0;Data Source=Book1.xls;Extended Properties=""Excel 8.0;HDR=YES;""";
DbProviderFactory factory = DbProviderFactories.GetFactory("System.Data.OleDb");
DbCommand command = connection.CreateCommand()
command.CommandText = "SELECT City,State FROM [Cities$]"; 
```

我想从第 4 行开始只选择 10 行，我该怎么做？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T03:11:23.780

我不是 Excel 查询专家，但这确实有效。使用 TOP 将查询限制为 13 行。第一行是带有列名的标题，因此它可能不算数。如果我误解了，显然会改变。然后，跟踪行 ID 并对 4 上或之后的行进行处理。

希望这可以帮助！

```
string connectionString = @"Provider=Microsoft.Jet.OLEDB.4.0;Data Source=Book1.xls;Extended Properties=""Excel 8.0;HDR=YES;""";
using (System.Data.OleDb.OleDbConnection conn = new System.Data.OleDb.OleDbConnection(connectionString)) {
    System.Data.OleDb.OleDbCommand cmd = new System.Data.OleDb.OleDbCommand();
    cmd.Connection = conn;
    cmd.CommandText = "SELECT top 13 City,State FROM [Cities$]";

    conn.Open();
    System.Data.IDataReader dr = cmd.ExecuteReader();

    int row = 2;
    while (dr.Read()) {
        if (row++ >= 4) {
            // do stuff
            Console.WriteLine("{0}, {1}", dr[0], dr[1]);
        }
    }
} 
```

# java - 为哈希选择合适的表大小

> ID：286058
> 
> 赞同：9
> 
> 时间：2008-11-13T02:05:33.477
> 
> 标签：java, hash, hashtable

如果我有一个 1000 的键集，我的哈希表的合适大小是多少，这是如何确定的？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-13T02:25:00.163

它取决于负载因子（表将增加其大小并重新分配其元素的“百分比满”点）。如果您知道您恰好有 1000 个条目，并且该数字永远不会改变，您可以将负载因子设置为 1.0，并将初始大小设置为 1000 以获得最大效率。如果您不确定确切的大小，您可以将负载因子保留为默认值 0.75，并将初始大小设置为 1334（预期大小/LF），以获得*真正*的良好性能，但代价是额外的内存。

您可以使用以下构造函数来设置负载因子：

```
Hashtable(int initialCapacity, float loadFactor) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-13T02:19:16.787

您还需要考虑哈希函数。

一条经验法则建议将表格大小增加一倍，以便有扩展空间，并希望将碰撞次数保持在较小的水平。

另一个经验法则是假设您正在执行某种与模数相关的散列，然后将表大小四舍五入到下一个最大的素数，并将该素数用作模值。

你在散列什么样的东西？更多细节应该会产生更好的建议。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T02:08:08.107

在文档中有一些关于这些因素的讨论[`Hashtable`](http://java.sun.com/j2se/1.5.0/docs/api/java/util/Hashtable.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T04:03:50.197

让它成长。有了这个尺寸，自动处理就很好了。除此之外，2 x size + 1 是一个简单的公式。素数也不错，但是一旦您的数据集达到一定大小，散列实现可能会决定重新散列并扩大表。

您的密钥正在提高效率，并且希望足够独特。

底线：当您遇到尺寸或性能缓慢等问题时，请询问尺寸问题，除此之外：别担心！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T02:35:19.940

两次是好的。

你没有一个大的键集。不要为关于 HashTable 实现的艰难讨论而烦恼，去 2000 年吧。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-13T04:33:58.670

我想重申一下[https://stackoverflow.com/users/33229/wwwflickrcomphotosrene-germany](https://stackoverflow.com/users/33229/wwwflickrcomphotosrene-germany)上面所说的内容。1000 对我来说似乎不是一个很大的哈希值。我一直在 java 中使用很多这种大小的哈希表，但没有看到太多的性能问题。而且我几乎从不关心尺寸或负载系数。

If you've run a profiler on your code and determined that the hashtable is your problem, then by all means start tweaking. Otherwise, I wouldn't assume you've got a problem until you're sure.

After all, in most code, the performance problem isn't where you think it is. I try not to anticipate.

# asp.net - 我需要更改什么以允许我的 IIS7 ASP.Net 3.5 应用程序创建事件源并将事件记录到 Windows EventLog？

> ID：286060
> 
> 赞同：34
> 
> 时间：2008-11-13T02:06:01.743
> 
> 标签：asp.net, .net-3.5, iis-7, permissions, event-log

在 IIS 7 下运行的 ASP.Net 3.5 似乎不允许开箱即用。

```
 if (!EventLog.SourceExists("MyAppLog"))
            EventLog.CreateEventSource("MyAppLog", "Application");

        EventLog myLog = new EventLog();
        myLog.Source = "MyAppLog";
        myLog.WriteEntry("Message"); 
```

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2011-10-21T10:53:52.813

我从[这里](https://stackoverflow.com/questions/2587453/log4net-eventlogappender-does-not-work-for-asp-net-2-0-website)复制了这个答案（问题是 Log4Net，但答案仍然适用）。technet 链接错过了一个重要步骤。

### 创建注册表项

`HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\eventlog\Application\MY-AWESOME-APP`

### 在此内部创建一个字符串值

命名它`EventMessageFile`，将其值设置为

> C:\Windows\Microsoft.NET\Framework\v2.0.50727\EventLogMessages.dll

该路径似乎适用于 64 位和 32 位环境。

使用这种技术，您无需在注册表中设置权限，一旦创建了上面的密钥，它就应该可以工作了。

**或者**
，如果您没有大型服务器场，而只有一个小型“网络花园”，您可以在每台服务器上运行控制台应用程序，使用 创建事件日志源[`EventLog.CreateEventSource`](http://msdn.microsoft.com/en-us/library/5zbwd3s3.aspx)，确保控制台应用程序由管理员运行。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-11-13T02:26:56.867

这是自 Windows 2003 以来 Windows 安全性的一部分。

您需要在 HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Eventlog\Application 下的注册表中创建一个条目，确保网络服务或您模拟的帐户有权访问此注册表项。

@CheGueVerra 的链接：[不允许请求的注册表访问](http://support.microsoft.com/?id=329291)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2016-01-21T07:52:12.467

右键单击应用程序并选择“以管理员身份运行”

# python - 浮点数和小数点的小数位问题。十进制

> ID：286061
> 
> 赞同：3
> 
> 时间：2008-11-13T02:06:30.667
> 
> 标签：python, floating-point, decimal, floating-accuracy

我似乎在使用浮点数时失去了很多精度。

例如我需要求解一个矩阵：

```
4.0x -2.0y 1.0z =11.0
1.0x +5.0y -3.0z =-6.0
2.0x +2.0y +5.0z =7.0 
```

这是我用来从文本文件中导入矩阵的代码：

```
f = open('gauss.dat')
lines =  f.readlines()
f.close()

j=0
for line in lines:
    bits = string.split(line, ',')
    s=[]
    for i in range(len(bits)):
        if (i!= len(bits)-1):
            s.append(float(bits[i]))
            #print s[i]
    b.append(s)
    y.append(float(bits[len(bits)-1])) 
```

我需要使用 gauss-seidel 求解，所以我需要重新排列 x、y 和 z 的方程：

```
x=(11+2y-1z)/4
y=(-6-x+3z)/5
z=(7-2x-2y)/7 
```

这是我用来重新排列方程式的代码。`b`是一个系数矩阵，`y`是答案向量：

```
def equations(b,y):
    i=0
    eqn=[]
    row=[]
    while(i<len(b)):
        j=0
        row=[]
        while(j<len(b)):
            if(i==j):
                row.append(y[i]/b[i][i])
            else:
                row.append(-b[i][j]/b[i][i])
            j=j+1
        eqn.append(row)
        i=i+1
    return eqn 
```

然而，我得到的答案并不精确到小数位。

例如，从上面重新排列第二个等式后，我应该得到：

```
y=-1.2-.2x+.6z 
```

我得到的是：

```
y=-1.2-0.20000000000000001x+0.59999999999999998z 
```

这似乎不是一个大问题，但是当您将数字提高到非常高的幂时，误差会很大。有没有解决的办法？我尝试了这`Decimal`门课，但它不适用于权力（即，`Decimal(x)**2`）。

有任何想法吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-13T02:11:58.567

IEEE 浮点数是二进制的，而不是十进制的。没有固定长度的二进制小数正好是 0.1 或其任何倍数。它是一个重复的分数，就像十进制的 1/3。

请阅读[每位计算机科学家应了解的浮点运算知识](http://docs.sun.com/source/806-3568/ncg_goldberg.html)

除 Decimal 类之外的其他选项是

*   使用 Common Lisp 或[Python 2.6](http://docs.python.org/whatsnew/2.6.html#the-fractions-module)或其他具有精确理性的语言

*   使用例如[frap将双打转换为关闭有理数](http://www.ics.uci.edu/~eppstein/numth/frap.c)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-13T02:09:08.667

我不太熟悉 Decimal 类来帮助你，但你的问题是由于十进制分数通常不能准确地用二进制表示，所以你看到的是最接近的近似值；如果不使用特殊类（可能是 Decimal），就无法避免这个问题。

`EDIT:`十进制类不适合您怎么办？只要我从一个字符串而不是一个浮点数开始，权力似乎就可以正常工作。

```
>>> import decimal
>>> print(decimal.Decimal("1.2") ** 2)
1.44 
```

[模块文档](http://docs.python.org/library/decimal.html)非常清楚地解释了对的需求和用法，`decimal.Decimal`如果你还没有，你应该检查一下。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-13T02:49:01.113

首先，您的输入可以简化很多。您不需要读取和解析文件。你可以只用 Python 表示法声明你的对象。评估文件。

```
b = [
    [4.0, -2.0,  1.0],
    [1.0, +5.0, -3.0],
    [2.0, +2.0, +5.0],
]
y = [ 11.0, -6.0, 7.0 ] 
```

其次，y=-1.2-0.20000000000000001x+0.59999999999999998z 并不罕见。0.2 或 0.6 没有二进制表示法的精确表示。因此，显示的值是原始不精确表示的十进制近似值。几乎所有类型的浮点处理器都是如此。

您可以尝试 Python 2.6[分数](http://docs.python.org/library/fractions.html)模块。有一个较旧的[理性](http://infohost.nmt.edu/tcc/help/lang/python/examples/rational/)包可能会有所帮助。

是的，将浮点数提高到幂会增加错误。因此，您必须确保避免使用浮点数的最右边位置，因为这些位主要是噪声。

显示浮点数时，您必须对它们进行适当的舍入以避免看到噪声位。

```
>>> a
0.20000000000000001
>>> "%.4f" % (a,)
'0.2000' 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-11-13T14:30:33.843

对于这样的任务，我会注意十进制模块。它的目的实际上是更多地处理现实世界的十进制数（例如，匹配人类簿记实践），具有有限的精度，而不是执行精确的精度数学。有些数字不能像二进制那样精确地用十进制表示，而且用十进制执行算术也比其他方法慢得多。

相反，如果你想要精确的结果，你应该使用有理算术。这些将数字表示为分子/分母对，因此可以准确地表示所有有理数。如果您只使用乘法和除法（而不是可能导致无理数的平方根之类的运算），您将永远不会失去精度。

正如其他人所提到的，python 2.6 将有一个内置的有理类型，但请注意，这并不是一个真正的高性能实现——为了速度，你最好使用像[gmpy](http://gmpy.sourceforge.net/)这样的库。只需将您对 float() 的调用替换为 gmpy.mpq()，您的代码现在应该会给出准确的结果（尽管您可能希望将结果格式化为浮点数以进行显示）。

这是您代码的稍微整理的版本，用于加载将使用 gmpy 有理数的矩阵：

```
def read_matrix(f):
    b,y = [], []
    for line in f:
        bits = line.split(",")
        b.append( map(gmpy.mpq, bits[:-1]) )
        y.append(gmpy.mpq(bits[-1]))
    return b,y 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-25T12:28:41.757

这不是您问题的答案，而是相关的：

```
#!/usr/bin/env python
from numpy import abs, dot, loadtxt, max
from numpy.linalg import solve

data = loadtxt('gauss.dat', delimiter=',')
a, b = data[:,:-1], data[:,-1:]
x = solve(a, b) # here you may use any method you like instead of `solve`
print(x)
print(max(abs((dot(a, x) - b) / b))) # check solution 
```

例子：

```
$ cat gauss.dat
4.0, 2.0, 1.0, 11.0
1.0, 5.0, 3.0, 6.0 
2.0, 2.0, 5.0, 7.0

$ python loadtxt_example.py
[[ 2.4]
 [ 0.6]
 [ 0.2]]
0.0 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-13T02:49:57.320

另请参阅[What is a simple example of floating point error](https://stackoverflow.com/questions/249467/what-is-a-simple-example-of-floating-pointrounding-error)，在 SO 上，其中有一些答案。我给出的那个实际上使用python作为示例语言......

# google-maps - 增加谷歌地图的最大缩放级别

> ID：286062
> 
> 赞同：0
> 
> 时间：2008-11-13T02:07:41.210
> 
> 标签：google-maps

我将如何创建一个允许用户缩放到地图默认缩放级别之外的 Google 地图？我是否必须创建一个具有更大最大缩放的新地图类型？是否有任何教程显示如何做到这一点？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-13T07:05:28.630

查看[Google Maps API](http://code.google.com/apis/maps/)的文档。您可以做的一件事是在地图上放置更详细的信息（“叠加层”）。请注意，您将无法获得比现有图像更好的图像，但例如，Google Campus 本身具有相当高的分辨率图像。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T22:58:51.477

您想要使用的是[GtileLayerOverlay](http://code.google.com/apis/maps/documentation/reference.html#GTileLayerOverlay "GtileLayer叠加")。它允许您向地图添加自定义图块，前提是您拥有更高分辨率版本的图块。这是您的目标还是您正在寻找一种从谷歌取回更高分辨率瓷砖的方法？[（在这种情况下你运气不好，除了这里](http://blogoscoped.com/archive/2007-03-07-n12.html)列出的情况）

# mysql - 如何保持 2 个临时数据库同步

> ID：286076
> 
> 赞同：1
> 
> 时间：2008-11-13T02:21:28.563
> 
> 标签：mysql, synchronization, federated-table

我的问题很像[这个](https://stackoverflow.com/questions/80721/)。但是我在 MySQL 上，我正在寻找我能找到的“最低技术”解决方案。

情况是我有 2 个数据库，其中应该包含相同的数据，但主要是在它们无法相互联系时进行更新。我怀疑有某种集群或主/从事物能够很好地同步它们。然而，在我的情况下，这是主要的矫枉过正，因为这只是我自己使用的临时数据库。

有什么好方法可以做到这一点？

我目前的方法是在其中一个上建立一个联合表，并且每隔一段时间，通过插入/选择将数据通过网络填充到另一个。尝试处理主键和不处理的东西有点令人费解。（`insert ignore`似乎无法正常工作）

ps 我可以轻松地构建一个查询来选择要传输的行。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-13T03:30:00.733

MySQL 的内置复制非常容易设置，即使在大部分时间数据库断开连接时也能正常工作。我想说配置它比那里的任何自定义解决方案要简单得多。

有关说明，请参阅[http://www.howtoforge.com/mysql_database_replication](http://www.howtoforge.com/mysql_database_replication)，您应该在 10-15 分钟内启动并运行，您不必再考虑它。

我能看到的唯一缺点是它是异步的——即。你必须有一个指定的主人来获得所有的变化。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T22:07:57.803

我目前的解决方案是

*   在源框上设置联合表，抓取目标框上的表
*   在选择要更新的行的源框上设置一个视图（作为联合表的连接）
*   在目标框上设置另一个联合表，以获取源框上的视图
*   在目标框上发出一个`INSERT...SELECT...ON DUPLICATE UPDATE`以运行拉取。

我想我可以抓住源表并一次性完成所有操作，但根据我看到的查询日志，我猜我最终会运行大约 20K 查询或大约 100-300MB数据传输取决于事情的发生方式。上面出售的设置产生了大约 4 个查询，并且传输的数据比实际需要的多一点。

# wcf - BizTalk 发布 net.tcp WCF 服务

> ID：286077
> 
> 赞同：2
> 
> 时间：2008-11-13T02:24:25.967
> 
> 标签：wcf, biztalk

有人熟悉为 BTS 设置 WCF-nettcp 适配器吗？

当我为接收位置创建 WCF-netTcp 适配器时，我不确定 BTS 将如何/何时打开端口 808 以侦听指定的地址 URI。它似乎只有在我重新启动整个 BizTalk 应用程序时才会发生。如果它由于某种原因关闭，我看不到任何重新配置​​和重新打开端口的方法。

此外，由于这只是 net.tcp 绑定，因此没有暴露 mex 端点。我相信希望使用该公开 WCF 服务的客户端应用程序最初需要 mex 元数据。直接从 Visual Studio 项目访问该端点只会产生

```
Metadata contains a reference that cannot be resolved: 'net.tcp://biztalkserver/PostReceiveLocation_TCP/PostReceiveService.svc'.
Metadata contains a reference that cannot be resolved: 'net.tcp://biztalkserver/PostReceiveLocation_TCP/PostReceiveService.svc'.
If the service is defined in the current solution, try building the solution and adding the service reference again. 
```

无法说明如何正确地将 mex 端点暴露给服务。BizTalk WCF 服务发布向导让我感到困惑；我无法让它引用我设置的 WCF 适配器/接收位置。我发现没有任何文档可以教我们应该为 netTcp 服务做什么；这都是关于 Http 的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-15T06:37:43.827

有趣的是，[关于发布 Net-Msmq WCF 服务的演练](http://msdn.microsoft.com/en-us/library/bb259950.aspx)促使我思考 WCF 服务发布向导是如何真正工作的。

问题是这样的：当我手动创建 WCF-netTcp 接收位置时，它有它的端点 URI，例如 net.tcp://biztalkserver/PostReceiveLocation_TCP/PostReceiveService.svc。在 WCF 服务发布向导中选择仅发布 mex 端点的选项时，它最终会询问 WCF 服务位置，我将其混淆为实际的服务位置。由于它只接受 Http URL，因此它似乎只支持基于 Http 的 WCF 端点。

但是对于该文本框，应该放置*仅用于 mex 端点*的 Http URL，而不是实际的 net.tcp WCF 端点。那是 IIS 中向导将创建必要的元数据文件的位置。完成后，托管 mex 端点的该位置将通知客户端位于 net.tcp 端点的真实服务。

# sql-server - IIS 中的服务不可用

> ID：286081
> 
> 赞同：0
> 
> 时间：2008-11-13T02:25:36.417
> 
> 标签：sql-server, iis

当我在经典 ASP 中将对 sql server 数据的错误调用访问到我的应用程序中时，我在整个站点中都会收到此消息：服务不可用。停了。我的站点位于远程主机中。不知道该怎么办。我可以告诉他们的“支持团队”什么来解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T04:16:41.433

如果您查看管理工具/事件查看器 - 应用程序日志，您可能会看到一条错误消息。

这也应该为您提供更多信息，以及应用程序池为何死亡或 IIS 为何死亡。

如果您将其粘贴到您的问题中，我们应该能够缩小范围。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T04:56:05.957

每当您的 asp.net 页面中出现许多后续错误时，应用程序池可能会关闭。有一个容差水平，通常在 10 分钟内出现 5 个错误，左右。超出此级别，IIS 将停止该服务。由于这个错误，我遇到了很多问题。

您可以做的是修复所有网站（需要时间），或者提高容差水平，或者只是禁用自动关闭系统。就是这样

```
Run IIS
Right click on the node 'Application Pools' in your left sidebar.
Click on the tab 'Health'
Remove the check on 'Enable Rapid Fail Protection' 
```

或更改容差水平。

希望有帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T02:27:25.587

您可以获得此信息的一个原因是应用程序池已停止。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T02:55:34.763

如果出现错误，应用程序池可能会停止。通常在 5 分钟内出现 5 个错误后，IIS 会关闭 AppPool。它是 Rapid-fail 保护的一部分，可以为 AppPool 禁用它，否则 AppPool 每次发生时都必须重新启动。

IIS 管理员可以更改这些设置。看起来您可以设置一个脚本来重新启动和应用程序池，因此您应该能够设置一个新的 Web 应用程序（在不同的应用程序池中）来重新启动您关闭的应用程序池。主持人可能不喜欢那样。

对您来说最好的结果是在它们进入 IIS 之前捕获所有异常。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T03:32:55.877

可能是 Global.asx 中的 Application_Start（或类似）方法中的 SQL 异常。如果应用程序（ASP.NET 工作进程）无法启动，它就无法运行，因此工作进程必须关闭。

# svn - Subversion 不记得我的用户名/密码

> ID：286085
> 
> 赞同：2
> 
> 时间：2008-11-13T02:27:21.110
> 
> 标签：svn

我已经按照*[在 Ubuntu 上使用 Apache、SSL 和 BasicAuth 安装 Subversion 指南在 Ubuntu 上安装了 Subversion。](http://alephzarro.com/blog/2007/01/07/installation-of-subversion-on-ubuntu-with-apache-ssl-and-basicauth)*.

它有效，我能够提交并创建不同的存储库，但不知何故，有时（有时是几分钟），当尝试进行提交时，我不得不使用以下命令重置或重新创建我的用户和密码。

```
htpasswd2 -c -m /etc/apache2/dav_svn.passwd $AUTH_USER 
```

因为 SVN 不再识别我的用户/密码。

我使用 TortoiseSVN 作为 SVN 客户端。我想知道为什么会这样。可能是配置问题，或者 TortoiseSVN 发送的凭据无效，导致帐户被锁定。因为我远非 SVN 专家/管理员。是否有一些指针可以解决问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-16T09:35:20.677

检查您的密码文件是否确实已更改。做一个

`md5 /etc/apache2/dav_svn.passwd`或者`cat /etc/apache2/dav_svn.passwd`

什么时候工作，什么时候停止工作。如果它发生变化，您必须弄清楚原因（从 cronjob 自动更新？某些网站/管理工具会为您更改它？）

请注意，如果您使用任何形式的默认设置，subversion + apache 不会以任何方式更改此文件*。*

我也希望您用正确的用户名替换 $AUTH_USER ;-) （或者至少已经导出了变量）。

如果文件没有改变，那就是别的东西。查看apache错误日志中是否有任何内容。

其他几种可能性：

*   尝试禁用 https（用于测试 - 因为您可能没有有效的证书）。
*   检查您的 .subversion/auth 文件夹；我不确定 tortoisesvn，但我相信它在那里存储凭据信息（就像 vanilla svn 一样）。
*   不太可能，但与其重新创建您的用户，不如看看是否`touch /etc/apache2/dav_svn.passwd`可以解决问题。
*   该文件是否可由除 root 以外的任何人写入？如果是这样的话，`chmod 644 /etc/apache2/dav_svn.passwd`

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-11-13T02:52:17.207

我也在使用 TortoiseSVN，但在 Windows 上，用户的密码由网络域上的[Active Directory管理。](http://en.wikipedia.org/wiki/Active_Directory)所以用户名的格式是`<domain>\<user>`. 并且不时（几周），我需要重置密码；好像密码改了。我只是不知道为什么。

# c - C中的堆栈溢出利用

> ID：286090
> 
> 赞同：8
> 
> 时间：2008-11-13T02:31:25.610
> 
> 标签：c, stack-overflow, buffer-overflow, exploit

问题实际上是关于 C 中的堆栈溢出。我有一个我一生都无法完成的任务，我查看了 gdb 中的所有内容，但我无法理解。

问题如下：

```
int i,n;

void confused()
{
    printf("who called me");
    exit(0);
}

void shell_call(char *c)
{
    printf(" ***Now calling \"%s\" shell command *** \n",c);
    system(c);
    exit(0);
}

void victim_func()
{
    int a[4];
    printf("[8]:%x\n", &a[8]);
    printf("Enter n: "); scanf("%d",&n);
    printf("Enter %d HEX Values \n",n);
    for(i=0;i<n;i++) scanf("%x",&a[i]);
    printf("Done reading junk numbers\n");
}

int main()
{
    printf("ls=736c --- ps = 7370 --- cal = 6c6163\n");
    printf("location of confused %x \n", confused);
    printf("location of shell_call %x \n", shell_call);
    victim_func();
    printf("Done, thank you\n");

} 
```

好的，所以我设法正确地得到了第一个问题，即任意调用主路径中未显式调用的两个函数之一。顺便说一句，这必须在运行程序时完成，无需任何修改。我通过运行程序来做到这一点，设置`N`为`7`，这让我到了`victim_func`帧的函数指针，我`a[7]`用混淆或的内存地址写入`shell_call`，它可以工作。（我有一台 64 位机器，这就是为什么我必须将其设置为 7，因为 EBI 指针是 2 个整数宽，而不是 1）

我的问题如下，我如何控制将哪个参数传递给函数`shell_code`？IE。我怎么写`string`。**重点是通过仅运行程序来执行ps**等`char* c`unix 命令。

 ****我想用ps**的十六进制表示来编写 EBI 指针并将 arg 列表设置`shell_call`为此，但这不起作用。我也尝试输入`argsv`参数并将 arg 列表设置`shell_call`为`arg_list`main，但也没有工作。

我认为第二个版本应该可以工作，但我相信我没有正确设置新堆栈帧的 arg 列表（我是通过写入`a[8]`来完成的`0`，因为它是函数指针的第一部分，并且写入`a[9]=736c`and `a[10]=0000`，但它可能不对，因为这些是 的参数`victim_func`。那么如何访问 的参数`shell_call`？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-13T03:56:37.030

我可能不应该为你做作业。但基本上：

您需要在内存中的某处获取一个字符缓冲区来存储您要执行的字符串。显然，您可以像调用其他函数一样执行此操作（即，您也可以将文本放入堆栈）。写完之后，您需要将指向它的指针写入堆栈中 shell_code 函数期望找到其参数的位置。

在没有我为您完成*所有*工作的情况下解决这个问题的最佳方法是在一张纸/白板上写下您的堆栈/内存内容。写下如果你从程序内部正常调用 shell_code 的样子。然后写下 victum_func 中的堆栈是什么样子，并弄清楚要更改哪些内容以使其看起来“自然”（当然请记住，有些事情是“无关紧要的”，例如返回地址）。

这就是你今天要从我这里得到的所有慈善！:-P

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-15T13:22:42.230

SoapBox 已经很好地引导您朝着正确的方向前进。

了解更多信息; [http://www.skullsecurity.org/wiki/index.php/Example_4](http://www.skullsecurity.org/wiki/index.php/Example_4)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-15T13:06:06.913

您需要操作调用者 ( `main()`) 的堆栈框架，并以这样的方式安排它，以便`shell_call()`从溢出的 Epilog返回`victim_func()`后者可以找到一个已解决的堆栈，因为它被 main 调用。

这样做时，您可能必须破坏受害者堆栈帧中的帧指针，该指针将通过`leave`.

# sql - SQL*PLUS for Oracle 有什么好的替代品吗？

> ID：286091
> 
> 赞同：36
> 
> 时间：2008-11-13T02:32:05.623
> 
> 标签：sql, database, oracle, sqlplus

我不喜欢使用 SQL*PLUS 作为 Oracle 的接口。我通常使用[yasql](http://sourceforge.net/projects/yasql/)，但它自 2005 年以来一直没有更新，并且可以进行一些改进。快速的[Google 搜索](http://www.google.com/search?q=sql*plus+replacement)显示 yasql 和[SQLPal](http://www.sqlpal.com/)。我使用的是 linux，所以 SQLPal 不是一个选项。

是否有任何替代方案，或者我是否坚持使用我不喜欢的界面或不再维护的界面？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-11-13T02:52:29.077

我假设您想要一种低开销的查询方法，但想要比 SQL*Plus 提供的更多功能？为什么不使用 Oracle 的[SQL Developer](http://www.oracle.com/technetwork/developer-tools/sql-developer/overview/index.html)？免费。

安装，与数据库建立新连接，然后开始输入脚本。按 F5 运行它（或只是您突出显示的部分脚本）。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-11-19T00:21:04.927

看看[gqlplus](http://gqlplus.sourceforge.net/)。它在 linux 上包装了 sql*plus，并通过添加命令历史记录、表名完成等内容使其更加用户友好。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-01-13T21:27:35.650

[Emacs](http://www.gnu.org/software/emacs/)可以提供比默认 SQL*Plus 命令行界面更强大的文本编辑特性和功能。

下面是一些关于如何使用 Emacs 作为 SQL*Plus 包装器的链接：

*   [Emacs 和甲骨文](http://sodonnell.wordpress.com/2007/07/10/emacs-and-oracle/)
*   [EmacsWiki:SqlPlus](http://www.emacswiki.org/cgi-bin/wiki/SqlPlus)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-11-13T02:49:39.287

TOAD 相当昂贵，但您可以从 Quest 网站下载 90 天试用版，看看它是否具有您想要的功能集（不要被“免费软件”标题所迷惑 - 它只有 90 天免费，然后它过期了，这肯定使它成为共享软件）：

[http://www.toadworld.com/Freeware/ToadforOracleFreeware/tabid/558/Default.aspx](http://www.toadworld.com/Freeware/ToadforOracleFreeware/tabid/558/Default.aspx)

另一个选择是我在 CodeProject 上看到的一个工具：

[http://www.codeproject.com/KB/database/OQuery.aspx](http://www.codeproject.com/KB/database/OQuery.aspx)

它在 .NET 中，因此您必须查看它是否在 Mono 上编译，但可能值得一试。我没有使用过任何一种工具（Toad 或这个），因为我是一名 SQL Server 人员，但我听说过有关 Toad 的好消息。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-11-21T20:33:32.500

如果它是你想要的命令行，我建议[rlwrap](http://utopia.knoware.nl/~hlub/uck/rlwrap/man.html)与 sqlplus 一起使用；它为您提供行编辑功能和命令历史记录，使 sqlplus 成为一个有点可用的工具。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-11-14T22:08:51.950

你可以试试 allroundautomations 的 PL/SQL developer [，](http://www.allroundautomations.com)有试用版，价格比 TOAD 低很多。

问候 K

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2017-08-29T05:57:03.223

看看[塞诺拉](https://github.com/drautzburg/senora)。该工具是用 Perl 编写的，因此是跨平台的。此外，Senora 是免费的、可扩展的，旨在成为您的主要 Oracle shell。您可以通过提供自己的插件轻松扩展 Senora。Senora 尝试提供比 sqlplus 更友好的输出格式。列往往只有真正需要的宽度。

另一个有趣的选择是[SQLcl](http://www.oracle.com/technetwork/developer-tools/sqlcl/overview/index.html)。它提供内联编辑、语句完成、命令调用、DBA 内容（例如启动、关闭），还支持您以前编写的 SQL*Plus 脚本。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-11-13T03:02:07.310

这取决于你在寻找什么。如果它是一个 GUI 查询工具，那么 Oracle 有他们的免费 SQL Developer 产品（尽管它占用了大量资源）。还有一些免费的跨数据库的。我自己喜欢 SQUirrel SQL 客户端。还有 DBVisualiser 和其他一些。JEdi​​t 是一个具有 DBConsole 插件的编辑器，用于运行数据库查询和 DML/DDL。它们都是基于 java 的，所以在大多数地方运行。

如果您喜欢命令行，请查看 sqlpython（开发人员也确定了其他[几个](http://catherinedevlin.blogspot.com/2008/10/sqlpython-getting-crowded-in-here.html)）

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-13T03:02:24.220

我喜欢[SQL Developer](http://www.oracle.com/technology/products/database/sql_developer/index.html)。它是免费的，具有直观的 UI，可在 Windows、Mac 和 Linux 上运行。它还支持许多 sql*plus 命令并支持版本控制

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-06-01T17:30:33.120

TOAD 的开源版本是 TORA：tora.sourceforge.net

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-02-18T08:38:15.763

如果您是*VIM 类型的人，*那么我会研究[Vorax](http://code.google.com/p/vorax/)。它基本上是一个围绕 SQL*plus 的 VIM 包装器。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-11-13T02:55:30.287

如果您可以支付许可证费用，则可以从 quest software toad

sql squirrel 如果你不能。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-01-11T16:01:27.147

使用过 Toad 和**SQL Navigator**，我喜欢 SQL Navigator 的稳定性。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-09-15T16:08:39.253

我喜欢sqlsh

```
alias sqr='sqlsh -d DBI:Oracle:MYSERVER.COM -u USER -p PASSWORD' 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-11-08T10:20:02.360

我将自己的工具[ocimlsh](http://gaiustech.wordpress.com/2011/05/14/ocaml-as-a-sqlplus-replacement/)与[rlwrap](http://utopia.knoware.nl/~hlub/uck/rlwrap/rlwrap.html)结合使用。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2019-01-09T18:26:16.517

我只是使用[socat](http://www.dest-unreach.org/socat/doc/socat.html)为 sqlplus 添加 readline 支持。历史和工作退格键实际上将 sqlplus 变成了一个相当不错的工具。

在我的*.bashrc*中：

```
function sqlplus {
        socat READLINE,history=$HOME/.sqlplus_history EXEC:"$ORACLE_HOME/bin/sqlplus $(echo $@ | sed 's/\([\:]\)/\\\1/g')",pty,setsid,ctty
        status=$?
} 
```

您可能会看到将sqlplus*别名*为 socat 的替代方法，但您很快会发现这样做会阻止您使用各种命令行选项调用 sqlplus。

**警告：请务必将*$HOME/.sqlplus_history*权限设置为 0600。您键入的密码最终会出现在历史文件中。您也可以考虑添加`cat /dev/null > $HOME/.sqlplus_history`到您的*.bash_logout*中。**

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2021-12-15T14:27:29.640

显然，Oracle 本身已经淘汰了 sql*plus 并用 SQLcl 取而代之，后者支持更现代的功能，如历史记录、格式化等：[https](https://www.oracle.com/database/technologies/appdev/sqlcl.html) ://www.oracle.com/database/technologies/appdev/sqlcl.html 。

# tdd - 断言一个方法只被调用一次

> ID：286093
> 
> 赞同：28
> 
> 时间：2008-11-13T02:32:54.140
> 
> 标签：tdd, mocking, rhino-mocks, assertions

我想断言一个方法只被调用一次。我正在使用 RhinoMocks 3.5。

这是我认为可行的方法：

```
[Test]
public void just_once()
{
    var key = "id_of_something";

    var source = MockRepository.GenerateStub<ISomeDataSource>();
    source.Expect(x => x.GetSomethingThatTakesALotOfResources(key))
        .Return(new Something())
        .Repeat.Once();

    var client = new Client(soure);

    // the first call I expect the client to use the source
    client.GetMeMyThing(key);

    // the second call the result should be cached
    // and source is not used
    client.GetMeMyThing(key);
} 
```

`GetMeMyThing()`如果第二次调用调用，我希望此测试失败`source.GetSomethingThatTakesALotOfResources()`。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-02-20T05:54:22.463

以下是我如何验证一个方法是否被调用一次。

```
[Test]
public void just_once()
{
    // Arrange (Important to GenerateMock not GenerateStub)
    var a = MockRepository.GenerateMock<ISomeDataSource>();
    a.Expect(x => x.GetSomethingThatTakesALotOfResources()).Return(new Something()).Repeat.Once();

    // Act
    // First invocation should call GetSomethingThatTakesALotOfResources
    a.GetMeMyThing();

    // Second invocation should return cached result
    a.GetMeMyThing();

    // Assert
    a.VerifyAllExpectations();
} 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-05-20T05:21:01.223

我一直在使用 AssertWasCalled 扩展来解决这个问题。这是我能找到/想出的最好的，但如果我不必指定两次调用会更好。

```
 [Test]
    public void just_once()
    {
        var key = "id_of_something";

        var source = MockRepository.GenerateStub<ISomeDataSource>();

        // set a positive expectation
        source.Expect(x => x.GetSomethingThatTakesALotOfResources(key))
            .Return(new Something())
            .Repeat.Once();

        var client = new Client(soure);
        client.GetMeMyThing(key);
        client.GetMeMyThing(key);

        source.AssertWasCalled(x => x.GetSomethingThatTakesALotOfResources(key),
                               x => x.Repeat.Once());
        source.VerifyAllExpectations();
    } 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-13T03:27:34.623

您可能对 Rhino Mocks 3.5 文档中的[这一点](http://ayende.com/Wiki/Rhino+Mocks+3.5.ashx#Thedifferencebetweenstubsandmocks)感兴趣（引用如下）。看起来你需要模拟这个类，而不是存根它，它才能按照你期望的方式工作。

> 存根和模拟之间的区别
> 
> ...
> 
> 模拟是我们可以设置期望的对象，它将验证预期的动作确实发生了。存根是您用来传递给被测代码的对象。您可以对其设置期望，因此它会以某些方式起作用，但这些期望永远不会得到验证。存根的属性会自动表现得像普通属性一样，您不能对它们设置期望。
> 
> 如果您想验证被测代码的行为，您将使用具有适当期望的模拟，并进行验证。如果您只想传递一个可能需要以某种方式执行的值，但不是此测试的重点，您将使用存根。
> 
> 重要提示：存根永远不会导致测试失败。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T02:51:57.457

这是我刚刚做的（由[Ray Houston](http://twitter.com/rayhouston/statuses/1003171744)推荐）。我仍然会欣赏一个更优雅的解决方案......

```
[Test]
public void just_once()
{
    var key = "id_of_something";

    var source = MockRepository.GenerateStub<ISomeDataSource>();

    // set a positive expectation
    source.Expect(x => x.GetSomethingThatTakesALotOfResources(key))
        .Return(new Something())
        .Repeat.Once();

    var client = new Client(soure);

    client.GetMeMyThing(key);

    // set a negative expectation
    source.Expect(x => x.GetSomethingThatTakesALotOfResources(key))
        .Return(new Something())
        .Repeat.Never();

    client.GetMeMyThing(key);
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-03-04T00:59:41.983

您可以将委托传递给 WhenCalled 以计算调用次数：

```
...
uint callCount = 0;
source.Expect(x => x.GetSomethingThatTakesALotOfResources(key))
    .Return(new Something())
    .WhenCalled((y) => { callCount++; });
...
Assert.AreEqual(1, callCount); 
```

此外，您应该使用模拟而不是存根，并验证模拟的期望。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-11-01T15:11:08.770

如果你想确保一个方法只被调用一次，你可以创建严格的模拟。

```
var mock = MockRepository.GenerateStrictMock<IMustOnlyBeCalledOnce>();
mock.Expect(a => a.Process()).Repeat.Once();
var helloWorld= new HelloWorld(mock);

helloworld.Process()

mock.VerifyAllExpectations(); 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-04-21T15:04:06.387

拥有一个名为“Exactly”的功能可以方便地对可能进入无限循环的代码编写测试。我很想编写一个测试，以便对方法的第二次调用会引发异常。

一些 Python 库允许您对期望进行排序，因此第一个返回 false，第二个引发异常。

犀牛不会那样做。带有 .Once 的部分模拟将拦截第一次调用，其余的将传递给原始方法。所以这很糟糕，但这是真的。

您必须创建一个手模。派生一个“可测试”类，并赋予它在第一次跟注后加注的能力。

# c - 将具有结构类型的值传递给C中的函数

> ID：286096
> 
> 赞同：1
> 
> 时间：2008-11-13T02:34:35.680
> 
> 标签：c, data-structures, struct

```
typedef struct {
        nat id;
        char *data;
        } element_struct;

typedef element_struct * element;

void push(element e, queue s) {
        nat lt = s->length;
        if (lt == max_length - 1) {
                printf("Error in push: Queue is full.\n");
                return;
        }
        else {
                s->contents[lt] = e;
                s->length = lt + 1;
        }
}
int main () {
         push(something_of_type_element, s);
} 
```

我将如何格式化“ `something_of_type_element`”？

谢谢

注：nat 与 int 相同

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T02:44:34.320

怎么样：

```
element elem = malloc(sizeof(element_struct));
if (elem == NULL) {
    /* Handle error. */
}

elem->id = something;
elem->data = something_else;

push(elem, s); 
```

请注意，这里缺少很多内存管理......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T02:44:55.520

像这样：

```
element_struct foo = { 1, "bar" };
push(&foo, s); 
```

如果你有 C99 编译器，你可以这样做：

```
element_struct foo = {
    .id = 1,
    .data = "bar"
};
push(&foo, s); 
```

请注意，如果结构中的数据需要比定义它的范围更长，则必须复制结构中的数据。否则，可以使用 malloc（见下文）在堆上分配内存，或者可以使用全局或静态变量。

```
element_struct foo = malloc(sizeof (element_struct));

foo.id = 1;
foo.data = "bar";
push(foo, s); 
```

# .net - 当文件夹重定向处于活动状态时解析“Environment.SpecialFolder.Personal”

> ID：286103
> 
> 赞同：5
> 
> 时间：2008-11-13T02:40:49.130
> 
> 标签：.net, winforms, windows-xp

默认情况下，我们的 Windows 窗体应用程序将数据文件保存在用户的“我的文档”文件夹（在 XP 上）或“文档”文件夹（在 Vista 上）。我们通过调用来查找这个位置：

```
Environment.GetFolderPath( Environment.SpecialFolder.Personal ) 
```

我们确信这对于个人文件夹位于本地磁盘上的用户非常有用。我们不确定的是对其配置文件/个人数据文件夹有效的文件夹重定向的域用户。

我的问题是：**无论文件夹重定向是否处于活动状态，上述调用是否都能正确解决？**

我没有环境来测试这一点，而且我无法以一种或另一种方式找到任何明确的确认。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T03:06:58.253

是的，它确实。您可以通过更新文件夹的相应注册表项来自行测试。看下...

```
\HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders\ 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-07-19T14:49:00.303

我有一个用户在`Environment.GetFolderPath(Environment.SpecialFolder.Personal)`我的文档被重定向到网络（它转到驱动器 O）的 XP 机器上的调用中报告了以下错误：

```
System.ArgumentException: Absolute path information is required.
   at System.Security.Util.StringExpressionSet.CreateListFromExpressions(String[] str, Boolean needFullPath)
   at System.Security.Permissions.FileIOPermission.AddPathList(FileIOPermissionAccess access, AccessControlActions control, String[] pathListOrig, Boolean checkForDuplicates, Boolean needFullPath, Boolean copyPathList)
   at System.Security.Permissions.FileIOPermission..ctor(FileIOPermissionAccess access, String path)
   at System.Environment.GetFolderPath(SpecialFolder folder, SpecialFolderOption option)
   at System.Environment.GetFolderPath(SpecialFolder folder) 
```

我还没有直接访问此机器配置，但从谷歌搜索和用户的帮助来看，我相信重定向缺少尾随 \（例如 O: 而不是 O:\）。

所以我相信答案是**否定的，它不会每次都正确解决**。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T02:53:12.383

我希望它确实如此。两者`Environment.GetFolderPath`和底层的文档都[`SHGetSpecialFolderPath`](http://msdn.microsoft.com/en-us/library/bb762204(VS.85).aspx)没有表明它不能正确解析，我也找不到任何你会使用它的地方。

# regex - 正则表达式 - 通过嵌套 div 的 id 查找 div 的内容

> ID：286104
> 
> 赞同：8
> 
> 时间：2008-11-13T02:41:29.880
> 
> 标签：regex

在有人问之前，我没有做任何形式的屏幕截图。

我正在尝试解析 html 字符串以查找具有特定 id 的 div。我一辈子都无法让它发挥作用。以下表达式在一种情况下有效，但在另一种情况下无效。我不确定它是否与 html 中的额外元素有关。

```
<div\s*?id=(\""|&quot;|&#34;)content(\""|&quot;|&#34;).*?>\s*?(?>(?! <div\s*?> | </div> ) | <div\s*?>(?<DEPTH>) | </div>(?<-DEPTH>) | .?)*(?(DEPTH)(?!))</div> 
```

它正确地找到了第一个具有正确 id 的 div，但它随后在第一个关闭 div 处关闭，而不是相关的 div。

```
<div id="firstdiv">begining content<div id="content">some other stuff
    <div id="otherdiv">other stuff here</div>
    more stuff
    </div>
</div> 
```

这应该带回来

```
<div id="content">some other stuff
   <div id="otherdiv">other stuff here</div>
   more stuff
</div> 
```

，但由于某种原因，它不是。它是带回来的：

```
 <div id="content">some other stuff
      <div id="otherdiv">other stuff here</div> 
```

有没有人有更容易的表达来处理这个？

澄清一下，这是在 .NET 中，我使用的是 DEPTH 关键字。您可以[在此处](http://www.m-8.dk/resources/RegEx-Balancing-Group.aspx)找到更多详细信息。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-13T02:46:51.850

您是否需要一个可以跟踪嵌套在 DIV 标签内的 DIV 标签数量的正则表达式？恐怕这对于正则表达式是不可能的。

您可以使用正则表达式来获取第一个 DIV 标签的索引，然后遍历字符串中的字符，从该索引开始，并记录打开的 div 标签的数量。当您遇到关闭的 div-tag 并且计数为零时，您将在包含所需子字符串的字符串中获得开始和结束索引。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-13T18:20:17.763

在 .NET 中，您可以这样做：

```
(?<text>
(<div\s*?id=(\"|&quot;|&\#34;)content(\"|&quot;|&\#34;).*?>)

  (?>
      .*?</div>
    |
      .*?<div (?>depth)
    |
      .*?</div> (?>-depth)
  )*)
  (?(depth)(?!))
.*?</div> 
```

您必须使用单行选项。这是使用控制台的示例：

```
using System;
using System.Text.RegularExpressions;

namespace Temp
{
    class Program
    {
        static void Main()
        {
            string s = @"
<div id=""firstdiv"">begining content<div id=""content"">some other stuff
  <div id=""otherdiv"">other stuff here</div>
  more stuff
  </div>
</div>";
            Regex r = new Regex(@"(?<text>(<div\s*?id=(\""|&quot;|&\#34;)"
                + @"content(\""|&quot;|&\#34;).*?>)(?>.*?</div>|.*?<div "
                + @"(?>depth)|.*?</div> (?>-depth))*)(?(depth)(?!)).*?</div>",
                RegexOptions.Singleline);
            Console.WriteLine("HTML:\n");
            Console.WriteLine(s);
            Match m = r.Match(s);
            if (m.Success)
            {
                Console.WriteLine("\nCaptured text:\n");
                Console.WriteLine(m.Groups[4]);

            }
            Console.ReadLine();
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T02:53:06.110

西比斯说的是实话。这种东西属于上下文无关语言，它比正则语言（正则表达式涵盖的那种东西）更强大。涉及到很多计算机科学理论，但可以放心地说，任何值得称道的语言都将拥有一个库，用于存储您可能应该使用的这类东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T02:52:36.830

什么编程语言？如果它是 .Net 并且您确定 html 格式正确，则可以将其加载到 XmlDocument 或 XDocument 对象中并对其执行 xpath 查询。

# c++ - 如何以最小的性能损失同步 C 和 C++ 库？

> ID：286105
> 
> 赞同：1
> 
> 时间：2008-11-13T02:41:43.997
> 
> 标签：c++, c, optimization, portability, maintainability

我有一个 C 库，其中包含许多用于处理向量、矩阵、四元数等的数学例程。它需要保留在 C 中，因为我经常将它用于嵌入式工作和作为 Lua 扩展。此外，我有 C++ 类包装器，以允许更方便的对象管理和使用 C API 进行数学运算的运算符重载。包装器仅包含一个头文件，并且尽可能多地使用内联。

包装 C 代码与将实现直接移植和内联到 C++ 类中是否有明显的惩罚？该库用于时间关键型应用程序。那么，消除间接性带来的提升是否弥补了两个端口的维护难题？

C接口示例：

```
typedef float VECTOR3[3];

void v3_add(VECTOR3 *out, VECTOR3 lhs, VECTOR3 rhs); 
```

C++ 包装器示例：

```
class Vector3
{
private:
    VECTOR3 v_;

public:
    // copy constructors, etc...

    Vector3& operator+=(const Vector3& rhs)
    {
        v3_add(&this->v_, this->v_, const_cast<VECTOR3> (rhs.v_));
        return *this;
    }

    Vector3 operator+(const Vector3& rhs) const
    {
        Vector3 tmp(*this);
        tmp += rhs;
        return tmp;
    }

    // more methods...
}; 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T02:48:54.000

如果您只是将 C 库调用包装在 C++ 类函数中（换句话说，C++ 函数除了调用 C 函数什么都不做），那么编译器将优化这些调用，从而不会降低性能。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-13T06:41:28.630

与任何有关性能的问题一样，系统会告诉您进行测量以获得答案（这是严格正确的答案）。

但根据经验，对于实际上可以内联的简单内联方法，您不会看到性能损失。一般来说，除了将调用传递给另一个函数之外什么都不做的内联方法是内联的理想选择。

但是，即使您的包装器方法没有内联，我怀疑您不会注意到性能损失 - 甚至不是可测量的损失 - 除非在某个关键循环中调用了包装器方法。即使那样，它也可能只有在包装函数本身没有做太多工作的情况下才能被测量。

这种类型的事情是关于最后需要关注的事情。首先要担心使您的代码正确、可维护以及您正在使用适当的算法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T03:02:47.887

像往常一样与优化相关的一切，答案是您必须先衡量性能本身，然后才能知道优化是否值得。

*   对两个不同的函数进行基准测试，一个直接调用 C 风格的函数，另一个通过包装器调用。查看哪个运行得更快，或者差异是否在您测量的误差范围内（这意味着您没有可以测量的差异）。
*   查看上一步中两个函数生成的汇编代码（在 gcc 上，使用`-S`or `-save-temps`）。看看编译器是否做了一些愚蠢的事情，或者你的包装器是否有任何性能错误。

除非性能差异太大而有利于不使用包装器，否则重新实现不是一个好主意，因为您可能会引入错误（这甚至可能导致看起来正常但错误的结果）。即使差异很大，只要记住 C++ 与 C 非常兼容，并且即使在 C++ 代码中以 C 风格使用您的库，也会更简单且风险更小。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T09:26:02.700

您的包装器本身将被内联，但是，您对 C 库的方法调用通常不会。（这需要链接时间优化，这在技术上是可行的，但在当今的工具中，AFAIK 充其量只是初级）

通常，这样的函数调用并不是很昂贵。在过去的几年中，周期成本已经大大降低，并且可以很容易地预测，因此调用惩罚本身可以忽略不计。

然而，内联打开了更多优化的大门：如果你有 v = a + b + c，你的包装类会强制生成堆栈变量，而对于内联调用，大部分数据可以保存在 FPU 堆栈中。此外，内联代码允许简化指令、考虑常量值等等。

因此，虽然**投资规则之前的衡量标准**是正确的，但我希望这里有一些改进的空间。

* * *

一个典型的解决方案是将 C 实现转化为可以用作内联函数或“C”主体的格式：

```
// V3impl.inl
void V3DECL v3_add(VECTOR3 *out, VECTOR3 lhs, VECTOR3 rhs)
{
    // here you maintain the actual implementations
    // ...
}

// C header
#define V3DECL 
void V3DECL v3_add(VECTOR3 *out, VECTOR3 lhs, VECTOR3 rhs);

// C body
#include "V3impl.inl"

// CPP Header
#define V3DECL inline
namespace v3core {
  #include "V3impl.inl"
} // namespace

class Vector3D { ... } 
```

这可能仅对具有相对简单主体的选定方法有意义。我会将这些方法移动到 C++ 实现的单独命名空间，因为您通常不需要直接使用它们。

（注意，内联只是一个编译器提示，它不会强制内联方法。但这很好：如果内部循环的代码大小超过指令缓存，内联很容易损害性能）

是否可以解决通过/返回引用取决于编译器的强度，我见过很多 foo(X * out) 强制堆栈变量，而 X foo() 确实将值保存在寄存器中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-13T02:47:54.810

我认为您不会注意到太多性能差异。假设您的目标平台支持您的所有数据类型，

我正在为 DS 和其他一些 ARM 设备编码，浮点是邪恶的......我不得不将浮点类型定义为 FixedPoint<16,8>

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-13T05:43:08.607

如果您担心调用函数的开销会拖慢您的速度，为什么不测试内联 C 代码或将其转换为宏呢？

另外，为什么不改进 C 代码的 const 正确性呢？ const_cast 确实应该谨慎使用，尤其是在您控制的接口上。

# c# - 为 C# 代码寻找可配置的漂亮打印机

> ID：286117
> 
> 赞同：2
> 
> 时间：2008-11-13T02:48:01.987
> 
> 标签：c#, formatting, pretty-print

我在一个有大约 10 名开发人员的团队中工作。一些开发人员有非常严格的格式化需求。我想找到一台漂亮的打印机，我可以根据这些规格进行配置，然后添加到构建过程中。通过这种方式，无论其他人在从源代码管理中删除格式时将格式弄得多么糟糕，它看起来都可以接受。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T02:56:02.407

最简单的解决方案是让团队负责人指定一种格式，并且每个人都使用它。VS 默认值非常好。

Jeff Atwood 在 Stack Overflow 上对我们这样做了，虽然我一开始反抗，但我克服了它 :) 让一切变得更容易！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-07T00:02:37.737

您的问题是创建[NArrange](http://www.narrange.net)（测试版）的主要目的。它允许对 C# 代码进行可配置的重新格式化，并且您可以使用一个通用配置文件供整个团队共享。由于它的重点主要是对类和控制区域中的成员进行重新排序，因此它仍然缺乏许多必要的格式化选项（尤其是成员代码行内的格式化）。

正常的使用场景是每个开发人员在签入之前运行该工具。我不知道任何人运行它是他们构建过程的一部分，但没有理由你不能，因为它是一个命令行工具。我考虑过的一个想法是在文件上运行 NArrange 作为预提交步骤的一部分。如果签入的原始文件内容与源存储库服务器上的 NArrange 格式输出不匹配，则开发人员没有重新格式化为规则并且可能会引发签入错误。

有关更多信息，请参阅我关于[使用 NArrange 组织 C# 代码](http://www.codeproject.com/KB/codegen/narrange.aspx)的 CodeProject 文章。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T04:56:42.040

编码标准绝对是我们拥有的东西。我正在谈论的编码格式是由一个头发花白的建筑师强加的，也就是说，以他的方式设置并且非常特别。让我们假装我们无法解决人为因素。我一直在寻找一种方法来规避整个人类过程。

遗憾的是，Visual Studio 的默认设置不能很好地解决换行问题。我只是在制作这条线切割风格，但是....

```
ServiceLocator.Logger.WriteDefault(string.format("{0}{1}"
                                                 ,foo
                                                 ,bar)
                                   ,Logging.SuperDuper); 
```

格式化visual studio的另一个例子不太热......

```
if( foo
   && ( bar 
       || baz 
       || apples 
       || oranges)
   && IsFoo()
   && IsBar() ){
   } 
```

Visual Studio 根本不能很好地播放这样的东西。我们目前正在使用 ReSharper 以允许更精细的格式化，但遗憾的是它在许多领域都属于分类。

尽管编码标准很棒，但不要误会我的意思。作为构建过程的一部分，漂亮打印机的目标是获得“完美”的代码，无论人们如何注意或计算他们的空间。

围绕代码格式化的边缘情况非常容易解决，因为它是一个定义明确的语法。

就 VS 默认设置而言，我只能说：BSD 风格或死亡！

所有这一切都让我回到了原点：C# 是否有可配置的漂亮打印机？就像词法分析和解析一样令人着迷，我对制作 YAML C# 工具链感到很满意。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T03:22:11.310

我赞同 Jarrod 的回答。如果您有 2 个开发人员的编码偏好相互冲突，那么让团队的其他成员投票，然后让老板支持多数决定。

此外，尝试自动应用这样漂亮的打印机的问题在于，总会有例外情况，即您的一揽子编码标准不是最佳或最易读的解决方案，并且您会因使用自动化工具挤压它们而失败。

编码标准就是这样，标准。他们不称它们为编码法则或编码规则，这是有充分理由的。

# c - 如何从文件中读取一行？

> ID：286123
> 
> 赞同：2
> 
> 时间：2008-11-13T02:51:13.260
> 
> 标签：c, file-io

我必须读取格式如下的 txt 文件：

```
1：（G，2），（F，3）
2：（G，2），（F，3）
3: (F, 4), (G, 5)
4: (F, 4), (G, 5)
5: (F, 6), (c, w)
6: (p, f), (G, 7)
7: (G, 7), (G, 7)
w: (c, w), (c, w)

```

每行都将提供一个结构及其数据（其中的 5 个数字或字母）。
阅读该行并获得我想要的字符串的最佳方法是什么？
我目前正在使用一长串条件，`fgetc`但这看起来很丑陋而且不是很聪明。
我不能使用数组，因为如果数字有两位数，行的大小可能会有所不同。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-13T03:10:44.580

我认为您可以按照以下方式对其进行解析：

```
fscanf(file,"%c: (%c, %c), (%c, %c)", &first,&second,&third,&fourth,&fifth); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-13T02:58:50.280

使用`fgets()`：

```
#include <stdio.h>

int main(void)
{
  char line[256];
  while(fgets(line, sizeof(line), stdin) != NULL)  // fgets returns NULL on EOF
  {
    // process line; line is guaranteed to be null-terminated, but it might not end in a
    // newline character '\n' if the line was longer than the buffer size (in this case,
    // 256 characters)
  }

  return 0;
}
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-13T05:20:30.417

```
#include <stdio.h>

int main (void)
{
  char buf[81];       /* Support lines up to 80 characters */
  char parts[5][11];  /* Support up to 10 characters in each part */

  while (fgets(buf, sizeof(buf), stdin) != NULL)
  {
    if (sscanf(buf, "%10[^:]: (%10[^,], %10[^)]), (%10[^,], %10[^)])",
               parts[0], parts[1], parts[2], parts[3], parts[4]) == 5)
    {
      printf("parts: %s, %s, %s, %s, %s\n",
             parts[0], parts[1], parts[2], parts[3], parts[4]);
    }
    else
    {
      printf("Invalid input: %s", buf);
    }
  }
  return 0;
} 
```

样品运行：

```
$ ./test
1: (G, 2), (F, 3)
2: (G, 2), (F, 3)
3: (F, 4), (G, 5)
4: (F, 4), (G, 5)
5: (F, 6), (c, w)
6: (p, f), (G, 7)
7: (G, 7), (G, 7)
w: (c, w), (c, w)
parts: 1, G, 2, F, 3
parts: 2, G, 2, F, 3
parts: 3, F, 4, G, 5
parts: 4, F, 4, G, 5
parts: 5, F, 6, c, w
parts: 6, p, f, G, 7
parts: 7, G, 7, G, 7
parts: w, c, w, c, w 
```

如果输入中的最后一个值超过 10 个字符，它将被截断而不指示错误，如果这是不可接受的，您可以使用`%c`转换说明符作为第六个参数来捕获最后一个值之后的下一个字符并确保它是右括号。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T02:54:18.217

我记得的 fgets() 和 sscanf()

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T03:25:18.183

fscanf 工作得很好，但您必须使用字符串转换，因为字符不适用于多于一位的数字。

这不是某种家庭作业吗？

```
#include <stdio.h>

void main(int argc, char **argv) {
    FILE * f;
    f = fopen(argv[1], "r");

    while (1) {
        char char_or_num[32][5]; // five string arrays, up to 32 chars
        int i;
        int did_read;

        did_read = fscanf(f, "%32[0-9a-zA-Z]: (%32[0-9a-zA-Z], %32[0-9a-zA-Z]), (%32[0-9a-zA-Z], %32[0-9a-zA-Z])\n", char_or_num[0], char_or_num[1], char_or_num[2], char_or_num[3], char_or_num[4]);
        if (did_read != 5) {
            break;
        }
        printf("%s, %s, %s, %s, %s\n", char_or_num[0], char_or_num[1], char_or_num[2], char_or_num[3], char_or_num[4]);
    }

    fclose(f);
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-13T03:27:47.383

```
＃包括
空白
F（）
{
    文件* fp；

    if ( (fp = fopen("foo.txt", "r")) == NULL)
    {
        perror("fopen");
        返回;
    }

    字符 ch[5];
    而 (fscanf(fp, "%c: (%c, %c), (%c, %c)\n", &ch[0], &ch[1], &ch[2], &ch[3], &ch [4]) == 5)
    {
        printf("--> %c %c %c %c %c\n", ch[0], ch[1], ch[2], ch[3], ch[4]);
    }

fclose(fp);
}

```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-13T04:04:10.803

基本上你必须通过 fgetpos 保存文件 ptr 的位置，走到行尾（无论你如何定义它），保存那个大小，fsetpos 到前一个位置，分配一个足够大的缓冲区来保存行，然后用新缓冲区调用 fread 。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-13T05:19:44.553

假设您有正确的变量，这应该有效：

```
 fscanf(fp, "%[^:]: (%[^,], %[^)]), (%[^,], %[^)])", a, b, c, d, e); 
```

fp 是文件指针，“a”到“e”是字符指针

# c# - 如何测试 ModelState？

> ID：286124
> 
> 赞同：51
> 
> 时间：2008-11-13T02:51:25.007
> 
> 标签：c#, asp.net-mvc

我该如何测试`Controller.ViewData.ModelState`？我宁愿在没有任何模拟框架的情况下这样做。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-02-26T06:24:19.630

当然，如果您对数据使用存储库模式，则不必使用 Mock。

一些例子： [http ://www.singingeels.com/Articles/Test_Driven_Development_with_ASPNET_MVC.aspx](http://www.singingeels.com/Articles/Test_Driven_Development_with_ASPNET_MVC.aspx)

```
// Test for required "FirstName".
   controller.ViewData.ModelState.Clear();

   newCustomer = new Customer
   {
       FirstName = "",
       LastName = "Smith",
       Zip = "34275",    
   };

   controller.Create(newCustomer);

   // Make sure that our validation found the error!
   Assert.IsTrue(controller.ViewData.ModelState.Count == 1, 
                 "FirstName must be required."); 
```

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2011-04-07T11:33:28.753

```
//[Required]
//public string Name { get; set; }
//[Required]
//public string Description { get; set; }

ProductModelEdit model = new ProductModelEdit() ;
//Init ModelState
var modelBinder = new ModelBindingContext()
{
    ModelMetadata = ModelMetadataProviders.Current.GetMetadataForType(
                      () => model, model.GetType()),
    ValueProvider=new NameValueCollectionValueProvider(
                        new NameValueCollection(), CultureInfo.InvariantCulture)
};
var binder=new DefaultModelBinder().BindModel(
                 new ControllerContext(),modelBinder );
ProductController.ModelState.Clear();
ProductController.ModelState.Merge(modelBinder.ModelState);

ViewResult result = (ViewResult)ProductController.CreateProduct(null,model);
Assert.IsTrue(result.ViewData.ModelState["Name"].Errors.Count > 0);
Assert.True(result.ViewData.ModelState["Description"].Errors.Count > 0);
Assert.True(!result.ViewData.ModelState.IsValid); 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2016-07-10T06:12:06.947

要测试 Web API，请在控制器上使用[Validate](https://msdn.microsoft.com/en-us/library/system.web.http.apicontroller.validate(v=vs.118).aspx)方法：

```
var controller = new MyController();
controller.Configuration = new HttpConfiguration();
var model = new MyModel();

controller.Validate(model);
var result = controller.MyMethod(model); 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2018-03-20T20:14:40.130

遇到.NetCore 2.1的这个问题这是我的解决方案：

**扩展方法**

```
using Microsoft.AspNetCore.Mvc;
using System.Collections.Generic;
using System.ComponentModel.DataAnnotations;
using System.Linq;

namespace MyExtension
{
    public static void BindViewModel<T>(this Controller controller, T model)
    {
        if (model == null) return;

        var context = new ValidationContext(model, null, null);
        var results = new List<ValidationResult>();

        if (!Validator.TryValidateObject(model, context, results, true))
        {
            controller.ModelState.Clear();
            foreach (ValidationResult result in results)
            {
                var key = result.MemberNames.FirstOrDefault() ?? "";
                controller.ModelState.AddModelError(key, result.ErrorMessage);
            }
        }
    }
} 
```

**查看模型**

```
public class MyViewModel
{
    [Required]
    public string Name { get; set; }
} 
```

**单元测试**

```
public async void MyUnitTest()
{
    // helper method to create instance of the Controller
    var controller = this.CreateController();

    var model = new MyViewModel
    {
        Name = null
    };

    // here we call the extension method to validate the model
    // and set the errors to the Controller's ModelState
    controller.BindViewModel(model);

    var result = await controller.ActionName(model);

    Assert.NotNull(result);
    var viewResult = Assert.IsType<BadRequestObjectResult>(result);
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2018-10-02T15:25:51.927

这不仅可以让您检查错误是否存在，还可以检查它是否具有与预期完全相同的错误消息。例如，这两个参数都是必需的，因此它们的错误消息显示为“必需”。

模型标记：

```
//[Required]
//public string Name { get; set; }
//[Required]
//public string Description { get; set; } 
```

单元测试代码：

```
ProductModelEdit model = new ProductModelEdit() ;
//Init ModelState
var modelBinder = new ModelBindingContext()
{
    ModelMetadata = ModelMetadataProviders.Current.GetMetadataForType(
                      () => model, model.GetType()),
    ValueProvider=new NameValueCollectionValueProvider(
                        new NameValueCollection(), CultureInfo.InvariantCulture)
};
var binder=new DefaultModelBinder().BindModel(
                 new ControllerContext(),modelBinder );
ProductController.ModelState.Clear();
ProductController.ModelState.Merge(modelBinder.ModelState);

ViewResult result = (ViewResult)ProductController.CreateProduct(null,model);
Assert.IsTrue(!result.ViewData.ModelState.IsValid);
//Make sure Name has correct errors
Assert.IsTrue(result.ViewData.ModelState["Name"].Errors.Count > 0);
Assert.AreEqual(result.ViewData.ModelState["Name"].Errors[0].ErrorMessage, "Required");
//Make sure Description has correct errors
Assert.IsTrue(result.ViewData.ModelState["Description"].Errors.Count > 0);
Assert.AreEqual(result.ViewData.ModelState["Description"].Errors[0].ErrorMessage, "Required"); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-06-02T16:06:14.620

除了上面的出色答案之外，请查看 Controller 类中受保护的 TryValidateModel 方法的奇妙使用。

只需创建一个从控制器继承的测试类并将您的模型传递给 TryValidateModel 方法。这是链接： [http ://blog.icanmakethiswork.io/2013/03/unit-testing-modelstate.html](http://blog.icanmakethiswork.io/2013/03/unit-testing-modelstate.html)

此解决方案的全部功劳归于 John Reilly 和 Marc Talary。

# html - 从控制器内部获取部分视图的 HTML

> ID：286132
> 
> 赞同：28
> 
> 时间：2008-11-13T02:53:54.847
> 
> 标签：html, asp.net-mvc, viewusercontrol

我为我的 mvc 网站开发了一个简单的机制，通过 jquery 拉入 html，然后填充指定的 div。一切都很好，看起来很酷。
我的问题是我现在在我的控制器内创建 html 标记（这在 VB.net 中很容易做到）我宁愿不混淆关注点的分离。

是否可以使用自定义的“MVC 视图用户控件”来满足这种需求？我可以创建一个控件实例，传入模型数据并渲染到 html 吗？这将是一个简单的渲染和传递回调用浏览器的问题。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-06-27T12:57:23.223

这是一个与 ASP.Net MVC 1.0 一起使用的解决方案（许多声称与 beta 3 一起使用但不适用于 1.0 的解决方案），不受“发送 HTTP 标头后服务器无法设置内容类型”问题的影响并且可以从控制器（不仅是视图）中调用：

```
/// <summary>
/// Render a view into a string. It's a hack, it may fail badly.
/// </summary>
/// <param name="name">Name of the view, that is, its path.</param>
/// <param name="data">Data to pass to the view, a model or something like that.</param>
/// <returns>A string with the (HTML of) view.</returns>
public static string RenderPartialToString(string controlName, object viewData) {
    ViewPage viewPage = new ViewPage() { ViewContext = new ViewContext() };
    viewPage.Url = GetBogusUrlHelper();

    viewPage.ViewData = new ViewDataDictionary(viewData);
    viewPage.Controls.Add(viewPage.LoadControl(controlName));

    StringBuilder sb = new StringBuilder();
    using (StringWriter sw = new StringWriter(sb)) {
        using (HtmlTextWriter tw = new HtmlTextWriter(sw)) {
            viewPage.RenderControl(tw);
        }
    }

    return sb.ToString();
}

public static UrlHelper GetBogusUrlHelper() {
  var httpContext = HttpContext.Current;

  if (httpContext == null) {
    var request = new HttpRequest("/", Config.Url.ToString(), "");
    var response = new HttpResponse(new StringWriter());
    httpContext = new HttpContext(request, response);
  }

  var httpContextBase = new HttpContextWrapper(httpContext);
  var routeData = new RouteData();
  var requestContext = new RequestContext(httpContextBase, routeData);

  return new UrlHelper(requestContext);
} 
```

这是一种静态方法，您可以将其放在您认为方便的地方。你可以这样称呼它：

```
string view = RenderPartialToString("~/Views/Controller/AView.ascx", someModelObject); 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-16T23:26:03.183

我整理了一个粗略的框架，它允许您从 MVC Beta 中的控制器方法将视图呈现为字符串。这应该有助于解决这个限制。

此外，我还为 MVC Beta 编写了一个类似 Rails 的 RJS javascript 生成框架。

[在http://www.brightmix.com/blog/how-to-renderpartial-to-string-in-asp-net-mvc](http://www.brightmix.com/blog/how-to-renderpartial-to-string-in-asp-net-mvc)查看它，让我知道你的想法。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-13T06:36:32.387

你会像这样创建你的动作：

```
 public PartialViewResult LoginForm()
        {
            var model = // get model data from somewhere
            return PartialView(model);
        }
```

并且该操作会将呈现的部分视图返回到您的 jquery 响应。

您的 jquery 可能看起来像这样：

```
$('#targetdiv').load('/MyController/LoginForm',function(){alert('complete!');});
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-11-13T09:32:02.297

您应该使用 jquery 来填充您的 div（并在需要时创建新的 html 元素），以及 ActionResult 的 Json 序列化。

另一种方法是使用 jquery 来调用一些控制器/动作，但 json 使用常规视图（aspx 或 ascx，webforms 视图引擎）来呈现内容，并且使用 jquery 只需将该 html 注入某个 div。这是从 asp.net ajax 到 UpdatePanels 的一半...

我可能会使用第一种方法，使用 json，在那里你几乎没有什么工作要做，但它更加“优化”，因为你不会通过网络传输整个 html，只有序列化的对象。这是“大人物”（gmail、g docs、hotmail、..）这样做的方式——大量使用 UI 操作的 JS 代码。

如果你不需要ajax，那么你基本上有两种调用局部视图的方法：

*   html.renderpartial("ascx 的名称")
*   html.RenderAction(x=>x.ActionName) 来自 Microsoft.web.mvc（mvc 期货）

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-11-13T05:16:27.367

在谷歌大量挖掘之后，我找到了答案。您无法轻松访问视图输出的 html。

[http://ayende.com/Blog/archive/2008/11/11/another-asp.net-mvc-bug-rendering-views-to-different-output-source.aspx](http://ayende.com/Blog/archive/2008/11/11/another-asp.net-mvc-bug-rendering-views-to-different-output-source.aspx)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-07-21T05:01:03.663

我为我正在开发的应用程序做了类似的事情。我有返回渲染内容的部分视图，可以使用它们的 REST 路径或使用：

```
<% Html.RenderAction("Action", "Controller"); %> 
```

然后在我的实际显示 HTML 中，我有一个由 jQuery 填充的 DIV：

```
<div class="onload">/controller/action</div> 
```

jQuery 看起来像这样：

```
<script type="text/javascript">
    $.ajaxSetup({ cache: false });

    $(document).ready(function () {
        $('div.onload').each(function () {
            var source = $(this).html();
            if (source != "") {
                $(this).load(source);
            }
        });
    });
</script> 
```

这会扫描与“onload”类匹配的所有 DIV，并从其内容中读取 REST 路径。然后它在那个 REST 路径上执行 jQuery.load 并用结果填充 DIV。

抱歉得赶我回家的车。如果您想让我详细说明，请告诉我。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-17T01:16:17.407

你有几个选择。

在控制器中为视图创建一个 MVC 视图用户控件和操作处理程序。渲染视图使用

```
<% Html.RenderPartial("MyControl") %> 
```

在这种情况下，您的操作处理程序需要将模型数据传递给视图

```
public ActionResult MyControl ()
{
    // get modelData

    render View (modelData);
} 
```

您的另一个选择是从父页面传递模型数据。在这种情况下，您不需要操作处理程序，并且模型类型与父级相同：

```
<% Html.RenderPartial("MyControl", ViewData.Model) %> 
```

如果你的用户控件有它自己的数据类型，你也可以在页面中构造它

在 MyControl.ascx.cs 中：

```
public class MyControlViewData
{
    public string Name { get; set; }
    public string Email { get; set; }
}

public partial class MyControl : System.Web.Mvc.ViewUserControl <MyControlViewData>
{
} 
```

在您的页面中，您可以初始化控件的数据模型：

```
<% Html.RenderPartial("MyControl", new MyControlViewData ()
   {
        Name= ViewData.Model.FirstName,
        Email = ViewData.Model.Email,
   });
 %> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-13T03:27:38.147

在 Rails 中，这称为渲染局部视图，您可以使用`render :partial => 'yourfilename'`. 我相信 ASP.NET MVC 有类似的`RenderPartial`方法，但我找不到 MVC 的官方文档来确认或否认这样的事情。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-01-11T18:22:53.407

这非常简单，您只需创建一个强类型的局部视图（或用户控件），然后在您的控制器中像这样：

```
public PartialViewResult yourpartialviewresult()
{
    var yourModel
    return PartialView("yourPartialView", yourModel);
} 
```

那么您可以随时使用 JQuery 执行请求：

```
$.ajax({
    type: 'GET',
    url: '/home/yourpartialviewresult',
    dataType: 'html', //be sure to use html dataType
    contentType: 'application/json; charset=utf-8',
    success: function(data){
         $(container).html(data);
    },
    complete: function(){ }
 }); 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-08-08T17:50:24.253

我发现这一行代码可以完美运行。orderModel 是我的模型对象。就我而言，我有一个辅助方法，我必须在其中合并部分视图的 html。

```
System.Web.Mvc.Html.PartialExtensions.Partial(html, "~/Views/Orders/OrdersPartialView.cshtml", orderModel).ToString(); 
```

# javascript - 从 Javascript 中的对象中删除空白属性

> ID：286141
> 
> 赞同：415
> 
> 时间：2008-11-13T03:02:13.037
> 
> 标签：javascript

如何删除JavaScript 对象中的所有属性`undefined`？`null`

（问题与数组[类似）](https://stackoverflow.com/questions/208105/how-to-remove-a-property-from-a-javascript-object)

* * *

## 回答 #1

> 赞同：715
> 
> 时间：2016-07-13T00:12:26.760

### ES10/ES2019 示例

一个简单的单行（返回一个新对象）。

```
let o = Object.fromEntries(Object.entries(obj).filter(([_, v]) => v != null)); 
```

和上面一样，但是写成一个函数。

```
function removeEmpty(obj) {
  return Object.fromEntries(Object.entries(obj).filter(([_, v]) => v != null));
} 
```

此函数使用*递归*从嵌套对象中删除项目。

```
function removeEmpty(obj) {
  return Object.fromEntries(
    Object.entries(obj)
      .filter(([_, v]) => v != null)
      .map(([k, v]) => [k, v === Object(v) ? removeEmpty(v) : v])
  );
} 
```

### ES6/ES2015 示例

一个简单的单线。警告：这会改变给定对象而不是返回一个新对象。

```
Object.keys(obj).forEach((k) => obj[k] == null && delete obj[k]); 
```

单个声明（不改变给定对象）。

```
let o = Object.keys(obj)
  .filter((k) => obj[k] != null)
  .reduce((a, k) => ({ ...a, [k]: obj[k] }), {}); 
```

和上面一样，但是写成一个函数。

```
function removeEmpty(obj) {
  return Object.entries(obj)
    .filter(([_, v]) => v != null)
    .reduce((acc, [k, v]) => ({ ...acc, [k]: v }), {});
} 
```

此函数使用递归从嵌套对象中删除项目。

```
function removeEmpty(obj) {
  return Object.entries(obj)
    .filter(([_, v]) => v != null)
    .reduce(
      (acc, [k, v]) => ({ ...acc, [k]: v === Object(v) ? removeEmpty(v) : v }),
      {}
    );
} 
```

与上面的函数相同，但以命令式（非函数式）风格编写。

```
function removeEmpty(obj) {
  const newObj = {};
  Object.entries(obj).forEach(([k, v]) => {
    if (v === Object(v)) {
      newObj[k] = removeEmpty(v);
    } else if (v != null) {
      newObj[k] = obj[k];
    }
  });
  return newObj;
} 
```

### ES5/ES2009 示例

在过去，事情要冗长得多。

这是一个以函数式风格编写的非递归版本。

```
function removeEmpty(obj) {
  return Object.keys(obj)
    .filter(function (k) {
      return obj[k] != null;
    })
    .reduce(function (acc, k) {
      acc[k] = obj[k];
      return acc;
    }, {});
} 
```

这是一个以命令式风格编写的非递归版本。

```
function removeEmpty(obj) {
  const newObj = {};
  Object.keys(obj).forEach(function (k) {
    if (obj[k] && typeof obj[k] === "object") {
      newObj[k] = removeEmpty(obj[k]);
    } else if (obj[k] != null) {
      newObj[k] = obj[k];
    }
  });
  return newObj;
} 
```

以及以函数式风格编写的递归版本。

```
function removeEmpty(obj) {
  return Object.keys(obj)
    .filter(function (k) {
      return obj[k] != null;
    })
    .reduce(function (acc, k) {
      acc[k] = typeof obj[k] === "object" ? removeEmpty(obj[k]) : obj[k];
      return acc;
    }, {});
} 
```

* * *

## 回答 #2

> 赞同：263
> 
> 时间：2008-11-13T03:18:39.070

您可以遍历对象：

```
var test = {
  test1: null,
  test2: 'somestring',
  test3: 3,
}

function clean(obj) {
  for (var propName in obj) {
    if (obj[propName] === null || obj[propName] === undefined) {
      delete obj[propName];
    }
  }
  return obj
}

console.log(test);
console.log(clean(test));
```

如果您担心此属性删除不会运行对象的 proptype 链，您还可以：

```
function clean(obj) {
  var propNames = Object.getOwnPropertyNames(obj);
  for (var i = 0; i < propNames.length; i++) {
    var propName = propNames[i];
    if (obj[propName] === null || obj[propName] === undefined) {
      delete obj[propName];
    }
  }
} 
```

关于 null 与 undefined 的一些注意事项：

```
test.test1 === null; // true
test.test1 == null; // true

test.notaprop === null; // false
test.notaprop == null; // true

test.notaprop === undefined; // true
test.notaprop == undefined; // true 
```

* * *

## 回答 #3

> 赞同：185
> 
> 时间：2019-08-23T11:42:29.617

**ES6+ 最短的 1 行**

过滤所有虚假值 ( `""`, `0`, `false`, `null`, `undefined`)

```
Object.entries(obj).reduce((a,[k,v]) => (v ? (a[k]=v, a) : a), {}) 
```

过滤器`null`和`undefined`值：

```
Object.entries(obj).reduce((a,[k,v]) => (v == null ? a : (a[k]=v, a)), {}) 
```

仅过滤`null`

```
Object.entries(obj).reduce((a,[k,v]) => (v === null ? a : (a[k]=v, a)), {}) 
```

仅过滤`undefined`

```
Object.entries(obj).reduce((a,[k,v]) => (v === undefined ? a : (a[k]=v, a)), {}) 
```

**递归解决方案：**过滤器`null`和`undefined`

对于对象：

```
const cleanEmpty = obj => Object.entries(obj)
        .map(([k,v])=>[k,v && typeof v === "object" ? cleanEmpty(v) : v])
        .reduce((a,[k,v]) => (v == null ? a : (a[k]=v, a)), {}); 
```

对于对象和数组：

```
const cleanEmpty = obj => {
  if (Array.isArray(obj)) { 
    return obj
        .map(v => (v && typeof v === 'object') ? cleanEmpty(v) : v)
        .filter(v => !(v == null)); 
  } else { 
    return Object.entries(obj)
        .map(([k, v]) => [k, v && typeof v === 'object' ? cleanEmpty(v) : v])
        .reduce((a, [k, v]) => (v == null ? a : (a[k]=v, a)), {});
  } 
} 
```

* * *

## 回答 #4

> 赞同：122
> 
> 时间：2016-03-08T15:27:48.943

如果您使用的是 lodash 或 underscore.js，这里有一个简单的解决方案：

```
var obj = {name: 'John', age: null};

var compacted = _.pickBy(obj); 
```

这仅适用于 lodash 4、pre lodash 4 或 underscore.js，使用`_.pick(obj, _.identity)`;

* * *

## 回答 #5

> 赞同：40
> 
> 时间：2014-06-12T17:17:59.907

如果有人需要欧文（和埃里克）答案的递归版本，这里是：

```
/**
 * Delete all null (or undefined) properties from an object.
 * Set 'recurse' to true if you also want to delete properties in nested objects.
 */
function delete_null_properties(test, recurse) {
    for (var i in test) {
        if (test[i] === null) {
            delete test[i];
        } else if (recurse && typeof test[i] === 'object') {
            delete_null_properties(test[i], recurse);
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：33
> 
> 时间：2015-05-22T00:54:00.370

JSON.stringify 删除未定义的键。

```
removeUndefined = function(json){
  return JSON.parse(JSON.stringify(json))
} 
```

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2016-11-09T22:44:52.270

您可以使用`JSON.stringify`、其替换参数的组合，并将`JSON.parse`其转回对象。使用此方法还意味着对嵌套对象中的所有嵌套键进行替换。

**示例对象**

```
var exampleObject = {
  string: 'value',
  emptyString: '',
  integer: 0,
  nullValue: null,
  array: [1, 2, 3],
  object: {
    string: 'value',
    emptyString: '',
    integer: 0,
    nullValue: null,
    array: [1, 2, 3]
  },
  arrayOfObjects: [
    {
      string: 'value',
      emptyString: '',
      integer: 0,
      nullValue: null,
      array: [1, 2, 3]
    },
    {
      string: 'value',
      emptyString: '',
      integer: 0,
      nullValue: null,
      array: [1, 2, 3]
    }
  ]
}; 
```

**替代功能**

```
function replaceUndefinedOrNull(key, value) {
  if (value === null || value === undefined) {
    return undefined;
  }

  return value;
} 
```

**清洁对象**

```
exampleObject = JSON.stringify(exampleObject, replaceUndefinedOrNull);
exampleObject = JSON.parse(exampleObject); 
```

[代码笔示例](http://codepen.io/ajmueller/pen/gLaBLX "代码笔")

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2017-05-17T18:15:00.957

最简单的 Lodash 解决方案，用于返回过滤掉`null`和值的对象。`undefined`

`_.omitBy(obj, _.isNil)`

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2008-11-13T03:04:01.377

您可能正在寻找[`delete`](http://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Operators/Special_Operators/delete_Operator)关键字。

```
var obj = { };
obj.theProperty = 1;
delete obj.theProperty; 
```

* * *

## 回答 #10

> 赞同：11
> 
> 时间：2019-02-15T10:19:25.080

[您可以使用json.stringify 的 replacer 参数](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#The_replacer_parameter)在一行中进行递归删除

```
const removeEmptyValues = obj => (
  JSON.parse(JSON.stringify(obj, (k,v) => v ?? undefined))
) 
```

用法：

```
removeEmptyValues({a:{x:1,y:null,z:undefined}}) // Returns {a:{x:1}} 
```

正如 Emmanuel 的评论中提到的，这种技术只有在您的数据结构只包含可以放入 JSON 格式的数据类型（字符串、数字、列表等）时才有效。

（此答案已更新为使用新的[Nullish Coalescing 运算符](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing_operator)。根据浏览器支持需求，您可能希望使用此功能`(k,v) => v!=null ? v : undefined`：）

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2012-10-08T08:23:06.427

你可以在`!`有条件的情况下做得更短

```
var r = {a: null, b: undefined, c:1};
for(var k in r)
   if(!r[k]) delete r[k]; 
```

请记住用法：正如@semicolor 在评论中宣布的那样：*如果值为空字符串、false 或零，这也会删除属性*

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2016-11-28T12:39:22.833

使用[ramda#pickBy](http://ramdajs.com/docs/#pickBy)您将删除所有`null`,`undefined`和`false`值：

```
const obj = {a:1, b: undefined, c: null, d: 1}
R.pickBy(R.identity, obj) 
```

正如@manroe 指出的那样，要保持`false`价值观，请使用`isNil()`：

```
const obj = {a:1, b: undefined, c: null, d: 1, e: false}
R.pickBy(v => !R.isNil(v), obj) 
```

* * *

## 回答 #13

> 赞同：7
> 
> 时间：2017-11-09T15:04:05.317

我的项目中有相同的场景，并使用以下方法实现。

它适用于所有数据类型，上面很少提到不适用于日期和空数组。

**removeEmptyKeysFromObject.js**

```
removeEmptyKeysFromObject(obj) {
   Object.keys(obj).forEach(key => {
  if (Object.prototype.toString.call(obj[key]) === '[object Date]' && (obj[key].toString().length === 0 || obj[key].toString() === 'Invalid Date')) {
    delete obj[key];
  } else if (obj[key] && typeof obj[key] === 'object') {
    this.removeEmptyKeysFromObject(obj[key]);
  } else if (obj[key] == null || obj[key] === '') {
    delete obj[key];
  }

  if (obj[key]
    && typeof obj[key] === 'object'
    && Object.keys(obj[key]).length === 0
    && Object.prototype.toString.call(obj[key]) !== '[object Date]') {
    delete obj[key];
  }
});
  return obj;
}
```

将任何对象传递给此函数 removeEmptyKeysFromObject()

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2017-04-26T09:19:35.643

更短的 ES6 纯解决方案，将其转换为数组，使用过滤器功能并将其转换回对象。也很容易制作一个功能......

顺便提一句。有了这个`.length > 0`我检查是否有一个空字符串/数组，所以它会删除空键。

```
const MY_OBJECT = { f: 'te', a: [] }

Object.keys(MY_OBJECT)
 .filter(f => !!MY_OBJECT[f] && MY_OBJECT[f].length > 0)
 .reduce((r, i) => { r[i] = MY_OBJECT[i]; return r; }, {}); 
```

**JS BIN** [https://jsbin.com/kugoyinora/edit?js,console](https://jsbin.com/kugoyinora/edit?js,console)

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2019-05-27T11:34:46.617

功能性和不可变的方法，没有`.filter`和没有创建比需要更多的对象

```
Object.keys(obj).reduce((acc, key) => (obj[key] === undefined ? acc : {...acc, [key]: obj[key]}), {}) 
```

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2016-01-22T15:08:42.793

对于深度搜索，我使用了以下代码，也许它对任何查看这个问题的人都有用（它不适用于循环依赖）：

```
function removeEmptyValues(obj) {
        for (var propName in obj) {
            if (!obj[propName] || obj[propName].length === 0) {
                delete obj[propName];
            } else if (typeof obj[propName] === 'object') {
                removeEmptyValues(obj[propName]);
            }
        }
        return obj;
    } 
```

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2017-03-17T02:09:08.127

除了删除属性，您还可以使用非空键创建一个新对象。

```
const removeEmpty = (obj) => {
  return Object.keys(obj).filter(key => obj[key]).reduce(
    (newObj, key) => {
      newObj[key] = obj[key]
      return newObj
    }, {}
  )
} 
```

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2021-02-07T19:49:09.883

删除所有带有 null 和 undefined 的属性

```
let obj = {
"id": 1,
"firstName": null,
"lastName": null,
"address": undefined,
"role": "customer",
"photo": "fb79fd5d-06c9-4097-8fdc-6cebf73fab26/fc8efe82-2af4-4c81-bde7-8d2f9dd7994a.jpg",
"location": null,
"idNumber": null,
};

   let result =  Object.entries(obj).reduce((a,[k,v]) => (v == null ? a : (a[k]=v, a)), {});
console.log(result)
```

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2017-09-27T15:26:07.200

如果你想要 4 行纯 ES7 解决方案：

```
const clean = e => e instanceof Object ? Object.entries(e).reduce((o, [k, v]) => {
  if (typeof v === 'boolean' || v) o[k] = clean(v);
  return o;
}, e instanceof Array ? [] : {}) : e; 
```

或者，如果您更喜欢可读性更高的版本：

```
function filterEmpty(obj, [key, val]) {
  if (typeof val === 'boolean' || val) {
    obj[key] = clean(val)
  };

  return obj;
}

function clean(entry) {
  if (entry instanceof Object) {
    const type = entry instanceof Array ? [] : {};
    const entries = Object.entries(entry);

    return entries.reduce(filterEmpty, type);
  }

  return entry;
} 
```

这将保留布尔值，它也会清理数组。它还通过返回一个干净的副本来保留原始对象。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2016-04-12T16:30:17.570

要在[Ben 的](https://stackoverflow.com/a/35871405/1508105)关于如何使用 lodash's 解决此问题的答案上进行小猪包装`_.pickBy`，您还可以在姊妹库中解决此问题：[Underscore.js](http://underscorejs.org)的`_.pick`。

```
var obj = {name: 'John', age: null};

var compacted = _.pick(obj, function(value) {
  return value !== null && value !== undefined;
}); 
```

请参阅：[JSFiddle 示例](https://jsfiddle.net/96p3g9d0/6/)

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2017-03-13T02:09:35.627

如果您不想就地变异，而是返回一个删除了 null/undefined 的克隆，则可以使用 ES6 reduce 函数。

```
// Helper to remove undefined or null properties from an object
function removeEmpty(obj) {
  // Protect against null/undefined object passed in
  return Object.keys(obj || {}).reduce((x, k) => {
    // Check for null or undefined
    if (obj[k] != null) {
      x[k] = obj[k];
    }
    return x;
  }, {});
} 
```

* * *

## 回答 #22

> 赞同：3
> 
> 时间：2018-09-26T13:04:13.520

reduce 助手可以解决问题（无需类型检查） -

```
const cleanObj = Object.entries(objToClean).reduce((acc, [key, value]) => {
      if (value) {
        acc[key] = value;
      }
      return acc;
    }, {}); 
```

* * *

## 回答 #23

> 赞同：3
> 
> 时间：2020-05-13T07:04:55.447

这是一个全面的递归函数（最初基于@chickens 的函数），它将：

*   递归删除你告诉它的内容`defaults=[undefined, null, '', NaN]`
*   正确处理常规对象、数组和日期对象

```
const cleanEmpty = function(obj, defaults = [undefined, null, NaN, '']) {
  if (!defaults.length) return obj
  if (defaults.includes(obj)) return

  if (Array.isArray(obj))
    return obj
      .map(v => v && typeof v === 'object' ? cleanEmpty(v, defaults) : v)
      .filter(v => !defaults.includes(v))

  return Object.entries(obj).length 
    ? Object.entries(obj)
        .map(([k, v]) => ([k, v && typeof v === 'object' ? cleanEmpty(v, defaults) : v]))
        .reduce((a, [k, v]) => (defaults.includes(v) ? a : { ...a, [k]: v}), {}) 
    : obj
} 
```

用法：

```
// based off the recursive cleanEmpty function by @chickens. 
// This one can also handle Date objects correctly 
// and has a defaults list for values you want stripped.

const cleanEmpty = function(obj, defaults = [undefined, null, NaN, '']) {
  if (!defaults.length) return obj
  if (defaults.includes(obj)) return

  if (Array.isArray(obj))
    return obj
      .map(v => v && typeof v === 'object' ? cleanEmpty(v, defaults) : v)
      .filter(v => !defaults.includes(v))

  return Object.entries(obj).length 
    ? Object.entries(obj)
        .map(([k, v]) => ([k, v && typeof v === 'object' ? cleanEmpty(v, defaults) : v]))
        .reduce((a, [k, v]) => (defaults.includes(v) ? a : { ...a, [k]: v}), {}) 
    : obj
}

// testing

console.log('testing: undefined \n', cleanEmpty(undefined))
console.log('testing: null \n',cleanEmpty(null))
console.log('testing: NaN \n',cleanEmpty(NaN))
console.log('testing: empty string \n',cleanEmpty(''))
console.log('testing: empty array \n',cleanEmpty([]))
console.log('testing: date object \n',cleanEmpty(new Date(1589339052 * 1000)))
console.log('testing: nested empty arr \n',cleanEmpty({ 1: { 2 :null, 3: [] }}))
console.log('testing: comprehensive obj \n', cleanEmpty({
  a: 5,
  b: 0,
  c: undefined,
  d: {
    e: null,
    f: [{
      a: undefined,
      b: new Date(),
      c: ''
    }]
  },
  g: NaN,
  h: null
}))
console.log('testing: different defaults \n', cleanEmpty({
  a: 5,
  b: 0,
  c: undefined,
  d: {
    e: null,
    f: [{
      a: undefined,
      b: '',
      c: new Date()
    }]
  },
  g: [0, 1, 2, 3, 4],
  h: '',
}, [undefined, null]))
```

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2020-10-20T14:33:52.280

这是一个替代方案

打字稿：

```
function objectDefined <T>(obj: T): T {
  const acc: Partial<T> = {};
  for (const key in obj) {
    if (obj[key] !== undefined) acc[key] = obj[key];
  }
  return acc as T;
} 
```

Javascript：

```
function objectDefined(obj) {
  const acc = {};
  for (const key in obj) {
    if (obj[key] !== undefined) acc[key] = obj[key];
  }
  return acc;
} 
```

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2016-04-30T12:53:50.997

如果有人需要`undefined`使用深度搜索从对象中删除值，`lodash`那么这是我正在使用的代码。修改它以删除所有空值（`null`/ `undefined`）非常简单。

```
function omitUndefinedDeep(obj) {
  return _.reduce(obj, function(result, value, key) {
    if (_.isObject(value)) {
      result[key] = omitUndefinedDeep(value);
    }
    else if (!_.isUndefined(value)) {
      result[key] = value;
    }
    return result;
  }, {});
} 
```

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2017-03-07T21:23:05.597

使用 Lodash：

```
_.omitBy({a: 1, b: null}, (v) => !v) 
```

* * *

## 回答 #27

> 赞同：2
> 
> 时间：2017-07-06T04:10:35.427

如果您使用 eslint 并希望避免触发 no-param-reassign 规则，则可以将 Object.assign 与 .reduce 和计算属性名称结合使用，以获得相当优雅的 ES6 解决方案：

```
const queryParams = { a: 'a', b: 'b', c: 'c', d: undefined, e: null, f: '', g: 0 };
const cleanParams = Object.keys(queryParams) 
  .filter(key => queryParams[key] != null)
  .reduce((acc, key) => Object.assign(acc, { [key]: queryParams[key] }), {});
// { a: 'a', b: 'b', c: 'c', f: '', g: 0 } 
```

* * *

## 回答 #28

> 赞同：2
> 
> 时间：2018-07-30T18:27:17.213

这是一种`nulls`使用 ES6 从 Object 中删除而无需使用 only 改变对象的功能性方法`reduce`：

```
const stripNulls = (obj) => {
  return Object.keys(obj).reduce((acc, current) => {
    if (obj[current] !== null) {
      return { ...acc, [current]: obj[current] }
    }
    return acc
  }, {})
} 
```

* * *

## 回答 #29

> 赞同：2
> 
> 时间：2020-12-12T09:17:41.280

如果您对使用[Lodash 没问题](https://lodash.com/)，您可以添加[DeepDash](http://deepdash.io/)递归库并使用一些非常简洁的代码来实现您想要的：

```
const prune = obj => _.filterDeep(obj, (v) => !(_.isUndefined(v) || _.isNull(v))); 
```

调用`prune(anObjectWithNulls)`将返回没有`undefined`或`null`值的对象。

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2018-08-04T13:47:24.930

### 清洁物体到位

```
// General cleanObj function
const cleanObj = (valsToRemoveArr, obj) => {
   Object.keys(obj).forEach( (key) =>
      if (valsToRemoveArr.includes(obj[key])){
         delete obj[key]
      }
   })
}

cleanObj([undefined, null], obj) 
```

### 纯函数

```
const getObjWithoutVals = (dontReturnValsArr, obj) => {
    const cleanObj = {}
    Object.entries(obj).forEach( ([key, val]) => {
        if(!dontReturnValsArr.includes(val)){
            cleanObj[key]= val
        } 
    })
    return cleanObj
}

//To get a new object without `null` or `undefined` run: 
const nonEmptyObj = getObjWithoutVals([undefined, null], obj) 
```

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2018-10-16T08:30:50.423

您还可以使用类似这样的`...`扩展语法：`forEach`

```
let obj = { a: 1, b: "b", c: undefined, d: null };
let cleanObj = {};

Object.keys(obj).forEach(val => {
  const newVal = obj[val];
  cleanObj = newVal ? { ...cleanObj, [val]: newVal } : cleanObj;
});

console.info(cleanObj); 
```

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2019-05-11T19:12:48.033

递归删除 null、未定义、空对象和空数组，返回一个副本（ES6 版本）

```
export function skipEmpties(dirty) {
    let item;
    if (Array.isArray(dirty)) {
        item = dirty.map(x => skipEmpties(x)).filter(value => value !== undefined);
        return item.length ? item : undefined;
    } else if (dirty && typeof dirty === 'object') {
        item = {};
        Object.keys(dirty).forEach(key => {
            const value = skipEmpties(dirty[key]);
            if (value !== undefined) {
                item[key] = value;
            }
        });
        return Object.keys(item).length ? item : undefined;
    } else {
        return dirty === null ? undefined : dirty;
    }
} 
```

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2019-07-25T06:29:55.357

我们可以使用 JSON.stringify 和 JSON.parse 从对象中删除空白属性。

```
jsObject = JSON.parse(JSON.stringify(jsObject), (key, value) => {
               if (value == null || value == '' || value == [] || value == {})
                   return undefined;
               return value;
           }); 
```

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2020-07-07T07:55:04.983

这个问题已经得到了彻底的回答，我只想根据给出的其他示例贡献我的版本：

```
function filterObject(obj, filter) {
    return Object.entries(obj)
        .map(([key, value]) => {
            return [key, value && typeof value === 'object'
                ? filterObject(value, filter)
                : value];
        })
        .reduce((acc, [key, value]) => {
            if (!filter.includes(value)) {
                acc[key] = value;
            }

            return acc;
        }, {});
} 
```

该解决方案的不同之处在于能够在第二个参数中指定要过滤的值，如下所示：

```
const filtered = filterObject(originalObject, [null, '']); 
```

它将返回一个新对象（不改变原始对象），不包括值为`null`or的属性`''`。

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2021-10-08T14:54:14.203

使用空值合并可用 ES2020

```
const filterNullishPropertiesFromObject = (obj) => {
  const newEntries = Object.entries(obj).filter(([_, value]) => {
    const nullish = value ?? null;
    return nullish !== null;
  });

  return Object.fromEntries(newEntries);
}; 
```

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2018-12-17T23:19:07.927

如果您更喜欢纯/功能方法

```
const stripUndef = obj => 
  Object.keys(obj)
   .reduce((p, c) => ({ ...p, ...(x[c] === undefined ? { } : { [c]: x[c] })}), {}); 
```

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2019-01-31T07:57:50.450

如果您不想修改原始对象（使用一些 ES6 运算符）：

```
const keys = Object.keys(objectWithNulls).filter(key => objectWithNulls[key]);
const pairs = keys.map(key => ({ [key]: objectWithNulls[key] }));

const objectWithoutNulls = pairs.reduce((val, acc) => ({ ...val, ...acc })); 
```

`filter(key => objectWithNulls[key])`返回*任何真实*的值，因此将拒绝任何值，例如`0`or `false`，以及`undefined`or `null`。如果这是不需要的行为，可以很容易地更改为`filter(key => objectWithNulls[key] !== undefined)`或类似的东西。

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2020-03-27T13:49:30.973

如果您只想从对象中删除未定义的顶级属性，我发现这是最简单的：

```
const someObject = {
  a: null,
  b: 'someString',
  c: 3,
  d: undefined
};

for (let [key, value] of Object.entries(someObject)) {
  if (value === null || value === undefined) delete someObject[key];
}

console.log('Sanitized', someObject);
```

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2020-05-13T00:01:33.423

```
ES6 arrow function and ternary operator:
Object.entries(obj).reduce((acc, entry) => {
   const [key, value] = entry
  if (value !== undefined) acc[key] = value;
  return acc;
}, {})

```
 const obj = {test:undefined, test1:1 ,test12:0, test123:false};
    const newObj = Object.entries(obj).reduce((acc, entry) => {
       const [key, value] = entry
      if (value !== undefined) acc[key] = value;
      return acc;
    }, {})
    console.log(newObj)
``` 
```

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2020-06-16T10:40:28.730

删除空字段对象

```
for (const objectKey of Object.keys(data)) {
      if (data[objectKey] === null || data[objectKey] === '' || data[objectKey] === 'null' || data[objectKey] === undefined) {
        delete data[objectKey];
      }
    } 
```

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2021-08-20T13:49:12.590

```
function filterObject(obj) {
    for (var propName in obj) {
        if (!(obj[propName] || obj[propName] === false)) {
            delete obj[propName];
        }
    }

    return obj;
} 
```

**此函数还从对象中删除 NaN 值并且易于理解**

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2022-01-04T14:39:47.900

您可以使用[nullish 合并运算符执行此操作：??](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing_operator) 因为它只检查空值和未定义值。请注意，下面的示例更改了 obj 本身。它还删除嵌套对象的空值和未定义值。

```
const removeEmptyKeys = (obj) => {
    Object.entries(obj).forEach(([k, v]) => {
        (v ?? delete obj[k])
        if (v && typeof v === 'object') {
            removeEmptyKeys(v)
        }
    })
} 
```

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2022-01-08T06:26:28.533

这是一个超级干净的 Typescript 解决方案，使用`reduce`：

```
const removeUndefinedFields = <T>(obj: T): T =>
  Object.keys(obj).reduce(
    (acc, key) =>
      obj[key as keyof T] === undefined
        ? { ...acc }
        : { ...acc, [key]: obj[key as keyof T] },
    {} as T
  ) 
```

* * *

## 回答 #44

> 赞同：0
> 
> 时间：2022-01-19T13:02:18.337

这是一个递归的 ES6 实现，它也清理了属性的属性。这是一个无副作用的函数，这意味着它不会修改对象，因此必须使用返回对象。

```
function removeUndefinedProperties(obj) {
  return Object.keys(obj || {})
    .reduce((acc, key) => {
      const value = obj[key];
      switch (typeof value) {
        case 'object': {
          const cleanValue = removeUndefinedProperties(value); // recurse
          if (!Object.keys(cleanValue).length) {
            return { ...acc };
          }
          return { ...acc, [key]: cleanValue };
        }
        case 'undefined':
          return { ...acc };
        default:
          return { ...acc, [key]: value };
      }
    }, {});
} 
```

在 TypeScript 中，使用`unknown`如下方式输入：

```
function removeUndefinedProperties(obj: unknown): unknown {
  return Object.keys(obj ?? {})
    .reduce((acc, key) => {
      const value = obj[key];
      switch (typeof value) {
        case 'object': {
          const cleanValue = removeUndefinedProperties(value); // recurse
          if (!Object.keys(cleanValue).length) {
            return { ...acc };
          }
          return { ...acc, [key]: cleanValue };
        }
        case 'undefined':
          return { ...acc };
        default:
          return { ...acc, [key]: value };
      }
    }, {});
} 
```

* * *

## 回答 #45

> 赞同：0
> 
> 时间：2022-02-19T11:05:54.337

清除空数组、空对象、空字符串、未定义、NaN 和空值。

```
function objCleanUp(obj:any) {
  for (var attrKey in obj) {
    var attrValue = obj[attrKey];
    if (attrValue === null || attrValue === undefined || attrValue === "" || attrValue !== attrValue) {
      delete obj[attrKey];
    } else if (Object.prototype.toString.call(attrValue) === "[object Object]") {
      objCleanUp(attrValue);
      if(Object.keys(attrValue).length===0)delete obj[attrKey];
    } else if (Array.isArray(attrValue)) {
      attrValue.forEach(function (v,index) {
        objCleanUp(v);
        if(Object.keys(v).length===0)attrValue.splice(index,1);
      });
      if(attrValue.length===0)delete obj[attrKey];
    }
  }
}

objCleanUp(myObject) 
```

(attrValue !== attrValue) 检查 NaN。[在这里](https://stackoverflow.com/a/16988441/13860071)学到了

* * *

## 回答 #46

> 赞同：-1
> 
> 时间：2020-03-02T09:31:15.907

30 多个答案，但我没有看到这个简短的 ES6 单线，因为它`Object.assign()`是一个 vararg 函数，它会默默地忽略任何非对象（如`false`），利用扩展运算符。

```
Object.assign({}, ...Object.entries(obj).map(([k,v]) => v != null && {[k]: v])) 
```

* * *

## 回答 #47

> 赞同：-1
> 
> 时间：2021-10-26T15:57:25.040

这是我的chiken函数版本

这将从对象或对象数组中删除空字符串、未定义、null，并且不会影响 Date 对象

```
const removeEmpty = obj => {
   if (Array.isArray(obj)) {
      return obj.map(v => (v && !(v instanceof Date) && typeof v === 'object' ? removeEmpty(v) : v)).filter(v => v)
    } else {
      return Object.entries(obj)
        .map(([k, v]) => [k, v && !(v instanceof Date) && typeof v === 'object' ? removeEmpty(v) : v])
        .reduce((a, [k, v]) => (typeof v !== 'boolean' && !v ? a : ((a[k] = v), a)), {})
    }
  } 
```

# c# - 提交后禁用按钮

> ID：286149
> 
> 赞同：3
> 
> 时间：2008-11-13T03:07:04.790
> 
> 标签：c#, forms, button, submit

当用户提交付款表单并且发布表单的代码导致Firefox中的双重发布时，我正在尝试禁用按钮。删除代码时不会出现此问题，并且在firefox以外的任何浏览器中都不会出现。

知道如何防止这里出现双重帖子吗？

```
System.Text.StringBuilder sb = new StringBuilder();
sb.Append("if (typeof(Page_ClientValidate) == 'function') { ");
sb.Append("if (Page_ClientValidate() == false) { return false; }} ");
sb.Append("this.value = 'Please wait...';");
sb.Append("this.disabled = true;");
sb.Append(Page.GetPostBackEventReference(btnSubmit ));
sb.Append(";");
btnSubmit.Attributes.Add("onclick", sb.ToString()); 
```

这是导致问题的 sb.Append(Page.GetPostBackEventReference(btnSubmit )) 行

谢谢

编辑：这是按钮的 c#：

```
<asp:Button ID="cmdSubmit" runat="server" Text="Submit" /> 
```

这是 html

此代码发布两次（并禁用提交按钮并验证输入）：

```
<input type="submit" name="ctl00$MainContent$cmdSubmit" value="Submit" onclick="if (typeof(Page_ClientValidate) == 'function') { if (Page_ClientValidate() == false) { return false; }} this.value = 'Please wait...';this.disabled = true;document.getElementById('ctl00_MainContent_cmdBack').disabled = true;__doPostBack('ctl00$MainContent$cmdSubmit','');" id="ctl00_MainContent_cmdSubmit" /> 
```

此代码发布两次（但不禁用提交按钮）：

```
<input type="submit" name="ctl00$MainContent$cmdSubmit" value="Submit" onclick="__doPostBack('ctl00$MainContent$cmdSubmit','');" id="ctl00_MainContent_cmdSubmit" /> 
```

此代码发布一次（但不验证用户输入并且不禁用提交按钮）：

```
<input type="submit" name="ctl00$MainContent$cmdSubmit" value="Submit" id="ctl00_MainContent_cmdSubmit" /> 
```

此代码发布一次（但不禁用提交按钮）：

```
<input type="submit" name="ctl00$MainContent$cmdSubmit" value="Submit" onclick="javascript:WebForm_DoPostBackWithOptions(new WebForm_PostBackOptions(&quot;ctl00$MainContent$cmdSubmit&quot;, &quot;&quot;, true, &quot;&quot;, &quot;&quot;, false, false))" id="ctl00_MainContent_cmdSubmit" /> 
```

此代码根本不发布：

```
<input type="submit" name="ctl00$MainContent$cmdSubmit" value="Submit" onclick="this.disabled = true;WebForm_DoPostBackWithOptions(new WebForm_PostBackOptions(&quot;ctl00$MainContent$cmdSubmit&quot;, &quot;&quot;, true, &quot;&quot;, &quot;&quot;, false, false))" id="ctl00_MainContent_cmdSubmit" /> 
```

显然，是禁用提交按钮造成了问题。您对我们如何禁用提交以避免多次点击有任何想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T03:12:34.107

据推测，`btnSubmit`已经连接了一个服务器端事件。如果是这样，调用 to`Page.GetPostBackEventReference`应该是不必要的。您只需删除该行即可获得所需的行为。

更新：你提到在 C# 代码中附加事件处理程序，但你没有提到你在哪里做的。我猜它在`Page_Load`处理程序中。如果是这种情况，它将无法正常工作，因为此时连接按钮单击事件处理程序为时已晚。让我们试试这个。

首先，将 JS 放入它自己的函数中而不是在 C# 代码隐藏中构建它会更干净。我建议您将其放入脚本块中（或者更好的是，它是自己的 .js 文件。）

```
function disableOnSubmit(target)
{
    if (typeof(Page_ClientValidate) == 'function') {
        if (Page_ClientValidate() == false) { return false; }
    }
    target.value = 'Please wait...';
    target.disabled = true;
    return true;
} 
```

对于你的 ASPX 按钮，试试这个：

```
<asp:Button ID="cmdSubmit" runat="server" Text="Submit" onclick="btnSumbit_Click" OnClientClick="return disableOnSubmit(this);" /> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-30T11:14:59.910

答案是添加一个return false；在你的最后一行之后；

例如

```
sbValid.Append(this.Page.ClientScript.GetPostBackEventReference(button, "")); 
sbValid.Append(";"); 
```

一定是

```
 sbValid.Append(this.Page.ClientScript.GetPostBackEventReference(button, "")); 
 sbValid.Append(";return false;"); 
```

这绝对对我有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T03:13:41.233

去掉那一行，表单已经提交，因为它是一个提交按钮，而不是常规按钮类型，看看 ASP.NET 是如何呈现元素的。

页面验证器在 form.onsubmit 回调中调用，因此如果您的页面无效，它将在那里进行验证。

所以，只要删除那条线，你就会被设置。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-12-15T21:16:54.050

```
private void checkButtonDoubleClick(Button button)
    {
        System.Text.StringBuilder sbValid = new System.Text.StringBuilder();
        sbValid.Append("if (typeof(Page_ClientValidate) == 'function') { ");
        sbValid.Append("if (Page_ClientValidate() == false) { return false; }} ");
        sbValid.Append("this.value = 'Please wait...';");
        sbValid.Append("this.disabled = true;");
        sbValid.Append(this.Page.ClientScript.GetPostBackEventReference(button, ""));
        sbValid.Append(";return false;");
        button.Attributes.Add("onclick", sbValid.ToString());
    } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-06-09T13:06:58.370

试试下面的代码

```
<asp:Button ID="cmdSubmit" runat="server" Text="Submit" onclick="btnSumbit_Click" OnClientClick="this.style.display = 'none';"/> 
```

2021 年 10 月 9 日更新：-- 另一个更好的解决方案

```
<button type="button" class="btn btn-primary btn-lg " id="load1" data-loading-text="<i class='fa fa-circle-o-notch fa-spin'></i> Processing Order">Submit Order</button>

$('.btn').on('click', function() {
    var $this = $(this);
  $this.button('loading');
    setTimeout(function() {
       $this.button('reset');
   }, 8000);
}); 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2015-08-07T09:04:04.147

尝试这个：

```
<asp:Button ID="btn" runat="server" Text="something"  onclick="btn_Click" 
ValidationGroup="V1" onClientClick="if(Page_ClientValidate('V1'))
{this.disabled=true;this.value='Please Wait....';__doPostBack(this.id);}
"UseSubmitBehavior="false"  /> 
```

# python - 如何拆分网址

> ID：286150
> 
> 赞同：2
> 
> 时间：2008-11-13T03:08:26.050
> 
> 标签：python, string, url, split

所以我正在使用python对网页进行一些解析，我想将完整的网址分成两部分。假设我有地址[http://www.stackoverflow.com/questions/ask](http://www.stackoverflow.com/questions/ask)。我需要协议和域（例如[http://www.stackoverflow.com](http://www.stackoverflow.com)）和路径（例如 /questions/ask）。我认为这可以通过一些正则表达式来解决，但是我对此并不那么方便。有什么建议么？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-13T03:37:48.487

丹是对的：urlparse 是你的朋友：

```
>>> from urlparse import urlparse
>>>
>>> parts = urlparse("http://www.stackoverflow.com/questions/ask")
>>> parts.scheme + "://" + parts.netloc
'http://www.stackoverflow.com'
>>> parts.path
'/questions/ask' 
```

**注意**：在 Python 3 中是`from urllib.parse import urlparse`

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-13T03:13:00.877

使用 Python urlparse 模块：

[https://docs.python.org/library/urlparse.html](https://docs.python.org/library/urlparse.html)

对于这样一个定义明确且经过广泛传播的问题，不要费心编写自己的代码，更不用说自己的正则表达式了。它们造成了太多麻烦;-)。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-13T03:12:46.103

```
import re
url = "http://stackoverflow.com/questions/ask"
protocol, domain = re.match(r"(http://[^/]*)(.*)", url).groups() 
```

# java - 如何查看 int 数组中的元素是否为空？

> ID：286161
> 
> 赞同：9
> 
> 时间：2008-11-13T03:16:16.033
> 
> 标签：java, arrays

例子：

我想看看是否`array[5]`持有一个值或为空。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-13T03:20:42.560

原始数组中的元素不能为空。它们总是会被初始化为某些东西（通常`0`用于`int`数组，但取决于您如何声明数组）。

如果您像这样声明数组（例如）：

```
int [] myArray ;
myArray = new int[7] ; 
```

那么所有元素将默认为`0`.

声明数组的另一种语法是

```
int[] myArray = { 12, 7, 32, 15, 113, 0, 7 }; 
```

其中数组的初始值（在这种情况下为七）在花括号中给出`{}`。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-13T03:19:01.050

Java 数组中没有“空”元素这样的东西。如果数组的长度至少为 6，则元素 5 存在并且它有一个值。如果您没有为该位置分配任何其他内容，那么它将具有零值，就像对象的未初始化字段一样。

如果是后代数组`Object`，则可以检查元素是否等于`null`。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-13T03:23:10.123

您必须定义空的含义。根据数组的数据类型，您可以决定空的语义。例如，如果您有一个整数数组，您可以确定 0 为空。或者，如果数组是引用类型，那么您可以决定 null 为空。然后你只需通过比较 array[5] == null 或 array[5] == 0 等来检查。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T04:24:39.640

原始数组（int、float、char 等）永远不会“空”（我假设您的意思是“null”），因为原始数组元素永远不会为 null。

默认情况下，int 数组在分配时通常包含 0。但是，我从不依赖这个（我猜花了太多时间编写 C 代码）。

一种方法是选择一个您想要视为“未初始化”的值。它可以是 0 或 -1 或其他一些您不会用作有效值的值。分配后将数组初始化为该值。

对象数组（String[] 和任何扩展 Object 的对象数组）*可以*有 null 元素，因此您可以创建一个 Integer[] 数组并将其初始化为 null。我认为我更喜欢这个想法，而不是使用上面描述的魔法值。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-13T10:26:00.783

创建一个常量来定义空值，例如：

```
private static final int EMPTY = -1; 
```

然后像这样创建数组：

```
int[] myArray = new int[size];
Arrays.fill(myArray, EMPTY); 
```

然后检查元素是否为“空”，请执行以下操作：

```
if (myArray[i] == EMPTY)
{
   //element i is empty
} 
```

# agile - 如何在 BizTalk 中仍然使用 DDD、TDD？

> ID：286174
> 
> 赞同：2
> 
> 时间：2008-11-13T03:25:58.370
> 
> 标签：agile, domain-driven-design, biztalk, middleware, testdrivendesign

我刚开始在工作中接触 BizTalk，并希望继续使用我学到的关于 DDD、TDD 等的所有知识。这是否可能，或者我在创建管道和编排之类的东西时总是必须使用类似 Visio 的编辑器?

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T03:58:55.543

您当然可以将很多 TDD 和 DDD 的概念应用到 BizTalk 开发中。

您可以围绕域对象的概念进行设计和开发（尽管在 BizTalk 和集成开发中，我经常发现接口对象或契约优先设计是一种更有用的思维方式——什么消息在我的接口中传递）。您还可以遵循 TDD 的“构建最简单的可行的东西”和“只构建使测试通过的东西”的理念。

但是，您的问题听起来像是在询问更多关于这些设计和开发方法的以代码为中心的方面。

我是否正确，您希望能够遵循测试驱动的开发方法，首先编写一个运行需求并失败的 unti 测试，然后编写一个满足需求并导致测试通过的方法——所有这些都在传统的编程中像 C# 这样的语言？

不幸的是，答案是否定的。大多数 BizTalk 工件（管道、映射、编排......）只能使用 Visual Studio BizTalk 插件真正构建。有很多方法可以查看底层的 c# 代码，但永远不会想尝试直接开发此代码。

有两个工具[BizUnit](http://www.codeplex.com/bizunit)和[BizUnit Extensions](http://www.codeplex.com/bizunitextensions)提供了一些能力来控制 BizTalk 应用程序的执行和测试它们，但这实际上只能让您执行更多受控和更多测试驱动的集成测试。

您拖到编排设计图面上的形状在很大程度上只是作为一个不透明的执行单元来完成它们的工作。以及编排、管道、地图等……所有这些东西主要是为了在整个 BizTalk 解决方案中执行（和测试）。

良好的设计实践（从 TDD 等方法中获得指导）将导致将 BizTalk 解决方案分解为更小、更模块化和可测试的块，并且有一些方法可以单独测试管道之类的东西。

但遗憾的是，代码中 TDD 和 DDD 的详细细节没有翻译。

对于一些可能有用的相关讨论，请参阅此问题：

[模拟 Biztalk 请求-响应端口使用的 WebService](https://stackoverflow.com/questions/256897/mocking-webservice-consumed-by-a-biztalk-request-response-port#271044)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T12:54:22.007

如果您经常在 BizTalk 中使用管道和自定义管道组件，您可能会发现我自己的 PipelineTesting 库很有用。它允许您使用 NUnit（或您喜欢的任何其他测试框架）为完整的管道、特定的管道组件甚至模式（例如平面文件模式）创建自动化测试。

如果您使用这种功能，它非常有用，如果我自己可以这么说的话（我在自己的项目中大量使用它）。

您可以在[此处找到对该库的介绍，以及在](http://www.winterdom.com/weblog/2007/08/09/PipelineTesting11Released.aspx)[github](http://github.com/tomasr/pipelinetesting/)上的完整代码。[它的wiki](http://github.com/tomasr/pipelinetesting/wikis)上还有一些更详细的文档。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-23T19:49:59.917

我同意 CKarras 的评论。许多人认为这是他们不喜欢 BizUnit 框架的原因。但是看看 BizUnit 3.0。它有一个对象模型，允许您用 C#/VB 而不是 XML 编写整个测试步骤。BizUnitExtensions 也正在升级到新的对象模型。

基于 XML 的系统的优点是更容易生成测试步骤，更新步骤时无需重新编译。在我自己的扩展库中，我发现 XmlPokeStep（受 NAnt 启发）非常有用。我的团队可以即时更新测试步骤 xml。例如，假设我们必须调用一个创建客户记录的 Web 服务，然后检查数据库中的相同记录。现在，如果 Web 服务返回 ID（动态生成），我们可以即时更新下一步的测试步骤（当然不在同一个 xml 文件中），然后使用它来检查数据库。

从编码的角度来看，智能感知现在应该在 BizUnit 3.0 中得到解决。过去，缺少 XSD 确实让事情变得困难。我希望得到一个有助于智能感知的 XSD。旧版本的 BizUnit 也有一些片段，但这些片段尚未更新，也许如果有时间我会试一试。

但回到 TDD 问题，如果您了解 TDD 背后的一些意图 - 规范或行为驱动元素，那么您也可以在一定程度上将其应用于 Biztalk 开发，因为 BizTalk 很大程度上基于合同驱动的开发。因此，您可以先指定接口并创建存根编排等来处理它们，然后构建核心。那时您可以编写 BizUnit 测试。我希望有一些工具可以自动化这个过程，但现在还没有。

使用诸如 ESB 指南之类的框架还可以帮助您提供一个基础平台，以便您可以通过您的系统迭代地实现主要用例。

Just a few thoughts. Hope this helps. I think its worth blogging about more extensively. This is a good topic to discuss.Do ping me if you have any questions or we can always discuss more over here.

Rgds Benjy

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T04:12:35.513

您可以使用 BizUnit 在代码和 excel 中创建和重用通用测试用例（用于功能场景）

[http://www.codeplex.com/bizunit](http://www.codeplex.com/bizunit)

BizTalk Server 2009 有望具有更多的 IDE 集成可测试性。

干杯赫米尔。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T16:54:02.257

BizUnit 使用起来确实很痛苦，因为所有测试都是用 XML 而不是编程语言编写的。

在我们的项目中，我们将 BizUnit 的部分“移植”到了一个普通的旧 C# 测试框架。这允许我们直接在 C# NUnit/MSTest 代码中使用 BizUnit 的步骤库。这使得测试更容易编写（使用 VS Intellisense），更灵活，最重要的是，在测试失败的情况下更容易调试。这种方法的主要缺点是我们从主要的 BizUnit 源分叉。

对于未来的项目，我会考虑的另一个有趣的选择是[BooUnit](http://www.codeplex.com/BooUnit)，它是 BizUnit 之上的 Boo 包装器。它具有类似于我们的 BizUnit“端口”的优点，但也具有仍然使用 BizUnit 而不是从中分叉的优点。

# apache-flex - 如何限制树节点从 flex 3 中的当前节点拖出？

> ID：286179
> 
> 赞同：4
> 
> 时间：2008-11-13T03:28:25.387
> 
> 标签：apache-flex, tree

所以我有一个带有 xmllistcollection 的弹性树组件作为它的数据提供者。我希望能够通过拖放重新排列树中的树叶和树枝。我想将放置区域限制为被拖动项目的当前级别。像

```
      分支
       分支 0
         叶 1
         叶 2
       分支 x
         叶a
         叶b

```

因此，分支 x 不能移动到分支 0 下，叶 a 不能移动到分支 0 下。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-14T00:14:39.700

好的，这是一个非常简单的方法，基于[这篇 Flex 快速入门文章](http://www.adobe.com/devnet/flex/quickstart/working_with_tree/)中的最后一个示例。这应该可以通过使用“正确的”放置指示器（项目之间的线）而不是在拖动时仅选择鼠标下的项目来改进。

最相关的部分是`onDragOver()`方法，我们在其中限制可以丢弃项目的位置。

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml">
    <mx:Script>
        <![CDATA[

            import mx.events.DragEvent;
            import mx.managers.DragManager;
            import mx.core.DragSource;
            import mx.core.UIComponent;
            import mx.controls.Tree;

            private var _draggedItem:XML = null;

            private function onDragEnter( event:DragEvent ) : void
            {
                event.preventDefault();
                event.currentTarget.hideDropFeedback(event);

                var ds:DragSource = event.dragSource;
                var items:Array = ds.dataForFormat("treeItems") as Array;
                if (items != null && items.length > 0 && (items[0] is XML))
                    _draggedItem = items[0];

                DragManager.acceptDragDrop(UIComponent(event.currentTarget));
            }

            private function onDragOver( event:DragEvent ) : void
            {
                event.preventDefault();
                event.currentTarget.hideDropFeedback(event);

                tree.selectedIndex = tree.calculateDropIndex(event);
                var node:XML = tree.selectedItem as XML;

                // restrict drag & drop to nodes within same parent
                if (_draggedItem.parent() != node.parent())
                {
                    DragManager.showFeedback(DragManager.NONE);
                    return;
                }

                DragManager.showFeedback(DragManager.MOVE);
            }

            private function onDragDrop( event:DragEvent ) : void
            {
                event.preventDefault();
                event.currentTarget.hideDropFeedback(event);

                tree.selectedIndex = tree.calculateDropIndex(event);
                var node:XML = tree.selectedItem as XML;

                var addToIndex:int = node.childIndex();
                if ((_draggedItem.parent() == node.parent()) && (addToIndex != _draggedItem.childIndex()))
                {
                    tree.dataDescriptor.removeChildAt(node.parent(), _draggedItem, _draggedItem.childIndex());
                    tree.dataDescriptor.addChildAt(node.parent(), _draggedItem, addToIndex);
                }
            }

            private function onDragComplete( event:DragEvent ) : void
            {
                tree.selectedIndex = -1;
            }    
        ]]>
    </mx:Script>    
    <mx:XML id="treeData" xmlns="">
        <root>
            <node label="Massachusetts" type="state" data="MA">
                <node label="Boston" type="city" >
                    <node label="Smoke House Grill" type="restaurant" />
                    <node label="Equator" type="restaurant" />
                    <node label="Aquataine" type="restaurant" />
                    <node label="Grill 23" type="restaurant" />
                </node>
                <node label="Provincetown" type="city" >
                    <node label="Lobster Pot" type="restaurant" />
                    <node label="The Mews" type="restaurant" />
                </node>
            </node>
            <node label="California" type="state" data="CA">
                <node label="San Francisco" type="city" >
                    <node label="Frog Lane" type="restaurant" />
                </node>
            </node>
        </root>
    </mx:XML>
    <mx:Tree width="100%" height="100%" id="tree"
        labelField="@label"
        dataProvider="{treeData.node}"
        allowMultipleSelection="false"
        dragEnabled="true"
        dropEnabled="true"
        dragMoveEnabled="false"
        dragEnter="onDragEnter(event)"
        dragOver="onDragOver(event)"
        dragDrop="onDragDrop(event)"
        dragComplete="onDragComplete(event)">
    </mx:Tree>        
</mx:Application> 
```

# .net - Visual Studio 的 StyleCop 的替代品？

> ID：286180
> 
> 赞同：16
> 
> 时间：2008-11-13T03:29:17.957
> 
> 标签：.net, visual-studio, code-analysis, stylecop

我喜欢[StyleCop](http://code.msdn.microsoft.com/sourceanalysis)的静态代码分析和规则执行。然而，它在几个关键部门严重缺乏。

*   官方不支持添加新规则，据我所知，这很难。
*   自动“修复”琐碎的规则违规行为会很好！也许不是使用变量命名，而是使用方法排序（静态等），这将节省大量时间。
*   微软对 StyleCop 的“一刀切”方法有点限制性。我想为我们的内部标准制定一套自定义规则。

有这样的商业产品吗？

[替代文字 http://blogs.interakting.co.uk/images/blogs_interakting_co_uk/dominicz/WindowsLiveWriter/MicrosoftStyleCopSourcecodeanalysisforfo_D8EF/styleCopErrors_6.gif](http://blogs.interakting.co.uk/images/blogs_interakting_co_uk/dominicz/WindowsLiveWriter/MicrosoftStyleCopSourcecodeanalysisforfo_D8EF/styleCopErrors_6.gif)

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-14T00:04:28.303

添加规则已经或将要得到[官方支持](http://blogs.msdn.com/sourceanalysis/archive/2008/08/19/stylecop-4-3-is-released.aspx)：

> 正如承诺的那样，我们还将发布 StyleCop 的 SDK 文档，解释如何编写自定义规则以及如何将工具集成到自定义构建环境中。SDK 文档目前正在最终审核中，我们希望尽快发布。——[杰森·奥尔](http://blogs.msdn.com/sourceanalysis/archive/2008/08/19/stylecop-4-3-is-released.aspx)

就我们的“内部”风格而言，我通过禁用一些 StyleCop 规则非常接近：

*   文件头 (SA1633-SA-1640)
*   代码订购 (SA1200-SA1202)
*   需要“这个”（SA1101）

您可以通过修改安装目录中的 Settings.StyleCop 文件来全局执行此操作，尽管我采取的方法是在每个项目的源代码树的根目录中放置一个。

最终效果正是我们想要的。有一些“内部”选择可以很好地标记，但即使没有它们，StyleCop 也为我们提供了很多价值。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-04T12:44:20.260

[StyleCop for ReSharper](http://www.codeplex.com/StyleCopForReSharper)可以提供帮助（您需要购买 ReSharper，但该插件是免费的）：

> 用于 ReSharper 的 StyleCop 现在功能完整，已达到与 StyleCop 4.3 相同的功能。
> 
> 有 148 条 StyleCop 规则。
> 
> *   其中 38 个必须手动修复（通常是因为您必须输入描述性文本或重命名变量）。
> *   在剩余的 110 条规则中，有 58 条由 R# Code Cleanup（静默模式）修复。
> *   在剩下的 52 个中，我们有自动修复所有这些的代码清理规则。
> 
> 我们还提供了 106 个快速修复，为违反 110 条规则提供了上下文菜单修复，这些规则可以自动修复

我们还发布了“StyleCop 友好的 ReSharper 代码样式共享设置文件”，它将 ReSharper 配置为以 StyleCop 友好的方式自动格式化代码。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-13T10:59:10.890

Mono的[Gendarme](http://www.mono-project.com/Gendarme)是开源的，不是商业的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-13T16:48:16.403

[史密斯探员](https://code.google.com/p/agentsmithplugin/)很好。它需要 Resharper。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-10-19T13:17:59.980

*StyleCop*的替代或良好补充是使用商业工具[NDepend](http://www.ndepend.com/)。使用此工具，可以**在 LINQ 查询** [（即 CQLinq）](http://www.ndepend.com/Features.aspx#CQL)上编写代码规则。*免责声明：我是该工具的开发人员之一*

默认提出超过[200 条代码规则，包括](http://www.ndepend.com/DefaultRules/webframe.html)*设计*、*架构*、*代码质量*、*代码演化*、*命名约定*、*死代码*、*.NET Fx 使用*...

CQLinq 致力于编写可以[在 Visual Studio 中实时验证的](http://www.ndepend.com/Doc_VS_CQL.aspx)代码规则，或者可以[在构建过程中验证并在 HTML/javascript 报告中报告的](http://www.ndepend.com/Doc_CI_Report.aspx#CQLRule)代码规则。

CQLinq 优于 StyleCop 甚至 FxCop 的优势在于，**它可以直接编写代码规则**，并*立即*获得结果。建议使用设施来浏览匹配的代码元素。具体来说是这样的：

![CQLinq 代码规则](https://i.stack.imgur.com/OHPhy.png)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-13T16:41:01.567

我经常编写单元测试来反映我的类型并检查是否违反了我的自定义规则。

这是验证某些类型是否不可变的示例：http: [//blogs.msdn.com/kevinpilchbisson/archive/2007/11/20/enforcing-immutability-in-code.aspx](http://blogs.msdn.com/kevinpilchbisson/archive/2007/11/20/enforcing-immutability-in-code.aspx)

这是另一个关于单元测试命名的规则：http: [//jbazuzicode.blogspot.com/2008/11/keeping-test-fixture-and-class-names.html](http://jbazuzicode.blogspot.com/2008/11/keeping-test-fixture-and-class-names.html)

编辑：第二个链接似乎丢失了时间。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-11-13T16:57:53.577

看看来自[Submain](http://submain.com/?nav=products.cir)的 CodeIt.Right。

# c# - 如何捕获由于 USB 电缆拔出而消失的串行端口

> ID：286184
> 
> 赞同：7
> 
> 时间：2008-11-13T03:31:29.047
> 
> 标签：c#, winforms, serial-port

我有 ac# winforms 程序，它打开了一个串行端口。当最终用户拔下 USB 电缆然后设备消失时，就会出现问题。在此之后程序将崩溃并想向微软报告错误。

有没有办法捕捉这个事件并优雅地关闭？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-13T04:34:22.023

是的，有一种方法可以捕获事件。不幸的是，从设备被移除到程序收到任何通知的时间之间可能会有很长的延迟。

该方法是捕获 COM 端口事件（例如 ErrorReceived）并捕获 WM_DEVICECHANGE 消息。

不知道你的程序为什么会崩溃；您应该查看堆栈以了解发生这种情况的位置。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-03-12T08:02:55.157

您可以使用 WMI (Windows Management Instrumentation) 接收有关 USB 事件的通知。两年前我就是这样做的，监控特定 USB 设备的插拔。
不幸的是，代码留在我的前雇主那里，但我在[bytes.com](http://bytes.com/topic/net/answers/102489-how-detect-usb-device-being-plugged-unplugged)找到了一个示例：

```
using System;
using System.ComponentModel;
using System.Runtime.InteropServices;
using System.Management;
class UsbWatcher 
{
    public static void Main() 
    {
        WMIEvent wEvent = new WMIEvent();
        ManagementEventWatcher watcher = null;
        WqlEventQuery query;
        ManagementOperationObserver observer = new ManagementOperationObserver();

        ManagementScope scope = new ManagementScope("root\\CIMV2");
        scope.Options.EnablePrivileges = true; 
        try 
        {
            query = new WqlEventQuery();
            query.EventClassName = "__InstanceCreationEvent";
            query.WithinInterval = new TimeSpan(0,0,10);

            query.Condition = @"TargetInstance ISA 'Win32_USBControllerDevice' ";
            watcher = new ManagementEventWatcher(scope, query);

            watcher.EventArrived 
                += new EventArrivedEventHandler(wEvent.UsbEventArrived);
            watcher.Start();
        }
        catch (Exception e)
        {
            //handle exception
        }
} 
```

我不记得我是否修改了查询以仅接收特定设备的事件，或者我是否在事件处理程序中过滤掉了来自其他设备的事件。有关更多信息，您可能需要查看[MSDN WMI .NET 代码目录](http://msdn.microsoft.com/en-us/library/ms257338.aspx)。

**编辑** 我在事件处理程序上找到了更多信息，它看起来大致是这样的：

```
protected virtual void OnUsbConnected(object Sender, EventArrivedEventArgs Arguments)
{
    PropertyData TargetInstanceData = Arguments.NewEvent.Properties["TargetInstance"];

    if (TargetInstanceData != null)
    {
        ManagementBaseObject TargetInstanceObject = (ManagementBaseObject)TargetInstanceData.Value;
        if (TargetInstanceObject != null)
        {
            string dependent = TargetInstanceObject.Properties["Dependent"].Value.ToString();
            string deviceId = dependent.Substring(dependent.IndexOf("DeviceID=") + 10);

            // device id string taken from windows device manager
            if (deviceId = "USB\\\\VID_0403&PID_6001\\\\12345678\"")
            {
                // Device is connected
            }
        }
    }
} 
```

不过，您可能想要添加一些异常处理。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-08-25T10:32:40.187

在注册表中：
HKEY_LOCAL_MACHINE\HARDWARE\DEVICEMAP\SERIALCOMM
是端口的实际列表。如果您的端口消失，则表示它已被拔掉。

**真实示例：（**尝试移除您的 USB 并在注册表编辑器中按 F5）

```
Windows Registry Editor Version 5.00
HKEY_LOCAL_MACHINE\HARDWARE\DEVICEMAP\SERIALCOMM]
"Winachsf0"="COM10"
"\\Device\\mxuport0"="COM1"
"\\Device\\Serial2"="COM13" 
```

COM10 - 我的传真调制解调器
COM1 - **USB - moxa USB 串口转换器**
COM13 - **USB - Profilic 串口转换器**

问候

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-02-04T22:14:58.840

尽管已经给出的答案提供了一个很好的起点，但我想为 .net 4.5 添加一些工作示例，以及捕获一种*USB*设备的示例。

在 Treb 的回答中，他使用了`'Win32_USBControllerDevice'`. 这可能是也可能不是查询的最佳条件，具体取决于您要完成的任务。Win32_USBControllerDevice 中的设备 ID 对于每个设备都是唯一的。因此，如果您正在寻找标识单个设备的唯一 ID，那么这正是您想要的。但是，如果您正在寻找某种*类型*的设备，您可以使用`'Win32_PnPEntity'`和访问该`Description`属性。以下是通过描述获取某种*类型*设备的示例：

```
using System;
using System.ComponentModel.Composition;
using System.Management;

public class UsbDeviceMonitor
{
    private ManagementEventWatcher plugInWatcher;
    private ManagementEventWatcher unPlugWatcher;
    private const string MyDeviceDescription = @"My Device Description";

    ~UsbDeviceMonitor()
    {
        Dispose();
    }

    public void Dispose()
    {
        if (plugInWatcher != null)
            try
            {
                plugInWatcher.Dispose();
                plugInWatcher = null;
            }
            catch (Exception) { }

        if (unPlugWatcher == null) return;
        try
        {
            unPlugWatcher.Dispose();
            unPlugWatcher = null;
        }
        catch (Exception) { }
    }

    public void Start()
    {
        const string plugInSql = "SELECT * FROM __InstanceCreationEvent WITHIN 1 WHERE TargetInstance ISA 'Win32_PnPEntity'";
        const string unpluggedSql = "SELECT * FROM __InstanceDeletionEvent WITHIN 1 WHERE TargetInstance ISA 'Win32_PnPEntity'";

        var scope = new ManagementScope("root\\CIMV2") {Options = {EnablePrivileges = true}};

        var pluggedInQuery = new WqlEventQuery(plugInSql);
        plugInWatcher = new ManagementEventWatcher(scope, pluggedInQuery);
        plugInWatcher.EventArrived += HandlePluggedInEvent;
        plugInWatcher.Start();

        var unPluggedQuery = new WqlEventQuery(unpluggedSql);
        unPlugWatcher = new ManagementEventWatcher(scope, unPluggedQuery);
        unPlugWatcher.EventArrived += HandleUnPluggedEvent;
        unPlugWatcher.Start();
    }

    private void HandleUnPluggedEvent(object sender, EventArrivedEventArgs e)
    {
        var description = GetDeviceDescription(e.NewEvent);
        if (description.Equals(MyDeviceDescription))
            // Take actions here when the device is unplugged
    }

    private void HandlePluggedInEvent(object sender, EventArrivedEventArgs e)
    {
        var description = GetDeviceDescription(e.NewEvent);
        if (description.Equals(MyDeviceDescription))
            // Take actions here when the device is plugged in
    }

    private static string GetDeviceDescription(ManagementBaseObject newEvent)
    {
        var targetInstanceData = newEvent.Properties["TargetInstance"];
        var targetInstanceObject = (ManagementBaseObject) targetInstanceData.Value;
        if (targetInstanceObject == null) return "";

        var description = targetInstanceObject.Properties["Description"].Value.ToString();
        return description;
    }
} 
```

一些可能有助于研究在 sql 语句中使用哪些类的链接：

[Win32 类](http://msdn.microsoft.com/en-us/library/aa394084%28v=vs.85%29.aspx)- 在上面的示例中，`'Win32_PnPEntity'`使用了该类。

[WMI 系统类](http://msdn.microsoft.com/en-us/library/aa394583%28v=vs.85%29.aspx)- 在上面的示例中，使用了`__InstanceCreationEvent`和`__InstanceDeletionEvent`类。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-03-11T07:37:04.163

你可以尝试处理`ErrorReceived`。

```
private void buttonStart_Click(object sender, EventArgs e)
{
    port.ErrorReceived += new System.IO.Ports.SerialErrorReceivedEventHandler(port_ErrorReceived);
}

void port_ErrorReceived(object sender, System.IO.Ports.SerialErrorReceivedEventArgs e)
{
    // TODO: handle the problem here
} 
```

此外，您可以在继续之前检查端口是否存在。您可能想不时检查一下，也许就在读/写之前。

```
string[] ports = System.IO.Ports.SerialPort.GetPortNames();
if (ports.Contains("COM7:"))
{
    // TODO: Can continue
}
else
{
    // TODO: Cannot, terminate properly
} 
```

您还应该`try-catch`为所有串行端口操作放置块。它应该有助于防止意外终止。

您可能想尝试在 IDE 下以调试模式运行应用程序并模拟错误。如果抛出异常，您将能够确定问题在哪里变得最明显。从那里，您可能会尝试找到更具体的解决方案。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-13T03:48:09.200

如果您的 try 语句没有捕获异常，那么我们希望 Microsoft 会检查转储。

有一些 SetupDi API（我认为......已经有一段时间了）允许您被告知设备到达和移除，但如果您已经崩溃，因为移除的设备在您的读取过程中或写操作。

# php - 将代码与数据库功能分离

> ID：286187
> 
> 赞同：8
> 
> 时间：2008-11-13T03:33:51.147
> 
> 标签：php, database

我现在正在开发一个面向对象的 PHP 网站，并试图确定从系统的其余部分抽象数据库功能的最佳方法。现在，我有一个 DB 类来管理系统使用的所有连接和查询（它几乎是 MDB2 的接口）。然而，当使用这个系统时，我意识到我的代码中到处都出现了很多 SQL 查询字符串。例如，在我的 User 类中，我有这样的东西：

```
function checkLogin($email,$password,$remember=false){
    $password = $this->__encrypt($password);
    $query = "SELECT uid FROM Users WHERE email=? AND pw=?";

    $result = $this->db->q($query,array($email,$password));

    if(sizeof($result) == 1){
       $row = $result->fetchRow(MDB2_FETCHMODE_ASSOC);
       $uid = $row['uid'];
    }else{
       return false;
    }

    /* Rest of the login script */
} 
```

我想做的是找出减少内联 SQL 数量的最佳技术。我知道这样做的一种方法是在 User 中为 User 使用的每个查询编写函数（如下所示），但这可能会导致很多函数。

```
function checkLogin($email,$password,$remember=false){
    $password = $this->__encrypt($password);
    $uid = $this->do_verify_login_query($email,$password);

    /* Rest of the login script */
}

function do_verify_login_query($email,$encpw){
    $query = "SELECT uid FROM Users WHERE email=? AND pw=?";
    $result = $this->$db->q($query,array($email,$encpw));

    if(sizeof($result) == 1){
       $row = $result->fetchRow(MDB2_FETCHMODE_ASSOC);
       return $row['uid'];
    }else{
       return false;
    }
} 
```

所以……我的问题。管理典型数据库应用程序将使用的大量查询的最佳技术是什么？我描述的方式会是处理这种情况的正确方式吗？或者如何在 DB 类中注册一个查询列表，并为每个查询关联一个唯一 ID（例如 USER_CHECKLOGIN），该 ID 被传递到 DB 的查询函数中？此方法还有助于提高安全性，因为它将可以运行的查询限制为仅在此列表中注册的查询，但在编写所有类函数时要记住另一件事。想法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-13T03:47:26.080

将 SQL 提取到单独的函数中是一个不错的开始。你可以做的其他一些事情：

*   为数据库访问代码创建单独的类。这将有助于确保您的所有 PHP 文件中没有散布的 SQL 函数。
*   从外部文件加载 SQL。这将您的 SQL 代码和 PHP 代码完全分开，使两者更易于维护。
*   尽可能使用存储过程。这从您的 PHP 代码中完全删除了 SQL，并通过降低执行外部 SQL 的风险来帮助提高您的数据库安全性。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-13T03:49:21.693

您可能想研究实现[ActiveRecord 模式](http://en.wikipedia.org/wiki/Active_record_pattern)。使用这样的设计模式可以在处理表中数据的方式上提供一些一致性。这些方法可能有一些缺点，主要是某些类型的查询的性能，但它可以解决。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-13T04:05:21.317

另一种选择是使用 ORM，对于 PHP，最强大的是：

*   [推进](http://propel.phpdb.org/trac/)
*   [教义](http://www.doctrine-project.org/)

两者都允许您使用一组对象访问数据库，提供用于存储和查询数据的简单 API，两者都有自己的查询语言，在内部转换为目标 DBMS 本机 SQL，这将简化从一个 RDBMS 迁移应用程序到另一个具有简单的配置更改。我也喜欢这样一个事实，即您可以封装数据模型逻辑以添加验证，例如，仅通过扩展您的模型类。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-13T16:47:13.007

既然您说您是作为 OO PHP 执行此操作的，那么为什么首先将 SQL 分散在所有方法中？更常见的模型是：

1.  使用 ORM 并让它处理数据库。
2.  为您的类提供一个或多个“加载”方法，该方法使用单个查询将所有对象的数据拉入内存，并提供一个“保存”方法，该方法使用单个查询来更新数据库中的所有内容。所有其他方法只需要进行内存操作，数据库交互仅限于加载/保存方法。

第一个选项通常会更健壮，但与您习惯的做事方式相比，第二个选项可能运行得更快，并且可能会感觉更熟悉，如果其中任何一个是问题的话。

对于您的登录示例，我将这样做的方式是简单地通过电子邮件地址加载用户， call `$user->check_password($entered_password)`，然后抛出异常/返回 false/如果`check_password`失败。任何登录处理代码都不`check_password`需要关心数据库，甚至不需要知道数据库是加载用户的地方。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T17:57:18.980

另一种选择是将查询视为数据并将它们存储在数据库中。例如，您可以创建一个存储带有名称的查询的表和存储该查询参数的另一个表。然后在 PHP 中创建一个函数，该函数接受查询的名称和参数数组并执行查询，返回任何结果。您还可以将其他元数据附加到查询中以限制对某些用户的访问，对结果应用后置函数等。

# vb.net - 使用 SQLDataReader 对象时关闭 SQLConnection 对象的重要性

> ID：286190
> 
> 赞同：0
> 
> 时间：2008-11-13T03:35:32.563
> 
> 标签：vb.net, generics, ado.net, sqlconnection.close

我目前的合同约定是在一家大型电子商务公司工作。他们的代码库起源于 .Net 1.0，令我惊讶的是，其中包含的许多问题超出了我上次的废话水平。

尽管如此，并试图分散我对它的干扰程度，我还是很高兴地尝试添加功能来解决其他问题或扩展更多废话。在我触摸 DAL/BLL 的地方，修复上述问题所需的时间就会完成。但是，我想从专家那里获得信任票，以确保不会浪费客户的时间，或者更糟的是，我的可信度会因触摸“有效的东西”而被否决。当然，单元测试会解决或至少减轻这种担忧。也许这也应该添加到 wtf.com？

```
Public Function GetSizeInfoBySite(ByVal siteID As String) As IList
    Dim strSQL As String = "YES INLINE SQL!! :)"
    Dim ci As CrapInfo
    Dim alAnArrayList As ArrayList

    Dim cn As New SqlConnection(ConfigurationSettings.AppSettings("ConnectionString"))
    Dim cmd As New SqlCommand(strSQL, cn)
    cmd.Parameters.Add(New SqlParameter("@MySiteID", SqlDbType.NVarChar, 2)).Value = siteID
    cn.Open()
    Dim rs As SqlDataReader = cmd.ExecuteReader(CommandBehavior.CloseConnection)
    While rs.Read()
        ci = New CategoryInfo(rs("someID"), rs("someName"))
        If IsNothing(alAnArrayList) Then
            alAnArrayList = New ArrayList
        End If
        alAnArrayList.Add(ci)
    End While
    rs.Close()
    Return CType(alAnArrayList, IList)
End Function 
```

除了让我的直觉搅动的内联 SQL 之外，还有人看到这个问题吗？至少您通常不会将上述内容包装在我们大多数人都知道自 .Net v1.0 以来一直存在的 try/catch/finally 中？更好的是用 Using 语句修复不是明智的吗？SQLDataReader close 是否真的封装了自动关闭的连接？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T03:53:16.833

如果用户输入被正确参数化，则内联 sql 没有任何问题，看起来就是这样。

除此之外，是的，您确实需要关闭连接。在一个繁忙的网站上，你可能会达到你的极限，这会导致各种奇怪的事情。

我还注意到它仍在使用数组列表。由于他们已经从 .Net 1.0 继续前进，是时候将它们更新为 generic`List<T>`了（并避免调用 CType——你应该能够改为使用 DirectCast() ）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-13T03:48:32.927

肯定会得到一些关于 Connection 和 Reader 对象的 using 语句。如果有异常，它们不会被关闭，直到垃圾收集器找到它们。

当有 using 语句时，我倾向于不调用 .Close() 。即使 SqlDataReader 在 dispose 时关闭连接（检查文档），在 Connection 周围放置 using 也不会伤害并坚持模式。

如果你这样做了，那么只有当你需要在那里进行异常处理时才需要 try/finally。我倾向于将异常处理留在更高级别（包装每个 UI 入口点、库入口点、异常中的额外信息），因为堆栈跟踪通常足以调试错误。

这并不重要，但如果您正在重构，请将集合初始化移到循环之外。再三考虑，如果没有记录，代码将返回 null。

至少使用了SqlParameters！如果您发现它（SQL 注入攻击），无论它“清理”得多么好，都可以摆脱任何将用户输入与 SQL 连接起来的东西。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-13T04:18:48.060

当阅读器关闭时，连接将关闭，因为它使用 CloseConnection 命令行为。

```
Dim rs As SqlDataReader = cmd.ExecuteReader(CommandBehavior.CloseConnection) 
```

根据 MSDN（[http://msdn.microsoft.com/en-us/library/aa326246](http://msdn.microsoft.com/en-us/library/aa326246(VS.71).aspx) (VS.71).aspx ）

> 如果在 CommandBehavior 设置为 CloseConnection 的情况下创建 SqlDataReader，则关闭 SqlDataReader 会自动关闭连接。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T15:15:28.137

为了回应 Joel 和 Robert 指出的一些重要观点，我将方法重构如下，它运行完美。

```
Public Function GetSomeInfoByBusObject(ByVal SomeID As String) As IList
Dim strSQL As String = "InLine SQL"
Dim ci As BusObject
Dim list As New GenList(Of BusObject)
Dim cn As New SqlConnection(
    ConfigurationSettings.AppSettings("ConnectionString"))
Using cn
    Dim cmd As New SqlCommand(strSQL, cn)
    Using cmd
        cmd.Parameters.Add(New SqlParameter
            ("@SomeID", SqlDbType.NVarChar, 2)).Value = strSiteID
        cn.Open()
            Dim result As SqlDataReader = cmd.ExecuteReader(CommandBehavior.CloseConnection)
                While result.Read()
                    ci = New BusObject(rs("id), result("description"))
                    list.Add(DirectCast(ci, BusObject))
                End While
            result.Close()
        End Using
    Return list
End Using 
```

结束功能

创建了一个不错的小助手类来包装通用细节

```
Public Class GenList(Of T)
    Inherits CollectionBase
    Public Function Add(ByVal value As T) As Integer
        Return List.Add(value)
    End Function
    Public Sub Remove(ByVal value As T)
        List.Remove(value)
    End Sub
    Public ReadOnly Property Item(ByVal index As Integer) As T
        Get
            Return CType(List.Item(index), T)
        End Get
    End Property
End Class 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T03:48:50.023

如果您使用的是 c#，我会将 datareader 创建包装在 using 语句中，但我认为 vb 没有这些？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-20T01:54:46.143

```
Public Function GetSizeInfoBySite(ByVal siteID As String) As IList(Of CategoryInfo)
        Dim strSQL As String = "YES INLINE SQL!! :)"

        'reference the 2.0 System.Configuration, and add a connection string section to web.config
        '  <connectionStrings>
        '   <add name="somename" connectionString="someconnectionstring" />
        '  </connectionStrings >

        Using cn As New SqlConnection(System.Configuration.ConfigurationManager.ConnectionStrings("somename").ConnectionString

            Using cmd As New SqlCommand(strSQL, cn)

                cmd.Parameters.Add(New SqlParameter("@MySiteID", SqlDbType.NVarChar, 2)).Value = siteID
                cn.Open()

                Using reader As IDataReader = cmd.ExecuteReader()

                    Dim records As IList(Of CategoryInfo) = New List(Of CategoryInfo)

                    'get ordinal col indexes
                    Dim ordinal_SomeId As Integer = reader.GetOrdinal("someID")
                    Dim ordinal_SomeName As Integer = reader.GetOrdinal("someName")

                    While reader.Read()
                        Dim ci As CategoryInfo = New CategoryInfo(reader.GetInt32(ordinal_SomeId), reader.GetString(ordinal_SomeName))
                        records.Add(ci)
                    End While

                    Return records

                End Using
            End Using
        End Using
    End Function 
```

您可以尝试类似上面的方法，using 语句将处理连接关闭和对象处置。这在类实现 IDisposable 时可用。还构建并返回您的 CategoryInfo 的 IList。

# sql - join 语句，但只需要根据 WHERE 表列是否为空来获取数据

> ID：286191
> 
> 赞同：0
> 
> 时间：2008-11-13T03:35:51.033
> 
> 标签：sql, mysql

我有这个查询语句，只想获取某个列为空的记录（`volunteers_2009.venue_id`）

表是`volunteers_2009`，列我要查看它是否为空：`venue_id`

这是当前的查询：

```
SELECT volunteers_2009.id, volunteers_2009.comments, 
   volunteers_2009.choice1, volunteers_2009.choice2, volunteers_2009.choice3, 
   volunteers_2009.lname, volunteers_2009.fname, volunteers_2009.venue_id, 
   venues.venue_name 
FROM volunteers_2009 AS volunteers_2009 
LEFT OUTER JOIN venues ON (volunteers_2009.venue_id = venues.id) 
ORDER by $order $sort 
```

我正在尝试这样做：

```
SELECT volunteers_2009.id, volunteers_2009.comments, 
   volunteers_2009.choice1, volunteers_2009.choice2, volunteers_2009.choice3, 
   volunteers_2009.lname, volunteers_2009.fname, volunteers_2009.venue_id, 
   venues.venue_name 
FROM volunteers_2009 AS volunteers_2009 
LEFT OUTER JOIN venues ON (volunteers_2009.venue_id = venues.id) 
ORDER by $order $sort 
WHERE volunteers_2009.venue_id == '' 
```

如何仅列出表 ( ) 中具有空列 ( `venue_id`) 的记录`volunteers_2009`？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T03:41:52.067

空的意思是空吗？如果该`venue_id`字段可以包含空值，那么您可以使用这样的`is`运算符进行比较：

```
WHERE volunteers_2009.venue_id is null 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T03:50:25.467

WHERE 子句在您的第二个查询中出现故障。它必须在 ORDER BY 子句之前。

另外，我不认为您有任何 id 为空的场所。也许你真正想要的是：

```
SELECT volunteers_2009.id, volunteers_2009.comments, 
    volunteers_2009.choice1, volunteers_2009.choice2, volunteers_2009.choice3, 
    volunteers_2009.lname, volunteers_2009.fname, volunteers_2009.venue_id, 
    venues.venue_name 
FROM volunteers_2009 
LEFT JOIN venues ON venue_id = venues.id
WHERE venues.id IS NULL
ORDER BY $order $sort 
```

这将只带回与任何场地不匹配的志愿者_2009 记录。

或这个：

```
SELECT volunteers_2009.id, volunteers_2009.comments, 
    volunteers_2009.choice1, volunteers_2009.choice2, volunteers_2009.choice3, 
    volunteers_2009.lname, volunteers_2009.fname, volunteers_2009.venue_id, 
    venues.venue_name 
FROM venues
LEFT JOIN volunteers_2009 ON volunteers_2009.venue_id = venues.id
WHERE volunteers_2009.venue_id IS NULL
ORDER BY $order $sort 
```

寻找没有志愿者的场所。

# .net - 有用的新 .net(3.0,4.0) 技术特性

> ID：286192
> 
> 赞同：-3
> 
> 时间：2008-11-13T03:37:16.427
> 
> 标签：.net, asp.net, .net-4.0, language-features

以前是 .net 2.0，这是 .net 开发的重大变化。许多开发人员主要致力于此。目前，微软已经推出了 .net 3.0 及其下一个版本 .net 4.0。因此，下一个版本将是 .net 开发的重大变化。

我已经列出了它的一些功能......

工作流基础 WPF WCF Windows cardspace 敏捷方法实现。Silverlight 功能增强。

在新一代框架中，您喜欢哪些功能以及吸引您的原因。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T05:27:09.297

您错过了 .NET 3.5，它实际上是一个比 .NET 3.0 更大的包；.NET 3.0 添加了诸如 WCF/WPF/WF 之类的东西，它们是更好的方式来处理（通常）已经存在于框架中的事情。

然而，.NET 3.5 增加了 LINQ，这是一个*庞大*而广泛的应用程序。LINQ-to-Objects 是最常用的，为常规代码提供了更方便的模型。但是 LINQ-to-SQL 和 EF（在 SP1 中）是 ORM 工具（还有许多其他工具可用）。

.NET 4.0 针对一些问题，特别是线程 (TPL/CCR) 和动态对象 (DLR)。C# 4.0 的*主要*更改是使动态对象更易于使用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T07:57:00.070

我**真的很**喜欢 lambda 表达式。它让事情变得容易多了！我也期待 C# 4.0 中的一些特性，例如可选参数、命名参数、No PIA 等等。:-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T03:54:14.553

如果您问即将推出的 .NET 4.0 框架将提供哪些新功能，我听说过很多关于并行计算的信息，特别是关于构建在框架核心中的任务并行库，还有[PLinq](http://msdn.microsoft.com/en-us/magazine/cc163329.aspx)或 Parallel Linq，专注于 LINQ -to-Objects 和 LINQ-to-XML 。

查看[Microsoft PDC 网站](http://www.microsoftpdc.com/)，您会发现更多有趣的信息。

# http - 黑莓上的套接字连接比 http 快吗？

> ID：286206
> 
> 赞同：4
> 
> 时间：2008-11-13T03:46:12.213
> 
> 标签：http, sockets, blackberry, java-me

我正在为 Blackberry 编写一个最初在标准 J2ME 中实现的应用程序。网络连接是使用`Connector.open("socket://...:80/...")`而不是完成的`http://`

现在，我已经使用这两种方法实现了连接，而且似乎有些时候，socket 方法的响应速度更快，而有些时候它根本不起作用。两者之间有显着差异吗？大多数情况下，我想要实现的是连接的响应以获得平滑的进度条。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-13T13:43:47.273

Blackberry 的实现`http`并`https`提供了更多用于连接到目标服务器的选项`socket`，当然，它还为您实现了所有 HTTP 协议内容。我没有对它们进行基准测试，但是在某些情况下直接`TCP` 通过`socket`会更快，特别是如果在端口 80 上侦听*的不是*HTTP 服务器（没有协议开销） ，这在一定程度上是有意义的

过去，我在与不同的网络供应商打交道时遇到过困难，有些需要`deviceside=true`其他供应商，`deviceside=false`而且直到第一个对该网络的支持电话打进来之前，我才真正知道。

> 大多数情况下，我想要实现的是连接的响应以获得平滑的进度条。

请原谅我这么说，但“平滑的进度条”是“给百合镀金” - 很好看，但对应用程序的功能、可靠性或健壮性并不重要。选择更健壮并减少代码大小的东西 - 可能`http`在这种情况下。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T03:57:30.443

由于两者都通过网络运行，我认为您不能保证进度条顺畅。如果您提醒此人留在一个地方，您可能会有更多机会保持联系；）

与 HTTP 连接相比，套接字连接的开销更少。事实上，HTTP 连接是通过套接字连接运行的。您可以利用减少的套接字连接开销来提高响应速度，但与使用 HTTP 相比，您可能需要做更多的工作。API 更底层，因此编码更复杂。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-19T16:46:19.477

BlackBerry 上的套接字和 HTTP 连接之间的一个区别是，在 BES 和 BIS 连接的情况下，HTTP 连接可以通过 HTTP 代理透明地路由。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-03T19:07:04.853

理论上套接字会更快，但是您负责管理滚动您自己的协议的开销（取决于复杂性）。尽管套接字更轻量级，但我发现 HTTP 及其附带的所有功能大大减少了头痛。

# iphone - 如何从通讯录联系人中获取电话号码（iphone sdk）

> ID：286207
> 
> 赞同：2
> 
> 时间：2008-11-13T03:46:51.197
> 
> 标签：iphone, objective-c, cocoa-touch

我正在向用户显示地址簿视图，并让他们单击联系人并选择电话号码。如果他们选择电话号码，我想将电话号码作为整数获取，将联系人姓名作为 NSString 获取。

我试过用下面的代码来做：

```
 //printf("%s\n",[[(NSArray *)ABMultiValueCopyArrayOfAllValues(theProperty) objectAtIndex:identifier] UTF8String]);

    //CFArrayRef *arrayString = [[(NSArray *)ABMultiValueCopyArrayOfAllValues(theProperty) objectAtIndex:identifier] UTF8String];
    NSArray *arrayString = [(NSArray *)ABMultiValueCopyArrayOfAllValues(theProperty) objectAtIndex:identifier];
    printf("%s\n", arrayString); 
```

此代码在此方法中：

```
- (BOOL)peoplePickerNavigationController:(ABPeoplePickerNavigationController *)peoplePicker shouldContinueAfterSelectingPerson:(ABRecordRef)person property:(ABPropertyID)property identifier:(ABMultiValueIdentifier)identifier 
```

我正在检查用户是否使用此代码选择了电话号码：

```
if (propertyType == kABStringPropertyType)   
{
    [self wrongSelection];

} 
else if (propertyType == kABIntegerPropertyType)     
{
    [self wrongSelection];

} 
else if (propertyType == kABRealPropertyType)    
{
    [self wrongSelection];
} 
else if (propertyType == kABMultiStringPropertyType)     
{
     //This is the phone number... 
```

我可以使用 printf 获取要在控制台中显示的电话号码，但是我不知道如何将其转换为整数以及如何获取联系人姓名，即使选择的属性不是人名也是如此。

另外，我正在做的似乎效率很低。有没有更好的方法来做到这一点？

编辑：如果我不能将它们存储为 int，那么字符串就可以了。我只是不知道如何从那个数组变成一个实际的字符串。如果我将其转换或保存为 UTF8String，我总是会遇到一些错误。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-11-13T04:46:07.770

为了有效地获取属性（就阅读而言），您可以在回调方法中执行以下操作：

```
switch( propertyType ) {
  case kABMultiStringPropertyType:
    // this is the phone number, do something
    break;
  default:
    [self wrongSelection];
    break;
} 
```

不过，我不确定你是否真的需要解析它。要从记录中获取电话号码，您可以执行以下操作（同样，在您的回调方法中）：

```
ABMultiValueRef phoneNumberProperty = ABRecordCopyValue(person, kABPersonPhoneProperty);
NSArray* phoneNumbers = (NSArray*)ABMultiValueCopyArrayOfAllValues(phoneNumberProperty);
CFRelease(phoneNUmberProperty);

// Do whatever you want with the phone numbers
NSLog(@"Phone numbers = %@", phoneNumbers);
[phoneNumbers release]; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-13T04:01:51.247

您不能将电话号码转换为整数。电话号码是字符串。Apple 为自己包含的默认条目具有编号“1-800-MYAPPLE”。

此外，即使电话号码的所有组成部分都是数字，也不能保证世界各地的电话号码实际上都小到足以容纳 64 位值，一旦您考虑到区号、国家代码、内部扩展名等。用户可以随意放在那里。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-26T18:33:55.607

不使用整数的另一个原因 - 一些国家/地区在电话号码上使用前导零，例如所有英国号码都以零开头（通常写成 01234 567890 或 0123 4567890）！

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T15:29:07.797

```
CFStringRef cfName = ABRecordCopyCompositeName(person);
NSString *personName = [NSString stringWithString:(NSString *)cfName];
CFRelease(cfName);

ABMultiValueRef container = ABRecordCopyValue(person, property);
CFStringRef contactData = ABMultiValueCopyValueAtIndex(container, identifier);
CFRelease(container);
NSString *contactString = [NSString stringWithString:(NSString *)contactData];
CFRelease(contactData); 
```

`contactString` contains the phone number selected, and `personName` contains the person's name. As stated above, you can't necessarily convert the string to numbers generically, as it may contain alphabetic characters. However, you could write your own handler to convert alphabetic characters to numbers and strip out everything else to get a numeric string only, which you could then convert to a long (phone numbers get pretty long) .

I question the need to convert a phone number to a numeric value, though, since it may also contain other necessary characters like Pause. Also, a phone number represents a string of digits more than it represents one long number anyway, so the conceptual data format is more String than Int in any case.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-11-15T12:02:43.127

请注意，如果地址簿条目不包含名称或联系人数据，则此代码在“stringWithString”中崩溃。cfName 可能为零！

```
CFStringRef cfName = ABRecordCopyCompositeName(person);
NSString *personName = [NSString stringWithString:(NSString *)cfName];
CFRelease(cfName); 
```

使固定：

```
NSString *personName = nil;
if ((cfName = ABRecordCopyCompositeName(person)) != nil) {
     personName = [NSString stringWithString:(NSString *)cfName];
     CFRelease(cfName); 
} 
```

# c# - 在 ASP.NET 中调试时，什么可能导致 LocalHost 上的“连接中断”

> ID：286219
> 
> 赞同：4
> 
> 时间：2008-11-13T03:53:54.117
> 
> 标签：c#, asp.net, localhost

我正在尝试使用 C# 运行一个新创建的 ASP.NET 网站，但是当我这样做时，它会启动 FireFox 并尝试连接到[http://localhost:1295/WebSite1/Default.aspx](http://localhost:1295/WebSite1/Default.aspx)（例如），但在大约10-15 秒后，它会显示“连接中断 - 与服务器的连接在页面加载时已重置”。错误。

这个问题也存在于我过去构建的较旧的 ASP.NET C# 页面/Web 服务中，实际上没有任何东西在 ASP.NET 开发服务器上运行。

我正在使用：Windows XP Pro SP2、Visual Studio 2008

作为参考，我还安装了 SQL Server 2005 Developer Edition。

我试过了：

*   用 IE 而不是 Mozilla 浏览它
*   尝试 2.0 框架而不是 3.5
*   重新安装 Visual Studio 2008

这个问题越想越微不足道，但我还没有解决它！感谢您对此事的任何帮助。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2011-03-18T03:27:10.420

我也遇到了同样的问题，当我正要辞职逃跑并加入修道院时，我想到了检查 ELMAH 的想法——也许它已经抓住了它……

果然，ELMAH 告诉我它发现了这个：

```
System.Web.HttpException (0x80004005): Maximum request length exceeded. 
```

这解决了它：

```
<system.web>
  <httpRuntime maxRequestLength="65535" />
</system.web> 
```

祝你好运，戴夫

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-13T04:03:01.180

当您启动应用程序时，屏幕右下方会出现一个小信息标记，告诉您本地 Web 服务器已启动并且位于哪个端口上。您应该将该端口与浏览器中显示的端口进行比较。如果它们不同，则防病毒软件可能会导致该问题。另一个需要查看的地方是您的[主机](http://en.wikipedia.org/wiki/Hosts_file)文件。某些软件会调整此文件，并可能使您的 localhost 不正常。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T04:07:29.160

[如果代理本地地址，Fiddler](http://www.fiddlertool.com/fiddler/)或其他代理（如服务器）可能会导致此问题。

您可以在控制面板/Internet 选项 - 连接选项卡下进行检查，单击底部的 LAN 设置。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-10T19:23:39.813

尝试在 c:\windows\system32\drivers\etc\hosts 中读取“::1 localhost”的行之前添加“127.0.0.1 localhost”

这对我有用（VS2008，Vista Ultimate）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-06-30T18:09:35.093

我在 Windows 7 RC 和 Visual Studio 2008 SP1 上遇到了类似的问题。将 localhost 更改为 127.0.0.1 有所帮助。与hosts文件解决方案类似，但不需要文件编辑，只需要更改项目启动url即可。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-03T15:03:33.367

我有同样的问题，只是在 Vista Business 机器上安装了 VS 2008。我有一个 LAN，但没有代理服务器，并且带有“127.0.0.1 localhost”的 c:\windows\system32\drivers\etc\hosts 在那里。但我的项目都不起作用，也没有新的项目。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-12-08T20:46:03.097

“我在 Windows 7 RC 和 Visual Studio 2008 SP1 上遇到了类似的问题。将 localhost 更改为 127.0.0.1 有帮助。类似于 hosts 文件解决方案，但不需要文件编辑，您只需更改项目启动 url。 "

该解决方案运行良好.......

# asp.net-mvc - 您希望在 ASP.NET MVC 中使用的新功能

> ID：286227
> 
> 赞同：2
> 
> 时间：2008-11-13T04:00:59.313
> 
> 标签：asp.net-mvc

在未来的版本中，您希望在 ASP.NET MVC 中使用哪些新功能？

我会说

1) 一个单独的 ASP.NET MVC 视图引擎，而不是当前的 WebForm 视图引擎。
2) 异步控制器动作。
3) 子控制器/部分请求。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T04:28:06.403

是的，找到好的文档是目前的伤害因素。我一直在寻找 2 个月前有效的解决方案（对当前的 beta 版本没有帮助）但是嘿，我真的很喜欢它给我带来的拥抱 jquery 和 ajax 的推动力。

我目前正在尝试弄清楚如何在控制器内部渲染部分视图 - 也没有任何运气！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-13T04:22:07.523

停止丢弃新代码 - 开始丢弃更好的文档。:) 哦，使用 EF 而不是 LINQ to SQL 的说明性指导也将受到欢迎。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T05:38:17.103

我同意更好的文档会很棒！我正在通过反复试验来解决所有问题，但我想要一些关于如何完成某些事情的指导。

子控制器在我的列表中也很重要。

我实际上希望他们不要添加太多。控制我的 HTML 并且能够使用 jQuery 而没有所有的“Control.ClientID”和 ViewState 混乱是很好的，我不想看到他们通过添加太多功能来搞砸它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T06:33:31.377

正确缓存子控制器/部分视图。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-13T05:56:59.033

良好的文档 .. 更好地支持服务器组件 ..

# php - 如何以 RSS 格式阅读邮件列表

> ID：286232
> 
> 赞同：10
> 
> 时间：2008-11-13T04:03:46.860
> 
> 标签：php, rss, mailing

我订阅了一个仅用作开发参考的邮件列表，我正在尝试使用我的 RSS 客户端阅读它，但邮件列表不提供 RSS。

所以我认为这应该是一种将邮件列表转换为 RSS 的方法，我试图找到一些 php 类将其安装在我的服务器中，但找不到任何人。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-13T04:11:29.323

[Nabble](http://nabble.com)和[Gmane](http://gmane.org)都归档邮件列表并提供 RSS 提要。如果它是一个开发邮件列表，那么它很可能已经在那里存档。否则，您可以让 Nabble 归档邮件列表。在经历实施自己的解决方案的痛苦之前，我会这样做。

# workflow-foundation - WF ThrowActivity 和自定义错误消息？

> ID：286238
> 
> 赞同：2
> 
> 时间：2008-11-13T04:07:31.453
> 
> 标签：workflow-foundation

是否可以在 Windows 工作流基础中向 ThrowActivity 抛出自定义错误消息？

例如。想象一下，我想在我的 WF 中抛出这个异常：-

```
CutomException("This is my custom error message", myNumber, myObect); 
```

干杯:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T15:02:40.500

也许我不太了解您的问题，但是您可以在活动执行之前的任何位置使用`Fault`属性设置特定异常，例如：`ThrowActivity`

```
throwActivity1.Fault = new CustomException("This is my custom error message", myNumber, myObect); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-13T02:34:04.780

您可以像这样抛出任何自定义异常。

public DiscontinuedProductException deniedProductException1 = new DiscontinuedProductException();

[SerializableAttribute()] 公共类 DiscontinuedProductException : 异常 { public DiscontinuedProductException() : base() { }

```
 public DiscontinuedProductException(string message)
        : base(message)
    {
    }

    public DiscontinuedProductException(string message, Exception innerException)
        : base(message, innerException)
    {
    }

    protected DiscontinuedProductException(SerializationInfo info, StreamingContext context)
        : base(info, context)
    {
    }
} 
```

# c# - 有没有时候 && (AndAlso) 与 & (And) 无关

> ID：286250
> 
> 赞同：8
> 
> 时间：2008-11-13T04:24:24.943
> 
> 标签：c#, boolean-logic

如果我正在评估两个变量而不是两个方法调用，那么天气是否重要，我使用“&&”或“&”

```
//some logic that sets bool values

boolean X = true;
boolean Y = true;

if (X & Y){
   // perform some operation
}

if (X && Y){
   // perform some operation
} 
```

此外，我用于 C# 3.0 / .NET 3.5 的一本书只提到了 && 运算符，& 运算符会消失吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-13T04:29:59.863

如果您正在执行真/假逻辑测试，请始终使用 &&。单个 & 执行按位“和”。在某些情况下，它可以像逻辑测试一样工作，但不能保证适用于所有逻辑情况。单个 & 最常见的用途是在应用位掩码时。

例子 （＆＆）：

```
true && true == true 
```

例子 （＆）：

```
00101001 & 00100001 = 00100001 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-13T04:35:02.193

如果您使用单个 & (And)，则计算表达式的第二部分。如果第二部分依赖于第一部分的真实性，这可能会很糟糕。通常总是使用 && 因为如果第一部分为假，则不评估第二部分。

正如其他人所说，从逻辑上讲，单个 & 执行按位运算，这对于布尔比较/评估仍然有效。真正应该使用单个 & （或 |）（或布尔评估）的唯一时间是第二次评估是否应该始终运行（如果它是函数调用/修饰符）。这是一种不好的做法，可能是这本书没有提到它的原因。

单个 & 对标志枚举和位掩码很有用。

下面会抛出 obj is null 的异常：

```
bool b = obj != null & obj.IsActive 
```

但这会起作用：

```
bool b = obj != null && obj.IsActive 
```

这是不好的：

```
bool b = obj.IsActive && obj.SetActive(false);
bool b = obj.IsActive & obj.SetActive(false); 
```

& 运算符将继续存在。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-13T05:16:51.937

正如已经观察到的，`&`是按位与运算符。随着时间的推移，原始二进制数学似乎越来越不常见，越来越多的开发人员并不真正了解按位算术。这有时会很痛苦。

然而，有很多任务最好用这种方式解决，特别是任何将数据视为标志的任务。该`&`运算符是 100% 必要的，并且不会去任何地方 - 它根本不像布尔短路`&&`运算符那样频繁使用。

例如：

```
[Flags]
enum SomeEnum { // formatted for space...
    None = 0, Foo = 1, Bar = 2 // 4, 8, 16, 32, ...
}
static void Main() {
    SomeEnum value = GetFlags();
    bool hasFoo = (value & SomeEnum.Foo) != 0;
}
static SomeEnum GetFlags() { ... } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T04:30:04.420

& 是位运算符，而 && 是 AND 运算符。两种完全不同的操作。

```
int a = 1;
int b = 2;
assert (a & b == 0) 
assert (a && b == true) 
```

编辑：哎呀......这个例子在 C# 中不起作用。它应该在 C++ 中。希望它说明了两个运营商之间的意图和区别。

# java - 替代 Java GUI 框架

> ID：286251
> 
> 赞同：4
> 
> 时间：2008-11-13T04:24:26.770
> 
> 标签：java, user-interface, frameworks

我正在 OS X 中用 Java (Nim) 制作一个小型游戏编号游戏，并且正在考虑尝试使用 Swing 以外的东西制作游戏的 GUI 界面。我查看了 SWT，但我在某处读到 SWT 在 OS X 上存在一些问题。我还查看了用于 Java 的 GTK+ 绑定，但我也不确定这是否是一个不错的选择。你们对一个看起来不错并且与 OS X 兼容的好的 Java GUI 框架有什么建议吗？

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-13T05:07:27.463

[这取决于 eclipse 3.4， MacOs](http://www.eclipse.org/swt/macosx/)非常支持 SWT 3.4 。

![替代文字](https://www.eclipse.org/swt/macosx/downloaded.png)

现在，SWT 是特定于操作系统的，您可能没有 Swing 那样的灵活性，因此您需要有充分的理由寻找 Swing 的替代品，尤其是当您考虑到 Java 有良好的[LAF（外观和感觉）](https://stackoverflow.com/questions/145972/how-can-i-setup-lookandfeel-files-in-java)时。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-02-28T04:51:21.920

您可能会考虑[JavaFX 2.0](http://javafx.com/)。

仍然处于早期阶段，但对于您可能会使用 Flash 的那种交互式/图形应用程序来说，它看起来很有希望。

# compilation - Borland Dev Studio 2006 Turbo C++ Explorer 编译问题

> ID：286253
> 
> 赞同：0
> 
> 时间：2008-11-13T04:24:52.027
> 
> 标签：compilation, turbo-c++

大家好

我是 C++ 的新手，对 Borland Turbo C++ Explorer 更是如此。我刚刚遇到了这个编译错误。关于如何修复它的任何线索？

```
[C++ Error] comsvcs.h(3209): E2015 Ambiguity between 'ITransaction' and 'Oledb::ITransaction'
[C++ Error] comsvcs.h(3275): E2015 Ambiguity between 'ITransaction' and 'Oledb::ITransaction'
[C++ Error] comsvcs.h(16197): E2015 Ambiguity between 'ITransaction' and 'Oledb::ITransaction'
[C++ Error] comsvcs.h(16293): E2015 Ambiguity between 'ITransaction' and 'Oledb::ITransaction' 
```

第一个出现的代码是

```
EXTERN_C const IID IID_ICreateWithTransactionEx;

#if defined(__cplusplus) && !defined(CINTERFACE)

    MIDL_INTERFACE("455ACF57-5345-11d2-99CF-00C04F797BC9")
    ICreateWithTransactionEx : public IUnknown
    {
    public:
    virtual /* [helpstring][helpcontext] */ HRESULT STDMETHODCALLTYPE CreateInstance(
        /* [in] */ ITransaction *pTransaction,
        /* [in] */ REFCLSID rclsid,
        /* [in] */ REFIID riid,
        /* [iid_is][retval][out] */ void **pObject) = 0;

    }; 
```

来自另一个来源的一些建议：

> 正如编译器的错误消息所说，在编译单元的范围内有 2 个 ITransaction 数据类型的声明。似乎 ITransaction 定义来自 Microsoft 的 comsvc​​s.h，而 OleDB::ITransaction 是 Borland 的 ITransaction 接口的实现。所以你可以尝试两件事：

1.  消除 OleDB::ITransaction 定义（不知道 Turbo C++，但可能有一个组件处理 oleDB。尝试摆脱它。或者它可能通过使用另一个#include 来包含。搜索文本 oledb:: ITransaction 在您的包含目录中，您将有望找到相关文件。修改包含路径，使其不再包含）。
2.  您可以尝试定义 CINTERFACE 因为如果定义了导致编译错误的代码将不包括在内。但这可能会导致其他问题...

有没有人有任何其他建议？

亲切的问候，布鲁斯。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-13T07:11:28.413

我不知道如何做 COM 或你的 ITransaction 是什么，但在我看来你的范围包含两种 ITransaction 类型。你能在你的函数原型中更明确吗？您可以确定要使用的 ITransaction 的范围吗？说“::ITransaction”（使用全局命名空间）还是“some_other_namespace::ITransaction”？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-16T08:45:26.907

好的，我们需要以某种方式结束这个问题。在使用最新补丁更新 Turbo C++ Explorer 后，问题就消失了。

感谢一路上提供建议的所有人。

# vb.net - 将应用程序的状态记录到控制台窗口

> ID：286257
> 
> 赞同：2
> 
> 时间：2008-11-13T04:29:10.520
> 
> 标签：vb.net, console

我目前正在重构一个将其状态打印到控制台窗口的应用程序。目前我正在做这样的事情：

```
 Console.Write("Print some status.....")
 //some code 
 Console.WriteLine("Done!") 
```

现在虽然这工作正常，但所有逻辑都隐藏在 console.writelines 之间，我发现它很难阅读。

我不知道是否有更好的方法来做到这一点，但我只是想问问是否有人想出了更好/更干净的方式将应用程序状态打印到控制台。

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T06:12:53.993

看看 Log4Net，它可以处理所有事情，但对你的应用程序来说可能有点过头了，不知道。然而，了解 Log4Net 可能会在某天帮助你走上这条路，所以也许这也是一个学习它的好机会。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-14T00:06:01.450

我第二次使用 Log4Net。无需调用困难部分即可轻松使用它 - 只需执行以下操作：在您的应用程序 Main() 方法中，调用

```
log4net.Config.BasicConfigurator.Configure(new log4net.Appender.ConsoleAppender()); 
```

这设置了一个基本的控制台记录器，将所有消息记录到标准输出。

在需要记录的类中，创建一个新的 ILog，如下所示：

```
private static readonly log4net.ILog log = log4net.LogManager.GetLogger(typeof (MyClass)); 
```

然后在需要记录的方法中，调用

```
log.Debug("Print Some status ..."); 
```

一旦你完成了所有这些设置并开始工作。查看 Log4Net 文档，了解如何设置更有用的日志记录。您可以执行许多不同类型的日志记录，而无需更改代码中的日志记录调用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T04:44:53.220

为什么不使用将错误写入文本文件的 Logger 对象？您可能会收到一些“优先级”错误消息，例如： Logger.print(new priority("important"), "blabla"); 这样，您可以在文件中找到确切的时间和您想要的所有消息。

如果您绝对想要控制台，您可以使用控制台上的优先级.. 所以它只会打印您告诉记录器打印的内容，例如网络错误等。

# java - 导入 com.apple.com.dnssd 包

> ID：286264
> 
> 赞同：1
> 
> 时间：2008-11-13T04:34:34.317
> 
> 标签：java, bonjour

我正在尝试编译和运行苹果在 BonjourSDK 中提供的示例 bonjour 程序，在这里可以找到：http: [//developer.apple.com/networking/bonjour/index.html](http://developer.apple.com/networking/bonjour/index.html)

该程序称为 SimpleChat.java。但是，每当我尝试编译程序时，我都会收到此错误：“SimpleChat.java:55: com.apple.dnssd 包不存在”

我一辈子都无法完善包含此软件包的必要文件。我一定错过了一些简单的东西，但无法弄清楚。我刚刚安装了 JDK 1.6，但这无济于事。谢谢你的时间。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T04:36:26.463

您的错误看起来很像此邮件线程中的错误：

[http://lists.apple.com/archives/Bonjour-dev/2006/Jul/msg00046.html](http://lists.apple.com/archives/Bonjour-dev/2006/Jul/msg00046.html)

你是在 Windows 上构建的吗？

# unicode - Unicode 和网络通信

> ID：286266
> 
> 赞同：1
> 
> 时间：2008-11-13T04:35:32.300
> 
> 标签：unicode

我正计划开发一个基于 Windows 的客户端应用程序和一个平台无关的服务器应用程序。客户端应用程序基本上将消息发送到服务器应用程序。客户端应用程序可以用英语或其他语言发送消息。我应该在客户端应用程序中使用 UNICODE 对消息进行编码吗？网络通信所涉及的应用程序之间的一般做法是什么？我的客户端和服务器应用程序将使用自定义协议通过 TCP/IP 交换消息。Windows 和 UNIX 平台默认支持哪些 UNICODE 编码？我是否应该在我的协议中交换编码类型以及解码 UNICODE 消息？请指教。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T04:46:31.703

寻找 UTF-8，一种 8 位字节的 unicode 编码，对英语和西方语言有效。

交换编码类型总是一个好主意，以防您在稍后阶段想要支持其他东西。

所有主要操作系统和计算机语言都支持 UTF-8。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T04:52:42.360

如果您同时控制服务器和客户端，我会选择一种编码类型并坚持使用。

我建议使用 UTF-8（对英语和西方语言最有效）或 UTF-16（确保选择字节顺序）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T04:54:14.417

你可以使用任何你想要的编码，你只需要注意字节顺序之类的事情。Windows 内部使用 UTF-16 (little-endian)，所以如果您希望大多数系统是 Windows，那么您可能应该使用它。否则，我会推荐 UTF-8，它不需要担心字节顺序问题。

如果您确实使用 UTF-16（或 UTF-32，我绝对*不*推荐），请明确说明线路上数据的字节序是什么。然后，对于每个将 Unicode 字符读取或写入网络套接字的客户端，将平台的本机字节序转换为网络字节序——这要么是无操作，要么是字节交换。

# php - 如何使用 php 对流媒体视频进行密码保护

> ID：286270
> 
> 赞同：7
> 
> 时间：2008-11-13T04:37:38.960
> 
> 标签：php, authentication, login, streaming, quicktime

使用 php/.htaccess 密码保护快速流媒体视频的最佳方法是什么。它们使用 rtsp 进行流式传输，但如有必要，我可以使用其他格式。

我知道如何使用 php 进行身份验证，但我不确定如何设置身份验证，以便保护流文件 url，以便用户不能只是复制 url 并共享它。

还是我想太多了，我可以使用普通的身份验证方案并将文件放在受保护的目录中？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-13T13:20:51.020

nginx 和 lighttpd 网络服务器都有 X-Send-File 标头，您可以从 PHP 返回。因此，您可以在 PHP 中进行检查，然后有条件地输出文件。

```
if (check_user_can_access()){
    header('X-sendfile: /path/to/file');
} else {
    header('HTTP/1.1 403 Fail!');
} 
```

Lighttpd 还有一个名为[mod_secure_download](http://redmine.lighttpd.net/wiki/lighttpd/Docs#mod_secure_download)的简洁模块，它允许您以编程方式生成一个仅在短时间内有效的 URL。

Nginx 和可能的 lighttpd 允许您限制下载速度，因此您发送流数据的速度不会超过可以消耗的速度。

无论哪种方式，您都希望使用 Web 服务器来提供文件。通过 PHP 为它们提供服务是可能的，但速度很慢。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T07:40:01.133

尝试使用 Amazon S3 服务，它有一些怪癖，但一旦你熟悉它就有意义了。

他们的 API 中有钩子来实现在指定时间内处于活动状态的临时 URL，因此您可以自由地向访问者显示 url，因为它在 10 分钟左右后将无法工作。

使用 php（大约 15 行代码）几乎是微不足道的事情，他们的论坛上有很多示例，因此您无需从头开始阅读有关如何实现此目的的完整文档。

在生成和显示链接之前你会做什么样的授权取决于你。

您还可以让它看起来像是从您的域（例如 video.yourdomain.com）而不是标准 s3 URL 提供的。

最后一件事，它很便宜——当我上传 8 GB 并完全下载 3 次并初始化下载约 100 次时，我们为测试和部署一个月支付了大约 2 美元。我为之做这件事的人对价格非常满意，以至于他想将所有可下载的媒体移动到 s3。

现在，重新阅读我写的所有内容，它看起来像商业/垃圾邮件，但我对服务非常满意，因为我之前为音频文件编写了所有内容，并且花了几天时间才一切正常，这需要几个小时才能实现（主要是熟悉服务）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T13:33:35.157

您可能想看看： [mod_xsendfile (for apache)](http://tn123.ath.cx/mod_xsendfile/)

它使您能够在内部重定向到文件。

因此，您可以将下载链接指向`checkCredentials.php`

```
<?php
if ( isAuthorised($_POST['user'], $_POST['pass']) ) {
    header("X-Sendfile: $somefile");
    header("Content-Type: application/octet-stream");
    header("Content-Disposition: attachment; file=\"$somefile\"");
    exit(0);
} else {
    show403('bad credentials');
}
?> 
```

该模块也可用于其他网络服务器。如果我没记错的话，这个想法最初来自 lighttpd，但是 - 正如 Josh 所说 - 也可用于 nginx。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T05:11:44.723

首先，欺骗引用者非常容易。此信息存储在用户的浏览器中，因此用户可以简单地远程登录到您的服务器并提供与您的域匹配的自己的引荐来源。

您可以尝试几件事：

首先，更安全，但仍然可以欺骗。mod_rewrite 提供了检查 cookie 的能力。您可以做的是在用户访问您的包含一些模糊数据的网站时设置一个 cookie。然后，您可以将您的 RerwriteCond 修改为如下内容：

```
RewriteEngine On
RewriteCond %{HTTP_REFERER} !^$
RewriteCond %{HTTP_COOKIE} obscurename=obscurevalue [NC]
RewriteCond %{HTTP_REFERER} !^http://(www\.)?yourdomain.com/.*$ [NC]
RewriteRule \.(asx¦ASX)$ http://www.yourdomain.com/images/leech.gif [R,L] 
```

另一种更好的技术将涉及使用 PHP 和 mime 类型。我不确定这会在多大程度上支持流媒体内容，但我认为它会起作用。您可以做的是让所有视频链接指向一个 .php 文件（查询字符串将确定选择了哪个视频）。然后，当用户尝试访问此链接时，您可以执行以下操作：

```
<?php
    // You could also check some sort of session variable
    // that is set when the user visits another part of your
    // site
    if(!isLoggedIn()){
       header("Location: errorPage.htm");
       exit;
    }else{
       // Get the name of the file specified
       $file = get_file_name($_GET['fileID']);

       // Specify the proper mime-type for the data you're sending
       // (this may have to change, depending on your situation)
       header("Content-type: video/vnd.rn-realvideo");

       // Read the file and output it to the browser
       readfile($file);
    }
?> 
```

根据我的阅读，大多数服务器都知道哪些 mime 类型是流式 mime 类型，因此浏览器应该能够弄清楚如何正确处理流式文件。

# asp.net-mvc - System.Web.Mvc 中不再存在 OnActionExecuting(FilterExecutingContext) 了吗？

> ID：286273
> 
> 赞同：10
> 
> 时间：2008-11-13T04:40:07.067
> 
> 标签：asp.net-mvc

在预览版 5 中，我在我的自定义控制器类中覆盖了 OnActionExecuting，但现在由于某种原因在 beta 中它给了我一个错误，说参数 FilterExecutingContext 不存在？

```
 protected override void OnActionExecuting(System.Web.Mvc.FilterExecutingContext filterContext) 
```

现在参数是多少？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-11-13T04:59:39.227

该参数现在是一个 System.Web.Mvc.ActionExecutingContext 对象。

# graphics - Direct3D 几何：来自两个向量的旋转矩阵

> ID：286274
> 
> 赞同：1
> 
> 时间：2008-11-13T04:41:58.077
> 
> 标签：graphics, 3d, geometry, transform, direct3d

给定两个 3D 向量 A 和 B，我需要导出一个从 A 旋转到 B 的旋转矩阵。

这就是我想出的：

1.  ~~从acos~~ (A . B)导出余弦
2.  ~~从asin~~导出正弦(|A x B| / (|A| * |B|))
3.  使用 A x B 作为旋转轴
4.  [使用本页](http://www.euclideanspace.com/maths/geometry/rotations/conversions/angleToMatrix/index.htm)底部附近给出的矩阵（轴角）

除了 0°（我忽略）和 180°（我将其视为特殊情况）的旋转之外，这工作正常。使用 Direct3D 库是否有更优雅的方法来执行此操作？我正在寻找 Direct3D 特定的答案。

编辑：删除了 acos 和 asin（参见[Hugh Allen 的帖子](https://stackoverflow.com/questions/286274/direct3d-geometry-rotation-matrix-from-two-vectors#286300)）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T05:04:49.793

不，你几乎是在以最好的方式做到这一点。我认为没有内置的 DirectX 功能可以满足您的需求。对于第 4 步，您可以使用[`D3DXMatrixRotationAxis()`](http://msdn.microsoft.com/en-us/library/bb205357(VS.85).aspx). 请注意边缘情况，例如当 |A| 或 |B| 为零，或当角度为 0° 或 180° 时。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T05:05:04.643

这可能更像是一个错字而不是 thinko，但 acos(AB) 是角度，而不是余弦。对于第 2 点也是如此。

您可以使用 sin^2 + cos^2 = 1 从 cos 计算 sin。即 sin = sqrt(1-cos*cos)。这将比您使用的矢量表达式便宜，并且还消除了 0/180 度的特殊情况。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T05:20:04.847

[您可能会从 siggraph链接文本](http://www.siggraph.org/education/materials/HyperGraph/modeling/mod_tran/3drota.htm#Rotation%20about%20an%20Arbitrary%20Axis)中查看以下文章

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-17T12:02:39.567

也许你可以使用 D3DXMatrixLookAtLH ？

# css - 使用 CSS 使图像变灰？

> ID：286275
> 
> 赞同：199
> 
> 时间：2008-11-13T04:42:13.520
> 
> 标签：css

使用 CSS 使图像显示为“变灰”的最佳方式（如果有的话）是什么（即，不加载单独的变灰版本的图像）？

我的上下文是我在表格中有行，在最右边的单元格中都有按钮，并且某些行需要看起来比其他行更轻。所以我当然可以轻松地使字体更轻，但我也想让图像更轻，而不必管理每个图像的两个版本。

* * *

## 回答 #1

> 赞同：250
> 
> 时间：2008-11-13T04:45:23.687

它必须是灰色的吗？您可以将图像的不透明度设置为较低（使其变暗）。或者，您可以创建一个`<div>`叠加层并将其设置为灰色（更改 alpha 以获得效果）。

*   html:

    ```
    <div id="wrapper">
        <img id="myImage" src="something.jpg" />
    </div> 
    ```

*   CSS：

    ```
    #myImage {
        opacity: 0.4;
        filter: alpha(opacity=40); /* msie */
    }

    /* or */

    #wrapper {
        opacity: 0.4;
        filter: alpha(opacity=40); /* msie */
        background-color: #000;
    } 
    ```

* * *

## 回答 #2

> 赞同：200
> 
> 时间：2012-08-07T09:12:42.480

使用 CSS3 过滤器属性：

```
img {
    -webkit-filter: grayscale(100%);
       -moz-filter: grayscale(100%);
         -o-filter: grayscale(100%);
        -ms-filter: grayscale(100%);
            filter: grayscale(100%); 
} 
```

浏览器支持相当不错，[https://caniuse.com/css-filters](https://caniuse.com/css-filters)。

* * *

## 回答 #3

> 赞同：54
> 
> 时间：2012-12-17T06:25:21.053

你在这里：

```
<a href="#"><img src="img.jpg" /></a> 
```

CSS灰色：

```
img{
    filter: url("data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\'><filter id=\'grayscale\'><feColorMatrix type=\'matrix\' values=\'0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0\'/></filter></svg>#grayscale"); /* Firefox 10+, Firefox on Android */
    filter: grayscale(100%);
    -moz-filter: grayscale(100%);
    -ms-filter: grayscale(100%);
    -o-filter: grayscale(100%);
    filter: gray; /* IE6-9 */
    -webkit-filter: grayscale(100%); /* Chrome 19+, Safari 6+, Safari 6+ iOS */} 
```

非灰色：

```
a:hover img{
    filter: url("data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\'><filter id=\'grayscale\'><feColorMatrix type=\'matrix\' values=\'1 0 0 0 0, 0 1 0 0 0, 0 0 1 0 0, 0 0 0 1 0\'/></filter></svg>#grayscale");
    filter: grayscale(0%);
    -moz-filter: grayscale(0%);
    -ms-filter: grayscale(0%);
    -o-filter: grayscale(0%);
    filter: none ; /* IE6-9 */
    zoom:1; /* needed to trigger "hasLayout" in IE if no width or height is set */
    -webkit-filter: grayscale(0%); /* Chrome 19+, Safari 6+, Safari 6+ iOS */
    } 
```

我在以下位置找到它：http: [//zkiwi.com/topic/chuyen-hinh-mau-thanh-trang-den-bang-css-nhu-the-nao](http://zkiwi.com/topic/chuyen-hinh-mau-thanh-trang-den-bang-css-nhu-the-nao)

**编辑：** IE10+ 不像 IE9 和更早版本那样支持 DX 过滤器，也不支持灰度过滤器的前缀版本。您可以修复它，使用以下两种解决方案之一：

1.  使用头部中的以下元元素将 IE10+ 设置为使用 IE9 标准模式呈现：`<meta http-equiv="X-UA-Compatible" content="IE=9">`
2.  在 IE10 中使用 SVG 覆盖来完成灰度[Internet Explorer 10 - 如何应用灰度过滤器？](https://stackoverflow.com/questions/14813142/internet-explorer-10-howto-apply-grayscale-filter)

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2008-11-14T20:27:54.073

如果您不介意使用一点 JavaScript，jQuery 的[fadeTo()](http://api.jquery.com/fadeTo/)在我尝试过的每个浏览器中都能很好地工作。

```
jQuery(selector).fadeTo(speed, opacity); 
```

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2008-11-13T22:13:44.140

更好地支持所有浏览器：

```
img.lessOpacity {               
   opacity: 0.4;
   filter: alpha(opacity=40);
   zoom: 1;  /* needed to trigger "hasLayout" in IE if no width or height is set */ 
} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2019-06-03T06:17:49.537

# 变灰：

## “消色差。”</h2>

```
filter: grayscale(100%); 
```

```
@keyframes achromatization {
	0% {}
	25% {}
	75% {filter: grayscale(100%);}
	100% {filter: grayscale(100%);}
}

p {
	font-size: 5em;
	color: yellow;
	animation: achromatization 2s ease-out infinite alternate;
}
p:first-of-type {
	background-color: dodgerblue;
}
```

```
<p>
	⚡ Bzzzt!
</p>
<p>
	⚡ Bzzzt!
</p>
```

## “用灰色填充。”</h2>

```
filter: contrast(0%); 
```

```
@keyframes gray-filling {
	0% {}
	25% {}
	50% {filter: contrast(0%);}
	60% {filter: contrast(0%);}
	70% {filter: contrast(0%) brightness(0%) invert(100%);}
	80% {filter: contrast(0%) brightness(0%) invert(100%);}
	90% {filter: contrast(0%) brightness(0%);}
	100% {filter: contrast(0%) brightness(0%);}
}

p {
	font-size: 5em;
	color: yellow;
	animation: gray-filling 5s ease-out infinite alternate;
}
p:first-of-type {
	background-color: dodgerblue;
}
```

```
<p>
	⚡ Bzzzt!
</p>
<p>
	⚡ Bzzzt!
</p>
```

* * *

## 有用的笔记

*   [CSS3滤镜灰度和饱和有什么区别？](https://stackoverflow.com/questions/37621307/whats-the-difference-between-css3-filter-grayscale-and-saturate)

*   [https://www.w3.org/TR/filter-effects-1](https://www.w3.org/TR/filter-effects-1)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-11-13T05:10:13.027

这是一个让您设置背景颜色的示例。如果您不想使用浮动，那么您可能需要手动设置宽度和高度。但即便如此，这也确实取决于周围的 CSS/HTML。

```
<style>
#color {
  background-color: red;
  float: left;
}#opacity    {
    opacity : 0.4;
    filter: alpha(opacity=40); 
}
</style>

<div id="color">
  <div id="opacity">
    <img src="image.jpg" />
  </div>
</div> 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-10-28T03:52:05.300

您可以`rgba()`在 css 中使用来定义颜色而不是`rgb()`. 像这样： `style='background-color: rgba(128,128,128, 0.7);`

为您提供相同的颜色，`rgb(128,128,128)`但不透明度为 70%，因此后面的内容仅显示 30%。CSS3，但自 2008 年以来它在大多数浏览器中都可以使用。抱歉，我不知道 #rrggbb 语法。玩弄数字——你可以用白色洗掉，用灰色洗掉阴影，无论你想用什么稀释。

好的，所以你用半透明灰色（或任何颜色）制作一个矩形并将其放在图像顶部，可能具有 position:absolute 和高于零的 z-index，然后将它放在图像和默认值之前矩形的位置将与图像的左上角相同。应该管用。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-13T05:16:56.960

考虑到 filter:expression 是微软对 CSS 的扩展，所以它只能在 Internet Explorer 中工作。如果你想让它变灰，我建议你使用一点 javascript 将它的不透明度设置为 50%。

[http://lyxus.net/mv](http://lyxus.net/mv)将是一个很好的起点，因为它讨论了一个适用于 Firefox、Safari、KHTML、Internet Explorer 和支持 CSS3 的浏览器的不透明脚本。

您可能还想给它一个灰色边框。

# flash - 如何在我的 Flash 应用程序中制作 cookie？

> ID：286282
> 
> 赞同：4
> 
> 时间：2008-11-13T04:46:27.130
> 
> 标签：flash, cookies, actionscript-2

如何使用 ActionScript 2.0 在我的 Flash 应用程序中制作 cookie？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T08:11:08.233

如果您只需要本地存储并且对 cookie 没有特定需求，Flash 有它自己的 cookie 风格，称为[SharedObjects](http://livedocs.adobe.com/flash/8/main/wwhelp/wwhimpl/common/html/wwhelp.htm?context=LiveDocs_Parts&file=00002661.html)。它们的工作方式或多或少相同，但它们只能从 Flash 中读取，但是它们将为您省去与 javascript 交互的麻烦。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-13T05:27:29.733

您需要使用 JavaScript 来处理 cookie。您可以使用[ExternalInterface API](http://livedocs.adobe.com/flash/8/main/wwhelp/wwhimpl/common/html/wwhelp.htm?context=LiveDocs_Parts&file=00002200.html)从 ActionScript 执行此操作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-11-28T05:19:18.040

Flash ActionScript as own Cookies Mechanism which called Local Shared Object. you can use Local Shared Object as a cookies and when you will load once again same application you will find out the same data which stored in previous loaded application session.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T05:55:03.857

在 AS2 中，我想说只创建一个 javascript 函数来设置 cookie 并使用 geturl 请求从 flash 中调用它。

```
// Javascript Function
function setCookie(c_name,value,expiredays)
{
    var exdate=new Date();
    exdate.setDate(exdate.getDate()+expiredays);
    document.cookie=c_name+ "=" +escape(value)+
    ((expiredays==null) ? "" : ";expires="+exdate.toGMTString());
}

// AS2 Function
myBtn_btn.onRelease = function(){
 getURL("javascript:setCookie('my_cookie','my_value','30')");
}; 
```

希望有帮助。咀嚼

ps 这是未经测试的代码，但它应该可以工作:-)

# php - TinyMCE 画得好，但不让我输入。在FF中，按钮有错误：组件返回失败代码：0x80004005

> ID：286285
> 
> 赞同：1
> 
> 时间：2008-11-13T04:49:22.897
> 
> 标签：php, javascript, tinymce

在以前的应用程序中，我能够让 TinyMCE 正常工作。但是在这个网络应用程序中，我可以让富编辑器正常显示，但由于某种原因，我无法在富编辑器字段中输入内容，当我单击粗体等按钮时，出现以下错误：

```
Error: [Exception... "Component returned failure code: 0x80004005 (NS_ERROR_FAILURE) [nsIDOMNSHTMLDocument.execCommand]"  nsresult: "0x80004005 (NS_ERROR_FAILURE)"  location: "JS frame :: http://mysite/tiny_mce/tiny_mce.js :: anonymous :: line 1"  data: no]
Source File: http://mysite/tiny_mce/tiny_mce.js
Line: 1 
```

我想知道我能做些什么来调试这里发生的事情。什么可能导致这个奇怪的错误？

一些背景：

此代码加载 TinyMCE：

```
<script type="text/javascript" src="http://mysite/tiny_mce/tiny_mce.js"></script> 
<script>
tinyMCE.init({
    mode : 'none',
    editor_selector: 'mceAdvanced',
    theme : 'advanced',
    theme_advanced_toolbar_location : 'top',
    theme_advanced_toolbar_align : 'left',
    theme_advanced_buttons1 : 'fontsizeselect,bold,italic,|,bullist,numlist,|,outdent,indent,|,removeformat',
    theme_advanced_buttons2: '',
    theme_advanced_buttons3: '',
    theme_advanced_font_sizes: "1, 2, 3, 4",
    width: '600',
    height: '200',
    remove_script_host : true,
    cleanup_on_startup : true,
    cleanup: true,
    debug : true,
    convert_urls : false
});

tinyMCE.execCommand('mceAddControl', true, 'fldOverview');
</script>

<textarea id="fldOverview" name="fldOverview" class="textbox"><?= OVERVIEW ?></textarea> 
```

测试：

FF3 失败。Opera（最新稳定版）工作。Windows IE7 工作。Safari（最新稳定版）有效。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-13T05:30:16.170

答案就[在这里](http://tinymce.moxiecode.com/punbb/viewtopic.php?pid=45174#p45174)。

交易是这样的。曾经使用过脸书吗？我们试图实现一个类似的界面，您可以在其中单击以编辑配置文件部分，它会折叠并使用进度条重新展开，然后折叠并使用配置文件表单重新展开。在那个配置文件表单中，我们有 TinyMCE 富编辑器。

好吧，事实证明，DIV 被隐藏然后显示以显示 TinyMCE 控件存在一个怪癖。它得到了时间或什么？无论如何，我们在 jQuery 中使用 slideToggle API 来折叠和重新扩展 DIV，其中包含我们通过 jQuery AJAX 东西拉回的新内容。当我们这样做时，不知何故，这个 slideToggle API 让我们兴奋不已。

修复方法是像往常一样执行 slideToggle，但在我们使用 execCommand 技术加载 tinyMCE 编辑器之前，我们需要首先使用 jQuery 中的 show API 来确保我们的 DIV 被强制打开和可见。当我们这样做时，问题就消失了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T04:55:42.947

您是否在 Firefox 中执行此操作？

因为根据[this](http://qualityobsession.com/blog/archives/72)，当您在 Firefox 中禁用弹出窗口时，由于弹出窗口阻止的实现方式，它会出现。

启用弹出窗口，一切顺利！

# windows-mobile - Windows Mobile 5 SDK 按钮控件

> ID：286286
> 
> 赞同：2
> 
> 时间：2008-11-13T04:52:42.237
> 
> 标签：windows-mobile, custom-controls

我是一个相当新手的程序员，正在开发我的第一个 Windows Mobile 应用程序。我看到我的程序没有可用的按钮控件。我以前从未创建过自定义控件，我知道这是我可以为我的应用程序获取按钮的唯一方法（这是我的客户的要求）。我想知道是否有人可以快速了解我将如何创建它。我将 Visual Studio 2005 与 Windows Mobile 5 SDK 一起使用，创建了一个将部署在非触摸屏设备上的应用程序。

提前感谢您提供的任何帮助。

**更新：**由于需要快速处理大量数据，因此按钮控件是该项目的更好选择。有七个带有计数器标签的部分，每个标签旁边是一组三个按钮。一个按钮增加标签上的 int，花药减少它，第三个按钮让用户输入一个 int 值以分配给标签。我尝试开发一个菜单系统来控制这一切，但菜单最终嵌套得太深，快速访问进行更改很重要。

我想出了如何通过创建用户控件来制作一个非常基本的按钮，现在我在属性窗口中使控件上的标签可更改时遇到了问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T07:07:49.810

您显然正在使用智能手机 SDK 进行开发，其中没有可用的按钮。如果您使用 PocketPC SDK，那么您将有一个按钮。这些 SDK 在 Windows Mobile 6 中已被重命名为 Standard 和 Professional。

老实说，我不建议在智能手机应用程序中使用按钮。您可以向您的客户解释在智能手机应用程序中使用按钮是违反 Windows Mobile 准则的，而应该使用菜单。这比必须导航到按钮然后单击它要快得多。

如果客户坚持，创建一个继承自 Control 类的类并覆盖 OnPaint 事件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T05:39:23.453

绝对有一个可用的按钮控件 - 无需自己编写。您可以使用的控件将位于工具箱中，该工具箱应停靠在 Visual Studio 的左侧。除非您已将表单添加到项目并选择了表单，否则这些控件将不可见。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-17T03:26:58.507

我遇到了同样的问题，Visual Studio 2008 中的设备控件工具箱上没有按钮控件。我知道这是因为指南告诉我们改用链接和菜单。

但是您知道，有时您必须在用户需要时放置一个按钮。

我正在尝试使用适用于 Windows Mobile 6 的 SDK

[http://www.microsoft.com/downloads/details.aspx?FamilyID=06111a3a-a651-4745-88ef-3d48091a390b&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=06111a3a-a651-4745-88ef-3d48091a390b&displaylang=en)

但想知道在哪里可以找到 Windows Mobile 6.5 SDK？

# .net - 编写了一个修改 TextControl 的 resharper 插件？

> ID：286296
> 
> 赞同：4
> 
> 时间：2008-11-13T05:00:52.983
> 
> 标签：.net, plugins, resharper

Resharper 声称要吃自己的狗粮，具体来说，他们声称 Resharper 的许多功能都是在 R# (OpenAPI) 之上编写的。我正在编写一个简单的插件来修复当前所选文档的注释。当这个插件运行时，它会抛出一个异常，如下所示：

文档只能在命令范围内修改

我已经研究了这个错误并且找不到任何帮助解决这个问题，所以我希望你可能已经编写了一个插件来完成这个。如果没有，我希望该片段足以帮助其他人开发自己的插件。

```
using System;
using System.IO;
using System.Windows.Forms;
using JetBrains.ActionManagement;
using JetBrains.DocumentModel;
using JetBrains.IDE;
using JetBrains.TextControl;
using JetBrains.Util;

namespace TinkerToys.Actions
{
    [ActionHandler("TinkerToys.RewriteComment")]
    public class RewriteCommentAction : IActionHandler
    {
        #region Implementation of IActionHandler

        /// <summary>
        ///             Updates action visual presentation. If presentation.Enabled is set to false, Execute
        ///             will not be called.
        /// </summary>
        /// <param name="context">DataContext</param>
        /// <param name="presentation">presentation to update</param>
        /// <param name="nextUpdate">delegate to call</param>
        public bool Update(IDataContext context, ActionPresentation presentation, DelegateUpdate nextUpdate)
        {
            ITextControl textControl = context.GetData(DataConstants.TEXT_CONTROL);
            return textControl != null;
        }

        /// <summary>
        ///             Executes action. Called after Update, that set ActionPresentation.Enabled to true.
        /// </summary>
        /// <param name="context">DataContext</param>
        /// <param name="nextExecute">delegate to call</param>
        public void Execute(IDataContext context, DelegateExecute nextExecute)
        {
            ITextControl textControl = context.GetData(DataConstants.TEXT_CONTROL);
            if (textControl != null) {
                TextRange textSelectRange;

                ISelectionModel textSelectionModel = textControl.SelectionModel;
                if ((textSelectionModel != null) && textSelectionModel.HasSelection()) {
                    textSelectRange = textSelectionModel.Range;
                } else {
                    textSelectRange = new TextRange(0, textControl.Document.GetTextLength());
                }

                IDocument textDocument = textControl.Document;
                String textSelection = textDocument.GetText(textSelectRange);
                if (textSelection != null) {
                    StringReader sReader = new StringReader(textSelection);
                    StringWriter sWriter = new StringWriter();
                    Converter.Convert(sReader, sWriter);
                    textSelection = sWriter.ToString();

                    textDocument.ReplaceText(textSelectRange, textSelection);
                }
            }
        }

        #endregion
    }
} 
```

那么它非常想要的这个命令范围是什么？在发布之前我有一些额外的日志记录，所以我绝对确定范围和文本都是有效的。此外，该错误似乎表明我缺少一些我一直无法找到的范围。

* * *

是的，我想我可以使用宏来完成相同的任务。回想起来，我写了一个简单的 vs 插件来做同样的事情。我正在/正在查看 R# 的原因是因为它具有语言特定的元素解析，除了原始文本之外它还可以提供。但是对于这个问题，我认为宏或标准加载项也可以正常工作。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-13T06:33:53.747

如果我理解了，您想获取选择，将其发送到函数并用函数返回值替换选择...

使用 Visual Studio 宏来完成这项工作怎么样？你会考虑吗？

# javascript - 使用 try .. catch .. finally 处理 Javascript 错误

> ID：286297
> 
> 赞同：55
> 
> 时间：2008-11-13T05:01:39.923
> 
> 标签：javascript, error-handling, finally

我怀疑我`finally`错误地使用了该块，并且我不了解其用途的基本原理...

```
 function myFunc() {
      try {
           if (true) {
                throw "An error";
           }
      } catch (e) {
           alert (e);
           return false;
      } finally {
           return true;
      }
 } 
```

此函数将运行该`catch`块，警告“错误”，但随后返回 true。为什么它不返回假？

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2008-11-13T05:11:29.000

> finally 块包含要在 try 和 catch 块执行之后但在 try...catch 语句之后的语句之前执行的语句。无论是否抛出异常，finally 块都会执行。如果抛出异常，即使没有 catch 块处理异常，finally 块中的语句也会执行。[更多的](https://developer.mozilla.org/en/Core_JavaScript_1.5_Guide/Statements#The_finally_Block)

该`finally`块将始终运行，尝试`true`在您的`try`块后返回

```
function myFunc() {
     try {
         if (true) {
               throw "An error";
          }
          return true;
     } catch (e) {
          alert (e);
          return false;
     } finally {
          //do cleanup, etc here
     }
 } 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-13T05:42:10.060

finally 块在您离开 try 块时执行。在您的代码中，当您返回 false 时会发生这种情况。这会将返回值设置为 false 并尝试退出该函数。但首先它必须退出触发 finally 并将返回值覆盖为 true 的 try 块。

许多人认为每个函数有一个返回语句是一种很好的编程习惯。考虑在函数的开头创建一个 var retval，并在整个函数中根据需要将其设置为 true 或 false，然后构建代码，使其正确地落入底部的单个 return。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-01-27T08:13:35.483

```
function getTheFinallyBlockPoint(someValue) {
    var result;
    try {
        if (someValue === 1) {
            throw new Error("Don't you know that '1' is not an option here?");
        }
        result = someValue
    } catch (e) {
        console.log(e.toString());
        throw e;
    } finally {
        console.log("I'll write this no matter what!!!");
    }

    return result;
};

getTheFinallyBlockPoint("I wrote this only because 'someValue' was not 1!!!");
getTheFinallyBlockPoint(1); 
```

在浏览器的控制台上运行它，它可能会为您提供您正在寻找的答案。

# ajax - 对于我们的下一个项目，我想使用一些 AJAX 来改进用户界面。指导方针和建议？

> ID：286311
> 
> 赞同：2
> 
> 时间：2008-11-13T05:14:17.700
> 
> 标签：ajax

我们的团队在 Web 开发（tomcat/Oracle）方面经验丰富，但在我们现有的项目中没有 AJAX。这对我们来说是新技术，所以我想仔细正确地介绍一下。

我应该从框架或最佳实践或常见陷阱方面看什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T05:18:13.043

读这个：

*   [渐进增强](http://en.wikipedia.org/wiki/Progressive_enhancement)

并使用诸如[jQuery](http://jquery.com)、[mootools](http://mootools.net/)或[YUI](http://developer.yahoo.com/yui/connection/)之类的库，它将为您省去跨浏览器实现的许多麻烦。[这](http://www.ilinsky.com/articles/XMLHttpRequest/)将向您展示为什么要使用库。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-13T05:24:46.773

我的第一个建议是探索可用的不同框架，看看你的团队在编码风格方面更喜欢什么。大多数框架具有相同的基本功能，因此很多都归结为偏好。我更喜欢[jQuery](http://jquery.com/)，所以这是我的第一个建议，但在做出决定之前，我使用了[YUI](http://developer.yahoo.com/yui/)、[MooTools](http://mootools.net/)、[Prototype](http://www.prototypejs.org/)和[EXT JS](http://www.extjs.com/)。

其次，我建议将 AJAX 功能作为[渐进式增强](http://www.alistapart.com/articles/understandingprogressiveenhancement)来使用，允许您的应用程序在使用和不使用 JavaScript 的情况下工作。我发现这种方法还可以在担心添加花里胡哨之前确保一个可靠、有效的应用程序。

[Head First Ajax](https://rads.stackoverflow.com/amzn/click/com/0596515782)是一本很好的 IMO 书籍，可以帮助您了解使用 Ajax 背后的基本概念。对于您的团队来说，这可能是一个很好的起点，可以在您选择的任何框架中了解幕后发生的事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T06:19:42.373

我们在开始使用 ajax 时遇到的一件困难是*使用它的频率*。

对于应该在哪里使用 ajax，我们没有确切的要求，而且最初我们错误地使用了太多。这极大地影响了应用程序的复杂性。

如果您将页面间结构视为状态机，那么 ajax 会在每个页面状态中引入嵌套状态机。当您的子状态机以许多不同的状态结束时（我会说超过 2 个），您应该认真考虑使用传统方法。

最好的起点是尝试混合使用整个页面重新加载和 ajax，并保持保守，直到你确定你真的很擅长它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T06:26:16.930

不要在不需要的地方使用它。

需要向客户端发送一些状态更新的长时间运行的操作？使用 AJAX。

主要 UI 元素（菜单等）的标记？使用普通的旧 HTML。

基本上，仅使用 AJAX 传输数据。如果您尝试做一些花哨的事情，例如使用 AJAX 在客户端动态拉入 UI 元素，那么当您遇到想要使用 ie5（它们存在）或非基于 PC 的浏览器的客户端时，您将陷入困境。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T05:38:20.193

首先，查看您已经拥有的用户界面，并考虑其元素能够独立更改/反应的地方可能有意义。这是您的 ajax 增强可能有意义的地方

其次，查看其他答案中提到的库（我喜欢 AJAXPRO 的简单性，但它已停产）

如果你发现你所有的页面元素都捆绑在一起，不能独立改变，那么真的不需要ajax

否则，请考虑您将如何从您的 ajax 增强点访问页面状态 - 根据您使用的 ajax 框架，您可能有权或可能无法访问整个页面对象、会话状态、原始请求参数等。考虑这些问题前面以避免将自己编码成一个洞和/或不得不做出混乱的解决方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-20T08:24:24.733

如果您使用的是 .Net 或 Mono，我会鼓励您使用完全抽象 JavaScript[的 Ra-Ajax 。](http://ra-ajax.org)虽然我为 Ra-Ajax（发明家）工作，所以我有偏见......

# sql - 通过 SQL 语句的 Clearbox Radius 属性？

> ID：286316
> 
> 赞同：1
> 
> 时间：2008-11-13T05:17:31.140
> 
> 标签：sql, radius

我通过 Radius 对用户进行身份验证，并且可以选择通过 SQL 语句分配 Radius 属性，但我终其一生都找不到关于此的任何文档。有人知道正确的语法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-15T03:39:17.133

好的，我想通了，对于其他最终遇到此问题的人：

在“授权”选项卡下的“响应列表”中：从 SQL 查询中添加属性时，查询中选择的第一个变量是属性，第二个是值。

前任。

`SELECT 'attribute', value FROM table WHERE username ='$u'`

举一个更具体的例子：

`SELECT 'Ascend-Data-Rate', hsbrate.rate FROM hsbrate, customer WHERE customer.id = hsbrate.id AND username='$u'`

这条语句基本上会通过以下内容：
Ascend-Data-Rate=1024000

（假设 1024000 是存储在数据库中的速率值）

注意：$u 是 Clearbox Radius 中的一个可理解变量，表示当前活动的用户正在被验证。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-14T13:37:03.090

kylex，试试这些链接，看看它们是否有帮助。特别是第一个

[http://www.xperiencetech.com/forum/topic.asp?TOPIC_ID=97](http://www.xperiencetech.com/forum/topic.asp?TOPIC_ID=97)

[http://www.xperiencetech.com/forum/topic.asp?TOPIC_ID=62](http://www.xperiencetech.com/forum/topic.asp?TOPIC_ID=62)

# ruby-on-rails - 如何模拟 Rails 和 GWT 的 PUT/DELETE？

> ID：286321
> 
> 赞同：11
> 
> 时间：2008-11-13T05:21:00.633
> 
> 标签：ruby-on-rails, http, gwt

我想让我的应用程序有点 REST 兼容。我在后端使用 Rails，在前端使用[GWT](https://developers.google.com/web-toolkit/)。我想做更新和删除。我意识到我可以做类似 mydomain.com/:id/delete (GET) 的事情并完成同样的事情。但是，正如我之前所说，我希望有一个符合 REST 的后端。因此，我想做 mydomain.com/:id (DELETE) 并让它隐式调用我的删除方法。

现在，我的理解是，如果浏览器（我的浏览器是 GWT RequestBuilder）不支持 DELETE/GET，Rails 会通过 POST 和其他一些 url 参数以某种方式完成此任务。那么，如何使用 GWT RequestBuilder 来完成此任务？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-13T07:46:36.113

Rails 通过隐藏属性做到这一点。解决这个问题的最简单方法是创建一个新的 rails 应用程序，生成一个脚手架并在浏览器中查看 HTML。

试试这个：

```
rails jp
cd jp
./script/generate scaffold RequestBuilder name:string
rake db:migrate
./script/server 
```

然后导航到[http://localhost:3000/request_builders](http://localhost:3000/request_builders)，单击 New 并查看 HTML。你会看到类似的东西：

```
<form action="/request_builders" class="new_request_builder" 
  id="new_request_builder" method="post">
  <div style="margin:0;padding:0">
    <input name="authenticity_token" type="hidden" value="e76..." />
  </div> 
```

这是一个创造，方法是POST。输入名称，保存然后编辑：

```
<form action="/request_builders/1" class="edit_request_builder" 
  id="edit_request_builder_1" method="post">
  <div style="margin:0;padding:0">
    <input name="_method" type="hidden" value="put" />
    <input name="authenticity_token" type="hidden" value="e76..." />
  </div> 
```

当然表单是通过 POST 发送的，但是 Rails 有一个隐藏字段来模拟 PUT 请求。删除也一样，但脚手架会用一点 Javascript 来完成：

```
var m = document.createElement('input'); 
m.setAttribute('type', 'hidden'); 
m.setAttribute('name', '_method'); 
m.setAttribute('value', 'delete'); 
```

要将这项工作与另一个前端一起使用，您必须同时具备以下条件：

*   使用相同样式的 URL，例如 /request_builders/1（RESTful URL）
*   包括隐藏字段（Rails 技巧）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-06-02T05:48:44.110

就像@skrat 所说，该解决方法`_method=PUT`不适用于任何类型的主体，例如 XML 或 JSON。幸运的是，还有一个标题解决方法：`Content-Type``x-www-form-urlencoded`

[https://zcox.wordpress.com/2009/06/17/override-the-http-request-method-in-jersey/](https://zcox.wordpress.com/2009/06/17/override-the-http-request-method-in-jersey/)

因此，要更新 REST 资源，只需对其地址执行 POST 并添加 header `X-HTTP-Method-Override: PUT`。Rails 会将其解释为对地址的 PUT。

# sharepoint - 我想在 SharePoint 中创建一个允许在时间表上预订时间的表单

> ID：286331
> 
> 赞同：1
> 
> 时间：2008-11-13T05:34:49.467
> 
> 标签：sharepoint, forms, web-applications

**您好**，我目前正在研究学生会的网站。学生协会拥有几个房间，我们想建立一个在线表格，允许学生在特定时间预订房间，我们希望有一个时间表来显示当前预订的时间。

**非常感谢！**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T08:50:04.767

检查[Windows SharePoint Services 3.0 应用程序模板：房间和设备预订](http://www.microsoft.com/downloads/details.aspx?FamilyId=3CF62351-D91D-44EE-9169-68303C205292&displaylang=en)。

有关演示和详细信息，请查看[此处](http://www.wssdemo.com/application/default.aspx)。

# iphone - 如何删除 UITableView 的边框？

> ID：286332
> 
> 赞同：62
> 
> 时间：2008-11-13T05:34:57.830
> 
> 标签：iphone, cocoa-touch, uitableview

我对 UITableView 控件进行了子类化，并将样式分组，但我不需要单元格分隔符。我尝试将表格视图的 separatorStyle 设置为无，但它不起作用。谁能帮我吗？

* * *

## 回答 #1

> 赞同：115
> 
> 时间：2010-07-08T18:00:32.207

在分组表视图中，设置`separatorStyle`不会做任何事情。如果要隐藏它，只需执行以下操作：

```
tableView.separatorColor = [UIColor clearColor]; 
```

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2009-01-19T08:58:53.573

用这个

```
tableView.separatorStyle = UITableViewCellSeparatorStyleNone;
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2012-12-05T09:58:08.627

要删除表格视图的边框，请编写以下行：

```
self.myTableView.separatorColor = [UIColor clearColor]; 
```

如果你想同时删除表格视图的边框和单元格之间的边框，你必须写下这两行：

```
self.myTableView.separatorColor = [UIColor clearColor];
self.myTableView.separatorStyle = UITableViewCellSeparatorStyleNone; 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-11-02T12:40:38.257

这对我有用：

```
[dayTableView setSeparatorColor:[UIColor whiteColor]]; //or your background color 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2018-10-12T20:25:42.563

迅捷4使用

```
myTableView.separatorStyle = UITableViewCellSeparatorStyle.none 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-13T08:18:58.043

如何将 setSeparatorColor 设置为单元格的背景颜色？

# iphone - 如何点击 iphone 应用程序中的按钮并链接到网站

> ID：286333
> 
> 赞同：0
> 
> 时间：2008-11-13T05:36:51.773
> 
> 标签：iphone

我正在一个基于视图的项目中开发一个 iphone 应用程序，（不是导航）但是我想单击该应用程序中的一个按钮并能够链接到一个网站，任何人都可以给我一些提示如何使视图转换

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T06:53:06.033

请参阅[此问题和答案](https://stackoverflow.com/questions/30058/how-can-i-launch-the-google-maps-iphone-application-from-within-my-own-native-a)。简洁版本：

```
[someUIApplication openURL:[[NSURL alloc] initWithString: @"http://www.yahoo.com"]] 
```

# sql-server - 在 SQL Server 中查找头尾事件（优化）

> ID：286334
> 
> 赞同：0
> 
> 时间：2008-11-13T05:36:52.553
> 
> 标签：sql-server, optimization

我有一个事件表，我需要找到类型 1 的所有尾部事件和类型 1 的所有头部事件。

因此，对于按 [1, 1], 3, 1 ,4, 5, [1,1,1] 顺序排列的事件集，括号表示类型 1 的头事件和尾事件。

这在 SQL 中得到了更好的说明：

```
drop table #event
go 
create table #event (group_id int, [date] datetime, [type] int)
create index idx1 on #event (group_id, date)

insert into #event values (1, '2000-01-01', 1) 
insert into #event values (1, '2000-01-02', 1) 
insert into #event values (1, '2000-01-03', 3) 
insert into #event values (1, '2000-01-04', 2) 
insert into #event values (1, '2000-01-05', 1) 
insert into #event values (2, '2000-01-01', 2) 
insert into #event values (2, '2000-01-02', 2) 
insert into #event values (2, '2000-01-03', 3) 
insert into #event values (2, '2000-01-04', 2) 
insert into #event values (2, '2000-01-05', 1) 
insert into #event values (3, '2000-01-01', 1) 
insert into #event values (3, '2000-01-02', 2) 
insert into #event values (3, '2000-01-03', 1) 
insert into #event values (3, '2000-01-04', 2) 
insert into #event values (3, '2000-01-05', 2) 
insert into #event values (4, '2000-01-01', 2) 
insert into #event values (4, '2000-01-02', 2) 
insert into #event values (4, '2000-01-03', 3) 
insert into #event values (4, '2000-01-04', 1) 
insert into #event values (4, '2000-01-05', 1) 

go 

select e1.* from #event e1 
where (
    not exists (
        select top 1 1 
        from #event e2 
        where e1.group_id = e2.group_id 
        and e2.date < e1.date 
        and e2.type <> 1
    ) or not exists (
        select top 1 1 
        from #event e2 
        where e1.group_id = e2.group_id 
        and e2.date > e1.date 
        and e2.type <> 1
    ) 
)
and e1.type = 1 
```

预期成绩：

```
1   2000-01-01 00:00:00.000 1
1   2000-01-02 00:00:00.000 1
1   2000-01-05 00:00:00.000 1
2   2000-01-05 00:00:00.000 1
3   2000-01-01 00:00:00.000 1
4   2000-01-04 00:00:00.000 1
4   2000-01-05 00:00:00.000 1 
```

这一切都很好，并返回了我的预期结果，但它扫描了表格 3 次。有什么办法可以让这个执行得更快并减少表扫描的次数？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T07:32:30.120

要生成大量数据子集，您可以使用以下命令：

```
declare @i int 
set @i = 10000
while @i > 5 
begin
    insert into #event values (@i, '2000-01-01', 1) 
    insert into #event values (@i, '2000-01-02', 1) 
    insert into #event values (@i, '2000-01-03', 3) 
    insert into #event values (@i, '2000-01-04', 2) 
    insert into #event values (@i, '2000-01-05', 1)  
    set @i = @i -1 
end 
```

此外，要在每组中包含大量事件，请尝试以下操作：

```
declare @j int 
set @j = 0 
while @j < 10
begin 
    set nocount on 
    declare @i int 
    set @i = 0
    while @i < 10000 
    begin
        insert into #event values (@j, DateAdd(d, @i, '2000-01-01'), rand(10) * 10) 

        set @i = @i  +1 
    end
    set @j = @j + 1 
end
set nocount off 
```

在我所有的测试中，我的原始查询似乎只产生了 3 次表扫描，我不确定这里是否可以提高性能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-12T17:07:44.330

我认为这更好：

```
select e1.group_id, e1.date, e1.type<br>
from #event e1, #event e2<br>
where e1.type = 1<br>
and e2.type <> 1<br>
and e1.group_id= e2.group_id<br>
group by e1.group_id, e1.date, e1.type, e2.group_id<br>
having e1.date < min(e2.date) or e1.date > max(e2.date) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T05:46:55.043

据我了解，您所追求的是每个 ID ** 按天排序的头部和尾部。头部和尾部是所有记录，直到遇到类型不是一个的记录。

这是一种不同的方式，它可能会更快

```
;WITH Ranked AS (
    SELECT 
        *,
        Row_Number() OVER (ORDER BY date) as 'rnk'
    FROM #event
)

SELECT * 
FROM Ranked
WHERE rnk not between 
        (SELECT Min(rnk) FROM Ranked r WHERE r.type <> 1 AND ranked.id = r.id)
        AND (SELECT Max(rnk) FROM Ranked r WHERE r.type <> 1 AND ranked.id = r.id)
order by id 
```

您不需要将 TOP 与 exists 语句一起使用，尽管它不会造成伤害。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T06:31:51.583

基本上看起来您正在寻找类型 1 的事件，该事件小于其他事件的时间戳，大于其他日期的时间戳事件试试这个，它是用 Oracle 语法编写的，不确定 MSSQL。

```
select e1.* from e1 where 
e1.id = 1 and (e1.date <=
(
select min(e2.date) from e2 where
e2.id <> 1
group by e2.date
)
or 
(e1.date >= 
select max(e3.date) from e3 where
e3.id <> 1
group by e3.date
)
) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T06:32:19.663

考虑

在#event（类型）上创建索引 idx2

我没有要检查的 SQL Server，但在 Oracle 中它将消除顶级扫描（对于 'type=1' 条件）。

关于查询本身——在 MS SQL 2000 中，'[not] exists' 和 '[not] in' 谓词几乎总是进行全扫描——我们用适当的 JOIN 替换它们。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-13T07:16:20.807

只有 20 条记录，查询优化器可能很容易得出结论，无论您如何表达查询或创建什么索引，3 次表扫描都是最快的方法。对于小数据记录，整个表可能会加载一次或少量磁盘读取；并且在读取块内没有太多优化；优化器主要对最小化磁盘活动感兴趣，其他一切都相对无关紧要。优化器对如此少的记录所做的事情并不能很好地表明它将如何处理更大的卷。

你有一个包含更多数据的真实表格吗？我无法想象你能感知到任何执行时间。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-13T12:48:52.707

这是一个带有连接的版本：

```
select distinct e1.* from #event e1 
left outer join #event e2 ON 
        e1.id = e2.id 
        and e2.date < e1.date 
        and e2.type <> 1
left outer join #event e3 ON
        e1.id = e3.id 
        and e3.date > e1.date 
        and e3.type <> 1
where e1.type = 1 AND (e2.id is null or e3.id is null) 
```

这仍然有三个表扫描和一个 distinct 子句，但它似乎仍然比原始查询快。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-13T19:20:22.930

这是一个查询，其显示计划中至少没有说“表扫描”，并给出了相同的答案。

不过，我还不明白逻辑上的查询。

```
SELECT DISTINCT e1.* FROM #event e1  
WHERE e1.type = 1  
    AND   
    (  
        NOT EXISTS (  
            SELECT 1 FROM #event  
            WHERE type != 1  
                AND id = e1.id   
                AND date < e1.date  
        )  
        OR NOT EXISTS (  
            SELECT 1 FROM #event  
            WHERE type != 1  
                AND id = e1.id   
                AND date > e1.date  
        )  
    ) 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-13T19:51:56.160

这比上一个要好：

```
SELECT e1.* FROM event e1  
WHERE e1.type = 1  
    AND NOT EXISTS 
    (  
        SELECT 1 FROM event  
        WHERE type != 1  
            AND id = e1.id   
            AND date < e1.date  
    )  
UNION ALL
SELECT e1.* FROM event e1  
WHERE e1.type = 1  
    AND NOT EXISTS 
    (  
        SELECT 1 FROM event  
        WHERE type != 1  
            AND id = e1.id   
            AND date > e1.date  
    ) 
```

它得到相同的结果。但是你的查询，以及我之前的查询，都很糟糕。这是 IO 统计信息：

（29985 行受影响）

表“事件”。扫描计数 9997，逻辑读取 20477，物理读取 0，预读读取 0。
表“工作表”。扫描计数 39979，逻辑读取 99950，物理读取 0，预读读取 0。

最近的查询也是如此：

（29985 行受影响）

表“事件”。扫描计数 4，逻辑读取 652，物理读取 0，预读读取 0。

有两点需要注意——

1.  即使在最坏的情况下，整个表都会被加载并且没有物理读取。
2.  坏的有 9997 + 39979 表扫描。不只是4。

请描述查询的意图。

# .net - WCF 双工服务和 TCP 端口耗尽

> ID：286354
> 
> 赞同：4
> 
> 时间：2008-11-13T05:58:34.223
> 
> 标签：.net, wcf, web-services, tcp, duplex

我正试图解决这个问题。我正在制作一个特定于业务的消息传递应用程序，它将通过 WCF（没有 vpns，整个网络）将 5000 到 10,000 台机器连接回我们的数据中心。它主要用于警报，我需要能够直接向特定客户端发送消息，而 WCF 允许我使用双工合同来完成所有这些工作，但是对于这么多客户端，它让我开始考虑最大化 TCP 端口空间65535 个端口。

我将假设所有入站连接都将通过我选择的任何端口进入，但返回客户端的出站连接将分别占用一个端口。我很好奇 WCF 端口共享服务是否可以解决此问题，或者它是否只有 65535 个端口到 IP 地址？那么，MSN Messenger 之类的如何处理这种情况。诚然，我可能永远达不到它，但至少我正在进入这个领域。

还是服务端的 WCF 双工合同在客户端期间保持端口打开以进行回调，还是释放它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T07:00:52.337

在高打开/关闭事务环境（例如服务非持久连接的套接字服务器）中耗尽默认 TCP 堆栈仍然很容易。

默认的 TIME-WAIT 延迟会加剧这种情况 - 套接字在被回收之前必须关闭的时间量 - 默认为 90 秒（如果我没记错的话）

要从我的其他线程中回收一些位 - 有一堆可以调整的注册表项 - 建议至少创建/编辑以下键

```
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters

TcpTimedWaitDelay = 30
MaxUserPort = 65534 
MaxHashTableSize = 65536 
MaxFreeTcbs = 16000 
```

MSDN 和 Technet 上有大量关于这些键功能的文档。例如

> [http://technet.microsoft.com/en-us/library/cc776295.aspx](http://technet.microsoft.com/en-us/library/cc776295.aspx)

为套接字服务器应用程序（例如 SQL、Biztalk、IIS 等）调整这些键是很常见的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-13T06:21:21.107

我认为每个端口实际上是 DestinationTCPAddress 和端口号的组合 - 所以你不会用完。

即，您可以在同一个源端口上与多个订阅者通话。这只是容量问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T09:28:27.500

如果这些连接都将是并发的，那么您将需要确保您的防火墙可以同时处理这么多的连接。

状态防火墙需要记录通过它们的每个正在进行的连接，以便它们可以判断是否允许后续数据包。小型防火墙具有数百个会话限制并不少见。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T13:04:28.103

连接在源地址、目标地址、源端口、目标端口方面是不同的（至少在 IP 层）。对最大连接数的某种操作系统限制可能会成为一个问题，但不要对端口号本身是任何现实限制的想法感到困惑。

# c# - Nod32 导致 LocalHost（ASP.NET 开发服务器）“连接中断”问题

> ID：286356
> 
> 赞同：4
> 
> 时间：2008-11-13T06:01:48.213
> 
> 标签：c#, asp.net, localhost, nod32

我在我要求进一步解释的上一个问题上引用自己的话：

*“我正在尝试使用 C# 运行一个新创建的 ASP.NET 网站，但是当我这样做时，它会启动 FireFox 并尝试连接到[http://localhost:1295/WebSite1/Default.aspx](http://localhost:1295/WebSite1/Default.aspx)（例如），但之后大约 10-15 秒，它会显示“连接中断 - 页面加载时与服务器的连接已重置。”错误。这个问题也存在于我过去构建的旧 ASP.NET C# 页面/Web 服务中，实际上并没有在 ASP.NET 开发服务器上运行。”*

这就是出现的问题，就是在我每次运行网站之前，我注意到 ASP.NET Server-startup 的通知显示一个端口（例如 1130），并且网站无法加载；事实证明，它正试图将站点加载到另一个端口（在本例中为 1128）。有人建议防病毒程序可能导致这种重定向；低，卸载 Nod32 解决了这个问题！

所以我的问题是：有没有人找到一种方法来创建异常或从 Nod32 中删除此功能？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-13T07:08:15.910

在 Nod32 中进入高级设置选项，并关闭协议过滤。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T07:17:49.087

这是 NOD32 的一个已知问题。看起来它的 IMON 模块（协议过滤器）不小心对通过它的 TCP 数据包进行了一些修改。

解决方案是将其关闭，或使用其他软件。

# c# - silverlight 2 将数据绑定到转换？

> ID：286366
> 
> 赞同：1
> 
> 时间：2008-11-13T06:15:51.803
> 
> 标签：c#, silverlight, binding, silverlight-2.0

我正在努力在 Silverlight 2 中创建标签云，并尝试将数据从 List 集合绑定到 TextBlock 上的 Scale 转换。运行此程序时出现`AG_E_PARSER_BAD_PROPERTY_VALUE`错误。是否可以将值绑定到 Silverlight 2 中的转换？如果不能，我可以对 FontSize={Binding Weight*18} 做一些事情来将标签的权重乘以基本字体大小吗？我知道这行不通，但是为 DataTemplate 中的项目计算属性值的最佳方法是什么？

```
<DataTemplate>
<TextBlock HorizontalAlignment="Stretch" VerticalAlignment="Stretch" TextWrapping="Wrap" d:IsStaticText="False" Text="{Binding Path=Text}" Foreground="#FF1151A8" FontSize="18" UseLayoutRounding="False" Margin="4,4,4,4" RenderTransformOrigin="0.5,0.5">
<TextBlock.RenderTransform>
    <TransformGroup>
        <ScaleTransform ScaleX="{Binding Path=WeightPlusOne}" ScaleY="{Binding Path=WeightPlusOne}"/>
    </TransformGroup>
</TextBlock.RenderTransform> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-13T18:42:01.713

问题似乎是[这篇文章中的第 1 条规则](http://www.simple-talk.com/dotnet/.net-framework/data-and-silverlight-2-data-binding/)：

> 数据绑定的目标必须是 FrameworkElement。

因此，由于 ScaleTransform 不是 FrameworkElement，它不支持绑定。我尝试绑定到 SolidColorBrush 来测试它，并得到与 ScaleTransform 相同的错误。

因此，为了解决这个问题，您可以创建一个控件来公开标签数据类型的依赖属性。然后有一个属性更改事件，将标记数据的属性绑定到控件中的属性（其中之一是缩放变换）。这是我用来测试的代码。

物品控制：

```
<ItemsControl x:Name="items">
  <ItemsControl.ItemTemplate>
    <DataTemplate>
       <local:TagControl TagData="{Binding}" />
    </DataTemplate>
  </ItemsControl.ItemTemplate>
</ItemsControl> 
```

标记控制 xaml：

```
<UserControl x:Class="SilverlightTesting.TagControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
    >
    <TextBlock x:Name="text" TextWrapping="Wrap" FontSize="18" Margin="4,4,4,4">
      <TextBlock.RenderTransform>
          <ScaleTransform x:Name="scaleTx" />
      </TextBlock.RenderTransform>
    </TextBlock>
</UserControl> 
```

标签控制代码：

```
public partial class TagControl : UserControl
{
    public TagControl()
    {
        InitializeComponent();
    }

    public Tag TagData
    {
        get { return (Tag)GetValue(TagDataProperty); }
        set { SetValue(TagDataProperty, value); }
    }

    // Using a DependencyProperty as the backing store for TagData.  This enables animation, styling, binding, etc...
    public static readonly DependencyProperty TagDataProperty =
        DependencyProperty.Register("TagData", typeof(Tag), typeof(TagControl), new PropertyMetadata(new PropertyChangedCallback(TagControl.OnTagDataPropertyChanged)));

    public static void OnTagDataPropertyChanged(DependencyObject obj, DependencyPropertyChangedEventArgs e)
    {
        var tc = obj as TagControl;
        if (tc != null) tc.UpdateTagData();
    }

    public void UpdateTagData()
    {
        text.Text = TagData.Title;
        scaleTx.ScaleX = scaleTx.ScaleY = TagData.Weight;
        this.InvalidateMeasure();
    }

} 
```

仅仅设置一个属性似乎有点过头了，但我找不到更简单的方法。

# c# - C# 中的 Word 自动化 - 在 Word 中创建表格

> ID：286371
> 
> 赞同：0
> 
> 时间：2008-11-13T06:24:25.327
> 
> 标签：c#, automation, ms-word

我有一个 C# 应用程序，它将打开一个 word 文档，然后用我拥有的数据替换一些预定义的书签，例如名称、类等。

这只是字符串值。现在我想将具有动态行数的表格呈现给 word 文档。我希望表格位于文档中的特定位置。

我可以为此使用书签吗？如果是这样怎么办？还有其他方法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-01T17:00:29.450

是的，您可以使用书签，也可以使用字段将其替换为带有 n 号的表格。行数和 n 号。的列。

您可以遍历字段并获取其范围，并使用范围您可以在字段位置添加表格：

```
//CREATING OBJECTS OF WORD AND DOCUMENT

Word.Application oWord = new Word.Application();

Word.Document oWordDoc = new Word.Document();

foreach (Word.Field myMergeField in oWordDoc.Fields)

{

    iTotalFields++;

    Word.Range rngFieldCode = myMergeField.Code;

    String fieldText = rngFieldCode.Text;    

    // ONLY GETTING THE MAILMERGE FIELDS    
    if (fieldText.StartsWith("tablename"))

    {
        myMergeField.Select();
        oWordDoc.table.add(rngFieldCode,4//for rows,4// for colioulns,ref omising....);
     }
} 
```

# .net - 无法在 .net 中发布 https WebRequest？

> ID：286375
> 
> 赞同：1
> 
> 时间：2008-11-13T06:30:52.817
> 
> 标签：.net, proxy, networking, webrequest, client-certificates

您好我在尝试在 Https 下发布 WebRequest 时遇到问题。

我收到以下错误

# 1.-底层连接已关闭：无法连接到远程服务器。

# 2.-操作超时

# 3-底层连接已关闭：无法为 SSL/TLS 建立安全通道。

我尝试了我公司和客户公司的大约 3 或 4 个不同的代理，即使我直接与 ISP 提供商没有任何限制，我在执行以下方法时遇到上述错误

```
WebRequest.GetRequestStream() 
```

这是否发生在代理后面，请求只能从代理后面的一台 PC 成功发布。代理没有安装客户端证书。

这是在 .net framework 1.1 下，并且请求已经包含网络凭据。

可能是什么？

# 更新

内部异常第三个错误如下：函数成功完成，但必须再次调用才能完成上下文

根据 iisper.h[文档](http://doc.ddart.net/msdn/header/include/issperr.h.html)，此错误属于

```
//
// MessageId: SEC_I_CONTINUE_NEEDED
//
// MessageText:
//
//  The function completed successfully, but must be called
//  again to complete the context
//
#define SEC_I_CONTINUE_NEEDED            ((HRESULT)0x00090312L) 
```

在[MSDN](http://msdn.microsoft.com/en-us/library/aa375924(VS.85).aspx)上，这是指

SEC_I_CONTINUE_NEEDED 客户端必须将输出令牌发送到服务器并等待返回令牌。然后将返回的令牌传递给 InitializeSecurityContext (Schannel) 的另一个调用。输出令牌可以为空。

这是否意味着 PC 缺少客户端证书？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T07:00:24.473

有很多事情可能会使事情复杂化，例如与 SSL 证书不一致等。但首先，您应该进行一些基本调试以排除明显的事情：

-- 您是否尝试向其他服务器发送简单的 Web 请求？尝试（不安全的）http 和（安全的）https

-- 您是否尝试从另一台计算机或其他网络连接？您提到客户端在代理后面；首先尝试带代理的计算机，以排除这种情况。

-- 您是否在会话中发出多个 WebRequest？打开请求的数量有硬性限制，因此请确保在获得 WebResponse 后关闭它们。也许只需要一个请求就可以制作一个测试程序。

如果这不能缩小范围，那么可能是更复杂的事情，与他们的服务器或代理有关。您可以使用诸如 netshark 之类的程序来跟踪传出的网络数据包，以尝试找出卡住的地方。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T07:16:43.880

您可以使用[Fiddler](http://www.fiddlertool.com/fiddler/)或网络数据包嗅探工具（如[~~Ethereal~~ Whireshark](http://www.wireshark.org/)）在其工作的机器和其他机器上跟踪 HTTP 流量，并比较结果。这是相当低级的，但可能会对这个问题有所了解。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T07:20:30.423

*   如果您可以从不同的机器远程登录到 443，那么它不是前两个，因为这意味着客户端机器正在该端口上接收请求。

在窗户上

```
telnet <domainname> 443 
```

如果它连接屏幕将变为空白（点击返回几次退出）

*   如果它在 HTTPS 下，代理可能会或可能不会真正关心您的请求，因为它们无法读取它。

*   其他机器是否安装了客户端证书和证书链？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T06:57:20.097

SSL 证书名称可能不匹配。这通常是自签名证书的情况。

解决方案是编写自己的身份验证例程，在此例程中始终返回 true 或执行必要的身份验证以确保证书有效。

```
// .NET 2.0+
...
ServicePointManager.ServerCertificateValidationCallback += MyValidationCallback
...
public bool MyValidationCallback(object sender, X509Certificate cert, X509Chain chain, SslPolicyErrors err)
{
  return true;
}

// .NET 1.1
public class MyCertificatePolicy : ICertificatePolicy
{
  public bool CheckValidationResult(ServicePoint srvPoint, X509Certificate certificate, WebRequest request, int certificateProblem)
  {
    return true;
  }
}
...
ServicePointManager.CertificatePolicy = new MyCertificatePolicy();
... 
```

# .net - 在 Windows XP 中编辑和创建 PPPoE 连接设置的任何语言（首选 .NET）的代码

> ID：286385
> 
> 赞同：0
> 
> 时间：2008-11-13T06:45:20.293
> 
> 标签：.net, windows, windows-xp, networking

几乎所有问题......我正在寻找批处理脚本、代码或库，**当硬件和基础设施已经存在时**，它们允许在 Windows 中编辑和创建 PPPoE 连接的**设置**。另外我正在寻找脚本/代码来更改活动连接。

 **.NET 是首选，但任何其他语言也可以。

提前致谢

第 MTH

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T14:52:17.637

我认为您应该寻找代码来创建/修改拨号连接或 DUN（拨号网络）。DialUp 并不总是意味着旧的 56kbps 调制解调器，它也可能意味着 PPPoE、PPPoA、Cable Modem 和所有其他可能需要登录的硬件。我没有代码，但是在谷歌中使用“以编程方式创建拨号”的简单搜索会出现一些示例。[专家交流](http://www.experts-exchange.com/Programming/Languages/.NET/Visual_Basic.NET/Q_23235781.html)中的一位。祝你好运

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T06:51:42.323

我认为 PPPOE 涉及低层连接而不是托管代码。一些网络设备暴露了某些类型的协议，比如 http？

# windows - 检查应用程序是否仍在从批处理文件运行？

> ID：286392
> 
> 赞同：1
> 
> 时间：2008-11-13T06:55:00.303
> 
> 标签：windows, batch-file, taskmanager

如何使用批处理文件检查应用程序是否仍在运行？如果应用程序仍在运行，则此过程将一次又一次地循环。否则，会有错误信息。

非常感谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-13T07:38:53.943

在 Windows 中，您可以使用[pstools](http://technet.microsoft.com/en-us/sysinternals/bb896649.aspx) pslist 通过使用 .cmd 脚本来检查进程名称是否正在运行，如下所示。如果进程正在运行，pslist 将返回 ERRORLEVEL 0，否则返回 1。

```
@echo off

CommandYouWillRun.exe

rem waiting for the process to start
:startcmd
sleep 1
c:\path\to\pslist.exe CommandYouWillRun > NUL
IF ERRORLEVEL 1 goto startcmd

rem the process has now started

:waitforcmd
sleep 1
c:\path\to\pslist.exe CommandYouWillRun > NUL
IF ERRORLEVEL 1 got finished
goto waitforcmd

:finished
echo "This is an error message" 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T07:02:52.580

Linux？

ps辅助| grep 任务 | wc -l

其中 task 是任务的名称（例如“apache2” - 不需要引号）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T07:45:12.323

您可以编写一个 powershell 脚本并将 get-process 与过滤一起使用。

[http://www.computerperformance.co.uk/powershell/powershell_process.htm](http://www.computerperformance.co.uk/powershell/powershell_process.htm)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T07:00:28.780

也许你的意思是任务列表？您可以从命令行运行它以获取 Windows 中的所有正在运行的进程......对于您所要求的其余内容，我认为您需要更具体。

# c# - 有没有办法定义两个元素字符串数组的 List<> ？

> ID：286399
> 
> 赞同：7
> 
> 时间：2008-11-13T07:00:59.700
> 
> 标签：c#, arrays, generics, data-structures

我想构建一维长度为2的二维字符串数组。与此类似

```
string[,] array = new string[,]
{
    {"a", "b"},
    {"c", "d"},
    {"e", "f"},
    {"g", "h"}
} 
```

正在做

```
List<string[]> list = new List<string[]>();

list.Add(new string[2] {"a", "b"});
list.Add(new string[2] {"c", "d"});
list.Add(new string[2] {"e", "f"});
list.Add(new string[2] {"g", "h"});

list.ToArray(); 
```

给我

```
string[][] 
```

但不是

```
string[,] 
```

大批。

只是好奇，是否有一些动态构建的技巧

```
string[,] 
```

以某种方式排列？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2012-05-20T07:36:18.117

你可以这样做。

```
List<KeyValuePair<string, string>> 
```

这个想法是键值对将模仿您复制的字符串数组。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-13T07:32:13.677

好吧，你可以相当容易地编写一个扩展方法来做到这一点。像这样的东西（只经过非常轻微的测试）：

```
public static T[,] ToRectangularArray<T>(this IEnumerable<T[]> source)
{
    if (!source.Any())
    {
        return new T[0,0];
    }

    int width = source.First().Length;
    if (source.Any(array => array.Length != width))
    {
         throw new ArgumentException("All elements must have the same length");
    }

    T[,] ret = new T[source.Count(), width];
    int row = 0;
    foreach (T[] array in source)
    {
       for (int col=0; col < width; col++)
       {
           ret[row, col] = array[col];
       }
       row++;
    }
    return ret;
} 
```

上面的代码使用 T[] 作为元素类型有点遗憾。由于通用不变性，我目前无法制作`IEnumerable<IEnumerable<T>>`很好的源代码。另一种方法可能是引入一个带有约束的新类型参数：

```
public static T[,] ToRectangularArray<T,U>(this IEnumerable<U> source)
    where U : IEnumerable<T> 
```

有点毛茸茸，但它应该工作。（显然实现也需要一些改变，但基本原理是一样的。）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T07:21:56.223

唯一的方法是自己实现该`ToArray()`功能。您可以在自己的集合中实现它（即`StringTupleCollection`）。这可以与`ArrayList`（即内部数组根据需要增加大小）相同。

但是，我不确定 over 的优势`[x,2]`（`[x][2]`甚至`List<string[2]>`是否足以保证付出努力。

你也可以写一个`StringTupple`类：

```
public class StringTupple : KeyValuePair<string, string>
{
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2020-06-26T15:51:39.703

你可以只使用一个结构。我在手动比较 XML 节点时这样做。

```
private struct XmlPair
{
    public string Name { set; get; }
    public string Value { set; get; }
}

List<XmlPair> Pairs = new List<XmlPair>(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T07:17:45.530

这对于 a 是不可能的`List<string[]>`，因为类型`string[,]`不同于`string[]`.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-09-05T21:11:16.367

当我必须检索控制器上复选框的值时，KeyValuePair 对我不起作用，因为我的 model.Roles 列表为空。

```
foreach (KeyValuePair<string, bool> Role in model.Roles){...} 
```

KeyValuePair 结构没有默认的无参数构造函数，无法由模型绑定器实例化。我为您的视图推荐一个只有这些属性的自定义模型类。[ASP.NET MVC 3 将 KeyValuePair 类型的用户控件绑定到 ViewModel](https://stackoverflow.com/questions/8538846/asp-net-mvc-3-binding-user-control-of-type-keyvaluepair-to-viewmodel)

[我在 MVC3.0](https://stackoverflow.com/questions/4872192/checkboxlist-in-mvc3-0)中的以下链接 CheckboxList 中找到了一个不使用 html 助手的 复选框列表的实现

# networking - 两台计算机通过 Internet 相互查找

> ID：286401
> 
> 赞同：14
> 
> 时间：2008-11-13T07:02:01.397
> 
> 标签：networking, network-protocols

假设两台连接到 Internet 的计算机事先对彼此一无所知，一台计算机是否有可能广播消息，以便第二台计算机可以接收并响应？

我知道存在 UDP 广播，但我相信这些广播通常会在到达真正的 Internet 之前被 ISP 过滤。这是真的？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-13T07:14:05.257

目前在没有集中协调的情况下实现多节点网络的最佳方法是使用[分布式哈希表](http://en.wikipedia.org/wiki/Distributed_hash_table)。该链接解释了一点，并链接到您可以利用的各种实现。

也就是说，您仍然需要每台机器至少与一些同行进行协调。只是您不需要它来与中央服务器协调。使用知道两台（所有）参与机器的中央服务器的解决方案也可以工作，但对匿名性和可扩展性施加了进一步的限制，只要记住 Napster 发生了什么。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-13T07:10:23.347

你需要一个他们都知道的中间第三方，它可以以类似广播的方式分发指向它的消息。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-13T07:38:56.613

这个问题的解决方案（您的对等方都不知道对方的最终地址）可能是依赖 IM 协议。

特别是，XMPP 协议是可扩展的、开放的，并被许多提供商（例如 Google Talk）使用。大多数语言都存在库，并且即使两个主机都在 NAT-box 后面，它也能够工作（缓慢并通过第 3 方服务器）。

如果通信必须使用另一个通道，您可以使用 XMPP 交换 IP 地址，然后继续使用标准套接字路由（但如果您加密您的消息，即使通过 3rd 方服务器也应该没有问题 - 是的，所有数据包都通过通过不受信任的第 3 方路由器，因此如果您有敏感数据，无论如何都应该加密......）。

希望这可以帮助。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T09:21:32.800

一个可能的解决方案是使用[动态 DNS](http://www.dyndns.com/services/dns/dyndns/)服务。

您的应用程序需要提前知道另一台主机将使用哪个主机名，但这项服务至少可以解决您不知道另一台计算机在哪个 IP 地址上的事实。

请注意，这不会解决两个主机之间的防火墙阻止您的数据包的潜在问题。唯一可行的方法是让两个主机都打开到中央主机的出站连接，然后中央主机可以在它们之间中继数据。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-13T07:05:39.503

不，你不能在互联网上这样广播。您需要知道要将数据包发送到哪个地址。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-08-23T11:49:21.687

查看和弦或糕点算法。它是一个覆盖网络（基于 DHT），其中涉及发现机制。这是一种 P2P（Peer 2 Peer）路由算法。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-13T07:47:07.297

UDP 是一个死胡同——它只是一个协议，其中接收数据包的顺序不太重要，并且存在通过 WANS 路由的问题。您说您想在“互联网”上连接两台计算机，大概是端点移动等。唯一的方法是使用中央服务器作为寄存器/目录。如果每个端点都是一个网络服务或其他东西，并定期注册其当前的 IP 地址和名称，那么另一个端点可以使用该服务查找另一个端点的 IP 地址。（可以托管您自己的 DNS 服务器并将您的端点编码为在此 DNS 上注册吗？）

问题之一是，即使您有 IP 地址，防火墙或 NAT 路由器后面的一个或多个节点是什么？您将需要托管服务器来代理流量。最好的例子是 SKYPE - 看看它是如何工作的，它被记录在案，非常有趣。

最简单的答案可能是跳过现有服务，例如 messanger、skype、bit torrent 等。

西蒙

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-25T14:46:18.643

如果计算机运行的是 Windows，我会考虑使用[PNRP](http://en.wikipedia.org/wiki/Peer_Name_Resolution_Protocol)。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2009-04-25T14:16:03.913

多播也是一种可能的解决方案。在企业网络中当然是可行的

# c++ - 使用数组初始化结构

> ID：286402
> 
> 赞同：4
> 
> 时间：2008-11-13T07:02:28.590
> 
> 标签：c++, c, parsing

我有几个数组：

```
const string a_strs[] = {"cr=1", "ag=2", "gnd=U", "prl=12", "av=123", "sz=345", "rc=6", "pc=12345"};
const string b_strs[] = {"cr=2", "sz=345", "ag=10", "gnd=M", "prl=11", "rc=6", "cp=34", "cv=54", "av=654", "ct=77", "pc=12345"}; 
```

然后我需要解析出'='，然后将值放入结构中。（rc键映射到struct中的fc键），其形式为：

```
struct predict_cache_key {
    pck() :
        av_id(0),
        sz_id(0),
        cr_id(0),
        cp_id(0),
        cv_id(0),
        ct_id(0),
        fc(0),
        gnd(0),
        ag(0),
        pc(0),
        prl_id(0)
    { }

    int av_id;
    int sz_id;
    int cr_id;
    int cp_id; 
    int cv_id;
    int ct_id;
    int fc;
    char gnd;
    int ag;
    int pc;
    long prl_id;
}; 
```

我遇到的问题是数组与结构字段不按顺序或顺序不同。所以，我需要检查每一个，然后想出一个方案来将它们放入结构中。

使用 C 或 C++ 解决上述问题有什么帮助吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-13T07:36:33.950

可能我没有正确理解，但明显的解决方案是将每个数组元素拆分为`key`然后`value`编写 lo-o-ong`if-else-if-else ...`序列，如

```
if (!strcmp(key, "cr"))
   my_struct.cr = value;
else if (!strcmp(key, "ag"))
   my_struct.ag = value;
... 
```

您可以在 C 预处理器的帮助下自动创建此类序列，例如

`#define PROC_KEY_VALUE_PAIR(A) else if (!strcmp(key,#A)) my_struct.##A = value`

因为引导`else`你这样写代码：

```
if (0);
PROC_KEY_VALUE_PAIR(cr);
PROC_KEY_VALUE_PAIR(ag);
... 
```

你们中的一些结构字段有`_id`后缀的唯一问题 - 对于他们你需要创建一个有点不同的宏来粘贴`_id`后缀

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-13T09:44:49.307

这应该不会太难。您的第一个问题是您没有固定大小的数组，因此您必须传递数组的大小，或者我希望您使数组以 NULL 结尾，例如

`const string a_strs[] = {"cr=1", "ag=2", "gnd=U", NULL};`

然后我会编写一个解析字符串的（私有）辅助函数：

```
 bool
parse_string(const string &str, char *buffer, size_t b_size, int *num)
{
    char *ptr;

    strncpy(buffer, str.c_str(), b_size);
    buffer[b_size - 1] = 0;

    /* find the '=' */
    ptr = strchr(buffer, '=');

    if (!ptr) return false;

    *ptr = '\0';
    ptr++;

    *num = atoi(ptr);

    return true;
} 
```

那么你可以按照qrdl的建议去做。

在一个简单的 for 循环中：

```
 for (const string *cur_str = array; *cur_str; cur_str++)
{
   char key[128];
   int value = 0;

   if (!parse_string(*cur_string, key, sizeof(key), &value)
       continue;

   /* and here what qrdl suggested */
   if (!strcmp(key, "cr")) cr_id = value;
   else if ...
} 
```

编辑：您可能应该使用 long 而不是 int 和 atol 而不是 atoi，因为您的 prl_id 是 long 类型。其次，如果 '=' 后面的数字格式错误，则应使用 strtol，它可以捕获错误。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-13T16:09:51.550

我编写了一些小代码，允许您初始化字段，而不必过多担心您的字段是否会随着初始化而出现故障。

以下是您在自己的代码中使用它的方式：

```
/* clients using the above classes derive from lookable_fields */
struct predict_cache_key : private lookable_fields<predict_cache_key> {
    predict_cache_key(std::vector<std::string> const& vec) {
        for(std::vector<std::string>::const_iterator it = vec.begin();
            it != vec.end(); ++it) {
            std::size_t i = it->find('=');
            set_member(it->substr(0, i), it->substr(i + 1));
         }
    }

    long get_prl() const {
        return prl_id;
    }

private:

    /* ... and define the members that can be looked up. i've only
     * implemented int, char and long for this answer. */
    BEGIN_FIELDS(predict_cache_key)
        FIELD(av_id);
        FIELD(sz_id);
        FIELD(gnd);
        FIELD(prl_id);
    END_FIELDS()

    int av_id;
    int sz_id;
    char gnd;
    long prl_id;
    /* ... */
};

int main() {
    std::string const a[] = { "av_id=10", "sz_id=10", "gnd=c",
                              "prl_id=1192" };
    predict_cache_key haha(std::vector<std::string>(a, a + 4));
} 
```

框架如下

```
template<typename T>
struct entry {
    enum type { tchar, tint, tlong } type_name;

    /* default ctor, so we can std::map it */
    entry() { }

    template<typename R>
    entry(R (T::*ptr)) {
        set_ptr(ptr);
    }

    void set_ptr(char (T::*ptr)) {
        type_name = tchar;
        charp = ptr;
    };

    void set_ptr(int (T::*ptr)) {
        type_name = tint;
        intp = ptr;        
    };

    void set_ptr(long (T::*ptr)) {
        type_name = tlong;
        longp = ptr;        
    };

    union {
        char (T::*charp);
        int  (T::*intp);
        long (T::*longp);
    };
};

#define BEGIN_FIELDS(CLASS)       \
    friend struct lookable_fields<CLASS>; \
    private:                      \
    static void init_fields_() {   \
        typedef CLASS parent_class;

#define FIELD(X) \
    lookable_fields<parent_class>::entry_map[#X].set_ptr(&parent_class::X)

#define END_FIELDS() \
    }                                                                              

template<typename Derived>
struct lookable_fields {
protected:
    lookable_fields() {
        (void) &initializer; /* instantiate the object */
    }

    void set_member(std::string const& member, std::string const& value) {
        typename entry_map_t::iterator it = entry_map.find(member);
        if(it == entry_map.end()) {
            std::ostringstream os;
            os << "member '" << member << "' not found";
            throw std::invalid_argument(os.str());
        }

        Derived * derived = static_cast<Derived*>(this);

        std::istringstream ss(value);
        switch(it->second.type_name) {
        case entry_t::tchar: {
            /* convert to char */
            ss >> (derived->*it->second.charp);
            break;
        }
        case entry_t::tint: {
            /* convert to int */
            ss >> (derived->*it->second.intp);
            break;
        }
        case entry_t::tlong: {
            /* convert to long */
            ss >> (derived->*it->second.longp);
            break;
        }
        }
    }

    typedef entry<Derived> entry_t;
    typedef std::map<std::string, entry_t> entry_map_t;
    static entry_map_t entry_map;

private:
    struct init_helper {
        init_helper() {
            Derived::init_fields_();
        }
    };

    /* will call the derived class's static init function */
    static init_helper initializer;
};

template<typename T> 
std::map< std::string, entry<T> > lookable_fields<T>::entry_map;

template<typename T> 
typename lookable_fields<T>::init_helper lookable_fields<T>::initializer; 
```

它使用鲜为人知的数据成员指针工作，您可以使用语法从类中获取它`&classname::member`。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T12:42:23.607

事实上，就像许多人回答的那样，需要将解析问题与对象构造问题分开。工厂模式非常适合这种情况。

Boost.Spirit 库还以一种非常优雅的方式解决了 parse->function 问题（使用 EBNF 表示法）。

我总是喜欢将“业务逻辑”与框架代码分开。

你可以通过以一种非常方便的方式开始写“你想做什么”并从那里开始“你是怎么做的”来实现这一点。

```
 const CMemberSetter<predict_cache_key>* setters[] = 
  #define SETTER( tag, type, member ) new TSetter<predict_cache_key,type>( #tag, &predict_cache_key::##member )
  { SETTER( "av", int, av_id )
  , SETTER( "sz", int, sz_id )
  , SETTER( "cr", int, cr_id )
  , SETTER( "cp", int, cp_id )
  , SETTER( "cv", int, cv_id )
  , SETTER( "ct", int, ct_id )
  , SETTER( "fc", int, fc )
  , SETTER( "gnd", char, gnd )
  , SETTER( "ag", int, ag )
  , SETTER( "pc", int, pc )
  , SETTER( "prl", long, prl_id )
  };

  PCKFactory<predict_cache_key> factory ( setters );

  predict_cache_key a = factory.factor( a_strs );
  predict_cache_key b = factory.factor( b_strs ); 
```

以及实现这一目标的框架：

```
 // conversion from key=value pair to "set the value of a member"
  // this class merely recognises a key and extracts the value part of the key=value string
  //
  template< typename BaseClass >
  struct CMemberSetter {

    const std::string key;
    CMemberSetter( const string& aKey ): key( aKey ){}

    bool try_set_value( BaseClass& p, const string& key_value ) const {
      if( key_value.find( key ) == 0 ) {
        size_t value_pos = key_value.find( "=" ) + 1;
        action( p, key_value.substr( value_pos ) );
        return true;
      }
      else return false;
    }
    virtual void action( BaseClass& p, const string& value ) const = 0;
  };

  // implementation of the action method
  //
  template< typename BaseClass, typename T >
  struct TSetter : public CMemberSetter<BaseClass> {
    typedef T BaseClass::*TMember;
    TMember member;

    TSetter( const string& aKey, const TMember t ): CMemberSetter( aKey ), member(t){}
    virtual void action( BaseClass& p, const std::string& valuestring ) const {
      // get value
      T value ();
      stringstream ( valuestring ) >> value;
      (p.*member) = value;
    }
  };

  template< typename BaseClass >
  struct PCKFactory {
    std::vector<const CMemberSetter<BaseClass>*> aSetters;

    template< size_t N >
    PCKFactory( const CMemberSetter<BaseClass>* (&setters)[N] )
      : aSetters( setters, setters+N ) {}

    template< size_t N >
    BaseClass factor( const string (&key_value_pairs) [N] ) const {
      BaseClass pck;

      // process each key=value pair
      for( const string* pair = key_value_pairs; pair != key_value_pairs + _countof( key_value_pairs); ++pair ) 
      {
        std::vector<const CMemberSetter<BaseClass>*>::const_iterator itSetter = aSetters.begin();
        while( itSetter != aSetters.end() ) { // optimalization possible
          if( (*itSetter)->try_set_value( pck, *pair ) )
            break;
          ++itSetter;
        }
      }

      return pck;
    }
  }; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T09:55:37.257

问题是您没有在运行时引用结构元素的元信息（类似于 structVar.$ElementName = ...，其中 $ElementName 不是元素名称而是包含元素名称的（char？）变量使用）。我的解决方案是添加此元信息。这应该是一个数组，其中包含结构中元素的偏移量。

Quick-n-Dirty 解决方案：您添加一个包含字符串的数组，生成的代码应如下所示：

```
const char * wordlist[] = {"pc","gnd","ag","prl_id","fc"};
const int  offsets[] = { offsetof(mystruct, pc), offsetof(mystruct, gnd), offsetof(mystruct, ag), offsetof(mystruct, prl_id), offsetof(mystruct, fc)};
const int sizes[] = { sizeof(mystruct.pc), sizeof(mystruct.gnd), sizeof(mystruct.ag), sizeof(mystruct.prl_id), sizeof(mystruct.fc)} 
```

输入一些东西，你会是这样的：

```
index = 0;
while (strcmp(wordlist[index], key) && index < 5)
    index++;
if (index <5)
   memcpy(&mystructvar + offsets[index], &value, sizes[index]);
else
   fprintf(stderr, "Key not valid\n"); 
```

如果你有更大的结构，这个插入循环可能会变得很昂贵，但是 C 不允许使用字符串进行数组索引。但是计算机科学找到了解决这个问题的方法：完美的哈希。

所以它后来看起来像这样：

```
hash=calc_perf_hash(key);
memcpy(&mystruct + offsets[hash], &value, sizes[hash]); 
```

但是如何获得这些完美的哈希函数（我称之为 calc_perf_hash）？它存在算法，您只需将关键字填入其中，功能就会出现，幸运的是有人甚至对其进行了编程：在您最喜欢的操作系统/发行版中查找“gperf”工具/包。在那里，您只需输入 6 个元素名称，他就会为您输出准备好使用 C 代码以获得完美的哈希函数（在默认情况下生成一个返回哈希的函数“hash”，以及一个决定是否给定的“in_word_set”函数键在单词列表中）。因为散列的顺序不同，所以您当然必须按照散列的顺序初始化 offsetof 和 size 数组。

您遇到的另一个问题（其他答案没有考虑）是类型转换。其他人做任务，我有（不是更好的）memcopy。在这里，我建议您将大小数组更改为另一个数组：

```
const char * modifier[]={"%i","%c", ... 
```

每个字符串都描述了要读入的 sscanf 修饰符。这样，您可以将分配/复制替换为

```
sscanf(valueString, modifier[hash], &mystructVar + offsets(hash)); 
```

当然，您可以在此处进行更改，方法是将“element=”包含到字符串或类似内容中。因此，您可以将完整的字符串放入 value 而不必对其进行预处理，我认为这在很大程度上取决于其余的解析例程。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-13T17:01:09.420

如果我在直接 C 中这样做，我不会使用所有 if 的母亲。相反，我会做这样的事情：

```
typedef struct {
    const char *fieldName;
    int structOffset;
    int fieldSize;
} t_fieldDef;

typedef struct {
    int fieldCount;
    t_fieldDef *defs;
} t_structLayout;

t_memberDef *GetFieldDefByName(const char *name, t_structLayout *layout)
{
    t_fieldDef *defs = layout->defs;
    int count = layout->fieldCount;
    for (int i=0; i < count; i++) {
        if (strcmp(name, defs->fieldName) == 0)
            return defs;
        defs++;
    }
    return NULL;
}

/* meta-circular usage */
static t_fieldDef metaFieldDefs[] = {
    { "fieldName", offsetof(t_fieldDef, fieldName), sizeof(const char *) },
    { "structOffset", offsetof(t_fieldDef, structOffset), sizeof(int) },
    { "fieldSize", offsetof(t_fieldDef, fieldSize), sizeof(int) }
};
static t_structLayout metaFieldDefLayout =
    { sizeof(metaFieldDefs) / sizeof(t_fieldDef), metaFieldDefs }; 
```

这使您可以在运行时使用结构布局的紧凑集合按名称查找字段。这相当容易维护，但我不喜欢`sizeof(mumble)`实际使用代码中的 - 这要求所有结构定义都带有注释标记，“不要在不更改`t_fieldDef`数组中的类型或内容的情况下更改它们”结构体”。也需要进行`NULL`检查。

我还希望查找是二进制搜索或哈希，但这对于大多数情况来说可能已经足够了。如果我要进行哈希，我会将指向`NULL`哈希表的指针放入`t_structLayout`并在第一次搜索时构建哈希。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-11-28T11:28:04.020

尝试了你的想法并得到了一个

```
error: ISO C++ forbids declaration of ‘map’ with no type 
```

在linux ubuntu eclipse cdt。

我想通知您应该包含`<map>`在“*.h”文件中，以便在没有此错误消息的情况下使用您的代码。

```
#include <map>

// a framework

template<typename T>
struct entry {
    enum type { tchar, tint, tlong } type_name;

    /* default ctor, so we can std::map it */
    entry() { }

    template<typename R>
    entry(R (T::*ptr)) { 
```

等等'等等'......

# java - Mac OS x 10.4 上的小程序加载问题

> ID：286418
> 
> 赞同：6
> 
> 时间：2008-11-13T07:16:51.460
> 
> 标签：java, macos, applet

我一直在开发包含 java 小程序的 Web 应用程序。我的应用在 IE 和 Firefox 等不同浏览器的 PC 上运行良好。托管在 Linux (Ubuntu) 上的 Web 应用程序。我在使用 Firefox 的 Mac 上遇到问题。我无法加载小程序。

这是我在 java 控制台中发现的错误。Java.lang.classNotFoundException web/applet/ImageObsApplet.class

我在 PC windows XP 上托管了 Web 应用程序，并且能够在 Mac 系统上加载 java 小程序。

### 更新：

我正在使用 J2SE 1.5.0。这在 Mac OS X 10.4 上不支持？我能够在 Mac OS X 10.5.5 上成功运行该应用程序。

现在我可以在 MAC OS X 10.4.11 上加载小程序了。但我遇到了小程序功能的问题。我的小程序将显示地图图像。Applet 在我的小程序左上角包含导航箭头键。这些键将用于在地图中导航。问题是当用户使用导航按钮时，图像被挤压和拉伸。这仅在 MAC OS X 10.4.11 上发生，并且在 PC 和 MAC OS X 10.5.5 上运行良好。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T20:06:31.370

我不确定，但 Mac 上的 firefox 存在 java 插件问题。我认为 10.4 上的 firefox 仅支持 Java 1.4。你试过野生动物园吗？

# macos - 如何构建 dmg Mac OS X 文件（在非 Mac 平台上）？

> ID：286419
> 
> 赞同：60
> 
> 时间：2008-11-13T07:17:44.610
> 
> 标签：macos, installation, dmg

是否可以从非 Mac 平台构建 .dmg 文件（用于分发应用程序）？如果是，如何？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2010-09-23T08:14:24.353

是的，mkfs.hfsplus 做到了。

```
dd if=/dev/zero of=/tmp/foo.dmg bs=1M count=64
mkfs.hfsplus -v ThisIsFoo /tmp/foo.dmg 
```

这将创建一个可以安装在 mac 上的 dmg 文件（在本例中为 64M）。它也可以挂载在linux上，比如

```
mount -o loop /tmp/foo.dmg /mnt/foo 
```

之后，您只需将您想要的内容复制到它（在 /mnt/foo 中）。卸载它，然后可以将 dmg 复制到 mac 并安装在那里。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2011-09-26T10:42:21.093

我从事的一个项目使用 genisoimage 在 Linux 上创建 DMG 文件：

```
mkdir -p dmgdir/progname.app/Contents/{MacOS,Resources}
...copy your PkgInfo, Info.plist to Contents...
...copy your .icns to Resources...
...copy your other things to where you expect them to go...
genisoimage -V progname -D -R -apple -no-pad -o progname.dmg dmgdir 
```

如果您想真正花哨，您可以`.DS_Store`从 Mac 上制作的 DMG 中窃取文件，该文件的卷名`progname`和应用程序包名为`progname.app`（即，与您想在 Mac 上创建的内容相匹配），您在其中放置了背景`.background/background.png`和根目录中 /Applications 的符号链接，并将其`dmgdir`与您自己的符号链接一起放入`/Applications`.

最后，如果要创建压缩 DMG，请从[libdmg-hfsplus](https://github.com/fanquake/libdmg-hfsplus)获取 dmg 工具：

```
dmg uncompressed.dmg compressed.dmg 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2013-07-18T22:25:13.633

```
git clone https://github.com/hamstergene/libdmg-hfsplus
cd libdmg-hfsplus && cmake . && make && cd dmg
./dmg --help 
```

生成文件：

```
dmg:
    genisoimage -D -V "$(PROJECT) $(VERSION)" -no-pad -r -apple -o project-$(VERSION)-uncompressed.dmg $(DARWIN_DIR)
    ./dmg dmg project-$(VERSION)-uncompressed.dmg project-$(VERSION).dmg 
```

开箱即用的未压缩作品，压缩可能会导致问题 - 源/主至少会在雪豹上产生“校验和”错误

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-11-13T10:15:22.630

似乎可以使用一些第三方工具创建 DMG 文件。快速的谷歌搜索显示至少一些商业工具：

*   [跨麦克](http://www.asy.com/scrtm.htm)
*   [魔术ISO](http://www.magiciso.com/download.htm)

不确定是否有任何 OSS/免费软件选项，但如果您愿意的话，至少看起来是可能的。

编辑：我也忘记了[MacDrive](http://www.mediafour.com/products/macdrive/)，这是另一个在 Windows 下使用 HFS+ 文件系统的好工具。由于 DMG 基本上只是 HFS+ 文件系统快照，因此 MacDrive 也可以创建 DMG。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-06-03T17:27:38.183

我不确定是否有人还在看这个帖子，但我按照**Nik Reiman**的推荐尝试**了 TransMac**。

 **使用这个工具，我能够在**Windows 7**上运行，创建可安装在**OSX 10.8.3上的****dmg**文件。

 *** * *

**缺点**

对我们来说唯一的缺点是这个工具似乎不是命令行友好的。对我们来说，这是一个大问题，因为我们需要能够拥有一个自动化工具，我们的构建服务器（基于 Windows）可以使用它来即时构建 dmg 文件。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-09-10T18:18:11.270

参见 mkfs.hfsplus

* * *

## 回答 #7

> 赞同：-36
> 
> 时间：2008-11-13T07:27:18.460

如果您正在分发 Mac 应用程序，那么您肯定有一台 Mac 可以编写和测试它们。为什么不简单地使用同一台 Mac 来创建磁盘映像？

[编辑] 或者，如果您正在分发便携式应用程序，例如 Java .jar 文件，为什么还要使用磁盘映像？Mac 可以很好地理解 .zip 和 .tar.gz 档案。

我想我的意思是，我不明白一个人可能需要 DMG 磁盘映像，但没有可以用来创建它的 Mac。

# algorithm - 在视频中找到有趣的帧

> ID：286422
> 
> 赞同：21
> 
> 时间：2008-11-13T07:17:55.327
> 
> 标签：algorithm, image-processing, video-processing

有谁知道我可以用来为视频找到“有趣”的代表性缩略图的算法？

我说有 30 张位图，我想选择最具代表性的一张作为视频缩略图。

显而易见的第一步是消除所有黑框。然后也许寻找各种帧之间的“距离”并选择接近平均值的东西。

这里有什么想法或发表的论文可以提供帮助吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-05T13:04:08.777

如果视频包含结构，即几个镜头，那么视频摘要的标准技术包括（a）镜头检测，然后（b）使用第一帧、中间帧或第 n 帧来表示每个镜头。见[1]。

但是，让我们假设您希望在从单个相机源拍摄的单个连续帧流中找到有趣的帧。即一枪。这就是 IR/CV（信息检索，计算机视觉）文本中广泛讨论的“关键帧检测”问题。一些说明性方法：

*   在 [2] 中，计算所有帧的平均颜色直方图，关键帧是最接近直方图的帧。即，我们根据颜色分布选择最佳帧。
*   在 [3] 中，我们假设相机静止是帧重要性的指标。正如上面的 Beds 所建议的那样。我们使用光流选择静止帧并使用它。
*   在[4]中，每一帧都被投影到一些高维内容空间中，我们在空间的角落找到那些帧，并用它们来表示视频。
*   在 [5] 中，使用它们在内容空间中的长度和新颖性来评估帧的重要性。

一般来说，这是一个很大的领域，有很多方法。您可以查看国际图像和视频检索会议 (CIVR) 等学术会议，了解最新的想法。我发现 [6] 对视频抽象（关键帧检测和总结）进行了有用的详细总结。

对于您的“找到 30 个位图中最好的”问题，我会使用 [2] 之类的方法。计算一个帧表示空间（例如帧的颜色直方图），计算一个直方图来表示所有帧，并使用两者之间距离最小的帧（例如选择一个最适合您的空间的距离度量。我会尝试地球移动距离）。

1.  刘女士。视觉信息检索原理。施普林格出版社，2001 年。
2.  B. Gunsel、Y. Fu 和 AM Tekalp。分层时间视频分割和内容表征。多媒体存储和归档系统 II，SPIE，3229：46-55，1997。
3.  W.狼。通过运动分析选择关键帧。在 IEEE 国际声学、语音和信号处理会议上，第 1228-1231 页，1996 年。
4.  L. Zhao、W. Qi、SZ Li、SQ Yang 和 HJ Zhang。使用最近特征线的关键帧提取和镜头检索。在 IW-MIR，ACM MM，第 217-220 页，2000 年。
5.  S.内桥。Video Manga：生成具有语义意义的视频摘要。在过程中。ACM Multimedia 99，佛罗里达州奥兰多市，11 月，第 383-292 页，1999 年。
6.  Y. Li、T. Zhang 和 D. Tretter。视频抽象技术概述。技术报告，惠普实验室，2001 年 7 月。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-13T09:26:55.067

你要文件，所以我找到了一些。如果您不在校园内或通过 VPN 连接到校园，这些文件可能很难获得。

**PanoramaExcerpts：为视频浏览提取和打包全景图**

[http://portal.acm.org/citation.cfm?id=266396](http://portal.acm.org/citation.cfm?id=266396)

这个解释了一种生成漫画风格关键帧表示的方法。

*抽象的：*

本文介绍了自动创建类似于漫画书的图片视频摘要的方法。视频片段的相对重要性是根据它们的长度和新颖性计算的。图像和音频分析用于自动检测和强调有意义的事件。基于这个重要性度量，我们选择相关的关键帧。选定的关键帧按重要性调整大小，然后有效地打包成图形摘要。我们对摘要捕捉视频中的显着事件的程度进行了定量测量，并展示了如何使用它来改进我们的摘要。结果是一个紧凑且视觉上令人愉悦的摘要，它捕获了语义上重要的事件，并且适用于打印或 Web 访问。通过包含源自 OCR 或其他方法的文本标题，可以进一步增强此类摘要。

**基于场景内容的代表性关键帧自动提取**

[http://ieeexplore.ieee.org/xpls/abs_all.jsp?arnumber=751008](http://ieeexplore.ieee.org/xpls/abs_all.jsp?arnumber=751008)

*抽象的：*

为电影生成索引是一个乏味且昂贵的过程，我们试图将其自动化。虽然寻找场景边界的算法很容易获得，但在选择单个帧以简洁地表示场景方面几乎没有工作。在本文中，我们提出了基于场景内容自动选择代表性关键帧的新算法。在详细描述几种算法之后，分析人类对所选帧代表场景的感觉如何。最后，我们讨论了如何将这些算法与现有算法集成以寻找场景边界。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-13T08:39:54.553

我认为你应该只看关键帧。

如果视频未使用基于关键帧的压缩进行编码，您可以根据以下文章创建算法：[通过运动分析选择关键帧](http://ieeexplore.ieee.org/xpl/freeabs_all.jsp?arnumber=543588)。

根据视频的压缩，您可以每 2 秒或 30 秒拥有关键帧。比我认为您应该使用文章中的算法从所有关键帧中找到“最多”的关键帧。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-14T15:18:18.347

偏爱美观的框架也可能是有益的。也就是说，寻找摄影的共同属性——纵横比、对比度、平衡等。

如果您不知道自己在寻找什么，就很难找到有代表性的镜头。但是通过一些启发式方法和我的建议，至少你可以想出一些好看的东西。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-05T13:15:55.913

我最近参与了一个项目，我们做了一些视频处理，就视频处理而言，我们使用[OpenCV](http://opencv.willowgarage.com/wiki/)来完成繁重的工作。我们必须提取帧、计算差异、提取人脸等。OpenCV 有一些内置算法可以计算帧之间的差异。它适用于各种视频和图像格式。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-13T07:55:10.167

哇，真是个好问题——我想第二步是迭代地删除它和它的后继者之间几乎没有变化或没有变化的帧。但是你真正做的只是减少*可能*有趣的帧集。我认为您如何确定“有趣性”是一种特殊的调味料，因为您没有像 Flickr 那样依赖的用户交互统计数据。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-13T08:06:52.483

导演有时会停留在一个特别“有趣”或美丽的镜头上，那么如何找到一个 5 秒不变的部分，然后消除那些几乎是黑色的部分？

# javascript - JavaScript：从 iframe 关闭窗口

> ID：286426
> 
> 赞同：0
> 
> 时间：2008-11-13T07:20:50.330
> 
> 标签：javascript, iframe

我有一个从站点 S1 加载的页面 P1，其中包含一个 iframe。该 iframe 从另一个站点 S2 加载页面 P2。在某些时候，P2 想要关闭浏览器窗口，其中包含从 S1 加载的 P1。当然，由于 P2 是从另一个站点加载的，它不能只执行 parent.close()。

我可以完全控制 P1 和 P2，因此我可以根据需要将 JavaScript 代码添加到 P1 和 P2。有关如何解决此问题的建议？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T07:55:08.873

这是不可能的，我害怕。由于安全问题，严格禁止从加载到不同站点的 iframe 中的 JavaScript，然后在其上呈现它的站点。

但是，如果 iframe 指向同一个站点，您可以像这样访问它：

```
<iframe name = "frame1" src = "http://yoursite">
</iframe>

<script type = "text/javascript">
    alert(window.frames["frame1"].document);
</script> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T08:26:00.743

如果它们来自同一个域，您可以修改安全限制以允许在子域之间进行修改。

设置 document.domain = "domain.com"; //在两个页面上，它们都可以互相修改。

将它们设置为虚假域可能会起作用，没有尝试过，或者只是简单地“.com”或其他东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T13:37:34.603

看起来[这家伙](http://blog.johnmckerrell.com/2006/10/22/resizing-iframes-across-domains/)让跨域 JavaScript 在 iframe 之间工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-18T22:24:58.707

您可以使用 Flash 来执行此操作。将用户发送到您使用带有 _top 目标的 URLRequest 控制的新顶级页面，并让该页面包含执行 window.close() 的 javascript。

# algorithm - 在 F# 中计算排列

> ID：286427
> 
> 赞同：14
> 
> 时间：2008-11-13T07:21:54.820
> 
> 标签：algorithm, f#, permutation

受此[问题](https://stackoverflow.com/questions/283561/extracting-leaf-paths-from-n-ary-tree-in-f)和[答案](https://stackoverflow.com/questions/283561/extracting-leaf-paths-from-n-ary-tree-in-f#283638)的启发，如何在 F# 中创建通用排列算法？谷歌没有给出任何有用的答案。

编辑：我在下面提供了我的最佳答案，但我怀疑托马斯的更好（当然更短！）

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-13T12:42:23.873

你也可以这样写：

```
let rec permutations list taken = 
  seq { if Set.count taken = List.length list then yield [] else
        for l in list do
          if not (Set.contains l taken) then 
            for perm in permutations list (Set.add l taken)  do
              yield l::perm } 
```

'list' 参数包含您想要置换的所有数字，而 'taken' 是一个包含已使用数字的集合。当所有数字都取完时，该函数返回空列表。否则，它会遍历所有仍然可用的数字，获取剩余数字的所有可能排列（递归地使用“排列”）并在返回之前将当前数字附加到每个数字（l::perm）。

要运行它，您将给它一个空集，因为开头没有使用数字：

```
permutations [1;2;3] Set.empty;; 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2010-02-02T12:56:34.357

我喜欢这个实现（但不记得它的来源）：

```
let rec insertions x = function
    | []             -> [[x]]
    | (y :: ys) as l -> (x::l)::(List.map (fun x -> y::x) (insertions x ys))

let rec permutations = function
    | []      -> seq [ [] ]
    | x :: xs -> Seq.concat (Seq.map (insertions x) (permutations xs)) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-07-05T15:32:51.030

Tomas 的解决方案非常优雅：它很短，纯粹是功能性的，而且很懒惰。我认为它甚至可能是尾递归的。此外，它还按字典顺序产生排列。但是，我们可以在内部使用命令式解决方案将性能提高两倍，同时仍然在外部公开功能接口。

该函数`permutations`采用通用序列`e`和通用比较函数`f : ('a -> 'a -> int)`，并按字典顺序懒惰地产生不可变的排列。比较函数允许我们生成不一定的元素排列`comparable`以及轻松指定反向或自定义排序。

内部函数是[此处](https://stackoverflow.com/questions/352203/generating-permutations-lazily/353248#353248)`permute`描述的算法的命令式实现。转换函数允许我们使用重载，它使用.`let comparer f = { new System.Collections.Generic.IComparer<'a> with member self.Compare(x,y) = f x y }``System.Array.Sort``IComparer`

```
let permutations f e =
    ///Advances (mutating) perm to the next lexical permutation.
    let permute (perm:'a[]) (f: 'a->'a->int) (comparer:System.Collections.Generic.IComparer<'a>) : bool =
        try
            //Find the longest "tail" that is ordered in decreasing order ((s+1)..perm.Length-1).
            //will throw an index out of bounds exception if perm is the last permuation,
            //but will not corrupt perm.
            let rec find i =
                if (f perm.[i] perm.[i-1]) >= 0 then i-1
                else find (i-1)
            let s = find (perm.Length-1)
            let s' = perm.[s]

            //Change the number just before the tail (s') to the smallest number bigger than it in the tail (perm.[t]).
            let rec find i imin =
                if i = perm.Length then imin
                elif (f perm.[i] s') > 0 && (f perm.[i] perm.[imin]) < 0 then find (i+1) i
                else find (i+1) imin
            let t = find (s+1) (s+1)

            perm.[s] <- perm.[t]
            perm.[t] <- s'

            //Sort the tail in increasing order.
            System.Array.Sort(perm, s+1, perm.Length - s - 1, comparer)
            true
        with
        | _ -> false

    //permuation sequence expression 
    let c = f |> comparer
    let freeze arr = arr |> Array.copy |> Seq.readonly
    seq { let e' = Seq.toArray e
          yield freeze e'
          while permute e' f c do
              yield freeze e' } 
```

现在为方便起见，我们有以下 where `let flip f x y = f y x`：

```
let permutationsAsc e = permutations compare e
let permutationsDesc e = permutations (flip compare) e 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T08:42:49.727

我最新的最佳答案

```
//mini-extension to List for removing 1 element from a list
module List = 
    let remove n lst = List.filter (fun x -> x <> n) lst

//Node type declared outside permutations function allows us to define a pruning filter
type Node<'a> =
    | Branch of ('a * Node<'a> seq)
    | Leaf of 'a

let permutations treefilter lst =
    //Builds a tree representing all possible permutations
    let rec nodeBuilder lst x = //x is the next element to use
        match lst with  //lst is all the remaining elements to be permuted
        | [x] -> seq { yield Leaf(x) }  //only x left in list -> we are at a leaf
        | h ->   //anything else left -> we are at a branch, recurse 
            let ilst = List.remove x lst   //get new list without i, use this to build subnodes of branch
            seq { yield Branch(x, Seq.map_concat (nodeBuilder ilst) ilst) }

    //converts a tree to a list for each leafpath
    let rec pathBuilder pth n = // pth is the accumulated path, n is the current node
        match n with
        | Leaf(i) -> seq { yield List.rev (i :: pth) } //path list is constructed from root to leaf, so have to reverse it
        | Branch(i, nodes) -> Seq.map_concat (pathBuilder (i :: pth)) nodes

    let nodes = 
        lst                                     //using input list
        |> Seq.map_concat (nodeBuilder lst)     //build permutations tree
        |> Seq.choose treefilter                //prune tree if necessary
        |> Seq.map_concat (pathBuilder [])      //convert to seq of path lists

    nodes 
```

permutations 函数通过构造一个表示传入的“事物”列表的所有可能排列的 n 元树来工作，然后遍历树以构造列表列表。使用“Seq”可以显着提高性能，因为它会使一切变得懒惰。

permutations 函数的第二个参数允许调用者在生成路径之前定义一个过滤器来“修剪”树（参见下面的示例，我不想要任何前导零）。

一些示例用法： Node<'a> 是通用的，因此我们可以对“任何东西”进行排列：

```
let myfilter n = Some(n)  //i.e., don't filter
permutations myfilter ['A';'B';'C';'D'] 

//in this case, I want to 'prune' leading zeros from my list before generating paths
let noLeadingZero n = 
    match n with
    | Branch(0, _) -> None
    | n -> Some(n)

//Curry myself an int-list permutations function with no leading zeros
let noLZperm = permutations noLeadingZero
noLZperm [0..9] 
```

（特别感谢[Tomas Petricek](https://stackoverflow.com/questions/283561/extracting-leaf-paths-from-n-ary-tree-in-f#283638)，欢迎提出任何意见）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-04-14T10:10:41.223

看看这个：

[http://fsharpcode.blogspot.com/2010/04/permutations.html](http://fsharpcode.blogspot.com/2010/04/permutations.html)

```
let length = Seq.length
let take = Seq.take
let skip = Seq.skip
let (++) = Seq.append
let concat = Seq.concat
let map = Seq.map

let (|Empty|Cons|) (xs:seq<'a>) : Choice<Unit, 'a * seq<'a>> =
    if (Seq.isEmpty xs) then Empty else Cons(Seq.head xs, Seq.skip 1 xs)

let interleave x ys =
    seq { for i in [0..length ys] ->
            (take i ys) ++ seq [x] ++ (skip i ys) }

let rec permutations xs =
            match xs with
            | Empty -> seq [seq []]
            | Cons(x,xs) -> concat(map (interleave x) (permutations xs)) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-08-23T19:09:27.363

如果您需要不同的排列（当原始集合有重复时），您可以使用这个：

```
let rec insertions pre c post =
    seq {
        if List.length post = 0 then
            yield pre @ [c]
        else
            if List.forall (fun x->x<>c) post then
                yield pre@[c]@post
            yield! insertions (pre@[post.Head]) c post.Tail
        }

let rec permutations l =
    seq {
        if List.length l = 1 then
            yield l
        else
            let subperms = permutations l.Tail
            for sub in subperms do
                yield! insertions [] l.Head sub
        } 
```

这是[此](https://stackoverflow.com/questions/361/generate-list-of-all-possible-permutations-of-a-string/3178268#3178268)C# 代码的直接翻译。我愿意接受有关更实用的外观的建议。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-05-10T07:06:48.627

如果您需要重复排列，这是使用 List.indexed 而不是元素比较的“按书本”方法在构造排列时过滤掉元素。

```
let permutations s =
    let rec perm perms carry rem =
        match rem with
            | [] -> carry::perms
            | l ->
                let li = List.indexed l
                let permutations =
                        seq { for ci in li ->
                                let (i, c) = ci
                                (perm
                                        perms
                                        (c::carry)
                                        (li |> List.filter (fun (index, _) -> i <> index) |> List.map (fun (_, char) -> char))) }

                permutations |> Seq.fold List.append []
    perm [] [] s 
```

# windows - 在给定 .SPC 文件的情况下签署 Windows 应用程序？

> ID：286429
> 
> 赞同：5
> 
> 时间：2008-11-13T07:22:27.690
> 
> 标签：windows, code-signing

我的客户想要签署应用程序代码。他给了我一个用于签署 .NET 桌面应用程序的 .spc 文件。我应该如何在应用程序中使用它？

谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-13T07:27:35.370

[http://ellisweb.net/2008/08/signing-code-using-pvk-and-spc-files/](http://ellisweb.net/2008/08/signing-code-using-pvk-and-spc-files)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2013-07-18T04:38:51.093

有一个简单的选项。安装您的 spc 文件。转到 Internet Explorer=>tools=>content=> 证书。然后选择您的证书并单击导出选项。您可以生成 Pfx 文件。

然后您可以在 Visual Studio 的项目属性的签名选项卡中设置此 pfx 文件

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2008-11-13T07:46:36.457

您在将程序集发送给您的客户之前对其进行签名。您可以在项目设置中的 Visual Studio 中自动执行此操作。

# py2exe - 使python程序可执行

> ID：286441
> 
> 赞同：4
> 
> 时间：2008-11-13T07:31:36.580
> 
> 标签：py2exe

```
from distutils.core import setup
import py2exe, sys, os

sys.argv.append('py2exe')

setup(
    options = {'py2exe': {'bundle_files': 1}},
    windows = [{'script': "single.py"}],
    zipfile = None,
) 
```

在py2exe的这个设置文件中，它说single.py是我放置程序名称的地方？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-13T08:14:30.410

我不知道你的py2exe工具，但我们通常使用这种方式将py转换为exe：

1.  下载并安装标准 Python 软件： http: [//www.python.org/download/](http://www.python.org/download/)

2.  通过以下链接下载 PyInstaller：http: [//pyinstaller.python-hosting.com/](http://pyinstaller.python-hosting.com/)

3.  解压已下载的存档！在此示例中，解压缩文件的目录：

4.  在该`<UNPACKED_FILES_DIR>`目录中，运行 Configure.py。它必须在尝试构建任何东西之前运行。

5.  为您的项目创建一个规范文件：

    ```
    python Makespec.py -F -p <PYTHON_LIB_PATH> <PYTHON_SCRIPT>
      -F: Produce a single file deployment.
      -p <PYTHON_LIB_PATH>: Set base path for import (like using PYTHONPATH).
         ( e.g.: C:\Program Files\Python24\Lib\ )
      <PYTHON_SCRIPT>: Path to python script. 
    ```

6 构建您的项目！

```
 python Build.py <SPECFILE>
      <SPECFILE>: Path to the specfile, that have been created in step 4! 

    The full path to <SPECFILE>:
      <UNPACKED_FILES_DIR>/<PYTHON_SCRIPT>/<PYTHON_SCRIPT>.spec 
```

7.  二进制文件将放置在`<SPECFILE>`.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-11-02T10:10:04.710

如果您可以限制您的代码，那么[Shed Skin](http://shed-skin.blogspot.com/)、[PyPy](http://www.rfk.id.au/blog/entry/compiling-rpython-programs/)或[Cython](https://stackoverflow.com/questions/2581784/can-cython-compile-to-an-exe)可以生成真正、快速的可执行文件。

[Py2exe、PyInstaller 或 bbfreeze](https://stackoverflow.com/questions/112698/py2exe-generate-single-executable-file)可以将最高 2.7 的 Python 打包成单个可执行文件。

[Cx_Freeze 将](https://stackoverflow.com/q/2553886/819417)Python 最高 3.x 打包成可执行文件和许多其他文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T08:10:27.640

是的。您是在制作窗口应用程序还是控制台应用程序？请参阅 py2exe 附带的示例 setup.py 文件。

# .net - “CDO.Appointment”在哪里

> ID：286459
> 
> 赞同：0
> 
> 时间：2008-11-13T07:44:02.607
> 
> 标签：.net, vb.net, calendar, exchange-server, cdo.message

我正在使用 VB .NET 2005 和安装的 Exchange Server 2003 我找到了一些代码，这些代码使我能够连接到 Exchange Server 并创建约会。问题是我找不到 CDO。预约。我在哪里可以找到它并使下面的代码工作？我已经使用 CDO 和 Outlook 尝试了所有示例。我相信下面的代码需要在 Exchange 环境中生成并使用 CDOEX.DLL ？感谢您能给我的任何帮助或想法。谢谢

[示例代码]

```
sURL = "http://ExchangeServername/Exchange/testuser/calendar"

        Dim oCn As ADODB.Connection = New ADODB.Connection()

        'oCn.Provider = "exoledb.datasource";
   'I am using the below provider because I am in the client side 
    oCn.Provider = "MSDAIPP.DSO"

        oCn.Open(sURL, "testuser", "q1w2e3r4t5", 0)
        If oCn.State = 1 Then
            MsgBox("Good Connection")
        Else
            MsgBox("Bad Connection")
            Return
        End If

        Dim iConfg As CDO.Configuration = New CDO.Configuration()
        Dim oFields As ADODB.Fields

        oFields = iConfg.Fields
        oFields.Item(CDO.CdoCalendar.cdoTimeZoneIDURN).Value = CDO.CdoTimeZoneId.cdoAthens
        'oFields.Item(CDO.CdoConfiguration.cdoSendEmailAddress).Value = "test@test.com"
        oFields.Update()

        Dim oApp As CDO.Appointment = New CDO.Appointment()
         oApp.Configuration = iConfg
        oApp.StartTime = Convert.ToDateTime("10/11/2001 10:00:00 AM")
        oApp.EndTime = Convert.ToDateTime("10/11/2001 11:00:00 AM")
        oApp.Location = "My Location"
        oApp.Subject = "Test: Create Meeting in VB.NET"
        oApp.TextBody = "Hello..."

        '' Add recurring appointment
        '' Every Thursday starting today, and repeat 3 times.

        '' Save to the folder
        oApp.DataSource.SaveToContainer(sURL, , _
         ADODB.ConnectModeEnum.adModeReadWrite, _
         ADODB.RecordCreateOptionsEnum.adCreateNonCollection, _
         ADODB.RecordOpenOptionsEnum.adOpenSource, _
         "", "")

        oCn.Close()

        oApp = Nothing
        oCn = Nothing
        oFields = Nothing 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-16T02:18:38.997

CDO.Appointment 确实是某些版本的 Exchange、SPS 和 Office 附带的 cdoex.dll（Exchange 协作数据对象）的一部分。您可以在您的机器上下载并注册 cdoex.dll，并在您的 VB.Net 应用程序中引用它。

这些帖子应该会有所帮助：

*   [http://support.microsoft.com/kb/310557](http://support.microsoft.com/kb/310557)
*   [http://mrspeaker.webeisteddfod.com/2005/05/02/cdoex/](http://mrspeaker.webeisteddfod.com/2005/05/02/cdoex/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-16T02:25:49.340

`cdoex.dll`如果您在本地 PC 或服务器上找不到副本，请尝试以下下载：

[http://www.google.nl/search?q=download+CDOEX.DLL](http://www.google.nl/search?q=download+CDOEX.DLL)

# apache-flex - mx:在 Flex 中移动竞争条件

> ID：286462
> 
> 赞同：0
> 
> 时间：2008-11-13T07:45:13.370
> 
> 标签：apache-flex, race-condition

在 Flex 我有很多`Move`效果和`AnimateProperty`效果。

我在代码的几个不同位置发现，效果过于频繁地在没有明显原因的情况下中途停止。

我在我的应用程序的许多地方都发现了这一点，无论我是否在做一些特别复杂的事情，它都会发生。

有没有其他人遇到过这个问题？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-14T20:34:16.540

我没有专门遇到过这个问题，但是您可能想查看 Parallel () 和 Sequential 以确保它在第一个效果完成之前不会启动另一个效果。

这个问题可能是您的应用程序试图同时做太多事情以及帧速率受到影响的副产品，因此它使您的过渡不稳定。您可以延长过渡的持续时间，也可以尝试简化您的应用程序以减少工作量。高温高压

# asp.net - 在 Web 和非 Web 应用程序之间共享 HttpContext 代码

> ID：286468
> 
> 赞同：2
> 
> 时间：2008-11-13T07:49:42.627
> 
> 标签：asp.net, vb.net, httpcontext

我有一个 VB.NET 模块，它从资源文件中读取以正确的语言显示文本。这是我的问题 - 此代码在 Web 应用程序和非 Web 应用程序之间共享，在 Web 应用程序中，我使用 System.Web.HttpContext 来确定用户的首选语言，但现在我的 Windows 应用程序甚至无法编译，因为它说 HttpContext 没有定义（我已经尝试为完整的命名空间添加导入 - 没有骰子）。

如果我不能以其他方式解决它，我很想使用某种 try/catch 块，但这不会改变 Windows 应用程序不会在其中引用 HttpContext 进行编译。如果不将这段代码移动到一个新文件中并仅将其包含在 Web 应用程序中（我不拥有该应用程序，所以我宁愿不处理这些影响），我是否还有其他选择来处理这个问题？

如果这没有意义，请告诉我，我会尽力澄清。

**解决方案：**我刚刚添加了对 System.Web 的引用，它允许我的应用程序编译。我还将 HttpContext 引用包装在“If HttpContext.Current isnot Nothing Then...End If”块中，如果它没有作为 Web 应用程序运行，这会导致它跳过代码，这正是我正在寻找的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-02T20:23:03.063

如果您引用 System.Web 程序集，那么您应该有权访问 HttpContext.Current，它是对当前正在运行的 Web 应用程序的 HttpContext 对象的引用。如果应用程序是普通的 Win32 应用程序，则此引用应为空指针。因此在 C# 中你可以使用： `if (HttpContext.Current == null)` 或者在 VB 中你可以使用： `If HttpContext.Current Is Nothing Then`

但是，我从来没有尝试过做这种事情，所以我不能保证结果。让我知道这是否适合你。

谢谢， C

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T07:59:04.043

即使应用程序可以编译，您也会遇到 WinApp 中没有 HttpContext 的问题。

您可以重构 webapp，以便它使用服务而不是 HttpContext。IContextService 或一堆服务（ICacheService、ISessionService 等）。

该服务将有两种实现：一种用于将使用 HttpContext 的 Web 应用程序，另一种用于 Winapp，其实现将包含确定用户偏好（语言等）的必要逻辑。

如果首选项存储在服务器上，您将需要实现某种服务来在您的 winapp 和服务器之间进行通信。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T09:02:26.507

我认为你可以使用一点解耦！

如果您要创建这样的接口（例如在您的 BLL 层中）

```
public interface IPreferredLanguage
{
     String PeferredLanguage { get; set; }
} 
```

并且您创建了两个实现：

在您的网站项目中：

```
public class WebPeferredLanguage : IPreferredLanguage
{
     public String PeferredLanguage
     {
          get
          {
               return // retrieve the language from the http context
          }
          set
          {
               // set the preferred language in the HttpContext
          }
     } 
} 
```

在您的 winforms 项目中：

```
public class WinformsPeferredLanguage : IPreferredLanguage
{
     public String PeferredLanguage
     {
          get; set; // automatic properties
     } 
} 
```

此后，您使用[控制反转](http://en.wikipedia.org/wiki/Inversion_of_control)（Unity、StructureMap、MicroKernel）在您的 webconfig 中配置应使用 WebPeferredLanguage 的实例，并应在您的 winforms 中返回 WinformsPeferredLanguage 的单例实例。

在您的代码中，每当您需要了解该语言时，您只需向 IoC 容器询问 IPreferredLanguage 的正确实现，它就会返回您配置的类型的对象。

所以在你的 bll 中你可以编程（例如）：

```
public String GetEmailMessage()
{
    var currentLanguage = IoC.Resolve<IPreferredLanguage>().PeferredLanguage;
    return Resources[currentLanguage ].EmailMessage;
} 
```

写完这篇文章后，我看到你想要一个 VB.NET 解决方案。好吧，这些例子仍然适用，只是语法略有不同（抱歉，如果这样读起来更难）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T07:51:49.877

您可以将 System.Web.dll 添加到您的应用程序，然后使用 HttpContext。问题是win应用程序中没有HttpContext，因此您应该使用Web服务或WCF在两个应用程序之间进行通信。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T08:11:46.017

如果可能，您可以做的最好的事情可能是完全消除对在共享程序集中拥有 HTTP 上下文的依赖。

例如，您提到的使用 HttpContext 获取用户首选的方法可以重构，以便将语言作为参数给出。当您从 Web 应用程序调用该方法时，您可以从 HttpContext 传递语言，当您从 Windows 应用程序调用它时，您需要从另一个源传递语言。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-03-02T08:36:26.293

你应该使用

```
Thread.CurrentUICulture 
```

来确定用户语言。WinForms 和 WebApplication 也支持它。

在大多数情况下，.NET 框架为您设置了它。

您可以在程序/线程启动时进行设置。在 Web 应用程序中，您可以在 Application_BeginRequest 的 Global.asax.cs 中设置它。

# py2exe - py2exe 生成器不工作

> ID：286471
> 
> 赞同：1
> 
> 时间：2008-11-13T07:54:46.457
> 
> 标签：py2exe

我运行了这个 setup.py 文件

```
from distutils.core import setup

import py2exe, sys, os

sys.argv.append('py2exe')

setup(
    options = {'py2exe': {'bundles_files': 1}},

    windows = [{'script': "Driverscript.py"}],

    zipfile = None,

) 
```

这会创建可执行文件和包，但每次我尝试运行它时它都不会运行它说它遇到错误并且每次都必须关闭。我需要先做些什么或者我的 setup.py 文件有什么问题吗？非常感谢所有输入谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T08:19:33.020

您的错误日志的输出是什么？这可能意味着很多事情。我假设您正在编译一个窗口应用程序？您是否在 Windows 上运行此应用程序？您可能希望从命令行运行应用程序并查看是否有任何错误。

# c# - .Net 运行时编译器是否支持 C# 3.0？

> ID：286475
> 
> 赞同：2
> 
> 时间：2008-11-13T07:56:46.653
> 
> 标签：c#, .net

看起来运行时编译器不支持与命令行编译器相同的语言，所以如果你想使用 lambda 表达式、扩展方法或 LINQ，那么你就被卡住了。

这里有更多细节：

[http://metadatalabs.com/blog/](http://metadatalabs.com/blog/)

这是正确的还是有解决方法？（当然，没有产生命令行编译器。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T08:20:25.890

我一直在使用它，它似乎在使用 .Net 3.5 编译时有效

```
CodeDomProvider provider = new CSharpCodeProvider(new Dictionary<string, string> { { "CompilerVersion", "v3.5" } }); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T08:21:58.257

[查看CSharpCodeProvider 构造函数](http://msdn.microsoft.com/en-us/library/bb537926.aspx)的文档：

> providerOptions 的值是从配置文件中的元素获取的。您可以通过指定元素、提供“CompilerVersion”作为选项名称以及提供版本号（例如，“v3.5”）作为选项值来标识要使用的 CSharpCodeProvider 的版本。您必须在版本号前加上小写“v”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T08:16:38.953

这家伙的博客似乎有答案

[CodeDomProviders](http://andersnoras.com/blogs/anoras/archive/2008/04/13/codedomproviders-and-compiler-magic.aspx)

看起来工厂默认它返回的实例为 2.0。

这似乎是一种非常疯狂的技术。保罗格雷厄姆在某处哭泣。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T08:09:07.020

我没试过，但听起来很疯狂..

将来这不会成为问题，因为 .NET 团队将 C# 编译器作为服务提供，这意味着您可以在代码中使用真正的 C# 编译器。看看这个视频：

[http://channel9.msdn.com/pdc2008/TL16/](http://channel9.msdn.com/pdc2008/TL16/)

# programming-languages - 为什么在命令式或 OO 语言（如 C/C++/C#/Java...）中不存在交换/交换运算符？

> ID：286481
> 
> 赞同：8
> 
> 时间：2008-11-13T08:07:57.600
> 
> 标签：programming-languages, language-design

我一直想知道为什么像交换两个变量的内容这样简单而基本的操作对于许多语言来说不是内置的。

它是计算机科学课程中最基本的编程练习之一；它在许多算法中大量使用（例如排序）；时不时地需要它，并且必须使用临时变量或使用模板/通用函数。

它甚至是许多处理器上的基本机器指令，因此带有临时变量的标准方案将得到优化。

已经创建了许多不太明显的运算符，例如赋值运算符（例如 +=，它可能是为了反映累积的机器指令而创建的，例如 add ax,bx），或 ?? C# 中的运算符。

那么，是什么原因呢？还是它真的存在，而我总是错过它？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-13T08:28:58.523

根据我的经验，除了已经提到的排序算法和偶尔在低级硬件戳中之外，实际应用程序中通常不需要它，所以在我看来，在通用语言中它有点太特殊了.

如前所述，并非所有处理器都支持它作为指令（并且许多处理器不支持大于单词的对象）。因此，如果它支持一些有用的附加语义（例如，作为原子操作），则很难在某些处理器上支持，如果它没有附加语义，那么它只是（很少使用）合成糖。

支持分配运算符（+= 等），因为它们在现实世界的程序中更为常见 - 因此它们提供的语法糖更有用，而且作为一种优化 - 记住 C 可以追溯到 60 年代末/70 年代初，并且编译器优化没有那么先进（而且机器能力较差，所以无论如何你都不想要冗长的优化过程）。

保罗

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-13T08:48:46.923

C++*确实*有交换。

```
#include <algorithm>
#include <cassert>

int
main()
{
    using std::swap;
    int a(3), b(5);
    swap(a, b);
    assert(a == 5 && b == 3);
} 
```

此外，您也可以专注`swap`于自定义类型！

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-13T08:29:22.767

这是计算机科学课程中广泛使用的示例，但我几乎*从未*发现自己在实际代码中需要它——而我经常使用 +=。

是的，在排序时它会很方便——但您不需要自己实现排序，因此源代码中的实际使用次数仍然很低。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T08:10:28.357

您确实有[XOR 运算符](https://stackoverflow.com/questions/249423/how-does-xor-variable-swapping-work)对原始类型进行变量替换...

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-13T08:41:40.417

我想他们只是忘了添加它 :-) 是的，不是所有的 CPU 都有这种指令，那又如何呢？我们还有很多其他的东西，大多数 CPU 没有指令来计算。如果我们拥有它，它会更容易/更清晰，也更快（通过内在）！

# tracd - Tracd创建环境

> ID：286483
> 
> 赞同：1
> 
> 时间：2008-11-13T08:09:47.017
> 
> 标签：tracd

我试图使用以下命令创建一个 Tracd 环境：

trac-admin D:\My_Project initenv

我收到一条错误消息

导入错误：没有名为 pkg_resources 的模块

我错过了什么？我已经安装了 Genshi 和 Python 2.5.2

谢谢...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T13:31:41.480

阅读[Trac 维基](http://trac.edgewall.org/wiki/TracOnWindows#using-installers)。您需要[setuptools](http://trac.edgewall.org/wiki/SetupTools)，您可以[在此处](http://pypi.python.org/packages/2.5/s/setuptools/setuptools-0.6c7.win32-py2.5.exe#md5=395a81d709766f3a0d6084964cb98b5a)下载。

# python - 考虑变化的路径

> ID：286486
> 
> 赞同：2
> 
> 时间：2008-11-13T08:10:28.357
> 
> 标签：python, file, path

关于[另一个问题](https://stackoverflow.com/questions/283431/why-would-an-command-not-recognized-error-occur-only-when-a-window-is-populated)，你如何解释可能改变的路径？例如，如果一个程序正在调用与该程序位于同一目录中的文件，您可以简单地使用 *nix 中的路径“.\foo.py”。然而，显然 Windows 喜欢硬编码路径，例如“C:\Python_project\foo.py”。

如果路径改变会发生什么？例如，文件可能不在 C: 驱动器上，而是在拇指驱动器或可以更改驱动器号的外部驱动器上。该文件可能仍与程序位于同一目录中，但与代码中的驱动器号不匹配。

我希望程序是跨平台的，但我希望我可能必须使用**os.name**或其他东西来确定要使用哪个路径代码块。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-13T10:54:40.540

简单回答：你根据环境算出绝对路径。

你真正需要的是一些指针。您可以从标准库的不同位置收集到各种运行时和环境信息（当我想在 Windows 上部署应用程序时，它们肯定会帮助我）。

所以，首先一些一般的事情：

1.  `os.path`- 具有大量跨平台路径操作的标准库模块。你最好的朋友。“Follow the os.path”我曾经在一本书中读过。
2.  `__file__`- 当前模块的位置。
3.  `sys.executable`- 正在运行的 Python 的位置。

现在你可以从这三个来源中收集到任何你想要的东西。os.path 中的函数将帮助您绕过树：

*   `os.path.join('path1', 'path2')`- 以跨平台方式加入路径段
*   `os.path.expanduser('a_path')``a_path`-在用户的主目录中查找路径
*   `os.path.abspath('a_path')`- 将相对路径转换为绝对路径
*   `os.path.dirname('a_path')`- 获取路径所在的目录
*   还有很多很多...

所以结合这个，例如：

```
# script1.py
# Get the path to the script2.py in the same directory
import os
this_script_path = os.path.abspath(__file__)
this_dir_path = os.path.dirname(this_script_path)
script2_path = os.path.join(this_dir_path, 'script2.py')
print script2_path 
```

并运行它：

```
ali@work:~/tmp$ python script1.py 
/home/ali/tmp/script2.py 
```

现在，对于您的具体情况，您似乎对“工作目录”和“脚本所在的目录”的概念有些混淆。这些可以相同，但也可以不同。例如，“工作目录”可以更改，因此使用它的函数有时可能会找到他们正在寻找的东西，但有时却找不到。`subprocess.Popen`就是一个例子。

如果您总是绝对传递路径，您将永远不会遇到工作目录问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T08:15:58.737

如果您的文件始终与您的程序位于同一目录中，则：

```
def _isInProductionMode():
    """ returns True when running the exe, 
        False when running from a script, ie development mode.
    """
    return (hasattr(sys, "frozen") or # new py2exe
           hasattr(sys, "importers") # old py2exe
           or imp.is_frozen("__main__")) #tools/freeze

def _getAppDir():
    """ returns the directory name of the script or the directory 
        name of the exe
    """
    if _isInProductionMode():
        return os.path.dirname(sys.executable)
    return os.path.dirname(__file__) 
```

应该管用。另外，我在自己的应用程序中使用了 py2exe，并没有使用其他 exe 转换应用程序对其进行测试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T10:54:11.430

什么 - 具体来说 - 您所说的“调用文件...foo.py”是什么意思？

1.  进口？如果是这样，则路径完全在您的程序之外。在 shell 级别使用or或其他设置`PYTHONPATH`环境变量。例如，您可以编写 2 行 shell 脚本来设置环境变量并运行 Python。`.``c:\`

    视窗

    ```
    SET PYTHONPATH=C:\path\to\library
    python myapp.py 
    ```

    Linux

    ```
    export PYTHONPATH=./relative/path
    python myapp.py 
    ```

2.  执行文件？考虑使用导入。

3.  阅读和评估？考虑使用导入。

如果 PYTHONPATH 太复杂，那么将你的模块放在 Python lib/site-packages 目录中，默认情况下它会放在 PYTHONPATH 中。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-13T13:37:10.313

**我通过使用os.getcwd()**弄清楚了。我还学习了如何使用**os.path.join**根据操作系统自动确定正确的路径格式。这是代码：

```
def openNewRecord(self, event): # wxGlade: CharSheet.<event_handler>
    """Create a new, blank record sheet."""
    path = os.getcwd()
    subprocess.Popen(os.path.join(path, "TW2K_char_rec_sheet.py"), shell=True).stdout 
```

它似乎正在工作。感谢您的想法。

# sql - IBM DB2 LPAD/RPAD

> ID：286493
> 
> 赞同：0
> 
> 时间：2008-11-13T08:14:12.860
> 
> 标签：sql, db2

我在 Windows 2003 服务器上使用 db2 v.9.1，因此它不能使用 LPAD 或 RPAD 函数标量。因为这些功能只支持 z/OS 对吗？

现在，当 COLUMN1 类型为 VARCHAR 时，我使用这种方式填充零

```
 RIGHT('0000' ||  COLUMN1 ,4) AS  RPAD
 LEFT('0000' ||  COLUMN1 ,4) AS  LPAD 
```

有更好的方法来替换 LPAD 或 RPAD 功能吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T16:24:38.400

我想你可能想要[REPEAT](http://publib.boulder.ibm.com/infocenter/db2luw/v9/index.jsp?topic=/com.ibm.db2.udb.admin.doc/doc/r0000842.htm)标量函数。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2020-04-14T20:04:49.523

```
REPEAT('0',4) || column_name 
```

现在，如果您想根据字符数限制 0，您可以使用该`RIGHT`函数，假设您的列是，它看起来像这样`varchar(10)`：

`RIGHT(REPEAT('0',4) || column_name, 10)`在这种情况下，如果您有字符，它将用 4 个前面的 0 填充它，但如果您有 7 个字符，它将用 3 个 0 填充它。

所以 你会有 ：
00001、000012、0000123、00001234、000012345、0000123456、0001234567、0012345678
等 。
_
_
_

# c# - 在运行时添加 Excel 功能区控件 (VSTO 2005SE)

> ID：286494
> 
> 赞同：0
> 
> 时间：2008-11-13T08:14:21.703
> 
> 标签：c#, excel, vsto

有谁知道如何在运行时使用 VSTO 2005SE 修改 Excel 功能区的内容？不仅更新标签或动态菜单，还添加或删除按钮、选项卡、组、下拉列表等。在运行时不仅意味着在我的加载项启动时，而且在使用 Excel 期间。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T09:51:19.433

无论 VS 版本如何，我认为当前版本的 RibbonX 控件* 无法实现您想要的所有功能。具体来说，没有添加和删除的功能。但是，您*可以*控制可见性，因此您可以将所有内容默认放入并根据需要使其可见或以其他方式显示。

* 在撰写本文时是 2007 年 - Excel/Office 2010 可能已经改变了一些事情

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T17:14:31.670

我同意 Mike 的观点，使用控件或组的可见性回调可能是您最好的选择（这就是我们正在使用的）。

整个功能区布局从 XML 字符串加载。我不知道是否可以触发 XML 的重新加载，然后您可以对其进行自定义以加载不同的 XML 内容。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-13T08:16:29.377

如果您使用 Visual Studio 2008，那么您就有了出色的功能区设计器。

你想拥有由excel触发的方法吗？

# objective-c - 如何使用 Objective C 创建一个 zip 文件？

> ID：286496
> 
> 赞同：12
> 
> 时间：2008-11-13T08:14:35.307
> 
> 标签：objective-c, ios, cocoa-touch

我正在开发一个 iOS 应用程序，并试图压缩我在应用程序中创建的文件，是否有任何内置函数能够做到这一点？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2012-12-04T19:49:06.953

我绝对推荐 Objective-Zip。它最近才转移到[https://github.com/flyingdolphinstudio/Objective-Zip](https://github.com/flyingdolphinstudio/Objective-Zip)：

他们文档中的一些示例：

**创建压缩文件：**

```
ZipFile *zipFile= [[ZipFile alloc] initWithFileName:@"test.zip" mode:ZipFileModeCreate]; 
```

**将文件添加到 zip 文件：**

```
ZipWriteStream *stream= [zipFile writeFileInZipWithName:@"abc.txt" compressionLevel:ZipCompressionLevelBest];

[stream writeData:abcData];
[stream finishedWriting]; 
```

**从 zip 文件中读取文件：**

```
ZipFile *unzipFile= [[ZipFile alloc] initWithFileName:@"test.zip" mode:ZipFileModeUnzip];

[unzipFile goToFirstFileInZip];

ZipReadStream *read= [unzipFile readCurrentFileInZip];
NSMutableData *data= [[NSMutableData alloc] initWithLength:256];
int bytesRead= [read readDataWithBuffer:data];

[read finishedReading]; 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-11-13T13:57:25.047

正如 Alex 指出的那样，我通过指出Cocoadev wiki 用户贡献的[NSData 类别来回答](http://www.cocoadev.com/index.pl?NSDataCategory)[这个问题。](https://stackoverflow.com/questions/230984/compression-api-on-the-iphone)该类别包括处理 NSData 实例中的压缩和 gzip 压缩数据的方法（可以从 Zip 文件读取或写入其中）。这应该是实现您描述的文件压缩所需的全部，只要您可以将文件数据提供给 NSData 实例。

有关此类别的实际示例，请参阅我的 iPhone 应用程序[Molecules](http://www.sunsetlakesoftware.com/2008/10/02/molecules-source-code-now-available)的源代码。我只使用该方法从压缩文件中提取数据（在 SLSMolecule+PDB.m 中），但您应该能够从中获得基本概念。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-01-23T09:48:11.517

[首先从http://code.google.com/p/objective-zip/downloads/list](http://code.google.com/p/objective-zip/downloads/list)下载 Objective-zip 示例

> 在这个例子中找到并复制三个文件夹 Objective-Zip、MiniZip 和 ZLib 拖到你的项目中
> 
> 在你的.m类中导入两个类“ZipFile.h”和“ZipWriteStream.h”
> 
> 创建 zip 我的代码的方法是：-

```
-(IBAction)Zip{
self.fileManager = [NSFileManager defaultManager];
NSArray *paths = NSSearchPathForDirectoriesInDomains(NSLibraryDirectory , NSUserDomainMask, YES);

NSString *ZipLibrary = [paths objectAtIndex:0];

NSString *fullPathToFile = [ZipLibrary stringByAppendingPathComponent:@"backUp.zip"];

//[self.fileManager createDirectoryAtPath:fullPathToFile attributes:nil];

//self.documentsDir = [paths objectAtIndex:0];

ZipFile *zipFile = [[ZipFile alloc]initWithFileName:fullPathToFile mode:ZipFileModeCreate];

NSError *error = nil;
self.fileManager = [NSFileManager defaultManager];
NSArray *paths1 = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory , NSUserDomainMask, YES);

self.documentsDir = [paths1 objectAtIndex:0];
NSArray *files = [[NSFileManager defaultManager]contentsOfDirectoryAtPath:self.documentsDir error:&error];
//for(NSString *filename in files){
    for(int i = 0;i<files.count;i++){

        id myArrayElement = [files  objectAtIndex:i];

    if([myArrayElement rangeOfString:@".png" ].location !=NSNotFound){
            NSLog(@"add %@", myArrayElement);

    NSString *path = [self.documentsDir stringByAppendingPathComponent:myArrayElement];
    NSDictionary *attributes = [[NSFileManager defaultManager]attributesOfItemAtPath:path error:&error];
    NSDate *Date = [attributes objectForKey:NSFileCreationDate];

    ZipWriteStream *streem = [zipFile writeFileInZipWithName:myArrayElement fileDate:Date compressionLevel:ZipCompressionLevelBest];
    NSData *data = [NSData dataWithContentsOfFile:path];
    //  NSLog(@"%d",data);
    [streem writeData:data];
    [streem finishedWriting];
        }else if([myArrayElement rangeOfString:@".txt" ].location !=NSNotFound)
        {

            NSString *path = [self.documentsDir stringByAppendingPathComponent:myArrayElement];
            NSDictionary *attributes = [[NSFileManager defaultManager]attributesOfItemAtPath:path error:&error];
            NSDate *Date = [attributes objectForKey:NSFileCreationDate];

            ZipWriteStream *streem = [zipFile writeFileInZipWithName:myArrayElement fileDate:Date compressionLevel:ZipCompressionLevelBest];
            NSData *data = [NSData dataWithContentsOfFile:path];
            //  NSLog(@"%d",data);
            [streem writeData:data];
            [streem finishedWriting];
    }
}

[self testcsv];
[zipFile close];

} 
```

您的文档目录保存的项目 .png 和 .txt 文件使用 backup.zip 压缩到库文件夹中，我希望这会有所帮助

# .net - .NET 2.0 是否有纤薄的读写器锁？

> ID：286508
> 
> 赞同：5
> 
> 时间：2008-11-13T08:20:18.573
> 
> 标签：.net, multithreading, locking

我查看了 .NET 2.0 中的 ReaderWriterLock 和 .NET 3.5 中的 ReaderWriterLockSlim，而超薄版本不使用内核对象进行锁定。对于我的上下文，它可能会生成大量（但不是大量）对象，这听起来更好。

但是我编写的代码在过渡期间需要在 .NET 2.0 和 3.5 中使用，所以 3.5 版本虽然看起来很适合我的目的，但不能使用。

有没有人拥有或知道一个类似的类，我可以将其插入 .NET 2.0 并获得一些相同的好处？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-13T08:27:29.713

据我所知，没有一个来自微软（否则`ReaderWriterLockSlim`会有点毫无意义），如果你从第三方那里找到一个，而不是你相信拥有*优秀*头脑的人，他们花了很长时间思考、实施和测试它，我不会相信的。例如，我当然不会相信随机的 CodeProject 实现。

您是否有任何具体措施表明使用`ReaderWriterLockSlim`会更好，*以至于*值得努力寻找 .NET 2.0 的替代品？这当然是“很高兴拥有”，但我怀疑它*具有*重大意义的情况相对罕见。除非你已经知道锁定对你来说是一个瓶颈，否则我会坚持你所拥有的，并准备好在可能的情况下升级。

您可能想尝试只使用普通监视器而不是`ReaderWriterLock`虽然 - 在许多情况下，RWL 的开销超过了好处。

当然，这一切都取决于具体情况 - 您的应用程序可能真的会变得更快，`ReaderWriterLockSlim`...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-09-25T18:56:47.230

[没有硬锁 ReadWriteLocker](http://nohardlockrwlocker.codeplex.com/) - 这个类是根据 ReaderWriterLock Alternative 设计的，它比 ReaderWriterLock 快 20%-30%。

我所做的区别是：

> 1.  支持通过在读锁中嵌套写锁来升级锁。与 ReaderWriterLock 不同，升级锁是线程安全的。
> 2.  有示例集合，向您展示如何设计线程安全集合。它们不如 .NET 4.0 的 PFX 集合高效，但它们还有其他好处。
> 3.  如果启动的所有锁都已解锁，则无法死锁。并且所有其他锁定机制都与该储物柜互斥。
> 4.  能够检测死锁并关闭死锁检测开销，一旦您验证死锁不会发生。
> 5.  高度递归，比 ReaderWriterLock 和 ReaderWriterLockSlim 强大许多倍。

我花了很多时间在它上面，我希望它有用。到目前为止，它还是非常新的，需要对其他锁定机制进行测试。当然，一切都是 .NET 2.0 的抱怨。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-06T08:50:42.210

PowerThreading库`ReaderWriterGate`中的[情况如何？](http://www.wintellect.com/PowerThreading.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-04-12T04:36:59.590

我问了一个关于使用的缺点的问题，`ReaderWriterLock`并且有一些有趣的链接包含`ReaderWriterLock`. 看看[我的问题的答案](https://stackoverflow.com/questions/5630224/what-are-the-real-downsides-of-using-readerwriterlock)。

# wpf - 如果 DataContext 为空或不使用 WPF，我如何触发样式更改

> ID：286519
> 
> 赞同：11
> 
> 时间：2008-11-13T08:26:48.467
> 
> 标签：wpf, data-binding

我有一个包含多个控件的页面。控件必须显示它们从页面的 DataContext 获得的值。如果 DataContext 为空，我想做的是显示页面的另一种外观。在某些情况下，无论是否设置了“他们的”属性，页面的控件应该以不同的方式显示。

是否可以创建绑定以查看是否设置了 DataContext？

我作为解决方法所做的是将 IsDataContextSet 属性添加到页面并指定如下绑定：

```
Binding="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Page}}, Path=IsDataContextSet}" Value="false" 
```

这可以按我的预期工作，但我觉得他们这样做是更优雅的方式。或者至少或更多的 WPFish 方式。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-11-13T14:22:35.277

鉴于您描述的场景，我将使用样式和数据触发器设置属性。数据触发器将使用默认绑定，即数据上下文。

一个示例可能如下所示：

```
<Border>
    <Border.Style>
        <Style TargetType="Border">
            <Setter Property="Background"
                    Value="Orange" />
            <Style.Triggers>
                <DataTrigger Binding="{Binding}"
                             Value="{x:Null}">
                    <Setter Property="Background"
                            Value="Yellow" />
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </Border.Style>
</Border> 
```

除非数据上下文为空，否则边框将为橙色，在这种情况下，背景为黄色。

# javascript - YUI：RTE：焦点和模糊事件

> ID：286521
> 
> 赞同：2
> 
> 时间：2008-11-13T08:27:36.390
> 
> 标签：javascript, yui, rte

是否有可能获得我们在 RTE 的其他表单控件上拥有的焦点和模糊事件的等价物？也就是说，我想知道给定的 RTE 何时获得焦点以及何时失去焦点。

我看到 RTE 支持很多事件（[http://developer.yahoo.com/yui/editor/#events](http://developer.yahoo.com/yui/editor/#events)），但我没有看到任何关于焦点/模糊的信息。我错过了什么吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T15:45:49.277

如果有人发现这个问题并正在寻找答案，Dav Glass 会在 YUI 社区论坛[http://tech.groups.yahoo.com/group/ydn-javascript/message/40867](http://tech.groups.yahoo.com/group/ydn-javascript/message/40867)中发布答案。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-13T00:21:07.313

Dav Glass 在 YUI 邮件列表中回答说，目前这是不可能的。但是，有一些方法可以模仿这一点，即使它们并不完美。更多在[YUI 列表的这个线程中](http://tech.groups.yahoo.com/group/ydn-javascript/message/40867)。

# sql-server - 无法使用 sqlcmd.exe 连接到 SQL Server Express

> ID：286531
> 
> 赞同：1
> 
> 时间：2008-11-13T08:36:17.057
> 
> 标签：sql-server, sql-server-2005, sqlcmd

环境：Vista SP1、SQL Server Express 2005

我能够使用 SQL Server Management Studio、使用 Windows 身份验证以及据我所知的所有默认参数（包括网络协议）连接到我的本地主机 SQL Server。

现在我尝试使用 sqlcmd.exe 连接无济于事：

```
C:\Program Files\Microsoft SQL Server\90\Tools\Binn>sqlcmd -S \\PCSERGEHOME\SQLE
XPRESS
HResult 0x57, Level 16, State 1
Named Pipes Provider: Invalid parameter(s) found [87].
Sqlcmd: Error: Microsoft SQL Native Client : An error has occurred while establi
shing a connection to the server. When connecting to SQL Server 2005, this failu
re may be caused by the fact that under the default settings SQL Server does not
 allow remote connections..
Sqlcmd: Error: Microsoft SQL Native Client : Login timeout expired. 
```

我还尝试使用 -U PCSERGEHOME\Serge。然后提示我输入密码，但结果是一样的。

TIA 为您提供帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T08:39:15.477

失去领先 \\

实际上，尝试 .\XPRESS （句点斜线实例）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T08:39:51.467

尝试

*   禁用防火墙
*   改用 localhost
*   检查服务器设置（在管理工作室中）以确保启用远程连接
*   检查外围区域配置中的设置，并确保启用所有传输并启用远程连接

# c# - C# 中的 FileStream StreamReader 问题

> ID：286533
> 
> 赞同：23
> 
> 时间：2008-11-13T08:38:02.467
> 
> 标签：c#

我正在测试 FileStream 和 StreamReader 类如何一起工作。通过控制台应用程序。我正在尝试进入一个文件并阅读这些行并将它们打印在控制台上。

我已经能够使用 while 循环来做到这一点，但我想尝试使用 foreach 循环。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.IO;

namespace testing
{
    public class Program
    {
        public static void Main(string[] args)
        {
            string file = @"C:\Temp\New Folder\New Text Document.txt";
            using(FileStream fs = new FileStream(file, FileMode.Open, FileAccess.Read))
            {
                using(StreamReader sr = new StreamReader(fs))
                {
                    foreach(string line in file)
                    {
                        Console.WriteLine(line);
                    }
                }
            }
        }
    }
} 
```

我不断得到的错误是：无法将类型'char'转换为'string'

确实有效的 while 循环如下所示：

```
while((line = sr.ReadLine()) != null)
{
    Console.WriteLine(line);
} 
```

我可能忽略了一些非常基本的东西，但我看不到它。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-11-13T08:46:58.987

如果您想通过 foreach （以可重用的方式）逐行读取文件，请考虑以下迭代器块：

```
 public static IEnumerable<string> ReadLines(string path)
    {
        using (StreamReader reader = File.OpenText(path))
        {
            string line;
            while ((line = reader.ReadLine()) != null)
            {
                yield return line;
            }
        }
    } 
```

请注意，这是延迟评估的 - 没有任何与您关联的缓冲`File.ReadAllLines()`。语法将`foreach`确保迭代器`Dispose()`即使对于异常也正确，关闭文件：

```
foreach(string line in ReadLines(file))
{
    Console.WriteLine(line);
} 
```

* * *

（添加此位只是为了感兴趣...）

这种抽象的另一个优点是它可以很好地与 LINQ 配合使用 - 即使用这种方法很容易进行转换/过滤器​​等：

```
 DateTime minDate = new DateTime(2000,1,1);
        var query = from line in ReadLines(file)
                    let tokens = line.Split('\t')
                    let person = new
                    {
                        Forname = tokens[0],
                        Surname = tokens[1],
                        DoB = DateTime.Parse(tokens[2])
                    }
                    where person.DoB >= minDate
                    select person;
        foreach (var person in query)
        {
            Console.WriteLine("{0}, {1}: born {2}",
                person.Surname, person.Forname, person.DoB);
        } 
```

再一次，所有的评估都是懒惰的（没有缓冲）。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-11-13T08:47:50.327

要读取 New Text Document.txt 中的所有行：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.IO;

namespace testing
{
    public class Program
    {
        public static void Main(string[] args)
        {
            string file = @"C:\Temp\New Folder\New Text Document.txt";
            using(FileStream fs = new FileStream(file, FileMode.Open, FileAccess.Read))
            {                    
                using(StreamReader sr = new StreamReader(fs))
                {
                    while(!sr.EndOfStream)
                    {
                       Console.WriteLine(sr.ReadLine());
                    }
                }
            }
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2008-11-13T09:13:40.837

[我的MiscUtil](http://pobox.com/~skeet/csharp/miscutil)项目中有一个`LineReader`课程。它比这里给出的解决方案更通用，主要是在你可以构造它的方式方面：

*   从返回流的函数中，在这种情况下它将使用 UTF-8
*   从返回流的函数和编码
*   从返回文本阅读器的函数
*   仅来自文件名，在这种情况下它将使用 UTF-8
*   从文件名和编码

该类“拥有”它使用的任何资源，并适当地关闭它们。但是，它在没有实现`IDisposable`自身的情况下执行此操作。这就是为什么它需要`Func<Stream>`而`Func<TextReader>`不是直接使用流或阅读器的原因 - 它需要能够推迟打开直到它需要它。关闭资源的是迭代器本身（由`foreach`循环自动处理）。

正如 Marc 指出的那样，这在 LINQ 中非常有效。我喜欢举的一个例子是：

```
var errors = from file in Directory.GetFiles(logDirectory, "*.log")
             from line in new LineReader(file)
             select new LogEntry(line) into entry
             where entry.Severity == Severity.Error
             select entry; 
```

这将从一大堆日志文件中流式传输所有错误，同时打开和关闭。结合 Push LINQ，你可以做各种好东西 :)

这不是一个特别“棘手”的课程，但它真的很方便。这是完整的源代码，如果您不想下载 MiscUtil，为方便起见。源代码的许可证在[这里](http://www.yoda.arachsys.com/csharp/miscutil/licence.txt)。

```
using System;
using System.Collections;
using System.Collections.Generic;
using System.IO;
using System.Text;

namespace MiscUtil.IO
{
    /// <summary>
    /// Reads a data source line by line. The source can be a file, a stream,
    /// or a text reader. In any case, the source is only opened when the
    /// enumerator is fetched, and is closed when the iterator is disposed.
    /// </summary>
    public sealed class LineReader : IEnumerable<string>
    {
        /// <summary>
        /// Means of creating a TextReader to read from.
        /// </summary>
        readonly Func<TextReader> dataSource;

        /// <summary>
        /// Creates a LineReader from a stream source. The delegate is only
        /// called when the enumerator is fetched. UTF-8 is used to decode
        /// the stream into text.
        /// </summary>
        /// <param name="streamSource">Data source</param>
        public LineReader(Func<Stream> streamSource)
            : this(streamSource, Encoding.UTF8)
        {
        }

        /// <summary>
        /// Creates a LineReader from a stream source. The delegate is only
        /// called when the enumerator is fetched.
        /// </summary>
        /// <param name="streamSource">Data source</param>
        /// <param name="encoding">Encoding to use to decode the stream
        /// into text</param>
        public LineReader(Func<Stream> streamSource, Encoding encoding)
            : this(() => new StreamReader(streamSource(), encoding))
        {
        }

        /// <summary>
        /// Creates a LineReader from a filename. The file is only opened
        /// (or even checked for existence) when the enumerator is fetched.
        /// UTF8 is used to decode the file into text.
        /// </summary>
        /// <param name="filename">File to read from</param>
        public LineReader(string filename)
            : this(filename, Encoding.UTF8)
        {
        }

        /// <summary>
        /// Creates a LineReader from a filename. The file is only opened
        /// (or even checked for existence) when the enumerator is fetched.
        /// </summary>
        /// <param name="filename">File to read from</param>
        /// <param name="encoding">Encoding to use to decode the file
        /// into text</param>
        public LineReader(string filename, Encoding encoding)
            : this(() => new StreamReader(filename, encoding))
        {
        }

        /// <summary>
        /// Creates a LineReader from a TextReader source. The delegate
        /// is only called when the enumerator is fetched
        /// </summary>
        /// <param name="dataSource">Data source</param>
        public LineReader(Func<TextReader> dataSource)
        {
            this.dataSource = dataSource;
        }

        /// <summary>
        /// Enumerates the data source line by line.
        /// </summary>
        public IEnumerator<string> GetEnumerator()
        {
            using (TextReader reader = dataSource())
            {
                string line;
                while ((line = reader.ReadLine()) != null)
                {
                    yield return line;
                }
            }
        }

        /// <summary>
        /// Enumerates the data source line by line.
        /// </summary>
        IEnumerator IEnumerable.GetEnumerator()
        {
            return GetEnumerator();
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-13T08:41:58.543

问题出在：

```
foreach(string line in file)
{
    Console.WriteLine(line);
} 
```

因为“文件”是字符串，而字符串实现了IEnumerable。但是这个枚举器返回“char”并且“char”不能隐式转换为字符串。

正如您所说，您应该使用while循环。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-12-07T04:56:07.463

稍微优雅一点的是以下...

```
using (var fileStream = new FileStream(file, FileMode.Open, FileAccess.Read))
{
    using (var streamReader = new StreamReader(fileStream))
    {
        while (!streamReader.EndOfStream)
        {
            yield return reader.ReadLine();
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-13T08:44:35.137

对我来说看起来像是家庭作业；）

您正在迭代文件名（一个字符串）本身，它一次给您一个字符。只需使用正确使用 sr.ReadLine() 的 while 方法。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-13T08:45:56.367

您可以简单地使用，而不是使用 a`StreamReader`然后尝试在变量中查找行：`String file``File.ReadAllLines`

```
string[] lines = File.ReadAllLines(file);
foreach(string line in lines)
   Console.WriteLine(line); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-13T08:42:29.433

您正在枚举一个字符串，并且当您这样做时，您会一次取一个字符。

你确定这是你想要的吗？

```
foreach(string line in file) 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-11-13T08:46:26.507

迭代文件中每一行的简单（非内存效率）方法是

```
foreach (string line in File.ReadAllLines(file))
{
  ..
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-13T08:47:07.550

我想你想要这样的东西：

```
using ( FileStream fileStream = new FileStream( file, FileMode.Open, FileAccess.Read ) )
{
    using ( StreamReader streamReader = new StreamReader( fileStream ) )
    {
        string line = "";
        while ( null != ( line = streamReader.ReadLine() ) )
        {
            Console.WriteLine( line );
        }
    }
} 
```

# c++ - 枚举 Windows 中所有可用的驱动器号

> ID：286534
> 
> 赞同：15
> 
> 时间：2008-11-13T08:38:47.490
> 
> 标签：c++, winapi, drives

我想使用 VC++ 在 Windows 中枚举所有可用的驱动器号（尚未使用）。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-13T08:47:21.920

[::GetLogicalDrives()](https://msdn.microsoft.com/en-us/library/aa364972(v=vs.85).aspx)返回可用（读取：已使用）驱动器的列表作为掩码中的位。这应该包括映射的网络驱动器。因此，您可以简单地遍历这些位以找到为零的位，这意味着不存在驱动器。如果有疑问，您始终可以使用驱动器号 +调用[::GetDriveType()](http://msdn.microsoft.com/en-us/library/windows/desktop/aa364939%28v=vs.85%29.aspx)`":\"`（当然`":\\"`，在 C 代码中，或者`_T(":\\")`在 Unicode 感知术语中），并且应该返回`DRIVE_UNKNOWN`或者`DRIVE_NO_ROOT_DIR`如果驱动器可用。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-13T08:45:43.373

[`GetLogicalDriveStrings`](http://msdn.microsoft.com/en-us/library/aa364975(VS.85).aspx)可以为您获取当前使用的驱动器号列表。

[`GetVolumeInformation`](http://msdn.microsoft.com/en-us/library/aa364993(VS.85).aspx)可用于获取有关特定驱动器的更多信息。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-13T08:42:43.643

GetLogicalDriveStrings[函数](http://msdn.microsoft.com/en-us/library/aa364975(VS.85).aspx)是一个很好的起点。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-12-01T17:15:37.977

我不知道如何枚举它们，或者它是否会在 Visual c++ 上编译，但我在 Dev C++ 或代码块上对其进行了猛烈编码，以检查使用 CreateFile 可以访问哪些驱动器以及使用 GetDriveType 可以访问什么类型的驱动器。程序检查从 A 到 Z 的驱动器：

```
#include <windows.h>
#include <cstring>
#include <sstream>
#include <iostream>

using namespace std;

int __stdcall WinMain(HINSTANCE hInst, HINSTANCE hPrev, LPSTR lpCmdLine, INT nShowCmd)
{
    HANDLE hDevice = NULL;
    HANDLE fileFind = NULL;
    while(true)
    {
        Sleep(3005);
        char drv='A';
        while(drv!='[')
        {
            Sleep(105);
            const char *charDrvCF;
            const char *charDrv;
            stringstream Str;
            string drvStr;
            Str<<drv;
            Str>>drvStr;
            string drvSpc=drvStr+":\\";
            string fCheck="\\\\.\\";
            string fhCheck=fCheck+drvStr+":";
            charDrvCF=fhCheck.c_str();
            charDrv=drvSpc.c_str();      
            hDevice=CreateFile(charDrvCF,
                                GENERIC_READ|GENERIC_WRITE,
                                FILE_SHARE_READ|FILE_SHARE_WRITE,
                                NULL,
                                OPEN_EXISTING,
                                0,
                                NULL);
            if(hDevice!=INVALID_HANDLE_VALUE)
            {
                switch(GetDriveType(charDrv))
                {
                    case DRIVE_FIXED:
                    {
                        cout<<"Fixed drive detected: "<<charDrv<<endl;
                        break;
                    }
                    case DRIVE_REMOVABLE:
                    {
                        cout<<"Removable drive detected: "<<charDrv<<endl;
                        break;
                    }
                    case DRIVE_NO_ROOT_DIR:
                    {
                        cout<<"There is no volume mounted at the specified path. "<<charDrv<<endl;
                        break;
                    }
                    case DRIVE_REMOTE:
                    {
                        cout<<"The drive is a remote (network) drive. "<<charDrv<<endl;
                        break;
                    }
                    case DRIVE_CDROM:
                    {
                        cout<<"The drive is a CD-ROM drive. "<<charDrv<<endl;
                        break;
                    }
                    case DRIVE_RAMDISK:
                    {
                        cout<<"The drive is a RAM disk. "<<charDrv<<endl;
                        break;
                    }
                    case DRIVE_UNKNOWN:
                    {
                        cout<<"The drive type cannot be determined. "<<charDrv<<endl;
                        break;
                    }
                }
            }
        drv++;
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-07-16T11:24:44.477

GetLogicalDrives 和 GetLogicalDriveStrings 看不到在不同命名空间中创建的网络驱动器。

例如，从本地系统下运行的服务调用函数将看不到登录用户创建的网络驱动器。

从 Windows XP 开始就会发生这种情况。以下文章描述了这种情况： http: [//msdn.microsoft.com/en-us/library/windows/desktop/aa363908 (v=vs.85).aspx](http://msdn.microsoft.com/en-us/library/windows/desktop/aa363908(v=vs.85).aspx)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2019-09-01T19:04:46.203

```
std::vector<std::string> getListOfDrives() {
    std::vector<std::string> arrayOfDrives;
    char* szDrives = new char[MAX_PATH]();
    if (GetLogicalDriveStringsA(MAX_PATH, szDrives));
    for (int i = 0; i < 100; i += 4)
        if (szDrives[i] != (char)0) 
            arrayOfDrives.push_back(std::string{szDrives[i],szDrives[i+1],szDrives[i+2]});
    delete[] szDrives;
    return arrayOfDrives;
} 
```

返回驱动器向量，例如 C:\D:\E:\F:\

```
std::vector<std::string> drives = getListOfDrives();

for (std::string currentDrive : drives) {
    std::cout << currentDrive << std::endl;
} 
```

枚举它们

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-08-20T17:35:53.877

以下代码将完成这项工作：

```
for (w_chDrv = 'C'; w_chDrv <= 'Z'; w_chDrv++)
{
    // make root path
    _stprintf_s(w_szRootPath, 3, _T("%c:"), w_chDrv);

    // get driver type
    w_nDriverType = GetDriveType(w_szRootPath);
    if ((w_nDriverType != DRIVE_REMOVABLE) && (w_nDriverType != DRIVE_FIXED))
            continue;
    // if you got here that means w_szRootPath is a valid drive
} 
```

# java - 如何创建一种自动化的监控方式来查看此应用程序是否正在运行

> ID：286540
> 
> 赞同：0
> 
> 时间：2008-11-13T08:42:02.960
> 
> 标签：java, email, monitoring

我们有一个应该始终运行的应用程序。有谁知道一种创建自动监控方式以查看此应用程序是否正在运行（可能使用批处理文件）的方法？如果它没有运行，那么发送电子邮件通知并启动应用程序？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T09:52:50.007

[Nagios](http://www.nagios.org/)通常是我遇到的系统管理员使用的。您可以编写脚本来执行您需要的任何检查并根据各种条件发出警报。与仙人掌配合得很好，所以你也可以画图:)

如果你想确保你的服务在它死掉时总是重新启动，你可以使用daemontools 的[监督](http://cr.yp.to/daemontools/supervise.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T10:07:39.697

[Nagios](http://www.nagios.org/)的替代品是[zabbix](http://www.zabbix.com/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T08:50:18.463

您没有提到操作系统，但如果您正在 Windows 上寻找某些东西，[Application Monitor](http://www.jockersoft.com/english/appmonitor_index.php)可能是一个好的开始。

如果你在 Linux 上，[monit](http://mmonit.com/monit/)看起来非常有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T10:03:55.227

大多数监控系统都有一个内置测试，它监视进程列表以检查应该运行的所有内容是否正在运行。

我们使用 Hobbit，它有一个可配置的进程表，应该运行（以及实例数、红色/黄色警报等）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-06-14T12:35:28.930

我们现在正准备发布我们的服务，该服务可以完成一些通常由 Nagios 或其他类似工具难以处理的监控任务。我们在以下情况下提供即时通知（电子邮件、短信）：

a）您的应用程序/服务在一段时间内没有响应

b）满足某些条件（例如，某些逻辑部分的执行时间> X，发送的电子邮件数量< Y 或任何您想要的）

与 Nagios 或其他软件相比，这绝对易于使用，并且不需要安装。我们花了很多时间使它对用户友好

正如我所提到的，这将很快发布（会回来给你信息）。如果您对我们的方法感兴趣，我们邀请您参加我们应用程序的 beta 测试（参与者会有一些促销活动）。

# wpf - WPF：将数据触发器绑定到属性“Ischecked”时出现复选框问题

> ID：286543
> 
> 赞同：4
> 
> 时间：2008-11-13T08:42:44.207
> 
> 标签：wpf, checkbox, properties, datatrigger

我在 GridViewColumn 中有一个复选框，用于显示/更改数据库值。复选框的单击事件用于更改数据库中的值。为了处理属性“IsChecked”的状态，我使用了 datatrigger 和 setter，下面是 xaml 代码：

```
<Style TargetType="CheckBox">
    <Setter Property="IsEnabled" Value="True" />
    <Style.Triggers>
        <DataTrigger Binding="{Binding Path=ID, Converter={StaticResource Converter}}"   Value="true">
            <Setter Property="IsChecked" Value="True"/>
        </DataTrigger>
    </Style.Triggers>
</Style> 
```

在我单击复选框之前，绑定效果很好。在我第一次单击复选框后，如果在数据库中手动更改了我映射到属性“IsChecked”的值，则属性“IsChecked”的状态不会更新。例如，如果我将相同的值映射到复选框的属性“内容”，即使我单击了复选框，触发器也可以正常工作。

有没有人没有什么问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T13:38:26.583

不应该

```
<Style TargetType="CheckBox"> 
```

而是：

```
 <Style TargetType="{x:Type CheckBox}"> 
```

编辑：

你可以试试这个：

```
 <Style TargetType="{x:Type CheckBox}" >
        <Setter Property="IsChecked" Value="{Binding Path=ID, Converter={StaticResource Converter}}" />
    </Style> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T10:34:08.957

您可以尝试添加第二个数据触发器以将复选框设置为 false。正如我从您的代码中看到的那样，您将 IsChecked 仅设置为 true，但从不设置为 false。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T13:28:38.880

除了使用 Click 来确定更改，也许您可​​以使用 Checked 和 Unchecked 事件？

# oracle - 找出 PL/SQL 过程的名称

> ID：286549
> 
> 赞同：18
> 
> 时间：2008-11-13T08:45:26.697
> 
> 标签：oracle, plsql

Oracle中的PL/SQL过程可以知道它自己的名字吗？

让我解释：

```
CREATE OR REPLACE procedure some_procedure is
    v_procedure_name varchar2(32);
begin
    v_procedure_name := %%something%%;
end; 
```

执行后`%%something%%`，变量`v_procedure_name`应包含“SOME_PROCEDURE”。如果它包含`object_id`该过程也可以，因此我可以在`all_objects`.

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-11-13T08:57:13.287

尝试：

```
v_procedure_name := $$PLSQL_UNIT; 
```

如果您想知道您所在的行号，还有 $$PLSQL_LINE 。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-13T09:45:09.417

如果您是 10g 之前的版本，您可以从 dbms_utility.format_call_stack 中“挖掘”（解析）包中的过程/函数可以重载（和嵌套），因此包名称/行号通常比名称更好。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-09-09T19:00:46.323

在 10g 和 11g 中，我使用“owa_util.get_procedure”函数。我通常在包中使用它，因为它还将返回内部过程或函数的名称作为包名称的一部分，即 (package_name).(procedure name)。我使用它来提供一个通用`EXCEPTION`模板来识别异常发生的位置。

```
CREATE OR REPLACE procedure some_procedure is
    v_procedure_name varchar2(32);
begin
    v_procedure_name := owa_util.get_procedure;
end;

CREATE OR REPLACE PACKAGE some_package
AS
    FUNCTION v_function_name
    RETURN DATE;
END;
/
CREATE OR REPLACE PACKAGE BODY some_package
AS
    FUNCTION v_function_name
    RETURN DATE
    IS
    BEGIN
        RETURN SYSDATE;
    EXCEPTION
        WHEN OTHERS THEN
            DBMS_OUTPUT.PUT_LINE('ERROR IN '||owa_util.get_procedure);
            DBMS_OUTPUT.PUT_LINE(SQLERRM);
    END;
END;
/ 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-07-16T18:42:58.693

这是一个利用 REGEXP_SUBSTR 的简洁函数。我已经在一个包中对其进行了测试（如果包中的另一个过程调用它，它甚至可以工作）：

```
FUNCTION SET_PROC RETURN VARCHAR2 IS
BEGIN
  RETURN NVL(REGEXP_SUBSTR(DBMS_UTILITY.FORMAT_CALL_STACK, 
             'procedure.+\.(.+)\s', 1,1,'i',1), 'UNDEFINED');
END SET_PROC; 
```

# python - Django 多选复选框

> ID：286558
> 
> 赞同：0
> 
> 时间：2008-11-13T08:48:03.400
> 
> 标签：python, django, checkbox, django-templates

我有一个对象列表，每个对象都有自己的复选框，用户可以在其中选择多个。该列表是查询的结果。

如何在视图中标记已选中的复选框？模板语言中似乎没有 in 运算符。

我想要一些类似的东西：

```
<input {% if id in selectedIds %}checked {% endif %}> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-17T11:39:22.047

您可以使用类似于此代码段注释中的模板标签：

[http://www.djangosnippets.org/snippets/177/](http://www.djangosnippets.org/snippets/177/)

```
@register.filter
def in_list(value,arg):
    return value in arg 
```

要在模板中使用：

```
The item is 
{% if item|in_list:list %} 
    in list 
{% else %} 
    not in list
{% endif %} 
```

不是很聪明，但它有效。

# axapta - Microsoft AX 和 Business Connector/企业门户/应用程序集成框架

> ID：286563
> 
> 赞同：1
> 
> 时间：2008-11-13T08:50:27.637
> 
> 标签：axapta, x++, aif, enterprise-portal, business-connector

我一直在从事一个旨在将 AX 与 Web 集成的项目。

交付 AX 的公司选择直接在我的后端使用 Business Connector (BC.net)。

我搜索了一下，对我来说，看起来我们必须使用应用程序集成框架（AIF）/企业门户（EP）——这是因为据我所知，BC 不是为网络上的多用户设计的，但必须使用像 EP 这样的会话包装器来实现 - 而且它必须在 LAN 上运行并且不能通过 WAN 连接。

对此有何评论？

-- -编辑- 更多信息：

哦，抱歉 - stackoverflow 的新手 - 没有看到您评论了我的问题。

我正在从头开始做这件事。最初的计划是创建一个模型，并通过 BC 直接从 AX 发送对象到我的数据层，但由于 BC 不能传递任何其他东西然后 Axaptaobjects，我们决定序列化为 XML，使用 BC 作为字符串发送，然后反序列化与我的数据层。

现在，一切正常，但稳定性和性能真的很糟糕——我担心提供后端（BC -> AX）的公司在这里做错了*什么*......

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-11-06T08:16:25.773

EP 连接到 AX 数据和逻辑抛出 BC。因此，如果您的应用程序具有 BC 性能较慢，则 EP 不能直接是 BC 本身的错误。

*（EP：AX 企业门户，BC：AX .NET 业务连接器）*

# ruby - Ruby 源代码分析器（类似于 pylint）

> ID：286564
> 
> 赞同：17
> 
> 时间：2008-11-13T08:53:20.847
> 
> 标签：ruby, code-analysis, static-analysis

Ruby 是否有任何[类似于 pylint](http://pypi.python.org/pypi/pylint)的工具来分析源代码的错误和简单的编码标准？

如果它可以与[Cruisecontrolrb](http://cruisecontrolrb.thoughtworks.com/)集成以进行持续集成，那就太好了。

还是每个人都编写了不需要源代码检查器的好测试！

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-13T18:36:56.420

我回顾了一堆可用的 Ruby 工具

[http://devver.wordpress.com/2008/10/03/ruby-tools-roundup/](http://devver.wordpress.com/2008/10/03/ruby-tools-roundup/)

webmat 提到了大多数工具，但是如果您想了解更多信息，我会通过示例进行深入了解。

我还强烈推荐使用 Metric-Fu，它可以让您在 gem/plugin 上安装 3 个更流行的工具，并且在构建时考虑了 Cruisecontrolrb 集成。

创建者有一篇很棒的帖子，应该可以帮助您立即启动并运行。

[http://jakescruggs.blogspot.com/2008/04/dead-simple-rails-metrics-with-metricfu.html](http://jakescruggs.blogspot.com/2008/04/dead-simple-rails-metrics-with-metricfu.html)

Ruby 工具最近有很多活动，我认为这是一种成长和成熟的语言的好兆头。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-13T14:26:25.863

检查这些：

*   在 Ruby Inside 上，[一篇介绍 Towelie、Flay 和 Simian 的文章](http://www.rubyinside.com/3-tools-for-drying-your-ruby-code-1305.html)，所有用于查找代码重复的工具
    *   [毛巾布](http://gilesbowkett.blogspot.com/2008/10/verbatim-how-to-find-patterns-in-code.html)
    *   [剥皮](http://ruby.sadi.st/Flay.html)
    *   [Simian](http://www.redhillconsulting.com.au/products/simian/)（一种更通用的工具，支持 Ruby 和其他语言）
*   [reek](http://silkandspinach.net/2008/09/23/reek-a-code-smells-detector-for-ruby/)：Ruby 的代码气味检测器
*   [Roodi](http://www.martyandrews.net/blog/2008/09/roodi_checkstyle_for_ruby.html) : 检查你的 Ruby 代码的风格
*   [flog](http://ruby.sadi.st/Flog.html) : 代码复杂度分析器
*   [rcov](http://eigenclass.org/hiki.rb?rcov)：会给你一个[C0](http://eigenclass.org/hiki.rb?rcov#l15)（如果我没记错的话）代码覆盖率分析。但要小心。100% 的覆盖率非常昂贵，并不意味着完美的代码。
*   [heckle](http://ruby.sadi.st/Heckle.html)：以微妙的方式更改您的代码并运行您的测试套件以查看它是否捕获它。残酷:-)

由于它们都是命令行工具，它们都可以简单地集成为 cc.rb 任务。只需拿出你的正则表达式技能来选择输出的重要部分。

我建议您首先手动试用它们，看看它们是否与您的代码库配合得很好，以及您是否喜欢它们给您的信息。一旦你找到了一些能给你带来价值的东西，然后花时间将它们整合到你的 cc 中。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-13T09:10:42.510

最近更新的一个看起来很有趣的工具是[Ruby Object Oriented Design Inferometer](http://roodi.rubyforge.org/) - 简称 roodi。它是 v1.3.0，所以我猜它相当成熟。

我自己没有尝试过，因为我的代码当然已经无可非议（哈哈）。

至于测试覆盖率（哦，亲爱的，我也没有尝试过这个）有[rcov](http://agilewebdevelopment.com/plugins/rails_rcov)

另外（看，我今天肯定会尝试其中的一些。至少一个）您可能会关心查看[flog 和 flay](http://ruby.sadi.st/Ruby_Sadist.html)以获取另一种样式检查器和重构候选者查找器。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-22T05:56:01.787

您还可以快速启用内置警告：

```
ruby -w 
```

或者在任何时候将全局变量 $VERBOSE 设置为 true。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-03-21T16:16:10.287

ruby 工具箱网站上的[代码指标。](https://www.ruby-toolbox.com/categories/code_metrics)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-09-02T22:43:50.657

[Rubocop](https://github.com/bbatsov/rubocop)是一种广泛使用的静态代码分析器。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-21T12:16:31.590

我刚刚发布了优秀的，它实现了对 Ruby 代码的多项检查。它结合了 roodi、reek 和 flog，还添加了一些特定于 Rails 的检查：

```
gem sources -a http://gems.github.com
sudo gem install simplabs-excellent 
```

可能会有所帮助...

# qt - 在 QTableWidget 中，更改所选行的文本颜色

> ID：286565
> 
> 赞同：6
> 
> 时间：2008-11-13T08:54:10.360
> 
> 标签：qt

我正在使用 QTableWidget 来显示几行。其中一些行应该反映错误并且它们的文本颜色已更改：

反映没有错误的行以默认颜色显示（我的计算机上的白色背景上的黑色文本）。
反映存在错误的行以红色文本颜色显示（在我的计算机上是白色背景上的红色文本）。

这一切都很好，只要没有选择。一旦选择了一行，无论未选择的文本颜色如何，文本颜色都会在蓝色背景上变为白色（在我的计算机上）。

This is something I would like to change to get the following :
When a row is selected, if the row is reflecting there is no error, I would like it to be displayed with white text on blue background (default behavior).
如果该行反映错误并被选中，我希望它以蓝色背景上的红色文本显示。

到目前为止，我只能更改整个 QTableWidget 的选择颜色，这不是我想要的！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-18T08:39:59.630

回答自己，这就是我最终要做的事情：代表。

该委托将检查项目的前景色角色。如果此前景色不是调色板的默认 WindowText 颜色，则表示设置了特定颜色，并且此特定颜色用于突出显示的文本颜色。

我不确定这是否非常强大，但至少它在 Windows 上运行良好。

```
class MyItemDelegate: public QItemDelegate
{
public:
  MyItemDelegate(QObject* pParent = 0) : QItemDelegate(pParent)
  {
  }

  void paint(QPainter* pPainter, const QStyleOptionViewItem& rOption, const QModelIndex& rIndex) const  
  {
    QStyleOptionViewItem ViewOption(rOption);

    QColor ItemForegroundColor = rIndex.data(Qt::ForegroundRole).value<QColor>();
    if (ItemForegroundColor.isValid())
    {
      if (ItemForegroundColor != rOption.palette.color(QPalette::WindowText))
      {
        ViewOption.palette.setColor(QPalette::HighlightedText, ItemForegroundColor);
      }
    }
    QItemDelegate::paint(pPainter, ViewOption, rIndex);
 }
}; 
```

以下是如何使用它：

```
QTableWidget* pTable = new QTableWidget(...);
pTable->setItemDelegate(new MyItemDelegate(this)); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-28T21:34:25.997

它看起来不错，但您可能想查看它的文档，`QStyleOption`它可以告诉您绘制的项目是否被选中，您不必查看绘制颜色即可。我可能会给模型类一个用户角色，它返回数据是否有效，然后根据它做出颜色决定。即`rIndex.data(ValidRole)`返回该索引处的数据是否有效。

我不知道您是否尝试过覆盖 BackgroundRole 的数据并返回自定义颜色，如果您在那里更改颜色，Qt 可能会做正确的事情

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-17T21:14:29.173

您要做的是将`selectionChanged()`QTableWidget 的 QItemSelectionModel 发出的信号连接到一个插槽，例如`OnTableSelectionChanged()`. 在您的插槽中，您可以使用 QStyleSheets 设置选择颜色，如下所示：

```
if (noError)
{
    pTable->setStyleSheet("QTableView {selection-background-color: #000000; selection-color: #FFFFFF;}");
}
else
{
    pTable->setStyleSheet("QTableView {selection-background-color: #FF0000; selection-color: #0000FF;}");
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T17:44:42.797

当然，您可以从表格小部件继承并覆盖绘制事件，但我认为这不是您想要做的。

相反，应该使用该`QAbstractItemDelegate`功能。您可以创建一个始终用于错误行，并将错误行设置为使用该委托，或者创建一个知道如何绘制这两种类型的行的通用行。第二种方法是我推荐的。然后，您的代表会适当地绘制行，即使对于选定的行也是如此。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-02T12:24:38.723

您可以为此使用[代理模型](http://doc.trolltech.com/4.4/qsortfilterproxymodel.html)，如果您对特定模型索引有错误，则返回不同的颜色；

```
 QVariant MySortFilterProxyModel::data(const QModelIndex & index, int role = Qt::DisplayRole) {
       // assuming error state and modelindex row match
       if (role==Qt::BackgroundRole)
         return Qt::red;
   } 
```

# linux - 如何将 init.d 脚本从 Ubuntu/Debian Linux 转换为 Solaris？

> ID：286570
> 
> 赞同：4
> 
> 时间：2008-11-13T08:59:16.527
> 
> 标签：linux, shell, solaris, init.d

我有几个 init.d 脚本用于启动一些守护进程。我在互联网上找到的大多数这些脚本都使用 start-stop-daemon。我的理解是“start-stop-daemon”是特定于 Linux 或 BSD 发行版的命令，在 Solaris 上不可用。

将我的 init.d 脚本从 Linux 转换为 Solaris 的最佳方法是什么？是否有一个大致相当于我可以使用的 start-stop-daemon 的命令？

由于我不是 Solaris 用户，因此我愿意提前承认我什至不知道我的问题是否本质上是无效的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-13T09:46:44.997

start-stop-daemon 是 Linux 的东西，在 Solaris 上用的不多。我想你可以移植命令，如果你想重用你的初始化脚本。

否则，这取决于您使用的 Solaris 版本。从 Solaris 10 和 OpenSolaris 开始，它们使用新的启动脚本框架“Solaris 服务管理工具”，您可以使用命令`svcs`和.`svccfg``svcadm`

有关详细信息，请参阅[http://www.oracle.com/technetwork/server-storage/solaris/overview/servicemgmthowto-jsp-135655.html](http://www.sun.com/bigadmin/content/selfheal/smf-quickstart.jsp)。

对于较旧的 Solaris 版本，大多数 init 脚本都是用纯 shell 编写的，没有任何辅助命令，例如 start-stop-daemon。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-23T19:42:21.310

在 Solaris 10 或更高版本上建议使用 SMF，但在较早的版本中，您将在 /etc/init.d 中创建一个初始化脚本并从 rcX.d 目录链接到它。这是用于启动 rsync 守护进程的初始化脚本的简单示例：

```
#!/sbin/sh

startcmd () {
    /usr/local/bin/rsync --daemon  # REPLACE WITH YOUR COMMANDS
}

stopcmd () {
    pkill -f "/usr/local/bin/rsync --daemon"  # REPLACE WITH YOUR COMMANDS
}

case "$1" in
'start')
        startcmd
        ;;
'stop')
        stopcmd
        ;;
'restart')
        stopcmd
        sleep 1
        startcmd
        ;;
*)
        echo "Usage: $0 { start | stop | restart }"
        exit 1
        ;;
esac 
```

从每个 rcX.d 目录创建一个指向脚本的链接（遵循“S”/“K”约定）。

```
ln rsync /etc/rc3.d/S91rsync
for i in `ls -1d /etc/rc*.d | grep -v 3`; do ln rsync $i/K02rsync; done 
```

请参阅每个 rcX.d 目录中的 README 并查看 init.d 的手册页。这是手册页的一部分：

> rc?.d 目录中的文件名格式为 [SK]nn，其中 S 表示启动此作业，K 表示终止此作业，nn 是终止或启动作业的相对序列号。
> 
> 当进入一个状态（init S,0,2,3 等）时，rc[S0-6] 脚本执行 /etc/rc[S0-6].d 中以 K 为前缀的脚本，然后是那些以这些脚本为前缀的脚本使用 S。在 /etc/rc[S0-6] 目录之一中执行每个脚本时，/sbin/rc[S0-6] 脚本会传递一个参数。它为以 K 为前缀的脚本传递参数“stop”，为以 S 为前缀的脚本传递参数“start”。将相同的序列号应用于多个脚本没有害处。

# c# - 如何在 c# 中调用（网络）Button.Click？

> ID：286571
> 
> 赞同：1
> 
> 时间：2008-11-13T09:00:09.053
> 
> 标签：c#, .net, asp.net, events

正如标题一样，我在我的代码的一部分中，我想调用已添加到 Button.Click 处理程序的任何方法。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-13T09:06:46.967

你的意思是你需要从代码中的其他地方访问它吗？将该部分重构为它自己的方法然后在需要访问它时调用该方法（包括在 Click 事件中）可能是一个想法

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-13T09:30:57.277

避免。真的。似乎您在事件处理程序中处理了一些重要的逻辑。

将逻辑移出处理程序。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T09:43:25.160

你可以通过反射来做到这一点..

```
 Type t = typeof(Button);
    object[] p = new object[1];
    p[0] = EventArgs.Empty;
    MethodInfo m = t.GetMethod("OnClick", BindingFlags.NonPublic | BindingFlags.Instance);
    m.Invoke(btnYourButton, p); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T09:12:39.420

您将需要一个事件来充当代理，但您最好只重构您的代码。

```
 private EventHandler ButtonClick;

    protected override void CreateChildControls()
    {
        base.CreateChildControls();

        m_Button = new Button{Text = "Do something"};

        m_Button.Click += ButtonClick;

        ButtonClick += button_Click;

        Controls.Add(m_Button);

    }

    private void MakeButtonDoStuff()
    {
        ButtonClick.Invoke(this, new EventArgs());
    }

    private void button_Click(object sender, EventArgs e)
    {

    } 
```

如果您真的不需要它，请不要这样做。它会弄乱你的代码。

# eclipse - 在 Eclipse 的主干中使用 Subversion 连接器 SVNKit 1.2.1

> ID：286573
> 
> 赞同：1
> 
> 时间：2008-11-13T09:01:41.937
> 
> 标签：eclipse, svn, svnkit

我想测试 SVNKit 1.2.1 附带的功能，该功能在 Eclipse 或 Polarion 项目的更新站点上尚不可用。

我按照[svnkit.com/download.php](http://svnkit.com/download.php)上的“最新开发版本”中所述进行了结帐，使用 ant 成功构建它并使用 Eclipses 软件管理器成功安装它。

现在我在 [Preferences / Team / SVN / SVN Connector] 的连接器列表中看不到 SVNKit 1.2.1。所以我不能将 Eclipse 配置为使用 SVNKit 1.2.1 作为 Subversion 连接器。

任何人都知道我错过了什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-18T07:53:15.437

我对 SVNKit 如何连接到 Subversive 的概念有误。SVNKit 本身只是 subversion 库，它必须可用于构建 Subversive trunk checkout。

# c - 任何人都知道如何将 WMI 与 C 而不是 C++ 一起使用？

> ID：286575
> 
> 赞同：0
> 
> 时间：2008-11-13T09:02:34.040
> 
> 标签：c, wmi, java-native-interface, hyper-v

我不想为此重新学习 C++！任何图书馆/网址都会很棒，是的，谷歌在这里没有多大帮助:-(

这是针对即将到来的项目，我的产品（基于 Java）将为 Microsoft 的 Hyper-V 虚拟化平台提供支持。与提供 Web 服务的 VMware 不同，Hyper-V API 只是 WMI 的扩展。我不希望使用 J-Integra 等商业工具将 Java 集成到 COM/WMI 中，而且我发现的少数开源工具已经过时了。

我宁愿将 JNI 与 C 一起使用而不是 C++。有人知道我在哪里可以找到使用 C 进行 WMI 操作的库等吗？是否可以像使用 Python 客户端一样使用？（是的，我知道 C 不是 OOP 语言：D）。

提前致谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T10:53:52.227

WMI 是通过 COM 访问的，对吗？

虽然它更冗长且更容易出错（很容易意外地为 vtable 和“this”参数使用不同的指针），但您也可以使用 C 语言中的 COM。

您也可以使用 C++，但将其视为“带有语言扩展的 C，使使用 COM 更容易”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T20:34:18.163

JNI 接口本身是 COM 的衍生物，如果您使用足够多的 C++ 将接口视为由 C++ 类实现，您会发现这些方法和 WMI 接口的方法更容易使用。

另一件有用的事情是，您将能够使用 COM 接口指针和引用计数作为将 COM 接口的生命周期绑定到 JNI 实现的 Java 类的生命周期的一种方式。

我使用这样的方法通过 JNI 实现了一个 Java 桥接器，连接到 Windows 上的一些 C 语言接口。我手工制作了 COM 接口和一个用于构建 JNI DLL 的 .lib。

使用 WMI 的困难部分是您需要使用标准 COM API 来实例化 COM 对象，而我创建了自己的自定义“工厂”代码，因为它都是私有实现。

您可以下载我的[ODMJNI 1.0 0.50beta Function-Complete Release](http://odma.info/dev/devNotes/2006/12/d061201g.htm)开发树的快照。如果您查看开发树中的 info.odma.odmjni100，您将看到 JNI DLL 是如何构建的（使用 VC++ 2005 Express Edition）和 Java 1.5。OdmJniBind.java 类包含在 Java 类中用于协调 Java 类和 COM 对象接口之间的对象生命周期的静态方法。（树的 OdmNative 对等部分提供了用于编译通过 JNI 使用的 odmjni100.dll 的 OdmNative100.lib 的实现。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-20T08:51:03.883

@z0ltan

您可以用 C 编写代码，但必须将文件另存为 CPP。正如前面有人提到的，要获得 DCOM 支持，您的文件需要是 CPP 文件。

@Umi 用于 Java 集成 - 将 C/CPP 中的 WMI 代码编译为 DLL（带有适当的 JNI 头文件），然后您必须加载 DLL 库文件。完成此操作后，您可以访问 DLL 文件中的 WMI 方法，就像调用 Java 方法一样。

# sharepoint - 使用共享点文档库，如何创建“永久链接”？

> ID：286581
> 
> 赞同：4
> 
> 时间：2008-11-13T09:05:34.317
> 
> 标签：sharepoint, document-library

我希望能够链接到共享点文档，而不必参考可能会更改的文档名称。无论如何以编程方式向元数据添加唯一键，然后以某种方式在链接中使用它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T19:16:10.753

您可以链接到库中文档的 ID。这不会打开文档，但无论文件名如何，它都会将您带到正确的文件。

我不知道您如何在没有文档名称的情况下直接链接到文档。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T09:24:06.650

每个库都有一个 GUID 作为标识符。您可以以编程方式获取该 GUID 并从中获取 url。

# html - 我可以从命令行打印 html 文件（带有图像、css）吗？

> ID：286583
> 
> 赞同：8
> 
> 时间：2008-11-13T09:06:53.893
> 
> 标签：html, linux, command-line, scripting, printing

我想用脚本中的图像打印样式化的 html 页面。任何人都可以建议一个开源解决方案吗？

我正在使用 linux (Ubuntu 8.04)，但也会对其他操作系统的解决方案感兴趣。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-13T09:56:49.610

你可以试试[html2ps](http://user.it.uu.se/~jan/html2ps.html)，它是用 Perl 编写的，所以我猜它可以在任何运行 Perl 的操作系统上运行。它确实支持 CSS 和图像。它的渲染效果不如您可能想要的那么好。

要在 Debian/Ubuntu 中使用`sudo aptitude install html2ps`，然后将输出通过管道传输`lpr`到打印：

```
html2ps \
    http://stackoverflow.com/questions/286583 \
    |lpr 
```

或者将输出通过管道传输到 ps2pdf 以转换为 pdf 文件：

```
html2ps \
    http://stackoverflow.com/questions/286583 \
    |ps2pdf - stackoverflow.pdf 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-13T10:42:29.907

你有很多选择：html2ps，html2pdf，一个巨大的列表：[http ://www.hypernews.org/HyperNews/get/www/html/converters.html](http://www.hypernews.org/HyperNews/get/www/html/converters.html)

但我个人建议使用[htmldoc](https://github.com/michaelrsweet/htmldoc)，它执行 postscript、PDF 并且是最新的（最近的版本是 <2 周前。您需要使用 wget 或 elinks 之类的工具来实际下载 HTML 文件及其组件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T09:37:55.717

如果您的安装上有 kde，那么您可以启动 konqueror 并使用 dcop 或 dbus 向它发送命令。这意味着您必须运行 x ，这可能对您不起作用。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-11-13T09:11:31.917

我不确定这段代码是否适用于单声道，但它至少应该适用于 Windows 和“真正的”.NET Framework：http: [//pietschsoft.com/post/2008/07/C-Generate-WebPage-Thumbmail -屏幕截图-Image.aspx](http://pietschsoft.com/post/2008/07/C-Generate-WebPage-Thumbmail-Screenshot-Image.aspx)

# c# - 声明成员时可以指定接口吗？

> ID：286584
> 
> 赞同：2
> 
> 时间：2008-11-13T09:07:24.437
> 
> 标签：c#, interface

我需要我的类的成员作为控件，并让它实现我们定义的接口。

如果我这样声明...

```
public class MyClass
{
    public Control MyMember;
} 
```

...然后我没有得到接口方法，但是如果我这样声明它...

```
public class MyClass
{
    public IMyInterface MyMember;
} 
```

...然后我没有得到控制方法。有没有办法指定 MyMember 必须初始化为继承自两者的类型？我在 MSDN 上找不到。就像是...

```
public class MyClass
{
    public Control : IMyInterface MyMember;
} 
```

... 或者 ...

```
public class MyClass
{
    public Control MyMember : IMyInterface;
} 
```

...除了这些都不起作用。我可以在声明成员时指定接口吗？如果可以，如何指定？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T09:13:36.827

您可以使用带有约束的泛型：

```
public interface MyClass {
    public T GetMyControl() where T : Control, IMyInterface { /* ........ */ }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T15:57:37.690

由于围绕 Control 编写一个包装类和一个简单的泛型类非常麻烦：

```
public class MyGenericClass<T> where T : Control, IMyInterface
{
    public T t;
} 
```

可能不符合您的需求。您可以简单地使用不同的属性以不同的方式访问该字段：

```
public class MyClass
{
    private IMyInterface m_field;
    public Control FieldAsControl
    {
        get { return m_field as Control; }
    }
    public IMyInterface Field
    {
        get { return m_field; }
        set
        {
            if (m_field is Control)
            {
                m_field = value;
            }
            else
            {
                throw new ArgumentException();
            }
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T09:21:45.343

您可以拥有从控件派生的自己的类，其接口定义如下：

```
class MyControl : Control, IMyInterface
{
} 
```

然后使用这个类作为成员：

```
public class MyClass
{
    public MyControl MyMember;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-06T17:15:44.947

声明一个接口 ISelf(of out T) [*]，其中包括一个返回 T 的函数“Self”。让你的接口支持非泛型和泛型版本，其中泛型版本继承非泛型版本和 ISelf(of本身）。然后，您可以让一个类继承自 ISelf(of Control) 和 ISelf(of IMyInterface)，并将您的字段 MyMember 声明为 ISelf(of IMyInterface(of Control)) 类型。然后可以将 MyMember 用作 iMyInterface，并将 MyMember.Self 用作控件。可以以这种方式组合任意数量的接口。

[*] 用于避免将尖括号作为 HTML 标记处理的泛型的 VB 语法。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-13T09:11:28.860

在接口上使用继承的力量

```
public interface IMyInterface : Control
{
  ..
} 
```

现在你说你想要一个带有一些特殊方法的控件。

* * *

**编辑：** TcKs 当然是对的.. 你不能从具体类继承接口。

解决此问题的一种方法是使用返回控件的属性或方法来扩展接口。

样本：

```
public interface IMyInterface 
{
  Control Control { get; }

  [..rest of the definition..]
} 
```

并像这样实现它：

```
class MyControl : Control, IMyInterface
{
  public Control Control { get { return this; } }

  [..rest of the implementation..]
} 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-11-13T17:47:01.230

This sounds fundamentally wrong.

Does IMyInterface declare only the same methods/properties as found in the Control class? If not, what do you hope to accomplish? You cannot implement an interface and ignore the methods declared within it - you must explicitly write out the implementations.

If IMyInterface does, in fact, declare only the same methods/properties as found in the Control class, you will have to create your own MyControl class which inherits from Control and implements IMyInterface. This isn't some stupid quirk of the language. The Control class wasn't defined to be an IMyInterface and C# is a statically typed - not a "duck-typed" - language, so it cannot automatically give Control whatever interface you desire.

# .net - MySQL缓存

> ID：286585
> 
> 赞同：1
> 
> 时间：2008-11-13T09:08:49.160
> 
> 标签：.net, mysql, database, enterprise-library

昨晚我在 mySQL 数据库中的存储过程中添加了一个参数。我访问了它，弄乱了参数，并决定再次删除该参数以进行测试。在没有参数的情况下重新创建过程后几分钟，我的命令对象仍在抱怨缺少参数。这是 mySQL、MySQL/Connector、ADO 或企业库的错吗？我能做些什么呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-16T01:35:43.607

默认情况下，MySQL 在您的存储过程中缓存查询。查看是否启用了查询缓存：

```
SHOW VARIABLES LIKE 'query_cache%' 
```

MySQL 不缓存存储过程调用，但如果`query_cache_type`设置为 ON，这将影响从过程中发出的查询的缓存。可能导致 MySQL 在几分钟内返回相同的结果。尝试刷新缓存，或者更好的是，如果您更新的过程不断返回先前的结果集，则重置查询缓存以删除所有查询：

```
RESET QUERY CACHE 
```

这应该消除 MySQL 服务器的任何缓存。

下次发生这种情况时，您可以通过另一个不使用 MySQL/Connector 或 Enterprise Library 的工具手动执行该过程。这将告诉您旧结果集是否由 MySQL 或应用程序中的驱动程序和应用程序块缓存。

***编辑：****请阅读下面的评论，由 Desertwebdesign 提供。重新创建存储过程后，断开连接。连接池可能会保持连接打开，因此最好从 MySQL 中终止连接。大多数查询浏览器都有一个选项卡，如果您使用进程/超级权限登录，则允许您终止 MySQL 中的连接。*

```
SHOW FULL PROCESSLIST
KILL CONNECTION thread_id 
```

# unit-testing - 你真的在使用单元测试吗？

> ID：286587
> 
> 赞同：51
> 
> 时间：2008-11-13T09:08:54.370
> 
> 标签：unit-testing, testing

我参与了很多新旧项目，他们的共同点是几乎没有一个项目使用过单元测试。我更喜欢使用它，但通常客户还没有准备好为此付费，并假设代码可以正常工作。

那么，您是在项目中使用单元测试，还是依赖您的编码技能？

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2008-11-13T09:14:45.280

使用单元测试*是*一种编码技能。

我发现它对编码时间增加的开销很小。最重要的是，生成的代码往往更容易理解和重构，维护时间大大减少。

在这里全面讨论好处：[单元测试值得付出努力吗？](https://stackoverflow.com/questions/67299/is-unit-testing-worth-the-effort)

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-11-15T04:17:45.513

我会诚实的。我最近才开始编写单元测试，当我回过头来修改我过去糟糕的旧 DLL 时，我会蹲下来编写单元测试以使其接近 100% 的代码覆盖率。我说“接近”是因为由于代码的结构方式，它没有考虑到模拟或单元测试（这在抽象类或抽象类中经常发生） P/Invoke 到本机代码）。虽然我知道 100% 的代码覆盖率与 100% 的所有代码执行路径不同，但我发现进行测试是一种很好的方法来判断我何时做的事情会破坏很多东西的。

老实说，这可能是许多开发人员（包括我自己）花了这么长时间才开始采用单元测试的原因之一（我们暂时不要进入 TDD）。

我并不是说这些都是正当的理由，但它们确实或多或少地经过了我的头脑，我敢打赌它们也经过了你的一些：

*   首先，有这样的想法：“哦，我写了一堆零测试的代码，看到我已经被那座山压垮了，我可能没有时间再添加几座测试山上面的代码。”

*   其次，没有人喜欢谈论经典的代码-运行-调试循环实际上在您使用时“足够好”这一事实。

    *   编写不会改变旧代码行为的新代码
    *   从事相对较小的软件项目或一次性实用程序
    *   项目的唯一开发人员（您可以在一定程度上保留大部分内容）
*   第三，当您维护现有代码时，单元测试更容易理解，而且如果您总是在编写新代码，那么好处不会立即显现出来。当你的工作是生产一个实用程序并且不再接触它时，开发人员在单元测试中几乎看不到任何价值，因为他们可能不会在维护程序员时或在公司工作（谁希望在那里是一个单元测试）来了。

*   第四，单元测试是一个相当新的创新。（哦，嘘……我知道这个想法一直存在，尤其是在关键任务和国防部应用程序中，但对于“~~管道工乔”来说~~像我这样的“开发人员”类型？在这十年的早期，我在整个 CS 本科生涯中根本没有提到单元测试；在 2008 年，我听说它是​​ 101 级以上所有项目的要求。Visual Studio 甚至没有直到今年才获得一个内置的测试框架，即使那时也只有专业版。）我的无知是幸福的吗？当然，我认为很多人编码是因为这是他们的日常工作（这很好）根本不知道。如果他们知道，那么他们知道他们必须保持最新状态，但是在学习一种新方法时（尤其是涉及编写更多代码并在需要新功能时花费更多前期时间的方法）*昨天*做的*) 意味着它会被推回。这是长尾，在十年左右的时间里，我们关于单元测试的讨论将看起来像我们关于面向对象编程在 1990 年代开启新的开发时代的喃喃自语一样古怪。哎呀，如果*我已经*开始了单元测试，那么结束一定很近，因为我通常是个白痴。*

**   第五，对某些代码区域进行单元测试真的很困难，这让我吓了一跳。想到了多线程事件队列、图形渲染和 GUI。许多开发人员意识到这一点，并认为“哎呀，单元测试对于库代码来说会很棒，但我最后一次只写一个类库是什么时候。” 需要一段时间才能过来。为此，没有单元测试并不一定意味着糟糕的代码就在眼前。

    *   最后，有时来自单元测试倡导者的宣传水平可能令人生畏和令人反感。说真的，我认为我是个白痴，因为我无法理解如何模拟某个界面以及为什么要模拟。自私地，我想讨厌单元测试，如果只是因为*每个人都不会闭嘴*。没有银弹。* 

 *因此，为漫无边际的帖子道歉。总之：

*   好久没做单元测试了。现在我愿意。单元测试是一个很好的工具，尤其是在维护期间。

*   对于现有项目，您至少可以编写一个记录当前输入及其输出的测试。当您将来更改那一大堆模糊的代码时，您将能够查看您是否更改了那个小快照。这也是改变公司发展文化的绝佳方式。

让火焰开始燃烧吧！=)

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-11-13T09:37:36.060

单元测试不能是事后的想法，它是*并且必须是*影响您设计的因素。我什至会说，即使你从不编写或调用单个单元测试，它在领先的紧密组件驱动软件方面所带来的好处在 95% 的时间里都是值得的。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-13T09:29:15.437

在参与了几个正在生产但需要主要新功能的项目之后，作为启动项目的技术负责人，我的底线之一是必须进行单元测试。

尝试重写未经单元测试编写的代码的成本太高了。代码的结构总是很糟糕（一个数千行的网络服务都在一个代码中？）并且在不引入错误的情况下对其进行更改（即使它结构良好）是一个非常痛苦的过程。

当项目进入救火模式时尤其如此（没有单元测试也会导致项目进入那种状态）——客户变得脾气暴躁，他们对项目失去了信心，没有什么比做可怜的人更糟糕的了试图在不引入一大堆回归错误的情况下进行下一个修复，甚至没有进行单元测试。

通过预先解释测试的价值，可以很容易地避免或至少减轻这些情况。当然，在某些情况下，单元测试并不那么重要，但它们确实是个例外。

所以是的——我坚持单元测试，并且花了很多时间来修复其他依赖他们的编码技能的开发人员造成的混乱。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-11-13T10:49:29.927

编写和运行单元测试是健康编码过程的一部分，它不是客户应该选择付费或不付费的附加功能。

测试策略和其他任何问题一样是一个编码问题：使用什么数据结构、变量命名约定、注释标准等。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-11-13T13:22:08.020

我尽可能使用单元测试和 tdd。然而，根据我对每个单元测试倡导者的经验，有三个或更多的开发人员并不真正相信编写单元测试值得付出努力，并且会减慢开发速度。然而，这些人往往保持安静，所以你不太可能在这里看到很多。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-11-13T15:51:44.223

我喜欢 Bob Martin 的类比：想象你是一名外科医生。对于一个想要支付手术费用但告诉你不要提前洗碗的病人，你会说什么？

当客户聘请我编写代码时，他们将我聘为专业人士，作为具有专业技能和纪律的人。我的工作是让他们“代码按应有的方式工作”，**我知道**最好的方法是使用 TDD。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-11-13T09:13:25.720

我经常对复杂的数学算法使用单元测试，例如 LineIntersectsLine 之类的函数，您可以在其中定义一些重要的示例进行测试。之后，更容易控制此功能。您可以简单地重写/优化它并测试它是否仍然有效，或者如果遇到错误，您可以添加新测试然后尝试纠正这些错误。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2013-01-04T23:27:44.127

我发现新开发人员从单元测试中受益更多，而不是那些不得不从那些可能导致某些事情失败的陷阱的严厉打击中学习的老开发人员。单元测试不会带来好的设计——它只会带来更可测试的设计。你需要测试你的代码，但是单元测试的宣传方式是危险的。“它会迫使你更好地设计你的代码”，“你如何测试它是否正确？”。

我更喜欢编写良好的结构化代码，当你阅读它时，它会自动告诉你它试图完成什么以及它是如何做到的。函数/类应该小而简洁。他们应该只承担一项责任。单元测试不能防止逻辑错误。

单元测试比其他任何东西都提供更多的误报，尤其是在第一次编写项目时。好的设计胜过测试——测试应该只是验证阶段。我从来没有买过测试先于其他所有概念。以我的经验，这种思路倾向于以可扩展代码为代价的可测试性（对于一次性项目或一次性实用程序可能没问题，但具有讽刺意味的是，单元测试对这些来说并不重要）。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-11-13T10:52:38.513

我同意 Ken 的观点，即单元测试是软件开发的一部分。

关于成本问题，确实比写代码加上单元测试比只写代码要长。但是，当您编写代码及其测试时 - 称为 TDD -[测试驱动开发](http://en.wikipedia.org/wiki/Test-driven_development)，您会以“*干净的代码有效*”结束。当你只写代码时，你必须让它工作，这可能是漫长而痛苦的。

另一个好处是您知道自己在哪里，因为已编写的代码已经过单元测试。

要回答您的问题，是的，我会尽可能在我的项目中使用单元测试。我为所有新代码编写单元测试，并为遗留代码而努力。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-11-13T14:05:30.913

我是单元测试的忠实粉丝，主要是因为它完全让人上瘾——JUnit 中的“代码-测试-看到可怕的红色条-修复-测试-看到可爱的绿色条”循环严重地让内啡肽激增。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-11-14T02:53:05.747

我公司为航空航天工业的多家公司生产系统组件。FAA 要求质量级别 A 安全关键飞行软件 ( [DO-178-B](http://en.wikipedia.org/wiki/DO-178B) ) 的修改条件/决策覆盖率因此，为了验证，我们这样做（再次来自 DO-178-B）：

通常需要分析从测试和结果到所有需求的所有代码和可追溯性（取决于软件级别）。

此过程通常还涉及：

> 基于需求的测试工具
> 
> 代码覆盖分析工具
> 
> > 在此过程中执行的测试的其他名称可以是：
> > 
> > > ***单元测试***
> > > 
> > > 集成测试
> > > 
> > > 黑盒和验收测试

单元测试总是揭示代码错误。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-11-13T16:20:44.790

关于依赖我的编码技能，我发现当我使用 TDD 时我的编码技能实际上得到了提高，并且当我打破测试时依靠我的单元测试来纠正我。您将学习如何使用许多语言功能，因为您可以进行调整以测试假设。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-11-18T13:29:35.133

我从经验中知道，当我在没有单元测试的情况下编写代码时，我会遇到一些需要解决的问题，但是当我编写单元测试时，我很少听到问题。此外，从编写单元测试的时间开始，我开始编写更好的代码。我研究方法并思考它们可能失败的方式，并从一开始就构建它们以不失败或至少以更好的方式失败。

单元测试对于编写更好的代码是必不可少的，但它也会让你成为更好的开发人员，因为你可以在测试之前发现可能出错的地方并修复它们。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-11-13T10:59:48.360

单元测试是开发的重要组成部分，并且（我发现）实际上会减少完成项目的时间，同时提高整体质量，尤其是在 TDD 风格中完成时。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-11-13T12:51:30.563

我做单元测试。我目前正在构建一个约束验证引擎，我的客户希望它是防弹的。好吧，如果没有单元测试，我会死于压力...

所以是的，我用它！

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-11-13T13:21:56.320

我编写的大多数函数都有测试。就像上面许多人所说的那样，单元测试是软件工程的重要组成部分。所以，回答你的问题，是的，我真的在编写和运行测试。

此外，通过[持续集成](http://en.wikipedia.org/wiki/Continuous_integration#Make_your_build_self-testing)，回归测试将自动化并不断报告。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-11-13T20:11:04.623

另一个非常有用的提醒，为什么你要在这篇文章中出现的任何地方进行单元测试：[编写单元测试的 12 大理由](http://www.onjava.com/pub/a/onjava/2003/04/02/javaxpckbk.html) 我需要把它刻在我的视网膜上。

我可以亲自证明从一开始就考虑如何测试某件事的价值，通过每次迭代开发测试。我自己需要更系统。我现在正在打印该列表。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-11-13T20:17:52.987

如果单元测试到位，您的客户可能会总体上节省资金。如果在开发阶段的后期而不是在单元测试期间发现，单元测试可以防止的一些错误更容易造成负担。它在未来节省了很多头痛，现在我使用它，我认为我再也回不去了。

# ruby - 集成测试中的模拟文件系统

> ID：286589
> 
> 赞同：17
> 
> 时间：2008-11-13T09:10:03.933
> 
> 标签：ruby, linux, unit-testing, rspec, mocking

我正在编写一个执行一些外部命令行实用程序的 ruby​​ 程序。如何从我的 rspec 测试中模拟文件系统，以便我可以轻松设置一些文件层次结构并在测试后对其进行验证。最好在 ram 中实现，以便快速运行测试。

我意识到我可能找不到可移植的解决方案，因为我的外部实用程序是直接与操作系统文件服务交互的本机程序。Linux 是我的主要平台和解决方案就足够了。

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-12-01T14:48:30.547

你检查[过 FakeFS](http://github.com/defunkt/fakefs "FakeFS")或~~MockFS~~吗？

*注意：到 MockFS 的原始链接不起作用。[看起来](https://rubygems.org/gems/mockfs)它不再被维护了。*

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-13T10:52:25.160

也许这不会直接回答您的问题，但在这种情况下，我倾向于在测试设置期间创建一个临时目录并在拆卸时将其删除。当然，您还必须确保应用程序写入此临时目录。我总是有一个配置选项来定义我可以在测试期间覆盖的目标目录。

当涉及到断言时，我使用普通的`File.exist?`or `File.directory?`，但当然你可以围绕它创建自己的包装器。如果您需要一些初始状态，您可以构建一个可用作夹具的目录，并将在测试设置期间复制到临时目录。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-13T19:24:03.720

您可以创建一个大文件（虚拟磁盘的大小）并将该文件挂载为[回送设备](http://www.csulb.edu/~pnguye11/loopbackDev.html)。您可以在此设备上创建任何文件系统和目录结构。
您可以创建其中 2 个并进行简单的差异比较，以确保测试后的数据完整性。
我希望我能正确理解您的要求，因为我不确定为什么简单的 ramdisk 解决方案不够好。
[这](http://en.wikipedia.org/wiki/Disk_image_emulator)也可能是相关的。

# windows - 我能确定我写的代码总是在同一个线程中执行吗？

> ID：286594
> 
> 赞同：1
> 
> 时间：2008-11-13T09:12:23.913
> 
> 标签：windows, multithreading, com

我通常在单线程应用程序上工作，并且通常从未真正为处理线程而烦恼。我对事情如何工作的理解——当然，这可能是错误的——是只要我们总是处理单线程代码（即没有分叉或类似的东西），它将总是在同一个线程中执行。

这个假设正确吗？我有一个模糊的想法，即 UI 库/框架可能会产生自己的线程来处理 GUI 内容（这说明了 Windows 任务管理器告诉我我的“单线程”应用程序实际上在 10 个线程上运行）但我我猜这不应该影响我吗？

这如何适用于 COM？例如，如果我要在我的代码中创建一个 COM 组件的实例；并且该 COM 组件将一些信息写入基于线程的位置（`System.Threading.Thread.GetData`例如使用），我的应用程序是否能够获取该信息？

总而言之：

1.  在单线程代码中，我是否可以确定我存储在基于线程的位置中的任何内容都可以从代码中的其他任何地方检索？

2.  如果该单线程代码要创建一个 COM 组件的实例，该实例将一些信息存储在基于线程的位置，那么它是否可以类似地从其他任何地方检索？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T09:43:18.560

UI 通常具有相反的约束（可悲）：它是单线程的，并且一切都必须在该线程上发生。

检查您是否总是在同一个线程中（例如，一个函数）的最简单方法是将一个整数变量设置为 -1，并具有一个检查函数，例如（假设您在 C# 中）：

```
void AssertSingleThread()
{
   if (m_ThreadId < 0) m_ThreadId = Thread.CurrentThread.ManagedThreadId;
   Debug.Assert(m_ThreadId == Thread.CurrentThread.ManagedThreadId);
} 
```

那说：

我真的不明白问题＃1。如果您的目的是拥有全局范围，为什么要存储在基于线程的位置？

关于第二个问题，大多数 COM 代码在单线程上运行，并且通常在 UI 消息处理所在的线程上运行 - 这是因为大多数 COM 代码被设计为与单线程的 VB6 兼容。

您的程序有大约 10 个线程的原因是因为 Windows（如果您使用它的某些功能，如完成端口或某种计时器）和 CLR（例如用于 GC 或某些类型的计时器）可能会创建进程空间中的线程（从技术上讲，任何具有足够权限的程序也可以）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T09:47:52.687

考虑在 mainThread 中运行单个 dataStore 类的模型，所有线程都可以读取和写入它们的实例变量。这将避免在访问整个商店的线程时可能出现的许多问题。

简单的想法，直到你到达线程的有趣部分。并发和同步；简单地说，如果您有两个线程想要同时读取和写入 dataStore 中的同一个变量，那么您就有问题了。

Java 通过允许您声明一个同步的变量或方法来处理这个问题，一次只允许一个线程访问。

我相信一些 .NET 对象上定义了 Lock 和 Synchronized 方法，但我知道的仅此而已。

# .net - Boo 可见的内部结构 (Binsor)

> ID：286599
> 
> 赞同：2
> 
> 时间：2008-11-13T09:14:36.810
> 
> 标签：.net, clr, rhino-mocks, boo, binsor

我正在为 IoC 使用 Castle Windsor，我想使用 Binsor 来定义我的配置。我想让 Boo 看到我的内部结构。我试图用它来标记我的程序集， `InternalsVisibleTo("Boo.Lang")`但这并没有完成这项工作。我已经尝试过`InternalsVisibleTo("Rhino.Commons")`，因为我注意到异常是从 Rhino.Commons.Binsor.BooComponentInstaller 中引发的，但这也不起作用。有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-10-20T08:29:30.090

在 Boo 中还没有 InternalsInvisible，在 2007 年/2008 年初尝试使用它进行测试。

在 Boo 的 codehaus 页面中记录了一个问题： [Boo Issue around this](http://jira.codehaus.org/browse/BOO-1004)

似乎计划在 V0.9.3 中修复

# c++ - Eclipse CDT 5.0.1 (Ganymede) 慢速索引器问题

> ID：286602
> 
> 赞同：3
> 
> 时间：2008-11-13T09:16:17.943
> 
> 标签：c++, eclipse, indexing, eclipse-cdt, ganymede

我正在尝试使用 Ganymede CDT 来索引我们的大型代码库。它非常缓慢，可能需要一整夜来索引 C++ 文件。使用 exuberant ctags 5.7 索引同一个项目只需 5 秒。

有没有办法找到问题的根源并加快速度？也许打开登录 CDT，或者我错过的某个晦涩的选项？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-15T06:40:30.287

如果您使用“完整索引器”，我不会感到惊讶。我正在使用“快速索引器”，它非常快并且运行良好（即使使用 wxWidgets）。

您可以在 Window->Preferences->C/C++->Indexer 中更改索引器设置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T10:39:23.207

你知道这是否是 5.0.0 的回归吗？在这种情况下，您绝对应该打开一个错误报告。

您的所有代码都在同一个项目中吗？这可能会产生影响。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-06T22:15:53.893

我们在 Windows 下使用 Eclipse 也有类似的问题；在我们的例子中，这是因为旧版本的 cygwin。

要知道您是否有同样的问题，只需使用[Process Explorer](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)检查Eclipse 是否生成 cygpath.exe，并且它没有在合理的时间内完成。
如果这是导致问题的原因，那么只需将最新版本的 cygpath.exe 和 cygwin1.dll 放在 eclipse 目录中即可，然后就完成了。

祝你好运！

# javascript - 扩展每个 Ajax.Request onSuccess 事件（Javascript 原型框架）

> ID：286603
> 
> 赞同：0
> 
> 时间：2008-11-13T09:16:35.057
> 
> 标签：javascript, ajax, prototypejs

我有一个在很多地方使用的应用程序`Ajax.Request`及其事件处理程序。`onSuccess`

`onSuccess`在所有这些事件触发之前，我需要调用一个函数（它将检查响应） 。我尝试使用 `Ajax.Responders.register`with`onComplete`事件，但它在`Ajax.Request`'s`onSuccess`事件之后触发。有什么建议么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-02-05T06:47:03.977

类似于 Aleksander Krzywinski 的回答，但我相信通过将其合并到 onCreate Responder 中，这将防止您不得不到处使用“wrap”。

```
Ajax.Responders.register({

  onCreate: function(request) {

    request.options['onSuccess'] = request.options['onSuccess'].wrap(validateResponse);

  }

}); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-13T09:46:35.560

有几个[事件可供选择](http://www.prototypejs.org/api/ajax/request)。这是事件链`Ajax.Request`：

1.  `onCreate`
2.  `onUninitialized`
3.  `onLoading`
4.  `onLoaded`
5.  `onInteractive`
6.  `onXYZ`,`onSuccess`或`onFailure`
7.  `onComplete`

`onLoading`, `onLoaded`,`onInteractive`听起来很有趣，但根据[规范](http://www.prototypejs.org/api/ajax/options)，它们不能保证会发生。这使您可以连接到`onCreate`，在构建请求对象之后但在实际发出请求之前调用它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T09:21:57.230

您可以在 onSuccess 中的其他代码之前运行您的方法，如果出现问题则返回 false。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T04:02:11.613

这可能有点晚了，但为了其他想知道同样问题的人的利益，我将提出这个解决方案：

您可以使用 Prototypes 自己的面向方面编程的实现来执行此操作。当然，您必须修改所有 onSuccess 参数，但可以通过简单的搜索和替换来完成，而不是更新所有回调函数。这是一个示例 Ajax.Request 创建：

```
new Ajax.Request('example.html', {
    parameters: {action: 'update'},
    onSuccess: this.updateSuccessful
}); 
```

假设您的代码中散布着类似的代码片段，并且您希望在它们之前使用某个函数在实际函数运行之前验证响应（甚至根本无法运行）。通过使用 Prototype 中提供的 Funtion.wrap，我们可以通过扩展上面的代码来做到这一点：

```
new Ajax.Request('example.html', {
    parameters: {action: 'update'},
    onSuccess: this.updateSuccessful.wrap(validateResponse)
}); 
```

其中 'validateResponse' 是与此类似的函数：

```
// If you use the X-JSON-header of the response for JSON, add the third param
function validateResponse(originalFn, transport /*, json */) {
    // Validate the transport

    if (someConditionMet) {
        originalFn(transport /*, json */);
    }
} 
```

因此，您只需快速搜索 onSuccess 并粘贴到 'wrap(validateResponse)' 中，即可将 onSuccess 函数扩展至一个中心位置。这也为您提供了根据特定 Ajax 请求的需要使用多个包装函数的选项。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-06-26T08:48:33.103

不知道这是否是最干净的解决方案，但对我来说它成功了。

```
 var tmp = Ajax.Request;
Ajax.Request = function(url, args) {
 // stuff to do before the request is sent
 var c = Object.clone(args);
 c.onSuccess = function(transport){
  // stuff to do when request is successful, before the callback
  args.onSuccess(transport);
 }

 var a = new tmp(url, c);
 return a;
}
Ajax.Request.protoype = new tmp();
Ajax.Request.Events = tmp.Events;
delete tmp; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-20T08:28:24.397

“通用解决方案” - 独立于 JS 框架（种类）

```
var oldFunc = Ajax.Request.onSuccess;
Ajax.Request.onSuccess = function foo() {
  alert('t');
  oldFunc.apply(this, arguments);
} 
```

这将“扩展”您的 JS 函数，使其*完全按照*以前的方式执行，除了每次执行前都会显示一个警告框...

# java - Java 中的 KeyListener 是抽象的；不能实例化？

> ID：286605
> 
> 赞同：5
> 
> 时间：2008-11-13T09:20:38.810
> 
> 标签：java, instantiation, keylistener

我正在尝试在 java 中创建一个 Key Listener 但是当我尝试

```
KeyListener listener = new KeyListener(); 
```

Netbeans 告诉我 KeyListener 是抽象的；无法实例化。我知道我缺少这个关键侦听器的其他部分，但由于这是我第一次使用关键侦听器，我不确定我还需要什么。为什么要告诉我这个？

谢谢，

托梅克

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-13T09:24:52.263

`KeyListener`是一个接口 - 它必须由某些东西来实现。所以你可以这样做：

```
KeyListener listener = new SomeKeyListenerImplementation(); 
```

但你不能直接实例化它。您*可以*使用匿名内部类：

```
KeyListener listener = new KeyListener()
{
    public void keyPressed(KeyEvent e) { /* ... */ }

    public void keyReleased(KeyEvent e) { /* ... */ }

    public void keyTyped(KeyEvent e) { /* ... */ }
}; 
```

基本上，这取决于您想做什么。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-13T16:54:28.170

KeyListener 是一个接口，因此您必须编写一个实现它的类才能使用它。正如 Jon 建议的那样，您可以创建一个内联实现它的匿名类，但是有一个名为 KeyAdapter 的类是一个实现 KeyListener 的抽象类，每个接口方法都有空方法。如果您将 KeyAdapter 子类化，那么您只需要覆盖您关心的那些方法，而不是每个方法。因此，如果你只关心 keyPressed，你可以这样做

```
KeyListener listener = new KeyAdapter()
{
    public void keyPressed(KeyEvent e) { /* ... */ }
}; 
```

这可以为您节省一些工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T09:25:58.440

KeyListener 是一个接口，这意味着您可以基于它编写一个类并实现其功能。也许本[教程会有所](http://java.sun.com/docs/books/tutorial/uiswing/events/keylistener.html)帮助。

# c++ - 在 Windows Mobile 上更改键盘布局

> ID：286606
> 
> 赞同：1
> 
> 时间：2008-11-13T09:21:01.210
> 
> 标签：c++, windows-mobile

在应用程序中有一个对话框，其中只有数字字符串条目是有效的。因此我想设置数字键盘布局。

有谁知道如何模拟键盘上的按键或任何其他方法来更改键盘布局？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T21:44:56.307

你不需要。

就像全窗口一样，您可以将编辑控件设置为仅限数字输入。您可以[手动](http://msdn.microsoft.com/en-us/library/bb761655(VS.85).aspx)执行此操作，也可以在编辑控件属性中的对话框编辑器中执行此操作。

当仅数字编辑控件成为焦点时，SIP 应自动显示数字键盘。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T10:44:41.260

您可以使用 InputModeEditor：

```
InputModeEditor.SetInputMode(textBox1,InputMode.Numeric); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-14T09:22:38.643

只有一种方法可以做到这一点（编辑：这是指非智能手机 Windows Mobile 中的 SIP，所以我不确定它是否与您的问题相关），它确实涉及模拟鼠标点击 123 按钮。然而，这只是问题的一半，因为您还需要知道键盘是否已经处于数字模式。这样做的方法是窥视键盘左上角附近的一个像素 - 如果您查看 123 按钮的工作原理，您会看到它是 Windows 背景上的系统文本，然后在数字模式下反转（所以像素只有在数字模式下才会是系统文本颜色）。您还需要做一些奇怪的事情来保证它可以在所有设备上运行（您也必须在键盘上绘制一个像素）。

幸运的是，我有一个易于使用的代码示例来完成所有这些工作。不幸的是，它在 C# 中，但我认为它至少应该为您指明正确的方向。

# python - 将数据从 python 传输到 Windows 中的另一个应用程序的最佳方法是什么？

> ID：286614
> 
> 赞同：8
> 
> 时间：2008-11-13T09:25:21.030
> 
> 标签：python, winapi, com, data-transfer

我正在与 .Net (C++) 团队一起开发一个应用程序，并提供一个 COM 接口来与 python 和其他语言进行交互。

我们发现通过 COM 推送数据非常缓慢。

我考虑了几种选择：

*   将数据转储到文件并通过 com 发送文件路径
*   [通过mmap](http://docs.python.org/library/mmap.html?highlight=shared%20memory#module-mmap)共享内存？
*   直接通过套接字流数据？

根据您的经验，传递数据的最佳方式是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-13T10:20:33.353

停留在 Windows 进程间通信机制中，我们在使用*Windows 命名管道*时获得了积极的经验。使用 Windows 重叠 IO 和`win32pipe`来自[pywin32](http://pywin32.sourceforge.net/)的模块。

[你可以在Python Programming On Win32](http://oreilly.com/catalog/9781565926219/index.html)一书中了解很多关于 win32 和 python 的知识。

发送部分只是写入`r'\\.\pipe\mypipe'`.

listener( `ovpipe`) 对象持有一个事件句柄，等待带有可能其他事件的消息涉及调用`win32event.WaitForMultipleObjects`.

```
rc = win32event.WaitForMultipleObjects(
    eventlist,    # Objects to wait for.
    0,            # Wait for one object
    timeout)      # timeout in milli-seconds. 
```

这是python重叠侦听器类的一部分：

```
import win32event
import pywintypes
import win32file
import win32pipe

class ovpipe:
"Overlapped I/O named pipe class"
def __init__(self):
    self.over=pywintypes.OVERLAPPED()
    evt=win32event.CreateEvent(None,1,0,None)
    self.over.hEvent=evt
    self.pname='mypipe'
    self.hpipe = win32pipe.CreateNamedPipe(
        r'\\.\pipe\mypipe',             # pipe name 
        win32pipe.PIPE_ACCESS_DUPLEX|   # read/write access
        win32file.FILE_FLAG_OVERLAPPED,
        win32pipe.PIPE_TYPE_MESSAGE|    # message-type pipe 
        win32pipe.PIPE_WAIT,            # blocking mode 
        1,                              # number of instances 
        512,                            # output buffer size 
        512,                            # input buffer size 
        2000,                           # client time-out
        None)                           # no security attributes
    self.buffer = win32file.AllocateReadBuffer(512)
    self.state='noconnected'
    self.chstate()

def execmsg(self):
    "Translate the received message"
    pass

def chstate(self):
    "Change the state of the pipe depending on current state"
    if self.state=='noconnected':
        win32pipe.ConnectNamedPipe(self.hpipe,self.over)
        self.state='connectwait'
        return -6

    elif self.state=='connectwait':
        j,self.strbuf=win32file.ReadFile(self.hpipe,self.buffer,self.over)
        self.state='readwait'
        return -6

    elif self.state=='readwait':
        size=win32file.GetOverlappedResult(self.hpipe,self.over,1)
        self.msg=self.strbuf[:size]
        ret=self.execmsg()
        self.state = 'noconnected'
        win32pipe.DisconnectNamedPipe(self.hpipe)
        return ret 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T09:50:30.823

XML/JSON 和一个 Web 服务或直接通过套接字。它也是独立于语言和平台的，所以如果你决定要在 UNIX 上托管 python 部分，或者如果你想突然使用 Java 或 PHP 或几乎任何其他语言，你可以。

作为一般规则，像 COM 这样的专有协议/架构提供的限制多于它们带来的好处。这就是为什么首先出现开放规范的原因。

高温高压

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T18:18:12.853

+1 在命名管道上，但我还想从您的评论中补充一点，您的应用程序似乎很健谈。每次进行远程调用时，无论底层传输速度有多快，您都有固定的数据编组和连接成本。如果将 addpoint(lat, long) 方法更改为 addpoints(point_array) 方法，则可以节省大量开销。这个想法类似于为什么我们有数据库连接池和 http-keep-alive 连接。你打的电话越少越好。如果您可以限制对它进行的调用次数，您现有的 COM 解决方案甚至可能已经足够好了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T09:50:39.607

为每个备选方案设置测试并进行基准测试应该不会太复杂。注意比上下文敏感的经验数据... :)

哦，如果你这样做，我相信很多人会对结果感兴趣。

# c# - .Net HtmlTextWriter 的异常安全/处理？

> ID：286619
> 
> 赞同：0
> 
> 时间：2008-11-13T09:26:52.853
> 
> 标签：c#, .net, rollback, htmltextwriter, exception-safe

我正在使用 .Net`HtmlTextWriter`生成 HTML。

```
try
{
   htw.RenderBeginTag( HtmlTextWriterTag.Span );

   htw.Write(myObject.GenerateHtml());

   htw.RenderEndTag( );
}
catch (Exception e)
{
   GenerateHtmlErrorMessage(htw);
} 
```

在此示例中，如果在 期间触发了错误异常`myObject.GenerateHtml()`，我将生成一个不错的错误 html，但它前面会带有一个`span`从不关闭的开始标记。

我可以像这样重构它

```
try
{
   string myHtml = myObject.GenerateHtml();

   // now hope we don't get any more exceptions
   htw.RenderBeginTag( HtmlTextWriterTag.Span );
   htw.Write(myHtml)     
   htw.RenderEndTag( );
}
catch (Exception e)
{
   GenerateHtmlErrorMessage(htw);
} 
```

现在我的跨度没有打开，直到我完成了艰苦的工作，但这对我来说看起来很尴尬。有没有办法用 HtmlWriter 回滚？即使我不得不投入大量使用块。

我目前在 .Net 2.0 中工作，但可以讨论 3.5 中的解决方案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-15T08:06:04.867

如果您只关心 GenerateHtml() 调用期间发生的错误，并且不喜欢第二种方法（这对我来说似乎很好），为什么不将结束 span 标签移动到 finally 块中，并拉出 open 调用：

```
htw.RenderBeginTag( HtmlTextWriterTag.Span );
try
{
   htw.Write(myObject.GenerateHtml());
}
catch (Exception e)
{
   GenerateHtmlErrorMessage(htw);
}
finally
{
   htw.RenderEndTag( );
} 
```

这样，跨度始终打开并始终关闭。如果 GenerateHtml 引发异常，您将捕获它并在 span 内生成错误，然后再关闭它。

当然，如果在尝试编写标签时发生异常，那么无论如何你都不会写出错误消息，所以我假设它正在其他地方处理。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2008-11-13T09:41:52.480

您应该避免使用 try/catch，而是检查结果是否与您的预期不同。我在这里唯一能看到的是 myHTML 可以为空，因此请尝试以下操作：

字符串 myHtml = myObject.GenerateHtml();

```
if (myHTML != null)
{
   htw.RenderBeginTag( HtmlTextWriterTag.Span );
   htw.Write(myHtml)     
   htw.RenderEndTag( );
else
{
   GenerateHtmlErrorMessage(htw);
} 
```

# java - 最好的收藏？

> ID：286624
> 
> 赞同：3
> 
> 时间：2008-11-13T09:28:54.020
> 
> 标签：java, performance, collections, queue, buffer

我正在阅读日志文件，但并非所有行都希望立即处理。我正在使用队列/缓冲区来存储等待处理的行。

定期扫描此队列以查找特定行 - 当找到它们时，它们会从队列中删除（它们可以在队列中的任何位置）。当没有找到特定的行时，将一行一行地从队列的开头取出进行处理。

因此，队列需要以下内容：

*   能够调整大小（或给人以印象）
*   从任何地方删除元素
*   添加元素（将始终位于队列的末尾）
*   被快速扫描
*   根据性能，有一个指向上次扫描位置的指针。

我最初编写代码时对 Java 或 API 几乎没有经验，并且只是使用了 ArrayList，因为我知道它会起作用（不一定是因为它是最佳选择）。

随着越来越多的日志需要处理，它的性能现在变得很差——那么，在这种情况下，您建议使用什么集合？也总是有可能写我自己的。

谢谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-13T15:06:08.263

LinkedHashSet 可能很有趣。它实际上是一个 HashSet，但它还维护一个 LinkedList 以允许可预测的迭代顺序 - 因此也可以用作 FIFO 队列，它的好处是它不能包含重复的条目。

因为它也是一个 HashSet，所以搜索（而不是扫描）可以是 O(1)，如果它们可以匹配`equals()`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-13T09:41:55.570

LinkedList 可能是最合适的。它具有所有请求的属性，并允许在恒定时间内从中间删除链接，而不是 ArrayList 所需的线性时间。

如果您有一些特定的策略来查找下一个要删除的元素，那么 PriorityQueue 甚至排序集可能更合适。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T10:18:37.523

快速扫描通常意味着某种基于哈希的实现，ConcurrentSkipListMap 可能是一个很好的实现。在 containskey、remove 和 get 方法上记录（n），并对其进行排序，以便您可以拥有某种与之相关的优先级。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T13:12:55.340

我不想对正在读取的行进行排序（它们需要保持原始顺序）。但是，我可能会根据每个记录的行具有的会话 ID 阻止这些行（每个会话有几个记录的行）。

考虑一下，我可能有一个：

```
HashMap<String,LinkedList<String>> 
```

并提供会话 ID 作为键，并使用属于会话的行填充 LinkedList。

地图将提供一种快速搜索与会话 X 相关的行的方法，然后链表将提供添加/删除行的最佳性能（搜索性能是查找与会话 x 相关的行，因此实际行可以从头到尾读取和删除与会话 x 相关的内容 - 推送/弹出）。

有没有比链表更好的集合来调整大小，在末尾添加行并且总是从头开始？我相信 Queue 集合会扩展链表吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T10:22:42.723

因为您需要从集合中删除和添加元素，并搜索特定值，所以可能更好的结构可能是实现 SortedSet 的东西，例如 TreeSet。此类保证添加、删除和包含的 log(n) 性能。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-13T10:44:28.953

我猜有些线程将写入队列，而另一个线程将从中读取。

在这种情况下，您应该查看 java.lang.concurrent 包中的队列。

您可以使用 PriorityBlockingQueue 让它为您排序元素，或者如果您想迭代它并选择自己要删除的元素，则可以使用 LinkedBlockingQueue。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-13T15:10:57.240

我同意 AVI 和链表将是你最好的选择。您可以轻松调整大小，快速添加到列表末尾，从任何地方快速删除。搜索不会很快，但不会比任何其他未排序列表差。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-21T15:29:46.653

[番石榴](https://code.google.com/p/guava-libraries/)可能会有所帮助。

> Guava 项目包含我们在基于 Java 的项目中依赖的 Google 的几个核心库：集合、缓存、原语支持、并发库、通用注释、字符串处理、I/O 等等。

# database - 开源对象数据库？

> ID：286627
> 
> 赞同：5
> 
> 时间：2008-11-13T09:29:41.427
> 
> 标签：database, open-source, oop

有没有可用的开源对象数据库？我想看看源代码，看看东西是如何实现的。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-13T09:30:37.137

[http://www.zope.org/Wikis/ZODB](http://www.zope.org/Wikis/ZODB)是第一个想到的，但这里是商业和开源对象数据库的列表：

[http://www.odbms.org/vendors.html](http://www.odbms.org/vendors.html)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-13T09:52:18.230

db4o 是我的最爱。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T10:28:10.843

您可能想看看 Magma，这是一个受 Gemstone 启发的 Smalltalk OODB。

Magma 是一个 OODB，在 Squeak Smalltalk 中有完整的源代码。参见[http://wiki.squeak.org/squeak/2665](http://wiki.squeak.org/squeak/2665)。即使您想使用不同的实现语言，阅读代码也应该会有所帮助。有一个活跃的邮件列表，可以快速回答问题。

Gemstone 可能是最大的 OODB 公司，拥有最好的业绩记录。它曾经非常昂贵，但他们最近在他们的 GLASS（Gemstone、Linux、Apache 和 Seaside）产品中为小型（4GB）数据库引入了免费但非开源的版本。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T09:30:53.577

**Prevayler**就是其中之一。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-11-13T09:40:34.120

[CouchDB](http://incubator.apache.org/couchdb/)是一个文档数据库，与对象数据库非常相似。

# delphi - 在 Delphi 2009 中挂钩 Stacktrace

> ID：286628
> 
> 赞同：17
> 
> 时间：2008-11-13T09:30:13.283
> 
> 标签：delphi, exception, delphi-2009, stack-trace

Delphi 2009 中的异常类获得了许多新特性。其中一些与获取堆栈跟踪有关：

*   **属性**StackTrace：**字符串** **读取**GetStackTrace；
*   **属性**StackInfo：指针**读取**FStackInfo；
*   **类 var** GetExceptionStackInfoProc：**函数**（P：PExceptionRecord）：指针；
*   **类 var** GetStackInfoStringProc：**函数**（信息：指针）：**字符串**；
*   **类 var** CleanUpStackInfoProc：**过程**（信息：指针）；

有没有人使用这些来获取堆栈跟踪？是的，我知道还有其他方法可以获取堆栈跟踪，但是如果 Exception 类本身支持它，我宁愿利用它。

**更新：**有[一篇关于此的兴趣博客文章](http://eurekalog.blogspot.com/2010/05/new-exception-class-in-delphi-2009-and_05.html)。涵盖了很多深度。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-14T13:21:50.407

对我来说，这看起来像是一个框架，您可以在其中插入自己的堆栈跟踪。我想这可能会在带有 JCLDebug 的 IDE 内部使用。也许它旨在让用户能够提供 madExcept 或其他实现。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T10:27:12.950

不，我还没有使用它们（目前正在使用 madExcept，并且还使用 JclDebug 进行了一些实验）-但感谢您的提示！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-13T02:27:50.020

TOndrej 是正确的。添加到 Exception 类的新功能是供第三方将他们自己的堆栈跟踪代码挂钩到 RTL。Exception 类的默认实现不会产生它自己的堆栈跟踪。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-13T10:27:24.970

建议您查看 MadExcept。它不仅对任何未处理的异常（屏幕抓取、电子邮件等）提供了出色的处理，而且它具有一组很好的可调用例程，可以将堆栈跟踪返回给您，您几乎可以在任何地方使用它。布里

# concurrency - 什么是记忆栅栏？

> ID：286629
> 
> 赞同：139
> 
> 时间：2008-11-13T09:30:33.110
> 
> 标签：concurrency, memory-fences

使用显式内存栅栏是什么意思？

* * *

## 回答 #1

> 赞同：134
> 
> 时间：2008-11-13T10:02:41.783

为了提高性能，现代 CPU 通常会乱序执行指令，以最大限度地利用可用的芯片（包括内存读/写）。因为硬件强制执行指令完整性，所以您永远不会在单个执行线程中注意到这一点。但是，对于具有易失性内存（例如内存映射 I/O）的多线程或环境，这可能会导致不可预知的行为。

内存栅栏/屏障是一类指令，表示内存读/写按您期望的顺序发生。例如，“全围栏”意味着围栏之前的所有读/写都在围栏之后的那些之前提交。

注意内存栅栏是一个硬件概念。在高级语言中，我们习惯于处理互斥体和信号量——这些可以很好地在低级使用内存栅栏来实现，并且不需要显式使用内存屏障。使用内存屏障需要仔细研究硬件架构，并且在设备驱动程序中比在应用程序代码中更常见。

CPU 重新排序与编译器优化不同 - 尽管人工制品可能相似。如果这可能导致不良行为（例如在 C 中使用 volatile 关键字），您需要采取单独的措施来阻止编译器重新排序您的指令。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-11-13T10:41:13.047

复制[我](https://stackoverflow.com/questions/272246/what-are-some-tricks-that-a-processor-does-to-optimize-code#272291)对另一个问题的回答，[处理器优化代码有哪些技巧？](https://stackoverflow.com/questions/272246/what-are-some-tricks-that-a-processor-does-to-optimize-code)：

> 最重要的是内存访问重新排序。
> 
> 没有内存栅栏或序列化指令，处理器可以自由地重新排序内存访问。一些处理器架构对它们可以重新排序的数量有限制；Alpha 以最弱（即最能重新排序）而闻名。
> 
> 可以在 Linux 内核源文档的[Documentation/memory-barriers.txt](http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=blob;f=Documentation/memory-barriers.txt;hb=HEAD)中找到对该主题的非常好的处理。
> 
> 大多数时候，最好使用编译器或标准库中的锁定原语；这些都经过了很好的测试，应该有所有必要的内存屏障，并且可能已经非常优化（优化锁定原语很棘手；即使是专家有时也会弄错）。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-11-13T09:41:38.207

根据我的经验，它指的是[内存屏障](http://en.wikipedia.org/wiki/Memory_barrier)，它是一条指令（显式或隐式），用于在多个线程之间同步内存访问。

问题出现在现代激进编译器（它们具有重新排序指令的惊人自由，但通常对您的线程一无所知）和现代多核 CPU 的组合中。

对这个问题的一个很好的介绍是“ ['双重检查锁定被破坏'声明](http://www.cs.umd.edu/~pugh/java/memoryModel/DoubleCheckedLocking.html)”。对许多人来说，龙的存在敲响了警钟。

隐式全内存屏障通常包含在平台线程同步例程中，它涵盖了它的核心。但是，对于无锁编程和实现自定义的轻量级同步模式，您通常只需要屏障，甚至只需要一个单向屏障。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T10:04:59.470

[维基百科全都知道...](http://en.wikipedia.org/wiki/Memory_barrier)

> 内存屏障，也称为 membar 或内存栅栏，是一类指令，它使中央处理单元 (CPU) 对屏障指令之前和之后发出的内存操作强制执行排序约束。
> 
> CPU 采用可能导致乱序执行的性能优化，包括内存加载和存储操作。内存操作重新排序通常不会在单个执行线程中引起注意，但除非仔细控制，否则会导致并发程序和设备驱动程序出现不可预知的行为。排序约束的确切性质取决于硬件，并由架构的内存模型定义。一些架构提供了多个障碍来执行不同的排序约束。
> 
> 内存屏障通常在实现对多个设备共享的内存进行操作的低级机器代码时使用。此类代码包括多处理器系统上的同步原语和无锁数据结构，以及与计算机硬件通信的设备驱动程序。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-12-12T09:48:37.680

`memory fence`( `memory barrier`) 是一种同步**多线程**的无锁机制。在单线程环境中，重新排序是安全的。

问题在于**排序**、共享资源和缓存。处理器或编译器能够重新排序程序指令（程序员顺序）以进行优化。它在多线程环境中产生副作用。这就是为什么`memory barrier`引入以保证该程序将正常工作的原因。它速度较慢，但​​它解决了此类问题

[[Java 发生在之前]](https://stackoverflow.com/a/59491099/4770877)

[[iOS 内存屏障]](https://stackoverflow.com/a/65263893/4770877)

# c# - Visual Studio 8 中程序集引用的 Aliases 属性有什么用

> ID：286632
> 
> 赞同：73
> 
> 时间：2008-11-13T09:30:56.650
> 
> 标签：c#, visual-studio, reference, csproj

当我在 Visual Studio 8 中添加对项目的程序集引用时，该引用的 Aliases 属性设置为“全局”。这个属性有什么用，为什么设置为全局？

MSDN 告诉我这是程序集的别名列表，但不是我为什么要使用此属性或为什么大多数都被别名为“全局”的原因。

[MSDN 参考](http://msdn.microsoft.com/en-us/library/vslangproj80.reference3.aliases.aspx)

* * *

## 回答 #1

> 赞同：126
> 
> 时间：2008-11-13T09:37:25.577

这是针对“外部别名”的。假设您想使用两种不同的类型，它们都被调用`Foo.Bar`（即`Bar`在 的命名空间中`Foo`）。这两种类型将位于不同的程序集中（根据定义） - 您使用 VS 中的属性将别名与每个引用关联，然后您可以执行以下操作：

```
extern alias FirstAlias;
extern alias SecondAlias;

using FirstBar = FirstAlias::Foo.Bar;
using SecondBar = SecondAlias::Foo.Bar; 
```

然后在您的代码中使用`FirstBar`and 。`SecondBar`

所以基本上它是一个额外的命名级别——除非你真的、真的必须这样做，否则你不应该使用它。它会让很多人感到困惑。一开始就尽量避免陷入这种情况——但在你无法避免的时候要注意这个解决方案。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2008-11-13T09:37:12.957

搜索“[外部别名](https://docs.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/extern-alias)”；这是一个很少使用的功能，只需要在提供相同类型的两个 dll 之间消除歧义（例如，同一程序集的两个不同版本，或具有共享完全限定名称的类的两个程序集）。

“全局”是默认值。例如，如果您有一个名为 的类`Foo.System`，您可以通过 明确地引用主`System`命名空间`global::System`。

# c# - C#泛型方法中的转换问题

> ID：286638
> 
> 赞同：2
> 
> 时间：2008-11-13T09:33:31.793
> 
> 标签：c#, generics, collections, casting, methods

我正在编写的通用方法遇到了一些麻烦。它具有以下签名；

```
public static ThingCollection<T> GetThings<T>(...) where T : Thing 
```

有几个类；从 Thing 继承的 ThingA、ThingB 和 ThingC；我希望能够在方法中包含类似这样的代码。

```
var things = new ThingCollection<T>();

if (typeof(T) == typeof(Thing))
  foreach (var item in someCollection)
    things.Add((T)new Thing(...));
else if (typeof(T) == typeof(ThingA))
  foreach (var item in someCollection)
    things.Add((T)new ThingA(...));
else if (typeof(T) == typeof(ThingB))
  foreach (var item in someCollection)
    things.Add((T)new ThingB(...));
else if (typeof(T) == typeof(ThingC))
  foreach (var item in someCollection)
    things.Add((T)new ThingC(...));
else
  throw new Exception("Cannot return things of type " + typeof(T).ToString());

return things; 
```

问题是如果我不强制转换新对象，我会得到一个*最佳重载方法匹配无效参数错误。*为 new Thing() 添加如上所示的 T 转换很好，但报告*无法将类型 'ThingA' 转换为 'T'*以用于其他新调用。Intellisense 表明 T 是一个事物，但我不明白为什么我不能将其他对象转换为事物，因为它们继承自它。

也许这不是做我想做的事情的正确方法。我在正确的轨道上吗？也许错过了一些细微的差别，或者我应该完全做其他事情吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-13T09:59:52.413

我不明白你想用那个代码做什么。

如果你想创建一个可以添加从 Thing 派生的任何类型的类的 Collection of Things，ThingCollection 不应该有 Typename：它应该是具体类型的集合。

例如，以这种方式实现 A ThingCollection：

```
public class ThingCollection : List<Thing> {} 
```

现在你可以做

```
ThingCollection tc = new ThingCollection();
tc.Add(new ThingA());
tc.Add(new ThingB());
tc.Add(new ThingC()); 
```

当然假设 ThingA、ThingB 和 ThingC 继承自 Thing。

或者，也许您想使用 GetThings() 过滤派生类型的事物，即您希望对 GetThings() 的调用返回一个 ThingCollection。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-13T09:41:47.020

主要是我认为，这个代码片段的设计很糟糕。如果添加“ThingD”类，则需要更改另一部分代码，以获得清晰的行为。你应该使用类似的东西：

```
public static ThingCollection<T> GetThings<T>(...) where T : Thing, new()
...
...
T item = new T();
item.Something = Whatever(); 
```

或者您可以实现“ICloneable”接口 int Thing 类。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-13T09:44:37.793

该代码违反了 Liskov 替换原则，因为它在使用之前尝试测试 T 的类型。

为避免这种情况，您可以使用字典/策略组合或访问者模式。

如果 T 是 ThingB，则强制转换 (T)ThingA 无效，因此代码实际上是错误的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T09:38:28.213

如果他们使用通用接口（IThing），您应该能够转换为该接口。

# c# - 通过将属性传递给方法来获取属性的名称

> ID：286639
> 
> 赞同：4
> 
> 时间：2008-11-13T09:34:11.730
> 
> 标签：c#, .net, properties, expression-trees

StackOverflow 用户 jolson 有一段非常好的代码，它举例说明了如何在不使用字符串的情况下注册 menthods，但[这里](https://stackoverflow.com/questions/9033/hidden-features-of-c#52998)是表达式树。

是否可以为属性而不是方法提供类似的东西？传递一个属性（不是属性名）并在方法内部获取属性名？

像这样的东西：

```
 RegisterMethod(p => p.Name)

    void RegisterMethod(Expression??? propertyExpression) where T : Property ???
    {
        string propName = propertyExpression.Name;
    } 
```

谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-13T09:45:15.420

[我在这里](http://groups.google.com/group/microsoft.public.dotnet.languages.csharp/browse_thread/thread/f44dc57a9dc5168d/02c312dcf8a9a769#4805324df6b30218)发布了一个完整的示例（另请参阅`this`下面关于“”的帖子）

请注意它处理`LambdaExpression`等。作为发布的代码的更新，您可以添加更多内容以使其在某些情况下更易于使用：

```
static class MemberUtil<TType>
{
    public static string MemberName<TResult>(Expression<Func<TType, TResult>> member)
    {
        return MemberUtil.MemberName<TType, TResult>(member);
    }
} 
```

然后，您可以对返回值使用泛型类型推断：

```
string test1 = MemberUtil<Foo>.MemberName(x => x.Bar); 
string test2 = MemberUtil<Foo>.MemberName(x => x.Bloop()); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-13T09:39:32.000

你可以沿着这个写一些东西：

```
static void RegisterMethod<TSelf, TProp> (Expression<Func<TSelf, TProp>> expression)
{
    var member_expression = expression.Body as MemberExpression;
    if (member_expression == null)
        return;

    var member = member_expression.Member;
    if (member.MemberType != MemberTypes.Property)
        return;

    var property = member as PropertyInfo;
    var name = property.Name;

    // ...
} 
```

# perl - 如何在 Perl 中以随机顺序打印 STDIN 中的行？

> ID：286640
> 
> 赞同：3
> 
> 时间：2008-11-13T09:35:23.383
> 
> 标签：perl, unix, sorting, random

我想做[sort(1)的逆操作：在 Perl 中将](http://www.manpagez.com/man/1/sort/)**标准输入**的每一行随机化到**标准输出**。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-13T09:39:52.797

我敢打赌，真正的 Perl 黑客会撕毁它，但它仍然存在。

```
use strict;
use warnings;
use List::Util 'shuffle';

my @lines = ();
my $bufsize = 512;
while(<STDIN>) {
    push @lines, $_;
    if (@lines == $bufsize) {
        print shuffle(@lines);
        undef @lines;
    }
}
print shuffle(@lines); 
```

此解决方案与其他解决方案之间的区别：

*   不会消耗所有输入然后将其随机化（内存占用），但会随机化每个 $bufsize 行（与其他选项相比，不是真正随机且慢得像狗）。
*   使用一个返回新列表的模块，而不是就地编辑 Fisher - Yates 实现。它们是可互换的（除非您必须将打印与随机播放分开）。有关更多信息，请在您的 shell 上键入 perldoc -q rand。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-13T09:36:58.760

这个 perl 片段可以解决问题：

```
#! /usr/bin/perl
# randomize cat

# fisher_yates_shuffle code copied from Perl Cookbook 
# (By Tom Christiansen & Nathan Torkington; ISBN 1-56592-243-3)

use strict;

my @lines = <>;
fisher_yates_shuffle( \@lines );    # permutes @array in place
foreach my $line (@lines) {
    print $line;
}

# fisher_yates_shuffle( \@array ) : generate a random permutation
# of @array in place
sub fisher_yates_shuffle {
    my $array = shift;
    my $i;
    for ($i = @$array; --$i; ) {
        my $j = int rand ($i+1);
        next if $i == $j;
        @$array[$i,$j] = @$array[$j,$i];
    }
}

__END__ 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-13T18:17:11.590

```
use List::Util 'shuffle';
print shuffle <> 
```

或者如果你担心最后几行缺少\n，

```
chomp(my @lines = <>);
print "$_\n" for shuffle @lines; 
```

# java - 使用java进行服务器端图像重采样的库？

> ID：286641
> 
> 赞同：1
> 
> 时间：2008-11-13T09:35:27.203
> 
> 标签：java, image, jsp, resize

我想使用 jsp 创建一个重新采样（缩小）版本的图像。原始图像作为 blob 存储在数据库中。我想创建一个jsp，根据传递的图像宽度/高度（例如getimage.jsp?imageid=xxxx&maxside=200）提供质量不错（未像素化）的下采样图像。你能指出我可以从 jsp 页面调用的开源 api 或代码吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T10:06:51.650

Java 已经包含用于图像处理的库。调整图像大小并从 JSP 输出应该很容易。

[这个 servlet](http://greatwebguy.com/programming/java/java-image-resizer-servlet/)看起来与您希望 JSP 做的事情非常相似。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T10:15:42.363

内置的 Image.getScaledInstance(w, h, hints) 有什么问题吗？(*)

使用 hints=Image.SCALE_SMOOTH 获得不可怕的缩略图。然后使用 ImageIO 转换为输出所需的格式。

*：嗯，是的，它有问题，它有点慢，但真的有所有其他网络开销来担心这不太可能是一个大问题。在放大图像时，它也不是最好的质量，其中带有 BICUBIC 渲染提示的 drawImage 更合适。但是你现在只是在谈论缩小规模。

一定要检查传入的大小，这样你就不能通过传入巨大的大小来拒绝你的 servlet，从而导致创建一个占用大量内存的图像。

# java - 从另一个匿名类访问匿名类中的“无名”Jbutton？

> ID：286651
> 
> 赞同：1
> 
> 时间：2008-11-13T09:38:28.570
> 
> 标签：java, swing, actionlistener, keylistener

`JButton`我以匿名方式创建了 26个，`actionListener`标记为字母表中的每个字母。

```
for (int i = 65; i < 91; i++){
    final char c = (char)i;
    final JButton button = new JButton("" + c);
    alphabetPanel.add(button);
    button.addActionListener(
        new ActionListener () {
            public void actionPerformed(ActionEvent e) {
                letterGuessed( c );
                alphabetPanel.remove(button);
            }
        });
        // set the name of the button
        button.setName(c + "");
} 
```

现在我有一个匿名`keyListener`类，我想根据键盘上按下的字母来禁用按钮。因此，如果用户按下 A，则该`A`按钮被禁用。考虑到我目前的实施，这甚至可能吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-13T09:43:00.777

您不能简单地在类级别声明一个包含 26 个 JButton 对象的数组，以便两个侦听器都可以访问它们吗？我相信匿名内部类可以访问类变量以及最终变量。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T10:55:54.547

我不知道您是要禁用该按钮还是要删除它？在您的代码中，您正在调用删除，而在您的答案中，您正在谈论禁用。您可以通过将 KeyListener 添加到 alphabetPanel 来实现此目的。因此，您可以在开始 for 循环之前添加它：

```
InputMap iMap = alphabetPanel.getInputMap(JComponent.WHEN_IN_FOCUSED_WINDOW);
ActionMap aMap = alphabetPanel.getActionMap(); 
```

而不是你的 ActionListener 添加到 JButton 调用这个：

```
iMap.put(KeyStroke.getKeyStroke(c), "remove"+c);
aMap.put("remove"+c, new AbstractAction(){
    public void actionPerformed(ActionEvent e) {
        // if you want to remove the button use the following two lines
        alphabetPanel.remove(button);
        alphabetPanel.revalidate();
        // if you just want to disable the button use the following line
        button.setEnabled(false);
    }
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T13:14:20.033

您还可以遍历组件，将 getText() 与按下的键进行比较。

正如其他人提到的，匿名类也可以访问外部类的成员以及本地决赛

# .net - 下载 WCF 服务公开的所有 WSDL 文件的最佳方法是什么？

> ID：286657
> 
> 赞同：19
> 
> 时间：2008-11-13T09:41:37.177
> 
> 标签：.net, wcf, web-services, soap, wsdl

下载 WCF 服务公开的所有 WSDL 文件的最佳方法是什么？

例如，根 WSDL 文件引用以下其他 WSDL 文件：

```
<xsd:import schemaLocation="http://localhost:80/?xsd=xsd0" namespace="http://tempuri.com"/>
<xsd:import schemaLocation="http://localhost:80/?xsd=xsd1" namespace="http://tempuri.com"/> 
```

理想情况下，可以自动下载，以便每次 WSDL 更改时都可以轻松地将文件分发给客户或合并到文档/SDK 中。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-12-23T09:24:08.750

同时，disco.exe 被微软认为是过时的技术。

您可以使用 `svcutil.exe /t:metadata`在 WCF 时代实现相同的功能。额外的好处是支持额外的特性，例如 WS-Policy。

从 URL 保存架构：

`svcutil /t:metadata http://host/pathtomy.svc?wsdl`

从程序集中保存模式，例如在自动构建中：

`svcutil /t:metadata c:\wcfweb\pathToWcfServiceAssembly.dll`

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-11-13T12:47:12.863

如果您拥有该服务，您可以探索的另一个有趣的选项是使用 Christian Weyer 的[FlatWSDL 行为](http://blogs.thinktecture.com/cweyer/archive/2007/05/10/414840.aspx)，这将强制 WCF 在单个 WSDL 文档中生成所有内容，这将使您更容易分发它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-13T10:07:12.943

看起来微软为此提供了[Disco.exe 。](http://msdn.microsoft.com/en-us/library/cy2a3ybs.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-10-04T21:19:54.720

有一个简单的代码片段可以下载 WSDL 和所有所属的 XSD 文件以供离线使用（例如用于代码生成）。

**更新**

显示代码片段的博客不再可用。幸运的是，Pablo Diez 根据我的博文创建了一个小项目并将其上传到 github。它现在在这里可用：[https ://github.com/pablod/xsd-downloader](https://github.com/pablod/xsd-downloader)

# augmented-reality - 有人知道从头开始创建增强现实应用程序或使用开源框架的好教程吗？

> ID：286659
> 
> 赞同：4
> 
> 时间：2008-11-13T09:41:45.227
> 
> 标签：augmented-reality

我正在寻找能够完成创建 AR 应用程序每一步的优秀教程。如果它还涵盖光学等背后的一些理论，那将是有益的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-14T15:03:54.883

MXRToolkit 有很好的文档，适合初学者。还有一些其他的工具包。

[http://mxrtoolkit.sourceforge.net/](http://mxrtoolkit.sourceforge.net/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-02T03:13:15.313

一个好的设置是使用[ARToolKit](http://artoolkit.sourceforge.net/)和[osgART](http://www.osgart.org)。

ARToolKit 的教程也解释了计算机视觉的一些原理：

[http://www.hitl.washington.edu/artoolkit/documentation/](http://www.hitl.washington.edu/artoolkit/documentation/)

osgART 是[OpenSceneGraph](http://www.openscenegraph.org)的 ARToolKit，它抽象了在场景图应用程序中使用基于计算机视觉的跟踪的一些原则

这两个工具包都有一个庞大而充满活力的开发社区。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-14T15:17:58.440

不是一个简单的学习曲线，但[OpenScenegraph](http://www.openscenegraph.org)可能是飞行模拟器等大型应用程序的主要 FOSS 应用程序。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-03-23T23:31:44.297

我没有使用它，但它可能值得一看：http: [//developer.qualcomm.com/ar](http://developer.qualcomm.com/ar)

# visual-studio-2008 - 如何在 Visual Studio 中查找使用母版页的所有页面

> ID：286671
> 
> 赞同：2
> 
> 时间：2008-11-13T09:46:33.203
> 
> 标签：visual-studio-2008, keyboard-shortcuts, master-pages, resharper

有没有办法找到在 Visual Studio 中实现特定母版页的所有网页？

我正在寻找像 shift F12 这样的快捷方式，它可以找到母版页的所有用法。当我在母版页类名上执行此操作时，它只会将我带到设计视图，而不是显示所有使用它的页面。

如果那里有什么有用的东西，我确实有 Resharper。

我知道我可以使用“查找”对话框，但这不是很好。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T10:52:43.523

你提到 FindDialog 不是那么好......如果我只是使用 Find Next 对话框，我会同意。但是“查找全部”将显示所有页面的列表，然后您可以双击列表中的每个项目（因为它保持打开状态）。

`Control`+ `Shift`+ `F`（或用双筒望远镜按文件夹图标）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-01-19T14:32:45.990

您现在在 ReSharper 5.0 中拥有此功能。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-11-13T09:50:26.893

那将*很难*做到。您可以在 aspx 文件、web.config 或 Page_PreInit 事件中设置母版页，这样就无法确切知道要使用哪个母版页。

您认为这里使用的是什么 MasterPage？

```
protected void Page_PreInit(object o)
{
  this.Master = GetMasterFromDataBase(HttpContext.Current.User.Username);
} 
```

如您所见，无法确定真正使用了哪个母版页。

# java - 从 Swing 应用程序远程处理到 GWT 服务器

> ID：286674
> 
> 赞同：6
> 
> 时间：2008-11-13T09:47:49.143
> 
> 标签：java, swing, gwt, remoting, restlet

简单地说，我编写了一个 JSE Swing 应用程序，它需要与我之前编写的 GWT 服务器通信。我非常喜欢 GWT 在它的 javascript 和服务器端之间进行远程处理的方式，并希望我可以利用这种机制。有没有人设法以这种方式使用 GWT-RPC？我应该改用 Restlet 吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T14:21:12.253

如果您正在进行 Java 到 Java 的通信，RMI 会更简单、更方便。将数据序列化到/从某些 XML 或基于 URL 的格式不会增加很多价值。

使用 EJB3，部署远程对象并调用它们非常简单。如果以后需要，您可以将这些 EJB 转换为 Web 服务，但是对于 Java 到 Java，我想不出一个*不*使用某种基于 RMI 的通信的充分理由。

# c++ - 将 C++ 从 VS2003 迁移到 VS2005 需要哪些代码更改？

> ID：286677
> 
> 赞同：2
> 
> 时间：2008-11-13T09:48:37.973
> 
> 标签：c++, visual-studio-2005, migration, visual-studio-2003

我们正在考虑将我们的跨平台 C++ 应用程序的 win32 版本从 MS Visual Studio 2003 迁移到 MS Visual Studio 2005。（是的，我们非常具有前瞻性；）

我们是否应该期望进行许多代码更改才能使其编译和工作？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-13T13:25:48.247

我刚刚通过 VS2005 将一个相对较大的代码库从 VS2003 迁移到 VS2008，我发现的大多数问题都是 const/non-const 问题，例如将返回 const char * 的函数的返回值分配给 char *。VS2005 和 VS2008 在 const 正确性方面都更加挑剔，如果您现有的代码库在 const 正确性方面有点草率，抱歉，老派，您会看到很多这样的。

一个非常受欢迎的变化是 VS2005 中的模板支持明显比 VS2003 中的更好（这本身就是对早期版本的重大改进），这使我能够为团队自VC++ 4.x 令人兴奋的日子。

您可能会遇到的一个问题是大量关于“已弃用”或“不安全”函数的警告，尤其是在您使用 C 字符串函数时。其中许多“已被 Microsoft 弃用”（只是它们省略了“由 Microsoft”部分）并且仍然完全可用，但它们是已知的缓冲区溢出的潜在来源。在我转换的项目中，我设置了预处理器定义 _CRT_SECURE_NO_WARNINGS 并禁用了警告 C4996 以关闭这些有些烦人的消息。

我们遇到的另一个问题是 MS 在 VS2005 或 VS2008 中更改了 time_t 的默认大小（我很抱歉，但我不记得了 - 它肯定在 VS2008 但它可能已经在 VS2005 中）所以如果你必须链接对于在界面中使用 time_t 的旧库，您必须使用 _USE_32BIT_TIME_T 才能恢复到旧编译器的行为。

如果您的解决方案包含多个项目，您可能会发现并行构建功能（默认打开）会突出显示缺少的构建依赖项。所以项目突然以错误的顺序构建，但如果您从并行构建恢复到线性构建，则会神奇地正确构建。

总的来说，我确实更喜欢 VS2005/8 到 VS2003，如果可以的话，我建议升级到 VS2008，因为编译器比 VS2005“更好”——MS 似乎在改进原生 C++ 编译器方面付出了巨大的努力。其中一部分在 2005 年就已经很明显了，因此即使您坚持 2005 年，您也至少会获得一些好处。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-13T10:20:21.747

如果您的代码已经很干净并且可以在没有警告的情况下进行编译，那么这不是一个很大的步骤。

查看[这篇文章](http://www.devx.com/cplus/10MinuteSolution/28908/1954)并考虑这些更改对您现有代码的影响有多大。清理 for 循环一致性可能需要一些工作。

[您可以在此处](http://www.microsoft.com/express/2005/)获得免费的 Visual Studio 2005 Express 版本。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-13T15:46:07.467

在决定是否以及如何进行此项目时，您应该查看 MS 的重大更改列表。

[VC 2005 - 2008 的重大变革](http://msdn.microsoft.com/en-us/library/bb531344.aspx)

[Visual C++ 2005 编译器中的重大更改](http://msdn.microsoft.com/en-us/library/ms177253.aspx)

[Visual C++ .NET 2003 中的重大变化](http://msdn.microsoft.com/en-us/library/ms177251(vs.80).aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T10:19:37.973

你会发现很多字符串命令会给你警告，因为在 vis 2005 中他们加强了安全性以尝试停止缓冲区运行。

您的 2003 代码仍然可以编译。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-13T13:07:03.370

我最近将一个使用了 10 年的 VC6 程序转换为 VS2008。它不需要更改源代码，并且项目文件所需的唯一更改由升级向导处理。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-13T09:51:10.947

不，我不会期望超过几个。

编辑：您应该/可以先尝试使用 vs2005 演示版的代码。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-25T03:17:46.627

此外，考虑禁用[检查迭代器](http://www.codeproject.com/KB/stl/checkediterators.aspx)或移植到新版本后性能可能会受到影响。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-25T03:31:19.237

如果您的源代码符合 C++ 标准，则无需更改任何内容即可移至 2005。您可能会收到一些贬值的警告，但不会出现编译错误。

人们从旧版本的 VS 升级到新版本的主要问题是新版本更符合标准。

像：

```
for(i = 0; i < length; ++i)
{
} 
```

在`i`此之前未定义的时间在以前版本的 VS 中工作正常，但在 2005 年它正确地将 i 标记为未定义变量。

# java - 如何使用 JSF/MyFaces 根据用户角色创建条件？

> ID：286686
> 
> 赞同：3
> 
> 时间：2008-11-13T09:51:58.560
> 
> 标签：java, jsp, jsf, myfaces, tomahawk

从我的 JSP 页面中读取当前用户的角色需要哪些选项？我知道`visibleOnUserRole="myRole"`Tomahawk 组件的属性，但我需要角色来处理比简单可见性更复杂的事情。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-13T13:06:19.847

[ExternalContext](http://docs.oracle.com/javaee/6/api/javax/faces/context/ExternalContext.html)公开用户和角色信息。

```
public class RolesAccess implements Serializable {

    public String getUserPrincipalName() {
        FacesContext context = FacesContext.getCurrentInstance();
        Principal principal = context.getExternalContext().getUserPrincipal();
        if(principal == null) {
            return null;
        }
        return principal.getName();
    }

    public String getUser() {
        FacesContext context = FacesContext.getCurrentInstance();
        return context.getExternalContext().getRemoteUser();
    }

    public boolean isManager() {
        FacesContext context = FacesContext.getCurrentInstance();
        return context.getExternalContext().isUserInRole("manager");
    }

} 
```

如果您在 servlet 中使用 JSF，则此信息映射到[HttpServletRequest](http://docs.oracle.com/javaee/6/api/javax/servlet/http/HttpServletRequest.html)公开的值。

[您可以使用托管 bean 通过Expression Language](http://docs.oracle.com/javaee/6/tutorial/doc/bnahq.html)向视图公开值。

```
<f:view>
    <h:outputLabel value="#{rolesBean.userPrincipalName}" />
    <h:outputLabel value="#{rolesBean.user}" />
    <h:outputLabel value="#{rolesBean.manager}" />
</f:view> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-12-05T22:37:06.200

在 Java EE 6（在询问/回答此问题时不可用）中，您可以直接从`request`Facelets 代码中的变量测试角色。这超级方便。

例如

```
<h:outputText value="hi, admin!" rendered="#{request.isUserInRole('Admin')}" /> 
```

# c# - 将焦点设置到文本框中的按钮？

> ID：286690
> 
> 赞同：1
> 
> 时间：2008-11-13T09:52:42.740
> 
> 标签：c#, asp.net, vb.net

我的表单上有一些文本框和按钮。

假设 txtBox1 在 btnSubmit1 旁边，txtBox2 在 btnSubmit2 旁边，txtBox3 在 btnSubmit3 旁边。

当用户开始在 txtBox3 中键入内容时，如何将焦点设置在 btnSubmit3 上。含义.....如果用户在文本框中键入，程序将知道当用户按下回车键时要触发哪个按钮。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-13T09:56:06.070

如果您使用面板，您应该能够设置默认按钮。我不确定它是 win 表单应用程序还是 web 表单应用程序，但这是你应该如何使用 web 表单：

```
<asp:Panel id="panel1" runat="server" DefaultButton="Button1">
   <asp:TextBox id="textbox1" runat="server" />
   <asp:Button id="Button1" runat="server" Text="Button 1" />
</asp:Panel>

<asp:Panel id="panel2" runat="server" DefaultButton="Button2">
   <asp:TextBox id="textbox2" runat="server" />
   <asp:Button id="Button2" runat="server" Text="Button 2" />
</asp:Panel>

<asp:Panel id="panel3" runat="server" DefaultButton="Button3">
   <asp:TextBox id="textbox3" runat="server" />
   <asp:Button id="Button3" runat="server" Text="Button 3" />
</asp:Panel> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T10:55:53.657

使用 JavaScript 并为这些文本框添加“onblur”...

例子：

```
<asp:TextBox ID="t1" runat="server" onblur="CheckIfTextBox1ShouldFocusOnButton1();" /> 
```

:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T10:59:33.493

我已经看到它这样做了，但不要让我解释它或说出任何其他方法的优点和缺点。只是想我会发布它以防它对你有用。

```
// Fires a particular event when enter is pressed within a textbox.
function FireButtonOnEnter(controlID)
{
    if((event.which ? event.which : event.keyCode) == 13)
    {
        window.event.returnValue = false;
        window.event.cancelBubble = true;
        document.getElementById(controlID).click();
    }
} 
```

通过为文本框添加以下内容来调用它...

```
txtOrgName.Attributes.Add("OnKeyDown", String.Format("return FireButtonOnEnter('{0}');", btnOrgNameGo.ID)); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-14T01:01:02.947

如果您知道唯一使用的浏览器是 IE，那么这是一个简单的解决方案。

您只需添加到页面加载

```
txtBox1.Attributes.Add("onKeyPress", "javascript:if (event.keyCode == 13)
__doPostBack('" + btnSubmit1.UniqueID + "','')");

txtBox2.Attributes.Add("onKeyPress", "javascript:if (event.keyCode == 13)
__doPostBack('" + btnSubmit2.UniqueID + "','')");

txtBox3.Attributes.Add("onKeyPress", "javascript:if (event.keyCode == 13) 
__doPostBack('" + btnSubmit3.UniqueID + "','')"); 
```

这只适用于 IE 的原因是它使用了在 Firefox 中不起作用的 Javascript“事件”关键字。

# nhibernate - NHibernate 性能插入

> ID：286697
> 
> 赞同：7
> 
> 时间：2008-11-13T09:56:31.500
> 
> 标签：nhibernate

我正在使用 nhibernate 进行一些测试，并且正在修改 batch_size 以获取批量插入。

我正在使用 mssql2005 并使用北风数据库。我创建了 1000 个对象并将它们插入数据库。我已将 batch_size 的值从 5 更改为 100，但发现性能没有变化。我得到大约 300 毫秒的值。使用 sql profiler，我在服务器端看到了 1000 个 sql insert 语句。请帮忙。

## 应用程序配置

```
 <property name="adonet.batch_size">10</property> 
```

## 代码

```
 public bool MyTestAddition(IList<Supplier> SupplierList)
    {
        var SupplierList_ = SupplierList;
        var stopwatch = new Stopwatch();
        stopwatch.Start();
        using (ISession session = dataManager.OpenSession())
        {  
            int counter = 0;
            using (ITransaction transaction = session.BeginTransaction())
            {

                foreach (var supplier in SupplierList_)
                {
                    session.Save(supplier);                       
                }
               transaction.Commit(); 
            }

        }
        stopwatch.Stop();
        Console.WriteLine(string.Format("{0} milliseconds. {1} items added",
                            stopwatch.ElapsedMilliseconds,
                            SupplierList_.Count));
        return true;
    } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-26T14:08:38.187

以下是一篇关于 Hibernate 批处理的精彩文章，它是 NHibernate 的基础并紧随其后：

[http://relation.to/Bloggers/BatchProcessingInHibernate](http://relation.to/Bloggers/BatchProcessingInHibernate)

如您所见，建议的操作是在配置中设置合理的批量大小，您已经完成了，但也每隔 20 条左右的记录调用`session.flush()`一次`session.clear()`。

我们自己采用了这种方法，现在可以在几秒钟内创建和保存 1000 多个对象。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-20T15:27:28.327

您可以将目标类型加载到 List 中，然后调用 System.Data.SqlClient.BulkCopy 将数据 bcp 到目标表中。

这将允许处理更大的卷。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-22T23:44:20.867

根据[这个 nhusers 帖子](http://groups.google.com/group/nhusers/browse_thread/thread/d4c8fd9625ef5f32/55c7a8db66f62a39 "nhusers：批处理更新/删除语句")，您在 SQL Server 中看到 1000 次插入并不重要，因为优化是在不同的级别上完成的。如果您在性能方面确实没有任何提升，尝试最新版本的 NHibernate 可能有助于解决问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-26T10:02:48.353

我用 nh 尝试过类似的东西，从来没有真正得到过很好的表现。我记得每 10 个条目刷新一次，每 50 个条目提交一次，以提高性能，因为每次插入过程都会逐渐变慢。这实际上取决于对象的大小，因此您可以使用这些数字来玩弄，也许您可​​以从中挤出一些性能。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-11-17T10:16:11.810

调用 ITransaction.Commit 将刷新您的会话，有效地将您的更改写入数据库。您在每次保存后调用 Commit，因此每个供应商都会有一个 INSERT。

我会尝试在每 10 个左右供应商之后调用 Commit，或者甚至在你的 1000 个供应商结束时调用 Commit！

# c# - 如何以编程方式从 sourcesafe 获取文件？

> ID：286713
> 
> 赞同：3
> 
> 时间：2008-11-13T10:07:48.417
> 
> 标签：c#, visual-sourcesafe

我需要以编程方式从 sourcesafe 数据库中获取文件。知道怎么做吗？

ps：我会用C#来做。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-11-13T10:21:11.947

```
using System;
using System.Collections.Generic;
using SourceSafeTypeLib;

namespace YourNamespace
{

public class SourceSafeDatabase 
{
    private readonly string dbPath;
    private readonly string password;
    private readonly string rootProject;
    private readonly string username;
    private readonly VSSDatabaseClass vssDatabase;

    public SourceSafeDatabase(string dbPath, string username, string password, string rootProject)
    {
        this.dbPath = dbPath;
        this.username = username;
        this.password = password;
        this.rootProject = rootProject;

        vssDatabase = new VSSDatabaseClass();
    }  

    public List<string> GetAllLabels()
    {
        List<string> allLabels = new List<string>();

        VSSItem item = vssDatabase.get_VSSItem(rootProject, false);
        IVSSVersions versions = item.get_Versions(0);

        foreach (IVSSVersion version in versions)
        {
            if (version.Label.Length > 0)
            {
                allLabels.Add(version.Label);
            }
        }

        return allLabels;
    }

    public void GetLabelledVersion(string label, string project, string directory)
    {
        string outDir = directory;
        vssDatabase.get_VSSItem(rootProject, false).get_Version(label).Get(ref outDir, (int)VSSFlags.VSSFLAG_RECURSYES + (int)VSSFlags.VSSFLAG_USERRONO);
    }

    public void Open()
    {
        vssDatabase.Open(dbPath, username, password);
    }

    public void Close()
    {
        vssDatabase.Close();
    }

}

// some other code that uses it

SourceSafeDatabase sourceControlDatabase = new sourceControlDatabase(...);
sourceControlDatabase.Open();
sourceControlDatabase.GetLabelledVersion(label, rootProject, projectDirectory);
sourceControlDatabase.Close(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T10:11:32.887

有一个命令行 SS.EXE 程序，您可以调用它来执行源代码控制操作。但是，它依赖于全局 SourceSafe 配置，因此有时很难让它做你想做的事。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T10:14:56.470

VSS有一个[OLE 库](http://msdn.microsoft.com/en-us/library/bb509339.aspx)

你可能想看看[这个讨论。](http://bytes.com/forum/thread229399.html)

# c++ - VS2008 相比 VS2005 在 C++ 开发方面有哪些优势？

> ID：286714
> 
> 赞同：11
> 
> 时间：2008-11-13T10:08:05.470
> 
> 标签：c++, visual-studio-2008, visual-studio-2005

我们正在考虑从 MS Visual Studio 2003 切换到 MS Visual Studio 2005 以进行 C++ 开发。我认为跳到 2008 年可能会更好。

在 C++ 开发方面，VS2008 在哪些方面优于 VS2005？

VS2008 比 VS2005 有什么缺点吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-13T10:28:29.687

从原生 C++ 开发人员的角度来看，2005 年和 2008 年之间几乎没有区别。但是，如果来自 2003，直接升级到 2008 是有意义的 - 转换过程应该几乎相同，您最终会得到一个稍微好一点的平台。一些仅适用于 2008 的新功能：

*   多核编译的 /MP 选项（如果您有一台多核计算机，可以节省大量时间）
*   多线程应用程序的一些改进的调试选项

还有一些仅适用于 2008 的其他可下载功能包：

*   TR1 库
*   新的 MFC

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-13T10:18:14.153

老实说，就纯 C++ 开发而言，我认为两者之间没有太多区别，除了 VS2008 是“最新”版本。我没有注意到任何重大变化。

但是，最新版本的 MFC 通过添加功能包（为您提供 MSOffice 2007 外观和感觉）赋予了新的生命，这可能值得了解。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-11-13T15:21:30.447

2008 年对我们来说最大的改进是 Intellisense 在大型解决方案上的可靠性。我们的项目有几百万行代码，而 Intellisense 在 2003 年无法使用。在 2008 年，它得到了改进，并且经常工作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T16:07:53.413

对我来说，最大的改进就是 VS2008 明显更敏捷。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-13T10:21:49.607

VS2008 包含大量错误修正，绝对值得升级 IMO。除了 UI 和相关工具的改进之外，它在处理模板类方面要好得多，除非您使用最基本的语法，否则 VS2005 编译器并不总是能很好地工作。还有许多其他方面也得到了改进，但我现在懒得找一份 MS 文档来详细说明这些变化。所以当我说有很多的时候相信我。:)

我会说，除非你有一些令人信服的理由坚持使用 2005（即，你的代码的向后兼容性不能与 VS2008 正确构建），否则你绝对应该推动升级。幸运的是，您可以在单个工作站上使用多个版本的 VS。您只需要按顺序安装它们；即首先是VS2005，然后是VS2008。

然后你可以在 VS2008 下测试你的代码库，看看迁移到 VS2008 会有多痛苦（如果有的话）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-13T15:09:47.133

Visual Studio 2008 是一个集成环境，允许您为 Windows CE 和 Windows 进行开发。（以前我们必须在 eVC++ 4.0 上工作，这不是那么好......）

我遇到的一个缺点是 Dinkum STL 容器的最新版本假设使用了指针，而不是使用分配器::指针策略。这对我们来说是个问题，因为我们为共享内存使用编写了自己的“指针”类（存储内存偏移而不是绝对地址）。因此，我们不得不使用较旧的 STL 库。从好的方面来说，调试器能够更丰富地显示 STL 容器的内容。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-14T02:13:53.050

我目前使用 VS 2005。我尝试了 VS 2008 的最后一个测试版，编译器一直在我的项目上崩溃，所以我坚持使用 VS 2005。我没有查看发布版本。

选择 VS 2008 而不是 VS 2005 的一个重要原因是 VS 2005 有一个智能感知错误，导致它使用太多内存。这通常不是问题，但是当我尝试同时使用 Visual Assist 和 Refactor 时！VS 2005 中的 C++，智能感知搅动使我的系统崩溃。据说这在 VS 2008 中已修复。（我有 VS 2008 的许可证，一旦我的下一个产品发布，我将尝试迁移，主要是因为这个原因。）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-11-13T15:24:54.357

Visual C++ 2008 已放弃对单线程运行时库的支持。我不认为这真的很重要。

# windows-installer - 用于了解 Windows Installer 的推荐资源

> ID：286715
> 
> 赞同：4
> 
> 时间：2008-11-13T10:08:08.323
> 
> 标签：windows-installer

您能推荐任何学习 Windows Installer 的资源吗？

我找到的最好的书是 Phil Wilson 的“Windows Installer 权威指南”，但它对初学者不太友好。

我被要求为那些希望快速“跟上进度”并且不知道除了那本书和一些微软网站推荐什么的人提出建议：

[http://msdn.microsoft.com/en-us/library/aa367449.aspx](http://msdn.microsoft.com/en-us/library/aa367449.aspx)

[http://blogs.msdn.com/Windows_Installer_Team/](http://blogs.msdn.com/Windows_Installer_Team/)

您发现还有什么对学习 Windows Installer 有用的东西吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T10:14:37.547

查看[http://wix.sourceforge.net/](http://wix.sourceforge.net/)。在创建 Windows 安装程序时，WIX 是一个很棒的工具。该站点包含一些有用的链接（例如[http://www.tramontana.co.hu/wix/](http://www.tramontana.co.hu/wix/)）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-14T01:40:33.553

我还推荐“Windows Installer 权威指南”，我认为它对初学者非常友好，因为它让您深入了解 Windows Installer 如何在 300 页内工作。我宁愿写一本直截了当的漂亮短书，而不是一本 600 页的怪物，里面有很多我永远不会再参考的绒毛、例子和信息。对我来说，它帮助我理解了 InstallShield 项目中的一些“魔力”，如果我们将来决定迁移到 WiX，我会将它作为参考（计划中，只需要找到发布之间的时间来做到这一点！）

我还推荐 Rob Mensching 在[http://www.robmensching.com/](http://www.robmensching.com/)上的博客。阅读他的旧博客“When setup is not just xcopy”是掌握 Windows Installer 中一些更高级功能的一种非常好（且有趣）的方法。（奇怪的是，我相信我上周在这里看到了 Rob 关于 WiX 问题的几个答案。）

# nhibernate - JSON.NET 和 nHibernate 延迟加载集合

> ID：286721
> 
> 赞同：32
> 
> 时间：2008-11-13T10:13:05.647
> 
> 标签：nhibernate, json.net

有人将 JSON.NET 与 nHibernate 一起使用吗？我注意到当我尝试加载带有子集合的类时出现错误。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2011-05-08T09:50:10.410

我遇到了同样的问题，所以我尝试使用@Liedman 的代码，但`GetSerializableMembers()`从未调用过代理参考。我找到了另一种覆盖的方法：

```
 public class NHibernateContractResolver : DefaultContractResolver
  {
      protected override JsonContract CreateContract(Type objectType)
      {
          if (typeof(NHibernate.Proxy.INHibernateProxy).IsAssignableFrom(objectType))
              return base.CreateContract(objectType.BaseType);
          else
              return base.CreateContract(objectType);
      }
  } 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2010-03-17T10:19:08.267

我们遇到了这个确切的问题，这是在 Handcraftsman 的回复中得到解决的。

问题源于 JSON.NET 对如何序列化 NHibernate 的代理类感到困惑。解决方案：像它们的基类一样序列化代理实例。

Handcraftsman 代码的简化版本如下所示：

```
public class NHibernateContractResolver : DefaultContractResolver {
    protected override List<MemberInfo> GetSerializableMembers(Type objectType) {
        if (typeof(INHibernateProxy).IsAssignableFrom(objectType)) {
            return base.GetSerializableMembers(objectType.BaseType);
        } else {
            return base.GetSerializableMembers(objectType);
        }
    }
} 
```

恕我直言，这段代码的优势在于仍然依赖 JSON.NET 关于自定义属性等的默认行为（而且代码要短得多！）。

它是这样使用的

```
 var serializer = new JsonSerializer{
            ReferenceLoopHandling = ReferenceLoopHandling.Ignore,
            ContractResolver = new NHibernateContractResolver()
        };
        StringWriter stringWriter = new StringWriter();
        JsonWriter jsonWriter = new Newtonsoft.Json.JsonTextWriter(stringWriter);                
        serializer.Serialize(jsonWriter, objectToSerialize);
        string serializedObject = stringWriter.ToString(); 
```

*注意：*此代码是为 NHibernate 2.1 编写和使用的。正如一些评论者所指出的，它不适用于更高版本的 NHibernate，您必须进行一些调整。如果我必须使用更高版本的 NHibernate 来更新代码，我会尝试更新。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-10-30T20:57:43.363

我将 NHibernate 与 Json.NET 一起使用，并注意到我在序列化对象中得到了莫名其妙的“__interceptors”属性。谷歌搜索发现了Lee Henson 提出的[这个出色的解决方案](http://markmail.org/message/x5a2k7j7qtjmj73g)，我将其改编为与 Json.NET 3.5 Release 5 一起使用，如下所示。

```
public class NHibernateContractResolver : DefaultContractResolver
{
  private static readonly MemberInfo[] NHibernateProxyInterfaceMembers = typeof(INHibernateProxy).GetMembers();

  protected override List<MemberInfo> GetSerializableMembers(Type objectType)
  {
    var members = base.GetSerializableMembers(objectType);

    members.RemoveAll(memberInfo =>
                      (IsMemberPartOfNHibernateProxyInterface(memberInfo)) ||
                      (IsMemberDynamicProxyMixin(memberInfo)) ||
                      (IsMemberMarkedWithIgnoreAttribute(memberInfo, objectType)) ||
                      (IsMemberInheritedFromProxySuperclass(memberInfo, objectType)));

    var actualMemberInfos = new List<MemberInfo>();

    foreach (var memberInfo in members)
    {
      var infos = memberInfo.DeclaringType.BaseType.GetMember(memberInfo.Name);
      actualMemberInfos.Add(infos.Length == 0 ? memberInfo : infos[0]);
    }

    return actualMemberInfos;
  }

  private static bool IsMemberDynamicProxyMixin(MemberInfo memberInfo)
  {
    return memberInfo.Name == "__interceptors";
  }

  private static bool IsMemberInheritedFromProxySuperclass(MemberInfo memberInfo, Type objectType)
  {
    return memberInfo.DeclaringType.Assembly == typeof(INHibernateProxy).Assembly;
  }

  private static bool IsMemberMarkedWithIgnoreAttribute(MemberInfo memberInfo, Type objectType)
  {
    var infos = typeof(INHibernateProxy).IsAssignableFrom(objectType)
                  ? objectType.BaseType.GetMember(memberInfo.Name)
                  : objectType.GetMember(memberInfo.Name);

    return infos[0].GetCustomAttributes(typeof(JsonIgnoreAttribute), true).Length > 0;
  }

  private static bool IsMemberPartOfNHibernateProxyInterface(MemberInfo memberInfo)
  {
    return Array.Exists(NHibernateProxyInterfaceMembers, mi => memberInfo.Name == mi.Name);
  }
} 
```

要使用它，只需在 JsonSerializer 的 ContractResolver 属性中放置一个实例。jishi 提到的循环依赖问题可以通过将 ReferenceLoopHandling 属性设置为 ReferenceLoopHandling.Ignore 来解决。这是一个扩展方法，可用于使用 Json.Net 序列化对象

```
 public static void SerializeToJsonFile<T>(this T itemToSerialize, string filePath)
  {
    using (StreamWriter streamWriter = new StreamWriter(filePath))
    {
      using (JsonWriter jsonWriter = new JsonTextWriter(streamWriter))
      {
        jsonWriter.Formatting = Formatting.Indented;
        JsonSerializer serializer = new JsonSerializer
          {
            NullValueHandling = NullValueHandling.Ignore,
            ReferenceLoopHandling = ReferenceLoopHandling.Ignore,
            ContractResolver = new NHibernateContractResolver(),
          };
        serializer.Serialize(jsonWriter, itemToSerialize);
      }
    }
  } 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-17T00:45:03.943

You will probably want to eager load most of the object so that it can be serialized:

```
 ICriteria ic = _session.CreateCriteria(typeof(Person));

        ic.Add(Restrictions.Eq("Id", id));

        if (fetchEager)
        {
            ic.SetFetchMode("Person", FetchMode.Eager);
        } 
```

A nice way to do this is to add a bool to the constructor (bool isFetchEager) of your data provider method.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-11-13T13:45:55.243

您是否收到循环依赖错误？你如何从序列化中忽略对象？

由于延迟加载会生成代理对象，因此您的类成员所拥有的任何属性都将丢失。我在使用 Newtonsoft JSON-serializer 时遇到了同样的问题，因为代理对象不再具有 [JsonIgnore] 属性。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-04-06T22:29:51.740

我会说这是我认为的设计问题。因为 NH 在所有底层都与数据库建立连接，并且在中间有代理，所以直接序列化它们不利于应用程序的透明性（正如你所见，Json.NET 根本不喜欢它们）。

您不应该序列化实体本身，而是应该将它们转换为“视图”对象或 POCO 或 DTO 对象（无论您想如何称呼它们），然后对它们进行序列化。

不同之处在于，虽然 NH 实体可能有代理、惰性属性等。视图对象是简单的对象，只有默认情况下可序列化的原语。

如何管理 FK？我个人的规则是：

实体级别：Person 类并与 Gender 类相关联

视图级别：具有 GenderId 和 GenderName 属性的人员视图。

这意味着在转换为视图对象时，您需要将属性扩展为基元。这样你的 json 对象也更简单，更容易处理。

当您需要将更改推送到数据库时，在我的情况下，我使用 AutoMapper 并执行一个 ValueResolver 类，该类可以将您的新 Guid 转换为 Gender 对象。

更新：查看[http://blog.andrewawhitaker.com/blog/2014/06/19/queryover-series-part-4-transforming/](http://blog.andrewawhitaker.com/blog/2014/06/19/queryover-series-part-4-transforming/)以获取直接从 NH 获取视图 (AliasToBean) 的方法。这将是数据库方面的一个推动力。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-12-18T16:33:48.123

当 NHibernate 将嵌套的集合属性包装在 PersistentGenericBag<> 类型中时，可能会发生此问题。

GetSerializableMembers 和 CreateContract 覆盖无法检测到这些嵌套集合属性是“代理的”。解决此问题的一种方法是重写 CreateProperty 方法。诀窍是使用反射从属性中获取值并测试类型是否为 PersistentGenericBag。此方法还具有过滤任何生成异常的属性的能力。

```
 public class NHibernateContractResolver : DefaultContractResolver
    {
        protected override JsonProperty CreateProperty(MemberInfo member, MemberSerialization memberSerialization)
        {
            JsonProperty property = base.CreateProperty(member, memberSerialization);

            property.ShouldSerialize = instance =>
            {
                try
                {
                    PropertyInfo prop = (PropertyInfo)member;
                    if (prop.CanRead)
                    {
                        var value = prop.GetValue(instance, null);
                        if (value != null && typeof(NHibernate.Collection.Generic.PersistentGenericBag<>).IsSubclassOfRawGeneric(value.GetType()))
                            return false;

                        return true;
                    }
                }
                catch
                { }
                return false;
            };

            return property;
        }
    } 
```

上面使用的 IsSubclassOfRawGeneric 扩展：

```
public static class TypeExtensions
{
    public static bool IsSubclassOfRawGeneric(this Type generic, Type? toCheck)
    {
        while (toCheck != null && toCheck != typeof(object))
        {
            var cur = toCheck.IsGenericType ? toCheck.GetGenericTypeDefinition() : toCheck;
            if (generic == cur)
            {
                return true;
            }
            toCheck = toCheck?.BaseType;
        }
        return false;
    }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-01-18T11:13:42.550

如果您序列化包含 NHibernate 代理类的对象，您最终可能会下载整个数据库，因为一旦访问该属性，NHibernate 就会触发对数据库的请求。我刚刚为 NHibernate 实现了一个工作单元：[NHUnit](https://github.com/CSharpBender/NHUnit)，它修复了 NHibernate 的两个最烦人的问题：使用 fetch 时的代理类和笛卡尔积。

你会怎么用这个？

```
var customer = await _dbContext.Customers.Get(customerId) //returns a wrapper to configure the query
           .Include(c => c.Addresses.Single().Country, //include Addresses and Country
                    c => c.PhoneNumbers.Single().PhoneNumberType) //include all PhoneNumbers with PhoneNumberType
           .Unproxy() //instructs the framework to strip all the proxy classes when the Value is returned
           .Deferred() //instructs the framework to delay execution (future)
           .ValueAsync(token); //this is where all deferred queries get executed 
```

上面的代码基本上是配置一个查询：返回一个带有多个子对象的客户 ID，这些子对象应该与其他查询（期货）一起执行，并且返回的结果应该去除 NHibernate 代理。查询在`ValueAsync`被调用时被执行。 [NHUnit](https://github.com/CSharpBender/NHUnit)确定它是否应该加入主查询、创建新的未来查询或使用批量获取。

Github 上有一个[简单的示例项目，](https://github.com/CSharpBender/NHUnit/tree/master/NHUnitExample)向您展示如何使用 NHUnit 包。如果其他人对这个项目感兴趣，我会投入更多的时间让它变得更好。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-04-26T21:53:03.060

这就是我使用的：

1.  有一个标记接口并在您的实体上继承它，例如在我的情况下为 empty `IEntity`。

我们将使用标记接口来检测合约解析器中的 NHibernate 实体类型。

```
 public class CustomerEntity : IEntity {    ...   } 
```

2.  为 JSON.NET 创建自定义合同解析器

    ```
     public class NHibernateProxyJsonValueProvider : IValueProvider {

         private readonly IValueProvider _valueProvider;

         public NHibernateProxyJsonValueProvider(IValueProvider valueProvider)
         {
             _valueProvider = valueProvider;
         }

         public void SetValue(object target, object value)
         { 
             _valueProvider.SetValue(target, value); 
         }

         private static (bool isProxy, bool isInitialized) GetProxy(object proxy)
         {
             // this is pretty much what NHibernateUtil.IsInitialized() does.
             switch (proxy)
             {
                 case INHibernateProxy hibernateProxy:
                     return (true, !hibernateProxy.HibernateLazyInitializer.IsUninitialized);
                 case ILazyInitializedCollection initializedCollection:
                     return (true, initializedCollection.WasInitialized);
                 case IPersistentCollection persistentCollection:
                     return (true, persistentCollection.WasInitialized);
                 default:
                     return (false, false);
             }
         }

         public object GetValue(object target)
         { 
             object value = _valueProvider.GetValue(target);
             (bool isProxy, bool isInitialized) = GetProxy(value);
             if (isProxy)
             {
                 if (isInitialized)
                 {
                     return value;
                 }

                 if (value is IEnumerable)
                 {
                     return Enumerable.Empty<object>();
                 }

                 return null;
             }

             return value;
         }  
    }

    public class NHibernateContractResolver : CamelCasePropertyNamesContractResolver {

         protected override JsonContract CreateContract(Type objectType)
         {
             if (objectType.IsAssignableTo(typeof(IEntity)))
             {
                 return base.CreateObjectContract(objectType);
             }

             return base.CreateContract(objectType);
         } 

         protected override JsonProperty CreateProperty(MemberInfo member, MemberSerialization memberSerialization)
         {
             JsonProperty property = base.CreateProperty(member, memberSerialization);

             property.ValueProvider = new NHibernateProxyJsonValueProvider(property.ValueProvider);

             return property;
         }  
     } 
    ```

*   正常未初始化的延迟加载属性将导致`null`json 输出。
*   集合未初始化的延迟加载属性将导致`[]`json 中的数组为空。

因此，为了让延迟加载的属性出现在 json 输出中，您需要在序列化之前在查询或代码中急切地加载它。

用法：

```
JsonConvert.SerializeObject(entityToSerialize, new JsonSerializerSettings() {
  ContractResolver = new NHibernateContractResolver()
}); 
```

或者全局在 ASP.NET Core Startup 类中

```
 services.AddNewtonsoftJson(options =>
            { 
                options.SerializerSettings.ContractResolver = new NHibernateContractResolver();  
            }); 
```

使用：

*   净 5.0
*   NHibernate 5.3.8
*   JSON.NET 最新通过 ASP.NET Core

# java - JFrame 的无响应 KeyListener

> ID：286727
> 
> 赞同：82
> 
> 时间：2008-11-13T10:17:11.333
> 
> 标签：java, swing, jframe, keylistener

我正在尝试`KeyListener`为我的`JFrame`. 在构造函数上，我正在使用以下代码：

```
System.out.println("test");
addKeyListener(new KeyListener() {
    public void keyPressed(KeyEvent e) { System.out.println( "tester"); }

    public void keyReleased(KeyEvent e) { System.out.println("2test2"); }

    public void keyTyped(KeyEvent e) { System.out.println("3test3"); }
}); 
```

当我运行它时，`test`消息会出现在我的控制台中。但是，当我按下一个键时，我没有收到任何其他消息，就好像`KeyListener`根本不存在一样。

我在想这可能是因为焦点不在`JFrame`
，所以他们`KeyListener`没有收到任何事件。但是，我很确定它是。

有什么我想念的吗？

* * *

## 回答 #1

> 赞同：133
> 
> 时间：2009-09-04T14:09:36.470

如果您不想在每个组件上注册一个侦听器，
您可以**将自己`KeyEventDispatcher`**的添加到`KeyboardFocusManager`：

```
public class MyFrame extends JFrame {    
    private class MyDispatcher implements KeyEventDispatcher {
        @Override
        public boolean dispatchKeyEvent(KeyEvent e) {
            if (e.getID() == KeyEvent.KEY_PRESSED) {
                System.out.println("tester");
            } else if (e.getID() == KeyEvent.KEY_RELEASED) {
                System.out.println("2test2");
            } else if (e.getID() == KeyEvent.KEY_TYPED) {
                System.out.println("3test3");
            }
            return false;
        }
    }
    public MyFrame() {
        add(new JTextField());
        System.out.println("test");
        KeyboardFocusManager manager = KeyboardFocusManager.getCurrentKeyboardFocusManager();
        manager.addKeyEventDispatcher(new MyDispatcher());
    }

    public static void main(String[] args) {
        MyFrame f = new MyFrame();
        f.pack();
        f.setVisible(true);
    }
} 
```

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2008-11-13T13:01:28.513

您必须将您的 keyListener 添加到您需要的每个组件中。只有具有焦点的组件才会发送这些事件。例如，如果您的 JFrame 中只有一个 TextBox，则该 TextBox 具有焦点。因此，您还必须向该组件添加一个 KeyListener。

过程是一样的：

```
myComponent.addKeyListener(new KeyListener ...); 
```

注意：有些组件不像 JLabel 那样可聚焦。

要将它们设置为可聚焦，您需要：

```
myComponent.setFocusable(true); 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2013-02-23T00:29:07.607

InputMaps 和 ActionMaps 旨在捕获组件、组件及其所有子组件或整个窗口的关键事件。这是通过 JComponent.getInputMap() 中的参数控制的。有关文档，请参阅[如何使用键绑定](http://docs.oracle.com/javase/tutorial/uiswing/misc/keybinding.html)。

这种设计的美妙之处在于，人们可以挑选哪些按键对监控很重要，并根据这些按键触发不同的动作。

当在窗口中的任何位置按下转义键时，此代码将在 JFrame 上调用 dispose()。JFrame 不是从 JComponent 派生的，因此您必须使用 JFrame 中的另一个组件来创建键绑定。内容窗格可能就是这样一个组件。

```
InputMap inputMap; 
ActionMap actionMap;
AbstractAction action;
JComponent component;

inputMap  = component.getInputMap(JComponent.WHEN_IN_FOCUSED_WINDOW);
actionMap = component.getActionMap();

action    = new AbstractAction()
{
   @Override
   public void actionPerformed(ActionEvent e)
   {
      dispose();
   }
};

inputMap.put(KeyStroke.getKeyStroke(KeyEvent.VK_ESCAPE, 0), "dispose");
actionMap.put("dispose", action); 
```

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-04-27T15:30:43.683

我遇到了同样的问题，直到我读到真正的问题是关于 FOCUS 的，您的 JFrame 已经添加了侦听器，但是游览框架永远不会在 Focus 上，因为您的 JFrame 中有很多组件也是可聚焦的，所以请尝试：

```
JFrame.setFocusable(true); 
```

祝你好运

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-11-13T13:18:58.853

`KeyListener`是低级别的，仅适用于单个组件。尽管尝试使其更可用，但`JFrame`创建了许多组件组件，最明显的是内容窗格。`JComboBox`UI 也经常以类似的方式实现。

值得注意的是，鼠标事件的工作方式与按键事件略有不同。

有关您应该做什么的详细信息，请参阅我对[应用程序范围的键盘快捷键 - Java Swing](https://stackoverflow.com/questions/100123/application-wide-keyboard-shortcut-java-swing#100754)的回答。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2011-01-09T14:50:07.940

Deion（以及任何其他提出类似问题的人），您可以使用上述 Peter 的代码，但不是打印到标准输出，而是测试关键代码 PRESSED、RELEASED 或 TYPED。

```
@Override
public boolean dispatchKeyEvent(KeyEvent e) {
    if (e.getID() == KeyEvent.KEY_PRESSED) {
        if (e.getKeyCode() == KeyEvent.VK_F4) {
            dispose();
        }
    } else if (e.getID() == KeyEvent.KEY_RELEASED) {
        if (e.getKeyCode() == KeyEvent.VK_F4) {
            dispose();
        }
    } else if (e.getID() == KeyEvent.KEY_TYPED) {
        if (e.getKeyCode() == KeyEvent.VK_F4) {
            dispose();
        }
    }
    return false;
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2011-07-15T19:47:38.677

为了捕获*JFrame*中所有文本字段的关键事件，可以使用关键事件后处理器。这是一个工作示例，在添加明显的包含之后。

```
public class KeyListenerF1Demo extends JFrame implements KeyEventPostProcessor {
    public static final long serialVersionUID = 1L;

    public KeyListenerF1Demo() {
        setTitle(getClass().getName());

        // Define two labels and two text fields all in a row.
        setLayout(new FlowLayout());

        JLabel label1 = new JLabel("Text1");
        label1.setName("Label1");
        add(label1);

        JTextField text1 = new JTextField(10);
        text1.setName("Text1");
        add(text1);

        JLabel label2 = new JLabel("Text2");
        label2.setName("Label2");
        add(label2);

        JTextField text2 = new JTextField(10);
        text2.setName("Text2");
        add(text2);

        // Register a key event post processor.
        KeyboardFocusManager.getCurrentKeyboardFocusManager()
                .addKeyEventPostProcessor(this);
    }

    public static void main(String[] args) {
        JFrame f = new KeyListenerF1Demo();
        f.setName("MyFrame");
        f.pack();
        f.setVisible(true);
    }

    @Override
    public boolean postProcessKeyEvent(KeyEvent ke) {
        // Check for function key F1 pressed.
        if (ke.getID() == KeyEvent.KEY_PRESSED
                && ke.getKeyCode() == KeyEvent.VK_F1) {

            // Get top level ancestor of focused element.
            Component c = ke.getComponent();
            while (null != c.getParent())
                c = c.getParent();

            // Output some help.
            System.out.println("Help for " + c.getName() + "."
                    + ke.getComponent().getName());

            // Tell keyboard focus manager that event has been fully handled.
            return true;
        }

        // Let keyboard focus manager handle the event further.
        return false;
    }
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-13T10:39:13.753

嗯..你的构造函数是什么类？可能是一些扩展 JFrame 的类？当然，窗口焦点应该在窗口上，但我认为这不是问题。

我扩展了您的代码，尝试运行它并且它有效 - 按键导致打印输出。（通过 Eclipse 与 Ubuntu 一起运行）：

```
public class MyFrame extends JFrame {
    public MyFrame() {
        System.out.println("test");
        addKeyListener(new KeyListener() {
            public void keyPressed(KeyEvent e) {
                System.out.println("tester");
            }

            public void keyReleased(KeyEvent e) {
                System.out.println("2test2");
            }

            public void keyTyped(KeyEvent e) {
                System.out.println("3test3");
            }
        });
    }

    public static void main(String[] args) {
        MyFrame f = new MyFrame();
        f.pack();
        f.setVisible(true);
    }
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2014-06-27T15:20:24.503

这应该有帮助

```
 yourJFrame.setFocusable(true);
    yourJFrame.addKeyListener(new java.awt.event.KeyAdapter() {

        @Override
        public void keyTyped(KeyEvent e) {
            System.out.println("you typed a key");
        }

        @Override
        public void keyPressed(KeyEvent e) {
            System.out.println("you pressed a key");
        }

        @Override
        public void keyReleased(KeyEvent e) {
            System.out.println("you released a key");
        }
    }); 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-01-04T02:31:37.200

我一直有同样的问题。我听从了布鲁诺给你的建议，发现只在 JFrame 中的“第一个”按钮（即左上角）添加一个 KeyListener 就可以了。但我同意你的看法，这是一种令人不安的解决方案。所以我摆弄了一下，发现了一种更巧妙的方法来修复它。只需添加行

```
myChildOfJFrame.requestFocusInWindow(); 
```

在您创建 JFrame 子类的实例并将其设置为可见之后，添加到您的 main 方法。

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2012-07-10T19:24:10.000

大声笑....您所要做的就是确保

addKeyListener(this);

正确放置在您的代码中。

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2012-11-09T20:22:18.297

您可以让自定义 JComponents 将其父 JFrame 设置为可聚焦。

只需添加一个构造函数并传入 JFrame。然后调用paintComponent 中的setFocusable()。

这样，无论是否按下其他组件，JFrame 都将始终接收 KeyEvents。

# jquery - 从下拉列表中获取值并在 UrlHelper 中使用值

> ID：286728
> 
> 赞同：1
> 
> 时间：2008-11-13T10:17:27.993
> 
> 标签：jquery, asp.net-mvc

我会尝试这样的事情，但这是不允许的。

```
function GetDynamicModulesProperties() {
    var selectedValue = $("#moduletype option:selected").val();
    if (selectedValue.lenght() > 0) {

        var url = '<%= Url.Action("GetModuleProperties", new { sectionid = ViewData.Model.Id, moduleTypeId = selectedValue } ) %>';
        var renderContainer = $("#modulesettings");
        $.get(url, function(data) {
            renderContainer.html(data);
            renderContainer.fadeIn('slow');
        });
    }
} 
```

有没有办法做到这一点？

提前感谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-13T10:33:16.183

在 select 上执行 val() 以获取选定的选项值。

```
var selectedValue = $("#moduletype").val(); 
```

要从选项中获取它，您将使用以下内容，但是额外的按键没有意义:)

```
 var selectedValue = $("#moduletype>option:selected").attr('value'); 
```

# mysql - MySQL 日期比较 YYYY/MM/DD 与 YYYY-MM-DD 不一致

> ID：286729
> 
> 赞同：2
> 
> 时间：2008-11-13T10:17:38.617
> 
> 标签：mysql

我有一个 MySQL (v 5, MyISAM) 查询，它根据日期字符串格式返回不同的行。

```
(1) IFNULL(date1, ADDDATE('2008/10/31 23:59:59',INTERVAL 1 DAY)) > '2008-10-31 23:59:59'
(2) IFNULL(date1, ADDDATE('2008/10/31 23:59:59',INTERVAL 1 DAY)) > '2008/10/31 23:59:59'

(3) date1 > '2008-10-31 23:59:59'
(4) date1 > '2008/10/31 23:59:59' 
```

'>' 比较运算符的 RHS 上的 '/' vs '-'。

```
(1) 75,098 rows *expected*
(2) 0 rows *DIFFERENCE*
(3) 199 rows *simple case as expected*
(4) 199 rows *simple case as expected* 
```

问题 - 为什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T10:41:43.343

简短回答：使用`CAST(... AS DATE)`

长答案：

从[MySQL 日期类型](http://dev.mysql.com/doc/refman/5.0/en/datetime.html)：

> 允许使用“宽松”语法：任何标点符号都可以用作日期部分或时间部分之间的分隔符。例如，“98-12-31 11:30:45”、“98.12.31 11+30+45”、“98/12/31 11*30*45”和“98@12@31 11^30” ^45' 是等价的。

在您的示例 1 和 2 中，您使用的是 ADDDATE... 这将始终返回带有“-”分隔符的日期，无论输入格式如何：

```
+-----------------------------------------------+
| ADDDATE('2008/10/31 23:59:59',INTERVAL 1 DAY) |
+-----------------------------------------------+
| 2008-11-01 23:59:59                           |
+-----------------------------------------------+ 
```

您还使用了 IFNULL，它会丢失类型信息，因此当您比较它时，它会作为字符串进行比较。

你可以做的就是把它改回一个日期：

```
mysql> SELECT IFNULL(null, ADDDATE('2008/10/31 23:59:59',INTERVAL 1 DAY)) > '2008/10/31 23:59:59';
+-------------------------------------------------------------------------------------+
| IFNULL(null, ADDDATE('2008/10/31 23:59:59',INTERVAL 1 DAY)) > '2008/10/31 23:59:59' |
+-------------------------------------------------------------------------------------+
|                                                                                   0 |
+-------------------------------------------------------------------------------------+
1 row in set (0.00 sec)

mysql> SELECT CAST(IFNULL(null, ADDDATE('2008/10/31 23:59:59',INTERVAL 1 DAY)) AS DATE) > '2008/10/31 23:59:59';
+---------------------------------------------------------------------------------------------------+
| CAST(IFNULL(null, ADDDATE('2008/10/31 23:59:59',INTERVAL 1 DAY)) AS DATE) > '2008/10/31 23:59:59' |
+---------------------------------------------------------------------------------------------------+
|                                                                                                 1 |
+---------------------------------------------------------------------------------------------------+ 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T10:30:09.870

我对 mysql 不太了解，但是否有可能基于“/”的日期被解释为“YYYY/DD/MM”，所以完全无效？在 SQL Server 中，我希望在这种情况下出现异常，但如果 mysql 替换某种“无效日期”值，这可能会解释差异。

YYYY-MM-DD 是官方 ISO 格式。YYYY/MM/DD 我没听说过。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-19T10:35:40.630

参考 简短回答：使用 CAST(... AS DATE)

LHS 是 (1) 和 (2) 相同的是 RHS 改变评估并且是一个字符串。

参考基于“/”的日期。

如果 '2008/10/31 23:59:59' 是无效日期，它将在选项 (1)、(3)、(4) 中失败，这是唯一成功的选项。如果 ''2008-10-31 23:59:59' 是无效的日期，它将在选项 (1)、(3) 中失败。

# c# - abcPDF 7 将 HTML 转换为 PDF，但只转换第一页

> ID：286748
> 
> 赞同：6
> 
> 时间：2008-11-13T10:26:36.320
> 
> 标签：c#, asp.net, html, abcpdf

我目前正在使用 abcPDF 7 将 HTML 转换为 PDF。这是通过我覆盖 Render 方法的 ASPX 页面完成的。

```
Doc theDoc = new Doc();
theDoc.SetInfo(0, "License", m_License );
theDoc.HtmlOptions.Paged = true;
theDoc.HtmlOptions.Timeout = 1000000;

string callUrl = "http:// my app page";
theDoc.AddImageUrl(callUrl);
Response.Clear();

Response.Cache.SetCacheability(HttpCacheability.Private);
Response.AddHeader("Content-Disposition", "attachment; filename=" + sFile + ".pdf");
Response.ContentType = "application/octet-stream";

theDoc.Save(Response.OutputStream);

Response.Flush(); 
```

这对于第一页非常有效，但随后会截断页面并且不会继续呈现剩余页面。

有谁知道为什么它在页面后停止？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-11-13T01:05:31.163

我有这个完全相同的问题。答案是使用链接，但上一个答案中提供的页面并没有准确地向您展示如何做到这一点。这是我网站上的一个示例：请注意，变量 htmlOutput 是我的对象中的一个变量，它接收我要呈现的 htmlOutput。我通过将 html 直接推送到变量中来从页面收集此信息，或者如果它针对当前页面，我为 Page 运行受保护的覆盖 void Render(HtmlTextWriter output)，将 Render 的内容推送到此 htmlOutput 变量中。

```
Doc theDoc = new Doc();
int theID;
theDoc.Page = theDoc.AddPage();

theID = theDoc.AddImageHtml(htmlOutput);

 while (true)
 {
     theDoc.FrameRect(); // add a black border
     if (!theDoc.Chainable(theID))
         break;
      theDoc.Page = theDoc.AddPage();
      theID = theDoc.AddImageToChain(theID);
 }

 for (int i = 1; i <= theDoc.PageCount; i++)
 {
    theDoc.PageNumber = i;
    theDoc.Flatten();
  }
  //reset back to page 1 so the pdf starts displaying there
  if(theDoc.PageCount > 0)
       theDoc.PageNumber = 1;

  //now get your pdf content from the document
  byte[] theData = theDoc.GetData(); 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-11-13T10:29:26.033

“只绘制文档的第一页。可以使用 AddImageToChain 方法绘制后续页面。”

从[这里](http://www.websupergoo.com/helppdf5net/source/5-abcpdf5/doc/1-methods/addimageurl.htm)

可以在[此处找到如何使用 AddImageToChain 的示例](http://www.websupergoo.com/helppdf5net/source/5-abcpdf5/doc/1-methods/addimagetochain.htm)

# .net - 如何将 CardSpace 支持添加到您的 ASP.NET 应用程序

> ID：286750
> 
> 赞同：3
> 
> 时间：2008-11-13T10:27:57.427
> 
> 标签：.net, asp.net, security, cardspace

我喜欢 CardSpace 的想法，但与 OpenID 不同，它似乎是一个真正的 PITA，可以在您的 ASP.NET Web 应用程序中支持它。我找到了很多例子，甚至是我拥有的一本书中的教程……但似乎比他们建议的要多得多。

更改服务器等？

有人可以告诉我：

*   我需要在 IIS7 中配置什么
*   如何在不使用许多 3rd 方组件的情况下实现 CardSpace 支持
*   你设法让它工作了吗？

我认为复杂性（或糟糕的文档）是 CardSpace 落后的原因之一。

（我对其他人对此的看法很感兴趣，但不要把它变成一场激烈的战争，我只是想要一个解决方案，也许简而言之就是你的想法）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T10:56:27.227

对于卡片空间，请查看开源库 SharpSTS a [https://sharpsts.com/](https://sharpsts.com/)

他们还提供一些卡片空间资源的链接，这些资源可能会帮助您入门：[https ://sharpsts.com/resources.aspx](https://sharpsts.com/resources.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T12:59:53.447

我已经在博客上写过，但它是瑞典语的。我希望我们可以依靠谷歌翻译。:-)

[开始使用](http://translate.google.com/translate?u=http%3A%2F%2Fweblogs.asp.net%2Fmikaelsoderstrom%2Farchive%2F2008%2F09%2F08%2Fwindows-cardspace-kom-ig-229-ng.aspx&hl=sv&ie=UTF-8&sl=sv&tl=en)

[使用具有 ASP.NET 成员资格的 Windows CardSpace](http://translate.google.com/translate?u=http%3A%2F%2Fweblogs.asp.net%2Fmikaelsoderstrom%2Farchive%2F2008%2F09%2F09%2Fkoppla-ihop-windows-cardspace-med-asp-net-membership.aspx&hl=en&ie=UTF-8&sl=sv&tl=en)

[使用 Javascript 获取 InfoCard](http://translate.google.com/translate?u=http%3A%2F%2Fweblogs.asp.net%2Fmikaelsoderstrom%2Farchive%2F2008%2F10%2F02%2Fh-228-mta-ett-infocard-med-javascript.aspx&hl=en&ie=UTF-8&sl=sv&tl=en)

希望这可以帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T12:53:30.467

Rob Conery 正在他的新项目中实施 CardSpace。
[http://blog.wekeroad.com/mvc-storefront/mvcstore-part-17/](http://blog.wekeroad.com/mvc-storefront/mvcstore-part-17/)

希望能帮助到你

# mysql - 一个强大的 MySQL 管理工具，具有与 SQL Server Management Studio 类似的功能

> ID：286755
> 
> 赞同：20
> 
> 时间：2008-11-13T10:29:49.043
> 
> 标签：mysql, sql-server, database, admin, mysql-management

我目前正在与一位在 Ms-SQL 方面经验丰富但在 MySQL 方面经验不多的开发人员一起工作。他一直在诅咒 MySQL 有错误，而且更难使用。

是因为他在管理工作室的经历非常好。在我看来，他的问题在于使用 phpMyAdmin。

例如，他引用了无法使用 MySQL 在不同结构的表之间进行交叉连接和比较的例子。问题实际上是我们选择的管理工具，还是 MySQL 有我的开发人员认为的这些缺陷。我希望不会，因为我刚刚对在 Studio Manager 中执行各种数据管理任务的速度感到震惊。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-11-13T12:47:58.917

你真的应该检查[SQLYog](http://www.webyog.com)。很棒，而且有社区版。

![在此处输入图像描述](https://i.stack.imgur.com/gGnji.png)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-13T10:34:05.947

[Quest Toad](https://www.quest.com/products/toad-edge/)很好，并且有 *MySQL 的付费和免费版本。

*   免费版不再可用

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-27T21:40:36.237

讨厌在你的工具队列上下雨，但是虽然这里提到的一些工具很酷，但它们都没有 SSMS 的魔力。

在我的 MySQL 工作中，我基本上在 SQLYog 和 MySQL GUI 工具之间切换，这取决于我所做的事情。SQLYog 企业版（例如非免费版）还添加了对真正基本模式代码完成的支持。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-11-13T13:04:00.583

更多工具可供尝试：[EMS SQL Management Studio](http://www.sqlmanager.net/en/products/studio)或[MySQL GUI Tools](http://dev.mysql.com/downloads/gui-tools/5.0.html)（现在称为[MySQL Workbench](http://dev.mysql.com/downloads/tools/workbench/)）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-13T12:49:52.080

我会建议[Aqua Data Studio](http://www.aquafold.com/)。我不认为它有免费版本，但是它非常强大，并且有很多类似于 SQL Server Management Studio 的强大功能。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-09-24T10:34:13.493

[VSQL++ for MySQL](http://www.sqlpp.com/products/mysql-management/)是一个强大的 MySQL 图形用户界面数据库管理工具

# objective-c - 如何在 Objective C 中将浮点数转换为 int？

> ID：286756
> 
> 赞同：54
> 
> 时间：2008-11-13T10:29:49.717
> 
> 标签：objective-c, casting, floating-point

完全是新手问题，但这让我发疯！我正在尝试这个：

```
myInt = [myFloat integerValue]; 
```

但我收到一个错误，说本质上 integerValue 不适用于浮点数。

我该怎么做？

* * *

## 回答 #1

> 赞同：129
> 
> 时间：2008-11-13T10:38:43.737

我很确定 C 风格的强制转换语法在 Objective C 中有效，所以也试试吧：

```
int myInt = (int) myFloat; 
```

至少，它可能会使编译器警告静音。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-11-13T10:32:52.673

有什么问题：

```
int myInt = myFloat; 
```

请记住，这将使用默认的舍入规则，接近零（即 -3.9f 变为 -3）

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2011-08-06T23:31:23.717

```
int myInt = (int) myFloat; 
```

对我来说工作得很好。

```
int myInt = [[NSNumber numberWithFloat:myFloat] intValue]; 
```

嗯，这是一种选择。如果你喜欢绕道而行，我可以考虑一些使用 NSString 的方法。当有一个复杂的选择时，为什么容易？:)

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2013-09-29T01:10:20.217

您也可以使用 C 的`lroundf(myFloat)`.

* * *

一个非常有用的提示：在 Xcode 的编辑器中，输入你的代码

```
myInt = roundf(someFloat); 
```

然后控制/右键单击`roundf`并**跳转到定​​义**（或简单地单击命令）。

然后，您将清楚地看到**很长的可用功能列表**。（不可能全部记住，所以就用这个技巧。）

例如，在手头的示例中，这很可能`lrintf`就是您想要的。

进一步的提示：获取有关这些功能的文档。在您的 Terminal.app （或任何外壳 - 与 Xcode 无关，**只是普通的 Terminal.app**）中，只需键入`man lrintf`它就会为您提供完整的信息。希望它可以帮助某人。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-11-13T21:48:19.810

为了支持 unwind，请记住 Objective-C 是 C 的超集，而不是一种全新的语言。

您可以在常规的旧 ANSI C 中执行的任何操作都可以在 Objective-C 中完成。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-07-19T23:49:16.260

这是 2012 年引入的更简洁的方法：

```
myInt = @(myFloat).intValue; 
```

# java - 找出签入更改了哪些方法？

> ID：286762
> 
> 赞同：1
> 
> 时间：2008-11-13T10:34:00.893
> 
> 标签：java, svn

这是交易 - 我想要一种方法来具体确定在最后一个里程碑/迭代中触及或更改了哪些方法，以便检查方法的 Javadoc 是否有正确的内容，尤其是公共 API 方法。

关于如何做到这一点的任何想法，也许是一个 SVN 钩子？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T12:54:07.360

至少一个想法：svn diff 能够将参数传递给 diff 命令。一种这样的选择是`-p`，也称为`--show-c-function`. 这可能会出现在 C 代码的这个问题的解决方案中。所以，问题就变成了：是否有一个 diff 实现对 Java 语法有足够的了解来支持类似的选项？我已经谷歌了，但还没有找到任何东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T17:29:07.540

没有单一的命令可以实现这一点，但您可以结合一些 svn 命令来实现类似的效果：

1.  **svn diff** last tag with your trunk:HEAD revision with --summarize option
2.  **svn 注释**您通过步骤 1 接收的每个文件并解析输出以找到更改的代码行（它们的 rev 大于 tag-rev。）
3.  标记关联函数或将它们输出到报告文件中（如果您逐行解析文件，请记住最后一个函数签名）

类/方法名对于通常的 java 类来说是微不足道的，但是，如果你使用内部类，它会更加困难，但是：他们有或需要 javadoc 注释吗？

# workflow-foundation - 复制器活动中的 InvokeWorkflow 活动

> ID：286766
> 
> 赞同：0
> 
> 时间：2008-11-13T10:34:27.787
> 
> 标签：workflow-foundation

我在复制器活动中有一个调用工作流活动。我尝试调用的工作流需要向其传递 2 个参数，一个整数和一个字符串参数，这些参数应由复制器活动传递给工作流。关于如何做到这一点的任何想法？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T18:32:00.157

这是一个完整的示例（请注意，可以在设计器的属性窗格中设置构造函数中包含的任何内容）： Workflow3 是仅包含 CodeActivity 的目标工作流，后面的代码如下：

```
public sealed partial class Workflow3 : SequentialWorkflowActivity
{
    public static readonly DependencyProperty MyIntProperty =
        DependencyProperty.Register("MyInt", typeof(int), typeof(Workflow3));
    public static readonly DependencyProperty MyStringProperty =
        DependencyProperty.Register("MyString", typeof(string), typeof(Workflow3));

    public Workflow3()
    {
        InitializeComponent();

        this.codeActivity1.ExecuteCode += new System.EventHandler(this.codeActivity1_ExecuteCode);
    }

    public int MyInt
    {
        get { return (int)GetValue(MyIntProperty); }
        set { SetValue(MyIntProperty, value); }
    }

    public string MyString
    {
        get { return (string)GetValue(MyStringProperty); }
        set { SetValue(MyStringProperty, value); }
    }

    private void codeActivity1_ExecuteCode(object sender, EventArgs e)
    {
        Console.WriteLine("Invoke WF: Int = {0}, String = {1}", this.MyInt, this.MyString);
    }
} 
```

Workflow2 是仅包含 ReplicatorActivity 的托管工作流。ReplicatorActivity 仅包含一个 InvokeWorkflowActivity，它的 TargetWorkflow 设置为 Workflow3。代码隐藏如下：

```
public sealed partial class Workflow2 : SequentialWorkflowActivity
{
    // Variables used in bindings
    public int InvokeWorkflowActivity1_MyInt = default(int);
    public string InvokeWorkflowActivity1_MyString = string.Empty;

    public Workflow2()
    {
        InitializeComponent();

        // Bind MyInt parameter of target workflow to my InvokeWorkflowActivity1_MyInt
        WorkflowParameterBinding wpb1 = new WorkflowParameterBinding("MyInt");
        wpb1.SetBinding(WorkflowParameterBinding.ValueProperty, new ActivityBind(this.GetType().Name, "InvokeWorkflowActivity1_MyInt"));
        this.invokeWorkflowActivity1.ParameterBindings.Add(wpb1);

        // Bind MyString parameter of target workflow to my InvokeWorkflowActivity1_MyString
        WorkflowParameterBinding wpb2 = new WorkflowParameterBinding("MyString");
        wpb2.SetBinding(WorkflowParameterBinding.ValueProperty, new ActivityBind(this.GetType().Name, "InvokeWorkflowActivity1_MyString"));
        this.invokeWorkflowActivity1.ParameterBindings.Add(wpb2);

        // Add event handler for Replicator's Initialized event
        this.replicatorActivity1.Initialized += new EventHandler(ReplicatorInitialized);

        // Add event handler for Replicator's ChildInitialized event
        this.replicatorActivity1.ChildInitialized += new EventHandler<ReplicatorChildEventArgs>(this.ChildInitialized);
    }

    private void ReplicatorInitialized(object sender, EventArgs e)
    {
        // Find how many workflows I want
        List<MyClass> list = new List<MyClass>();
        list.Add(new MyClass() { MyInt = 1, MyString = "Str1" });
        list.Add(new MyClass() { MyInt = 2, MyString = "Str2" });
        list.Add(new MyClass() { MyInt = 3, MyString = "Str3" });

        // Assign list to replicator
        replicatorActivity1.InitialChildData = list;
    }

    private void ChildInitialized(object sender, ReplicatorChildEventArgs e)
    {
        // This is the activity that is initialized
        InvokeWorkflowActivity currentActivity = (InvokeWorkflowActivity)e.Activity;

        // This is the initial data
        MyClass initialData = (MyClass)e.InstanceData;

        // Setting the initial data to the activity
        InvokeWorkflowActivity1_MyInt = initialData.MyInt;
        InvokeWorkflowActivity1_MyString = initialData.MyString;
    }

    public class MyClass
    {
        public int MyInt { get; set; }
        public string MyString { get; set; }
    }
} 
```

预期结果如下：

```
Invoke WF: Int = 1, String = Str1
Invoke WF: Int = 2, String = Str2
Invoke WF: Int = 3, String = Str3 
```

希望这会对您有所帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-02-02T20:19:46.900

我意识到这篇文章已经过时了，但对于那些在谷歌上找到同样问题的人来说，这就是你需要做的：

1.  在自定义活动中包装对 InvokeWorkflow 的调用 - 这将简化参数映射。在此 Activity 中，为要传递给调用的工作流的每个属性创建一个 DependencyProperty。我们暂时称它为“InvokerActivity”。然后在 InvokeWorkflowActivity 中，将 TargetWorkflow 的属性映射到 InvokerActivity 上的依赖属性，正如上面 Panos 建议的那样。注意：为了让省略号显示对象必须是具体类型。如果您的对象是一个接口，您将无法映射它。工作流将不知道如何实例化接口对象。
2.  使用设计器将 InvokerActivity 放置在 ReplicatorActivity 中。
3.  ReplicatorActivity 公开了一个名为 ChildInitialized 的事件处理程序。为此事件创建您的处理程序，您将在其中收到一个 ReplicatorChildEventArgs。在其中，您可以通过事件参数接收活动，如下所示：

    ```
     InvokerActivity activity = (e.Activity as InvokerActivity);
        if (activity != null)
        {
            activity.MyParam = e.InstanceData as MyParamType;
        } 
    ```

现在，当您运行它时，ReplicatorActivity 将为集合中的每个项目调用一次此方法，并将传递它将产生的每个 InvokerActivities 的参数。

e.InstanceData 将是 Replicator 正在迭代的集合中的下一个对象。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T14:36:59.850

您可以像这样在目标工作流中声明两个属性：

```
 public static readonly DependencyProperty MyIntProperty =
        DependencyProperty.Register("MyInt", typeof(int), typeof(Workflow3));
    public static readonly DependencyProperty MyStringProperty =
        DependencyProperty.Register("MyString", typeof(string), typeof(Workflow3));

    public int MyInt
    {
        get { return (int)GetValue(MyIntProperty); }
        set { SetValue(MyIntProperty, value); }
    }

    public string MyString
    {
        get { return (string)GetValue(MyStringProperty); }
        set { SetValue(MyStringProperty, value); }
    } 
```

之后，如果您检查“属性”选项卡，`InvokeWorkflowActivity`您将看到该`Parameters`类别中的两个属性。

[![](https://i.stack.imgur.com/Ga9Lx.png)](https://i.stack.imgur.com/Ga9Lx.png)

您可以提供常量值，也可以将它们绑定到托管工作流的任何属性。

# linux - 更改用户在 RHEL 上的默认登录 shell？

> ID：286767
> 
> 赞同：5
> 
> 时间：2008-11-13T10:36:05.990
> 
> 标签：linux, rhel

这是免费 bsd 上的命令

```
sudo pw usermod ksbuild -s /usr/local/bin/bash 
```

我如何在 RHEL 上做同样的事情？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-13T10:40:01.397

chsh

（换壳）

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-11-13T12:50:37.273

或仅针对特定用户： usermod -s /usr/local/bin/bash ksbuild

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-13T12:48:47.107

要更改所有新用户的默认设置，请编辑默认文件中的设置：/etc/default/useradd

# xml - div 中的 $param 名称

> ID：286775
> 
> 赞同：2
> 
> 时间：2008-11-13T10:39:41.927
> 
> 标签：xml, xslt

我有一个要传递给模板的 $param。我希望将此参数的值用作 div 的类名。该类不采用参数的值，而是采用参数名称（在 html 页面中为 $param）。有什么办法可以将参数的值用作类名？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-13T10:53:13.943

要在文字结果元素的属性中使用 XSLT 表达式，请用大括号将表达式括起来，如下所示：

`<div class="{$param}"> ... </div>`

这称为[属性值模板](http://www.w3.org/TR/xslt20/#dt-attribute-value-template)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T10:44:14.290

以下应该有效：

```
<div>
<xsl:attribute name="class">
<xsl:value-of select="$param"/>
</xsl:attribute>
</div> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T10:50:32.340

请使用 xsl:attribute 元素添加值，例如，

```
print("<div><xsl:attribute name="class"><xsl:value-of select="$param" /></xsl:attribute></div>"); 
```

# javascript - 从 JavaScript 设置 Web 部件个性化属性

> ID：286786
> 
> 赞同：2
> 
> 时间：2008-11-13T10:45:22.040
> 
> 标签：javascript, web-parts

我在 Web 部件上定义了一个可个性化的属性，我想从 JavaScript 修改它的值。是否可以？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-11-13T10:48:09.850

您必须使用 AJAX 向服务器发送消息。如果不访问服务器，就无法从 JavaScript 设置它。

AJAX 可以像[PageMethod 调用](http://www.singingeels.com/Articles/Using_Page_Methods_in_ASPNET_AJAX.aspx)一样简单。

# asp.net - 运行 ASP.NET 应用程序的服务器的 DNS

> ID：286791
> 
> 赞同：2
> 
> 时间：2008-11-13T10:48:21.970
> 
> 标签：asp.net

如何知道运行 ASP.NET 应用程序的服务器的 DNS 名称？

[如果我的应用程序 URL 是http://www.somehost.com/somepath/application.aspx](http://www.somehost.com/somepath/application.aspx)，我想获取字符串“www.somehost.com”

是否有服务器、上下文、会话或请求对象的某些属性？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T13:32:15.893

这将为您提供托管网站的服务器的 DNS IP

```
void GetDNSServerAddress()
    {
        NetworkInterface[] nics = NetworkInterface.GetAllNetworkInterfaces();
            foreach (NetworkInterface ni in nics)
            {
                if (ni.OperationalStatus == OperationalStatus.Up)
                {
                    IPAddressCollection ips = ni.GetIPProperties().DnsAddresses;

                    foreach (System.Net.IPAddress ip in ips)
                    {
                        Console.Write(ip.ToString());
                    }
                }
            }
    } 
```

然而，在写这篇文章的时候，我刚刚看到了你编辑过的帖子，所以我认为这就是你所追求的：

```
string host = Request.Url.Scheme + "://" + Request.Url.Host; 
```

希望这可以帮助！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T10:58:43.883

HTTP_HOST 服务器变量可以为您提供所需的内容。

```
Request.ServerVariables("HTTP_HOST") 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T16:05:35.553

您还可以使用获取“机器名称”

```
System.Environment.MachineName 
```

# sql - SQL 导出到 Excel 结果到文档锁定，无法编辑工作表

> ID：286806
> 
> 赞同：1
> 
> 时间：2008-11-13T10:57:01.347
> 
> 标签：sql, excel

请帮我解决以下问题。

1.  当我从 SQL 报告 2005 导出报告时，图像徽标有点失真，并且工作表被锁定，因此无法进行进一步的编辑和排序。

2.  当我解锁冻结的单元格以允许排序和编辑时，由于标题和徽标等使用的合并单元格，整个工作表都被打乱了，我该如何解决这个问题？我的意思是，我怎样才能在不弄乱报告表的整体外观的情况下编辑表？

如果上述问题无法解决或者说它是一种限制，请提出建议或至少向我解释原因。

谢谢，希望很快能听到积极的解决方案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-29T15:23:13.120

你是对的，导出到 EXCEL 的 SQL 报告有点乱，你提到的问题相当普遍。

我发现的唯一实际工作是大量工作，就是将图像嵌入表格中，调整列宽以匹配报告中的一个。

这似乎适用于我们的大多数情况，但很大程度上取决于您的具体报告。

此外，在解锁报告后，请尝试在排序/编辑之前冻结标题行。

# c# - 如何将 Html 转换为纯文本？

> ID：286813
> 
> 赞同：121
> 
> 时间：2008-11-13T11:00:27.593
> 
> 标签：c#, asp.net, html

我有 Html 的片段存储在一个表中。*不是整个页面，没有标签等，只是基本格式。*

我希望能够在给定页面上仅将 Html 显示为文本，*没有格式*（实际上只是前 30-50 个字符，但这很容易）。

如何将该 Html 中的“文本”作为纯文本放入字符串中？

所以这段代码。

```
<b>Hello World.</b><br/><p><i>Is there anyone out there?</i><p> 
```

变成：

你好世界。有没有人在那里？

* * *

## 回答 #1

> 赞同：112
> 
> 时间：2009-07-13T19:17:44.790

MIT 许可的[HtmlAgilityPack](https://github.com/linezero/HtmlAgilityPack)在它[的一个示例中](https://github.com/ceee/ReadSharp/blob/master/ReadSharp/HtmlUtilities.cs)有一个从 HTML 转换为纯文本的方法。

```
var plainText = HtmlUtilities.ConvertToPlainText(string html); 
```

给它一个 HTML 字符串，比如

```
<b>hello, <i>world!</i></b> 
```

你会得到一个纯文本的结果，比如：

```
hello world! 
```

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2013-05-06T21:06:12.147

我无法使用 HtmlAgilityPack，所以我为自己编写了第二个最佳解决方案

```
private static string HtmlToPlainText(string html)
{
    const string tagWhiteSpace = @"(>|$)(\W|\n|\r)+<";//matches one or more (white space or line breaks) between '>' and '<'
    const string stripFormatting = @"<[^>]*(>|$)";//match any character between '<' and '>', even when end tag is missing
    const string lineBreak = @"<(br|BR)\s{0,1}\/{0,1}>";//matches: <br>,<br/>,<br />,<BR>,<BR/>,<BR />
    var lineBreakRegex = new Regex(lineBreak, RegexOptions.Multiline);
    var stripFormattingRegex = new Regex(stripFormatting, RegexOptions.Multiline);
    var tagWhiteSpaceRegex = new Regex(tagWhiteSpace, RegexOptions.Multiline);

    var text = html;
    //Decode html specific characters
    text = System.Net.WebUtility.HtmlDecode(text); 
    //Remove tag whitespace/line breaks
    text = tagWhiteSpaceRegex.Replace(text, "><");
    //Replace <br /> with line breaks
    text = lineBreakRegex.Replace(text, Environment.NewLine);
    //Strip formatting
    text = stripFormattingRegex.Replace(text, string.Empty);

    return text;
} 
```

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2008-11-13T12:44:51.183

如果您谈论的是标签剥离，那么如果您不必担心`<script>`标签之类的事情，那就相对简单了。如果您需要做的只是显示没有标签的文本，您可以使用正则表达式来完成：

```
<[^>]*> 
```

如果您确实需要担心`<script>`标签等问题，那么您将需要比正则表达式更强大的东西，因为您需要跟踪状态，更像是上下文无关语法 (CFG)。尽管您可以通过“从左到右”或非贪婪匹配来完成它。

如果您可以使用正则表达式，那么有很多网页提供了很好的信息：

*   [http://weblogs.asp.net/rosherove/archive/2003/05/13/6963.aspx](http://weblogs.asp.net/rosherove/archive/2003/05/13/6963.aspx)
*   [http://www.google.com/search?hl=en&q=html+tag+stripping+&btnG=搜索](http://www.google.com/search?hl=en&q=html+tag+stripping+&btnG=Search)

如果您需要更复杂的 CFG 行为，我建议您使用第三方工具，不幸的是我不知道有什么好推荐的。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2008-11-13T13:42:10.553

`HTTPUtility.HTMLEncode()`旨在将 HTML 标记编码为字符串。它会为您处理所有繁重的工作。从[MSDN 文档](http://msdn.microsoft.com/en-us/library/system.web.httpserverutility.htmlencode(VS.71).aspx)：

> 如果在 HTTP 流中传递诸如空格和标点符号之类的字符，它们可能会在接收端被误解。HTML 编码将 HTML 中不允许的字符转换为字符实体等价物；HTML 解码反转编码。例如，当嵌入文本块时，字符`<`和`>`被编码为`&lt;`和`&gt;`用于 HTTP 传输。

`HTTPUtility.HTMLEncode()`方法，详细[在这里](http://msdn.microsoft.com/en-us/library/system.web.httpserverutility.htmlencode(VS.71).aspx)：

```
public static void HtmlEncode(
  string s,
  TextWriter output
) 
```

用法：

```
String TestString = "This is a <Test String>.";
StringWriter writer = new StringWriter();
Server.HtmlEncode(TestString, writer);
String EncodedString = writer.ToString(); 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2017-10-11T06:38:46.013

将 HTML 转换为纯文本的三步过程

首先你需要为[HtmlAgilityPack](http://www.codeplex.com/htmlagilitypack)安装 Nuget 包 其次创建这个类

```
public class HtmlToText
{
    public HtmlToText()
    {
    }

    public string Convert(string path)
    {
        HtmlDocument doc = new HtmlDocument();
        doc.Load(path);

        StringWriter sw = new StringWriter();
        ConvertTo(doc.DocumentNode, sw);
        sw.Flush();
        return sw.ToString();
    }

    public string ConvertHtml(string html)
    {
        HtmlDocument doc = new HtmlDocument();
        doc.LoadHtml(html);

        StringWriter sw = new StringWriter();
        ConvertTo(doc.DocumentNode, sw);
        sw.Flush();
        return sw.ToString();
    }

    private void ConvertContentTo(HtmlNode node, TextWriter outText)
    {
        foreach(HtmlNode subnode in node.ChildNodes)
        {
            ConvertTo(subnode, outText);
        }
    }

    public void ConvertTo(HtmlNode node, TextWriter outText)
    {
        string html;
        switch(node.NodeType)
        {
            case HtmlNodeType.Comment:
                // don't output comments
                break;

            case HtmlNodeType.Document:
                ConvertContentTo(node, outText);
                break;

            case HtmlNodeType.Text:
                // script and style must not be output
                string parentName = node.ParentNode.Name;
                if ((parentName == "script") || (parentName == "style"))
                    break;

                // get text
                html = ((HtmlTextNode)node).Text;

                // is it in fact a special closing node output as text?
                if (HtmlNode.IsOverlappedClosingElement(html))
                    break;

                // check the text is meaningful and not a bunch of whitespaces
                if (html.Trim().Length > 0)
                {
                    outText.Write(HtmlEntity.DeEntitize(html));
                }
                break;

            case HtmlNodeType.Element:
                switch(node.Name)
                {
                    case "p":
                        // treat paragraphs as crlf
                        outText.Write("\r\n");
                        break;
                }

                if (node.HasChildNodes)
                {
                    ConvertContentTo(node, outText);
                }
                break;
        }
    }
} 
```

通过参考 Judah Himango 的回答使用上述课程

第三，您需要创建上述类的对象和`ConvertHtml(HTMLContent)`将 HTML 转换为纯文本的使用方法，而不是`ConvertToPlainText(string html);`

```
HtmlToText htt=new HtmlToText();
var plainText = htt.ConvertHtml(HTMLContent); 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2011-03-11T18:14:03.297

要添加到 vfilby 的答案，您可以在代码中执行 RegEx 替换；不需要新的课程。以防其他像我这样的新手偶然发现这个问题。

```
using System.Text.RegularExpressions; 
```

然后...

```
private string StripHtml(string source)
{
        string output;

        //get rid of HTML tags
        output = Regex.Replace(source, "<[^>]*>", string.Empty);

        //get rid of multiple blank lines
        output = Regex.Replace(output, @"^\s*$\n", string.Empty, RegexOptions.Multiline);

        return output;
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2012-05-08T21:52:34.233

我认为最简单的方法是制作一个“字符串”扩展方法（根据用户 Richard 的建议）：

```
using System;
using System.Text.RegularExpressions;

public static class StringHelpers
{
    public static string StripHTML(this string HTMLText)
        {
            var reg = new Regex("<[^>]+>", RegexOptions.IgnoreCase);
            return reg.Replace(HTMLText, "");
        }
} 
```

然后只需在程序中的任何“字符串”变量上使用此扩展方法：

```
var yourHtmlString = "<div class=\"someclass\"><h2>yourHtmlText</h2></span>";
var yourTextString = yourHtmlString.StripHTML(); 
```

我使用此扩展方法将 html 格式的注释转换为纯文本，以便在水晶报表上正确显示，并且效果很好！

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2018-05-16T05:32:13.853

它的局限性在于不会折叠长的内联空格，但它绝对是可移植的，并且像 webbrowser 一样尊重布局。

```
static string HtmlToPlainText(string html) {
  string buf;
  string block = "address|article|aside|blockquote|canvas|dd|div|dl|dt|" +
    "fieldset|figcaption|figure|footer|form|h\\d|header|hr|li|main|nav|" +
    "noscript|ol|output|p|pre|section|table|tfoot|ul|video";

  string patNestedBlock = $"(\\s*?</?({block})[^>]*?>)+\\s*";
  buf = Regex.Replace(html, patNestedBlock, "\n", RegexOptions.IgnoreCase);

  // Replace br tag to newline.
  buf = Regex.Replace(buf, @"<(br)[^>]*>", "\n", RegexOptions.IgnoreCase);

  // (Optional) remove styles and scripts.
  buf = Regex.Replace(buf, @"<(script|style)[^>]*?>.*?</\1>", "", RegexOptions.Singleline);

  // Remove all tags.
  buf = Regex.Replace(buf, @"<[^>]*(>|$)", "", RegexOptions.Multiline);

  // Replace HTML entities.
  buf = WebUtility.HtmlDecode(buf);
  return buf;
} 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2017-04-19T12:48:36.947

我发现的最简单的方法：

```
HtmlFilter.ConvertToPlainText(html); 
```

HtmlFilter 类位于 Microsoft.TeamFoundation.WorkItemTracking.Controls.dll

dll 可以在这样的文件夹中找到：%ProgramFiles%\Common Files\microsoft shared\Team Foundation Server\14.0\

在 VS 2015 中，该 dll 还需要引用位于同一文件夹中的 Microsoft.TeamFoundation.WorkItemTracking.Common.dll。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-03-26T09:22:02.313

HtmlAgilityPack 中没有名称为“ConvertToPlainText”的方法，但您可以使用以下命令将 html 字符串转换为 CLEAR 字符串：

```
HtmlDocument doc = new HtmlDocument();
doc.LoadHtml(htmlString);
var textString = doc.DocumentNode.InnerText;
Regex.Replace(textString , @"<(.|n)*?>", string.Empty).Replace("&nbsp", ""); 
```

那对我有用。但我在“HtmlAgilityPack”中找不到名称为“ConvertToPlainText”的方法。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2018-04-17T13:45:41.633

我有同样的问题，只是我的 html 有一个简单的已知布局，比如：

```
<DIV><P>abc</P><P>def</P></DIV> 
```

所以我最终使用了这样简单的代码：

```
string.Join (Environment.NewLine, XDocument.Parse (html).Root.Elements ().Select (el => el.Value)) 
```

哪个输出：

```
abc
def 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2018-10-17T19:54:06.897

我遇到了类似的问题并找到了最佳解决方案。下面的代码非常适合我。

```
 private string ConvertHtml_Totext(string source)
    {
     try
      {
      string result;

    // Remove HTML Development formatting
    // Replace line breaks with space
    // because browsers inserts space
    result = source.Replace("\r", " ");
    // Replace line breaks with space
    // because browsers inserts space
    result = result.Replace("\n", " ");
    // Remove step-formatting
    result = result.Replace("\t", string.Empty);
    // Remove repeating spaces because browsers ignore them
    result = System.Text.RegularExpressions.Regex.Replace(result,
                                                          @"( )+", " ");

    // Remove the header (prepare first by clearing attributes)
    result = System.Text.RegularExpressions.Regex.Replace(result,
             @"<( )*head([^>])*>","<head>",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);
    result = System.Text.RegularExpressions.Regex.Replace(result,
             @"(<( )*(/)( )*head( )*>)","</head>",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);
    result = System.Text.RegularExpressions.Regex.Replace(result,
             "(<head>).*(</head>)",string.Empty,
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);

    // remove all scripts (prepare first by clearing attributes)
    result = System.Text.RegularExpressions.Regex.Replace(result,
             @"<( )*script([^>])*>","<script>",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);
    result = System.Text.RegularExpressions.Regex.Replace(result,
             @"(<( )*(/)( )*script( )*>)","</script>",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);
    //result = System.Text.RegularExpressions.Regex.Replace(result,
    //         @"(<script>)([^(<script>\.</script>)])*(</script>)",
    //         string.Empty,
    //         System.Text.RegularExpressions.RegexOptions.IgnoreCase);
    result = System.Text.RegularExpressions.Regex.Replace(result,
             @"(<script>).*(</script>)",string.Empty,
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);

    // remove all styles (prepare first by clearing attributes)
    result = System.Text.RegularExpressions.Regex.Replace(result,
             @"<( )*style([^>])*>","<style>",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);
    result = System.Text.RegularExpressions.Regex.Replace(result,
             @"(<( )*(/)( )*style( )*>)","</style>",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);
    result = System.Text.RegularExpressions.Regex.Replace(result,
             "(<style>).*(</style>)",string.Empty,
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);

    // insert tabs in spaces of <td> tags
    result = System.Text.RegularExpressions.Regex.Replace(result,
             @"<( )*td([^>])*>","\t",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);

    // insert line breaks in places of <BR> and <LI> tags
    result = System.Text.RegularExpressions.Regex.Replace(result,
             @"<( )*br( )*>","\r",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);
    result = System.Text.RegularExpressions.Regex.Replace(result,
             @"<( )*li( )*>","\r",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);

    // insert line paragraphs (double line breaks) in place
    // if <P>, <DIV> and <TR> tags
    result = System.Text.RegularExpressions.Regex.Replace(result,
             @"<( )*div([^>])*>","\r\r",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);
    result = System.Text.RegularExpressions.Regex.Replace(result,
             @"<( )*tr([^>])*>","\r\r",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);
    result = System.Text.RegularExpressions.Regex.Replace(result,
             @"<( )*p([^>])*>","\r\r",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);

    // Remove remaining tags like <a>, links, images,
    // comments etc - anything that's enclosed inside < >
    result = System.Text.RegularExpressions.Regex.Replace(result,
             @"<[^>]*>",string.Empty,
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);

    // replace special characters:
    result = System.Text.RegularExpressions.Regex.Replace(result,
             @" "," ",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);

    result = System.Text.RegularExpressions.Regex.Replace(result,
             @"&bull;"," * ",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);
    result = System.Text.RegularExpressions.Regex.Replace(result,
             @"&lsaquo;","<",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);
    result = System.Text.RegularExpressions.Regex.Replace(result,
             @"&rsaquo;",">",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);
    result = System.Text.RegularExpressions.Regex.Replace(result,
             @"&trade;","(tm)",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);
    result = System.Text.RegularExpressions.Regex.Replace(result,
             @"&frasl;","/",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);
    result = System.Text.RegularExpressions.Regex.Replace(result,
             @"&lt;","<",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);
    result = System.Text.RegularExpressions.Regex.Replace(result,
             @"&gt;",">",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);
    result = System.Text.RegularExpressions.Regex.Replace(result,
             @"&copy;","(c)",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);
    result = System.Text.RegularExpressions.Regex.Replace(result,
             @"&reg;","(r)",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);
    // Remove all others. More can be added, see
    // http://hotwired.lycos.com/webmonkey/reference/special_characters/
    result = System.Text.RegularExpressions.Regex.Replace(result,
             @"&(.{2,6});", string.Empty,
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);

    // for testing
    //System.Text.RegularExpressions.Regex.Replace(result,
    //       this.txtRegex.Text,string.Empty,
    //       System.Text.RegularExpressions.RegexOptions.IgnoreCase);

    // make line breaking consistent
    result = result.Replace("\n", "\r");

    // Remove extra line breaks and tabs:
    // replace over 2 breaks with 2 and over 4 tabs with 4.
    // Prepare first to remove any whitespaces in between
    // the escaped characters and remove redundant tabs in between line breaks
    result = System.Text.RegularExpressions.Regex.Replace(result,
             "(\r)( )+(\r)","\r\r",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);
    result = System.Text.RegularExpressions.Regex.Replace(result,
             "(\t)( )+(\t)","\t\t",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);
    result = System.Text.RegularExpressions.Regex.Replace(result,
             "(\t)( )+(\r)","\t\r",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);
    result = System.Text.RegularExpressions.Regex.Replace(result,
             "(\r)( )+(\t)","\r\t",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);
    // Remove redundant tabs
    result = System.Text.RegularExpressions.Regex.Replace(result,
             "(\r)(\t)+(\r)","\r\r",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);
    // Remove multiple tabs following a line break with just one tab
    result = System.Text.RegularExpressions.Regex.Replace(result,
             "(\r)(\t)+","\r\t",
             System.Text.RegularExpressions.RegexOptions.IgnoreCase);
    // Initial replacement target string for line breaks
    string breaks = "\r\r\r";
    // Initial replacement target string for tabs
    string tabs = "\t\t\t\t\t";
    for (int index=0; index<result.Length; index++)
    {
        result = result.Replace(breaks, "\r\r");
        result = result.Replace(tabs, "\t\t\t\t");
        breaks = breaks + "\r";
        tabs = tabs + "\t";
    }

    // That's it.
    return result;
}
catch
{
    MessageBox.Show("Error");
    return source;
} 
```

}

必须首先删除诸如 \n 和 \r 之类的转义字符，因为它们会导致正则表达式按预期停止工作。

此外，为了使结果字符串在文本框中正确显示，可能需要将其拆分并设置文本框的 Lines 属性，而不是分配给 Text 属性。

**this.txtResult.Lines = StripHTML(this.txtSource.Text).Split("\r".ToCharArray());**

来源：[https ://www.codeproject.com/Articles/11902/Convert-HTML-to-Plain-Text-2](https://www.codeproject.com/Articles/11902/Convert-HTML-to-Plain-Text-2)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-11-13T12:41:31.893

如果您有具有 HTML 标记的数据并且想要显示它以便人们可以看到这些标记，请使用 HttpServerUtility::HtmlEncode。

如果您的数据中包含 HTML 标记，并且您希望用户看到呈现的标记，则按原样显示文本。如果文本代表整个网页，请为其使用 IFRAME。

如果您的数据具有 HTML 标记，并且您想要去除标记并仅显示未格式化的文本，请使用正则表达式。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-11-13T12:46:54.410

取决于您所说的“html”是什么意思。最复杂的情​​况是完整的网页。这也是最容易处理的，因为您可以使用文本模式的网络浏览器。请参阅列出 Web 浏览器（包括文本模式浏览器）的[Wikipedia 文章。](http://en.wikipedia.org/wiki/List_of_web_browsers#Text-based)Lynx 可能是最著名的，但其他之一可能更适合您的需求。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2017-11-03T09:25:30.667

这是我的解决方案：

```
public string StripHTML(string html)
{
    if (string.IsNullOrWhiteSpace(html)) return "";

    // could be stored in static variable
    var regex = new Regex("<[^>]+>|\\s{2}", RegexOptions.IgnoreCase);
    return System.Web.HttpUtility.HtmlDecode(regex.Replace(html, ""));
} 
```

例子：

```
StripHTML("<p class='test' style='color:red;'>Here is my solution:</p>");
// output -> Here is my solution: 
```

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2018-04-29T10:16:07.247

没有写，但使用：

```
using HtmlAgilityPack;
using System;
using System.IO;
using System.Text.RegularExpressions;

namespace foo {
  //small but important modification to class https://github.com/zzzprojects/html-agility-pack/blob/master/src/Samples/Html2Txt/HtmlConvert.cs
  public static class HtmlToText {

    public static string Convert(string path) {
      HtmlDocument doc = new HtmlDocument();
      doc.Load(path);
      return ConvertDoc(doc);
    }

    public static string ConvertHtml(string html) {
      HtmlDocument doc = new HtmlDocument();
      doc.LoadHtml(html);
      return ConvertDoc(doc);
    }

    public static string ConvertDoc(HtmlDocument doc) {
      using (StringWriter sw = new StringWriter()) {
        ConvertTo(doc.DocumentNode, sw);
        sw.Flush();
        return sw.ToString();
      }
    }

    internal static void ConvertContentTo(HtmlNode node, TextWriter outText, PreceedingDomTextInfo textInfo) {
      foreach (HtmlNode subnode in node.ChildNodes) {
        ConvertTo(subnode, outText, textInfo);
      }
    }
    public static void ConvertTo(HtmlNode node, TextWriter outText) {
      ConvertTo(node, outText, new PreceedingDomTextInfo(false));
    }
    internal static void ConvertTo(HtmlNode node, TextWriter outText, PreceedingDomTextInfo textInfo) {
      string html;
      switch (node.NodeType) {
        case HtmlNodeType.Comment:
          // don't output comments
          break;
        case HtmlNodeType.Document:
          ConvertContentTo(node, outText, textInfo);
          break;
        case HtmlNodeType.Text:
          // script and style must not be output
          string parentName = node.ParentNode.Name;
          if ((parentName == "script") || (parentName == "style")) {
            break;
          }
          // get text
          html = ((HtmlTextNode)node).Text;
          // is it in fact a special closing node output as text?
          if (HtmlNode.IsOverlappedClosingElement(html)) {
            break;
          }
          // check the text is meaningful and not a bunch of whitespaces
          if (html.Length == 0) {
            break;
          }
          if (!textInfo.WritePrecedingWhiteSpace || textInfo.LastCharWasSpace) {
            html = html.TrimStart();
            if (html.Length == 0) { break; }
            textInfo.IsFirstTextOfDocWritten.Value = textInfo.WritePrecedingWhiteSpace = true;
          }
          outText.Write(HtmlEntity.DeEntitize(Regex.Replace(html.TrimEnd(), @"\s{2,}", " ")));
          if (textInfo.LastCharWasSpace = char.IsWhiteSpace(html[html.Length - 1])) {
            outText.Write(' ');
          }
          break;
        case HtmlNodeType.Element:
          string endElementString = null;
          bool isInline;
          bool skip = false;
          int listIndex = 0;
          switch (node.Name) {
            case "nav":
              skip = true;
              isInline = false;
              break;
            case "body":
            case "section":
            case "article":
            case "aside":
            case "h1":
            case "h2":
            case "header":
            case "footer":
            case "address":
            case "main":
            case "div":
            case "p": // stylistic - adjust as you tend to use
              if (textInfo.IsFirstTextOfDocWritten) {
                outText.Write("\r\n");
              }
              endElementString = "\r\n";
              isInline = false;
              break;
            case "br":
              outText.Write("\r\n");
              skip = true;
              textInfo.WritePrecedingWhiteSpace = false;
              isInline = true;
              break;
            case "a":
              if (node.Attributes.Contains("href")) {
                string href = node.Attributes["href"].Value.Trim();
                if (node.InnerText.IndexOf(href, StringComparison.InvariantCultureIgnoreCase) == -1) {
                  endElementString = "<" + href + ">";
                }
              }
              isInline = true;
              break;
            case "li":
              if (textInfo.ListIndex > 0) {
                outText.Write("\r\n{0}.\t", textInfo.ListIndex++);
              } else {
                outText.Write("\r\n*\t"); //using '*' as bullet char, with tab after, but whatever you want eg "\t->", if utf-8 0x2022
              }
              isInline = false;
              break;
            case "ol":
              listIndex = 1;
              goto case "ul";
            case "ul": //not handling nested lists any differently at this stage - that is getting close to rendering problems
              endElementString = "\r\n";
              isInline = false;
              break;
            case "img": //inline-block in reality
              if (node.Attributes.Contains("alt")) {
                outText.Write('[' + node.Attributes["alt"].Value);
                endElementString = "]";
              }
              if (node.Attributes.Contains("src")) {
                outText.Write('<' + node.Attributes["src"].Value + '>');
              }
              isInline = true;
              break;
            default:
              isInline = true;
              break;
          }
          if (!skip && node.HasChildNodes) {
            ConvertContentTo(node, outText, isInline ? textInfo : new PreceedingDomTextInfo(textInfo.IsFirstTextOfDocWritten) { ListIndex = listIndex });
          }
          if (endElementString != null) {
            outText.Write(endElementString);
          }
          break;
      }
    }
  }
  internal class PreceedingDomTextInfo {
    public PreceedingDomTextInfo(BoolWrapper isFirstTextOfDocWritten) {
      IsFirstTextOfDocWritten = isFirstTextOfDocWritten;
    }
    public bool WritePrecedingWhiteSpace { get; set; }
    public bool LastCharWasSpace { get; set; }
    public readonly BoolWrapper IsFirstTextOfDocWritten;
    public int ListIndex { get; set; }
  }
  internal class BoolWrapper {
    public BoolWrapper() { }
    public bool Value { get; set; }
    public static implicit operator bool(BoolWrapper boolWrapper) {
      return boolWrapper.Value;
    }
    public static implicit operator BoolWrapper(bool boolWrapper) {
      return new BoolWrapper { Value = boolWrapper };
    }
  }
} 
```

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2019-08-05T08:18:03.180

我认为它有一个简单的答案：

```
public string RemoveHTMLTags(string HTMLCode)
{
    string str=System.Text.RegularExpressions.Regex.Replace(HTMLCode, "<[^>]*>", "");
    return str;
} 
```

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2020-01-24T09:49:26.000

对于任何寻找给定 html 文档的文本缩写的 OP 问题的精确解决方案的人，没有换行符和 HTML 标记，请在下面找到解决方案。

与每个提议的解决方案一样，下面的代码也有一些假设：

*   脚本或样式标签不应包含脚本和样式标签作为脚本的一部分
*   只有主要的内联元素会被内联，没有空格，即`he<span>ll</span>o`应该输出`hello`。内联标签列表：[https ://www.w3schools.com/htmL/html_blocks.asp](https://www.w3schools.com/htmL/html_blocks.asp)

考虑到上述情况，以下带有已编译正则表达式的字符串扩展将输出与 html 转义字符有关的预期纯文本，并在 null 输入上输出 null。

```
public static class StringExtensions
{
    public static string ConvertToPlain(this string html)
    {
        if (html == null)
        {
            return html;
        }

        html = scriptRegex.Replace(html, string.Empty);
        html = inlineTagRegex.Replace(html, string.Empty);
        html = tagRegex.Replace(html, " ");
        html = HttpUtility.HtmlDecode(html);
        html = multiWhitespaceRegex.Replace(html, " ");

        return html.Trim();
    }

    private static readonly Regex inlineTagRegex = new Regex("<\\/?(a|span|sub|sup|b|i|strong|small|big|em|label|q)[^>]*>", RegexOptions.Compiled | RegexOptions.Singleline);
    private static readonly Regex scriptRegex = new Regex("<(script|style)[^>]*?>.*?</\\1>", RegexOptions.Compiled | RegexOptions.Singleline);
    private static readonly Regex tagRegex = new Regex("<[^>]+>", RegexOptions.Compiled | RegexOptions.Singleline);
    private static readonly Regex multiWhitespaceRegex = new Regex("\\s+", RegexOptions.Compiled | RegexOptions.Singleline);
} 
```

* * *

## 回答 #19

> 赞同：-4
> 
> 时间：2008-11-13T12:37:21.230

公共静态字符串 StripTags2(string html) { return html.Replace("<", "<").Replace(">", ">"); }

通过这种方式，您可以转义字符串中的所有“<”和“>”。这是你想要的吗？

# delphi - 如何在 Delphi 2007 中使用 F1 帮助？

> ID：286816
> 
> 赞同：3
> 
> 时间：2008-11-13T12:37:36.270
> 
> 标签：delphi, chm

在我最初使用 Delphi 7 构建的应用程序中，我使用 SPHelpIntegration 代码通过 F1 界面启用 CHM 帮助。我认为这在 Delphi 2007 中不需要，所以我删除了这些单元并构建了我的应用程序。然后我按 F1 并收到一条没有安装帮助界面的消息。在线帮助并没有告诉我很多关于使 F1 帮助工作所需的内容。我必须包括一个单位或其他东西吗？还是我应该继续做有效的事情？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T14:44:10.757

将 HTMLHelpViewer 添加到您的 uses 子句以处理 CHM 文件。使用它们的一个问题是它们必须存在于本地系统（而不是网络共享）上才能正确查看。有一个注册表黑客可以改变这种行为，但我发现在系统本地安装帮助文件更容易。

最近而不是 CHM 文件，我使用[Adob​​e OpenPDFParameters API](http://www.adobe.com/devnet/acrobat/pdfs/PDFOpenParameters.pdf)调用约定将它们直接放入我的印刷手册的 PDF 版本中，跳转到基于当前表单的部分（我获取表单类名称并在我的命名部分中使用它） . 它要求工作站有一个 PDF 阅读器，但现在谁没有呢？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T14:14:36.417

是的，您需要[在 uses 子句中包含帮助查看器](http://www.helpscribble.com/delphi-bcb.html)。

# javascript - 简单的密码 Javascript 代码？

> ID：286824
> 
> 赞同：2
> 
> 时间：2008-11-13T12:44:14.557
> 
> 标签：javascript

我需要一个 Javascript 应用程序，它在运行时会提示输入密码，如果密码正确，脚本会导致网页关闭。如果密码不正确，脚本会提示再次输入密码。

我打算将此脚本加载到我的手机上，它没有受密码保护的钥匙锁功能。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T13:01:19.903

不知道这是否适用于您的手机，但适用于我的浏览器：

```
<head>
<script language="JavaScript">

var pass_entered;
var password="cool";

while (pass_entered!=password) {
    pass_entered=prompt('Please enter the password:','');
}

self.close();

</script>
</head> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-13T21:43:27.743

手机上的Javascript“keylock”可能很容易解决。

无论如何，如果您真的想在 Javascript 中检查密码，您至少可以避免将其以纯文本形式放在页面源代码中。

获取[MD5 JS 实现](http://pajhome.org.uk/crypt/md5/)，然后比较（加盐！）密码哈希值。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T13:00:41.027

好的，我们可以有两种方法。

1.  我们都可以阅读 javascript，因此如果该人实际打开您的代码，他将看到密码。
2.  通过ajax，检查特定页面中的密码。

```
 function passWrdAPI() {
    this.getHX = function() {
        var hx;
        try {
            hx = new XMLHttpRequest();
        }
        catch(e) {
            try {
                hx = new ActiveXObject("Microsoft.XMLHttp");
            }
            catch(ex) {
                hx = new ActiveXObject("Msxml2.XMLHttp");
            }
        }
        return hx;
    }

    this.password = "mypass";
    this.checkPwd = function(pass) {
        if (pass != this.password) {
            // Or close or redirect
            alert('Wrong!');

            window.close(); //or
            location.href = 'http://www.google.com';
        }
    }
    this.checkPwdPage(page, pass) {
        var hx = this.getHX();
        if (hx != null) {
            hx.open('GET',page + "?mypwd=" + pass);
            hx.onreadystatechange = function() {
                if (hx.readyState == 4) {
                    if (hx.responseText == 'false') {
                        // Or close or redirect
                        alert('Wrong!');

                        window.close(); //or
                        location.href = 'http://www.google.com';
                    }
                }           
            }
            hx.send(null);
        }
        else {
            alert('error!');
        }
    }
} 
```

用法：

```
对于第一种方法：

var check = new passWrdAPI();
check.checkPwd(THEPASSENTERED);

 第二个：

var check = new passWrdAPI();
check.checkPwdPage(YOURPAGE, THEPASS);

```

不知道手机能不能用= =

对不起，如果我不帮忙.. 再见！

# c# - 如何引用一个 API 的两个版本？

> ID：286826
> 
> 赞同：7
> 
> 时间：2008-11-13T12:45:22.930
> 
> 标签：c#, sharepoint, reference, sharepoint-api

我需要引用两个不同版本的 Sharepoint API dll。我有一个需要在 Sharepoint 2 和 Sharepoint 3 下运行的 Web 服务，但还需要使用 Sharepoint 3 API 提供的新功能（结帐和内容批准）

实现这一目标的最佳方法是什么 - 我目前倾向于拥有两个项目，两个项目之间共享单个文件中的代码，并使用条件编译编译代码的各个部分。

有没有更好的办法 ？

谢谢

马特

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T15:22:46.983

这就是我吐出针对 WSSv2 API 编译的 .NET 1.1 版本和针对 WSSv3 程序集编译的 .NET 2.0 的方式。它适用于 VS 2005 和 2008。

您将需要使用 MSBEE [http://www.codeplex.com/Wiki/View.aspx?ProjectName=MSBee](http://www.codeplex.com/Wiki/View.aspx?ProjectName=MSBee)

[在 Visual Studio 2008 中使用 .NET 1.1](http://devlicio.us/blogs/ziemowit_skowronski/archive/2008/08/22/working-with-net-1-1-in-visual-studio-2008-and-team-server.aspx)

### 一些技巧

打开 *.csproj 并找出 SharePoint dll 的引用位置并更改为类似这样的内容，这会根据您的目标更改引用的程序集（FX1_1 表示您的目标是 .NET1.1，因此是 WSSv2）

```
<Reference Include="Microsoft.SharePoint">
  <HintPath Condition="'$(TargetFX1_1)'!='true'">pathto\WSS3\Microsoft.SharePoint.dll</HintPath>
  <HintPath Condition="'$(TargetFX1_1)'=='true'">pathto\WSS2\Microsoft.SharePoint.dll</HintPath>
</Reference> 
```

必要时对差异使用条件编译

```
#if FX1_1  
    // WSSv2 specific code  
#else  
    // WSSv3 specific code  
#endif 
```

如果您收到编译器错误但代码看起来正确，则该错误可能仅适用于 .NET1.1 / WSSv2 并且在 .NET2/WSSv3 中编译良好。检查输出选项卡以查看发生错误的目标

您还需要掌握一些 MSBUILD 忍者动作，以保持 1 步构建过程并让自己保持清醒[http://brennan.offwhite.net/blog/2006/11/30/7-steps-to-msbuild/](http://brennan.offwhite.net/blog/2006/11/30/7-steps-to-msbuild/)使用 MSBUILD可以让 VS 同时编译两个版本，而无需借助命令行。

这将在 .NET 完成后运行 .NET1.1 编译并将一些消息输出到“输出”窗口以帮助您找出错误发生的位置。

```
<Target Name="BeforeBuild">
    <Message Text="--- Building for .NET 1.1 ---" Importance="high" Condition="'$(TargetFX1_1)'=='true'" />
    <Message Text="--- Building for .NET 2.0 ---" Importance="high" Condition="'$(TargetFX1_1)'!='true'" />
</Target>
<Target Name="AfterBuild" Condition="'$(TargetFX1_1)'!='true'">
    <MSBuild Projects="$(MSBuildProjectFile)" Properties="TargetFX1_1=true;" />
</Target> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T12:53:18.860

您可以尝试使用“外部别名”。

这是 VB 后期绑定（选项严格关闭）方法运作良好的时期之一。在 C# 4.0 和`dynamic`.

您可以尝试为您需要的位（在基础库中）编写一个接口，并编写 2 个 dll：一个引用每个版本的 sharepoint dll。对于这两个项目，实现接口（抛出`NotSupportedException`你不能做的位），并在运行时加载适当的 dll？（工厂方法）

在你太专注之前用一种方法尝试它......在你知道它适用于最简单的简单方法之前不要做整个事情。

# c# - 没有 VS2005 模板的 Windows 服务

> ID：286835
> 
> 赞同：0
> 
> 时间：2008-11-13T12:50:54.980
> 
> 标签：c#, windows-services

我有VS2005标准版，MS这样说：

> 注意：Windows 服务应用程序项目模板和相关功能在 Visual Basic 和 Visual C# .NET 标准版中不可用...

是否可以在不升级我的 VS2005 标准版的情况下编写 Windows 服务应用程序？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T13:06:12.890

如果你可以剪切和粘贴，一个例子就足够了。

定期记录另一个服务状态的简单服务。该示例不包括[ServiceInstaller 类](http://msdn.microsoft.com/en-us/library/system.serviceprocess.serviceinstaller.aspx)（在安装服务应用程序时由安装实用程序调用），因此安装是手动完成的。

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Diagnostics;
using System.ServiceProcess;
using System.Text;
using System.Timers;

namespace SrvControl
{
    public partial class Service1 : ServiceBase
    {
        Timer mytimer;
        public Service1()
        {
            InitializeComponent();
        }

        protected override void OnStart(string[] args)
        {
            if (mytimer == null)
                mytimer = new Timer(5 * 1000.0);
            mytimer.Elapsed += new ElapsedEventHandler(mytimer_Elapsed);
            mytimer.Start();
        }

        void mytimer_Elapsed(object sender, ElapsedEventArgs e)
        {
            var srv = new ServiceController("MYSERVICE");
            AppLog.Log(string.Format("MYSERVICE Status {0}", srv.Status));
        }

        protected override void OnStop()
        {
            mytimer.Stop();
        }
    }
    public static class AppLog
    {
        public static string z = "SrvControl";
        static EventLog Logger = null;
        public static void Log(string message)
        {
            if (Logger == null)
            {
                if (!(EventLog.SourceExists(z)))
                    EventLog.CreateEventSource(z, "Application");

                Logger = new EventLog("Application");
                Logger.Source = z;
            }
            Logger.WriteEntry(message, EventLogEntryType.Information);
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T12:55:43.940

是的，看这里：

[http://www.codeproject.com/KB/system/WindowsService.aspx](http://www.codeproject.com/KB/system/WindowsService.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T12:57:56.353

当然，您只需要自己编写代码。这实际上并不难。以下是有关如何执行此操作的一些参考：

[http://msdn.microsoft.com/en-us/magazine/cc301845.aspx](http://msdn.microsoft.com/en-us/magazine/cc301845.aspx)

[http://www.aspfree.com/c/a/C-Sharp/Creating-a-Windows-Service-with-C-Sharp-introduction/](http://www.aspfree.com/c/a/C-Sharp/Creating-a-Windows-Service-with-C-Sharp-introduction/)

# ruby-on-rails - 冻结关联对象

> ID：286841
> 
> 赞同：3
> 
> 时间：2008-11-13T12:54:12.180
> 
> 标签：ruby-on-rails, ruby, activerecord

有谁知道 Rails 中可以冻结关联对象的任何方法。我遇到的问题是我有一个包含许多订单项的订单模型，这些订单项又属于产品或服务。订单付款后，我需要冻结订购商品的详细信息，以便在更改价格时保留订单总额。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-11-13T13:41:17.560

我之前在一个在线购买系统上工作过。你想要做的是有一个 Order 类和一个 LineItem 类。LineItems 存储产品详细信息，例如价格、数量，以及可能需要保留的一些其他信息以供记录。它更复杂，但这是我知道锁定细节的唯一方法。

订单仅由 LineItems 组成，并且可能包含送货地址和帐单地址。订单的总价格可以通过将 LineItems 相加来计算。

基本上，您在该人进行购买之前冻结数据。当它们被添加到订单中时，数据会被冻结，因为 LineItems 重复了必要的产品信息。这样，当产品从您的系统中删除时，您仍然可以理解旧订单。

您可能想查看一个名为“AASM”的 rails 插件（以前充当状态机）来处理订单的状态。

编辑：AASM 可以在这里找到 http://github.com/rubyist/aasm/tree/master

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-14T09:41:11.197

几个选项：

1) **为您的模型添加版本号。** 在日常工作中，我们会安排课程。特定课程可能会偶尔更新，但出于业务规则的原因，了解它在您注册当天的样子很重要。添加`:version_number`到模型和`find_latest_course(course_id)`，根据需要更改代码，搅拌一下。在这种情况下，您不必“编辑”模型，而是对新的更新版本进行新的保存。（那么，很明显，您的 LineItems 带有 a`item_id`和 an `item_version_number`。）

这种通用模式可以扩展到覆盖、颤抖、审计跟踪。

2） 在**创建时****将数据复制到`LineItem`对象中`LineItem`**。仅仅因为你可以拍`has_a`任何东西，并不意味着你应该。如果“LineItem”应该保持发票上出现的一项的恒定记录，则`LineItem`保持发票上出现的一项的恒定记录。然后您可以随意更新`InventoryItem#current_price`，而不会影响您之前保存的`LineItems`.

3） **如果你很懒惰，只需冻结订单对象上的价格。** 不是很推荐这个，但是，嘿，它在紧要关头起作用。不过，您可能只是在推迟清算的日子。

*“我6个月前从你那里订购的，现在正在报税。为什么你的书店不给我一半我订购的书？你的意思是，当你停止销售它们时，他们的ID被清除了？！我需要知道哪个我可以扣分！”*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T13:44:10.893

当商品添加到订单中时，价格不应该已经被冻结了吗？假设我将一个小部件放入我的购物篮，认为它的价格为 1 美元，而当我在收银台时，它的价格为 5 美元，因为您更改了价格。

回到您的问题：我认为这不是语言问题，而是功能问题。您需要复制价格，而不是将价格与项目相关联。如果订单中的每件商品都有自己的价格版本，未来的价格变化不会影响它，您可以添加折扣等。

实际上，要干净，您需要在价格中添加版本控制。当一个项目的价格发生变化时，您不会覆盖价格，而是添加一个更新的版本。您订单中的订单项仍将与旧价格相关联。

# java - Describe the architecture you use for Java web applications?

> ID：286846
> 
> 赞同：148
> 
> 时间：2008-11-13T12:55:32.957
> 
> 标签：java, architecture, jakarta-ee

**Let's share Java based web application architectures!**

There are lots of different architectures for web applications which are to be implemented using Java. The answers to this question may serve as a library of various web application designs with their pros and cons. While I realize that the answers will be subjective, let's try to be as objective as we can and motivate the pros and cons we list.

Use the detail level you prefer for describing your architecture. For your answer to be of any value you'll at least have to describe the major technologies and ideas used in the architecture you describe. And last but not least, *when* should we use your architecture?

I'll start...

* * *

# Overview of the architecture

We use a 3-tier architecture based on open standards from Sun like Java EE, Java Persistence API, Servlet and Java Server Pages.

*   Persistence
*   Business
*   Presentation

The possible communication flows between the layers are represented by:

```
Persistence <-> Business <-> Presentation 
```

Which for example means that the presentation layer never calls or performs persistence operations, it always does it through the business layer. This architecture is meant to fulfill the demands of a high availability web application.

## Persistence

Performs create, read, update and delete ([CRUD](http://en.wikipedia.org/wiki/Create,_read,_update_and_delete)) persistence operations. In our case we are using ([Java Persistence API](http://java.sun.com/javaee/technologies/persistence.jsp)) JPA and we currently use [Hibernate](http://www.hibernate.org/) as our persistence provider and use [its EntityManager](http://www.hibernate.org/397.html).

This layer is divided into multiple classes, where each class deals with a certain type of entities (i.e. entities related to a shopping cart might get handled by a single persistence class) and is *used* by one and only one *manager*.

In addition this layer also stores [JPA entities](http://en.wikipedia.org/wiki/Java_Persistence_API#Entities) which are things like `Account`, `ShoppingCart` etc.

## Business

All logic which is tied to the web application functionality is located in this layer. This functionality could be initiating a money transfer for a customer who wants to pay for a product on-line using her/his credit card. It could just as well be creating a new user, deleting a user or calculating the outcome of a battle in a web based game.

This layer is divided into multiple classes and each of these classes is annotated with `@Stateless` to become a [Stateless Session Bean](http://en.wikipedia.org/wiki/Session_Beans) (SLSB). Each SLSB is called a *manager* and for instance a manager could be a class annotated as mentioned called `AccountManager`.

When `AccountManager` needs to perform CRUD operations it makes the appropriate calls to an instance of `AccountManagerPersistence`, which is a class in the persistence layer. A rough sketch of two methods in `AccountManager` could be:

```
...
public void makeExpiredAccountsInactive() {
    AccountManagerPersistence amp = new AccountManagerPersistence(...)
    // Calls persistence layer
    List<Account> expiredAccounts = amp.getAllExpiredAccounts();
    for(Account account : expiredAccounts) {
        this.makeAccountInactive(account)
    }
}
public void makeAccountInactive(Account account) {
    AccountManagerPersistence amp = new AccountManagerPersistence(...)
    account.deactivate();
    amp.storeUpdatedAccount(account); // Calls persistence layer
} 
```

We use [container manager transactions](http://java.sun.com/javaee/5/docs/tutorial/doc/bncij.html) so we don't have to do transaction demarcation our self's. What basically happens under the hood is we initiate a transaction when entering the SLSB method and commit it (or rollback it) immediately before exiting the method. It's an example of convention over configuration, but we haven't had a need for anything but the default, Required, yet.

Here is how The Java EE 5 Tutorial from Sun explains the [Required transaction attribute](http://java.sun.com/javaee/5/docs/tutorial/doc/bncij.html) for Enterprise JavaBeans (EJB's):

> If the client is running within a transaction and invokes the enterprise bean’s method, the method executes within the client’s transaction. If the client is not associated with a transaction, the container starts a new transaction before running the method.
> 
> The Required attribute is the implicit transaction attribute for all enterprise bean methods running with container-managed transaction demarcation. You typically do not set the Required attribute unless you need to override another transaction attribute. Because transaction attributes are declarative, you can easily change them later.

## Presentation

Our presentation layer is in charge of... presentation! It's responsible for the user interface and shows information to the user by building HTML pages and receiving user input through GET and POST requests. We are currently using the old [Servlet](http://java.sun.com/products/servlet/)'s + Java Server Pages ([JSP](http://java.sun.com/products/jsp/)) combination.

The layer calls methods in *managers* of the business layer to perform operations requested by the user and to receive information to show in the web page. Sometimes the information received from the business layer are less complex types as `String`'s and `int`egers, and at other times [JPA entities](http://en.wikipedia.org/wiki/Java_Persistence_API#Entities).

# Pros and cons with the architecture

## Pros

*   Having everything related to a specific way of doing persistence in this layer only means we can swap from using JPA into something else, without having to re-write anything in the business layer.
*   It's easy for us to swap our presentation layer into something else, and it's likely that we will if we find something better.
*   Letting the EJB container manage transaction boundaries is nice.
*   Using Servlet's + JPA is easy (to begin with) and the technologies are widely used and implemented in lots of servers.
*   Using Java EE is supposed to make it easier for us to create a high availability system with [load balancing](http://en.wikipedia.org/wiki/Load_balancing_(computing)) and [fail over](http://en.wikipedia.org/wiki/Failover). Both of which we feel that we must have.

## Cons

*   Using JPA you may store often used queries as named queries by using the `@NamedQuery` annotation on the JPA entity class. If you have as much as possible related to persistence in the persistence classes, as in our architecture, this will spread out the locations where you may find queries to include the JPA entities as well. It will be harder to overview persistence operations and thus harder to maintain.
*   We have JPA entities as part of our persistence layer. But `Account` and `ShoppingCart`, aren't they really business objects? It is done this way as you have to touch these classes and turn them into entities which JPA knows how to handle.
*   The JPA entities, which are also our business objects, are created like Data Transfer Objects ([DTO](http://en.wikipedia.org/wiki/Data_Transfer_Object)'s), also known as Value Objects (VO's). This results in an [anemic domain model](http://en.wikipedia.org/wiki/Anemic_Domain_Model) as the business objects have no logic of their own except accessor methods. All logic is done by our managers in the business layer, which results in a more procedural programming style. It's not good object oriented design, but maybe that's not a problem? (After all object orientation isn't the only programming paradigm which has delivered results.)
*   Using EJB and Java EE introduces a bit of complexity. And we can't use purely Tomcat (adding an EJB micro-container isn't *purely* Tomcat).
*   There are lots of issues with using Servlet's + JPA. Use Google for more information about these issues.
*   As the transactions are closed when exiting the business layer we can't load any information from JPA entities which is configured to be loaded from the database when it's needed (using `fetch=FetchType.LAZY`) from inside the presentation layer. It will trigger an exception. Before returning an entity containing these kinds of fields we have to be sure to call the relevant getter's. Another option is to use Java Persistence Query Language ([JPQL](http://java.sun.com/javaee/5/docs/tutorial/doc/bnbtg.html)) and do a `FETCH JOIN`. However both of these options are a little bit cumbersome.

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-13T13:24:36.347

Ok I'll do a (shorter) one:

*   Frontend : [Tapestry](https://tapestry.apache.org/index.html) (3 for older projects, 5 for newer projects)
*   Business layer: Spring
*   DAO's : Ibatis
*   Database : Oracle

We use Sping transaction support, and start transactions upon entering the service layer, propagating down to the DAO call's. The Service layer has the most bussines model knowledge, and the DAO's do relatively simple CRUD work.

Some more complicated query stuff is handled by more complicated queries in the backend for performance reasons.

Advantages of using Spring in our case is that we can have country/language dependant instances, which are behind a Spring Proxy class. Based on the user in the session, the correct country/language implementation is used when doing a call.

Transaction management is nearly transparent, rollback on runtime exceptions. We use unchecked exceptions as much as possible. We used to do checked exceptions, but with the introduction of Spring I see the benefits of unchecked exceptions, only handling exceptions when you can. It avoids a lot of boilerplate "catch/rethrow" or "throws" stuff.

Sorry it's shorter than your post, hope you find this interesting...

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2011-08-22T12:08:54.447

**Ideal Java Based Web Development Technologies Today.**

# Web Layer :

HTML+CSS+Ajax+JQuery

# RESTFul Web Controller/Action/Request Processing Layer :

Play Framework

# Business Logic/Service Layer:

Use Pure Java Code as long as possible. One can do fusion of web services here.

# XML/JSon Data Transformation Layer :

XMLTool(Search On Google Code),JSoup,Google GSon,XStream,JOOX (Search On Google Code)

# Persistence Layer :

CRUD : JPA or SienaProject or QueryDSL / Complex Queries : JOOQ,QueryDSL

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2014-07-06T15:30:30.463

Here's my 5 cents

## Presentation

Android, Angular.JS WebClient, OAUTHv2

## API

REST, Jersey (JAX-RS), Jackson (JSON de-/serialisation), DTO-objects (different from business logic models)

## Business Logic

Spring for DI and Event handling. DDD-ish approach of model objects. Longer running jobs are offloaded with SQS in worker-modules.

## DAO

Repository model with Spring JDBC-templates to store Entities. Redis (JEDIS) for Leaderboards, using Ordered Lists. Memcache for Token Store.

## Database

MySQL, Memcached, Redis

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2015-09-28T11:38:40.860

What we have followed in our project is :

**Front end Technology**

*   AngularJS
*   HTML5
*   css3
*   Javascript
*   Bootstrap 3

**API**

1.  REST
2.  JERSEY (JAX-RS)
3.  REST ASSURED
4.  SPRING BOOT
5.  Jackson
6.  spring security

**Business Logic**

*   SPRING DATA

*   SPRING data MongoDB

**Data base**

*   MongoDB

**Server (For caching)**

*   redis

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-17T16:37:05.517

We are still using the usual Struts-Spring-Hibernate stack.

For future apps, we are looking into Spring Web Flow + Spring MVC + Hibernate or Spring + Hibernate + Web Services with Flex front end.

A distinct characteristic of our architecture is modularization. We have a number of modules, some starting with 3 to max 30 tables in the database. Most of modules consist of business and web project. Business project holds business and persistence logic while web holds presentation logic.
On logical level, there are three layers: Business, Persistence and Presentation.
Dependencies:
Presentation depends on Business and Persistence.
Persistence depends on Business.
Business does not depend on other layers.

Most of business projects have three types of interfaces (note: not GUI, it is a programatic java interface layer).

1.  Interface that presentation is using as a client
2.  Interface that other modules are using when they are the client of the module.
3.  Interface that can be used for administrative purposes of the module.

Often, 1 extends 2. This way, it is easy to replace one implementation of module with another. This helps us adopt to different clients and integrate more easily. Some clients will buy only certain modules and we need to integrate functionality they already have. Since interface and implementation layer are separated, it is easy to roll out ad-hock module implementation for that specific client without affecting dependant modules. And Spring Framework makes it easy to inject different implementation.

Our business layer is based on POJOs. One tendency I am observing is that these POJOs resemble DTOs. We suffer from [anaemic domain model](http://martinfowler.com/bliki/AnemicDomainModel.html). I am not quite sure why is this happening but it can be due to simplicity of problem domain of many of our modules, most of the work is CRUD or due to developers preferring to place logic somewhere else.

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-11-02T18:17:32.213

**Here is one more web architecture I have worked on:**

> One major requirement was the application should support mobiles/other devices. The application should also be extensible or flexible to changes in technology choices.

**Presentation Tier:**

*   JSP/JQuery (Client-side MVC)
*   Native Android
*   Native iPhone
*   Mobile web (HTML5/CSS3/Responsive design)

*   Spring REST Controllers (Can change to JAX-RS)

**Business Service Tier:**

Spring @Service (Can change to Stateless EJB)

**Data Access Tier:**

Spring @Repository (Can change to Stateless EJB)

**Resource Tier:**

Hibernate(JPA) entities (Can change to any ORM)

You can find more information on the book which follows this architecture [here](http://amritendude.blogspot.in/2014/06/new-book-on-spring-4-and-hibernate-4.html).

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-08-28T11:42:46.670

IMHO, most of us have a common denominator. Atleast in the back-end, we have some form of IOC/DI container and a persistence framework. Personally I use Guice and Mybatis for this. The differences are in how we implement the view/UI/presentation layer. There are 2 major options here (may be more) .. Action based (URLs mapped to controllers) and component based. Currently am using component based presentation layer (using wicket). It perfectly mimics a desktop environment where I use components and events as opposed to URLs and controllers. Am currently looking for a reason why I should migrate to this URL-controller kind of architecture (that's how I ended up on this page). Why the hype about RESTful and Stateless architectures.

To answer this question in short: I write stateful web applications using a component oriented framework on top of Guice IOC container and put data in relational database using Mybatis.

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-06-02T20:14:18.697

A bit different, and I would claim more modular java architecture here. We have:

1.  Spring WS/Rest/JSP front end
2.  Spring MVC for business service logic, containing presentation layer logic as well as Spring transactions
3.  Component service communication interface, looked up through EJB by business services. EJBs set their own transaction boundaries that are able to join Spring transactions.
4.  Component service implementations, again Spring components
5.  Integration layer, MyBatis for database integrations, Spring WS for web service integrations, other integration techonologies for other services
6.  Mainframes, databases, other services at other servers...

In addition to the above, we have the shared library modules which is common functionality provider for all srevices.

Use of different layers allows us full decoupling and the modularity we need. We are also able to fully utilize the power of Java EE as well as Spring. Nothing prevents us from using JSF, for example, for the front end if needed.

Compared to example architecture by OP, I think this can be described as having four main layers instead of three, albeit with a twist.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-08-22T12:41:52.887

I've worked on projects that use that rigid manager pattern. Historically, I was a huge proponent of the rigid hierarchy where everything fit into a neat box. As I progress in my career I find it to be forced in a lot of cases. I believe that adopting a more agile mindset towards application design leads to a better product. What I mean by this creating a set of classes that solve the problem at hand. Rather than saying "Did you build a manager for this and that?"

The current project I'm working on is a web app with a combination of Spring MVC and RestEasy JSON/Ajax calls. On the server side embedded in our controllers is a sensible facade based data tier with JPA/Hibernate for direct Database access, some EJB access, and some SOAP based web service calls. Tying all this together is some custom java controller code that determines what to serialize as JSON and return to the client.

We spend almost no time attempting to create some unified pattern instead opting to adopt the "Worse is Better" idea of the Unix Design Philosophy. Being that its much better to color outside the lines and build something sensible, quickly than it is to build something that adheres to a bunch of strict design mandates.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-09-14T16:36:05.437

The components in [Web Application Architecture](https://www.google.com.vn/search?q=Java%20Web%20Application%20Architecture&client=firefox-a&rls=org.mozilla:vi:official&channel=fflb&biw=1366&bih=631&source=lnms&tbm=isch&sa=X&ei=fMMVVKCUBsfj8AXruoGABg&ved=0CAYQ_AUoAQ) include :

1 : Browser : Client interaction

```
 HTML
        JavaScript
        Stylesheet 
```

2 : Internet

3 : Webserver

```
 CSS
        Image
        Pages(Java render ) 
```

4 : Application Server

```
 App Webapp (Java interaction)
        Others WebApps 
```

5 : Database Server

```
 Oracle, SQL, MySQL 
```

6 : Data

# java - Jetlang PoolFiber 样本

> ID：286848
> 
> 赞同：1
> 
> 时间：2008-11-13T12:55:58.807
> 
> 标签：java, concurrency

我从[jetlang](http://code.google.com/p/jetlang/)开始，基本示例非常清晰。我没有找到使用 PoolFiber 的好示例。有人玩过吗？我还阅读了 retlang 示例，但那里似乎有点不同。

感谢您分享您的想法！

大神

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-11-23T05:27:44.853

使用 PoolFiber 和 ThreadFiber 几乎相同。唯一的区别是线程池需要初始化并用于创建每个 PoolFiber。

```
// create java thread pool.
ExecutorService pool = Executors.newCachedThreadPool();
//initialize factory with backing pool
PoolFiberFactory fiberFactory = new PoolFiberFactory(pool);
Fiber fiber = fiberFactory.create();
fiber.start();
//use fiber for normal publishing and subscribing. 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-04-05T08:15:57.667

这是在 Github 上。

[https://github.com/jetlang/jetlang/blob/readme/src/test/java/org/jetlang/examples/BasicExamples.java](https://github.com/jetlang/jetlang/blob/readme/src/test/java/org/jetlang/examples/BasicExamples.java)

这是 mvn 网站 [http://jetlang.github.io/jetlang/](http://jetlang.github.io/jetlang/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-05-22T08:48:30.380

## 比 Cache 更好的池是涉及与 JVM 相关的 CPU 核心数量：

```
int availableProcessors = Runtime.getRuntime().availableProcessors();
int threadPoolSize = availableProcessors*2;
ThreadPoolExecutor POOL = new ThreadPoolExecutor(threadPoolSize,
    threadPoolSize, 0L, TimeUnit.MILLISECONDS,  
    new LinkedBlockingQueue<Runnable>());
PoolFiberFactory fiberFactory = new PoolFiberFactory(POOL); 
```

* * *

# vb.net - vb.net - 函数和任意类型的泛型

> ID：286849
> 
> 赞同：1
> 
> 时间：2008-11-13T12:56:36.683
> 
> 标签：vb.net, generics

有没有办法在 vb.net 中创建一个接受任意类型泛型的函数/子签名。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T13:04:24.670

就像这样：

```
Public Function DoThing(Of T)(ByVal value As T) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-26T18:46:17.630

您可以在此处阅读有关 Visual Basic 中的泛型类型[http://msdn.microsoft.com/en-us/library/w256ka79.aspx](http://msdn.microsoft.com/en-us/library/w256ka79.aspx)

# c# - 从设计模式本地化 Winforms？

> ID：286850
> 
> 赞同：0
> 
> 时间：2008-11-13T12:57:01.113
> 
> 标签：c#, winforms, localization

我需要将工具条中的标签或项目绑定到设计模式中的变量。我不使用内置资源而不是设置，因此数据部分没有用。我从映射到类的 XML 中取出值。

我知道有很多程序，例如： [http](http://www.jollans.com/tiki/tiki-index.php?page=MultilangVsNetQuickTourForms) ://www.jollans.com/tiki/tiki-index.php?page= MultilangVsNetQuickTourForms 但它们适用于已编译的 resx。我想使用未编译的 XML。

我知道以编程方式我可以做到，我创建了一个方法（例如，UpdateUI()），并在那里分配新值，如下所示：this.tsBtn.Text=Class.Texts.tsBtnText;

我想要一些我可以从设计模式或比当前更优化的方式做的事情。是否有任何自定义控件或扩展？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T13:40:12.883

Aleksandar 的回应是实现这一目标的一种方式，但从长远来看，这将非常耗时，并且不会真正带来太多好处。应该问的更大的问题是，为什么您不想使用 .NET 和 Visual Studio 内置的工具和功能，或者至少使用商业第三方工具？听起来您正在花费（已经花费？）很多时间来解决已经解决的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T13:19:32.817

尝试继承基本的胜利控件并覆盖 OnPaint 方法。下面的示例是一个按钮，其文本设置取决于其 Tag 属性中包含的值（假设您将使用 Tag 属性设置将用于读取匹配资源的键）。然后你可以找到一些方法从 xml 文件中读取所有缓存资源字符串（例如虚构的 MyGlobalResources 类。

```
public class LocalizedButton : Button
{
    protected override void OnPaint(PaintEventArgs pevent)
    {
        base.OnPaint(pevent);
        this.Text = MyGlobalResources.GetItem(this.Tag.ToString());
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-06T09:33:14.537

您可以使用附属程序集进行本地化，并使用您的 XML 文件作为已翻译实体的源来生成它们。更多关于卫星[http://msdn.microsoft.com/en-us/library/21a15yht(VS.71).aspx](http://msdn.microsoft.com/en-us/library/21a15yht(VS.71).aspx)

确保它不是来自设计模式，但是在您的限制下无法这样做。

# ssis - 如何有选择地加载 Excel 文件？

> ID：286851
> 
> 赞同：0
> 
> 时间：2008-11-13T12:57:42.220
> 
> 标签：ssis

我有一个 SSIS 包，它需要查找两种不同类型的 Excel 文件，类型 A 和类型 B，并将其中的数据加载到两个不同的暂存表 tableA 和 tableB。这些excel表格的格式不同，它们与各自的表格相匹配。

为了简单起见，我曾考虑将 typeA.xls 和 typeB.xls 放在两个不同的文件夹中（文件夹路径可配置）。然后将通过其他应用程序或手动将所需的 excel 文件放在这里。

我想要的是能够让我的 dtsx 包扫描文件夹并选择最新的未处理文件并加载它而忽略其他文件，然后用'-loaded'（typeAxxxxxx-loaded.xls）对文件名进行后缀。文件名中的“-loaded”是我计划如何区分已经加载的文件和尚未加载的文件。

我需要以下方面的建议：

a）如何检查最新文件的配置文件夹，即。文件名中没有“-loaded”并加载它？..然后在加载它之后，在配置的文件夹中重命名相同的文件，并带有'-loaded'后缀。

b）这是最好的方法还是有更好的方法？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-14T08:15:06.813

您可以这样做，但它可能需要几个复杂的字符串表达式。

例如，在 .xls 文件上创建一个 ForEach 循环，在循环内添加一个空脚本任务，然后是一个数据流来加载这个文件。将它们与优先约束连接并使其成为条件：优先约束表达式将检查文件名是否不以 -loaded.xls 结尾。您可以在脚本任务中执行此操作，也可以在优先约束上纯粹使用 SSIS 表达式。最后，添加文件系统任务以重命名文件。您可能需要使用另一个表达式构建新文件名。

创建两个文件夹可能更容易：新的未处理文件的传入和已处理的文件的加载，处理后只需将 .xls 移动到此文件夹而不重命名。这将避免第一个条件表达式（和虚拟脚本任务），并简化文件系统任务的配置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-30T20:55:33.417

您可以获取 SQL 文件观察任务并将其添加到您的 SSIS。我认为这是一种更清洁的方式来做你想做的事。

[SQL 文件观察器](http://www.sqlis.com/post/File-Watcher-Task.aspx)

# blackberry - 使用 MIDlet.platformRequest() 打开文件

> ID：286855
> 
> 赞同：3
> 
> 时间：2008-11-13T13:00:18.190
> 
> 标签：blackberry, java-me, midlet

是否可以让设备使用该方法打开磁盘上的文件`MIDlet.platformRequest(String url)`？我希望使用以下内容：

```
midlet.platformRequest("file:///path/to/file/file.png"); 
```

但这只会引发`ConnectionNotFoun`d 异常。我专门使用 BlackBerry 平台，但**无法**访问专有的 BlackBerry API。文件可以是任何类型，所以显然我不希望它处理每一个。

干杯

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-15T08:22:03.663

不，不能使用平台请求打开任意文件。MIDP 2.0 要求设备仅支持 URL 和 tel: 连接的平台请求。所有其他方案都是可选的并且取决于设备。

[正如诺基亚论坛](http://www.forum.nokia.com/document/Java_ME_Developers_Library/?content=GUID-EBB4BC93-74A5-48E6-88BD-A9164079DD9F.html)中指出的那样，诺基亚 S60 手机似乎支持 file:// 。但是您需要针对包括黑莓在内的其他平台进行验证。

您可以查看[JSR211 Content Handler API](http://www.j2ee.me/javame/reference/apis/jsr211/)作为替代方案。我相信它在较新的黑莓设备中得到支持。

# c++ - 反向偏移标记器

> ID：286864
> 
> 赞同：1
> 
> 时间：2008-11-13T13:06:15.447
> 
> 标签：c++, boost, tokenize

我有一个要标记的字符串。它的形式是`HHmmssff`, `H`, `m`,`s`是`f`数字。

它应该被标记为四个 2 位数字，但我需要它也接受速记形式，就像`sff`它解释为`00000sff`. 我想使用`boost::tokenizer`'s`offset_separator`但它似乎只适用于正偏移量，我想让它向后工作。

好的，一个想法是从左边用零填充字符串，但也许社区想出了一些*超级*智能的东西。;)

**编辑：** *其他要求刚刚开始发挥作用。*

更智能的解决方案的基本需求是处理所有情况，如`f`, `ssff`,`mssff`等，但也接受更完整的时间符号，`HH:mm:ss:ff`如其速记形式，例如`s:ff`，甚至`s:`（这应该被解释为`s:00`）。

在字符串以结尾的情况下，`:`我显然也可以用两个零填充它，然后去掉所有分隔符，只留下数字并用精神解析结果字符串。

`int`但是，如果有一种方法可以使偏移标记器从字符串的末尾返回（偏移量 -2、-4、-6、-8）并将数字转换为s ，这似乎会更简单一些。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T13:56:25.080

我一直在宣扬 BNF 符号。如果您可以写下定义问题的语法，您可以轻松地将其转换为 Boost.Spirit 解析器，它会为您完成。

```
TimeString := LongNotation | ShortNotation

LongNotation := Hours Minutes Seconds Fractions

Hours := digit digit
Minutes := digit digit
Seconds := digit digit
Fraction := digit digit

ShortNotation := ShortSeconds Fraction
ShortSeconds := digit 
```

编辑：附加约束

```
VerboseNotation = [ [ [ Hours ':' ] Minutes ':' ] Seconds ':' ]  Fraction 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T14:20:26.920

回应评论“不意味着要成为性能怪胎，但此解决方案涉及一些字符串复制（输入是 const & std::string）”。

如果您真的非常关心性能以至于不能使用像正则表达式这样的大型旧库，则不会冒险使用 BNF 解析器，也不想假设 std::string::substr 会避免使用分配的副本（因此不能使用 STL 字符串函数），甚至不能将字符串字符复制到缓冲区和带有 '0' 字符的左填充：

```
void parse(const string &s) {
    string::const_iterator current = s.begin();
    int HH = 0;
    int mm = 0;
    int ss = 0;
    int ff = 0;
    switch(s.size()) {
        case 8:
            HH = (*(current++) - '0') * 10;
        case 7:
            HH += (*(current++) - '0');
        case 6:
            mm = (*(current++) - '0') * 10;
        // ... you get the idea.
        case 1:
            ff += (*current - '0');
        case 0: break;
        default: throw logic_error("invalid date");
        // except that this code goes so badly wrong if the input isn't
        // valid that there's not much point objecting to the length...
   }
} 
```

但从根本上说，仅 0 初始化这些 int 变量几乎与将字符串复制到带有填充的 char 缓冲区一样多，因此我不希望看到任何显着的性能差异。因此，我实际上并不在现实生活中推荐这种解决方案，只是作为过早优化的练习。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T13:56:56.173

正则表达式浮现在脑海。`"^0*?(\\d?\\d?)(\\d?\\d?)(\\d?\\d?)(\\d?\\d?)$"`类似的东西`boost::regex`。子匹配将为您提供数字值。采用数字之间带有冒号的其他格式应该不难（请参阅 sep61.myopenid.com 的答案）。`boost::regex`是最快的正则表达式解析器之一。

# java - 带有 FDF 的 Java PDF 查看器

> ID：286867
> 
> 赞同：4
> 
> 时间：2008-11-13T13:07:35.633
> 
> 标签：java, pdf

我的公司需要一个带有 Java API 的 PDF 查看器，并且还需要能够使用 FDF 表单数据。

我发现的唯一一个是[JPedal](http://www.jpedal.org/index.php)，它承诺提供我们需要的一切，但它要花很多钱。那么我的选择是什么？有没有其他工具可以做到这一点？

编辑：

我发现[iText](http://www.lowagie.com/iText/)是一种将 FDF 数据合并到 PDF 表单中的简单方法。

唯一可以正常工作的 LGPL 查看器（与*Adob* ​​e 自己 10 年前的 Java 1.1 API 不同）是 Sun 的[pdf-renderer](https://pdf-renderer.dev.java.net/)。但遗憾的是它不显示表单值。iText 的表单扁平化有帮助，但必须有更好的方法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-21T15:38:58.803

看看 Foxit SDK。[http://www.foxitsoftware.com/](http://www.foxitsoftware.com/)成本似乎少了一点，我相信你会得到更多。

也许 Open Office 有适合您的东西？

我也刚刚找到了那些：

[http://www.crionics.com/](http://www.crionics.com/)

[http://www.qoppa.com/](http://www.qoppa.com/)

[http://multivalent.sourceforge.net/](http://multivalent.sourceforge.net/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-15T15:38:41.030

试试 Big Faceless 的 Java 查看器：http: [//big.faceless.org/products/pdfviewer/](http://big.faceless.org/products/pdfviewer/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T16:07:44.037

[http://www.accesspdf.com/pdftk/](http://www.accesspdf.com/pdftk/)（如果你想找到你正在寻找的东西，你可能需要在里面挖一点，但我想你会找到的）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-21T15:02:15.257

一年前，我正在寻找类似的东西，但找不到任何有用的东西，所以最终调用了 acrobat reader（这当然只是一种解决方法）。感谢您在问题中提及 pdf-renderer（该项目一年前不存在，至少我无法找到它）。

# http - 后台大文件下载，从浏览器启动

> ID：286870
> 
> 赞同：1
> 
> 时间：2008-11-13T13:09:56.720
> 
> 标签：http, ftp, download

是否有任何合理的方法可以让 webapp 的用户下载大文件？我正在寻找浏览器内置下载对话框以外的其他内容 - 要求是用户从浏览器启动下载，然后其他一些应用程序接管，在后台下载文件并且在浏览器运行时不退出关闭。它可能在 http、ftp 甚至 bittorrent 上工作。平台独立性将是一件好事，但我最关心的是 Windows。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T13:15:09.033

这可能适用于 BitTorrent。它使用单独的程序（在大多数浏览器中）工作，并且在浏览器关闭后仍会运行。不是完美匹配，但可以满足您的大部分需求。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T14:59:03.910

也许[BITS](http://msdn.microsoft.com/en-us/library/bb968799(VS.85).aspx)适合你？

> 后台智能传输服务目的
> 
> 后台智能传输服务 (BITS) 在客户端和服务器之间传输文件（下载或上传），并提供与传输相关的进度信息。您还可以从对等点下载文件。
> 
> 适用的地方
> 
> 将 BITS 用于需要：
> 
> 在前台或后台异步传输文件。保持其他网络应用程序的响应能力。在网络断开和计算机重新启动后自动恢复文件传输。开发者受众
> 
> BITS 专为 C 和 C++ 开发人员设计。

仅限 Windows

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T13:14:36.133

看看这个： http: [//msdn.microsoft.com/en-us/library/aa753618 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa753618(VS.85).aspx)

虽然它只适用于 IE。

另一种方法是为 IE 编写一个 BandObject，它连接所有链接并启动您的应用程序。 [http://www.codeproject.com/KB/shell/dotnetbandobjects.aspx](http://www.codeproject.com/KB/shell/dotnetbandobjects.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T13:23:55.270

试试[freeDownloadManager](http://www.freedownloadmanager.org)。它确实与 IE 和 Firefox 集成。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T15:37:13.833

根据文件的大小，几乎所有的网络浏览器都有内置的下载管理器。只要放一个文件的链接，当用户点击时，浏览器就会接管。你可以简单地推荐人们安装一个下载文件之前的下载管理器，链接到推荐的 Windows/Linux/OS X 的免费客户端。

根据文件的大小，可以选择 Bittorrent。`.torrent`当人们在独立于浏览器的单独下载客户端中打开文件时，您将提供一个文件。

有一些缺点，主要取决于您的目标受众：

*   公司或学校网络很少允许使用 Bittorrent
*   它可能很难使用（因为它对很多人来说是一个新概念）.. 例如，如果有人没有安装 torrent 客户端，他们会得到一个无法打开的小文件，这可能会令人困惑
*   NAT/端口转发/防火墙的问题很常见
*   您必须使用运行种子跟踪器，并为文件播种

...但是，也有好处 - 主要是减少服务器上的带宽使用，因为人们下载文件时也会播种。

# windows - HTML 的输入 type="password" 的 Windows 批处理等效项是什么？

> ID：286871
> 
> 赞同：11
> 
> 时间：2008-11-13T13:12:02.457
> 
> 标签：windows, batch-file, passwords, cmd

我需要从 Windows 脚本中的用户那里获取身份验证凭据，但是经典的“第一个 Google 结果”方法：

```
SET /P USR=Username: 
SET /P PWD=Password: 
```

不太令人满意，所以我想知道是否可以说**HTML 的输入 type="password" 的“等价物”**？

任何评论将不胜感激，在此先感谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-21T00:21:09.170

看看这个

[http://www.netikka.net/tsneti/info/tscmd052.htm](http://www.netikka.net/tsneti/info/tscmd052.htm)

```
@echo off & setlocal enableextensions
    :: Build a Visual Basic Script
    set vbs_=%temp%\tmp$$$.vbs
    set skip=
    findstr "'%skip%VBS" "%~f0" > "%vbs_%"
    ::
    :: Prompting without linefeed as in Item #15
    echo.|set /p="Password: "

    :: Run the script with Microsoft Windows Script Host Version 5.6
    for /f "tokens=* delims=" %%a in ('cscript //nologo "%vbs_%"') do set MyPass1=%%a

    ::
    ::echo.
    echo.|set /p="Retype  : "

    for /f "tokens=* delims=" %%a in ('cscript //nologo "%vbs_%"') do set MyPass2=%%a
    ::

    :: Clean up
    for %%f in ("%vbs_%") do if exist %%f del %%f
    ::
    :: Demonstrate the result
    echo.
    if "%MyPass1%"=="%MyPass2%" (
      echo The entered password was %MyPass1%
      ) else (
      echo No match)
    endlocal & goto :EOF
    '
    'The Visual Basic Script
    Set WshPass = WScript.CreateObject("ScriptPW.Password") 'VBS
    Password=WshPass.GetPassWord() 'VBS
    WScript.Echo PassWord 'VBS 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-29T13:43:19.300

通过明智地使用 Windows 上免费提供的另一种工具，以下两个脚本可以完成您想要的工作。

首先，GetPwd.cmd：

```
@echo off
:: GetPwd.cmd - Get password with no echo.
<nul: set /p passwd=Password: 
for /f "delims=" %%i in ('cscript /nologo GetPwd.vbs') do set passwd=%%i
echo.
:: This bit's just to prove we have the password.
echo %passwd% 
```

然后，GetPwd.vbs：

```
' GetPwd.vbs - Get password with no echo then echo it. '
Set oScriptPW = CreateObject("ScriptPW.Password")
strPassword = oScriptPW.GetPassword()
Wscript.StdOut.WriteLine strPassword 
```

解释：

GetPwd.vbs 只是使用密码对象从用户那里输入密码，然后将其打印到标准输出（下一段将解释为什么在终端中没有显示）。

GetPwd.cmd 有点棘手（但通常是命令脚本）。

该`"<nul: set /p passwd=Password: "`命令仅输出没有尾随 CR/LF 的提示 - 这是模拟 bash 的一种偷偷摸摸的方式`"echo -n"`。`passwd`作为副作用，它设置为空字符串并且不等待输入，因为它从 nul: 设备获取输入。

该`"for /f "delims=" %%i in ('cscript /nologo GetPwd.vbs') do set passwd=%%i"`声明是最棘手的部分。它在没有 Microsoft 广告 ( `/nologo`) 的情况下运行 vbscript，因此唯一的行输出是密码（来自 vbscript `"Wscript.StdOut.WriteLine strPassword"`.

将分隔符设置为空需要捕获带有空格的输入行，否则您只会得到第一个单词。`"for ... do set ..."`设置`passwd`为从 vbscript 输出的实际密码。

然后我们回显一个空行（实际上是终止该`"Password: "`行）并回显密码，以便您验证它是否有效：

```
C:\Pax> GetPwd
Password:
this is my password

C:\Pax> 
```

scriptpw.dll 可用于 XP 和 2K3，但不​​一定是更高版本。

Vista和大概Win7的说明如下，试一试：

> 为了屏蔽密码，脚本利用了 ScriptPW COM 对象。ScriptPW 在 Windows XP 和 Windows 2003 上默认加载。如果您运行的是 Windows 2000 或 Windows Vista，则需要将`scriptpw.dll`文件从`Windows\System32`XP 系统或 Windows 2003 系统的文件夹复制到 Windows 2000 上的`Winnt\System32`或文件夹`Windows\System32`或 Vista 系统。复制 DLL 后，您需要通过运行以下命令来注册它：
> 
> `regsvr32 scriptpw.dll`
> 
> 要在 Vista 机器上成功注册 DLL，您需要以管理员身份打开命令提示符。为此，请单击开始 | 所有程序 | 配件。然后右键单击命令提示符快捷方式并选择“以管理员身份运行”。以管理员身份进入命令提示符后，您将能够成功运行`regsvr32 scriptpw.dll`命令以注册 DLL。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-01-31T10:32:26.913

**1.纯批处理解决方案**，（ab）使用`XCOPY`命令及其在[此处](https://groups.google.com/forum/#!topic/alt.msdos.batch.nt/f7mb_f99lYI)`/P /L`找到的开关：

```
:: Hidden.cmd
::Tom Lavedas, 02/05/2013, 02/20/2013
::Carlos, 02/22/2013
::https://groups.google.com/forum/#!topic/alt.msdos.batch.nt/f7mb_f99lYI

@Echo Off
:HInput
SetLocal EnableExtensions EnableDelayedExpansion
Set "FILE=%Temp%.\T"
Set "FILE=.\T"
Keys List >"%File%"
Set /P "=Hidden text ending with Ctrl-C?: " <Nul
Echo.
Set "HInput="
:HInput_
For /F "tokens=1* delims=?" %%A In (
 '"Xcopy /P /L "%FILE%" "%FILE%" 2>Nul"'
) Do (
  Set "Text=%%B"
  If Defined Text (
    Set "Char=!Text:~1,1!"
    Set "Intro=1"
    For /F delims^=^ eol^= %%Z in ("!Char!") Do Set "Intro=0"
    Rem If press Intro
    If 1 Equ !Intro! Goto :HInput#
    Set "HInput=!HInput!!Char!"
  )
)
Goto :HInput_
:HInput#
Echo(!HInput!
Goto :Eof 
```

**2.使用HTA弹窗的密码提交者** 。[这是一个 .bat/jscript/mshta 混合](http://www.dostips.com/forum/viewtopic.php?f=3&t=5543)文件，应保存为 .bat：

```
<!-- :
:: PasswordSubmitter.bat
@echo off
for /f "tokens=* delims=" %%p in ('mshta.exe "%~f0"') do (
    set "pass=%%p"
)

echo your password is %pass%
exit /b
-->

<html>
<head><title>Password submitter</title></head>
<body>

    <script language='javascript' >
        function pipePass() {
            var pass=document.getElementById('pass').value;
            var fso= new ActiveXObject('Scripting.FileSystemObject').GetStandardStream(1);
            close(fso.Write(pass));

        }
    </script>

    <input type='password' name='pass' size='15'></input>
    <hr>
    <button onclick='pipePass()'>Submit</button>

</body>
</html> 
```

**3.[自编译的 .net 混合](http://www.dostips.com/forum/viewtopic.php?f=3&t=5260)**.Again 应另存为`.bat`。与其他解决方案不同，它将创建/编译一个小的 .exe 文件，该文件将被调用（如果您希望可以删除它）。还需要安装 .net 框架，但这不是问题：

```
@if (@X)==(@Y) @end /* JScript comment
@echo off
setlocal

for /f "tokens=* delims=" %%v in ('dir /b /s /a:-d  /o:-n "%SystemRoot%\Microsoft.NET\Framework\*jsc.exe"') do (
   set "jsc=%%v"
)

if not exist "%~n0.exe" (
    "%jsc%" /nologo /out:"%~n0.exe" "%~dpsfnx0"
)

for /f "tokens=* delims=" %%p in ('"%~n0.exe"') do (
    set "pass=%%p"
)

echo your password is %pass%

endlocal & exit /b %errorlevel%

*/

import System;

var pwd = "";
var key;

Console.Error.Write("Enter password: ");

        do {
           key = Console.ReadKey(true);
           if ( (key.KeyChar.ToString().charCodeAt(0)) >= 20 && (key.KeyChar.ToString().charCodeAt(0) <= 126) ) {
              pwd=pwd+(key.KeyChar.ToString());
              Console.Error.Write("*");
           }   

        } while (key.Key != ConsoleKey.Enter);
        Console.Error.WriteLine();
        Console.WriteLine(pwd); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-25T14:26:34.330

我假设您不想在屏幕上回显密码。

如果弹出窗口对您来说没问题，您可以使用例如 VBScript 来显示一个显示密码字段的 IE 窗口。这是一个[例子](http://www.robvanderwoude.com/vbstech_ui_userinput.html)。

作为替代方案，您可以从 HTA（HTML 应用程序）文件调用您的脚本（请参阅[HTML 应用程序简介 (HTA)](http://msdn.microsoft.com/en-us/library/ms536496(VS.85).aspx)。

问候，迪沃

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-25T20:03:28.250

如果你可以安装 Cygwin，默认情况下你会得到一个 bash shell，所以这个命令可以工作：

读取 -s -p "密码：" PASSWORD

唯一的问题是现在 PASSWORD 的值仅在 bash shell 中设置，而不是作为批处理文件可以看到的环境变量（不要使用 PWD，因为这在 cygwin 中意味着其他东西）。因此，您必须将脚本重写为 bash shell 脚本（考虑到命令提示符的限制，可能不会太难！）。

或者您可以将密码从 cygwin 传递到批处理脚本，但这意味着运行命令提示符的新实例：

cmd /cyourbatchfile.bat $PASSWORD

有点令人费解，一点也不令人满意；）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-03T17:49:17.317

我们一直在做这样的事情，但是将密码放在命令行中并将其传递给批处理文件中的变量。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-06-03T12:05:29.520

另一种方法是从您的脚本中调用`PowerShell`命令。`Batch`下面是一个配置服务登录帐户的示例：

```
$password = Read-Host "Enter password" -AsSecureString;
$decodedpassword = [System.Runtime.InteropServices.Marshal]::PtrToStringAuto([System.Runtime.InteropServices.Marshal]::SecureStringToBSTR($password));
& "sc.exe" config THE_SERVICE_NAME obj= THE_ACCOUNT password= $decodedPassword; 
```

其中 THE_SERVICE_NAME 是要配置的服务的名称，THE_ACCOUNT 是登录帐户。

然后我们可以像这样从批处理脚本中使用它：

```
call powershell -Command "$password = Read-Host "Enter password" -AsSecureString; $decodedpassword = [System.Runtime.InteropServices.Marshal]::PtrToStringAuto([System.Runtime.InteropServices.Marshal]::SecureStringToBSTR($password)); & "sc.exe" config THE_SERVICE_NAME obj= THE_ACCOUNT password= $decodedPassword;" 
```

这只是调用 PowerShell.exe 并传递三个命令。

这种方法的优点是当今大多数 Windows 安装都包括`PowerShell`.，因此不需要额外的程序或脚本。缺点是您需要在`PowerShell`调用中使用密码（如在我的示例中）或将其存储在环境变量中，然后从批处理脚本中使用它。我更喜欢前者，因为它更安全、更简单。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-07-16T22:58:09.263

您可以将 ReadFormattedLine 子例程用于所有类型的格式化输入。例如，以下命令读取每个 8 个字符的用户名和密码，在屏幕上显示星号，无需按 Enter 即可自动继续：

```
call :ReadFormattedLine USR="********" /M "Username: "
call :ReadFormattedLine PWD="********" /M "Password: " 
```

或者以不同的方式：

```
call :ReadFormattedLine nameAndPass="******** / ********" /M "Enter Username / Password: " 
```

在前面的例子中，当用户完成用户名时，子程序显示斜线并读取密码；如果用户删除字符，斜线也会被自动删除。

这个子程序是用纯 Batch 编写的，所以它不需要任何额外的程序，并且它允许多种格式化输入操作，比如读取数字、将字母转换为大写等。您可以从 ReadFormattedLine 子程序下载[Read a line with specific format](http://www.dostips.com/forum/viewtopic.php?f=3&t=5775)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-01-31T13:33:23.203

[ConSet](http://ss64.net/westlake/nt/)是由 Frank P. Westlake 编写的免费工具。它是标准 Windows 命令**集**的扩展版本。

> ConSet.exe - 显示、设置或删除 cmd.exe 环境变量，修改控制台参数，并执行浮点数学运算。

由于它不是标准的 Windows 控制台应用程序，因此使用此工具需要将该工具与批处理文件一起分发，或者该工具存储在服务器共享上，并且批处理文件直接从服务器共享调用该工具。

**ConSet**很容易提示输入密码字符串，其中隐藏输入分配给环境变量：

```
ConSet.exe /PH "PWD=Password: " 
```

附加参数`H`会导致隐藏用户输入。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-07-16T16:16:44.473

我编写了一个名为的开源工具`editenv`来替换我的旧`editv32`/`editv64`实用程序：

[https://github.com/Bill-Stewart/editenv](https://github.com/Bill-Stewart/editenv)

它提供了`--maskinput`( `-m`) 选项[*]，可让您隐藏键入的输入。例子：

```
editenv --maskinput --prompt="Password: " PWD 
```

此命令会显示一个`Password:`提示，并且您输入的任何内容都会放在`PWD`环境变量中。

在这里下载：

[https://github.com/Bill-Stewart/editenv/releases](https://github.com/Bill-Stewart/editenv/releases)

[*] 注意`--maskinput`( `-m`) 选项**不安全**——键入的输入以纯文本形式放置在环境中。此功能仅为方便起见。

# java - 让 Netbeans 和 Subversion 与库很好地配合使用？

> ID：286873
> 
> 赞同：4
> 
> 时间：2008-11-13T13:12:29.507
> 
> 标签：java, svn, netbeans

我很难弄清楚如何将 .jar/library 添加到 Netbeans 项目中，以便我可以将其提交到存储库。

添加库的典型方法（根据我已经浏览过的 Netbeans 文档）最终只是对我来说是本地的。任何检查我的项目的人最终都会错过我所需的库。

手动插入它并尝试解决 Netbeans 会导致 Netbeans 在尝试扫描项目时挂起......

那么，我如何告诉 Netbeans 选择一个 jar 作为库并将其包含在我的项目中，以便 Subversion 能够处理它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T18:23:40.113

有几种方法可以解决这个问题。

A. 当你定义你的库时，使用一个公共位置的路径。在每个人的机器上都相同的位置 - 例如与第三方应用程序一起安装到 Program Files 或 /usr/local/ 的 JAR 的位置或网络驱动器运行良好。

然后，当他们签出代码时，路径仍然是正确的，他们不必在他们的 Netbeans 工作区上定义库。

B. 编辑您的 project.properties 文件以使用相对路径。打开您的 project.properties 文件并查找“ `libs.LIBRARY_NAME.classpath=...`”。如果未定义库，这将是使用的“默认”位置。

更改它以使用相对于您的项目的路径并将 jar 文件存储在您的项目中。例如： `libs.Log4J.classpath=lib/log4j.jar`

请记住，您的库管理器中的库定义将覆盖此值——因此请确保它们保持同步（即，将版本号附加到库名称！）。

C. 使用 Vincent 的建议，即使用 Maven 等构建系统。Maven 构建过程将负责下载依赖项等。Netbeans 为几个流行的构建系统提供了插件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T21:01:55.483

NetBeans 6.5 中有一个新功能（项目中基于变量的路径），这应该会使这更容易。

看[http://wiki.netbeans.org/NewAndNoteWorthyNB65#section-NewAndNoteWorthyNB65-VariableBasedPathsInJ2SEJ2EEProjects](http://wiki.netbeans.org/NewAndNoteWorthyNB65#section-NewAndNoteWorthyNB65-VariableBasedPathsInJ2SEJ2EEProjects)了解详情。请注意，屏幕截图包括库定制器中的变量引用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T13:18:46.310

不是你的问题的真正答案，但是......通常你不应该在你的颠覆存储库中包含这些库。通常不需要管理它们。您可能想要的是设置一个类似于 maven 的中央存储库。如果您使用 maven，您可以在团队可访问的服务器上创建库的本地存储库。这些库的依赖项输入到 pom.xml 文件中，并且位于 subversion 存储库中。现在，当团队成员从 subversion 检查代码时，他们都可以访问 maven 存储库。

[我现在正在寻找对此的参考。当我找到它时，我会编辑这个答案。]

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-09-27T18:37:24.880

我使用 NetBeans IDE 6.5.1，到目前为止我发现的最佳解决方案是从本地主机中包含所需的库，然后将它们的路径更改为相对路径。之后，您必须从 NetBeans[文件资源管理](http://java.webnep.com.np/wp-content/uploads/2009/08/Untitled.jpg)器中手动删除这些库，然后再次将它们从计算机中的操作系统位置手动复制到文件资源管理器中。这样，NetBeans 就会检测到更改，您可以将其提交到存储库。

* * *

***注意：我强烈建议在更新后再次清理和构建项目。***

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-11-05T21:58:57.983

将你的 lib/jars 打包到你的项目中的一种简单方法是，subversion“只处理它”，这样你就可以使用所有准备编译的附加库来获取它，然后通过“shared”将它们全部包含在你的项目目录下库”选项通过管理库文件夹。

创建新项目时，您可以指定“使用专用文件夹存储库”，然后使用建议的相对 .\lib 路径。如果您有一个现有项目，您可以编辑它的属性、库类别和浏览库文件夹。再次首次运行将建议 .\lib 然后提供将现有依赖项复制到该文件夹​​。这些图形操作应提供与 James Schek 的“B”答案类似的结果。

使用 .\lib 中新添加的库提交项目，您应该能够从任何地方签出和构建，并且知道您将拥有与上次构建和提交时相同的库（相同版本）。

我不知道这个功能在 NetBeans 中已经存在多久了。有关更多详细信息，请参阅：

[http://netbeans.org/kb/docs/java/project-setup.html#projects-shared-libraries](http://netbeans.org/kb/docs/java/project-setup.html#projects-shared-libraries)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-23T20:18:20.330

我最终只是下载了我自己的设置并将它们放在我的本地驱动器上用于这个项目。我将我的 Netbeans 设置为查看那里并警告其他人我做了什么......最终，我们将不得不做一些更具可扩展性的事情...... :-)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-10-30T14:21:58.593

好的，我现在转移到的工作解决方案是从 jar 中提取类文件并将它们转储到 Source Packages 区域。然后这一切都被提交到存储库，并且还避免了在部署阶段处理单独的“lib”目录。

这个解决方案完成了我正在寻找的一切，但我觉得这样做真的很脏。它看起来非常糟糕和错误...... :-)

# c# - windows mobile 6中的图形或图表

> ID：286875
> 
> 赞同：5
> 
> 时间：2008-11-13T13:13:03.890
> 
> 标签：c#, windows-mobile, charts, graph

您是否知道类似于 Zedgraph 的 [免费] 绘图或图表库，但它适用于在 windows mobile 6 上进行开发？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T23:37:01.447

一个基本的免费图表 API 是[http://www.codeproject.com/KB/mobile/pocketbargraph.aspx](http://www.codeproject.com/KB/mobile/pocketbargraph.aspx)

如果网络访问和带宽不是问题，[http://code.google.com/apis/chart/](http://code.google.com/apis/chart/)可能是一个（不可否认的非常规）选项。

问候，坦伯格

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T14:09:01.233

我曾经使用列表框来创建（水平）条形图。我需要捕获列表框项目的绘制事件才能绘制条形图。不容易，但如果你的时间是免费的，那就免费...

# asp.net - 进行 TDD 时如何最好地创建测试数据库？

> ID：286876
> 
> 赞同：17
> 
> 时间：2008-11-13T13:13:25.713
> 
> 标签：asp.net, tdd, dependency-injection, mocking, persistence

在做 ASP.NET 站点（例如 ASP.NET MVC 站点）时创建测试持久层的最佳实践是什么？

我见过的许多示例在单元测试项目中使用 Moq（或其他模拟框架），但我想像 .. moq 一样将我的持久层移除，以便我的网站显示数据和内容，但它不是来自数据库。我想最后这样做。我见过的所有嘲笑的东西都只存在于单元测试中。

当人们想要（存根？）伪造一个持久层以实现快速开发时，他们会做什么实践？我使用依赖注入来处理它，并为我的持久层提供了一些硬编码的结果（这真的很手动而且很无聊）。

其他人在做什么？示例和链接会很棒:)

## 更新

只是一点点更新：到目前为止，我从拥有一个假存储库和一个 SQL 存储库中获得了相当多的里程——每个类都实现了一个接口。然后，使用 DI（我正在使用 StructureMap），我可以在我的假存储库或 SQL 存储库之间切换。到目前为止，它运行良好:)

（想想我在将近 11 个月前问过这个问题也很可怕，从我现在编辑这个问题开始！）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-13T13:47:05.600

假设您使用 Rob Conery 的 MVC Store Front 中的存储库模式：

[http://blog.wekeroad.com/mvc-storefront/mvc-storefront-part-1/](http://blog.wekeroad.com/mvc-storefront/mvc-storefront-part-1/)

我遵循了 Rob Conery 的教程，但遇到了和你一样的需求。最好的办法是将您创建的 Mock 存储库移动到一个名为 Mocks 的单独项目中，然后您可以在实例化服务时将它们轻松地与真实的存储库交换。如果您喜欢冒险，您可以创建一个从配置文件中获取值的工厂，以实例化模拟或真实存储库，

例如

```
public static ICatalogRepository GetCatalogRepository(bool useMock)
{
     if(useMock)
          return new FakeCatalogRepository();
     else
          return new SqlCatalogRepository();
} 
```

或使用依赖注入框架:)

```
container.Resolve<ICatalogRepository>(); 
```

祝你好运！

**编辑：**响应您的评论，听起来您想使用列表和 LINQ 来模拟数据库的操作，例如 GetProducts、StoreProduct。我以前做过。这是一个例子：

```
public class Product
{
     public int Identity { get; set; }
     public string Name { get; set; }
     public string Description { get; set; }
     //etc
}

public class FakeCatalogRepository()
{
     private List<Product> _fakes;

     public FakeCatalogCatalogRepository()
     {
          _fakes = new List<Product>();

          //Set up some initial fake data
          for(int i=0; i < 5; i++)
          {
              Product p = new Product
              {
                 Identity = i,
                 Name = "product"+i,
                 Description = "description of product"+i
              };

              _fakes.Add(p);
          }
     }

     public void StoreProduct(Product p)
     {
         //Emulate insert/update functionality

         _fakes.Add(p);
     }

     public Product GetProductByIdentity(int id)
     {
          //emulate "SELECT * FROM products WHERE id = 1234
          var aProduct = (from p in _fakes.AsQueryable()
                         where p.Identity = id
                         select p).SingleOrDefault();

          return aProduct;
     }
} 
```

这是否更有意义？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T14:46:33.950

我已经在单元测试类的设置方法期间创建表和数据，运行测试，然后在拆卸期间进行清理。是的，这种方法有效，但如果你真的最终将单元测试用于调试目的，你总是会运行设置，调试一些东西，然后在中间停止而不进行拆卸。它非常脆弱，您可能最终（从长远来看）测试数据库中有错误数据和/或不可用的单元测试。我个人认为最好使用模拟框架来模拟数据库层。我明白有时最好在数据库中做逻辑。对于这些情况，您可以使用[DBFit 之](http://benilovj.github.com/dbfit)类的工具为您的数据库层编写测试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T14:14:16.607

Boring or not, I think you're on the right track. I assume you're creating a fakeRepository that is a concrete implementation of your IRepository which in turn is injected into your service layer. This is nice because at some point in the future when you're happy with the shape of your entities and the behavior of your services, controllers, and views, you can then test drive your real Repositories that will use the database to persist those entities. Of course the nature of those tests will be integration tests, but just as important if not more so.

One thing that may be less boring for you when the time comes to create your real repositories is if you use nHibernate for your persistence you will be able let nhibernate generate your database after you create the nhibernate maps for your entities, assuming you don't have to use a legacy schema.

For instance, I have the following method that is called by my SetUpFixture to generate my db schema:

```
public class SchemaBuilder
{
   public static void ExportSchema()
    {
        Configuration configuration = new Configuration();
        configuration.Configure();
        new SchemaExport(configuration).Create(true, true);
    }
} 
```

and my SetUpFixture is as follows:

```
[SetUpFixture]
public class SetUpFixture
{
    [SetUp]
    public void SetUp()
    {
        SchemaBuilder.ExportSchema();
        DataLoader.LoadData();
    }
} 
```

where DataLoader is responsible for creating all of my seed data and test data using the real respoitory.

This probably doesn't answer your questions but I hope it serves to reassure you in your approach.

Greg

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-14T07:46:36.013

虽然我没有使用 Asp.Net 或 MVC 框架，但我确实需要在不访问数据库的情况下测试服务。你的问题引发了我如何做的简短（好吧，也许不是那么短）的总结。不声称它是最好的或任何东西，但它对我们有用。我们通过存储库访问数据，并在需要时插入内存存储库，如帖子中所述。

[http://blogs.microsoft.co.il/blogs/kim/archive/2008/11/14/testable-data-access-with-the-repository-pattern.aspx](http://blogs.microsoft.co.il/blogs/kim/archive/2008/11/14/testable-data-access-with-the-repository-pattern.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-23T16:32:01.940

我正在使用带有 SQLite 和 ActiveRecord 的完整内存数据库。基本上，我们在运行每个集成测试之前删除并重新创建数据库，以便数据始终处于已知状态。数据库的内容是通过代码插入的。所以一个例子是这样的：

```
ActiveRecord.Initalize(lots of parameters)
ActiveRecord.DropSchema();
ActiveRecord.CreateSchema(); 
```

然后我们只是添加很多客户或其他任何东西，DDD 风格：

```
customerRepository.Save(customer); 
```

解决这个问题的另一种方法是使用 NDbUnit 来维护数据库的状态。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-01-18T11:43:24.743

我知道这个问题有点老了，但我终于想出了一个答案:)

首先，使用[RavenDb (Embedded)](http://nuget.org/packages/RavenDB-Embedded/)。它是[RavenDb 文档数据库](http://ravendb.net/)的一部分。它是一个完全在内存中的数据库，并且可以与单元测试完美配合 :) 我已经使用 MSTest、NUnit 和 xUnit 完成了它。

其次，如果您不想使用 RavenDb，可以将 NHibernate 与 SqlLite 一起使用。[Ayende 有一篇关于使用这个的帖子](http://ayende.com/blog/3983/nhibernate-unit-testing)。

# obfuscation - 为什么大多数（全部？）混淆工具都针对 C# 和其他 C 语言而不是 VB？

> ID：286888
> 
> 赞同：1
> 
> 时间：2008-11-13T13:20:53.890
> 
> 标签：obfuscation

我不知道我是不是对的，但几乎每次我读到关于混淆和处理它的工具，然后它是关于 C#、Java、Javascript 和除 VB 之外的所有其他语言的。

正如我所看到的，对于我作为 VB 开发人员来说，*保护*我作为 C# 开发人员的代码同样重要。我错过了什么吗？

如果原因很明显，但我错过了，请不要喷我。

谢谢。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-11-13T13:23:36.333

如果您指的是 VB.NET，它可以像 C# 一样被混淆，因为混淆器使用程序集，而不是源代码。由于 C# 和 VB.NET 编译为（几乎）相同的 IL，因此它们都可以使用。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-13T13:29:08.147

VB.NET 的默认值为 Obfuscation = true。

这是个笑话。放松。我忍不住了。vimpyboy 做到了。

# vbscript - 使用 vbscript 删除 GAC 程序集

> ID：286894
> 
> 赞同：1
> 
> 时间：2008-11-13T13:25:32.537
> 
> 标签：vbscript, assemblies, gac

如标题所说，如何使用 vbscript 删除 GAC 程序集文件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T13:27:27.637

您可以运行它从 GAC 中卸载它：

```
gacutil /u YourAssembly 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T13:29:20.253

我记得 gacutil 在启用 .NET 的 shell 中。

```
C:\>gacutil
Microsoft (R) .NET Global Assembly Cache Utility.  Version 3.5.21022.8
Copyright (c) Microsoft Corporation.  All rights reserved.

Usage: Gacutil <command> [ <options> ]
Commands:
  /i <assembly_path> [ /r <...> ] [ /f ]
    Installs an assembly to the global assembly cache.

  /il <assembly_path_list_file> [ /r <...> ] [ /f ]
    Installs one or more assemblies to the global assembly cache.

  /u <assembly_display_name> [ /r <...> ]
    Uninstalls an assembly from the global assembly cache.

  /ul <assembly_display_name_list_file> [ /r <...> ]
    Uninstalls one or more assemblies from the global assembly cache.

  /l [ <assembly_name> ]
    List the global assembly cache filtered by <assembly_name>

  /lr [ <assembly_name> ]
    List the global assembly cache with all traced references.

  /cdl
    Deletes the contents of the download cache

  /ldl
    Lists the contents of the download cache

  /?
    Displays a detailed help screen

 Options:
  /r <reference_scheme> <reference_id> <description>
    Specifies a traced reference to install (/i, /il) or uninstall (/u, /ul).

  /f
    Forces reinstall of an assembly.

  /nologo
    Suppresses display of the logo banner

  /silent
    Suppresses display of all output 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T13:56:14.037

您可以将 WSH 与 VBScript 一起使用，并使用 WSH 打开文件。

[http://www.mhuffman.com/notes/language/vbs_intro.htm](http://www.mhuffman.com/notes/language/vbs_intro.htm)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-16T09:20:23.387

`gacutil`以下是从 VBScript调用该工具的方法：

```
Const GACUTILPATH = "C:\Program Files\Microsoft SDKs\Windows\v6.0A\Bin\gacutil.exe"
strAssembly = "MyAssembly"  '' or "MyAssembly,Version=1.1.0.0,Culture=en,PublicKeyToken=874e23ab874e23ab"

Set oShell  = CreateObject("WScript.Shell")
oShell.Run """" & GACUTILPATH & """ /nologo /u " & strAssembly 
```

# windows-mobile - 如何填充 SYSTEMTIME 值？

> ID：286897
> 
> 赞同：4
> 
> 时间：2008-11-13T13:27:25.217
> 
> 标签：windows-mobile, systemtime

在本机 C++ 应用程序中的 Windows Mobile（但我猜在 Windows 上是一样的）上，我将如何正确设置 SYSTEMTIME 结构？假设我有

```
int year, month, dayOfMonth, hour, minute, second; 
```

我显然应该设置 SYSTEMTIME 结构的 wHour、wYear 等成员，但是在这种情况下 wDayOfWeek 会发生什么，我宁愿也正确设置它。我已经查看但未在 MSDN 中找到任何允许我填充 SYSTEMTIME 结构的函数，在该结构中将为我计算 wDayOfWeek 成员。我错过了什么或者我该怎么做？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T14:52:28.727

您可以填写您知道的字段，然后转换为变体时间并返回。

这可能会填补缺失的数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T13:32:24.553

唔...

也许首先构造一个FILETIME，然后调用FileTimeToSystemTime？

文件时间信息
[http://msdn.microsoft.com/en-us/library/ms724284(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms724284(VS.85).aspx)

或者，首先构造一个 VT_TIME 的 VARIANT，然后调用 VariantTimeToSystemTime。 [http://msdn.microsoft.com/en-us/library/ms221440.aspx](http://msdn.microsoft.com/en-us/library/ms221440.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T15:23:11.770

一些谷歌搜索发现你需要使用世界末日规则来解决这个问题。下面的链接中有一些 c++ 示例和更多信息。

但真正的解决方案取决于您拥有什么日期以及从哪里获得它。就像其他人所说的那样，将其转换为文件时间然后生成系统时间可能更容易。

*   [http://www.dreamincode.net/forums/showtopic26329.htm](http://www.dreamincode.net/forums/showtopic26329.htm)
*   [http://www.codeproject.com/KB/datetime/doomsdaydate.aspx](http://www.codeproject.com/KB/datetime/doomsdaydate.aspx)
*   [http://en.wikipedia.org/wiki/Doomsday_Algorithm](http://en.wikipedia.org/wiki/Doomsday_Algorithm)

# apache-flex - Flex中按钮的图标大小

> ID：286900
> 
> 赞同：1
> 
> 时间：2008-11-13T13:28:13.233
> 
> 标签：apache-flex, icons

如何找到嵌入在按钮中的图标的宽度？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-11-14T07:56:14.997

试试这个：

```
var icon:DisplayObject = button.getChildByName("upIcon");
trace("icon (width: " + icon.width + ", height: " + icon.height + ")"); 
```

# wpf - 在 WPF 中使用数据绑定启动动画

> ID：286904
> 
> 赞同：8
> 
> 时间：2008-11-13T13:29:53.090
> 
> 标签：wpf, data-binding, animation, mvvm

我正在尝试调整一个简单的 WPF 应用程序以使用 Model-View-ViewModel 模式。在我的页面上，我有几个动画：

```
<Page.Resources>
    <Storyboard x:Name="storyboardRight"
                x:Key="storyboardRight">
        <DoubleAnimation x:Name="da3"
                         Storyboard.TargetName="labelRight"
                         Storyboard.TargetProperty="Opacity"
                         From="0"
                         To="1"
                         Duration="0:0:0.5" />
        <DoubleAnimation x:Name="da4"
                         Storyboard.TargetName="labelRight"
                         Storyboard.TargetProperty="Opacity"
                         From="1"
                         To="0"
                         BeginTime="0:0:1"
                         Duration="0:0:0.5" />
    </Storyboard>
    ...
</Page.Resources> 
```

目前我在后面的代码中开始动画，并且可以在完成时监听 Co​​mpleted 事件以执行以下代码：

```
storyboardRight = (Storyboard)TryFindResource("storyboardRight");
storyboardRight.Completed += new EventHandler(storyboardRight_Completed);
storyboardRight.Begin(this); 
```

有没有办法将故事板数据绑定到我的 ViewModel，以便它从 ViewModel 引发的事件开始，并在完成时回调到该 ViewModel？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-31T11:12:55.323

我有机会向微软的 Josh Twist 提出这个问题，他很乐意花时间提供这个问题的答案。解决方案是结合 ViewModel 中的枚举使用 a`DataTrigger`来启动 Storyboard，而这又需要将页面放入`ContentPresenter`. 为了处理动画完成，需要少量代码来调用`ICommand`ViewModel 上的 an。

[在此处](http://www.thejoyofcode.com/Model_View_ViewModel_and_Animation.aspx)阅读 Josh 的帖子，了解该解决方案的完整描述。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-05-12T15:54:42.230

我通过使用 DataTrigger 并将其绑定到我的 ViewModel 中的属性来做到这一点。当“FlashingBackGround”属性设置为“ON”时，情节提要动画开始。

还要确保在您的项目中包含对“Microsoft.Expression.Interactions”的引用

XAML：（这直接在根节点中）

```
<Window
   xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
   xmlns:ei="http://schemas.microsoft.com/expression/2010/interactions" 
   x:Name="window" >
    ...

    <i:Interaction.Triggers>
      <ei:DataTrigger Binding="{Binding FlashingBackground, Mode=OneWay}" Value="ON">
        <ei:ControlStoryboardAction Storyboard="{StaticResource MyAnimation}"     
                                                ControlStoryboardOption="Play"/>
      </ei:DataTrigger>
    </i:Interaction.Triggers>

    ...
</Window> 
```

视图模型：

```
 private void TurnOnFlashingBackround()
    {
        this.FlashingBackground = "ON";
    }

    private string _FlashingBackround = "OFF";

    public string FlashingBackground
    {
        get { return this._FlashingBackround; }

        private set
        {
            if (this.FlashingBackground == value)
            {
                return;
            }

            this._FlashingBackround = value;
            this.OnPropertyChanged("FlashingBackground");
        }
    }

    public new event PropertyChangedEventHandler PropertyChanged;

    private void OnPropertyChanged(string propertyName)
    {
        if (this.PropertyChanged != null)
        {
            this.PropertyChanged(
                this, 
                new PropertyChangedEventArgs(propertyName));
        }
    } 
```

最后，Viewmodel 必须继承自“INotifyPropertyChanged”

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T13:48:56.703

您需要使用`EventTrigger`. 这篇[关于 WPF 中动画的文章](http://www.microsoft.com/emea/msdn/thepanel/en/articles/animations_wpf.aspx)可能会有所帮助。另请参阅MSDN 上的[Routed Events Overview和](http://msdn.microsoft.com/en-us/library/ms742806.aspx)[How to: Use Event Triggers to Control a Storyboard After Starts](http://msdn.microsoft.com/en-us/library/ms744905.aspx)。

# javascript - 有效地替换字符串中的所有重音字符？

> ID：286921
> 
> 赞同：123
> 
> 时间：2008-11-13T13:40:07.050
> 
> 标签：javascript, sorting, string, collation

对于一个穷人在客户端实现*近乎正确排序的排序，我需要一个 JavaScript 函数，它可以在字符串中进行**有效*的单个字符替换。

这就是我的意思（请注意，这适用于德语文本，其他语言排序不同）：

```
本机排序出错了：abcouz ä ö ü
校对正确的是：a ä bco ö u ü z

```

基本上，我需要将给定字符串的所有“ä”替换为“a”（等等）。这样，本机排序的结果将非常接近用户的期望（或数据库返回的结果）。

其他语言可以做到这一点：[Python 提供`str.translate()`](http://docs.python.org/3.1/library/stdtypes.html#str.translate)，[Perl 中有`tr/…/…/`](http://perldoc.perl.org/functions/tr.html)，[XPath 有函数`translate()`](http://www.w3.org/TR/xpath/#function-translate)，[ColdFusion 有`ReplaceList()`](http://livedocs.adobe.com/coldfusion/8/functions_m-r_33.html)。但是 JavaScript 呢？

这是我现在所拥有的。

```
// s would be a rather short string (something like 
// 200 characters at max, most of the time much less)
function makeSortString(s) {
  var translate = {
    "ä": "a", "ö": "o", "ü": "u",
    "Ä": "A", "Ö": "O", "Ü": "U"   // probably more to come
  };
  var translate_re = /[öäüÖÄÜ]/g;
  return ( s.replace(translate_re, function(match) { 
    return translate[match]; 
  }) );
} 
```

对于初学者来说，我不喜欢每次调用函数时都会重新构建正则表达式的事实。我想关闭在这方面会有所帮助，但由于某种原因，我似乎没有掌握它的窍门。

有人能想到更有效的方法吗？

* * *

## 下面的答案分为两类：

1.  不同程度的完整性和效率的字符串替换函数（我最初问的是什么）
2.  [迟到](https://stackoverflow.com/a/42163018/18771)了[`String#localeCompare`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/localeCompare)，现在在 JS 引擎中得到了[广泛的支持](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/localeCompare#Browser_compatibility)（在提出问题的 时候还没有那么多），并且可以更优雅地解决这类问题。

* * *

## 回答 #1

> 赞同：114
> 
> 时间：2012-03-12T13:21:34.283

这是一个基于 Unicode 标准的更完整的版本。

```
var Latinise={};Latinise.latin_map={"Á":"A",
"Ă":"A",
"Ắ&quot;:"A",
"Ặ&quot;:"A",
"Ằ&quot;:"A",
"Ẳ&quot;:"A",
"Ẵ&quot;:"A",
"Ǎ":"A",
"Â":"A",
"Ấ&quot;:"A",
"Ậ&quot;:"A",
"Ầ&quot;:"A",
"Ẩ&quot;:"A",
"Ẫ&quot;:"A",
"Ä":"A",
"Ǟ":"A",
"Ȧ":"A",
"Ǡ":"A",
"Ạ&quot;:"A",
"Ȁ":"A",
"À":"A",
"Ả&quot;:"A",
"Ȃ":"A",
"Ā":"A",
"Ą":"A",
"Å":"A",
"Ǻ":"A",
"Ḁ":"A",
"Ⱥ":"A",
"Ã":"A",
"Ꜳ&quot;:"AA",
"Æ":"AE",
"Ǽ":"AE",
"Ǣ":"AE",
"Ꜵ&quot;:"AO",
"Ꜷ&quot;:"AU",
"Ꜹ&quot;:"AV",
"Ꜻ&quot;:"AV",
"Ꜽ&quot;:"AY",
"Ḃ&quot;:"B",
"Ḅ&quot;:"B",
"Ɓ":"B",
"Ḇ&quot;:"B",
"Ƀ":"B",
"Ƃ":"B",
"Ć":"C",
"Č":"C",
"Ç":"C",
"Ḉ&quot;:"C",
"Ĉ":"C",
"Ċ":"C",
"Ƈ":"C",
"Ȼ":"C",
"Ď":"D",
"Ḑ&quot;:"D",
"Ḓ&quot;:"D",
"Ḋ&quot;:"D",
"Ḍ&quot;:"D",
"Ɗ":"D",
"Ḏ&quot;:"D",
"ǲ":"D",
"ǅ":"D",
"Đ":"D",
"Ƌ":"D",
"Ǳ":"DZ",
"Ǆ":"DZ",
"É":"E",
"Ĕ":"E",
"Ě":"E",
"Ȩ":"E",
"Ḝ&quot;:"E",
"Ê":"E",
"Ế&quot;:"E",
"Ệ&quot;:"E",
"Ề":"E",
"Ể&quot;:"E",
"Ễ&quot;:"E",
"Ḙ&quot;:"E",
"Ë":"E",
"Ė":"E",
"Ẹ&quot;:"E",
"Ȅ":"E",
"È":"E",
"Ẻ&quot;:"E",
"Ȇ":"E",
"Ē":"E",
"Ḗ&quot;:"E",
"Ḕ&quot;:"E",
"Ę":"E",
"Ɇ":"E",
"Ẽ&quot;:"E",
"Ḛ&quot;:"E",
"Ꝫ&quot;:"ET",
"Ḟ&quot;:"F",
"Ƒ":"F",
"Ǵ":"G",
"Ğ":"G",
"Ǧ":"G",
"Ģ":"G",
"Ĝ":"G",
"Ġ":"G",
"Ɠ":"G",
"Ḡ&quot;:"G",
"Ǥ":"G",
"Ḫ&quot;:"H",
"Ȟ":"H",
"Ḩ&quot;:"H",
"Ĥ":"H",
"Ⱨ&quot;:"H",
"Ḧ&quot;:"H",
"Ḣ&quot;:"H",
"Ḥ&quot;:"H",
"Ħ":"H",
"Í":"I",
"Ĭ":"I",
"Ǐ":"I",
"Î":"I",
"Ï":"I",
"Ḯ&quot;:"I",
"İ":"I",
"Ị&quot;:"I",
"Ȉ":"I",
"Ì":"I",
"Ỉ&quot;:"I",
"Ȋ":"I",
"Ī":"I",
"Į":"I",
"Ɨ":"I",
"Ĩ":"I",
"Ḭ&quot;:"I",
"Ꝺ&quot;:"D",
"Ꝼ&quot;:"F",
"Ᵹ&quot;:"G",
"Ꞃ&quot;:"R",
"Ꞅ&quot;:"S",
"Ꞇ&quot;:"T",
"Ꝭ&quot;:"IS",
"Ĵ":"J",
"Ɉ":"J",
"Ḱ&quot;:"K",
"Ǩ":"K",
"Ķ":"K",
"Ⱪ&quot;:"K",
"Ꝃ&quot;:"K",
"Ḳ&quot;:"K",
"Ƙ":"K",
"Ḵ&quot;:"K",
"Ꝁ":"K",
"Ꝅ&quot;:"K",
"Ĺ":"L",
"Ƚ":"L",
"Ľ":"L",
"Ļ":"L",
"Ḽ&quot;:"L",
"Ḷ&quot;:"L",
"Ḹ&quot;:"L",
"Ⱡ&quot;:"L",
"Ꝉ&quot;:"L",
"Ḻ&quot;:"L",
"Ŀ":"L",
"Ɫ&quot;:"L",
"ǈ":"L",
"Ł":"L",
"Ǉ":"LJ",
"Ḿ&quot;:"M",
"Ṁ":"M",
"Ṃ&quot;:"M",
"Ɱ&quot;:"M",
"Ń":"N",
"Ň":"N",
"Ņ":"N",
"Ṋ&quot;:"N",
"Ṅ&quot;:"N",
"Ṇ&quot;:"N",
"Ǹ":"N",
"Ɲ":"N",
"Ṉ&quot;:"N",
"Ƞ":"N",
"ǋ":"N",
"Ñ":"N",
"Ǌ":"NJ",
"Ó":"O",
"Ŏ":"O",
"Ǒ":"O",
"Ô":"O",
"Ố&quot;:"O",
"Ộ&quot;:"O",
"Ồ&quot;:"O",
"Ổ&quot;:"O",
"Ỗ&quot;:"O",
"Ö":"O",
"Ȫ":"O",
"Ȯ":"O",
"Ȱ":"O",
"Ọ&quot;:"O",
"Ő":"O",
"Ȍ":"O",
"Ò":"O",
"Ỏ&quot;:"O",
"Ơ":"O",
"Ớ&quot;:"O",
"Ợ&quot;:"O",
"Ờ&quot;:"O",
"Ở&quot;:"O",
"Ỡ&quot;:"O",
"Ȏ":"O",
"Ꝋ&quot;:"O",
"Ꝍ&quot;:"O",
"Ō":"O",
"Ṓ&quot;:"O",
"Ṑ&quot;:"O",
"Ɵ":"O",
"Ǫ":"O",
"Ǭ":"O",
"Ø":"O",
"Ǿ":"O",
"Õ":"O",
"Ṍ&quot;:"O",
"Ṏ&quot;:"O",
"Ȭ":"O",
"Ƣ":"OI",
"Ꝏ&quot;:"OO",
"Ɛ":"E",
"Ɔ":"O",
"Ȣ":"OU",
"Ṕ&quot;:"P",
"Ṗ&quot;:"P",
"Ꝓ&quot;:"P",
"Ƥ":"P",
"Ꝕ&quot;:"P",
"Ᵽ&quot;:"P",
"Ꝑ&quot;:"P",
"Ꝙ&quot;:"Q",
"Ꝗ&quot;:"Q",
"Ŕ":"R",
"Ř":"R",
"Ŗ":"R",
"Ṙ&quot;:"R",
"Ṛ&quot;:"R",
"Ṝ&quot;:"R",
"Ȑ":"R",
"Ȓ":"R",
"Ṟ&quot;:"R",
"Ɍ":"R",
"Ɽ&quot;:"R",
"Ꜿ&quot;:"C",
"Ǝ":"E",
"Ś":"S",
"Ṥ&quot;:"S",
"Š":"S",
"Ṧ&quot;:"S",
"Ş":"S",
"Ŝ":"S",
"Ș":"S",
"Ṡ&quot;:"S",
"Ṣ&quot;:"S",
"Ṩ&quot;:"S",
"Ť":"T",
"Ţ":"T",
"Ṱ&quot;:"T",
"Ț":"T",
"Ⱦ":"T",
"Ṫ&quot;:"T",
"Ṭ&quot;:"T",
"Ƭ":"T",
"Ṯ&quot;:"T",
"Ʈ":"T",
"Ŧ":"T",
"Ɐ&quot;:"A",
"Ꞁ":"L",
"Ɯ":"M",
"Ʌ":"V",
"Ꜩ&quot;:"TZ",
"Ú":"U",
"Ŭ":"U",
"Ǔ":"U",
"Û":"U",
"Ṷ&quot;:"U",
"Ü":"U",
"Ǘ":"U",
"Ǚ":"U",
"Ǜ":"U",
"Ǖ":"U",
"Ṳ&quot;:"U",
"Ụ&quot;:"U",
"Ű":"U",
"Ȕ":"U",
"Ù":"U",
"Ủ&quot;:"U",
"Ư":"U",
"Ứ&quot;:"U",
"Ự&quot;:"U",
"Ừ&quot;:"U",
"Ử&quot;:"U",
"Ữ&quot;:"U",
"Ȗ":"U",
"Ū":"U",
"Ṻ&quot;:"U",
"Ų":"U",
"Ů":"U",
"Ũ":"U",
"Ṹ&quot;:"U",
"Ṵ&quot;:"U",
"Ꝟ&quot;:"V",
"Ṿ&quot;:"V",
"Ʋ":"V",
"Ṽ&quot;:"V",
"Ꝡ&quot;:"VY",
"Ẃ&quot;:"W",
"Ŵ":"W",
"Ẅ&quot;:"W",
"Ẇ&quot;:"W",
"Ẉ&quot;:"W",
"Ẁ":"W",
"Ⱳ&quot;:"W",
"Ẍ&quot;:"X",
"Ẋ&quot;:"X",
"Ý":"Y",
"Ŷ":"Y",
"Ÿ":"Y",
"Ẏ&quot;:"Y",
"Ỵ&quot;:"Y",
"Ỳ&quot;:"Y",
"Ƴ":"Y",
"Ỷ&quot;:"Y",
"Ỿ&quot;:"Y",
"Ȳ":"Y",
"Ɏ":"Y",
"Ỹ&quot;:"Y",
"Ź":"Z",
"Ž":"Z",
"Ẑ&quot;:"Z",
"Ⱬ&quot;:"Z",
"Ż":"Z",
"Ẓ&quot;:"Z",
"Ȥ":"Z",
"Ẕ&quot;:"Z",
"Ƶ":"Z",
"Ĳ":"IJ",
"Œ":"OE",
"ᴀ":"A",
"ᴁ&quot;:"AE",
"ʙ":"B",
"ᴃ&quot;:"B",
"ᴄ&quot;:"C",
"ᴅ&quot;:"D",
"ᴇ&quot;:"E",
"ꜰ&quot;:"F",
"ɢ":"G",
"ʛ":"G",
"ʜ":"H",
"ɪ":"I",
"ʁ":"R",
"ᴊ&quot;:"J",
"ᴋ&quot;:"K",
"ʟ":"L",
"ᴌ&quot;:"L",
"ᴍ&quot;:"M",
"ɴ":"N",
"ᴏ&quot;:"O",
"ɶ":"OE",
"ᴐ&quot;:"O",
"ᴕ&quot;:"OU",
"ᴘ&quot;:"P",
"ʀ":"R",
"ᴎ&quot;:"N",
"ᴙ&quot;:"R",
"ꜱ&quot;:"S",
"ᴛ&quot;:"T",
"ⱻ&quot;:"E",
"ᴚ&quot;:"R",
"ᴜ&quot;:"U",
"ᴠ&quot;:"V",
"ᴡ&quot;:"W",
"ʏ":"Y",
"ᴢ&quot;:"Z",
"á":"a",
"ă":"a",
"ắ&quot;:"a",
"ặ&quot;:"a",
"ằ&quot;:"a",
"ẳ&quot;:"a",
"ẵ&quot;:"a",
"ǎ":"a",
"â":"a",
"ấ&quot;:"a",
"ậ&quot;:"a",
"ầ&quot;:"a",
"ẩ&quot;:"a",
"ẫ&quot;:"a",
"ä":"a",
"ǟ":"a",
"ȧ":"a",
"ǡ":"a",
"ạ&quot;:"a",
"ȁ":"a",
"à":"a",
"ả&quot;:"a",
"ȃ":"a",
"ā":"a",
"ą":"a",
"ᶏ&quot;:"a",
"ẚ&quot;:"a",
"å":"a",
"ǻ":"a",
"ḁ&quot;:"a",
"ⱥ&quot;:"a",
"ã":"a",
"ꜳ&quot;:"aa",
"æ":"ae",
"ǽ":"ae",
"ǣ":"ae",
"ꜵ&quot;:"ao",
"ꜷ&quot;:"au",
"ꜹ&quot;:"av",
"ꜻ&quot;:"av",
"ꜽ&quot;:"ay",
"ḃ&quot;:"b",
"ḅ&quot;:"b",
"ɓ":"b",
"ḇ&quot;:"b",
"ᵬ&quot;:"b",
"ᶀ":"b",
"ƀ":"b",
"ƃ":"b",
"ɵ":"o",
"ć":"c",
"č":"c",
"ç":"c",
"ḉ&quot;:"c",
"ĉ":"c",
"ɕ":"c",
"ċ":"c",
"ƈ":"c",
"ȼ":"c",
"ď":"d",
"ḑ&quot;:"d",
"ḓ&quot;:"d",
"ȡ":"d",
"ḋ&quot;:"d",
"ḍ&quot;:"d",
"ɗ":"d",
"ᶑ&quot;:"d",
"ḏ&quot;:"d",
"ᵭ&quot;:"d",
"ᶁ&quot;:"d",
"đ":"d",
"ɖ":"d",
"ƌ":"d",
"ı":"i",
"ȷ":"j",
"ɟ":"j",
"ʄ":"j",
"ǳ":"dz",
"ǆ":"dz",
"é":"e",
"ĕ":"e",
"ě":"e",
"ȩ":"e",
"ḝ&quot;:"e",
"ê":"e",
"ế&quot;:"e",
"ệ&quot;:"e",
"ề&quot;:"e",
"ể&quot;:"e",
"ễ&quot;:"e",
"ḙ&quot;:"e",
"ë":"e",
"ė":"e",
"ẹ&quot;:"e",
"ȅ":"e",
"è":"e",
"ẻ&quot;:"e",
"ȇ":"e",
"ē":"e",
"ḗ&quot;:"e",
"ḕ&quot;:"e",
"ⱸ&quot;:"e",
"ę":"e",
"ᶒ&quot;:"e",
"ɇ":"e",
"ẽ&quot;:"e",
"ḛ&quot;:"e",
"ꝫ&quot;:"et",
"ḟ&quot;:"f",
"ƒ":"f",
"ᵮ&quot;:"f",
"ᶂ&quot;:"f",
"ǵ":"g",
"ğ":"g",
"ǧ":"g",
"ģ":"g",
"ĝ":"g",
"ġ":"g",
"ɠ":"g",
"ḡ&quot;:"g",
"ᶃ&quot;:"g",
"ǥ":"g",
"ḫ&quot;:"h",
"ȟ":"h",
"ḩ&quot;:"h",
"ĥ":"h",
"ⱨ&quot;:"h",
"ḧ&quot;:"h",
"ḣ&quot;:"h",
"ḥ&quot;:"h",
"ɦ":"h",
"ẖ&quot;:"h",
"ħ":"h",
"ƕ":"hv",
"í":"i",
"ĭ":"i",
"ǐ":"i",
"î":"i",
"ï":"i",
"ḯ&quot;:"i",
"ị&quot;:"i",
"ȉ":"i",
"ì":"i",
"ỉ&quot;:"i",
"ȋ":"i",
"ī":"i",
"į":"i",
"ᶖ&quot;:"i",
"ɨ":"i",
"ĩ":"i",
"ḭ&quot;:"i",
"ꝺ&quot;:"d",
"ꝼ&quot;:"f",
"ᵹ&quot;:"g",
"ꞃ&quot;:"r",
"ꞅ&quot;:"s",
"ꞇ&quot;:"t",
"ꝭ&quot;:"is",
"ǰ":"j",
"ĵ":"j",
"ʝ":"j",
"ɉ":"j",
"ḱ&quot;:"k",
"ǩ":"k",
"ķ":"k",
"ⱪ&quot;:"k",
"ꝃ&quot;:"k",
"ḳ&quot;:"k",
"ƙ":"k",
"ḵ&quot;:"k",
"ᶄ&quot;:"k",
"ꝁ&quot;:"k",
"ꝅ&quot;:"k",
"ĺ":"l",
"ƚ":"l",
"ɬ":"l",
"ľ":"l",
"ļ":"l",
"ḽ&quot;:"l",
"ȴ":"l",
"ḷ&quot;:"l",
"ḹ&quot;:"l",
"ⱡ&quot;:"l",
"ꝉ&quot;:"l",
"ḻ&quot;:"l",
"ŀ":"l",
"ɫ":"l",
"ᶅ&quot;:"l",
"ɭ":"l",
"ł":"l",
"ǉ":"lj",
"ſ":"s",
"ẜ&quot;:"s",
"ẛ&quot;:"s",
"ẝ&quot;:"s",
"ḿ&quot;:"m",
"ṁ&quot;:"m",
"ṃ&quot;:"m",
"ɱ":"m",
"ᵯ&quot;:"m",
"ᶆ&quot;:"m",
"ń":"n",
"ň":"n",
"ņ":"n",
"ṋ&quot;:"n",
"ȵ":"n",
"ṅ&quot;:"n",
"ṇ&quot;:"n",
"ǹ":"n",
"ɲ":"n",
"ṉ&quot;:"n",
"ƞ":"n",
"ᵰ&quot;:"n",
"ᶇ&quot;:"n",
"ɳ":"n",
"ñ":"n",
"ǌ":"nj",
"ó":"o",
"ŏ":"o",
"ǒ":"o",
"ô":"o",
"ố&quot;:"o",
"ộ&quot;:"o",
"ồ&quot;:"o",
"ổ&quot;:"o",
"ỗ&quot;:"o",
"ö":"o",
"ȫ":"o",
"ȯ":"o",
"ȱ":"o",
"ọ&quot;:"o",
"ő":"o",
"ȍ":"o",
"ò":"o",
"ỏ&quot;:"o",
"ơ":"o",
"ớ&quot;:"o",
"ợ&quot;:"o",
"ờ&quot;:"o",
"ở&quot;:"o",
"ỡ&quot;:"o",
"ȏ":"o",
"ꝋ&quot;:"o",
"ꝍ&quot;:"o",
"ⱺ&quot;:"o",
"ō":"o",
"ṓ&quot;:"o",
"ṑ&quot;:"o",
"ǫ":"o",
"ǭ":"o",
"ø":"o",
"ǿ":"o",
"õ":"o",
"ṍ&quot;:"o",
"ṏ&quot;:"o",
"ȭ":"o",
"ƣ":"oi",
"ꝏ&quot;:"oo",
"ɛ":"e",
"ᶓ&quot;:"e",
"ɔ":"o",
"ᶗ&quot;:"o",
"ȣ":"ou",
"ṕ&quot;:"p",
"ṗ&quot;:"p",
"ꝓ&quot;:"p",
"ƥ":"p",
"ᵱ&quot;:"p",
"ᶈ&quot;:"p",
"ꝕ&quot;:"p",
"ᵽ&quot;:"p",
"ꝑ&quot;:"p",
"ꝙ&quot;:"q",
"ʠ":"q",
"ɋ":"q",
"ꝗ&quot;:"q",
"ŕ":"r",
"ř":"r",
"ŗ":"r",
"ṙ&quot;:"r",
"ṛ&quot;:"r",
"ṝ&quot;:"r",
"ȑ":"r",
"ɾ":"r",
"ᵳ&quot;:"r",
"ȓ":"r",
"ṟ&quot;:"r",
"ɼ":"r",
"ᵲ&quot;:"r",
"ᶉ&quot;:"r",
"ɍ":"r",
"ɽ":"r",
"ↄ&quot;:"c",
"ꜿ&quot;:"c",
"ɘ":"e",
"ɿ":"r",
"ś":"s",
"ṥ&quot;:"s",
"š":"s",
"ṧ&quot;:"s",
"ş":"s",
"ŝ":"s",
"ș":"s",
"ṡ&quot;:"s",
"ṣ&quot;:"s",
"ṩ&quot;:"s",
"ʂ":"s",
"ᵴ&quot;:"s",
"ᶊ&quot;:"s",
"ȿ":"s",
"ɡ":"g",
"ᴑ&quot;:"o",
"ᴓ&quot;:"o",
"ᴝ&quot;:"u",
"ť":"t",
"ţ":"t",
"ṱ&quot;:"t",
"ț":"t",
"ȶ":"t",
"ẗ&quot;:"t",
"ⱦ&quot;:"t",
"ṫ&quot;:"t",
"ṭ&quot;:"t",
"ƭ":"t",
"ṯ&quot;:"t",
"ᵵ&quot;:"t",
"ƫ":"t",
"ʈ":"t",
"ŧ":"t",
"ᵺ&quot;:"th",
"ɐ":"a",
"ᴂ&quot;:"ae",
"ǝ":"e",
"ᵷ&quot;:"g",
"ɥ":"h",
"ʮ":"h",
"ʯ":"h",
"ᴉ&quot;:"i",
"ʞ":"k",
"ꞁ&quot;:"l",
"ɯ":"m",
"ɰ":"m",
"ᴔ&quot;:"oe",
"ɹ":"r",
"ɻ":"r",
"ɺ":"r",
"ⱹ&quot;:"r",
"ʇ":"t",
"ʌ":"v",
"ʍ":"w",
"ʎ":"y",
"ꜩ&quot;:"tz",
"ú":"u",
"ŭ":"u",
"ǔ":"u",
"û":"u",
"ṷ&quot;:"u",
"ü":"u",
"ǘ":"u",
"ǚ":"u",
"ǜ":"u",
"ǖ":"u",
"ṳ&quot;:"u",
"ụ&quot;:"u",
"ű":"u",
"ȕ":"u",
"ù":"u",
"ủ&quot;:"u",
"ư":"u",
"ứ&quot;:"u",
"ự&quot;:"u",
"ừ&quot;:"u",
"ử&quot;:"u",
"ữ&quot;:"u",
"ȗ":"u",
"ū":"u",
"ṻ&quot;:"u",
"ų":"u",
"ᶙ&quot;:"u",
"ů":"u",
"ũ":"u",
"ṹ&quot;:"u",
"ṵ&quot;:"u",
"ᵫ&quot;:"ue",
"ꝸ&quot;:"um",
"ⱴ&quot;:"v",
"ꝟ&quot;:"v",
"ṿ&quot;:"v",
"ʋ":"v",
"ᶌ&quot;:"v",
"ⱱ&quot;:"v",
"ṽ&quot;:"v",
"ꝡ&quot;:"vy",
"ẃ&quot;:"w",
"ŵ":"w",
"ẅ&quot;:"w",
"ẇ&quot;:"w",
"ẉ&quot;:"w",
"ẁ&quot;:"w",
"ⱳ&quot;:"w",
"ẘ&quot;:"w",
"ẍ&quot;:"x",
"ẋ&quot;:"x",
"ᶍ&quot;:"x",
"ý":"y",
"ŷ":"y",
"ÿ":"y",
"ẏ&quot;:"y",
"ỵ&quot;:"y",
"ỳ&quot;:"y",
"ƴ":"y",
"ỷ&quot;:"y",
"ỿ&quot;:"y",
"ȳ":"y",
"ẙ&quot;:"y",
"ɏ":"y",
"ỹ&quot;:"y",
"ź":"z",
"ž":"z",
"ẑ&quot;:"z",
"ʑ":"z",
"ⱬ&quot;:"z",
"ż":"z",
"ẓ&quot;:"z",
"ȥ":"z",
"ẕ&quot;:"z",
"ᵶ&quot;:"z",
"ᶎ&quot;:"z",
"ʐ":"z",
"ƶ":"z",
"ɀ":"z",
"ﬀ":"ff",
"ﬃ&quot;:"ffi",
"ﬄ&quot;:"ffl",
"ﬁ&quot;:"fi",
"ﬂ&quot;:"fl",
"ĳ":"ij",
"œ":"oe",
"ﬆ&quot;:"st",
"ₐ&quot;:"a",
"ₑ&quot;:"e",
"ᵢ&quot;:"i",
"ⱼ&quot;:"j",
"ₒ&quot;:"o",
"ᵣ&quot;:"r",
"ᵤ&quot;:"u",
"ᵥ&quot;:"v",
"ₓ&quot;:"x"};
String.prototype.latinise=function(){return this.replace(/[^A-Za-z0-9\[\] ]/g,function(a){return Latinise.latin_map[a]||a})};
String.prototype.latinize=String.prototype.latinise;
String.prototype.isLatin=function(){return this==this.latinise()} 
```

一些例子：

```
> "Piqué".latinize();
"Pique"
> "Piqué".isLatin();
false
> "Pique".isLatin();
true
> "Piqué".latinise().isLatin();
true 
```

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2008-11-13T15:06:21.023

我无法谈论您要专门针对函数本身做什么，但是如果您不喜欢每次都构建正则表达式，这里有两个解决方案和一些关于每个解决方案的警告。

这是执行此操作的一种方法：

```
function makeSortString(s) {
  if(!makeSortString.translate_re) makeSortString.translate_re = /[öäüÖÄÜ]/g;
  var translate = {
    "ä": "a", "ö": "o", "ü": "u",
    "Ä": "A", "Ö": "O", "Ü": "U"   // probably more to come
  };
  return ( s.replace(makeSortString.translate_re, function(match) { 
    return translate[match]; 
  }) );
} 
```

这显然会使正则表达式成为函数本身的属性。唯一你可能不喜欢这个（或者你可能，我猜这取决于）是现在可以在函数体之外修改正则表达式。因此，有人可以这样做来修改内部使用的正则表达式：

```
makeSortString.translate_re = /[a-z]/g; 
```

所以，有这个选项。

获得闭包从而防止某人修改正则表达式的一种方法是将其定义为匿名函数赋值，如下所示：

```
var makeSortString = (function() {
  var translate_re = /[öäüÖÄÜ]/g;
  return function(s) {
    var translate = {
      "ä": "a", "ö": "o", "ü": "u",
      "Ä": "A", "Ö": "O", "Ü": "U"   // probably more to come
    };
    return ( s.replace(translate_re, function(match) { 
      return translate[match]; 
    }) );
  }
})(); 
```

希望这对您有用。

* * *

更新：现在还早，我不知道为什么我之前没有看到明显的东西，但是将你`translate`的对象放在一个闭包中也可能很有用：

```
var makeSortString = (function() {
  var translate_re = /[öäüÖÄÜ]/g;
  var translate = {
    "ä": "a", "ö": "o", "ü": "u",
    "Ä": "A", "Ö": "O", "Ü": "U"   // probably more to come
  };
  return function(s) {
    return ( s.replace(translate_re, function(match) { 
      return translate[match]; 
    }) );
  }
})(); 
```

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2013-08-10T09:09:10.377

这种口音的正确术语是*Diacritics*。在谷歌搜索这个术语后，我发现[这个函数](https://github.com/backbone-paginator/backbone.paginator/blob/master/plugins/diacritic.js)是`backbone.paginator`. 它有一个非常完整的变音符号集合，并用最直观的 ascii 字符替换它们。我发现这是当今可用的最完整的 Javascript 解决方案。

完整功能供日后参考：

```
function removeDiacritics (str) {

  var defaultDiacriticsRemovalMap = [
    {'base':'A', 'letters':/[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F]/g},
    {'base':'AA','letters':/[\uA732]/g},
    {'base':'AE','letters':/[\u00C6\u01FC\u01E2]/g},
    {'base':'AO','letters':/[\uA734]/g},
    {'base':'AU','letters':/[\uA736]/g},
    {'base':'AV','letters':/[\uA738\uA73A]/g},
    {'base':'AY','letters':/[\uA73C]/g},
    {'base':'B', 'letters':/[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181]/g},
    {'base':'C', 'letters':/[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E]/g},
    {'base':'D', 'letters':/[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779]/g},
    {'base':'DZ','letters':/[\u01F1\u01C4]/g},
    {'base':'Dz','letters':/[\u01F2\u01C5]/g},
    {'base':'E', 'letters':/[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E]/g},
    {'base':'F', 'letters':/[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B]/g},
    {'base':'G', 'letters':/[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E]/g},
    {'base':'H', 'letters':/[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D]/g},
    {'base':'I', 'letters':/[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197]/g},
    {'base':'J', 'letters':/[\u004A\u24BF\uFF2A\u0134\u0248]/g},
    {'base':'K', 'letters':/[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2]/g},
    {'base':'L', 'letters':/[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780]/g},
    {'base':'LJ','letters':/[\u01C7]/g},
    {'base':'Lj','letters':/[\u01C8]/g},
    {'base':'M', 'letters':/[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C]/g},
    {'base':'N', 'letters':/[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4]/g},
    {'base':'NJ','letters':/[\u01CA]/g},
    {'base':'Nj','letters':/[\u01CB]/g},
    {'base':'O', 'letters':/[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C]/g},
    {'base':'OI','letters':/[\u01A2]/g},
    {'base':'OO','letters':/[\uA74E]/g},
    {'base':'OU','letters':/[\u0222]/g},
    {'base':'P', 'letters':/[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754]/g},
    {'base':'Q', 'letters':/[\u0051\u24C6\uFF31\uA756\uA758\u024A]/g},
    {'base':'R', 'letters':/[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782]/g},
    {'base':'S', 'letters':/[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784]/g},
    {'base':'T', 'letters':/[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786]/g},
    {'base':'TZ','letters':/[\uA728]/g},
    {'base':'U', 'letters':/[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244]/g},
    {'base':'V', 'letters':/[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245]/g},
    {'base':'VY','letters':/[\uA760]/g},
    {'base':'W', 'letters':/[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72]/g},
    {'base':'X', 'letters':/[\u0058\u24CD\uFF38\u1E8A\u1E8C]/g},
    {'base':'Y', 'letters':/[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE]/g},
    {'base':'Z', 'letters':/[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762]/g},
    {'base':'a', 'letters':/[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250]/g},
    {'base':'aa','letters':/[\uA733]/g},
    {'base':'ae','letters':/[\u00E6\u01FD\u01E3]/g},
    {'base':'ao','letters':/[\uA735]/g},
    {'base':'au','letters':/[\uA737]/g},
    {'base':'av','letters':/[\uA739\uA73B]/g},
    {'base':'ay','letters':/[\uA73D]/g},
    {'base':'b', 'letters':/[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253]/g},
    {'base':'c', 'letters':/[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184]/g},
    {'base':'d', 'letters':/[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A]/g},
    {'base':'dz','letters':/[\u01F3\u01C6]/g},
    {'base':'e', 'letters':/[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD]/g},
    {'base':'f', 'letters':/[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C]/g},
    {'base':'g', 'letters':/[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F]/g},
    {'base':'h', 'letters':/[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265]/g},
    {'base':'hv','letters':/[\u0195]/g},
    {'base':'i', 'letters':/[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131]/g},
    {'base':'j', 'letters':/[\u006A\u24D9\uFF4A\u0135\u01F0\u0249]/g},
    {'base':'k', 'letters':/[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3]/g},
    {'base':'l', 'letters':/[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747]/g},
    {'base':'lj','letters':/[\u01C9]/g},
    {'base':'m', 'letters':/[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F]/g},
    {'base':'n', 'letters':/[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5]/g},
    {'base':'nj','letters':/[\u01CC]/g},
    {'base':'o', 'letters':/[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275]/g},
    {'base':'oi','letters':/[\u01A3]/g},
    {'base':'ou','letters':/[\u0223]/g},
    {'base':'oo','letters':/[\uA74F]/g},
    {'base':'p','letters':/[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755]/g},
    {'base':'q','letters':/[\u0071\u24E0\uFF51\u024B\uA757\uA759]/g},
    {'base':'r','letters':/[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783]/g},
    {'base':'s','letters':/[\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B]/g},
    {'base':'t','letters':/[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787]/g},
    {'base':'tz','letters':/[\uA729]/g},
    {'base':'u','letters':/[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289]/g},
    {'base':'v','letters':/[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C]/g},
    {'base':'vy','letters':/[\uA761]/g},
    {'base':'w','letters':/[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73]/g},
    {'base':'x','letters':/[\u0078\u24E7\uFF58\u1E8B\u1E8D]/g},
    {'base':'y','letters':/[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF]/g},
    {'base':'z','letters':/[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763]/g}
  ];

  for(var i=0; i<defaultDiacriticsRemovalMap.length; i++) {
    str = str.replace(defaultDiacriticsRemovalMap[i].letters, defaultDiacriticsRemovalMap[i].base);
  }

  return str;

} 
```

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2018-04-18T14:01:49.630

[https://stackoverflow.com/a/37511463](https://stackoverflow.com/a/37511463)

> 使用 ES2015/ES6 [String.Prototype.Normalize()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/normalize)，
> 
> ```
> const str = "Crème Brulée"
> str.normalize('NFD').replace(/[\u0300-\u036f]/g, "")
> > 'Creme Brulee' 
> ```
> 
> 这里发生了两件事：
> 
> 1.  `normalize()`转换为`NFD`Unicode 范式将组合字素分解为简单字素的组合。`è`of最终`Crème`表示为`e`+ `̀`。
> 2.  使用正则表达式[字符类](http://www.regular-expressions.info/charclass.html)来匹配 U+0300 → U+036F 范围，现在很`g`容易摆脱变音符号，Unicode 标准方便地将其归类为[组合变音符号](https://en.wikipedia.org/wiki/Combining_Diacritical_Marks)Unicode 块。
> 
> 有关性能测试，请参阅评论。
> 
> **或者，如果您只想排序**
> 
> [Intl.Collat​​or](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Collator)目前有足够的支持[~85% ，](https://caniuse.com/#search=intl.collator)[这里](https://github.com/andyearnshaw/Intl.js/)也有一个polyfill，但我还没有测试过。
> 
> ```
> const c = new Intl.Collator();
> ['creme brulee', 'crème brulée', 'crame brulai', 'crome brouillé',
> 'creme brulay', 'creme brulfé', 'creme bruléa'].sort(c.compare)
> [ 'crame brulai','creme brulay','creme bruléa','creme brulee',
> 'crème brulée','creme brulfé','crome brouillé' ]
> 
> ['creme brulee', 'crème brulée', 'crame brulai', 'crome brouillé'].sort((a,b) => a>b)
> ["crame brulai", "creme brulee", "crome brouillé", "crème brulée"] 
> ```

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2014-05-20T18:33:39.933

只需将链归一化并运行替换代码：

```
var str = "Letras Á É Í Ó Ú Ñ - á é í ó ú ñ...";
console.log (str.normalize ("NFKD").replace (/[\u0300-\u036F]/g, ""));
// Letras A E I O U N - a e i o u n... 
```

见[规范化](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/normalize)

然后你可以使用这个功能：

```
function noTilde (s) {
    if (s.normalize != undefined) {
        s = s.normalize ("NFKD");
    }
    return s.replace (/[\u0300-\u036F]/g, "");
} 
```

* * *

## 回答 #6

> 赞同：17
> 
> 时间：2011-12-13T14:19:35.940

我认为这可能会更干净/更好（尽管我没有测试它的性能）：

```
String.prototype.stripAccents = function() {
    var translate_re = /[àáâãäçèéêëìíîïñòóôõöùúûüýÿÀÁÂÃÄÇÈÉÊËÌÍÎÏÑÒÓÔÕÖÙÚÛÜÝ]/g;
    var translate = 'aaaaaceeeeiiiinooooouuuuyyAAAAACEEEEIIIINOOOOOUUUUY';
    return (this.replace(translate_re, function(match){
        return translate.substr(translate_re.source.indexOf(match)-1, 1); })
    );
}; 
```

或者，如果您仍然太担心性能，让我们两全其美：

```
String.prototype.stripAccents = function() {
    var in_chrs =  'àáâãäçèéêëìíîïñòóôõöùúûüýÿÀÁÂÃÄÇÈÉÊËÌÍÎÏÑÒÓÔÕÖÙÚÛÜÝ',
        out_chrs = 'aaaaaceeeeiiiinooooouuuuyyAAAAACEEEEIIIINOOOOOUUUUY', 
        transl = {};
    eval('var chars_rgx = /['+in_chrs+']/g');
    for(var i = 0; i < in_chrs.length; i++){ transl[in_chrs.charAt(i)] = out_chrs.charAt(i); }
    return this.replace(chars_rgx, function(match){
        return transl[match]; });
}; 
```

* * *

**编辑**（@Tomalak）

我很欣赏这个主意。但是，如以下评论中所述，实施存在一些问题。

这是我将如何实现它。

```
var stripAccents = (function () {
  var in_chrs   = 'àáâãäçèéêëìíîïñòóôõöùúûüýÿÀÁÂÃÄÇÈÉÊËÌÍÎÏÑÒÓÔÕÖÙÚÛÜÝ',
      out_chrs  = 'aaaaaceeeeiiiinooooouuuuyyAAAAACEEEEIIIINOOOOOUUUUY', 
      chars_rgx = new RegExp('[' + in_chrs + ']', 'g'),
      transl    = {}, i,
      lookup    = function (m) { return transl[m] || m; };

  for (i=0; i<in_chrs.length; i++) {
    transl[ in_chrs[i] ] = out_chrs[i];
  }

  return function (s) { return s.replace(chars_rgx, lookup); }
})(); 
```

* * *

## 回答 #7

> 赞同：16
> 
> 时间：2009-03-05T11:27:07.567

基于 Jason Bunting 的解决方案，这是我现在使用的解决方案。

整个事情都是针对[jQuery 表格排序器插件的](http://tablesorter.com/docs/)：对于使用表格排序器插件对非英文表格进行（几乎正确）排序，有必要使用自定义[`textExtraction`函数](http://tablesorter.com/docs/#Configuration)。

这个：

*   将最常见的重音字母转换为非重音字母（支持的字母列表很容易扩展）
*   将德语格式 ( `'dd.mm.yyyy'`) 的日期更改为可识别的格式 ( `'yyyy-mm-dd'`)

小心以 UTF-8 编码保存 JavaScript 文件，否则它将无法工作。

```
// file encoding must be UTF-8!
function getTextExtractor()
{
  return (function() {
    var patternLetters = /[öäüÖÄÜáàâéèêúùûóòôÁÀÂÉÈÊÚÙÛÓÒÔß]/g;
    var patternDateDmy = /^(?:\D+)?(\d{1,2})\.(\d{1,2})\.(\d{2,4})$/;
    var lookupLetters = {
      "ä": "a", "ö": "o", "ü": "u",
      "Ä": "A", "Ö": "O", "Ü": "U",
      "á": "a", "à": "a", "â": "a",
      "é": "e", "è": "e", "ê": "e",
      "ú": "u", "ù": "u", "û": "u",
      "ó": "o", "ò": "o", "ô": "o",
      "Á": "A", "À": "A", "Â": "A",
      "É": "E", "È": "E", "Ê": "E",
      "Ú": "U", "Ù": "U", "Û": "U",
      "Ó": "O", "Ò": "O", "Ô": "O",
      "ß": "s"
    };
    var letterTranslator = function(match) { 
      return lookupLetters[match] || match;
    }

    return function(node) {
      var text = $.trim($(node).text());
      var date = text.match(patternDateDmy);
      if (date)
        return [date[3], date[2], date[1]].join("-");
      else
        return text.replace(patternLetters, letterTranslator);
    }
  })();
} 
```

你可以像这样使用它：

```
$("table.sortable").tablesorter({ 
  textExtraction: getTextExtractor()
}); 
```

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2013-07-17T08:24:47.097

您的要求的完整解决方案是：

```
function convert_accented_characters(str){
    var conversions = new Object();
    conversions['ae'] = 'ä|æ|ǽ';
    conversions['oe'] = 'ö|œ';
    conversions['ue'] = 'ü';
    conversions['Ae'] = 'Ä';
    conversions['Ue'] = 'Ü';
    conversions['Oe'] = 'Ö';
    conversions['A'] = 'À|Á|Â|Ã|Ä|Å|Ǻ|Ā|Ă|Ą|Ǎ';
    conversions['a'] = 'à|á|â|ã|å|ǻ|ā|ă|ą|ǎ|ª';
    conversions['C'] = 'Ç|Ć|Ĉ|Ċ|Č';
    conversions['c'] = 'ç|ć|ĉ|ċ|č';
    conversions['D'] = 'Ð|Ď|Đ';
    conversions['d'] = 'ð|ď|đ';
    conversions['E'] = 'È|É|Ê|Ë|Ē|Ĕ|Ė|Ę|Ě';
    conversions['e'] = 'è|é|ê|ë|ē|ĕ|ė|ę|ě';
    conversions['G'] = 'Ĝ|Ğ|Ġ|Ģ';
    conversions['g'] = 'ĝ|ğ|ġ|ģ';
    conversions['H'] = 'Ĥ|Ħ';
    conversions['h'] = 'ĥ|ħ';
    conversions['I'] = 'Ì|Í|Î|Ï|Ĩ|Ī|Ĭ|Ǐ|Į|İ';
    conversions['i'] = 'ì|í|î|ï|ĩ|ī|ĭ|ǐ|į|ı';
    conversions['J'] = 'Ĵ';
    conversions['j'] = 'ĵ';
    conversions['K'] = 'Ķ';
    conversions['k'] = 'ķ';
    conversions['L'] = 'Ĺ|Ļ|Ľ|Ŀ|Ł';
    conversions['l'] = 'ĺ|ļ|ľ|ŀ|ł';
    conversions['N'] = 'Ñ|Ń|Ņ|Ň';
    conversions['n'] = 'ñ|ń|ņ|ň|ŉ';
    conversions['O'] = 'Ò|Ó|Ô|Õ|Ō|Ŏ|Ǒ|Ő|Ơ|Ø|Ǿ';
    conversions['o'] = 'ò|ó|ô|õ|ō|ŏ|ǒ|ő|ơ|ø|ǿ|º';
    conversions['R'] = 'Ŕ|Ŗ|Ř';
    conversions['r'] = 'ŕ|ŗ|ř';
    conversions['S'] = 'Ś|Ŝ|Ş|Š';
    conversions['s'] = 'ś|ŝ|ş|š|ſ';
    conversions['T'] = 'Ţ|Ť|Ŧ';
    conversions['t'] = 'ţ|ť|ŧ';
    conversions['U'] = 'Ù|Ú|Û|Ũ|Ū|Ŭ|Ů|Ű|Ų|Ư|Ǔ|Ǖ|Ǘ|Ǚ|Ǜ';
    conversions['u'] = 'ù|ú|û|ũ|ū|ŭ|ů|ű|ų|ư|ǔ|ǖ|ǘ|ǚ|ǜ';
    conversions['Y'] = 'Ý|Ÿ|Ŷ';
    conversions['y'] = 'ý|ÿ|ŷ';
    conversions['W'] = 'Ŵ';
    conversions['w'] = 'ŵ';
    conversions['Z'] = 'Ź|Ż|Ž';
    conversions['z'] = 'ź|ż|ž';
    conversions['AE'] = 'Æ|Ǽ';
    conversions['ss'] = 'ß';
    conversions['IJ'] = 'Ĳ';
    conversions['ij'] = 'ĳ';
    conversions['OE'] = 'Œ';
    conversions['f'] = 'ƒ';
    for(var i in conversions){
        var re = new RegExp(conversions[i],"g");
        str = str.replace(re,i);
    }
    return str;
} 
```

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2018-08-16T10:05:08.803

我想不出比使用这个[惊人的解决方案](https://stackoverflow.com/a/37511463/5061000)更简单的方法来有效地从字符串中删除**所有**变音符号。

看看它的实际效果：

```
var string = "öäüÖÄÜ";

var string_norm = string.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
console.log(string_norm);
```

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2017-02-23T02:19:30.570

如果您正在寻找一种将重音字符转换为非重音字符的方法，而不是一种对重音字符进行排序的方法，只需稍加修改，就可以操纵 String.localeCompare 函数来查找匹配的基本拉丁字符扩展的。例如，您可能希望从页面标题生成对人类友好的 url slug。如果是这样，您可以执行以下操作：

```
var baseChars = [];
for (var i = 97; i < 97 + 26; i++) {
  baseChars.push(String.fromCharCode(i));
}

//if needed, handle fancy compound characters
baseChars = baseChars.concat('ss,aa,ae,ao,au,av,ay,dz,hv,lj,nj,oi,ou,oo,tz,vy'.split(','));

function isUpperCase(c) { return c !== c.toLocaleLowerCase() }

function toBaseChar(c, opts) {
  opts = opts || {};
  //if (!('nonAlphaChar' in opts)) opts.nonAlphaChar = '';
  //if (!('noMatchChar' in opts)) opts.noMatchChar = '';
  if (!('locale' in opts)) opts.locale = 'en';

  var cOpts = {sensitivity: 'base'};

  //exit early for any non-alphabetical character
  if (c.localeCompare('9', opts.locale, cOpts) <= 0) return opts.nonAlphaChar === undefined ? c : opts.nonAlphaChar;

  for (var i = 0; i < baseChars.length; i++) {
    var baseChar = baseChars[i];

    var comp = c.localeCompare(baseChar, opts.locale, cOpts);
    if (comp == 0) return (isUpperCase(c)) ? baseChar.toUpperCase() : baseChar;
  }

  return opts.noMatchChar === undefined ? c : opts.noMatchChar;
}

function latinify(str, opts) {
  return str.replace(/[^\w\s\d]/g, function(c) {
    return toBaseChar(c, opts);
  })
}

// Example:
console.log(latinify('Čeština Tsėhesenėstsestotse Tshivenḓa Emigliàn–Rumagnòl Slovenščina Português Tiếng Việt Straße'))

// "Cestina Tsehesenestsestotse Tshivenda Emiglian–Rumagnol Slovenscina Portugues Tieng Viet Strasse"
```

这应该执行得很好，但是如果需要进一步优化，可以使用二分搜索`localeCompare`作为比较器来定位基本字符。请注意，保留大小写，选项允许保留、替换或删除非字母字符，或者没有匹配的拉丁字符可以替换。此实现更快、更灵活，并且应该在添加新字符时使用它们。缺点是像“ꝡ”这样的复合字符如果需要被支持，就必须特别处理。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2011-05-25T11:17:49.287

我制作了一个原型版本：

```
String.prototype.strip = function() {
  var translate_re = /[öäüÖÄÜß ]/g;
  var translate = {
    "ä":"a", "ö":"o", "ü":"u",
    "Ä":"A", "Ö":"O", "Ü":"U",
    " ":"_", "ß":"ss"   // probably more to come
  };
    return (this.replace(translate_re, function(match){
        return translate[match];})
    );
}; 
```

像这样使用：

```
var teststring = 'ä ö ü Ä Ö Ü ß';
teststring.strip(); 
```

这会将字符串更改为 a_o_u_A_O_U_ss

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2016-04-10T22:37:59.617

根据现有的答案和一些建议，我创建了这个：

```
String.prototype.removeAccents = function() {

    var removalMap = {
        'A'  : /[AⒶＡÀÁÂẦẤẪẨÃĀĂẰẮẴẲȦǠÄǞẢÅǺǍȀȂẠẬẶḀĄ]/g,
        'AA' : /[Ꜳ]/g,
        'AE' : /[ÆǼǢ]/g,
        'AO' : /[Ꜵ]/g,
        'AU' : /[Ꜷ]/g,
        'AV' : /[ꜸꜺ]/g,
        'AY' : /[Ꜽ]/g,
        'B'  : /[BⒷＢḂḄḆɃƂƁ]/g,
        'C'  : /[CⒸＣĆĈĊČÇḈƇȻꜾ]/g,
        'D'  : /[DⒹＤḊĎḌḐḒḎĐƋƊƉꝹ]/g,
        'DZ' : /[ǱǄ]/g,
        'Dz' : /[ǲǅ]/g,
        'E'  : /[EⒺＥÈÉÊỀẾỄỂẼĒḔḖĔĖËẺĚȄȆẸỆȨḜĘḘḚƐƎ]/g,
        'F'  : /[FⒻＦḞƑꝻ]/g,
        'G'  : /[GⒼＧǴĜḠĞĠǦĢǤƓꞠꝽꝾ]/g,
        'H'  : /[HⒽＨĤḢḦȞḤḨḪĦⱧⱵꞍ]/g,
        'I'  : /[IⒾＩÌÍÎĨĪĬİÏḮỈǏȈȊỊĮḬƗ]/g,
        'J'  : /[JⒿＪĴɈ]/g,
        'K'  : /[KⓀＫḰǨḲĶḴƘⱩꝀꝂꝄꞢ]/g,
        'L'  : /[LⓁＬĿĹĽḶḸĻḼḺŁȽⱢⱠꝈꝆꞀ]/g,
        'LJ' : /[Ǉ]/g,
        'Lj' : /[ǈ]/g,
        'M'  : /[MⓂＭḾṀṂⱮƜ]/g,
        'N'  : /[NⓃＮǸŃÑṄŇṆŅṊṈȠƝꞐꞤ]/g,
        'NJ' : /[Ǌ]/g,
        'Nj' : /[ǋ]/g,
        'O'  : /[OⓄＯÒÓÔỒỐỖỔÕṌȬṎŌṐṒŎȮȰÖȪỎŐǑȌȎƠỜỚỠỞỢỌỘǪǬØǾƆƟꝊꝌ]/g,
        'OI' : /[Ƣ]/g,
        'OO' : /[Ꝏ]/g,
        'OU' : /[Ȣ]/g,
        'P'  : /[PⓅＰṔṖƤⱣꝐꝒꝔ]/g,
        'Q'  : /[QⓆＱꝖꝘɊ]/g,
        'R'  : /[RⓇＲŔṘŘȐȒṚṜŖṞɌⱤꝚꞦꞂ]/g,
        'S'  : /[SⓈＳẞŚṤŜṠŠṦṢṨȘŞⱾꞨꞄ]/g,
        'T'  : /[TⓉＴṪŤṬȚŢṰṮŦƬƮȾꞆ]/g,
        'TZ' : /[Ꜩ]/g,
        'U'  : /[UⓊＵÙÚÛŨṸŪṺŬÜǛǗǕǙỦŮŰǓȔȖƯỪỨỮỬỰỤṲŲṶṴɄ]/g,
        'V'  : /[VⓋＶṼṾƲꝞɅ]/g,
        'VY' : /[Ꝡ]/g,
        'W'  : /[WⓌＷẀẂŴẆẄẈⱲ]/g,
        'X'  : /[XⓍＸẊẌ]/g,
        'Y'  : /[YⓎＹỲÝŶỸȲẎŸỶỴƳɎỾ]/g,
        'Z'  : /[ZⓏＺŹẐŻŽẒẔƵȤⱿⱫꝢ]/g,
        'a'  : /[aⓐａẚàáâầấẫẩãāăằắẵẳȧǡäǟảåǻǎȁȃạậặḁąⱥɐ]/g,
        'aa' : /[ꜳ]/g,
        'ae' : /[æǽǣ]/g,
        'ao' : /[ꜵ]/g,
        'au' : /[ꜷ]/g,
        'av' : /[ꜹꜻ]/g,
        'ay' : /[ꜽ]/g,
        'b'  : /[bⓑｂḃḅḇƀƃɓ]/g,
        'c'  : /[cⓒｃćĉċčçḉƈȼꜿↄ]/g,
        'd'  : /[dⓓｄḋďḍḑḓḏđƌɖɗꝺ]/g,
        'dz' : /[ǳǆ]/g,
        'e'  : /[eⓔｅèéêềếễểẽēḕḗĕėëẻěȅȇẹệȩḝęḙḛɇɛǝ]/g,
        'f'  : /[fⓕｆḟƒꝼ]/g,
        'g'  : /[gⓖｇǵĝḡğġǧģǥɠꞡᵹꝿ]/g,
        'h'  : /[hⓗｈĥḣḧȟḥḩḫẖħⱨⱶɥ]/g,
        'hv' : /[ƕ]/g,
        'i'  : /[iⓘｉìíîĩīĭïḯỉǐȉȋịįḭɨı]/g,
        'j'  : /[jⓙｊĵǰɉ]/g,
        'k'  : /[kⓚｋḱǩḳķḵƙⱪꝁꝃꝅꞣ]/g,
        'l'  : /[lⓛｌŀĺľḷḹļḽḻſłƚɫⱡꝉꞁꝇ]/g,
        'lj' : /[ǉ]/g,
        'm'  : /[mⓜｍḿṁṃɱɯ]/g,
        'n'  : /[nⓝｎǹńñṅňṇņṋṉƞɲŉꞑꞥ]/g,
        'nj' : /[ǌ]/g,
        'o'  : /[oⓞｏòóôồốỗổõṍȭṏōṑṓŏȯȱöȫỏőǒȍȏơờớỡởợọộǫǭøǿɔꝋꝍɵ]/g,
        'oi' : /[ƣ]/g,
        'ou' : /[ȣ]/g,
        'oo' : /[ꝏ]/g,
        'p'  : /[pⓟｐṕṗƥᵽꝑꝓꝕ]/g,
        'q'  : /[qⓠｑɋꝗꝙ]/g,
        'r'  : /[rⓡｒŕṙřȑȓṛṝŗṟɍɽꝛꞧꞃ]/g,
        's'  : /[sⓢｓßśṥŝṡšṧṣṩșşȿꞩꞅẛ]/g,
        't'  : /[tⓣｔṫẗťṭțţṱṯŧƭʈⱦꞇ]/g,
        'tz' : /[ꜩ]/g,
        'u'  : /[uⓤｕùúûũṹūṻŭüǜǘǖǚủůűǔȕȗưừứữửựụṳųṷṵʉ]/g,
        'v'  : /[vⓥｖṽṿʋꝟʌ]/g,
        'vy' : /[ꝡ]/g,
        'w'  : /[wⓦｗẁẃŵẇẅẘẉⱳ]/g,
        'x'  : /[xⓧｘẋẍ]/g,
        'y'  : /[yⓨｙỳýŷỹȳẏÿỷẙỵƴɏỿ]/g,
        'z'  : /[zⓩｚźẑżžẓẕƶȥɀⱬꝣ]/g,
    };

    var str = this;

    for(var latin in removalMap) {
      var nonLatin = removalMap[latin];
      str = str.replace(nonLatin , latin);
    }

    return str;
} 
```

它使用真正的字符而不是 unicode 列表并且运行良好。

你可以像这样使用它

```
"ąąą".removeAccents(); // returns "aaa" 
```

您可以轻松地将此函数转换为不是字符串原型。但是，由于我喜欢在这种情况下使用字符串原型，因此您必须自己动手。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2013-06-01T20:56:11.437

Kierons 解决方案的 javascript 的直接端口：[https](https://github.com/rwarasaurus/nano/blob/master/system/helpers.php#L61-73) ://github.com/rwarasaurus/nano/blob/master/system/helpers.php#L61-73 ：

```
/**
 * Normalise a string replacing foreign characters
 *
 * @param {String} str
 * @return {String} str
 */

var normalize = (function () {
    var a = ['À', 'Á', 'Â', 'Ã', 'Ä', 'Å', 'Æ', 'Ç', 'È', 'É', 'Ê', 'Ë', 'Ì', 'Í', 'Î', 'Ï', 'Ð', 'Ñ', 'Ò', 'Ó', 'Ô', 'Õ', 'Ö', 'Ø', 'Ù', 'Ú', 'Û', 'Ü', 'Ý', 'ß', 'à', 'á', 'â', 'ã', 'ä', 'å', 'æ', 'ç', 'è', 'é', 'ê', 'ë', 'ì', 'í', 'î', 'ï', 'ñ', 'ò', 'ó', 'ô', 'õ', 'ö', 'ø', 'ù', 'ú', 'û', 'ü', 'ý', 'ÿ', 'Ā', 'ā', 'Ă', 'ă', 'Ą', 'ą', 'Ć', 'ć', 'Ĉ', 'ĉ', 'Ċ', 'ċ', 'Č', 'č', 'Ď', 'ď', 'Đ', 'đ', 'Ē', 'ē', 'Ĕ', 'ĕ', 'Ė', 'ė', 'Ę', 'ę', 'Ě', 'ě', 'Ĝ', 'ĝ', 'Ğ', 'ğ', 'Ġ', 'ġ', 'Ģ', 'ģ', 'Ĥ', 'ĥ', 'Ħ', 'ħ', 'Ĩ', 'ĩ', 'Ī', 'ī', 'Ĭ', 'ĭ', 'Į', 'į', 'İ', 'ı', 'Ĳ', 'ĳ', 'Ĵ', 'ĵ', 'Ķ', 'ķ', 'Ĺ', 'ĺ', 'Ļ', 'ļ', 'Ľ', 'ľ', 'Ŀ', 'ŀ', 'Ł', 'ł', 'Ń', 'ń', 'Ņ', 'ņ', 'Ň', 'ň', 'ŉ', 'Ō', 'ō', 'Ŏ', 'ŏ', 'Ő', 'ő', 'Œ', 'œ', 'Ŕ', 'ŕ', 'Ŗ', 'ŗ', 'Ř', 'ř', 'Ś', 'ś', 'Ŝ', 'ŝ', 'Ş', 'ş', 'Š', 'š', 'Ţ', 'ţ', 'Ť', 'ť', 'Ŧ', 'ŧ', 'Ũ', 'ũ', 'Ū', 'ū', 'Ŭ', 'ŭ', 'Ů', 'ů', 'Ű', 'ű', 'Ų', 'ų', 'Ŵ', 'ŵ', 'Ŷ', 'ŷ', 'Ÿ', 'Ź', 'ź', 'Ż', 'ż', 'Ž', 'ž', 'ſ', 'ƒ', 'Ơ', 'ơ', 'Ư', 'ư', 'Ǎ', 'ǎ', 'Ǐ', 'ǐ', 'Ǒ', 'ǒ', 'Ǔ', 'ǔ', 'Ǖ', 'ǖ', 'Ǘ', 'ǘ', 'Ǚ', 'ǚ', 'Ǜ', 'ǜ', 'Ǻ', 'ǻ', 'Ǽ', 'ǽ', 'Ǿ', 'ǿ'];
    var b = ['A', 'A', 'A', 'A', 'A', 'A', 'AE', 'C', 'E', 'E', 'E', 'E', 'I', 'I', 'I', 'I', 'D', 'N', 'O', 'O', 'O', 'O', 'O', 'O', 'U', 'U', 'U', 'U', 'Y', 's', 'a', 'a', 'a', 'a', 'a', 'a', 'ae', 'c', 'e', 'e', 'e', 'e', 'i', 'i', 'i', 'i', 'n', 'o', 'o', 'o', 'o', 'o', 'o', 'u', 'u', 'u', 'u', 'y', 'y', 'A', 'a', 'A', 'a', 'A', 'a', 'C', 'c', 'C', 'c', 'C', 'c', 'C', 'c', 'D', 'd', 'D', 'd', 'E', 'e', 'E', 'e', 'E', 'e', 'E', 'e', 'E', 'e', 'G', 'g', 'G', 'g', 'G', 'g', 'G', 'g', 'H', 'h', 'H', 'h', 'I', 'i', 'I', 'i', 'I', 'i', 'I', 'i', 'I', 'i', 'IJ', 'ij', 'J', 'j', 'K', 'k', 'L', 'l', 'L', 'l', 'L', 'l', 'L', 'l', 'l', 'l', 'N', 'n', 'N', 'n', 'N', 'n', 'n', 'O', 'o', 'O', 'o', 'O', 'o', 'OE', 'oe', 'R', 'r', 'R', 'r', 'R', 'r', 'S', 's', 'S', 's', 'S', 's', 'S', 's', 'T', 't', 'T', 't', 'T', 't', 'U', 'u', 'U', 'u', 'U', 'u', 'U', 'u', 'U', 'u', 'U', 'u', 'W', 'w', 'Y', 'y', 'Y', 'Z', 'z', 'Z', 'z', 'Z', 'z', 's', 'f', 'O', 'o', 'U', 'u', 'A', 'a', 'I', 'i', 'O', 'o', 'U', 'u', 'U', 'u', 'U', 'u', 'U', 'u', 'U', 'u', 'A', 'a', 'AE', 'ae', 'O', 'o'];

    return function (str) {
        var i = a.length;
        while (i--) str = str.replace(a[i], b[i]);
        return str;
    };
}()); 
```

还有一个稍微修改的版本，使用一个字符映射而不是两个数组：

为了比较这两种方法，我做了一个简单的基准测试：http: [//jsperf.com/replace-foreign-characters](http://jsperf.com/replace-foreign-characters)

```
/**
 * Normalise a string replacing foreign characters
 *
 * @param {String} str
 * @return {String}
 */
var normalize = (function () {
    var map = {
            "À": "A",
            "Á": "A",
            "Â": "A",
            "Ã": "A",
            "Ä": "A",
            "Å": "A",
            "Æ": "AE",
            "Ç": "C",
            "È": "E",
            "É": "E",
            "Ê": "E",
            "Ë": "E",
            "Ì": "I",
            "Í": "I",
            "Î": "I",
            "Ï": "I",
            "Ð": "D",
            "Ñ": "N",
            "Ò": "O",
            "Ó": "O",
            "Ô": "O",
            "Õ": "O",
            "Ö": "O",
            "Ø": "O",
            "Ù": "U",
            "Ú": "U",
            "Û": "U",
            "Ü": "U",
            "Ý": "Y",
            "ß": "s",
            "à": "a",
            "á": "a",
            "â": "a",
            "ã": "a",
            "ä": "a",
            "å": "a",
            "æ": "ae",
            "ç": "c",
            "è": "e",
            "é": "e",
            "ê": "e",
            "ë": "e",
            "ì": "i",
            "í": "i",
            "î": "i",
            "ï": "i",
            "ñ": "n",
            "ò": "o",
            "ó": "o",
            "ô": "o",
            "õ": "o",
            "ö": "o",
            "ø": "o",
            "ù": "u",
            "ú": "u",
            "û": "u",
            "ü": "u",
            "ý": "y",
            "ÿ": "y",
            "Ā": "A",
            "ā": "a",
            "Ă": "A",
            "ă": "a",
            "Ą": "A",
            "ą": "a",
            "Ć": "C",
            "ć": "c",
            "Ĉ": "C",
            "ĉ": "c",
            "Ċ": "C",
            "ċ": "c",
            "Č": "C",
            "č": "c",
            "Ď": "D",
            "ď": "d",
            "Đ": "D",
            "đ": "d",
            "Ē": "E",
            "ē": "e",
            "Ĕ": "E",
            "ĕ": "e",
            "Ė": "E",
            "ė": "e",
            "Ę": "E",
            "ę": "e",
            "Ě": "E",
            "ě": "e",
            "Ĝ": "G",
            "ĝ": "g",
            "Ğ": "G",
            "ğ": "g",
            "Ġ": "G",
            "ġ": "g",
            "Ģ": "G",
            "ģ": "g",
            "Ĥ": "H",
            "ĥ": "h",
            "Ħ": "H",
            "ħ": "h",
            "Ĩ": "I",
            "ĩ": "i",
            "Ī": "I",
            "ī": "i",
            "Ĭ": "I",
            "ĭ": "i",
            "Į": "I",
            "į": "i",
            "İ": "I",
            "ı": "i",
            "Ĳ": "IJ",
            "ĳ": "ij",
            "Ĵ": "J",
            "ĵ": "j",
            "Ķ": "K",
            "ķ": "k",
            "Ĺ": "L",
            "ĺ": "l",
            "Ļ": "L",
            "ļ": "l",
            "Ľ": "L",
            "ľ": "l",
            "Ŀ": "L",
            "ŀ": "l",
            "Ł": "l",
            "ł": "l",
            "Ń": "N",
            "ń": "n",
            "Ņ": "N",
            "ņ": "n",
            "Ň": "N",
            "ň": "n",
            "ŉ": "n",
            "Ō": "O",
            "ō": "o",
            "Ŏ": "O",
            "ŏ": "o",
            "Ő": "O",
            "ő": "o",
            "Œ": "OE",
            "œ": "oe",
            "Ŕ": "R",
            "ŕ": "r",
            "Ŗ": "R",
            "ŗ": "r",
            "Ř": "R",
            "ř": "r",
            "Ś": "S",
            "ś": "s",
            "Ŝ": "S",
            "ŝ": "s",
            "Ş": "S",
            "ş": "s",
            "Š": "S",
            "š": "s",
            "Ţ": "T",
            "ţ": "t",
            "Ť": "T",
            "ť": "t",
            "Ŧ": "T",
            "ŧ": "t",
            "Ũ": "U",
            "ũ": "u",
            "Ū": "U",
            "ū": "u",
            "Ŭ": "U",
            "ŭ": "u",
            "Ů": "U",
            "ů": "u",
            "Ű": "U",
            "ű": "u",
            "Ų": "U",
            "ų": "u",
            "Ŵ": "W",
            "ŵ": "w",
            "Ŷ": "Y",
            "ŷ": "y",
            "Ÿ": "Y",
            "Ź": "Z",
            "ź": "z",
            "Ż": "Z",
            "ż": "z",
            "Ž": "Z",
            "ž": "z",
            "ſ": "s",
            "ƒ": "f",
            "Ơ": "O",
            "ơ": "o",
            "Ư": "U",
            "ư": "u",
            "Ǎ": "A",
            "ǎ": "a",
            "Ǐ": "I",
            "ǐ": "i",
            "Ǒ": "O",
            "ǒ": "o",
            "Ǔ": "U",
            "ǔ": "u",
            "Ǖ": "U",
            "ǖ": "u",
            "Ǘ": "U",
            "ǘ": "u",
            "Ǚ": "U",
            "ǚ": "u",
            "Ǜ": "U",
            "ǜ": "u",
            "Ǻ": "A",
            "ǻ": "a",
            "Ǽ": "AE",
            "ǽ": "ae",
            "Ǿ": "O",
            "ǿ": "o"
        },
        nonWord = /\W/g,
        mapping = function (c) {
            return map[c] || c; 
        };

    return function (str) {
        return str.replace(nonWord, mapping);
    };
}()); 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2017-02-10T15:29:04.363

没有一个答案提到[`String.localeCompare`](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/String/localeCompare)，它恰好做了你最初想要的，但不是你要求的。

```
var list = ['a', 'b', 'c', 'o', 'u', 'z', 'ä', 'ö', 'ü'];

list.sort((a, b) => a.localeCompare(b));

console.log(list);

//Outputs ['a', 'ä', 'b', 'c', 'o', 'ö', 'u', 'ü', 'z'] 
```

旧版浏览器不支持第二个和第三个参数。尽管如此，这是一个值得考虑的选择。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2017-05-24T14:59:52.820

我只是想使用[String#localeCompare发布我的解决方案](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/localeCompare)

```
const base_chars = [
  '1', '2', '3', '4', '5', '6', '7', '8', '9',
  '0', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h',
  'i', 'j', 'k', 'l', 'm', 'n', 'o', 'p', 'q',
  'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z',
  '-', '_', ' '
];
const fix = str => str.normalize('NFKD').split('')
    .map(c => base_chars.find(bc => bc.localeCompare(c, 'en', { sensitivity: 'base' })==0))
    .join('');

const str = 'OÒ óëå-123';
console.log(`fix(${str}) = ${fix(str)}`);
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2015-08-17T12:30:58.567

很久以前，我在 Java 中做到了这一点，并找到了基于单个字符串的其他人的解决方案，该字符串捕获了对转换很重要的 Unicode 表的一部分——其余的被转换为 ? 或任何其他替换字符。所以我尝试将其转换为 JavaScript。请注意，我不是 JS 专家。:-)

```
TAB_00C0 = "AAAAAAACEEEEIIII" +
    "DNOOOOO*OUUUUYIs" +
    "aaaaaaaceeeeiiii" +
    "?nooooo/ouuuuy?y" +
    "AaAaAaCcCcCcCcDd" +
    "DdEeEeEeEeEeGgGg" +
    "GgGgHhHhIiIiIiIi" +
    "IiJjJjKkkLlLlLlL" +
    "lLlNnNnNnnNnOoOo" +
    "OoOoRrRrRrSsSsSs" +
    "SsTtTtTtUuUuUuUu" +
    "UuUuWwYyYZzZzZzF";

function stripDiacritics(source) {
    var result = source.split('');
    for (var i = 0; i < result.length; i++) {
        var c = source.charCodeAt(i);
        if (c >= 0x00c0 && c <= 0x017f) {
            result[i] = String.fromCharCode(TAB_00C0.charCodeAt(c - 0x00c0));
        } else if (c > 127) {
            result[i] = '?';
        }
    }
    return result.join('');
}

stripDiacritics("Šupa, čo? ľšťčžýæøåℌð") 
```

这会转换大部分 latin1+2 Unicode 字符。它无法将单个字符转换为多个字符。我不知道它在 JS 上的性能，在 Java 中这是迄今为止最快的常见解决方案（6-50x），没有地图，没有正则表达式，什么都没有。它产生严格的 ASCII 输出，可能会丢失信息，但输出的大小与输入匹配。

[我使用http://www.webtoolkitonline.com/javascript-tester.html](http://www.webtoolkitonline.com/javascript-tester.html)测试了该片段，它`Supa, co? lstczyaoa??`按预期生成。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2012-07-22T09:04:03.403

如果你想实现排序，其中“ä”出现在“a”之后并且不被视为相同，那么你可以使用像我这样的函数。

您可以随时更改字母表以获得不同甚至奇怪的排序。但是，如果您希望某些字母等效，则必须操作类似`a = a.replace(/ä/, 'a')`或类似的字符串，正如上面许多人已经回答的那样。如果有人想在所有小写单词之前包含所有大写单词，我已经包含了大写字母（那么你必须 ommit `.toLowerCase()`）。

```
function sortbyalphabet(a,b) {
        alphabet = "0123456789AaÀàÁáÂâÃãÄäBbCcÇçDdÈèÉéÊêËëFfGgHhÌìÍíÎîÏïJjKkLlMmNnÑñOoÒòÓóÔôÕõÖöPpQqRrSsTtÙùÚúÛûÜüVvWwXxÝýŸÿZz";
        a = a.toLowerCase();
        b = b.toLowerCase();
        shorterone = (a.length > b.length ? a : b);
        for (i=0; i<shorterone.length; i++){
            diff = alphabet.indexOf(a.charAt(i)) - alphabet.indexOf(b.charAt(i));
            if (diff!=0){
                return diff;
            }
        }
        // sort the shorter first
        return a.length - b.length;
    }
    var n = ["ast", "Äste", "apfel", "äpfel", "à"];
    console.log(n.sort(sortbyalphabet));
    // should return ["apfel", "ast", "à", "äpfel", "äste"] 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2017-02-07T16:37:18.687

一个简单易行的方法：

```
function remove-accents(p){
c='áàãâäéèêëíìîïóòõôöúùûüçÁÀÃÂÄÉÈÊËÍÌÎÏÓÒÕÖÔÚÙÛÜÇ';s='aaaaaeeeeiiiiooooouuuucAAAAAEEEEIIIIOOOOOUUUUC';n='';for(i=0;i<p.length;i++){if(c.search(p.substr(i,1))>=0){n+=s.substr(c.search(p.substr(i,1)),1);} else{n+=p.substr(i,1);}} return n;
} 
```

所以这样做：

```
remove-accents("Thís ís ân accêntéd phráse"); 
```

输出：

```
"This is an accented phrase" 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2018-06-13T13:55:12.810

回答 os Crisalin 几乎是完美的。只是提高了性能以避免在每次运行时创建新的 RegExp。

```
var normalizeConversions = [
    { regex: new RegExp('ä|æ|ǽ', 'g'), clean: 'ae' },
    { regex: new RegExp('ö|œ', 'g'), clean: 'oe' },
    { regex: new RegExp('ü', 'g'), clean: 'ue' },
    { regex: new RegExp('Ä', 'g'), clean: 'Ae' },
    { regex: new RegExp('Ü', 'g'), clean: 'Ue' },
    { regex: new RegExp('Ö', 'g'), clean: 'Oe' },
    { regex: new RegExp('À|Á|Â|Ã|Ä|Å|Ǻ|Ā|Ă|Ą|Ǎ', 'g'), clean: 'A' },
    { regex: new RegExp('à|á|â|ã|å|ǻ|ā|ă|ą|ǎ|ª', 'g'), clean: 'a' },
    { regex: new RegExp('Ç|Ć|Ĉ|Ċ|Č', 'g'), clean: 'C' },
    { regex: new RegExp('ç|ć|ĉ|ċ|č', 'g'), clean: 'c' },
    { regex: new RegExp('Ð|Ď|Đ', 'g'), clean: 'D' },
    { regex: new RegExp('ð|ď|đ', 'g'), clean: 'd' },
    { regex: new RegExp('È|É|Ê|Ë|Ē|Ĕ|Ė|Ę|Ě', 'g'), clean: 'E' },
    { regex: new RegExp('è|é|ê|ë|ē|ĕ|ė|ę|ě', 'g'), clean: 'e' },
    { regex: new RegExp('Ĝ|Ğ|Ġ|Ģ', 'g'), clean: 'G' },
    { regex: new RegExp('ĝ|ğ|ġ|ģ', 'g'), clean: 'g' },
    { regex: new RegExp('Ĥ|Ħ', 'g'), clean: 'H' },
    { regex: new RegExp('ĥ|ħ', 'g'), clean: 'h' },
    { regex: new RegExp('Ì|Í|Î|Ï|Ĩ|Ī|Ĭ|Ǐ|Į|İ', 'g'), clean: 'I' },
    { regex: new RegExp('ì|í|î|ï|ĩ|ī|ĭ|ǐ|į|ı', 'g'), clean: 'i' },
    { regex: new RegExp('Ĵ', 'g'), clean: 'J' },
    { regex: new RegExp('ĵ', 'g'), clean: 'j' },
    { regex: new RegExp('Ķ', 'g'), clean: 'K' },
    { regex: new RegExp('ķ', 'g'), clean: 'k' },
    { regex: new RegExp('Ĺ|Ļ|Ľ|Ŀ|Ł', 'g'), clean: 'L' },
    { regex: new RegExp('ĺ|ļ|ľ|ŀ|ł', 'g'), clean: 'l' },
    { regex: new RegExp('Ñ|Ń|Ņ|Ň', 'g'), clean: 'N' },
    { regex: new RegExp('ñ|ń|ņ|ň|ŉ', 'g'), clean: 'n' },
    { regex: new RegExp('Ò|Ó|Ô|Õ|Ō|Ŏ|Ǒ|Ő|Ơ|Ø|Ǿ', 'g'), clean: 'O' },
    { regex: new RegExp('ò|ó|ô|õ|ō|ŏ|ǒ|ő|ơ|ø|ǿ|º', 'g'), clean: 'o' },
    { regex: new RegExp('Ŕ|Ŗ|Ř', 'g'), clean: 'R' },
    { regex: new RegExp('ŕ|ŗ|ř', 'g'), clean: 'r' },
    { regex: new RegExp('Ś|Ŝ|Ş|Š', 'g'), clean: 'S' },
    { regex: new RegExp('ś|ŝ|ş|š|ſ', 'g'), clean: 's' },
    { regex: new RegExp('Ţ|Ť|Ŧ', 'g'), clean: 'T' },
    { regex: new RegExp('ţ|ť|ŧ', 'g'), clean: 't' },
    { regex: new RegExp('Ù|Ú|Û|Ũ|Ū|Ŭ|Ů|Ű|Ų|Ư|Ǔ|Ǖ|Ǘ|Ǚ|Ǜ', 'g'), clean: 'U' },
    { regex: new RegExp('ù|ú|û|ũ|ū|ŭ|ů|ű|ų|ư|ǔ|ǖ|ǘ|ǚ|ǜ', 'g'), clean: 'u' },
    { regex: new RegExp('Ý|Ÿ|Ŷ', 'g'), clean: 'Y' },
    { regex: new RegExp('ý|ÿ|ŷ', 'g'), clean: 'y' },
    { regex: new RegExp('Ŵ', 'g'), clean: 'W' },
    { regex: new RegExp('ŵ', 'g'), clean: 'w' },
    { regex: new RegExp('Ź|Ż|Ž', 'g'), clean: 'Z' },
    { regex: new RegExp('ź|ż|ž', 'g'), clean: 'z' },
    { regex: new RegExp('Æ|Ǽ', 'g'), clean: 'AE' },
    { regex: new RegExp('ß', 'g'), clean: 'ss' },
    { regex: new RegExp('Ĳ', 'g'), clean: 'IJ' },
    { regex: new RegExp('ĳ', 'g'), clean: 'ij' },
    { regex: new RegExp('Œ', 'g'), clean: 'OE' },
    { regex: new RegExp('ƒ', 'g'), clean: 'f' }
]; 
```

用法：

```
function(str){
    normalizeConversions.forEach(function(normalizeEntry){
        str = str.replace(normalizeEntry.regex, normalizeEntry.clean);
    });
    return str;
}; 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2016-12-30T18:42:04.937

**如果你愿意，我已经用另一种方式解决了。**

这里我使用了两个数组，其中包含将被替换的***searchChars***和包含所需字符的***replaceChars 。***

```
var text = "your input string";
var searchChars = ['Å','Ä','å','Ö','ö']; // add more charecter.
var replaceChars = ['A','A','a','O','o']; // exact same index to searchChars.
var index;
for (var i = 0; i < text.length; i++) {
  if( $.inArray(text[i], searchChars) >-1 ){ // $.inArray() is from jquery.
    index = searchChars.indexOf(text[i]);
    text = text.slice(0, i) + replaceChars[index] + text.slice(i+1,text.length);
  }
}
```

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2019-01-07T13:48:53.873

对于使用**TypeScript**的小伙子和不想处理字符串原型的人，这里是**Ed. 答案**的 typescript 版本：

```
 // Usage example:
    "Some string".replace(/[^a-zA-Z0-9-_]/g, char => ToLatinMap.get(char) || '')

    // Map:
    export let ToLatinMap: Map<string, string> = new Map<string, string>([
        ["Á", "A"],
        ["Ă", "A"],
        ["Ắ", "A"],
        ["Ặ", "A"],
        ["Ằ", "A"],
        ["Ẳ", "A"],
        ["Ẵ", "A"],
        ["Ǎ", "A"],
        ["Â", "A"],
        ["Ấ", "A"],
        ["Ậ", "A"],
        ["Ầ", "A"],
        ["Ẩ", "A"],
        ["Ẫ", "A"],
        ["Ä", "A"],
        ["Ǟ", "A"],
        ["Ȧ", "A"],
        ["Ǡ", "A"],
        ["Ạ", "A"],
        ["Ȁ", "A"],
        ["À", "A"],
        ["Ả", "A"],
        ["Ȃ", "A"],
        ["Ā", "A"],
        ["Ą", "A"],
        ["Å", "A"],
        ["Ǻ", "A"],
        ["Ḁ", "A"],
        ["Ⱥ", "A"],
        ["Ã", "A"],
        ["Ꜳ", "AA"],
        ["Æ", "AE"],
        ["Ǽ", "AE"],
        ["Ǣ", "AE"],
        ["Ꜵ", "AO"],
        ["Ꜷ", "AU"],
        ["Ꜹ", "AV"],
        ["Ꜻ", "AV"],
        ["Ꜽ", "AY"],
        ["Ḃ", "B"],
        ["Ḅ", "B"],
        ["Ɓ", "B"],
        ["Ḇ", "B"],
        ["Ƀ", "B"],
        ["Ƃ", "B"],
        ["Ć", "C"],
        ["Č", "C"],
        ["Ç", "C"],
        ["Ḉ", "C"],
        ["Ĉ", "C"],
        ["Ċ", "C"],
        ["Ƈ", "C"],
        ["Ȼ", "C"],
        ["Ď", "D"],
        ["Ḑ", "D"],
        ["Ḓ", "D"],
        ["Ḋ", "D"],
        ["Ḍ", "D"],
        ["Ɗ", "D"],
        ["Ḏ", "D"],
        ["ǲ", "D"],
        ["ǅ", "D"],
        ["Đ", "D"],
        ["Ƌ", "D"],
        ["Ǳ", "DZ"],
        ["Ǆ", "DZ"],
        ["É", "E"],
        ["Ĕ", "E"],
        ["Ě", "E"],
        ["Ȩ", "E"],
        ["Ḝ", "E"],
        ["Ê", "E"],
        ["Ế", "E"],
        ["Ệ", "E"],
        ["Ề", "E"],
        ["Ể", "E"],
        ["Ễ", "E"],
        ["Ḙ", "E"],
        ["Ë", "E"],
        ["Ė", "E"],
        ["Ẹ", "E"],
        ["Ȅ", "E"],
        ["È", "E"],
        ["Ẻ", "E"],
        ["Ȇ", "E"],
        ["Ē", "E"],
        ["Ḗ", "E"],
        ["Ḕ", "E"],
        ["Ę", "E"],
        ["Ɇ", "E"],
        ["Ẽ", "E"],
        ["Ḛ", "E"],
        ["Ꝫ", "ET"],
        ["Ḟ", "F"],
        ["Ƒ", "F"],
        ["Ǵ", "G"],
        ["Ğ", "G"],
        ["Ǧ", "G"],
        ["Ģ", "G"],
        ["Ĝ", "G"],
        ["Ġ", "G"],
        ["Ɠ", "G"],
        ["Ḡ", "G"],
        ["Ǥ", "G"],
        ["Ḫ", "H"],
        ["Ȟ", "H"],
        ["Ḩ", "H"],
        ["Ĥ", "H"],
        ["Ⱨ", "H"],
        ["Ḧ", "H"],
        ["Ḣ", "H"],
        ["Ḥ", "H"],
        ["Ħ", "H"],
        ["Í", "I"],
        ["Ĭ", "I"],
        ["Ǐ", "I"],
        ["Î", "I"],
        ["Ï", "I"],
        ["Ḯ", "I"],
        ["İ", "I"],
        ["Ị", "I"],
        ["Ȉ", "I"],
        ["Ì", "I"],
        ["Ỉ", "I"],
        ["Ȋ", "I"],
        ["Ī", "I"],
        ["Į", "I"],
        ["Ɨ", "I"],
        ["Ĩ", "I"],
        ["Ḭ", "I"],
        ["Ꝺ", "D"],
        ["Ꝼ", "F"],
        ["Ᵹ", "G"],
        ["Ꞃ", "R"],
        ["Ꞅ", "S"],
        ["Ꞇ", "T"],
        ["Ꝭ", "IS"],
        ["Ĵ", "J"],
        ["Ɉ", "J"],
        ["Ḱ", "K"],
        ["Ǩ", "K"],
        ["Ķ", "K"],
        ["Ⱪ", "K"],
        ["Ꝃ", "K"],
        ["Ḳ", "K"],
        ["Ƙ", "K"],
        ["Ḵ", "K"],
        ["Ꝁ", "K"],
        ["Ꝅ", "K"],
        ["Ĺ", "L"],
        ["Ƚ", "L"],
        ["Ľ", "L"],
        ["Ļ", "L"],
        ["Ḽ", "L"],
        ["Ḷ", "L"],
        ["Ḹ", "L"],
        ["Ⱡ", "L"],
        ["Ꝉ", "L"],
        ["Ḻ", "L"],
        ["Ŀ", "L"],
        ["Ɫ", "L"],
        ["ǈ", "L"],
        ["Ł", "L"],
        ["Ǉ", "LJ"],
        ["Ḿ", "M"],
        ["Ṁ", "M"],
        ["Ṃ", "M"],
        ["Ɱ", "M"],
        ["Ń", "N"],
        ["Ň", "N"],
        ["Ņ", "N"],
        ["Ṋ", "N"],
        ["Ṅ", "N"],
        ["Ṇ", "N"],
        ["Ǹ", "N"],
        ["Ɲ", "N"],
        ["Ṉ", "N"],
        ["Ƞ", "N"],
        ["ǋ", "N"],
        ["Ñ", "N"],
        ["Ǌ", "NJ"],
        ["Ó", "O"],
        ["Ŏ", "O"],
        ["Ǒ", "O"],
        ["Ô", "O"],
        ["Ố", "O"],
        ["Ộ", "O"],
        ["Ồ", "O"],
        ["Ổ", "O"],
        ["Ỗ", "O"],
        ["Ö", "O"],
        ["Ȫ", "O"],
        ["Ȯ", "O"],
        ["Ȱ", "O"],
        ["Ọ", "O"],
        ["Ő", "O"],
        ["Ȍ", "O"],
        ["Ò", "O"],
        ["Ỏ", "O"],
        ["Ơ", "O"],
        ["Ớ", "O"],
        ["Ợ", "O"],
        ["Ờ", "O"],
        ["Ở", "O"],
        ["Ỡ", "O"],
        ["Ȏ", "O"],
        ["Ꝋ", "O"],
        ["Ꝍ", "O"],
        ["Ō", "O"],
        ["Ṓ", "O"],
        ["Ṑ", "O"],
        ["Ɵ", "O"],
        ["Ǫ", "O"],
        ["Ǭ", "O"],
        ["Ø", "O"],
        ["Ǿ", "O"],
        ["Õ", "O"],
        ["Ṍ", "O"],
        ["Ṏ", "O"],
        ["Ȭ", "O"],
        ["Ƣ", "OI"],
        ["Ꝏ", "OO"],
        ["Ɛ", "E"],
        ["Ɔ", "O"],
        ["Ȣ", "OU"],
        ["Ṕ", "P"],
        ["Ṗ", "P"],
        ["Ꝓ", "P"],
        ["Ƥ", "P"],
        ["Ꝕ", "P"],
        ["Ᵽ", "P"],
        ["Ꝑ", "P"],
        ["Ꝙ", "Q"],
        ["Ꝗ", "Q"],
        ["Ŕ", "R"],
        ["Ř", "R"],
        ["Ŗ", "R"],
        ["Ṙ", "R"],
        ["Ṛ", "R"],
        ["Ṝ", "R"],
        ["Ȑ", "R"],
        ["Ȓ", "R"],
        ["Ṟ", "R"],
        ["Ɍ", "R"],
        ["Ɽ", "R"],
        ["Ꜿ", "C"],
        ["Ǝ", "E"],
        ["Ś", "S"],
        ["Ṥ", "S"],
        ["Š", "S"],
        ["Ṧ", "S"],
        ["Ş", "S"],
        ["Ŝ", "S"],
        ["Ș", "S"],
        ["Ṡ", "S"],
        ["Ṣ", "S"],
        ["Ṩ", "S"],
        ["Ť", "T"],
        ["Ţ", "T"],
        ["Ṱ", "T"],
        ["Ț", "T"],
        ["Ⱦ", "T"],
        ["Ṫ", "T"],
        ["Ṭ", "T"],
        ["Ƭ", "T"],
        ["Ṯ", "T"],
        ["Ʈ", "T"],
        ["Ŧ", "T"],
        ["Ɐ", "A"],
        ["Ꞁ", "L"],
        ["Ɯ", "M"],
        ["Ʌ", "V"],
        ["Ꜩ", "TZ"],
        ["Ú", "U"],
        ["Ŭ", "U"],
        ["Ǔ", "U"],
        ["Û", "U"],
        ["Ṷ", "U"],
        ["Ü", "U"],
        ["Ǘ", "U"],
        ["Ǚ", "U"],
        ["Ǜ", "U"],
        ["Ǖ", "U"],
        ["Ṳ", "U"],
        ["Ụ", "U"],
        ["Ű", "U"],
        ["Ȕ", "U"],
        ["Ù", "U"],
        ["Ủ", "U"],
        ["Ư", "U"],
        ["Ứ", "U"],
        ["Ự", "U"],
        ["Ừ", "U"],
        ["Ử", "U"],
        ["Ữ", "U"],
        ["Ȗ", "U"],
        ["Ū", "U"],
        ["Ṻ", "U"],
        ["Ų", "U"],
        ["Ů", "U"],
        ["Ũ", "U"],
        ["Ṹ", "U"],
        ["Ṵ", "U"],
        ["Ꝟ", "V"],
        ["Ṿ", "V"],
        ["Ʋ", "V"],
        ["Ṽ", "V"],
        ["Ꝡ", "VY"],
        ["Ẃ", "W"],
        ["Ŵ", "W"],
        ["Ẅ", "W"],
        ["Ẇ", "W"],
        ["Ẉ", "W"],
        ["Ẁ", "W"],
        ["Ⱳ", "W"],
        ["Ẍ", "X"],
        ["Ẋ", "X"],
        ["Ý", "Y"],
        ["Ŷ", "Y"],
        ["Ÿ", "Y"],
        ["Ẏ", "Y"],
        ["Ỵ", "Y"],
        ["Ỳ", "Y"],
        ["Ƴ", "Y"],
        ["Ỷ", "Y"],
        ["Ỿ", "Y"],
        ["Ȳ", "Y"],
        ["Ɏ", "Y"],
        ["Ỹ", "Y"],
        ["Ź", "Z"],
        ["Ž", "Z"],
        ["Ẑ", "Z"],
        ["Ⱬ", "Z"],
        ["Ż", "Z"],
        ["Ẓ", "Z"],
        ["Ȥ", "Z"],
        ["Ẕ", "Z"],
        ["Ƶ", "Z"],
        ["Ĳ", "IJ"],
        ["Œ", "OE"],
        ["ᴀ", "A"],
        ["ᴁ", "AE"],
        ["ʙ", "B"],
        ["ᴃ", "B"],
        ["ᴄ", "C"],
        ["ᴅ", "D"],
        ["ᴇ", "E"],
        ["ꜰ", "F"],
        ["ɢ", "G"],
        ["ʛ", "G"],
        ["ʜ", "H"],
        ["ɪ", "I"],
        ["ʁ", "R"],
        ["ᴊ", "J"],
        ["ᴋ", "K"],
        ["ʟ", "L"],
        ["ᴌ", "L"],
        ["ᴍ", "M"],
        ["ɴ", "N"],
        ["ᴏ", "O"],
        ["ɶ", "OE"],
        ["ᴐ", "O"],
        ["ᴕ", "OU"],
        ["ᴘ", "P"],
        ["ʀ", "R"],
        ["ᴎ", "N"],
        ["ᴙ", "R"],
        ["ꜱ", "S"],
        ["ᴛ", "T"],
        ["ⱻ", "E"],
        ["ᴚ", "R"],
        ["ᴜ", "U"],
        ["ᴠ", "V"],
        ["ᴡ", "W"],
        ["ʏ", "Y"],
        ["ᴢ", "Z"],
        ["á", "a"],
        ["ă", "a"],
        ["ắ", "a"],
        ["ặ", "a"],
        ["ằ", "a"],
        ["ẳ", "a"],
        ["ẵ", "a"],
        ["ǎ", "a"],
        ["â", "a"],
        ["ấ", "a"],
        ["ậ", "a"],
        ["ầ", "a"],
        ["ẩ", "a"],
        ["ẫ", "a"],
        ["ä", "a"],
        ["ǟ", "a"],
        ["ȧ", "a"],
        ["ǡ", "a"],
        ["ạ", "a"],
        ["ȁ", "a"],
        ["à", "a"],
        ["ả", "a"],
        ["ȃ", "a"],
        ["ā", "a"],
        ["ą", "a"],
        ["ᶏ", "a"],
        ["ẚ", "a"],
        ["å", "a"],
        ["ǻ", "a"],
        ["ḁ", "a"],
        ["ⱥ", "a"],
        ["ã", "a"],
        ["ꜳ", "aa"],
        ["æ", "ae"],
        ["ǽ", "ae"],
        ["ǣ", "ae"],
        ["ꜵ", "ao"],
        ["ꜷ", "au"],
        ["ꜹ", "av"],
        ["ꜻ", "av"],
        ["ꜽ", "ay"],
        ["ḃ", "b"],
        ["ḅ", "b"],
        ["ɓ", "b"],
        ["ḇ", "b"],
        ["ᵬ", "b"],
        ["ᶀ", "b"],
        ["ƀ", "b"],
        ["ƃ", "b"],
        ["ɵ", "o"],
        ["ć", "c"],
        ["č", "c"],
        ["ç", "c"],
        ["ḉ", "c"],
        ["ĉ", "c"],
        ["ɕ", "c"],
        ["ċ", "c"],
        ["ƈ", "c"],
        ["ȼ", "c"],
        ["ď", "d"],
        ["ḑ", "d"],
        ["ḓ", "d"],
        ["ȡ", "d"],
        ["ḋ", "d"],
        ["ḍ", "d"],
        ["ɗ", "d"],
        ["ᶑ", "d"],
        ["ḏ", "d"],
        ["ᵭ", "d"],
        ["ᶁ", "d"],
        ["đ", "d"],
        ["ɖ", "d"],
        ["ƌ", "d"],
        ["ı", "i"],
        ["ȷ", "j"],
        ["ɟ", "j"],
        ["ʄ", "j"],
        ["ǳ", "dz"],
        ["ǆ", "dz"],
        ["é", "e"],
        ["ĕ", "e"],
        ["ě", "e"],
        ["ȩ", "e"],
        ["ḝ", "e"],
        ["ê", "e"],
        ["ế", "e"],
        ["ệ", "e"],
        ["ề", "e"],
        ["ể", "e"],
        ["ễ", "e"],
        ["ḙ", "e"],
        ["ë", "e"],
        ["ė", "e"],
        ["ẹ", "e"],
        ["ȅ", "e"],
        ["è", "e"],
        ["ẻ", "e"],
        ["ȇ", "e"],
        ["ē", "e"],
        ["ḗ", "e"],
        ["ḕ", "e"],
        ["ⱸ", "e"],
        ["ę", "e"],
        ["ᶒ", "e"],
        ["ɇ", "e"],
        ["ẽ", "e"],
        ["ḛ", "e"],
        ["ꝫ", "et"],
        ["ḟ", "f"],
        ["ƒ", "f"],
        ["ᵮ", "f"],
        ["ᶂ", "f"],
        ["ǵ", "g"],
        ["ğ", "g"],
        ["ǧ", "g"],
        ["ģ", "g"],
        ["ĝ", "g"],
        ["ġ", "g"],
        ["ɠ", "g"],
        ["ḡ", "g"],
        ["ᶃ", "g"],
        ["ǥ", "g"],
        ["ḫ", "h"],
        ["ȟ", "h"],
        ["ḩ", "h"],
        ["ĥ", "h"],
        ["ⱨ", "h"],
        ["ḧ", "h"],
        ["ḣ", "h"],
        ["ḥ", "h"],
        ["ɦ", "h"],
        ["ẖ", "h"],
        ["ħ", "h"],
        ["ƕ", "hv"],
        ["í", "i"],
        ["ĭ", "i"],
        ["ǐ", "i"],
        ["î", "i"],
        ["ï", "i"],
        ["ḯ", "i"],
        ["ị", "i"],
        ["ȉ", "i"],
        ["ì", "i"],
        ["ỉ", "i"],
        ["ȋ", "i"],
        ["ī", "i"],
        ["į", "i"],
        ["ᶖ", "i"],
        ["ɨ", "i"],
        ["ĩ", "i"],
        ["ḭ", "i"],
        ["ꝺ", "d"],
        ["ꝼ", "f"],
        ["ᵹ", "g"],
        ["ꞃ", "r"],
        ["ꞅ", "s"],
        ["ꞇ", "t"],
        ["ꝭ", "is"],
        ["ǰ", "j"],
        ["ĵ", "j"],
        ["ʝ", "j"],
        ["ɉ", "j"],
        ["ḱ", "k"],
        ["ǩ", "k"],
        ["ķ", "k"],
        ["ⱪ", "k"],
        ["ꝃ", "k"],
        ["ḳ", "k"],
        ["ƙ", "k"],
        ["ḵ", "k"],
        ["ᶄ", "k"],
        ["ꝁ", "k"],
        ["ꝅ", "k"],
        ["ĺ", "l"],
        ["ƚ", "l"],
        ["ɬ", "l"],
        ["ľ", "l"],
        ["ļ", "l"],
        ["ḽ", "l"],
        ["ȴ", "l"],
        ["ḷ", "l"],
        ["ḹ", "l"],
        ["ⱡ", "l"],
        ["ꝉ", "l"],
        ["ḻ", "l"],
        ["ŀ", "l"],
        ["ɫ", "l"],
        ["ᶅ", "l"],
        ["ɭ", "l"],
        ["ł", "l"],
        ["ǉ", "lj"],
        ["ſ", "s"],
        ["ẜ", "s"],
        ["ẛ", "s"],
        ["ẝ", "s"],
        ["ḿ", "m"],
        ["ṁ", "m"],
        ["ṃ", "m"],
        ["ɱ", "m"],
        ["ᵯ", "m"],
        ["ᶆ", "m"],
        ["ń", "n"],
        ["ň", "n"],
        ["ņ", "n"],
        ["ṋ", "n"],
        ["ȵ", "n"],
        ["ṅ", "n"],
        ["ṇ", "n"],
        ["ǹ", "n"],
        ["ɲ", "n"],
        ["ṉ", "n"],
        ["ƞ", "n"],
        ["ᵰ", "n"],
        ["ᶇ", "n"],
        ["ɳ", "n"],
        ["ñ", "n"],
        ["ǌ", "nj"],
        ["ó", "o"],
        ["ŏ", "o"],
        ["ǒ", "o"],
        ["ô", "o"],
        ["ố", "o"],
        ["ộ", "o"],
        ["ồ", "o"],
        ["ổ", "o"],
        ["ỗ", "o"],
        ["ö", "o"],
        ["ȫ", "o"],
        ["ȯ", "o"],
        ["ȱ", "o"],
        ["ọ", "o"],
        ["ő", "o"],
        ["ȍ", "o"],
        ["ò", "o"],
        ["ỏ", "o"],
        ["ơ", "o"],
        ["ớ", "o"],
        ["ợ", "o"],
        ["ờ", "o"],
        ["ở", "o"],
        ["ỡ", "o"],
        ["ȏ", "o"],
        ["ꝋ", "o"],
        ["ꝍ", "o"],
        ["ⱺ", "o"],
        ["ō", "o"],
        ["ṓ", "o"],
        ["ṑ", "o"],
        ["ǫ", "o"],
        ["ǭ", "o"],
        ["ø", "o"],
        ["ǿ", "o"],
        ["õ", "o"],
        ["ṍ", "o"],
        ["ṏ", "o"],
        ["ȭ", "o"],
        ["ƣ", "oi"],
        ["ꝏ", "oo"],
        ["ɛ", "e"],
        ["ᶓ", "e"],
        ["ɔ", "o"],
        ["ᶗ", "o"],
        ["ȣ", "ou"],
        ["ṕ", "p"],
        ["ṗ", "p"],
        ["ꝓ", "p"],
        ["ƥ", "p"],
        ["ᵱ", "p"],
        ["ᶈ", "p"],
        ["ꝕ", "p"],
        ["ᵽ", "p"],
        ["ꝑ", "p"],
        ["ꝙ", "q"],
        ["ʠ", "q"],
        ["ɋ", "q"],
        ["ꝗ", "q"],
        ["ŕ", "r"],
        ["ř", "r"],
        ["ŗ", "r"],
        ["ṙ", "r"],
        ["ṛ", "r"],
        ["ṝ", "r"],
        ["ȑ", "r"],
        ["ɾ", "r"],
        ["ᵳ", "r"],
        ["ȓ", "r"],
        ["ṟ", "r"],
        ["ɼ", "r"],
        ["ᵲ", "r"],
        ["ᶉ", "r"],
        ["ɍ", "r"],
        ["ɽ", "r"],
        ["ↄ", "c"],
        ["ꜿ", "c"],
        ["ɘ", "e"],
        ["ɿ", "r"],
        ["ś", "s"],
        ["ṥ", "s"],
        ["š", "s"],
        ["ṧ", "s"],
        ["ş", "s"],
        ["ŝ", "s"],
        ["ș", "s"],
        ["ṡ", "s"],
        ["ṣ", "s"],
        ["ṩ", "s"],
        ["ʂ", "s"],
        ["ᵴ", "s"],
        ["ᶊ", "s"],
        ["ȿ", "s"],
        ["ɡ", "g"],
        ["ᴑ", "o"],
        ["ᴓ", "o"],
        ["ᴝ", "u"],
        ["ť", "t"],
        ["ţ", "t"],
        ["ṱ", "t"],
        ["ț", "t"],
        ["ȶ", "t"],
        ["ẗ", "t"],
        ["ⱦ", "t"],
        ["ṫ", "t"],
        ["ṭ", "t"],
        ["ƭ", "t"],
        ["ṯ", "t"],
        ["ᵵ", "t"],
        ["ƫ", "t"],
        ["ʈ", "t"],
        ["ŧ", "t"],
        ["ᵺ", "th"],
        ["ɐ", "a"],
        ["ᴂ", "ae"],
        ["ǝ", "e"],
        ["ᵷ", "g"],
        ["ɥ", "h"],
        ["ʮ", "h"],
        ["ʯ", "h"],
        ["ᴉ", "i"],
        ["ʞ", "k"],
        ["ꞁ", "l"],
        ["ɯ", "m"],
        ["ɰ", "m"],
        ["ᴔ", "oe"],
        ["ɹ", "r"],
        ["ɻ", "r"],
        ["ɺ", "r"],
        ["ⱹ", "r"],
        ["ʇ", "t"],
        ["ʌ", "v"],
        ["ʍ", "w"],
        ["ʎ", "y"],
        ["ꜩ", "tz"],
        ["ú", "u"],
        ["ŭ", "u"],
        ["ǔ", "u"],
        ["û", "u"],
        ["ṷ", "u"],
        ["ü", "u"],
        ["ǘ", "u"],
        ["ǚ", "u"],
        ["ǜ", "u"],
        ["ǖ", "u"],
        ["ṳ", "u"],
        ["ụ", "u"],
        ["ű", "u"],
        ["ȕ", "u"],
        ["ù", "u"],
        ["ủ", "u"],
        ["ư", "u"],
        ["ứ", "u"],
        ["ự", "u"],
        ["ừ", "u"],
        ["ử", "u"],
        ["ữ", "u"],
        ["ȗ", "u"],
        ["ū", "u"],
        ["ṻ", "u"],
        ["ų", "u"],
        ["ᶙ", "u"],
        ["ů", "u"],
        ["ũ", "u"],
        ["ṹ", "u"],
        ["ṵ", "u"],
        ["ᵫ", "ue"],
        ["ꝸ", "um"],
        ["ⱴ", "v"],
        ["ꝟ", "v"],
        ["ṿ", "v"],
        ["ʋ", "v"],
        ["ᶌ", "v"],
        ["ⱱ", "v"],
        ["ṽ", "v"],
        ["ꝡ", "vy"],
        ["ẃ", "w"],
        ["ŵ", "w"],
        ["ẅ", "w"],
        ["ẇ", "w"],
        ["ẉ", "w"],
        ["ẁ", "w"],
        ["ⱳ", "w"],
        ["ẘ", "w"],
        ["ẍ", "x"],
        ["ẋ", "x"],
        ["ᶍ", "x"],
        ["ý", "y"],
        ["ŷ", "y"],
        ["ÿ", "y"],
        ["ẏ", "y"],
        ["ỵ", "y"],
        ["ỳ", "y"],
        ["ƴ", "y"],
        ["ỷ", "y"],
        ["ỿ", "y"],
        ["ȳ", "y"],
        ["ẙ", "y"],
        ["ɏ", "y"],
        ["ỹ", "y"],
        ["ź", "z"],
        ["ž", "z"],
        ["ẑ", "z"],
        ["ʑ", "z"],
        ["ⱬ", "z"],
        ["ż", "z"],
        ["ẓ", "z"],
        ["ȥ", "z"],
        ["ẕ", "z"],
        ["ᵶ", "z"],
        ["ᶎ", "z"],
        ["ʐ", "z"],
        ["ƶ", "z"],
        ["ɀ", "z"],
        ["ﬀ", "ff"],
        ["ﬃ", "ffi"],
        ["ﬄ", "ffl"],
        ["ﬁ", "fi"],
        ["ﬂ", "fl"],
        ["ĳ", "ij"],
        ["œ", "oe"],
        ["ﬆ", "st"],
        ["ₐ", "a"],
        ["ₑ", "e"],
        ["ᵢ", "i"],
        ["ⱼ", "j"],
        ["ₒ", "o"],
        ["ᵣ", "r"],
        ["ᵤ", "u"],
        ["ᵥ", "v"],
        ["ₓ", "x"],
    ]); 
```

# c# - 带有引用类型参数的 Html.BuildUrlFromExpression 操作

> ID：286923
> 
> 赞同：1
> 
> 时间：2008-11-13T13:41:03.507
> 
> 标签：c#, asp.net-mvc, model-binding

*我希望我的术语是正确的。如果没有，请编辑。*

从我的 Linq2Sql 类中，我有一个 Color 类。我的控制器的一个动作接受这个 Color 类的一个实例。

我想创建一个指向此操作的链接，所以我使用

```
<%=Html.ActionLink<ColorController>(c=>c.Details(ViewData.Model.ActiveColor), "test")%> 
```

ViewData.Model.ActiveColor 当然是前面提到的 Color 实例。
这呈现如下：

> /Color/Details?color=- 不完全是我的想法。

我究竟做错了什么？我应该开始创建自定义 ModelBinders 吗？

**编辑**
我找到了“-”的来源。显然 ActionLink 正在调用 ToString。这很奇怪，因为我看到 tostring 更多的方式来显示一些东西然后识别一些东西（这不是 GetHash 的用途吗？）。即使在我的对象上实现了 Iserailizable 接口后，它仍然使用 ToString 方法。我可以在某处定义如何序列化我的类而不是使用 ToString() 吗？我觉得我完全走错了路。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-31T12:01:12.027

Actionlink 确实在调用 ToString()。我在使用日期时遇到了同样的问题。在我的网址中，我希望日期为 dd-mm-yyyy 而不是默认的 DateTime.ToString()。

第一个选项是覆盖您的 Color 的 ToString() 方法。如果这是不可能的（与 DateTime 一样）还有其他方法，但它们有点“hacky”......

# winapi - 如何构建 VB6 控制台应用程序

> ID：286924
> 
> 赞同：8
> 
> 时间：2008-11-13T13:41:04.503
> 
> 标签：winapi, vb6, console

我做了一些谷歌搜索试图回答这个问题，但即使在那之后我也不太清楚。是否可以从 VB6 创建控制台应用程序？

我有一个没有窗口的 VB6 应用程序。我一直认为它是一个控制台应用程序。但是，我希望能够在其中使用 Windows API SetConsoleCtrlHandler 函数。我相信对于 C++/MFC 应用程序，您必须设置链接器开关才能创建控制台应用程序。我的一位开发人员告诉我，VB6 不能创建真正的控制台应用程序，因此这行不通。那么是否有可能创建一个 Windows 将识别为来自 VB6 的控制台应用程序的控制台应用程序？

平台：Windows XP SP2

开发平台：VB6

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-13T13:44:16.853

是的。也可以创建完全无头的应用程序（我过去做过几次）。 [此链接](http://www.tek-tips.com/faqs.cfm?fid=5647)提供了一个带有代码片段的示例。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-11-13T17:47:15.257

您可以使用 Karl E. Peterson 在[http://vb.mvps.org/samples/Console/](http://vb.mvps.org/samples/Console/)上的代码 来创建一个功能非常齐全的控制台应用程序。

通过为控制台子系统重新链接已编译的 VB6 EXE 可以制作更简单的。卡尔在同一个网页上对此进行了介绍。向下滚动查看 LinkConsole.vbs。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-13T13:51:04.843

见这篇[文章](http://visualbasic.about.com/od/learnvb6/l/bldykvb6dosa.htm)。

或者您可以将 VB6 应用程序重写为 VBScript 程序。

# wcf - 通过脚本管理器访问 WCF

> ID：286927
> 
> 赞同：2
> 
> 时间：2008-11-13T13:42:06.437
> 
> 标签：wcf

问题：1

我是 WCF 的初学者，我采用了一个 Web 应用程序并托管在 IIS 上（带有一些端口（250）并添加了一个新的 WCF 文件，添加了一个操作合同并尝试通过 javascript 从客户端 Web 应用程序调用 WCF 服务，我无法获取 jsdebug 文件本身来检查是否创建了代理。

但是当我添加一个新的 AjaxEnabledWCF 文件并添加一个操作合同并尝试通过 javascript 从客户端 Web 应用程序调用 WCF 服务时，我能够获取 jsdebug 文件，我能够获取代理对象。

在客户端我有这样的代码。

.aspx

功能 TestWCF() { Service.DoWork(onsuccess,onError,true); } 功能成功（结果） { 警报（结果）；} 函数 onError(error) { alert("错误：" + error.message); } function onfailed(error) { var i = 'failed'; } 函数 oncompleted() { var i = '完成'; }

但是在调用操作合同时，我收到 404 错误并且无法找出问题所在

问题 2：有没有可能我可以将 WCF 文件转换为 AjaxEnabledWCF 文件类型

你能帮我么

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-28T17:00:20.433

这是调试问题的基本检查表：

*   检查您的 IIS 日志以确保请求到达它应该到达的位置。
*   检查 IIS 中允许请求通过的权限。
*   检查 web.config 中的身份验证/授权。
*   如果冒充是虚假的，检查应用程序池的身份权限
*   检查 WCF 服务文件所在磁盘上的安全设置。
*   确保 WCF 服务文件中引用的 dll 位于 bin 目录中。
*   检查 IIS 中的 ASP.net 是否设置为 2.0。

# asp.net - 如何使用依赖于 Session 对象的单元测试用户控件

> ID：286929
> 
> 赞同：1
> 
> 时间：2008-11-13T13:42:13.707
> 
> 标签：asp.net, user-controls, nunit, session

我正在使用 ASP.NET 构建一个应用程序和最新版本的 NUNIT 框架来测试它。我正在构建一个用户控件来构建一个自定义菜单。该控件有时会检查会话集合中是否存在特定对象以将某些元素添加到菜单中。

它提供的确切功能是：如果注册用户是普通用户，则显示常规链接集，如果注册用户是管理员，则向已显示的链接添加额外链接。控件按预期工作。

我的问题：
我想在 Web 应用程序之外进行控制，并在 NUNIT 测试框架内单独测试它。我唯一担心的是它依赖于 Session 对象的存在。我不知道如何在 nunit 测试方法中模拟它，如果可能的话，或者是否有我没有想到的替代解决方案。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T13:48:35.907

您将需要在正确的方向上抚摸框架，但您可以通过[模拟 http 上下文](http://righteousindignation.gotdns.org/blog/archive/2004/04/13/149.aspx)来做到这一点。

我倾向于将这样的操作包装在一个自定义类中，这样我可以更容易地模拟。

作为替代方案，您可能可以使用 mstest 的 Web 测试来获得相同的结果。

# asp.net - 如何在 Javascript 中获得有关 SaveFileDialog 的用户响应？

> ID：286932
> 
> 赞同：0
> 
> 时间：2008-11-13T13:43:28.087
> 
> 标签：asp.net, javascript

以下代码在 Page_Load 事件中实现，以向用户显示 SaveFileDialog

```
string targetFileName = Request.PhysicalApplicationPath + "Reports\\TempReports\\FolderMasters" + Utility.GetRandomNumber() + ".pdf";

FileInfo file = new FileInfo(targetFileName);
// Clear the content of the response.
Response.ClearContent();

Response.AddHeader("Content-Disposition", "attachment; filename=" + file.Name);
Response.AddHeader("Content-Length", file.Length.ToString());
Response.ContentType = "application/pdf";
Response.TransmitFile(file.FullName);
Response.End(); 
```

如何获得用户对 SaveFileDialog 的响应，因为我需要知道用户对此对话框的响应？

另外，这些代码行有问题吗，因为我有以下异常

“无法评估表达式，因为代码已优化或本机框架位于调用堆栈顶部。”

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T16:15:04.927

您无法获得用户对 SaveFileDialog 的响应，因为浏览器 JavaScript 已阻止所有文件事件，因为它可能是一个非常大的安全漏洞......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T14:09:44.867

我又来了，因为我得到了第二个问题的解决方案。

对于`Response.End`，调用`HttpContext.Current.ApplicationInstance.CompleteRequest`方法而不是 Response.End 以绕过代码执行到 Application_EndRequest 事件。

[看看...](http://support.microsoft.com/kb/312629/EN-US/)

# php - 在没有数据库或用户名的情况下使用 php 密码保护文件夹/页面的最佳方法是什么

> ID：286938
> 
> 赞同：23
> 
> 时间：2008-11-13T13:45:13.887
> 
> 标签：php, passwords, password-protection

使用没有数据库或用户名但使用 php 来密码保护文件夹的最佳方法是什么？基本上我有一个页面，将列出组织的联系人，并且需要密码保护该文件夹，而无需为每个用户提供帐户。只有一个密码会经常更改并分发给群组。我知道这不是很安全，但我更想知道如何做到这一点。以最好的方式。

如果用户正确输入密码后能暂时记住密码，那就太好了。

* * *

我大致按照大卫赫吉的建议做，除了没有饼干。它看起来确实不安全，但最好有一个糟糕的密码保护然后根本没有。

这是针对内部站点的，人们会花时间记住他们的登录名和密码，并且永远不会经历*注册* 过程……除非真的很容易，否则他们根本不会使用该系统。

我想看看这个问题的其他解决方案。

由于用户群由不太懂技术的人组成，还有其他方法可以做到这一点。

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2008-11-13T14:13:16.170

**编辑：SHA1 不再被认为是安全的。存储的密码哈希也应该[加盐](https://en.wikipedia.org/wiki/Salt_(cryptography))。现在有更好的解决方案来解决这个问题。**

* * *

你可以使用这样的东西：

```
//access.php

<?php
//put sha1() encrypted password here - example is 'hello'
$password = 'aaf4c61ddcc5e8a2dabede0f3b482cd9aea9434d';

session_start();
if (!isset($_SESSION['loggedIn'])) {
    $_SESSION['loggedIn'] = false;
}

if (isset($_POST['password'])) {
    if (sha1($_POST['password']) == $password) {
        $_SESSION['loggedIn'] = true;
    } else {
        die ('Incorrect password');
    }
} 

if (!$_SESSION['loggedIn']): ?>

<html><head><title>Login</title></head>
  <body>
    <p>You need to login</p>
    <form method="post">
      Password: <input type="password" name="password"> <br />
      <input type="submit" name="submit" value="Login">
    </form>
  </body>
</html>

<?php
exit();
endif;
?> 
```

然后在您要保护的每个文件上，放在顶部：

```
<?php
require('access.php');
?>
secret text 
```

这不是一个很好的解决方案，但它可能会做你想要的

**编辑**

您可以添加一个 logout.php 页面，例如：

```
<?php
    session_start();
    $_SESSION['loggedIn'] = false;
?>
You have logged out 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-11-13T13:50:07.090

假设您使用的是 Apache：

[http://httpd.apache.org/docs/1.3/howto/htaccess.html#auth](http://httpd.apache.org/docs/1.3/howto/htaccess.html#auth)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-14T16:36:19.827

如果您想避免使用 cookie、会话并且不想玩 .htaccess 文件，您还可以使用 PHP 单独进行 http 身份验证：

[http://www.php.net/manual/en/features.http-auth.php](http://www.php.net/manual/en/features.http-auth.php)

您可以将密码硬编码到文件中并根据需要进行更改，或者从不在您的 web_accessible 目录中的文件中包含它。

缺点是您无法格式化“登录”屏幕 - 这将是一个标准的 http 身份验证对话框

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T14:10:34.053

我怀疑这是否算作**最好**的做法，但它会奏效。而且由于安全性对您来说似乎不是一个大问题，因此这种方式非常不安全的事实可能也不会打扰您。

有一个 login.php 页面，该页面接受密码，然后在登录详细信息正确时设置 cookie。然后每个 php 文件可以检查 cookie 的存在以确定用户是否“登录”，并相应地显示信息。

```
login.php
...
if(isset($_POST['password']) && $_POST['password'] == 'my_top_secret_word') {
    setcookie('loggedin', 'true', time() + 1200, '/url/');
} else {
    setcookie('loggedin', 'false', time() - 1200, '/url/');
    // display a login form here
}
etc 
```

然后每个“受保护”页面将检查此 cookie：

```
if(isset($_COOKIE['loggedin'])) {
    if($_COOKIE['loggedin'] == 'true') {
        $showHidden = true;
    } else {
        $showHidden = false;
    }
} else {
    $showHidden = false;
} 
```

我敢肯定你明白（高度不安全）的想法......

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-11-13T14:03:28.063

好吧，既然您一开始就*知道*它是不安全的，您可以将密码存储在 Web 服务器上某处的文本文件中。当有人访问该页面时，您可以显示一个要求输入密码的表单。如果密码与文本文件中的内容匹配，则重新加载页面并显示信息。使用文本文件将允许您更改密码，而无需在您想要更改密码时修改他们正在访问的页面。除非您使用 SSL，否则您仍将到处发送纯文本。如果您需要一些代码，请告诉我。

# asp.net - 我应该实现什么接口来为我的班级创建步骤驱动事件？

> ID：286940
> 
> 赞同：0
> 
> 时间：2008-11-13T13:46:22.713
> 
> 标签：asp.net, vb.net, interface

我想创建与数据阅读器类类似的行为，但要创建一个定制的电子邮件程序，以便我可以执行以下操作

```
Dim sender As New EmailSender(emailTemplate)
While sender.Send()
  Response.Write(sender("HTMLContent"))
End While 
```

是否有建议的接口或 mustInherit 类来利用步进功能，以便 sender.Send() 命令准备下一封要发送的电子邮件，如果存在则返回 true？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-13T14:03:23.943

否 - 您所要做的就是实现 Send() 方法来准备下一封要发送的电子邮件，如果存在则返回 true

您可能正在考虑用于迭代器的 IEnumerable 接口，但您不需要它来满足您的需求

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-13T14:56:07.473

这是我的解决方案，我使用了自己的接口和电子邮件发件人的基类，然后为具体类提供了一些伪代码。

```
 Namespace Emailer

        Public Interface IBatchableEmailSender
            Function SendNextEmail() As Boolean
            Sub PrepareBatchEmail()
            Property EmailOutput() As EmailOutput
        End Interface

        Public MustInherit Class BaseBatchEmailSender
            Implements IBatchableEmailSender

            Private _emailOutput As EmailOutput
            Public Property EmailOutput() As EmailOutput Implements IBatchableEmailSender.EmailOutput
                Get
                    Return _emailOutput
                End Get
                Set(ByVal value As EmailOutput)
                    _emailOutput = value
                End Set
            End Property
            Public MustOverride Sub PrepareBatchEmail() Implements IBatchableEmailSender.PrepareBatchEmail
            Public MustOverride Function SendNextEmail() As Boolean Implements IBatchableEmailSender.SendNextEmail

            Public Sub New()
                PrepareBatchEmail()
            End Sub

        End Class
Public Class BatchCustomerEmail
        Inherits BaseBatchEmailSender

        Private EmailItems As New Generic.List(Of EmailItem)
        Private EmailItemNumber As Integer
        Private NextEmailItem As EmailItem

        Protected Class EmailItem
            Public MemberID As Integer
            Public Sub New(ByVal memberID As Integer)
                Me.MemberID = memberID
            End Sub
        End Class

        Public Overrides Function SendNextEmail() As Boolean
            Dim hasEmail As Boolean = EmailItemNumber < EmailItems.Count
            If hasEmail Then
                ' Run script to send email
                ' If necessary mark email as sent in the database        
                EmailItemNumber = EmailItemNumber + 1
            End If
            Return hasEmail

        End Function

        Public Overrides Sub PrepareBatchEmail()
            '
            ' Creates a Generic.List(of EmailItems) to email.
            '
            EmailItemNumber = 0
        End Sub

    End Class

    Public Class EmailOutput
        Private _text As String

        Public Property Text() As String
            Get
                Return _text
            End Get
            Set(ByVal value As String)
                _text = value
            End Set
        End Property
        Private _html As String
        Public Property HTML() As String
            Get
                Return _html
            End Get
            Set(ByVal value As String)
                _html = value
            End Set
        End Property
        Private _error As String
        Public Property ErrorMessage() As String
            Get
                Return _error
            End Get
            Set(ByVal value As String)
                _error = value
            End Set
        End Property
        Public Sub New(ByVal errorMesage As String, ByVal html As String, ByVal text As String)
            Me.ErrorMessage = errorMesage
            Me.HTML = html
            Me.Text = text
        End Sub
    End Class

End Namespace 
```

# documentation - 软件文档模板

> ID：286944
> 
> 赞同：23
> 
> 时间：2008-11-13T13:47:24.490
> 
> 标签：documentation, project-management, project-planning

有谁知道软件需求、构建环境描述和其他类型的软件开发常见文档的示例和模板的来源？

谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-11-13T13:51:18.477

tigris的[ReadySet 模板](http://readyset.tigris.org/nonav/templates/frameset.html) 非常全面，尽管您需要了解 html 或有一个好的 html 编辑器才能使用它们。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-13T14:38:33.810

IEEE 为软件文档提供标准。例如，高级需求在 IEEE 830-1993 软件需求规范中定义。

这是我在学校学到的标准（使用的是一本名为 Software Engineering - Eric J. Braude 的面向对象的观点，但我不会特别推荐它。）虽然它更适合传统的瀑布开发模型。

谷歌搜索标准号码应该会给你一些有趣的链接。

（IEEE 830-1993 标准被 IEEE 830-1998 取代。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T14:48:24.540

德克萨斯州[对整个系统开发周期有一个很好的框架](http://dir.texas.gov/View-Resources/Pages/Content.aspx?id=16)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-11-14T07:26:10.820

arc42项目是关于一个类似于 Rational Unified Process 的软件架构文档（商业）的免费[软件](http://www.arc42.org/)*架构*文档**模板**。

 *# json - 什么是 JSON？

> ID：286945
> 
> 赞同：9
> 
> 时间：2008-11-13T13:47:48.953
> 
> 标签：json

什么是 JSON？

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-11-13T13:58:50.583

> **JSON（JavaScript Object Notation）是一种轻量级的数据交换格式**。人类很容易阅读和写作。机器很容易解析和生成。它基于 JavaScript 编程语言标准 ECMA-262 第 3 版 - 1999 年 12 月的一个子集。JSON 是一种完全独立于语言的文本格式，但使用 C 系列语言的程序员熟悉的约定，包括 C 、C++、C#、Java、JavaScript、Perl、Python 等等。这些属性使 JSON 成为一种理想的数据交换语言。

参考：[json.org](http://www.json.org/)

**对象**是一组无序的名称/值对。对象以 {（左大括号）开始，以 }（右大括号）结束。每个名称后跟 :（冒号），名称/值对用 ,（逗号）分隔。

[![替代文字](https://i.stack.imgur.com/BGm5b.gif)](https://i.stack.imgur.com/BGm5b.gif)
[（来源：[json.org](http://www.json.org/object.gif)）]

**数组**是值的有序集合。数组以 [（左括号）开头，以 ]（右括号）结尾。值用 ,（逗号）分隔。

[![替代文字](https://i.stack.imgur.com/NIBbZ.gif)](https://i.stack.imgur.com/NIBbZ.gif)
[（来源：[json.org](http://www.json.org/array.gif)）]

值可以是双引号中的字符串、**数字**、true 或 false 或 null，也可以是对象或数组。这些结构可以嵌套。

[![替代文字](https://i.stack.imgur.com/oaws0.gif)](https://i.stack.imgur.com/oaws0.gif)
[（来源：[json.org](http://www.json.org/value.gif)）]

字符串是零个或多个 Unicode 字符的集合，用双引号括起来，使用反斜杠转义**。**字符表示为单个字符串。字符串与 C 或 Java 字符串非常相似。

[![替代文字](https://i.stack.imgur.com/JYA8X.gif)](https://i.stack.imgur.com/JYA8X.gif)
[（来源：[json.org](http://www.json.org/string.gif)）]

数字与 C 或 Java**数字**非常相似，只是不使用八进制和十六进制格式。 [（来源：][[json.org](http://www.json.org/number.gif)][）][![替代文字](https://i.stack.imgur.com/IgEnH.gif)](https://i.stack.imgur.com/IgEnH.gif)

这是一个例子：

```
{
    "menu": {
        "id": "file",
        "value": "File",
        "popup": {
            "menuitem": [{
                "onclick": "CreateNewDoc()"
            }, {
                "value": "Open",
                "onclick": "OpenDoc()"
            }, {
                "value": "Close",
                "onclick": "CloseDoc()"
            }]
        }
    }
} 
```

在 XML 中，同样的情况是：

```
<menu id="file" value="File">
  <popup>
    <menuitem value="New" onclick="CreateNewDoc()" />
    <menuitem value="Open" onclick="OpenDoc()" />
    <menuitem value="Close" onclick="CloseDoc()" />
  </popup>
</menu> 
```

参考：[json.org](http://www.json.org/)

希望您现在了解什么是 JSON。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-13T13:48:49.620

来自维基百科：[JSON](http://en.wikipedia.org/wiki/Json)（Javascript 对象表示法）

> JSON 格式通常用于在称为序列化的过程中通过网络连接传输结构化数据。它的主要应用程序是在 Ajax Web 应用程序编程中，它用作 XML 格式的替代方案。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-13T14:36:50.677

深入的版本似乎覆盖得很好，也许您正在寻找简短的版本？

*JSON 基本上只是一种将数组从一种语言传递到另一种语言的方法。*

它在 Ajax（除其他外）中被大量使用，因为使用 Ajax，您通常有一种服务器端语言（PHP 等）将一组结果传递给客户端语言（javascript）。您的 javascript 使用一些参数调用您的 PHP 页面；您的 PHP 页面构建一个数组并将其回显为 JSON 格式；您的 javascript 捕获 JSON 并将其解码回数组以进行处理。

显然，它的意义远不止于此（因此，我期待一连串泪流满面的反对票 :)），但这就是您启动并运行它所需的全部内容。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-13T13:50:38.463

它是 JavaScript 对象表示法。您可以使用它来回发送数据。它通常被推荐，因为没有太多的开销，就像你使用 XML 得到的那样。这就是为什么它比带有 Ajax 的 XML 更受欢迎的原因。

看看这个： [http ://en.wikipedia.org/wiki/JSON](http://en.wikipedia.org/wiki/JSON)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-28T11:20:07.870

在我看来，当一个人想通过 HTTP 访问不同服务提供商的 web 服务时，比如 Twitter、facebook 等。

然后必须创建一个url并请求连接。当连接建立时，大量数据来自请求站点。

**例子**

<7b226665 65644974 656d7322 3a5b7b22 63617465 676f7279 223a7b22 6e616d65 223a2254 72616e73 706f7274 6174696f 6e222c22 68656164 65725f69 636f6e22 3a225c2f 686f6d65 5c2f6164 6d696e5c 2f707562 6c69635f 68746d6c 5c2f7072 6f647563 74696f6e 2e6d6973 73696f6e 7a65726f 2e6f7267>

这个**DATA**本质上很难理解和任意，所以我们有 2 个选项来表示任意数据结构，无论是**JSON**格式还是**XML**格式。但 XML 的缺点是，它在语法上比 JSON 更复杂，文件大小更大。所以最好使用JSON

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-09-28T05:06:37.863

JSON：JavaScript 对象表示法。

JSON 是一种用于存储和交换数据的语法。

JSON 是一种更易于使用的 XML 替代方案。

JSON 是一种轻量级的数据交换格式

JSON 与语言无关 *

JSON是“自我描述的”并且易于理解

例子：

```
 {"employees":[

      {"firstName":"John", "lastName":"Doe"},

      {"firstName":"Anna", "lastName":"Smith"},

      {"firstName":"Peter", "lastName":"Jones"}

    ]} 
```

# oracle - Oracle 默认值

> ID：286946
> 
> 赞同：1
> 
> 时间：2008-11-13T13:48:01.137
> 
> 标签：oracle, stored-procedures, plsql

我有一个关于 Oracle 中 PL/SQL 函数的默认值的快速问题。以这个程序为例；

```
create or replace
FUNCTION testFunction
(
  varNumber IN NUMBER DEFAULT 0
)
RETURN NUMBER
AS
BEGIN
  dbms_output.put_line(varNumber);
  RETURN varNumber;
END; 
```

这里的想法是，如果在调用此函数时没有为 varNumber 指定值，那么它将采用 0 的值。

现在，我的问题是我的函数是从一个 Web 服务层调用的，该层总是将 NULL 作为它没有值的参数的值传递。Oracle 将 NULL 解释为一个值，因此不会将 varNumber 初始化为其默认值 0。

我可以看到为什么这种方法是有意义的，但我想知道是否有一种方法可以覆盖这种行为，并使其在传递 NULL 值时使 Oracle 分配显式 DEFAULT 值，该值在函数头？

我已经考虑过进行手动检查的选项...

```
IF(varNumber IS NULL) THEN
   varNumber := 0;
END IF; 
```

但是，有数百个函数可能会成为问题，更不用说每个函数有大量参数，所以如果我能找到更通用的解决方案，我会更喜欢它。

为您可以提供的任何见解而欢呼。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T13:52:47.523

使用 NVL 定义值。

```
NVL( value_in, replace_with ) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-13T14:50:31.087

您不能将值分配给 IN 参数，但您可以将它们设为 IN/OUT，然后设置它们。不过，这会带来很大的误用和混淆可能性。

所以我认为你最好使用局部变量。但是你可以在声明中做到这一点。那是，

```
create or replace
FUNCTION testFunction
(
  varNumber IN NUMBER DEFAULT 0
)
RETURN NUMBER
AS
  vFix number := nvl(varNumber,0);
BEGIN
  dbms_output.put_line(vFix);
  RETURN vFix;
END; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-13T13:54:22.993

您的手动检查是安全地做您想做的事情的唯一方法。

不过，您可以在一行中这样写：

```
varNumber = NVL(varNumber,0); 
```

祝你好运！

# python - 有任何 Python 的 AOP 支持库吗？

> ID：286958
> 
> 赞同：31
> 
> 时间：2008-11-13T13:51:27.807
> 
> 标签：python, aop

我正在尝试在我的 Python 编程中使用一些 AOP，但我对现有的各种库没有任何经验。

所以我的问题是：

> Python 有哪些 AOP 支持？它们之间的不同库的优势是什么？

* * *

### 编辑

我找到了一些，但我不知道它们如何比较：

*   [外观](http://www.aspyct.org)
*   [用于 Python 的轻量级 AOP](http://www.cs.tut.fi/~ask/aspects/aspects.html)

### 编辑 2

我将在什么情况下使用这些？

我有两个用 Python 编写的应用程序，它们通常具有计算税收和其他金钱事物的方法。我希望能够编写一个功能的“骨架”，并在运行时对其进行自定义，例如更改地方税的应用方式（按国家、州或城市等），而不必超载全栈。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-11-13T17:39:10.000

请参阅 S.Lott 的关于 Python 装饰器的链接以获取一些很好的示例，并参阅[为装饰器定义的 PEP](http://www.python.org/dev/peps/pep-0318/)。

Python 从一开始就有 AOP，只是没有一个令人印象深刻的名字。在 Python 2.4 中添加了装饰器语法，这使得在语法上应用装饰器非常好。

也许如果你想根据规则应用装饰器，你需要一个库，但如果你愿意在声明相关函数/方法时标记它们，你可能不会。

这是一个简单缓存装饰器的示例（我为[这个问题](https://stackoverflow.com/questions/287085/what-does-args-and-kwargs-mean#287616)编写了它）：

```
import pickle, functools
def cache(f):
  _cache = {}
  def wrapper(*args, **kwargs):
    key = pickle.dumps((args, kwargs))
    if key not in _cache:
      _cache[key] = f(*args, **kwargs) # call the wrapped function, save in cache
    return _cache[key] # read value from cache
  functools.update_wrapper(wrapper, f) # update wrapper's metadata
  return wrapper

import time
@cache
def foo(n):
  time.sleep(2)
  return n*2

foo(10) # first call with parameter 10, sleeps
foo(10) # returns immediately 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-03-07T13:48:30.660

编辑：我不再维护 pytilities 并且多年来一直无人维护。您可能需要考虑其他答案之一或[Wikipedia 上的此列表](https://en.wikipedia.org/wiki/Aspect-oriented_programming#cite_note-41)。

python 的另一个 AOP 库是[`pytilities`](https://pypi.org/project/pytilities/)（[文档](http://pytilities.sourceforge.net/doc/1.2.0/)；[svn repo](https://sourceforge.net/p/pytilities/code/HEAD/tree/)）。它是目前最强大的（据我所知）。

它的特点是：

*   制作可重用的方面类
*   将多个方面应用于实例或类
*   对实例/类取消应用方面
*   使用方面向实例添加新属性
*   将建议应用于实例/类的所有属性
*   ...

它还有其他好处，例如一些特殊的描述符（请参阅文档）

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-11-13T14:11:06.767

在 Python 中，面向方面的编程通常包括在运行时动态修改类和实例，这通常称为猴子补丁。在回答另一个 AOP 问题时，我总结了 Python 中 AOP 的一些[用例](https://stackoverflow.com/questions/20663/do-you-use-aop-aspect-oriented-programming-in-production-software#20758)。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-05-21T19:08:59.983

使用注解并不是真正的 AOP，因为编织过程有些硬编码。

Python 中有几个 AOP 框架（我数了数并比较了其中的 8 个，其中`Aspyct`明显是赢家）。

我将在接下来的一个会议上发表一篇论文，其中包含我的发现，其中包括一个现实生活中的行业用例。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-12-15T10:59:24.960

BSD 许可的[python-aspectlib](https://github.com/ionelmc/python-aspectlib/)呢？

> ## 实施状况
> 
> 编织函数、方法、实例和类就完成了。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-13T14:05:33.283

我将从[Python Decorator Library](http://wiki.python.org/moin/PythonDecoratorLibrary)开始。其中大部分是AOP之类的东西。

# java - 如何在 java 中获取 jpeg/tiff 的颜色空间？

> ID：286959
> 
> 赞同：4
> 
> 时间：2008-11-13T13:51:29.490
> 
> 标签：java, image, colors, metadata, jpeg

标题确实总结了它。使用独立的 exiftool 程序将所有图像元数据转储到控制台我可以看到一行颜色空间数据：RGB 看起来这是取自 ICC-header

我想在java中以编程方式获取相同的数据。我已经尝试过绘制的 noakes 库和 Sanselan 库，但都没有给我任何字段的 RGB 值。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-11-13T14:54:55.383

You have a `BufferedImage`, right? If so, you probably want either [getType()](http://java.sun.com/javase/6/docs/api/java/awt/image/BufferedImage.html#getType()) or [getColorModel()](http://java.sun.com/javase/6/docs/api/java/awt/image/BufferedImage.html#getColorModel())(then .[getColorSpace()](http://java.sun.com/javase/6/docs/api/java/awt/image/ColorModel.html#getColorSpace()) or .`toString()`). You can test getType() against the various types defined in `BufferedImage`.

# asp-classic - SQL 事件探查器连接详细信息

> ID：286960
> 
> 赞同：0
> 
> 时间：2008-11-13T13:52:08.147
> 
> 标签：asp-classic, sql-server-2000, sql-server-profiler

当您启动标准跟踪时，您看到的第一个设置将是当前数据库连接。

就我而言，大约有 10 个条目，所有条目都是相同的用户名，但是有些是 dateformat dmy，有些是 mdy。asp 网站似乎从池中选择一个连接并使用它，它似乎选择了 3 个中的一个，并且全部设置为 dmy，但是每个连接都应该是 mdy。由于它们都是相同的用户名，并且该用户设置为 us_english 连接可能在哪里获取 dateformat 条目？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-18T10:45:33.347

一些想法：

*   应用程序正在发出 SET DATEFORMAT
*   该应用程序正在使用带/不带翻译的 DSN

默认情况下，连接默认值由 SQL Server 默认设置定义。

# c# - 如何使用正则表达式“剪切”字符串的一部分？

> ID：286964
> 
> 赞同：6
> 
> 时间：2008-11-13T13:53:41.687
> 
> 标签：c#, regex

我需要在 C# 中剪切并保存/使用部分字符串。我认为最好的方法是使用正则表达式。我的字符串如下所示：

`"changed from 1 to 10"`.

我需要一种方法来删除这两个数字并在其他地方使用它们。有什么好方法可以做到这一点？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-13T14:06:04.033

错误检查留作练习......

```
 Regex regex = new Regex( @"\d+" );
        MatchCollection matches = regex.Matches( "changed from 1 to 10" );
        int num1 = int.Parse( matches[0].Value );
        int num2 = int.Parse( matches[1].Value ); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-13T14:04:06.953

仅匹配字符串“从 x 更改为 y”：

```
string pattern = @"^changed from ([0-9]+) to ([0-9]+)$";
Regex r = new Regex(pattern);
Match m = r.match(text);
if (m.Success) {
   Group g = m.Groups[0];
   CaptureCollection cc = g.Captures;

   int from = Convert.ToInt32(cc[0]);
   int to = Convert.ToInt32(cc[1]);

   // Do stuff
} else {
   // Error, regex did not match
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T14:00:37.273

在您的正则表达式中，将要记录的字段放在括号中，然后使用该`Match.Captures`属性提取匹配的字段。

[这里](http://msdn.microsoft.com/en-us/library/system.text.regularexpressions.group.captures.aspx)有一个 C# 示例。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-13T14:03:55.003

使用命名的捕获组。

```
Regex r = new Regex("*(?<FirstNumber>[0-9]{1,2})*(?<SecondNumber>[0-9]{1,2})*");
 string input = "changed from 1 to 10";
 string firstNumber = "";
 string secondNumber = "";

 MatchCollection joinMatches = regex.Matches(input);

 foreach (Match m in joinMatches)
 {
  firstNumber= m.Groups["FirstNumber"].Value;
  secondNumber= m.Groups["SecondNumber"].Value;
 } 
```

让[Expresson](http://www.ultrapico.com/Expresso.htm)来帮助你，它有一个导出到 C# 的选项。

**免责声明：正则表达式可能不正确（我的 expresso 副本已过期：D）**

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-13T16:06:08.110

这是一个*几乎*可以完成我想要的代码片段：

```
using System.Text.RegularExpressions;

string text = "changed from 1 to 10";
string pattern = @"\b(?<digit>\d+)\b";
Regex r = new Regex(pattern);
MatchCollection mc = r.Matches(text);
foreach (Match m in mc) {
    CaptureCollection cc = m.Groups["digit"].Captures;
    foreach (Capture c in cc){
        Console.WriteLine((Convert.ToInt32(c.Value)));
    }
} 
```

# c# - 获取引号之间的值

> ID：286971
> 
> 赞同：1
> 
> 时间：2008-11-13T13:56:16.563
> 
> 标签：c#, regex

如何使用 RegEx 获取引号之间的值

例如我想从函数测试中找到所有参数

```
<html>
   test("bla");
   print("foo");
   test("moo");
</html> 
```

结果必须是 { "bla", "moo" }

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T14:11:34.520

如果您只想要 args `test`，则需要将其包含在正则表达式中：

```
 StringBuilder sb = new StringBuilder("{");
    bool first = true;
    foreach (Match match in Regex.Matches(html, @"test\((""[^\""]*\"")\)"))
    {
        if(first) {first = false;}
        else {sb.Append(',');}
        sb.Append(match.Groups[1].Value);
    }
    sb.Append('}');
    Console.WriteLine(sb); 
```

从问题中，我在这里使用报价检测。

或者 - 如果您只想要这些值：

```
 foreach (Match match in Regex.Matches(html, @"test\(""([^\""]*)\""\)"))
    {
        Console.WriteLine(match.Groups[1].Value);
    } 
```

这里的主要变化是该组现在位于引号内。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-13T14:07:23.857

编辑：删除旧代码并制作了 linq 版本...

```
 var array = (from Match m in Regex.Matches(inText, "\"\\w+?\"")
                 select m.Groups[0].Value).ToArray();

    string json = string.Format("{{{0}}}", string.Join(",", array)); 
```

# java - Java控制IP TTL？

> ID：286972
> 
> 赞同：3
> 
> 时间：2008-11-13T13:56:21.023
> 
> 标签：java, sockets

在 Java 中，有没有办法控制在套接字上发送的数据包的 IP 标头的 TTL？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T14:13:57.447

显然只在多播套接字上，它有：

```
MulticastSocket.setTimeToLive(int ttl); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-29T17:01:59.920

使用设置 TTL

```
MulticastSocket.setTimeToLive(int ttl); 
```

仅当您启用了其他问题所述的 IPV4Stack 时才会起作用

[Java Multicast Time To Live 始终为 0](https://stackoverflow.com/questions/139909/java-multicast-time-to-live-is-always-0)

```
-Djava.net.preferIPv4Stack=true 
```

# curl - 仅卷曲帖子数据和标题

> ID：286982
> 
> 赞同：73
> 
> 时间：2008-11-13T14:00:43.840
> 
> 标签：curl

我只想从 curl 请求中获取标头

`curl -I www.google.com`

都很盛大。现在我想这样做，但也要传递帖子数据：

`curl -I -d'test=test' www.google.com`

但我得到的只是：

`Warning: You can only select one HTTP request!`

任何人都知道如何做到这一点，或者我在做一些愚蠢的事情吗？

* * *

## 回答 #1

> 赞同：117
> 
> 时间：2008-11-13T15:45:42.707

该`-I`选项告诉 curl 执行 HEAD 请求，而该`-d'test=test'`选项告诉 curl 执行 POST，因此您告诉 curl 执行两种不同的请求类型。

```
curl -s -d'test=test' -D- -o/dev/null www.google.com 
```

或者，在 Windows 上：

```
curl -s -d'test=test' -D- -onul: www.google.com 
```

这是我能找到的最简洁的方法。选项包括：

*   `-D-`将标头转储到列出的文件中，或者`-`传递时的标准输出，就像这样。
*   `-o/dev/null`将正文发送到列出的文件。在这里，我们丢弃了正文，因此我们只看到了标题。
*   `-s`静音（无进度条）

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2008-11-13T14:14:06.417

`-d`表示您正在通过该`POST`方法发送表单数据。`-I`意味着您只是通过`HEAD`.

我建议要么

*   通过文件下载`/dev/null`并写入标题`-D headerfile``headerfile`
*   用于`-i`在答案中包含标题并跳过第一个空行中的所有内容。

# git - Git - 将更改从克隆拉回主控

> ID：286988
> 
> 赞同：5
> 
> 时间：2008-11-13T14:03:56.937
> 
> 标签：git, version-control

我克隆了一个 Git 大师，并在克隆上做了很多更改。我已经在克隆上提交了这些更改，现在希望主服务器成为克隆上内容的副本。

我已经尝试在克隆上使用 Git push 以将更改推送到主服务器 - 但我没有做任何事情来更新主服务器。

我怎样才能让主副本完全复制克隆上的内容？更新克隆并使主控与克隆同步的命令工作流程是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-11-13T15:21:36.813

There are 2 kinds of git repository, bare and non-bare. A non bare repository is any repository which has a 'working copy' i.e. some part of the repository currently checked out.

You *can* push into a non-bare repository, but it won't update the checked out working copy even if the checked out branch is the same as the branch you pushed. This is because the checked out copy might have changes that aren't committed, and git won't ever destroy changes without you explicitly asking (usually such commands have a --hard argument)

Read [Why won't I see changes in the remote repo after "git push"?](http://git.or.cz/gitwiki/GitFaq#head-b96f48bc9c925074be9f95c0fce69bcece5f6e73) and [How would I use "git push" to sync out of a firewalled host?](http://git.or.cz/gitwiki/GitFaq#push-is-reverse-of-fetch) for a full description of the problem and a potential solution. Word of warning, if you've pushed into a remote repo, any non-committed changes in that remote-repo will have to be discarded.

Generally it sounds like the approach you want isn't really adopted by gitters, because it doesn't really match the distributed repository mentality. It's your own responsibility to make sure your copy of the repo is up to date.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-13T18:41:31.697

如果您创建了自己的可从主服务器轻松访问的克隆，那么您可以轻松地将更改从克隆拉到主服务器。只是：

```
git pull /path/to/clone 
```

这会将更改从克隆的 HEAD 拉到 master 的 HEAD 中。

另一种常见的情况是克隆位于另一个网络上或无法从主服务器直接访问的地方。在这种情况下，您可以使用以下之一：

*   克隆推送到的公共存储库和主从提取的公共存储库（例如[github](http://github.com)或某个地方的裸存储库）
*   [git-bundle](http://www.kernel.org/pub/software/scm/git/docs/git-bundle.html)将一组更改作为文件移动
*   [git-format-patch](http://www.kernel.org/pub/software/scm/git/docs/git-format-patch.html)和[git-am](http://www.kernel.org/pub/software/scm/git/docs/git-am.html)通过电子邮件发送更改

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-13T21:54:59.453

我喜欢 Gareth 和 Greg 的回答。我只想补充一点，我发现使用裸存储库与其他人同步工作非常方便。这让任何人都可以将他们的更改（包括分支）推送/拉取到裸存储库，然后其他人可以在他们认为合适的时候获取/拉取/合并。这与拥有一个单一的中央存储库不同，因为每个克隆都是一个成熟的存储库。

# html - 您知道将本地化文本更改为 html 实体的 eclipse 插件吗？

> ID：286990
> 
> 赞同：1
> 
> 时间：2008-11-13T14:04:04.660
> 
> 标签：html, eclipse, plugins

我有带有我的国家字符的资源包 - 如何将它们更改为 html 实体。我更喜欢与 Eclipse 集成的插件，以便将所有工具集中在一个地方。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-31T01:44:58.480

你可以试试：

[http://andrei.gmxhome.de/anyedit/](http://andrei.gmxhome.de/anyedit/)

在页面下方，其功能之一是：

*将字符转换为 Html 实体编辑器 - 如果在双语团队中工作以在 html 和其他来源之间转换 é、ô、ä 等，则很有用；）*

# c++ - windows下如何监控/记录文件对远程文件夹的访问？

> ID：286994
> 
> 赞同：3
> 
> 时间：2008-11-13T14:05:04.877
> 
> 标签：c++, windows, networking, file, monitoring

我想记录我从特定网络共享访问的所有文件的名称（以及访问该文件的进程）。

C++ / Win32 中的解决方案最好是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-11-13T23:34:05.570

You need [ReadDirectoryChangesW](http://msdn.microsoft.com/en-us/library/aa365465(VS.85).aspx) and the FILE_NOTIFY_CHANGE_LAST_ACCESS notification flag.

I don't think the old FindFirstChangeNotification will work for you as it only notifies on changes, not access, but I've traditionally used that for file/directory notifications.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T22:44:55.247

来自 sysinternals.com 的 Process Monitor 可以设置为过滤路径。您可以设置您有兴趣观看的 UNC 的路径。

[http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-01-18T21:06:37.253

如果是事后处理，你可以使用[Windows 的安全审计](http://technet.microsoft.com/en-us/library/dd772690%28WS.10%29.aspx)。

如果您需要实时执行此操作，则可能需要与[Windows 消息队列](http://msdn.microsoft.com/en-us/library/windows/desktop/ms632590%28v=vs.85%29.aspx)交互并嗅探您感兴趣的特定事件。

# asp.net - 手动启动 ASP 开发服务器？

> ID：286995
> 
> 赞同：5
> 
> 时间：2008-11-13T14:05:05.953
> 
> 标签：asp.net, webdev.webserver

必须有办法做到这一点，我在谷歌上搜索信息，但我似乎无法让它工作。我检查过的网站说要做一些类似的事情

**`start /B %WINDIR%\Microsoft.NET\Framework\v2.0.50727\webdev.webserver.exe /path:"D:\MyFolder" /vpath:/HelloWorldWebSite`**

在批处理文件中。但是，我的框架文件夹（我在 3.5 中开发）都没有这个**`webdev.webserver.exe`**文件。

有什么建议么？

更新：感谢 Casper 在[这篇文章](https://stackoverflow.com/questions/57094/how-can-i-programmatically-run-the-aspnet-development-server-using-c#57105)中，我找到了文件所在的位置。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-13T14:20:40.447

C:\Program Files\Common Files\microsoft shared\DevServer\9.0

在我的电脑上得到它

使用任务管理器跟踪它***********